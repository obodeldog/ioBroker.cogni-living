const a4_0x104a92=a4_0x372b;(function(_0x30e4dc,_0x525e30){const _0x253d6a=a4_0x372b,_0x4aeaa6=_0x30e4dc();while(!![]){try{const _0x3e2cf3=-parseInt(_0x253d6a(0x11e))/0x1+parseInt(_0x253d6a(0x145))/0x2*(parseInt(_0x253d6a(0x14c))/0x3)+parseInt(_0x253d6a(0x116))/0x4+-parseInt(_0x253d6a(0x11a))/0x5+parseInt(_0x253d6a(0x110))/0x6+-parseInt(_0x253d6a(0x13d))/0x7+parseInt(_0x253d6a(0x10c))/0x8*(parseInt(_0x253d6a(0x121))/0x9);if(_0x3e2cf3===_0x525e30)break;else _0x4aeaa6['push'](_0x4aeaa6['shift']());}catch(_0x40a6d1){_0x4aeaa6['push'](_0x4aeaa6['shift']());}}}(a4_0x3cd0,0x4efcf));function a4_0x372b(_0x3719a3,_0x557eca){const _0x5a25cb=a4_0x3cd0();return a4_0x372b=function(_0xf10f7b,_0x526263){_0xf10f7b=_0xf10f7b-0x10b;let _0x3cd0f2=_0x5a25cb[_0xf10f7b];return _0x3cd0f2;},a4_0x372b(_0x3719a3,_0x557eca);}const a4_0x526263=(function(){let _0x14b08c=!![];return function(_0x2e7cc2,_0x27adfa){const _0x4f6a4e=_0x14b08c?function(){const _0x5a3b73=a4_0x372b;if(_0x27adfa){const _0x208767=_0x27adfa[_0x5a3b73(0x14a)](_0x2e7cc2,arguments);return _0x27adfa=null,_0x208767;}}:function(){};return _0x14b08c=![],_0x4f6a4e;};}()),a4_0xf10f7b=a4_0x526263(this,function(){const _0x47f396=a4_0x372b;return a4_0xf10f7b[_0x47f396(0x137)]()[_0x47f396(0x16d)](_0x47f396(0x148))[_0x47f396(0x137)]()[_0x47f396(0x11d)](a4_0xf10f7b)[_0x47f396(0x16d)](_0x47f396(0x148));});a4_0xf10f7b();'use strict';const {spawn}=require(a4_0x104a92(0x153)),path=require(a4_0x104a92(0x152)),fs=require('fs'),setup=require(a4_0x104a92(0x118)),automation=require('./automation');let pythonProcess=null;function send(_0x5eb1ce,_0x146a07,_0x475ba2={}){const _0x3a7e3e=a4_0x104a92;if(!pythonProcess||!pythonProcess['stdin']['writable'])return;const _0x2560af=JSON['stringify']({'command':_0x146a07,..._0x475ba2});try{pythonProcess[_0x3a7e3e(0x10f)][_0x3a7e3e(0x113)](_0x2560af+'\x0a');}catch(_0x2a4e13){}}function handleResult(_0x3a21bd,_0x85435d){const _0x18a85d=a4_0x104a92;if(_0x85435d[_0x18a85d(0x134)]===_0x18a85d(0x144))_0x3a21bd['log'][_0x18a85d(0x138)](_0x18a85d(0x169));else{if(_0x85435d[_0x18a85d(0x134)]==='SECURITY_RESULT'){const {anomaly_score:_0xb0a09f,is_anomaly:_0x2f5625,threshold:_0xc138ba,explanation:_0x3221e8}=_0x85435d[_0x18a85d(0x16a)];_0x3a21bd[_0x18a85d(0x126)]['info'](_0x18a85d(0x12f)+_0xb0a09f[_0x18a85d(0x124)](0x5)+_0x18a85d(0x11c)+(_0x2f5625?_0x18a85d(0x146):'OK')),_0x3a21bd[_0x18a85d(0x15f)]('analysis.security.lastScore',{'val':_0xb0a09f,'ack':!![]}),_0x3a21bd['setStateAsync']('analysis.security.lastCheck',{'val':new Date()[_0x18a85d(0x15d)](),'ack':!![]});if(_0xc138ba)_0x3a21bd['setStateAsync'](_0x18a85d(0x151),{'val':_0xc138ba,'ack':!![]});if(_0x2f5625){let _0xb12202=_0x18a85d(0x15b)+_0xb0a09f['toFixed'](0x4)+')';if(_0x3221e8&&_0x3221e8!==_0x18a85d(0x13b))_0xb12202+='\x0aGrund:\x20'+_0x3221e8;_0x3a21bd[_0x18a85d(0x15f)](_0x18a85d(0x136),{'val':!![],'ack':!![]}),_0x3a21bd['setStateAsync'](_0x18a85d(0x160),{'val':_0xb12202,'ack':!![]}),setup['sendNotification'](_0x3a21bd,_0x18a85d(0x120)+_0xb12202,![],!![]);}}else{if(_0x85435d[_0x18a85d(0x134)]==='TRAINING_COMPLETE'){const _0x367030=_0x85435d[_0x18a85d(0x16a)][_0x18a85d(0x14b)]||'',_0x39553e=_0x85435d[_0x18a85d(0x16a)]['threshold'],_0x1b6df6=_0x85435d['payload']['success']?_0x18a85d(0x130)+new Date()[_0x18a85d(0x140)]()+'\x20('+_0x367030+')':_0x18a85d(0x159)+_0x85435d['payload'][_0x18a85d(0x129)];_0x3a21bd[_0x18a85d(0x15f)](_0x18a85d(0x131),{'val':_0x1b6df6,'ack':!![]});if(_0x85435d[_0x18a85d(0x16a)]['success']&&_0x39553e)_0x3a21bd['setStateAsync'](_0x18a85d(0x151),{'val':_0x39553e,'ack':!![]});}else{if(_0x85435d[_0x18a85d(0x134)]===_0x18a85d(0x168)){const {patterns:_0x8dcd24}=_0x85435d[_0x18a85d(0x16a)];if(_0x8dcd24&&_0x8dcd24[_0x18a85d(0x163)]>0x0){_0x3a21bd[_0x18a85d(0x126)][_0x18a85d(0x165)]('üõãÔ∏è\x20BUTLER:\x20Found\x20'+_0x8dcd24[_0x18a85d(0x163)]+_0x18a85d(0x12a)),_0x3a21bd['setStateAsync'](_0x18a85d(0x133),{'val':JSON[_0x18a85d(0x167)](_0x8dcd24),'ack':!![]});const _0x34e8ce=_0x8dcd24[0x0],_0x18bb5a=_0x18a85d(0x155)+_0x34e8ce[_0x18a85d(0x12c)]+'\x20('+(_0x34e8ce[_0x18a85d(0x141)]*0x64)['toFixed'](0x0)+'%)';_0x3a21bd[_0x18a85d(0x15f)](_0x18a85d(0x10d),{'val':!![],'ack':!![]}),_0x3a21bd[_0x18a85d(0x15f)](_0x18a85d(0x111),{'val':_0x18bb5a,'ack':!![]});}else _0x3a21bd[_0x18a85d(0x126)]['info'](_0x18a85d(0x123)),_0x3a21bd[_0x18a85d(0x15f)](_0x18a85d(0x10d),{'val':![],'ack':!![]}),_0x3a21bd['setStateAsync'](_0x18a85d(0x133),{'val':'[]','ack':!![]});}else{if(_0x85435d[_0x18a85d(0x134)]===_0x18a85d(0x15e)){if(_0x85435d[_0x18a85d(0x16a)][_0x18a85d(0x12b)])try{const _0x577b61=JSON[_0x18a85d(0x128)](_0x85435d['payload'][_0x18a85d(0x14b)]);if(_0x577b61[_0x18a85d(0x13c)])_0x3a21bd['setStateAsync'](_0x18a85d(0x12d),{'val':JSON[_0x18a85d(0x167)](_0x577b61[_0x18a85d(0x13c)]),'ack':!![]});if(_0x577b61[_0x18a85d(0x117)])_0x3a21bd[_0x18a85d(0x15f)](_0x18a85d(0x14e),{'val':JSON[_0x18a85d(0x167)](_0x577b61[_0x18a85d(0x117)]),'ack':!![]});}catch(_0x34d0a3){}}else{if(_0x85435d[_0x18a85d(0x134)]==='HEALTH_TRAIN_RESULT'){if(_0x85435d[_0x18a85d(0x16a)]['success'])_0x3a21bd[_0x18a85d(0x126)][_0x18a85d(0x165)](_0x18a85d(0x119));}else{if(_0x85435d[_0x18a85d(0x134)]===_0x18a85d(0x143))_0x3a21bd['setStateAsync'](_0x18a85d(0x15c),{'val':new Date()['toISOString'](),'ack':!![]}),_0x3a21bd[_0x18a85d(0x15f)]('analysis.health.isAnomaly',{'val':_0x85435d['payload'][_0x18a85d(0x164)],'ack':!![]});else{if(_0x85435d[_0x18a85d(0x134)]===_0x18a85d(0x135))_0x3a21bd[_0x18a85d(0x15f)]('analysis.health.trendDiagnosis',{'val':_0x85435d['payload'][_0x18a85d(0x158)],'ack':!![]}),_0x3a21bd[_0x18a85d(0x15f)](_0x18a85d(0x10e),{'val':_0x85435d['payload']['change_percent'],'ack':!![]});else{if(_0x85435d[_0x18a85d(0x134)]===_0x18a85d(0x12e)){const {speed_trend:_0xd11198}=_0x85435d['payload'];if(_0xd11198!==undefined)_0x3a21bd[_0x18a85d(0x15f)](_0x18a85d(0x122),{'val':_0xd11198,'ack':!![]});}else{if(_0x85435d['type']===_0x18a85d(0x142)){const {forecast:_0x5a8c7d}=_0x85435d[_0x18a85d(0x16a)];if(_0x5a8c7d)_0x3a21bd[_0x18a85d(0x15f)](_0x18a85d(0x162),{'val':JSON['stringify'](_0x5a8c7d),'ack':!![]});}else{if(_0x85435d['type']==='TOPOLOGY_RESULT'){const {data:_0x4d4e43}=_0x85435d[_0x18a85d(0x16a)];_0x4d4e43&&(_0x3a21bd['log'][_0x18a85d(0x165)]('üï∏Ô∏è\x20Topology\x20Map\x20updated\x20by\x20Python.'),_0x3a21bd[_0x18a85d(0x15f)]('analysis.security.topologyMatrix',{'val':JSON[_0x18a85d(0x167)](_0x4d4e43),'ack':!![]}));}else{if(_0x85435d[_0x18a85d(0x134)]===_0x18a85d(0x161))_0x3a21bd[_0x18a85d(0x126)][_0x18a85d(0x138)](_0x18a85d(0x11b));else{if(_0x85435d[_0x18a85d(0x134)]==='SIGNAL_RESULT'){const {room:_0xe5ee1b,propagation:_0x2fceff}=_0x85435d[_0x18a85d(0x16a)];let _0xddf275=_0x18a85d(0x13b),_0x4aa712=0x0;if(_0x2fceff){const _0x34e08a=Object[_0x18a85d(0x10b)](_0x2fceff);_0x34e08a[_0x18a85d(0x163)]>0x0&&(_0xddf275=_0x34e08a[0x0][0x0],_0x4aa712=_0x34e08a[0x0][0x1]);}_0x3a21bd[_0x18a85d(0x15f)](_0x18a85d(0x112),{'val':_0xddf275,'ack':!![]}),_0x3a21bd['setStateAsync'](_0x18a85d(0x156),{'val':_0x4aa712,'ack':!![]}),_0x4aa712>0.4&&_0x3a21bd[_0x18a85d(0x126)][_0x18a85d(0x138)](_0x18a85d(0x125)+_0xe5ee1b+_0x18a85d(0x114)+_0xddf275+'\x20('+(_0x4aa712*0x64)[_0x18a85d(0x124)](0x0)+'%)'),automation[_0x18a85d(0x149)](_0x3a21bd,_0xddf275,_0x4aa712);}}}}}}}}}}}}}}function startService(_0x17e004,_0x4123f4){const _0x247dde=a4_0x104a92;let _0x1237d6='python3';if(fs[_0x247dde(0x13e)](_0x4123f4))_0x1237d6=_0x4123f4;try{const _0x277d23=path['join'](__dirname,'..',_0x247dde(0x13f),'service.py');pythonProcess=spawn(_0x1237d6,[_0x277d23]),pythonProcess[_0x247dde(0x16e)]['on'](_0x247dde(0x139),_0x198d48=>{const _0xfe8c99=_0x247dde,_0x54f81f=_0x198d48[_0xfe8c99(0x137)]()[_0xfe8c99(0x14d)]('\x0a');_0x54f81f[_0xfe8c99(0x115)](_0x3b7eb3=>{const _0x37f537=_0xfe8c99,_0x1bfe74=_0x3b7eb3['trim']();if(!_0x1bfe74)return;if(_0x1bfe74[_0x37f537(0x132)](_0x37f537(0x14f)))_0x17e004['log'][_0x37f537(0x138)](_0x37f537(0x15a)+_0x1bfe74[_0x37f537(0x11f)](0x5)['trim']());else{if(_0x1bfe74['startsWith'](_0x37f537(0x13a)))try{const _0x261a63=JSON[_0x37f537(0x128)](_0x1bfe74[_0x37f537(0x11f)](0x8)[_0x37f537(0x150)]());handleResult(_0x17e004,_0x261a63);}catch(_0x218bda){}}});}),pythonProcess['on'](_0x247dde(0x154),_0x32a134=>{pythonProcess=null;}),_0x17e004[_0x247dde(0x16c)]=(_0x29d44b,_0xb4bfb8)=>send(_0x17e004,_0x29d44b,_0xb4bfb8);}catch(_0x14a80f){_0x17e004['log'][_0x247dde(0x147)](_0x247dde(0x157)+_0x14a80f[_0x247dde(0x16b)]);}}function a4_0x3cd0(){const _0x230344=['analysis.health.trendValue','stdin','2779248dxsBpO','analysis.automation.description','analysis.prediction.nextRoom','write','\x20->\x20Likely\x20','forEach','241536jnnoZL','heating','./setup','‚úÖ\x20HEALTH\x20TRAINED.','1657525oncrCQ','üêç\x20Python\x20confirmed\x20new\x20topology.','\x20->\x20','constructor','415992wSMqrC','substring','‚ö†Ô∏è\x20SECURITY\x20ALARM:\x20','9gFEKQD','analysis.health.gaitSpeed','üõãÔ∏è\x20BUTLER:\x20Keine\x20neuen\x20Muster\x20gefunden.','toFixed','üîÆ\x20Prediction:\x20From\x20','log','kill','parse','reason','\x20new\x20patterns.','success','rule','analysis.energy.insulationScore','GAIT_RESULT','üõ°Ô∏è\x20SECURITY\x20CHECK:\x20Score\x20','Success:\x20','analysis.training.status','startsWith','analysis.automation.detectedPatterns','type','TREND_RESULT','analysis.isAlert','toString','debug','data','[RESULT]','Unknown','insulation','4288172LSVReC','existsSync','python_service','toLocaleTimeString','confidence','ENERGY_PREDICT_RESULT','HEALTH_RESULT','PONG','1269342ZLSeWG','ANOMALY','error','(((.+)+)+)+$','handlePrediction','apply','details','3GhGxUm','split','analysis.energy.heatingScore','[LOG]','trim','analysis.security.currentThreshold','path','child_process','close','Regel\x20erkannt:\x20','analysis.prediction.confidence','Error\x20launching\x20Python:\x20','diagnosis','Failed:\x20','[PYTHON]\x20','Ungew√∂hnliches\x20Bewegungsmuster!\x20(Score:\x20','analysis.health.lastCheck','toISOString','ENERGY_TRAIN_RESULT','setStateAsync','analysis.alertReason','TOPOLOGY_ACK','analysis.energy.forecast','length','is_anomaly','info','exports','stringify','COMFORT_RESULT','üêç\x20Python\x20Pong','payload','message','sendToPythonWrapper','search','stdout','entries','4202920DxFKQt','analysis.automation.patternDetected'];a4_0x3cd0=function(){return _0x230344;};return a4_0x3cd0();}function stopService(_0x17e257){const _0x20228d=a4_0x104a92;if(pythonProcess){try{pythonProcess[_0x20228d(0x127)]();}catch(_0x3ca88e){}pythonProcess=null;}}module[a4_0x104a92(0x166)]={'startService':startService,'stopService':stopService,'send':send};