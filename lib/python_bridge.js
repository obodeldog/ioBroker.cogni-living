const a4_0x4d3881=a4_0x41bf;(function(_0x5d41a5,_0x38411f){const _0x502635=a4_0x41bf,_0x1422a1=_0x5d41a5();while(!![]){try{const _0x5498f8=parseInt(_0x502635(0xef))/0x1*(-parseInt(_0x502635(0x120))/0x2)+-parseInt(_0x502635(0xf0))/0x3*(-parseInt(_0x502635(0x11a))/0x4)+parseInt(_0x502635(0x125))/0x5+-parseInt(_0x502635(0xe9))/0x6+parseInt(_0x502635(0x10f))/0x7+parseInt(_0x502635(0x10d))/0x8*(-parseInt(_0x502635(0x10b))/0x9)+parseInt(_0x502635(0xce))/0xa*(-parseInt(_0x502635(0xc8))/0xb);if(_0x5498f8===_0x38411f)break;else _0x1422a1['push'](_0x1422a1['shift']());}catch(_0x3ebe1f){_0x1422a1['push'](_0x1422a1['shift']());}}}(a4_0x5f0d,0xe8a00));const a4_0x4d5604=(function(){let _0xe65ac4=!![];return function(_0x2c0a06,_0x423799){const _0x450209=_0xe65ac4?function(){const _0x27da68=a4_0x41bf;if(_0x423799){const _0x4fd612=_0x423799[_0x27da68(0xd9)](_0x2c0a06,arguments);return _0x423799=null,_0x4fd612;}}:function(){};return _0xe65ac4=![],_0x450209;};}()),a4_0x4417b9=a4_0x4d5604(this,function(){const _0x2e48d8=a4_0x41bf;return a4_0x4417b9[_0x2e48d8(0xd8)]()[_0x2e48d8(0xcd)](_0x2e48d8(0xe5))[_0x2e48d8(0xd8)]()['constructor'](a4_0x4417b9)[_0x2e48d8(0xcd)]('(((.+)+)+)+$');});a4_0x4417b9();'use strict';function a4_0x41bf(_0x3533fb,_0x10e762){const _0x1e1d7c=a4_0x5f0d();return a4_0x41bf=function(_0x4417b9,_0x4d5604){_0x4417b9=_0x4417b9-0xc3;let _0x5f0dac=_0x1e1d7c[_0x4417b9];return _0x5f0dac;},a4_0x41bf(_0x3533fb,_0x10e762);}const {spawn}=require(a4_0x4d3881(0x113)),path=require(a4_0x4d3881(0x108)),fs=require('fs'),setup=require('./setup'),automation=require('./automation');let pythonProcess=null;function send(_0xdf7c8e,_0x5f2621,_0x223275={}){const _0x37032a=a4_0x4d3881;if(!pythonProcess||!pythonProcess[_0x37032a(0x11b)][_0x37032a(0x126)])return;const _0x25beb6=JSON[_0x37032a(0x11c)]({'command':_0x5f2621,..._0x223275});try{pythonProcess[_0x37032a(0x11b)][_0x37032a(0x12b)](_0x25beb6+'\x0a');}catch(_0x133c2f){}}function handleResult(_0x5c4b76,_0x4e93d2){const _0x303056=a4_0x4d3881;if(_0x4e93d2[_0x303056(0x127)]===_0x303056(0x122))_0x5c4b76[_0x303056(0xed)][_0x303056(0x110)](_0x303056(0x119));else{if(_0x4e93d2['type']==='SECURITY_RESULT'){const {anomaly_score:_0xe1424e,is_anomaly:_0xc1c41e,threshold:_0x5431e2,explanation:_0x4e6b1b}=_0x4e93d2[_0x303056(0xd6)];_0x5c4b76[_0x303056(0xed)][_0x303056(0x100)](_0x303056(0xe8)+_0xe1424e['toFixed'](0x5)+_0x303056(0xff)+(_0xc1c41e?_0x303056(0x117):'OK')),_0x5c4b76[_0x303056(0xfc)](_0x303056(0xf8),{'val':_0xe1424e,'ack':!![]}),_0x5c4b76[_0x303056(0xfc)](_0x303056(0xf7),{'val':new Date()['toISOString'](),'ack':!![]});if(_0x5431e2)_0x5c4b76['setStateAsync'](_0x303056(0x107),{'val':_0x5431e2,'ack':!![]});if(_0xc1c41e){let _0x23f66a='UngewÃ¶hnliches\x20Bewegungsmuster!\x20(Score:\x20'+_0xe1424e[_0x303056(0xcb)](0x4)+')';if(_0x4e6b1b&&_0x4e6b1b!==_0x303056(0xdc))_0x23f66a+=_0x303056(0x105)+_0x4e6b1b;_0x5c4b76[_0x303056(0xfc)](_0x303056(0xfe),{'val':!![],'ack':!![]}),_0x5c4b76[_0x303056(0xfc)](_0x303056(0xfa),{'val':_0x23f66a,'ack':!![]}),setup[_0x303056(0x101)](_0x5c4b76,'âš ï¸\x20SECURITY\x20ALARM:\x20'+_0x23f66a,![],!![]);}}else{if(_0x4e93d2['type']===_0x303056(0xda)){const _0x42a4db=_0x4e93d2['payload']['details']||'',_0x2c8dbf=_0x4e93d2[_0x303056(0xd6)][_0x303056(0xe3)],_0x468a0a=_0x4e93d2[_0x303056(0xd6)]['success']?_0x303056(0x128)+new Date()[_0x303056(0xfb)]()+'\x20('+_0x42a4db+')':_0x303056(0x104)+_0x4e93d2['payload'][_0x303056(0xcc)];_0x5c4b76[_0x303056(0xfc)](_0x303056(0xde),{'val':_0x468a0a,'ack':!![]});if(_0x4e93d2[_0x303056(0xd6)][_0x303056(0x106)]&&_0x2c8dbf)_0x5c4b76['setStateAsync'](_0x303056(0x107),{'val':_0x2c8dbf,'ack':!![]});}else{if(_0x4e93d2[_0x303056(0x127)]===_0x303056(0x112)){const {patterns:_0x161cd8}=_0x4e93d2[_0x303056(0xd6)];if(_0x161cd8&&_0x161cd8[_0x303056(0x116)]>0x0){_0x5c4b76[_0x303056(0xed)][_0x303056(0x100)](_0x303056(0xdd)+_0x161cd8[_0x303056(0x116)]+_0x303056(0x11e)),_0x5c4b76['setStateAsync']('analysis.automation.detectedPatterns',{'val':JSON['stringify'](_0x161cd8),'ack':!![]});const _0xae65dc=_0x161cd8[0x0],_0x28aeec=_0x303056(0xc5)+_0xae65dc[_0x303056(0xe1)]+'\x20('+(_0xae65dc[_0x303056(0x114)]*0x64)[_0x303056(0xcb)](0x0)+'%)';_0x5c4b76[_0x303056(0xfc)](_0x303056(0xfd),{'val':!![],'ack':!![]}),_0x5c4b76[_0x303056(0xfc)](_0x303056(0xcf),{'val':_0x28aeec,'ack':!![]});}else _0x5c4b76[_0x303056(0xed)][_0x303056(0x100)](_0x303056(0xc7)),_0x5c4b76[_0x303056(0xfc)](_0x303056(0xfd),{'val':![],'ack':!![]}),_0x5c4b76['setStateAsync']('analysis.automation.detectedPatterns',{'val':'[]','ack':!![]});}else{if(_0x4e93d2[_0x303056(0x127)]===_0x303056(0xd0)){if(_0x4e93d2[_0x303056(0xd6)]['success'])try{const _0x57fbf6=JSON[_0x303056(0x111)](_0x4e93d2[_0x303056(0xd6)][_0x303056(0xe0)]);if(_0x57fbf6[_0x303056(0x10a)])_0x5c4b76[_0x303056(0xfc)](_0x303056(0xdb),{'val':JSON[_0x303056(0x11c)](_0x57fbf6[_0x303056(0x10a)]),'ack':!![]});if(_0x57fbf6['heating'])_0x5c4b76[_0x303056(0xfc)](_0x303056(0x109),{'val':JSON['stringify'](_0x57fbf6[_0x303056(0xe6)]),'ack':!![]});}catch(_0x1438bd){}}else{if(_0x4e93d2['type']===_0x303056(0xf5)){if(_0x4e93d2['payload'][_0x303056(0x106)])_0x5c4b76[_0x303056(0xed)][_0x303056(0x100)]('âœ…\x20HEALTH\x20TRAINED.');}else{if(_0x4e93d2['type']==='HEALTH_RESULT')_0x5c4b76[_0x303056(0xfc)](_0x303056(0xea),{'val':new Date()[_0x303056(0xc4)](),'ack':!![]}),_0x5c4b76[_0x303056(0xfc)](_0x303056(0xc6),{'val':_0x4e93d2['payload']['is_anomaly'],'ack':!![]});else{if(_0x4e93d2[_0x303056(0x127)]===_0x303056(0xe2))_0x5c4b76[_0x303056(0xfc)](_0x303056(0x115),{'val':_0x4e93d2['payload'][_0x303056(0x129)],'ack':!![]}),_0x5c4b76[_0x303056(0xfc)](_0x303056(0xe4),{'val':_0x4e93d2[_0x303056(0xd6)][_0x303056(0xf9)],'ack':!![]});else{if(_0x4e93d2[_0x303056(0x127)]===_0x303056(0x102)){const {speed_trend:_0x274518}=_0x4e93d2[_0x303056(0xd6)];if(_0x274518!==undefined)_0x5c4b76[_0x303056(0xfc)]('analysis.health.gaitSpeed',{'val':_0x274518,'ack':!![]});}else{if(_0x4e93d2[_0x303056(0x127)]==='ENERGY_PREDICT_RESULT'){const {forecast:_0x4c0b20}=_0x4e93d2[_0x303056(0xd6)];if(_0x4c0b20)_0x5c4b76['setStateAsync'](_0x303056(0x12a),{'val':JSON['stringify'](_0x4c0b20),'ack':!![]});}else{if(_0x4e93d2[_0x303056(0x127)]===_0x303056(0x11d)){const {data:_0x353cf5}=_0x4e93d2['payload'];_0x353cf5&&(_0x5c4b76[_0x303056(0xed)][_0x303056(0x100)](_0x303056(0xeb)),_0x5c4b76[_0x303056(0xfc)](_0x303056(0xd4),{'val':JSON[_0x303056(0x11c)](_0x353cf5),'ack':!![]}));}else{if(_0x4e93d2['type']===_0x303056(0x103))_0x5c4b76[_0x303056(0xed)][_0x303056(0x110)](_0x303056(0xc9));else{if(_0x4e93d2[_0x303056(0x127)]===_0x303056(0xca)){const {room:_0x463757,propagation:_0x58112c}=_0x4e93d2[_0x303056(0xd6)];let _0x2ccac2=_0x303056(0xdc),_0x14b9ad=0x0;if(_0x58112c){const _0x4a6604=Object['entries'](_0x58112c);_0x4a6604['length']>0x0&&(_0x2ccac2=_0x4a6604[0x0][0x0],_0x14b9ad=_0x4a6604[0x0][0x1]);}_0x5c4b76[_0x303056(0xfc)](_0x303056(0x10c),{'val':_0x2ccac2,'ack':!![]}),_0x5c4b76[_0x303056(0xfc)](_0x303056(0xee),{'val':_0x14b9ad,'ack':!![]}),_0x14b9ad>0.4&&_0x5c4b76[_0x303056(0xed)][_0x303056(0x110)](_0x303056(0xec)+_0x463757+_0x303056(0x123)+_0x2ccac2+'\x20('+(_0x14b9ad*0x64)[_0x303056(0xcb)](0x0)+'%)'),automation[_0x303056(0xf2)](_0x5c4b76,_0x2ccac2,_0x14b9ad);}}}}}}}}}}}}}}function a4_0x5f0d(){const _0x411d28=['reason','search','1270ktmAPf','analysis.automation.description','ENERGY_TRAIN_RESULT','[PYTHON]\x20','startsWith','join','analysis.security.topologyMatrix','python_service','payload','sendToPythonWrapper','toString','apply','TRAINING_COMPLETE','analysis.energy.insulationScore','Unknown','ðŸ›‹ï¸\x20BUTLER:\x20Found\x20','analysis.training.status','Error\x20launching\x20Python:\x20','details','rule','TREND_RESULT','threshold','analysis.health.trendValue','(((.+)+)+)+$','heating','exports','ðŸ›¡ï¸\x20SECURITY\x20CHECK:\x20Score\x20','3465216jAdxeH','analysis.health.lastCheck','ðŸ•¸ï¸\x20Topology\x20Map\x20updated\x20by\x20Python.','ðŸ”®\x20Prediction:\x20From\x20','log','analysis.prediction.confidence','51683kqudYY','6eQFkcL','substring','handlePrediction','stdout','trim','HEALTH_TRAIN_RESULT','forEach','analysis.security.lastCheck','analysis.security.lastScore','change_percent','analysis.alertReason','toLocaleTimeString','setStateAsync','analysis.automation.patternDetected','analysis.isAlert','\x20->\x20','info','sendNotification','GAIT_RESULT','TOPOLOGY_ACK','Failed:\x20','\x0aGrund:\x20','success','analysis.security.currentThreshold','path','analysis.energy.heatingScore','insulation','45qpfSty','analysis.prediction.nextRoom','1790216yhGQzq','[LOG]','8775585TiNPIA','debug','parse','COMFORT_RESULT','child_process','confidence','analysis.health.trendDiagnosis','length','ANOMALY','[RESULT]','ðŸ\x20Python\x20Pong','657068UCgCIs','stdin','stringify','TOPOLOGY_RESULT','\x20new\x20patterns.','python3','6SSyehF','existsSync','PONG','\x20->\x20Likely\x20','close','7262455tqwFfe','writable','type','Success:\x20','diagnosis','analysis.energy.forecast','write','data','toISOString','Regel\x20erkannt:\x20','analysis.health.isAnomaly','ðŸ›‹ï¸\x20BUTLER:\x20Keine\x20neuen\x20Muster\x20gefunden.','19954aGbuiN','ðŸ\x20Python\x20confirmed\x20new\x20topology.','SIGNAL_RESULT','toFixed'];a4_0x5f0d=function(){return _0x411d28;};return a4_0x5f0d();}function startService(_0x2c298e,_0x591af7){const _0x4efe1a=a4_0x4d3881;let _0x1cbec6=_0x4efe1a(0x11f);if(fs[_0x4efe1a(0x121)](_0x591af7))_0x1cbec6=_0x591af7;try{const _0x13b8c7=path[_0x4efe1a(0xd3)](__dirname,'..',_0x4efe1a(0xd5),'service.py');pythonProcess=spawn(_0x1cbec6,[_0x13b8c7]),pythonProcess[_0x4efe1a(0xf3)]['on'](_0x4efe1a(0xc3),_0x4f35bb=>{const _0x495109=_0x4efe1a,_0x3c8ddd=_0x4f35bb['toString']()['split']('\x0a');_0x3c8ddd[_0x495109(0xf6)](_0x3d5c74=>{const _0x39af6d=_0x495109,_0x3cb910=_0x3d5c74['trim']();if(!_0x3cb910)return;if(_0x3cb910[_0x39af6d(0xd2)](_0x39af6d(0x10e)))_0x2c298e['log'][_0x39af6d(0x110)](_0x39af6d(0xd1)+_0x3cb910[_0x39af6d(0xf1)](0x5)[_0x39af6d(0xf4)]());else{if(_0x3cb910['startsWith'](_0x39af6d(0x118)))try{const _0x35338d=JSON[_0x39af6d(0x111)](_0x3cb910[_0x39af6d(0xf1)](0x8)[_0x39af6d(0xf4)]());handleResult(_0x2c298e,_0x35338d);}catch(_0x585c14){}}});}),pythonProcess['on'](_0x4efe1a(0x124),_0x23abb8=>{pythonProcess=null;}),_0x2c298e[_0x4efe1a(0xd7)]=(_0x32a185,_0x502bcf)=>send(_0x2c298e,_0x32a185,_0x502bcf);}catch(_0x5a9fb9){_0x2c298e[_0x4efe1a(0xed)]['error'](_0x4efe1a(0xdf)+_0x5a9fb9['message']);}}function stopService(_0x1c29f5){if(pythonProcess){try{pythonProcess['kill']();}catch(_0x1a8675){}pythonProcess=null;}}module[a4_0x4d3881(0xe7)]={'startService':startService,'stopService':stopService,'send':send};