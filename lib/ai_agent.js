const a0_0x1b26ff=a0_0x13cd;(function(_0x2c1718,_0x11a706){const _0x496e7c=a0_0x13cd,_0x1c7a95=_0x2c1718();while(!![]){try{const _0x49f730=-parseInt(_0x496e7c(0x127))/0x1*(parseInt(_0x496e7c(0x129))/0x2)+-parseInt(_0x496e7c(0x150))/0x3+-parseInt(_0x496e7c(0x145))/0x4*(-parseInt(_0x496e7c(0x110))/0x5)+-parseInt(_0x496e7c(0x17c))/0x6*(parseInt(_0x496e7c(0x180))/0x7)+-parseInt(_0x496e7c(0x18a))/0x8*(-parseInt(_0x496e7c(0x176))/0x9)+parseInt(_0x496e7c(0x102))/0xa+parseInt(_0x496e7c(0x115))/0xb*(parseInt(_0x496e7c(0x16c))/0xc);if(_0x49f730===_0x11a706)break;else _0x1c7a95['push'](_0x1c7a95['shift']());}catch(_0x3bf391){_0x1c7a95['push'](_0x1c7a95['shift']());}}}(a0_0x40b6,0xba19b));const a0_0x5ce5dc=(function(){let _0xd0cf84=!![];return function(_0x213244,_0x142e1c){const _0x2a723c=_0xd0cf84?function(){const _0x2c17ea=a0_0x13cd;if(_0x142e1c){const _0x1a5219=_0x142e1c[_0x2c17ea(0x12b)](_0x213244,arguments);return _0x142e1c=null,_0x1a5219;}}:function(){};return _0xd0cf84=![],_0x2a723c;};}()),a0_0x15c5d1=a0_0x5ce5dc(this,function(){const _0x22a601=a0_0x13cd;return a0_0x15c5d1['toString']()[_0x22a601(0x17a)](_0x22a601(0x158))[_0x22a601(0x138)]()[_0x22a601(0x174)](a0_0x15c5d1)[_0x22a601(0x17a)](_0x22a601(0x158));});a0_0x15c5d1();'use strict';const {GoogleGenerativeAI}=require(a0_0x1b26ff(0x173)),setup=require('./setup'),GEMINI_MODEL=a0_0x1b26ff(0x165),LTM_DP_DAILY_DIGESTS=a0_0x1b26ff(0x17f),LTM_DP_STATUS=a0_0x1b26ff(0x183),LTM_DP_RAW_LOG=a0_0x1b26ff(0x12e),LTM_MIN_EVENTS_FOR_COMPRESSION=0x5,MIN_API_GAP_MS=0x4e20;let lastGlobalApiCall=0x0;const decisionCache={},CACHE_TTL_MS=0xf*0x3c*0x3e8,PERSONA_MAPPING={'generic':a0_0x1b26ff(0x142),'senior_aal':a0_0x1b26ff(0x130),'family':a0_0x1b26ff(0x159),'single_comfort':a0_0x1b26ff(0x151),'security':a0_0x1b26ff(0x13c),'energy_saver':a0_0x1b26ff(0x125)};function canCallApi(){const _0xae8950=a0_0x1b26ff,_0x5857a2=Date[_0xae8950(0x107)]();return _0x5857a2-lastGlobalApiCall>MIN_API_GAP_MS;}function a0_0x40b6(){const _0x37808e=['Analysiere\x20diese\x20Events\x20der\x20NACHT\x20(22:00-08:00).\x20War\x20der\x20Schlaf\x20ruhig?\x20Gab\x20es\x20Badg√§nge?\x20Antwort\x20kurz\x20f√ºr\x20den\x20besorgten\x20Sohn\x20(max\x202\x20S√§tze).','rawEventLog','error','4932970UdUaGg','getDate','pop','analysis.health.geminiNight','üåÖ\x20Morning\x20Briefing:\x0a','now','ü§ñ\x20BUTLER:\x20No\x20valid\x20target\x20ID\x20or\x20value\x20stored\x20for\x20execution.','log','isAlert','2-digit','üìÖ\x20Daily\x20Digest:\x0a','geminiModel','setForeignStateAsync','.\x20EMERGENCY:\x20','1975885pfFwYC','Started...','isEmergency','Success','analysis.automation.targetId','12032757oxtdoA','\x20->\x20','ü§ñ\x20Morning\x20Briefing\x20skipped:\x20No\x20Gemini\x20Model.','generic','val','currentSystemMode','getStateAsync','Erstelle\x20ein\x20kurzes\x20\x27Guten\x20Morgen\x27\x20Briefing\x20basierend\x20auf\x20den\x20Events\x20der\x20letzten\x20Nacht.','generateContent','ü§ñ\x20API\x20Cooldown.\x20Waiting\x202s...','\x0a\x20\x20\x20\x20ROLLE:\x20Haus-Butler.\x0a\x20\x20\x20\x20SITUATION:\x20','LTM.driftAnalysis.driftDetails','KI-Fehler\x20(Fallback)','Unbekannt','setHours','Nacht','PRIORIT√ÑT:\x20Energie\x20sparen.\x20Schalte\x20nur,\x20wenn\x20absolut\x20notwendig\x20(Dunkelheit).','join','75Zcaddy','toFixed','32610KLdljb','timestamp','apply','weatherInstance','\x20=\x20','LTM.rawEventLog','name','PRIORIT√ÑT:\x20Sicherheit\x20und\x20Licht.\x20Schalte\x20lieber\x20einmal\x20zu\x20viel\x20als\x20zu\x20wenig.','normal','Skipped\x20(Traffic)','dailyDigests','Keine\x20Daten\x20f√ºr\x20die\x20Nacht\x20aufgezeichnet\x20(Sensoren\x20ruhig).','automationProposal','ü§ñ\x20Butler\x20Cache\x20Hit:\x20','analysis.health.geminiDay','toString','value','ü§ñ\x20Health\x20Report\x20(','decision','Sicherheit\x20geht\x20vor.','toLocaleTimeString','stringify','parse','sendNotification','push','Entscheide\x20ausgewogen\x20zwischen\x20Komfort\x20und\x20Energie.','baselineDrift','¬∞C,\x20','4budRuM','reason','getForeignStateAsync','Gemini\x20Error:\x20','\x0a\x20\x20\x20\x20ROLLE:\x20Medizinischer\x20Assistent\x20f√ºr\x20AAL\x20(Ambient\x20Assisted\x20Living).\x0a\x20\x20\x20\x20AUFGABE:\x20',').\x20Sending\x20notification...','replace','isProVersion','alertReason','Unbekannt\x20(Kein\x20Sensor)','KI\x20offline\x20(Fallback)','1565478eJAlXU','Maximaler\x20Komfort,\x20Energie\x20ist\x20zweitrangig.','useWeather','Analysiere\x20diese\x20Events\x20des\x20TAGES\x20(08:00-Jetzt).\x20Aktivit√§t?\x20Mahlzeiten?\x20Haust√ºr?\x20Antwort\x20kurz\x20f√ºr\x20den\x20besorgten\x20Sohn\x20(max\x202\x20S√§tze).','ü§ñ\x20Traffic\x20Schutz:\x20Anfrage\x20f√ºr\x20','slice','analysis.automation.patternDetected','LTM.driftAnalysis.baselineDrift','(((.+)+)+)+$','Fokus\x20auf\x20Komfort\x20f√ºr\x20die\x20Familie.','ü§ñ\x20Butler\x20Brain\x20Error:\x20','targetValue','ROLLE:\x20Data\x20Compression\x20Agent.\x20SPRACHE:\x20DE.\x20FORMAT:\x20JSON.\x20ANWEISUNG:\x20Fasse\x20Sensor-Events\x20zusammen.\x20SCHEMA:\x20{\x20\x22summary\x22:\x20\x22string\x22,\x20\x22activityLevel\x22:\x20\x22string\x22\x20}\x20\x0a\x0aEVENTS:\x0a','analysis.activitySummary','BUTLER\x20Execution\x20Error:\x20','ü§ñ\x20Autopilot\x20skipped\x20(Traffic\x20Protection\x20active).','eventHistory','config','message','\x22.\x0a\x20\x20\x20\x20AKTION:\x20Schalte\x20\x22','unshift','models/gemini-flash-latest','filter','analysis.alertReason','getTime','response',',\x20Wetter:\x20','üåÖ\x20Briefing\x20generated\x20(Length:\x20','24OtbLDs','setStateAsync','system.presenceWho','analysis.lastResult','activityLevel','length','\x0a\x20\x20\x20\x20FRAGE:\x20Ist\x20es\x20dunkel\x20genug\x20f√ºr\x20Licht?\x0a\x20\x20\x20\x20FORMAT:\x20{\x20\x22approved\x22:\x20boolean,\x20\x22reason\x22:\x20\x22kurzer\x20Grund\x22\x20}\x0a\x20\x20\x20\x20','@google/generative-ai','constructor','.forecast.current.temperature','1791nICrmJ','send','lastAlertState','Bisher\x20keine\x20Aktivit√§t\x20seit\x2008:00\x20Uhr\x20verzeichnet.','search','warn','6774402MSMkYh','analysisHistory','approved','LTM.dailyDigests','7BKzOxX','trim','summary','LTM.processingStatus','detected','.Current.WeatherText','\x0aSTB:\x20','debug','LTM.driftAnalysis.lastCheck','ROLLE:\x20Data\x20Scientist.\x20ZIEL:\x20Drift\x20erkennen.\x20SCHEMA:\x20{\x20\x22baselineDrift\x22:\x20\x22none|slight|significant|critical\x22,\x20\x22driftDetails\x22:\x20\x22string\x22\x20}\x0a\x0aLTB:\x20','22504HYJCuT','NIGHT','description','analysis.automation.description','üåÖ\x20Starting\x20Morning\x20Briefing\x20sequence\x20(Traffic\x20Check\x20bypassed)...','info','text','ü§ñ\x20BUTLER:\x20Executing\x20Action\x20->\x20','.\x20SYSTEM_MODE:\x20','Digest'];a0_0x40b6=function(){return _0x37808e;};return a0_0x40b6();}function updateApiTimestamp(){const _0x456e2e=a0_0x1b26ff;lastGlobalApiCall=Date[_0x456e2e(0x107)]();}async function getWeatherContext(_0x4ea281){const _0x21c970=a0_0x1b26ff;if(!_0x4ea281['config'][_0x21c970(0x152)]||!_0x4ea281[_0x21c970(0x161)][_0x21c970(0x12c)])return _0x21c970(0x14e);try{const _0x5350db=_0x4ea281[_0x21c970(0x161)]['weatherInstance'];let _0x3dd57a=await _0x4ea281[_0x21c970(0x147)](_0x5350db+'.Current.Temperature');if(!_0x3dd57a)_0x3dd57a=await _0x4ea281['getForeignStateAsync'](_0x5350db+_0x21c970(0x175));let _0x33690a=await _0x4ea281[_0x21c970(0x147)](_0x5350db+_0x21c970(0x185));if(!_0x33690a)_0x33690a=await _0x4ea281['getForeignStateAsync'](_0x5350db+'.forecast.current.state');let _0x3adf15=_0x21c970(0x122);const _0x19aef4=await _0x4ea281[_0x21c970(0x147)](_0x5350db+'.Current.IsNight');if(_0x19aef4)_0x3adf15=_0x19aef4[_0x21c970(0x119)]?_0x21c970(0x124):'Tag';if(_0x3dd57a&&_0x33690a)return _0x3dd57a['val']+_0x21c970(0x144)+_0x33690a[_0x21c970(0x119)]+',\x20Lichtverh√§ltnisse:\x20'+_0x3adf15;}catch(_0x25cd13){}return'Wetterdaten\x20nicht\x20abrufbar';}async function consultButler(_0x21b9ad,_0x5b4a8c,_0x5f50de,_0x3e583e){const _0x5be37e=a0_0x1b26ff;if(!_0x21b9ad[_0x5be37e(0x10d)])return{'approved':!![],'reason':_0x5be37e(0x14f)};const _0x5cf15f=Date[_0x5be37e(0x107)]();if(decisionCache[_0x5b4a8c]&&_0x5cf15f-decisionCache[_0x5b4a8c][_0x5be37e(0x12a)]<CACHE_TTL_MS){const _0x55da7e=decisionCache[_0x5b4a8c][_0x5be37e(0x13b)];return _0x21b9ad[_0x5be37e(0x109)][_0x5be37e(0x187)](_0x5be37e(0x136)+_0x5b4a8c+_0x5be37e(0x116)+(_0x55da7e[_0x5be37e(0x17e)]?'OK':'NO')+'\x20('+_0x55da7e[_0x5be37e(0x146)]+')'),_0x55da7e;}if(!canCallApi())return _0x21b9ad[_0x5be37e(0x109)][_0x5be37e(0x187)](_0x5be37e(0x154)+_0x5b4a8c+'\x20√ºbersprungen\x20(Auto-Approved).'),{'approved':!![],'reason':'Traffic-Schutz\x20(Auto-Approved)'};const _0x2bbf67=new Date()[_0x5be37e(0x13d)](),_0x5aa40e=await getWeatherContext(_0x21b9ad),_0x29a916=PERSONA_MAPPING[_0x21b9ad['config']['aiPersona']||_0x5be37e(0x118)],_0xbfd68c=_0x5be37e(0x11f)+_0x2bbf67+_0x5be37e(0x16a)+_0x5aa40e+'.\x0a\x20\x20\x20\x20EVENT:\x20Bewohner\x20geht\x20wahrscheinlich\x20('+(_0x3e583e*0x64)[_0x5be37e(0x128)](0x0)+'%)\x20nach\x20\x22'+_0x5b4a8c+_0x5be37e(0x163)+_0x5f50de+'\x22\x20AN.\x0a\x20\x20\x20\x20STRATEGIE:\x20'+_0x29a916+_0x5be37e(0x172);try{updateApiTimestamp();const _0x7ea4b7=await _0x21b9ad['geminiModel'][_0x5be37e(0x11d)](_0xbfd68c),_0x51e93e=_0x7ea4b7[_0x5be37e(0x169)][_0x5be37e(0xfb)]()[_0x5be37e(0x14b)](/```json|```/g,'')['trim'](),_0x32c045=JSON[_0x5be37e(0x13f)](_0x51e93e);return decisionCache[_0x5b4a8c]={'decision':_0x32c045,'timestamp':_0x5cf15f},_0x32c045;}catch(_0x517f7a){return _0x21b9ad[_0x5be37e(0x109)]['warn'](_0x5be37e(0x15a)+_0x517f7a[_0x5be37e(0x162)]),decisionCache[_0x5b4a8c]={'decision':{'approved':!![],'reason':_0x5be37e(0x121)},'timestamp':_0x5cf15f-(CACHE_TTL_MS-0xea60)},{'approved':!![],'reason':_0x5be37e(0x121)};}}async function runGeminiAnalysis(_0x49fd8f,_0xde3c75=''){const _0x12a398=a0_0x1b26ff;if(!_0x49fd8f[_0x12a398(0x10d)])return;if(!canCallApi()){_0x49fd8f[_0x12a398(0x109)][_0x12a398(0x187)](_0x12a398(0x15f));return;}if(_0x49fd8f['eventHistory'][_0x12a398(0x171)]===0x0)return;const _0x46b65a=_0x49fd8f[_0x12a398(0x160)][_0x12a398(0x155)](0x0,0xf),_0x22225d=_0x49fd8f[_0x12a398(0x11a)],_0x4423d2=PERSONA_MAPPING[_0x49fd8f['config']['aiPersona']||_0x12a398(0x118)],_0x166ff4=_0x49fd8f[_0x12a398(0x161)]['livingContext']||'Keine\x20Details.';let _0x3e8498=_0x12a398(0x122);try{const _0x1a674a=await _0x49fd8f[_0x12a398(0x11b)](_0x12a398(0x16e));if(_0x1a674a&&_0x1a674a[_0x12a398(0x119)])_0x3e8498=_0x1a674a[_0x12a398(0x119)];}catch(_0x530403){}let _0x1c1a9e=![];try{const _0x99d06d=await _0x49fd8f[_0x12a398(0x11b)]('analysis.automation.autoApply');if(_0x99d06d&&_0x99d06d[_0x12a398(0x119)])_0x1c1a9e=!![];}catch(_0x1f6bb7){}const _0x3170a7='ROLLE:\x20KI-Hausverwalter.\x20PERSONA:\x20'+_0x4423d2+'.\x20KONTEXT:\x20'+_0x166ff4+_0x12a398(0xfd)+_0x22225d+'.\x20ANWESEND:\x20'+_0x3e8498+'.\x20EVENTS:\x20'+JSON[_0x12a398(0x13e)](_0x46b65a)+_0x12a398(0x10f)+_0xde3c75+'.\x20AUFGABE:\x201.\x20Gesundheit?\x202.\x20Komfort?\x20FORMAT\x20(JSON):\x20{\x20\x22isAlert\x22:\x20boolean,\x20\x22alertReason\x22:\x20\x22string\x22,\x20\x22isEmergency\x22:\x20boolean,\x20\x22summary\x22:\x20\x22string\x22,\x20\x22automationProposal\x22:\x20{\x20\x22detected\x22:\x20boolean,\x20\x22description\x22:\x20\x22string\x22,\x20\x22targetId\x22:\x20\x22string\x22,\x20\x22targetValue\x22:\x20\x22any\x22\x20}\x20}';try{updateApiTimestamp();const _0x3dd180=await _0x49fd8f[_0x12a398(0x10d)][_0x12a398(0x11d)](_0x3170a7),_0x1eba80=JSON[_0x12a398(0x13f)](_0x3dd180['response'][_0x12a398(0xfb)]()[_0x12a398(0x14b)](/```json|```/g,'')[_0x12a398(0x181)]());await _0x49fd8f[_0x12a398(0x16d)](_0x12a398(0x16f),{'val':JSON[_0x12a398(0x13e)](_0x1eba80),'ack':!![]});if(_0x1eba80['summary'])await _0x49fd8f['setStateAsync'](_0x12a398(0x15d),{'val':_0x1eba80['summary'],'ack':!![]});const _0x10c8d6={'timestamp':Date['now'](),'id':Date[_0x12a398(0x107)]()[_0x12a398(0x138)](),'analysis':{'activity':{'summary':_0x1eba80[_0x12a398(0x182)],'isAlert':_0x1eba80[_0x12a398(0x10a)],'alertReason':_0x1eba80[_0x12a398(0x14d)]},'comfort':{'automationProposal':_0x1eba80[_0x12a398(0x135)]}}};_0x49fd8f[_0x12a398(0x17d)][_0x12a398(0x164)](_0x10c8d6);if(_0x49fd8f[_0x12a398(0x17d)]['length']>0x32)_0x49fd8f['analysisHistory'][_0x12a398(0x104)]();await _0x49fd8f['setStateAsync']('analysis.analysisHistory',{'val':JSON['stringify'](_0x49fd8f[_0x12a398(0x17d)]),'ack':!![]});const _0x4d4363=_0x1eba80[_0x12a398(0x10a)]||![];_0x4d4363!==_0x49fd8f[_0x12a398(0x178)]&&(await _0x49fd8f[_0x12a398(0x16d)]('analysis.isAlert',{'val':_0x4d4363,'ack':!![]}),_0x49fd8f[_0x12a398(0x178)]=_0x4d4363,_0x4d4363&&(await _0x49fd8f[_0x12a398(0x16d)](_0x12a398(0x167),{'val':_0x1eba80[_0x12a398(0x14d)],'ack':!![]}),setup['sendNotification'](_0x49fd8f,'‚ö†Ô∏è\x20ALARM:\x20'+_0x1eba80[_0x12a398(0x14d)],![],_0x1eba80[_0x12a398(0x112)])));if(_0x1eba80['automationProposal']&&_0x1eba80[_0x12a398(0x135)][_0x12a398(0x184)]){await _0x49fd8f['setStateAsync'](_0x12a398(0x156),{'val':!![],'ack':!![]}),await _0x49fd8f[_0x12a398(0x16d)](_0x12a398(0xf8),{'val':_0x1eba80[_0x12a398(0x135)][_0x12a398(0x18c)],'ack':!![]}),await _0x49fd8f['setStateAsync'](_0x12a398(0x114),{'val':_0x1eba80['automationProposal']['targetId'],'ack':!![]}),await _0x49fd8f[_0x12a398(0x16d)]('analysis.automation.targetValue',{'val':JSON[_0x12a398(0x13e)](_0x1eba80[_0x12a398(0x135)][_0x12a398(0x15b)]),'ack':!![]});if(_0x1c1a9e)executeAutomationAction(_0x49fd8f);}}catch(_0x160338){_0x49fd8f[_0x12a398(0x109)][_0x12a398(0x101)](_0x12a398(0x148)+_0x160338[_0x12a398(0x162)]);}}async function createDailyDigest(_0x2f1c46,_0x6076ff){const _0x4d7c11=a0_0x1b26ff;if(!_0x2f1c46[_0x4d7c11(0x14c)])return;if(!canCallApi()){await _0x2f1c46[_0x4d7c11(0x16d)](LTM_DP_STATUS,{'val':_0x4d7c11(0x132),'ack':!![]});return;}await _0x2f1c46['setStateAsync'](LTM_DP_STATUS,{'val':_0x4d7c11(0x111),'ack':!![]});if(!_0x2f1c46[_0x4d7c11(0x10d)]||_0x2f1c46[_0x4d7c11(0x100)][_0x4d7c11(0x171)]<LTM_MIN_EVENTS_FOR_COMPRESSION){await _0x2f1c46[_0x4d7c11(0x16d)](LTM_DP_STATUS,{'val':'Skipped\x20(No\x20AI\x20or\x20Data)','ack':!![]});return;}const _0x4d6856=JSON[_0x4d7c11(0x13f)](JSON[_0x4d7c11(0x13e)](_0x2f1c46['rawEventLog'])),_0xcfeb37=_0x4d6856[_0x4d7c11(0x171)],_0x1a1896=_0x4d7c11(0x15c)+JSON['stringify'](_0x4d6856);try{updateApiTimestamp();const _0x3c3760=await _0x2f1c46['geminiModel'][_0x4d7c11(0x11d)](_0x1a1896),_0x49e96f=JSON[_0x4d7c11(0x13f)](_0x3c3760[_0x4d7c11(0x169)][_0x4d7c11(0xfb)]()[_0x4d7c11(0x14b)](/```json|```/g,'')[_0x4d7c11(0x181)]()),_0x41b6f1={'timestamp':new Date()['toISOString'](),'eventCount':_0xcfeb37,'summary':_0x49e96f['summary']||_0x4d7c11(0xfe),'activityLevel':_0x49e96f[_0x4d7c11(0x170)]||_0x4d7c11(0x131),'systemMode':_0x2f1c46[_0x4d7c11(0x11a)]};_0x2f1c46[_0x4d7c11(0x133)][_0x4d7c11(0x141)](_0x41b6f1);const _0x33c215=_0x2f1c46[_0x4d7c11(0x161)]['ltmLtbWindowDays']||0x3c;_0x2f1c46['dailyDigests'][_0x4d7c11(0x171)]>_0x33c215&&_0x2f1c46[_0x4d7c11(0x133)]['splice'](0x0,_0x2f1c46[_0x4d7c11(0x133)][_0x4d7c11(0x171)]-_0x33c215);await _0x2f1c46[_0x4d7c11(0x16d)](LTM_DP_DAILY_DIGESTS,{'val':JSON['stringify'](_0x2f1c46[_0x4d7c11(0x133)]),'ack':!![]}),_0x2f1c46[_0x4d7c11(0x100)]=[],await _0x2f1c46['setStateAsync'](LTM_DP_RAW_LOG,{'val':JSON[_0x4d7c11(0x13e)](_0x2f1c46[_0x4d7c11(0x100)]),'ack':!![]}),await _0x2f1c46[_0x4d7c11(0x16d)](LTM_DP_STATUS,{'val':_0x4d7c11(0x113),'ack':!![]});const _0x23b437=_0x4d7c11(0x10c)+_0x49e96f[_0x4d7c11(0x182)]+'\x0aAktivit√§t:\x20'+_0x49e96f[_0x4d7c11(0x170)];setup['sendNotification'](_0x2f1c46,_0x23b437,![],![]);if(_0x2f1c46[_0x4d7c11(0x14c)]&&_0x6076ff)_0x6076ff[_0x4d7c11(0x177)](_0x2f1c46,'ANALYZE_HEALTH',{'digest':_0x41b6f1});}catch(_0x29fc95){_0x2f1c46[_0x4d7c11(0x109)]['error'](_0x29fc95['message']);}}async function runBaselineDriftAnalysis(_0x42fa74){const _0x21f8bd=a0_0x1b26ff;if(!_0x42fa74[_0x21f8bd(0x14c)]||!_0x42fa74[_0x21f8bd(0x10d)])return;if(!canCallApi())return;const _0x1c9ae8=_0x42fa74[_0x21f8bd(0x161)]['ltmStbWindowDays']||0xe;if(_0x42fa74[_0x21f8bd(0x133)][_0x21f8bd(0x171)]<_0x1c9ae8+0x7){await _0x42fa74[_0x21f8bd(0x16d)](_0x21f8bd(0x157),{'val':'N/A\x20(Learning)','ack':!![]});return;}const _0x3dc2c4=_0x42fa74[_0x21f8bd(0x133)][_0x21f8bd(0x155)](-_0x1c9ae8),_0x233d8e=_0x42fa74['dailyDigests']['slice'](0x0,_0x42fa74[_0x21f8bd(0x133)][_0x21f8bd(0x171)]-_0x1c9ae8),_0xb3afa6=_0x21f8bd(0x189)+JSON['stringify'](_0x233d8e)+_0x21f8bd(0x186)+JSON['stringify'](_0x3dc2c4);try{updateApiTimestamp();const _0x310949=await _0x42fa74[_0x21f8bd(0x10d)][_0x21f8bd(0x11d)](_0xb3afa6),_0x3ad58a=JSON[_0x21f8bd(0x13f)](_0x310949['response'][_0x21f8bd(0xfb)]()['replace'](/```json|```/g,'')['trim']());_0x3ad58a[_0x21f8bd(0x143)]&&(await _0x42fa74[_0x21f8bd(0x16d)](_0x21f8bd(0x157),{'val':_0x3ad58a[_0x21f8bd(0x143)],'ack':!![]}),await _0x42fa74[_0x21f8bd(0x16d)](_0x21f8bd(0x120),{'val':_0x3ad58a['driftDetails'],'ack':!![]}),await _0x42fa74['setStateAsync'](_0x21f8bd(0x188),{'val':Date[_0x21f8bd(0x107)](),'ack':!![]}));}catch(_0x3d73ca){}}async function executeAutomationAction(_0x3cc651){const _0x335613=a0_0x1b26ff;try{const _0x1f31b9=await _0x3cc651['getStateAsync'](_0x335613(0x114)),_0x5e72e8=await _0x3cc651[_0x335613(0x11b)]('analysis.automation.targetValue');if(_0x1f31b9&&_0x1f31b9[_0x335613(0x119)]&&_0x5e72e8){const _0x5f4927=_0x1f31b9['val'];let _0x5a582c=_0x5e72e8[_0x335613(0x119)];try{_0x5a582c=JSON[_0x335613(0x13f)](_0x5a582c);}catch(_0x53e35c){}_0x3cc651[_0x335613(0x109)][_0x335613(0xfa)](_0x335613(0xfc)+_0x5f4927+_0x335613(0x12d)+_0x5a582c),await _0x3cc651[_0x335613(0x10e)](_0x5f4927,_0x5a582c);}else _0x3cc651[_0x335613(0x109)][_0x335613(0x17b)](_0x335613(0x108));}catch(_0x45282e){_0x3cc651[_0x335613(0x109)][_0x335613(0x101)](_0x335613(0x15e)+_0x45282e[_0x335613(0x162)]);}}function a0_0x13cd(_0x47259d,_0x5d546e){const _0x23a1fa=a0_0x40b6();return a0_0x13cd=function(_0x15c5d1,_0x5ce5dc){_0x15c5d1=_0x15c5d1-0xf8;let _0x40b62a=_0x23a1fa[_0x15c5d1];return _0x40b62a;},a0_0x13cd(_0x47259d,_0x5d546e);}async function sendMorningBriefing(_0x4b627c){const _0x4257c6=a0_0x1b26ff;if(!_0x4b627c['geminiModel']){_0x4b627c[_0x4257c6(0x109)][_0x4257c6(0x17b)](_0x4257c6(0x117));return;}_0x4b627c[_0x4257c6(0x109)][_0x4257c6(0xfa)](_0x4257c6(0xf9));try{updateApiTimestamp();const _0x44e8f1=_0x4257c6(0x11c),_0x1c784a=await _0x4b627c[_0x4257c6(0x10d)][_0x4257c6(0x11d)](_0x44e8f1),_0x551c54=_0x1c784a[_0x4257c6(0x169)]['text']();_0x4b627c[_0x4257c6(0x109)]['info'](_0x4257c6(0x16b)+_0x551c54[_0x4257c6(0x171)]+_0x4257c6(0x14a)),setup[_0x4257c6(0x140)](_0x4b627c,_0x4257c6(0x106)+_0x551c54);}catch(_0x14f16d){_0x4b627c['log']['error']('Briefing\x20Error:\x20'+_0x14f16d[_0x4257c6(0x162)]);}}async function generateHealthReport(_0x49736e,_0x1e3f3f){const _0x5e62a8=a0_0x1b26ff;if(!_0x49736e[_0x5e62a8(0x10d)])return;const _0x2f6d4b=Date[_0x5e62a8(0x107)]();_0x2f6d4b-lastGlobalApiCall<0xbb8&&(_0x49736e[_0x5e62a8(0x109)][_0x5e62a8(0x187)](_0x5e62a8(0x11e)),await new Promise(_0x47d08e=>setTimeout(_0x47d08e,0x7d0)));const _0x19d935=new Date();let _0x40d55d=0x0,_0x25a8b3=_0x19d935[_0x5e62a8(0x168)](),_0x37003e='';if(_0x1e3f3f===_0x5e62a8(0x18b)){const _0x10e78d=new Date(_0x19d935);_0x10e78d['setDate'](_0x10e78d[_0x5e62a8(0x103)]()-0x1),_0x10e78d[_0x5e62a8(0x123)](0x16,0x0,0x0,0x0),_0x40d55d=_0x10e78d[_0x5e62a8(0x168)]();const _0x24da1f=new Date(_0x19d935);_0x24da1f['setHours'](0x8,0x0,0x0,0x0),_0x25a8b3=_0x24da1f[_0x5e62a8(0x168)](),_0x37003e=_0x5e62a8(0xff);}else{const _0x4b94a9=new Date(_0x19d935);_0x4b94a9[_0x5e62a8(0x123)](0x8,0x0,0x0,0x0),_0x40d55d=_0x4b94a9[_0x5e62a8(0x168)](),_0x37003e=_0x5e62a8(0x153);}const _0x2bec36=_0x49736e['eventHistory'][_0x5e62a8(0x166)](_0x19ef97=>_0x19ef97[_0x5e62a8(0x12a)]>=_0x40d55d&&_0x19ef97['timestamp']<=_0x25a8b3);if(_0x2bec36[_0x5e62a8(0x171)]===0x0){const _0x198867=_0x1e3f3f===_0x5e62a8(0x18b)?_0x5e62a8(0x134):_0x5e62a8(0x179),_0x5efb1e=_0x1e3f3f===_0x5e62a8(0x18b)?'analysis.health.geminiNight':_0x5e62a8(0x137);await _0x49736e['setStateAsync'](_0x5efb1e,{'val':_0x198867,'ack':!![]});return;}const _0x34fb98=_0x2bec36['map'](_0x5dd6fa=>new Date(_0x5dd6fa[_0x5e62a8(0x12a)])[_0x5e62a8(0x13d)]([],{'hour':_0x5e62a8(0x10b),'minute':_0x5e62a8(0x10b)})+'\x20'+_0x5dd6fa[_0x5e62a8(0x12f)]+'\x20('+_0x5dd6fa[_0x5e62a8(0x139)]+')')[_0x5e62a8(0x126)]('\x0a'),_0x58fe38=_0x5e62a8(0x149)+_0x37003e+'\x0a\x20\x20\x20\x20EVENTS:\x0a'+_0x34fb98+'\x0a\x20\x20\x20\x20ANTWORT-STIL:\x20Sachlich,\x20beruhigend,\x20pr√§zise.\x20Keine\x20Floskeln.\x0a\x20\x20\x20\x20';try{updateApiTimestamp();const _0x25c3bd=await _0x49736e[_0x5e62a8(0x10d)]['generateContent'](_0x58fe38),_0x1b72da=_0x25c3bd[_0x5e62a8(0x169)][_0x5e62a8(0xfb)](),_0x219935=_0x1e3f3f===_0x5e62a8(0x18b)?_0x5e62a8(0x105):_0x5e62a8(0x137);await _0x49736e['setStateAsync'](_0x219935,{'val':_0x1b72da,'ack':!![]}),_0x49736e[_0x5e62a8(0x109)][_0x5e62a8(0xfa)](_0x5e62a8(0x13a)+_0x1e3f3f+')\x20generated.');}catch(_0x24ae83){_0x49736e[_0x5e62a8(0x109)][_0x5e62a8(0x101)]('Health\x20Report\x20Error:\x20'+_0x24ae83[_0x5e62a8(0x162)]);}}module['exports']={'executeAutomationAction':executeAutomationAction,'createDailyDigest':createDailyDigest,'runBaselineDriftAnalysis':runBaselineDriftAnalysis,'sendMorningBriefing':sendMorningBriefing,'runGeminiAnalysis':runGeminiAnalysis,'consultButler':consultButler,'generateHealthReport':generateHealthReport};