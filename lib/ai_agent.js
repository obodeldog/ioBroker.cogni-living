const a0_0x1fcb37=a0_0x91b8;(function(_0x2ce3ed,_0x38681d){const _0x37a210=a0_0x91b8,_0x4be522=_0x2ce3ed();while(!![]){try{const _0x7d467f=-parseInt(_0x37a210(0xe2))/0x1+-parseInt(_0x37a210(0x11e))/0x2*(parseInt(_0x37a210(0xc3))/0x3)+parseInt(_0x37a210(0xd8))/0x4+parseInt(_0x37a210(0x154))/0x5+-parseInt(_0x37a210(0x123))/0x6*(parseInt(_0x37a210(0xc5))/0x7)+-parseInt(_0x37a210(0xd3))/0x8+parseInt(_0x37a210(0xc7))/0x9;if(_0x7d467f===_0x38681d)break;else _0x4be522['push'](_0x4be522['shift']());}catch(_0x557ba5){_0x4be522['push'](_0x4be522['shift']());}}}(a0_0x47da,0x8877b));const a0_0x2bb8df=(function(){let _0x4e0756=!![];return function(_0x2b9f8a,_0x2558a0){const _0x223251=_0x4e0756?function(){if(_0x2558a0){const _0x135f9f=_0x2558a0['apply'](_0x2b9f8a,arguments);return _0x2558a0=null,_0x135f9f;}}:function(){};return _0x4e0756=![],_0x223251;};}()),a0_0x48bc4f=a0_0x2bb8df(this,function(){const _0x35a293=a0_0x91b8;return a0_0x48bc4f['toString']()[_0x35a293(0xca)](_0x35a293(0xdf))[_0x35a293(0x12a)]()[_0x35a293(0xd5)](a0_0x48bc4f)['search'](_0x35a293(0xdf));});a0_0x48bc4f();'use strict';const {GoogleGenerativeAI}=require(a0_0x1fcb37(0xcd)),setup=require(a0_0x1fcb37(0xe4)),GEMINI_MODEL=a0_0x1fcb37(0x10d),LTM_DP_DAILY_DIGESTS=a0_0x1fcb37(0x12e),LTM_DP_STATUS=a0_0x1fcb37(0xd4),LTM_DP_RAW_LOG=a0_0x1fcb37(0xf7),LTM_MIN_EVENTS_FOR_COMPRESSION=0x5,MIN_API_GAP_MS=0x4e20;function a0_0x91b8(_0x4c88fe,_0x1fa9d7){const _0x22f709=a0_0x47da();return a0_0x91b8=function(_0x48bc4f,_0x2bb8df){_0x48bc4f=_0x48bc4f-0xbb;let _0x47da77=_0x22f709[_0x48bc4f];return _0x47da77;},a0_0x91b8(_0x4c88fe,_0x1fa9d7);}let lastGlobalApiCall=0x0;const decisionCache={},CACHE_TTL_MS=0xf*0x3c*0x3e8,PERSONA_MAPPING={'generic':a0_0x1fcb37(0x111),'senior_aal':'PRIORITÃ„T:\x20Sicherheit\x20und\x20Licht.\x20Schalte\x20lieber\x20einmal\x20zu\x20viel\x20als\x20zu\x20wenig.','family':'Fokus\x20auf\x20Komfort\x20fÃ¼r\x20die\x20Familie.','single_comfort':'Maximaler\x20Komfort,\x20Energie\x20ist\x20zweitrangig.','security':'Sicherheit\x20geht\x20vor.','energy_saver':a0_0x1fcb37(0x150)};function canCallApi(){const _0x40568d=Date['now']();return _0x40568d-lastGlobalApiCall>MIN_API_GAP_MS;}function updateApiTimestamp(){const _0x1c2e40=a0_0x1fcb37;lastGlobalApiCall=Date[_0x1c2e40(0x11a)]();}function a0_0x47da(){const _0x5114f0=['analysis.automation.patternDetected','.\x20EVENTS:\x20','LTM.dailyDigests','KI-Fehler\x20(Fallback)','ltmStbWindowDays','LTM.driftAnalysis.driftDetails','description','generic','\x0a\x20\x20\x20\x20EVENTS:\x0a','getTime','approved','Skipped\x20(No\x20AI\x20or\x20Data)','2-digit','ROLLE:\x20KI-Hausverwalter.\x20PERSONA:\x20','Keine\x20Details.','reason','.forecast.current.temperature','analysis.automation.autoApply','.Current.WeatherText','\x0a\x20\x20\x20\x20FRAGE:\x20Ist\x20es\x20dunkel\x20genug\x20fÃ¼r\x20Licht?\x0a\x20\x20\x20\x20FORMAT:\x20{\x20\x22approved\x22:\x20boolean,\x20\x22reason\x22:\x20\x22kurzer\x20Grund\x22\x20}\x0a\x20\x20\x20\x20','LTM.driftAnalysis.lastCheck',',\x20LichtverhÃ¤ltnisse:\x20','timestamp','NIGHT','analysis.isAlert','.forecast.current.state','Gemini\x20Error:\x20','config','\x0aSTB:\x20','info','ðŸ¤–\x20Butler\x20Cache\x20Hit:\x20','isProVersion','log','LTM.driftAnalysis.baselineDrift','name',',\x20Wetter:\x20','PRIORITÃ„T:\x20Energie\x20sparen.\x20Schalte\x20nur,\x20wenn\x20absolut\x20notwendig\x20(Dunkelheit).','\x0a\x20\x20\x20\x20ROLLE:\x20Haus-Butler.\x0a\x20\x20\x20\x20SITUATION:\x20','Keine\x20Daten\x20fÃ¼r\x20die\x20Nacht\x20aufgezeichnet\x20(Sensoren\x20ruhig).','lastAlertState','1871130wCdwhk','getStateAsync','.\x20SYSTEM_MODE:\x20','message','Success','join','ðŸŒ…\x20Briefing\x20generated\x20(Length:\x20','.Current.IsNight','text','analysis.automation.targetId','useWeather','system.presenceWho','744sOrwKT',')\x20generated.','23919ziwWUu','ðŸ¤–\x20Morning\x20Briefing\x20skipped:\x20No\x20Gemini\x20Model.','19321839CQbrtE','\x22.\x0a\x20\x20\x20\x20AKTION:\x20Schalte\x20\x22','error','search','\x22\x20AN.\x0a\x20\x20\x20\x20STRATEGIE:\x20','Digest','@google/generative-ai','push','ðŸ¤–\x20BUTLER:\x20No\x20valid\x20target\x20ID\x20or\x20value\x20stored\x20for\x20execution.','N/A\x20(Learning)','currentSystemMode','warn','6329712EIdfbL','LTM.processingStatus','constructor','ANALYZE_HEALTH','setDate','1921820EjNGLH','dailyDigests','send','Analysiere\x20diese\x20Events\x20des\x20TAGES\x20(08:00-Jetzt).\x20AktivitÃ¤t?\x20Mahlzeiten?\x20HaustÃ¼r?\x20Antwort\x20kurz\x20fÃ¼r\x20den\x20besorgten\x20Sohn\x20(max\x202\x20SÃ¤tze).','debug','Briefing\x20Error:\x20','isAlert','(((.+)+)+)+$','setHours','toLocaleTimeString','772324zrZToL','Â°C,\x20','./setup','normal','driftDetails','âš ï¸\x20ALARM:\x20','\x0aAktivitÃ¤t:\x20','analysis.activitySummary','ROLLE:\x20Data\x20Scientist.\x20ZIEL:\x20Drift\x20erkennen.\x20SCHEMA:\x20{\x20\x22baselineDrift\x22:\x20\x22none|slight|significant|critical\x22,\x20\x22driftDetails\x22:\x20\x22string\x22\x20}\x0a\x0aLTB:\x20','weatherInstance','stringify','getDate','\x0a\x20\x20\x20\x20ANTWORT-STIL:\x20Sachlich,\x20beruhigend,\x20prÃ¤zise.\x20Keine\x20Floskeln.\x0a\x20\x20\x20\x20','analysis.automation.targetValue','map','trim','.\x20ANWESEND:\x20','detected','rawEventLog','setForeignStateAsync','\x20=\x20','LTM.rawEventLog','decision','Tag','.\x20EMERGENCY:\x20','analysis.alertReason','analysis.health.geminiNight','analysis.analysisHistory','Skipped\x20(Traffic)','Bisher\x20keine\x20AktivitÃ¤t\x20seit\x2008:00\x20Uhr\x20verzeichnet.','parse','isEmergency','Traffic-Schutz\x20(Auto-Approved)','value','generateContent','%)\x20nach\x20\x22','targetId','analysis.lastResult','ltmLtbWindowDays','replace','alertReason','val','Nacht','models/gemini-flash-latest','exports','toISOString','length','Entscheide\x20ausgewogen\x20zwischen\x20Komfort\x20und\x20Energie.','analysisHistory','.\x20KONTEXT:\x20','setStateAsync','automationProposal','sendNotification','Erstelle\x20ein\x20kurzes\x20\x27Guten\x20Morgen\x27\x20Briefing\x20basierend\x20auf\x20den\x20Events\x20der\x20letzten\x20Nacht.','aiPersona','activityLevel','now','slice','ðŸ¤–\x20BUTLER:\x20Executing\x20Action\x20->\x20','ðŸ¤–\x20Health\x20Report\x20(','1936igXXYz','getForeignStateAsync','Unbekannt','response','analysis.health.geminiDay','1122DsXtUI','livingContext','geminiModel','Started...','Unbekannt\x20(Kein\x20Sensor)','eventHistory','summary','toString','KI\x20offline\x20(Fallback)'];a0_0x47da=function(){return _0x5114f0;};return a0_0x47da();}async function getWeatherContext(_0x14115d){const _0x5cb7d9=a0_0x1fcb37;if(!_0x14115d['config'][_0x5cb7d9(0xc1)]||!_0x14115d['config'][_0x5cb7d9(0xeb)])return _0x5cb7d9(0x127);try{const _0xeb1186=_0x14115d['config']['weatherInstance'];let _0x2b4cf7=await _0x14115d[_0x5cb7d9(0x11f)](_0xeb1186+'.Current.Temperature');if(!_0x2b4cf7)_0x2b4cf7=await _0x14115d[_0x5cb7d9(0x11f)](_0xeb1186+_0x5cb7d9(0x13c));let _0x40b725=await _0x14115d[_0x5cb7d9(0x11f)](_0xeb1186+_0x5cb7d9(0x13e));if(!_0x40b725)_0x40b725=await _0x14115d[_0x5cb7d9(0x11f)](_0xeb1186+_0x5cb7d9(0x145));let _0x14271c=_0x5cb7d9(0x120);const _0x284539=await _0x14115d['getForeignStateAsync'](_0xeb1186+_0x5cb7d9(0xbe));if(_0x284539)_0x14271c=_0x284539[_0x5cb7d9(0x10b)]?_0x5cb7d9(0x10c):_0x5cb7d9(0xf9);if(_0x2b4cf7&&_0x40b725)return _0x2b4cf7['val']+_0x5cb7d9(0xe3)+_0x40b725[_0x5cb7d9(0x10b)]+_0x5cb7d9(0x141)+_0x14271c;}catch(_0x58de5d){}return'Wetterdaten\x20nicht\x20abrufbar';}async function consultButler(_0x5cfef6,_0x1f77e5,_0x5e00f0,_0x393026){const _0x21490e=a0_0x1fcb37;if(!_0x5cfef6[_0x21490e(0x125)])return{'approved':!![],'reason':_0x21490e(0x12b)};const _0x5639b7=Date[_0x21490e(0x11a)]();if(decisionCache[_0x1f77e5]&&_0x5639b7-decisionCache[_0x1f77e5][_0x21490e(0x142)]<CACHE_TTL_MS){const _0x12da6a=decisionCache[_0x1f77e5][_0x21490e(0xf8)];return _0x5cfef6[_0x21490e(0x14c)][_0x21490e(0xdc)](_0x21490e(0x14a)+_0x1f77e5+'\x20->\x20'+(_0x12da6a[_0x21490e(0x136)]?'OK':'NO')+'\x20('+_0x12da6a[_0x21490e(0x13b)]+')'),_0x12da6a;}if(!canCallApi())return _0x5cfef6[_0x21490e(0x14c)][_0x21490e(0xdc)]('ðŸ¤–\x20Traffic\x20Schutz:\x20Anfrage\x20fÃ¼r\x20'+_0x1f77e5+'\x20Ã¼bersprungen\x20(Auto-Approved).'),{'approved':!![],'reason':_0x21490e(0x102)};const _0x42c13e=new Date()[_0x21490e(0xe1)](),_0x5e0062=await getWeatherContext(_0x5cfef6),_0x54177d=PERSONA_MAPPING[_0x5cfef6[_0x21490e(0x147)][_0x21490e(0x118)]||_0x21490e(0x133)],_0xf8be2c=_0x21490e(0x151)+_0x42c13e+_0x21490e(0x14f)+_0x5e0062+'.\x0a\x20\x20\x20\x20EVENT:\x20Bewohner\x20geht\x20wahrscheinlich\x20('+(_0x393026*0x64)['toFixed'](0x0)+_0x21490e(0x105)+_0x1f77e5+_0x21490e(0xc8)+_0x5e00f0+_0x21490e(0xcb)+_0x54177d+_0x21490e(0x13f);try{updateApiTimestamp();const _0x2223ee=await _0x5cfef6[_0x21490e(0x125)]['generateContent'](_0xf8be2c),_0x29ebd5=_0x2223ee['response'][_0x21490e(0xbf)]()[_0x21490e(0x109)](/```json|```/g,'')[_0x21490e(0xf1)](),_0x1f5d0b=JSON[_0x21490e(0x100)](_0x29ebd5);return decisionCache[_0x1f77e5]={'decision':_0x1f5d0b,'timestamp':_0x5639b7},_0x1f5d0b;}catch(_0x91c8b3){return _0x5cfef6[_0x21490e(0x14c)][_0x21490e(0xd2)]('ðŸ¤–\x20Butler\x20Brain\x20Error:\x20'+_0x91c8b3[_0x21490e(0x157)]),decisionCache[_0x1f77e5]={'decision':{'approved':!![],'reason':'KI-Fehler\x20(Fallback)'},'timestamp':_0x5639b7-(CACHE_TTL_MS-0xea60)},{'approved':!![],'reason':_0x21490e(0x12f)};}}async function runGeminiAnalysis(_0x5f01a9,_0x3f1b27=''){const _0x3b9ba7=a0_0x1fcb37;if(!_0x5f01a9[_0x3b9ba7(0x125)])return;if(!canCallApi()){_0x5f01a9[_0x3b9ba7(0x14c)][_0x3b9ba7(0xdc)]('ðŸ¤–\x20Autopilot\x20skipped\x20(Traffic\x20Protection\x20active).');return;}if(_0x5f01a9[_0x3b9ba7(0x128)][_0x3b9ba7(0x110)]===0x0)return;const _0x58afd8=_0x5f01a9[_0x3b9ba7(0x128)][_0x3b9ba7(0x11b)](0x0,0xf),_0x473485=_0x5f01a9[_0x3b9ba7(0xd1)],_0x20fd5b=PERSONA_MAPPING[_0x5f01a9['config'][_0x3b9ba7(0x118)]||'generic'],_0x3ba2d0=_0x5f01a9['config'][_0x3b9ba7(0x124)]||_0x3b9ba7(0x13a);let _0x28c9ae=_0x3b9ba7(0x120);try{const _0x1e37d3=await _0x5f01a9[_0x3b9ba7(0x155)](_0x3b9ba7(0xc2));if(_0x1e37d3&&_0x1e37d3[_0x3b9ba7(0x10b)])_0x28c9ae=_0x1e37d3['val'];}catch(_0x4d33f9){}let _0xc2529c=![];try{const _0x5e078=await _0x5f01a9['getStateAsync'](_0x3b9ba7(0x13d));if(_0x5e078&&_0x5e078['val'])_0xc2529c=!![];}catch(_0x3e2856){}const _0x1a3789=_0x3b9ba7(0x139)+_0x20fd5b+_0x3b9ba7(0x113)+_0x3ba2d0+_0x3b9ba7(0x156)+_0x473485+_0x3b9ba7(0xf2)+_0x28c9ae+_0x3b9ba7(0x12d)+JSON['stringify'](_0x58afd8)+_0x3b9ba7(0xfa)+_0x3f1b27+'.\x20AUFGABE:\x201.\x20Gesundheit?\x202.\x20Komfort?\x20FORMAT\x20(JSON):\x20{\x20\x22isAlert\x22:\x20boolean,\x20\x22alertReason\x22:\x20\x22string\x22,\x20\x22isEmergency\x22:\x20boolean,\x20\x22summary\x22:\x20\x22string\x22,\x20\x22automationProposal\x22:\x20{\x20\x22detected\x22:\x20boolean,\x20\x22description\x22:\x20\x22string\x22,\x20\x22targetId\x22:\x20\x22string\x22,\x20\x22targetValue\x22:\x20\x22any\x22\x20}\x20}';try{updateApiTimestamp();const _0x2cddbb=await _0x5f01a9[_0x3b9ba7(0x125)][_0x3b9ba7(0x104)](_0x1a3789),_0x34a0f7=JSON[_0x3b9ba7(0x100)](_0x2cddbb['response'][_0x3b9ba7(0xbf)]()['replace'](/```json|```/g,'')[_0x3b9ba7(0xf1)]());await _0x5f01a9['setStateAsync'](_0x3b9ba7(0x107),{'val':JSON[_0x3b9ba7(0xec)](_0x34a0f7),'ack':!![]});if(_0x34a0f7[_0x3b9ba7(0x129)])await _0x5f01a9['setStateAsync'](_0x3b9ba7(0xe9),{'val':_0x34a0f7[_0x3b9ba7(0x129)],'ack':!![]});const _0x476234={'timestamp':Date[_0x3b9ba7(0x11a)](),'id':Date[_0x3b9ba7(0x11a)]()[_0x3b9ba7(0x12a)](),'analysis':{'activity':{'summary':_0x34a0f7[_0x3b9ba7(0x129)],'isAlert':_0x34a0f7[_0x3b9ba7(0xde)],'alertReason':_0x34a0f7[_0x3b9ba7(0x10a)]},'comfort':{'automationProposal':_0x34a0f7[_0x3b9ba7(0x115)]}}};_0x5f01a9['analysisHistory']['unshift'](_0x476234);if(_0x5f01a9[_0x3b9ba7(0x112)][_0x3b9ba7(0x110)]>0x32)_0x5f01a9[_0x3b9ba7(0x112)]['pop']();await _0x5f01a9[_0x3b9ba7(0x114)](_0x3b9ba7(0xfd),{'val':JSON[_0x3b9ba7(0xec)](_0x5f01a9[_0x3b9ba7(0x112)]),'ack':!![]});const _0x542950=_0x34a0f7[_0x3b9ba7(0xde)]||![];_0x542950!==_0x5f01a9[_0x3b9ba7(0x153)]&&(await _0x5f01a9['setStateAsync'](_0x3b9ba7(0x144),{'val':_0x542950,'ack':!![]}),_0x5f01a9[_0x3b9ba7(0x153)]=_0x542950,_0x542950&&(await _0x5f01a9[_0x3b9ba7(0x114)](_0x3b9ba7(0xfb),{'val':_0x34a0f7['alertReason'],'ack':!![]}),setup[_0x3b9ba7(0x116)](_0x5f01a9,_0x3b9ba7(0xe7)+_0x34a0f7[_0x3b9ba7(0x10a)],![],_0x34a0f7[_0x3b9ba7(0x101)])));if(_0x34a0f7['automationProposal']&&_0x34a0f7[_0x3b9ba7(0x115)][_0x3b9ba7(0xf3)]){await _0x5f01a9['setStateAsync'](_0x3b9ba7(0x12c),{'val':!![],'ack':!![]}),await _0x5f01a9[_0x3b9ba7(0x114)]('analysis.automation.description',{'val':_0x34a0f7[_0x3b9ba7(0x115)][_0x3b9ba7(0x132)],'ack':!![]}),await _0x5f01a9['setStateAsync'](_0x3b9ba7(0xc0),{'val':_0x34a0f7[_0x3b9ba7(0x115)][_0x3b9ba7(0x106)],'ack':!![]}),await _0x5f01a9[_0x3b9ba7(0x114)](_0x3b9ba7(0xef),{'val':JSON['stringify'](_0x34a0f7[_0x3b9ba7(0x115)]['targetValue']),'ack':!![]});if(_0xc2529c)executeAutomationAction(_0x5f01a9);}}catch(_0x262554){_0x5f01a9['log'][_0x3b9ba7(0xc9)](_0x3b9ba7(0x146)+_0x262554[_0x3b9ba7(0x157)]);}}async function createDailyDigest(_0x1e4105,_0x45a3e3){const _0x1935db=a0_0x1fcb37;if(!_0x1e4105[_0x1935db(0x14b)])return;if(!canCallApi()){await _0x1e4105[_0x1935db(0x114)](LTM_DP_STATUS,{'val':_0x1935db(0xfe),'ack':!![]});return;}await _0x1e4105[_0x1935db(0x114)](LTM_DP_STATUS,{'val':_0x1935db(0x126),'ack':!![]});if(!_0x1e4105[_0x1935db(0x125)]||_0x1e4105[_0x1935db(0xf4)][_0x1935db(0x110)]<LTM_MIN_EVENTS_FOR_COMPRESSION){await _0x1e4105['setStateAsync'](LTM_DP_STATUS,{'val':_0x1935db(0x137),'ack':!![]});return;}const _0x158d69=JSON[_0x1935db(0x100)](JSON[_0x1935db(0xec)](_0x1e4105[_0x1935db(0xf4)])),_0x4e9f64=_0x158d69[_0x1935db(0x110)],_0xc291ec='ROLLE:\x20Data\x20Compression\x20Agent.\x20SPRACHE:\x20DE.\x20FORMAT:\x20JSON.\x20ANWEISUNG:\x20Fasse\x20Sensor-Events\x20zusammen.\x20SCHEMA:\x20{\x20\x22summary\x22:\x20\x22string\x22,\x20\x22activityLevel\x22:\x20\x22string\x22\x20}\x20\x0a\x0aEVENTS:\x0a'+JSON[_0x1935db(0xec)](_0x158d69);try{updateApiTimestamp();const _0x4535e5=await _0x1e4105['geminiModel'][_0x1935db(0x104)](_0xc291ec),_0x50d600=JSON[_0x1935db(0x100)](_0x4535e5[_0x1935db(0x121)][_0x1935db(0xbf)]()[_0x1935db(0x109)](/```json|```/g,'')[_0x1935db(0xf1)]()),_0x2f587c={'timestamp':new Date()[_0x1935db(0x10f)](),'eventCount':_0x4e9f64,'summary':_0x50d600[_0x1935db(0x129)]||_0x1935db(0xcc),'activityLevel':_0x50d600[_0x1935db(0x119)]||_0x1935db(0xe5),'systemMode':_0x1e4105[_0x1935db(0xd1)]};_0x1e4105[_0x1935db(0xd9)][_0x1935db(0xce)](_0x2f587c);const _0x38b22b=_0x1e4105[_0x1935db(0x147)][_0x1935db(0x108)]||0x3c;_0x1e4105['dailyDigests'][_0x1935db(0x110)]>_0x38b22b&&_0x1e4105[_0x1935db(0xd9)]['splice'](0x0,_0x1e4105[_0x1935db(0xd9)]['length']-_0x38b22b);await _0x1e4105['setStateAsync'](LTM_DP_DAILY_DIGESTS,{'val':JSON[_0x1935db(0xec)](_0x1e4105[_0x1935db(0xd9)]),'ack':!![]}),_0x1e4105[_0x1935db(0xf4)]=[],await _0x1e4105[_0x1935db(0x114)](LTM_DP_RAW_LOG,{'val':JSON[_0x1935db(0xec)](_0x1e4105[_0x1935db(0xf4)]),'ack':!![]}),await _0x1e4105[_0x1935db(0x114)](LTM_DP_STATUS,{'val':_0x1935db(0xbb),'ack':!![]});const _0x370ffe='ðŸ“…\x20Daily\x20Digest:\x0a'+_0x50d600['summary']+_0x1935db(0xe8)+_0x50d600[_0x1935db(0x119)];setup[_0x1935db(0x116)](_0x1e4105,_0x370ffe,![],![]);if(_0x1e4105[_0x1935db(0x14b)]&&_0x45a3e3)_0x45a3e3[_0x1935db(0xda)](_0x1e4105,_0x1935db(0xd6),{'digest':_0x2f587c});}catch(_0x9b03e4){_0x1e4105[_0x1935db(0x14c)][_0x1935db(0xc9)](_0x9b03e4['message']);}}async function runBaselineDriftAnalysis(_0x6d13ae){const _0x2d5141=a0_0x1fcb37;if(!_0x6d13ae['isProVersion']||!_0x6d13ae[_0x2d5141(0x125)])return;if(!canCallApi())return;const _0x5ba280=_0x6d13ae[_0x2d5141(0x147)][_0x2d5141(0x130)]||0xe;if(_0x6d13ae[_0x2d5141(0xd9)][_0x2d5141(0x110)]<_0x5ba280+0x7){await _0x6d13ae[_0x2d5141(0x114)](_0x2d5141(0x14d),{'val':_0x2d5141(0xd0),'ack':!![]});return;}const _0x570ac8=_0x6d13ae['dailyDigests'][_0x2d5141(0x11b)](-_0x5ba280),_0x251dfc=_0x6d13ae[_0x2d5141(0xd9)][_0x2d5141(0x11b)](0x0,_0x6d13ae[_0x2d5141(0xd9)][_0x2d5141(0x110)]-_0x5ba280),_0x28cef5=_0x2d5141(0xea)+JSON['stringify'](_0x251dfc)+_0x2d5141(0x148)+JSON['stringify'](_0x570ac8);try{updateApiTimestamp();const _0x12cb76=await _0x6d13ae[_0x2d5141(0x125)][_0x2d5141(0x104)](_0x28cef5),_0x199915=JSON['parse'](_0x12cb76[_0x2d5141(0x121)][_0x2d5141(0xbf)]()[_0x2d5141(0x109)](/```json|```/g,'')[_0x2d5141(0xf1)]());_0x199915['baselineDrift']&&(await _0x6d13ae[_0x2d5141(0x114)](_0x2d5141(0x14d),{'val':_0x199915['baselineDrift'],'ack':!![]}),await _0x6d13ae[_0x2d5141(0x114)](_0x2d5141(0x131),{'val':_0x199915[_0x2d5141(0xe6)],'ack':!![]}),await _0x6d13ae['setStateAsync'](_0x2d5141(0x140),{'val':Date[_0x2d5141(0x11a)](),'ack':!![]}));}catch(_0x52a1a5){}}async function executeAutomationAction(_0x26ae8e){const _0x17b3ac=a0_0x1fcb37;try{const _0x5cea30=await _0x26ae8e[_0x17b3ac(0x155)](_0x17b3ac(0xc0)),_0x51b65c=await _0x26ae8e[_0x17b3ac(0x155)](_0x17b3ac(0xef));if(_0x5cea30&&_0x5cea30[_0x17b3ac(0x10b)]&&_0x51b65c){const _0x361a43=_0x5cea30[_0x17b3ac(0x10b)];let _0x480db3=_0x51b65c[_0x17b3ac(0x10b)];try{_0x480db3=JSON[_0x17b3ac(0x100)](_0x480db3);}catch(_0x5f307d){}_0x26ae8e[_0x17b3ac(0x14c)]['info'](_0x17b3ac(0x11c)+_0x361a43+_0x17b3ac(0xf6)+_0x480db3),await _0x26ae8e[_0x17b3ac(0xf5)](_0x361a43,_0x480db3);}else _0x26ae8e[_0x17b3ac(0x14c)]['warn'](_0x17b3ac(0xcf));}catch(_0x199a0e){_0x26ae8e['log']['error']('BUTLER\x20Execution\x20Error:\x20'+_0x199a0e[_0x17b3ac(0x157)]);}}async function sendMorningBriefing(_0x2aff4d){const _0x454903=a0_0x1fcb37;if(!_0x2aff4d[_0x454903(0x125)]){_0x2aff4d[_0x454903(0x14c)][_0x454903(0xd2)](_0x454903(0xc6));return;}_0x2aff4d[_0x454903(0x14c)]['info']('ðŸŒ…\x20Starting\x20Morning\x20Briefing\x20sequence\x20(Traffic\x20Check\x20bypassed)...');try{updateApiTimestamp();const _0x4e1044=_0x454903(0x117),_0x67c13f=await _0x2aff4d[_0x454903(0x125)]['generateContent'](_0x4e1044),_0x1360e5=_0x67c13f[_0x454903(0x121)][_0x454903(0xbf)]();_0x2aff4d[_0x454903(0x14c)][_0x454903(0x149)](_0x454903(0xbd)+_0x1360e5['length']+').\x20Sending\x20notification...'),setup['sendNotification'](_0x2aff4d,'ðŸŒ…\x20Morning\x20Briefing:\x0a'+_0x1360e5);}catch(_0x16cf83){_0x2aff4d[_0x454903(0x14c)]['error'](_0x454903(0xdd)+_0x16cf83[_0x454903(0x157)]);}}async function generateHealthReport(_0x17cc75,_0x3d9bbf){const _0x3c89ba=a0_0x1fcb37;if(!_0x17cc75[_0x3c89ba(0x125)])return;const _0x32be09=Date['now']();_0x32be09-lastGlobalApiCall<0xbb8&&(_0x17cc75[_0x3c89ba(0x14c)][_0x3c89ba(0xdc)]('ðŸ¤–\x20API\x20Cooldown.\x20Waiting\x202s...'),await new Promise(_0x4965e2=>setTimeout(_0x4965e2,0x7d0)));const _0x53e089=new Date();let _0x22e2a0=0x0,_0x5c172e=_0x53e089[_0x3c89ba(0x135)](),_0x1cb0d1='';if(_0x3d9bbf===_0x3c89ba(0x143)){const _0x35013a=new Date(_0x53e089);_0x35013a[_0x3c89ba(0xd7)](_0x35013a[_0x3c89ba(0xed)]()-0x1),_0x35013a[_0x3c89ba(0xe0)](0x16,0x0,0x0,0x0),_0x22e2a0=_0x35013a['getTime']();const _0x4aee7d=new Date(_0x53e089);_0x4aee7d['setHours'](0x8,0x0,0x0,0x0),_0x5c172e=_0x4aee7d[_0x3c89ba(0x135)](),_0x1cb0d1='Analysiere\x20diese\x20Events\x20der\x20NACHT\x20(22:00-08:00).\x20War\x20der\x20Schlaf\x20ruhig?\x20Gab\x20es\x20BadgÃ¤nge?\x20Antwort\x20kurz\x20fÃ¼r\x20den\x20besorgten\x20Sohn\x20(max\x202\x20SÃ¤tze).';}else{const _0x1137a6=new Date(_0x53e089);_0x1137a6[_0x3c89ba(0xe0)](0x8,0x0,0x0,0x0),_0x22e2a0=_0x1137a6['getTime'](),_0x1cb0d1=_0x3c89ba(0xdb);}const _0x38615f=_0x17cc75['eventHistory']['filter'](_0x1e69cc=>_0x1e69cc[_0x3c89ba(0x142)]>=_0x22e2a0&&_0x1e69cc[_0x3c89ba(0x142)]<=_0x5c172e);if(_0x38615f[_0x3c89ba(0x110)]===0x0){const _0x2915d0=_0x3d9bbf===_0x3c89ba(0x143)?_0x3c89ba(0x152):_0x3c89ba(0xff),_0x13e05b=_0x3d9bbf==='NIGHT'?_0x3c89ba(0xfc):_0x3c89ba(0x122);await _0x17cc75[_0x3c89ba(0x114)](_0x13e05b,{'val':_0x2915d0,'ack':!![]});return;}const _0x1c4813=_0x38615f[_0x3c89ba(0xf0)](_0x2ed7fc=>new Date(_0x2ed7fc[_0x3c89ba(0x142)])[_0x3c89ba(0xe1)]([],{'hour':_0x3c89ba(0x138),'minute':_0x3c89ba(0x138)})+'\x20'+_0x2ed7fc[_0x3c89ba(0x14e)]+'\x20('+_0x2ed7fc[_0x3c89ba(0x103)]+')')[_0x3c89ba(0xbc)]('\x0a'),_0x58025c='\x0a\x20\x20\x20\x20ROLLE:\x20Medizinischer\x20Assistent\x20fÃ¼r\x20AAL\x20(Ambient\x20Assisted\x20Living).\x0a\x20\x20\x20\x20AUFGABE:\x20'+_0x1cb0d1+_0x3c89ba(0x134)+_0x1c4813+_0x3c89ba(0xee);try{updateApiTimestamp();const _0x3eec9c=await _0x17cc75[_0x3c89ba(0x125)]['generateContent'](_0x58025c),_0x101851=_0x3eec9c['response'][_0x3c89ba(0xbf)](),_0x4d4c44=_0x3d9bbf===_0x3c89ba(0x143)?_0x3c89ba(0xfc):_0x3c89ba(0x122);await _0x17cc75[_0x3c89ba(0x114)](_0x4d4c44,{'val':_0x101851,'ack':!![]}),_0x17cc75['log'][_0x3c89ba(0x149)](_0x3c89ba(0x11d)+_0x3d9bbf+_0x3c89ba(0xc4));}catch(_0x12eb03){_0x17cc75['log'][_0x3c89ba(0xc9)]('Health\x20Report\x20Error:\x20'+_0x12eb03[_0x3c89ba(0x157)]);}}module[a0_0x1fcb37(0x10e)]={'executeAutomationAction':executeAutomationAction,'createDailyDigest':createDailyDigest,'runBaselineDriftAnalysis':runBaselineDriftAnalysis,'sendMorningBriefing':sendMorningBriefing,'runGeminiAnalysis':runGeminiAnalysis,'consultButler':consultButler,'generateHealthReport':generateHealthReport};