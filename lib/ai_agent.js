const a0_0xa938df=a0_0x2401;(function(_0x511fc0,_0x367661){const _0x25cd74=a0_0x2401,_0x5f0ce1=_0x511fc0();while(!![]){try{const _0xb8f524=parseInt(_0x25cd74(0x147))/0x1*(parseInt(_0x25cd74(0x157))/0x2)+parseInt(_0x25cd74(0x1dc))/0x3*(-parseInt(_0x25cd74(0x14c))/0x4)+parseInt(_0x25cd74(0x1d9))/0x5*(parseInt(_0x25cd74(0x1d1))/0x6)+-parseInt(_0x25cd74(0x1d4))/0x7+parseInt(_0x25cd74(0x1ba))/0x8+-parseInt(_0x25cd74(0x1ce))/0x9*(parseInt(_0x25cd74(0x1cc))/0xa)+-parseInt(_0x25cd74(0x176))/0xb*(parseInt(_0x25cd74(0x154))/0xc);if(_0xb8f524===_0x367661)break;else _0x5f0ce1['push'](_0x5f0ce1['shift']());}catch(_0x584870){_0x5f0ce1['push'](_0x5f0ce1['shift']());}}}(a0_0x5e5b,0xa6e8a));const a0_0x1efe8d=(function(){let _0x448c35=!![];return function(_0x21e15c,_0xdf923f){const _0x591f88=_0x448c35?function(){if(_0xdf923f){const _0x4a2f13=_0xdf923f['apply'](_0x21e15c,arguments);return _0xdf923f=null,_0x4a2f13;}}:function(){};return _0x448c35=![],_0x591f88;};}()),a0_0x43a237=a0_0x1efe8d(this,function(){const _0x147fac=a0_0x2401;return a0_0x43a237[_0x147fac(0x14d)]()['search'](_0x147fac(0x197))[_0x147fac(0x14d)]()[_0x147fac(0x169)](a0_0x43a237)[_0x147fac(0x1a3)]('(((.+)+)+)+$');});a0_0x43a237();'use strict';const {GoogleGenerativeAI}=require(a0_0xa938df(0x1ac)),setup=require('./setup'),GEMINI_MODEL=a0_0xa938df(0x173),LTM_DP_DAILY_DIGESTS='LTM.dailyDigests',LTM_DP_STATUS=a0_0xa938df(0x19a),LTM_DP_RAW_LOG=a0_0xa938df(0x1d8),LTM_MIN_EVENTS_FOR_COMPRESSION=0x5,MIN_API_GAP_MS=0x4e20;let lastGlobalApiCall=0x0;const decisionCache={},CACHE_TTL_MS=0xf*0x3c*0x3e8,PERSONA_MAPPING={'generic':'Entscheide\x20ausgewogen\x20zwischen\x20Komfort\x20und\x20Energie.','senior_aal':'PRIORITÃ„T:\x20Sicherheit\x20und\x20Licht.\x20Schalte\x20lieber\x20einmal\x20zu\x20viel\x20als\x20zu\x20wenig.','family':'Fokus\x20auf\x20Komfort\x20fÃ¼r\x20die\x20Familie.','single_comfort':a0_0xa938df(0x1b9),'security':a0_0xa938df(0x198),'energy_saver':'PRIORITÃ„T:\x20Energie\x20sparen.\x20Schalte\x20nur,\x20wenn\x20absolut\x20notwendig\x20(Dunkelheit).'};function canCallApi(){const _0x55869c=a0_0xa938df,_0x440447=Date[_0x55869c(0x155)]();return _0x440447-lastGlobalApiCall>MIN_API_GAP_MS;}function a0_0x5e5b(){const _0x467dee=['Analysiere\x20diese\x20Events\x20des\x20TAGES\x20(08:00-Jetzt).\x20AktivitÃ¤t?\x20Mahlzeiten?\x20HaustÃ¼r?\x20Antwort\x20kurz\x20fÃ¼r\x20den\x20besorgten\x20Sohn\x20(max\x202\x20SÃ¤tze).','Erstelle\x20ein\x20kurzes\x20\x27Guten\x20Morgen\x27\x20Briefing\x20basierend\x20auf\x20den\x20Events\x20der\x20letzten\x20Nacht.','search','dailyDigests','Keine\x20Daten\x20fÃ¼r\x20die\x20Nacht\x20aufgezeichnet\x20(Sensoren\x20ruhig).','getForeignStateAsync','join','system.presenceWho','val','KI\x20offline\x20(Fallback)','\x0a\x20\x20\x20\x20FRAGE:\x20Ist\x20es\x20dunkel\x20genug\x20fÃ¼r\x20Licht?\x0a\x20\x20\x20\x20FORMAT:\x20{\x20\x22approved\x22:\x20boolean,\x20\x22reason\x22:\x20\x22kurzer\x20Grund\x22\x20}\x0a\x20\x20\x20\x20','@google/generative-ai','N/A\x20(Learning)','ltmLtbWindowDays','unshift','%)\x20nach\x20\x22','generateContent','isAlert','Briefing\x20Error:\x20','setHours','debug','analysis.automation.targetId','ROLLE:\x20KI-Hausverwalter.\x20PERSONA:\x20','info','Maximaler\x20Komfort,\x20Energie\x20ist\x20zweitrangig.','5473480WKNzGh','response','Keine\x20Details.','LTM.driftAnalysis.baselineDrift','analysis.isAlert','.forecast.current.temperature','eventHistory','description','âš ï¸\x20ALARM:\x20','\x0aAktivitÃ¤t:\x20','.Current.IsNight','config','trim','currentSystemMode','alertReason','stringify','Unbekannt\x20(Kein\x20Sensor)','.Current.WeatherText','166110SfpMqZ','warn','387aAIKEg','sendNotification','error','528CbtVmo','Started...','getTime','7930552nFcjdA','weatherInstance','2-digit','analysis.analysisHistory','LTM.rawEventLog','62405lzjpPc','setDate','analysis.automation.description','102SIGTEL','approved','.\x20SYSTEM_MODE:\x20','decision','Skipped\x20(Traffic)','ðŸŒ…\x20Morning\x20Briefing:\x0a','ANALYZE_HEALTH','35PZoOXE','toISOString','useWeather','analysis.alertReason','Gemini\x20Error:\x20','4932iVTrAY','toString','toLocaleTimeString','Wetterdaten\x20nicht\x20abrufbar','isProVersion','rawEventLog','ðŸŒ…\x20Briefing\x20generated\x20(Length:\x20','name','908748uHsRVZ','now',',\x20LichtverhÃ¤ltnisse:\x20','49486gNYoCz','Digest','ðŸ¤–\x20Morning\x20Briefing\x20skipped:\x20No\x20Gemini\x20Model.','isEmergency','message','slice','KI-Fehler\x20(Fallback)','\x0a\x20\x20\x20\x20ANTWORT-STIL:\x20Sachlich,\x20beruhigend,\x20prÃ¤zise.\x20Keine\x20Floskeln.\x0a\x20\x20\x20\x20','ðŸ¤–\x20Butler\x20Brain\x20Error:\x20','exports','.\x20EMERGENCY:\x20','parse','setStateAsync','.\x20KONTEXT:\x20','\x20=\x20','Analysiere\x20diese\x20Events\x20der\x20NACHT\x20(22:00-08:00).\x20War\x20der\x20Schlaf\x20ruhig?\x20Gab\x20es\x20BadgÃ¤nge?\x20Antwort\x20kurz\x20fÃ¼r\x20den\x20besorgten\x20Sohn\x20(max\x202\x20SÃ¤tze).','replace','\x20Ã¼bersprungen\x20(Auto-Approved).','constructor','.\x20ANWESEND:\x20','log',',\x20Wetter:\x20','LTM.driftAnalysis.driftDetails','push','targetValue','BUTLER\x20Execution\x20Error:\x20',').\x20Sending\x20notification...','\x0a\x20\x20\x20\x20ROLLE:\x20Medizinischer\x20Assistent\x20fÃ¼r\x20AAL\x20(Ambient\x20Assisted\x20Living).\x0a\x20\x20\x20\x20AUFGABE:\x20','models/gemini-flash-latest',')\x20generated.','ROLLE:\x20Data\x20Compression\x20Agent.\x20SPRACHE:\x20DE.\x20FORMAT:\x20JSON.\x20ANWEISUNG:\x20Fasse\x20Sensor-Events\x20zusammen.\x20SCHEMA:\x20{\x20\x22summary\x22:\x20\x22string\x22,\x20\x22activityLevel\x22:\x20\x22string\x22\x20}\x20\x0a\x0aEVENTS:\x0a','11Feafpt','\x0a\x20\x20\x20\x20EVENTS:\x0a','analysisHistory','analysis.automation.targetValue','\x22.\x0a\x20\x20\x20\x20AKTION:\x20Schalte\x20\x22','timestamp','\x0aSTB:\x20','analysis.automation.autoApply','lastAlertState','geminiModel','ðŸ¤–\x20BUTLER:\x20Executing\x20Action\x20->\x20','driftDetails','NIGHT','.forecast.current.state','analysis.lastResult','summary','analysis.automation.patternDetected','ðŸ¤–\x20Autopilot\x20skipped\x20(Traffic\x20Protection\x20active).','ðŸŒ…\x20Starting\x20Morning\x20Briefing\x20sequence\x20(Traffic\x20Check\x20bypassed)...','generic','\x20->\x20','analysis.health.geminiDay','ðŸ¤–\x20BUTLER:\x20No\x20valid\x20target\x20ID\x20or\x20value\x20stored\x20for\x20execution.','detected','.\x0a\x20\x20\x20\x20EVENT:\x20Bewohner\x20geht\x20wahrscheinlich\x20(','text','getDate','Â°C,\x20','automationProposal','activityLevel','length','getStateAsync','LTM.driftAnalysis.lastCheck','(((.+)+)+)+$','Sicherheit\x20geht\x20vor.','baselineDrift','LTM.processingStatus','Nacht','.Current.Temperature','Success','ðŸ¤–\x20Traffic\x20Schutz:\x20Anfrage\x20fÃ¼r\x20','Health\x20Report\x20Error:\x20','aiPersona'];a0_0x5e5b=function(){return _0x467dee;};return a0_0x5e5b();}function a0_0x2401(_0x16ab1a,_0x43aa8d){const _0x2634f5=a0_0x5e5b();return a0_0x2401=function(_0x43a237,_0x1efe8d){_0x43a237=_0x43a237-0x144;let _0x5e5beb=_0x2634f5[_0x43a237];return _0x5e5beb;},a0_0x2401(_0x16ab1a,_0x43aa8d);}function updateApiTimestamp(){const _0x5ca034=a0_0xa938df;lastGlobalApiCall=Date[_0x5ca034(0x155)]();}async function getWeatherContext(_0x57d505){const _0x1d5432=a0_0xa938df;if(!_0x57d505[_0x1d5432(0x1c5)][_0x1d5432(0x149)]||!_0x57d505[_0x1d5432(0x1c5)]['weatherInstance'])return _0x1d5432(0x1ca);try{const _0xbf912f=_0x57d505[_0x1d5432(0x1c5)][_0x1d5432(0x1d5)];let _0x526bf0=await _0x57d505['getForeignStateAsync'](_0xbf912f+_0x1d5432(0x19c));if(!_0x526bf0)_0x526bf0=await _0x57d505[_0x1d5432(0x1a6)](_0xbf912f+_0x1d5432(0x1bf));let _0x11c4d3=await _0x57d505[_0x1d5432(0x1a6)](_0xbf912f+_0x1d5432(0x1cb));if(!_0x11c4d3)_0x11c4d3=await _0x57d505[_0x1d5432(0x1a6)](_0xbf912f+_0x1d5432(0x183));let _0x4876c4='Unbekannt';const _0x5bd1f5=await _0x57d505[_0x1d5432(0x1a6)](_0xbf912f+_0x1d5432(0x1c4));if(_0x5bd1f5)_0x4876c4=_0x5bd1f5['val']?_0x1d5432(0x19b):'Tag';if(_0x526bf0&&_0x11c4d3)return _0x526bf0[_0x1d5432(0x1a9)]+_0x1d5432(0x191)+_0x11c4d3[_0x1d5432(0x1a9)]+_0x1d5432(0x156)+_0x4876c4;}catch(_0x19e8f8){}return _0x1d5432(0x14f);}async function consultButler(_0xa71f7e,_0xa62429,_0x335165,_0x30c84f){const _0x57cec0=a0_0xa938df;if(!_0xa71f7e[_0x57cec0(0x17f)])return{'approved':!![],'reason':_0x57cec0(0x1aa)};const _0x21270d=Date['now']();if(decisionCache[_0xa62429]&&_0x21270d-decisionCache[_0xa62429][_0x57cec0(0x17b)]<CACHE_TTL_MS){const _0x2cfb08=decisionCache[_0xa62429][_0x57cec0(0x1df)];return _0xa71f7e['log']['debug']('ðŸ¤–\x20Butler\x20Cache\x20Hit:\x20'+_0xa62429+_0x57cec0(0x18a)+(_0x2cfb08[_0x57cec0(0x1dd)]?'OK':'NO')+'\x20('+_0x2cfb08['reason']+')'),_0x2cfb08;}if(!canCallApi())return _0xa71f7e[_0x57cec0(0x16b)][_0x57cec0(0x1b5)](_0x57cec0(0x19e)+_0xa62429+_0x57cec0(0x168)),{'approved':!![],'reason':'Traffic-Schutz\x20(Auto-Approved)'};const _0x866746=new Date()[_0x57cec0(0x14e)](),_0x22b797=await getWeatherContext(_0xa71f7e),_0x58dca9=PERSONA_MAPPING[_0xa71f7e[_0x57cec0(0x1c5)][_0x57cec0(0x1a0)]||_0x57cec0(0x189)],_0x514642='\x0a\x20\x20\x20\x20ROLLE:\x20Haus-Butler.\x0a\x20\x20\x20\x20SITUATION:\x20'+_0x866746+_0x57cec0(0x16c)+_0x22b797+_0x57cec0(0x18e)+(_0x30c84f*0x64)['toFixed'](0x0)+_0x57cec0(0x1b0)+_0xa62429+_0x57cec0(0x17a)+_0x335165+'\x22\x20AN.\x0a\x20\x20\x20\x20STRATEGIE:\x20'+_0x58dca9+_0x57cec0(0x1ab);try{updateApiTimestamp();const _0x17c98a=await _0xa71f7e[_0x57cec0(0x17f)]['generateContent'](_0x514642),_0x2c7d4b=_0x17c98a['response'][_0x57cec0(0x18f)]()[_0x57cec0(0x167)](/```json|```/g,'')[_0x57cec0(0x1c6)](),_0x1cfb22=JSON[_0x57cec0(0x162)](_0x2c7d4b);return decisionCache[_0xa62429]={'decision':_0x1cfb22,'timestamp':_0x21270d},_0x1cfb22;}catch(_0x17af41){return _0xa71f7e['log'][_0x57cec0(0x1cd)](_0x57cec0(0x15f)+_0x17af41[_0x57cec0(0x15b)]),decisionCache[_0xa62429]={'decision':{'approved':!![],'reason':'KI-Fehler\x20(Fallback)'},'timestamp':_0x21270d-(CACHE_TTL_MS-0xea60)},{'approved':!![],'reason':_0x57cec0(0x15d)};}}async function runGeminiAnalysis(_0x4a471f,_0x550c62=''){const _0x43090d=a0_0xa938df;if(!_0x4a471f[_0x43090d(0x17f)])return;if(!canCallApi()){_0x4a471f[_0x43090d(0x16b)][_0x43090d(0x1b5)](_0x43090d(0x187));return;}if(_0x4a471f[_0x43090d(0x1c0)][_0x43090d(0x194)]===0x0)return;const _0x2d48fb=_0x4a471f[_0x43090d(0x1c0)][_0x43090d(0x15c)](0x0,0xf),_0x3af229=_0x4a471f[_0x43090d(0x1c7)],_0x5405c7=PERSONA_MAPPING[_0x4a471f[_0x43090d(0x1c5)][_0x43090d(0x1a0)]||_0x43090d(0x189)],_0x5a42d0=_0x4a471f[_0x43090d(0x1c5)]['livingContext']||_0x43090d(0x1bc);let _0x37ec9a='Unbekannt';try{const _0x11f7ad=await _0x4a471f[_0x43090d(0x195)](_0x43090d(0x1a8));if(_0x11f7ad&&_0x11f7ad[_0x43090d(0x1a9)])_0x37ec9a=_0x11f7ad[_0x43090d(0x1a9)];}catch(_0x4c60b3){}let _0x22c911=![];try{const _0x13d038=await _0x4a471f[_0x43090d(0x195)](_0x43090d(0x17d));if(_0x13d038&&_0x13d038[_0x43090d(0x1a9)])_0x22c911=!![];}catch(_0x322deb){}const _0x3fc497=_0x43090d(0x1b7)+_0x5405c7+_0x43090d(0x164)+_0x5a42d0+_0x43090d(0x1de)+_0x3af229+_0x43090d(0x16a)+_0x37ec9a+'.\x20EVENTS:\x20'+JSON['stringify'](_0x2d48fb)+_0x43090d(0x161)+_0x550c62+'.\x20AUFGABE:\x201.\x20Gesundheit?\x202.\x20Komfort?\x20FORMAT\x20(JSON):\x20{\x20\x22isAlert\x22:\x20boolean,\x20\x22alertReason\x22:\x20\x22string\x22,\x20\x22isEmergency\x22:\x20boolean,\x20\x22summary\x22:\x20\x22string\x22,\x20\x22automationProposal\x22:\x20{\x20\x22detected\x22:\x20boolean,\x20\x22description\x22:\x20\x22string\x22,\x20\x22targetId\x22:\x20\x22string\x22,\x20\x22targetValue\x22:\x20\x22any\x22\x20}\x20}';try{updateApiTimestamp();const _0x3feb3f=await _0x4a471f[_0x43090d(0x17f)][_0x43090d(0x1b1)](_0x3fc497),_0x2eebd4=JSON[_0x43090d(0x162)](_0x3feb3f[_0x43090d(0x1bb)][_0x43090d(0x18f)]()[_0x43090d(0x167)](/```json|```/g,'')[_0x43090d(0x1c6)]());await _0x4a471f[_0x43090d(0x163)](_0x43090d(0x184),{'val':JSON['stringify'](_0x2eebd4),'ack':!![]});if(_0x2eebd4['summary'])await _0x4a471f[_0x43090d(0x163)]('analysis.activitySummary',{'val':_0x2eebd4['summary'],'ack':!![]});const _0x5410a6={'timestamp':Date[_0x43090d(0x155)](),'id':Date['now']()[_0x43090d(0x14d)](),'analysis':{'activity':{'summary':_0x2eebd4[_0x43090d(0x185)],'isAlert':_0x2eebd4[_0x43090d(0x1b2)],'alertReason':_0x2eebd4['alertReason']},'comfort':{'automationProposal':_0x2eebd4[_0x43090d(0x192)]}}};_0x4a471f['analysisHistory'][_0x43090d(0x1af)](_0x5410a6);if(_0x4a471f['analysisHistory'][_0x43090d(0x194)]>0x32)_0x4a471f[_0x43090d(0x178)]['pop']();await _0x4a471f[_0x43090d(0x163)](_0x43090d(0x1d7),{'val':JSON['stringify'](_0x4a471f[_0x43090d(0x178)]),'ack':!![]});const _0x5e5062=_0x2eebd4[_0x43090d(0x1b2)]||![];_0x5e5062!==_0x4a471f['lastAlertState']&&(await _0x4a471f[_0x43090d(0x163)](_0x43090d(0x1be),{'val':_0x5e5062,'ack':!![]}),_0x4a471f[_0x43090d(0x17e)]=_0x5e5062,_0x5e5062&&(await _0x4a471f[_0x43090d(0x163)](_0x43090d(0x14a),{'val':_0x2eebd4[_0x43090d(0x1c8)],'ack':!![]}),setup[_0x43090d(0x1cf)](_0x4a471f,_0x43090d(0x1c2)+_0x2eebd4[_0x43090d(0x1c8)],![],_0x2eebd4[_0x43090d(0x15a)])));if(_0x2eebd4[_0x43090d(0x192)]&&_0x2eebd4['automationProposal'][_0x43090d(0x18d)]){await _0x4a471f['setStateAsync'](_0x43090d(0x186),{'val':!![],'ack':!![]}),await _0x4a471f[_0x43090d(0x163)](_0x43090d(0x1db),{'val':_0x2eebd4[_0x43090d(0x192)][_0x43090d(0x1c1)],'ack':!![]}),await _0x4a471f[_0x43090d(0x163)]('analysis.automation.targetId',{'val':_0x2eebd4['automationProposal']['targetId'],'ack':!![]}),await _0x4a471f[_0x43090d(0x163)](_0x43090d(0x179),{'val':JSON['stringify'](_0x2eebd4[_0x43090d(0x192)][_0x43090d(0x16f)]),'ack':!![]});if(_0x22c911)executeAutomationAction(_0x4a471f);}}catch(_0x5403f3){_0x4a471f[_0x43090d(0x16b)][_0x43090d(0x1d0)](_0x43090d(0x14b)+_0x5403f3[_0x43090d(0x15b)]);}}async function createDailyDigest(_0x18d662,_0x4a7553){const _0x3ab83b=a0_0xa938df;if(!_0x18d662[_0x3ab83b(0x150)])return;if(!canCallApi()){await _0x18d662[_0x3ab83b(0x163)](LTM_DP_STATUS,{'val':_0x3ab83b(0x144),'ack':!![]});return;}await _0x18d662['setStateAsync'](LTM_DP_STATUS,{'val':_0x3ab83b(0x1d2),'ack':!![]});if(!_0x18d662[_0x3ab83b(0x17f)]||_0x18d662[_0x3ab83b(0x151)][_0x3ab83b(0x194)]<LTM_MIN_EVENTS_FOR_COMPRESSION){await _0x18d662[_0x3ab83b(0x163)](LTM_DP_STATUS,{'val':'Skipped\x20(No\x20AI\x20or\x20Data)','ack':!![]});return;}const _0x2ec092=JSON[_0x3ab83b(0x162)](JSON['stringify'](_0x18d662[_0x3ab83b(0x151)])),_0x42b3cf=_0x2ec092[_0x3ab83b(0x194)],_0x1237d1=_0x3ab83b(0x175)+JSON[_0x3ab83b(0x1c9)](_0x2ec092);try{updateApiTimestamp();const _0x555aeb=await _0x18d662['geminiModel'][_0x3ab83b(0x1b1)](_0x1237d1),_0x5f0cb5=JSON['parse'](_0x555aeb['response'][_0x3ab83b(0x18f)]()[_0x3ab83b(0x167)](/```json|```/g,'')['trim']()),_0x5207db={'timestamp':new Date()[_0x3ab83b(0x148)](),'eventCount':_0x42b3cf,'summary':_0x5f0cb5[_0x3ab83b(0x185)]||_0x3ab83b(0x158),'activityLevel':_0x5f0cb5[_0x3ab83b(0x193)]||'normal','systemMode':_0x18d662['currentSystemMode']};_0x18d662[_0x3ab83b(0x1a4)][_0x3ab83b(0x16e)](_0x5207db);const _0x312883=_0x18d662[_0x3ab83b(0x1c5)][_0x3ab83b(0x1ae)]||0x3c;_0x18d662[_0x3ab83b(0x1a4)]['length']>_0x312883&&_0x18d662['dailyDigests']['splice'](0x0,_0x18d662[_0x3ab83b(0x1a4)]['length']-_0x312883);await _0x18d662[_0x3ab83b(0x163)](LTM_DP_DAILY_DIGESTS,{'val':JSON['stringify'](_0x18d662['dailyDigests']),'ack':!![]}),_0x18d662[_0x3ab83b(0x151)]=[],await _0x18d662[_0x3ab83b(0x163)](LTM_DP_RAW_LOG,{'val':JSON[_0x3ab83b(0x1c9)](_0x18d662[_0x3ab83b(0x151)]),'ack':!![]}),await _0x18d662[_0x3ab83b(0x163)](LTM_DP_STATUS,{'val':_0x3ab83b(0x19d),'ack':!![]});const _0x39a284='ðŸ“…\x20Daily\x20Digest:\x0a'+_0x5f0cb5[_0x3ab83b(0x185)]+_0x3ab83b(0x1c3)+_0x5f0cb5['activityLevel'];setup[_0x3ab83b(0x1cf)](_0x18d662,_0x39a284,![],![]);if(_0x18d662[_0x3ab83b(0x150)]&&_0x4a7553)_0x4a7553['send'](_0x18d662,_0x3ab83b(0x146),{'digest':_0x5207db});}catch(_0x57893d){_0x18d662['log'][_0x3ab83b(0x1d0)](_0x57893d[_0x3ab83b(0x15b)]);}}async function runBaselineDriftAnalysis(_0x333538){const _0x4c8ebf=a0_0xa938df;if(!_0x333538[_0x4c8ebf(0x150)]||!_0x333538[_0x4c8ebf(0x17f)])return;if(!canCallApi())return;const _0xb81bdf=_0x333538[_0x4c8ebf(0x1c5)]['ltmStbWindowDays']||0xe;if(_0x333538['dailyDigests'][_0x4c8ebf(0x194)]<_0xb81bdf+0x7){await _0x333538['setStateAsync'](_0x4c8ebf(0x1bd),{'val':_0x4c8ebf(0x1ad),'ack':!![]});return;}const _0x2e2f93=_0x333538[_0x4c8ebf(0x1a4)][_0x4c8ebf(0x15c)](-_0xb81bdf),_0x27c0fc=_0x333538[_0x4c8ebf(0x1a4)]['slice'](0x0,_0x333538['dailyDigests'][_0x4c8ebf(0x194)]-_0xb81bdf),_0x2abe37='ROLLE:\x20Data\x20Scientist.\x20ZIEL:\x20Drift\x20erkennen.\x20SCHEMA:\x20{\x20\x22baselineDrift\x22:\x20\x22none|slight|significant|critical\x22,\x20\x22driftDetails\x22:\x20\x22string\x22\x20}\x0a\x0aLTB:\x20'+JSON[_0x4c8ebf(0x1c9)](_0x27c0fc)+_0x4c8ebf(0x17c)+JSON[_0x4c8ebf(0x1c9)](_0x2e2f93);try{updateApiTimestamp();const _0x1fd93e=await _0x333538['geminiModel'][_0x4c8ebf(0x1b1)](_0x2abe37),_0xef8c2f=JSON['parse'](_0x1fd93e[_0x4c8ebf(0x1bb)][_0x4c8ebf(0x18f)]()[_0x4c8ebf(0x167)](/```json|```/g,'')[_0x4c8ebf(0x1c6)]());_0xef8c2f[_0x4c8ebf(0x199)]&&(await _0x333538[_0x4c8ebf(0x163)](_0x4c8ebf(0x1bd),{'val':_0xef8c2f[_0x4c8ebf(0x199)],'ack':!![]}),await _0x333538['setStateAsync'](_0x4c8ebf(0x16d),{'val':_0xef8c2f[_0x4c8ebf(0x181)],'ack':!![]}),await _0x333538[_0x4c8ebf(0x163)](_0x4c8ebf(0x196),{'val':Date['now'](),'ack':!![]}));}catch(_0xa63831){}}async function executeAutomationAction(_0xb90962){const _0x316dbf=a0_0xa938df;try{const _0x6b32d7=await _0xb90962[_0x316dbf(0x195)](_0x316dbf(0x1b6)),_0x43d16e=await _0xb90962[_0x316dbf(0x195)](_0x316dbf(0x179));if(_0x6b32d7&&_0x6b32d7[_0x316dbf(0x1a9)]&&_0x43d16e){const _0x3cdd5d=_0x6b32d7[_0x316dbf(0x1a9)];let _0x336b43=_0x43d16e[_0x316dbf(0x1a9)];try{_0x336b43=JSON[_0x316dbf(0x162)](_0x336b43);}catch(_0xbd7d38){}_0xb90962['log'][_0x316dbf(0x1b8)](_0x316dbf(0x180)+_0x3cdd5d+_0x316dbf(0x165)+_0x336b43),await _0xb90962['setForeignStateAsync'](_0x3cdd5d,_0x336b43);}else _0xb90962[_0x316dbf(0x16b)]['warn'](_0x316dbf(0x18c));}catch(_0x832ec4){_0xb90962[_0x316dbf(0x16b)][_0x316dbf(0x1d0)](_0x316dbf(0x170)+_0x832ec4[_0x316dbf(0x15b)]);}}async function sendMorningBriefing(_0x19d930){const _0xf3bfaf=a0_0xa938df;if(!_0x19d930['geminiModel']){_0x19d930['log'][_0xf3bfaf(0x1cd)](_0xf3bfaf(0x159));return;}_0x19d930[_0xf3bfaf(0x16b)][_0xf3bfaf(0x1b8)](_0xf3bfaf(0x188));try{updateApiTimestamp();const _0x2e8852=_0xf3bfaf(0x1a2),_0x4372f3=await _0x19d930[_0xf3bfaf(0x17f)]['generateContent'](_0x2e8852),_0x5222be=_0x4372f3[_0xf3bfaf(0x1bb)][_0xf3bfaf(0x18f)]();_0x19d930[_0xf3bfaf(0x16b)][_0xf3bfaf(0x1b8)](_0xf3bfaf(0x152)+_0x5222be['length']+_0xf3bfaf(0x171)),setup[_0xf3bfaf(0x1cf)](_0x19d930,_0xf3bfaf(0x145)+_0x5222be);}catch(_0x3b6da5){_0x19d930[_0xf3bfaf(0x16b)]['error'](_0xf3bfaf(0x1b3)+_0x3b6da5[_0xf3bfaf(0x15b)]);}}async function generateHealthReport(_0x2a2d40,_0x1d6d57){const _0x50b77c=a0_0xa938df;if(!_0x2a2d40[_0x50b77c(0x17f)])return;const _0x39ecae=Date[_0x50b77c(0x155)]();_0x39ecae-lastGlobalApiCall<0xbb8&&(_0x2a2d40[_0x50b77c(0x16b)][_0x50b77c(0x1b5)]('ðŸ¤–\x20API\x20Cooldown.\x20Waiting\x202s...'),await new Promise(_0x5ba38e=>setTimeout(_0x5ba38e,0x7d0)));const _0x4f4de4=new Date();let _0x12d49b=0x0,_0x4dfb9e=_0x4f4de4[_0x50b77c(0x1d3)](),_0x59cc99='';if(_0x1d6d57===_0x50b77c(0x182)){const _0x86fef8=new Date(_0x4f4de4);_0x86fef8[_0x50b77c(0x1da)](_0x86fef8[_0x50b77c(0x190)]()-0x1),_0x86fef8['setHours'](0x16,0x0,0x0,0x0),_0x12d49b=_0x86fef8['getTime']();const _0x52dd21=new Date(_0x4f4de4);_0x52dd21['setHours'](0x8,0x0,0x0,0x0),_0x4dfb9e=_0x52dd21[_0x50b77c(0x1d3)](),_0x59cc99=_0x50b77c(0x166);}else{const _0x49a4a6=new Date(_0x4f4de4);_0x49a4a6[_0x50b77c(0x1b4)](0x8,0x0,0x0,0x0),_0x12d49b=_0x49a4a6[_0x50b77c(0x1d3)](),_0x59cc99=_0x50b77c(0x1a1);}const _0x4e4f14=_0x2a2d40[_0x50b77c(0x1c0)]['filter'](_0x4bc6b6=>_0x4bc6b6['timestamp']>=_0x12d49b&&_0x4bc6b6[_0x50b77c(0x17b)]<=_0x4dfb9e);if(_0x4e4f14[_0x50b77c(0x194)]===0x0){const _0x50b087=_0x1d6d57===_0x50b77c(0x182)?_0x50b77c(0x1a5):'Bisher\x20keine\x20AktivitÃ¤t\x20seit\x2008:00\x20Uhr\x20verzeichnet.',_0x3ca252=_0x1d6d57===_0x50b77c(0x182)?'analysis.health.geminiNight':_0x50b77c(0x18b);await _0x2a2d40[_0x50b77c(0x163)](_0x3ca252,{'val':_0x50b087,'ack':!![]});return;}const _0x541dbf=_0x4e4f14['map'](_0x1daffb=>new Date(_0x1daffb['timestamp'])['toLocaleTimeString']([],{'hour':_0x50b77c(0x1d6),'minute':_0x50b77c(0x1d6)})+'\x20'+_0x1daffb[_0x50b77c(0x153)]+'\x20('+_0x1daffb['value']+')')[_0x50b77c(0x1a7)]('\x0a'),_0x213efb=_0x50b77c(0x172)+_0x59cc99+_0x50b77c(0x177)+_0x541dbf+_0x50b77c(0x15e);try{updateApiTimestamp();const _0x275dc0=await _0x2a2d40['geminiModel'][_0x50b77c(0x1b1)](_0x213efb),_0x5ea0e9=_0x275dc0[_0x50b77c(0x1bb)][_0x50b77c(0x18f)](),_0x1297af=_0x1d6d57===_0x50b77c(0x182)?'analysis.health.geminiNight':_0x50b77c(0x18b);await _0x2a2d40[_0x50b77c(0x163)](_0x1297af,{'val':_0x5ea0e9,'ack':!![]}),_0x2a2d40[_0x50b77c(0x16b)][_0x50b77c(0x1b8)]('ðŸ¤–\x20Health\x20Report\x20('+_0x1d6d57+_0x50b77c(0x174));}catch(_0x5e441b){_0x2a2d40['log'][_0x50b77c(0x1d0)](_0x50b77c(0x19f)+_0x5e441b[_0x50b77c(0x15b)]);}}module[a0_0xa938df(0x160)]={'executeAutomationAction':executeAutomationAction,'createDailyDigest':createDailyDigest,'runBaselineDriftAnalysis':runBaselineDriftAnalysis,'sendMorningBriefing':sendMorningBriefing,'runGeminiAnalysis':runGeminiAnalysis,'consultButler':consultButler,'generateHealthReport':generateHealthReport};