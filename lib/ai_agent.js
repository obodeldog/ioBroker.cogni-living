const a0_0x3e53df=a0_0x1680;function a0_0x1680(_0x3d3968,_0x29d69d){const _0x83332e=a0_0x4f64();return a0_0x1680=function(_0x407e6e,_0x482690){_0x407e6e=_0x407e6e-0xf1;let _0x4f64dd=_0x83332e[_0x407e6e];return _0x4f64dd;},a0_0x1680(_0x3d3968,_0x29d69d);}(function(_0x553d20,_0x148ee0){const _0x3f61eb=a0_0x1680,_0x4defc3=_0x553d20();while(!![]){try{const _0x4995b7=parseInt(_0x3f61eb(0x13d))/0x1+parseInt(_0x3f61eb(0x173))/0x2*(parseInt(_0x3f61eb(0x133))/0x3)+-parseInt(_0x3f61eb(0x17f))/0x4*(parseInt(_0x3f61eb(0x176))/0x5)+parseInt(_0x3f61eb(0x150))/0x6*(-parseInt(_0x3f61eb(0x14e))/0x7)+-parseInt(_0x3f61eb(0x161))/0x8*(parseInt(_0x3f61eb(0x115))/0x9)+parseInt(_0x3f61eb(0x126))/0xa+-parseInt(_0x3f61eb(0x180))/0xb*(-parseInt(_0x3f61eb(0x177))/0xc);if(_0x4995b7===_0x148ee0)break;else _0x4defc3['push'](_0x4defc3['shift']());}catch(_0x30a2e3){_0x4defc3['push'](_0x4defc3['shift']());}}}(a0_0x4f64,0xb621b));const a0_0x482690=(function(){let _0x1e13a4=!![];return function(_0x2eec90,_0x41932d){const _0x3f321b=_0x1e13a4?function(){if(_0x41932d){const _0x447c81=_0x41932d['apply'](_0x2eec90,arguments);return _0x41932d=null,_0x447c81;}}:function(){};return _0x1e13a4=![],_0x3f321b;};}()),a0_0x407e6e=a0_0x482690(this,function(){const _0x1475a2=a0_0x1680;return a0_0x407e6e['toString']()[_0x1475a2(0x107)](_0x1475a2(0x186))[_0x1475a2(0x155)]()[_0x1475a2(0x182)](a0_0x407e6e)[_0x1475a2(0x107)](_0x1475a2(0x186));});a0_0x407e6e();'use strict';const {GoogleGenerativeAI}=require(a0_0x3e53df(0xf9)),setup=require(a0_0x3e53df(0x111)),GEMINI_MODEL=a0_0x3e53df(0x148),LTM_DP_DAILY_DIGESTS='LTM.dailyDigests',LTM_DP_STATUS=a0_0x3e53df(0x129),LTM_DP_RAW_LOG=a0_0x3e53df(0xfb),LTM_MIN_EVENTS_FOR_COMPRESSION=0x5,MIN_API_GAP_MS=0x4e20;let lastGlobalApiCall=0x0;const decisionCache={},CACHE_TTL_MS=0xf*0x3c*0x3e8,PERSONA_MAPPING={'generic':a0_0x3e53df(0x117),'senior_aal':a0_0x3e53df(0x13a),'family':a0_0x3e53df(0x159),'single_comfort':a0_0x3e53df(0x15a),'security':a0_0x3e53df(0x17c),'energy_saver':a0_0x3e53df(0xf8)};function a0_0x4f64(){const _0x80126c=['Â°C,\x20','search','info','\x0a\x20\x20\x20\x20ROLLE:\x20Haus-Butler.\x0a\x20\x20\x20\x20SITUATION:\x20','.Current.Temperature','aiPersona','normal','analysis.isAlert','ðŸ¤–\x20Butler\x20Cache\x20Hit:\x20','.\x20KONTEXT:\x20','lastAlertState','./setup','useWeather','.\x20EMERGENCY:\x20','LTM.driftAnalysis.lastCheck','479772fHFmCB','filter','Entscheide\x20ausgewogen\x20zwischen\x20Komfort\x20und\x20Energie.','isEmergency','Traffic-Schutz\x20(Auto-Approved)','Skipped\x20(No\x20AI\x20or\x20Data)','Nacht','sendNotification','length','alertReason','send','weatherInstance','ðŸ¤–\x20Autopilot\x20skipped\x20(Traffic\x20Protection\x20active).',')\x20generated.','livingContext','now','response','14670240GBvzfA','ROLLE:\x20Data\x20Scientist.\x20ZIEL:\x20Drift\x20erkennen.\x20SCHEMA:\x20{\x20\x22baselineDrift\x22:\x20\x22none|slight|significant|critical\x22,\x20\x22driftDetails\x22:\x20\x22string\x22\x20}\x0a\x0aLTB:\x20','\x0aAktivitÃ¤t:\x20','LTM.processingStatus','Wetterdaten\x20nicht\x20abrufbar','summary','ðŸ“…\x20Daily\x20Digest:\x0a','âš ï¸\x20ALARM:\x20','Erstelle\x20ein\x20kurzes\x20\x27Guten\x20Morgen\x27\x20Briefing\x20basierend\x20auf\x20den\x20Events\x20der\x20letzten\x20Nacht.','stringify','KI\x20offline\x20(Fallback)','2-digit','push','367932WvyKuP','ðŸ¤–\x20Health\x20Report\x20(','log','LTM.driftAnalysis.driftDetails','map','geminiModel','parse','PRIORITÃ„T:\x20Sicherheit\x20und\x20Licht.\x20Schalte\x20lieber\x20einmal\x20zu\x20viel\x20als\x20zu\x20wenig.',',\x20Wetter:\x20','rawEventLog','489319fcNlPq','getForeignStateAsync','Started...','\x0a\x20\x20\x20\x20EVENTS:\x0a','.\x20SYSTEM_MODE:\x20','analysis.automation.patternDetected','Keine\x20Details.','Analysiere\x20diese\x20Events\x20der\x20NACHT\x20(22:00-08:00).\x20War\x20der\x20Schlaf\x20ruhig?\x20Gab\x20es\x20BadgÃ¤nge?\x20Antwort\x20kurz\x20fÃ¼r\x20den\x20besorgten\x20Sohn\x20(max\x202\x20SÃ¤tze).','replace','NIGHT','\x0aSTB:\x20','models/gemini-flash-latest','automationProposal','ðŸ¤–\x20API\x20Cooldown.\x20Waiting\x202s...','Keine\x20Daten\x20fÃ¼r\x20die\x20Nacht\x20aufgezeichnet\x20(Sensoren\x20ruhig).','Analysiere\x20diese\x20Events\x20des\x20TAGES\x20(08:00-Jetzt).\x20AktivitÃ¤t?\x20Mahlzeiten?\x20HaustÃ¼r?\x20Antwort\x20kurz\x20fÃ¼r\x20den\x20besorgten\x20Sohn\x20(max\x202\x20SÃ¤tze).','analysis.automation.targetId','33901rHiqvC','name','768qlCqhp','isProVersion','unshift','currentSystemMode','analysisHistory','toString','.Current.IsNight','Unbekannt','toLocaleTimeString','Fokus\x20auf\x20Komfort\x20fÃ¼r\x20die\x20Familie.','Maximaler\x20Komfort,\x20Energie\x20ist\x20zweitrangig.','reason','analysis.lastResult','join','driftDetails','detected','generic','96YhIHdQ','eventHistory','ðŸŒ…\x20Starting\x20Morning\x20Briefing\x20sequence\x20(Traffic\x20Check\x20bypassed)...','Briefing\x20Error:\x20','message','config','\x22\x20AN.\x0a\x20\x20\x20\x20STRATEGIE:\x20','setHours','setDate','analysis.health.geminiDay','trim','Skipped\x20(Traffic)','.\x0a\x20\x20\x20\x20EVENT:\x20Bewohner\x20geht\x20wahrscheinlich\x20(','toISOString','\x0a\x20\x20\x20\x20FRAGE:\x20Ist\x20es\x20dunkel\x20genug\x20fÃ¼r\x20Licht?\x0a\x20\x20\x20\x20FORMAT:\x20{\x20\x22approved\x22:\x20boolean,\x20\x22reason\x22:\x20\x22kurzer\x20Grund\x22\x20}\x0a\x20\x20\x20\x20','activityLevel','pop','ANALYZE_HEALTH','20kheoAG','\x20->\x20','ðŸŒ…\x20Briefing\x20generated\x20(Length:\x20','670FfuLMc','84ymiBJC','val','dailyDigests','getTime','system.presenceWho','Sicherheit\x20geht\x20vor.','\x22.\x0a\x20\x20\x20\x20AKTION:\x20Schalte\x20\x22','analysis.activitySummary','39380huyBJC','223234RKoywE','analysis.automation.targetValue','constructor','targetId','decision','getDate','(((.+)+)+)+$','warn','isAlert','error','generateContent','Unbekannt\x20(Kein\x20Sensor)','description','timestamp','analysis.automation.autoApply','LTM.driftAnalysis.baselineDrift','.\x20ANWESEND:\x20','approved','splice','analysis.analysisHistory','\x20=\x20','KI-Fehler\x20(Fallback)','ðŸ¤–\x20Morning\x20Briefing\x20skipped:\x20No\x20Gemini\x20Model.','text','Tag','PRIORITÃ„T:\x20Energie\x20sparen.\x20Schalte\x20nur,\x20wenn\x20absolut\x20notwendig\x20(Dunkelheit).','@google/generative-ai','slice','LTM.rawEventLog','%)\x20nach\x20\x22','BUTLER\x20Execution\x20Error:\x20','baselineDrift','Bisher\x20keine\x20AktivitÃ¤t\x20seit\x2008:00\x20Uhr\x20verzeichnet.','getStateAsync','setStateAsync','Gemini\x20Error:\x20','ROLLE:\x20KI-Hausverwalter.\x20PERSONA:\x20','analysis.health.geminiNight','debug'];a0_0x4f64=function(){return _0x80126c;};return a0_0x4f64();}function canCallApi(){const _0x3e46bb=a0_0x3e53df,_0x3cb13b=Date[_0x3e46bb(0x124)]();return _0x3cb13b-lastGlobalApiCall>MIN_API_GAP_MS;}function updateApiTimestamp(){lastGlobalApiCall=Date['now']();}async function getWeatherContext(_0x2797ad){const _0x29fd39=a0_0x3e53df;if(!_0x2797ad['config'][_0x29fd39(0x112)]||!_0x2797ad[_0x29fd39(0x166)][_0x29fd39(0x120)])return _0x29fd39(0x18b);try{const _0x353340=_0x2797ad['config']['weatherInstance'];let _0x269fcb=await _0x2797ad[_0x29fd39(0x13e)](_0x353340+_0x29fd39(0x10a));if(!_0x269fcb)_0x269fcb=await _0x2797ad[_0x29fd39(0x13e)](_0x353340+'.forecast.current.temperature');let _0x3aa56d=await _0x2797ad[_0x29fd39(0x13e)](_0x353340+'.Current.WeatherText');if(!_0x3aa56d)_0x3aa56d=await _0x2797ad['getForeignStateAsync'](_0x353340+'.forecast.current.state');let _0x43cc12='Unbekannt';const _0x237821=await _0x2797ad['getForeignStateAsync'](_0x353340+_0x29fd39(0x156));if(_0x237821)_0x43cc12=_0x237821[_0x29fd39(0x178)]?_0x29fd39(0x11b):_0x29fd39(0xf7);if(_0x269fcb&&_0x3aa56d)return _0x269fcb[_0x29fd39(0x178)]+_0x29fd39(0x106)+_0x3aa56d[_0x29fd39(0x178)]+',\x20LichtverhÃ¤ltnisse:\x20'+_0x43cc12;}catch(_0x45ab3b){}return _0x29fd39(0x12a);}async function consultButler(_0x50d23d,_0x27aad8,_0x1695d1,_0x246933){const _0x6892cb=a0_0x3e53df;if(!_0x50d23d[_0x6892cb(0x138)])return{'approved':!![],'reason':_0x6892cb(0x130)};const _0x53be29=Date[_0x6892cb(0x124)]();if(decisionCache[_0x27aad8]&&_0x53be29-decisionCache[_0x27aad8][_0x6892cb(0x18d)]<CACHE_TTL_MS){const _0x4dff7d=decisionCache[_0x27aad8][_0x6892cb(0x184)];return _0x50d23d[_0x6892cb(0x135)][_0x6892cb(0x105)](_0x6892cb(0x10e)+_0x27aad8+_0x6892cb(0x174)+(_0x4dff7d[_0x6892cb(0x191)]?'OK':'NO')+'\x20('+_0x4dff7d[_0x6892cb(0x15b)]+')'),_0x4dff7d;}if(!canCallApi())return _0x50d23d[_0x6892cb(0x135)]['debug']('ðŸ¤–\x20Traffic\x20Schutz:\x20Anfrage\x20fÃ¼r\x20'+_0x27aad8+'\x20Ã¼bersprungen\x20(Auto-Approved).'),{'approved':!![],'reason':_0x6892cb(0x119)};const _0x160e54=new Date()['toLocaleTimeString'](),_0x1eec66=await getWeatherContext(_0x50d23d),_0x5c590f=PERSONA_MAPPING[_0x50d23d['config'][_0x6892cb(0x10b)]||_0x6892cb(0x160)],_0x49581d=_0x6892cb(0x109)+_0x160e54+_0x6892cb(0x13b)+_0x1eec66+_0x6892cb(0x16d)+(_0x246933*0x64)['toFixed'](0x0)+_0x6892cb(0xfc)+_0x27aad8+_0x6892cb(0x17d)+_0x1695d1+_0x6892cb(0x167)+_0x5c590f+_0x6892cb(0x16f);try{updateApiTimestamp();const _0x4f55bb=await _0x50d23d[_0x6892cb(0x138)][_0x6892cb(0x18a)](_0x49581d),_0x1bbc39=_0x4f55bb[_0x6892cb(0x125)][_0x6892cb(0xf6)]()[_0x6892cb(0x145)](/```json|```/g,'')[_0x6892cb(0x16b)](),_0x42c076=JSON['parse'](_0x1bbc39);return decisionCache[_0x27aad8]={'decision':_0x42c076,'timestamp':_0x53be29},_0x42c076;}catch(_0x278067){return _0x50d23d['log'][_0x6892cb(0x187)]('ðŸ¤–\x20Butler\x20Brain\x20Error:\x20'+_0x278067[_0x6892cb(0x165)]),decisionCache[_0x27aad8]={'decision':{'approved':!![],'reason':_0x6892cb(0xf4)},'timestamp':_0x53be29-(CACHE_TTL_MS-0xea60)},{'approved':!![],'reason':_0x6892cb(0xf4)};}}async function runGeminiAnalysis(_0x4f555d,_0x54dffc=''){const _0xb01b1d=a0_0x3e53df;if(!_0x4f555d[_0xb01b1d(0x138)])return;if(!canCallApi()){_0x4f555d[_0xb01b1d(0x135)][_0xb01b1d(0x105)](_0xb01b1d(0x121));return;}if(_0x4f555d[_0xb01b1d(0x162)][_0xb01b1d(0x11d)]===0x0)return;const _0x21c428=_0x4f555d['eventHistory']['slice'](0x0,0xf),_0x3c4fe6=_0x4f555d[_0xb01b1d(0x153)],_0x38674a=PERSONA_MAPPING[_0x4f555d[_0xb01b1d(0x166)]['aiPersona']||_0xb01b1d(0x160)],_0x59c3dc=_0x4f555d[_0xb01b1d(0x166)][_0xb01b1d(0x123)]||_0xb01b1d(0x143);let _0x437081=_0xb01b1d(0x157);try{const _0x4736c7=await _0x4f555d['getStateAsync'](_0xb01b1d(0x17b));if(_0x4736c7&&_0x4736c7[_0xb01b1d(0x178)])_0x437081=_0x4736c7[_0xb01b1d(0x178)];}catch(_0x93e920){}let _0x58fd8f=![];try{const _0x559d11=await _0x4f555d['getStateAsync'](_0xb01b1d(0x18e));if(_0x559d11&&_0x559d11[_0xb01b1d(0x178)])_0x58fd8f=!![];}catch(_0x5502f4){}const _0x2f3dc0=_0xb01b1d(0x103)+_0x38674a+_0xb01b1d(0x10f)+_0x59c3dc+_0xb01b1d(0x141)+_0x3c4fe6+_0xb01b1d(0x190)+_0x437081+'.\x20EVENTS:\x20'+JSON[_0xb01b1d(0x12f)](_0x21c428)+_0xb01b1d(0x113)+_0x54dffc+'.\x20AUFGABE:\x201.\x20Gesundheit?\x202.\x20Komfort?\x20FORMAT\x20(JSON):\x20{\x20\x22isAlert\x22:\x20boolean,\x20\x22alertReason\x22:\x20\x22string\x22,\x20\x22isEmergency\x22:\x20boolean,\x20\x22summary\x22:\x20\x22string\x22,\x20\x22automationProposal\x22:\x20{\x20\x22detected\x22:\x20boolean,\x20\x22description\x22:\x20\x22string\x22,\x20\x22targetId\x22:\x20\x22string\x22,\x20\x22targetValue\x22:\x20\x22any\x22\x20}\x20}';try{updateApiTimestamp();const _0x17761f=await _0x4f555d[_0xb01b1d(0x138)][_0xb01b1d(0x18a)](_0x2f3dc0),_0x188a00=JSON[_0xb01b1d(0x139)](_0x17761f[_0xb01b1d(0x125)]['text']()[_0xb01b1d(0x145)](/```json|```/g,'')[_0xb01b1d(0x16b)]());await _0x4f555d[_0xb01b1d(0x101)](_0xb01b1d(0x15c),{'val':JSON[_0xb01b1d(0x12f)](_0x188a00),'ack':!![]});if(_0x188a00[_0xb01b1d(0x12b)])await _0x4f555d['setStateAsync'](_0xb01b1d(0x17e),{'val':_0x188a00[_0xb01b1d(0x12b)],'ack':!![]});const _0x177d4e={'timestamp':Date['now'](),'id':Date[_0xb01b1d(0x124)]()[_0xb01b1d(0x155)](),'analysis':{'activity':{'summary':_0x188a00[_0xb01b1d(0x12b)],'isAlert':_0x188a00[_0xb01b1d(0x188)],'alertReason':_0x188a00['alertReason']},'comfort':{'automationProposal':_0x188a00['automationProposal']}}};_0x4f555d[_0xb01b1d(0x154)][_0xb01b1d(0x152)](_0x177d4e);if(_0x4f555d[_0xb01b1d(0x154)]['length']>0x32)_0x4f555d[_0xb01b1d(0x154)][_0xb01b1d(0x171)]();await _0x4f555d[_0xb01b1d(0x101)](_0xb01b1d(0xf2),{'val':JSON['stringify'](_0x4f555d[_0xb01b1d(0x154)]),'ack':!![]});const _0x2899d0=_0x188a00[_0xb01b1d(0x188)]||![];_0x2899d0!==_0x4f555d[_0xb01b1d(0x110)]&&(await _0x4f555d[_0xb01b1d(0x101)](_0xb01b1d(0x10d),{'val':_0x2899d0,'ack':!![]}),_0x4f555d[_0xb01b1d(0x110)]=_0x2899d0,_0x2899d0&&(await _0x4f555d[_0xb01b1d(0x101)]('analysis.alertReason',{'val':_0x188a00['alertReason'],'ack':!![]}),setup[_0xb01b1d(0x11c)](_0x4f555d,_0xb01b1d(0x12d)+_0x188a00[_0xb01b1d(0x11e)],![],_0x188a00[_0xb01b1d(0x118)])));if(_0x188a00[_0xb01b1d(0x149)]&&_0x188a00[_0xb01b1d(0x149)][_0xb01b1d(0x15f)]){await _0x4f555d[_0xb01b1d(0x101)](_0xb01b1d(0x142),{'val':!![],'ack':!![]}),await _0x4f555d['setStateAsync']('analysis.automation.description',{'val':_0x188a00[_0xb01b1d(0x149)][_0xb01b1d(0x18c)],'ack':!![]}),await _0x4f555d['setStateAsync'](_0xb01b1d(0x14d),{'val':_0x188a00['automationProposal'][_0xb01b1d(0x183)],'ack':!![]}),await _0x4f555d['setStateAsync'](_0xb01b1d(0x181),{'val':JSON['stringify'](_0x188a00['automationProposal']['targetValue']),'ack':!![]});if(_0x58fd8f)executeAutomationAction(_0x4f555d);}}catch(_0x15ef67){_0x4f555d['log'][_0xb01b1d(0x189)](_0xb01b1d(0x102)+_0x15ef67[_0xb01b1d(0x165)]);}}async function createDailyDigest(_0x4212ca,_0x48d99d){const _0x176ac2=a0_0x3e53df;if(!_0x4212ca['isProVersion'])return;if(!canCallApi()){await _0x4212ca[_0x176ac2(0x101)](LTM_DP_STATUS,{'val':_0x176ac2(0x16c),'ack':!![]});return;}await _0x4212ca[_0x176ac2(0x101)](LTM_DP_STATUS,{'val':_0x176ac2(0x13f),'ack':!![]});if(!_0x4212ca[_0x176ac2(0x138)]||_0x4212ca['rawEventLog'][_0x176ac2(0x11d)]<LTM_MIN_EVENTS_FOR_COMPRESSION){await _0x4212ca[_0x176ac2(0x101)](LTM_DP_STATUS,{'val':_0x176ac2(0x11a),'ack':!![]});return;}const _0x5dfa1a=JSON[_0x176ac2(0x139)](JSON[_0x176ac2(0x12f)](_0x4212ca['rawEventLog'])),_0x375864=_0x5dfa1a[_0x176ac2(0x11d)],_0x2de66b='ROLLE:\x20Data\x20Compression\x20Agent.\x20SPRACHE:\x20DE.\x20FORMAT:\x20JSON.\x20ANWEISUNG:\x20Fasse\x20Sensor-Events\x20zusammen.\x20SCHEMA:\x20{\x20\x22summary\x22:\x20\x22string\x22,\x20\x22activityLevel\x22:\x20\x22string\x22\x20}\x20\x0a\x0aEVENTS:\x0a'+JSON[_0x176ac2(0x12f)](_0x5dfa1a);try{updateApiTimestamp();const _0x256e47=await _0x4212ca['geminiModel']['generateContent'](_0x2de66b),_0x58bd01=JSON[_0x176ac2(0x139)](_0x256e47[_0x176ac2(0x125)][_0x176ac2(0xf6)]()[_0x176ac2(0x145)](/```json|```/g,'')[_0x176ac2(0x16b)]()),_0x201575={'timestamp':new Date()[_0x176ac2(0x16e)](),'eventCount':_0x375864,'summary':_0x58bd01['summary']||'Digest','activityLevel':_0x58bd01['activityLevel']||_0x176ac2(0x10c),'systemMode':_0x4212ca[_0x176ac2(0x153)]};_0x4212ca[_0x176ac2(0x179)][_0x176ac2(0x132)](_0x201575);const _0x110752=_0x4212ca[_0x176ac2(0x166)]['ltmLtbWindowDays']||0x3c;_0x4212ca[_0x176ac2(0x179)]['length']>_0x110752&&_0x4212ca[_0x176ac2(0x179)][_0x176ac2(0xf1)](0x0,_0x4212ca[_0x176ac2(0x179)]['length']-_0x110752);await _0x4212ca['setStateAsync'](LTM_DP_DAILY_DIGESTS,{'val':JSON['stringify'](_0x4212ca['dailyDigests']),'ack':!![]}),_0x4212ca[_0x176ac2(0x13c)]=[],await _0x4212ca[_0x176ac2(0x101)](LTM_DP_RAW_LOG,{'val':JSON[_0x176ac2(0x12f)](_0x4212ca[_0x176ac2(0x13c)]),'ack':!![]}),await _0x4212ca['setStateAsync'](LTM_DP_STATUS,{'val':'Success','ack':!![]});const _0x2a653c=_0x176ac2(0x12c)+_0x58bd01['summary']+_0x176ac2(0x128)+_0x58bd01[_0x176ac2(0x170)];setup['sendNotification'](_0x4212ca,_0x2a653c,![],![]);if(_0x4212ca[_0x176ac2(0x151)]&&_0x48d99d)_0x48d99d[_0x176ac2(0x11f)](_0x4212ca,_0x176ac2(0x172),{'digest':_0x201575});}catch(_0x2d5e10){_0x4212ca[_0x176ac2(0x135)][_0x176ac2(0x189)](_0x2d5e10[_0x176ac2(0x165)]);}}async function runBaselineDriftAnalysis(_0x4ff238){const _0x3fe55d=a0_0x3e53df;if(!_0x4ff238['isProVersion']||!_0x4ff238[_0x3fe55d(0x138)])return;if(!canCallApi())return;const _0x1191be=_0x4ff238['config']['ltmStbWindowDays']||0xe;if(_0x4ff238['dailyDigests'][_0x3fe55d(0x11d)]<_0x1191be+0x7){await _0x4ff238[_0x3fe55d(0x101)](_0x3fe55d(0x18f),{'val':'N/A\x20(Learning)','ack':!![]});return;}const _0x2a69ca=_0x4ff238[_0x3fe55d(0x179)][_0x3fe55d(0xfa)](-_0x1191be),_0x7d881e=_0x4ff238[_0x3fe55d(0x179)][_0x3fe55d(0xfa)](0x0,_0x4ff238[_0x3fe55d(0x179)][_0x3fe55d(0x11d)]-_0x1191be),_0x411f52=_0x3fe55d(0x127)+JSON[_0x3fe55d(0x12f)](_0x7d881e)+_0x3fe55d(0x147)+JSON[_0x3fe55d(0x12f)](_0x2a69ca);try{updateApiTimestamp();const _0x4ec231=await _0x4ff238['geminiModel'][_0x3fe55d(0x18a)](_0x411f52),_0x388f06=JSON[_0x3fe55d(0x139)](_0x4ec231[_0x3fe55d(0x125)][_0x3fe55d(0xf6)]()[_0x3fe55d(0x145)](/```json|```/g,'')[_0x3fe55d(0x16b)]());_0x388f06[_0x3fe55d(0xfe)]&&(await _0x4ff238[_0x3fe55d(0x101)]('LTM.driftAnalysis.baselineDrift',{'val':_0x388f06[_0x3fe55d(0xfe)],'ack':!![]}),await _0x4ff238[_0x3fe55d(0x101)](_0x3fe55d(0x136),{'val':_0x388f06[_0x3fe55d(0x15e)],'ack':!![]}),await _0x4ff238[_0x3fe55d(0x101)](_0x3fe55d(0x114),{'val':Date[_0x3fe55d(0x124)](),'ack':!![]}));}catch(_0xe6372e){}}async function executeAutomationAction(_0x5afe3d){const _0x1e6e3d=a0_0x3e53df;try{const _0x5280c5=await _0x5afe3d[_0x1e6e3d(0x100)](_0x1e6e3d(0x14d)),_0x130011=await _0x5afe3d[_0x1e6e3d(0x100)](_0x1e6e3d(0x181));if(_0x5280c5&&_0x5280c5[_0x1e6e3d(0x178)]&&_0x130011){const _0x5a8454=_0x5280c5[_0x1e6e3d(0x178)];let _0x5f5387=_0x130011['val'];try{_0x5f5387=JSON['parse'](_0x5f5387);}catch(_0x1b977e){}_0x5afe3d[_0x1e6e3d(0x135)][_0x1e6e3d(0x108)]('ðŸ¤–\x20BUTLER:\x20Executing\x20Action\x20->\x20'+_0x5a8454+_0x1e6e3d(0xf3)+_0x5f5387),await _0x5afe3d['setForeignStateAsync'](_0x5a8454,_0x5f5387);}else _0x5afe3d[_0x1e6e3d(0x135)][_0x1e6e3d(0x187)]('ðŸ¤–\x20BUTLER:\x20No\x20valid\x20target\x20ID\x20or\x20value\x20stored\x20for\x20execution.');}catch(_0x11c447){_0x5afe3d['log'][_0x1e6e3d(0x189)](_0x1e6e3d(0xfd)+_0x11c447[_0x1e6e3d(0x165)]);}}async function sendMorningBriefing(_0x42b239){const _0x9a37f=a0_0x3e53df;if(!_0x42b239[_0x9a37f(0x138)]){_0x42b239[_0x9a37f(0x135)]['warn'](_0x9a37f(0xf5));return;}_0x42b239[_0x9a37f(0x135)][_0x9a37f(0x108)](_0x9a37f(0x163));try{updateApiTimestamp();const _0x4e5365=_0x9a37f(0x12e),_0x355423=await _0x42b239['geminiModel'][_0x9a37f(0x18a)](_0x4e5365),_0x46e43a=_0x355423[_0x9a37f(0x125)][_0x9a37f(0xf6)]();_0x42b239[_0x9a37f(0x135)]['info'](_0x9a37f(0x175)+_0x46e43a[_0x9a37f(0x11d)]+').\x20Sending\x20notification...'),setup[_0x9a37f(0x11c)](_0x42b239,'ðŸŒ…\x20Morning\x20Briefing:\x0a'+_0x46e43a);}catch(_0x1fb231){_0x42b239[_0x9a37f(0x135)][_0x9a37f(0x189)](_0x9a37f(0x164)+_0x1fb231[_0x9a37f(0x165)]);}}async function generateHealthReport(_0x3eb129,_0x37d9ff){const _0x6fd45e=a0_0x3e53df;if(!_0x3eb129[_0x6fd45e(0x138)])return;const _0x156317=Date[_0x6fd45e(0x124)]();_0x156317-lastGlobalApiCall<0xbb8&&(_0x3eb129[_0x6fd45e(0x135)]['debug'](_0x6fd45e(0x14a)),await new Promise(_0x63a304=>setTimeout(_0x63a304,0x7d0)));const _0x16c59c=new Date();let _0xe9e8d5=0x0,_0x38a690=_0x16c59c[_0x6fd45e(0x17a)](),_0x3f67ec='';if(_0x37d9ff===_0x6fd45e(0x146)){const _0x1810e8=new Date(_0x16c59c);_0x1810e8[_0x6fd45e(0x169)](_0x1810e8[_0x6fd45e(0x185)]()-0x1),_0x1810e8['setHours'](0x16,0x0,0x0,0x0),_0xe9e8d5=_0x1810e8['getTime']();const _0x5a5e15=new Date(_0x16c59c);_0x5a5e15[_0x6fd45e(0x168)](0x8,0x0,0x0,0x0),_0x38a690=_0x5a5e15[_0x6fd45e(0x17a)](),_0x3f67ec=_0x6fd45e(0x144);}else{const _0x5d03f4=new Date(_0x16c59c);_0x5d03f4[_0x6fd45e(0x168)](0x8,0x0,0x0,0x0),_0xe9e8d5=_0x5d03f4[_0x6fd45e(0x17a)](),_0x3f67ec=_0x6fd45e(0x14c);}const _0x3369a6=_0x3eb129[_0x6fd45e(0x162)][_0x6fd45e(0x116)](_0xd96f7e=>_0xd96f7e['timestamp']>=_0xe9e8d5&&_0xd96f7e[_0x6fd45e(0x18d)]<=_0x38a690);if(_0x3369a6[_0x6fd45e(0x11d)]===0x0){const _0x1f4650=_0x37d9ff===_0x6fd45e(0x146)?_0x6fd45e(0x14b):_0x6fd45e(0xff),_0x4a9dd4=_0x37d9ff===_0x6fd45e(0x146)?_0x6fd45e(0x104):_0x6fd45e(0x16a);await _0x3eb129[_0x6fd45e(0x101)](_0x4a9dd4,{'val':_0x1f4650,'ack':!![]});return;}const _0x1a32db=_0x3369a6[_0x6fd45e(0x137)](_0x528b5f=>new Date(_0x528b5f['timestamp'])[_0x6fd45e(0x158)]([],{'hour':_0x6fd45e(0x131),'minute':'2-digit'})+'\x20'+_0x528b5f[_0x6fd45e(0x14f)]+'\x20('+_0x528b5f['value']+')')[_0x6fd45e(0x15d)]('\x0a'),_0x5ba1f4='\x0a\x20\x20\x20\x20ROLLE:\x20Medizinischer\x20Assistent\x20fÃ¼r\x20AAL\x20(Ambient\x20Assisted\x20Living).\x0a\x20\x20\x20\x20AUFGABE:\x20'+_0x3f67ec+_0x6fd45e(0x140)+_0x1a32db+'\x0a\x20\x20\x20\x20ANTWORT-STIL:\x20Sachlich,\x20beruhigend,\x20prÃ¤zise.\x20Keine\x20Floskeln.\x0a\x20\x20\x20\x20';try{updateApiTimestamp();const _0x296fac=await _0x3eb129[_0x6fd45e(0x138)][_0x6fd45e(0x18a)](_0x5ba1f4),_0x49bbde=_0x296fac[_0x6fd45e(0x125)][_0x6fd45e(0xf6)](),_0x31aef3=_0x37d9ff===_0x6fd45e(0x146)?_0x6fd45e(0x104):_0x6fd45e(0x16a);await _0x3eb129['setStateAsync'](_0x31aef3,{'val':_0x49bbde,'ack':!![]}),_0x3eb129[_0x6fd45e(0x135)][_0x6fd45e(0x108)](_0x6fd45e(0x134)+_0x37d9ff+_0x6fd45e(0x122));}catch(_0x29f0b2){_0x3eb129[_0x6fd45e(0x135)][_0x6fd45e(0x189)]('Health\x20Report\x20Error:\x20'+_0x29f0b2['message']);}}module['exports']={'executeAutomationAction':executeAutomationAction,'createDailyDigest':createDailyDigest,'runBaselineDriftAnalysis':runBaselineDriftAnalysis,'sendMorningBriefing':sendMorningBriefing,'runGeminiAnalysis':runGeminiAnalysis,'consultButler':consultButler,'generateHealthReport':generateHealthReport};