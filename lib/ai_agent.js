const a0_0x20bb79=a0_0x2c36;(function(_0xf3bc90,_0x344100){const _0x139eac=a0_0x2c36,_0x2ebb54=_0xf3bc90();while(!![]){try{const _0x4619f1=parseInt(_0x139eac(0x157))/0x1+-parseInt(_0x139eac(0x14f))/0x2+parseInt(_0x139eac(0x153))/0x3+parseInt(_0x139eac(0x16b))/0x4+-parseInt(_0x139eac(0x125))/0x5*(-parseInt(_0x139eac(0x105))/0x6)+-parseInt(_0x139eac(0x11a))/0x7+parseInt(_0x139eac(0x11f))/0x8*(-parseInt(_0x139eac(0x134))/0x9);if(_0x4619f1===_0x344100)break;else _0x2ebb54['push'](_0x2ebb54['shift']());}catch(_0x476dca){_0x2ebb54['push'](_0x2ebb54['shift']());}}}(a0_0x4df7,0x5a456));const a0_0x298398=(function(){let _0x281dd7=!![];return function(_0x40fa68,_0x585ba9){const _0x3db594=_0x281dd7?function(){const _0x48e3c6=a0_0x2c36;if(_0x585ba9){const _0x2b344a=_0x585ba9[_0x48e3c6(0x119)](_0x40fa68,arguments);return _0x585ba9=null,_0x2b344a;}}:function(){};return _0x281dd7=![],_0x3db594;};}()),a0_0xea61c4=a0_0x298398(this,function(){const _0x599eef=a0_0x2c36;return a0_0xea61c4['toString']()[_0x599eef(0x16d)](_0x599eef(0x101))[_0x599eef(0x185)]()[_0x599eef(0x159)](a0_0xea61c4)['search'](_0x599eef(0x101));});a0_0xea61c4();'use strict';const {GoogleGenerativeAI}=require(a0_0x20bb79(0x167)),setup=require(a0_0x20bb79(0x170)),GEMINI_MODEL='models/gemini-flash-latest',LTM_DP_DAILY_DIGESTS=a0_0x20bb79(0x160),LTM_DP_STATUS=a0_0x20bb79(0xfd),LTM_DP_RAW_LOG=a0_0x20bb79(0x163),LTM_MIN_EVENTS_FOR_COMPRESSION=0x5,MIN_API_GAP_MS=0x4e20;let lastGlobalApiCall=0x0;const decisionCache={},CACHE_TTL_MS=0xf*0x3c*0x3e8,PERSONA_MAPPING={'generic':'Entscheide\x20ausgewogen\x20zwischen\x20Komfort\x20und\x20Energie.','senior_aal':a0_0x20bb79(0x122),'family':a0_0x20bb79(0x113),'single_comfort':a0_0x20bb79(0x137),'security':'Sicherheit\x20geht\x20vor.','energy_saver':'PRIORIT√ÑT:\x20Energie\x20sparen.\x20Schalte\x20nur,\x20wenn\x20absolut\x20notwendig\x20(Dunkelheit).'};function canCallApi(){const _0x3b0187=a0_0x20bb79,_0x582184=Date[_0x3b0187(0x175)]();return _0x582184-lastGlobalApiCall>MIN_API_GAP_MS;}function a0_0x2c36(_0x4c1a6f,_0x497aef){const _0x58f122=a0_0x4df7();return a0_0x2c36=function(_0xea61c4,_0x298398){_0xea61c4=_0xea61c4-0xf9;let _0x4df7c2=_0x58f122[_0xea61c4];return _0x4df7c2;},a0_0x2c36(_0x4c1a6f,_0x497aef);}function updateApiTimestamp(){const _0x14169f=a0_0x20bb79;lastGlobalApiCall=Date[_0x14169f(0x175)]();}async function getWeatherContext(_0x948b23){const _0x5abacd=a0_0x20bb79;if(!_0x948b23[_0x5abacd(0x10d)]['useWeather']||!_0x948b23[_0x5abacd(0x10d)][_0x5abacd(0x10a)])return _0x5abacd(0x174);try{const _0xf8f75e=_0x948b23[_0x5abacd(0x10d)]['weatherInstance'];let _0x1f6ace=await _0x948b23[_0x5abacd(0x18d)](_0xf8f75e+_0x5abacd(0x139));if(!_0x1f6ace)_0x1f6ace=await _0x948b23['getForeignStateAsync'](_0xf8f75e+_0x5abacd(0x18e));let _0x147c03=await _0x948b23['getForeignStateAsync'](_0xf8f75e+_0x5abacd(0x150));if(!_0x147c03)_0x147c03=await _0x948b23[_0x5abacd(0x18d)](_0xf8f75e+_0x5abacd(0xfe));let _0x12d90b='Unbekannt';const _0x1e63a8=await _0x948b23['getForeignStateAsync'](_0xf8f75e+'.Current.IsNight');if(_0x1e63a8)_0x12d90b=_0x1e63a8['val']?_0x5abacd(0x179):_0x5abacd(0xff);if(_0x1f6ace&&_0x147c03)return _0x1f6ace[_0x5abacd(0x177)]+'¬∞C,\x20'+_0x147c03[_0x5abacd(0x177)]+_0x5abacd(0xfb)+_0x12d90b;}catch(_0x1cb212){}return'Wetterdaten\x20nicht\x20abrufbar';}async function consultButler(_0x5c3150,_0x3b842b,_0x397041,_0x1d7e31){const _0x1efe61=a0_0x20bb79;if(!_0x5c3150[_0x1efe61(0x17e)])return{'approved':!![],'reason':_0x1efe61(0x136)};const _0x4c4c5b=Date['now']();if(decisionCache[_0x3b842b]&&_0x4c4c5b-decisionCache[_0x3b842b]['timestamp']<CACHE_TTL_MS){const _0x24888e=decisionCache[_0x3b842b][_0x1efe61(0x181)];return _0x5c3150[_0x1efe61(0x143)][_0x1efe61(0x138)](_0x1efe61(0x120)+_0x3b842b+_0x1efe61(0x156)+(_0x24888e[_0x1efe61(0x182)]?'OK':'NO')+'\x20('+_0x24888e['reason']+')'),_0x24888e;}if(!canCallApi())return _0x5c3150[_0x1efe61(0x143)][_0x1efe61(0x138)](_0x1efe61(0x126)+_0x3b842b+_0x1efe61(0x172)),{'approved':!![],'reason':_0x1efe61(0x117)};const _0x434d2f=new Date()[_0x1efe61(0xf9)](),_0x5605c1=await getWeatherContext(_0x5c3150),_0x1b3bad=PERSONA_MAPPING[_0x5c3150[_0x1efe61(0x10d)][_0x1efe61(0x13f)]||_0x1efe61(0x149)],_0x337dd6='\x0a\x20\x20\x20\x20ROLLE:\x20Haus-Butler.\x0a\x20\x20\x20\x20SITUATION:\x20'+_0x434d2f+',\x20Wetter:\x20'+_0x5605c1+_0x1efe61(0x14e)+(_0x1d7e31*0x64)['toFixed'](0x0)+_0x1efe61(0x11e)+_0x3b842b+_0x1efe61(0x128)+_0x397041+'\x22\x20AN.\x0a\x20\x20\x20\x20STRATEGIE:\x20'+_0x1b3bad+_0x1efe61(0x15c);try{updateApiTimestamp();const _0x147b10=await _0x5c3150[_0x1efe61(0x17e)][_0x1efe61(0x12f)](_0x337dd6),_0x1f0d6a=_0x147b10[_0x1efe61(0x10b)][_0x1efe61(0x106)]()[_0x1efe61(0x145)](/```json|```/g,'')['trim'](),_0x26eed1=JSON[_0x1efe61(0x10c)](_0x1f0d6a);return decisionCache[_0x3b842b]={'decision':_0x26eed1,'timestamp':_0x4c4c5b},_0x26eed1;}catch(_0x366b3d){return _0x5c3150[_0x1efe61(0x143)][_0x1efe61(0x16c)]('ü§ñ\x20Butler\x20Brain\x20Error:\x20'+_0x366b3d['message']),decisionCache[_0x3b842b]={'decision':{'approved':!![],'reason':'KI-Fehler\x20(Fallback)'},'timestamp':_0x4c4c5b-(CACHE_TTL_MS-0xea60)},{'approved':!![],'reason':'KI-Fehler\x20(Fallback)'};}}async function runGeminiAnalysis(_0x2ea6dd,_0x30c256=''){const _0x1d5d84=a0_0x20bb79;if(!_0x2ea6dd[_0x1d5d84(0x17e)])return;if(!canCallApi()){_0x2ea6dd[_0x1d5d84(0x143)][_0x1d5d84(0x138)](_0x1d5d84(0x144));return;}if(_0x2ea6dd[_0x1d5d84(0x17a)][_0x1d5d84(0x115)]===0x0)return;const _0x559543=_0x2ea6dd['eventHistory'][_0x1d5d84(0x15b)](0x0,0xf),_0x163e0f=_0x2ea6dd[_0x1d5d84(0x110)],_0x438875=PERSONA_MAPPING[_0x2ea6dd['config'][_0x1d5d84(0x13f)]||_0x1d5d84(0x149)],_0x5987c6=_0x2ea6dd['config']['livingContext']||_0x1d5d84(0x116);let _0x140c10=_0x1d5d84(0x162);try{const _0x137a65=await _0x2ea6dd[_0x1d5d84(0x166)]('system.presenceWho');if(_0x137a65&&_0x137a65['val'])_0x140c10=_0x137a65[_0x1d5d84(0x177)];}catch(_0x56375d){}let _0x601bbd=![];try{const _0x301100=await _0x2ea6dd[_0x1d5d84(0x166)](_0x1d5d84(0x183));if(_0x301100&&_0x301100[_0x1d5d84(0x177)])_0x601bbd=!![];}catch(_0x58b91f){}const _0xe12036=_0x1d5d84(0x17d)+_0x438875+'.\x20KONTEXT:\x20'+_0x5987c6+_0x1d5d84(0x18a)+_0x163e0f+'.\x20ANWESEND:\x20'+_0x140c10+'.\x20EVENTS:\x20'+JSON[_0x1d5d84(0x13c)](_0x559543)+'.\x20EMERGENCY:\x20'+_0x30c256+_0x1d5d84(0x129);try{updateApiTimestamp();const _0x4c22d6=await _0x2ea6dd[_0x1d5d84(0x17e)][_0x1d5d84(0x12f)](_0xe12036),_0x2879b7=JSON[_0x1d5d84(0x10c)](_0x4c22d6['response'][_0x1d5d84(0x106)]()['replace'](/```json|```/g,'')[_0x1d5d84(0x189)]());await _0x2ea6dd['setStateAsync'](_0x1d5d84(0x11b),{'val':JSON[_0x1d5d84(0x13c)](_0x2879b7),'ack':!![]});if(_0x2879b7[_0x1d5d84(0x187)])await _0x2ea6dd[_0x1d5d84(0x18c)]('analysis.activitySummary',{'val':_0x2879b7[_0x1d5d84(0x187)],'ack':!![]});const _0x4a5da0={'timestamp':Date['now'](),'id':Date[_0x1d5d84(0x175)]()['toString'](),'analysis':{'activity':{'summary':_0x2879b7['summary'],'isAlert':_0x2879b7[_0x1d5d84(0x133)],'alertReason':_0x2879b7['alertReason']},'comfort':{'automationProposal':_0x2879b7[_0x1d5d84(0x11d)]}}};_0x2ea6dd[_0x1d5d84(0x178)][_0x1d5d84(0x13d)](_0x4a5da0);if(_0x2ea6dd[_0x1d5d84(0x178)][_0x1d5d84(0x115)]>0x32)_0x2ea6dd['analysisHistory'][_0x1d5d84(0x102)]();await _0x2ea6dd[_0x1d5d84(0x18c)](_0x1d5d84(0x191),{'val':JSON[_0x1d5d84(0x13c)](_0x2ea6dd[_0x1d5d84(0x178)]),'ack':!![]});const _0x539451=_0x2879b7[_0x1d5d84(0x133)]||![];_0x539451!==_0x2ea6dd[_0x1d5d84(0xfa)]&&(await _0x2ea6dd['setStateAsync'](_0x1d5d84(0x164),{'val':_0x539451,'ack':!![]}),_0x2ea6dd[_0x1d5d84(0xfa)]=_0x539451,_0x539451&&(await _0x2ea6dd[_0x1d5d84(0x18c)](_0x1d5d84(0x141),{'val':_0x2879b7[_0x1d5d84(0x130)],'ack':!![]}),setup['sendNotification'](_0x2ea6dd,_0x1d5d84(0x195)+_0x2879b7[_0x1d5d84(0x130)],![],_0x2879b7[_0x1d5d84(0x14c)])));if(_0x2879b7['automationProposal']&&_0x2879b7['automationProposal'][_0x1d5d84(0x12d)]){await _0x2ea6dd[_0x1d5d84(0x18c)]('analysis.automation.patternDetected',{'val':!![],'ack':!![]}),await _0x2ea6dd['setStateAsync']('analysis.automation.description',{'val':_0x2879b7[_0x1d5d84(0x11d)][_0x1d5d84(0x180)],'ack':!![]}),await _0x2ea6dd[_0x1d5d84(0x18c)]('analysis.automation.targetId',{'val':_0x2879b7['automationProposal'][_0x1d5d84(0x148)],'ack':!![]}),await _0x2ea6dd['setStateAsync'](_0x1d5d84(0x140),{'val':JSON[_0x1d5d84(0x13c)](_0x2879b7['automationProposal'][_0x1d5d84(0x12a)]),'ack':!![]});if(_0x601bbd)executeAutomationAction(_0x2ea6dd);}}catch(_0xc643d9){_0x2ea6dd[_0x1d5d84(0x143)][_0x1d5d84(0x15a)](_0x1d5d84(0x13a)+_0xc643d9['message']);}}function a0_0x4df7(){const _0x119526=[',\x20Lichtverh√§ltnisse:\x20','üåÖ\x20Starting\x20Morning\x20Briefing\x20sequence\x20(Traffic\x20Check\x20bypassed)...','LTM.processingStatus','.forecast.current.state','Tag','normal','(((.+)+)+)+$','pop','isProVersion','Analysiere\x20diese\x20Events\x20der\x20NACHT\x20(22:00-08:00).\x20War\x20der\x20Schlaf\x20ruhig?\x20Gab\x20es\x20Badg√§nge?\x20Antwort\x20kurz\x20f√ºr\x20den\x20besorgten\x20Sohn\x20(max\x202\x20S√§tze).','294EvLOEu','text','LTM.driftAnalysis.baselineDrift','\x0a\x20\x20\x20\x20ANTWORT-STIL:\x20Sachlich,\x20beruhigend,\x20pr√§zise.\x20Keine\x20Floskeln.\x0a\x20\x20\x20\x20','üìÖ\x20Daily\x20Digest:\x0a','weatherInstance','response','parse','config','sendNotification','LTM.driftAnalysis.driftDetails','currentSystemMode','ü§ñ\x20Morning\x20Briefing\x20skipped:\x20No\x20Gemini\x20Model.','join','Fokus\x20auf\x20Komfort\x20f√ºr\x20die\x20Familie.','setForeignStateAsync','length','Keine\x20Details.','Traffic-Schutz\x20(Auto-Approved)','Erstelle\x20ein\x20kurzes\x20\x27Guten\x20Morgen\x27\x20Briefing\x20basierend\x20auf\x20den\x20Events\x20der\x20letzten\x20Nacht.','apply','912744wbOLiI','analysis.lastResult','ltmStbWindowDays','automationProposal','%)\x20nach\x20\x22','8IYLMKT','ü§ñ\x20Butler\x20Cache\x20Hit:\x20','setDate','PRIORIT√ÑT:\x20Sicherheit\x20und\x20Licht.\x20Schalte\x20lieber\x20einmal\x20zu\x20viel\x20als\x20zu\x20wenig.','getTime','ü§ñ\x20BUTLER:\x20No\x20valid\x20target\x20ID\x20or\x20value\x20stored\x20for\x20execution.','58945tLPpVb','ü§ñ\x20Traffic\x20Schutz:\x20Anfrage\x20f√ºr\x20','exports','\x22.\x0a\x20\x20\x20\x20AKTION:\x20Schalte\x20\x22','.\x20AUFGABE:\x201.\x20Gesundheit?\x202.\x20Komfort?\x20FORMAT\x20(JSON):\x20{\x20\x22isAlert\x22:\x20boolean,\x20\x22alertReason\x22:\x20\x22string\x22,\x20\x22isEmergency\x22:\x20boolean,\x20\x22summary\x22:\x20\x22string\x22,\x20\x22automationProposal\x22:\x20{\x20\x22detected\x22:\x20boolean,\x20\x22description\x22:\x20\x22string\x22,\x20\x22targetId\x22:\x20\x22string\x22,\x20\x22targetValue\x22:\x20\x22any\x22\x20}\x20}','targetValue','info','analysis.health.geminiNight','detected','\x20=\x20','generateContent','alertReason','message','push','isAlert','5143482uAHZqQ','Keine\x20Daten\x20f√ºr\x20die\x20Nacht\x20aufgezeichnet\x20(Sensoren\x20ruhig).','KI\x20offline\x20(Fallback)','Maximaler\x20Komfort,\x20Energie\x20ist\x20zweitrangig.','debug','.Current.Temperature','Gemini\x20Error:\x20','Success','stringify','unshift','ü§ñ\x20Health\x20Report\x20(','aiPersona','analysis.automation.targetValue','analysis.alertReason','ü§ñ\x20BUTLER:\x20Executing\x20Action\x20->\x20','log','ü§ñ\x20Autopilot\x20skipped\x20(Traffic\x20Protection\x20active).','replace','Started...','ü§ñ\x20API\x20Cooldown.\x20Waiting\x202s...','targetId','generic','NIGHT','N/A\x20(Learning)','isEmergency','toISOString','.\x0a\x20\x20\x20\x20EVENT:\x20Bewohner\x20geht\x20wahrscheinlich\x20(','357738XtJWtg','.Current.WeatherText','2-digit','rawEventLog','283179cmbVlE','setHours','Digest','\x20->\x20','267701cCWrOo','\x0a\x20\x20\x20\x20EVENTS:\x0a','constructor','error','slice','\x0a\x20\x20\x20\x20FRAGE:\x20Ist\x20es\x20dunkel\x20genug\x20f√ºr\x20Licht?\x0a\x20\x20\x20\x20FORMAT:\x20{\x20\x22approved\x22:\x20boolean,\x20\x22reason\x22:\x20\x22kurzer\x20Grund\x22\x20}\x0a\x20\x20\x20\x20','Analysiere\x20diese\x20Events\x20des\x20TAGES\x20(08:00-Jetzt).\x20Aktivit√§t?\x20Mahlzeiten?\x20Haust√ºr?\x20Antwort\x20kurz\x20f√ºr\x20den\x20besorgten\x20Sohn\x20(max\x202\x20S√§tze).','LTM.driftAnalysis.lastCheck','Bisher\x20keine\x20Aktivit√§t\x20seit\x2008:00\x20Uhr\x20verzeichnet.','LTM.dailyDigests','analysis.automation.targetId','Unbekannt','LTM.rawEventLog','analysis.isAlert','\x0aAktivit√§t:\x20','getStateAsync','@google/generative-ai','\x0aSTB:\x20',')\x20generated.','getDate','1243016caPNmd','warn','search','timestamp','driftDetails','./setup','üåÖ\x20Briefing\x20generated\x20(Length:\x20','\x20√ºbersprungen\x20(Auto-Approved).','BUTLER\x20Execution\x20Error:\x20','Unbekannt\x20(Kein\x20Sensor)','now','map','val','analysisHistory','Nacht','eventHistory','ANALYZE_HEALTH','name','ROLLE:\x20KI-Hausverwalter.\x20PERSONA:\x20','geminiModel','ROLLE:\x20Data\x20Compression\x20Agent.\x20SPRACHE:\x20DE.\x20FORMAT:\x20JSON.\x20ANWEISUNG:\x20Fasse\x20Sensor-Events\x20zusammen.\x20SCHEMA:\x20{\x20\x22summary\x22:\x20\x22string\x22,\x20\x22activityLevel\x22:\x20\x22string\x22\x20}\x20\x0a\x0aEVENTS:\x0a','description','decision','approved','analysis.automation.autoApply','baselineDrift','toString','ltmLtbWindowDays','summary','activityLevel','trim','.\x20SYSTEM_MODE:\x20','ROLLE:\x20Data\x20Scientist.\x20ZIEL:\x20Drift\x20erkennen.\x20SCHEMA:\x20{\x20\x22baselineDrift\x22:\x20\x22none|slight|significant|critical\x22,\x20\x22driftDetails\x22:\x20\x22string\x22\x20}\x0a\x0aLTB:\x20','setStateAsync','getForeignStateAsync','.forecast.current.temperature','Skipped\x20(No\x20AI\x20or\x20Data)','\x0a\x20\x20\x20\x20ROLLE:\x20Medizinischer\x20Assistent\x20f√ºr\x20AAL\x20(Ambient\x20Assisted\x20Living).\x0a\x20\x20\x20\x20AUFGABE:\x20','analysis.analysisHistory','Skipped\x20(Traffic)','Health\x20Report\x20Error:\x20','analysis.health.geminiDay','‚ö†Ô∏è\x20ALARM:\x20','dailyDigests','toLocaleTimeString','lastAlertState'];a0_0x4df7=function(){return _0x119526;};return a0_0x4df7();}async function createDailyDigest(_0x2a1855,_0x28de21){const _0x18b2a8=a0_0x20bb79;if(!_0x2a1855['isProVersion'])return;if(!canCallApi()){await _0x2a1855[_0x18b2a8(0x18c)](LTM_DP_STATUS,{'val':_0x18b2a8(0x192),'ack':!![]});return;}await _0x2a1855['setStateAsync'](LTM_DP_STATUS,{'val':_0x18b2a8(0x146),'ack':!![]});if(!_0x2a1855[_0x18b2a8(0x17e)]||_0x2a1855[_0x18b2a8(0x152)][_0x18b2a8(0x115)]<LTM_MIN_EVENTS_FOR_COMPRESSION){await _0x2a1855[_0x18b2a8(0x18c)](LTM_DP_STATUS,{'val':_0x18b2a8(0x18f),'ack':!![]});return;}const _0x3d8840=JSON[_0x18b2a8(0x10c)](JSON[_0x18b2a8(0x13c)](_0x2a1855[_0x18b2a8(0x152)])),_0xfb99e1=_0x3d8840['length'],_0x59d249=_0x18b2a8(0x17f)+JSON[_0x18b2a8(0x13c)](_0x3d8840);try{updateApiTimestamp();const _0x60c47c=await _0x2a1855[_0x18b2a8(0x17e)]['generateContent'](_0x59d249),_0x368113=JSON[_0x18b2a8(0x10c)](_0x60c47c[_0x18b2a8(0x10b)]['text']()[_0x18b2a8(0x145)](/```json|```/g,'')[_0x18b2a8(0x189)]()),_0x2110f3={'timestamp':new Date()[_0x18b2a8(0x14d)](),'eventCount':_0xfb99e1,'summary':_0x368113['summary']||_0x18b2a8(0x155),'activityLevel':_0x368113['activityLevel']||_0x18b2a8(0x100),'systemMode':_0x2a1855[_0x18b2a8(0x110)]};_0x2a1855['dailyDigests'][_0x18b2a8(0x132)](_0x2110f3);const _0x3421a4=_0x2a1855[_0x18b2a8(0x10d)][_0x18b2a8(0x186)]||0x3c;_0x2a1855[_0x18b2a8(0x196)][_0x18b2a8(0x115)]>_0x3421a4&&_0x2a1855[_0x18b2a8(0x196)]['splice'](0x0,_0x2a1855[_0x18b2a8(0x196)][_0x18b2a8(0x115)]-_0x3421a4);await _0x2a1855[_0x18b2a8(0x18c)](LTM_DP_DAILY_DIGESTS,{'val':JSON['stringify'](_0x2a1855[_0x18b2a8(0x196)]),'ack':!![]}),_0x2a1855[_0x18b2a8(0x152)]=[],await _0x2a1855[_0x18b2a8(0x18c)](LTM_DP_RAW_LOG,{'val':JSON[_0x18b2a8(0x13c)](_0x2a1855[_0x18b2a8(0x152)]),'ack':!![]}),await _0x2a1855['setStateAsync'](LTM_DP_STATUS,{'val':_0x18b2a8(0x13b),'ack':!![]});const _0x620a13=_0x18b2a8(0x109)+_0x368113[_0x18b2a8(0x187)]+_0x18b2a8(0x165)+_0x368113[_0x18b2a8(0x188)];setup[_0x18b2a8(0x10e)](_0x2a1855,_0x620a13,![],![]);if(_0x2a1855[_0x18b2a8(0x103)]&&_0x28de21)_0x28de21['send'](_0x2a1855,_0x18b2a8(0x17b),{'digest':_0x2110f3});}catch(_0x12977d){_0x2a1855[_0x18b2a8(0x143)][_0x18b2a8(0x15a)](_0x12977d[_0x18b2a8(0x131)]);}}async function runBaselineDriftAnalysis(_0x42e334){const _0x10bb68=a0_0x20bb79;if(!_0x42e334[_0x10bb68(0x103)]||!_0x42e334['geminiModel'])return;if(!canCallApi())return;const _0x256804=_0x42e334[_0x10bb68(0x10d)][_0x10bb68(0x11c)]||0xe;if(_0x42e334['dailyDigests']['length']<_0x256804+0x7){await _0x42e334[_0x10bb68(0x18c)]('LTM.driftAnalysis.baselineDrift',{'val':_0x10bb68(0x14b),'ack':!![]});return;}const _0x4c74b7=_0x42e334['dailyDigests'][_0x10bb68(0x15b)](-_0x256804),_0xa099a0=_0x42e334[_0x10bb68(0x196)][_0x10bb68(0x15b)](0x0,_0x42e334['dailyDigests']['length']-_0x256804),_0x5beffe=_0x10bb68(0x18b)+JSON[_0x10bb68(0x13c)](_0xa099a0)+_0x10bb68(0x168)+JSON[_0x10bb68(0x13c)](_0x4c74b7);try{updateApiTimestamp();const _0x1ad1b8=await _0x42e334['geminiModel']['generateContent'](_0x5beffe),_0x1d3f76=JSON[_0x10bb68(0x10c)](_0x1ad1b8['response'][_0x10bb68(0x106)]()[_0x10bb68(0x145)](/```json|```/g,'')[_0x10bb68(0x189)]());_0x1d3f76[_0x10bb68(0x184)]&&(await _0x42e334['setStateAsync'](_0x10bb68(0x107),{'val':_0x1d3f76[_0x10bb68(0x184)],'ack':!![]}),await _0x42e334[_0x10bb68(0x18c)](_0x10bb68(0x10f),{'val':_0x1d3f76[_0x10bb68(0x16f)],'ack':!![]}),await _0x42e334['setStateAsync'](_0x10bb68(0x15e),{'val':Date[_0x10bb68(0x175)](),'ack':!![]}));}catch(_0x53a416){}}async function executeAutomationAction(_0x609908){const _0x433bd5=a0_0x20bb79;try{const _0x33935c=await _0x609908[_0x433bd5(0x166)](_0x433bd5(0x161)),_0x4281fe=await _0x609908['getStateAsync']('analysis.automation.targetValue');if(_0x33935c&&_0x33935c[_0x433bd5(0x177)]&&_0x4281fe){const _0x35280e=_0x33935c[_0x433bd5(0x177)];let _0x59f19b=_0x4281fe[_0x433bd5(0x177)];try{_0x59f19b=JSON[_0x433bd5(0x10c)](_0x59f19b);}catch(_0x7a708){}_0x609908['log']['info'](_0x433bd5(0x142)+_0x35280e+_0x433bd5(0x12e)+_0x59f19b),await _0x609908[_0x433bd5(0x114)](_0x35280e,_0x59f19b);}else _0x609908[_0x433bd5(0x143)][_0x433bd5(0x16c)](_0x433bd5(0x124));}catch(_0x318b90){_0x609908[_0x433bd5(0x143)][_0x433bd5(0x15a)](_0x433bd5(0x173)+_0x318b90['message']);}}async function sendMorningBriefing(_0xd9003d){const _0x18264e=a0_0x20bb79;if(!_0xd9003d[_0x18264e(0x17e)]){_0xd9003d['log'][_0x18264e(0x16c)](_0x18264e(0x111));return;}_0xd9003d[_0x18264e(0x143)][_0x18264e(0x12b)](_0x18264e(0xfc));try{updateApiTimestamp();const _0xfef8bd=_0x18264e(0x118),_0x565253=await _0xd9003d[_0x18264e(0x17e)][_0x18264e(0x12f)](_0xfef8bd),_0x15f5ed=_0x565253[_0x18264e(0x10b)]['text']();_0xd9003d[_0x18264e(0x143)][_0x18264e(0x12b)](_0x18264e(0x171)+_0x15f5ed[_0x18264e(0x115)]+').\x20Sending\x20notification...'),setup['sendNotification'](_0xd9003d,'üåÖ\x20Morning\x20Briefing:\x0a'+_0x15f5ed);}catch(_0x56a0d1){_0xd9003d[_0x18264e(0x143)][_0x18264e(0x15a)]('Briefing\x20Error:\x20'+_0x56a0d1[_0x18264e(0x131)]);}}async function generateHealthReport(_0x512b7f,_0x364640){const _0x507642=a0_0x20bb79;if(!_0x512b7f[_0x507642(0x17e)])return;const _0x356043=Date[_0x507642(0x175)]();_0x356043-lastGlobalApiCall<0xbb8&&(_0x512b7f[_0x507642(0x143)]['debug'](_0x507642(0x147)),await new Promise(_0x6cf59=>setTimeout(_0x6cf59,0x7d0)));const _0x1d5166=new Date();let _0x1a904a=0x0,_0x111850=_0x1d5166[_0x507642(0x123)](),_0x4e8cca='';if(_0x364640===_0x507642(0x14a)){const _0x320d86=new Date(_0x1d5166);_0x320d86[_0x507642(0x121)](_0x320d86[_0x507642(0x16a)]()-0x1),_0x320d86[_0x507642(0x154)](0x16,0x0,0x0,0x0),_0x1a904a=_0x320d86[_0x507642(0x123)]();const _0xf989dc=new Date(_0x1d5166);_0xf989dc['setHours'](0x8,0x0,0x0,0x0),_0x111850=_0xf989dc[_0x507642(0x123)](),_0x4e8cca=_0x507642(0x104);}else{const _0x2e37a3=new Date(_0x1d5166);_0x2e37a3[_0x507642(0x154)](0x8,0x0,0x0,0x0),_0x1a904a=_0x2e37a3[_0x507642(0x123)](),_0x4e8cca=_0x507642(0x15d);}const _0x5a21c6=_0x512b7f['eventHistory']['filter'](_0x181b99=>_0x181b99[_0x507642(0x16e)]>=_0x1a904a&&_0x181b99[_0x507642(0x16e)]<=_0x111850);if(_0x5a21c6[_0x507642(0x115)]===0x0){const _0x465786=_0x364640===_0x507642(0x14a)?_0x507642(0x135):_0x507642(0x15f),_0x2e8b44=_0x364640===_0x507642(0x14a)?_0x507642(0x12c):_0x507642(0x194);await _0x512b7f[_0x507642(0x18c)](_0x2e8b44,{'val':_0x465786,'ack':!![]});return;}const _0x474839=_0x5a21c6[_0x507642(0x176)](_0x61fae1=>new Date(_0x61fae1[_0x507642(0x16e)])[_0x507642(0xf9)]([],{'hour':_0x507642(0x151),'minute':_0x507642(0x151)})+'\x20'+_0x61fae1[_0x507642(0x17c)]+'\x20('+_0x61fae1['value']+')')[_0x507642(0x112)]('\x0a'),_0x44ad58=_0x507642(0x190)+_0x4e8cca+_0x507642(0x158)+_0x474839+_0x507642(0x108);try{updateApiTimestamp();const _0x114901=await _0x512b7f[_0x507642(0x17e)][_0x507642(0x12f)](_0x44ad58),_0x78408a=_0x114901['response'][_0x507642(0x106)](),_0x4bdd9c=_0x364640===_0x507642(0x14a)?_0x507642(0x12c):_0x507642(0x194);await _0x512b7f[_0x507642(0x18c)](_0x4bdd9c,{'val':_0x78408a,'ack':!![]}),_0x512b7f['log']['info'](_0x507642(0x13e)+_0x364640+_0x507642(0x169));}catch(_0x1251d2){_0x512b7f[_0x507642(0x143)][_0x507642(0x15a)](_0x507642(0x193)+_0x1251d2[_0x507642(0x131)]);}}module[a0_0x20bb79(0x127)]={'executeAutomationAction':executeAutomationAction,'createDailyDigest':createDailyDigest,'runBaselineDriftAnalysis':runBaselineDriftAnalysis,'sendMorningBriefing':sendMorningBriefing,'runGeminiAnalysis':runGeminiAnalysis,'consultButler':consultButler,'generateHealthReport':generateHealthReport};