const a0_0x139df2=a0_0x4960;(function(_0x175664,_0x252b0e){const _0x3576d8=a0_0x4960,_0x8deb98=_0x175664();while(!![]){try{const _0x4d62e3=-parseInt(_0x3576d8(0x1d0))/0x1*(-parseInt(_0x3576d8(0x1e1))/0x2)+parseInt(_0x3576d8(0x190))/0x3+-parseInt(_0x3576d8(0x172))/0x4+parseInt(_0x3576d8(0x1ad))/0x5+-parseInt(_0x3576d8(0x1ab))/0x6*(-parseInt(_0x3576d8(0x187))/0x7)+parseInt(_0x3576d8(0x19c))/0x8*(-parseInt(_0x3576d8(0x1a9))/0x9)+-parseInt(_0x3576d8(0x1c9))/0xa*(parseInt(_0x3576d8(0x15a))/0xb);if(_0x4d62e3===_0x252b0e)break;else _0x8deb98['push'](_0x8deb98['shift']());}catch(_0x5716a4){_0x8deb98['push'](_0x8deb98['shift']());}}}(a0_0x2578,0x95d55));const a0_0x5b6177=(function(){let _0x2655f7=!![];return function(_0x2fb0ee,_0x51b5f1){const _0x40fcbc=_0x2655f7?function(){const _0x1d7395=a0_0x4960;if(_0x51b5f1){const _0x36ad29=_0x51b5f1[_0x1d7395(0x17b)](_0x2fb0ee,arguments);return _0x51b5f1=null,_0x36ad29;}}:function(){};return _0x2655f7=![],_0x40fcbc;};}()),a0_0x3e446a=a0_0x5b6177(this,function(){const _0x43ad7a=a0_0x4960;return a0_0x3e446a[_0x43ad7a(0x155)]()[_0x43ad7a(0x1cb)]('(((.+)+)+)+$')[_0x43ad7a(0x155)]()[_0x43ad7a(0x193)](a0_0x3e446a)[_0x43ad7a(0x1cb)]('(((.+)+)+)+$');});a0_0x3e446a();'use strict';const {GoogleGenerativeAI}=require(a0_0x139df2(0x164)),setup=require('./setup'),GEMINI_MODEL=a0_0x139df2(0x1a7),LTM_DP_DAILY_DIGESTS=a0_0x139df2(0x198),LTM_DP_STATUS=a0_0x139df2(0x1db),LTM_DP_RAW_LOG=a0_0x139df2(0x1b2),LTM_MIN_EVENTS_FOR_COMPRESSION=0x5,MIN_API_GAP_MS=0x4e20;let lastGlobalApiCall=0x0;const decisionCache={},CACHE_TTL_MS=0xf*0x3c*0x3e8,PERSONA_MAPPING={'generic':'Entscheide\x20ausgewogen\x20zwischen\x20Komfort\x20und\x20Energie.','senior_aal':'PRIORITÃ„T:\x20Sicherheit\x20und\x20Licht.\x20Schalte\x20lieber\x20einmal\x20zu\x20viel\x20als\x20zu\x20wenig.','family':a0_0x139df2(0x16b),'single_comfort':a0_0x139df2(0x184),'security':a0_0x139df2(0x169),'energy_saver':'PRIORITÃ„T:\x20Energie\x20sparen.\x20Schalte\x20nur,\x20wenn\x20absolut\x20notwendig\x20(Dunkelheit).'};function canCallApi(){const _0x282035=Date['now']();return _0x282035-lastGlobalApiCall>MIN_API_GAP_MS;}function updateApiTimestamp(){const _0x402879=a0_0x139df2;lastGlobalApiCall=Date[_0x402879(0x1ce)]();}async function getWeatherContext(_0x247571){const _0x104899=a0_0x139df2;if(!_0x247571['config'][_0x104899(0x160)]||!_0x247571[_0x104899(0x1d2)][_0x104899(0x1d4)])return _0x104899(0x1ac);try{const _0x33bc0e=_0x247571[_0x104899(0x1d2)][_0x104899(0x1d4)];let _0x5d735c=await _0x247571[_0x104899(0x1d8)](_0x33bc0e+'.Current.Temperature');if(!_0x5d735c)_0x5d735c=await _0x247571[_0x104899(0x1d8)](_0x33bc0e+_0x104899(0x1c2));let _0x2ba47c=await _0x247571[_0x104899(0x1d8)](_0x33bc0e+_0x104899(0x191));if(!_0x2ba47c)_0x2ba47c=await _0x247571[_0x104899(0x1d8)](_0x33bc0e+_0x104899(0x1bf));let _0x35b12c=_0x104899(0x1c3);const _0x31a3cb=await _0x247571[_0x104899(0x1d8)](_0x33bc0e+_0x104899(0x151));if(_0x31a3cb)_0x35b12c=_0x31a3cb[_0x104899(0x181)]?'Nacht':_0x104899(0x1cf);if(_0x5d735c&&_0x2ba47c)return _0x5d735c[_0x104899(0x181)]+_0x104899(0x1e6)+_0x2ba47c[_0x104899(0x181)]+_0x104899(0x17a)+_0x35b12c;}catch(_0x1e5d83){}return'Wetterdaten\x20nicht\x20abrufbar';}function a0_0x4960(_0x4555a,_0x197d13){const _0x41c703=a0_0x2578();return a0_0x4960=function(_0x3e446a,_0x5b6177){_0x3e446a=_0x3e446a-0x14f;let _0x25785d=_0x41c703[_0x3e446a];return _0x25785d;},a0_0x4960(_0x4555a,_0x197d13);}async function consultButler(_0x5e7984,_0x2cdf33,_0xa4f72e,_0x9f5426){const _0x8612c7=a0_0x139df2;if(!_0x5e7984[_0x8612c7(0x18c)])return{'approved':!![],'reason':_0x8612c7(0x174)};const _0x279c95=Date[_0x8612c7(0x1ce)]();if(decisionCache[_0x2cdf33]&&_0x279c95-decisionCache[_0x2cdf33][_0x8612c7(0x15b)]<CACHE_TTL_MS){const _0x438d0d=decisionCache[_0x2cdf33]['decision'];return _0x5e7984[_0x8612c7(0x18b)]['debug'](_0x8612c7(0x19e)+_0x2cdf33+'\x20->\x20'+(_0x438d0d[_0x8612c7(0x1e0)]?'OK':'NO')+'\x20('+_0x438d0d[_0x8612c7(0x194)]+')'),_0x438d0d;}if(!canCallApi())return _0x5e7984[_0x8612c7(0x18b)]['debug']('ðŸ¤–\x20Traffic\x20Schutz:\x20Anfrage\x20fÃ¼r\x20'+_0x2cdf33+'\x20Ã¼bersprungen\x20(Auto-Approved).'),{'approved':!![],'reason':'Traffic-Schutz\x20(Auto-Approved)'};const _0x39fe67=new Date()[_0x8612c7(0x1c0)](),_0x357dfa=await getWeatherContext(_0x5e7984),_0xadfccf=PERSONA_MAPPING[_0x5e7984[_0x8612c7(0x1d2)][_0x8612c7(0x1c5)]||_0x8612c7(0x1a5)],_0x4b3178=_0x8612c7(0x1da)+_0x39fe67+_0x8612c7(0x1be)+_0x357dfa+_0x8612c7(0x1a0)+(_0x9f5426*0x64)[_0x8612c7(0x1c1)](0x0)+_0x8612c7(0x19b)+_0x2cdf33+_0x8612c7(0x152)+_0xa4f72e+_0x8612c7(0x1ca)+_0xadfccf+_0x8612c7(0x1d6);try{updateApiTimestamp();const _0x343426=await _0x5e7984[_0x8612c7(0x18c)][_0x8612c7(0x1a3)](_0x4b3178),_0x3b014f=_0x343426[_0x8612c7(0x175)][_0x8612c7(0x1bd)]()['replace'](/```json|```/g,'')[_0x8612c7(0x156)](),_0x411b65=JSON[_0x8612c7(0x165)](_0x3b014f);return decisionCache[_0x2cdf33]={'decision':_0x411b65,'timestamp':_0x279c95},_0x411b65;}catch(_0x4fe59c){return _0x5e7984[_0x8612c7(0x18b)][_0x8612c7(0x163)](_0x8612c7(0x1e5)+_0x4fe59c[_0x8612c7(0x15d)]),decisionCache[_0x2cdf33]={'decision':{'approved':!![],'reason':'KI-Fehler\x20(Fallback)'},'timestamp':_0x279c95-(CACHE_TTL_MS-0xea60)},{'approved':!![],'reason':_0x8612c7(0x1e2)};}}function a0_0x2578(){const _0x35332e=['setStateAsync','aiPersona','NIGHT','ROLLE:\x20Data\x20Compression\x20Agent.\x20SPRACHE:\x20DE.\x20FORMAT:\x20JSON.\x20ANWEISUNG:\x20Fasse\x20Sensor-Events\x20zusammen.\x20SCHEMA:\x20{\x20\x22summary\x22:\x20\x22string\x22,\x20\x22activityLevel\x22:\x20\x22string\x22\x20}\x20\x0a\x0aEVENTS:\x0a','analysis.analysisHistory','10LuLvmW','\x22\x20AN.\x0a\x20\x20\x20\x20STRATEGIE:\x20','search','.\x20KONTEXT:\x20','splice','now','Tag','274DlTJXZ','Erstelle\x20ein\x20kurzes\x20\x27Guten\x20Morgen\x27\x20Briefing\x20basierend\x20auf\x20den\x20Events\x20der\x20letzten\x20Nacht.','config','driftDetails','weatherInstance','map','\x0a\x20\x20\x20\x20FRAGE:\x20Ist\x20es\x20dunkel\x20genug\x20fÃ¼r\x20Licht?\x0a\x20\x20\x20\x20FORMAT:\x20{\x20\x22approved\x22:\x20boolean,\x20\x22reason\x22:\x20\x22kurzer\x20Grund\x22\x20}\x0a\x20\x20\x20\x20','push','getForeignStateAsync','.\x20SYSTEM_MODE:\x20','\x0a\x20\x20\x20\x20ROLLE:\x20Haus-Butler.\x0a\x20\x20\x20\x20SITUATION:\x20','LTM.processingStatus','\x0a\x20\x20\x20\x20EVENTS:\x0a','system.presenceWho','.\x20EVENTS:\x20','getTime','approved','4472kWlPkm','KI-Fehler\x20(Fallback)','activityLevel','analysis.health.geminiNight','ðŸ¤–\x20Butler\x20Brain\x20Error:\x20','Â°C,\x20','.\x20AUFGABE:\x201.\x20Gesundheit?\x202.\x20Komfort?\x20FORMAT\x20(JSON):\x20{\x20\x22isAlert\x22:\x20boolean,\x20\x22alertReason\x22:\x20\x22string\x22,\x20\x22isEmergency\x22:\x20boolean,\x20\x22summary\x22:\x20\x22string\x22,\x20\x22automationProposal\x22:\x20{\x20\x22detected\x22:\x20boolean,\x20\x22description\x22:\x20\x22string\x22,\x20\x22targetId\x22:\x20\x22string\x22,\x20\x22targetValue\x22:\x20\x22any\x22\x20}\x20}','alertReason','.Current.IsNight','\x22.\x0a\x20\x20\x20\x20AKTION:\x20Schalte\x20\x22','slice','eventHistory','toString','trim','isProVersion','automationProposal',')\x20generated.','5861240qSFOyi','timestamp','name','message','ðŸ¤–\x20API\x20Cooldown.\x20Waiting\x202s...','Health\x20Report\x20Error:\x20','useWeather','info','currentSystemMode','warn','@google/generative-ai','parse','analysis.alertReason','isEmergency','ðŸ¤–\x20Health\x20Report\x20(','Sicherheit\x20geht\x20vor.','debug','Fokus\x20auf\x20Komfort\x20fÃ¼r\x20die\x20Familie.','join','ðŸŒ…\x20Morning\x20Briefing:\x0a','exports','\x0aSTB:\x20','ltmStbWindowDays','analysis.automation.targetId','1152016uLAPgr','BUTLER\x20Execution\x20Error:\x20','KI\x20offline\x20(Fallback)','response','sendNotification','Briefing\x20Error:\x20','analysis.health.geminiDay','isAlert',',\x20LichtverhÃ¤ltnisse:\x20','apply','setHours','send','baselineDrift','Analysiere\x20diese\x20Events\x20der\x20NACHT\x20(22:00-08:00).\x20War\x20der\x20Schlaf\x20ruhig?\x20Gab\x20es\x20BadgÃ¤nge?\x20Antwort\x20kurz\x20fÃ¼r\x20den\x20besorgten\x20Sohn\x20(max\x202\x20SÃ¤tze).','ðŸ“…\x20Daily\x20Digest:\x0a','val','replace','rawEventLog','Maximaler\x20Komfort,\x20Energie\x20ist\x20zweitrangig.','analysis.automation.targetValue','filter','235249FLPovB','Gemini\x20Error:\x20','Keine\x20Details.','analysis.activitySummary','log','geminiModel','stringify','description','LTM.driftAnalysis.baselineDrift','709701OhHbuK','.Current.WeatherText','Skipped\x20(No\x20AI\x20or\x20Data)','constructor','reason','analysisHistory','toISOString','value','LTM.dailyDigests','analysis.automation.autoApply','\x0aAktivitÃ¤t:\x20','%)\x20nach\x20\x22','181176qOSdJg','lastAlertState','ðŸ¤–\x20Butler\x20Cache\x20Hit:\x20','ltmLtbWindowDays','.\x0a\x20\x20\x20\x20EVENT:\x20Bewohner\x20geht\x20wahrscheinlich\x20(','2-digit','dailyDigests','generateContent','LTM.driftAnalysis.lastCheck','generic','Analysiere\x20diese\x20Events\x20des\x20TAGES\x20(08:00-Jetzt).\x20AktivitÃ¤t?\x20Mahlzeiten?\x20HaustÃ¼r?\x20Antwort\x20kurz\x20fÃ¼r\x20den\x20besorgten\x20Sohn\x20(max\x202\x20SÃ¤tze).','models/gemini-flash-latest','getStateAsync','18qhQRKS','unshift','60RnQIso','Unbekannt\x20(Kein\x20Sensor)','1472770WOztpk','summary','normal','analysis.automation.patternDetected','Bisher\x20keine\x20AktivitÃ¤t\x20seit\x2008:00\x20Uhr\x20verzeichnet.','LTM.rawEventLog','detected','Digest','ðŸ¤–\x20Autopilot\x20skipped\x20(Traffic\x20Protection\x20active).','livingContext','length','analysis.lastResult','âš ï¸\x20ALARM:\x20','ðŸŒ…\x20Starting\x20Morning\x20Briefing\x20sequence\x20(Traffic\x20Check\x20bypassed)...','ðŸŒ…\x20Briefing\x20generated\x20(Length:\x20','error','text',',\x20Wetter:\x20','.forecast.current.state','toLocaleTimeString','toFixed','.forecast.current.temperature','Unbekannt'];a0_0x2578=function(){return _0x35332e;};return a0_0x2578();}async function runGeminiAnalysis(_0x2c2df0,_0xe894e6=''){const _0x4cd359=a0_0x139df2;if(!_0x2c2df0[_0x4cd359(0x18c)])return;if(!canCallApi()){_0x2c2df0[_0x4cd359(0x18b)][_0x4cd359(0x16a)](_0x4cd359(0x1b5));return;}if(_0x2c2df0['eventHistory'][_0x4cd359(0x1b7)]===0x0)return;const _0x1dc2dd=_0x2c2df0[_0x4cd359(0x154)][_0x4cd359(0x153)](0x0,0xf),_0x1e7ea4=_0x2c2df0[_0x4cd359(0x162)],_0x1fa46c=PERSONA_MAPPING[_0x2c2df0[_0x4cd359(0x1d2)][_0x4cd359(0x1c5)]||_0x4cd359(0x1a5)],_0x215eb4=_0x2c2df0['config'][_0x4cd359(0x1b6)]||_0x4cd359(0x189);let _0x392124=_0x4cd359(0x1c3);try{const _0x5e23cf=await _0x2c2df0['getStateAsync'](_0x4cd359(0x1dd));if(_0x5e23cf&&_0x5e23cf[_0x4cd359(0x181)])_0x392124=_0x5e23cf[_0x4cd359(0x181)];}catch(_0x5cf3ec){}let _0x4098b0=![];try{const _0x131189=await _0x2c2df0[_0x4cd359(0x1a8)](_0x4cd359(0x199));if(_0x131189&&_0x131189[_0x4cd359(0x181)])_0x4098b0=!![];}catch(_0x3109b4){}const _0x49d3dd='ROLLE:\x20KI-Hausverwalter.\x20PERSONA:\x20'+_0x1fa46c+_0x4cd359(0x1cc)+_0x215eb4+_0x4cd359(0x1d9)+_0x1e7ea4+'.\x20ANWESEND:\x20'+_0x392124+_0x4cd359(0x1de)+JSON['stringify'](_0x1dc2dd)+'.\x20EMERGENCY:\x20'+_0xe894e6+_0x4cd359(0x14f);try{updateApiTimestamp();const _0x49e129=await _0x2c2df0['geminiModel']['generateContent'](_0x49d3dd),_0x52b86b=JSON[_0x4cd359(0x165)](_0x49e129[_0x4cd359(0x175)][_0x4cd359(0x1bd)]()[_0x4cd359(0x182)](/```json|```/g,'')[_0x4cd359(0x156)]());await _0x2c2df0[_0x4cd359(0x1c4)](_0x4cd359(0x1b8),{'val':JSON[_0x4cd359(0x18d)](_0x52b86b),'ack':!![]});if(_0x52b86b[_0x4cd359(0x1ae)])await _0x2c2df0['setStateAsync'](_0x4cd359(0x18a),{'val':_0x52b86b['summary'],'ack':!![]});const _0x4c53d0={'timestamp':Date[_0x4cd359(0x1ce)](),'id':Date[_0x4cd359(0x1ce)]()[_0x4cd359(0x155)](),'analysis':{'activity':{'summary':_0x52b86b[_0x4cd359(0x1ae)],'isAlert':_0x52b86b[_0x4cd359(0x179)],'alertReason':_0x52b86b['alertReason']},'comfort':{'automationProposal':_0x52b86b[_0x4cd359(0x158)]}}};_0x2c2df0[_0x4cd359(0x195)][_0x4cd359(0x1aa)](_0x4c53d0);if(_0x2c2df0[_0x4cd359(0x195)]['length']>0x32)_0x2c2df0[_0x4cd359(0x195)]['pop']();await _0x2c2df0['setStateAsync'](_0x4cd359(0x1c8),{'val':JSON['stringify'](_0x2c2df0[_0x4cd359(0x195)]),'ack':!![]});const _0x12eaad=_0x52b86b[_0x4cd359(0x179)]||![];_0x12eaad!==_0x2c2df0[_0x4cd359(0x19d)]&&(await _0x2c2df0[_0x4cd359(0x1c4)]('analysis.isAlert',{'val':_0x12eaad,'ack':!![]}),_0x2c2df0[_0x4cd359(0x19d)]=_0x12eaad,_0x12eaad&&(await _0x2c2df0[_0x4cd359(0x1c4)](_0x4cd359(0x166),{'val':_0x52b86b[_0x4cd359(0x150)],'ack':!![]}),setup[_0x4cd359(0x176)](_0x2c2df0,_0x4cd359(0x1b9)+_0x52b86b[_0x4cd359(0x150)],![],_0x52b86b[_0x4cd359(0x167)])));if(_0x52b86b[_0x4cd359(0x158)]&&_0x52b86b['automationProposal'][_0x4cd359(0x1b3)]){await _0x2c2df0[_0x4cd359(0x1c4)](_0x4cd359(0x1b0),{'val':!![],'ack':!![]}),await _0x2c2df0[_0x4cd359(0x1c4)]('analysis.automation.description',{'val':_0x52b86b[_0x4cd359(0x158)][_0x4cd359(0x18e)],'ack':!![]}),await _0x2c2df0[_0x4cd359(0x1c4)](_0x4cd359(0x171),{'val':_0x52b86b[_0x4cd359(0x158)]['targetId'],'ack':!![]}),await _0x2c2df0[_0x4cd359(0x1c4)](_0x4cd359(0x185),{'val':JSON['stringify'](_0x52b86b[_0x4cd359(0x158)]['targetValue']),'ack':!![]});if(_0x4098b0)executeAutomationAction(_0x2c2df0);}}catch(_0x5fd5c9){_0x2c2df0[_0x4cd359(0x18b)][_0x4cd359(0x1bc)](_0x4cd359(0x188)+_0x5fd5c9['message']);}}async function createDailyDigest(_0x49b7dc,_0x32e035){const _0x867788=a0_0x139df2;if(!_0x49b7dc[_0x867788(0x157)])return;if(!canCallApi()){await _0x49b7dc[_0x867788(0x1c4)](LTM_DP_STATUS,{'val':'Skipped\x20(Traffic)','ack':!![]});return;}await _0x49b7dc[_0x867788(0x1c4)](LTM_DP_STATUS,{'val':'Started...','ack':!![]});if(!_0x49b7dc[_0x867788(0x18c)]||_0x49b7dc[_0x867788(0x183)][_0x867788(0x1b7)]<LTM_MIN_EVENTS_FOR_COMPRESSION){await _0x49b7dc[_0x867788(0x1c4)](LTM_DP_STATUS,{'val':_0x867788(0x192),'ack':!![]});return;}const _0x4715b9=JSON['parse'](JSON[_0x867788(0x18d)](_0x49b7dc[_0x867788(0x183)])),_0x1ba557=_0x4715b9['length'],_0x107a84=_0x867788(0x1c7)+JSON[_0x867788(0x18d)](_0x4715b9);try{updateApiTimestamp();const _0x4700cc=await _0x49b7dc[_0x867788(0x18c)][_0x867788(0x1a3)](_0x107a84),_0x59dfdc=JSON[_0x867788(0x165)](_0x4700cc[_0x867788(0x175)]['text']()[_0x867788(0x182)](/```json|```/g,'')['trim']()),_0x17a877={'timestamp':new Date()[_0x867788(0x196)](),'eventCount':_0x1ba557,'summary':_0x59dfdc[_0x867788(0x1ae)]||_0x867788(0x1b4),'activityLevel':_0x59dfdc[_0x867788(0x1e3)]||_0x867788(0x1af),'systemMode':_0x49b7dc[_0x867788(0x162)]};_0x49b7dc['dailyDigests'][_0x867788(0x1d7)](_0x17a877);const _0xcf5872=_0x49b7dc['config'][_0x867788(0x19f)]||0x3c;_0x49b7dc[_0x867788(0x1a2)][_0x867788(0x1b7)]>_0xcf5872&&_0x49b7dc[_0x867788(0x1a2)][_0x867788(0x1cd)](0x0,_0x49b7dc['dailyDigests'][_0x867788(0x1b7)]-_0xcf5872);await _0x49b7dc[_0x867788(0x1c4)](LTM_DP_DAILY_DIGESTS,{'val':JSON[_0x867788(0x18d)](_0x49b7dc[_0x867788(0x1a2)]),'ack':!![]}),_0x49b7dc[_0x867788(0x183)]=[],await _0x49b7dc[_0x867788(0x1c4)](LTM_DP_RAW_LOG,{'val':JSON['stringify'](_0x49b7dc['rawEventLog']),'ack':!![]}),await _0x49b7dc[_0x867788(0x1c4)](LTM_DP_STATUS,{'val':'Success','ack':!![]});const _0x3a0eb4=_0x867788(0x180)+_0x59dfdc['summary']+_0x867788(0x19a)+_0x59dfdc[_0x867788(0x1e3)];setup['sendNotification'](_0x49b7dc,_0x3a0eb4,![],![]);if(_0x49b7dc[_0x867788(0x157)]&&_0x32e035)_0x32e035[_0x867788(0x17d)](_0x49b7dc,'ANALYZE_HEALTH',{'digest':_0x17a877});}catch(_0x17f952){_0x49b7dc[_0x867788(0x18b)][_0x867788(0x1bc)](_0x17f952[_0x867788(0x15d)]);}}async function runBaselineDriftAnalysis(_0x577e6f){const _0x4b54e3=a0_0x139df2;if(!_0x577e6f[_0x4b54e3(0x157)]||!_0x577e6f[_0x4b54e3(0x18c)])return;if(!canCallApi())return;const _0x49c2b6=_0x577e6f['config'][_0x4b54e3(0x170)]||0xe;if(_0x577e6f[_0x4b54e3(0x1a2)][_0x4b54e3(0x1b7)]<_0x49c2b6+0x7){await _0x577e6f[_0x4b54e3(0x1c4)](_0x4b54e3(0x18f),{'val':'N/A\x20(Learning)','ack':!![]});return;}const _0xa1fe46=_0x577e6f['dailyDigests']['slice'](-_0x49c2b6),_0x252806=_0x577e6f[_0x4b54e3(0x1a2)][_0x4b54e3(0x153)](0x0,_0x577e6f[_0x4b54e3(0x1a2)][_0x4b54e3(0x1b7)]-_0x49c2b6),_0x1f2507='ROLLE:\x20Data\x20Scientist.\x20ZIEL:\x20Drift\x20erkennen.\x20SCHEMA:\x20{\x20\x22baselineDrift\x22:\x20\x22none|slight|significant|critical\x22,\x20\x22driftDetails\x22:\x20\x22string\x22\x20}\x0a\x0aLTB:\x20'+JSON[_0x4b54e3(0x18d)](_0x252806)+_0x4b54e3(0x16f)+JSON[_0x4b54e3(0x18d)](_0xa1fe46);try{updateApiTimestamp();const _0x2097cd=await _0x577e6f[_0x4b54e3(0x18c)][_0x4b54e3(0x1a3)](_0x1f2507),_0x45de97=JSON[_0x4b54e3(0x165)](_0x2097cd[_0x4b54e3(0x175)][_0x4b54e3(0x1bd)]()[_0x4b54e3(0x182)](/```json|```/g,'')[_0x4b54e3(0x156)]());_0x45de97['baselineDrift']&&(await _0x577e6f[_0x4b54e3(0x1c4)](_0x4b54e3(0x18f),{'val':_0x45de97[_0x4b54e3(0x17e)],'ack':!![]}),await _0x577e6f['setStateAsync']('LTM.driftAnalysis.driftDetails',{'val':_0x45de97[_0x4b54e3(0x1d3)],'ack':!![]}),await _0x577e6f[_0x4b54e3(0x1c4)](_0x4b54e3(0x1a4),{'val':Date[_0x4b54e3(0x1ce)](),'ack':!![]}));}catch(_0x45dc63){}}async function executeAutomationAction(_0x5da39d){const _0x3178cf=a0_0x139df2;try{const _0x31b32c=await _0x5da39d[_0x3178cf(0x1a8)](_0x3178cf(0x171)),_0x167c68=await _0x5da39d[_0x3178cf(0x1a8)](_0x3178cf(0x185));if(_0x31b32c&&_0x31b32c[_0x3178cf(0x181)]&&_0x167c68){const _0x30f7cd=_0x31b32c['val'];let _0x58ff77=_0x167c68[_0x3178cf(0x181)];try{_0x58ff77=JSON[_0x3178cf(0x165)](_0x58ff77);}catch(_0x1e1f59){}_0x5da39d['log'][_0x3178cf(0x161)]('ðŸ¤–\x20BUTLER:\x20Executing\x20Action\x20->\x20'+_0x30f7cd+'\x20=\x20'+_0x58ff77),await _0x5da39d['setForeignStateAsync'](_0x30f7cd,_0x58ff77);}else _0x5da39d[_0x3178cf(0x18b)][_0x3178cf(0x163)]('ðŸ¤–\x20BUTLER:\x20No\x20valid\x20target\x20ID\x20or\x20value\x20stored\x20for\x20execution.');}catch(_0x5b0fdd){_0x5da39d[_0x3178cf(0x18b)]['error'](_0x3178cf(0x173)+_0x5b0fdd['message']);}}async function sendMorningBriefing(_0x22febd){const _0x593fa5=a0_0x139df2;if(!_0x22febd[_0x593fa5(0x18c)]){_0x22febd[_0x593fa5(0x18b)]['warn']('ðŸ¤–\x20Morning\x20Briefing\x20skipped:\x20No\x20Gemini\x20Model.');return;}_0x22febd[_0x593fa5(0x18b)]['info'](_0x593fa5(0x1ba));try{updateApiTimestamp();const _0x225720=_0x593fa5(0x1d1),_0x4c1407=await _0x22febd['geminiModel'][_0x593fa5(0x1a3)](_0x225720),_0x10e77d=_0x4c1407[_0x593fa5(0x175)][_0x593fa5(0x1bd)]();_0x22febd['log'][_0x593fa5(0x161)](_0x593fa5(0x1bb)+_0x10e77d['length']+').\x20Sending\x20notification...'),setup['sendNotification'](_0x22febd,_0x593fa5(0x16d)+_0x10e77d);}catch(_0x577852){_0x22febd['log'][_0x593fa5(0x1bc)](_0x593fa5(0x177)+_0x577852[_0x593fa5(0x15d)]);}}async function generateHealthReport(_0x404137,_0x1ae4d){const _0x423eb0=a0_0x139df2;if(!_0x404137[_0x423eb0(0x18c)])return;const _0xb37fe2=Date[_0x423eb0(0x1ce)]();_0xb37fe2-lastGlobalApiCall<0xbb8&&(_0x404137[_0x423eb0(0x18b)][_0x423eb0(0x16a)](_0x423eb0(0x15e)),await new Promise(_0x4c4df4=>setTimeout(_0x4c4df4,0x7d0)));const _0x521709=new Date();let _0x44cb61=0x0,_0x354cf7=_0x521709[_0x423eb0(0x1df)](),_0x3b740a='';if(_0x1ae4d===_0x423eb0(0x1c6)){const _0x5a12f9=new Date(_0x521709);_0x5a12f9['setDate'](_0x5a12f9['getDate']()-0x1),_0x5a12f9[_0x423eb0(0x17c)](0x16,0x0,0x0,0x0),_0x44cb61=_0x5a12f9[_0x423eb0(0x1df)]();const _0x4bdc07=new Date(_0x521709);_0x4bdc07[_0x423eb0(0x17c)](0x8,0x0,0x0,0x0),_0x354cf7=_0x4bdc07[_0x423eb0(0x1df)](),_0x3b740a=_0x423eb0(0x17f);}else{const _0x1f7a58=new Date(_0x521709);_0x1f7a58[_0x423eb0(0x17c)](0x8,0x0,0x0,0x0),_0x44cb61=_0x1f7a58['getTime'](),_0x3b740a=_0x423eb0(0x1a6);}const _0x365b27=_0x404137[_0x423eb0(0x154)][_0x423eb0(0x186)](_0x3a98ac=>_0x3a98ac[_0x423eb0(0x15b)]>=_0x44cb61&&_0x3a98ac[_0x423eb0(0x15b)]<=_0x354cf7);if(_0x365b27[_0x423eb0(0x1b7)]===0x0){const _0x784f8d=_0x1ae4d===_0x423eb0(0x1c6)?'Keine\x20Daten\x20fÃ¼r\x20die\x20Nacht\x20aufgezeichnet\x20(Sensoren\x20ruhig).':_0x423eb0(0x1b1),_0x1bc52f=_0x1ae4d==='NIGHT'?_0x423eb0(0x1e4):'analysis.health.geminiDay';await _0x404137['setStateAsync'](_0x1bc52f,{'val':_0x784f8d,'ack':!![]});return;}const _0x1854ff=_0x365b27[_0x423eb0(0x1d5)](_0x2dc7b9=>new Date(_0x2dc7b9[_0x423eb0(0x15b)])[_0x423eb0(0x1c0)]([],{'hour':'2-digit','minute':_0x423eb0(0x1a1)})+'\x20'+_0x2dc7b9[_0x423eb0(0x15c)]+'\x20('+_0x2dc7b9[_0x423eb0(0x197)]+')')[_0x423eb0(0x16c)]('\x0a'),_0x3b3bfa='\x0a\x20\x20\x20\x20ROLLE:\x20Medizinischer\x20Assistent\x20fÃ¼r\x20AAL\x20(Ambient\x20Assisted\x20Living).\x0a\x20\x20\x20\x20AUFGABE:\x20'+_0x3b740a+_0x423eb0(0x1dc)+_0x1854ff+'\x0a\x20\x20\x20\x20ANTWORT-STIL:\x20Sachlich,\x20beruhigend,\x20prÃ¤zise.\x20Keine\x20Floskeln.\x0a\x20\x20\x20\x20';try{updateApiTimestamp();const _0x24534b=await _0x404137[_0x423eb0(0x18c)][_0x423eb0(0x1a3)](_0x3b3bfa),_0x26787a=_0x24534b[_0x423eb0(0x175)][_0x423eb0(0x1bd)](),_0x1976f1=_0x1ae4d===_0x423eb0(0x1c6)?_0x423eb0(0x1e4):_0x423eb0(0x178);await _0x404137[_0x423eb0(0x1c4)](_0x1976f1,{'val':_0x26787a,'ack':!![]}),_0x404137[_0x423eb0(0x18b)][_0x423eb0(0x161)](_0x423eb0(0x168)+_0x1ae4d+_0x423eb0(0x159));}catch(_0x5abc6c){_0x404137[_0x423eb0(0x18b)]['error'](_0x423eb0(0x15f)+_0x5abc6c[_0x423eb0(0x15d)]);}}module[a0_0x139df2(0x16e)]={'executeAutomationAction':executeAutomationAction,'createDailyDigest':createDailyDigest,'runBaselineDriftAnalysis':runBaselineDriftAnalysis,'sendMorningBriefing':sendMorningBriefing,'runGeminiAnalysis':runGeminiAnalysis,'consultButler':consultButler,'generateHealthReport':generateHealthReport};