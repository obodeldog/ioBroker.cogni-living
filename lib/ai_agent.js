const a0_0x5cc494=a0_0x30b6;(function(_0x15f900,_0x28639d){const _0x1788cb=a0_0x30b6,_0x45e666=_0x15f900();while(!![]){try{const _0x151cd5=parseInt(_0x1788cb(0x20c))/0x1+-parseInt(_0x1788cb(0x208))/0x2+-parseInt(_0x1788cb(0x1ca))/0x3+-parseInt(_0x1788cb(0x1cb))/0x4+parseInt(_0x1788cb(0x1d8))/0x5+parseInt(_0x1788cb(0x1fc))/0x6*(parseInt(_0x1788cb(0x1a5))/0x7)+parseInt(_0x1788cb(0x1e1))/0x8*(parseInt(_0x1788cb(0x21c))/0x9);if(_0x151cd5===_0x28639d)break;else _0x45e666['push'](_0x45e666['shift']());}catch(_0x10a706){_0x45e666['push'](_0x45e666['shift']());}}}(a0_0x1ca4,0xd70ca));const a0_0x4bd033=(function(){let _0x3cbc34=!![];return function(_0x192a30,_0x26f0c9){const _0x2b542f=_0x3cbc34?function(){const _0xd56a7=a0_0x30b6;if(_0x26f0c9){const _0x4a1c88=_0x26f0c9[_0xd56a7(0x20e)](_0x192a30,arguments);return _0x26f0c9=null,_0x4a1c88;}}:function(){};return _0x3cbc34=![],_0x2b542f;};}()),a0_0x2a48c4=a0_0x4bd033(this,function(){const _0x2c53ea=a0_0x30b6;return a0_0x2a48c4[_0x2c53ea(0x226)]()['search'](_0x2c53ea(0x21a))[_0x2c53ea(0x226)]()[_0x2c53ea(0x1dc)](a0_0x2a48c4)[_0x2c53ea(0x1db)](_0x2c53ea(0x21a));});a0_0x2a48c4();'use strict';const {GoogleGenerativeAI}=require(a0_0x5cc494(0x200)),setup=require('./setup'),GEMINI_MODEL=a0_0x5cc494(0x1f4),LTM_DP_DAILY_DIGESTS='LTM.dailyDigests',LTM_DP_STATUS=a0_0x5cc494(0x205),LTM_DP_RAW_LOG='LTM.rawEventLog',LTM_MIN_EVENTS_FOR_COMPRESSION=0x5,MIN_API_GAP_MS=0x4e20;let lastGlobalApiCall=0x0;const decisionCache={},CACHE_TTL_MS=0xf*0x3c*0x3e8,PERSONA_MAPPING={'generic':a0_0x5cc494(0x1c7),'senior_aal':a0_0x5cc494(0x22c),'family':a0_0x5cc494(0x1d3),'single_comfort':a0_0x5cc494(0x1bf),'security':a0_0x5cc494(0x1f7),'energy_saver':'PRIORITÃ„T:\x20Energie\x20sparen.\x20Schalte\x20nur,\x20wenn\x20absolut\x20notwendig\x20(Dunkelheit).'};function canCallApi(){const _0x1d1853=a0_0x5cc494,_0x2374ab=Date[_0x1d1853(0x1be)]();return _0x2374ab-lastGlobalApiCall>MIN_API_GAP_MS;}function updateApiTimestamp(){const _0x4a5276=a0_0x5cc494;lastGlobalApiCall=Date[_0x4a5276(0x1be)]();}function a0_0x30b6(_0x3a6dee,_0x49ad4f){const _0x867505=a0_0x1ca4();return a0_0x30b6=function(_0x2a48c4,_0x4bd033){_0x2a48c4=_0x2a48c4-0x190;let _0x1ca429=_0x867505[_0x2a48c4];return _0x1ca429;},a0_0x30b6(_0x3a6dee,_0x49ad4f);}async function getWeatherContext(_0x3f5ebc){const _0x1f5a7d=a0_0x5cc494;if(!_0x3f5ebc[_0x1f5a7d(0x1ba)][_0x1f5a7d(0x1eb)]||!_0x3f5ebc[_0x1f5a7d(0x1ba)]['weatherInstance'])return'Unbekannt\x20(Kein\x20Sensor)';try{const _0x2160c1=_0x3f5ebc[_0x1f5a7d(0x1ba)][_0x1f5a7d(0x195)];let _0x291265=await _0x3f5ebc[_0x1f5a7d(0x1a6)](_0x2160c1+_0x1f5a7d(0x1f3));if(!_0x291265)_0x291265=await _0x3f5ebc[_0x1f5a7d(0x1a6)](_0x2160c1+_0x1f5a7d(0x1a1));let _0x1317f7=await _0x3f5ebc[_0x1f5a7d(0x1a6)](_0x2160c1+_0x1f5a7d(0x1b3));if(!_0x1317f7)_0x1317f7=await _0x3f5ebc[_0x1f5a7d(0x1a6)](_0x2160c1+_0x1f5a7d(0x19f));let _0x5d75ac='Unbekannt';const _0x4f876d=await _0x3f5ebc[_0x1f5a7d(0x1a6)](_0x2160c1+'.Current.IsNight');if(_0x4f876d)_0x5d75ac=_0x4f876d[_0x1f5a7d(0x206)]?_0x1f5a7d(0x1a8):'Tag';if(_0x291265&&_0x1317f7)return _0x291265['val']+_0x1f5a7d(0x1b6)+_0x1317f7['val']+_0x1f5a7d(0x1fa)+_0x5d75ac;}catch(_0x181ddb){}return _0x1f5a7d(0x1ad);}function a0_0x1ca4(){const _0x5c2f88=['.\x20EVENTS:\x20','message','analysis.automation.patternDetected','\x0a\x20\x20\x20\x20EVENTS:\x0a','.\x20AUFGABE:\x201.\x20Gesundheit?\x202.\x20Komfort?\x20FORMAT\x20(JSON):\x20{\x20\x22isAlert\x22:\x20boolean,\x20\x22alertReason\x22:\x20\x22string\x22,\x20\x22isEmergency\x22:\x20boolean,\x20\x22summary\x22:\x20\x22string\x22,\x20\x22automationProposal\x22:\x20{\x20\x22detected\x22:\x20boolean,\x20\x22description\x22:\x20\x22string\x22,\x20\x22targetId\x22:\x20\x22string\x22,\x20\x22targetValue\x22:\x20\x22any\x22\x20}\x20}','Analysiere\x20diese\x20Events\x20des\x20TAGES\x20(08:00-Jetzt).\x20AktivitÃ¤t?\x20Mahlzeiten?\x20HaustÃ¼r?\x20Antwort\x20kurz\x20fÃ¼r\x20den\x20besorgten\x20Sohn\x20(max\x202\x20SÃ¤tze).','LTM.driftAnalysis.driftDetails','Entscheide\x20ausgewogen\x20zwischen\x20Komfort\x20und\x20Energie.','targetValue','trim','3960324mnfkZA','6125368IqEnTH','âš ï¸\x20ALARM:\x20','error','\x0a\x20\x20\x20\x20ROLLE:\x20Haus-Butler.\x0a\x20\x20\x20\x20SITUATION:\x20','2-digit','ðŸŒ…\x20Starting\x20Morning\x20Briefing\x20sequence\x20(Traffic\x20Check\x20bypassed)...','getDate','toLocaleTimeString','Fokus\x20auf\x20Komfort\x20fÃ¼r\x20die\x20Familie.','unshift','isProVersion','ðŸ¤–\x20Butler\x20Cache\x20Hit:\x20','length','1573725AexZuc',',\x20Wetter:\x20','\x0aSTB:\x20','search','constructor','text','driftDetails','value','ðŸ¤–\x20Autopilot\x20skipped\x20(Traffic\x20Protection\x20active).','18624MWnxwz','ROLLE:\x20KI-Hausverwalter.\x20PERSONA:\x20','stringify','\x22\x20AN.\x0a\x20\x20\x20\x20STRATEGIE:\x20','slice','\x20=\x20','analysis.automation.targetId','Briefing\x20Error:\x20','Bisher\x20keine\x20AktivitÃ¤t\x20seit\x2008:00\x20Uhr\x20verzeichnet.','sendNotification','useWeather','decision','Skipped\x20(No\x20AI\x20or\x20Data)','analysis.automation.targetValue','\x20->\x20','dailyDigests','analysisHistory','BUTLER\x20Execution\x20Error:\x20','.Current.Temperature','models/gemini-flash-latest','system.presenceWho',').\x20Sending\x20notification...','Sicherheit\x20geht\x20vor.','.\x20EMERGENCY:\x20','ðŸŒ…\x20Briefing\x20generated\x20(Length:\x20',',\x20LichtverhÃ¤ltnisse:\x20','info','4289454QcGiSg','\x0a\x20\x20\x20\x20ROLLE:\x20Medizinischer\x20Assistent\x20fÃ¼r\x20AAL\x20(Ambient\x20Assisted\x20Living).\x0a\x20\x20\x20\x20AUFGABE:\x20','summary','ðŸ¤–\x20Morning\x20Briefing\x20skipped:\x20No\x20Gemini\x20Model.','@google/generative-ai','rawEventLog','activityLevel','analysis.health.geminiNight','setStateAsync','LTM.processingStatus','val','\x0a\x20\x20\x20\x20ANTWORT-STIL:\x20Sachlich,\x20beruhigend,\x20prÃ¤zise.\x20Keine\x20Floskeln.\x0a\x20\x20\x20\x20','407442gyulma',')\x20generated.','analysis.automation.description','getStateAsync','156778PszYBt','ltmLtbWindowDays','apply','splice','\x0a\x20\x20\x20\x20FRAGE:\x20Ist\x20es\x20dunkel\x20genug\x20fÃ¼r\x20Licht?\x0a\x20\x20\x20\x20FORMAT:\x20{\x20\x22approved\x22:\x20boolean,\x20\x22reason\x22:\x20\x22kurzer\x20Grund\x22\x20}\x0a\x20\x20\x20\x20','Gemini\x20Error:\x20','currentSystemMode','baselineDrift','generateContent','analysis.health.geminiDay','ðŸ¤–\x20BUTLER:\x20No\x20valid\x20target\x20ID\x20or\x20value\x20stored\x20for\x20execution.','NIGHT','approved','Keine\x20Details.','(((.+)+)+)+$','LTM.driftAnalysis.baselineDrift','7866UIgVsQ','eventHistory','analysis.alertReason','Health\x20Report\x20Error:\x20','exports','description','response','automationProposal','Started...','log','toString','ðŸ¤–\x20Health\x20Report\x20(','.\x20ANWESEND:\x20','setDate','ðŸ“…\x20Daily\x20Digest:\x0a','isEmergency','PRIORITÃ„T:\x20Sicherheit\x20und\x20Licht.\x20Schalte\x20lieber\x20einmal\x20zu\x20viel\x20als\x20zu\x20wenig.','join','ðŸ¤–\x20API\x20Cooldown.\x20Waiting\x202s...','send','ðŸŒ…\x20Morning\x20Briefing:\x0a','\x20Ã¼bersprungen\x20(Auto-Approved).','ROLLE:\x20Data\x20Scientist.\x20ZIEL:\x20Drift\x20erkennen.\x20SCHEMA:\x20{\x20\x22baselineDrift\x22:\x20\x22none|slight|significant|critical\x22,\x20\x22driftDetails\x22:\x20\x22string\x22\x20}\x0a\x0aLTB:\x20','N/A\x20(Learning)','weatherInstance','parse','analysis.lastResult','replace','debug','isAlert','analysis.isAlert','getTime','toISOString','timestamp','.forecast.current.state','targetId','.forecast.current.temperature','Digest','name','alertReason','14GmBIBr','getForeignStateAsync','.\x20SYSTEM_MODE:\x20','Nacht','detected','KI\x20offline\x20(Fallback)','Analysiere\x20diese\x20Events\x20der\x20NACHT\x20(22:00-08:00).\x20War\x20der\x20Schlaf\x20ruhig?\x20Gab\x20es\x20BadgÃ¤nge?\x20Antwort\x20kurz\x20fÃ¼r\x20den\x20besorgten\x20Sohn\x20(max\x202\x20SÃ¤tze).','geminiModel','Wetterdaten\x20nicht\x20abrufbar','Keine\x20Daten\x20fÃ¼r\x20die\x20Nacht\x20aufgezeichnet\x20(Sensoren\x20ruhig).','aiPersona','\x22.\x0a\x20\x20\x20\x20AKTION:\x20Schalte\x20\x22','KI-Fehler\x20(Fallback)','setHours','.Current.WeatherText','warn','\x0aAktivitÃ¤t:\x20','Â°C,\x20','Skipped\x20(Traffic)','ltmStbWindowDays','lastAlertState','config','ROLLE:\x20Data\x20Compression\x20Agent.\x20SPRACHE:\x20DE.\x20FORMAT:\x20JSON.\x20ANWEISUNG:\x20Fasse\x20Sensor-Events\x20zusammen.\x20SCHEMA:\x20{\x20\x22summary\x22:\x20\x22string\x22,\x20\x22activityLevel\x22:\x20\x22string\x22\x20}\x20\x0a\x0aEVENTS:\x0a','ðŸ¤–\x20Traffic\x20Schutz:\x20Anfrage\x20fÃ¼r\x20','.\x0a\x20\x20\x20\x20EVENT:\x20Bewohner\x20geht\x20wahrscheinlich\x20(','now','Maximaler\x20Komfort,\x20Energie\x20ist\x20zweitrangig.'];a0_0x1ca4=function(){return _0x5c2f88;};return a0_0x1ca4();}async function consultButler(_0x3dee6b,_0x3c9f99,_0x5660ea,_0x2be478){const _0x57d414=a0_0x5cc494;if(!_0x3dee6b[_0x57d414(0x1ac)])return{'approved':!![],'reason':_0x57d414(0x1aa)};const _0x518cc1=Date[_0x57d414(0x1be)]();if(decisionCache[_0x3c9f99]&&_0x518cc1-decisionCache[_0x3c9f99]['timestamp']<CACHE_TTL_MS){const _0x18efa2=decisionCache[_0x3c9f99][_0x57d414(0x1ec)];return _0x3dee6b[_0x57d414(0x225)][_0x57d414(0x199)](_0x57d414(0x1d6)+_0x3c9f99+_0x57d414(0x1ef)+(_0x18efa2[_0x57d414(0x218)]?'OK':'NO')+'\x20('+_0x18efa2['reason']+')'),_0x18efa2;}if(!canCallApi())return _0x3dee6b[_0x57d414(0x225)][_0x57d414(0x199)](_0x57d414(0x1bc)+_0x3c9f99+_0x57d414(0x192)),{'approved':!![],'reason':'Traffic-Schutz\x20(Auto-Approved)'};const _0x270bac=new Date()['toLocaleTimeString'](),_0x20a038=await getWeatherContext(_0x3dee6b),_0x1565fc=PERSONA_MAPPING[_0x3dee6b[_0x57d414(0x1ba)][_0x57d414(0x1af)]||'generic'],_0x58e2bc=_0x57d414(0x1ce)+_0x270bac+_0x57d414(0x1d9)+_0x20a038+_0x57d414(0x1bd)+(_0x2be478*0x64)['toFixed'](0x0)+'%)\x20nach\x20\x22'+_0x3c9f99+_0x57d414(0x1b0)+_0x5660ea+_0x57d414(0x1e4)+_0x1565fc+_0x57d414(0x210);try{updateApiTimestamp();const _0x1f9586=await _0x3dee6b[_0x57d414(0x1ac)]['generateContent'](_0x58e2bc),_0x10106f=_0x1f9586[_0x57d414(0x222)]['text']()[_0x57d414(0x198)](/```json|```/g,'')[_0x57d414(0x1c9)](),_0x31d0b7=JSON[_0x57d414(0x196)](_0x10106f);return decisionCache[_0x3c9f99]={'decision':_0x31d0b7,'timestamp':_0x518cc1},_0x31d0b7;}catch(_0x588dd9){return _0x3dee6b[_0x57d414(0x225)][_0x57d414(0x1b4)]('ðŸ¤–\x20Butler\x20Brain\x20Error:\x20'+_0x588dd9[_0x57d414(0x1c1)]),decisionCache[_0x3c9f99]={'decision':{'approved':!![],'reason':_0x57d414(0x1b1)},'timestamp':_0x518cc1-(CACHE_TTL_MS-0xea60)},{'approved':!![],'reason':'KI-Fehler\x20(Fallback)'};}}async function runGeminiAnalysis(_0x1ddb21,_0xb7fac4=''){const _0x3c02d5=a0_0x5cc494;if(!_0x1ddb21[_0x3c02d5(0x1ac)])return;if(!canCallApi()){_0x1ddb21[_0x3c02d5(0x225)][_0x3c02d5(0x199)](_0x3c02d5(0x1e0));return;}if(_0x1ddb21[_0x3c02d5(0x21d)][_0x3c02d5(0x1d7)]===0x0)return;const _0x4a707f=_0x1ddb21[_0x3c02d5(0x21d)][_0x3c02d5(0x1e5)](0x0,0xf),_0x5c26f0=_0x1ddb21[_0x3c02d5(0x212)],_0xf84889=PERSONA_MAPPING[_0x1ddb21[_0x3c02d5(0x1ba)][_0x3c02d5(0x1af)]||'generic'],_0x151e13=_0x1ddb21[_0x3c02d5(0x1ba)]['livingContext']||_0x3c02d5(0x219);let _0x18a2b6='Unbekannt';try{const _0x56352c=await _0x1ddb21['getStateAsync'](_0x3c02d5(0x1f5));if(_0x56352c&&_0x56352c[_0x3c02d5(0x206)])_0x18a2b6=_0x56352c[_0x3c02d5(0x206)];}catch(_0x33f34f){}let _0x184550=![];try{const _0x53419f=await _0x1ddb21[_0x3c02d5(0x20b)]('analysis.automation.autoApply');if(_0x53419f&&_0x53419f['val'])_0x184550=!![];}catch(_0x2a96f0){}const _0x52ec73=_0x3c02d5(0x1e2)+_0xf84889+'.\x20KONTEXT:\x20'+_0x151e13+_0x3c02d5(0x1a7)+_0x5c26f0+_0x3c02d5(0x228)+_0x18a2b6+_0x3c02d5(0x1c0)+JSON[_0x3c02d5(0x1e3)](_0x4a707f)+_0x3c02d5(0x1f8)+_0xb7fac4+_0x3c02d5(0x1c4);try{updateApiTimestamp();const _0x3e578f=await _0x1ddb21[_0x3c02d5(0x1ac)][_0x3c02d5(0x214)](_0x52ec73),_0x33744f=JSON[_0x3c02d5(0x196)](_0x3e578f[_0x3c02d5(0x222)][_0x3c02d5(0x1dd)]()[_0x3c02d5(0x198)](/```json|```/g,'')[_0x3c02d5(0x1c9)]());await _0x1ddb21[_0x3c02d5(0x204)](_0x3c02d5(0x197),{'val':JSON[_0x3c02d5(0x1e3)](_0x33744f),'ack':!![]});if(_0x33744f[_0x3c02d5(0x1fe)])await _0x1ddb21[_0x3c02d5(0x204)]('analysis.activitySummary',{'val':_0x33744f[_0x3c02d5(0x1fe)],'ack':!![]});const _0x58accf={'timestamp':Date['now'](),'id':Date['now']()[_0x3c02d5(0x226)](),'analysis':{'activity':{'summary':_0x33744f[_0x3c02d5(0x1fe)],'isAlert':_0x33744f['isAlert'],'alertReason':_0x33744f[_0x3c02d5(0x1a4)]},'comfort':{'automationProposal':_0x33744f[_0x3c02d5(0x223)]}}};_0x1ddb21['analysisHistory'][_0x3c02d5(0x1d4)](_0x58accf);if(_0x1ddb21[_0x3c02d5(0x1f1)][_0x3c02d5(0x1d7)]>0x32)_0x1ddb21['analysisHistory']['pop']();await _0x1ddb21[_0x3c02d5(0x204)]('analysis.analysisHistory',{'val':JSON[_0x3c02d5(0x1e3)](_0x1ddb21[_0x3c02d5(0x1f1)]),'ack':!![]});const _0x73bb61=_0x33744f[_0x3c02d5(0x19a)]||![];_0x73bb61!==_0x1ddb21[_0x3c02d5(0x1b9)]&&(await _0x1ddb21[_0x3c02d5(0x204)](_0x3c02d5(0x19b),{'val':_0x73bb61,'ack':!![]}),_0x1ddb21[_0x3c02d5(0x1b9)]=_0x73bb61,_0x73bb61&&(await _0x1ddb21['setStateAsync'](_0x3c02d5(0x21e),{'val':_0x33744f[_0x3c02d5(0x1a4)],'ack':!![]}),setup[_0x3c02d5(0x1ea)](_0x1ddb21,_0x3c02d5(0x1cc)+_0x33744f['alertReason'],![],_0x33744f[_0x3c02d5(0x22b)])));if(_0x33744f[_0x3c02d5(0x223)]&&_0x33744f[_0x3c02d5(0x223)][_0x3c02d5(0x1a9)]){await _0x1ddb21[_0x3c02d5(0x204)](_0x3c02d5(0x1c2),{'val':!![],'ack':!![]}),await _0x1ddb21[_0x3c02d5(0x204)](_0x3c02d5(0x20a),{'val':_0x33744f[_0x3c02d5(0x223)][_0x3c02d5(0x221)],'ack':!![]}),await _0x1ddb21[_0x3c02d5(0x204)](_0x3c02d5(0x1e7),{'val':_0x33744f[_0x3c02d5(0x223)][_0x3c02d5(0x1a0)],'ack':!![]}),await _0x1ddb21[_0x3c02d5(0x204)]('analysis.automation.targetValue',{'val':JSON[_0x3c02d5(0x1e3)](_0x33744f[_0x3c02d5(0x223)][_0x3c02d5(0x1c8)]),'ack':!![]});if(_0x184550)executeAutomationAction(_0x1ddb21);}}catch(_0x46fa7f){_0x1ddb21['log'][_0x3c02d5(0x1cd)](_0x3c02d5(0x211)+_0x46fa7f[_0x3c02d5(0x1c1)]);}}async function createDailyDigest(_0x4edab9,_0x41ef91){const _0x17dc26=a0_0x5cc494;if(!_0x4edab9[_0x17dc26(0x1d5)])return;if(!canCallApi()){await _0x4edab9[_0x17dc26(0x204)](LTM_DP_STATUS,{'val':_0x17dc26(0x1b7),'ack':!![]});return;}await _0x4edab9['setStateAsync'](LTM_DP_STATUS,{'val':_0x17dc26(0x224),'ack':!![]});if(!_0x4edab9['geminiModel']||_0x4edab9[_0x17dc26(0x201)][_0x17dc26(0x1d7)]<LTM_MIN_EVENTS_FOR_COMPRESSION){await _0x4edab9['setStateAsync'](LTM_DP_STATUS,{'val':_0x17dc26(0x1ed),'ack':!![]});return;}const _0x2a09df=JSON[_0x17dc26(0x196)](JSON[_0x17dc26(0x1e3)](_0x4edab9['rawEventLog'])),_0x27b512=_0x2a09df[_0x17dc26(0x1d7)],_0x845a86=_0x17dc26(0x1bb)+JSON[_0x17dc26(0x1e3)](_0x2a09df);try{updateApiTimestamp();const _0x184285=await _0x4edab9[_0x17dc26(0x1ac)][_0x17dc26(0x214)](_0x845a86),_0x56cad0=JSON[_0x17dc26(0x196)](_0x184285['response']['text']()['replace'](/```json|```/g,'')[_0x17dc26(0x1c9)]()),_0x4e26be={'timestamp':new Date()[_0x17dc26(0x19d)](),'eventCount':_0x27b512,'summary':_0x56cad0[_0x17dc26(0x1fe)]||_0x17dc26(0x1a2),'activityLevel':_0x56cad0[_0x17dc26(0x202)]||'normal','systemMode':_0x4edab9[_0x17dc26(0x212)]};_0x4edab9[_0x17dc26(0x1f0)]['push'](_0x4e26be);const _0x141037=_0x4edab9[_0x17dc26(0x1ba)][_0x17dc26(0x20d)]||0x3c;_0x4edab9[_0x17dc26(0x1f0)][_0x17dc26(0x1d7)]>_0x141037&&_0x4edab9['dailyDigests'][_0x17dc26(0x20f)](0x0,_0x4edab9['dailyDigests'][_0x17dc26(0x1d7)]-_0x141037);await _0x4edab9['setStateAsync'](LTM_DP_DAILY_DIGESTS,{'val':JSON[_0x17dc26(0x1e3)](_0x4edab9[_0x17dc26(0x1f0)]),'ack':!![]}),_0x4edab9[_0x17dc26(0x201)]=[],await _0x4edab9[_0x17dc26(0x204)](LTM_DP_RAW_LOG,{'val':JSON['stringify'](_0x4edab9[_0x17dc26(0x201)]),'ack':!![]}),await _0x4edab9[_0x17dc26(0x204)](LTM_DP_STATUS,{'val':'Success','ack':!![]});const _0x369e57=_0x17dc26(0x22a)+_0x56cad0[_0x17dc26(0x1fe)]+_0x17dc26(0x1b5)+_0x56cad0[_0x17dc26(0x202)];setup[_0x17dc26(0x1ea)](_0x4edab9,_0x369e57,![],![]);if(_0x4edab9[_0x17dc26(0x1d5)]&&_0x41ef91)_0x41ef91[_0x17dc26(0x190)](_0x4edab9,'ANALYZE_HEALTH',{'digest':_0x4e26be});}catch(_0x5c99b6){_0x4edab9[_0x17dc26(0x225)][_0x17dc26(0x1cd)](_0x5c99b6[_0x17dc26(0x1c1)]);}}async function runBaselineDriftAnalysis(_0x523527){const _0xcead86=a0_0x5cc494;if(!_0x523527['isProVersion']||!_0x523527[_0xcead86(0x1ac)])return;if(!canCallApi())return;const _0x9c1b59=_0x523527[_0xcead86(0x1ba)][_0xcead86(0x1b8)]||0xe;if(_0x523527[_0xcead86(0x1f0)][_0xcead86(0x1d7)]<_0x9c1b59+0x7){await _0x523527[_0xcead86(0x204)](_0xcead86(0x21b),{'val':_0xcead86(0x194),'ack':!![]});return;}const _0x2da891=_0x523527[_0xcead86(0x1f0)]['slice'](-_0x9c1b59),_0x3eba9a=_0x523527[_0xcead86(0x1f0)][_0xcead86(0x1e5)](0x0,_0x523527[_0xcead86(0x1f0)][_0xcead86(0x1d7)]-_0x9c1b59),_0x160f87=_0xcead86(0x193)+JSON['stringify'](_0x3eba9a)+_0xcead86(0x1da)+JSON[_0xcead86(0x1e3)](_0x2da891);try{updateApiTimestamp();const _0x22bb85=await _0x523527[_0xcead86(0x1ac)][_0xcead86(0x214)](_0x160f87),_0x32e9f1=JSON[_0xcead86(0x196)](_0x22bb85[_0xcead86(0x222)]['text']()[_0xcead86(0x198)](/```json|```/g,'')[_0xcead86(0x1c9)]());_0x32e9f1[_0xcead86(0x213)]&&(await _0x523527[_0xcead86(0x204)]('LTM.driftAnalysis.baselineDrift',{'val':_0x32e9f1['baselineDrift'],'ack':!![]}),await _0x523527[_0xcead86(0x204)](_0xcead86(0x1c6),{'val':_0x32e9f1[_0xcead86(0x1de)],'ack':!![]}),await _0x523527[_0xcead86(0x204)]('LTM.driftAnalysis.lastCheck',{'val':Date[_0xcead86(0x1be)](),'ack':!![]}));}catch(_0x243623){}}async function executeAutomationAction(_0x25f91f){const _0x3f5535=a0_0x5cc494;try{const _0x459f2b=await _0x25f91f[_0x3f5535(0x20b)](_0x3f5535(0x1e7)),_0xb82929=await _0x25f91f[_0x3f5535(0x20b)](_0x3f5535(0x1ee));if(_0x459f2b&&_0x459f2b[_0x3f5535(0x206)]&&_0xb82929){const _0x1a8dd3=_0x459f2b['val'];let _0x3fc59c=_0xb82929['val'];try{_0x3fc59c=JSON[_0x3f5535(0x196)](_0x3fc59c);}catch(_0x47c858){}_0x25f91f[_0x3f5535(0x225)][_0x3f5535(0x1fb)]('ðŸ¤–\x20BUTLER:\x20Executing\x20Action\x20->\x20'+_0x1a8dd3+_0x3f5535(0x1e6)+_0x3fc59c),await _0x25f91f['setForeignStateAsync'](_0x1a8dd3,_0x3fc59c);}else _0x25f91f['log'][_0x3f5535(0x1b4)](_0x3f5535(0x216));}catch(_0x102aa4){_0x25f91f[_0x3f5535(0x225)][_0x3f5535(0x1cd)](_0x3f5535(0x1f2)+_0x102aa4[_0x3f5535(0x1c1)]);}}async function sendMorningBriefing(_0x187c80){const _0x3ec148=a0_0x5cc494;if(!_0x187c80[_0x3ec148(0x1ac)]){_0x187c80[_0x3ec148(0x225)][_0x3ec148(0x1b4)](_0x3ec148(0x1ff));return;}_0x187c80[_0x3ec148(0x225)]['info'](_0x3ec148(0x1d0));try{updateApiTimestamp();const _0x262944='Erstelle\x20ein\x20kurzes\x20\x27Guten\x20Morgen\x27\x20Briefing\x20basierend\x20auf\x20den\x20Events\x20der\x20letzten\x20Nacht.',_0x1f2a8b=await _0x187c80[_0x3ec148(0x1ac)][_0x3ec148(0x214)](_0x262944),_0x44cf71=_0x1f2a8b[_0x3ec148(0x222)]['text']();_0x187c80['log'][_0x3ec148(0x1fb)](_0x3ec148(0x1f9)+_0x44cf71[_0x3ec148(0x1d7)]+_0x3ec148(0x1f6)),setup[_0x3ec148(0x1ea)](_0x187c80,_0x3ec148(0x191)+_0x44cf71);}catch(_0x39d1e4){_0x187c80[_0x3ec148(0x225)][_0x3ec148(0x1cd)](_0x3ec148(0x1e8)+_0x39d1e4['message']);}}async function generateHealthReport(_0x523da8,_0x4212c6){const _0x3a3d1d=a0_0x5cc494;if(!_0x523da8[_0x3a3d1d(0x1ac)])return;const _0x1857b6=Date[_0x3a3d1d(0x1be)]();_0x1857b6-lastGlobalApiCall<0xbb8&&(_0x523da8[_0x3a3d1d(0x225)][_0x3a3d1d(0x199)](_0x3a3d1d(0x22e)),await new Promise(_0x32be77=>setTimeout(_0x32be77,0x7d0)));const _0x3e2431=new Date();let _0x22af9d=0x0,_0x2b3f1a=_0x3e2431[_0x3a3d1d(0x19c)](),_0x20858d='';if(_0x4212c6===_0x3a3d1d(0x217)){const _0x5d7206=new Date(_0x3e2431);_0x5d7206[_0x3a3d1d(0x229)](_0x5d7206[_0x3a3d1d(0x1d1)]()-0x1),_0x5d7206[_0x3a3d1d(0x1b2)](0x16,0x0,0x0,0x0),_0x22af9d=_0x5d7206[_0x3a3d1d(0x19c)]();const _0x3ed4d6=new Date(_0x3e2431);_0x3ed4d6[_0x3a3d1d(0x1b2)](0x8,0x0,0x0,0x0),_0x2b3f1a=_0x3ed4d6['getTime'](),_0x20858d=_0x3a3d1d(0x1ab);}else{const _0x20852e=new Date(_0x3e2431);_0x20852e[_0x3a3d1d(0x1b2)](0x8,0x0,0x0,0x0),_0x22af9d=_0x20852e[_0x3a3d1d(0x19c)](),_0x20858d=_0x3a3d1d(0x1c5);}const _0x235e14=_0x523da8[_0x3a3d1d(0x21d)]['filter'](_0x793251=>_0x793251['timestamp']>=_0x22af9d&&_0x793251['timestamp']<=_0x2b3f1a);if(_0x235e14[_0x3a3d1d(0x1d7)]===0x0){const _0x1e5a06=_0x4212c6===_0x3a3d1d(0x217)?_0x3a3d1d(0x1ae):_0x3a3d1d(0x1e9),_0x1bf4ab=_0x4212c6==='NIGHT'?'analysis.health.geminiNight':_0x3a3d1d(0x215);await _0x523da8[_0x3a3d1d(0x204)](_0x1bf4ab,{'val':_0x1e5a06,'ack':!![]});return;}const _0x12e2e1=_0x235e14['map'](_0x42c15a=>new Date(_0x42c15a[_0x3a3d1d(0x19e)])[_0x3a3d1d(0x1d2)]([],{'hour':_0x3a3d1d(0x1cf),'minute':_0x3a3d1d(0x1cf)})+'\x20'+_0x42c15a[_0x3a3d1d(0x1a3)]+'\x20('+_0x42c15a[_0x3a3d1d(0x1df)]+')')[_0x3a3d1d(0x22d)]('\x0a'),_0xab6317=_0x3a3d1d(0x1fd)+_0x20858d+_0x3a3d1d(0x1c3)+_0x12e2e1+_0x3a3d1d(0x207);try{updateApiTimestamp();const _0x2015ac=await _0x523da8[_0x3a3d1d(0x1ac)]['generateContent'](_0xab6317),_0xaedb19=_0x2015ac[_0x3a3d1d(0x222)][_0x3a3d1d(0x1dd)](),_0x2dd928=_0x4212c6===_0x3a3d1d(0x217)?_0x3a3d1d(0x203):_0x3a3d1d(0x215);await _0x523da8[_0x3a3d1d(0x204)](_0x2dd928,{'val':_0xaedb19,'ack':!![]}),_0x523da8[_0x3a3d1d(0x225)][_0x3a3d1d(0x1fb)](_0x3a3d1d(0x227)+_0x4212c6+_0x3a3d1d(0x209));}catch(_0x3c1dc2){_0x523da8['log'][_0x3a3d1d(0x1cd)](_0x3a3d1d(0x21f)+_0x3c1dc2['message']);}}module[a0_0x5cc494(0x220)]={'executeAutomationAction':executeAutomationAction,'createDailyDigest':createDailyDigest,'runBaselineDriftAnalysis':runBaselineDriftAnalysis,'sendMorningBriefing':sendMorningBriefing,'runGeminiAnalysis':runGeminiAnalysis,'consultButler':consultButler,'generateHealthReport':generateHealthReport};