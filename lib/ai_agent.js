const a0_0x29cce3=a0_0x3f95;function a0_0x3f95(_0x1d8867,_0x96e285){const _0xfc676f=a0_0x47df();return a0_0x3f95=function(_0x54b61a,_0xa03f1d){_0x54b61a=_0x54b61a-0x1a6;let _0x47df0e=_0xfc676f[_0x54b61a];return _0x47df0e;},a0_0x3f95(_0x1d8867,_0x96e285);}(function(_0x5e6a69,_0x1eef8d){const _0x37298e=a0_0x3f95,_0x239baa=_0x5e6a69();while(!![]){try{const _0x3d29f7=-parseInt(_0x37298e(0x1a6))/0x1*(parseInt(_0x37298e(0x242))/0x2)+-parseInt(_0x37298e(0x1cd))/0x3+-parseInt(_0x37298e(0x1c5))/0x4+-parseInt(_0x37298e(0x1d6))/0x5+parseInt(_0x37298e(0x1ae))/0x6+parseInt(_0x37298e(0x212))/0x7*(parseInt(_0x37298e(0x1c8))/0x8)+parseInt(_0x37298e(0x23e))/0x9;if(_0x3d29f7===_0x1eef8d)break;else _0x239baa['push'](_0x239baa['shift']());}catch(_0x71e64d){_0x239baa['push'](_0x239baa['shift']());}}}(a0_0x47df,0x4223a));const a0_0xa03f1d=(function(){let _0xdeb7b9=!![];return function(_0x29f548,_0x100dfe){const _0x43fab0=_0xdeb7b9?function(){const _0x5bbd40=a0_0x3f95;if(_0x100dfe){const _0x3278b7=_0x100dfe[_0x5bbd40(0x1ba)](_0x29f548,arguments);return _0x100dfe=null,_0x3278b7;}}:function(){};return _0xdeb7b9=![],_0x43fab0;};}()),a0_0x54b61a=a0_0xa03f1d(this,function(){const _0x3c77d3=a0_0x3f95;return a0_0x54b61a[_0x3c77d3(0x1d1)]()[_0x3c77d3(0x1b6)](_0x3c77d3(0x208))['toString']()[_0x3c77d3(0x203)](a0_0x54b61a)[_0x3c77d3(0x1b6)](_0x3c77d3(0x208));});a0_0x54b61a();'use strict';const {GoogleGenerativeAI}=require('@google/generative-ai'),setup=require('./setup'),GEMINI_MODEL=a0_0x29cce3(0x1fd),LTM_DP_DAILY_DIGESTS=a0_0x29cce3(0x1cf),LTM_DP_STATUS=a0_0x29cce3(0x200),LTM_DP_RAW_LOG=a0_0x29cce3(0x205),LTM_MIN_EVENTS_FOR_COMPRESSION=0x5,MIN_API_GAP_MS=0x4e20;let lastGlobalApiCall=0x0;const decisionCache={},CACHE_TTL_MS=0xf*0x3c*0x3e8,PERSONA_MAPPING={'generic':a0_0x29cce3(0x215),'senior_aal':a0_0x29cce3(0x1bd),'family':'Fokus\x20auf\x20Komfort\x20f√ºr\x20die\x20Familie.','single_comfort':'Maximaler\x20Komfort,\x20Energie\x20ist\x20zweitrangig.','security':a0_0x29cce3(0x1f1),'energy_saver':a0_0x29cce3(0x224)};function canCallApi(){const _0x2ecaf7=a0_0x29cce3,_0x2bc1dc=Date[_0x2ecaf7(0x1fa)]();return _0x2bc1dc-lastGlobalApiCall>MIN_API_GAP_MS;}function updateApiTimestamp(){const _0x22abc0=a0_0x29cce3;lastGlobalApiCall=Date[_0x22abc0(0x1fa)]();}async function getWeatherContext(_0x5d14ac){const _0x308aa9=a0_0x29cce3;if(!_0x5d14ac[_0x308aa9(0x237)][_0x308aa9(0x1ab)]||!_0x5d14ac[_0x308aa9(0x237)][_0x308aa9(0x233)])return _0x308aa9(0x1fb);try{const _0x11b2a6=_0x5d14ac[_0x308aa9(0x237)][_0x308aa9(0x233)];let _0x575ce6=await _0x5d14ac[_0x308aa9(0x22f)](_0x11b2a6+_0x308aa9(0x1f7));if(!_0x575ce6)_0x575ce6=await _0x5d14ac['getForeignStateAsync'](_0x11b2a6+_0x308aa9(0x1c6));let _0x14276d=await _0x5d14ac[_0x308aa9(0x22f)](_0x11b2a6+_0x308aa9(0x21b));if(!_0x14276d)_0x14276d=await _0x5d14ac[_0x308aa9(0x22f)](_0x11b2a6+_0x308aa9(0x217));let _0x4875eb=_0x308aa9(0x1b2);const _0x453eb4=await _0x5d14ac[_0x308aa9(0x22f)](_0x11b2a6+'.Current.IsNight');if(_0x453eb4)_0x4875eb=_0x453eb4[_0x308aa9(0x1fc)]?_0x308aa9(0x1b1):_0x308aa9(0x1d3);if(_0x575ce6&&_0x14276d)return _0x575ce6[_0x308aa9(0x1fc)]+'¬∞C,\x20'+_0x14276d[_0x308aa9(0x1fc)]+',\x20Lichtverh√§ltnisse:\x20'+_0x4875eb;}catch(_0x2be4cd){}return _0x308aa9(0x240);}async function consultButler(_0x1e006b,_0x1e26a0,_0x107310,_0x29ce65){const _0x2b4162=a0_0x29cce3;if(!_0x1e006b[_0x2b4162(0x1c0)])return{'approved':!![],'reason':_0x2b4162(0x1cc)};const _0x1dbbf3=Date[_0x2b4162(0x1fa)]();if(decisionCache[_0x1e26a0]&&_0x1dbbf3-decisionCache[_0x1e26a0][_0x2b4162(0x1f5)]<CACHE_TTL_MS){const _0x348414=decisionCache[_0x1e26a0]['decision'];return _0x1e006b['log'][_0x2b4162(0x221)]('ü§ñ\x20Butler\x20Cache\x20Hit:\x20'+_0x1e26a0+_0x2b4162(0x1df)+(_0x348414['approved']?'OK':'NO')+'\x20('+_0x348414['reason']+')'),_0x348414;}if(!canCallApi())return _0x1e006b[_0x2b4162(0x23c)]['debug']('ü§ñ\x20Traffic\x20Schutz:\x20Anfrage\x20f√ºr\x20'+_0x1e26a0+_0x2b4162(0x1ee)),{'approved':!![],'reason':_0x2b4162(0x220)};const _0x3e32da=new Date()['toLocaleTimeString'](),_0x1f3c03=await getWeatherContext(_0x1e006b),_0x1a159b=PERSONA_MAPPING[_0x1e006b[_0x2b4162(0x237)][_0x2b4162(0x23d)]||_0x2b4162(0x1e4)],_0x398c72=_0x2b4162(0x1c4)+_0x3e32da+_0x2b4162(0x1a8)+_0x1f3c03+_0x2b4162(0x234)+(_0x29ce65*0x64)[_0x2b4162(0x1f6)](0x0)+_0x2b4162(0x241)+_0x1e26a0+_0x2b4162(0x1f9)+_0x107310+_0x2b4162(0x20f)+_0x1a159b+_0x2b4162(0x1bf);try{updateApiTimestamp();const _0x279d50=await _0x1e006b[_0x2b4162(0x1c0)][_0x2b4162(0x214)](_0x398c72),_0x3f748e=_0x279d50['response'][_0x2b4162(0x216)]()[_0x2b4162(0x204)](/```json|```/g,'')[_0x2b4162(0x1e2)](),_0xb18f2f=JSON[_0x2b4162(0x235)](_0x3f748e);return decisionCache[_0x1e26a0]={'decision':_0xb18f2f,'timestamp':_0x1dbbf3},_0xb18f2f;}catch(_0x4a881f){return _0x1e006b[_0x2b4162(0x23c)][_0x2b4162(0x231)](_0x2b4162(0x22e)+_0x4a881f[_0x2b4162(0x1a9)]),decisionCache[_0x1e26a0]={'decision':{'approved':!![],'reason':_0x2b4162(0x22c)},'timestamp':_0x1dbbf3-(CACHE_TTL_MS-0xea60)},{'approved':!![],'reason':_0x2b4162(0x22c)};}}async function runGeminiAnalysis(_0xb91c86,_0x134fa8=''){const _0x1940ab=a0_0x29cce3;if(!_0xb91c86[_0x1940ab(0x1c0)])return;if(!canCallApi()){_0xb91c86[_0x1940ab(0x23c)][_0x1940ab(0x221)](_0x1940ab(0x1e8));return;}if(_0xb91c86['eventHistory'][_0x1940ab(0x1f0)]===0x0)return;const _0x1a6423=_0xb91c86['eventHistory'][_0x1940ab(0x209)](0x0,0xf),_0x3b66df=_0xb91c86[_0x1940ab(0x228)],_0x50c5c8=PERSONA_MAPPING[_0xb91c86[_0x1940ab(0x237)]['aiPersona']||_0x1940ab(0x1e4)],_0x4e7b33=_0xb91c86['config']['livingContext']||_0x1940ab(0x1bb);let _0x4106e8=_0x1940ab(0x1b2);try{const _0x4c38c8=await _0xb91c86[_0x1940ab(0x22b)](_0x1940ab(0x1c7));if(_0x4c38c8&&_0x4c38c8[_0x1940ab(0x1fc)])_0x4106e8=_0x4c38c8[_0x1940ab(0x1fc)];}catch(_0x293569){}let _0x5ec375=![];try{const _0x27da31=await _0xb91c86['getStateAsync'](_0x1940ab(0x218));if(_0x27da31&&_0x27da31['val'])_0x5ec375=!![];}catch(_0x5d2cd0){}const _0x5096cf=_0x1940ab(0x20b)+_0x50c5c8+_0x1940ab(0x1f8)+_0x4e7b33+_0x1940ab(0x1b8)+_0x3b66df+'.\x20ANWESEND:\x20'+_0x4106e8+_0x1940ab(0x1d5)+JSON[_0x1940ab(0x1db)](_0x1a6423)+_0x1940ab(0x1b9)+_0x134fa8+_0x1940ab(0x1f2);try{updateApiTimestamp();const _0x4c9ea2=await _0xb91c86[_0x1940ab(0x1c0)]['generateContent'](_0x5096cf),_0x3c46a8=JSON[_0x1940ab(0x235)](_0x4c9ea2['response'][_0x1940ab(0x216)]()[_0x1940ab(0x204)](/```json|```/g,'')[_0x1940ab(0x1e2)]());await _0xb91c86[_0x1940ab(0x1d0)](_0x1940ab(0x1cb),{'val':JSON['stringify'](_0x3c46a8),'ack':!![]});if(_0x3c46a8[_0x1940ab(0x1e3)])await _0xb91c86[_0x1940ab(0x1d0)](_0x1940ab(0x1dd),{'val':_0x3c46a8['summary'],'ack':!![]});const _0x822f07={'timestamp':Date['now'](),'id':Date[_0x1940ab(0x1fa)]()[_0x1940ab(0x1d1)](),'analysis':{'activity':{'summary':_0x3c46a8[_0x1940ab(0x1e3)],'isAlert':_0x3c46a8[_0x1940ab(0x21e)],'alertReason':_0x3c46a8[_0x1940ab(0x1ac)]},'comfort':{'automationProposal':_0x3c46a8[_0x1940ab(0x226)]}}};_0xb91c86[_0x1940ab(0x21c)][_0x1940ab(0x1ef)](_0x822f07);if(_0xb91c86[_0x1940ab(0x21c)][_0x1940ab(0x1f0)]>0x32)_0xb91c86['analysisHistory'][_0x1940ab(0x243)]();await _0xb91c86[_0x1940ab(0x1d0)]('analysis.analysisHistory',{'val':JSON[_0x1940ab(0x1db)](_0xb91c86[_0x1940ab(0x21c)]),'ack':!![]});const _0x2a1388=_0x3c46a8[_0x1940ab(0x21e)]||![];_0x2a1388!==_0xb91c86[_0x1940ab(0x1a7)]&&(await _0xb91c86[_0x1940ab(0x1d0)](_0x1940ab(0x227),{'val':_0x2a1388,'ack':!![]}),_0xb91c86[_0x1940ab(0x1a7)]=_0x2a1388,_0x2a1388&&(await _0xb91c86[_0x1940ab(0x1d0)](_0x1940ab(0x1eb),{'val':_0x3c46a8['alertReason'],'ack':!![]}),setup['sendNotification'](_0xb91c86,'‚ö†Ô∏è\x20ALARM:\x20'+_0x3c46a8['alertReason'],![],_0x3c46a8[_0x1940ab(0x21d)])));if(_0x3c46a8[_0x1940ab(0x226)]&&_0x3c46a8[_0x1940ab(0x226)][_0x1940ab(0x236)]){await _0xb91c86[_0x1940ab(0x1d0)](_0x1940ab(0x1c3),{'val':!![],'ack':!![]}),await _0xb91c86[_0x1940ab(0x1d0)](_0x1940ab(0x230),{'val':_0x3c46a8[_0x1940ab(0x226)][_0x1940ab(0x1ea)],'ack':!![]}),await _0xb91c86[_0x1940ab(0x1d0)]('analysis.automation.targetId',{'val':_0x3c46a8['automationProposal'][_0x1940ab(0x213)],'ack':!![]}),await _0xb91c86['setStateAsync'](_0x1940ab(0x1ec),{'val':JSON['stringify'](_0x3c46a8['automationProposal']['targetValue']),'ack':!![]});if(_0x5ec375)executeAutomationAction(_0xb91c86);}}catch(_0x540929){_0xb91c86['log'][_0x1940ab(0x1e6)](_0x1940ab(0x20d)+_0x540929[_0x1940ab(0x1a9)]);}}async function createDailyDigest(_0xdd078c,_0x45acb2){const _0x3fd32e=a0_0x29cce3;if(!_0xdd078c['isProVersion'])return;if(!canCallApi()){await _0xdd078c['setStateAsync'](LTM_DP_STATUS,{'val':'Skipped\x20(Traffic)','ack':!![]});return;}await _0xdd078c['setStateAsync'](LTM_DP_STATUS,{'val':'Started...','ack':!![]});if(!_0xdd078c['geminiModel']||_0xdd078c[_0x3fd32e(0x1be)][_0x3fd32e(0x1f0)]<LTM_MIN_EVENTS_FOR_COMPRESSION){await _0xdd078c[_0x3fd32e(0x1d0)](LTM_DP_STATUS,{'val':_0x3fd32e(0x1f3),'ack':!![]});return;}const _0x59d25e=JSON[_0x3fd32e(0x235)](JSON[_0x3fd32e(0x1db)](_0xdd078c[_0x3fd32e(0x1be)])),_0x2d74c3=_0x59d25e[_0x3fd32e(0x1f0)],_0x35e4cb=_0x3fd32e(0x1b0)+JSON[_0x3fd32e(0x1db)](_0x59d25e);try{updateApiTimestamp();const _0xbaa6c7=await _0xdd078c[_0x3fd32e(0x1c0)]['generateContent'](_0x35e4cb),_0x5a7c17=JSON[_0x3fd32e(0x235)](_0xbaa6c7[_0x3fd32e(0x20a)][_0x3fd32e(0x216)]()[_0x3fd32e(0x204)](/```json|```/g,'')[_0x3fd32e(0x1e2)]()),_0x3fac56={'timestamp':new Date()[_0x3fd32e(0x1ca)](),'eventCount':_0x2d74c3,'summary':_0x5a7c17[_0x3fd32e(0x1e3)]||_0x3fd32e(0x1c9),'activityLevel':_0x5a7c17[_0x3fd32e(0x23b)]||_0x3fd32e(0x1e7),'systemMode':_0xdd078c[_0x3fd32e(0x228)]};_0xdd078c[_0x3fd32e(0x1b5)][_0x3fd32e(0x1d4)](_0x3fac56);const _0xa97469=_0xdd078c[_0x3fd32e(0x237)][_0x3fd32e(0x20c)]||0x3c;_0xdd078c[_0x3fd32e(0x1b5)]['length']>_0xa97469&&_0xdd078c[_0x3fd32e(0x1b5)]['splice'](0x0,_0xdd078c[_0x3fd32e(0x1b5)][_0x3fd32e(0x1f0)]-_0xa97469);await _0xdd078c[_0x3fd32e(0x1d0)](LTM_DP_DAILY_DIGESTS,{'val':JSON['stringify'](_0xdd078c['dailyDigests']),'ack':!![]}),_0xdd078c[_0x3fd32e(0x1be)]=[],await _0xdd078c[_0x3fd32e(0x1d0)](LTM_DP_RAW_LOG,{'val':JSON[_0x3fd32e(0x1db)](_0xdd078c[_0x3fd32e(0x1be)]),'ack':!![]}),await _0xdd078c[_0x3fd32e(0x1d0)](LTM_DP_STATUS,{'val':_0x3fd32e(0x206),'ack':!![]});const _0x4a8b9b=_0x3fd32e(0x1d8)+_0x5a7c17[_0x3fd32e(0x1e3)]+_0x3fd32e(0x239)+_0x5a7c17[_0x3fd32e(0x23b)];setup[_0x3fd32e(0x1f4)](_0xdd078c,_0x4a8b9b,![],![]);if(_0xdd078c['isProVersion']&&_0x45acb2)_0x45acb2[_0x3fd32e(0x23a)](_0xdd078c,'ANALYZE_HEALTH',{'digest':_0x3fac56});}catch(_0x58708b){_0xdd078c[_0x3fd32e(0x23c)][_0x3fd32e(0x1e6)](_0x58708b['message']);}}function a0_0x47df(){const _0x5e718e=['push','.\x20EVENTS:\x20','1733205ZIzzsk','üåÖ\x20Morning\x20Briefing:\x0a','üìÖ\x20Daily\x20Digest:\x0a','map','driftDetails','stringify','\x20=\x20','analysis.activitySummary','analysis.automation.targetId','\x20->\x20','join','Briefing\x20Error:\x20','trim','summary','generic','setForeignStateAsync','error','normal','ü§ñ\x20Autopilot\x20skipped\x20(Traffic\x20Protection\x20active).','üåÖ\x20Starting\x20Morning\x20Briefing\x20sequence\x20(Traffic\x20Check\x20bypassed)...','description','analysis.alertReason','analysis.automation.targetValue','Bisher\x20keine\x20Aktivit√§t\x20seit\x2008:00\x20Uhr\x20verzeichnet.','\x20√ºbersprungen\x20(Auto-Approved).','unshift','length','Sicherheit\x20geht\x20vor.','.\x20AUFGABE:\x201.\x20Gesundheit?\x202.\x20Komfort?\x20FORMAT\x20(JSON):\x20{\x20\x22isAlert\x22:\x20boolean,\x20\x22alertReason\x22:\x20\x22string\x22,\x20\x22isEmergency\x22:\x20boolean,\x20\x22summary\x22:\x20\x22string\x22,\x20\x22automationProposal\x22:\x20{\x20\x22detected\x22:\x20boolean,\x20\x22description\x22:\x20\x22string\x22,\x20\x22targetId\x22:\x20\x22string\x22,\x20\x22targetValue\x22:\x20\x22any\x22\x20}\x20}','Skipped\x20(No\x20AI\x20or\x20Data)','sendNotification','timestamp','toFixed','.Current.Temperature','.\x20KONTEXT:\x20','\x22.\x0a\x20\x20\x20\x20AKTION:\x20Schalte\x20\x22','now','Unbekannt\x20(Kein\x20Sensor)','val','models/gemini-flash-latest','analysis.health.geminiDay','name','LTM.processingStatus','\x0a\x20\x20\x20\x20ROLLE:\x20Medizinischer\x20Assistent\x20f√ºr\x20AAL\x20(Ambient\x20Assisted\x20Living).\x0a\x20\x20\x20\x20AUFGABE:\x20','Analysiere\x20diese\x20Events\x20des\x20TAGES\x20(08:00-Jetzt).\x20Aktivit√§t?\x20Mahlzeiten?\x20Haust√ºr?\x20Antwort\x20kurz\x20f√ºr\x20den\x20besorgten\x20Sohn\x20(max\x202\x20S√§tze).','constructor','replace','LTM.rawEventLog','Success','getTime','(((.+)+)+)+$','slice','response','ROLLE:\x20KI-Hausverwalter.\x20PERSONA:\x20','ltmLtbWindowDays','Gemini\x20Error:\x20','ROLLE:\x20Data\x20Scientist.\x20ZIEL:\x20Drift\x20erkennen.\x20SCHEMA:\x20{\x20\x22baselineDrift\x22:\x20\x22none|slight|significant|critical\x22,\x20\x22driftDetails\x22:\x20\x22string\x22\x20}\x0a\x0aLTB:\x20','\x22\x20AN.\x0a\x20\x20\x20\x20STRATEGIE:\x20','ü§ñ\x20BUTLER:\x20No\x20valid\x20target\x20ID\x20or\x20value\x20stored\x20for\x20execution.','\x0a\x20\x20\x20\x20EVENTS:\x0a','3241826YdSYWx','targetId','generateContent','Entscheide\x20ausgewogen\x20zwischen\x20Komfort\x20und\x20Energie.','text','.forecast.current.state','analysis.automation.autoApply',').\x20Sending\x20notification...','info','.Current.WeatherText','analysisHistory','isEmergency','isAlert','ü§ñ\x20API\x20Cooldown.\x20Waiting\x202s...','Traffic-Schutz\x20(Auto-Approved)','debug','N/A\x20(Learning)','baselineDrift','PRIORIT√ÑT:\x20Energie\x20sparen.\x20Schalte\x20nur,\x20wenn\x20absolut\x20notwendig\x20(Dunkelheit).','exports','automationProposal','analysis.isAlert','currentSystemMode','Erstelle\x20ein\x20kurzes\x20\x27Guten\x20Morgen\x27\x20Briefing\x20basierend\x20auf\x20den\x20Events\x20der\x20letzten\x20Nacht.','ü§ñ\x20Morning\x20Briefing\x20skipped:\x20No\x20Gemini\x20Model.','getStateAsync','KI-Fehler\x20(Fallback)','NIGHT','ü§ñ\x20Butler\x20Brain\x20Error:\x20','getForeignStateAsync','analysis.automation.description','warn','Keine\x20Daten\x20f√ºr\x20die\x20Nacht\x20aufgezeichnet\x20(Sensoren\x20ruhig).','weatherInstance','.\x0a\x20\x20\x20\x20EVENT:\x20Bewohner\x20geht\x20wahrscheinlich\x20(','parse','detected','config','setHours','\x0aAktivit√§t:\x20','send','activityLevel','log','aiPersona','7100631qZAWan','Analysiere\x20diese\x20Events\x20der\x20NACHT\x20(22:00-08:00).\x20War\x20der\x20Schlaf\x20ruhig?\x20Gab\x20es\x20Badg√§nge?\x20Antwort\x20kurz\x20f√ºr\x20den\x20besorgten\x20Sohn\x20(max\x202\x20S√§tze).','Wetterdaten\x20nicht\x20abrufbar','%)\x20nach\x20\x22','34qkHoOD','pop','4405MYhuQJ','lastAlertState',',\x20Wetter:\x20','message','setDate','useWeather','alertReason','BUTLER\x20Execution\x20Error:\x20','1744542mMRYGm','analysis.health.geminiNight','ROLLE:\x20Data\x20Compression\x20Agent.\x20SPRACHE:\x20DE.\x20FORMAT:\x20JSON.\x20ANWEISUNG:\x20Fasse\x20Sensor-Events\x20zusammen.\x20SCHEMA:\x20{\x20\x22summary\x22:\x20\x22string\x22,\x20\x22activityLevel\x22:\x20\x22string\x22\x20}\x20\x0a\x0aEVENTS:\x0a','Nacht','Unbekannt','LTM.driftAnalysis.baselineDrift','2-digit','dailyDigests','search','toLocaleTimeString','.\x20SYSTEM_MODE:\x20','.\x20EMERGENCY:\x20','apply','Keine\x20Details.','value','PRIORIT√ÑT:\x20Sicherheit\x20und\x20Licht.\x20Schalte\x20lieber\x20einmal\x20zu\x20viel\x20als\x20zu\x20wenig.','rawEventLog','\x0a\x20\x20\x20\x20FRAGE:\x20Ist\x20es\x20dunkel\x20genug\x20f√ºr\x20Licht?\x0a\x20\x20\x20\x20FORMAT:\x20{\x20\x22approved\x22:\x20boolean,\x20\x22reason\x22:\x20\x22kurzer\x20Grund\x22\x20}\x0a\x20\x20\x20\x20','geminiModel','LTM.driftAnalysis.driftDetails',')\x20generated.','analysis.automation.patternDetected','\x0a\x20\x20\x20\x20ROLLE:\x20Haus-Butler.\x0a\x20\x20\x20\x20SITUATION:\x20','1792284zzIMbL','.forecast.current.temperature','system.presenceWho','8fjLSzR','Digest','toISOString','analysis.lastResult','KI\x20offline\x20(Fallback)','1206993NgNzGC','getDate','LTM.dailyDigests','setStateAsync','toString','eventHistory','Tag'];a0_0x47df=function(){return _0x5e718e;};return a0_0x47df();}async function runBaselineDriftAnalysis(_0x150279){const _0x35989d=a0_0x29cce3;if(!_0x150279['isProVersion']||!_0x150279[_0x35989d(0x1c0)])return;if(!canCallApi())return;const _0x4a5259=_0x150279['config']['ltmStbWindowDays']||0xe;if(_0x150279['dailyDigests'][_0x35989d(0x1f0)]<_0x4a5259+0x7){await _0x150279[_0x35989d(0x1d0)](_0x35989d(0x1b3),{'val':_0x35989d(0x222),'ack':!![]});return;}const _0x20bc04=_0x150279[_0x35989d(0x1b5)][_0x35989d(0x209)](-_0x4a5259),_0x5672f0=_0x150279['dailyDigests'][_0x35989d(0x209)](0x0,_0x150279[_0x35989d(0x1b5)][_0x35989d(0x1f0)]-_0x4a5259),_0x360e1f=_0x35989d(0x20e)+JSON[_0x35989d(0x1db)](_0x5672f0)+'\x0aSTB:\x20'+JSON[_0x35989d(0x1db)](_0x20bc04);try{updateApiTimestamp();const _0x456489=await _0x150279[_0x35989d(0x1c0)][_0x35989d(0x214)](_0x360e1f),_0xec5c62=JSON[_0x35989d(0x235)](_0x456489[_0x35989d(0x20a)][_0x35989d(0x216)]()['replace'](/```json|```/g,'')[_0x35989d(0x1e2)]());_0xec5c62['baselineDrift']&&(await _0x150279[_0x35989d(0x1d0)]('LTM.driftAnalysis.baselineDrift',{'val':_0xec5c62[_0x35989d(0x223)],'ack':!![]}),await _0x150279[_0x35989d(0x1d0)](_0x35989d(0x1c1),{'val':_0xec5c62[_0x35989d(0x1da)],'ack':!![]}),await _0x150279['setStateAsync']('LTM.driftAnalysis.lastCheck',{'val':Date[_0x35989d(0x1fa)](),'ack':!![]}));}catch(_0x52c0e3){}}async function executeAutomationAction(_0x7034f4){const _0x4359b3=a0_0x29cce3;try{const _0x5e4ff6=await _0x7034f4[_0x4359b3(0x22b)](_0x4359b3(0x1de)),_0x14af60=await _0x7034f4[_0x4359b3(0x22b)]('analysis.automation.targetValue');if(_0x5e4ff6&&_0x5e4ff6[_0x4359b3(0x1fc)]&&_0x14af60){const _0x17b99b=_0x5e4ff6[_0x4359b3(0x1fc)];let _0x1a29ca=_0x14af60[_0x4359b3(0x1fc)];try{_0x1a29ca=JSON[_0x4359b3(0x235)](_0x1a29ca);}catch(_0x2c0f1e){}_0x7034f4['log'][_0x4359b3(0x21a)]('ü§ñ\x20BUTLER:\x20Executing\x20Action\x20->\x20'+_0x17b99b+_0x4359b3(0x1dc)+_0x1a29ca),await _0x7034f4[_0x4359b3(0x1e5)](_0x17b99b,_0x1a29ca);}else _0x7034f4[_0x4359b3(0x23c)][_0x4359b3(0x231)](_0x4359b3(0x210));}catch(_0x24e626){_0x7034f4['log'][_0x4359b3(0x1e6)](_0x4359b3(0x1ad)+_0x24e626[_0x4359b3(0x1a9)]);}}async function sendMorningBriefing(_0x4ebadf){const _0x25470c=a0_0x29cce3;if(!_0x4ebadf[_0x25470c(0x1c0)]){_0x4ebadf['log'][_0x25470c(0x231)](_0x25470c(0x22a));return;}_0x4ebadf['log'][_0x25470c(0x21a)](_0x25470c(0x1e9));try{updateApiTimestamp();const _0x5eee09=_0x25470c(0x229),_0x5e0a47=await _0x4ebadf['geminiModel']['generateContent'](_0x5eee09),_0x1dd38b=_0x5e0a47['response']['text']();_0x4ebadf['log'][_0x25470c(0x21a)]('üåÖ\x20Briefing\x20generated\x20(Length:\x20'+_0x1dd38b[_0x25470c(0x1f0)]+_0x25470c(0x219)),setup['sendNotification'](_0x4ebadf,_0x25470c(0x1d7)+_0x1dd38b);}catch(_0x24baee){_0x4ebadf[_0x25470c(0x23c)][_0x25470c(0x1e6)](_0x25470c(0x1e1)+_0x24baee[_0x25470c(0x1a9)]);}}async function generateHealthReport(_0x1a0801,_0x53e801){const _0x4e85f4=a0_0x29cce3;if(!_0x1a0801[_0x4e85f4(0x1c0)])return;const _0x3f3d46=Date[_0x4e85f4(0x1fa)]();_0x3f3d46-lastGlobalApiCall<0xbb8&&(_0x1a0801[_0x4e85f4(0x23c)]['debug'](_0x4e85f4(0x21f)),await new Promise(_0x18e5c4=>setTimeout(_0x18e5c4,0x7d0)));const _0x45a025=new Date();let _0x625bd6=0x0,_0x177603=_0x45a025['getTime'](),_0x3e696f='';if(_0x53e801===_0x4e85f4(0x22d)){const _0x48d552=new Date(_0x45a025);_0x48d552[_0x4e85f4(0x1aa)](_0x48d552[_0x4e85f4(0x1ce)]()-0x1),_0x48d552[_0x4e85f4(0x238)](0x16,0x0,0x0,0x0),_0x625bd6=_0x48d552[_0x4e85f4(0x207)]();const _0x1b99ed=new Date(_0x45a025);_0x1b99ed[_0x4e85f4(0x238)](0x8,0x0,0x0,0x0),_0x177603=_0x1b99ed[_0x4e85f4(0x207)](),_0x3e696f=_0x4e85f4(0x23f);}else{const _0x34f019=new Date(_0x45a025);_0x34f019[_0x4e85f4(0x238)](0x8,0x0,0x0,0x0),_0x625bd6=_0x34f019['getTime'](),_0x3e696f=_0x4e85f4(0x202);}const _0x1628c4=_0x1a0801[_0x4e85f4(0x1d2)]['filter'](_0x30c89e=>_0x30c89e[_0x4e85f4(0x1f5)]>=_0x625bd6&&_0x30c89e[_0x4e85f4(0x1f5)]<=_0x177603);if(_0x1628c4['length']===0x0){const _0x528605=_0x53e801===_0x4e85f4(0x22d)?_0x4e85f4(0x232):_0x4e85f4(0x1ed),_0x243536=_0x53e801===_0x4e85f4(0x22d)?_0x4e85f4(0x1af):'analysis.health.geminiDay';await _0x1a0801[_0x4e85f4(0x1d0)](_0x243536,{'val':_0x528605,'ack':!![]});return;}const _0x167ea6=_0x1628c4[_0x4e85f4(0x1d9)](_0x5795ef=>new Date(_0x5795ef[_0x4e85f4(0x1f5)])[_0x4e85f4(0x1b7)]([],{'hour':_0x4e85f4(0x1b4),'minute':_0x4e85f4(0x1b4)})+'\x20'+_0x5795ef[_0x4e85f4(0x1ff)]+'\x20('+_0x5795ef[_0x4e85f4(0x1bc)]+')')[_0x4e85f4(0x1e0)]('\x0a'),_0x8a2759=_0x4e85f4(0x201)+_0x3e696f+_0x4e85f4(0x211)+_0x167ea6+'\x0a\x20\x20\x20\x20ANTWORT-STIL:\x20Sachlich,\x20beruhigend,\x20pr√§zise.\x20Keine\x20Floskeln.\x0a\x20\x20\x20\x20';try{updateApiTimestamp();const _0x395e51=await _0x1a0801[_0x4e85f4(0x1c0)][_0x4e85f4(0x214)](_0x8a2759),_0x28042c=_0x395e51[_0x4e85f4(0x20a)][_0x4e85f4(0x216)](),_0x2f19f4=_0x53e801===_0x4e85f4(0x22d)?_0x4e85f4(0x1af):_0x4e85f4(0x1fe);await _0x1a0801[_0x4e85f4(0x1d0)](_0x2f19f4,{'val':_0x28042c,'ack':!![]}),_0x1a0801[_0x4e85f4(0x23c)][_0x4e85f4(0x21a)]('ü§ñ\x20Health\x20Report\x20('+_0x53e801+_0x4e85f4(0x1c2));}catch(_0x3922a8){_0x1a0801['log'][_0x4e85f4(0x1e6)]('Health\x20Report\x20Error:\x20'+_0x3922a8['message']);}}module[a0_0x29cce3(0x225)]={'executeAutomationAction':executeAutomationAction,'createDailyDigest':createDailyDigest,'runBaselineDriftAnalysis':runBaselineDriftAnalysis,'sendMorningBriefing':sendMorningBriefing,'runGeminiAnalysis':runGeminiAnalysis,'consultButler':consultButler,'generateHealthReport':generateHealthReport};