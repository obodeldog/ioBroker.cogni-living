const a0_0x4c4473=a0_0xac88;(function(_0x1b0778,_0x4d048d){const _0x3486af=a0_0xac88,_0x1a44ed=_0x1b0778();while(!![]){try{const _0x5e1cac=parseInt(_0x3486af(0x213))/0x1+-parseInt(_0x3486af(0x1bc))/0x2*(-parseInt(_0x3486af(0x231))/0x3)+parseInt(_0x3486af(0x229))/0x4*(-parseInt(_0x3486af(0x1f2))/0x5)+-parseInt(_0x3486af(0x201))/0x6*(parseInt(_0x3486af(0x1a1))/0x7)+parseInt(_0x3486af(0x22d))/0x8+-parseInt(_0x3486af(0x204))/0x9*(parseInt(_0x3486af(0x1fb))/0xa)+parseInt(_0x3486af(0x1cd))/0xb;if(_0x5e1cac===_0x4d048d)break;else _0x1a44ed['push'](_0x1a44ed['shift']());}catch(_0x38eddb){_0x1a44ed['push'](_0x1a44ed['shift']());}}}(a0_0x6eb2,0xdf1c0));function a0_0xac88(_0x53e77a,_0xeddd0f){const _0x75b1d2=a0_0x6eb2();return a0_0xac88=function(_0x97206,_0x6dd986){_0x97206=_0x97206-0x198;let _0x6eb235=_0x75b1d2[_0x97206];return _0x6eb235;},a0_0xac88(_0x53e77a,_0xeddd0f);}const a0_0x6dd986=(function(){let _0x1861cf=!![];return function(_0x184f29,_0x36aa9c){const _0x161aa0=_0x1861cf?function(){const _0x25203e=a0_0xac88;if(_0x36aa9c){const _0x1fb4b1=_0x36aa9c[_0x25203e(0x212)](_0x184f29,arguments);return _0x36aa9c=null,_0x1fb4b1;}}:function(){};return _0x1861cf=![],_0x161aa0;};}()),a0_0x97206=a0_0x6dd986(this,function(){const _0x3f1420=a0_0xac88;return a0_0x97206[_0x3f1420(0x1b2)]()[_0x3f1420(0x1cb)](_0x3f1420(0x1aa))[_0x3f1420(0x1b2)]()[_0x3f1420(0x1e7)](a0_0x97206)[_0x3f1420(0x1cb)](_0x3f1420(0x1aa));});a0_0x97206();'use strict';const {GoogleGenerativeAI}=require(a0_0x4c4473(0x1f7)),setup=require('./setup'),GEMINI_MODEL=a0_0x4c4473(0x1f4),LTM_DP_DAILY_DIGESTS=a0_0x4c4473(0x202),LTM_DP_STATUS=a0_0x4c4473(0x1f9),LTM_DP_RAW_LOG=a0_0x4c4473(0x220),LTM_MIN_EVENTS_FOR_COMPRESSION=0x5,MIN_API_GAP_MS=0x4e20;let lastGlobalApiCall=0x0;function a0_0x6eb2(){const _0x5049f7=['apply','1659206ECkWlv','analysis.automation.targetValue','summary','Analysiere\x20diese\x20Events\x20des\x20TAGES\x20(08:00-Jetzt).\x20AktivitÃ¤t?\x20Mahlzeiten?\x20HaustÃ¼r?\x20Antwort\x20kurz\x20fÃ¼r\x20den\x20besorgten\x20Sohn\x20(max\x202\x20SÃ¤tze).','ðŸ¤–\x20Autopilot\x20skipped\x20(Traffic\x20Protection\x20active).','isAlert','text','.\x20AUFGABE:\x201.\x20Gesundheit?\x202.\x20Komfort?\x20FORMAT\x20(JSON):\x20{\x20\x22isAlert\x22:\x20boolean,\x20\x22alertReason\x22:\x20\x22string\x22,\x20\x22isEmergency\x22:\x20boolean,\x20\x22summary\x22:\x20\x22string\x22,\x20\x22automationProposal\x22:\x20{\x20\x22detected\x22:\x20boolean,\x20\x22description\x22:\x20\x22string\x22,\x20\x22targetId\x22:\x20\x22string\x22,\x20\x22targetValue\x22:\x20\x22any\x22\x20}\x20}','%)\x20nach\x20\x22','Health\x20Report\x20Error:\x20','Success','.Current.IsNight','ANALYZE_HEALTH','LTM.rawEventLog','\x0a\x20\x20\x20\x20ANTWORT-STIL:\x20Sachlich,\x20beruhigend,\x20prÃ¤zise.\x20Keine\x20Floskeln.\x0a\x20\x20\x20\x20','\x22.\x0a\x20\x20\x20\x20AKTION:\x20Schalte\x20\x22','setHours','now','Keine\x20Details.','isProVersion','debug','\x20=\x20','16kHdJwl','isEmergency','\x20Ã¼bersprungen\x20(Auto-Approved).','response','4780976rlbBiz','useWeather','send','Entscheide\x20ausgewogen\x20zwischen\x20Komfort\x20und\x20Energie.','3jEWofj','setForeignStateAsync','analysis.isAlert','.Current.Temperature','push','currentSystemMode','weatherInstance','.\x20SYSTEM_MODE:\x20','message','Wetterdaten\x20nicht\x20abrufbar','geminiModel','join','119CkcMnG','parse','.forecast.current.state','Gemini\x20Error:\x20','setDate','analysis.lastResult','targetId','.\x0a\x20\x20\x20\x20EVENT:\x20Bewohner\x20geht\x20wahrscheinlich\x20(','NIGHT','(((.+)+)+)+$','description','toFixed','warn','dailyDigests','val','error','toISOString','toString','Bisher\x20keine\x20AktivitÃ¤t\x20seit\x2008:00\x20Uhr\x20verzeichnet.','PRIORITÃ„T:\x20Sicherheit\x20und\x20Licht.\x20Schalte\x20lieber\x20einmal\x20zu\x20viel\x20als\x20zu\x20wenig.','Analysiere\x20diese\x20Events\x20der\x20NACHT\x20(22:00-08:00).\x20War\x20der\x20Schlaf\x20ruhig?\x20Gab\x20es\x20BadgÃ¤nge?\x20Antwort\x20kurz\x20fÃ¼r\x20den\x20besorgten\x20Sohn\x20(max\x202\x20SÃ¤tze).','splice','analysis.automation.targetId','Briefing\x20Error:\x20','.\x20EMERGENCY:\x20','driftDetails','setStateAsync','2239826rbSPyh','config','\x0a\x20\x20\x20\x20EVENTS:\x0a','slice','timestamp','getTime','generateContent','analysis.automation.patternDetected','ltmStbWindowDays','decision','length','Â°C,\x20','ðŸŒ…\x20Morning\x20Briefing:\x0a','âš ï¸\x20ALARM:\x20','replace','search','PRIORITÃ„T:\x20Energie\x20sparen.\x20Schalte\x20nur,\x20wenn\x20absolut\x20notwendig\x20(Dunkelheit).','1631652gTGjFX','LTM.driftAnalysis.baselineDrift','pop','ðŸ¤–\x20Butler\x20Brain\x20Error:\x20','normal','aiPersona','eventHistory','rawEventLog','analysis.health.geminiDay','ROLLE:\x20Data\x20Compression\x20Agent.\x20SPRACHE:\x20DE.\x20FORMAT:\x20JSON.\x20ANWEISUNG:\x20Fasse\x20Sensor-Events\x20zusammen.\x20SCHEMA:\x20{\x20\x22summary\x22:\x20\x22string\x22,\x20\x22activityLevel\x22:\x20\x22string\x22\x20}\x20\x0a\x0aEVENTS:\x0a','ðŸ¤–\x20BUTLER:\x20Executing\x20Action\x20->\x20','getForeignStateAsync','sendNotification','analysisHistory','LTM.driftAnalysis.driftDetails','ðŸŒ…\x20Starting\x20Morning\x20Briefing\x20sequence\x20(Traffic\x20Check\x20bypassed)...','ðŸ¤–\x20Butler\x20Cache\x20Hit:\x20','\x20->\x20','Maximaler\x20Komfort,\x20Energie\x20ist\x20zweitrangig.',',\x20LichtverhÃ¤ltnisse:\x20','ðŸ¤–\x20Health\x20Report\x20(','Sicherheit\x20geht\x20vor.','2-digit','Unbekannt\x20(Kein\x20Sensor)','\x0a\x20\x20\x20\x20FRAGE:\x20Ist\x20es\x20dunkel\x20genug\x20fÃ¼r\x20Licht?\x0a\x20\x20\x20\x20FORMAT:\x20{\x20\x22approved\x22:\x20boolean,\x20\x22reason\x22:\x20\x22kurzer\x20Grund\x22\x20}\x0a\x20\x20\x20\x20','KI-Fehler\x20(Fallback)','constructor','.\x20ANWESEND:\x20','detected','Keine\x20Daten\x20fÃ¼r\x20die\x20Nacht\x20aufgezeichnet\x20(Sensoren\x20ruhig).','analysis.automation.description','\x0a\x20\x20\x20\x20ROLLE:\x20Haus-Butler.\x0a\x20\x20\x20\x20SITUATION:\x20','\x22\x20AN.\x0a\x20\x20\x20\x20STRATEGIE:\x20','\x0a\x20\x20\x20\x20ROLLE:\x20Medizinischer\x20Assistent\x20fÃ¼r\x20AAL\x20(Ambient\x20Assisted\x20Living).\x0a\x20\x20\x20\x20AUFGABE:\x20','\x0aAktivitÃ¤t:\x20','analysis.health.geminiNight','system.presenceWho','1140460JQiBmJ','map','models/gemini-flash-latest','baselineDrift','analysis.alertReason','@google/generative-ai','getStateAsync','LTM.processingStatus',').\x20Sending\x20notification...','201400TyUnZG','alertReason','automationProposal','lastAlertState','ðŸ¤–\x20API\x20Cooldown.\x20Waiting\x202s...','trim','244182kyNlMP','LTM.dailyDigests','ltmLtbWindowDays','450yymCoQ','.forecast.current.temperature','analysis.analysisHistory','ROLLE:\x20KI-Hausverwalter.\x20PERSONA:\x20','.\x20KONTEXT:\x20','toLocaleTimeString','stringify',')\x20generated.','log','info','Traffic-Schutz\x20(Auto-Approved)','Started...','unshift','ðŸ¤–\x20Morning\x20Briefing\x20skipped:\x20No\x20Gemini\x20Model.'];a0_0x6eb2=function(){return _0x5049f7;};return a0_0x6eb2();}const decisionCache={},CACHE_TTL_MS=0xf*0x3c*0x3e8,PERSONA_MAPPING={'generic':a0_0x4c4473(0x230),'senior_aal':a0_0x4c4473(0x1b4),'family':'Fokus\x20auf\x20Komfort\x20fÃ¼r\x20die\x20Familie.','single_comfort':a0_0x4c4473(0x1df),'security':a0_0x4c4473(0x1e2),'energy_saver':a0_0x4c4473(0x1cc)};function canCallApi(){const _0x5ee529=a0_0x4c4473,_0x439854=Date[_0x5ee529(0x224)]();return _0x439854-lastGlobalApiCall>MIN_API_GAP_MS;}function updateApiTimestamp(){const _0x38a32a=a0_0x4c4473;lastGlobalApiCall=Date[_0x38a32a(0x224)]();}async function getWeatherContext(_0x15d140){const _0x5c7df0=a0_0x4c4473;if(!_0x15d140[_0x5c7df0(0x1bd)][_0x5c7df0(0x22e)]||!_0x15d140[_0x5c7df0(0x1bd)][_0x5c7df0(0x19b)])return _0x5c7df0(0x1e4);try{const _0x35a239=_0x15d140[_0x5c7df0(0x1bd)][_0x5c7df0(0x19b)];let _0x464074=await _0x15d140[_0x5c7df0(0x1d8)](_0x35a239+_0x5c7df0(0x198));if(!_0x464074)_0x464074=await _0x15d140['getForeignStateAsync'](_0x35a239+_0x5c7df0(0x205));let _0x726b12=await _0x15d140[_0x5c7df0(0x1d8)](_0x35a239+'.Current.WeatherText');if(!_0x726b12)_0x726b12=await _0x15d140[_0x5c7df0(0x1d8)](_0x35a239+_0x5c7df0(0x1a3));let _0x5c1bb0='Unbekannt';const _0x54942e=await _0x15d140['getForeignStateAsync'](_0x35a239+_0x5c7df0(0x21e));if(_0x54942e)_0x5c1bb0=_0x54942e['val']?'Nacht':'Tag';if(_0x464074&&_0x726b12)return _0x464074[_0x5c7df0(0x1af)]+_0x5c7df0(0x1c7)+_0x726b12[_0x5c7df0(0x1af)]+_0x5c7df0(0x1e0)+_0x5c1bb0;}catch(_0x577103){}return _0x5c7df0(0x19e);}async function consultButler(_0x5364da,_0x5ca614,_0x4306fc,_0x1eac91){const _0x513579=a0_0x4c4473;if(!_0x5364da[_0x513579(0x19f)])return{'approved':!![],'reason':'KI\x20offline\x20(Fallback)'};const _0x25f658=Date[_0x513579(0x224)]();if(decisionCache[_0x5ca614]&&_0x25f658-decisionCache[_0x5ca614][_0x513579(0x1c0)]<CACHE_TTL_MS){const _0x228975=decisionCache[_0x5ca614][_0x513579(0x1c5)];return _0x5364da[_0x513579(0x20c)][_0x513579(0x227)](_0x513579(0x1dd)+_0x5ca614+_0x513579(0x1de)+(_0x228975['approved']?'OK':'NO')+'\x20('+_0x228975['reason']+')'),_0x228975;}if(!canCallApi())return _0x5364da[_0x513579(0x20c)][_0x513579(0x227)]('ðŸ¤–\x20Traffic\x20Schutz:\x20Anfrage\x20fÃ¼r\x20'+_0x5ca614+_0x513579(0x22b)),{'approved':!![],'reason':_0x513579(0x20e)};const _0x51f7b5=new Date()[_0x513579(0x209)](),_0x5d0329=await getWeatherContext(_0x5364da),_0x59370a=PERSONA_MAPPING[_0x5364da['config']['aiPersona']||'generic'],_0x364414=_0x513579(0x1ec)+_0x51f7b5+',\x20Wetter:\x20'+_0x5d0329+_0x513579(0x1a8)+(_0x1eac91*0x64)[_0x513579(0x1ac)](0x0)+_0x513579(0x21b)+_0x5ca614+_0x513579(0x222)+_0x4306fc+_0x513579(0x1ed)+_0x59370a+_0x513579(0x1e5);try{updateApiTimestamp();const _0x1bc2ce=await _0x5364da['geminiModel']['generateContent'](_0x364414),_0x5588a0=_0x1bc2ce[_0x513579(0x22c)][_0x513579(0x219)]()[_0x513579(0x1ca)](/```json|```/g,'')[_0x513579(0x200)](),_0x2c59ce=JSON[_0x513579(0x1a2)](_0x5588a0);return decisionCache[_0x5ca614]={'decision':_0x2c59ce,'timestamp':_0x25f658},_0x2c59ce;}catch(_0x3adfcb){return _0x5364da[_0x513579(0x20c)][_0x513579(0x1ad)](_0x513579(0x1d0)+_0x3adfcb[_0x513579(0x19d)]),decisionCache[_0x5ca614]={'decision':{'approved':!![],'reason':_0x513579(0x1e6)},'timestamp':_0x25f658-(CACHE_TTL_MS-0xea60)},{'approved':!![],'reason':_0x513579(0x1e6)};}}async function runGeminiAnalysis(_0x1e679c,_0x344d0b=''){const _0x17cee3=a0_0x4c4473;if(!_0x1e679c[_0x17cee3(0x19f)])return;if(!canCallApi()){_0x1e679c['log'][_0x17cee3(0x227)](_0x17cee3(0x217));return;}if(_0x1e679c[_0x17cee3(0x1d3)][_0x17cee3(0x1c6)]===0x0)return;const _0x424c47=_0x1e679c[_0x17cee3(0x1d3)][_0x17cee3(0x1bf)](0x0,0xf),_0x1a4c20=_0x1e679c[_0x17cee3(0x19a)],_0x35b000=PERSONA_MAPPING[_0x1e679c['config'][_0x17cee3(0x1d2)]||'generic'],_0x1df9ab=_0x1e679c[_0x17cee3(0x1bd)]['livingContext']||_0x17cee3(0x225);let _0x37ce60='Unbekannt';try{const _0x8352e4=await _0x1e679c[_0x17cee3(0x1f8)](_0x17cee3(0x1f1));if(_0x8352e4&&_0x8352e4['val'])_0x37ce60=_0x8352e4['val'];}catch(_0x4ab8ef){}let _0x1a6d34=![];try{const _0x42dc32=await _0x1e679c[_0x17cee3(0x1f8)]('analysis.automation.autoApply');if(_0x42dc32&&_0x42dc32[_0x17cee3(0x1af)])_0x1a6d34=!![];}catch(_0x3849b7){}const _0x2fffbd=_0x17cee3(0x207)+_0x35b000+_0x17cee3(0x208)+_0x1df9ab+_0x17cee3(0x19c)+_0x1a4c20+_0x17cee3(0x1e8)+_0x37ce60+'.\x20EVENTS:\x20'+JSON['stringify'](_0x424c47)+_0x17cee3(0x1b9)+_0x344d0b+_0x17cee3(0x21a);try{updateApiTimestamp();const _0xa8e030=await _0x1e679c[_0x17cee3(0x19f)][_0x17cee3(0x1c2)](_0x2fffbd),_0x494649=JSON[_0x17cee3(0x1a2)](_0xa8e030['response']['text']()[_0x17cee3(0x1ca)](/```json|```/g,'')[_0x17cee3(0x200)]());await _0x1e679c[_0x17cee3(0x1bb)](_0x17cee3(0x1a6),{'val':JSON[_0x17cee3(0x20a)](_0x494649),'ack':!![]});if(_0x494649[_0x17cee3(0x215)])await _0x1e679c[_0x17cee3(0x1bb)]('analysis.activitySummary',{'val':_0x494649[_0x17cee3(0x215)],'ack':!![]});const _0x4aed48={'timestamp':Date[_0x17cee3(0x224)](),'id':Date[_0x17cee3(0x224)]()['toString'](),'analysis':{'activity':{'summary':_0x494649[_0x17cee3(0x215)],'isAlert':_0x494649[_0x17cee3(0x218)],'alertReason':_0x494649[_0x17cee3(0x1fc)]},'comfort':{'automationProposal':_0x494649[_0x17cee3(0x1fd)]}}};_0x1e679c['analysisHistory'][_0x17cee3(0x210)](_0x4aed48);if(_0x1e679c['analysisHistory'][_0x17cee3(0x1c6)]>0x32)_0x1e679c['analysisHistory'][_0x17cee3(0x1cf)]();await _0x1e679c['setStateAsync'](_0x17cee3(0x206),{'val':JSON[_0x17cee3(0x20a)](_0x1e679c[_0x17cee3(0x1da)]),'ack':!![]});const _0x21c30d=_0x494649[_0x17cee3(0x218)]||![];_0x21c30d!==_0x1e679c['lastAlertState']&&(await _0x1e679c[_0x17cee3(0x1bb)](_0x17cee3(0x233),{'val':_0x21c30d,'ack':!![]}),_0x1e679c[_0x17cee3(0x1fe)]=_0x21c30d,_0x21c30d&&(await _0x1e679c[_0x17cee3(0x1bb)](_0x17cee3(0x1f6),{'val':_0x494649[_0x17cee3(0x1fc)],'ack':!![]}),setup[_0x17cee3(0x1d9)](_0x1e679c,_0x17cee3(0x1c9)+_0x494649[_0x17cee3(0x1fc)],![],_0x494649[_0x17cee3(0x22a)])));if(_0x494649['automationProposal']&&_0x494649[_0x17cee3(0x1fd)][_0x17cee3(0x1e9)]){await _0x1e679c[_0x17cee3(0x1bb)](_0x17cee3(0x1c3),{'val':!![],'ack':!![]}),await _0x1e679c[_0x17cee3(0x1bb)](_0x17cee3(0x1eb),{'val':_0x494649[_0x17cee3(0x1fd)][_0x17cee3(0x1ab)],'ack':!![]}),await _0x1e679c['setStateAsync'](_0x17cee3(0x1b7),{'val':_0x494649[_0x17cee3(0x1fd)][_0x17cee3(0x1a7)],'ack':!![]}),await _0x1e679c[_0x17cee3(0x1bb)]('analysis.automation.targetValue',{'val':JSON[_0x17cee3(0x20a)](_0x494649[_0x17cee3(0x1fd)]['targetValue']),'ack':!![]});if(_0x1a6d34)executeAutomationAction(_0x1e679c);}}catch(_0x4d0d1c){_0x1e679c[_0x17cee3(0x20c)][_0x17cee3(0x1b0)](_0x17cee3(0x1a4)+_0x4d0d1c[_0x17cee3(0x19d)]);}}async function createDailyDigest(_0x3cee6d,_0x7ccfd6){const _0x3d0239=a0_0x4c4473;if(!_0x3cee6d['isProVersion'])return;if(!canCallApi()){await _0x3cee6d['setStateAsync'](LTM_DP_STATUS,{'val':'Skipped\x20(Traffic)','ack':!![]});return;}await _0x3cee6d[_0x3d0239(0x1bb)](LTM_DP_STATUS,{'val':_0x3d0239(0x20f),'ack':!![]});if(!_0x3cee6d['geminiModel']||_0x3cee6d['rawEventLog'][_0x3d0239(0x1c6)]<LTM_MIN_EVENTS_FOR_COMPRESSION){await _0x3cee6d[_0x3d0239(0x1bb)](LTM_DP_STATUS,{'val':'Skipped\x20(No\x20AI\x20or\x20Data)','ack':!![]});return;}const _0x5a6b87=JSON['parse'](JSON[_0x3d0239(0x20a)](_0x3cee6d[_0x3d0239(0x1d4)])),_0x153fee=_0x5a6b87[_0x3d0239(0x1c6)],_0x13700f=_0x3d0239(0x1d6)+JSON['stringify'](_0x5a6b87);try{updateApiTimestamp();const _0x5d8711=await _0x3cee6d['geminiModel'][_0x3d0239(0x1c2)](_0x13700f),_0x4828c6=JSON[_0x3d0239(0x1a2)](_0x5d8711[_0x3d0239(0x22c)][_0x3d0239(0x219)]()['replace'](/```json|```/g,'')[_0x3d0239(0x200)]()),_0x4ab1b4={'timestamp':new Date()[_0x3d0239(0x1b1)](),'eventCount':_0x153fee,'summary':_0x4828c6[_0x3d0239(0x215)]||'Digest','activityLevel':_0x4828c6['activityLevel']||_0x3d0239(0x1d1),'systemMode':_0x3cee6d[_0x3d0239(0x19a)]};_0x3cee6d[_0x3d0239(0x1ae)][_0x3d0239(0x199)](_0x4ab1b4);const _0x339895=_0x3cee6d[_0x3d0239(0x1bd)][_0x3d0239(0x203)]||0x3c;_0x3cee6d[_0x3d0239(0x1ae)][_0x3d0239(0x1c6)]>_0x339895&&_0x3cee6d[_0x3d0239(0x1ae)][_0x3d0239(0x1b6)](0x0,_0x3cee6d[_0x3d0239(0x1ae)]['length']-_0x339895);await _0x3cee6d['setStateAsync'](LTM_DP_DAILY_DIGESTS,{'val':JSON[_0x3d0239(0x20a)](_0x3cee6d['dailyDigests']),'ack':!![]}),_0x3cee6d[_0x3d0239(0x1d4)]=[],await _0x3cee6d['setStateAsync'](LTM_DP_RAW_LOG,{'val':JSON[_0x3d0239(0x20a)](_0x3cee6d[_0x3d0239(0x1d4)]),'ack':!![]}),await _0x3cee6d[_0x3d0239(0x1bb)](LTM_DP_STATUS,{'val':_0x3d0239(0x21d),'ack':!![]});const _0x24ce96='ðŸ“…\x20Daily\x20Digest:\x0a'+_0x4828c6[_0x3d0239(0x215)]+_0x3d0239(0x1ef)+_0x4828c6['activityLevel'];setup['sendNotification'](_0x3cee6d,_0x24ce96,![],![]);if(_0x3cee6d[_0x3d0239(0x226)]&&_0x7ccfd6)_0x7ccfd6[_0x3d0239(0x22f)](_0x3cee6d,_0x3d0239(0x21f),{'digest':_0x4ab1b4});}catch(_0x325de2){_0x3cee6d[_0x3d0239(0x20c)][_0x3d0239(0x1b0)](_0x325de2[_0x3d0239(0x19d)]);}}async function runBaselineDriftAnalysis(_0x197d37){const _0xe016d=a0_0x4c4473;if(!_0x197d37[_0xe016d(0x226)]||!_0x197d37[_0xe016d(0x19f)])return;if(!canCallApi())return;const _0x1f5a68=_0x197d37[_0xe016d(0x1bd)][_0xe016d(0x1c4)]||0xe;if(_0x197d37[_0xe016d(0x1ae)][_0xe016d(0x1c6)]<_0x1f5a68+0x7){await _0x197d37[_0xe016d(0x1bb)](_0xe016d(0x1ce),{'val':'N/A\x20(Learning)','ack':!![]});return;}const _0x349048=_0x197d37[_0xe016d(0x1ae)][_0xe016d(0x1bf)](-_0x1f5a68),_0x3bd7f2=_0x197d37['dailyDigests']['slice'](0x0,_0x197d37[_0xe016d(0x1ae)][_0xe016d(0x1c6)]-_0x1f5a68),_0xd99607='ROLLE:\x20Data\x20Scientist.\x20ZIEL:\x20Drift\x20erkennen.\x20SCHEMA:\x20{\x20\x22baselineDrift\x22:\x20\x22none|slight|significant|critical\x22,\x20\x22driftDetails\x22:\x20\x22string\x22\x20}\x0a\x0aLTB:\x20'+JSON[_0xe016d(0x20a)](_0x3bd7f2)+'\x0aSTB:\x20'+JSON['stringify'](_0x349048);try{updateApiTimestamp();const _0x4bd0f2=await _0x197d37[_0xe016d(0x19f)][_0xe016d(0x1c2)](_0xd99607),_0x516802=JSON[_0xe016d(0x1a2)](_0x4bd0f2['response']['text']()[_0xe016d(0x1ca)](/```json|```/g,'')['trim']());_0x516802['baselineDrift']&&(await _0x197d37[_0xe016d(0x1bb)]('LTM.driftAnalysis.baselineDrift',{'val':_0x516802[_0xe016d(0x1f5)],'ack':!![]}),await _0x197d37[_0xe016d(0x1bb)](_0xe016d(0x1db),{'val':_0x516802[_0xe016d(0x1ba)],'ack':!![]}),await _0x197d37[_0xe016d(0x1bb)]('LTM.driftAnalysis.lastCheck',{'val':Date['now'](),'ack':!![]}));}catch(_0x606e8b){}}async function executeAutomationAction(_0x15d92f){const _0x2a0541=a0_0x4c4473;try{const _0x106d66=await _0x15d92f[_0x2a0541(0x1f8)](_0x2a0541(0x1b7)),_0x1bc6fc=await _0x15d92f[_0x2a0541(0x1f8)](_0x2a0541(0x214));if(_0x106d66&&_0x106d66['val']&&_0x1bc6fc){const _0xe8e6e5=_0x106d66[_0x2a0541(0x1af)];let _0x55d0e2=_0x1bc6fc[_0x2a0541(0x1af)];try{_0x55d0e2=JSON[_0x2a0541(0x1a2)](_0x55d0e2);}catch(_0x325910){}_0x15d92f[_0x2a0541(0x20c)]['info'](_0x2a0541(0x1d7)+_0xe8e6e5+_0x2a0541(0x228)+_0x55d0e2),await _0x15d92f[_0x2a0541(0x232)](_0xe8e6e5,_0x55d0e2);}else _0x15d92f[_0x2a0541(0x20c)]['warn']('ðŸ¤–\x20BUTLER:\x20No\x20valid\x20target\x20ID\x20or\x20value\x20stored\x20for\x20execution.');}catch(_0x4692e1){_0x15d92f[_0x2a0541(0x20c)][_0x2a0541(0x1b0)]('BUTLER\x20Execution\x20Error:\x20'+_0x4692e1[_0x2a0541(0x19d)]);}}async function sendMorningBriefing(_0x47f9df){const _0x2e6035=a0_0x4c4473;if(!_0x47f9df[_0x2e6035(0x19f)]){_0x47f9df[_0x2e6035(0x20c)][_0x2e6035(0x1ad)](_0x2e6035(0x211));return;}_0x47f9df[_0x2e6035(0x20c)][_0x2e6035(0x20d)](_0x2e6035(0x1dc));try{updateApiTimestamp();const _0x5072da='Erstelle\x20ein\x20kurzes\x20\x27Guten\x20Morgen\x27\x20Briefing\x20basierend\x20auf\x20den\x20Events\x20der\x20letzten\x20Nacht.',_0x30d2c4=await _0x47f9df[_0x2e6035(0x19f)][_0x2e6035(0x1c2)](_0x5072da),_0x24aa3a=_0x30d2c4['response']['text']();_0x47f9df['log'][_0x2e6035(0x20d)]('ðŸŒ…\x20Briefing\x20generated\x20(Length:\x20'+_0x24aa3a[_0x2e6035(0x1c6)]+_0x2e6035(0x1fa)),setup['sendNotification'](_0x47f9df,_0x2e6035(0x1c8)+_0x24aa3a);}catch(_0x3ba019){_0x47f9df['log'][_0x2e6035(0x1b0)](_0x2e6035(0x1b8)+_0x3ba019[_0x2e6035(0x19d)]);}}async function generateHealthReport(_0x13cc61,_0x1828d7){const _0x2ef09d=a0_0x4c4473;if(!_0x13cc61[_0x2ef09d(0x19f)])return;const _0x53636c=Date[_0x2ef09d(0x224)]();_0x53636c-lastGlobalApiCall<0xbb8&&(_0x13cc61[_0x2ef09d(0x20c)][_0x2ef09d(0x227)](_0x2ef09d(0x1ff)),await new Promise(_0x3698fa=>setTimeout(_0x3698fa,0x7d0)));const _0x20f5ae=new Date();let _0x25dc24=0x0,_0x20bde0=_0x20f5ae[_0x2ef09d(0x1c1)](),_0x1aad35='';if(_0x1828d7===_0x2ef09d(0x1a9)){const _0x53e9a2=new Date(_0x20f5ae);_0x53e9a2[_0x2ef09d(0x1a5)](_0x53e9a2['getDate']()-0x1),_0x53e9a2[_0x2ef09d(0x223)](0x16,0x0,0x0,0x0),_0x25dc24=_0x53e9a2[_0x2ef09d(0x1c1)]();const _0x5b52d0=new Date(_0x20f5ae);_0x5b52d0[_0x2ef09d(0x223)](0x8,0x0,0x0,0x0),_0x20bde0=_0x5b52d0[_0x2ef09d(0x1c1)](),_0x1aad35=_0x2ef09d(0x1b5);}else{const _0x8c59e7=new Date(_0x20f5ae);_0x8c59e7[_0x2ef09d(0x223)](0x8,0x0,0x0,0x0),_0x25dc24=_0x8c59e7[_0x2ef09d(0x1c1)](),_0x1aad35=_0x2ef09d(0x216);}const _0x5efe1d=_0x13cc61['eventHistory']['filter'](_0x2b9076=>_0x2b9076[_0x2ef09d(0x1c0)]>=_0x25dc24&&_0x2b9076[_0x2ef09d(0x1c0)]<=_0x20bde0);if(_0x5efe1d['length']===0x0){const _0x1c4606=_0x1828d7===_0x2ef09d(0x1a9)?_0x2ef09d(0x1ea):_0x2ef09d(0x1b3),_0x30d778=_0x1828d7==='NIGHT'?_0x2ef09d(0x1f0):_0x2ef09d(0x1d5);await _0x13cc61[_0x2ef09d(0x1bb)](_0x30d778,{'val':_0x1c4606,'ack':!![]});return;}const _0x36fda7=_0x5efe1d[_0x2ef09d(0x1f3)](_0x3d2150=>new Date(_0x3d2150[_0x2ef09d(0x1c0)])['toLocaleTimeString']([],{'hour':_0x2ef09d(0x1e3),'minute':_0x2ef09d(0x1e3)})+'\x20'+_0x3d2150['name']+'\x20('+_0x3d2150['value']+')')[_0x2ef09d(0x1a0)]('\x0a'),_0x2101ce=_0x2ef09d(0x1ee)+_0x1aad35+_0x2ef09d(0x1be)+_0x36fda7+_0x2ef09d(0x221);try{updateApiTimestamp();const _0x5ecb50=await _0x13cc61[_0x2ef09d(0x19f)][_0x2ef09d(0x1c2)](_0x2101ce),_0x5a2bd1=_0x5ecb50[_0x2ef09d(0x22c)]['text'](),_0x307af5=_0x1828d7===_0x2ef09d(0x1a9)?_0x2ef09d(0x1f0):_0x2ef09d(0x1d5);await _0x13cc61['setStateAsync'](_0x307af5,{'val':_0x5a2bd1,'ack':!![]}),_0x13cc61[_0x2ef09d(0x20c)][_0x2ef09d(0x20d)](_0x2ef09d(0x1e1)+_0x1828d7+_0x2ef09d(0x20b));}catch(_0x1e6808){_0x13cc61[_0x2ef09d(0x20c)][_0x2ef09d(0x1b0)](_0x2ef09d(0x21c)+_0x1e6808[_0x2ef09d(0x19d)]);}}module['exports']={'executeAutomationAction':executeAutomationAction,'createDailyDigest':createDailyDigest,'runBaselineDriftAnalysis':runBaselineDriftAnalysis,'sendMorningBriefing':sendMorningBriefing,'runGeminiAnalysis':runGeminiAnalysis,'consultButler':consultButler,'generateHealthReport':generateHealthReport};