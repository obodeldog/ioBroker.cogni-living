const a0_0x40ca5f=a0_0x1c38;(function(_0x5c8de6,_0x130e51){const _0x4b10ae=a0_0x1c38,_0x39970a=_0x5c8de6();while(!![]){try{const _0x4fa7ba=-parseInt(_0x4b10ae(0x22f))/0x1*(parseInt(_0x4b10ae(0x1be))/0x2)+-parseInt(_0x4b10ae(0x224))/0x3*(parseInt(_0x4b10ae(0x1b8))/0x4)+parseInt(_0x4b10ae(0x1a4))/0x5+-parseInt(_0x4b10ae(0x1d8))/0x6*(parseInt(_0x4b10ae(0x196))/0x7)+parseInt(_0x4b10ae(0x1c7))/0x8+-parseInt(_0x4b10ae(0x1d3))/0x9+parseInt(_0x4b10ae(0x22b))/0xa;if(_0x4fa7ba===_0x130e51)break;else _0x39970a['push'](_0x39970a['shift']());}catch(_0x4a8939){_0x39970a['push'](_0x39970a['shift']());}}}(a0_0x1d28,0x2b270));const a0_0x3361ec=(function(){let _0xcf5464=!![];return function(_0x304ec4,_0xa48f10){const _0x1768d7=_0xcf5464?function(){if(_0xa48f10){const _0x29159c=_0xa48f10['apply'](_0x304ec4,arguments);return _0xa48f10=null,_0x29159c;}}:function(){};return _0xcf5464=![],_0x1768d7;};}()),a0_0x1a010e=a0_0x3361ec(this,function(){const _0x5ca7af=a0_0x1c38;return a0_0x1a010e[_0x5ca7af(0x1e6)]()[_0x5ca7af(0x1a9)](_0x5ca7af(0x1cc))['toString']()[_0x5ca7af(0x1cf)](a0_0x1a010e)[_0x5ca7af(0x1a9)](_0x5ca7af(0x1cc));});a0_0x1a010e();function a0_0x1c38(_0x147fc7,_0x7d98f7){const _0x42598b=a0_0x1d28();return a0_0x1c38=function(_0x1a010e,_0x3361ec){_0x1a010e=_0x1a010e-0x194;let _0x1d2861=_0x42598b[_0x1a010e];return _0x1d2861;},a0_0x1c38(_0x147fc7,_0x7d98f7);}'use strict';const {GoogleGenerativeAI}=require(a0_0x40ca5f(0x1c4)),setup=require('./setup'),GEMINI_MODEL='models/gemini-flash-latest',LTM_DP_DAILY_DIGESTS=a0_0x40ca5f(0x1fd),LTM_DP_STATUS=a0_0x40ca5f(0x1f5),LTM_DP_RAW_LOG=a0_0x40ca5f(0x1de),LTM_MIN_EVENTS_FOR_COMPRESSION=0x5,MIN_API_GAP_MS=0x4e20;let lastGlobalApiCall=0x0;const decisionCache={},CACHE_TTL_MS=0xf*0x3c*0x3e8,PERSONA_MAPPING={'generic':a0_0x40ca5f(0x21f),'senior_aal':'PRIORIT√ÑT:\x20Sicherheit\x20und\x20Licht.\x20Schalte\x20lieber\x20einmal\x20zu\x20viel\x20als\x20zu\x20wenig.','family':a0_0x40ca5f(0x1ef),'single_comfort':a0_0x40ca5f(0x212),'security':a0_0x40ca5f(0x1ce),'energy_saver':a0_0x40ca5f(0x19b)};function canCallApi(){const _0x3c1d2c=Date['now']();return _0x3c1d2c-lastGlobalApiCall>MIN_API_GAP_MS;}function updateApiTimestamp(){lastGlobalApiCall=Date['now']();}async function getWeatherContext(_0x3261fd){const _0x513331=a0_0x40ca5f;if(!_0x3261fd[_0x513331(0x1a0)][_0x513331(0x1f7)]||!_0x3261fd[_0x513331(0x1a0)][_0x513331(0x1e2)])return'Unbekannt\x20(Kein\x20Sensor)';try{const _0x26a9a5=_0x3261fd['config'][_0x513331(0x1e2)];let _0x1ed848=await _0x3261fd[_0x513331(0x214)](_0x26a9a5+_0x513331(0x1c5));if(!_0x1ed848)_0x1ed848=await _0x3261fd['getForeignStateAsync'](_0x26a9a5+_0x513331(0x1a8));let _0x18aa69=await _0x3261fd[_0x513331(0x214)](_0x26a9a5+_0x513331(0x1a6));if(!_0x18aa69)_0x18aa69=await _0x3261fd[_0x513331(0x214)](_0x26a9a5+_0x513331(0x1fa));let _0x452506='Unbekannt';const _0x46f5ab=await _0x3261fd[_0x513331(0x214)](_0x26a9a5+_0x513331(0x1a2));if(_0x46f5ab)_0x452506=_0x46f5ab[_0x513331(0x1d6)]?_0x513331(0x213):_0x513331(0x21d);if(_0x1ed848&&_0x18aa69)return _0x1ed848['val']+'¬∞C,\x20'+_0x18aa69['val']+_0x513331(0x1df)+_0x452506;}catch(_0x3c2756){}return'Wetterdaten\x20nicht\x20abrufbar';}async function consultButler(_0x59e23b,_0xefb6ac,_0x53eeed,_0xdd8bb6){const _0x1a6be8=a0_0x40ca5f;if(!_0x59e23b[_0x1a6be8(0x215)])return{'approved':!![],'reason':_0x1a6be8(0x1b3)};const _0x248944=Date['now']();if(decisionCache[_0xefb6ac]&&_0x248944-decisionCache[_0xefb6ac][_0x1a6be8(0x199)]<CACHE_TTL_MS){const _0x29f94b=decisionCache[_0xefb6ac][_0x1a6be8(0x22e)];return _0x59e23b['log'][_0x1a6be8(0x194)](_0x1a6be8(0x207)+_0xefb6ac+'\x20->\x20'+(_0x29f94b[_0x1a6be8(0x206)]?'OK':'NO')+'\x20('+_0x29f94b['reason']+')'),_0x29f94b;}if(!canCallApi())return _0x59e23b[_0x1a6be8(0x1ac)][_0x1a6be8(0x194)](_0x1a6be8(0x20c)+_0xefb6ac+'\x20√ºbersprungen\x20(Auto-Approved).'),{'approved':!![],'reason':_0x1a6be8(0x1c9)};const _0xf46297=new Date()[_0x1a6be8(0x1ca)](),_0x46c60b=await getWeatherContext(_0x59e23b),_0x3f970b=PERSONA_MAPPING[_0x59e23b['config'][_0x1a6be8(0x1f4)]||_0x1a6be8(0x19f)],_0x2cc574=_0x1a6be8(0x1ee)+_0xf46297+_0x1a6be8(0x21a)+_0x46c60b+_0x1a6be8(0x1d5)+(_0xdd8bb6*0x64)[_0x1a6be8(0x1d4)](0x0)+_0x1a6be8(0x1e7)+_0xefb6ac+_0x1a6be8(0x1e1)+_0x53eeed+_0x1a6be8(0x1ed)+_0x3f970b+_0x1a6be8(0x227);try{updateApiTimestamp();const _0x28afd0=await _0x59e23b[_0x1a6be8(0x215)][_0x1a6be8(0x21e)](_0x2cc574),_0x5aab4f=_0x28afd0[_0x1a6be8(0x19a)][_0x1a6be8(0x1a7)]()[_0x1a6be8(0x1e4)](/```json|```/g,'')[_0x1a6be8(0x1ea)](),_0x5573a5=JSON[_0x1a6be8(0x1db)](_0x5aab4f);return decisionCache[_0xefb6ac]={'decision':_0x5573a5,'timestamp':_0x248944},_0x5573a5;}catch(_0x330a41){return _0x59e23b['log'][_0x1a6be8(0x1e5)](_0x1a6be8(0x1e0)+_0x330a41[_0x1a6be8(0x230)]),decisionCache[_0xefb6ac]={'decision':{'approved':!![],'reason':_0x1a6be8(0x229)},'timestamp':_0x248944-(CACHE_TTL_MS-0xea60)},{'approved':!![],'reason':_0x1a6be8(0x229)};}}async function runGeminiAnalysis(_0xa90e7f,_0x546d54=''){const _0x59b0cc=a0_0x40ca5f;if(!_0xa90e7f[_0x59b0cc(0x215)])return;if(!canCallApi()){_0xa90e7f[_0x59b0cc(0x1ac)]['debug'](_0x59b0cc(0x211));return;}if(_0xa90e7f[_0x59b0cc(0x20e)]['length']===0x0)return;const _0x43a5f4=_0xa90e7f[_0x59b0cc(0x20e)][_0x59b0cc(0x19c)](0x0,0xf),_0x204387=_0xa90e7f['currentSystemMode'],_0x3c3a16=PERSONA_MAPPING[_0xa90e7f[_0x59b0cc(0x1a0)][_0x59b0cc(0x1f4)]||_0x59b0cc(0x19f)],_0x226fe2=_0xa90e7f[_0x59b0cc(0x1a0)][_0x59b0cc(0x1b1)]||_0x59b0cc(0x218);let _0x703578=_0x59b0cc(0x1a5);try{const _0x3f3201=await _0xa90e7f['getStateAsync'](_0x59b0cc(0x1d1));if(_0x3f3201&&_0x3f3201[_0x59b0cc(0x1d6)])_0x703578=_0x3f3201[_0x59b0cc(0x1d6)];}catch(_0x3f1642){}let _0x4d85c7=![];try{const _0x4638be=await _0xa90e7f[_0x59b0cc(0x1b5)](_0x59b0cc(0x1aa));if(_0x4638be&&_0x4638be[_0x59b0cc(0x1d6)])_0x4d85c7=!![];}catch(_0x2d791c){}const _0x3beb0f=_0x59b0cc(0x1ab)+_0x3c3a16+'.\x20KONTEXT:\x20'+_0x226fe2+_0x59b0cc(0x22a)+_0x204387+_0x59b0cc(0x1e3)+_0x703578+_0x59b0cc(0x1c8)+JSON[_0x59b0cc(0x204)](_0x43a5f4)+_0x59b0cc(0x20f)+_0x546d54+_0x59b0cc(0x210);try{updateApiTimestamp();const _0x456f8d=await _0xa90e7f[_0x59b0cc(0x215)][_0x59b0cc(0x21e)](_0x3beb0f),_0x347b0a=JSON['parse'](_0x456f8d[_0x59b0cc(0x19a)][_0x59b0cc(0x1a7)]()[_0x59b0cc(0x1e4)](/```json|```/g,'')[_0x59b0cc(0x1ea)]());await _0xa90e7f[_0x59b0cc(0x221)](_0x59b0cc(0x1d2),{'val':JSON[_0x59b0cc(0x204)](_0x347b0a),'ack':!![]});if(_0x347b0a[_0x59b0cc(0x217)])await _0xa90e7f[_0x59b0cc(0x221)](_0x59b0cc(0x1d0),{'val':_0x347b0a[_0x59b0cc(0x217)],'ack':!![]});const _0x2b37a1={'timestamp':Date['now'](),'id':Date[_0x59b0cc(0x1a3)]()[_0x59b0cc(0x1e6)](),'analysis':{'activity':{'summary':_0x347b0a[_0x59b0cc(0x217)],'isAlert':_0x347b0a[_0x59b0cc(0x1d7)],'alertReason':_0x347b0a['alertReason']},'comfort':{'automationProposal':_0x347b0a[_0x59b0cc(0x1b9)]}}};_0xa90e7f[_0x59b0cc(0x1f9)][_0x59b0cc(0x1f3)](_0x2b37a1);if(_0xa90e7f[_0x59b0cc(0x1f9)][_0x59b0cc(0x1bd)]>0x32)_0xa90e7f[_0x59b0cc(0x1f9)]['pop']();await _0xa90e7f[_0x59b0cc(0x221)](_0x59b0cc(0x1dd),{'val':JSON['stringify'](_0xa90e7f[_0x59b0cc(0x1f9)]),'ack':!![]});const _0x390aca=_0x347b0a['isAlert']||![];_0x390aca!==_0xa90e7f['lastAlertState']&&(await _0xa90e7f[_0x59b0cc(0x221)](_0x59b0cc(0x1c3),{'val':_0x390aca,'ack':!![]}),_0xa90e7f[_0x59b0cc(0x1fc)]=_0x390aca,_0x390aca&&(await _0xa90e7f[_0x59b0cc(0x221)](_0x59b0cc(0x1f0),{'val':_0x347b0a[_0x59b0cc(0x19e)],'ack':!![]}),setup[_0x59b0cc(0x20a)](_0xa90e7f,'‚ö†Ô∏è\x20ALARM:\x20'+_0x347b0a[_0x59b0cc(0x19e)],![],_0x347b0a[_0x59b0cc(0x1c6)])));if(_0x347b0a[_0x59b0cc(0x1b9)]&&_0x347b0a[_0x59b0cc(0x1b9)][_0x59b0cc(0x198)]){await _0xa90e7f[_0x59b0cc(0x221)](_0x59b0cc(0x228),{'val':!![],'ack':!![]}),await _0xa90e7f[_0x59b0cc(0x221)](_0x59b0cc(0x1ba),{'val':_0x347b0a[_0x59b0cc(0x1b9)][_0x59b0cc(0x22d)],'ack':!![]}),await _0xa90e7f[_0x59b0cc(0x221)](_0x59b0cc(0x1b7),{'val':_0x347b0a[_0x59b0cc(0x1b9)][_0x59b0cc(0x1fb)],'ack':!![]}),await _0xa90e7f['setStateAsync'](_0x59b0cc(0x1f6),{'val':JSON[_0x59b0cc(0x204)](_0x347b0a[_0x59b0cc(0x1b9)]['targetValue']),'ack':!![]});if(_0x4d85c7)executeAutomationAction(_0xa90e7f);}}catch(_0x4f9e46){_0xa90e7f[_0x59b0cc(0x1ac)][_0x59b0cc(0x200)](_0x59b0cc(0x1f1)+_0x4f9e46[_0x59b0cc(0x230)]);}}async function createDailyDigest(_0x2b3bf2,_0x1181f9){const _0x4a2eff=a0_0x40ca5f;if(!_0x2b3bf2[_0x4a2eff(0x20d)])return;if(!canCallApi()){await _0x2b3bf2[_0x4a2eff(0x221)](LTM_DP_STATUS,{'val':_0x4a2eff(0x1af),'ack':!![]});return;}await _0x2b3bf2[_0x4a2eff(0x221)](LTM_DP_STATUS,{'val':_0x4a2eff(0x216),'ack':!![]});if(!_0x2b3bf2[_0x4a2eff(0x215)]||_0x2b3bf2[_0x4a2eff(0x1a1)][_0x4a2eff(0x1bd)]<LTM_MIN_EVENTS_FOR_COMPRESSION){await _0x2b3bf2[_0x4a2eff(0x221)](LTM_DP_STATUS,{'val':_0x4a2eff(0x195),'ack':!![]});return;}const _0x211202=JSON[_0x4a2eff(0x1db)](JSON[_0x4a2eff(0x204)](_0x2b3bf2[_0x4a2eff(0x1a1)])),_0x161541=_0x211202[_0x4a2eff(0x1bd)],_0x4eab7f='ROLLE:\x20Data\x20Compression\x20Agent.\x20SPRACHE:\x20DE.\x20FORMAT:\x20JSON.\x20ANWEISUNG:\x20Fasse\x20Sensor-Events\x20zusammen.\x20SCHEMA:\x20{\x20\x22summary\x22:\x20\x22string\x22,\x20\x22activityLevel\x22:\x20\x22string\x22\x20}\x20\x0a\x0aEVENTS:\x0a'+JSON[_0x4a2eff(0x204)](_0x211202);try{updateApiTimestamp();const _0x156553=await _0x2b3bf2[_0x4a2eff(0x215)]['generateContent'](_0x4eab7f),_0x391778=JSON[_0x4a2eff(0x1db)](_0x156553['response'][_0x4a2eff(0x1a7)]()[_0x4a2eff(0x1e4)](/```json|```/g,'')[_0x4a2eff(0x1ea)]()),_0xa6447e={'timestamp':new Date()['toISOString'](),'eventCount':_0x161541,'summary':_0x391778['summary']||'Digest','activityLevel':_0x391778['activityLevel']||'normal','systemMode':_0x2b3bf2[_0x4a2eff(0x21c)]};_0x2b3bf2[_0x4a2eff(0x225)]['push'](_0xa6447e);const _0x431986=_0x2b3bf2[_0x4a2eff(0x1a0)]['ltmLtbWindowDays']||0x3c;_0x2b3bf2[_0x4a2eff(0x225)]['length']>_0x431986&&_0x2b3bf2['dailyDigests']['splice'](0x0,_0x2b3bf2[_0x4a2eff(0x225)][_0x4a2eff(0x1bd)]-_0x431986);await _0x2b3bf2[_0x4a2eff(0x221)](LTM_DP_DAILY_DIGESTS,{'val':JSON[_0x4a2eff(0x204)](_0x2b3bf2[_0x4a2eff(0x225)]),'ack':!![]}),_0x2b3bf2[_0x4a2eff(0x1a1)]=[],await _0x2b3bf2[_0x4a2eff(0x221)](LTM_DP_RAW_LOG,{'val':JSON[_0x4a2eff(0x204)](_0x2b3bf2[_0x4a2eff(0x1a1)]),'ack':!![]}),await _0x2b3bf2[_0x4a2eff(0x221)](LTM_DP_STATUS,{'val':_0x4a2eff(0x202),'ack':!![]});const _0x44ae82=_0x4a2eff(0x22c)+_0x391778[_0x4a2eff(0x217)]+'\x0aAktivit√§t:\x20'+_0x391778[_0x4a2eff(0x1b2)];setup['sendNotification'](_0x2b3bf2,_0x44ae82,![],![]);if(_0x2b3bf2['isProVersion']&&_0x1181f9)_0x1181f9[_0x4a2eff(0x21b)](_0x2b3bf2,_0x4a2eff(0x205),{'digest':_0xa6447e});}catch(_0x58ab32){_0x2b3bf2[_0x4a2eff(0x1ac)][_0x4a2eff(0x200)](_0x58ab32[_0x4a2eff(0x230)]);}}async function runBaselineDriftAnalysis(_0x2ff250){const _0x57d78a=a0_0x40ca5f;if(!_0x2ff250[_0x57d78a(0x20d)]||!_0x2ff250['geminiModel'])return;if(!canCallApi())return;const _0x40a4da=_0x2ff250[_0x57d78a(0x1a0)][_0x57d78a(0x201)]||0xe;if(_0x2ff250[_0x57d78a(0x225)][_0x57d78a(0x1bd)]<_0x40a4da+0x7){await _0x2ff250[_0x57d78a(0x221)]('LTM.driftAnalysis.baselineDrift',{'val':_0x57d78a(0x1f2),'ack':!![]});return;}const _0x27c2df=_0x2ff250['dailyDigests'][_0x57d78a(0x19c)](-_0x40a4da),_0x2c2c0c=_0x2ff250[_0x57d78a(0x225)]['slice'](0x0,_0x2ff250[_0x57d78a(0x225)][_0x57d78a(0x1bd)]-_0x40a4da),_0x3f90b0='ROLLE:\x20Data\x20Scientist.\x20ZIEL:\x20Drift\x20erkennen.\x20SCHEMA:\x20{\x20\x22baselineDrift\x22:\x20\x22none|slight|significant|critical\x22,\x20\x22driftDetails\x22:\x20\x22string\x22\x20}\x0a\x0aLTB:\x20'+JSON[_0x57d78a(0x204)](_0x2c2c0c)+_0x57d78a(0x220)+JSON['stringify'](_0x27c2df);try{updateApiTimestamp();const _0x3253e9=await _0x2ff250[_0x57d78a(0x215)][_0x57d78a(0x21e)](_0x3f90b0),_0x597eec=JSON['parse'](_0x3253e9['response'][_0x57d78a(0x1a7)]()[_0x57d78a(0x1e4)](/```json|```/g,'')[_0x57d78a(0x1ea)]());_0x597eec['baselineDrift']&&(await _0x2ff250[_0x57d78a(0x221)](_0x57d78a(0x1e8),{'val':_0x597eec[_0x57d78a(0x209)],'ack':!![]}),await _0x2ff250[_0x57d78a(0x221)](_0x57d78a(0x1c0),{'val':_0x597eec[_0x57d78a(0x1b4)],'ack':!![]}),await _0x2ff250['setStateAsync'](_0x57d78a(0x20b),{'val':Date[_0x57d78a(0x1a3)](),'ack':!![]}));}catch(_0x53560b){}}async function executeAutomationAction(_0x2e09a4){const _0x643319=a0_0x40ca5f;try{const _0x122dda=await _0x2e09a4[_0x643319(0x1b5)](_0x643319(0x1b7)),_0x194abe=await _0x2e09a4[_0x643319(0x1b5)]('analysis.automation.targetValue');if(_0x122dda&&_0x122dda[_0x643319(0x1d6)]&&_0x194abe){const _0x5ea296=_0x122dda[_0x643319(0x1d6)];let _0x510265=_0x194abe[_0x643319(0x1d6)];try{_0x510265=JSON['parse'](_0x510265);}catch(_0x2d4822){}_0x2e09a4['log'][_0x643319(0x222)](_0x643319(0x1cd)+_0x5ea296+_0x643319(0x1e9)+_0x510265),await _0x2e09a4['setForeignStateAsync'](_0x5ea296,_0x510265);}else _0x2e09a4[_0x643319(0x1ac)]['warn'](_0x643319(0x1d9));}catch(_0x1f3c77){_0x2e09a4['log'][_0x643319(0x200)](_0x643319(0x1b0)+_0x1f3c77[_0x643319(0x230)]);}}async function sendMorningBriefing(_0xc5e58f){const _0x268698=a0_0x40ca5f;if(!_0xc5e58f['geminiModel']){_0xc5e58f[_0x268698(0x1ac)][_0x268698(0x1e5)](_0x268698(0x1dc));return;}_0xc5e58f['log'][_0x268698(0x222)]('üåÖ\x20Starting\x20Morning\x20Briefing\x20sequence\x20(Traffic\x20Check\x20bypassed)...');try{updateApiTimestamp();const _0x45b581=_0x268698(0x19d),_0x4f6b4b=await _0xc5e58f[_0x268698(0x215)]['generateContent'](_0x45b581),_0x5c8fcc=_0x4f6b4b['response']['text']();_0xc5e58f[_0x268698(0x1ac)][_0x268698(0x222)](_0x268698(0x1bc)+_0x5c8fcc[_0x268698(0x1bd)]+').\x20Sending\x20notification...'),setup[_0x268698(0x20a)](_0xc5e58f,'üåÖ\x20Morning\x20Briefing:\x0a'+_0x5c8fcc);}catch(_0x13d1d8){_0xc5e58f[_0x268698(0x1ac)][_0x268698(0x200)](_0x268698(0x1ae)+_0x13d1d8[_0x268698(0x230)]);}}function a0_0x1d28(){const _0xa6def3=['getTime','(((.+)+)+)+$','ü§ñ\x20BUTLER:\x20Executing\x20Action\x20->\x20','Sicherheit\x20geht\x20vor.','constructor','analysis.activitySummary','system.presenceWho','analysis.lastResult','1944684VCpyIL','toFixed','.\x0a\x20\x20\x20\x20EVENT:\x20Bewohner\x20geht\x20wahrscheinlich\x20(','val','isAlert','58380LWTAWk','ü§ñ\x20BUTLER:\x20No\x20valid\x20target\x20ID\x20or\x20value\x20stored\x20for\x20execution.','map','parse','ü§ñ\x20Morning\x20Briefing\x20skipped:\x20No\x20Gemini\x20Model.','analysis.analysisHistory','LTM.rawEventLog',',\x20Lichtverh√§ltnisse:\x20','ü§ñ\x20Butler\x20Brain\x20Error:\x20','\x22.\x0a\x20\x20\x20\x20AKTION:\x20Schalte\x20\x22','weatherInstance','.\x20ANWESEND:\x20','replace','warn','toString','%)\x20nach\x20\x22','LTM.driftAnalysis.baselineDrift','\x20=\x20','trim','filter','setHours','\x22\x20AN.\x0a\x20\x20\x20\x20STRATEGIE:\x20','\x0a\x20\x20\x20\x20ROLLE:\x20Haus-Butler.\x0a\x20\x20\x20\x20SITUATION:\x20','Fokus\x20auf\x20Komfort\x20f√ºr\x20die\x20Familie.','analysis.alertReason','Gemini\x20Error:\x20','N/A\x20(Learning)','unshift','aiPersona','LTM.processingStatus','analysis.automation.targetValue','useWeather',')\x20generated.','analysisHistory','.forecast.current.state','targetId','lastAlertState','LTM.dailyDigests','analysis.health.geminiDay','Health\x20Report\x20Error:\x20','error','ltmStbWindowDays','Success','\x0a\x20\x20\x20\x20ROLLE:\x20Medizinischer\x20Assistent\x20f√ºr\x20AAL\x20(Ambient\x20Assisted\x20Living).\x0a\x20\x20\x20\x20AUFGABE:\x20','stringify','ANALYZE_HEALTH','approved','ü§ñ\x20Butler\x20Cache\x20Hit:\x20','ü§ñ\x20API\x20Cooldown.\x20Waiting\x202s...','baselineDrift','sendNotification','LTM.driftAnalysis.lastCheck','ü§ñ\x20Traffic\x20Schutz:\x20Anfrage\x20f√ºr\x20','isProVersion','eventHistory','.\x20EMERGENCY:\x20','.\x20AUFGABE:\x201.\x20Gesundheit?\x202.\x20Komfort?\x20FORMAT\x20(JSON):\x20{\x20\x22isAlert\x22:\x20boolean,\x20\x22alertReason\x22:\x20\x22string\x22,\x20\x22isEmergency\x22:\x20boolean,\x20\x22summary\x22:\x20\x22string\x22,\x20\x22automationProposal\x22:\x20{\x20\x22detected\x22:\x20boolean,\x20\x22description\x22:\x20\x22string\x22,\x20\x22targetId\x22:\x20\x22string\x22,\x20\x22targetValue\x22:\x20\x22any\x22\x20}\x20}','ü§ñ\x20Autopilot\x20skipped\x20(Traffic\x20Protection\x20active).','Maximaler\x20Komfort,\x20Energie\x20ist\x20zweitrangig.','Nacht','getForeignStateAsync','geminiModel','Started...','summary','Keine\x20Details.','value',',\x20Wetter:\x20','send','currentSystemMode','Tag','generateContent','Entscheide\x20ausgewogen\x20zwischen\x20Komfort\x20und\x20Energie.','\x0aSTB:\x20','setStateAsync','info','Analysiere\x20diese\x20Events\x20des\x20TAGES\x20(08:00-Jetzt).\x20Aktivit√§t?\x20Mahlzeiten?\x20Haust√ºr?\x20Antwort\x20kurz\x20f√ºr\x20den\x20besorgten\x20Sohn\x20(max\x202\x20S√§tze).','3oTTNoz','dailyDigests','NIGHT','\x0a\x20\x20\x20\x20FRAGE:\x20Ist\x20es\x20dunkel\x20genug\x20f√ºr\x20Licht?\x0a\x20\x20\x20\x20FORMAT:\x20{\x20\x22approved\x22:\x20boolean,\x20\x22reason\x22:\x20\x22kurzer\x20Grund\x22\x20}\x0a\x20\x20\x20\x20','analysis.automation.patternDetected','KI-Fehler\x20(Fallback)','.\x20SYSTEM_MODE:\x20','8762510PFUfqo','üìÖ\x20Daily\x20Digest:\x0a','description','decision','7523ORezUr','message','Analysiere\x20diese\x20Events\x20der\x20NACHT\x20(22:00-08:00).\x20War\x20der\x20Schlaf\x20ruhig?\x20Gab\x20es\x20Badg√§nge?\x20Antwort\x20kurz\x20f√ºr\x20den\x20besorgten\x20Sohn\x20(max\x202\x20S√§tze).','debug','Skipped\x20(No\x20AI\x20or\x20Data)','105BCBHKX','analysis.health.geminiNight','detected','timestamp','response','PRIORIT√ÑT:\x20Energie\x20sparen.\x20Schalte\x20nur,\x20wenn\x20absolut\x20notwendig\x20(Dunkelheit).','slice','Erstelle\x20ein\x20kurzes\x20\x27Guten\x20Morgen\x27\x20Briefing\x20basierend\x20auf\x20den\x20Events\x20der\x20letzten\x20Nacht.','alertReason','generic','config','rawEventLog','.Current.IsNight','now','1586205PnPeYE','Unbekannt','.Current.WeatherText','text','.forecast.current.temperature','search','analysis.automation.autoApply','ROLLE:\x20KI-Hausverwalter.\x20PERSONA:\x20','log','setDate','Briefing\x20Error:\x20','Skipped\x20(Traffic)','BUTLER\x20Execution\x20Error:\x20','livingContext','activityLevel','KI\x20offline\x20(Fallback)','driftDetails','getStateAsync','ü§ñ\x20Health\x20Report\x20(','analysis.automation.targetId','1373364rsJIpj','automationProposal','analysis.automation.description','\x0a\x20\x20\x20\x20ANTWORT-STIL:\x20Sachlich,\x20beruhigend,\x20pr√§zise.\x20Keine\x20Floskeln.\x0a\x20\x20\x20\x20','üåÖ\x20Briefing\x20generated\x20(Length:\x20','length','86hwquUS','2-digit','LTM.driftAnalysis.driftDetails','getDate','Keine\x20Daten\x20f√ºr\x20die\x20Nacht\x20aufgezeichnet\x20(Sensoren\x20ruhig).','analysis.isAlert','@google/generative-ai','.Current.Temperature','isEmergency','96928efONnd','.\x20EVENTS:\x20','Traffic-Schutz\x20(Auto-Approved)','toLocaleTimeString'];a0_0x1d28=function(){return _0xa6def3;};return a0_0x1d28();}async function generateHealthReport(_0x971ed7,_0x1119b1){const _0x50644c=a0_0x40ca5f;if(!_0x971ed7[_0x50644c(0x215)])return;const _0x287883=Date[_0x50644c(0x1a3)]();_0x287883-lastGlobalApiCall<0xbb8&&(_0x971ed7[_0x50644c(0x1ac)][_0x50644c(0x194)](_0x50644c(0x208)),await new Promise(_0x1fb51a=>setTimeout(_0x1fb51a,0x7d0)));const _0x379468=new Date();let _0x3f093a=0x0,_0x11ef1d=_0x379468[_0x50644c(0x1cb)](),_0x28c375='';if(_0x1119b1===_0x50644c(0x226)){const _0x38657f=new Date(_0x379468);_0x38657f[_0x50644c(0x1ad)](_0x38657f[_0x50644c(0x1c1)]()-0x1),_0x38657f[_0x50644c(0x1ec)](0x16,0x0,0x0,0x0),_0x3f093a=_0x38657f['getTime']();const _0x5bd595=new Date(_0x379468);_0x5bd595[_0x50644c(0x1ec)](0x8,0x0,0x0,0x0),_0x11ef1d=_0x5bd595['getTime'](),_0x28c375=_0x50644c(0x231);}else{const _0x571e3a=new Date(_0x379468);_0x571e3a[_0x50644c(0x1ec)](0x8,0x0,0x0,0x0),_0x3f093a=_0x571e3a[_0x50644c(0x1cb)](),_0x28c375=_0x50644c(0x223);}const _0x47bfe1=_0x971ed7['eventHistory'][_0x50644c(0x1eb)](_0x473a72=>_0x473a72[_0x50644c(0x199)]>=_0x3f093a&&_0x473a72['timestamp']<=_0x11ef1d);if(_0x47bfe1[_0x50644c(0x1bd)]===0x0){const _0x289aa4=_0x1119b1===_0x50644c(0x226)?_0x50644c(0x1c2):'Bisher\x20keine\x20Aktivit√§t\x20seit\x2008:00\x20Uhr\x20verzeichnet.',_0x3fe0bc=_0x1119b1===_0x50644c(0x226)?_0x50644c(0x197):_0x50644c(0x1fe);await _0x971ed7['setStateAsync'](_0x3fe0bc,{'val':_0x289aa4,'ack':!![]});return;}const _0x3cb4b7=_0x47bfe1[_0x50644c(0x1da)](_0xafcd70=>new Date(_0xafcd70[_0x50644c(0x199)])[_0x50644c(0x1ca)]([],{'hour':_0x50644c(0x1bf),'minute':_0x50644c(0x1bf)})+'\x20'+_0xafcd70['name']+'\x20('+_0xafcd70[_0x50644c(0x219)]+')')['join']('\x0a'),_0x2c0f88=_0x50644c(0x203)+_0x28c375+'\x0a\x20\x20\x20\x20EVENTS:\x0a'+_0x3cb4b7+_0x50644c(0x1bb);try{updateApiTimestamp();const _0x5d44a8=await _0x971ed7['geminiModel']['generateContent'](_0x2c0f88),_0x43524a=_0x5d44a8[_0x50644c(0x19a)]['text'](),_0x22520e=_0x1119b1===_0x50644c(0x226)?_0x50644c(0x197):_0x50644c(0x1fe);await _0x971ed7[_0x50644c(0x221)](_0x22520e,{'val':_0x43524a,'ack':!![]}),_0x971ed7['log']['info'](_0x50644c(0x1b6)+_0x1119b1+_0x50644c(0x1f8));}catch(_0x2795e7){_0x971ed7[_0x50644c(0x1ac)]['error'](_0x50644c(0x1ff)+_0x2795e7[_0x50644c(0x230)]);}}module['exports']={'executeAutomationAction':executeAutomationAction,'createDailyDigest':createDailyDigest,'runBaselineDriftAnalysis':runBaselineDriftAnalysis,'sendMorningBriefing':sendMorningBriefing,'runGeminiAnalysis':runGeminiAnalysis,'consultButler':consultButler,'generateHealthReport':generateHealthReport};