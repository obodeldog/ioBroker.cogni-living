const a0_0x4cac99=a0_0x339b;(function(_0x38db93,_0x11d469){const _0x4ed4ff=a0_0x339b,_0x42d563=_0x38db93();while(!![]){try{const _0x328925=-parseInt(_0x4ed4ff(0x120))/0x1+parseInt(_0x4ed4ff(0xf9))/0x2*(parseInt(_0x4ed4ff(0xbf))/0x3)+parseInt(_0x4ed4ff(0xf4))/0x4*(-parseInt(_0x4ed4ff(0x14b))/0x5)+parseInt(_0x4ed4ff(0xda))/0x6*(-parseInt(_0x4ed4ff(0x13e))/0x7)+-parseInt(_0x4ed4ff(0xb8))/0x8*(-parseInt(_0x4ed4ff(0xbd))/0x9)+parseInt(_0x4ed4ff(0xc4))/0xa*(parseInt(_0x4ed4ff(0xd2))/0xb)+parseInt(_0x4ed4ff(0xd3))/0xc*(-parseInt(_0x4ed4ff(0xe6))/0xd);if(_0x328925===_0x11d469)break;else _0x42d563['push'](_0x42d563['shift']());}catch(_0x597ce7){_0x42d563['push'](_0x42d563['shift']());}}}(a0_0x31c6,0x5596c));const a0_0x229ce5=(function(){let _0x4241dd=!![];return function(_0x4454b3,_0x2371b9){const _0x37cb8b=_0x4241dd?function(){const _0x47365c=a0_0x339b;if(_0x2371b9){const _0x3b766d=_0x2371b9[_0x47365c(0xb7)](_0x4454b3,arguments);return _0x2371b9=null,_0x3b766d;}}:function(){};return _0x4241dd=![],_0x37cb8b;};}()),a0_0x5221fa=a0_0x229ce5(this,function(){const _0x1d3f85=a0_0x339b;return a0_0x5221fa[_0x1d3f85(0x136)]()[_0x1d3f85(0xe4)](_0x1d3f85(0xe7))[_0x1d3f85(0x136)]()[_0x1d3f85(0x10c)](a0_0x5221fa)['search'](_0x1d3f85(0xe7));});function a0_0x31c6(){const _0x35cd54=['.\x20KONTEXT:\x20','LTM.processingStatus','response','Nacht','Analysiere\x20diese\x20Events\x20des\x20TAGES\x20(08:00-Jetzt).\x20AktivitÃ¤t?\x20Mahlzeiten?\x20HaustÃ¼r?\x20Antwort\x20kurz\x20fÃ¼r\x20den\x20besorgten\x20Sohn\x20(max\x202\x20SÃ¤tze).','.\x20SYSTEM_MODE:\x20','summary','analysis.automation.autoApply','11QSaRKZ','144dKMHFZ','2-digit','debug','getForeignStateAsync','ðŸŒ…\x20Morning\x20Briefing:\x0a','replace','âš ï¸\x20ALARM:\x20','18LXznkJ','Fokus\x20auf\x20Komfort\x20fÃ¼r\x20die\x20Familie.','Skipped\x20(Traffic)','\x20=\x20','\x0aAktivitÃ¤t:\x20','join','Traffic-Schutz\x20(Auto-Approved)',',\x20LichtverhÃ¤ltnisse:\x20','map','LTM.dailyDigests','search','KI\x20offline\x20(Fallback)','164801LcSFbP','(((.+)+)+)+$','slice','weatherInstance','%)\x20nach\x20\x22','PRIORITÃ„T:\x20Sicherheit\x20und\x20Licht.\x20Schalte\x20lieber\x20einmal\x20zu\x20viel\x20als\x20zu\x20wenig.','.\x20EMERGENCY:\x20','Unbekannt','\x0a\x20\x20\x20\x20ROLLE:\x20Haus-Butler.\x0a\x20\x20\x20\x20SITUATION:\x20','analysis.automation.targetValue','isAlert','log','automationProposal','generateContent','92ziOlnn','rawEventLog','analysis.activitySummary','getDate','setStateAsync','5588ckeOjs','\x0aSTB:\x20','unshift','reason','analysis.health.geminiNight','Â°C,\x20','ðŸ¤–\x20API\x20Cooldown.\x20Waiting\x202s...','toLocaleTimeString','analysis.alertReason','analysisHistory','analysis.analysisHistory','ROLLE:\x20KI-Hausverwalter.\x20PERSONA:\x20','\x0a\x20\x20\x20\x20EVENTS:\x0a','approved','now','analysis.isAlert','PRIORITÃ„T:\x20Energie\x20sparen.\x20Schalte\x20nur,\x20wenn\x20absolut\x20notwendig\x20(Dunkelheit).','warn','config','constructor','ðŸ¤–\x20Butler\x20Brain\x20Error:\x20','\x0a\x20\x20\x20\x20FRAGE:\x20Ist\x20es\x20dunkel\x20genug\x20fÃ¼r\x20Licht?\x0a\x20\x20\x20\x20FORMAT:\x20{\x20\x22approved\x22:\x20boolean,\x20\x22reason\x22:\x20\x22kurzer\x20Grund\x22\x20}\x0a\x20\x20\x20\x20','eventHistory','ðŸ¤–\x20Morning\x20Briefing\x20skipped:\x20No\x20Gemini\x20Model.','models/gemini-flash-latest','analysis.health.geminiDay','normal','N/A\x20(Learning)','Skipped\x20(No\x20AI\x20or\x20Data)','analysis.lastResult','ROLLE:\x20Data\x20Scientist.\x20ZIEL:\x20Drift\x20erkennen.\x20SCHEMA:\x20{\x20\x22baselineDrift\x22:\x20\x22none|slight|significant|critical\x22,\x20\x22driftDetails\x22:\x20\x22string\x22\x20}\x0a\x0aLTB:\x20','ðŸŒ…\x20Briefing\x20generated\x20(Length:\x20','.forecast.current.state','setDate','\x20Ã¼bersprungen\x20(Auto-Approved).','length','LTM.driftAnalysis.baselineDrift','Briefing\x20Error:\x20','ROLLE:\x20Data\x20Compression\x20Agent.\x20SPRACHE:\x20DE.\x20FORMAT:\x20JSON.\x20ANWEISUNG:\x20Fasse\x20Sensor-Events\x20zusammen.\x20SCHEMA:\x20{\x20\x22summary\x22:\x20\x22string\x22,\x20\x22activityLevel\x22:\x20\x22string\x22\x20}\x20\x0a\x0aEVENTS:\x0a','287630jDhShi','Sicherheit\x20geht\x20vor.',')\x20generated.','.\x0a\x20\x20\x20\x20EVENT:\x20Bewohner\x20geht\x20wahrscheinlich\x20(','Analysiere\x20diese\x20Events\x20der\x20NACHT\x20(22:00-08:00).\x20War\x20der\x20Schlaf\x20ruhig?\x20Gab\x20es\x20BadgÃ¤nge?\x20Antwort\x20kurz\x20fÃ¼r\x20den\x20besorgten\x20Sohn\x20(max\x202\x20SÃ¤tze).','driftDetails','dailyDigests','generic','trim','getStateAsync','parse','.\x20ANWESEND:\x20','Digest','\x0a\x20\x20\x20\x20ANTWORT-STIL:\x20Sachlich,\x20beruhigend,\x20prÃ¤zise.\x20Keine\x20Floskeln.\x0a\x20\x20\x20\x20','Tag','Entscheide\x20ausgewogen\x20zwischen\x20Komfort\x20und\x20Energie.','ðŸ¤–\x20Butler\x20Cache\x20Hit:\x20','ðŸŒ…\x20Starting\x20Morning\x20Briefing\x20sequence\x20(Traffic\x20Check\x20bypassed)...','toFixed','LTM.driftAnalysis.driftDetails','.\x20AUFGABE:\x201.\x20Gesundheit?\x202.\x20Komfort?\x20FORMAT\x20(JSON):\x20{\x20\x22isAlert\x22:\x20boolean,\x20\x22alertReason\x22:\x20\x22string\x22,\x20\x22isEmergency\x22:\x20boolean,\x20\x22summary\x22:\x20\x22string\x22,\x20\x22automationProposal\x22:\x20{\x20\x22detected\x22:\x20boolean,\x20\x22description\x22:\x20\x22string\x22,\x20\x22targetId\x22:\x20\x22string\x22,\x20\x22targetValue\x22:\x20\x22any\x22\x20}\x20}','timestamp','toString','Success','./setup','aiPersona','\x22\x20AN.\x0a\x20\x20\x20\x20STRATEGIE:\x20','ðŸ¤–\x20Autopilot\x20skipped\x20(Traffic\x20Protection\x20active).','Maximaler\x20Komfort,\x20Energie\x20ist\x20zweitrangig.','Started...','653611JXtJco',',\x20Wetter:\x20','analysis.automation.description','text','decision','system.presenceWho','stringify','activityLevel','livingContext','message','isProVersion','Bisher\x20keine\x20AktivitÃ¤t\x20seit\x2008:00\x20Uhr\x20verzeichnet.','geminiModel','61025tDbGuR','ANALYZE_HEALTH','val','setHours','Keine\x20Details.','sendNotification','NIGHT','lastAlertState','\x20->\x20','baselineDrift','name','targetId','getTime','.forecast.current.temperature','\x22.\x0a\x20\x20\x20\x20AKTION:\x20Schalte\x20\x22','apply','8HKnOmT','value','Unbekannt\x20(Kein\x20Sensor)','useWeather','.Current.Temperature','4956237vPvAjw','targetValue','615SuwwWR','analysis.automation.targetId','@google/generative-ai','send','Keine\x20Daten\x20fÃ¼r\x20die\x20Nacht\x20aufgezeichnet\x20(Sensoren\x20ruhig).','2276970opUlqe','ðŸ¤–\x20Traffic\x20Schutz:\x20Anfrage\x20fÃ¼r\x20','info','Wetterdaten\x20nicht\x20abrufbar','error','.\x20EVENTS:\x20'];a0_0x31c6=function(){return _0x35cd54;};return a0_0x31c6();}function a0_0x339b(_0x47aa98,_0x2ada00){const _0x51dbac=a0_0x31c6();return a0_0x339b=function(_0x5221fa,_0x229ce5){_0x5221fa=_0x5221fa-0xb0;let _0x31c615=_0x51dbac[_0x5221fa];return _0x31c615;},a0_0x339b(_0x47aa98,_0x2ada00);}a0_0x5221fa();'use strict';const {GoogleGenerativeAI}=require(a0_0x4cac99(0xc1)),setup=require(a0_0x4cac99(0x138)),GEMINI_MODEL=a0_0x4cac99(0x111),LTM_DP_DAILY_DIGESTS=a0_0x4cac99(0xe3),LTM_DP_STATUS=a0_0x4cac99(0xcb),LTM_DP_RAW_LOG='LTM.rawEventLog',LTM_MIN_EVENTS_FOR_COMPRESSION=0x5,MIN_API_GAP_MS=0x4e20;let lastGlobalApiCall=0x0;const decisionCache={},CACHE_TTL_MS=0xf*0x3c*0x3e8,PERSONA_MAPPING={'generic':a0_0x4cac99(0x12f),'senior_aal':a0_0x4cac99(0xeb),'family':a0_0x4cac99(0xdb),'single_comfort':a0_0x4cac99(0x13c),'security':a0_0x4cac99(0x121),'energy_saver':a0_0x4cac99(0x109)};function canCallApi(){const _0x39c410=a0_0x4cac99,_0x4d13b7=Date[_0x39c410(0x107)]();return _0x4d13b7-lastGlobalApiCall>MIN_API_GAP_MS;}function updateApiTimestamp(){lastGlobalApiCall=Date['now']();}async function getWeatherContext(_0x150024){const _0x48381a=a0_0x4cac99;if(!_0x150024[_0x48381a(0x10b)][_0x48381a(0xbb)]||!_0x150024[_0x48381a(0x10b)][_0x48381a(0xe9)])return _0x48381a(0xba);try{const _0x538528=_0x150024[_0x48381a(0x10b)]['weatherInstance'];let _0x50e4eb=await _0x150024[_0x48381a(0xd6)](_0x538528+_0x48381a(0xbc));if(!_0x50e4eb)_0x50e4eb=await _0x150024[_0x48381a(0xd6)](_0x538528+_0x48381a(0xb5));let _0x117478=await _0x150024[_0x48381a(0xd6)](_0x538528+'.Current.WeatherText');if(!_0x117478)_0x117478=await _0x150024[_0x48381a(0xd6)](_0x538528+_0x48381a(0x119));let _0x3198cb=_0x48381a(0xed);const _0x1b831b=await _0x150024[_0x48381a(0xd6)](_0x538528+'.Current.IsNight');if(_0x1b831b)_0x3198cb=_0x1b831b[_0x48381a(0x14d)]?_0x48381a(0xcd):_0x48381a(0x12e);if(_0x50e4eb&&_0x117478)return _0x50e4eb[_0x48381a(0x14d)]+_0x48381a(0xfe)+_0x117478[_0x48381a(0x14d)]+_0x48381a(0xe1)+_0x3198cb;}catch(_0x538e59){}return _0x48381a(0xc7);}async function consultButler(_0x1bfd24,_0x28bbc5,_0x2d43f1,_0x1d581a){const _0x49d433=a0_0x4cac99;if(!_0x1bfd24[_0x49d433(0x14a)])return{'approved':!![],'reason':_0x49d433(0xe5)};const _0x327ce0=Date[_0x49d433(0x107)]();if(decisionCache[_0x28bbc5]&&_0x327ce0-decisionCache[_0x28bbc5][_0x49d433(0x135)]<CACHE_TTL_MS){const _0x246e09=decisionCache[_0x28bbc5][_0x49d433(0x142)];return _0x1bfd24[_0x49d433(0xf1)]['debug'](_0x49d433(0x130)+_0x28bbc5+_0x49d433(0xb0)+(_0x246e09[_0x49d433(0x106)]?'OK':'NO')+'\x20('+_0x246e09[_0x49d433(0xfc)]+')'),_0x246e09;}if(!canCallApi())return _0x1bfd24[_0x49d433(0xf1)]['debug'](_0x49d433(0xc5)+_0x28bbc5+_0x49d433(0x11b)),{'approved':!![],'reason':_0x49d433(0xe0)};const _0x117f56=new Date()['toLocaleTimeString'](),_0x5afca3=await getWeatherContext(_0x1bfd24),_0x5f1f76=PERSONA_MAPPING[_0x1bfd24['config']['aiPersona']||_0x49d433(0x127)],_0x2d60e6=_0x49d433(0xee)+_0x117f56+_0x49d433(0x13f)+_0x5afca3+_0x49d433(0x123)+(_0x1d581a*0x64)[_0x49d433(0x132)](0x0)+_0x49d433(0xea)+_0x28bbc5+_0x49d433(0xb6)+_0x2d43f1+_0x49d433(0x13a)+_0x5f1f76+_0x49d433(0x10e);try{updateApiTimestamp();const _0x5aa9d8=await _0x1bfd24[_0x49d433(0x14a)][_0x49d433(0xf3)](_0x2d60e6),_0x86eda4=_0x5aa9d8[_0x49d433(0xcc)][_0x49d433(0x141)]()[_0x49d433(0xd8)](/```json|```/g,'')[_0x49d433(0x128)](),_0x5c62d0=JSON[_0x49d433(0x12a)](_0x86eda4);return decisionCache[_0x28bbc5]={'decision':_0x5c62d0,'timestamp':_0x327ce0},_0x5c62d0;}catch(_0x1c658c){return _0x1bfd24[_0x49d433(0xf1)][_0x49d433(0x10a)](_0x49d433(0x10d)+_0x1c658c['message']),decisionCache[_0x28bbc5]={'decision':{'approved':!![],'reason':'KI-Fehler\x20(Fallback)'},'timestamp':_0x327ce0-(CACHE_TTL_MS-0xea60)},{'approved':!![],'reason':'KI-Fehler\x20(Fallback)'};}}async function runGeminiAnalysis(_0x52da17,_0x400ac6=''){const _0xcc2fc3=a0_0x4cac99;if(!_0x52da17[_0xcc2fc3(0x14a)])return;if(!canCallApi()){_0x52da17[_0xcc2fc3(0xf1)][_0xcc2fc3(0xd5)](_0xcc2fc3(0x13b));return;}if(_0x52da17[_0xcc2fc3(0x10f)]['length']===0x0)return;const _0x481caa=_0x52da17[_0xcc2fc3(0x10f)][_0xcc2fc3(0xe8)](0x0,0xf),_0x2ad90f=_0x52da17['currentSystemMode'],_0x35ebea=PERSONA_MAPPING[_0x52da17[_0xcc2fc3(0x10b)][_0xcc2fc3(0x139)]||_0xcc2fc3(0x127)],_0x4d6461=_0x52da17[_0xcc2fc3(0x10b)][_0xcc2fc3(0x146)]||_0xcc2fc3(0x14f);let _0x4cd74a=_0xcc2fc3(0xed);try{const _0x442585=await _0x52da17['getStateAsync'](_0xcc2fc3(0x143));if(_0x442585&&_0x442585[_0xcc2fc3(0x14d)])_0x4cd74a=_0x442585['val'];}catch(_0x5bbf30){}let _0x189c28=![];try{const _0x10f0eb=await _0x52da17['getStateAsync'](_0xcc2fc3(0xd1));if(_0x10f0eb&&_0x10f0eb[_0xcc2fc3(0x14d)])_0x189c28=!![];}catch(_0x12b813){}const _0x5a3017=_0xcc2fc3(0x104)+_0x35ebea+_0xcc2fc3(0xca)+_0x4d6461+_0xcc2fc3(0xcf)+_0x2ad90f+_0xcc2fc3(0x12b)+_0x4cd74a+_0xcc2fc3(0xc9)+JSON[_0xcc2fc3(0x144)](_0x481caa)+_0xcc2fc3(0xec)+_0x400ac6+_0xcc2fc3(0x134);try{updateApiTimestamp();const _0xbb7c1d=await _0x52da17['geminiModel']['generateContent'](_0x5a3017),_0x36455d=JSON[_0xcc2fc3(0x12a)](_0xbb7c1d[_0xcc2fc3(0xcc)][_0xcc2fc3(0x141)]()[_0xcc2fc3(0xd8)](/```json|```/g,'')[_0xcc2fc3(0x128)]());await _0x52da17[_0xcc2fc3(0xf8)](_0xcc2fc3(0x116),{'val':JSON[_0xcc2fc3(0x144)](_0x36455d),'ack':!![]});if(_0x36455d[_0xcc2fc3(0xd0)])await _0x52da17[_0xcc2fc3(0xf8)](_0xcc2fc3(0xf6),{'val':_0x36455d[_0xcc2fc3(0xd0)],'ack':!![]});const _0x350d5c={'timestamp':Date['now'](),'id':Date[_0xcc2fc3(0x107)]()[_0xcc2fc3(0x136)](),'analysis':{'activity':{'summary':_0x36455d['summary'],'isAlert':_0x36455d[_0xcc2fc3(0xf0)],'alertReason':_0x36455d['alertReason']},'comfort':{'automationProposal':_0x36455d[_0xcc2fc3(0xf2)]}}};_0x52da17[_0xcc2fc3(0x102)][_0xcc2fc3(0xfb)](_0x350d5c);if(_0x52da17[_0xcc2fc3(0x102)]['length']>0x32)_0x52da17['analysisHistory']['pop']();await _0x52da17[_0xcc2fc3(0xf8)](_0xcc2fc3(0x103),{'val':JSON[_0xcc2fc3(0x144)](_0x52da17[_0xcc2fc3(0x102)]),'ack':!![]});const _0x59680f=_0x36455d[_0xcc2fc3(0xf0)]||![];_0x59680f!==_0x52da17[_0xcc2fc3(0x152)]&&(await _0x52da17[_0xcc2fc3(0xf8)](_0xcc2fc3(0x108),{'val':_0x59680f,'ack':!![]}),_0x52da17['lastAlertState']=_0x59680f,_0x59680f&&(await _0x52da17[_0xcc2fc3(0xf8)](_0xcc2fc3(0x101),{'val':_0x36455d['alertReason'],'ack':!![]}),setup[_0xcc2fc3(0x150)](_0x52da17,_0xcc2fc3(0xd9)+_0x36455d['alertReason'],![],_0x36455d['isEmergency'])));if(_0x36455d[_0xcc2fc3(0xf2)]&&_0x36455d[_0xcc2fc3(0xf2)]['detected']){await _0x52da17[_0xcc2fc3(0xf8)]('analysis.automation.patternDetected',{'val':!![],'ack':!![]}),await _0x52da17[_0xcc2fc3(0xf8)](_0xcc2fc3(0x140),{'val':_0x36455d[_0xcc2fc3(0xf2)]['description'],'ack':!![]}),await _0x52da17['setStateAsync']('analysis.automation.targetId',{'val':_0x36455d['automationProposal'][_0xcc2fc3(0xb3)],'ack':!![]}),await _0x52da17[_0xcc2fc3(0xf8)](_0xcc2fc3(0xef),{'val':JSON[_0xcc2fc3(0x144)](_0x36455d[_0xcc2fc3(0xf2)][_0xcc2fc3(0xbe)]),'ack':!![]});if(_0x189c28)executeAutomationAction(_0x52da17);}}catch(_0x5ea18b){_0x52da17[_0xcc2fc3(0xf1)][_0xcc2fc3(0xc8)]('Gemini\x20Error:\x20'+_0x5ea18b[_0xcc2fc3(0x147)]);}}async function createDailyDigest(_0xc2b49c,_0x27e648){const _0xcf1b6a=a0_0x4cac99;if(!_0xc2b49c[_0xcf1b6a(0x148)])return;if(!canCallApi()){await _0xc2b49c[_0xcf1b6a(0xf8)](LTM_DP_STATUS,{'val':_0xcf1b6a(0xdc),'ack':!![]});return;}await _0xc2b49c[_0xcf1b6a(0xf8)](LTM_DP_STATUS,{'val':_0xcf1b6a(0x13d),'ack':!![]});if(!_0xc2b49c[_0xcf1b6a(0x14a)]||_0xc2b49c[_0xcf1b6a(0xf5)]['length']<LTM_MIN_EVENTS_FOR_COMPRESSION){await _0xc2b49c[_0xcf1b6a(0xf8)](LTM_DP_STATUS,{'val':_0xcf1b6a(0x115),'ack':!![]});return;}const _0x11bf87=JSON[_0xcf1b6a(0x12a)](JSON[_0xcf1b6a(0x144)](_0xc2b49c[_0xcf1b6a(0xf5)])),_0x35d5c3=_0x11bf87['length'],_0x2982e3=_0xcf1b6a(0x11f)+JSON[_0xcf1b6a(0x144)](_0x11bf87);try{updateApiTimestamp();const _0x59430e=await _0xc2b49c[_0xcf1b6a(0x14a)]['generateContent'](_0x2982e3),_0x43a1c3=JSON['parse'](_0x59430e['response'][_0xcf1b6a(0x141)]()[_0xcf1b6a(0xd8)](/```json|```/g,'')['trim']()),_0x5c58e1={'timestamp':new Date()['toISOString'](),'eventCount':_0x35d5c3,'summary':_0x43a1c3['summary']||_0xcf1b6a(0x12c),'activityLevel':_0x43a1c3[_0xcf1b6a(0x145)]||_0xcf1b6a(0x113),'systemMode':_0xc2b49c['currentSystemMode']};_0xc2b49c['dailyDigests']['push'](_0x5c58e1);const _0xf47975=_0xc2b49c[_0xcf1b6a(0x10b)]['ltmLtbWindowDays']||0x3c;_0xc2b49c['dailyDigests'][_0xcf1b6a(0x11c)]>_0xf47975&&_0xc2b49c[_0xcf1b6a(0x126)]['splice'](0x0,_0xc2b49c[_0xcf1b6a(0x126)]['length']-_0xf47975);await _0xc2b49c[_0xcf1b6a(0xf8)](LTM_DP_DAILY_DIGESTS,{'val':JSON[_0xcf1b6a(0x144)](_0xc2b49c[_0xcf1b6a(0x126)]),'ack':!![]}),_0xc2b49c['rawEventLog']=[],await _0xc2b49c[_0xcf1b6a(0xf8)](LTM_DP_RAW_LOG,{'val':JSON[_0xcf1b6a(0x144)](_0xc2b49c['rawEventLog']),'ack':!![]}),await _0xc2b49c['setStateAsync'](LTM_DP_STATUS,{'val':_0xcf1b6a(0x137),'ack':!![]});const _0x21d3c1='ðŸ“…\x20Daily\x20Digest:\x0a'+_0x43a1c3[_0xcf1b6a(0xd0)]+_0xcf1b6a(0xde)+_0x43a1c3[_0xcf1b6a(0x145)];setup[_0xcf1b6a(0x150)](_0xc2b49c,_0x21d3c1,![],![]);if(_0xc2b49c[_0xcf1b6a(0x148)]&&_0x27e648)_0x27e648[_0xcf1b6a(0xc2)](_0xc2b49c,_0xcf1b6a(0x14c),{'digest':_0x5c58e1});}catch(_0x5541db){_0xc2b49c[_0xcf1b6a(0xf1)]['error'](_0x5541db[_0xcf1b6a(0x147)]);}}async function runBaselineDriftAnalysis(_0x4d979b){const _0x173c22=a0_0x4cac99;if(!_0x4d979b[_0x173c22(0x148)]||!_0x4d979b[_0x173c22(0x14a)])return;if(!canCallApi())return;const _0x1be16d=_0x4d979b[_0x173c22(0x10b)]['ltmStbWindowDays']||0xe;if(_0x4d979b[_0x173c22(0x126)][_0x173c22(0x11c)]<_0x1be16d+0x7){await _0x4d979b[_0x173c22(0xf8)](_0x173c22(0x11d),{'val':_0x173c22(0x114),'ack':!![]});return;}const _0xd95cc1=_0x4d979b[_0x173c22(0x126)][_0x173c22(0xe8)](-_0x1be16d),_0x5b3782=_0x4d979b[_0x173c22(0x126)][_0x173c22(0xe8)](0x0,_0x4d979b[_0x173c22(0x126)]['length']-_0x1be16d),_0x2c912a=_0x173c22(0x117)+JSON[_0x173c22(0x144)](_0x5b3782)+_0x173c22(0xfa)+JSON[_0x173c22(0x144)](_0xd95cc1);try{updateApiTimestamp();const _0x244777=await _0x4d979b[_0x173c22(0x14a)][_0x173c22(0xf3)](_0x2c912a),_0x2ae32c=JSON[_0x173c22(0x12a)](_0x244777['response'][_0x173c22(0x141)]()['replace'](/```json|```/g,'')[_0x173c22(0x128)]());_0x2ae32c['baselineDrift']&&(await _0x4d979b[_0x173c22(0xf8)]('LTM.driftAnalysis.baselineDrift',{'val':_0x2ae32c[_0x173c22(0xb1)],'ack':!![]}),await _0x4d979b['setStateAsync'](_0x173c22(0x133),{'val':_0x2ae32c[_0x173c22(0x125)],'ack':!![]}),await _0x4d979b[_0x173c22(0xf8)]('LTM.driftAnalysis.lastCheck',{'val':Date['now'](),'ack':!![]}));}catch(_0x4b14a1){}}async function executeAutomationAction(_0x5956a1){const _0x24d79d=a0_0x4cac99;try{const _0xc70db7=await _0x5956a1['getStateAsync'](_0x24d79d(0xc0)),_0x1bb3bb=await _0x5956a1[_0x24d79d(0x129)]('analysis.automation.targetValue');if(_0xc70db7&&_0xc70db7[_0x24d79d(0x14d)]&&_0x1bb3bb){const _0x3bb6ba=_0xc70db7[_0x24d79d(0x14d)];let _0x5f44de=_0x1bb3bb[_0x24d79d(0x14d)];try{_0x5f44de=JSON[_0x24d79d(0x12a)](_0x5f44de);}catch(_0x20ed8e){}_0x5956a1['log'][_0x24d79d(0xc6)]('ðŸ¤–\x20BUTLER:\x20Executing\x20Action\x20->\x20'+_0x3bb6ba+_0x24d79d(0xdd)+_0x5f44de),await _0x5956a1['setForeignStateAsync'](_0x3bb6ba,_0x5f44de);}else _0x5956a1[_0x24d79d(0xf1)][_0x24d79d(0x10a)]('ðŸ¤–\x20BUTLER:\x20No\x20valid\x20target\x20ID\x20or\x20value\x20stored\x20for\x20execution.');}catch(_0x366578){_0x5956a1[_0x24d79d(0xf1)][_0x24d79d(0xc8)]('BUTLER\x20Execution\x20Error:\x20'+_0x366578[_0x24d79d(0x147)]);}}async function sendMorningBriefing(_0x2c844e){const _0x5db653=a0_0x4cac99;if(!_0x2c844e[_0x5db653(0x14a)]){_0x2c844e[_0x5db653(0xf1)][_0x5db653(0x10a)](_0x5db653(0x110));return;}_0x2c844e[_0x5db653(0xf1)]['info'](_0x5db653(0x131));try{updateApiTimestamp();const _0x1dff01='Erstelle\x20ein\x20kurzes\x20\x27Guten\x20Morgen\x27\x20Briefing\x20basierend\x20auf\x20den\x20Events\x20der\x20letzten\x20Nacht.',_0x26a9d5=await _0x2c844e[_0x5db653(0x14a)][_0x5db653(0xf3)](_0x1dff01),_0x415a47=_0x26a9d5[_0x5db653(0xcc)][_0x5db653(0x141)]();_0x2c844e[_0x5db653(0xf1)]['info'](_0x5db653(0x118)+_0x415a47[_0x5db653(0x11c)]+').\x20Sending\x20notification...'),setup[_0x5db653(0x150)](_0x2c844e,_0x5db653(0xd7)+_0x415a47);}catch(_0x105ff4){_0x2c844e[_0x5db653(0xf1)]['error'](_0x5db653(0x11e)+_0x105ff4['message']);}}async function generateHealthReport(_0x3c4ad9,_0x2b6d45){const _0x14c876=a0_0x4cac99;if(!_0x3c4ad9[_0x14c876(0x14a)])return;const _0x325033=Date[_0x14c876(0x107)]();_0x325033-lastGlobalApiCall<0xbb8&&(_0x3c4ad9[_0x14c876(0xf1)][_0x14c876(0xd5)](_0x14c876(0xff)),await new Promise(_0x2f6e04=>setTimeout(_0x2f6e04,0x7d0)));const _0x217d5f=new Date();let _0xb682ac=0x0,_0x49c1f1=_0x217d5f[_0x14c876(0xb4)](),_0x3dec44='';if(_0x2b6d45===_0x14c876(0x151)){const _0x46fbe1=new Date(_0x217d5f);_0x46fbe1[_0x14c876(0x11a)](_0x46fbe1[_0x14c876(0xf7)]()-0x1),_0x46fbe1['setHours'](0x16,0x0,0x0,0x0),_0xb682ac=_0x46fbe1[_0x14c876(0xb4)]();const _0x1eefe9=new Date(_0x217d5f);_0x1eefe9[_0x14c876(0x14e)](0x8,0x0,0x0,0x0),_0x49c1f1=_0x1eefe9[_0x14c876(0xb4)](),_0x3dec44=_0x14c876(0x124);}else{const _0x238a4b=new Date(_0x217d5f);_0x238a4b[_0x14c876(0x14e)](0x8,0x0,0x0,0x0),_0xb682ac=_0x238a4b[_0x14c876(0xb4)](),_0x3dec44=_0x14c876(0xce);}const _0x38b104=_0x3c4ad9[_0x14c876(0x10f)]['filter'](_0x1dd60d=>_0x1dd60d[_0x14c876(0x135)]>=_0xb682ac&&_0x1dd60d[_0x14c876(0x135)]<=_0x49c1f1);if(_0x38b104[_0x14c876(0x11c)]===0x0){const _0x4a0756=_0x2b6d45===_0x14c876(0x151)?_0x14c876(0xc3):_0x14c876(0x149),_0x1e8b0a=_0x2b6d45===_0x14c876(0x151)?_0x14c876(0xfd):'analysis.health.geminiDay';await _0x3c4ad9[_0x14c876(0xf8)](_0x1e8b0a,{'val':_0x4a0756,'ack':!![]});return;}const _0x37c4e7=_0x38b104[_0x14c876(0xe2)](_0x5b0bbe=>new Date(_0x5b0bbe[_0x14c876(0x135)])[_0x14c876(0x100)]([],{'hour':_0x14c876(0xd4),'minute':_0x14c876(0xd4)})+'\x20'+_0x5b0bbe[_0x14c876(0xb2)]+'\x20('+_0x5b0bbe[_0x14c876(0xb9)]+')')[_0x14c876(0xdf)]('\x0a'),_0xc0e8a9='\x0a\x20\x20\x20\x20ROLLE:\x20Medizinischer\x20Assistent\x20fÃ¼r\x20AAL\x20(Ambient\x20Assisted\x20Living).\x0a\x20\x20\x20\x20AUFGABE:\x20'+_0x3dec44+_0x14c876(0x105)+_0x37c4e7+_0x14c876(0x12d);try{updateApiTimestamp();const _0x2a34a1=await _0x3c4ad9['geminiModel'][_0x14c876(0xf3)](_0xc0e8a9),_0x28cffc=_0x2a34a1[_0x14c876(0xcc)][_0x14c876(0x141)](),_0x19cf14=_0x2b6d45===_0x14c876(0x151)?_0x14c876(0xfd):_0x14c876(0x112);await _0x3c4ad9[_0x14c876(0xf8)](_0x19cf14,{'val':_0x28cffc,'ack':!![]}),_0x3c4ad9[_0x14c876(0xf1)]['info']('ðŸ¤–\x20Health\x20Report\x20('+_0x2b6d45+_0x14c876(0x122));}catch(_0x33f5b3){_0x3c4ad9[_0x14c876(0xf1)][_0x14c876(0xc8)]('Health\x20Report\x20Error:\x20'+_0x33f5b3[_0x14c876(0x147)]);}}module['exports']={'executeAutomationAction':executeAutomationAction,'createDailyDigest':createDailyDigest,'runBaselineDriftAnalysis':runBaselineDriftAnalysis,'sendMorningBriefing':sendMorningBriefing,'runGeminiAnalysis':runGeminiAnalysis,'consultButler':consultButler,'generateHealthReport':generateHealthReport};