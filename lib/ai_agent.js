const a0_0x57208f=a0_0xfe69;function a0_0xfe69(_0x38c4e0,_0x1a0a4a){const _0x528a16=a0_0x30b1();return a0_0xfe69=function(_0x41a986,_0x58bd28){_0x41a986=_0x41a986-0x123;let _0x30b1b7=_0x528a16[_0x41a986];return _0x30b1b7;},a0_0xfe69(_0x38c4e0,_0x1a0a4a);}(function(_0x4786e2,_0x45ec06){const _0x3ffb77=a0_0xfe69,_0x1eaeaf=_0x4786e2();while(!![]){try{const _0x5d1271=parseInt(_0x3ffb77(0x14b))/0x1*(parseInt(_0x3ffb77(0x1ac))/0x2)+-parseInt(_0x3ffb77(0x19e))/0x3*(-parseInt(_0x3ffb77(0x163))/0x4)+-parseInt(_0x3ffb77(0x1bf))/0x5*(-parseInt(_0x3ffb77(0x139))/0x6)+-parseInt(_0x3ffb77(0x188))/0x7*(-parseInt(_0x3ffb77(0x125))/0x8)+-parseInt(_0x3ffb77(0x132))/0x9+parseInt(_0x3ffb77(0x12c))/0xa+parseInt(_0x3ffb77(0x1ab))/0xb*(-parseInt(_0x3ffb77(0x124))/0xc);if(_0x5d1271===_0x45ec06)break;else _0x1eaeaf['push'](_0x1eaeaf['shift']());}catch(_0x44641f){_0x1eaeaf['push'](_0x1eaeaf['shift']());}}}(a0_0x30b1,0x5e0e2));const a0_0x58bd28=(function(){let _0x2056dd=!![];return function(_0x2eed58,_0x47e1ea){const _0x5c3bfc=_0x2056dd?function(){if(_0x47e1ea){const _0x469f3e=_0x47e1ea['apply'](_0x2eed58,arguments);return _0x47e1ea=null,_0x469f3e;}}:function(){};return _0x2056dd=![],_0x5c3bfc;};}()),a0_0x41a986=a0_0x58bd28(this,function(){const _0x143c6c=a0_0xfe69;return a0_0x41a986[_0x143c6c(0x162)]()['search'](_0x143c6c(0x13e))[_0x143c6c(0x162)]()[_0x143c6c(0x1c0)](a0_0x41a986)[_0x143c6c(0x194)](_0x143c6c(0x13e));});a0_0x41a986();'use strict';const {GoogleGenerativeAI}=require(a0_0x57208f(0x161)),setup=require('./setup'),GEMINI_MODEL=a0_0x57208f(0x171),LTM_DP_DAILY_DIGESTS=a0_0x57208f(0x127),LTM_DP_STATUS=a0_0x57208f(0x1a9),LTM_DP_RAW_LOG=a0_0x57208f(0x173),LTM_MIN_EVENTS_FOR_COMPRESSION=0x5,MIN_API_GAP_MS=0x4e20;function a0_0x30b1(){const _0x5c670e=['.\x20SYSTEM_MODE:\x20','generateContent','Analysiere\x20diese\x20Events\x20der\x20NACHT\x20(22:00-08:00).\x20War\x20der\x20Schlaf\x20ruhig?\x20Gab\x20es\x20Badg√§nge?\x20Antwort\x20kurz\x20f√ºr\x20den\x20besorgten\x20Sohn\x20(max\x202\x20S√§tze).','targetValue','length','filter','ü§ñ\x20API\x20Cooldown.\x20Waiting\x202s...','useWeather','5uFyuAA','constructor','\x0a\x20\x20\x20\x20ANTWORT-STIL:\x20Sachlich,\x20beruhigend,\x20pr√§zise.\x20Keine\x20Floskeln.\x0a\x20\x20\x20\x20','5238564LfvMxr','32TXYkBI','KI\x20offline\x20(Fallback)','LTM.dailyDigests','analysis.alertReason','isProVersion','message','.Current.WeatherText','1262870MwApIk','PRIORIT√ÑT:\x20Energie\x20sparen.\x20Schalte\x20nur,\x20wenn\x20absolut\x20notwendig\x20(Dunkelheit).','ü§ñ\x20Butler\x20Brain\x20Error:\x20','ü§ñ\x20Autopilot\x20skipped\x20(Traffic\x20Protection\x20active).','now','response','216774idkCdZ','LTM.driftAnalysis.lastCheck','Started...','Traffic-Schutz\x20(Auto-Approved)','Fokus\x20auf\x20Komfort\x20f√ºr\x20die\x20Familie.','timestamp','NIGHT','436794adGrHr','error','analysisHistory','Unbekannt\x20(Kein\x20Sensor)','Erstelle\x20ein\x20kurzes\x20\x27Guten\x20Morgen\x27\x20Briefing\x20basierend\x20auf\x20den\x20Events\x20der\x20letzten\x20Nacht.','(((.+)+)+)+$','splice','rawEventLog','\x20√ºbersprungen\x20(Auto-Approved).','text','detected','debug','getForeignStateAsync','eventHistory','description','.\x20KONTEXT:\x20','analysis.isAlert','alertReason','9211yOYEtZ','.\x20EMERGENCY:\x20','warn','Keine\x20Daten\x20f√ºr\x20die\x20Nacht\x20aufgezeichnet\x20(Sensoren\x20ruhig).','ü§ñ\x20Traffic\x20Schutz:\x20Anfrage\x20f√ºr\x20','pop',')\x20generated.','toISOString','\x0a\x20\x20\x20\x20EVENTS:\x0a','getStateAsync','.\x20AUFGABE:\x201.\x20Gesundheit?\x202.\x20Komfort?\x20FORMAT\x20(JSON):\x20{\x20\x22isAlert\x22:\x20boolean,\x20\x22alertReason\x22:\x20\x22string\x22,\x20\x22isEmergency\x22:\x20boolean,\x20\x22summary\x22:\x20\x22string\x22,\x20\x22automationProposal\x22:\x20{\x20\x22detected\x22:\x20boolean,\x20\x22description\x22:\x20\x22string\x22,\x20\x22targetId\x22:\x20\x22string\x22,\x20\x22targetValue\x22:\x20\x22any\x22\x20}\x20}','currentSystemMode','analysis.health.geminiNight','toFixed','setHours','getDate','isEmergency','decision','\x22.\x0a\x20\x20\x20\x20AKTION:\x20Schalte\x20\x22','.\x0a\x20\x20\x20\x20EVENT:\x20Bewohner\x20geht\x20wahrscheinlich\x20(','\x20->\x20','join','@google/generative-ai','toString','1116bAgGMI','Maximaler\x20Komfort,\x20Energie\x20ist\x20zweitrangig.','dailyDigests','weatherInstance','.\x20ANWESEND:\x20','driftDetails','automationProposal','analysis.automation.targetId','üåÖ\x20Briefing\x20generated\x20(Length:\x20','activityLevel','lastAlertState','geminiModel','LTM.driftAnalysis.baselineDrift','Nacht','models/gemini-flash-latest','\x0a\x20\x20\x20\x20FRAGE:\x20Ist\x20es\x20dunkel\x20genug\x20f√ºr\x20Licht?\x0a\x20\x20\x20\x20FORMAT:\x20{\x20\x22approved\x22:\x20boolean,\x20\x22reason\x22:\x20\x22kurzer\x20Grund\x22\x20}\x0a\x20\x20\x20\x20','LTM.rawEventLog','generic','aiPersona','.forecast.current.state','setStateAsync','BUTLER\x20Execution\x20Error:\x20','slice','isAlert','analysis.lastResult','ltmLtbWindowDays','baselineDrift','replace','ü§ñ\x20Health\x20Report\x20(','exports','analysis.activitySummary','üåÖ\x20Starting\x20Morning\x20Briefing\x20sequence\x20(Traffic\x20Check\x20bypassed)...','toLocaleTimeString',',\x20Wetter:\x20','ROLLE:\x20Data\x20Scientist.\x20ZIEL:\x20Drift\x20erkennen.\x20SCHEMA:\x20{\x20\x22baselineDrift\x22:\x20\x22none|slight|significant|critical\x22,\x20\x22driftDetails\x22:\x20\x22string\x22\x20}\x0a\x0aLTB:\x20','Gemini\x20Error:\x20','config','547897PoeEgy',',\x20Lichtverh√§ltnisse:\x20','Keine\x20Details.','setForeignStateAsync','livingContext','üìÖ\x20Daily\x20Digest:\x0a','\x0a\x20\x20\x20\x20ROLLE:\x20Medizinischer\x20Assistent\x20f√ºr\x20AAL\x20(Ambient\x20Assisted\x20Living).\x0a\x20\x20\x20\x20AUFGABE:\x20','name','ü§ñ\x20Butler\x20Cache\x20Hit:\x20','Wetterdaten\x20nicht\x20abrufbar','.\x20EVENTS:\x20','analysis.analysisHistory','search','ANALYZE_HEALTH','map','ROLLE:\x20Data\x20Compression\x20Agent.\x20SPRACHE:\x20DE.\x20FORMAT:\x20JSON.\x20ANWEISUNG:\x20Fasse\x20Sensor-Events\x20zusammen.\x20SCHEMA:\x20{\x20\x22summary\x22:\x20\x22string\x22,\x20\x22activityLevel\x22:\x20\x22string\x22\x20}\x20\x0a\x0aEVENTS:\x0a','value','sendNotification','.Current.IsNight','üåÖ\x20Morning\x20Briefing:\x0a','\x0aAktivit√§t:\x20','Digest','2835zBdNIM','\x20=\x20','val','info','getTime','send','parse','stringify','analysis.health.geminiDay','KI-Fehler\x20(Fallback)','summary','LTM.processingStatus','analysis.automation.targetValue','22bDZYJw','110qVMMIM','N/A\x20(Learning)','Skipped\x20(Traffic)','Unbekannt','2-digit','Success','trim','ü§ñ\x20BUTLER:\x20No\x20valid\x20target\x20ID\x20or\x20value\x20stored\x20for\x20execution.','LTM.driftAnalysis.driftDetails','log','reason'];a0_0x30b1=function(){return _0x5c670e;};return a0_0x30b1();}let lastGlobalApiCall=0x0;const decisionCache={},CACHE_TTL_MS=0xf*0x3c*0x3e8,PERSONA_MAPPING={'generic':'Entscheide\x20ausgewogen\x20zwischen\x20Komfort\x20und\x20Energie.','senior_aal':'PRIORIT√ÑT:\x20Sicherheit\x20und\x20Licht.\x20Schalte\x20lieber\x20einmal\x20zu\x20viel\x20als\x20zu\x20wenig.','family':a0_0x57208f(0x136),'single_comfort':a0_0x57208f(0x164),'security':'Sicherheit\x20geht\x20vor.','energy_saver':a0_0x57208f(0x12d)};function canCallApi(){const _0x24f0e6=a0_0x57208f,_0x27fb10=Date[_0x24f0e6(0x130)]();return _0x27fb10-lastGlobalApiCall>MIN_API_GAP_MS;}function updateApiTimestamp(){const _0x28bb2b=a0_0x57208f;lastGlobalApiCall=Date[_0x28bb2b(0x130)]();}async function getWeatherContext(_0x57b3cc){const _0x5ab556=a0_0x57208f;if(!_0x57b3cc[_0x5ab556(0x187)][_0x5ab556(0x1be)]||!_0x57b3cc['config'][_0x5ab556(0x166)])return _0x5ab556(0x13c);try{const _0x4a2585=_0x57b3cc['config'][_0x5ab556(0x166)];let _0xc17691=await _0x57b3cc['getForeignStateAsync'](_0x4a2585+'.Current.Temperature');if(!_0xc17691)_0xc17691=await _0x57b3cc[_0x5ab556(0x145)](_0x4a2585+'.forecast.current.temperature');let _0x2d9311=await _0x57b3cc[_0x5ab556(0x145)](_0x4a2585+_0x5ab556(0x12b));if(!_0x2d9311)_0x2d9311=await _0x57b3cc[_0x5ab556(0x145)](_0x4a2585+_0x5ab556(0x176));let _0x366db2=_0x5ab556(0x1af);const _0x42eec2=await _0x57b3cc[_0x5ab556(0x145)](_0x4a2585+_0x5ab556(0x19a));if(_0x42eec2)_0x366db2=_0x42eec2[_0x5ab556(0x1a0)]?_0x5ab556(0x170):'Tag';if(_0xc17691&&_0x2d9311)return _0xc17691[_0x5ab556(0x1a0)]+'¬∞C,\x20'+_0x2d9311[_0x5ab556(0x1a0)]+_0x5ab556(0x189)+_0x366db2;}catch(_0x571093){}return _0x5ab556(0x191);}async function consultButler(_0x47e236,_0x389d6d,_0x4a1487,_0x5a99ee){const _0x2bffef=a0_0x57208f;if(!_0x47e236['geminiModel'])return{'approved':!![],'reason':_0x2bffef(0x126)};const _0x4e360a=Date[_0x2bffef(0x130)]();if(decisionCache[_0x389d6d]&&_0x4e360a-decisionCache[_0x389d6d][_0x2bffef(0x137)]<CACHE_TTL_MS){const _0x4e7958=decisionCache[_0x389d6d][_0x2bffef(0x15c)];return _0x47e236[_0x2bffef(0x1b5)][_0x2bffef(0x144)](_0x2bffef(0x190)+_0x389d6d+_0x2bffef(0x15f)+(_0x4e7958['approved']?'OK':'NO')+'\x20('+_0x4e7958[_0x2bffef(0x1b6)]+')'),_0x4e7958;}if(!canCallApi())return _0x47e236[_0x2bffef(0x1b5)][_0x2bffef(0x144)](_0x2bffef(0x14f)+_0x389d6d+_0x2bffef(0x141)),{'approved':!![],'reason':_0x2bffef(0x135)};const _0x142c83=new Date()[_0x2bffef(0x183)](),_0x3b149e=await getWeatherContext(_0x47e236),_0x59bb99=PERSONA_MAPPING[_0x47e236[_0x2bffef(0x187)]['aiPersona']||_0x2bffef(0x174)],_0x2b8b71='\x0a\x20\x20\x20\x20ROLLE:\x20Haus-Butler.\x0a\x20\x20\x20\x20SITUATION:\x20'+_0x142c83+_0x2bffef(0x184)+_0x3b149e+_0x2bffef(0x15e)+(_0x5a99ee*0x64)[_0x2bffef(0x158)](0x0)+'%)\x20nach\x20\x22'+_0x389d6d+_0x2bffef(0x15d)+_0x4a1487+'\x22\x20AN.\x0a\x20\x20\x20\x20STRATEGIE:\x20'+_0x59bb99+_0x2bffef(0x172);try{updateApiTimestamp();const _0x17e74c=await _0x47e236[_0x2bffef(0x16e)]['generateContent'](_0x2b8b71),_0x5f66a5=_0x17e74c[_0x2bffef(0x131)][_0x2bffef(0x142)]()[_0x2bffef(0x17e)](/```json|```/g,'')['trim'](),_0x441db6=JSON[_0x2bffef(0x1a4)](_0x5f66a5);return decisionCache[_0x389d6d]={'decision':_0x441db6,'timestamp':_0x4e360a},_0x441db6;}catch(_0x25896a){return _0x47e236[_0x2bffef(0x1b5)][_0x2bffef(0x14d)](_0x2bffef(0x12e)+_0x25896a[_0x2bffef(0x12a)]),decisionCache[_0x389d6d]={'decision':{'approved':!![],'reason':_0x2bffef(0x1a7)},'timestamp':_0x4e360a-(CACHE_TTL_MS-0xea60)},{'approved':!![],'reason':_0x2bffef(0x1a7)};}}async function runGeminiAnalysis(_0x303c9f,_0x76bb8f=''){const _0x3b86ec=a0_0x57208f;if(!_0x303c9f[_0x3b86ec(0x16e)])return;if(!canCallApi()){_0x303c9f[_0x3b86ec(0x1b5)][_0x3b86ec(0x144)](_0x3b86ec(0x12f));return;}if(_0x303c9f[_0x3b86ec(0x146)][_0x3b86ec(0x1bb)]===0x0)return;const _0x862628=_0x303c9f[_0x3b86ec(0x146)][_0x3b86ec(0x179)](0x0,0xf),_0x251309=_0x303c9f[_0x3b86ec(0x156)],_0x139d39=PERSONA_MAPPING[_0x303c9f[_0x3b86ec(0x187)][_0x3b86ec(0x175)]||_0x3b86ec(0x174)],_0x16798b=_0x303c9f['config'][_0x3b86ec(0x18c)]||_0x3b86ec(0x18a);let _0x2182ff=_0x3b86ec(0x1af);try{const _0x3b972c=await _0x303c9f[_0x3b86ec(0x154)]('system.presenceWho');if(_0x3b972c&&_0x3b972c[_0x3b86ec(0x1a0)])_0x2182ff=_0x3b972c[_0x3b86ec(0x1a0)];}catch(_0x2a4a9e){}let _0x1a30a7=![];try{const _0x218dcf=await _0x303c9f[_0x3b86ec(0x154)]('analysis.automation.autoApply');if(_0x218dcf&&_0x218dcf[_0x3b86ec(0x1a0)])_0x1a30a7=!![];}catch(_0x15060f){}const _0x13e0f2='ROLLE:\x20KI-Hausverwalter.\x20PERSONA:\x20'+_0x139d39+_0x3b86ec(0x148)+_0x16798b+_0x3b86ec(0x1b7)+_0x251309+_0x3b86ec(0x167)+_0x2182ff+_0x3b86ec(0x192)+JSON[_0x3b86ec(0x1a5)](_0x862628)+_0x3b86ec(0x14c)+_0x76bb8f+_0x3b86ec(0x155);try{updateApiTimestamp();const _0x5212c3=await _0x303c9f[_0x3b86ec(0x16e)]['generateContent'](_0x13e0f2),_0x54a684=JSON[_0x3b86ec(0x1a4)](_0x5212c3['response'][_0x3b86ec(0x142)]()[_0x3b86ec(0x17e)](/```json|```/g,'')[_0x3b86ec(0x1b2)]());await _0x303c9f[_0x3b86ec(0x177)](_0x3b86ec(0x17b),{'val':JSON[_0x3b86ec(0x1a5)](_0x54a684),'ack':!![]});if(_0x54a684['summary'])await _0x303c9f[_0x3b86ec(0x177)](_0x3b86ec(0x181),{'val':_0x54a684[_0x3b86ec(0x1a8)],'ack':!![]});const _0x1a6753={'timestamp':Date[_0x3b86ec(0x130)](),'id':Date[_0x3b86ec(0x130)]()[_0x3b86ec(0x162)](),'analysis':{'activity':{'summary':_0x54a684[_0x3b86ec(0x1a8)],'isAlert':_0x54a684[_0x3b86ec(0x17a)],'alertReason':_0x54a684[_0x3b86ec(0x14a)]},'comfort':{'automationProposal':_0x54a684['automationProposal']}}};_0x303c9f[_0x3b86ec(0x13b)]['unshift'](_0x1a6753);if(_0x303c9f[_0x3b86ec(0x13b)][_0x3b86ec(0x1bb)]>0x32)_0x303c9f[_0x3b86ec(0x13b)][_0x3b86ec(0x150)]();await _0x303c9f[_0x3b86ec(0x177)](_0x3b86ec(0x193),{'val':JSON[_0x3b86ec(0x1a5)](_0x303c9f['analysisHistory']),'ack':!![]});const _0x11debf=_0x54a684['isAlert']||![];_0x11debf!==_0x303c9f['lastAlertState']&&(await _0x303c9f[_0x3b86ec(0x177)](_0x3b86ec(0x149),{'val':_0x11debf,'ack':!![]}),_0x303c9f[_0x3b86ec(0x16d)]=_0x11debf,_0x11debf&&(await _0x303c9f[_0x3b86ec(0x177)](_0x3b86ec(0x128),{'val':_0x54a684[_0x3b86ec(0x14a)],'ack':!![]}),setup[_0x3b86ec(0x199)](_0x303c9f,'‚ö†Ô∏è\x20ALARM:\x20'+_0x54a684['alertReason'],![],_0x54a684[_0x3b86ec(0x15b)])));if(_0x54a684[_0x3b86ec(0x169)]&&_0x54a684['automationProposal'][_0x3b86ec(0x143)]){await _0x303c9f['setStateAsync']('analysis.automation.patternDetected',{'val':!![],'ack':!![]}),await _0x303c9f[_0x3b86ec(0x177)]('analysis.automation.description',{'val':_0x54a684['automationProposal'][_0x3b86ec(0x147)],'ack':!![]}),await _0x303c9f[_0x3b86ec(0x177)](_0x3b86ec(0x16a),{'val':_0x54a684['automationProposal']['targetId'],'ack':!![]}),await _0x303c9f['setStateAsync'](_0x3b86ec(0x1aa),{'val':JSON[_0x3b86ec(0x1a5)](_0x54a684['automationProposal'][_0x3b86ec(0x1ba)]),'ack':!![]});if(_0x1a30a7)executeAutomationAction(_0x303c9f);}}catch(_0x2ab244){_0x303c9f['log'][_0x3b86ec(0x13a)](_0x3b86ec(0x186)+_0x2ab244[_0x3b86ec(0x12a)]);}}async function createDailyDigest(_0x3008f2,_0x1ebe7e){const _0x39cfed=a0_0x57208f;if(!_0x3008f2[_0x39cfed(0x129)])return;if(!canCallApi()){await _0x3008f2[_0x39cfed(0x177)](LTM_DP_STATUS,{'val':_0x39cfed(0x1ae),'ack':!![]});return;}await _0x3008f2[_0x39cfed(0x177)](LTM_DP_STATUS,{'val':_0x39cfed(0x134),'ack':!![]});if(!_0x3008f2['geminiModel']||_0x3008f2['rawEventLog'][_0x39cfed(0x1bb)]<LTM_MIN_EVENTS_FOR_COMPRESSION){await _0x3008f2[_0x39cfed(0x177)](LTM_DP_STATUS,{'val':'Skipped\x20(No\x20AI\x20or\x20Data)','ack':!![]});return;}const _0x2360f5=JSON[_0x39cfed(0x1a4)](JSON['stringify'](_0x3008f2[_0x39cfed(0x140)])),_0x41a00b=_0x2360f5['length'],_0x2aac25=_0x39cfed(0x197)+JSON[_0x39cfed(0x1a5)](_0x2360f5);try{updateApiTimestamp();const _0x124232=await _0x3008f2[_0x39cfed(0x16e)]['generateContent'](_0x2aac25),_0x58d1b9=JSON[_0x39cfed(0x1a4)](_0x124232[_0x39cfed(0x131)]['text']()[_0x39cfed(0x17e)](/```json|```/g,'')[_0x39cfed(0x1b2)]()),_0xa29479={'timestamp':new Date()[_0x39cfed(0x152)](),'eventCount':_0x41a00b,'summary':_0x58d1b9[_0x39cfed(0x1a8)]||_0x39cfed(0x19d),'activityLevel':_0x58d1b9['activityLevel']||'normal','systemMode':_0x3008f2[_0x39cfed(0x156)]};_0x3008f2[_0x39cfed(0x165)]['push'](_0xa29479);const _0x26a31b=_0x3008f2[_0x39cfed(0x187)][_0x39cfed(0x17c)]||0x3c;_0x3008f2[_0x39cfed(0x165)]['length']>_0x26a31b&&_0x3008f2[_0x39cfed(0x165)][_0x39cfed(0x13f)](0x0,_0x3008f2[_0x39cfed(0x165)][_0x39cfed(0x1bb)]-_0x26a31b);await _0x3008f2[_0x39cfed(0x177)](LTM_DP_DAILY_DIGESTS,{'val':JSON['stringify'](_0x3008f2[_0x39cfed(0x165)]),'ack':!![]}),_0x3008f2['rawEventLog']=[],await _0x3008f2[_0x39cfed(0x177)](LTM_DP_RAW_LOG,{'val':JSON[_0x39cfed(0x1a5)](_0x3008f2[_0x39cfed(0x140)]),'ack':!![]}),await _0x3008f2[_0x39cfed(0x177)](LTM_DP_STATUS,{'val':_0x39cfed(0x1b1),'ack':!![]});const _0x3179c0=_0x39cfed(0x18d)+_0x58d1b9[_0x39cfed(0x1a8)]+_0x39cfed(0x19c)+_0x58d1b9[_0x39cfed(0x16c)];setup['sendNotification'](_0x3008f2,_0x3179c0,![],![]);if(_0x3008f2['isProVersion']&&_0x1ebe7e)_0x1ebe7e[_0x39cfed(0x1a3)](_0x3008f2,_0x39cfed(0x195),{'digest':_0xa29479});}catch(_0x2f627a){_0x3008f2['log']['error'](_0x2f627a[_0x39cfed(0x12a)]);}}async function runBaselineDriftAnalysis(_0x5317e1){const _0x54483f=a0_0x57208f;if(!_0x5317e1[_0x54483f(0x129)]||!_0x5317e1[_0x54483f(0x16e)])return;if(!canCallApi())return;const _0x119c48=_0x5317e1[_0x54483f(0x187)]['ltmStbWindowDays']||0xe;if(_0x5317e1['dailyDigests'][_0x54483f(0x1bb)]<_0x119c48+0x7){await _0x5317e1[_0x54483f(0x177)](_0x54483f(0x16f),{'val':_0x54483f(0x1ad),'ack':!![]});return;}const _0x5d4a4e=_0x5317e1[_0x54483f(0x165)][_0x54483f(0x179)](-_0x119c48),_0x54c5fe=_0x5317e1[_0x54483f(0x165)][_0x54483f(0x179)](0x0,_0x5317e1[_0x54483f(0x165)][_0x54483f(0x1bb)]-_0x119c48),_0x37ba8b=_0x54483f(0x185)+JSON[_0x54483f(0x1a5)](_0x54c5fe)+'\x0aSTB:\x20'+JSON['stringify'](_0x5d4a4e);try{updateApiTimestamp();const _0x1fbb90=await _0x5317e1[_0x54483f(0x16e)][_0x54483f(0x1b8)](_0x37ba8b),_0x58bd6a=JSON[_0x54483f(0x1a4)](_0x1fbb90[_0x54483f(0x131)][_0x54483f(0x142)]()['replace'](/```json|```/g,'')[_0x54483f(0x1b2)]());_0x58bd6a[_0x54483f(0x17d)]&&(await _0x5317e1[_0x54483f(0x177)](_0x54483f(0x16f),{'val':_0x58bd6a[_0x54483f(0x17d)],'ack':!![]}),await _0x5317e1[_0x54483f(0x177)](_0x54483f(0x1b4),{'val':_0x58bd6a[_0x54483f(0x168)],'ack':!![]}),await _0x5317e1[_0x54483f(0x177)](_0x54483f(0x133),{'val':Date[_0x54483f(0x130)](),'ack':!![]}));}catch(_0x3a3984){}}async function executeAutomationAction(_0x613d4c){const _0x3907b6=a0_0x57208f;try{const _0x154cf5=await _0x613d4c[_0x3907b6(0x154)](_0x3907b6(0x16a)),_0x291843=await _0x613d4c[_0x3907b6(0x154)](_0x3907b6(0x1aa));if(_0x154cf5&&_0x154cf5[_0x3907b6(0x1a0)]&&_0x291843){const _0x549388=_0x154cf5[_0x3907b6(0x1a0)];let _0x31b42c=_0x291843[_0x3907b6(0x1a0)];try{_0x31b42c=JSON[_0x3907b6(0x1a4)](_0x31b42c);}catch(_0x27461b){}_0x613d4c['log'][_0x3907b6(0x1a1)]('ü§ñ\x20BUTLER:\x20Executing\x20Action\x20->\x20'+_0x549388+_0x3907b6(0x19f)+_0x31b42c),await _0x613d4c[_0x3907b6(0x18b)](_0x549388,_0x31b42c);}else _0x613d4c[_0x3907b6(0x1b5)][_0x3907b6(0x14d)](_0x3907b6(0x1b3));}catch(_0x4289d2){_0x613d4c[_0x3907b6(0x1b5)][_0x3907b6(0x13a)](_0x3907b6(0x178)+_0x4289d2[_0x3907b6(0x12a)]);}}async function sendMorningBriefing(_0x42723b){const _0x16d2c3=a0_0x57208f;if(!_0x42723b[_0x16d2c3(0x16e)]){_0x42723b[_0x16d2c3(0x1b5)]['warn']('ü§ñ\x20Morning\x20Briefing\x20skipped:\x20No\x20Gemini\x20Model.');return;}_0x42723b[_0x16d2c3(0x1b5)][_0x16d2c3(0x1a1)](_0x16d2c3(0x182));try{updateApiTimestamp();const _0x4504bb=_0x16d2c3(0x13d),_0x4bea95=await _0x42723b['geminiModel'][_0x16d2c3(0x1b8)](_0x4504bb),_0x22b525=_0x4bea95[_0x16d2c3(0x131)]['text']();_0x42723b['log'][_0x16d2c3(0x1a1)](_0x16d2c3(0x16b)+_0x22b525[_0x16d2c3(0x1bb)]+').\x20Sending\x20notification...'),setup[_0x16d2c3(0x199)](_0x42723b,_0x16d2c3(0x19b)+_0x22b525);}catch(_0x328f70){_0x42723b[_0x16d2c3(0x1b5)][_0x16d2c3(0x13a)]('Briefing\x20Error:\x20'+_0x328f70[_0x16d2c3(0x12a)]);}}async function generateHealthReport(_0x58ad36,_0x11e9b8){const _0x259d95=a0_0x57208f;if(!_0x58ad36[_0x259d95(0x16e)])return;const _0x4f4a6b=Date[_0x259d95(0x130)]();_0x4f4a6b-lastGlobalApiCall<0xbb8&&(_0x58ad36[_0x259d95(0x1b5)][_0x259d95(0x144)](_0x259d95(0x1bd)),await new Promise(_0x2e7f4a=>setTimeout(_0x2e7f4a,0x7d0)));const _0x9542f3=new Date();let _0xc86bd5=0x0,_0x22e6ab=_0x9542f3[_0x259d95(0x1a2)](),_0x3bfc71='';if(_0x11e9b8===_0x259d95(0x138)){const _0x5a4349=new Date(_0x9542f3);_0x5a4349['setDate'](_0x5a4349[_0x259d95(0x15a)]()-0x1),_0x5a4349[_0x259d95(0x159)](0x16,0x0,0x0,0x0),_0xc86bd5=_0x5a4349['getTime']();const _0x330158=new Date(_0x9542f3);_0x330158[_0x259d95(0x159)](0x8,0x0,0x0,0x0),_0x22e6ab=_0x330158['getTime'](),_0x3bfc71=_0x259d95(0x1b9);}else{const _0x53cbc6=new Date(_0x9542f3);_0x53cbc6['setHours'](0x8,0x0,0x0,0x0),_0xc86bd5=_0x53cbc6[_0x259d95(0x1a2)](),_0x3bfc71='Analysiere\x20diese\x20Events\x20des\x20TAGES\x20(08:00-Jetzt).\x20Aktivit√§t?\x20Mahlzeiten?\x20Haust√ºr?\x20Antwort\x20kurz\x20f√ºr\x20den\x20besorgten\x20Sohn\x20(max\x202\x20S√§tze).';}const _0x174de1=_0x58ad36['eventHistory'][_0x259d95(0x1bc)](_0x585b85=>_0x585b85[_0x259d95(0x137)]>=_0xc86bd5&&_0x585b85[_0x259d95(0x137)]<=_0x22e6ab);if(_0x174de1[_0x259d95(0x1bb)]===0x0){const _0x5b6383=_0x11e9b8===_0x259d95(0x138)?_0x259d95(0x14e):'Bisher\x20keine\x20Aktivit√§t\x20seit\x2008:00\x20Uhr\x20verzeichnet.',_0x300d38=_0x11e9b8===_0x259d95(0x138)?_0x259d95(0x157):_0x259d95(0x1a6);await _0x58ad36['setStateAsync'](_0x300d38,{'val':_0x5b6383,'ack':!![]});return;}const _0x230000=_0x174de1[_0x259d95(0x196)](_0x37e4d1=>new Date(_0x37e4d1[_0x259d95(0x137)])[_0x259d95(0x183)]([],{'hour':_0x259d95(0x1b0),'minute':_0x259d95(0x1b0)})+'\x20'+_0x37e4d1[_0x259d95(0x18f)]+'\x20('+_0x37e4d1[_0x259d95(0x198)]+')')[_0x259d95(0x160)]('\x0a'),_0x234bca=_0x259d95(0x18e)+_0x3bfc71+_0x259d95(0x153)+_0x230000+_0x259d95(0x123);try{updateApiTimestamp();const _0x2ca9ee=await _0x58ad36[_0x259d95(0x16e)][_0x259d95(0x1b8)](_0x234bca),_0x5c31e3=_0x2ca9ee[_0x259d95(0x131)][_0x259d95(0x142)](),_0x31a474=_0x11e9b8==='NIGHT'?'analysis.health.geminiNight':_0x259d95(0x1a6);await _0x58ad36[_0x259d95(0x177)](_0x31a474,{'val':_0x5c31e3,'ack':!![]}),_0x58ad36[_0x259d95(0x1b5)]['info'](_0x259d95(0x17f)+_0x11e9b8+_0x259d95(0x151));}catch(_0x4daacd){_0x58ad36['log'][_0x259d95(0x13a)]('Health\x20Report\x20Error:\x20'+_0x4daacd[_0x259d95(0x12a)]);}}module[a0_0x57208f(0x180)]={'executeAutomationAction':executeAutomationAction,'createDailyDigest':createDailyDigest,'runBaselineDriftAnalysis':runBaselineDriftAnalysis,'sendMorningBriefing':sendMorningBriefing,'runGeminiAnalysis':runGeminiAnalysis,'consultButler':consultButler,'generateHealthReport':generateHealthReport};