const a0_0x35190a=a0_0x4a79;(function(_0x183cb6,_0xa26f6a){const _0x3ea2e0=a0_0x4a79,_0x587e42=_0x183cb6();while(!![]){try{const _0x5a1c6f=parseInt(_0x3ea2e0(0x127))/0x1*(-parseInt(_0x3ea2e0(0x109))/0x2)+parseInt(_0x3ea2e0(0x136))/0x3+-parseInt(_0x3ea2e0(0xc7))/0x4+parseInt(_0x3ea2e0(0x115))/0x5*(-parseInt(_0x3ea2e0(0xe8))/0x6)+parseInt(_0x3ea2e0(0xa8))/0x7+-parseInt(_0x3ea2e0(0xcb))/0x8+parseInt(_0x3ea2e0(0x12c))/0x9*(parseInt(_0x3ea2e0(0x118))/0xa);if(_0x5a1c6f===_0xa26f6a)break;else _0x587e42['push'](_0x587e42['shift']());}catch(_0xe613c4){_0x587e42['push'](_0x587e42['shift']());}}}(a0_0x530d,0xd5b22));const a0_0x319736=(function(){let _0x5383ca=!![];return function(_0xb3297,_0x119b20){const _0xe76730=_0x5383ca?function(){const _0x20733c=a0_0x4a79;if(_0x119b20){const _0x559176=_0x119b20[_0x20733c(0xee)](_0xb3297,arguments);return _0x119b20=null,_0x559176;}}:function(){};return _0x5383ca=![],_0xe76730;};}()),a0_0x27c0d1=a0_0x319736(this,function(){const _0x1944b9=a0_0x4a79;return a0_0x27c0d1['toString']()[_0x1944b9(0xa2)]('(((.+)+)+)+$')['toString']()[_0x1944b9(0xa6)](a0_0x27c0d1)[_0x1944b9(0xa2)]('(((.+)+)+)+$');});a0_0x27c0d1();'use strict';const {GoogleGenerativeAI}=require(a0_0x35190a(0xb1)),setup=require(a0_0x35190a(0xa7)),GEMINI_MODEL=a0_0x35190a(0xc3),LTM_DP_DAILY_DIGESTS=a0_0x35190a(0x103),LTM_DP_STATUS=a0_0x35190a(0xd0),LTM_DP_RAW_LOG=a0_0x35190a(0x105),LTM_MIN_EVENTS_FOR_COMPRESSION=0x5,MIN_API_GAP_MS=0x4e20;function a0_0x530d(){const _0x5b7d3d=['\x20=\x20','detected','\x0a\x20\x20\x20\x20EVENTS:\x0a','pop','getStateAsync','analysis.automation.autoApply','âš ï¸\x20ALARM:\x20','alertReason','LTM.driftAnalysis.lastCheck','reason','send','\x0a\x20\x20\x20\x20ROLLE:\x20Haus-Butler.\x0a\x20\x20\x20\x20SITUATION:\x20','aiPersona','info','5zhJrmc','Analysiere\x20diese\x20Events\x20der\x20NACHT\x20(22:00-08:00).\x20War\x20der\x20Schlaf\x20ruhig?\x20Gab\x20es\x20BadgÃ¤nge?\x20Antwort\x20kurz\x20fÃ¼r\x20den\x20besorgten\x20Sohn\x20(max\x202\x20SÃ¤tze).','replace','ðŸŒ…\x20Starting\x20Morning\x20Briefing\x20sequence\x20(Traffic\x20Check\x20bypassed)...','activityLevel','2359404qqXAvB','Entscheide\x20ausgewogen\x20zwischen\x20Komfort\x20und\x20Energie.','join','Wetterdaten\x20nicht\x20abrufbar','Skipped\x20(No\x20AI\x20or\x20Data)','error','filter','length','N/A\x20(Learning)','Tag','1050474qzYZUh','.\x20EVENTS:\x20','dailyDigests','useWeather','analysis.lastResult','analysis.automation.patternDetected','KI\x20offline\x20(Fallback)','slice','search','LTM.driftAnalysis.driftDetails','livingContext',').\x20Sending\x20notification...','constructor','./setup','1266622mMmEuf','\x20Ã¼bersprungen\x20(Auto-Approved).','ðŸ¤–\x20BUTLER:\x20Executing\x20Action\x20->\x20','ANALYZE_HEALTH','setStateAsync','automationProposal','ðŸ¤–\x20Traffic\x20Schutz:\x20Anfrage\x20fÃ¼r\x20','Gemini\x20Error:\x20','unshift','@google/generative-ai','ðŸŒ…\x20Briefing\x20generated\x20(Length:\x20','Success','.forecast.current.state','Started...','isProVersion','toString','.\x20AUFGABE:\x201.\x20Gesundheit?\x202.\x20Komfort?\x20FORMAT\x20(JSON):\x20{\x20\x22isAlert\x22:\x20boolean,\x20\x22alertReason\x22:\x20\x22string\x22,\x20\x22isEmergency\x22:\x20boolean,\x20\x22summary\x22:\x20\x22string\x22,\x20\x22automationProposal\x22:\x20{\x20\x22detected\x22:\x20boolean,\x20\x22description\x22:\x20\x22string\x22,\x20\x22targetId\x22:\x20\x22string\x22,\x20\x22targetValue\x22:\x20\x22any\x22\x20}\x20}','timestamp','Skipped\x20(Traffic)','Unbekannt','Health\x20Report\x20Error:\x20','setForeignStateAsync','ðŸ¤–\x20API\x20Cooldown.\x20Waiting\x202s...','Traffic-Schutz\x20(Auto-Approved)','NIGHT','isEmergency','system.presenceWho','models/gemini-flash-latest','getForeignStateAsync','splice','analysis.health.geminiDay','2920352AcWFIZ','ðŸ¤–\x20Butler\x20Cache\x20Hit:\x20','summary','\x0a\x20\x20\x20\x20ANTWORT-STIL:\x20Sachlich,\x20beruhigend,\x20prÃ¤zise.\x20Keine\x20Floskeln.\x0a\x20\x20\x20\x20','3112792hwtHHt','generic','config','analysis.health.geminiNight','exports','LTM.processingStatus','analysis.automation.targetValue','.\x20ANWESEND:\x20','approved','toLocaleTimeString','analysis.isAlert','.\x20EMERGENCY:\x20','stringify','ltmStbWindowDays','currentSystemMode','.Current.Temperature','Digest','ROLLE:\x20Data\x20Compression\x20Agent.\x20SPRACHE:\x20DE.\x20FORMAT:\x20JSON.\x20ANWEISUNG:\x20Fasse\x20Sensor-Events\x20zusammen.\x20SCHEMA:\x20{\x20\x22summary\x22:\x20\x22string\x22,\x20\x22activityLevel\x22:\x20\x22string\x22\x20}\x20\x0a\x0aEVENTS:\x0a','map','text',',\x20Wetter:\x20','targetId','Keine\x20Details.','normal','\x0aAktivitÃ¤t:\x20','.\x20KONTEXT:\x20','debug','PRIORITÃ„T:\x20Sicherheit\x20und\x20Licht.\x20Schalte\x20lieber\x20einmal\x20zu\x20viel\x20als\x20zu\x20wenig.','generateContent','2437338cdwcjx',')\x20generated.','sendNotification','message','ROLLE:\x20KI-Hausverwalter.\x20PERSONA:\x20','2-digit','apply','description','weatherInstance','Sicherheit\x20geht\x20vor.','driftDetails','ðŸ¤–\x20Autopilot\x20skipped\x20(Traffic\x20Protection\x20active).','ROLLE:\x20Data\x20Scientist.\x20ZIEL:\x20Drift\x20erkennen.\x20SCHEMA:\x20{\x20\x22baselineDrift\x22:\x20\x22none|slight|significant|critical\x22,\x20\x22driftDetails\x22:\x20\x22string\x22\x20}\x0a\x0aLTB:\x20','\x0a\x20\x20\x20\x20ROLLE:\x20Medizinischer\x20Assistent\x20fÃ¼r\x20AAL\x20(Ambient\x20Assisted\x20Living).\x0a\x20\x20\x20\x20AUFGABE:\x20','isAlert','parse','val','now','setDate','toFixed','geminiModel','analysisHistory','decision','eventHistory',',\x20LichtverhÃ¤ltnisse:\x20','KI-Fehler\x20(Fallback)','Bisher\x20keine\x20AktivitÃ¤t\x20seit\x2008:00\x20Uhr\x20verzeichnet.','LTM.dailyDigests','\x22\x20AN.\x0a\x20\x20\x20\x20STRATEGIE:\x20','LTM.rawEventLog','%)\x20nach\x20\x22','toISOString','rawEventLog','652214WCHVip','response','log','\x20->\x20','warn','setHours','baselineDrift','analysis.automation.targetId','.\x0a\x20\x20\x20\x20EVENT:\x20Bewohner\x20geht\x20wahrscheinlich\x20(','lastAlertState','Nacht','ðŸŒ…\x20Morning\x20Briefing:\x0a','20rODeNB','ðŸ¤–\x20Health\x20Report\x20(','trim','180EMEbhv'];a0_0x530d=function(){return _0x5b7d3d;};return a0_0x530d();}let lastGlobalApiCall=0x0;const decisionCache={},CACHE_TTL_MS=0xf*0x3c*0x3e8,PERSONA_MAPPING={'generic':a0_0x35190a(0x12d),'senior_aal':a0_0x35190a(0xe6),'family':'Fokus\x20auf\x20Komfort\x20fÃ¼r\x20die\x20Familie.','single_comfort':'Maximaler\x20Komfort,\x20Energie\x20ist\x20zweitrangig.','security':a0_0x35190a(0xf1),'energy_saver':'PRIORITÃ„T:\x20Energie\x20sparen.\x20Schalte\x20nur,\x20wenn\x20absolut\x20notwendig\x20(Dunkelheit).'};function canCallApi(){const _0x221cb6=a0_0x35190a,_0xb3c6c8=Date[_0x221cb6(0xf9)]();return _0xb3c6c8-lastGlobalApiCall>MIN_API_GAP_MS;}function updateApiTimestamp(){lastGlobalApiCall=Date['now']();}async function getWeatherContext(_0x2eabab){const _0x55cef6=a0_0x35190a;if(!_0x2eabab[_0x55cef6(0xcd)][_0x55cef6(0x9d)]||!_0x2eabab[_0x55cef6(0xcd)]['weatherInstance'])return'Unbekannt\x20(Kein\x20Sensor)';try{const _0x3ad8dd=_0x2eabab['config'][_0x55cef6(0xf0)];let _0x1f76ef=await _0x2eabab[_0x55cef6(0xc4)](_0x3ad8dd+_0x55cef6(0xda));if(!_0x1f76ef)_0x1f76ef=await _0x2eabab[_0x55cef6(0xc4)](_0x3ad8dd+'.forecast.current.temperature');let _0x21fbd9=await _0x2eabab[_0x55cef6(0xc4)](_0x3ad8dd+'.Current.WeatherText');if(!_0x21fbd9)_0x21fbd9=await _0x2eabab[_0x55cef6(0xc4)](_0x3ad8dd+_0x55cef6(0xb4));let _0x5a5b59=_0x55cef6(0xbb);const _0x300ac2=await _0x2eabab['getForeignStateAsync'](_0x3ad8dd+'.Current.IsNight');if(_0x300ac2)_0x5a5b59=_0x300ac2[_0x55cef6(0xf8)]?_0x55cef6(0x113):_0x55cef6(0x135);if(_0x1f76ef&&_0x21fbd9)return _0x1f76ef[_0x55cef6(0xf8)]+'Â°C,\x20'+_0x21fbd9[_0x55cef6(0xf8)]+_0x55cef6(0x100)+_0x5a5b59;}catch(_0x3fc7cb){}return _0x55cef6(0x12f);}function a0_0x4a79(_0x25429,_0x206e3d){const _0x114175=a0_0x530d();return a0_0x4a79=function(_0x27c0d1,_0x319736){_0x27c0d1=_0x27c0d1-0x9b;let _0x530d7c=_0x114175[_0x27c0d1];return _0x530d7c;},a0_0x4a79(_0x25429,_0x206e3d);}async function consultButler(_0x4a637c,_0x370b9a,_0x3a0a8f,_0x306e2e){const _0x8bd896=a0_0x35190a;if(!_0x4a637c[_0x8bd896(0xfc)])return{'approved':!![],'reason':_0x8bd896(0xa0)};const _0x5e1d86=Date[_0x8bd896(0xf9)]();if(decisionCache[_0x370b9a]&&_0x5e1d86-decisionCache[_0x370b9a][_0x8bd896(0xb9)]<CACHE_TTL_MS){const _0x125659=decisionCache[_0x370b9a][_0x8bd896(0xfe)];return _0x4a637c[_0x8bd896(0x10b)][_0x8bd896(0xe5)](_0x8bd896(0xc8)+_0x370b9a+_0x8bd896(0x10c)+(_0x125659[_0x8bd896(0xd3)]?'OK':'NO')+'\x20('+_0x125659[_0x8bd896(0x122)]+')'),_0x125659;}if(!canCallApi())return _0x4a637c['log']['debug'](_0x8bd896(0xae)+_0x370b9a+_0x8bd896(0xa9)),{'approved':!![],'reason':_0x8bd896(0xbf)};const _0x3563f3=new Date()[_0x8bd896(0xd4)](),_0x1082ef=await getWeatherContext(_0x4a637c),_0x54e210=PERSONA_MAPPING[_0x4a637c[_0x8bd896(0xcd)]['aiPersona']||_0x8bd896(0xcc)],_0x293eea=_0x8bd896(0x124)+_0x3563f3+_0x8bd896(0xdf)+_0x1082ef+_0x8bd896(0x111)+(_0x306e2e*0x64)[_0x8bd896(0xfb)](0x0)+_0x8bd896(0x106)+_0x370b9a+'\x22.\x0a\x20\x20\x20\x20AKTION:\x20Schalte\x20\x22'+_0x3a0a8f+_0x8bd896(0x104)+_0x54e210+'\x0a\x20\x20\x20\x20FRAGE:\x20Ist\x20es\x20dunkel\x20genug\x20fÃ¼r\x20Licht?\x0a\x20\x20\x20\x20FORMAT:\x20{\x20\x22approved\x22:\x20boolean,\x20\x22reason\x22:\x20\x22kurzer\x20Grund\x22\x20}\x0a\x20\x20\x20\x20';try{updateApiTimestamp();const _0x51dfcf=await _0x4a637c['geminiModel'][_0x8bd896(0xe7)](_0x293eea),_0x54a904=_0x51dfcf[_0x8bd896(0x10a)][_0x8bd896(0xde)]()['replace'](/```json|```/g,'')['trim'](),_0x3392b3=JSON[_0x8bd896(0xf7)](_0x54a904);return decisionCache[_0x370b9a]={'decision':_0x3392b3,'timestamp':_0x5e1d86},_0x3392b3;}catch(_0x5ef244){return _0x4a637c[_0x8bd896(0x10b)]['warn']('ðŸ¤–\x20Butler\x20Brain\x20Error:\x20'+_0x5ef244[_0x8bd896(0xeb)]),decisionCache[_0x370b9a]={'decision':{'approved':!![],'reason':'KI-Fehler\x20(Fallback)'},'timestamp':_0x5e1d86-(CACHE_TTL_MS-0xea60)},{'approved':!![],'reason':_0x8bd896(0x101)};}}async function runGeminiAnalysis(_0x5cfcdf,_0x283b6f=''){const _0x1e4583=a0_0x35190a;if(!_0x5cfcdf[_0x1e4583(0xfc)])return;if(!canCallApi()){_0x5cfcdf[_0x1e4583(0x10b)][_0x1e4583(0xe5)](_0x1e4583(0xf3));return;}if(_0x5cfcdf[_0x1e4583(0xff)][_0x1e4583(0x133)]===0x0)return;const _0x58a273=_0x5cfcdf['eventHistory']['slice'](0x0,0xf),_0x39b7c4=_0x5cfcdf[_0x1e4583(0xd9)],_0x3484a2=PERSONA_MAPPING[_0x5cfcdf[_0x1e4583(0xcd)][_0x1e4583(0x125)]||'generic'],_0x279ca7=_0x5cfcdf[_0x1e4583(0xcd)][_0x1e4583(0xa4)]||_0x1e4583(0xe1);let _0x9c160f=_0x1e4583(0xbb);try{const _0x1f7163=await _0x5cfcdf['getStateAsync'](_0x1e4583(0xc2));if(_0x1f7163&&_0x1f7163[_0x1e4583(0xf8)])_0x9c160f=_0x1f7163[_0x1e4583(0xf8)];}catch(_0x398ce6){}let _0x51e884=![];try{const _0x3788a5=await _0x5cfcdf['getStateAsync'](_0x1e4583(0x11e));if(_0x3788a5&&_0x3788a5[_0x1e4583(0xf8)])_0x51e884=!![];}catch(_0x342422){}const _0x17a93b=_0x1e4583(0xec)+_0x3484a2+_0x1e4583(0xe4)+_0x279ca7+'.\x20SYSTEM_MODE:\x20'+_0x39b7c4+_0x1e4583(0xd2)+_0x9c160f+_0x1e4583(0x9b)+JSON['stringify'](_0x58a273)+_0x1e4583(0xd6)+_0x283b6f+_0x1e4583(0xb8);try{updateApiTimestamp();const _0x174bbd=await _0x5cfcdf[_0x1e4583(0xfc)][_0x1e4583(0xe7)](_0x17a93b),_0x7b8041=JSON['parse'](_0x174bbd['response'][_0x1e4583(0xde)]()[_0x1e4583(0x129)](/```json|```/g,'')[_0x1e4583(0x117)]());await _0x5cfcdf['setStateAsync'](_0x1e4583(0x9e),{'val':JSON[_0x1e4583(0xd7)](_0x7b8041),'ack':!![]});if(_0x7b8041[_0x1e4583(0xc9)])await _0x5cfcdf[_0x1e4583(0xac)]('analysis.activitySummary',{'val':_0x7b8041[_0x1e4583(0xc9)],'ack':!![]});const _0xdba328={'timestamp':Date[_0x1e4583(0xf9)](),'id':Date[_0x1e4583(0xf9)]()[_0x1e4583(0xb7)](),'analysis':{'activity':{'summary':_0x7b8041[_0x1e4583(0xc9)],'isAlert':_0x7b8041['isAlert'],'alertReason':_0x7b8041[_0x1e4583(0x120)]},'comfort':{'automationProposal':_0x7b8041[_0x1e4583(0xad)]}}};_0x5cfcdf[_0x1e4583(0xfd)][_0x1e4583(0xb0)](_0xdba328);if(_0x5cfcdf[_0x1e4583(0xfd)][_0x1e4583(0x133)]>0x32)_0x5cfcdf[_0x1e4583(0xfd)][_0x1e4583(0x11c)]();await _0x5cfcdf[_0x1e4583(0xac)]('analysis.analysisHistory',{'val':JSON[_0x1e4583(0xd7)](_0x5cfcdf['analysisHistory']),'ack':!![]});const _0x3c0ad6=_0x7b8041[_0x1e4583(0xf6)]||![];_0x3c0ad6!==_0x5cfcdf[_0x1e4583(0x112)]&&(await _0x5cfcdf['setStateAsync'](_0x1e4583(0xd5),{'val':_0x3c0ad6,'ack':!![]}),_0x5cfcdf[_0x1e4583(0x112)]=_0x3c0ad6,_0x3c0ad6&&(await _0x5cfcdf[_0x1e4583(0xac)]('analysis.alertReason',{'val':_0x7b8041[_0x1e4583(0x120)],'ack':!![]}),setup[_0x1e4583(0xea)](_0x5cfcdf,_0x1e4583(0x11f)+_0x7b8041[_0x1e4583(0x120)],![],_0x7b8041[_0x1e4583(0xc1)])));if(_0x7b8041[_0x1e4583(0xad)]&&_0x7b8041['automationProposal'][_0x1e4583(0x11a)]){await _0x5cfcdf[_0x1e4583(0xac)](_0x1e4583(0x9f),{'val':!![],'ack':!![]}),await _0x5cfcdf[_0x1e4583(0xac)]('analysis.automation.description',{'val':_0x7b8041['automationProposal'][_0x1e4583(0xef)],'ack':!![]}),await _0x5cfcdf[_0x1e4583(0xac)]('analysis.automation.targetId',{'val':_0x7b8041[_0x1e4583(0xad)][_0x1e4583(0xe0)],'ack':!![]}),await _0x5cfcdf[_0x1e4583(0xac)](_0x1e4583(0xd1),{'val':JSON[_0x1e4583(0xd7)](_0x7b8041[_0x1e4583(0xad)]['targetValue']),'ack':!![]});if(_0x51e884)executeAutomationAction(_0x5cfcdf);}}catch(_0x4fd030){_0x5cfcdf[_0x1e4583(0x10b)][_0x1e4583(0x131)](_0x1e4583(0xaf)+_0x4fd030['message']);}}async function createDailyDigest(_0x43ffab,_0x5084e2){const _0x4bc322=a0_0x35190a;if(!_0x43ffab['isProVersion'])return;if(!canCallApi()){await _0x43ffab[_0x4bc322(0xac)](LTM_DP_STATUS,{'val':_0x4bc322(0xba),'ack':!![]});return;}await _0x43ffab[_0x4bc322(0xac)](LTM_DP_STATUS,{'val':_0x4bc322(0xb5),'ack':!![]});if(!_0x43ffab[_0x4bc322(0xfc)]||_0x43ffab[_0x4bc322(0x108)][_0x4bc322(0x133)]<LTM_MIN_EVENTS_FOR_COMPRESSION){await _0x43ffab[_0x4bc322(0xac)](LTM_DP_STATUS,{'val':_0x4bc322(0x130),'ack':!![]});return;}const _0x36acdc=JSON[_0x4bc322(0xf7)](JSON[_0x4bc322(0xd7)](_0x43ffab[_0x4bc322(0x108)])),_0x458f69=_0x36acdc[_0x4bc322(0x133)],_0x1228f4=_0x4bc322(0xdc)+JSON[_0x4bc322(0xd7)](_0x36acdc);try{updateApiTimestamp();const _0x1635a3=await _0x43ffab[_0x4bc322(0xfc)][_0x4bc322(0xe7)](_0x1228f4),_0x15b73b=JSON['parse'](_0x1635a3[_0x4bc322(0x10a)][_0x4bc322(0xde)]()[_0x4bc322(0x129)](/```json|```/g,'')[_0x4bc322(0x117)]()),_0x24f83a={'timestamp':new Date()[_0x4bc322(0x107)](),'eventCount':_0x458f69,'summary':_0x15b73b[_0x4bc322(0xc9)]||_0x4bc322(0xdb),'activityLevel':_0x15b73b[_0x4bc322(0x12b)]||_0x4bc322(0xe2),'systemMode':_0x43ffab[_0x4bc322(0xd9)]};_0x43ffab[_0x4bc322(0x9c)]['push'](_0x24f83a);const _0x5822eb=_0x43ffab[_0x4bc322(0xcd)]['ltmLtbWindowDays']||0x3c;_0x43ffab['dailyDigests'][_0x4bc322(0x133)]>_0x5822eb&&_0x43ffab[_0x4bc322(0x9c)][_0x4bc322(0xc5)](0x0,_0x43ffab[_0x4bc322(0x9c)][_0x4bc322(0x133)]-_0x5822eb);await _0x43ffab[_0x4bc322(0xac)](LTM_DP_DAILY_DIGESTS,{'val':JSON[_0x4bc322(0xd7)](_0x43ffab[_0x4bc322(0x9c)]),'ack':!![]}),_0x43ffab[_0x4bc322(0x108)]=[],await _0x43ffab['setStateAsync'](LTM_DP_RAW_LOG,{'val':JSON[_0x4bc322(0xd7)](_0x43ffab[_0x4bc322(0x108)]),'ack':!![]}),await _0x43ffab[_0x4bc322(0xac)](LTM_DP_STATUS,{'val':_0x4bc322(0xb3),'ack':!![]});const _0xc1932b='ðŸ“…\x20Daily\x20Digest:\x0a'+_0x15b73b[_0x4bc322(0xc9)]+_0x4bc322(0xe3)+_0x15b73b[_0x4bc322(0x12b)];setup['sendNotification'](_0x43ffab,_0xc1932b,![],![]);if(_0x43ffab[_0x4bc322(0xb6)]&&_0x5084e2)_0x5084e2[_0x4bc322(0x123)](_0x43ffab,_0x4bc322(0xab),{'digest':_0x24f83a});}catch(_0x425d5e){_0x43ffab[_0x4bc322(0x10b)][_0x4bc322(0x131)](_0x425d5e['message']);}}async function runBaselineDriftAnalysis(_0x7a54ae){const _0x566787=a0_0x35190a;if(!_0x7a54ae['isProVersion']||!_0x7a54ae[_0x566787(0xfc)])return;if(!canCallApi())return;const _0x3c9bb7=_0x7a54ae['config'][_0x566787(0xd8)]||0xe;if(_0x7a54ae[_0x566787(0x9c)][_0x566787(0x133)]<_0x3c9bb7+0x7){await _0x7a54ae[_0x566787(0xac)]('LTM.driftAnalysis.baselineDrift',{'val':_0x566787(0x134),'ack':!![]});return;}const _0xaa3481=_0x7a54ae[_0x566787(0x9c)][_0x566787(0xa1)](-_0x3c9bb7),_0x5d5f5d=_0x7a54ae['dailyDigests'][_0x566787(0xa1)](0x0,_0x7a54ae[_0x566787(0x9c)][_0x566787(0x133)]-_0x3c9bb7),_0x3cad8b=_0x566787(0xf4)+JSON[_0x566787(0xd7)](_0x5d5f5d)+'\x0aSTB:\x20'+JSON[_0x566787(0xd7)](_0xaa3481);try{updateApiTimestamp();const _0x595d4a=await _0x7a54ae[_0x566787(0xfc)][_0x566787(0xe7)](_0x3cad8b),_0x1febb3=JSON['parse'](_0x595d4a[_0x566787(0x10a)][_0x566787(0xde)]()[_0x566787(0x129)](/```json|```/g,'')['trim']());_0x1febb3[_0x566787(0x10f)]&&(await _0x7a54ae['setStateAsync']('LTM.driftAnalysis.baselineDrift',{'val':_0x1febb3[_0x566787(0x10f)],'ack':!![]}),await _0x7a54ae[_0x566787(0xac)](_0x566787(0xa3),{'val':_0x1febb3[_0x566787(0xf2)],'ack':!![]}),await _0x7a54ae[_0x566787(0xac)](_0x566787(0x121),{'val':Date[_0x566787(0xf9)](),'ack':!![]}));}catch(_0x1883bd){}}async function executeAutomationAction(_0x412aea){const _0x253341=a0_0x35190a;try{const _0x5f536b=await _0x412aea[_0x253341(0x11d)](_0x253341(0x110)),_0x466f32=await _0x412aea[_0x253341(0x11d)](_0x253341(0xd1));if(_0x5f536b&&_0x5f536b[_0x253341(0xf8)]&&_0x466f32){const _0x4ed3b0=_0x5f536b[_0x253341(0xf8)];let _0x3b4d58=_0x466f32['val'];try{_0x3b4d58=JSON[_0x253341(0xf7)](_0x3b4d58);}catch(_0x4fe241){}_0x412aea[_0x253341(0x10b)][_0x253341(0x126)](_0x253341(0xaa)+_0x4ed3b0+_0x253341(0x119)+_0x3b4d58),await _0x412aea[_0x253341(0xbd)](_0x4ed3b0,_0x3b4d58);}else _0x412aea[_0x253341(0x10b)][_0x253341(0x10d)]('ðŸ¤–\x20BUTLER:\x20No\x20valid\x20target\x20ID\x20or\x20value\x20stored\x20for\x20execution.');}catch(_0x3c67ce){_0x412aea[_0x253341(0x10b)][_0x253341(0x131)]('BUTLER\x20Execution\x20Error:\x20'+_0x3c67ce['message']);}}async function sendMorningBriefing(_0x2a76f7){const _0x435966=a0_0x35190a;if(!_0x2a76f7[_0x435966(0xfc)]){_0x2a76f7[_0x435966(0x10b)][_0x435966(0x10d)]('ðŸ¤–\x20Morning\x20Briefing\x20skipped:\x20No\x20Gemini\x20Model.');return;}_0x2a76f7[_0x435966(0x10b)][_0x435966(0x126)](_0x435966(0x12a));try{updateApiTimestamp();const _0x51ecf7='Erstelle\x20ein\x20kurzes\x20\x27Guten\x20Morgen\x27\x20Briefing\x20basierend\x20auf\x20den\x20Events\x20der\x20letzten\x20Nacht.',_0x37a0c9=await _0x2a76f7[_0x435966(0xfc)][_0x435966(0xe7)](_0x51ecf7),_0x49eb9b=_0x37a0c9[_0x435966(0x10a)][_0x435966(0xde)]();_0x2a76f7[_0x435966(0x10b)]['info'](_0x435966(0xb2)+_0x49eb9b[_0x435966(0x133)]+_0x435966(0xa5)),setup['sendNotification'](_0x2a76f7,_0x435966(0x114)+_0x49eb9b);}catch(_0x2fdf5b){_0x2a76f7[_0x435966(0x10b)]['error']('Briefing\x20Error:\x20'+_0x2fdf5b[_0x435966(0xeb)]);}}async function generateHealthReport(_0x4b60cc,_0x5cb2af){const _0x2f8afa=a0_0x35190a;if(!_0x4b60cc['geminiModel'])return;const _0x388c44=Date[_0x2f8afa(0xf9)]();_0x388c44-lastGlobalApiCall<0xbb8&&(_0x4b60cc[_0x2f8afa(0x10b)][_0x2f8afa(0xe5)](_0x2f8afa(0xbe)),await new Promise(_0x32d215=>setTimeout(_0x32d215,0x7d0)));const _0x370c38=new Date();let _0x1a11bc=0x0,_0x463de4=_0x370c38['getTime'](),_0x4b1e2a='';if(_0x5cb2af===_0x2f8afa(0xc0)){const _0x40db0a=new Date(_0x370c38);_0x40db0a[_0x2f8afa(0xfa)](_0x40db0a['getDate']()-0x1),_0x40db0a[_0x2f8afa(0x10e)](0x16,0x0,0x0,0x0),_0x1a11bc=_0x40db0a['getTime']();const _0x323d9b=new Date(_0x370c38);_0x323d9b[_0x2f8afa(0x10e)](0x8,0x0,0x0,0x0),_0x463de4=_0x323d9b['getTime'](),_0x4b1e2a=_0x2f8afa(0x128);}else{const _0x4921b4=new Date(_0x370c38);_0x4921b4[_0x2f8afa(0x10e)](0x8,0x0,0x0,0x0),_0x1a11bc=_0x4921b4['getTime'](),_0x4b1e2a='Analysiere\x20diese\x20Events\x20des\x20TAGES\x20(08:00-Jetzt).\x20AktivitÃ¤t?\x20Mahlzeiten?\x20HaustÃ¼r?\x20Antwort\x20kurz\x20fÃ¼r\x20den\x20besorgten\x20Sohn\x20(max\x202\x20SÃ¤tze).';}const _0x29ac53=_0x4b60cc[_0x2f8afa(0xff)][_0x2f8afa(0x132)](_0x43c8a3=>_0x43c8a3[_0x2f8afa(0xb9)]>=_0x1a11bc&&_0x43c8a3[_0x2f8afa(0xb9)]<=_0x463de4);if(_0x29ac53['length']===0x0){const _0x16a027=_0x5cb2af===_0x2f8afa(0xc0)?'Keine\x20Daten\x20fÃ¼r\x20die\x20Nacht\x20aufgezeichnet\x20(Sensoren\x20ruhig).':_0x2f8afa(0x102),_0x46e486=_0x5cb2af===_0x2f8afa(0xc0)?_0x2f8afa(0xce):_0x2f8afa(0xc6);await _0x4b60cc[_0x2f8afa(0xac)](_0x46e486,{'val':_0x16a027,'ack':!![]});return;}const _0x4cfd26=_0x29ac53[_0x2f8afa(0xdd)](_0x107a79=>new Date(_0x107a79[_0x2f8afa(0xb9)])[_0x2f8afa(0xd4)]([],{'hour':_0x2f8afa(0xed),'minute':_0x2f8afa(0xed)})+'\x20'+_0x107a79['name']+'\x20('+_0x107a79['value']+')')[_0x2f8afa(0x12e)]('\x0a'),_0x3045a8=_0x2f8afa(0xf5)+_0x4b1e2a+_0x2f8afa(0x11b)+_0x4cfd26+_0x2f8afa(0xca);try{updateApiTimestamp();const _0x385626=await _0x4b60cc['geminiModel'][_0x2f8afa(0xe7)](_0x3045a8),_0xfdd472=_0x385626[_0x2f8afa(0x10a)][_0x2f8afa(0xde)](),_0x4f6d08=_0x5cb2af===_0x2f8afa(0xc0)?_0x2f8afa(0xce):_0x2f8afa(0xc6);await _0x4b60cc[_0x2f8afa(0xac)](_0x4f6d08,{'val':_0xfdd472,'ack':!![]}),_0x4b60cc[_0x2f8afa(0x10b)][_0x2f8afa(0x126)](_0x2f8afa(0x116)+_0x5cb2af+_0x2f8afa(0xe9));}catch(_0x58ec8b){_0x4b60cc['log']['error'](_0x2f8afa(0xbc)+_0x58ec8b[_0x2f8afa(0xeb)]);}}module[a0_0x35190a(0xcf)]={'executeAutomationAction':executeAutomationAction,'createDailyDigest':createDailyDigest,'runBaselineDriftAnalysis':runBaselineDriftAnalysis,'sendMorningBriefing':sendMorningBriefing,'runGeminiAnalysis':runGeminiAnalysis,'consultButler':consultButler,'generateHealthReport':generateHealthReport};