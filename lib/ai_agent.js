function a0_0x4c8d(){const _0x3ac058=['ðŸ¤–\x20Butler\x20Brain\x20Error:\x20','Briefing\x20Error:\x20',',\x20Wetter:\x20','aiPersona','analysis.activitySummary','toString','PRIORITÃ„T:\x20Sicherheit\x20und\x20Licht.\x20Schalte\x20lieber\x20einmal\x20zu\x20viel\x20als\x20zu\x20wenig.','pop','lastAlertState','300dvHTSG','\x0a\x20\x20\x20\x20FRAGE:\x20Ist\x20es\x20dunkel\x20genug\x20fÃ¼r\x20Licht?\x0a\x20\x20\x20\x20FORMAT:\x20{\x20\x22approved\x22:\x20boolean,\x20\x22reason\x22:\x20\x22kurzer\x20Grund\x22\x20}\x0a\x20\x20\x20\x20','filter','4552216mgyofg','Started...','Skipped\x20(Traffic)','2-digit','join','slice','summary','getDate','driftDetails','search','trim','1263984mGkVel','length','2170672ZuFaQx','ANALYZE_HEALTH','Analysiere\x20diese\x20Events\x20des\x20TAGES\x20(08:00-Jetzt).\x20AktivitÃ¤t?\x20Mahlzeiten?\x20HaustÃ¼r?\x20Antwort\x20kurz\x20fÃ¼r\x20den\x20besorgten\x20Sohn\x20(max\x202\x20SÃ¤tze).','Traffic-Schutz\x20(Auto-Approved)','Nacht','analysis.automation.autoApply','Unbekannt\x20(Kein\x20Sensor)','\x0a\x20\x20\x20\x20ROLLE:\x20Medizinischer\x20Assistent\x20fÃ¼r\x20AAL\x20(Ambient\x20Assisted\x20Living).\x0a\x20\x20\x20\x20AUFGABE:\x20','getStateAsync','Gemini\x20Error:\x20','Health\x20Report\x20Error:\x20','setStateAsync','14fubIvX','generateContent','\x22.\x0a\x20\x20\x20\x20AKTION:\x20Schalte\x20\x22','sendNotification','activityLevel','apply','generic','isEmergency','(((.+)+)+)+$','PRIORITÃ„T:\x20Energie\x20sparen.\x20Schalte\x20nur,\x20wenn\x20absolut\x20notwendig\x20(Dunkelheit).','80148FRyUlk','approved','log','.forecast.current.temperature','getForeignStateAsync','stringify','dailyDigests','eventHistory','currentSystemMode','LTM.driftAnalysis.driftDetails','Maximaler\x20Komfort,\x20Energie\x20ist\x20zweitrangig.','.\x20AUFGABE:\x201.\x20Gesundheit?\x202.\x20Komfort?\x20FORMAT\x20(JSON):\x20{\x20\x22isAlert\x22:\x20boolean,\x20\x22alertReason\x22:\x20\x22string\x22,\x20\x22isEmergency\x22:\x20boolean,\x20\x22summary\x22:\x20\x22string\x22,\x20\x22automationProposal\x22:\x20{\x20\x22detected\x22:\x20boolean,\x20\x22description\x22:\x20\x22string\x22,\x20\x22targetId\x22:\x20\x22string\x22,\x20\x22targetValue\x22:\x20\x22any\x22\x20}\x20}',').\x20Sending\x20notification...','Wetterdaten\x20nicht\x20abrufbar','name','getTime','system.presenceWho','ðŸ¤–\x20Health\x20Report\x20(','ROLLE:\x20Data\x20Compression\x20Agent.\x20SPRACHE:\x20DE.\x20FORMAT:\x20JSON.\x20ANWEISUNG:\x20Fasse\x20Sensor-Events\x20zusammen.\x20SCHEMA:\x20{\x20\x22summary\x22:\x20\x22string\x22,\x20\x22activityLevel\x22:\x20\x22string\x22\x20}\x20\x0a\x0aEVENTS:\x0a','timestamp','detected','weatherInstance','ðŸŒ…\x20Briefing\x20generated\x20(Length:\x20','@google/generative-ai','automationProposal','analysis.automation.targetId','rawEventLog','livingContext','ðŸ¤–\x20BUTLER:\x20Executing\x20Action\x20->\x20','exports','analysis.automation.description','âš ï¸\x20ALARM:\x20','Sicherheit\x20geht\x20vor.','analysis.automation.patternDetected','constructor','Unbekannt','LTM.driftAnalysis.baselineDrift','val','response','Keine\x20Details.','.\x20KONTEXT:\x20','12637850WRYHni','\x20->\x20','NIGHT','ðŸ¤–\x20Autopilot\x20skipped\x20(Traffic\x20Protection\x20active).','map','warn','.Current.IsNight','.\x0a\x20\x20\x20\x20EVENT:\x20Bewohner\x20geht\x20wahrscheinlich\x20(','ltmLtbWindowDays','LTM.rawEventLog','226910uQwlcv','parse','ROLLE:\x20KI-Hausverwalter.\x20PERSONA:\x20','baselineDrift','.forecast.current.state','analysis.health.geminiNight','isAlert','value','9qXvzEJ','ðŸ“…\x20Daily\x20Digest:\x0a','ðŸ¤–\x20Butler\x20Cache\x20Hit:\x20','analysis.lastResult','Analysiere\x20diese\x20Events\x20der\x20NACHT\x20(22:00-08:00).\x20War\x20der\x20Schlaf\x20ruhig?\x20Gab\x20es\x20BadgÃ¤nge?\x20Antwort\x20kurz\x20fÃ¼r\x20den\x20besorgten\x20Sohn\x20(max\x202\x20SÃ¤tze).','debug','targetValue','geminiModel','ðŸŒ…\x20Morning\x20Briefing:\x0a','targetId','\x22\x20AN.\x0a\x20\x20\x20\x20STRATEGIE:\x20','Digest','.\x20EMERGENCY:\x20','splice','config','error','174DCucxA','\x0aSTB:\x20','N/A\x20(Learning)','info','%)\x20nach\x20\x22','setDate','ltmStbWindowDays','now','Entscheide\x20ausgewogen\x20zwischen\x20Komfort\x20und\x20Energie.','.Current.WeatherText','analysisHistory','alertReason','196ooQAwW','ROLLE:\x20Data\x20Scientist.\x20ZIEL:\x20Drift\x20erkennen.\x20SCHEMA:\x20{\x20\x22baselineDrift\x22:\x20\x22none|slight|significant|critical\x22,\x20\x22driftDetails\x22:\x20\x22string\x22\x20}\x0a\x0aLTB:\x20','\x0a\x20\x20\x20\x20ROLLE:\x20Haus-Butler.\x0a\x20\x20\x20\x20SITUATION:\x20','\x20=\x20','isProVersion','\x0aAktivitÃ¤t:\x20','setHours','.\x20SYSTEM_MODE:\x20','analysis.health.geminiDay','KI\x20offline\x20(Fallback)','1469435fPcoSV','ðŸŒ…\x20Starting\x20Morning\x20Briefing\x20sequence\x20(Traffic\x20Check\x20bypassed)...','replace','text','message','toISOString','ðŸ¤–\x20Traffic\x20Schutz:\x20Anfrage\x20fÃ¼r\x20','\x0a\x20\x20\x20\x20EVENTS:\x0a','toLocaleTimeString','description','ðŸ¤–\x20BUTLER:\x20No\x20valid\x20target\x20ID\x20or\x20value\x20stored\x20for\x20execution.','KI-Fehler\x20(Fallback)'];a0_0x4c8d=function(){return _0x3ac058;};return a0_0x4c8d();}const a0_0x194582=a0_0x146e;(function(_0x5b5617,_0x180112){const _0x5ddd42=a0_0x146e,_0x468502=_0x5b5617();while(!![]){try{const _0x15473c=-parseInt(_0x5ddd42(0x1a7))/0x1+parseInt(_0x5ddd42(0x1a9))/0x2+parseInt(_0x5ddd42(0x1bf))/0x3*(-parseInt(_0x5ddd42(0x17a))/0x4)+parseInt(_0x5ddd42(0x156))/0x5*(-parseInt(_0x5ddd42(0x16e))/0x6)+parseInt(_0x5ddd42(0x1b5))/0x7*(-parseInt(_0x5ddd42(0x19c))/0x8)+parseInt(_0x5ddd42(0x15e))/0x9*(parseInt(_0x5ddd42(0x14c))/0xa)+-parseInt(_0x5ddd42(0x184))/0xb*(-parseInt(_0x5ddd42(0x199))/0xc);if(_0x15473c===_0x180112)break;else _0x468502['push'](_0x468502['shift']());}catch(_0x90bf44){_0x468502['push'](_0x468502['shift']());}}}(a0_0x4c8d,0xa182a));function a0_0x146e(_0x55dbbd,_0x58da66){const _0xd5ed1f=a0_0x4c8d();return a0_0x146e=function(_0x508365,_0x3166ab){_0x508365=_0x508365-0x13b;let _0x4c8d88=_0xd5ed1f[_0x508365];return _0x4c8d88;},a0_0x146e(_0x55dbbd,_0x58da66);}const a0_0x3166ab=(function(){let _0x5b081c=!![];return function(_0x384daa,_0x2b43db){const _0x15889d=_0x5b081c?function(){const _0x196a7b=a0_0x146e;if(_0x2b43db){const _0x394f1c=_0x2b43db[_0x196a7b(0x1ba)](_0x384daa,arguments);return _0x2b43db=null,_0x394f1c;}}:function(){};return _0x5b081c=![],_0x15889d;};}()),a0_0x508365=a0_0x3166ab(this,function(){const _0x3578bd=a0_0x146e;return a0_0x508365[_0x3578bd(0x195)]()['search'](_0x3578bd(0x1bd))['toString']()[_0x3578bd(0x145)](a0_0x508365)[_0x3578bd(0x1a5)](_0x3578bd(0x1bd));});a0_0x508365();'use strict';const {GoogleGenerativeAI}=require(a0_0x194582(0x1d6)),setup=require('./setup'),GEMINI_MODEL='models/gemini-flash-latest',LTM_DP_DAILY_DIGESTS='LTM.dailyDigests',LTM_DP_STATUS='LTM.processingStatus',LTM_DP_RAW_LOG=a0_0x194582(0x155),LTM_MIN_EVENTS_FOR_COMPRESSION=0x5,MIN_API_GAP_MS=0x4e20;let lastGlobalApiCall=0x0;const decisionCache={},CACHE_TTL_MS=0xf*0x3c*0x3e8,PERSONA_MAPPING={'generic':a0_0x194582(0x176),'senior_aal':a0_0x194582(0x196),'family':'Fokus\x20auf\x20Komfort\x20fÃ¼r\x20die\x20Familie.','single_comfort':a0_0x194582(0x1c9),'security':a0_0x194582(0x143),'energy_saver':a0_0x194582(0x1be)};function canCallApi(){const _0x4e7970=a0_0x194582,_0x88a821=Date[_0x4e7970(0x175)]();return _0x88a821-lastGlobalApiCall>MIN_API_GAP_MS;}function updateApiTimestamp(){const _0x29aebe=a0_0x194582;lastGlobalApiCall=Date[_0x29aebe(0x175)]();}async function getWeatherContext(_0x5cf324){const _0x5658cc=a0_0x194582;if(!_0x5cf324[_0x5658cc(0x16c)]['useWeather']||!_0x5cf324[_0x5658cc(0x16c)][_0x5658cc(0x1d4)])return _0x5658cc(0x1af);try{const _0x1fc0bb=_0x5cf324[_0x5658cc(0x16c)]['weatherInstance'];let _0x2dba98=await _0x5cf324[_0x5658cc(0x1c3)](_0x1fc0bb+'.Current.Temperature');if(!_0x2dba98)_0x2dba98=await _0x5cf324['getForeignStateAsync'](_0x1fc0bb+_0x5658cc(0x1c2));let _0x4f53bc=await _0x5cf324[_0x5658cc(0x1c3)](_0x1fc0bb+_0x5658cc(0x177));if(!_0x4f53bc)_0x4f53bc=await _0x5cf324[_0x5658cc(0x1c3)](_0x1fc0bb+_0x5658cc(0x15a));let _0xa9eaaf=_0x5658cc(0x146);const _0x3f6285=await _0x5cf324[_0x5658cc(0x1c3)](_0x1fc0bb+_0x5658cc(0x152));if(_0x3f6285)_0xa9eaaf=_0x3f6285[_0x5658cc(0x148)]?_0x5658cc(0x1ad):'Tag';if(_0x2dba98&&_0x4f53bc)return _0x2dba98[_0x5658cc(0x148)]+'Â°C,\x20'+_0x4f53bc[_0x5658cc(0x148)]+',\x20LichtverhÃ¤ltnisse:\x20'+_0xa9eaaf;}catch(_0x53a614){}return _0x5658cc(0x1cc);}async function consultButler(_0x51a061,_0xa40429,_0x5910ae,_0x509f3b){const _0x27d694=a0_0x194582;if(!_0x51a061['geminiModel'])return{'approved':!![],'reason':_0x27d694(0x183)};const _0x21d622=Date[_0x27d694(0x175)]();if(decisionCache[_0xa40429]&&_0x21d622-decisionCache[_0xa40429][_0x27d694(0x1d2)]<CACHE_TTL_MS){const _0x597f11=decisionCache[_0xa40429]['decision'];return _0x51a061[_0x27d694(0x1c1)][_0x27d694(0x163)](_0x27d694(0x160)+_0xa40429+_0x27d694(0x14d)+(_0x597f11[_0x27d694(0x1c0)]?'OK':'NO')+'\x20('+_0x597f11['reason']+')'),_0x597f11;}if(!canCallApi())return _0x51a061[_0x27d694(0x1c1)][_0x27d694(0x163)](_0x27d694(0x18a)+_0xa40429+'\x20Ã¼bersprungen\x20(Auto-Approved).'),{'approved':!![],'reason':_0x27d694(0x1ac)};const _0x3c6d9c=new Date()[_0x27d694(0x18c)](),_0x5ff0bc=await getWeatherContext(_0x51a061),_0x59c7a7=PERSONA_MAPPING[_0x51a061[_0x27d694(0x16c)][_0x27d694(0x193)]||_0x27d694(0x1bb)],_0x2a5fb1=_0x27d694(0x17c)+_0x3c6d9c+_0x27d694(0x192)+_0x5ff0bc+_0x27d694(0x153)+(_0x509f3b*0x64)['toFixed'](0x0)+_0x27d694(0x172)+_0xa40429+_0x27d694(0x1b7)+_0x5910ae+_0x27d694(0x168)+_0x59c7a7+_0x27d694(0x19a);try{updateApiTimestamp();const _0xb10266=await _0x51a061[_0x27d694(0x165)][_0x27d694(0x1b6)](_0x2a5fb1),_0x1752dd=_0xb10266[_0x27d694(0x149)][_0x27d694(0x187)]()[_0x27d694(0x186)](/```json|```/g,'')[_0x27d694(0x1a6)](),_0x136855=JSON[_0x27d694(0x157)](_0x1752dd);return decisionCache[_0xa40429]={'decision':_0x136855,'timestamp':_0x21d622},_0x136855;}catch(_0x2b2ffc){return _0x51a061[_0x27d694(0x1c1)]['warn'](_0x27d694(0x190)+_0x2b2ffc[_0x27d694(0x188)]),decisionCache[_0xa40429]={'decision':{'approved':!![],'reason':_0x27d694(0x18f)},'timestamp':_0x21d622-(CACHE_TTL_MS-0xea60)},{'approved':!![],'reason':_0x27d694(0x18f)};}}async function runGeminiAnalysis(_0x4b247b,_0x2b9136=''){const _0x31577e=a0_0x194582;if(!_0x4b247b['geminiModel'])return;if(!canCallApi()){_0x4b247b[_0x31577e(0x1c1)][_0x31577e(0x163)](_0x31577e(0x14f));return;}if(_0x4b247b['eventHistory'][_0x31577e(0x1a8)]===0x0)return;const _0x477592=_0x4b247b['eventHistory'][_0x31577e(0x1a1)](0x0,0xf),_0x31e1bd=_0x4b247b[_0x31577e(0x1c7)],_0x5984b2=PERSONA_MAPPING[_0x4b247b[_0x31577e(0x16c)]['aiPersona']||_0x31577e(0x1bb)],_0x3688cb=_0x4b247b[_0x31577e(0x16c)][_0x31577e(0x13e)]||_0x31577e(0x14a);let _0x561c0b='Unbekannt';try{const _0x549e0e=await _0x4b247b[_0x31577e(0x1b1)](_0x31577e(0x1cf));if(_0x549e0e&&_0x549e0e[_0x31577e(0x148)])_0x561c0b=_0x549e0e[_0x31577e(0x148)];}catch(_0x5162c3){}let _0x4307c6=![];try{const _0x57a922=await _0x4b247b['getStateAsync'](_0x31577e(0x1ae));if(_0x57a922&&_0x57a922['val'])_0x4307c6=!![];}catch(_0x586d92){}const _0x582162=_0x31577e(0x158)+_0x5984b2+_0x31577e(0x14b)+_0x3688cb+_0x31577e(0x181)+_0x31e1bd+'.\x20ANWESEND:\x20'+_0x561c0b+'.\x20EVENTS:\x20'+JSON[_0x31577e(0x1c4)](_0x477592)+_0x31577e(0x16a)+_0x2b9136+_0x31577e(0x1ca);try{updateApiTimestamp();const _0x3477bc=await _0x4b247b[_0x31577e(0x165)]['generateContent'](_0x582162),_0x317044=JSON[_0x31577e(0x157)](_0x3477bc[_0x31577e(0x149)][_0x31577e(0x187)]()['replace'](/```json|```/g,'')[_0x31577e(0x1a6)]());await _0x4b247b[_0x31577e(0x1b4)](_0x31577e(0x161),{'val':JSON['stringify'](_0x317044),'ack':!![]});if(_0x317044[_0x31577e(0x1a2)])await _0x4b247b[_0x31577e(0x1b4)](_0x31577e(0x194),{'val':_0x317044[_0x31577e(0x1a2)],'ack':!![]});const _0x45c913={'timestamp':Date[_0x31577e(0x175)](),'id':Date[_0x31577e(0x175)]()[_0x31577e(0x195)](),'analysis':{'activity':{'summary':_0x317044[_0x31577e(0x1a2)],'isAlert':_0x317044[_0x31577e(0x15c)],'alertReason':_0x317044[_0x31577e(0x179)]},'comfort':{'automationProposal':_0x317044[_0x31577e(0x13b)]}}};_0x4b247b['analysisHistory']['unshift'](_0x45c913);if(_0x4b247b['analysisHistory'][_0x31577e(0x1a8)]>0x32)_0x4b247b[_0x31577e(0x178)][_0x31577e(0x197)]();await _0x4b247b[_0x31577e(0x1b4)]('analysis.analysisHistory',{'val':JSON[_0x31577e(0x1c4)](_0x4b247b[_0x31577e(0x178)]),'ack':!![]});const _0x54a76e=_0x317044[_0x31577e(0x15c)]||![];_0x54a76e!==_0x4b247b[_0x31577e(0x198)]&&(await _0x4b247b['setStateAsync']('analysis.isAlert',{'val':_0x54a76e,'ack':!![]}),_0x4b247b['lastAlertState']=_0x54a76e,_0x54a76e&&(await _0x4b247b[_0x31577e(0x1b4)]('analysis.alertReason',{'val':_0x317044['alertReason'],'ack':!![]}),setup[_0x31577e(0x1b8)](_0x4b247b,_0x31577e(0x142)+_0x317044[_0x31577e(0x179)],![],_0x317044[_0x31577e(0x1bc)])));if(_0x317044[_0x31577e(0x13b)]&&_0x317044[_0x31577e(0x13b)][_0x31577e(0x1d3)]){await _0x4b247b['setStateAsync'](_0x31577e(0x144),{'val':!![],'ack':!![]}),await _0x4b247b[_0x31577e(0x1b4)](_0x31577e(0x141),{'val':_0x317044['automationProposal'][_0x31577e(0x18d)],'ack':!![]}),await _0x4b247b[_0x31577e(0x1b4)](_0x31577e(0x13c),{'val':_0x317044[_0x31577e(0x13b)][_0x31577e(0x167)],'ack':!![]}),await _0x4b247b[_0x31577e(0x1b4)]('analysis.automation.targetValue',{'val':JSON[_0x31577e(0x1c4)](_0x317044[_0x31577e(0x13b)][_0x31577e(0x164)]),'ack':!![]});if(_0x4307c6)executeAutomationAction(_0x4b247b);}}catch(_0x48724f){_0x4b247b[_0x31577e(0x1c1)]['error'](_0x31577e(0x1b2)+_0x48724f[_0x31577e(0x188)]);}}async function createDailyDigest(_0x3998e6,_0x1aa509){const _0x5718d6=a0_0x194582;if(!_0x3998e6[_0x5718d6(0x17e)])return;if(!canCallApi()){await _0x3998e6['setStateAsync'](LTM_DP_STATUS,{'val':_0x5718d6(0x19e),'ack':!![]});return;}await _0x3998e6[_0x5718d6(0x1b4)](LTM_DP_STATUS,{'val':_0x5718d6(0x19d),'ack':!![]});if(!_0x3998e6['geminiModel']||_0x3998e6[_0x5718d6(0x13d)]['length']<LTM_MIN_EVENTS_FOR_COMPRESSION){await _0x3998e6[_0x5718d6(0x1b4)](LTM_DP_STATUS,{'val':'Skipped\x20(No\x20AI\x20or\x20Data)','ack':!![]});return;}const _0x568276=JSON[_0x5718d6(0x157)](JSON['stringify'](_0x3998e6['rawEventLog'])),_0x4e0c8c=_0x568276[_0x5718d6(0x1a8)],_0x41600f=_0x5718d6(0x1d1)+JSON[_0x5718d6(0x1c4)](_0x568276);try{updateApiTimestamp();const _0x3e30b3=await _0x3998e6[_0x5718d6(0x165)][_0x5718d6(0x1b6)](_0x41600f),_0x2ce180=JSON[_0x5718d6(0x157)](_0x3e30b3[_0x5718d6(0x149)]['text']()[_0x5718d6(0x186)](/```json|```/g,'')['trim']()),_0x45d67a={'timestamp':new Date()[_0x5718d6(0x189)](),'eventCount':_0x4e0c8c,'summary':_0x2ce180[_0x5718d6(0x1a2)]||_0x5718d6(0x169),'activityLevel':_0x2ce180[_0x5718d6(0x1b9)]||'normal','systemMode':_0x3998e6[_0x5718d6(0x1c7)]};_0x3998e6[_0x5718d6(0x1c5)]['push'](_0x45d67a);const _0x2a88d0=_0x3998e6[_0x5718d6(0x16c)][_0x5718d6(0x154)]||0x3c;_0x3998e6[_0x5718d6(0x1c5)][_0x5718d6(0x1a8)]>_0x2a88d0&&_0x3998e6[_0x5718d6(0x1c5)][_0x5718d6(0x16b)](0x0,_0x3998e6[_0x5718d6(0x1c5)][_0x5718d6(0x1a8)]-_0x2a88d0);await _0x3998e6['setStateAsync'](LTM_DP_DAILY_DIGESTS,{'val':JSON[_0x5718d6(0x1c4)](_0x3998e6[_0x5718d6(0x1c5)]),'ack':!![]}),_0x3998e6['rawEventLog']=[],await _0x3998e6[_0x5718d6(0x1b4)](LTM_DP_RAW_LOG,{'val':JSON[_0x5718d6(0x1c4)](_0x3998e6[_0x5718d6(0x13d)]),'ack':!![]}),await _0x3998e6[_0x5718d6(0x1b4)](LTM_DP_STATUS,{'val':'Success','ack':!![]});const _0x19b2ca=_0x5718d6(0x15f)+_0x2ce180[_0x5718d6(0x1a2)]+_0x5718d6(0x17f)+_0x2ce180['activityLevel'];setup[_0x5718d6(0x1b8)](_0x3998e6,_0x19b2ca,![],![]);if(_0x3998e6[_0x5718d6(0x17e)]&&_0x1aa509)_0x1aa509['send'](_0x3998e6,_0x5718d6(0x1aa),{'digest':_0x45d67a});}catch(_0x52d7d4){_0x3998e6[_0x5718d6(0x1c1)]['error'](_0x52d7d4[_0x5718d6(0x188)]);}}async function runBaselineDriftAnalysis(_0x20914e){const _0x5c73ca=a0_0x194582;if(!_0x20914e[_0x5c73ca(0x17e)]||!_0x20914e[_0x5c73ca(0x165)])return;if(!canCallApi())return;const _0x5760f9=_0x20914e[_0x5c73ca(0x16c)][_0x5c73ca(0x174)]||0xe;if(_0x20914e[_0x5c73ca(0x1c5)][_0x5c73ca(0x1a8)]<_0x5760f9+0x7){await _0x20914e[_0x5c73ca(0x1b4)](_0x5c73ca(0x147),{'val':_0x5c73ca(0x170),'ack':!![]});return;}const _0x4e855c=_0x20914e[_0x5c73ca(0x1c5)]['slice'](-_0x5760f9),_0x50c7cf=_0x20914e[_0x5c73ca(0x1c5)][_0x5c73ca(0x1a1)](0x0,_0x20914e[_0x5c73ca(0x1c5)]['length']-_0x5760f9),_0xab5d4=_0x5c73ca(0x17b)+JSON[_0x5c73ca(0x1c4)](_0x50c7cf)+_0x5c73ca(0x16f)+JSON[_0x5c73ca(0x1c4)](_0x4e855c);try{updateApiTimestamp();const _0x158182=await _0x20914e[_0x5c73ca(0x165)]['generateContent'](_0xab5d4),_0x3fc0d7=JSON['parse'](_0x158182[_0x5c73ca(0x149)][_0x5c73ca(0x187)]()[_0x5c73ca(0x186)](/```json|```/g,'')[_0x5c73ca(0x1a6)]());_0x3fc0d7[_0x5c73ca(0x159)]&&(await _0x20914e[_0x5c73ca(0x1b4)](_0x5c73ca(0x147),{'val':_0x3fc0d7[_0x5c73ca(0x159)],'ack':!![]}),await _0x20914e[_0x5c73ca(0x1b4)](_0x5c73ca(0x1c8),{'val':_0x3fc0d7[_0x5c73ca(0x1a4)],'ack':!![]}),await _0x20914e[_0x5c73ca(0x1b4)]('LTM.driftAnalysis.lastCheck',{'val':Date[_0x5c73ca(0x175)](),'ack':!![]}));}catch(_0x574881){}}async function executeAutomationAction(_0x145f62){const _0xf3a8b=a0_0x194582;try{const _0x1517e2=await _0x145f62[_0xf3a8b(0x1b1)](_0xf3a8b(0x13c)),_0x4f3b47=await _0x145f62[_0xf3a8b(0x1b1)]('analysis.automation.targetValue');if(_0x1517e2&&_0x1517e2[_0xf3a8b(0x148)]&&_0x4f3b47){const _0x5d83b2=_0x1517e2[_0xf3a8b(0x148)];let _0x2889be=_0x4f3b47[_0xf3a8b(0x148)];try{_0x2889be=JSON['parse'](_0x2889be);}catch(_0x9f865b){}_0x145f62[_0xf3a8b(0x1c1)]['info'](_0xf3a8b(0x13f)+_0x5d83b2+_0xf3a8b(0x17d)+_0x2889be),await _0x145f62['setForeignStateAsync'](_0x5d83b2,_0x2889be);}else _0x145f62[_0xf3a8b(0x1c1)][_0xf3a8b(0x151)](_0xf3a8b(0x18e));}catch(_0x2e97c2){_0x145f62['log']['error']('BUTLER\x20Execution\x20Error:\x20'+_0x2e97c2['message']);}}async function sendMorningBriefing(_0x5ab531){const _0xa054c4=a0_0x194582;if(!_0x5ab531[_0xa054c4(0x165)]){_0x5ab531[_0xa054c4(0x1c1)][_0xa054c4(0x151)]('ðŸ¤–\x20Morning\x20Briefing\x20skipped:\x20No\x20Gemini\x20Model.');return;}_0x5ab531[_0xa054c4(0x1c1)][_0xa054c4(0x171)](_0xa054c4(0x185));try{updateApiTimestamp();const _0x5f18f6='Erstelle\x20ein\x20kurzes\x20\x27Guten\x20Morgen\x27\x20Briefing\x20basierend\x20auf\x20den\x20Events\x20der\x20letzten\x20Nacht.',_0x3f6811=await _0x5ab531[_0xa054c4(0x165)]['generateContent'](_0x5f18f6),_0x1c17ef=_0x3f6811[_0xa054c4(0x149)][_0xa054c4(0x187)]();_0x5ab531[_0xa054c4(0x1c1)][_0xa054c4(0x171)](_0xa054c4(0x1d5)+_0x1c17ef[_0xa054c4(0x1a8)]+_0xa054c4(0x1cb)),setup[_0xa054c4(0x1b8)](_0x5ab531,_0xa054c4(0x166)+_0x1c17ef);}catch(_0x370e32){_0x5ab531[_0xa054c4(0x1c1)][_0xa054c4(0x16d)](_0xa054c4(0x191)+_0x370e32[_0xa054c4(0x188)]);}}async function generateHealthReport(_0x53ec50,_0x1239d9){const _0x3c75d2=a0_0x194582;if(!_0x53ec50[_0x3c75d2(0x165)])return;const _0x45f32e=Date[_0x3c75d2(0x175)]();_0x45f32e-lastGlobalApiCall<0xbb8&&(_0x53ec50[_0x3c75d2(0x1c1)]['debug']('ðŸ¤–\x20API\x20Cooldown.\x20Waiting\x202s...'),await new Promise(_0x4a17d3=>setTimeout(_0x4a17d3,0x7d0)));const _0x3156cd=new Date();let _0x35219d=0x0,_0x1ec305=_0x3156cd[_0x3c75d2(0x1ce)](),_0x346147='';if(_0x1239d9===_0x3c75d2(0x14e)){const _0x745bbc=new Date(_0x3156cd);_0x745bbc[_0x3c75d2(0x173)](_0x745bbc[_0x3c75d2(0x1a3)]()-0x1),_0x745bbc[_0x3c75d2(0x180)](0x16,0x0,0x0,0x0),_0x35219d=_0x745bbc[_0x3c75d2(0x1ce)]();const _0x35651c=new Date(_0x3156cd);_0x35651c['setHours'](0x8,0x0,0x0,0x0),_0x1ec305=_0x35651c[_0x3c75d2(0x1ce)](),_0x346147=_0x3c75d2(0x162);}else{const _0x1e1ea1=new Date(_0x3156cd);_0x1e1ea1[_0x3c75d2(0x180)](0x8,0x0,0x0,0x0),_0x35219d=_0x1e1ea1[_0x3c75d2(0x1ce)](),_0x346147=_0x3c75d2(0x1ab);}const _0x165134=_0x53ec50[_0x3c75d2(0x1c6)][_0x3c75d2(0x19b)](_0x315b48=>_0x315b48[_0x3c75d2(0x1d2)]>=_0x35219d&&_0x315b48['timestamp']<=_0x1ec305);if(_0x165134[_0x3c75d2(0x1a8)]===0x0){const _0x49e2d0=_0x1239d9===_0x3c75d2(0x14e)?'Keine\x20Daten\x20fÃ¼r\x20die\x20Nacht\x20aufgezeichnet\x20(Sensoren\x20ruhig).':'Bisher\x20keine\x20AktivitÃ¤t\x20seit\x2008:00\x20Uhr\x20verzeichnet.',_0x277b30=_0x1239d9===_0x3c75d2(0x14e)?_0x3c75d2(0x15b):'analysis.health.geminiDay';await _0x53ec50[_0x3c75d2(0x1b4)](_0x277b30,{'val':_0x49e2d0,'ack':!![]});return;}const _0x23e649=_0x165134[_0x3c75d2(0x150)](_0x2208be=>new Date(_0x2208be[_0x3c75d2(0x1d2)])[_0x3c75d2(0x18c)]([],{'hour':'2-digit','minute':_0x3c75d2(0x19f)})+'\x20'+_0x2208be[_0x3c75d2(0x1cd)]+'\x20('+_0x2208be[_0x3c75d2(0x15d)]+')')[_0x3c75d2(0x1a0)]('\x0a'),_0xbc6c60=_0x3c75d2(0x1b0)+_0x346147+_0x3c75d2(0x18b)+_0x23e649+'\x0a\x20\x20\x20\x20ANTWORT-STIL:\x20Sachlich,\x20beruhigend,\x20prÃ¤zise.\x20Keine\x20Floskeln.\x0a\x20\x20\x20\x20';try{updateApiTimestamp();const _0x3dec7e=await _0x53ec50[_0x3c75d2(0x165)][_0x3c75d2(0x1b6)](_0xbc6c60),_0x5e2255=_0x3dec7e[_0x3c75d2(0x149)]['text'](),_0x2bef26=_0x1239d9==='NIGHT'?'analysis.health.geminiNight':_0x3c75d2(0x182);await _0x53ec50[_0x3c75d2(0x1b4)](_0x2bef26,{'val':_0x5e2255,'ack':!![]}),_0x53ec50[_0x3c75d2(0x1c1)][_0x3c75d2(0x171)](_0x3c75d2(0x1d0)+_0x1239d9+')\x20generated.');}catch(_0x1e67be){_0x53ec50[_0x3c75d2(0x1c1)][_0x3c75d2(0x16d)](_0x3c75d2(0x1b3)+_0x1e67be[_0x3c75d2(0x188)]);}}module[a0_0x194582(0x140)]={'executeAutomationAction':executeAutomationAction,'createDailyDigest':createDailyDigest,'runBaselineDriftAnalysis':runBaselineDriftAnalysis,'sendMorningBriefing':sendMorningBriefing,'runGeminiAnalysis':runGeminiAnalysis,'consultButler':consultButler,'generateHealthReport':generateHealthReport};