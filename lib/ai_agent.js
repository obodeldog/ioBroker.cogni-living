const a0_0x9e5829=a0_0x5d2e;(function(_0x452d51,_0x270bf6){const _0x5d0b8a=a0_0x5d2e,_0x155746=_0x452d51();while(!![]){try{const _0x579f15=parseInt(_0x5d0b8a(0x121))/0x1+-parseInt(_0x5d0b8a(0xfc))/0x2+-parseInt(_0x5d0b8a(0xfd))/0x3+parseInt(_0x5d0b8a(0x163))/0x4+parseInt(_0x5d0b8a(0xe2))/0x5*(parseInt(_0x5d0b8a(0xce))/0x6)+parseInt(_0x5d0b8a(0xc4))/0x7+-parseInt(_0x5d0b8a(0x14e))/0x8*(-parseInt(_0x5d0b8a(0x111))/0x9);if(_0x579f15===_0x270bf6)break;else _0x155746['push'](_0x155746['shift']());}catch(_0x1d3def){_0x155746['push'](_0x155746['shift']());}}}(a0_0x9574,0x4c340));function a0_0x5d2e(_0x5af2e4,_0x156302){const _0x4888a6=a0_0x9574();return a0_0x5d2e=function(_0x404c1e,_0x5b97da){_0x404c1e=_0x404c1e-0xc3;let _0x9574cf=_0x4888a6[_0x404c1e];return _0x9574cf;},a0_0x5d2e(_0x5af2e4,_0x156302);}const a0_0x5b97da=(function(){let _0x3b715f=!![];return function(_0xe5a8cb,_0x3cd166){const _0x8568b9=_0x3b715f?function(){const _0x46e649=a0_0x5d2e;if(_0x3cd166){const _0x1a6f4f=_0x3cd166[_0x46e649(0x15a)](_0xe5a8cb,arguments);return _0x3cd166=null,_0x1a6f4f;}}:function(){};return _0x3b715f=![],_0x8568b9;};}()),a0_0x404c1e=a0_0x5b97da(this,function(){const _0x539271=a0_0x5d2e;return a0_0x404c1e[_0x539271(0xeb)]()['search'](_0x539271(0xca))['toString']()[_0x539271(0x116)](a0_0x404c1e)['search']('(((.+)+)+)+$');});a0_0x404c1e();'use strict';const {GoogleGenerativeAI}=require('@google/generative-ai'),setup=require('./setup'),GEMINI_MODEL=a0_0x9e5829(0xf0),LTM_DP_DAILY_DIGESTS=a0_0x9e5829(0xfe),LTM_DP_STATUS=a0_0x9e5829(0x125),LTM_DP_RAW_LOG='LTM.rawEventLog',LTM_MIN_EVENTS_FOR_COMPRESSION=0x5,MIN_API_GAP_MS=0x4e20;let lastGlobalApiCall=0x0;const decisionCache={},CACHE_TTL_MS=0xf*0x3c*0x3e8,PERSONA_MAPPING={'generic':a0_0x9e5829(0x104),'senior_aal':a0_0x9e5829(0xff),'family':'Fokus\x20auf\x20Komfort\x20f√ºr\x20die\x20Familie.','single_comfort':a0_0x9e5829(0xd2),'security':a0_0x9e5829(0x140),'energy_saver':'PRIORIT√ÑT:\x20Energie\x20sparen.\x20Schalte\x20nur,\x20wenn\x20absolut\x20notwendig\x20(Dunkelheit).'};function canCallApi(){const _0x4dc9d6=a0_0x9e5829,_0x554160=Date[_0x4dc9d6(0xd8)]();return _0x554160-lastGlobalApiCall>MIN_API_GAP_MS;}function updateApiTimestamp(){const _0x545116=a0_0x9e5829;lastGlobalApiCall=Date[_0x545116(0xd8)]();}async function getWeatherContext(_0x123e83){const _0x329a33=a0_0x9e5829;if(!_0x123e83[_0x329a33(0x15f)]['useWeather']||!_0x123e83[_0x329a33(0x15f)]['weatherInstance'])return _0x329a33(0x110);try{const _0x23378c=_0x123e83['config'][_0x329a33(0xed)];let _0x5be74c=await _0x123e83[_0x329a33(0x14b)](_0x23378c+_0x329a33(0x108));if(!_0x5be74c)_0x5be74c=await _0x123e83['getForeignStateAsync'](_0x23378c+_0x329a33(0xde));let _0x5880ca=await _0x123e83['getForeignStateAsync'](_0x23378c+_0x329a33(0xdf));if(!_0x5880ca)_0x5880ca=await _0x123e83['getForeignStateAsync'](_0x23378c+'.forecast.current.state');let _0x5e9998=_0x329a33(0x107);const _0x3e1e85=await _0x123e83[_0x329a33(0x14b)](_0x23378c+_0x329a33(0x141));if(_0x3e1e85)_0x5e9998=_0x3e1e85[_0x329a33(0xe9)]?_0x329a33(0xe3):_0x329a33(0x155);if(_0x5be74c&&_0x5880ca)return _0x5be74c[_0x329a33(0xe9)]+'¬∞C,\x20'+_0x5880ca[_0x329a33(0xe9)]+_0x329a33(0x109)+_0x5e9998;}catch(_0x54123e){}return'Wetterdaten\x20nicht\x20abrufbar';}async function consultButler(_0x39c898,_0x59b5e0,_0x3424ff,_0x5eed18){const _0x433a63=a0_0x9e5829;if(!_0x39c898[_0x433a63(0x162)])return{'approved':!![],'reason':_0x433a63(0x127)};const _0x4a5b49=Date[_0x433a63(0xd8)]();if(decisionCache[_0x59b5e0]&&_0x4a5b49-decisionCache[_0x59b5e0]['timestamp']<CACHE_TTL_MS){const _0x4f5a3b=decisionCache[_0x59b5e0][_0x433a63(0x14a)];return _0x39c898[_0x433a63(0x101)][_0x433a63(0xec)]('ü§ñ\x20Butler\x20Cache\x20Hit:\x20'+_0x59b5e0+_0x433a63(0x152)+(_0x4f5a3b[_0x433a63(0xc6)]?'OK':'NO')+'\x20('+_0x4f5a3b[_0x433a63(0x149)]+')'),_0x4f5a3b;}if(!canCallApi())return _0x39c898[_0x433a63(0x101)][_0x433a63(0xec)](_0x433a63(0x15b)+_0x59b5e0+'\x20√ºbersprungen\x20(Auto-Approved).'),{'approved':!![],'reason':_0x433a63(0xf1)};const _0x2ed6b7=new Date()[_0x433a63(0x114)](),_0x4f7388=await getWeatherContext(_0x39c898),_0x4cf6bc=PERSONA_MAPPING[_0x39c898['config'][_0x433a63(0x145)]||'generic'],_0x5380ca=_0x433a63(0x129)+_0x2ed6b7+_0x433a63(0xf4)+_0x4f7388+_0x433a63(0x13a)+(_0x5eed18*0x64)[_0x433a63(0x13e)](0x0)+_0x433a63(0xc5)+_0x59b5e0+_0x433a63(0x10f)+_0x3424ff+'\x22\x20AN.\x0a\x20\x20\x20\x20STRATEGIE:\x20'+_0x4cf6bc+_0x433a63(0x117);try{updateApiTimestamp();const _0x596267=await _0x39c898[_0x433a63(0x162)][_0x433a63(0xc8)](_0x5380ca),_0x226c03=_0x596267['response'][_0x433a63(0xd7)]()[_0x433a63(0xe0)](/```json|```/g,'')[_0x433a63(0x12b)](),_0x47d758=JSON[_0x433a63(0x11d)](_0x226c03);return decisionCache[_0x59b5e0]={'decision':_0x47d758,'timestamp':_0x4a5b49},_0x47d758;}catch(_0x133c9c){return _0x39c898[_0x433a63(0x101)]['warn'](_0x433a63(0x10c)+_0x133c9c['message']),decisionCache[_0x59b5e0]={'decision':{'approved':!![],'reason':'KI-Fehler\x20(Fallback)'},'timestamp':_0x4a5b49-(CACHE_TTL_MS-0xea60)},{'approved':!![],'reason':_0x433a63(0x144)};}}async function runGeminiAnalysis(_0x47510f,_0x5df69c=''){const _0x4cc36a=a0_0x9e5829;if(!_0x47510f[_0x4cc36a(0x162)])return;if(!canCallApi()){_0x47510f[_0x4cc36a(0x101)]['debug'](_0x4cc36a(0x12d));return;}if(_0x47510f[_0x4cc36a(0x139)]['length']===0x0)return;const _0x38d490=_0x47510f[_0x4cc36a(0x139)][_0x4cc36a(0xf7)](0x0,0xf),_0x256bcb=_0x47510f['currentSystemMode'],_0x4ec948=PERSONA_MAPPING[_0x47510f['config'][_0x4cc36a(0x145)]||_0x4cc36a(0x130)],_0x1b725a=_0x47510f['config'][_0x4cc36a(0xe6)]||_0x4cc36a(0x10a);let _0x699808='Unbekannt';try{const _0x455a9e=await _0x47510f[_0x4cc36a(0xdc)](_0x4cc36a(0x11c));if(_0x455a9e&&_0x455a9e['val'])_0x699808=_0x455a9e[_0x4cc36a(0xe9)];}catch(_0x6f57b4){}let _0x2cb44b=![];try{const _0x277716=await _0x47510f[_0x4cc36a(0xdc)](_0x4cc36a(0x100));if(_0x277716&&_0x277716['val'])_0x2cb44b=!![];}catch(_0x42daba){}const _0x23bbd3=_0x4cc36a(0x10d)+_0x4ec948+_0x4cc36a(0x12e)+_0x1b725a+_0x4cc36a(0x122)+_0x256bcb+_0x4cc36a(0x15e)+_0x699808+_0x4cc36a(0x161)+JSON[_0x4cc36a(0x102)](_0x38d490)+_0x4cc36a(0xc7)+_0x5df69c+_0x4cc36a(0xfa);try{updateApiTimestamp();const _0x35931b=await _0x47510f[_0x4cc36a(0x162)][_0x4cc36a(0xc8)](_0x23bbd3),_0x1254a1=JSON[_0x4cc36a(0x11d)](_0x35931b[_0x4cc36a(0xcd)]['text']()['replace'](/```json|```/g,'')[_0x4cc36a(0x12b)]());await _0x47510f['setStateAsync'](_0x4cc36a(0xf9),{'val':JSON[_0x4cc36a(0x102)](_0x1254a1),'ack':!![]});if(_0x1254a1[_0x4cc36a(0x132)])await _0x47510f[_0x4cc36a(0x113)]('analysis.activitySummary',{'val':_0x1254a1['summary'],'ack':!![]});const _0x256c45={'timestamp':Date[_0x4cc36a(0xd8)](),'id':Date[_0x4cc36a(0xd8)]()[_0x4cc36a(0xeb)](),'analysis':{'activity':{'summary':_0x1254a1['summary'],'isAlert':_0x1254a1[_0x4cc36a(0xd5)],'alertReason':_0x1254a1[_0x4cc36a(0xda)]},'comfort':{'automationProposal':_0x1254a1[_0x4cc36a(0x156)]}}};_0x47510f[_0x4cc36a(0x160)][_0x4cc36a(0x10b)](_0x256c45);if(_0x47510f['analysisHistory'][_0x4cc36a(0xe8)]>0x32)_0x47510f['analysisHistory'][_0x4cc36a(0x148)]();await _0x47510f[_0x4cc36a(0x113)]('analysis.analysisHistory',{'val':JSON[_0x4cc36a(0x102)](_0x47510f[_0x4cc36a(0x160)]),'ack':!![]});const _0x12f4fd=_0x1254a1[_0x4cc36a(0xd5)]||![];_0x12f4fd!==_0x47510f[_0x4cc36a(0x10e)]&&(await _0x47510f[_0x4cc36a(0x113)](_0x4cc36a(0x126),{'val':_0x12f4fd,'ack':!![]}),_0x47510f[_0x4cc36a(0x10e)]=_0x12f4fd,_0x12f4fd&&(await _0x47510f[_0x4cc36a(0x113)](_0x4cc36a(0xdb),{'val':_0x1254a1['alertReason'],'ack':!![]}),setup['sendNotification'](_0x47510f,_0x4cc36a(0x157)+_0x1254a1[_0x4cc36a(0xda)],![],_0x1254a1[_0x4cc36a(0x146)])));if(_0x1254a1['automationProposal']&&_0x1254a1['automationProposal']['detected']){await _0x47510f[_0x4cc36a(0x113)](_0x4cc36a(0xf5),{'val':!![],'ack':!![]}),await _0x47510f[_0x4cc36a(0x113)]('analysis.automation.description',{'val':_0x1254a1[_0x4cc36a(0x156)][_0x4cc36a(0x13f)],'ack':!![]}),await _0x47510f['setStateAsync']('analysis.automation.targetId',{'val':_0x1254a1[_0x4cc36a(0x156)][_0x4cc36a(0x142)],'ack':!![]}),await _0x47510f[_0x4cc36a(0x113)](_0x4cc36a(0x15d),{'val':JSON[_0x4cc36a(0x102)](_0x1254a1['automationProposal']['targetValue']),'ack':!![]});if(_0x2cb44b)executeAutomationAction(_0x47510f);}}catch(_0x14012f){_0x47510f[_0x4cc36a(0x101)][_0x4cc36a(0x15c)](_0x4cc36a(0x159)+_0x14012f[_0x4cc36a(0x14f)]);}}async function createDailyDigest(_0xc2917,_0x4f60a3){const _0xf0cd1e=a0_0x9e5829;if(!_0xc2917['isProVersion'])return;if(!canCallApi()){await _0xc2917['setStateAsync'](LTM_DP_STATUS,{'val':_0xf0cd1e(0xf3),'ack':!![]});return;}await _0xc2917[_0xf0cd1e(0x113)](LTM_DP_STATUS,{'val':_0xf0cd1e(0x143),'ack':!![]});if(!_0xc2917[_0xf0cd1e(0x162)]||_0xc2917[_0xf0cd1e(0x158)]['length']<LTM_MIN_EVENTS_FOR_COMPRESSION){await _0xc2917[_0xf0cd1e(0x113)](LTM_DP_STATUS,{'val':_0xf0cd1e(0xd1),'ack':!![]});return;}const _0x2aa24e=JSON[_0xf0cd1e(0x11d)](JSON[_0xf0cd1e(0x102)](_0xc2917[_0xf0cd1e(0x158)])),_0x46c356=_0x2aa24e['length'],_0x3dc489=_0xf0cd1e(0x13c)+JSON[_0xf0cd1e(0x102)](_0x2aa24e);try{updateApiTimestamp();const _0x1afd40=await _0xc2917[_0xf0cd1e(0x162)]['generateContent'](_0x3dc489),_0x3a45a8=JSON[_0xf0cd1e(0x11d)](_0x1afd40[_0xf0cd1e(0xcd)][_0xf0cd1e(0xd7)]()[_0xf0cd1e(0xe0)](/```json|```/g,'')[_0xf0cd1e(0x12b)]()),_0x229a59={'timestamp':new Date()[_0xf0cd1e(0x13b)](),'eventCount':_0x46c356,'summary':_0x3a45a8[_0xf0cd1e(0x132)]||_0xf0cd1e(0x105),'activityLevel':_0x3a45a8[_0xf0cd1e(0x135)]||_0xf0cd1e(0xd0),'systemMode':_0xc2917[_0xf0cd1e(0x12a)]};_0xc2917[_0xf0cd1e(0xe1)]['push'](_0x229a59);const _0x293661=_0xc2917['config'][_0xf0cd1e(0x131)]||0x3c;_0xc2917['dailyDigests'][_0xf0cd1e(0xe8)]>_0x293661&&_0xc2917[_0xf0cd1e(0xe1)][_0xf0cd1e(0x11b)](0x0,_0xc2917['dailyDigests'][_0xf0cd1e(0xe8)]-_0x293661);await _0xc2917['setStateAsync'](LTM_DP_DAILY_DIGESTS,{'val':JSON[_0xf0cd1e(0x102)](_0xc2917['dailyDigests']),'ack':!![]}),_0xc2917[_0xf0cd1e(0x158)]=[],await _0xc2917[_0xf0cd1e(0x113)](LTM_DP_RAW_LOG,{'val':JSON['stringify'](_0xc2917[_0xf0cd1e(0x158)]),'ack':!![]}),await _0xc2917[_0xf0cd1e(0x113)](LTM_DP_STATUS,{'val':_0xf0cd1e(0x151),'ack':!![]});const _0x532b4e=_0xf0cd1e(0x120)+_0x3a45a8['summary']+_0xf0cd1e(0x14c)+_0x3a45a8[_0xf0cd1e(0x135)];setup[_0xf0cd1e(0xfb)](_0xc2917,_0x532b4e,![],![]);if(_0xc2917[_0xf0cd1e(0x13d)]&&_0x4f60a3)_0x4f60a3[_0xf0cd1e(0x11a)](_0xc2917,_0xf0cd1e(0xef),{'digest':_0x229a59});}catch(_0x5a1f1c){_0xc2917[_0xf0cd1e(0x101)][_0xf0cd1e(0x15c)](_0x5a1f1c['message']);}}async function runBaselineDriftAnalysis(_0xda11a1){const _0x3dc727=a0_0x9e5829;if(!_0xda11a1[_0x3dc727(0x13d)]||!_0xda11a1['geminiModel'])return;if(!canCallApi())return;const _0x97b9d6=_0xda11a1[_0x3dc727(0x15f)][_0x3dc727(0x12c)]||0xe;if(_0xda11a1[_0x3dc727(0xe1)][_0x3dc727(0xe8)]<_0x97b9d6+0x7){await _0xda11a1[_0x3dc727(0x113)](_0x3dc727(0xea),{'val':_0x3dc727(0xe7),'ack':!![]});return;}const _0x45c2e6=_0xda11a1[_0x3dc727(0xe1)]['slice'](-_0x97b9d6),_0x47dbcf=_0xda11a1['dailyDigests']['slice'](0x0,_0xda11a1[_0x3dc727(0xe1)]['length']-_0x97b9d6),_0x5cb0da=_0x3dc727(0x119)+JSON['stringify'](_0x47dbcf)+_0x3dc727(0x147)+JSON[_0x3dc727(0x102)](_0x45c2e6);try{updateApiTimestamp();const _0x1df48f=await _0xda11a1['geminiModel'][_0x3dc727(0xc8)](_0x5cb0da),_0x484361=JSON[_0x3dc727(0x11d)](_0x1df48f['response'][_0x3dc727(0xd7)]()['replace'](/```json|```/g,'')[_0x3dc727(0x12b)]());_0x484361[_0x3dc727(0x133)]&&(await _0xda11a1[_0x3dc727(0x113)](_0x3dc727(0xea),{'val':_0x484361[_0x3dc727(0x133)],'ack':!![]}),await _0xda11a1[_0x3dc727(0x113)](_0x3dc727(0x164),{'val':_0x484361[_0x3dc727(0x14d)],'ack':!![]}),await _0xda11a1[_0x3dc727(0x113)](_0x3dc727(0x11e),{'val':Date[_0x3dc727(0xd8)](),'ack':!![]}));}catch(_0x110376){}}function a0_0x9574(){const _0x415eca=['analysis.alertReason','getStateAsync','setHours','.forecast.current.temperature','.Current.WeatherText','replace','dailyDigests','1126970OpRheh','Nacht','setForeignStateAsync','name','livingContext','N/A\x20(Learning)','length','val','LTM.driftAnalysis.baselineDrift','toString','debug','weatherInstance','ü§ñ\x20BUTLER:\x20Executing\x20Action\x20->\x20','ANALYZE_HEALTH','models/gemini-flash-latest','Traffic-Schutz\x20(Auto-Approved)','Analysiere\x20diese\x20Events\x20der\x20NACHT\x20(22:00-08:00).\x20War\x20der\x20Schlaf\x20ruhig?\x20Gab\x20es\x20Badg√§nge?\x20Antwort\x20kurz\x20f√ºr\x20den\x20besorgten\x20Sohn\x20(max\x202\x20S√§tze).','Skipped\x20(Traffic)',',\x20Wetter:\x20','analysis.automation.patternDetected','2-digit','slice','Health\x20Report\x20Error:\x20','analysis.lastResult','.\x20AUFGABE:\x201.\x20Gesundheit?\x202.\x20Komfort?\x20FORMAT\x20(JSON):\x20{\x20\x22isAlert\x22:\x20boolean,\x20\x22alertReason\x22:\x20\x22string\x22,\x20\x22isEmergency\x22:\x20boolean,\x20\x22summary\x22:\x20\x22string\x22,\x20\x22automationProposal\x22:\x20{\x20\x22detected\x22:\x20boolean,\x20\x22description\x22:\x20\x22string\x22,\x20\x22targetId\x22:\x20\x22string\x22,\x20\x22targetValue\x22:\x20\x22any\x22\x20}\x20}','sendNotification','935692xRzbQk','1362747ULhiSP','LTM.dailyDigests','PRIORIT√ÑT:\x20Sicherheit\x20und\x20Licht.\x20Schalte\x20lieber\x20einmal\x20zu\x20viel\x20als\x20zu\x20wenig.','analysis.automation.autoApply','log','stringify','\x0a\x20\x20\x20\x20ROLLE:\x20Medizinischer\x20Assistent\x20f√ºr\x20AAL\x20(Ambient\x20Assisted\x20Living).\x0a\x20\x20\x20\x20AUFGABE:\x20','Entscheide\x20ausgewogen\x20zwischen\x20Komfort\x20und\x20Energie.','Digest','ü§ñ\x20Morning\x20Briefing\x20skipped:\x20No\x20Gemini\x20Model.','Unbekannt','.Current.Temperature',',\x20Lichtverh√§ltnisse:\x20','Keine\x20Details.','unshift','ü§ñ\x20Butler\x20Brain\x20Error:\x20','ROLLE:\x20KI-Hausverwalter.\x20PERSONA:\x20','lastAlertState','\x22.\x0a\x20\x20\x20\x20AKTION:\x20Schalte\x20\x22','Unbekannt\x20(Kein\x20Sensor)','1188sAlyWs',').\x20Sending\x20notification...','setStateAsync','toLocaleTimeString','setDate','constructor','\x0a\x20\x20\x20\x20FRAGE:\x20Ist\x20es\x20dunkel\x20genug\x20f√ºr\x20Licht?\x0a\x20\x20\x20\x20FORMAT:\x20{\x20\x22approved\x22:\x20boolean,\x20\x22reason\x22:\x20\x22kurzer\x20Grund\x22\x20}\x0a\x20\x20\x20\x20','join','ROLLE:\x20Data\x20Scientist.\x20ZIEL:\x20Drift\x20erkennen.\x20SCHEMA:\x20{\x20\x22baselineDrift\x22:\x20\x22none|slight|significant|critical\x22,\x20\x22driftDetails\x22:\x20\x22string\x22\x20}\x0a\x0aLTB:\x20','send','splice','system.presenceWho','parse','LTM.driftAnalysis.lastCheck','Briefing\x20Error:\x20','üìÖ\x20Daily\x20Digest:\x0a','391685EmbHXH','.\x20SYSTEM_MODE:\x20','NIGHT','timestamp','LTM.processingStatus','analysis.isAlert','KI\x20offline\x20(Fallback)','Bisher\x20keine\x20Aktivit√§t\x20seit\x2008:00\x20Uhr\x20verzeichnet.','\x0a\x20\x20\x20\x20ROLLE:\x20Haus-Butler.\x0a\x20\x20\x20\x20SITUATION:\x20','currentSystemMode','trim','ltmStbWindowDays','ü§ñ\x20Autopilot\x20skipped\x20(Traffic\x20Protection\x20active).','.\x20KONTEXT:\x20',')\x20generated.','generic','ltmLtbWindowDays','summary','baselineDrift','üåÖ\x20Briefing\x20generated\x20(Length:\x20','activityLevel','warn','analysis.health.geminiNight','\x0a\x20\x20\x20\x20EVENTS:\x0a','eventHistory','.\x0a\x20\x20\x20\x20EVENT:\x20Bewohner\x20geht\x20wahrscheinlich\x20(','toISOString','ROLLE:\x20Data\x20Compression\x20Agent.\x20SPRACHE:\x20DE.\x20FORMAT:\x20JSON.\x20ANWEISUNG:\x20Fasse\x20Sensor-Events\x20zusammen.\x20SCHEMA:\x20{\x20\x22summary\x22:\x20\x22string\x22,\x20\x22activityLevel\x22:\x20\x22string\x22\x20}\x20\x0a\x0aEVENTS:\x0a','isProVersion','toFixed','description','Sicherheit\x20geht\x20vor.','.Current.IsNight','targetId','Started...','KI-Fehler\x20(Fallback)','aiPersona','isEmergency','\x0aSTB:\x20','pop','reason','decision','getForeignStateAsync','\x0aAktivit√§t:\x20','driftDetails','8144pwTqWk','message','BUTLER\x20Execution\x20Error:\x20','Success','\x20->\x20','exports','\x0a\x20\x20\x20\x20ANTWORT-STIL:\x20Sachlich,\x20beruhigend,\x20pr√§zise.\x20Keine\x20Floskeln.\x0a\x20\x20\x20\x20','Tag','automationProposal','‚ö†Ô∏è\x20ALARM:\x20','rawEventLog','Gemini\x20Error:\x20','apply','ü§ñ\x20Traffic\x20Schutz:\x20Anfrage\x20f√ºr\x20','error','analysis.automation.targetValue','.\x20ANWESEND:\x20','config','analysisHistory','.\x20EVENTS:\x20','geminiModel','780616kuKmnJ','LTM.driftAnalysis.driftDetails','Erstelle\x20ein\x20kurzes\x20\x27Guten\x20Morgen\x27\x20Briefing\x20basierend\x20auf\x20den\x20Events\x20der\x20letzten\x20Nacht.','435540SBSTRX','%)\x20nach\x20\x22','approved','.\x20EMERGENCY:\x20','generateContent','getDate','(((.+)+)+)+$','getTime','Analysiere\x20diese\x20Events\x20des\x20TAGES\x20(08:00-Jetzt).\x20Aktivit√§t?\x20Mahlzeiten?\x20Haust√ºr?\x20Antwort\x20kurz\x20f√ºr\x20den\x20besorgten\x20Sohn\x20(max\x202\x20S√§tze).','response','12lfGuFR','analysis.health.geminiDay','normal','Skipped\x20(No\x20AI\x20or\x20Data)','Maximaler\x20Komfort,\x20Energie\x20ist\x20zweitrangig.','üåÖ\x20Morning\x20Briefing:\x0a','\x20=\x20','isAlert','analysis.automation.targetId','text','now','info','alertReason'];a0_0x9574=function(){return _0x415eca;};return a0_0x9574();}async function executeAutomationAction(_0x22a26b){const _0x5beb67=a0_0x9e5829;try{const _0x45b021=await _0x22a26b[_0x5beb67(0xdc)](_0x5beb67(0xd6)),_0x3f1f35=await _0x22a26b[_0x5beb67(0xdc)]('analysis.automation.targetValue');if(_0x45b021&&_0x45b021[_0x5beb67(0xe9)]&&_0x3f1f35){const _0xf97506=_0x45b021[_0x5beb67(0xe9)];let _0x3d0165=_0x3f1f35[_0x5beb67(0xe9)];try{_0x3d0165=JSON[_0x5beb67(0x11d)](_0x3d0165);}catch(_0x18c08b){}_0x22a26b[_0x5beb67(0x101)][_0x5beb67(0xd9)](_0x5beb67(0xee)+_0xf97506+_0x5beb67(0xd4)+_0x3d0165),await _0x22a26b[_0x5beb67(0xe4)](_0xf97506,_0x3d0165);}else _0x22a26b['log'][_0x5beb67(0x136)]('ü§ñ\x20BUTLER:\x20No\x20valid\x20target\x20ID\x20or\x20value\x20stored\x20for\x20execution.');}catch(_0x224330){_0x22a26b['log'][_0x5beb67(0x15c)](_0x5beb67(0x150)+_0x224330['message']);}}async function sendMorningBriefing(_0x491834){const _0x47dfe9=a0_0x9e5829;if(!_0x491834[_0x47dfe9(0x162)]){_0x491834[_0x47dfe9(0x101)][_0x47dfe9(0x136)](_0x47dfe9(0x106));return;}_0x491834[_0x47dfe9(0x101)][_0x47dfe9(0xd9)]('üåÖ\x20Starting\x20Morning\x20Briefing\x20sequence\x20(Traffic\x20Check\x20bypassed)...');try{updateApiTimestamp();const _0x1a4dfa=_0x47dfe9(0xc3),_0x45a335=await _0x491834['geminiModel']['generateContent'](_0x1a4dfa),_0x2b6c8b=_0x45a335[_0x47dfe9(0xcd)]['text']();_0x491834[_0x47dfe9(0x101)][_0x47dfe9(0xd9)](_0x47dfe9(0x134)+_0x2b6c8b['length']+_0x47dfe9(0x112)),setup[_0x47dfe9(0xfb)](_0x491834,_0x47dfe9(0xd3)+_0x2b6c8b);}catch(_0x4fda66){_0x491834[_0x47dfe9(0x101)][_0x47dfe9(0x15c)](_0x47dfe9(0x11f)+_0x4fda66[_0x47dfe9(0x14f)]);}}async function generateHealthReport(_0x46b89a,_0x1e188a){const _0x51511b=a0_0x9e5829;if(!_0x46b89a[_0x51511b(0x162)])return;const _0xee388d=Date[_0x51511b(0xd8)]();_0xee388d-lastGlobalApiCall<0xbb8&&(_0x46b89a[_0x51511b(0x101)][_0x51511b(0xec)]('ü§ñ\x20API\x20Cooldown.\x20Waiting\x202s...'),await new Promise(_0x555f21=>setTimeout(_0x555f21,0x7d0)));const _0x545821=new Date();let _0x1aae2e=0x0,_0x20e69a=_0x545821[_0x51511b(0xcb)](),_0x467f58='';if(_0x1e188a===_0x51511b(0x123)){const _0x4fd524=new Date(_0x545821);_0x4fd524[_0x51511b(0x115)](_0x4fd524[_0x51511b(0xc9)]()-0x1),_0x4fd524[_0x51511b(0xdd)](0x16,0x0,0x0,0x0),_0x1aae2e=_0x4fd524['getTime']();const _0xf3ec6a=new Date(_0x545821);_0xf3ec6a[_0x51511b(0xdd)](0x8,0x0,0x0,0x0),_0x20e69a=_0xf3ec6a[_0x51511b(0xcb)](),_0x467f58=_0x51511b(0xf2);}else{const _0x50e95b=new Date(_0x545821);_0x50e95b['setHours'](0x8,0x0,0x0,0x0),_0x1aae2e=_0x50e95b[_0x51511b(0xcb)](),_0x467f58=_0x51511b(0xcc);}const _0x928062=_0x46b89a[_0x51511b(0x139)]['filter'](_0x9c4abd=>_0x9c4abd[_0x51511b(0x124)]>=_0x1aae2e&&_0x9c4abd[_0x51511b(0x124)]<=_0x20e69a);if(_0x928062[_0x51511b(0xe8)]===0x0){const _0x2ae550=_0x1e188a===_0x51511b(0x123)?'Keine\x20Daten\x20f√ºr\x20die\x20Nacht\x20aufgezeichnet\x20(Sensoren\x20ruhig).':_0x51511b(0x128),_0x2043c0=_0x1e188a==='NIGHT'?_0x51511b(0x137):_0x51511b(0xcf);await _0x46b89a[_0x51511b(0x113)](_0x2043c0,{'val':_0x2ae550,'ack':!![]});return;}const _0x15bf2c=_0x928062['map'](_0x25edaf=>new Date(_0x25edaf['timestamp'])['toLocaleTimeString']([],{'hour':_0x51511b(0xf6),'minute':_0x51511b(0xf6)})+'\x20'+_0x25edaf[_0x51511b(0xe5)]+'\x20('+_0x25edaf['value']+')')[_0x51511b(0x118)]('\x0a'),_0x1c4400=_0x51511b(0x103)+_0x467f58+_0x51511b(0x138)+_0x15bf2c+_0x51511b(0x154);try{updateApiTimestamp();const _0x48f758=await _0x46b89a['geminiModel']['generateContent'](_0x1c4400),_0x244604=_0x48f758['response'][_0x51511b(0xd7)](),_0xf655a8=_0x1e188a===_0x51511b(0x123)?'analysis.health.geminiNight':'analysis.health.geminiDay';await _0x46b89a['setStateAsync'](_0xf655a8,{'val':_0x244604,'ack':!![]}),_0x46b89a['log'][_0x51511b(0xd9)]('ü§ñ\x20Health\x20Report\x20('+_0x1e188a+_0x51511b(0x12f));}catch(_0x301310){_0x46b89a[_0x51511b(0x101)][_0x51511b(0x15c)](_0x51511b(0xf8)+_0x301310[_0x51511b(0x14f)]);}}module[a0_0x9e5829(0x153)]={'executeAutomationAction':executeAutomationAction,'createDailyDigest':createDailyDigest,'runBaselineDriftAnalysis':runBaselineDriftAnalysis,'sendMorningBriefing':sendMorningBriefing,'runGeminiAnalysis':runGeminiAnalysis,'consultButler':consultButler,'generateHealthReport':generateHealthReport};