const a0_0x1425a8=a0_0xe1a1;(function(_0x595575,_0x1c0fe7){const _0x23f5d3=a0_0xe1a1,_0x5e5cd8=_0x595575();while(!![]){try{const _0x4d23a3=-parseInt(_0x23f5d3(0x1a5))/0x1+parseInt(_0x23f5d3(0x1d0))/0x2*(-parseInt(_0x23f5d3(0x186))/0x3)+-parseInt(_0x23f5d3(0x1a2))/0x4*(-parseInt(_0x23f5d3(0x1d5))/0x5)+parseInt(_0x23f5d3(0x1b7))/0x6+parseInt(_0x23f5d3(0x208))/0x7*(parseInt(_0x23f5d3(0x197))/0x8)+parseInt(_0x23f5d3(0x1b4))/0x9+parseInt(_0x23f5d3(0x1a0))/0xa*(-parseInt(_0x23f5d3(0x1fc))/0xb);if(_0x4d23a3===_0x1c0fe7)break;else _0x5e5cd8['push'](_0x5e5cd8['shift']());}catch(_0x4740e){_0x5e5cd8['push'](_0x5e5cd8['shift']());}}}(a0_0x3a5f,0x249fe));const a0_0x2ae4c1=(function(){let _0x18794d=!![];return function(_0x555491,_0x426717){const _0x2abd54=_0x18794d?function(){const _0x778b2d=a0_0xe1a1;if(_0x426717){const _0x35ea10=_0x426717[_0x778b2d(0x1d1)](_0x555491,arguments);return _0x426717=null,_0x35ea10;}}:function(){};return _0x18794d=![],_0x2abd54;};}()),a0_0x12128e=a0_0x2ae4c1(this,function(){const _0x27d65c=a0_0xe1a1;return a0_0x12128e['toString']()[_0x27d65c(0x1d8)](_0x27d65c(0x1c2))[_0x27d65c(0x198)]()[_0x27d65c(0x1bf)](a0_0x12128e)[_0x27d65c(0x1d8)]('(((.+)+)+)+$');});a0_0x12128e();'use strict';const {GoogleGenerativeAI}=require('@google/generative-ai'),setup=require('./setup'),GEMINI_MODEL=a0_0x1425a8(0x195),LTM_DP_DAILY_DIGESTS=a0_0x1425a8(0x1ec),LTM_DP_STATUS=a0_0x1425a8(0x1dc),LTM_DP_RAW_LOG='LTM.rawEventLog',LTM_MIN_EVENTS_FOR_COMPRESSION=0x5,MIN_API_GAP_MS=0x4e20;function a0_0xe1a1(_0xf80e2b,_0xe84df9){const _0x587807=a0_0x3a5f();return a0_0xe1a1=function(_0x12128e,_0x2ae4c1){_0x12128e=_0x12128e-0x182;let _0x3a5f41=_0x587807[_0x12128e];return _0x3a5f41;},a0_0xe1a1(_0xf80e2b,_0xe84df9);}let lastGlobalApiCall=0x0;const decisionCache={},CACHE_TTL_MS=0xf*0x3c*0x3e8,PERSONA_MAPPING={'generic':'Entscheide\x20ausgewogen\x20zwischen\x20Komfort\x20und\x20Energie.','senior_aal':'PRIORIT√ÑT:\x20Sicherheit\x20und\x20Licht.\x20Schalte\x20lieber\x20einmal\x20zu\x20viel\x20als\x20zu\x20wenig.','family':a0_0x1425a8(0x18e),'single_comfort':a0_0x1425a8(0x19b),'security':a0_0x1425a8(0x1f6),'energy_saver':a0_0x1425a8(0x1df)};function canCallApi(){const _0x32f1a8=a0_0x1425a8,_0x36a547=Date[_0x32f1a8(0x1c3)]();return _0x36a547-lastGlobalApiCall>MIN_API_GAP_MS;}function updateApiTimestamp(){const _0x4ad27b=a0_0x1425a8;lastGlobalApiCall=Date[_0x4ad27b(0x1c3)]();}function a0_0x3a5f(){const _0x4115e4=['ltmLtbWindowDays','summary','LTM.driftAnalysis.lastCheck','2267883FXWGxb','targetId','ROLLE:\x20KI-Hausverwalter.\x20PERSONA:\x20','601494qSYjBK','eventHistory','info','dailyDigests','error','isProVersion','Health\x20Report\x20Error:\x20','generateContent','constructor','Bisher\x20keine\x20Aktivit√§t\x20seit\x2008:00\x20Uhr\x20verzeichnet.','N/A\x20(Learning)','(((.+)+)+)+$','now','warn','üìÖ\x20Daily\x20Digest:\x0a','ü§ñ\x20Health\x20Report\x20(','Keine\x20Daten\x20f√ºr\x20die\x20Nacht\x20aufgezeichnet\x20(Sensoren\x20ruhig).','.\x20AUFGABE:\x201.\x20Gesundheit?\x202.\x20Komfort?\x20FORMAT\x20(JSON):\x20{\x20\x22isAlert\x22:\x20boolean,\x20\x22alertReason\x22:\x20\x22string\x22,\x20\x22isEmergency\x22:\x20boolean,\x20\x22summary\x22:\x20\x22string\x22,\x20\x22automationProposal\x22:\x20{\x20\x22detected\x22:\x20boolean,\x20\x22description\x22:\x20\x22string\x22,\x20\x22targetId\x22:\x20\x22string\x22,\x20\x22targetValue\x22:\x20\x22any\x22\x20}\x20}','getForeignStateAsync','analysis.automation.targetId','unshift','ü§ñ\x20Butler\x20Cache\x20Hit:\x20','Unbekannt','log','parse','98772Wepthc','apply',')\x20generated.',',\x20Lichtverh√§ltnisse:\x20','setDate','30LDKxYZ','.\x0a\x20\x20\x20\x20EVENT:\x20Bewohner\x20geht\x20wahrscheinlich\x20(','ü§ñ\x20API\x20Cooldown.\x20Waiting\x202s...','search','ü§ñ\x20BUTLER:\x20Executing\x20Action\x20->\x20','.forecast.current.temperature','ü§ñ\x20Traffic\x20Schutz:\x20Anfrage\x20f√ºr\x20','LTM.processingStatus','Tag','weatherInstance','PRIORIT√ÑT:\x20Energie\x20sparen.\x20Schalte\x20nur,\x20wenn\x20absolut\x20notwendig\x20(Dunkelheit).','.\x20SYSTEM_MODE:\x20','approved','normal','\x20√ºbersprungen\x20(Auto-Approved).','reason','config','BUTLER\x20Execution\x20Error:\x20','setStateAsync','ü§ñ\x20Butler\x20Brain\x20Error:\x20','Wetterdaten\x20nicht\x20abrufbar','filter','Briefing\x20Error:\x20','LTM.dailyDigests','\x0a\x20\x20\x20\x20EVENTS:\x0a','analysis.automation.targetValue','.Current.WeatherText','sendNotification','¬∞C,\x20','activityLevel','analysisHistory','trim','livingContext','Sicherheit\x20geht\x20vor.','.\x20ANWESEND:\x20','üåÖ\x20Briefing\x20generated\x20(Length:\x20','text',').\x20Sending\x20notification...','aiPersona','14542ZkDJqV','value','Skipped\x20(Traffic)','timestamp','.Current.IsNight','detected','ANALYZE_HEALTH','2-digit','description','currentSystemMode','.\x20KONTEXT:\x20','ltmStbWindowDays','7QSKMJI','KI-Fehler\x20(Fallback)','ROLLE:\x20Data\x20Compression\x20Agent.\x20SPRACHE:\x20DE.\x20FORMAT:\x20JSON.\x20ANWEISUNG:\x20Fasse\x20Sensor-Events\x20zusammen.\x20SCHEMA:\x20{\x20\x22summary\x22:\x20\x22string\x22,\x20\x22activityLevel\x22:\x20\x22string\x22\x20}\x20\x0a\x0aEVENTS:\x0a','replace','toLocaleTimeString','NIGHT','Keine\x20Details.','\x0a\x20\x20\x20\x20ROLLE:\x20Haus-Butler.\x0a\x20\x20\x20\x20SITUATION:\x20','Gemini\x20Error:\x20','üåÖ\x20Starting\x20Morning\x20Briefing\x20sequence\x20(Traffic\x20Check\x20bypassed)...','getDate','analysis.analysisHistory','.\x20EVENTS:\x20','isAlert',',\x20Wetter:\x20','getTime','toFixed','response','\x0a\x20\x20\x20\x20FRAGE:\x20Ist\x20es\x20dunkel\x20genug\x20f√ºr\x20Licht?\x0a\x20\x20\x20\x20FORMAT:\x20{\x20\x22approved\x22:\x20boolean,\x20\x22reason\x22:\x20\x22kurzer\x20Grund\x22\x20}\x0a\x20\x20\x20\x20','analysis.health.geminiDay','\x22\x20AN.\x0a\x20\x20\x20\x20STRATEGIE:\x20','ü§ñ\x20Autopilot\x20skipped\x20(Traffic\x20Protection\x20active).','driftDetails','\x0a\x20\x20\x20\x20ROLLE:\x20Medizinischer\x20Assistent\x20f√ºr\x20AAL\x20(Ambient\x20Assisted\x20Living).\x0a\x20\x20\x20\x20AUFGABE:\x20','decision','LTM.driftAnalysis.baselineDrift','3qdemWP','message','push','automationProposal','analysis.activitySummary','lastAlertState','stringify','Analysiere\x20diese\x20Events\x20des\x20TAGES\x20(08:00-Jetzt).\x20Aktivit√§t?\x20Mahlzeiten?\x20Haust√ºr?\x20Antwort\x20kurz\x20f√ºr\x20den\x20besorgten\x20Sohn\x20(max\x202\x20S√§tze).','Fokus\x20auf\x20Komfort\x20f√ºr\x20die\x20Familie.','Unbekannt\x20(Kein\x20Sensor)','analysis.health.geminiNight','setHours','Started...','geminiModel','analysis.automation.description','models/gemini-flash-latest','val','2120592hSiumM','toString','map','debug','Maximaler\x20Komfort,\x20Energie\x20ist\x20zweitrangig.','alertReason','generic','splice','length','3930HjbtZS','analysis.lastResult','72404Qylwtn','\x20->\x20','.\x20EMERGENCY:\x20','6970uSwWeC','join','analysis.isAlert','ü§ñ\x20BUTLER:\x20No\x20valid\x20target\x20ID\x20or\x20value\x20stored\x20for\x20execution.','analysis.automation.autoApply','useWeather','.forecast.current.state','ROLLE:\x20Data\x20Scientist.\x20ZIEL:\x20Drift\x20erkennen.\x20SCHEMA:\x20{\x20\x22baselineDrift\x22:\x20\x22none|slight|significant|critical\x22,\x20\x22driftDetails\x22:\x20\x22string\x22\x20}\x0a\x0aLTB:\x20','exports','getStateAsync','%)\x20nach\x20\x22','rawEventLog'];a0_0x3a5f=function(){return _0x4115e4;};return a0_0x3a5f();}async function getWeatherContext(_0x5b9a40){const _0x1f2798=a0_0x1425a8;if(!_0x5b9a40[_0x1f2798(0x1e5)][_0x1f2798(0x1aa)]||!_0x5b9a40[_0x1f2798(0x1e5)]['weatherInstance'])return _0x1f2798(0x18f);try{const _0x1c44b9=_0x5b9a40[_0x1f2798(0x1e5)][_0x1f2798(0x1de)];let _0x9e9b8e=await _0x5b9a40[_0x1f2798(0x1c9)](_0x1c44b9+'.Current.Temperature');if(!_0x9e9b8e)_0x9e9b8e=await _0x5b9a40[_0x1f2798(0x1c9)](_0x1c44b9+_0x1f2798(0x1da));let _0x1d1720=await _0x5b9a40[_0x1f2798(0x1c9)](_0x1c44b9+_0x1f2798(0x1ef));if(!_0x1d1720)_0x1d1720=await _0x5b9a40[_0x1f2798(0x1c9)](_0x1c44b9+_0x1f2798(0x1ab));let _0x1a5357=_0x1f2798(0x1cd);const _0x5c0944=await _0x5b9a40[_0x1f2798(0x1c9)](_0x1c44b9+_0x1f2798(0x200));if(_0x5c0944)_0x1a5357=_0x5c0944[_0x1f2798(0x196)]?'Nacht':_0x1f2798(0x1dd);if(_0x9e9b8e&&_0x1d1720)return _0x9e9b8e[_0x1f2798(0x196)]+_0x1f2798(0x1f1)+_0x1d1720[_0x1f2798(0x196)]+_0x1f2798(0x1d3)+_0x1a5357;}catch(_0x3eb657){}return _0x1f2798(0x1e9);}async function consultButler(_0xa8a906,_0x39c571,_0xc4c302,_0x288988){const _0x218ad5=a0_0x1425a8;if(!_0xa8a906['geminiModel'])return{'approved':!![],'reason':'KI\x20offline\x20(Fallback)'};const _0x3b0a73=Date[_0x218ad5(0x1c3)]();if(decisionCache[_0x39c571]&&_0x3b0a73-decisionCache[_0x39c571]['timestamp']<CACHE_TTL_MS){const _0x3746a7=decisionCache[_0x39c571][_0x218ad5(0x184)];return _0xa8a906[_0x218ad5(0x1ce)][_0x218ad5(0x19a)](_0x218ad5(0x1cc)+_0x39c571+_0x218ad5(0x1a3)+(_0x3746a7[_0x218ad5(0x1e1)]?'OK':'NO')+'\x20('+_0x3746a7[_0x218ad5(0x1e4)]+')'),_0x3746a7;}if(!canCallApi())return _0xa8a906[_0x218ad5(0x1ce)][_0x218ad5(0x19a)](_0x218ad5(0x1db)+_0x39c571+_0x218ad5(0x1e3)),{'approved':!![],'reason':'Traffic-Schutz\x20(Auto-Approved)'};const _0x46be28=new Date()[_0x218ad5(0x20c)](),_0x26265d=await getWeatherContext(_0xa8a906),_0x567741=PERSONA_MAPPING[_0xa8a906[_0x218ad5(0x1e5)][_0x218ad5(0x1fb)]||_0x218ad5(0x19d)],_0x43f769=_0x218ad5(0x20f)+_0x46be28+_0x218ad5(0x216)+_0x26265d+_0x218ad5(0x1d6)+(_0x288988*0x64)[_0x218ad5(0x218)](0x0)+_0x218ad5(0x1af)+_0x39c571+'\x22.\x0a\x20\x20\x20\x20AKTION:\x20Schalte\x20\x22'+_0xc4c302+_0x218ad5(0x21c)+_0x567741+_0x218ad5(0x21a);try{updateApiTimestamp();const _0x4fe0a4=await _0xa8a906['geminiModel'][_0x218ad5(0x1be)](_0x43f769),_0x34d0d1=_0x4fe0a4['response']['text']()[_0x218ad5(0x20b)](/```json|```/g,'')[_0x218ad5(0x1f4)](),_0x35e5a2=JSON[_0x218ad5(0x1cf)](_0x34d0d1);return decisionCache[_0x39c571]={'decision':_0x35e5a2,'timestamp':_0x3b0a73},_0x35e5a2;}catch(_0x1fefc4){return _0xa8a906[_0x218ad5(0x1ce)][_0x218ad5(0x1c4)](_0x218ad5(0x1e8)+_0x1fefc4[_0x218ad5(0x187)]),decisionCache[_0x39c571]={'decision':{'approved':!![],'reason':_0x218ad5(0x209)},'timestamp':_0x3b0a73-(CACHE_TTL_MS-0xea60)},{'approved':!![],'reason':_0x218ad5(0x209)};}}async function runGeminiAnalysis(_0x15e781,_0x2ee15f=''){const _0x5729e3=a0_0x1425a8;if(!_0x15e781[_0x5729e3(0x193)])return;if(!canCallApi()){_0x15e781['log'][_0x5729e3(0x19a)](_0x5729e3(0x21d));return;}if(_0x15e781[_0x5729e3(0x1b8)]['length']===0x0)return;const _0x5a07cc=_0x15e781[_0x5729e3(0x1b8)]['slice'](0x0,0xf),_0x453207=_0x15e781[_0x5729e3(0x205)],_0x2339ca=PERSONA_MAPPING[_0x15e781['config'][_0x5729e3(0x1fb)]||_0x5729e3(0x19d)],_0x3c8572=_0x15e781[_0x5729e3(0x1e5)][_0x5729e3(0x1f5)]||_0x5729e3(0x20e);let _0x1b358b='Unbekannt';try{const _0x2a1476=await _0x15e781[_0x5729e3(0x1ae)]('system.presenceWho');if(_0x2a1476&&_0x2a1476[_0x5729e3(0x196)])_0x1b358b=_0x2a1476[_0x5729e3(0x196)];}catch(_0x54a640){}let _0xbbb4cb=![];try{const _0x5f504b=await _0x15e781[_0x5729e3(0x1ae)](_0x5729e3(0x1a9));if(_0x5f504b&&_0x5f504b[_0x5729e3(0x196)])_0xbbb4cb=!![];}catch(_0x2492c3){}const _0x3141a4=_0x5729e3(0x1b6)+_0x2339ca+_0x5729e3(0x206)+_0x3c8572+_0x5729e3(0x1e0)+_0x453207+_0x5729e3(0x1f7)+_0x1b358b+_0x5729e3(0x214)+JSON[_0x5729e3(0x18c)](_0x5a07cc)+_0x5729e3(0x1a4)+_0x2ee15f+_0x5729e3(0x1c8);try{updateApiTimestamp();const _0x3c749c=await _0x15e781['geminiModel'][_0x5729e3(0x1be)](_0x3141a4),_0x10284d=JSON[_0x5729e3(0x1cf)](_0x3c749c['response'][_0x5729e3(0x1f9)]()[_0x5729e3(0x20b)](/```json|```/g,'')[_0x5729e3(0x1f4)]());await _0x15e781[_0x5729e3(0x1e7)](_0x5729e3(0x1a1),{'val':JSON[_0x5729e3(0x18c)](_0x10284d),'ack':!![]});if(_0x10284d[_0x5729e3(0x1b2)])await _0x15e781[_0x5729e3(0x1e7)](_0x5729e3(0x18a),{'val':_0x10284d[_0x5729e3(0x1b2)],'ack':!![]});const _0x103f73={'timestamp':Date['now'](),'id':Date[_0x5729e3(0x1c3)]()['toString'](),'analysis':{'activity':{'summary':_0x10284d['summary'],'isAlert':_0x10284d[_0x5729e3(0x215)],'alertReason':_0x10284d[_0x5729e3(0x19c)]},'comfort':{'automationProposal':_0x10284d[_0x5729e3(0x189)]}}};_0x15e781['analysisHistory'][_0x5729e3(0x1cb)](_0x103f73);if(_0x15e781[_0x5729e3(0x1f3)]['length']>0x32)_0x15e781[_0x5729e3(0x1f3)]['pop']();await _0x15e781[_0x5729e3(0x1e7)](_0x5729e3(0x213),{'val':JSON[_0x5729e3(0x18c)](_0x15e781['analysisHistory']),'ack':!![]});const _0x27b692=_0x10284d[_0x5729e3(0x215)]||![];_0x27b692!==_0x15e781[_0x5729e3(0x18b)]&&(await _0x15e781[_0x5729e3(0x1e7)](_0x5729e3(0x1a7),{'val':_0x27b692,'ack':!![]}),_0x15e781[_0x5729e3(0x18b)]=_0x27b692,_0x27b692&&(await _0x15e781[_0x5729e3(0x1e7)]('analysis.alertReason',{'val':_0x10284d[_0x5729e3(0x19c)],'ack':!![]}),setup[_0x5729e3(0x1f0)](_0x15e781,'‚ö†Ô∏è\x20ALARM:\x20'+_0x10284d[_0x5729e3(0x19c)],![],_0x10284d['isEmergency'])));if(_0x10284d[_0x5729e3(0x189)]&&_0x10284d[_0x5729e3(0x189)][_0x5729e3(0x201)]){await _0x15e781[_0x5729e3(0x1e7)]('analysis.automation.patternDetected',{'val':!![],'ack':!![]}),await _0x15e781[_0x5729e3(0x1e7)](_0x5729e3(0x194),{'val':_0x10284d['automationProposal'][_0x5729e3(0x204)],'ack':!![]}),await _0x15e781[_0x5729e3(0x1e7)](_0x5729e3(0x1ca),{'val':_0x10284d[_0x5729e3(0x189)][_0x5729e3(0x1b5)],'ack':!![]}),await _0x15e781[_0x5729e3(0x1e7)](_0x5729e3(0x1ee),{'val':JSON[_0x5729e3(0x18c)](_0x10284d[_0x5729e3(0x189)]['targetValue']),'ack':!![]});if(_0xbbb4cb)executeAutomationAction(_0x15e781);}}catch(_0x1eb7c6){_0x15e781[_0x5729e3(0x1ce)][_0x5729e3(0x1bb)](_0x5729e3(0x210)+_0x1eb7c6[_0x5729e3(0x187)]);}}async function createDailyDigest(_0x44656e,_0x4ab241){const _0x25ad36=a0_0x1425a8;if(!_0x44656e[_0x25ad36(0x1bc)])return;if(!canCallApi()){await _0x44656e[_0x25ad36(0x1e7)](LTM_DP_STATUS,{'val':_0x25ad36(0x1fe),'ack':!![]});return;}await _0x44656e[_0x25ad36(0x1e7)](LTM_DP_STATUS,{'val':_0x25ad36(0x192),'ack':!![]});if(!_0x44656e['geminiModel']||_0x44656e[_0x25ad36(0x1b0)][_0x25ad36(0x19f)]<LTM_MIN_EVENTS_FOR_COMPRESSION){await _0x44656e[_0x25ad36(0x1e7)](LTM_DP_STATUS,{'val':'Skipped\x20(No\x20AI\x20or\x20Data)','ack':!![]});return;}const _0x7790eb=JSON['parse'](JSON[_0x25ad36(0x18c)](_0x44656e[_0x25ad36(0x1b0)])),_0x2e4604=_0x7790eb[_0x25ad36(0x19f)],_0x157df3=_0x25ad36(0x20a)+JSON[_0x25ad36(0x18c)](_0x7790eb);try{updateApiTimestamp();const _0x43ca9e=await _0x44656e['geminiModel'][_0x25ad36(0x1be)](_0x157df3),_0x3eec0d=JSON[_0x25ad36(0x1cf)](_0x43ca9e[_0x25ad36(0x219)][_0x25ad36(0x1f9)]()[_0x25ad36(0x20b)](/```json|```/g,'')[_0x25ad36(0x1f4)]()),_0x48c964={'timestamp':new Date()['toISOString'](),'eventCount':_0x2e4604,'summary':_0x3eec0d[_0x25ad36(0x1b2)]||'Digest','activityLevel':_0x3eec0d['activityLevel']||_0x25ad36(0x1e2),'systemMode':_0x44656e[_0x25ad36(0x205)]};_0x44656e['dailyDigests'][_0x25ad36(0x188)](_0x48c964);const _0x213338=_0x44656e[_0x25ad36(0x1e5)][_0x25ad36(0x1b1)]||0x3c;_0x44656e[_0x25ad36(0x1ba)][_0x25ad36(0x19f)]>_0x213338&&_0x44656e[_0x25ad36(0x1ba)][_0x25ad36(0x19e)](0x0,_0x44656e[_0x25ad36(0x1ba)]['length']-_0x213338);await _0x44656e['setStateAsync'](LTM_DP_DAILY_DIGESTS,{'val':JSON[_0x25ad36(0x18c)](_0x44656e[_0x25ad36(0x1ba)]),'ack':!![]}),_0x44656e[_0x25ad36(0x1b0)]=[],await _0x44656e[_0x25ad36(0x1e7)](LTM_DP_RAW_LOG,{'val':JSON[_0x25ad36(0x18c)](_0x44656e[_0x25ad36(0x1b0)]),'ack':!![]}),await _0x44656e[_0x25ad36(0x1e7)](LTM_DP_STATUS,{'val':'Success','ack':!![]});const _0x3e1f17=_0x25ad36(0x1c5)+_0x3eec0d[_0x25ad36(0x1b2)]+'\x0aAktivit√§t:\x20'+_0x3eec0d[_0x25ad36(0x1f2)];setup['sendNotification'](_0x44656e,_0x3e1f17,![],![]);if(_0x44656e['isProVersion']&&_0x4ab241)_0x4ab241['send'](_0x44656e,_0x25ad36(0x202),{'digest':_0x48c964});}catch(_0x55279e){_0x44656e[_0x25ad36(0x1ce)][_0x25ad36(0x1bb)](_0x55279e[_0x25ad36(0x187)]);}}async function runBaselineDriftAnalysis(_0x5d818b){const _0x176a44=a0_0x1425a8;if(!_0x5d818b['isProVersion']||!_0x5d818b[_0x176a44(0x193)])return;if(!canCallApi())return;const _0x530ff3=_0x5d818b[_0x176a44(0x1e5)][_0x176a44(0x207)]||0xe;if(_0x5d818b[_0x176a44(0x1ba)][_0x176a44(0x19f)]<_0x530ff3+0x7){await _0x5d818b[_0x176a44(0x1e7)](_0x176a44(0x185),{'val':_0x176a44(0x1c1),'ack':!![]});return;}const _0xf4b4df=_0x5d818b[_0x176a44(0x1ba)]['slice'](-_0x530ff3),_0x48590c=_0x5d818b['dailyDigests']['slice'](0x0,_0x5d818b[_0x176a44(0x1ba)][_0x176a44(0x19f)]-_0x530ff3),_0xb1f027=_0x176a44(0x1ac)+JSON[_0x176a44(0x18c)](_0x48590c)+'\x0aSTB:\x20'+JSON['stringify'](_0xf4b4df);try{updateApiTimestamp();const _0x3588e8=await _0x5d818b[_0x176a44(0x193)][_0x176a44(0x1be)](_0xb1f027),_0x2438d1=JSON['parse'](_0x3588e8[_0x176a44(0x219)]['text']()[_0x176a44(0x20b)](/```json|```/g,'')[_0x176a44(0x1f4)]());_0x2438d1['baselineDrift']&&(await _0x5d818b['setStateAsync'](_0x176a44(0x185),{'val':_0x2438d1['baselineDrift'],'ack':!![]}),await _0x5d818b[_0x176a44(0x1e7)]('LTM.driftAnalysis.driftDetails',{'val':_0x2438d1[_0x176a44(0x182)],'ack':!![]}),await _0x5d818b[_0x176a44(0x1e7)](_0x176a44(0x1b3),{'val':Date[_0x176a44(0x1c3)](),'ack':!![]}));}catch(_0x178b50){}}async function executeAutomationAction(_0x57bce6){const _0xd338c1=a0_0x1425a8;try{const _0x5428a4=await _0x57bce6[_0xd338c1(0x1ae)](_0xd338c1(0x1ca)),_0x47a22f=await _0x57bce6['getStateAsync'](_0xd338c1(0x1ee));if(_0x5428a4&&_0x5428a4[_0xd338c1(0x196)]&&_0x47a22f){const _0x21c9d9=_0x5428a4['val'];let _0x3cdb4f=_0x47a22f[_0xd338c1(0x196)];try{_0x3cdb4f=JSON[_0xd338c1(0x1cf)](_0x3cdb4f);}catch(_0x386859){}_0x57bce6['log'][_0xd338c1(0x1b9)](_0xd338c1(0x1d9)+_0x21c9d9+'\x20=\x20'+_0x3cdb4f),await _0x57bce6['setForeignStateAsync'](_0x21c9d9,_0x3cdb4f);}else _0x57bce6['log']['warn'](_0xd338c1(0x1a8));}catch(_0x3b5704){_0x57bce6['log'][_0xd338c1(0x1bb)](_0xd338c1(0x1e6)+_0x3b5704[_0xd338c1(0x187)]);}}async function sendMorningBriefing(_0x28b698){const _0xf06f37=a0_0x1425a8;if(!_0x28b698['geminiModel']){_0x28b698['log'][_0xf06f37(0x1c4)]('ü§ñ\x20Morning\x20Briefing\x20skipped:\x20No\x20Gemini\x20Model.');return;}_0x28b698[_0xf06f37(0x1ce)][_0xf06f37(0x1b9)](_0xf06f37(0x211));try{updateApiTimestamp();const _0x55db7a='Erstelle\x20ein\x20kurzes\x20\x27Guten\x20Morgen\x27\x20Briefing\x20basierend\x20auf\x20den\x20Events\x20der\x20letzten\x20Nacht.',_0x27f078=await _0x28b698[_0xf06f37(0x193)][_0xf06f37(0x1be)](_0x55db7a),_0x5eda60=_0x27f078[_0xf06f37(0x219)]['text']();_0x28b698[_0xf06f37(0x1ce)][_0xf06f37(0x1b9)](_0xf06f37(0x1f8)+_0x5eda60[_0xf06f37(0x19f)]+_0xf06f37(0x1fa)),setup[_0xf06f37(0x1f0)](_0x28b698,'üåÖ\x20Morning\x20Briefing:\x0a'+_0x5eda60);}catch(_0x627679){_0x28b698['log']['error'](_0xf06f37(0x1eb)+_0x627679[_0xf06f37(0x187)]);}}async function generateHealthReport(_0x46b0e8,_0x19dd64){const _0x2dcd95=a0_0x1425a8;if(!_0x46b0e8['geminiModel'])return;const _0x162ba5=Date[_0x2dcd95(0x1c3)]();_0x162ba5-lastGlobalApiCall<0xbb8&&(_0x46b0e8[_0x2dcd95(0x1ce)][_0x2dcd95(0x19a)](_0x2dcd95(0x1d7)),await new Promise(_0x2c4374=>setTimeout(_0x2c4374,0x7d0)));const _0xccf13f=new Date();let _0x3ba4f1=0x0,_0x1c6dee=_0xccf13f[_0x2dcd95(0x217)](),_0x59cfd6='';if(_0x19dd64===_0x2dcd95(0x20d)){const _0x3aaeff=new Date(_0xccf13f);_0x3aaeff[_0x2dcd95(0x1d4)](_0x3aaeff[_0x2dcd95(0x212)]()-0x1),_0x3aaeff[_0x2dcd95(0x191)](0x16,0x0,0x0,0x0),_0x3ba4f1=_0x3aaeff[_0x2dcd95(0x217)]();const _0x4cfa86=new Date(_0xccf13f);_0x4cfa86['setHours'](0x8,0x0,0x0,0x0),_0x1c6dee=_0x4cfa86[_0x2dcd95(0x217)](),_0x59cfd6='Analysiere\x20diese\x20Events\x20der\x20NACHT\x20(22:00-08:00).\x20War\x20der\x20Schlaf\x20ruhig?\x20Gab\x20es\x20Badg√§nge?\x20Antwort\x20kurz\x20f√ºr\x20den\x20besorgten\x20Sohn\x20(max\x202\x20S√§tze).';}else{const _0x50ee61=new Date(_0xccf13f);_0x50ee61['setHours'](0x8,0x0,0x0,0x0),_0x3ba4f1=_0x50ee61[_0x2dcd95(0x217)](),_0x59cfd6=_0x2dcd95(0x18d);}const _0x3336de=_0x46b0e8[_0x2dcd95(0x1b8)][_0x2dcd95(0x1ea)](_0x3c9df0=>_0x3c9df0[_0x2dcd95(0x1ff)]>=_0x3ba4f1&&_0x3c9df0[_0x2dcd95(0x1ff)]<=_0x1c6dee);if(_0x3336de['length']===0x0){const _0x49d9b5=_0x19dd64===_0x2dcd95(0x20d)?_0x2dcd95(0x1c7):_0x2dcd95(0x1c0),_0x4e5330=_0x19dd64==='NIGHT'?_0x2dcd95(0x190):_0x2dcd95(0x21b);await _0x46b0e8[_0x2dcd95(0x1e7)](_0x4e5330,{'val':_0x49d9b5,'ack':!![]});return;}const _0x4268e7=_0x3336de[_0x2dcd95(0x199)](_0x530d17=>new Date(_0x530d17[_0x2dcd95(0x1ff)])['toLocaleTimeString']([],{'hour':_0x2dcd95(0x203),'minute':_0x2dcd95(0x203)})+'\x20'+_0x530d17['name']+'\x20('+_0x530d17[_0x2dcd95(0x1fd)]+')')[_0x2dcd95(0x1a6)]('\x0a'),_0x1eb10c=_0x2dcd95(0x183)+_0x59cfd6+_0x2dcd95(0x1ed)+_0x4268e7+'\x0a\x20\x20\x20\x20ANTWORT-STIL:\x20Sachlich,\x20beruhigend,\x20pr√§zise.\x20Keine\x20Floskeln.\x0a\x20\x20\x20\x20';try{updateApiTimestamp();const _0x7ff3f7=await _0x46b0e8[_0x2dcd95(0x193)]['generateContent'](_0x1eb10c),_0x5a124b=_0x7ff3f7[_0x2dcd95(0x219)][_0x2dcd95(0x1f9)](),_0x26c430=_0x19dd64==='NIGHT'?_0x2dcd95(0x190):'analysis.health.geminiDay';await _0x46b0e8[_0x2dcd95(0x1e7)](_0x26c430,{'val':_0x5a124b,'ack':!![]}),_0x46b0e8[_0x2dcd95(0x1ce)]['info'](_0x2dcd95(0x1c6)+_0x19dd64+_0x2dcd95(0x1d2));}catch(_0x55874c){_0x46b0e8[_0x2dcd95(0x1ce)]['error'](_0x2dcd95(0x1bd)+_0x55874c[_0x2dcd95(0x187)]);}}module[a0_0x1425a8(0x1ad)]={'executeAutomationAction':executeAutomationAction,'createDailyDigest':createDailyDigest,'runBaselineDriftAnalysis':runBaselineDriftAnalysis,'sendMorningBriefing':sendMorningBriefing,'runGeminiAnalysis':runGeminiAnalysis,'consultButler':consultButler,'generateHealthReport':generateHealthReport};