const a0_0x54f657=a0_0x40d6;(function(_0x565b0,_0x102f17){const _0x4965c4=a0_0x40d6,_0x32f83f=_0x565b0();while(!![]){try{const _0x2c7424=-parseInt(_0x4965c4(0xd9))/0x1+-parseInt(_0x4965c4(0xd4))/0x2+parseInt(_0x4965c4(0xe7))/0x3*(parseInt(_0x4965c4(0xd3))/0x4)+parseInt(_0x4965c4(0x89))/0x5*(parseInt(_0x4965c4(0xbd))/0x6)+-parseInt(_0x4965c4(0xd5))/0x7+parseInt(_0x4965c4(0xd1))/0x8+parseInt(_0x4965c4(0x99))/0x9*(parseInt(_0x4965c4(0x84))/0xa);if(_0x2c7424===_0x102f17)break;else _0x32f83f['push'](_0x32f83f['shift']());}catch(_0x29f181){_0x32f83f['push'](_0x32f83f['shift']());}}}(a0_0x3ea3,0x2dae0));function a0_0x3ea3(){const _0x1aa349=['.\x20AUFGABE:\x201.\x20Gesundheit?\x202.\x20Komfort?\x20FORMAT\x20(JSON):\x20{\x20\x22isAlert\x22:\x20boolean,\x20\x22alertReason\x22:\x20\x22string\x22,\x20\x22isEmergency\x22:\x20boolean,\x20\x22summary\x22:\x20\x22string\x22,\x20\x22automationProposal\x22:\x20{\x20\x22detected\x22:\x20boolean,\x20\x22description\x22:\x20\x22string\x22,\x20\x22targetId\x22:\x20\x22string\x22,\x20\x22targetValue\x22:\x20\x22any\x22\x20}\x20}','Bisher\x20keine\x20AktivitÃ¤t\x20seit\x2008:00\x20Uhr\x20verzeichnet.','LTM.driftAnalysis.lastCheck','PRIORITÃ„T:\x20Sicherheit\x20und\x20Licht.\x20Schalte\x20lieber\x20einmal\x20zu\x20viel\x20als\x20zu\x20wenig.','normal','N/A\x20(Learning)','ðŸŒ…\x20Briefing\x20generated\x20(Length:\x20','isAlert','\x0a\x20\x20\x20\x20ROLLE:\x20Medizinischer\x20Assistent\x20fÃ¼r\x20AAL\x20(Ambient\x20Assisted\x20Living).\x0a\x20\x20\x20\x20AUFGABE:\x20','error','push','warn','\x0a\x20\x20\x20\x20ROLLE:\x20Haus-Butler.\x0a\x20\x20\x20\x20SITUATION:\x20','apply','splice','text','analysis.health.geminiDay','.\x20KONTEXT:\x20','weatherInstance','join','stringify','ROLLE:\x20Data\x20Scientist.\x20ZIEL:\x20Drift\x20erkennen.\x20SCHEMA:\x20{\x20\x22baselineDrift\x22:\x20\x22none|slight|significant|critical\x22,\x20\x22driftDetails\x22:\x20\x22string\x22\x20}\x0a\x0aLTB:\x20','toString','ðŸ¤–\x20Autopilot\x20skipped\x20(Traffic\x20Protection\x20active).','730PlVGWR','getTime','LTM.driftAnalysis.baselineDrift','sendNotification','rawEventLog','1578485hwmhyY','analysis.health.geminiNight','targetValue','ðŸ¤–\x20Butler\x20Brain\x20Error:\x20','filter','Gemini\x20Error:\x20','getForeignStateAsync','unshift','Nacht','Health\x20Report\x20Error:\x20','setForeignStateAsync','automationProposal','\x0aSTB:\x20','Skipped\x20(Traffic)','generic','isEmergency','12861jXJkBD','targetId','ANALYZE_HEALTH','.Current.Temperature','setStateAsync','\x20=\x20','.Current.WeatherText','ðŸ¤–\x20API\x20Cooldown.\x20Waiting\x202s...','NIGHT','currentSystemMode',',\x20Wetter:\x20','analysis.automation.autoApply','\x0a\x20\x20\x20\x20FRAGE:\x20Ist\x20es\x20dunkel\x20genug\x20fÃ¼r\x20Licht?\x0a\x20\x20\x20\x20FORMAT:\x20{\x20\x22approved\x22:\x20boolean,\x20\x22reason\x22:\x20\x22kurzer\x20Grund\x22\x20}\x0a\x20\x20\x20\x20','summary','response','KI\x20offline\x20(Fallback)','Unbekannt\x20(Kein\x20Sensor)','trim','value','analysis.automation.targetValue','ðŸ“…\x20Daily\x20Digest:\x0a','\x20->\x20','.forecast.current.state','isProVersion','Digest','Started...','timestamp','ðŸŒ…\x20Morning\x20Briefing:\x0a','ðŸ¤–\x20Traffic\x20Schutz:\x20Anfrage\x20fÃ¼r\x20','alertReason','analysis.analysisHistory','parse','%)\x20nach\x20\x22','\x20Ã¼bersprungen\x20(Auto-Approved).','message','2-digit','6YNfToY','search','BUTLER\x20Execution\x20Error:\x20','âš ï¸\x20ALARM:\x20','setHours','toFixed','map','slice','baselineDrift','decision','toLocaleTimeString','name','activityLevel','config','.forecast.current.temperature','Briefing\x20Error:\x20','Maximaler\x20Komfort,\x20Energie\x20ist\x20zweitrangig.','Analysiere\x20diese\x20Events\x20des\x20TAGES\x20(08:00-Jetzt).\x20AktivitÃ¤t?\x20Mahlzeiten?\x20HaustÃ¼r?\x20Antwort\x20kurz\x20fÃ¼r\x20den\x20besorgten\x20Sohn\x20(max\x202\x20SÃ¤tze).','getDate','ROLLE:\x20Data\x20Compression\x20Agent.\x20SPRACHE:\x20DE.\x20FORMAT:\x20JSON.\x20ANWEISUNG:\x20Fasse\x20Sensor-Events\x20zusammen.\x20SCHEMA:\x20{\x20\x22summary\x22:\x20\x22string\x22,\x20\x22activityLevel\x22:\x20\x22string\x22\x20}\x20\x0a\x0aEVENTS:\x0a','2850680OUVSKa','log','61756WTCQWx','523430TaeIQh','165809RsSarA','.\x20EVENTS:\x20','LTM.driftAnalysis.driftDetails',')\x20generated.','334721xTGzkg','ðŸ¤–\x20Health\x20Report\x20(','generateContent','length','replace','eventHistory','analysis.isAlert','KI-Fehler\x20(Fallback)','@google/generative-ai','\x0a\x20\x20\x20\x20ANTWORT-STIL:\x20Sachlich,\x20beruhigend,\x20prÃ¤zise.\x20Keine\x20Floskeln.\x0a\x20\x20\x20\x20','analysis.automation.targetId','ðŸ¤–\x20Morning\x20Briefing\x20skipped:\x20No\x20Gemini\x20Model.','analysis.lastResult','setDate','6LxkunA','Erstelle\x20ein\x20kurzes\x20\x27Guten\x20Morgen\x27\x20Briefing\x20basierend\x20auf\x20den\x20Events\x20der\x20letzten\x20Nacht.','aiPersona','getStateAsync','now','ðŸ¤–\x20BUTLER:\x20Executing\x20Action\x20->\x20','analysis.activitySummary','Fokus\x20auf\x20Komfort\x20fÃ¼r\x20die\x20Familie.','exports','ðŸ¤–\x20Butler\x20Cache\x20Hit:\x20','constructor','analysisHistory','LTM.dailyDigests','val','toISOString','.\x20SYSTEM_MODE:\x20',',\x20LichtverhÃ¤ltnisse:\x20','Unbekannt','send','dailyDigests','(((.+)+)+)+$','useWeather','geminiModel','debug','info','models/gemini-flash-latest','LTM.processingStatus'];a0_0x3ea3=function(){return _0x1aa349;};return a0_0x3ea3();}const a0_0x517a55=(function(){let _0x4d8ec4=!![];return function(_0x549514,_0xce70a7){const _0x15790c=_0x4d8ec4?function(){const _0x30b83d=a0_0x40d6;if(_0xce70a7){const _0x5a8fd1=_0xce70a7[_0x30b83d(0x79)](_0x549514,arguments);return _0xce70a7=null,_0x5a8fd1;}}:function(){};return _0x4d8ec4=![],_0x15790c;};}()),a0_0x11930c=a0_0x517a55(this,function(){const _0x517810=a0_0x40d6;return a0_0x11930c['toString']()[_0x517810(0xbe)](_0x517810(0xfb))[_0x517810(0x82)]()[_0x517810(0xf1)](a0_0x11930c)[_0x517810(0xbe)](_0x517810(0xfb));});a0_0x11930c();'use strict';const {GoogleGenerativeAI}=require(a0_0x54f657(0xe1)),setup=require('./setup'),GEMINI_MODEL=a0_0x54f657(0x100),LTM_DP_DAILY_DIGESTS=a0_0x54f657(0xf3),LTM_DP_STATUS=a0_0x54f657(0x101),LTM_DP_RAW_LOG='LTM.rawEventLog',LTM_MIN_EVENTS_FOR_COMPRESSION=0x5,MIN_API_GAP_MS=0x4e20;let lastGlobalApiCall=0x0;const decisionCache={},CACHE_TTL_MS=0xf*0x3c*0x3e8,PERSONA_MAPPING={'generic':'Entscheide\x20ausgewogen\x20zwischen\x20Komfort\x20und\x20Energie.','senior_aal':a0_0x54f657(0x6f),'family':a0_0x54f657(0xee),'single_comfort':a0_0x54f657(0xcd),'security':'Sicherheit\x20geht\x20vor.','energy_saver':'PRIORITÃ„T:\x20Energie\x20sparen.\x20Schalte\x20nur,\x20wenn\x20absolut\x20notwendig\x20(Dunkelheit).'};function a0_0x40d6(_0x217e76,_0x5b7bf0){const _0x539b02=a0_0x3ea3();return a0_0x40d6=function(_0x11930c,_0x517a55){_0x11930c=_0x11930c-0x6f;let _0x3ea3f9=_0x539b02[_0x11930c];return _0x3ea3f9;},a0_0x40d6(_0x217e76,_0x5b7bf0);}function canCallApi(){const _0x38111b=a0_0x54f657,_0x34f69d=Date[_0x38111b(0xeb)]();return _0x34f69d-lastGlobalApiCall>MIN_API_GAP_MS;}function updateApiTimestamp(){const _0x184087=a0_0x54f657;lastGlobalApiCall=Date[_0x184087(0xeb)]();}async function getWeatherContext(_0x51dc55){const _0x3e5f42=a0_0x54f657;if(!_0x51dc55[_0x3e5f42(0xca)][_0x3e5f42(0xfc)]||!_0x51dc55[_0x3e5f42(0xca)][_0x3e5f42(0x7e)])return _0x3e5f42(0xa9);try{const _0xef24f4=_0x51dc55[_0x3e5f42(0xca)][_0x3e5f42(0x7e)];let _0x2281ce=await _0x51dc55[_0x3e5f42(0x8f)](_0xef24f4+_0x3e5f42(0x9c));if(!_0x2281ce)_0x2281ce=await _0x51dc55['getForeignStateAsync'](_0xef24f4+_0x3e5f42(0xcb));let _0x57f389=await _0x51dc55[_0x3e5f42(0x8f)](_0xef24f4+_0x3e5f42(0x9f));if(!_0x57f389)_0x57f389=await _0x51dc55['getForeignStateAsync'](_0xef24f4+_0x3e5f42(0xaf));let _0x4bb095='Unbekannt';const _0x5de515=await _0x51dc55[_0x3e5f42(0x8f)](_0xef24f4+'.Current.IsNight');if(_0x5de515)_0x4bb095=_0x5de515['val']?_0x3e5f42(0x91):'Tag';if(_0x2281ce&&_0x57f389)return _0x2281ce[_0x3e5f42(0xf4)]+'Â°C,\x20'+_0x57f389[_0x3e5f42(0xf4)]+_0x3e5f42(0xf7)+_0x4bb095;}catch(_0x73cdf1){}return'Wetterdaten\x20nicht\x20abrufbar';}async function consultButler(_0x43b810,_0x4e2b53,_0x12adf4,_0x2ac8f8){const _0x1b181a=a0_0x54f657;if(!_0x43b810['geminiModel'])return{'approved':!![],'reason':_0x1b181a(0xa8)};const _0x17d17b=Date[_0x1b181a(0xeb)]();if(decisionCache[_0x4e2b53]&&_0x17d17b-decisionCache[_0x4e2b53][_0x1b181a(0xb3)]<CACHE_TTL_MS){const _0x348f53=decisionCache[_0x4e2b53][_0x1b181a(0xc6)];return _0x43b810['log']['debug'](_0x1b181a(0xf0)+_0x4e2b53+_0x1b181a(0xae)+(_0x348f53['approved']?'OK':'NO')+'\x20('+_0x348f53['reason']+')'),_0x348f53;}if(!canCallApi())return _0x43b810[_0x1b181a(0xd2)][_0x1b181a(0xfe)](_0x1b181a(0xb5)+_0x4e2b53+_0x1b181a(0xba)),{'approved':!![],'reason':'Traffic-Schutz\x20(Auto-Approved)'};const _0x19dac4=new Date()[_0x1b181a(0xc7)](),_0x5b2809=await getWeatherContext(_0x43b810),_0x19734e=PERSONA_MAPPING[_0x43b810['config'][_0x1b181a(0xe9)]||_0x1b181a(0x97)],_0x882169=_0x1b181a(0x78)+_0x19dac4+_0x1b181a(0xa3)+_0x5b2809+'.\x0a\x20\x20\x20\x20EVENT:\x20Bewohner\x20geht\x20wahrscheinlich\x20('+(_0x2ac8f8*0x64)[_0x1b181a(0xc2)](0x0)+_0x1b181a(0xb9)+_0x4e2b53+'\x22.\x0a\x20\x20\x20\x20AKTION:\x20Schalte\x20\x22'+_0x12adf4+'\x22\x20AN.\x0a\x20\x20\x20\x20STRATEGIE:\x20'+_0x19734e+_0x1b181a(0xa5);try{updateApiTimestamp();const _0x13c218=await _0x43b810[_0x1b181a(0xfd)][_0x1b181a(0xdb)](_0x882169),_0x3f80aa=_0x13c218[_0x1b181a(0xa7)]['text']()[_0x1b181a(0xdd)](/```json|```/g,'')['trim'](),_0x1968b8=JSON['parse'](_0x3f80aa);return decisionCache[_0x4e2b53]={'decision':_0x1968b8,'timestamp':_0x17d17b},_0x1968b8;}catch(_0x4d8fcb){return _0x43b810[_0x1b181a(0xd2)][_0x1b181a(0x77)](_0x1b181a(0x8c)+_0x4d8fcb[_0x1b181a(0xbb)]),decisionCache[_0x4e2b53]={'decision':{'approved':!![],'reason':_0x1b181a(0xe0)},'timestamp':_0x17d17b-(CACHE_TTL_MS-0xea60)},{'approved':!![],'reason':_0x1b181a(0xe0)};}}async function runGeminiAnalysis(_0x3d15fc,_0x355ec0=''){const _0x241630=a0_0x54f657;if(!_0x3d15fc[_0x241630(0xfd)])return;if(!canCallApi()){_0x3d15fc[_0x241630(0xd2)][_0x241630(0xfe)](_0x241630(0x83));return;}if(_0x3d15fc['eventHistory'][_0x241630(0xdc)]===0x0)return;const _0x1363e4=_0x3d15fc['eventHistory']['slice'](0x0,0xf),_0x252a0d=_0x3d15fc['currentSystemMode'],_0x5378b0=PERSONA_MAPPING[_0x3d15fc['config']['aiPersona']||_0x241630(0x97)],_0x3bd189=_0x3d15fc['config']['livingContext']||'Keine\x20Details.';let _0x5a0482=_0x241630(0xf8);try{const _0x3c4218=await _0x3d15fc['getStateAsync']('system.presenceWho');if(_0x3c4218&&_0x3c4218['val'])_0x5a0482=_0x3c4218[_0x241630(0xf4)];}catch(_0x598eb5){}let _0x649801=![];try{const _0x19b3cb=await _0x3d15fc[_0x241630(0xea)](_0x241630(0xa4));if(_0x19b3cb&&_0x19b3cb[_0x241630(0xf4)])_0x649801=!![];}catch(_0x24d417){}const _0x33c6d0='ROLLE:\x20KI-Hausverwalter.\x20PERSONA:\x20'+_0x5378b0+_0x241630(0x7d)+_0x3bd189+_0x241630(0xf6)+_0x252a0d+'.\x20ANWESEND:\x20'+_0x5a0482+_0x241630(0xd6)+JSON[_0x241630(0x80)](_0x1363e4)+'.\x20EMERGENCY:\x20'+_0x355ec0+_0x241630(0x102);try{updateApiTimestamp();const _0x57e6ab=await _0x3d15fc[_0x241630(0xfd)][_0x241630(0xdb)](_0x33c6d0),_0x119452=JSON['parse'](_0x57e6ab[_0x241630(0xa7)][_0x241630(0x7b)]()['replace'](/```json|```/g,'')['trim']());await _0x3d15fc[_0x241630(0x9d)](_0x241630(0xe5),{'val':JSON[_0x241630(0x80)](_0x119452),'ack':!![]});if(_0x119452[_0x241630(0xa6)])await _0x3d15fc['setStateAsync'](_0x241630(0xed),{'val':_0x119452[_0x241630(0xa6)],'ack':!![]});const _0x5aa8c5={'timestamp':Date[_0x241630(0xeb)](),'id':Date[_0x241630(0xeb)]()[_0x241630(0x82)](),'analysis':{'activity':{'summary':_0x119452['summary'],'isAlert':_0x119452[_0x241630(0x73)],'alertReason':_0x119452['alertReason']},'comfort':{'automationProposal':_0x119452[_0x241630(0x94)]}}};_0x3d15fc[_0x241630(0xf2)][_0x241630(0x90)](_0x5aa8c5);if(_0x3d15fc[_0x241630(0xf2)][_0x241630(0xdc)]>0x32)_0x3d15fc[_0x241630(0xf2)]['pop']();await _0x3d15fc[_0x241630(0x9d)](_0x241630(0xb7),{'val':JSON[_0x241630(0x80)](_0x3d15fc['analysisHistory']),'ack':!![]});const _0x3a2e5e=_0x119452[_0x241630(0x73)]||![];_0x3a2e5e!==_0x3d15fc['lastAlertState']&&(await _0x3d15fc[_0x241630(0x9d)](_0x241630(0xdf),{'val':_0x3a2e5e,'ack':!![]}),_0x3d15fc['lastAlertState']=_0x3a2e5e,_0x3a2e5e&&(await _0x3d15fc[_0x241630(0x9d)]('analysis.alertReason',{'val':_0x119452[_0x241630(0xb6)],'ack':!![]}),setup[_0x241630(0x87)](_0x3d15fc,_0x241630(0xc0)+_0x119452[_0x241630(0xb6)],![],_0x119452[_0x241630(0x98)])));if(_0x119452[_0x241630(0x94)]&&_0x119452[_0x241630(0x94)]['detected']){await _0x3d15fc['setStateAsync']('analysis.automation.patternDetected',{'val':!![],'ack':!![]}),await _0x3d15fc[_0x241630(0x9d)]('analysis.automation.description',{'val':_0x119452['automationProposal']['description'],'ack':!![]}),await _0x3d15fc[_0x241630(0x9d)]('analysis.automation.targetId',{'val':_0x119452[_0x241630(0x94)][_0x241630(0x9a)],'ack':!![]}),await _0x3d15fc[_0x241630(0x9d)](_0x241630(0xac),{'val':JSON[_0x241630(0x80)](_0x119452['automationProposal'][_0x241630(0x8b)]),'ack':!![]});if(_0x649801)executeAutomationAction(_0x3d15fc);}}catch(_0xf0b3b6){_0x3d15fc['log']['error'](_0x241630(0x8e)+_0xf0b3b6[_0x241630(0xbb)]);}}async function createDailyDigest(_0x2627e9,_0x38c1c1){const _0x409fe6=a0_0x54f657;if(!_0x2627e9[_0x409fe6(0xb0)])return;if(!canCallApi()){await _0x2627e9[_0x409fe6(0x9d)](LTM_DP_STATUS,{'val':_0x409fe6(0x96),'ack':!![]});return;}await _0x2627e9['setStateAsync'](LTM_DP_STATUS,{'val':_0x409fe6(0xb2),'ack':!![]});if(!_0x2627e9[_0x409fe6(0xfd)]||_0x2627e9[_0x409fe6(0x88)][_0x409fe6(0xdc)]<LTM_MIN_EVENTS_FOR_COMPRESSION){await _0x2627e9[_0x409fe6(0x9d)](LTM_DP_STATUS,{'val':'Skipped\x20(No\x20AI\x20or\x20Data)','ack':!![]});return;}const _0x470f01=JSON[_0x409fe6(0xb8)](JSON[_0x409fe6(0x80)](_0x2627e9[_0x409fe6(0x88)])),_0xd199d5=_0x470f01['length'],_0x2f5236=_0x409fe6(0xd0)+JSON[_0x409fe6(0x80)](_0x470f01);try{updateApiTimestamp();const _0x59ae30=await _0x2627e9[_0x409fe6(0xfd)][_0x409fe6(0xdb)](_0x2f5236),_0x35d6c6=JSON[_0x409fe6(0xb8)](_0x59ae30[_0x409fe6(0xa7)]['text']()['replace'](/```json|```/g,'')[_0x409fe6(0xaa)]()),_0x1cd3d2={'timestamp':new Date()[_0x409fe6(0xf5)](),'eventCount':_0xd199d5,'summary':_0x35d6c6[_0x409fe6(0xa6)]||_0x409fe6(0xb1),'activityLevel':_0x35d6c6[_0x409fe6(0xc9)]||_0x409fe6(0x70),'systemMode':_0x2627e9[_0x409fe6(0xa2)]};_0x2627e9[_0x409fe6(0xfa)][_0x409fe6(0x76)](_0x1cd3d2);const _0x2ef1dc=_0x2627e9[_0x409fe6(0xca)]['ltmLtbWindowDays']||0x3c;_0x2627e9[_0x409fe6(0xfa)]['length']>_0x2ef1dc&&_0x2627e9[_0x409fe6(0xfa)][_0x409fe6(0x7a)](0x0,_0x2627e9['dailyDigests'][_0x409fe6(0xdc)]-_0x2ef1dc);await _0x2627e9[_0x409fe6(0x9d)](LTM_DP_DAILY_DIGESTS,{'val':JSON[_0x409fe6(0x80)](_0x2627e9[_0x409fe6(0xfa)]),'ack':!![]}),_0x2627e9[_0x409fe6(0x88)]=[],await _0x2627e9['setStateAsync'](LTM_DP_RAW_LOG,{'val':JSON[_0x409fe6(0x80)](_0x2627e9['rawEventLog']),'ack':!![]}),await _0x2627e9['setStateAsync'](LTM_DP_STATUS,{'val':'Success','ack':!![]});const _0x20cd22=_0x409fe6(0xad)+_0x35d6c6[_0x409fe6(0xa6)]+'\x0aAktivitÃ¤t:\x20'+_0x35d6c6[_0x409fe6(0xc9)];setup[_0x409fe6(0x87)](_0x2627e9,_0x20cd22,![],![]);if(_0x2627e9[_0x409fe6(0xb0)]&&_0x38c1c1)_0x38c1c1[_0x409fe6(0xf9)](_0x2627e9,_0x409fe6(0x9b),{'digest':_0x1cd3d2});}catch(_0xf08ff0){_0x2627e9[_0x409fe6(0xd2)]['error'](_0xf08ff0[_0x409fe6(0xbb)]);}}async function runBaselineDriftAnalysis(_0x29286b){const _0x23bcd2=a0_0x54f657;if(!_0x29286b[_0x23bcd2(0xb0)]||!_0x29286b['geminiModel'])return;if(!canCallApi())return;const _0x4bd273=_0x29286b[_0x23bcd2(0xca)]['ltmStbWindowDays']||0xe;if(_0x29286b[_0x23bcd2(0xfa)][_0x23bcd2(0xdc)]<_0x4bd273+0x7){await _0x29286b[_0x23bcd2(0x9d)](_0x23bcd2(0x86),{'val':_0x23bcd2(0x71),'ack':!![]});return;}const _0x365d98=_0x29286b['dailyDigests'][_0x23bcd2(0xc4)](-_0x4bd273),_0x1950de=_0x29286b[_0x23bcd2(0xfa)][_0x23bcd2(0xc4)](0x0,_0x29286b[_0x23bcd2(0xfa)][_0x23bcd2(0xdc)]-_0x4bd273),_0x2aa916=_0x23bcd2(0x81)+JSON[_0x23bcd2(0x80)](_0x1950de)+_0x23bcd2(0x95)+JSON[_0x23bcd2(0x80)](_0x365d98);try{updateApiTimestamp();const _0x3fdaf5=await _0x29286b[_0x23bcd2(0xfd)][_0x23bcd2(0xdb)](_0x2aa916),_0xb2e9ac=JSON[_0x23bcd2(0xb8)](_0x3fdaf5[_0x23bcd2(0xa7)][_0x23bcd2(0x7b)]()[_0x23bcd2(0xdd)](/```json|```/g,'')[_0x23bcd2(0xaa)]());_0xb2e9ac['baselineDrift']&&(await _0x29286b[_0x23bcd2(0x9d)]('LTM.driftAnalysis.baselineDrift',{'val':_0xb2e9ac[_0x23bcd2(0xc5)],'ack':!![]}),await _0x29286b['setStateAsync'](_0x23bcd2(0xd7),{'val':_0xb2e9ac['driftDetails'],'ack':!![]}),await _0x29286b['setStateAsync'](_0x23bcd2(0x104),{'val':Date[_0x23bcd2(0xeb)](),'ack':!![]}));}catch(_0x5dad72){}}async function executeAutomationAction(_0x17de72){const _0x2b6a7c=a0_0x54f657;try{const _0x1a7e96=await _0x17de72['getStateAsync'](_0x2b6a7c(0xe3)),_0x58389e=await _0x17de72[_0x2b6a7c(0xea)](_0x2b6a7c(0xac));if(_0x1a7e96&&_0x1a7e96[_0x2b6a7c(0xf4)]&&_0x58389e){const _0x23cc6c=_0x1a7e96['val'];let _0x4d8dfa=_0x58389e[_0x2b6a7c(0xf4)];try{_0x4d8dfa=JSON[_0x2b6a7c(0xb8)](_0x4d8dfa);}catch(_0x46d65a){}_0x17de72[_0x2b6a7c(0xd2)]['info'](_0x2b6a7c(0xec)+_0x23cc6c+_0x2b6a7c(0x9e)+_0x4d8dfa),await _0x17de72[_0x2b6a7c(0x93)](_0x23cc6c,_0x4d8dfa);}else _0x17de72[_0x2b6a7c(0xd2)][_0x2b6a7c(0x77)]('ðŸ¤–\x20BUTLER:\x20No\x20valid\x20target\x20ID\x20or\x20value\x20stored\x20for\x20execution.');}catch(_0x4c8eef){_0x17de72[_0x2b6a7c(0xd2)][_0x2b6a7c(0x75)](_0x2b6a7c(0xbf)+_0x4c8eef[_0x2b6a7c(0xbb)]);}}async function sendMorningBriefing(_0x5ce6d6){const _0x4cbd3a=a0_0x54f657;if(!_0x5ce6d6[_0x4cbd3a(0xfd)]){_0x5ce6d6[_0x4cbd3a(0xd2)][_0x4cbd3a(0x77)](_0x4cbd3a(0xe4));return;}_0x5ce6d6[_0x4cbd3a(0xd2)]['info']('ðŸŒ…\x20Starting\x20Morning\x20Briefing\x20sequence\x20(Traffic\x20Check\x20bypassed)...');try{updateApiTimestamp();const _0x18efa9=_0x4cbd3a(0xe8),_0x5750ac=await _0x5ce6d6[_0x4cbd3a(0xfd)][_0x4cbd3a(0xdb)](_0x18efa9),_0x600807=_0x5750ac['response']['text']();_0x5ce6d6['log'][_0x4cbd3a(0xff)](_0x4cbd3a(0x72)+_0x600807[_0x4cbd3a(0xdc)]+').\x20Sending\x20notification...'),setup[_0x4cbd3a(0x87)](_0x5ce6d6,_0x4cbd3a(0xb4)+_0x600807);}catch(_0x3f5d16){_0x5ce6d6[_0x4cbd3a(0xd2)][_0x4cbd3a(0x75)](_0x4cbd3a(0xcc)+_0x3f5d16[_0x4cbd3a(0xbb)]);}}async function generateHealthReport(_0x4f2ec5,_0x2da886){const _0x484f7b=a0_0x54f657;if(!_0x4f2ec5[_0x484f7b(0xfd)])return;const _0x1bae77=Date[_0x484f7b(0xeb)]();_0x1bae77-lastGlobalApiCall<0xbb8&&(_0x4f2ec5[_0x484f7b(0xd2)][_0x484f7b(0xfe)](_0x484f7b(0xa0)),await new Promise(_0x42be30=>setTimeout(_0x42be30,0x7d0)));const _0x93b552=new Date();let _0x38e7a4=0x0,_0x4f2ec6=_0x93b552[_0x484f7b(0x85)](),_0x14773f='';if(_0x2da886==='NIGHT'){const _0x4f4818=new Date(_0x93b552);_0x4f4818[_0x484f7b(0xe6)](_0x4f4818[_0x484f7b(0xcf)]()-0x1),_0x4f4818[_0x484f7b(0xc1)](0x16,0x0,0x0,0x0),_0x38e7a4=_0x4f4818['getTime']();const _0x22cc1c=new Date(_0x93b552);_0x22cc1c[_0x484f7b(0xc1)](0x8,0x0,0x0,0x0),_0x4f2ec6=_0x22cc1c[_0x484f7b(0x85)](),_0x14773f='Analysiere\x20diese\x20Events\x20der\x20NACHT\x20(22:00-08:00).\x20War\x20der\x20Schlaf\x20ruhig?\x20Gab\x20es\x20BadgÃ¤nge?\x20Antwort\x20kurz\x20fÃ¼r\x20den\x20besorgten\x20Sohn\x20(max\x202\x20SÃ¤tze).';}else{const _0x245063=new Date(_0x93b552);_0x245063[_0x484f7b(0xc1)](0x8,0x0,0x0,0x0),_0x38e7a4=_0x245063['getTime'](),_0x14773f=_0x484f7b(0xce);}const _0x568ba6=_0x4f2ec5[_0x484f7b(0xde)][_0x484f7b(0x8d)](_0x5e9eaa=>_0x5e9eaa[_0x484f7b(0xb3)]>=_0x38e7a4&&_0x5e9eaa[_0x484f7b(0xb3)]<=_0x4f2ec6);if(_0x568ba6['length']===0x0){const _0x3937d6=_0x2da886===_0x484f7b(0xa1)?'Keine\x20Daten\x20fÃ¼r\x20die\x20Nacht\x20aufgezeichnet\x20(Sensoren\x20ruhig).':_0x484f7b(0x103),_0x3a9ba3=_0x2da886==='NIGHT'?_0x484f7b(0x8a):_0x484f7b(0x7c);await _0x4f2ec5[_0x484f7b(0x9d)](_0x3a9ba3,{'val':_0x3937d6,'ack':!![]});return;}const _0x2030b9=_0x568ba6[_0x484f7b(0xc3)](_0x5043f6=>new Date(_0x5043f6[_0x484f7b(0xb3)])['toLocaleTimeString']([],{'hour':_0x484f7b(0xbc),'minute':_0x484f7b(0xbc)})+'\x20'+_0x5043f6[_0x484f7b(0xc8)]+'\x20('+_0x5043f6[_0x484f7b(0xab)]+')')[_0x484f7b(0x7f)]('\x0a'),_0x28406e=_0x484f7b(0x74)+_0x14773f+'\x0a\x20\x20\x20\x20EVENTS:\x0a'+_0x2030b9+_0x484f7b(0xe2);try{updateApiTimestamp();const _0x3bd515=await _0x4f2ec5[_0x484f7b(0xfd)]['generateContent'](_0x28406e),_0x507ade=_0x3bd515[_0x484f7b(0xa7)][_0x484f7b(0x7b)](),_0x136348=_0x2da886==='NIGHT'?_0x484f7b(0x8a):_0x484f7b(0x7c);await _0x4f2ec5[_0x484f7b(0x9d)](_0x136348,{'val':_0x507ade,'ack':!![]}),_0x4f2ec5['log']['info'](_0x484f7b(0xda)+_0x2da886+_0x484f7b(0xd8));}catch(_0xc159d6){_0x4f2ec5[_0x484f7b(0xd2)][_0x484f7b(0x75)](_0x484f7b(0x92)+_0xc159d6['message']);}}module[a0_0x54f657(0xef)]={'executeAutomationAction':executeAutomationAction,'createDailyDigest':createDailyDigest,'runBaselineDriftAnalysis':runBaselineDriftAnalysis,'sendMorningBriefing':sendMorningBriefing,'runGeminiAnalysis':runGeminiAnalysis,'consultButler':consultButler,'generateHealthReport':generateHealthReport};