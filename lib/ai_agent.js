const a0_0xcb4a36=a0_0x4358;(function(_0x3e6c54,_0x20519f){const _0x5b0e53=a0_0x4358,_0x939597=_0x3e6c54();while(!![]){try{const _0x2bc074=-parseInt(_0x5b0e53(0xc5))/0x1*(parseInt(_0x5b0e53(0xdb))/0x2)+-parseInt(_0x5b0e53(0xf5))/0x3*(-parseInt(_0x5b0e53(0x8f))/0x4)+parseInt(_0x5b0e53(0xf6))/0x5*(-parseInt(_0x5b0e53(0x6e))/0x6)+parseInt(_0x5b0e53(0x6d))/0x7*(parseInt(_0x5b0e53(0xbf))/0x8)+parseInt(_0x5b0e53(0xb8))/0x9+-parseInt(_0x5b0e53(0xb2))/0xa+-parseInt(_0x5b0e53(0x7f))/0xb;if(_0x2bc074===_0x20519f)break;else _0x939597['push'](_0x939597['shift']());}catch(_0x5dbceb){_0x939597['push'](_0x939597['shift']());}}}(a0_0x53a2,0xa25f1));const a0_0x5c8742=(function(){let _0x1c478a=!![];return function(_0x5cf9f6,_0x2de4e5){const _0x37de94=_0x1c478a?function(){const _0x6e2c7f=a0_0x4358;if(_0x2de4e5){const _0x4820e3=_0x2de4e5[_0x6e2c7f(0xfd)](_0x5cf9f6,arguments);return _0x2de4e5=null,_0x4820e3;}}:function(){};return _0x1c478a=![],_0x37de94;};}()),a0_0xeb62ea=a0_0x5c8742(this,function(){const _0x20bae0=a0_0x4358;return a0_0xeb62ea[_0x20bae0(0xda)]()[_0x20bae0(0xa3)](_0x20bae0(0xee))[_0x20bae0(0xda)]()[_0x20bae0(0xf8)](a0_0xeb62ea)['search']('(((.+)+)+)+$');});a0_0xeb62ea();'use strict';const {GoogleGenerativeAI}=require(a0_0xcb4a36(0xa9)),setup=require('./setup'),GEMINI_MODEL=a0_0xcb4a36(0x7b),LTM_DP_DAILY_DIGESTS=a0_0xcb4a36(0x93),LTM_DP_STATUS=a0_0xcb4a36(0xe9),LTM_DP_RAW_LOG=a0_0xcb4a36(0x81),LTM_MIN_EVENTS_FOR_COMPRESSION=0x5,MIN_API_GAP_MS=0x4e20;let lastGlobalApiCall=0x0;function a0_0x53a2(){const _0x23fd90=['.Current.WeatherText','toString','1144450TDKOhk','¬∞C,\x20','sendNotification','description','Unbekannt\x20(Kein\x20Sensor)','.\x20EMERGENCY:\x20','toLocaleTimeString','BUTLER\x20Execution\x20Error:\x20','replace','Maximaler\x20Komfort,\x20Energie\x20ist\x20zweitrangig.','.\x20KONTEXT:\x20','Skipped\x20(No\x20AI\x20or\x20Data)','N/A\x20(Learning)','Keine\x20Daten\x20f√ºr\x20die\x20Nacht\x20aufgezeichnet\x20(Sensoren\x20ruhig).','LTM.processingStatus','ltmStbWindowDays','\x22\x20AN.\x0a\x20\x20\x20\x20STRATEGIE:\x20','log','detected','(((.+)+)+)+$','ü§ñ\x20Health\x20Report\x20(','üåÖ\x20Morning\x20Briefing:\x0a','splice','\x0aSTB:\x20','ltmLtbWindowDays','KI\x20offline\x20(Fallback)','114159PokBXk','262730ZCVfFc','.\x20EVENTS:\x20','constructor','Traffic-Schutz\x20(Auto-Approved)','isEmergency','.Current.Temperature','lastAlertState','apply','decision','push','analysis.automation.description','Nacht','\x0a\x20\x20\x20\x20ROLLE:\x20Haus-Butler.\x0a\x20\x20\x20\x20SITUATION:\x20','exports','rawEventLog','ü§ñ\x20BUTLER:\x20Executing\x20Action\x20->\x20','.Current.IsNight','Sicherheit\x20geht\x20vor.','ROLLE:\x20Data\x20Scientist.\x20ZIEL:\x20Drift\x20erkennen.\x20SCHEMA:\x20{\x20\x22baselineDrift\x22:\x20\x22none|slight|significant|critical\x22,\x20\x22driftDetails\x22:\x20\x22string\x22\x20}\x0a\x0aLTB:\x20','targetId','Unbekannt','PRIORIT√ÑT:\x20Sicherheit\x20und\x20Licht.\x20Schalte\x20lieber\x20einmal\x20zu\x20viel\x20als\x20zu\x20wenig.','\x20->\x20','7HAdLSO','24iDqLnj','Erstelle\x20ein\x20kurzes\x20\x27Guten\x20Morgen\x27\x20Briefing\x20basierend\x20auf\x20den\x20Events\x20der\x20letzten\x20Nacht.','message','Skipped\x20(Traffic)','map','.forecast.current.state','config','warn','üìÖ\x20Daily\x20Digest:\x0a','geminiModel','\x20=\x20','val','generateContent','models/gemini-flash-latest','ANALYZE_HEALTH','response','setForeignStateAsync','1577653HnoMGf','setHours','LTM.rawEventLog','length','analysis.health.geminiNight','eventHistory','NIGHT','filter','driftDetails','analysis.automation.targetId','ü§ñ\x20Autopilot\x20skipped\x20(Traffic\x20Protection\x20active).','debug','%)\x20nach\x20\x22','KI-Fehler\x20(Fallback)','Health\x20Report\x20Error:\x20','isAlert','28xjoXWK','stringify','error','reason','LTM.dailyDigests','üåÖ\x20Briefing\x20generated\x20(Length:\x20','analysis.alertReason','baselineDrift','info','summary','analysis.activitySummary','targetValue','join','setStateAsync','slice','value','generic','activityLevel','analysis.analysisHistory','Keine\x20Details.','search','now','LTM.driftAnalysis.lastCheck','setDate','weatherInstance','ü§ñ\x20BUTLER:\x20No\x20valid\x20target\x20ID\x20or\x20value\x20stored\x20for\x20execution.','@google/generative-ai','.\x20ANWESEND:\x20','send','2-digit','getDate','getForeignStateAsync','system.presenceWho','text','.\x20AUFGABE:\x201.\x20Gesundheit?\x202.\x20Komfort?\x20FORMAT\x20(JSON):\x20{\x20\x22isAlert\x22:\x20boolean,\x20\x22alertReason\x22:\x20\x22string\x22,\x20\x22isEmergency\x22:\x20boolean,\x20\x22summary\x22:\x20\x22string\x22,\x20\x22automationProposal\x22:\x20{\x20\x22detected\x22:\x20boolean,\x20\x22description\x22:\x20\x22string\x22,\x20\x22targetId\x22:\x20\x22string\x22,\x20\x22targetValue\x22:\x20\x22any\x22\x20}\x20}','7230190YqYuIB','parse','LTM.driftAnalysis.baselineDrift','üåÖ\x20Starting\x20Morning\x20Briefing\x20sequence\x20(Traffic\x20Check\x20bypassed)...',').\x20Sending\x20notification...','alertReason','9466344muWvOJ','ü§ñ\x20Butler\x20Cache\x20Hit:\x20','trim','ü§ñ\x20API\x20Cooldown.\x20Waiting\x202s...','analysis.automation.autoApply','getTime','getStateAsync','7965896jkkPkp','timestamp','analysis.health.geminiDay','approved','currentSystemMode','name','1nUqkZL','ROLLE:\x20KI-Hausverwalter.\x20PERSONA:\x20','toFixed','isProVersion','LTM.driftAnalysis.driftDetails','ü§ñ\x20Butler\x20Brain\x20Error:\x20','Analysiere\x20diese\x20Events\x20des\x20TAGES\x20(08:00-Jetzt).\x20Aktivit√§t?\x20Mahlzeiten?\x20Haust√ºr?\x20Antwort\x20kurz\x20f√ºr\x20den\x20besorgten\x20Sohn\x20(max\x202\x20S√§tze).','Gemini\x20Error:\x20','normal','analysisHistory','ü§ñ\x20Morning\x20Briefing\x20skipped:\x20No\x20Gemini\x20Model.',',\x20Wetter:\x20','Tag',',\x20Lichtverh√§ltnisse:\x20','dailyDigests','aiPersona','unshift','pop','\x0a\x20\x20\x20\x20ANTWORT-STIL:\x20Sachlich,\x20beruhigend,\x20pr√§zise.\x20Keine\x20Floskeln.\x0a\x20\x20\x20\x20','automationProposal'];a0_0x53a2=function(){return _0x23fd90;};return a0_0x53a2();}const decisionCache={},CACHE_TTL_MS=0xf*0x3c*0x3e8,PERSONA_MAPPING={'generic':'Entscheide\x20ausgewogen\x20zwischen\x20Komfort\x20und\x20Energie.','senior_aal':a0_0xcb4a36(0x6b),'family':'Fokus\x20auf\x20Komfort\x20f√ºr\x20die\x20Familie.','single_comfort':a0_0xcb4a36(0xe4),'security':a0_0xcb4a36(0x67),'energy_saver':'PRIORIT√ÑT:\x20Energie\x20sparen.\x20Schalte\x20nur,\x20wenn\x20absolut\x20notwendig\x20(Dunkelheit).'};function canCallApi(){const _0x93720d=a0_0xcb4a36,_0x3bfd66=Date[_0x93720d(0xa4)]();return _0x3bfd66-lastGlobalApiCall>MIN_API_GAP_MS;}function updateApiTimestamp(){lastGlobalApiCall=Date['now']();}async function getWeatherContext(_0x392b59){const _0x12d755=a0_0xcb4a36;if(!_0x392b59[_0x12d755(0x74)]['useWeather']||!_0x392b59[_0x12d755(0x74)][_0x12d755(0xa7)])return _0x12d755(0xdf);try{const _0x229269=_0x392b59[_0x12d755(0x74)][_0x12d755(0xa7)];let _0x56ffd7=await _0x392b59[_0x12d755(0xae)](_0x229269+_0x12d755(0xfb));if(!_0x56ffd7)_0x56ffd7=await _0x392b59[_0x12d755(0xae)](_0x229269+'.forecast.current.temperature');let _0x380577=await _0x392b59[_0x12d755(0xae)](_0x229269+_0x12d755(0xd9));if(!_0x380577)_0x380577=await _0x392b59[_0x12d755(0xae)](_0x229269+_0x12d755(0x73));let _0x5f48c1='Unbekannt';const _0xcc2c67=await _0x392b59[_0x12d755(0xae)](_0x229269+_0x12d755(0x106));if(_0xcc2c67)_0x5f48c1=_0xcc2c67[_0x12d755(0x79)]?_0x12d755(0x101):_0x12d755(0xd1);if(_0x56ffd7&&_0x380577)return _0x56ffd7[_0x12d755(0x79)]+_0x12d755(0xdc)+_0x380577['val']+_0x12d755(0xd2)+_0x5f48c1;}catch(_0x3df5a9){}return'Wetterdaten\x20nicht\x20abrufbar';}async function consultButler(_0x3ad236,_0xb04e0e,_0x3ecb0d,_0x1e8599){const _0x248f8f=a0_0xcb4a36;if(!_0x3ad236['geminiModel'])return{'approved':!![],'reason':_0x248f8f(0xf4)};const _0x19d408=Date[_0x248f8f(0xa4)]();if(decisionCache[_0xb04e0e]&&_0x19d408-decisionCache[_0xb04e0e][_0x248f8f(0xc0)]<CACHE_TTL_MS){const _0x39fd87=decisionCache[_0xb04e0e][_0x248f8f(0xfe)];return _0x3ad236[_0x248f8f(0xec)][_0x248f8f(0x8a)](_0x248f8f(0xb9)+_0xb04e0e+_0x248f8f(0x6c)+(_0x39fd87[_0x248f8f(0xc2)]?'OK':'NO')+'\x20('+_0x39fd87[_0x248f8f(0x92)]+')'),_0x39fd87;}if(!canCallApi())return _0x3ad236[_0x248f8f(0xec)][_0x248f8f(0x8a)]('ü§ñ\x20Traffic\x20Schutz:\x20Anfrage\x20f√ºr\x20'+_0xb04e0e+'\x20√ºbersprungen\x20(Auto-Approved).'),{'approved':!![],'reason':_0x248f8f(0xf9)};const _0x168307=new Date()[_0x248f8f(0xe1)](),_0x5cdd31=await getWeatherContext(_0x3ad236),_0x398276=PERSONA_MAPPING[_0x3ad236[_0x248f8f(0x74)]['aiPersona']||_0x248f8f(0x9f)],_0x571784=_0x248f8f(0x102)+_0x168307+_0x248f8f(0xd0)+_0x5cdd31+'.\x0a\x20\x20\x20\x20EVENT:\x20Bewohner\x20geht\x20wahrscheinlich\x20('+(_0x1e8599*0x64)[_0x248f8f(0xc7)](0x0)+_0x248f8f(0x8b)+_0xb04e0e+'\x22.\x0a\x20\x20\x20\x20AKTION:\x20Schalte\x20\x22'+_0x3ecb0d+_0x248f8f(0xeb)+_0x398276+'\x0a\x20\x20\x20\x20FRAGE:\x20Ist\x20es\x20dunkel\x20genug\x20f√ºr\x20Licht?\x0a\x20\x20\x20\x20FORMAT:\x20{\x20\x22approved\x22:\x20boolean,\x20\x22reason\x22:\x20\x22kurzer\x20Grund\x22\x20}\x0a\x20\x20\x20\x20';try{updateApiTimestamp();const _0x1ad0a5=await _0x3ad236[_0x248f8f(0x77)]['generateContent'](_0x571784),_0x32aeb6=_0x1ad0a5[_0x248f8f(0x7d)][_0x248f8f(0xb0)]()[_0x248f8f(0xe3)](/```json|```/g,'')[_0x248f8f(0xba)](),_0x2b6f18=JSON[_0x248f8f(0xb3)](_0x32aeb6);return decisionCache[_0xb04e0e]={'decision':_0x2b6f18,'timestamp':_0x19d408},_0x2b6f18;}catch(_0x51da1e){return _0x3ad236[_0x248f8f(0xec)]['warn'](_0x248f8f(0xca)+_0x51da1e[_0x248f8f(0x70)]),decisionCache[_0xb04e0e]={'decision':{'approved':!![],'reason':_0x248f8f(0x8c)},'timestamp':_0x19d408-(CACHE_TTL_MS-0xea60)},{'approved':!![],'reason':_0x248f8f(0x8c)};}}function a0_0x4358(_0x2ffcee,_0x13ef94){const _0x4e2a0f=a0_0x53a2();return a0_0x4358=function(_0xeb62ea,_0x5c8742){_0xeb62ea=_0xeb62ea-0x67;let _0x53a227=_0x4e2a0f[_0xeb62ea];return _0x53a227;},a0_0x4358(_0x2ffcee,_0x13ef94);}async function runGeminiAnalysis(_0x23c283,_0xc7de28=''){const _0x56f308=a0_0xcb4a36;if(!_0x23c283['geminiModel'])return;if(!canCallApi()){_0x23c283['log'][_0x56f308(0x8a)](_0x56f308(0x89));return;}if(_0x23c283[_0x56f308(0x84)][_0x56f308(0x82)]===0x0)return;const _0x2e09fd=_0x23c283[_0x56f308(0x84)][_0x56f308(0x9d)](0x0,0xf),_0x3c836d=_0x23c283[_0x56f308(0xc3)],_0x483edf=PERSONA_MAPPING[_0x23c283['config'][_0x56f308(0xd4)]||_0x56f308(0x9f)],_0x13cc82=_0x23c283[_0x56f308(0x74)]['livingContext']||_0x56f308(0xa2);let _0xa7bc44=_0x56f308(0x6a);try{const _0x449505=await _0x23c283[_0x56f308(0xbe)](_0x56f308(0xaf));if(_0x449505&&_0x449505[_0x56f308(0x79)])_0xa7bc44=_0x449505[_0x56f308(0x79)];}catch(_0x56fb70){}let _0x1a53c4=![];try{const _0x43076c=await _0x23c283[_0x56f308(0xbe)](_0x56f308(0xbc));if(_0x43076c&&_0x43076c[_0x56f308(0x79)])_0x1a53c4=!![];}catch(_0x11ea84){}const _0x2e672e=_0x56f308(0xc6)+_0x483edf+_0x56f308(0xe5)+_0x13cc82+'.\x20SYSTEM_MODE:\x20'+_0x3c836d+_0x56f308(0xaa)+_0xa7bc44+_0x56f308(0xf7)+JSON['stringify'](_0x2e09fd)+_0x56f308(0xe0)+_0xc7de28+_0x56f308(0xb1);try{updateApiTimestamp();const _0x40d2a7=await _0x23c283['geminiModel'][_0x56f308(0x7a)](_0x2e672e),_0xdfa1c=JSON[_0x56f308(0xb3)](_0x40d2a7[_0x56f308(0x7d)][_0x56f308(0xb0)]()['replace'](/```json|```/g,'')[_0x56f308(0xba)]());await _0x23c283[_0x56f308(0x9c)]('analysis.lastResult',{'val':JSON[_0x56f308(0x90)](_0xdfa1c),'ack':!![]});if(_0xdfa1c[_0x56f308(0x98)])await _0x23c283['setStateAsync'](_0x56f308(0x99),{'val':_0xdfa1c[_0x56f308(0x98)],'ack':!![]});const _0x5b0010={'timestamp':Date[_0x56f308(0xa4)](),'id':Date['now']()['toString'](),'analysis':{'activity':{'summary':_0xdfa1c[_0x56f308(0x98)],'isAlert':_0xdfa1c['isAlert'],'alertReason':_0xdfa1c[_0x56f308(0xb7)]},'comfort':{'automationProposal':_0xdfa1c[_0x56f308(0xd8)]}}};_0x23c283['analysisHistory'][_0x56f308(0xd5)](_0x5b0010);if(_0x23c283['analysisHistory'][_0x56f308(0x82)]>0x32)_0x23c283[_0x56f308(0xce)][_0x56f308(0xd6)]();await _0x23c283['setStateAsync'](_0x56f308(0xa1),{'val':JSON['stringify'](_0x23c283[_0x56f308(0xce)]),'ack':!![]});const _0xd5379f=_0xdfa1c[_0x56f308(0x8e)]||![];_0xd5379f!==_0x23c283[_0x56f308(0xfc)]&&(await _0x23c283['setStateAsync']('analysis.isAlert',{'val':_0xd5379f,'ack':!![]}),_0x23c283['lastAlertState']=_0xd5379f,_0xd5379f&&(await _0x23c283[_0x56f308(0x9c)](_0x56f308(0x95),{'val':_0xdfa1c['alertReason'],'ack':!![]}),setup[_0x56f308(0xdd)](_0x23c283,'‚ö†Ô∏è\x20ALARM:\x20'+_0xdfa1c['alertReason'],![],_0xdfa1c[_0x56f308(0xfa)])));if(_0xdfa1c['automationProposal']&&_0xdfa1c[_0x56f308(0xd8)][_0x56f308(0xed)]){await _0x23c283[_0x56f308(0x9c)]('analysis.automation.patternDetected',{'val':!![],'ack':!![]}),await _0x23c283['setStateAsync'](_0x56f308(0x100),{'val':_0xdfa1c[_0x56f308(0xd8)][_0x56f308(0xde)],'ack':!![]}),await _0x23c283[_0x56f308(0x9c)]('analysis.automation.targetId',{'val':_0xdfa1c['automationProposal'][_0x56f308(0x69)],'ack':!![]}),await _0x23c283[_0x56f308(0x9c)]('analysis.automation.targetValue',{'val':JSON['stringify'](_0xdfa1c['automationProposal'][_0x56f308(0x9a)]),'ack':!![]});if(_0x1a53c4)executeAutomationAction(_0x23c283);}}catch(_0x3ca967){_0x23c283['log'][_0x56f308(0x91)](_0x56f308(0xcc)+_0x3ca967[_0x56f308(0x70)]);}}async function createDailyDigest(_0x3a24b2,_0xe5f803){const _0x2d4046=a0_0xcb4a36;if(!_0x3a24b2['isProVersion'])return;if(!canCallApi()){await _0x3a24b2[_0x2d4046(0x9c)](LTM_DP_STATUS,{'val':_0x2d4046(0x71),'ack':!![]});return;}await _0x3a24b2[_0x2d4046(0x9c)](LTM_DP_STATUS,{'val':'Started...','ack':!![]});if(!_0x3a24b2[_0x2d4046(0x77)]||_0x3a24b2[_0x2d4046(0x104)][_0x2d4046(0x82)]<LTM_MIN_EVENTS_FOR_COMPRESSION){await _0x3a24b2[_0x2d4046(0x9c)](LTM_DP_STATUS,{'val':_0x2d4046(0xe6),'ack':!![]});return;}const _0x140903=JSON[_0x2d4046(0xb3)](JSON['stringify'](_0x3a24b2[_0x2d4046(0x104)])),_0x264aae=_0x140903[_0x2d4046(0x82)],_0x4bf4c1='ROLLE:\x20Data\x20Compression\x20Agent.\x20SPRACHE:\x20DE.\x20FORMAT:\x20JSON.\x20ANWEISUNG:\x20Fasse\x20Sensor-Events\x20zusammen.\x20SCHEMA:\x20{\x20\x22summary\x22:\x20\x22string\x22,\x20\x22activityLevel\x22:\x20\x22string\x22\x20}\x20\x0a\x0aEVENTS:\x0a'+JSON[_0x2d4046(0x90)](_0x140903);try{updateApiTimestamp();const _0x225dfd=await _0x3a24b2[_0x2d4046(0x77)][_0x2d4046(0x7a)](_0x4bf4c1),_0x460f5e=JSON[_0x2d4046(0xb3)](_0x225dfd[_0x2d4046(0x7d)][_0x2d4046(0xb0)]()[_0x2d4046(0xe3)](/```json|```/g,'')[_0x2d4046(0xba)]()),_0x43f0ac={'timestamp':new Date()['toISOString'](),'eventCount':_0x264aae,'summary':_0x460f5e[_0x2d4046(0x98)]||'Digest','activityLevel':_0x460f5e['activityLevel']||_0x2d4046(0xcd),'systemMode':_0x3a24b2[_0x2d4046(0xc3)]};_0x3a24b2['dailyDigests'][_0x2d4046(0xff)](_0x43f0ac);const _0x1634e8=_0x3a24b2['config'][_0x2d4046(0xf3)]||0x3c;_0x3a24b2[_0x2d4046(0xd3)][_0x2d4046(0x82)]>_0x1634e8&&_0x3a24b2[_0x2d4046(0xd3)][_0x2d4046(0xf1)](0x0,_0x3a24b2[_0x2d4046(0xd3)][_0x2d4046(0x82)]-_0x1634e8);await _0x3a24b2[_0x2d4046(0x9c)](LTM_DP_DAILY_DIGESTS,{'val':JSON[_0x2d4046(0x90)](_0x3a24b2['dailyDigests']),'ack':!![]}),_0x3a24b2[_0x2d4046(0x104)]=[],await _0x3a24b2[_0x2d4046(0x9c)](LTM_DP_RAW_LOG,{'val':JSON[_0x2d4046(0x90)](_0x3a24b2[_0x2d4046(0x104)]),'ack':!![]}),await _0x3a24b2[_0x2d4046(0x9c)](LTM_DP_STATUS,{'val':'Success','ack':!![]});const _0x985297=_0x2d4046(0x76)+_0x460f5e[_0x2d4046(0x98)]+'\x0aAktivit√§t:\x20'+_0x460f5e[_0x2d4046(0xa0)];setup['sendNotification'](_0x3a24b2,_0x985297,![],![]);if(_0x3a24b2['isProVersion']&&_0xe5f803)_0xe5f803[_0x2d4046(0xab)](_0x3a24b2,_0x2d4046(0x7c),{'digest':_0x43f0ac});}catch(_0x189ca2){_0x3a24b2['log'][_0x2d4046(0x91)](_0x189ca2[_0x2d4046(0x70)]);}}async function runBaselineDriftAnalysis(_0x5c5027){const _0xd12e36=a0_0xcb4a36;if(!_0x5c5027[_0xd12e36(0xc8)]||!_0x5c5027[_0xd12e36(0x77)])return;if(!canCallApi())return;const _0x297360=_0x5c5027['config'][_0xd12e36(0xea)]||0xe;if(_0x5c5027['dailyDigests'][_0xd12e36(0x82)]<_0x297360+0x7){await _0x5c5027[_0xd12e36(0x9c)]('LTM.driftAnalysis.baselineDrift',{'val':_0xd12e36(0xe7),'ack':!![]});return;}const _0x2e6303=_0x5c5027[_0xd12e36(0xd3)]['slice'](-_0x297360),_0x9b5321=_0x5c5027[_0xd12e36(0xd3)][_0xd12e36(0x9d)](0x0,_0x5c5027[_0xd12e36(0xd3)]['length']-_0x297360),_0x5480aa=_0xd12e36(0x68)+JSON[_0xd12e36(0x90)](_0x9b5321)+_0xd12e36(0xf2)+JSON[_0xd12e36(0x90)](_0x2e6303);try{updateApiTimestamp();const _0x35c899=await _0x5c5027['geminiModel'][_0xd12e36(0x7a)](_0x5480aa),_0x3817ef=JSON[_0xd12e36(0xb3)](_0x35c899['response'][_0xd12e36(0xb0)]()['replace'](/```json|```/g,'')['trim']());_0x3817ef['baselineDrift']&&(await _0x5c5027['setStateAsync'](_0xd12e36(0xb4),{'val':_0x3817ef[_0xd12e36(0x96)],'ack':!![]}),await _0x5c5027[_0xd12e36(0x9c)](_0xd12e36(0xc9),{'val':_0x3817ef[_0xd12e36(0x87)],'ack':!![]}),await _0x5c5027['setStateAsync'](_0xd12e36(0xa5),{'val':Date[_0xd12e36(0xa4)](),'ack':!![]}));}catch(_0x2397ea){}}async function executeAutomationAction(_0x3d0058){const _0x17c5f6=a0_0xcb4a36;try{const _0xf3e916=await _0x3d0058[_0x17c5f6(0xbe)](_0x17c5f6(0x88)),_0x31425d=await _0x3d0058['getStateAsync']('analysis.automation.targetValue');if(_0xf3e916&&_0xf3e916[_0x17c5f6(0x79)]&&_0x31425d){const _0x416e0e=_0xf3e916[_0x17c5f6(0x79)];let _0x29b2ed=_0x31425d['val'];try{_0x29b2ed=JSON[_0x17c5f6(0xb3)](_0x29b2ed);}catch(_0x207067){}_0x3d0058['log'][_0x17c5f6(0x97)](_0x17c5f6(0x105)+_0x416e0e+_0x17c5f6(0x78)+_0x29b2ed),await _0x3d0058[_0x17c5f6(0x7e)](_0x416e0e,_0x29b2ed);}else _0x3d0058[_0x17c5f6(0xec)][_0x17c5f6(0x75)](_0x17c5f6(0xa8));}catch(_0x3941f0){_0x3d0058[_0x17c5f6(0xec)][_0x17c5f6(0x91)](_0x17c5f6(0xe2)+_0x3941f0['message']);}}async function sendMorningBriefing(_0x1cf94){const _0x187db0=a0_0xcb4a36;if(!_0x1cf94[_0x187db0(0x77)]){_0x1cf94[_0x187db0(0xec)][_0x187db0(0x75)](_0x187db0(0xcf));return;}_0x1cf94[_0x187db0(0xec)][_0x187db0(0x97)](_0x187db0(0xb5));try{updateApiTimestamp();const _0x1596ac=_0x187db0(0x6f),_0x26a15e=await _0x1cf94[_0x187db0(0x77)][_0x187db0(0x7a)](_0x1596ac),_0x3d560e=_0x26a15e[_0x187db0(0x7d)][_0x187db0(0xb0)]();_0x1cf94[_0x187db0(0xec)]['info'](_0x187db0(0x94)+_0x3d560e[_0x187db0(0x82)]+_0x187db0(0xb6)),setup[_0x187db0(0xdd)](_0x1cf94,_0x187db0(0xf0)+_0x3d560e);}catch(_0x12dfdb){_0x1cf94[_0x187db0(0xec)]['error']('Briefing\x20Error:\x20'+_0x12dfdb[_0x187db0(0x70)]);}}async function generateHealthReport(_0x41bb01,_0x5a9c32){const _0x17fc7c=a0_0xcb4a36;if(!_0x41bb01[_0x17fc7c(0x77)])return;const _0x463804=Date['now']();_0x463804-lastGlobalApiCall<0xbb8&&(_0x41bb01[_0x17fc7c(0xec)][_0x17fc7c(0x8a)](_0x17fc7c(0xbb)),await new Promise(_0x24a8e1=>setTimeout(_0x24a8e1,0x7d0)));const _0xdbd0a=new Date();let _0x59bb4b=0x0,_0x4d4086=_0xdbd0a['getTime'](),_0x55e588='';if(_0x5a9c32===_0x17fc7c(0x85)){const _0x2a6010=new Date(_0xdbd0a);_0x2a6010[_0x17fc7c(0xa6)](_0x2a6010[_0x17fc7c(0xad)]()-0x1),_0x2a6010['setHours'](0x16,0x0,0x0,0x0),_0x59bb4b=_0x2a6010['getTime']();const _0x3e582b=new Date(_0xdbd0a);_0x3e582b[_0x17fc7c(0x80)](0x8,0x0,0x0,0x0),_0x4d4086=_0x3e582b[_0x17fc7c(0xbd)](),_0x55e588='Analysiere\x20diese\x20Events\x20der\x20NACHT\x20(22:00-08:00).\x20War\x20der\x20Schlaf\x20ruhig?\x20Gab\x20es\x20Badg√§nge?\x20Antwort\x20kurz\x20f√ºr\x20den\x20besorgten\x20Sohn\x20(max\x202\x20S√§tze).';}else{const _0x355ea=new Date(_0xdbd0a);_0x355ea[_0x17fc7c(0x80)](0x8,0x0,0x0,0x0),_0x59bb4b=_0x355ea[_0x17fc7c(0xbd)](),_0x55e588=_0x17fc7c(0xcb);}const _0x5137d0=_0x41bb01[_0x17fc7c(0x84)][_0x17fc7c(0x86)](_0x240720=>_0x240720['timestamp']>=_0x59bb4b&&_0x240720['timestamp']<=_0x4d4086);if(_0x5137d0[_0x17fc7c(0x82)]===0x0){const _0x119164=_0x5a9c32===_0x17fc7c(0x85)?_0x17fc7c(0xe8):'Bisher\x20keine\x20Aktivit√§t\x20seit\x2008:00\x20Uhr\x20verzeichnet.',_0x586909=_0x5a9c32==='NIGHT'?_0x17fc7c(0x83):_0x17fc7c(0xc1);await _0x41bb01['setStateAsync'](_0x586909,{'val':_0x119164,'ack':!![]});return;}const _0x481376=_0x5137d0[_0x17fc7c(0x72)](_0x5a6a00=>new Date(_0x5a6a00[_0x17fc7c(0xc0)])[_0x17fc7c(0xe1)]([],{'hour':'2-digit','minute':_0x17fc7c(0xac)})+'\x20'+_0x5a6a00[_0x17fc7c(0xc4)]+'\x20('+_0x5a6a00[_0x17fc7c(0x9e)]+')')[_0x17fc7c(0x9b)]('\x0a'),_0x1c4133='\x0a\x20\x20\x20\x20ROLLE:\x20Medizinischer\x20Assistent\x20f√ºr\x20AAL\x20(Ambient\x20Assisted\x20Living).\x0a\x20\x20\x20\x20AUFGABE:\x20'+_0x55e588+'\x0a\x20\x20\x20\x20EVENTS:\x0a'+_0x481376+_0x17fc7c(0xd7);try{updateApiTimestamp();const _0x4a9174=await _0x41bb01[_0x17fc7c(0x77)]['generateContent'](_0x1c4133),_0x16d053=_0x4a9174[_0x17fc7c(0x7d)][_0x17fc7c(0xb0)](),_0x3799d9=_0x5a9c32===_0x17fc7c(0x85)?'analysis.health.geminiNight':_0x17fc7c(0xc1);await _0x41bb01[_0x17fc7c(0x9c)](_0x3799d9,{'val':_0x16d053,'ack':!![]}),_0x41bb01['log']['info'](_0x17fc7c(0xef)+_0x5a9c32+')\x20generated.');}catch(_0x42ffa3){_0x41bb01[_0x17fc7c(0xec)][_0x17fc7c(0x91)](_0x17fc7c(0x8d)+_0x42ffa3[_0x17fc7c(0x70)]);}}module[a0_0xcb4a36(0x103)]={'executeAutomationAction':executeAutomationAction,'createDailyDigest':createDailyDigest,'runBaselineDriftAnalysis':runBaselineDriftAnalysis,'sendMorningBriefing':sendMorningBriefing,'runGeminiAnalysis':runGeminiAnalysis,'consultButler':consultButler,'generateHealthReport':generateHealthReport};