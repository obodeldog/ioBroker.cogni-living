const a0_0x4dbd12=a0_0x9bd6;(function(_0x5a509f,_0x224a2e){const _0x6eb663=a0_0x9bd6,_0x390f90=_0x5a509f();while(!![]){try{const _0x348dca=parseInt(_0x6eb663(0xfc))/0x1*(parseInt(_0x6eb663(0x123))/0x2)+-parseInt(_0x6eb663(0xcb))/0x3+-parseInt(_0x6eb663(0x103))/0x4+parseInt(_0x6eb663(0xe7))/0x5*(-parseInt(_0x6eb663(0x10c))/0x6)+parseInt(_0x6eb663(0x140))/0x7+-parseInt(_0x6eb663(0x111))/0x8*(parseInt(_0x6eb663(0x150))/0x9)+-parseInt(_0x6eb663(0xef))/0xa*(-parseInt(_0x6eb663(0x113))/0xb);if(_0x348dca===_0x224a2e)break;else _0x390f90['push'](_0x390f90['shift']());}catch(_0x3aca71){_0x390f90['push'](_0x390f90['shift']());}}}(a0_0x2870,0x4445d));const a0_0x4dfcc0=(function(){let _0x5b53ad=!![];return function(_0x13d967,_0x1b65b1){const _0xb95997=_0x5b53ad?function(){const _0x420c07=a0_0x9bd6;if(_0x1b65b1){const _0x5dad68=_0x1b65b1[_0x420c07(0x14b)](_0x13d967,arguments);return _0x1b65b1=null,_0x5dad68;}}:function(){};return _0x5b53ad=![],_0xb95997;};}()),a0_0x47924e=a0_0x4dfcc0(this,function(){const _0x4c1e3b=a0_0x9bd6;return a0_0x47924e['toString']()[_0x4c1e3b(0xcc)](_0x4c1e3b(0x14e))[_0x4c1e3b(0x14d)]()[_0x4c1e3b(0x13a)](a0_0x47924e)[_0x4c1e3b(0xcc)](_0x4c1e3b(0x14e));});function a0_0x9bd6(_0x10abbd,_0x4c8571){const _0x4ca7b1=a0_0x2870();return a0_0x9bd6=function(_0x47924e,_0x4dfcc0){_0x47924e=_0x47924e-0xbf;let _0x2870f6=_0x4ca7b1[_0x47924e];return _0x2870f6;},a0_0x9bd6(_0x10abbd,_0x4c8571);}a0_0x47924e();'use strict';const {GoogleGenerativeAI}=require(a0_0x4dbd12(0xe4)),setup=require('./setup'),GEMINI_MODEL='models/gemini-flash-latest',LTM_DP_DAILY_DIGESTS=a0_0x4dbd12(0x119),LTM_DP_STATUS=a0_0x4dbd12(0x109),LTM_DP_RAW_LOG='LTM.rawEventLog',LTM_MIN_EVENTS_FOR_COMPRESSION=0x5,MIN_API_GAP_MS=0x4e20;let lastGlobalApiCall=0x0;const decisionCache={},CACHE_TTL_MS=0xf*0x3c*0x3e8,PERSONA_MAPPING={'generic':'Entscheide\x20ausgewogen\x20zwischen\x20Komfort\x20und\x20Energie.','senior_aal':a0_0x4dbd12(0xec),'family':a0_0x4dbd12(0x110),'single_comfort':'Maximaler\x20Komfort,\x20Energie\x20ist\x20zweitrangig.','security':'Sicherheit\x20geht\x20vor.','energy_saver':a0_0x4dbd12(0x101)};function canCallApi(){const _0x3e022d=a0_0x4dbd12,_0x566f0f=Date[_0x3e022d(0x11e)]();return _0x566f0f-lastGlobalApiCall>MIN_API_GAP_MS;}function updateApiTimestamp(){lastGlobalApiCall=Date['now']();}async function getWeatherContext(_0x2d2c10){const _0x5e88e9=a0_0x4dbd12;if(!_0x2d2c10[_0x5e88e9(0xf5)]['useWeather']||!_0x2d2c10['config']['weatherInstance'])return'Unbekannt\x20(Kein\x20Sensor)';try{const _0x279456=_0x2d2c10['config'][_0x5e88e9(0x117)];let _0x3ec5f2=await _0x2d2c10['getForeignStateAsync'](_0x279456+_0x5e88e9(0x137));if(!_0x3ec5f2)_0x3ec5f2=await _0x2d2c10[_0x5e88e9(0x122)](_0x279456+_0x5e88e9(0xc4));let _0x3799c3=await _0x2d2c10['getForeignStateAsync'](_0x279456+'.Current.WeatherText');if(!_0x3799c3)_0x3799c3=await _0x2d2c10['getForeignStateAsync'](_0x279456+'.forecast.current.state');let _0x4b638c=_0x5e88e9(0xf0);const _0x21227d=await _0x2d2c10[_0x5e88e9(0x122)](_0x279456+_0x5e88e9(0x11d));if(_0x21227d)_0x4b638c=_0x21227d[_0x5e88e9(0x108)]?_0x5e88e9(0x124):'Tag';if(_0x3ec5f2&&_0x3799c3)return _0x3ec5f2[_0x5e88e9(0x108)]+_0x5e88e9(0xe8)+_0x3799c3['val']+_0x5e88e9(0xdf)+_0x4b638c;}catch(_0x20026f){}return'Wetterdaten\x20nicht\x20abrufbar';}async function consultButler(_0x599c1b,_0x5efcd5,_0x8407f5,_0x226b56){const _0x1d2d32=a0_0x4dbd12;if(!_0x599c1b[_0x1d2d32(0x156)])return{'approved':!![],'reason':_0x1d2d32(0xd9)};const _0x334261=Date[_0x1d2d32(0x11e)]();if(decisionCache[_0x5efcd5]&&_0x334261-decisionCache[_0x5efcd5]['timestamp']<CACHE_TTL_MS){const _0x5d2565=decisionCache[_0x5efcd5][_0x1d2d32(0x13f)];return _0x599c1b[_0x1d2d32(0x116)][_0x1d2d32(0xf2)](_0x1d2d32(0xc0)+_0x5efcd5+_0x1d2d32(0xc1)+(_0x5d2565['approved']?'OK':'NO')+'\x20('+_0x5d2565[_0x1d2d32(0xc3)]+')'),_0x5d2565;}if(!canCallApi())return _0x599c1b[_0x1d2d32(0x116)][_0x1d2d32(0xf2)](_0x1d2d32(0x115)+_0x5efcd5+_0x1d2d32(0x135)),{'approved':!![],'reason':'Traffic-Schutz\x20(Auto-Approved)'};const _0x427cac=new Date()[_0x1d2d32(0x134)](),_0x427eca=await getWeatherContext(_0x599c1b),_0x1655c4=PERSONA_MAPPING[_0x599c1b[_0x1d2d32(0xf5)][_0x1d2d32(0xd6)]||_0x1d2d32(0x13b)],_0x2a9564=_0x1d2d32(0xfa)+_0x427cac+',\x20Wetter:\x20'+_0x427eca+_0x1d2d32(0xc8)+(_0x226b56*0x64)[_0x1d2d32(0x10f)](0x0)+_0x1d2d32(0x130)+_0x5efcd5+'\x22.\x0a\x20\x20\x20\x20AKTION:\x20Schalte\x20\x22'+_0x8407f5+'\x22\x20AN.\x0a\x20\x20\x20\x20STRATEGIE:\x20'+_0x1655c4+_0x1d2d32(0x14f);try{updateApiTimestamp();const _0x1878ee=await _0x599c1b[_0x1d2d32(0x156)][_0x1d2d32(0xca)](_0x2a9564),_0x511d83=_0x1878ee[_0x1d2d32(0xea)][_0x1d2d32(0x149)]()[_0x1d2d32(0x12e)](/```json|```/g,'')['trim'](),_0x47a423=JSON[_0x1d2d32(0x131)](_0x511d83);return decisionCache[_0x5efcd5]={'decision':_0x47a423,'timestamp':_0x334261},_0x47a423;}catch(_0x353023){return _0x599c1b[_0x1d2d32(0x116)][_0x1d2d32(0xc6)](_0x1d2d32(0xe9)+_0x353023['message']),decisionCache[_0x5efcd5]={'decision':{'approved':!![],'reason':_0x1d2d32(0xc5)},'timestamp':_0x334261-(CACHE_TTL_MS-0xea60)},{'approved':!![],'reason':_0x1d2d32(0xc5)};}}async function runGeminiAnalysis(_0x1e668f,_0x2e88bd=''){const _0x4c0411=a0_0x4dbd12;if(!_0x1e668f[_0x4c0411(0x156)])return;if(!canCallApi()){_0x1e668f[_0x4c0411(0x116)]['debug'](_0x4c0411(0xfe));return;}if(_0x1e668f['eventHistory']['length']===0x0)return;const _0x1fc25e=_0x1e668f['eventHistory'][_0x4c0411(0x10b)](0x0,0xf),_0x5e0110=_0x1e668f['currentSystemMode'],_0x513cea=PERSONA_MAPPING[_0x1e668f[_0x4c0411(0xf5)]['aiPersona']||_0x4c0411(0x13b)],_0x25db52=_0x1e668f[_0x4c0411(0xf5)][_0x4c0411(0xc9)]||_0x4c0411(0x151);let _0x2c1ba1=_0x4c0411(0xf0);try{const _0x1d6aef=await _0x1e668f[_0x4c0411(0x10d)](_0x4c0411(0x148));if(_0x1d6aef&&_0x1d6aef[_0x4c0411(0x108)])_0x2c1ba1=_0x1d6aef[_0x4c0411(0x108)];}catch(_0x3ec318){}let _0x217263=![];try{const _0x2f15fe=await _0x1e668f[_0x4c0411(0x10d)]('analysis.automation.autoApply');if(_0x2f15fe&&_0x2f15fe[_0x4c0411(0x108)])_0x217263=!![];}catch(_0x2c7fe4){}const _0x3dd444='ROLLE:\x20KI-Hausverwalter.\x20PERSONA:\x20'+_0x513cea+_0x4c0411(0xf1)+_0x25db52+_0x4c0411(0xd2)+_0x5e0110+_0x4c0411(0x155)+_0x2c1ba1+_0x4c0411(0x11c)+JSON[_0x4c0411(0x114)](_0x1fc25e)+_0x4c0411(0xf3)+_0x2e88bd+_0x4c0411(0xe3);try{updateApiTimestamp();const _0x2b78fb=await _0x1e668f[_0x4c0411(0x156)][_0x4c0411(0xca)](_0x3dd444),_0x22c121=JSON[_0x4c0411(0x131)](_0x2b78fb[_0x4c0411(0xea)]['text']()['replace'](/```json|```/g,'')['trim']());await _0x1e668f[_0x4c0411(0x153)](_0x4c0411(0x146),{'val':JSON[_0x4c0411(0x114)](_0x22c121),'ack':!![]});if(_0x22c121['summary'])await _0x1e668f['setStateAsync']('analysis.activitySummary',{'val':_0x22c121[_0x4c0411(0x132)],'ack':!![]});const _0x5215e0={'timestamp':Date[_0x4c0411(0x11e)](),'id':Date[_0x4c0411(0x11e)]()[_0x4c0411(0x14d)](),'analysis':{'activity':{'summary':_0x22c121[_0x4c0411(0x132)],'isAlert':_0x22c121['isAlert'],'alertReason':_0x22c121[_0x4c0411(0xfd)]},'comfort':{'automationProposal':_0x22c121[_0x4c0411(0x13e)]}}};_0x1e668f[_0x4c0411(0xce)][_0x4c0411(0xe1)](_0x5215e0);if(_0x1e668f['analysisHistory']['length']>0x32)_0x1e668f[_0x4c0411(0xce)]['pop']();await _0x1e668f[_0x4c0411(0x153)](_0x4c0411(0x12c),{'val':JSON['stringify'](_0x1e668f['analysisHistory']),'ack':!![]});const _0x38afc1=_0x22c121[_0x4c0411(0xe2)]||![];_0x38afc1!==_0x1e668f[_0x4c0411(0xeb)]&&(await _0x1e668f['setStateAsync'](_0x4c0411(0xe0),{'val':_0x38afc1,'ack':!![]}),_0x1e668f[_0x4c0411(0xeb)]=_0x38afc1,_0x38afc1&&(await _0x1e668f[_0x4c0411(0x153)](_0x4c0411(0x102),{'val':_0x22c121[_0x4c0411(0xfd)],'ack':!![]}),setup[_0x4c0411(0x127)](_0x1e668f,_0x4c0411(0x142)+_0x22c121[_0x4c0411(0xfd)],![],_0x22c121[_0x4c0411(0x14a)])));if(_0x22c121[_0x4c0411(0x13e)]&&_0x22c121['automationProposal']['detected']){await _0x1e668f[_0x4c0411(0x153)](_0x4c0411(0x10a),{'val':!![],'ack':!![]}),await _0x1e668f['setStateAsync'](_0x4c0411(0xe5),{'val':_0x22c121[_0x4c0411(0x13e)][_0x4c0411(0xfb)],'ack':!![]}),await _0x1e668f['setStateAsync'](_0x4c0411(0x13d),{'val':_0x22c121[_0x4c0411(0x13e)][_0x4c0411(0xcf)],'ack':!![]}),await _0x1e668f[_0x4c0411(0x153)](_0x4c0411(0x100),{'val':JSON[_0x4c0411(0x114)](_0x22c121[_0x4c0411(0x13e)][_0x4c0411(0x154)]),'ack':!![]});if(_0x217263)executeAutomationAction(_0x1e668f);}}catch(_0x4ea4fb){_0x1e668f[_0x4c0411(0x116)][_0x4c0411(0x14c)](_0x4c0411(0xf4)+_0x4ea4fb[_0x4c0411(0xdc)]);}}async function createDailyDigest(_0x4fd4dd,_0x133d74){const _0x95abd2=a0_0x4dbd12;if(!_0x4fd4dd['isProVersion'])return;if(!canCallApi()){await _0x4fd4dd[_0x95abd2(0x153)](LTM_DP_STATUS,{'val':_0x95abd2(0xd0),'ack':!![]});return;}await _0x4fd4dd['setStateAsync'](LTM_DP_STATUS,{'val':_0x95abd2(0xd3),'ack':!![]});if(!_0x4fd4dd[_0x95abd2(0x156)]||_0x4fd4dd[_0x95abd2(0xc7)][_0x95abd2(0xee)]<LTM_MIN_EVENTS_FOR_COMPRESSION){await _0x4fd4dd[_0x95abd2(0x153)](LTM_DP_STATUS,{'val':_0x95abd2(0x104),'ack':!![]});return;}const _0x2c4402=JSON[_0x95abd2(0x131)](JSON['stringify'](_0x4fd4dd[_0x95abd2(0xc7)])),_0x593c17=_0x2c4402[_0x95abd2(0xee)],_0x19465a='ROLLE:\x20Data\x20Compression\x20Agent.\x20SPRACHE:\x20DE.\x20FORMAT:\x20JSON.\x20ANWEISUNG:\x20Fasse\x20Sensor-Events\x20zusammen.\x20SCHEMA:\x20{\x20\x22summary\x22:\x20\x22string\x22,\x20\x22activityLevel\x22:\x20\x22string\x22\x20}\x20\x0a\x0aEVENTS:\x0a'+JSON[_0x95abd2(0x114)](_0x2c4402);try{updateApiTimestamp();const _0x5ffdaa=await _0x4fd4dd[_0x95abd2(0x156)]['generateContent'](_0x19465a),_0x147083=JSON[_0x95abd2(0x131)](_0x5ffdaa[_0x95abd2(0xea)][_0x95abd2(0x149)]()[_0x95abd2(0x12e)](/```json|```/g,'')[_0x95abd2(0x11a)]()),_0x18aa28={'timestamp':new Date()[_0x95abd2(0x12f)](),'eventCount':_0x593c17,'summary':_0x147083[_0x95abd2(0x132)]||_0x95abd2(0x13c),'activityLevel':_0x147083[_0x95abd2(0xd1)]||_0x95abd2(0x145),'systemMode':_0x4fd4dd[_0x95abd2(0x147)]};_0x4fd4dd[_0x95abd2(0xd8)][_0x95abd2(0x141)](_0x18aa28);const _0x5bf0e9=_0x4fd4dd[_0x95abd2(0xf5)][_0x95abd2(0x10e)]||0x3c;_0x4fd4dd[_0x95abd2(0xd8)][_0x95abd2(0xee)]>_0x5bf0e9&&_0x4fd4dd[_0x95abd2(0xd8)]['splice'](0x0,_0x4fd4dd['dailyDigests'][_0x95abd2(0xee)]-_0x5bf0e9);await _0x4fd4dd[_0x95abd2(0x153)](LTM_DP_DAILY_DIGESTS,{'val':JSON[_0x95abd2(0x114)](_0x4fd4dd[_0x95abd2(0xd8)]),'ack':!![]}),_0x4fd4dd[_0x95abd2(0xc7)]=[],await _0x4fd4dd[_0x95abd2(0x153)](LTM_DP_RAW_LOG,{'val':JSON['stringify'](_0x4fd4dd[_0x95abd2(0xc7)]),'ack':!![]}),await _0x4fd4dd[_0x95abd2(0x153)](LTM_DP_STATUS,{'val':_0x95abd2(0x106),'ack':!![]});const _0x22eeac='ðŸ“…\x20Daily\x20Digest:\x0a'+_0x147083[_0x95abd2(0x132)]+_0x95abd2(0xf6)+_0x147083[_0x95abd2(0xd1)];setup[_0x95abd2(0x127)](_0x4fd4dd,_0x22eeac,![],![]);if(_0x4fd4dd[_0x95abd2(0xd4)]&&_0x133d74)_0x133d74[_0x95abd2(0x133)](_0x4fd4dd,'ANALYZE_HEALTH',{'digest':_0x18aa28});}catch(_0x5d6c03){_0x4fd4dd['log'][_0x95abd2(0x14c)](_0x5d6c03['message']);}}async function runBaselineDriftAnalysis(_0x35a0c8){const _0x3b464c=a0_0x4dbd12;if(!_0x35a0c8[_0x3b464c(0xd4)]||!_0x35a0c8[_0x3b464c(0x156)])return;if(!canCallApi())return;const _0x13ab92=_0x35a0c8[_0x3b464c(0xf5)]['ltmStbWindowDays']||0xe;if(_0x35a0c8[_0x3b464c(0xd8)][_0x3b464c(0xee)]<_0x13ab92+0x7){await _0x35a0c8[_0x3b464c(0x153)](_0x3b464c(0x126),{'val':'N/A\x20(Learning)','ack':!![]});return;}const _0x3431d1=_0x35a0c8[_0x3b464c(0xd8)]['slice'](-_0x13ab92),_0x4afa6e=_0x35a0c8[_0x3b464c(0xd8)]['slice'](0x0,_0x35a0c8[_0x3b464c(0xd8)]['length']-_0x13ab92),_0x544640='ROLLE:\x20Data\x20Scientist.\x20ZIEL:\x20Drift\x20erkennen.\x20SCHEMA:\x20{\x20\x22baselineDrift\x22:\x20\x22none|slight|significant|critical\x22,\x20\x22driftDetails\x22:\x20\x22string\x22\x20}\x0a\x0aLTB:\x20'+JSON['stringify'](_0x4afa6e)+_0x3b464c(0x118)+JSON[_0x3b464c(0x114)](_0x3431d1);try{updateApiTimestamp();const _0x3697f6=await _0x35a0c8[_0x3b464c(0x156)][_0x3b464c(0xca)](_0x544640),_0x2908e9=JSON['parse'](_0x3697f6[_0x3b464c(0xea)][_0x3b464c(0x149)]()['replace'](/```json|```/g,'')['trim']());_0x2908e9[_0x3b464c(0x128)]&&(await _0x35a0c8['setStateAsync'](_0x3b464c(0x126),{'val':_0x2908e9[_0x3b464c(0x128)],'ack':!![]}),await _0x35a0c8[_0x3b464c(0x153)](_0x3b464c(0xda),{'val':_0x2908e9[_0x3b464c(0xed)],'ack':!![]}),await _0x35a0c8[_0x3b464c(0x153)](_0x3b464c(0xe6),{'val':Date[_0x3b464c(0x11e)](),'ack':!![]}));}catch(_0x46a29e){}}async function executeAutomationAction(_0x57e3ba){const _0x5b4b3e=a0_0x4dbd12;try{const _0x207c76=await _0x57e3ba[_0x5b4b3e(0x10d)](_0x5b4b3e(0x13d)),_0x3a4fe1=await _0x57e3ba[_0x5b4b3e(0x10d)]('analysis.automation.targetValue');if(_0x207c76&&_0x207c76[_0x5b4b3e(0x108)]&&_0x3a4fe1){const _0x35c8ba=_0x207c76[_0x5b4b3e(0x108)];let _0x47ae28=_0x3a4fe1[_0x5b4b3e(0x108)];try{_0x47ae28=JSON[_0x5b4b3e(0x131)](_0x47ae28);}catch(_0x424777){}_0x57e3ba[_0x5b4b3e(0x116)][_0x5b4b3e(0x11f)](_0x5b4b3e(0xd5)+_0x35c8ba+'\x20=\x20'+_0x47ae28),await _0x57e3ba['setForeignStateAsync'](_0x35c8ba,_0x47ae28);}else _0x57e3ba[_0x5b4b3e(0x116)][_0x5b4b3e(0xc6)](_0x5b4b3e(0xff));}catch(_0x4fade3){_0x57e3ba[_0x5b4b3e(0x116)][_0x5b4b3e(0x14c)](_0x5b4b3e(0x121)+_0x4fade3[_0x5b4b3e(0xdc)]);}}function a0_0x2870(){const _0x1ef671=['.\x20EMERGENCY:\x20','Gemini\x20Error:\x20','config','\x0aAktivitÃ¤t:\x20','timestamp','value','map','\x0a\x20\x20\x20\x20ROLLE:\x20Haus-Butler.\x0a\x20\x20\x20\x20SITUATION:\x20','description','1ZKByzx','alertReason','ðŸ¤–\x20Autopilot\x20skipped\x20(Traffic\x20Protection\x20active).','ðŸ¤–\x20BUTLER:\x20No\x20valid\x20target\x20ID\x20or\x20value\x20stored\x20for\x20execution.','analysis.automation.targetValue','PRIORITÃ„T:\x20Energie\x20sparen.\x20Schalte\x20nur,\x20wenn\x20absolut\x20notwendig\x20(Dunkelheit).','analysis.alertReason','542032fbhpdP','Skipped\x20(No\x20AI\x20or\x20Data)','\x0a\x20\x20\x20\x20ROLLE:\x20Medizinischer\x20Assistent\x20fÃ¼r\x20AAL\x20(Ambient\x20Assisted\x20Living).\x0a\x20\x20\x20\x20AUFGABE:\x20','Success','\x0a\x20\x20\x20\x20ANTWORT-STIL:\x20Sachlich,\x20beruhigend,\x20prÃ¤zise.\x20Keine\x20Floskeln.\x0a\x20\x20\x20\x20','val','LTM.processingStatus','analysis.automation.patternDetected','slice','42xJwVRi','getStateAsync','ltmLtbWindowDays','toFixed','Fokus\x20auf\x20Komfort\x20fÃ¼r\x20die\x20Familie.','8rnvQrv',').\x20Sending\x20notification...','4125099erZhEo','stringify','ðŸ¤–\x20Traffic\x20Schutz:\x20Anfrage\x20fÃ¼r\x20','log','weatherInstance','\x0aSTB:\x20','LTM.dailyDigests','trim',')\x20generated.','.\x20EVENTS:\x20','.Current.IsNight','now','info','setHours','BUTLER\x20Execution\x20Error:\x20','getForeignStateAsync','523126jouvwK','Nacht','analysis.health.geminiNight','LTM.driftAnalysis.baselineDrift','sendNotification','baselineDrift','eventHistory','name','ðŸ¤–\x20Health\x20Report\x20(','analysis.analysisHistory','analysis.health.geminiDay','replace','toISOString','%)\x20nach\x20\x22','parse','summary','send','toLocaleTimeString','\x20Ã¼bersprungen\x20(Auto-Approved).','join','.Current.Temperature','NIGHT','getDate','constructor','generic','Digest','analysis.automation.targetId','automationProposal','decision','3763655QEqYIk','push','âš ï¸\x20ALARM:\x20','Briefing\x20Error:\x20','Health\x20Report\x20Error:\x20','normal','analysis.lastResult','currentSystemMode','system.presenceWho','text','isEmergency','apply','error','toString','(((.+)+)+)+$','\x0a\x20\x20\x20\x20FRAGE:\x20Ist\x20es\x20dunkel\x20genug\x20fÃ¼r\x20Licht?\x0a\x20\x20\x20\x20FORMAT:\x20{\x20\x22approved\x22:\x20boolean,\x20\x22reason\x22:\x20\x22kurzer\x20Grund\x22\x20}\x0a\x20\x20\x20\x20','78201ewgGaZ','Keine\x20Details.','ðŸŒ…\x20Morning\x20Briefing:\x0a','setStateAsync','targetValue','.\x20ANWESEND:\x20','geminiModel','Analysiere\x20diese\x20Events\x20der\x20NACHT\x20(22:00-08:00).\x20War\x20der\x20Schlaf\x20ruhig?\x20Gab\x20es\x20BadgÃ¤nge?\x20Antwort\x20kurz\x20fÃ¼r\x20den\x20besorgten\x20Sohn\x20(max\x202\x20SÃ¤tze).','ðŸ¤–\x20Butler\x20Cache\x20Hit:\x20','\x20->\x20','filter','reason','.forecast.current.temperature','KI-Fehler\x20(Fallback)','warn','rawEventLog','.\x0a\x20\x20\x20\x20EVENT:\x20Bewohner\x20geht\x20wahrscheinlich\x20(','livingContext','generateContent','850044uPycDd','search','ðŸŒ…\x20Briefing\x20generated\x20(Length:\x20','analysisHistory','targetId','Skipped\x20(Traffic)','activityLevel','.\x20SYSTEM_MODE:\x20','Started...','isProVersion','ðŸ¤–\x20BUTLER:\x20Executing\x20Action\x20->\x20','aiPersona','setDate','dailyDigests','KI\x20offline\x20(Fallback)','LTM.driftAnalysis.driftDetails','2-digit','message','getTime','ðŸ¤–\x20Morning\x20Briefing\x20skipped:\x20No\x20Gemini\x20Model.',',\x20LichtverhÃ¤ltnisse:\x20','analysis.isAlert','unshift','isAlert','.\x20AUFGABE:\x201.\x20Gesundheit?\x202.\x20Komfort?\x20FORMAT\x20(JSON):\x20{\x20\x22isAlert\x22:\x20boolean,\x20\x22alertReason\x22:\x20\x22string\x22,\x20\x22isEmergency\x22:\x20boolean,\x20\x22summary\x22:\x20\x22string\x22,\x20\x22automationProposal\x22:\x20{\x20\x22detected\x22:\x20boolean,\x20\x22description\x22:\x20\x22string\x22,\x20\x22targetId\x22:\x20\x22string\x22,\x20\x22targetValue\x22:\x20\x22any\x22\x20}\x20}','@google/generative-ai','analysis.automation.description','LTM.driftAnalysis.lastCheck','333605FAzXXS','Â°C,\x20','ðŸ¤–\x20Butler\x20Brain\x20Error:\x20','response','lastAlertState','PRIORITÃ„T:\x20Sicherheit\x20und\x20Licht.\x20Schalte\x20lieber\x20einmal\x20zu\x20viel\x20als\x20zu\x20wenig.','driftDetails','length','10cykBMe','Unbekannt','.\x20KONTEXT:\x20','debug'];a0_0x2870=function(){return _0x1ef671;};return a0_0x2870();}async function sendMorningBriefing(_0x34a757){const _0x496381=a0_0x4dbd12;if(!_0x34a757[_0x496381(0x156)]){_0x34a757['log'][_0x496381(0xc6)](_0x496381(0xde));return;}_0x34a757['log'][_0x496381(0x11f)]('ðŸŒ…\x20Starting\x20Morning\x20Briefing\x20sequence\x20(Traffic\x20Check\x20bypassed)...');try{updateApiTimestamp();const _0x379748='Erstelle\x20ein\x20kurzes\x20\x27Guten\x20Morgen\x27\x20Briefing\x20basierend\x20auf\x20den\x20Events\x20der\x20letzten\x20Nacht.',_0xf216d0=await _0x34a757[_0x496381(0x156)][_0x496381(0xca)](_0x379748),_0x44d9a0=_0xf216d0['response'][_0x496381(0x149)]();_0x34a757[_0x496381(0x116)][_0x496381(0x11f)](_0x496381(0xcd)+_0x44d9a0[_0x496381(0xee)]+_0x496381(0x112)),setup[_0x496381(0x127)](_0x34a757,_0x496381(0x152)+_0x44d9a0);}catch(_0x4de620){_0x34a757[_0x496381(0x116)][_0x496381(0x14c)](_0x496381(0x143)+_0x4de620[_0x496381(0xdc)]);}}async function generateHealthReport(_0x3be3ae,_0x5955ab){const _0x422682=a0_0x4dbd12;if(!_0x3be3ae['geminiModel'])return;const _0x4f30b4=Date[_0x422682(0x11e)]();_0x4f30b4-lastGlobalApiCall<0xbb8&&(_0x3be3ae[_0x422682(0x116)][_0x422682(0xf2)]('ðŸ¤–\x20API\x20Cooldown.\x20Waiting\x202s...'),await new Promise(_0x4e992d=>setTimeout(_0x4e992d,0x7d0)));const _0x202c83=new Date();let _0x3faf32=0x0,_0x5171b1=_0x202c83[_0x422682(0xdd)](),_0x2abaa1='';if(_0x5955ab==='NIGHT'){const _0x49ce47=new Date(_0x202c83);_0x49ce47[_0x422682(0xd7)](_0x49ce47[_0x422682(0x139)]()-0x1),_0x49ce47[_0x422682(0x120)](0x16,0x0,0x0,0x0),_0x3faf32=_0x49ce47['getTime']();const _0x5543e6=new Date(_0x202c83);_0x5543e6['setHours'](0x8,0x0,0x0,0x0),_0x5171b1=_0x5543e6[_0x422682(0xdd)](),_0x2abaa1=_0x422682(0xbf);}else{const _0x564ad1=new Date(_0x202c83);_0x564ad1[_0x422682(0x120)](0x8,0x0,0x0,0x0),_0x3faf32=_0x564ad1[_0x422682(0xdd)](),_0x2abaa1='Analysiere\x20diese\x20Events\x20des\x20TAGES\x20(08:00-Jetzt).\x20AktivitÃ¤t?\x20Mahlzeiten?\x20HaustÃ¼r?\x20Antwort\x20kurz\x20fÃ¼r\x20den\x20besorgten\x20Sohn\x20(max\x202\x20SÃ¤tze).';}const _0x10f73d=_0x3be3ae[_0x422682(0x129)][_0x422682(0xc2)](_0x51a8a=>_0x51a8a['timestamp']>=_0x3faf32&&_0x51a8a[_0x422682(0xf7)]<=_0x5171b1);if(_0x10f73d[_0x422682(0xee)]===0x0){const _0x417a12=_0x5955ab===_0x422682(0x138)?'Keine\x20Daten\x20fÃ¼r\x20die\x20Nacht\x20aufgezeichnet\x20(Sensoren\x20ruhig).':'Bisher\x20keine\x20AktivitÃ¤t\x20seit\x2008:00\x20Uhr\x20verzeichnet.',_0x4613b9=_0x5955ab===_0x422682(0x138)?_0x422682(0x125):_0x422682(0x12d);await _0x3be3ae[_0x422682(0x153)](_0x4613b9,{'val':_0x417a12,'ack':!![]});return;}const _0x1837d6=_0x10f73d[_0x422682(0xf9)](_0x30c1a9=>new Date(_0x30c1a9['timestamp'])[_0x422682(0x134)]([],{'hour':_0x422682(0xdb),'minute':_0x422682(0xdb)})+'\x20'+_0x30c1a9[_0x422682(0x12a)]+'\x20('+_0x30c1a9[_0x422682(0xf8)]+')')[_0x422682(0x136)]('\x0a'),_0xf8433f=_0x422682(0x105)+_0x2abaa1+'\x0a\x20\x20\x20\x20EVENTS:\x0a'+_0x1837d6+_0x422682(0x107);try{updateApiTimestamp();const _0x54a5ed=await _0x3be3ae[_0x422682(0x156)][_0x422682(0xca)](_0xf8433f),_0x27687b=_0x54a5ed[_0x422682(0xea)]['text'](),_0x40c880=_0x5955ab===_0x422682(0x138)?_0x422682(0x125):_0x422682(0x12d);await _0x3be3ae[_0x422682(0x153)](_0x40c880,{'val':_0x27687b,'ack':!![]}),_0x3be3ae['log']['info'](_0x422682(0x12b)+_0x5955ab+_0x422682(0x11b));}catch(_0xf3250e){_0x3be3ae[_0x422682(0x116)][_0x422682(0x14c)](_0x422682(0x144)+_0xf3250e[_0x422682(0xdc)]);}}module['exports']={'executeAutomationAction':executeAutomationAction,'createDailyDigest':createDailyDigest,'runBaselineDriftAnalysis':runBaselineDriftAnalysis,'sendMorningBriefing':sendMorningBriefing,'runGeminiAnalysis':runGeminiAnalysis,'consultButler':consultButler,'generateHealthReport':generateHealthReport};