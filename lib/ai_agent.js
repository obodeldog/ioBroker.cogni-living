function a0_0x12e0(){const _0x49b8ae=['333598FXeASx','ðŸ¤–\x20Butler\x20Brain\x20Error:\x20','error','setStateAsync','ANALYZE_HEALTH','alertReason','join','aiPersona','\x0a\x20\x20\x20\x20ROLLE:\x20Medizinischer\x20Assistent\x20fÃ¼r\x20AAL\x20(Ambient\x20Assisted\x20Living).\x0a\x20\x20\x20\x20AUFGABE:\x20','.\x20AUFGABE:\x201.\x20Gesundheit?\x202.\x20Komfort?\x20FORMAT\x20(JSON):\x20{\x20\x22isAlert\x22:\x20boolean,\x20\x22alertReason\x22:\x20\x22string\x22,\x20\x22isEmergency\x22:\x20boolean,\x20\x22summary\x22:\x20\x22string\x22,\x20\x22automationProposal\x22:\x20{\x20\x22detected\x22:\x20boolean,\x20\x22description\x22:\x20\x22string\x22,\x20\x22targetId\x22:\x20\x22string\x22,\x20\x22targetValue\x22:\x20\x22any\x22\x20}\x20}','LTM.driftAnalysis.driftDetails','ðŸŒ…\x20Morning\x20Briefing:\x0a','debug','ðŸ¤–\x20BUTLER:\x20Executing\x20Action\x20->\x20','Started...','toLocaleTimeString','lastAlertState','790MhntSA','analysis.automation.targetId','Tag','baselineDrift','Unbekannt','setHours','LTM.driftAnalysis.baselineDrift','getForeignStateAsync','reason','analysis.automation.patternDetected','NIGHT','\x22\x20AN.\x0a\x20\x20\x20\x20STRATEGIE:\x20','decision','Skipped\x20(Traffic)','Nacht','slice','ðŸ¤–\x20Butler\x20Cache\x20Hit:\x20','Digest','ðŸŒ…\x20Briefing\x20generated\x20(Length:\x20','Maximaler\x20Komfort,\x20Energie\x20ist\x20zweitrangig.','detected','2-digit','\x0a\x20\x20\x20\x20ANTWORT-STIL:\x20Sachlich,\x20beruhigend,\x20prÃ¤zise.\x20Keine\x20Floskeln.\x0a\x20\x20\x20\x20','Erstelle\x20ein\x20kurzes\x20\x27Guten\x20Morgen\x27\x20Briefing\x20basierend\x20auf\x20den\x20Events\x20der\x20letzten\x20Nacht.','.Current.Temperature','sendNotification','analysis.automation.autoApply','ltmStbWindowDays','val','.\x20EVENTS:\x20','analysis.analysisHistory','254328GMgkqh','constructor','warn','LTM.processingStatus',').\x20Sending\x20notification...','BUTLER\x20Execution\x20Error:\x20','stringify','weatherInstance','\x0a\x20\x20\x20\x20FRAGE:\x20Ist\x20es\x20dunkel\x20genug\x20fÃ¼r\x20Licht?\x0a\x20\x20\x20\x20FORMAT:\x20{\x20\x22approved\x22:\x20boolean,\x20\x22reason\x22:\x20\x22kurzer\x20Grund\x22\x20}\x0a\x20\x20\x20\x20','8iMnaOK','push','Keine\x20Daten\x20fÃ¼r\x20die\x20Nacht\x20aufgezeichnet\x20(Sensoren\x20ruhig).',')\x20generated.','1390975iDvuMk','trim','currentSystemMode','(((.+)+)+)+$','pop','message','./setup','text','config','Gemini\x20Error:\x20','livingContext','geminiModel','generateContent',',\x20Wetter:\x20','1nybslh','Success','isEmergency','filter','N/A\x20(Learning)','132320aXxCCo','LTM.dailyDigests','approved','ðŸ¤–\x20Health\x20Report\x20(','KI-Fehler\x20(Fallback)','splice','toString','response','targetId','search','useWeather','70ZhBUqL','@google/generative-ai','analysis.health.geminiNight','ðŸŒ…\x20Starting\x20Morning\x20Briefing\x20sequence\x20(Traffic\x20Check\x20bypassed)...','.\x20KONTEXT:\x20','summary','Fokus\x20auf\x20Komfort\x20fÃ¼r\x20die\x20Familie.','923658hKAbfQ','\x0aAktivitÃ¤t:\x20','ðŸ¤–\x20Autopilot\x20skipped\x20(Traffic\x20Protection\x20active).','toISOString','Traffic-Schutz\x20(Auto-Approved)','analysisHistory','%)\x20nach\x20\x22',',\x20LichtverhÃ¤ltnisse:\x20','setDate','now','analysis.automation.targetValue','ðŸ¤–\x20BUTLER:\x20No\x20valid\x20target\x20ID\x20or\x20value\x20stored\x20for\x20execution.','PRIORITÃ„T:\x20Energie\x20sparen.\x20Schalte\x20nur,\x20wenn\x20absolut\x20notwendig\x20(Dunkelheit).','map','Entscheide\x20ausgewogen\x20zwischen\x20Komfort\x20und\x20Energie.','getStateAsync','isAlert','setForeignStateAsync','.\x20SYSTEM_MODE:\x20','rawEventLog','.forecast.current.temperature','Health\x20Report\x20Error:\x20','driftDetails','automationProposal','send','name','Wetterdaten\x20nicht\x20abrufbar','analysis.activitySummary','Briefing\x20Error:\x20','dailyDigests','PRIORITÃ„T:\x20Sicherheit\x20und\x20Licht.\x20Schalte\x20lieber\x20einmal\x20zu\x20viel\x20als\x20zu\x20wenig.','\x20Ã¼bersprungen\x20(Auto-Approved).','ðŸ¤–\x20Morning\x20Briefing\x20skipped:\x20No\x20Gemini\x20Model.','1071594xEpqzN','analysis.health.geminiDay','Skipped\x20(No\x20AI\x20or\x20Data)','Bisher\x20keine\x20AktivitÃ¤t\x20seit\x2008:00\x20Uhr\x20verzeichnet.','log','analysis.lastResult','isProVersion','replace','generic','âš ï¸\x20ALARM:\x20','length','activityLevel','\x20=\x20','timestamp','normal','system.presenceWho','165sFvEBL','getDate','.\x20ANWESEND:\x20','.\x0a\x20\x20\x20\x20EVENT:\x20Bewohner\x20geht\x20wahrscheinlich\x20(','info','getTime','eventHistory','parse'];a0_0x12e0=function(){return _0x49b8ae;};return a0_0x12e0();}const a0_0x5079bf=a0_0xabda;(function(_0x599a6c,_0x35c855){const _0x3d9632=a0_0xabda,_0x480b27=_0x599a6c();while(!![]){try{const _0x55b6cd=parseInt(_0x3d9632(0x155))/0x1*(-parseInt(_0x3d9632(0x10a))/0x2)+-parseInt(_0x3d9632(0x13a))/0x3*(parseInt(_0x3d9632(0x143))/0x4)+parseInt(_0x3d9632(0x147))/0x5+parseInt(_0x3d9632(0xd1))/0x6+parseInt(_0x3d9632(0x165))/0x7*(parseInt(_0x3d9632(0x15a))/0x8)+-parseInt(_0x3d9632(0xf2))/0x9+parseInt(_0x3d9632(0x11b))/0xa*(-parseInt(_0x3d9632(0x102))/0xb);if(_0x55b6cd===_0x35c855)break;else _0x480b27['push'](_0x480b27['shift']());}catch(_0x4237be){_0x480b27['push'](_0x480b27['shift']());}}}(a0_0x12e0,0x22688));const a0_0x195ca9=(function(){let _0x1a5881=!![];return function(_0x1737f3,_0x2038c0){const _0x2686f1=_0x1a5881?function(){if(_0x2038c0){const _0x19abaf=_0x2038c0['apply'](_0x1737f3,arguments);return _0x2038c0=null,_0x19abaf;}}:function(){};return _0x1a5881=![],_0x2686f1;};}()),a0_0x38f69f=a0_0x195ca9(this,function(){const _0x3f0d03=a0_0xabda;return a0_0x38f69f['toString']()[_0x3f0d03(0x163)]('(((.+)+)+)+$')[_0x3f0d03(0x160)]()[_0x3f0d03(0x13b)](a0_0x38f69f)[_0x3f0d03(0x163)](_0x3f0d03(0x14a));});a0_0x38f69f();'use strict';const {GoogleGenerativeAI}=require(a0_0x5079bf(0x166)),setup=require(a0_0x5079bf(0x14d)),GEMINI_MODEL='models/gemini-flash-latest',LTM_DP_DAILY_DIGESTS=a0_0x5079bf(0x15b),LTM_DP_STATUS=a0_0x5079bf(0x13d),LTM_DP_RAW_LOG='LTM.rawEventLog',LTM_MIN_EVENTS_FOR_COMPRESSION=0x5,MIN_API_GAP_MS=0x4e20;let lastGlobalApiCall=0x0;function a0_0xabda(_0x439cdc,_0x502b88){const _0xe07c24=a0_0x12e0();return a0_0xabda=function(_0x38f69f,_0x195ca9){_0x38f69f=_0x38f69f-0xd0;let _0x12e060=_0xe07c24[_0x38f69f];return _0x12e060;},a0_0xabda(_0x439cdc,_0x502b88);}const decisionCache={},CACHE_TTL_MS=0xf*0x3c*0x3e8,PERSONA_MAPPING={'generic':a0_0x5079bf(0xdf),'senior_aal':a0_0x5079bf(0xef),'family':a0_0x5079bf(0xd0),'single_comfort':a0_0x5079bf(0x12e),'security':'Sicherheit\x20geht\x20vor.','energy_saver':a0_0x5079bf(0xdd)};function canCallApi(){const _0x1a8b73=a0_0x5079bf,_0x51277e=Date[_0x1a8b73(0xda)]();return _0x51277e-lastGlobalApiCall>MIN_API_GAP_MS;}function updateApiTimestamp(){const _0x295e7c=a0_0x5079bf;lastGlobalApiCall=Date[_0x295e7c(0xda)]();}async function getWeatherContext(_0x1ab403){const _0x1cb418=a0_0x5079bf;if(!_0x1ab403['config'][_0x1cb418(0x164)]||!_0x1ab403[_0x1cb418(0x14f)][_0x1cb418(0x141)])return'Unbekannt\x20(Kein\x20Sensor)';try{const _0x4bf8d4=_0x1ab403[_0x1cb418(0x14f)]['weatherInstance'];let _0x54ba7b=await _0x1ab403[_0x1cb418(0x122)](_0x4bf8d4+_0x1cb418(0x133));if(!_0x54ba7b)_0x54ba7b=await _0x1ab403[_0x1cb418(0x122)](_0x4bf8d4+_0x1cb418(0xe5));let _0x1c056f=await _0x1ab403[_0x1cb418(0x122)](_0x4bf8d4+'.Current.WeatherText');if(!_0x1c056f)_0x1c056f=await _0x1ab403[_0x1cb418(0x122)](_0x4bf8d4+'.forecast.current.state');let _0x124a0c=_0x1cb418(0x11f);const _0x5377a5=await _0x1ab403[_0x1cb418(0x122)](_0x4bf8d4+'.Current.IsNight');if(_0x5377a5)_0x124a0c=_0x5377a5['val']?_0x1cb418(0x129):_0x1cb418(0x11d);if(_0x54ba7b&&_0x1c056f)return _0x54ba7b['val']+'Â°C,\x20'+_0x1c056f[_0x1cb418(0x137)]+_0x1cb418(0xd8)+_0x124a0c;}catch(_0x48d601){}return _0x1cb418(0xeb);}async function consultButler(_0x15f00b,_0x27d1f2,_0x2ccdd8,_0xb6e82b){const _0x440952=a0_0x5079bf;if(!_0x15f00b[_0x440952(0x152)])return{'approved':!![],'reason':'KI\x20offline\x20(Fallback)'};const _0x50fec6=Date[_0x440952(0xda)]();if(decisionCache[_0x27d1f2]&&_0x50fec6-decisionCache[_0x27d1f2]['timestamp']<CACHE_TTL_MS){const _0x2bf635=decisionCache[_0x27d1f2][_0x440952(0x127)];return _0x15f00b['log'][_0x440952(0x116)](_0x440952(0x12b)+_0x27d1f2+'\x20->\x20'+(_0x2bf635[_0x440952(0x15c)]?'OK':'NO')+'\x20('+_0x2bf635[_0x440952(0x123)]+')'),_0x2bf635;}if(!canCallApi())return _0x15f00b['log'][_0x440952(0x116)]('ðŸ¤–\x20Traffic\x20Schutz:\x20Anfrage\x20fÃ¼r\x20'+_0x27d1f2+_0x440952(0xf0)),{'approved':!![],'reason':_0x440952(0xd5)};const _0x3065b7=new Date()[_0x440952(0x119)](),_0x244feb=await getWeatherContext(_0x15f00b),_0x39f900=PERSONA_MAPPING[_0x15f00b[_0x440952(0x14f)][_0x440952(0x111)]||_0x440952(0xfa)],_0x122da4='\x0a\x20\x20\x20\x20ROLLE:\x20Haus-Butler.\x0a\x20\x20\x20\x20SITUATION:\x20'+_0x3065b7+_0x440952(0x154)+_0x244feb+_0x440952(0x105)+(_0xb6e82b*0x64)['toFixed'](0x0)+_0x440952(0xd7)+_0x27d1f2+'\x22.\x0a\x20\x20\x20\x20AKTION:\x20Schalte\x20\x22'+_0x2ccdd8+_0x440952(0x126)+_0x39f900+_0x440952(0x142);try{updateApiTimestamp();const _0x5887a4=await _0x15f00b[_0x440952(0x152)][_0x440952(0x153)](_0x122da4),_0x294b0a=_0x5887a4['response'][_0x440952(0x14e)]()[_0x440952(0xf9)](/```json|```/g,'')[_0x440952(0x148)](),_0x10db1b=JSON[_0x440952(0x109)](_0x294b0a);return decisionCache[_0x27d1f2]={'decision':_0x10db1b,'timestamp':_0x50fec6},_0x10db1b;}catch(_0x28989d){return _0x15f00b['log']['warn'](_0x440952(0x10b)+_0x28989d[_0x440952(0x14c)]),decisionCache[_0x27d1f2]={'decision':{'approved':!![],'reason':_0x440952(0x15e)},'timestamp':_0x50fec6-(CACHE_TTL_MS-0xea60)},{'approved':!![],'reason':_0x440952(0x15e)};}}async function runGeminiAnalysis(_0x38103e,_0x5a72f9=''){const _0x13d19b=a0_0x5079bf;if(!_0x38103e['geminiModel'])return;if(!canCallApi()){_0x38103e[_0x13d19b(0xf6)][_0x13d19b(0x116)](_0x13d19b(0xd3));return;}if(_0x38103e[_0x13d19b(0x108)]['length']===0x0)return;const _0x4d9262=_0x38103e[_0x13d19b(0x108)][_0x13d19b(0x12a)](0x0,0xf),_0x92f381=_0x38103e[_0x13d19b(0x149)],_0x83bc60=PERSONA_MAPPING[_0x38103e['config'][_0x13d19b(0x111)]||_0x13d19b(0xfa)],_0x19e4c8=_0x38103e[_0x13d19b(0x14f)][_0x13d19b(0x151)]||'Keine\x20Details.';let _0x4a559d=_0x13d19b(0x11f);try{const _0x1cfb9d=await _0x38103e[_0x13d19b(0xe0)](_0x13d19b(0x101));if(_0x1cfb9d&&_0x1cfb9d[_0x13d19b(0x137)])_0x4a559d=_0x1cfb9d['val'];}catch(_0x158952){}let _0x5eb16a=![];try{const _0x1721ca=await _0x38103e[_0x13d19b(0xe0)](_0x13d19b(0x135));if(_0x1721ca&&_0x1721ca['val'])_0x5eb16a=!![];}catch(_0x23646a){}const _0x463faa='ROLLE:\x20KI-Hausverwalter.\x20PERSONA:\x20'+_0x83bc60+_0x13d19b(0x169)+_0x19e4c8+_0x13d19b(0xe3)+_0x92f381+_0x13d19b(0x104)+_0x4a559d+_0x13d19b(0x138)+JSON[_0x13d19b(0x140)](_0x4d9262)+'.\x20EMERGENCY:\x20'+_0x5a72f9+_0x13d19b(0x113);try{updateApiTimestamp();const _0x40f335=await _0x38103e[_0x13d19b(0x152)]['generateContent'](_0x463faa),_0x1dea93=JSON[_0x13d19b(0x109)](_0x40f335[_0x13d19b(0x161)][_0x13d19b(0x14e)]()['replace'](/```json|```/g,'')['trim']());await _0x38103e[_0x13d19b(0x10d)](_0x13d19b(0xf7),{'val':JSON[_0x13d19b(0x140)](_0x1dea93),'ack':!![]});if(_0x1dea93[_0x13d19b(0x16a)])await _0x38103e[_0x13d19b(0x10d)](_0x13d19b(0xec),{'val':_0x1dea93[_0x13d19b(0x16a)],'ack':!![]});const _0x164e5d={'timestamp':Date['now'](),'id':Date[_0x13d19b(0xda)]()[_0x13d19b(0x160)](),'analysis':{'activity':{'summary':_0x1dea93[_0x13d19b(0x16a)],'isAlert':_0x1dea93[_0x13d19b(0xe1)],'alertReason':_0x1dea93[_0x13d19b(0x10f)]},'comfort':{'automationProposal':_0x1dea93['automationProposal']}}};_0x38103e[_0x13d19b(0xd6)]['unshift'](_0x164e5d);if(_0x38103e[_0x13d19b(0xd6)][_0x13d19b(0xfc)]>0x32)_0x38103e[_0x13d19b(0xd6)][_0x13d19b(0x14b)]();await _0x38103e['setStateAsync'](_0x13d19b(0x139),{'val':JSON[_0x13d19b(0x140)](_0x38103e[_0x13d19b(0xd6)]),'ack':!![]});const _0x3f413a=_0x1dea93[_0x13d19b(0xe1)]||![];_0x3f413a!==_0x38103e['lastAlertState']&&(await _0x38103e[_0x13d19b(0x10d)]('analysis.isAlert',{'val':_0x3f413a,'ack':!![]}),_0x38103e[_0x13d19b(0x11a)]=_0x3f413a,_0x3f413a&&(await _0x38103e[_0x13d19b(0x10d)]('analysis.alertReason',{'val':_0x1dea93['alertReason'],'ack':!![]}),setup[_0x13d19b(0x134)](_0x38103e,_0x13d19b(0xfb)+_0x1dea93[_0x13d19b(0x10f)],![],_0x1dea93[_0x13d19b(0x157)])));if(_0x1dea93[_0x13d19b(0xe8)]&&_0x1dea93['automationProposal'][_0x13d19b(0x12f)]){await _0x38103e['setStateAsync'](_0x13d19b(0x124),{'val':!![],'ack':!![]}),await _0x38103e[_0x13d19b(0x10d)]('analysis.automation.description',{'val':_0x1dea93['automationProposal']['description'],'ack':!![]}),await _0x38103e['setStateAsync'](_0x13d19b(0x11c),{'val':_0x1dea93[_0x13d19b(0xe8)][_0x13d19b(0x162)],'ack':!![]}),await _0x38103e[_0x13d19b(0x10d)](_0x13d19b(0xdb),{'val':JSON['stringify'](_0x1dea93[_0x13d19b(0xe8)]['targetValue']),'ack':!![]});if(_0x5eb16a)executeAutomationAction(_0x38103e);}}catch(_0x4221a7){_0x38103e[_0x13d19b(0xf6)][_0x13d19b(0x10c)](_0x13d19b(0x150)+_0x4221a7[_0x13d19b(0x14c)]);}}async function createDailyDigest(_0x509041,_0xd0175e){const _0x1264a4=a0_0x5079bf;if(!_0x509041[_0x1264a4(0xf8)])return;if(!canCallApi()){await _0x509041[_0x1264a4(0x10d)](LTM_DP_STATUS,{'val':_0x1264a4(0x128),'ack':!![]});return;}await _0x509041[_0x1264a4(0x10d)](LTM_DP_STATUS,{'val':_0x1264a4(0x118),'ack':!![]});if(!_0x509041[_0x1264a4(0x152)]||_0x509041[_0x1264a4(0xe4)][_0x1264a4(0xfc)]<LTM_MIN_EVENTS_FOR_COMPRESSION){await _0x509041[_0x1264a4(0x10d)](LTM_DP_STATUS,{'val':_0x1264a4(0xf4),'ack':!![]});return;}const _0x4bd576=JSON[_0x1264a4(0x109)](JSON[_0x1264a4(0x140)](_0x509041[_0x1264a4(0xe4)])),_0x47e2ea=_0x4bd576[_0x1264a4(0xfc)],_0x590d9a='ROLLE:\x20Data\x20Compression\x20Agent.\x20SPRACHE:\x20DE.\x20FORMAT:\x20JSON.\x20ANWEISUNG:\x20Fasse\x20Sensor-Events\x20zusammen.\x20SCHEMA:\x20{\x20\x22summary\x22:\x20\x22string\x22,\x20\x22activityLevel\x22:\x20\x22string\x22\x20}\x20\x0a\x0aEVENTS:\x0a'+JSON[_0x1264a4(0x140)](_0x4bd576);try{updateApiTimestamp();const _0x1fe296=await _0x509041[_0x1264a4(0x152)]['generateContent'](_0x590d9a),_0x454e81=JSON['parse'](_0x1fe296[_0x1264a4(0x161)][_0x1264a4(0x14e)]()['replace'](/```json|```/g,'')[_0x1264a4(0x148)]()),_0x3c00f7={'timestamp':new Date()[_0x1264a4(0xd4)](),'eventCount':_0x47e2ea,'summary':_0x454e81[_0x1264a4(0x16a)]||_0x1264a4(0x12c),'activityLevel':_0x454e81['activityLevel']||_0x1264a4(0x100),'systemMode':_0x509041[_0x1264a4(0x149)]};_0x509041['dailyDigests'][_0x1264a4(0x144)](_0x3c00f7);const _0x44f1d9=_0x509041[_0x1264a4(0x14f)]['ltmLtbWindowDays']||0x3c;_0x509041[_0x1264a4(0xee)][_0x1264a4(0xfc)]>_0x44f1d9&&_0x509041[_0x1264a4(0xee)][_0x1264a4(0x15f)](0x0,_0x509041[_0x1264a4(0xee)][_0x1264a4(0xfc)]-_0x44f1d9);await _0x509041['setStateAsync'](LTM_DP_DAILY_DIGESTS,{'val':JSON[_0x1264a4(0x140)](_0x509041[_0x1264a4(0xee)]),'ack':!![]}),_0x509041[_0x1264a4(0xe4)]=[],await _0x509041[_0x1264a4(0x10d)](LTM_DP_RAW_LOG,{'val':JSON[_0x1264a4(0x140)](_0x509041['rawEventLog']),'ack':!![]}),await _0x509041[_0x1264a4(0x10d)](LTM_DP_STATUS,{'val':_0x1264a4(0x156),'ack':!![]});const _0x48af78='ðŸ“…\x20Daily\x20Digest:\x0a'+_0x454e81['summary']+_0x1264a4(0xd2)+_0x454e81[_0x1264a4(0xfd)];setup[_0x1264a4(0x134)](_0x509041,_0x48af78,![],![]);if(_0x509041[_0x1264a4(0xf8)]&&_0xd0175e)_0xd0175e[_0x1264a4(0xe9)](_0x509041,_0x1264a4(0x10e),{'digest':_0x3c00f7});}catch(_0x41521b){_0x509041[_0x1264a4(0xf6)][_0x1264a4(0x10c)](_0x41521b[_0x1264a4(0x14c)]);}}async function runBaselineDriftAnalysis(_0x3f1073){const _0x33f269=a0_0x5079bf;if(!_0x3f1073[_0x33f269(0xf8)]||!_0x3f1073[_0x33f269(0x152)])return;if(!canCallApi())return;const _0x3ea55f=_0x3f1073[_0x33f269(0x14f)][_0x33f269(0x136)]||0xe;if(_0x3f1073[_0x33f269(0xee)]['length']<_0x3ea55f+0x7){await _0x3f1073['setStateAsync'](_0x33f269(0x121),{'val':_0x33f269(0x159),'ack':!![]});return;}const _0x333286=_0x3f1073[_0x33f269(0xee)][_0x33f269(0x12a)](-_0x3ea55f),_0x21b3e9=_0x3f1073[_0x33f269(0xee)][_0x33f269(0x12a)](0x0,_0x3f1073['dailyDigests']['length']-_0x3ea55f),_0x1dafac='ROLLE:\x20Data\x20Scientist.\x20ZIEL:\x20Drift\x20erkennen.\x20SCHEMA:\x20{\x20\x22baselineDrift\x22:\x20\x22none|slight|significant|critical\x22,\x20\x22driftDetails\x22:\x20\x22string\x22\x20}\x0a\x0aLTB:\x20'+JSON[_0x33f269(0x140)](_0x21b3e9)+'\x0aSTB:\x20'+JSON['stringify'](_0x333286);try{updateApiTimestamp();const _0x3cef7a=await _0x3f1073['geminiModel'][_0x33f269(0x153)](_0x1dafac),_0x356394=JSON[_0x33f269(0x109)](_0x3cef7a['response'][_0x33f269(0x14e)]()['replace'](/```json|```/g,'')[_0x33f269(0x148)]());_0x356394['baselineDrift']&&(await _0x3f1073['setStateAsync']('LTM.driftAnalysis.baselineDrift',{'val':_0x356394[_0x33f269(0x11e)],'ack':!![]}),await _0x3f1073[_0x33f269(0x10d)](_0x33f269(0x114),{'val':_0x356394[_0x33f269(0xe7)],'ack':!![]}),await _0x3f1073[_0x33f269(0x10d)]('LTM.driftAnalysis.lastCheck',{'val':Date[_0x33f269(0xda)](),'ack':!![]}));}catch(_0x4c5834){}}async function executeAutomationAction(_0x306493){const _0x2c0ba5=a0_0x5079bf;try{const _0x1cabbe=await _0x306493[_0x2c0ba5(0xe0)](_0x2c0ba5(0x11c)),_0x5f00e3=await _0x306493['getStateAsync']('analysis.automation.targetValue');if(_0x1cabbe&&_0x1cabbe['val']&&_0x5f00e3){const _0x33d512=_0x1cabbe['val'];let _0x226740=_0x5f00e3[_0x2c0ba5(0x137)];try{_0x226740=JSON[_0x2c0ba5(0x109)](_0x226740);}catch(_0x9255b3){}_0x306493[_0x2c0ba5(0xf6)]['info'](_0x2c0ba5(0x117)+_0x33d512+_0x2c0ba5(0xfe)+_0x226740),await _0x306493[_0x2c0ba5(0xe2)](_0x33d512,_0x226740);}else _0x306493['log'][_0x2c0ba5(0x13c)](_0x2c0ba5(0xdc));}catch(_0x112fb1){_0x306493[_0x2c0ba5(0xf6)]['error'](_0x2c0ba5(0x13f)+_0x112fb1[_0x2c0ba5(0x14c)]);}}async function sendMorningBriefing(_0x32f61e){const _0x4b7e46=a0_0x5079bf;if(!_0x32f61e[_0x4b7e46(0x152)]){_0x32f61e[_0x4b7e46(0xf6)][_0x4b7e46(0x13c)](_0x4b7e46(0xf1));return;}_0x32f61e[_0x4b7e46(0xf6)]['info'](_0x4b7e46(0x168));try{updateApiTimestamp();const _0x1f524d=_0x4b7e46(0x132),_0x4f013f=await _0x32f61e['geminiModel'][_0x4b7e46(0x153)](_0x1f524d),_0x424044=_0x4f013f[_0x4b7e46(0x161)]['text']();_0x32f61e[_0x4b7e46(0xf6)][_0x4b7e46(0x106)](_0x4b7e46(0x12d)+_0x424044[_0x4b7e46(0xfc)]+_0x4b7e46(0x13e)),setup[_0x4b7e46(0x134)](_0x32f61e,_0x4b7e46(0x115)+_0x424044);}catch(_0xff36d5){_0x32f61e[_0x4b7e46(0xf6)][_0x4b7e46(0x10c)](_0x4b7e46(0xed)+_0xff36d5[_0x4b7e46(0x14c)]);}}async function generateHealthReport(_0x2e8a89,_0x42c86b){const _0x57b8ec=a0_0x5079bf;if(!_0x2e8a89[_0x57b8ec(0x152)])return;const _0x587a67=Date['now']();_0x587a67-lastGlobalApiCall<0xbb8&&(_0x2e8a89[_0x57b8ec(0xf6)]['debug']('ðŸ¤–\x20API\x20Cooldown.\x20Waiting\x202s...'),await new Promise(_0xe530f4=>setTimeout(_0xe530f4,0x7d0)));const _0x34e0f7=new Date();let _0x1a8c28=0x0,_0x206550=_0x34e0f7[_0x57b8ec(0x107)](),_0x40584b='';if(_0x42c86b==='NIGHT'){const _0x5f5b2f=new Date(_0x34e0f7);_0x5f5b2f[_0x57b8ec(0xd9)](_0x5f5b2f[_0x57b8ec(0x103)]()-0x1),_0x5f5b2f[_0x57b8ec(0x120)](0x16,0x0,0x0,0x0),_0x1a8c28=_0x5f5b2f[_0x57b8ec(0x107)]();const _0x2c7c9e=new Date(_0x34e0f7);_0x2c7c9e['setHours'](0x8,0x0,0x0,0x0),_0x206550=_0x2c7c9e[_0x57b8ec(0x107)](),_0x40584b='Analysiere\x20diese\x20Events\x20der\x20NACHT\x20(22:00-08:00).\x20War\x20der\x20Schlaf\x20ruhig?\x20Gab\x20es\x20BadgÃ¤nge?\x20Antwort\x20kurz\x20fÃ¼r\x20den\x20besorgten\x20Sohn\x20(max\x202\x20SÃ¤tze).';}else{const _0x18f5a4=new Date(_0x34e0f7);_0x18f5a4[_0x57b8ec(0x120)](0x8,0x0,0x0,0x0),_0x1a8c28=_0x18f5a4['getTime'](),_0x40584b='Analysiere\x20diese\x20Events\x20des\x20TAGES\x20(08:00-Jetzt).\x20AktivitÃ¤t?\x20Mahlzeiten?\x20HaustÃ¼r?\x20Antwort\x20kurz\x20fÃ¼r\x20den\x20besorgten\x20Sohn\x20(max\x202\x20SÃ¤tze).';}const _0x5d80fb=_0x2e8a89[_0x57b8ec(0x108)][_0x57b8ec(0x158)](_0x1328d6=>_0x1328d6[_0x57b8ec(0xff)]>=_0x1a8c28&&_0x1328d6[_0x57b8ec(0xff)]<=_0x206550);if(_0x5d80fb['length']===0x0){const _0x488b5e=_0x42c86b===_0x57b8ec(0x125)?_0x57b8ec(0x145):_0x57b8ec(0xf5),_0x503ef3=_0x42c86b==='NIGHT'?'analysis.health.geminiNight':_0x57b8ec(0xf3);await _0x2e8a89[_0x57b8ec(0x10d)](_0x503ef3,{'val':_0x488b5e,'ack':!![]});return;}const _0x52e69c=_0x5d80fb[_0x57b8ec(0xde)](_0x4cf9d2=>new Date(_0x4cf9d2[_0x57b8ec(0xff)])[_0x57b8ec(0x119)]([],{'hour':_0x57b8ec(0x130),'minute':'2-digit'})+'\x20'+_0x4cf9d2[_0x57b8ec(0xea)]+'\x20('+_0x4cf9d2['value']+')')[_0x57b8ec(0x110)]('\x0a'),_0x5303ee=_0x57b8ec(0x112)+_0x40584b+'\x0a\x20\x20\x20\x20EVENTS:\x0a'+_0x52e69c+_0x57b8ec(0x131);try{updateApiTimestamp();const _0x3d9a29=await _0x2e8a89['geminiModel'][_0x57b8ec(0x153)](_0x5303ee),_0x5d99d2=_0x3d9a29[_0x57b8ec(0x161)][_0x57b8ec(0x14e)](),_0x51067f=_0x42c86b===_0x57b8ec(0x125)?_0x57b8ec(0x167):'analysis.health.geminiDay';await _0x2e8a89[_0x57b8ec(0x10d)](_0x51067f,{'val':_0x5d99d2,'ack':!![]}),_0x2e8a89['log']['info'](_0x57b8ec(0x15d)+_0x42c86b+_0x57b8ec(0x146));}catch(_0x3ea9f9){_0x2e8a89[_0x57b8ec(0xf6)][_0x57b8ec(0x10c)](_0x57b8ec(0xe6)+_0x3ea9f9[_0x57b8ec(0x14c)]);}}module['exports']={'executeAutomationAction':executeAutomationAction,'createDailyDigest':createDailyDigest,'runBaselineDriftAnalysis':runBaselineDriftAnalysis,'sendMorningBriefing':sendMorningBriefing,'runGeminiAnalysis':runGeminiAnalysis,'consultButler':consultButler,'generateHealthReport':generateHealthReport};