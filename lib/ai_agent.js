const a0_0x3dcea7=a0_0x11ac;function a0_0x11ac(_0x17d158,_0x540537){const _0x1ed1d5=a0_0x3233();return a0_0x11ac=function(_0x29b90c,_0x3a00a2){_0x29b90c=_0x29b90c-0x140;let _0x32332b=_0x1ed1d5[_0x29b90c];return _0x32332b;},a0_0x11ac(_0x17d158,_0x540537);}(function(_0xcaac3b,_0x142d67){const _0xac8b0c=a0_0x11ac,_0x15d9c3=_0xcaac3b();while(!![]){try{const _0x459185=parseInt(_0xac8b0c(0x1c0))/0x1+-parseInt(_0xac8b0c(0x157))/0x2+-parseInt(_0xac8b0c(0x1a6))/0x3+-parseInt(_0xac8b0c(0x1c5))/0x4*(-parseInt(_0xac8b0c(0x17d))/0x5)+-parseInt(_0xac8b0c(0x15a))/0x6*(-parseInt(_0xac8b0c(0x1b5))/0x7)+parseInt(_0xac8b0c(0x169))/0x8*(-parseInt(_0xac8b0c(0x1d0))/0x9)+-parseInt(_0xac8b0c(0x1da))/0xa*(-parseInt(_0xac8b0c(0x1d3))/0xb);if(_0x459185===_0x142d67)break;else _0x15d9c3['push'](_0x15d9c3['shift']());}catch(_0x282bc2){_0x15d9c3['push'](_0x15d9c3['shift']());}}}(a0_0x3233,0x2ff40));const a0_0x3a00a2=(function(){let _0x18c1f0=!![];return function(_0x193b0a,_0x2c5b66){const _0x221194=_0x18c1f0?function(){const _0x76913e=a0_0x11ac;if(_0x2c5b66){const _0x5580df=_0x2c5b66[_0x76913e(0x16f)](_0x193b0a,arguments);return _0x2c5b66=null,_0x5580df;}}:function(){};return _0x18c1f0=![],_0x221194;};}()),a0_0x29b90c=a0_0x3a00a2(this,function(){const _0x42e224=a0_0x11ac;return a0_0x29b90c[_0x42e224(0x16a)]()['search'](_0x42e224(0x145))[_0x42e224(0x16a)]()['constructor'](a0_0x29b90c)[_0x42e224(0x1ab)]('(((.+)+)+)+$');});a0_0x29b90c();'use strict';const {GoogleGenerativeAI}=require(a0_0x3dcea7(0x186)),setup=require(a0_0x3dcea7(0x193)),GEMINI_MODEL=a0_0x3dcea7(0x19b),LTM_DP_DAILY_DIGESTS=a0_0x3dcea7(0x1d8),LTM_DP_STATUS='LTM.processingStatus',LTM_DP_RAW_LOG=a0_0x3dcea7(0x18c),LTM_MIN_EVENTS_FOR_COMPRESSION=0x5,MIN_API_GAP_MS=0x4e20;let lastGlobalApiCall=0x0;const decisionCache={},CACHE_TTL_MS=0xf*0x3c*0x3e8,PERSONA_MAPPING={'generic':'Entscheide\x20ausgewogen\x20zwischen\x20Komfort\x20und\x20Energie.','senior_aal':a0_0x3dcea7(0x19a),'family':a0_0x3dcea7(0x155),'single_comfort':'Maximaler\x20Komfort,\x20Energie\x20ist\x20zweitrangig.','security':a0_0x3dcea7(0x161),'energy_saver':'PRIORIT√ÑT:\x20Energie\x20sparen.\x20Schalte\x20nur,\x20wenn\x20absolut\x20notwendig\x20(Dunkelheit).'};function canCallApi(){const _0x2f576b=a0_0x3dcea7,_0x5a52c9=Date[_0x2f576b(0x1be)]();return _0x5a52c9-lastGlobalApiCall>MIN_API_GAP_MS;}function updateApiTimestamp(){const _0x5365b6=a0_0x3dcea7;lastGlobalApiCall=Date[_0x5365b6(0x1be)]();}function a0_0x3233(){const _0x49c78a=['analysis.analysisHistory','LTM.dailyDigests','trim','10BkZMBs','Health\x20Report\x20Error:\x20','getStateAsync','analysisHistory','BUTLER\x20Execution\x20Error:\x20','analysis.lastResult','(((.+)+)+)+$','analysis.automation.targetValue','length','send','ltmLtbWindowDays','üåÖ\x20Starting\x20Morning\x20Briefing\x20sequence\x20(Traffic\x20Check\x20bypassed)...','warn','analysis.automation.targetId','lastAlertState','.\x20SYSTEM_MODE:\x20','Tag','ü§ñ\x20BUTLER:\x20No\x20valid\x20target\x20ID\x20or\x20value\x20stored\x20for\x20execution.','\x0a\x20\x20\x20\x20ROLLE:\x20Haus-Butler.\x0a\x20\x20\x20\x20SITUATION:\x20','message','slice','timestamp','Fokus\x20auf\x20Komfort\x20f√ºr\x20die\x20Familie.','stringify','276144dwOuIM','weatherInstance','info','1590rLmmrM','ü§ñ\x20Traffic\x20Schutz:\x20Anfrage\x20f√ºr\x20','system.presenceWho','isEmergency','sendNotification','analysis.automation.autoApply','toLocaleTimeString','Sicherheit\x20geht\x20vor.','parse','summary','baselineDrift','.\x20EVENTS:\x20','targetValue','currentSystemMode','error','141528lDQSQd','toString','generateContent','\x22.\x0a\x20\x20\x20\x20AKTION:\x20Schalte\x20\x22','toFixed','debug','apply','%)\x20nach\x20\x22','map','KI-Fehler\x20(Fallback)','aiPersona','ltmStbWindowDays','.Current.IsNight','üåÖ\x20Briefing\x20generated\x20(Length:\x20','generic','Briefing\x20Error:\x20','.forecast.current.temperature','text','.forecast.current.state','ü§ñ\x20Butler\x20Brain\x20Error:\x20','669755lEyDId','Traffic-Schutz\x20(Auto-Approved)','analysis.automation.description','useWeather','automationProposal','join','ANALYZE_HEALTH','NIGHT','ü§ñ\x20Health\x20Report\x20(','@google/generative-ai','Skipped\x20(No\x20AI\x20or\x20Data)','ü§ñ\x20API\x20Cooldown.\x20Waiting\x202s...','reason','setDate','Unbekannt','LTM.rawEventLog','driftDetails','targetId','\x20=\x20','setHours','.\x20KONTEXT:\x20','ü§ñ\x20Autopilot\x20skipped\x20(Traffic\x20Protection\x20active).','./setup','2-digit','\x20->\x20','LTM.driftAnalysis.baselineDrift','setForeignStateAsync','val','splice','PRIORIT√ÑT:\x20Sicherheit\x20und\x20Licht.\x20Schalte\x20lieber\x20einmal\x20zu\x20viel\x20als\x20zu\x20wenig.','models/gemini-flash-latest','getTime','Digest','Keine\x20Daten\x20f√ºr\x20die\x20Nacht\x20aufgezeichnet\x20(Sensoren\x20ruhig).','setStateAsync','ü§ñ\x20Morning\x20Briefing\x20skipped:\x20No\x20Gemini\x20Model.','ROLLE:\x20Data\x20Compression\x20Agent.\x20SPRACHE:\x20DE.\x20FORMAT:\x20JSON.\x20ANWEISUNG:\x20Fasse\x20Sensor-Events\x20zusammen.\x20SCHEMA:\x20{\x20\x22summary\x22:\x20\x22string\x22,\x20\x22activityLevel\x22:\x20\x22string\x22\x20}\x20\x0a\x0aEVENTS:\x0a','filter',',\x20Wetter:\x20','.\x20AUFGABE:\x201.\x20Gesundheit?\x202.\x20Komfort?\x20FORMAT\x20(JSON):\x20{\x20\x22isAlert\x22:\x20boolean,\x20\x22alertReason\x22:\x20\x22string\x22,\x20\x22isEmergency\x22:\x20boolean,\x20\x22summary\x22:\x20\x22string\x22,\x20\x22automationProposal\x22:\x20{\x20\x22detected\x22:\x20boolean,\x20\x22description\x22:\x20\x22string\x22,\x20\x22targetId\x22:\x20\x22string\x22,\x20\x22targetValue\x22:\x20\x22any\x22\x20}\x20}','üìÖ\x20Daily\x20Digest:\x0a','645294oUqzPG','eventHistory','name','ü§ñ\x20BUTLER:\x20Executing\x20Action\x20->\x20','.\x20EMERGENCY:\x20','search','activityLevel','detected','description','.\x0a\x20\x20\x20\x20EVENT:\x20Bewohner\x20geht\x20wahrscheinlich\x20(','livingContext','Wetterdaten\x20nicht\x20abrufbar','getForeignStateAsync','unshift','KI\x20offline\x20(Fallback)','4487UfhHCt','\x0a\x20\x20\x20\x20ROLLE:\x20Medizinischer\x20Assistent\x20f√ºr\x20AAL\x20(Ambient\x20Assisted\x20Living).\x0a\x20\x20\x20\x20AUFGABE:\x20','geminiModel','getDate','isAlert','decision','ROLLE:\x20Data\x20Scientist.\x20ZIEL:\x20Drift\x20erkennen.\x20SCHEMA:\x20{\x20\x22baselineDrift\x22:\x20\x22none|slight|significant|critical\x22,\x20\x22driftDetails\x22:\x20\x22string\x22\x20}\x0a\x0aLTB:\x20','dailyDigests','analysis.health.geminiDay','now','analysis.health.geminiNight','330230rLyzlG',').\x20Sending\x20notification...','approved','analysis.automation.patternDetected','isProVersion','4FYZkoi','rawEventLog','\x0a\x20\x20\x20\x20ANTWORT-STIL:\x20Sachlich,\x20beruhigend,\x20pr√§zise.\x20Keine\x20Floskeln.\x0a\x20\x20\x20\x20','config','.Current.WeatherText','log','Erstelle\x20ein\x20kurzes\x20\x27Guten\x20Morgen\x27\x20Briefing\x20basierend\x20auf\x20den\x20Events\x20der\x20letzten\x20Nacht.','\x20√ºbersprungen\x20(Auto-Approved).','replace','.\x20ANWESEND:\x20','alertReason','45cnaSEH','Keine\x20Details.','üåÖ\x20Morning\x20Briefing:\x0a','43945MbfLMQ','analysis.activitySummary',',\x20Lichtverh√§ltnisse:\x20','response'];a0_0x3233=function(){return _0x49c78a;};return a0_0x3233();}async function getWeatherContext(_0x1a6ee6){const _0x6f3e9=a0_0x3dcea7;if(!_0x1a6ee6[_0x6f3e9(0x1c8)][_0x6f3e9(0x180)]||!_0x1a6ee6[_0x6f3e9(0x1c8)][_0x6f3e9(0x158)])return'Unbekannt\x20(Kein\x20Sensor)';try{const _0x582fc9=_0x1a6ee6[_0x6f3e9(0x1c8)][_0x6f3e9(0x158)];let _0x52af35=await _0x1a6ee6['getForeignStateAsync'](_0x582fc9+'.Current.Temperature');if(!_0x52af35)_0x52af35=await _0x1a6ee6['getForeignStateAsync'](_0x582fc9+_0x6f3e9(0x179));let _0x27cfc4=await _0x1a6ee6['getForeignStateAsync'](_0x582fc9+_0x6f3e9(0x1c9));if(!_0x27cfc4)_0x27cfc4=await _0x1a6ee6[_0x6f3e9(0x1b2)](_0x582fc9+_0x6f3e9(0x17b));let _0x1828c9=_0x6f3e9(0x18b);const _0x3d3d0f=await _0x1a6ee6['getForeignStateAsync'](_0x582fc9+_0x6f3e9(0x175));if(_0x3d3d0f)_0x1828c9=_0x3d3d0f['val']?'Nacht':_0x6f3e9(0x14f);if(_0x52af35&&_0x27cfc4)return _0x52af35[_0x6f3e9(0x198)]+'¬∞C,\x20'+_0x27cfc4[_0x6f3e9(0x198)]+_0x6f3e9(0x1d5)+_0x1828c9;}catch(_0x12fc14){}return _0x6f3e9(0x1b1);}async function consultButler(_0x74326f,_0x4f5529,_0x311c1b,_0x5098fe){const _0x1bb515=a0_0x3dcea7;if(!_0x74326f[_0x1bb515(0x1b7)])return{'approved':!![],'reason':_0x1bb515(0x1b4)};const _0x587052=Date['now']();if(decisionCache[_0x4f5529]&&_0x587052-decisionCache[_0x4f5529][_0x1bb515(0x154)]<CACHE_TTL_MS){const _0x5a5c09=decisionCache[_0x4f5529][_0x1bb515(0x1ba)];return _0x74326f[_0x1bb515(0x1ca)]['debug']('ü§ñ\x20Butler\x20Cache\x20Hit:\x20'+_0x4f5529+_0x1bb515(0x195)+(_0x5a5c09[_0x1bb515(0x1c2)]?'OK':'NO')+'\x20('+_0x5a5c09[_0x1bb515(0x189)]+')'),_0x5a5c09;}if(!canCallApi())return _0x74326f[_0x1bb515(0x1ca)][_0x1bb515(0x16e)](_0x1bb515(0x15b)+_0x4f5529+_0x1bb515(0x1cc)),{'approved':!![],'reason':_0x1bb515(0x17e)};const _0x19de77=new Date()['toLocaleTimeString'](),_0x4083e9=await getWeatherContext(_0x74326f),_0x223ccd=PERSONA_MAPPING[_0x74326f[_0x1bb515(0x1c8)][_0x1bb515(0x173)]||_0x1bb515(0x177)],_0x1400d7=_0x1bb515(0x151)+_0x19de77+_0x1bb515(0x1a3)+_0x4083e9+_0x1bb515(0x1af)+(_0x5098fe*0x64)[_0x1bb515(0x16d)](0x0)+_0x1bb515(0x170)+_0x4f5529+_0x1bb515(0x16c)+_0x311c1b+'\x22\x20AN.\x0a\x20\x20\x20\x20STRATEGIE:\x20'+_0x223ccd+'\x0a\x20\x20\x20\x20FRAGE:\x20Ist\x20es\x20dunkel\x20genug\x20f√ºr\x20Licht?\x0a\x20\x20\x20\x20FORMAT:\x20{\x20\x22approved\x22:\x20boolean,\x20\x22reason\x22:\x20\x22kurzer\x20Grund\x22\x20}\x0a\x20\x20\x20\x20';try{updateApiTimestamp();const _0x3fb2b7=await _0x74326f['geminiModel']['generateContent'](_0x1400d7),_0x507721=_0x3fb2b7[_0x1bb515(0x1d6)][_0x1bb515(0x17a)]()[_0x1bb515(0x1cd)](/```json|```/g,'')[_0x1bb515(0x1d9)](),_0x2a8a55=JSON[_0x1bb515(0x162)](_0x507721);return decisionCache[_0x4f5529]={'decision':_0x2a8a55,'timestamp':_0x587052},_0x2a8a55;}catch(_0x466334){return _0x74326f[_0x1bb515(0x1ca)][_0x1bb515(0x14b)](_0x1bb515(0x17c)+_0x466334[_0x1bb515(0x152)]),decisionCache[_0x4f5529]={'decision':{'approved':!![],'reason':_0x1bb515(0x172)},'timestamp':_0x587052-(CACHE_TTL_MS-0xea60)},{'approved':!![],'reason':_0x1bb515(0x172)};}}async function runGeminiAnalysis(_0x12ab6f,_0x4d03d0=''){const _0x1b1bbc=a0_0x3dcea7;if(!_0x12ab6f['geminiModel'])return;if(!canCallApi()){_0x12ab6f['log'][_0x1b1bbc(0x16e)](_0x1b1bbc(0x192));return;}if(_0x12ab6f['eventHistory'][_0x1b1bbc(0x147)]===0x0)return;const _0x384619=_0x12ab6f[_0x1b1bbc(0x1a7)][_0x1b1bbc(0x153)](0x0,0xf),_0x241e31=_0x12ab6f[_0x1b1bbc(0x167)],_0x25e298=PERSONA_MAPPING[_0x12ab6f['config'][_0x1b1bbc(0x173)]||'generic'],_0x471af2=_0x12ab6f[_0x1b1bbc(0x1c8)][_0x1b1bbc(0x1b0)]||_0x1b1bbc(0x1d1);let _0x3f0ec0='Unbekannt';try{const _0x3aa8bd=await _0x12ab6f[_0x1b1bbc(0x141)](_0x1b1bbc(0x15c));if(_0x3aa8bd&&_0x3aa8bd[_0x1b1bbc(0x198)])_0x3f0ec0=_0x3aa8bd[_0x1b1bbc(0x198)];}catch(_0x42f98d){}let _0x41570d=![];try{const _0x4ae6ef=await _0x12ab6f[_0x1b1bbc(0x141)](_0x1b1bbc(0x15f));if(_0x4ae6ef&&_0x4ae6ef[_0x1b1bbc(0x198)])_0x41570d=!![];}catch(_0x2f223b){}const _0x2a7fd3='ROLLE:\x20KI-Hausverwalter.\x20PERSONA:\x20'+_0x25e298+_0x1b1bbc(0x191)+_0x471af2+_0x1b1bbc(0x14e)+_0x241e31+_0x1b1bbc(0x1ce)+_0x3f0ec0+_0x1b1bbc(0x165)+JSON[_0x1b1bbc(0x156)](_0x384619)+_0x1b1bbc(0x1aa)+_0x4d03d0+_0x1b1bbc(0x1a4);try{updateApiTimestamp();const _0x20e91b=await _0x12ab6f[_0x1b1bbc(0x1b7)][_0x1b1bbc(0x16b)](_0x2a7fd3),_0x2614f9=JSON[_0x1b1bbc(0x162)](_0x20e91b[_0x1b1bbc(0x1d6)]['text']()['replace'](/```json|```/g,'')[_0x1b1bbc(0x1d9)]());await _0x12ab6f['setStateAsync'](_0x1b1bbc(0x144),{'val':JSON['stringify'](_0x2614f9),'ack':!![]});if(_0x2614f9[_0x1b1bbc(0x163)])await _0x12ab6f[_0x1b1bbc(0x19f)](_0x1b1bbc(0x1d4),{'val':_0x2614f9[_0x1b1bbc(0x163)],'ack':!![]});const _0x4831c4={'timestamp':Date['now'](),'id':Date[_0x1b1bbc(0x1be)]()[_0x1b1bbc(0x16a)](),'analysis':{'activity':{'summary':_0x2614f9[_0x1b1bbc(0x163)],'isAlert':_0x2614f9[_0x1b1bbc(0x1b9)],'alertReason':_0x2614f9[_0x1b1bbc(0x1cf)]},'comfort':{'automationProposal':_0x2614f9[_0x1b1bbc(0x181)]}}};_0x12ab6f[_0x1b1bbc(0x142)][_0x1b1bbc(0x1b3)](_0x4831c4);if(_0x12ab6f[_0x1b1bbc(0x142)][_0x1b1bbc(0x147)]>0x32)_0x12ab6f[_0x1b1bbc(0x142)]['pop']();await _0x12ab6f['setStateAsync'](_0x1b1bbc(0x1d7),{'val':JSON[_0x1b1bbc(0x156)](_0x12ab6f['analysisHistory']),'ack':!![]});const _0x3de215=_0x2614f9['isAlert']||![];_0x3de215!==_0x12ab6f[_0x1b1bbc(0x14d)]&&(await _0x12ab6f[_0x1b1bbc(0x19f)]('analysis.isAlert',{'val':_0x3de215,'ack':!![]}),_0x12ab6f['lastAlertState']=_0x3de215,_0x3de215&&(await _0x12ab6f[_0x1b1bbc(0x19f)]('analysis.alertReason',{'val':_0x2614f9[_0x1b1bbc(0x1cf)],'ack':!![]}),setup['sendNotification'](_0x12ab6f,'‚ö†Ô∏è\x20ALARM:\x20'+_0x2614f9[_0x1b1bbc(0x1cf)],![],_0x2614f9[_0x1b1bbc(0x15d)])));if(_0x2614f9['automationProposal']&&_0x2614f9['automationProposal'][_0x1b1bbc(0x1ad)]){await _0x12ab6f[_0x1b1bbc(0x19f)](_0x1b1bbc(0x1c3),{'val':!![],'ack':!![]}),await _0x12ab6f['setStateAsync'](_0x1b1bbc(0x17f),{'val':_0x2614f9['automationProposal'][_0x1b1bbc(0x1ae)],'ack':!![]}),await _0x12ab6f[_0x1b1bbc(0x19f)]('analysis.automation.targetId',{'val':_0x2614f9[_0x1b1bbc(0x181)][_0x1b1bbc(0x18e)],'ack':!![]}),await _0x12ab6f[_0x1b1bbc(0x19f)](_0x1b1bbc(0x146),{'val':JSON[_0x1b1bbc(0x156)](_0x2614f9[_0x1b1bbc(0x181)][_0x1b1bbc(0x166)]),'ack':!![]});if(_0x41570d)executeAutomationAction(_0x12ab6f);}}catch(_0x3b13d4){_0x12ab6f[_0x1b1bbc(0x1ca)][_0x1b1bbc(0x168)]('Gemini\x20Error:\x20'+_0x3b13d4[_0x1b1bbc(0x152)]);}}async function createDailyDigest(_0x30069d,_0x153832){const _0x3a5246=a0_0x3dcea7;if(!_0x30069d['isProVersion'])return;if(!canCallApi()){await _0x30069d[_0x3a5246(0x19f)](LTM_DP_STATUS,{'val':'Skipped\x20(Traffic)','ack':!![]});return;}await _0x30069d[_0x3a5246(0x19f)](LTM_DP_STATUS,{'val':'Started...','ack':!![]});if(!_0x30069d[_0x3a5246(0x1b7)]||_0x30069d[_0x3a5246(0x1c6)][_0x3a5246(0x147)]<LTM_MIN_EVENTS_FOR_COMPRESSION){await _0x30069d[_0x3a5246(0x19f)](LTM_DP_STATUS,{'val':_0x3a5246(0x187),'ack':!![]});return;}const _0x113ac7=JSON[_0x3a5246(0x162)](JSON[_0x3a5246(0x156)](_0x30069d[_0x3a5246(0x1c6)])),_0x10defa=_0x113ac7[_0x3a5246(0x147)],_0x4e5245=_0x3a5246(0x1a1)+JSON[_0x3a5246(0x156)](_0x113ac7);try{updateApiTimestamp();const _0x55cf19=await _0x30069d[_0x3a5246(0x1b7)][_0x3a5246(0x16b)](_0x4e5245),_0x49cb6a=JSON['parse'](_0x55cf19[_0x3a5246(0x1d6)]['text']()['replace'](/```json|```/g,'')['trim']()),_0x56567f={'timestamp':new Date()['toISOString'](),'eventCount':_0x10defa,'summary':_0x49cb6a[_0x3a5246(0x163)]||_0x3a5246(0x19d),'activityLevel':_0x49cb6a[_0x3a5246(0x1ac)]||'normal','systemMode':_0x30069d[_0x3a5246(0x167)]};_0x30069d[_0x3a5246(0x1bc)]['push'](_0x56567f);const _0x1deb4a=_0x30069d[_0x3a5246(0x1c8)][_0x3a5246(0x149)]||0x3c;_0x30069d[_0x3a5246(0x1bc)][_0x3a5246(0x147)]>_0x1deb4a&&_0x30069d['dailyDigests'][_0x3a5246(0x199)](0x0,_0x30069d[_0x3a5246(0x1bc)][_0x3a5246(0x147)]-_0x1deb4a);await _0x30069d[_0x3a5246(0x19f)](LTM_DP_DAILY_DIGESTS,{'val':JSON[_0x3a5246(0x156)](_0x30069d[_0x3a5246(0x1bc)]),'ack':!![]}),_0x30069d[_0x3a5246(0x1c6)]=[],await _0x30069d[_0x3a5246(0x19f)](LTM_DP_RAW_LOG,{'val':JSON[_0x3a5246(0x156)](_0x30069d['rawEventLog']),'ack':!![]}),await _0x30069d[_0x3a5246(0x19f)](LTM_DP_STATUS,{'val':'Success','ack':!![]});const _0x1232bf=_0x3a5246(0x1a5)+_0x49cb6a[_0x3a5246(0x163)]+'\x0aAktivit√§t:\x20'+_0x49cb6a[_0x3a5246(0x1ac)];setup[_0x3a5246(0x15e)](_0x30069d,_0x1232bf,![],![]);if(_0x30069d['isProVersion']&&_0x153832)_0x153832[_0x3a5246(0x148)](_0x30069d,_0x3a5246(0x183),{'digest':_0x56567f});}catch(_0x16c26a){_0x30069d[_0x3a5246(0x1ca)][_0x3a5246(0x168)](_0x16c26a[_0x3a5246(0x152)]);}}async function runBaselineDriftAnalysis(_0x8bef14){const _0x3e94f0=a0_0x3dcea7;if(!_0x8bef14[_0x3e94f0(0x1c4)]||!_0x8bef14[_0x3e94f0(0x1b7)])return;if(!canCallApi())return;const _0x44f8ac=_0x8bef14['config'][_0x3e94f0(0x174)]||0xe;if(_0x8bef14[_0x3e94f0(0x1bc)]['length']<_0x44f8ac+0x7){await _0x8bef14['setStateAsync']('LTM.driftAnalysis.baselineDrift',{'val':'N/A\x20(Learning)','ack':!![]});return;}const _0x5b44f3=_0x8bef14[_0x3e94f0(0x1bc)]['slice'](-_0x44f8ac),_0x540cb8=_0x8bef14[_0x3e94f0(0x1bc)][_0x3e94f0(0x153)](0x0,_0x8bef14['dailyDigests'][_0x3e94f0(0x147)]-_0x44f8ac),_0x128b7a=_0x3e94f0(0x1bb)+JSON[_0x3e94f0(0x156)](_0x540cb8)+'\x0aSTB:\x20'+JSON[_0x3e94f0(0x156)](_0x5b44f3);try{updateApiTimestamp();const _0x537728=await _0x8bef14[_0x3e94f0(0x1b7)]['generateContent'](_0x128b7a),_0x31213b=JSON[_0x3e94f0(0x162)](_0x537728[_0x3e94f0(0x1d6)]['text']()[_0x3e94f0(0x1cd)](/```json|```/g,'')[_0x3e94f0(0x1d9)]());_0x31213b['baselineDrift']&&(await _0x8bef14[_0x3e94f0(0x19f)](_0x3e94f0(0x196),{'val':_0x31213b[_0x3e94f0(0x164)],'ack':!![]}),await _0x8bef14['setStateAsync']('LTM.driftAnalysis.driftDetails',{'val':_0x31213b[_0x3e94f0(0x18d)],'ack':!![]}),await _0x8bef14['setStateAsync']('LTM.driftAnalysis.lastCheck',{'val':Date[_0x3e94f0(0x1be)](),'ack':!![]}));}catch(_0x3ec7a8){}}async function executeAutomationAction(_0x5c081b){const _0x238af2=a0_0x3dcea7;try{const _0x139362=await _0x5c081b[_0x238af2(0x141)](_0x238af2(0x14c)),_0x5232fe=await _0x5c081b['getStateAsync']('analysis.automation.targetValue');if(_0x139362&&_0x139362[_0x238af2(0x198)]&&_0x5232fe){const _0x324e01=_0x139362[_0x238af2(0x198)];let _0x3525c9=_0x5232fe[_0x238af2(0x198)];try{_0x3525c9=JSON['parse'](_0x3525c9);}catch(_0x2218fa){}_0x5c081b[_0x238af2(0x1ca)][_0x238af2(0x159)](_0x238af2(0x1a9)+_0x324e01+_0x238af2(0x18f)+_0x3525c9),await _0x5c081b[_0x238af2(0x197)](_0x324e01,_0x3525c9);}else _0x5c081b[_0x238af2(0x1ca)][_0x238af2(0x14b)](_0x238af2(0x150));}catch(_0x49cde9){_0x5c081b[_0x238af2(0x1ca)]['error'](_0x238af2(0x143)+_0x49cde9['message']);}}async function sendMorningBriefing(_0x984dd2){const _0x3de683=a0_0x3dcea7;if(!_0x984dd2[_0x3de683(0x1b7)]){_0x984dd2[_0x3de683(0x1ca)][_0x3de683(0x14b)](_0x3de683(0x1a0));return;}_0x984dd2['log']['info'](_0x3de683(0x14a));try{updateApiTimestamp();const _0x3094f3=_0x3de683(0x1cb),_0x366008=await _0x984dd2[_0x3de683(0x1b7)]['generateContent'](_0x3094f3),_0x1a6d53=_0x366008['response'][_0x3de683(0x17a)]();_0x984dd2[_0x3de683(0x1ca)]['info'](_0x3de683(0x176)+_0x1a6d53[_0x3de683(0x147)]+_0x3de683(0x1c1)),setup[_0x3de683(0x15e)](_0x984dd2,_0x3de683(0x1d2)+_0x1a6d53);}catch(_0x440076){_0x984dd2[_0x3de683(0x1ca)]['error'](_0x3de683(0x178)+_0x440076['message']);}}async function generateHealthReport(_0x19e783,_0x496e98){const _0xe7eb92=a0_0x3dcea7;if(!_0x19e783[_0xe7eb92(0x1b7)])return;const _0x1e445a=Date['now']();_0x1e445a-lastGlobalApiCall<0xbb8&&(_0x19e783['log'][_0xe7eb92(0x16e)](_0xe7eb92(0x188)),await new Promise(_0x1e4ec8=>setTimeout(_0x1e4ec8,0x7d0)));const _0x3f7e63=new Date();let _0x1a4ca9=0x0,_0x4ddbf8=_0x3f7e63[_0xe7eb92(0x19c)](),_0xff0e32='';if(_0x496e98===_0xe7eb92(0x184)){const _0x522169=new Date(_0x3f7e63);_0x522169[_0xe7eb92(0x18a)](_0x522169[_0xe7eb92(0x1b8)]()-0x1),_0x522169[_0xe7eb92(0x190)](0x16,0x0,0x0,0x0),_0x1a4ca9=_0x522169[_0xe7eb92(0x19c)]();const _0x12829d=new Date(_0x3f7e63);_0x12829d[_0xe7eb92(0x190)](0x8,0x0,0x0,0x0),_0x4ddbf8=_0x12829d[_0xe7eb92(0x19c)](),_0xff0e32='Analysiere\x20diese\x20Events\x20der\x20NACHT\x20(22:00-08:00).\x20War\x20der\x20Schlaf\x20ruhig?\x20Gab\x20es\x20Badg√§nge?\x20Antwort\x20kurz\x20f√ºr\x20den\x20besorgten\x20Sohn\x20(max\x202\x20S√§tze).';}else{const _0xd3d39a=new Date(_0x3f7e63);_0xd3d39a[_0xe7eb92(0x190)](0x8,0x0,0x0,0x0),_0x1a4ca9=_0xd3d39a['getTime'](),_0xff0e32='Analysiere\x20diese\x20Events\x20des\x20TAGES\x20(08:00-Jetzt).\x20Aktivit√§t?\x20Mahlzeiten?\x20Haust√ºr?\x20Antwort\x20kurz\x20f√ºr\x20den\x20besorgten\x20Sohn\x20(max\x202\x20S√§tze).';}const _0x48b79b=_0x19e783[_0xe7eb92(0x1a7)][_0xe7eb92(0x1a2)](_0x33dda1=>_0x33dda1[_0xe7eb92(0x154)]>=_0x1a4ca9&&_0x33dda1[_0xe7eb92(0x154)]<=_0x4ddbf8);if(_0x48b79b[_0xe7eb92(0x147)]===0x0){const _0x24a942=_0x496e98==='NIGHT'?_0xe7eb92(0x19e):'Bisher\x20keine\x20Aktivit√§t\x20seit\x2008:00\x20Uhr\x20verzeichnet.',_0x1b79f3=_0x496e98===_0xe7eb92(0x184)?_0xe7eb92(0x1bf):'analysis.health.geminiDay';await _0x19e783[_0xe7eb92(0x19f)](_0x1b79f3,{'val':_0x24a942,'ack':!![]});return;}const _0x176d10=_0x48b79b[_0xe7eb92(0x171)](_0x3f5f3d=>new Date(_0x3f5f3d[_0xe7eb92(0x154)])[_0xe7eb92(0x160)]([],{'hour':_0xe7eb92(0x194),'minute':'2-digit'})+'\x20'+_0x3f5f3d[_0xe7eb92(0x1a8)]+'\x20('+_0x3f5f3d['value']+')')[_0xe7eb92(0x182)]('\x0a'),_0x41aae8=_0xe7eb92(0x1b6)+_0xff0e32+'\x0a\x20\x20\x20\x20EVENTS:\x0a'+_0x176d10+_0xe7eb92(0x1c7);try{updateApiTimestamp();const _0x57f826=await _0x19e783[_0xe7eb92(0x1b7)]['generateContent'](_0x41aae8),_0x103108=_0x57f826[_0xe7eb92(0x1d6)]['text'](),_0x411c5a=_0x496e98==='NIGHT'?_0xe7eb92(0x1bf):_0xe7eb92(0x1bd);await _0x19e783[_0xe7eb92(0x19f)](_0x411c5a,{'val':_0x103108,'ack':!![]}),_0x19e783['log']['info'](_0xe7eb92(0x185)+_0x496e98+')\x20generated.');}catch(_0x2e78c4){_0x19e783[_0xe7eb92(0x1ca)][_0xe7eb92(0x168)](_0xe7eb92(0x140)+_0x2e78c4[_0xe7eb92(0x152)]);}}module['exports']={'executeAutomationAction':executeAutomationAction,'createDailyDigest':createDailyDigest,'runBaselineDriftAnalysis':runBaselineDriftAnalysis,'sendMorningBriefing':sendMorningBriefing,'runGeminiAnalysis':runGeminiAnalysis,'consultButler':consultButler,'generateHealthReport':generateHealthReport};