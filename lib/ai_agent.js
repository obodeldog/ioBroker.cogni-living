const a0_0x407352=a0_0x5aaf;(function(_0x818a8b,_0x42ad82){const _0x3b6f9d=a0_0x5aaf,_0x431b55=_0x818a8b();while(!![]){try{const _0x514531=parseInt(_0x3b6f9d(0x161))/0x1+-parseInt(_0x3b6f9d(0x170))/0x2+-parseInt(_0x3b6f9d(0x1a4))/0x3*(parseInt(_0x3b6f9d(0x1b9))/0x4)+-parseInt(_0x3b6f9d(0x195))/0x5+parseInt(_0x3b6f9d(0x15f))/0x6+-parseInt(_0x3b6f9d(0x165))/0x7*(-parseInt(_0x3b6f9d(0x13e))/0x8)+parseInt(_0x3b6f9d(0x186))/0x9*(parseInt(_0x3b6f9d(0x154))/0xa);if(_0x514531===_0x42ad82)break;else _0x431b55['push'](_0x431b55['shift']());}catch(_0xbcee24){_0x431b55['push'](_0x431b55['shift']());}}}(a0_0x21bc,0x1a48d));const a0_0x258cab=(function(){let _0x9fd79=!![];return function(_0xf2e169,_0x28684f){const _0x4eb87e=_0x9fd79?function(){const _0x406dec=a0_0x5aaf;if(_0x28684f){const _0x3c2cb0=_0x28684f[_0x406dec(0x118)](_0xf2e169,arguments);return _0x28684f=null,_0x3c2cb0;}}:function(){};return _0x9fd79=![],_0x4eb87e;};}()),a0_0x4c6e51=a0_0x258cab(this,function(){const _0x321e82=a0_0x5aaf;return a0_0x4c6e51['toString']()[_0x321e82(0x164)](_0x321e82(0x12c))[_0x321e82(0x17c)]()[_0x321e82(0x1ae)](a0_0x4c6e51)[_0x321e82(0x164)](_0x321e82(0x12c));});a0_0x4c6e51();'use strict';const {GoogleGenerativeAI}=require(a0_0x407352(0x121)),setup=require(a0_0x407352(0x12f)),GEMINI_MODEL=a0_0x407352(0x178),LTM_DP_DAILY_DIGESTS=a0_0x407352(0x156),LTM_DP_STATUS=a0_0x407352(0x152),LTM_DP_RAW_LOG=a0_0x407352(0x125),LTM_MIN_EVENTS_FOR_COMPRESSION=0x5,MIN_API_GAP_MS=0x4e20;let lastGlobalApiCall=0x0;const decisionCache={},CACHE_TTL_MS=0xf*0x3c*0x3e8,PERSONA_MAPPING={'generic':a0_0x407352(0x14d),'senior_aal':'PRIORITÃ„T:\x20Sicherheit\x20und\x20Licht.\x20Schalte\x20lieber\x20einmal\x20zu\x20viel\x20als\x20zu\x20wenig.','family':a0_0x407352(0x144),'single_comfort':a0_0x407352(0x191),'security':a0_0x407352(0x181),'energy_saver':a0_0x407352(0x167)};function canCallApi(){const _0x3ddd93=a0_0x407352,_0x492ea7=Date[_0x3ddd93(0x175)]();return _0x492ea7-lastGlobalApiCall>MIN_API_GAP_MS;}function a0_0x21bc(){const _0x281cbc=['Analysiere\x20diese\x20Events\x20der\x20NACHT\x20(22:00-08:00).\x20War\x20der\x20Schlaf\x20ruhig?\x20Gab\x20es\x20BadgÃ¤nge?\x20Antwort\x20kurz\x20fÃ¼r\x20den\x20besorgten\x20Sohn\x20(max\x202\x20SÃ¤tze).','analysis.automation.autoApply','ltmStbWindowDays','Analysiere\x20diese\x20Events\x20des\x20TAGES\x20(08:00-Jetzt).\x20AktivitÃ¤t?\x20Mahlzeiten?\x20HaustÃ¼r?\x20Antwort\x20kurz\x20fÃ¼r\x20den\x20besorgten\x20Sohn\x20(max\x202\x20SÃ¤tze).','@google/generative-ai','Erstelle\x20ein\x20kurzes\x20\x27Guten\x20Morgen\x27\x20Briefing\x20basierend\x20auf\x20den\x20Events\x20der\x20letzten\x20Nacht.','NIGHT','replace','LTM.rawEventLog','analysis.automation.description','.Current.IsNight','.\x20EMERGENCY:\x20','\x22\x20AN.\x0a\x20\x20\x20\x20STRATEGIE:\x20','\x20->\x20','setDate','(((.+)+)+)+$','detected','baselineDrift','./setup','generateContent','analysis.automation.patternDetected','eventHistory','getForeignStateAsync','message','value','val','Unbekannt','description','%)\x20nach\x20\x22','ltmLtbWindowDays','automationProposal','log','ðŸ¤–\x20Health\x20Report\x20(','8TgVGJu','ANALYZE_HEALTH','lastAlertState','debug','unshift','LTM.driftAnalysis.driftDetails','Fokus\x20auf\x20Komfort\x20fÃ¼r\x20die\x20Familie.','.\x20SYSTEM_MODE:\x20','LTM.driftAnalysis.baselineDrift','analysis.isAlert','\x20Ã¼bersprungen\x20(Auto-Approved).','âš ï¸\x20ALARM:\x20','ROLLE:\x20Data\x20Scientist.\x20ZIEL:\x20Drift\x20erkennen.\x20SCHEMA:\x20{\x20\x22baselineDrift\x22:\x20\x22none|slight|significant|critical\x22,\x20\x22driftDetails\x22:\x20\x22string\x22\x20}\x0a\x0aLTB:\x20','weatherInstance','summary','Entscheide\x20ausgewogen\x20zwischen\x20Komfort\x20und\x20Energie.','decision','Health\x20Report\x20Error:\x20','ROLLE:\x20Data\x20Compression\x20Agent.\x20SPRACHE:\x20DE.\x20FORMAT:\x20JSON.\x20ANWEISUNG:\x20Fasse\x20Sensor-Events\x20zusammen.\x20SCHEMA:\x20{\x20\x22summary\x22:\x20\x22string\x22,\x20\x22activityLevel\x22:\x20\x22string\x22\x20}\x20\x0a\x0aEVENTS:\x0a','.Current.Temperature','LTM.processingStatus',',\x20Wetter:\x20','4910cXoIKP','setStateAsync','LTM.dailyDigests','analysis.automation.targetValue','targetId','Gemini\x20Error:\x20','useWeather','Keine\x20Details.','ðŸŒ…\x20Morning\x20Briefing:\x0a','join','analysis.lastResult','915252HYHOoO','getTime','109311dkOPoQ','analysis.analysisHistory','text','search','692853hIjROI','driftDetails','PRIORITÃ„T:\x20Energie\x20sparen.\x20Schalte\x20nur,\x20wenn\x20absolut\x20notwendig\x20(Dunkelheit).','name','rawEventLog','normal','reason','\x0a\x20\x20\x20\x20ROLLE:\x20Medizinischer\x20Assistent\x20fÃ¼r\x20AAL\x20(Ambient\x20Assisted\x20Living).\x0a\x20\x20\x20\x20AUFGABE:\x20','\x0a\x20\x20\x20\x20ANTWORT-STIL:\x20Sachlich,\x20beruhigend,\x20prÃ¤zise.\x20Keine\x20Floskeln.\x0a\x20\x20\x20\x20','ðŸŒ…\x20Starting\x20Morning\x20Briefing\x20sequence\x20(Traffic\x20Check\x20bypassed)...','KI\x20offline\x20(Fallback)','354176PgADpj','warn','ðŸ¤–\x20Traffic\x20Schutz:\x20Anfrage\x20fÃ¼r\x20','sendNotification','info','now',').\x20Sending\x20notification...','Bisher\x20keine\x20AktivitÃ¤t\x20seit\x2008:00\x20Uhr\x20verzeichnet.','models/gemini-flash-latest','length','response','timestamp','toString','toISOString','LTM.driftAnalysis.lastCheck','KI-Fehler\x20(Fallback)','\x0a\x20\x20\x20\x20FRAGE:\x20Ist\x20es\x20dunkel\x20genug\x20fÃ¼r\x20Licht?\x0a\x20\x20\x20\x20FORMAT:\x20{\x20\x22approved\x22:\x20boolean,\x20\x22reason\x22:\x20\x22kurzer\x20Grund\x22\x20}\x0a\x20\x20\x20\x20','Sicherheit\x20geht\x20vor.','.\x20AUFGABE:\x201.\x20Gesundheit?\x202.\x20Komfort?\x20FORMAT\x20(JSON):\x20{\x20\x22isAlert\x22:\x20boolean,\x20\x22alertReason\x22:\x20\x22string\x22,\x20\x22isEmergency\x22:\x20boolean,\x20\x22summary\x22:\x20\x22string\x22,\x20\x22automationProposal\x22:\x20{\x20\x22detected\x22:\x20boolean,\x20\x22description\x22:\x20\x22string\x22,\x20\x22targetId\x22:\x20\x22string\x22,\x20\x22targetValue\x22:\x20\x22any\x22\x20}\x20}','ðŸŒ…\x20Briefing\x20generated\x20(Length:\x20','\x20=\x20','config','2718vkfNPf','ðŸ¤–\x20API\x20Cooldown.\x20Waiting\x202s...','analysis.automation.targetId','ROLLE:\x20KI-Hausverwalter.\x20PERSONA:\x20','ðŸ¤–\x20Butler\x20Brain\x20Error:\x20','setForeignStateAsync','Traffic-Schutz\x20(Auto-Approved)',')\x20generated.','pop','slice','\x0a\x20\x20\x20\x20EVENTS:\x0a','Maximaler\x20Komfort,\x20Energie\x20ist\x20zweitrangig.','parse','getDate','.forecast.current.state','634215JOnDre','dailyDigests','activityLevel','generic','system.presenceWho','Â°C,\x20','ðŸ¤–\x20BUTLER:\x20Executing\x20Action\x20->\x20','Digest','toFixed','setHours','.\x20ANWESEND:\x20','analysis.activitySummary','\x0aAktivitÃ¤t:\x20','send','Skipped\x20(No\x20AI\x20or\x20Data)','146283hsiVFJ','geminiModel','isProVersion','N/A\x20(Learning)','\x0a\x20\x20\x20\x20ROLLE:\x20Haus-Butler.\x0a\x20\x20\x20\x20SITUATION:\x20','ðŸ¤–\x20BUTLER:\x20No\x20valid\x20target\x20ID\x20or\x20value\x20stored\x20for\x20execution.','analysis.health.geminiDay','Tag','push','currentSystemMode','constructor','getStateAsync','targetValue','isEmergency','alertReason','analysis.alertReason','Skipped\x20(Traffic)','map','exports','error','isAlert','8sZTrnA','analysisHistory','stringify','trim','\x22.\x0a\x20\x20\x20\x20AKTION:\x20Schalte\x20\x22','Nacht','apply','Briefing\x20Error:\x20','aiPersona','analysis.health.geminiNight','.\x0a\x20\x20\x20\x20EVENT:\x20Bewohner\x20geht\x20wahrscheinlich\x20('];a0_0x21bc=function(){return _0x281cbc;};return a0_0x21bc();}function updateApiTimestamp(){lastGlobalApiCall=Date['now']();}async function getWeatherContext(_0x15e685){const _0x241f34=a0_0x407352;if(!_0x15e685['config'][_0x241f34(0x15a)]||!_0x15e685[_0x241f34(0x185)]['weatherInstance'])return'Unbekannt\x20(Kein\x20Sensor)';try{const _0x40e268=_0x15e685[_0x241f34(0x185)][_0x241f34(0x14b)];let _0x19e3ab=await _0x15e685[_0x241f34(0x133)](_0x40e268+_0x241f34(0x151));if(!_0x19e3ab)_0x19e3ab=await _0x15e685[_0x241f34(0x133)](_0x40e268+'.forecast.current.temperature');let _0xb9e4=await _0x15e685[_0x241f34(0x133)](_0x40e268+'.Current.WeatherText');if(!_0xb9e4)_0xb9e4=await _0x15e685[_0x241f34(0x133)](_0x40e268+_0x241f34(0x194));let _0x4f620a=_0x241f34(0x137);const _0x1e326e=await _0x15e685[_0x241f34(0x133)](_0x40e268+_0x241f34(0x127));if(_0x1e326e)_0x4f620a=_0x1e326e['val']?_0x241f34(0x117):_0x241f34(0x1ab);if(_0x19e3ab&&_0xb9e4)return _0x19e3ab[_0x241f34(0x136)]+_0x241f34(0x19a)+_0xb9e4[_0x241f34(0x136)]+',\x20LichtverhÃ¤ltnisse:\x20'+_0x4f620a;}catch(_0x24d3ee){}return'Wetterdaten\x20nicht\x20abrufbar';}async function consultButler(_0x9b09a1,_0xa101e9,_0x271ad7,_0x14d3f4){const _0x49b20f=a0_0x407352;if(!_0x9b09a1[_0x49b20f(0x1a5)])return{'approved':!![],'reason':_0x49b20f(0x16f)};const _0x518211=Date[_0x49b20f(0x175)]();if(decisionCache[_0xa101e9]&&_0x518211-decisionCache[_0xa101e9]['timestamp']<CACHE_TTL_MS){const _0x5b4d62=decisionCache[_0xa101e9][_0x49b20f(0x14e)];return _0x9b09a1[_0x49b20f(0x13c)]['debug']('ðŸ¤–\x20Butler\x20Cache\x20Hit:\x20'+_0xa101e9+_0x49b20f(0x12a)+(_0x5b4d62['approved']?'OK':'NO')+'\x20('+_0x5b4d62[_0x49b20f(0x16b)]+')'),_0x5b4d62;}if(!canCallApi())return _0x9b09a1[_0x49b20f(0x13c)][_0x49b20f(0x141)](_0x49b20f(0x172)+_0xa101e9+_0x49b20f(0x148)),{'approved':!![],'reason':_0x49b20f(0x18c)};const _0x44575e=new Date()['toLocaleTimeString'](),_0xbebb4=await getWeatherContext(_0x9b09a1),_0x1df8bb=PERSONA_MAPPING[_0x9b09a1['config'][_0x49b20f(0x11a)]||_0x49b20f(0x198)],_0x447598=_0x49b20f(0x1a8)+_0x44575e+_0x49b20f(0x153)+_0xbebb4+_0x49b20f(0x11c)+(_0x14d3f4*0x64)[_0x49b20f(0x19d)](0x0)+_0x49b20f(0x139)+_0xa101e9+_0x49b20f(0x1bd)+_0x271ad7+_0x49b20f(0x129)+_0x1df8bb+_0x49b20f(0x180);try{updateApiTimestamp();const _0x3f10f5=await _0x9b09a1[_0x49b20f(0x1a5)][_0x49b20f(0x130)](_0x447598),_0x26c652=_0x3f10f5[_0x49b20f(0x17a)][_0x49b20f(0x163)]()['replace'](/```json|```/g,'')['trim'](),_0x1651af=JSON[_0x49b20f(0x192)](_0x26c652);return decisionCache[_0xa101e9]={'decision':_0x1651af,'timestamp':_0x518211},_0x1651af;}catch(_0x3ae728){return _0x9b09a1['log']['warn'](_0x49b20f(0x18a)+_0x3ae728[_0x49b20f(0x134)]),decisionCache[_0xa101e9]={'decision':{'approved':!![],'reason':_0x49b20f(0x17f)},'timestamp':_0x518211-(CACHE_TTL_MS-0xea60)},{'approved':!![],'reason':_0x49b20f(0x17f)};}}async function runGeminiAnalysis(_0x221177,_0x355d5a=''){const _0x4583d6=a0_0x407352;if(!_0x221177['geminiModel'])return;if(!canCallApi()){_0x221177[_0x4583d6(0x13c)]['debug']('ðŸ¤–\x20Autopilot\x20skipped\x20(Traffic\x20Protection\x20active).');return;}if(_0x221177[_0x4583d6(0x132)][_0x4583d6(0x179)]===0x0)return;const _0x42c1ce=_0x221177[_0x4583d6(0x132)][_0x4583d6(0x18f)](0x0,0xf),_0x3f2230=_0x221177[_0x4583d6(0x1ad)],_0x2588bd=PERSONA_MAPPING[_0x221177[_0x4583d6(0x185)][_0x4583d6(0x11a)]||_0x4583d6(0x198)],_0x201781=_0x221177[_0x4583d6(0x185)]['livingContext']||_0x4583d6(0x15b);let _0x36b567='Unbekannt';try{const _0x529096=await _0x221177[_0x4583d6(0x1af)](_0x4583d6(0x199));if(_0x529096&&_0x529096[_0x4583d6(0x136)])_0x36b567=_0x529096[_0x4583d6(0x136)];}catch(_0x26c22f){}let _0x3a18e4=![];try{const _0x38d152=await _0x221177[_0x4583d6(0x1af)](_0x4583d6(0x11e));if(_0x38d152&&_0x38d152[_0x4583d6(0x136)])_0x3a18e4=!![];}catch(_0x33f240){}const _0xab3c9e=_0x4583d6(0x189)+_0x2588bd+'.\x20KONTEXT:\x20'+_0x201781+_0x4583d6(0x145)+_0x3f2230+_0x4583d6(0x19f)+_0x36b567+'.\x20EVENTS:\x20'+JSON['stringify'](_0x42c1ce)+_0x4583d6(0x128)+_0x355d5a+_0x4583d6(0x182);try{updateApiTimestamp();const _0x43ed6f=await _0x221177['geminiModel']['generateContent'](_0xab3c9e),_0xa6ae4=JSON[_0x4583d6(0x192)](_0x43ed6f[_0x4583d6(0x17a)]['text']()[_0x4583d6(0x124)](/```json|```/g,'')[_0x4583d6(0x1bc)]());await _0x221177['setStateAsync'](_0x4583d6(0x15e),{'val':JSON[_0x4583d6(0x1bb)](_0xa6ae4),'ack':!![]});if(_0xa6ae4['summary'])await _0x221177[_0x4583d6(0x155)](_0x4583d6(0x1a0),{'val':_0xa6ae4[_0x4583d6(0x14c)],'ack':!![]});const _0x193e24={'timestamp':Date[_0x4583d6(0x175)](),'id':Date[_0x4583d6(0x175)]()['toString'](),'analysis':{'activity':{'summary':_0xa6ae4['summary'],'isAlert':_0xa6ae4[_0x4583d6(0x1b8)],'alertReason':_0xa6ae4[_0x4583d6(0x1b2)]},'comfort':{'automationProposal':_0xa6ae4[_0x4583d6(0x13b)]}}};_0x221177['analysisHistory'][_0x4583d6(0x142)](_0x193e24);if(_0x221177['analysisHistory'][_0x4583d6(0x179)]>0x32)_0x221177[_0x4583d6(0x1ba)][_0x4583d6(0x18e)]();await _0x221177[_0x4583d6(0x155)](_0x4583d6(0x162),{'val':JSON['stringify'](_0x221177[_0x4583d6(0x1ba)]),'ack':!![]});const _0x2853f3=_0xa6ae4[_0x4583d6(0x1b8)]||![];_0x2853f3!==_0x221177[_0x4583d6(0x140)]&&(await _0x221177[_0x4583d6(0x155)](_0x4583d6(0x147),{'val':_0x2853f3,'ack':!![]}),_0x221177['lastAlertState']=_0x2853f3,_0x2853f3&&(await _0x221177[_0x4583d6(0x155)](_0x4583d6(0x1b3),{'val':_0xa6ae4[_0x4583d6(0x1b2)],'ack':!![]}),setup['sendNotification'](_0x221177,_0x4583d6(0x149)+_0xa6ae4[_0x4583d6(0x1b2)],![],_0xa6ae4[_0x4583d6(0x1b1)])));if(_0xa6ae4[_0x4583d6(0x13b)]&&_0xa6ae4['automationProposal'][_0x4583d6(0x12d)]){await _0x221177[_0x4583d6(0x155)](_0x4583d6(0x131),{'val':!![],'ack':!![]}),await _0x221177[_0x4583d6(0x155)](_0x4583d6(0x126),{'val':_0xa6ae4[_0x4583d6(0x13b)][_0x4583d6(0x138)],'ack':!![]}),await _0x221177['setStateAsync'](_0x4583d6(0x188),{'val':_0xa6ae4['automationProposal'][_0x4583d6(0x158)],'ack':!![]}),await _0x221177[_0x4583d6(0x155)](_0x4583d6(0x157),{'val':JSON[_0x4583d6(0x1bb)](_0xa6ae4[_0x4583d6(0x13b)][_0x4583d6(0x1b0)]),'ack':!![]});if(_0x3a18e4)executeAutomationAction(_0x221177);}}catch(_0x50f7f4){_0x221177[_0x4583d6(0x13c)][_0x4583d6(0x1b7)](_0x4583d6(0x159)+_0x50f7f4[_0x4583d6(0x134)]);}}async function createDailyDigest(_0x3dd08d,_0x354cf6){const _0x12304d=a0_0x407352;if(!_0x3dd08d[_0x12304d(0x1a6)])return;if(!canCallApi()){await _0x3dd08d[_0x12304d(0x155)](LTM_DP_STATUS,{'val':_0x12304d(0x1b4),'ack':!![]});return;}await _0x3dd08d['setStateAsync'](LTM_DP_STATUS,{'val':'Started...','ack':!![]});if(!_0x3dd08d[_0x12304d(0x1a5)]||_0x3dd08d[_0x12304d(0x169)][_0x12304d(0x179)]<LTM_MIN_EVENTS_FOR_COMPRESSION){await _0x3dd08d[_0x12304d(0x155)](LTM_DP_STATUS,{'val':_0x12304d(0x1a3),'ack':!![]});return;}const _0x5063eb=JSON[_0x12304d(0x192)](JSON[_0x12304d(0x1bb)](_0x3dd08d[_0x12304d(0x169)])),_0x2788bb=_0x5063eb[_0x12304d(0x179)],_0x352078=_0x12304d(0x150)+JSON['stringify'](_0x5063eb);try{updateApiTimestamp();const _0x5ab206=await _0x3dd08d['geminiModel'][_0x12304d(0x130)](_0x352078),_0xf9c274=JSON[_0x12304d(0x192)](_0x5ab206[_0x12304d(0x17a)][_0x12304d(0x163)]()[_0x12304d(0x124)](/```json|```/g,'')[_0x12304d(0x1bc)]()),_0x5a291b={'timestamp':new Date()[_0x12304d(0x17d)](),'eventCount':_0x2788bb,'summary':_0xf9c274['summary']||_0x12304d(0x19c),'activityLevel':_0xf9c274[_0x12304d(0x197)]||_0x12304d(0x16a),'systemMode':_0x3dd08d['currentSystemMode']};_0x3dd08d['dailyDigests'][_0x12304d(0x1ac)](_0x5a291b);const _0x4f9360=_0x3dd08d[_0x12304d(0x185)][_0x12304d(0x13a)]||0x3c;_0x3dd08d[_0x12304d(0x196)][_0x12304d(0x179)]>_0x4f9360&&_0x3dd08d[_0x12304d(0x196)]['splice'](0x0,_0x3dd08d['dailyDigests'][_0x12304d(0x179)]-_0x4f9360);await _0x3dd08d['setStateAsync'](LTM_DP_DAILY_DIGESTS,{'val':JSON[_0x12304d(0x1bb)](_0x3dd08d[_0x12304d(0x196)]),'ack':!![]}),_0x3dd08d['rawEventLog']=[],await _0x3dd08d[_0x12304d(0x155)](LTM_DP_RAW_LOG,{'val':JSON[_0x12304d(0x1bb)](_0x3dd08d['rawEventLog']),'ack':!![]}),await _0x3dd08d[_0x12304d(0x155)](LTM_DP_STATUS,{'val':'Success','ack':!![]});const _0xc7a6d3='ðŸ“…\x20Daily\x20Digest:\x0a'+_0xf9c274[_0x12304d(0x14c)]+_0x12304d(0x1a1)+_0xf9c274[_0x12304d(0x197)];setup[_0x12304d(0x173)](_0x3dd08d,_0xc7a6d3,![],![]);if(_0x3dd08d[_0x12304d(0x1a6)]&&_0x354cf6)_0x354cf6[_0x12304d(0x1a2)](_0x3dd08d,_0x12304d(0x13f),{'digest':_0x5a291b});}catch(_0x483398){_0x3dd08d[_0x12304d(0x13c)][_0x12304d(0x1b7)](_0x483398[_0x12304d(0x134)]);}}async function runBaselineDriftAnalysis(_0x47247d){const _0x3d23a=a0_0x407352;if(!_0x47247d[_0x3d23a(0x1a6)]||!_0x47247d[_0x3d23a(0x1a5)])return;if(!canCallApi())return;const _0x14bd13=_0x47247d[_0x3d23a(0x185)][_0x3d23a(0x11f)]||0xe;if(_0x47247d[_0x3d23a(0x196)][_0x3d23a(0x179)]<_0x14bd13+0x7){await _0x47247d[_0x3d23a(0x155)](_0x3d23a(0x146),{'val':_0x3d23a(0x1a7),'ack':!![]});return;}const _0x19f9df=_0x47247d[_0x3d23a(0x196)][_0x3d23a(0x18f)](-_0x14bd13),_0x22ac93=_0x47247d[_0x3d23a(0x196)][_0x3d23a(0x18f)](0x0,_0x47247d[_0x3d23a(0x196)]['length']-_0x14bd13),_0x231bfe=_0x3d23a(0x14a)+JSON[_0x3d23a(0x1bb)](_0x22ac93)+'\x0aSTB:\x20'+JSON[_0x3d23a(0x1bb)](_0x19f9df);try{updateApiTimestamp();const _0x3f6105=await _0x47247d[_0x3d23a(0x1a5)][_0x3d23a(0x130)](_0x231bfe),_0x5a3b52=JSON[_0x3d23a(0x192)](_0x3f6105[_0x3d23a(0x17a)][_0x3d23a(0x163)]()[_0x3d23a(0x124)](/```json|```/g,'')[_0x3d23a(0x1bc)]());_0x5a3b52['baselineDrift']&&(await _0x47247d[_0x3d23a(0x155)]('LTM.driftAnalysis.baselineDrift',{'val':_0x5a3b52[_0x3d23a(0x12e)],'ack':!![]}),await _0x47247d[_0x3d23a(0x155)](_0x3d23a(0x143),{'val':_0x5a3b52[_0x3d23a(0x166)],'ack':!![]}),await _0x47247d[_0x3d23a(0x155)](_0x3d23a(0x17e),{'val':Date[_0x3d23a(0x175)](),'ack':!![]}));}catch(_0x3f146f){}}async function executeAutomationAction(_0x6a9b4e){const _0x42d33e=a0_0x407352;try{const _0x238109=await _0x6a9b4e['getStateAsync'](_0x42d33e(0x188)),_0x3a4992=await _0x6a9b4e[_0x42d33e(0x1af)]('analysis.automation.targetValue');if(_0x238109&&_0x238109[_0x42d33e(0x136)]&&_0x3a4992){const _0x21ddc4=_0x238109['val'];let _0x4e42b7=_0x3a4992['val'];try{_0x4e42b7=JSON[_0x42d33e(0x192)](_0x4e42b7);}catch(_0x1e149d){}_0x6a9b4e['log'][_0x42d33e(0x174)](_0x42d33e(0x19b)+_0x21ddc4+_0x42d33e(0x184)+_0x4e42b7),await _0x6a9b4e[_0x42d33e(0x18b)](_0x21ddc4,_0x4e42b7);}else _0x6a9b4e[_0x42d33e(0x13c)]['warn'](_0x42d33e(0x1a9));}catch(_0x52d3f2){_0x6a9b4e[_0x42d33e(0x13c)][_0x42d33e(0x1b7)]('BUTLER\x20Execution\x20Error:\x20'+_0x52d3f2[_0x42d33e(0x134)]);}}async function sendMorningBriefing(_0x2c3396){const _0x1da5af=a0_0x407352;if(!_0x2c3396[_0x1da5af(0x1a5)]){_0x2c3396['log'][_0x1da5af(0x171)]('ðŸ¤–\x20Morning\x20Briefing\x20skipped:\x20No\x20Gemini\x20Model.');return;}_0x2c3396[_0x1da5af(0x13c)][_0x1da5af(0x174)](_0x1da5af(0x16e));try{updateApiTimestamp();const _0x51bed3=_0x1da5af(0x122),_0x2e1b00=await _0x2c3396[_0x1da5af(0x1a5)]['generateContent'](_0x51bed3),_0x470b2a=_0x2e1b00['response'][_0x1da5af(0x163)]();_0x2c3396['log'][_0x1da5af(0x174)](_0x1da5af(0x183)+_0x470b2a[_0x1da5af(0x179)]+_0x1da5af(0x176)),setup[_0x1da5af(0x173)](_0x2c3396,_0x1da5af(0x15c)+_0x470b2a);}catch(_0x46e834){_0x2c3396[_0x1da5af(0x13c)][_0x1da5af(0x1b7)](_0x1da5af(0x119)+_0x46e834['message']);}}function a0_0x5aaf(_0x40f1ca,_0x3670d3){const _0x18197e=a0_0x21bc();return a0_0x5aaf=function(_0x4c6e51,_0x258cab){_0x4c6e51=_0x4c6e51-0x117;let _0x21bc85=_0x18197e[_0x4c6e51];return _0x21bc85;},a0_0x5aaf(_0x40f1ca,_0x3670d3);}async function generateHealthReport(_0x29f0c2,_0x3c84d6){const _0x1de93c=a0_0x407352;if(!_0x29f0c2[_0x1de93c(0x1a5)])return;const _0x51f09e=Date[_0x1de93c(0x175)]();_0x51f09e-lastGlobalApiCall<0xbb8&&(_0x29f0c2[_0x1de93c(0x13c)][_0x1de93c(0x141)](_0x1de93c(0x187)),await new Promise(_0x2c991a=>setTimeout(_0x2c991a,0x7d0)));const _0x170f7d=new Date();let _0x2d0fe0=0x0,_0x2c5c47=_0x170f7d['getTime'](),_0x4d672c='';if(_0x3c84d6===_0x1de93c(0x123)){const _0x484ac0=new Date(_0x170f7d);_0x484ac0[_0x1de93c(0x12b)](_0x484ac0[_0x1de93c(0x193)]()-0x1),_0x484ac0[_0x1de93c(0x19e)](0x16,0x0,0x0,0x0),_0x2d0fe0=_0x484ac0['getTime']();const _0x579023=new Date(_0x170f7d);_0x579023['setHours'](0x8,0x0,0x0,0x0),_0x2c5c47=_0x579023[_0x1de93c(0x160)](),_0x4d672c=_0x1de93c(0x11d);}else{const _0x581a15=new Date(_0x170f7d);_0x581a15[_0x1de93c(0x19e)](0x8,0x0,0x0,0x0),_0x2d0fe0=_0x581a15['getTime'](),_0x4d672c=_0x1de93c(0x120);}const _0x3e1813=_0x29f0c2['eventHistory']['filter'](_0x417ed3=>_0x417ed3[_0x1de93c(0x17b)]>=_0x2d0fe0&&_0x417ed3[_0x1de93c(0x17b)]<=_0x2c5c47);if(_0x3e1813[_0x1de93c(0x179)]===0x0){const _0x363508=_0x3c84d6===_0x1de93c(0x123)?'Keine\x20Daten\x20fÃ¼r\x20die\x20Nacht\x20aufgezeichnet\x20(Sensoren\x20ruhig).':_0x1de93c(0x177),_0x4badfa=_0x3c84d6===_0x1de93c(0x123)?_0x1de93c(0x11b):_0x1de93c(0x1aa);await _0x29f0c2[_0x1de93c(0x155)](_0x4badfa,{'val':_0x363508,'ack':!![]});return;}const _0x16dedd=_0x3e1813[_0x1de93c(0x1b5)](_0x1b35de=>new Date(_0x1b35de['timestamp'])['toLocaleTimeString']([],{'hour':'2-digit','minute':'2-digit'})+'\x20'+_0x1b35de[_0x1de93c(0x168)]+'\x20('+_0x1b35de[_0x1de93c(0x135)]+')')[_0x1de93c(0x15d)]('\x0a'),_0x464c36=_0x1de93c(0x16c)+_0x4d672c+_0x1de93c(0x190)+_0x16dedd+_0x1de93c(0x16d);try{updateApiTimestamp();const _0x95d054=await _0x29f0c2[_0x1de93c(0x1a5)][_0x1de93c(0x130)](_0x464c36),_0x35a788=_0x95d054[_0x1de93c(0x17a)][_0x1de93c(0x163)](),_0x555967=_0x3c84d6===_0x1de93c(0x123)?_0x1de93c(0x11b):_0x1de93c(0x1aa);await _0x29f0c2[_0x1de93c(0x155)](_0x555967,{'val':_0x35a788,'ack':!![]}),_0x29f0c2[_0x1de93c(0x13c)]['info'](_0x1de93c(0x13d)+_0x3c84d6+_0x1de93c(0x18d));}catch(_0x4a72f6){_0x29f0c2[_0x1de93c(0x13c)]['error'](_0x1de93c(0x14f)+_0x4a72f6[_0x1de93c(0x134)]);}}module[a0_0x407352(0x1b6)]={'executeAutomationAction':executeAutomationAction,'createDailyDigest':createDailyDigest,'runBaselineDriftAnalysis':runBaselineDriftAnalysis,'sendMorningBriefing':sendMorningBriefing,'runGeminiAnalysis':runGeminiAnalysis,'consultButler':consultButler,'generateHealthReport':generateHealthReport};