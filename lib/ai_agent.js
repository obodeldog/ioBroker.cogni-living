const a0_0x2abb1b=a0_0x1b28;(function(_0x5c599b,_0x54c850){const _0x38190a=a0_0x1b28,_0xa0de9e=_0x5c599b();while(!![]){try{const _0x5e5aa0=-parseInt(_0x38190a(0x109))/0x1+-parseInt(_0x38190a(0xf2))/0x2+-parseInt(_0x38190a(0x142))/0x3*(-parseInt(_0x38190a(0x12f))/0x4)+-parseInt(_0x38190a(0x138))/0x5*(-parseInt(_0x38190a(0x163))/0x6)+-parseInt(_0x38190a(0x16f))/0x7+-parseInt(_0x38190a(0x14a))/0x8*(-parseInt(_0x38190a(0x153))/0x9)+parseInt(_0x38190a(0x175))/0xa;if(_0x5e5aa0===_0x54c850)break;else _0xa0de9e['push'](_0xa0de9e['shift']());}catch(_0x3e7d41){_0xa0de9e['push'](_0xa0de9e['shift']());}}}(a0_0x401b,0xd6c30));const a0_0x2fc195=(function(){let _0x1027b9=!![];return function(_0x201e40,_0x4bc8b3){const _0x2332aa=_0x1027b9?function(){const _0x49686f=a0_0x1b28;if(_0x4bc8b3){const _0x4387b=_0x4bc8b3[_0x49686f(0x170)](_0x201e40,arguments);return _0x4bc8b3=null,_0x4387b;}}:function(){};return _0x1027b9=![],_0x2332aa;};}()),a0_0x20eda3=a0_0x2fc195(this,function(){const _0x24f6fd=a0_0x1b28;return a0_0x20eda3[_0x24f6fd(0x11e)]()[_0x24f6fd(0x114)]('(((.+)+)+)+$')[_0x24f6fd(0x11e)]()[_0x24f6fd(0x15b)](a0_0x20eda3)['search'](_0x24f6fd(0x160));});a0_0x20eda3();function a0_0x1b28(_0x3e45b2,_0x3b8e54){const _0xf8a3aa=a0_0x401b();return a0_0x1b28=function(_0x20eda3,_0x2fc195){_0x20eda3=_0x20eda3-0xeb;let _0x401b49=_0xf8a3aa[_0x20eda3];return _0x401b49;},a0_0x1b28(_0x3e45b2,_0x3b8e54);}'use strict';const {GoogleGenerativeAI}=require('@google/generative-ai'),setup=require(a0_0x2abb1b(0x178)),GEMINI_MODEL=a0_0x2abb1b(0x17e),LTM_DP_DAILY_DIGESTS=a0_0x2abb1b(0x125),LTM_DP_STATUS='LTM.processingStatus',LTM_DP_RAW_LOG='LTM.rawEventLog',LTM_MIN_EVENTS_FOR_COMPRESSION=0x5,MIN_API_GAP_MS=0x4e20;function a0_0x401b(){const _0x17ad94=['sendNotification','\x20Ã¼bersprungen\x20(Auto-Approved).','map','filter','isProVersion','ðŸ¤–\x20BUTLER:\x20No\x20valid\x20target\x20ID\x20or\x20value\x20stored\x20for\x20execution.','Tag','analysis.health.geminiNight','7714015KaHsHI','Started...','Digest','toFixed','analysis.automation.autoApply','Health\x20Report\x20Error:\x20','message','analysis.health.geminiDay','%)\x20nach\x20\x22','generic','175983ZHshFn','toISOString','analysis.analysisHistory','length','.\x20ANWESEND:\x20','system.presenceWho','Skipped\x20(Traffic)','aiPersona','3644912rHlyfe','approved','config','\x0aAktivitÃ¤t:\x20','geminiModel','setForeignStateAsync','Gemini\x20Error:\x20','.\x0a\x20\x20\x20\x20EVENT:\x20Bewohner\x20geht\x20wahrscheinlich\x20(','info','9QVLyHQ','LTM.driftAnalysis.driftDetails','response','ðŸ¤–\x20BUTLER:\x20Executing\x20Action\x20->\x20','analysis.automation.description','Fokus\x20auf\x20Komfort\x20fÃ¼r\x20die\x20Familie.','weatherInstance','Keine\x20Details.','constructor','analysisHistory','pop','setStateAsync','PRIORITÃ„T:\x20Sicherheit\x20und\x20Licht.\x20Schalte\x20lieber\x20einmal\x20zu\x20viel\x20als\x20zu\x20wenig.','(((.+)+)+)+$','setDate','analysis.automation.targetValue','6rbXtkM','log','error','text','NIGHT','val','Nacht','timestamp','dailyDigests','automationProposal','ðŸ¤–\x20API\x20Cooldown.\x20Waiting\x202s...','.\x20AUFGABE:\x201.\x20Gesundheit?\x202.\x20Komfort?\x20FORMAT\x20(JSON):\x20{\x20\x22isAlert\x22:\x20boolean,\x20\x22alertReason\x22:\x20\x22string\x22,\x20\x22isEmergency\x22:\x20boolean,\x20\x22summary\x22:\x20\x22string\x22,\x20\x22automationProposal\x22:\x20{\x20\x22detected\x22:\x20boolean,\x20\x22description\x22:\x20\x22string\x22,\x20\x22targetId\x22:\x20\x22string\x22,\x20\x22targetValue\x22:\x20\x22any\x22\x20}\x20}','2240441sHTipD','apply','Â°C,\x20','summary','analysis.automation.patternDetected','slice','22205100hrmyEf','ðŸ¤–\x20Health\x20Report\x20(','.Current.WeatherText','./setup','warn','Briefing\x20Error:\x20','ROLLE:\x20Data\x20Compression\x20Agent.\x20SPRACHE:\x20DE.\x20FORMAT:\x20JSON.\x20ANWEISUNG:\x20Fasse\x20Sensor-Events\x20zusammen.\x20SCHEMA:\x20{\x20\x22summary\x22:\x20\x22string\x22,\x20\x22activityLevel\x22:\x20\x22string\x22\x20}\x20\x0a\x0aEVENTS:\x0a','splice','getStateAsync','models/gemini-flash-latest','ðŸ“…\x20Daily\x20Digest:\x0a','ROLLE:\x20Data\x20Scientist.\x20ZIEL:\x20Drift\x20erkennen.\x20SCHEMA:\x20{\x20\x22baselineDrift\x22:\x20\x22none|slight|significant|critical\x22,\x20\x22driftDetails\x22:\x20\x22string\x22\x20}\x0a\x0aLTB:\x20','ðŸ¤–\x20Butler\x20Brain\x20Error:\x20','LTM.driftAnalysis.baselineDrift','.\x20KONTEXT:\x20','trim','setHours','Maximaler\x20Komfort,\x20Energie\x20ist\x20zweitrangig.','livingContext','.\x20EVENTS:\x20','Keine\x20Daten\x20fÃ¼r\x20die\x20Nacht\x20aufgezeichnet\x20(Sensoren\x20ruhig).','N/A\x20(Learning)','âš ï¸\x20ALARM:\x20','normal','description','ðŸ¤–\x20Traffic\x20Schutz:\x20Anfrage\x20fÃ¼r\x20','\x22.\x0a\x20\x20\x20\x20AKTION:\x20Schalte\x20\x22','isEmergency','alertReason','ðŸŒ…\x20Starting\x20Morning\x20Briefing\x20sequence\x20(Traffic\x20Check\x20bypassed)...','analysis.lastResult','targetId','2955176flKofJ','Erstelle\x20ein\x20kurzes\x20\x27Guten\x20Morgen\x27\x20Briefing\x20basierend\x20auf\x20den\x20Events\x20der\x20letzten\x20Nacht.','\x20->\x20','now','PRIORITÃ„T:\x20Energie\x20sparen.\x20Schalte\x20nur,\x20wenn\x20absolut\x20notwendig\x20(Dunkelheit).','LTM.driftAnalysis.lastCheck',').\x20Sending\x20notification...','KI-Fehler\x20(Fallback)','ðŸ¤–\x20Morning\x20Briefing\x20skipped:\x20No\x20Gemini\x20Model.','getForeignStateAsync','KI\x20offline\x20(Fallback)','ltmLtbWindowDays','value',',\x20Wetter:\x20','\x22\x20AN.\x0a\x20\x20\x20\x20STRATEGIE:\x20','analysis.isAlert','activityLevel','Wetterdaten\x20nicht\x20abrufbar','isAlert','send','eventHistory','parse','Analysiere\x20diese\x20Events\x20des\x20TAGES\x20(08:00-Jetzt).\x20AktivitÃ¤t?\x20Mahlzeiten?\x20HaustÃ¼r?\x20Antwort\x20kurz\x20fÃ¼r\x20den\x20besorgten\x20Sohn\x20(max\x202\x20SÃ¤tze).','1600273dLtWkS','decision','Unbekannt\x20(Kein\x20Sensor)','ANALYZE_HEALTH','targetValue','\x0a\x20\x20\x20\x20ROLLE:\x20Haus-Butler.\x0a\x20\x20\x20\x20SITUATION:\x20','Success','\x20=\x20','debug',',\x20LichtverhÃ¤ltnisse:\x20','analysis.automation.targetId','search','reason','getTime','2-digit','Unbekannt','\x0a\x20\x20\x20\x20ANTWORT-STIL:\x20Sachlich,\x20beruhigend,\x20prÃ¤zise.\x20Keine\x20Floskeln.\x0a\x20\x20\x20\x20','\x0a\x20\x20\x20\x20ROLLE:\x20Medizinischer\x20Assistent\x20fÃ¼r\x20AAL\x20(Ambient\x20Assisted\x20Living).\x0a\x20\x20\x20\x20AUFGABE:\x20','lastAlertState','analysis.alertReason','.forecast.current.temperature','toString','rawEventLog','Sicherheit\x20geht\x20vor.','replace','generateContent','.Current.Temperature','stringify','LTM.dailyDigests','useWeather','.forecast.current.state','ROLLE:\x20KI-Hausverwalter.\x20PERSONA:\x20','getDate','exports','analysis.activitySummary','Skipped\x20(No\x20AI\x20or\x20Data)','unshift','toLocaleTimeString','4XQnDUw'];a0_0x401b=function(){return _0x17ad94;};return a0_0x401b();}let lastGlobalApiCall=0x0;const decisionCache={},CACHE_TTL_MS=0xf*0x3c*0x3e8,PERSONA_MAPPING={'generic':'Entscheide\x20ausgewogen\x20zwischen\x20Komfort\x20und\x20Energie.','senior_aal':a0_0x2abb1b(0x15f),'family':a0_0x2abb1b(0x158),'single_comfort':a0_0x2abb1b(0x186),'security':a0_0x2abb1b(0x120),'energy_saver':a0_0x2abb1b(0xf6)};function canCallApi(){const _0x1dd90e=a0_0x2abb1b,_0x2a8e0e=Date[_0x1dd90e(0xf5)]();return _0x2a8e0e-lastGlobalApiCall>MIN_API_GAP_MS;}function updateApiTimestamp(){const _0x1c7337=a0_0x2abb1b;lastGlobalApiCall=Date[_0x1c7337(0xf5)]();}async function getWeatherContext(_0x50e67b){const _0x28c7ac=a0_0x2abb1b;if(!_0x50e67b[_0x28c7ac(0x14c)][_0x28c7ac(0x126)]||!_0x50e67b[_0x28c7ac(0x14c)][_0x28c7ac(0x159)])return _0x28c7ac(0x10b);try{const _0x31e064=_0x50e67b[_0x28c7ac(0x14c)][_0x28c7ac(0x159)];let _0x4e6b67=await _0x50e67b['getForeignStateAsync'](_0x31e064+_0x28c7ac(0x123));if(!_0x4e6b67)_0x4e6b67=await _0x50e67b[_0x28c7ac(0xfb)](_0x31e064+_0x28c7ac(0x11d));let _0x17a169=await _0x50e67b[_0x28c7ac(0xfb)](_0x31e064+_0x28c7ac(0x177));if(!_0x17a169)_0x17a169=await _0x50e67b[_0x28c7ac(0xfb)](_0x31e064+_0x28c7ac(0x127));let _0x222046=_0x28c7ac(0x118);const _0x48b3a0=await _0x50e67b[_0x28c7ac(0xfb)](_0x31e064+'.Current.IsNight');if(_0x48b3a0)_0x222046=_0x48b3a0[_0x28c7ac(0x168)]?_0x28c7ac(0x169):_0x28c7ac(0x136);if(_0x4e6b67&&_0x17a169)return _0x4e6b67[_0x28c7ac(0x168)]+_0x28c7ac(0x171)+_0x17a169['val']+_0x28c7ac(0x112)+_0x222046;}catch(_0x20f328){}return _0x28c7ac(0x103);}async function consultButler(_0x20c096,_0x55d39,_0x1dc869,_0xba95c5){const _0x554feb=a0_0x2abb1b;if(!_0x20c096['geminiModel'])return{'approved':!![],'reason':_0x554feb(0xfc)};const _0x563919=Date[_0x554feb(0xf5)]();if(decisionCache[_0x55d39]&&_0x563919-decisionCache[_0x55d39][_0x554feb(0x16a)]<CACHE_TTL_MS){const _0x14dcff=decisionCache[_0x55d39][_0x554feb(0x10a)];return _0x20c096['log'][_0x554feb(0x111)]('ðŸ¤–\x20Butler\x20Cache\x20Hit:\x20'+_0x55d39+_0x554feb(0xf4)+(_0x14dcff[_0x554feb(0x14b)]?'OK':'NO')+'\x20('+_0x14dcff[_0x554feb(0x115)]+')'),_0x14dcff;}if(!canCallApi())return _0x20c096[_0x554feb(0x164)][_0x554feb(0x111)](_0x554feb(0xeb)+_0x55d39+_0x554feb(0x131)),{'approved':!![],'reason':'Traffic-Schutz\x20(Auto-Approved)'};const _0xdcd0f0=new Date()[_0x554feb(0x12e)](),_0x4e2aa9=await getWeatherContext(_0x20c096),_0x4b1c32=PERSONA_MAPPING[_0x20c096[_0x554feb(0x14c)][_0x554feb(0x149)]||'generic'],_0x18b8f8=_0x554feb(0x10e)+_0xdcd0f0+_0x554feb(0xff)+_0x4e2aa9+_0x554feb(0x151)+(_0xba95c5*0x64)[_0x554feb(0x13b)](0x0)+_0x554feb(0x140)+_0x55d39+_0x554feb(0xec)+_0x1dc869+_0x554feb(0x100)+_0x4b1c32+'\x0a\x20\x20\x20\x20FRAGE:\x20Ist\x20es\x20dunkel\x20genug\x20fÃ¼r\x20Licht?\x0a\x20\x20\x20\x20FORMAT:\x20{\x20\x22approved\x22:\x20boolean,\x20\x22reason\x22:\x20\x22kurzer\x20Grund\x22\x20}\x0a\x20\x20\x20\x20';try{updateApiTimestamp();const _0x14513e=await _0x20c096['geminiModel'][_0x554feb(0x122)](_0x18b8f8),_0x2a0899=_0x14513e[_0x554feb(0x155)][_0x554feb(0x166)]()[_0x554feb(0x121)](/```json|```/g,'')[_0x554feb(0x184)](),_0x2ed449=JSON['parse'](_0x2a0899);return decisionCache[_0x55d39]={'decision':_0x2ed449,'timestamp':_0x563919},_0x2ed449;}catch(_0x2f2c18){return _0x20c096[_0x554feb(0x164)]['warn'](_0x554feb(0x181)+_0x2f2c18[_0x554feb(0x13e)]),decisionCache[_0x55d39]={'decision':{'approved':!![],'reason':_0x554feb(0xf9)},'timestamp':_0x563919-(CACHE_TTL_MS-0xea60)},{'approved':!![],'reason':_0x554feb(0xf9)};}}async function runGeminiAnalysis(_0x1f1686,_0x2616ee=''){const _0x475ea6=a0_0x2abb1b;if(!_0x1f1686[_0x475ea6(0x14e)])return;if(!canCallApi()){_0x1f1686[_0x475ea6(0x164)][_0x475ea6(0x111)]('ðŸ¤–\x20Autopilot\x20skipped\x20(Traffic\x20Protection\x20active).');return;}if(_0x1f1686[_0x475ea6(0x106)][_0x475ea6(0x145)]===0x0)return;const _0x11c73e=_0x1f1686[_0x475ea6(0x106)][_0x475ea6(0x174)](0x0,0xf),_0x55fc7b=_0x1f1686['currentSystemMode'],_0x3e7637=PERSONA_MAPPING[_0x1f1686[_0x475ea6(0x14c)]['aiPersona']||_0x475ea6(0x141)],_0x267a58=_0x1f1686[_0x475ea6(0x14c)][_0x475ea6(0x187)]||_0x475ea6(0x15a);let _0x3ec0ca=_0x475ea6(0x118);try{const _0x362df0=await _0x1f1686[_0x475ea6(0x17d)](_0x475ea6(0x147));if(_0x362df0&&_0x362df0['val'])_0x3ec0ca=_0x362df0[_0x475ea6(0x168)];}catch(_0x1b7704){}let _0x56f860=![];try{const _0x1ffc78=await _0x1f1686[_0x475ea6(0x17d)](_0x475ea6(0x13c));if(_0x1ffc78&&_0x1ffc78[_0x475ea6(0x168)])_0x56f860=!![];}catch(_0x478c49){}const _0x55463f=_0x475ea6(0x128)+_0x3e7637+_0x475ea6(0x183)+_0x267a58+'.\x20SYSTEM_MODE:\x20'+_0x55fc7b+_0x475ea6(0x146)+_0x3ec0ca+_0x475ea6(0x188)+JSON['stringify'](_0x11c73e)+'.\x20EMERGENCY:\x20'+_0x2616ee+_0x475ea6(0x16e);try{updateApiTimestamp();const _0x2d18e2=await _0x1f1686[_0x475ea6(0x14e)][_0x475ea6(0x122)](_0x55463f),_0x28501e=JSON['parse'](_0x2d18e2['response'][_0x475ea6(0x166)]()[_0x475ea6(0x121)](/```json|```/g,'')[_0x475ea6(0x184)]());await _0x1f1686[_0x475ea6(0x15e)](_0x475ea6(0xf0),{'val':JSON['stringify'](_0x28501e),'ack':!![]});if(_0x28501e[_0x475ea6(0x172)])await _0x1f1686['setStateAsync'](_0x475ea6(0x12b),{'val':_0x28501e[_0x475ea6(0x172)],'ack':!![]});const _0x9a220b={'timestamp':Date[_0x475ea6(0xf5)](),'id':Date[_0x475ea6(0xf5)]()['toString'](),'analysis':{'activity':{'summary':_0x28501e[_0x475ea6(0x172)],'isAlert':_0x28501e[_0x475ea6(0x104)],'alertReason':_0x28501e[_0x475ea6(0xee)]},'comfort':{'automationProposal':_0x28501e[_0x475ea6(0x16c)]}}};_0x1f1686[_0x475ea6(0x15c)][_0x475ea6(0x12d)](_0x9a220b);if(_0x1f1686[_0x475ea6(0x15c)]['length']>0x32)_0x1f1686[_0x475ea6(0x15c)][_0x475ea6(0x15d)]();await _0x1f1686[_0x475ea6(0x15e)](_0x475ea6(0x144),{'val':JSON[_0x475ea6(0x124)](_0x1f1686[_0x475ea6(0x15c)]),'ack':!![]});const _0x249376=_0x28501e[_0x475ea6(0x104)]||![];_0x249376!==_0x1f1686['lastAlertState']&&(await _0x1f1686[_0x475ea6(0x15e)](_0x475ea6(0x101),{'val':_0x249376,'ack':!![]}),_0x1f1686[_0x475ea6(0x11b)]=_0x249376,_0x249376&&(await _0x1f1686[_0x475ea6(0x15e)](_0x475ea6(0x11c),{'val':_0x28501e[_0x475ea6(0xee)],'ack':!![]}),setup[_0x475ea6(0x130)](_0x1f1686,_0x475ea6(0x18b)+_0x28501e[_0x475ea6(0xee)],![],_0x28501e[_0x475ea6(0xed)])));if(_0x28501e[_0x475ea6(0x16c)]&&_0x28501e[_0x475ea6(0x16c)]['detected']){await _0x1f1686[_0x475ea6(0x15e)](_0x475ea6(0x173),{'val':!![],'ack':!![]}),await _0x1f1686[_0x475ea6(0x15e)](_0x475ea6(0x157),{'val':_0x28501e['automationProposal'][_0x475ea6(0x18d)],'ack':!![]}),await _0x1f1686[_0x475ea6(0x15e)](_0x475ea6(0x113),{'val':_0x28501e[_0x475ea6(0x16c)][_0x475ea6(0xf1)],'ack':!![]}),await _0x1f1686[_0x475ea6(0x15e)]('analysis.automation.targetValue',{'val':JSON['stringify'](_0x28501e[_0x475ea6(0x16c)][_0x475ea6(0x10d)]),'ack':!![]});if(_0x56f860)executeAutomationAction(_0x1f1686);}}catch(_0x370c96){_0x1f1686['log'][_0x475ea6(0x165)](_0x475ea6(0x150)+_0x370c96[_0x475ea6(0x13e)]);}}async function createDailyDigest(_0x168027,_0x59c1cf){const _0x7ab939=a0_0x2abb1b;if(!_0x168027[_0x7ab939(0x134)])return;if(!canCallApi()){await _0x168027[_0x7ab939(0x15e)](LTM_DP_STATUS,{'val':_0x7ab939(0x148),'ack':!![]});return;}await _0x168027[_0x7ab939(0x15e)](LTM_DP_STATUS,{'val':_0x7ab939(0x139),'ack':!![]});if(!_0x168027[_0x7ab939(0x14e)]||_0x168027[_0x7ab939(0x11f)][_0x7ab939(0x145)]<LTM_MIN_EVENTS_FOR_COMPRESSION){await _0x168027[_0x7ab939(0x15e)](LTM_DP_STATUS,{'val':_0x7ab939(0x12c),'ack':!![]});return;}const _0x2f6f35=JSON[_0x7ab939(0x107)](JSON[_0x7ab939(0x124)](_0x168027[_0x7ab939(0x11f)])),_0x2cd119=_0x2f6f35[_0x7ab939(0x145)],_0x22f3b8=_0x7ab939(0x17b)+JSON[_0x7ab939(0x124)](_0x2f6f35);try{updateApiTimestamp();const _0x4ad0d8=await _0x168027[_0x7ab939(0x14e)][_0x7ab939(0x122)](_0x22f3b8),_0x19dcc5=JSON[_0x7ab939(0x107)](_0x4ad0d8[_0x7ab939(0x155)][_0x7ab939(0x166)]()[_0x7ab939(0x121)](/```json|```/g,'')['trim']()),_0x314024={'timestamp':new Date()[_0x7ab939(0x143)](),'eventCount':_0x2cd119,'summary':_0x19dcc5[_0x7ab939(0x172)]||_0x7ab939(0x13a),'activityLevel':_0x19dcc5['activityLevel']||_0x7ab939(0x18c),'systemMode':_0x168027['currentSystemMode']};_0x168027[_0x7ab939(0x16b)]['push'](_0x314024);const _0xb26968=_0x168027[_0x7ab939(0x14c)][_0x7ab939(0xfd)]||0x3c;_0x168027[_0x7ab939(0x16b)][_0x7ab939(0x145)]>_0xb26968&&_0x168027['dailyDigests'][_0x7ab939(0x17c)](0x0,_0x168027[_0x7ab939(0x16b)][_0x7ab939(0x145)]-_0xb26968);await _0x168027['setStateAsync'](LTM_DP_DAILY_DIGESTS,{'val':JSON[_0x7ab939(0x124)](_0x168027[_0x7ab939(0x16b)]),'ack':!![]}),_0x168027[_0x7ab939(0x11f)]=[],await _0x168027[_0x7ab939(0x15e)](LTM_DP_RAW_LOG,{'val':JSON[_0x7ab939(0x124)](_0x168027[_0x7ab939(0x11f)]),'ack':!![]}),await _0x168027[_0x7ab939(0x15e)](LTM_DP_STATUS,{'val':_0x7ab939(0x10f),'ack':!![]});const _0x8696bd=_0x7ab939(0x17f)+_0x19dcc5[_0x7ab939(0x172)]+_0x7ab939(0x14d)+_0x19dcc5[_0x7ab939(0x102)];setup['sendNotification'](_0x168027,_0x8696bd,![],![]);if(_0x168027[_0x7ab939(0x134)]&&_0x59c1cf)_0x59c1cf[_0x7ab939(0x105)](_0x168027,_0x7ab939(0x10c),{'digest':_0x314024});}catch(_0xb9b44b){_0x168027[_0x7ab939(0x164)]['error'](_0xb9b44b[_0x7ab939(0x13e)]);}}async function runBaselineDriftAnalysis(_0x2ffe5b){const _0x145f0c=a0_0x2abb1b;if(!_0x2ffe5b[_0x145f0c(0x134)]||!_0x2ffe5b['geminiModel'])return;if(!canCallApi())return;const _0x4b09b4=_0x2ffe5b[_0x145f0c(0x14c)]['ltmStbWindowDays']||0xe;if(_0x2ffe5b[_0x145f0c(0x16b)][_0x145f0c(0x145)]<_0x4b09b4+0x7){await _0x2ffe5b[_0x145f0c(0x15e)](_0x145f0c(0x182),{'val':_0x145f0c(0x18a),'ack':!![]});return;}const _0x571155=_0x2ffe5b[_0x145f0c(0x16b)][_0x145f0c(0x174)](-_0x4b09b4),_0x152517=_0x2ffe5b['dailyDigests'][_0x145f0c(0x174)](0x0,_0x2ffe5b[_0x145f0c(0x16b)]['length']-_0x4b09b4),_0x62f69=_0x145f0c(0x180)+JSON[_0x145f0c(0x124)](_0x152517)+'\x0aSTB:\x20'+JSON[_0x145f0c(0x124)](_0x571155);try{updateApiTimestamp();const _0x3b9b8a=await _0x2ffe5b['geminiModel']['generateContent'](_0x62f69),_0x5ba998=JSON['parse'](_0x3b9b8a[_0x145f0c(0x155)][_0x145f0c(0x166)]()[_0x145f0c(0x121)](/```json|```/g,'')[_0x145f0c(0x184)]());_0x5ba998['baselineDrift']&&(await _0x2ffe5b[_0x145f0c(0x15e)](_0x145f0c(0x182),{'val':_0x5ba998['baselineDrift'],'ack':!![]}),await _0x2ffe5b['setStateAsync'](_0x145f0c(0x154),{'val':_0x5ba998['driftDetails'],'ack':!![]}),await _0x2ffe5b[_0x145f0c(0x15e)](_0x145f0c(0xf7),{'val':Date[_0x145f0c(0xf5)](),'ack':!![]}));}catch(_0x4c7d91){}}async function executeAutomationAction(_0xc5e415){const _0x577f91=a0_0x2abb1b;try{const _0x5156dd=await _0xc5e415[_0x577f91(0x17d)](_0x577f91(0x113)),_0x1bf921=await _0xc5e415['getStateAsync'](_0x577f91(0x162));if(_0x5156dd&&_0x5156dd[_0x577f91(0x168)]&&_0x1bf921){const _0x26cd65=_0x5156dd['val'];let _0x2df12a=_0x1bf921[_0x577f91(0x168)];try{_0x2df12a=JSON[_0x577f91(0x107)](_0x2df12a);}catch(_0x521ea8){}_0xc5e415['log']['info'](_0x577f91(0x156)+_0x26cd65+_0x577f91(0x110)+_0x2df12a),await _0xc5e415[_0x577f91(0x14f)](_0x26cd65,_0x2df12a);}else _0xc5e415[_0x577f91(0x164)][_0x577f91(0x179)](_0x577f91(0x135));}catch(_0x2dadf8){_0xc5e415[_0x577f91(0x164)]['error']('BUTLER\x20Execution\x20Error:\x20'+_0x2dadf8[_0x577f91(0x13e)]);}}async function sendMorningBriefing(_0x2a6661){const _0x3eae10=a0_0x2abb1b;if(!_0x2a6661[_0x3eae10(0x14e)]){_0x2a6661[_0x3eae10(0x164)]['warn'](_0x3eae10(0xfa));return;}_0x2a6661[_0x3eae10(0x164)][_0x3eae10(0x152)](_0x3eae10(0xef));try{updateApiTimestamp();const _0x15a165=_0x3eae10(0xf3),_0x567b7e=await _0x2a6661[_0x3eae10(0x14e)][_0x3eae10(0x122)](_0x15a165),_0x1960aa=_0x567b7e[_0x3eae10(0x155)]['text']();_0x2a6661[_0x3eae10(0x164)][_0x3eae10(0x152)]('ðŸŒ…\x20Briefing\x20generated\x20(Length:\x20'+_0x1960aa[_0x3eae10(0x145)]+_0x3eae10(0xf8)),setup[_0x3eae10(0x130)](_0x2a6661,'ðŸŒ…\x20Morning\x20Briefing:\x0a'+_0x1960aa);}catch(_0x14227b){_0x2a6661[_0x3eae10(0x164)]['error'](_0x3eae10(0x17a)+_0x14227b[_0x3eae10(0x13e)]);}}async function generateHealthReport(_0x5bac61,_0x26db0b){const _0x5c15ce=a0_0x2abb1b;if(!_0x5bac61[_0x5c15ce(0x14e)])return;const _0x3457a3=Date[_0x5c15ce(0xf5)]();_0x3457a3-lastGlobalApiCall<0xbb8&&(_0x5bac61['log'][_0x5c15ce(0x111)](_0x5c15ce(0x16d)),await new Promise(_0x1dc2ea=>setTimeout(_0x1dc2ea,0x7d0)));const _0x35be6d=new Date();let _0x353ae3=0x0,_0x4fe238=_0x35be6d['getTime'](),_0x5a0f57='';if(_0x26db0b===_0x5c15ce(0x167)){const _0x25abfb=new Date(_0x35be6d);_0x25abfb[_0x5c15ce(0x161)](_0x25abfb[_0x5c15ce(0x129)]()-0x1),_0x25abfb[_0x5c15ce(0x185)](0x16,0x0,0x0,0x0),_0x353ae3=_0x25abfb[_0x5c15ce(0x116)]();const _0x4e2940=new Date(_0x35be6d);_0x4e2940[_0x5c15ce(0x185)](0x8,0x0,0x0,0x0),_0x4fe238=_0x4e2940[_0x5c15ce(0x116)](),_0x5a0f57='Analysiere\x20diese\x20Events\x20der\x20NACHT\x20(22:00-08:00).\x20War\x20der\x20Schlaf\x20ruhig?\x20Gab\x20es\x20BadgÃ¤nge?\x20Antwort\x20kurz\x20fÃ¼r\x20den\x20besorgten\x20Sohn\x20(max\x202\x20SÃ¤tze).';}else{const _0x5112fa=new Date(_0x35be6d);_0x5112fa[_0x5c15ce(0x185)](0x8,0x0,0x0,0x0),_0x353ae3=_0x5112fa[_0x5c15ce(0x116)](),_0x5a0f57=_0x5c15ce(0x108);}const _0x54d331=_0x5bac61['eventHistory'][_0x5c15ce(0x133)](_0x89d1f2=>_0x89d1f2[_0x5c15ce(0x16a)]>=_0x353ae3&&_0x89d1f2[_0x5c15ce(0x16a)]<=_0x4fe238);if(_0x54d331[_0x5c15ce(0x145)]===0x0){const _0x5cdfb5=_0x26db0b===_0x5c15ce(0x167)?_0x5c15ce(0x189):'Bisher\x20keine\x20AktivitÃ¤t\x20seit\x2008:00\x20Uhr\x20verzeichnet.',_0x3afea3=_0x26db0b===_0x5c15ce(0x167)?_0x5c15ce(0x137):_0x5c15ce(0x13f);await _0x5bac61['setStateAsync'](_0x3afea3,{'val':_0x5cdfb5,'ack':!![]});return;}const _0x16a558=_0x54d331[_0x5c15ce(0x132)](_0xcd2d61=>new Date(_0xcd2d61[_0x5c15ce(0x16a)])[_0x5c15ce(0x12e)]([],{'hour':_0x5c15ce(0x117),'minute':_0x5c15ce(0x117)})+'\x20'+_0xcd2d61['name']+'\x20('+_0xcd2d61[_0x5c15ce(0xfe)]+')')['join']('\x0a'),_0x479ab4=_0x5c15ce(0x11a)+_0x5a0f57+'\x0a\x20\x20\x20\x20EVENTS:\x0a'+_0x16a558+_0x5c15ce(0x119);try{updateApiTimestamp();const _0x3229ed=await _0x5bac61[_0x5c15ce(0x14e)][_0x5c15ce(0x122)](_0x479ab4),_0x225cc5=_0x3229ed[_0x5c15ce(0x155)]['text'](),_0xf2c78f=_0x26db0b===_0x5c15ce(0x167)?'analysis.health.geminiNight':'analysis.health.geminiDay';await _0x5bac61['setStateAsync'](_0xf2c78f,{'val':_0x225cc5,'ack':!![]}),_0x5bac61[_0x5c15ce(0x164)][_0x5c15ce(0x152)](_0x5c15ce(0x176)+_0x26db0b+')\x20generated.');}catch(_0xc5ca5a){_0x5bac61[_0x5c15ce(0x164)][_0x5c15ce(0x165)](_0x5c15ce(0x13d)+_0xc5ca5a[_0x5c15ce(0x13e)]);}}module[a0_0x2abb1b(0x12a)]={'executeAutomationAction':executeAutomationAction,'createDailyDigest':createDailyDigest,'runBaselineDriftAnalysis':runBaselineDriftAnalysis,'sendMorningBriefing':sendMorningBriefing,'runGeminiAnalysis':runGeminiAnalysis,'consultButler':consultButler,'generateHealthReport':generateHealthReport};