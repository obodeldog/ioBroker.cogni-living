const a0_0xd804f8=a0_0xf1e3;(function(_0x1ca90e,_0x2bec31){const _0x47bf42=a0_0xf1e3,_0x61e7d6=_0x1ca90e();while(!![]){try{const _0x24f248=parseInt(_0x47bf42(0x207))/0x1+-parseInt(_0x47bf42(0x1d8))/0x2*(-parseInt(_0x47bf42(0x1db))/0x3)+-parseInt(_0x47bf42(0x1ac))/0x4+-parseInt(_0x47bf42(0x1be))/0x5+parseInt(_0x47bf42(0x23b))/0x6*(parseInt(_0x47bf42(0x217))/0x7)+parseInt(_0x47bf42(0x22c))/0x8+-parseInt(_0x47bf42(0x1e8))/0x9;if(_0x24f248===_0x2bec31)break;else _0x61e7d6['push'](_0x61e7d6['shift']());}catch(_0x237e3c){_0x61e7d6['push'](_0x61e7d6['shift']());}}}(a0_0x20a6,0x307a5));const a0_0x3db301=(function(){let _0x1766e1=!![];return function(_0x1085cf,_0x224c57){const _0x477038=_0x1766e1?function(){const _0x45441f=a0_0xf1e3;if(_0x224c57){const _0x10f316=_0x224c57[_0x45441f(0x219)](_0x1085cf,arguments);return _0x224c57=null,_0x10f316;}}:function(){};return _0x1766e1=![],_0x477038;};}()),a0_0x3a7641=a0_0x3db301(this,function(){const _0x3653e4=a0_0xf1e3;return a0_0x3a7641['toString']()[_0x3653e4(0x1f4)]('(((.+)+)+)+$')['toString']()[_0x3653e4(0x237)](a0_0x3a7641)[_0x3653e4(0x1f4)](_0x3653e4(0x1c7));});a0_0x3a7641();function a0_0x20a6(){const _0x5a69bf=['PRIORITÃ„T:\x20Energie\x20sparen.\x20Schalte\x20nur,\x20wenn\x20absolut\x20notwendig\x20(Dunkelheit).','\x0a\x20\x20\x20\x20FRAGE:\x20Ist\x20es\x20dunkel\x20genug\x20fÃ¼r\x20Licht?\x0a\x20\x20\x20\x20FORMAT:\x20{\x20\x22approved\x22:\x20boolean,\x20\x22reason\x22:\x20\x22kurzer\x20Grund\x22\x20}\x0a\x20\x20\x20\x20','approved','targetValue','Analysiere\x20diese\x20Events\x20der\x20NACHT\x20(22:00-08:00).\x20War\x20der\x20Schlaf\x20ruhig?\x20Gab\x20es\x20BadgÃ¤nge?\x20Antwort\x20kurz\x20fÃ¼r\x20den\x20besorgten\x20Sohn\x20(max\x202\x20SÃ¤tze).','dailyDigests','trim','ðŸ¤–\x20Traffic\x20Schutz:\x20Anfrage\x20fÃ¼r\x20','2399553CNCdWL','aiPersona','setHours','livingContext','LTM.rawEventLog','summary','analysisHistory','parse','replace','analysis.isAlert','LTM.driftAnalysis.baselineDrift','toLocaleTimeString','search','analysis.alertReason','NIGHT','Briefing\x20Error:\x20','ROLLE:\x20Data\x20Compression\x20Agent.\x20SPRACHE:\x20DE.\x20FORMAT:\x20JSON.\x20ANWEISUNG:\x20Fasse\x20Sensor-Events\x20zusammen.\x20SCHEMA:\x20{\x20\x22summary\x22:\x20\x22string\x22,\x20\x22activityLevel\x22:\x20\x22string\x22\x20}\x20\x0a\x0aEVENTS:\x0a','isEmergency','ROLLE:\x20Data\x20Scientist.\x20ZIEL:\x20Drift\x20erkennen.\x20SCHEMA:\x20{\x20\x22baselineDrift\x22:\x20\x22none|slight|significant|critical\x22,\x20\x22driftDetails\x22:\x20\x22string\x22\x20}\x0a\x0aLTB:\x20','Unbekannt','Skipped\x20(No\x20AI\x20or\x20Data)','isProVersion','ðŸŒ…\x20Briefing\x20generated\x20(Length:\x20',',\x20Wetter:\x20','info','config','LTM.processingStatus','\x0a\x20\x20\x20\x20EVENTS:\x0a','message','unshift','Health\x20Report\x20Error:\x20','59834JytVVc','detected','splice','name','.\x20EMERGENCY:\x20','exports','decision','models/gemini-flash-latest','ltmLtbWindowDays','push','description','.Current.WeatherText','Nacht','text','response','weatherInstance','1512735YoqHTf','warn','apply','ðŸ¤–\x20Autopilot\x20skipped\x20(Traffic\x20Protection\x20active).','analysis.automation.targetValue','.\x20ANWESEND:\x20','getDate','val','timestamp','ðŸ¤–\x20Morning\x20Briefing\x20skipped:\x20No\x20Gemini\x20Model.','Gemini\x20Error:\x20','lastAlertState','value','\x22.\x0a\x20\x20\x20\x20AKTION:\x20Schalte\x20\x22','debug','alertReason','analysis.automation.targetId','generateContent','.Current.IsNight','Started...','slice','2357616ddEvfP','\x22\x20AN.\x0a\x20\x20\x20\x20STRATEGIE:\x20','KI-Fehler\x20(Fallback)','.Current.Temperature','Keine\x20Details.','currentSystemMode','Unbekannt\x20(Kein\x20Sensor)','ROLLE:\x20KI-Hausverwalter.\x20PERSONA:\x20','.\x0a\x20\x20\x20\x20EVENT:\x20Bewohner\x20geht\x20wahrscheinlich\x20(','stringify','N/A\x20(Learning)','constructor','send','getForeignStateAsync','join','6jPZecz','system.presenceWho','.\x20AUFGABE:\x201.\x20Gesundheit?\x202.\x20Komfort?\x20FORMAT\x20(JSON):\x20{\x20\x22isAlert\x22:\x20boolean,\x20\x22alertReason\x22:\x20\x22string\x22,\x20\x22isEmergency\x22:\x20boolean,\x20\x22summary\x22:\x20\x22string\x22,\x20\x22automationProposal\x22:\x20{\x20\x22detected\x22:\x20boolean,\x20\x22description\x22:\x20\x22string\x22,\x20\x22targetId\x22:\x20\x22string\x22,\x20\x22targetValue\x22:\x20\x22any\x22\x20}\x20}','now','LTM.driftAnalysis.driftDetails','\x20->\x20','eventHistory','387676wHxgak','ðŸŒ…\x20Morning\x20Briefing:\x0a','analysis.activitySummary','ltmStbWindowDays','.forecast.current.temperature','2-digit','ðŸ¤–\x20Butler\x20Brain\x20Error:\x20','toString','\x0a\x20\x20\x20\x20ANTWORT-STIL:\x20Sachlich,\x20beruhigend,\x20prÃ¤zise.\x20Keine\x20Floskeln.\x0a\x20\x20\x20\x20','\x0aAktivitÃ¤t:\x20','.\x20KONTEXT:\x20','Traffic-Schutz\x20(Auto-Approved)','activityLevel','\x20Ã¼bersprungen\x20(Auto-Approved).','setForeignStateAsync','isAlert','Wetterdaten\x20nicht\x20abrufbar','analysis.lastResult','1311680iRCGuu','baselineDrift','analysis.analysisHistory','rawEventLog','error','setStateAsync','analysis.automation.patternDetected','automationProposal','log','(((.+)+)+)+$','BUTLER\x20Execution\x20Error:\x20','normal','Success','âš ï¸\x20ALARM:\x20','generic','Erstelle\x20ein\x20kurzes\x20\x27Guten\x20Morgen\x27\x20Briefing\x20basierend\x20auf\x20den\x20Events\x20der\x20letzten\x20Nacht.','geminiModel','filter','ðŸ¤–\x20BUTLER:\x20Executing\x20Action\x20->\x20','.\x20SYSTEM_MODE:\x20','targetId','ðŸ¤–\x20Butler\x20Cache\x20Hit:\x20','getStateAsync','analysis.health.geminiDay','getTime','ðŸ“…\x20Daily\x20Digest:\x0a','8ZdDclq','analysis.automation.autoApply','Sicherheit\x20geht\x20vor.','190347GwYvkc','\x0aSTB:\x20','\x20=\x20','length','.\x20EVENTS:\x20'];a0_0x20a6=function(){return _0x5a69bf;};return a0_0x20a6();}'use strict';const {GoogleGenerativeAI}=require('@google/generative-ai'),setup=require('./setup'),GEMINI_MODEL=a0_0xd804f8(0x20e),LTM_DP_DAILY_DIGESTS='LTM.dailyDigests',LTM_DP_STATUS=a0_0xd804f8(0x202),LTM_DP_RAW_LOG=a0_0xd804f8(0x1ec),LTM_MIN_EVENTS_FOR_COMPRESSION=0x5,MIN_API_GAP_MS=0x4e20;let lastGlobalApiCall=0x0;const decisionCache={},CACHE_TTL_MS=0xf*0x3c*0x3e8,PERSONA_MAPPING={'generic':'Entscheide\x20ausgewogen\x20zwischen\x20Komfort\x20und\x20Energie.','senior_aal':'PRIORITÃ„T:\x20Sicherheit\x20und\x20Licht.\x20Schalte\x20lieber\x20einmal\x20zu\x20viel\x20als\x20zu\x20wenig.','family':'Fokus\x20auf\x20Komfort\x20fÃ¼r\x20die\x20Familie.','single_comfort':'Maximaler\x20Komfort,\x20Energie\x20ist\x20zweitrangig.','security':a0_0xd804f8(0x1da),'energy_saver':a0_0xd804f8(0x1e0)};function canCallApi(){const _0x43bc7a=Date['now']();return _0x43bc7a-lastGlobalApiCall>MIN_API_GAP_MS;}function updateApiTimestamp(){const _0x2bc4e9=a0_0xd804f8;lastGlobalApiCall=Date[_0x2bc4e9(0x23e)]();}async function getWeatherContext(_0xbc1f52){const _0x581eb7=a0_0xd804f8;if(!_0xbc1f52[_0x581eb7(0x201)]['useWeather']||!_0xbc1f52['config'][_0x581eb7(0x216)])return _0x581eb7(0x232);try{const _0x100a25=_0xbc1f52[_0x581eb7(0x201)][_0x581eb7(0x216)];let _0x3aefd1=await _0xbc1f52[_0x581eb7(0x239)](_0x100a25+_0x581eb7(0x22f));if(!_0x3aefd1)_0x3aefd1=await _0xbc1f52[_0x581eb7(0x239)](_0x100a25+_0x581eb7(0x1b0));let _0x3b6780=await _0xbc1f52[_0x581eb7(0x239)](_0x100a25+_0x581eb7(0x212));if(!_0x3b6780)_0x3b6780=await _0xbc1f52[_0x581eb7(0x239)](_0x100a25+'.forecast.current.state');let _0x31fc74='Unbekannt';const _0xee4369=await _0xbc1f52[_0x581eb7(0x239)](_0x100a25+_0x581eb7(0x229));if(_0xee4369)_0x31fc74=_0xee4369['val']?_0x581eb7(0x213):'Tag';if(_0x3aefd1&&_0x3b6780)return _0x3aefd1[_0x581eb7(0x21e)]+'Â°C,\x20'+_0x3b6780[_0x581eb7(0x21e)]+',\x20LichtverhÃ¤ltnisse:\x20'+_0x31fc74;}catch(_0x4739fd){}return _0x581eb7(0x1bc);}async function consultButler(_0x936a0b,_0x193501,_0x89c63a,_0x9eafd2){const _0x5e51b1=a0_0xd804f8;if(!_0x936a0b[_0x5e51b1(0x1ce)])return{'approved':!![],'reason':'KI\x20offline\x20(Fallback)'};const _0x57544b=Date[_0x5e51b1(0x23e)]();if(decisionCache[_0x193501]&&_0x57544b-decisionCache[_0x193501][_0x5e51b1(0x21f)]<CACHE_TTL_MS){const _0x4fe08f=decisionCache[_0x193501][_0x5e51b1(0x20d)];return _0x936a0b[_0x5e51b1(0x1c6)]['debug'](_0x5e51b1(0x1d3)+_0x193501+_0x5e51b1(0x1aa)+(_0x4fe08f[_0x5e51b1(0x1e2)]?'OK':'NO')+'\x20('+_0x4fe08f['reason']+')'),_0x4fe08f;}if(!canCallApi())return _0x936a0b[_0x5e51b1(0x1c6)][_0x5e51b1(0x225)](_0x5e51b1(0x1e7)+_0x193501+_0x5e51b1(0x1b9)),{'approved':!![],'reason':_0x5e51b1(0x1b7)};const _0xee82cc=new Date()[_0x5e51b1(0x1f3)](),_0x47138c=await getWeatherContext(_0x936a0b),_0x3b77fd=PERSONA_MAPPING[_0x936a0b[_0x5e51b1(0x201)][_0x5e51b1(0x1e9)]||_0x5e51b1(0x1cc)],_0x5caf3f='\x0a\x20\x20\x20\x20ROLLE:\x20Haus-Butler.\x0a\x20\x20\x20\x20SITUATION:\x20'+_0xee82cc+_0x5e51b1(0x1ff)+_0x47138c+_0x5e51b1(0x234)+(_0x9eafd2*0x64)['toFixed'](0x0)+'%)\x20nach\x20\x22'+_0x193501+_0x5e51b1(0x224)+_0x89c63a+_0x5e51b1(0x22d)+_0x3b77fd+_0x5e51b1(0x1e1);try{updateApiTimestamp();const _0x7ef71b=await _0x936a0b[_0x5e51b1(0x1ce)][_0x5e51b1(0x228)](_0x5caf3f),_0x2301fc=_0x7ef71b[_0x5e51b1(0x215)]['text']()[_0x5e51b1(0x1f0)](/```json|```/g,'')[_0x5e51b1(0x1e6)](),_0xd4f91f=JSON[_0x5e51b1(0x1ef)](_0x2301fc);return decisionCache[_0x193501]={'decision':_0xd4f91f,'timestamp':_0x57544b},_0xd4f91f;}catch(_0x52828d){return _0x936a0b[_0x5e51b1(0x1c6)][_0x5e51b1(0x218)](_0x5e51b1(0x1b2)+_0x52828d['message']),decisionCache[_0x193501]={'decision':{'approved':!![],'reason':_0x5e51b1(0x22e)},'timestamp':_0x57544b-(CACHE_TTL_MS-0xea60)},{'approved':!![],'reason':_0x5e51b1(0x22e)};}}async function runGeminiAnalysis(_0x5bfbce,_0xfbb0b2=''){const _0x46308d=a0_0xd804f8;if(!_0x5bfbce[_0x46308d(0x1ce)])return;if(!canCallApi()){_0x5bfbce[_0x46308d(0x1c6)][_0x46308d(0x225)](_0x46308d(0x21a));return;}if(_0x5bfbce[_0x46308d(0x1ab)][_0x46308d(0x1de)]===0x0)return;const _0x22c870=_0x5bfbce['eventHistory'][_0x46308d(0x22b)](0x0,0xf),_0x403dee=_0x5bfbce[_0x46308d(0x231)],_0x66f89=PERSONA_MAPPING[_0x5bfbce[_0x46308d(0x201)][_0x46308d(0x1e9)]||'generic'],_0x6fe529=_0x5bfbce['config'][_0x46308d(0x1eb)]||_0x46308d(0x230);let _0x1608de=_0x46308d(0x1fb);try{const _0x45b6e3=await _0x5bfbce[_0x46308d(0x1d4)](_0x46308d(0x23c));if(_0x45b6e3&&_0x45b6e3[_0x46308d(0x21e)])_0x1608de=_0x45b6e3[_0x46308d(0x21e)];}catch(_0x4afb35){}let _0x97cd37=![];try{const _0x43cc3c=await _0x5bfbce[_0x46308d(0x1d4)](_0x46308d(0x1d9));if(_0x43cc3c&&_0x43cc3c[_0x46308d(0x21e)])_0x97cd37=!![];}catch(_0x3bda0c){}const _0x25f518=_0x46308d(0x233)+_0x66f89+_0x46308d(0x1b6)+_0x6fe529+_0x46308d(0x1d1)+_0x403dee+_0x46308d(0x21c)+_0x1608de+_0x46308d(0x1df)+JSON[_0x46308d(0x235)](_0x22c870)+_0x46308d(0x20b)+_0xfbb0b2+_0x46308d(0x23d);try{updateApiTimestamp();const _0xf8cc39=await _0x5bfbce[_0x46308d(0x1ce)][_0x46308d(0x228)](_0x25f518),_0x5a857a=JSON[_0x46308d(0x1ef)](_0xf8cc39[_0x46308d(0x215)][_0x46308d(0x214)]()[_0x46308d(0x1f0)](/```json|```/g,'')['trim']());await _0x5bfbce[_0x46308d(0x1c3)](_0x46308d(0x1bd),{'val':JSON[_0x46308d(0x235)](_0x5a857a),'ack':!![]});if(_0x5a857a[_0x46308d(0x1ed)])await _0x5bfbce[_0x46308d(0x1c3)](_0x46308d(0x1ae),{'val':_0x5a857a[_0x46308d(0x1ed)],'ack':!![]});const _0x3e80eb={'timestamp':Date[_0x46308d(0x23e)](),'id':Date[_0x46308d(0x23e)]()[_0x46308d(0x1b3)](),'analysis':{'activity':{'summary':_0x5a857a[_0x46308d(0x1ed)],'isAlert':_0x5a857a['isAlert'],'alertReason':_0x5a857a[_0x46308d(0x226)]},'comfort':{'automationProposal':_0x5a857a[_0x46308d(0x1c5)]}}};_0x5bfbce['analysisHistory'][_0x46308d(0x205)](_0x3e80eb);if(_0x5bfbce['analysisHistory'][_0x46308d(0x1de)]>0x32)_0x5bfbce[_0x46308d(0x1ee)]['pop']();await _0x5bfbce[_0x46308d(0x1c3)](_0x46308d(0x1c0),{'val':JSON[_0x46308d(0x235)](_0x5bfbce[_0x46308d(0x1ee)]),'ack':!![]});const _0x444850=_0x5a857a[_0x46308d(0x1bb)]||![];_0x444850!==_0x5bfbce['lastAlertState']&&(await _0x5bfbce[_0x46308d(0x1c3)](_0x46308d(0x1f1),{'val':_0x444850,'ack':!![]}),_0x5bfbce[_0x46308d(0x222)]=_0x444850,_0x444850&&(await _0x5bfbce['setStateAsync'](_0x46308d(0x1f5),{'val':_0x5a857a[_0x46308d(0x226)],'ack':!![]}),setup['sendNotification'](_0x5bfbce,_0x46308d(0x1cb)+_0x5a857a[_0x46308d(0x226)],![],_0x5a857a[_0x46308d(0x1f9)])));if(_0x5a857a[_0x46308d(0x1c5)]&&_0x5a857a[_0x46308d(0x1c5)][_0x46308d(0x208)]){await _0x5bfbce[_0x46308d(0x1c3)](_0x46308d(0x1c4),{'val':!![],'ack':!![]}),await _0x5bfbce[_0x46308d(0x1c3)]('analysis.automation.description',{'val':_0x5a857a[_0x46308d(0x1c5)][_0x46308d(0x211)],'ack':!![]}),await _0x5bfbce['setStateAsync'](_0x46308d(0x227),{'val':_0x5a857a[_0x46308d(0x1c5)][_0x46308d(0x1d2)],'ack':!![]}),await _0x5bfbce[_0x46308d(0x1c3)]('analysis.automation.targetValue',{'val':JSON[_0x46308d(0x235)](_0x5a857a[_0x46308d(0x1c5)][_0x46308d(0x1e3)]),'ack':!![]});if(_0x97cd37)executeAutomationAction(_0x5bfbce);}}catch(_0x340b03){_0x5bfbce[_0x46308d(0x1c6)][_0x46308d(0x1c2)](_0x46308d(0x221)+_0x340b03[_0x46308d(0x204)]);}}async function createDailyDigest(_0x1bf068,_0x2c46b1){const _0x332a91=a0_0xd804f8;if(!_0x1bf068[_0x332a91(0x1fd)])return;if(!canCallApi()){await _0x1bf068[_0x332a91(0x1c3)](LTM_DP_STATUS,{'val':'Skipped\x20(Traffic)','ack':!![]});return;}await _0x1bf068[_0x332a91(0x1c3)](LTM_DP_STATUS,{'val':_0x332a91(0x22a),'ack':!![]});if(!_0x1bf068['geminiModel']||_0x1bf068[_0x332a91(0x1c1)][_0x332a91(0x1de)]<LTM_MIN_EVENTS_FOR_COMPRESSION){await _0x1bf068[_0x332a91(0x1c3)](LTM_DP_STATUS,{'val':_0x332a91(0x1fc),'ack':!![]});return;}const _0x5b35f8=JSON[_0x332a91(0x1ef)](JSON[_0x332a91(0x235)](_0x1bf068[_0x332a91(0x1c1)])),_0x5d48bb=_0x5b35f8['length'],_0x4e4693=_0x332a91(0x1f8)+JSON[_0x332a91(0x235)](_0x5b35f8);try{updateApiTimestamp();const _0x5a0933=await _0x1bf068[_0x332a91(0x1ce)][_0x332a91(0x228)](_0x4e4693),_0x430dca=JSON[_0x332a91(0x1ef)](_0x5a0933[_0x332a91(0x215)][_0x332a91(0x214)]()[_0x332a91(0x1f0)](/```json|```/g,'')[_0x332a91(0x1e6)]()),_0x1e9278={'timestamp':new Date()['toISOString'](),'eventCount':_0x5d48bb,'summary':_0x430dca['summary']||'Digest','activityLevel':_0x430dca[_0x332a91(0x1b8)]||_0x332a91(0x1c9),'systemMode':_0x1bf068['currentSystemMode']};_0x1bf068[_0x332a91(0x1e5)][_0x332a91(0x210)](_0x1e9278);const _0x5577da=_0x1bf068['config'][_0x332a91(0x20f)]||0x3c;_0x1bf068[_0x332a91(0x1e5)][_0x332a91(0x1de)]>_0x5577da&&_0x1bf068[_0x332a91(0x1e5)][_0x332a91(0x209)](0x0,_0x1bf068[_0x332a91(0x1e5)][_0x332a91(0x1de)]-_0x5577da);await _0x1bf068['setStateAsync'](LTM_DP_DAILY_DIGESTS,{'val':JSON[_0x332a91(0x235)](_0x1bf068[_0x332a91(0x1e5)]),'ack':!![]}),_0x1bf068[_0x332a91(0x1c1)]=[],await _0x1bf068[_0x332a91(0x1c3)](LTM_DP_RAW_LOG,{'val':JSON['stringify'](_0x1bf068['rawEventLog']),'ack':!![]}),await _0x1bf068['setStateAsync'](LTM_DP_STATUS,{'val':_0x332a91(0x1ca),'ack':!![]});const _0x3863ab=_0x332a91(0x1d7)+_0x430dca[_0x332a91(0x1ed)]+_0x332a91(0x1b5)+_0x430dca[_0x332a91(0x1b8)];setup['sendNotification'](_0x1bf068,_0x3863ab,![],![]);if(_0x1bf068[_0x332a91(0x1fd)]&&_0x2c46b1)_0x2c46b1[_0x332a91(0x238)](_0x1bf068,'ANALYZE_HEALTH',{'digest':_0x1e9278});}catch(_0x1cd5dd){_0x1bf068[_0x332a91(0x1c6)][_0x332a91(0x1c2)](_0x1cd5dd[_0x332a91(0x204)]);}}async function runBaselineDriftAnalysis(_0x58d9ce){const _0x150c01=a0_0xd804f8;if(!_0x58d9ce[_0x150c01(0x1fd)]||!_0x58d9ce['geminiModel'])return;if(!canCallApi())return;const _0x59a477=_0x58d9ce[_0x150c01(0x201)][_0x150c01(0x1af)]||0xe;if(_0x58d9ce[_0x150c01(0x1e5)][_0x150c01(0x1de)]<_0x59a477+0x7){await _0x58d9ce[_0x150c01(0x1c3)](_0x150c01(0x1f2),{'val':_0x150c01(0x236),'ack':!![]});return;}const _0x4b8d35=_0x58d9ce[_0x150c01(0x1e5)]['slice'](-_0x59a477),_0x3163da=_0x58d9ce['dailyDigests'][_0x150c01(0x22b)](0x0,_0x58d9ce[_0x150c01(0x1e5)]['length']-_0x59a477),_0x50029e=_0x150c01(0x1fa)+JSON[_0x150c01(0x235)](_0x3163da)+_0x150c01(0x1dc)+JSON[_0x150c01(0x235)](_0x4b8d35);try{updateApiTimestamp();const _0x511962=await _0x58d9ce['geminiModel'][_0x150c01(0x228)](_0x50029e),_0x1fb9a9=JSON[_0x150c01(0x1ef)](_0x511962[_0x150c01(0x215)][_0x150c01(0x214)]()[_0x150c01(0x1f0)](/```json|```/g,'')[_0x150c01(0x1e6)]());_0x1fb9a9[_0x150c01(0x1bf)]&&(await _0x58d9ce['setStateAsync'](_0x150c01(0x1f2),{'val':_0x1fb9a9[_0x150c01(0x1bf)],'ack':!![]}),await _0x58d9ce[_0x150c01(0x1c3)](_0x150c01(0x1a9),{'val':_0x1fb9a9['driftDetails'],'ack':!![]}),await _0x58d9ce['setStateAsync']('LTM.driftAnalysis.lastCheck',{'val':Date['now'](),'ack':!![]}));}catch(_0x7b5384){}}async function executeAutomationAction(_0x3f0c35){const _0x4cc0a2=a0_0xd804f8;try{const _0x45d5e9=await _0x3f0c35[_0x4cc0a2(0x1d4)](_0x4cc0a2(0x227)),_0x204461=await _0x3f0c35['getStateAsync'](_0x4cc0a2(0x21b));if(_0x45d5e9&&_0x45d5e9[_0x4cc0a2(0x21e)]&&_0x204461){const _0xc9ffde=_0x45d5e9[_0x4cc0a2(0x21e)];let _0x3b501c=_0x204461[_0x4cc0a2(0x21e)];try{_0x3b501c=JSON[_0x4cc0a2(0x1ef)](_0x3b501c);}catch(_0x43a079){}_0x3f0c35['log'][_0x4cc0a2(0x200)](_0x4cc0a2(0x1d0)+_0xc9ffde+_0x4cc0a2(0x1dd)+_0x3b501c),await _0x3f0c35[_0x4cc0a2(0x1ba)](_0xc9ffde,_0x3b501c);}else _0x3f0c35[_0x4cc0a2(0x1c6)][_0x4cc0a2(0x218)]('ðŸ¤–\x20BUTLER:\x20No\x20valid\x20target\x20ID\x20or\x20value\x20stored\x20for\x20execution.');}catch(_0x495333){_0x3f0c35['log'][_0x4cc0a2(0x1c2)](_0x4cc0a2(0x1c8)+_0x495333[_0x4cc0a2(0x204)]);}}function a0_0xf1e3(_0x2424e9,_0x79329e){const _0xbc40e3=a0_0x20a6();return a0_0xf1e3=function(_0x3a7641,_0x3db301){_0x3a7641=_0x3a7641-0x1a9;let _0x20a64a=_0xbc40e3[_0x3a7641];return _0x20a64a;},a0_0xf1e3(_0x2424e9,_0x79329e);}async function sendMorningBriefing(_0x1e6ce6){const _0x5338fa=a0_0xd804f8;if(!_0x1e6ce6['geminiModel']){_0x1e6ce6[_0x5338fa(0x1c6)][_0x5338fa(0x218)](_0x5338fa(0x220));return;}_0x1e6ce6[_0x5338fa(0x1c6)]['info']('ðŸŒ…\x20Starting\x20Morning\x20Briefing\x20sequence\x20(Traffic\x20Check\x20bypassed)...');try{updateApiTimestamp();const _0x1a94cf=_0x5338fa(0x1cd),_0x4bede8=await _0x1e6ce6[_0x5338fa(0x1ce)]['generateContent'](_0x1a94cf),_0x187154=_0x4bede8[_0x5338fa(0x215)][_0x5338fa(0x214)]();_0x1e6ce6[_0x5338fa(0x1c6)]['info'](_0x5338fa(0x1fe)+_0x187154['length']+').\x20Sending\x20notification...'),setup['sendNotification'](_0x1e6ce6,_0x5338fa(0x1ad)+_0x187154);}catch(_0x997149){_0x1e6ce6[_0x5338fa(0x1c6)][_0x5338fa(0x1c2)](_0x5338fa(0x1f7)+_0x997149[_0x5338fa(0x204)]);}}async function generateHealthReport(_0x42fc61,_0x2284cc){const _0xc29419=a0_0xd804f8;if(!_0x42fc61[_0xc29419(0x1ce)])return;const _0x1224d7=Date['now']();_0x1224d7-lastGlobalApiCall<0xbb8&&(_0x42fc61[_0xc29419(0x1c6)][_0xc29419(0x225)]('ðŸ¤–\x20API\x20Cooldown.\x20Waiting\x202s...'),await new Promise(_0x1efe05=>setTimeout(_0x1efe05,0x7d0)));const _0x760632=new Date();let _0x2765c2=0x0,_0x528f5e=_0x760632['getTime'](),_0x10c78e='';if(_0x2284cc==='NIGHT'){const _0x375020=new Date(_0x760632);_0x375020['setDate'](_0x375020[_0xc29419(0x21d)]()-0x1),_0x375020[_0xc29419(0x1ea)](0x16,0x0,0x0,0x0),_0x2765c2=_0x375020[_0xc29419(0x1d6)]();const _0x5a150c=new Date(_0x760632);_0x5a150c['setHours'](0x8,0x0,0x0,0x0),_0x528f5e=_0x5a150c[_0xc29419(0x1d6)](),_0x10c78e=_0xc29419(0x1e4);}else{const _0xfc5846=new Date(_0x760632);_0xfc5846['setHours'](0x8,0x0,0x0,0x0),_0x2765c2=_0xfc5846[_0xc29419(0x1d6)](),_0x10c78e='Analysiere\x20diese\x20Events\x20des\x20TAGES\x20(08:00-Jetzt).\x20AktivitÃ¤t?\x20Mahlzeiten?\x20HaustÃ¼r?\x20Antwort\x20kurz\x20fÃ¼r\x20den\x20besorgten\x20Sohn\x20(max\x202\x20SÃ¤tze).';}const _0x4522e8=_0x42fc61[_0xc29419(0x1ab)][_0xc29419(0x1cf)](_0x26e084=>_0x26e084['timestamp']>=_0x2765c2&&_0x26e084['timestamp']<=_0x528f5e);if(_0x4522e8[_0xc29419(0x1de)]===0x0){const _0x5765f8=_0x2284cc===_0xc29419(0x1f6)?'Keine\x20Daten\x20fÃ¼r\x20die\x20Nacht\x20aufgezeichnet\x20(Sensoren\x20ruhig).':'Bisher\x20keine\x20AktivitÃ¤t\x20seit\x2008:00\x20Uhr\x20verzeichnet.',_0x5a6b3e=_0x2284cc===_0xc29419(0x1f6)?'analysis.health.geminiNight':_0xc29419(0x1d5);await _0x42fc61[_0xc29419(0x1c3)](_0x5a6b3e,{'val':_0x5765f8,'ack':!![]});return;}const _0x48c0c4=_0x4522e8['map'](_0x53b7ca=>new Date(_0x53b7ca['timestamp'])[_0xc29419(0x1f3)]([],{'hour':_0xc29419(0x1b1),'minute':'2-digit'})+'\x20'+_0x53b7ca[_0xc29419(0x20a)]+'\x20('+_0x53b7ca[_0xc29419(0x223)]+')')[_0xc29419(0x23a)]('\x0a'),_0x5d0ba9='\x0a\x20\x20\x20\x20ROLLE:\x20Medizinischer\x20Assistent\x20fÃ¼r\x20AAL\x20(Ambient\x20Assisted\x20Living).\x0a\x20\x20\x20\x20AUFGABE:\x20'+_0x10c78e+_0xc29419(0x203)+_0x48c0c4+_0xc29419(0x1b4);try{updateApiTimestamp();const _0x3f5138=await _0x42fc61[_0xc29419(0x1ce)][_0xc29419(0x228)](_0x5d0ba9),_0x20db12=_0x3f5138[_0xc29419(0x215)][_0xc29419(0x214)](),_0x475567=_0x2284cc===_0xc29419(0x1f6)?'analysis.health.geminiNight':_0xc29419(0x1d5);await _0x42fc61[_0xc29419(0x1c3)](_0x475567,{'val':_0x20db12,'ack':!![]}),_0x42fc61[_0xc29419(0x1c6)][_0xc29419(0x200)]('ðŸ¤–\x20Health\x20Report\x20('+_0x2284cc+')\x20generated.');}catch(_0x57ecc2){_0x42fc61[_0xc29419(0x1c6)][_0xc29419(0x1c2)](_0xc29419(0x206)+_0x57ecc2['message']);}}module[a0_0xd804f8(0x20c)]={'executeAutomationAction':executeAutomationAction,'createDailyDigest':createDailyDigest,'runBaselineDriftAnalysis':runBaselineDriftAnalysis,'sendMorningBriefing':sendMorningBriefing,'runGeminiAnalysis':runGeminiAnalysis,'consultButler':consultButler,'generateHealthReport':generateHealthReport};