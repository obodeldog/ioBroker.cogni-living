const a0_0x31121e=a0_0x5b6f;function a0_0x5b6f(_0x14fca7,_0x5f4a58){const _0x5460cd=a0_0x53cb();return a0_0x5b6f=function(_0x5131ff,_0x10dd45){_0x5131ff=_0x5131ff-0x87;let _0x53cbf8=_0x5460cd[_0x5131ff];return _0x53cbf8;},a0_0x5b6f(_0x14fca7,_0x5f4a58);}(function(_0x2fcdca,_0x230094){const _0x2726da=a0_0x5b6f,_0x11847f=_0x2fcdca();while(!![]){try{const _0x5224fc=-parseInt(_0x2726da(0xab))/0x1*(-parseInt(_0x2726da(0x11e))/0x2)+-parseInt(_0x2726da(0x97))/0x3*(-parseInt(_0x2726da(0xae))/0x4)+-parseInt(_0x2726da(0xcc))/0x5*(-parseInt(_0x2726da(0xfb))/0x6)+-parseInt(_0x2726da(0xf4))/0x7*(-parseInt(_0x2726da(0xd9))/0x8)+parseInt(_0x2726da(0xe8))/0x9+-parseInt(_0x2726da(0x124))/0xa*(parseInt(_0x2726da(0x10f))/0xb)+-parseInt(_0x2726da(0x100))/0xc;if(_0x5224fc===_0x230094)break;else _0x11847f['push'](_0x11847f['shift']());}catch(_0xb7bd5a){_0x11847f['push'](_0x11847f['shift']());}}}(a0_0x53cb,0x1a7c0));const a0_0x10dd45=(function(){let _0x1f43e5=!![];return function(_0x218a16,_0x3b9755){const _0x3a2698=_0x1f43e5?function(){const _0x2ed362=a0_0x5b6f;if(_0x3b9755){const _0x8d9944=_0x3b9755[_0x2ed362(0xcf)](_0x218a16,arguments);return _0x3b9755=null,_0x8d9944;}}:function(){};return _0x1f43e5=![],_0x3a2698;};}()),a0_0x5131ff=a0_0x10dd45(this,function(){const _0x45fabc=a0_0x5b6f;return a0_0x5131ff[_0x45fabc(0xf6)]()[_0x45fabc(0x8f)]('(((.+)+)+)+$')[_0x45fabc(0xf6)]()['constructor'](a0_0x5131ff)['search'](_0x45fabc(0xe0));});a0_0x5131ff();'use strict';const {GoogleGenerativeAI}=require(a0_0x31121e(0x115)),setup=require(a0_0x31121e(0x8e)),GEMINI_MODEL=a0_0x31121e(0x10d),LTM_DP_DAILY_DIGESTS=a0_0x31121e(0x119),LTM_DP_STATUS=a0_0x31121e(0xb4),LTM_DP_RAW_LOG=a0_0x31121e(0xe3),LTM_MIN_EVENTS_FOR_COMPRESSION=0x5,MIN_API_GAP_MS=0x4e20;let lastGlobalApiCall=0x0;const decisionCache={},CACHE_TTL_MS=0xf*0x3c*0x3e8,PERSONA_MAPPING={'generic':a0_0x31121e(0xb8),'senior_aal':a0_0x31121e(0xd2),'family':'Fokus\x20auf\x20Komfort\x20fÃ¼r\x20die\x20Familie.','single_comfort':a0_0x31121e(0x118),'security':a0_0x31121e(0xe7),'energy_saver':a0_0x31121e(0xc2)};function canCallApi(){const _0x38218c=a0_0x31121e,_0xe9675e=Date[_0x38218c(0xee)]();return _0xe9675e-lastGlobalApiCall>MIN_API_GAP_MS;}function updateApiTimestamp(){lastGlobalApiCall=Date['now']();}async function getWeatherContext(_0x248d76){const _0x1e76c3=a0_0x31121e;if(!_0x248d76[_0x1e76c3(0xf8)][_0x1e76c3(0x113)]||!_0x248d76[_0x1e76c3(0xf8)][_0x1e76c3(0xb9)])return'Unbekannt\x20(Kein\x20Sensor)';try{const _0x4a06bd=_0x248d76[_0x1e76c3(0xf8)][_0x1e76c3(0xb9)];let _0x2436d6=await _0x248d76[_0x1e76c3(0xd0)](_0x4a06bd+_0x1e76c3(0xc8));if(!_0x2436d6)_0x2436d6=await _0x248d76[_0x1e76c3(0xd0)](_0x4a06bd+'.forecast.current.temperature');let _0x577a43=await _0x248d76[_0x1e76c3(0xd0)](_0x4a06bd+'.Current.WeatherText');if(!_0x577a43)_0x577a43=await _0x248d76[_0x1e76c3(0xd0)](_0x4a06bd+'.forecast.current.state');let _0x2223c3=_0x1e76c3(0xda);const _0x4fd263=await _0x248d76[_0x1e76c3(0xd0)](_0x4a06bd+_0x1e76c3(0x96));if(_0x4fd263)_0x2223c3=_0x4fd263['val']?'Nacht':'Tag';if(_0x2436d6&&_0x577a43)return _0x2436d6[_0x1e76c3(0xa7)]+'Â°C,\x20'+_0x577a43[_0x1e76c3(0xa7)]+_0x1e76c3(0xeb)+_0x2223c3;}catch(_0x1d8dc5){}return _0x1e76c3(0xcb);}function a0_0x53cb(){const _0x2dd089=['toLocaleTimeString','decision','.Current.IsNight','87768YYVapi','currentSystemMode','Erstelle\x20ein\x20kurzes\x20\x27Guten\x20Morgen\x27\x20Briefing\x20basierend\x20auf\x20den\x20Events\x20der\x20letzten\x20Nacht.','analysisHistory','send','Skipped\x20(No\x20AI\x20or\x20Data)','name','dailyDigests','Analysiere\x20diese\x20Events\x20des\x20TAGES\x20(08:00-Jetzt).\x20AktivitÃ¤t?\x20Mahlzeiten?\x20HaustÃ¼r?\x20Antwort\x20kurz\x20fÃ¼r\x20den\x20besorgten\x20Sohn\x20(max\x202\x20SÃ¤tze).','Gemini\x20Error:\x20','getStateAsync','.\x20EMERGENCY:\x20','parse','isAlert','ðŸ¤–\x20Morning\x20Briefing\x20skipped:\x20No\x20Gemini\x20Model.','analysis.health.geminiNight','val','warn','info','Analysiere\x20diese\x20Events\x20der\x20NACHT\x20(22:00-08:00).\x20War\x20der\x20Schlaf\x20ruhig?\x20Gab\x20es\x20BadgÃ¤nge?\x20Antwort\x20kurz\x20fÃ¼r\x20den\x20besorgten\x20Sohn\x20(max\x202\x20SÃ¤tze).','7eNNCbP','2-digit','Success','12jQGilm','.\x20KONTEXT:\x20','detected','lastAlertState','response','analysis.analysisHistory','LTM.processingStatus','trim','toFixed','text','Entscheide\x20ausgewogen\x20zwischen\x20Komfort\x20und\x20Energie.','weatherInstance','debug','summary','analysis.automation.autoApply','replace','\x22.\x0a\x20\x20\x20\x20AKTION:\x20Schalte\x20\x22','LTM.driftAnalysis.baselineDrift','targetId','getTime','PRIORITÃ„T:\x20Energie\x20sparen.\x20Schalte\x20nur,\x20wenn\x20absolut\x20notwendig\x20(Dunkelheit).','ðŸ¤–\x20Butler\x20Brain\x20Error:\x20','isProVersion','%)\x20nach\x20\x22','error','getDate','.Current.Temperature','analysis.isAlert','livingContext','Wetterdaten\x20nicht\x20abrufbar','172220whLjre','\x0a\x20\x20\x20\x20FRAGE:\x20Ist\x20es\x20dunkel\x20genug\x20fÃ¼r\x20Licht?\x0a\x20\x20\x20\x20FORMAT:\x20{\x20\x22approved\x22:\x20boolean,\x20\x22reason\x22:\x20\x22kurzer\x20Grund\x22\x20}\x0a\x20\x20\x20\x20','NIGHT','apply','getForeignStateAsync','analysis.automation.targetValue','PRIORITÃ„T:\x20Sicherheit\x20und\x20Licht.\x20Schalte\x20lieber\x20einmal\x20zu\x20viel\x20als\x20zu\x20wenig.','âš ï¸\x20ALARM:\x20','slice',',\x20Wetter:\x20','\x0aSTB:\x20','pop','Briefing\x20Error:\x20','8sOuNNV','Unbekannt','activityLevel','normal','approved','\x0a\x20\x20\x20\x20ROLLE:\x20Haus-Butler.\x0a\x20\x20\x20\x20SITUATION:\x20','system.presenceWho','(((.+)+)+)+$','message','ðŸŒ…\x20Starting\x20Morning\x20Briefing\x20sequence\x20(Traffic\x20Check\x20bypassed)...','LTM.rawEventLog','toISOString','\x0a\x20\x20\x20\x20EVENTS:\x0a','N/A\x20(Learning)','Sicherheit\x20geht\x20vor.','1116801ByIQFM','.\x20AUFGABE:\x201.\x20Gesundheit?\x202.\x20Komfort?\x20FORMAT\x20(JSON):\x20{\x20\x22isAlert\x22:\x20boolean,\x20\x22alertReason\x22:\x20\x22string\x22,\x20\x22isEmergency\x22:\x20boolean,\x20\x22summary\x22:\x20\x22string\x22,\x20\x22automationProposal\x22:\x20{\x20\x22detected\x22:\x20boolean,\x20\x22description\x22:\x20\x22string\x22,\x20\x22targetId\x22:\x20\x22string\x22,\x20\x22targetValue\x22:\x20\x22any\x22\x20}\x20}','analysis.health.geminiDay',',\x20LichtverhÃ¤ltnisse:\x20','Traffic-Schutz\x20(Auto-Approved)','unshift','now','\x20=\x20','setDate','ðŸŒ…\x20Morning\x20Briefing:\x0a','filter','.\x0a\x20\x20\x20\x20EVENT:\x20Bewohner\x20geht\x20wahrscheinlich\x20(','1407805jgENMS','rawEventLog','toString','setStateAsync','config','\x22\x20AN.\x0a\x20\x20\x20\x20STRATEGIE:\x20','timestamp','6jRpkTk','ðŸ“…\x20Daily\x20Digest:\x0a','sendNotification','ðŸ¤–\x20BUTLER:\x20Executing\x20Action\x20->\x20','analysis.automation.description','5009808XzVpof','analysis.lastResult','length','generateContent','targetValue','ROLLE:\x20KI-Hausverwalter.\x20PERSONA:\x20','automationProposal','baselineDrift','ðŸŒ…\x20Briefing\x20generated\x20(Length:\x20','map','.\x20EVENTS:\x20','ltmLtbWindowDays','Keine\x20Details.','models/gemini-flash-latest','setForeignStateAsync','1397Bdpkmd','join','exports','ðŸ¤–\x20Traffic\x20Schutz:\x20Anfrage\x20fÃ¼r\x20','useWeather','generic','@google/generative-ai','splice','ANALYZE_HEALTH','Maximaler\x20Komfort,\x20Energie\x20ist\x20zweitrangig.','LTM.dailyDigests','driftDetails','\x0a\x20\x20\x20\x20ANTWORT-STIL:\x20Sachlich,\x20beruhigend,\x20prÃ¤zise.\x20Keine\x20Floskeln.\x0a\x20\x20\x20\x20','analysis.automation.patternDetected','analysis.alertReason','40694PYsbqU','Keine\x20Daten\x20fÃ¼r\x20die\x20Nacht\x20aufgezeichnet\x20(Sensoren\x20ruhig).','description','LTM.driftAnalysis.driftDetails','push','Started...','5030BhHsoq','alertReason','stringify','ROLLE:\x20Data\x20Scientist.\x20ZIEL:\x20Drift\x20erkennen.\x20SCHEMA:\x20{\x20\x22baselineDrift\x22:\x20\x22none|slight|significant|critical\x22,\x20\x22driftDetails\x22:\x20\x22string\x22\x20}\x0a\x0aLTB:\x20','ðŸ¤–\x20Butler\x20Cache\x20Hit:\x20','analysis.activitySummary','setHours','geminiModel','log','aiPersona','./setup','search',')\x20generated.','Skipped\x20(Traffic)','eventHistory','\x0a\x20\x20\x20\x20ROLLE:\x20Medizinischer\x20Assistent\x20fÃ¼r\x20AAL\x20(Ambient\x20Assisted\x20Living).\x0a\x20\x20\x20\x20AUFGABE:\x20'];a0_0x53cb=function(){return _0x2dd089;};return a0_0x53cb();}async function consultButler(_0x52b2e4,_0x1e78ee,_0xd0800e,_0x20fb33){const _0x51ff40=a0_0x31121e;if(!_0x52b2e4[_0x51ff40(0x8b)])return{'approved':!![],'reason':'KI\x20offline\x20(Fallback)'};const _0x19d464=Date[_0x51ff40(0xee)]();if(decisionCache[_0x1e78ee]&&_0x19d464-decisionCache[_0x1e78ee][_0x51ff40(0xfa)]<CACHE_TTL_MS){const _0x4b7a76=decisionCache[_0x1e78ee][_0x51ff40(0x95)];return _0x52b2e4['log'][_0x51ff40(0xba)](_0x51ff40(0x88)+_0x1e78ee+'\x20->\x20'+(_0x4b7a76[_0x51ff40(0xdd)]?'OK':'NO')+'\x20('+_0x4b7a76['reason']+')'),_0x4b7a76;}if(!canCallApi())return _0x52b2e4['log'][_0x51ff40(0xba)](_0x51ff40(0x112)+_0x1e78ee+'\x20Ã¼bersprungen\x20(Auto-Approved).'),{'approved':!![],'reason':_0x51ff40(0xec)};const _0x3e03ac=new Date()[_0x51ff40(0x94)](),_0x27ffb2=await getWeatherContext(_0x52b2e4),_0x4b6a77=PERSONA_MAPPING[_0x52b2e4[_0x51ff40(0xf8)][_0x51ff40(0x8d)]||_0x51ff40(0x114)],_0x2d1ff3=_0x51ff40(0xde)+_0x3e03ac+_0x51ff40(0xd5)+_0x27ffb2+_0x51ff40(0xf3)+(_0x20fb33*0x64)[_0x51ff40(0xb6)](0x0)+_0x51ff40(0xc5)+_0x1e78ee+_0x51ff40(0xbe)+_0xd0800e+_0x51ff40(0xf9)+_0x4b6a77+_0x51ff40(0xcd);try{updateApiTimestamp();const _0x220914=await _0x52b2e4['geminiModel'][_0x51ff40(0x103)](_0x2d1ff3),_0x29cb9e=_0x220914['response']['text']()[_0x51ff40(0xbd)](/```json|```/g,'')[_0x51ff40(0xb5)](),_0x1d8869=JSON[_0x51ff40(0xa3)](_0x29cb9e);return decisionCache[_0x1e78ee]={'decision':_0x1d8869,'timestamp':_0x19d464},_0x1d8869;}catch(_0x287aa5){return _0x52b2e4[_0x51ff40(0x8c)][_0x51ff40(0xa8)](_0x51ff40(0xc3)+_0x287aa5[_0x51ff40(0xe1)]),decisionCache[_0x1e78ee]={'decision':{'approved':!![],'reason':'KI-Fehler\x20(Fallback)'},'timestamp':_0x19d464-(CACHE_TTL_MS-0xea60)},{'approved':!![],'reason':'KI-Fehler\x20(Fallback)'};}}async function runGeminiAnalysis(_0x3d644f,_0x19d63a=''){const _0x59b309=a0_0x31121e;if(!_0x3d644f[_0x59b309(0x8b)])return;if(!canCallApi()){_0x3d644f[_0x59b309(0x8c)][_0x59b309(0xba)]('ðŸ¤–\x20Autopilot\x20skipped\x20(Traffic\x20Protection\x20active).');return;}if(_0x3d644f[_0x59b309(0x92)][_0x59b309(0x102)]===0x0)return;const _0x50ecbc=_0x3d644f[_0x59b309(0x92)]['slice'](0x0,0xf),_0x8b0f37=_0x3d644f[_0x59b309(0x98)],_0x294fe5=PERSONA_MAPPING[_0x3d644f[_0x59b309(0xf8)][_0x59b309(0x8d)]||_0x59b309(0x114)],_0x519e0f=_0x3d644f[_0x59b309(0xf8)][_0x59b309(0xca)]||_0x59b309(0x10c);let _0x2d73e9='Unbekannt';try{const _0x49a60c=await _0x3d644f['getStateAsync'](_0x59b309(0xdf));if(_0x49a60c&&_0x49a60c[_0x59b309(0xa7)])_0x2d73e9=_0x49a60c['val'];}catch(_0xed4754){}let _0x3c4125=![];try{const _0x31eb7c=await _0x3d644f[_0x59b309(0xa1)](_0x59b309(0xbc));if(_0x31eb7c&&_0x31eb7c[_0x59b309(0xa7)])_0x3c4125=!![];}catch(_0x211cbe){}const _0x22a856=_0x59b309(0x105)+_0x294fe5+_0x59b309(0xaf)+_0x519e0f+'.\x20SYSTEM_MODE:\x20'+_0x8b0f37+'.\x20ANWESEND:\x20'+_0x2d73e9+_0x59b309(0x10a)+JSON[_0x59b309(0x126)](_0x50ecbc)+_0x59b309(0xa2)+_0x19d63a+_0x59b309(0xe9);try{updateApiTimestamp();const _0x17af99=await _0x3d644f[_0x59b309(0x8b)][_0x59b309(0x103)](_0x22a856),_0x558cf2=JSON[_0x59b309(0xa3)](_0x17af99[_0x59b309(0xb2)][_0x59b309(0xb7)]()[_0x59b309(0xbd)](/```json|```/g,'')[_0x59b309(0xb5)]());await _0x3d644f[_0x59b309(0xf7)](_0x59b309(0x101),{'val':JSON[_0x59b309(0x126)](_0x558cf2),'ack':!![]});if(_0x558cf2[_0x59b309(0xbb)])await _0x3d644f[_0x59b309(0xf7)](_0x59b309(0x89),{'val':_0x558cf2[_0x59b309(0xbb)],'ack':!![]});const _0x446e4a={'timestamp':Date[_0x59b309(0xee)](),'id':Date[_0x59b309(0xee)]()[_0x59b309(0xf6)](),'analysis':{'activity':{'summary':_0x558cf2[_0x59b309(0xbb)],'isAlert':_0x558cf2[_0x59b309(0xa4)],'alertReason':_0x558cf2['alertReason']},'comfort':{'automationProposal':_0x558cf2['automationProposal']}}};_0x3d644f[_0x59b309(0x9a)][_0x59b309(0xed)](_0x446e4a);if(_0x3d644f[_0x59b309(0x9a)][_0x59b309(0x102)]>0x32)_0x3d644f[_0x59b309(0x9a)][_0x59b309(0xd7)]();await _0x3d644f[_0x59b309(0xf7)](_0x59b309(0xb3),{'val':JSON[_0x59b309(0x126)](_0x3d644f['analysisHistory']),'ack':!![]});const _0x2df48b=_0x558cf2[_0x59b309(0xa4)]||![];_0x2df48b!==_0x3d644f[_0x59b309(0xb1)]&&(await _0x3d644f[_0x59b309(0xf7)](_0x59b309(0xc9),{'val':_0x2df48b,'ack':!![]}),_0x3d644f['lastAlertState']=_0x2df48b,_0x2df48b&&(await _0x3d644f[_0x59b309(0xf7)](_0x59b309(0x11d),{'val':_0x558cf2['alertReason'],'ack':!![]}),setup[_0x59b309(0xfd)](_0x3d644f,_0x59b309(0xd3)+_0x558cf2[_0x59b309(0x125)],![],_0x558cf2['isEmergency'])));if(_0x558cf2[_0x59b309(0x106)]&&_0x558cf2['automationProposal'][_0x59b309(0xb0)]){await _0x3d644f['setStateAsync'](_0x59b309(0x11c),{'val':!![],'ack':!![]}),await _0x3d644f[_0x59b309(0xf7)](_0x59b309(0xff),{'val':_0x558cf2[_0x59b309(0x106)][_0x59b309(0x120)],'ack':!![]}),await _0x3d644f[_0x59b309(0xf7)]('analysis.automation.targetId',{'val':_0x558cf2['automationProposal'][_0x59b309(0xc0)],'ack':!![]}),await _0x3d644f[_0x59b309(0xf7)](_0x59b309(0xd1),{'val':JSON[_0x59b309(0x126)](_0x558cf2[_0x59b309(0x106)][_0x59b309(0x104)]),'ack':!![]});if(_0x3c4125)executeAutomationAction(_0x3d644f);}}catch(_0x5c8d10){_0x3d644f[_0x59b309(0x8c)]['error'](_0x59b309(0xa0)+_0x5c8d10[_0x59b309(0xe1)]);}}async function createDailyDigest(_0x1df175,_0x12603e){const _0x28ba54=a0_0x31121e;if(!_0x1df175['isProVersion'])return;if(!canCallApi()){await _0x1df175[_0x28ba54(0xf7)](LTM_DP_STATUS,{'val':_0x28ba54(0x91),'ack':!![]});return;}await _0x1df175[_0x28ba54(0xf7)](LTM_DP_STATUS,{'val':_0x28ba54(0x123),'ack':!![]});if(!_0x1df175[_0x28ba54(0x8b)]||_0x1df175[_0x28ba54(0xf5)][_0x28ba54(0x102)]<LTM_MIN_EVENTS_FOR_COMPRESSION){await _0x1df175['setStateAsync'](LTM_DP_STATUS,{'val':_0x28ba54(0x9c),'ack':!![]});return;}const _0x41f699=JSON[_0x28ba54(0xa3)](JSON[_0x28ba54(0x126)](_0x1df175[_0x28ba54(0xf5)])),_0x16a25d=_0x41f699[_0x28ba54(0x102)],_0x1eaff1='ROLLE:\x20Data\x20Compression\x20Agent.\x20SPRACHE:\x20DE.\x20FORMAT:\x20JSON.\x20ANWEISUNG:\x20Fasse\x20Sensor-Events\x20zusammen.\x20SCHEMA:\x20{\x20\x22summary\x22:\x20\x22string\x22,\x20\x22activityLevel\x22:\x20\x22string\x22\x20}\x20\x0a\x0aEVENTS:\x0a'+JSON[_0x28ba54(0x126)](_0x41f699);try{updateApiTimestamp();const _0x574ab4=await _0x1df175[_0x28ba54(0x8b)]['generateContent'](_0x1eaff1),_0x28af63=JSON[_0x28ba54(0xa3)](_0x574ab4[_0x28ba54(0xb2)][_0x28ba54(0xb7)]()[_0x28ba54(0xbd)](/```json|```/g,'')['trim']()),_0x5743d4={'timestamp':new Date()[_0x28ba54(0xe4)](),'eventCount':_0x16a25d,'summary':_0x28af63['summary']||'Digest','activityLevel':_0x28af63[_0x28ba54(0xdb)]||_0x28ba54(0xdc),'systemMode':_0x1df175['currentSystemMode']};_0x1df175[_0x28ba54(0x9e)][_0x28ba54(0x122)](_0x5743d4);const _0xd50570=_0x1df175[_0x28ba54(0xf8)][_0x28ba54(0x10b)]||0x3c;_0x1df175[_0x28ba54(0x9e)]['length']>_0xd50570&&_0x1df175[_0x28ba54(0x9e)][_0x28ba54(0x116)](0x0,_0x1df175[_0x28ba54(0x9e)][_0x28ba54(0x102)]-_0xd50570);await _0x1df175[_0x28ba54(0xf7)](LTM_DP_DAILY_DIGESTS,{'val':JSON['stringify'](_0x1df175['dailyDigests']),'ack':!![]}),_0x1df175['rawEventLog']=[],await _0x1df175[_0x28ba54(0xf7)](LTM_DP_RAW_LOG,{'val':JSON[_0x28ba54(0x126)](_0x1df175[_0x28ba54(0xf5)]),'ack':!![]}),await _0x1df175['setStateAsync'](LTM_DP_STATUS,{'val':_0x28ba54(0xad),'ack':!![]});const _0xfb1f08=_0x28ba54(0xfc)+_0x28af63['summary']+'\x0aAktivitÃ¤t:\x20'+_0x28af63[_0x28ba54(0xdb)];setup['sendNotification'](_0x1df175,_0xfb1f08,![],![]);if(_0x1df175[_0x28ba54(0xc4)]&&_0x12603e)_0x12603e[_0x28ba54(0x9b)](_0x1df175,_0x28ba54(0x117),{'digest':_0x5743d4});}catch(_0x219675){_0x1df175[_0x28ba54(0x8c)][_0x28ba54(0xc6)](_0x219675[_0x28ba54(0xe1)]);}}async function runBaselineDriftAnalysis(_0x535995){const _0x5c1c96=a0_0x31121e;if(!_0x535995[_0x5c1c96(0xc4)]||!_0x535995[_0x5c1c96(0x8b)])return;if(!canCallApi())return;const _0x489f1f=_0x535995[_0x5c1c96(0xf8)]['ltmStbWindowDays']||0xe;if(_0x535995['dailyDigests']['length']<_0x489f1f+0x7){await _0x535995[_0x5c1c96(0xf7)](_0x5c1c96(0xbf),{'val':_0x5c1c96(0xe6),'ack':!![]});return;}const _0x3faf64=_0x535995[_0x5c1c96(0x9e)][_0x5c1c96(0xd4)](-_0x489f1f),_0x6a309d=_0x535995['dailyDigests'][_0x5c1c96(0xd4)](0x0,_0x535995[_0x5c1c96(0x9e)][_0x5c1c96(0x102)]-_0x489f1f),_0x3eebe2=_0x5c1c96(0x87)+JSON['stringify'](_0x6a309d)+_0x5c1c96(0xd6)+JSON['stringify'](_0x3faf64);try{updateApiTimestamp();const _0x1d2342=await _0x535995[_0x5c1c96(0x8b)][_0x5c1c96(0x103)](_0x3eebe2),_0x2a6e18=JSON[_0x5c1c96(0xa3)](_0x1d2342[_0x5c1c96(0xb2)][_0x5c1c96(0xb7)]()[_0x5c1c96(0xbd)](/```json|```/g,'')[_0x5c1c96(0xb5)]());_0x2a6e18[_0x5c1c96(0x107)]&&(await _0x535995[_0x5c1c96(0xf7)](_0x5c1c96(0xbf),{'val':_0x2a6e18[_0x5c1c96(0x107)],'ack':!![]}),await _0x535995[_0x5c1c96(0xf7)](_0x5c1c96(0x121),{'val':_0x2a6e18[_0x5c1c96(0x11a)],'ack':!![]}),await _0x535995[_0x5c1c96(0xf7)]('LTM.driftAnalysis.lastCheck',{'val':Date[_0x5c1c96(0xee)](),'ack':!![]}));}catch(_0x14bada){}}async function executeAutomationAction(_0x3cc58a){const _0x198b5e=a0_0x31121e;try{const _0x33d5b6=await _0x3cc58a['getStateAsync']('analysis.automation.targetId'),_0x37290e=await _0x3cc58a[_0x198b5e(0xa1)]('analysis.automation.targetValue');if(_0x33d5b6&&_0x33d5b6[_0x198b5e(0xa7)]&&_0x37290e){const _0xe5531b=_0x33d5b6[_0x198b5e(0xa7)];let _0x24226=_0x37290e[_0x198b5e(0xa7)];try{_0x24226=JSON['parse'](_0x24226);}catch(_0x3401e6){}_0x3cc58a[_0x198b5e(0x8c)][_0x198b5e(0xa9)](_0x198b5e(0xfe)+_0xe5531b+_0x198b5e(0xef)+_0x24226),await _0x3cc58a[_0x198b5e(0x10e)](_0xe5531b,_0x24226);}else _0x3cc58a[_0x198b5e(0x8c)][_0x198b5e(0xa8)]('ðŸ¤–\x20BUTLER:\x20No\x20valid\x20target\x20ID\x20or\x20value\x20stored\x20for\x20execution.');}catch(_0x3f5dd1){_0x3cc58a[_0x198b5e(0x8c)]['error']('BUTLER\x20Execution\x20Error:\x20'+_0x3f5dd1[_0x198b5e(0xe1)]);}}async function sendMorningBriefing(_0x4dedb3){const _0x43678e=a0_0x31121e;if(!_0x4dedb3[_0x43678e(0x8b)]){_0x4dedb3[_0x43678e(0x8c)]['warn'](_0x43678e(0xa5));return;}_0x4dedb3[_0x43678e(0x8c)][_0x43678e(0xa9)](_0x43678e(0xe2));try{updateApiTimestamp();const _0x2b7e2c=_0x43678e(0x99),_0x75e1a3=await _0x4dedb3[_0x43678e(0x8b)]['generateContent'](_0x2b7e2c),_0x2e5fbb=_0x75e1a3[_0x43678e(0xb2)][_0x43678e(0xb7)]();_0x4dedb3['log']['info'](_0x43678e(0x108)+_0x2e5fbb[_0x43678e(0x102)]+').\x20Sending\x20notification...'),setup[_0x43678e(0xfd)](_0x4dedb3,_0x43678e(0xf1)+_0x2e5fbb);}catch(_0x49d44f){_0x4dedb3[_0x43678e(0x8c)]['error'](_0x43678e(0xd8)+_0x49d44f[_0x43678e(0xe1)]);}}async function generateHealthReport(_0x169125,_0x37d6b6){const _0x2da8c3=a0_0x31121e;if(!_0x169125[_0x2da8c3(0x8b)])return;const _0xd0e756=Date['now']();_0xd0e756-lastGlobalApiCall<0xbb8&&(_0x169125[_0x2da8c3(0x8c)][_0x2da8c3(0xba)]('ðŸ¤–\x20API\x20Cooldown.\x20Waiting\x202s...'),await new Promise(_0x56b218=>setTimeout(_0x56b218,0x7d0)));const _0x5a6637=new Date();let _0x5b725a=0x0,_0x53c8a5=_0x5a6637[_0x2da8c3(0xc1)](),_0x3d4cd6='';if(_0x37d6b6==='NIGHT'){const _0x445fdb=new Date(_0x5a6637);_0x445fdb[_0x2da8c3(0xf0)](_0x445fdb[_0x2da8c3(0xc7)]()-0x1),_0x445fdb[_0x2da8c3(0x8a)](0x16,0x0,0x0,0x0),_0x5b725a=_0x445fdb[_0x2da8c3(0xc1)]();const _0x2f6161=new Date(_0x5a6637);_0x2f6161[_0x2da8c3(0x8a)](0x8,0x0,0x0,0x0),_0x53c8a5=_0x2f6161[_0x2da8c3(0xc1)](),_0x3d4cd6=_0x2da8c3(0xaa);}else{const _0x5dfdea=new Date(_0x5a6637);_0x5dfdea[_0x2da8c3(0x8a)](0x8,0x0,0x0,0x0),_0x5b725a=_0x5dfdea[_0x2da8c3(0xc1)](),_0x3d4cd6=_0x2da8c3(0x9f);}const _0x12e718=_0x169125[_0x2da8c3(0x92)][_0x2da8c3(0xf2)](_0x2e5edf=>_0x2e5edf[_0x2da8c3(0xfa)]>=_0x5b725a&&_0x2e5edf[_0x2da8c3(0xfa)]<=_0x53c8a5);if(_0x12e718[_0x2da8c3(0x102)]===0x0){const _0x7052c=_0x37d6b6===_0x2da8c3(0xce)?_0x2da8c3(0x11f):'Bisher\x20keine\x20AktivitÃ¤t\x20seit\x2008:00\x20Uhr\x20verzeichnet.',_0x186a4d=_0x37d6b6===_0x2da8c3(0xce)?_0x2da8c3(0xa6):_0x2da8c3(0xea);await _0x169125['setStateAsync'](_0x186a4d,{'val':_0x7052c,'ack':!![]});return;}const _0x2a20c8=_0x12e718[_0x2da8c3(0x109)](_0x157bb2=>new Date(_0x157bb2[_0x2da8c3(0xfa)])[_0x2da8c3(0x94)]([],{'hour':_0x2da8c3(0xac),'minute':_0x2da8c3(0xac)})+'\x20'+_0x157bb2[_0x2da8c3(0x9d)]+'\x20('+_0x157bb2['value']+')')[_0x2da8c3(0x110)]('\x0a'),_0x21486a=_0x2da8c3(0x93)+_0x3d4cd6+_0x2da8c3(0xe5)+_0x2a20c8+_0x2da8c3(0x11b);try{updateApiTimestamp();const _0x2f6e8e=await _0x169125[_0x2da8c3(0x8b)]['generateContent'](_0x21486a),_0x3fe616=_0x2f6e8e[_0x2da8c3(0xb2)]['text'](),_0x2c5299=_0x37d6b6==='NIGHT'?_0x2da8c3(0xa6):_0x2da8c3(0xea);await _0x169125[_0x2da8c3(0xf7)](_0x2c5299,{'val':_0x3fe616,'ack':!![]}),_0x169125[_0x2da8c3(0x8c)]['info']('ðŸ¤–\x20Health\x20Report\x20('+_0x37d6b6+_0x2da8c3(0x90));}catch(_0x1c2ee6){_0x169125[_0x2da8c3(0x8c)][_0x2da8c3(0xc6)]('Health\x20Report\x20Error:\x20'+_0x1c2ee6[_0x2da8c3(0xe1)]);}}module[a0_0x31121e(0x111)]={'executeAutomationAction':executeAutomationAction,'createDailyDigest':createDailyDigest,'runBaselineDriftAnalysis':runBaselineDriftAnalysis,'sendMorningBriefing':sendMorningBriefing,'runGeminiAnalysis':runGeminiAnalysis,'consultButler':consultButler,'generateHealthReport':generateHealthReport};