const a0_0x3f5b4b=a0_0x1c1b;(function(_0x19e58a,_0x446e86){const _0x1e9331=a0_0x1c1b,_0x2cf584=_0x19e58a();while(!![]){try{const _0x241d81=-parseInt(_0x1e9331(0x194))/0x1+-parseInt(_0x1e9331(0x118))/0x2*(parseInt(_0x1e9331(0x13c))/0x3)+-parseInt(_0x1e9331(0x14a))/0x4*(-parseInt(_0x1e9331(0x143))/0x5)+parseInt(_0x1e9331(0x146))/0x6*(parseInt(_0x1e9331(0x138))/0x7)+-parseInt(_0x1e9331(0x107))/0x8*(parseInt(_0x1e9331(0x12d))/0x9)+-parseInt(_0x1e9331(0x122))/0xa+-parseInt(_0x1e9331(0x195))/0xb*(-parseInt(_0x1e9331(0x191))/0xc);if(_0x241d81===_0x446e86)break;else _0x2cf584['push'](_0x2cf584['shift']());}catch(_0x233ac1){_0x2cf584['push'](_0x2cf584['shift']());}}}(a0_0x1408,0x248e8));const a0_0x2b2dd3=(function(){let _0x239391=!![];return function(_0x29347c,_0x272f88){const _0x5e9d82=_0x239391?function(){if(_0x272f88){const _0x388668=_0x272f88['apply'](_0x29347c,arguments);return _0x272f88=null,_0x388668;}}:function(){};return _0x239391=![],_0x5e9d82;};}()),a0_0x4acedc=a0_0x2b2dd3(this,function(){const _0x49b4ff=a0_0x1c1b;return a0_0x4acedc[_0x49b4ff(0x179)]()[_0x49b4ff(0xfb)](_0x49b4ff(0x10b))[_0x49b4ff(0x179)]()['constructor'](a0_0x4acedc)[_0x49b4ff(0xfb)](_0x49b4ff(0x10b));});a0_0x4acedc();'use strict';const {GoogleGenerativeAI}=require(a0_0x3f5b4b(0xfd)),setup=require('./setup'),GEMINI_MODEL=a0_0x3f5b4b(0x17d),LTM_DP_DAILY_DIGESTS=a0_0x3f5b4b(0x11a),LTM_DP_STATUS=a0_0x3f5b4b(0x124),LTM_DP_RAW_LOG='LTM.rawEventLog',LTM_MIN_EVENTS_FOR_COMPRESSION=0x5,MIN_API_GAP_MS=0x4e20;let lastGlobalApiCall=0x0;function a0_0x1c1b(_0x2b6115,_0x53063f){const _0x5351ae=a0_0x1408();return a0_0x1c1b=function(_0x4acedc,_0x2b2dd3){_0x4acedc=_0x4acedc-0xfb;let _0x14080f=_0x5351ae[_0x4acedc];return _0x14080f;},a0_0x1c1b(_0x2b6115,_0x53063f);}const decisionCache={},CACHE_TTL_MS=0xf*0x3c*0x3e8,PERSONA_MAPPING={'generic':a0_0x3f5b4b(0x141),'senior_aal':a0_0x3f5b4b(0x18d),'family':a0_0x3f5b4b(0x18e),'single_comfort':a0_0x3f5b4b(0x154),'security':a0_0x3f5b4b(0x198),'energy_saver':a0_0x3f5b4b(0x15f)};function canCallApi(){const _0x3ac3b1=a0_0x3f5b4b,_0x41653e=Date[_0x3ac3b1(0xfe)]();return _0x41653e-lastGlobalApiCall>MIN_API_GAP_MS;}function updateApiTimestamp(){const _0x498683=a0_0x3f5b4b;lastGlobalApiCall=Date[_0x498683(0xfe)]();}async function getWeatherContext(_0x5b555e){const _0x45808b=a0_0x3f5b4b;if(!_0x5b555e['config'][_0x45808b(0x18f)]||!_0x5b555e[_0x45808b(0x180)][_0x45808b(0x12b)])return _0x45808b(0x140);try{const _0x2928ee=_0x5b555e['config']['weatherInstance'];let _0x2c746e=await _0x5b555e[_0x45808b(0x113)](_0x2928ee+'.Current.Temperature');if(!_0x2c746e)_0x2c746e=await _0x5b555e[_0x45808b(0x113)](_0x2928ee+_0x45808b(0x111));let _0xcabcf4=await _0x5b555e[_0x45808b(0x113)](_0x2928ee+_0x45808b(0x15c));if(!_0xcabcf4)_0xcabcf4=await _0x5b555e['getForeignStateAsync'](_0x2928ee+_0x45808b(0x18a));let _0x516c7e=_0x45808b(0x185);const _0x1105dd=await _0x5b555e[_0x45808b(0x113)](_0x2928ee+_0x45808b(0x193));if(_0x1105dd)_0x516c7e=_0x1105dd[_0x45808b(0x18b)]?_0x45808b(0x168):_0x45808b(0x145);if(_0x2c746e&&_0xcabcf4)return _0x2c746e[_0x45808b(0x18b)]+'Â°C,\x20'+_0xcabcf4[_0x45808b(0x18b)]+',\x20LichtverhÃ¤ltnisse:\x20'+_0x516c7e;}catch(_0x4a7c10){}return'Wetterdaten\x20nicht\x20abrufbar';}async function consultButler(_0x35c476,_0x3b1208,_0x12c136,_0x4940d1){const _0x44512a=a0_0x3f5b4b;if(!_0x35c476[_0x44512a(0x17c)])return{'approved':!![],'reason':_0x44512a(0x103)};const _0x41d9b7=Date[_0x44512a(0xfe)]();if(decisionCache[_0x3b1208]&&_0x41d9b7-decisionCache[_0x3b1208][_0x44512a(0x12f)]<CACHE_TTL_MS){const _0x3ac440=decisionCache[_0x3b1208][_0x44512a(0x130)];return _0x35c476[_0x44512a(0x13a)]['debug'](_0x44512a(0x12e)+_0x3b1208+'\x20->\x20'+(_0x3ac440[_0x44512a(0x144)]?'OK':'NO')+'\x20('+_0x3ac440[_0x44512a(0x149)]+')'),_0x3ac440;}if(!canCallApi())return _0x35c476[_0x44512a(0x13a)][_0x44512a(0x16d)](_0x44512a(0x109)+_0x3b1208+_0x44512a(0x196)),{'approved':!![],'reason':_0x44512a(0x197)};const _0x1fba8e=new Date()[_0x44512a(0x127)](),_0xb3877b=await getWeatherContext(_0x35c476),_0xb1324c=PERSONA_MAPPING[_0x35c476[_0x44512a(0x180)][_0x44512a(0x132)]||_0x44512a(0x176)],_0xd7af81=_0x44512a(0x157)+_0x1fba8e+',\x20Wetter:\x20'+_0xb3877b+_0x44512a(0x128)+(_0x4940d1*0x64)[_0x44512a(0x150)](0x0)+'%)\x20nach\x20\x22'+_0x3b1208+_0x44512a(0x11c)+_0x12c136+_0x44512a(0x184)+_0xb1324c+_0x44512a(0x173);try{updateApiTimestamp();const _0x377033=await _0x35c476[_0x44512a(0x17c)][_0x44512a(0x16c)](_0xd7af81),_0x4172d1=_0x377033[_0x44512a(0x166)]['text']()[_0x44512a(0x101)](/```json|```/g,'')['trim'](),_0x5a76e7=JSON[_0x44512a(0x129)](_0x4172d1);return decisionCache[_0x3b1208]={'decision':_0x5a76e7,'timestamp':_0x41d9b7},_0x5a76e7;}catch(_0x54cc6){return _0x35c476[_0x44512a(0x13a)][_0x44512a(0x17a)](_0x44512a(0x106)+_0x54cc6[_0x44512a(0x14e)]),decisionCache[_0x3b1208]={'decision':{'approved':!![],'reason':_0x44512a(0x13f)},'timestamp':_0x41d9b7-(CACHE_TTL_MS-0xea60)},{'approved':!![],'reason':_0x44512a(0x13f)};}}async function runGeminiAnalysis(_0x40301d,_0x57717c=''){const _0x35aeda=a0_0x3f5b4b;if(!_0x40301d[_0x35aeda(0x17c)])return;if(!canCallApi()){_0x40301d[_0x35aeda(0x13a)][_0x35aeda(0x16d)]('ðŸ¤–\x20Autopilot\x20skipped\x20(Traffic\x20Protection\x20active).');return;}if(_0x40301d['eventHistory'][_0x35aeda(0x162)]===0x0)return;const _0x2e0cf9=_0x40301d[_0x35aeda(0x158)][_0x35aeda(0x174)](0x0,0xf),_0x29eb91=_0x40301d[_0x35aeda(0x14d)],_0x5176fe=PERSONA_MAPPING[_0x40301d['config'][_0x35aeda(0x132)]||_0x35aeda(0x176)],_0x4f8abe=_0x40301d[_0x35aeda(0x180)][_0x35aeda(0x178)]||_0x35aeda(0x15e);let _0x5c708f='Unbekannt';try{const _0x44a8e5=await _0x40301d[_0x35aeda(0x117)](_0x35aeda(0x182));if(_0x44a8e5&&_0x44a8e5[_0x35aeda(0x18b)])_0x5c708f=_0x44a8e5['val'];}catch(_0x21dbae){}let _0x2eb7d0=![];try{const _0x2b7340=await _0x40301d['getStateAsync'](_0x35aeda(0x137));if(_0x2b7340&&_0x2b7340[_0x35aeda(0x18b)])_0x2eb7d0=!![];}catch(_0x23a27a){}const _0x2cc3dc='ROLLE:\x20KI-Hausverwalter.\x20PERSONA:\x20'+_0x5176fe+'.\x20KONTEXT:\x20'+_0x4f8abe+_0x35aeda(0x167)+_0x29eb91+'.\x20ANWESEND:\x20'+_0x5c708f+_0x35aeda(0x135)+JSON['stringify'](_0x2e0cf9)+_0x35aeda(0x164)+_0x57717c+_0x35aeda(0x15d);try{updateApiTimestamp();const _0x58d901=await _0x40301d['geminiModel'][_0x35aeda(0x16c)](_0x2cc3dc),_0x55a693=JSON[_0x35aeda(0x129)](_0x58d901[_0x35aeda(0x166)][_0x35aeda(0x147)]()['replace'](/```json|```/g,'')['trim']());await _0x40301d['setStateAsync'](_0x35aeda(0x152),{'val':JSON['stringify'](_0x55a693),'ack':!![]});if(_0x55a693[_0x35aeda(0x19c)])await _0x40301d['setStateAsync'](_0x35aeda(0x10f),{'val':_0x55a693[_0x35aeda(0x19c)],'ack':!![]});const _0x3f312c={'timestamp':Date[_0x35aeda(0xfe)](),'id':Date[_0x35aeda(0xfe)]()[_0x35aeda(0x179)](),'analysis':{'activity':{'summary':_0x55a693[_0x35aeda(0x19c)],'isAlert':_0x55a693[_0x35aeda(0x19a)],'alertReason':_0x55a693[_0x35aeda(0x19b)]},'comfort':{'automationProposal':_0x55a693[_0x35aeda(0x163)]}}};_0x40301d[_0x35aeda(0xff)]['unshift'](_0x3f312c);if(_0x40301d[_0x35aeda(0xff)]['length']>0x32)_0x40301d[_0x35aeda(0xff)][_0x35aeda(0x16f)]();await _0x40301d[_0x35aeda(0x159)](_0x35aeda(0x115),{'val':JSON[_0x35aeda(0x10c)](_0x40301d[_0x35aeda(0xff)]),'ack':!![]});const _0x21ac68=_0x55a693[_0x35aeda(0x19a)]||![];_0x21ac68!==_0x40301d[_0x35aeda(0x121)]&&(await _0x40301d[_0x35aeda(0x159)](_0x35aeda(0x16a),{'val':_0x21ac68,'ack':!![]}),_0x40301d[_0x35aeda(0x121)]=_0x21ac68,_0x21ac68&&(await _0x40301d[_0x35aeda(0x159)](_0x35aeda(0x10d),{'val':_0x55a693[_0x35aeda(0x19b)],'ack':!![]}),setup['sendNotification'](_0x40301d,_0x35aeda(0x105)+_0x55a693['alertReason'],![],_0x55a693[_0x35aeda(0x108)])));if(_0x55a693[_0x35aeda(0x163)]&&_0x55a693['automationProposal'][_0x35aeda(0x172)]){await _0x40301d[_0x35aeda(0x159)](_0x35aeda(0x148),{'val':!![],'ack':!![]}),await _0x40301d[_0x35aeda(0x159)](_0x35aeda(0x177),{'val':_0x55a693[_0x35aeda(0x163)][_0x35aeda(0x125)],'ack':!![]}),await _0x40301d[_0x35aeda(0x159)]('analysis.automation.targetId',{'val':_0x55a693['automationProposal']['targetId'],'ack':!![]}),await _0x40301d[_0x35aeda(0x159)](_0x35aeda(0x123),{'val':JSON[_0x35aeda(0x10c)](_0x55a693['automationProposal'][_0x35aeda(0x18c)]),'ack':!![]});if(_0x2eb7d0)executeAutomationAction(_0x40301d);}}catch(_0x17e75c){_0x40301d['log'][_0x35aeda(0x112)](_0x35aeda(0x156)+_0x17e75c[_0x35aeda(0x14e)]);}}async function createDailyDigest(_0x1a174e,_0x5e0395){const _0x3edca7=a0_0x3f5b4b;if(!_0x1a174e[_0x3edca7(0x187)])return;if(!canCallApi()){await _0x1a174e[_0x3edca7(0x159)](LTM_DP_STATUS,{'val':_0x3edca7(0x102),'ack':!![]});return;}await _0x1a174e[_0x3edca7(0x159)](LTM_DP_STATUS,{'val':_0x3edca7(0x126),'ack':!![]});if(!_0x1a174e[_0x3edca7(0x17c)]||_0x1a174e[_0x3edca7(0x11e)][_0x3edca7(0x162)]<LTM_MIN_EVENTS_FOR_COMPRESSION){await _0x1a174e[_0x3edca7(0x159)](LTM_DP_STATUS,{'val':_0x3edca7(0x186),'ack':!![]});return;}const _0x3ce56a=JSON[_0x3edca7(0x129)](JSON['stringify'](_0x1a174e[_0x3edca7(0x11e)])),_0x2ec512=_0x3ce56a['length'],_0x56c6c8=_0x3edca7(0x133)+JSON[_0x3edca7(0x10c)](_0x3ce56a);try{updateApiTimestamp();const _0x22baf5=await _0x1a174e[_0x3edca7(0x17c)][_0x3edca7(0x16c)](_0x56c6c8),_0x367d65=JSON[_0x3edca7(0x129)](_0x22baf5[_0x3edca7(0x166)][_0x3edca7(0x147)]()[_0x3edca7(0x101)](/```json|```/g,'')[_0x3edca7(0x139)]()),_0x8ae82b={'timestamp':new Date()[_0x3edca7(0x165)](),'eventCount':_0x2ec512,'summary':_0x367d65[_0x3edca7(0x19c)]||_0x3edca7(0x16e),'activityLevel':_0x367d65[_0x3edca7(0x189)]||_0x3edca7(0x13b),'systemMode':_0x1a174e[_0x3edca7(0x14d)]};_0x1a174e['dailyDigests']['push'](_0x8ae82b);const _0xa217b4=_0x1a174e[_0x3edca7(0x180)][_0x3edca7(0x171)]||0x3c;_0x1a174e[_0x3edca7(0x11d)]['length']>_0xa217b4&&_0x1a174e[_0x3edca7(0x11d)][_0x3edca7(0x13d)](0x0,_0x1a174e[_0x3edca7(0x11d)][_0x3edca7(0x162)]-_0xa217b4);await _0x1a174e[_0x3edca7(0x159)](LTM_DP_DAILY_DIGESTS,{'val':JSON[_0x3edca7(0x10c)](_0x1a174e[_0x3edca7(0x11d)]),'ack':!![]}),_0x1a174e['rawEventLog']=[],await _0x1a174e[_0x3edca7(0x159)](LTM_DP_RAW_LOG,{'val':JSON[_0x3edca7(0x10c)](_0x1a174e[_0x3edca7(0x11e)]),'ack':!![]}),await _0x1a174e[_0x3edca7(0x159)](LTM_DP_STATUS,{'val':'Success','ack':!![]});const _0xb22ed2='ðŸ“…\x20Daily\x20Digest:\x0a'+_0x367d65[_0x3edca7(0x19c)]+'\x0aAktivitÃ¤t:\x20'+_0x367d65['activityLevel'];setup['sendNotification'](_0x1a174e,_0xb22ed2,![],![]);if(_0x1a174e[_0x3edca7(0x187)]&&_0x5e0395)_0x5e0395['send'](_0x1a174e,_0x3edca7(0x183),{'digest':_0x8ae82b});}catch(_0x4c8927){_0x1a174e[_0x3edca7(0x13a)][_0x3edca7(0x112)](_0x4c8927['message']);}}function a0_0x1408(){const _0x36d8a7=['setHours','replace','Skipped\x20(Traffic)','KI\x20offline\x20(Fallback)','\x0a\x20\x20\x20\x20ROLLE:\x20Medizinischer\x20Assistent\x20fÃ¼r\x20AAL\x20(Ambient\x20Assisted\x20Living).\x0a\x20\x20\x20\x20AUFGABE:\x20','âš ï¸\x20ALARM:\x20','ðŸ¤–\x20Butler\x20Brain\x20Error:\x20','224pPkhNJ','isEmergency','ðŸ¤–\x20Traffic\x20Schutz:\x20Anfrage\x20fÃ¼r\x20','join','(((.+)+)+)+$','stringify','analysis.alertReason','Bisher\x20keine\x20AktivitÃ¤t\x20seit\x2008:00\x20Uhr\x20verzeichnet.','analysis.activitySummary','analysis.health.geminiNight','.forecast.current.temperature','error','getForeignStateAsync','\x0a\x20\x20\x20\x20ANTWORT-STIL:\x20Sachlich,\x20beruhigend,\x20prÃ¤zise.\x20Keine\x20Floskeln.\x0a\x20\x20\x20\x20','analysis.analysisHistory','\x0a\x20\x20\x20\x20EVENTS:\x0a','getStateAsync','28CxIsSU','ROLLE:\x20Data\x20Scientist.\x20ZIEL:\x20Drift\x20erkennen.\x20SCHEMA:\x20{\x20\x22baselineDrift\x22:\x20\x22none|slight|significant|critical\x22,\x20\x22driftDetails\x22:\x20\x22string\x22\x20}\x0a\x0aLTB:\x20','LTM.dailyDigests','info','\x22.\x0a\x20\x20\x20\x20AKTION:\x20Schalte\x20\x22','dailyDigests','rawEventLog','driftDetails','N/A\x20(Learning)','lastAlertState','1584500GGkQlQ','analysis.automation.targetValue','LTM.processingStatus','description','Started...','toLocaleTimeString','.\x0a\x20\x20\x20\x20EVENT:\x20Bewohner\x20geht\x20wahrscheinlich\x20(','parse','ðŸŒ…\x20Morning\x20Briefing:\x0a','weatherInstance','name','53181DGUWjf','ðŸ¤–\x20Butler\x20Cache\x20Hit:\x20','timestamp','decision','NIGHT','aiPersona','ROLLE:\x20Data\x20Compression\x20Agent.\x20SPRACHE:\x20DE.\x20FORMAT:\x20JSON.\x20ANWEISUNG:\x20Fasse\x20Sensor-Events\x20zusammen.\x20SCHEMA:\x20{\x20\x22summary\x22:\x20\x22string\x22,\x20\x22activityLevel\x22:\x20\x22string\x22\x20}\x20\x0a\x0aEVENTS:\x0a','ðŸ¤–\x20API\x20Cooldown.\x20Waiting\x202s...','.\x20EVENTS:\x20','ðŸ¤–\x20BUTLER:\x20Executing\x20Action\x20->\x20','analysis.automation.autoApply','1715KnHqAj','trim','log','normal','24789WITkAP','splice','filter','KI-Fehler\x20(Fallback)','Unbekannt\x20(Kein\x20Sensor)','Entscheide\x20ausgewogen\x20zwischen\x20Komfort\x20und\x20Energie.','LTM.driftAnalysis.driftDetails','5QxyeLJ','approved','Tag','6204xpTbev','text','analysis.automation.patternDetected','reason','26188qdSayx','analysis.automation.targetId','Health\x20Report\x20Error:\x20','currentSystemMode','message','\x0aSTB:\x20','toFixed','LTM.driftAnalysis.baselineDrift','analysis.lastResult','Erstelle\x20ein\x20kurzes\x20\x27Guten\x20Morgen\x27\x20Briefing\x20basierend\x20auf\x20den\x20Events\x20der\x20letzten\x20Nacht.','Maximaler\x20Komfort,\x20Energie\x20ist\x20zweitrangig.','analysis.health.geminiDay','Gemini\x20Error:\x20','\x0a\x20\x20\x20\x20ROLLE:\x20Haus-Butler.\x0a\x20\x20\x20\x20SITUATION:\x20','eventHistory','setStateAsync','Analysiere\x20diese\x20Events\x20der\x20NACHT\x20(22:00-08:00).\x20War\x20der\x20Schlaf\x20ruhig?\x20Gab\x20es\x20BadgÃ¤nge?\x20Antwort\x20kurz\x20fÃ¼r\x20den\x20besorgten\x20Sohn\x20(max\x202\x20SÃ¤tze).','baselineDrift','.Current.WeatherText','.\x20AUFGABE:\x201.\x20Gesundheit?\x202.\x20Komfort?\x20FORMAT\x20(JSON):\x20{\x20\x22isAlert\x22:\x20boolean,\x20\x22alertReason\x22:\x20\x22string\x22,\x20\x22isEmergency\x22:\x20boolean,\x20\x22summary\x22:\x20\x22string\x22,\x20\x22automationProposal\x22:\x20{\x20\x22detected\x22:\x20boolean,\x20\x22description\x22:\x20\x22string\x22,\x20\x22targetId\x22:\x20\x22string\x22,\x20\x22targetValue\x22:\x20\x22any\x22\x20}\x20}','Keine\x20Details.','PRIORITÃ„T:\x20Energie\x20sparen.\x20Schalte\x20nur,\x20wenn\x20absolut\x20notwendig\x20(Dunkelheit).','getDate','ðŸ¤–\x20Morning\x20Briefing\x20skipped:\x20No\x20Gemini\x20Model.','length','automationProposal','.\x20EMERGENCY:\x20','toISOString','response','.\x20SYSTEM_MODE:\x20','Nacht','\x20=\x20','analysis.isAlert',')\x20generated.','generateContent','debug','Digest','pop','2-digit','ltmLtbWindowDays','detected','\x0a\x20\x20\x20\x20FRAGE:\x20Ist\x20es\x20dunkel\x20genug\x20fÃ¼r\x20Licht?\x0a\x20\x20\x20\x20FORMAT:\x20{\x20\x22approved\x22:\x20boolean,\x20\x22reason\x22:\x20\x22kurzer\x20Grund\x22\x20}\x0a\x20\x20\x20\x20','slice','ltmStbWindowDays','generic','analysis.automation.description','livingContext','toString','warn','ðŸŒ…\x20Starting\x20Morning\x20Briefing\x20sequence\x20(Traffic\x20Check\x20bypassed)...','geminiModel','models/gemini-flash-latest','exports','value','config','BUTLER\x20Execution\x20Error:\x20','system.presenceWho','ANALYZE_HEALTH','\x22\x20AN.\x0a\x20\x20\x20\x20STRATEGIE:\x20','Unbekannt','Skipped\x20(No\x20AI\x20or\x20Data)','isProVersion','map','activityLevel','.forecast.current.state','val','targetValue','PRIORITÃ„T:\x20Sicherheit\x20und\x20Licht.\x20Schalte\x20lieber\x20einmal\x20zu\x20viel\x20als\x20zu\x20wenig.','Fokus\x20auf\x20Komfort\x20fÃ¼r\x20die\x20Familie.','useWeather','setDate','11880GOiOct','ðŸ¤–\x20BUTLER:\x20No\x20valid\x20target\x20ID\x20or\x20value\x20stored\x20for\x20execution.','.Current.IsNight','172487inQWAV','5577RQTLrC','\x20Ã¼bersprungen\x20(Auto-Approved).','Traffic-Schutz\x20(Auto-Approved)','Sicherheit\x20geht\x20vor.','Keine\x20Daten\x20fÃ¼r\x20die\x20Nacht\x20aufgezeichnet\x20(Sensoren\x20ruhig).','isAlert','alertReason','summary','getTime','search',').\x20Sending\x20notification...','@google/generative-ai','now','analysisHistory'];a0_0x1408=function(){return _0x36d8a7;};return a0_0x1408();}async function runBaselineDriftAnalysis(_0x156e2f){const _0x5c3b6d=a0_0x3f5b4b;if(!_0x156e2f[_0x5c3b6d(0x187)]||!_0x156e2f[_0x5c3b6d(0x17c)])return;if(!canCallApi())return;const _0x255aec=_0x156e2f[_0x5c3b6d(0x180)][_0x5c3b6d(0x175)]||0xe;if(_0x156e2f['dailyDigests']['length']<_0x255aec+0x7){await _0x156e2f[_0x5c3b6d(0x159)](_0x5c3b6d(0x151),{'val':_0x5c3b6d(0x120),'ack':!![]});return;}const _0x1c7e44=_0x156e2f['dailyDigests'][_0x5c3b6d(0x174)](-_0x255aec),_0x525267=_0x156e2f[_0x5c3b6d(0x11d)]['slice'](0x0,_0x156e2f['dailyDigests'][_0x5c3b6d(0x162)]-_0x255aec),_0x2027a0=_0x5c3b6d(0x119)+JSON[_0x5c3b6d(0x10c)](_0x525267)+_0x5c3b6d(0x14f)+JSON[_0x5c3b6d(0x10c)](_0x1c7e44);try{updateApiTimestamp();const _0x4f841c=await _0x156e2f[_0x5c3b6d(0x17c)][_0x5c3b6d(0x16c)](_0x2027a0),_0x4f7e93=JSON['parse'](_0x4f841c[_0x5c3b6d(0x166)][_0x5c3b6d(0x147)]()[_0x5c3b6d(0x101)](/```json|```/g,'')[_0x5c3b6d(0x139)]());_0x4f7e93['baselineDrift']&&(await _0x156e2f[_0x5c3b6d(0x159)](_0x5c3b6d(0x151),{'val':_0x4f7e93[_0x5c3b6d(0x15b)],'ack':!![]}),await _0x156e2f[_0x5c3b6d(0x159)](_0x5c3b6d(0x142),{'val':_0x4f7e93[_0x5c3b6d(0x11f)],'ack':!![]}),await _0x156e2f[_0x5c3b6d(0x159)]('LTM.driftAnalysis.lastCheck',{'val':Date[_0x5c3b6d(0xfe)](),'ack':!![]}));}catch(_0x570085){}}async function executeAutomationAction(_0x49c425){const _0x59ef5c=a0_0x3f5b4b;try{const _0x6e6a2d=await _0x49c425[_0x59ef5c(0x117)](_0x59ef5c(0x14b)),_0x5258af=await _0x49c425['getStateAsync']('analysis.automation.targetValue');if(_0x6e6a2d&&_0x6e6a2d[_0x59ef5c(0x18b)]&&_0x5258af){const _0x37b8ec=_0x6e6a2d[_0x59ef5c(0x18b)];let _0xa51233=_0x5258af[_0x59ef5c(0x18b)];try{_0xa51233=JSON['parse'](_0xa51233);}catch(_0x2bfdb8){}_0x49c425[_0x59ef5c(0x13a)][_0x59ef5c(0x11b)](_0x59ef5c(0x136)+_0x37b8ec+_0x59ef5c(0x169)+_0xa51233),await _0x49c425['setForeignStateAsync'](_0x37b8ec,_0xa51233);}else _0x49c425[_0x59ef5c(0x13a)][_0x59ef5c(0x17a)](_0x59ef5c(0x192));}catch(_0xe000a8){_0x49c425[_0x59ef5c(0x13a)][_0x59ef5c(0x112)](_0x59ef5c(0x181)+_0xe000a8['message']);}}async function sendMorningBriefing(_0x25ed64){const _0x3c5348=a0_0x3f5b4b;if(!_0x25ed64[_0x3c5348(0x17c)]){_0x25ed64[_0x3c5348(0x13a)]['warn'](_0x3c5348(0x161));return;}_0x25ed64[_0x3c5348(0x13a)][_0x3c5348(0x11b)](_0x3c5348(0x17b));try{updateApiTimestamp();const _0x46e5e6=_0x3c5348(0x153),_0x3ea439=await _0x25ed64['geminiModel'][_0x3c5348(0x16c)](_0x46e5e6),_0x320d50=_0x3ea439['response']['text']();_0x25ed64[_0x3c5348(0x13a)][_0x3c5348(0x11b)]('ðŸŒ…\x20Briefing\x20generated\x20(Length:\x20'+_0x320d50[_0x3c5348(0x162)]+_0x3c5348(0xfc)),setup['sendNotification'](_0x25ed64,_0x3c5348(0x12a)+_0x320d50);}catch(_0x2a0344){_0x25ed64['log'][_0x3c5348(0x112)]('Briefing\x20Error:\x20'+_0x2a0344[_0x3c5348(0x14e)]);}}async function generateHealthReport(_0x24b368,_0x3a7ad1){const _0x579547=a0_0x3f5b4b;if(!_0x24b368[_0x579547(0x17c)])return;const _0x6dddc2=Date[_0x579547(0xfe)]();_0x6dddc2-lastGlobalApiCall<0xbb8&&(_0x24b368[_0x579547(0x13a)]['debug'](_0x579547(0x134)),await new Promise(_0x269eea=>setTimeout(_0x269eea,0x7d0)));const _0x2d9856=new Date();let _0x48ee30=0x0,_0xa7e3ab=_0x2d9856[_0x579547(0x19d)](),_0x556789='';if(_0x3a7ad1===_0x579547(0x131)){const _0x21e5eb=new Date(_0x2d9856);_0x21e5eb[_0x579547(0x190)](_0x21e5eb[_0x579547(0x160)]()-0x1),_0x21e5eb[_0x579547(0x100)](0x16,0x0,0x0,0x0),_0x48ee30=_0x21e5eb[_0x579547(0x19d)]();const _0x34ae1f=new Date(_0x2d9856);_0x34ae1f[_0x579547(0x100)](0x8,0x0,0x0,0x0),_0xa7e3ab=_0x34ae1f[_0x579547(0x19d)](),_0x556789=_0x579547(0x15a);}else{const _0x1b9e3f=new Date(_0x2d9856);_0x1b9e3f[_0x579547(0x100)](0x8,0x0,0x0,0x0),_0x48ee30=_0x1b9e3f[_0x579547(0x19d)](),_0x556789='Analysiere\x20diese\x20Events\x20des\x20TAGES\x20(08:00-Jetzt).\x20AktivitÃ¤t?\x20Mahlzeiten?\x20HaustÃ¼r?\x20Antwort\x20kurz\x20fÃ¼r\x20den\x20besorgten\x20Sohn\x20(max\x202\x20SÃ¤tze).';}const _0x1a1a7c=_0x24b368[_0x579547(0x158)][_0x579547(0x13e)](_0x14563d=>_0x14563d['timestamp']>=_0x48ee30&&_0x14563d[_0x579547(0x12f)]<=_0xa7e3ab);if(_0x1a1a7c['length']===0x0){const _0x545195=_0x3a7ad1==='NIGHT'?_0x579547(0x199):_0x579547(0x10e),_0xbc30b0=_0x3a7ad1===_0x579547(0x131)?_0x579547(0x110):_0x579547(0x155);await _0x24b368['setStateAsync'](_0xbc30b0,{'val':_0x545195,'ack':!![]});return;}const _0x263599=_0x1a1a7c[_0x579547(0x188)](_0x56ed42=>new Date(_0x56ed42[_0x579547(0x12f)])[_0x579547(0x127)]([],{'hour':_0x579547(0x170),'minute':_0x579547(0x170)})+'\x20'+_0x56ed42[_0x579547(0x12c)]+'\x20('+_0x56ed42[_0x579547(0x17f)]+')')[_0x579547(0x10a)]('\x0a'),_0x3c35b6=_0x579547(0x104)+_0x556789+_0x579547(0x116)+_0x263599+_0x579547(0x114);try{updateApiTimestamp();const _0x598cbc=await _0x24b368[_0x579547(0x17c)][_0x579547(0x16c)](_0x3c35b6),_0x406384=_0x598cbc[_0x579547(0x166)][_0x579547(0x147)](),_0x4529d2=_0x3a7ad1===_0x579547(0x131)?'analysis.health.geminiNight':_0x579547(0x155);await _0x24b368['setStateAsync'](_0x4529d2,{'val':_0x406384,'ack':!![]}),_0x24b368['log'][_0x579547(0x11b)]('ðŸ¤–\x20Health\x20Report\x20('+_0x3a7ad1+_0x579547(0x16b));}catch(_0x166665){_0x24b368['log'][_0x579547(0x112)](_0x579547(0x14c)+_0x166665[_0x579547(0x14e)]);}}module[a0_0x3f5b4b(0x17e)]={'executeAutomationAction':executeAutomationAction,'createDailyDigest':createDailyDigest,'runBaselineDriftAnalysis':runBaselineDriftAnalysis,'sendMorningBriefing':sendMorningBriefing,'runGeminiAnalysis':runGeminiAnalysis,'consultButler':consultButler,'generateHealthReport':generateHealthReport};