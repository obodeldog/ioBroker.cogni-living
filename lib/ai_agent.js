const a0_0x7a9e0f=a0_0x2f2e;(function(_0x47f216,_0x61f77a){const _0x3fb4bb=a0_0x2f2e,_0x17134d=_0x47f216();while(!![]){try{const _0x2cce20=-parseInt(_0x3fb4bb(0x122))/0x1*(-parseInt(_0x3fb4bb(0x140))/0x2)+parseInt(_0x3fb4bb(0xf4))/0x3+-parseInt(_0x3fb4bb(0x12e))/0x4+-parseInt(_0x3fb4bb(0x116))/0x5*(parseInt(_0x3fb4bb(0x105))/0x6)+parseInt(_0x3fb4bb(0x14b))/0x7*(parseInt(_0x3fb4bb(0x141))/0x8)+-parseInt(_0x3fb4bb(0x119))/0x9*(parseInt(_0x3fb4bb(0xe0))/0xa)+-parseInt(_0x3fb4bb(0x117))/0xb;if(_0x2cce20===_0x61f77a)break;else _0x17134d['push'](_0x17134d['shift']());}catch(_0x541a8f){_0x17134d['push'](_0x17134d['shift']());}}}(a0_0x1808,0x83431));const a0_0x350037=(function(){let _0x45cd2f=!![];return function(_0x46c352,_0x569595){const _0x635aeb=_0x45cd2f?function(){const _0x2f8373=a0_0x2f2e;if(_0x569595){const _0x296b4b=_0x569595[_0x2f8373(0xe9)](_0x46c352,arguments);return _0x569595=null,_0x296b4b;}}:function(){};return _0x45cd2f=![],_0x635aeb;};}()),a0_0xcf288a=a0_0x350037(this,function(){const _0x2a9a32=a0_0x2f2e;return a0_0xcf288a[_0x2a9a32(0x11e)]()[_0x2a9a32(0x129)](_0x2a9a32(0x11b))[_0x2a9a32(0x11e)]()[_0x2a9a32(0x16a)](a0_0xcf288a)[_0x2a9a32(0x129)]('(((.+)+)+)+$');});a0_0xcf288a();function a0_0x2f2e(_0x227bda,_0x3a7933){const _0x438870=a0_0x1808();return a0_0x2f2e=function(_0xcf288a,_0x350037){_0xcf288a=_0xcf288a-0xd2;let _0x180801=_0x438870[_0xcf288a];return _0x180801;},a0_0x2f2e(_0x227bda,_0x3a7933);}'use strict';const {GoogleGenerativeAI}=require(a0_0x7a9e0f(0x12c)),setup=require('./setup'),GEMINI_MODEL=a0_0x7a9e0f(0x138),LTM_DP_DAILY_DIGESTS=a0_0x7a9e0f(0xe7),LTM_DP_STATUS=a0_0x7a9e0f(0x127),LTM_DP_RAW_LOG='LTM.rawEventLog',LTM_MIN_EVENTS_FOR_COMPRESSION=0x5,MIN_API_GAP_MS=0x4e20;let lastGlobalApiCall=0x0;const decisionCache={},CACHE_TTL_MS=0xf*0x3c*0x3e8,PERSONA_MAPPING={'generic':a0_0x7a9e0f(0xe4),'senior_aal':'PRIORITÃ„T:\x20Sicherheit\x20und\x20Licht.\x20Schalte\x20lieber\x20einmal\x20zu\x20viel\x20als\x20zu\x20wenig.','family':a0_0x7a9e0f(0x168),'single_comfort':'Maximaler\x20Komfort,\x20Energie\x20ist\x20zweitrangig.','security':a0_0x7a9e0f(0x13d),'energy_saver':a0_0x7a9e0f(0x135)};function canCallApi(){const _0x582514=a0_0x7a9e0f,_0x33fcc0=Date[_0x582514(0xfc)]();return _0x33fcc0-lastGlobalApiCall>MIN_API_GAP_MS;}function a0_0x1808(){const _0x476697=['1618767ByWzFS','Analysiere\x20diese\x20Events\x20der\x20NACHT\x20(22:00-08:00).\x20War\x20der\x20Schlaf\x20ruhig?\x20Gab\x20es\x20BadgÃ¤nge?\x20Antwort\x20kurz\x20fÃ¼r\x20den\x20besorgten\x20Sohn\x20(max\x202\x20SÃ¤tze).','rawEventLog','Erstelle\x20ein\x20kurzes\x20\x27Guten\x20Morgen\x27\x20Briefing\x20basierend\x20auf\x20den\x20Events\x20der\x20letzten\x20Nacht.','dailyDigests','.\x20AUFGABE:\x201.\x20Gesundheit?\x202.\x20Komfort?\x20FORMAT\x20(JSON):\x20{\x20\x22isAlert\x22:\x20boolean,\x20\x22alertReason\x22:\x20\x22string\x22,\x20\x22isEmergency\x22:\x20boolean,\x20\x22summary\x22:\x20\x22string\x22,\x20\x22automationProposal\x22:\x20{\x20\x22detected\x22:\x20boolean,\x20\x22description\x22:\x20\x22string\x22,\x20\x22targetId\x22:\x20\x22string\x22,\x20\x22targetValue\x22:\x20\x22any\x22\x20}\x20}','alertReason','length','now','targetId','analysis.automation.targetId','replace','Briefing\x20Error:\x20','.Current.WeatherText','analysis.automation.targetValue','ANALYZE_HEALTH','aiPersona','36474dGegZH','.\x0a\x20\x20\x20\x20EVENT:\x20Bewohner\x20geht\x20wahrscheinlich\x20(','ROLLE:\x20KI-Hausverwalter.\x20PERSONA:\x20','send','generic','info','NIGHT','LTM.driftAnalysis.baselineDrift','\x0a\x20\x20\x20\x20EVENTS:\x0a','config','lastAlertState','geminiModel','analysis.health.geminiDay','val','Unbekannt','2-digit','ðŸ¤–\x20Autopilot\x20skipped\x20(Traffic\x20Protection\x20active).','295wrhGsu','3891404wyrRMa','getForeignStateAsync','23589MLerai','name','(((.+)+)+)+$','toISOString','ðŸ“…\x20Daily\x20Digest:\x0a','toString','activityLevel','Skipped\x20(Traffic)','ðŸŒ…\x20Briefing\x20generated\x20(Length:\x20','443830Xgwbsd','.\x20SYSTEM_MODE:\x20','analysis.isAlert','Unbekannt\x20(Kein\x20Sensor)','setDate','LTM.processingStatus','Wetterdaten\x20nicht\x20abrufbar','search','ðŸ¤–\x20API\x20Cooldown.\x20Waiting\x202s...','toLocaleTimeString','@google/generative-ai','%)\x20nach\x20\x22','1103316JGHFAr','LTM.driftAnalysis.lastCheck','livingContext','Gemini\x20Error:\x20','.forecast.current.state','isAlert','log','PRIORITÃ„T:\x20Energie\x20sparen.\x20Schalte\x20nur,\x20wenn\x20absolut\x20notwendig\x20(Dunkelheit).','useWeather',').\x20Sending\x20notification...','models/gemini-flash-latest','ðŸ¤–\x20Butler\x20Brain\x20Error:\x20','Â°C,\x20','analysisHistory','âš ï¸\x20ALARM:\x20','Sicherheit\x20geht\x20vor.','parse','ðŸŒ…\x20Morning\x20Briefing:\x0a','4vVXIuU','24qNkeUK','Nacht','\x0aAktivitÃ¤t:\x20','\x0a\x20\x20\x20\x20ANTWORT-STIL:\x20Sachlich,\x20beruhigend,\x20prÃ¤zise.\x20Keine\x20Floskeln.\x0a\x20\x20\x20\x20','baselineDrift','analysis.automation.autoApply','Skipped\x20(No\x20AI\x20or\x20Data)','automationProposal','.\x20EMERGENCY:\x20','exports','811181teUoQR','error','system.presenceWho','getStateAsync','decision','ROLLE:\x20Data\x20Compression\x20Agent.\x20SPRACHE:\x20DE.\x20FORMAT:\x20JSON.\x20ANWEISUNG:\x20Fasse\x20Sensor-Events\x20zusammen.\x20SCHEMA:\x20{\x20\x22summary\x22:\x20\x22string\x22,\x20\x22activityLevel\x22:\x20\x22string\x22\x20}\x20\x0a\x0aEVENTS:\x0a','setHours','analysis.automation.patternDetected','.\x20KONTEXT:\x20','map','splice','warn','Keine\x20Daten\x20fÃ¼r\x20die\x20Nacht\x20aufgezeichnet\x20(Sensoren\x20ruhig).','ðŸ¤–\x20BUTLER:\x20Executing\x20Action\x20->\x20','approved','\x0a\x20\x20\x20\x20ROLLE:\x20Haus-Butler.\x0a\x20\x20\x20\x20SITUATION:\x20','trim','.Current.IsNight','message','\x0a\x20\x20\x20\x20FRAGE:\x20Ist\x20es\x20dunkel\x20genug\x20fÃ¼r\x20Licht?\x0a\x20\x20\x20\x20FORMAT:\x20{\x20\x22approved\x22:\x20boolean,\x20\x22reason\x22:\x20\x22kurzer\x20Grund\x22\x20}\x0a\x20\x20\x20\x20','push','ðŸ¤–\x20Butler\x20Cache\x20Hit:\x20','Keine\x20Details.','stringify','generateContent','\x0a\x20\x20\x20\x20ROLLE:\x20Medizinischer\x20Assistent\x20fÃ¼r\x20AAL\x20(Ambient\x20Assisted\x20Living).\x0a\x20\x20\x20\x20AUFGABE:\x20','setStateAsync','summary','value','Fokus\x20auf\x20Komfort\x20fÃ¼r\x20die\x20Familie.','sendNotification','constructor','Digest','slice','\x20=\x20','ltmLtbWindowDays','Started...','LTM.driftAnalysis.driftDetails',',\x20LichtverhÃ¤ltnisse:\x20','KI-Fehler\x20(Fallback)','pop','text','\x20->\x20','reason','currentSystemMode','BUTLER\x20Execution\x20Error:\x20','950qKNusY','ROLLE:\x20Data\x20Scientist.\x20ZIEL:\x20Drift\x20erkennen.\x20SCHEMA:\x20{\x20\x22baselineDrift\x22:\x20\x22none|slight|significant|critical\x22,\x20\x22driftDetails\x22:\x20\x22string\x22\x20}\x0a\x0aLTB:\x20','Traffic-Schutz\x20(Auto-Approved)','weatherInstance','Entscheide\x20ausgewogen\x20zwischen\x20Komfort\x20und\x20Energie.','ðŸ¤–\x20Traffic\x20Schutz:\x20Anfrage\x20fÃ¼r\x20','isProVersion','LTM.dailyDigests','response','apply','ðŸ¤–\x20Morning\x20Briefing\x20skipped:\x20No\x20Gemini\x20Model.','getTime','debug','analysis.analysisHistory','timestamp','eventHistory','Success','normal','analysis.activitySummary','toFixed'];a0_0x1808=function(){return _0x476697;};return a0_0x1808();}function updateApiTimestamp(){lastGlobalApiCall=Date['now']();}async function getWeatherContext(_0x10a5bc){const _0x4c08fa=a0_0x7a9e0f;if(!_0x10a5bc['config'][_0x4c08fa(0x136)]||!_0x10a5bc[_0x4c08fa(0x10e)][_0x4c08fa(0xe3)])return _0x4c08fa(0x125);try{const _0x3293dd=_0x10a5bc['config'][_0x4c08fa(0xe3)];let _0x2a2df4=await _0x10a5bc[_0x4c08fa(0x118)](_0x3293dd+'.Current.Temperature');if(!_0x2a2df4)_0x2a2df4=await _0x10a5bc[_0x4c08fa(0x118)](_0x3293dd+'.forecast.current.temperature');let _0x3ebb71=await _0x10a5bc['getForeignStateAsync'](_0x3293dd+_0x4c08fa(0x101));if(!_0x3ebb71)_0x3ebb71=await _0x10a5bc[_0x4c08fa(0x118)](_0x3293dd+_0x4c08fa(0x132));let _0x235ab2=_0x4c08fa(0x113);const _0x5e8f03=await _0x10a5bc[_0x4c08fa(0x118)](_0x3293dd+_0x4c08fa(0x15c));if(_0x5e8f03)_0x235ab2=_0x5e8f03[_0x4c08fa(0x112)]?_0x4c08fa(0x142):'Tag';if(_0x2a2df4&&_0x3ebb71)return _0x2a2df4[_0x4c08fa(0x112)]+_0x4c08fa(0x13a)+_0x3ebb71['val']+_0x4c08fa(0xd8)+_0x235ab2;}catch(_0x15eecb){}return _0x4c08fa(0x128);}async function consultButler(_0x2dcb6f,_0x8e1a9,_0x50d33a,_0x7cbeda){const _0x5b1ebd=a0_0x7a9e0f;if(!_0x2dcb6f[_0x5b1ebd(0x110)])return{'approved':!![],'reason':'KI\x20offline\x20(Fallback)'};const _0x2c8ec1=Date[_0x5b1ebd(0xfc)]();if(decisionCache[_0x8e1a9]&&_0x2c8ec1-decisionCache[_0x8e1a9][_0x5b1ebd(0xee)]<CACHE_TTL_MS){const _0x466591=decisionCache[_0x8e1a9][_0x5b1ebd(0x14f)];return _0x2dcb6f[_0x5b1ebd(0x134)]['debug'](_0x5b1ebd(0x160)+_0x8e1a9+_0x5b1ebd(0xdc)+(_0x466591[_0x5b1ebd(0x159)]?'OK':'NO')+'\x20('+_0x466591[_0x5b1ebd(0xdd)]+')'),_0x466591;}if(!canCallApi())return _0x2dcb6f[_0x5b1ebd(0x134)][_0x5b1ebd(0xec)](_0x5b1ebd(0xe5)+_0x8e1a9+'\x20Ã¼bersprungen\x20(Auto-Approved).'),{'approved':!![],'reason':_0x5b1ebd(0xe2)};const _0x4a2b42=new Date()[_0x5b1ebd(0x12b)](),_0x17f9b1=await getWeatherContext(_0x2dcb6f),_0x2168f8=PERSONA_MAPPING[_0x2dcb6f[_0x5b1ebd(0x10e)][_0x5b1ebd(0x104)]||_0x5b1ebd(0x109)],_0x58ec42=_0x5b1ebd(0x15a)+_0x4a2b42+',\x20Wetter:\x20'+_0x17f9b1+_0x5b1ebd(0x106)+(_0x7cbeda*0x64)[_0x5b1ebd(0xf3)](0x0)+_0x5b1ebd(0x12d)+_0x8e1a9+'\x22.\x0a\x20\x20\x20\x20AKTION:\x20Schalte\x20\x22'+_0x50d33a+'\x22\x20AN.\x0a\x20\x20\x20\x20STRATEGIE:\x20'+_0x2168f8+_0x5b1ebd(0x15e);try{updateApiTimestamp();const _0x99f929=await _0x2dcb6f['geminiModel'][_0x5b1ebd(0x163)](_0x58ec42),_0x55cb3b=_0x99f929[_0x5b1ebd(0xe8)]['text']()[_0x5b1ebd(0xff)](/```json|```/g,'')[_0x5b1ebd(0x15b)](),_0x404cf4=JSON[_0x5b1ebd(0x13e)](_0x55cb3b);return decisionCache[_0x8e1a9]={'decision':_0x404cf4,'timestamp':_0x2c8ec1},_0x404cf4;}catch(_0x40a434){return _0x2dcb6f['log'][_0x5b1ebd(0x156)](_0x5b1ebd(0x139)+_0x40a434['message']),decisionCache[_0x8e1a9]={'decision':{'approved':!![],'reason':'KI-Fehler\x20(Fallback)'},'timestamp':_0x2c8ec1-(CACHE_TTL_MS-0xea60)},{'approved':!![],'reason':_0x5b1ebd(0xd9)};}}async function runGeminiAnalysis(_0x1a1cb4,_0x20df0f=''){const _0xa65f2e=a0_0x7a9e0f;if(!_0x1a1cb4[_0xa65f2e(0x110)])return;if(!canCallApi()){_0x1a1cb4['log']['debug'](_0xa65f2e(0x115));return;}if(_0x1a1cb4[_0xa65f2e(0xef)][_0xa65f2e(0xfb)]===0x0)return;const _0x1f9134=_0x1a1cb4[_0xa65f2e(0xef)]['slice'](0x0,0xf),_0x17ab3d=_0x1a1cb4[_0xa65f2e(0xde)],_0x5e0399=PERSONA_MAPPING[_0x1a1cb4[_0xa65f2e(0x10e)]['aiPersona']||_0xa65f2e(0x109)],_0x1f1d9e=_0x1a1cb4[_0xa65f2e(0x10e)][_0xa65f2e(0x130)]||_0xa65f2e(0x161);let _0x23e41f=_0xa65f2e(0x113);try{const _0x4ea612=await _0x1a1cb4[_0xa65f2e(0x14e)](_0xa65f2e(0x14d));if(_0x4ea612&&_0x4ea612[_0xa65f2e(0x112)])_0x23e41f=_0x4ea612[_0xa65f2e(0x112)];}catch(_0x70e791){}let _0x138c25=![];try{const _0x122a42=await _0x1a1cb4['getStateAsync'](_0xa65f2e(0x146));if(_0x122a42&&_0x122a42[_0xa65f2e(0x112)])_0x138c25=!![];}catch(_0x38e423){}const _0x3eff1d=_0xa65f2e(0x107)+_0x5e0399+_0xa65f2e(0x153)+_0x1f1d9e+_0xa65f2e(0x123)+_0x17ab3d+'.\x20ANWESEND:\x20'+_0x23e41f+'.\x20EVENTS:\x20'+JSON[_0xa65f2e(0x162)](_0x1f9134)+_0xa65f2e(0x149)+_0x20df0f+_0xa65f2e(0xf9);try{updateApiTimestamp();const _0x5a9002=await _0x1a1cb4[_0xa65f2e(0x110)][_0xa65f2e(0x163)](_0x3eff1d),_0x187f8b=JSON[_0xa65f2e(0x13e)](_0x5a9002[_0xa65f2e(0xe8)]['text']()[_0xa65f2e(0xff)](/```json|```/g,'')[_0xa65f2e(0x15b)]());await _0x1a1cb4['setStateAsync']('analysis.lastResult',{'val':JSON[_0xa65f2e(0x162)](_0x187f8b),'ack':!![]});if(_0x187f8b['summary'])await _0x1a1cb4[_0xa65f2e(0x165)](_0xa65f2e(0xf2),{'val':_0x187f8b[_0xa65f2e(0x166)],'ack':!![]});const _0x71875e={'timestamp':Date['now'](),'id':Date['now']()[_0xa65f2e(0x11e)](),'analysis':{'activity':{'summary':_0x187f8b[_0xa65f2e(0x166)],'isAlert':_0x187f8b['isAlert'],'alertReason':_0x187f8b['alertReason']},'comfort':{'automationProposal':_0x187f8b[_0xa65f2e(0x148)]}}};_0x1a1cb4['analysisHistory']['unshift'](_0x71875e);if(_0x1a1cb4['analysisHistory'][_0xa65f2e(0xfb)]>0x32)_0x1a1cb4['analysisHistory'][_0xa65f2e(0xda)]();await _0x1a1cb4[_0xa65f2e(0x165)](_0xa65f2e(0xed),{'val':JSON[_0xa65f2e(0x162)](_0x1a1cb4[_0xa65f2e(0x13b)]),'ack':!![]});const _0xfbe258=_0x187f8b[_0xa65f2e(0x133)]||![];_0xfbe258!==_0x1a1cb4[_0xa65f2e(0x10f)]&&(await _0x1a1cb4[_0xa65f2e(0x165)](_0xa65f2e(0x124),{'val':_0xfbe258,'ack':!![]}),_0x1a1cb4[_0xa65f2e(0x10f)]=_0xfbe258,_0xfbe258&&(await _0x1a1cb4[_0xa65f2e(0x165)]('analysis.alertReason',{'val':_0x187f8b[_0xa65f2e(0xfa)],'ack':!![]}),setup[_0xa65f2e(0x169)](_0x1a1cb4,_0xa65f2e(0x13c)+_0x187f8b[_0xa65f2e(0xfa)],![],_0x187f8b['isEmergency'])));if(_0x187f8b[_0xa65f2e(0x148)]&&_0x187f8b[_0xa65f2e(0x148)]['detected']){await _0x1a1cb4[_0xa65f2e(0x165)](_0xa65f2e(0x152),{'val':!![],'ack':!![]}),await _0x1a1cb4[_0xa65f2e(0x165)]('analysis.automation.description',{'val':_0x187f8b[_0xa65f2e(0x148)]['description'],'ack':!![]}),await _0x1a1cb4[_0xa65f2e(0x165)](_0xa65f2e(0xfe),{'val':_0x187f8b[_0xa65f2e(0x148)][_0xa65f2e(0xfd)],'ack':!![]}),await _0x1a1cb4['setStateAsync'](_0xa65f2e(0x102),{'val':JSON[_0xa65f2e(0x162)](_0x187f8b[_0xa65f2e(0x148)]['targetValue']),'ack':!![]});if(_0x138c25)executeAutomationAction(_0x1a1cb4);}}catch(_0x395198){_0x1a1cb4['log'][_0xa65f2e(0x14c)](_0xa65f2e(0x131)+_0x395198['message']);}}async function createDailyDigest(_0x3fabc5,_0x1c968f){const _0x465051=a0_0x7a9e0f;if(!_0x3fabc5[_0x465051(0xe6)])return;if(!canCallApi()){await _0x3fabc5[_0x465051(0x165)](LTM_DP_STATUS,{'val':_0x465051(0x120),'ack':!![]});return;}await _0x3fabc5[_0x465051(0x165)](LTM_DP_STATUS,{'val':_0x465051(0xd6),'ack':!![]});if(!_0x3fabc5[_0x465051(0x110)]||_0x3fabc5[_0x465051(0xf6)][_0x465051(0xfb)]<LTM_MIN_EVENTS_FOR_COMPRESSION){await _0x3fabc5[_0x465051(0x165)](LTM_DP_STATUS,{'val':_0x465051(0x147),'ack':!![]});return;}const _0x56984e=JSON[_0x465051(0x13e)](JSON['stringify'](_0x3fabc5[_0x465051(0xf6)])),_0x3e2925=_0x56984e[_0x465051(0xfb)],_0x389c3b=_0x465051(0x150)+JSON[_0x465051(0x162)](_0x56984e);try{updateApiTimestamp();const _0x833f38=await _0x3fabc5['geminiModel'][_0x465051(0x163)](_0x389c3b),_0x4300b6=JSON[_0x465051(0x13e)](_0x833f38[_0x465051(0xe8)]['text']()['replace'](/```json|```/g,'')[_0x465051(0x15b)]()),_0x3c4637={'timestamp':new Date()[_0x465051(0x11c)](),'eventCount':_0x3e2925,'summary':_0x4300b6[_0x465051(0x166)]||_0x465051(0xd2),'activityLevel':_0x4300b6[_0x465051(0x11f)]||_0x465051(0xf1),'systemMode':_0x3fabc5[_0x465051(0xde)]};_0x3fabc5['dailyDigests'][_0x465051(0x15f)](_0x3c4637);const _0x1f8af4=_0x3fabc5['config'][_0x465051(0xd5)]||0x3c;_0x3fabc5[_0x465051(0xf8)]['length']>_0x1f8af4&&_0x3fabc5[_0x465051(0xf8)][_0x465051(0x155)](0x0,_0x3fabc5['dailyDigests']['length']-_0x1f8af4);await _0x3fabc5[_0x465051(0x165)](LTM_DP_DAILY_DIGESTS,{'val':JSON[_0x465051(0x162)](_0x3fabc5[_0x465051(0xf8)]),'ack':!![]}),_0x3fabc5['rawEventLog']=[],await _0x3fabc5[_0x465051(0x165)](LTM_DP_RAW_LOG,{'val':JSON[_0x465051(0x162)](_0x3fabc5[_0x465051(0xf6)]),'ack':!![]}),await _0x3fabc5[_0x465051(0x165)](LTM_DP_STATUS,{'val':_0x465051(0xf0),'ack':!![]});const _0x2f934b=_0x465051(0x11d)+_0x4300b6[_0x465051(0x166)]+_0x465051(0x143)+_0x4300b6[_0x465051(0x11f)];setup[_0x465051(0x169)](_0x3fabc5,_0x2f934b,![],![]);if(_0x3fabc5[_0x465051(0xe6)]&&_0x1c968f)_0x1c968f[_0x465051(0x108)](_0x3fabc5,_0x465051(0x103),{'digest':_0x3c4637});}catch(_0x5eeba9){_0x3fabc5[_0x465051(0x134)][_0x465051(0x14c)](_0x5eeba9[_0x465051(0x15d)]);}}async function runBaselineDriftAnalysis(_0x2ccdd5){const _0x213b48=a0_0x7a9e0f;if(!_0x2ccdd5[_0x213b48(0xe6)]||!_0x2ccdd5[_0x213b48(0x110)])return;if(!canCallApi())return;const _0x27e7ba=_0x2ccdd5[_0x213b48(0x10e)]['ltmStbWindowDays']||0xe;if(_0x2ccdd5[_0x213b48(0xf8)]['length']<_0x27e7ba+0x7){await _0x2ccdd5[_0x213b48(0x165)](_0x213b48(0x10c),{'val':'N/A\x20(Learning)','ack':!![]});return;}const _0xa3f486=_0x2ccdd5[_0x213b48(0xf8)][_0x213b48(0xd3)](-_0x27e7ba),_0x4cabf9=_0x2ccdd5['dailyDigests']['slice'](0x0,_0x2ccdd5[_0x213b48(0xf8)][_0x213b48(0xfb)]-_0x27e7ba),_0x3b6ae4=_0x213b48(0xe1)+JSON[_0x213b48(0x162)](_0x4cabf9)+'\x0aSTB:\x20'+JSON[_0x213b48(0x162)](_0xa3f486);try{updateApiTimestamp();const _0x1f876c=await _0x2ccdd5[_0x213b48(0x110)][_0x213b48(0x163)](_0x3b6ae4),_0x4bb51b=JSON[_0x213b48(0x13e)](_0x1f876c[_0x213b48(0xe8)]['text']()[_0x213b48(0xff)](/```json|```/g,'')[_0x213b48(0x15b)]());_0x4bb51b['baselineDrift']&&(await _0x2ccdd5[_0x213b48(0x165)](_0x213b48(0x10c),{'val':_0x4bb51b[_0x213b48(0x145)],'ack':!![]}),await _0x2ccdd5[_0x213b48(0x165)](_0x213b48(0xd7),{'val':_0x4bb51b['driftDetails'],'ack':!![]}),await _0x2ccdd5[_0x213b48(0x165)](_0x213b48(0x12f),{'val':Date['now'](),'ack':!![]}));}catch(_0x4782e9){}}async function executeAutomationAction(_0x128ed7){const _0x16dac8=a0_0x7a9e0f;try{const _0x360e1f=await _0x128ed7[_0x16dac8(0x14e)](_0x16dac8(0xfe)),_0x293dd7=await _0x128ed7[_0x16dac8(0x14e)](_0x16dac8(0x102));if(_0x360e1f&&_0x360e1f['val']&&_0x293dd7){const _0x315de0=_0x360e1f['val'];let _0x58cd5c=_0x293dd7[_0x16dac8(0x112)];try{_0x58cd5c=JSON[_0x16dac8(0x13e)](_0x58cd5c);}catch(_0x4271ac){}_0x128ed7[_0x16dac8(0x134)]['info'](_0x16dac8(0x158)+_0x315de0+_0x16dac8(0xd4)+_0x58cd5c),await _0x128ed7['setForeignStateAsync'](_0x315de0,_0x58cd5c);}else _0x128ed7[_0x16dac8(0x134)][_0x16dac8(0x156)]('ðŸ¤–\x20BUTLER:\x20No\x20valid\x20target\x20ID\x20or\x20value\x20stored\x20for\x20execution.');}catch(_0x339704){_0x128ed7[_0x16dac8(0x134)][_0x16dac8(0x14c)](_0x16dac8(0xdf)+_0x339704[_0x16dac8(0x15d)]);}}async function sendMorningBriefing(_0x5677e8){const _0x8388f9=a0_0x7a9e0f;if(!_0x5677e8[_0x8388f9(0x110)]){_0x5677e8[_0x8388f9(0x134)][_0x8388f9(0x156)](_0x8388f9(0xea));return;}_0x5677e8['log'][_0x8388f9(0x10a)]('ðŸŒ…\x20Starting\x20Morning\x20Briefing\x20sequence\x20(Traffic\x20Check\x20bypassed)...');try{updateApiTimestamp();const _0x5686d5=_0x8388f9(0xf7),_0x562f5e=await _0x5677e8[_0x8388f9(0x110)]['generateContent'](_0x5686d5),_0x2351ef=_0x562f5e[_0x8388f9(0xe8)]['text']();_0x5677e8[_0x8388f9(0x134)][_0x8388f9(0x10a)](_0x8388f9(0x121)+_0x2351ef[_0x8388f9(0xfb)]+_0x8388f9(0x137)),setup[_0x8388f9(0x169)](_0x5677e8,_0x8388f9(0x13f)+_0x2351ef);}catch(_0x2dcabe){_0x5677e8[_0x8388f9(0x134)]['error'](_0x8388f9(0x100)+_0x2dcabe[_0x8388f9(0x15d)]);}}async function generateHealthReport(_0x3971c0,_0x5b4f09){const _0x4c3788=a0_0x7a9e0f;if(!_0x3971c0[_0x4c3788(0x110)])return;const _0x29d9db=Date['now']();_0x29d9db-lastGlobalApiCall<0xbb8&&(_0x3971c0[_0x4c3788(0x134)][_0x4c3788(0xec)](_0x4c3788(0x12a)),await new Promise(_0x4542ce=>setTimeout(_0x4542ce,0x7d0)));const _0x2256aa=new Date();let _0x172729=0x0,_0x18b033=_0x2256aa[_0x4c3788(0xeb)](),_0x4e1832='';if(_0x5b4f09===_0x4c3788(0x10b)){const _0x30230b=new Date(_0x2256aa);_0x30230b[_0x4c3788(0x126)](_0x30230b['getDate']()-0x1),_0x30230b[_0x4c3788(0x151)](0x16,0x0,0x0,0x0),_0x172729=_0x30230b[_0x4c3788(0xeb)]();const _0x488fbd=new Date(_0x2256aa);_0x488fbd[_0x4c3788(0x151)](0x8,0x0,0x0,0x0),_0x18b033=_0x488fbd['getTime'](),_0x4e1832=_0x4c3788(0xf5);}else{const _0x1d9f56=new Date(_0x2256aa);_0x1d9f56[_0x4c3788(0x151)](0x8,0x0,0x0,0x0),_0x172729=_0x1d9f56[_0x4c3788(0xeb)](),_0x4e1832='Analysiere\x20diese\x20Events\x20des\x20TAGES\x20(08:00-Jetzt).\x20AktivitÃ¤t?\x20Mahlzeiten?\x20HaustÃ¼r?\x20Antwort\x20kurz\x20fÃ¼r\x20den\x20besorgten\x20Sohn\x20(max\x202\x20SÃ¤tze).';}const _0x208c4d=_0x3971c0[_0x4c3788(0xef)]['filter'](_0x399d01=>_0x399d01['timestamp']>=_0x172729&&_0x399d01['timestamp']<=_0x18b033);if(_0x208c4d[_0x4c3788(0xfb)]===0x0){const _0x2f7ca7=_0x5b4f09==='NIGHT'?_0x4c3788(0x157):'Bisher\x20keine\x20AktivitÃ¤t\x20seit\x2008:00\x20Uhr\x20verzeichnet.',_0x1694ba=_0x5b4f09===_0x4c3788(0x10b)?'analysis.health.geminiNight':_0x4c3788(0x111);await _0x3971c0[_0x4c3788(0x165)](_0x1694ba,{'val':_0x2f7ca7,'ack':!![]});return;}const _0x4a57fd=_0x208c4d[_0x4c3788(0x154)](_0x913f53=>new Date(_0x913f53[_0x4c3788(0xee)])[_0x4c3788(0x12b)]([],{'hour':_0x4c3788(0x114),'minute':_0x4c3788(0x114)})+'\x20'+_0x913f53[_0x4c3788(0x11a)]+'\x20('+_0x913f53[_0x4c3788(0x167)]+')')['join']('\x0a'),_0x4ac147=_0x4c3788(0x164)+_0x4e1832+_0x4c3788(0x10d)+_0x4a57fd+_0x4c3788(0x144);try{updateApiTimestamp();const _0x2ad1c0=await _0x3971c0[_0x4c3788(0x110)][_0x4c3788(0x163)](_0x4ac147),_0xcbf612=_0x2ad1c0[_0x4c3788(0xe8)][_0x4c3788(0xdb)](),_0x13035b=_0x5b4f09===_0x4c3788(0x10b)?'analysis.health.geminiNight':_0x4c3788(0x111);await _0x3971c0[_0x4c3788(0x165)](_0x13035b,{'val':_0xcbf612,'ack':!![]}),_0x3971c0[_0x4c3788(0x134)][_0x4c3788(0x10a)]('ðŸ¤–\x20Health\x20Report\x20('+_0x5b4f09+')\x20generated.');}catch(_0x192448){_0x3971c0[_0x4c3788(0x134)][_0x4c3788(0x14c)]('Health\x20Report\x20Error:\x20'+_0x192448[_0x4c3788(0x15d)]);}}module[a0_0x7a9e0f(0x14a)]={'executeAutomationAction':executeAutomationAction,'createDailyDigest':createDailyDigest,'runBaselineDriftAnalysis':runBaselineDriftAnalysis,'sendMorningBriefing':sendMorningBriefing,'runGeminiAnalysis':runGeminiAnalysis,'consultButler':consultButler,'generateHealthReport':generateHealthReport};