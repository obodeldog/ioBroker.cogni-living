const a0_0x330029=a0_0x1325;(function(_0x5f570c,_0x312487){const _0xfcd6df=a0_0x1325,_0x2b4f76=_0x5f570c();while(!![]){try{const _0x2f1495=-parseInt(_0xfcd6df(0x1b0))/0x1+-parseInt(_0xfcd6df(0x18a))/0x2+parseInt(_0xfcd6df(0x159))/0x3+-parseInt(_0xfcd6df(0x1a5))/0x4*(-parseInt(_0xfcd6df(0x1a6))/0x5)+-parseInt(_0xfcd6df(0x172))/0x6*(parseInt(_0xfcd6df(0x150))/0x7)+parseInt(_0xfcd6df(0x131))/0x8*(parseInt(_0xfcd6df(0x136))/0x9)+parseInt(_0xfcd6df(0x16c))/0xa*(parseInt(_0xfcd6df(0x1bb))/0xb);if(_0x2f1495===_0x312487)break;else _0x2b4f76['push'](_0x2b4f76['shift']());}catch(_0x6a1cd7){_0x2b4f76['push'](_0x2b4f76['shift']());}}}(a0_0x3389,0x861c1));const a0_0x44b185=(function(){let _0x3990ed=!![];return function(_0x132420,_0x17c7ef){const _0x13ccad=_0x3990ed?function(){const _0x6f616b=a0_0x1325;if(_0x17c7ef){const _0x4724d3=_0x17c7ef[_0x6f616b(0x180)](_0x132420,arguments);return _0x17c7ef=null,_0x4724d3;}}:function(){};return _0x3990ed=![],_0x13ccad;};}()),a0_0xffabf9=a0_0x44b185(this,function(){const _0x457546=a0_0x1325;return a0_0xffabf9[_0x457546(0x1a4)]()[_0x457546(0x145)]('(((.+)+)+)+$')['toString']()[_0x457546(0x190)](a0_0xffabf9)[_0x457546(0x145)](_0x457546(0x1c4));});a0_0xffabf9();function a0_0x1325(_0x1ce967,_0x342eea){const _0x3a5111=a0_0x3389();return a0_0x1325=function(_0xffabf9,_0x44b185){_0xffabf9=_0xffabf9-0x12d;let _0x3389db=_0x3a5111[_0xffabf9];return _0x3389db;},a0_0x1325(_0x1ce967,_0x342eea);}'use strict';const {GoogleGenerativeAI}=require(a0_0x330029(0x14a)),setup=require('./setup'),GEMINI_MODEL='models/gemini-flash-latest',LTM_DP_DAILY_DIGESTS='LTM.dailyDigests',LTM_DP_STATUS=a0_0x330029(0x12d),LTM_DP_RAW_LOG=a0_0x330029(0x15c),LTM_MIN_EVENTS_FOR_COMPRESSION=0x5,MIN_API_GAP_MS=0x4e20;let lastGlobalApiCall=0x0;const decisionCache={},CACHE_TTL_MS=0xf*0x3c*0x3e8,PERSONA_MAPPING={'generic':a0_0x330029(0x188),'senior_aal':a0_0x330029(0x1af),'family':a0_0x330029(0x1c3),'single_comfort':a0_0x330029(0x197),'security':'Sicherheit\x20geht\x20vor.','energy_saver':a0_0x330029(0x14c)};function canCallApi(){const _0x2929bf=a0_0x330029,_0x1e8968=Date[_0x2929bf(0x18c)]();return _0x1e8968-lastGlobalApiCall>MIN_API_GAP_MS;}function updateApiTimestamp(){const _0x47081f=a0_0x330029;lastGlobalApiCall=Date[_0x47081f(0x18c)]();}async function getWeatherContext(_0x383308){const _0xb71e90=a0_0x330029;if(!_0x383308[_0xb71e90(0x1a9)][_0xb71e90(0x1b8)]||!_0x383308['config'][_0xb71e90(0x1aa)])return'Unbekannt\x20(Kein\x20Sensor)';try{const _0x3060d2=_0x383308['config'][_0xb71e90(0x1aa)];let _0x2b5fbd=await _0x383308['getForeignStateAsync'](_0x3060d2+_0xb71e90(0x1bc));if(!_0x2b5fbd)_0x2b5fbd=await _0x383308[_0xb71e90(0x149)](_0x3060d2+_0xb71e90(0x167));let _0xb7ba37=await _0x383308[_0xb71e90(0x149)](_0x3060d2+_0xb71e90(0x14e));if(!_0xb7ba37)_0xb7ba37=await _0x383308['getForeignStateAsync'](_0x3060d2+_0xb71e90(0x182));let _0x47809c=_0xb71e90(0x1b7);const _0xd798c5=await _0x383308[_0xb71e90(0x149)](_0x3060d2+_0xb71e90(0x1b3));if(_0xd798c5)_0x47809c=_0xd798c5[_0xb71e90(0x1ac)]?_0xb71e90(0x185):'Tag';if(_0x2b5fbd&&_0xb7ba37)return _0x2b5fbd[_0xb71e90(0x1ac)]+_0xb71e90(0x12f)+_0xb7ba37[_0xb71e90(0x1ac)]+_0xb71e90(0x148)+_0x47809c;}catch(_0x4a41d8){}return _0xb71e90(0x12e);}async function consultButler(_0x3513fc,_0x121d2c,_0x101f56,_0x583572){const _0x33fc8c=a0_0x330029;if(!_0x3513fc[_0x33fc8c(0x138)])return{'approved':!![],'reason':'KI\x20offline\x20(Fallback)'};const _0x25294e=Date['now']();if(decisionCache[_0x121d2c]&&_0x25294e-decisionCache[_0x121d2c][_0x33fc8c(0x146)]<CACHE_TTL_MS){const _0x7c2951=decisionCache[_0x121d2c][_0x33fc8c(0x168)];return _0x3513fc[_0x33fc8c(0x1a3)][_0x33fc8c(0x1a8)]('ü§ñ\x20Butler\x20Cache\x20Hit:\x20'+_0x121d2c+'\x20->\x20'+(_0x7c2951['approved']?'OK':'NO')+'\x20('+_0x7c2951[_0x33fc8c(0x153)]+')'),_0x7c2951;}if(!canCallApi())return _0x3513fc['log'][_0x33fc8c(0x1a8)]('ü§ñ\x20Traffic\x20Schutz:\x20Anfrage\x20f√ºr\x20'+_0x121d2c+_0x33fc8c(0x174)),{'approved':!![],'reason':_0x33fc8c(0x1c7)};const _0x5110cd=new Date()[_0x33fc8c(0x163)](),_0x409bd3=await getWeatherContext(_0x3513fc),_0x162f80=PERSONA_MAPPING[_0x3513fc[_0x33fc8c(0x1a9)]['aiPersona']||_0x33fc8c(0x1c2)],_0x3bd2b9=_0x33fc8c(0x164)+_0x5110cd+_0x33fc8c(0x16e)+_0x409bd3+_0x33fc8c(0x161)+(_0x583572*0x64)[_0x33fc8c(0x1b2)](0x0)+'%)\x20nach\x20\x22'+_0x121d2c+_0x33fc8c(0x14d)+_0x101f56+_0x33fc8c(0x195)+_0x162f80+_0x33fc8c(0x196);try{updateApiTimestamp();const _0x1ce112=await _0x3513fc[_0x33fc8c(0x138)][_0x33fc8c(0x1c9)](_0x3bd2b9),_0x72b213=_0x1ce112['response'][_0x33fc8c(0x15a)]()['replace'](/```json|```/g,'')[_0x33fc8c(0x13f)](),_0x2ba2a0=JSON[_0x33fc8c(0x147)](_0x72b213);return decisionCache[_0x121d2c]={'decision':_0x2ba2a0,'timestamp':_0x25294e},_0x2ba2a0;}catch(_0x52b3d1){return _0x3513fc[_0x33fc8c(0x1a3)]['warn'](_0x33fc8c(0x17b)+_0x52b3d1['message']),decisionCache[_0x121d2c]={'decision':{'approved':!![],'reason':'KI-Fehler\x20(Fallback)'},'timestamp':_0x25294e-(CACHE_TTL_MS-0xea60)},{'approved':!![],'reason':'KI-Fehler\x20(Fallback)'};}}async function runGeminiAnalysis(_0x401f2d,_0x3fcf4b=''){const _0x5411b7=a0_0x330029;if(!_0x401f2d[_0x5411b7(0x138)])return;if(!canCallApi()){_0x401f2d[_0x5411b7(0x1a3)][_0x5411b7(0x1a8)](_0x5411b7(0x1cb));return;}if(_0x401f2d[_0x5411b7(0x1c5)][_0x5411b7(0x1a7)]===0x0)return;const _0x34f77b=_0x401f2d[_0x5411b7(0x1c5)]['slice'](0x0,0xf),_0x4823c3=_0x401f2d[_0x5411b7(0x1ba)],_0x5cb186=PERSONA_MAPPING[_0x401f2d[_0x5411b7(0x1a9)]['aiPersona']||_0x5411b7(0x1c2)],_0x27a84f=_0x401f2d['config'][_0x5411b7(0x13e)]||_0x5411b7(0x198);let _0x5b4b1d=_0x5411b7(0x1b7);try{const _0x298ccc=await _0x401f2d['getStateAsync'](_0x5411b7(0x173));if(_0x298ccc&&_0x298ccc[_0x5411b7(0x1ac)])_0x5b4b1d=_0x298ccc[_0x5411b7(0x1ac)];}catch(_0x2d6f40){}let _0x5ec50a=![];try{const _0x451b89=await _0x401f2d[_0x5411b7(0x169)](_0x5411b7(0x175));if(_0x451b89&&_0x451b89[_0x5411b7(0x1ac)])_0x5ec50a=!![];}catch(_0x5a21b4){}const _0x48f6b6='ROLLE:\x20KI-Hausverwalter.\x20PERSONA:\x20'+_0x5cb186+_0x5411b7(0x18e)+_0x27a84f+'.\x20SYSTEM_MODE:\x20'+_0x4823c3+'.\x20ANWESEND:\x20'+_0x5b4b1d+_0x5411b7(0x19d)+JSON[_0x5411b7(0x187)](_0x34f77b)+_0x5411b7(0x156)+_0x3fcf4b+_0x5411b7(0x178);try{updateApiTimestamp();const _0x5d9c24=await _0x401f2d[_0x5411b7(0x138)][_0x5411b7(0x1c9)](_0x48f6b6),_0x51ad60=JSON['parse'](_0x5d9c24[_0x5411b7(0x1ab)][_0x5411b7(0x15a)]()['replace'](/```json|```/g,'')[_0x5411b7(0x13f)]());await _0x401f2d[_0x5411b7(0x132)](_0x5411b7(0x18f),{'val':JSON[_0x5411b7(0x187)](_0x51ad60),'ack':!![]});if(_0x51ad60[_0x5411b7(0x143)])await _0x401f2d[_0x5411b7(0x132)](_0x5411b7(0x18b),{'val':_0x51ad60[_0x5411b7(0x143)],'ack':!![]});const _0x3bb8f3={'timestamp':Date[_0x5411b7(0x18c)](),'id':Date[_0x5411b7(0x18c)]()[_0x5411b7(0x1a4)](),'analysis':{'activity':{'summary':_0x51ad60[_0x5411b7(0x143)],'isAlert':_0x51ad60['isAlert'],'alertReason':_0x51ad60[_0x5411b7(0x1be)]},'comfort':{'automationProposal':_0x51ad60[_0x5411b7(0x1ae)]}}};_0x401f2d[_0x5411b7(0x13c)][_0x5411b7(0x193)](_0x3bb8f3);if(_0x401f2d[_0x5411b7(0x13c)][_0x5411b7(0x1a7)]>0x32)_0x401f2d['analysisHistory'][_0x5411b7(0x176)]();await _0x401f2d[_0x5411b7(0x132)](_0x5411b7(0x199),{'val':JSON[_0x5411b7(0x187)](_0x401f2d[_0x5411b7(0x13c)]),'ack':!![]});const _0x2c9832=_0x51ad60[_0x5411b7(0x1c0)]||![];_0x2c9832!==_0x401f2d[_0x5411b7(0x15e)]&&(await _0x401f2d['setStateAsync'](_0x5411b7(0x13b),{'val':_0x2c9832,'ack':!![]}),_0x401f2d[_0x5411b7(0x15e)]=_0x2c9832,_0x2c9832&&(await _0x401f2d[_0x5411b7(0x132)]('analysis.alertReason',{'val':_0x51ad60['alertReason'],'ack':!![]}),setup[_0x5411b7(0x151)](_0x401f2d,_0x5411b7(0x179)+_0x51ad60['alertReason'],![],_0x51ad60[_0x5411b7(0x157)])));if(_0x51ad60[_0x5411b7(0x1ae)]&&_0x51ad60['automationProposal'][_0x5411b7(0x181)]){await _0x401f2d[_0x5411b7(0x132)](_0x5411b7(0x134),{'val':!![],'ack':!![]}),await _0x401f2d[_0x5411b7(0x132)](_0x5411b7(0x166),{'val':_0x51ad60[_0x5411b7(0x1ae)][_0x5411b7(0x16f)],'ack':!![]}),await _0x401f2d[_0x5411b7(0x132)](_0x5411b7(0x184),{'val':_0x51ad60[_0x5411b7(0x1ae)][_0x5411b7(0x133)],'ack':!![]}),await _0x401f2d['setStateAsync'](_0x5411b7(0x19e),{'val':JSON[_0x5411b7(0x187)](_0x51ad60[_0x5411b7(0x1ae)][_0x5411b7(0x191)]),'ack':!![]});if(_0x5ec50a)executeAutomationAction(_0x401f2d);}}catch(_0x43b0f9){_0x401f2d[_0x5411b7(0x1a3)]['error']('Gemini\x20Error:\x20'+_0x43b0f9[_0x5411b7(0x152)]);}}async function createDailyDigest(_0x2be7ae,_0x1155c6){const _0x1835ba=a0_0x330029;if(!_0x2be7ae[_0x1835ba(0x1b4)])return;if(!canCallApi()){await _0x2be7ae[_0x1835ba(0x132)](LTM_DP_STATUS,{'val':_0x1835ba(0x142),'ack':!![]});return;}await _0x2be7ae[_0x1835ba(0x132)](LTM_DP_STATUS,{'val':_0x1835ba(0x186),'ack':!![]});if(!_0x2be7ae[_0x1835ba(0x138)]||_0x2be7ae['rawEventLog'][_0x1835ba(0x1a7)]<LTM_MIN_EVENTS_FOR_COMPRESSION){await _0x2be7ae[_0x1835ba(0x132)](LTM_DP_STATUS,{'val':_0x1835ba(0x1ad),'ack':!![]});return;}const _0xf51aef=JSON[_0x1835ba(0x147)](JSON[_0x1835ba(0x187)](_0x2be7ae[_0x1835ba(0x13a)])),_0x925f55=_0xf51aef[_0x1835ba(0x1a7)],_0x36d718=_0x1835ba(0x1b1)+JSON[_0x1835ba(0x187)](_0xf51aef);try{updateApiTimestamp();const _0x1d916b=await _0x2be7ae[_0x1835ba(0x138)][_0x1835ba(0x1c9)](_0x36d718),_0x1db6bf=JSON[_0x1835ba(0x147)](_0x1d916b[_0x1835ba(0x1ab)][_0x1835ba(0x15a)]()[_0x1835ba(0x1bf)](/```json|```/g,'')[_0x1835ba(0x13f)]()),_0x26b685={'timestamp':new Date()['toISOString'](),'eventCount':_0x925f55,'summary':_0x1db6bf[_0x1835ba(0x143)]||_0x1835ba(0x170),'activityLevel':_0x1db6bf[_0x1835ba(0x14f)]||_0x1835ba(0x19f),'systemMode':_0x2be7ae[_0x1835ba(0x1ba)]};_0x2be7ae[_0x1835ba(0x16b)][_0x1835ba(0x16d)](_0x26b685);const _0x1066f9=_0x2be7ae['config'][_0x1835ba(0x135)]||0x3c;_0x2be7ae[_0x1835ba(0x16b)][_0x1835ba(0x1a7)]>_0x1066f9&&_0x2be7ae[_0x1835ba(0x16b)][_0x1835ba(0x1c8)](0x0,_0x2be7ae['dailyDigests'][_0x1835ba(0x1a7)]-_0x1066f9);await _0x2be7ae[_0x1835ba(0x132)](LTM_DP_DAILY_DIGESTS,{'val':JSON[_0x1835ba(0x187)](_0x2be7ae[_0x1835ba(0x16b)]),'ack':!![]}),_0x2be7ae['rawEventLog']=[],await _0x2be7ae[_0x1835ba(0x132)](LTM_DP_RAW_LOG,{'val':JSON['stringify'](_0x2be7ae['rawEventLog']),'ack':!![]}),await _0x2be7ae['setStateAsync'](LTM_DP_STATUS,{'val':_0x1835ba(0x1a0),'ack':!![]});const _0x4f007e=_0x1835ba(0x15b)+_0x1db6bf[_0x1835ba(0x143)]+'\x0aAktivit√§t:\x20'+_0x1db6bf['activityLevel'];setup[_0x1835ba(0x151)](_0x2be7ae,_0x4f007e,![],![]);if(_0x2be7ae[_0x1835ba(0x1b4)]&&_0x1155c6)_0x1155c6[_0x1835ba(0x140)](_0x2be7ae,_0x1835ba(0x17e),{'digest':_0x26b685});}catch(_0x39a5e4){_0x2be7ae[_0x1835ba(0x1a3)][_0x1835ba(0x158)](_0x39a5e4['message']);}}async function runBaselineDriftAnalysis(_0x905b9f){const _0x35ffdb=a0_0x330029;if(!_0x905b9f[_0x35ffdb(0x1b4)]||!_0x905b9f[_0x35ffdb(0x138)])return;if(!canCallApi())return;const _0x16dfd5=_0x905b9f[_0x35ffdb(0x1a9)][_0x35ffdb(0x194)]||0xe;if(_0x905b9f[_0x35ffdb(0x16b)]['length']<_0x16dfd5+0x7){await _0x905b9f[_0x35ffdb(0x132)](_0x35ffdb(0x1b9),{'val':_0x35ffdb(0x17f),'ack':!![]});return;}const _0x592972=_0x905b9f[_0x35ffdb(0x16b)][_0x35ffdb(0x137)](-_0x16dfd5),_0x152aa7=_0x905b9f[_0x35ffdb(0x16b)][_0x35ffdb(0x137)](0x0,_0x905b9f[_0x35ffdb(0x16b)][_0x35ffdb(0x1a7)]-_0x16dfd5),_0x47e961=_0x35ffdb(0x17d)+JSON[_0x35ffdb(0x187)](_0x152aa7)+'\x0aSTB:\x20'+JSON[_0x35ffdb(0x187)](_0x592972);try{updateApiTimestamp();const _0x52eba2=await _0x905b9f[_0x35ffdb(0x138)][_0x35ffdb(0x1c9)](_0x47e961),_0x3545c6=JSON[_0x35ffdb(0x147)](_0x52eba2[_0x35ffdb(0x1ab)][_0x35ffdb(0x15a)]()[_0x35ffdb(0x1bf)](/```json|```/g,'')[_0x35ffdb(0x13f)]());_0x3545c6[_0x35ffdb(0x19b)]&&(await _0x905b9f[_0x35ffdb(0x132)](_0x35ffdb(0x1b9),{'val':_0x3545c6['baselineDrift'],'ack':!![]}),await _0x905b9f[_0x35ffdb(0x132)](_0x35ffdb(0x16a),{'val':_0x3545c6['driftDetails'],'ack':!![]}),await _0x905b9f[_0x35ffdb(0x132)](_0x35ffdb(0x18d),{'val':Date['now'](),'ack':!![]}));}catch(_0x455541){}}async function executeAutomationAction(_0xede16f){const _0x4d802b=a0_0x330029;try{const _0x318192=await _0xede16f[_0x4d802b(0x169)](_0x4d802b(0x184)),_0x145670=await _0xede16f[_0x4d802b(0x169)](_0x4d802b(0x19e));if(_0x318192&&_0x318192[_0x4d802b(0x1ac)]&&_0x145670){const _0x501d44=_0x318192[_0x4d802b(0x1ac)];let _0x149537=_0x145670[_0x4d802b(0x1ac)];try{_0x149537=JSON[_0x4d802b(0x147)](_0x149537);}catch(_0x307122){}_0xede16f[_0x4d802b(0x1a3)][_0x4d802b(0x19c)](_0x4d802b(0x141)+_0x501d44+'\x20=\x20'+_0x149537),await _0xede16f['setForeignStateAsync'](_0x501d44,_0x149537);}else _0xede16f[_0x4d802b(0x1a3)][_0x4d802b(0x19a)](_0x4d802b(0x192));}catch(_0x4b41f7){_0xede16f[_0x4d802b(0x1a3)][_0x4d802b(0x158)](_0x4d802b(0x13d)+_0x4b41f7[_0x4d802b(0x152)]);}}async function sendMorningBriefing(_0x3542b1){const _0x1b8939=a0_0x330029;if(!_0x3542b1[_0x1b8939(0x138)]){_0x3542b1[_0x1b8939(0x1a3)]['warn']('ü§ñ\x20Morning\x20Briefing\x20skipped:\x20No\x20Gemini\x20Model.');return;}_0x3542b1[_0x1b8939(0x1a3)][_0x1b8939(0x19c)](_0x1b8939(0x1c1));try{updateApiTimestamp();const _0x2817fc=_0x1b8939(0x189),_0x583e01=await _0x3542b1[_0x1b8939(0x138)][_0x1b8939(0x1c9)](_0x2817fc),_0x154caa=_0x583e01[_0x1b8939(0x1ab)][_0x1b8939(0x15a)]();_0x3542b1[_0x1b8939(0x1a3)][_0x1b8939(0x19c)]('üåÖ\x20Briefing\x20generated\x20(Length:\x20'+_0x154caa[_0x1b8939(0x1a7)]+_0x1b8939(0x17a)),setup[_0x1b8939(0x151)](_0x3542b1,'üåÖ\x20Morning\x20Briefing:\x0a'+_0x154caa);}catch(_0x48068f){_0x3542b1[_0x1b8939(0x1a3)][_0x1b8939(0x158)](_0x1b8939(0x15d)+_0x48068f[_0x1b8939(0x152)]);}}function a0_0x3389(){const _0x6447b5=['Keine\x20Details.','analysis.analysisHistory','warn','baselineDrift','info','.\x20EVENTS:\x20','analysis.automation.targetValue','normal','Success','\x0a\x20\x20\x20\x20EVENTS:\x0a','filter','log','toString','734684wKksAW','25XkwGrV','length','debug','config','weatherInstance','response','val','Skipped\x20(No\x20AI\x20or\x20Data)','automationProposal','PRIORIT√ÑT:\x20Sicherheit\x20und\x20Licht.\x20Schalte\x20lieber\x20einmal\x20zu\x20viel\x20als\x20zu\x20wenig.','880850nDiwJw','ROLLE:\x20Data\x20Compression\x20Agent.\x20SPRACHE:\x20DE.\x20FORMAT:\x20JSON.\x20ANWEISUNG:\x20Fasse\x20Sensor-Events\x20zusammen.\x20SCHEMA:\x20{\x20\x22summary\x22:\x20\x22string\x22,\x20\x22activityLevel\x22:\x20\x22string\x22\x20}\x20\x0a\x0aEVENTS:\x0a','toFixed','.Current.IsNight','isProVersion','NIGHT','name','Unbekannt','useWeather','LTM.driftAnalysis.baselineDrift','currentSystemMode','22MtljYW','.Current.Temperature','Analysiere\x20diese\x20Events\x20des\x20TAGES\x20(08:00-Jetzt).\x20Aktivit√§t?\x20Mahlzeiten?\x20Haust√ºr?\x20Antwort\x20kurz\x20f√ºr\x20den\x20besorgten\x20Sohn\x20(max\x202\x20S√§tze).','alertReason','replace','isAlert','üåÖ\x20Starting\x20Morning\x20Briefing\x20sequence\x20(Traffic\x20Check\x20bypassed)...','generic','Fokus\x20auf\x20Komfort\x20f√ºr\x20die\x20Familie.','(((.+)+)+)+$','eventHistory','join','Traffic-Schutz\x20(Auto-Approved)','splice','generateContent','\x0a\x20\x20\x20\x20ANTWORT-STIL:\x20Sachlich,\x20beruhigend,\x20pr√§zise.\x20Keine\x20Floskeln.\x0a\x20\x20\x20\x20','ü§ñ\x20Autopilot\x20skipped\x20(Traffic\x20Protection\x20active).','LTM.processingStatus','Wetterdaten\x20nicht\x20abrufbar','¬∞C,\x20','exports','304Delbpy','setStateAsync','targetId','analysis.automation.patternDetected','ltmLtbWindowDays','59274vwOCGl','slice','geminiModel','value','rawEventLog','analysis.isAlert','analysisHistory','BUTLER\x20Execution\x20Error:\x20','livingContext','trim','send','ü§ñ\x20BUTLER:\x20Executing\x20Action\x20->\x20','Skipped\x20(Traffic)','summary','analysis.health.geminiNight','search','timestamp','parse',',\x20Lichtverh√§ltnisse:\x20','getForeignStateAsync','@google/generative-ai','setHours','PRIORIT√ÑT:\x20Energie\x20sparen.\x20Schalte\x20nur,\x20wenn\x20absolut\x20notwendig\x20(Dunkelheit).','\x22.\x0a\x20\x20\x20\x20AKTION:\x20Schalte\x20\x22','.Current.WeatherText','activityLevel','1850492ZbkEde','sendNotification','message','reason','analysis.health.geminiDay','Health\x20Report\x20Error:\x20','.\x20EMERGENCY:\x20','isEmergency','error','70050XqMOEH','text','üìÖ\x20Daily\x20Digest:\x0a','LTM.rawEventLog','Briefing\x20Error:\x20','lastAlertState','Keine\x20Daten\x20f√ºr\x20die\x20Nacht\x20aufgezeichnet\x20(Sensoren\x20ruhig).','getTime','.\x0a\x20\x20\x20\x20EVENT:\x20Bewohner\x20geht\x20wahrscheinlich\x20(','\x0a\x20\x20\x20\x20ROLLE:\x20Medizinischer\x20Assistent\x20f√ºr\x20AAL\x20(Ambient\x20Assisted\x20Living).\x0a\x20\x20\x20\x20AUFGABE:\x20','toLocaleTimeString','\x0a\x20\x20\x20\x20ROLLE:\x20Haus-Butler.\x0a\x20\x20\x20\x20SITUATION:\x20','ü§ñ\x20API\x20Cooldown.\x20Waiting\x202s...','analysis.automation.description','.forecast.current.temperature','decision','getStateAsync','LTM.driftAnalysis.driftDetails','dailyDigests','4345010oxwkCH','push',',\x20Wetter:\x20','description','Digest','Bisher\x20keine\x20Aktivit√§t\x20seit\x2008:00\x20Uhr\x20verzeichnet.','12RyxqUm','system.presenceWho','\x20√ºbersprungen\x20(Auto-Approved).','analysis.automation.autoApply','pop','2-digit','.\x20AUFGABE:\x201.\x20Gesundheit?\x202.\x20Komfort?\x20FORMAT\x20(JSON):\x20{\x20\x22isAlert\x22:\x20boolean,\x20\x22alertReason\x22:\x20\x22string\x22,\x20\x22isEmergency\x22:\x20boolean,\x20\x22summary\x22:\x20\x22string\x22,\x20\x22automationProposal\x22:\x20{\x20\x22detected\x22:\x20boolean,\x20\x22description\x22:\x20\x22string\x22,\x20\x22targetId\x22:\x20\x22string\x22,\x20\x22targetValue\x22:\x20\x22any\x22\x20}\x20}','‚ö†Ô∏è\x20ALARM:\x20',').\x20Sending\x20notification...','ü§ñ\x20Butler\x20Brain\x20Error:\x20',')\x20generated.','ROLLE:\x20Data\x20Scientist.\x20ZIEL:\x20Drift\x20erkennen.\x20SCHEMA:\x20{\x20\x22baselineDrift\x22:\x20\x22none|slight|significant|critical\x22,\x20\x22driftDetails\x22:\x20\x22string\x22\x20}\x0a\x0aLTB:\x20','ANALYZE_HEALTH','N/A\x20(Learning)','apply','detected','.forecast.current.state','map','analysis.automation.targetId','Nacht','Started...','stringify','Entscheide\x20ausgewogen\x20zwischen\x20Komfort\x20und\x20Energie.','Erstelle\x20ein\x20kurzes\x20\x27Guten\x20Morgen\x27\x20Briefing\x20basierend\x20auf\x20den\x20Events\x20der\x20letzten\x20Nacht.','204200rqXpyj','analysis.activitySummary','now','LTM.driftAnalysis.lastCheck','.\x20KONTEXT:\x20','analysis.lastResult','constructor','targetValue','ü§ñ\x20BUTLER:\x20No\x20valid\x20target\x20ID\x20or\x20value\x20stored\x20for\x20execution.','unshift','ltmStbWindowDays','\x22\x20AN.\x0a\x20\x20\x20\x20STRATEGIE:\x20','\x0a\x20\x20\x20\x20FRAGE:\x20Ist\x20es\x20dunkel\x20genug\x20f√ºr\x20Licht?\x0a\x20\x20\x20\x20FORMAT:\x20{\x20\x22approved\x22:\x20boolean,\x20\x22reason\x22:\x20\x22kurzer\x20Grund\x22\x20}\x0a\x20\x20\x20\x20','Maximaler\x20Komfort,\x20Energie\x20ist\x20zweitrangig.'];a0_0x3389=function(){return _0x6447b5;};return a0_0x3389();}async function generateHealthReport(_0x5030db,_0x4f6b97){const _0x39a83d=a0_0x330029;if(!_0x5030db[_0x39a83d(0x138)])return;const _0x245077=Date[_0x39a83d(0x18c)]();_0x245077-lastGlobalApiCall<0xbb8&&(_0x5030db['log'][_0x39a83d(0x1a8)](_0x39a83d(0x165)),await new Promise(_0x2ad723=>setTimeout(_0x2ad723,0x7d0)));const _0x4d9e8c=new Date();let _0x6aca8=0x0,_0x4ead85=_0x4d9e8c[_0x39a83d(0x160)](),_0x2e78ea='';if(_0x4f6b97==='NIGHT'){const _0x3f95c5=new Date(_0x4d9e8c);_0x3f95c5['setDate'](_0x3f95c5['getDate']()-0x1),_0x3f95c5[_0x39a83d(0x14b)](0x16,0x0,0x0,0x0),_0x6aca8=_0x3f95c5['getTime']();const _0x22a6c8=new Date(_0x4d9e8c);_0x22a6c8[_0x39a83d(0x14b)](0x8,0x0,0x0,0x0),_0x4ead85=_0x22a6c8[_0x39a83d(0x160)](),_0x2e78ea='Analysiere\x20diese\x20Events\x20der\x20NACHT\x20(22:00-08:00).\x20War\x20der\x20Schlaf\x20ruhig?\x20Gab\x20es\x20Badg√§nge?\x20Antwort\x20kurz\x20f√ºr\x20den\x20besorgten\x20Sohn\x20(max\x202\x20S√§tze).';}else{const _0x48d2f0=new Date(_0x4d9e8c);_0x48d2f0['setHours'](0x8,0x0,0x0,0x0),_0x6aca8=_0x48d2f0[_0x39a83d(0x160)](),_0x2e78ea=_0x39a83d(0x1bd);}const _0x50b590=_0x5030db['eventHistory'][_0x39a83d(0x1a2)](_0x487a3c=>_0x487a3c['timestamp']>=_0x6aca8&&_0x487a3c[_0x39a83d(0x146)]<=_0x4ead85);if(_0x50b590[_0x39a83d(0x1a7)]===0x0){const _0x3c0a84=_0x4f6b97===_0x39a83d(0x1b5)?_0x39a83d(0x15f):_0x39a83d(0x171),_0x1ea224=_0x4f6b97===_0x39a83d(0x1b5)?_0x39a83d(0x144):_0x39a83d(0x154);await _0x5030db['setStateAsync'](_0x1ea224,{'val':_0x3c0a84,'ack':!![]});return;}const _0x4a5378=_0x50b590[_0x39a83d(0x183)](_0x570851=>new Date(_0x570851[_0x39a83d(0x146)])['toLocaleTimeString']([],{'hour':_0x39a83d(0x177),'minute':_0x39a83d(0x177)})+'\x20'+_0x570851[_0x39a83d(0x1b6)]+'\x20('+_0x570851[_0x39a83d(0x139)]+')')[_0x39a83d(0x1c6)]('\x0a'),_0x58e137=_0x39a83d(0x162)+_0x2e78ea+_0x39a83d(0x1a1)+_0x4a5378+_0x39a83d(0x1ca);try{updateApiTimestamp();const _0x2f75c0=await _0x5030db['geminiModel'][_0x39a83d(0x1c9)](_0x58e137),_0x4d1d6e=_0x2f75c0[_0x39a83d(0x1ab)][_0x39a83d(0x15a)](),_0x462c3f=_0x4f6b97==='NIGHT'?_0x39a83d(0x144):_0x39a83d(0x154);await _0x5030db[_0x39a83d(0x132)](_0x462c3f,{'val':_0x4d1d6e,'ack':!![]}),_0x5030db[_0x39a83d(0x1a3)]['info']('ü§ñ\x20Health\x20Report\x20('+_0x4f6b97+_0x39a83d(0x17c));}catch(_0xc78eba){_0x5030db[_0x39a83d(0x1a3)]['error'](_0x39a83d(0x155)+_0xc78eba[_0x39a83d(0x152)]);}}module[a0_0x330029(0x130)]={'executeAutomationAction':executeAutomationAction,'createDailyDigest':createDailyDigest,'runBaselineDriftAnalysis':runBaselineDriftAnalysis,'sendMorningBriefing':sendMorningBriefing,'runGeminiAnalysis':runGeminiAnalysis,'consultButler':consultButler,'generateHealthReport':generateHealthReport};