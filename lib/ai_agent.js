const a0_0x14eb94=a0_0x271d;(function(_0x3c4cdd,_0x357dfd){const _0x13d11e=a0_0x271d,_0x311cab=_0x3c4cdd();while(!![]){try{const _0xc660d0=parseInt(_0x13d11e(0x136))/0x1+-parseInt(_0x13d11e(0x19f))/0x2+parseInt(_0x13d11e(0x133))/0x3+parseInt(_0x13d11e(0x1c6))/0x4*(-parseInt(_0x13d11e(0x144))/0x5)+-parseInt(_0x13d11e(0x169))/0x6+parseInt(_0x13d11e(0x182))/0x7+-parseInt(_0x13d11e(0x17f))/0x8;if(_0xc660d0===_0x357dfd)break;else _0x311cab['push'](_0x311cab['shift']());}catch(_0x37675f){_0x311cab['push'](_0x311cab['shift']());}}}(a0_0x8730,0xc8faa));const a0_0x3e2416=(function(){let _0x452891=!![];return function(_0x3f5a12,_0x588e81){const _0x1aca2b=_0x452891?function(){if(_0x588e81){const _0x515c02=_0x588e81['apply'](_0x3f5a12,arguments);return _0x588e81=null,_0x515c02;}}:function(){};return _0x452891=![],_0x1aca2b;};}()),a0_0x5be31a=a0_0x3e2416(this,function(){const _0x3ffc00=a0_0x271d;return a0_0x5be31a[_0x3ffc00(0x132)]()[_0x3ffc00(0x1cc)](_0x3ffc00(0x149))[_0x3ffc00(0x132)]()[_0x3ffc00(0x1a1)](a0_0x5be31a)[_0x3ffc00(0x1cc)]('(((.+)+)+)+$');});a0_0x5be31a();'use strict';const {GoogleGenerativeAI}=require(a0_0x14eb94(0x140)),setup=require('./setup'),GEMINI_MODEL=a0_0x14eb94(0x14a),LTM_DP_DAILY_DIGESTS=a0_0x14eb94(0x18b),LTM_DP_STATUS=a0_0x14eb94(0x1c1),LTM_DP_RAW_LOG='LTM.rawEventLog',LTM_MIN_EVENTS_FOR_COMPRESSION=0x5,MIN_API_GAP_MS=0x4e20;let lastGlobalApiCall=0x0;const decisionCache={},CACHE_TTL_MS=0xf*0x3c*0x3e8,PERSONA_MAPPING={'generic':a0_0x14eb94(0x165),'senior_aal':a0_0x14eb94(0x1af),'family':a0_0x14eb94(0x146),'single_comfort':a0_0x14eb94(0x1cd),'security':a0_0x14eb94(0x15d),'energy_saver':'PRIORIT√ÑT:\x20Energie\x20sparen.\x20Schalte\x20nur,\x20wenn\x20absolut\x20notwendig\x20(Dunkelheit).'};function canCallApi(){const _0x397f0a=a0_0x14eb94,_0xf7e3d=Date[_0x397f0a(0x193)]();return _0xf7e3d-lastGlobalApiCall>MIN_API_GAP_MS;}function updateApiTimestamp(){const _0x32d604=a0_0x14eb94;lastGlobalApiCall=Date[_0x32d604(0x193)]();}async function getWeatherContext(_0x540c23){const _0x444031=a0_0x14eb94;if(!_0x540c23[_0x444031(0x1aa)][_0x444031(0x189)]||!_0x540c23[_0x444031(0x1aa)][_0x444031(0x1ad)])return _0x444031(0x143);try{const _0x499c3c=_0x540c23[_0x444031(0x1aa)][_0x444031(0x1ad)];let _0x24ffd8=await _0x540c23[_0x444031(0x152)](_0x499c3c+_0x444031(0x13e));if(!_0x24ffd8)_0x24ffd8=await _0x540c23[_0x444031(0x152)](_0x499c3c+'.forecast.current.temperature');let _0x2d6699=await _0x540c23[_0x444031(0x152)](_0x499c3c+_0x444031(0x166));if(!_0x2d6699)_0x2d6699=await _0x540c23[_0x444031(0x152)](_0x499c3c+_0x444031(0x18e));let _0x308be1=_0x444031(0x1ca);const _0x287be3=await _0x540c23[_0x444031(0x152)](_0x499c3c+'.Current.IsNight');if(_0x287be3)_0x308be1=_0x287be3[_0x444031(0x1b3)]?_0x444031(0x1c8):_0x444031(0x157);if(_0x24ffd8&&_0x2d6699)return _0x24ffd8[_0x444031(0x1b3)]+_0x444031(0x180)+_0x2d6699['val']+_0x444031(0x195)+_0x308be1;}catch(_0x2f7c48){}return _0x444031(0x1c4);}async function consultButler(_0xa18618,_0x349160,_0x3486ce,_0x4bfffa){const _0x1e897c=a0_0x14eb94;if(!_0xa18618[_0x1e897c(0x1b0)])return{'approved':!![],'reason':_0x1e897c(0x153)};const _0x1486ec=Date[_0x1e897c(0x193)]();if(decisionCache[_0x349160]&&_0x1486ec-decisionCache[_0x349160][_0x1e897c(0x13f)]<CACHE_TTL_MS){const _0x1bf2c2=decisionCache[_0x349160][_0x1e897c(0x16f)];return _0xa18618[_0x1e897c(0x13a)][_0x1e897c(0x1a2)](_0x1e897c(0x19a)+_0x349160+'\x20->\x20'+(_0x1bf2c2['approved']?'OK':'NO')+'\x20('+_0x1bf2c2[_0x1e897c(0x14f)]+')'),_0x1bf2c2;}if(!canCallApi())return _0xa18618[_0x1e897c(0x13a)][_0x1e897c(0x1a2)]('ü§ñ\x20Traffic\x20Schutz:\x20Anfrage\x20f√ºr\x20'+_0x349160+'\x20√ºbersprungen\x20(Auto-Approved).'),{'approved':!![],'reason':_0x1e897c(0x156)};const _0x3aa901=new Date()[_0x1e897c(0x1a5)](),_0x552d00=await getWeatherContext(_0xa18618),_0x58311b=PERSONA_MAPPING[_0xa18618[_0x1e897c(0x1aa)]['aiPersona']||'generic'],_0x2ccb43='\x0a\x20\x20\x20\x20ROLLE:\x20Haus-Butler.\x0a\x20\x20\x20\x20SITUATION:\x20'+_0x3aa901+_0x1e897c(0x175)+_0x552d00+_0x1e897c(0x154)+(_0x4bfffa*0x64)[_0x1e897c(0x1bc)](0x0)+_0x1e897c(0x1b1)+_0x349160+'\x22.\x0a\x20\x20\x20\x20AKTION:\x20Schalte\x20\x22'+_0x3486ce+_0x1e897c(0x1ae)+_0x58311b+_0x1e897c(0x188);try{updateApiTimestamp();const _0x330e01=await _0xa18618[_0x1e897c(0x1b0)][_0x1e897c(0x1c3)](_0x2ccb43),_0x373f70=_0x330e01[_0x1e897c(0x185)][_0x1e897c(0x18d)]()[_0x1e897c(0x190)](/```json|```/g,'')[_0x1e897c(0x1bb)](),_0x48c786=JSON[_0x1e897c(0x199)](_0x373f70);return decisionCache[_0x349160]={'decision':_0x48c786,'timestamp':_0x1486ec},_0x48c786;}catch(_0x27c300){return _0xa18618[_0x1e897c(0x13a)][_0x1e897c(0x1ac)](_0x1e897c(0x16e)+_0x27c300[_0x1e897c(0x176)]),decisionCache[_0x349160]={'decision':{'approved':!![],'reason':_0x1e897c(0x14e)},'timestamp':_0x1486ec-(CACHE_TTL_MS-0xea60)},{'approved':!![],'reason':_0x1e897c(0x14e)};}}function a0_0x8730(){const _0x4ce17d=['models/gemini-flash-latest','\x0aAktivit√§t:\x20','targetId','.\x20AUFGABE:\x201.\x20Gesundheit?\x202.\x20Komfort?\x20FORMAT\x20(JSON):\x20{\x20\x22isAlert\x22:\x20boolean,\x20\x22alertReason\x22:\x20\x22string\x22,\x20\x22isEmergency\x22:\x20boolean,\x20\x22summary\x22:\x20\x22string\x22,\x20\x22automationProposal\x22:\x20{\x20\x22detected\x22:\x20boolean,\x20\x22description\x22:\x20\x22string\x22,\x20\x22targetId\x22:\x20\x22string\x22,\x20\x22targetValue\x22:\x20\x22any\x22\x20}\x20}','KI-Fehler\x20(Fallback)','reason','Keine\x20Daten\x20f√ºr\x20die\x20Nacht\x20aufgezeichnet\x20(Sensoren\x20ruhig).','alertReason','getForeignStateAsync','KI\x20offline\x20(Fallback)','.\x0a\x20\x20\x20\x20EVENT:\x20Bewohner\x20geht\x20wahrscheinlich\x20(','analysis.automation.targetValue','Traffic-Schutz\x20(Auto-Approved)','Tag','Analysiere\x20diese\x20Events\x20der\x20NACHT\x20(22:00-08:00).\x20War\x20der\x20Schlaf\x20ruhig?\x20Gab\x20es\x20Badg√§nge?\x20Antwort\x20kurz\x20f√ºr\x20den\x20besorgten\x20Sohn\x20(max\x202\x20S√§tze).','Started...','automationProposal','NIGHT','setStateAsync','Sicherheit\x20geht\x20vor.','length','analysis.alertReason','rawEventLog','analysisHistory','Keine\x20Details.','\x0a\x20\x20\x20\x20ROLLE:\x20Medizinischer\x20Assistent\x20f√ºr\x20AAL\x20(Ambient\x20Assisted\x20Living).\x0a\x20\x20\x20\x20AUFGABE:\x20','\x0a\x20\x20\x20\x20ANTWORT-STIL:\x20Sachlich,\x20beruhigend,\x20pr√§zise.\x20Keine\x20Floskeln.\x0a\x20\x20\x20\x20','Entscheide\x20ausgewogen\x20zwischen\x20Komfort\x20und\x20Energie.','.Current.WeatherText','name','slice','3531234rYpQQT','üåÖ\x20Briefing\x20generated\x20(Length:\x20','\x0aSTB:\x20','ROLLE:\x20Data\x20Compression\x20Agent.\x20SPRACHE:\x20DE.\x20FORMAT:\x20JSON.\x20ANWEISUNG:\x20Fasse\x20Sensor-Events\x20zusammen.\x20SCHEMA:\x20{\x20\x22summary\x22:\x20\x22string\x22,\x20\x22activityLevel\x22:\x20\x22string\x22\x20}\x20\x0a\x0aEVENTS:\x0a','setHours','ü§ñ\x20Butler\x20Brain\x20Error:\x20','decision','ü§ñ\x20BUTLER:\x20No\x20valid\x20target\x20ID\x20or\x20value\x20stored\x20for\x20execution.','LTM.driftAnalysis.lastCheck','analysis.isAlert','analysis.automation.patternDetected','setDate',',\x20Wetter:\x20','message','dailyDigests','ROLLE:\x20Data\x20Scientist.\x20ZIEL:\x20Drift\x20erkennen.\x20SCHEMA:\x20{\x20\x22baselineDrift\x22:\x20\x22none|slight|significant|critical\x22,\x20\x22driftDetails\x22:\x20\x22string\x22\x20}\x0a\x0aLTB:\x20','livingContext','exports','toISOString','join','ltmStbWindowDays','splice','2209952APjctW','¬∞C,\x20','Erstelle\x20ein\x20kurzes\x20\x27Guten\x20Morgen\x27\x20Briefing\x20basierend\x20auf\x20den\x20Events\x20der\x20letzten\x20Nacht.','10897488cIQRAR','ANALYZE_HEALTH','Health\x20Report\x20Error:\x20','response','.\x20EVENTS:\x20','ltmLtbWindowDays','\x0a\x20\x20\x20\x20FRAGE:\x20Ist\x20es\x20dunkel\x20genug\x20f√ºr\x20Licht?\x0a\x20\x20\x20\x20FORMAT:\x20{\x20\x22approved\x22:\x20boolean,\x20\x22reason\x22:\x20\x22kurzer\x20Grund\x22\x20}\x0a\x20\x20\x20\x20','useWeather','description','LTM.dailyDigests','activityLevel','text','.forecast.current.state','error','replace','LTM.driftAnalysis.baselineDrift','getStateAsync','now','info',',\x20Lichtverh√§ltnisse:\x20','analysis.automation.targetId','ü§ñ\x20Health\x20Report\x20(','Success','parse','ü§ñ\x20Butler\x20Cache\x20Hit:\x20','Skipped\x20(Traffic)','unshift','Briefing\x20Error:\x20','normal','3180902OZDtQj','analysis.lastResult','constructor','debug','summary','currentSystemMode','toLocaleTimeString','aiPersona','\x20=\x20','analysis.automation.description','.\x20ANWESEND:\x20','config','stringify','warn','weatherInstance','\x22\x20AN.\x0a\x20\x20\x20\x20STRATEGIE:\x20','PRIORIT√ÑT:\x20Sicherheit\x20und\x20Licht.\x20Schalte\x20lieber\x20einmal\x20zu\x20viel\x20als\x20zu\x20wenig.','geminiModel','%)\x20nach\x20\x22','N/A\x20(Learning)','val','üåÖ\x20Starting\x20Morning\x20Briefing\x20sequence\x20(Traffic\x20Check\x20bypassed)...',').\x20Sending\x20notification...','analysis.analysisHistory','eventHistory','getDate','driftDetails','isProVersion','trim','toFixed','2-digit','baselineDrift','.\x20SYSTEM_MODE:\x20','LTM.driftAnalysis.driftDetails','LTM.processingStatus','sendNotification','generateContent','Wetterdaten\x20nicht\x20abrufbar','isAlert','4rQBQAn','filter','Nacht','analysis.automation.autoApply','Unbekannt','Bisher\x20keine\x20Aktivit√§t\x20seit\x2008:00\x20Uhr\x20verzeichnet.','search','Maximaler\x20Komfort,\x20Energie\x20ist\x20zweitrangig.','toString','3681699FSolQn','getTime','analysis.activitySummary','1272123YWYMnT','system.presenceWho','ü§ñ\x20Morning\x20Briefing\x20skipped:\x20No\x20Gemini\x20Model.','value','log','Analysiere\x20diese\x20Events\x20des\x20TAGES\x20(08:00-Jetzt).\x20Aktivit√§t?\x20Mahlzeiten?\x20Haust√ºr?\x20Antwort\x20kurz\x20f√ºr\x20den\x20besorgten\x20Sohn\x20(max\x202\x20S√§tze).','lastAlertState','send','.Current.Temperature','timestamp','@google/generative-ai','analysis.health.geminiDay','ü§ñ\x20API\x20Cooldown.\x20Waiting\x202s...','Unbekannt\x20(Kein\x20Sensor)','3888480HIZGyx','isEmergency','Fokus\x20auf\x20Komfort\x20f√ºr\x20die\x20Familie.','analysis.health.geminiNight','BUTLER\x20Execution\x20Error:\x20','(((.+)+)+)+$'];a0_0x8730=function(){return _0x4ce17d;};return a0_0x8730();}function a0_0x271d(_0x3a6be1,_0x2dc596){const _0x2d361b=a0_0x8730();return a0_0x271d=function(_0x5be31a,_0x3e2416){_0x5be31a=_0x5be31a-0x132;let _0x87308=_0x2d361b[_0x5be31a];return _0x87308;},a0_0x271d(_0x3a6be1,_0x2dc596);}async function runGeminiAnalysis(_0x2efc50,_0x556754=''){const _0x16c6cd=a0_0x14eb94;if(!_0x2efc50[_0x16c6cd(0x1b0)])return;if(!canCallApi()){_0x2efc50[_0x16c6cd(0x13a)]['debug']('ü§ñ\x20Autopilot\x20skipped\x20(Traffic\x20Protection\x20active).');return;}if(_0x2efc50['eventHistory']['length']===0x0)return;const _0x4fb21b=_0x2efc50[_0x16c6cd(0x1b7)]['slice'](0x0,0xf),_0x136fc7=_0x2efc50[_0x16c6cd(0x1a4)],_0x14ee2d=PERSONA_MAPPING[_0x2efc50[_0x16c6cd(0x1aa)][_0x16c6cd(0x1a6)]||'generic'],_0x38fdc1=_0x2efc50[_0x16c6cd(0x1aa)][_0x16c6cd(0x179)]||_0x16c6cd(0x162);let _0x270e75=_0x16c6cd(0x1ca);try{const _0x33b26d=await _0x2efc50[_0x16c6cd(0x192)](_0x16c6cd(0x137));if(_0x33b26d&&_0x33b26d[_0x16c6cd(0x1b3)])_0x270e75=_0x33b26d['val'];}catch(_0x1100cc){}let _0x2acfd5=![];try{const _0xd2fa09=await _0x2efc50[_0x16c6cd(0x192)](_0x16c6cd(0x1c9));if(_0xd2fa09&&_0xd2fa09[_0x16c6cd(0x1b3)])_0x2acfd5=!![];}catch(_0x5205a1){}const _0xe275f='ROLLE:\x20KI-Hausverwalter.\x20PERSONA:\x20'+_0x14ee2d+'.\x20KONTEXT:\x20'+_0x38fdc1+_0x16c6cd(0x1bf)+_0x136fc7+_0x16c6cd(0x1a9)+_0x270e75+_0x16c6cd(0x186)+JSON[_0x16c6cd(0x1ab)](_0x4fb21b)+'.\x20EMERGENCY:\x20'+_0x556754+_0x16c6cd(0x14d);try{updateApiTimestamp();const _0x103dea=await _0x2efc50[_0x16c6cd(0x1b0)][_0x16c6cd(0x1c3)](_0xe275f),_0x2d0461=JSON[_0x16c6cd(0x199)](_0x103dea[_0x16c6cd(0x185)]['text']()[_0x16c6cd(0x190)](/```json|```/g,'')[_0x16c6cd(0x1bb)]());await _0x2efc50[_0x16c6cd(0x15c)](_0x16c6cd(0x1a0),{'val':JSON['stringify'](_0x2d0461),'ack':!![]});if(_0x2d0461['summary'])await _0x2efc50[_0x16c6cd(0x15c)](_0x16c6cd(0x135),{'val':_0x2d0461['summary'],'ack':!![]});const _0x557bbd={'timestamp':Date[_0x16c6cd(0x193)](),'id':Date[_0x16c6cd(0x193)]()[_0x16c6cd(0x132)](),'analysis':{'activity':{'summary':_0x2d0461[_0x16c6cd(0x1a3)],'isAlert':_0x2d0461[_0x16c6cd(0x1c5)],'alertReason':_0x2d0461[_0x16c6cd(0x151)]},'comfort':{'automationProposal':_0x2d0461['automationProposal']}}};_0x2efc50[_0x16c6cd(0x161)][_0x16c6cd(0x19c)](_0x557bbd);if(_0x2efc50[_0x16c6cd(0x161)][_0x16c6cd(0x15e)]>0x32)_0x2efc50[_0x16c6cd(0x161)]['pop']();await _0x2efc50[_0x16c6cd(0x15c)](_0x16c6cd(0x1b6),{'val':JSON[_0x16c6cd(0x1ab)](_0x2efc50[_0x16c6cd(0x161)]),'ack':!![]});const _0xb0530a=_0x2d0461[_0x16c6cd(0x1c5)]||![];_0xb0530a!==_0x2efc50['lastAlertState']&&(await _0x2efc50[_0x16c6cd(0x15c)](_0x16c6cd(0x172),{'val':_0xb0530a,'ack':!![]}),_0x2efc50[_0x16c6cd(0x13c)]=_0xb0530a,_0xb0530a&&(await _0x2efc50[_0x16c6cd(0x15c)](_0x16c6cd(0x15f),{'val':_0x2d0461['alertReason'],'ack':!![]}),setup[_0x16c6cd(0x1c2)](_0x2efc50,'‚ö†Ô∏è\x20ALARM:\x20'+_0x2d0461[_0x16c6cd(0x151)],![],_0x2d0461[_0x16c6cd(0x145)])));if(_0x2d0461[_0x16c6cd(0x15a)]&&_0x2d0461['automationProposal']['detected']){await _0x2efc50[_0x16c6cd(0x15c)](_0x16c6cd(0x173),{'val':!![],'ack':!![]}),await _0x2efc50[_0x16c6cd(0x15c)](_0x16c6cd(0x1a8),{'val':_0x2d0461['automationProposal'][_0x16c6cd(0x18a)],'ack':!![]}),await _0x2efc50[_0x16c6cd(0x15c)]('analysis.automation.targetId',{'val':_0x2d0461[_0x16c6cd(0x15a)][_0x16c6cd(0x14c)],'ack':!![]}),await _0x2efc50['setStateAsync'](_0x16c6cd(0x155),{'val':JSON[_0x16c6cd(0x1ab)](_0x2d0461['automationProposal']['targetValue']),'ack':!![]});if(_0x2acfd5)executeAutomationAction(_0x2efc50);}}catch(_0x4591eb){_0x2efc50[_0x16c6cd(0x13a)][_0x16c6cd(0x18f)]('Gemini\x20Error:\x20'+_0x4591eb[_0x16c6cd(0x176)]);}}async function createDailyDigest(_0x235f57,_0x28be56){const _0x2e016e=a0_0x14eb94;if(!_0x235f57['isProVersion'])return;if(!canCallApi()){await _0x235f57[_0x2e016e(0x15c)](LTM_DP_STATUS,{'val':_0x2e016e(0x19b),'ack':!![]});return;}await _0x235f57[_0x2e016e(0x15c)](LTM_DP_STATUS,{'val':_0x2e016e(0x159),'ack':!![]});if(!_0x235f57[_0x2e016e(0x1b0)]||_0x235f57[_0x2e016e(0x160)][_0x2e016e(0x15e)]<LTM_MIN_EVENTS_FOR_COMPRESSION){await _0x235f57[_0x2e016e(0x15c)](LTM_DP_STATUS,{'val':'Skipped\x20(No\x20AI\x20or\x20Data)','ack':!![]});return;}const _0x4eff58=JSON['parse'](JSON[_0x2e016e(0x1ab)](_0x235f57[_0x2e016e(0x160)])),_0x5d55f0=_0x4eff58[_0x2e016e(0x15e)],_0x865143=_0x2e016e(0x16c)+JSON[_0x2e016e(0x1ab)](_0x4eff58);try{updateApiTimestamp();const _0x30cc47=await _0x235f57[_0x2e016e(0x1b0)][_0x2e016e(0x1c3)](_0x865143),_0x1d59fe=JSON[_0x2e016e(0x199)](_0x30cc47[_0x2e016e(0x185)][_0x2e016e(0x18d)]()[_0x2e016e(0x190)](/```json|```/g,'')[_0x2e016e(0x1bb)]()),_0x1c5a32={'timestamp':new Date()[_0x2e016e(0x17b)](),'eventCount':_0x5d55f0,'summary':_0x1d59fe[_0x2e016e(0x1a3)]||'Digest','activityLevel':_0x1d59fe[_0x2e016e(0x18c)]||_0x2e016e(0x19e),'systemMode':_0x235f57['currentSystemMode']};_0x235f57['dailyDigests']['push'](_0x1c5a32);const _0x5b8670=_0x235f57['config'][_0x2e016e(0x187)]||0x3c;_0x235f57[_0x2e016e(0x177)][_0x2e016e(0x15e)]>_0x5b8670&&_0x235f57[_0x2e016e(0x177)][_0x2e016e(0x17e)](0x0,_0x235f57[_0x2e016e(0x177)][_0x2e016e(0x15e)]-_0x5b8670);await _0x235f57['setStateAsync'](LTM_DP_DAILY_DIGESTS,{'val':JSON['stringify'](_0x235f57['dailyDigests']),'ack':!![]}),_0x235f57[_0x2e016e(0x160)]=[],await _0x235f57['setStateAsync'](LTM_DP_RAW_LOG,{'val':JSON[_0x2e016e(0x1ab)](_0x235f57['rawEventLog']),'ack':!![]}),await _0x235f57['setStateAsync'](LTM_DP_STATUS,{'val':_0x2e016e(0x198),'ack':!![]});const _0x5b1b2b='üìÖ\x20Daily\x20Digest:\x0a'+_0x1d59fe[_0x2e016e(0x1a3)]+_0x2e016e(0x14b)+_0x1d59fe[_0x2e016e(0x18c)];setup[_0x2e016e(0x1c2)](_0x235f57,_0x5b1b2b,![],![]);if(_0x235f57[_0x2e016e(0x1ba)]&&_0x28be56)_0x28be56[_0x2e016e(0x13d)](_0x235f57,_0x2e016e(0x183),{'digest':_0x1c5a32});}catch(_0x3b6efb){_0x235f57[_0x2e016e(0x13a)][_0x2e016e(0x18f)](_0x3b6efb[_0x2e016e(0x176)]);}}async function runBaselineDriftAnalysis(_0x5b2bdf){const _0x1e31b6=a0_0x14eb94;if(!_0x5b2bdf[_0x1e31b6(0x1ba)]||!_0x5b2bdf[_0x1e31b6(0x1b0)])return;if(!canCallApi())return;const _0x20e4c9=_0x5b2bdf[_0x1e31b6(0x1aa)][_0x1e31b6(0x17d)]||0xe;if(_0x5b2bdf[_0x1e31b6(0x177)][_0x1e31b6(0x15e)]<_0x20e4c9+0x7){await _0x5b2bdf['setStateAsync'](_0x1e31b6(0x191),{'val':_0x1e31b6(0x1b2),'ack':!![]});return;}const _0x534f8c=_0x5b2bdf[_0x1e31b6(0x177)][_0x1e31b6(0x168)](-_0x20e4c9),_0x26b36e=_0x5b2bdf[_0x1e31b6(0x177)][_0x1e31b6(0x168)](0x0,_0x5b2bdf['dailyDigests'][_0x1e31b6(0x15e)]-_0x20e4c9),_0x571df4=_0x1e31b6(0x178)+JSON[_0x1e31b6(0x1ab)](_0x26b36e)+_0x1e31b6(0x16b)+JSON[_0x1e31b6(0x1ab)](_0x534f8c);try{updateApiTimestamp();const _0x6d3c66=await _0x5b2bdf['geminiModel'][_0x1e31b6(0x1c3)](_0x571df4),_0x1b46e2=JSON[_0x1e31b6(0x199)](_0x6d3c66['response'][_0x1e31b6(0x18d)]()[_0x1e31b6(0x190)](/```json|```/g,'')['trim']());_0x1b46e2[_0x1e31b6(0x1be)]&&(await _0x5b2bdf[_0x1e31b6(0x15c)]('LTM.driftAnalysis.baselineDrift',{'val':_0x1b46e2[_0x1e31b6(0x1be)],'ack':!![]}),await _0x5b2bdf[_0x1e31b6(0x15c)](_0x1e31b6(0x1c0),{'val':_0x1b46e2[_0x1e31b6(0x1b9)],'ack':!![]}),await _0x5b2bdf[_0x1e31b6(0x15c)](_0x1e31b6(0x171),{'val':Date[_0x1e31b6(0x193)](),'ack':!![]}));}catch(_0x2baa48){}}async function executeAutomationAction(_0xef9827){const _0x417c84=a0_0x14eb94;try{const _0x1ed7e5=await _0xef9827[_0x417c84(0x192)](_0x417c84(0x196)),_0x181564=await _0xef9827[_0x417c84(0x192)](_0x417c84(0x155));if(_0x1ed7e5&&_0x1ed7e5[_0x417c84(0x1b3)]&&_0x181564){const _0x379690=_0x1ed7e5['val'];let _0x516b42=_0x181564[_0x417c84(0x1b3)];try{_0x516b42=JSON[_0x417c84(0x199)](_0x516b42);}catch(_0x455e3d){}_0xef9827[_0x417c84(0x13a)][_0x417c84(0x194)]('ü§ñ\x20BUTLER:\x20Executing\x20Action\x20->\x20'+_0x379690+_0x417c84(0x1a7)+_0x516b42),await _0xef9827['setForeignStateAsync'](_0x379690,_0x516b42);}else _0xef9827[_0x417c84(0x13a)][_0x417c84(0x1ac)](_0x417c84(0x170));}catch(_0x3a115a){_0xef9827[_0x417c84(0x13a)][_0x417c84(0x18f)](_0x417c84(0x148)+_0x3a115a[_0x417c84(0x176)]);}}async function sendMorningBriefing(_0x1af181){const _0x51d2c5=a0_0x14eb94;if(!_0x1af181[_0x51d2c5(0x1b0)]){_0x1af181[_0x51d2c5(0x13a)][_0x51d2c5(0x1ac)](_0x51d2c5(0x138));return;}_0x1af181['log'][_0x51d2c5(0x194)](_0x51d2c5(0x1b4));try{updateApiTimestamp();const _0xd0a9d2=_0x51d2c5(0x181),_0x57c515=await _0x1af181[_0x51d2c5(0x1b0)]['generateContent'](_0xd0a9d2),_0x537b5e=_0x57c515[_0x51d2c5(0x185)]['text']();_0x1af181[_0x51d2c5(0x13a)]['info'](_0x51d2c5(0x16a)+_0x537b5e[_0x51d2c5(0x15e)]+_0x51d2c5(0x1b5)),setup[_0x51d2c5(0x1c2)](_0x1af181,'üåÖ\x20Morning\x20Briefing:\x0a'+_0x537b5e);}catch(_0x4b4fa4){_0x1af181[_0x51d2c5(0x13a)][_0x51d2c5(0x18f)](_0x51d2c5(0x19d)+_0x4b4fa4[_0x51d2c5(0x176)]);}}async function generateHealthReport(_0x4c3405,_0x15786c){const _0x39e93a=a0_0x14eb94;if(!_0x4c3405[_0x39e93a(0x1b0)])return;const _0x190f36=Date[_0x39e93a(0x193)]();_0x190f36-lastGlobalApiCall<0xbb8&&(_0x4c3405['log'][_0x39e93a(0x1a2)](_0x39e93a(0x142)),await new Promise(_0x2f9935=>setTimeout(_0x2f9935,0x7d0)));const _0x466cfe=new Date();let _0xb6059=0x0,_0x1f2ead=_0x466cfe[_0x39e93a(0x134)](),_0x3e4ea5='';if(_0x15786c==='NIGHT'){const _0x1bbe08=new Date(_0x466cfe);_0x1bbe08[_0x39e93a(0x174)](_0x1bbe08[_0x39e93a(0x1b8)]()-0x1),_0x1bbe08[_0x39e93a(0x16d)](0x16,0x0,0x0,0x0),_0xb6059=_0x1bbe08[_0x39e93a(0x134)]();const _0x2ed9c1=new Date(_0x466cfe);_0x2ed9c1[_0x39e93a(0x16d)](0x8,0x0,0x0,0x0),_0x1f2ead=_0x2ed9c1[_0x39e93a(0x134)](),_0x3e4ea5=_0x39e93a(0x158);}else{const _0x3b828c=new Date(_0x466cfe);_0x3b828c[_0x39e93a(0x16d)](0x8,0x0,0x0,0x0),_0xb6059=_0x3b828c[_0x39e93a(0x134)](),_0x3e4ea5=_0x39e93a(0x13b);}const _0x230539=_0x4c3405['eventHistory'][_0x39e93a(0x1c7)](_0x57b31e=>_0x57b31e['timestamp']>=_0xb6059&&_0x57b31e[_0x39e93a(0x13f)]<=_0x1f2ead);if(_0x230539['length']===0x0){const _0x52e1c7=_0x15786c===_0x39e93a(0x15b)?_0x39e93a(0x150):_0x39e93a(0x1cb),_0xe9264a=_0x15786c===_0x39e93a(0x15b)?'analysis.health.geminiNight':_0x39e93a(0x141);await _0x4c3405[_0x39e93a(0x15c)](_0xe9264a,{'val':_0x52e1c7,'ack':!![]});return;}const _0x1a30a9=_0x230539['map'](_0x1c5d6=>new Date(_0x1c5d6[_0x39e93a(0x13f)])[_0x39e93a(0x1a5)]([],{'hour':'2-digit','minute':_0x39e93a(0x1bd)})+'\x20'+_0x1c5d6[_0x39e93a(0x167)]+'\x20('+_0x1c5d6[_0x39e93a(0x139)]+')')[_0x39e93a(0x17c)]('\x0a'),_0x331317=_0x39e93a(0x163)+_0x3e4ea5+'\x0a\x20\x20\x20\x20EVENTS:\x0a'+_0x1a30a9+_0x39e93a(0x164);try{updateApiTimestamp();const _0x4f3934=await _0x4c3405[_0x39e93a(0x1b0)][_0x39e93a(0x1c3)](_0x331317),_0x428288=_0x4f3934[_0x39e93a(0x185)][_0x39e93a(0x18d)](),_0x222d8c=_0x15786c==='NIGHT'?_0x39e93a(0x147):_0x39e93a(0x141);await _0x4c3405['setStateAsync'](_0x222d8c,{'val':_0x428288,'ack':!![]}),_0x4c3405[_0x39e93a(0x13a)][_0x39e93a(0x194)](_0x39e93a(0x197)+_0x15786c+')\x20generated.');}catch(_0x5155fd){_0x4c3405[_0x39e93a(0x13a)][_0x39e93a(0x18f)](_0x39e93a(0x184)+_0x5155fd[_0x39e93a(0x176)]);}}module[a0_0x14eb94(0x17a)]={'executeAutomationAction':executeAutomationAction,'createDailyDigest':createDailyDigest,'runBaselineDriftAnalysis':runBaselineDriftAnalysis,'sendMorningBriefing':sendMorningBriefing,'runGeminiAnalysis':runGeminiAnalysis,'consultButler':consultButler,'generateHealthReport':generateHealthReport};