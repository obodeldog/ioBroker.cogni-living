const a0_0x1ef89e=a0_0x3d73;(function(_0x38ff53,_0x4272cc){const _0x1fc6cc=a0_0x3d73,_0x46782a=_0x38ff53();while(!![]){try{const _0xdaee78=-parseInt(_0x1fc6cc(0x160))/0x1*(-parseInt(_0x1fc6cc(0x1ad))/0x2)+-parseInt(_0x1fc6cc(0x187))/0x3+parseInt(_0x1fc6cc(0x1be))/0x4*(parseInt(_0x1fc6cc(0x181))/0x5)+parseInt(_0x1fc6cc(0x1c0))/0x6+parseInt(_0x1fc6cc(0x195))/0x7+parseInt(_0x1fc6cc(0x15c))/0x8+-parseInt(_0x1fc6cc(0x1b5))/0x9*(parseInt(_0x1fc6cc(0x167))/0xa);if(_0xdaee78===_0x4272cc)break;else _0x46782a['push'](_0x46782a['shift']());}catch(_0x252de5){_0x46782a['push'](_0x46782a['shift']());}}}(a0_0x95b8,0x5953d));const a0_0x12b1f0=(function(){let _0x15f410=!![];return function(_0x3fe3b2,_0x930a0f){const _0x1bae2e=_0x15f410?function(){const _0x1b8f4f=a0_0x3d73;if(_0x930a0f){const _0x1cee7d=_0x930a0f[_0x1b8f4f(0x16a)](_0x3fe3b2,arguments);return _0x930a0f=null,_0x1cee7d;}}:function(){};return _0x15f410=![],_0x1bae2e;};}()),a0_0x3a3075=a0_0x12b1f0(this,function(){const _0x2dd426=a0_0x3d73;return a0_0x3a3075[_0x2dd426(0x18d)]()[_0x2dd426(0x16b)]('(((.+)+)+)+$')[_0x2dd426(0x18d)]()[_0x2dd426(0x1d4)](a0_0x3a3075)[_0x2dd426(0x16b)]('(((.+)+)+)+$');});a0_0x3a3075();'use strict';function a0_0x95b8(){const _0x32005f=['Digest','apply','search','getDate','Briefing\x20Error:\x20','.\x20EMERGENCY:\x20','Nacht','approved','setHours','info','.forecast.current.state','getForeignStateAsync','analysis.automation.targetValue','Skipped\x20(No\x20AI\x20or\x20Data)','¬∞C,\x20','./setup','\x0a\x20\x20\x20\x20EVENTS:\x0a','automationProposal','ü§ñ\x20Traffic\x20Schutz:\x20Anfrage\x20f√ºr\x20','warn','dailyDigests','generateContent','LTM.driftAnalysis.driftDetails','LTM.driftAnalysis.baselineDrift','258895DmJTXf','2-digit','text','aiPersona','\x0a\x20\x20\x20\x20ROLLE:\x20Haus-Butler.\x0a\x20\x20\x20\x20SITUATION:\x20','normal','2058207SiXimE','analysis.analysisHistory','\x20=\x20','KI-Fehler\x20(Fallback)','baselineDrift','toLocaleTimeString','toString','pop','targetValue','.\x20KONTEXT:\x20','PRIORIT√ÑT:\x20Sicherheit\x20und\x20Licht.\x20Schalte\x20lieber\x20einmal\x20zu\x20viel\x20als\x20zu\x20wenig.','toFixed','üåÖ\x20Starting\x20Morning\x20Briefing\x20sequence\x20(Traffic\x20Check\x20bypassed)...','\x20->\x20','4215582qLpDhs','\x22\x20AN.\x0a\x20\x20\x20\x20STRATEGIE:\x20','activityLevel','isProVersion','eventHistory','analysis.health.geminiNight','log','.Current.WeatherText','response','Bisher\x20keine\x20Aktivit√§t\x20seit\x2008:00\x20Uhr\x20verzeichnet.','splice','LTM.driftAnalysis.lastCheck','Unbekannt',')\x20generated.','.\x0a\x20\x20\x20\x20EVENT:\x20Bewohner\x20geht\x20wahrscheinlich\x20(','driftDetails','analysis.activitySummary','ü§ñ\x20BUTLER:\x20No\x20valid\x20target\x20ID\x20or\x20value\x20stored\x20for\x20execution.','analysis.automation.autoApply','analysis.automation.description','NIGHT','generic','üåÖ\x20Morning\x20Briefing:\x0a','ü§ñ\x20Morning\x20Briefing\x20skipped:\x20No\x20Gemini\x20Model.','67286GkwACS','length','\x0a\x20\x20\x20\x20ANTWORT-STIL:\x20Sachlich,\x20beruhigend,\x20pr√§zise.\x20Keine\x20Floskeln.\x0a\x20\x20\x20\x20','üìÖ\x20Daily\x20Digest:\x0a','Entscheide\x20ausgewogen\x20zwischen\x20Komfort\x20und\x20Energie.','\x0aSTB:\x20','summary','analysis.isAlert','8307333NLQptz','map','filter','Traffic-Schutz\x20(Auto-Approved)','slice','system.presenceWho','ü§ñ\x20Autopilot\x20skipped\x20(Traffic\x20Protection\x20active).','isAlert','analysis.automation.targetId','36BuBhWW','Fokus\x20auf\x20Komfort\x20f√ºr\x20die\x20Familie.','756828yxhCMg','setDate','.Current.IsNight','unshift','Maximaler\x20Komfort,\x20Energie\x20ist\x20zweitrangig.','Analysiere\x20diese\x20Events\x20des\x20TAGES\x20(08:00-Jetzt).\x20Aktivit√§t?\x20Mahlzeiten?\x20Haust√ºr?\x20Antwort\x20kurz\x20f√ºr\x20den\x20besorgten\x20Sohn\x20(max\x202\x20S√§tze).','Health\x20Report\x20Error:\x20','isEmergency','\x20√ºbersprungen\x20(Auto-Approved).','@google/generative-ai','analysis.lastResult','stringify','description','.Current.Temperature','toISOString','getTime','analysisHistory','N/A\x20(Learning)','ROLLE:\x20KI-Hausverwalter.\x20PERSONA:\x20','useWeather','constructor','\x22.\x0a\x20\x20\x20\x20AKTION:\x20Schalte\x20\x22','targetId','val','config','weatherInstance','ü§ñ\x20API\x20Cooldown.\x20Waiting\x202s...','analysis.automation.patternDetected','debug','Tag','Analysiere\x20diese\x20Events\x20der\x20NACHT\x20(22:00-08:00).\x20War\x20der\x20Schlaf\x20ruhig?\x20Gab\x20es\x20Badg√§nge?\x20Antwort\x20kurz\x20f√ºr\x20den\x20besorgten\x20Sohn\x20(max\x202\x20S√§tze).','alertReason','geminiModel','value','timestamp','message','.\x20EVENTS:\x20','LTM.rawEventLog','Success','currentSystemMode','\x0a\x20\x20\x20\x20FRAGE:\x20Ist\x20es\x20dunkel\x20genug\x20f√ºr\x20Licht?\x0a\x20\x20\x20\x20FORMAT:\x20{\x20\x22approved\x22:\x20boolean,\x20\x22reason\x22:\x20\x22kurzer\x20Grund\x22\x20}\x0a\x20\x20\x20\x20','PRIORIT√ÑT:\x20Energie\x20sparen.\x20Schalte\x20nur,\x20wenn\x20absolut\x20notwendig\x20(Dunkelheit).','name','push','analysis.health.geminiDay','Erstelle\x20ein\x20kurzes\x20\x27Guten\x20Morgen\x27\x20Briefing\x20basierend\x20auf\x20den\x20Events\x20der\x20letzten\x20Nacht.','ROLLE:\x20Data\x20Scientist.\x20ZIEL:\x20Drift\x20erkennen.\x20SCHEMA:\x20{\x20\x22baselineDrift\x22:\x20\x22none|slight|significant|critical\x22,\x20\x22driftDetails\x22:\x20\x22string\x22\x20}\x0a\x0aLTB:\x20','%)\x20nach\x20\x22','replace','setStateAsync','join','parse','Started...','.\x20ANWESEND:\x20','trim','now','rawEventLog','3284344GwZpwP','sendNotification','error','detected','11lphVeh','getStateAsync','Keine\x20Details.','lastAlertState','\x0a\x20\x20\x20\x20ROLLE:\x20Medizinischer\x20Assistent\x20f√ºr\x20AAL\x20(Ambient\x20Assisted\x20Living).\x0a\x20\x20\x20\x20AUFGABE:\x20',').\x20Sending\x20notification...',',\x20Wetter:\x20','10FvvOrQ','ROLLE:\x20Data\x20Compression\x20Agent.\x20SPRACHE:\x20DE.\x20FORMAT:\x20JSON.\x20ANWEISUNG:\x20Fasse\x20Sensor-Events\x20zusammen.\x20SCHEMA:\x20{\x20\x22summary\x22:\x20\x22string\x22,\x20\x22activityLevel\x22:\x20\x22string\x22\x20}\x20\x0a\x0aEVENTS:\x0a'];a0_0x95b8=function(){return _0x32005f;};return a0_0x95b8();}const {GoogleGenerativeAI}=require(a0_0x1ef89e(0x1c9)),setup=require(a0_0x1ef89e(0x178)),GEMINI_MODEL='models/gemini-flash-latest',LTM_DP_DAILY_DIGESTS='LTM.dailyDigests',LTM_DP_STATUS='LTM.processingStatus',LTM_DP_RAW_LOG=a0_0x1ef89e(0x1e5),LTM_MIN_EVENTS_FOR_COMPRESSION=0x5,MIN_API_GAP_MS=0x4e20;let lastGlobalApiCall=0x0;const decisionCache={},CACHE_TTL_MS=0xf*0x3c*0x3e8,PERSONA_MAPPING={'generic':a0_0x1ef89e(0x1b1),'senior_aal':a0_0x1ef89e(0x191),'family':a0_0x1ef89e(0x1bf),'single_comfort':a0_0x1ef89e(0x1c4),'security':'Sicherheit\x20geht\x20vor.','energy_saver':a0_0x1ef89e(0x1e9)};function canCallApi(){const _0x3a99c9=a0_0x1ef89e,_0x3604ec=Date[_0x3a99c9(0x15a)]();return _0x3604ec-lastGlobalApiCall>MIN_API_GAP_MS;}function updateApiTimestamp(){const _0x11e42e=a0_0x1ef89e;lastGlobalApiCall=Date[_0x11e42e(0x15a)]();}async function getWeatherContext(_0x1f5764){const _0x2f1051=a0_0x1ef89e;if(!_0x1f5764['config'][_0x2f1051(0x1d3)]||!_0x1f5764[_0x2f1051(0x1d8)][_0x2f1051(0x1d9)])return'Unbekannt\x20(Kein\x20Sensor)';try{const _0x5002a6=_0x1f5764[_0x2f1051(0x1d8)][_0x2f1051(0x1d9)];let _0x3fd1a9=await _0x1f5764[_0x2f1051(0x174)](_0x5002a6+_0x2f1051(0x1cd));if(!_0x3fd1a9)_0x3fd1a9=await _0x1f5764[_0x2f1051(0x174)](_0x5002a6+'.forecast.current.temperature');let _0x4f5dbe=await _0x1f5764[_0x2f1051(0x174)](_0x5002a6+_0x2f1051(0x19c));if(!_0x4f5dbe)_0x4f5dbe=await _0x1f5764[_0x2f1051(0x174)](_0x5002a6+_0x2f1051(0x173));let _0x12e919=_0x2f1051(0x1a1);const _0x174952=await _0x1f5764[_0x2f1051(0x174)](_0x5002a6+_0x2f1051(0x1c2));if(_0x174952)_0x12e919=_0x174952[_0x2f1051(0x1d7)]?_0x2f1051(0x16f):_0x2f1051(0x1dd);if(_0x3fd1a9&&_0x4f5dbe)return _0x3fd1a9[_0x2f1051(0x1d7)]+_0x2f1051(0x177)+_0x4f5dbe[_0x2f1051(0x1d7)]+',\x20Lichtverh√§ltnisse:\x20'+_0x12e919;}catch(_0x57b464){}return'Wetterdaten\x20nicht\x20abrufbar';}async function consultButler(_0x438440,_0x575b1b,_0xd62c46,_0x27a3a0){const _0x1aefe7=a0_0x1ef89e;if(!_0x438440[_0x1aefe7(0x1e0)])return{'approved':!![],'reason':'KI\x20offline\x20(Fallback)'};const _0x4f3abc=Date[_0x1aefe7(0x15a)]();if(decisionCache[_0x575b1b]&&_0x4f3abc-decisionCache[_0x575b1b]['timestamp']<CACHE_TTL_MS){const _0x486697=decisionCache[_0x575b1b]['decision'];return _0x438440['log']['debug']('ü§ñ\x20Butler\x20Cache\x20Hit:\x20'+_0x575b1b+_0x1aefe7(0x194)+(_0x486697[_0x1aefe7(0x170)]?'OK':'NO')+'\x20('+_0x486697['reason']+')'),_0x486697;}if(!canCallApi())return _0x438440[_0x1aefe7(0x19b)][_0x1aefe7(0x1dc)](_0x1aefe7(0x17b)+_0x575b1b+_0x1aefe7(0x1c8)),{'approved':!![],'reason':_0x1aefe7(0x1b8)};const _0x2004ab=new Date()[_0x1aefe7(0x18c)](),_0xf8cbc7=await getWeatherContext(_0x438440),_0x4937e1=PERSONA_MAPPING[_0x438440['config'][_0x1aefe7(0x184)]||_0x1aefe7(0x1aa)],_0x5161b2=_0x1aefe7(0x185)+_0x2004ab+_0x1aefe7(0x166)+_0xf8cbc7+_0x1aefe7(0x1a3)+(_0x27a3a0*0x64)[_0x1aefe7(0x192)](0x0)+_0x1aefe7(0x1ef)+_0x575b1b+_0x1aefe7(0x1d5)+_0xd62c46+_0x1aefe7(0x196)+_0x4937e1+_0x1aefe7(0x1e8);try{updateApiTimestamp();const _0x16d810=await _0x438440[_0x1aefe7(0x1e0)]['generateContent'](_0x5161b2),_0x101825=_0x16d810[_0x1aefe7(0x19d)]['text']()[_0x1aefe7(0x1f0)](/```json|```/g,'')[_0x1aefe7(0x159)](),_0x54fed4=JSON[_0x1aefe7(0x156)](_0x101825);return decisionCache[_0x575b1b]={'decision':_0x54fed4,'timestamp':_0x4f3abc},_0x54fed4;}catch(_0x36a7af){return _0x438440[_0x1aefe7(0x19b)][_0x1aefe7(0x17c)]('ü§ñ\x20Butler\x20Brain\x20Error:\x20'+_0x36a7af[_0x1aefe7(0x1e3)]),decisionCache[_0x575b1b]={'decision':{'approved':!![],'reason':_0x1aefe7(0x18a)},'timestamp':_0x4f3abc-(CACHE_TTL_MS-0xea60)},{'approved':!![],'reason':_0x1aefe7(0x18a)};}}async function runGeminiAnalysis(_0x4571e5,_0x112319=''){const _0x3d2ea6=a0_0x1ef89e;if(!_0x4571e5[_0x3d2ea6(0x1e0)])return;if(!canCallApi()){_0x4571e5['log'][_0x3d2ea6(0x1dc)](_0x3d2ea6(0x1bb));return;}if(_0x4571e5[_0x3d2ea6(0x199)]['length']===0x0)return;const _0x2b8abc=_0x4571e5[_0x3d2ea6(0x199)]['slice'](0x0,0xf),_0x6847f3=_0x4571e5[_0x3d2ea6(0x1e7)],_0x44d30d=PERSONA_MAPPING[_0x4571e5[_0x3d2ea6(0x1d8)]['aiPersona']||_0x3d2ea6(0x1aa)],_0x3246cc=_0x4571e5[_0x3d2ea6(0x1d8)]['livingContext']||_0x3d2ea6(0x162);let _0x5679c7=_0x3d2ea6(0x1a1);try{const _0x149a1a=await _0x4571e5[_0x3d2ea6(0x161)](_0x3d2ea6(0x1ba));if(_0x149a1a&&_0x149a1a[_0x3d2ea6(0x1d7)])_0x5679c7=_0x149a1a[_0x3d2ea6(0x1d7)];}catch(_0x2f25fc){}let _0x6b34fb=![];try{const _0x1c455b=await _0x4571e5[_0x3d2ea6(0x161)](_0x3d2ea6(0x1a7));if(_0x1c455b&&_0x1c455b[_0x3d2ea6(0x1d7)])_0x6b34fb=!![];}catch(_0x1a6b92){}const _0x4bf19b=_0x3d2ea6(0x1d2)+_0x44d30d+_0x3d2ea6(0x190)+_0x3246cc+'.\x20SYSTEM_MODE:\x20'+_0x6847f3+_0x3d2ea6(0x158)+_0x5679c7+_0x3d2ea6(0x1e4)+JSON[_0x3d2ea6(0x1cb)](_0x2b8abc)+_0x3d2ea6(0x16e)+_0x112319+'.\x20AUFGABE:\x201.\x20Gesundheit?\x202.\x20Komfort?\x20FORMAT\x20(JSON):\x20{\x20\x22isAlert\x22:\x20boolean,\x20\x22alertReason\x22:\x20\x22string\x22,\x20\x22isEmergency\x22:\x20boolean,\x20\x22summary\x22:\x20\x22string\x22,\x20\x22automationProposal\x22:\x20{\x20\x22detected\x22:\x20boolean,\x20\x22description\x22:\x20\x22string\x22,\x20\x22targetId\x22:\x20\x22string\x22,\x20\x22targetValue\x22:\x20\x22any\x22\x20}\x20}';try{updateApiTimestamp();const _0x12ff28=await _0x4571e5[_0x3d2ea6(0x1e0)][_0x3d2ea6(0x17e)](_0x4bf19b),_0x3372f9=JSON['parse'](_0x12ff28['response'][_0x3d2ea6(0x183)]()[_0x3d2ea6(0x1f0)](/```json|```/g,'')[_0x3d2ea6(0x159)]());await _0x4571e5[_0x3d2ea6(0x154)](_0x3d2ea6(0x1ca),{'val':JSON[_0x3d2ea6(0x1cb)](_0x3372f9),'ack':!![]});if(_0x3372f9[_0x3d2ea6(0x1b3)])await _0x4571e5[_0x3d2ea6(0x154)](_0x3d2ea6(0x1a5),{'val':_0x3372f9[_0x3d2ea6(0x1b3)],'ack':!![]});const _0xbddbc0={'timestamp':Date['now'](),'id':Date[_0x3d2ea6(0x15a)]()[_0x3d2ea6(0x18d)](),'analysis':{'activity':{'summary':_0x3372f9[_0x3d2ea6(0x1b3)],'isAlert':_0x3372f9[_0x3d2ea6(0x1bc)],'alertReason':_0x3372f9['alertReason']},'comfort':{'automationProposal':_0x3372f9[_0x3d2ea6(0x17a)]}}};_0x4571e5['analysisHistory'][_0x3d2ea6(0x1c3)](_0xbddbc0);if(_0x4571e5[_0x3d2ea6(0x1d0)][_0x3d2ea6(0x1ae)]>0x32)_0x4571e5[_0x3d2ea6(0x1d0)][_0x3d2ea6(0x18e)]();await _0x4571e5[_0x3d2ea6(0x154)](_0x3d2ea6(0x188),{'val':JSON['stringify'](_0x4571e5[_0x3d2ea6(0x1d0)]),'ack':!![]});const _0x1c9f1d=_0x3372f9[_0x3d2ea6(0x1bc)]||![];_0x1c9f1d!==_0x4571e5['lastAlertState']&&(await _0x4571e5[_0x3d2ea6(0x154)](_0x3d2ea6(0x1b4),{'val':_0x1c9f1d,'ack':!![]}),_0x4571e5[_0x3d2ea6(0x163)]=_0x1c9f1d,_0x1c9f1d&&(await _0x4571e5[_0x3d2ea6(0x154)]('analysis.alertReason',{'val':_0x3372f9[_0x3d2ea6(0x1df)],'ack':!![]}),setup[_0x3d2ea6(0x15d)](_0x4571e5,'‚ö†Ô∏è\x20ALARM:\x20'+_0x3372f9[_0x3d2ea6(0x1df)],![],_0x3372f9[_0x3d2ea6(0x1c7)])));if(_0x3372f9['automationProposal']&&_0x3372f9[_0x3d2ea6(0x17a)][_0x3d2ea6(0x15f)]){await _0x4571e5[_0x3d2ea6(0x154)](_0x3d2ea6(0x1db),{'val':!![],'ack':!![]}),await _0x4571e5[_0x3d2ea6(0x154)](_0x3d2ea6(0x1a8),{'val':_0x3372f9['automationProposal'][_0x3d2ea6(0x1cc)],'ack':!![]}),await _0x4571e5['setStateAsync'](_0x3d2ea6(0x1bd),{'val':_0x3372f9['automationProposal'][_0x3d2ea6(0x1d6)],'ack':!![]}),await _0x4571e5['setStateAsync'](_0x3d2ea6(0x175),{'val':JSON['stringify'](_0x3372f9[_0x3d2ea6(0x17a)][_0x3d2ea6(0x18f)]),'ack':!![]});if(_0x6b34fb)executeAutomationAction(_0x4571e5);}}catch(_0x412ab2){_0x4571e5[_0x3d2ea6(0x19b)][_0x3d2ea6(0x15e)]('Gemini\x20Error:\x20'+_0x412ab2[_0x3d2ea6(0x1e3)]);}}async function createDailyDigest(_0xcc78f3,_0x8fdec4){const _0x45ed8f=a0_0x1ef89e;if(!_0xcc78f3[_0x45ed8f(0x198)])return;if(!canCallApi()){await _0xcc78f3[_0x45ed8f(0x154)](LTM_DP_STATUS,{'val':'Skipped\x20(Traffic)','ack':!![]});return;}await _0xcc78f3['setStateAsync'](LTM_DP_STATUS,{'val':_0x45ed8f(0x157),'ack':!![]});if(!_0xcc78f3[_0x45ed8f(0x1e0)]||_0xcc78f3[_0x45ed8f(0x15b)][_0x45ed8f(0x1ae)]<LTM_MIN_EVENTS_FOR_COMPRESSION){await _0xcc78f3[_0x45ed8f(0x154)](LTM_DP_STATUS,{'val':_0x45ed8f(0x176),'ack':!![]});return;}const _0x36c90e=JSON[_0x45ed8f(0x156)](JSON[_0x45ed8f(0x1cb)](_0xcc78f3[_0x45ed8f(0x15b)])),_0x16b10d=_0x36c90e['length'],_0x43a904=_0x45ed8f(0x168)+JSON[_0x45ed8f(0x1cb)](_0x36c90e);try{updateApiTimestamp();const _0x1edfe8=await _0xcc78f3[_0x45ed8f(0x1e0)][_0x45ed8f(0x17e)](_0x43a904),_0x21b00a=JSON['parse'](_0x1edfe8['response'][_0x45ed8f(0x183)]()[_0x45ed8f(0x1f0)](/```json|```/g,'')[_0x45ed8f(0x159)]()),_0x4e34d6={'timestamp':new Date()[_0x45ed8f(0x1ce)](),'eventCount':_0x16b10d,'summary':_0x21b00a[_0x45ed8f(0x1b3)]||_0x45ed8f(0x169),'activityLevel':_0x21b00a[_0x45ed8f(0x197)]||_0x45ed8f(0x186),'systemMode':_0xcc78f3['currentSystemMode']};_0xcc78f3[_0x45ed8f(0x17d)][_0x45ed8f(0x1eb)](_0x4e34d6);const _0x444e64=_0xcc78f3[_0x45ed8f(0x1d8)]['ltmLtbWindowDays']||0x3c;_0xcc78f3[_0x45ed8f(0x17d)][_0x45ed8f(0x1ae)]>_0x444e64&&_0xcc78f3[_0x45ed8f(0x17d)][_0x45ed8f(0x19f)](0x0,_0xcc78f3['dailyDigests'][_0x45ed8f(0x1ae)]-_0x444e64);await _0xcc78f3[_0x45ed8f(0x154)](LTM_DP_DAILY_DIGESTS,{'val':JSON['stringify'](_0xcc78f3['dailyDigests']),'ack':!![]}),_0xcc78f3[_0x45ed8f(0x15b)]=[],await _0xcc78f3[_0x45ed8f(0x154)](LTM_DP_RAW_LOG,{'val':JSON[_0x45ed8f(0x1cb)](_0xcc78f3[_0x45ed8f(0x15b)]),'ack':!![]}),await _0xcc78f3[_0x45ed8f(0x154)](LTM_DP_STATUS,{'val':_0x45ed8f(0x1e6),'ack':!![]});const _0xe9126e=_0x45ed8f(0x1b0)+_0x21b00a[_0x45ed8f(0x1b3)]+'\x0aAktivit√§t:\x20'+_0x21b00a['activityLevel'];setup[_0x45ed8f(0x15d)](_0xcc78f3,_0xe9126e,![],![]);if(_0xcc78f3[_0x45ed8f(0x198)]&&_0x8fdec4)_0x8fdec4['send'](_0xcc78f3,'ANALYZE_HEALTH',{'digest':_0x4e34d6});}catch(_0x5af18c){_0xcc78f3[_0x45ed8f(0x19b)][_0x45ed8f(0x15e)](_0x5af18c['message']);}}function a0_0x3d73(_0x92c08a,_0x28fc19){const _0x53c794=a0_0x95b8();return a0_0x3d73=function(_0x3a3075,_0x12b1f0){_0x3a3075=_0x3a3075-0x154;let _0x95b834=_0x53c794[_0x3a3075];return _0x95b834;},a0_0x3d73(_0x92c08a,_0x28fc19);}async function runBaselineDriftAnalysis(_0x706801){const _0x36ef42=a0_0x1ef89e;if(!_0x706801[_0x36ef42(0x198)]||!_0x706801[_0x36ef42(0x1e0)])return;if(!canCallApi())return;const _0x30f8d0=_0x706801[_0x36ef42(0x1d8)]['ltmStbWindowDays']||0xe;if(_0x706801['dailyDigests'][_0x36ef42(0x1ae)]<_0x30f8d0+0x7){await _0x706801[_0x36ef42(0x154)](_0x36ef42(0x180),{'val':_0x36ef42(0x1d1),'ack':!![]});return;}const _0x1b0af4=_0x706801[_0x36ef42(0x17d)]['slice'](-_0x30f8d0),_0x5da364=_0x706801[_0x36ef42(0x17d)][_0x36ef42(0x1b9)](0x0,_0x706801[_0x36ef42(0x17d)][_0x36ef42(0x1ae)]-_0x30f8d0),_0x4e6c9=_0x36ef42(0x1ee)+JSON[_0x36ef42(0x1cb)](_0x5da364)+_0x36ef42(0x1b2)+JSON['stringify'](_0x1b0af4);try{updateApiTimestamp();const _0x4036be=await _0x706801[_0x36ef42(0x1e0)]['generateContent'](_0x4e6c9),_0x28f882=JSON[_0x36ef42(0x156)](_0x4036be[_0x36ef42(0x19d)][_0x36ef42(0x183)]()[_0x36ef42(0x1f0)](/```json|```/g,'')['trim']());_0x28f882[_0x36ef42(0x18b)]&&(await _0x706801[_0x36ef42(0x154)](_0x36ef42(0x180),{'val':_0x28f882['baselineDrift'],'ack':!![]}),await _0x706801[_0x36ef42(0x154)](_0x36ef42(0x17f),{'val':_0x28f882[_0x36ef42(0x1a4)],'ack':!![]}),await _0x706801[_0x36ef42(0x154)](_0x36ef42(0x1a0),{'val':Date[_0x36ef42(0x15a)](),'ack':!![]}));}catch(_0x671f4b){}}async function executeAutomationAction(_0x55cee0){const _0x53c26a=a0_0x1ef89e;try{const _0x5c6d6e=await _0x55cee0[_0x53c26a(0x161)](_0x53c26a(0x1bd)),_0xfe1855=await _0x55cee0['getStateAsync']('analysis.automation.targetValue');if(_0x5c6d6e&&_0x5c6d6e[_0x53c26a(0x1d7)]&&_0xfe1855){const _0x11cadc=_0x5c6d6e[_0x53c26a(0x1d7)];let _0x1dc046=_0xfe1855[_0x53c26a(0x1d7)];try{_0x1dc046=JSON[_0x53c26a(0x156)](_0x1dc046);}catch(_0x52c150){}_0x55cee0[_0x53c26a(0x19b)][_0x53c26a(0x172)]('ü§ñ\x20BUTLER:\x20Executing\x20Action\x20->\x20'+_0x11cadc+_0x53c26a(0x189)+_0x1dc046),await _0x55cee0['setForeignStateAsync'](_0x11cadc,_0x1dc046);}else _0x55cee0['log'][_0x53c26a(0x17c)](_0x53c26a(0x1a6));}catch(_0x1e83f4){_0x55cee0['log']['error']('BUTLER\x20Execution\x20Error:\x20'+_0x1e83f4['message']);}}async function sendMorningBriefing(_0x47615a){const _0x59c978=a0_0x1ef89e;if(!_0x47615a[_0x59c978(0x1e0)]){_0x47615a['log'][_0x59c978(0x17c)](_0x59c978(0x1ac));return;}_0x47615a['log']['info'](_0x59c978(0x193));try{updateApiTimestamp();const _0x18f456=_0x59c978(0x1ed),_0x38cf5d=await _0x47615a[_0x59c978(0x1e0)][_0x59c978(0x17e)](_0x18f456),_0x3a0f46=_0x38cf5d['response']['text']();_0x47615a[_0x59c978(0x19b)]['info']('üåÖ\x20Briefing\x20generated\x20(Length:\x20'+_0x3a0f46[_0x59c978(0x1ae)]+_0x59c978(0x165)),setup[_0x59c978(0x15d)](_0x47615a,_0x59c978(0x1ab)+_0x3a0f46);}catch(_0x26f562){_0x47615a['log'][_0x59c978(0x15e)](_0x59c978(0x16d)+_0x26f562['message']);}}async function generateHealthReport(_0x184139,_0x261817){const _0x304241=a0_0x1ef89e;if(!_0x184139[_0x304241(0x1e0)])return;const _0x2e8c2e=Date['now']();_0x2e8c2e-lastGlobalApiCall<0xbb8&&(_0x184139['log'][_0x304241(0x1dc)](_0x304241(0x1da)),await new Promise(_0x191bd3=>setTimeout(_0x191bd3,0x7d0)));const _0x5b4cf3=new Date();let _0x4bafed=0x0,_0x5b46c6=_0x5b4cf3[_0x304241(0x1cf)](),_0x3926f5='';if(_0x261817===_0x304241(0x1a9)){const _0x5d9c64=new Date(_0x5b4cf3);_0x5d9c64[_0x304241(0x1c1)](_0x5d9c64[_0x304241(0x16c)]()-0x1),_0x5d9c64[_0x304241(0x171)](0x16,0x0,0x0,0x0),_0x4bafed=_0x5d9c64[_0x304241(0x1cf)]();const _0x8c2084=new Date(_0x5b4cf3);_0x8c2084[_0x304241(0x171)](0x8,0x0,0x0,0x0),_0x5b46c6=_0x8c2084[_0x304241(0x1cf)](),_0x3926f5=_0x304241(0x1de);}else{const _0x40c1a3=new Date(_0x5b4cf3);_0x40c1a3[_0x304241(0x171)](0x8,0x0,0x0,0x0),_0x4bafed=_0x40c1a3[_0x304241(0x1cf)](),_0x3926f5=_0x304241(0x1c5);}const _0x58dd7c=_0x184139[_0x304241(0x199)][_0x304241(0x1b7)](_0x316ba1=>_0x316ba1[_0x304241(0x1e2)]>=_0x4bafed&&_0x316ba1['timestamp']<=_0x5b46c6);if(_0x58dd7c[_0x304241(0x1ae)]===0x0){const _0x489bc2=_0x261817===_0x304241(0x1a9)?'Keine\x20Daten\x20f√ºr\x20die\x20Nacht\x20aufgezeichnet\x20(Sensoren\x20ruhig).':_0x304241(0x19e),_0x2363e9=_0x261817===_0x304241(0x1a9)?_0x304241(0x19a):'analysis.health.geminiDay';await _0x184139[_0x304241(0x154)](_0x2363e9,{'val':_0x489bc2,'ack':!![]});return;}const _0x39ed70=_0x58dd7c[_0x304241(0x1b6)](_0xe12281=>new Date(_0xe12281[_0x304241(0x1e2)])[_0x304241(0x18c)]([],{'hour':_0x304241(0x182),'minute':'2-digit'})+'\x20'+_0xe12281[_0x304241(0x1ea)]+'\x20('+_0xe12281[_0x304241(0x1e1)]+')')[_0x304241(0x155)]('\x0a'),_0x1a2e26=_0x304241(0x164)+_0x3926f5+_0x304241(0x179)+_0x39ed70+_0x304241(0x1af);try{updateApiTimestamp();const _0x5bb0f8=await _0x184139[_0x304241(0x1e0)][_0x304241(0x17e)](_0x1a2e26),_0x299750=_0x5bb0f8['response'][_0x304241(0x183)](),_0x3cf99c=_0x261817===_0x304241(0x1a9)?_0x304241(0x19a):_0x304241(0x1ec);await _0x184139[_0x304241(0x154)](_0x3cf99c,{'val':_0x299750,'ack':!![]}),_0x184139['log'][_0x304241(0x172)]('ü§ñ\x20Health\x20Report\x20('+_0x261817+_0x304241(0x1a2));}catch(_0x211c80){_0x184139['log'][_0x304241(0x15e)](_0x304241(0x1c6)+_0x211c80[_0x304241(0x1e3)]);}}module['exports']={'executeAutomationAction':executeAutomationAction,'createDailyDigest':createDailyDigest,'runBaselineDriftAnalysis':runBaselineDriftAnalysis,'sendMorningBriefing':sendMorningBriefing,'runGeminiAnalysis':runGeminiAnalysis,'consultButler':consultButler,'generateHealthReport':generateHealthReport};