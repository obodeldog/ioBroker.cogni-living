const a0_0x4ab691=a0_0x3307;(function(_0x3d4bd4,_0xa04b39){const _0x15424b=a0_0x3307,_0x2f75cf=_0x3d4bd4();while(!![]){try{const _0x5d6c00=-parseInt(_0x15424b(0x1f0))/0x1*(-parseInt(_0x15424b(0x1e8))/0x2)+-parseInt(_0x15424b(0x1b0))/0x3+-parseInt(_0x15424b(0x1e5))/0x4*(-parseInt(_0x15424b(0x1f1))/0x5)+-parseInt(_0x15424b(0x1b6))/0x6+parseInt(_0x15424b(0x1be))/0x7*(-parseInt(_0x15424b(0x1b1))/0x8)+-parseInt(_0x15424b(0x1b8))/0x9*(-parseInt(_0x15424b(0x1ba))/0xa)+parseInt(_0x15424b(0x209))/0xb;if(_0x5d6c00===_0xa04b39)break;else _0x2f75cf['push'](_0x2f75cf['shift']());}catch(_0xedc886){_0x2f75cf['push'](_0x2f75cf['shift']());}}}(a0_0x1df3,0xb94db));function a0_0x3307(_0x7f8e40,_0x1253be){const _0x337fc7=a0_0x1df3();return a0_0x3307=function(_0x5b0c8a,_0x2b0173){_0x5b0c8a=_0x5b0c8a-0x1af;let _0x1df386=_0x337fc7[_0x5b0c8a];return _0x1df386;},a0_0x3307(_0x7f8e40,_0x1253be);}const a0_0x2b0173=(function(){let _0x556c5a=!![];return function(_0xca0007,_0x52abeb){const _0x33d0cc=_0x556c5a?function(){const _0x500d67=a0_0x3307;if(_0x52abeb){const _0x230626=_0x52abeb[_0x500d67(0x1da)](_0xca0007,arguments);return _0x52abeb=null,_0x230626;}}:function(){};return _0x556c5a=![],_0x33d0cc;};}()),a0_0x5b0c8a=a0_0x2b0173(this,function(){const _0x3c9534=a0_0x3307;return a0_0x5b0c8a['toString']()['search'](_0x3c9534(0x1b5))[_0x3c9534(0x1bf)]()[_0x3c9534(0x210)](a0_0x5b0c8a)['search']('(((.+)+)+)+$');});a0_0x5b0c8a();'use strict';const {GoogleGenerativeAI}=require(a0_0x4ab691(0x1eb)),setup=require(a0_0x4ab691(0x1c5)),GEMINI_MODEL=a0_0x4ab691(0x1e3),LTM_DP_DAILY_DIGESTS='LTM.dailyDigests',LTM_DP_STATUS=a0_0x4ab691(0x1ea),LTM_DP_RAW_LOG=a0_0x4ab691(0x1d3),LTM_MIN_EVENTS_FOR_COMPRESSION=0x5,PERSONA_MAPPING={'generic':a0_0x4ab691(0x1b2),'senior_aal':a0_0x4ab691(0x1e2),'family':'Fokus\x20auf\x20Familienroutinen.','single_comfort':'Fokus\x20auf\x20Komfort.','security':a0_0x4ab691(0x1b3)};async function executeAutomationAction(_0x43efbf){const _0x3d7393=a0_0x4ab691;try{const _0x1782e8=await _0x43efbf[_0x3d7393(0x1ed)]('analysis.automation.targetId'),_0x1cdfbb=await _0x43efbf[_0x3d7393(0x1ed)](_0x3d7393(0x1cb));if(_0x1782e8&&_0x1782e8[_0x3d7393(0x1d8)]&&_0x1cdfbb){const _0x28baf2=_0x1782e8['val'];let _0xbd1999=_0x1cdfbb[_0x3d7393(0x1d8)];try{_0xbd1999=JSON[_0x3d7393(0x1f3)](_0xbd1999);}catch(_0x3b7444){}_0x43efbf['log'][_0x3d7393(0x1d1)]('ðŸ¤–\x20BUTLER:\x20Executing\x20Action\x20->\x20'+_0x28baf2+_0x3d7393(0x1b9)+_0xbd1999),await _0x43efbf[_0x3d7393(0x1cc)](_0x28baf2,_0xbd1999);}else _0x43efbf[_0x3d7393(0x1af)][_0x3d7393(0x206)](_0x3d7393(0x1c1));}catch(_0x278c70){_0x43efbf[_0x3d7393(0x1af)][_0x3d7393(0x1ee)]('BUTLER\x20Execution\x20Error:\x20'+_0x278c70[_0x3d7393(0x1fe)]);}}async function createDailyDigest(_0x46a49b,_0xfb0172){const _0x5d872d=a0_0x4ab691;if(!_0x46a49b[_0x5d872d(0x1d5)])return;await _0x46a49b[_0x5d872d(0x1db)](LTM_DP_STATUS,{'val':_0x5d872d(0x1c7),'ack':!![]});if(!_0x46a49b[_0x5d872d(0x1f8)]||_0x46a49b[_0x5d872d(0x1cf)][_0x5d872d(0x1df)]<LTM_MIN_EVENTS_FOR_COMPRESSION){await _0x46a49b[_0x5d872d(0x1db)](LTM_DP_STATUS,{'val':'Skipped\x20(No\x20AI\x20or\x20Data)','ack':!![]});return;}const _0x58e912=JSON[_0x5d872d(0x1f3)](JSON[_0x5d872d(0x1f4)](_0x46a49b[_0x5d872d(0x1cf)])),_0x4ea7bf=_0x58e912[_0x5d872d(0x1df)],_0x2b1bec=_0x5d872d(0x20a)+JSON['stringify'](_0x58e912);try{const _0x18c39b=await _0x46a49b[_0x5d872d(0x1f8)]['generateContent'](_0x2b1bec),_0x5b617f=JSON['parse'](_0x18c39b['response'][_0x5d872d(0x1e0)]()[_0x5d872d(0x1d0)](/```json|```/g,'')[_0x5d872d(0x1bc)]()),_0x5e7127={'timestamp':new Date()['toISOString'](),'eventCount':_0x4ea7bf,'summary':_0x5b617f[_0x5d872d(0x1dc)]||_0x5d872d(0x1fb),'activityLevel':_0x5b617f[_0x5d872d(0x203)]||_0x5d872d(0x1fa),'systemMode':_0x46a49b[_0x5d872d(0x1e9)]};_0x46a49b['dailyDigests']['push'](_0x5e7127);const _0x3f8e4b=_0x46a49b[_0x5d872d(0x1ca)][_0x5d872d(0x207)]||0x3c;_0x46a49b[_0x5d872d(0x1c3)][_0x5d872d(0x1df)]>_0x3f8e4b&&_0x46a49b[_0x5d872d(0x1c3)][_0x5d872d(0x1d6)](0x0,_0x46a49b['dailyDigests']['length']-_0x3f8e4b);await _0x46a49b[_0x5d872d(0x1db)](LTM_DP_DAILY_DIGESTS,{'val':JSON[_0x5d872d(0x1f4)](_0x46a49b[_0x5d872d(0x1c3)]),'ack':!![]}),_0x46a49b['rawEventLog']=[],await _0x46a49b[_0x5d872d(0x1db)](LTM_DP_RAW_LOG,{'val':JSON[_0x5d872d(0x1f4)](_0x46a49b[_0x5d872d(0x1cf)]),'ack':!![]}),await _0x46a49b[_0x5d872d(0x1db)](LTM_DP_STATUS,{'val':_0x5d872d(0x1c8),'ack':!![]});if(_0x46a49b[_0x5d872d(0x1d5)]&&_0xfb0172)_0xfb0172[_0x5d872d(0x201)](_0x46a49b,'ANALYZE_HEALTH',{'digest':_0x5e7127});}catch(_0x57ece0){_0x46a49b[_0x5d872d(0x1af)][_0x5d872d(0x1ee)](_0x57ece0['message']);}}async function runBaselineDriftAnalysis(_0x1afcff){const _0x4d3d93=a0_0x4ab691;if(!_0x1afcff['isProVersion']||!_0x1afcff['geminiModel'])return;const _0x267b8a=_0x1afcff['config'][_0x4d3d93(0x1d9)]||0xe;if(_0x1afcff[_0x4d3d93(0x1c3)][_0x4d3d93(0x1df)]<_0x267b8a+0x7){await _0x1afcff[_0x4d3d93(0x1db)]('LTM.driftAnalysis.baselineDrift',{'val':'N/A\x20(Learning)','ack':!![]});return;}const _0x28894b=_0x1afcff[_0x4d3d93(0x1c3)][_0x4d3d93(0x1fc)](-_0x267b8a),_0x41837c=_0x1afcff[_0x4d3d93(0x1c3)][_0x4d3d93(0x1fc)](0x0,_0x1afcff['dailyDigests'][_0x4d3d93(0x1df)]-_0x267b8a),_0x5aadd1='ROLLE:\x20Data\x20Scientist.\x20ZIEL:\x20Drift\x20erkennen.\x20SCHEMA:\x20{\x20\x22baselineDrift\x22:\x20\x22none|slight|significant|critical\x22,\x20\x22driftDetails\x22:\x20\x22string\x22\x20}\x0a\x0aLTB:\x20'+JSON['stringify'](_0x41837c)+_0x4d3d93(0x1c0)+JSON[_0x4d3d93(0x1f4)](_0x28894b);try{const _0x4dfb63=await _0x1afcff['geminiModel'][_0x4d3d93(0x1b7)](_0x5aadd1),_0x1151d0=JSON[_0x4d3d93(0x1f3)](_0x4dfb63[_0x4d3d93(0x1c6)][_0x4d3d93(0x1e0)]()[_0x4d3d93(0x1d0)](/```json|```/g,'')[_0x4d3d93(0x1bc)]());_0x1151d0['baselineDrift']&&(await _0x1afcff['setStateAsync']('LTM.driftAnalysis.baselineDrift',{'val':_0x1151d0[_0x4d3d93(0x202)],'ack':!![]}),await _0x1afcff[_0x4d3d93(0x1db)](_0x4d3d93(0x208),{'val':_0x1151d0['driftDetails'],'ack':!![]}),await _0x1afcff[_0x4d3d93(0x1db)](_0x4d3d93(0x200),{'val':Date[_0x4d3d93(0x1e4)](),'ack':!![]}));}catch(_0x2728d5){}}function a0_0x1df3(){const _0x59a334=['ltmStbWindowDays','apply','setStateAsync','summary','ðŸŒ…\x20Morning\x20Briefing:\x0a','alertReason','length','text','analysisHistory','PRIORITÃ„T:\x20Gesundheit/AAL.','models/gemini-flash-latest','now','9300lHUFtq','lastAlertState','analysis.isAlert','248oYlwWC','currentSystemMode','LTM.processingStatus','@google/generative-ai','.\x20EVENTS:\x20','getStateAsync','error','analysis.alertReason','9347ECyjCH','650fWhUzU','sendNotification','parse','stringify','Briefing\x20Error:\x20','analysis.lastResult','eventHistory','geminiModel','ROLLE:\x20KI-Hausverwalter.\x20PERSONA:\x20','normal','Digest','slice','isEmergency','message','generic','LTM.driftAnalysis.lastCheck','send','baselineDrift','activityLevel','exports','Unbekannt','warn','ltmLtbWindowDays','LTM.driftAnalysis.driftDetails','14269079glOelH','ROLLE:\x20Data\x20Compression\x20Agent.\x20SPRACHE:\x20DE.\x20FORMAT:\x20JSON.\x20ANWEISUNG:\x20Fasse\x20Sensor-Events\x20zusammen.\x20SCHEMA:\x20{\x20\x22summary\x22:\x20\x22string\x22,\x20\x22activityLevel\x22:\x20\x22string\x22\x20}\x20\x0a\x0aEVENTS:\x0a','.\x20EMERGENCY:\x20','analysis.automation.description','pop','âš ï¸\x20ALARM:\x20','isAlert','constructor','log','1465896eiQorL','5288pIrwEG','Analysiere\x20ausgewogen.','PRIORITÃ„T:\x20Sicherheit.','analysis.automation.targetId','(((.+)+)+)+$','8932272qDCddG','generateContent','22743NZoYQh','\x20=\x20','3190QFEKYn','automationProposal','trim','.\x20KONTEXT:\x20','8771JCxVzn','toString','\x0aSTB:\x20','ðŸ¤–\x20BUTLER:\x20No\x20valid\x20target\x20ID\x20or\x20value\x20stored\x20for\x20execution.','analysis.automation.patternDetected','dailyDigests','Erstelle\x20ein\x20kurzes\x20\x27Guten\x20Morgen\x27\x20Briefing\x20basierend\x20auf\x20den\x20Events\x20der\x20letzten\x20Nacht.','./setup','response','Started...','Success','targetId','config','analysis.automation.targetValue','setForeignStateAsync','livingContext','description','rawEventLog','replace','info','Keine\x20Details.','LTM.rawEventLog','targetValue','isProVersion','splice','aiPersona','val'];a0_0x1df3=function(){return _0x59a334;};return a0_0x1df3();}async function sendMorningBriefing(_0x2683c2){const _0xf97cd7=a0_0x4ab691;if(!_0x2683c2['geminiModel'])return;try{const _0x48d8ab=_0xf97cd7(0x1c4),_0x868427=await _0x2683c2['geminiModel'][_0xf97cd7(0x1b7)](_0x48d8ab),_0x199c2e=_0x868427[_0xf97cd7(0x1c6)][_0xf97cd7(0x1e0)]();setup['sendNotification'](_0x2683c2,_0xf97cd7(0x1dd)+_0x199c2e);}catch(_0x5eccdc){_0x2683c2['log'][_0xf97cd7(0x1ee)](_0xf97cd7(0x1f5)+_0x5eccdc[_0xf97cd7(0x1fe)]);}}async function runGeminiAnalysis(_0x3598e3,_0x3cc899=''){const _0x532a9a=a0_0x4ab691;if(!_0x3598e3[_0x532a9a(0x1f8)])return;if(_0x3598e3[_0x532a9a(0x1f7)]['length']===0x0)return;const _0x498359=_0x3598e3[_0x532a9a(0x1f7)][_0x532a9a(0x1fc)](0x0,0xf),_0x34819d=_0x3598e3[_0x532a9a(0x1e9)],_0x25ebf4=PERSONA_MAPPING[_0x3598e3[_0x532a9a(0x1ca)][_0x532a9a(0x1d7)]||_0x532a9a(0x1ff)],_0x349ba9=_0x3598e3['config'][_0x532a9a(0x1cd)]||_0x532a9a(0x1d2);let _0x3658a1=_0x532a9a(0x205);try{const _0x551e7c=await _0x3598e3[_0x532a9a(0x1ed)]('system.presenceWho');if(_0x551e7c&&_0x551e7c[_0x532a9a(0x1d8)])_0x3658a1=_0x551e7c[_0x532a9a(0x1d8)];}catch(_0x1439cc){}let _0x2695d8=![];try{const _0x28499c=await _0x3598e3['getStateAsync']('analysis.automation.autoApply');if(_0x28499c&&_0x28499c[_0x532a9a(0x1d8)])_0x2695d8=!![];}catch(_0x1127f4){}const _0x25cac7=_0x532a9a(0x1f9)+_0x25ebf4+_0x532a9a(0x1bd)+_0x349ba9+'.\x20SYSTEM_MODE:\x20'+_0x34819d+'.\x20ANWESEND:\x20'+_0x3658a1+_0x532a9a(0x1ec)+JSON[_0x532a9a(0x1f4)](_0x498359)+_0x532a9a(0x20b)+_0x3cc899+'.\x20AUFGABE:\x201.\x20Gesundheit?\x202.\x20Komfort?\x20FORMAT\x20(JSON):\x20{\x20\x22isAlert\x22:\x20boolean,\x20\x22alertReason\x22:\x20\x22string\x22,\x20\x22isEmergency\x22:\x20boolean,\x20\x22summary\x22:\x20\x22string\x22,\x20\x22automationProposal\x22:\x20{\x20\x22detected\x22:\x20boolean,\x20\x22description\x22:\x20\x22string\x22,\x20\x22targetId\x22:\x20\x22string\x22,\x20\x22targetValue\x22:\x20\x22any\x22\x20}\x20}';try{const _0x2e62dd=await _0x3598e3[_0x532a9a(0x1f8)][_0x532a9a(0x1b7)](_0x25cac7),_0x3ca6cc=JSON[_0x532a9a(0x1f3)](_0x2e62dd[_0x532a9a(0x1c6)][_0x532a9a(0x1e0)]()[_0x532a9a(0x1d0)](/```json|```/g,'')['trim']());await _0x3598e3['setStateAsync'](_0x532a9a(0x1f6),{'val':JSON[_0x532a9a(0x1f4)](_0x3ca6cc),'ack':!![]});if(_0x3ca6cc[_0x532a9a(0x1dc)])await _0x3598e3['setStateAsync']('analysis.activitySummary',{'val':_0x3ca6cc[_0x532a9a(0x1dc)],'ack':!![]});const _0x495038={'timestamp':Date[_0x532a9a(0x1e4)](),'id':Date['now']()['toString'](),'analysis':{'activity':{'summary':_0x3ca6cc[_0x532a9a(0x1dc)],'isAlert':_0x3ca6cc[_0x532a9a(0x20f)],'alertReason':_0x3ca6cc['alertReason']},'comfort':{'automationProposal':_0x3ca6cc['automationProposal']}}};_0x3598e3[_0x532a9a(0x1e1)]['unshift'](_0x495038);if(_0x3598e3[_0x532a9a(0x1e1)][_0x532a9a(0x1df)]>0x32)_0x3598e3['analysisHistory'][_0x532a9a(0x20d)]();await _0x3598e3['setStateAsync']('analysis.analysisHistory',{'val':JSON['stringify'](_0x3598e3[_0x532a9a(0x1e1)]),'ack':!![]});const _0x5d2f0f=_0x3ca6cc['isAlert']||![];_0x5d2f0f!==_0x3598e3['lastAlertState']&&(await _0x3598e3[_0x532a9a(0x1db)](_0x532a9a(0x1e7),{'val':_0x5d2f0f,'ack':!![]}),_0x3598e3[_0x532a9a(0x1e6)]=_0x5d2f0f,_0x5d2f0f&&(await _0x3598e3['setStateAsync'](_0x532a9a(0x1ef),{'val':_0x3ca6cc[_0x532a9a(0x1de)],'ack':!![]}),setup[_0x532a9a(0x1f2)](_0x3598e3,_0x532a9a(0x20e)+_0x3ca6cc[_0x532a9a(0x1de)],![],_0x3ca6cc[_0x532a9a(0x1fd)])));if(_0x3ca6cc['automationProposal']&&_0x3ca6cc[_0x532a9a(0x1bb)]['detected']){await _0x3598e3[_0x532a9a(0x1db)](_0x532a9a(0x1c2),{'val':!![],'ack':!![]}),await _0x3598e3[_0x532a9a(0x1db)](_0x532a9a(0x20c),{'val':_0x3ca6cc[_0x532a9a(0x1bb)][_0x532a9a(0x1ce)],'ack':!![]}),await _0x3598e3[_0x532a9a(0x1db)](_0x532a9a(0x1b4),{'val':_0x3ca6cc['automationProposal'][_0x532a9a(0x1c9)],'ack':!![]}),await _0x3598e3[_0x532a9a(0x1db)]('analysis.automation.targetValue',{'val':JSON[_0x532a9a(0x1f4)](_0x3ca6cc[_0x532a9a(0x1bb)][_0x532a9a(0x1d4)]),'ack':!![]});if(_0x2695d8)executeAutomationAction(_0x3598e3);}}catch(_0x126743){_0x3598e3[_0x532a9a(0x1af)][_0x532a9a(0x1ee)]('Gemini\x20Error:\x20'+_0x126743[_0x532a9a(0x1fe)]);}}module[a0_0x4ab691(0x204)]={'executeAutomationAction':executeAutomationAction,'createDailyDigest':createDailyDigest,'runBaselineDriftAnalysis':runBaselineDriftAnalysis,'sendMorningBriefing':sendMorningBriefing,'runGeminiAnalysis':runGeminiAnalysis};