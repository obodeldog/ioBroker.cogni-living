const a0_0x42517f=a0_0x4453;(function(_0x421ca4,_0x11dc77){const _0x4482ca=a0_0x4453,_0x12e53e=_0x421ca4();while(!![]){try{const _0x584ec0=-parseInt(_0x4482ca(0x260))/0x1+parseInt(_0x4482ca(0x203))/0x2*(-parseInt(_0x4482ca(0x20f))/0x3)+parseInt(_0x4482ca(0x1d8))/0x4+-parseInt(_0x4482ca(0x240))/0x5+parseInt(_0x4482ca(0x241))/0x6+-parseInt(_0x4482ca(0x23e))/0x7*(parseInt(_0x4482ca(0x207))/0x8)+parseInt(_0x4482ca(0x1f2))/0x9;if(_0x584ec0===_0x11dc77)break;else _0x12e53e['push'](_0x12e53e['shift']());}catch(_0x3fec93){_0x12e53e['push'](_0x12e53e['shift']());}}}(a0_0xb36a,0x1a084));const a0_0x2178dd=(function(){let _0x4b13c2=!![];return function(_0x1ce292,_0x27da10){const _0x251df5=_0x4b13c2?function(){const _0x4844ce=a0_0x4453;if(_0x27da10){const _0x43e1f6=_0x27da10[_0x4844ce(0x25d)](_0x1ce292,arguments);return _0x27da10=null,_0x43e1f6;}}:function(){};return _0x4b13c2=![],_0x251df5;};}()),a0_0x34ce04=a0_0x2178dd(this,function(){const _0xab47cf=a0_0x4453;return a0_0x34ce04['toString']()[_0xab47cf(0x23c)](_0xab47cf(0x1e1))['toString']()[_0xab47cf(0x201)](a0_0x34ce04)[_0xab47cf(0x23c)](_0xab47cf(0x1e1));});a0_0x34ce04();'use strict';const {GoogleGenerativeAI}=require(a0_0x42517f(0x1eb)),setup=require('./setup'),GEMINI_MODEL=a0_0x42517f(0x23d),LTM_DP_DAILY_DIGESTS=a0_0x42517f(0x1e9),LTM_DP_STATUS=a0_0x42517f(0x26f),LTM_DP_RAW_LOG='LTM.rawEventLog',LTM_MIN_EVENTS_FOR_COMPRESSION=0x5,MIN_API_GAP_MS=0x4e20;let lastGlobalApiCall=0x0;const decisionCache={},CACHE_TTL_MS=0xf*0x3c*0x3e8,PERSONA_MAPPING={'generic':'Entscheide\x20ausgewogen\x20zwischen\x20Komfort\x20und\x20Energie.','senior_aal':a0_0x42517f(0x265),'family':a0_0x42517f(0x208),'single_comfort':a0_0x42517f(0x258),'security':a0_0x42517f(0x20a),'energy_saver':a0_0x42517f(0x1ee)};function canCallApi(){const _0x4a9c4e=a0_0x42517f,_0x310ace=Date[_0x4a9c4e(0x1f9)]();return _0x310ace-lastGlobalApiCall>MIN_API_GAP_MS;}function updateApiTimestamp(){lastGlobalApiCall=Date['now']();}async function getWeatherContext(_0x270510){const _0x602a31=a0_0x42517f;if(!_0x270510[_0x602a31(0x1e8)]['useWeather']||!_0x270510[_0x602a31(0x1e8)][_0x602a31(0x266)])return'Unbekannt\x20(Kein\x20Sensor)';try{const _0x4b45bb=_0x270510[_0x602a31(0x1e8)][_0x602a31(0x266)];let _0x42f6cc=await _0x270510[_0x602a31(0x21c)](_0x4b45bb+_0x602a31(0x226));if(!_0x42f6cc)_0x42f6cc=await _0x270510[_0x602a31(0x21c)](_0x4b45bb+_0x602a31(0x259));let _0x1025cb=await _0x270510['getForeignStateAsync'](_0x4b45bb+'.Current.WeatherText');if(!_0x1025cb)_0x1025cb=await _0x270510['getForeignStateAsync'](_0x4b45bb+_0x602a31(0x24f));let _0x559af4=_0x602a31(0x1fe);const _0x3553b0=await _0x270510[_0x602a31(0x21c)](_0x4b45bb+_0x602a31(0x247));if(_0x3553b0)_0x559af4=_0x3553b0[_0x602a31(0x1f4)]?_0x602a31(0x1dd):_0x602a31(0x219);if(_0x42f6cc&&_0x1025cb)return _0x42f6cc[_0x602a31(0x1f4)]+'¬∞C,\x20'+_0x1025cb[_0x602a31(0x1f4)]+_0x602a31(0x1ed)+_0x559af4;}catch(_0x2dfc9a){}return _0x602a31(0x234);}function a0_0xb36a(){const _0x358b94=['237OjAIXM','analysis.automation.targetValue','setHours','lastAlertState','ROLLE:\x20Data\x20Compression\x20Agent.\x20SPRACHE:\x20DE.\x20FORMAT:\x20JSON.\x20ANWEISUNG:\x20Fasse\x20Sensor-Events\x20zusammen.\x20SCHEMA:\x20{\x20\x22summary\x22:\x20\x22string\x22,\x20\x22activityLevel\x22:\x20\x22string\x22\x20}\x20\x0a\x0aEVENTS:\x0a','length','.\x20SYSTEM_MODE:\x20','\x20->\x20','value','aiPersona','Tag','Success','currentSystemMode','getForeignStateAsync','isEmergency','map','ü§ñ\x20Traffic\x20Schutz:\x20Anfrage\x20f√ºr\x20','Briefing\x20Error:\x20','generic','name','.\x0a\x20\x20\x20\x20EVENT:\x20Bewohner\x20geht\x20wahrscheinlich\x20(','.\x20EMERGENCY:\x20','rawEventLog','.Current.Temperature','analysis.activitySummary','geminiModel','LTM.driftAnalysis.baselineDrift','summary','dailyDigests','toLocaleTimeString','splice','.\x20ANWESEND:\x20','BUTLER\x20Execution\x20Error:\x20','generateContent','Bisher\x20keine\x20Aktivit√§t\x20seit\x2008:00\x20Uhr\x20verzeichnet.','Skipped\x20(Traffic)','timestamp','Wetterdaten\x20nicht\x20abrufbar','setDate','Analysiere\x20diese\x20Events\x20der\x20NACHT\x20(22:00-08:00).\x20War\x20der\x20Schlaf\x20ruhig?\x20Gab\x20es\x20Badg√§nge?\x20Antwort\x20kurz\x20f√ºr\x20den\x20besorgten\x20Sohn\x20(max\x202\x20S√§tze).','\x0a\x20\x20\x20\x20FRAGE:\x20Ist\x20es\x20dunkel\x20genug\x20f√ºr\x20Licht?\x0a\x20\x20\x20\x20FORMAT:\x20{\x20\x22approved\x22:\x20boolean,\x20\x22reason\x22:\x20\x22kurzer\x20Grund\x22\x20}\x0a\x20\x20\x20\x20','analysis.alertReason','baselineDrift','ROLLE:\x20KI-Hausverwalter.\x20PERSONA:\x20','\x20=\x20','search','models/gemini-flash-latest','2667hINWBy','analysis.automation.autoApply','478735cXvhWd','766230hCayfG','Started...','response','debug','LTM.driftAnalysis.lastCheck','alertReason','.Current.IsNight','Traffic-Schutz\x20(Auto-Approved)','setForeignStateAsync','\x20√ºbersprungen\x20(Auto-Approved).','analysis.lastResult','parse','log','getStateAsync','.forecast.current.state','ü§ñ\x20BUTLER:\x20Executing\x20Action\x20->\x20','isAlert','KI-Fehler\x20(Fallback)','push','LTM.driftAnalysis.driftDetails','üåÖ\x20Morning\x20Briefing:\x0a','analysis.health.geminiDay','N/A\x20(Learning)','Maximaler\x20Komfort,\x20Energie\x20ist\x20zweitrangig.','.forecast.current.temperature','livingContext','decision','join','apply','targetId','toFixed','75593obFSqW','\x0a\x20\x20\x20\x20ANTWORT-STIL:\x20Sachlich,\x20beruhigend,\x20pr√§zise.\x20Keine\x20Floskeln.\x0a\x20\x20\x20\x20','analysisHistory','getTime','getDate','PRIORIT√ÑT:\x20Sicherheit\x20und\x20Licht.\x20Schalte\x20lieber\x20einmal\x20zu\x20viel\x20als\x20zu\x20wenig.','weatherInstance','ltmLtbWindowDays','analysis.health.geminiNight','toString','filter','system.presenceWho','ltmStbWindowDays','eventHistory','.\x20AUFGABE:\x201.\x20Gesundheit?\x202.\x20Komfort?\x20FORMAT\x20(JSON):\x20{\x20\x22isAlert\x22:\x20boolean,\x20\x22alertReason\x22:\x20\x22string\x22,\x20\x22isEmergency\x22:\x20boolean,\x20\x22summary\x22:\x20\x22string\x22,\x20\x22automationProposal\x22:\x20{\x20\x22detected\x22:\x20boolean,\x20\x22description\x22:\x20\x22string\x22,\x20\x22targetId\x22:\x20\x22string\x22,\x20\x22targetValue\x22:\x20\x22any\x22\x20}\x20}','LTM.processingStatus','detected','trim',',\x20Wetter:\x20','Analysiere\x20diese\x20Events\x20des\x20TAGES\x20(08:00-Jetzt).\x20Aktivit√§t?\x20Mahlzeiten?\x20Haust√ºr?\x20Antwort\x20kurz\x20f√ºr\x20den\x20besorgten\x20Sohn\x20(max\x202\x20S√§tze).','788540CrZhOO','analysis.analysisHistory','automationProposal','sendNotification','.\x20EVENTS:\x20','Nacht','Keine\x20Daten\x20f√ºr\x20die\x20Nacht\x20aufgezeichnet\x20(Sensoren\x20ruhig).','replace','send','(((.+)+)+)+$','NIGHT','slice','üåÖ\x20Briefing\x20generated\x20(Length:\x20','reason','.\x20KONTEXT:\x20','%)\x20nach\x20\x22','config','LTM.dailyDigests','\x0a\x20\x20\x20\x20ROLLE:\x20Medizinischer\x20Assistent\x20f√ºr\x20AAL\x20(Ambient\x20Assisted\x20Living).\x0a\x20\x20\x20\x20AUFGABE:\x20','@google/generative-ai','2-digit',',\x20Lichtverh√§ltnisse:\x20','PRIORIT√ÑT:\x20Energie\x20sparen.\x20Schalte\x20nur,\x20wenn\x20absolut\x20notwendig\x20(Dunkelheit).','ü§ñ\x20Butler\x20Cache\x20Hit:\x20','analysis.automation.patternDetected','Digest','776025cuYRLh',').\x20Sending\x20notification...','val','error','activityLevel','description','message','now','warn','ü§ñ\x20Morning\x20Briefing\x20skipped:\x20No\x20Gemini\x20Model.','üìÖ\x20Daily\x20Digest:\x0a','targetValue','Unbekannt','info','analysis.isAlert','constructor','KI\x20offline\x20(Fallback)','1942UBFlwG','stringify','setStateAsync','Erstelle\x20ein\x20kurzes\x20\x27Guten\x20Morgen\x27\x20Briefing\x20basierend\x20auf\x20den\x20Events\x20der\x20letzten\x20Nacht.','1184DtabAS','Fokus\x20auf\x20Komfort\x20f√ºr\x20die\x20Familie.','exports','Sicherheit\x20geht\x20vor.','text','\x0a\x20\x20\x20\x20ROLLE:\x20Haus-Butler.\x0a\x20\x20\x20\x20SITUATION:\x20','driftDetails','Keine\x20Details.'];a0_0xb36a=function(){return _0x358b94;};return a0_0xb36a();}async function consultButler(_0x5138a4,_0x1da790,_0x3f5f9d,_0xb9751b){const _0x2bc1e6=a0_0x42517f;if(!_0x5138a4[_0x2bc1e6(0x228)])return{'approved':!![],'reason':_0x2bc1e6(0x202)};const _0x161754=Date['now']();if(decisionCache[_0x1da790]&&_0x161754-decisionCache[_0x1da790][_0x2bc1e6(0x233)]<CACHE_TTL_MS){const _0x21666c=decisionCache[_0x1da790][_0x2bc1e6(0x25b)];return _0x5138a4[_0x2bc1e6(0x24d)][_0x2bc1e6(0x244)](_0x2bc1e6(0x1ef)+_0x1da790+_0x2bc1e6(0x216)+(_0x21666c['approved']?'OK':'NO')+'\x20('+_0x21666c[_0x2bc1e6(0x1e5)]+')'),_0x21666c;}if(!canCallApi())return _0x5138a4[_0x2bc1e6(0x24d)][_0x2bc1e6(0x244)](_0x2bc1e6(0x21f)+_0x1da790+_0x2bc1e6(0x24a)),{'approved':!![],'reason':_0x2bc1e6(0x248)};const _0x3844a6=new Date()[_0x2bc1e6(0x22c)](),_0x15f246=await getWeatherContext(_0x5138a4),_0x1c831f=PERSONA_MAPPING[_0x5138a4[_0x2bc1e6(0x1e8)][_0x2bc1e6(0x218)]||_0x2bc1e6(0x221)],_0x18eb23=_0x2bc1e6(0x20c)+_0x3844a6+_0x2bc1e6(0x272)+_0x15f246+_0x2bc1e6(0x223)+(_0xb9751b*0x64)[_0x2bc1e6(0x25f)](0x0)+_0x2bc1e6(0x1e7)+_0x1da790+'\x22.\x0a\x20\x20\x20\x20AKTION:\x20Schalte\x20\x22'+_0x3f5f9d+'\x22\x20AN.\x0a\x20\x20\x20\x20STRATEGIE:\x20'+_0x1c831f+_0x2bc1e6(0x237);try{updateApiTimestamp();const _0xbf9075=await _0x5138a4['geminiModel']['generateContent'](_0x18eb23),_0x4fd526=_0xbf9075['response'][_0x2bc1e6(0x20b)]()[_0x2bc1e6(0x1df)](/```json|```/g,'')[_0x2bc1e6(0x271)](),_0x2ee61=JSON[_0x2bc1e6(0x24c)](_0x4fd526);return decisionCache[_0x1da790]={'decision':_0x2ee61,'timestamp':_0x161754},_0x2ee61;}catch(_0x17dc45){return _0x5138a4['log']['warn']('ü§ñ\x20Butler\x20Brain\x20Error:\x20'+_0x17dc45['message']),decisionCache[_0x1da790]={'decision':{'approved':!![],'reason':'KI-Fehler\x20(Fallback)'},'timestamp':_0x161754-(CACHE_TTL_MS-0xea60)},{'approved':!![],'reason':_0x2bc1e6(0x252)};}}function a0_0x4453(_0x59e732,_0x20f70b){const _0x485466=a0_0xb36a();return a0_0x4453=function(_0x34ce04,_0x2178dd){_0x34ce04=_0x34ce04-0x1d7;let _0xb36a99=_0x485466[_0x34ce04];return _0xb36a99;},a0_0x4453(_0x59e732,_0x20f70b);}async function runGeminiAnalysis(_0x2394c2,_0x56221e=''){const _0x47a20f=a0_0x42517f;if(!_0x2394c2[_0x47a20f(0x228)])return;if(!canCallApi()){_0x2394c2[_0x47a20f(0x24d)][_0x47a20f(0x244)]('ü§ñ\x20Autopilot\x20skipped\x20(Traffic\x20Protection\x20active).');return;}if(_0x2394c2[_0x47a20f(0x26d)][_0x47a20f(0x214)]===0x0)return;const _0x3a18f9=_0x2394c2['eventHistory'][_0x47a20f(0x1e3)](0x0,0xf),_0x3131b9=_0x2394c2[_0x47a20f(0x21b)],_0x4a1409=PERSONA_MAPPING[_0x2394c2[_0x47a20f(0x1e8)]['aiPersona']||_0x47a20f(0x221)],_0x155f79=_0x2394c2[_0x47a20f(0x1e8)][_0x47a20f(0x25a)]||_0x47a20f(0x20e);let _0x59bacc=_0x47a20f(0x1fe);try{const _0x348467=await _0x2394c2[_0x47a20f(0x24e)](_0x47a20f(0x26b));if(_0x348467&&_0x348467[_0x47a20f(0x1f4)])_0x59bacc=_0x348467['val'];}catch(_0x302d8f){}let _0x4f9e98=![];try{const _0xf8ac3=await _0x2394c2[_0x47a20f(0x24e)](_0x47a20f(0x23f));if(_0xf8ac3&&_0xf8ac3[_0x47a20f(0x1f4)])_0x4f9e98=!![];}catch(_0x58afb5){}const _0x5e637d=_0x47a20f(0x23a)+_0x4a1409+_0x47a20f(0x1e6)+_0x155f79+_0x47a20f(0x215)+_0x3131b9+_0x47a20f(0x22e)+_0x59bacc+_0x47a20f(0x1dc)+JSON['stringify'](_0x3a18f9)+_0x47a20f(0x224)+_0x56221e+_0x47a20f(0x26e);try{updateApiTimestamp();const _0x570408=await _0x2394c2[_0x47a20f(0x228)][_0x47a20f(0x230)](_0x5e637d),_0x274c45=JSON[_0x47a20f(0x24c)](_0x570408['response']['text']()[_0x47a20f(0x1df)](/```json|```/g,'')[_0x47a20f(0x271)]());await _0x2394c2[_0x47a20f(0x205)](_0x47a20f(0x24b),{'val':JSON[_0x47a20f(0x204)](_0x274c45),'ack':!![]});if(_0x274c45[_0x47a20f(0x22a)])await _0x2394c2[_0x47a20f(0x205)](_0x47a20f(0x227),{'val':_0x274c45[_0x47a20f(0x22a)],'ack':!![]});const _0x561e24={'timestamp':Date[_0x47a20f(0x1f9)](),'id':Date[_0x47a20f(0x1f9)]()[_0x47a20f(0x269)](),'analysis':{'activity':{'summary':_0x274c45[_0x47a20f(0x22a)],'isAlert':_0x274c45['isAlert'],'alertReason':_0x274c45[_0x47a20f(0x246)]},'comfort':{'automationProposal':_0x274c45[_0x47a20f(0x1da)]}}};_0x2394c2['analysisHistory']['unshift'](_0x561e24);if(_0x2394c2['analysisHistory']['length']>0x32)_0x2394c2[_0x47a20f(0x262)]['pop']();await _0x2394c2['setStateAsync'](_0x47a20f(0x1d9),{'val':JSON[_0x47a20f(0x204)](_0x2394c2[_0x47a20f(0x262)]),'ack':!![]});const _0xffffd0=_0x274c45[_0x47a20f(0x251)]||![];_0xffffd0!==_0x2394c2[_0x47a20f(0x212)]&&(await _0x2394c2[_0x47a20f(0x205)](_0x47a20f(0x200),{'val':_0xffffd0,'ack':!![]}),_0x2394c2[_0x47a20f(0x212)]=_0xffffd0,_0xffffd0&&(await _0x2394c2['setStateAsync'](_0x47a20f(0x238),{'val':_0x274c45[_0x47a20f(0x246)],'ack':!![]}),setup[_0x47a20f(0x1db)](_0x2394c2,'‚ö†Ô∏è\x20ALARM:\x20'+_0x274c45[_0x47a20f(0x246)],![],_0x274c45[_0x47a20f(0x21d)])));if(_0x274c45[_0x47a20f(0x1da)]&&_0x274c45[_0x47a20f(0x1da)][_0x47a20f(0x270)]){await _0x2394c2[_0x47a20f(0x205)](_0x47a20f(0x1f0),{'val':!![],'ack':!![]}),await _0x2394c2['setStateAsync']('analysis.automation.description',{'val':_0x274c45[_0x47a20f(0x1da)][_0x47a20f(0x1f7)],'ack':!![]}),await _0x2394c2[_0x47a20f(0x205)]('analysis.automation.targetId',{'val':_0x274c45[_0x47a20f(0x1da)][_0x47a20f(0x25e)],'ack':!![]}),await _0x2394c2[_0x47a20f(0x205)](_0x47a20f(0x210),{'val':JSON[_0x47a20f(0x204)](_0x274c45[_0x47a20f(0x1da)][_0x47a20f(0x1fd)]),'ack':!![]});if(_0x4f9e98)executeAutomationAction(_0x2394c2);}}catch(_0x4b2544){_0x2394c2[_0x47a20f(0x24d)][_0x47a20f(0x1f5)]('Gemini\x20Error:\x20'+_0x4b2544[_0x47a20f(0x1f8)]);}}async function createDailyDigest(_0x21ca62,_0x53b7ec){const _0x30bab4=a0_0x42517f;if(!_0x21ca62['isProVersion'])return;if(!canCallApi()){await _0x21ca62[_0x30bab4(0x205)](LTM_DP_STATUS,{'val':_0x30bab4(0x232),'ack':!![]});return;}await _0x21ca62[_0x30bab4(0x205)](LTM_DP_STATUS,{'val':_0x30bab4(0x242),'ack':!![]});if(!_0x21ca62[_0x30bab4(0x228)]||_0x21ca62['rawEventLog'][_0x30bab4(0x214)]<LTM_MIN_EVENTS_FOR_COMPRESSION){await _0x21ca62['setStateAsync'](LTM_DP_STATUS,{'val':'Skipped\x20(No\x20AI\x20or\x20Data)','ack':!![]});return;}const _0x11f8d4=JSON['parse'](JSON[_0x30bab4(0x204)](_0x21ca62[_0x30bab4(0x225)])),_0xaa57c7=_0x11f8d4['length'],_0x3623fa=_0x30bab4(0x213)+JSON[_0x30bab4(0x204)](_0x11f8d4);try{updateApiTimestamp();const _0x3aa35a=await _0x21ca62['geminiModel'][_0x30bab4(0x230)](_0x3623fa),_0x4c2573=JSON[_0x30bab4(0x24c)](_0x3aa35a[_0x30bab4(0x243)][_0x30bab4(0x20b)]()[_0x30bab4(0x1df)](/```json|```/g,'')[_0x30bab4(0x271)]()),_0x20b000={'timestamp':new Date()['toISOString'](),'eventCount':_0xaa57c7,'summary':_0x4c2573[_0x30bab4(0x22a)]||_0x30bab4(0x1f1),'activityLevel':_0x4c2573['activityLevel']||'normal','systemMode':_0x21ca62[_0x30bab4(0x21b)]};_0x21ca62['dailyDigests'][_0x30bab4(0x253)](_0x20b000);const _0x15e5db=_0x21ca62[_0x30bab4(0x1e8)][_0x30bab4(0x267)]||0x3c;_0x21ca62[_0x30bab4(0x22b)][_0x30bab4(0x214)]>_0x15e5db&&_0x21ca62[_0x30bab4(0x22b)][_0x30bab4(0x22d)](0x0,_0x21ca62['dailyDigests'][_0x30bab4(0x214)]-_0x15e5db);await _0x21ca62[_0x30bab4(0x205)](LTM_DP_DAILY_DIGESTS,{'val':JSON[_0x30bab4(0x204)](_0x21ca62['dailyDigests']),'ack':!![]}),_0x21ca62[_0x30bab4(0x225)]=[],await _0x21ca62['setStateAsync'](LTM_DP_RAW_LOG,{'val':JSON[_0x30bab4(0x204)](_0x21ca62[_0x30bab4(0x225)]),'ack':!![]}),await _0x21ca62[_0x30bab4(0x205)](LTM_DP_STATUS,{'val':_0x30bab4(0x21a),'ack':!![]});const _0x3e9f21=_0x30bab4(0x1fc)+_0x4c2573[_0x30bab4(0x22a)]+'\x0aAktivit√§t:\x20'+_0x4c2573[_0x30bab4(0x1f6)];setup[_0x30bab4(0x1db)](_0x21ca62,_0x3e9f21,![],![]);if(_0x21ca62['isProVersion']&&_0x53b7ec)_0x53b7ec[_0x30bab4(0x1e0)](_0x21ca62,'ANALYZE_HEALTH',{'digest':_0x20b000});}catch(_0x42abcb){_0x21ca62[_0x30bab4(0x24d)]['error'](_0x42abcb[_0x30bab4(0x1f8)]);}}async function runBaselineDriftAnalysis(_0x4d1494){const _0x121b9a=a0_0x42517f;if(!_0x4d1494['isProVersion']||!_0x4d1494['geminiModel'])return;if(!canCallApi())return;const _0x262806=_0x4d1494[_0x121b9a(0x1e8)][_0x121b9a(0x26c)]||0xe;if(_0x4d1494[_0x121b9a(0x22b)][_0x121b9a(0x214)]<_0x262806+0x7){await _0x4d1494[_0x121b9a(0x205)](_0x121b9a(0x229),{'val':_0x121b9a(0x257),'ack':!![]});return;}const _0x1327d6=_0x4d1494[_0x121b9a(0x22b)]['slice'](-_0x262806),_0x10c32a=_0x4d1494[_0x121b9a(0x22b)][_0x121b9a(0x1e3)](0x0,_0x4d1494[_0x121b9a(0x22b)][_0x121b9a(0x214)]-_0x262806),_0x44dfbd='ROLLE:\x20Data\x20Scientist.\x20ZIEL:\x20Drift\x20erkennen.\x20SCHEMA:\x20{\x20\x22baselineDrift\x22:\x20\x22none|slight|significant|critical\x22,\x20\x22driftDetails\x22:\x20\x22string\x22\x20}\x0a\x0aLTB:\x20'+JSON['stringify'](_0x10c32a)+'\x0aSTB:\x20'+JSON[_0x121b9a(0x204)](_0x1327d6);try{updateApiTimestamp();const _0x5620d8=await _0x4d1494[_0x121b9a(0x228)]['generateContent'](_0x44dfbd),_0x220609=JSON['parse'](_0x5620d8[_0x121b9a(0x243)]['text']()['replace'](/```json|```/g,'')[_0x121b9a(0x271)]());_0x220609[_0x121b9a(0x239)]&&(await _0x4d1494[_0x121b9a(0x205)](_0x121b9a(0x229),{'val':_0x220609[_0x121b9a(0x239)],'ack':!![]}),await _0x4d1494[_0x121b9a(0x205)](_0x121b9a(0x254),{'val':_0x220609[_0x121b9a(0x20d)],'ack':!![]}),await _0x4d1494[_0x121b9a(0x205)](_0x121b9a(0x245),{'val':Date[_0x121b9a(0x1f9)](),'ack':!![]}));}catch(_0x2520cd){}}async function executeAutomationAction(_0x3a3077){const _0x285719=a0_0x42517f;try{const _0x3d5d56=await _0x3a3077[_0x285719(0x24e)]('analysis.automation.targetId'),_0x4b577a=await _0x3a3077['getStateAsync']('analysis.automation.targetValue');if(_0x3d5d56&&_0x3d5d56[_0x285719(0x1f4)]&&_0x4b577a){const _0x146791=_0x3d5d56[_0x285719(0x1f4)];let _0x541679=_0x4b577a[_0x285719(0x1f4)];try{_0x541679=JSON[_0x285719(0x24c)](_0x541679);}catch(_0x510c1a){}_0x3a3077[_0x285719(0x24d)][_0x285719(0x1ff)](_0x285719(0x250)+_0x146791+_0x285719(0x23b)+_0x541679),await _0x3a3077[_0x285719(0x249)](_0x146791,_0x541679);}else _0x3a3077[_0x285719(0x24d)][_0x285719(0x1fa)]('ü§ñ\x20BUTLER:\x20No\x20valid\x20target\x20ID\x20or\x20value\x20stored\x20for\x20execution.');}catch(_0x5b763d){_0x3a3077['log'][_0x285719(0x1f5)](_0x285719(0x22f)+_0x5b763d[_0x285719(0x1f8)]);}}async function sendMorningBriefing(_0xc0d9f3){const _0x3ffd3b=a0_0x42517f;if(!_0xc0d9f3[_0x3ffd3b(0x228)]){_0xc0d9f3[_0x3ffd3b(0x24d)][_0x3ffd3b(0x1fa)](_0x3ffd3b(0x1fb));return;}_0xc0d9f3[_0x3ffd3b(0x24d)]['info']('üåÖ\x20Starting\x20Morning\x20Briefing\x20sequence\x20(Traffic\x20Check\x20bypassed)...');try{updateApiTimestamp();const _0x513e75=_0x3ffd3b(0x206),_0x4f41e2=await _0xc0d9f3['geminiModel'][_0x3ffd3b(0x230)](_0x513e75),_0x45f7c9=_0x4f41e2[_0x3ffd3b(0x243)]['text']();_0xc0d9f3['log'][_0x3ffd3b(0x1ff)](_0x3ffd3b(0x1e4)+_0x45f7c9[_0x3ffd3b(0x214)]+_0x3ffd3b(0x1f3)),setup[_0x3ffd3b(0x1db)](_0xc0d9f3,_0x3ffd3b(0x255)+_0x45f7c9);}catch(_0x635db8){_0xc0d9f3['log']['error'](_0x3ffd3b(0x220)+_0x635db8[_0x3ffd3b(0x1f8)]);}}async function generateHealthReport(_0x24c49f,_0x1475be){const _0x5d22c7=a0_0x42517f;if(!_0x24c49f[_0x5d22c7(0x228)])return;const _0x34c83b=Date[_0x5d22c7(0x1f9)]();_0x34c83b-lastGlobalApiCall<0xbb8&&(_0x24c49f[_0x5d22c7(0x24d)][_0x5d22c7(0x244)]('ü§ñ\x20API\x20Cooldown.\x20Waiting\x202s...'),await new Promise(_0x268d72=>setTimeout(_0x268d72,0x7d0)));const _0x348e0d=new Date();let _0x4327c5=0x0,_0x19fad8=_0x348e0d[_0x5d22c7(0x263)](),_0xa43496='';if(_0x1475be===_0x5d22c7(0x1e2)){const _0x492cda=new Date(_0x348e0d);_0x492cda[_0x5d22c7(0x235)](_0x492cda[_0x5d22c7(0x264)]()-0x1),_0x492cda['setHours'](0x16,0x0,0x0,0x0),_0x4327c5=_0x492cda[_0x5d22c7(0x263)]();const _0x3618b6=new Date(_0x348e0d);_0x3618b6[_0x5d22c7(0x211)](0x8,0x0,0x0,0x0),_0x19fad8=_0x3618b6[_0x5d22c7(0x263)](),_0xa43496=_0x5d22c7(0x236);}else{const _0x20037f=new Date(_0x348e0d);_0x20037f[_0x5d22c7(0x211)](0x8,0x0,0x0,0x0),_0x4327c5=_0x20037f['getTime'](),_0xa43496=_0x5d22c7(0x1d7);}const _0x44736b=_0x24c49f[_0x5d22c7(0x26d)][_0x5d22c7(0x26a)](_0xa8992d=>_0xa8992d['timestamp']>=_0x4327c5&&_0xa8992d[_0x5d22c7(0x233)]<=_0x19fad8);if(_0x44736b['length']===0x0){const _0x2d6402=_0x1475be===_0x5d22c7(0x1e2)?_0x5d22c7(0x1de):_0x5d22c7(0x231),_0x10ecdf=_0x1475be===_0x5d22c7(0x1e2)?_0x5d22c7(0x268):_0x5d22c7(0x256);await _0x24c49f[_0x5d22c7(0x205)](_0x10ecdf,{'val':_0x2d6402,'ack':!![]});return;}const _0x17b4d5=_0x44736b[_0x5d22c7(0x21e)](_0xece99=>new Date(_0xece99[_0x5d22c7(0x233)])[_0x5d22c7(0x22c)]([],{'hour':'2-digit','minute':_0x5d22c7(0x1ec)})+'\x20'+_0xece99[_0x5d22c7(0x222)]+'\x20('+_0xece99[_0x5d22c7(0x217)]+')')[_0x5d22c7(0x25c)]('\x0a'),_0x2b528c=_0x5d22c7(0x1ea)+_0xa43496+'\x0a\x20\x20\x20\x20EVENTS:\x0a'+_0x17b4d5+_0x5d22c7(0x261);try{updateApiTimestamp();const _0x10915f=await _0x24c49f[_0x5d22c7(0x228)][_0x5d22c7(0x230)](_0x2b528c),_0x5892f9=_0x10915f['response'][_0x5d22c7(0x20b)](),_0x16523b=_0x1475be===_0x5d22c7(0x1e2)?_0x5d22c7(0x268):_0x5d22c7(0x256);await _0x24c49f[_0x5d22c7(0x205)](_0x16523b,{'val':_0x5892f9,'ack':!![]}),_0x24c49f['log'][_0x5d22c7(0x1ff)]('ü§ñ\x20Health\x20Report\x20('+_0x1475be+')\x20generated.');}catch(_0x1fa103){_0x24c49f['log'][_0x5d22c7(0x1f5)]('Health\x20Report\x20Error:\x20'+_0x1fa103[_0x5d22c7(0x1f8)]);}}module[a0_0x42517f(0x209)]={'executeAutomationAction':executeAutomationAction,'createDailyDigest':createDailyDigest,'runBaselineDriftAnalysis':runBaselineDriftAnalysis,'sendMorningBriefing':sendMorningBriefing,'runGeminiAnalysis':runGeminiAnalysis,'consultButler':consultButler,'generateHealthReport':generateHealthReport};