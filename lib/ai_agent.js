const a0_0x20ad74=a0_0x33d9;(function(_0xd81368,_0x132010){const _0x2f0175=a0_0x33d9,_0x17916f=_0xd81368();while(!![]){try{const _0x5c8a87=-parseInt(_0x2f0175(0x146))/0x1*(-parseInt(_0x2f0175(0x15c))/0x2)+-parseInt(_0x2f0175(0xfd))/0x3*(parseInt(_0x2f0175(0xf9))/0x4)+parseInt(_0x2f0175(0x150))/0x5*(-parseInt(_0x2f0175(0x18d))/0x6)+parseInt(_0x2f0175(0x14b))/0x7*(-parseInt(_0x2f0175(0x152))/0x8)+-parseInt(_0x2f0175(0x131))/0x9+-parseInt(_0x2f0175(0x107))/0xa*(parseInt(_0x2f0175(0x167))/0xb)+parseInt(_0x2f0175(0x14c))/0xc*(parseInt(_0x2f0175(0x13a))/0xd);if(_0x5c8a87===_0x132010)break;else _0x17916f['push'](_0x17916f['shift']());}catch(_0x49c6a7){_0x17916f['push'](_0x17916f['shift']());}}}(a0_0x4ab4,0xb772e));const a0_0x3442a6=(function(){let _0x4aa46f=!![];return function(_0x6dba34,_0x1ef400){const _0x23da50=_0x4aa46f?function(){const _0xa5da43=a0_0x33d9;if(_0x1ef400){const _0x303531=_0x1ef400[_0xa5da43(0x158)](_0x6dba34,arguments);return _0x1ef400=null,_0x303531;}}:function(){};return _0x4aa46f=![],_0x23da50;};}()),a0_0x52723a=a0_0x3442a6(this,function(){const _0x2295e8=a0_0x33d9;return a0_0x52723a[_0x2295e8(0x162)]()[_0x2295e8(0x14e)](_0x2295e8(0x106))[_0x2295e8(0x162)]()[_0x2295e8(0x188)](a0_0x52723a)[_0x2295e8(0x14e)](_0x2295e8(0x106));});a0_0x52723a();'use strict';const {GoogleGenerativeAI}=require(a0_0x20ad74(0x17b)),setup=require(a0_0x20ad74(0x120)),GEMINI_MODEL=a0_0x20ad74(0x159),LTM_DP_DAILY_DIGESTS=a0_0x20ad74(0xf6),LTM_DP_STATUS=a0_0x20ad74(0x18e),LTM_DP_RAW_LOG=a0_0x20ad74(0x15f),LTM_MIN_EVENTS_FOR_COMPRESSION=0x5,MIN_API_GAP_MS=0x4e20;function a0_0x4ab4(){const _0x522e9c=['baselineDrift','.\x20SYSTEM_MODE:\x20','summary','.\x20EVENTS:\x20','analysisHistory','Erstelle\x20ein\x20kurzes\x20\x27Guten\x20Morgen\x27\x20Briefing\x20basierend\x20auf\x20den\x20Events\x20der\x20letzten\x20Nacht.','2-digit','4955121yZQTag',')\x20generated.','analysis.automation.targetValue','eventHistory','.\x20EMERGENCY:\x20','analysis.lastResult','aiPersona','automationProposal','lastAlertState','26bBKzxV','\x0a\x20\x20\x20\x20ROLLE:\x20Medizinischer\x20Assistent\x20fÃ¼r\x20AAL\x20(Ambient\x20Assisted\x20Living).\x0a\x20\x20\x20\x20AUFGABE:\x20','map','pop',').\x20Sending\x20notification...','analysis.health.geminiNight','trim','\x0aSTB:\x20','message','warn','join','system.presenceWho','639167oqwQPu','Entscheide\x20ausgewogen\x20zwischen\x20Komfort\x20und\x20Energie.','ðŸ¤–\x20Butler\x20Cache\x20Hit:\x20','description','.forecast.current.temperature','4080678WKgORf','16530744JemzWQ','.Current.Temperature','search','ROLLE:\x20KI-Hausverwalter.\x20PERSONA:\x20','25TxqcWS','name','8UgDSKb','val','dailyDigests','LTM.driftAnalysis.driftDetails','detected','send','apply','models/gemini-flash-latest','Keine\x20Daten\x20fÃ¼r\x20die\x20Nacht\x20aufgezeichnet\x20(Sensoren\x20ruhig).','Analysiere\x20diese\x20Events\x20des\x20TAGES\x20(08:00-Jetzt).\x20AktivitÃ¤t?\x20Mahlzeiten?\x20HaustÃ¼r?\x20Antwort\x20kurz\x20fÃ¼r\x20den\x20besorgten\x20Sohn\x20(max\x202\x20SÃ¤tze).','2vufTSn','stringify','Fokus\x20auf\x20Komfort\x20fÃ¼r\x20die\x20Familie.','LTM.rawEventLog','now','Traffic-Schutz\x20(Auto-Approved)','toString','setStateAsync','toLocaleTimeString','Gemini\x20Error:\x20','.\x0a\x20\x20\x20\x20EVENT:\x20Bewohner\x20geht\x20wahrscheinlich\x20(','11zyWCNB','ðŸŒ…\x20Starting\x20Morning\x20Briefing\x20sequence\x20(Traffic\x20Check\x20bypassed)...','isProVersion','\x0a\x20\x20\x20\x20ANTWORT-STIL:\x20Sachlich,\x20beruhigend,\x20prÃ¤zise.\x20Keine\x20Floskeln.\x0a\x20\x20\x20\x20','analysis.health.geminiDay','\x22.\x0a\x20\x20\x20\x20AKTION:\x20Schalte\x20\x22','analysis.automation.targetId','config','analysis.automation.description','info','âš ï¸\x20ALARM:\x20','LTM.driftAnalysis.baselineDrift','targetId','push','debug','value','weatherInstance','slice','geminiModel','analysis.isAlert','@google/generative-ai','generateContent','ðŸ¤–\x20Autopilot\x20skipped\x20(Traffic\x20Protection\x20active).','BUTLER\x20Execution\x20Error:\x20','currentSystemMode','ðŸ¤–\x20BUTLER:\x20Executing\x20Action\x20->\x20','\x20->\x20','response','Sicherheit\x20geht\x20vor.','Keine\x20Details.','Health\x20Report\x20Error:\x20','sendNotification','ðŸ¤–\x20Traffic\x20Schutz:\x20Anfrage\x20fÃ¼r\x20','constructor','Success','%)\x20nach\x20\x22','ðŸŒ…\x20Morning\x20Briefing:\x0a','ðŸ¤–\x20BUTLER:\x20No\x20valid\x20target\x20ID\x20or\x20value\x20stored\x20for\x20execution.','153156hRowIs','LTM.processingStatus','setHours','activityLevel','ltmStbWindowDays','KI-Fehler\x20(Fallback)','Tag','ðŸ“…\x20Daily\x20Digest:\x0a','getTime','LTM.dailyDigests','analysis.automation.patternDetected','generic','3516252JYXhTN','text','\x0a\x20\x20\x20\x20EVENTS:\x0a','LTM.driftAnalysis.lastCheck','3Diqazw','Â°C,\x20','ROLLE:\x20Data\x20Scientist.\x20ZIEL:\x20Drift\x20erkennen.\x20SCHEMA:\x20{\x20\x22baselineDrift\x22:\x20\x22none|slight|significant|critical\x22,\x20\x22driftDetails\x22:\x20\x22string\x22\x20}\x0a\x0aLTB:\x20','NIGHT','replace','analysis.analysisHistory','alertReason','parse','KI\x20offline\x20(Fallback)','(((.+)+)+)+$','5026690UOnPcQ','analysis.alertReason','Unbekannt\x20(Kein\x20Sensor)','ROLLE:\x20Data\x20Compression\x20Agent.\x20SPRACHE:\x20DE.\x20FORMAT:\x20JSON.\x20ANWEISUNG:\x20Fasse\x20Sensor-Events\x20zusammen.\x20SCHEMA:\x20{\x20\x22summary\x22:\x20\x22string\x22,\x20\x22activityLevel\x22:\x20\x22string\x22\x20}\x20\x0a\x0aEVENTS:\x0a','getForeignStateAsync','Skipped\x20(Traffic)','ðŸ¤–\x20API\x20Cooldown.\x20Waiting\x202s...','targetValue','error','log','.\x20ANWESEND:\x20','livingContext','rawEventLog','length','toISOString','Unbekannt','\x22\x20AN.\x0a\x20\x20\x20\x20STRATEGIE:\x20','.forecast.current.state','isAlert','getStateAsync','.Current.IsNight','approved','getDate','.\x20AUFGABE:\x201.\x20Gesundheit?\x202.\x20Komfort?\x20FORMAT\x20(JSON):\x20{\x20\x22isAlert\x22:\x20boolean,\x20\x22alertReason\x22:\x20\x22string\x22,\x20\x22isEmergency\x22:\x20boolean,\x20\x22summary\x22:\x20\x22string\x22,\x20\x22automationProposal\x22:\x20{\x20\x22detected\x22:\x20boolean,\x20\x22description\x22:\x20\x22string\x22,\x20\x22targetId\x22:\x20\x22string\x22,\x20\x22targetValue\x22:\x20\x22any\x22\x20}\x20}','Bisher\x20keine\x20AktivitÃ¤t\x20seit\x2008:00\x20Uhr\x20verzeichnet.','./setup','.\x20KONTEXT:\x20',',\x20LichtverhÃ¤ltnisse:\x20','.Current.WeatherText','Wetterdaten\x20nicht\x20abrufbar','toFixed','Digest','Briefing\x20Error:\x20',',\x20Wetter:\x20','driftDetails'];a0_0x4ab4=function(){return _0x522e9c;};return a0_0x4ab4();}let lastGlobalApiCall=0x0;function a0_0x33d9(_0x14e6da,_0x2a83b8){const _0x32ad3c=a0_0x4ab4();return a0_0x33d9=function(_0x52723a,_0x3442a6){_0x52723a=_0x52723a-0xf5;let _0x4ab41f=_0x32ad3c[_0x52723a];return _0x4ab41f;},a0_0x33d9(_0x14e6da,_0x2a83b8);}const decisionCache={},CACHE_TTL_MS=0xf*0x3c*0x3e8,PERSONA_MAPPING={'generic':a0_0x20ad74(0x147),'senior_aal':'PRIORITÃ„T:\x20Sicherheit\x20und\x20Licht.\x20Schalte\x20lieber\x20einmal\x20zu\x20viel\x20als\x20zu\x20wenig.','family':a0_0x20ad74(0x15e),'single_comfort':'Maximaler\x20Komfort,\x20Energie\x20ist\x20zweitrangig.','security':a0_0x20ad74(0x183),'energy_saver':'PRIORITÃ„T:\x20Energie\x20sparen.\x20Schalte\x20nur,\x20wenn\x20absolut\x20notwendig\x20(Dunkelheit).'};function canCallApi(){const _0x31cc6e=a0_0x20ad74,_0x2295c8=Date[_0x31cc6e(0x160)]();return _0x2295c8-lastGlobalApiCall>MIN_API_GAP_MS;}function updateApiTimestamp(){const _0x2de713=a0_0x20ad74;lastGlobalApiCall=Date[_0x2de713(0x160)]();}async function getWeatherContext(_0x449980){const _0x99d5d4=a0_0x20ad74;if(!_0x449980[_0x99d5d4(0x16e)]['useWeather']||!_0x449980[_0x99d5d4(0x16e)][_0x99d5d4(0x177)])return _0x99d5d4(0x109);try{const _0x261d63=_0x449980[_0x99d5d4(0x16e)]['weatherInstance'];let _0x343742=await _0x449980[_0x99d5d4(0x10b)](_0x261d63+_0x99d5d4(0x14d));if(!_0x343742)_0x343742=await _0x449980[_0x99d5d4(0x10b)](_0x261d63+_0x99d5d4(0x14a));let _0x11e3ae=await _0x449980[_0x99d5d4(0x10b)](_0x261d63+_0x99d5d4(0x123));if(!_0x11e3ae)_0x11e3ae=await _0x449980[_0x99d5d4(0x10b)](_0x261d63+_0x99d5d4(0x118));let _0x1c9ae4=_0x99d5d4(0x116);const _0x2e7775=await _0x449980[_0x99d5d4(0x10b)](_0x261d63+_0x99d5d4(0x11b));if(_0x2e7775)_0x1c9ae4=_0x2e7775[_0x99d5d4(0x153)]?'Nacht':_0x99d5d4(0x193);if(_0x343742&&_0x11e3ae)return _0x343742['val']+_0x99d5d4(0xfe)+_0x11e3ae[_0x99d5d4(0x153)]+_0x99d5d4(0x122)+_0x1c9ae4;}catch(_0x5a6891){}return _0x99d5d4(0x124);}async function consultButler(_0x5e5db1,_0x28ede8,_0x4261f3,_0x4aedf7){const _0x14b25a=a0_0x20ad74;if(!_0x5e5db1['geminiModel'])return{'approved':!![],'reason':_0x14b25a(0x105)};const _0x23cdc4=Date[_0x14b25a(0x160)]();if(decisionCache[_0x28ede8]&&_0x23cdc4-decisionCache[_0x28ede8]['timestamp']<CACHE_TTL_MS){const _0x4d63cf=decisionCache[_0x28ede8]['decision'];return _0x5e5db1[_0x14b25a(0x110)][_0x14b25a(0x175)](_0x14b25a(0x148)+_0x28ede8+_0x14b25a(0x181)+(_0x4d63cf[_0x14b25a(0x11c)]?'OK':'NO')+'\x20('+_0x4d63cf['reason']+')'),_0x4d63cf;}if(!canCallApi())return _0x5e5db1['log'][_0x14b25a(0x175)](_0x14b25a(0x187)+_0x28ede8+'\x20Ã¼bersprungen\x20(Auto-Approved).'),{'approved':!![],'reason':_0x14b25a(0x161)};const _0x3d556e=new Date()[_0x14b25a(0x164)](),_0x52000c=await getWeatherContext(_0x5e5db1),_0x336067=PERSONA_MAPPING[_0x5e5db1[_0x14b25a(0x16e)][_0x14b25a(0x137)]||_0x14b25a(0xf8)],_0x974fb2='\x0a\x20\x20\x20\x20ROLLE:\x20Haus-Butler.\x0a\x20\x20\x20\x20SITUATION:\x20'+_0x3d556e+_0x14b25a(0x128)+_0x52000c+_0x14b25a(0x166)+(_0x4aedf7*0x64)[_0x14b25a(0x125)](0x0)+_0x14b25a(0x18a)+_0x28ede8+_0x14b25a(0x16c)+_0x4261f3+_0x14b25a(0x117)+_0x336067+'\x0a\x20\x20\x20\x20FRAGE:\x20Ist\x20es\x20dunkel\x20genug\x20fÃ¼r\x20Licht?\x0a\x20\x20\x20\x20FORMAT:\x20{\x20\x22approved\x22:\x20boolean,\x20\x22reason\x22:\x20\x22kurzer\x20Grund\x22\x20}\x0a\x20\x20\x20\x20';try{updateApiTimestamp();const _0x1702f0=await _0x5e5db1[_0x14b25a(0x179)][_0x14b25a(0x17c)](_0x974fb2),_0x2c2d79=_0x1702f0['response'][_0x14b25a(0xfa)]()['replace'](/```json|```/g,'')['trim'](),_0xc83e33=JSON[_0x14b25a(0x104)](_0x2c2d79);return decisionCache[_0x28ede8]={'decision':_0xc83e33,'timestamp':_0x23cdc4},_0xc83e33;}catch(_0x210096){return _0x5e5db1[_0x14b25a(0x110)]['warn']('ðŸ¤–\x20Butler\x20Brain\x20Error:\x20'+_0x210096['message']),decisionCache[_0x28ede8]={'decision':{'approved':!![],'reason':_0x14b25a(0x192)},'timestamp':_0x23cdc4-(CACHE_TTL_MS-0xea60)},{'approved':!![],'reason':'KI-Fehler\x20(Fallback)'};}}async function runGeminiAnalysis(_0x3cc815,_0x4f6885=''){const _0x1e8d28=a0_0x20ad74;if(!_0x3cc815['geminiModel'])return;if(!canCallApi()){_0x3cc815[_0x1e8d28(0x110)][_0x1e8d28(0x175)](_0x1e8d28(0x17d));return;}if(_0x3cc815['eventHistory'][_0x1e8d28(0x114)]===0x0)return;const _0x54f76c=_0x3cc815[_0x1e8d28(0x134)][_0x1e8d28(0x178)](0x0,0xf),_0x28ba3f=_0x3cc815[_0x1e8d28(0x17f)],_0x1db3cf=PERSONA_MAPPING[_0x3cc815[_0x1e8d28(0x16e)]['aiPersona']||_0x1e8d28(0xf8)],_0x27aaad=_0x3cc815[_0x1e8d28(0x16e)][_0x1e8d28(0x112)]||_0x1e8d28(0x184);let _0x20ad44=_0x1e8d28(0x116);try{const _0x2f52c2=await _0x3cc815[_0x1e8d28(0x11a)](_0x1e8d28(0x145));if(_0x2f52c2&&_0x2f52c2[_0x1e8d28(0x153)])_0x20ad44=_0x2f52c2[_0x1e8d28(0x153)];}catch(_0x18d00d){}let _0x582da4=![];try{const _0x413971=await _0x3cc815[_0x1e8d28(0x11a)]('analysis.automation.autoApply');if(_0x413971&&_0x413971[_0x1e8d28(0x153)])_0x582da4=!![];}catch(_0x428832){}const _0x482eb8=_0x1e8d28(0x14f)+_0x1db3cf+_0x1e8d28(0x121)+_0x27aaad+_0x1e8d28(0x12b)+_0x28ba3f+_0x1e8d28(0x111)+_0x20ad44+_0x1e8d28(0x12d)+JSON['stringify'](_0x54f76c)+_0x1e8d28(0x135)+_0x4f6885+_0x1e8d28(0x11e);try{updateApiTimestamp();const _0x20c767=await _0x3cc815['geminiModel'][_0x1e8d28(0x17c)](_0x482eb8),_0x273ebe=JSON['parse'](_0x20c767[_0x1e8d28(0x182)][_0x1e8d28(0xfa)]()[_0x1e8d28(0x101)](/```json|```/g,'')[_0x1e8d28(0x140)]());await _0x3cc815[_0x1e8d28(0x163)](_0x1e8d28(0x136),{'val':JSON['stringify'](_0x273ebe),'ack':!![]});if(_0x273ebe[_0x1e8d28(0x12c)])await _0x3cc815['setStateAsync']('analysis.activitySummary',{'val':_0x273ebe[_0x1e8d28(0x12c)],'ack':!![]});const _0x45f3c6={'timestamp':Date[_0x1e8d28(0x160)](),'id':Date[_0x1e8d28(0x160)]()[_0x1e8d28(0x162)](),'analysis':{'activity':{'summary':_0x273ebe[_0x1e8d28(0x12c)],'isAlert':_0x273ebe[_0x1e8d28(0x119)],'alertReason':_0x273ebe[_0x1e8d28(0x103)]},'comfort':{'automationProposal':_0x273ebe[_0x1e8d28(0x138)]}}};_0x3cc815[_0x1e8d28(0x12e)]['unshift'](_0x45f3c6);if(_0x3cc815[_0x1e8d28(0x12e)][_0x1e8d28(0x114)]>0x32)_0x3cc815[_0x1e8d28(0x12e)][_0x1e8d28(0x13d)]();await _0x3cc815[_0x1e8d28(0x163)](_0x1e8d28(0x102),{'val':JSON['stringify'](_0x3cc815[_0x1e8d28(0x12e)]),'ack':!![]});const _0x131ed4=_0x273ebe[_0x1e8d28(0x119)]||![];_0x131ed4!==_0x3cc815[_0x1e8d28(0x139)]&&(await _0x3cc815[_0x1e8d28(0x163)](_0x1e8d28(0x17a),{'val':_0x131ed4,'ack':!![]}),_0x3cc815['lastAlertState']=_0x131ed4,_0x131ed4&&(await _0x3cc815[_0x1e8d28(0x163)](_0x1e8d28(0x108),{'val':_0x273ebe['alertReason'],'ack':!![]}),setup[_0x1e8d28(0x186)](_0x3cc815,_0x1e8d28(0x171)+_0x273ebe[_0x1e8d28(0x103)],![],_0x273ebe['isEmergency'])));if(_0x273ebe[_0x1e8d28(0x138)]&&_0x273ebe[_0x1e8d28(0x138)][_0x1e8d28(0x156)]){await _0x3cc815[_0x1e8d28(0x163)](_0x1e8d28(0xf7),{'val':!![],'ack':!![]}),await _0x3cc815[_0x1e8d28(0x163)](_0x1e8d28(0x16f),{'val':_0x273ebe[_0x1e8d28(0x138)][_0x1e8d28(0x149)],'ack':!![]}),await _0x3cc815[_0x1e8d28(0x163)](_0x1e8d28(0x16d),{'val':_0x273ebe['automationProposal'][_0x1e8d28(0x173)],'ack':!![]}),await _0x3cc815[_0x1e8d28(0x163)](_0x1e8d28(0x133),{'val':JSON[_0x1e8d28(0x15d)](_0x273ebe[_0x1e8d28(0x138)][_0x1e8d28(0x10e)]),'ack':!![]});if(_0x582da4)executeAutomationAction(_0x3cc815);}}catch(_0x37454e){_0x3cc815[_0x1e8d28(0x110)][_0x1e8d28(0x10f)](_0x1e8d28(0x165)+_0x37454e[_0x1e8d28(0x142)]);}}async function createDailyDigest(_0x795c94,_0x5cdd8a){const _0x5200f4=a0_0x20ad74;if(!_0x795c94[_0x5200f4(0x169)])return;if(!canCallApi()){await _0x795c94[_0x5200f4(0x163)](LTM_DP_STATUS,{'val':_0x5200f4(0x10c),'ack':!![]});return;}await _0x795c94[_0x5200f4(0x163)](LTM_DP_STATUS,{'val':'Started...','ack':!![]});if(!_0x795c94[_0x5200f4(0x179)]||_0x795c94[_0x5200f4(0x113)][_0x5200f4(0x114)]<LTM_MIN_EVENTS_FOR_COMPRESSION){await _0x795c94[_0x5200f4(0x163)](LTM_DP_STATUS,{'val':'Skipped\x20(No\x20AI\x20or\x20Data)','ack':!![]});return;}const _0x134e37=JSON[_0x5200f4(0x104)](JSON[_0x5200f4(0x15d)](_0x795c94[_0x5200f4(0x113)])),_0x1895eb=_0x134e37[_0x5200f4(0x114)],_0x4131bb=_0x5200f4(0x10a)+JSON[_0x5200f4(0x15d)](_0x134e37);try{updateApiTimestamp();const _0x1246a5=await _0x795c94[_0x5200f4(0x179)][_0x5200f4(0x17c)](_0x4131bb),_0x59785b=JSON['parse'](_0x1246a5[_0x5200f4(0x182)][_0x5200f4(0xfa)]()[_0x5200f4(0x101)](/```json|```/g,'')[_0x5200f4(0x140)]()),_0x382123={'timestamp':new Date()[_0x5200f4(0x115)](),'eventCount':_0x1895eb,'summary':_0x59785b[_0x5200f4(0x12c)]||_0x5200f4(0x126),'activityLevel':_0x59785b[_0x5200f4(0x190)]||'normal','systemMode':_0x795c94[_0x5200f4(0x17f)]};_0x795c94[_0x5200f4(0x154)][_0x5200f4(0x174)](_0x382123);const _0x29248d=_0x795c94[_0x5200f4(0x16e)]['ltmLtbWindowDays']||0x3c;_0x795c94[_0x5200f4(0x154)][_0x5200f4(0x114)]>_0x29248d&&_0x795c94[_0x5200f4(0x154)]['splice'](0x0,_0x795c94[_0x5200f4(0x154)][_0x5200f4(0x114)]-_0x29248d);await _0x795c94[_0x5200f4(0x163)](LTM_DP_DAILY_DIGESTS,{'val':JSON[_0x5200f4(0x15d)](_0x795c94[_0x5200f4(0x154)]),'ack':!![]}),_0x795c94[_0x5200f4(0x113)]=[],await _0x795c94[_0x5200f4(0x163)](LTM_DP_RAW_LOG,{'val':JSON[_0x5200f4(0x15d)](_0x795c94[_0x5200f4(0x113)]),'ack':!![]}),await _0x795c94[_0x5200f4(0x163)](LTM_DP_STATUS,{'val':_0x5200f4(0x189),'ack':!![]});const _0x297449=_0x5200f4(0x194)+_0x59785b[_0x5200f4(0x12c)]+'\x0aAktivitÃ¤t:\x20'+_0x59785b[_0x5200f4(0x190)];setup[_0x5200f4(0x186)](_0x795c94,_0x297449,![],![]);if(_0x795c94['isProVersion']&&_0x5cdd8a)_0x5cdd8a[_0x5200f4(0x157)](_0x795c94,'ANALYZE_HEALTH',{'digest':_0x382123});}catch(_0x1fcd99){_0x795c94[_0x5200f4(0x110)][_0x5200f4(0x10f)](_0x1fcd99[_0x5200f4(0x142)]);}}async function runBaselineDriftAnalysis(_0x59265e){const _0x698fd3=a0_0x20ad74;if(!_0x59265e[_0x698fd3(0x169)]||!_0x59265e[_0x698fd3(0x179)])return;if(!canCallApi())return;const _0x46375c=_0x59265e[_0x698fd3(0x16e)][_0x698fd3(0x191)]||0xe;if(_0x59265e['dailyDigests'][_0x698fd3(0x114)]<_0x46375c+0x7){await _0x59265e[_0x698fd3(0x163)](_0x698fd3(0x172),{'val':'N/A\x20(Learning)','ack':!![]});return;}const _0x2cc65d=_0x59265e[_0x698fd3(0x154)]['slice'](-_0x46375c),_0x353f3e=_0x59265e['dailyDigests'][_0x698fd3(0x178)](0x0,_0x59265e[_0x698fd3(0x154)]['length']-_0x46375c),_0x3b69c5=_0x698fd3(0xff)+JSON[_0x698fd3(0x15d)](_0x353f3e)+_0x698fd3(0x141)+JSON[_0x698fd3(0x15d)](_0x2cc65d);try{updateApiTimestamp();const _0x329ac2=await _0x59265e['geminiModel']['generateContent'](_0x3b69c5),_0x336a92=JSON[_0x698fd3(0x104)](_0x329ac2[_0x698fd3(0x182)][_0x698fd3(0xfa)]()[_0x698fd3(0x101)](/```json|```/g,'')['trim']());_0x336a92[_0x698fd3(0x12a)]&&(await _0x59265e[_0x698fd3(0x163)](_0x698fd3(0x172),{'val':_0x336a92['baselineDrift'],'ack':!![]}),await _0x59265e[_0x698fd3(0x163)](_0x698fd3(0x155),{'val':_0x336a92[_0x698fd3(0x129)],'ack':!![]}),await _0x59265e[_0x698fd3(0x163)](_0x698fd3(0xfc),{'val':Date[_0x698fd3(0x160)](),'ack':!![]}));}catch(_0x4df9de){}}async function executeAutomationAction(_0x5e599a){const _0x3291d4=a0_0x20ad74;try{const _0x153f22=await _0x5e599a['getStateAsync'](_0x3291d4(0x16d)),_0x3c985f=await _0x5e599a[_0x3291d4(0x11a)]('analysis.automation.targetValue');if(_0x153f22&&_0x153f22[_0x3291d4(0x153)]&&_0x3c985f){const _0x16dcdb=_0x153f22[_0x3291d4(0x153)];let _0x452d59=_0x3c985f[_0x3291d4(0x153)];try{_0x452d59=JSON[_0x3291d4(0x104)](_0x452d59);}catch(_0x208579){}_0x5e599a[_0x3291d4(0x110)]['info'](_0x3291d4(0x180)+_0x16dcdb+'\x20=\x20'+_0x452d59),await _0x5e599a['setForeignStateAsync'](_0x16dcdb,_0x452d59);}else _0x5e599a[_0x3291d4(0x110)][_0x3291d4(0x143)](_0x3291d4(0x18c));}catch(_0x4104a8){_0x5e599a[_0x3291d4(0x110)][_0x3291d4(0x10f)](_0x3291d4(0x17e)+_0x4104a8['message']);}}async function sendMorningBriefing(_0x3fcd29){const _0x1a2822=a0_0x20ad74;if(!_0x3fcd29[_0x1a2822(0x179)]){_0x3fcd29['log'][_0x1a2822(0x143)]('ðŸ¤–\x20Morning\x20Briefing\x20skipped:\x20No\x20Gemini\x20Model.');return;}_0x3fcd29[_0x1a2822(0x110)][_0x1a2822(0x170)](_0x1a2822(0x168));try{updateApiTimestamp();const _0x1a5f8d=_0x1a2822(0x12f),_0x5e98dc=await _0x3fcd29['geminiModel'][_0x1a2822(0x17c)](_0x1a5f8d),_0x39a56e=_0x5e98dc['response']['text']();_0x3fcd29[_0x1a2822(0x110)]['info']('ðŸŒ…\x20Briefing\x20generated\x20(Length:\x20'+_0x39a56e[_0x1a2822(0x114)]+_0x1a2822(0x13e)),setup[_0x1a2822(0x186)](_0x3fcd29,_0x1a2822(0x18b)+_0x39a56e);}catch(_0x2d6a1f){_0x3fcd29[_0x1a2822(0x110)][_0x1a2822(0x10f)](_0x1a2822(0x127)+_0x2d6a1f[_0x1a2822(0x142)]);}}async function generateHealthReport(_0x3d6e13,_0x3b72){const _0xfa1b51=a0_0x20ad74;if(!_0x3d6e13[_0xfa1b51(0x179)])return;const _0x2e4b4d=Date['now']();_0x2e4b4d-lastGlobalApiCall<0xbb8&&(_0x3d6e13['log'][_0xfa1b51(0x175)](_0xfa1b51(0x10d)),await new Promise(_0x32321c=>setTimeout(_0x32321c,0x7d0)));const _0x278209=new Date();let _0x4ba06a=0x0,_0x5b1310=_0x278209[_0xfa1b51(0xf5)](),_0x56ad24='';if(_0x3b72==='NIGHT'){const _0x1b8eb8=new Date(_0x278209);_0x1b8eb8['setDate'](_0x1b8eb8[_0xfa1b51(0x11d)]()-0x1),_0x1b8eb8['setHours'](0x16,0x0,0x0,0x0),_0x4ba06a=_0x1b8eb8[_0xfa1b51(0xf5)]();const _0x386450=new Date(_0x278209);_0x386450[_0xfa1b51(0x18f)](0x8,0x0,0x0,0x0),_0x5b1310=_0x386450[_0xfa1b51(0xf5)](),_0x56ad24='Analysiere\x20diese\x20Events\x20der\x20NACHT\x20(22:00-08:00).\x20War\x20der\x20Schlaf\x20ruhig?\x20Gab\x20es\x20BadgÃ¤nge?\x20Antwort\x20kurz\x20fÃ¼r\x20den\x20besorgten\x20Sohn\x20(max\x202\x20SÃ¤tze).';}else{const _0x4b085b=new Date(_0x278209);_0x4b085b[_0xfa1b51(0x18f)](0x8,0x0,0x0,0x0),_0x4ba06a=_0x4b085b[_0xfa1b51(0xf5)](),_0x56ad24=_0xfa1b51(0x15b);}const _0x2c3af9=_0x3d6e13[_0xfa1b51(0x134)]['filter'](_0x3ba316=>_0x3ba316['timestamp']>=_0x4ba06a&&_0x3ba316['timestamp']<=_0x5b1310);if(_0x2c3af9[_0xfa1b51(0x114)]===0x0){const _0x105517=_0x3b72===_0xfa1b51(0x100)?_0xfa1b51(0x15a):_0xfa1b51(0x11f),_0x435a41=_0x3b72==='NIGHT'?'analysis.health.geminiNight':_0xfa1b51(0x16b);await _0x3d6e13['setStateAsync'](_0x435a41,{'val':_0x105517,'ack':!![]});return;}const _0x2eeb08=_0x2c3af9[_0xfa1b51(0x13c)](_0x26db05=>new Date(_0x26db05['timestamp'])[_0xfa1b51(0x164)]([],{'hour':_0xfa1b51(0x130),'minute':_0xfa1b51(0x130)})+'\x20'+_0x26db05[_0xfa1b51(0x151)]+'\x20('+_0x26db05[_0xfa1b51(0x176)]+')')[_0xfa1b51(0x144)]('\x0a'),_0x5885a7=_0xfa1b51(0x13b)+_0x56ad24+_0xfa1b51(0xfb)+_0x2eeb08+_0xfa1b51(0x16a);try{updateApiTimestamp();const _0x1e1093=await _0x3d6e13['geminiModel'][_0xfa1b51(0x17c)](_0x5885a7),_0xda2e38=_0x1e1093['response'][_0xfa1b51(0xfa)](),_0x4c9f65=_0x3b72===_0xfa1b51(0x100)?_0xfa1b51(0x13f):_0xfa1b51(0x16b);await _0x3d6e13[_0xfa1b51(0x163)](_0x4c9f65,{'val':_0xda2e38,'ack':!![]}),_0x3d6e13[_0xfa1b51(0x110)][_0xfa1b51(0x170)]('ðŸ¤–\x20Health\x20Report\x20('+_0x3b72+_0xfa1b51(0x132));}catch(_0x17fc61){_0x3d6e13[_0xfa1b51(0x110)][_0xfa1b51(0x10f)](_0xfa1b51(0x185)+_0x17fc61[_0xfa1b51(0x142)]);}}module['exports']={'executeAutomationAction':executeAutomationAction,'createDailyDigest':createDailyDigest,'runBaselineDriftAnalysis':runBaselineDriftAnalysis,'sendMorningBriefing':sendMorningBriefing,'runGeminiAnalysis':runGeminiAnalysis,'consultButler':consultButler,'generateHealthReport':generateHealthReport};