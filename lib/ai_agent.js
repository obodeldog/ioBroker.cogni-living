function a0_0x32d9(_0x2c9843,_0x3077d0){const _0x12a89c=a0_0x1e93();return a0_0x32d9=function(_0x5db709,_0xd328a3){_0x5db709=_0x5db709-0x1a3;let _0x1e93d5=_0x12a89c[_0x5db709];return _0x1e93d5;},a0_0x32d9(_0x2c9843,_0x3077d0);}const a0_0x1e427f=a0_0x32d9;(function(_0x3b0e07,_0x16ea17){const _0x4f7752=a0_0x32d9,_0x5c5e7d=_0x3b0e07();while(!![]){try{const _0x2faa0f=parseInt(_0x4f7752(0x1d9))/0x1+-parseInt(_0x4f7752(0x1df))/0x2+parseInt(_0x4f7752(0x1e3))/0x3+-parseInt(_0x4f7752(0x1f6))/0x4*(parseInt(_0x4f7752(0x1f2))/0x5)+-parseInt(_0x4f7752(0x1ad))/0x6*(-parseInt(_0x4f7752(0x1c9))/0x7)+parseInt(_0x4f7752(0x1da))/0x8+parseInt(_0x4f7752(0x1af))/0x9;if(_0x2faa0f===_0x16ea17)break;else _0x5c5e7d['push'](_0x5c5e7d['shift']());}catch(_0x36fa50){_0x5c5e7d['push'](_0x5c5e7d['shift']());}}}(a0_0x1e93,0x54dc3));const a0_0xd328a3=(function(){let _0x36fa56=!![];return function(_0x3c3b8b,_0x1f84dc){const _0x131a1b=_0x36fa56?function(){const _0x3fc860=a0_0x32d9;if(_0x1f84dc){const _0x4b8e1e=_0x1f84dc[_0x3fc860(0x1fc)](_0x3c3b8b,arguments);return _0x1f84dc=null,_0x4b8e1e;}}:function(){};return _0x36fa56=![],_0x131a1b;};}()),a0_0x5db709=a0_0xd328a3(this,function(){const _0x15f2b4=a0_0x32d9;return a0_0x5db709[_0x15f2b4(0x1b4)]()[_0x15f2b4(0x1d1)](_0x15f2b4(0x1aa))[_0x15f2b4(0x1b4)]()[_0x15f2b4(0x1b6)](a0_0x5db709)[_0x15f2b4(0x1d1)]('(((.+)+)+)+$');});a0_0x5db709();'use strict';const {GoogleGenerativeAI}=require(a0_0x1e427f(0x1fa)),setup=require(a0_0x1e427f(0x1e7)),GEMINI_MODEL=a0_0x1e427f(0x201),LTM_DP_DAILY_DIGESTS=a0_0x1e427f(0x1c0),LTM_DP_STATUS='LTM.processingStatus',LTM_DP_RAW_LOG=a0_0x1e427f(0x1a5),LTM_MIN_EVENTS_FOR_COMPRESSION=0x5,PERSONA_MAPPING={'generic':'Analysiere\x20ausgewogen.','senior_aal':a0_0x1e427f(0x1e2),'family':a0_0x1e427f(0x200),'single_comfort':'Fokus\x20auf\x20Komfort.','security':'PRIORITÃ„T:\x20Sicherheit.'};async function executeAutomationAction(_0xaa0e21){const _0x2e7f37=a0_0x1e427f;try{const _0x1c8d80=await _0xaa0e21['getStateAsync'](_0x2e7f37(0x1c2)),_0x15d4b6=await _0xaa0e21[_0x2e7f37(0x204)](_0x2e7f37(0x1d0));if(_0x1c8d80&&_0x1c8d80[_0x2e7f37(0x1fe)]&&_0x15d4b6){const _0x9a787d=_0x1c8d80[_0x2e7f37(0x1fe)];let _0x7f7363=_0x15d4b6[_0x2e7f37(0x1fe)];try{_0x7f7363=JSON[_0x2e7f37(0x1ac)](_0x7f7363);}catch(_0x4d3ac0){}_0xaa0e21[_0x2e7f37(0x1e4)][_0x2e7f37(0x1e9)](_0x2e7f37(0x1b1)+_0x9a787d+_0x2e7f37(0x1a4)+_0x7f7363),await _0xaa0e21['setForeignStateAsync'](_0x9a787d,_0x7f7363);}else _0xaa0e21[_0x2e7f37(0x1e4)][_0x2e7f37(0x1bb)](_0x2e7f37(0x1bd));}catch(_0x321164){_0xaa0e21['log'][_0x2e7f37(0x1b2)](_0x2e7f37(0x1eb)+_0x321164[_0x2e7f37(0x1c6)]);}}async function createDailyDigest(_0x3cef99,_0x165c67){const _0xe192e3=a0_0x1e427f;if(!_0x3cef99[_0xe192e3(0x1e0)])return;await _0x3cef99['setStateAsync'](LTM_DP_STATUS,{'val':_0xe192e3(0x1c8),'ack':!![]});if(!_0x3cef99[_0xe192e3(0x1d5)]||_0x3cef99[_0xe192e3(0x1cd)][_0xe192e3(0x1c5)]<LTM_MIN_EVENTS_FOR_COMPRESSION){await _0x3cef99[_0xe192e3(0x1ec)](LTM_DP_STATUS,{'val':'Skipped\x20(No\x20AI\x20or\x20Data)','ack':!![]});return;}const _0x59358a=JSON[_0xe192e3(0x1ac)](JSON[_0xe192e3(0x1dd)](_0x3cef99[_0xe192e3(0x1cd)])),_0x9ad3d6=_0x59358a[_0xe192e3(0x1c5)],_0x38d5cb=_0xe192e3(0x1f5)+JSON[_0xe192e3(0x1dd)](_0x59358a);try{const _0x29d13d=await _0x3cef99[_0xe192e3(0x1d5)][_0xe192e3(0x1d6)](_0x38d5cb),_0x3b22df=JSON[_0xe192e3(0x1ac)](_0x29d13d[_0xe192e3(0x1c3)][_0xe192e3(0x1dc)]()[_0xe192e3(0x1a6)](/```json|```/g,'')[_0xe192e3(0x1f4)]()),_0x13c11c={'timestamp':new Date()[_0xe192e3(0x1d2)](),'eventCount':_0x9ad3d6,'summary':_0x3b22df[_0xe192e3(0x1ff)]||'Digest','activityLevel':_0x3b22df[_0xe192e3(0x1ee)]||_0xe192e3(0x1bf),'systemMode':_0x3cef99[_0xe192e3(0x1cc)]};_0x3cef99[_0xe192e3(0x1a8)]['push'](_0x13c11c);const _0x3baeea=_0x3cef99[_0xe192e3(0x1ab)][_0xe192e3(0x1cf)]||0x3c;_0x3cef99[_0xe192e3(0x1a8)][_0xe192e3(0x1c5)]>_0x3baeea&&_0x3cef99[_0xe192e3(0x1a8)][_0xe192e3(0x1d3)](0x0,_0x3cef99[_0xe192e3(0x1a8)]['length']-_0x3baeea);await _0x3cef99[_0xe192e3(0x1ec)](LTM_DP_DAILY_DIGESTS,{'val':JSON[_0xe192e3(0x1dd)](_0x3cef99[_0xe192e3(0x1a8)]),'ack':!![]}),_0x3cef99[_0xe192e3(0x1cd)]=[],await _0x3cef99[_0xe192e3(0x1ec)](LTM_DP_RAW_LOG,{'val':JSON[_0xe192e3(0x1dd)](_0x3cef99[_0xe192e3(0x1cd)]),'ack':!![]}),await _0x3cef99[_0xe192e3(0x1ec)](LTM_DP_STATUS,{'val':_0xe192e3(0x1b9),'ack':!![]});if(_0x3cef99['isProVersion']&&_0x165c67)_0x165c67['send'](_0x3cef99,_0xe192e3(0x1b0),{'digest':_0x13c11c});}catch(_0xf7cc8d){_0x3cef99[_0xe192e3(0x1e4)][_0xe192e3(0x1b2)](_0xf7cc8d[_0xe192e3(0x1c6)]);}}async function runBaselineDriftAnalysis(_0x1dc0fb){const _0x536bba=a0_0x1e427f;if(!_0x1dc0fb[_0x536bba(0x1e0)]||!_0x1dc0fb['geminiModel'])return;const _0x365ede=_0x1dc0fb['config'][_0x536bba(0x1ba)]||0xe;if(_0x1dc0fb['dailyDigests']['length']<_0x365ede+0x7){await _0x1dc0fb[_0x536bba(0x1ec)](_0x536bba(0x1a9),{'val':_0x536bba(0x1e5),'ack':!![]});return;}const _0x27072a=_0x1dc0fb[_0x536bba(0x1a8)][_0x536bba(0x1f9)](-_0x365ede),_0x20eb1c=_0x1dc0fb['dailyDigests'][_0x536bba(0x1f9)](0x0,_0x1dc0fb[_0x536bba(0x1a8)][_0x536bba(0x1c5)]-_0x365ede),_0x57e23f='ROLLE:\x20Data\x20Scientist.\x20ZIEL:\x20Drift\x20erkennen.\x20SCHEMA:\x20{\x20\x22baselineDrift\x22:\x20\x22none|slight|significant|critical\x22,\x20\x22driftDetails\x22:\x20\x22string\x22\x20}\x0a\x0aLTB:\x20'+JSON[_0x536bba(0x1dd)](_0x20eb1c)+'\x0aSTB:\x20'+JSON[_0x536bba(0x1dd)](_0x27072a);try{const _0x44f260=await _0x1dc0fb[_0x536bba(0x1d5)]['generateContent'](_0x57e23f),_0xaae0c6=JSON[_0x536bba(0x1ac)](_0x44f260['response']['text']()[_0x536bba(0x1a6)](/```json|```/g,'')['trim']());_0xaae0c6[_0x536bba(0x1ca)]&&(await _0x1dc0fb[_0x536bba(0x1ec)](_0x536bba(0x1a9),{'val':_0xaae0c6[_0x536bba(0x1ca)],'ack':!![]}),await _0x1dc0fb[_0x536bba(0x1ec)](_0x536bba(0x1fb),{'val':_0xaae0c6['driftDetails'],'ack':!![]}),await _0x1dc0fb[_0x536bba(0x1ec)]('LTM.driftAnalysis.lastCheck',{'val':Date[_0x536bba(0x1d7)](),'ack':!![]}));}catch(_0x424af5){}}async function sendMorningBriefing(_0x30cf15){const _0x47e5e7=a0_0x1e427f;if(!_0x30cf15['geminiModel'])return;try{const _0x3ac7f2=_0x47e5e7(0x1f3),_0x391512=await _0x30cf15[_0x47e5e7(0x1d5)][_0x47e5e7(0x1d6)](_0x3ac7f2),_0x250b81=_0x391512[_0x47e5e7(0x1c3)][_0x47e5e7(0x1dc)]();setup[_0x47e5e7(0x205)](_0x30cf15,'ðŸŒ…\x20Morning\x20Briefing:\x0a'+_0x250b81);}catch(_0x21b31e){_0x30cf15[_0x47e5e7(0x1e4)][_0x47e5e7(0x1b2)](_0x47e5e7(0x1c1)+_0x21b31e[_0x47e5e7(0x1c6)]);}}async function runGeminiAnalysis(_0x3ffefa,_0x3eea5d=''){const _0x4a5213=a0_0x1e427f;if(!_0x3ffefa[_0x4a5213(0x1d5)])return;if(_0x3ffefa[_0x4a5213(0x1b7)][_0x4a5213(0x1c5)]===0x0)return;const _0x4e34c4=_0x3ffefa[_0x4a5213(0x1b7)][_0x4a5213(0x1f9)](0x0,0xf),_0x51b543=_0x3ffefa[_0x4a5213(0x1cc)],_0x1ac493=PERSONA_MAPPING[_0x3ffefa[_0x4a5213(0x1ab)][_0x4a5213(0x1f1)]||_0x4a5213(0x203)],_0x32ee25=_0x3ffefa[_0x4a5213(0x1ab)][_0x4a5213(0x1a7)]||'Keine\x20Details.';let _0x1eda9e=_0x4a5213(0x1b3);try{const _0x2eaec1=await _0x3ffefa[_0x4a5213(0x204)](_0x4a5213(0x1f0));if(_0x2eaec1&&_0x2eaec1[_0x4a5213(0x1fe)])_0x1eda9e=_0x2eaec1['val'];}catch(_0x46fe3c){}let _0x325994=![];try{const _0x3cddec=await _0x3ffefa[_0x4a5213(0x204)](_0x4a5213(0x1b5));if(_0x3cddec&&_0x3cddec[_0x4a5213(0x1fe)])_0x325994=!![];}catch(_0x4c52d5){}const _0x17964e=_0x4a5213(0x1bc)+_0x1ac493+_0x4a5213(0x1cb)+_0x32ee25+_0x4a5213(0x1c4)+_0x51b543+_0x4a5213(0x1d8)+_0x1eda9e+_0x4a5213(0x1ea)+JSON['stringify'](_0x4e34c4)+_0x4a5213(0x202)+_0x3eea5d+_0x4a5213(0x1e8);try{const _0x8311e=await _0x3ffefa['geminiModel'][_0x4a5213(0x1d6)](_0x17964e),_0x1a8f7a=JSON[_0x4a5213(0x1ac)](_0x8311e[_0x4a5213(0x1c3)][_0x4a5213(0x1dc)]()[_0x4a5213(0x1a6)](/```json|```/g,'')[_0x4a5213(0x1f4)]());await _0x3ffefa[_0x4a5213(0x1ec)]('analysis.lastResult',{'val':JSON[_0x4a5213(0x1dd)](_0x1a8f7a),'ack':!![]});if(_0x1a8f7a['summary'])await _0x3ffefa[_0x4a5213(0x1ec)](_0x4a5213(0x1c7),{'val':_0x1a8f7a[_0x4a5213(0x1ff)],'ack':!![]});const _0x428109={'timestamp':Date[_0x4a5213(0x1d7)](),'id':Date[_0x4a5213(0x1d7)]()[_0x4a5213(0x1b4)](),'analysis':{'activity':{'summary':_0x1a8f7a[_0x4a5213(0x1ff)],'isAlert':_0x1a8f7a['isAlert'],'alertReason':_0x1a8f7a[_0x4a5213(0x1e1)]},'comfort':{'automationProposal':_0x1a8f7a[_0x4a5213(0x1f7)]}}};_0x3ffefa['analysisHistory'][_0x4a5213(0x1ed)](_0x428109);if(_0x3ffefa['analysisHistory'][_0x4a5213(0x1c5)]>0x32)_0x3ffefa[_0x4a5213(0x1de)][_0x4a5213(0x1a3)]();await _0x3ffefa[_0x4a5213(0x1ec)](_0x4a5213(0x1b8),{'val':JSON[_0x4a5213(0x1dd)](_0x3ffefa[_0x4a5213(0x1de)]),'ack':!![]});const _0x469bcb=_0x1a8f7a[_0x4a5213(0x1d4)]||![];_0x469bcb!==_0x3ffefa[_0x4a5213(0x1db)]&&(await _0x3ffefa[_0x4a5213(0x1ec)](_0x4a5213(0x1ef),{'val':_0x469bcb,'ack':!![]}),_0x3ffefa[_0x4a5213(0x1db)]=_0x469bcb,_0x469bcb&&(await _0x3ffefa[_0x4a5213(0x1ec)]('analysis.alertReason',{'val':_0x1a8f7a[_0x4a5213(0x1e1)],'ack':!![]}),setup[_0x4a5213(0x205)](_0x3ffefa,'âš ï¸\x20ALARM:\x20'+_0x1a8f7a[_0x4a5213(0x1e1)],![],_0x1a8f7a[_0x4a5213(0x1ae)])));if(_0x1a8f7a['automationProposal']&&_0x1a8f7a[_0x4a5213(0x1f7)][_0x4a5213(0x1fd)]){await _0x3ffefa[_0x4a5213(0x1ec)]('analysis.automation.patternDetected',{'val':!![],'ack':!![]}),await _0x3ffefa[_0x4a5213(0x1ec)](_0x4a5213(0x1ce),{'val':_0x1a8f7a[_0x4a5213(0x1f7)]['description'],'ack':!![]}),await _0x3ffefa[_0x4a5213(0x1ec)](_0x4a5213(0x1c2),{'val':_0x1a8f7a['automationProposal'][_0x4a5213(0x1e6)],'ack':!![]}),await _0x3ffefa[_0x4a5213(0x1ec)](_0x4a5213(0x1d0),{'val':JSON[_0x4a5213(0x1dd)](_0x1a8f7a[_0x4a5213(0x1f7)][_0x4a5213(0x1be)]),'ack':!![]});if(_0x325994)executeAutomationAction(_0x3ffefa);}}catch(_0x1ac40a){_0x3ffefa[_0x4a5213(0x1e4)][_0x4a5213(0x1b2)](_0x4a5213(0x1f8)+_0x1ac40a['message']);}}module['exports']={'executeAutomationAction':executeAutomationAction,'createDailyDigest':createDailyDigest,'runBaselineDriftAnalysis':runBaselineDriftAnalysis,'sendMorningBriefing':sendMorningBriefing,'runGeminiAnalysis':runGeminiAnalysis};function a0_0x1e93(){const _0xa37df9=['1299060ZgfiuC','log','N/A\x20(Learning)','targetId','./setup','.\x20AUFGABE:\x201.\x20Gesundheit?\x202.\x20Komfort?\x20FORMAT\x20(JSON):\x20{\x20\x22isAlert\x22:\x20boolean,\x20\x22alertReason\x22:\x20\x22string\x22,\x20\x22isEmergency\x22:\x20boolean,\x20\x22summary\x22:\x20\x22string\x22,\x20\x22automationProposal\x22:\x20{\x20\x22detected\x22:\x20boolean,\x20\x22description\x22:\x20\x22string\x22,\x20\x22targetId\x22:\x20\x22string\x22,\x20\x22targetValue\x22:\x20\x22any\x22\x20}\x20}','info','.\x20EVENTS:\x20','BUTLER\x20Execution\x20Error:\x20','setStateAsync','unshift','activityLevel','analysis.isAlert','system.presenceWho','aiPersona','95iJOUCw','Erstelle\x20ein\x20kurzes\x20\x27Guten\x20Morgen\x27\x20Briefing\x20basierend\x20auf\x20den\x20Events\x20der\x20letzten\x20Nacht.','trim','ROLLE:\x20Data\x20Compression\x20Agent.\x20SPRACHE:\x20DE.\x20FORMAT:\x20JSON.\x20ANWEISUNG:\x20Fasse\x20Sensor-Events\x20zusammen.\x20SCHEMA:\x20{\x20\x22summary\x22:\x20\x22string\x22,\x20\x22activityLevel\x22:\x20\x22string\x22\x20}\x20\x0a\x0aEVENTS:\x0a','126200DuvEjU','automationProposal','Gemini\x20Error:\x20','slice','@google/generative-ai','LTM.driftAnalysis.driftDetails','apply','detected','val','summary','Fokus\x20auf\x20Familienroutinen.','models/gemini-flash-latest','.\x20EMERGENCY:\x20','generic','getStateAsync','sendNotification','pop','\x20=\x20','LTM.rawEventLog','replace','livingContext','dailyDigests','LTM.driftAnalysis.baselineDrift','(((.+)+)+)+$','config','parse','6654CoQWbM','isEmergency','1437741NXgTrZ','ANALYZE_HEALTH','ðŸ¤–\x20BUTLER:\x20Executing\x20Action\x20->\x20','error','Unbekannt','toString','analysis.automation.autoApply','constructor','eventHistory','analysis.analysisHistory','Success','ltmStbWindowDays','warn','ROLLE:\x20KI-Hausverwalter.\x20PERSONA:\x20','ðŸ¤–\x20BUTLER:\x20No\x20valid\x20target\x20ID\x20or\x20value\x20stored\x20for\x20execution.','targetValue','normal','LTM.dailyDigests','Briefing\x20Error:\x20','analysis.automation.targetId','response','.\x20SYSTEM_MODE:\x20','length','message','analysis.activitySummary','Started...','2338YojCiN','baselineDrift','.\x20KONTEXT:\x20','currentSystemMode','rawEventLog','analysis.automation.description','ltmLtbWindowDays','analysis.automation.targetValue','search','toISOString','splice','isAlert','geminiModel','generateContent','now','.\x20ANWESEND:\x20','470417MhIFrh','362312jiJQjy','lastAlertState','text','stringify','analysisHistory','1063688PQpfpL','isProVersion','alertReason','PRIORITÃ„T:\x20Gesundheit/AAL.'];a0_0x1e93=function(){return _0xa37df9;};return a0_0x1e93();}