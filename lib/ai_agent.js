const a0_0x10458e=a0_0x105a;(function(_0x1cd42b,_0x519788){const _0x25af05=a0_0x105a,_0x21fca3=_0x1cd42b();while(!![]){try{const _0x28149d=-parseInt(_0x25af05(0x17c))/0x1*(-parseInt(_0x25af05(0x1ed))/0x2)+parseInt(_0x25af05(0x178))/0x3*(parseInt(_0x25af05(0x19d))/0x4)+parseInt(_0x25af05(0x1e0))/0x5+-parseInt(_0x25af05(0x1f5))/0x6*(-parseInt(_0x25af05(0x1a5))/0x7)+-parseInt(_0x25af05(0x19a))/0x8*(-parseInt(_0x25af05(0x1ee))/0x9)+-parseInt(_0x25af05(0x1e6))/0xa+-parseInt(_0x25af05(0x1c7))/0xb;if(_0x28149d===_0x519788)break;else _0x21fca3['push'](_0x21fca3['shift']());}catch(_0x4e7e7e){_0x21fca3['push'](_0x21fca3['shift']());}}}(a0_0x359e,0x99bac));const a0_0x106b1d=(function(){let _0x53f4b2=!![];return function(_0x2f76da,_0x54ef5e){const _0x17be77=_0x53f4b2?function(){if(_0x54ef5e){const _0x2aa022=_0x54ef5e['apply'](_0x2f76da,arguments);return _0x54ef5e=null,_0x2aa022;}}:function(){};return _0x53f4b2=![],_0x17be77;};}()),a0_0x38abb1=a0_0x106b1d(this,function(){const _0x55f287=a0_0x105a;return a0_0x38abb1['toString']()[_0x55f287(0x1d2)](_0x55f287(0x183))[_0x55f287(0x1cb)]()[_0x55f287(0x1d8)](a0_0x38abb1)[_0x55f287(0x1d2)](_0x55f287(0x183));});a0_0x38abb1();'use strict';const {GoogleGenerativeAI}=require('@google/generative-ai'),setup=require(a0_0x10458e(0x1cf)),GEMINI_MODEL=a0_0x10458e(0x197),LTM_DP_DAILY_DIGESTS=a0_0x10458e(0x16d),LTM_DP_STATUS=a0_0x10458e(0x1db),LTM_DP_RAW_LOG=a0_0x10458e(0x192),LTM_MIN_EVENTS_FOR_COMPRESSION=0x5,MIN_API_GAP_MS=0x4e20;let lastGlobalApiCall=0x0;const decisionCache={},CACHE_TTL_MS=0xf*0x3c*0x3e8,PERSONA_MAPPING={'generic':'Entscheide\x20ausgewogen\x20zwischen\x20Komfort\x20und\x20Energie.','senior_aal':a0_0x10458e(0x1c5),'family':a0_0x10458e(0x184),'single_comfort':'Maximaler\x20Komfort,\x20Energie\x20ist\x20zweitrangig.','security':a0_0x10458e(0x176),'energy_saver':a0_0x10458e(0x19c)};function canCallApi(){const _0x23a126=Date['now']();return _0x23a126-lastGlobalApiCall>MIN_API_GAP_MS;}function a0_0x359e(){const _0x160d63=['LTM.driftAnalysis.driftDetails','description','LTM.processingStatus','ðŸ¤–\x20Morning\x20Briefing\x20skipped:\x20No\x20Gemini\x20Model.','Nacht','toISOString','Digest','118995RpmDDS','isEmergency','.\x20SYSTEM_MODE:\x20','.Current.Temperature','Unbekannt','ðŸŒ…\x20Morning\x20Briefing:\x0a','273890UTIzZZ','.Current.WeatherText','ðŸ¤–\x20API\x20Cooldown.\x20Waiting\x202s...','ANALYZE_HEALTH','debug','now','âš ï¸\x20ALARM:\x20','2GHfmHX','255726wRhbJU','analysisHistory','val','lastAlertState',',\x20Wetter:\x20','join','analysis.health.geminiNight','789258QjOAsW','generateContent','replace','Bisher\x20keine\x20AktivitÃ¤t\x20seit\x2008:00\x20Uhr\x20verzeichnet.','.\x20EVENTS:\x20','response','weatherInstance','ðŸ¤–\x20BUTLER:\x20Executing\x20Action\x20->\x20','N/A\x20(Learning)','message','ðŸŒ…\x20Starting\x20Morning\x20Briefing\x20sequence\x20(Traffic\x20Check\x20bypassed)...','analysis.activitySummary','ltmStbWindowDays','Success','error','decision','push','alertReason','LTM.dailyDigests','KI-Fehler\x20(Fallback)','.\x0a\x20\x20\x20\x20EVENT:\x20Bewohner\x20geht\x20wahrscheinlich\x20(','geminiModel','currentSystemMode','name','Analysiere\x20diese\x20Events\x20des\x20TAGES\x20(08:00-Jetzt).\x20AktivitÃ¤t?\x20Mahlzeiten?\x20HaustÃ¼r?\x20Antwort\x20kurz\x20fÃ¼r\x20den\x20besorgten\x20Sohn\x20(max\x202\x20SÃ¤tze).','Unbekannt\x20(Kein\x20Sensor)','\x0a\x20\x20\x20\x20FRAGE:\x20Ist\x20es\x20dunkel\x20genug\x20fÃ¼r\x20Licht?\x0a\x20\x20\x20\x20FORMAT:\x20{\x20\x22approved\x22:\x20boolean,\x20\x22reason\x22:\x20\x22kurzer\x20Grund\x22\x20}\x0a\x20\x20\x20\x20','Sicherheit\x20geht\x20vor.','length','41523jnajmo','generic','ðŸ¤–\x20Butler\x20Brain\x20Error:\x20','Skipped\x20(Traffic)','270157UfjWyq','ðŸŒ…\x20Briefing\x20generated\x20(Length:\x20','.\x20KONTEXT:\x20','analysis.automation.autoApply',').\x20Sending\x20notification...','setHours','stringify','(((.+)+)+)+$','Fokus\x20auf\x20Komfort\x20fÃ¼r\x20die\x20Familie.','exports','dailyDigests','analysis.health.geminiDay','Started...','info','useWeather','\x22\x20AN.\x0a\x20\x20\x20\x20STRATEGIE:\x20','timestamp','analysis.automation.targetValue','getStateAsync','value','analysis.automation.targetId','ðŸ“…\x20Daily\x20Digest:\x0a','LTM.rawEventLog','analysis.automation.description','\x20=\x20','log','\x0a\x20\x20\x20\x20ROLLE:\x20Medizinischer\x20Assistent\x20fÃ¼r\x20AAL\x20(Ambient\x20Assisted\x20Living).\x0a\x20\x20\x20\x20AUFGABE:\x20','models/gemini-flash-latest','rawEventLog','getTime','80rqfwMX','analysis.alertReason','PRIORITÃ„T:\x20Energie\x20sparen.\x20Schalte\x20nur,\x20wenn\x20absolut\x20notwendig\x20(Dunkelheit).','44NAfWWn','.\x20ANWESEND:\x20','.forecast.current.state','targetValue','activityLevel','sendNotification','.forecast.current.temperature',',\x20LichtverhÃ¤ltnisse:\x20','7IPEuoS','eventHistory','slice','send','.\x20EMERGENCY:\x20','normal','LTM.driftAnalysis.lastCheck','targetId','analysis.automation.patternDetected','isAlert','approved','getForeignStateAsync',')\x20generated.','filter','system.presenceWho','ROLLE:\x20Data\x20Scientist.\x20ZIEL:\x20Drift\x20erkennen.\x20SCHEMA:\x20{\x20\x22baselineDrift\x22:\x20\x22none|slight|significant|critical\x22,\x20\x22driftDetails\x22:\x20\x22string\x22\x20}\x0a\x0aLTB:\x20','%)\x20nach\x20\x22','aiPersona','trim','warn','BUTLER\x20Execution\x20Error:\x20','splice','isProVersion','baselineDrift','2-digit','ðŸ¤–\x20Traffic\x20Schutz:\x20Anfrage\x20fÃ¼r\x20','ðŸ¤–\x20BUTLER:\x20No\x20valid\x20target\x20ID\x20or\x20value\x20stored\x20for\x20execution.','text','.Current.IsNight','parse','\x20->\x20','ltmLtbWindowDays','PRIORITÃ„T:\x20Sicherheit\x20und\x20Licht.\x20Schalte\x20lieber\x20einmal\x20zu\x20viel\x20als\x20zu\x20wenig.','toFixed','2253075VLUUhq','setStateAsync','automationProposal','NIGHT','toString','Briefing\x20Error:\x20','ðŸ¤–\x20Butler\x20Cache\x20Hit:\x20','\x0aAktivitÃ¤t:\x20','./setup','pop','config','search','\x0a\x20\x20\x20\x20ROLLE:\x20Haus-Butler.\x0a\x20\x20\x20\x20SITUATION:\x20','analysis.isAlert','ROLLE:\x20KI-Hausverwalter.\x20PERSONA:\x20','summary','Wetterdaten\x20nicht\x20abrufbar','constructor'];a0_0x359e=function(){return _0x160d63;};return a0_0x359e();}function updateApiTimestamp(){const _0x34d4e9=a0_0x10458e;lastGlobalApiCall=Date[_0x34d4e9(0x1eb)]();}async function getWeatherContext(_0x190bcd){const _0x588c65=a0_0x10458e;if(!_0x190bcd['config'][_0x588c65(0x18a)]||!_0x190bcd['config'][_0x588c65(0x1fb)])return _0x588c65(0x174);try{const _0x231bec=_0x190bcd[_0x588c65(0x1d1)]['weatherInstance'];let _0x12fea5=await _0x190bcd[_0x588c65(0x1b0)](_0x231bec+_0x588c65(0x1e3));if(!_0x12fea5)_0x12fea5=await _0x190bcd[_0x588c65(0x1b0)](_0x231bec+_0x588c65(0x1a3));let _0x1f8e27=await _0x190bcd[_0x588c65(0x1b0)](_0x231bec+_0x588c65(0x1e7));if(!_0x1f8e27)_0x1f8e27=await _0x190bcd['getForeignStateAsync'](_0x231bec+_0x588c65(0x19f));let _0x3db10a=_0x588c65(0x1e4);const _0xfe02fb=await _0x190bcd[_0x588c65(0x1b0)](_0x231bec+_0x588c65(0x1c1));if(_0xfe02fb)_0x3db10a=_0xfe02fb['val']?_0x588c65(0x1dd):'Tag';if(_0x12fea5&&_0x1f8e27)return _0x12fea5[_0x588c65(0x1f0)]+'Â°C,\x20'+_0x1f8e27[_0x588c65(0x1f0)]+_0x588c65(0x1a4)+_0x3db10a;}catch(_0x29ea96){}return _0x588c65(0x1d7);}async function consultButler(_0x18bbe8,_0x40ab0a,_0x546bce,_0x3a166c){const _0x3affd4=a0_0x10458e;if(!_0x18bbe8[_0x3affd4(0x170)])return{'approved':!![],'reason':'KI\x20offline\x20(Fallback)'};const _0x165fc0=Date[_0x3affd4(0x1eb)]();if(decisionCache[_0x40ab0a]&&_0x165fc0-decisionCache[_0x40ab0a][_0x3affd4(0x18c)]<CACHE_TTL_MS){const _0x503464=decisionCache[_0x40ab0a][_0x3affd4(0x204)];return _0x18bbe8[_0x3affd4(0x195)][_0x3affd4(0x1ea)](_0x3affd4(0x1cd)+_0x40ab0a+_0x3affd4(0x1c3)+(_0x503464[_0x3affd4(0x1af)]?'OK':'NO')+'\x20('+_0x503464['reason']+')'),_0x503464;}if(!canCallApi())return _0x18bbe8[_0x3affd4(0x195)][_0x3affd4(0x1ea)](_0x3affd4(0x1be)+_0x40ab0a+'\x20Ã¼bersprungen\x20(Auto-Approved).'),{'approved':!![],'reason':'Traffic-Schutz\x20(Auto-Approved)'};const _0x504ee3=new Date()['toLocaleTimeString'](),_0x260d31=await getWeatherContext(_0x18bbe8),_0xc74b5f=PERSONA_MAPPING[_0x18bbe8['config'][_0x3affd4(0x1b6)]||'generic'],_0x4f7054=_0x3affd4(0x1d3)+_0x504ee3+_0x3affd4(0x1f2)+_0x260d31+_0x3affd4(0x16f)+(_0x3a166c*0x64)[_0x3affd4(0x1c6)](0x0)+_0x3affd4(0x1b5)+_0x40ab0a+'\x22.\x0a\x20\x20\x20\x20AKTION:\x20Schalte\x20\x22'+_0x546bce+_0x3affd4(0x18b)+_0xc74b5f+_0x3affd4(0x175);try{updateApiTimestamp();const _0x1970d8=await _0x18bbe8[_0x3affd4(0x170)][_0x3affd4(0x1f6)](_0x4f7054),_0x399034=_0x1970d8[_0x3affd4(0x1fa)]['text']()[_0x3affd4(0x1f7)](/```json|```/g,'')[_0x3affd4(0x1b7)](),_0x16c1ed=JSON[_0x3affd4(0x1c2)](_0x399034);return decisionCache[_0x40ab0a]={'decision':_0x16c1ed,'timestamp':_0x165fc0},_0x16c1ed;}catch(_0x52aa9b){return _0x18bbe8[_0x3affd4(0x195)][_0x3affd4(0x1b8)](_0x3affd4(0x17a)+_0x52aa9b[_0x3affd4(0x1fe)]),decisionCache[_0x40ab0a]={'decision':{'approved':!![],'reason':_0x3affd4(0x16e)},'timestamp':_0x165fc0-(CACHE_TTL_MS-0xea60)},{'approved':!![],'reason':_0x3affd4(0x16e)};}}async function runGeminiAnalysis(_0x381d18,_0x4e4e7b=''){const _0x8d72bd=a0_0x10458e;if(!_0x381d18[_0x8d72bd(0x170)])return;if(!canCallApi()){_0x381d18[_0x8d72bd(0x195)][_0x8d72bd(0x1ea)]('ðŸ¤–\x20Autopilot\x20skipped\x20(Traffic\x20Protection\x20active).');return;}if(_0x381d18['eventHistory'][_0x8d72bd(0x177)]===0x0)return;const _0x48c659=_0x381d18['eventHistory'][_0x8d72bd(0x1a7)](0x0,0xf),_0x115a13=_0x381d18[_0x8d72bd(0x171)],_0x1470ee=PERSONA_MAPPING[_0x381d18[_0x8d72bd(0x1d1)][_0x8d72bd(0x1b6)]||_0x8d72bd(0x179)],_0x50ed8b=_0x381d18['config']['livingContext']||'Keine\x20Details.';let _0x1e6f2d='Unbekannt';try{const _0x1bb94f=await _0x381d18[_0x8d72bd(0x18e)](_0x8d72bd(0x1b3));if(_0x1bb94f&&_0x1bb94f['val'])_0x1e6f2d=_0x1bb94f[_0x8d72bd(0x1f0)];}catch(_0x1ed754){}let _0x2fd950=![];try{const _0xcc90fe=await _0x381d18[_0x8d72bd(0x18e)](_0x8d72bd(0x17f));if(_0xcc90fe&&_0xcc90fe[_0x8d72bd(0x1f0)])_0x2fd950=!![];}catch(_0x30b0ad){}const _0x147ea3=_0x8d72bd(0x1d5)+_0x1470ee+_0x8d72bd(0x17e)+_0x50ed8b+_0x8d72bd(0x1e2)+_0x115a13+_0x8d72bd(0x19e)+_0x1e6f2d+_0x8d72bd(0x1f9)+JSON[_0x8d72bd(0x182)](_0x48c659)+_0x8d72bd(0x1a9)+_0x4e4e7b+'.\x20AUFGABE:\x201.\x20Gesundheit?\x202.\x20Komfort?\x20FORMAT\x20(JSON):\x20{\x20\x22isAlert\x22:\x20boolean,\x20\x22alertReason\x22:\x20\x22string\x22,\x20\x22isEmergency\x22:\x20boolean,\x20\x22summary\x22:\x20\x22string\x22,\x20\x22automationProposal\x22:\x20{\x20\x22detected\x22:\x20boolean,\x20\x22description\x22:\x20\x22string\x22,\x20\x22targetId\x22:\x20\x22string\x22,\x20\x22targetValue\x22:\x20\x22any\x22\x20}\x20}';try{updateApiTimestamp();const _0x279879=await _0x381d18[_0x8d72bd(0x170)][_0x8d72bd(0x1f6)](_0x147ea3),_0x25d32f=JSON[_0x8d72bd(0x1c2)](_0x279879[_0x8d72bd(0x1fa)][_0x8d72bd(0x1c0)]()['replace'](/```json|```/g,'')[_0x8d72bd(0x1b7)]());await _0x381d18[_0x8d72bd(0x1c8)]('analysis.lastResult',{'val':JSON[_0x8d72bd(0x182)](_0x25d32f),'ack':!![]});if(_0x25d32f['summary'])await _0x381d18[_0x8d72bd(0x1c8)](_0x8d72bd(0x200),{'val':_0x25d32f[_0x8d72bd(0x1d6)],'ack':!![]});const _0x3fb09a={'timestamp':Date[_0x8d72bd(0x1eb)](),'id':Date[_0x8d72bd(0x1eb)]()[_0x8d72bd(0x1cb)](),'analysis':{'activity':{'summary':_0x25d32f['summary'],'isAlert':_0x25d32f[_0x8d72bd(0x1ae)],'alertReason':_0x25d32f[_0x8d72bd(0x206)]},'comfort':{'automationProposal':_0x25d32f[_0x8d72bd(0x1c9)]}}};_0x381d18[_0x8d72bd(0x1ef)]['unshift'](_0x3fb09a);if(_0x381d18['analysisHistory'][_0x8d72bd(0x177)]>0x32)_0x381d18[_0x8d72bd(0x1ef)][_0x8d72bd(0x1d0)]();await _0x381d18['setStateAsync']('analysis.analysisHistory',{'val':JSON['stringify'](_0x381d18[_0x8d72bd(0x1ef)]),'ack':!![]});const _0xb08a53=_0x25d32f['isAlert']||![];_0xb08a53!==_0x381d18['lastAlertState']&&(await _0x381d18[_0x8d72bd(0x1c8)](_0x8d72bd(0x1d4),{'val':_0xb08a53,'ack':!![]}),_0x381d18[_0x8d72bd(0x1f1)]=_0xb08a53,_0xb08a53&&(await _0x381d18[_0x8d72bd(0x1c8)](_0x8d72bd(0x19b),{'val':_0x25d32f[_0x8d72bd(0x206)],'ack':!![]}),setup[_0x8d72bd(0x1a2)](_0x381d18,_0x8d72bd(0x1ec)+_0x25d32f[_0x8d72bd(0x206)],![],_0x25d32f[_0x8d72bd(0x1e1)])));if(_0x25d32f[_0x8d72bd(0x1c9)]&&_0x25d32f[_0x8d72bd(0x1c9)]['detected']){await _0x381d18['setStateAsync'](_0x8d72bd(0x1ad),{'val':!![],'ack':!![]}),await _0x381d18[_0x8d72bd(0x1c8)](_0x8d72bd(0x193),{'val':_0x25d32f[_0x8d72bd(0x1c9)][_0x8d72bd(0x1da)],'ack':!![]}),await _0x381d18[_0x8d72bd(0x1c8)](_0x8d72bd(0x190),{'val':_0x25d32f['automationProposal'][_0x8d72bd(0x1ac)],'ack':!![]}),await _0x381d18[_0x8d72bd(0x1c8)](_0x8d72bd(0x18d),{'val':JSON[_0x8d72bd(0x182)](_0x25d32f[_0x8d72bd(0x1c9)][_0x8d72bd(0x1a0)]),'ack':!![]});if(_0x2fd950)executeAutomationAction(_0x381d18);}}catch(_0x40fd54){_0x381d18[_0x8d72bd(0x195)]['error']('Gemini\x20Error:\x20'+_0x40fd54[_0x8d72bd(0x1fe)]);}}async function createDailyDigest(_0x234e2d,_0x30fd24){const _0x46af44=a0_0x10458e;if(!_0x234e2d[_0x46af44(0x1bb)])return;if(!canCallApi()){await _0x234e2d['setStateAsync'](LTM_DP_STATUS,{'val':_0x46af44(0x17b),'ack':!![]});return;}await _0x234e2d[_0x46af44(0x1c8)](LTM_DP_STATUS,{'val':_0x46af44(0x188),'ack':!![]});if(!_0x234e2d[_0x46af44(0x170)]||_0x234e2d[_0x46af44(0x198)][_0x46af44(0x177)]<LTM_MIN_EVENTS_FOR_COMPRESSION){await _0x234e2d[_0x46af44(0x1c8)](LTM_DP_STATUS,{'val':'Skipped\x20(No\x20AI\x20or\x20Data)','ack':!![]});return;}const _0x1f17cc=JSON[_0x46af44(0x1c2)](JSON[_0x46af44(0x182)](_0x234e2d[_0x46af44(0x198)])),_0x1ff055=_0x1f17cc[_0x46af44(0x177)],_0x4127f3='ROLLE:\x20Data\x20Compression\x20Agent.\x20SPRACHE:\x20DE.\x20FORMAT:\x20JSON.\x20ANWEISUNG:\x20Fasse\x20Sensor-Events\x20zusammen.\x20SCHEMA:\x20{\x20\x22summary\x22:\x20\x22string\x22,\x20\x22activityLevel\x22:\x20\x22string\x22\x20}\x20\x0a\x0aEVENTS:\x0a'+JSON[_0x46af44(0x182)](_0x1f17cc);try{updateApiTimestamp();const _0xe0111a=await _0x234e2d[_0x46af44(0x170)]['generateContent'](_0x4127f3),_0x2bff59=JSON[_0x46af44(0x1c2)](_0xe0111a[_0x46af44(0x1fa)]['text']()['replace'](/```json|```/g,'')[_0x46af44(0x1b7)]()),_0x2962b6={'timestamp':new Date()[_0x46af44(0x1de)](),'eventCount':_0x1ff055,'summary':_0x2bff59['summary']||_0x46af44(0x1df),'activityLevel':_0x2bff59[_0x46af44(0x1a1)]||_0x46af44(0x1aa),'systemMode':_0x234e2d['currentSystemMode']};_0x234e2d[_0x46af44(0x186)][_0x46af44(0x205)](_0x2962b6);const _0x563a3a=_0x234e2d[_0x46af44(0x1d1)][_0x46af44(0x1c4)]||0x3c;_0x234e2d[_0x46af44(0x186)][_0x46af44(0x177)]>_0x563a3a&&_0x234e2d[_0x46af44(0x186)][_0x46af44(0x1ba)](0x0,_0x234e2d[_0x46af44(0x186)]['length']-_0x563a3a);await _0x234e2d[_0x46af44(0x1c8)](LTM_DP_DAILY_DIGESTS,{'val':JSON['stringify'](_0x234e2d[_0x46af44(0x186)]),'ack':!![]}),_0x234e2d[_0x46af44(0x198)]=[],await _0x234e2d[_0x46af44(0x1c8)](LTM_DP_RAW_LOG,{'val':JSON[_0x46af44(0x182)](_0x234e2d[_0x46af44(0x198)]),'ack':!![]}),await _0x234e2d[_0x46af44(0x1c8)](LTM_DP_STATUS,{'val':_0x46af44(0x202),'ack':!![]});const _0x18c182=_0x46af44(0x191)+_0x2bff59['summary']+_0x46af44(0x1ce)+_0x2bff59[_0x46af44(0x1a1)];setup[_0x46af44(0x1a2)](_0x234e2d,_0x18c182,![],![]);if(_0x234e2d[_0x46af44(0x1bb)]&&_0x30fd24)_0x30fd24[_0x46af44(0x1a8)](_0x234e2d,_0x46af44(0x1e9),{'digest':_0x2962b6});}catch(_0x5ad60a){_0x234e2d[_0x46af44(0x195)][_0x46af44(0x203)](_0x5ad60a[_0x46af44(0x1fe)]);}}function a0_0x105a(_0xc4d02f,_0x13b213){const _0x2dafb1=a0_0x359e();return a0_0x105a=function(_0x38abb1,_0x106b1d){_0x38abb1=_0x38abb1-0x16d;let _0x359e93=_0x2dafb1[_0x38abb1];return _0x359e93;},a0_0x105a(_0xc4d02f,_0x13b213);}async function runBaselineDriftAnalysis(_0x1e8b2a){const _0x1bc651=a0_0x10458e;if(!_0x1e8b2a['isProVersion']||!_0x1e8b2a[_0x1bc651(0x170)])return;if(!canCallApi())return;const _0x1e43a9=_0x1e8b2a[_0x1bc651(0x1d1)][_0x1bc651(0x201)]||0xe;if(_0x1e8b2a['dailyDigests'][_0x1bc651(0x177)]<_0x1e43a9+0x7){await _0x1e8b2a[_0x1bc651(0x1c8)]('LTM.driftAnalysis.baselineDrift',{'val':_0x1bc651(0x1fd),'ack':!![]});return;}const _0x583674=_0x1e8b2a[_0x1bc651(0x186)][_0x1bc651(0x1a7)](-_0x1e43a9),_0x498d79=_0x1e8b2a[_0x1bc651(0x186)][_0x1bc651(0x1a7)](0x0,_0x1e8b2a[_0x1bc651(0x186)][_0x1bc651(0x177)]-_0x1e43a9),_0x3bbec9=_0x1bc651(0x1b4)+JSON[_0x1bc651(0x182)](_0x498d79)+'\x0aSTB:\x20'+JSON[_0x1bc651(0x182)](_0x583674);try{updateApiTimestamp();const _0x429e5b=await _0x1e8b2a[_0x1bc651(0x170)]['generateContent'](_0x3bbec9),_0x28b0dd=JSON[_0x1bc651(0x1c2)](_0x429e5b[_0x1bc651(0x1fa)][_0x1bc651(0x1c0)]()['replace'](/```json|```/g,'')[_0x1bc651(0x1b7)]());_0x28b0dd[_0x1bc651(0x1bc)]&&(await _0x1e8b2a['setStateAsync']('LTM.driftAnalysis.baselineDrift',{'val':_0x28b0dd[_0x1bc651(0x1bc)],'ack':!![]}),await _0x1e8b2a[_0x1bc651(0x1c8)](_0x1bc651(0x1d9),{'val':_0x28b0dd['driftDetails'],'ack':!![]}),await _0x1e8b2a['setStateAsync'](_0x1bc651(0x1ab),{'val':Date['now'](),'ack':!![]}));}catch(_0x571bc7){}}async function executeAutomationAction(_0x567bdb){const _0x424d33=a0_0x10458e;try{const _0x523da7=await _0x567bdb[_0x424d33(0x18e)](_0x424d33(0x190)),_0x39b2de=await _0x567bdb[_0x424d33(0x18e)](_0x424d33(0x18d));if(_0x523da7&&_0x523da7['val']&&_0x39b2de){const _0x1e6618=_0x523da7[_0x424d33(0x1f0)];let _0x571503=_0x39b2de['val'];try{_0x571503=JSON[_0x424d33(0x1c2)](_0x571503);}catch(_0x43e887){}_0x567bdb['log'][_0x424d33(0x189)](_0x424d33(0x1fc)+_0x1e6618+_0x424d33(0x194)+_0x571503),await _0x567bdb['setForeignStateAsync'](_0x1e6618,_0x571503);}else _0x567bdb[_0x424d33(0x195)][_0x424d33(0x1b8)](_0x424d33(0x1bf));}catch(_0x45398f){_0x567bdb[_0x424d33(0x195)]['error'](_0x424d33(0x1b9)+_0x45398f[_0x424d33(0x1fe)]);}}async function sendMorningBriefing(_0x554abd){const _0x267cb5=a0_0x10458e;if(!_0x554abd[_0x267cb5(0x170)]){_0x554abd[_0x267cb5(0x195)]['warn'](_0x267cb5(0x1dc));return;}_0x554abd[_0x267cb5(0x195)][_0x267cb5(0x189)](_0x267cb5(0x1ff));try{updateApiTimestamp();const _0x257bec='Erstelle\x20ein\x20kurzes\x20\x27Guten\x20Morgen\x27\x20Briefing\x20basierend\x20auf\x20den\x20Events\x20der\x20letzten\x20Nacht.',_0x6aac83=await _0x554abd[_0x267cb5(0x170)]['generateContent'](_0x257bec),_0x1759e4=_0x6aac83['response'][_0x267cb5(0x1c0)]();_0x554abd[_0x267cb5(0x195)]['info'](_0x267cb5(0x17d)+_0x1759e4[_0x267cb5(0x177)]+_0x267cb5(0x180)),setup['sendNotification'](_0x554abd,_0x267cb5(0x1e5)+_0x1759e4);}catch(_0x414f7f){_0x554abd[_0x267cb5(0x195)]['error'](_0x267cb5(0x1cc)+_0x414f7f[_0x267cb5(0x1fe)]);}}async function generateHealthReport(_0x53eb8a,_0x553173){const _0x5e664e=a0_0x10458e;if(!_0x53eb8a[_0x5e664e(0x170)])return;const _0x37fe33=Date[_0x5e664e(0x1eb)]();_0x37fe33-lastGlobalApiCall<0xbb8&&(_0x53eb8a['log'][_0x5e664e(0x1ea)](_0x5e664e(0x1e8)),await new Promise(_0xf7ead1=>setTimeout(_0xf7ead1,0x7d0)));const _0x259a45=new Date();let _0x3279b7=0x0,_0x434216=_0x259a45[_0x5e664e(0x199)](),_0x495ded='';if(_0x553173==='NIGHT'){const _0x53c327=new Date(_0x259a45);_0x53c327['setDate'](_0x53c327['getDate']()-0x1),_0x53c327['setHours'](0x16,0x0,0x0,0x0),_0x3279b7=_0x53c327[_0x5e664e(0x199)]();const _0x4f2a91=new Date(_0x259a45);_0x4f2a91[_0x5e664e(0x181)](0x8,0x0,0x0,0x0),_0x434216=_0x4f2a91['getTime'](),_0x495ded='Analysiere\x20diese\x20Events\x20der\x20NACHT\x20(22:00-08:00).\x20War\x20der\x20Schlaf\x20ruhig?\x20Gab\x20es\x20BadgÃ¤nge?\x20Antwort\x20kurz\x20fÃ¼r\x20den\x20besorgten\x20Sohn\x20(max\x202\x20SÃ¤tze).';}else{const _0x2de522=new Date(_0x259a45);_0x2de522[_0x5e664e(0x181)](0x8,0x0,0x0,0x0),_0x3279b7=_0x2de522['getTime'](),_0x495ded=_0x5e664e(0x173);}const _0x3274fc=_0x53eb8a[_0x5e664e(0x1a6)][_0x5e664e(0x1b2)](_0x507eea=>_0x507eea[_0x5e664e(0x18c)]>=_0x3279b7&&_0x507eea[_0x5e664e(0x18c)]<=_0x434216);if(_0x3274fc['length']===0x0){const _0x2d2dcd=_0x553173===_0x5e664e(0x1ca)?'Keine\x20Daten\x20fÃ¼r\x20die\x20Nacht\x20aufgezeichnet\x20(Sensoren\x20ruhig).':_0x5e664e(0x1f8),_0x3e085f=_0x553173==='NIGHT'?_0x5e664e(0x1f4):_0x5e664e(0x187);await _0x53eb8a['setStateAsync'](_0x3e085f,{'val':_0x2d2dcd,'ack':!![]});return;}const _0x1774d0=_0x3274fc['map'](_0x12ced2=>new Date(_0x12ced2['timestamp'])['toLocaleTimeString']([],{'hour':_0x5e664e(0x1bd),'minute':_0x5e664e(0x1bd)})+'\x20'+_0x12ced2[_0x5e664e(0x172)]+'\x20('+_0x12ced2[_0x5e664e(0x18f)]+')')[_0x5e664e(0x1f3)]('\x0a'),_0x17f97d=_0x5e664e(0x196)+_0x495ded+'\x0a\x20\x20\x20\x20EVENTS:\x0a'+_0x1774d0+'\x0a\x20\x20\x20\x20ANTWORT-STIL:\x20Sachlich,\x20beruhigend,\x20prÃ¤zise.\x20Keine\x20Floskeln.\x0a\x20\x20\x20\x20';try{updateApiTimestamp();const _0x3d6663=await _0x53eb8a[_0x5e664e(0x170)][_0x5e664e(0x1f6)](_0x17f97d),_0x1ac139=_0x3d6663[_0x5e664e(0x1fa)]['text'](),_0x2a2055=_0x553173===_0x5e664e(0x1ca)?_0x5e664e(0x1f4):_0x5e664e(0x187);await _0x53eb8a[_0x5e664e(0x1c8)](_0x2a2055,{'val':_0x1ac139,'ack':!![]}),_0x53eb8a[_0x5e664e(0x195)][_0x5e664e(0x189)]('ðŸ¤–\x20Health\x20Report\x20('+_0x553173+_0x5e664e(0x1b1));}catch(_0x5ddc9e){_0x53eb8a[_0x5e664e(0x195)][_0x5e664e(0x203)]('Health\x20Report\x20Error:\x20'+_0x5ddc9e[_0x5e664e(0x1fe)]);}}module[a0_0x10458e(0x185)]={'executeAutomationAction':executeAutomationAction,'createDailyDigest':createDailyDigest,'runBaselineDriftAnalysis':runBaselineDriftAnalysis,'sendMorningBriefing':sendMorningBriefing,'runGeminiAnalysis':runGeminiAnalysis,'consultButler':consultButler,'generateHealthReport':generateHealthReport};