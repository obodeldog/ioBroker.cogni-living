const a0_0x38cfb8=a0_0x35fa;(function(_0x4ad7c2,_0x5a72f3){const _0x404183=a0_0x35fa,_0x769ff9=_0x4ad7c2();while(!![]){try{const _0x4b650a=-parseInt(_0x404183(0x18c))/0x1*(-parseInt(_0x404183(0x126))/0x2)+parseInt(_0x404183(0x123))/0x3*(-parseInt(_0x404183(0x141))/0x4)+-parseInt(_0x404183(0x134))/0x5+parseInt(_0x404183(0x11d))/0x6+parseInt(_0x404183(0x18a))/0x7+parseInt(_0x404183(0x16b))/0x8+-parseInt(_0x404183(0x13c))/0x9;if(_0x4b650a===_0x5a72f3)break;else _0x769ff9['push'](_0x769ff9['shift']());}catch(_0xe3f0a2){_0x769ff9['push'](_0x769ff9['shift']());}}}(a0_0x88d4,0xdeadf));function a0_0x88d4(){const _0x26bb6c=['text','Erstelle\x20ein\x20kurzes\x20\x27Guten\x20Morgen\x27\x20Briefing\x20basierend\x20auf\x20den\x20Events\x20der\x20letzten\x20Nacht.','geminiModel','isAlert','.\x20ANWESEND:\x20','Keine\x20Details.','LTM.driftAnalysis.driftDetails','KI\x20offline\x20(Fallback)','filter','.\x0a\x20\x20\x20\x20EVENT:\x20Bewohner\x20geht\x20wahrscheinlich\x20(','Unbekannt\x20(Kein\x20Sensor)','ü§ñ\x20BUTLER:\x20No\x20valid\x20target\x20ID\x20or\x20value\x20stored\x20for\x20execution.','length','reason','PRIORIT√ÑT:\x20Sicherheit\x20und\x20Licht.\x20Schalte\x20lieber\x20einmal\x20zu\x20viel\x20als\x20zu\x20wenig.','ltmStbWindowDays','search','KI-Fehler\x20(Fallback)','analysis.analysisHistory','parse',')\x20generated.','eventHistory','Entscheide\x20ausgewogen\x20zwischen\x20Komfort\x20und\x20Energie.','toString','8064360VnIrEi','@google/generative-ai',',\x20Lichtverh√§ltnisse:\x20','push','isProVersion','approved','.forecast.current.state','summary','PRIORIT√ÑT:\x20Energie\x20sparen.\x20Schalte\x20nur,\x20wenn\x20absolut\x20notwendig\x20(Dunkelheit).','LTM.rawEventLog','toLocaleTimeString','lastAlertState','normal','analysisHistory','.\x20EMERGENCY:\x20','debug','replace','Tag','currentSystemMode','LTM.driftAnalysis.lastCheck','message','LTM.driftAnalysis.baselineDrift','Unbekannt','.\x20EVENTS:\x20','analysis.health.geminiDay','\x0a\x20\x20\x20\x20ANTWORT-STIL:\x20Sachlich,\x20beruhigend,\x20pr√§zise.\x20Keine\x20Floskeln.\x0a\x20\x20\x20\x20','decision','detected','\x22\x20AN.\x0a\x20\x20\x20\x20STRATEGIE:\x20','2-digit','Skipped\x20(Traffic)','4723103mvPxsI','response','1TKOCQX','.forecast.current.temperature','getStateAsync','generic','stringify','automationProposal','ROLLE:\x20Data\x20Compression\x20Agent.\x20SPRACHE:\x20DE.\x20FORMAT:\x20JSON.\x20ANWEISUNG:\x20Fasse\x20Sensor-Events\x20zusammen.\x20SCHEMA:\x20{\x20\x22summary\x22:\x20\x22string\x22,\x20\x22activityLevel\x22:\x20\x22string\x22\x20}\x20\x0a\x0aEVENTS:\x0a','ü§ñ\x20Butler\x20Brain\x20Error:\x20','setStateAsync','targetId','\x0a\x20\x20\x20\x20ROLLE:\x20Medizinischer\x20Assistent\x20f√ºr\x20AAL\x20(Ambient\x20Assisted\x20Living).\x0a\x20\x20\x20\x20AUFGABE:\x20','Maximaler\x20Komfort,\x20Energie\x20ist\x20zweitrangig.','üåÖ\x20Starting\x20Morning\x20Briefing\x20sequence\x20(Traffic\x20Check\x20bypassed)...','\x20=\x20','¬∞C,\x20','analysis.automation.autoApply','unshift','üåÖ\x20Briefing\x20generated\x20(Length:\x20','Skipped\x20(No\x20AI\x20or\x20Data)','warn','getForeignStateAsync','getTime','activityLevel','trim','Briefing\x20Error:\x20','\x0a\x20\x20\x20\x20FRAGE:\x20Ist\x20es\x20dunkel\x20genug\x20f√ºr\x20Licht?\x0a\x20\x20\x20\x20FORMAT:\x20{\x20\x22approved\x22:\x20boolean,\x20\x22reason\x22:\x20\x22kurzer\x20Grund\x22\x20}\x0a\x20\x20\x20\x20','splice','analysis.automation.description','.Current.IsNight','alertReason','weatherInstance',').\x20Sending\x20notification...','Analysiere\x20diese\x20Events\x20des\x20TAGES\x20(08:00-Jetzt).\x20Aktivit√§t?\x20Mahlzeiten?\x20Haust√ºr?\x20Antwort\x20kurz\x20f√ºr\x20den\x20besorgten\x20Sohn\x20(max\x202\x20S√§tze).','üåÖ\x20Morning\x20Briefing:\x0a','LTM.dailyDigests','baselineDrift','Fokus\x20auf\x20Komfort\x20f√ºr\x20die\x20Familie.','analysis.automation.patternDetected','setForeignStateAsync','9960720UrxSia','info','val','now','analysis.automation.targetId','ROLLE:\x20KI-Hausverwalter.\x20PERSONA:\x20','3150XdpMlv','setHours','isEmergency','3052682OyGFwa','NIGHT','config','./setup','.Current.Temperature','rawEventLog',',\x20Wetter:\x20','ü§ñ\x20Butler\x20Cache\x20Hit:\x20','Started...','.Current.WeatherText','driftDetails','sendNotification','timestamp','getDate','876575BIZPIz','value','useWeather','analysis.automation.targetValue','ü§ñ\x20API\x20Cooldown.\x20Waiting\x202s...','ROLLE:\x20Data\x20Scientist.\x20ZIEL:\x20Drift\x20erkennen.\x20SCHEMA:\x20{\x20\x22baselineDrift\x22:\x20\x22none|slight|significant|critical\x22,\x20\x22driftDetails\x22:\x20\x22string\x22\x20}\x0a\x0aLTB:\x20','Analysiere\x20diese\x20Events\x20der\x20NACHT\x20(22:00-08:00).\x20War\x20der\x20Schlaf\x20ruhig?\x20Gab\x20es\x20Badg√§nge?\x20Antwort\x20kurz\x20f√ºr\x20den\x20besorgten\x20Sohn\x20(max\x202\x20S√§tze).','generateContent','24888825Xtrpeb','Digest','error','toISOString','dailyDigests','3872aGgjPX','targetValue','Bisher\x20keine\x20Aktivit√§t\x20seit\x2008:00\x20Uhr\x20verzeichnet.','aiPersona','ü§ñ\x20Traffic\x20Schutz:\x20Anfrage\x20f√ºr\x20','Keine\x20Daten\x20f√ºr\x20die\x20Nacht\x20aufgezeichnet\x20(Sensoren\x20ruhig).','constructor','ANALYZE_HEALTH','ü§ñ\x20Morning\x20Briefing\x20skipped:\x20No\x20Gemini\x20Model.','slice','üìÖ\x20Daily\x20Digest:\x0a','\x22.\x0a\x20\x20\x20\x20AKTION:\x20Schalte\x20\x22','.\x20AUFGABE:\x201.\x20Gesundheit?\x202.\x20Komfort?\x20FORMAT\x20(JSON):\x20{\x20\x22isAlert\x22:\x20boolean,\x20\x22alertReason\x22:\x20\x22string\x22,\x20\x22isEmergency\x22:\x20boolean,\x20\x22summary\x22:\x20\x22string\x22,\x20\x22automationProposal\x22:\x20{\x20\x22detected\x22:\x20boolean,\x20\x22description\x22:\x20\x22string\x22,\x20\x22targetId\x22:\x20\x22string\x22,\x20\x22targetValue\x22:\x20\x22any\x22\x20}\x20}','ltmLtbWindowDays','setDate','Wetterdaten\x20nicht\x20abrufbar','log','exports'];a0_0x88d4=function(){return _0x26bb6c;};return a0_0x88d4();}const a0_0x3dee17=(function(){let _0xdef949=!![];return function(_0x9f0a3e,_0x39cb04){const _0x9ff80b=_0xdef949?function(){if(_0x39cb04){const _0x270ed3=_0x39cb04['apply'](_0x9f0a3e,arguments);return _0x39cb04=null,_0x270ed3;}}:function(){};return _0xdef949=![],_0x9ff80b;};}()),a0_0x8258e2=a0_0x3dee17(this,function(){const _0x79fcd3=a0_0x35fa;return a0_0x8258e2[_0x79fcd3(0x16a)]()[_0x79fcd3(0x163)]('(((.+)+)+)+$')[_0x79fcd3(0x16a)]()[_0x79fcd3(0x147)](a0_0x8258e2)[_0x79fcd3(0x163)]('(((.+)+)+)+$');});a0_0x8258e2();'use strict';function a0_0x35fa(_0x2d78b6,_0x3e3d21){const _0x34c45e=a0_0x88d4();return a0_0x35fa=function(_0x8258e2,_0x3dee17){_0x8258e2=_0x8258e2-0x112;let _0x88d4da=_0x34c45e[_0x8258e2];return _0x88d4da;},a0_0x35fa(_0x2d78b6,_0x3e3d21);}const {GoogleGenerativeAI}=require(a0_0x38cfb8(0x16c)),setup=require(a0_0x38cfb8(0x129)),GEMINI_MODEL='models/gemini-flash-latest',LTM_DP_DAILY_DIGESTS=a0_0x38cfb8(0x118),LTM_DP_STATUS='LTM.processingStatus',LTM_DP_RAW_LOG=a0_0x38cfb8(0x174),LTM_MIN_EVENTS_FOR_COMPRESSION=0x5,MIN_API_GAP_MS=0x4e20;let lastGlobalApiCall=0x0;const decisionCache={},CACHE_TTL_MS=0xf*0x3c*0x3e8,PERSONA_MAPPING={'generic':a0_0x38cfb8(0x169),'senior_aal':a0_0x38cfb8(0x161),'family':a0_0x38cfb8(0x11a),'single_comfort':a0_0x38cfb8(0x197),'security':'Sicherheit\x20geht\x20vor.','energy_saver':a0_0x38cfb8(0x173)};function canCallApi(){const _0x32a6fd=a0_0x38cfb8,_0x46ce65=Date[_0x32a6fd(0x120)]();return _0x46ce65-lastGlobalApiCall>MIN_API_GAP_MS;}function updateApiTimestamp(){lastGlobalApiCall=Date['now']();}async function getWeatherContext(_0x1e13bd){const _0x422d4a=a0_0x38cfb8;if(!_0x1e13bd[_0x422d4a(0x128)][_0x422d4a(0x136)]||!_0x1e13bd[_0x422d4a(0x128)][_0x422d4a(0x114)])return _0x422d4a(0x15d);try{const _0x13f671=_0x1e13bd[_0x422d4a(0x128)]['weatherInstance'];let _0x4d20ff=await _0x1e13bd[_0x422d4a(0x1a0)](_0x13f671+_0x422d4a(0x12a));if(!_0x4d20ff)_0x4d20ff=await _0x1e13bd[_0x422d4a(0x1a0)](_0x13f671+_0x422d4a(0x18d));let _0x2d20e0=await _0x1e13bd['getForeignStateAsync'](_0x13f671+_0x422d4a(0x12f));if(!_0x2d20e0)_0x2d20e0=await _0x1e13bd[_0x422d4a(0x1a0)](_0x13f671+_0x422d4a(0x171));let _0x21fee4='Unbekannt';const _0x21dd86=await _0x1e13bd[_0x422d4a(0x1a0)](_0x13f671+_0x422d4a(0x112));if(_0x21dd86)_0x21fee4=_0x21dd86[_0x422d4a(0x11f)]?'Nacht':_0x422d4a(0x17c);if(_0x4d20ff&&_0x2d20e0)return _0x4d20ff[_0x422d4a(0x11f)]+_0x422d4a(0x19a)+_0x2d20e0[_0x422d4a(0x11f)]+_0x422d4a(0x16d)+_0x21fee4;}catch(_0x4cf0f1){}return _0x422d4a(0x150);}async function consultButler(_0x33989d,_0x1f93d4,_0x2866f3,_0x25eb64){const _0x207c51=a0_0x38cfb8;if(!_0x33989d[_0x207c51(0x155)])return{'approved':!![],'reason':_0x207c51(0x15a)};const _0x9090c4=Date[_0x207c51(0x120)]();if(decisionCache[_0x1f93d4]&&_0x9090c4-decisionCache[_0x1f93d4][_0x207c51(0x132)]<CACHE_TTL_MS){const _0x51133e=decisionCache[_0x1f93d4][_0x207c51(0x185)];return _0x33989d['log'][_0x207c51(0x17a)](_0x207c51(0x12d)+_0x1f93d4+'\x20->\x20'+(_0x51133e[_0x207c51(0x170)]?'OK':'NO')+'\x20('+_0x51133e[_0x207c51(0x160)]+')'),_0x51133e;}if(!canCallApi())return _0x33989d[_0x207c51(0x151)]['debug'](_0x207c51(0x145)+_0x1f93d4+'\x20√ºbersprungen\x20(Auto-Approved).'),{'approved':!![],'reason':'Traffic-Schutz\x20(Auto-Approved)'};const _0x2b3cd2=new Date()[_0x207c51(0x175)](),_0x2f5a17=await getWeatherContext(_0x33989d),_0x4d4e78=PERSONA_MAPPING[_0x33989d['config'][_0x207c51(0x144)]||_0x207c51(0x18f)],_0x23ffc1='\x0a\x20\x20\x20\x20ROLLE:\x20Haus-Butler.\x0a\x20\x20\x20\x20SITUATION:\x20'+_0x2b3cd2+_0x207c51(0x12c)+_0x2f5a17+_0x207c51(0x15c)+(_0x25eb64*0x64)['toFixed'](0x0)+'%)\x20nach\x20\x22'+_0x1f93d4+_0x207c51(0x14c)+_0x2866f3+_0x207c51(0x187)+_0x4d4e78+_0x207c51(0x1a5);try{updateApiTimestamp();const _0x4d4e03=await _0x33989d[_0x207c51(0x155)]['generateContent'](_0x23ffc1),_0x1024f6=_0x4d4e03['response']['text']()[_0x207c51(0x17b)](/```json|```/g,'')['trim'](),_0x3adbe9=JSON[_0x207c51(0x166)](_0x1024f6);return decisionCache[_0x1f93d4]={'decision':_0x3adbe9,'timestamp':_0x9090c4},_0x3adbe9;}catch(_0x57a1e8){return _0x33989d[_0x207c51(0x151)]['warn'](_0x207c51(0x193)+_0x57a1e8[_0x207c51(0x17f)]),decisionCache[_0x1f93d4]={'decision':{'approved':!![],'reason':'KI-Fehler\x20(Fallback)'},'timestamp':_0x9090c4-(CACHE_TTL_MS-0xea60)},{'approved':!![],'reason':_0x207c51(0x164)};}}async function runGeminiAnalysis(_0x5a6182,_0x2d1916=''){const _0x557bb9=a0_0x38cfb8;if(!_0x5a6182[_0x557bb9(0x155)])return;if(!canCallApi()){_0x5a6182[_0x557bb9(0x151)][_0x557bb9(0x17a)]('ü§ñ\x20Autopilot\x20skipped\x20(Traffic\x20Protection\x20active).');return;}if(_0x5a6182[_0x557bb9(0x168)][_0x557bb9(0x15f)]===0x0)return;const _0x3bb021=_0x5a6182[_0x557bb9(0x168)][_0x557bb9(0x14a)](0x0,0xf),_0xe90f27=_0x5a6182[_0x557bb9(0x17d)],_0x2ced67=PERSONA_MAPPING[_0x5a6182[_0x557bb9(0x128)][_0x557bb9(0x144)]||'generic'],_0x489373=_0x5a6182[_0x557bb9(0x128)]['livingContext']||_0x557bb9(0x158);let _0x395b92=_0x557bb9(0x181);try{const _0x3a72ce=await _0x5a6182[_0x557bb9(0x18e)]('system.presenceWho');if(_0x3a72ce&&_0x3a72ce[_0x557bb9(0x11f)])_0x395b92=_0x3a72ce[_0x557bb9(0x11f)];}catch(_0x136b2e){}let _0x296162=![];try{const _0xac2e87=await _0x5a6182['getStateAsync'](_0x557bb9(0x19b));if(_0xac2e87&&_0xac2e87['val'])_0x296162=!![];}catch(_0x1023ba){}const _0x1c749c=_0x557bb9(0x122)+_0x2ced67+'.\x20KONTEXT:\x20'+_0x489373+'.\x20SYSTEM_MODE:\x20'+_0xe90f27+_0x557bb9(0x157)+_0x395b92+_0x557bb9(0x182)+JSON['stringify'](_0x3bb021)+_0x557bb9(0x179)+_0x2d1916+_0x557bb9(0x14d);try{updateApiTimestamp();const _0x388025=await _0x5a6182[_0x557bb9(0x155)][_0x557bb9(0x13b)](_0x1c749c),_0x48ec14=JSON[_0x557bb9(0x166)](_0x388025['response']['text']()['replace'](/```json|```/g,'')['trim']());await _0x5a6182[_0x557bb9(0x194)]('analysis.lastResult',{'val':JSON[_0x557bb9(0x190)](_0x48ec14),'ack':!![]});if(_0x48ec14[_0x557bb9(0x172)])await _0x5a6182[_0x557bb9(0x194)]('analysis.activitySummary',{'val':_0x48ec14['summary'],'ack':!![]});const _0x10527={'timestamp':Date[_0x557bb9(0x120)](),'id':Date[_0x557bb9(0x120)]()['toString'](),'analysis':{'activity':{'summary':_0x48ec14[_0x557bb9(0x172)],'isAlert':_0x48ec14[_0x557bb9(0x156)],'alertReason':_0x48ec14[_0x557bb9(0x113)]},'comfort':{'automationProposal':_0x48ec14[_0x557bb9(0x191)]}}};_0x5a6182[_0x557bb9(0x178)][_0x557bb9(0x19c)](_0x10527);if(_0x5a6182['analysisHistory']['length']>0x32)_0x5a6182[_0x557bb9(0x178)]['pop']();await _0x5a6182[_0x557bb9(0x194)](_0x557bb9(0x165),{'val':JSON['stringify'](_0x5a6182[_0x557bb9(0x178)]),'ack':!![]});const _0x7b1630=_0x48ec14[_0x557bb9(0x156)]||![];_0x7b1630!==_0x5a6182[_0x557bb9(0x176)]&&(await _0x5a6182['setStateAsync']('analysis.isAlert',{'val':_0x7b1630,'ack':!![]}),_0x5a6182[_0x557bb9(0x176)]=_0x7b1630,_0x7b1630&&(await _0x5a6182[_0x557bb9(0x194)]('analysis.alertReason',{'val':_0x48ec14[_0x557bb9(0x113)],'ack':!![]}),setup[_0x557bb9(0x131)](_0x5a6182,'‚ö†Ô∏è\x20ALARM:\x20'+_0x48ec14[_0x557bb9(0x113)],![],_0x48ec14[_0x557bb9(0x125)])));if(_0x48ec14[_0x557bb9(0x191)]&&_0x48ec14[_0x557bb9(0x191)][_0x557bb9(0x186)]){await _0x5a6182[_0x557bb9(0x194)](_0x557bb9(0x11b),{'val':!![],'ack':!![]}),await _0x5a6182[_0x557bb9(0x194)](_0x557bb9(0x1a7),{'val':_0x48ec14['automationProposal']['description'],'ack':!![]}),await _0x5a6182['setStateAsync'](_0x557bb9(0x121),{'val':_0x48ec14[_0x557bb9(0x191)][_0x557bb9(0x195)],'ack':!![]}),await _0x5a6182[_0x557bb9(0x194)](_0x557bb9(0x137),{'val':JSON[_0x557bb9(0x190)](_0x48ec14['automationProposal'][_0x557bb9(0x142)]),'ack':!![]});if(_0x296162)executeAutomationAction(_0x5a6182);}}catch(_0x136c16){_0x5a6182['log']['error']('Gemini\x20Error:\x20'+_0x136c16[_0x557bb9(0x17f)]);}}async function createDailyDigest(_0x3f6bfa,_0x2b7593){const _0x24cc5a=a0_0x38cfb8;if(!_0x3f6bfa['isProVersion'])return;if(!canCallApi()){await _0x3f6bfa[_0x24cc5a(0x194)](LTM_DP_STATUS,{'val':_0x24cc5a(0x189),'ack':!![]});return;}await _0x3f6bfa[_0x24cc5a(0x194)](LTM_DP_STATUS,{'val':_0x24cc5a(0x12e),'ack':!![]});if(!_0x3f6bfa[_0x24cc5a(0x155)]||_0x3f6bfa[_0x24cc5a(0x12b)][_0x24cc5a(0x15f)]<LTM_MIN_EVENTS_FOR_COMPRESSION){await _0x3f6bfa['setStateAsync'](LTM_DP_STATUS,{'val':_0x24cc5a(0x19e),'ack':!![]});return;}const _0x209d79=JSON[_0x24cc5a(0x166)](JSON[_0x24cc5a(0x190)](_0x3f6bfa['rawEventLog'])),_0x2940b3=_0x209d79[_0x24cc5a(0x15f)],_0x3e30ac=_0x24cc5a(0x192)+JSON['stringify'](_0x209d79);try{updateApiTimestamp();const _0x4923b0=await _0x3f6bfa[_0x24cc5a(0x155)][_0x24cc5a(0x13b)](_0x3e30ac),_0x39de9e=JSON[_0x24cc5a(0x166)](_0x4923b0[_0x24cc5a(0x18b)][_0x24cc5a(0x153)]()[_0x24cc5a(0x17b)](/```json|```/g,'')[_0x24cc5a(0x1a3)]()),_0x5e8383={'timestamp':new Date()[_0x24cc5a(0x13f)](),'eventCount':_0x2940b3,'summary':_0x39de9e[_0x24cc5a(0x172)]||_0x24cc5a(0x13d),'activityLevel':_0x39de9e['activityLevel']||_0x24cc5a(0x177),'systemMode':_0x3f6bfa[_0x24cc5a(0x17d)]};_0x3f6bfa[_0x24cc5a(0x140)][_0x24cc5a(0x16e)](_0x5e8383);const _0x8adbce=_0x3f6bfa[_0x24cc5a(0x128)][_0x24cc5a(0x14e)]||0x3c;_0x3f6bfa['dailyDigests'][_0x24cc5a(0x15f)]>_0x8adbce&&_0x3f6bfa['dailyDigests'][_0x24cc5a(0x1a6)](0x0,_0x3f6bfa['dailyDigests'][_0x24cc5a(0x15f)]-_0x8adbce);await _0x3f6bfa[_0x24cc5a(0x194)](LTM_DP_DAILY_DIGESTS,{'val':JSON[_0x24cc5a(0x190)](_0x3f6bfa[_0x24cc5a(0x140)]),'ack':!![]}),_0x3f6bfa[_0x24cc5a(0x12b)]=[],await _0x3f6bfa[_0x24cc5a(0x194)](LTM_DP_RAW_LOG,{'val':JSON[_0x24cc5a(0x190)](_0x3f6bfa[_0x24cc5a(0x12b)]),'ack':!![]}),await _0x3f6bfa['setStateAsync'](LTM_DP_STATUS,{'val':'Success','ack':!![]});const _0x42b9ac=_0x24cc5a(0x14b)+_0x39de9e[_0x24cc5a(0x172)]+'\x0aAktivit√§t:\x20'+_0x39de9e[_0x24cc5a(0x1a2)];setup[_0x24cc5a(0x131)](_0x3f6bfa,_0x42b9ac,![],![]);if(_0x3f6bfa['isProVersion']&&_0x2b7593)_0x2b7593['send'](_0x3f6bfa,_0x24cc5a(0x148),{'digest':_0x5e8383});}catch(_0x3f95d5){_0x3f6bfa[_0x24cc5a(0x151)]['error'](_0x3f95d5[_0x24cc5a(0x17f)]);}}async function runBaselineDriftAnalysis(_0x30c59c){const _0x5b16d9=a0_0x38cfb8;if(!_0x30c59c[_0x5b16d9(0x16f)]||!_0x30c59c['geminiModel'])return;if(!canCallApi())return;const _0x51da20=_0x30c59c[_0x5b16d9(0x128)][_0x5b16d9(0x162)]||0xe;if(_0x30c59c[_0x5b16d9(0x140)][_0x5b16d9(0x15f)]<_0x51da20+0x7){await _0x30c59c[_0x5b16d9(0x194)](_0x5b16d9(0x180),{'val':'N/A\x20(Learning)','ack':!![]});return;}const _0x1f1b7c=_0x30c59c[_0x5b16d9(0x140)][_0x5b16d9(0x14a)](-_0x51da20),_0x5cd0ab=_0x30c59c[_0x5b16d9(0x140)]['slice'](0x0,_0x30c59c[_0x5b16d9(0x140)]['length']-_0x51da20),_0x1244ab=_0x5b16d9(0x139)+JSON[_0x5b16d9(0x190)](_0x5cd0ab)+'\x0aSTB:\x20'+JSON[_0x5b16d9(0x190)](_0x1f1b7c);try{updateApiTimestamp();const _0x21a42d=await _0x30c59c[_0x5b16d9(0x155)][_0x5b16d9(0x13b)](_0x1244ab),_0x399fec=JSON[_0x5b16d9(0x166)](_0x21a42d['response'][_0x5b16d9(0x153)]()[_0x5b16d9(0x17b)](/```json|```/g,'')['trim']());_0x399fec[_0x5b16d9(0x119)]&&(await _0x30c59c[_0x5b16d9(0x194)](_0x5b16d9(0x180),{'val':_0x399fec[_0x5b16d9(0x119)],'ack':!![]}),await _0x30c59c[_0x5b16d9(0x194)](_0x5b16d9(0x159),{'val':_0x399fec[_0x5b16d9(0x130)],'ack':!![]}),await _0x30c59c[_0x5b16d9(0x194)](_0x5b16d9(0x17e),{'val':Date[_0x5b16d9(0x120)](),'ack':!![]}));}catch(_0x2824ab){}}async function executeAutomationAction(_0x2857e4){const _0x560bc3=a0_0x38cfb8;try{const _0x255d52=await _0x2857e4[_0x560bc3(0x18e)](_0x560bc3(0x121)),_0x9c487a=await _0x2857e4[_0x560bc3(0x18e)]('analysis.automation.targetValue');if(_0x255d52&&_0x255d52['val']&&_0x9c487a){const _0x39ba2b=_0x255d52[_0x560bc3(0x11f)];let _0x2551ab=_0x9c487a[_0x560bc3(0x11f)];try{_0x2551ab=JSON[_0x560bc3(0x166)](_0x2551ab);}catch(_0x33b805){}_0x2857e4[_0x560bc3(0x151)]['info']('ü§ñ\x20BUTLER:\x20Executing\x20Action\x20->\x20'+_0x39ba2b+_0x560bc3(0x199)+_0x2551ab),await _0x2857e4[_0x560bc3(0x11c)](_0x39ba2b,_0x2551ab);}else _0x2857e4[_0x560bc3(0x151)][_0x560bc3(0x19f)](_0x560bc3(0x15e));}catch(_0x485060){_0x2857e4[_0x560bc3(0x151)]['error']('BUTLER\x20Execution\x20Error:\x20'+_0x485060[_0x560bc3(0x17f)]);}}async function sendMorningBriefing(_0x1e60af){const _0x427336=a0_0x38cfb8;if(!_0x1e60af[_0x427336(0x155)]){_0x1e60af[_0x427336(0x151)]['warn'](_0x427336(0x149));return;}_0x1e60af[_0x427336(0x151)][_0x427336(0x11e)](_0x427336(0x198));try{updateApiTimestamp();const _0xdbb46a=_0x427336(0x154),_0x51aba1=await _0x1e60af[_0x427336(0x155)][_0x427336(0x13b)](_0xdbb46a),_0x11fbd8=_0x51aba1['response'][_0x427336(0x153)]();_0x1e60af[_0x427336(0x151)][_0x427336(0x11e)](_0x427336(0x19d)+_0x11fbd8[_0x427336(0x15f)]+_0x427336(0x115)),setup[_0x427336(0x131)](_0x1e60af,_0x427336(0x117)+_0x11fbd8);}catch(_0x468c41){_0x1e60af[_0x427336(0x151)][_0x427336(0x13e)](_0x427336(0x1a4)+_0x468c41[_0x427336(0x17f)]);}}async function generateHealthReport(_0x11b222,_0x289008){const _0x18b4e9=a0_0x38cfb8;if(!_0x11b222[_0x18b4e9(0x155)])return;const _0x8496d7=Date[_0x18b4e9(0x120)]();_0x8496d7-lastGlobalApiCall<0xbb8&&(_0x11b222[_0x18b4e9(0x151)][_0x18b4e9(0x17a)](_0x18b4e9(0x138)),await new Promise(_0x17b653=>setTimeout(_0x17b653,0x7d0)));const _0x232c6a=new Date();let _0x4607c8=0x0,_0xed65fc=_0x232c6a['getTime'](),_0x49a0c5='';if(_0x289008===_0x18b4e9(0x127)){const _0x3fd35f=new Date(_0x232c6a);_0x3fd35f[_0x18b4e9(0x14f)](_0x3fd35f[_0x18b4e9(0x133)]()-0x1),_0x3fd35f[_0x18b4e9(0x124)](0x16,0x0,0x0,0x0),_0x4607c8=_0x3fd35f[_0x18b4e9(0x1a1)]();const _0x5eef3d=new Date(_0x232c6a);_0x5eef3d['setHours'](0x8,0x0,0x0,0x0),_0xed65fc=_0x5eef3d[_0x18b4e9(0x1a1)](),_0x49a0c5=_0x18b4e9(0x13a);}else{const _0x4b18cc=new Date(_0x232c6a);_0x4b18cc[_0x18b4e9(0x124)](0x8,0x0,0x0,0x0),_0x4607c8=_0x4b18cc[_0x18b4e9(0x1a1)](),_0x49a0c5=_0x18b4e9(0x116);}const _0xc6cad0=_0x11b222[_0x18b4e9(0x168)][_0x18b4e9(0x15b)](_0x9414c1=>_0x9414c1[_0x18b4e9(0x132)]>=_0x4607c8&&_0x9414c1['timestamp']<=_0xed65fc);if(_0xc6cad0[_0x18b4e9(0x15f)]===0x0){const _0x53fa31=_0x289008===_0x18b4e9(0x127)?_0x18b4e9(0x146):_0x18b4e9(0x143),_0x1f0d4f=_0x289008===_0x18b4e9(0x127)?'analysis.health.geminiNight':'analysis.health.geminiDay';await _0x11b222['setStateAsync'](_0x1f0d4f,{'val':_0x53fa31,'ack':!![]});return;}const _0x4088bc=_0xc6cad0['map'](_0x5706bc=>new Date(_0x5706bc['timestamp'])['toLocaleTimeString']([],{'hour':'2-digit','minute':_0x18b4e9(0x188)})+'\x20'+_0x5706bc['name']+'\x20('+_0x5706bc[_0x18b4e9(0x135)]+')')['join']('\x0a'),_0x299877=_0x18b4e9(0x196)+_0x49a0c5+'\x0a\x20\x20\x20\x20EVENTS:\x0a'+_0x4088bc+_0x18b4e9(0x184);try{updateApiTimestamp();const _0x1c31b2=await _0x11b222['geminiModel'][_0x18b4e9(0x13b)](_0x299877),_0x3c9bd8=_0x1c31b2[_0x18b4e9(0x18b)][_0x18b4e9(0x153)](),_0xa3d332=_0x289008===_0x18b4e9(0x127)?'analysis.health.geminiNight':_0x18b4e9(0x183);await _0x11b222[_0x18b4e9(0x194)](_0xa3d332,{'val':_0x3c9bd8,'ack':!![]}),_0x11b222[_0x18b4e9(0x151)][_0x18b4e9(0x11e)]('ü§ñ\x20Health\x20Report\x20('+_0x289008+_0x18b4e9(0x167));}catch(_0x1c47f5){_0x11b222['log'][_0x18b4e9(0x13e)]('Health\x20Report\x20Error:\x20'+_0x1c47f5['message']);}}module[a0_0x38cfb8(0x152)]={'executeAutomationAction':executeAutomationAction,'createDailyDigest':createDailyDigest,'runBaselineDriftAnalysis':runBaselineDriftAnalysis,'sendMorningBriefing':sendMorningBriefing,'runGeminiAnalysis':runGeminiAnalysis,'consultButler':consultButler,'generateHealthReport':generateHealthReport};