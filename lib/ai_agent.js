const a0_0x32188a=a0_0x2c0f;(function(_0x264a54,_0x446773){const _0x35aad6=a0_0x2c0f,_0x528f15=_0x264a54();while(!![]){try{const _0x1f1e1c=-parseInt(_0x35aad6(0x141))/0x1*(-parseInt(_0x35aad6(0x11b))/0x2)+-parseInt(_0x35aad6(0x16f))/0x3+-parseInt(_0x35aad6(0x122))/0x4+-parseInt(_0x35aad6(0x128))/0x5+-parseInt(_0x35aad6(0x18c))/0x6+-parseInt(_0x35aad6(0x197))/0x7*(-parseInt(_0x35aad6(0x1a1))/0x8)+parseInt(_0x35aad6(0x195))/0x9;if(_0x1f1e1c===_0x446773)break;else _0x528f15['push'](_0x528f15['shift']());}catch(_0x3b9fbc){_0x528f15['push'](_0x528f15['shift']());}}}(a0_0x47dc,0x3ec01));const a0_0xace76c=(function(){let _0x462f15=!![];return function(_0x756a2b,_0x5deca0){const _0xb27ec5=_0x462f15?function(){const _0x2d72bd=a0_0x2c0f;if(_0x5deca0){const _0x146b3a=_0x5deca0[_0x2d72bd(0x185)](_0x756a2b,arguments);return _0x5deca0=null,_0x146b3a;}}:function(){};return _0x462f15=![],_0xb27ec5;};}()),a0_0x22acc7=a0_0xace76c(this,function(){const _0x5c2a35=a0_0x2c0f;return a0_0x22acc7[_0x5c2a35(0x15c)]()['search'](_0x5c2a35(0x15d))[_0x5c2a35(0x15c)]()[_0x5c2a35(0x152)](a0_0x22acc7)['search']('(((.+)+)+)+$');});a0_0x22acc7();'use strict';const {GoogleGenerativeAI}=require(a0_0x32188a(0x181)),setup=require(a0_0x32188a(0x189)),GEMINI_MODEL=a0_0x32188a(0x17e),LTM_DP_DAILY_DIGESTS=a0_0x32188a(0x192),LTM_DP_STATUS=a0_0x32188a(0x1a9),LTM_DP_RAW_LOG=a0_0x32188a(0x124),LTM_MIN_EVENTS_FOR_COMPRESSION=0x5,MIN_API_GAP_MS=0x4e20;let lastGlobalApiCall=0x0;const decisionCache={},CACHE_TTL_MS=0xf*0x3c*0x3e8,PERSONA_MAPPING={'generic':a0_0x32188a(0x11a),'senior_aal':'PRIORITÃ„T:\x20Sicherheit\x20und\x20Licht.\x20Schalte\x20lieber\x20einmal\x20zu\x20viel\x20als\x20zu\x20wenig.','family':a0_0x32188a(0x11d),'single_comfort':a0_0x32188a(0x139),'security':'Sicherheit\x20geht\x20vor.','energy_saver':a0_0x32188a(0x18b)};function canCallApi(){const _0x3868eb=a0_0x32188a,_0x12bd04=Date[_0x3868eb(0x19a)]();return _0x12bd04-lastGlobalApiCall>MIN_API_GAP_MS;}function updateApiTimestamp(){const _0xa8db3=a0_0x32188a;lastGlobalApiCall=Date[_0xa8db3(0x19a)]();}function a0_0x2c0f(_0x4e84ea,_0x512e85){const _0x28100a=a0_0x47dc();return a0_0x2c0f=function(_0x22acc7,_0xace76c){_0x22acc7=_0x22acc7-0x117;let _0x47dc2a=_0x28100a[_0x22acc7];return _0x47dc2a;},a0_0x2c0f(_0x4e84ea,_0x512e85);}async function getWeatherContext(_0x8b96ea){const _0xae1791=a0_0x32188a;if(!_0x8b96ea[_0xae1791(0x15a)][_0xae1791(0x180)]||!_0x8b96ea[_0xae1791(0x15a)][_0xae1791(0x137)])return _0xae1791(0x117);try{const _0x38296b=_0x8b96ea['config'][_0xae1791(0x137)];let _0x495493=await _0x8b96ea[_0xae1791(0x164)](_0x38296b+'.Current.Temperature');if(!_0x495493)_0x495493=await _0x8b96ea['getForeignStateAsync'](_0x38296b+_0xae1791(0x127));let _0x184f2b=await _0x8b96ea[_0xae1791(0x164)](_0x38296b+'.Current.WeatherText');if(!_0x184f2b)_0x184f2b=await _0x8b96ea[_0xae1791(0x164)](_0x38296b+_0xae1791(0x121));let _0x419a00='Unbekannt';const _0x525c39=await _0x8b96ea['getForeignStateAsync'](_0x38296b+_0xae1791(0x1a0));if(_0x525c39)_0x419a00=_0x525c39[_0xae1791(0x157)]?_0xae1791(0x194):'Tag';if(_0x495493&&_0x184f2b)return _0x495493['val']+_0xae1791(0x199)+_0x184f2b[_0xae1791(0x157)]+_0xae1791(0x11c)+_0x419a00;}catch(_0x11ae00){}return _0xae1791(0x12b);}async function consultButler(_0x317392,_0x5702e7,_0x166a0e,_0x14fcb5){const _0x1b2c98=a0_0x32188a;if(!_0x317392[_0x1b2c98(0x17a)])return{'approved':!![],'reason':_0x1b2c98(0x148)};const _0x14edf6=Date['now']();if(decisionCache[_0x5702e7]&&_0x14edf6-decisionCache[_0x5702e7][_0x1b2c98(0x146)]<CACHE_TTL_MS){const _0x4c337f=decisionCache[_0x5702e7]['decision'];return _0x317392['log'][_0x1b2c98(0x132)](_0x1b2c98(0x17d)+_0x5702e7+'\x20->\x20'+(_0x4c337f[_0x1b2c98(0x1aa)]?'OK':'NO')+'\x20('+_0x4c337f['reason']+')'),_0x4c337f;}if(!canCallApi())return _0x317392[_0x1b2c98(0x155)][_0x1b2c98(0x132)](_0x1b2c98(0x11f)+_0x5702e7+_0x1b2c98(0x170)),{'approved':!![],'reason':_0x1b2c98(0x13d)};const _0x549cd8=new Date()[_0x1b2c98(0x158)](),_0x157d33=await getWeatherContext(_0x317392),_0x31c5bc=PERSONA_MAPPING[_0x317392['config'][_0x1b2c98(0x1ae)]||'generic'],_0x54d5e8='\x0a\x20\x20\x20\x20ROLLE:\x20Haus-Butler.\x0a\x20\x20\x20\x20SITUATION:\x20'+_0x549cd8+_0x1b2c98(0x162)+_0x157d33+_0x1b2c98(0x1ac)+(_0x14fcb5*0x64)[_0x1b2c98(0x119)](0x0)+'%)\x20nach\x20\x22'+_0x5702e7+_0x1b2c98(0x1ad)+_0x166a0e+_0x1b2c98(0x147)+_0x31c5bc+_0x1b2c98(0x12f);try{updateApiTimestamp();const _0x21764a=await _0x317392[_0x1b2c98(0x17a)][_0x1b2c98(0x18e)](_0x54d5e8),_0x17555a=_0x21764a[_0x1b2c98(0x1b1)][_0x1b2c98(0x178)]()[_0x1b2c98(0x17f)](/```json|```/g,'')[_0x1b2c98(0x169)](),_0x9986b5=JSON[_0x1b2c98(0x159)](_0x17555a);return decisionCache[_0x5702e7]={'decision':_0x9986b5,'timestamp':_0x14edf6},_0x9986b5;}catch(_0x4c3fe6){return _0x317392[_0x1b2c98(0x155)][_0x1b2c98(0x1ab)](_0x1b2c98(0x11e)+_0x4c3fe6[_0x1b2c98(0x138)]),decisionCache[_0x5702e7]={'decision':{'approved':!![],'reason':'KI-Fehler\x20(Fallback)'},'timestamp':_0x14edf6-(CACHE_TTL_MS-0xea60)},{'approved':!![],'reason':_0x1b2c98(0x1b0)};}}async function runGeminiAnalysis(_0x4ff8e7,_0x2efe66=''){const _0x543dde=a0_0x32188a;if(!_0x4ff8e7[_0x543dde(0x17a)])return;if(!canCallApi()){_0x4ff8e7['log'][_0x543dde(0x132)](_0x543dde(0x16c));return;}if(_0x4ff8e7[_0x543dde(0x13a)][_0x543dde(0x19b)]===0x0)return;const _0x164a60=_0x4ff8e7['eventHistory'][_0x543dde(0x13b)](0x0,0xf),_0x1d7140=_0x4ff8e7[_0x543dde(0x151)],_0x100286=PERSONA_MAPPING[_0x4ff8e7[_0x543dde(0x15a)][_0x543dde(0x1ae)]||_0x543dde(0x1a5)],_0x38e81f=_0x4ff8e7[_0x543dde(0x15a)][_0x543dde(0x1a8)]||_0x543dde(0x173);let _0x5de507=_0x543dde(0x176);try{const _0x190b6a=await _0x4ff8e7['getStateAsync'](_0x543dde(0x193));if(_0x190b6a&&_0x190b6a[_0x543dde(0x157)])_0x5de507=_0x190b6a[_0x543dde(0x157)];}catch(_0x43ec26){}let _0x1c82dd=![];try{const _0x340dcf=await _0x4ff8e7['getStateAsync']('analysis.automation.autoApply');if(_0x340dcf&&_0x340dcf[_0x543dde(0x157)])_0x1c82dd=!![];}catch(_0x2cbc53){}const _0x22fb34=_0x543dde(0x156)+_0x100286+_0x543dde(0x135)+_0x38e81f+_0x543dde(0x15e)+_0x1d7140+_0x543dde(0x1a7)+_0x5de507+_0x543dde(0x19e)+JSON['stringify'](_0x164a60)+_0x543dde(0x12d)+_0x2efe66+'.\x20AUFGABE:\x201.\x20Gesundheit?\x202.\x20Komfort?\x20FORMAT\x20(JSON):\x20{\x20\x22isAlert\x22:\x20boolean,\x20\x22alertReason\x22:\x20\x22string\x22,\x20\x22isEmergency\x22:\x20boolean,\x20\x22summary\x22:\x20\x22string\x22,\x20\x22automationProposal\x22:\x20{\x20\x22detected\x22:\x20boolean,\x20\x22description\x22:\x20\x22string\x22,\x20\x22targetId\x22:\x20\x22string\x22,\x20\x22targetValue\x22:\x20\x22any\x22\x20}\x20}';try{updateApiTimestamp();const _0x268591=await _0x4ff8e7['geminiModel'][_0x543dde(0x18e)](_0x22fb34),_0x5b46e1=JSON[_0x543dde(0x159)](_0x268591[_0x543dde(0x1b1)]['text']()['replace'](/```json|```/g,'')[_0x543dde(0x169)]());await _0x4ff8e7['setStateAsync']('analysis.lastResult',{'val':JSON['stringify'](_0x5b46e1),'ack':!![]});if(_0x5b46e1['summary'])await _0x4ff8e7['setStateAsync'](_0x543dde(0x16b),{'val':_0x5b46e1['summary'],'ack':!![]});const _0x1cbf3c={'timestamp':Date['now'](),'id':Date[_0x543dde(0x19a)]()[_0x543dde(0x15c)](),'analysis':{'activity':{'summary':_0x5b46e1[_0x543dde(0x1a4)],'isAlert':_0x5b46e1['isAlert'],'alertReason':_0x5b46e1[_0x543dde(0x120)]},'comfort':{'automationProposal':_0x5b46e1[_0x543dde(0x154)]}}};_0x4ff8e7[_0x543dde(0x134)][_0x543dde(0x153)](_0x1cbf3c);if(_0x4ff8e7[_0x543dde(0x134)][_0x543dde(0x19b)]>0x32)_0x4ff8e7[_0x543dde(0x134)][_0x543dde(0x1a3)]();await _0x4ff8e7['setStateAsync'](_0x543dde(0x19d),{'val':JSON[_0x543dde(0x187)](_0x4ff8e7[_0x543dde(0x134)]),'ack':!![]});const _0x4510bc=_0x5b46e1['isAlert']||![];_0x4510bc!==_0x4ff8e7[_0x543dde(0x175)]&&(await _0x4ff8e7[_0x543dde(0x168)](_0x543dde(0x13e),{'val':_0x4510bc,'ack':!![]}),_0x4ff8e7[_0x543dde(0x175)]=_0x4510bc,_0x4510bc&&(await _0x4ff8e7[_0x543dde(0x168)]('analysis.alertReason',{'val':_0x5b46e1[_0x543dde(0x120)],'ack':!![]}),setup[_0x543dde(0x186)](_0x4ff8e7,_0x543dde(0x140)+_0x5b46e1['alertReason'],![],_0x5b46e1[_0x543dde(0x190)])));if(_0x5b46e1[_0x543dde(0x154)]&&_0x5b46e1[_0x543dde(0x154)][_0x543dde(0x14c)]){await _0x4ff8e7[_0x543dde(0x168)](_0x543dde(0x15f),{'val':!![],'ack':!![]}),await _0x4ff8e7[_0x543dde(0x168)](_0x543dde(0x1a2),{'val':_0x5b46e1[_0x543dde(0x154)]['description'],'ack':!![]}),await _0x4ff8e7['setStateAsync']('analysis.automation.targetId',{'val':_0x5b46e1[_0x543dde(0x154)][_0x543dde(0x166)],'ack':!![]}),await _0x4ff8e7[_0x543dde(0x168)](_0x543dde(0x161),{'val':JSON[_0x543dde(0x187)](_0x5b46e1['automationProposal'][_0x543dde(0x16e)]),'ack':!![]});if(_0x1c82dd)executeAutomationAction(_0x4ff8e7);}}catch(_0x12454e){_0x4ff8e7[_0x543dde(0x155)][_0x543dde(0x18a)](_0x543dde(0x15b)+_0x12454e[_0x543dde(0x138)]);}}async function createDailyDigest(_0x3fabc9,_0x4e8402){const _0x5d3621=a0_0x32188a;if(!_0x3fabc9[_0x5d3621(0x125)])return;if(!canCallApi()){await _0x3fabc9[_0x5d3621(0x168)](LTM_DP_STATUS,{'val':_0x5d3621(0x171),'ack':!![]});return;}await _0x3fabc9[_0x5d3621(0x168)](LTM_DP_STATUS,{'val':_0x5d3621(0x17b),'ack':!![]});if(!_0x3fabc9[_0x5d3621(0x17a)]||_0x3fabc9['rawEventLog']['length']<LTM_MIN_EVENTS_FOR_COMPRESSION){await _0x3fabc9['setStateAsync'](LTM_DP_STATUS,{'val':_0x5d3621(0x19f),'ack':!![]});return;}const _0x42a1da=JSON[_0x5d3621(0x159)](JSON[_0x5d3621(0x187)](_0x3fabc9['rawEventLog'])),_0x4742ef=_0x42a1da[_0x5d3621(0x19b)],_0x5f4fde=_0x5d3621(0x179)+JSON[_0x5d3621(0x187)](_0x42a1da);try{updateApiTimestamp();const _0x256b13=await _0x3fabc9[_0x5d3621(0x17a)]['generateContent'](_0x5f4fde),_0x40540d=JSON[_0x5d3621(0x159)](_0x256b13[_0x5d3621(0x1b1)][_0x5d3621(0x178)]()['replace'](/```json|```/g,'')[_0x5d3621(0x169)]()),_0x1698eb={'timestamp':new Date()[_0x5d3621(0x130)](),'eventCount':_0x4742ef,'summary':_0x40540d[_0x5d3621(0x1a4)]||_0x5d3621(0x188),'activityLevel':_0x40540d[_0x5d3621(0x14a)]||_0x5d3621(0x14f),'systemMode':_0x3fabc9[_0x5d3621(0x151)]};_0x3fabc9[_0x5d3621(0x184)]['push'](_0x1698eb);const _0x1e74d5=_0x3fabc9[_0x5d3621(0x15a)][_0x5d3621(0x136)]||0x3c;_0x3fabc9['dailyDigests'][_0x5d3621(0x19b)]>_0x1e74d5&&_0x3fabc9['dailyDigests'][_0x5d3621(0x198)](0x0,_0x3fabc9[_0x5d3621(0x184)]['length']-_0x1e74d5);await _0x3fabc9[_0x5d3621(0x168)](LTM_DP_DAILY_DIGESTS,{'val':JSON['stringify'](_0x3fabc9[_0x5d3621(0x184)]),'ack':!![]}),_0x3fabc9[_0x5d3621(0x131)]=[],await _0x3fabc9[_0x5d3621(0x168)](LTM_DP_RAW_LOG,{'val':JSON[_0x5d3621(0x187)](_0x3fabc9['rawEventLog']),'ack':!![]}),await _0x3fabc9[_0x5d3621(0x168)](LTM_DP_STATUS,{'val':'Success','ack':!![]});const _0x59eecb='ðŸ“…\x20Daily\x20Digest:\x0a'+_0x40540d[_0x5d3621(0x1a4)]+_0x5d3621(0x13c)+_0x40540d['activityLevel'];setup[_0x5d3621(0x186)](_0x3fabc9,_0x59eecb,![],![]);if(_0x3fabc9[_0x5d3621(0x125)]&&_0x4e8402)_0x4e8402[_0x5d3621(0x145)](_0x3fabc9,_0x5d3621(0x16d),{'digest':_0x1698eb});}catch(_0x1861cc){_0x3fabc9[_0x5d3621(0x155)]['error'](_0x1861cc[_0x5d3621(0x138)]);}}function a0_0x47dc(){const _0x4245f3=['.\x0a\x20\x20\x20\x20EVENT:\x20Bewohner\x20geht\x20wahrscheinlich\x20(','\x22.\x0a\x20\x20\x20\x20AKTION:\x20Schalte\x20\x22','aiPersona','join','KI-Fehler\x20(Fallback)','response','Unbekannt\x20(Kein\x20Sensor)','exports','toFixed','Entscheide\x20ausgewogen\x20zwischen\x20Komfort\x20und\x20Energie.','58mvnjYs',',\x20LichtverhÃ¤ltnisse:\x20','Fokus\x20auf\x20Komfort\x20fÃ¼r\x20die\x20Familie.','ðŸ¤–\x20Butler\x20Brain\x20Error:\x20','ðŸ¤–\x20Traffic\x20Schutz:\x20Anfrage\x20fÃ¼r\x20','alertReason','.forecast.current.state','1649568QEPLUs',')\x20generated.','LTM.rawEventLog','isProVersion','analysis.health.geminiNight','.forecast.current.temperature','705125qSiwZM','value','BUTLER\x20Execution\x20Error:\x20','Wetterdaten\x20nicht\x20abrufbar','getStateAsync','.\x20EMERGENCY:\x20','getTime','\x0a\x20\x20\x20\x20FRAGE:\x20Ist\x20es\x20dunkel\x20genug\x20fÃ¼r\x20Licht?\x0a\x20\x20\x20\x20FORMAT:\x20{\x20\x22approved\x22:\x20boolean,\x20\x22reason\x22:\x20\x22kurzer\x20Grund\x22\x20}\x0a\x20\x20\x20\x20','toISOString','rawEventLog','debug','info','analysisHistory','.\x20KONTEXT:\x20','ltmLtbWindowDays','weatherInstance','message','Maximaler\x20Komfort,\x20Energie\x20ist\x20zweitrangig.','eventHistory','slice','\x0aAktivitÃ¤t:\x20','Traffic-Schutz\x20(Auto-Approved)','analysis.isAlert','baselineDrift','âš ï¸\x20ALARM:\x20','14221itbwuZ',').\x20Sending\x20notification...','setHours','2-digit','send','timestamp','\x22\x20AN.\x0a\x20\x20\x20\x20STRATEGIE:\x20','KI\x20offline\x20(Fallback)','Erstelle\x20ein\x20kurzes\x20\x27Guten\x20Morgen\x27\x20Briefing\x20basierend\x20auf\x20den\x20Events\x20der\x20letzten\x20Nacht.','activityLevel','Health\x20Report\x20Error:\x20','detected','\x20=\x20','analysis.automation.targetId','normal','ðŸ¤–\x20Morning\x20Briefing\x20skipped:\x20No\x20Gemini\x20Model.','currentSystemMode','constructor','unshift','automationProposal','log','ROLLE:\x20KI-Hausverwalter.\x20PERSONA:\x20','val','toLocaleTimeString','parse','config','Gemini\x20Error:\x20','toString','(((.+)+)+)+$','.\x20SYSTEM_MODE:\x20','analysis.automation.patternDetected','Keine\x20Daten\x20fÃ¼r\x20die\x20Nacht\x20aufgezeichnet\x20(Sensoren\x20ruhig).','analysis.automation.targetValue',',\x20Wetter:\x20','ðŸ¤–\x20Health\x20Report\x20(','getForeignStateAsync','map','targetId','ðŸ¤–\x20BUTLER:\x20Executing\x20Action\x20->\x20','setStateAsync','trim','LTM.driftAnalysis.baselineDrift','analysis.activitySummary','ðŸ¤–\x20Autopilot\x20skipped\x20(Traffic\x20Protection\x20active).','ANALYZE_HEALTH','targetValue','356310RhRMvN','\x20Ã¼bersprungen\x20(Auto-Approved).','Skipped\x20(Traffic)','Analysiere\x20diese\x20Events\x20der\x20NACHT\x20(22:00-08:00).\x20War\x20der\x20Schlaf\x20ruhig?\x20Gab\x20es\x20BadgÃ¤nge?\x20Antwort\x20kurz\x20fÃ¼r\x20den\x20besorgten\x20Sohn\x20(max\x202\x20SÃ¤tze).','Keine\x20Details.','ltmStbWindowDays','lastAlertState','Unbekannt','analysis.health.geminiDay','text','ROLLE:\x20Data\x20Compression\x20Agent.\x20SPRACHE:\x20DE.\x20FORMAT:\x20JSON.\x20ANWEISUNG:\x20Fasse\x20Sensor-Events\x20zusammen.\x20SCHEMA:\x20{\x20\x22summary\x22:\x20\x22string\x22,\x20\x22activityLevel\x22:\x20\x22string\x22\x20}\x20\x0a\x0aEVENTS:\x0a','geminiModel','Started...','filter','ðŸ¤–\x20Butler\x20Cache\x20Hit:\x20','models/gemini-flash-latest','replace','useWeather','@google/generative-ai','ROLLE:\x20Data\x20Scientist.\x20ZIEL:\x20Drift\x20erkennen.\x20SCHEMA:\x20{\x20\x22baselineDrift\x22:\x20\x22none|slight|significant|critical\x22,\x20\x22driftDetails\x22:\x20\x22string\x22\x20}\x0a\x0aLTB:\x20','setDate','dailyDigests','apply','sendNotification','stringify','Digest','./setup','error','PRIORITÃ„T:\x20Energie\x20sparen.\x20Schalte\x20nur,\x20wenn\x20absolut\x20notwendig\x20(Dunkelheit).','1272810PJYbWC','name','generateContent','NIGHT','isEmergency','getDate','LTM.dailyDigests','system.presenceWho','Nacht','3653901SDpcoQ','\x0a\x20\x20\x20\x20ANTWORT-STIL:\x20Sachlich,\x20beruhigend,\x20prÃ¤zise.\x20Keine\x20Floskeln.\x0a\x20\x20\x20\x20','1309QYUJaH','splice','Â°C,\x20','now','length','ðŸŒ…\x20Briefing\x20generated\x20(Length:\x20','analysis.analysisHistory','.\x20EVENTS:\x20','Skipped\x20(No\x20AI\x20or\x20Data)','.Current.IsNight','13816KdYtNS','analysis.automation.description','pop','summary','generic','ðŸ¤–\x20BUTLER:\x20No\x20valid\x20target\x20ID\x20or\x20value\x20stored\x20for\x20execution.','.\x20ANWESEND:\x20','livingContext','LTM.processingStatus','approved','warn'];a0_0x47dc=function(){return _0x4245f3;};return a0_0x47dc();}async function runBaselineDriftAnalysis(_0x5b9685){const _0x3ffb19=a0_0x32188a;if(!_0x5b9685['isProVersion']||!_0x5b9685[_0x3ffb19(0x17a)])return;if(!canCallApi())return;const _0xb70f8c=_0x5b9685[_0x3ffb19(0x15a)][_0x3ffb19(0x174)]||0xe;if(_0x5b9685[_0x3ffb19(0x184)][_0x3ffb19(0x19b)]<_0xb70f8c+0x7){await _0x5b9685[_0x3ffb19(0x168)](_0x3ffb19(0x16a),{'val':'N/A\x20(Learning)','ack':!![]});return;}const _0x449984=_0x5b9685[_0x3ffb19(0x184)][_0x3ffb19(0x13b)](-_0xb70f8c),_0x5148ca=_0x5b9685['dailyDigests'][_0x3ffb19(0x13b)](0x0,_0x5b9685[_0x3ffb19(0x184)][_0x3ffb19(0x19b)]-_0xb70f8c),_0x2b780d=_0x3ffb19(0x182)+JSON[_0x3ffb19(0x187)](_0x5148ca)+'\x0aSTB:\x20'+JSON['stringify'](_0x449984);try{updateApiTimestamp();const _0xc3abb2=await _0x5b9685[_0x3ffb19(0x17a)][_0x3ffb19(0x18e)](_0x2b780d),_0x4bbe22=JSON[_0x3ffb19(0x159)](_0xc3abb2[_0x3ffb19(0x1b1)][_0x3ffb19(0x178)]()[_0x3ffb19(0x17f)](/```json|```/g,'')['trim']());_0x4bbe22['baselineDrift']&&(await _0x5b9685[_0x3ffb19(0x168)](_0x3ffb19(0x16a),{'val':_0x4bbe22[_0x3ffb19(0x13f)],'ack':!![]}),await _0x5b9685[_0x3ffb19(0x168)]('LTM.driftAnalysis.driftDetails',{'val':_0x4bbe22['driftDetails'],'ack':!![]}),await _0x5b9685[_0x3ffb19(0x168)]('LTM.driftAnalysis.lastCheck',{'val':Date[_0x3ffb19(0x19a)](),'ack':!![]}));}catch(_0x192a1c){}}async function executeAutomationAction(_0x535ff4){const _0x5a23cd=a0_0x32188a;try{const _0x5b2bb3=await _0x535ff4['getStateAsync'](_0x5a23cd(0x14e)),_0xf2cdee=await _0x535ff4[_0x5a23cd(0x12c)]('analysis.automation.targetValue');if(_0x5b2bb3&&_0x5b2bb3['val']&&_0xf2cdee){const _0x6a9667=_0x5b2bb3[_0x5a23cd(0x157)];let _0x157c29=_0xf2cdee[_0x5a23cd(0x157)];try{_0x157c29=JSON[_0x5a23cd(0x159)](_0x157c29);}catch(_0x4841f3){}_0x535ff4[_0x5a23cd(0x155)][_0x5a23cd(0x133)](_0x5a23cd(0x167)+_0x6a9667+_0x5a23cd(0x14d)+_0x157c29),await _0x535ff4['setForeignStateAsync'](_0x6a9667,_0x157c29);}else _0x535ff4[_0x5a23cd(0x155)][_0x5a23cd(0x1ab)](_0x5a23cd(0x1a6));}catch(_0x3d2a85){_0x535ff4[_0x5a23cd(0x155)][_0x5a23cd(0x18a)](_0x5a23cd(0x12a)+_0x3d2a85[_0x5a23cd(0x138)]);}}async function sendMorningBriefing(_0x2cb08e){const _0x1a6023=a0_0x32188a;if(!_0x2cb08e['geminiModel']){_0x2cb08e[_0x1a6023(0x155)]['warn'](_0x1a6023(0x150));return;}_0x2cb08e[_0x1a6023(0x155)][_0x1a6023(0x133)]('ðŸŒ…\x20Starting\x20Morning\x20Briefing\x20sequence\x20(Traffic\x20Check\x20bypassed)...');try{updateApiTimestamp();const _0x5b84b5=_0x1a6023(0x149),_0x11f479=await _0x2cb08e[_0x1a6023(0x17a)][_0x1a6023(0x18e)](_0x5b84b5),_0x5f5646=_0x11f479[_0x1a6023(0x1b1)]['text']();_0x2cb08e[_0x1a6023(0x155)][_0x1a6023(0x133)](_0x1a6023(0x19c)+_0x5f5646[_0x1a6023(0x19b)]+_0x1a6023(0x142)),setup['sendNotification'](_0x2cb08e,'ðŸŒ…\x20Morning\x20Briefing:\x0a'+_0x5f5646);}catch(_0x5a715b){_0x2cb08e[_0x1a6023(0x155)]['error']('Briefing\x20Error:\x20'+_0x5a715b[_0x1a6023(0x138)]);}}async function generateHealthReport(_0x1ec7bb,_0x11293a){const _0x3b4465=a0_0x32188a;if(!_0x1ec7bb[_0x3b4465(0x17a)])return;const _0x461998=Date['now']();_0x461998-lastGlobalApiCall<0xbb8&&(_0x1ec7bb[_0x3b4465(0x155)]['debug']('ðŸ¤–\x20API\x20Cooldown.\x20Waiting\x202s...'),await new Promise(_0x37d1da=>setTimeout(_0x37d1da,0x7d0)));const _0x54c201=new Date();let _0x31c47d=0x0,_0x12e72e=_0x54c201[_0x3b4465(0x12e)](),_0x857ee9='';if(_0x11293a===_0x3b4465(0x18f)){const _0x142547=new Date(_0x54c201);_0x142547[_0x3b4465(0x183)](_0x142547[_0x3b4465(0x191)]()-0x1),_0x142547[_0x3b4465(0x143)](0x16,0x0,0x0,0x0),_0x31c47d=_0x142547[_0x3b4465(0x12e)]();const _0x28029c=new Date(_0x54c201);_0x28029c['setHours'](0x8,0x0,0x0,0x0),_0x12e72e=_0x28029c[_0x3b4465(0x12e)](),_0x857ee9=_0x3b4465(0x172);}else{const _0x4c687e=new Date(_0x54c201);_0x4c687e['setHours'](0x8,0x0,0x0,0x0),_0x31c47d=_0x4c687e[_0x3b4465(0x12e)](),_0x857ee9='Analysiere\x20diese\x20Events\x20des\x20TAGES\x20(08:00-Jetzt).\x20AktivitÃ¤t?\x20Mahlzeiten?\x20HaustÃ¼r?\x20Antwort\x20kurz\x20fÃ¼r\x20den\x20besorgten\x20Sohn\x20(max\x202\x20SÃ¤tze).';}const _0x5045cd=_0x1ec7bb[_0x3b4465(0x13a)][_0x3b4465(0x17c)](_0x58f774=>_0x58f774[_0x3b4465(0x146)]>=_0x31c47d&&_0x58f774['timestamp']<=_0x12e72e);if(_0x5045cd['length']===0x0){const _0x4ef6cb=_0x11293a===_0x3b4465(0x18f)?_0x3b4465(0x160):'Bisher\x20keine\x20AktivitÃ¤t\x20seit\x2008:00\x20Uhr\x20verzeichnet.',_0x29241d=_0x11293a===_0x3b4465(0x18f)?'analysis.health.geminiNight':'analysis.health.geminiDay';await _0x1ec7bb['setStateAsync'](_0x29241d,{'val':_0x4ef6cb,'ack':!![]});return;}const _0xfc1850=_0x5045cd[_0x3b4465(0x165)](_0x596308=>new Date(_0x596308['timestamp'])[_0x3b4465(0x158)]([],{'hour':_0x3b4465(0x144),'minute':_0x3b4465(0x144)})+'\x20'+_0x596308[_0x3b4465(0x18d)]+'\x20('+_0x596308[_0x3b4465(0x129)]+')')[_0x3b4465(0x1af)]('\x0a'),_0x423954='\x0a\x20\x20\x20\x20ROLLE:\x20Medizinischer\x20Assistent\x20fÃ¼r\x20AAL\x20(Ambient\x20Assisted\x20Living).\x0a\x20\x20\x20\x20AUFGABE:\x20'+_0x857ee9+'\x0a\x20\x20\x20\x20EVENTS:\x0a'+_0xfc1850+_0x3b4465(0x196);try{updateApiTimestamp();const _0x33e41a=await _0x1ec7bb[_0x3b4465(0x17a)][_0x3b4465(0x18e)](_0x423954),_0x385a1f=_0x33e41a[_0x3b4465(0x1b1)]['text'](),_0x259f3f=_0x11293a===_0x3b4465(0x18f)?_0x3b4465(0x126):_0x3b4465(0x177);await _0x1ec7bb['setStateAsync'](_0x259f3f,{'val':_0x385a1f,'ack':!![]}),_0x1ec7bb[_0x3b4465(0x155)]['info'](_0x3b4465(0x163)+_0x11293a+_0x3b4465(0x123));}catch(_0x569a71){_0x1ec7bb['log'][_0x3b4465(0x18a)](_0x3b4465(0x14b)+_0x569a71[_0x3b4465(0x138)]);}}module[a0_0x32188a(0x118)]={'executeAutomationAction':executeAutomationAction,'createDailyDigest':createDailyDigest,'runBaselineDriftAnalysis':runBaselineDriftAnalysis,'sendMorningBriefing':sendMorningBriefing,'runGeminiAnalysis':runGeminiAnalysis,'consultButler':consultButler,'generateHealthReport':generateHealthReport};