const a0_0x2038a5=a0_0x3389;function a0_0x3389(_0x5e6e13,_0x3a3ece){const _0x1472b3=a0_0x8f29();return a0_0x3389=function(_0x11e7a8,_0x82492d){_0x11e7a8=_0x11e7a8-0x1c1;let _0x8f293e=_0x1472b3[_0x11e7a8];return _0x8f293e;},a0_0x3389(_0x5e6e13,_0x3a3ece);}(function(_0x55a519,_0x515dc6){const _0x1b7dbc=a0_0x3389,_0x3bfcdd=_0x55a519();while(!![]){try{const _0x268b46=-parseInt(_0x1b7dbc(0x1e6))/0x1+parseInt(_0x1b7dbc(0x1fc))/0x2+-parseInt(_0x1b7dbc(0x232))/0x3*(-parseInt(_0x1b7dbc(0x20b))/0x4)+-parseInt(_0x1b7dbc(0x218))/0x5*(parseInt(_0x1b7dbc(0x1dd))/0x6)+-parseInt(_0x1b7dbc(0x1fa))/0x7+parseInt(_0x1b7dbc(0x223))/0x8+parseInt(_0x1b7dbc(0x243))/0x9;if(_0x268b46===_0x515dc6)break;else _0x3bfcdd['push'](_0x3bfcdd['shift']());}catch(_0x53d39c){_0x3bfcdd['push'](_0x3bfcdd['shift']());}}}(a0_0x8f29,0xf11e1));const a0_0x82492d=(function(){let _0x103a91=!![];return function(_0x51301d,_0x1cc2d7){const _0x14a47f=_0x103a91?function(){if(_0x1cc2d7){const _0x17fad4=_0x1cc2d7['apply'](_0x51301d,arguments);return _0x1cc2d7=null,_0x17fad4;}}:function(){};return _0x103a91=![],_0x14a47f;};}()),a0_0x11e7a8=a0_0x82492d(this,function(){const _0x5152d5=a0_0x3389;return a0_0x11e7a8[_0x5152d5(0x23a)]()[_0x5152d5(0x22f)](_0x5152d5(0x209))['toString']()[_0x5152d5(0x1ca)](a0_0x11e7a8)[_0x5152d5(0x22f)](_0x5152d5(0x209));});a0_0x11e7a8();'use strict';const {GoogleGenerativeAI}=require('@google/generative-ai'),setup=require(a0_0x2038a5(0x212)),GEMINI_MODEL='models/gemini-flash-latest',LTM_DP_DAILY_DIGESTS=a0_0x2038a5(0x256),LTM_DP_STATUS=a0_0x2038a5(0x1f8),LTM_DP_RAW_LOG=a0_0x2038a5(0x234),LTM_MIN_EVENTS_FOR_COMPRESSION=0x5,MIN_API_GAP_MS=0x4e20;function a0_0x8f29(){const _0x154fe8=['constructor','log','stringify','\x22\x20AN.\x0a\x20\x20\x20\x20STRATEGIE:\x20','\x0a\x20\x20\x20\x20FRAGE:\x20Ist\x20es\x20dunkel\x20genug\x20fÃ¼r\x20Licht?\x0a\x20\x20\x20\x20FORMAT:\x20{\x20\x22approved\x22:\x20boolean,\x20\x22reason\x22:\x20\x22kurzer\x20Grund\x22\x20}\x0a\x20\x20\x20\x20','useWeather','baselineDrift','isAlert','pop','analysisHistory','\x22.\x0a\x20\x20\x20\x20AKTION:\x20Schalte\x20\x22','currentSystemMode','ltmStbWindowDays','dailyDigests','toLocaleTimeString','ðŸŒ…\x20Starting\x20Morning\x20Briefing\x20sequence\x20(Traffic\x20Check\x20bypassed)...','detected','.Current.WeatherText','weatherInstance','6pbZGXd','setStateAsync','analysis.automation.autoApply','analysis.automation.description','NIGHT','Success','name','activityLevel','info','524284MnXfeF','\x0aSTB:\x20','analysis.automation.targetId','sendNotification','getForeignStateAsync','trim','warn','LTM.driftAnalysis.baselineDrift','Unbekannt','.forecast.current.state','Wetterdaten\x20nicht\x20abrufbar','2-digit','approved','toISOString','.forecast.current.temperature','text','Nacht','isProVersion','LTM.processingStatus','map','9412459GBpSCD','\x20Ã¼bersprungen\x20(Auto-Approved).','654384OCDFMT','analysis.health.geminiNight','config','ðŸ¤–\x20BUTLER:\x20No\x20valid\x20target\x20ID\x20or\x20value\x20stored\x20for\x20execution.','analysis.analysisHistory','targetValue','BUTLER\x20Execution\x20Error:\x20','N/A\x20(Learning)','Skipped\x20(No\x20AI\x20or\x20Data)','Keine\x20Daten\x20fÃ¼r\x20die\x20Nacht\x20aufgezeichnet\x20(Sensoren\x20ruhig).','error','system.presenceWho','\x0a\x20\x20\x20\x20ANTWORT-STIL:\x20Sachlich,\x20beruhigend,\x20prÃ¤zise.\x20Keine\x20Floskeln.\x0a\x20\x20\x20\x20','(((.+)+)+)+$','Health\x20Report\x20Error:\x20','1330296hRkVDu','LTM.driftAnalysis.driftDetails','reason',',\x20LichtverhÃ¤ltnisse:\x20','message','Unbekannt\x20(Kein\x20Sensor)','livingContext','./setup','analysis.isAlert','generateContent','.\x0a\x20\x20\x20\x20EVENT:\x20Bewohner\x20geht\x20wahrscheinlich\x20(','now','Tag','781795dtAaDd','parse','%)\x20nach\x20\x22','Sicherheit\x20geht\x20vor.','value','analysis.health.geminiDay','ðŸ¤–\x20Morning\x20Briefing\x20skipped:\x20No\x20Gemini\x20Model.','ROLLE:\x20KI-Hausverwalter.\x20PERSONA:\x20','exports','setHours','response','5421048eeHeni','analysis.lastResult','KI-Fehler\x20(Fallback)','.Current.Temperature','analysis.automation.targetValue','ðŸŒ…\x20Briefing\x20generated\x20(Length:\x20','Analysiere\x20diese\x20Events\x20der\x20NACHT\x20(22:00-08:00).\x20War\x20der\x20Schlaf\x20ruhig?\x20Gab\x20es\x20BadgÃ¤nge?\x20Antwort\x20kurz\x20fÃ¼r\x20den\x20besorgten\x20Sohn\x20(max\x202\x20SÃ¤tze).','\x0a\x20\x20\x20\x20EVENTS:\x0a','Erstelle\x20ein\x20kurzes\x20\x27Guten\x20Morgen\x27\x20Briefing\x20basierend\x20auf\x20den\x20Events\x20der\x20letzten\x20Nacht.','toFixed','summary','ROLLE:\x20Data\x20Compression\x20Agent.\x20SPRACHE:\x20DE.\x20FORMAT:\x20JSON.\x20ANWEISUNG:\x20Fasse\x20Sensor-Events\x20zusammen.\x20SCHEMA:\x20{\x20\x22summary\x22:\x20\x22string\x22,\x20\x22activityLevel\x22:\x20\x22string\x22\x20}\x20\x0a\x0aEVENTS:\x0a','search','Fokus\x20auf\x20Komfort\x20fÃ¼r\x20die\x20Familie.','slice','3NCXHen','getTime','LTM.rawEventLog','replace','filter','Briefing\x20Error:\x20','rawEventLog','LTM.driftAnalysis.lastCheck','toString','alertReason','\x0a\x20\x20\x20\x20ROLLE:\x20Medizinischer\x20Assistent\x20fÃ¼r\x20AAL\x20(Ambient\x20Assisted\x20Living).\x0a\x20\x20\x20\x20AUFGABE:\x20','\x0a\x20\x20\x20\x20ROLLE:\x20Haus-Butler.\x0a\x20\x20\x20\x20SITUATION:\x20','\x20->\x20','val','eventHistory','Â°C,\x20','ðŸŒ…\x20Morning\x20Briefing:\x0a','15079500RmDhBH','geminiModel','ltmLtbWindowDays','setForeignStateAsync','getDate','analysis.automation.patternDetected','ðŸ¤–\x20Butler\x20Cache\x20Hit:\x20','send','âš ï¸\x20ALARM:\x20','Traffic-Schutz\x20(Auto-Approved)','decision','description','.Current.IsNight','splice','timestamp','.\x20AUFGABE:\x201.\x20Gesundheit?\x202.\x20Komfort?\x20FORMAT\x20(JSON):\x20{\x20\x22isAlert\x22:\x20boolean,\x20\x22alertReason\x22:\x20\x22string\x22,\x20\x22isEmergency\x22:\x20boolean,\x20\x22summary\x22:\x20\x22string\x22,\x20\x22automationProposal\x22:\x20{\x20\x22detected\x22:\x20boolean,\x20\x22description\x22:\x20\x22string\x22,\x20\x22targetId\x22:\x20\x22string\x22,\x20\x22targetValue\x22:\x20\x22any\x22\x20}\x20}','automationProposal','.\x20KONTEXT:\x20','ðŸ¤–\x20Traffic\x20Schutz:\x20Anfrage\x20fÃ¼r\x20','LTM.dailyDigests','ðŸ“…\x20Daily\x20Digest:\x0a','.\x20SYSTEM_MODE:\x20','debug',')\x20generated.','Keine\x20Details.','setDate','\x20=\x20','Digest','length','push','Analysiere\x20diese\x20Events\x20des\x20TAGES\x20(08:00-Jetzt).\x20AktivitÃ¤t?\x20Mahlzeiten?\x20HaustÃ¼r?\x20Antwort\x20kurz\x20fÃ¼r\x20den\x20besorgten\x20Sohn\x20(max\x202\x20SÃ¤tze).','.\x20EVENTS:\x20','lastAlertState','\x0aAktivitÃ¤t:\x20','getStateAsync'];a0_0x8f29=function(){return _0x154fe8;};return a0_0x8f29();}let lastGlobalApiCall=0x0;const decisionCache={},CACHE_TTL_MS=0xf*0x3c*0x3e8,PERSONA_MAPPING={'generic':'Entscheide\x20ausgewogen\x20zwischen\x20Komfort\x20und\x20Energie.','senior_aal':'PRIORITÃ„T:\x20Sicherheit\x20und\x20Licht.\x20Schalte\x20lieber\x20einmal\x20zu\x20viel\x20als\x20zu\x20wenig.','family':a0_0x2038a5(0x230),'single_comfort':'Maximaler\x20Komfort,\x20Energie\x20ist\x20zweitrangig.','security':a0_0x2038a5(0x21b),'energy_saver':'PRIORITÃ„T:\x20Energie\x20sparen.\x20Schalte\x20nur,\x20wenn\x20absolut\x20notwendig\x20(Dunkelheit).'};function canCallApi(){const _0x3f60fb=a0_0x2038a5,_0x135eb8=Date[_0x3f60fb(0x216)]();return _0x135eb8-lastGlobalApiCall>MIN_API_GAP_MS;}function updateApiTimestamp(){const _0x2edf09=a0_0x2038a5;lastGlobalApiCall=Date[_0x2edf09(0x216)]();}async function getWeatherContext(_0x689182){const _0x1af242=a0_0x2038a5;if(!_0x689182['config'][_0x1af242(0x1cf)]||!_0x689182[_0x1af242(0x1fe)][_0x1af242(0x1dc)])return _0x1af242(0x210);try{const _0x58ba4d=_0x689182[_0x1af242(0x1fe)][_0x1af242(0x1dc)];let _0x2034bb=await _0x689182['getForeignStateAsync'](_0x58ba4d+_0x1af242(0x226));if(!_0x2034bb)_0x2034bb=await _0x689182[_0x1af242(0x1ea)](_0x58ba4d+_0x1af242(0x1f4));let _0x1d6873=await _0x689182['getForeignStateAsync'](_0x58ba4d+_0x1af242(0x1db));if(!_0x1d6873)_0x1d6873=await _0x689182[_0x1af242(0x1ea)](_0x58ba4d+_0x1af242(0x1ef));let _0x3aee2f=_0x1af242(0x1ee);const _0x4ba692=await _0x689182[_0x1af242(0x1ea)](_0x58ba4d+_0x1af242(0x24f));if(_0x4ba692)_0x3aee2f=_0x4ba692[_0x1af242(0x23f)]?_0x1af242(0x1f6):_0x1af242(0x217);if(_0x2034bb&&_0x1d6873)return _0x2034bb['val']+_0x1af242(0x241)+_0x1d6873[_0x1af242(0x23f)]+_0x1af242(0x20e)+_0x3aee2f;}catch(_0x4bef9){}return _0x1af242(0x1f0);}async function consultButler(_0x27129d,_0x3b7058,_0x4de33f,_0x5f3f1a){const _0x26188c=a0_0x2038a5;if(!_0x27129d[_0x26188c(0x244)])return{'approved':!![],'reason':'KI\x20offline\x20(Fallback)'};const _0x68881b=Date[_0x26188c(0x216)]();if(decisionCache[_0x3b7058]&&_0x68881b-decisionCache[_0x3b7058]['timestamp']<CACHE_TTL_MS){const _0x379b57=decisionCache[_0x3b7058][_0x26188c(0x24d)];return _0x27129d['log'][_0x26188c(0x259)](_0x26188c(0x249)+_0x3b7058+_0x26188c(0x23e)+(_0x379b57[_0x26188c(0x1f2)]?'OK':'NO')+'\x20('+_0x379b57[_0x26188c(0x20d)]+')'),_0x379b57;}if(!canCallApi())return _0x27129d[_0x26188c(0x1cb)]['debug'](_0x26188c(0x255)+_0x3b7058+_0x26188c(0x1fb)),{'approved':!![],'reason':_0x26188c(0x24c)};const _0x41987d=new Date()[_0x26188c(0x1d8)](),_0x48d360=await getWeatherContext(_0x27129d),_0x4a09b0=PERSONA_MAPPING[_0x27129d[_0x26188c(0x1fe)]['aiPersona']||'generic'],_0x25e631=_0x26188c(0x23d)+_0x41987d+',\x20Wetter:\x20'+_0x48d360+_0x26188c(0x215)+(_0x5f3f1a*0x64)[_0x26188c(0x22c)](0x0)+_0x26188c(0x21a)+_0x3b7058+_0x26188c(0x1d4)+_0x4de33f+_0x26188c(0x1cd)+_0x4a09b0+_0x26188c(0x1ce);try{updateApiTimestamp();const _0x3ec51e=await _0x27129d['geminiModel'][_0x26188c(0x214)](_0x25e631),_0x3285cf=_0x3ec51e[_0x26188c(0x222)][_0x26188c(0x1f5)]()[_0x26188c(0x235)](/```json|```/g,'')[_0x26188c(0x1eb)](),_0x555acc=JSON[_0x26188c(0x219)](_0x3285cf);return decisionCache[_0x3b7058]={'decision':_0x555acc,'timestamp':_0x68881b},_0x555acc;}catch(_0x52d3c1){return _0x27129d[_0x26188c(0x1cb)][_0x26188c(0x1ec)]('ðŸ¤–\x20Butler\x20Brain\x20Error:\x20'+_0x52d3c1[_0x26188c(0x20f)]),decisionCache[_0x3b7058]={'decision':{'approved':!![],'reason':_0x26188c(0x225)},'timestamp':_0x68881b-(CACHE_TTL_MS-0xea60)},{'approved':!![],'reason':'KI-Fehler\x20(Fallback)'};}}async function runGeminiAnalysis(_0x430a03,_0x4ea2e6=''){const _0x285d8a=a0_0x2038a5;if(!_0x430a03[_0x285d8a(0x244)])return;if(!canCallApi()){_0x430a03[_0x285d8a(0x1cb)][_0x285d8a(0x259)]('ðŸ¤–\x20Autopilot\x20skipped\x20(Traffic\x20Protection\x20active).');return;}if(_0x430a03[_0x285d8a(0x240)][_0x285d8a(0x1c3)]===0x0)return;const _0x44db24=_0x430a03['eventHistory'][_0x285d8a(0x231)](0x0,0xf),_0x20fe7e=_0x430a03[_0x285d8a(0x1d5)],_0x1f90b5=PERSONA_MAPPING[_0x430a03[_0x285d8a(0x1fe)]['aiPersona']||'generic'],_0x29217b=_0x430a03[_0x285d8a(0x1fe)][_0x285d8a(0x211)]||_0x285d8a(0x25b);let _0x7f1025=_0x285d8a(0x1ee);try{const _0x38e1f5=await _0x430a03[_0x285d8a(0x1c9)](_0x285d8a(0x207));if(_0x38e1f5&&_0x38e1f5['val'])_0x7f1025=_0x38e1f5[_0x285d8a(0x23f)];}catch(_0x124809){}let _0xc6dd52=![];try{const _0x59c52d=await _0x430a03['getStateAsync'](_0x285d8a(0x1df));if(_0x59c52d&&_0x59c52d[_0x285d8a(0x23f)])_0xc6dd52=!![];}catch(_0x4c1467){}const _0x338a00=_0x285d8a(0x21f)+_0x1f90b5+_0x285d8a(0x254)+_0x29217b+_0x285d8a(0x258)+_0x20fe7e+'.\x20ANWESEND:\x20'+_0x7f1025+_0x285d8a(0x1c6)+JSON[_0x285d8a(0x1cc)](_0x44db24)+'.\x20EMERGENCY:\x20'+_0x4ea2e6+_0x285d8a(0x252);try{updateApiTimestamp();const _0x534549=await _0x430a03[_0x285d8a(0x244)][_0x285d8a(0x214)](_0x338a00),_0x363240=JSON[_0x285d8a(0x219)](_0x534549['response'][_0x285d8a(0x1f5)]()[_0x285d8a(0x235)](/```json|```/g,'')['trim']());await _0x430a03[_0x285d8a(0x1de)](_0x285d8a(0x224),{'val':JSON[_0x285d8a(0x1cc)](_0x363240),'ack':!![]});if(_0x363240[_0x285d8a(0x22d)])await _0x430a03['setStateAsync']('analysis.activitySummary',{'val':_0x363240['summary'],'ack':!![]});const _0x2520bd={'timestamp':Date[_0x285d8a(0x216)](),'id':Date['now']()[_0x285d8a(0x23a)](),'analysis':{'activity':{'summary':_0x363240[_0x285d8a(0x22d)],'isAlert':_0x363240[_0x285d8a(0x1d1)],'alertReason':_0x363240[_0x285d8a(0x23b)]},'comfort':{'automationProposal':_0x363240[_0x285d8a(0x253)]}}};_0x430a03[_0x285d8a(0x1d3)]['unshift'](_0x2520bd);if(_0x430a03['analysisHistory'][_0x285d8a(0x1c3)]>0x32)_0x430a03[_0x285d8a(0x1d3)][_0x285d8a(0x1d2)]();await _0x430a03[_0x285d8a(0x1de)](_0x285d8a(0x200),{'val':JSON['stringify'](_0x430a03[_0x285d8a(0x1d3)]),'ack':!![]});const _0x32f67d=_0x363240['isAlert']||![];_0x32f67d!==_0x430a03['lastAlertState']&&(await _0x430a03[_0x285d8a(0x1de)](_0x285d8a(0x213),{'val':_0x32f67d,'ack':!![]}),_0x430a03[_0x285d8a(0x1c7)]=_0x32f67d,_0x32f67d&&(await _0x430a03[_0x285d8a(0x1de)]('analysis.alertReason',{'val':_0x363240['alertReason'],'ack':!![]}),setup[_0x285d8a(0x1e9)](_0x430a03,_0x285d8a(0x24b)+_0x363240[_0x285d8a(0x23b)],![],_0x363240['isEmergency'])));if(_0x363240[_0x285d8a(0x253)]&&_0x363240[_0x285d8a(0x253)][_0x285d8a(0x1da)]){await _0x430a03[_0x285d8a(0x1de)](_0x285d8a(0x248),{'val':!![],'ack':!![]}),await _0x430a03[_0x285d8a(0x1de)](_0x285d8a(0x1e0),{'val':_0x363240[_0x285d8a(0x253)][_0x285d8a(0x24e)],'ack':!![]}),await _0x430a03[_0x285d8a(0x1de)](_0x285d8a(0x1e8),{'val':_0x363240[_0x285d8a(0x253)]['targetId'],'ack':!![]}),await _0x430a03[_0x285d8a(0x1de)]('analysis.automation.targetValue',{'val':JSON[_0x285d8a(0x1cc)](_0x363240[_0x285d8a(0x253)][_0x285d8a(0x201)]),'ack':!![]});if(_0xc6dd52)executeAutomationAction(_0x430a03);}}catch(_0x2a9082){_0x430a03['log'][_0x285d8a(0x206)]('Gemini\x20Error:\x20'+_0x2a9082['message']);}}async function createDailyDigest(_0x18719a,_0x5b803e){const _0x538b39=a0_0x2038a5;if(!_0x18719a[_0x538b39(0x1f7)])return;if(!canCallApi()){await _0x18719a[_0x538b39(0x1de)](LTM_DP_STATUS,{'val':'Skipped\x20(Traffic)','ack':!![]});return;}await _0x18719a[_0x538b39(0x1de)](LTM_DP_STATUS,{'val':'Started...','ack':!![]});if(!_0x18719a[_0x538b39(0x244)]||_0x18719a['rawEventLog'][_0x538b39(0x1c3)]<LTM_MIN_EVENTS_FOR_COMPRESSION){await _0x18719a[_0x538b39(0x1de)](LTM_DP_STATUS,{'val':_0x538b39(0x204),'ack':!![]});return;}const _0x5857db=JSON[_0x538b39(0x219)](JSON[_0x538b39(0x1cc)](_0x18719a['rawEventLog'])),_0x2b2f53=_0x5857db[_0x538b39(0x1c3)],_0x449d49=_0x538b39(0x22e)+JSON[_0x538b39(0x1cc)](_0x5857db);try{updateApiTimestamp();const _0x963eec=await _0x18719a[_0x538b39(0x244)][_0x538b39(0x214)](_0x449d49),_0x1da192=JSON['parse'](_0x963eec['response'][_0x538b39(0x1f5)]()[_0x538b39(0x235)](/```json|```/g,'')[_0x538b39(0x1eb)]()),_0x37e874={'timestamp':new Date()[_0x538b39(0x1f3)](),'eventCount':_0x2b2f53,'summary':_0x1da192[_0x538b39(0x22d)]||_0x538b39(0x1c2),'activityLevel':_0x1da192[_0x538b39(0x1e4)]||'normal','systemMode':_0x18719a[_0x538b39(0x1d5)]};_0x18719a[_0x538b39(0x1d7)][_0x538b39(0x1c4)](_0x37e874);const _0x50ec71=_0x18719a[_0x538b39(0x1fe)][_0x538b39(0x245)]||0x3c;_0x18719a['dailyDigests'][_0x538b39(0x1c3)]>_0x50ec71&&_0x18719a['dailyDigests'][_0x538b39(0x250)](0x0,_0x18719a[_0x538b39(0x1d7)][_0x538b39(0x1c3)]-_0x50ec71);await _0x18719a[_0x538b39(0x1de)](LTM_DP_DAILY_DIGESTS,{'val':JSON['stringify'](_0x18719a['dailyDigests']),'ack':!![]}),_0x18719a[_0x538b39(0x238)]=[],await _0x18719a['setStateAsync'](LTM_DP_RAW_LOG,{'val':JSON[_0x538b39(0x1cc)](_0x18719a['rawEventLog']),'ack':!![]}),await _0x18719a[_0x538b39(0x1de)](LTM_DP_STATUS,{'val':_0x538b39(0x1e2),'ack':!![]});const _0x287c7b=_0x538b39(0x257)+_0x1da192[_0x538b39(0x22d)]+_0x538b39(0x1c8)+_0x1da192[_0x538b39(0x1e4)];setup[_0x538b39(0x1e9)](_0x18719a,_0x287c7b,![],![]);if(_0x18719a[_0x538b39(0x1f7)]&&_0x5b803e)_0x5b803e[_0x538b39(0x24a)](_0x18719a,'ANALYZE_HEALTH',{'digest':_0x37e874});}catch(_0x3ca525){_0x18719a[_0x538b39(0x1cb)]['error'](_0x3ca525[_0x538b39(0x20f)]);}}async function runBaselineDriftAnalysis(_0x41857f){const _0x5933e2=a0_0x2038a5;if(!_0x41857f[_0x5933e2(0x1f7)]||!_0x41857f[_0x5933e2(0x244)])return;if(!canCallApi())return;const _0x34202=_0x41857f[_0x5933e2(0x1fe)][_0x5933e2(0x1d6)]||0xe;if(_0x41857f[_0x5933e2(0x1d7)][_0x5933e2(0x1c3)]<_0x34202+0x7){await _0x41857f[_0x5933e2(0x1de)](_0x5933e2(0x1ed),{'val':_0x5933e2(0x203),'ack':!![]});return;}const _0x16814a=_0x41857f['dailyDigests'][_0x5933e2(0x231)](-_0x34202),_0x4f7fca=_0x41857f['dailyDigests'][_0x5933e2(0x231)](0x0,_0x41857f['dailyDigests'][_0x5933e2(0x1c3)]-_0x34202),_0x5a6108='ROLLE:\x20Data\x20Scientist.\x20ZIEL:\x20Drift\x20erkennen.\x20SCHEMA:\x20{\x20\x22baselineDrift\x22:\x20\x22none|slight|significant|critical\x22,\x20\x22driftDetails\x22:\x20\x22string\x22\x20}\x0a\x0aLTB:\x20'+JSON[_0x5933e2(0x1cc)](_0x4f7fca)+_0x5933e2(0x1e7)+JSON['stringify'](_0x16814a);try{updateApiTimestamp();const _0x27968f=await _0x41857f[_0x5933e2(0x244)][_0x5933e2(0x214)](_0x5a6108),_0x54b339=JSON[_0x5933e2(0x219)](_0x27968f[_0x5933e2(0x222)]['text']()['replace'](/```json|```/g,'')[_0x5933e2(0x1eb)]());_0x54b339[_0x5933e2(0x1d0)]&&(await _0x41857f[_0x5933e2(0x1de)](_0x5933e2(0x1ed),{'val':_0x54b339[_0x5933e2(0x1d0)],'ack':!![]}),await _0x41857f[_0x5933e2(0x1de)](_0x5933e2(0x20c),{'val':_0x54b339['driftDetails'],'ack':!![]}),await _0x41857f[_0x5933e2(0x1de)](_0x5933e2(0x239),{'val':Date['now'](),'ack':!![]}));}catch(_0x1699a7){}}async function executeAutomationAction(_0x4a81bf){const _0x57154c=a0_0x2038a5;try{const _0x24e18b=await _0x4a81bf[_0x57154c(0x1c9)](_0x57154c(0x1e8)),_0x543d7c=await _0x4a81bf[_0x57154c(0x1c9)](_0x57154c(0x227));if(_0x24e18b&&_0x24e18b[_0x57154c(0x23f)]&&_0x543d7c){const _0x43b740=_0x24e18b[_0x57154c(0x23f)];let _0x37fb06=_0x543d7c['val'];try{_0x37fb06=JSON[_0x57154c(0x219)](_0x37fb06);}catch(_0xb4e918){}_0x4a81bf['log']['info']('ðŸ¤–\x20BUTLER:\x20Executing\x20Action\x20->\x20'+_0x43b740+_0x57154c(0x1c1)+_0x37fb06),await _0x4a81bf[_0x57154c(0x246)](_0x43b740,_0x37fb06);}else _0x4a81bf[_0x57154c(0x1cb)][_0x57154c(0x1ec)](_0x57154c(0x1ff));}catch(_0x5de7a5){_0x4a81bf[_0x57154c(0x1cb)][_0x57154c(0x206)](_0x57154c(0x202)+_0x5de7a5['message']);}}async function sendMorningBriefing(_0x2b7763){const _0xc2f159=a0_0x2038a5;if(!_0x2b7763[_0xc2f159(0x244)]){_0x2b7763['log'][_0xc2f159(0x1ec)](_0xc2f159(0x21e));return;}_0x2b7763[_0xc2f159(0x1cb)][_0xc2f159(0x1e5)](_0xc2f159(0x1d9));try{updateApiTimestamp();const _0x2e1abd=_0xc2f159(0x22b),_0x19f02e=await _0x2b7763[_0xc2f159(0x244)][_0xc2f159(0x214)](_0x2e1abd),_0x216326=_0x19f02e[_0xc2f159(0x222)][_0xc2f159(0x1f5)]();_0x2b7763[_0xc2f159(0x1cb)][_0xc2f159(0x1e5)](_0xc2f159(0x228)+_0x216326[_0xc2f159(0x1c3)]+').\x20Sending\x20notification...'),setup[_0xc2f159(0x1e9)](_0x2b7763,_0xc2f159(0x242)+_0x216326);}catch(_0x3da02e){_0x2b7763[_0xc2f159(0x1cb)]['error'](_0xc2f159(0x237)+_0x3da02e[_0xc2f159(0x20f)]);}}async function generateHealthReport(_0x35a41b,_0x3e0714){const _0x230c2c=a0_0x2038a5;if(!_0x35a41b[_0x230c2c(0x244)])return;const _0x1b2f6a=Date[_0x230c2c(0x216)]();_0x1b2f6a-lastGlobalApiCall<0xbb8&&(_0x35a41b[_0x230c2c(0x1cb)][_0x230c2c(0x259)]('ðŸ¤–\x20API\x20Cooldown.\x20Waiting\x202s...'),await new Promise(_0x554e25=>setTimeout(_0x554e25,0x7d0)));const _0x838d56=new Date();let _0x1dabaa=0x0,_0x7bbb3c=_0x838d56[_0x230c2c(0x233)](),_0x401542='';if(_0x3e0714===_0x230c2c(0x1e1)){const _0x18b100=new Date(_0x838d56);_0x18b100[_0x230c2c(0x25c)](_0x18b100[_0x230c2c(0x247)]()-0x1),_0x18b100[_0x230c2c(0x221)](0x16,0x0,0x0,0x0),_0x1dabaa=_0x18b100[_0x230c2c(0x233)]();const _0x454c26=new Date(_0x838d56);_0x454c26['setHours'](0x8,0x0,0x0,0x0),_0x7bbb3c=_0x454c26[_0x230c2c(0x233)](),_0x401542=_0x230c2c(0x229);}else{const _0x4d7e61=new Date(_0x838d56);_0x4d7e61[_0x230c2c(0x221)](0x8,0x0,0x0,0x0),_0x1dabaa=_0x4d7e61['getTime'](),_0x401542=_0x230c2c(0x1c5);}const _0x55f13b=_0x35a41b[_0x230c2c(0x240)][_0x230c2c(0x236)](_0x3edf33=>_0x3edf33[_0x230c2c(0x251)]>=_0x1dabaa&&_0x3edf33[_0x230c2c(0x251)]<=_0x7bbb3c);if(_0x55f13b[_0x230c2c(0x1c3)]===0x0){const _0x1a6f77=_0x3e0714===_0x230c2c(0x1e1)?_0x230c2c(0x205):'Bisher\x20keine\x20AktivitÃ¤t\x20seit\x2008:00\x20Uhr\x20verzeichnet.',_0x537d35=_0x3e0714===_0x230c2c(0x1e1)?_0x230c2c(0x1fd):'analysis.health.geminiDay';await _0x35a41b['setStateAsync'](_0x537d35,{'val':_0x1a6f77,'ack':!![]});return;}const _0x183f10=_0x55f13b[_0x230c2c(0x1f9)](_0xe7f3c=>new Date(_0xe7f3c['timestamp'])[_0x230c2c(0x1d8)]([],{'hour':_0x230c2c(0x1f1),'minute':'2-digit'})+'\x20'+_0xe7f3c[_0x230c2c(0x1e3)]+'\x20('+_0xe7f3c[_0x230c2c(0x21c)]+')')['join']('\x0a'),_0x142ae0=_0x230c2c(0x23c)+_0x401542+_0x230c2c(0x22a)+_0x183f10+_0x230c2c(0x208);try{updateApiTimestamp();const _0x2bdafc=await _0x35a41b[_0x230c2c(0x244)][_0x230c2c(0x214)](_0x142ae0),_0x39d632=_0x2bdafc[_0x230c2c(0x222)]['text'](),_0x172547=_0x3e0714==='NIGHT'?_0x230c2c(0x1fd):_0x230c2c(0x21d);await _0x35a41b[_0x230c2c(0x1de)](_0x172547,{'val':_0x39d632,'ack':!![]}),_0x35a41b[_0x230c2c(0x1cb)][_0x230c2c(0x1e5)]('ðŸ¤–\x20Health\x20Report\x20('+_0x3e0714+_0x230c2c(0x25a));}catch(_0x4344b5){_0x35a41b['log'][_0x230c2c(0x206)](_0x230c2c(0x20a)+_0x4344b5[_0x230c2c(0x20f)]);}}module[a0_0x2038a5(0x220)]={'executeAutomationAction':executeAutomationAction,'createDailyDigest':createDailyDigest,'runBaselineDriftAnalysis':runBaselineDriftAnalysis,'sendMorningBriefing':sendMorningBriefing,'runGeminiAnalysis':runGeminiAnalysis,'consultButler':consultButler,'generateHealthReport':generateHealthReport};