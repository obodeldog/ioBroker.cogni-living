const a0_0x479cdb=a0_0x3c63;(function(_0x43b414,_0x141547){const _0x3ebd76=a0_0x3c63,_0x23cd47=_0x43b414();while(!![]){try{const _0x4cc873=parseInt(_0x3ebd76(0x145))/0x1*(-parseInt(_0x3ebd76(0x1af))/0x2)+-parseInt(_0x3ebd76(0x173))/0x3*(-parseInt(_0x3ebd76(0x136))/0x4)+parseInt(_0x3ebd76(0x16f))/0x5*(parseInt(_0x3ebd76(0x15c))/0x6)+-parseInt(_0x3ebd76(0x183))/0x7+parseInt(_0x3ebd76(0x1d0))/0x8*(-parseInt(_0x3ebd76(0x174))/0x9)+-parseInt(_0x3ebd76(0x190))/0xa*(parseInt(_0x3ebd76(0x13a))/0xb)+-parseInt(_0x3ebd76(0x1a5))/0xc*(-parseInt(_0x3ebd76(0x14b))/0xd);if(_0x4cc873===_0x141547)break;else _0x23cd47['push'](_0x23cd47['shift']());}catch(_0x4cd526){_0x23cd47['push'](_0x23cd47['shift']());}}}(a0_0x2c61,0xc0951));const a0_0x3573a5=(function(){let _0x262bde=!![];return function(_0x43af69,_0x367384){const _0x137faf=_0x262bde?function(){const _0x3de9ec=a0_0x3c63;if(_0x367384){const _0x4a3ee9=_0x367384[_0x3de9ec(0x1c2)](_0x43af69,arguments);return _0x367384=null,_0x4a3ee9;}}:function(){};return _0x262bde=![],_0x137faf;};}()),a0_0x4272f2=a0_0x3573a5(this,function(){const _0x3fbc01=a0_0x3c63;return a0_0x4272f2[_0x3fbc01(0x163)]()[_0x3fbc01(0x165)](_0x3fbc01(0x1b3))[_0x3fbc01(0x163)]()['constructor'](a0_0x4272f2)[_0x3fbc01(0x165)]('(((.+)+)+)+$');});a0_0x4272f2();'use strict';const {GoogleGenerativeAI}=require(a0_0x479cdb(0x1ca)),setup=require(a0_0x479cdb(0x18d)),GEMINI_MODEL=a0_0x479cdb(0x162),LTM_DP_DAILY_DIGESTS=a0_0x479cdb(0x1c7),LTM_DP_STATUS=a0_0x479cdb(0x137),LTM_DP_RAW_LOG='LTM.rawEventLog',LTM_MIN_EVENTS_FOR_COMPRESSION=0x5,MIN_API_GAP_MS=0x4e20;let lastGlobalApiCall=0x0;const decisionCache={},CACHE_TTL_MS=0xf*0x3c*0x3e8,PERSONA_MAPPING={'generic':a0_0x479cdb(0x184),'senior_aal':a0_0x479cdb(0x147),'family':a0_0x479cdb(0x1c3),'single_comfort':'Maximaler\x20Komfort,\x20Energie\x20ist\x20zweitrangig.','security':a0_0x479cdb(0x198),'energy_saver':a0_0x479cdb(0x194)};function canCallApi(){const _0x180bc1=Date['now']();return _0x180bc1-lastGlobalApiCall>MIN_API_GAP_MS;}function updateApiTimestamp(){lastGlobalApiCall=Date['now']();}async function getWeatherContext(_0x56b177){const _0x39469c=a0_0x479cdb;if(!_0x56b177[_0x39469c(0x1cd)][_0x39469c(0x171)]||!_0x56b177[_0x39469c(0x1cd)]['weatherInstance'])return _0x39469c(0x1d1);try{const _0x6232e1=_0x56b177[_0x39469c(0x1cd)][_0x39469c(0x1a6)];let _0x4add04=await _0x56b177['getForeignStateAsync'](_0x6232e1+_0x39469c(0x17d));if(!_0x4add04)_0x4add04=await _0x56b177[_0x39469c(0x179)](_0x6232e1+_0x39469c(0x1c4));let _0x5aafe6=await _0x56b177[_0x39469c(0x179)](_0x6232e1+_0x39469c(0x19a));if(!_0x5aafe6)_0x5aafe6=await _0x56b177[_0x39469c(0x179)](_0x6232e1+'.forecast.current.state');let _0x3eabc6=_0x39469c(0x176);const _0x185829=await _0x56b177['getForeignStateAsync'](_0x6232e1+_0x39469c(0x177));if(_0x185829)_0x3eabc6=_0x185829[_0x39469c(0x16b)]?_0x39469c(0x157):'Tag';if(_0x4add04&&_0x5aafe6)return _0x4add04[_0x39469c(0x16b)]+_0x39469c(0x172)+_0x5aafe6[_0x39469c(0x16b)]+_0x39469c(0x166)+_0x3eabc6;}catch(_0x7a8b12){}return _0x39469c(0x13f);}function a0_0x3c63(_0x552279,_0x58faa0){const _0x6b4441=a0_0x2c61();return a0_0x3c63=function(_0x4272f2,_0x3573a5){_0x4272f2=_0x4272f2-0x136;let _0x2c61f1=_0x6b4441[_0x4272f2];return _0x2c61f1;},a0_0x3c63(_0x552279,_0x58faa0);}function a0_0x2c61(){const _0x551061=['exports','debug','Wetterdaten\x20nicht\x20abrufbar','generic','ðŸ¤–\x20Butler\x20Cache\x20Hit:\x20','Success','ðŸ¤–\x20BUTLER:\x20Executing\x20Action\x20->\x20','toFixed','1PcBcYy','2-digit','PRIORITÃ„T:\x20Sicherheit\x20und\x20Licht.\x20Schalte\x20lieber\x20einmal\x20zu\x20viel\x20als\x20zu\x20wenig.','slice','BUTLER\x20Execution\x20Error:\x20','geminiModel','54400489yiWmLh','parse','ðŸŒ…\x20Starting\x20Morning\x20Briefing\x20sequence\x20(Traffic\x20Check\x20bypassed)...','isEmergency','LTM.driftAnalysis.baselineDrift','rawEventLog','summary','\x0a\x20\x20\x20\x20ROLLE:\x20Medizinischer\x20Assistent\x20fÃ¼r\x20AAL\x20(Ambient\x20Assisted\x20Living).\x0a\x20\x20\x20\x20AUFGABE:\x20','ltmStbWindowDays','ROLLE:\x20KI-Hausverwalter.\x20PERSONA:\x20','livingContext','\x0a\x20\x20\x20\x20ANTWORT-STIL:\x20Sachlich,\x20beruhigend,\x20prÃ¤zise.\x20Keine\x20Floskeln.\x0a\x20\x20\x20\x20','Nacht','ltmLtbWindowDays','Bisher\x20keine\x20AktivitÃ¤t\x20seit\x2008:00\x20Uhr\x20verzeichnet.','setHours','toISOString','6ZxFCgk','ROLLE:\x20Data\x20Scientist.\x20ZIEL:\x20Drift\x20erkennen.\x20SCHEMA:\x20{\x20\x22baselineDrift\x22:\x20\x22none|slight|significant|critical\x22,\x20\x22driftDetails\x22:\x20\x22string\x22\x20}\x0a\x0aLTB:\x20','eventHistory','isAlert','âš ï¸\x20ALARM:\x20','timestamp','models/gemini-flash-latest','toString','now','search',',\x20LichtverhÃ¤ltnisse:\x20','message','Keine\x20Details.','alertReason','analysis.health.geminiDay','val','analysis.analysisHistory','length','join','2469625KWtmvw','activityLevel','useWeather','Â°C,\x20','947811ZZFVlw','936hrWaDU','N/A\x20(Learning)','Unbekannt','.Current.IsNight','analysis.automation.patternDetected','getForeignStateAsync','trim','\x0a\x20\x20\x20\x20EVENTS:\x0a','baselineDrift','.Current.Temperature','ANALYZE_HEALTH','lastAlertState','automationProposal','\x20Ã¼bersprungen\x20(Auto-Approved).','driftDetails','10648617CeOlGq','Entscheide\x20ausgewogen\x20zwischen\x20Komfort\x20und\x20Energie.','\x0aSTB:\x20','description','.\x20AUFGABE:\x201.\x20Gesundheit?\x202.\x20Komfort?\x20FORMAT\x20(JSON):\x20{\x20\x22isAlert\x22:\x20boolean,\x20\x22alertReason\x22:\x20\x22string\x22,\x20\x22isEmergency\x22:\x20boolean,\x20\x22summary\x22:\x20\x22string\x22,\x20\x22automationProposal\x22:\x20{\x20\x22detected\x22:\x20boolean,\x20\x22description\x22:\x20\x22string\x22,\x20\x22targetId\x22:\x20\x22string\x22,\x20\x22targetValue\x22:\x20\x22any\x22\x20}\x20}','NIGHT','\x22.\x0a\x20\x20\x20\x20AKTION:\x20Schalte\x20\x22','filter','analysis.automation.description','analysisHistory','./setup','pop','error','6070BsLkBC','log','Digest','ðŸ¤–\x20Autopilot\x20skipped\x20(Traffic\x20Protection\x20active).','PRIORITÃ„T:\x20Energie\x20sparen.\x20Schalte\x20nur,\x20wenn\x20absolut\x20notwendig\x20(Dunkelheit).','decision','isProVersion','Erstelle\x20ein\x20kurzes\x20\x27Guten\x20Morgen\x27\x20Briefing\x20basierend\x20auf\x20den\x20Events\x20der\x20letzten\x20Nacht.','Sicherheit\x20geht\x20vor.','.\x20EVENTS:\x20','.Current.WeatherText','ROLLE:\x20Data\x20Compression\x20Agent.\x20SPRACHE:\x20DE.\x20FORMAT:\x20JSON.\x20ANWEISUNG:\x20Fasse\x20Sensor-Events\x20zusammen.\x20SCHEMA:\x20{\x20\x22summary\x22:\x20\x22string\x22,\x20\x22activityLevel\x22:\x20\x22string\x22\x20}\x20\x0a\x0aEVENTS:\x0a','\x0a\x20\x20\x20\x20FRAGE:\x20Ist\x20es\x20dunkel\x20genug\x20fÃ¼r\x20Licht?\x0a\x20\x20\x20\x20FORMAT:\x20{\x20\x22approved\x22:\x20boolean,\x20\x22reason\x22:\x20\x22kurzer\x20Grund\x22\x20}\x0a\x20\x20\x20\x20','normal','currentSystemMode','replace','\x20->\x20','ðŸ¤–\x20Traffic\x20Schutz:\x20Anfrage\x20fÃ¼r\x20','Started...','aiPersona','setStateAsync','12fLKgyb','weatherInstance','setForeignStateAsync','toLocaleTimeString','LTM.driftAnalysis.driftDetails','system.presenceWho','.\x20EMERGENCY:\x20','text','info','response','2443102glmZUm','ðŸ¤–\x20Health\x20Report\x20(','dailyDigests','targetValue','(((.+)+)+)+$','Gemini\x20Error:\x20','analysis.automation.autoApply','ðŸ“…\x20Daily\x20Digest:\x0a','LTM.driftAnalysis.lastCheck','getTime','Keine\x20Daten\x20fÃ¼r\x20die\x20Nacht\x20aufgezeichnet\x20(Sensoren\x20ruhig).','Briefing\x20Error:\x20','splice',',\x20Wetter:\x20','analysis.lastResult',')\x20generated.',').\x20Sending\x20notification...','stringify','analysis.health.geminiNight','apply','Fokus\x20auf\x20Komfort\x20fÃ¼r\x20die\x20Familie.','.forecast.current.temperature','\x0aAktivitÃ¤t:\x20','Analysiere\x20diese\x20Events\x20des\x20TAGES\x20(08:00-Jetzt).\x20AktivitÃ¤t?\x20Mahlzeiten?\x20HaustÃ¼r?\x20Antwort\x20kurz\x20fÃ¼r\x20den\x20besorgten\x20Sohn\x20(max\x202\x20SÃ¤tze).','LTM.dailyDigests','getStateAsync','value','@google/generative-ai','reason','KI-Fehler\x20(Fallback)','config','ðŸ¤–\x20BUTLER:\x20No\x20valid\x20target\x20ID\x20or\x20value\x20stored\x20for\x20execution.','analysis.alertReason','65792gwQbkr','Unbekannt\x20(Kein\x20Sensor)','unshift','warn','ðŸŒ…\x20Morning\x20Briefing:\x0a','sendNotification','generateContent','ðŸ¤–\x20Butler\x20Brain\x20Error:\x20','12EhONoG','LTM.processingStatus','\x22\x20AN.\x0a\x20\x20\x20\x20STRATEGIE:\x20','analysis.automation.targetValue','22462wFCapD','ðŸ¤–\x20API\x20Cooldown.\x20Waiting\x202s...','.\x0a\x20\x20\x20\x20EVENT:\x20Bewohner\x20geht\x20wahrscheinlich\x20('];a0_0x2c61=function(){return _0x551061;};return a0_0x2c61();}async function consultButler(_0x3ba165,_0x5c67d7,_0x339af3,_0x2204e1){const _0x58a570=a0_0x479cdb;if(!_0x3ba165[_0x58a570(0x14a)])return{'approved':!![],'reason':'KI\x20offline\x20(Fallback)'};const _0x3f7d29=Date[_0x58a570(0x164)]();if(decisionCache[_0x5c67d7]&&_0x3f7d29-decisionCache[_0x5c67d7][_0x58a570(0x161)]<CACHE_TTL_MS){const _0x54bf1d=decisionCache[_0x5c67d7][_0x58a570(0x195)];return _0x3ba165[_0x58a570(0x191)][_0x58a570(0x13e)](_0x58a570(0x141)+_0x5c67d7+_0x58a570(0x1a0)+(_0x54bf1d['approved']?'OK':'NO')+'\x20('+_0x54bf1d[_0x58a570(0x1cb)]+')'),_0x54bf1d;}if(!canCallApi())return _0x3ba165[_0x58a570(0x191)][_0x58a570(0x13e)](_0x58a570(0x1a1)+_0x5c67d7+_0x58a570(0x181)),{'approved':!![],'reason':'Traffic-Schutz\x20(Auto-Approved)'};const _0x34571d=new Date()[_0x58a570(0x1a8)](),_0x315cfd=await getWeatherContext(_0x3ba165),_0x444099=PERSONA_MAPPING[_0x3ba165[_0x58a570(0x1cd)][_0x58a570(0x1a3)]||_0x58a570(0x140)],_0x23717b='\x0a\x20\x20\x20\x20ROLLE:\x20Haus-Butler.\x0a\x20\x20\x20\x20SITUATION:\x20'+_0x34571d+_0x58a570(0x1bc)+_0x315cfd+_0x58a570(0x13c)+(_0x2204e1*0x64)[_0x58a570(0x144)](0x0)+'%)\x20nach\x20\x22'+_0x5c67d7+_0x58a570(0x189)+_0x339af3+_0x58a570(0x138)+_0x444099+_0x58a570(0x19c);try{updateApiTimestamp();const _0x113f9d=await _0x3ba165['geminiModel'][_0x58a570(0x1d6)](_0x23717b),_0x4ab6f9=_0x113f9d[_0x58a570(0x1ae)][_0x58a570(0x1ac)]()['replace'](/```json|```/g,'')[_0x58a570(0x17a)](),_0x343f63=JSON['parse'](_0x4ab6f9);return decisionCache[_0x5c67d7]={'decision':_0x343f63,'timestamp':_0x3f7d29},_0x343f63;}catch(_0xb9faac){return _0x3ba165[_0x58a570(0x191)]['warn'](_0x58a570(0x1d7)+_0xb9faac['message']),decisionCache[_0x5c67d7]={'decision':{'approved':!![],'reason':_0x58a570(0x1cc)},'timestamp':_0x3f7d29-(CACHE_TTL_MS-0xea60)},{'approved':!![],'reason':_0x58a570(0x1cc)};}}async function runGeminiAnalysis(_0x593e55,_0x327bb5=''){const _0xdf5253=a0_0x479cdb;if(!_0x593e55['geminiModel'])return;if(!canCallApi()){_0x593e55[_0xdf5253(0x191)][_0xdf5253(0x13e)](_0xdf5253(0x193));return;}if(_0x593e55[_0xdf5253(0x15e)][_0xdf5253(0x16d)]===0x0)return;const _0x3c51e3=_0x593e55[_0xdf5253(0x15e)][_0xdf5253(0x148)](0x0,0xf),_0x686c2d=_0x593e55['currentSystemMode'],_0x4bb634=PERSONA_MAPPING[_0x593e55['config'][_0xdf5253(0x1a3)]||_0xdf5253(0x140)],_0x8c982e=_0x593e55[_0xdf5253(0x1cd)][_0xdf5253(0x155)]||_0xdf5253(0x168);let _0x48712a=_0xdf5253(0x176);try{const _0x168efc=await _0x593e55[_0xdf5253(0x1c8)](_0xdf5253(0x1aa));if(_0x168efc&&_0x168efc[_0xdf5253(0x16b)])_0x48712a=_0x168efc['val'];}catch(_0x5ec467){}let _0x448138=![];try{const _0x13488e=await _0x593e55['getStateAsync'](_0xdf5253(0x1b5));if(_0x13488e&&_0x13488e[_0xdf5253(0x16b)])_0x448138=!![];}catch(_0x546869){}const _0x1ea038=_0xdf5253(0x154)+_0x4bb634+'.\x20KONTEXT:\x20'+_0x8c982e+'.\x20SYSTEM_MODE:\x20'+_0x686c2d+'.\x20ANWESEND:\x20'+_0x48712a+_0xdf5253(0x199)+JSON[_0xdf5253(0x1c0)](_0x3c51e3)+_0xdf5253(0x1ab)+_0x327bb5+_0xdf5253(0x187);try{updateApiTimestamp();const _0x4d6370=await _0x593e55[_0xdf5253(0x14a)][_0xdf5253(0x1d6)](_0x1ea038),_0x343f28=JSON[_0xdf5253(0x14c)](_0x4d6370[_0xdf5253(0x1ae)][_0xdf5253(0x1ac)]()[_0xdf5253(0x19f)](/```json|```/g,'')[_0xdf5253(0x17a)]());await _0x593e55[_0xdf5253(0x1a4)](_0xdf5253(0x1bd),{'val':JSON[_0xdf5253(0x1c0)](_0x343f28),'ack':!![]});if(_0x343f28[_0xdf5253(0x151)])await _0x593e55[_0xdf5253(0x1a4)]('analysis.activitySummary',{'val':_0x343f28[_0xdf5253(0x151)],'ack':!![]});const _0x3aadb5={'timestamp':Date[_0xdf5253(0x164)](),'id':Date['now']()[_0xdf5253(0x163)](),'analysis':{'activity':{'summary':_0x343f28[_0xdf5253(0x151)],'isAlert':_0x343f28['isAlert'],'alertReason':_0x343f28['alertReason']},'comfort':{'automationProposal':_0x343f28[_0xdf5253(0x180)]}}};_0x593e55[_0xdf5253(0x18c)][_0xdf5253(0x1d2)](_0x3aadb5);if(_0x593e55['analysisHistory'][_0xdf5253(0x16d)]>0x32)_0x593e55[_0xdf5253(0x18c)][_0xdf5253(0x18e)]();await _0x593e55[_0xdf5253(0x1a4)](_0xdf5253(0x16c),{'val':JSON[_0xdf5253(0x1c0)](_0x593e55[_0xdf5253(0x18c)]),'ack':!![]});const _0x1199ed=_0x343f28[_0xdf5253(0x15f)]||![];_0x1199ed!==_0x593e55[_0xdf5253(0x17f)]&&(await _0x593e55[_0xdf5253(0x1a4)]('analysis.isAlert',{'val':_0x1199ed,'ack':!![]}),_0x593e55[_0xdf5253(0x17f)]=_0x1199ed,_0x1199ed&&(await _0x593e55[_0xdf5253(0x1a4)](_0xdf5253(0x1cf),{'val':_0x343f28['alertReason'],'ack':!![]}),setup[_0xdf5253(0x1d5)](_0x593e55,_0xdf5253(0x160)+_0x343f28[_0xdf5253(0x169)],![],_0x343f28[_0xdf5253(0x14e)])));if(_0x343f28[_0xdf5253(0x180)]&&_0x343f28[_0xdf5253(0x180)]['detected']){await _0x593e55[_0xdf5253(0x1a4)](_0xdf5253(0x178),{'val':!![],'ack':!![]}),await _0x593e55[_0xdf5253(0x1a4)](_0xdf5253(0x18b),{'val':_0x343f28[_0xdf5253(0x180)][_0xdf5253(0x186)],'ack':!![]}),await _0x593e55[_0xdf5253(0x1a4)]('analysis.automation.targetId',{'val':_0x343f28[_0xdf5253(0x180)]['targetId'],'ack':!![]}),await _0x593e55[_0xdf5253(0x1a4)](_0xdf5253(0x139),{'val':JSON['stringify'](_0x343f28['automationProposal'][_0xdf5253(0x1b2)]),'ack':!![]});if(_0x448138)executeAutomationAction(_0x593e55);}}catch(_0x1bebde){_0x593e55[_0xdf5253(0x191)]['error'](_0xdf5253(0x1b4)+_0x1bebde[_0xdf5253(0x167)]);}}async function createDailyDigest(_0x59df3a,_0x4fad12){const _0x22e4dd=a0_0x479cdb;if(!_0x59df3a[_0x22e4dd(0x196)])return;if(!canCallApi()){await _0x59df3a['setStateAsync'](LTM_DP_STATUS,{'val':'Skipped\x20(Traffic)','ack':!![]});return;}await _0x59df3a[_0x22e4dd(0x1a4)](LTM_DP_STATUS,{'val':_0x22e4dd(0x1a2),'ack':!![]});if(!_0x59df3a[_0x22e4dd(0x14a)]||_0x59df3a[_0x22e4dd(0x150)][_0x22e4dd(0x16d)]<LTM_MIN_EVENTS_FOR_COMPRESSION){await _0x59df3a['setStateAsync'](LTM_DP_STATUS,{'val':'Skipped\x20(No\x20AI\x20or\x20Data)','ack':!![]});return;}const _0xc9ccad=JSON[_0x22e4dd(0x14c)](JSON[_0x22e4dd(0x1c0)](_0x59df3a[_0x22e4dd(0x150)])),_0x158e9c=_0xc9ccad['length'],_0x44e914=_0x22e4dd(0x19b)+JSON[_0x22e4dd(0x1c0)](_0xc9ccad);try{updateApiTimestamp();const _0x5f30d9=await _0x59df3a[_0x22e4dd(0x14a)][_0x22e4dd(0x1d6)](_0x44e914),_0x56c64e=JSON[_0x22e4dd(0x14c)](_0x5f30d9[_0x22e4dd(0x1ae)][_0x22e4dd(0x1ac)]()['replace'](/```json|```/g,'')[_0x22e4dd(0x17a)]()),_0x44b717={'timestamp':new Date()[_0x22e4dd(0x15b)](),'eventCount':_0x158e9c,'summary':_0x56c64e[_0x22e4dd(0x151)]||_0x22e4dd(0x192),'activityLevel':_0x56c64e['activityLevel']||_0x22e4dd(0x19d),'systemMode':_0x59df3a[_0x22e4dd(0x19e)]};_0x59df3a[_0x22e4dd(0x1b1)]['push'](_0x44b717);const _0x3b9d5f=_0x59df3a[_0x22e4dd(0x1cd)][_0x22e4dd(0x158)]||0x3c;_0x59df3a['dailyDigests'][_0x22e4dd(0x16d)]>_0x3b9d5f&&_0x59df3a[_0x22e4dd(0x1b1)][_0x22e4dd(0x1bb)](0x0,_0x59df3a[_0x22e4dd(0x1b1)][_0x22e4dd(0x16d)]-_0x3b9d5f);await _0x59df3a['setStateAsync'](LTM_DP_DAILY_DIGESTS,{'val':JSON['stringify'](_0x59df3a[_0x22e4dd(0x1b1)]),'ack':!![]}),_0x59df3a['rawEventLog']=[],await _0x59df3a['setStateAsync'](LTM_DP_RAW_LOG,{'val':JSON['stringify'](_0x59df3a[_0x22e4dd(0x150)]),'ack':!![]}),await _0x59df3a[_0x22e4dd(0x1a4)](LTM_DP_STATUS,{'val':_0x22e4dd(0x142),'ack':!![]});const _0x3e194b=_0x22e4dd(0x1b6)+_0x56c64e[_0x22e4dd(0x151)]+_0x22e4dd(0x1c5)+_0x56c64e[_0x22e4dd(0x170)];setup['sendNotification'](_0x59df3a,_0x3e194b,![],![]);if(_0x59df3a[_0x22e4dd(0x196)]&&_0x4fad12)_0x4fad12['send'](_0x59df3a,_0x22e4dd(0x17e),{'digest':_0x44b717});}catch(_0x12e68a){_0x59df3a[_0x22e4dd(0x191)]['error'](_0x12e68a[_0x22e4dd(0x167)]);}}async function runBaselineDriftAnalysis(_0x57e0c2){const _0x11ad40=a0_0x479cdb;if(!_0x57e0c2['isProVersion']||!_0x57e0c2[_0x11ad40(0x14a)])return;if(!canCallApi())return;const _0x987aaa=_0x57e0c2[_0x11ad40(0x1cd)][_0x11ad40(0x153)]||0xe;if(_0x57e0c2['dailyDigests'][_0x11ad40(0x16d)]<_0x987aaa+0x7){await _0x57e0c2[_0x11ad40(0x1a4)](_0x11ad40(0x14f),{'val':_0x11ad40(0x175),'ack':!![]});return;}const _0x57cecd=_0x57e0c2[_0x11ad40(0x1b1)][_0x11ad40(0x148)](-_0x987aaa),_0x186ec6=_0x57e0c2[_0x11ad40(0x1b1)][_0x11ad40(0x148)](0x0,_0x57e0c2[_0x11ad40(0x1b1)]['length']-_0x987aaa),_0x17594c=_0x11ad40(0x15d)+JSON[_0x11ad40(0x1c0)](_0x186ec6)+_0x11ad40(0x185)+JSON[_0x11ad40(0x1c0)](_0x57cecd);try{updateApiTimestamp();const _0x321289=await _0x57e0c2[_0x11ad40(0x14a)][_0x11ad40(0x1d6)](_0x17594c),_0x2c357d=JSON[_0x11ad40(0x14c)](_0x321289[_0x11ad40(0x1ae)][_0x11ad40(0x1ac)]()[_0x11ad40(0x19f)](/```json|```/g,'')[_0x11ad40(0x17a)]());_0x2c357d[_0x11ad40(0x17c)]&&(await _0x57e0c2[_0x11ad40(0x1a4)](_0x11ad40(0x14f),{'val':_0x2c357d['baselineDrift'],'ack':!![]}),await _0x57e0c2['setStateAsync'](_0x11ad40(0x1a9),{'val':_0x2c357d[_0x11ad40(0x182)],'ack':!![]}),await _0x57e0c2[_0x11ad40(0x1a4)](_0x11ad40(0x1b7),{'val':Date[_0x11ad40(0x164)](),'ack':!![]}));}catch(_0x344ca7){}}async function executeAutomationAction(_0x5a0504){const _0x132200=a0_0x479cdb;try{const _0x3db25c=await _0x5a0504[_0x132200(0x1c8)]('analysis.automation.targetId'),_0x8130af=await _0x5a0504['getStateAsync'](_0x132200(0x139));if(_0x3db25c&&_0x3db25c[_0x132200(0x16b)]&&_0x8130af){const _0x4645a4=_0x3db25c[_0x132200(0x16b)];let _0x41ec65=_0x8130af['val'];try{_0x41ec65=JSON[_0x132200(0x14c)](_0x41ec65);}catch(_0x3ca485){}_0x5a0504['log'][_0x132200(0x1ad)](_0x132200(0x143)+_0x4645a4+'\x20=\x20'+_0x41ec65),await _0x5a0504[_0x132200(0x1a7)](_0x4645a4,_0x41ec65);}else _0x5a0504['log'][_0x132200(0x1d3)](_0x132200(0x1ce));}catch(_0x369248){_0x5a0504['log'][_0x132200(0x18f)](_0x132200(0x149)+_0x369248[_0x132200(0x167)]);}}async function sendMorningBriefing(_0x492cac){const _0xecb170=a0_0x479cdb;if(!_0x492cac['geminiModel']){_0x492cac[_0xecb170(0x191)][_0xecb170(0x1d3)]('ðŸ¤–\x20Morning\x20Briefing\x20skipped:\x20No\x20Gemini\x20Model.');return;}_0x492cac['log'][_0xecb170(0x1ad)](_0xecb170(0x14d));try{updateApiTimestamp();const _0x3dcdd9=_0xecb170(0x197),_0x393494=await _0x492cac[_0xecb170(0x14a)][_0xecb170(0x1d6)](_0x3dcdd9),_0x1ce2d1=_0x393494[_0xecb170(0x1ae)][_0xecb170(0x1ac)]();_0x492cac['log'][_0xecb170(0x1ad)]('ðŸŒ…\x20Briefing\x20generated\x20(Length:\x20'+_0x1ce2d1[_0xecb170(0x16d)]+_0xecb170(0x1bf)),setup['sendNotification'](_0x492cac,_0xecb170(0x1d4)+_0x1ce2d1);}catch(_0x527a42){_0x492cac['log']['error'](_0xecb170(0x1ba)+_0x527a42[_0xecb170(0x167)]);}}async function generateHealthReport(_0x200972,_0xc5f489){const _0x186f2e=a0_0x479cdb;if(!_0x200972[_0x186f2e(0x14a)])return;const _0x233295=Date['now']();_0x233295-lastGlobalApiCall<0xbb8&&(_0x200972['log']['debug'](_0x186f2e(0x13b)),await new Promise(_0x45fd4f=>setTimeout(_0x45fd4f,0x7d0)));const _0x5e520e=new Date();let _0x357091=0x0,_0x3aaf0c=_0x5e520e[_0x186f2e(0x1b8)](),_0x44faf6='';if(_0xc5f489===_0x186f2e(0x188)){const _0x1f5bfa=new Date(_0x5e520e);_0x1f5bfa['setDate'](_0x1f5bfa['getDate']()-0x1),_0x1f5bfa[_0x186f2e(0x15a)](0x16,0x0,0x0,0x0),_0x357091=_0x1f5bfa[_0x186f2e(0x1b8)]();const _0x4baace=new Date(_0x5e520e);_0x4baace[_0x186f2e(0x15a)](0x8,0x0,0x0,0x0),_0x3aaf0c=_0x4baace[_0x186f2e(0x1b8)](),_0x44faf6='Analysiere\x20diese\x20Events\x20der\x20NACHT\x20(22:00-08:00).\x20War\x20der\x20Schlaf\x20ruhig?\x20Gab\x20es\x20BadgÃ¤nge?\x20Antwort\x20kurz\x20fÃ¼r\x20den\x20besorgten\x20Sohn\x20(max\x202\x20SÃ¤tze).';}else{const _0x3b5865=new Date(_0x5e520e);_0x3b5865[_0x186f2e(0x15a)](0x8,0x0,0x0,0x0),_0x357091=_0x3b5865[_0x186f2e(0x1b8)](),_0x44faf6=_0x186f2e(0x1c6);}const _0x585d53=_0x200972[_0x186f2e(0x15e)][_0x186f2e(0x18a)](_0x3b38e7=>_0x3b38e7[_0x186f2e(0x161)]>=_0x357091&&_0x3b38e7[_0x186f2e(0x161)]<=_0x3aaf0c);if(_0x585d53[_0x186f2e(0x16d)]===0x0){const _0x202a91=_0xc5f489===_0x186f2e(0x188)?_0x186f2e(0x1b9):_0x186f2e(0x159),_0x5791a8=_0xc5f489===_0x186f2e(0x188)?_0x186f2e(0x1c1):_0x186f2e(0x16a);await _0x200972[_0x186f2e(0x1a4)](_0x5791a8,{'val':_0x202a91,'ack':!![]});return;}const _0x5ebdc7=_0x585d53['map'](_0x4edcdf=>new Date(_0x4edcdf['timestamp'])['toLocaleTimeString']([],{'hour':'2-digit','minute':_0x186f2e(0x146)})+'\x20'+_0x4edcdf['name']+'\x20('+_0x4edcdf[_0x186f2e(0x1c9)]+')')[_0x186f2e(0x16e)]('\x0a'),_0x810400=_0x186f2e(0x152)+_0x44faf6+_0x186f2e(0x17b)+_0x5ebdc7+_0x186f2e(0x156);try{updateApiTimestamp();const _0x4683d6=await _0x200972[_0x186f2e(0x14a)][_0x186f2e(0x1d6)](_0x810400),_0x404547=_0x4683d6[_0x186f2e(0x1ae)]['text'](),_0x22a957=_0xc5f489===_0x186f2e(0x188)?_0x186f2e(0x1c1):_0x186f2e(0x16a);await _0x200972['setStateAsync'](_0x22a957,{'val':_0x404547,'ack':!![]}),_0x200972[_0x186f2e(0x191)][_0x186f2e(0x1ad)](_0x186f2e(0x1b0)+_0xc5f489+_0x186f2e(0x1be));}catch(_0xefd70f){_0x200972['log']['error']('Health\x20Report\x20Error:\x20'+_0xefd70f['message']);}}module[a0_0x479cdb(0x13d)]={'executeAutomationAction':executeAutomationAction,'createDailyDigest':createDailyDigest,'runBaselineDriftAnalysis':runBaselineDriftAnalysis,'sendMorningBriefing':sendMorningBriefing,'runGeminiAnalysis':runGeminiAnalysis,'consultButler':consultButler,'generateHealthReport':generateHealthReport};