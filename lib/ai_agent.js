const a0_0x103e1b=a0_0x29d2;function a0_0x29d2(_0x2c5787,_0x491873){const _0x44b05e=a0_0x101a();return a0_0x29d2=function(_0x237d4b,_0x2bdca5){_0x237d4b=_0x237d4b-0x16c;let _0x101a62=_0x44b05e[_0x237d4b];return _0x101a62;},a0_0x29d2(_0x2c5787,_0x491873);}(function(_0x376826,_0x163750){const _0x457d30=a0_0x29d2,_0x1ea04f=_0x376826();while(!![]){try{const _0x5b3380=parseInt(_0x457d30(0x19f))/0x1+parseInt(_0x457d30(0x1df))/0x2*(parseInt(_0x457d30(0x17e))/0x3)+parseInt(_0x457d30(0x1b5))/0x4*(-parseInt(_0x457d30(0x18c))/0x5)+parseInt(_0x457d30(0x1eb))/0x6*(parseInt(_0x457d30(0x20c))/0x7)+-parseInt(_0x457d30(0x16d))/0x8+-parseInt(_0x457d30(0x1db))/0x9*(-parseInt(_0x457d30(0x20b))/0xa)+parseInt(_0x457d30(0x200))/0xb*(-parseInt(_0x457d30(0x1a4))/0xc);if(_0x5b3380===_0x163750)break;else _0x1ea04f['push'](_0x1ea04f['shift']());}catch(_0x26a3db){_0x1ea04f['push'](_0x1ea04f['shift']());}}}(a0_0x101a,0x80e07));const a0_0x2bdca5=(function(){let _0x3b17be=!![];return function(_0x392d5b,_0x36ce09){const _0x2bcfce=_0x3b17be?function(){const _0x45b841=a0_0x29d2;if(_0x36ce09){const _0x32ec7b=_0x36ce09[_0x45b841(0x205)](_0x392d5b,arguments);return _0x36ce09=null,_0x32ec7b;}}:function(){};return _0x3b17be=![],_0x2bcfce;};}()),a0_0x237d4b=a0_0x2bdca5(this,function(){const _0x4e6202=a0_0x29d2;return a0_0x237d4b['toString']()[_0x4e6202(0x1d3)](_0x4e6202(0x1cf))[_0x4e6202(0x1e9)]()[_0x4e6202(0x1ca)](a0_0x237d4b)[_0x4e6202(0x1d3)](_0x4e6202(0x1cf));});a0_0x237d4b();'use strict';function a0_0x101a(){const _0x31099a=['length','setHours','analysisHistory','45KsDQMX','debug','ðŸ¤–\x20API\x20Cooldown.\x20Waiting\x202s...','Gemini\x20Error:\x20','699060nvFXPO','join','analysis.automation.targetId','toFixed','N/A\x20(Learning)','isAlert','text','val','\x20=\x20','toLocaleTimeString','toString','LTM.dailyDigests','341958tjUtnj','warn','analysis.health.geminiNight','Nacht','LTM.driftAnalysis.driftDetails','\x0a\x20\x20\x20\x20FRAGE:\x20Ist\x20es\x20dunkel\x20genug\x20fÃ¼r\x20Licht?\x0a\x20\x20\x20\x20FORMAT:\x20{\x20\x22approved\x22:\x20boolean,\x20\x22reason\x22:\x20\x22kurzer\x20Grund\x22\x20}\x0a\x20\x20\x20\x20','LTM.rawEventLog','driftDetails','pop','slice','getTime','analysis.automation.autoApply','.Current.IsNight','Erstelle\x20ein\x20kurzes\x20\x27Guten\x20Morgen\x27\x20Briefing\x20basierend\x20auf\x20den\x20Events\x20der\x20letzten\x20Nacht.','decision','Maximaler\x20Komfort,\x20Energie\x20ist\x20zweitrangig.','currentSystemMode','.\x20EMERGENCY:\x20','\x0aAktivitÃ¤t:\x20','isProVersion','summary','26158byKjNb','./setup','stringify','system.presenceWho','ANALYZE_HEALTH','apply','analysis.activitySummary','Sicherheit\x20geht\x20vor.','2-digit','trim','\x22.\x0a\x20\x20\x20\x20AKTION:\x20Schalte\x20\x22','2107930ZJKsPo','77uXzqBp','Tag','PRIORITÃ„T:\x20Energie\x20sparen.\x20Schalte\x20nur,\x20wenn\x20absolut\x20notwendig\x20(Dunkelheit).','setForeignStateAsync','\x0a\x20\x20\x20\x20ROLLE:\x20Haus-Butler.\x0a\x20\x20\x20\x20SITUATION:\x20','NIGHT','info','.Current.Temperature','Skipped\x20(Traffic)','activityLevel','baselineDrift','Bisher\x20keine\x20AktivitÃ¤t\x20seit\x2008:00\x20Uhr\x20verzeichnet.','7345320gQhpqF','aiPersona','error','PRIORITÃ„T:\x20Sicherheit\x20und\x20Licht.\x20Schalte\x20lieber\x20einmal\x20zu\x20viel\x20als\x20zu\x20wenig.','eventHistory','ðŸ¤–\x20Morning\x20Briefing\x20skipped:\x20No\x20Gemini\x20Model.','analysis.alertReason','\x0aSTB:\x20','\x0a\x20\x20\x20\x20ROLLE:\x20Medizinischer\x20Assistent\x20fÃ¼r\x20AAL\x20(Ambient\x20Assisted\x20Living).\x0a\x20\x20\x20\x20AUFGABE:\x20','LTM.processingStatus','ROLLE:\x20Data\x20Compression\x20Agent.\x20SPRACHE:\x20DE.\x20FORMAT:\x20JSON.\x20ANWEISUNG:\x20Fasse\x20Sensor-Events\x20zusammen.\x20SCHEMA:\x20{\x20\x22summary\x22:\x20\x22string\x22,\x20\x22activityLevel\x22:\x20\x22string\x22\x20}\x20\x0a\x0aEVENTS:\x0a','message','analysis.automation.description','ROLLE:\x20KI-Hausverwalter.\x20PERSONA:\x20','isEmergency','name','.\x20AUFGABE:\x201.\x20Gesundheit?\x202.\x20Komfort?\x20FORMAT\x20(JSON):\x20{\x20\x22isAlert\x22:\x20boolean,\x20\x22alertReason\x22:\x20\x22string\x22,\x20\x22isEmergency\x22:\x20boolean,\x20\x22summary\x22:\x20\x22string\x22,\x20\x22automationProposal\x22:\x20{\x20\x22detected\x22:\x20boolean,\x20\x22description\x22:\x20\x22string\x22,\x20\x22targetId\x22:\x20\x22string\x22,\x20\x22targetValue\x22:\x20\x22any\x22\x20}\x20}','3IKFnxb','analysis.analysisHistory','ðŸ¤–\x20Traffic\x20Schutz:\x20Anfrage\x20fÃ¼r\x20','dailyDigests','Analysiere\x20diese\x20Events\x20der\x20NACHT\x20(22:00-08:00).\x20War\x20der\x20Schlaf\x20ruhig?\x20Gab\x20es\x20BadgÃ¤nge?\x20Antwort\x20kurz\x20fÃ¼r\x20den\x20besorgten\x20Sohn\x20(max\x202\x20SÃ¤tze).','detected','models/gemini-flash-latest','Started...','Traffic-Schutz\x20(Auto-Approved)','Â°C,\x20','ðŸ¤–\x20BUTLER:\x20Executing\x20Action\x20->\x20',').\x20Sending\x20notification...','.\x20EVENTS:\x20','livingContext','461885eNUzET','BUTLER\x20Execution\x20Error:\x20','setDate','\x20Ã¼bersprungen\x20(Auto-Approved).','toISOString','normal','Entscheide\x20ausgewogen\x20zwischen\x20Komfort\x20und\x20Energie.','analysis.isAlert','\x0a\x20\x20\x20\x20EVENTS:\x0a','ltmLtbWindowDays','targetValue','Keine\x20Details.','send','filter','Skipped\x20(No\x20AI\x20or\x20Data)','getForeignStateAsync','ðŸ¤–\x20BUTLER:\x20No\x20valid\x20target\x20ID\x20or\x20value\x20stored\x20for\x20execution.','generic','Briefing\x20Error:\x20','882487PxlrcC','%)\x20nach\x20\x22','map','LTM.driftAnalysis.baselineDrift','geminiModel','6936IMvfQr','Unbekannt\x20(Kein\x20Sensor)','ðŸŒ…\x20Starting\x20Morning\x20Briefing\x20sequence\x20(Traffic\x20Check\x20bypassed)...','now','analysis.automation.targetValue','KI\x20offline\x20(Fallback)','value','ltmStbWindowDays','reason','setStateAsync','ðŸ¤–\x20Autopilot\x20skipped\x20(Traffic\x20Protection\x20active).','ðŸ¤–\x20Butler\x20Brain\x20Error:\x20','sendNotification','automationProposal','useWeather','config','Wetterdaten\x20nicht\x20abrufbar','4NioEWq',',\x20LichtverhÃ¤ltnisse:\x20','description','\x20->\x20','\x0a\x20\x20\x20\x20ANTWORT-STIL:\x20Sachlich,\x20beruhigend,\x20prÃ¤zise.\x20Keine\x20Floskeln.\x0a\x20\x20\x20\x20',',\x20Wetter:\x20','getStateAsync','timestamp','ROLLE:\x20Data\x20Scientist.\x20ZIEL:\x20Drift\x20erkennen.\x20SCHEMA:\x20{\x20\x22baselineDrift\x22:\x20\x22none|slight|significant|critical\x22,\x20\x22driftDetails\x22:\x20\x22string\x22\x20}\x0a\x0aLTB:\x20','weatherInstance','âš ï¸\x20ALARM:\x20','replace','Health\x20Report\x20Error:\x20','.forecast.current.temperature','LTM.driftAnalysis.lastCheck','analysis.health.geminiDay','KI-Fehler\x20(Fallback)','.\x20SYSTEM_MODE:\x20','response',')\x20generated.','ðŸŒ…\x20Briefing\x20generated\x20(Length:\x20','constructor','getDate','Analysiere\x20diese\x20Events\x20des\x20TAGES\x20(08:00-Jetzt).\x20AktivitÃ¤t?\x20Mahlzeiten?\x20HaustÃ¼r?\x20Antwort\x20kurz\x20fÃ¼r\x20den\x20besorgten\x20Sohn\x20(max\x202\x20SÃ¤tze).','ðŸ¤–\x20Butler\x20Cache\x20Hit:\x20','alertReason','(((.+)+)+)+$','generateContent','lastAlertState','log','search','analysis.automation.patternDetected','.Current.WeatherText','parse','rawEventLog'];a0_0x101a=function(){return _0x31099a;};return a0_0x101a();}const {GoogleGenerativeAI}=require('@google/generative-ai'),setup=require(a0_0x103e1b(0x201)),GEMINI_MODEL=a0_0x103e1b(0x184),LTM_DP_DAILY_DIGESTS=a0_0x103e1b(0x1ea),LTM_DP_STATUS=a0_0x103e1b(0x176),LTM_DP_RAW_LOG=a0_0x103e1b(0x1f1),LTM_MIN_EVENTS_FOR_COMPRESSION=0x5,MIN_API_GAP_MS=0x4e20;let lastGlobalApiCall=0x0;const decisionCache={},CACHE_TTL_MS=0xf*0x3c*0x3e8,PERSONA_MAPPING={'generic':a0_0x103e1b(0x192),'senior_aal':a0_0x103e1b(0x170),'family':'Fokus\x20auf\x20Komfort\x20fÃ¼r\x20die\x20Familie.','single_comfort':a0_0x103e1b(0x1fa),'security':a0_0x103e1b(0x207),'energy_saver':a0_0x103e1b(0x20e)};function canCallApi(){const _0x305559=a0_0x103e1b,_0x5cd0f2=Date[_0x305559(0x1a7)]();return _0x5cd0f2-lastGlobalApiCall>MIN_API_GAP_MS;}function updateApiTimestamp(){lastGlobalApiCall=Date['now']();}async function getWeatherContext(_0x252912){const _0x39f01d=a0_0x103e1b;if(!_0x252912[_0x39f01d(0x1b3)][_0x39f01d(0x1b2)]||!_0x252912[_0x39f01d(0x1b3)][_0x39f01d(0x1be)])return _0x39f01d(0x1a5);try{const _0x2361e5=_0x252912[_0x39f01d(0x1b3)][_0x39f01d(0x1be)];let _0x350802=await _0x252912['getForeignStateAsync'](_0x2361e5+_0x39f01d(0x213));if(!_0x350802)_0x350802=await _0x252912[_0x39f01d(0x19b)](_0x2361e5+_0x39f01d(0x1c2));let _0x1c96c8=await _0x252912[_0x39f01d(0x19b)](_0x2361e5+_0x39f01d(0x1d5));if(!_0x1c96c8)_0x1c96c8=await _0x252912[_0x39f01d(0x19b)](_0x2361e5+'.forecast.current.state');let _0x4823af='Unbekannt';const _0x8c5286=await _0x252912[_0x39f01d(0x19b)](_0x2361e5+_0x39f01d(0x1f7));if(_0x8c5286)_0x4823af=_0x8c5286[_0x39f01d(0x1e6)]?_0x39f01d(0x1ee):_0x39f01d(0x20d);if(_0x350802&&_0x1c96c8)return _0x350802['val']+_0x39f01d(0x187)+_0x1c96c8[_0x39f01d(0x1e6)]+_0x39f01d(0x1b6)+_0x4823af;}catch(_0x5418f8){}return _0x39f01d(0x1b4);}async function consultButler(_0xb34af9,_0xef3fc9,_0x3b7e33,_0x40ea5a){const _0x28bbe0=a0_0x103e1b;if(!_0xb34af9[_0x28bbe0(0x1a3)])return{'approved':!![],'reason':_0x28bbe0(0x1a9)};const _0x4f3b92=Date[_0x28bbe0(0x1a7)]();if(decisionCache[_0xef3fc9]&&_0x4f3b92-decisionCache[_0xef3fc9][_0x28bbe0(0x1bc)]<CACHE_TTL_MS){const _0x14de38=decisionCache[_0xef3fc9][_0x28bbe0(0x1f9)];return _0xb34af9[_0x28bbe0(0x1d2)][_0x28bbe0(0x1dc)](_0x28bbe0(0x1cd)+_0xef3fc9+_0x28bbe0(0x1b8)+(_0x14de38['approved']?'OK':'NO')+'\x20('+_0x14de38[_0x28bbe0(0x1ac)]+')'),_0x14de38;}if(!canCallApi())return _0xb34af9[_0x28bbe0(0x1d2)][_0x28bbe0(0x1dc)](_0x28bbe0(0x180)+_0xef3fc9+_0x28bbe0(0x18f)),{'approved':!![],'reason':_0x28bbe0(0x186)};const _0x4a55bd=new Date()[_0x28bbe0(0x1e8)](),_0x1134af=await getWeatherContext(_0xb34af9),_0xe267fd=PERSONA_MAPPING[_0xb34af9[_0x28bbe0(0x1b3)]['aiPersona']||'generic'],_0x483c55=_0x28bbe0(0x210)+_0x4a55bd+_0x28bbe0(0x1ba)+_0x1134af+'.\x0a\x20\x20\x20\x20EVENT:\x20Bewohner\x20geht\x20wahrscheinlich\x20('+(_0x40ea5a*0x64)[_0x28bbe0(0x1e2)](0x0)+_0x28bbe0(0x1a0)+_0xef3fc9+_0x28bbe0(0x20a)+_0x3b7e33+'\x22\x20AN.\x0a\x20\x20\x20\x20STRATEGIE:\x20'+_0xe267fd+_0x28bbe0(0x1f0);try{updateApiTimestamp();const _0xd9c68d=await _0xb34af9[_0x28bbe0(0x1a3)][_0x28bbe0(0x1d0)](_0x483c55),_0x18b601=_0xd9c68d[_0x28bbe0(0x1c7)][_0x28bbe0(0x1e5)]()[_0x28bbe0(0x1c0)](/```json|```/g,'')[_0x28bbe0(0x209)](),_0x130105=JSON['parse'](_0x18b601);return decisionCache[_0xef3fc9]={'decision':_0x130105,'timestamp':_0x4f3b92},_0x130105;}catch(_0x946d2b){return _0xb34af9[_0x28bbe0(0x1d2)][_0x28bbe0(0x1ec)](_0x28bbe0(0x1af)+_0x946d2b[_0x28bbe0(0x178)]),decisionCache[_0xef3fc9]={'decision':{'approved':!![],'reason':'KI-Fehler\x20(Fallback)'},'timestamp':_0x4f3b92-(CACHE_TTL_MS-0xea60)},{'approved':!![],'reason':_0x28bbe0(0x1c5)};}}async function runGeminiAnalysis(_0x2183e1,_0x2958ad=''){const _0x2b0fc0=a0_0x103e1b;if(!_0x2183e1[_0x2b0fc0(0x1a3)])return;if(!canCallApi()){_0x2183e1[_0x2b0fc0(0x1d2)][_0x2b0fc0(0x1dc)](_0x2b0fc0(0x1ae));return;}if(_0x2183e1[_0x2b0fc0(0x171)]['length']===0x0)return;const _0x264fbe=_0x2183e1[_0x2b0fc0(0x171)]['slice'](0x0,0xf),_0x405c1b=_0x2183e1[_0x2b0fc0(0x1fb)],_0x3fbf10=PERSONA_MAPPING[_0x2183e1['config'][_0x2b0fc0(0x16e)]||_0x2b0fc0(0x19d)],_0x1b2940=_0x2183e1['config'][_0x2b0fc0(0x18b)]||_0x2b0fc0(0x197);let _0x323ccc='Unbekannt';try{const _0x253697=await _0x2183e1[_0x2b0fc0(0x1bb)](_0x2b0fc0(0x203));if(_0x253697&&_0x253697[_0x2b0fc0(0x1e6)])_0x323ccc=_0x253697['val'];}catch(_0xd2f283){}let _0x7b905f=![];try{const _0x2dd03c=await _0x2183e1[_0x2b0fc0(0x1bb)](_0x2b0fc0(0x1f6));if(_0x2dd03c&&_0x2dd03c['val'])_0x7b905f=!![];}catch(_0x4aedeb){}const _0x5b813f=_0x2b0fc0(0x17a)+_0x3fbf10+'.\x20KONTEXT:\x20'+_0x1b2940+_0x2b0fc0(0x1c6)+_0x405c1b+'.\x20ANWESEND:\x20'+_0x323ccc+_0x2b0fc0(0x18a)+JSON[_0x2b0fc0(0x202)](_0x264fbe)+_0x2b0fc0(0x1fc)+_0x2958ad+_0x2b0fc0(0x17d);try{updateApiTimestamp();const _0x40ac2c=await _0x2183e1[_0x2b0fc0(0x1a3)][_0x2b0fc0(0x1d0)](_0x5b813f),_0x186933=JSON[_0x2b0fc0(0x1d6)](_0x40ac2c[_0x2b0fc0(0x1c7)][_0x2b0fc0(0x1e5)]()[_0x2b0fc0(0x1c0)](/```json|```/g,'')[_0x2b0fc0(0x209)]());await _0x2183e1[_0x2b0fc0(0x1ad)]('analysis.lastResult',{'val':JSON[_0x2b0fc0(0x202)](_0x186933),'ack':!![]});if(_0x186933[_0x2b0fc0(0x1ff)])await _0x2183e1[_0x2b0fc0(0x1ad)](_0x2b0fc0(0x206),{'val':_0x186933[_0x2b0fc0(0x1ff)],'ack':!![]});const _0x3ee347={'timestamp':Date[_0x2b0fc0(0x1a7)](),'id':Date['now']()['toString'](),'analysis':{'activity':{'summary':_0x186933[_0x2b0fc0(0x1ff)],'isAlert':_0x186933[_0x2b0fc0(0x1e4)],'alertReason':_0x186933['alertReason']},'comfort':{'automationProposal':_0x186933[_0x2b0fc0(0x1b1)]}}};_0x2183e1[_0x2b0fc0(0x1da)]['unshift'](_0x3ee347);if(_0x2183e1[_0x2b0fc0(0x1da)][_0x2b0fc0(0x1d8)]>0x32)_0x2183e1[_0x2b0fc0(0x1da)][_0x2b0fc0(0x1f3)]();await _0x2183e1[_0x2b0fc0(0x1ad)](_0x2b0fc0(0x17f),{'val':JSON[_0x2b0fc0(0x202)](_0x2183e1[_0x2b0fc0(0x1da)]),'ack':!![]});const _0x5a448f=_0x186933[_0x2b0fc0(0x1e4)]||![];_0x5a448f!==_0x2183e1[_0x2b0fc0(0x1d1)]&&(await _0x2183e1['setStateAsync'](_0x2b0fc0(0x193),{'val':_0x5a448f,'ack':!![]}),_0x2183e1[_0x2b0fc0(0x1d1)]=_0x5a448f,_0x5a448f&&(await _0x2183e1['setStateAsync'](_0x2b0fc0(0x173),{'val':_0x186933[_0x2b0fc0(0x1ce)],'ack':!![]}),setup[_0x2b0fc0(0x1b0)](_0x2183e1,_0x2b0fc0(0x1bf)+_0x186933[_0x2b0fc0(0x1ce)],![],_0x186933[_0x2b0fc0(0x17b)])));if(_0x186933[_0x2b0fc0(0x1b1)]&&_0x186933['automationProposal'][_0x2b0fc0(0x183)]){await _0x2183e1[_0x2b0fc0(0x1ad)](_0x2b0fc0(0x1d4),{'val':!![],'ack':!![]}),await _0x2183e1[_0x2b0fc0(0x1ad)](_0x2b0fc0(0x179),{'val':_0x186933['automationProposal'][_0x2b0fc0(0x1b7)],'ack':!![]}),await _0x2183e1[_0x2b0fc0(0x1ad)](_0x2b0fc0(0x1e1),{'val':_0x186933['automationProposal']['targetId'],'ack':!![]}),await _0x2183e1[_0x2b0fc0(0x1ad)](_0x2b0fc0(0x1a8),{'val':JSON[_0x2b0fc0(0x202)](_0x186933['automationProposal'][_0x2b0fc0(0x196)]),'ack':!![]});if(_0x7b905f)executeAutomationAction(_0x2183e1);}}catch(_0x2be683){_0x2183e1[_0x2b0fc0(0x1d2)]['error'](_0x2b0fc0(0x1de)+_0x2be683[_0x2b0fc0(0x178)]);}}async function createDailyDigest(_0x5b0c9a,_0x176c77){const _0x1a98e5=a0_0x103e1b;if(!_0x5b0c9a['isProVersion'])return;if(!canCallApi()){await _0x5b0c9a[_0x1a98e5(0x1ad)](LTM_DP_STATUS,{'val':_0x1a98e5(0x214),'ack':!![]});return;}await _0x5b0c9a[_0x1a98e5(0x1ad)](LTM_DP_STATUS,{'val':_0x1a98e5(0x185),'ack':!![]});if(!_0x5b0c9a[_0x1a98e5(0x1a3)]||_0x5b0c9a[_0x1a98e5(0x1d7)][_0x1a98e5(0x1d8)]<LTM_MIN_EVENTS_FOR_COMPRESSION){await _0x5b0c9a[_0x1a98e5(0x1ad)](LTM_DP_STATUS,{'val':_0x1a98e5(0x19a),'ack':!![]});return;}const _0x25b154=JSON[_0x1a98e5(0x1d6)](JSON[_0x1a98e5(0x202)](_0x5b0c9a[_0x1a98e5(0x1d7)])),_0x2e0291=_0x25b154[_0x1a98e5(0x1d8)],_0x71bc9e=_0x1a98e5(0x177)+JSON[_0x1a98e5(0x202)](_0x25b154);try{updateApiTimestamp();const _0x314c06=await _0x5b0c9a['geminiModel'][_0x1a98e5(0x1d0)](_0x71bc9e),_0x488f32=JSON[_0x1a98e5(0x1d6)](_0x314c06[_0x1a98e5(0x1c7)]['text']()['replace'](/```json|```/g,'')['trim']()),_0x52a378={'timestamp':new Date()[_0x1a98e5(0x190)](),'eventCount':_0x2e0291,'summary':_0x488f32['summary']||'Digest','activityLevel':_0x488f32[_0x1a98e5(0x215)]||_0x1a98e5(0x191),'systemMode':_0x5b0c9a[_0x1a98e5(0x1fb)]};_0x5b0c9a['dailyDigests']['push'](_0x52a378);const _0x5659a9=_0x5b0c9a[_0x1a98e5(0x1b3)][_0x1a98e5(0x195)]||0x3c;_0x5b0c9a['dailyDigests'][_0x1a98e5(0x1d8)]>_0x5659a9&&_0x5b0c9a[_0x1a98e5(0x181)]['splice'](0x0,_0x5b0c9a[_0x1a98e5(0x181)][_0x1a98e5(0x1d8)]-_0x5659a9);await _0x5b0c9a[_0x1a98e5(0x1ad)](LTM_DP_DAILY_DIGESTS,{'val':JSON[_0x1a98e5(0x202)](_0x5b0c9a[_0x1a98e5(0x181)]),'ack':!![]}),_0x5b0c9a['rawEventLog']=[],await _0x5b0c9a[_0x1a98e5(0x1ad)](LTM_DP_RAW_LOG,{'val':JSON[_0x1a98e5(0x202)](_0x5b0c9a[_0x1a98e5(0x1d7)]),'ack':!![]}),await _0x5b0c9a[_0x1a98e5(0x1ad)](LTM_DP_STATUS,{'val':'Success','ack':!![]});const _0x13f915='ðŸ“…\x20Daily\x20Digest:\x0a'+_0x488f32[_0x1a98e5(0x1ff)]+_0x1a98e5(0x1fd)+_0x488f32[_0x1a98e5(0x215)];setup[_0x1a98e5(0x1b0)](_0x5b0c9a,_0x13f915,![],![]);if(_0x5b0c9a['isProVersion']&&_0x176c77)_0x176c77[_0x1a98e5(0x198)](_0x5b0c9a,_0x1a98e5(0x204),{'digest':_0x52a378});}catch(_0x2ad6d5){_0x5b0c9a[_0x1a98e5(0x1d2)][_0x1a98e5(0x16f)](_0x2ad6d5[_0x1a98e5(0x178)]);}}async function runBaselineDriftAnalysis(_0x2b8001){const _0x345e4b=a0_0x103e1b;if(!_0x2b8001[_0x345e4b(0x1fe)]||!_0x2b8001[_0x345e4b(0x1a3)])return;if(!canCallApi())return;const _0x3cc77c=_0x2b8001[_0x345e4b(0x1b3)][_0x345e4b(0x1ab)]||0xe;if(_0x2b8001[_0x345e4b(0x181)][_0x345e4b(0x1d8)]<_0x3cc77c+0x7){await _0x2b8001['setStateAsync'](_0x345e4b(0x1a2),{'val':_0x345e4b(0x1e3),'ack':!![]});return;}const _0x1376ca=_0x2b8001['dailyDigests']['slice'](-_0x3cc77c),_0x4681d4=_0x2b8001[_0x345e4b(0x181)][_0x345e4b(0x1f4)](0x0,_0x2b8001[_0x345e4b(0x181)][_0x345e4b(0x1d8)]-_0x3cc77c),_0x595213=_0x345e4b(0x1bd)+JSON[_0x345e4b(0x202)](_0x4681d4)+_0x345e4b(0x174)+JSON[_0x345e4b(0x202)](_0x1376ca);try{updateApiTimestamp();const _0x121feb=await _0x2b8001[_0x345e4b(0x1a3)][_0x345e4b(0x1d0)](_0x595213),_0x5187ec=JSON[_0x345e4b(0x1d6)](_0x121feb[_0x345e4b(0x1c7)][_0x345e4b(0x1e5)]()['replace'](/```json|```/g,'')[_0x345e4b(0x209)]());_0x5187ec[_0x345e4b(0x216)]&&(await _0x2b8001['setStateAsync'](_0x345e4b(0x1a2),{'val':_0x5187ec[_0x345e4b(0x216)],'ack':!![]}),await _0x2b8001[_0x345e4b(0x1ad)](_0x345e4b(0x1ef),{'val':_0x5187ec[_0x345e4b(0x1f2)],'ack':!![]}),await _0x2b8001[_0x345e4b(0x1ad)](_0x345e4b(0x1c3),{'val':Date[_0x345e4b(0x1a7)](),'ack':!![]}));}catch(_0x4c778d){}}async function executeAutomationAction(_0x17889d){const _0xc72120=a0_0x103e1b;try{const _0x478124=await _0x17889d[_0xc72120(0x1bb)](_0xc72120(0x1e1)),_0x29c3e6=await _0x17889d[_0xc72120(0x1bb)](_0xc72120(0x1a8));if(_0x478124&&_0x478124[_0xc72120(0x1e6)]&&_0x29c3e6){const _0x27777b=_0x478124[_0xc72120(0x1e6)];let _0x568439=_0x29c3e6[_0xc72120(0x1e6)];try{_0x568439=JSON[_0xc72120(0x1d6)](_0x568439);}catch(_0x62af61){}_0x17889d[_0xc72120(0x1d2)][_0xc72120(0x212)](_0xc72120(0x188)+_0x27777b+_0xc72120(0x1e7)+_0x568439),await _0x17889d[_0xc72120(0x20f)](_0x27777b,_0x568439);}else _0x17889d[_0xc72120(0x1d2)][_0xc72120(0x1ec)](_0xc72120(0x19c));}catch(_0x3370a2){_0x17889d['log'][_0xc72120(0x16f)](_0xc72120(0x18d)+_0x3370a2[_0xc72120(0x178)]);}}async function sendMorningBriefing(_0x2190db){const _0x605034=a0_0x103e1b;if(!_0x2190db[_0x605034(0x1a3)]){_0x2190db['log'][_0x605034(0x1ec)](_0x605034(0x172));return;}_0x2190db['log'][_0x605034(0x212)](_0x605034(0x1a6));try{updateApiTimestamp();const _0x3d2938=_0x605034(0x1f8),_0x1220c3=await _0x2190db[_0x605034(0x1a3)][_0x605034(0x1d0)](_0x3d2938),_0x4c4985=_0x1220c3[_0x605034(0x1c7)][_0x605034(0x1e5)]();_0x2190db[_0x605034(0x1d2)]['info'](_0x605034(0x1c9)+_0x4c4985[_0x605034(0x1d8)]+_0x605034(0x189)),setup[_0x605034(0x1b0)](_0x2190db,'ðŸŒ…\x20Morning\x20Briefing:\x0a'+_0x4c4985);}catch(_0x12d0a3){_0x2190db['log'][_0x605034(0x16f)](_0x605034(0x19e)+_0x12d0a3[_0x605034(0x178)]);}}async function generateHealthReport(_0x531b62,_0x133b03){const _0x4cec65=a0_0x103e1b;if(!_0x531b62['geminiModel'])return;const _0x55b6a5=Date['now']();_0x55b6a5-lastGlobalApiCall<0xbb8&&(_0x531b62['log'][_0x4cec65(0x1dc)](_0x4cec65(0x1dd)),await new Promise(_0x4cd737=>setTimeout(_0x4cd737,0x7d0)));const _0x42cbab=new Date();let _0x5a22fb=0x0,_0x50a3cb=_0x42cbab[_0x4cec65(0x1f5)](),_0x33b337='';if(_0x133b03==='NIGHT'){const _0x4fa7ae=new Date(_0x42cbab);_0x4fa7ae[_0x4cec65(0x18e)](_0x4fa7ae[_0x4cec65(0x1cb)]()-0x1),_0x4fa7ae['setHours'](0x16,0x0,0x0,0x0),_0x5a22fb=_0x4fa7ae[_0x4cec65(0x1f5)]();const _0x121463=new Date(_0x42cbab);_0x121463[_0x4cec65(0x1d9)](0x8,0x0,0x0,0x0),_0x50a3cb=_0x121463['getTime'](),_0x33b337=_0x4cec65(0x182);}else{const _0x433191=new Date(_0x42cbab);_0x433191[_0x4cec65(0x1d9)](0x8,0x0,0x0,0x0),_0x5a22fb=_0x433191[_0x4cec65(0x1f5)](),_0x33b337=_0x4cec65(0x1cc);}const _0x21c65d=_0x531b62[_0x4cec65(0x171)][_0x4cec65(0x199)](_0x175ee0=>_0x175ee0['timestamp']>=_0x5a22fb&&_0x175ee0['timestamp']<=_0x50a3cb);if(_0x21c65d[_0x4cec65(0x1d8)]===0x0){const _0x50725f=_0x133b03==='NIGHT'?'Keine\x20Daten\x20fÃ¼r\x20die\x20Nacht\x20aufgezeichnet\x20(Sensoren\x20ruhig).':_0x4cec65(0x16c),_0x54d564=_0x133b03==='NIGHT'?_0x4cec65(0x1ed):'analysis.health.geminiDay';await _0x531b62[_0x4cec65(0x1ad)](_0x54d564,{'val':_0x50725f,'ack':!![]});return;}const _0x524d41=_0x21c65d[_0x4cec65(0x1a1)](_0x2185b5=>new Date(_0x2185b5[_0x4cec65(0x1bc)])[_0x4cec65(0x1e8)]([],{'hour':_0x4cec65(0x208),'minute':_0x4cec65(0x208)})+'\x20'+_0x2185b5[_0x4cec65(0x17c)]+'\x20('+_0x2185b5[_0x4cec65(0x1aa)]+')')[_0x4cec65(0x1e0)]('\x0a'),_0x501790=_0x4cec65(0x175)+_0x33b337+_0x4cec65(0x194)+_0x524d41+_0x4cec65(0x1b9);try{updateApiTimestamp();const _0xde84f9=await _0x531b62['geminiModel'][_0x4cec65(0x1d0)](_0x501790),_0x583f95=_0xde84f9[_0x4cec65(0x1c7)][_0x4cec65(0x1e5)](),_0xe295f2=_0x133b03===_0x4cec65(0x211)?_0x4cec65(0x1ed):_0x4cec65(0x1c4);await _0x531b62[_0x4cec65(0x1ad)](_0xe295f2,{'val':_0x583f95,'ack':!![]}),_0x531b62[_0x4cec65(0x1d2)][_0x4cec65(0x212)]('ðŸ¤–\x20Health\x20Report\x20('+_0x133b03+_0x4cec65(0x1c8));}catch(_0x3807b5){_0x531b62[_0x4cec65(0x1d2)][_0x4cec65(0x16f)](_0x4cec65(0x1c1)+_0x3807b5[_0x4cec65(0x178)]);}}module['exports']={'executeAutomationAction':executeAutomationAction,'createDailyDigest':createDailyDigest,'runBaselineDriftAnalysis':runBaselineDriftAnalysis,'sendMorningBriefing':sendMorningBriefing,'runGeminiAnalysis':runGeminiAnalysis,'consultButler':consultButler,'generateHealthReport':generateHealthReport};