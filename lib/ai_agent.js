const a0_0x477bcd=a0_0x1056;function a0_0x1056(_0x465820,_0x3f623d){const _0x322d48=a0_0x375e();return a0_0x1056=function(_0x44008b,_0x14639a){_0x44008b=_0x44008b-0xe9;let _0x375e9b=_0x322d48[_0x44008b];return _0x375e9b;},a0_0x1056(_0x465820,_0x3f623d);}(function(_0x576464,_0x2a3fb7){const _0x40ac93=a0_0x1056,_0x4a7bbd=_0x576464();while(!![]){try{const _0x414584=parseInt(_0x40ac93(0x13a))/0x1*(parseInt(_0x40ac93(0x10b))/0x2)+parseInt(_0x40ac93(0x166))/0x3*(parseInt(_0x40ac93(0x129))/0x4)+parseInt(_0x40ac93(0xed))/0x5*(-parseInt(_0x40ac93(0x174))/0x6)+parseInt(_0x40ac93(0x13b))/0x7+parseInt(_0x40ac93(0x125))/0x8+-parseInt(_0x40ac93(0x110))/0x9*(-parseInt(_0x40ac93(0x168))/0xa)+-parseInt(_0x40ac93(0x11e))/0xb;if(_0x414584===_0x2a3fb7)break;else _0x4a7bbd['push'](_0x4a7bbd['shift']());}catch(_0x482245){_0x4a7bbd['push'](_0x4a7bbd['shift']());}}}(a0_0x375e,0x191ed));const a0_0x14639a=(function(){let _0x3835dc=!![];return function(_0x3d5390,_0x48449a){const _0x3beec3=_0x3835dc?function(){const _0x4801b2=a0_0x1056;if(_0x48449a){const _0x4a4131=_0x48449a[_0x4801b2(0x147)](_0x3d5390,arguments);return _0x48449a=null,_0x4a4131;}}:function(){};return _0x3835dc=![],_0x3beec3;};}()),a0_0x44008b=a0_0x14639a(this,function(){const _0x1cfd06=a0_0x1056;return a0_0x44008b[_0x1cfd06(0x15b)]()[_0x1cfd06(0x112)](_0x1cfd06(0x119))[_0x1cfd06(0x15b)]()[_0x1cfd06(0x18b)](a0_0x44008b)[_0x1cfd06(0x112)](_0x1cfd06(0x119));});a0_0x44008b();'use strict';const {GoogleGenerativeAI}=require(a0_0x477bcd(0x100)),setup=require(a0_0x477bcd(0x15e)),GEMINI_MODEL=a0_0x477bcd(0x102),LTM_DP_DAILY_DIGESTS=a0_0x477bcd(0x13c),LTM_DP_STATUS=a0_0x477bcd(0x106),LTM_DP_RAW_LOG=a0_0x477bcd(0x181),LTM_MIN_EVENTS_FOR_COMPRESSION=0x5,MIN_API_GAP_MS=0x4e20;let lastGlobalApiCall=0x0;const decisionCache={},CACHE_TTL_MS=0xf*0x3c*0x3e8,PERSONA_MAPPING={'generic':a0_0x477bcd(0x13e),'senior_aal':'PRIORIT√ÑT:\x20Sicherheit\x20und\x20Licht.\x20Schalte\x20lieber\x20einmal\x20zu\x20viel\x20als\x20zu\x20wenig.','family':'Fokus\x20auf\x20Komfort\x20f√ºr\x20die\x20Familie.','single_comfort':a0_0x477bcd(0xf2),'security':a0_0x477bcd(0x16e),'energy_saver':a0_0x477bcd(0xf4)};function canCallApi(){const _0x2a38d1=a0_0x477bcd,_0x2f3037=Date[_0x2a38d1(0x186)]();return _0x2f3037-lastGlobalApiCall>MIN_API_GAP_MS;}function updateApiTimestamp(){lastGlobalApiCall=Date['now']();}function a0_0x375e(){const _0x18762d=['baselineDrift','isEmergency','send','generateContent','config','response','parse','Bisher\x20keine\x20Aktivit√§t\x20seit\x2008:00\x20Uhr\x20verzeichnet.','\x20->\x20','system.presenceWho','unshift','currentSystemMode','¬∞C,\x20','üåÖ\x20Briefing\x20generated\x20(Length:\x20','lastAlertState','name','.\x20EVENTS:\x20','\x0a\x20\x20\x20\x20ROLLE:\x20Haus-Butler.\x0a\x20\x20\x20\x20SITUATION:\x20','toString','.Current.IsNight','setStateAsync','./setup','getTime','.Current.WeatherText','weatherInstance','Unbekannt\x20(Kein\x20Sensor)','summary','length','Keine\x20Daten\x20f√ºr\x20die\x20Nacht\x20aufgezeichnet\x20(Sensoren\x20ruhig).','1959zzzeZh','ltmLtbWindowDays','1695410svUpJB','toISOString','N/A\x20(Learning)','getForeignStateAsync','debug','eventHistory','Sicherheit\x20geht\x20vor.','analysis.automation.targetId','analysis.automation.patternDetected','ltmStbWindowDays','KI-Fehler\x20(Fallback)','Health\x20Report\x20Error:\x20','2874jWYPqy','exports','Keine\x20Details.','\x22.\x0a\x20\x20\x20\x20AKTION:\x20Schalte\x20\x22','geminiModel','analysis.health.geminiDay','ANALYZE_HEALTH','activityLevel','approved','ü§ñ\x20Traffic\x20Schutz:\x20Anfrage\x20f√ºr\x20','slice','2-digit','log','LTM.rawEventLog','targetId','analysis.automation.autoApply','setHours','generic','now','Unbekannt','Traffic-Schutz\x20(Auto-Approved)','analysis.automation.targetValue','pop','constructor','ü§ñ\x20BUTLER:\x20Executing\x20Action\x20->\x20','push','aiPersona','sendNotification','analysis.analysisHistory',').\x20Sending\x20notification...','2095gYgnsv',',\x20Lichtverh√§ltnisse:\x20','stringify','NIGHT','.forecast.current.state','Maximaler\x20Komfort,\x20Energie\x20ist\x20zweitrangig.','ROLLE:\x20KI-Hausverwalter.\x20PERSONA:\x20','PRIORIT√ÑT:\x20Energie\x20sparen.\x20Schalte\x20nur,\x20wenn\x20absolut\x20notwendig\x20(Dunkelheit).','analysis.alertReason','analysis.isAlert','üåÖ\x20Morning\x20Briefing:\x0a','.\x0a\x20\x20\x20\x20EVENT:\x20Bewohner\x20geht\x20wahrscheinlich\x20(','\x20=\x20','ü§ñ\x20API\x20Cooldown.\x20Waiting\x202s...',',\x20Wetter:\x20','Gemini\x20Error:\x20','Skipped\x20(Traffic)','üåÖ\x20Starting\x20Morning\x20Briefing\x20sequence\x20(Traffic\x20Check\x20bypassed)...','toFixed','@google/generative-ai','normal','models/gemini-flash-latest','analysis.automation.description','LTM.driftAnalysis.baselineDrift','message','LTM.processingStatus','ü§ñ\x20BUTLER:\x20No\x20valid\x20target\x20ID\x20or\x20value\x20stored\x20for\x20execution.','ROLLE:\x20Data\x20Compression\x20Agent.\x20SPRACHE:\x20DE.\x20FORMAT:\x20JSON.\x20ANWEISUNG:\x20Fasse\x20Sensor-Events\x20zusammen.\x20SCHEMA:\x20{\x20\x22summary\x22:\x20\x22string\x22,\x20\x22activityLevel\x22:\x20\x22string\x22\x20}\x20\x0a\x0aEVENTS:\x0a','Skipped\x20(No\x20AI\x20or\x20Data)','info','6932dUkrNQ','analysisHistory','error','ü§ñ\x20Butler\x20Brain\x20Error:\x20','decision','9ykkYGH','timestamp','search','ü§ñ\x20Morning\x20Briefing\x20skipped:\x20No\x20Gemini\x20Model.','val','\x0aSTB:\x20','KI\x20offline\x20(Fallback)','getStateAsync','Analysiere\x20diese\x20Events\x20der\x20NACHT\x20(22:00-08:00).\x20War\x20der\x20Schlaf\x20ruhig?\x20Gab\x20es\x20Badg√§nge?\x20Antwort\x20kurz\x20f√ºr\x20den\x20besorgten\x20Sohn\x20(max\x202\x20S√§tze).','(((.+)+)+)+$','ü§ñ\x20Butler\x20Cache\x20Hit:\x20','reason','dailyDigests','analysis.activitySummary','3093530cVpktI','BUTLER\x20Execution\x20Error:\x20','toLocaleTimeString','map','analysis.health.geminiNight','LTM.driftAnalysis.driftDetails','setDate','397416pmVcgX','livingContext','.\x20AUFGABE:\x201.\x20Gesundheit?\x202.\x20Komfort?\x20FORMAT\x20(JSON):\x20{\x20\x22isAlert\x22:\x20boolean,\x20\x22alertReason\x22:\x20\x22string\x22,\x20\x22isEmergency\x22:\x20boolean,\x20\x22summary\x22:\x20\x22string\x22,\x20\x22automationProposal\x22:\x20{\x20\x22detected\x22:\x20boolean,\x20\x22description\x22:\x20\x22string\x22,\x20\x22targetId\x22:\x20\x22string\x22,\x20\x22targetValue\x22:\x20\x22any\x22\x20}\x20}','analysis.lastResult','208PaCfgY','text','rawEventLog','.forecast.current.temperature','.\x20SYSTEM_MODE:\x20','alertReason','filter','üìÖ\x20Daily\x20Digest:\x0a','setForeignStateAsync','warn','Success','splice','\x22\x20AN.\x0a\x20\x20\x20\x20STRATEGIE:\x20','trim','targetValue','value','.\x20EMERGENCY:\x20','58cZlKCU','914354MyCTjD','LTM.dailyDigests','replace','Entscheide\x20ausgewogen\x20zwischen\x20Komfort\x20und\x20Energie.','Analysiere\x20diese\x20Events\x20des\x20TAGES\x20(08:00-Jetzt).\x20Aktivit√§t?\x20Mahlzeiten?\x20Haust√ºr?\x20Antwort\x20kurz\x20f√ºr\x20den\x20besorgten\x20Sohn\x20(max\x202\x20S√§tze).','\x0a\x20\x20\x20\x20ROLLE:\x20Medizinischer\x20Assistent\x20f√ºr\x20AAL\x20(Ambient\x20Assisted\x20Living).\x0a\x20\x20\x20\x20AUFGABE:\x20','Digest','isAlert','\x0a\x20\x20\x20\x20FRAGE:\x20Ist\x20es\x20dunkel\x20genug\x20f√ºr\x20Licht?\x0a\x20\x20\x20\x20FORMAT:\x20{\x20\x22approved\x22:\x20boolean,\x20\x22reason\x22:\x20\x22kurzer\x20Grund\x22\x20}\x0a\x20\x20\x20\x20','.Current.Temperature','Wetterdaten\x20nicht\x20abrufbar','automationProposal','apply','ü§ñ\x20Autopilot\x20skipped\x20(Traffic\x20Protection\x20active).'];a0_0x375e=function(){return _0x18762d;};return a0_0x375e();}async function getWeatherContext(_0x4925c8){const _0xd04c8b=a0_0x477bcd;if(!_0x4925c8[_0xd04c8b(0x14d)]['useWeather']||!_0x4925c8[_0xd04c8b(0x14d)][_0xd04c8b(0x161)])return _0xd04c8b(0x162);try{const _0x36e262=_0x4925c8[_0xd04c8b(0x14d)][_0xd04c8b(0x161)];let _0x6db651=await _0x4925c8[_0xd04c8b(0x16b)](_0x36e262+_0xd04c8b(0x144));if(!_0x6db651)_0x6db651=await _0x4925c8[_0xd04c8b(0x16b)](_0x36e262+_0xd04c8b(0x12c));let _0x18e2e8=await _0x4925c8[_0xd04c8b(0x16b)](_0x36e262+_0xd04c8b(0x160));if(!_0x18e2e8)_0x18e2e8=await _0x4925c8[_0xd04c8b(0x16b)](_0x36e262+_0xd04c8b(0xf1));let _0x2c2b3f=_0xd04c8b(0x187);const _0x53e15e=await _0x4925c8[_0xd04c8b(0x16b)](_0x36e262+_0xd04c8b(0x15c));if(_0x53e15e)_0x2c2b3f=_0x53e15e['val']?'Nacht':'Tag';if(_0x6db651&&_0x18e2e8)return _0x6db651[_0xd04c8b(0x114)]+_0xd04c8b(0x155)+_0x18e2e8[_0xd04c8b(0x114)]+_0xd04c8b(0xee)+_0x2c2b3f;}catch(_0x3950c1){}return _0xd04c8b(0x145);}async function consultButler(_0x1c3f0a,_0x59bcf1,_0x11ac69,_0x1c439a){const _0x40a867=a0_0x477bcd;if(!_0x1c3f0a[_0x40a867(0x178)])return{'approved':!![],'reason':_0x40a867(0x116)};const _0x518864=Date['now']();if(decisionCache[_0x59bcf1]&&_0x518864-decisionCache[_0x59bcf1][_0x40a867(0x111)]<CACHE_TTL_MS){const _0x15f760=decisionCache[_0x59bcf1][_0x40a867(0x10f)];return _0x1c3f0a['log'][_0x40a867(0x16c)](_0x40a867(0x11a)+_0x59bcf1+_0x40a867(0x151)+(_0x15f760[_0x40a867(0x17c)]?'OK':'NO')+'\x20('+_0x15f760[_0x40a867(0x11b)]+')'),_0x15f760;}if(!canCallApi())return _0x1c3f0a[_0x40a867(0x180)]['debug'](_0x40a867(0x17d)+_0x59bcf1+'\x20√ºbersprungen\x20(Auto-Approved).'),{'approved':!![],'reason':_0x40a867(0x188)};const _0x56c47f=new Date()['toLocaleTimeString'](),_0x1f5187=await getWeatherContext(_0x1c3f0a),_0x2ce9da=PERSONA_MAPPING[_0x1c3f0a['config'][_0x40a867(0xe9)]||_0x40a867(0x185)],_0x3ca043=_0x40a867(0x15a)+_0x56c47f+_0x40a867(0xfb)+_0x1f5187+_0x40a867(0xf8)+(_0x1c439a*0x64)[_0x40a867(0xff)](0x0)+'%)\x20nach\x20\x22'+_0x59bcf1+_0x40a867(0x177)+_0x11ac69+_0x40a867(0x135)+_0x2ce9da+_0x40a867(0x143);try{updateApiTimestamp();const _0x2aa478=await _0x1c3f0a[_0x40a867(0x178)][_0x40a867(0x14c)](_0x3ca043),_0x5e9c5c=_0x2aa478[_0x40a867(0x14e)][_0x40a867(0x12a)]()['replace'](/```json|```/g,'')[_0x40a867(0x136)](),_0x18d000=JSON[_0x40a867(0x14f)](_0x5e9c5c);return decisionCache[_0x59bcf1]={'decision':_0x18d000,'timestamp':_0x518864},_0x18d000;}catch(_0xaab2e5){return _0x1c3f0a[_0x40a867(0x180)]['warn'](_0x40a867(0x10e)+_0xaab2e5[_0x40a867(0x105)]),decisionCache[_0x59bcf1]={'decision':{'approved':!![],'reason':_0x40a867(0x172)},'timestamp':_0x518864-(CACHE_TTL_MS-0xea60)},{'approved':!![],'reason':_0x40a867(0x172)};}}async function runGeminiAnalysis(_0x57534f,_0x3e49e4=''){const _0x56a15c=a0_0x477bcd;if(!_0x57534f[_0x56a15c(0x178)])return;if(!canCallApi()){_0x57534f[_0x56a15c(0x180)][_0x56a15c(0x16c)](_0x56a15c(0x148));return;}if(_0x57534f['eventHistory'][_0x56a15c(0x164)]===0x0)return;const _0x3dd668=_0x57534f[_0x56a15c(0x16d)]['slice'](0x0,0xf),_0x30a505=_0x57534f['currentSystemMode'],_0x1199e5=PERSONA_MAPPING[_0x57534f[_0x56a15c(0x14d)]['aiPersona']||_0x56a15c(0x185)],_0x383151=_0x57534f['config'][_0x56a15c(0x126)]||_0x56a15c(0x176);let _0x492032='Unbekannt';try{const _0x3ad107=await _0x57534f['getStateAsync'](_0x56a15c(0x152));if(_0x3ad107&&_0x3ad107[_0x56a15c(0x114)])_0x492032=_0x3ad107[_0x56a15c(0x114)];}catch(_0x350ad7){}let _0x477263=![];try{const _0x2cc676=await _0x57534f['getStateAsync'](_0x56a15c(0x183));if(_0x2cc676&&_0x2cc676[_0x56a15c(0x114)])_0x477263=!![];}catch(_0x470d07){}const _0x107347=_0x56a15c(0xf3)+_0x1199e5+'.\x20KONTEXT:\x20'+_0x383151+_0x56a15c(0x12d)+_0x30a505+'.\x20ANWESEND:\x20'+_0x492032+_0x56a15c(0x159)+JSON['stringify'](_0x3dd668)+_0x56a15c(0x139)+_0x3e49e4+_0x56a15c(0x127);try{updateApiTimestamp();const _0x32b78e=await _0x57534f[_0x56a15c(0x178)][_0x56a15c(0x14c)](_0x107347),_0x1d02a4=JSON[_0x56a15c(0x14f)](_0x32b78e[_0x56a15c(0x14e)][_0x56a15c(0x12a)]()[_0x56a15c(0x13d)](/```json|```/g,'')[_0x56a15c(0x136)]());await _0x57534f[_0x56a15c(0x15d)](_0x56a15c(0x128),{'val':JSON[_0x56a15c(0xef)](_0x1d02a4),'ack':!![]});if(_0x1d02a4[_0x56a15c(0x163)])await _0x57534f[_0x56a15c(0x15d)](_0x56a15c(0x11d),{'val':_0x1d02a4[_0x56a15c(0x163)],'ack':!![]});const _0x51b4fe={'timestamp':Date[_0x56a15c(0x186)](),'id':Date[_0x56a15c(0x186)]()[_0x56a15c(0x15b)](),'analysis':{'activity':{'summary':_0x1d02a4[_0x56a15c(0x163)],'isAlert':_0x1d02a4[_0x56a15c(0x142)],'alertReason':_0x1d02a4[_0x56a15c(0x12e)]},'comfort':{'automationProposal':_0x1d02a4[_0x56a15c(0x146)]}}};_0x57534f[_0x56a15c(0x10c)][_0x56a15c(0x153)](_0x51b4fe);if(_0x57534f['analysisHistory'][_0x56a15c(0x164)]>0x32)_0x57534f['analysisHistory'][_0x56a15c(0x18a)]();await _0x57534f[_0x56a15c(0x15d)](_0x56a15c(0xeb),{'val':JSON['stringify'](_0x57534f['analysisHistory']),'ack':!![]});const _0x11e9fe=_0x1d02a4['isAlert']||![];_0x11e9fe!==_0x57534f[_0x56a15c(0x157)]&&(await _0x57534f[_0x56a15c(0x15d)](_0x56a15c(0xf6),{'val':_0x11e9fe,'ack':!![]}),_0x57534f[_0x56a15c(0x157)]=_0x11e9fe,_0x11e9fe&&(await _0x57534f[_0x56a15c(0x15d)](_0x56a15c(0xf5),{'val':_0x1d02a4['alertReason'],'ack':!![]}),setup[_0x56a15c(0xea)](_0x57534f,'‚ö†Ô∏è\x20ALARM:\x20'+_0x1d02a4['alertReason'],![],_0x1d02a4[_0x56a15c(0x14a)])));if(_0x1d02a4['automationProposal']&&_0x1d02a4[_0x56a15c(0x146)]['detected']){await _0x57534f[_0x56a15c(0x15d)](_0x56a15c(0x170),{'val':!![],'ack':!![]}),await _0x57534f[_0x56a15c(0x15d)](_0x56a15c(0x103),{'val':_0x1d02a4[_0x56a15c(0x146)]['description'],'ack':!![]}),await _0x57534f[_0x56a15c(0x15d)](_0x56a15c(0x16f),{'val':_0x1d02a4[_0x56a15c(0x146)][_0x56a15c(0x182)],'ack':!![]}),await _0x57534f[_0x56a15c(0x15d)](_0x56a15c(0x189),{'val':JSON['stringify'](_0x1d02a4[_0x56a15c(0x146)][_0x56a15c(0x137)]),'ack':!![]});if(_0x477263)executeAutomationAction(_0x57534f);}}catch(_0x1c7844){_0x57534f[_0x56a15c(0x180)][_0x56a15c(0x10d)](_0x56a15c(0xfc)+_0x1c7844[_0x56a15c(0x105)]);}}async function createDailyDigest(_0x1d8d35,_0x13b0aa){const _0x419093=a0_0x477bcd;if(!_0x1d8d35['isProVersion'])return;if(!canCallApi()){await _0x1d8d35[_0x419093(0x15d)](LTM_DP_STATUS,{'val':_0x419093(0xfd),'ack':!![]});return;}await _0x1d8d35['setStateAsync'](LTM_DP_STATUS,{'val':'Started...','ack':!![]});if(!_0x1d8d35[_0x419093(0x178)]||_0x1d8d35[_0x419093(0x12b)][_0x419093(0x164)]<LTM_MIN_EVENTS_FOR_COMPRESSION){await _0x1d8d35[_0x419093(0x15d)](LTM_DP_STATUS,{'val':_0x419093(0x109),'ack':!![]});return;}const _0x278171=JSON['parse'](JSON['stringify'](_0x1d8d35[_0x419093(0x12b)])),_0x4b6faa=_0x278171[_0x419093(0x164)],_0x1dd425=_0x419093(0x108)+JSON[_0x419093(0xef)](_0x278171);try{updateApiTimestamp();const _0x2bcc75=await _0x1d8d35['geminiModel'][_0x419093(0x14c)](_0x1dd425),_0x98ec7b=JSON[_0x419093(0x14f)](_0x2bcc75['response']['text']()[_0x419093(0x13d)](/```json|```/g,'')[_0x419093(0x136)]()),_0x18b9e1={'timestamp':new Date()[_0x419093(0x169)](),'eventCount':_0x4b6faa,'summary':_0x98ec7b[_0x419093(0x163)]||_0x419093(0x141),'activityLevel':_0x98ec7b[_0x419093(0x17b)]||_0x419093(0x101),'systemMode':_0x1d8d35[_0x419093(0x154)]};_0x1d8d35[_0x419093(0x11c)][_0x419093(0x18d)](_0x18b9e1);const _0x283ea6=_0x1d8d35[_0x419093(0x14d)][_0x419093(0x167)]||0x3c;_0x1d8d35[_0x419093(0x11c)][_0x419093(0x164)]>_0x283ea6&&_0x1d8d35[_0x419093(0x11c)][_0x419093(0x134)](0x0,_0x1d8d35['dailyDigests']['length']-_0x283ea6);await _0x1d8d35['setStateAsync'](LTM_DP_DAILY_DIGESTS,{'val':JSON[_0x419093(0xef)](_0x1d8d35[_0x419093(0x11c)]),'ack':!![]}),_0x1d8d35[_0x419093(0x12b)]=[],await _0x1d8d35[_0x419093(0x15d)](LTM_DP_RAW_LOG,{'val':JSON[_0x419093(0xef)](_0x1d8d35[_0x419093(0x12b)]),'ack':!![]}),await _0x1d8d35[_0x419093(0x15d)](LTM_DP_STATUS,{'val':_0x419093(0x133),'ack':!![]});const _0x1dafc2=_0x419093(0x130)+_0x98ec7b['summary']+'\x0aAktivit√§t:\x20'+_0x98ec7b[_0x419093(0x17b)];setup[_0x419093(0xea)](_0x1d8d35,_0x1dafc2,![],![]);if(_0x1d8d35['isProVersion']&&_0x13b0aa)_0x13b0aa[_0x419093(0x14b)](_0x1d8d35,_0x419093(0x17a),{'digest':_0x18b9e1});}catch(_0x38fa43){_0x1d8d35[_0x419093(0x180)][_0x419093(0x10d)](_0x38fa43[_0x419093(0x105)]);}}async function runBaselineDriftAnalysis(_0x10f9ac){const _0x33e51a=a0_0x477bcd;if(!_0x10f9ac['isProVersion']||!_0x10f9ac[_0x33e51a(0x178)])return;if(!canCallApi())return;const _0x3bce59=_0x10f9ac[_0x33e51a(0x14d)][_0x33e51a(0x171)]||0xe;if(_0x10f9ac['dailyDigests']['length']<_0x3bce59+0x7){await _0x10f9ac[_0x33e51a(0x15d)](_0x33e51a(0x104),{'val':_0x33e51a(0x16a),'ack':!![]});return;}const _0x353de3=_0x10f9ac[_0x33e51a(0x11c)][_0x33e51a(0x17e)](-_0x3bce59),_0x55338a=_0x10f9ac[_0x33e51a(0x11c)][_0x33e51a(0x17e)](0x0,_0x10f9ac[_0x33e51a(0x11c)][_0x33e51a(0x164)]-_0x3bce59),_0x2cc96e='ROLLE:\x20Data\x20Scientist.\x20ZIEL:\x20Drift\x20erkennen.\x20SCHEMA:\x20{\x20\x22baselineDrift\x22:\x20\x22none|slight|significant|critical\x22,\x20\x22driftDetails\x22:\x20\x22string\x22\x20}\x0a\x0aLTB:\x20'+JSON[_0x33e51a(0xef)](_0x55338a)+_0x33e51a(0x115)+JSON[_0x33e51a(0xef)](_0x353de3);try{updateApiTimestamp();const _0x305c2c=await _0x10f9ac[_0x33e51a(0x178)][_0x33e51a(0x14c)](_0x2cc96e),_0x294811=JSON[_0x33e51a(0x14f)](_0x305c2c[_0x33e51a(0x14e)][_0x33e51a(0x12a)]()[_0x33e51a(0x13d)](/```json|```/g,'')[_0x33e51a(0x136)]());_0x294811['baselineDrift']&&(await _0x10f9ac[_0x33e51a(0x15d)](_0x33e51a(0x104),{'val':_0x294811[_0x33e51a(0x149)],'ack':!![]}),await _0x10f9ac[_0x33e51a(0x15d)](_0x33e51a(0x123),{'val':_0x294811['driftDetails'],'ack':!![]}),await _0x10f9ac[_0x33e51a(0x15d)]('LTM.driftAnalysis.lastCheck',{'val':Date['now'](),'ack':!![]}));}catch(_0x67ed16){}}async function executeAutomationAction(_0x2ee0a4){const _0x2f8225=a0_0x477bcd;try{const _0x47ab80=await _0x2ee0a4[_0x2f8225(0x117)](_0x2f8225(0x16f)),_0x5bc32c=await _0x2ee0a4['getStateAsync']('analysis.automation.targetValue');if(_0x47ab80&&_0x47ab80[_0x2f8225(0x114)]&&_0x5bc32c){const _0x806f4=_0x47ab80[_0x2f8225(0x114)];let _0x5e060b=_0x5bc32c[_0x2f8225(0x114)];try{_0x5e060b=JSON['parse'](_0x5e060b);}catch(_0x234a5f){}_0x2ee0a4[_0x2f8225(0x180)][_0x2f8225(0x10a)](_0x2f8225(0x18c)+_0x806f4+_0x2f8225(0xf9)+_0x5e060b),await _0x2ee0a4[_0x2f8225(0x131)](_0x806f4,_0x5e060b);}else _0x2ee0a4[_0x2f8225(0x180)][_0x2f8225(0x132)](_0x2f8225(0x107));}catch(_0x3c30c8){_0x2ee0a4[_0x2f8225(0x180)][_0x2f8225(0x10d)](_0x2f8225(0x11f)+_0x3c30c8[_0x2f8225(0x105)]);}}async function sendMorningBriefing(_0x2fd489){const _0x433d82=a0_0x477bcd;if(!_0x2fd489[_0x433d82(0x178)]){_0x2fd489[_0x433d82(0x180)][_0x433d82(0x132)](_0x433d82(0x113));return;}_0x2fd489[_0x433d82(0x180)]['info'](_0x433d82(0xfe));try{updateApiTimestamp();const _0x5a13ab='Erstelle\x20ein\x20kurzes\x20\x27Guten\x20Morgen\x27\x20Briefing\x20basierend\x20auf\x20den\x20Events\x20der\x20letzten\x20Nacht.',_0xfccbce=await _0x2fd489[_0x433d82(0x178)]['generateContent'](_0x5a13ab),_0x2e8d55=_0xfccbce[_0x433d82(0x14e)][_0x433d82(0x12a)]();_0x2fd489['log']['info'](_0x433d82(0x156)+_0x2e8d55['length']+_0x433d82(0xec)),setup[_0x433d82(0xea)](_0x2fd489,_0x433d82(0xf7)+_0x2e8d55);}catch(_0xf940c8){_0x2fd489[_0x433d82(0x180)][_0x433d82(0x10d)]('Briefing\x20Error:\x20'+_0xf940c8[_0x433d82(0x105)]);}}async function generateHealthReport(_0x1da603,_0x7b6dcc){const _0x46402c=a0_0x477bcd;if(!_0x1da603[_0x46402c(0x178)])return;const _0xb487fa=Date[_0x46402c(0x186)]();_0xb487fa-lastGlobalApiCall<0xbb8&&(_0x1da603[_0x46402c(0x180)][_0x46402c(0x16c)](_0x46402c(0xfa)),await new Promise(_0x4f73fa=>setTimeout(_0x4f73fa,0x7d0)));const _0x3b1680=new Date();let _0x584099=0x0,_0x4f4680=_0x3b1680[_0x46402c(0x15f)](),_0x56867e='';if(_0x7b6dcc===_0x46402c(0xf0)){const _0x1891b6=new Date(_0x3b1680);_0x1891b6[_0x46402c(0x124)](_0x1891b6['getDate']()-0x1),_0x1891b6[_0x46402c(0x184)](0x16,0x0,0x0,0x0),_0x584099=_0x1891b6['getTime']();const _0x2ae847=new Date(_0x3b1680);_0x2ae847[_0x46402c(0x184)](0x8,0x0,0x0,0x0),_0x4f4680=_0x2ae847[_0x46402c(0x15f)](),_0x56867e=_0x46402c(0x118);}else{const _0x3f435d=new Date(_0x3b1680);_0x3f435d['setHours'](0x8,0x0,0x0,0x0),_0x584099=_0x3f435d[_0x46402c(0x15f)](),_0x56867e=_0x46402c(0x13f);}const _0x4e690c=_0x1da603[_0x46402c(0x16d)][_0x46402c(0x12f)](_0x46eb01=>_0x46eb01['timestamp']>=_0x584099&&_0x46eb01[_0x46402c(0x111)]<=_0x4f4680);if(_0x4e690c[_0x46402c(0x164)]===0x0){const _0x873b62=_0x7b6dcc==='NIGHT'?_0x46402c(0x165):_0x46402c(0x150),_0x4e9941=_0x7b6dcc===_0x46402c(0xf0)?_0x46402c(0x122):_0x46402c(0x179);await _0x1da603[_0x46402c(0x15d)](_0x4e9941,{'val':_0x873b62,'ack':!![]});return;}const _0x2ce438=_0x4e690c[_0x46402c(0x121)](_0x5b000f=>new Date(_0x5b000f[_0x46402c(0x111)])[_0x46402c(0x120)]([],{'hour':_0x46402c(0x17f),'minute':_0x46402c(0x17f)})+'\x20'+_0x5b000f[_0x46402c(0x158)]+'\x20('+_0x5b000f[_0x46402c(0x138)]+')')['join']('\x0a'),_0x5c185e=_0x46402c(0x140)+_0x56867e+'\x0a\x20\x20\x20\x20EVENTS:\x0a'+_0x2ce438+'\x0a\x20\x20\x20\x20ANTWORT-STIL:\x20Sachlich,\x20beruhigend,\x20pr√§zise.\x20Keine\x20Floskeln.\x0a\x20\x20\x20\x20';try{updateApiTimestamp();const _0x4d1610=await _0x1da603[_0x46402c(0x178)][_0x46402c(0x14c)](_0x5c185e),_0x3bc3fb=_0x4d1610['response'][_0x46402c(0x12a)](),_0x531f3b=_0x7b6dcc===_0x46402c(0xf0)?_0x46402c(0x122):_0x46402c(0x179);await _0x1da603['setStateAsync'](_0x531f3b,{'val':_0x3bc3fb,'ack':!![]}),_0x1da603[_0x46402c(0x180)][_0x46402c(0x10a)]('ü§ñ\x20Health\x20Report\x20('+_0x7b6dcc+')\x20generated.');}catch(_0x205a13){_0x1da603['log']['error'](_0x46402c(0x173)+_0x205a13[_0x46402c(0x105)]);}}module[a0_0x477bcd(0x175)]={'executeAutomationAction':executeAutomationAction,'createDailyDigest':createDailyDigest,'runBaselineDriftAnalysis':runBaselineDriftAnalysis,'sendMorningBriefing':sendMorningBriefing,'runGeminiAnalysis':runGeminiAnalysis,'consultButler':consultButler,'generateHealthReport':generateHealthReport};