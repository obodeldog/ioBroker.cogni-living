const a2_0x2817e6=a2_0x10b0;(function(_0x3e781f,_0xccf662){const _0x468fd4=a2_0x10b0,_0x1debd7=_0x3e781f();while(!![]){try{const _0x554e3d=-parseInt(_0x468fd4(0x16c))/0x1+-parseInt(_0x468fd4(0x164))/0x2*(-parseInt(_0x468fd4(0x16e))/0x3)+parseInt(_0x468fd4(0x176))/0x4*(-parseInt(_0x468fd4(0x172))/0x5)+-parseInt(_0x468fd4(0x17d))/0x6*(parseInt(_0x468fd4(0x173))/0x7)+-parseInt(_0x468fd4(0x178))/0x8+parseInt(_0x468fd4(0x175))/0x9+parseInt(_0x468fd4(0x171))/0xa;if(_0x554e3d===_0xccf662)break;else _0x1debd7['push'](_0x1debd7['shift']());}catch(_0x5e1a5d){_0x1debd7['push'](_0x1debd7['shift']());}}}(a2_0x157d,0x94cfd));function a2_0x10b0(_0x5b4323,_0x4e0ba0){const _0xb6e313=a2_0x157d();return a2_0x10b0=function(_0x155541,_0x3ee2cd){_0x155541=_0x155541-0x162;let _0x157df2=_0xb6e313[_0x155541];return _0x157df2;},a2_0x10b0(_0x5b4323,_0x4e0ba0);}const a2_0x3ee2cd=(function(){let _0x157d06=!![];return function(_0x475a1f,_0x2a208b){const _0x45ff69=_0x157d06?function(){if(_0x2a208b){const _0x2f72de=_0x2a208b['apply'](_0x475a1f,arguments);return _0x2a208b=null,_0x2f72de;}}:function(){};return _0x157d06=![],_0x45ff69;};}()),a2_0x155541=a2_0x3ee2cd(this,function(){const _0x22551f=a2_0x10b0;return a2_0x155541[_0x22551f(0x181)]()[_0x22551f(0x16d)]('(((.+)+)+)+$')[_0x22551f(0x181)]()['constructor'](a2_0x155541)[_0x22551f(0x16d)](_0x22551f(0x162));});a2_0x155541();'use strict';const setup=require(a2_0x2817e6(0x18b));let activeTimer=null,currentMonitoredRoom=null,timeoutMs=0x0,startTime=0x0,alarmStage=0x0;const DEFAULT_TIMEOUTS={'bad':0x2d,'bath':0x2d,'toilet':0x1e,'wc':0x1e,'keller':0x3c};async function loadConfig(_0x25b344){const _0x12af1e=a2_0x2817e6;try{const _0xf2cdd3=await _0x25b344[_0x12af1e(0x168)](_0x12af1e(0x165));if(_0xf2cdd3&&_0xf2cdd3[_0x12af1e(0x170)])return JSON[_0x12af1e(0x183)](_0xf2cdd3[_0x12af1e(0x170)]);}catch(_0x3b0505){}return{};}async function isActive(_0x16d0a9){const _0x38db21=a2_0x2817e6;try{const _0x4a0118=await _0x16d0a9[_0x38db21(0x168)](_0x38db21(0x166));return _0x4a0118&&_0x4a0118[_0x38db21(0x170)];}catch(_0x157be0){return![];}}function a2_0x157d(){const _0x1c22f2=['399459EJobcr','.\x20Alles\x20in\x20Ordnung?','val','6750040mLcgsM','770qcQPcf','217rbCzXj','sendNotification','766305ZGXEPC','7172gTvOfm','[DeadMan]\x20Ignoriere\x20Bewegung\x20in\x20\x27','2414528BmczwY','Unknown','ðŸ‘¼\x20Schutzengel:\x20Ãœberwache\x20','default','ðŸ‘¼\x20Schutzengel-Frage:\x20','55122MuGRKm','analysis.topology.structure','indexOf','message','toString','setStateAsync','parse','pre_warn','\x27.\x20Nicht\x20verbunden\x20mit\x20Ã¼berwachtem\x20\x27','error','\x20Min.','includes','warn','\x27.\x20(Multi-Person\x20Filter)','./setup','ðŸš¨\x20NOTFALL-ALARM:\x20Person\x20reagiert\x20nicht\x20in\x20','(((.+)+)+)+$','[DeadMan]\x20','14dfGtJd','analysis.safety.deadMan.config','analysis.safety.deadMan.active','log','getStateAsync','analysis.safety.deadMan.currentRoom','analysis.safety.deadMan.alarmState','info','219952qBxdXp','search'];a2_0x157d=function(){return _0x1c22f2;};return a2_0x157d();}async function areRoomsConnected(_0x1be2d1,_0x5734a6,_0x59b3fd){const _0x45eaf1=a2_0x2817e6;try{const _0x1766f4=await _0x1be2d1['getStateAsync'](_0x45eaf1(0x17e));if(!_0x1766f4||!_0x1766f4[_0x45eaf1(0x170)])return!![];const _0x12ce8a=JSON[_0x45eaf1(0x183)](_0x1766f4['val']),{rooms:_0x5c5617,matrix:_0x2e136d}=_0x12ce8a;if(!_0x5c5617||!_0x2e136d)return!![];const _0x26509b=_0x5c5617[_0x45eaf1(0x17f)](_0x5734a6),_0x464217=_0x5c5617[_0x45eaf1(0x17f)](_0x59b3fd);if(_0x26509b===-0x1||_0x464217===-0x1)return!![];const _0x24ab49=_0x2e136d[_0x26509b][_0x464217]>0x0||_0x2e136d[_0x464217][_0x26509b]>0x0;return _0x24ab49;}catch(_0x396d3f){return _0x1be2d1[_0x45eaf1(0x167)][_0x45eaf1(0x189)]('[DeadMan]\x20Topology\x20check\x20failed:\x20'+_0x396d3f[_0x45eaf1(0x180)]),!![];}}async function updateLocation(_0x472df0,_0x164b05){const _0x1ea7f0=a2_0x2817e6;if(!_0x164b05||_0x164b05===_0x1ea7f0(0x179))return;if(!await isActive(_0x472df0)){resetTimer(_0x472df0);return;}if(currentMonitoredRoom&&currentMonitoredRoom!==_0x164b05){const _0x50ea0f=await areRoomsConnected(_0x472df0,currentMonitoredRoom,_0x164b05);if(!_0x50ea0f){_0x472df0[_0x1ea7f0(0x167)][_0x1ea7f0(0x16b)](_0x1ea7f0(0x177)+_0x164b05+_0x1ea7f0(0x185)+currentMonitoredRoom+_0x1ea7f0(0x18a));return;}resetTimer(_0x472df0);}if(!currentMonitoredRoom){await _0x472df0['setStateAsync'](_0x1ea7f0(0x169),{'val':_0x164b05,'ack':!![]});const _0x1dc44a=await loadConfig(_0x472df0),_0x1c6ea8=_0x164b05['toLowerCase']();let _0x1371e0=_0x1dc44a[_0x164b05]||_0x1dc44a[_0x1c6ea8];if(!_0x1371e0)for(const _0x14674b in DEFAULT_TIMEOUTS){if(_0x1c6ea8[_0x1ea7f0(0x188)](_0x14674b)){_0x1371e0=DEFAULT_TIMEOUTS[_0x14674b];break;}}if(!_0x1371e0&&_0x1dc44a[_0x1ea7f0(0x17b)])_0x1371e0=_0x1dc44a[_0x1ea7f0(0x17b)];if(!_0x1371e0)return;currentMonitoredRoom=_0x164b05,startTimer(_0x472df0,_0x1371e0);}}function startTimer(_0x39a849,_0x18de9b){const _0x356340=a2_0x2817e6;if(activeTimer)clearTimeout(activeTimer);timeoutMs=_0x18de9b*0x3c*0x3e8,startTime=Date['now'](),alarmStage=0x0,_0x39a849[_0x356340(0x167)][_0x356340(0x16b)](_0x356340(0x17a)+currentMonitoredRoom+'\x20fÃ¼r\x20'+_0x18de9b+_0x356340(0x187)),_0x39a849[_0x356340(0x182)](_0x356340(0x16a),{'val':'ok','ack':!![]}),activeTimer=setTimeout(()=>triggerPreWarn(_0x39a849),timeoutMs);}function resetTimer(_0x5eaae5){const _0x19b06c=a2_0x2817e6;if(activeTimer)clearTimeout(activeTimer);activeTimer=null,currentMonitoredRoom=null,alarmStage=0x0,_0x5eaae5[_0x19b06c(0x182)](_0x19b06c(0x16a),{'val':'ok','ack':!![]});}async function triggerPreWarn(_0xc421c8){const _0x143098=a2_0x2817e6;alarmStage=0x1,await _0xc421c8[_0x143098(0x182)](_0x143098(0x16a),{'val':_0x143098(0x184),'ack':!![]});const _0x2c8467='â³\x20ACHTUNG:\x20UngewÃ¶hnlich\x20lange\x20InaktivitÃ¤t\x20in\x20'+currentMonitoredRoom+_0x143098(0x16f);_0xc421c8[_0x143098(0x167)][_0x143098(0x189)](_0x143098(0x163)+_0x2c8467),await setup['sendNotification'](_0xc421c8,_0x143098(0x17c)+_0x2c8467),activeTimer=setTimeout(()=>triggerAlarm(_0xc421c8),0x5*0x3c*0x3e8);}async function triggerAlarm(_0x13dc51){const _0x20994c=a2_0x2817e6;alarmStage=0x2,await _0x13dc51[_0x20994c(0x182)](_0x20994c(0x16a),{'val':'alarm','ack':!![]});const _0x3313fe=_0x20994c(0x18c)+currentMonitoredRoom+'!';_0x13dc51[_0x20994c(0x167)][_0x20994c(0x186)](_0x20994c(0x163)+_0x3313fe),await setup[_0x20994c(0x174)](_0x13dc51,_0x3313fe,![],!![]);}module['exports']={'updateLocation':updateLocation};