const a2_0xf58633=a2_0x4d14;(function(_0x46d366,_0x3c8156){const _0x4b33f7=a2_0x4d14,_0x292a8f=_0x46d366();while(!![]){try{const _0x422e9e=parseInt(_0x4b33f7(0x1ea))/0x1+parseInt(_0x4b33f7(0x1e5))/0x2*(parseInt(_0x4b33f7(0x1ee))/0x3)+parseInt(_0x4b33f7(0x1f8))/0x4+parseInt(_0x4b33f7(0x1f0))/0x5+parseInt(_0x4b33f7(0x1e1))/0x6+parseInt(_0x4b33f7(0x1f3))/0x7*(parseInt(_0x4b33f7(0x1e9))/0x8)+-parseInt(_0x4b33f7(0x1e4))/0x9;if(_0x422e9e===_0x3c8156)break;else _0x292a8f['push'](_0x292a8f['shift']());}catch(_0x360a7a){_0x292a8f['push'](_0x292a8f['shift']());}}}(a2_0x2f8c,0xc85b1));const a2_0x52797f=(function(){let _0x47ec12=!![];return function(_0x438df2,_0xb14b67){const _0x510a16=_0x47ec12?function(){const _0x5f4f4d=a2_0x4d14;if(_0xb14b67){const _0xab970d=_0xb14b67[_0x5f4f4d(0x1e3)](_0x438df2,arguments);return _0xb14b67=null,_0xab970d;}}:function(){};return _0x47ec12=![],_0x510a16;};}()),a2_0x2fdbec=a2_0x52797f(this,function(){const _0x270ae3=a2_0x4d14;return a2_0x2fdbec[_0x270ae3(0x1ce)]()[_0x270ae3(0x1d2)]('(((.+)+)+)+$')['toString']()['constructor'](a2_0x2fdbec)[_0x270ae3(0x1d2)](_0x270ae3(0x1ec));});a2_0x2fdbec();'use strict';const setup=require(a2_0xf58633(0x1cf));function a2_0x4d14(_0x1ae7cb,_0x1198ae){const _0x41ef15=a2_0x2f8c();return a2_0x4d14=function(_0x2fdbec,_0x52797f){_0x2fdbec=_0x2fdbec-0x1ce;let _0x2f8c15=_0x41ef15[_0x2fdbec];return _0x2f8c15;},a2_0x4d14(_0x1ae7cb,_0x1198ae);}let activeTimer=null,currentMonitoredRoom=null,timeoutMs=0x0,startTime=0x0,alarmStage=0x0;const DEFAULT_TIMEOUTS={'bad':0x2d,'bath':0x2d,'toilet':0x1e,'wc':0x1e,'keller':0x3c};async function loadConfig(_0x4e02a6){const _0x44ba46=a2_0xf58633;try{const _0x62127=await _0x4e02a6[_0x44ba46(0x1df)](_0x44ba46(0x1f9));if(_0x62127&&_0x62127['val'])return JSON[_0x44ba46(0x1db)](_0x62127[_0x44ba46(0x1d1)]);}catch(_0x16e7ee){}return{};}async function isActive(_0x19afad){const _0x4bed36=a2_0xf58633;try{const _0x42506c=await _0x19afad[_0x4bed36(0x1df)]('analysis.safety.deadMan.active');return _0x42506c&&_0x42506c[_0x4bed36(0x1d1)];}catch(_0x1c535a){return![];}}async function areRoomsConnected(_0x506302,_0x11dd20,_0x4f7977){const _0x381d86=a2_0xf58633;try{const _0x46ec4d=await _0x506302[_0x381d86(0x1df)](_0x381d86(0x1e7));if(!_0x46ec4d||!_0x46ec4d[_0x381d86(0x1d1)])return!![];const _0x204282=JSON['parse'](_0x46ec4d['val']),{rooms:_0x3c6a08,matrix:_0x407b14}=_0x204282;if(!_0x3c6a08||!_0x407b14)return!![];const _0x3310a3=_0x3c6a08['indexOf'](_0x11dd20),_0x3b9731=_0x3c6a08['indexOf'](_0x4f7977);if(_0x3310a3===-0x1||_0x3b9731===-0x1)return!![];const _0x1b0fc9=_0x407b14[_0x3310a3][_0x3b9731]>0x0||_0x407b14[_0x3b9731][_0x3310a3]>0x0;return _0x1b0fc9;}catch(_0x559f17){return _0x506302[_0x381d86(0x1d9)][_0x381d86(0x1f5)](_0x381d86(0x1d5)+_0x559f17[_0x381d86(0x1d8)]),!![];}}async function updateLocation(_0x3e79f3,_0x5abfba){const _0x17b5cb=a2_0xf58633;if(!_0x5abfba||_0x5abfba==='Unknown')return;if(!await isActive(_0x3e79f3)){resetTimer(_0x3e79f3);return;}if(currentMonitoredRoom&&currentMonitoredRoom!==_0x5abfba){const _0x47653d=await areRoomsConnected(_0x3e79f3,currentMonitoredRoom,_0x5abfba);if(!_0x47653d){const _0x1b3a32=_0x17b5cb(0x1d7)+_0x5abfba+'\x27.\x20Nicht\x20verbunden\x20mit\x20√ºberwachtem\x20\x27'+currentMonitoredRoom+'\x27.';_0x3e79f3[_0x17b5cb(0x1d9)][_0x17b5cb(0x1dc)](_0x17b5cb(0x1d3)+_0x1b3a32+_0x17b5cb(0x1de)),await _0x3e79f3['setStateAsync'](_0x17b5cb(0x1f1),{'val':JSON[_0x17b5cb(0x1d0)]({'room':_0x5abfba,'reason':_0x1b3a32,'timestamp':Date[_0x17b5cb(0x1f6)]()}),'ack':!![]});return;}resetTimer(_0x3e79f3);}if(!currentMonitoredRoom){await _0x3e79f3[_0x17b5cb(0x1e0)](_0x17b5cb(0x1e6),{'val':_0x5abfba,'ack':!![]});const _0x344371=await loadConfig(_0x3e79f3),_0x5a450=_0x5abfba[_0x17b5cb(0x1ef)]();let _0x212519=_0x344371[_0x5abfba]||_0x344371[_0x5a450];if(!_0x212519)for(const _0x4e86c9 in DEFAULT_TIMEOUTS){if(_0x5a450[_0x17b5cb(0x1d6)](_0x4e86c9)){_0x212519=DEFAULT_TIMEOUTS[_0x4e86c9];break;}}if(!_0x212519&&_0x344371['default'])_0x212519=_0x344371['default'];if(!_0x212519)return;currentMonitoredRoom=_0x5abfba,startTimer(_0x3e79f3,_0x212519);}}function startTimer(_0x321430,_0x731c90){const _0x451f53=a2_0xf58633;if(activeTimer)clearTimeout(activeTimer);timeoutMs=_0x731c90*0x3c*0x3e8,startTime=Date[_0x451f53(0x1f6)](),alarmStage=0x0,_0x321430[_0x451f53(0x1d9)][_0x451f53(0x1dc)](_0x451f53(0x1e2)+currentMonitoredRoom+_0x451f53(0x1eb)+_0x731c90+_0x451f53(0x1da)),_0x321430[_0x451f53(0x1e0)](_0x451f53(0x1f2),{'val':'ok','ack':!![]}),activeTimer=setTimeout(()=>triggerPreWarn(_0x321430),timeoutMs);}function resetTimer(_0x234022){const _0x595106=a2_0xf58633;if(activeTimer)clearTimeout(activeTimer);activeTimer=null,currentMonitoredRoom=null,alarmStage=0x0,_0x234022[_0x595106(0x1e0)]('analysis.safety.deadMan.alarmState',{'val':'ok','ack':!![]});}async function triggerPreWarn(_0x2c0746){const _0x5e5739=a2_0xf58633;alarmStage=0x1,await _0x2c0746['setStateAsync']('analysis.safety.deadMan.alarmState',{'val':_0x5e5739(0x1f4),'ack':!![]});const _0x116704=_0x5e5739(0x1dd)+currentMonitoredRoom+'.\x20Alles\x20in\x20Ordnung?';_0x2c0746[_0x5e5739(0x1d9)][_0x5e5739(0x1f5)](_0x5e5739(0x1d3)+_0x116704),await setup[_0x5e5739(0x1e8)](_0x2c0746,'üëº\x20Schutzengel-Frage:\x20'+_0x116704),activeTimer=setTimeout(()=>triggerAlarm(_0x2c0746),0x5*0x3c*0x3e8);}async function triggerAlarm(_0xac46f5){const _0x219a6c=a2_0xf58633;alarmStage=0x2,await _0xac46f5[_0x219a6c(0x1e0)](_0x219a6c(0x1f2),{'val':_0x219a6c(0x1d4),'ack':!![]});const _0x266d77=_0x219a6c(0x1ed)+currentMonitoredRoom+'!';_0xac46f5['log'][_0x219a6c(0x1f7)]('[DeadMan]\x20'+_0x266d77),await setup[_0x219a6c(0x1e8)](_0xac46f5,_0x266d77,![],!![]);}function a2_0x2f8c(){const _0x2517f9=['1065544Xscljk','analysis.safety.deadMan.config','toString','./setup','stringify','val','search','[DeadMan]\x20','alarm','[DeadMan]\x20Topology\x20check\x20failed:\x20','includes','Ignoriere\x20Bewegung\x20in\x20\x27','message','log','\x20Min.','parse','info','‚è≥\x20ACHTUNG:\x20Ungew√∂hnlich\x20lange\x20Inaktivit√§t\x20in\x20','\x20(Multi-Person\x20Filter)','getStateAsync','setStateAsync','3311706groWPr','üëº\x20Schutzengel:\x20√úberwache\x20','apply','24854085Yerpzv','77198bEDWVD','analysis.safety.deadMan.currentRoom','analysis.topology.structure','sendNotification','101272FHHrjs','218298DjfkUQ','\x20f√ºr\x20','(((.+)+)+)+$','üö®\x20NOTFALL-ALARM:\x20Person\x20reagiert\x20nicht\x20in\x20','96aPXCgf','toLowerCase','5096310icwuCa','analysis.safety.deadMan.lastIgnored','analysis.safety.deadMan.alarmState','161mQLxUF','pre_warn','warn','now','error'];a2_0x2f8c=function(){return _0x2517f9;};return a2_0x2f8c();}module['exports']={'updateLocation':updateLocation};