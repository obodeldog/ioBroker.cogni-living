const a2_0x1579c1=a2_0x4ddb;function a2_0x4ddb(_0x527ce8,_0x56dcad){const _0x90baaf=a2_0x4145();return a2_0x4ddb=function(_0x2fd6e0,_0x521c02){_0x2fd6e0=_0x2fd6e0-0x1c3;let _0x414517=_0x90baaf[_0x2fd6e0];return _0x414517;},a2_0x4ddb(_0x527ce8,_0x56dcad);}(function(_0xa4289,_0x124c24){const _0x4147ba=a2_0x4ddb,_0x4fb118=_0xa4289();while(!![]){try{const _0x365283=parseInt(_0x4147ba(0x1f9))/0x1*(parseInt(_0x4147ba(0x1da))/0x2)+parseInt(_0x4147ba(0x1d1))/0x3*(-parseInt(_0x4147ba(0x1dc))/0x4)+parseInt(_0x4147ba(0x1d8))/0x5+-parseInt(_0x4147ba(0x1d0))/0x6+parseInt(_0x4147ba(0x1f8))/0x7+parseInt(_0x4147ba(0x1d6))/0x8*(-parseInt(_0x4147ba(0x1ec))/0x9)+parseInt(_0x4147ba(0x1d2))/0xa;if(_0x365283===_0x124c24)break;else _0x4fb118['push'](_0x4fb118['shift']());}catch(_0x30e1ca){_0x4fb118['push'](_0x4fb118['shift']());}}}(a2_0x4145,0x5c89d));const a2_0x521c02=(function(){let _0x40e7a2=!![];return function(_0x425f42,_0x346f46){const _0x3eaaae=_0x40e7a2?function(){const _0x5355d0=a2_0x4ddb;if(_0x346f46){const _0x236f87=_0x346f46[_0x5355d0(0x1f0)](_0x425f42,arguments);return _0x346f46=null,_0x236f87;}}:function(){};return _0x40e7a2=![],_0x3eaaae;};}()),a2_0x2fd6e0=a2_0x521c02(this,function(){const _0x191a6c=a2_0x4ddb;return a2_0x2fd6e0[_0x191a6c(0x1f5)]()['search'](_0x191a6c(0x1df))['toString']()[_0x191a6c(0x1e3)](a2_0x2fd6e0)['search'](_0x191a6c(0x1df));});a2_0x2fd6e0();'use strict';function a2_0x4145(){const _0x285e82=['4361094dcOgTf','15PlTvIN','4151530nXmDLG','\x27.\x20Nicht\x20verbunden\x20mit\x20Ã¼berwachtem\x20\x27','analysis.safety.deadMan.config','getStateAsync','132672ZoPwme','sendNotification','2515405mrcCey','\x20Min.','163018rOvuYf','warn','51016YqvjCT','analysis.safety.deadMan.napProbability','toFixed','(((.+)+)+)+$','Ignoriere\x20Bewegung\x20in\x20\x27','exports','\x20(Multi-Person\x20Filter)','constructor','val','schlaf','analysis.safety.deadMan.smartSleep','analysis.topology.structure','pre_warn','ðŸ‘¼\x20Schutzengel:\x20Ãœberwache\x20','getHours','ðŸ’¤\x20Smart\x20Sleep\x20erkannt\x20(','279XVZxXS','analysis.safety.deadMan.active','includes','analysis.safety.deadMan.alarmState','apply','Unknown','%).\x20VerlÃ¤ngere\x20Timer\x20fÃ¼r\x20','bed','\x20fÃ¼r\x20','toString','stringify','setStateAsync','2505867DfOgoE','5AoOhga','log','sofa','toLowerCase','[DeadMan]\x20','living','alarm','ðŸ‘¼\x20Schutzengel-Frage:\x20','â³\x20ACHTUNG:\x20UngewÃ¶hnlich\x20lange\x20InaktivitÃ¤t\x20in\x20','replace','default','analysis.safety.deadMan.currentRoom','info','now','indexOf','wohn','.\x20Alles\x20in\x20Ordnung?','parse'];a2_0x4145=function(){return _0x285e82;};return a2_0x4145();}const setup=require('./setup');let activeTimer=null,currentMonitoredRoom=null,timeoutMs=0x0,startTime=0x0,alarmStage=0x0;const DEFAULT_TIMEOUTS={'bad':0x2d,'bath':0x2d,'toilet':0x1e,'wc':0x1e,'keller':0x3c,'schlaf':0x78,'bed':0x78,'guest':0x5a,'gast':0x5a};function getTimeoutRobust(_0x19a2d5,_0x12aa35){const _0xba88c=a2_0x4ddb;if(!_0x19a2d5||!_0x12aa35)return undefined;if(_0x19a2d5[_0x12aa35])return _0x19a2d5[_0x12aa35];const _0x2e7612=_0x12aa35[_0xba88c(0x1fc)]()[_0xba88c(0x1c7)](/[^a-z0-9]/g,'');for(const _0xa2436f in _0x19a2d5){const _0x45ee3d=_0xa2436f[_0xba88c(0x1fc)]()['replace'](/[^a-z0-9]/g,'');if(_0x45ee3d===_0x2e7612)return _0x19a2d5[_0xa2436f];}const _0x431fea=_0x12aa35[_0xba88c(0x1fc)]();if(_0x19a2d5[_0x431fea])return _0x19a2d5[_0x431fea];return undefined;}async function loadConfig(_0x279d73){const _0xdabc8f=a2_0x4ddb;try{const _0x56a076=await _0x279d73['getStateAsync'](_0xdabc8f(0x1d4));if(_0x56a076&&_0x56a076[_0xdabc8f(0x1e4)])return JSON[_0xdabc8f(0x1cf)](_0x56a076['val']);}catch(_0xe5ed2c){}return{};}async function isActive(_0x24e190){const _0x461919=a2_0x4ddb;try{const _0x287622=await _0x24e190[_0x461919(0x1d5)](_0x461919(0x1ed));return _0x287622&&_0x287622[_0x461919(0x1e4)];}catch(_0x7e88cf){return![];}}async function areRoomsConnected(_0x5ec1f6,_0x3c8295,_0x51600d){const _0x90eed5=a2_0x4ddb;try{const _0x1c10d0=await _0x5ec1f6[_0x90eed5(0x1d5)](_0x90eed5(0x1e7));if(!_0x1c10d0||!_0x1c10d0['val'])return!![];const _0x5e5012=JSON['parse'](_0x1c10d0['val']),{rooms:_0x2259a7,matrix:_0x1fb343}=_0x5e5012;if(!_0x2259a7||!_0x1fb343)return!![];const _0x3723ad=_0x2259a7[_0x90eed5(0x1cc)](_0x3c8295),_0x33775b=_0x2259a7[_0x90eed5(0x1cc)](_0x51600d);if(_0x3723ad===-0x1||_0x33775b===-0x1)return!![];const _0x3f38dc=_0x1fb343[_0x3723ad][_0x33775b]>0x0||_0x1fb343[_0x33775b][_0x3723ad]>0x0;return _0x3f38dc;}catch(_0x29b338){return _0x5ec1f6[_0x90eed5(0x1fa)][_0x90eed5(0x1db)]('[DeadMan]\x20Topology\x20check\x20failed:\x20'+_0x29b338['message']),!![];}}function calculateSleepProbability(_0x189534){const _0x524ea2=a2_0x4ddb,_0x4a816=new Date(),_0x1528f3=_0x4a816[_0x524ea2(0x1ea)](),_0x19e94e=_0x189534['toLowerCase']();let _0x34265d=0.1;if(_0x1528f3>=0x17||_0x1528f3<=0x6)_0x34265d=0x1;else{if(_0x1528f3>=0xd&&_0x1528f3<=0xf)_0x34265d=0.8;else{if(_0x1528f3>=0x14&&_0x1528f3<=0x17)_0x34265d=0.4;}}let _0xcc3003=0.1;if(_0x19e94e[_0x524ea2(0x1ee)](_0x524ea2(0x1e5))||_0x19e94e[_0x524ea2(0x1ee)](_0x524ea2(0x1f3)))_0xcc3003=0x1;else{if(_0x19e94e[_0x524ea2(0x1ee)](_0x524ea2(0x1cd))||_0x19e94e['includes'](_0x524ea2(0x1c3))||_0x19e94e[_0x524ea2(0x1ee)](_0x524ea2(0x1fb)))_0xcc3003=0.6;else{if(_0x19e94e[_0x524ea2(0x1ee)]('bad')||_0x19e94e[_0x524ea2(0x1ee)]('wc'))_0xcc3003=0.05;}}let _0x381d48=0.5;const _0x48aeac=_0xcc3003*0.5+_0x34265d*0.3+_0x381d48*0.2;return parseFloat(_0x48aeac[_0x524ea2(0x1de)](0x2));}async function updateLocation(_0x91a133,_0x50db95){const _0x3c051b=a2_0x4ddb;if(!_0x50db95||_0x50db95===_0x3c051b(0x1f1))return;if(!await isActive(_0x91a133)){resetTimer(_0x91a133);return;}if(currentMonitoredRoom&&currentMonitoredRoom!==_0x50db95){const _0x22a139=await areRoomsConnected(_0x91a133,currentMonitoredRoom,_0x50db95);if(!_0x22a139){const _0x2ea25e=_0x3c051b(0x1e0)+_0x50db95+_0x3c051b(0x1d3)+currentMonitoredRoom+'\x27.';_0x91a133[_0x3c051b(0x1fa)][_0x3c051b(0x1ca)](_0x3c051b(0x1fd)+_0x2ea25e+_0x3c051b(0x1e2)),await _0x91a133[_0x3c051b(0x1f7)]('analysis.safety.deadMan.lastIgnored',{'val':JSON[_0x3c051b(0x1f6)]({'room':_0x50db95,'reason':_0x2ea25e,'timestamp':Date[_0x3c051b(0x1cb)]()}),'ack':!![]});return;}resetTimer(_0x91a133);}if(!currentMonitoredRoom){await _0x91a133[_0x3c051b(0x1f7)](_0x3c051b(0x1c9),{'val':_0x50db95,'ack':!![]});const _0x5a8ddd=await loadConfig(_0x91a133);let _0x4784e9=getTimeoutRobust(_0x5a8ddd,_0x50db95);const _0x4774d2=_0x50db95[_0x3c051b(0x1fc)]();if(!_0x4784e9)for(const _0x3f5393 in DEFAULT_TIMEOUTS){if(_0x4774d2[_0x3c051b(0x1ee)](_0x3f5393)){_0x4784e9=DEFAULT_TIMEOUTS[_0x3f5393];break;}}if(!_0x4784e9&&_0x5a8ddd[_0x3c051b(0x1c8)])_0x4784e9=_0x5a8ddd[_0x3c051b(0x1c8)];if(!_0x4784e9)return;currentMonitoredRoom=_0x50db95,startTimer(_0x91a133,_0x4784e9,_0x50db95);}}function startTimer(_0x130283,_0x352435,_0x33b2dc){const _0x1c0847=a2_0x4ddb;if(activeTimer)clearTimeout(activeTimer);timeoutMs=_0x352435*0x3c*0x3e8,startTime=Date[_0x1c0847(0x1cb)](),alarmStage=0x0;const _0x276349=calculateSleepProbability(_0x33b2dc||currentMonitoredRoom),_0x468c54=_0x276349>0.65;_0x468c54?(timeoutMs+=0x5a*0x3c*0x3e8,_0x130283[_0x1c0847(0x1fa)][_0x1c0847(0x1ca)](_0x1c0847(0x1eb)+(_0x276349*0x64)[_0x1c0847(0x1de)](0x0)+_0x1c0847(0x1f2)+currentMonitoredRoom+'\x20um\x2090\x20Min.'),_0x130283[_0x1c0847(0x1f7)]('analysis.safety.deadMan.smartSleep',{'val':!![],'ack':!![]})):_0x130283[_0x1c0847(0x1f7)](_0x1c0847(0x1e6),{'val':![],'ack':!![]}),_0x130283['setStateAsync'](_0x1c0847(0x1dd),{'val':_0x276349,'ack':!![]}),_0x130283[_0x1c0847(0x1fa)][_0x1c0847(0x1ca)](_0x1c0847(0x1e9)+currentMonitoredRoom+_0x1c0847(0x1f4)+_0x352435+_0x1c0847(0x1d9)),_0x130283[_0x1c0847(0x1f7)]('analysis.safety.deadMan.alarmState',{'val':'ok','ack':!![]}),activeTimer=setTimeout(()=>triggerPreWarn(_0x130283),timeoutMs);}function resetTimer(_0x193310){const _0x3c4f6b=a2_0x4ddb;if(activeTimer)clearTimeout(activeTimer);activeTimer=null,currentMonitoredRoom=null,alarmStage=0x0,_0x193310[_0x3c4f6b(0x1f7)](_0x3c4f6b(0x1ef),{'val':'ok','ack':!![]}),_0x193310['setStateAsync'](_0x3c4f6b(0x1e6),{'val':![],'ack':!![]}),_0x193310['setStateAsync']('analysis.safety.deadMan.napProbability',{'val':0x0,'ack':!![]});}async function triggerPreWarn(_0x53628a){const _0x5c3f0a=a2_0x4ddb;alarmStage=0x1,await _0x53628a['setStateAsync'](_0x5c3f0a(0x1ef),{'val':_0x5c3f0a(0x1e8),'ack':!![]});const _0x3d283b=_0x5c3f0a(0x1c6)+currentMonitoredRoom+_0x5c3f0a(0x1ce);_0x53628a[_0x5c3f0a(0x1fa)]['warn']('[DeadMan]\x20'+_0x3d283b),await setup[_0x5c3f0a(0x1d7)](_0x53628a,_0x5c3f0a(0x1c5)+_0x3d283b),activeTimer=setTimeout(()=>triggerAlarm(_0x53628a),0x5*0x3c*0x3e8);}async function triggerAlarm(_0x360095){const _0x23754b=a2_0x4ddb;alarmStage=0x2,await _0x360095[_0x23754b(0x1f7)]('analysis.safety.deadMan.alarmState',{'val':_0x23754b(0x1c4),'ack':!![]});const _0x3e45e7='ðŸš¨\x20NOTFALL-ALARM:\x20Person\x20reagiert\x20nicht\x20in\x20'+currentMonitoredRoom+'!';_0x360095[_0x23754b(0x1fa)]['error'](_0x23754b(0x1fd)+_0x3e45e7),await setup['sendNotification'](_0x360095,_0x3e45e7,![],!![]);}module[a2_0x1579c1(0x1e1)]={'updateLocation':updateLocation};