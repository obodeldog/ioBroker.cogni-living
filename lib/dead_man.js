function a2_0xd169(_0x2fbaf7,_0x2dd5fb){const _0x9c6e94=a2_0x4a38();return a2_0xd169=function(_0x18de32,_0x56b3a3){_0x18de32=_0x18de32-0x6c;let _0x4a3867=_0x9c6e94[_0x18de32];return _0x4a3867;},a2_0xd169(_0x2fbaf7,_0x2dd5fb);}(function(_0x211cf3,_0x578f4e){const _0x15d023=a2_0xd169,_0x30f14f=_0x211cf3();while(!![]){try{const _0x4c9ce3=-parseInt(_0x15d023(0x9c))/0x1+parseInt(_0x15d023(0x83))/0x2*(-parseInt(_0x15d023(0x82))/0x3)+parseInt(_0x15d023(0x7a))/0x4+parseInt(_0x15d023(0x76))/0x5*(-parseInt(_0x15d023(0x78))/0x6)+-parseInt(_0x15d023(0x8c))/0x7*(parseInt(_0x15d023(0x72))/0x8)+-parseInt(_0x15d023(0x86))/0x9+parseInt(_0x15d023(0x6f))/0xa;if(_0x4c9ce3===_0x578f4e)break;else _0x30f14f['push'](_0x30f14f['shift']());}catch(_0x58f446){_0x30f14f['push'](_0x30f14f['shift']());}}}(a2_0x4a38,0x4fc7a));const a2_0x56b3a3=(function(){let _0x183f49=!![];return function(_0x44740f,_0x33a00d){const _0x2bc962=_0x183f49?function(){if(_0x33a00d){const _0x49ff30=_0x33a00d['apply'](_0x44740f,arguments);return _0x33a00d=null,_0x49ff30;}}:function(){};return _0x183f49=![],_0x2bc962;};}()),a2_0x18de32=a2_0x56b3a3(this,function(){const _0x5d721f=a2_0xd169;return a2_0x18de32[_0x5d721f(0x89)]()[_0x5d721f(0x71)](_0x5d721f(0x9d))['toString']()[_0x5d721f(0x87)](a2_0x18de32)['search'](_0x5d721f(0x9d));});a2_0x18de32();function a2_0x4a38(){const _0x417c2d=['21Isvuit','ðŸ’¤\x20Smart\x20Sleep\x20erkannt\x20(','parse','%).\x20VerlÃ¤ngere\x20Timer\x20fÃ¼r\x20','bad','setStateAsync','getStateAsync','â³\x20ACHTUNG:\x20UngewÃ¶hnlich\x20lange\x20InaktivitÃ¤t\x20in\x20','living','analysis.safety.deadMan.config','sendNotification','[DeadMan]\x20','replace','val','getHours','includes','642624yRoGTK','(((.+)+)+)+$','warn','analysis.safety.deadMan.active','schlaf','alarm','26476290rZCArL','bed','search','738696dVqDzp','\x27.\x20Nicht\x20verbunden\x20mit\x20Ã¼berwachtem\x20\x27','sofa','error','2429550BItjKp','message','6mANflM','Unknown','870308bcXkwG','toFixed','now','analysis.safety.deadMan.alarmState','log','indexOf','ðŸš¨\x20NOTFALL-ALARM:\x20Person\x20reagiert\x20nicht\x20in\x20','.\x20Alles\x20in\x20Ordnung?','929862HoTqoE','4uXzWmE','toLowerCase','analysis.topology.structure','4616775BTwoio','constructor','info','toString','pre_warn','[DeadMan]\x20Topology\x20check\x20failed:\x20'];a2_0x4a38=function(){return _0x417c2d;};return a2_0x4a38();}'use strict';const setup=require('./setup');let activeTimer=null,currentMonitoredRoom=null,timeoutMs=0x0,startTime=0x0,alarmStage=0x0;const DEFAULT_TIMEOUTS={'bad':0x2d,'bath':0x2d,'toilet':0x1e,'wc':0x1e,'keller':0x3c,'schlaf':0x78,'bed':0x78,'guest':0x5a,'gast':0x5a};function getTimeoutRobust(_0x5e2c8b,_0x54c83b){const _0x277d2e=a2_0xd169;if(!_0x5e2c8b||!_0x54c83b)return undefined;if(_0x5e2c8b[_0x54c83b])return _0x5e2c8b[_0x54c83b];const _0x552f23=_0x54c83b['toLowerCase']()[_0x277d2e(0x98)](/[^a-z0-9]/g,'');for(const _0x4ea5bc in _0x5e2c8b){const _0x47201f=_0x4ea5bc[_0x277d2e(0x84)]()[_0x277d2e(0x98)](/[^a-z0-9]/g,'');if(_0x47201f===_0x552f23)return _0x5e2c8b[_0x4ea5bc];}const _0x1c7bed=_0x54c83b[_0x277d2e(0x84)]();if(_0x5e2c8b[_0x1c7bed])return _0x5e2c8b[_0x1c7bed];return undefined;}async function loadConfig(_0x2bbd92){const _0x378c29=a2_0xd169;try{const _0x56900a=await _0x2bbd92[_0x378c29(0x92)](_0x378c29(0x95));if(_0x56900a&&_0x56900a[_0x378c29(0x99)])return JSON[_0x378c29(0x8e)](_0x56900a[_0x378c29(0x99)]);}catch(_0x36cd52){}return{};}async function isActive(_0x354a74){const _0x851927=a2_0xd169;try{const _0x405a9a=await _0x354a74[_0x851927(0x92)](_0x851927(0x6c));return _0x405a9a&&_0x405a9a['val'];}catch(_0xe93196){return![];}}async function areRoomsConnected(_0x4573e6,_0x13b1bb,_0x32e247){const _0x379054=a2_0xd169;try{const _0x1e071f=await _0x4573e6['getStateAsync'](_0x379054(0x85));if(!_0x1e071f||!_0x1e071f[_0x379054(0x99)])return!![];const _0x4fb707=JSON[_0x379054(0x8e)](_0x1e071f[_0x379054(0x99)]),{rooms:_0x22c4cf,matrix:_0x4f5d09}=_0x4fb707;if(!_0x22c4cf||!_0x4f5d09)return!![];const _0x483f14=_0x22c4cf[_0x379054(0x7f)](_0x13b1bb),_0x3f8094=_0x22c4cf[_0x379054(0x7f)](_0x32e247);if(_0x483f14===-0x1||_0x3f8094===-0x1)return!![];const _0x181b8d=_0x4f5d09[_0x483f14][_0x3f8094]>0x0||_0x4f5d09[_0x3f8094][_0x483f14]>0x0;return _0x181b8d;}catch(_0x233f72){return _0x4573e6['log'][_0x379054(0x9e)](_0x379054(0x8b)+_0x233f72[_0x379054(0x77)]),!![];}}function calculateSleepProbability(_0x150031){const _0x54da6f=a2_0xd169,_0x40d4e9=new Date(),_0x5a1a06=_0x40d4e9[_0x54da6f(0x9a)](),_0x41a3d3=_0x150031[_0x54da6f(0x84)]();let _0x3d60b6=0.1;if(_0x5a1a06>=0x17||_0x5a1a06<=0x6)_0x3d60b6=0x1;else{if(_0x5a1a06>=0xd&&_0x5a1a06<=0xf)_0x3d60b6=0.8;else{if(_0x5a1a06>=0x14&&_0x5a1a06<=0x17)_0x3d60b6=0.4;}}let _0x4b4436=0.1;if(_0x41a3d3[_0x54da6f(0x9b)](_0x54da6f(0x6d))||_0x41a3d3[_0x54da6f(0x9b)](_0x54da6f(0x70)))_0x4b4436=0x1;else{if(_0x41a3d3[_0x54da6f(0x9b)]('wohn')||_0x41a3d3[_0x54da6f(0x9b)](_0x54da6f(0x94))||_0x41a3d3[_0x54da6f(0x9b)](_0x54da6f(0x74)))_0x4b4436=0.6;else{if(_0x41a3d3[_0x54da6f(0x9b)](_0x54da6f(0x90))||_0x41a3d3['includes']('wc'))_0x4b4436=0.05;}}let _0x3e587a=0.5;const _0x592d43=_0x4b4436*0.5+_0x3d60b6*0.3+_0x3e587a*0.2;return parseFloat(_0x592d43['toFixed'](0x2));}async function updateLocation(_0x5ee59a,_0x3bbc74){const _0x59c547=a2_0xd169;if(!_0x3bbc74||_0x3bbc74===_0x59c547(0x79))return;if(!await isActive(_0x5ee59a)){resetTimer(_0x5ee59a);return;}if(currentMonitoredRoom&&currentMonitoredRoom!==_0x3bbc74){const _0xad5ee7=await areRoomsConnected(_0x5ee59a,currentMonitoredRoom,_0x3bbc74);if(!_0xad5ee7){const _0x58df14='Ignoriere\x20Bewegung\x20in\x20\x27'+_0x3bbc74+_0x59c547(0x73)+currentMonitoredRoom+'\x27.';_0x5ee59a[_0x59c547(0x7e)][_0x59c547(0x88)]('[DeadMan]\x20'+_0x58df14+'\x20(Multi-Person\x20Filter)'),await _0x5ee59a['setStateAsync']('analysis.safety.deadMan.lastIgnored',{'val':JSON['stringify']({'room':_0x3bbc74,'reason':_0x58df14,'timestamp':Date[_0x59c547(0x7c)]()}),'ack':!![]});return;}resetTimer(_0x5ee59a);}if(!currentMonitoredRoom){await _0x5ee59a[_0x59c547(0x91)]('analysis.safety.deadMan.currentRoom',{'val':_0x3bbc74,'ack':!![]});const _0x259a15=await loadConfig(_0x5ee59a);let _0x2acba8=getTimeoutRobust(_0x259a15,_0x3bbc74);const _0x4591d8=_0x3bbc74[_0x59c547(0x84)]();if(!_0x2acba8)for(const _0x2e5601 in DEFAULT_TIMEOUTS){if(_0x4591d8[_0x59c547(0x9b)](_0x2e5601)){_0x2acba8=DEFAULT_TIMEOUTS[_0x2e5601];break;}}if(!_0x2acba8&&_0x259a15['default'])_0x2acba8=_0x259a15['default'];if(!_0x2acba8)return;currentMonitoredRoom=_0x3bbc74,startTimer(_0x5ee59a,_0x2acba8,_0x3bbc74);}}function startTimer(_0x169d52,_0x190fed,_0x4d4354){const _0x2d379e=a2_0xd169;if(activeTimer)clearTimeout(activeTimer);timeoutMs=_0x190fed*0x3c*0x3e8,startTime=Date[_0x2d379e(0x7c)](),alarmStage=0x0;const _0x288ab7=calculateSleepProbability(_0x4d4354||currentMonitoredRoom),_0x1f6b84=_0x288ab7>0.65;_0x1f6b84?(timeoutMs+=0x5a*0x3c*0x3e8,_0x169d52[_0x2d379e(0x7e)]['info'](_0x2d379e(0x8d)+(_0x288ab7*0x64)[_0x2d379e(0x7b)](0x0)+_0x2d379e(0x8f)+currentMonitoredRoom+'\x20um\x2090\x20Min.'),_0x169d52['setStateAsync']('analysis.safety.deadMan.smartSleep',{'val':!![],'ack':!![]})):_0x169d52[_0x2d379e(0x91)]('analysis.safety.deadMan.smartSleep',{'val':![],'ack':!![]}),_0x169d52[_0x2d379e(0x91)]('analysis.safety.deadMan.napProbability',{'val':_0x288ab7,'ack':!![]}),_0x169d52[_0x2d379e(0x7e)][_0x2d379e(0x88)]('ðŸ‘¼\x20Schutzengel:\x20Ãœberwache\x20'+currentMonitoredRoom+'\x20fÃ¼r\x20'+_0x190fed+'\x20Min.'),_0x169d52[_0x2d379e(0x91)](_0x2d379e(0x7d),{'val':'ok','ack':!![]}),activeTimer=setTimeout(()=>triggerPreWarn(_0x169d52),timeoutMs);}function resetTimer(_0xe7b683){const _0x5e642a=a2_0xd169;if(activeTimer)clearTimeout(activeTimer);activeTimer=null,currentMonitoredRoom=null,alarmStage=0x0,_0xe7b683[_0x5e642a(0x91)](_0x5e642a(0x7d),{'val':'ok','ack':!![]}),_0xe7b683[_0x5e642a(0x91)]('analysis.safety.deadMan.smartSleep',{'val':![],'ack':!![]}),_0xe7b683[_0x5e642a(0x91)]('analysis.safety.deadMan.napProbability',{'val':0x0,'ack':!![]});}async function triggerPreWarn(_0x42d6c9){const _0x3c1dee=a2_0xd169;alarmStage=0x1,await _0x42d6c9[_0x3c1dee(0x91)](_0x3c1dee(0x7d),{'val':_0x3c1dee(0x8a),'ack':!![]});const _0x222adb=_0x3c1dee(0x93)+currentMonitoredRoom+_0x3c1dee(0x81);_0x42d6c9[_0x3c1dee(0x7e)][_0x3c1dee(0x9e)]('[DeadMan]\x20'+_0x222adb),await setup[_0x3c1dee(0x96)](_0x42d6c9,'ðŸ‘¼\x20Schutzengel-Frage:\x20'+_0x222adb),activeTimer=setTimeout(()=>triggerAlarm(_0x42d6c9),0x5*0x3c*0x3e8);}async function triggerAlarm(_0x41309b){const _0x5d7fdd=a2_0xd169;alarmStage=0x2,await _0x41309b[_0x5d7fdd(0x91)](_0x5d7fdd(0x7d),{'val':_0x5d7fdd(0x6e),'ack':!![]});const _0xad952b=_0x5d7fdd(0x80)+currentMonitoredRoom+'!';_0x41309b[_0x5d7fdd(0x7e)][_0x5d7fdd(0x75)](_0x5d7fdd(0x97)+_0xad952b),await setup[_0x5d7fdd(0x96)](_0x41309b,_0xad952b,![],!![]);}module['exports']={'updateLocation':updateLocation};