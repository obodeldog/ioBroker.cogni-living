const a2_0x4cd33e=a2_0x2efc;(function(_0x2f4c92,_0x596d1c){const _0x4fe29b=a2_0x2efc,_0x5821f8=_0x2f4c92();while(!![]){try{const _0x4678f1=parseInt(_0x4fe29b(0x1b8))/0x1*(parseInt(_0x4fe29b(0x1ba))/0x2)+parseInt(_0x4fe29b(0x1bc))/0x3*(parseInt(_0x4fe29b(0x1d2))/0x4)+parseInt(_0x4fe29b(0x1b7))/0x5*(parseInt(_0x4fe29b(0x1c7))/0x6)+parseInt(_0x4fe29b(0x1ad))/0x7+-parseInt(_0x4fe29b(0x1ca))/0x8*(parseInt(_0x4fe29b(0x1cc))/0x9)+parseInt(_0x4fe29b(0x1ab))/0xa+-parseInt(_0x4fe29b(0x1c2))/0xb;if(_0x4678f1===_0x596d1c)break;else _0x5821f8['push'](_0x5821f8['shift']());}catch(_0x40ae51){_0x5821f8['push'](_0x5821f8['shift']());}}}(a2_0x150c,0xb9f72));const a2_0x4aab3f=(function(){let _0x20eddb=!![];return function(_0x3380a0,_0x8e2b5c){const _0x4e15de=_0x20eddb?function(){const _0x3420ac=a2_0x2efc;if(_0x8e2b5c){const _0x188490=_0x8e2b5c[_0x3420ac(0x1d4)](_0x3380a0,arguments);return _0x8e2b5c=null,_0x188490;}}:function(){};return _0x20eddb=![],_0x4e15de;};}()),a2_0x45368c=a2_0x4aab3f(this,function(){const _0x10b8e0=a2_0x2efc;return a2_0x45368c[_0x10b8e0(0x1ae)]()[_0x10b8e0(0x1cb)]('(((.+)+)+)+$')['toString']()[_0x10b8e0(0x1a3)](a2_0x45368c)[_0x10b8e0(0x1cb)](_0x10b8e0(0x1b4));});a2_0x45368c();function a2_0x2efc(_0x13136c,_0x2c74ca){const _0x1ee08f=a2_0x150c();return a2_0x2efc=function(_0x45368c,_0x4aab3f){_0x45368c=_0x45368c-0x19f;let _0x150c37=_0x1ee08f[_0x45368c];return _0x150c37;},a2_0x2efc(_0x13136c,_0x2c74ca);}'use strict';const setup=require('./setup');let activeTimer=null,currentMonitoredRoom=null,timeoutMs=0x0,startTime=0x0,alarmStage=0x0;const DEFAULT_TIMEOUTS={'bad':0x2d,'bath':0x2d,'toilet':0x1e,'wc':0x1e,'keller':0x3c,'schlaf':0x78,'bed':0x78,'guest':0x5a,'gast':0x5a};function getTimeoutRobust(_0x171111,_0x15d9fe){const _0xdc19db=a2_0x2efc;if(!_0x171111||!_0x15d9fe)return undefined;if(_0x171111[_0x15d9fe])return _0x171111[_0x15d9fe];const _0x348c5a=_0x15d9fe[_0xdc19db(0x1c4)]()['replace'](/[^a-z0-9]/g,'');for(const _0x437152 in _0x171111){const _0x45398d=_0x437152['toLowerCase']()[_0xdc19db(0x1a0)](/[^a-z0-9]/g,'');if(_0x45398d===_0x348c5a)return _0x171111[_0x437152];}const _0x517c1d=_0x15d9fe['toLowerCase']();if(_0x171111[_0x517c1d])return _0x171111[_0x517c1d];return undefined;}function a2_0x150c(){const _0x3b1337=['sendNotification','warn','analysis.safety.deadMan.napProbability','wohn','5372310WOpXAP','Ignoriere\x20Bewegung\x20in\x20\x27','8325653ztwSrT','toString','parse','pre_warn','log','analysis.safety.deadMan.config','analysis.safety.deadMan.alarmState','(((.+)+)+)+$','exports','toFixed','2740ntoFMy','37Qlgchm','now','25082Dljthe','ðŸ‘¼\x20Schutzengel:\x20Ãœberwache\x20','168171IliiDJ','[DeadMan]\x20Topology\x20check\x20failed:\x20','[DeadMan]\x20','ðŸ‘¼\x20Schutzengel-Frage:\x20','schlaf','val','16804227hVxHCW','.\x20Alles\x20in\x20Ordnung?','toLowerCase','ðŸš¨\x20NOTFALL-ALARM:\x20Person\x20reagiert\x20nicht\x20in\x20','analysis.safety.deadMan.active','6294CbfJTN','info','\x27.\x20Nicht\x20verbunden\x20mit\x20Ã¼berwachtem\x20\x27','8DrHdwE','search','7312050vTXBdK','getStateAsync','includes','indexOf','setStateAsync','\x20um\x2090\x20Min.','24sOjQWK','\x20fÃ¼r\x20','apply','%).\x20VerlÃ¤ngere\x20Timer\x20fÃ¼r\x20','getHours','replace','message','\x20Min.','constructor','analysis.safety.deadMan.currentRoom','analysis.safety.deadMan.smartSleep','default'];a2_0x150c=function(){return _0x3b1337;};return a2_0x150c();}async function loadConfig(_0x36de46){const _0x451a71=a2_0x2efc;try{const _0x1bf63e=await _0x36de46['getStateAsync'](_0x451a71(0x1b2));if(_0x1bf63e&&_0x1bf63e[_0x451a71(0x1c1)])return JSON[_0x451a71(0x1af)](_0x1bf63e[_0x451a71(0x1c1)]);}catch(_0x1d9a95){}return{};}async function isActive(_0x1eca64){const _0x153860=a2_0x2efc;try{const _0x2b87c1=await _0x1eca64['getStateAsync'](_0x153860(0x1c6));return _0x2b87c1&&_0x2b87c1[_0x153860(0x1c1)];}catch(_0x497020){return![];}}async function areRoomsConnected(_0x558646,_0xaa9349,_0x5d1650){const _0x25f6bd=a2_0x2efc;try{const _0x16ce81=await _0x558646[_0x25f6bd(0x1cd)]('analysis.topology.structure');if(!_0x16ce81||!_0x16ce81[_0x25f6bd(0x1c1)])return!![];const _0x1c662d=JSON[_0x25f6bd(0x1af)](_0x16ce81[_0x25f6bd(0x1c1)]),{rooms:_0x97bdb5,matrix:_0xbee9f3}=_0x1c662d;if(!_0x97bdb5||!_0xbee9f3)return!![];const _0x43b66e=_0x97bdb5['indexOf'](_0xaa9349),_0x1ad643=_0x97bdb5[_0x25f6bd(0x1cf)](_0x5d1650);if(_0x43b66e===-0x1||_0x1ad643===-0x1)return!![];const _0x2c3d04=_0xbee9f3[_0x43b66e][_0x1ad643]>0x0||_0xbee9f3[_0x1ad643][_0x43b66e]>0x0;return _0x2c3d04;}catch(_0x4e0ca3){return _0x558646[_0x25f6bd(0x1b1)]['warn'](_0x25f6bd(0x1bd)+_0x4e0ca3[_0x25f6bd(0x1a1)]),!![];}}function calculateSleepProbability(_0x29e590){const _0x3d9577=a2_0x2efc,_0x2d79de=new Date(),_0x18f7e6=_0x2d79de[_0x3d9577(0x19f)](),_0x55fea1=_0x29e590['toLowerCase']();let _0x2f1faf=0.1;if(_0x18f7e6>=0x17||_0x18f7e6<=0x6)_0x2f1faf=0x1;else{if(_0x18f7e6>=0xd&&_0x18f7e6<=0xf)_0x2f1faf=0.8;else{if(_0x18f7e6>=0x14&&_0x18f7e6<=0x17)_0x2f1faf=0.4;}}let _0x35f10c=0.1;if(_0x55fea1[_0x3d9577(0x1ce)](_0x3d9577(0x1c0))||_0x55fea1['includes']('bed'))_0x35f10c=0x1;else{if(_0x55fea1[_0x3d9577(0x1ce)](_0x3d9577(0x1aa))||_0x55fea1['includes']('living')||_0x55fea1[_0x3d9577(0x1ce)]('sofa'))_0x35f10c=0.6;else{if(_0x55fea1[_0x3d9577(0x1ce)]('bad')||_0x55fea1['includes']('wc'))_0x35f10c=0.05;}}let _0x3f1e1a=0.5;const _0x3d88dc=_0x35f10c*0.5+_0x2f1faf*0.3+_0x3f1e1a*0.2;return parseFloat(_0x3d88dc[_0x3d9577(0x1b6)](0x2));}async function updateLocation(_0x1e3de2,_0x45b57b){const _0x4fb099=a2_0x2efc;if(!_0x45b57b||_0x45b57b==='Unknown')return;if(!await isActive(_0x1e3de2)){resetTimer(_0x1e3de2);return;}if(currentMonitoredRoom&&currentMonitoredRoom!==_0x45b57b){const _0x506dc2=await areRoomsConnected(_0x1e3de2,currentMonitoredRoom,_0x45b57b);if(!_0x506dc2){const _0x499393=_0x4fb099(0x1ac)+_0x45b57b+_0x4fb099(0x1c9)+currentMonitoredRoom+'\x27.';_0x1e3de2[_0x4fb099(0x1b1)][_0x4fb099(0x1c8)](_0x4fb099(0x1be)+_0x499393+'\x20(Multi-Person\x20Filter)'),await _0x1e3de2['setStateAsync']('analysis.safety.deadMan.lastIgnored',{'val':JSON['stringify']({'room':_0x45b57b,'reason':_0x499393,'timestamp':Date[_0x4fb099(0x1b9)]()}),'ack':!![]});return;}resetTimer(_0x1e3de2);}if(!currentMonitoredRoom){await _0x1e3de2[_0x4fb099(0x1d0)](_0x4fb099(0x1a4),{'val':_0x45b57b,'ack':!![]});const _0x46e57=await loadConfig(_0x1e3de2);let _0x4a73b5=getTimeoutRobust(_0x46e57,_0x45b57b);const _0x17890d=_0x45b57b[_0x4fb099(0x1c4)]();if(!_0x4a73b5)for(const _0x2805e5 in DEFAULT_TIMEOUTS){if(_0x17890d[_0x4fb099(0x1ce)](_0x2805e5)){_0x4a73b5=DEFAULT_TIMEOUTS[_0x2805e5];break;}}if(!_0x4a73b5&&_0x46e57[_0x4fb099(0x1a6)])_0x4a73b5=_0x46e57['default'];if(!_0x4a73b5)return;currentMonitoredRoom=_0x45b57b,startTimer(_0x1e3de2,_0x4a73b5,_0x45b57b);}}function startTimer(_0x14ea1b,_0x258798,_0x33a661){const _0x594129=a2_0x2efc;if(activeTimer)clearTimeout(activeTimer);timeoutMs=_0x258798*0x3c*0x3e8,startTime=Date[_0x594129(0x1b9)](),alarmStage=0x0;const _0x49d524=calculateSleepProbability(_0x33a661||currentMonitoredRoom),_0x3fce1c=_0x49d524>0.65;_0x3fce1c?(timeoutMs+=0x5a*0x3c*0x3e8,_0x14ea1b[_0x594129(0x1b1)]['info']('ðŸ’¤\x20Smart\x20Sleep\x20erkannt\x20('+(_0x49d524*0x64)[_0x594129(0x1b6)](0x0)+_0x594129(0x1d5)+currentMonitoredRoom+_0x594129(0x1d1)),_0x14ea1b['setStateAsync'](_0x594129(0x1a5),{'val':!![],'ack':!![]})):_0x14ea1b[_0x594129(0x1d0)](_0x594129(0x1a5),{'val':![],'ack':!![]}),_0x14ea1b[_0x594129(0x1d0)](_0x594129(0x1a9),{'val':_0x49d524,'ack':!![]}),_0x14ea1b[_0x594129(0x1b1)][_0x594129(0x1c8)](_0x594129(0x1bb)+currentMonitoredRoom+_0x594129(0x1d3)+_0x258798+_0x594129(0x1a2)),_0x14ea1b['setStateAsync'](_0x594129(0x1b3),{'val':'ok','ack':!![]}),activeTimer=setTimeout(()=>triggerPreWarn(_0x14ea1b),timeoutMs);}function resetTimer(_0x1f3509){const _0x1a4898=a2_0x2efc;if(activeTimer)clearTimeout(activeTimer);activeTimer=null,currentMonitoredRoom=null,alarmStage=0x0,_0x1f3509['setStateAsync'](_0x1a4898(0x1b3),{'val':'ok','ack':!![]}),_0x1f3509[_0x1a4898(0x1d0)](_0x1a4898(0x1a5),{'val':![],'ack':!![]}),_0x1f3509[_0x1a4898(0x1d0)](_0x1a4898(0x1a9),{'val':0x0,'ack':!![]});}async function triggerPreWarn(_0x332855){const _0x3d8bae=a2_0x2efc;alarmStage=0x1,await _0x332855[_0x3d8bae(0x1d0)](_0x3d8bae(0x1b3),{'val':_0x3d8bae(0x1b0),'ack':!![]});const _0x2321e6='â³\x20ACHTUNG:\x20UngewÃ¶hnlich\x20lange\x20InaktivitÃ¤t\x20in\x20'+currentMonitoredRoom+_0x3d8bae(0x1c3);_0x332855['log'][_0x3d8bae(0x1a8)]('[DeadMan]\x20'+_0x2321e6),await setup[_0x3d8bae(0x1a7)](_0x332855,_0x3d8bae(0x1bf)+_0x2321e6),activeTimer=setTimeout(()=>triggerAlarm(_0x332855),0x5*0x3c*0x3e8);}async function triggerAlarm(_0x291e87){const _0x10b460=a2_0x2efc;alarmStage=0x2,await _0x291e87[_0x10b460(0x1d0)]('analysis.safety.deadMan.alarmState',{'val':'alarm','ack':!![]});const _0x4c043c=_0x10b460(0x1c5)+currentMonitoredRoom+'!';_0x291e87[_0x10b460(0x1b1)]['error'](_0x10b460(0x1be)+_0x4c043c),await setup[_0x10b460(0x1a7)](_0x291e87,_0x4c043c,![],!![]);}module[a2_0x4cd33e(0x1b5)]={'updateLocation':updateLocation};