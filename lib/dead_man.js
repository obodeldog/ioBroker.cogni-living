const a2_0xeea0ce=a2_0x4dc5;(function(_0x3a9eeb,_0x3e30c3){const _0x1fe460=a2_0x4dc5,_0x24c856=_0x3a9eeb();while(!![]){try{const _0x66c79c=parseInt(_0x1fe460(0x79))/0x1+parseInt(_0x1fe460(0x89))/0x2+-parseInt(_0x1fe460(0x9b))/0x3+-parseInt(_0x1fe460(0x70))/0x4+-parseInt(_0x1fe460(0x73))/0x5*(-parseInt(_0x1fe460(0x91))/0x6)+parseInt(_0x1fe460(0x87))/0x7*(-parseInt(_0x1fe460(0x94))/0x8)+parseInt(_0x1fe460(0x84))/0x9;if(_0x66c79c===_0x3e30c3)break;else _0x24c856['push'](_0x24c856['shift']());}catch(_0x5e8bfe){_0x24c856['push'](_0x24c856['shift']());}}}(a2_0x59b8,0xc8781));const a2_0x44e9cd=(function(){let _0x36100e=!![];return function(_0x4b71bf,_0x215945){const _0x5c518b=_0x36100e?function(){if(_0x215945){const _0x3b9abe=_0x215945['apply'](_0x4b71bf,arguments);return _0x215945=null,_0x3b9abe;}}:function(){};return _0x36100e=![],_0x5c518b;};}()),a2_0x5f40fd=a2_0x44e9cd(this,function(){const _0x3da402=a2_0x4dc5;return a2_0x5f40fd['toString']()[_0x3da402(0x99)](_0x3da402(0x8e))['toString']()[_0x3da402(0x6c)](a2_0x5f40fd)[_0x3da402(0x99)]('(((.+)+)+)+$');});a2_0x5f40fd();'use strict';const setup=require('./setup');function a2_0x59b8(){const _0x5de814=['ðŸ‘¼\x20Schutzengel-Frage:\x20','15076638eTZlWn','indexOf','ðŸš¨\x20NOTFALL-ALARM:\x20Person\x20reagiert\x20nicht\x20in\x20','364833IAEltn','analysis.topology.structure','1667314WqgQNn','getHours','bed','\x20um\x2090\x20Min.','includes','(((.+)+)+)+$','%).\x20VerlÃ¤ngere\x20Timer\x20fÃ¼r\x20','default','12DpJyVz','analysis.safety.deadMan.napProbability','warn','216gAJlLk','now','schlaf','Unknown','toLowerCase','search','analysis.safety.deadMan.currentRoom','2105256ZfjxDQ','analysis.safety.deadMan.smartSleep','sendNotification','â³\x20ACHTUNG:\x20UngewÃ¶hnlich\x20lange\x20InaktivitÃ¤t\x20in\x20','[DeadMan]\x20','Ignoriere\x20Bewegung\x20in\x20\x27','parse','analysis.safety.deadMan.alarmState','info','alarm','constructor','sofa','.\x20Alles\x20in\x20Ordnung?','\x27.\x20Nicht\x20verbunden\x20mit\x20Ã¼berwachtem\x20\x27','665712tbcbsl','ðŸ‘¼\x20Schutzengel:\x20Ãœberwache\x20','analysis.safety.deadMan.lastIgnored','343020wSqPeO','ðŸ’¤\x20Smart\x20Sleep\x20erkannt\x20(','log','setStateAsync','message','wohn','450467BRmIBR','bad','toFixed','exports','getStateAsync','analysis.safety.deadMan.config','\x20fÃ¼r\x20','replace','living','val'];a2_0x59b8=function(){return _0x5de814;};return a2_0x59b8();}let activeTimer=null,currentMonitoredRoom=null,timeoutMs=0x0,startTime=0x0,alarmStage=0x0;function a2_0x4dc5(_0x536195,_0x342c98){const _0x1cc42e=a2_0x59b8();return a2_0x4dc5=function(_0x5f40fd,_0x44e9cd){_0x5f40fd=_0x5f40fd-0x6a;let _0x59b8a8=_0x1cc42e[_0x5f40fd];return _0x59b8a8;},a2_0x4dc5(_0x536195,_0x342c98);}const DEFAULT_TIMEOUTS={'bad':0x2d,'bath':0x2d,'toilet':0x1e,'wc':0x1e,'keller':0x3c,'schlaf':0x78,'bed':0x78,'guest':0x5a,'gast':0x5a};function getTimeoutRobust(_0x32f449,_0x403192){const _0x135a4a=a2_0x4dc5;if(!_0x32f449||!_0x403192)return undefined;if(_0x32f449[_0x403192])return _0x32f449[_0x403192];const _0x45bbdf=_0x403192[_0x135a4a(0x98)]()[_0x135a4a(0x80)](/[^a-z0-9]/g,'');for(const _0x1a4007 in _0x32f449){const _0x7976c6=_0x1a4007[_0x135a4a(0x98)]()[_0x135a4a(0x80)](/[^a-z0-9]/g,'');if(_0x7976c6===_0x45bbdf)return _0x32f449[_0x1a4007];}const _0x3bc92d=_0x403192['toLowerCase']();if(_0x32f449[_0x3bc92d])return _0x32f449[_0x3bc92d];return undefined;}async function loadConfig(_0x226da5){const _0x41d574=a2_0x4dc5;try{const _0x1b704a=await _0x226da5[_0x41d574(0x7d)](_0x41d574(0x7e));if(_0x1b704a&&_0x1b704a[_0x41d574(0x82)])return JSON['parse'](_0x1b704a[_0x41d574(0x82)]);}catch(_0x4ee40a){}return{};}async function isActive(_0x1f3636){const _0x18a6ef=a2_0x4dc5;try{const _0x2a0146=await _0x1f3636[_0x18a6ef(0x7d)]('analysis.safety.deadMan.active');return _0x2a0146&&_0x2a0146['val'];}catch(_0x25574b){return![];}}async function areRoomsConnected(_0x265775,_0x4c8e62,_0x9ef8e5){const _0x3403c6=a2_0x4dc5;try{const _0x1335ee=await _0x265775['getStateAsync'](_0x3403c6(0x88));if(!_0x1335ee||!_0x1335ee[_0x3403c6(0x82)])return!![];const _0x143193=JSON[_0x3403c6(0xa1)](_0x1335ee['val']),{rooms:_0x2b07a8,matrix:_0x305f1e}=_0x143193;if(!_0x2b07a8||!_0x305f1e)return!![];const _0x137977=_0x2b07a8[_0x3403c6(0x85)](_0x4c8e62),_0x10896e=_0x2b07a8['indexOf'](_0x9ef8e5);if(_0x137977===-0x1||_0x10896e===-0x1)return!![];const _0x128865=_0x305f1e[_0x137977][_0x10896e]>0x0||_0x305f1e[_0x10896e][_0x137977]>0x0;return _0x128865;}catch(_0xe94d0e){return _0x265775['log'][_0x3403c6(0x93)]('[DeadMan]\x20Topology\x20check\x20failed:\x20'+_0xe94d0e[_0x3403c6(0x77)]),!![];}}function calculateSleepProbability(_0x3b6475){const _0x517da0=a2_0x4dc5,_0x59a320=new Date(),_0x5874bb=_0x59a320[_0x517da0(0x8a)](),_0x3c410b=_0x3b6475[_0x517da0(0x98)]();let _0x35c68c=0.1;if(_0x5874bb>=0x17||_0x5874bb<=0x6)_0x35c68c=0x1;else{if(_0x5874bb>=0xd&&_0x5874bb<=0xf)_0x35c68c=0.8;else{if(_0x5874bb>=0x14&&_0x5874bb<=0x17)_0x35c68c=0.4;}}let _0x3e4140=0.1;if(_0x3c410b[_0x517da0(0x8d)](_0x517da0(0x96))||_0x3c410b['includes'](_0x517da0(0x8b)))_0x3e4140=0x1;else{if(_0x3c410b['includes'](_0x517da0(0x78))||_0x3c410b[_0x517da0(0x8d)](_0x517da0(0x81))||_0x3c410b[_0x517da0(0x8d)](_0x517da0(0x6d)))_0x3e4140=0.6;else{if(_0x3c410b[_0x517da0(0x8d)](_0x517da0(0x7a))||_0x3c410b[_0x517da0(0x8d)]('wc'))_0x3e4140=0.05;}}let _0x499a15=0.5;const _0x3052b5=_0x3e4140*0.5+_0x35c68c*0.3+_0x499a15*0.2;return parseFloat(_0x3052b5[_0x517da0(0x7b)](0x2));}async function updateLocation(_0x2e60e8,_0x521ae1){const _0x1fa897=a2_0x4dc5;if(!_0x521ae1||_0x521ae1===_0x1fa897(0x97))return;if(!await isActive(_0x2e60e8)){resetTimer(_0x2e60e8);return;}if(currentMonitoredRoom&&currentMonitoredRoom!==_0x521ae1){const _0x315bfb=await areRoomsConnected(_0x2e60e8,currentMonitoredRoom,_0x521ae1);if(!_0x315bfb){const _0x27e3ae=_0x1fa897(0xa0)+_0x521ae1+_0x1fa897(0x6f)+currentMonitoredRoom+'\x27.';_0x2e60e8[_0x1fa897(0x75)][_0x1fa897(0x6a)](_0x1fa897(0x9f)+_0x27e3ae+'\x20(Multi-Person\x20Filter)'),await _0x2e60e8[_0x1fa897(0x76)](_0x1fa897(0x72),{'val':JSON['stringify']({'room':_0x521ae1,'reason':_0x27e3ae,'timestamp':Date['now']()}),'ack':!![]});return;}resetTimer(_0x2e60e8);}if(!currentMonitoredRoom){await _0x2e60e8[_0x1fa897(0x76)](_0x1fa897(0x9a),{'val':_0x521ae1,'ack':!![]});const _0x58d1aa=await loadConfig(_0x2e60e8);let _0x3ea9da=getTimeoutRobust(_0x58d1aa,_0x521ae1);const _0x4183b6=_0x521ae1[_0x1fa897(0x98)]();if(!_0x3ea9da)for(const _0x33061 in DEFAULT_TIMEOUTS){if(_0x4183b6[_0x1fa897(0x8d)](_0x33061)){_0x3ea9da=DEFAULT_TIMEOUTS[_0x33061];break;}}if(!_0x3ea9da&&_0x58d1aa[_0x1fa897(0x90)])_0x3ea9da=_0x58d1aa[_0x1fa897(0x90)];if(!_0x3ea9da)return;currentMonitoredRoom=_0x521ae1,startTimer(_0x2e60e8,_0x3ea9da,_0x521ae1);}}function startTimer(_0x5dca0c,_0x2cda4b,_0x318d2a){const _0x29b0a9=a2_0x4dc5;if(activeTimer)clearTimeout(activeTimer);timeoutMs=_0x2cda4b*0x3c*0x3e8,startTime=Date[_0x29b0a9(0x95)](),alarmStage=0x0;const _0x2c50bf=calculateSleepProbability(_0x318d2a||currentMonitoredRoom),_0x65f9b9=_0x2c50bf>0.65;_0x65f9b9?(timeoutMs+=0x5a*0x3c*0x3e8,_0x5dca0c[_0x29b0a9(0x75)][_0x29b0a9(0x6a)](_0x29b0a9(0x74)+(_0x2c50bf*0x64)[_0x29b0a9(0x7b)](0x0)+_0x29b0a9(0x8f)+currentMonitoredRoom+_0x29b0a9(0x8c)),_0x5dca0c[_0x29b0a9(0x76)]('analysis.safety.deadMan.smartSleep',{'val':!![],'ack':!![]})):_0x5dca0c['setStateAsync']('analysis.safety.deadMan.smartSleep',{'val':![],'ack':!![]}),_0x5dca0c[_0x29b0a9(0x76)](_0x29b0a9(0x92),{'val':_0x2c50bf,'ack':!![]}),_0x5dca0c[_0x29b0a9(0x75)]['info'](_0x29b0a9(0x71)+currentMonitoredRoom+_0x29b0a9(0x7f)+_0x2cda4b+'\x20Min.'),_0x5dca0c[_0x29b0a9(0x76)](_0x29b0a9(0xa2),{'val':'ok','ack':!![]}),activeTimer=setTimeout(()=>triggerPreWarn(_0x5dca0c),timeoutMs);}function resetTimer(_0x3829d2){const _0x4fd44a=a2_0x4dc5;if(activeTimer)clearTimeout(activeTimer);activeTimer=null,currentMonitoredRoom=null,alarmStage=0x0,_0x3829d2[_0x4fd44a(0x76)](_0x4fd44a(0xa2),{'val':'ok','ack':!![]}),_0x3829d2[_0x4fd44a(0x76)](_0x4fd44a(0x9c),{'val':![],'ack':!![]}),_0x3829d2[_0x4fd44a(0x76)](_0x4fd44a(0x92),{'val':0x0,'ack':!![]});}async function triggerPreWarn(_0xa0a21f){const _0x1d56af=a2_0x4dc5;alarmStage=0x1,await _0xa0a21f[_0x1d56af(0x76)]('analysis.safety.deadMan.alarmState',{'val':'pre_warn','ack':!![]});const _0x5c783b=_0x1d56af(0x9e)+currentMonitoredRoom+_0x1d56af(0x6e);_0xa0a21f['log'][_0x1d56af(0x93)](_0x1d56af(0x9f)+_0x5c783b),await setup['sendNotification'](_0xa0a21f,_0x1d56af(0x83)+_0x5c783b),activeTimer=setTimeout(()=>triggerAlarm(_0xa0a21f),0x5*0x3c*0x3e8);}async function triggerAlarm(_0x93a3f9){const _0x2539c6=a2_0x4dc5;alarmStage=0x2,await _0x93a3f9['setStateAsync'](_0x2539c6(0xa2),{'val':_0x2539c6(0x6b),'ack':!![]});const _0x1d40d7=_0x2539c6(0x86)+currentMonitoredRoom+'!';_0x93a3f9[_0x2539c6(0x75)]['error']('[DeadMan]\x20'+_0x1d40d7),await setup[_0x2539c6(0x9d)](_0x93a3f9,_0x1d40d7,![],!![]);}module[a2_0xeea0ce(0x7c)]={'updateLocation':updateLocation};