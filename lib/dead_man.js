const a2_0x32ec28=a2_0x1c9f;(function(_0x44a6ae,_0x57791c){const _0x4d36c4=a2_0x1c9f,_0x4745fe=_0x44a6ae();while(!![]){try{const _0x5ca31e=parseInt(_0x4d36c4(0x14d))/0x1+-parseInt(_0x4d36c4(0x15f))/0x2+parseInt(_0x4d36c4(0x15c))/0x3+-parseInt(_0x4d36c4(0x152))/0x4+parseInt(_0x4d36c4(0x131))/0x5*(parseInt(_0x4d36c4(0x14e))/0x6)+-parseInt(_0x4d36c4(0x134))/0x7*(parseInt(_0x4d36c4(0x12a))/0x8)+parseInt(_0x4d36c4(0x126))/0x9*(parseInt(_0x4d36c4(0x155))/0xa);if(_0x5ca31e===_0x57791c)break;else _0x4745fe['push'](_0x4745fe['shift']());}catch(_0x1adab7){_0x4745fe['push'](_0x4745fe['shift']());}}}(a2_0x910c,0x835e5));const a2_0x435219=(function(){let _0x43f8c4=!![];return function(_0x172be9,_0x133807){const _0x4e101a=_0x43f8c4?function(){if(_0x133807){const _0x1f60e4=_0x133807['apply'](_0x172be9,arguments);return _0x133807=null,_0x1f60e4;}}:function(){};return _0x43f8c4=![],_0x4e101a;};}()),a2_0x4222c1=a2_0x435219(this,function(){const _0x1d0000=a2_0x1c9f;return a2_0x4222c1[_0x1d0000(0x12b)]()['search'](_0x1d0000(0x13f))['toString']()[_0x1d0000(0x147)](a2_0x4222c1)[_0x1d0000(0x149)](_0x1d0000(0x13f));});a2_0x4222c1();'use strict';const setup=require(a2_0x32ec28(0x139));let activeTimer=null,currentMonitoredRoom=null,timeoutMs=0x0,startTime=0x0,alarmStage=0x0;const DEFAULT_TIMEOUTS={'bad':0x2d,'bath':0x2d,'toilet':0x1e,'wc':0x1e,'keller':0x3c,'schlaf':0x78,'bed':0x78,'guest':0x5a,'gast':0x5a};async function loadConfig(_0x178b25){const _0x31ad4c=a2_0x32ec28;try{const _0x13af12=await _0x178b25[_0x31ad4c(0x159)](_0x31ad4c(0x130));if(_0x13af12&&_0x13af12[_0x31ad4c(0x156)])return JSON[_0x31ad4c(0x12f)](_0x13af12[_0x31ad4c(0x156)]);}catch(_0x2316bb){}return{};}async function isActive(_0x1069ec){const _0x31ed91=a2_0x32ec28;try{const _0xdd38fe=await _0x1069ec[_0x31ed91(0x159)](_0x31ed91(0x13b));return _0xdd38fe&&_0xdd38fe[_0x31ed91(0x156)];}catch(_0x3b39b3){return![];}}async function areRoomsConnected(_0x310beb,_0x39fe42,_0x56f545){const _0x15415e=a2_0x32ec28;try{const _0x14693e=await _0x310beb[_0x15415e(0x159)](_0x15415e(0x129));if(!_0x14693e||!_0x14693e[_0x15415e(0x156)])return!![];const _0x4307fa=JSON[_0x15415e(0x12f)](_0x14693e['val']),{rooms:_0x5e7a1f,matrix:_0x985903}=_0x4307fa;if(!_0x5e7a1f||!_0x985903)return!![];const _0x359e9e=_0x5e7a1f[_0x15415e(0x154)](_0x39fe42),_0x552a1e=_0x5e7a1f[_0x15415e(0x154)](_0x56f545);if(_0x359e9e===-0x1||_0x552a1e===-0x1)return!![];const _0x483b2d=_0x985903[_0x359e9e][_0x552a1e]>0x0||_0x985903[_0x552a1e][_0x359e9e]>0x0;return _0x483b2d;}catch(_0x46df56){return _0x310beb[_0x15415e(0x14a)][_0x15415e(0x160)](_0x15415e(0x13c)+_0x46df56[_0x15415e(0x148)]),!![];}}function calculateSleepProbability(_0x21ec55){const _0x4c8e6f=a2_0x32ec28,_0x210133=new Date(),_0x1b83fb=_0x210133[_0x4c8e6f(0x141)](),_0x3300e5=_0x21ec55['toLowerCase']();let _0x5dc75d=0.1;if(_0x1b83fb>=0x17||_0x1b83fb<=0x6)_0x5dc75d=0x1;else{if(_0x1b83fb>=0xd&&_0x1b83fb<=0xf)_0x5dc75d=0.8;else{if(_0x1b83fb>=0x14&&_0x1b83fb<=0x17)_0x5dc75d=0.4;}}let _0x347008=0.1;if(_0x3300e5[_0x4c8e6f(0x15b)](_0x4c8e6f(0x132))||_0x3300e5['includes'](_0x4c8e6f(0x145)))_0x347008=0x1;else{if(_0x3300e5['includes'](_0x4c8e6f(0x15a))||_0x3300e5[_0x4c8e6f(0x15b)]('living')||_0x3300e5['includes'](_0x4c8e6f(0x12c)))_0x347008=0.6;else{if(_0x3300e5[_0x4c8e6f(0x15b)]('bad')||_0x3300e5[_0x4c8e6f(0x15b)]('wc'))_0x347008=0.05;}}let _0x45024f=0.5;const _0x41899a=_0x347008*0.5+_0x5dc75d*0.3+_0x45024f*0.2;return parseFloat(_0x41899a[_0x4c8e6f(0x144)](0x2));}async function updateLocation(_0x30b036,_0x3964b3){const _0x1100d7=a2_0x32ec28;if(!_0x3964b3||_0x3964b3===_0x1100d7(0x15d))return;if(!await isActive(_0x30b036)){resetTimer(_0x30b036);return;}if(currentMonitoredRoom&&currentMonitoredRoom!==_0x3964b3){const _0x4b03fd=await areRoomsConnected(_0x30b036,currentMonitoredRoom,_0x3964b3);if(!_0x4b03fd){const _0x426167=_0x1100d7(0x14f)+_0x3964b3+'\x27.\x20Nicht\x20verbunden\x20mit\x20√ºberwachtem\x20\x27'+currentMonitoredRoom+'\x27.';_0x30b036[_0x1100d7(0x14a)]['info'](_0x1100d7(0x13e)+_0x426167+_0x1100d7(0x15e)),await _0x30b036['setStateAsync'](_0x1100d7(0x14b),{'val':JSON[_0x1100d7(0x13d)]({'room':_0x3964b3,'reason':_0x426167,'timestamp':Date[_0x1100d7(0x12e)]()}),'ack':!![]});return;}resetTimer(_0x30b036);}if(!currentMonitoredRoom){await _0x30b036[_0x1100d7(0x128)](_0x1100d7(0x158),{'val':_0x3964b3,'ack':!![]});const _0x5d9f92=await loadConfig(_0x30b036),_0xe8425f=_0x3964b3[_0x1100d7(0x13a)]();let _0x170dc1=_0x5d9f92[_0x3964b3]||_0x5d9f92[_0xe8425f];if(!_0x170dc1)for(const _0x10b776 in DEFAULT_TIMEOUTS){if(_0xe8425f[_0x1100d7(0x15b)](_0x10b776)){_0x170dc1=DEFAULT_TIMEOUTS[_0x10b776];break;}}if(!_0x170dc1&&_0x5d9f92[_0x1100d7(0x137)])_0x170dc1=_0x5d9f92[_0x1100d7(0x137)];if(!_0x170dc1)return;currentMonitoredRoom=_0x3964b3,startTimer(_0x30b036,_0x170dc1,_0x3964b3);}}function startTimer(_0x40823d,_0x4a1894,_0x304875){const _0x31b839=a2_0x32ec28;if(activeTimer)clearTimeout(activeTimer);timeoutMs=_0x4a1894*0x3c*0x3e8,startTime=Date[_0x31b839(0x12e)](),alarmStage=0x0;const _0x72e3f9=calculateSleepProbability(_0x304875||currentMonitoredRoom),_0x1e3b5b=_0x72e3f9>0.65;_0x1e3b5b?(timeoutMs+=0x5a*0x3c*0x3e8,_0x40823d[_0x31b839(0x14a)][_0x31b839(0x12d)](_0x31b839(0x125)+(_0x72e3f9*0x64)['toFixed'](0x0)+_0x31b839(0x142)+currentMonitoredRoom+_0x31b839(0x127)),_0x40823d[_0x31b839(0x128)](_0x31b839(0x143),{'val':!![],'ack':!![]})):_0x40823d[_0x31b839(0x128)]('analysis.safety.deadMan.smartSleep',{'val':![],'ack':!![]}),_0x40823d[_0x31b839(0x128)](_0x31b839(0x140),{'val':_0x72e3f9,'ack':!![]}),_0x40823d[_0x31b839(0x14a)][_0x31b839(0x12d)](_0x31b839(0x133)+currentMonitoredRoom+_0x31b839(0x153)+_0x4a1894+'\x20Min.'),_0x40823d[_0x31b839(0x128)]('analysis.safety.deadMan.alarmState',{'val':'ok','ack':!![]}),activeTimer=setTimeout(()=>triggerPreWarn(_0x40823d),timeoutMs);}function resetTimer(_0x197bfc){const _0x33478b=a2_0x32ec28;if(activeTimer)clearTimeout(activeTimer);activeTimer=null,currentMonitoredRoom=null,alarmStage=0x0,_0x197bfc[_0x33478b(0x128)]('analysis.safety.deadMan.alarmState',{'val':'ok','ack':!![]}),_0x197bfc[_0x33478b(0x128)](_0x33478b(0x143),{'val':![],'ack':!![]}),_0x197bfc[_0x33478b(0x128)](_0x33478b(0x140),{'val':0x0,'ack':!![]});}async function triggerPreWarn(_0x15d61a){const _0x3b5f3d=a2_0x32ec28;alarmStage=0x1,await _0x15d61a[_0x3b5f3d(0x128)]('analysis.safety.deadMan.alarmState',{'val':_0x3b5f3d(0x138),'ack':!![]});const _0x26e37b=_0x3b5f3d(0x14c)+currentMonitoredRoom+_0x3b5f3d(0x136);_0x15d61a[_0x3b5f3d(0x14a)][_0x3b5f3d(0x160)](_0x3b5f3d(0x13e)+_0x26e37b),await setup['sendNotification'](_0x15d61a,_0x3b5f3d(0x150)+_0x26e37b),activeTimer=setTimeout(()=>triggerAlarm(_0x15d61a),0x5*0x3c*0x3e8);}function a2_0x910c(){const _0xfb70c9=['analysis.safety.deadMan.smartSleep','toFixed','bed','exports','constructor','message','search','log','analysis.safety.deadMan.lastIgnored','‚è≥\x20ACHTUNG:\x20Ungew√∂hnlich\x20lange\x20Inaktivit√§t\x20in\x20','378130iCBsXG','154494xOUuBT','Ignoriere\x20Bewegung\x20in\x20\x27','üëº\x20Schutzengel-Frage:\x20','alarm','2777200Nghqom','\x20f√ºr\x20','indexOf','2189030ukWJIm','val','üö®\x20NOTFALL-ALARM:\x20Person\x20reagiert\x20nicht\x20in\x20','analysis.safety.deadMan.currentRoom','getStateAsync','wohn','includes','600135ZOqLsC','Unknown','\x20(Multi-Person\x20Filter)','1270412HKMTym','warn','üí§\x20Smart\x20Sleep\x20erkannt\x20(','63NCnmSK','\x20um\x2090\x20Min.','setStateAsync','analysis.topology.structure','40ivEijs','toString','sofa','info','now','parse','analysis.safety.deadMan.config','25emOuRE','schlaf','üëº\x20Schutzengel:\x20√úberwache\x20','520310KgWIxq','error','.\x20Alles\x20in\x20Ordnung?','default','pre_warn','./setup','toLowerCase','analysis.safety.deadMan.active','[DeadMan]\x20Topology\x20check\x20failed:\x20','stringify','[DeadMan]\x20','(((.+)+)+)+$','analysis.safety.deadMan.napProbability','getHours','%).\x20Verl√§ngere\x20Timer\x20f√ºr\x20'];a2_0x910c=function(){return _0xfb70c9;};return a2_0x910c();}function a2_0x1c9f(_0x3d3856,_0xb6af09){const _0x28076d=a2_0x910c();return a2_0x1c9f=function(_0x4222c1,_0x435219){_0x4222c1=_0x4222c1-0x125;let _0x910c7f=_0x28076d[_0x4222c1];return _0x910c7f;},a2_0x1c9f(_0x3d3856,_0xb6af09);}async function triggerAlarm(_0x13b782){const _0x5971df=a2_0x32ec28;alarmStage=0x2,await _0x13b782[_0x5971df(0x128)]('analysis.safety.deadMan.alarmState',{'val':_0x5971df(0x151),'ack':!![]});const _0x165ea2=_0x5971df(0x157)+currentMonitoredRoom+'!';_0x13b782[_0x5971df(0x14a)][_0x5971df(0x135)](_0x5971df(0x13e)+_0x165ea2),await setup['sendNotification'](_0x13b782,_0x165ea2,![],!![]);}module[a2_0x32ec28(0x146)]={'updateLocation':updateLocation};