const a2_0x275a2f=a2_0x17a2;(function(_0x1d5a4d,_0x15c5fb){const _0x3224b6=a2_0x17a2,_0x51d7d8=_0x1d5a4d();while(!![]){try{const _0x3b808d=parseInt(_0x3224b6(0x1c4))/0x1*(-parseInt(_0x3224b6(0x1ba))/0x2)+-parseInt(_0x3224b6(0x1d7))/0x3+parseInt(_0x3224b6(0x1d0))/0x4+parseInt(_0x3224b6(0x1c5))/0x5+-parseInt(_0x3224b6(0x1bc))/0x6*(-parseInt(_0x3224b6(0x1db))/0x7)+-parseInt(_0x3224b6(0x1d3))/0x8*(parseInt(_0x3224b6(0x1c3))/0x9)+-parseInt(_0x3224b6(0x1c9))/0xa*(-parseInt(_0x3224b6(0x1de))/0xb);if(_0x3b808d===_0x15c5fb)break;else _0x51d7d8['push'](_0x51d7d8['shift']());}catch(_0xc76326){_0x51d7d8['push'](_0x51d7d8['shift']());}}}(a2_0x215b,0x96651));function a2_0x17a2(_0x204210,_0xfc2083){const _0x16b331=a2_0x215b();return a2_0x17a2=function(_0x1df7bf,_0x46b02a){_0x1df7bf=_0x1df7bf-0x1ba;let _0x215bb3=_0x16b331[_0x1df7bf];return _0x215bb3;},a2_0x17a2(_0x204210,_0xfc2083);}const a2_0x46b02a=(function(){let _0x2fb275=!![];return function(_0x4594bc,_0x421dd9){const _0x1e8e97=_0x2fb275?function(){const _0x29f6f5=a2_0x17a2;if(_0x421dd9){const _0x2689e7=_0x421dd9[_0x29f6f5(0x1e6)](_0x4594bc,arguments);return _0x421dd9=null,_0x2689e7;}}:function(){};return _0x2fb275=![],_0x1e8e97;};}()),a2_0x1df7bf=a2_0x46b02a(this,function(){const _0x4d7810=a2_0x17a2;return a2_0x1df7bf[_0x4d7810(0x1c8)]()[_0x4d7810(0x1bf)](_0x4d7810(0x1cb))[_0x4d7810(0x1c8)]()[_0x4d7810(0x1c6)](a2_0x1df7bf)[_0x4d7810(0x1bf)](_0x4d7810(0x1cb));});a2_0x1df7bf();function a2_0x215b(){const _0x5f1fc4=['search','analysis.safety.deadMan.alarmState','analysis.safety.deadMan.currentRoom','includes','7479333qGutRv','1dqWxIG','5927420cUmJAR','constructor','log','toString','992130ohwJlQ','[DeadMan]\x20','(((.+)+)+)+$','â³\x20ACHTUNG:\x20UngewÃ¶hnlich\x20lange\x20InaktivitÃ¤t\x20in\x20','Unknown','val','info','3209616uonqCY','toLowerCase','[DeadMan]\x20Topology\x20check\x20failed:\x20','8VGiAlu','default','\x20fÃ¼r\x20','ðŸš¨\x20NOTFALL-ALARM:\x20Person\x20reagiert\x20nicht\x20in\x20','3092358rEXeUs','indexOf','\x20Min.','warn','1070272iVCobb','analysis.safety.deadMan.config','message','77NqhWYf','ðŸ‘¼\x20Schutzengel-Frage:\x20','now','analysis.topology.structure','pre_warn','ðŸ‘¼\x20Schutzengel:\x20Ãœberwache\x20','./setup','[DeadMan]\x20Ignoriere\x20Bewegung\x20in\x20\x27','apply','getStateAsync','setStateAsync','1326454WySuSO','.\x20Alles\x20in\x20Ordnung?','18yDzKFE','parse','analysis.safety.deadMan.active'];a2_0x215b=function(){return _0x5f1fc4;};return a2_0x215b();}'use strict';const setup=require(a2_0x275a2f(0x1e4));let activeTimer=null,currentMonitoredRoom=null,timeoutMs=0x0,startTime=0x0,alarmStage=0x0;const DEFAULT_TIMEOUTS={'bad':0x2d,'bath':0x2d,'toilet':0x1e,'wc':0x1e,'keller':0x3c};async function loadConfig(_0x18130){const _0xae8ff3=a2_0x275a2f;try{const _0x349e58=await _0x18130[_0xae8ff3(0x1e7)](_0xae8ff3(0x1dc));if(_0x349e58&&_0x349e58[_0xae8ff3(0x1ce)])return JSON[_0xae8ff3(0x1bd)](_0x349e58['val']);}catch(_0x12cbd0){}return{};}async function isActive(_0x1fec12){const _0x376a33=a2_0x275a2f;try{const _0x3290cf=await _0x1fec12[_0x376a33(0x1e7)](_0x376a33(0x1be));return _0x3290cf&&_0x3290cf[_0x376a33(0x1ce)];}catch(_0x238d4c){return![];}}async function areRoomsConnected(_0x27cb55,_0xc503b3,_0x16db53){const _0x2a69a6=a2_0x275a2f;try{const _0x2f1a44=await _0x27cb55['getStateAsync'](_0x2a69a6(0x1e1));if(!_0x2f1a44||!_0x2f1a44['val'])return!![];const _0x1ede1f=JSON['parse'](_0x2f1a44['val']),{rooms:_0x53ed30,matrix:_0x43c8d0}=_0x1ede1f;if(!_0x53ed30||!_0x43c8d0)return!![];const _0xbee815=_0x53ed30['indexOf'](_0xc503b3),_0x54c084=_0x53ed30[_0x2a69a6(0x1d8)](_0x16db53);if(_0xbee815===-0x1||_0x54c084===-0x1)return!![];const _0x472bf9=_0x43c8d0[_0xbee815][_0x54c084]>0x0||_0x43c8d0[_0x54c084][_0xbee815]>0x0;return _0x472bf9;}catch(_0x3761d0){return _0x27cb55['log'][_0x2a69a6(0x1da)](_0x2a69a6(0x1d2)+_0x3761d0[_0x2a69a6(0x1dd)]),!![];}}async function updateLocation(_0x16f706,_0x3da886){const _0x13d6f6=a2_0x275a2f;if(!_0x3da886||_0x3da886===_0x13d6f6(0x1cd))return;if(!await isActive(_0x16f706)){resetTimer(_0x16f706);return;}if(currentMonitoredRoom&&currentMonitoredRoom!==_0x3da886){const _0x111233=await areRoomsConnected(_0x16f706,currentMonitoredRoom,_0x3da886);if(!_0x111233){_0x16f706['log']['info'](_0x13d6f6(0x1e5)+_0x3da886+'\x27.\x20Nicht\x20verbunden\x20mit\x20Ã¼berwachtem\x20\x27'+currentMonitoredRoom+'\x27.\x20(Multi-Person\x20Filter)');return;}resetTimer(_0x16f706);}if(!currentMonitoredRoom){await _0x16f706[_0x13d6f6(0x1e8)](_0x13d6f6(0x1c1),{'val':_0x3da886,'ack':!![]});const _0x14ad3c=await loadConfig(_0x16f706),_0x73176d=_0x3da886[_0x13d6f6(0x1d1)]();let _0x243def=_0x14ad3c[_0x3da886]||_0x14ad3c[_0x73176d];if(!_0x243def)for(const _0x5c0473 in DEFAULT_TIMEOUTS){if(_0x73176d[_0x13d6f6(0x1c2)](_0x5c0473)){_0x243def=DEFAULT_TIMEOUTS[_0x5c0473];break;}}if(!_0x243def&&_0x14ad3c[_0x13d6f6(0x1d4)])_0x243def=_0x14ad3c[_0x13d6f6(0x1d4)];if(!_0x243def)return;currentMonitoredRoom=_0x3da886,startTimer(_0x16f706,_0x243def);}}function startTimer(_0x4fc995,_0x42fdd3){const _0x46f8d3=a2_0x275a2f;if(activeTimer)clearTimeout(activeTimer);timeoutMs=_0x42fdd3*0x3c*0x3e8,startTime=Date[_0x46f8d3(0x1e0)](),alarmStage=0x0,_0x4fc995[_0x46f8d3(0x1c7)][_0x46f8d3(0x1cf)](_0x46f8d3(0x1e3)+currentMonitoredRoom+_0x46f8d3(0x1d5)+_0x42fdd3+_0x46f8d3(0x1d9)),_0x4fc995[_0x46f8d3(0x1e8)]('analysis.safety.deadMan.alarmState',{'val':'ok','ack':!![]}),activeTimer=setTimeout(()=>triggerPreWarn(_0x4fc995),timeoutMs);}function resetTimer(_0x59d99c){const _0xf9f677=a2_0x275a2f;if(activeTimer)clearTimeout(activeTimer);activeTimer=null,currentMonitoredRoom=null,alarmStage=0x0,_0x59d99c[_0xf9f677(0x1e8)](_0xf9f677(0x1c0),{'val':'ok','ack':!![]});}async function triggerPreWarn(_0x5bc5a6){const _0x2ff7d9=a2_0x275a2f;alarmStage=0x1,await _0x5bc5a6[_0x2ff7d9(0x1e8)](_0x2ff7d9(0x1c0),{'val':_0x2ff7d9(0x1e2),'ack':!![]});const _0x20597a=_0x2ff7d9(0x1cc)+currentMonitoredRoom+_0x2ff7d9(0x1bb);_0x5bc5a6[_0x2ff7d9(0x1c7)][_0x2ff7d9(0x1da)](_0x2ff7d9(0x1ca)+_0x20597a),await setup['sendNotification'](_0x5bc5a6,_0x2ff7d9(0x1df)+_0x20597a),activeTimer=setTimeout(()=>triggerAlarm(_0x5bc5a6),0x5*0x3c*0x3e8);}async function triggerAlarm(_0x44a1c7){const _0x5b7913=a2_0x275a2f;alarmStage=0x2,await _0x44a1c7[_0x5b7913(0x1e8)](_0x5b7913(0x1c0),{'val':'alarm','ack':!![]});const _0x5ecbd7=_0x5b7913(0x1d6)+currentMonitoredRoom+'!';_0x44a1c7[_0x5b7913(0x1c7)]['error'](_0x5b7913(0x1ca)+_0x5ecbd7),await setup['sendNotification'](_0x44a1c7,_0x5ecbd7,![],!![]);}module['exports']={'updateLocation':updateLocation};