const a2_0x3a2b09=a2_0x222f;(function(_0x58fe65,_0x30992f){const _0x4ef13b=a2_0x222f,_0x1c42ce=_0x58fe65();while(!![]){try{const _0x8c1da5=parseInt(_0x4ef13b(0x192))/0x1*(parseInt(_0x4ef13b(0x18d))/0x2)+parseInt(_0x4ef13b(0x1a1))/0x3+parseInt(_0x4ef13b(0x19c))/0x4*(parseInt(_0x4ef13b(0x197))/0x5)+parseInt(_0x4ef13b(0x18f))/0x6+parseInt(_0x4ef13b(0x18c))/0x7+-parseInt(_0x4ef13b(0x19f))/0x8*(parseInt(_0x4ef13b(0x193))/0x9)+-parseInt(_0x4ef13b(0x1b2))/0xa;if(_0x8c1da5===_0x30992f)break;else _0x1c42ce['push'](_0x1c42ce['shift']());}catch(_0x2c9227){_0x1c42ce['push'](_0x1c42ce['shift']());}}}(a2_0x387d,0xf0f85));function a2_0x222f(_0x3b45e6,_0x46fd39){const _0xeb6683=a2_0x387d();return a2_0x222f=function(_0x5346fd,_0x2a1072){_0x5346fd=_0x5346fd-0x18b;let _0x387df7=_0xeb6683[_0x5346fd];return _0x387df7;},a2_0x222f(_0x3b45e6,_0x46fd39);}const a2_0x2a1072=(function(){let _0x5b89ae=!![];return function(_0x471786,_0x28324f){const _0x554a07=_0x5b89ae?function(){const _0x4c2d57=a2_0x222f;if(_0x28324f){const _0x831b06=_0x28324f[_0x4c2d57(0x1af)](_0x471786,arguments);return _0x28324f=null,_0x831b06;}}:function(){};return _0x5b89ae=![],_0x554a07;};}()),a2_0x5346fd=a2_0x2a1072(this,function(){const _0x30eba6=a2_0x222f;return a2_0x5346fd[_0x30eba6(0x191)]()[_0x30eba6(0x1b4)](_0x30eba6(0x1ae))[_0x30eba6(0x191)]()['constructor'](a2_0x5346fd)['search'](_0x30eba6(0x1ae));});a2_0x5346fd();'use strict';const setup=require(a2_0x3a2b09(0x199));let activeTimer=null,currentMonitoredRoom=null,timeoutMs=0x0,startTime=0x0,alarmStage=0x0;const DEFAULT_TIMEOUTS={'bad':0x2d,'bath':0x2d,'toilet':0x1e,'wc':0x1e,'keller':0x3c};async function loadConfig(_0x5135af){const _0xb770bb=a2_0x3a2b09;try{const _0x240a4b=await _0x5135af[_0xb770bb(0x1a0)]('analysis.safety.deadMan.config');if(_0x240a4b&&_0x240a4b['val'])return JSON['parse'](_0x240a4b[_0xb770bb(0x19b)]);}catch(_0x456e89){}return{};}async function isActive(_0x23abb1){const _0x872e1=a2_0x3a2b09;try{const _0x520e23=await _0x23abb1[_0x872e1(0x1a0)](_0x872e1(0x19d));return _0x520e23&&_0x520e23[_0x872e1(0x19b)];}catch(_0x322301){return![];}}async function areRoomsConnected(_0x5784ab,_0x15a672,_0x35facf){const _0x521ddc=a2_0x3a2b09;try{const _0x3394d5=await _0x5784ab[_0x521ddc(0x1a0)](_0x521ddc(0x1ac));if(!_0x3394d5||!_0x3394d5[_0x521ddc(0x19b)])return!![];const _0x1c4e42=JSON[_0x521ddc(0x1a5)](_0x3394d5[_0x521ddc(0x19b)]),{rooms:_0x181c3b,matrix:_0x400121}=_0x1c4e42;if(!_0x181c3b||!_0x400121)return!![];const _0x444565=_0x181c3b[_0x521ddc(0x18b)](_0x15a672),_0x3dff6d=_0x181c3b['indexOf'](_0x35facf);if(_0x444565===-0x1||_0x3dff6d===-0x1)return!![];const _0x40756a=_0x400121[_0x444565][_0x3dff6d]>0x0||_0x400121[_0x3dff6d][_0x444565]>0x0;return _0x40756a;}catch(_0x84d2d1){return _0x5784ab[_0x521ddc(0x194)][_0x521ddc(0x1b0)](_0x521ddc(0x1a3)+_0x84d2d1[_0x521ddc(0x1b3)]),!![];}}async function updateLocation(_0x52f321,_0xffa383){const _0xfdc847=a2_0x3a2b09;if(!_0xffa383||_0xffa383==='Unknown')return;if(!await isActive(_0x52f321)){resetTimer(_0x52f321);return;}if(currentMonitoredRoom&&currentMonitoredRoom!==_0xffa383){const _0x51979e=await areRoomsConnected(_0x52f321,currentMonitoredRoom,_0xffa383);if(!_0x51979e){const _0x21847d=_0xfdc847(0x19e)+_0xffa383+_0xfdc847(0x1aa)+currentMonitoredRoom+'\x27.';_0x52f321[_0xfdc847(0x194)][_0xfdc847(0x1a9)](_0xfdc847(0x196)+_0x21847d+_0xfdc847(0x1a7)),await _0x52f321[_0xfdc847(0x190)]('analysis.safety.deadMan.lastIgnored',{'val':JSON['stringify']({'room':_0xffa383,'reason':_0x21847d,'timestamp':Date[_0xfdc847(0x1b5)]()}),'ack':!![]});return;}resetTimer(_0x52f321);}if(!currentMonitoredRoom){await _0x52f321[_0xfdc847(0x190)](_0xfdc847(0x18e),{'val':_0xffa383,'ack':!![]});const _0x1c60b3=await loadConfig(_0x52f321),_0x1e8625=_0xffa383[_0xfdc847(0x1a6)]();let _0x423825=_0x1c60b3[_0xffa383]||_0x1c60b3[_0x1e8625];if(!_0x423825)for(const _0x3d09f9 in DEFAULT_TIMEOUTS){if(_0x1e8625[_0xfdc847(0x1b1)](_0x3d09f9)){_0x423825=DEFAULT_TIMEOUTS[_0x3d09f9];break;}}if(!_0x423825&&_0x1c60b3[_0xfdc847(0x1ad)])_0x423825=_0x1c60b3[_0xfdc847(0x1ad)];if(!_0x423825)return;currentMonitoredRoom=_0xffa383,startTimer(_0x52f321,_0x423825);}}function startTimer(_0x3ffaae,_0x532c4d){const _0x35e0f4=a2_0x3a2b09;if(activeTimer)clearTimeout(activeTimer);timeoutMs=_0x532c4d*0x3c*0x3e8,startTime=Date[_0x35e0f4(0x1b5)](),alarmStage=0x0,_0x3ffaae[_0x35e0f4(0x194)]['info'](_0x35e0f4(0x1b7)+currentMonitoredRoom+_0x35e0f4(0x1a4)+_0x532c4d+_0x35e0f4(0x19a)),_0x3ffaae[_0x35e0f4(0x190)](_0x35e0f4(0x198),{'val':'ok','ack':!![]}),activeTimer=setTimeout(()=>triggerPreWarn(_0x3ffaae),timeoutMs);}function a2_0x387d(){const _0x253dd4=['(((.+)+)+)+$','apply','warn','includes','42879950yEWzOr','message','search','now','error','ðŸ‘¼\x20Schutzengel:\x20Ãœberwache\x20','sendNotification','indexOf','1533903JliTrW','904584nrAwhK','analysis.safety.deadMan.currentRoom','9083610yohaTD','setStateAsync','toString','3rdjePp','9PCZQDU','log','pre_warn','[DeadMan]\x20','71485crTFAm','analysis.safety.deadMan.alarmState','./setup','\x20Min.','val','316PMRSsY','analysis.safety.deadMan.active','Ignoriere\x20Bewegung\x20in\x20\x27','1280792ExKpPj','getStateAsync','3647112NzzgaT','â³\x20ACHTUNG:\x20UngewÃ¶hnlich\x20lange\x20InaktivitÃ¤t\x20in\x20','[DeadMan]\x20Topology\x20check\x20failed:\x20','\x20fÃ¼r\x20','parse','toLowerCase','\x20(Multi-Person\x20Filter)','.\x20Alles\x20in\x20Ordnung?','info','\x27.\x20Nicht\x20verbunden\x20mit\x20Ã¼berwachtem\x20\x27','ðŸ‘¼\x20Schutzengel-Frage:\x20','analysis.topology.structure','default'];a2_0x387d=function(){return _0x253dd4;};return a2_0x387d();}function resetTimer(_0x443450){const _0x21a7a9=a2_0x3a2b09;if(activeTimer)clearTimeout(activeTimer);activeTimer=null,currentMonitoredRoom=null,alarmStage=0x0,_0x443450[_0x21a7a9(0x190)]('analysis.safety.deadMan.alarmState',{'val':'ok','ack':!![]});}async function triggerPreWarn(_0x3a548a){const _0x2ad848=a2_0x3a2b09;alarmStage=0x1,await _0x3a548a[_0x2ad848(0x190)]('analysis.safety.deadMan.alarmState',{'val':_0x2ad848(0x195),'ack':!![]});const _0x56bd34=_0x2ad848(0x1a2)+currentMonitoredRoom+_0x2ad848(0x1a8);_0x3a548a[_0x2ad848(0x194)][_0x2ad848(0x1b0)](_0x2ad848(0x196)+_0x56bd34),await setup[_0x2ad848(0x1b8)](_0x3a548a,_0x2ad848(0x1ab)+_0x56bd34),activeTimer=setTimeout(()=>triggerAlarm(_0x3a548a),0x5*0x3c*0x3e8);}async function triggerAlarm(_0x71495d){const _0x52518e=a2_0x3a2b09;alarmStage=0x2,await _0x71495d['setStateAsync']('analysis.safety.deadMan.alarmState',{'val':'alarm','ack':!![]});const _0x24be7b='ðŸš¨\x20NOTFALL-ALARM:\x20Person\x20reagiert\x20nicht\x20in\x20'+currentMonitoredRoom+'!';_0x71495d[_0x52518e(0x194)][_0x52518e(0x1b6)](_0x52518e(0x196)+_0x24be7b),await setup['sendNotification'](_0x71495d,_0x24be7b,![],!![]);}module['exports']={'updateLocation':updateLocation};