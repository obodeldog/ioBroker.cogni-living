const a2_0x11cdec=a2_0x10f5;(function(_0x1eb6b3,_0x276d74){const _0x4d0dd5=a2_0x10f5,_0x3b346f=_0x1eb6b3();while(!![]){try{const _0x7afa7e=parseInt(_0x4d0dd5(0x18f))/0x1*(-parseInt(_0x4d0dd5(0x159))/0x2)+-parseInt(_0x4d0dd5(0x174))/0x3*(-parseInt(_0x4d0dd5(0x190))/0x4)+parseInt(_0x4d0dd5(0x162))/0x5+-parseInt(_0x4d0dd5(0x176))/0x6*(parseInt(_0x4d0dd5(0x170))/0x7)+-parseInt(_0x4d0dd5(0x164))/0x8+parseInt(_0x4d0dd5(0x17c))/0x9*(-parseInt(_0x4d0dd5(0x16e))/0xa)+-parseInt(_0x4d0dd5(0x16a))/0xb*(-parseInt(_0x4d0dd5(0x156))/0xc);if(_0x7afa7e===_0x276d74)break;else _0x3b346f['push'](_0x3b346f['shift']());}catch(_0x4f1fde){_0x3b346f['push'](_0x3b346f['shift']());}}}(a2_0x5ba4,0xca60a));const a2_0x5a3b29=(function(){let _0xb3b9f3=!![];return function(_0x456999,_0x12c500){const _0x1f5146=_0xb3b9f3?function(){const _0x4e9c73=a2_0x10f5;if(_0x12c500){const _0x208aa8=_0x12c500[_0x4e9c73(0x15c)](_0x456999,arguments);return _0x12c500=null,_0x208aa8;}}:function(){};return _0xb3b9f3=![],_0x1f5146;};}()),a2_0x3e94ce=a2_0x5a3b29(this,function(){const _0x164ae5=a2_0x10f5;return a2_0x3e94ce['toString']()['search']('(((.+)+)+)+$')[_0x164ae5(0x17d)]()[_0x164ae5(0x18a)](a2_0x3e94ce)['search'](_0x164ae5(0x181));});a2_0x3e94ce();'use strict';const setup=require(a2_0x11cdec(0x161));let activeTimer=null,currentMonitoredRoom=null,timeoutMs=0x0,startTime=0x0,alarmStage=0x0;const DEFAULT_TIMEOUTS={'bad':0x2d,'bath':0x2d,'toilet':0x1e,'wc':0x1e,'keller':0x3c,'schlaf':0x78,'bed':0x78,'guest':0x5a,'gast':0x5a};function getTimeoutRobust(_0x3d53c9,_0x1b3097){const _0x44896e=a2_0x11cdec;if(!_0x3d53c9||!_0x1b3097)return undefined;if(_0x3d53c9[_0x1b3097])return _0x3d53c9[_0x1b3097];const _0x27705f=_0x1b3097['toLowerCase']()[_0x44896e(0x186)](/[^a-z0-9]/g,'');for(const _0x46408b in _0x3d53c9){const _0x546a36=_0x46408b[_0x44896e(0x191)]()[_0x44896e(0x186)](/[^a-z0-9]/g,'');if(_0x546a36===_0x27705f)return _0x3d53c9[_0x46408b];}const _0x1afbfe=_0x1b3097[_0x44896e(0x191)]();if(_0x3d53c9[_0x1afbfe])return _0x3d53c9[_0x1afbfe];return undefined;}async function loadConfig(_0x3261ce){const _0x422432=a2_0x11cdec;try{const _0x599ed1=await _0x3261ce['getStateAsync'](_0x422432(0x17b));if(_0x599ed1&&_0x599ed1[_0x422432(0x16b)])return JSON[_0x422432(0x16c)](_0x599ed1[_0x422432(0x16b)]);}catch(_0x5a7d6d){}return{};}function a2_0x10f5(_0x5d4cc0,_0x49cf2c){const _0x3552c7=a2_0x5ba4();return a2_0x10f5=function(_0x3e94ce,_0x5a3b29){_0x3e94ce=_0x3e94ce-0x156;let _0x5ba476=_0x3552c7[_0x3e94ce];return _0x5ba476;},a2_0x10f5(_0x5d4cc0,_0x49cf2c);}async function isActive(_0x186f6b){const _0x1d001a=a2_0x11cdec;try{const _0x5e2f34=await _0x186f6b[_0x1d001a(0x160)](_0x1d001a(0x194));return _0x5e2f34&&_0x5e2f34['val'];}catch(_0x58c5fb){return![];}}async function areRoomsConnected(_0x99b078,_0x113895,_0x1d0a21){const _0x2030df=a2_0x11cdec;try{const _0x35e33e=await _0x99b078['getStateAsync'](_0x2030df(0x177));if(!_0x35e33e||!_0x35e33e[_0x2030df(0x16b)])return!![];const _0xccd52c=JSON['parse'](_0x35e33e[_0x2030df(0x16b)]),{rooms:_0x1b44fd,matrix:_0x56981f}=_0xccd52c;if(!_0x1b44fd||!_0x56981f)return!![];const _0x51afc8=_0x1b44fd[_0x2030df(0x158)](_0x113895),_0x3f5f29=_0x1b44fd[_0x2030df(0x158)](_0x1d0a21);if(_0x51afc8===-0x1||_0x3f5f29===-0x1)return!![];const _0x307792=_0x56981f[_0x51afc8][_0x3f5f29]>0x0||_0x56981f[_0x3f5f29][_0x51afc8]>0x0;return _0x307792;}catch(_0x20d1dd){return _0x99b078['log'][_0x2030df(0x15b)](_0x2030df(0x193)+_0x20d1dd[_0x2030df(0x18d)]),!![];}}function calculateSleepProbability(_0x4db614){const _0x2b9291=a2_0x11cdec,_0x2d5d34=new Date(),_0x8a4d02=_0x2d5d34[_0x2b9291(0x17f)](),_0x248378=_0x4db614['toLowerCase']();let _0x2c2611=0.1;if(_0x8a4d02>=0x17||_0x8a4d02<=0x6)_0x2c2611=0x1;else{if(_0x8a4d02>=0xd&&_0x8a4d02<=0xf)_0x2c2611=0.8;else{if(_0x8a4d02>=0x14&&_0x8a4d02<=0x17)_0x2c2611=0.4;}}let _0x271267=0.1;if(_0x248378['includes'](_0x2b9291(0x172))||_0x248378['includes'](_0x2b9291(0x188)))_0x271267=0x1;else{if(_0x248378[_0x2b9291(0x183)]('wohn')||_0x248378[_0x2b9291(0x183)](_0x2b9291(0x180))||_0x248378[_0x2b9291(0x183)]('sofa'))_0x271267=0.6;else{if(_0x248378[_0x2b9291(0x183)]('bad')||_0x248378[_0x2b9291(0x183)]('wc'))_0x271267=0.05;}}let _0x44e67e=0.5;const _0x187c35=_0x271267*0.5+_0x2c2611*0.3+_0x44e67e*0.2;return parseFloat(_0x187c35[_0x2b9291(0x15f)](0x2));}async function updateLocation(_0x327dcb,_0x188bd7){const _0x3f1787=a2_0x11cdec;if(!_0x188bd7||_0x188bd7===_0x3f1787(0x157))return;if(!await isActive(_0x327dcb)){resetTimer(_0x327dcb);return;}if(currentMonitoredRoom&&currentMonitoredRoom!==_0x188bd7){const _0x368389=await areRoomsConnected(_0x327dcb,currentMonitoredRoom,_0x188bd7);if(!_0x368389){const _0x6dff3=_0x3f1787(0x184)+_0x188bd7+_0x3f1787(0x169)+currentMonitoredRoom+'\x27.';_0x327dcb['log'][_0x3f1787(0x16f)](_0x3f1787(0x18e)+_0x6dff3+_0x3f1787(0x18b)),await _0x327dcb['setStateAsync'](_0x3f1787(0x175),{'val':JSON[_0x3f1787(0x16d)]({'room':_0x188bd7,'reason':_0x6dff3,'timestamp':Date[_0x3f1787(0x179)]()}),'ack':!![]});return;}resetTimer(_0x327dcb);}if(!currentMonitoredRoom){await _0x327dcb[_0x3f1787(0x185)](_0x3f1787(0x15a),{'val':_0x188bd7,'ack':!![]});const _0x12d352=await loadConfig(_0x327dcb);let _0x4bba97=getTimeoutRobust(_0x12d352,_0x188bd7);const _0x4ce344=_0x188bd7[_0x3f1787(0x191)]();if(!_0x4bba97)for(const _0x455081 in DEFAULT_TIMEOUTS){if(_0x4ce344[_0x3f1787(0x183)](_0x455081)){_0x4bba97=DEFAULT_TIMEOUTS[_0x455081];break;}}if(!_0x4bba97&&_0x12d352[_0x3f1787(0x182)])_0x4bba97=_0x12d352[_0x3f1787(0x182)];if(!_0x4bba97)return;currentMonitoredRoom=_0x188bd7,startTimer(_0x327dcb,_0x4bba97,_0x188bd7);}}function a2_0x5ba4(){const _0x11176c=['toFixed','getStateAsync','./setup','6047140JiCWoZ','\x20fÃ¼r\x20','10134232mTnKac','log','analysis.safety.deadMan.alarmState','\x20Min.','ðŸ’¤\x20Smart\x20Sleep\x20erkannt\x20(','\x27.\x20Nicht\x20verbunden\x20mit\x20Ã¼berwachtem\x20\x27','289707ZdadrS','val','parse','stringify','10cQggxl','info','7TEdvPe','pre_warn','schlaf','alarm','666042uCovTh','analysis.safety.deadMan.lastIgnored','3530658pDCsfi','analysis.topology.structure','analysis.safety.deadMan.napProbability','now','%).\x20VerlÃ¤ngere\x20Timer\x20fÃ¼r\x20','analysis.safety.deadMan.config','14548581QvjHNV','toString','sendNotification','getHours','living','(((.+)+)+)+$','default','includes','Ignoriere\x20Bewegung\x20in\x20\x27','setStateAsync','replace','â³\x20ACHTUNG:\x20UngewÃ¶hnlich\x20lange\x20InaktivitÃ¤t\x20in\x20','bed','analysis.safety.deadMan.smartSleep','constructor','\x20(Multi-Person\x20Filter)','ðŸš¨\x20NOTFALL-ALARM:\x20Person\x20reagiert\x20nicht\x20in\x20','message','[DeadMan]\x20','2wVilAG','16Zoyosv','toLowerCase','\x20um\x2090\x20Min.','[DeadMan]\x20Topology\x20check\x20failed:\x20','analysis.safety.deadMan.active','1500pSGmKR','Unknown','indexOf','1088940fBrDPB','analysis.safety.deadMan.currentRoom','warn','apply','error','exports'];a2_0x5ba4=function(){return _0x11176c;};return a2_0x5ba4();}function startTimer(_0x5d9a6e,_0x530a65,_0x3094bc){const _0x40eab1=a2_0x11cdec;if(activeTimer)clearTimeout(activeTimer);timeoutMs=_0x530a65*0x3c*0x3e8,startTime=Date[_0x40eab1(0x179)](),alarmStage=0x0;const _0x2e1581=calculateSleepProbability(_0x3094bc||currentMonitoredRoom),_0x3a3c4a=_0x2e1581>0.65;_0x3a3c4a?(timeoutMs+=0x5a*0x3c*0x3e8,_0x5d9a6e[_0x40eab1(0x165)][_0x40eab1(0x16f)](_0x40eab1(0x168)+(_0x2e1581*0x64)[_0x40eab1(0x15f)](0x0)+_0x40eab1(0x17a)+currentMonitoredRoom+_0x40eab1(0x192)),_0x5d9a6e[_0x40eab1(0x185)](_0x40eab1(0x189),{'val':!![],'ack':!![]})):_0x5d9a6e['setStateAsync'](_0x40eab1(0x189),{'val':![],'ack':!![]}),_0x5d9a6e[_0x40eab1(0x185)]('analysis.safety.deadMan.napProbability',{'val':_0x2e1581,'ack':!![]}),_0x5d9a6e['log'][_0x40eab1(0x16f)]('ðŸ‘¼\x20Schutzengel:\x20Ãœberwache\x20'+currentMonitoredRoom+_0x40eab1(0x163)+_0x530a65+_0x40eab1(0x167)),_0x5d9a6e[_0x40eab1(0x185)](_0x40eab1(0x166),{'val':'ok','ack':!![]}),activeTimer=setTimeout(()=>triggerPreWarn(_0x5d9a6e),timeoutMs);}function resetTimer(_0x17d1c0){const _0x37ca2e=a2_0x11cdec;if(activeTimer)clearTimeout(activeTimer);activeTimer=null,currentMonitoredRoom=null,alarmStage=0x0,_0x17d1c0[_0x37ca2e(0x185)](_0x37ca2e(0x166),{'val':'ok','ack':!![]}),_0x17d1c0[_0x37ca2e(0x185)](_0x37ca2e(0x189),{'val':![],'ack':!![]}),_0x17d1c0[_0x37ca2e(0x185)](_0x37ca2e(0x178),{'val':0x0,'ack':!![]});}async function triggerPreWarn(_0x189ed4){const _0x4104ce=a2_0x11cdec;alarmStage=0x1,await _0x189ed4[_0x4104ce(0x185)](_0x4104ce(0x166),{'val':_0x4104ce(0x171),'ack':!![]});const _0x5059ca=_0x4104ce(0x187)+currentMonitoredRoom+'.\x20Alles\x20in\x20Ordnung?';_0x189ed4[_0x4104ce(0x165)][_0x4104ce(0x15b)](_0x4104ce(0x18e)+_0x5059ca),await setup[_0x4104ce(0x17e)](_0x189ed4,'ðŸ‘¼\x20Schutzengel-Frage:\x20'+_0x5059ca),activeTimer=setTimeout(()=>triggerAlarm(_0x189ed4),0x5*0x3c*0x3e8);}async function triggerAlarm(_0x1876d6){const _0x29edc8=a2_0x11cdec;alarmStage=0x2,await _0x1876d6[_0x29edc8(0x185)]('analysis.safety.deadMan.alarmState',{'val':_0x29edc8(0x173),'ack':!![]});const _0x2227e3=_0x29edc8(0x18c)+currentMonitoredRoom+'!';_0x1876d6['log'][_0x29edc8(0x15d)](_0x29edc8(0x18e)+_0x2227e3),await setup[_0x29edc8(0x17e)](_0x1876d6,_0x2227e3,![],!![]);}module[a2_0x11cdec(0x15e)]={'updateLocation':updateLocation};