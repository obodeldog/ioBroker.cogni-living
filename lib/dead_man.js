const a2_0x530c6c=a2_0x1dc2;(function(_0x2a3b6e,_0x533527){const _0x11fd56=a2_0x1dc2,_0x23d033=_0x2a3b6e();while(!![]){try{const _0x9d3f17=-parseInt(_0x11fd56(0x1f8))/0x1+parseInt(_0x11fd56(0x1e8))/0x2*(parseInt(_0x11fd56(0x1ea))/0x3)+parseInt(_0x11fd56(0x1ce))/0x4*(-parseInt(_0x11fd56(0x1dd))/0x5)+-parseInt(_0x11fd56(0x1cc))/0x6+parseInt(_0x11fd56(0x1c0))/0x7*(-parseInt(_0x11fd56(0x1ec))/0x8)+parseInt(_0x11fd56(0x1fa))/0x9*(-parseInt(_0x11fd56(0x1d0))/0xa)+parseInt(_0x11fd56(0x1d7))/0xb;if(_0x9d3f17===_0x533527)break;else _0x23d033['push'](_0x23d033['shift']());}catch(_0x36cf8f){_0x23d033['push'](_0x23d033['shift']());}}}(a2_0x3bd7,0xf019b));const a2_0x43ca70=(function(){let _0x21ad56=!![];return function(_0x120f5f,_0x2e781a){const _0x3b3a3e=_0x21ad56?function(){const _0x30fa87=a2_0x1dc2;if(_0x2e781a){const _0x5bd21c=_0x2e781a[_0x30fa87(0x1e1)](_0x120f5f,arguments);return _0x2e781a=null,_0x5bd21c;}}:function(){};return _0x21ad56=![],_0x3b3a3e;};}()),a2_0x408711=a2_0x43ca70(this,function(){const _0x51ffcf=a2_0x1dc2;return a2_0x408711[_0x51ffcf(0x1d6)]()[_0x51ffcf(0x1d8)](_0x51ffcf(0x1c1))[_0x51ffcf(0x1d6)]()[_0x51ffcf(0x1de)](a2_0x408711)[_0x51ffcf(0x1d8)](_0x51ffcf(0x1c1));});a2_0x408711();'use strict';const setup=require(a2_0x530c6c(0x1bd));let activeTimer=null,currentMonitoredRoom=null,timeoutMs=0x0,startTime=0x0,alarmStage=0x0;function a2_0x3bd7(){const _0x56960a=['\x20um\x2090\x20Min.','bed','ðŸ‘¼\x20Schutzengel:\x20Ãœberwache\x20','924632yloELv','analysis.safety.deadMan.smartSleep','13023XkXEtc','./setup','includes','[DeadMan]\x20Topology\x20check\x20failed:\x20','129507etOLOD','(((.+)+)+)+$','%).\x20VerlÃ¤ngere\x20Timer\x20fÃ¼r\x20','bad','\x20Min.','analysis.safety.deadMan.lastIgnored','alarm','setStateAsync','val','[DeadMan]\x20','toFixed','analysis.safety.deadMan.alarmState','5851026UUKVxl','parse','10576vFqPLy','ðŸ’¤\x20Smart\x20Sleep\x20erkannt\x20(','12580yWFUZv','wohn','stringify','indexOf','error','replace','toString','52510128aSZjHH','search','exports','ðŸ‘¼\x20Schutzengel-Frage:\x20','.\x20Alles\x20in\x20Ordnung?','message','235DAwDHB','constructor','sofa','getStateAsync','apply','info','Unknown','sendNotification','Ignoriere\x20Bewegung\x20in\x20\x27','analysis.safety.deadMan.config','living','3401578trHtfa','warn','3rEshav','toLowerCase','712UOLnYo','\x20fÃ¼r\x20','analysis.safety.deadMan.active','â³\x20ACHTUNG:\x20UngewÃ¶hnlich\x20lange\x20InaktivitÃ¤t\x20in\x20','pre_warn','getHours','log','analysis.safety.deadMan.napProbability','now'];a2_0x3bd7=function(){return _0x56960a;};return a2_0x3bd7();}const DEFAULT_TIMEOUTS={'bad':0x2d,'bath':0x2d,'toilet':0x1e,'wc':0x1e,'keller':0x3c,'schlaf':0x78,'bed':0x78,'guest':0x5a,'gast':0x5a};function getTimeoutRobust(_0x1412fa,_0x4c20bc){const _0x98987c=a2_0x530c6c;if(!_0x1412fa||!_0x4c20bc)return undefined;if(_0x1412fa[_0x4c20bc])return _0x1412fa[_0x4c20bc];const _0xadd65=_0x4c20bc[_0x98987c(0x1eb)]()['replace'](/[^a-z0-9]/g,'');for(const _0x1320a1 in _0x1412fa){const _0x2d52ef=_0x1320a1[_0x98987c(0x1eb)]()[_0x98987c(0x1d5)](/[^a-z0-9]/g,'');if(_0x2d52ef===_0xadd65)return _0x1412fa[_0x1320a1];}const _0x2f61bf=_0x4c20bc['toLowerCase']();if(_0x1412fa[_0x2f61bf])return _0x1412fa[_0x2f61bf];return undefined;}async function loadConfig(_0x2d5656){const _0x3e185e=a2_0x530c6c;try{const _0x1536bb=await _0x2d5656[_0x3e185e(0x1e0)](_0x3e185e(0x1e6));if(_0x1536bb&&_0x1536bb[_0x3e185e(0x1c8)])return JSON[_0x3e185e(0x1cd)](_0x1536bb[_0x3e185e(0x1c8)]);}catch(_0x3e4b7c){}return{};}async function isActive(_0x187d69){const _0x56f526=a2_0x530c6c;try{const _0x4eef91=await _0x187d69['getStateAsync'](_0x56f526(0x1ee));return _0x4eef91&&_0x4eef91[_0x56f526(0x1c8)];}catch(_0x4769bb){return![];}}async function areRoomsConnected(_0x301887,_0x349ec0,_0x2f83e7){const _0x3ae599=a2_0x530c6c;try{const _0x59d652=await _0x301887[_0x3ae599(0x1e0)]('analysis.topology.structure');if(!_0x59d652||!_0x59d652[_0x3ae599(0x1c8)])return!![];const _0x22224e=JSON[_0x3ae599(0x1cd)](_0x59d652[_0x3ae599(0x1c8)]),{rooms:_0x374f28,matrix:_0x25d781}=_0x22224e;if(!_0x374f28||!_0x25d781)return!![];const _0x51b6d7=_0x374f28[_0x3ae599(0x1d3)](_0x349ec0),_0x4d4243=_0x374f28[_0x3ae599(0x1d3)](_0x2f83e7);if(_0x51b6d7===-0x1||_0x4d4243===-0x1)return!![];const _0x50977e=_0x25d781[_0x51b6d7][_0x4d4243]>0x0||_0x25d781[_0x4d4243][_0x51b6d7]>0x0;return _0x50977e;}catch(_0x2cd357){return _0x301887[_0x3ae599(0x1f2)][_0x3ae599(0x1e9)](_0x3ae599(0x1bf)+_0x2cd357[_0x3ae599(0x1dc)]),!![];}}function calculateSleepProbability(_0x108aaf){const _0x37e762=a2_0x530c6c,_0x378ad6=new Date(),_0x58dc70=_0x378ad6[_0x37e762(0x1f1)](),_0x2a05d7=_0x108aaf[_0x37e762(0x1eb)]();let _0x1d718e=0.1;if(_0x58dc70>=0x17||_0x58dc70<=0x6)_0x1d718e=0x1;else{if(_0x58dc70>=0xd&&_0x58dc70<=0xf)_0x1d718e=0.8;else{if(_0x58dc70>=0x14&&_0x58dc70<=0x17)_0x1d718e=0.4;}}let _0x194c08=0.1;if(_0x2a05d7[_0x37e762(0x1be)]('schlaf')||_0x2a05d7[_0x37e762(0x1be)](_0x37e762(0x1f6)))_0x194c08=0x1;else{if(_0x2a05d7[_0x37e762(0x1be)](_0x37e762(0x1d1))||_0x2a05d7['includes'](_0x37e762(0x1e7))||_0x2a05d7['includes'](_0x37e762(0x1df)))_0x194c08=0.6;else{if(_0x2a05d7[_0x37e762(0x1be)](_0x37e762(0x1c3))||_0x2a05d7['includes']('wc'))_0x194c08=0.05;}}let _0x5d7eb0=0.5;const _0x3014db=_0x194c08*0.5+_0x1d718e*0.3+_0x5d7eb0*0.2;return parseFloat(_0x3014db['toFixed'](0x2));}async function updateLocation(_0x2488cd,_0x148ea7){const _0x30d768=a2_0x530c6c;if(!_0x148ea7||_0x148ea7===_0x30d768(0x1e3))return;if(!await isActive(_0x2488cd)){resetTimer(_0x2488cd);return;}if(currentMonitoredRoom&&currentMonitoredRoom!==_0x148ea7){const _0x1698df=await areRoomsConnected(_0x2488cd,currentMonitoredRoom,_0x148ea7);if(!_0x1698df){const _0x1753b2=_0x30d768(0x1e5)+_0x148ea7+'\x27.\x20Nicht\x20verbunden\x20mit\x20Ã¼berwachtem\x20\x27'+currentMonitoredRoom+'\x27.';_0x2488cd['log'][_0x30d768(0x1e2)]('[DeadMan]\x20'+_0x1753b2+'\x20(Multi-Person\x20Filter)'),await _0x2488cd[_0x30d768(0x1c7)](_0x30d768(0x1c5),{'val':JSON[_0x30d768(0x1d2)]({'room':_0x148ea7,'reason':_0x1753b2,'timestamp':Date[_0x30d768(0x1f4)]()}),'ack':!![]});return;}resetTimer(_0x2488cd);}if(!currentMonitoredRoom){await _0x2488cd[_0x30d768(0x1c7)]('analysis.safety.deadMan.currentRoom',{'val':_0x148ea7,'ack':!![]});const _0x829daa=await loadConfig(_0x2488cd);let _0x27e76a=getTimeoutRobust(_0x829daa,_0x148ea7);const _0x631d3=_0x148ea7[_0x30d768(0x1eb)]();if(!_0x27e76a)for(const _0x4b7758 in DEFAULT_TIMEOUTS){if(_0x631d3[_0x30d768(0x1be)](_0x4b7758)){_0x27e76a=DEFAULT_TIMEOUTS[_0x4b7758];break;}}if(!_0x27e76a&&_0x829daa['default'])_0x27e76a=_0x829daa['default'];if(!_0x27e76a)return;currentMonitoredRoom=_0x148ea7,startTimer(_0x2488cd,_0x27e76a,_0x148ea7);}}function a2_0x1dc2(_0xa6dca4,_0x42432c){const _0x1f63bf=a2_0x3bd7();return a2_0x1dc2=function(_0x408711,_0x43ca70){_0x408711=_0x408711-0x1bd;let _0x3bd754=_0x1f63bf[_0x408711];return _0x3bd754;},a2_0x1dc2(_0xa6dca4,_0x42432c);}function startTimer(_0x34a455,_0x5a0cca,_0x3725cd){const _0x584ba3=a2_0x530c6c;if(activeTimer)clearTimeout(activeTimer);timeoutMs=_0x5a0cca*0x3c*0x3e8,startTime=Date[_0x584ba3(0x1f4)](),alarmStage=0x0;const _0x2048a1=calculateSleepProbability(_0x3725cd||currentMonitoredRoom),_0x52cd2c=_0x2048a1>0.65;_0x52cd2c?(timeoutMs+=0x5a*0x3c*0x3e8,_0x34a455['log'][_0x584ba3(0x1e2)](_0x584ba3(0x1cf)+(_0x2048a1*0x64)[_0x584ba3(0x1ca)](0x0)+_0x584ba3(0x1c2)+currentMonitoredRoom+_0x584ba3(0x1f5)),_0x34a455['setStateAsync'](_0x584ba3(0x1f9),{'val':!![],'ack':!![]})):_0x34a455['setStateAsync'](_0x584ba3(0x1f9),{'val':![],'ack':!![]}),_0x34a455[_0x584ba3(0x1c7)](_0x584ba3(0x1f3),{'val':_0x2048a1,'ack':!![]}),_0x34a455['log'][_0x584ba3(0x1e2)](_0x584ba3(0x1f7)+currentMonitoredRoom+_0x584ba3(0x1ed)+_0x5a0cca+_0x584ba3(0x1c4)),_0x34a455[_0x584ba3(0x1c7)](_0x584ba3(0x1cb),{'val':'ok','ack':!![]}),activeTimer=setTimeout(()=>triggerPreWarn(_0x34a455),timeoutMs);}function resetTimer(_0x3565dd){const _0x50f836=a2_0x530c6c;if(activeTimer)clearTimeout(activeTimer);activeTimer=null,currentMonitoredRoom=null,alarmStage=0x0,_0x3565dd[_0x50f836(0x1c7)](_0x50f836(0x1cb),{'val':'ok','ack':!![]}),_0x3565dd[_0x50f836(0x1c7)](_0x50f836(0x1f9),{'val':![],'ack':!![]}),_0x3565dd['setStateAsync'](_0x50f836(0x1f3),{'val':0x0,'ack':!![]});}async function triggerPreWarn(_0x4c2dcb){const _0x264af0=a2_0x530c6c;alarmStage=0x1,await _0x4c2dcb[_0x264af0(0x1c7)](_0x264af0(0x1cb),{'val':_0x264af0(0x1f0),'ack':!![]});const _0xcc397d=_0x264af0(0x1ef)+currentMonitoredRoom+_0x264af0(0x1db);_0x4c2dcb[_0x264af0(0x1f2)][_0x264af0(0x1e9)](_0x264af0(0x1c9)+_0xcc397d),await setup[_0x264af0(0x1e4)](_0x4c2dcb,_0x264af0(0x1da)+_0xcc397d),activeTimer=setTimeout(()=>triggerAlarm(_0x4c2dcb),0x5*0x3c*0x3e8);}async function triggerAlarm(_0x52db11){const _0x5ac16f=a2_0x530c6c;alarmStage=0x2,await _0x52db11[_0x5ac16f(0x1c7)](_0x5ac16f(0x1cb),{'val':_0x5ac16f(0x1c6),'ack':!![]});const _0x4d3774='ðŸš¨\x20NOTFALL-ALARM:\x20Person\x20reagiert\x20nicht\x20in\x20'+currentMonitoredRoom+'!';_0x52db11[_0x5ac16f(0x1f2)][_0x5ac16f(0x1d4)](_0x5ac16f(0x1c9)+_0x4d3774),await setup[_0x5ac16f(0x1e4)](_0x52db11,_0x4d3774,![],!![]);}module[a2_0x530c6c(0x1d9)]={'updateLocation':updateLocation};