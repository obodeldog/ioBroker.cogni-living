const a2_0x4607ab=a2_0x3c3a;(function(_0x507821,_0x586f6b){const _0x3552c8=a2_0x3c3a,_0x5141b1=_0x507821();while(!![]){try{const _0xc77218=-parseInt(_0x3552c8(0xb5))/0x1*(-parseInt(_0x3552c8(0x8e))/0x2)+-parseInt(_0x3552c8(0x92))/0x3+-parseInt(_0x3552c8(0xb9))/0x4+parseInt(_0x3552c8(0xb1))/0x5*(-parseInt(_0x3552c8(0x9d))/0x6)+-parseInt(_0x3552c8(0x97))/0x7+parseInt(_0x3552c8(0x8b))/0x8+-parseInt(_0x3552c8(0x93))/0x9*(-parseInt(_0x3552c8(0x9f))/0xa);if(_0xc77218===_0x586f6b)break;else _0x5141b1['push'](_0x5141b1['shift']());}catch(_0x335fc2){_0x5141b1['push'](_0x5141b1['shift']());}}}(a2_0x472b,0x21cb1));const a2_0x513149=(function(){let _0x1a052a=!![];return function(_0x4a8802,_0x10aba2){const _0x19786f=_0x1a052a?function(){const _0x242e27=a2_0x3c3a;if(_0x10aba2){const _0x205275=_0x10aba2[_0x242e27(0xb4)](_0x4a8802,arguments);return _0x10aba2=null,_0x205275;}}:function(){};return _0x1a052a=![],_0x19786f;};}()),a2_0x5a5e1e=a2_0x513149(this,function(){const _0x427125=a2_0x3c3a;return a2_0x5a5e1e[_0x427125(0xb2)]()[_0x427125(0x90)]('(((.+)+)+)+$')[_0x427125(0xb2)]()[_0x427125(0xb0)](a2_0x5a5e1e)[_0x427125(0x90)](_0x427125(0xac));});function a2_0x472b(){const _0x22c16f=['constructor','5IXXOsQ','toString','exports','apply','15945eqUECS','toLowerCase','schlaf','analysis.safety.deadMan.lastIgnored','455536dEdeOI','analysis.safety.deadMan.active','sendNotification','\x20Min.','toFixed','analysis.safety.deadMan.napProbability','ðŸ‘¼\x20Schutzengel-Frage:\x20','alarm','ðŸš¨\x20NOTFALL-ALARM:\x20Person\x20reagiert\x20nicht\x20in\x20','.\x20Alles\x20in\x20Ordnung?','default','340160BeVtOT','indexOf','[DeadMan]\x20Topology\x20check\x20failed:\x20','14DEImSe','val','search','\x20(Multi-Person\x20Filter)','379011NZmwAW','9HFUjAl','wohn','parse','warn','1842813YNucVi','stringify','replace','sofa','message','setStateAsync','23334lVzCJa','includes','4916510TLJFYa','\x20fÃ¼r\x20','â³\x20ACHTUNG:\x20UngewÃ¶hnlich\x20lange\x20InaktivitÃ¤t\x20in\x20','Unknown','ðŸ‘¼\x20Schutzengel:\x20Ãœberwache\x20','info','\x20um\x2090\x20Min.','analysis.safety.deadMan.smartSleep','log','analysis.topology.structure','error','analysis.safety.deadMan.config','getStateAsync','(((.+)+)+)+$','[DeadMan]\x20','analysis.safety.deadMan.alarmState','now'];a2_0x472b=function(){return _0x22c16f;};return a2_0x472b();}a2_0x5a5e1e();'use strict';function a2_0x3c3a(_0x110c08,_0x352ea5){const _0x2b8ded=a2_0x472b();return a2_0x3c3a=function(_0x5a5e1e,_0x513149){_0x5a5e1e=_0x5a5e1e-0x88;let _0x472b2f=_0x2b8ded[_0x5a5e1e];return _0x472b2f;},a2_0x3c3a(_0x110c08,_0x352ea5);}const setup=require('./setup');let activeTimer=null,currentMonitoredRoom=null,timeoutMs=0x0,startTime=0x0,alarmStage=0x0;const DEFAULT_TIMEOUTS={'bad':0x2d,'bath':0x2d,'toilet':0x1e,'wc':0x1e,'keller':0x3c,'schlaf':0x78,'bed':0x78,'guest':0x5a,'gast':0x5a};function getTimeoutRobust(_0x56ca2b,_0x14af21){const _0x5db82b=a2_0x3c3a;if(!_0x56ca2b||!_0x14af21)return undefined;if(_0x56ca2b[_0x14af21])return _0x56ca2b[_0x14af21];const _0x1caac3=_0x14af21['toLowerCase']()[_0x5db82b(0x99)](/[^a-z0-9]/g,'');for(const _0x13551f in _0x56ca2b){const _0x30dee9=_0x13551f[_0x5db82b(0xb6)]()['replace'](/[^a-z0-9]/g,'');if(_0x30dee9===_0x1caac3)return _0x56ca2b[_0x13551f];}const _0x3da5c1=_0x14af21[_0x5db82b(0xb6)]();if(_0x56ca2b[_0x3da5c1])return _0x56ca2b[_0x3da5c1];return undefined;}async function loadConfig(_0x857a26){const _0x5d968b=a2_0x3c3a;try{const _0x353914=await _0x857a26[_0x5d968b(0xab)](_0x5d968b(0xaa));if(_0x353914&&_0x353914[_0x5d968b(0x8f)])return JSON[_0x5d968b(0x95)](_0x353914[_0x5d968b(0x8f)]);}catch(_0x2c54ab){}return{};}async function isActive(_0x12c2f6){const _0x130793=a2_0x3c3a;try{const _0x54762f=await _0x12c2f6[_0x130793(0xab)](_0x130793(0xba));return _0x54762f&&_0x54762f[_0x130793(0x8f)];}catch(_0x1ac906){return![];}}async function areRoomsConnected(_0x13bc48,_0x29bf24,_0x26808c){const _0x106f85=a2_0x3c3a;try{const _0x1a0106=await _0x13bc48[_0x106f85(0xab)](_0x106f85(0xa8));if(!_0x1a0106||!_0x1a0106[_0x106f85(0x8f)])return!![];const _0xc6b23c=JSON[_0x106f85(0x95)](_0x1a0106[_0x106f85(0x8f)]),{rooms:_0x4edf24,matrix:_0x13b283}=_0xc6b23c;if(!_0x4edf24||!_0x13b283)return!![];const _0x17dffd=_0x4edf24[_0x106f85(0x8c)](_0x29bf24),_0x139584=_0x4edf24[_0x106f85(0x8c)](_0x26808c);if(_0x17dffd===-0x1||_0x139584===-0x1)return!![];const _0x793859=_0x13b283[_0x17dffd][_0x139584]>0x0||_0x13b283[_0x139584][_0x17dffd]>0x0;return _0x793859;}catch(_0x545520){return _0x13bc48[_0x106f85(0xa7)][_0x106f85(0x96)](_0x106f85(0x8d)+_0x545520[_0x106f85(0x9b)]),!![];}}function calculateSleepProbability(_0x17f6c2){const _0x8c8632=a2_0x3c3a,_0x4d18ed=new Date(),_0x27e2d8=_0x4d18ed['getHours'](),_0x4432a9=_0x17f6c2[_0x8c8632(0xb6)]();let _0x52d1ca=0.1;if(_0x27e2d8>=0x17||_0x27e2d8<=0x6)_0x52d1ca=0x1;else{if(_0x27e2d8>=0xd&&_0x27e2d8<=0xf)_0x52d1ca=0.8;else{if(_0x27e2d8>=0x14&&_0x27e2d8<=0x17)_0x52d1ca=0.4;}}let _0x4d64d8=0.1;if(_0x4432a9[_0x8c8632(0x9e)](_0x8c8632(0xb7))||_0x4432a9[_0x8c8632(0x9e)]('bed'))_0x4d64d8=0x1;else{if(_0x4432a9[_0x8c8632(0x9e)](_0x8c8632(0x94))||_0x4432a9['includes']('living')||_0x4432a9[_0x8c8632(0x9e)](_0x8c8632(0x9a)))_0x4d64d8=0.6;else{if(_0x4432a9[_0x8c8632(0x9e)]('bad')||_0x4432a9[_0x8c8632(0x9e)]('wc'))_0x4d64d8=0.05;}}let _0x4b0378=0.5;const _0x2f1ae6=_0x4d64d8*0.5+_0x52d1ca*0.3+_0x4b0378*0.2;return parseFloat(_0x2f1ae6[_0x8c8632(0xbd)](0x2));}async function updateLocation(_0x58e9d1,_0x23fce3){const _0x1337ff=a2_0x3c3a;if(!_0x23fce3||_0x23fce3===_0x1337ff(0xa2))return;if(!await isActive(_0x58e9d1)){resetTimer(_0x58e9d1);return;}if(currentMonitoredRoom&&currentMonitoredRoom!==_0x23fce3){const _0x1d5356=await areRoomsConnected(_0x58e9d1,currentMonitoredRoom,_0x23fce3);if(!_0x1d5356){const _0x165341='Ignoriere\x20Bewegung\x20in\x20\x27'+_0x23fce3+'\x27.\x20Nicht\x20verbunden\x20mit\x20Ã¼berwachtem\x20\x27'+currentMonitoredRoom+'\x27.';_0x58e9d1[_0x1337ff(0xa7)][_0x1337ff(0xa4)](_0x1337ff(0xad)+_0x165341+_0x1337ff(0x91)),await _0x58e9d1[_0x1337ff(0x9c)](_0x1337ff(0xb8),{'val':JSON[_0x1337ff(0x98)]({'room':_0x23fce3,'reason':_0x165341,'timestamp':Date[_0x1337ff(0xaf)]()}),'ack':!![]});return;}resetTimer(_0x58e9d1);}if(!currentMonitoredRoom){await _0x58e9d1['setStateAsync']('analysis.safety.deadMan.currentRoom',{'val':_0x23fce3,'ack':!![]});const _0x387632=await loadConfig(_0x58e9d1);let _0x1e3f3d=getTimeoutRobust(_0x387632,_0x23fce3);const _0x3ffe61=_0x23fce3['toLowerCase']();if(!_0x1e3f3d)for(const _0x488d08 in DEFAULT_TIMEOUTS){if(_0x3ffe61['includes'](_0x488d08)){_0x1e3f3d=DEFAULT_TIMEOUTS[_0x488d08];break;}}if(!_0x1e3f3d&&_0x387632[_0x1337ff(0x8a)])_0x1e3f3d=_0x387632['default'];if(!_0x1e3f3d)return;currentMonitoredRoom=_0x23fce3,startTimer(_0x58e9d1,_0x1e3f3d,_0x23fce3);}}function startTimer(_0x26518a,_0x1f3dc7,_0x11c223){const _0x37c281=a2_0x3c3a;if(activeTimer)clearTimeout(activeTimer);timeoutMs=_0x1f3dc7*0x3c*0x3e8,startTime=Date[_0x37c281(0xaf)](),alarmStage=0x0;const _0x5c6952=calculateSleepProbability(_0x11c223||currentMonitoredRoom),_0x57bd42=_0x5c6952>0.65;_0x57bd42?(timeoutMs+=0x5a*0x3c*0x3e8,_0x26518a['log'][_0x37c281(0xa4)]('ðŸ’¤\x20Smart\x20Sleep\x20erkannt\x20('+(_0x5c6952*0x64)[_0x37c281(0xbd)](0x0)+'%).\x20VerlÃ¤ngere\x20Timer\x20fÃ¼r\x20'+currentMonitoredRoom+_0x37c281(0xa5)),_0x26518a['setStateAsync'](_0x37c281(0xa6),{'val':!![],'ack':!![]})):_0x26518a[_0x37c281(0x9c)](_0x37c281(0xa6),{'val':![],'ack':!![]}),_0x26518a[_0x37c281(0x9c)](_0x37c281(0xbe),{'val':_0x5c6952,'ack':!![]}),_0x26518a['log'][_0x37c281(0xa4)](_0x37c281(0xa3)+currentMonitoredRoom+_0x37c281(0xa0)+_0x1f3dc7+_0x37c281(0xbc)),_0x26518a[_0x37c281(0x9c)](_0x37c281(0xae),{'val':'ok','ack':!![]}),activeTimer=setTimeout(()=>triggerPreWarn(_0x26518a),timeoutMs);}function resetTimer(_0x571fca){const _0x101b43=a2_0x3c3a;if(activeTimer)clearTimeout(activeTimer);activeTimer=null,currentMonitoredRoom=null,alarmStage=0x0,_0x571fca['setStateAsync'](_0x101b43(0xae),{'val':'ok','ack':!![]}),_0x571fca[_0x101b43(0x9c)](_0x101b43(0xa6),{'val':![],'ack':!![]}),_0x571fca[_0x101b43(0x9c)](_0x101b43(0xbe),{'val':0x0,'ack':!![]});}async function triggerPreWarn(_0x151f91){const _0x260302=a2_0x3c3a;alarmStage=0x1,await _0x151f91[_0x260302(0x9c)](_0x260302(0xae),{'val':'pre_warn','ack':!![]});const _0x2fe787=_0x260302(0xa1)+currentMonitoredRoom+_0x260302(0x89);_0x151f91[_0x260302(0xa7)][_0x260302(0x96)](_0x260302(0xad)+_0x2fe787),await setup[_0x260302(0xbb)](_0x151f91,_0x260302(0xbf)+_0x2fe787),activeTimer=setTimeout(()=>triggerAlarm(_0x151f91),0x5*0x3c*0x3e8);}async function triggerAlarm(_0x1f149e){const _0xa70dc3=a2_0x3c3a;alarmStage=0x2,await _0x1f149e[_0xa70dc3(0x9c)](_0xa70dc3(0xae),{'val':_0xa70dc3(0xc0),'ack':!![]});const _0x19a3c7=_0xa70dc3(0x88)+currentMonitoredRoom+'!';_0x1f149e[_0xa70dc3(0xa7)][_0xa70dc3(0xa9)](_0xa70dc3(0xad)+_0x19a3c7),await setup[_0xa70dc3(0xbb)](_0x1f149e,_0x19a3c7,![],!![]);}module[a2_0x4607ab(0xb3)]={'updateLocation':updateLocation};