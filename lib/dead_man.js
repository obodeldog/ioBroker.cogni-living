const a2_0x18d839=a2_0x3b8e;(function(_0x1b98df,_0x3f146d){const _0x5c45e3=a2_0x3b8e,_0x388415=_0x1b98df();while(!![]){try{const _0x1c95e3=parseInt(_0x5c45e3(0xf5))/0x1*(-parseInt(_0x5c45e3(0xd5))/0x2)+-parseInt(_0x5c45e3(0xf2))/0x3*(parseInt(_0x5c45e3(0xe0))/0x4)+-parseInt(_0x5c45e3(0xfd))/0x5*(parseInt(_0x5c45e3(0xe1))/0x6)+-parseInt(_0x5c45e3(0xff))/0x7+parseInt(_0x5c45e3(0xf9))/0x8*(-parseInt(_0x5c45e3(0xd9))/0x9)+-parseInt(_0x5c45e3(0xe6))/0xa+parseInt(_0x5c45e3(0xfc))/0xb*(parseInt(_0x5c45e3(0xe5))/0xc);if(_0x1c95e3===_0x3f146d)break;else _0x388415['push'](_0x388415['shift']());}catch(_0x35971a){_0x388415['push'](_0x388415['shift']());}}}(a2_0x290f,0x9a215));function a2_0x3b8e(_0x1c551e,_0x210aec){const _0x16636d=a2_0x290f();return a2_0x3b8e=function(_0xec33a1,_0x1efbd9){_0xec33a1=_0xec33a1-0xd5;let _0x290fef=_0x16636d[_0xec33a1];return _0x290fef;},a2_0x3b8e(_0x1c551e,_0x210aec);}function a2_0x290f(){const _0x45cfff=['now','message','.\x20Alles\x20in\x20Ordnung?','analysis.topology.structure','sendNotification','val','setStateAsync','toLowerCase','1010502abDMKO','analysis.safety.deadMan.alarmState','\x20Min.','2501SfNAmy','parse','apply','search','1208EeIIEl','ðŸ‘¼\x20Schutzengel-Frage:\x20','ðŸš¨\x20NOTFALL-ALARM:\x20Person\x20reagiert\x20nicht\x20in\x20','363dHXasl','155Agzifp','Ignoriere\x20Bewegung\x20in\x20\x27','6424299cySRRH','\x20(Multi-Person\x20Filter)','ðŸ‘¼\x20Schutzengel:\x20Ãœberwache\x20','(((.+)+)+)+$','log','getStateAsync','326RQuVvM','default','indexOf','exports','23148onhxAE','info','stringify','error','analysis.safety.deadMan.active','pre_warn','alarm','12dqjUAa','163596yXKwJd','Unknown','\x20fÃ¼r\x20','[DeadMan]\x20','1559508yyWNIO','877900vWPVPL','constructor','includes','./setup'];a2_0x290f=function(){return _0x45cfff;};return a2_0x290f();}const a2_0x1efbd9=(function(){let _0x24fd3f=!![];return function(_0x2c1390,_0x1e4a7b){const _0x362945=_0x24fd3f?function(){const _0x5a5e81=a2_0x3b8e;if(_0x1e4a7b){const _0x40cf66=_0x1e4a7b[_0x5a5e81(0xf7)](_0x2c1390,arguments);return _0x1e4a7b=null,_0x40cf66;}}:function(){};return _0x24fd3f=![],_0x362945;};}()),a2_0xec33a1=a2_0x1efbd9(this,function(){const _0x164e9d=a2_0x3b8e;return a2_0xec33a1['toString']()[_0x164e9d(0xf8)]('(((.+)+)+)+$')['toString']()[_0x164e9d(0xe7)](a2_0xec33a1)[_0x164e9d(0xf8)](_0x164e9d(0x102));});a2_0xec33a1();'use strict';const setup=require(a2_0x18d839(0xe9));let activeTimer=null,currentMonitoredRoom=null,timeoutMs=0x0,startTime=0x0,alarmStage=0x0;const DEFAULT_TIMEOUTS={'bad':0x2d,'bath':0x2d,'toilet':0x1e,'wc':0x1e,'keller':0x3c};async function loadConfig(_0x114c73){const _0x10299f=a2_0x18d839;try{const _0x101a21=await _0x114c73[_0x10299f(0x104)]('analysis.safety.deadMan.config');if(_0x101a21&&_0x101a21['val'])return JSON[_0x10299f(0xf6)](_0x101a21[_0x10299f(0xef)]);}catch(_0x302e07){}return{};}async function isActive(_0x2f66d6){const _0x7daf5c=a2_0x18d839;try{const _0x2815c6=await _0x2f66d6[_0x7daf5c(0x104)](_0x7daf5c(0xdd));return _0x2815c6&&_0x2815c6[_0x7daf5c(0xef)];}catch(_0x508187){return![];}}async function areRoomsConnected(_0x3e235e,_0x1b6104,_0x47c622){const _0x3878f7=a2_0x18d839;try{const _0x31272b=await _0x3e235e['getStateAsync'](_0x3878f7(0xed));if(!_0x31272b||!_0x31272b[_0x3878f7(0xef)])return!![];const _0x5a0314=JSON['parse'](_0x31272b[_0x3878f7(0xef)]),{rooms:_0x1417a4,matrix:_0xdc28b7}=_0x5a0314;if(!_0x1417a4||!_0xdc28b7)return!![];const _0x1d36c5=_0x1417a4[_0x3878f7(0xd7)](_0x1b6104),_0x46fcbb=_0x1417a4[_0x3878f7(0xd7)](_0x47c622);if(_0x1d36c5===-0x1||_0x46fcbb===-0x1)return!![];const _0x5159f8=_0xdc28b7[_0x1d36c5][_0x46fcbb]>0x0||_0xdc28b7[_0x46fcbb][_0x1d36c5]>0x0;return _0x5159f8;}catch(_0x6d362e){return _0x3e235e[_0x3878f7(0x103)]['warn']('[DeadMan]\x20Topology\x20check\x20failed:\x20'+_0x6d362e[_0x3878f7(0xeb)]),!![];}}async function updateLocation(_0x52c60b,_0xf2a74d){const _0x31c940=a2_0x18d839;if(!_0xf2a74d||_0xf2a74d===_0x31c940(0xe2))return;if(!await isActive(_0x52c60b)){resetTimer(_0x52c60b);return;}if(currentMonitoredRoom&&currentMonitoredRoom!==_0xf2a74d){const _0x5140b5=await areRoomsConnected(_0x52c60b,currentMonitoredRoom,_0xf2a74d);if(!_0x5140b5){const _0x17024d=_0x31c940(0xfe)+_0xf2a74d+'\x27.\x20Nicht\x20verbunden\x20mit\x20Ã¼berwachtem\x20\x27'+currentMonitoredRoom+'\x27.';_0x52c60b[_0x31c940(0x103)]['info'](_0x31c940(0xe4)+_0x17024d+_0x31c940(0x100)),await _0x52c60b['setStateAsync']('analysis.safety.deadMan.lastIgnored',{'val':JSON[_0x31c940(0xdb)]({'room':_0xf2a74d,'reason':_0x17024d,'timestamp':Date[_0x31c940(0xea)]()}),'ack':!![]});return;}resetTimer(_0x52c60b);}if(!currentMonitoredRoom){await _0x52c60b[_0x31c940(0xf0)]('analysis.safety.deadMan.currentRoom',{'val':_0xf2a74d,'ack':!![]});const _0x5c9de8=await loadConfig(_0x52c60b),_0x4b0eb8=_0xf2a74d[_0x31c940(0xf1)]();let _0x5aaf2f=_0x5c9de8[_0xf2a74d]||_0x5c9de8[_0x4b0eb8];if(!_0x5aaf2f)for(const _0x38153f in DEFAULT_TIMEOUTS){if(_0x4b0eb8[_0x31c940(0xe8)](_0x38153f)){_0x5aaf2f=DEFAULT_TIMEOUTS[_0x38153f];break;}}if(!_0x5aaf2f&&_0x5c9de8[_0x31c940(0xd6)])_0x5aaf2f=_0x5c9de8[_0x31c940(0xd6)];if(!_0x5aaf2f)return;currentMonitoredRoom=_0xf2a74d,startTimer(_0x52c60b,_0x5aaf2f);}}function startTimer(_0x5376ec,_0xd8decc){const _0x3b9cb2=a2_0x18d839;if(activeTimer)clearTimeout(activeTimer);timeoutMs=_0xd8decc*0x3c*0x3e8,startTime=Date['now'](),alarmStage=0x0,_0x5376ec[_0x3b9cb2(0x103)][_0x3b9cb2(0xda)](_0x3b9cb2(0x101)+currentMonitoredRoom+_0x3b9cb2(0xe3)+_0xd8decc+_0x3b9cb2(0xf4)),_0x5376ec[_0x3b9cb2(0xf0)](_0x3b9cb2(0xf3),{'val':'ok','ack':!![]}),activeTimer=setTimeout(()=>triggerPreWarn(_0x5376ec),timeoutMs);}function resetTimer(_0x308dc9){if(activeTimer)clearTimeout(activeTimer);activeTimer=null,currentMonitoredRoom=null,alarmStage=0x0,_0x308dc9['setStateAsync']('analysis.safety.deadMan.alarmState',{'val':'ok','ack':!![]});}async function triggerPreWarn(_0x3e9ad6){const _0x219629=a2_0x18d839;alarmStage=0x1,await _0x3e9ad6[_0x219629(0xf0)](_0x219629(0xf3),{'val':_0x219629(0xde),'ack':!![]});const _0x3b3e3a='â³\x20ACHTUNG:\x20UngewÃ¶hnlich\x20lange\x20InaktivitÃ¤t\x20in\x20'+currentMonitoredRoom+_0x219629(0xec);_0x3e9ad6[_0x219629(0x103)]['warn'](_0x219629(0xe4)+_0x3b3e3a),await setup[_0x219629(0xee)](_0x3e9ad6,_0x219629(0xfa)+_0x3b3e3a),activeTimer=setTimeout(()=>triggerAlarm(_0x3e9ad6),0x5*0x3c*0x3e8);}async function triggerAlarm(_0x31e176){const _0xe8ddb8=a2_0x18d839;alarmStage=0x2,await _0x31e176['setStateAsync'](_0xe8ddb8(0xf3),{'val':_0xe8ddb8(0xdf),'ack':!![]});const _0x436efa=_0xe8ddb8(0xfb)+currentMonitoredRoom+'!';_0x31e176[_0xe8ddb8(0x103)][_0xe8ddb8(0xdc)](_0xe8ddb8(0xe4)+_0x436efa),await setup['sendNotification'](_0x31e176,_0x436efa,![],!![]);}module[a2_0x18d839(0xd8)]={'updateLocation':updateLocation};