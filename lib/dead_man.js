(function(_0x1eda4f,_0xd84f32){const _0x3ba8b0=a2_0x2bd0,_0x18f79f=_0x1eda4f();while(!![]){try{const _0x233cad=parseInt(_0x3ba8b0(0x187))/0x1+parseInt(_0x3ba8b0(0x185))/0x2*(parseInt(_0x3ba8b0(0x186))/0x3)+-parseInt(_0x3ba8b0(0x1a2))/0x4*(-parseInt(_0x3ba8b0(0x195))/0x5)+parseInt(_0x3ba8b0(0x18e))/0x6+parseInt(_0x3ba8b0(0x18b))/0x7+parseInt(_0x3ba8b0(0x189))/0x8*(-parseInt(_0x3ba8b0(0x18f))/0x9)+-parseInt(_0x3ba8b0(0x1a6))/0xa*(parseInt(_0x3ba8b0(0x198))/0xb);if(_0x233cad===_0xd84f32)break;else _0x18f79f['push'](_0x18f79f['shift']());}catch(_0x2c60dd){_0x18f79f['push'](_0x18f79f['shift']());}}}(a2_0x17c4,0xebc92));const a2_0xcc4632=(function(){let _0x163cb2=!![];return function(_0x4ef29c,_0x2759c8){const _0x173050=_0x163cb2?function(){if(_0x2759c8){const _0x3ebe8a=_0x2759c8['apply'](_0x4ef29c,arguments);return _0x2759c8=null,_0x3ebe8a;}}:function(){};return _0x163cb2=![],_0x173050;};}()),a2_0x4669fe=a2_0xcc4632(this,function(){const _0x205939=a2_0x2bd0;return a2_0x4669fe[_0x205939(0x197)]()[_0x205939(0x1a3)](_0x205939(0x19a))[_0x205939(0x197)]()[_0x205939(0x1a4)](a2_0x4669fe)[_0x205939(0x1a3)](_0x205939(0x19a));});a2_0x4669fe();function a2_0x17c4(){const _0x320786=['info','setStateAsync','warn','stringify','5017755hkmrbB','â³\x20ACHTUNG:\x20UngewÃ¶hnlich\x20lange\x20InaktivitÃ¤t\x20in\x20','toString','2079HGzevr','alarm','(((.+)+)+)+$','analysis.safety.deadMan.alarmState','indexOf','analysis.safety.deadMan.config','sendNotification','.\x20Alles\x20in\x20Ordnung?','ðŸ‘¼\x20Schutzengel-Frage:\x20','\x20Min.','4LUwrcV','search','constructor','Unknown','143850SZJADp','error','\x27.\x20Nicht\x20verbunden\x20mit\x20Ã¼berwachtem\x20\x27','message','ðŸš¨\x20NOTFALL-ALARM:\x20Person\x20reagiert\x20nicht\x20in\x20','analysis.safety.deadMan.lastIgnored','val','\x20(Multi-Person\x20Filter)','parse','getStateAsync','includes','210754RQcRSJ','42ZFLNlI','346229OjErNn','default','1432TNHGDM','analysis.safety.deadMan.currentRoom','12038229mfpVro','[DeadMan]\x20','[DeadMan]\x20Topology\x20check\x20failed:\x20','3423984NxpWqC','71946IKrCOK','log'];a2_0x17c4=function(){return _0x320786;};return a2_0x17c4();}'use strict';const setup=require('./setup');let activeTimer=null,currentMonitoredRoom=null,timeoutMs=0x0,startTime=0x0,alarmStage=0x0;const DEFAULT_TIMEOUTS={'bad':0x2d,'bath':0x2d,'toilet':0x1e,'wc':0x1e,'keller':0x3c};function a2_0x2bd0(_0x509a03,_0x192402){const _0x1de849=a2_0x17c4();return a2_0x2bd0=function(_0x4669fe,_0xcc4632){_0x4669fe=_0x4669fe-0x183;let _0x17c429=_0x1de849[_0x4669fe];return _0x17c429;},a2_0x2bd0(_0x509a03,_0x192402);}async function loadConfig(_0x14f3af){const _0x2bb2c7=a2_0x2bd0;try{const _0x1a4e90=await _0x14f3af[_0x2bb2c7(0x183)](_0x2bb2c7(0x19d));if(_0x1a4e90&&_0x1a4e90['val'])return JSON[_0x2bb2c7(0x1ae)](_0x1a4e90['val']);}catch(_0x1864ec){}return{};}async function isActive(_0x58040e){const _0x4c6ef6=a2_0x2bd0;try{const _0x1931af=await _0x58040e[_0x4c6ef6(0x183)]('analysis.safety.deadMan.active');return _0x1931af&&_0x1931af[_0x4c6ef6(0x1ac)];}catch(_0x246d02){return![];}}async function areRoomsConnected(_0x306778,_0x54d19a,_0x3ac3cb){const _0x2d0d09=a2_0x2bd0;try{const _0x251e60=await _0x306778[_0x2d0d09(0x183)]('analysis.topology.structure');if(!_0x251e60||!_0x251e60[_0x2d0d09(0x1ac)])return!![];const _0x1fbea9=JSON[_0x2d0d09(0x1ae)](_0x251e60[_0x2d0d09(0x1ac)]),{rooms:_0x785cec,matrix:_0x600b9f}=_0x1fbea9;if(!_0x785cec||!_0x600b9f)return!![];const _0x5dc11c=_0x785cec['indexOf'](_0x54d19a),_0x232cb8=_0x785cec[_0x2d0d09(0x19c)](_0x3ac3cb);if(_0x5dc11c===-0x1||_0x232cb8===-0x1)return!![];const _0xb4fd6c=_0x600b9f[_0x5dc11c][_0x232cb8]>0x0||_0x600b9f[_0x232cb8][_0x5dc11c]>0x0;return _0xb4fd6c;}catch(_0x194a22){return _0x306778[_0x2d0d09(0x190)]['warn'](_0x2d0d09(0x18d)+_0x194a22[_0x2d0d09(0x1a9)]),!![];}}async function updateLocation(_0x1f9096,_0x337cb9){const _0x487140=a2_0x2bd0;if(!_0x337cb9||_0x337cb9===_0x487140(0x1a5))return;if(!await isActive(_0x1f9096)){resetTimer(_0x1f9096);return;}if(currentMonitoredRoom&&currentMonitoredRoom!==_0x337cb9){const _0x3a46b6=await areRoomsConnected(_0x1f9096,currentMonitoredRoom,_0x337cb9);if(!_0x3a46b6){const _0x2e770b='Ignoriere\x20Bewegung\x20in\x20\x27'+_0x337cb9+_0x487140(0x1a8)+currentMonitoredRoom+'\x27.';_0x1f9096[_0x487140(0x190)][_0x487140(0x191)](_0x487140(0x18c)+_0x2e770b+_0x487140(0x1ad)),await _0x1f9096[_0x487140(0x192)](_0x487140(0x1ab),{'val':JSON[_0x487140(0x194)]({'room':_0x337cb9,'reason':_0x2e770b,'timestamp':Date['now']()}),'ack':!![]});return;}resetTimer(_0x1f9096);}if(!currentMonitoredRoom){await _0x1f9096[_0x487140(0x192)](_0x487140(0x18a),{'val':_0x337cb9,'ack':!![]});const _0x3e9a7b=await loadConfig(_0x1f9096),_0x1d6209=_0x337cb9['toLowerCase']();let _0x3c7fe0=_0x3e9a7b[_0x337cb9]||_0x3e9a7b[_0x1d6209];if(!_0x3c7fe0)for(const _0x3e34bd in DEFAULT_TIMEOUTS){if(_0x1d6209[_0x487140(0x184)](_0x3e34bd)){_0x3c7fe0=DEFAULT_TIMEOUTS[_0x3e34bd];break;}}if(!_0x3c7fe0&&_0x3e9a7b[_0x487140(0x188)])_0x3c7fe0=_0x3e9a7b[_0x487140(0x188)];if(!_0x3c7fe0)return;currentMonitoredRoom=_0x337cb9,startTimer(_0x1f9096,_0x3c7fe0);}}function startTimer(_0x556cfb,_0x18731c){const _0x5535d4=a2_0x2bd0;if(activeTimer)clearTimeout(activeTimer);timeoutMs=_0x18731c*0x3c*0x3e8,startTime=Date['now'](),alarmStage=0x0,_0x556cfb[_0x5535d4(0x190)]['info']('ðŸ‘¼\x20Schutzengel:\x20Ãœberwache\x20'+currentMonitoredRoom+'\x20fÃ¼r\x20'+_0x18731c+_0x5535d4(0x1a1)),_0x556cfb[_0x5535d4(0x192)](_0x5535d4(0x19b),{'val':'ok','ack':!![]}),activeTimer=setTimeout(()=>triggerPreWarn(_0x556cfb),timeoutMs);}function resetTimer(_0x1ea58b){const _0x3bb84b=a2_0x2bd0;if(activeTimer)clearTimeout(activeTimer);activeTimer=null,currentMonitoredRoom=null,alarmStage=0x0,_0x1ea58b[_0x3bb84b(0x192)](_0x3bb84b(0x19b),{'val':'ok','ack':!![]});}async function triggerPreWarn(_0x386a67){const _0x3a1821=a2_0x2bd0;alarmStage=0x1,await _0x386a67[_0x3a1821(0x192)](_0x3a1821(0x19b),{'val':'pre_warn','ack':!![]});const _0x5b4014=_0x3a1821(0x196)+currentMonitoredRoom+_0x3a1821(0x19f);_0x386a67[_0x3a1821(0x190)][_0x3a1821(0x193)](_0x3a1821(0x18c)+_0x5b4014),await setup[_0x3a1821(0x19e)](_0x386a67,_0x3a1821(0x1a0)+_0x5b4014),activeTimer=setTimeout(()=>triggerAlarm(_0x386a67),0x5*0x3c*0x3e8);}async function triggerAlarm(_0x162bfd){const _0x52f18a=a2_0x2bd0;alarmStage=0x2,await _0x162bfd['setStateAsync'](_0x52f18a(0x19b),{'val':_0x52f18a(0x199),'ack':!![]});const _0x527a2a=_0x52f18a(0x1aa)+currentMonitoredRoom+'!';_0x162bfd[_0x52f18a(0x190)][_0x52f18a(0x1a7)](_0x52f18a(0x18c)+_0x527a2a),await setup[_0x52f18a(0x19e)](_0x162bfd,_0x527a2a,![],!![]);}module['exports']={'updateLocation':updateLocation};