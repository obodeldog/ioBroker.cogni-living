const a2_0x26a40b=a2_0x5c20;(function(_0x5b97f7,_0x24576f){const _0x2fcc47=a2_0x5c20,_0x4dce7d=_0x5b97f7();while(!![]){try{const _0x587e60=parseInt(_0x2fcc47(0xd6))/0x1+-parseInt(_0x2fcc47(0xe7))/0x2+parseInt(_0x2fcc47(0xb7))/0x3+parseInt(_0x2fcc47(0xd5))/0x4+-parseInt(_0x2fcc47(0xbb))/0x5*(-parseInt(_0x2fcc47(0xdb))/0x6)+parseInt(_0x2fcc47(0xcb))/0x7+parseInt(_0x2fcc47(0xdd))/0x8*(-parseInt(_0x2fcc47(0xe9))/0x9);if(_0x587e60===_0x24576f)break;else _0x4dce7d['push'](_0x4dce7d['shift']());}catch(_0x571c9a){_0x4dce7d['push'](_0x4dce7d['shift']());}}}(a2_0x1f42,0x22585));const a2_0x199b15=(function(){let _0x45611b=!![];return function(_0x510151,_0x50909e){const _0x449baf=_0x45611b?function(){const _0x2fec54=a2_0x5c20;if(_0x50909e){const _0x4b0aac=_0x50909e[_0x2fec54(0xd4)](_0x510151,arguments);return _0x50909e=null,_0x4b0aac;}}:function(){};return _0x45611b=![],_0x449baf;};}()),a2_0x40d63c=a2_0x199b15(this,function(){const _0x3bafa2=a2_0x5c20;return a2_0x40d63c[_0x3bafa2(0xea)]()[_0x3bafa2(0xe1)]('(((.+)+)+)+$')[_0x3bafa2(0xea)]()[_0x3bafa2(0xc3)](a2_0x40d63c)[_0x3bafa2(0xe1)]('(((.+)+)+)+$');});a2_0x40d63c();'use strict';const setup=require(a2_0x26a40b(0xd8));let activeTimer=null,currentMonitoredRoom=null,timeoutMs=0x0,startTime=0x0,alarmStage=0x0;function a2_0x5c20(_0x4876fc,_0x456cdb){const _0x42676b=a2_0x1f42();return a2_0x5c20=function(_0x40d63c,_0x199b15){_0x40d63c=_0x40d63c-0xb7;let _0x1f42f4=_0x42676b[_0x40d63c];return _0x1f42f4;},a2_0x5c20(_0x4876fc,_0x456cdb);}const DEFAULT_TIMEOUTS={'bad':0x2d,'bath':0x2d,'toilet':0x1e,'wc':0x1e,'keller':0x3c,'schlaf':0x78,'bed':0x78,'guest':0x5a,'gast':0x5a};function getTimeoutRobust(_0x1a5cfc,_0x542a5a){const _0x60d2d5=a2_0x26a40b;if(!_0x1a5cfc||!_0x542a5a)return undefined;if(_0x1a5cfc[_0x542a5a])return _0x1a5cfc[_0x542a5a];const _0x5141a8=_0x542a5a['toLowerCase']()[_0x60d2d5(0xbe)](/[^a-z0-9]/g,'');for(const _0x102d9c in _0x1a5cfc){const _0x4be790=_0x102d9c[_0x60d2d5(0xeb)]()[_0x60d2d5(0xbe)](/[^a-z0-9]/g,'');if(_0x4be790===_0x5141a8)return _0x1a5cfc[_0x102d9c];}const _0x3257b0=_0x542a5a[_0x60d2d5(0xeb)]();if(_0x1a5cfc[_0x3257b0])return _0x1a5cfc[_0x3257b0];return undefined;}async function loadConfig(_0x23cd30){const _0x4671cf=a2_0x26a40b;try{const _0x3cb268=await _0x23cd30['getStateAsync'](_0x4671cf(0xef));if(_0x3cb268&&_0x3cb268[_0x4671cf(0xe8)])return JSON['parse'](_0x3cb268['val']);}catch(_0x26675b){}return{};}async function isActive(_0x40b236){const _0x9ac6d=a2_0x26a40b;try{const _0x59b927=await _0x40b236[_0x9ac6d(0xd9)]('analysis.safety.deadMan.active');return _0x59b927&&_0x59b927[_0x9ac6d(0xe8)];}catch(_0x40f291){return![];}}async function areRoomsConnected(_0x491194,_0x70dddd,_0x51eb6c){const _0x457e4d=a2_0x26a40b;try{const _0x20830a=await _0x491194[_0x457e4d(0xd9)]('analysis.topology.structure');if(!_0x20830a||!_0x20830a[_0x457e4d(0xe8)])return!![];const _0x4abb35=JSON[_0x457e4d(0xd3)](_0x20830a[_0x457e4d(0xe8)]),{rooms:_0x1549f1,matrix:_0x1380d1}=_0x4abb35;if(!_0x1549f1||!_0x1380d1)return!![];const _0x180b1a=_0x1549f1[_0x457e4d(0xbf)](_0x70dddd),_0x225fb2=_0x1549f1[_0x457e4d(0xbf)](_0x51eb6c);if(_0x180b1a===-0x1||_0x225fb2===-0x1)return!![];const _0x2b3af6=_0x1380d1[_0x180b1a][_0x225fb2]>0x0||_0x1380d1[_0x225fb2][_0x180b1a]>0x0;return _0x2b3af6;}catch(_0x4441c9){return _0x491194[_0x457e4d(0xc0)]['warn'](_0x457e4d(0xcf)+_0x4441c9[_0x457e4d(0xe4)]),!![];}}function calculateSleepProbability(_0x361a2c){const _0xd41ff4=a2_0x26a40b,_0x4a62da=new Date(),_0x6f8c23=_0x4a62da[_0xd41ff4(0xda)](),_0x13bd71=_0x361a2c[_0xd41ff4(0xeb)]();let _0x2d939d=0.1;if(_0x6f8c23>=0x17||_0x6f8c23<=0x6)_0x2d939d=0x1;else{if(_0x6f8c23>=0xd&&_0x6f8c23<=0xf)_0x2d939d=0.8;else{if(_0x6f8c23>=0x14&&_0x6f8c23<=0x17)_0x2d939d=0.4;}}let _0x4ef459=0.1;if(_0x13bd71['includes'](_0xd41ff4(0xed))||_0x13bd71['includes'](_0xd41ff4(0xbc)))_0x4ef459=0x1;else{if(_0x13bd71['includes'](_0xd41ff4(0xc6))||_0x13bd71[_0xd41ff4(0xe3)](_0xd41ff4(0xe5))||_0x13bd71[_0xd41ff4(0xe3)](_0xd41ff4(0xc8)))_0x4ef459=0.6;else{if(_0x13bd71['includes'](_0xd41ff4(0xb9))||_0x13bd71[_0xd41ff4(0xe3)]('wc'))_0x4ef459=0.05;}}let _0x250da0=0.5;const _0x3edbac=_0x4ef459*0.5+_0x2d939d*0.3+_0x250da0*0.2;return parseFloat(_0x3edbac[_0xd41ff4(0xee)](0x2));}function a2_0x1f42(){const _0x44c51c=['Ignoriere\x20Bewegung\x20in\x20\x27','Unknown','search','stringify','includes','message','living','ðŸ’¤\x20Smart\x20Sleep\x20erkannt\x20(','76782TwOrak','val','195174WDmqmU','toString','toLowerCase','[DeadMan]\x20','schlaf','toFixed','analysis.safety.deadMan.config','163584pBAIWj','\x20fÃ¼r\x20','bad','\x20um\x2090\x20Min.','99940ZYYmCm','bed','info','replace','indexOf','log','â³\x20ACHTUNG:\x20UngewÃ¶hnlich\x20lange\x20InaktivitÃ¤t\x20in\x20','analysis.safety.deadMan.napProbability','constructor','default','%).\x20VerlÃ¤ngere\x20Timer\x20fÃ¼r\x20','wohn','\x20Min.','sofa','pre_warn','sendNotification','1811719duajbv','setStateAsync','\x27.\x20Nicht\x20verbunden\x20mit\x20Ã¼berwachtem\x20\x27','ðŸ‘¼\x20Schutzengel-Frage:\x20','[DeadMan]\x20Topology\x20check\x20failed:\x20','\x20(Multi-Person\x20Filter)','analysis.safety.deadMan.smartSleep','alarm','parse','apply','911796HpSGVK','29820FpUjUC','now','./setup','getStateAsync','getHours','6xpdCao','error','152HMMQfr','analysis.safety.deadMan.alarmState'];a2_0x1f42=function(){return _0x44c51c;};return a2_0x1f42();}async function updateLocation(_0x1788e4,_0x287875){const _0x3844d7=a2_0x26a40b;if(!_0x287875||_0x287875===_0x3844d7(0xe0))return;if(!await isActive(_0x1788e4)){resetTimer(_0x1788e4);return;}if(currentMonitoredRoom&&currentMonitoredRoom!==_0x287875){const _0x59d2ec=await areRoomsConnected(_0x1788e4,currentMonitoredRoom,_0x287875);if(!_0x59d2ec){const _0x7396cd=_0x3844d7(0xdf)+_0x287875+_0x3844d7(0xcd)+currentMonitoredRoom+'\x27.';_0x1788e4[_0x3844d7(0xc0)]['info'](_0x3844d7(0xec)+_0x7396cd+_0x3844d7(0xd0)),await _0x1788e4[_0x3844d7(0xcc)]('analysis.safety.deadMan.lastIgnored',{'val':JSON[_0x3844d7(0xe2)]({'room':_0x287875,'reason':_0x7396cd,'timestamp':Date[_0x3844d7(0xd7)]()}),'ack':!![]});return;}resetTimer(_0x1788e4);}if(!currentMonitoredRoom){await _0x1788e4['setStateAsync']('analysis.safety.deadMan.currentRoom',{'val':_0x287875,'ack':!![]});const _0x40ee7d=await loadConfig(_0x1788e4);let _0x576f93=getTimeoutRobust(_0x40ee7d,_0x287875);const _0x16b930=_0x287875[_0x3844d7(0xeb)]();if(!_0x576f93)for(const _0x2d24a8 in DEFAULT_TIMEOUTS){if(_0x16b930[_0x3844d7(0xe3)](_0x2d24a8)){_0x576f93=DEFAULT_TIMEOUTS[_0x2d24a8];break;}}if(!_0x576f93&&_0x40ee7d['default'])_0x576f93=_0x40ee7d[_0x3844d7(0xc4)];if(!_0x576f93)return;currentMonitoredRoom=_0x287875,startTimer(_0x1788e4,_0x576f93,_0x287875);}}function startTimer(_0x135273,_0x38a318,_0x4477b8){const _0xcd481f=a2_0x26a40b;if(activeTimer)clearTimeout(activeTimer);timeoutMs=_0x38a318*0x3c*0x3e8,startTime=Date[_0xcd481f(0xd7)](),alarmStage=0x0;const _0x43cde7=calculateSleepProbability(_0x4477b8||currentMonitoredRoom),_0x2c423d=_0x43cde7>0.65;_0x2c423d?(timeoutMs+=0x5a*0x3c*0x3e8,_0x135273[_0xcd481f(0xc0)][_0xcd481f(0xbd)](_0xcd481f(0xe6)+(_0x43cde7*0x64)[_0xcd481f(0xee)](0x0)+_0xcd481f(0xc5)+currentMonitoredRoom+_0xcd481f(0xba)),_0x135273['setStateAsync'](_0xcd481f(0xd1),{'val':!![],'ack':!![]})):_0x135273[_0xcd481f(0xcc)](_0xcd481f(0xd1),{'val':![],'ack':!![]}),_0x135273[_0xcd481f(0xcc)](_0xcd481f(0xc2),{'val':_0x43cde7,'ack':!![]}),_0x135273['log'][_0xcd481f(0xbd)]('ðŸ‘¼\x20Schutzengel:\x20Ãœberwache\x20'+currentMonitoredRoom+_0xcd481f(0xb8)+_0x38a318+_0xcd481f(0xc7)),_0x135273[_0xcd481f(0xcc)](_0xcd481f(0xde),{'val':'ok','ack':!![]}),activeTimer=setTimeout(()=>triggerPreWarn(_0x135273),timeoutMs);}function resetTimer(_0x45c955){const _0x24facf=a2_0x26a40b;if(activeTimer)clearTimeout(activeTimer);activeTimer=null,currentMonitoredRoom=null,alarmStage=0x0,_0x45c955[_0x24facf(0xcc)]('analysis.safety.deadMan.alarmState',{'val':'ok','ack':!![]}),_0x45c955['setStateAsync'](_0x24facf(0xd1),{'val':![],'ack':!![]}),_0x45c955[_0x24facf(0xcc)](_0x24facf(0xc2),{'val':0x0,'ack':!![]});}async function triggerPreWarn(_0x3e8d77){const _0x4d3598=a2_0x26a40b;alarmStage=0x1,await _0x3e8d77[_0x4d3598(0xcc)](_0x4d3598(0xde),{'val':_0x4d3598(0xc9),'ack':!![]});const _0xcbe71d=_0x4d3598(0xc1)+currentMonitoredRoom+'.\x20Alles\x20in\x20Ordnung?';_0x3e8d77[_0x4d3598(0xc0)]['warn'](_0x4d3598(0xec)+_0xcbe71d),await setup['sendNotification'](_0x3e8d77,_0x4d3598(0xce)+_0xcbe71d),activeTimer=setTimeout(()=>triggerAlarm(_0x3e8d77),0x5*0x3c*0x3e8);}async function triggerAlarm(_0x5b8f13){const _0xfe9fde=a2_0x26a40b;alarmStage=0x2,await _0x5b8f13['setStateAsync'](_0xfe9fde(0xde),{'val':_0xfe9fde(0xd2),'ack':!![]});const _0x54162f='ðŸš¨\x20NOTFALL-ALARM:\x20Person\x20reagiert\x20nicht\x20in\x20'+currentMonitoredRoom+'!';_0x5b8f13['log'][_0xfe9fde(0xdc)](_0xfe9fde(0xec)+_0x54162f),await setup[_0xfe9fde(0xca)](_0x5b8f13,_0x54162f,![],!![]);}module['exports']={'updateLocation':updateLocation};