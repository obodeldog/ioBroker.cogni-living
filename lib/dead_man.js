(function(_0x1b6ae1,_0xcd79e){const _0x1802b2=a2_0x283e,_0x1221ba=_0x1b6ae1();while(!![]){try{const _0x4f66e3=-parseInt(_0x1802b2(0xcc))/0x1+-parseInt(_0x1802b2(0xce))/0x2+-parseInt(_0x1802b2(0xca))/0x3*(parseInt(_0x1802b2(0xbd))/0x4)+parseInt(_0x1802b2(0xc7))/0x5+-parseInt(_0x1802b2(0xbe))/0x6*(-parseInt(_0x1802b2(0xc2))/0x7)+-parseInt(_0x1802b2(0xcb))/0x8*(parseInt(_0x1802b2(0xc8))/0x9)+parseInt(_0x1802b2(0xd1))/0xa;if(_0x4f66e3===_0xcd79e)break;else _0x1221ba['push'](_0x1221ba['shift']());}catch(_0x23cfd0){_0x1221ba['push'](_0x1221ba['shift']());}}}(a2_0x5c8d,0x7ee91));const a2_0x1cd097=(function(){let _0x1391e6=!![];return function(_0x4aa659,_0x507a5f){const _0x501c0e=_0x1391e6?function(){if(_0x507a5f){const _0x5a106a=_0x507a5f['apply'](_0x4aa659,arguments);return _0x507a5f=null,_0x5a106a;}}:function(){};return _0x1391e6=![],_0x501c0e;};}()),a2_0xd7ca16=a2_0x1cd097(this,function(){const _0x2a3dd7=a2_0x283e;return a2_0xd7ca16[_0x2a3dd7(0xe3)]()['search'](_0x2a3dd7(0xd9))['toString']()[_0x2a3dd7(0xc6)](a2_0xd7ca16)['search']('(((.+)+)+)+$');});a2_0xd7ca16();'use strict';function a2_0x283e(_0x4e0a54,_0x198604){const _0x3bd3cb=a2_0x5c8d();return a2_0x283e=function(_0xd7ca16,_0x1cd097){_0xd7ca16=_0xd7ca16-0xbb;let _0x5c8d75=_0x3bd3cb[_0xd7ca16];return _0x5c8d75;},a2_0x283e(_0x4e0a54,_0x198604);}const setup=require('./setup');let activeTimer=null,currentMonitoredRoom=null,timeoutMs=0x0,startTime=0x0,alarmStage=0x0;const DEFAULT_TIMEOUTS={'bad':0x2d,'bath':0x2d,'toilet':0x1e,'wc':0x1e,'keller':0x3c};async function loadConfig(_0x4a0600){const _0x2f1824=a2_0x283e;try{const _0x19dfc9=await _0x4a0600[_0x2f1824(0xd2)](_0x2f1824(0xdb));if(_0x19dfc9&&_0x19dfc9[_0x2f1824(0xdd)])return JSON[_0x2f1824(0xc0)](_0x19dfc9[_0x2f1824(0xdd)]);}catch(_0x12a50c){}return{};}async function isActive(_0x3bdac3){const _0x47f7c8=a2_0x283e;try{const _0x477429=await _0x3bdac3[_0x47f7c8(0xd2)](_0x47f7c8(0xc9));return _0x477429&&_0x477429[_0x47f7c8(0xdd)];}catch(_0x3d3ab3){return![];}}async function areRoomsConnected(_0x7a422b,_0x468152,_0x179c32){const _0x29889c=a2_0x283e;try{const _0xec1f2=await _0x7a422b['getStateAsync'](_0x29889c(0xc5));if(!_0xec1f2||!_0xec1f2[_0x29889c(0xdd)])return!![];const _0x460819=JSON[_0x29889c(0xc0)](_0xec1f2[_0x29889c(0xdd)]),{rooms:_0x50fa7e,matrix:_0x47a042}=_0x460819;if(!_0x50fa7e||!_0x47a042)return!![];const _0x308fe8=_0x50fa7e[_0x29889c(0xd0)](_0x468152),_0x1189e8=_0x50fa7e[_0x29889c(0xd0)](_0x179c32);if(_0x308fe8===-0x1||_0x1189e8===-0x1)return!![];const _0x2e4c82=_0x47a042[_0x308fe8][_0x1189e8]>0x0||_0x47a042[_0x1189e8][_0x308fe8]>0x0;return _0x2e4c82;}catch(_0x349d04){return _0x7a422b['log'][_0x29889c(0xc1)]('[DeadMan]\x20Topology\x20check\x20failed:\x20'+_0x349d04[_0x29889c(0xe4)]),!![];}}async function updateLocation(_0x190e18,_0xb5d725){const _0x5b7c64=a2_0x283e;if(!_0xb5d725||_0xb5d725===_0x5b7c64(0xe5))return;if(!await isActive(_0x190e18)){resetTimer(_0x190e18);return;}if(currentMonitoredRoom&&currentMonitoredRoom!==_0xb5d725){const _0xde651d=await areRoomsConnected(_0x190e18,currentMonitoredRoom,_0xb5d725);if(!_0xde651d){_0x190e18['log'][_0x5b7c64(0xd7)](_0x5b7c64(0xd5)+_0xb5d725+_0x5b7c64(0xbf)+currentMonitoredRoom+_0x5b7c64(0xd4));return;}resetTimer(_0x190e18);}if(!currentMonitoredRoom){await _0x190e18[_0x5b7c64(0xdc)](_0x5b7c64(0xbc),{'val':_0xb5d725,'ack':!![]});const _0x4bef0a=await loadConfig(_0x190e18),_0x286cd0=_0xb5d725['toLowerCase']();let _0x522798=_0x4bef0a[_0xb5d725]||_0x4bef0a[_0x286cd0];if(!_0x522798)for(const _0x475e27 in DEFAULT_TIMEOUTS){if(_0x286cd0[_0x5b7c64(0xda)](_0x475e27)){_0x522798=DEFAULT_TIMEOUTS[_0x475e27];break;}}if(!_0x522798&&_0x4bef0a[_0x5b7c64(0xd6)])_0x522798=_0x4bef0a['default'];if(!_0x522798)return;currentMonitoredRoom=_0xb5d725,startTimer(_0x190e18,_0x522798);}}function a2_0x5c8d(){const _0x5c719f=['27XOFLjR','analysis.safety.deadMan.active','33BdZZwf','783736MIsuDN','438435EgvXMQ','ðŸ‘¼\x20Schutzengel-Frage:\x20','601434EqrbJp','â³\x20ACHTUNG:\x20UngewÃ¶hnlich\x20lange\x20InaktivitÃ¤t\x20in\x20','indexOf','11799120NFRBXO','getStateAsync','[DeadMan]\x20','\x27.\x20(Multi-Person\x20Filter)','[DeadMan]\x20Ignoriere\x20Bewegung\x20in\x20\x27','default','info','now','(((.+)+)+)+$','includes','analysis.safety.deadMan.config','setStateAsync','val','\x20Min.','\x20fÃ¼r\x20','log','.\x20Alles\x20in\x20Ordnung?','analysis.safety.deadMan.alarmState','toString','message','Unknown','sendNotification','error','analysis.safety.deadMan.currentRoom','213412WpHnSH','654FWzrto','\x27.\x20Nicht\x20verbunden\x20mit\x20Ã¼berwachtem\x20\x27','parse','warn','59017arGiDj','ðŸ‘¼\x20Schutzengel:\x20Ãœberwache\x20','alarm','analysis.topology.structure','constructor','204350oblDBj'];a2_0x5c8d=function(){return _0x5c719f;};return a2_0x5c8d();}function startTimer(_0x1d21fa,_0x3d617d){const _0x22b1eb=a2_0x283e;if(activeTimer)clearTimeout(activeTimer);timeoutMs=_0x3d617d*0x3c*0x3e8,startTime=Date[_0x22b1eb(0xd8)](),alarmStage=0x0,_0x1d21fa['log'][_0x22b1eb(0xd7)](_0x22b1eb(0xc3)+currentMonitoredRoom+_0x22b1eb(0xdf)+_0x3d617d+_0x22b1eb(0xde)),_0x1d21fa[_0x22b1eb(0xdc)]('analysis.safety.deadMan.alarmState',{'val':'ok','ack':!![]}),activeTimer=setTimeout(()=>triggerPreWarn(_0x1d21fa),timeoutMs);}function resetTimer(_0x33ed89){const _0x5e48c4=a2_0x283e;if(activeTimer)clearTimeout(activeTimer);activeTimer=null,currentMonitoredRoom=null,alarmStage=0x0,_0x33ed89[_0x5e48c4(0xdc)]('analysis.safety.deadMan.alarmState',{'val':'ok','ack':!![]});}async function triggerPreWarn(_0x48f26c){const _0x4a3f71=a2_0x283e;alarmStage=0x1,await _0x48f26c[_0x4a3f71(0xdc)](_0x4a3f71(0xe2),{'val':'pre_warn','ack':!![]});const _0x925c48=_0x4a3f71(0xcf)+currentMonitoredRoom+_0x4a3f71(0xe1);_0x48f26c[_0x4a3f71(0xe0)]['warn'](_0x4a3f71(0xd3)+_0x925c48),await setup[_0x4a3f71(0xe6)](_0x48f26c,_0x4a3f71(0xcd)+_0x925c48),activeTimer=setTimeout(()=>triggerAlarm(_0x48f26c),0x5*0x3c*0x3e8);}async function triggerAlarm(_0x1c473b){const _0x2a06be=a2_0x283e;alarmStage=0x2,await _0x1c473b[_0x2a06be(0xdc)]('analysis.safety.deadMan.alarmState',{'val':_0x2a06be(0xc4),'ack':!![]});const _0x5963d2='ðŸš¨\x20NOTFALL-ALARM:\x20Person\x20reagiert\x20nicht\x20in\x20'+currentMonitoredRoom+'!';_0x1c473b[_0x2a06be(0xe0)][_0x2a06be(0xbb)](_0x2a06be(0xd3)+_0x5963d2),await setup[_0x2a06be(0xe6)](_0x1c473b,_0x5963d2,![],!![]);}module['exports']={'updateLocation':updateLocation};