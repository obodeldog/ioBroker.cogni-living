const a2_0x5d47df=a2_0x8881;(function(_0x3d105e,_0x5e2ef9){const _0xab7b54=a2_0x8881,_0x15016a=_0x3d105e();while(!![]){try{const _0xc6d4e9=parseInt(_0xab7b54(0x1af))/0x1*(parseInt(_0xab7b54(0x1aa))/0x2)+-parseInt(_0xab7b54(0x1a0))/0x3+parseInt(_0xab7b54(0x1bd))/0x4*(parseInt(_0xab7b54(0x1a6))/0x5)+parseInt(_0xab7b54(0x197))/0x6*(-parseInt(_0xab7b54(0x1b3))/0x7)+parseInt(_0xab7b54(0x199))/0x8*(-parseInt(_0xab7b54(0x1c1))/0x9)+parseInt(_0xab7b54(0x1bb))/0xa*(-parseInt(_0xab7b54(0x1b4))/0xb)+parseInt(_0xab7b54(0x1a2))/0xc*(parseInt(_0xab7b54(0x1c7))/0xd);if(_0xc6d4e9===_0x5e2ef9)break;else _0x15016a['push'](_0x15016a['shift']());}catch(_0x54a500){_0x15016a['push'](_0x15016a['shift']());}}}(a2_0x8980,0x572a7));const a2_0x558c72=(function(){let _0x3a36bc=!![];return function(_0x360859,_0x2a6206){const _0x113eca=_0x3a36bc?function(){if(_0x2a6206){const _0x4011c4=_0x2a6206['apply'](_0x360859,arguments);return _0x2a6206=null,_0x4011c4;}}:function(){};return _0x3a36bc=![],_0x113eca;};}()),a2_0x2c41a7=a2_0x558c72(this,function(){const _0x2740ed=a2_0x8881;return a2_0x2c41a7[_0x2740ed(0x1b7)]()[_0x2740ed(0x1a5)](_0x2740ed(0x1b6))[_0x2740ed(0x1b7)]()[_0x2740ed(0x19b)](a2_0x2c41a7)[_0x2740ed(0x1a5)](_0x2740ed(0x1b6));});a2_0x2c41a7();'use strict';const setup=require(a2_0x5d47df(0x1b5));let activeTimer=null,currentMonitoredRoom=null,timeoutMs=0x0,startTime=0x0,alarmStage=0x0;const DEFAULT_TIMEOUTS={'bad':0x2d,'bath':0x2d,'toilet':0x1e,'wc':0x1e,'keller':0x3c,'schlaf':0x78,'bed':0x78,'guest':0x5a,'gast':0x5a};async function loadConfig(_0x6a2108){const _0x17c463=a2_0x5d47df;try{const _0x2d3cb4=await _0x6a2108['getStateAsync']('analysis.safety.deadMan.config');if(_0x2d3cb4&&_0x2d3cb4['val'])return JSON['parse'](_0x2d3cb4[_0x17c463(0x1a9)]);}catch(_0x1dab56){}return{};}async function isActive(_0x41373c){const _0x4d483a=a2_0x5d47df;try{const _0x68026b=await _0x41373c[_0x4d483a(0x19e)](_0x4d483a(0x1a8));return _0x68026b&&_0x68026b[_0x4d483a(0x1a9)];}catch(_0x5e69bc){return![];}}async function areRoomsConnected(_0x35d4e7,_0x12ae9a,_0x26e708){const _0xf1c8e1=a2_0x5d47df;try{const _0x2ccce8=await _0x35d4e7['getStateAsync']('analysis.topology.structure');if(!_0x2ccce8||!_0x2ccce8['val'])return!![];const _0x4ba552=JSON[_0xf1c8e1(0x19c)](_0x2ccce8[_0xf1c8e1(0x1a9)]),{rooms:_0x2c96b1,matrix:_0x32fe5b}=_0x4ba552;if(!_0x2c96b1||!_0x32fe5b)return!![];const _0xeef875=_0x2c96b1[_0xf1c8e1(0x19f)](_0x12ae9a),_0xc7835c=_0x2c96b1[_0xf1c8e1(0x19f)](_0x26e708);if(_0xeef875===-0x1||_0xc7835c===-0x1)return!![];const _0x3f4acd=_0x32fe5b[_0xeef875][_0xc7835c]>0x0||_0x32fe5b[_0xc7835c][_0xeef875]>0x0;return _0x3f4acd;}catch(_0x30a424){return _0x35d4e7[_0xf1c8e1(0x1c6)]['warn'](_0xf1c8e1(0x1ad)+_0x30a424['message']),!![];}}function calculateSleepProbability(_0x5995e0){const _0x20c236=a2_0x5d47df,_0x9a2e1b=new Date(),_0x48b43c=_0x9a2e1b[_0x20c236(0x1a1)](),_0x27f7dc=_0x5995e0[_0x20c236(0x191)]();let _0x43c4f9=0.1;if(_0x48b43c>=0x17||_0x48b43c<=0x6)_0x43c4f9=0x1;else{if(_0x48b43c>=0xd&&_0x48b43c<=0xf)_0x43c4f9=0.8;else{if(_0x48b43c>=0x14&&_0x48b43c<=0x17)_0x43c4f9=0.4;}}let _0x41b8b9=0.1;if(_0x27f7dc[_0x20c236(0x1be)](_0x20c236(0x1ab))||_0x27f7dc[_0x20c236(0x1be)](_0x20c236(0x193)))_0x41b8b9=0x1;else{if(_0x27f7dc[_0x20c236(0x1be)](_0x20c236(0x1c8))||_0x27f7dc[_0x20c236(0x1be)]('living')||_0x27f7dc[_0x20c236(0x1be)](_0x20c236(0x1b0)))_0x41b8b9=0.6;else{if(_0x27f7dc[_0x20c236(0x1be)](_0x20c236(0x1b1))||_0x27f7dc[_0x20c236(0x1be)]('wc'))_0x41b8b9=0.05;}}let _0x3c41ea=0.5;const _0x4fe72d=_0x41b8b9*0.5+_0x43c4f9*0.3+_0x3c41ea*0.2;return parseFloat(_0x4fe72d['toFixed'](0x2));}function a2_0x8980(){const _0x3257e7=['1IKaPPf','sofa','bad','toFixed','42JiEwSq','53493DSQALf','./setup','(((.+)+)+)+$','toString','alarm','ðŸ‘¼\x20Schutzengel-Frage:\x20','warn','1090tEjMzN','.\x20Alles\x20in\x20Ordnung?','1012XhiWLL','includes','now','exports','75618WVulXp','info','\x20(Multi-Person\x20Filter)','analysis.safety.deadMan.smartSleep','analysis.safety.deadMan.currentRoom','log','2619604ysMZol','wohn','ðŸš¨\x20NOTFALL-ALARM:\x20Person\x20reagiert\x20nicht\x20in\x20','toLowerCase','sendNotification','bed','[DeadMan]\x20','ðŸ‘¼\x20Schutzengel:\x20Ãœberwache\x20','stringify','587466ZRZDIz','setStateAsync','40HGRNfR','analysis.safety.deadMan.alarmState','constructor','parse','\x20um\x2090\x20Min.','getStateAsync','indexOf','278382BWnVsR','getHours','60oLZtBS','Ignoriere\x20Bewegung\x20in\x20\x27','error','search','1805tAwkFG','\x27.\x20Nicht\x20verbunden\x20mit\x20Ã¼berwachtem\x20\x27','analysis.safety.deadMan.active','val','1020990woyqDI','schlaf','\x20fÃ¼r\x20','[DeadMan]\x20Topology\x20check\x20failed:\x20','analysis.safety.deadMan.lastIgnored'];a2_0x8980=function(){return _0x3257e7;};return a2_0x8980();}async function updateLocation(_0x2e6689,_0x80954c){const _0x4658b3=a2_0x5d47df;if(!_0x80954c||_0x80954c==='Unknown')return;if(!await isActive(_0x2e6689)){resetTimer(_0x2e6689);return;}if(currentMonitoredRoom&&currentMonitoredRoom!==_0x80954c){const _0x3cb594=await areRoomsConnected(_0x2e6689,currentMonitoredRoom,_0x80954c);if(!_0x3cb594){const _0x21f7dd=_0x4658b3(0x1a3)+_0x80954c+_0x4658b3(0x1a7)+currentMonitoredRoom+'\x27.';_0x2e6689['log'][_0x4658b3(0x1c2)]('[DeadMan]\x20'+_0x21f7dd+_0x4658b3(0x1c3)),await _0x2e6689[_0x4658b3(0x198)](_0x4658b3(0x1ae),{'val':JSON[_0x4658b3(0x196)]({'room':_0x80954c,'reason':_0x21f7dd,'timestamp':Date[_0x4658b3(0x1bf)]()}),'ack':!![]});return;}resetTimer(_0x2e6689);}if(!currentMonitoredRoom){await _0x2e6689[_0x4658b3(0x198)](_0x4658b3(0x1c5),{'val':_0x80954c,'ack':!![]});const _0x4e6b43=await loadConfig(_0x2e6689),_0x4c42fb=_0x80954c[_0x4658b3(0x191)]();let _0x44fe67=_0x4e6b43[_0x80954c]||_0x4e6b43[_0x4c42fb];if(!_0x44fe67)for(const _0xdae271 in DEFAULT_TIMEOUTS){if(_0x4c42fb[_0x4658b3(0x1be)](_0xdae271)){_0x44fe67=DEFAULT_TIMEOUTS[_0xdae271];break;}}if(!_0x44fe67&&_0x4e6b43['default'])_0x44fe67=_0x4e6b43['default'];if(!_0x44fe67)return;currentMonitoredRoom=_0x80954c,startTimer(_0x2e6689,_0x44fe67,_0x80954c);}}function startTimer(_0x3b99cb,_0x4fef50,_0x16a846){const _0x22b53f=a2_0x5d47df;if(activeTimer)clearTimeout(activeTimer);timeoutMs=_0x4fef50*0x3c*0x3e8,startTime=Date[_0x22b53f(0x1bf)](),alarmStage=0x0;const _0xd44cc7=calculateSleepProbability(_0x16a846||currentMonitoredRoom),_0x37f9cc=_0xd44cc7>0.65;_0x37f9cc?(timeoutMs+=0x5a*0x3c*0x3e8,_0x3b99cb[_0x22b53f(0x1c6)][_0x22b53f(0x1c2)]('ðŸ’¤\x20Smart\x20Sleep\x20erkannt\x20('+(_0xd44cc7*0x64)[_0x22b53f(0x1b2)](0x0)+'%).\x20VerlÃ¤ngere\x20Timer\x20fÃ¼r\x20'+currentMonitoredRoom+_0x22b53f(0x19d)),_0x3b99cb[_0x22b53f(0x198)](_0x22b53f(0x1c4),{'val':!![],'ack':!![]})):_0x3b99cb[_0x22b53f(0x198)](_0x22b53f(0x1c4),{'val':![],'ack':!![]}),_0x3b99cb[_0x22b53f(0x198)]('analysis.safety.deadMan.napProbability',{'val':_0xd44cc7,'ack':!![]}),_0x3b99cb[_0x22b53f(0x1c6)][_0x22b53f(0x1c2)](_0x22b53f(0x195)+currentMonitoredRoom+_0x22b53f(0x1ac)+_0x4fef50+'\x20Min.'),_0x3b99cb[_0x22b53f(0x198)](_0x22b53f(0x19a),{'val':'ok','ack':!![]}),activeTimer=setTimeout(()=>triggerPreWarn(_0x3b99cb),timeoutMs);}function resetTimer(_0x1ac4ff){const _0x17b15d=a2_0x5d47df;if(activeTimer)clearTimeout(activeTimer);activeTimer=null,currentMonitoredRoom=null,alarmStage=0x0,_0x1ac4ff[_0x17b15d(0x198)](_0x17b15d(0x19a),{'val':'ok','ack':!![]}),_0x1ac4ff[_0x17b15d(0x198)](_0x17b15d(0x1c4),{'val':![],'ack':!![]}),_0x1ac4ff[_0x17b15d(0x198)]('analysis.safety.deadMan.napProbability',{'val':0x0,'ack':!![]});}async function triggerPreWarn(_0x4a3712){const _0x5dbf78=a2_0x5d47df;alarmStage=0x1,await _0x4a3712[_0x5dbf78(0x198)](_0x5dbf78(0x19a),{'val':'pre_warn','ack':!![]});const _0x45ad45='â³\x20ACHTUNG:\x20UngewÃ¶hnlich\x20lange\x20InaktivitÃ¤t\x20in\x20'+currentMonitoredRoom+_0x5dbf78(0x1bc);_0x4a3712[_0x5dbf78(0x1c6)][_0x5dbf78(0x1ba)](_0x5dbf78(0x194)+_0x45ad45),await setup[_0x5dbf78(0x192)](_0x4a3712,_0x5dbf78(0x1b9)+_0x45ad45),activeTimer=setTimeout(()=>triggerAlarm(_0x4a3712),0x5*0x3c*0x3e8);}function a2_0x8881(_0x335c47,_0x7a66bd){const _0x299bac=a2_0x8980();return a2_0x8881=function(_0x2c41a7,_0x558c72){_0x2c41a7=_0x2c41a7-0x190;let _0x8980cf=_0x299bac[_0x2c41a7];return _0x8980cf;},a2_0x8881(_0x335c47,_0x7a66bd);}async function triggerAlarm(_0x2efa20){const _0x2029c0=a2_0x5d47df;alarmStage=0x2,await _0x2efa20[_0x2029c0(0x198)](_0x2029c0(0x19a),{'val':_0x2029c0(0x1b8),'ack':!![]});const _0x209fa8=_0x2029c0(0x190)+currentMonitoredRoom+'!';_0x2efa20[_0x2029c0(0x1c6)][_0x2029c0(0x1a4)](_0x2029c0(0x194)+_0x209fa8),await setup[_0x2029c0(0x192)](_0x2efa20,_0x209fa8,![],!![]);}module[a2_0x5d47df(0x1c0)]={'updateLocation':updateLocation};