const a2_0x192605=a2_0x32f6;(function(_0x532086,_0x15e727){const _0x28f596=a2_0x32f6,_0x5cc705=_0x532086();while(!![]){try{const _0x4e6b1d=-parseInt(_0x28f596(0x1cb))/0x1+-parseInt(_0x28f596(0x1cd))/0x2*(-parseInt(_0x28f596(0x1c0))/0x3)+parseInt(_0x28f596(0x1d2))/0x4+parseInt(_0x28f596(0x1d8))/0x5*(parseInt(_0x28f596(0x1d4))/0x6)+-parseInt(_0x28f596(0x1ce))/0x7+-parseInt(_0x28f596(0x1c1))/0x8*(parseInt(_0x28f596(0x1c8))/0x9)+parseInt(_0x28f596(0x1c3))/0xa*(parseInt(_0x28f596(0x1db))/0xb);if(_0x4e6b1d===_0x15e727)break;else _0x5cc705['push'](_0x5cc705['shift']());}catch(_0x9e3b7d){_0x5cc705['push'](_0x5cc705['shift']());}}}(a2_0x3c4e,0x7b967));const a2_0x40f61b=(function(){let _0xc536de=!![];return function(_0x227eaa,_0x15c73b){const _0x4f237e=_0xc536de?function(){const _0x3b9187=a2_0x32f6;if(_0x15c73b){const _0x338ab9=_0x15c73b[_0x3b9187(0x1ed)](_0x227eaa,arguments);return _0x15c73b=null,_0x338ab9;}}:function(){};return _0xc536de=![],_0x4f237e;};}()),a2_0x335c7a=a2_0x40f61b(this,function(){const _0x4662c6=a2_0x32f6;return a2_0x335c7a[_0x4662c6(0x1c9)]()['search'](_0x4662c6(0x1e3))['toString']()[_0x4662c6(0x1d7)](a2_0x335c7a)[_0x4662c6(0x1d6)](_0x4662c6(0x1e3));});function a2_0x32f6(_0x2751d6,_0x1d0c13){const _0x3b8ad8=a2_0x3c4e();return a2_0x32f6=function(_0x335c7a,_0x40f61b){_0x335c7a=_0x335c7a-0x1c0;let _0x3c4e99=_0x3b8ad8[_0x335c7a];return _0x3c4e99;},a2_0x32f6(_0x2751d6,_0x1d0c13);}function a2_0x3c4e(){const _0x355637=['warn','setStateAsync','2033188vZxEff','log','215076PUCbAw','Unknown','search','constructor','15zpLQVd','â³\x20ACHTUNG:\x20UngewÃ¶hnlich\x20lange\x20InaktivitÃ¤t\x20in\x20','stringify','22583hAQXgX','toLowerCase','getStateAsync','default','analysis.safety.deadMan.alarmState','analysis.safety.deadMan.config','indexOf','parse','(((.+)+)+)+$','info','analysis.topology.structure','now','\x20Min.','ðŸ‘¼\x20Schutzengel-Frage:\x20','\x27.\x20Nicht\x20verbunden\x20mit\x20Ã¼berwachtem\x20\x27','val','analysis.safety.deadMan.active','includes','apply','130818nEcrYr','6269896thMHJm','analysis.safety.deadMan.currentRoom','3110xZIFHw','pre_warn','.\x20Alles\x20in\x20Ordnung?','Ignoriere\x20Bewegung\x20in\x20\x27','\x20(Multi-Person\x20Filter)','9UKegpy','toString','exports','266363EwYRuF','sendNotification','40gkseGP','3990861dsfezv','[DeadMan]\x20'];a2_0x3c4e=function(){return _0x355637;};return a2_0x3c4e();}a2_0x335c7a();'use strict';const setup=require('./setup');let activeTimer=null,currentMonitoredRoom=null,timeoutMs=0x0,startTime=0x0,alarmStage=0x0;const DEFAULT_TIMEOUTS={'bad':0x2d,'bath':0x2d,'toilet':0x1e,'wc':0x1e,'keller':0x3c};async function loadConfig(_0x25fc9a){const _0x409ba7=a2_0x32f6;try{const _0x33b399=await _0x25fc9a[_0x409ba7(0x1dd)](_0x409ba7(0x1e0));if(_0x33b399&&_0x33b399['val'])return JSON[_0x409ba7(0x1e2)](_0x33b399['val']);}catch(_0xc723bc){}return{};}async function isActive(_0x12301d){const _0x4bfe09=a2_0x32f6;try{const _0x20c431=await _0x12301d['getStateAsync'](_0x4bfe09(0x1eb));return _0x20c431&&_0x20c431[_0x4bfe09(0x1ea)];}catch(_0x1828ed){return![];}}async function areRoomsConnected(_0x27ad93,_0x5856e6,_0x336eec){const _0x359241=a2_0x32f6;try{const _0x8afb43=await _0x27ad93['getStateAsync'](_0x359241(0x1e5));if(!_0x8afb43||!_0x8afb43['val'])return!![];const _0x4bd3e0=JSON[_0x359241(0x1e2)](_0x8afb43[_0x359241(0x1ea)]),{rooms:_0x2e3e7a,matrix:_0x5c8d91}=_0x4bd3e0;if(!_0x2e3e7a||!_0x5c8d91)return!![];const _0x128222=_0x2e3e7a[_0x359241(0x1e1)](_0x5856e6),_0x1ee701=_0x2e3e7a[_0x359241(0x1e1)](_0x336eec);if(_0x128222===-0x1||_0x1ee701===-0x1)return!![];const _0x4da9c9=_0x5c8d91[_0x128222][_0x1ee701]>0x0||_0x5c8d91[_0x1ee701][_0x128222]>0x0;return _0x4da9c9;}catch(_0x18753a){return _0x27ad93[_0x359241(0x1d3)][_0x359241(0x1d0)]('[DeadMan]\x20Topology\x20check\x20failed:\x20'+_0x18753a['message']),!![];}}async function updateLocation(_0x39ce41,_0x447ad2){const _0x35fbf3=a2_0x32f6;if(!_0x447ad2||_0x447ad2===_0x35fbf3(0x1d5))return;if(!await isActive(_0x39ce41)){resetTimer(_0x39ce41);return;}if(currentMonitoredRoom&&currentMonitoredRoom!==_0x447ad2){const _0x1a1cd9=await areRoomsConnected(_0x39ce41,currentMonitoredRoom,_0x447ad2);if(!_0x1a1cd9){const _0x4d69d4=_0x35fbf3(0x1c6)+_0x447ad2+_0x35fbf3(0x1e9)+currentMonitoredRoom+'\x27.';_0x39ce41[_0x35fbf3(0x1d3)]['info'](_0x35fbf3(0x1cf)+_0x4d69d4+_0x35fbf3(0x1c7)),await _0x39ce41[_0x35fbf3(0x1d1)]('analysis.safety.deadMan.lastIgnored',{'val':JSON[_0x35fbf3(0x1da)]({'room':_0x447ad2,'reason':_0x4d69d4,'timestamp':Date[_0x35fbf3(0x1e6)]()}),'ack':!![]});return;}resetTimer(_0x39ce41);}if(!currentMonitoredRoom){await _0x39ce41[_0x35fbf3(0x1d1)](_0x35fbf3(0x1c2),{'val':_0x447ad2,'ack':!![]});const _0x497c7d=await loadConfig(_0x39ce41),_0x338b3e=_0x447ad2[_0x35fbf3(0x1dc)]();let _0xcabb39=_0x497c7d[_0x447ad2]||_0x497c7d[_0x338b3e];if(!_0xcabb39)for(const _0x34d886 in DEFAULT_TIMEOUTS){if(_0x338b3e[_0x35fbf3(0x1ec)](_0x34d886)){_0xcabb39=DEFAULT_TIMEOUTS[_0x34d886];break;}}if(!_0xcabb39&&_0x497c7d[_0x35fbf3(0x1de)])_0xcabb39=_0x497c7d[_0x35fbf3(0x1de)];if(!_0xcabb39)return;currentMonitoredRoom=_0x447ad2,startTimer(_0x39ce41,_0xcabb39);}}function startTimer(_0x546c56,_0x54ffe3){const _0x94c6de=a2_0x32f6;if(activeTimer)clearTimeout(activeTimer);timeoutMs=_0x54ffe3*0x3c*0x3e8,startTime=Date[_0x94c6de(0x1e6)](),alarmStage=0x0,_0x546c56[_0x94c6de(0x1d3)][_0x94c6de(0x1e4)]('ðŸ‘¼\x20Schutzengel:\x20Ãœberwache\x20'+currentMonitoredRoom+'\x20fÃ¼r\x20'+_0x54ffe3+_0x94c6de(0x1e7)),_0x546c56[_0x94c6de(0x1d1)](_0x94c6de(0x1df),{'val':'ok','ack':!![]}),activeTimer=setTimeout(()=>triggerPreWarn(_0x546c56),timeoutMs);}function resetTimer(_0x1b21c1){const _0x5d4554=a2_0x32f6;if(activeTimer)clearTimeout(activeTimer);activeTimer=null,currentMonitoredRoom=null,alarmStage=0x0,_0x1b21c1[_0x5d4554(0x1d1)](_0x5d4554(0x1df),{'val':'ok','ack':!![]});}async function triggerPreWarn(_0xf9869a){const _0x3db8f7=a2_0x32f6;alarmStage=0x1,await _0xf9869a[_0x3db8f7(0x1d1)](_0x3db8f7(0x1df),{'val':_0x3db8f7(0x1c4),'ack':!![]});const _0x5d4834=_0x3db8f7(0x1d9)+currentMonitoredRoom+_0x3db8f7(0x1c5);_0xf9869a[_0x3db8f7(0x1d3)][_0x3db8f7(0x1d0)](_0x3db8f7(0x1cf)+_0x5d4834),await setup['sendNotification'](_0xf9869a,_0x3db8f7(0x1e8)+_0x5d4834),activeTimer=setTimeout(()=>triggerAlarm(_0xf9869a),0x5*0x3c*0x3e8);}async function triggerAlarm(_0x57d027){const _0x26f4e6=a2_0x32f6;alarmStage=0x2,await _0x57d027[_0x26f4e6(0x1d1)](_0x26f4e6(0x1df),{'val':'alarm','ack':!![]});const _0x15ad0b='ðŸš¨\x20NOTFALL-ALARM:\x20Person\x20reagiert\x20nicht\x20in\x20'+currentMonitoredRoom+'!';_0x57d027[_0x26f4e6(0x1d3)]['error'](_0x26f4e6(0x1cf)+_0x15ad0b),await setup[_0x26f4e6(0x1cc)](_0x57d027,_0x15ad0b,![],!![]);}module[a2_0x192605(0x1ca)]={'updateLocation':updateLocation};