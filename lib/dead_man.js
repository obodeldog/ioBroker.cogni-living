const a2_0x31e585=a2_0x1058;(function(_0x2e7c65,_0x31b532){const _0x1888a5=a2_0x1058,_0x562757=_0x2e7c65();while(!![]){try{const _0x258a77=parseInt(_0x1888a5(0x14e))/0x1*(-parseInt(_0x1888a5(0x171))/0x2)+-parseInt(_0x1888a5(0x14b))/0x3*(-parseInt(_0x1888a5(0x154))/0x4)+parseInt(_0x1888a5(0x15a))/0x5+-parseInt(_0x1888a5(0x151))/0x6+parseInt(_0x1888a5(0x178))/0x7+parseInt(_0x1888a5(0x16b))/0x8*(parseInt(_0x1888a5(0x170))/0x9)+parseInt(_0x1888a5(0x158))/0xa;if(_0x258a77===_0x31b532)break;else _0x562757['push'](_0x562757['shift']());}catch(_0xbfd5f3){_0x562757['push'](_0x562757['shift']());}}}(a2_0x45c4,0xda368));const a2_0x3ae828=(function(){let _0x756f57=!![];return function(_0x5da988,_0x560967){const _0x3dd755=_0x756f57?function(){if(_0x560967){const _0x2782bd=_0x560967['apply'](_0x5da988,arguments);return _0x560967=null,_0x2782bd;}}:function(){};return _0x756f57=![],_0x3dd755;};}()),a2_0x1e43a6=a2_0x3ae828(this,function(){const _0x33395c=a2_0x1058;return a2_0x1e43a6[_0x33395c(0x176)]()['search'](_0x33395c(0x162))[_0x33395c(0x176)]()[_0x33395c(0x15e)](a2_0x1e43a6)[_0x33395c(0x15c)]('(((.+)+)+)+$');});a2_0x1e43a6();'use strict';function a2_0x1058(_0x50215d,_0x3e6959){const _0x131c9d=a2_0x45c4();return a2_0x1058=function(_0x1e43a6,_0x3ae828){_0x1e43a6=_0x1e43a6-0x148;let _0x45c466=_0x131c9d[_0x1e43a6];return _0x45c466;},a2_0x1058(_0x50215d,_0x3e6959);}const setup=require('./setup');let activeTimer=null,currentMonitoredRoom=null,timeoutMs=0x0,startTime=0x0,alarmStage=0x0;function a2_0x45c4(){const _0x5d7f58=['Unknown','default','\x20fÃ¼r\x20','(((.+)+)+)+$','alarm','indexOf','exports','parse','analysis.safety.deadMan.active','log','[DeadMan]\x20','.\x20Alles\x20in\x20Ordnung?','176048kwiteb','analysis.safety.deadMan.currentRoom','getStateAsync','pre_warn','analysis.safety.deadMan.alarmState','315NbsBac','149366EEYCVw','analysis.safety.deadMan.lastIgnored','\x20Min.','includes','sendNotification','toString','analysis.topology.structure','8067724PePVHj','info','[DeadMan]\x20Topology\x20check\x20failed:\x20','message','10257hHvQeF','ðŸ‘¼\x20Schutzengel:\x20Ãœberwache\x20','error','18xQAwFX','Ignoriere\x20Bewegung\x20in\x20\x27','ðŸš¨\x20NOTFALL-ALARM:\x20Person\x20reagiert\x20nicht\x20in\x20','8964972JlpHcn','setStateAsync','val','84OrJlAa','toLowerCase','analysis.safety.deadMan.config','\x20(Multi-Person\x20Filter)','3530320szMHkp','â³\x20ACHTUNG:\x20UngewÃ¶hnlich\x20lange\x20InaktivitÃ¤t\x20in\x20','6923415BqicEa','stringify','search','warn','constructor'];a2_0x45c4=function(){return _0x5d7f58;};return a2_0x45c4();}const DEFAULT_TIMEOUTS={'bad':0x2d,'bath':0x2d,'toilet':0x1e,'wc':0x1e,'keller':0x3c};async function loadConfig(_0x579a5a){const _0x46f5ad=a2_0x1058;try{const _0x4a4c71=await _0x579a5a[_0x46f5ad(0x16d)](_0x46f5ad(0x156));if(_0x4a4c71&&_0x4a4c71[_0x46f5ad(0x153)])return JSON[_0x46f5ad(0x166)](_0x4a4c71[_0x46f5ad(0x153)]);}catch(_0x3b614c){}return{};}async function isActive(_0x433f4e){const _0x14a1e9=a2_0x1058;try{const _0x143486=await _0x433f4e[_0x14a1e9(0x16d)](_0x14a1e9(0x167));return _0x143486&&_0x143486[_0x14a1e9(0x153)];}catch(_0x549490){return![];}}async function areRoomsConnected(_0x1b7719,_0x546f79,_0x4e3a02){const _0x4fae15=a2_0x1058;try{const _0x42b29b=await _0x1b7719[_0x4fae15(0x16d)](_0x4fae15(0x177));if(!_0x42b29b||!_0x42b29b['val'])return!![];const _0x17801c=JSON[_0x4fae15(0x166)](_0x42b29b['val']),{rooms:_0x3d0f85,matrix:_0x1a39d5}=_0x17801c;if(!_0x3d0f85||!_0x1a39d5)return!![];const _0x352468=_0x3d0f85[_0x4fae15(0x164)](_0x546f79),_0x2b6b96=_0x3d0f85[_0x4fae15(0x164)](_0x4e3a02);if(_0x352468===-0x1||_0x2b6b96===-0x1)return!![];const _0x458c8c=_0x1a39d5[_0x352468][_0x2b6b96]>0x0||_0x1a39d5[_0x2b6b96][_0x352468]>0x0;return _0x458c8c;}catch(_0x48eefd){return _0x1b7719[_0x4fae15(0x168)][_0x4fae15(0x15d)](_0x4fae15(0x149)+_0x48eefd[_0x4fae15(0x14a)]),!![];}}async function updateLocation(_0x47fc3a,_0x2e1ddc){const _0xbe2de4=a2_0x1058;if(!_0x2e1ddc||_0x2e1ddc===_0xbe2de4(0x15f))return;if(!await isActive(_0x47fc3a)){resetTimer(_0x47fc3a);return;}if(currentMonitoredRoom&&currentMonitoredRoom!==_0x2e1ddc){const _0xfda5ca=await areRoomsConnected(_0x47fc3a,currentMonitoredRoom,_0x2e1ddc);if(!_0xfda5ca){const _0x37eac8=_0xbe2de4(0x14f)+_0x2e1ddc+'\x27.\x20Nicht\x20verbunden\x20mit\x20Ã¼berwachtem\x20\x27'+currentMonitoredRoom+'\x27.';_0x47fc3a[_0xbe2de4(0x168)][_0xbe2de4(0x148)]('[DeadMan]\x20'+_0x37eac8+_0xbe2de4(0x157)),await _0x47fc3a['setStateAsync'](_0xbe2de4(0x172),{'val':JSON[_0xbe2de4(0x15b)]({'room':_0x2e1ddc,'reason':_0x37eac8,'timestamp':Date['now']()}),'ack':!![]});return;}resetTimer(_0x47fc3a);}if(!currentMonitoredRoom){await _0x47fc3a[_0xbe2de4(0x152)](_0xbe2de4(0x16c),{'val':_0x2e1ddc,'ack':!![]});const _0x42656a=await loadConfig(_0x47fc3a),_0x30b078=_0x2e1ddc[_0xbe2de4(0x155)]();let _0x3cb660=_0x42656a[_0x2e1ddc]||_0x42656a[_0x30b078];if(!_0x3cb660)for(const _0x9e45ae in DEFAULT_TIMEOUTS){if(_0x30b078[_0xbe2de4(0x174)](_0x9e45ae)){_0x3cb660=DEFAULT_TIMEOUTS[_0x9e45ae];break;}}if(!_0x3cb660&&_0x42656a[_0xbe2de4(0x160)])_0x3cb660=_0x42656a[_0xbe2de4(0x160)];if(!_0x3cb660)return;currentMonitoredRoom=_0x2e1ddc,startTimer(_0x47fc3a,_0x3cb660);}}function startTimer(_0x3eccca,_0x2fc3b3){const _0xac63a7=a2_0x1058;if(activeTimer)clearTimeout(activeTimer);timeoutMs=_0x2fc3b3*0x3c*0x3e8,startTime=Date['now'](),alarmStage=0x0,_0x3eccca[_0xac63a7(0x168)][_0xac63a7(0x148)](_0xac63a7(0x14c)+currentMonitoredRoom+_0xac63a7(0x161)+_0x2fc3b3+_0xac63a7(0x173)),_0x3eccca[_0xac63a7(0x152)]('analysis.safety.deadMan.alarmState',{'val':'ok','ack':!![]}),activeTimer=setTimeout(()=>triggerPreWarn(_0x3eccca),timeoutMs);}function resetTimer(_0x428614){const _0x1933a2=a2_0x1058;if(activeTimer)clearTimeout(activeTimer);activeTimer=null,currentMonitoredRoom=null,alarmStage=0x0,_0x428614[_0x1933a2(0x152)](_0x1933a2(0x16f),{'val':'ok','ack':!![]});}async function triggerPreWarn(_0x15d9f7){const _0x347bba=a2_0x1058;alarmStage=0x1,await _0x15d9f7[_0x347bba(0x152)](_0x347bba(0x16f),{'val':_0x347bba(0x16e),'ack':!![]});const _0x1cf685=_0x347bba(0x159)+currentMonitoredRoom+_0x347bba(0x16a);_0x15d9f7[_0x347bba(0x168)][_0x347bba(0x15d)](_0x347bba(0x169)+_0x1cf685),await setup[_0x347bba(0x175)](_0x15d9f7,'ðŸ‘¼\x20Schutzengel-Frage:\x20'+_0x1cf685),activeTimer=setTimeout(()=>triggerAlarm(_0x15d9f7),0x5*0x3c*0x3e8);}async function triggerAlarm(_0x3c1ea6){const _0x2ba9cf=a2_0x1058;alarmStage=0x2,await _0x3c1ea6[_0x2ba9cf(0x152)](_0x2ba9cf(0x16f),{'val':_0x2ba9cf(0x163),'ack':!![]});const _0x440e1e=_0x2ba9cf(0x150)+currentMonitoredRoom+'!';_0x3c1ea6['log'][_0x2ba9cf(0x14d)]('[DeadMan]\x20'+_0x440e1e),await setup[_0x2ba9cf(0x175)](_0x3c1ea6,_0x440e1e,![],!![]);}module[a2_0x31e585(0x165)]={'updateLocation':updateLocation};