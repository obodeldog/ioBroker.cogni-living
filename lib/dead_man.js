const a2_0x17bc7a=a2_0x3328;(function(_0x346ebd,_0x2be971){const _0x454df9=a2_0x3328,_0x34b5a1=_0x346ebd();while(!![]){try{const _0x3a20f5=-parseInt(_0x454df9(0xf3))/0x1*(-parseInt(_0x454df9(0xd7))/0x2)+-parseInt(_0x454df9(0xda))/0x3+parseInt(_0x454df9(0xdb))/0x4*(parseInt(_0x454df9(0xc9))/0x5)+parseInt(_0x454df9(0xd8))/0x6*(parseInt(_0x454df9(0xe9))/0x7)+-parseInt(_0x454df9(0xd6))/0x8+-parseInt(_0x454df9(0xcf))/0x9*(parseInt(_0x454df9(0xde))/0xa)+parseInt(_0x454df9(0xc3))/0xb*(parseInt(_0x454df9(0xea))/0xc);if(_0x3a20f5===_0x2be971)break;else _0x34b5a1['push'](_0x34b5a1['shift']());}catch(_0x5488ca){_0x34b5a1['push'](_0x34b5a1['shift']());}}}(a2_0x27b9,0x1dad8));const a2_0x28b582=(function(){let _0x34e303=!![];return function(_0x30f22b,_0x152942){const _0x1bd28f=_0x34e303?function(){const _0x788329=a2_0x3328;if(_0x152942){const _0x4a5c99=_0x152942[_0x788329(0xe0)](_0x30f22b,arguments);return _0x152942=null,_0x4a5c99;}}:function(){};return _0x34e303=![],_0x1bd28f;};}()),a2_0x2b7d0b=a2_0x28b582(this,function(){const _0x54921c=a2_0x3328;return a2_0x2b7d0b[_0x54921c(0xd5)]()['search'](_0x54921c(0xc4))[_0x54921c(0xd5)]()[_0x54921c(0xbd)](a2_0x2b7d0b)[_0x54921c(0xc2)](_0x54921c(0xc4));});a2_0x2b7d0b();'use strict';const setup=require(a2_0x17bc7a(0xee));let activeTimer=null,currentMonitoredRoom=null,timeoutMs=0x0,startTime=0x0,alarmStage=0x0;const DEFAULT_TIMEOUTS={'bad':0x2d,'bath':0x2d,'toilet':0x1e,'wc':0x1e,'keller':0x3c,'schlaf':0x78,'bed':0x78,'guest':0x5a,'gast':0x5a};function a2_0x27b9(){const _0x1f2448=['bed','\x20Min.','1513393BqZqsu','1020UcigyS','toFixed','[DeadMan]\x20Topology\x20check\x20failed:\x20','\x20um\x2090\x20Min.','./setup','\x20(Multi-Person\x20Filter)','bad','ðŸš¨\x20NOTFALL-ALARM:\x20Person\x20reagiert\x20nicht\x20in\x20','analysis.topology.structure','93810LqBdgm','stringify','ðŸ‘¼\x20Schutzengel-Frage:\x20','val','constructor','Unknown','analysis.safety.deadMan.lastIgnored','analysis.safety.deadMan.alarmState','default','search','26323FboIUw','(((.+)+)+)+$','sofa','alarm','sendNotification','parse','41075acCjWP','now','analysis.safety.deadMan.smartSleep','includes','analysis.safety.deadMan.napProbability','error','9JPrDRl','[DeadMan]\x20','setStateAsync','log','warn','â³\x20ACHTUNG:\x20UngewÃ¶hnlich\x20lange\x20InaktivitÃ¤t\x20in\x20','toString','1796632TRFpNF','2mjphLa','6JDHgXS','schlaf','94143RcBJFY','52DGHZpi','info','getStateAsync','2426890gDpEek','Ignoriere\x20Bewegung\x20in\x20\x27','apply','getHours','indexOf','analysis.safety.deadMan.currentRoom','toLowerCase','%).\x20VerlÃ¤ngere\x20Timer\x20fÃ¼r\x20','ðŸ‘¼\x20Schutzengel:\x20Ãœberwache\x20'];a2_0x27b9=function(){return _0x1f2448;};return a2_0x27b9();}function a2_0x3328(_0x49a851,_0x294b93){const _0x1c5c6b=a2_0x27b9();return a2_0x3328=function(_0x2b7d0b,_0x28b582){_0x2b7d0b=_0x2b7d0b-0xba;let _0x27b96f=_0x1c5c6b[_0x2b7d0b];return _0x27b96f;},a2_0x3328(_0x49a851,_0x294b93);}async function loadConfig(_0x3f1905){const _0x13a27b=a2_0x17bc7a;try{const _0x551844=await _0x3f1905['getStateAsync']('analysis.safety.deadMan.config');if(_0x551844&&_0x551844[_0x13a27b(0xbc)])return JSON[_0x13a27b(0xc8)](_0x551844['val']);}catch(_0x16f3ee){}return{};}async function isActive(_0x4d65bd){const _0x1ea14c=a2_0x17bc7a;try{const _0x419bd1=await _0x4d65bd[_0x1ea14c(0xdd)]('analysis.safety.deadMan.active');return _0x419bd1&&_0x419bd1[_0x1ea14c(0xbc)];}catch(_0x185e8c){return![];}}async function areRoomsConnected(_0x4b6279,_0x39bb85,_0x581e06){const _0x5a3169=a2_0x17bc7a;try{const _0x137197=await _0x4b6279[_0x5a3169(0xdd)](_0x5a3169(0xf2));if(!_0x137197||!_0x137197['val'])return!![];const _0xe0ff3f=JSON['parse'](_0x137197['val']),{rooms:_0x33b910,matrix:_0x9f19e5}=_0xe0ff3f;if(!_0x33b910||!_0x9f19e5)return!![];const _0x1a00f3=_0x33b910['indexOf'](_0x39bb85),_0x117b3a=_0x33b910[_0x5a3169(0xe2)](_0x581e06);if(_0x1a00f3===-0x1||_0x117b3a===-0x1)return!![];const _0x2e006c=_0x9f19e5[_0x1a00f3][_0x117b3a]>0x0||_0x9f19e5[_0x117b3a][_0x1a00f3]>0x0;return _0x2e006c;}catch(_0x739805){return _0x4b6279['log'][_0x5a3169(0xd3)](_0x5a3169(0xec)+_0x739805['message']),!![];}}function calculateSleepProbability(_0x172d1d){const _0x3c0cfd=a2_0x17bc7a,_0x14c374=new Date(),_0x1ac012=_0x14c374[_0x3c0cfd(0xe1)](),_0x53497e=_0x172d1d[_0x3c0cfd(0xe4)]();let _0x481b08=0.1;if(_0x1ac012>=0x17||_0x1ac012<=0x6)_0x481b08=0x1;else{if(_0x1ac012>=0xd&&_0x1ac012<=0xf)_0x481b08=0.8;else{if(_0x1ac012>=0x14&&_0x1ac012<=0x17)_0x481b08=0.4;}}let _0xc6f5c5=0.1;if(_0x53497e['includes'](_0x3c0cfd(0xd9))||_0x53497e[_0x3c0cfd(0xcc)](_0x3c0cfd(0xe7)))_0xc6f5c5=0x1;else{if(_0x53497e['includes']('wohn')||_0x53497e[_0x3c0cfd(0xcc)]('living')||_0x53497e[_0x3c0cfd(0xcc)](_0x3c0cfd(0xc5)))_0xc6f5c5=0.6;else{if(_0x53497e['includes'](_0x3c0cfd(0xf0))||_0x53497e[_0x3c0cfd(0xcc)]('wc'))_0xc6f5c5=0.05;}}let _0xc83b25=0.5;const _0x5b437c=_0xc6f5c5*0.5+_0x481b08*0.3+_0xc83b25*0.2;return parseFloat(_0x5b437c[_0x3c0cfd(0xeb)](0x2));}async function updateLocation(_0x3cb14b,_0xba141d){const _0x2f7a23=a2_0x17bc7a;if(!_0xba141d||_0xba141d===_0x2f7a23(0xbe))return;if(!await isActive(_0x3cb14b)){resetTimer(_0x3cb14b);return;}if(currentMonitoredRoom&&currentMonitoredRoom!==_0xba141d){const _0x4d6af6=await areRoomsConnected(_0x3cb14b,currentMonitoredRoom,_0xba141d);if(!_0x4d6af6){const _0x2a2898=_0x2f7a23(0xdf)+_0xba141d+'\x27.\x20Nicht\x20verbunden\x20mit\x20Ã¼berwachtem\x20\x27'+currentMonitoredRoom+'\x27.';_0x3cb14b[_0x2f7a23(0xd2)]['info'](_0x2f7a23(0xd0)+_0x2a2898+_0x2f7a23(0xef)),await _0x3cb14b[_0x2f7a23(0xd1)](_0x2f7a23(0xbf),{'val':JSON[_0x2f7a23(0xba)]({'room':_0xba141d,'reason':_0x2a2898,'timestamp':Date[_0x2f7a23(0xca)]()}),'ack':!![]});return;}resetTimer(_0x3cb14b);}if(!currentMonitoredRoom){await _0x3cb14b[_0x2f7a23(0xd1)](_0x2f7a23(0xe3),{'val':_0xba141d,'ack':!![]});const _0x50c41a=await loadConfig(_0x3cb14b),_0x34ec14=_0xba141d[_0x2f7a23(0xe4)]();let _0x56fe22=_0x50c41a[_0xba141d]||_0x50c41a[_0x34ec14];if(!_0x56fe22)for(const _0x1688ef in DEFAULT_TIMEOUTS){if(_0x34ec14[_0x2f7a23(0xcc)](_0x1688ef)){_0x56fe22=DEFAULT_TIMEOUTS[_0x1688ef];break;}}if(!_0x56fe22&&_0x50c41a[_0x2f7a23(0xc1)])_0x56fe22=_0x50c41a['default'];if(!_0x56fe22)return;currentMonitoredRoom=_0xba141d,startTimer(_0x3cb14b,_0x56fe22,_0xba141d);}}function startTimer(_0x46e804,_0x5158c1,_0x46ec8c){const _0x4441a1=a2_0x17bc7a;if(activeTimer)clearTimeout(activeTimer);timeoutMs=_0x5158c1*0x3c*0x3e8,startTime=Date[_0x4441a1(0xca)](),alarmStage=0x0;const _0x3bcc35=calculateSleepProbability(_0x46ec8c||currentMonitoredRoom),_0x5832e8=_0x3bcc35>0.65;_0x5832e8?(timeoutMs+=0x5a*0x3c*0x3e8,_0x46e804['log'][_0x4441a1(0xdc)]('ðŸ’¤\x20Smart\x20Sleep\x20erkannt\x20('+(_0x3bcc35*0x64)['toFixed'](0x0)+_0x4441a1(0xe5)+currentMonitoredRoom+_0x4441a1(0xed)),_0x46e804['setStateAsync'](_0x4441a1(0xcb),{'val':!![],'ack':!![]})):_0x46e804[_0x4441a1(0xd1)](_0x4441a1(0xcb),{'val':![],'ack':!![]}),_0x46e804['setStateAsync']('analysis.safety.deadMan.napProbability',{'val':_0x3bcc35,'ack':!![]}),_0x46e804[_0x4441a1(0xd2)][_0x4441a1(0xdc)](_0x4441a1(0xe6)+currentMonitoredRoom+'\x20fÃ¼r\x20'+_0x5158c1+_0x4441a1(0xe8)),_0x46e804[_0x4441a1(0xd1)](_0x4441a1(0xc0),{'val':'ok','ack':!![]}),activeTimer=setTimeout(()=>triggerPreWarn(_0x46e804),timeoutMs);}function resetTimer(_0x556d10){const _0x354948=a2_0x17bc7a;if(activeTimer)clearTimeout(activeTimer);activeTimer=null,currentMonitoredRoom=null,alarmStage=0x0,_0x556d10[_0x354948(0xd1)]('analysis.safety.deadMan.alarmState',{'val':'ok','ack':!![]}),_0x556d10[_0x354948(0xd1)](_0x354948(0xcb),{'val':![],'ack':!![]}),_0x556d10['setStateAsync'](_0x354948(0xcd),{'val':0x0,'ack':!![]});}async function triggerPreWarn(_0x94ba12){const _0x2d7e00=a2_0x17bc7a;alarmStage=0x1,await _0x94ba12[_0x2d7e00(0xd1)](_0x2d7e00(0xc0),{'val':'pre_warn','ack':!![]});const _0x413acb=_0x2d7e00(0xd4)+currentMonitoredRoom+'.\x20Alles\x20in\x20Ordnung?';_0x94ba12[_0x2d7e00(0xd2)][_0x2d7e00(0xd3)](_0x2d7e00(0xd0)+_0x413acb),await setup[_0x2d7e00(0xc7)](_0x94ba12,_0x2d7e00(0xbb)+_0x413acb),activeTimer=setTimeout(()=>triggerAlarm(_0x94ba12),0x5*0x3c*0x3e8);}async function triggerAlarm(_0x2e0427){const _0x4320bd=a2_0x17bc7a;alarmStage=0x2,await _0x2e0427[_0x4320bd(0xd1)]('analysis.safety.deadMan.alarmState',{'val':_0x4320bd(0xc6),'ack':!![]});const _0x56e16a=_0x4320bd(0xf1)+currentMonitoredRoom+'!';_0x2e0427[_0x4320bd(0xd2)][_0x4320bd(0xce)](_0x4320bd(0xd0)+_0x56e16a),await setup['sendNotification'](_0x2e0427,_0x56e16a,![],!![]);}module['exports']={'updateLocation':updateLocation};