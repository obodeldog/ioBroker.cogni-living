const a2_0x278b7a=a2_0x56da;(function(_0xdce021,_0xe126fa){const _0x5a4efe=a2_0x56da,_0x571514=_0xdce021();while(!![]){try{const _0x179ae2=parseInt(_0x5a4efe(0x1c6))/0x1+-parseInt(_0x5a4efe(0x1cd))/0x2*(parseInt(_0x5a4efe(0x1dc))/0x3)+parseInt(_0x5a4efe(0x1b8))/0x4+-parseInt(_0x5a4efe(0x1b1))/0x5+parseInt(_0x5a4efe(0x1c9))/0x6+-parseInt(_0x5a4efe(0x1e4))/0x7*(-parseInt(_0x5a4efe(0x1ca))/0x8)+parseInt(_0x5a4efe(0x1c4))/0x9*(-parseInt(_0x5a4efe(0x1d1))/0xa);if(_0x179ae2===_0xe126fa)break;else _0x571514['push'](_0x571514['shift']());}catch(_0xba28ee){_0x571514['push'](_0x571514['shift']());}}}(a2_0x4f5d,0x8f27f));const a2_0x3d5e7e=(function(){let _0x1719f1=!![];return function(_0x5839f4,_0x2fbf9c){const _0x203f03=_0x1719f1?function(){if(_0x2fbf9c){const _0xdc027a=_0x2fbf9c['apply'](_0x5839f4,arguments);return _0x2fbf9c=null,_0xdc027a;}}:function(){};return _0x1719f1=![],_0x203f03;};}()),a2_0x41c129=a2_0x3d5e7e(this,function(){const _0x2612e4=a2_0x56da;return a2_0x41c129['toString']()[_0x2612e4(0x1d7)](_0x2612e4(0x1b0))[_0x2612e4(0x1b3)]()[_0x2612e4(0x1e2)](a2_0x41c129)[_0x2612e4(0x1d7)](_0x2612e4(0x1b0));});a2_0x41c129();'use strict';const setup=require('./setup');function a2_0x4f5d(){const _0x343c8a=['\x27.\x20Nicht\x20verbunden\x20mit\x20Ã¼berwachtem\x20\x27','message','[DeadMan]\x20Topology\x20check\x20failed:\x20','\x20Min.','warn','analysis.safety.deadMan.lastIgnored','ðŸ‘¼\x20Schutzengel-Frage:\x20','Ignoriere\x20Bewegung\x20in\x20\x27','\x20fÃ¼r\x20','log','441iyTEKe','parse','941111SaxFMQ','ðŸ’¤\x20Smart\x20Sleep\x20erkannt\x20(','info','2013060DCJOOG','210296mwNrns','error','getStateAsync','8OucUKF','stringify','default','getHours','120zLfanI','â³\x20ACHTUNG:\x20UngewÃ¶hnlich\x20lange\x20InaktivitÃ¤t\x20in\x20','Unknown','analysis.safety.deadMan.napProbability','analysis.safety.deadMan.currentRoom','toLowerCase','search','exports','analysis.safety.deadMan.config','pre_warn','ðŸ‘¼\x20Schutzengel:\x20Ãœberwache\x20','582237nZPuhh','\x20um\x2090\x20Min.','.\x20Alles\x20in\x20Ordnung?','bed','setStateAsync','toFixed','constructor','%).\x20VerlÃ¤ngere\x20Timer\x20fÃ¼r\x20','77saIMFs','\x20(Multi-Person\x20Filter)','[DeadMan]\x20','includes','indexOf','(((.+)+)+)+$','3391310BjDbLb','val','toString','analysis.safety.deadMan.smartSleep','analysis.safety.deadMan.active','now','sofa','1903020raFRwa','analysis.safety.deadMan.alarmState'];a2_0x4f5d=function(){return _0x343c8a;};return a2_0x4f5d();}function a2_0x56da(_0x56cfe4,_0x1ba1aa){const _0x33125f=a2_0x4f5d();return a2_0x56da=function(_0x41c129,_0x3d5e7e){_0x41c129=_0x41c129-0x1b0;let _0x4f5d0a=_0x33125f[_0x41c129];return _0x4f5d0a;},a2_0x56da(_0x56cfe4,_0x1ba1aa);}let activeTimer=null,currentMonitoredRoom=null,timeoutMs=0x0,startTime=0x0,alarmStage=0x0;const DEFAULT_TIMEOUTS={'bad':0x2d,'bath':0x2d,'toilet':0x1e,'wc':0x1e,'keller':0x3c,'schlaf':0x78,'bed':0x78,'guest':0x5a,'gast':0x5a};function getTimeoutRobust(_0x43bed3,_0x4f5555){const _0x34e00d=a2_0x56da;if(!_0x43bed3||!_0x4f5555)return undefined;if(_0x43bed3[_0x4f5555])return _0x43bed3[_0x4f5555];const _0x16ef7b=_0x4f5555['toLowerCase']()['replace'](/[^a-z0-9]/g,'');for(const _0x4b8ffe in _0x43bed3){const _0x5bdc69=_0x4b8ffe[_0x34e00d(0x1d6)]()['replace'](/[^a-z0-9]/g,'');if(_0x5bdc69===_0x16ef7b)return _0x43bed3[_0x4b8ffe];}const _0x51cb22=_0x4f5555[_0x34e00d(0x1d6)]();if(_0x43bed3[_0x51cb22])return _0x43bed3[_0x51cb22];return undefined;}async function loadConfig(_0xb7b505){const _0x36d696=a2_0x56da;try{const _0x1897db=await _0xb7b505['getStateAsync'](_0x36d696(0x1d9));if(_0x1897db&&_0x1897db[_0x36d696(0x1b2)])return JSON[_0x36d696(0x1c5)](_0x1897db[_0x36d696(0x1b2)]);}catch(_0x403a68){}return{};}async function isActive(_0x50a55e){const _0x426728=a2_0x56da;try{const _0x2487c3=await _0x50a55e[_0x426728(0x1cc)](_0x426728(0x1b5));return _0x2487c3&&_0x2487c3[_0x426728(0x1b2)];}catch(_0x44e3ab){return![];}}async function areRoomsConnected(_0x12f49f,_0x38cbb5,_0x4cbff0){const _0xb57a22=a2_0x56da;try{const _0x4904d6=await _0x12f49f['getStateAsync']('analysis.topology.structure');if(!_0x4904d6||!_0x4904d6['val'])return!![];const _0x3705e9=JSON[_0xb57a22(0x1c5)](_0x4904d6[_0xb57a22(0x1b2)]),{rooms:_0x488089,matrix:_0x9fc1a4}=_0x3705e9;if(!_0x488089||!_0x9fc1a4)return!![];const _0x1540df=_0x488089[_0xb57a22(0x1e8)](_0x38cbb5),_0x5e756a=_0x488089[_0xb57a22(0x1e8)](_0x4cbff0);if(_0x1540df===-0x1||_0x5e756a===-0x1)return!![];const _0x34d41d=_0x9fc1a4[_0x1540df][_0x5e756a]>0x0||_0x9fc1a4[_0x5e756a][_0x1540df]>0x0;return _0x34d41d;}catch(_0x43de70){return _0x12f49f[_0xb57a22(0x1c3)]['warn'](_0xb57a22(0x1bc)+_0x43de70[_0xb57a22(0x1bb)]),!![];}}function calculateSleepProbability(_0x37286c){const _0x5441ee=a2_0x56da,_0x4efea6=new Date(),_0x31ebe4=_0x4efea6[_0x5441ee(0x1d0)](),_0x4f6ffa=_0x37286c[_0x5441ee(0x1d6)]();let _0x51a14a=0.1;if(_0x31ebe4>=0x17||_0x31ebe4<=0x6)_0x51a14a=0x1;else{if(_0x31ebe4>=0xd&&_0x31ebe4<=0xf)_0x51a14a=0.8;else{if(_0x31ebe4>=0x14&&_0x31ebe4<=0x17)_0x51a14a=0.4;}}let _0x4d9191=0.1;if(_0x4f6ffa[_0x5441ee(0x1e7)]('schlaf')||_0x4f6ffa[_0x5441ee(0x1e7)](_0x5441ee(0x1df)))_0x4d9191=0x1;else{if(_0x4f6ffa[_0x5441ee(0x1e7)]('wohn')||_0x4f6ffa[_0x5441ee(0x1e7)]('living')||_0x4f6ffa['includes'](_0x5441ee(0x1b7)))_0x4d9191=0.6;else{if(_0x4f6ffa['includes']('bad')||_0x4f6ffa['includes']('wc'))_0x4d9191=0.05;}}let _0x51e498=0.5;const _0x4459d0=_0x4d9191*0.5+_0x51a14a*0.3+_0x51e498*0.2;return parseFloat(_0x4459d0[_0x5441ee(0x1e1)](0x2));}async function updateLocation(_0x4e64f4,_0x298304){const _0x487838=a2_0x56da;if(!_0x298304||_0x298304===_0x487838(0x1d3))return;if(!await isActive(_0x4e64f4)){resetTimer(_0x4e64f4);return;}if(currentMonitoredRoom&&currentMonitoredRoom!==_0x298304){const _0x4abeab=await areRoomsConnected(_0x4e64f4,currentMonitoredRoom,_0x298304);if(!_0x4abeab){const _0x2066dd=_0x487838(0x1c1)+_0x298304+_0x487838(0x1ba)+currentMonitoredRoom+'\x27.';_0x4e64f4[_0x487838(0x1c3)][_0x487838(0x1c8)]('[DeadMan]\x20'+_0x2066dd+_0x487838(0x1e5)),await _0x4e64f4[_0x487838(0x1e0)](_0x487838(0x1bf),{'val':JSON[_0x487838(0x1ce)]({'room':_0x298304,'reason':_0x2066dd,'timestamp':Date['now']()}),'ack':!![]});return;}resetTimer(_0x4e64f4);}if(!currentMonitoredRoom){await _0x4e64f4[_0x487838(0x1e0)](_0x487838(0x1d5),{'val':_0x298304,'ack':!![]});const _0x923ea5=await loadConfig(_0x4e64f4);let _0x5719f9=getTimeoutRobust(_0x923ea5,_0x298304);const _0x1d8fe0=_0x298304[_0x487838(0x1d6)]();if(!_0x5719f9)for(const _0x4138cd in DEFAULT_TIMEOUTS){if(_0x1d8fe0['includes'](_0x4138cd)){_0x5719f9=DEFAULT_TIMEOUTS[_0x4138cd];break;}}if(!_0x5719f9&&_0x923ea5[_0x487838(0x1cf)])_0x5719f9=_0x923ea5[_0x487838(0x1cf)];if(!_0x5719f9)return;currentMonitoredRoom=_0x298304,startTimer(_0x4e64f4,_0x5719f9,_0x298304);}}function startTimer(_0x36196b,_0x330d08,_0x282eda){const _0x2ff9ea=a2_0x56da;if(activeTimer)clearTimeout(activeTimer);timeoutMs=_0x330d08*0x3c*0x3e8,startTime=Date[_0x2ff9ea(0x1b6)](),alarmStage=0x0;const _0x1d29c4=calculateSleepProbability(_0x282eda||currentMonitoredRoom),_0x57442c=_0x1d29c4>0.65;_0x57442c?(timeoutMs+=0x5a*0x3c*0x3e8,_0x36196b[_0x2ff9ea(0x1c3)][_0x2ff9ea(0x1c8)](_0x2ff9ea(0x1c7)+(_0x1d29c4*0x64)[_0x2ff9ea(0x1e1)](0x0)+_0x2ff9ea(0x1e3)+currentMonitoredRoom+_0x2ff9ea(0x1dd)),_0x36196b[_0x2ff9ea(0x1e0)](_0x2ff9ea(0x1b4),{'val':!![],'ack':!![]})):_0x36196b[_0x2ff9ea(0x1e0)]('analysis.safety.deadMan.smartSleep',{'val':![],'ack':!![]}),_0x36196b[_0x2ff9ea(0x1e0)](_0x2ff9ea(0x1d4),{'val':_0x1d29c4,'ack':!![]}),_0x36196b[_0x2ff9ea(0x1c3)][_0x2ff9ea(0x1c8)](_0x2ff9ea(0x1db)+currentMonitoredRoom+_0x2ff9ea(0x1c2)+_0x330d08+_0x2ff9ea(0x1bd)),_0x36196b[_0x2ff9ea(0x1e0)](_0x2ff9ea(0x1b9),{'val':'ok','ack':!![]}),activeTimer=setTimeout(()=>triggerPreWarn(_0x36196b),timeoutMs);}function resetTimer(_0x4a51d1){const _0x5e8cba=a2_0x56da;if(activeTimer)clearTimeout(activeTimer);activeTimer=null,currentMonitoredRoom=null,alarmStage=0x0,_0x4a51d1[_0x5e8cba(0x1e0)]('analysis.safety.deadMan.alarmState',{'val':'ok','ack':!![]}),_0x4a51d1[_0x5e8cba(0x1e0)](_0x5e8cba(0x1b4),{'val':![],'ack':!![]}),_0x4a51d1[_0x5e8cba(0x1e0)](_0x5e8cba(0x1d4),{'val':0x0,'ack':!![]});}async function triggerPreWarn(_0x4d8005){const _0x41e2f1=a2_0x56da;alarmStage=0x1,await _0x4d8005[_0x41e2f1(0x1e0)](_0x41e2f1(0x1b9),{'val':_0x41e2f1(0x1da),'ack':!![]});const _0x1b5bda=_0x41e2f1(0x1d2)+currentMonitoredRoom+_0x41e2f1(0x1de);_0x4d8005[_0x41e2f1(0x1c3)][_0x41e2f1(0x1be)](_0x41e2f1(0x1e6)+_0x1b5bda),await setup['sendNotification'](_0x4d8005,_0x41e2f1(0x1c0)+_0x1b5bda),activeTimer=setTimeout(()=>triggerAlarm(_0x4d8005),0x5*0x3c*0x3e8);}async function triggerAlarm(_0x5e3df5){const _0x5dccf9=a2_0x56da;alarmStage=0x2,await _0x5e3df5[_0x5dccf9(0x1e0)](_0x5dccf9(0x1b9),{'val':'alarm','ack':!![]});const _0x24a7ca='ðŸš¨\x20NOTFALL-ALARM:\x20Person\x20reagiert\x20nicht\x20in\x20'+currentMonitoredRoom+'!';_0x5e3df5[_0x5dccf9(0x1c3)][_0x5dccf9(0x1cb)](_0x5dccf9(0x1e6)+_0x24a7ca),await setup['sendNotification'](_0x5e3df5,_0x24a7ca,![],!![]);}module[a2_0x278b7a(0x1d8)]={'updateLocation':updateLocation};