const a2_0x53a820=a2_0x269b;function a2_0x594e(){const _0x488c80=['29294484YOVXMm','\x20(Multi-Person\x20Filter)','parse','val','\x27.\x20Nicht\x20verbunden\x20mit\x20Ã¼berwachtem\x20\x27','3275943KBKlqn','replace','sendNotification','Ignoriere\x20Bewegung\x20in\x20\x27','analysis.safety.deadMan.napProbability','6508JeONbB','info','constructor','analysis.safety.deadMan.alarmState','[DeadMan]\x20','living','663940zlpgAX','\x20fÃ¼r\x20','apply','exports','getStateAsync','sofa','analysis.safety.deadMan.smartSleep','30rAYwcW','includes','867ijfwbd','555513NwthQR','ðŸ‘¼\x20Schutzengel-Frage:\x20','340505rRrMAv','wohn','indexOf','now','%).\x20VerlÃ¤ngere\x20Timer\x20fÃ¼r\x20','alarm','18OkJQzz','setStateAsync','\x20um\x2090\x20Min.','78fUqjiK','bad','analysis.safety.deadMan.currentRoom','schlaf','log','warn','message','analysis.safety.deadMan.lastIgnored','bed','ðŸš¨\x20NOTFALL-ALARM:\x20Person\x20reagiert\x20nicht\x20in\x20','./setup','(((.+)+)+)+$','toLowerCase','1564216GQoueX','pre_warn','error','toString','default','10OUnqBS','\x20Min.','search','ðŸ‘¼\x20Schutzengel:\x20Ãœberwache\x20','ðŸ’¤\x20Smart\x20Sleep\x20erkannt\x20('];a2_0x594e=function(){return _0x488c80;};return a2_0x594e();}(function(_0xd4ab5a,_0x185fd2){const _0x3aa741=a2_0x269b,_0x38b6c8=_0xd4ab5a();while(!![]){try{const _0x182e21=-parseInt(_0x3aa741(0xb3))/0x1+-parseInt(_0x3aa741(0xa1))/0x2*(-parseInt(_0x3aa741(0xb0))/0x3)+-parseInt(_0x3aa741(0xa7))/0x4*(-parseInt(_0x3aa741(0x92))/0x5)+-parseInt(_0x3aa741(0xbc))/0x6*(-parseInt(_0x3aa741(0xb1))/0x7)+parseInt(_0x3aa741(0x8d))/0x8*(parseInt(_0x3aa741(0xb9))/0x9)+-parseInt(_0x3aa741(0xae))/0xa*(-parseInt(_0x3aa741(0x9c))/0xb)+-parseInt(_0x3aa741(0x97))/0xc;if(_0x182e21===_0x185fd2)break;else _0x38b6c8['push'](_0x38b6c8['shift']());}catch(_0x25bbc7){_0x38b6c8['push'](_0x38b6c8['shift']());}}}(a2_0x594e,0xc4fa8));const a2_0x309379=(function(){let _0x324bd7=!![];return function(_0x16b293,_0x4e0a41){const _0x36417e=_0x324bd7?function(){const _0x4a9e5c=a2_0x269b;if(_0x4e0a41){const _0x1a4b96=_0x4e0a41[_0x4a9e5c(0xa9)](_0x16b293,arguments);return _0x4e0a41=null,_0x1a4b96;}}:function(){};return _0x324bd7=![],_0x36417e;};}()),a2_0x267567=a2_0x309379(this,function(){const _0x3c1a80=a2_0x269b;return a2_0x267567[_0x3c1a80(0x90)]()['search'](_0x3c1a80(0x8b))[_0x3c1a80(0x90)]()[_0x3c1a80(0xa3)](a2_0x267567)[_0x3c1a80(0x94)]('(((.+)+)+)+$');});a2_0x267567();'use strict';const setup=require(a2_0x53a820(0x8a));let activeTimer=null,currentMonitoredRoom=null,timeoutMs=0x0,startTime=0x0,alarmStage=0x0;const DEFAULT_TIMEOUTS={'bad':0x2d,'bath':0x2d,'toilet':0x1e,'wc':0x1e,'keller':0x3c,'schlaf':0x78,'bed':0x78,'guest':0x5a,'gast':0x5a};function getTimeoutRobust(_0xc6a1b6,_0x4b58e1){const _0x23d36d=a2_0x53a820;if(!_0xc6a1b6||!_0x4b58e1)return undefined;if(_0xc6a1b6[_0x4b58e1])return _0xc6a1b6[_0x4b58e1];const _0x4410cd=_0x4b58e1[_0x23d36d(0x8c)]()[_0x23d36d(0x9d)](/[^a-z0-9]/g,'');for(const _0x206b7e in _0xc6a1b6){const _0x4a2361=_0x206b7e[_0x23d36d(0x8c)]()['replace'](/[^a-z0-9]/g,'');if(_0x4a2361===_0x4410cd)return _0xc6a1b6[_0x206b7e];}const _0x4ed732=_0x4b58e1[_0x23d36d(0x8c)]();if(_0xc6a1b6[_0x4ed732])return _0xc6a1b6[_0x4ed732];return undefined;}async function loadConfig(_0x2e597b){const _0xa6c36=a2_0x53a820;try{const _0xf8fbbf=await _0x2e597b['getStateAsync']('analysis.safety.deadMan.config');if(_0xf8fbbf&&_0xf8fbbf[_0xa6c36(0x9a)])return JSON[_0xa6c36(0x99)](_0xf8fbbf[_0xa6c36(0x9a)]);}catch(_0x1b5682){}return{};}async function isActive(_0x28311c){const _0x58333a=a2_0x53a820;try{const _0x3c5898=await _0x28311c['getStateAsync']('analysis.safety.deadMan.active');return _0x3c5898&&_0x3c5898[_0x58333a(0x9a)];}catch(_0x49ec81){return![];}}async function areRoomsConnected(_0xa4fbf9,_0xbc875a,_0x54d187){const _0x4a35eb=a2_0x53a820;try{const _0xca96fc=await _0xa4fbf9[_0x4a35eb(0xab)]('analysis.topology.structure');if(!_0xca96fc||!_0xca96fc[_0x4a35eb(0x9a)])return!![];const _0x40c33c=JSON['parse'](_0xca96fc['val']),{rooms:_0x125f8a,matrix:_0x26729b}=_0x40c33c;if(!_0x125f8a||!_0x26729b)return!![];const _0x109751=_0x125f8a[_0x4a35eb(0xb5)](_0xbc875a),_0x2c6967=_0x125f8a[_0x4a35eb(0xb5)](_0x54d187);if(_0x109751===-0x1||_0x2c6967===-0x1)return!![];const _0x552144=_0x26729b[_0x109751][_0x2c6967]>0x0||_0x26729b[_0x2c6967][_0x109751]>0x0;return _0x552144;}catch(_0x1101a9){return _0xa4fbf9[_0x4a35eb(0xc0)][_0x4a35eb(0xc1)]('[DeadMan]\x20Topology\x20check\x20failed:\x20'+_0x1101a9[_0x4a35eb(0xc2)]),!![];}}function calculateSleepProbability(_0x2582e4){const _0x91faf0=a2_0x53a820,_0x493c22=new Date(),_0x41bace=_0x493c22['getHours'](),_0x55ca31=_0x2582e4[_0x91faf0(0x8c)]();let _0x1d8555=0.1;if(_0x41bace>=0x17||_0x41bace<=0x6)_0x1d8555=0x1;else{if(_0x41bace>=0xd&&_0x41bace<=0xf)_0x1d8555=0.8;else{if(_0x41bace>=0x14&&_0x41bace<=0x17)_0x1d8555=0.4;}}let _0x207281=0.1;if(_0x55ca31['includes'](_0x91faf0(0xbf))||_0x55ca31[_0x91faf0(0xaf)](_0x91faf0(0x88)))_0x207281=0x1;else{if(_0x55ca31[_0x91faf0(0xaf)](_0x91faf0(0xb4))||_0x55ca31[_0x91faf0(0xaf)](_0x91faf0(0xa6))||_0x55ca31[_0x91faf0(0xaf)](_0x91faf0(0xac)))_0x207281=0.6;else{if(_0x55ca31[_0x91faf0(0xaf)](_0x91faf0(0xbd))||_0x55ca31[_0x91faf0(0xaf)]('wc'))_0x207281=0.05;}}let _0x3a59d9=0.5;const _0x337672=_0x207281*0.5+_0x1d8555*0.3+_0x3a59d9*0.2;return parseFloat(_0x337672['toFixed'](0x2));}function a2_0x269b(_0x4742f1,_0x112245){const _0x55ffb9=a2_0x594e();return a2_0x269b=function(_0x267567,_0x309379){_0x267567=_0x267567-0x88;let _0x594eba=_0x55ffb9[_0x267567];return _0x594eba;},a2_0x269b(_0x4742f1,_0x112245);}async function updateLocation(_0x117c87,_0x2a654d){const _0x52439a=a2_0x53a820;if(!_0x2a654d||_0x2a654d==='Unknown')return;if(!await isActive(_0x117c87)){resetTimer(_0x117c87);return;}if(currentMonitoredRoom&&currentMonitoredRoom!==_0x2a654d){const _0x515367=await areRoomsConnected(_0x117c87,currentMonitoredRoom,_0x2a654d);if(!_0x515367){const _0x45fd4d=_0x52439a(0x9f)+_0x2a654d+_0x52439a(0x9b)+currentMonitoredRoom+'\x27.';_0x117c87[_0x52439a(0xc0)]['info']('[DeadMan]\x20'+_0x45fd4d+_0x52439a(0x98)),await _0x117c87[_0x52439a(0xba)](_0x52439a(0xc3),{'val':JSON['stringify']({'room':_0x2a654d,'reason':_0x45fd4d,'timestamp':Date[_0x52439a(0xb6)]()}),'ack':!![]});return;}resetTimer(_0x117c87);}if(!currentMonitoredRoom){await _0x117c87['setStateAsync'](_0x52439a(0xbe),{'val':_0x2a654d,'ack':!![]});const _0x3a7aad=await loadConfig(_0x117c87);let _0x4da965=getTimeoutRobust(_0x3a7aad,_0x2a654d);const _0x58a0c8=_0x2a654d[_0x52439a(0x8c)]();if(!_0x4da965)for(const _0x54b546 in DEFAULT_TIMEOUTS){if(_0x58a0c8['includes'](_0x54b546)){_0x4da965=DEFAULT_TIMEOUTS[_0x54b546];break;}}if(!_0x4da965&&_0x3a7aad[_0x52439a(0x91)])_0x4da965=_0x3a7aad[_0x52439a(0x91)];if(!_0x4da965)return;currentMonitoredRoom=_0x2a654d,startTimer(_0x117c87,_0x4da965,_0x2a654d);}}function startTimer(_0x1cea38,_0x215e40,_0xf50c6c){const _0x359ced=a2_0x53a820;if(activeTimer)clearTimeout(activeTimer);timeoutMs=_0x215e40*0x3c*0x3e8,startTime=Date['now'](),alarmStage=0x0;const _0x503ca4=calculateSleepProbability(_0xf50c6c||currentMonitoredRoom),_0x166b49=_0x503ca4>0.65;_0x166b49?(timeoutMs+=0x5a*0x3c*0x3e8,_0x1cea38[_0x359ced(0xc0)][_0x359ced(0xa2)](_0x359ced(0x96)+(_0x503ca4*0x64)['toFixed'](0x0)+_0x359ced(0xb7)+currentMonitoredRoom+_0x359ced(0xbb)),_0x1cea38[_0x359ced(0xba)](_0x359ced(0xad),{'val':!![],'ack':!![]})):_0x1cea38[_0x359ced(0xba)]('analysis.safety.deadMan.smartSleep',{'val':![],'ack':!![]}),_0x1cea38[_0x359ced(0xba)](_0x359ced(0xa0),{'val':_0x503ca4,'ack':!![]}),_0x1cea38[_0x359ced(0xc0)][_0x359ced(0xa2)](_0x359ced(0x95)+currentMonitoredRoom+_0x359ced(0xa8)+_0x215e40+_0x359ced(0x93)),_0x1cea38[_0x359ced(0xba)](_0x359ced(0xa4),{'val':'ok','ack':!![]}),activeTimer=setTimeout(()=>triggerPreWarn(_0x1cea38),timeoutMs);}function resetTimer(_0x3d4063){const _0x5a584f=a2_0x53a820;if(activeTimer)clearTimeout(activeTimer);activeTimer=null,currentMonitoredRoom=null,alarmStage=0x0,_0x3d4063['setStateAsync'](_0x5a584f(0xa4),{'val':'ok','ack':!![]}),_0x3d4063['setStateAsync'](_0x5a584f(0xad),{'val':![],'ack':!![]}),_0x3d4063['setStateAsync'](_0x5a584f(0xa0),{'val':0x0,'ack':!![]});}async function triggerPreWarn(_0x37e1fd){const _0x259e2d=a2_0x53a820;alarmStage=0x1,await _0x37e1fd[_0x259e2d(0xba)](_0x259e2d(0xa4),{'val':_0x259e2d(0x8e),'ack':!![]});const _0x24d92d='â³\x20ACHTUNG:\x20UngewÃ¶hnlich\x20lange\x20InaktivitÃ¤t\x20in\x20'+currentMonitoredRoom+'.\x20Alles\x20in\x20Ordnung?';_0x37e1fd[_0x259e2d(0xc0)][_0x259e2d(0xc1)]('[DeadMan]\x20'+_0x24d92d),await setup['sendNotification'](_0x37e1fd,_0x259e2d(0xb2)+_0x24d92d),activeTimer=setTimeout(()=>triggerAlarm(_0x37e1fd),0x5*0x3c*0x3e8);}async function triggerAlarm(_0x50ee86){const _0x23c2c4=a2_0x53a820;alarmStage=0x2,await _0x50ee86[_0x23c2c4(0xba)](_0x23c2c4(0xa4),{'val':_0x23c2c4(0xb8),'ack':!![]});const _0x307053=_0x23c2c4(0x89)+currentMonitoredRoom+'!';_0x50ee86[_0x23c2c4(0xc0)][_0x23c2c4(0x8f)](_0x23c2c4(0xa5)+_0x307053),await setup[_0x23c2c4(0x9e)](_0x50ee86,_0x307053,![],!![]);}module[a2_0x53a820(0xaa)]={'updateLocation':updateLocation};