const a2_0x4cd757=a2_0x32c6;(function(_0x14ae9f,_0x867f02){const _0x20624c=a2_0x32c6,_0x3ec19f=_0x14ae9f();while(!![]){try{const _0x3a0eb5=parseInt(_0x20624c(0x1c0))/0x1+parseInt(_0x20624c(0x1e5))/0x2+parseInt(_0x20624c(0x1dd))/0x3+parseInt(_0x20624c(0x1e6))/0x4*(parseInt(_0x20624c(0x1e8))/0x5)+parseInt(_0x20624c(0x1ce))/0x6*(-parseInt(_0x20624c(0x1cb))/0x7)+parseInt(_0x20624c(0x1d0))/0x8+-parseInt(_0x20624c(0x1ed))/0x9*(parseInt(_0x20624c(0x1e4))/0xa);if(_0x3a0eb5===_0x867f02)break;else _0x3ec19f['push'](_0x3ec19f['shift']());}catch(_0x229f10){_0x3ec19f['push'](_0x3ec19f['shift']());}}}(a2_0x4efc,0xb739c));const a2_0x6ce573=(function(){let _0x482b0f=!![];return function(_0xda7283,_0x354550){const _0x507e40=_0x482b0f?function(){if(_0x354550){const _0x3519bb=_0x354550['apply'](_0xda7283,arguments);return _0x354550=null,_0x3519bb;}}:function(){};return _0x482b0f=![],_0x507e40;};}()),a2_0x20b869=a2_0x6ce573(this,function(){const _0x99545b=a2_0x32c6;return a2_0x20b869['toString']()[_0x99545b(0x1d5)]('(((.+)+)+)+$')['toString']()[_0x99545b(0x1c1)](a2_0x20b869)[_0x99545b(0x1d5)](_0x99545b(0x1c4));});a2_0x20b869();'use strict';const setup=require('./setup');let activeTimer=null,currentMonitoredRoom=null,timeoutMs=0x0,startTime=0x0,alarmStage=0x0;function a2_0x4efc(){const _0x9a6156=['1395526HGldBG','constructor','.\x20Alles\x20in\x20Ordnung?','%).\x20VerlÃ¤ngere\x20Timer\x20fÃ¼r\x20','(((.+)+)+)+$','replace','[DeadMan]\x20Topology\x20check\x20failed:\x20','wohn','Ignoriere\x20Bewegung\x20in\x20\x27','warn','ðŸ‘¼\x20Schutzengel:\x20Ãœberwache\x20','7FsiNNy','default','\x20(Multi-Person\x20Filter)','2279580sgybDD','info','9259584BAQEHK','analysis.safety.deadMan.active','setStateAsync','toLowerCase','analysis.safety.deadMan.napProbability','search','log','\x20Min.','indexOf','val','includes','error','parse','3760392bwGniq','now','\x20fÃ¼r\x20','ðŸ’¤\x20Smart\x20Sleep\x20erkannt\x20(','analysis.safety.deadMan.smartSleep','analysis.safety.deadMan.lastIgnored','message','71270CzszZO','2335720OPVPos','2636mstoGm','getStateAsync','9715weLSSA','bad','alarm','analysis.topology.structure','bed','6471ENzSIQ','[DeadMan]\x20','sofa','Unknown','exports','\x20um\x2090\x20Min.','analysis.safety.deadMan.alarmState','analysis.safety.deadMan.currentRoom','toFixed','getHours','pre_warn'];a2_0x4efc=function(){return _0x9a6156;};return a2_0x4efc();}const DEFAULT_TIMEOUTS={'bad':0x2d,'bath':0x2d,'toilet':0x1e,'wc':0x1e,'keller':0x3c,'schlaf':0x78,'bed':0x78,'guest':0x5a,'gast':0x5a};function getTimeoutRobust(_0x131635,_0x2cbb93){const _0x23bcfd=a2_0x32c6;if(!_0x131635||!_0x2cbb93)return undefined;if(_0x131635[_0x2cbb93])return _0x131635[_0x2cbb93];const _0x484989=_0x2cbb93[_0x23bcfd(0x1d3)]()[_0x23bcfd(0x1c5)](/[^a-z0-9]/g,'');for(const _0x74f5d1 in _0x131635){const _0xb1c5c6=_0x74f5d1[_0x23bcfd(0x1d3)]()['replace'](/[^a-z0-9]/g,'');if(_0xb1c5c6===_0x484989)return _0x131635[_0x74f5d1];}const _0x2f6509=_0x2cbb93['toLowerCase']();if(_0x131635[_0x2f6509])return _0x131635[_0x2f6509];return undefined;}async function loadConfig(_0x392499){const _0x3764bb=a2_0x32c6;try{const _0x391cf9=await _0x392499[_0x3764bb(0x1e7)]('analysis.safety.deadMan.config');if(_0x391cf9&&_0x391cf9[_0x3764bb(0x1d9)])return JSON['parse'](_0x391cf9[_0x3764bb(0x1d9)]);}catch(_0x60147){}return{};}async function isActive(_0x45e2ae){const _0x83fe9e=a2_0x32c6;try{const _0x5e0810=await _0x45e2ae['getStateAsync'](_0x83fe9e(0x1d1));return _0x5e0810&&_0x5e0810[_0x83fe9e(0x1d9)];}catch(_0x3cb845){return![];}}async function areRoomsConnected(_0x5961b3,_0x4cb86a,_0xe33350){const _0xc4d9e6=a2_0x32c6;try{const _0x593fea=await _0x5961b3[_0xc4d9e6(0x1e7)](_0xc4d9e6(0x1eb));if(!_0x593fea||!_0x593fea[_0xc4d9e6(0x1d9)])return!![];const _0xe8bc99=JSON[_0xc4d9e6(0x1dc)](_0x593fea[_0xc4d9e6(0x1d9)]),{rooms:_0x11f9b2,matrix:_0xcda242}=_0xe8bc99;if(!_0x11f9b2||!_0xcda242)return!![];const _0x1a4014=_0x11f9b2[_0xc4d9e6(0x1d8)](_0x4cb86a),_0x248533=_0x11f9b2[_0xc4d9e6(0x1d8)](_0xe33350);if(_0x1a4014===-0x1||_0x248533===-0x1)return!![];const _0x474851=_0xcda242[_0x1a4014][_0x248533]>0x0||_0xcda242[_0x248533][_0x1a4014]>0x0;return _0x474851;}catch(_0x183d16){return _0x5961b3[_0xc4d9e6(0x1d6)][_0xc4d9e6(0x1c9)](_0xc4d9e6(0x1c6)+_0x183d16[_0xc4d9e6(0x1e3)]),!![];}}function calculateSleepProbability(_0x965ce5){const _0x11e2d8=a2_0x32c6,_0xa5bb62=new Date(),_0x2ec081=_0xa5bb62[_0x11e2d8(0x1be)](),_0x122b94=_0x965ce5[_0x11e2d8(0x1d3)]();let _0x351924=0.1;if(_0x2ec081>=0x17||_0x2ec081<=0x6)_0x351924=0x1;else{if(_0x2ec081>=0xd&&_0x2ec081<=0xf)_0x351924=0.8;else{if(_0x2ec081>=0x14&&_0x2ec081<=0x17)_0x351924=0.4;}}let _0x1a12ea=0.1;if(_0x122b94[_0x11e2d8(0x1da)]('schlaf')||_0x122b94[_0x11e2d8(0x1da)](_0x11e2d8(0x1ec)))_0x1a12ea=0x1;else{if(_0x122b94[_0x11e2d8(0x1da)](_0x11e2d8(0x1c7))||_0x122b94[_0x11e2d8(0x1da)]('living')||_0x122b94[_0x11e2d8(0x1da)](_0x11e2d8(0x1ef)))_0x1a12ea=0.6;else{if(_0x122b94['includes'](_0x11e2d8(0x1e9))||_0x122b94['includes']('wc'))_0x1a12ea=0.05;}}let _0x58176a=0.5;const _0x299826=_0x1a12ea*0.5+_0x351924*0.3+_0x58176a*0.2;return parseFloat(_0x299826[_0x11e2d8(0x1bd)](0x2));}async function updateLocation(_0x111f61,_0x4b7eef){const _0x1d9481=a2_0x32c6;if(!_0x4b7eef||_0x4b7eef===_0x1d9481(0x1f0))return;if(!await isActive(_0x111f61)){resetTimer(_0x111f61);return;}if(currentMonitoredRoom&&currentMonitoredRoom!==_0x4b7eef){const _0x235a8f=await areRoomsConnected(_0x111f61,currentMonitoredRoom,_0x4b7eef);if(!_0x235a8f){const _0x48945e=_0x1d9481(0x1c8)+_0x4b7eef+'\x27.\x20Nicht\x20verbunden\x20mit\x20Ã¼berwachtem\x20\x27'+currentMonitoredRoom+'\x27.';_0x111f61[_0x1d9481(0x1d6)][_0x1d9481(0x1cf)](_0x1d9481(0x1ee)+_0x48945e+_0x1d9481(0x1cd)),await _0x111f61['setStateAsync'](_0x1d9481(0x1e2),{'val':JSON['stringify']({'room':_0x4b7eef,'reason':_0x48945e,'timestamp':Date['now']()}),'ack':!![]});return;}resetTimer(_0x111f61);}if(!currentMonitoredRoom){await _0x111f61[_0x1d9481(0x1d2)](_0x1d9481(0x1bc),{'val':_0x4b7eef,'ack':!![]});const _0x111d11=await loadConfig(_0x111f61);let _0x3c8def=getTimeoutRobust(_0x111d11,_0x4b7eef);const _0x30d780=_0x4b7eef[_0x1d9481(0x1d3)]();if(!_0x3c8def)for(const _0x1401c7 in DEFAULT_TIMEOUTS){if(_0x30d780['includes'](_0x1401c7)){_0x3c8def=DEFAULT_TIMEOUTS[_0x1401c7];break;}}if(!_0x3c8def&&_0x111d11[_0x1d9481(0x1cc)])_0x3c8def=_0x111d11[_0x1d9481(0x1cc)];if(!_0x3c8def)return;currentMonitoredRoom=_0x4b7eef,startTimer(_0x111f61,_0x3c8def,_0x4b7eef);}}function startTimer(_0xf9e085,_0x490096,_0x275fe0){const _0x10571b=a2_0x32c6;if(activeTimer)clearTimeout(activeTimer);timeoutMs=_0x490096*0x3c*0x3e8,startTime=Date[_0x10571b(0x1de)](),alarmStage=0x0;const _0x42e0db=calculateSleepProbability(_0x275fe0||currentMonitoredRoom),_0x84f3e=_0x42e0db>0.65;_0x84f3e?(timeoutMs+=0x5a*0x3c*0x3e8,_0xf9e085[_0x10571b(0x1d6)][_0x10571b(0x1cf)](_0x10571b(0x1e0)+(_0x42e0db*0x64)[_0x10571b(0x1bd)](0x0)+_0x10571b(0x1c3)+currentMonitoredRoom+_0x10571b(0x1ba)),_0xf9e085[_0x10571b(0x1d2)](_0x10571b(0x1e1),{'val':!![],'ack':!![]})):_0xf9e085['setStateAsync'](_0x10571b(0x1e1),{'val':![],'ack':!![]}),_0xf9e085['setStateAsync'](_0x10571b(0x1d4),{'val':_0x42e0db,'ack':!![]}),_0xf9e085[_0x10571b(0x1d6)][_0x10571b(0x1cf)](_0x10571b(0x1ca)+currentMonitoredRoom+_0x10571b(0x1df)+_0x490096+_0x10571b(0x1d7)),_0xf9e085[_0x10571b(0x1d2)](_0x10571b(0x1bb),{'val':'ok','ack':!![]}),activeTimer=setTimeout(()=>triggerPreWarn(_0xf9e085),timeoutMs);}function resetTimer(_0x4ff457){const _0x265a66=a2_0x32c6;if(activeTimer)clearTimeout(activeTimer);activeTimer=null,currentMonitoredRoom=null,alarmStage=0x0,_0x4ff457[_0x265a66(0x1d2)]('analysis.safety.deadMan.alarmState',{'val':'ok','ack':!![]}),_0x4ff457[_0x265a66(0x1d2)](_0x265a66(0x1e1),{'val':![],'ack':!![]}),_0x4ff457[_0x265a66(0x1d2)](_0x265a66(0x1d4),{'val':0x0,'ack':!![]});}async function triggerPreWarn(_0x4b11b4){const _0x41e30f=a2_0x32c6;alarmStage=0x1,await _0x4b11b4[_0x41e30f(0x1d2)](_0x41e30f(0x1bb),{'val':_0x41e30f(0x1bf),'ack':!![]});const _0x567199='â³\x20ACHTUNG:\x20UngewÃ¶hnlich\x20lange\x20InaktivitÃ¤t\x20in\x20'+currentMonitoredRoom+_0x41e30f(0x1c2);_0x4b11b4[_0x41e30f(0x1d6)][_0x41e30f(0x1c9)](_0x41e30f(0x1ee)+_0x567199),await setup['sendNotification'](_0x4b11b4,'ðŸ‘¼\x20Schutzengel-Frage:\x20'+_0x567199),activeTimer=setTimeout(()=>triggerAlarm(_0x4b11b4),0x5*0x3c*0x3e8);}async function triggerAlarm(_0x450de9){const _0x36f774=a2_0x32c6;alarmStage=0x2,await _0x450de9[_0x36f774(0x1d2)](_0x36f774(0x1bb),{'val':_0x36f774(0x1ea),'ack':!![]});const _0x22f562='ðŸš¨\x20NOTFALL-ALARM:\x20Person\x20reagiert\x20nicht\x20in\x20'+currentMonitoredRoom+'!';_0x450de9[_0x36f774(0x1d6)][_0x36f774(0x1db)](_0x36f774(0x1ee)+_0x22f562),await setup['sendNotification'](_0x450de9,_0x22f562,![],!![]);}function a2_0x32c6(_0x4f3c3b,_0x13f7cb){const _0x3cff15=a2_0x4efc();return a2_0x32c6=function(_0x20b869,_0x6ce573){_0x20b869=_0x20b869-0x1ba;let _0x4efc8a=_0x3cff15[_0x20b869];return _0x4efc8a;},a2_0x32c6(_0x4f3c3b,_0x13f7cb);}module[a2_0x4cd757(0x1f1)]={'updateLocation':updateLocation};