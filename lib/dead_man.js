const a2_0x28d131=a2_0x35aa;(function(_0x5d0f61,_0x20b521){const _0x2d656d=a2_0x35aa,_0x43b0a7=_0x5d0f61();while(!![]){try{const _0x36c6d5=parseInt(_0x2d656d(0x109))/0x1*(parseInt(_0x2d656d(0x127))/0x2)+parseInt(_0x2d656d(0x112))/0x3+-parseInt(_0x2d656d(0x12f))/0x4+parseInt(_0x2d656d(0x123))/0x5+-parseInt(_0x2d656d(0x124))/0x6*(-parseInt(_0x2d656d(0x117))/0x7)+-parseInt(_0x2d656d(0x11f))/0x8*(parseInt(_0x2d656d(0x11e))/0x9)+-parseInt(_0x2d656d(0x114))/0xa*(parseInt(_0x2d656d(0x113))/0xb);if(_0x36c6d5===_0x20b521)break;else _0x43b0a7['push'](_0x43b0a7['shift']());}catch(_0x3ce4cc){_0x43b0a7['push'](_0x43b0a7['shift']());}}}(a2_0x1677,0xe1264));const a2_0x149ecf=(function(){let _0xb13691=!![];return function(_0x2d49d3,_0x4e7f1b){const _0x170660=_0xb13691?function(){const _0x3206b7=a2_0x35aa;if(_0x4e7f1b){const _0x14454f=_0x4e7f1b[_0x3206b7(0x12c)](_0x2d49d3,arguments);return _0x4e7f1b=null,_0x14454f;}}:function(){};return _0xb13691=![],_0x170660;};}()),a2_0x26e8af=a2_0x149ecf(this,function(){const _0x58c5af=a2_0x35aa;return a2_0x26e8af[_0x58c5af(0x122)]()[_0x58c5af(0x119)](_0x58c5af(0x10d))[_0x58c5af(0x122)]()[_0x58c5af(0x129)](a2_0x26e8af)[_0x58c5af(0x119)](_0x58c5af(0x10d));});a2_0x26e8af();'use strict';const setup=require('./setup');let activeTimer=null,currentMonitoredRoom=null,timeoutMs=0x0,startTime=0x0,alarmStage=0x0;const DEFAULT_TIMEOUTS={'bad':0x2d,'bath':0x2d,'toilet':0x1e,'wc':0x1e,'keller':0x3c};async function loadConfig(_0x39a4ae){const _0x3543d0=a2_0x35aa;try{const _0x320599=await _0x39a4ae[_0x3543d0(0x116)](_0x3543d0(0x115));if(_0x320599&&_0x320599[_0x3543d0(0x12e)])return JSON[_0x3543d0(0x118)](_0x320599[_0x3543d0(0x12e)]);}catch(_0x2036f3){}return{};}function a2_0x35aa(_0x360a6f,_0x29c0fc){const _0x5d03e3=a2_0x1677();return a2_0x35aa=function(_0x26e8af,_0x149ecf){_0x26e8af=_0x26e8af-0x104;let _0x1677d1=_0x5d03e3[_0x26e8af];return _0x1677d1;},a2_0x35aa(_0x360a6f,_0x29c0fc);}async function isActive(_0x231e86){const _0x14a9cf=a2_0x35aa;try{const _0x400fe0=await _0x231e86['getStateAsync'](_0x14a9cf(0x105));return _0x400fe0&&_0x400fe0[_0x14a9cf(0x12e)];}catch(_0x28c66c){return![];}}async function areRoomsConnected(_0x3ecace,_0x3d8ace,_0x1ec16f){const _0x16371c=a2_0x35aa;try{const _0x55b76d=await _0x3ecace['getStateAsync']('analysis.topology.structure');if(!_0x55b76d||!_0x55b76d[_0x16371c(0x12e)])return!![];const _0x4ce9e6=JSON['parse'](_0x55b76d['val']),{rooms:_0x5764e1,matrix:_0x34cf4b}=_0x4ce9e6;if(!_0x5764e1||!_0x34cf4b)return!![];const _0x1794f5=_0x5764e1['indexOf'](_0x3d8ace),_0x52bd28=_0x5764e1[_0x16371c(0x131)](_0x1ec16f);if(_0x1794f5===-0x1||_0x52bd28===-0x1)return!![];const _0x1257d3=_0x34cf4b[_0x1794f5][_0x52bd28]>0x0||_0x34cf4b[_0x52bd28][_0x1794f5]>0x0;return _0x1257d3;}catch(_0x22f89e){return _0x3ecace[_0x16371c(0x10f)][_0x16371c(0x104)](_0x16371c(0x11b)+_0x22f89e[_0x16371c(0x10e)]),!![];}}async function updateLocation(_0xe4e090,_0x511278){const _0x3c8fdb=a2_0x35aa;if(!_0x511278||_0x511278===_0x3c8fdb(0x108))return;if(!await isActive(_0xe4e090)){resetTimer(_0xe4e090);return;}if(currentMonitoredRoom&&currentMonitoredRoom!==_0x511278){const _0x2b06a9=await areRoomsConnected(_0xe4e090,currentMonitoredRoom,_0x511278);if(!_0x2b06a9){const _0x4dd7f4=_0x3c8fdb(0x107)+_0x511278+_0x3c8fdb(0x111)+currentMonitoredRoom+'\x27.';_0xe4e090['log']['info']('[DeadMan]\x20'+_0x4dd7f4+_0x3c8fdb(0x12d)),await _0xe4e090[_0x3c8fdb(0x126)](_0x3c8fdb(0x132),{'val':JSON[_0x3c8fdb(0x125)]({'room':_0x511278,'reason':_0x4dd7f4,'timestamp':Date[_0x3c8fdb(0x11c)]()}),'ack':!![]});return;}resetTimer(_0xe4e090);}if(!currentMonitoredRoom){await _0xe4e090[_0x3c8fdb(0x126)]('analysis.safety.deadMan.currentRoom',{'val':_0x511278,'ack':!![]});const _0x1c73ab=await loadConfig(_0xe4e090),_0x277c4d=_0x511278['toLowerCase']();let _0x2605af=_0x1c73ab[_0x511278]||_0x1c73ab[_0x277c4d];if(!_0x2605af)for(const _0xa39815 in DEFAULT_TIMEOUTS){if(_0x277c4d[_0x3c8fdb(0x10c)](_0xa39815)){_0x2605af=DEFAULT_TIMEOUTS[_0xa39815];break;}}if(!_0x2605af&&_0x1c73ab[_0x3c8fdb(0x121)])_0x2605af=_0x1c73ab[_0x3c8fdb(0x121)];if(!_0x2605af)return;currentMonitoredRoom=_0x511278,startTimer(_0xe4e090,_0x2605af);}}function startTimer(_0x1adbcd,_0x13987f){const _0x2db1ac=a2_0x35aa;if(activeTimer)clearTimeout(activeTimer);timeoutMs=_0x13987f*0x3c*0x3e8,startTime=Date['now'](),alarmStage=0x0,_0x1adbcd['log']['info'](_0x2db1ac(0x128)+currentMonitoredRoom+'\x20fÃ¼r\x20'+_0x13987f+_0x2db1ac(0x11a)),_0x1adbcd['setStateAsync'](_0x2db1ac(0x12b),{'val':'ok','ack':!![]}),activeTimer=setTimeout(()=>triggerPreWarn(_0x1adbcd),timeoutMs);}function a2_0x1677(){const _0xe98708=['alarm','includes','(((.+)+)+)+$','message','log','ðŸ‘¼\x20Schutzengel-Frage:\x20','\x27.\x20Nicht\x20verbunden\x20mit\x20Ã¼berwachtem\x20\x27','3206883kPAgzT','11QaImJP','7274900EjddUI','analysis.safety.deadMan.config','getStateAsync','4299239KtqllO','parse','search','\x20Min.','[DeadMan]\x20Topology\x20check\x20failed:\x20','now','exports','621171vasZaW','56rlToaq','pre_warn','default','toString','201445flyVti','6dBvpWl','stringify','setStateAsync','1574nBACRo','ðŸ‘¼\x20Schutzengel:\x20Ãœberwache\x20','constructor','.\x20Alles\x20in\x20Ordnung?','analysis.safety.deadMan.alarmState','apply','\x20(Multi-Person\x20Filter)','val','4598556ZJZGpx','â³\x20ACHTUNG:\x20UngewÃ¶hnlich\x20lange\x20InaktivitÃ¤t\x20in\x20','indexOf','analysis.safety.deadMan.lastIgnored','warn','analysis.safety.deadMan.active','[DeadMan]\x20','Ignoriere\x20Bewegung\x20in\x20\x27','Unknown','1981yDbefW','sendNotification'];a2_0x1677=function(){return _0xe98708;};return a2_0x1677();}function resetTimer(_0x3a8557){const _0xfac806=a2_0x35aa;if(activeTimer)clearTimeout(activeTimer);activeTimer=null,currentMonitoredRoom=null,alarmStage=0x0,_0x3a8557[_0xfac806(0x126)](_0xfac806(0x12b),{'val':'ok','ack':!![]});}async function triggerPreWarn(_0x49c501){const _0x4fdf31=a2_0x35aa;alarmStage=0x1,await _0x49c501['setStateAsync'](_0x4fdf31(0x12b),{'val':_0x4fdf31(0x120),'ack':!![]});const _0x1ca92e=_0x4fdf31(0x130)+currentMonitoredRoom+_0x4fdf31(0x12a);_0x49c501['log'][_0x4fdf31(0x104)](_0x4fdf31(0x106)+_0x1ca92e),await setup[_0x4fdf31(0x10a)](_0x49c501,_0x4fdf31(0x110)+_0x1ca92e),activeTimer=setTimeout(()=>triggerAlarm(_0x49c501),0x5*0x3c*0x3e8);}async function triggerAlarm(_0x2a2372){const _0x38bfc7=a2_0x35aa;alarmStage=0x2,await _0x2a2372[_0x38bfc7(0x126)](_0x38bfc7(0x12b),{'val':_0x38bfc7(0x10b),'ack':!![]});const _0xaf5455='ðŸš¨\x20NOTFALL-ALARM:\x20Person\x20reagiert\x20nicht\x20in\x20'+currentMonitoredRoom+'!';_0x2a2372['log']['error'](_0x38bfc7(0x106)+_0xaf5455),await setup['sendNotification'](_0x2a2372,_0xaf5455,![],!![]);}module[a2_0x28d131(0x11d)]={'updateLocation':updateLocation};