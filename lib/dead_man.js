const a2_0x117a93=a2_0x3b1e;(function(_0x2690bf,_0x5eef99){const _0x50a873=a2_0x3b1e,_0x183d61=_0x2690bf();while(!![]){try{const _0x5ecd28=parseInt(_0x50a873(0x1df))/0x1*(parseInt(_0x50a873(0x1b7))/0x2)+-parseInt(_0x50a873(0x1b9))/0x3+-parseInt(_0x50a873(0x1cf))/0x4+-parseInt(_0x50a873(0x1ce))/0x5+-parseInt(_0x50a873(0x1cb))/0x6*(parseInt(_0x50a873(0x1c3))/0x7)+-parseInt(_0x50a873(0x1e7))/0x8*(-parseInt(_0x50a873(0x1db))/0x9)+parseInt(_0x50a873(0x1d2))/0xa*(parseInt(_0x50a873(0x1de))/0xb);if(_0x5ecd28===_0x5eef99)break;else _0x183d61['push'](_0x183d61['shift']());}catch(_0x1abdb4){_0x183d61['push'](_0x183d61['shift']());}}}(a2_0x2678,0x4ae74));const a2_0x44ec6a=(function(){let _0x4b49a1=!![];return function(_0x513ff1,_0x2a6142){const _0x2f5e53=_0x4b49a1?function(){if(_0x2a6142){const _0x4e18ea=_0x2a6142['apply'](_0x513ff1,arguments);return _0x2a6142=null,_0x4e18ea;}}:function(){};return _0x4b49a1=![],_0x2f5e53;};}()),a2_0x36de60=a2_0x44ec6a(this,function(){const _0x46a725=a2_0x3b1e;return a2_0x36de60['toString']()[_0x46a725(0x1cd)](_0x46a725(0x1da))[_0x46a725(0x1c8)]()['constructor'](a2_0x36de60)[_0x46a725(0x1cd)]('(((.+)+)+)+$');});a2_0x36de60();'use strict';const setup=require(a2_0x117a93(0x1eb));let activeTimer=null,currentMonitoredRoom=null,timeoutMs=0x0,startTime=0x0,alarmStage=0x0;const DEFAULT_TIMEOUTS={'bad':0x2d,'bath':0x2d,'toilet':0x1e,'wc':0x1e,'keller':0x3c,'schlaf':0x78,'bed':0x78,'guest':0x5a,'gast':0x5a};function getTimeoutRobust(_0xa54071,_0x1b3d8a){const _0x3cfd87=a2_0x117a93;if(!_0xa54071||!_0x1b3d8a)return undefined;if(_0xa54071[_0x1b3d8a])return _0xa54071[_0x1b3d8a];const _0x5dec5b=_0x1b3d8a[_0x3cfd87(0x1c7)]()[_0x3cfd87(0x1c1)](/[^a-z0-9]/g,'');for(const _0x3b49c6 in _0xa54071){const _0x24b3e2=_0x3b49c6[_0x3cfd87(0x1c7)]()[_0x3cfd87(0x1c1)](/[^a-z0-9]/g,'');if(_0x24b3e2===_0x5dec5b)return _0xa54071[_0x3b49c6];}const _0x57a067=_0x1b3d8a[_0x3cfd87(0x1c7)]();if(_0xa54071[_0x57a067])return _0xa54071[_0x57a067];return undefined;}async function loadConfig(_0x2bbd58){const _0x4a27bd=a2_0x117a93;try{const _0x29e8e8=await _0x2bbd58['getStateAsync'](_0x4a27bd(0x1e2));if(_0x29e8e8&&_0x29e8e8['val'])return JSON[_0x4a27bd(0x1e1)](_0x29e8e8[_0x4a27bd(0x1e3)]);}catch(_0x3a12dd){}return{};}async function isActive(_0x3d6b7a){const _0x5e89ec=a2_0x117a93;try{const _0x180001=await _0x3d6b7a[_0x5e89ec(0x1dc)](_0x5e89ec(0x1d0));return _0x180001&&_0x180001['val'];}catch(_0x16d3b8){return![];}}async function areRoomsConnected(_0x5b1570,_0x3b3edd,_0x4dbea7){const _0x2c0ffd=a2_0x117a93;try{const _0x3df8e7=await _0x5b1570[_0x2c0ffd(0x1dc)](_0x2c0ffd(0x1d1));if(!_0x3df8e7||!_0x3df8e7['val'])return!![];const _0x184fe6=JSON[_0x2c0ffd(0x1e1)](_0x3df8e7[_0x2c0ffd(0x1e3)]),{rooms:_0x54f0e6,matrix:_0x429941}=_0x184fe6;if(!_0x54f0e6||!_0x429941)return!![];const _0x14a4f6=_0x54f0e6[_0x2c0ffd(0x1c9)](_0x3b3edd),_0x5933a1=_0x54f0e6[_0x2c0ffd(0x1c9)](_0x4dbea7);if(_0x14a4f6===-0x1||_0x5933a1===-0x1)return!![];const _0x3d51fa=_0x429941[_0x14a4f6][_0x5933a1]>0x0||_0x429941[_0x5933a1][_0x14a4f6]>0x0;return _0x3d51fa;}catch(_0x459c61){return _0x5b1570['log']['warn']('[DeadMan]\x20Topology\x20check\x20failed:\x20'+_0x459c61[_0x2c0ffd(0x1be)]),!![];}}function calculateSleepProbability(_0x25a124){const _0x425ad3=a2_0x117a93,_0x12444f=new Date(),_0x5d7c0d=_0x12444f['getHours'](),_0x1a0c73=_0x25a124[_0x425ad3(0x1c7)]();let _0x4af8b5=0.1;if(_0x5d7c0d>=0x17||_0x5d7c0d<=0x6)_0x4af8b5=0x1;else{if(_0x5d7c0d>=0xd&&_0x5d7c0d<=0xf)_0x4af8b5=0.8;else{if(_0x5d7c0d>=0x14&&_0x5d7c0d<=0x17)_0x4af8b5=0.4;}}let _0x50ea8a=0.1;if(_0x1a0c73['includes']('schlaf')||_0x1a0c73['includes'](_0x425ad3(0x1bd)))_0x50ea8a=0x1;else{if(_0x1a0c73['includes'](_0x425ad3(0x1c2))||_0x1a0c73['includes'](_0x425ad3(0x1dd))||_0x1a0c73[_0x425ad3(0x1d4)]('sofa'))_0x50ea8a=0.6;else{if(_0x1a0c73[_0x425ad3(0x1d4)](_0x425ad3(0x1c0))||_0x1a0c73['includes']('wc'))_0x50ea8a=0.05;}}let _0x170d43=0.5;const _0x2ae332=_0x50ea8a*0.5+_0x4af8b5*0.3+_0x170d43*0.2;return parseFloat(_0x2ae332[_0x425ad3(0x1e6)](0x2));}function a2_0x2678(){const _0x42b699=['analysis.safety.deadMan.lastIgnored','bad','replace','wohn','3232761inAseL','\x20Min.','[DeadMan]\x20','pre_warn','toLowerCase','toString','indexOf','sendNotification','6aNXjFJ','now','search','2624245FYcIXC','799992KicJwj','analysis.safety.deadMan.active','analysis.topology.structure','1995900IrTFRe','default','includes','warn','ðŸ‘¼\x20Schutzengel-Frage:\x20','.\x20Alles\x20in\x20Ordnung?','setStateAsync','analysis.safety.deadMan.currentRoom','(((.+)+)+)+$','458226QWsnUL','getStateAsync','living','66IaeDce','111692aGQyKP','ðŸ’¤\x20Smart\x20Sleep\x20erkannt\x20(','parse','analysis.safety.deadMan.config','val','\x20(Multi-Person\x20Filter)','â³\x20ACHTUNG:\x20UngewÃ¶hnlich\x20lange\x20InaktivitÃ¤t\x20in\x20','toFixed','72ttaAJj','ðŸ‘¼\x20Schutzengel:\x20Ãœberwache\x20','Unknown','log','./setup','analysis.safety.deadMan.smartSleep','6thldSI','stringify','1492104iuEGTm','info','\x20um\x2090\x20Min.','analysis.safety.deadMan.alarmState','bed','message'];a2_0x2678=function(){return _0x42b699;};return a2_0x2678();}async function updateLocation(_0x1ddd50,_0x5295d0){const _0x234443=a2_0x117a93;if(!_0x5295d0||_0x5295d0===_0x234443(0x1e9))return;if(!await isActive(_0x1ddd50)){resetTimer(_0x1ddd50);return;}if(currentMonitoredRoom&&currentMonitoredRoom!==_0x5295d0){const _0x55ee7e=await areRoomsConnected(_0x1ddd50,currentMonitoredRoom,_0x5295d0);if(!_0x55ee7e){const _0x220d5f='Ignoriere\x20Bewegung\x20in\x20\x27'+_0x5295d0+'\x27.\x20Nicht\x20verbunden\x20mit\x20Ã¼berwachtem\x20\x27'+currentMonitoredRoom+'\x27.';_0x1ddd50['log'][_0x234443(0x1ba)](_0x234443(0x1c5)+_0x220d5f+_0x234443(0x1e4)),await _0x1ddd50['setStateAsync'](_0x234443(0x1bf),{'val':JSON[_0x234443(0x1b8)]({'room':_0x5295d0,'reason':_0x220d5f,'timestamp':Date[_0x234443(0x1cc)]()}),'ack':!![]});return;}resetTimer(_0x1ddd50);}if(!currentMonitoredRoom){await _0x1ddd50[_0x234443(0x1d8)](_0x234443(0x1d9),{'val':_0x5295d0,'ack':!![]});const _0x441395=await loadConfig(_0x1ddd50);let _0x3be66c=getTimeoutRobust(_0x441395,_0x5295d0);const _0x56bfec=_0x5295d0['toLowerCase']();if(!_0x3be66c)for(const _0x9336be in DEFAULT_TIMEOUTS){if(_0x56bfec[_0x234443(0x1d4)](_0x9336be)){_0x3be66c=DEFAULT_TIMEOUTS[_0x9336be];break;}}if(!_0x3be66c&&_0x441395[_0x234443(0x1d3)])_0x3be66c=_0x441395[_0x234443(0x1d3)];if(!_0x3be66c)return;currentMonitoredRoom=_0x5295d0,startTimer(_0x1ddd50,_0x3be66c,_0x5295d0);}}function startTimer(_0xfb357,_0x477dee,_0x2d6911){const _0x456324=a2_0x117a93;if(activeTimer)clearTimeout(activeTimer);timeoutMs=_0x477dee*0x3c*0x3e8,startTime=Date['now'](),alarmStage=0x0;const _0x8f9342=calculateSleepProbability(_0x2d6911||currentMonitoredRoom),_0x19b6af=_0x8f9342>0.65;_0x19b6af?(timeoutMs+=0x5a*0x3c*0x3e8,_0xfb357[_0x456324(0x1ea)]['info'](_0x456324(0x1e0)+(_0x8f9342*0x64)[_0x456324(0x1e6)](0x0)+'%).\x20VerlÃ¤ngere\x20Timer\x20fÃ¼r\x20'+currentMonitoredRoom+_0x456324(0x1bb)),_0xfb357[_0x456324(0x1d8)]('analysis.safety.deadMan.smartSleep',{'val':!![],'ack':!![]})):_0xfb357['setStateAsync'](_0x456324(0x1ec),{'val':![],'ack':!![]}),_0xfb357[_0x456324(0x1d8)]('analysis.safety.deadMan.napProbability',{'val':_0x8f9342,'ack':!![]}),_0xfb357[_0x456324(0x1ea)][_0x456324(0x1ba)](_0x456324(0x1e8)+currentMonitoredRoom+'\x20fÃ¼r\x20'+_0x477dee+_0x456324(0x1c4)),_0xfb357[_0x456324(0x1d8)](_0x456324(0x1bc),{'val':'ok','ack':!![]}),activeTimer=setTimeout(()=>triggerPreWarn(_0xfb357),timeoutMs);}function resetTimer(_0x276b76){const _0x13b199=a2_0x117a93;if(activeTimer)clearTimeout(activeTimer);activeTimer=null,currentMonitoredRoom=null,alarmStage=0x0,_0x276b76['setStateAsync'](_0x13b199(0x1bc),{'val':'ok','ack':!![]}),_0x276b76[_0x13b199(0x1d8)](_0x13b199(0x1ec),{'val':![],'ack':!![]}),_0x276b76[_0x13b199(0x1d8)]('analysis.safety.deadMan.napProbability',{'val':0x0,'ack':!![]});}async function triggerPreWarn(_0x1c553b){const _0x1e3c6b=a2_0x117a93;alarmStage=0x1,await _0x1c553b[_0x1e3c6b(0x1d8)]('analysis.safety.deadMan.alarmState',{'val':_0x1e3c6b(0x1c6),'ack':!![]});const _0x55f8f4=_0x1e3c6b(0x1e5)+currentMonitoredRoom+_0x1e3c6b(0x1d7);_0x1c553b[_0x1e3c6b(0x1ea)][_0x1e3c6b(0x1d5)](_0x1e3c6b(0x1c5)+_0x55f8f4),await setup[_0x1e3c6b(0x1ca)](_0x1c553b,_0x1e3c6b(0x1d6)+_0x55f8f4),activeTimer=setTimeout(()=>triggerAlarm(_0x1c553b),0x5*0x3c*0x3e8);}function a2_0x3b1e(_0x1e5342,_0xb4c66){const _0x20d871=a2_0x2678();return a2_0x3b1e=function(_0x36de60,_0x44ec6a){_0x36de60=_0x36de60-0x1b7;let _0x2678ab=_0x20d871[_0x36de60];return _0x2678ab;},a2_0x3b1e(_0x1e5342,_0xb4c66);}async function triggerAlarm(_0x2a212e){const _0x1fbb68=a2_0x117a93;alarmStage=0x2,await _0x2a212e['setStateAsync'](_0x1fbb68(0x1bc),{'val':'alarm','ack':!![]});const _0xbe6e='ðŸš¨\x20NOTFALL-ALARM:\x20Person\x20reagiert\x20nicht\x20in\x20'+currentMonitoredRoom+'!';_0x2a212e['log']['error'](_0x1fbb68(0x1c5)+_0xbe6e),await setup[_0x1fbb68(0x1ca)](_0x2a212e,_0xbe6e,![],!![]);}module['exports']={'updateLocation':updateLocation};