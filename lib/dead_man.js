const a2_0x1b6f4e=a2_0x6a99;(function(_0x3868a8,_0x7bb6f4){const _0x17de23=a2_0x6a99,_0x5235db=_0x3868a8();while(!![]){try{const _0x3da759=parseInt(_0x17de23(0xa6))/0x1+parseInt(_0x17de23(0x94))/0x2+parseInt(_0x17de23(0xad))/0x3*(-parseInt(_0x17de23(0x89))/0x4)+-parseInt(_0x17de23(0x93))/0x5+-parseInt(_0x17de23(0xb1))/0x6+-parseInt(_0x17de23(0xb3))/0x7*(-parseInt(_0x17de23(0x7e))/0x8)+parseInt(_0x17de23(0xa2))/0x9;if(_0x3da759===_0x7bb6f4)break;else _0x5235db['push'](_0x5235db['shift']());}catch(_0x258398){_0x5235db['push'](_0x5235db['shift']());}}}(a2_0x5d75,0x3f793));const a2_0xb96093=(function(){let _0x13250=!![];return function(_0x8c7b86,_0x39ec2a){const _0x3ad27e=_0x13250?function(){if(_0x39ec2a){const _0x178bed=_0x39ec2a['apply'](_0x8c7b86,arguments);return _0x39ec2a=null,_0x178bed;}}:function(){};return _0x13250=![],_0x3ad27e;};}()),a2_0x307ba6=a2_0xb96093(this,function(){const _0xb5d171=a2_0x6a99;return a2_0x307ba6[_0xb5d171(0x97)]()['search'](_0xb5d171(0x87))['toString']()[_0xb5d171(0xb0)](a2_0x307ba6)[_0xb5d171(0x7f)](_0xb5d171(0x87));});a2_0x307ba6();'use strict';const setup=require(a2_0x1b6f4e(0x8c));function a2_0x6a99(_0x1d15cb,_0x36a7b3){const _0x1720e9=a2_0x5d75();return a2_0x6a99=function(_0x307ba6,_0xb96093){_0x307ba6=_0x307ba6-0x7e;let _0x5d757f=_0x1720e9[_0x307ba6];return _0x5d757f;},a2_0x6a99(_0x1d15cb,_0x36a7b3);}let activeTimer=null,currentMonitoredRoom=null,timeoutMs=0x0,startTime=0x0,alarmStage=0x0;const DEFAULT_TIMEOUTS={'bad':0x2d,'bath':0x2d,'toilet':0x1e,'wc':0x1e,'keller':0x3c,'schlaf':0x78,'bed':0x78,'guest':0x5a,'gast':0x5a};function getTimeoutRobust(_0x9e7d90,_0x3b48f6){const _0x3aa2ab=a2_0x1b6f4e;if(!_0x9e7d90||!_0x3b48f6)return undefined;if(_0x9e7d90[_0x3b48f6])return _0x9e7d90[_0x3b48f6];const _0x33af71=_0x3b48f6[_0x3aa2ab(0x95)]()[_0x3aa2ab(0x88)](/[^a-z0-9]/g,'');for(const _0x82145d in _0x9e7d90){const _0x5a2468=_0x82145d[_0x3aa2ab(0x95)]()['replace'](/[^a-z0-9]/g,'');if(_0x5a2468===_0x33af71)return _0x9e7d90[_0x82145d];}const _0x32f4ae=_0x3b48f6[_0x3aa2ab(0x95)]();if(_0x9e7d90[_0x32f4ae])return _0x9e7d90[_0x32f4ae];return undefined;}async function loadConfig(_0x5a12ee){const _0x34ebb0=a2_0x1b6f4e;try{const _0x38ff16=await _0x5a12ee[_0x34ebb0(0xa0)](_0x34ebb0(0x9b));if(_0x38ff16&&_0x38ff16[_0x34ebb0(0x9c)])return JSON[_0x34ebb0(0x91)](_0x38ff16[_0x34ebb0(0x9c)]);}catch(_0x3abc65){}return{};}async function isActive(_0x1245ec){const _0x21c740=a2_0x1b6f4e;try{const _0x165c18=await _0x1245ec['getStateAsync'](_0x21c740(0xae));return _0x165c18&&_0x165c18[_0x21c740(0x9c)];}catch(_0x458abf){return![];}}async function areRoomsConnected(_0x5e0467,_0x1e9d94,_0x4f44ac){const _0xcaacd=a2_0x1b6f4e;try{const _0x1ea517=await _0x5e0467[_0xcaacd(0xa0)](_0xcaacd(0x8a));if(!_0x1ea517||!_0x1ea517[_0xcaacd(0x9c)])return!![];const _0x362d1d=JSON[_0xcaacd(0x91)](_0x1ea517[_0xcaacd(0x9c)]),{rooms:_0x4fde7a,matrix:_0x56d1c3}=_0x362d1d;if(!_0x4fde7a||!_0x56d1c3)return!![];const _0x20be2c=_0x4fde7a['indexOf'](_0x1e9d94),_0x342821=_0x4fde7a['indexOf'](_0x4f44ac);if(_0x20be2c===-0x1||_0x342821===-0x1)return!![];const _0x8b923f=_0x56d1c3[_0x20be2c][_0x342821]>0x0||_0x56d1c3[_0x342821][_0x20be2c]>0x0;return _0x8b923f;}catch(_0x53dd41){return _0x5e0467[_0xcaacd(0xaa)][_0xcaacd(0xac)]('[DeadMan]\x20Topology\x20check\x20failed:\x20'+_0x53dd41[_0xcaacd(0xa9)]),!![];}}function calculateSleepProbability(_0x45e2f1){const _0x14c287=a2_0x1b6f4e,_0x55bdcb=new Date(),_0x19227a=_0x55bdcb['getHours'](),_0x50271c=_0x45e2f1[_0x14c287(0x95)]();let _0x145fc8=0.1;if(_0x19227a>=0x17||_0x19227a<=0x6)_0x145fc8=0x1;else{if(_0x19227a>=0xd&&_0x19227a<=0xf)_0x145fc8=0.8;else{if(_0x19227a>=0x14&&_0x19227a<=0x17)_0x145fc8=0.4;}}let _0x5ad690=0.1;if(_0x50271c[_0x14c287(0x9f)](_0x14c287(0x81))||_0x50271c[_0x14c287(0x9f)](_0x14c287(0xaf)))_0x5ad690=0x1;else{if(_0x50271c[_0x14c287(0x9f)](_0x14c287(0x90))||_0x50271c['includes'](_0x14c287(0x8b))||_0x50271c[_0x14c287(0x9f)](_0x14c287(0x84)))_0x5ad690=0.6;else{if(_0x50271c['includes'](_0x14c287(0x96))||_0x50271c[_0x14c287(0x9f)]('wc'))_0x5ad690=0.05;}}let _0x390d04=0.5;const _0x4fa64f=_0x5ad690*0.5+_0x145fc8*0.3+_0x390d04*0.2;return parseFloat(_0x4fa64f[_0x14c287(0x85)](0x2));}async function updateLocation(_0x3a6529,_0x482817){const _0x52873c=a2_0x1b6f4e;if(!_0x482817||_0x482817==='Unknown')return;if(!await isActive(_0x3a6529)){resetTimer(_0x3a6529);return;}if(currentMonitoredRoom&&currentMonitoredRoom!==_0x482817){const _0x27d0da=await areRoomsConnected(_0x3a6529,currentMonitoredRoom,_0x482817);if(!_0x27d0da){const _0x3d70e9=_0x52873c(0xa5)+_0x482817+_0x52873c(0xa1)+currentMonitoredRoom+'\x27.';_0x3a6529[_0x52873c(0xaa)][_0x52873c(0x8f)]('[DeadMan]\x20'+_0x3d70e9+'\x20(Multi-Person\x20Filter)'),await _0x3a6529['setStateAsync'](_0x52873c(0x9d),{'val':JSON[_0x52873c(0x9e)]({'room':_0x482817,'reason':_0x3d70e9,'timestamp':Date['now']()}),'ack':!![]});return;}resetTimer(_0x3a6529);}if(!currentMonitoredRoom){await _0x3a6529['setStateAsync'](_0x52873c(0xa4),{'val':_0x482817,'ack':!![]});const _0x597dbe=await loadConfig(_0x3a6529);let _0x15a5ba=getTimeoutRobust(_0x597dbe,_0x482817);const _0xe4bfa9=_0x482817[_0x52873c(0x95)]();if(!_0x15a5ba)for(const _0x1a5ff1 in DEFAULT_TIMEOUTS){if(_0xe4bfa9[_0x52873c(0x9f)](_0x1a5ff1)){_0x15a5ba=DEFAULT_TIMEOUTS[_0x1a5ff1];break;}}if(!_0x15a5ba&&_0x597dbe['default'])_0x15a5ba=_0x597dbe[_0x52873c(0x82)];if(!_0x15a5ba)return;currentMonitoredRoom=_0x482817,startTimer(_0x3a6529,_0x15a5ba,_0x482817);}}function startTimer(_0x755e88,_0x15078c,_0x1eff36){const _0x39292c=a2_0x1b6f4e;if(activeTimer)clearTimeout(activeTimer);timeoutMs=_0x15078c*0x3c*0x3e8,startTime=Date[_0x39292c(0x83)](),alarmStage=0x0;const _0x1aa5ad=calculateSleepProbability(_0x1eff36||currentMonitoredRoom),_0x3588fa=_0x1aa5ad>0.65;_0x3588fa?(timeoutMs+=0x5a*0x3c*0x3e8,_0x755e88[_0x39292c(0xaa)][_0x39292c(0x8f)]('ðŸ’¤\x20Smart\x20Sleep\x20erkannt\x20('+(_0x1aa5ad*0x64)[_0x39292c(0x85)](0x0)+'%).\x20VerlÃ¤ngere\x20Timer\x20fÃ¼r\x20'+currentMonitoredRoom+'\x20um\x2090\x20Min.'),_0x755e88[_0x39292c(0xa3)](_0x39292c(0x8d),{'val':!![],'ack':!![]})):_0x755e88[_0x39292c(0xa3)](_0x39292c(0x8d),{'val':![],'ack':!![]}),_0x755e88['setStateAsync'](_0x39292c(0x86),{'val':_0x1aa5ad,'ack':!![]}),_0x755e88[_0x39292c(0xaa)]['info']('ðŸ‘¼\x20Schutzengel:\x20Ãœberwache\x20'+currentMonitoredRoom+_0x39292c(0xb2)+_0x15078c+_0x39292c(0xa8)),_0x755e88[_0x39292c(0xa3)](_0x39292c(0x9a),{'val':'ok','ack':!![]}),activeTimer=setTimeout(()=>triggerPreWarn(_0x755e88),timeoutMs);}function resetTimer(_0x5b0010){const _0x291002=a2_0x1b6f4e;if(activeTimer)clearTimeout(activeTimer);activeTimer=null,currentMonitoredRoom=null,alarmStage=0x0,_0x5b0010[_0x291002(0xa3)](_0x291002(0x9a),{'val':'ok','ack':!![]}),_0x5b0010[_0x291002(0xa3)](_0x291002(0x8d),{'val':![],'ack':!![]}),_0x5b0010['setStateAsync']('analysis.safety.deadMan.napProbability',{'val':0x0,'ack':!![]});}async function triggerPreWarn(_0xc89b8e){const _0x5742c5=a2_0x1b6f4e;alarmStage=0x1,await _0xc89b8e['setStateAsync'](_0x5742c5(0x9a),{'val':_0x5742c5(0x99),'ack':!![]});const _0x4553af='â³\x20ACHTUNG:\x20UngewÃ¶hnlich\x20lange\x20InaktivitÃ¤t\x20in\x20'+currentMonitoredRoom+_0x5742c5(0x8e);_0xc89b8e[_0x5742c5(0xaa)][_0x5742c5(0xac)](_0x5742c5(0x80)+_0x4553af),await setup['sendNotification'](_0xc89b8e,'ðŸ‘¼\x20Schutzengel-Frage:\x20'+_0x4553af),activeTimer=setTimeout(()=>triggerAlarm(_0xc89b8e),0x5*0x3c*0x3e8);}async function triggerAlarm(_0x268b86){const _0x29e0b9=a2_0x1b6f4e;alarmStage=0x2,await _0x268b86[_0x29e0b9(0xa3)]('analysis.safety.deadMan.alarmState',{'val':'alarm','ack':!![]});const _0x48ed9d=_0x29e0b9(0xab)+currentMonitoredRoom+'!';_0x268b86[_0x29e0b9(0xaa)][_0x29e0b9(0x92)](_0x29e0b9(0x80)+_0x48ed9d),await setup[_0x29e0b9(0x98)](_0x268b86,_0x48ed9d,![],!![]);}function a2_0x5d75(){const _0x78832a=['\x27.\x20Nicht\x20verbunden\x20mit\x20Ã¼berwachtem\x20\x27','4704336PKDWny','setStateAsync','analysis.safety.deadMan.currentRoom','Ignoriere\x20Bewegung\x20in\x20\x27','150966qzJygs','exports','\x20Min.','message','log','ðŸš¨\x20NOTFALL-ALARM:\x20Person\x20reagiert\x20nicht\x20in\x20','warn','165SxIfBe','analysis.safety.deadMan.active','bed','constructor','1087080DrbWZE','\x20fÃ¼r\x20','680183nqmfrA','8hvLPHw','search','[DeadMan]\x20','schlaf','default','now','sofa','toFixed','analysis.safety.deadMan.napProbability','(((.+)+)+)+$','replace','10700wJjXXH','analysis.topology.structure','living','./setup','analysis.safety.deadMan.smartSleep','.\x20Alles\x20in\x20Ordnung?','info','wohn','parse','error','2471815RSxjnv','623632wdObvC','toLowerCase','bad','toString','sendNotification','pre_warn','analysis.safety.deadMan.alarmState','analysis.safety.deadMan.config','val','analysis.safety.deadMan.lastIgnored','stringify','includes','getStateAsync'];a2_0x5d75=function(){return _0x78832a;};return a2_0x5d75();}module[a2_0x1b6f4e(0xa7)]={'updateLocation':updateLocation};