const a2_0x2ef975=a2_0x2add;(function(_0x300ee3,_0x14da8a){const _0x3815cc=a2_0x2add,_0x277ec4=_0x300ee3();while(!![]){try{const _0x47c497=parseInt(_0x3815cc(0xe2))/0x1*(parseInt(_0x3815cc(0xfe))/0x2)+-parseInt(_0x3815cc(0xff))/0x3*(-parseInt(_0x3815cc(0xf6))/0x4)+-parseInt(_0x3815cc(0xed))/0x5*(parseInt(_0x3815cc(0xe7))/0x6)+-parseInt(_0x3815cc(0xe1))/0x7+-parseInt(_0x3815cc(0xf4))/0x8*(-parseInt(_0x3815cc(0x106))/0x9)+parseInt(_0x3815cc(0xdc))/0xa*(-parseInt(_0x3815cc(0xf0))/0xb)+-parseInt(_0x3815cc(0xe8))/0xc*(parseInt(_0x3815cc(0x101))/0xd);if(_0x47c497===_0x14da8a)break;else _0x277ec4['push'](_0x277ec4['shift']());}catch(_0x10c3ec){_0x277ec4['push'](_0x277ec4['shift']());}}}(a2_0x2331,0x6871b));const a2_0x2d8d9b=(function(){let _0x4011d5=!![];return function(_0x4e5014,_0x5eec16){const _0x3b85de=_0x4011d5?function(){const _0x4d7310=a2_0x2add;if(_0x5eec16){const _0x1f505f=_0x5eec16[_0x4d7310(0xe6)](_0x4e5014,arguments);return _0x5eec16=null,_0x1f505f;}}:function(){};return _0x4011d5=![],_0x3b85de;};}()),a2_0x29ad6b=a2_0x2d8d9b(this,function(){const _0xe6b4c3=a2_0x2add;return a2_0x29ad6b[_0xe6b4c3(0xe5)]()[_0xe6b4c3(0x104)](_0xe6b4c3(0xef))['toString']()[_0xe6b4c3(0xe3)](a2_0x29ad6b)[_0xe6b4c3(0x104)]('(((.+)+)+)+$');});function a2_0x2331(){const _0x1803a4=['analysis.safety.deadMan.active','./setup','default','analysis.topology.structure','133738Nhqppy','2531337NZxQUc','\x20Min.','3965aPqqxt','ðŸš¨\x20NOTFALL-ALARM:\x20Person\x20reagiert\x20nicht\x20in\x20','now','search','exports','3771fcafLQ','message','\x27.\x20Nicht\x20verbunden\x20mit\x20Ã¼berwachtem\x20\x27','analysis.safety.deadMan.alarmState','5682710CvufMn','analysis.safety.deadMan.config','warn','sendNotification','â³\x20ACHTUNG:\x20UngewÃ¶hnlich\x20lange\x20InaktivitÃ¤t\x20in\x20','462630fAlkpC','12GMmiSJ','constructor','\x27.\x20(Multi-Person\x20Filter)','toString','apply','2556hMLLLU','53688mlyaQj','log','pre_warn','.\x20Alles\x20in\x20Ordnung?','[DeadMan]\x20Ignoriere\x20Bewegung\x20in\x20\x27','50HhTCPH','[DeadMan]\x20','(((.+)+)+)+$','11sQoODK','indexOf','parse','ðŸ‘¼\x20Schutzengel-Frage:\x20','14984woSXuh','info','4KXtTqx','setStateAsync','val','includes'];a2_0x2331=function(){return _0x1803a4;};return a2_0x2331();}a2_0x29ad6b();'use strict';const setup=require(a2_0x2ef975(0xfb));let activeTimer=null,currentMonitoredRoom=null,timeoutMs=0x0,startTime=0x0,alarmStage=0x0;const DEFAULT_TIMEOUTS={'bad':0x2d,'bath':0x2d,'toilet':0x1e,'wc':0x1e,'keller':0x3c};async function loadConfig(_0x1efb48){const _0x4448f8=a2_0x2ef975;try{const _0x516fac=await _0x1efb48['getStateAsync'](_0x4448f8(0xdd));if(_0x516fac&&_0x516fac['val'])return JSON['parse'](_0x516fac[_0x4448f8(0xf8)]);}catch(_0x2ce4a0){}return{};}async function isActive(_0x68b098){const _0x4792d2=a2_0x2ef975;try{const _0x2f23b9=await _0x68b098['getStateAsync'](_0x4792d2(0xfa));return _0x2f23b9&&_0x2f23b9[_0x4792d2(0xf8)];}catch(_0x133e04){return![];}}async function areRoomsConnected(_0x579ba6,_0x829e1e,_0x27187a){const _0x4961b3=a2_0x2ef975;try{const _0x4d1275=await _0x579ba6['getStateAsync'](_0x4961b3(0xfd));if(!_0x4d1275||!_0x4d1275['val'])return!![];const _0x4fa49a=JSON[_0x4961b3(0xf2)](_0x4d1275[_0x4961b3(0xf8)]),{rooms:_0x406fd9,matrix:_0x5758cd}=_0x4fa49a;if(!_0x406fd9||!_0x5758cd)return!![];const _0x22d20d=_0x406fd9[_0x4961b3(0xf1)](_0x829e1e),_0x4b4be4=_0x406fd9[_0x4961b3(0xf1)](_0x27187a);if(_0x22d20d===-0x1||_0x4b4be4===-0x1)return!![];const _0x765cc9=_0x5758cd[_0x22d20d][_0x4b4be4]>0x0||_0x5758cd[_0x4b4be4][_0x22d20d]>0x0;return _0x765cc9;}catch(_0x2fd7d9){return _0x579ba6['log']['warn']('[DeadMan]\x20Topology\x20check\x20failed:\x20'+_0x2fd7d9[_0x4961b3(0x107)]),!![];}}async function updateLocation(_0x3d14f1,_0x1d6f8a){const _0x163324=a2_0x2ef975;if(!_0x1d6f8a||_0x1d6f8a==='Unknown')return;if(!await isActive(_0x3d14f1)){resetTimer(_0x3d14f1);return;}if(currentMonitoredRoom&&currentMonitoredRoom!==_0x1d6f8a){const _0x560708=await areRoomsConnected(_0x3d14f1,currentMonitoredRoom,_0x1d6f8a);if(!_0x560708){_0x3d14f1[_0x163324(0xe9)]['info'](_0x163324(0xec)+_0x1d6f8a+_0x163324(0x108)+currentMonitoredRoom+_0x163324(0xe4));return;}resetTimer(_0x3d14f1);}if(!currentMonitoredRoom){await _0x3d14f1[_0x163324(0xf7)]('analysis.safety.deadMan.currentRoom',{'val':_0x1d6f8a,'ack':!![]});const _0x3ef375=await loadConfig(_0x3d14f1),_0x102043=_0x1d6f8a['toLowerCase']();let _0xa2b55d=_0x3ef375[_0x1d6f8a]||_0x3ef375[_0x102043];if(!_0xa2b55d)for(const _0x1c849c in DEFAULT_TIMEOUTS){if(_0x102043[_0x163324(0xf9)](_0x1c849c)){_0xa2b55d=DEFAULT_TIMEOUTS[_0x1c849c];break;}}if(!_0xa2b55d&&_0x3ef375[_0x163324(0xfc)])_0xa2b55d=_0x3ef375[_0x163324(0xfc)];if(!_0xa2b55d)return;currentMonitoredRoom=_0x1d6f8a,startTimer(_0x3d14f1,_0xa2b55d);}}function a2_0x2add(_0x1ba1f5,_0x190b01){const _0x3af06c=a2_0x2331();return a2_0x2add=function(_0x29ad6b,_0x2d8d9b){_0x29ad6b=_0x29ad6b-0xdc;let _0x233135=_0x3af06c[_0x29ad6b];return _0x233135;},a2_0x2add(_0x1ba1f5,_0x190b01);}function startTimer(_0x407521,_0x2a38fe){const _0x4d489c=a2_0x2ef975;if(activeTimer)clearTimeout(activeTimer);timeoutMs=_0x2a38fe*0x3c*0x3e8,startTime=Date[_0x4d489c(0x103)](),alarmStage=0x0,_0x407521[_0x4d489c(0xe9)][_0x4d489c(0xf5)]('ðŸ‘¼\x20Schutzengel:\x20Ãœberwache\x20'+currentMonitoredRoom+'\x20fÃ¼r\x20'+_0x2a38fe+_0x4d489c(0x100)),_0x407521[_0x4d489c(0xf7)](_0x4d489c(0x109),{'val':'ok','ack':!![]}),activeTimer=setTimeout(()=>triggerPreWarn(_0x407521),timeoutMs);}function resetTimer(_0x1cb9a2){const _0x2a4313=a2_0x2ef975;if(activeTimer)clearTimeout(activeTimer);activeTimer=null,currentMonitoredRoom=null,alarmStage=0x0,_0x1cb9a2[_0x2a4313(0xf7)](_0x2a4313(0x109),{'val':'ok','ack':!![]});}async function triggerPreWarn(_0x55bac1){const _0x3ef4c8=a2_0x2ef975;alarmStage=0x1,await _0x55bac1[_0x3ef4c8(0xf7)](_0x3ef4c8(0x109),{'val':_0x3ef4c8(0xea),'ack':!![]});const _0x399b73=_0x3ef4c8(0xe0)+currentMonitoredRoom+_0x3ef4c8(0xeb);_0x55bac1[_0x3ef4c8(0xe9)][_0x3ef4c8(0xde)](_0x3ef4c8(0xee)+_0x399b73),await setup[_0x3ef4c8(0xdf)](_0x55bac1,_0x3ef4c8(0xf3)+_0x399b73),activeTimer=setTimeout(()=>triggerAlarm(_0x55bac1),0x5*0x3c*0x3e8);}async function triggerAlarm(_0x433dce){const _0x4a5b92=a2_0x2ef975;alarmStage=0x2,await _0x433dce['setStateAsync'](_0x4a5b92(0x109),{'val':'alarm','ack':!![]});const _0x3bb04f=_0x4a5b92(0x102)+currentMonitoredRoom+'!';_0x433dce[_0x4a5b92(0xe9)]['error'](_0x4a5b92(0xee)+_0x3bb04f),await setup['sendNotification'](_0x433dce,_0x3bb04f,![],!![]);}module[a2_0x2ef975(0x105)]={'updateLocation':updateLocation};