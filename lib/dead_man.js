const a2_0x4c3211=a2_0x1f43;(function(_0x46b34b,_0x5a1cd3){const _0x5e2b22=a2_0x1f43,_0x3d6ed2=_0x46b34b();while(!![]){try{const _0x32fe1a=parseInt(_0x5e2b22(0x199))/0x1+parseInt(_0x5e2b22(0x185))/0x2*(parseInt(_0x5e2b22(0x193))/0x3)+-parseInt(_0x5e2b22(0x189))/0x4*(parseInt(_0x5e2b22(0x191))/0x5)+parseInt(_0x5e2b22(0x175))/0x6+parseInt(_0x5e2b22(0x16a))/0x7*(parseInt(_0x5e2b22(0x17d))/0x8)+-parseInt(_0x5e2b22(0x16f))/0x9+parseInt(_0x5e2b22(0x16d))/0xa;if(_0x32fe1a===_0x5a1cd3)break;else _0x3d6ed2['push'](_0x3d6ed2['shift']());}catch(_0x37b53e){_0x3d6ed2['push'](_0x3d6ed2['shift']());}}}(a2_0xd88f,0x20400));const a2_0x34d8d0=(function(){let _0x4ff572=!![];return function(_0x58f019,_0x11274c){const _0xbe81e0=_0x4ff572?function(){const _0x1cbdf3=a2_0x1f43;if(_0x11274c){const _0x1d0445=_0x11274c[_0x1cbdf3(0x197)](_0x58f019,arguments);return _0x11274c=null,_0x1d0445;}}:function(){};return _0x4ff572=![],_0xbe81e0;};}()),a2_0x4e8aca=a2_0x34d8d0(this,function(){const _0x4d1afd=a2_0x1f43;return a2_0x4e8aca[_0x4d1afd(0x192)]()['search']('(((.+)+)+)+$')[_0x4d1afd(0x192)]()[_0x4d1afd(0x195)](a2_0x4e8aca)[_0x4d1afd(0x194)](_0x4d1afd(0x19b));});a2_0x4e8aca();'use strict';const setup=require(a2_0x4c3211(0x169));let activeTimer=null,currentMonitoredRoom=null,timeoutMs=0x0,startTime=0x0,alarmStage=0x0;function a2_0x1f43(_0x493e74,_0x464404){const _0x5bcd5f=a2_0xd88f();return a2_0x1f43=function(_0x4e8aca,_0x34d8d0){_0x4e8aca=_0x4e8aca-0x169;let _0xd88f13=_0x5bcd5f[_0x4e8aca];return _0xd88f13;},a2_0x1f43(_0x493e74,_0x464404);}const DEFAULT_TIMEOUTS={'bad':0x2d,'bath':0x2d,'toilet':0x1e,'wc':0x1e,'keller':0x3c,'schlaf':0x78,'bed':0x78,'guest':0x5a,'gast':0x5a};async function loadConfig(_0x9b1376){const _0xa9563a=a2_0x4c3211;try{const _0x1a3b75=await _0x9b1376[_0xa9563a(0x172)](_0xa9563a(0x17e));if(_0x1a3b75&&_0x1a3b75[_0xa9563a(0x184)])return JSON['parse'](_0x1a3b75[_0xa9563a(0x184)]);}catch(_0x5109df){}return{};}async function isActive(_0x68b3f3){const _0x170cec=a2_0x4c3211;try{const _0x6219d8=await _0x68b3f3['getStateAsync'](_0x170cec(0x18c));return _0x6219d8&&_0x6219d8['val'];}catch(_0x4a7b64){return![];}}function a2_0xd88f(){const _0x17d434=['living','message','now','1625muNNCF','toString','202473XTOLzX','search','constructor','Unknown','apply','includes','163359QZnZPR','\x20fÃ¼r\x20','(((.+)+)+)+$','bad','analysis.safety.deadMan.smartSleep','toLowerCase','[DeadMan]\x20','./setup','1785WYFMua','Ignoriere\x20Bewegung\x20in\x20\x27','getHours','160300feCZqk','alarm','1042677jxABEr','analysis.safety.deadMan.alarmState','warn','getStateAsync','ðŸš¨\x20NOTFALL-ALARM:\x20Person\x20reagiert\x20nicht\x20in\x20','\x27.\x20Nicht\x20verbunden\x20mit\x20Ã¼berwachtem\x20\x27','231858GVdhky','exports','sendNotification','log','default','bed','indexOf','schlaf','976dIYSkK','analysis.safety.deadMan.config','sofa','setStateAsync','analysis.safety.deadMan.lastIgnored','analysis.safety.deadMan.napProbability','toFixed','val','4qSmOkP','analysis.safety.deadMan.currentRoom','%).\x20VerlÃ¤ngere\x20Timer\x20fÃ¼r\x20','info','1676CUnqtP','parse','ðŸ’¤\x20Smart\x20Sleep\x20erkannt\x20(','analysis.safety.deadMan.active','ðŸ‘¼\x20Schutzengel:\x20Ãœberwache\x20'];a2_0xd88f=function(){return _0x17d434;};return a2_0xd88f();}async function areRoomsConnected(_0x161ca7,_0xe04d8e,_0x4ad065){const _0x1a3046=a2_0x4c3211;try{const _0x40d72b=await _0x161ca7[_0x1a3046(0x172)]('analysis.topology.structure');if(!_0x40d72b||!_0x40d72b['val'])return!![];const _0x27aa71=JSON[_0x1a3046(0x18a)](_0x40d72b[_0x1a3046(0x184)]),{rooms:_0x482cb9,matrix:_0x52cd1e}=_0x27aa71;if(!_0x482cb9||!_0x52cd1e)return!![];const _0x3388a0=_0x482cb9[_0x1a3046(0x17b)](_0xe04d8e),_0x49aabe=_0x482cb9[_0x1a3046(0x17b)](_0x4ad065);if(_0x3388a0===-0x1||_0x49aabe===-0x1)return!![];const _0x549d79=_0x52cd1e[_0x3388a0][_0x49aabe]>0x0||_0x52cd1e[_0x49aabe][_0x3388a0]>0x0;return _0x549d79;}catch(_0x5234b4){return _0x161ca7['log'][_0x1a3046(0x171)]('[DeadMan]\x20Topology\x20check\x20failed:\x20'+_0x5234b4[_0x1a3046(0x18f)]),!![];}}function calculateSleepProbability(_0x4750e9){const _0x1d30d3=a2_0x4c3211,_0x483765=new Date(),_0x21cb85=_0x483765[_0x1d30d3(0x16c)](),_0x5f0ada=_0x4750e9[_0x1d30d3(0x19e)]();let _0x1d747d=0.1;if(_0x21cb85>=0x17||_0x21cb85<=0x6)_0x1d747d=0x1;else{if(_0x21cb85>=0xd&&_0x21cb85<=0xf)_0x1d747d=0.8;else{if(_0x21cb85>=0x14&&_0x21cb85<=0x17)_0x1d747d=0.4;}}let _0x220f83=0.1;if(_0x5f0ada[_0x1d30d3(0x198)](_0x1d30d3(0x17c))||_0x5f0ada[_0x1d30d3(0x198)](_0x1d30d3(0x17a)))_0x220f83=0x1;else{if(_0x5f0ada[_0x1d30d3(0x198)]('wohn')||_0x5f0ada['includes'](_0x1d30d3(0x18e))||_0x5f0ada[_0x1d30d3(0x198)](_0x1d30d3(0x17f)))_0x220f83=0.6;else{if(_0x5f0ada[_0x1d30d3(0x198)](_0x1d30d3(0x19c))||_0x5f0ada[_0x1d30d3(0x198)]('wc'))_0x220f83=0.05;}}let _0x1af07a=0.5;const _0x1607cd=_0x220f83*0.5+_0x1d747d*0.3+_0x1af07a*0.2;return parseFloat(_0x1607cd[_0x1d30d3(0x183)](0x2));}async function updateLocation(_0x482e08,_0x1370ba){const _0x5675dd=a2_0x4c3211;if(!_0x1370ba||_0x1370ba===_0x5675dd(0x196))return;if(!await isActive(_0x482e08)){resetTimer(_0x482e08);return;}if(currentMonitoredRoom&&currentMonitoredRoom!==_0x1370ba){const _0x2bf471=await areRoomsConnected(_0x482e08,currentMonitoredRoom,_0x1370ba);if(!_0x2bf471){const _0x5e3fff=_0x5675dd(0x16b)+_0x1370ba+_0x5675dd(0x174)+currentMonitoredRoom+'\x27.';_0x482e08[_0x5675dd(0x178)][_0x5675dd(0x188)](_0x5675dd(0x19f)+_0x5e3fff+'\x20(Multi-Person\x20Filter)'),await _0x482e08[_0x5675dd(0x180)](_0x5675dd(0x181),{'val':JSON['stringify']({'room':_0x1370ba,'reason':_0x5e3fff,'timestamp':Date[_0x5675dd(0x190)]()}),'ack':!![]});return;}resetTimer(_0x482e08);}if(!currentMonitoredRoom){await _0x482e08['setStateAsync'](_0x5675dd(0x186),{'val':_0x1370ba,'ack':!![]});const _0x514177=await loadConfig(_0x482e08),_0x3e75aa=_0x1370ba['toLowerCase']();let _0x33f81d=_0x514177[_0x1370ba]||_0x514177[_0x3e75aa];if(!_0x33f81d)for(const _0x1589da in DEFAULT_TIMEOUTS){if(_0x3e75aa[_0x5675dd(0x198)](_0x1589da)){_0x33f81d=DEFAULT_TIMEOUTS[_0x1589da];break;}}if(!_0x33f81d&&_0x514177[_0x5675dd(0x179)])_0x33f81d=_0x514177[_0x5675dd(0x179)];if(!_0x33f81d)return;currentMonitoredRoom=_0x1370ba,startTimer(_0x482e08,_0x33f81d,_0x1370ba);}}function startTimer(_0x351d1e,_0x36632e,_0x282b5c){const _0x5864ec=a2_0x4c3211;if(activeTimer)clearTimeout(activeTimer);timeoutMs=_0x36632e*0x3c*0x3e8,startTime=Date[_0x5864ec(0x190)](),alarmStage=0x0;const _0x4036d6=calculateSleepProbability(_0x282b5c||currentMonitoredRoom),_0x14ce1e=_0x4036d6>0.65;_0x14ce1e?(timeoutMs+=0x5a*0x3c*0x3e8,_0x351d1e[_0x5864ec(0x178)]['info'](_0x5864ec(0x18b)+(_0x4036d6*0x64)[_0x5864ec(0x183)](0x0)+_0x5864ec(0x187)+currentMonitoredRoom+'\x20um\x2090\x20Min.'),_0x351d1e[_0x5864ec(0x180)](_0x5864ec(0x19d),{'val':!![],'ack':!![]})):_0x351d1e[_0x5864ec(0x180)]('analysis.safety.deadMan.smartSleep',{'val':![],'ack':!![]}),_0x351d1e['setStateAsync'](_0x5864ec(0x182),{'val':_0x4036d6,'ack':!![]}),_0x351d1e[_0x5864ec(0x178)][_0x5864ec(0x188)](_0x5864ec(0x18d)+currentMonitoredRoom+_0x5864ec(0x19a)+_0x36632e+'\x20Min.'),_0x351d1e['setStateAsync'](_0x5864ec(0x170),{'val':'ok','ack':!![]}),activeTimer=setTimeout(()=>triggerPreWarn(_0x351d1e),timeoutMs);}function resetTimer(_0x52b9e2){const _0x2b29f2=a2_0x4c3211;if(activeTimer)clearTimeout(activeTimer);activeTimer=null,currentMonitoredRoom=null,alarmStage=0x0,_0x52b9e2[_0x2b29f2(0x180)](_0x2b29f2(0x170),{'val':'ok','ack':!![]}),_0x52b9e2['setStateAsync'](_0x2b29f2(0x19d),{'val':![],'ack':!![]}),_0x52b9e2[_0x2b29f2(0x180)]('analysis.safety.deadMan.napProbability',{'val':0x0,'ack':!![]});}async function triggerPreWarn(_0x523b55){const _0x1872dc=a2_0x4c3211;alarmStage=0x1,await _0x523b55['setStateAsync'](_0x1872dc(0x170),{'val':'pre_warn','ack':!![]});const _0x147930='â³\x20ACHTUNG:\x20UngewÃ¶hnlich\x20lange\x20InaktivitÃ¤t\x20in\x20'+currentMonitoredRoom+'.\x20Alles\x20in\x20Ordnung?';_0x523b55[_0x1872dc(0x178)][_0x1872dc(0x171)]('[DeadMan]\x20'+_0x147930),await setup[_0x1872dc(0x177)](_0x523b55,'ðŸ‘¼\x20Schutzengel-Frage:\x20'+_0x147930),activeTimer=setTimeout(()=>triggerAlarm(_0x523b55),0x5*0x3c*0x3e8);}async function triggerAlarm(_0x4e7be5){const _0x3a7210=a2_0x4c3211;alarmStage=0x2,await _0x4e7be5[_0x3a7210(0x180)](_0x3a7210(0x170),{'val':_0x3a7210(0x16e),'ack':!![]});const _0x2366be=_0x3a7210(0x173)+currentMonitoredRoom+'!';_0x4e7be5[_0x3a7210(0x178)]['error'](_0x3a7210(0x19f)+_0x2366be),await setup[_0x3a7210(0x177)](_0x4e7be5,_0x2366be,![],!![]);}module[a2_0x4c3211(0x176)]={'updateLocation':updateLocation};