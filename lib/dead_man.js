const a2_0x3a15aa=a2_0x1cfe;(function(_0x2b1f37,_0x2ae588){const _0x4280d6=a2_0x1cfe,_0x4ffdd9=_0x2b1f37();while(!![]){try{const _0x3e517b=-parseInt(_0x4280d6(0x130))/0x1+parseInt(_0x4280d6(0x115))/0x2*(-parseInt(_0x4280d6(0x127))/0x3)+parseInt(_0x4280d6(0x11c))/0x4+parseInt(_0x4280d6(0x125))/0x5*(-parseInt(_0x4280d6(0x13c))/0x6)+-parseInt(_0x4280d6(0x134))/0x7+parseInt(_0x4280d6(0x11f))/0x8+parseInt(_0x4280d6(0x147))/0x9;if(_0x3e517b===_0x2ae588)break;else _0x4ffdd9['push'](_0x4ffdd9['shift']());}catch(_0x3b8df7){_0x4ffdd9['push'](_0x4ffdd9['shift']());}}}(a2_0x1a3b,0xe1d9d));const a2_0x77b0f6=(function(){let _0x1f34f7=!![];return function(_0x5d2689,_0x3511a4){const _0x5c596e=_0x1f34f7?function(){if(_0x3511a4){const _0x48ebbb=_0x3511a4['apply'](_0x5d2689,arguments);return _0x3511a4=null,_0x48ebbb;}}:function(){};return _0x1f34f7=![],_0x5c596e;};}()),a2_0x52088d=a2_0x77b0f6(this,function(){const _0x3292b6=a2_0x1cfe;return a2_0x52088d[_0x3292b6(0x146)]()[_0x3292b6(0x13e)]('(((.+)+)+)+$')[_0x3292b6(0x146)]()[_0x3292b6(0x140)](a2_0x52088d)[_0x3292b6(0x13e)](_0x3292b6(0x116));});a2_0x52088d();'use strict';const setup=require(a2_0x3a15aa(0x133));let activeTimer=null,currentMonitoredRoom=null,timeoutMs=0x0,startTime=0x0,alarmStage=0x0;const DEFAULT_TIMEOUTS={'bad':0x2d,'bath':0x2d,'toilet':0x1e,'wc':0x1e,'keller':0x3c,'schlaf':0x78,'bed':0x78,'guest':0x5a,'gast':0x5a};function a2_0x1cfe(_0x1edfb6,_0x2f2f74){const _0x2b9f86=a2_0x1a3b();return a2_0x1cfe=function(_0x52088d,_0x77b0f6){_0x52088d=_0x52088d-0x114;let _0x1a3be1=_0x2b9f86[_0x52088d];return _0x1a3be1;},a2_0x1cfe(_0x1edfb6,_0x2f2f74);}function getTimeoutRobust(_0x3358d8,_0xd1ed87){const _0xc608f5=a2_0x3a15aa;if(!_0x3358d8||!_0xd1ed87)return undefined;if(_0x3358d8[_0xd1ed87])return _0x3358d8[_0xd1ed87];const _0x41b9b0=_0xd1ed87[_0xc608f5(0x12f)]()[_0xc608f5(0x114)](/[^a-z0-9]/g,'');for(const _0x673524 in _0x3358d8){const _0x50120b=_0x673524[_0xc608f5(0x12f)]()['replace'](/[^a-z0-9]/g,'');if(_0x50120b===_0x41b9b0)return _0x3358d8[_0x673524];}const _0x18d54e=_0xd1ed87[_0xc608f5(0x12f)]();if(_0x3358d8[_0x18d54e])return _0x3358d8[_0x18d54e];return undefined;}async function loadConfig(_0x33f5f1){const _0x4d7d6f=a2_0x3a15aa;try{const _0x1ee409=await _0x33f5f1[_0x4d7d6f(0x12a)](_0x4d7d6f(0x12b));if(_0x1ee409&&_0x1ee409['val'])return JSON[_0x4d7d6f(0x149)](_0x1ee409[_0x4d7d6f(0x119)]);}catch(_0x7a95b0){}return{};}async function isActive(_0x7f3dce){const _0x29bb6f=a2_0x3a15aa;try{const _0x17b805=await _0x7f3dce[_0x29bb6f(0x12a)](_0x29bb6f(0x144));return _0x17b805&&_0x17b805[_0x29bb6f(0x119)];}catch(_0x1f0f83){return![];}}async function areRoomsConnected(_0x2406c1,_0xaf8a68,_0x22ef23){const _0x1919d5=a2_0x3a15aa;try{const _0x583738=await _0x2406c1[_0x1919d5(0x12a)]('analysis.topology.structure');if(!_0x583738||!_0x583738[_0x1919d5(0x119)])return!![];const _0x4bfa3f=JSON[_0x1919d5(0x149)](_0x583738[_0x1919d5(0x119)]),{rooms:_0x374aa6,matrix:_0x3c6140}=_0x4bfa3f;if(!_0x374aa6||!_0x3c6140)return!![];const _0x518a62=_0x374aa6[_0x1919d5(0x143)](_0xaf8a68),_0xffff66=_0x374aa6[_0x1919d5(0x143)](_0x22ef23);if(_0x518a62===-0x1||_0xffff66===-0x1)return!![];const _0x442749=_0x3c6140[_0x518a62][_0xffff66]>0x0||_0x3c6140[_0xffff66][_0x518a62]>0x0;return _0x442749;}catch(_0x2efd79){return _0x2406c1[_0x1919d5(0x135)]['warn'](_0x1919d5(0x139)+_0x2efd79['message']),!![];}}function calculateSleepProbability(_0x91672a){const _0x465649=a2_0x3a15aa,_0x3d54ab=new Date(),_0x2712b3=_0x3d54ab[_0x465649(0x123)](),_0x447354=_0x91672a[_0x465649(0x12f)]();let _0x497194=0.1;if(_0x2712b3>=0x17||_0x2712b3<=0x6)_0x497194=0x1;else{if(_0x2712b3>=0xd&&_0x2712b3<=0xf)_0x497194=0.8;else{if(_0x2712b3>=0x14&&_0x2712b3<=0x17)_0x497194=0.4;}}let _0x4f5ed2=0.1;if(_0x447354[_0x465649(0x118)](_0x465649(0x13b))||_0x447354[_0x465649(0x118)](_0x465649(0x128)))_0x4f5ed2=0x1;else{if(_0x447354['includes'](_0x465649(0x137))||_0x447354[_0x465649(0x118)](_0x465649(0x148))||_0x447354[_0x465649(0x118)]('sofa'))_0x4f5ed2=0.6;else{if(_0x447354['includes'](_0x465649(0x141))||_0x447354[_0x465649(0x118)]('wc'))_0x4f5ed2=0.05;}}let _0x1b8d25=0.5;const _0x1379fb=_0x4f5ed2*0.5+_0x497194*0.3+_0x1b8d25*0.2;return parseFloat(_0x1379fb['toFixed'](0x2));}async function updateLocation(_0x82bceb,_0x4bae2c){const _0x10f844=a2_0x3a15aa;if(!_0x4bae2c||_0x4bae2c===_0x10f844(0x145))return;if(!await isActive(_0x82bceb)){resetTimer(_0x82bceb);return;}if(currentMonitoredRoom&&currentMonitoredRoom!==_0x4bae2c){const _0x1bb935=await areRoomsConnected(_0x82bceb,currentMonitoredRoom,_0x4bae2c);if(!_0x1bb935){const _0x281d51=_0x10f844(0x11e)+_0x4bae2c+'\x27.\x20Nicht\x20verbunden\x20mit\x20Ã¼berwachtem\x20\x27'+currentMonitoredRoom+'\x27.';_0x82bceb['log'][_0x10f844(0x11b)](_0x10f844(0x129)+_0x281d51+'\x20(Multi-Person\x20Filter)'),await _0x82bceb[_0x10f844(0x14a)](_0x10f844(0x138),{'val':JSON[_0x10f844(0x124)]({'room':_0x4bae2c,'reason':_0x281d51,'timestamp':Date['now']()}),'ack':!![]});return;}resetTimer(_0x82bceb);}if(!currentMonitoredRoom){await _0x82bceb[_0x10f844(0x14a)](_0x10f844(0x11d),{'val':_0x4bae2c,'ack':!![]});const _0x10dd08=await loadConfig(_0x82bceb);let _0x2ce1f3=getTimeoutRobust(_0x10dd08,_0x4bae2c);const _0x1ef2b5=_0x4bae2c['toLowerCase']();if(!_0x2ce1f3)for(const _0x4b7064 in DEFAULT_TIMEOUTS){if(_0x1ef2b5['includes'](_0x4b7064)){_0x2ce1f3=DEFAULT_TIMEOUTS[_0x4b7064];break;}}if(!_0x2ce1f3&&_0x10dd08['default'])_0x2ce1f3=_0x10dd08['default'];if(!_0x2ce1f3)return;currentMonitoredRoom=_0x4bae2c,startTimer(_0x82bceb,_0x2ce1f3,_0x4bae2c);}}function startTimer(_0x3c3f12,_0x4a26f9,_0x330ea9){const _0x1a2380=a2_0x3a15aa;if(activeTimer)clearTimeout(activeTimer);timeoutMs=_0x4a26f9*0x3c*0x3e8,startTime=Date[_0x1a2380(0x132)](),alarmStage=0x0;const _0x1d81ed=calculateSleepProbability(_0x330ea9||currentMonitoredRoom),_0x4a5feb=_0x1d81ed>0.65;_0x4a5feb?(timeoutMs+=0x5a*0x3c*0x3e8,_0x3c3f12[_0x1a2380(0x135)][_0x1a2380(0x11b)](_0x1a2380(0x13d)+(_0x1d81ed*0x64)[_0x1a2380(0x122)](0x0)+'%).\x20VerlÃ¤ngere\x20Timer\x20fÃ¼r\x20'+currentMonitoredRoom+_0x1a2380(0x12c)),_0x3c3f12['setStateAsync'](_0x1a2380(0x131),{'val':!![],'ack':!![]})):_0x3c3f12[_0x1a2380(0x14a)]('analysis.safety.deadMan.smartSleep',{'val':![],'ack':!![]}),_0x3c3f12[_0x1a2380(0x14a)](_0x1a2380(0x136),{'val':_0x1d81ed,'ack':!![]}),_0x3c3f12['log']['info'](_0x1a2380(0x121)+currentMonitoredRoom+'\x20fÃ¼r\x20'+_0x4a26f9+_0x1a2380(0x117)),_0x3c3f12['setStateAsync'](_0x1a2380(0x12d),{'val':'ok','ack':!![]}),activeTimer=setTimeout(()=>triggerPreWarn(_0x3c3f12),timeoutMs);}function resetTimer(_0x579460){const _0xf028d0=a2_0x3a15aa;if(activeTimer)clearTimeout(activeTimer);activeTimer=null,currentMonitoredRoom=null,alarmStage=0x0,_0x579460[_0xf028d0(0x14a)](_0xf028d0(0x12d),{'val':'ok','ack':!![]}),_0x579460[_0xf028d0(0x14a)](_0xf028d0(0x131),{'val':![],'ack':!![]}),_0x579460[_0xf028d0(0x14a)](_0xf028d0(0x136),{'val':0x0,'ack':!![]});}function a2_0x1a3b(){const _0x2b5b40=['now','./setup','2826971YEzmEk','log','analysis.safety.deadMan.napProbability','wohn','analysis.safety.deadMan.lastIgnored','[DeadMan]\x20Topology\x20check\x20failed:\x20','exports','schlaf','66552HtCMPB','ðŸ’¤\x20Smart\x20Sleep\x20erkannt\x20(','search','â³\x20ACHTUNG:\x20UngewÃ¶hnlich\x20lange\x20InaktivitÃ¤t\x20in\x20','constructor','bad','ðŸ‘¼\x20Schutzengel-Frage:\x20','indexOf','analysis.safety.deadMan.active','Unknown','toString','1748349pUDbFN','living','parse','setStateAsync','replace','8938GFLvVH','(((.+)+)+)+$','\x20Min.','includes','val','error','info','2808236ACrdjn','analysis.safety.deadMan.currentRoom','Ignoriere\x20Bewegung\x20in\x20\x27','13590056SEyLKu','.\x20Alles\x20in\x20Ordnung?','ðŸ‘¼\x20Schutzengel:\x20Ãœberwache\x20','toFixed','getHours','stringify','45lhFTqV','pre_warn','453wREeXo','bed','[DeadMan]\x20','getStateAsync','analysis.safety.deadMan.config','\x20um\x2090\x20Min.','analysis.safety.deadMan.alarmState','sendNotification','toLowerCase','491492FjTiwx','analysis.safety.deadMan.smartSleep'];a2_0x1a3b=function(){return _0x2b5b40;};return a2_0x1a3b();}async function triggerPreWarn(_0x5461f7){const _0x576255=a2_0x3a15aa;alarmStage=0x1,await _0x5461f7[_0x576255(0x14a)](_0x576255(0x12d),{'val':_0x576255(0x126),'ack':!![]});const _0x27ef17=_0x576255(0x13f)+currentMonitoredRoom+_0x576255(0x120);_0x5461f7[_0x576255(0x135)]['warn']('[DeadMan]\x20'+_0x27ef17),await setup['sendNotification'](_0x5461f7,_0x576255(0x142)+_0x27ef17),activeTimer=setTimeout(()=>triggerAlarm(_0x5461f7),0x5*0x3c*0x3e8);}async function triggerAlarm(_0x4ad4a2){const _0x720087=a2_0x3a15aa;alarmStage=0x2,await _0x4ad4a2[_0x720087(0x14a)](_0x720087(0x12d),{'val':'alarm','ack':!![]});const _0xccfc1b='ðŸš¨\x20NOTFALL-ALARM:\x20Person\x20reagiert\x20nicht\x20in\x20'+currentMonitoredRoom+'!';_0x4ad4a2[_0x720087(0x135)][_0x720087(0x11a)](_0x720087(0x129)+_0xccfc1b),await setup[_0x720087(0x12e)](_0x4ad4a2,_0xccfc1b,![],!![]);}module[a2_0x3a15aa(0x13a)]={'updateLocation':updateLocation};