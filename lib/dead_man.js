const a2_0x39fcf4=a2_0x4bc8;(function(_0x12b4ac,_0x100304){const _0x5c4f8a=a2_0x4bc8,_0x59914a=_0x12b4ac();while(!![]){try{const _0x28697d=-parseInt(_0x5c4f8a(0x162))/0x1*(parseInt(_0x5c4f8a(0x146))/0x2)+-parseInt(_0x5c4f8a(0x14e))/0x3+-parseInt(_0x5c4f8a(0x15c))/0x4+parseInt(_0x5c4f8a(0x15f))/0x5+parseInt(_0x5c4f8a(0x145))/0x6+parseInt(_0x5c4f8a(0x165))/0x7*(-parseInt(_0x5c4f8a(0x149))/0x8)+parseInt(_0x5c4f8a(0x14f))/0x9;if(_0x28697d===_0x100304)break;else _0x59914a['push'](_0x59914a['shift']());}catch(_0x5429dd){_0x59914a['push'](_0x59914a['shift']());}}}(a2_0x541d,0x682f3));function a2_0x541d(){const _0x4792ba=['sendNotification','default','16rPlfLK','sofa','\x27.\x20Nicht\x20verbunden\x20mit\x20Ã¼berwachtem\x20\x27','val','toLowerCase','148644iwJizS','9756792JuqEOt','info','(((.+)+)+)+$','message','%).\x20VerlÃ¤ngere\x20Timer\x20fÃ¼r\x20','wohn','apply','warn','getHours','bed','indexOf','parse','alarm','2046496mtwGCV','setStateAsync','schlaf','2432975gKvykd','\x20(Multi-Person\x20Filter)','constructor','635298zpcVXA','[DeadMan]\x20Topology\x20check\x20failed:\x20','toFixed','1940778RGRjJW','\x20Min.','toString','analysis.safety.deadMan.active','stringify','â³\x20ACHTUNG:\x20UngewÃ¶hnlich\x20lange\x20InaktivitÃ¤t\x20in\x20','log','bad','Unknown','\x20fÃ¼r\x20','includes','analysis.safety.deadMan.smartSleep','analysis.topology.structure','analysis.safety.deadMan.alarmState','error','exports','ðŸ‘¼\x20Schutzengel:\x20Ãœberwache\x20','[DeadMan]\x20','getStateAsync','analysis.safety.deadMan.napProbability','search','now','3642204CpgskP','2gXIwiz'];a2_0x541d=function(){return _0x4792ba;};return a2_0x541d();}const a2_0x1cca9e=(function(){let _0xd25c50=!![];return function(_0x57ca4f,_0x5e4a9d){const _0x5332d6=_0xd25c50?function(){const _0x384f38=a2_0x4bc8;if(_0x5e4a9d){const _0x3ead3a=_0x5e4a9d[_0x384f38(0x155)](_0x57ca4f,arguments);return _0x5e4a9d=null,_0x3ead3a;}}:function(){};return _0xd25c50=![],_0x5332d6;};}()),a2_0x3a4f8b=a2_0x1cca9e(this,function(){const _0x49b0e1=a2_0x4bc8;return a2_0x3a4f8b[_0x49b0e1(0x167)]()[_0x49b0e1(0x143)](_0x49b0e1(0x151))[_0x49b0e1(0x167)]()[_0x49b0e1(0x161)](a2_0x3a4f8b)[_0x49b0e1(0x143)](_0x49b0e1(0x151));});a2_0x3a4f8b();'use strict';const setup=require('./setup');let activeTimer=null,currentMonitoredRoom=null,timeoutMs=0x0,startTime=0x0,alarmStage=0x0;function a2_0x4bc8(_0x2dc991,_0x1824ce){const _0x3f5c50=a2_0x541d();return a2_0x4bc8=function(_0x3a4f8b,_0x1cca9e){_0x3a4f8b=_0x3a4f8b-0x142;let _0x541d4a=_0x3f5c50[_0x3a4f8b];return _0x541d4a;},a2_0x4bc8(_0x2dc991,_0x1824ce);}const DEFAULT_TIMEOUTS={'bad':0x2d,'bath':0x2d,'toilet':0x1e,'wc':0x1e,'keller':0x3c,'schlaf':0x78,'bed':0x78,'guest':0x5a,'gast':0x5a};async function loadConfig(_0x5e8da6){const _0x477a22=a2_0x4bc8;try{const _0x1b0775=await _0x5e8da6[_0x477a22(0x177)]('analysis.safety.deadMan.config');if(_0x1b0775&&_0x1b0775['val'])return JSON[_0x477a22(0x15a)](_0x1b0775[_0x477a22(0x14c)]);}catch(_0x111893){}return{};}async function isActive(_0x1ef35c){const _0x237c15=a2_0x4bc8;try{const _0x4ac18f=await _0x1ef35c[_0x237c15(0x177)](_0x237c15(0x168));return _0x4ac18f&&_0x4ac18f[_0x237c15(0x14c)];}catch(_0x598d8f){return![];}}async function areRoomsConnected(_0x5f12d9,_0x29e56e,_0x547fe7){const _0x233477=a2_0x4bc8;try{const _0x4557bb=await _0x5f12d9[_0x233477(0x177)](_0x233477(0x171));if(!_0x4557bb||!_0x4557bb[_0x233477(0x14c)])return!![];const _0x3b250c=JSON[_0x233477(0x15a)](_0x4557bb[_0x233477(0x14c)]),{rooms:_0xd965d0,matrix:_0x562e5c}=_0x3b250c;if(!_0xd965d0||!_0x562e5c)return!![];const _0x3c15ce=_0xd965d0[_0x233477(0x159)](_0x29e56e),_0x2859b2=_0xd965d0[_0x233477(0x159)](_0x547fe7);if(_0x3c15ce===-0x1||_0x2859b2===-0x1)return!![];const _0x2133e7=_0x562e5c[_0x3c15ce][_0x2859b2]>0x0||_0x562e5c[_0x2859b2][_0x3c15ce]>0x0;return _0x2133e7;}catch(_0x42a10c){return _0x5f12d9[_0x233477(0x16b)][_0x233477(0x156)](_0x233477(0x163)+_0x42a10c[_0x233477(0x152)]),!![];}}function calculateSleepProbability(_0x5999f0){const _0x30e7df=a2_0x4bc8,_0x32e1e9=new Date(),_0x434974=_0x32e1e9[_0x30e7df(0x157)](),_0x228915=_0x5999f0['toLowerCase']();let _0x5e2779=0.1;if(_0x434974>=0x17||_0x434974<=0x6)_0x5e2779=0x1;else{if(_0x434974>=0xd&&_0x434974<=0xf)_0x5e2779=0.8;else{if(_0x434974>=0x14&&_0x434974<=0x17)_0x5e2779=0.4;}}let _0x37f042=0.1;if(_0x228915[_0x30e7df(0x16f)](_0x30e7df(0x15e))||_0x228915[_0x30e7df(0x16f)](_0x30e7df(0x158)))_0x37f042=0x1;else{if(_0x228915[_0x30e7df(0x16f)](_0x30e7df(0x154))||_0x228915['includes']('living')||_0x228915[_0x30e7df(0x16f)](_0x30e7df(0x14a)))_0x37f042=0.6;else{if(_0x228915[_0x30e7df(0x16f)](_0x30e7df(0x16c))||_0x228915['includes']('wc'))_0x37f042=0.05;}}let _0x498adf=0.5;const _0x42d66d=_0x37f042*0.5+_0x5e2779*0.3+_0x498adf*0.2;return parseFloat(_0x42d66d['toFixed'](0x2));}async function updateLocation(_0x64beab,_0x3f006f){const _0x18878f=a2_0x4bc8;if(!_0x3f006f||_0x3f006f===_0x18878f(0x16d))return;if(!await isActive(_0x64beab)){resetTimer(_0x64beab);return;}if(currentMonitoredRoom&&currentMonitoredRoom!==_0x3f006f){const _0x548bc4=await areRoomsConnected(_0x64beab,currentMonitoredRoom,_0x3f006f);if(!_0x548bc4){const _0x2b552d='Ignoriere\x20Bewegung\x20in\x20\x27'+_0x3f006f+_0x18878f(0x14b)+currentMonitoredRoom+'\x27.';_0x64beab[_0x18878f(0x16b)][_0x18878f(0x150)](_0x18878f(0x176)+_0x2b552d+_0x18878f(0x160)),await _0x64beab[_0x18878f(0x15d)]('analysis.safety.deadMan.lastIgnored',{'val':JSON[_0x18878f(0x169)]({'room':_0x3f006f,'reason':_0x2b552d,'timestamp':Date[_0x18878f(0x144)]()}),'ack':!![]});return;}resetTimer(_0x64beab);}if(!currentMonitoredRoom){await _0x64beab[_0x18878f(0x15d)]('analysis.safety.deadMan.currentRoom',{'val':_0x3f006f,'ack':!![]});const _0x33ba6b=await loadConfig(_0x64beab),_0x1f1b51=_0x3f006f[_0x18878f(0x14d)]();let _0x3e074d=_0x33ba6b[_0x3f006f]||_0x33ba6b[_0x1f1b51];if(!_0x3e074d)for(const _0x3ad7bb in DEFAULT_TIMEOUTS){if(_0x1f1b51[_0x18878f(0x16f)](_0x3ad7bb)){_0x3e074d=DEFAULT_TIMEOUTS[_0x3ad7bb];break;}}if(!_0x3e074d&&_0x33ba6b[_0x18878f(0x148)])_0x3e074d=_0x33ba6b[_0x18878f(0x148)];if(!_0x3e074d)return;currentMonitoredRoom=_0x3f006f,startTimer(_0x64beab,_0x3e074d,_0x3f006f);}}function startTimer(_0x3a374d,_0x3d5134,_0x5856ee){const _0x69c1b2=a2_0x4bc8;if(activeTimer)clearTimeout(activeTimer);timeoutMs=_0x3d5134*0x3c*0x3e8,startTime=Date[_0x69c1b2(0x144)](),alarmStage=0x0;const _0x2bb215=calculateSleepProbability(_0x5856ee||currentMonitoredRoom),_0x317966=_0x2bb215>0.65;_0x317966?(timeoutMs+=0x5a*0x3c*0x3e8,_0x3a374d[_0x69c1b2(0x16b)][_0x69c1b2(0x150)]('ðŸ’¤\x20Smart\x20Sleep\x20erkannt\x20('+(_0x2bb215*0x64)[_0x69c1b2(0x164)](0x0)+_0x69c1b2(0x153)+currentMonitoredRoom+'\x20um\x2090\x20Min.'),_0x3a374d['setStateAsync'](_0x69c1b2(0x170),{'val':!![],'ack':!![]})):_0x3a374d[_0x69c1b2(0x15d)](_0x69c1b2(0x170),{'val':![],'ack':!![]}),_0x3a374d[_0x69c1b2(0x15d)](_0x69c1b2(0x142),{'val':_0x2bb215,'ack':!![]}),_0x3a374d[_0x69c1b2(0x16b)][_0x69c1b2(0x150)](_0x69c1b2(0x175)+currentMonitoredRoom+_0x69c1b2(0x16e)+_0x3d5134+_0x69c1b2(0x166)),_0x3a374d[_0x69c1b2(0x15d)]('analysis.safety.deadMan.alarmState',{'val':'ok','ack':!![]}),activeTimer=setTimeout(()=>triggerPreWarn(_0x3a374d),timeoutMs);}function resetTimer(_0x22e050){const _0x5bf337=a2_0x4bc8;if(activeTimer)clearTimeout(activeTimer);activeTimer=null,currentMonitoredRoom=null,alarmStage=0x0,_0x22e050[_0x5bf337(0x15d)]('analysis.safety.deadMan.alarmState',{'val':'ok','ack':!![]}),_0x22e050['setStateAsync'](_0x5bf337(0x170),{'val':![],'ack':!![]}),_0x22e050['setStateAsync']('analysis.safety.deadMan.napProbability',{'val':0x0,'ack':!![]});}async function triggerPreWarn(_0x5bf5d8){const _0x25cb46=a2_0x4bc8;alarmStage=0x1,await _0x5bf5d8[_0x25cb46(0x15d)](_0x25cb46(0x172),{'val':'pre_warn','ack':!![]});const _0x1ea43e=_0x25cb46(0x16a)+currentMonitoredRoom+'.\x20Alles\x20in\x20Ordnung?';_0x5bf5d8[_0x25cb46(0x16b)][_0x25cb46(0x156)](_0x25cb46(0x176)+_0x1ea43e),await setup[_0x25cb46(0x147)](_0x5bf5d8,'ðŸ‘¼\x20Schutzengel-Frage:\x20'+_0x1ea43e),activeTimer=setTimeout(()=>triggerAlarm(_0x5bf5d8),0x5*0x3c*0x3e8);}async function triggerAlarm(_0x4572cd){const _0x2d8e6a=a2_0x4bc8;alarmStage=0x2,await _0x4572cd[_0x2d8e6a(0x15d)](_0x2d8e6a(0x172),{'val':_0x2d8e6a(0x15b),'ack':!![]});const _0x26d84d='ðŸš¨\x20NOTFALL-ALARM:\x20Person\x20reagiert\x20nicht\x20in\x20'+currentMonitoredRoom+'!';_0x4572cd[_0x2d8e6a(0x16b)][_0x2d8e6a(0x173)](_0x2d8e6a(0x176)+_0x26d84d),await setup[_0x2d8e6a(0x147)](_0x4572cd,_0x26d84d,![],!![]);}module[a2_0x39fcf4(0x174)]={'updateLocation':updateLocation};