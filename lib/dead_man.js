const a2_0x333a37=a2_0x3709;(function(_0x16dffb,_0x27b110){const _0xf16e41=a2_0x3709,_0x159677=_0x16dffb();while(!![]){try{const _0x136470=parseInt(_0xf16e41(0x142))/0x1+-parseInt(_0xf16e41(0x16e))/0x2+-parseInt(_0xf16e41(0x167))/0x3*(parseInt(_0xf16e41(0x16f))/0x4)+-parseInt(_0xf16e41(0x161))/0x5*(-parseInt(_0xf16e41(0x148))/0x6)+-parseInt(_0xf16e41(0x166))/0x7*(-parseInt(_0xf16e41(0x143))/0x8)+parseInt(_0xf16e41(0x141))/0x9*(parseInt(_0xf16e41(0x150))/0xa)+-parseInt(_0xf16e41(0x13f))/0xb;if(_0x136470===_0x27b110)break;else _0x159677['push'](_0x159677['shift']());}catch(_0x12eeb6){_0x159677['push'](_0x159677['shift']());}}}(a2_0xdb30,0x31f7e));const a2_0x2e8d0a=(function(){let _0x5de4a3=!![];return function(_0x43192e,_0x4b8193){const _0x1daa04=_0x5de4a3?function(){const _0x1557a7=a2_0x3709;if(_0x4b8193){const _0x454c12=_0x4b8193[_0x1557a7(0x15a)](_0x43192e,arguments);return _0x4b8193=null,_0x454c12;}}:function(){};return _0x5de4a3=![],_0x1daa04;};}()),a2_0x32e309=a2_0x2e8d0a(this,function(){const _0x41bd35=a2_0x3709;return a2_0x32e309[_0x41bd35(0x152)]()[_0x41bd35(0x160)](_0x41bd35(0x14f))['toString']()['constructor'](a2_0x32e309)[_0x41bd35(0x160)](_0x41bd35(0x14f));});a2_0x32e309();'use strict';const setup=require(a2_0x333a37(0x14b));let activeTimer=null,currentMonitoredRoom=null,timeoutMs=0x0,startTime=0x0,alarmStage=0x0;const DEFAULT_TIMEOUTS={'bad':0x2d,'bath':0x2d,'toilet':0x1e,'wc':0x1e,'keller':0x3c,'schlaf':0x78,'bed':0x78,'guest':0x5a,'gast':0x5a};function a2_0xdb30(){const _0x288477=['96PJlMDI','now','\x20Min.','sendNotification','analysis.safety.deadMan.currentRoom','12olDoJK','warn','bad','./setup','toFixed','bed','pre_warn','(((.+)+)+)+$','234490EmyJPQ','error','toString','setStateAsync','.\x20Alles\x20in\x20Ordnung?','\x20fÃ¼r\x20','info','Ignoriere\x20Bewegung\x20in\x20\x27','analysis.safety.deadMan.napProbability','analysis.safety.deadMan.alarmState','apply','analysis.safety.deadMan.active','analysis.safety.deadMan.smartSleep','sofa','parse','schlaf','search','795485onURvi','ðŸ’¤\x20Smart\x20Sleep\x20erkannt\x20(','analysis.safety.deadMan.lastIgnored','living','includes','215320vKYYkG','34836tIxImi','[DeadMan]\x20','ðŸ‘¼\x20Schutzengel:\x20Ãœberwache\x20','analysis.topology.structure','\x27.\x20Nicht\x20verbunden\x20mit\x20Ã¼berwachtem\x20\x27','analysis.safety.deadMan.config','ðŸ‘¼\x20Schutzengel-Frage:\x20','481894SszuSC','68dCGjsJ','getStateAsync','alarm','val','message','log','\x20um\x2090\x20Min.','toLowerCase','default','5541250pfVnae','indexOf','144hnnvdS','84273vwusxF'];a2_0xdb30=function(){return _0x288477;};return a2_0xdb30();}async function loadConfig(_0x276f43){const _0x596e08=a2_0x333a37;try{const _0x2434e0=await _0x276f43[_0x596e08(0x170)](_0x596e08(0x16c));if(_0x2434e0&&_0x2434e0['val'])return JSON['parse'](_0x2434e0[_0x596e08(0x172)]);}catch(_0x4af735){}return{};}async function isActive(_0x88d1f7){const _0x2b7b54=a2_0x333a37;try{const _0x2f860d=await _0x88d1f7['getStateAsync'](_0x2b7b54(0x15b));return _0x2f860d&&_0x2f860d[_0x2b7b54(0x172)];}catch(_0xcef360){return![];}}async function areRoomsConnected(_0x5a53a3,_0x20c6f7,_0x585afc){const _0x3c820e=a2_0x333a37;try{const _0x546c64=await _0x5a53a3['getStateAsync'](_0x3c820e(0x16a));if(!_0x546c64||!_0x546c64[_0x3c820e(0x172)])return!![];const _0x226653=JSON[_0x3c820e(0x15e)](_0x546c64[_0x3c820e(0x172)]),{rooms:_0xc7ddfd,matrix:_0x33ec80}=_0x226653;if(!_0xc7ddfd||!_0x33ec80)return!![];const _0x3bd2c2=_0xc7ddfd['indexOf'](_0x20c6f7),_0x2f0cd4=_0xc7ddfd[_0x3c820e(0x140)](_0x585afc);if(_0x3bd2c2===-0x1||_0x2f0cd4===-0x1)return!![];const _0x16b8c7=_0x33ec80[_0x3bd2c2][_0x2f0cd4]>0x0||_0x33ec80[_0x2f0cd4][_0x3bd2c2]>0x0;return _0x16b8c7;}catch(_0x127c01){return _0x5a53a3[_0x3c820e(0x174)][_0x3c820e(0x149)]('[DeadMan]\x20Topology\x20check\x20failed:\x20'+_0x127c01[_0x3c820e(0x173)]),!![];}}function calculateSleepProbability(_0x381cc8){const _0x157fcb=a2_0x333a37,_0x2c6ea2=new Date(),_0x532c91=_0x2c6ea2['getHours'](),_0x470c5a=_0x381cc8['toLowerCase']();let _0x63ac77=0.1;if(_0x532c91>=0x17||_0x532c91<=0x6)_0x63ac77=0x1;else{if(_0x532c91>=0xd&&_0x532c91<=0xf)_0x63ac77=0.8;else{if(_0x532c91>=0x14&&_0x532c91<=0x17)_0x63ac77=0.4;}}let _0x1d3ce4=0.1;if(_0x470c5a[_0x157fcb(0x165)](_0x157fcb(0x15f))||_0x470c5a[_0x157fcb(0x165)](_0x157fcb(0x14d)))_0x1d3ce4=0x1;else{if(_0x470c5a[_0x157fcb(0x165)]('wohn')||_0x470c5a[_0x157fcb(0x165)](_0x157fcb(0x164))||_0x470c5a['includes'](_0x157fcb(0x15d)))_0x1d3ce4=0.6;else{if(_0x470c5a['includes'](_0x157fcb(0x14a))||_0x470c5a[_0x157fcb(0x165)]('wc'))_0x1d3ce4=0.05;}}let _0x2eac6e=0.5;const _0xd0e10=_0x1d3ce4*0.5+_0x63ac77*0.3+_0x2eac6e*0.2;return parseFloat(_0xd0e10[_0x157fcb(0x14c)](0x2));}async function updateLocation(_0x4a1104,_0x436ea7){const _0x3503de=a2_0x333a37;if(!_0x436ea7||_0x436ea7==='Unknown')return;if(!await isActive(_0x4a1104)){resetTimer(_0x4a1104);return;}if(currentMonitoredRoom&&currentMonitoredRoom!==_0x436ea7){const _0x1f2cb2=await areRoomsConnected(_0x4a1104,currentMonitoredRoom,_0x436ea7);if(!_0x1f2cb2){const _0x13f01f=_0x3503de(0x157)+_0x436ea7+_0x3503de(0x16b)+currentMonitoredRoom+'\x27.';_0x4a1104[_0x3503de(0x174)][_0x3503de(0x156)](_0x3503de(0x168)+_0x13f01f+'\x20(Multi-Person\x20Filter)'),await _0x4a1104[_0x3503de(0x153)](_0x3503de(0x163),{'val':JSON['stringify']({'room':_0x436ea7,'reason':_0x13f01f,'timestamp':Date[_0x3503de(0x144)]()}),'ack':!![]});return;}resetTimer(_0x4a1104);}if(!currentMonitoredRoom){await _0x4a1104['setStateAsync'](_0x3503de(0x147),{'val':_0x436ea7,'ack':!![]});const _0x89f07b=await loadConfig(_0x4a1104),_0x7d39f2=_0x436ea7[_0x3503de(0x13d)]();let _0x4d4f45=_0x89f07b[_0x436ea7]||_0x89f07b[_0x7d39f2];if(!_0x4d4f45)for(const _0x3cdfe3 in DEFAULT_TIMEOUTS){if(_0x7d39f2['includes'](_0x3cdfe3)){_0x4d4f45=DEFAULT_TIMEOUTS[_0x3cdfe3];break;}}if(!_0x4d4f45&&_0x89f07b[_0x3503de(0x13e)])_0x4d4f45=_0x89f07b['default'];if(!_0x4d4f45)return;currentMonitoredRoom=_0x436ea7,startTimer(_0x4a1104,_0x4d4f45,_0x436ea7);}}function a2_0x3709(_0x441ace,_0x36fb43){const _0x5aed6f=a2_0xdb30();return a2_0x3709=function(_0x32e309,_0x2e8d0a){_0x32e309=_0x32e309-0x13c;let _0xdb3030=_0x5aed6f[_0x32e309];return _0xdb3030;},a2_0x3709(_0x441ace,_0x36fb43);}function startTimer(_0x36222b,_0x39ad33,_0xb30cdf){const _0x1dee71=a2_0x333a37;if(activeTimer)clearTimeout(activeTimer);timeoutMs=_0x39ad33*0x3c*0x3e8,startTime=Date['now'](),alarmStage=0x0;const _0x175b5a=calculateSleepProbability(_0xb30cdf||currentMonitoredRoom),_0x24244c=_0x175b5a>0.65;_0x24244c?(timeoutMs+=0x5a*0x3c*0x3e8,_0x36222b[_0x1dee71(0x174)]['info'](_0x1dee71(0x162)+(_0x175b5a*0x64)[_0x1dee71(0x14c)](0x0)+'%).\x20VerlÃ¤ngere\x20Timer\x20fÃ¼r\x20'+currentMonitoredRoom+_0x1dee71(0x13c)),_0x36222b[_0x1dee71(0x153)](_0x1dee71(0x15c),{'val':!![],'ack':!![]})):_0x36222b[_0x1dee71(0x153)](_0x1dee71(0x15c),{'val':![],'ack':!![]}),_0x36222b[_0x1dee71(0x153)](_0x1dee71(0x158),{'val':_0x175b5a,'ack':!![]}),_0x36222b[_0x1dee71(0x174)][_0x1dee71(0x156)](_0x1dee71(0x169)+currentMonitoredRoom+_0x1dee71(0x155)+_0x39ad33+_0x1dee71(0x145)),_0x36222b[_0x1dee71(0x153)](_0x1dee71(0x159),{'val':'ok','ack':!![]}),activeTimer=setTimeout(()=>triggerPreWarn(_0x36222b),timeoutMs);}function resetTimer(_0x3cbcf5){const _0x23788b=a2_0x333a37;if(activeTimer)clearTimeout(activeTimer);activeTimer=null,currentMonitoredRoom=null,alarmStage=0x0,_0x3cbcf5['setStateAsync']('analysis.safety.deadMan.alarmState',{'val':'ok','ack':!![]}),_0x3cbcf5[_0x23788b(0x153)]('analysis.safety.deadMan.smartSleep',{'val':![],'ack':!![]}),_0x3cbcf5['setStateAsync'](_0x23788b(0x158),{'val':0x0,'ack':!![]});}async function triggerPreWarn(_0x29eab3){const _0x200f3e=a2_0x333a37;alarmStage=0x1,await _0x29eab3['setStateAsync']('analysis.safety.deadMan.alarmState',{'val':_0x200f3e(0x14e),'ack':!![]});const _0x3fa8c3='â³\x20ACHTUNG:\x20UngewÃ¶hnlich\x20lange\x20InaktivitÃ¤t\x20in\x20'+currentMonitoredRoom+_0x200f3e(0x154);_0x29eab3['log'][_0x200f3e(0x149)]('[DeadMan]\x20'+_0x3fa8c3),await setup[_0x200f3e(0x146)](_0x29eab3,_0x200f3e(0x16d)+_0x3fa8c3),activeTimer=setTimeout(()=>triggerAlarm(_0x29eab3),0x5*0x3c*0x3e8);}async function triggerAlarm(_0x2f07ed){const _0x559d3a=a2_0x333a37;alarmStage=0x2,await _0x2f07ed[_0x559d3a(0x153)](_0x559d3a(0x159),{'val':_0x559d3a(0x171),'ack':!![]});const _0x320aef='ðŸš¨\x20NOTFALL-ALARM:\x20Person\x20reagiert\x20nicht\x20in\x20'+currentMonitoredRoom+'!';_0x2f07ed[_0x559d3a(0x174)][_0x559d3a(0x151)]('[DeadMan]\x20'+_0x320aef),await setup[_0x559d3a(0x146)](_0x2f07ed,_0x320aef,![],!![]);}module['exports']={'updateLocation':updateLocation};