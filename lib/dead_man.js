const a2_0x359b04=a2_0x430b;(function(_0x2ef8eb,_0x3752b6){const _0x5ca616=a2_0x430b,_0x2c2e7b=_0x2ef8eb();while(!![]){try{const _0x4ccccb=-parseInt(_0x5ca616(0x152))/0x1*(-parseInt(_0x5ca616(0x165))/0x2)+parseInt(_0x5ca616(0x14a))/0x3*(parseInt(_0x5ca616(0x15f))/0x4)+parseInt(_0x5ca616(0x148))/0x5+parseInt(_0x5ca616(0x15d))/0x6*(-parseInt(_0x5ca616(0x167))/0x7)+parseInt(_0x5ca616(0x16f))/0x8+parseInt(_0x5ca616(0x171))/0x9+-parseInt(_0x5ca616(0x155))/0xa;if(_0x4ccccb===_0x3752b6)break;else _0x2c2e7b['push'](_0x2c2e7b['shift']());}catch(_0xdbde51){_0x2c2e7b['push'](_0x2c2e7b['shift']());}}}(a2_0x2242,0xbda21));const a2_0x3eef97=(function(){let _0x50943a=!![];return function(_0x471d79,_0x5f765c){const _0x3bbcea=_0x50943a?function(){const _0x56bb88=a2_0x430b;if(_0x5f765c){const _0x34437a=_0x5f765c[_0x56bb88(0x160)](_0x471d79,arguments);return _0x5f765c=null,_0x34437a;}}:function(){};return _0x50943a=![],_0x3bbcea;};}()),a2_0x47d4dc=a2_0x3eef97(this,function(){const _0x4e9444=a2_0x430b;return a2_0x47d4dc[_0x4e9444(0x173)]()[_0x4e9444(0x164)](_0x4e9444(0x163))[_0x4e9444(0x173)]()[_0x4e9444(0x170)](a2_0x47d4dc)[_0x4e9444(0x164)](_0x4e9444(0x163));});a2_0x47d4dc();'use strict';const setup=require(a2_0x359b04(0x176));let activeTimer=null,currentMonitoredRoom=null,timeoutMs=0x0,startTime=0x0,alarmStage=0x0;const DEFAULT_TIMEOUTS={'bad':0x2d,'bath':0x2d,'toilet':0x1e,'wc':0x1e,'keller':0x3c,'schlaf':0x78,'bed':0x78,'guest':0x5a,'gast':0x5a};function getTimeoutRobust(_0x29fc1c,_0x50741d){const _0x15ac72=a2_0x359b04;if(!_0x29fc1c||!_0x50741d)return undefined;if(_0x29fc1c[_0x50741d])return _0x29fc1c[_0x50741d];const _0x25e892=_0x50741d[_0x15ac72(0x147)]()[_0x15ac72(0x142)](/[^a-z0-9]/g,'');for(const _0x1af585 in _0x29fc1c){const _0x46215e=_0x1af585[_0x15ac72(0x147)]()['replace'](/[^a-z0-9]/g,'');if(_0x46215e===_0x25e892)return _0x29fc1c[_0x1af585];}const _0x382e82=_0x50741d[_0x15ac72(0x147)]();if(_0x29fc1c[_0x382e82])return _0x29fc1c[_0x382e82];return undefined;}async function loadConfig(_0x564648){const _0x1a9c24=a2_0x359b04;try{const _0x5938a1=await _0x564648['getStateAsync'](_0x1a9c24(0x169));if(_0x5938a1&&_0x5938a1[_0x1a9c24(0x175)])return JSON[_0x1a9c24(0x15c)](_0x5938a1['val']);}catch(_0x509fd6){}return{};}async function isActive(_0x46212f){const _0x36da1f=a2_0x359b04;try{const _0x1fe3f7=await _0x46212f['getStateAsync'](_0x36da1f(0x179));return _0x1fe3f7&&_0x1fe3f7[_0x36da1f(0x175)];}catch(_0x4b5a9a){return![];}}async function areRoomsConnected(_0x15627a,_0x5aaf84,_0x277f92){const _0x41fc8c=a2_0x359b04;try{const _0x231e53=await _0x15627a['getStateAsync'](_0x41fc8c(0x14e));if(!_0x231e53||!_0x231e53['val'])return!![];const _0x525a28=JSON['parse'](_0x231e53[_0x41fc8c(0x175)]),{rooms:_0x41bdb3,matrix:_0x3b3a99}=_0x525a28;if(!_0x41bdb3||!_0x3b3a99)return!![];const _0xba795e=_0x41bdb3[_0x41fc8c(0x16a)](_0x5aaf84),_0x385008=_0x41bdb3[_0x41fc8c(0x16a)](_0x277f92);if(_0xba795e===-0x1||_0x385008===-0x1)return!![];const _0x4d382d=_0x3b3a99[_0xba795e][_0x385008]>0x0||_0x3b3a99[_0x385008][_0xba795e]>0x0;return _0x4d382d;}catch(_0x1ebb20){return _0x15627a[_0x41fc8c(0x154)][_0x41fc8c(0x14c)](_0x41fc8c(0x14d)+_0x1ebb20['message']),!![];}}function calculateSleepProbability(_0xb238cf){const _0x39bc6c=a2_0x359b04,_0x34dc58=new Date(),_0x34961a=_0x34dc58[_0x39bc6c(0x174)](),_0x14d01d=_0xb238cf['toLowerCase']();let _0x306675=0.1;if(_0x34961a>=0x17||_0x34961a<=0x6)_0x306675=0x1;else{if(_0x34961a>=0xd&&_0x34961a<=0xf)_0x306675=0.8;else{if(_0x34961a>=0x14&&_0x34961a<=0x17)_0x306675=0.4;}}let _0x322174=0.1;if(_0x14d01d['includes'](_0x39bc6c(0x153))||_0x14d01d[_0x39bc6c(0x16e)](_0x39bc6c(0x146)))_0x322174=0x1;else{if(_0x14d01d[_0x39bc6c(0x16e)](_0x39bc6c(0x168))||_0x14d01d[_0x39bc6c(0x16e)](_0x39bc6c(0x14f))||_0x14d01d[_0x39bc6c(0x16e)]('sofa'))_0x322174=0.6;else{if(_0x14d01d['includes'](_0x39bc6c(0x149))||_0x14d01d[_0x39bc6c(0x16e)]('wc'))_0x322174=0.05;}}let _0x155b73=0.5;const _0x416c2e=_0x322174*0.5+_0x306675*0.3+_0x155b73*0.2;return parseFloat(_0x416c2e['toFixed'](0x2));}async function updateLocation(_0x6666fb,_0x2c88a3){const _0x31a7fa=a2_0x359b04;if(!_0x2c88a3||_0x2c88a3==='Unknown')return;if(!await isActive(_0x6666fb)){resetTimer(_0x6666fb);return;}if(currentMonitoredRoom&&currentMonitoredRoom!==_0x2c88a3){const _0x39ff86=await areRoomsConnected(_0x6666fb,currentMonitoredRoom,_0x2c88a3);if(!_0x39ff86){const _0xa7218a=_0x31a7fa(0x145)+_0x2c88a3+_0x31a7fa(0x15b)+currentMonitoredRoom+'\x27.';_0x6666fb[_0x31a7fa(0x154)][_0x31a7fa(0x157)](_0x31a7fa(0x172)+_0xa7218a+_0x31a7fa(0x177)),await _0x6666fb[_0x31a7fa(0x150)]('analysis.safety.deadMan.lastIgnored',{'val':JSON[_0x31a7fa(0x151)]({'room':_0x2c88a3,'reason':_0xa7218a,'timestamp':Date[_0x31a7fa(0x178)]()}),'ack':!![]});return;}resetTimer(_0x6666fb);}if(!currentMonitoredRoom){await _0x6666fb[_0x31a7fa(0x150)](_0x31a7fa(0x156),{'val':_0x2c88a3,'ack':!![]});const _0x53b4ea=await loadConfig(_0x6666fb);let _0x4bdf5f=getTimeoutRobust(_0x53b4ea,_0x2c88a3);const _0x1fa6dd=_0x2c88a3['toLowerCase']();if(!_0x4bdf5f)for(const _0xdeb3ec in DEFAULT_TIMEOUTS){if(_0x1fa6dd[_0x31a7fa(0x16e)](_0xdeb3ec)){_0x4bdf5f=DEFAULT_TIMEOUTS[_0xdeb3ec];break;}}if(!_0x4bdf5f&&_0x53b4ea[_0x31a7fa(0x17a)])_0x4bdf5f=_0x53b4ea['default'];if(!_0x4bdf5f)return;currentMonitoredRoom=_0x2c88a3,startTimer(_0x6666fb,_0x4bdf5f,_0x2c88a3);}}function startTimer(_0x358a6e,_0x502e3d,_0x58637a){const _0x5030e5=a2_0x359b04;if(activeTimer)clearTimeout(activeTimer);timeoutMs=_0x502e3d*0x3c*0x3e8,startTime=Date[_0x5030e5(0x178)](),alarmStage=0x0;const _0x44da7a=calculateSleepProbability(_0x58637a||currentMonitoredRoom),_0x21b76f=_0x44da7a>0.65;_0x21b76f?(timeoutMs+=0x5a*0x3c*0x3e8,_0x358a6e[_0x5030e5(0x154)][_0x5030e5(0x157)](_0x5030e5(0x15a)+(_0x44da7a*0x64)[_0x5030e5(0x16d)](0x0)+'%).\x20VerlÃ¤ngere\x20Timer\x20fÃ¼r\x20'+currentMonitoredRoom+_0x5030e5(0x143)),_0x358a6e[_0x5030e5(0x150)](_0x5030e5(0x14b),{'val':!![],'ack':!![]})):_0x358a6e[_0x5030e5(0x150)](_0x5030e5(0x14b),{'val':![],'ack':!![]}),_0x358a6e[_0x5030e5(0x150)](_0x5030e5(0x159),{'val':_0x44da7a,'ack':!![]}),_0x358a6e[_0x5030e5(0x154)][_0x5030e5(0x157)]('ðŸ‘¼\x20Schutzengel:\x20Ãœberwache\x20'+currentMonitoredRoom+'\x20fÃ¼r\x20'+_0x502e3d+'\x20Min.'),_0x358a6e['setStateAsync'](_0x5030e5(0x161),{'val':'ok','ack':!![]}),activeTimer=setTimeout(()=>triggerPreWarn(_0x358a6e),timeoutMs);}function a2_0x2242(){const _0x3f59c7=['parse','6bGBhuP','sendNotification','1538960TcFAkl','apply','analysis.safety.deadMan.alarmState','alarm','(((.+)+)+)+$','search','12910bPAqCu','pre_warn','8616902wIrnKc','wohn','analysis.safety.deadMan.config','indexOf','.\x20Alles\x20in\x20Ordnung?','error','toFixed','includes','1503312vRSDQL','constructor','218727RTvXSw','[DeadMan]\x20','toString','getHours','val','./setup','\x20(Multi-Person\x20Filter)','now','analysis.safety.deadMan.active','default','replace','\x20um\x2090\x20Min.','â³\x20ACHTUNG:\x20UngewÃ¶hnlich\x20lange\x20InaktivitÃ¤t\x20in\x20','Ignoriere\x20Bewegung\x20in\x20\x27','bed','toLowerCase','1737045SMYrXV','bad','3GLvyIj','analysis.safety.deadMan.smartSleep','warn','[DeadMan]\x20Topology\x20check\x20failed:\x20','analysis.topology.structure','living','setStateAsync','stringify','194byhMvO','schlaf','log','1889130lpDcVt','analysis.safety.deadMan.currentRoom','info','ðŸ‘¼\x20Schutzengel-Frage:\x20','analysis.safety.deadMan.napProbability','ðŸ’¤\x20Smart\x20Sleep\x20erkannt\x20(','\x27.\x20Nicht\x20verbunden\x20mit\x20Ã¼berwachtem\x20\x27'];a2_0x2242=function(){return _0x3f59c7;};return a2_0x2242();}function resetTimer(_0x34daf7){const _0x357211=a2_0x359b04;if(activeTimer)clearTimeout(activeTimer);activeTimer=null,currentMonitoredRoom=null,alarmStage=0x0,_0x34daf7['setStateAsync'](_0x357211(0x161),{'val':'ok','ack':!![]}),_0x34daf7['setStateAsync'](_0x357211(0x14b),{'val':![],'ack':!![]}),_0x34daf7[_0x357211(0x150)]('analysis.safety.deadMan.napProbability',{'val':0x0,'ack':!![]});}async function triggerPreWarn(_0x48c0e2){const _0x5d6dbb=a2_0x359b04;alarmStage=0x1,await _0x48c0e2[_0x5d6dbb(0x150)](_0x5d6dbb(0x161),{'val':_0x5d6dbb(0x166),'ack':!![]});const _0x3a7352=_0x5d6dbb(0x144)+currentMonitoredRoom+_0x5d6dbb(0x16b);_0x48c0e2[_0x5d6dbb(0x154)]['warn']('[DeadMan]\x20'+_0x3a7352),await setup[_0x5d6dbb(0x15e)](_0x48c0e2,_0x5d6dbb(0x158)+_0x3a7352),activeTimer=setTimeout(()=>triggerAlarm(_0x48c0e2),0x5*0x3c*0x3e8);}function a2_0x430b(_0x3b17ec,_0xfe4c5a){const _0x37857e=a2_0x2242();return a2_0x430b=function(_0x47d4dc,_0x3eef97){_0x47d4dc=_0x47d4dc-0x142;let _0x2242bb=_0x37857e[_0x47d4dc];return _0x2242bb;},a2_0x430b(_0x3b17ec,_0xfe4c5a);}async function triggerAlarm(_0x83dc50){const _0x5e8403=a2_0x359b04;alarmStage=0x2,await _0x83dc50[_0x5e8403(0x150)](_0x5e8403(0x161),{'val':_0x5e8403(0x162),'ack':!![]});const _0x29eaf1='ðŸš¨\x20NOTFALL-ALARM:\x20Person\x20reagiert\x20nicht\x20in\x20'+currentMonitoredRoom+'!';_0x83dc50[_0x5e8403(0x154)][_0x5e8403(0x16c)](_0x5e8403(0x172)+_0x29eaf1),await setup[_0x5e8403(0x15e)](_0x83dc50,_0x29eaf1,![],!![]);}module['exports']={'updateLocation':updateLocation};