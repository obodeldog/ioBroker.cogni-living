const a2_0x586834=a2_0x5bce;(function(_0x2edd76,_0x514308){const _0x3a0df1=a2_0x5bce,_0x4b4822=_0x2edd76();while(!![]){try{const _0x5786da=parseInt(_0x3a0df1(0xa5))/0x1*(-parseInt(_0x3a0df1(0xb6))/0x2)+parseInt(_0x3a0df1(0xa4))/0x3+parseInt(_0x3a0df1(0xba))/0x4+-parseInt(_0x3a0df1(0x91))/0x5+parseInt(_0x3a0df1(0xb9))/0x6*(-parseInt(_0x3a0df1(0xa2))/0x7)+-parseInt(_0x3a0df1(0xa7))/0x8+parseInt(_0x3a0df1(0x9a))/0x9*(parseInt(_0x3a0df1(0xa3))/0xa);if(_0x5786da===_0x514308)break;else _0x4b4822['push'](_0x4b4822['shift']());}catch(_0x2e469e){_0x4b4822['push'](_0x4b4822['shift']());}}}(a2_0x12d8,0xe0505));const a2_0x4aef28=(function(){let _0x3d4e69=!![];return function(_0x4526b2,_0x391d2d){const _0x4ccaf2=_0x3d4e69?function(){const _0x48e0cb=a2_0x5bce;if(_0x391d2d){const _0x27666a=_0x391d2d[_0x48e0cb(0x96)](_0x4526b2,arguments);return _0x391d2d=null,_0x27666a;}}:function(){};return _0x3d4e69=![],_0x4ccaf2;};}()),a2_0x557c88=a2_0x4aef28(this,function(){const _0x2af2f8=a2_0x5bce;return a2_0x557c88[_0x2af2f8(0xa8)]()[_0x2af2f8(0xa0)](_0x2af2f8(0x95))[_0x2af2f8(0xa8)]()[_0x2af2f8(0x92)](a2_0x557c88)['search'](_0x2af2f8(0x95));});a2_0x557c88();'use strict';const setup=require(a2_0x586834(0xa9));let activeTimer=null,currentMonitoredRoom=null,timeoutMs=0x0,startTime=0x0,alarmStage=0x0;function a2_0x12d8(){const _0x109f67=['now','setStateAsync','indexOf','â³\x20ACHTUNG:\x20UngewÃ¶hnlich\x20lange\x20InaktivitÃ¤t\x20in\x20','96680xebkiY','\x20Min.','getStateAsync','1902XTnDcR','1579400fCKqzs','analysis.safety.deadMan.active','analysis.safety.deadMan.alarmState','analysis.topology.structure','ðŸš¨\x20NOTFALL-ALARM:\x20Person\x20reagiert\x20nicht\x20in\x20','5484305DMRDqf','constructor','exports','toLowerCase','(((.+)+)+)+$','apply','Ignoriere\x20Bewegung\x20in\x20\x27','analysis.safety.deadMan.lastIgnored','error','441VJhbTp','ðŸ‘¼\x20Schutzengel:\x20Ãœberwache\x20','warn','sendNotification','val','\x20(Multi-Person\x20Filter)','search','\x27.\x20Nicht\x20verbunden\x20mit\x20Ã¼berwachtem\x20\x27','36953WXXBHV','709420vggdMf','1280997TnIUmf','10UPzcZQ','default','1004112ngxhSw','toString','./setup','.\x20Alles\x20in\x20Ordnung?','[DeadMan]\x20','stringify','pre_warn','info','log','parse','\x20fÃ¼r\x20'];a2_0x12d8=function(){return _0x109f67;};return a2_0x12d8();}const DEFAULT_TIMEOUTS={'bad':0x2d,'bath':0x2d,'toilet':0x1e,'wc':0x1e,'keller':0x3c};async function loadConfig(_0x2b880b){const _0x2553a1=a2_0x586834;try{const _0x433530=await _0x2b880b['getStateAsync']('analysis.safety.deadMan.config');if(_0x433530&&_0x433530[_0x2553a1(0x9e)])return JSON[_0x2553a1(0xb0)](_0x433530[_0x2553a1(0x9e)]);}catch(_0x26e69a){}return{};}async function isActive(_0x2f854a){const _0xa94a41=a2_0x586834;try{const _0x5f230f=await _0x2f854a[_0xa94a41(0xb8)](_0xa94a41(0xbb));return _0x5f230f&&_0x5f230f[_0xa94a41(0x9e)];}catch(_0x44fbb6){return![];}}async function areRoomsConnected(_0x149bfe,_0x207368,_0x3071fb){const _0x51869c=a2_0x586834;try{const _0x35d561=await _0x149bfe['getStateAsync'](_0x51869c(0x8f));if(!_0x35d561||!_0x35d561[_0x51869c(0x9e)])return!![];const _0x2cd7e2=JSON[_0x51869c(0xb0)](_0x35d561[_0x51869c(0x9e)]),{rooms:_0x1e4e4b,matrix:_0xf647e8}=_0x2cd7e2;if(!_0x1e4e4b||!_0xf647e8)return!![];const _0x3ce157=_0x1e4e4b[_0x51869c(0xb4)](_0x207368),_0x298885=_0x1e4e4b['indexOf'](_0x3071fb);if(_0x3ce157===-0x1||_0x298885===-0x1)return!![];const _0x20b94e=_0xf647e8[_0x3ce157][_0x298885]>0x0||_0xf647e8[_0x298885][_0x3ce157]>0x0;return _0x20b94e;}catch(_0x18da63){return _0x149bfe[_0x51869c(0xaf)][_0x51869c(0x9c)]('[DeadMan]\x20Topology\x20check\x20failed:\x20'+_0x18da63['message']),!![];}}async function updateLocation(_0x1d44c0,_0x402479){const _0x59e5f9=a2_0x586834;if(!_0x402479||_0x402479==='Unknown')return;if(!await isActive(_0x1d44c0)){resetTimer(_0x1d44c0);return;}if(currentMonitoredRoom&&currentMonitoredRoom!==_0x402479){const _0x5011ee=await areRoomsConnected(_0x1d44c0,currentMonitoredRoom,_0x402479);if(!_0x5011ee){const _0x40c3a0=_0x59e5f9(0x97)+_0x402479+_0x59e5f9(0xa1)+currentMonitoredRoom+'\x27.';_0x1d44c0[_0x59e5f9(0xaf)][_0x59e5f9(0xae)](_0x59e5f9(0xab)+_0x40c3a0+_0x59e5f9(0x9f)),await _0x1d44c0['setStateAsync'](_0x59e5f9(0x98),{'val':JSON[_0x59e5f9(0xac)]({'room':_0x402479,'reason':_0x40c3a0,'timestamp':Date[_0x59e5f9(0xb2)]()}),'ack':!![]});return;}resetTimer(_0x1d44c0);}if(!currentMonitoredRoom){await _0x1d44c0[_0x59e5f9(0xb3)]('analysis.safety.deadMan.currentRoom',{'val':_0x402479,'ack':!![]});const _0x234b24=await loadConfig(_0x1d44c0),_0x2acb66=_0x402479[_0x59e5f9(0x94)]();let _0x2fd01a=_0x234b24[_0x402479]||_0x234b24[_0x2acb66];if(!_0x2fd01a)for(const _0x2aa865 in DEFAULT_TIMEOUTS){if(_0x2acb66['includes'](_0x2aa865)){_0x2fd01a=DEFAULT_TIMEOUTS[_0x2aa865];break;}}if(!_0x2fd01a&&_0x234b24[_0x59e5f9(0xa6)])_0x2fd01a=_0x234b24['default'];if(!_0x2fd01a)return;currentMonitoredRoom=_0x402479,startTimer(_0x1d44c0,_0x2fd01a);}}function startTimer(_0x5dedd4,_0x49dbb4){const _0x193d7e=a2_0x586834;if(activeTimer)clearTimeout(activeTimer);timeoutMs=_0x49dbb4*0x3c*0x3e8,startTime=Date['now'](),alarmStage=0x0,_0x5dedd4[_0x193d7e(0xaf)][_0x193d7e(0xae)](_0x193d7e(0x9b)+currentMonitoredRoom+_0x193d7e(0xb1)+_0x49dbb4+_0x193d7e(0xb7)),_0x5dedd4[_0x193d7e(0xb3)](_0x193d7e(0x8e),{'val':'ok','ack':!![]}),activeTimer=setTimeout(()=>triggerPreWarn(_0x5dedd4),timeoutMs);}function resetTimer(_0x490c19){const _0x1c918c=a2_0x586834;if(activeTimer)clearTimeout(activeTimer);activeTimer=null,currentMonitoredRoom=null,alarmStage=0x0,_0x490c19[_0x1c918c(0xb3)](_0x1c918c(0x8e),{'val':'ok','ack':!![]});}function a2_0x5bce(_0x2f0995,_0x56342a){const _0x56359d=a2_0x12d8();return a2_0x5bce=function(_0x557c88,_0x4aef28){_0x557c88=_0x557c88-0x8e;let _0x12d85a=_0x56359d[_0x557c88];return _0x12d85a;},a2_0x5bce(_0x2f0995,_0x56342a);}async function triggerPreWarn(_0x53c511){const _0x14c7ae=a2_0x586834;alarmStage=0x1,await _0x53c511[_0x14c7ae(0xb3)](_0x14c7ae(0x8e),{'val':_0x14c7ae(0xad),'ack':!![]});const _0x552e5e=_0x14c7ae(0xb5)+currentMonitoredRoom+_0x14c7ae(0xaa);_0x53c511[_0x14c7ae(0xaf)][_0x14c7ae(0x9c)](_0x14c7ae(0xab)+_0x552e5e),await setup[_0x14c7ae(0x9d)](_0x53c511,'ðŸ‘¼\x20Schutzengel-Frage:\x20'+_0x552e5e),activeTimer=setTimeout(()=>triggerAlarm(_0x53c511),0x5*0x3c*0x3e8);}async function triggerAlarm(_0x24f372){const _0x2818f8=a2_0x586834;alarmStage=0x2,await _0x24f372[_0x2818f8(0xb3)](_0x2818f8(0x8e),{'val':'alarm','ack':!![]});const _0x459377=_0x2818f8(0x90)+currentMonitoredRoom+'!';_0x24f372['log'][_0x2818f8(0x99)](_0x2818f8(0xab)+_0x459377),await setup[_0x2818f8(0x9d)](_0x24f372,_0x459377,![],!![]);}module[a2_0x586834(0x93)]={'updateLocation':updateLocation};