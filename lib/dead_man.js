const a2_0x145fad=a2_0x5655;(function(_0x15d8d4,_0x42026b){const _0x3401f7=a2_0x5655,_0x5e2736=_0x15d8d4();while(!![]){try{const _0x15c851=parseInt(_0x3401f7(0x1d2))/0x1+-parseInt(_0x3401f7(0x1c3))/0x2+-parseInt(_0x3401f7(0x1b8))/0x3*(-parseInt(_0x3401f7(0x1d4))/0x4)+parseInt(_0x3401f7(0x1b7))/0x5*(-parseInt(_0x3401f7(0x1d8))/0x6)+parseInt(_0x3401f7(0x1bd))/0x7*(parseInt(_0x3401f7(0x1cc))/0x8)+-parseInt(_0x3401f7(0x1af))/0x9+-parseInt(_0x3401f7(0x1ad))/0xa*(-parseInt(_0x3401f7(0x1cd))/0xb);if(_0x15c851===_0x42026b)break;else _0x5e2736['push'](_0x5e2736['shift']());}catch(_0x2f2b89){_0x5e2736['push'](_0x5e2736['shift']());}}}(a2_0x2da6,0x2daac));const a2_0x540562=(function(){let _0x55a179=!![];return function(_0x4ae59f,_0x3fcf35){const _0x27d4bf=_0x55a179?function(){const _0x3e745b=a2_0x5655;if(_0x3fcf35){const _0x3d355c=_0x3fcf35[_0x3e745b(0x1ae)](_0x4ae59f,arguments);return _0x3fcf35=null,_0x3d355c;}}:function(){};return _0x55a179=![],_0x27d4bf;};}()),a2_0x9e6ff8=a2_0x540562(this,function(){const _0x567f52=a2_0x5655;return a2_0x9e6ff8[_0x567f52(0x1bb)]()[_0x567f52(0x1d6)](_0x567f52(0x1c2))['toString']()[_0x567f52(0x1d7)](a2_0x9e6ff8)['search']('(((.+)+)+)+$');});a2_0x9e6ff8();'use strict';const setup=require(a2_0x145fad(0x1c0));let activeTimer=null,currentMonitoredRoom=null,timeoutMs=0x0,startTime=0x0,alarmStage=0x0;const DEFAULT_TIMEOUTS={'bad':0x2d,'bath':0x2d,'toilet':0x1e,'wc':0x1e,'keller':0x3c};async function loadConfig(_0x75584d){const _0x21b6a1=a2_0x145fad;try{const _0x14191c=await _0x75584d['getStateAsync']('analysis.safety.deadMan.config');if(_0x14191c&&_0x14191c[_0x21b6a1(0x1ca)])return JSON[_0x21b6a1(0x1c7)](_0x14191c[_0x21b6a1(0x1ca)]);}catch(_0x33a91c){}return{};}async function isActive(_0x5ab7e4){const _0x44d233=a2_0x145fad;try{const _0x4b4c14=await _0x5ab7e4[_0x44d233(0x1c8)](_0x44d233(0x1c4));return _0x4b4c14&&_0x4b4c14[_0x44d233(0x1ca)];}catch(_0x307961){return![];}}async function areRoomsConnected(_0x3a50c2,_0xc25b5,_0x1a2872){const _0x34bf6c=a2_0x145fad;try{const _0x31db73=await _0x3a50c2[_0x34bf6c(0x1c8)]('analysis.topology.structure');if(!_0x31db73||!_0x31db73[_0x34bf6c(0x1ca)])return!![];const _0x49ca15=JSON['parse'](_0x31db73['val']),{rooms:_0x350c55,matrix:_0x550281}=_0x49ca15;if(!_0x350c55||!_0x550281)return!![];const _0x173807=_0x350c55[_0x34bf6c(0x1b4)](_0xc25b5),_0x3cb191=_0x350c55['indexOf'](_0x1a2872);if(_0x173807===-0x1||_0x3cb191===-0x1)return!![];const _0xbce888=_0x550281[_0x173807][_0x3cb191]>0x0||_0x550281[_0x3cb191][_0x173807]>0x0;return _0xbce888;}catch(_0x5c12c4){return _0x3a50c2[_0x34bf6c(0x1c9)][_0x34bf6c(0x1d5)](_0x34bf6c(0x1b2)+_0x5c12c4[_0x34bf6c(0x1b3)]),!![];}}function a2_0x2da6(){const _0x15a3c7=['setStateAsync','51290IUXuRW','apply','2375415lCoLzu','default','toLowerCase','[DeadMan]\x20Topology\x20check\x20failed:\x20','message','indexOf','analysis.safety.deadMan.alarmState','ðŸš¨\x20NOTFALL-ALARM:\x20Person\x20reagiert\x20nicht\x20in\x20','20kfbctf','5367IjBJlf','analysis.safety.deadMan.lastIgnored','pre_warn','toString','ðŸ‘¼\x20Schutzengel-Frage:\x20','430409bpJbJU','\x20Min.','alarm','./setup','[DeadMan]\x20','(((.+)+)+)+$','421188abgsXX','analysis.safety.deadMan.active','analysis.safety.deadMan.currentRoom','\x27.\x20Nicht\x20verbunden\x20mit\x20Ã¼berwachtem\x20\x27','parse','getStateAsync','log','val','info','8jYsqfG','407HKphno','stringify','â³\x20ACHTUNG:\x20UngewÃ¶hnlich\x20lange\x20InaktivitÃ¤t\x20in\x20','\x20(Multi-Person\x20Filter)','now','351621BvWPyL','sendNotification','224iQcIHp','warn','search','constructor','62226WpXAMt'];a2_0x2da6=function(){return _0x15a3c7;};return a2_0x2da6();}async function updateLocation(_0x2ef8c0,_0x46ee4b){const _0x5ba278=a2_0x145fad;if(!_0x46ee4b||_0x46ee4b==='Unknown')return;if(!await isActive(_0x2ef8c0)){resetTimer(_0x2ef8c0);return;}if(currentMonitoredRoom&&currentMonitoredRoom!==_0x46ee4b){const _0x1a6745=await areRoomsConnected(_0x2ef8c0,currentMonitoredRoom,_0x46ee4b);if(!_0x1a6745){const _0x51a7dd='Ignoriere\x20Bewegung\x20in\x20\x27'+_0x46ee4b+_0x5ba278(0x1c6)+currentMonitoredRoom+'\x27.';_0x2ef8c0[_0x5ba278(0x1c9)][_0x5ba278(0x1cb)]('[DeadMan]\x20'+_0x51a7dd+_0x5ba278(0x1d0)),await _0x2ef8c0['setStateAsync'](_0x5ba278(0x1b9),{'val':JSON[_0x5ba278(0x1ce)]({'room':_0x46ee4b,'reason':_0x51a7dd,'timestamp':Date[_0x5ba278(0x1d1)]()}),'ack':!![]});return;}resetTimer(_0x2ef8c0);}if(!currentMonitoredRoom){await _0x2ef8c0[_0x5ba278(0x1ac)](_0x5ba278(0x1c5),{'val':_0x46ee4b,'ack':!![]});const _0x3e24eb=await loadConfig(_0x2ef8c0),_0xfb4c2e=_0x46ee4b[_0x5ba278(0x1b1)]();let _0x3e72e4=_0x3e24eb[_0x46ee4b]||_0x3e24eb[_0xfb4c2e];if(!_0x3e72e4)for(const _0x3974a6 in DEFAULT_TIMEOUTS){if(_0xfb4c2e['includes'](_0x3974a6)){_0x3e72e4=DEFAULT_TIMEOUTS[_0x3974a6];break;}}if(!_0x3e72e4&&_0x3e24eb[_0x5ba278(0x1b0)])_0x3e72e4=_0x3e24eb[_0x5ba278(0x1b0)];if(!_0x3e72e4)return;currentMonitoredRoom=_0x46ee4b,startTimer(_0x2ef8c0,_0x3e72e4);}}function startTimer(_0x40d71f,_0x47f797){const _0x851fe7=a2_0x145fad;if(activeTimer)clearTimeout(activeTimer);timeoutMs=_0x47f797*0x3c*0x3e8,startTime=Date[_0x851fe7(0x1d1)](),alarmStage=0x0,_0x40d71f['log'][_0x851fe7(0x1cb)]('ðŸ‘¼\x20Schutzengel:\x20Ãœberwache\x20'+currentMonitoredRoom+'\x20fÃ¼r\x20'+_0x47f797+_0x851fe7(0x1be)),_0x40d71f[_0x851fe7(0x1ac)]('analysis.safety.deadMan.alarmState',{'val':'ok','ack':!![]}),activeTimer=setTimeout(()=>triggerPreWarn(_0x40d71f),timeoutMs);}function a2_0x5655(_0x1f6f56,_0x2dc54f){const _0x1abae7=a2_0x2da6();return a2_0x5655=function(_0x9e6ff8,_0x540562){_0x9e6ff8=_0x9e6ff8-0x1ac;let _0x2da6b3=_0x1abae7[_0x9e6ff8];return _0x2da6b3;},a2_0x5655(_0x1f6f56,_0x2dc54f);}function resetTimer(_0x2d78e5){const _0x424624=a2_0x145fad;if(activeTimer)clearTimeout(activeTimer);activeTimer=null,currentMonitoredRoom=null,alarmStage=0x0,_0x2d78e5[_0x424624(0x1ac)](_0x424624(0x1b5),{'val':'ok','ack':!![]});}async function triggerPreWarn(_0x522e3c){const _0x510f79=a2_0x145fad;alarmStage=0x1,await _0x522e3c['setStateAsync'](_0x510f79(0x1b5),{'val':_0x510f79(0x1ba),'ack':!![]});const _0x1f5d75=_0x510f79(0x1cf)+currentMonitoredRoom+'.\x20Alles\x20in\x20Ordnung?';_0x522e3c[_0x510f79(0x1c9)][_0x510f79(0x1d5)](_0x510f79(0x1c1)+_0x1f5d75),await setup[_0x510f79(0x1d3)](_0x522e3c,_0x510f79(0x1bc)+_0x1f5d75),activeTimer=setTimeout(()=>triggerAlarm(_0x522e3c),0x5*0x3c*0x3e8);}async function triggerAlarm(_0x35cbd9){const _0x3703f0=a2_0x145fad;alarmStage=0x2,await _0x35cbd9[_0x3703f0(0x1ac)](_0x3703f0(0x1b5),{'val':_0x3703f0(0x1bf),'ack':!![]});const _0x55fe8b=_0x3703f0(0x1b6)+currentMonitoredRoom+'!';_0x35cbd9['log']['error']('[DeadMan]\x20'+_0x55fe8b),await setup[_0x3703f0(0x1d3)](_0x35cbd9,_0x55fe8b,![],!![]);}module['exports']={'updateLocation':updateLocation};