const a2_0x1c9a64=a2_0x4c32;(function(_0x4fbbd8,_0x6ddad1){const _0x218627=a2_0x4c32,_0x1b5855=_0x4fbbd8();while(!![]){try{const _0x2a5887=parseInt(_0x218627(0x18a))/0x1*(parseInt(_0x218627(0x171))/0x2)+-parseInt(_0x218627(0x18b))/0x3*(parseInt(_0x218627(0x17d))/0x4)+parseInt(_0x218627(0x17e))/0x5+-parseInt(_0x218627(0x162))/0x6+-parseInt(_0x218627(0x163))/0x7+-parseInt(_0x218627(0x164))/0x8*(-parseInt(_0x218627(0x159))/0x9)+parseInt(_0x218627(0x18f))/0xa*(-parseInt(_0x218627(0x17b))/0xb);if(_0x2a5887===_0x6ddad1)break;else _0x1b5855['push'](_0x1b5855['shift']());}catch(_0xf4452b){_0x1b5855['push'](_0x1b5855['shift']());}}}(a2_0x390d,0xe8ae1));const a2_0x4d77d5=(function(){let _0xdebc6c=!![];return function(_0x224f4a,_0x4865bc){const _0x2f472b=_0xdebc6c?function(){const _0x57d2cf=a2_0x4c32;if(_0x4865bc){const _0x3e7b49=_0x4865bc[_0x57d2cf(0x170)](_0x224f4a,arguments);return _0x4865bc=null,_0x3e7b49;}}:function(){};return _0xdebc6c=![],_0x2f472b;};}()),a2_0x2bfe11=a2_0x4d77d5(this,function(){const _0x534bf5=a2_0x4c32;return a2_0x2bfe11['toString']()[_0x534bf5(0x15f)](_0x534bf5(0x18e))[_0x534bf5(0x179)]()[_0x534bf5(0x16f)](a2_0x2bfe11)[_0x534bf5(0x15f)]('(((.+)+)+)+$');});a2_0x2bfe11();'use strict';const setup=require(a2_0x1c9a64(0x16e));let activeTimer=null,currentMonitoredRoom=null,timeoutMs=0x0,startTime=0x0,alarmStage=0x0;const DEFAULT_TIMEOUTS={'bad':0x2d,'bath':0x2d,'toilet':0x1e,'wc':0x1e,'keller':0x3c,'schlaf':0x78,'bed':0x78,'guest':0x5a,'gast':0x5a};async function loadConfig(_0x2f92c5){const _0x8e80b4=a2_0x1c9a64;try{const _0x521792=await _0x2f92c5[_0x8e80b4(0x15d)]('analysis.safety.deadMan.config');if(_0x521792&&_0x521792['val'])return JSON['parse'](_0x521792[_0x8e80b4(0x16d)]);}catch(_0x3b4704){}return{};}async function isActive(_0x34cc94){const _0x37fff7=a2_0x1c9a64;try{const _0x39f053=await _0x34cc94[_0x37fff7(0x15d)]('analysis.safety.deadMan.active');return _0x39f053&&_0x39f053[_0x37fff7(0x16d)];}catch(_0x243c86){return![];}}async function areRoomsConnected(_0x55ebdb,_0x5e2b20,_0xbed54c){const _0x3fb3dd=a2_0x1c9a64;try{const _0x19044d=await _0x55ebdb[_0x3fb3dd(0x15d)]('analysis.topology.structure');if(!_0x19044d||!_0x19044d[_0x3fb3dd(0x16d)])return!![];const _0x2157e1=JSON[_0x3fb3dd(0x186)](_0x19044d[_0x3fb3dd(0x16d)]),{rooms:_0x59f153,matrix:_0x91b01b}=_0x2157e1;if(!_0x59f153||!_0x91b01b)return!![];const _0xffa73b=_0x59f153['indexOf'](_0x5e2b20),_0x4e380a=_0x59f153['indexOf'](_0xbed54c);if(_0xffa73b===-0x1||_0x4e380a===-0x1)return!![];const _0x39a3b2=_0x91b01b[_0xffa73b][_0x4e380a]>0x0||_0x91b01b[_0x4e380a][_0xffa73b]>0x0;return _0x39a3b2;}catch(_0xd03e1){return _0x55ebdb[_0x3fb3dd(0x173)][_0x3fb3dd(0x177)]('[DeadMan]\x20Topology\x20check\x20failed:\x20'+_0xd03e1[_0x3fb3dd(0x189)]),!![];}}function calculateSleepProbability(_0x4b79cd){const _0x534af1=a2_0x1c9a64,_0x1ff307=new Date(),_0x1261ff=_0x1ff307[_0x534af1(0x167)](),_0x394eb4=_0x4b79cd[_0x534af1(0x175)]();let _0x12977c=0.1;if(_0x1261ff>=0x17||_0x1261ff<=0x6)_0x12977c=0x1;else{if(_0x1261ff>=0xd&&_0x1261ff<=0xf)_0x12977c=0.8;else{if(_0x1261ff>=0x14&&_0x1261ff<=0x17)_0x12977c=0.4;}}let _0x55cea7=0.1;if(_0x394eb4[_0x534af1(0x15a)](_0x534af1(0x16b))||_0x394eb4[_0x534af1(0x15a)](_0x534af1(0x17c)))_0x55cea7=0x1;else{if(_0x394eb4[_0x534af1(0x15a)]('wohn')||_0x394eb4[_0x534af1(0x15a)](_0x534af1(0x15e))||_0x394eb4[_0x534af1(0x15a)](_0x534af1(0x16c)))_0x55cea7=0.6;else{if(_0x394eb4[_0x534af1(0x15a)](_0x534af1(0x161))||_0x394eb4[_0x534af1(0x15a)]('wc'))_0x55cea7=0.05;}}let _0x514196=0.5;const _0x25e766=_0x55cea7*0.5+_0x12977c*0.3+_0x514196*0.2;return parseFloat(_0x25e766[_0x534af1(0x18d)](0x2));}async function updateLocation(_0x1c4dc3,_0x473cf7){const _0x451b1b=a2_0x1c9a64;if(!_0x473cf7||_0x473cf7===_0x451b1b(0x176))return;if(!await isActive(_0x1c4dc3)){resetTimer(_0x1c4dc3);return;}if(currentMonitoredRoom&&currentMonitoredRoom!==_0x473cf7){const _0x126d52=await areRoomsConnected(_0x1c4dc3,currentMonitoredRoom,_0x473cf7);if(!_0x126d52){const _0x10e993=_0x451b1b(0x184)+_0x473cf7+'\x27.\x20Nicht\x20verbunden\x20mit\x20Ã¼berwachtem\x20\x27'+currentMonitoredRoom+'\x27.';_0x1c4dc3[_0x451b1b(0x173)][_0x451b1b(0x16a)](_0x451b1b(0x174)+_0x10e993+'\x20(Multi-Person\x20Filter)'),await _0x1c4dc3[_0x451b1b(0x18c)](_0x451b1b(0x183),{'val':JSON['stringify']({'room':_0x473cf7,'reason':_0x10e993,'timestamp':Date[_0x451b1b(0x190)]()}),'ack':!![]});return;}resetTimer(_0x1c4dc3);}if(!currentMonitoredRoom){await _0x1c4dc3[_0x451b1b(0x18c)](_0x451b1b(0x187),{'val':_0x473cf7,'ack':!![]});const _0x5b73ab=await loadConfig(_0x1c4dc3),_0x17cef6=_0x473cf7[_0x451b1b(0x175)]();let _0x335a44=_0x5b73ab[_0x473cf7]||_0x5b73ab[_0x17cef6];if(!_0x335a44)for(const _0x1e4555 in DEFAULT_TIMEOUTS){if(_0x17cef6[_0x451b1b(0x15a)](_0x1e4555)){_0x335a44=DEFAULT_TIMEOUTS[_0x1e4555];break;}}if(!_0x335a44&&_0x5b73ab[_0x451b1b(0x160)])_0x335a44=_0x5b73ab[_0x451b1b(0x160)];if(!_0x335a44)return;currentMonitoredRoom=_0x473cf7,startTimer(_0x1c4dc3,_0x335a44,_0x473cf7);}}function a2_0x4c32(_0x97c3f4,_0x43137b){const _0x5be527=a2_0x390d();return a2_0x4c32=function(_0x2bfe11,_0x4d77d5){_0x2bfe11=_0x2bfe11-0x158;let _0x390dbb=_0x5be527[_0x2bfe11];return _0x390dbb;},a2_0x4c32(_0x97c3f4,_0x43137b);}function a2_0x390d(){const _0x35fd04=['\x20fÃ¼r\x20','getStateAsync','living','search','default','bad','5155584FNDCmi','12150068TdNLdL','64cEVvpB','alarm','analysis.safety.deadMan.smartSleep','getHours','pre_warn','analysis.safety.deadMan.alarmState','info','schlaf','sofa','val','./setup','constructor','apply','6asxEQI','%).\x20VerlÃ¤ngere\x20Timer\x20fÃ¼r\x20','log','[DeadMan]\x20','toLowerCase','Unknown','warn','.\x20Alles\x20in\x20Ordnung?','toString','analysis.safety.deadMan.napProbability','66vtjYDi','bed','511828OayAFf','7234365CotLpK','ðŸš¨\x20NOTFALL-ALARM:\x20Person\x20reagiert\x20nicht\x20in\x20','error','exports','sendNotification','analysis.safety.deadMan.lastIgnored','Ignoriere\x20Bewegung\x20in\x20\x27','ðŸ‘¼\x20Schutzengel-Frage:\x20','parse','analysis.safety.deadMan.currentRoom','\x20Min.','message','571602SPmuVA','6pTXBlk','setStateAsync','toFixed','(((.+)+)+)+$','1332360zTsFUE','now','ðŸ‘¼\x20Schutzengel:\x20Ãœberwache\x20','1621908TiMsgA','includes','\x20um\x2090\x20Min.'];a2_0x390d=function(){return _0x35fd04;};return a2_0x390d();}function startTimer(_0x521b5b,_0xc594a0,_0x1006b8){const _0x41a240=a2_0x1c9a64;if(activeTimer)clearTimeout(activeTimer);timeoutMs=_0xc594a0*0x3c*0x3e8,startTime=Date['now'](),alarmStage=0x0;const _0x5a576d=calculateSleepProbability(_0x1006b8||currentMonitoredRoom),_0xb15d0c=_0x5a576d>0.65;_0xb15d0c?(timeoutMs+=0x5a*0x3c*0x3e8,_0x521b5b[_0x41a240(0x173)]['info']('ðŸ’¤\x20Smart\x20Sleep\x20erkannt\x20('+(_0x5a576d*0x64)[_0x41a240(0x18d)](0x0)+_0x41a240(0x172)+currentMonitoredRoom+_0x41a240(0x15b)),_0x521b5b[_0x41a240(0x18c)]('analysis.safety.deadMan.smartSleep',{'val':!![],'ack':!![]})):_0x521b5b['setStateAsync'](_0x41a240(0x166),{'val':![],'ack':!![]}),_0x521b5b['setStateAsync'](_0x41a240(0x17a),{'val':_0x5a576d,'ack':!![]}),_0x521b5b[_0x41a240(0x173)][_0x41a240(0x16a)](_0x41a240(0x158)+currentMonitoredRoom+_0x41a240(0x15c)+_0xc594a0+_0x41a240(0x188)),_0x521b5b['setStateAsync'](_0x41a240(0x169),{'val':'ok','ack':!![]}),activeTimer=setTimeout(()=>triggerPreWarn(_0x521b5b),timeoutMs);}function resetTimer(_0x328975){const _0x52ca79=a2_0x1c9a64;if(activeTimer)clearTimeout(activeTimer);activeTimer=null,currentMonitoredRoom=null,alarmStage=0x0,_0x328975['setStateAsync']('analysis.safety.deadMan.alarmState',{'val':'ok','ack':!![]}),_0x328975[_0x52ca79(0x18c)]('analysis.safety.deadMan.smartSleep',{'val':![],'ack':!![]}),_0x328975[_0x52ca79(0x18c)](_0x52ca79(0x17a),{'val':0x0,'ack':!![]});}async function triggerPreWarn(_0x5e6261){const _0x50e194=a2_0x1c9a64;alarmStage=0x1,await _0x5e6261[_0x50e194(0x18c)](_0x50e194(0x169),{'val':_0x50e194(0x168),'ack':!![]});const _0x10e610='â³\x20ACHTUNG:\x20UngewÃ¶hnlich\x20lange\x20InaktivitÃ¤t\x20in\x20'+currentMonitoredRoom+_0x50e194(0x178);_0x5e6261['log'][_0x50e194(0x177)](_0x50e194(0x174)+_0x10e610),await setup[_0x50e194(0x182)](_0x5e6261,_0x50e194(0x185)+_0x10e610),activeTimer=setTimeout(()=>triggerAlarm(_0x5e6261),0x5*0x3c*0x3e8);}async function triggerAlarm(_0x1a11b3){const _0x28127e=a2_0x1c9a64;alarmStage=0x2,await _0x1a11b3[_0x28127e(0x18c)](_0x28127e(0x169),{'val':_0x28127e(0x165),'ack':!![]});const _0x3e50bb=_0x28127e(0x17f)+currentMonitoredRoom+'!';_0x1a11b3['log'][_0x28127e(0x180)](_0x28127e(0x174)+_0x3e50bb),await setup[_0x28127e(0x182)](_0x1a11b3,_0x3e50bb,![],!![]);}module[a2_0x1c9a64(0x181)]={'updateLocation':updateLocation};