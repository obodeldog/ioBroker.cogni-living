const a2_0x487b09=a2_0x4464;(function(_0x2ebaa5,_0x755c7){const _0x294936=a2_0x4464,_0x4cdf6c=_0x2ebaa5();while(!![]){try{const _0x3414e1=parseInt(_0x294936(0x105))/0x1+parseInt(_0x294936(0xef))/0x2*(parseInt(_0x294936(0xf0))/0x3)+-parseInt(_0x294936(0xf8))/0x4*(-parseInt(_0x294936(0xf1))/0x5)+-parseInt(_0x294936(0x106))/0x6*(parseInt(_0x294936(0xe3))/0x7)+parseInt(_0x294936(0x114))/0x8+-parseInt(_0x294936(0xe6))/0x9*(parseInt(_0x294936(0x11c))/0xa)+parseInt(_0x294936(0x11d))/0xb*(parseInt(_0x294936(0xe8))/0xc);if(_0x3414e1===_0x755c7)break;else _0x4cdf6c['push'](_0x4cdf6c['shift']());}catch(_0x46b4c1){_0x4cdf6c['push'](_0x4cdf6c['shift']());}}}(a2_0x1615,0x717db));const a2_0x1f91ac=(function(){let _0x408a39=!![];return function(_0xddbbe9,_0x2694d1){const _0x5cd64a=_0x408a39?function(){const _0x2f7968=a2_0x4464;if(_0x2694d1){const _0x13962b=_0x2694d1[_0x2f7968(0x107)](_0xddbbe9,arguments);return _0x2694d1=null,_0x13962b;}}:function(){};return _0x408a39=![],_0x5cd64a;};}()),a2_0x4d56a9=a2_0x1f91ac(this,function(){const _0x577edf=a2_0x4464;return a2_0x4d56a9[_0x577edf(0xe1)]()[_0x577edf(0xfa)](_0x577edf(0x101))[_0x577edf(0xe1)]()[_0x577edf(0xec)](a2_0x4d56a9)[_0x577edf(0xfa)](_0x577edf(0x101));});a2_0x4d56a9();'use strict';const setup=require(a2_0x487b09(0xff));let activeTimer=null,currentMonitoredRoom=null,timeoutMs=0x0,startTime=0x0,alarmStage=0x0;const DEFAULT_TIMEOUTS={'bad':0x2d,'bath':0x2d,'toilet':0x1e,'wc':0x1e,'keller':0x3c,'schlaf':0x78,'bed':0x78,'guest':0x5a,'gast':0x5a};async function loadConfig(_0xf88b64){const _0x167cb2=a2_0x487b09;try{const _0x1ebc19=await _0xf88b64[_0x167cb2(0xf3)](_0x167cb2(0x10e));if(_0x1ebc19&&_0x1ebc19[_0x167cb2(0xea)])return JSON[_0x167cb2(0x10a)](_0x1ebc19[_0x167cb2(0xea)]);}catch(_0x19c1dd){}return{};}async function isActive(_0x8514b8){const _0x2bf9e4=a2_0x487b09;try{const _0x2ae95d=await _0x8514b8[_0x2bf9e4(0xf3)](_0x2bf9e4(0xeb));return _0x2ae95d&&_0x2ae95d['val'];}catch(_0x2c13b7){return![];}}async function areRoomsConnected(_0x5cbd73,_0x5bf83c,_0x5f4244){const _0x266b5d=a2_0x487b09;try{const _0x4a2128=await _0x5cbd73[_0x266b5d(0xf3)](_0x266b5d(0x10f));if(!_0x4a2128||!_0x4a2128[_0x266b5d(0xea)])return!![];const _0x27e738=JSON[_0x266b5d(0x10a)](_0x4a2128['val']),{rooms:_0x1c1284,matrix:_0x57a8dc}=_0x27e738;if(!_0x1c1284||!_0x57a8dc)return!![];const _0xdcd79e=_0x1c1284[_0x266b5d(0xf2)](_0x5bf83c),_0x23c3a1=_0x1c1284[_0x266b5d(0xf2)](_0x5f4244);if(_0xdcd79e===-0x1||_0x23c3a1===-0x1)return!![];const _0x29f126=_0x57a8dc[_0xdcd79e][_0x23c3a1]>0x0||_0x57a8dc[_0x23c3a1][_0xdcd79e]>0x0;return _0x29f126;}catch(_0x5f0ca9){return _0x5cbd73[_0x266b5d(0x10b)][_0x266b5d(0x112)](_0x266b5d(0xf7)+_0x5f0ca9[_0x266b5d(0x119)]),!![];}}function calculateSleepProbability(_0xa51112){const _0x46c0e7=a2_0x487b09,_0xc73848=new Date(),_0x5d5d91=_0xc73848[_0x46c0e7(0x111)](),_0x34aea8=_0xa51112[_0x46c0e7(0xf6)]();let _0x196319=0.1;if(_0x5d5d91>=0x17||_0x5d5d91<=0x6)_0x196319=0x1;else{if(_0x5d5d91>=0xd&&_0x5d5d91<=0xf)_0x196319=0.8;else{if(_0x5d5d91>=0x14&&_0x5d5d91<=0x17)_0x196319=0.4;}}let _0xd66833=0.1;if(_0x34aea8['includes']('schlaf')||_0x34aea8['includes']('bed'))_0xd66833=0x1;else{if(_0x34aea8['includes'](_0x46c0e7(0x110))||_0x34aea8[_0x46c0e7(0x116)](_0x46c0e7(0x10d))||_0x34aea8[_0x46c0e7(0x116)](_0x46c0e7(0xe9)))_0xd66833=0.6;else{if(_0x34aea8['includes']('bad')||_0x34aea8[_0x46c0e7(0x116)]('wc'))_0xd66833=0.05;}}let _0x21871d=0.5;const _0x2065d4=_0xd66833*0.5+_0x196319*0.3+_0x21871d*0.2;return parseFloat(_0x2065d4[_0x46c0e7(0xe4)](0x2));}async function updateLocation(_0x180f34,_0x43d2cc){const _0x3baf32=a2_0x487b09;if(!_0x43d2cc||_0x43d2cc===_0x3baf32(0xe7))return;if(!await isActive(_0x180f34)){resetTimer(_0x180f34);return;}if(currentMonitoredRoom&&currentMonitoredRoom!==_0x43d2cc){const _0x5114bd=await areRoomsConnected(_0x180f34,currentMonitoredRoom,_0x43d2cc);if(!_0x5114bd){const _0x4fc3d4=_0x3baf32(0x103)+_0x43d2cc+_0x3baf32(0xfb)+currentMonitoredRoom+'\x27.';_0x180f34[_0x3baf32(0x10b)][_0x3baf32(0xed)](_0x3baf32(0xfd)+_0x4fc3d4+_0x3baf32(0xfe)),await _0x180f34[_0x3baf32(0xfc)](_0x3baf32(0xf9),{'val':JSON['stringify']({'room':_0x43d2cc,'reason':_0x4fc3d4,'timestamp':Date[_0x3baf32(0x11a)]()}),'ack':!![]});return;}resetTimer(_0x180f34);}if(!currentMonitoredRoom){await _0x180f34[_0x3baf32(0xfc)]('analysis.safety.deadMan.currentRoom',{'val':_0x43d2cc,'ack':!![]});const _0x1b3d8c=await loadConfig(_0x180f34),_0x4e58f4=_0x43d2cc['toLowerCase']();let _0x5117ba=_0x1b3d8c[_0x43d2cc]||_0x1b3d8c[_0x4e58f4];if(!_0x5117ba)for(const _0x57f549 in DEFAULT_TIMEOUTS){if(_0x4e58f4[_0x3baf32(0x116)](_0x57f549)){_0x5117ba=DEFAULT_TIMEOUTS[_0x57f549];break;}}if(!_0x5117ba&&_0x1b3d8c[_0x3baf32(0x115)])_0x5117ba=_0x1b3d8c['default'];if(!_0x5117ba)return;currentMonitoredRoom=_0x43d2cc,startTimer(_0x180f34,_0x5117ba,_0x43d2cc);}}function startTimer(_0x500a79,_0x3c686f,_0x2312f8){const _0xd96522=a2_0x487b09;if(activeTimer)clearTimeout(activeTimer);timeoutMs=_0x3c686f*0x3c*0x3e8,startTime=Date[_0xd96522(0x11a)](),alarmStage=0x0;const _0x789741=calculateSleepProbability(_0x2312f8||currentMonitoredRoom),_0x3dc45a=_0x789741>0.65;_0x3dc45a?(timeoutMs+=0x5a*0x3c*0x3e8,_0x500a79[_0xd96522(0x10b)][_0xd96522(0xed)](_0xd96522(0xe2)+(_0x789741*0x64)[_0xd96522(0xe4)](0x0)+_0xd96522(0xf5)+currentMonitoredRoom+_0xd96522(0x117)),_0x500a79[_0xd96522(0xfc)]('analysis.safety.deadMan.smartSleep',{'val':!![],'ack':!![]})):_0x500a79[_0xd96522(0xfc)]('analysis.safety.deadMan.smartSleep',{'val':![],'ack':!![]}),_0x500a79[_0xd96522(0xfc)](_0xd96522(0x109),{'val':_0x789741,'ack':!![]}),_0x500a79[_0xd96522(0x10b)][_0xd96522(0xed)](_0xd96522(0xf4)+currentMonitoredRoom+_0xd96522(0xe5)+_0x3c686f+_0xd96522(0x108)),_0x500a79['setStateAsync'](_0xd96522(0x104),{'val':'ok','ack':!![]}),activeTimer=setTimeout(()=>triggerPreWarn(_0x500a79),timeoutMs);}function a2_0x4464(_0x5e9154,_0x471d82){const _0x553e2c=a2_0x1615();return a2_0x4464=function(_0x4d56a9,_0x1f91ac){_0x4d56a9=_0x4d56a9-0xe0;let _0x16158c=_0x553e2c[_0x4d56a9];return _0x16158c;},a2_0x4464(_0x5e9154,_0x471d82);}function resetTimer(_0x1a7049){const _0x14926b=a2_0x487b09;if(activeTimer)clearTimeout(activeTimer);activeTimer=null,currentMonitoredRoom=null,alarmStage=0x0,_0x1a7049[_0x14926b(0xfc)](_0x14926b(0x104),{'val':'ok','ack':!![]}),_0x1a7049[_0x14926b(0xfc)]('analysis.safety.deadMan.smartSleep',{'val':![],'ack':!![]}),_0x1a7049['setStateAsync'](_0x14926b(0x109),{'val':0x0,'ack':!![]});}async function triggerPreWarn(_0x18c163){const _0x19b4ac=a2_0x487b09;alarmStage=0x1,await _0x18c163[_0x19b4ac(0xfc)](_0x19b4ac(0x104),{'val':'pre_warn','ack':!![]});const _0x247f55=_0x19b4ac(0x100)+currentMonitoredRoom+_0x19b4ac(0x113);_0x18c163[_0x19b4ac(0x10b)][_0x19b4ac(0x112)](_0x19b4ac(0xfd)+_0x247f55),await setup[_0x19b4ac(0x10c)](_0x18c163,_0x19b4ac(0xee)+_0x247f55),activeTimer=setTimeout(()=>triggerAlarm(_0x18c163),0x5*0x3c*0x3e8);}function a2_0x1615(){const _0x813bc3=['getStateAsync','üëº\x20Schutzengel:\x20√úberwache\x20','%).\x20Verl√§ngere\x20Timer\x20f√ºr\x20','toLowerCase','[DeadMan]\x20Topology\x20check\x20failed:\x20','114740XgIYsP','analysis.safety.deadMan.lastIgnored','search','\x27.\x20Nicht\x20verbunden\x20mit\x20√ºberwachtem\x20\x27','setStateAsync','[DeadMan]\x20','\x20(Multi-Person\x20Filter)','./setup','‚è≥\x20ACHTUNG:\x20Ungew√∂hnlich\x20lange\x20Inaktivit√§t\x20in\x20','(((.+)+)+)+$','exports','Ignoriere\x20Bewegung\x20in\x20\x27','analysis.safety.deadMan.alarmState','119210DhqKZt','6ntWajv','apply','\x20Min.','analysis.safety.deadMan.napProbability','parse','log','sendNotification','living','analysis.safety.deadMan.config','analysis.topology.structure','wohn','getHours','warn','.\x20Alles\x20in\x20Ordnung?','6515416hCCnOW','default','includes','\x20um\x2090\x20Min.','error','message','now','üö®\x20NOTFALL-ALARM:\x20Person\x20reagiert\x20nicht\x20in\x20','400JeqrOM','121lNHLxM','alarm','toString','üí§\x20Smart\x20Sleep\x20erkannt\x20(','4829321MmdzVR','toFixed','\x20f√ºr\x20','186633bVGiTl','Unknown','363132rTBNOE','sofa','val','analysis.safety.deadMan.active','constructor','info','üëº\x20Schutzengel-Frage:\x20','2JCscNA','1034487VDbHRJ','65NewasO','indexOf'];a2_0x1615=function(){return _0x813bc3;};return a2_0x1615();}async function triggerAlarm(_0x5b34b4){const _0x2fa8cb=a2_0x487b09;alarmStage=0x2,await _0x5b34b4[_0x2fa8cb(0xfc)]('analysis.safety.deadMan.alarmState',{'val':_0x2fa8cb(0xe0),'ack':!![]});const _0x1da997=_0x2fa8cb(0x11b)+currentMonitoredRoom+'!';_0x5b34b4['log'][_0x2fa8cb(0x118)](_0x2fa8cb(0xfd)+_0x1da997),await setup['sendNotification'](_0x5b34b4,_0x1da997,![],!![]);}module[a2_0x487b09(0x102)]={'updateLocation':updateLocation};