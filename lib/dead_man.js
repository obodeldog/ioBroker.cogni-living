const a2_0x355fe2=a2_0x3531;(function(_0x4a8462,_0x4702e0){const _0x3bbd70=a2_0x3531,_0x9ccff5=_0x4a8462();while(!![]){try{const _0x28ca0b=-parseInt(_0x3bbd70(0xf2))/0x1+parseInt(_0x3bbd70(0x112))/0x2+-parseInt(_0x3bbd70(0x116))/0x3+-parseInt(_0x3bbd70(0x11a))/0x4*(-parseInt(_0x3bbd70(0xfd))/0x5)+parseInt(_0x3bbd70(0x10e))/0x6*(parseInt(_0x3bbd70(0x105))/0x7)+parseInt(_0x3bbd70(0xe3))/0x8*(-parseInt(_0x3bbd70(0xe8))/0x9)+parseInt(_0x3bbd70(0xe7))/0xa*(-parseInt(_0x3bbd70(0x104))/0xb);if(_0x28ca0b===_0x4702e0)break;else _0x9ccff5['push'](_0x9ccff5['shift']());}catch(_0x58065f){_0x9ccff5['push'](_0x9ccff5['shift']());}}}(a2_0xd632,0xc1c5c));function a2_0x3531(_0x149f4c,_0x2b1c74){const _0x3b1e1e=a2_0xd632();return a2_0x3531=function(_0x2b004e,_0x45cbcc){_0x2b004e=_0x2b004e-0xe2;let _0xd6323c=_0x3b1e1e[_0x2b004e];return _0xd6323c;},a2_0x3531(_0x149f4c,_0x2b1c74);}const a2_0x45cbcc=(function(){let _0x50d684=!![];return function(_0x5aee3f,_0x2423e0){const _0x416c04=_0x50d684?function(){const _0x52277e=a2_0x3531;if(_0x2423e0){const _0x25dd2f=_0x2423e0[_0x52277e(0xe6)](_0x5aee3f,arguments);return _0x2423e0=null,_0x25dd2f;}}:function(){};return _0x50d684=![],_0x416c04;};}()),a2_0x2b004e=a2_0x45cbcc(this,function(){const _0xeade53=a2_0x3531;return a2_0x2b004e['toString']()[_0xeade53(0xfe)]('(((.+)+)+)+$')[_0xeade53(0xf8)]()['constructor'](a2_0x2b004e)[_0xeade53(0xfe)](_0xeade53(0xe4));});a2_0x2b004e();'use strict';const setup=require(a2_0x355fe2(0xf6));let activeTimer=null,currentMonitoredRoom=null,timeoutMs=0x0,startTime=0x0,alarmStage=0x0;const DEFAULT_TIMEOUTS={'bad':0x2d,'bath':0x2d,'toilet':0x1e,'wc':0x1e,'keller':0x3c,'schlaf':0x78,'bed':0x78,'guest':0x5a,'gast':0x5a};function getTimeoutRobust(_0x536063,_0x10248f){const _0x5d0e12=a2_0x355fe2;if(!_0x536063||!_0x10248f)return undefined;if(_0x536063[_0x10248f])return _0x536063[_0x10248f];const _0x223886=_0x10248f[_0x5d0e12(0x11b)]()[_0x5d0e12(0x101)](/[^a-z0-9]/g,'');for(const _0x11857c in _0x536063){const _0x91bac0=_0x11857c[_0x5d0e12(0x11b)]()[_0x5d0e12(0x101)](/[^a-z0-9]/g,'');if(_0x91bac0===_0x223886)return _0x536063[_0x11857c];}const _0x3565ad=_0x10248f['toLowerCase']();if(_0x536063[_0x3565ad])return _0x536063[_0x3565ad];return undefined;}async function loadConfig(_0x5e294b){const _0xa9bd33=a2_0x355fe2;try{const _0x14b0c0=await _0x5e294b[_0xa9bd33(0x115)]('analysis.safety.deadMan.config');if(_0x14b0c0&&_0x14b0c0[_0xa9bd33(0x108)])return JSON['parse'](_0x14b0c0[_0xa9bd33(0x108)]);}catch(_0x2ab3be){}return{};}async function isActive(_0x3dc3be){const _0x4f538f=a2_0x355fe2;try{const _0x398694=await _0x3dc3be[_0x4f538f(0x115)](_0x4f538f(0xfb));return _0x398694&&_0x398694[_0x4f538f(0x108)];}catch(_0x1af829){return![];}}async function areRoomsConnected(_0x4c01ce,_0x5ac332,_0x2b097e){const _0x2d33ab=a2_0x355fe2;try{const _0x5f9d39=await _0x4c01ce[_0x2d33ab(0x115)]('analysis.topology.structure');if(!_0x5f9d39||!_0x5f9d39[_0x2d33ab(0x108)])return!![];const _0x25dd86=JSON[_0x2d33ab(0x10b)](_0x5f9d39['val']),{rooms:_0x1737c2,matrix:_0x4a8606}=_0x25dd86;if(!_0x1737c2||!_0x4a8606)return!![];const _0x5475b5=_0x1737c2[_0x2d33ab(0x11c)](_0x5ac332),_0x39d4fb=_0x1737c2[_0x2d33ab(0x11c)](_0x2b097e);if(_0x5475b5===-0x1||_0x39d4fb===-0x1)return!![];const _0x4f8aa0=_0x4a8606[_0x5475b5][_0x39d4fb]>0x0||_0x4a8606[_0x39d4fb][_0x5475b5]>0x0;return _0x4f8aa0;}catch(_0x3e3cc6){return _0x4c01ce[_0x2d33ab(0xfa)][_0x2d33ab(0xeb)](_0x2d33ab(0x10f)+_0x3e3cc6[_0x2d33ab(0xef)]),!![];}}function calculateSleepProbability(_0x3c8098){const _0x38fd02=a2_0x355fe2,_0x455dc1=new Date(),_0x5b330f=_0x455dc1['getHours'](),_0x569fda=_0x3c8098[_0x38fd02(0x11b)]();let _0x3c63e4=0.1;if(_0x5b330f>=0x17||_0x5b330f<=0x6)_0x3c63e4=0x1;else{if(_0x5b330f>=0xd&&_0x5b330f<=0xf)_0x3c63e4=0.8;else{if(_0x5b330f>=0x14&&_0x5b330f<=0x17)_0x3c63e4=0.4;}}let _0x522111=0.1;if(_0x569fda[_0x38fd02(0xe9)](_0x38fd02(0x11d))||_0x569fda[_0x38fd02(0xe9)](_0x38fd02(0xf3)))_0x522111=0x1;else{if(_0x569fda[_0x38fd02(0xe9)](_0x38fd02(0xec))||_0x569fda[_0x38fd02(0xe9)](_0x38fd02(0x107))||_0x569fda[_0x38fd02(0xe9)](_0x38fd02(0xf0)))_0x522111=0.6;else{if(_0x569fda['includes'](_0x38fd02(0xe5))||_0x569fda['includes']('wc'))_0x522111=0.05;}}let _0xe4f6da=0.5;const _0x504262=_0x522111*0.5+_0x3c63e4*0.3+_0xe4f6da*0.2;return parseFloat(_0x504262['toFixed'](0x2));}async function updateLocation(_0x9fdc39,_0x59ba84){const _0x4ea18c=a2_0x355fe2;if(!_0x59ba84||_0x59ba84===_0x4ea18c(0xfc))return;if(!await isActive(_0x9fdc39)){resetTimer(_0x9fdc39);return;}if(currentMonitoredRoom&&currentMonitoredRoom!==_0x59ba84){const _0x31a070=await areRoomsConnected(_0x9fdc39,currentMonitoredRoom,_0x59ba84);if(!_0x31a070){const _0x5b7fc5='Ignoriere\x20Bewegung\x20in\x20\x27'+_0x59ba84+_0x4ea18c(0xff)+currentMonitoredRoom+'\x27.';_0x9fdc39[_0x4ea18c(0xfa)]['info'](_0x4ea18c(0x10d)+_0x5b7fc5+_0x4ea18c(0x103)),await _0x9fdc39[_0x4ea18c(0xf5)](_0x4ea18c(0x109),{'val':JSON['stringify']({'room':_0x59ba84,'reason':_0x5b7fc5,'timestamp':Date[_0x4ea18c(0xed)]()}),'ack':!![]});return;}resetTimer(_0x9fdc39);}if(!currentMonitoredRoom){await _0x9fdc39['setStateAsync'](_0x4ea18c(0xea),{'val':_0x59ba84,'ack':!![]});const _0x31fa02=await loadConfig(_0x9fdc39);let _0x1e484b=getTimeoutRobust(_0x31fa02,_0x59ba84);const _0x1b9415=_0x59ba84[_0x4ea18c(0x11b)]();if(!_0x1e484b)for(const _0x2e4e47 in DEFAULT_TIMEOUTS){if(_0x1b9415['includes'](_0x2e4e47)){_0x1e484b=DEFAULT_TIMEOUTS[_0x2e4e47];break;}}if(!_0x1e484b&&_0x31fa02[_0x4ea18c(0x118)])_0x1e484b=_0x31fa02['default'];if(!_0x1e484b)return;currentMonitoredRoom=_0x59ba84,startTimer(_0x9fdc39,_0x1e484b,_0x59ba84);}}function startTimer(_0xd27dda,_0x21372f,_0x20c167){const _0x7e4c2e=a2_0x355fe2;if(activeTimer)clearTimeout(activeTimer);timeoutMs=_0x21372f*0x3c*0x3e8,startTime=Date['now'](),alarmStage=0x0;const _0x3c42d4=calculateSleepProbability(_0x20c167||currentMonitoredRoom),_0xf7e36a=_0x3c42d4>0.65;_0xf7e36a?(timeoutMs+=0x5a*0x3c*0x3e8,_0xd27dda['log'][_0x7e4c2e(0x102)]('ðŸ’¤\x20Smart\x20Sleep\x20erkannt\x20('+(_0x3c42d4*0x64)[_0x7e4c2e(0xf7)](0x0)+'%).\x20VerlÃ¤ngere\x20Timer\x20fÃ¼r\x20'+currentMonitoredRoom+_0x7e4c2e(0x100)),_0xd27dda['setStateAsync'](_0x7e4c2e(0xee),{'val':!![],'ack':!![]})):_0xd27dda[_0x7e4c2e(0xf5)]('analysis.safety.deadMan.smartSleep',{'val':![],'ack':!![]}),_0xd27dda[_0x7e4c2e(0xf5)](_0x7e4c2e(0x119),{'val':_0x3c42d4,'ack':!![]}),_0xd27dda[_0x7e4c2e(0xfa)][_0x7e4c2e(0x102)](_0x7e4c2e(0x111)+currentMonitoredRoom+_0x7e4c2e(0x10a)+_0x21372f+_0x7e4c2e(0xf1)),_0xd27dda[_0x7e4c2e(0xf5)](_0x7e4c2e(0x110),{'val':'ok','ack':!![]}),activeTimer=setTimeout(()=>triggerPreWarn(_0xd27dda),timeoutMs);}function resetTimer(_0x416322){const _0x12c678=a2_0x355fe2;if(activeTimer)clearTimeout(activeTimer);activeTimer=null,currentMonitoredRoom=null,alarmStage=0x0,_0x416322[_0x12c678(0xf5)]('analysis.safety.deadMan.alarmState',{'val':'ok','ack':!![]}),_0x416322[_0x12c678(0xf5)](_0x12c678(0xee),{'val':![],'ack':!![]}),_0x416322['setStateAsync'](_0x12c678(0x119),{'val':0x0,'ack':!![]});}function a2_0xd632(){const _0x50e13f=['ðŸ‘¼\x20Schutzengel-Frage:\x20','setStateAsync','./setup','toFixed','toString','error','log','analysis.safety.deadMan.active','Unknown','522335YcrAwF','search','\x27.\x20Nicht\x20verbunden\x20mit\x20Ã¼berwachtem\x20\x27','\x20um\x2090\x20Min.','replace','info','\x20(Multi-Person\x20Filter)','99MDGLuF','1855LyOYqz','â³\x20ACHTUNG:\x20UngewÃ¶hnlich\x20lange\x20InaktivitÃ¤t\x20in\x20','living','val','analysis.safety.deadMan.lastIgnored','\x20fÃ¼r\x20','parse','ðŸš¨\x20NOTFALL-ALARM:\x20Person\x20reagiert\x20nicht\x20in\x20','[DeadMan]\x20','18726dXQygV','[DeadMan]\x20Topology\x20check\x20failed:\x20','analysis.safety.deadMan.alarmState','ðŸ‘¼\x20Schutzengel:\x20Ãœberwache\x20','2951030rVVsUF','sendNotification','.\x20Alles\x20in\x20Ordnung?','getStateAsync','3832635drgPZa','pre_warn','default','analysis.safety.deadMan.napProbability','60DjEabF','toLowerCase','indexOf','schlaf','alarm','200pUcTeH','(((.+)+)+)+$','bad','apply','135580HYMwTY','530388BJZZXG','includes','analysis.safety.deadMan.currentRoom','warn','wohn','now','analysis.safety.deadMan.smartSleep','message','sofa','\x20Min.','203026IpBxyC','bed'];a2_0xd632=function(){return _0x50e13f;};return a2_0xd632();}async function triggerPreWarn(_0x5dcc23){const _0x2c8d83=a2_0x355fe2;alarmStage=0x1,await _0x5dcc23['setStateAsync'](_0x2c8d83(0x110),{'val':_0x2c8d83(0x117),'ack':!![]});const _0x5c8a19=_0x2c8d83(0x106)+currentMonitoredRoom+_0x2c8d83(0x114);_0x5dcc23[_0x2c8d83(0xfa)][_0x2c8d83(0xeb)](_0x2c8d83(0x10d)+_0x5c8a19),await setup['sendNotification'](_0x5dcc23,_0x2c8d83(0xf4)+_0x5c8a19),activeTimer=setTimeout(()=>triggerAlarm(_0x5dcc23),0x5*0x3c*0x3e8);}async function triggerAlarm(_0x39bffa){const _0xd9080c=a2_0x355fe2;alarmStage=0x2,await _0x39bffa[_0xd9080c(0xf5)](_0xd9080c(0x110),{'val':_0xd9080c(0xe2),'ack':!![]});const _0x317273=_0xd9080c(0x10c)+currentMonitoredRoom+'!';_0x39bffa[_0xd9080c(0xfa)][_0xd9080c(0xf9)](_0xd9080c(0x10d)+_0x317273),await setup[_0xd9080c(0x113)](_0x39bffa,_0x317273,![],!![]);}module['exports']={'updateLocation':updateLocation};