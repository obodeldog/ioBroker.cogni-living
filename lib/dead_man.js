const a2_0x31c7b5=a2_0x66ea;function a2_0xf42a(){const _0x1d5f36=['analysis.safety.deadMan.active','8137262LUnOIv','search','analysis.topology.structure','includes','ðŸ‘¼\x20Schutzengel-Frage:\x20','\x27.\x20Nicht\x20verbunden\x20mit\x20Ã¼berwachtem\x20\x27','analysis.safety.deadMan.napProbability','getStateAsync','Ignoriere\x20Bewegung\x20in\x20\x27','ðŸ’¤\x20Smart\x20Sleep\x20erkannt\x20(','1138002TIHHtY','3412WcBOpk','analysis.safety.deadMan.alarmState','info','1407150EpliFR','[DeadMan]\x20Topology\x20check\x20failed:\x20','apply','analysis.safety.deadMan.currentRoom','parse','analysis.safety.deadMan.smartSleep','log','message','living','66DZVjFQ','sofa','indexOf','setStateAsync','wohn','.\x20Alles\x20in\x20Ordnung?','â³\x20ACHTUNG:\x20UngewÃ¶hnlich\x20lange\x20InaktivitÃ¤t\x20in\x20','ðŸ‘¼\x20Schutzengel:\x20Ãœberwache\x20','[DeadMan]\x20','error','exports','analysis.safety.deadMan.lastIgnored','pre_warn','ðŸš¨\x20NOTFALL-ALARM:\x20Person\x20reagiert\x20nicht\x20in\x20','default','getHours','toFixed','./setup','analysis.safety.deadMan.config','\x20(Multi-Person\x20Filter)','val','warn','\x20um\x2090\x20Min.','\x20Min.','\x20fÃ¼r\x20','now','bad','10455120ZgZTLH','709844EQqLGa','5732125yjjPKQ','replace','toLowerCase','schlaf','Unknown','sendNotification','toString'];a2_0xf42a=function(){return _0x1d5f36;};return a2_0xf42a();}(function(_0x1b1a8f,_0x3d8ce9){const _0x261416=a2_0x66ea,_0x5ac415=_0x1b1a8f();while(!![]){try{const _0x2f027c=parseInt(_0x261416(0x7e))/0x1*(parseInt(_0x261416(0x8a))/0x2)+-parseInt(_0x261416(0x81))/0x3+parseInt(_0x261416(0x6a))/0x4+parseInt(_0x261416(0x6b))/0x5+-parseInt(_0x261416(0x7d))/0x6+parseInt(_0x261416(0x73))/0x7+-parseInt(_0x261416(0xa5))/0x8;if(_0x2f027c===_0x3d8ce9)break;else _0x5ac415['push'](_0x5ac415['shift']());}catch(_0x257c78){_0x5ac415['push'](_0x5ac415['shift']());}}}(a2_0xf42a,0x9a9fd));const a2_0x4a329d=(function(){let _0x3ddc51=!![];return function(_0x91a29a,_0x195b83){const _0x421d4e=_0x3ddc51?function(){const _0x5b7d3c=a2_0x66ea;if(_0x195b83){const _0x3c1cc3=_0x195b83[_0x5b7d3c(0x83)](_0x91a29a,arguments);return _0x195b83=null,_0x3c1cc3;}}:function(){};return _0x3ddc51=![],_0x421d4e;};}()),a2_0x91a6f9=a2_0x4a329d(this,function(){const _0x2f916c=a2_0x66ea;return a2_0x91a6f9[_0x2f916c(0x71)]()[_0x2f916c(0x74)]('(((.+)+)+)+$')[_0x2f916c(0x71)]()['constructor'](a2_0x91a6f9)['search']('(((.+)+)+)+$');});a2_0x91a6f9();'use strict';const setup=require(a2_0x31c7b5(0x9b));let activeTimer=null,currentMonitoredRoom=null,timeoutMs=0x0,startTime=0x0,alarmStage=0x0;function a2_0x66ea(_0x41bf8f,_0x3fd3ae){const _0x3eac8e=a2_0xf42a();return a2_0x66ea=function(_0x91a6f9,_0x4a329d){_0x91a6f9=_0x91a6f9-0x6a;let _0xf42a44=_0x3eac8e[_0x91a6f9];return _0xf42a44;},a2_0x66ea(_0x41bf8f,_0x3fd3ae);}const DEFAULT_TIMEOUTS={'bad':0x2d,'bath':0x2d,'toilet':0x1e,'wc':0x1e,'keller':0x3c,'schlaf':0x78,'bed':0x78,'guest':0x5a,'gast':0x5a};function getTimeoutRobust(_0x5e5fdf,_0x3a74dd){const _0x11faf9=a2_0x31c7b5;if(!_0x5e5fdf||!_0x3a74dd)return undefined;if(_0x5e5fdf[_0x3a74dd])return _0x5e5fdf[_0x3a74dd];const _0x1bdd9f=_0x3a74dd[_0x11faf9(0x6d)]()[_0x11faf9(0x6c)](/[^a-z0-9]/g,'');for(const _0xed3509 in _0x5e5fdf){const _0x17f996=_0xed3509[_0x11faf9(0x6d)]()[_0x11faf9(0x6c)](/[^a-z0-9]/g,'');if(_0x17f996===_0x1bdd9f)return _0x5e5fdf[_0xed3509];}const _0x5f10ce=_0x3a74dd[_0x11faf9(0x6d)]();if(_0x5e5fdf[_0x5f10ce])return _0x5e5fdf[_0x5f10ce];return undefined;}async function loadConfig(_0x56948b){const _0x51073f=a2_0x31c7b5;try{const _0x3d23ad=await _0x56948b[_0x51073f(0x7a)](_0x51073f(0x9c));if(_0x3d23ad&&_0x3d23ad['val'])return JSON[_0x51073f(0x85)](_0x3d23ad[_0x51073f(0x9e)]);}catch(_0xa2ee17){}return{};}async function isActive(_0x3e0d9b){const _0x545967=a2_0x31c7b5;try{const _0x3ee672=await _0x3e0d9b[_0x545967(0x7a)](_0x545967(0x72));return _0x3ee672&&_0x3ee672['val'];}catch(_0x4b31bb){return![];}}async function areRoomsConnected(_0x262649,_0x21491e,_0x5a469c){const _0x4d0d50=a2_0x31c7b5;try{const _0x4c006e=await _0x262649[_0x4d0d50(0x7a)](_0x4d0d50(0x75));if(!_0x4c006e||!_0x4c006e[_0x4d0d50(0x9e)])return!![];const _0x20c26c=JSON[_0x4d0d50(0x85)](_0x4c006e['val']),{rooms:_0x139312,matrix:_0x3a31fb}=_0x20c26c;if(!_0x139312||!_0x3a31fb)return!![];const _0x1fc2a2=_0x139312[_0x4d0d50(0x8c)](_0x21491e),_0x460c10=_0x139312[_0x4d0d50(0x8c)](_0x5a469c);if(_0x1fc2a2===-0x1||_0x460c10===-0x1)return!![];const _0xbd7748=_0x3a31fb[_0x1fc2a2][_0x460c10]>0x0||_0x3a31fb[_0x460c10][_0x1fc2a2]>0x0;return _0xbd7748;}catch(_0x747c1f){return _0x262649[_0x4d0d50(0x87)][_0x4d0d50(0x9f)](_0x4d0d50(0x82)+_0x747c1f[_0x4d0d50(0x88)]),!![];}}function calculateSleepProbability(_0x2a7054){const _0x5d8180=a2_0x31c7b5,_0x3ccfc1=new Date(),_0x501add=_0x3ccfc1[_0x5d8180(0x99)](),_0x22bd39=_0x2a7054[_0x5d8180(0x6d)]();let _0x3d3835=0.1;if(_0x501add>=0x17||_0x501add<=0x6)_0x3d3835=0x1;else{if(_0x501add>=0xd&&_0x501add<=0xf)_0x3d3835=0.8;else{if(_0x501add>=0x14&&_0x501add<=0x17)_0x3d3835=0.4;}}let _0xa2e26b=0.1;if(_0x22bd39['includes'](_0x5d8180(0x6e))||_0x22bd39['includes']('bed'))_0xa2e26b=0x1;else{if(_0x22bd39[_0x5d8180(0x76)](_0x5d8180(0x8e))||_0x22bd39[_0x5d8180(0x76)](_0x5d8180(0x89))||_0x22bd39[_0x5d8180(0x76)](_0x5d8180(0x8b)))_0xa2e26b=0.6;else{if(_0x22bd39[_0x5d8180(0x76)](_0x5d8180(0xa4))||_0x22bd39[_0x5d8180(0x76)]('wc'))_0xa2e26b=0.05;}}let _0x4baa60=0.5;const _0x14f49a=_0xa2e26b*0.5+_0x3d3835*0.3+_0x4baa60*0.2;return parseFloat(_0x14f49a[_0x5d8180(0x9a)](0x2));}async function updateLocation(_0x1c8fa7,_0x3bec58){const _0x46e95d=a2_0x31c7b5;if(!_0x3bec58||_0x3bec58===_0x46e95d(0x6f))return;if(!await isActive(_0x1c8fa7)){resetTimer(_0x1c8fa7);return;}if(currentMonitoredRoom&&currentMonitoredRoom!==_0x3bec58){const _0x73dcd1=await areRoomsConnected(_0x1c8fa7,currentMonitoredRoom,_0x3bec58);if(!_0x73dcd1){const _0x427bc3=_0x46e95d(0x7b)+_0x3bec58+_0x46e95d(0x78)+currentMonitoredRoom+'\x27.';_0x1c8fa7[_0x46e95d(0x87)][_0x46e95d(0x80)](_0x46e95d(0x92)+_0x427bc3+_0x46e95d(0x9d)),await _0x1c8fa7[_0x46e95d(0x8d)](_0x46e95d(0x95),{'val':JSON['stringify']({'room':_0x3bec58,'reason':_0x427bc3,'timestamp':Date['now']()}),'ack':!![]});return;}resetTimer(_0x1c8fa7);}if(!currentMonitoredRoom){await _0x1c8fa7['setStateAsync'](_0x46e95d(0x84),{'val':_0x3bec58,'ack':!![]});const _0x5a883c=await loadConfig(_0x1c8fa7);let _0x1fa95c=getTimeoutRobust(_0x5a883c,_0x3bec58);const _0x218d03=_0x3bec58[_0x46e95d(0x6d)]();if(!_0x1fa95c)for(const _0x2d5553 in DEFAULT_TIMEOUTS){if(_0x218d03[_0x46e95d(0x76)](_0x2d5553)){_0x1fa95c=DEFAULT_TIMEOUTS[_0x2d5553];break;}}if(!_0x1fa95c&&_0x5a883c[_0x46e95d(0x98)])_0x1fa95c=_0x5a883c[_0x46e95d(0x98)];if(!_0x1fa95c)return;currentMonitoredRoom=_0x3bec58,startTimer(_0x1c8fa7,_0x1fa95c,_0x3bec58);}}function startTimer(_0x4be172,_0x3fc7ed,_0x396164){const _0x448407=a2_0x31c7b5;if(activeTimer)clearTimeout(activeTimer);timeoutMs=_0x3fc7ed*0x3c*0x3e8,startTime=Date[_0x448407(0xa3)](),alarmStage=0x0;const _0x510659=calculateSleepProbability(_0x396164||currentMonitoredRoom),_0x428172=_0x510659>0.65;_0x428172?(timeoutMs+=0x5a*0x3c*0x3e8,_0x4be172[_0x448407(0x87)]['info'](_0x448407(0x7c)+(_0x510659*0x64)[_0x448407(0x9a)](0x0)+'%).\x20VerlÃ¤ngere\x20Timer\x20fÃ¼r\x20'+currentMonitoredRoom+_0x448407(0xa0)),_0x4be172[_0x448407(0x8d)](_0x448407(0x86),{'val':!![],'ack':!![]})):_0x4be172[_0x448407(0x8d)]('analysis.safety.deadMan.smartSleep',{'val':![],'ack':!![]}),_0x4be172[_0x448407(0x8d)](_0x448407(0x79),{'val':_0x510659,'ack':!![]}),_0x4be172['log'][_0x448407(0x80)](_0x448407(0x91)+currentMonitoredRoom+_0x448407(0xa2)+_0x3fc7ed+_0x448407(0xa1)),_0x4be172[_0x448407(0x8d)]('analysis.safety.deadMan.alarmState',{'val':'ok','ack':!![]}),activeTimer=setTimeout(()=>triggerPreWarn(_0x4be172),timeoutMs);}function resetTimer(_0x407328){const _0x17ffd9=a2_0x31c7b5;if(activeTimer)clearTimeout(activeTimer);activeTimer=null,currentMonitoredRoom=null,alarmStage=0x0,_0x407328['setStateAsync'](_0x17ffd9(0x7f),{'val':'ok','ack':!![]}),_0x407328['setStateAsync']('analysis.safety.deadMan.smartSleep',{'val':![],'ack':!![]}),_0x407328[_0x17ffd9(0x8d)]('analysis.safety.deadMan.napProbability',{'val':0x0,'ack':!![]});}async function triggerPreWarn(_0xc3e4c5){const _0x2dc263=a2_0x31c7b5;alarmStage=0x1,await _0xc3e4c5['setStateAsync']('analysis.safety.deadMan.alarmState',{'val':_0x2dc263(0x96),'ack':!![]});const _0x545ad7=_0x2dc263(0x90)+currentMonitoredRoom+_0x2dc263(0x8f);_0xc3e4c5['log']['warn'](_0x2dc263(0x92)+_0x545ad7),await setup['sendNotification'](_0xc3e4c5,_0x2dc263(0x77)+_0x545ad7),activeTimer=setTimeout(()=>triggerAlarm(_0xc3e4c5),0x5*0x3c*0x3e8);}async function triggerAlarm(_0x3680c8){const _0x5b536f=a2_0x31c7b5;alarmStage=0x2,await _0x3680c8[_0x5b536f(0x8d)](_0x5b536f(0x7f),{'val':'alarm','ack':!![]});const _0x5af79e=_0x5b536f(0x97)+currentMonitoredRoom+'!';_0x3680c8[_0x5b536f(0x87)][_0x5b536f(0x93)](_0x5b536f(0x92)+_0x5af79e),await setup[_0x5b536f(0x70)](_0x3680c8,_0x5af79e,![],!![]);}module[a2_0x31c7b5(0x94)]={'updateLocation':updateLocation};