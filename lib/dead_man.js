const a2_0x1ebc53=a2_0x3b4f;(function(_0x11f7a8,_0xfbf0d){const _0x4d3195=a2_0x3b4f,_0x1bb39d=_0x11f7a8();while(!![]){try{const _0x44431d=parseInt(_0x4d3195(0x1b4))/0x1+parseInt(_0x4d3195(0x1cf))/0x2*(-parseInt(_0x4d3195(0x1cb))/0x3)+-parseInt(_0x4d3195(0x1bb))/0x4+parseInt(_0x4d3195(0x1b3))/0x5*(-parseInt(_0x4d3195(0x1bf))/0x6)+-parseInt(_0x4d3195(0x1b5))/0x7+-parseInt(_0x4d3195(0x1d6))/0x8*(-parseInt(_0x4d3195(0x1a7))/0x9)+parseInt(_0x4d3195(0x1b8))/0xa;if(_0x44431d===_0xfbf0d)break;else _0x1bb39d['push'](_0x1bb39d['shift']());}catch(_0x339d63){_0x1bb39d['push'](_0x1bb39d['shift']());}}}(a2_0x44fb,0x44233));const a2_0x35f24d=(function(){let _0x215d23=!![];return function(_0x15f429,_0x4df0a3){const _0x208101=_0x215d23?function(){const _0x3b9d33=a2_0x3b4f;if(_0x4df0a3){const _0x91fc6e=_0x4df0a3[_0x3b9d33(0x1c0)](_0x15f429,arguments);return _0x4df0a3=null,_0x91fc6e;}}:function(){};return _0x215d23=![],_0x208101;};}()),a2_0x3fa73e=a2_0x35f24d(this,function(){const _0x372f2e=a2_0x3b4f;return a2_0x3fa73e[_0x372f2e(0x1b1)]()['search'](_0x372f2e(0x1ce))[_0x372f2e(0x1b1)]()[_0x372f2e(0x1a9)](a2_0x3fa73e)['search'](_0x372f2e(0x1ce));});a2_0x3fa73e();'use strict';const setup=require(a2_0x1ebc53(0x1bd));let activeTimer=null,currentMonitoredRoom=null,timeoutMs=0x0,startTime=0x0,alarmStage=0x0;const DEFAULT_TIMEOUTS={'bad':0x2d,'bath':0x2d,'toilet':0x1e,'wc':0x1e,'keller':0x3c,'schlaf':0x78,'bed':0x78,'guest':0x5a,'gast':0x5a};function a2_0x3b4f(_0x252390,_0x120220){const _0x482d82=a2_0x44fb();return a2_0x3b4f=function(_0x3fa73e,_0x35f24d){_0x3fa73e=_0x3fa73e-0x1a7;let _0x44fb98=_0x482d82[_0x3fa73e];return _0x44fb98;},a2_0x3b4f(_0x252390,_0x120220);}async function loadConfig(_0x1e32bd){const _0x195085=a2_0x1ebc53;try{const _0x171dfa=await _0x1e32bd['getStateAsync'](_0x195085(0x1be));if(_0x171dfa&&_0x171dfa['val'])return JSON[_0x195085(0x1d0)](_0x171dfa[_0x195085(0x1ab)]);}catch(_0x243594){}return{};}async function isActive(_0x3ce16b){const _0x3207a4=a2_0x1ebc53;try{const _0x279f5e=await _0x3ce16b[_0x3207a4(0x1da)]('analysis.safety.deadMan.active');return _0x279f5e&&_0x279f5e[_0x3207a4(0x1ab)];}catch(_0x226084){return![];}}async function areRoomsConnected(_0x1de0bf,_0x4c8f78,_0x4f650d){const _0x17361c=a2_0x1ebc53;try{const _0x39b5f7=await _0x1de0bf[_0x17361c(0x1da)](_0x17361c(0x1d2));if(!_0x39b5f7||!_0x39b5f7[_0x17361c(0x1ab)])return!![];const _0x4fa941=JSON[_0x17361c(0x1d0)](_0x39b5f7['val']),{rooms:_0x3365d9,matrix:_0x5100c9}=_0x4fa941;if(!_0x3365d9||!_0x5100c9)return!![];const _0x4d81e7=_0x3365d9[_0x17361c(0x1d4)](_0x4c8f78),_0xdc25d0=_0x3365d9[_0x17361c(0x1d4)](_0x4f650d);if(_0x4d81e7===-0x1||_0xdc25d0===-0x1)return!![];const _0x1d5388=_0x5100c9[_0x4d81e7][_0xdc25d0]>0x0||_0x5100c9[_0xdc25d0][_0x4d81e7]>0x0;return _0x1d5388;}catch(_0x9a0c7b){return _0x1de0bf[_0x17361c(0x1b9)][_0x17361c(0x1c5)](_0x17361c(0x1bc)+_0x9a0c7b[_0x17361c(0x1b7)]),!![];}}function calculateSleepProbability(_0x18961){const _0x3b6925=a2_0x1ebc53,_0x5263fc=new Date(),_0x1fef58=_0x5263fc['getHours'](),_0x2933f9=_0x18961[_0x3b6925(0x1ae)]();let _0x31f28f=0.1;if(_0x1fef58>=0x17||_0x1fef58<=0x6)_0x31f28f=0x1;else{if(_0x1fef58>=0xd&&_0x1fef58<=0xf)_0x31f28f=0.8;else{if(_0x1fef58>=0x14&&_0x1fef58<=0x17)_0x31f28f=0.4;}}let _0x32bc93=0.1;if(_0x2933f9[_0x3b6925(0x1d1)]('schlaf')||_0x2933f9[_0x3b6925(0x1d1)](_0x3b6925(0x1d7)))_0x32bc93=0x1;else{if(_0x2933f9[_0x3b6925(0x1d1)](_0x3b6925(0x1cd))||_0x2933f9[_0x3b6925(0x1d1)](_0x3b6925(0x1ba))||_0x2933f9[_0x3b6925(0x1d1)](_0x3b6925(0x1cc)))_0x32bc93=0.6;else{if(_0x2933f9[_0x3b6925(0x1d1)](_0x3b6925(0x1b2))||_0x2933f9['includes']('wc'))_0x32bc93=0.05;}}let _0x20e581=0.5;const _0x4ad04c=_0x32bc93*0.5+_0x31f28f*0.3+_0x20e581*0.2;return parseFloat(_0x4ad04c[_0x3b6925(0x1b6)](0x2));}async function updateLocation(_0x25f161,_0x2015f1){const _0x1189c9=a2_0x1ebc53;if(!_0x2015f1||_0x2015f1==='Unknown')return;if(!await isActive(_0x25f161)){resetTimer(_0x25f161);return;}if(currentMonitoredRoom&&currentMonitoredRoom!==_0x2015f1){const _0x4c8176=await areRoomsConnected(_0x25f161,currentMonitoredRoom,_0x2015f1);if(!_0x4c8176){const _0x584546=_0x1189c9(0x1c9)+_0x2015f1+_0x1189c9(0x1d9)+currentMonitoredRoom+'\x27.';_0x25f161['log'][_0x1189c9(0x1ca)](_0x1189c9(0x1c8)+_0x584546+'\x20(Multi-Person\x20Filter)'),await _0x25f161[_0x1189c9(0x1d5)](_0x1189c9(0x1c7),{'val':JSON['stringify']({'room':_0x2015f1,'reason':_0x584546,'timestamp':Date['now']()}),'ack':!![]});return;}resetTimer(_0x25f161);}if(!currentMonitoredRoom){await _0x25f161['setStateAsync']('analysis.safety.deadMan.currentRoom',{'val':_0x2015f1,'ack':!![]});const _0x339595=await loadConfig(_0x25f161),_0x176fb5=_0x2015f1[_0x1189c9(0x1ae)]();let _0x2f614c=_0x339595[_0x2015f1]||_0x339595[_0x176fb5];if(!_0x2f614c)for(const _0x7fa808 in DEFAULT_TIMEOUTS){if(_0x176fb5[_0x1189c9(0x1d1)](_0x7fa808)){_0x2f614c=DEFAULT_TIMEOUTS[_0x7fa808];break;}}if(!_0x2f614c&&_0x339595['default'])_0x2f614c=_0x339595[_0x1189c9(0x1aa)];if(!_0x2f614c)return;currentMonitoredRoom=_0x2015f1,startTimer(_0x25f161,_0x2f614c,_0x2015f1);}}function a2_0x44fb(){const _0x48e0d5=['(((.+)+)+)+$','187622ynXPtq','parse','includes','analysis.topology.structure','sendNotification','indexOf','setStateAsync','896136sXkjzP','bed','alarm','\x27.\x20Nicht\x20verbunden\x20mit\x20Ã¼berwachtem\x20\x27','getStateAsync','ðŸš¨\x20NOTFALL-ALARM:\x20Person\x20reagiert\x20nicht\x20in\x20','now','27LwRVkI','pre_warn','constructor','default','val','%).\x20VerlÃ¤ngere\x20Timer\x20fÃ¼r\x20','\x20um\x2090\x20Min.','toLowerCase','ðŸ‘¼\x20Schutzengel-Frage:\x20','.\x20Alles\x20in\x20Ordnung?','toString','bad','35bIMyTu','546074xQSeKs','1111033qdjdUD','toFixed','message','4358760UKHZpi','log','living','1232736dSRZWD','[DeadMan]\x20Topology\x20check\x20failed:\x20','./setup','analysis.safety.deadMan.config','168654ejJuVb','apply','analysis.safety.deadMan.napProbability','\x20Min.','analysis.safety.deadMan.alarmState','analysis.safety.deadMan.smartSleep','warn','ðŸ’¤\x20Smart\x20Sleep\x20erkannt\x20(','analysis.safety.deadMan.lastIgnored','[DeadMan]\x20','Ignoriere\x20Bewegung\x20in\x20\x27','info','12HzMlFg','sofa','wohn'];a2_0x44fb=function(){return _0x48e0d5;};return a2_0x44fb();}function startTimer(_0x3ccca4,_0x39db15,_0x2b6a34){const _0x4fea27=a2_0x1ebc53;if(activeTimer)clearTimeout(activeTimer);timeoutMs=_0x39db15*0x3c*0x3e8,startTime=Date[_0x4fea27(0x1dc)](),alarmStage=0x0;const _0x6c2a57=calculateSleepProbability(_0x2b6a34||currentMonitoredRoom),_0x52d062=_0x6c2a57>0.65;_0x52d062?(timeoutMs+=0x5a*0x3c*0x3e8,_0x3ccca4[_0x4fea27(0x1b9)][_0x4fea27(0x1ca)](_0x4fea27(0x1c6)+(_0x6c2a57*0x64)[_0x4fea27(0x1b6)](0x0)+_0x4fea27(0x1ac)+currentMonitoredRoom+_0x4fea27(0x1ad)),_0x3ccca4[_0x4fea27(0x1d5)](_0x4fea27(0x1c4),{'val':!![],'ack':!![]})):_0x3ccca4[_0x4fea27(0x1d5)]('analysis.safety.deadMan.smartSleep',{'val':![],'ack':!![]}),_0x3ccca4[_0x4fea27(0x1d5)](_0x4fea27(0x1c1),{'val':_0x6c2a57,'ack':!![]}),_0x3ccca4[_0x4fea27(0x1b9)][_0x4fea27(0x1ca)]('ðŸ‘¼\x20Schutzengel:\x20Ãœberwache\x20'+currentMonitoredRoom+'\x20fÃ¼r\x20'+_0x39db15+_0x4fea27(0x1c2)),_0x3ccca4[_0x4fea27(0x1d5)](_0x4fea27(0x1c3),{'val':'ok','ack':!![]}),activeTimer=setTimeout(()=>triggerPreWarn(_0x3ccca4),timeoutMs);}function resetTimer(_0x3045e9){const _0x4976e5=a2_0x1ebc53;if(activeTimer)clearTimeout(activeTimer);activeTimer=null,currentMonitoredRoom=null,alarmStage=0x0,_0x3045e9['setStateAsync'](_0x4976e5(0x1c3),{'val':'ok','ack':!![]}),_0x3045e9[_0x4976e5(0x1d5)]('analysis.safety.deadMan.smartSleep',{'val':![],'ack':!![]}),_0x3045e9[_0x4976e5(0x1d5)](_0x4976e5(0x1c1),{'val':0x0,'ack':!![]});}async function triggerPreWarn(_0x46b608){const _0x563306=a2_0x1ebc53;alarmStage=0x1,await _0x46b608['setStateAsync']('analysis.safety.deadMan.alarmState',{'val':_0x563306(0x1a8),'ack':!![]});const _0x3fd80d='â³\x20ACHTUNG:\x20UngewÃ¶hnlich\x20lange\x20InaktivitÃ¤t\x20in\x20'+currentMonitoredRoom+_0x563306(0x1b0);_0x46b608[_0x563306(0x1b9)][_0x563306(0x1c5)](_0x563306(0x1c8)+_0x3fd80d),await setup['sendNotification'](_0x46b608,_0x563306(0x1af)+_0x3fd80d),activeTimer=setTimeout(()=>triggerAlarm(_0x46b608),0x5*0x3c*0x3e8);}async function triggerAlarm(_0x3fff9d){const _0x5f37bf=a2_0x1ebc53;alarmStage=0x2,await _0x3fff9d[_0x5f37bf(0x1d5)]('analysis.safety.deadMan.alarmState',{'val':_0x5f37bf(0x1d8),'ack':!![]});const _0x6f7244=_0x5f37bf(0x1db)+currentMonitoredRoom+'!';_0x3fff9d['log']['error'](_0x5f37bf(0x1c8)+_0x6f7244),await setup[_0x5f37bf(0x1d3)](_0x3fff9d,_0x6f7244,![],!![]);}module['exports']={'updateLocation':updateLocation};