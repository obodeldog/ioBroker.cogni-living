const a2_0x192165=a2_0x3840;(function(_0x43f2c0,_0x1ffcaa){const _0x244653=a2_0x3840,_0x4aa49e=_0x43f2c0();while(!![]){try{const _0x1b715c=parseInt(_0x244653(0x8b))/0x1+parseInt(_0x244653(0x6d))/0x2+-parseInt(_0x244653(0x6a))/0x3+parseInt(_0x244653(0x80))/0x4*(parseInt(_0x244653(0x7d))/0x5)+-parseInt(_0x244653(0x76))/0x6*(parseInt(_0x244653(0x8a))/0x7)+-parseInt(_0x244653(0x84))/0x8*(-parseInt(_0x244653(0x66))/0x9)+-parseInt(_0x244653(0x9a))/0xa*(parseInt(_0x244653(0x89))/0xb);if(_0x1b715c===_0x1ffcaa)break;else _0x4aa49e['push'](_0x4aa49e['shift']());}catch(_0x177661){_0x4aa49e['push'](_0x4aa49e['shift']());}}}(a2_0x46cf,0x809bd));const a2_0x1b2f23=(function(){let _0x19b05e=!![];return function(_0x54aceb,_0x555da9){const _0xb69db4=_0x19b05e?function(){if(_0x555da9){const _0x3a9b27=_0x555da9['apply'](_0x54aceb,arguments);return _0x555da9=null,_0x3a9b27;}}:function(){};return _0x19b05e=![],_0xb69db4;};}()),a2_0x149ef3=a2_0x1b2f23(this,function(){const _0x1e15b6=a2_0x3840;return a2_0x149ef3['toString']()[_0x1e15b6(0x6b)](_0x1e15b6(0x77))[_0x1e15b6(0x8f)]()['constructor'](a2_0x149ef3)['search'](_0x1e15b6(0x77));});a2_0x149ef3();'use strict';const setup=require('./setup');let activeTimer=null,currentMonitoredRoom=null,timeoutMs=0x0,startTime=0x0,alarmStage=0x0;const DEFAULT_TIMEOUTS={'bad':0x2d,'bath':0x2d,'toilet':0x1e,'wc':0x1e,'keller':0x3c,'schlaf':0x78,'bed':0x78,'guest':0x5a,'gast':0x5a};async function loadConfig(_0x2ca320){const _0x1d66f0=a2_0x3840;try{const _0x4b33cd=await _0x2ca320[_0x1d66f0(0x8e)](_0x1d66f0(0x9b));if(_0x4b33cd&&_0x4b33cd[_0x1d66f0(0x75)])return JSON[_0x1d66f0(0x6c)](_0x4b33cd[_0x1d66f0(0x75)]);}catch(_0x2f409c){}return{};}function a2_0x3840(_0x166636,_0x1008f4){const _0x253ec7=a2_0x46cf();return a2_0x3840=function(_0x149ef3,_0x1b2f23){_0x149ef3=_0x149ef3-0x65;let _0x46cf0a=_0x253ec7[_0x149ef3];return _0x46cf0a;},a2_0x3840(_0x166636,_0x1008f4);}async function isActive(_0x285c6b){const _0xdae94=a2_0x3840;try{const _0x1bdea5=await _0x285c6b['getStateAsync'](_0xdae94(0x79));return _0x1bdea5&&_0x1bdea5[_0xdae94(0x75)];}catch(_0x455b94){return![];}}async function areRoomsConnected(_0x200d17,_0x315444,_0x169e92){const _0x30e6c7=a2_0x3840;try{const _0x9e8783=await _0x200d17[_0x30e6c7(0x8e)]('analysis.topology.structure');if(!_0x9e8783||!_0x9e8783[_0x30e6c7(0x75)])return!![];const _0x44eb2d=JSON[_0x30e6c7(0x6c)](_0x9e8783['val']),{rooms:_0x4fb456,matrix:_0x5bbfc2}=_0x44eb2d;if(!_0x4fb456||!_0x5bbfc2)return!![];const _0x4882a7=_0x4fb456[_0x30e6c7(0x98)](_0x315444),_0x1cf240=_0x4fb456[_0x30e6c7(0x98)](_0x169e92);if(_0x4882a7===-0x1||_0x1cf240===-0x1)return!![];const _0x5d4081=_0x5bbfc2[_0x4882a7][_0x1cf240]>0x0||_0x5bbfc2[_0x1cf240][_0x4882a7]>0x0;return _0x5d4081;}catch(_0x38a4ce){return _0x200d17[_0x30e6c7(0x8c)][_0x30e6c7(0x73)](_0x30e6c7(0x88)+_0x38a4ce[_0x30e6c7(0x74)]),!![];}}function calculateSleepProbability(_0x21ce6a){const _0x27462f=a2_0x3840,_0x4e0211=new Date(),_0x29d878=_0x4e0211[_0x27462f(0x7a)](),_0x13d7f9=_0x21ce6a[_0x27462f(0x99)]();let _0x172ebc=0.1;if(_0x29d878>=0x17||_0x29d878<=0x6)_0x172ebc=0x1;else{if(_0x29d878>=0xd&&_0x29d878<=0xf)_0x172ebc=0.8;else{if(_0x29d878>=0x14&&_0x29d878<=0x17)_0x172ebc=0.4;}}let _0x524a19=0.1;if(_0x13d7f9['includes'](_0x27462f(0x78))||_0x13d7f9['includes'](_0x27462f(0x8d)))_0x524a19=0x1;else{if(_0x13d7f9[_0x27462f(0x91)]('wohn')||_0x13d7f9[_0x27462f(0x91)]('living')||_0x13d7f9[_0x27462f(0x91)](_0x27462f(0x7c)))_0x524a19=0.6;else{if(_0x13d7f9[_0x27462f(0x91)](_0x27462f(0x71))||_0x13d7f9[_0x27462f(0x91)]('wc'))_0x524a19=0.05;}}let _0x4a5268=0.5;const _0x3eea4f=_0x524a19*0.5+_0x172ebc*0.3+_0x4a5268*0.2;return parseFloat(_0x3eea4f[_0x27462f(0x87)](0x2));}async function updateLocation(_0x17928c,_0x378289){const _0x2504e2=a2_0x3840;if(!_0x378289||_0x378289===_0x2504e2(0x69))return;if(!await isActive(_0x17928c)){resetTimer(_0x17928c);return;}if(currentMonitoredRoom&&currentMonitoredRoom!==_0x378289){const _0x3904a4=await areRoomsConnected(_0x17928c,currentMonitoredRoom,_0x378289);if(!_0x3904a4){const _0x4e1f21=_0x2504e2(0x81)+_0x378289+'\x27.\x20Nicht\x20verbunden\x20mit\x20√ºberwachtem\x20\x27'+currentMonitoredRoom+'\x27.';_0x17928c[_0x2504e2(0x8c)][_0x2504e2(0x6e)]('[DeadMan]\x20'+_0x4e1f21+_0x2504e2(0x65)),await _0x17928c[_0x2504e2(0x93)](_0x2504e2(0x7e),{'val':JSON['stringify']({'room':_0x378289,'reason':_0x4e1f21,'timestamp':Date[_0x2504e2(0x97)]()}),'ack':!![]});return;}resetTimer(_0x17928c);}if(!currentMonitoredRoom){await _0x17928c[_0x2504e2(0x93)](_0x2504e2(0x6f),{'val':_0x378289,'ack':!![]});const _0x2959b7=await loadConfig(_0x17928c),_0xcc53be=_0x378289[_0x2504e2(0x99)]();let _0x4e982c=_0x2959b7[_0x378289]||_0x2959b7[_0xcc53be];if(!_0x4e982c)for(const _0x20ef56 in DEFAULT_TIMEOUTS){if(_0xcc53be[_0x2504e2(0x91)](_0x20ef56)){_0x4e982c=DEFAULT_TIMEOUTS[_0x20ef56];break;}}if(!_0x4e982c&&_0x2959b7['default'])_0x4e982c=_0x2959b7[_0x2504e2(0x72)];if(!_0x4e982c)return;currentMonitoredRoom=_0x378289,startTimer(_0x17928c,_0x4e982c,_0x378289);}}function startTimer(_0x45f086,_0x4dbcd3,_0x4b138c){const _0x2635f8=a2_0x3840;if(activeTimer)clearTimeout(activeTimer);timeoutMs=_0x4dbcd3*0x3c*0x3e8,startTime=Date[_0x2635f8(0x97)](),alarmStage=0x0;const _0x12a654=calculateSleepProbability(_0x4b138c||currentMonitoredRoom),_0x216365=_0x12a654>0.65;_0x216365?(timeoutMs+=0x5a*0x3c*0x3e8,_0x45f086['log'][_0x2635f8(0x6e)](_0x2635f8(0x70)+(_0x12a654*0x64)['toFixed'](0x0)+_0x2635f8(0x9c)+currentMonitoredRoom+'\x20um\x2090\x20Min.'),_0x45f086['setStateAsync'](_0x2635f8(0x7b),{'val':!![],'ack':!![]})):_0x45f086[_0x2635f8(0x93)](_0x2635f8(0x7b),{'val':![],'ack':!![]}),_0x45f086[_0x2635f8(0x93)](_0x2635f8(0x83),{'val':_0x12a654,'ack':!![]}),_0x45f086[_0x2635f8(0x8c)][_0x2635f8(0x6e)]('üëº\x20Schutzengel:\x20√úberwache\x20'+currentMonitoredRoom+_0x2635f8(0x7f)+_0x4dbcd3+'\x20Min.'),_0x45f086[_0x2635f8(0x93)]('analysis.safety.deadMan.alarmState',{'val':'ok','ack':!![]}),activeTimer=setTimeout(()=>triggerPreWarn(_0x45f086),timeoutMs);}function resetTimer(_0x10961a){const _0x429e17=a2_0x3840;if(activeTimer)clearTimeout(activeTimer);activeTimer=null,currentMonitoredRoom=null,alarmStage=0x0,_0x10961a[_0x429e17(0x93)](_0x429e17(0x96),{'val':'ok','ack':!![]}),_0x10961a[_0x429e17(0x93)](_0x429e17(0x7b),{'val':![],'ack':!![]}),_0x10961a['setStateAsync'](_0x429e17(0x83),{'val':0x0,'ack':!![]});}async function triggerPreWarn(_0x456968){const _0x302b8e=a2_0x3840;alarmStage=0x1,await _0x456968[_0x302b8e(0x93)]('analysis.safety.deadMan.alarmState',{'val':_0x302b8e(0x90),'ack':!![]});const _0x49156b=_0x302b8e(0x67)+currentMonitoredRoom+_0x302b8e(0x92);_0x456968['log'][_0x302b8e(0x73)]('[DeadMan]\x20'+_0x49156b),await setup['sendNotification'](_0x456968,_0x302b8e(0x68)+_0x49156b),activeTimer=setTimeout(()=>triggerAlarm(_0x456968),0x5*0x3c*0x3e8);}async function triggerAlarm(_0x13ac75){const _0x5a8680=a2_0x3840;alarmStage=0x2,await _0x13ac75[_0x5a8680(0x93)](_0x5a8680(0x96),{'val':_0x5a8680(0x94),'ack':!![]});const _0xf8afb7=_0x5a8680(0x86)+currentMonitoredRoom+'!';_0x13ac75[_0x5a8680(0x8c)][_0x5a8680(0x82)](_0x5a8680(0x95)+_0xf8afb7),await setup['sendNotification'](_0x13ac75,_0xf8afb7,![],!![]);}function a2_0x46cf(){const _0x30cde1=['436VROfLa','Ignoriere\x20Bewegung\x20in\x20\x27','error','analysis.safety.deadMan.napProbability','136XGsfrf','exports','üö®\x20NOTFALL-ALARM:\x20Person\x20reagiert\x20nicht\x20in\x20','toFixed','[DeadMan]\x20Topology\x20check\x20failed:\x20','10956YMBJAn','7jvwRqn','1002157PrVEUI','log','bed','getStateAsync','toString','pre_warn','includes','.\x20Alles\x20in\x20Ordnung?','setStateAsync','alarm','[DeadMan]\x20','analysis.safety.deadMan.alarmState','now','indexOf','toLowerCase','8860AOOfpi','analysis.safety.deadMan.config','%).\x20Verl√§ngere\x20Timer\x20f√ºr\x20','\x20(Multi-Person\x20Filter)','431712cBduxy','‚è≥\x20ACHTUNG:\x20Ungew√∂hnlich\x20lange\x20Inaktivit√§t\x20in\x20','üëº\x20Schutzengel-Frage:\x20','Unknown','1390392hJDguf','search','parse','806626ipDxTy','info','analysis.safety.deadMan.currentRoom','üí§\x20Smart\x20Sleep\x20erkannt\x20(','bad','default','warn','message','val','5530044qBlBsU','(((.+)+)+)+$','schlaf','analysis.safety.deadMan.active','getHours','analysis.safety.deadMan.smartSleep','sofa','26305TXzjgG','analysis.safety.deadMan.lastIgnored','\x20f√ºr\x20'];a2_0x46cf=function(){return _0x30cde1;};return a2_0x46cf();}module[a2_0x192165(0x85)]={'updateLocation':updateLocation};