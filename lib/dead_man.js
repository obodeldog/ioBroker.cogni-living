const a2_0x366aad=a2_0x4f73;(function(_0x368251,_0x52dd8a){const _0x12c2bd=a2_0x4f73,_0xa485a3=_0x368251();while(!![]){try{const _0x383c9a=parseInt(_0x12c2bd(0x115))/0x1+-parseInt(_0x12c2bd(0x123))/0x2+parseInt(_0x12c2bd(0x137))/0x3*(parseInt(_0x12c2bd(0x112))/0x4)+parseInt(_0x12c2bd(0x135))/0x5+-parseInt(_0x12c2bd(0x128))/0x6+parseInt(_0x12c2bd(0x139))/0x7*(-parseInt(_0x12c2bd(0x10f))/0x8)+parseInt(_0x12c2bd(0x12d))/0x9*(-parseInt(_0x12c2bd(0x111))/0xa);if(_0x383c9a===_0x52dd8a)break;else _0xa485a3['push'](_0xa485a3['shift']());}catch(_0x29213f){_0xa485a3['push'](_0xa485a3['shift']());}}}(a2_0x3f4c,0xcd1bc));function a2_0x4f73(_0x124dc6,_0x546c65){const _0x4a3b2b=a2_0x3f4c();return a2_0x4f73=function(_0x23e849,_0x38d4e7){_0x23e849=_0x23e849-0x10f;let _0x3f4c82=_0x4a3b2b[_0x23e849];return _0x3f4c82;},a2_0x4f73(_0x124dc6,_0x546c65);}const a2_0x38d4e7=(function(){let _0x4e45ea=!![];return function(_0x3f23b5,_0x3c20ac){const _0x202117=_0x4e45ea?function(){const _0x319f03=a2_0x4f73;if(_0x3c20ac){const _0x2b4099=_0x3c20ac[_0x319f03(0x113)](_0x3f23b5,arguments);return _0x3c20ac=null,_0x2b4099;}}:function(){};return _0x4e45ea=![],_0x202117;};}()),a2_0x23e849=a2_0x38d4e7(this,function(){const _0x22e4b7=a2_0x4f73;return a2_0x23e849[_0x22e4b7(0x116)]()[_0x22e4b7(0x133)]('(((.+)+)+)+$')[_0x22e4b7(0x116)]()[_0x22e4b7(0x11d)](a2_0x23e849)[_0x22e4b7(0x133)](_0x22e4b7(0x12f));});a2_0x23e849();'use strict';const setup=require('./setup');let activeTimer=null,currentMonitoredRoom=null,timeoutMs=0x0,startTime=0x0,alarmStage=0x0;const DEFAULT_TIMEOUTS={'bad':0x2d,'bath':0x2d,'toilet':0x1e,'wc':0x1e,'keller':0x3c};async function loadConfig(_0x3b8b73){const _0x4aa81b=a2_0x4f73;try{const _0x59a949=await _0x3b8b73[_0x4aa81b(0x114)](_0x4aa81b(0x131));if(_0x59a949&&_0x59a949[_0x4aa81b(0x117)])return JSON[_0x4aa81b(0x110)](_0x59a949[_0x4aa81b(0x117)]);}catch(_0x2f9be7){}return{};}async function isActive(_0x5d2be6){const _0x5720e7=a2_0x4f73;try{const _0x5f41d6=await _0x5d2be6['getStateAsync']('analysis.safety.deadMan.active');return _0x5f41d6&&_0x5f41d6[_0x5720e7(0x117)];}catch(_0x3877c5){return![];}}async function areRoomsConnected(_0x27db88,_0x5b3879,_0x51f53a){const _0x1e3ceb=a2_0x4f73;try{const _0x2ed97c=await _0x27db88[_0x1e3ceb(0x114)](_0x1e3ceb(0x136));if(!_0x2ed97c||!_0x2ed97c[_0x1e3ceb(0x117)])return!![];const _0x569c12=JSON[_0x1e3ceb(0x110)](_0x2ed97c['val']),{rooms:_0x3666f2,matrix:_0x24aa91}=_0x569c12;if(!_0x3666f2||!_0x24aa91)return!![];const _0x231b97=_0x3666f2['indexOf'](_0x5b3879),_0x1fd727=_0x3666f2[_0x1e3ceb(0x127)](_0x51f53a);if(_0x231b97===-0x1||_0x1fd727===-0x1)return!![];const _0x1e77ba=_0x24aa91[_0x231b97][_0x1fd727]>0x0||_0x24aa91[_0x1fd727][_0x231b97]>0x0;return _0x1e77ba;}catch(_0x5e509f){return _0x27db88[_0x1e3ceb(0x126)][_0x1e3ceb(0x122)](_0x1e3ceb(0x124)+_0x5e509f[_0x1e3ceb(0x119)]),!![];}}async function updateLocation(_0x59929d,_0x44a755){const _0x1c9421=a2_0x4f73;if(!_0x44a755||_0x44a755==='Unknown')return;if(!await isActive(_0x59929d)){resetTimer(_0x59929d);return;}if(currentMonitoredRoom&&currentMonitoredRoom!==_0x44a755){const _0x37fdda=await areRoomsConnected(_0x59929d,currentMonitoredRoom,_0x44a755);if(!_0x37fdda){const _0x1ba6c5=_0x1c9421(0x11b)+_0x44a755+_0x1c9421(0x134)+currentMonitoredRoom+'\x27.';_0x59929d['log'][_0x1c9421(0x130)](_0x1c9421(0x12a)+_0x1ba6c5+'\x20(Multi-Person\x20Filter)'),await _0x59929d[_0x1c9421(0x12b)](_0x1c9421(0x11a),{'val':JSON[_0x1c9421(0x129)]({'room':_0x44a755,'reason':_0x1ba6c5,'timestamp':Date[_0x1c9421(0x118)]()}),'ack':!![]});return;}resetTimer(_0x59929d);}if(!currentMonitoredRoom){await _0x59929d[_0x1c9421(0x12b)](_0x1c9421(0x121),{'val':_0x44a755,'ack':!![]});const _0x5dc847=await loadConfig(_0x59929d),_0x1c55c9=_0x44a755[_0x1c9421(0x12c)]();let _0x241bba=_0x5dc847[_0x44a755]||_0x5dc847[_0x1c55c9];if(!_0x241bba)for(const _0x3a245b in DEFAULT_TIMEOUTS){if(_0x1c55c9['includes'](_0x3a245b)){_0x241bba=DEFAULT_TIMEOUTS[_0x3a245b];break;}}if(!_0x241bba&&_0x5dc847['default'])_0x241bba=_0x5dc847['default'];if(!_0x241bba)return;currentMonitoredRoom=_0x44a755,startTimer(_0x59929d,_0x241bba);}}function startTimer(_0x40f934,_0x548a62){const _0x1e6e02=a2_0x4f73;if(activeTimer)clearTimeout(activeTimer);timeoutMs=_0x548a62*0x3c*0x3e8,startTime=Date['now'](),alarmStage=0x0,_0x40f934[_0x1e6e02(0x126)][_0x1e6e02(0x130)](_0x1e6e02(0x12e)+currentMonitoredRoom+'\x20fÃ¼r\x20'+_0x548a62+_0x1e6e02(0x138)),_0x40f934[_0x1e6e02(0x12b)](_0x1e6e02(0x13a),{'val':'ok','ack':!![]}),activeTimer=setTimeout(()=>triggerPreWarn(_0x40f934),timeoutMs);}function a2_0x3f4c(){const _0x114163=['7454705qpAazq','analysis.topology.structure','110184MbwXLP','\x20Min.','71603mliixr','analysis.safety.deadMan.alarmState','720KRMckk','parse','17600jQIJfv','28WvuWAl','apply','getStateAsync','794065ACylxl','toString','val','now','message','analysis.safety.deadMan.lastIgnored','Ignoriere\x20Bewegung\x20in\x20\x27','sendNotification','constructor','â³\x20ACHTUNG:\x20UngewÃ¶hnlich\x20lange\x20InaktivitÃ¤t\x20in\x20','exports','.\x20Alles\x20in\x20Ordnung?','analysis.safety.deadMan.currentRoom','warn','26458QaGBHH','[DeadMan]\x20Topology\x20check\x20failed:\x20','ðŸ‘¼\x20Schutzengel-Frage:\x20','log','indexOf','3975234pwiMKQ','stringify','[DeadMan]\x20','setStateAsync','toLowerCase','540MHQoOB','ðŸ‘¼\x20Schutzengel:\x20Ãœberwache\x20','(((.+)+)+)+$','info','analysis.safety.deadMan.config','error','search','\x27.\x20Nicht\x20verbunden\x20mit\x20Ã¼berwachtem\x20\x27'];a2_0x3f4c=function(){return _0x114163;};return a2_0x3f4c();}function resetTimer(_0x2feb64){const _0x3afc13=a2_0x4f73;if(activeTimer)clearTimeout(activeTimer);activeTimer=null,currentMonitoredRoom=null,alarmStage=0x0,_0x2feb64[_0x3afc13(0x12b)](_0x3afc13(0x13a),{'val':'ok','ack':!![]});}async function triggerPreWarn(_0x454581){const _0x3e750e=a2_0x4f73;alarmStage=0x1,await _0x454581[_0x3e750e(0x12b)](_0x3e750e(0x13a),{'val':'pre_warn','ack':!![]});const _0x723cbc=_0x3e750e(0x11e)+currentMonitoredRoom+_0x3e750e(0x120);_0x454581[_0x3e750e(0x126)]['warn']('[DeadMan]\x20'+_0x723cbc),await setup[_0x3e750e(0x11c)](_0x454581,_0x3e750e(0x125)+_0x723cbc),activeTimer=setTimeout(()=>triggerAlarm(_0x454581),0x5*0x3c*0x3e8);}async function triggerAlarm(_0x24612f){const _0x1b9f75=a2_0x4f73;alarmStage=0x2,await _0x24612f[_0x1b9f75(0x12b)](_0x1b9f75(0x13a),{'val':'alarm','ack':!![]});const _0x349617='ðŸš¨\x20NOTFALL-ALARM:\x20Person\x20reagiert\x20nicht\x20in\x20'+currentMonitoredRoom+'!';_0x24612f[_0x1b9f75(0x126)][_0x1b9f75(0x132)](_0x1b9f75(0x12a)+_0x349617),await setup[_0x1b9f75(0x11c)](_0x24612f,_0x349617,![],!![]);}module[a2_0x366aad(0x11f)]={'updateLocation':updateLocation};