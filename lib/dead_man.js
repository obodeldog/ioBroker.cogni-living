const a2_0x193bb4=a2_0x4234;(function(_0x3fc075,_0x4cfad2){const _0x221d5a=a2_0x4234,_0x39862a=_0x3fc075();while(!![]){try{const _0x4881da=parseInt(_0x221d5a(0x106))/0x1+-parseInt(_0x221d5a(0xe6))/0x2+-parseInt(_0x221d5a(0x119))/0x3*(parseInt(_0x221d5a(0x118))/0x4)+parseInt(_0x221d5a(0xe4))/0x5+-parseInt(_0x221d5a(0x114))/0x6+parseInt(_0x221d5a(0xe8))/0x7+-parseInt(_0x221d5a(0x10d))/0x8*(-parseInt(_0x221d5a(0xe9))/0x9);if(_0x4881da===_0x4cfad2)break;else _0x39862a['push'](_0x39862a['shift']());}catch(_0x3e6ee2){_0x39862a['push'](_0x39862a['shift']());}}}(a2_0x2e80,0xc1f76));const a2_0x3cdb7f=(function(){let _0x5e09f7=!![];return function(_0x4f6481,_0x5e6e36){const _0x31a8ea=_0x5e09f7?function(){if(_0x5e6e36){const _0x5af61a=_0x5e6e36['apply'](_0x4f6481,arguments);return _0x5e6e36=null,_0x5af61a;}}:function(){};return _0x5e09f7=![],_0x31a8ea;};}()),a2_0xbc757b=a2_0x3cdb7f(this,function(){const _0x67d7b3=a2_0x4234;return a2_0xbc757b[_0x67d7b3(0xee)]()['search'](_0x67d7b3(0x104))[_0x67d7b3(0xee)]()['constructor'](a2_0xbc757b)[_0x67d7b3(0x10e)](_0x67d7b3(0x104));});a2_0xbc757b();'use strict';const setup=require('./setup');let activeTimer=null,currentMonitoredRoom=null,timeoutMs=0x0,startTime=0x0,alarmStage=0x0;const DEFAULT_TIMEOUTS={'bad':0x2d,'bath':0x2d,'toilet':0x1e,'wc':0x1e,'keller':0x3c,'schlaf':0x78,'bed':0x78,'guest':0x5a,'gast':0x5a};function getTimeoutRobust(_0x21826a,_0xb4f5fc){const _0x68f93e=a2_0x4234;if(!_0x21826a||!_0xb4f5fc)return undefined;if(_0x21826a[_0xb4f5fc])return _0x21826a[_0xb4f5fc];const _0x410b89=_0xb4f5fc['toLowerCase']()[_0x68f93e(0x117)](/[^a-z0-9]/g,'');for(const _0x1c7bd2 in _0x21826a){const _0x4419c3=_0x1c7bd2['toLowerCase']()['replace'](/[^a-z0-9]/g,'');if(_0x4419c3===_0x410b89)return _0x21826a[_0x1c7bd2];}const _0x4c64c9=_0xb4f5fc[_0x68f93e(0xed)]();if(_0x21826a[_0x4c64c9])return _0x21826a[_0x4c64c9];return undefined;}async function loadConfig(_0x75f003){const _0x5f3014=a2_0x4234;try{const _0x3624c3=await _0x75f003[_0x5f3014(0xf2)]('analysis.safety.deadMan.config');if(_0x3624c3&&_0x3624c3[_0x5f3014(0x112)])return JSON[_0x5f3014(0x116)](_0x3624c3[_0x5f3014(0x112)]);}catch(_0x19b5fc){}return{};}async function isActive(_0x35df1f){const _0x536b4f=a2_0x4234;try{const _0x58cb69=await _0x35df1f['getStateAsync'](_0x536b4f(0xf5));return _0x58cb69&&_0x58cb69[_0x536b4f(0x112)];}catch(_0x51a3a9){return![];}}async function areRoomsConnected(_0x5936c0,_0x2192a5,_0x29f546){const _0x22bc18=a2_0x4234;try{const _0x20c6de=await _0x5936c0['getStateAsync'](_0x22bc18(0xf7));if(!_0x20c6de||!_0x20c6de[_0x22bc18(0x112)])return!![];const _0x3f5e36=JSON['parse'](_0x20c6de[_0x22bc18(0x112)]),{rooms:_0x1dbdde,matrix:_0x4514f1}=_0x3f5e36;if(!_0x1dbdde||!_0x4514f1)return!![];const _0x2d6fd2=_0x1dbdde[_0x22bc18(0xfc)](_0x2192a5),_0x36e764=_0x1dbdde[_0x22bc18(0xfc)](_0x29f546);if(_0x2d6fd2===-0x1||_0x36e764===-0x1)return!![];const _0x264c33=_0x4514f1[_0x2d6fd2][_0x36e764]>0x0||_0x4514f1[_0x36e764][_0x2d6fd2]>0x0;return _0x264c33;}catch(_0x92a7b1){return _0x5936c0[_0x22bc18(0x113)][_0x22bc18(0xec)](_0x22bc18(0xfd)+_0x92a7b1[_0x22bc18(0xfe)]),!![];}}function calculateSleepProbability(_0xd5041d){const _0x14a642=a2_0x4234,_0x5c59b1=new Date(),_0x1682e9=_0x5c59b1['getHours'](),_0x45a6a9=_0xd5041d['toLowerCase']();let _0x30effc=0.1;if(_0x1682e9>=0x17||_0x1682e9<=0x6)_0x30effc=0x1;else{if(_0x1682e9>=0xd&&_0x1682e9<=0xf)_0x30effc=0.8;else{if(_0x1682e9>=0x14&&_0x1682e9<=0x17)_0x30effc=0.4;}}let _0x5dff03=0.1;if(_0x45a6a9[_0x14a642(0xff)](_0x14a642(0x109))||_0x45a6a9[_0x14a642(0xff)](_0x14a642(0x115)))_0x5dff03=0x1;else{if(_0x45a6a9[_0x14a642(0xff)](_0x14a642(0xeb))||_0x45a6a9['includes']('living')||_0x45a6a9[_0x14a642(0xff)](_0x14a642(0x111)))_0x5dff03=0.6;else{if(_0x45a6a9[_0x14a642(0xff)](_0x14a642(0x105))||_0x45a6a9[_0x14a642(0xff)]('wc'))_0x5dff03=0.05;}}let _0x3fb4be=0.5;const _0x4528a8=_0x5dff03*0.5+_0x30effc*0.3+_0x3fb4be*0.2;return parseFloat(_0x4528a8['toFixed'](0x2));}function a2_0x4234(_0x119197,_0x3c9a53){const _0x1654d9=a2_0x2e80();return a2_0x4234=function(_0xbc757b,_0x3cdb7f){_0xbc757b=_0xbc757b-0xe4;let _0x2e80fb=_0x1654d9[_0xbc757b];return _0x2e80fb;},a2_0x4234(_0x119197,_0x3c9a53);}async function updateLocation(_0xf4587,_0x78365){const _0xdfec8f=a2_0x4234;if(!_0x78365||_0x78365==='Unknown')return;if(!await isActive(_0xf4587)){resetTimer(_0xf4587);return;}if(currentMonitoredRoom&&currentMonitoredRoom!==_0x78365){const _0x1d7f04=await areRoomsConnected(_0xf4587,currentMonitoredRoom,_0x78365);if(!_0x1d7f04){const _0x123e90=_0xdfec8f(0x100)+_0x78365+'\x27.\x20Nicht\x20verbunden\x20mit\x20Ã¼berwachtem\x20\x27'+currentMonitoredRoom+'\x27.';_0xf4587[_0xdfec8f(0x113)][_0xdfec8f(0xf1)]('[DeadMan]\x20'+_0x123e90+_0xdfec8f(0xf6)),await _0xf4587[_0xdfec8f(0x102)]('analysis.safety.deadMan.lastIgnored',{'val':JSON[_0xdfec8f(0xe5)]({'room':_0x78365,'reason':_0x123e90,'timestamp':Date['now']()}),'ack':!![]});return;}resetTimer(_0xf4587);}if(!currentMonitoredRoom){await _0xf4587[_0xdfec8f(0x102)](_0xdfec8f(0xef),{'val':_0x78365,'ack':!![]});const _0x5633d2=await loadConfig(_0xf4587);let _0x173ade=getTimeoutRobust(_0x5633d2,_0x78365);const _0x4e40ff=_0x78365[_0xdfec8f(0xed)]();if(!_0x173ade)for(const _0x7e4804 in DEFAULT_TIMEOUTS){if(_0x4e40ff[_0xdfec8f(0xff)](_0x7e4804)){_0x173ade=DEFAULT_TIMEOUTS[_0x7e4804];break;}}if(!_0x173ade&&_0x5633d2[_0xdfec8f(0x10b)])_0x173ade=_0x5633d2['default'];if(!_0x173ade)return;currentMonitoredRoom=_0x78365,startTimer(_0xf4587,_0x173ade,_0x78365);}}function startTimer(_0x1f89db,_0x5275c4,_0x50e973){const _0x5ce97c=a2_0x4234;if(activeTimer)clearTimeout(activeTimer);timeoutMs=_0x5275c4*0x3c*0x3e8,startTime=Date[_0x5ce97c(0xf9)](),alarmStage=0x0;const _0x4b66a5=calculateSleepProbability(_0x50e973||currentMonitoredRoom),_0x98de71=_0x4b66a5>0.65;_0x98de71?(timeoutMs+=0x5a*0x3c*0x3e8,_0x1f89db[_0x5ce97c(0x113)][_0x5ce97c(0xf1)]('ðŸ’¤\x20Smart\x20Sleep\x20erkannt\x20('+(_0x4b66a5*0x64)[_0x5ce97c(0xf3)](0x0)+_0x5ce97c(0x10c)+currentMonitoredRoom+_0x5ce97c(0xe7)),_0x1f89db[_0x5ce97c(0x102)](_0x5ce97c(0x108),{'val':!![],'ack':!![]})):_0x1f89db[_0x5ce97c(0x102)](_0x5ce97c(0x108),{'val':![],'ack':!![]}),_0x1f89db['setStateAsync'](_0x5ce97c(0xea),{'val':_0x4b66a5,'ack':!![]}),_0x1f89db[_0x5ce97c(0x113)]['info'](_0x5ce97c(0x110)+currentMonitoredRoom+_0x5ce97c(0xf0)+_0x5275c4+_0x5ce97c(0x107)),_0x1f89db[_0x5ce97c(0x102)](_0x5ce97c(0x103),{'val':'ok','ack':!![]}),activeTimer=setTimeout(()=>triggerPreWarn(_0x1f89db),timeoutMs);}function resetTimer(_0x144e5d){const _0x167a99=a2_0x4234;if(activeTimer)clearTimeout(activeTimer);activeTimer=null,currentMonitoredRoom=null,alarmStage=0x0,_0x144e5d['setStateAsync'](_0x167a99(0x103),{'val':'ok','ack':!![]}),_0x144e5d[_0x167a99(0x102)](_0x167a99(0x108),{'val':![],'ack':!![]}),_0x144e5d[_0x167a99(0x102)](_0x167a99(0xea),{'val':0x0,'ack':!![]});}async function triggerPreWarn(_0x497b25){const _0x10f987=a2_0x4234;alarmStage=0x1,await _0x497b25[_0x10f987(0x102)](_0x10f987(0x103),{'val':_0x10f987(0xf4),'ack':!![]});const _0x4d235a='â³\x20ACHTUNG:\x20UngewÃ¶hnlich\x20lange\x20InaktivitÃ¤t\x20in\x20'+currentMonitoredRoom+'.\x20Alles\x20in\x20Ordnung?';_0x497b25[_0x10f987(0x113)][_0x10f987(0xec)](_0x10f987(0x10a)+_0x4d235a),await setup[_0x10f987(0x101)](_0x497b25,'ðŸ‘¼\x20Schutzengel-Frage:\x20'+_0x4d235a),activeTimer=setTimeout(()=>triggerAlarm(_0x497b25),0x5*0x3c*0x3e8);}async function triggerAlarm(_0x1a8da2){const _0x385d02=a2_0x4234;alarmStage=0x2,await _0x1a8da2[_0x385d02(0x102)](_0x385d02(0x103),{'val':_0x385d02(0xfb),'ack':!![]});const _0x4d0c1f=_0x385d02(0xfa)+currentMonitoredRoom+'!';_0x1a8da2[_0x385d02(0x113)][_0x385d02(0x10f)](_0x385d02(0x10a)+_0x4d0c1f),await setup['sendNotification'](_0x1a8da2,_0x4d0c1f,![],!![]);}function a2_0x2e80(){const _0x1582b5=['alarm','indexOf','[DeadMan]\x20Topology\x20check\x20failed:\x20','message','includes','Ignoriere\x20Bewegung\x20in\x20\x27','sendNotification','setStateAsync','analysis.safety.deadMan.alarmState','(((.+)+)+)+$','bad','1542713rAzxXS','\x20Min.','analysis.safety.deadMan.smartSleep','schlaf','[DeadMan]\x20','default','%).\x20VerlÃ¤ngere\x20Timer\x20fÃ¼r\x20','2317464RcqyaB','search','error','ðŸ‘¼\x20Schutzengel:\x20Ãœberwache\x20','sofa','val','log','6299934xCaOfG','bed','parse','replace','4SdSDXD','1734699LJkeFm','75015PCHVOU','stringify','1986528rzdRfq','\x20um\x2090\x20Min.','10980011GCKzBi','9ihJshA','analysis.safety.deadMan.napProbability','wohn','warn','toLowerCase','toString','analysis.safety.deadMan.currentRoom','\x20fÃ¼r\x20','info','getStateAsync','toFixed','pre_warn','analysis.safety.deadMan.active','\x20(Multi-Person\x20Filter)','analysis.topology.structure','exports','now','ðŸš¨\x20NOTFALL-ALARM:\x20Person\x20reagiert\x20nicht\x20in\x20'];a2_0x2e80=function(){return _0x1582b5;};return a2_0x2e80();}module[a2_0x193bb4(0xf8)]={'updateLocation':updateLocation};