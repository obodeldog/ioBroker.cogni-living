const a2_0x4c9c08=a2_0x38bb;function a2_0x38bb(_0x44db03,_0xdd3ffc){const _0x318bfc=a2_0x39ba();return a2_0x38bb=function(_0x25c083,_0x297607){_0x25c083=_0x25c083-0x1ef;let _0x39ba17=_0x318bfc[_0x25c083];return _0x39ba17;},a2_0x38bb(_0x44db03,_0xdd3ffc);}(function(_0x12666b,_0x3c2767){const _0x32258a=a2_0x38bb,_0x4cd776=_0x12666b();while(!![]){try{const _0x51d6b0=parseInt(_0x32258a(0x205))/0x1*(parseInt(_0x32258a(0x1f8))/0x2)+parseInt(_0x32258a(0x1ff))/0x3+-parseInt(_0x32258a(0x202))/0x4+parseInt(_0x32258a(0x209))/0x5*(parseInt(_0x32258a(0x1f0))/0x6)+-parseInt(_0x32258a(0x1fb))/0x7*(parseInt(_0x32258a(0x21e))/0x8)+-parseInt(_0x32258a(0x224))/0x9+-parseInt(_0x32258a(0x211))/0xa*(-parseInt(_0x32258a(0x220))/0xb);if(_0x51d6b0===_0x3c2767)break;else _0x4cd776['push'](_0x4cd776['shift']());}catch(_0x2c2a27){_0x4cd776['push'](_0x4cd776['shift']());}}}(a2_0x39ba,0x82949));const a2_0x297607=(function(){let _0x56d945=!![];return function(_0x118f86,_0x22fdc8){const _0x3dab91=_0x56d945?function(){const _0x130e3a=a2_0x38bb;if(_0x22fdc8){const _0x1c648f=_0x22fdc8[_0x130e3a(0x1f7)](_0x118f86,arguments);return _0x22fdc8=null,_0x1c648f;}}:function(){};return _0x56d945=![],_0x3dab91;};}()),a2_0x25c083=a2_0x297607(this,function(){const _0x104844=a2_0x38bb;return a2_0x25c083[_0x104844(0x1ef)]()[_0x104844(0x226)](_0x104844(0x212))[_0x104844(0x1ef)]()[_0x104844(0x222)](a2_0x25c083)['search'](_0x104844(0x212));});a2_0x25c083();'use strict';const setup=require(a2_0x4c9c08(0x229));function a2_0x39ba(){const _0x1d96ff=['./setup','sendNotification','val','toString','62538PyjZyu','[DeadMan]\x20Topology\x20check\x20failed:\x20','info','bad','analysis.safety.deadMan.lastIgnored','.\x20Alles\x20in\x20Ordnung?','\x20(Multi-Person\x20Filter)','apply','504142VOytmW','\x20um\x2090\x20Min.','[DeadMan]\x20','1084447JSHEiF','indexOf','now','analysis.topology.structure','1657554AqVNdq','setStateAsync','ðŸ‘¼\x20Schutzengel-Frage:\x20','3654276yJcVnr','living','getHours','2Qihtaw','toLowerCase','analysis.safety.deadMan.config','exports','265yMqGqF','analysis.safety.deadMan.smartSleep','parse','default','ðŸš¨\x20NOTFALL-ALARM:\x20Person\x20reagiert\x20nicht\x20in\x20','bed','analysis.safety.deadMan.currentRoom','Unknown','910dNhNZK','(((.+)+)+)+$','toFixed','ðŸ‘¼\x20Schutzengel:\x20Ãœberwache\x20','warn','analysis.safety.deadMan.alarmState','log','stringify','getStateAsync','analysis.safety.deadMan.active','\x27.\x20Nicht\x20verbunden\x20mit\x20Ã¼berwachtem\x20\x27','analysis.safety.deadMan.napProbability','includes','8rrxTBC','alarm','83699oFJFpc','\x20Min.','constructor','pre_warn','6283359gxKyyj','%).\x20VerlÃ¤ngere\x20Timer\x20fÃ¼r\x20','search','â³\x20ACHTUNG:\x20UngewÃ¶hnlich\x20lange\x20InaktivitÃ¤t\x20in\x20','message'];a2_0x39ba=function(){return _0x1d96ff;};return a2_0x39ba();}let activeTimer=null,currentMonitoredRoom=null,timeoutMs=0x0,startTime=0x0,alarmStage=0x0;const DEFAULT_TIMEOUTS={'bad':0x2d,'bath':0x2d,'toilet':0x1e,'wc':0x1e,'keller':0x3c,'schlaf':0x78,'bed':0x78,'guest':0x5a,'gast':0x5a};async function loadConfig(_0x5c803e){const _0x59e6d6=a2_0x4c9c08;try{const _0x2e6012=await _0x5c803e[_0x59e6d6(0x219)](_0x59e6d6(0x207));if(_0x2e6012&&_0x2e6012[_0x59e6d6(0x22b)])return JSON[_0x59e6d6(0x20b)](_0x2e6012[_0x59e6d6(0x22b)]);}catch(_0x36a719){}return{};}async function isActive(_0x2806a6){const _0x6fe89b=a2_0x4c9c08;try{const _0x386b9d=await _0x2806a6[_0x6fe89b(0x219)](_0x6fe89b(0x21a));return _0x386b9d&&_0x386b9d[_0x6fe89b(0x22b)];}catch(_0x3889d2){return![];}}async function areRoomsConnected(_0x596ca6,_0x59ff5b,_0x4d7f37){const _0x2c97c9=a2_0x4c9c08;try{const _0x3b93fc=await _0x596ca6[_0x2c97c9(0x219)](_0x2c97c9(0x1fe));if(!_0x3b93fc||!_0x3b93fc[_0x2c97c9(0x22b)])return!![];const _0x2c8f94=JSON[_0x2c97c9(0x20b)](_0x3b93fc[_0x2c97c9(0x22b)]),{rooms:_0x528a51,matrix:_0x1fdbd2}=_0x2c8f94;if(!_0x528a51||!_0x1fdbd2)return!![];const _0x559d88=_0x528a51[_0x2c97c9(0x1fc)](_0x59ff5b),_0x481846=_0x528a51[_0x2c97c9(0x1fc)](_0x4d7f37);if(_0x559d88===-0x1||_0x481846===-0x1)return!![];const _0x57d06f=_0x1fdbd2[_0x559d88][_0x481846]>0x0||_0x1fdbd2[_0x481846][_0x559d88]>0x0;return _0x57d06f;}catch(_0x31ae61){return _0x596ca6[_0x2c97c9(0x217)][_0x2c97c9(0x215)](_0x2c97c9(0x1f1)+_0x31ae61[_0x2c97c9(0x228)]),!![];}}function calculateSleepProbability(_0x27482e){const _0x5ef2b0=a2_0x4c9c08,_0x5171ca=new Date(),_0x328e97=_0x5171ca[_0x5ef2b0(0x204)](),_0x39c1b7=_0x27482e[_0x5ef2b0(0x206)]();let _0x1fff70=0.1;if(_0x328e97>=0x17||_0x328e97<=0x6)_0x1fff70=0x1;else{if(_0x328e97>=0xd&&_0x328e97<=0xf)_0x1fff70=0.8;else{if(_0x328e97>=0x14&&_0x328e97<=0x17)_0x1fff70=0.4;}}let _0x44e56b=0.1;if(_0x39c1b7['includes']('schlaf')||_0x39c1b7[_0x5ef2b0(0x21d)](_0x5ef2b0(0x20e)))_0x44e56b=0x1;else{if(_0x39c1b7[_0x5ef2b0(0x21d)]('wohn')||_0x39c1b7[_0x5ef2b0(0x21d)](_0x5ef2b0(0x203))||_0x39c1b7[_0x5ef2b0(0x21d)]('sofa'))_0x44e56b=0.6;else{if(_0x39c1b7[_0x5ef2b0(0x21d)](_0x5ef2b0(0x1f3))||_0x39c1b7[_0x5ef2b0(0x21d)]('wc'))_0x44e56b=0.05;}}let _0x3dfee3=0.5;const _0x2b1013=_0x44e56b*0.5+_0x1fff70*0.3+_0x3dfee3*0.2;return parseFloat(_0x2b1013[_0x5ef2b0(0x213)](0x2));}async function updateLocation(_0x5660f2,_0x32e224){const _0x1df127=a2_0x4c9c08;if(!_0x32e224||_0x32e224===_0x1df127(0x210))return;if(!await isActive(_0x5660f2)){resetTimer(_0x5660f2);return;}if(currentMonitoredRoom&&currentMonitoredRoom!==_0x32e224){const _0x3a101c=await areRoomsConnected(_0x5660f2,currentMonitoredRoom,_0x32e224);if(!_0x3a101c){const _0x58624b='Ignoriere\x20Bewegung\x20in\x20\x27'+_0x32e224+_0x1df127(0x21b)+currentMonitoredRoom+'\x27.';_0x5660f2[_0x1df127(0x217)][_0x1df127(0x1f2)](_0x1df127(0x1fa)+_0x58624b+_0x1df127(0x1f6)),await _0x5660f2['setStateAsync'](_0x1df127(0x1f4),{'val':JSON[_0x1df127(0x218)]({'room':_0x32e224,'reason':_0x58624b,'timestamp':Date[_0x1df127(0x1fd)]()}),'ack':!![]});return;}resetTimer(_0x5660f2);}if(!currentMonitoredRoom){await _0x5660f2[_0x1df127(0x200)](_0x1df127(0x20f),{'val':_0x32e224,'ack':!![]});const _0x52f636=await loadConfig(_0x5660f2),_0x3d3579=_0x32e224[_0x1df127(0x206)]();let _0x5b3d54=_0x52f636[_0x32e224]||_0x52f636[_0x3d3579];if(!_0x5b3d54)for(const _0x5c53ac in DEFAULT_TIMEOUTS){if(_0x3d3579[_0x1df127(0x21d)](_0x5c53ac)){_0x5b3d54=DEFAULT_TIMEOUTS[_0x5c53ac];break;}}if(!_0x5b3d54&&_0x52f636['default'])_0x5b3d54=_0x52f636[_0x1df127(0x20c)];if(!_0x5b3d54)return;currentMonitoredRoom=_0x32e224,startTimer(_0x5660f2,_0x5b3d54,_0x32e224);}}function startTimer(_0x47eae2,_0x4361fc,_0x271438){const _0x350c62=a2_0x4c9c08;if(activeTimer)clearTimeout(activeTimer);timeoutMs=_0x4361fc*0x3c*0x3e8,startTime=Date['now'](),alarmStage=0x0;const _0x4bc97d=calculateSleepProbability(_0x271438||currentMonitoredRoom),_0x1de3a3=_0x4bc97d>0.65;_0x1de3a3?(timeoutMs+=0x5a*0x3c*0x3e8,_0x47eae2[_0x350c62(0x217)][_0x350c62(0x1f2)]('ðŸ’¤\x20Smart\x20Sleep\x20erkannt\x20('+(_0x4bc97d*0x64)[_0x350c62(0x213)](0x0)+_0x350c62(0x225)+currentMonitoredRoom+_0x350c62(0x1f9)),_0x47eae2[_0x350c62(0x200)]('analysis.safety.deadMan.smartSleep',{'val':!![],'ack':!![]})):_0x47eae2[_0x350c62(0x200)](_0x350c62(0x20a),{'val':![],'ack':!![]}),_0x47eae2[_0x350c62(0x200)](_0x350c62(0x21c),{'val':_0x4bc97d,'ack':!![]}),_0x47eae2[_0x350c62(0x217)][_0x350c62(0x1f2)](_0x350c62(0x214)+currentMonitoredRoom+'\x20fÃ¼r\x20'+_0x4361fc+_0x350c62(0x221)),_0x47eae2['setStateAsync'](_0x350c62(0x216),{'val':'ok','ack':!![]}),activeTimer=setTimeout(()=>triggerPreWarn(_0x47eae2),timeoutMs);}function resetTimer(_0x4697ce){const _0x791bb2=a2_0x4c9c08;if(activeTimer)clearTimeout(activeTimer);activeTimer=null,currentMonitoredRoom=null,alarmStage=0x0,_0x4697ce[_0x791bb2(0x200)](_0x791bb2(0x216),{'val':'ok','ack':!![]}),_0x4697ce['setStateAsync'](_0x791bb2(0x20a),{'val':![],'ack':!![]}),_0x4697ce[_0x791bb2(0x200)](_0x791bb2(0x21c),{'val':0x0,'ack':!![]});}async function triggerPreWarn(_0x29587a){const _0x5aa458=a2_0x4c9c08;alarmStage=0x1,await _0x29587a['setStateAsync']('analysis.safety.deadMan.alarmState',{'val':_0x5aa458(0x223),'ack':!![]});const _0x2dd273=_0x5aa458(0x227)+currentMonitoredRoom+_0x5aa458(0x1f5);_0x29587a[_0x5aa458(0x217)][_0x5aa458(0x215)](_0x5aa458(0x1fa)+_0x2dd273),await setup['sendNotification'](_0x29587a,_0x5aa458(0x201)+_0x2dd273),activeTimer=setTimeout(()=>triggerAlarm(_0x29587a),0x5*0x3c*0x3e8);}async function triggerAlarm(_0x23fbb7){const _0x2d62a4=a2_0x4c9c08;alarmStage=0x2,await _0x23fbb7[_0x2d62a4(0x200)](_0x2d62a4(0x216),{'val':_0x2d62a4(0x21f),'ack':!![]});const _0x571f00=_0x2d62a4(0x20d)+currentMonitoredRoom+'!';_0x23fbb7[_0x2d62a4(0x217)]['error'](_0x2d62a4(0x1fa)+_0x571f00),await setup[_0x2d62a4(0x22a)](_0x23fbb7,_0x571f00,![],!![]);}module[a2_0x4c9c08(0x208)]={'updateLocation':updateLocation};