const a2_0x2f692c=a2_0x3d85;(function(_0x3e17bb,_0x14a073){const _0x10ccb1=a2_0x3d85,_0x4c3e23=_0x3e17bb();while(!![]){try{const _0xb0bf7f=parseInt(_0x10ccb1(0x15a))/0x1+parseInt(_0x10ccb1(0x16c))/0x2+-parseInt(_0x10ccb1(0x13f))/0x3+-parseInt(_0x10ccb1(0x142))/0x4*(-parseInt(_0x10ccb1(0x165))/0x5)+-parseInt(_0x10ccb1(0x153))/0x6+parseInt(_0x10ccb1(0x160))/0x7*(-parseInt(_0x10ccb1(0x15d))/0x8)+parseInt(_0x10ccb1(0x166))/0x9;if(_0xb0bf7f===_0x14a073)break;else _0x4c3e23['push'](_0x4c3e23['shift']());}catch(_0x5c196e){_0x4c3e23['push'](_0x4c3e23['shift']());}}}(a2_0x518f,0x46127));const a2_0x2c292d=(function(){let _0x4754c2=!![];return function(_0x58c273,_0x322a48){const _0x46a55f=_0x4754c2?function(){const _0x5b252c=a2_0x3d85;if(_0x322a48){const _0x59d33f=_0x322a48[_0x5b252c(0x13e)](_0x58c273,arguments);return _0x322a48=null,_0x59d33f;}}:function(){};return _0x4754c2=![],_0x46a55f;};}()),a2_0x92614=a2_0x2c292d(this,function(){const _0xdabd94=a2_0x3d85;return a2_0x92614[_0xdabd94(0x141)]()['search'](_0xdabd94(0x167))[_0xdabd94(0x141)]()[_0xdabd94(0x147)](a2_0x92614)[_0xdabd94(0x16d)]('(((.+)+)+)+$');});a2_0x92614();'use strict';const setup=require(a2_0x2f692c(0x14c));let activeTimer=null,currentMonitoredRoom=null,timeoutMs=0x0,startTime=0x0,alarmStage=0x0;const DEFAULT_TIMEOUTS={'bad':0x2d,'bath':0x2d,'toilet':0x1e,'wc':0x1e,'keller':0x3c};async function loadConfig(_0x404542){const _0xf8ac8c=a2_0x2f692c;try{const _0xcaf582=await _0x404542[_0xf8ac8c(0x159)](_0xf8ac8c(0x14e));if(_0xcaf582&&_0xcaf582[_0xf8ac8c(0x15e)])return JSON[_0xf8ac8c(0x14d)](_0xcaf582[_0xf8ac8c(0x15e)]);}catch(_0x165d4f){}return{};}async function isActive(_0x13a204){const _0x596dfd=a2_0x2f692c;try{const _0x934677=await _0x13a204[_0x596dfd(0x159)](_0x596dfd(0x150));return _0x934677&&_0x934677[_0x596dfd(0x15e)];}catch(_0x3e278a){return![];}}async function areRoomsConnected(_0x5ec409,_0x1e4018,_0x988b93){const _0x45edec=a2_0x2f692c;try{const _0x1d169a=await _0x5ec409[_0x45edec(0x159)]('analysis.topology.structure');if(!_0x1d169a||!_0x1d169a[_0x45edec(0x15e)])return!![];const _0x352362=JSON[_0x45edec(0x14d)](_0x1d169a['val']),{rooms:_0x498807,matrix:_0x518896}=_0x352362;if(!_0x498807||!_0x518896)return!![];const _0x399cfd=_0x498807[_0x45edec(0x152)](_0x1e4018),_0x6432b3=_0x498807[_0x45edec(0x152)](_0x988b93);if(_0x399cfd===-0x1||_0x6432b3===-0x1)return!![];const _0x3e6417=_0x518896[_0x399cfd][_0x6432b3]>0x0||_0x518896[_0x6432b3][_0x399cfd]>0x0;return _0x3e6417;}catch(_0x425107){return _0x5ec409[_0x45edec(0x151)][_0x45edec(0x140)](_0x45edec(0x155)+_0x425107[_0x45edec(0x157)]),!![];}}function a2_0x3d85(_0x3ae867,_0x39f17b){const _0x2eaed4=a2_0x518f();return a2_0x3d85=function(_0x92614,_0x2c292d){_0x92614=_0x92614-0x13e;let _0x518fa1=_0x2eaed4[_0x92614];return _0x518fa1;},a2_0x3d85(_0x3ae867,_0x39f17b);}async function updateLocation(_0x308bc9,_0x58bf41){const _0x2b52ef=a2_0x2f692c;if(!_0x58bf41||_0x58bf41==='Unknown')return;if(!await isActive(_0x308bc9)){resetTimer(_0x308bc9);return;}if(currentMonitoredRoom&&currentMonitoredRoom!==_0x58bf41){const _0x889d31=await areRoomsConnected(_0x308bc9,currentMonitoredRoom,_0x58bf41);if(!_0x889d31){const _0x2ab52d=_0x2b52ef(0x156)+_0x58bf41+_0x2b52ef(0x168)+currentMonitoredRoom+'\x27.';_0x308bc9['log'][_0x2b52ef(0x149)](_0x2b52ef(0x148)+_0x2ab52d+_0x2b52ef(0x163)),await _0x308bc9[_0x2b52ef(0x16a)](_0x2b52ef(0x14a),{'val':JSON[_0x2b52ef(0x158)]({'room':_0x58bf41,'reason':_0x2ab52d,'timestamp':Date[_0x2b52ef(0x162)]()}),'ack':!![]});return;}resetTimer(_0x308bc9);}if(!currentMonitoredRoom){await _0x308bc9[_0x2b52ef(0x16a)](_0x2b52ef(0x143),{'val':_0x58bf41,'ack':!![]});const _0x4021bc=await loadConfig(_0x308bc9),_0x54e2a0=_0x58bf41['toLowerCase']();let _0x591f61=_0x4021bc[_0x58bf41]||_0x4021bc[_0x54e2a0];if(!_0x591f61)for(const _0xee44ce in DEFAULT_TIMEOUTS){if(_0x54e2a0[_0x2b52ef(0x15b)](_0xee44ce)){_0x591f61=DEFAULT_TIMEOUTS[_0xee44ce];break;}}if(!_0x591f61&&_0x4021bc[_0x2b52ef(0x144)])_0x591f61=_0x4021bc[_0x2b52ef(0x144)];if(!_0x591f61)return;currentMonitoredRoom=_0x58bf41,startTimer(_0x308bc9,_0x591f61);}}function startTimer(_0x5199ed,_0x26a7aa){const _0x2904ca=a2_0x2f692c;if(activeTimer)clearTimeout(activeTimer);timeoutMs=_0x26a7aa*0x3c*0x3e8,startTime=Date['now'](),alarmStage=0x0,_0x5199ed['log']['info']('ðŸ‘¼\x20Schutzengel:\x20Ãœberwache\x20'+currentMonitoredRoom+_0x2904ca(0x145)+_0x26a7aa+_0x2904ca(0x15c)),_0x5199ed[_0x2904ca(0x16a)](_0x2904ca(0x154),{'val':'ok','ack':!![]}),activeTimer=setTimeout(()=>triggerPreWarn(_0x5199ed),timeoutMs);}function resetTimer(_0x37052c){const _0x226069=a2_0x2f692c;if(activeTimer)clearTimeout(activeTimer);activeTimer=null,currentMonitoredRoom=null,alarmStage=0x0,_0x37052c[_0x226069(0x16a)]('analysis.safety.deadMan.alarmState',{'val':'ok','ack':!![]});}function a2_0x518f(){const _0x241c32=['now','\x20(Multi-Person\x20Filter)','ðŸ‘¼\x20Schutzengel-Frage:\x20','295xvGQDX','8312958NaQNRs','(((.+)+)+)+$','\x27.\x20Nicht\x20verbunden\x20mit\x20Ã¼berwachtem\x20\x27','sendNotification','setStateAsync','â³\x20ACHTUNG:\x20UngewÃ¶hnlich\x20lange\x20InaktivitÃ¤t\x20in\x20','40334XKqpUs','search','apply','1528812ZkLwxB','warn','toString','2528NIsHAx','analysis.safety.deadMan.currentRoom','default','\x20fÃ¼r\x20','pre_warn','constructor','[DeadMan]\x20','info','analysis.safety.deadMan.lastIgnored','exports','./setup','parse','analysis.safety.deadMan.config','.\x20Alles\x20in\x20Ordnung?','analysis.safety.deadMan.active','log','indexOf','895296iuThjE','analysis.safety.deadMan.alarmState','[DeadMan]\x20Topology\x20check\x20failed:\x20','Ignoriere\x20Bewegung\x20in\x20\x27','message','stringify','getStateAsync','364435lBFLIw','includes','\x20Min.','1656fmVvOg','val','error','13517SRITnL','ðŸš¨\x20NOTFALL-ALARM:\x20Person\x20reagiert\x20nicht\x20in\x20'];a2_0x518f=function(){return _0x241c32;};return a2_0x518f();}async function triggerPreWarn(_0x2c9b22){const _0x3ecac3=a2_0x2f692c;alarmStage=0x1,await _0x2c9b22[_0x3ecac3(0x16a)](_0x3ecac3(0x154),{'val':_0x3ecac3(0x146),'ack':!![]});const _0x255572=_0x3ecac3(0x16b)+currentMonitoredRoom+_0x3ecac3(0x14f);_0x2c9b22[_0x3ecac3(0x151)][_0x3ecac3(0x140)](_0x3ecac3(0x148)+_0x255572),await setup[_0x3ecac3(0x169)](_0x2c9b22,_0x3ecac3(0x164)+_0x255572),activeTimer=setTimeout(()=>triggerAlarm(_0x2c9b22),0x5*0x3c*0x3e8);}async function triggerAlarm(_0x96db2e){const _0x1a884f=a2_0x2f692c;alarmStage=0x2,await _0x96db2e['setStateAsync'](_0x1a884f(0x154),{'val':'alarm','ack':!![]});const _0x3b37cc=_0x1a884f(0x161)+currentMonitoredRoom+'!';_0x96db2e[_0x1a884f(0x151)][_0x1a884f(0x15f)](_0x1a884f(0x148)+_0x3b37cc),await setup[_0x1a884f(0x169)](_0x96db2e,_0x3b37cc,![],!![]);}module[a2_0x2f692c(0x14b)]={'updateLocation':updateLocation};