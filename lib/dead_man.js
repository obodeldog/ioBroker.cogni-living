const a2_0x5c96a1=a2_0x501f;(function(_0x3f0159,_0x547f49){const _0xc62c93=a2_0x501f,_0x19e173=_0x3f0159();while(!![]){try{const _0xe0d8b4=parseInt(_0xc62c93(0xa4))/0x1+parseInt(_0xc62c93(0x91))/0x2+parseInt(_0xc62c93(0x96))/0x3*(parseInt(_0xc62c93(0x9e))/0x4)+parseInt(_0xc62c93(0x8b))/0x5+-parseInt(_0xc62c93(0x8f))/0x6*(parseInt(_0xc62c93(0x8a))/0x7)+parseInt(_0xc62c93(0x97))/0x8+parseInt(_0xc62c93(0x9a))/0x9*(-parseInt(_0xc62c93(0x8c))/0xa);if(_0xe0d8b4===_0x547f49)break;else _0x19e173['push'](_0x19e173['shift']());}catch(_0x54f7c6){_0x19e173['push'](_0x19e173['shift']());}}}(a2_0x494f,0x25f5f));const a2_0x3c6331=(function(){let _0x1604a8=!![];return function(_0x22bd83,_0x48bc3e){const _0x14d590=_0x1604a8?function(){const _0x18a989=a2_0x501f;if(_0x48bc3e){const _0x13216e=_0x48bc3e[_0x18a989(0xa0)](_0x22bd83,arguments);return _0x48bc3e=null,_0x13216e;}}:function(){};return _0x1604a8=![],_0x14d590;};}()),a2_0x845748=a2_0x3c6331(this,function(){const _0x30d817=a2_0x501f;return a2_0x845748[_0x30d817(0x93)]()[_0x30d817(0x90)](_0x30d817(0x8d))[_0x30d817(0x93)]()[_0x30d817(0x9f)](a2_0x845748)[_0x30d817(0x90)](_0x30d817(0x8d));});a2_0x845748();'use strict';const setup=require(a2_0x5c96a1(0x99));let activeTimer=null,currentMonitoredRoom=null,timeoutMs=0x0,startTime=0x0,alarmStage=0x0;const DEFAULT_TIMEOUTS={'bad':0x2d,'bath':0x2d,'toilet':0x1e,'wc':0x1e,'keller':0x3c};async function loadConfig(_0x30e18c){const _0x1fb705=a2_0x5c96a1;try{const _0xa10b11=await _0x30e18c[_0x1fb705(0x9c)](_0x1fb705(0x9d));if(_0xa10b11&&_0xa10b11['val'])return JSON[_0x1fb705(0x86)](_0xa10b11['val']);}catch(_0x344bbb){}return{};}function a2_0x494f(){const _0xf5c68b=['221378HHwEsX','analysis.topology.structure','toString','log','ðŸ‘¼\x20Schutzengel-Frage:\x20','45LdvEcP','632120peqZUR','info','./setup','57852GeOCso','toLowerCase','getStateAsync','analysis.safety.deadMan.config','42412qVzrZP','constructor','apply','val','sendNotification','\x27.\x20Nicht\x20verbunden\x20mit\x20Ã¼berwachtem\x20\x27','129177EHscce','analysis.safety.deadMan.alarmState','message','indexOf','[DeadMan]\x20Topology\x20check\x20failed:\x20','now','\x20(Multi-Person\x20Filter)','Ignoriere\x20Bewegung\x20in\x20\x27','â³\x20ACHTUNG:\x20UngewÃ¶hnlich\x20lange\x20InaktivitÃ¤t\x20in\x20','default','stringify','\x20fÃ¼r\x20','Unknown','pre_warn','analysis.safety.deadMan.lastIgnored','warn','parse','setStateAsync','analysis.safety.deadMan.active','error','175epHfpg','575260rfYkKf','470wdUagc','(((.+)+)+)+$','[DeadMan]\x20','32490SYhWPE','search'];a2_0x494f=function(){return _0xf5c68b;};return a2_0x494f();}async function isActive(_0x21a893){const _0x2389d3=a2_0x5c96a1;try{const _0x5d87a6=await _0x21a893['getStateAsync'](_0x2389d3(0x88));return _0x5d87a6&&_0x5d87a6['val'];}catch(_0x1dc128){return![];}}async function areRoomsConnected(_0x221617,_0x2b5753,_0x11537b){const _0x5068ce=a2_0x5c96a1;try{const _0x31bf87=await _0x221617[_0x5068ce(0x9c)](_0x5068ce(0x92));if(!_0x31bf87||!_0x31bf87[_0x5068ce(0xa1)])return!![];const _0x50f2f2=JSON['parse'](_0x31bf87[_0x5068ce(0xa1)]),{rooms:_0x28362a,matrix:_0x578aba}=_0x50f2f2;if(!_0x28362a||!_0x578aba)return!![];const _0x8dee54=_0x28362a[_0x5068ce(0xa7)](_0x2b5753),_0x4b8ca7=_0x28362a['indexOf'](_0x11537b);if(_0x8dee54===-0x1||_0x4b8ca7===-0x1)return!![];const _0x194b78=_0x578aba[_0x8dee54][_0x4b8ca7]>0x0||_0x578aba[_0x4b8ca7][_0x8dee54]>0x0;return _0x194b78;}catch(_0x145c1a){return _0x221617[_0x5068ce(0x94)][_0x5068ce(0x85)](_0x5068ce(0xa8)+_0x145c1a[_0x5068ce(0xa6)]),!![];}}async function updateLocation(_0x2407bd,_0x4aee6b){const _0x35d6b2=a2_0x5c96a1;if(!_0x4aee6b||_0x4aee6b===_0x35d6b2(0x82))return;if(!await isActive(_0x2407bd)){resetTimer(_0x2407bd);return;}if(currentMonitoredRoom&&currentMonitoredRoom!==_0x4aee6b){const _0x5c60e4=await areRoomsConnected(_0x2407bd,currentMonitoredRoom,_0x4aee6b);if(!_0x5c60e4){const _0x4e6757=_0x35d6b2(0xab)+_0x4aee6b+_0x35d6b2(0xa3)+currentMonitoredRoom+'\x27.';_0x2407bd['log'][_0x35d6b2(0x98)](_0x35d6b2(0x8e)+_0x4e6757+_0x35d6b2(0xaa)),await _0x2407bd[_0x35d6b2(0x87)](_0x35d6b2(0x84),{'val':JSON[_0x35d6b2(0x80)]({'room':_0x4aee6b,'reason':_0x4e6757,'timestamp':Date[_0x35d6b2(0xa9)]()}),'ack':!![]});return;}resetTimer(_0x2407bd);}if(!currentMonitoredRoom){await _0x2407bd['setStateAsync']('analysis.safety.deadMan.currentRoom',{'val':_0x4aee6b,'ack':!![]});const _0x1eaf89=await loadConfig(_0x2407bd),_0x3e7a74=_0x4aee6b[_0x35d6b2(0x9b)]();let _0xeb238d=_0x1eaf89[_0x4aee6b]||_0x1eaf89[_0x3e7a74];if(!_0xeb238d)for(const _0x594f61 in DEFAULT_TIMEOUTS){if(_0x3e7a74['includes'](_0x594f61)){_0xeb238d=DEFAULT_TIMEOUTS[_0x594f61];break;}}if(!_0xeb238d&&_0x1eaf89[_0x35d6b2(0x7f)])_0xeb238d=_0x1eaf89['default'];if(!_0xeb238d)return;currentMonitoredRoom=_0x4aee6b,startTimer(_0x2407bd,_0xeb238d);}}function startTimer(_0x2a4b90,_0x4d14ae){const _0xdf130b=a2_0x5c96a1;if(activeTimer)clearTimeout(activeTimer);timeoutMs=_0x4d14ae*0x3c*0x3e8,startTime=Date[_0xdf130b(0xa9)](),alarmStage=0x0,_0x2a4b90[_0xdf130b(0x94)][_0xdf130b(0x98)]('ðŸ‘¼\x20Schutzengel:\x20Ãœberwache\x20'+currentMonitoredRoom+_0xdf130b(0x81)+_0x4d14ae+'\x20Min.'),_0x2a4b90[_0xdf130b(0x87)](_0xdf130b(0xa5),{'val':'ok','ack':!![]}),activeTimer=setTimeout(()=>triggerPreWarn(_0x2a4b90),timeoutMs);}function resetTimer(_0x4961ce){const _0x49c107=a2_0x5c96a1;if(activeTimer)clearTimeout(activeTimer);activeTimer=null,currentMonitoredRoom=null,alarmStage=0x0,_0x4961ce[_0x49c107(0x87)](_0x49c107(0xa5),{'val':'ok','ack':!![]});}async function triggerPreWarn(_0x124e7f){const _0x1f458b=a2_0x5c96a1;alarmStage=0x1,await _0x124e7f[_0x1f458b(0x87)]('analysis.safety.deadMan.alarmState',{'val':_0x1f458b(0x83),'ack':!![]});const _0x4abecf=_0x1f458b(0x7e)+currentMonitoredRoom+'.\x20Alles\x20in\x20Ordnung?';_0x124e7f['log'][_0x1f458b(0x85)](_0x1f458b(0x8e)+_0x4abecf),await setup[_0x1f458b(0xa2)](_0x124e7f,_0x1f458b(0x95)+_0x4abecf),activeTimer=setTimeout(()=>triggerAlarm(_0x124e7f),0x5*0x3c*0x3e8);}async function triggerAlarm(_0x105ab8){const _0x329e1c=a2_0x5c96a1;alarmStage=0x2,await _0x105ab8[_0x329e1c(0x87)](_0x329e1c(0xa5),{'val':'alarm','ack':!![]});const _0x49ef7a='ðŸš¨\x20NOTFALL-ALARM:\x20Person\x20reagiert\x20nicht\x20in\x20'+currentMonitoredRoom+'!';_0x105ab8[_0x329e1c(0x94)][_0x329e1c(0x89)](_0x329e1c(0x8e)+_0x49ef7a),await setup[_0x329e1c(0xa2)](_0x105ab8,_0x49ef7a,![],!![]);}function a2_0x501f(_0x1cb99f,_0x2ddacf){const _0x4631e7=a2_0x494f();return a2_0x501f=function(_0x845748,_0x3c6331){_0x845748=_0x845748-0x7e;let _0x494f48=_0x4631e7[_0x845748];return _0x494f48;},a2_0x501f(_0x1cb99f,_0x2ddacf);}module['exports']={'updateLocation':updateLocation};