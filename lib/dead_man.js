const a2_0x55522e=a2_0x4e6b;(function(_0x379e33,_0x40215f){const _0x59bdf0=a2_0x4e6b,_0x10ad63=_0x379e33();while(!![]){try{const _0x3c8831=-parseInt(_0x59bdf0(0x103))/0x1*(parseInt(_0x59bdf0(0xe6))/0x2)+parseInt(_0x59bdf0(0xd9))/0x3*(-parseInt(_0x59bdf0(0xf2))/0x4)+parseInt(_0x59bdf0(0xeb))/0x5+-parseInt(_0x59bdf0(0x104))/0x6+parseInt(_0x59bdf0(0xe5))/0x7+-parseInt(_0x59bdf0(0xf7))/0x8+parseInt(_0x59bdf0(0xec))/0x9;if(_0x3c8831===_0x40215f)break;else _0x10ad63['push'](_0x10ad63['shift']());}catch(_0x117506){_0x10ad63['push'](_0x10ad63['shift']());}}}(a2_0x235a,0x630c5));const a2_0x4dcdff=(function(){let _0x5c1c9d=!![];return function(_0x345ab9,_0xc8d36c){const _0x333ee1=_0x5c1c9d?function(){const _0x32bea4=a2_0x4e6b;if(_0xc8d36c){const _0x28f69d=_0xc8d36c[_0x32bea4(0xe4)](_0x345ab9,arguments);return _0xc8d36c=null,_0x28f69d;}}:function(){};return _0x5c1c9d=![],_0x333ee1;};}()),a2_0x106769=a2_0x4dcdff(this,function(){const _0x5e5183=a2_0x4e6b;return a2_0x106769[_0x5e5183(0xee)]()['search'](_0x5e5183(0xdd))['toString']()[_0x5e5183(0xfb)](a2_0x106769)['search'](_0x5e5183(0xdd));});a2_0x106769();'use strict';const setup=require(a2_0x55522e(0x109));let activeTimer=null,currentMonitoredRoom=null,timeoutMs=0x0,startTime=0x0,alarmStage=0x0;const DEFAULT_TIMEOUTS={'bad':0x2d,'bath':0x2d,'toilet':0x1e,'wc':0x1e,'keller':0x3c,'schlaf':0x78,'bed':0x78,'guest':0x5a,'gast':0x5a};function getTimeoutRobust(_0x4b905c,_0x335b64){const _0x224206=a2_0x55522e;if(!_0x4b905c||!_0x335b64)return undefined;if(_0x4b905c[_0x335b64])return _0x4b905c[_0x335b64];const _0x225f76=_0x335b64[_0x224206(0x105)]()['replace'](/[^a-z0-9]/g,'');for(const _0x4ed55c in _0x4b905c){const _0x27cfd4=_0x4ed55c[_0x224206(0x105)]()[_0x224206(0x108)](/[^a-z0-9]/g,'');if(_0x27cfd4===_0x225f76)return _0x4b905c[_0x4ed55c];}const _0x4022ba=_0x335b64[_0x224206(0x105)]();if(_0x4b905c[_0x4022ba])return _0x4b905c[_0x4022ba];return undefined;}async function loadConfig(_0x1d97ab){const _0x4bd905=a2_0x55522e;try{const _0xa38110=await _0x1d97ab['getStateAsync']('analysis.safety.deadMan.config');if(_0xa38110&&_0xa38110[_0x4bd905(0xd6)])return JSON[_0x4bd905(0xff)](_0xa38110[_0x4bd905(0xd6)]);}catch(_0x2701e3){}return{};}async function isActive(_0x4276e1){const _0x3aabbf=a2_0x55522e;try{const _0x27f2ab=await _0x4276e1[_0x3aabbf(0x106)](_0x3aabbf(0xf6));return _0x27f2ab&&_0x27f2ab[_0x3aabbf(0xd6)];}catch(_0x19c4a1){return![];}}async function areRoomsConnected(_0x382bcc,_0x47296a,_0x457cdf){const _0x4b6f64=a2_0x55522e;try{const _0x3f2de6=await _0x382bcc[_0x4b6f64(0x106)](_0x4b6f64(0xf8));if(!_0x3f2de6||!_0x3f2de6[_0x4b6f64(0xd6)])return!![];const _0x5a2d33=JSON['parse'](_0x3f2de6[_0x4b6f64(0xd6)]),{rooms:_0x471a1b,matrix:_0x264096}=_0x5a2d33;if(!_0x471a1b||!_0x264096)return!![];const _0x9b2c0b=_0x471a1b[_0x4b6f64(0x10b)](_0x47296a),_0x43f8fc=_0x471a1b[_0x4b6f64(0x10b)](_0x457cdf);if(_0x9b2c0b===-0x1||_0x43f8fc===-0x1)return!![];const _0x17ea8e=_0x264096[_0x9b2c0b][_0x43f8fc]>0x0||_0x264096[_0x43f8fc][_0x9b2c0b]>0x0;return _0x17ea8e;}catch(_0x45734f){return _0x382bcc[_0x4b6f64(0xd8)][_0x4b6f64(0xde)]('[DeadMan]\x20Topology\x20check\x20failed:\x20'+_0x45734f[_0x4b6f64(0xe9)]),!![];}}function calculateSleepProbability(_0x217c72){const _0x30322d=a2_0x55522e,_0x587cd7=new Date(),_0x1929fc=_0x587cd7[_0x30322d(0xf5)](),_0x46e2a7=_0x217c72[_0x30322d(0x105)]();let _0x28320d=0.1;if(_0x1929fc>=0x17||_0x1929fc<=0x6)_0x28320d=0x1;else{if(_0x1929fc>=0xd&&_0x1929fc<=0xf)_0x28320d=0.8;else{if(_0x1929fc>=0x14&&_0x1929fc<=0x17)_0x28320d=0.4;}}let _0x5f17a4=0.1;if(_0x46e2a7['includes']('schlaf')||_0x46e2a7[_0x30322d(0x102)](_0x30322d(0xdf)))_0x5f17a4=0x1;else{if(_0x46e2a7[_0x30322d(0x102)](_0x30322d(0x10a))||_0x46e2a7['includes']('living')||_0x46e2a7[_0x30322d(0x102)]('sofa'))_0x5f17a4=0.6;else{if(_0x46e2a7['includes']('bad')||_0x46e2a7['includes']('wc'))_0x5f17a4=0.05;}}let _0x216714=0.5;const _0x9ded2a=_0x5f17a4*0.5+_0x28320d*0.3+_0x216714*0.2;return parseFloat(_0x9ded2a[_0x30322d(0xfd)](0x2));}function a2_0x4e6b(_0x37dc64,_0x574363){const _0x1d5385=a2_0x235a();return a2_0x4e6b=function(_0x106769,_0x4dcdff){_0x106769=_0x106769-0xd3;let _0x235a4e=_0x1d5385[_0x106769];return _0x235a4e;},a2_0x4e6b(_0x37dc64,_0x574363);}async function updateLocation(_0x3ce523,_0x3da387){const _0x4bad2a=a2_0x55522e;if(!_0x3da387||_0x3da387===_0x4bad2a(0xe2))return;if(!await isActive(_0x3ce523)){resetTimer(_0x3ce523);return;}if(currentMonitoredRoom&&currentMonitoredRoom!==_0x3da387){const _0x2235b7=await areRoomsConnected(_0x3ce523,currentMonitoredRoom,_0x3da387);if(!_0x2235b7){const _0x2f54b3='Ignoriere\x20Bewegung\x20in\x20\x27'+_0x3da387+'\x27.\x20Nicht\x20verbunden\x20mit\x20Ã¼berwachtem\x20\x27'+currentMonitoredRoom+'\x27.';_0x3ce523[_0x4bad2a(0xd8)][_0x4bad2a(0xda)](_0x4bad2a(0xd5)+_0x2f54b3+_0x4bad2a(0xe3)),await _0x3ce523[_0x4bad2a(0xe7)](_0x4bad2a(0xe0),{'val':JSON[_0x4bad2a(0xef)]({'room':_0x3da387,'reason':_0x2f54b3,'timestamp':Date['now']()}),'ack':!![]});return;}resetTimer(_0x3ce523);}if(!currentMonitoredRoom){await _0x3ce523[_0x4bad2a(0xe7)](_0x4bad2a(0xe8),{'val':_0x3da387,'ack':!![]});const _0x3c7acb=await loadConfig(_0x3ce523);let _0x235e8d=getTimeoutRobust(_0x3c7acb,_0x3da387);const _0x22810a=_0x3da387[_0x4bad2a(0x105)]();if(!_0x235e8d)for(const _0x2089da in DEFAULT_TIMEOUTS){if(_0x22810a[_0x4bad2a(0x102)](_0x2089da)){_0x235e8d=DEFAULT_TIMEOUTS[_0x2089da];break;}}if(!_0x235e8d&&_0x3c7acb[_0x4bad2a(0xed)])_0x235e8d=_0x3c7acb[_0x4bad2a(0xed)];if(!_0x235e8d)return;currentMonitoredRoom=_0x3da387,startTimer(_0x3ce523,_0x235e8d,_0x3da387);}}function startTimer(_0x582adb,_0x6cc7af,_0x5374e0){const _0x2e2401=a2_0x55522e;if(activeTimer)clearTimeout(activeTimer);timeoutMs=_0x6cc7af*0x3c*0x3e8,startTime=Date[_0x2e2401(0xf9)](),alarmStage=0x0;const _0x150477=calculateSleepProbability(_0x5374e0||currentMonitoredRoom),_0x33e5da=_0x150477>0.65;_0x33e5da?(timeoutMs+=0x5a*0x3c*0x3e8,_0x582adb['log'][_0x2e2401(0xda)](_0x2e2401(0x107)+(_0x150477*0x64)[_0x2e2401(0xfd)](0x0)+_0x2e2401(0xfc)+currentMonitoredRoom+_0x2e2401(0xe1)),_0x582adb[_0x2e2401(0xe7)](_0x2e2401(0xdb),{'val':!![],'ack':!![]})):_0x582adb[_0x2e2401(0xe7)](_0x2e2401(0xdb),{'val':![],'ack':!![]}),_0x582adb[_0x2e2401(0xe7)]('analysis.safety.deadMan.napProbability',{'val':_0x150477,'ack':!![]}),_0x582adb[_0x2e2401(0xd8)]['info'](_0x2e2401(0xfe)+currentMonitoredRoom+_0x2e2401(0xd7)+_0x6cc7af+_0x2e2401(0xd4)),_0x582adb[_0x2e2401(0xe7)](_0x2e2401(0xf1),{'val':'ok','ack':!![]}),activeTimer=setTimeout(()=>triggerPreWarn(_0x582adb),timeoutMs);}function a2_0x235a(){const _0x2d5d6f=['ðŸ’¤\x20Smart\x20Sleep\x20erkannt\x20(','replace','./setup','wohn','indexOf','â³\x20ACHTUNG:\x20UngewÃ¶hnlich\x20lange\x20InaktivitÃ¤t\x20in\x20','\x20Min.','[DeadMan]\x20','val','\x20fÃ¼r\x20','log','5802geHSAL','info','analysis.safety.deadMan.smartSleep','.\x20Alles\x20in\x20Ordnung?','(((.+)+)+)+$','warn','bed','analysis.safety.deadMan.lastIgnored','\x20um\x2090\x20Min.','Unknown','\x20(Multi-Person\x20Filter)','apply','1058848CCxnGG','4208AQzgfg','setStateAsync','analysis.safety.deadMan.currentRoom','message','alarm','3420180rjYJVC','13959954XRGpUZ','default','toString','stringify','error','analysis.safety.deadMan.alarmState','636otGmWX','sendNotification','exports','getHours','analysis.safety.deadMan.active','5446096fpqCEd','analysis.topology.structure','now','analysis.safety.deadMan.napProbability','constructor','%).\x20VerlÃ¤ngere\x20Timer\x20fÃ¼r\x20','toFixed','ðŸ‘¼\x20Schutzengel:\x20Ãœberwache\x20','parse','ðŸ‘¼\x20Schutzengel-Frage:\x20','pre_warn','includes','343fwHEgA','1624590wDOPEx','toLowerCase','getStateAsync'];a2_0x235a=function(){return _0x2d5d6f;};return a2_0x235a();}function resetTimer(_0x58eca4){const _0x4f9f41=a2_0x55522e;if(activeTimer)clearTimeout(activeTimer);activeTimer=null,currentMonitoredRoom=null,alarmStage=0x0,_0x58eca4[_0x4f9f41(0xe7)]('analysis.safety.deadMan.alarmState',{'val':'ok','ack':!![]}),_0x58eca4[_0x4f9f41(0xe7)](_0x4f9f41(0xdb),{'val':![],'ack':!![]}),_0x58eca4[_0x4f9f41(0xe7)](_0x4f9f41(0xfa),{'val':0x0,'ack':!![]});}async function triggerPreWarn(_0x457c97){const _0x2036b6=a2_0x55522e;alarmStage=0x1,await _0x457c97[_0x2036b6(0xe7)](_0x2036b6(0xf1),{'val':_0x2036b6(0x101),'ack':!![]});const _0xd8fdf9=_0x2036b6(0xd3)+currentMonitoredRoom+_0x2036b6(0xdc);_0x457c97[_0x2036b6(0xd8)][_0x2036b6(0xde)](_0x2036b6(0xd5)+_0xd8fdf9),await setup[_0x2036b6(0xf3)](_0x457c97,_0x2036b6(0x100)+_0xd8fdf9),activeTimer=setTimeout(()=>triggerAlarm(_0x457c97),0x5*0x3c*0x3e8);}async function triggerAlarm(_0x2a078a){const _0x5ee204=a2_0x55522e;alarmStage=0x2,await _0x2a078a[_0x5ee204(0xe7)]('analysis.safety.deadMan.alarmState',{'val':_0x5ee204(0xea),'ack':!![]});const _0xb7d9a4='ðŸš¨\x20NOTFALL-ALARM:\x20Person\x20reagiert\x20nicht\x20in\x20'+currentMonitoredRoom+'!';_0x2a078a[_0x5ee204(0xd8)][_0x5ee204(0xf0)]('[DeadMan]\x20'+_0xb7d9a4),await setup[_0x5ee204(0xf3)](_0x2a078a,_0xb7d9a4,![],!![]);}module[a2_0x55522e(0xf4)]={'updateLocation':updateLocation};