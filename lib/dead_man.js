const a2_0x3dc537=a2_0x3e2b;(function(_0x58614b,_0x4ba184){const _0x14eed2=a2_0x3e2b,_0x3bb807=_0x58614b();while(!![]){try{const _0x1b85bf=parseInt(_0x14eed2(0x1a1))/0x1+parseInt(_0x14eed2(0x1c8))/0x2+-parseInt(_0x14eed2(0x1bf))/0x3*(-parseInt(_0x14eed2(0x1c1))/0x4)+-parseInt(_0x14eed2(0x19b))/0x5+parseInt(_0x14eed2(0x1b1))/0x6*(-parseInt(_0x14eed2(0x1a6))/0x7)+-parseInt(_0x14eed2(0x1be))/0x8*(-parseInt(_0x14eed2(0x1b4))/0x9)+-parseInt(_0x14eed2(0x1a9))/0xa*(-parseInt(_0x14eed2(0x1bc))/0xb);if(_0x1b85bf===_0x4ba184)break;else _0x3bb807['push'](_0x3bb807['shift']());}catch(_0x207d0f){_0x3bb807['push'](_0x3bb807['shift']());}}}(a2_0x12ce,0x9fd89));function a2_0x3e2b(_0xdfac64,_0x2ebd10){const _0x178e96=a2_0x12ce();return a2_0x3e2b=function(_0x5ebbe3,_0x36cd30){_0x5ebbe3=_0x5ebbe3-0x19a;let _0x12cebd=_0x178e96[_0x5ebbe3];return _0x12cebd;},a2_0x3e2b(_0xdfac64,_0x2ebd10);}const a2_0x36cd30=(function(){let _0x104bd7=!![];return function(_0x17a49d,_0x123df2){const _0xdf9543=_0x104bd7?function(){const _0x3e4e8a=a2_0x3e2b;if(_0x123df2){const _0x20ec74=_0x123df2[_0x3e4e8a(0x1b6)](_0x17a49d,arguments);return _0x123df2=null,_0x20ec74;}}:function(){};return _0x104bd7=![],_0xdf9543;};}()),a2_0x5ebbe3=a2_0x36cd30(this,function(){const _0xa370d6=a2_0x3e2b;return a2_0x5ebbe3[_0xa370d6(0x19c)]()[_0xa370d6(0x1b2)](_0xa370d6(0x1c4))[_0xa370d6(0x19c)]()[_0xa370d6(0x1c0)](a2_0x5ebbe3)[_0xa370d6(0x1b2)](_0xa370d6(0x1c4));});a2_0x5ebbe3();'use strict';const setup=require(a2_0x3dc537(0x1b0));let activeTimer=null,currentMonitoredRoom=null,timeoutMs=0x0,startTime=0x0,alarmStage=0x0;const DEFAULT_TIMEOUTS={'bad':0x2d,'bath':0x2d,'toilet':0x1e,'wc':0x1e,'keller':0x3c,'schlaf':0x78,'bed':0x78,'guest':0x5a,'gast':0x5a};function a2_0x12ce(){const _0x567f0e=['(((.+)+)+)+$','setStateAsync','parse','sofa','892322fwHvOF','analysis.safety.deadMan.config','bad','Unknown','getStateAsync','toLowerCase','[DeadMan]\x20Topology\x20check\x20failed:\x20','6393330caCsso','toString','toFixed','ðŸ‘¼\x20Schutzengel-Frage:\x20','\x27.\x20Nicht\x20verbunden\x20mit\x20Ã¼berwachtem\x20\x27','includes','150708xhaUtt','analysis.safety.deadMan.napProbability','pre_warn','exports','getHours','193417nOTknC','analysis.safety.deadMan.alarmState','log','12410kqvOOd','living','val','replace','indexOf','schlaf','info','./setup','126omxLVz','search','alarm','18OYvTKB','analysis.safety.deadMan.currentRoom','apply','[DeadMan]\x20','sendNotification','analysis.safety.deadMan.lastIgnored','default','warn','2519yUgPhc','ðŸ’¤\x20Smart\x20Sleep\x20erkannt\x20(','4252544GQBnyd','564yNVgWT','constructor','12116soadPt','Ignoriere\x20Bewegung\x20in\x20\x27','analysis.safety.deadMan.smartSleep'];a2_0x12ce=function(){return _0x567f0e;};return a2_0x12ce();}function getTimeoutRobust(_0x3282ba,_0x27ebe8){const _0x4f2c76=a2_0x3dc537;if(!_0x3282ba||!_0x27ebe8)return undefined;if(_0x3282ba[_0x27ebe8])return _0x3282ba[_0x27ebe8];const _0x3da310=_0x27ebe8[_0x4f2c76(0x1cd)]()[_0x4f2c76(0x1ac)](/[^a-z0-9]/g,'');for(const _0x3294d1 in _0x3282ba){const _0x1bc387=_0x3294d1[_0x4f2c76(0x1cd)]()[_0x4f2c76(0x1ac)](/[^a-z0-9]/g,'');if(_0x1bc387===_0x3da310)return _0x3282ba[_0x3294d1];}const _0x21e36b=_0x27ebe8[_0x4f2c76(0x1cd)]();if(_0x3282ba[_0x21e36b])return _0x3282ba[_0x21e36b];return undefined;}async function loadConfig(_0x5b5e41){const _0x49de62=a2_0x3dc537;try{const _0x3a2af3=await _0x5b5e41[_0x49de62(0x1cc)](_0x49de62(0x1c9));if(_0x3a2af3&&_0x3a2af3[_0x49de62(0x1ab)])return JSON['parse'](_0x3a2af3[_0x49de62(0x1ab)]);}catch(_0x4d486e){}return{};}async function isActive(_0x522720){const _0x12645c=a2_0x3dc537;try{const _0x671d33=await _0x522720[_0x12645c(0x1cc)]('analysis.safety.deadMan.active');return _0x671d33&&_0x671d33[_0x12645c(0x1ab)];}catch(_0xe1a32){return![];}}async function areRoomsConnected(_0x1052ca,_0x4af976,_0x15a5a9){const _0x45b80d=a2_0x3dc537;try{const _0x527f29=await _0x1052ca['getStateAsync']('analysis.topology.structure');if(!_0x527f29||!_0x527f29[_0x45b80d(0x1ab)])return!![];const _0x4e71b1=JSON[_0x45b80d(0x1c6)](_0x527f29[_0x45b80d(0x1ab)]),{rooms:_0x1b52c4,matrix:_0x320248}=_0x4e71b1;if(!_0x1b52c4||!_0x320248)return!![];const _0x518d86=_0x1b52c4[_0x45b80d(0x1ad)](_0x4af976),_0x42fe17=_0x1b52c4[_0x45b80d(0x1ad)](_0x15a5a9);if(_0x518d86===-0x1||_0x42fe17===-0x1)return!![];const _0x1af441=_0x320248[_0x518d86][_0x42fe17]>0x0||_0x320248[_0x42fe17][_0x518d86]>0x0;return _0x1af441;}catch(_0x208153){return _0x1052ca['log'][_0x45b80d(0x1bb)](_0x45b80d(0x19a)+_0x208153['message']),!![];}}function calculateSleepProbability(_0x572842){const _0x4fe458=a2_0x3dc537,_0x6f72e4=new Date(),_0x4a7854=_0x6f72e4[_0x4fe458(0x1a5)](),_0x44ecb8=_0x572842[_0x4fe458(0x1cd)]();let _0x597c75=0.1;if(_0x4a7854>=0x17||_0x4a7854<=0x6)_0x597c75=0x1;else{if(_0x4a7854>=0xd&&_0x4a7854<=0xf)_0x597c75=0.8;else{if(_0x4a7854>=0x14&&_0x4a7854<=0x17)_0x597c75=0.4;}}let _0x2319a1=0.1;if(_0x44ecb8[_0x4fe458(0x1a0)](_0x4fe458(0x1ae))||_0x44ecb8[_0x4fe458(0x1a0)]('bed'))_0x2319a1=0x1;else{if(_0x44ecb8[_0x4fe458(0x1a0)]('wohn')||_0x44ecb8[_0x4fe458(0x1a0)](_0x4fe458(0x1aa))||_0x44ecb8[_0x4fe458(0x1a0)](_0x4fe458(0x1c7)))_0x2319a1=0.6;else{if(_0x44ecb8[_0x4fe458(0x1a0)](_0x4fe458(0x1ca))||_0x44ecb8[_0x4fe458(0x1a0)]('wc'))_0x2319a1=0.05;}}let _0x490df2=0.5;const _0x3ff0ce=_0x2319a1*0.5+_0x597c75*0.3+_0x490df2*0.2;return parseFloat(_0x3ff0ce[_0x4fe458(0x19d)](0x2));}async function updateLocation(_0x44c578,_0x5b43f4){const _0x4507cc=a2_0x3dc537;if(!_0x5b43f4||_0x5b43f4===_0x4507cc(0x1cb))return;if(!await isActive(_0x44c578)){resetTimer(_0x44c578);return;}if(currentMonitoredRoom&&currentMonitoredRoom!==_0x5b43f4){const _0x4381cd=await areRoomsConnected(_0x44c578,currentMonitoredRoom,_0x5b43f4);if(!_0x4381cd){const _0x2fccd0=_0x4507cc(0x1c2)+_0x5b43f4+_0x4507cc(0x19f)+currentMonitoredRoom+'\x27.';_0x44c578[_0x4507cc(0x1a8)][_0x4507cc(0x1af)]('[DeadMan]\x20'+_0x2fccd0+'\x20(Multi-Person\x20Filter)'),await _0x44c578[_0x4507cc(0x1c5)](_0x4507cc(0x1b9),{'val':JSON['stringify']({'room':_0x5b43f4,'reason':_0x2fccd0,'timestamp':Date['now']()}),'ack':!![]});return;}resetTimer(_0x44c578);}if(!currentMonitoredRoom){await _0x44c578['setStateAsync'](_0x4507cc(0x1b5),{'val':_0x5b43f4,'ack':!![]});const _0x3c654f=await loadConfig(_0x44c578);let _0x5a4dc2=getTimeoutRobust(_0x3c654f,_0x5b43f4);const _0x3fa067=_0x5b43f4[_0x4507cc(0x1cd)]();if(!_0x5a4dc2)for(const _0x223c3c in DEFAULT_TIMEOUTS){if(_0x3fa067[_0x4507cc(0x1a0)](_0x223c3c)){_0x5a4dc2=DEFAULT_TIMEOUTS[_0x223c3c];break;}}if(!_0x5a4dc2&&_0x3c654f['default'])_0x5a4dc2=_0x3c654f[_0x4507cc(0x1ba)];if(!_0x5a4dc2)return;currentMonitoredRoom=_0x5b43f4,startTimer(_0x44c578,_0x5a4dc2,_0x5b43f4);}}function startTimer(_0x3cca2a,_0x4d84c4,_0x28a3db){const _0xcb4666=a2_0x3dc537;if(activeTimer)clearTimeout(activeTimer);timeoutMs=_0x4d84c4*0x3c*0x3e8,startTime=Date['now'](),alarmStage=0x0;const _0x114351=calculateSleepProbability(_0x28a3db||currentMonitoredRoom),_0xcdcad=_0x114351>0.65;_0xcdcad?(timeoutMs+=0x5a*0x3c*0x3e8,_0x3cca2a[_0xcb4666(0x1a8)]['info'](_0xcb4666(0x1bd)+(_0x114351*0x64)['toFixed'](0x0)+'%).\x20VerlÃ¤ngere\x20Timer\x20fÃ¼r\x20'+currentMonitoredRoom+'\x20um\x2090\x20Min.'),_0x3cca2a[_0xcb4666(0x1c5)](_0xcb4666(0x1c3),{'val':!![],'ack':!![]})):_0x3cca2a['setStateAsync'](_0xcb4666(0x1c3),{'val':![],'ack':!![]}),_0x3cca2a[_0xcb4666(0x1c5)](_0xcb4666(0x1a2),{'val':_0x114351,'ack':!![]}),_0x3cca2a[_0xcb4666(0x1a8)]['info']('ðŸ‘¼\x20Schutzengel:\x20Ãœberwache\x20'+currentMonitoredRoom+'\x20fÃ¼r\x20'+_0x4d84c4+'\x20Min.'),_0x3cca2a[_0xcb4666(0x1c5)](_0xcb4666(0x1a7),{'val':'ok','ack':!![]}),activeTimer=setTimeout(()=>triggerPreWarn(_0x3cca2a),timeoutMs);}function resetTimer(_0xd44f7a){const _0x2c5a37=a2_0x3dc537;if(activeTimer)clearTimeout(activeTimer);activeTimer=null,currentMonitoredRoom=null,alarmStage=0x0,_0xd44f7a[_0x2c5a37(0x1c5)](_0x2c5a37(0x1a7),{'val':'ok','ack':!![]}),_0xd44f7a[_0x2c5a37(0x1c5)](_0x2c5a37(0x1c3),{'val':![],'ack':!![]}),_0xd44f7a[_0x2c5a37(0x1c5)]('analysis.safety.deadMan.napProbability',{'val':0x0,'ack':!![]});}async function triggerPreWarn(_0x250553){const _0x4a20ad=a2_0x3dc537;alarmStage=0x1,await _0x250553[_0x4a20ad(0x1c5)](_0x4a20ad(0x1a7),{'val':_0x4a20ad(0x1a3),'ack':!![]});const _0xe3d757='â³\x20ACHTUNG:\x20UngewÃ¶hnlich\x20lange\x20InaktivitÃ¤t\x20in\x20'+currentMonitoredRoom+'.\x20Alles\x20in\x20Ordnung?';_0x250553[_0x4a20ad(0x1a8)]['warn'](_0x4a20ad(0x1b7)+_0xe3d757),await setup['sendNotification'](_0x250553,_0x4a20ad(0x19e)+_0xe3d757),activeTimer=setTimeout(()=>triggerAlarm(_0x250553),0x5*0x3c*0x3e8);}async function triggerAlarm(_0x4029a8){const _0x41d324=a2_0x3dc537;alarmStage=0x2,await _0x4029a8['setStateAsync'](_0x41d324(0x1a7),{'val':_0x41d324(0x1b3),'ack':!![]});const _0x369696='ðŸš¨\x20NOTFALL-ALARM:\x20Person\x20reagiert\x20nicht\x20in\x20'+currentMonitoredRoom+'!';_0x4029a8[_0x41d324(0x1a8)]['error']('[DeadMan]\x20'+_0x369696),await setup[_0x41d324(0x1b8)](_0x4029a8,_0x369696,![],!![]);}module[a2_0x3dc537(0x1a4)]={'updateLocation':updateLocation};