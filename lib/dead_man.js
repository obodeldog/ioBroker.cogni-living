function a2_0x231f(_0x2c7f3e,_0x260f80){const _0x3c30ad=a2_0x3150();return a2_0x231f=function(_0x5efb96,_0x123c0b){_0x5efb96=_0x5efb96-0xe5;let _0x31505c=_0x3c30ad[_0x5efb96];return _0x31505c;},a2_0x231f(_0x2c7f3e,_0x260f80);}const a2_0x592d0a=a2_0x231f;(function(_0x6e91eb,_0x1a894c){const _0x1d6b96=a2_0x231f,_0x923035=_0x6e91eb();while(!![]){try{const _0x221642=-parseInt(_0x1d6b96(0x119))/0x1*(-parseInt(_0x1d6b96(0x106))/0x2)+parseInt(_0x1d6b96(0x117))/0x3+-parseInt(_0x1d6b96(0x112))/0x4+parseInt(_0x1d6b96(0xf0))/0x5*(-parseInt(_0x1d6b96(0x103))/0x6)+parseInt(_0x1d6b96(0xee))/0x7+parseInt(_0x1d6b96(0x10b))/0x8*(-parseInt(_0x1d6b96(0x11b))/0x9)+-parseInt(_0x1d6b96(0xe9))/0xa*(-parseInt(_0x1d6b96(0x107))/0xb);if(_0x221642===_0x1a894c)break;else _0x923035['push'](_0x923035['shift']());}catch(_0x17155c){_0x923035['push'](_0x923035['shift']());}}}(a2_0x3150,0x474fa));const a2_0x123c0b=(function(){let _0x3fc160=!![];return function(_0x4113e9,_0x4f146d){const _0x2f72c6=_0x3fc160?function(){if(_0x4f146d){const _0x3c5cbd=_0x4f146d['apply'](_0x4113e9,arguments);return _0x4f146d=null,_0x3c5cbd;}}:function(){};return _0x3fc160=![],_0x2f72c6;};}()),a2_0x5efb96=a2_0x123c0b(this,function(){const _0x468952=a2_0x231f;return a2_0x5efb96[_0x468952(0x109)]()['search'](_0x468952(0x101))[_0x468952(0x109)]()['constructor'](a2_0x5efb96)['search'](_0x468952(0x101));});a2_0x5efb96();'use strict';const setup=require(a2_0x592d0a(0xfb));function a2_0x3150(){const _0x194773=['ðŸ’¤\x20Smart\x20Sleep\x20erkannt\x20(','toString','getHours','869656tTlERy','setStateAsync','ðŸ‘¼\x20Schutzengel:\x20Ãœberwache\x20','getStateAsync','val','warn','wohn','1093252QiMcBf','schlaf','[DeadMan]\x20Topology\x20check\x20failed:\x20','analysis.safety.deadMan.napProbability','.\x20Alles\x20in\x20Ordnung?','350739juPSrg','analysis.safety.deadMan.currentRoom','1149yGkYmP','replace','9DFHyUP','log','analysis.safety.deadMan.active','includes','\x20um\x2090\x20Min.','\x27.\x20Nicht\x20verbunden\x20mit\x20Ã¼berwachtem\x20\x27','20aTCKZg','error','Ignoriere\x20Bewegung\x20in\x20\x27','[DeadMan]\x20','bad','1966139AoHCEw','toLowerCase','826445mmfLkD','analysis.safety.deadMan.config','parse','sendNotification','alarm','sofa','now','stringify','toFixed','\x20fÃ¼r\x20','analysis.topology.structure','./setup','indexOf','pre_warn','info','default','\x20(Multi-Person\x20Filter)','(((.+)+)+)+$','analysis.safety.deadMan.smartSleep','18dLxDNs','ðŸš¨\x20NOTFALL-ALARM:\x20Person\x20reagiert\x20nicht\x20in\x20','analysis.safety.deadMan.alarmState','394ZvHvfx','3002087vohWCb'];a2_0x3150=function(){return _0x194773;};return a2_0x3150();}let activeTimer=null,currentMonitoredRoom=null,timeoutMs=0x0,startTime=0x0,alarmStage=0x0;const DEFAULT_TIMEOUTS={'bad':0x2d,'bath':0x2d,'toilet':0x1e,'wc':0x1e,'keller':0x3c,'schlaf':0x78,'bed':0x78,'guest':0x5a,'gast':0x5a};function getTimeoutRobust(_0x3fd297,_0x1444d3){const _0x2955c6=a2_0x592d0a;if(!_0x3fd297||!_0x1444d3)return undefined;if(_0x3fd297[_0x1444d3])return _0x3fd297[_0x1444d3];const _0x360d31=_0x1444d3['toLowerCase']()[_0x2955c6(0x11a)](/[^a-z0-9]/g,'');for(const _0x44684c in _0x3fd297){const _0x3742ce=_0x44684c['toLowerCase']()[_0x2955c6(0x11a)](/[^a-z0-9]/g,'');if(_0x3742ce===_0x360d31)return _0x3fd297[_0x44684c];}const _0x5c1fe7=_0x1444d3[_0x2955c6(0xef)]();if(_0x3fd297[_0x5c1fe7])return _0x3fd297[_0x5c1fe7];return undefined;}async function loadConfig(_0x48cc2d){const _0x577460=a2_0x592d0a;try{const _0x37fc19=await _0x48cc2d[_0x577460(0x10e)](_0x577460(0xf1));if(_0x37fc19&&_0x37fc19[_0x577460(0x10f)])return JSON['parse'](_0x37fc19[_0x577460(0x10f)]);}catch(_0x5ebb0e){}return{};}async function isActive(_0x491d63){const _0x5322e9=a2_0x592d0a;try{const _0x480065=await _0x491d63[_0x5322e9(0x10e)](_0x5322e9(0xe5));return _0x480065&&_0x480065[_0x5322e9(0x10f)];}catch(_0x368590){return![];}}async function areRoomsConnected(_0x4941a3,_0x291220,_0x96f568){const _0x52b0fc=a2_0x592d0a;try{const _0x444b9a=await _0x4941a3[_0x52b0fc(0x10e)](_0x52b0fc(0xfa));if(!_0x444b9a||!_0x444b9a['val'])return!![];const _0x3d83cf=JSON[_0x52b0fc(0xf2)](_0x444b9a[_0x52b0fc(0x10f)]),{rooms:_0x172e0d,matrix:_0x35ba18}=_0x3d83cf;if(!_0x172e0d||!_0x35ba18)return!![];const _0x409157=_0x172e0d['indexOf'](_0x291220),_0x262ba6=_0x172e0d[_0x52b0fc(0xfc)](_0x96f568);if(_0x409157===-0x1||_0x262ba6===-0x1)return!![];const _0x5efc3e=_0x35ba18[_0x409157][_0x262ba6]>0x0||_0x35ba18[_0x262ba6][_0x409157]>0x0;return _0x5efc3e;}catch(_0x46b313){return _0x4941a3[_0x52b0fc(0x11c)]['warn'](_0x52b0fc(0x114)+_0x46b313['message']),!![];}}function calculateSleepProbability(_0x200fa5){const _0x36ea35=a2_0x592d0a,_0x171887=new Date(),_0x57dead=_0x171887[_0x36ea35(0x10a)](),_0x2e82fd=_0x200fa5['toLowerCase']();let _0x2324ca=0.1;if(_0x57dead>=0x17||_0x57dead<=0x6)_0x2324ca=0x1;else{if(_0x57dead>=0xd&&_0x57dead<=0xf)_0x2324ca=0.8;else{if(_0x57dead>=0x14&&_0x57dead<=0x17)_0x2324ca=0.4;}}let _0x54c247=0.1;if(_0x2e82fd[_0x36ea35(0xe6)](_0x36ea35(0x113))||_0x2e82fd['includes']('bed'))_0x54c247=0x1;else{if(_0x2e82fd[_0x36ea35(0xe6)](_0x36ea35(0x111))||_0x2e82fd['includes']('living')||_0x2e82fd['includes'](_0x36ea35(0xf5)))_0x54c247=0.6;else{if(_0x2e82fd[_0x36ea35(0xe6)](_0x36ea35(0xed))||_0x2e82fd['includes']('wc'))_0x54c247=0.05;}}let _0x179303=0.5;const _0x494325=_0x54c247*0.5+_0x2324ca*0.3+_0x179303*0.2;return parseFloat(_0x494325[_0x36ea35(0xf8)](0x2));}async function updateLocation(_0x43d06d,_0x38ab1b){const _0x3079bf=a2_0x592d0a;if(!_0x38ab1b||_0x38ab1b==='Unknown')return;if(!await isActive(_0x43d06d)){resetTimer(_0x43d06d);return;}if(currentMonitoredRoom&&currentMonitoredRoom!==_0x38ab1b){const _0xf202cc=await areRoomsConnected(_0x43d06d,currentMonitoredRoom,_0x38ab1b);if(!_0xf202cc){const _0xb2567d=_0x3079bf(0xeb)+_0x38ab1b+_0x3079bf(0xe8)+currentMonitoredRoom+'\x27.';_0x43d06d['log'][_0x3079bf(0xfe)]('[DeadMan]\x20'+_0xb2567d+_0x3079bf(0x100)),await _0x43d06d[_0x3079bf(0x10c)]('analysis.safety.deadMan.lastIgnored',{'val':JSON[_0x3079bf(0xf7)]({'room':_0x38ab1b,'reason':_0xb2567d,'timestamp':Date[_0x3079bf(0xf6)]()}),'ack':!![]});return;}resetTimer(_0x43d06d);}if(!currentMonitoredRoom){await _0x43d06d[_0x3079bf(0x10c)](_0x3079bf(0x118),{'val':_0x38ab1b,'ack':!![]});const _0x290f21=await loadConfig(_0x43d06d);let _0x65f806=getTimeoutRobust(_0x290f21,_0x38ab1b);const _0x56f5db=_0x38ab1b[_0x3079bf(0xef)]();if(!_0x65f806)for(const _0x59d008 in DEFAULT_TIMEOUTS){if(_0x56f5db['includes'](_0x59d008)){_0x65f806=DEFAULT_TIMEOUTS[_0x59d008];break;}}if(!_0x65f806&&_0x290f21[_0x3079bf(0xff)])_0x65f806=_0x290f21[_0x3079bf(0xff)];if(!_0x65f806)return;currentMonitoredRoom=_0x38ab1b,startTimer(_0x43d06d,_0x65f806,_0x38ab1b);}}function startTimer(_0x53bfb4,_0x401f7e,_0x5c9c05){const _0x37de37=a2_0x592d0a;if(activeTimer)clearTimeout(activeTimer);timeoutMs=_0x401f7e*0x3c*0x3e8,startTime=Date[_0x37de37(0xf6)](),alarmStage=0x0;const _0x47fb4b=calculateSleepProbability(_0x5c9c05||currentMonitoredRoom),_0x3ebd9d=_0x47fb4b>0.65;_0x3ebd9d?(timeoutMs+=0x5a*0x3c*0x3e8,_0x53bfb4['log']['info'](_0x37de37(0x108)+(_0x47fb4b*0x64)['toFixed'](0x0)+'%).\x20VerlÃ¤ngere\x20Timer\x20fÃ¼r\x20'+currentMonitoredRoom+_0x37de37(0xe7)),_0x53bfb4['setStateAsync'](_0x37de37(0x102),{'val':!![],'ack':!![]})):_0x53bfb4[_0x37de37(0x10c)]('analysis.safety.deadMan.smartSleep',{'val':![],'ack':!![]}),_0x53bfb4[_0x37de37(0x10c)]('analysis.safety.deadMan.napProbability',{'val':_0x47fb4b,'ack':!![]}),_0x53bfb4['log'][_0x37de37(0xfe)](_0x37de37(0x10d)+currentMonitoredRoom+_0x37de37(0xf9)+_0x401f7e+'\x20Min.'),_0x53bfb4['setStateAsync'](_0x37de37(0x105),{'val':'ok','ack':!![]}),activeTimer=setTimeout(()=>triggerPreWarn(_0x53bfb4),timeoutMs);}function resetTimer(_0x1981a3){const _0x2bb0b8=a2_0x592d0a;if(activeTimer)clearTimeout(activeTimer);activeTimer=null,currentMonitoredRoom=null,alarmStage=0x0,_0x1981a3['setStateAsync'](_0x2bb0b8(0x105),{'val':'ok','ack':!![]}),_0x1981a3[_0x2bb0b8(0x10c)]('analysis.safety.deadMan.smartSleep',{'val':![],'ack':!![]}),_0x1981a3[_0x2bb0b8(0x10c)](_0x2bb0b8(0x115),{'val':0x0,'ack':!![]});}async function triggerPreWarn(_0x5f3f8f){const _0x57d900=a2_0x592d0a;alarmStage=0x1,await _0x5f3f8f[_0x57d900(0x10c)](_0x57d900(0x105),{'val':_0x57d900(0xfd),'ack':!![]});const _0x2c6c22='â³\x20ACHTUNG:\x20UngewÃ¶hnlich\x20lange\x20InaktivitÃ¤t\x20in\x20'+currentMonitoredRoom+_0x57d900(0x116);_0x5f3f8f[_0x57d900(0x11c)][_0x57d900(0x110)](_0x57d900(0xec)+_0x2c6c22),await setup[_0x57d900(0xf3)](_0x5f3f8f,'ðŸ‘¼\x20Schutzengel-Frage:\x20'+_0x2c6c22),activeTimer=setTimeout(()=>triggerAlarm(_0x5f3f8f),0x5*0x3c*0x3e8);}async function triggerAlarm(_0x5f02f7){const _0x34694c=a2_0x592d0a;alarmStage=0x2,await _0x5f02f7[_0x34694c(0x10c)](_0x34694c(0x105),{'val':_0x34694c(0xf4),'ack':!![]});const _0x36cdbd=_0x34694c(0x104)+currentMonitoredRoom+'!';_0x5f02f7[_0x34694c(0x11c)][_0x34694c(0xea)](_0x34694c(0xec)+_0x36cdbd),await setup['sendNotification'](_0x5f02f7,_0x36cdbd,![],!![]);}module['exports']={'updateLocation':updateLocation};