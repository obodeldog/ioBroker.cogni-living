const a2_0x41d976=a2_0x114c;(function(_0x371f7b,_0x37e3b5){const _0x29de0c=a2_0x114c,_0x1175db=_0x371f7b();while(!![]){try{const _0x2b6576=parseInt(_0x29de0c(0x1e5))/0x1*(-parseInt(_0x29de0c(0x206))/0x2)+parseInt(_0x29de0c(0x1f0))/0x3*(-parseInt(_0x29de0c(0x203))/0x4)+parseInt(_0x29de0c(0x20f))/0x5+-parseInt(_0x29de0c(0x1ed))/0x6*(-parseInt(_0x29de0c(0x202))/0x7)+-parseInt(_0x29de0c(0x1e7))/0x8+-parseInt(_0x29de0c(0x208))/0x9+parseInt(_0x29de0c(0x207))/0xa;if(_0x2b6576===_0x37e3b5)break;else _0x1175db['push'](_0x1175db['shift']());}catch(_0x5ca584){_0x1175db['push'](_0x1175db['shift']());}}}(a2_0x5403,0x879d8));const a2_0xb34d1c=(function(){let _0x5a2218=!![];return function(_0x378913,_0x32badf){const _0x53b809=_0x5a2218?function(){const _0x278a4d=a2_0x114c;if(_0x32badf){const _0x571ce5=_0x32badf[_0x278a4d(0x200)](_0x378913,arguments);return _0x32badf=null,_0x571ce5;}}:function(){};return _0x5a2218=![],_0x53b809;};}()),a2_0x568881=a2_0xb34d1c(this,function(){const _0x4311d5=a2_0x114c;return a2_0x568881['toString']()[_0x4311d5(0x1ff)](_0x4311d5(0x201))['toString']()[_0x4311d5(0x20e)](a2_0x568881)['search'](_0x4311d5(0x201));});a2_0x568881();'use strict';const setup=require(a2_0x41d976(0x210));let activeTimer=null,currentMonitoredRoom=null,timeoutMs=0x0,startTime=0x0,alarmStage=0x0;const DEFAULT_TIMEOUTS={'bad':0x2d,'bath':0x2d,'toilet':0x1e,'wc':0x1e,'keller':0x3c,'schlaf':0x78,'bed':0x78,'guest':0x5a,'gast':0x5a};function getTimeoutRobust(_0x446419,_0x2e8ee5){const _0x10657d=a2_0x41d976;if(!_0x446419||!_0x2e8ee5)return undefined;if(_0x446419[_0x2e8ee5])return _0x446419[_0x2e8ee5];const _0x528b58=_0x2e8ee5[_0x10657d(0x1e6)]()[_0x10657d(0x1e1)](/[^a-z0-9]/g,'');for(const _0x1b476d in _0x446419){const _0x1a4361=_0x1b476d[_0x10657d(0x1e6)]()[_0x10657d(0x1e1)](/[^a-z0-9]/g,'');if(_0x1a4361===_0x528b58)return _0x446419[_0x1b476d];}const _0x3e3501=_0x2e8ee5[_0x10657d(0x1e6)]();if(_0x446419[_0x3e3501])return _0x446419[_0x3e3501];return undefined;}function a2_0x5403(){const _0x19b7e7=['val','replace','\x20um\x2090\x20Min.','setStateAsync','\x20fÃ¼r\x20','739559YPGEJY','toLowerCase','4551712hiZsBM','getStateAsync','schlaf','analysis.safety.deadMan.smartSleep','[DeadMan]\x20','analysis.safety.deadMan.currentRoom','20208TyfiEA','log','default','6834GRTOHU','wohn','analysis.topology.structure','â³\x20ACHTUNG:\x20UngewÃ¶hnlich\x20lange\x20InaktivitÃ¤t\x20in\x20','Unknown','error','exports','bed','pre_warn','bad','analysis.safety.deadMan.napProbability','stringify','ðŸš¨\x20NOTFALL-ALARM:\x20Person\x20reagiert\x20nicht\x20in\x20','ðŸ‘¼\x20Schutzengel-Frage:\x20','includes','search','apply','(((.+)+)+)+$','2156VQJaZn','868LEDhZh','parse','alarm','2sSfEun','12589930wOZDvN','118773XHOzZg','Ignoriere\x20Bewegung\x20in\x20\x27','analysis.safety.deadMan.alarmState','\x20Min.','warn','sofa','constructor','375945JFaycH','./setup','info','\x20(Multi-Person\x20Filter)','now','indexOf','sendNotification','.\x20Alles\x20in\x20Ordnung?','toFixed','ðŸ’¤\x20Smart\x20Sleep\x20erkannt\x20(','\x27.\x20Nicht\x20verbunden\x20mit\x20Ã¼berwachtem\x20\x27','living'];a2_0x5403=function(){return _0x19b7e7;};return a2_0x5403();}async function loadConfig(_0x3d205d){const _0x494286=a2_0x41d976;try{const _0x206fb3=await _0x3d205d[_0x494286(0x1e8)]('analysis.safety.deadMan.config');if(_0x206fb3&&_0x206fb3[_0x494286(0x1e0)])return JSON[_0x494286(0x204)](_0x206fb3[_0x494286(0x1e0)]);}catch(_0x2bd06c){}return{};}async function isActive(_0x1ceae7){const _0x2af812=a2_0x41d976;try{const _0x39a06f=await _0x1ceae7[_0x2af812(0x1e8)]('analysis.safety.deadMan.active');return _0x39a06f&&_0x39a06f[_0x2af812(0x1e0)];}catch(_0x2967a7){return![];}}async function areRoomsConnected(_0x36750e,_0x44d4c2,_0x431a9c){const _0x515fba=a2_0x41d976;try{const _0x1253b6=await _0x36750e[_0x515fba(0x1e8)](_0x515fba(0x1f2));if(!_0x1253b6||!_0x1253b6['val'])return!![];const _0x4b7559=JSON[_0x515fba(0x204)](_0x1253b6[_0x515fba(0x1e0)]),{rooms:_0x2ce9df,matrix:_0x40d13e}=_0x4b7559;if(!_0x2ce9df||!_0x40d13e)return!![];const _0x5d5266=_0x2ce9df[_0x515fba(0x1d9)](_0x44d4c2),_0x116fcc=_0x2ce9df[_0x515fba(0x1d9)](_0x431a9c);if(_0x5d5266===-0x1||_0x116fcc===-0x1)return!![];const _0x2f3366=_0x40d13e[_0x5d5266][_0x116fcc]>0x0||_0x40d13e[_0x116fcc][_0x5d5266]>0x0;return _0x2f3366;}catch(_0x1ff389){return _0x36750e[_0x515fba(0x1ee)][_0x515fba(0x20c)]('[DeadMan]\x20Topology\x20check\x20failed:\x20'+_0x1ff389['message']),!![];}}function calculateSleepProbability(_0x385287){const _0x2b14d0=a2_0x41d976,_0x3686c3=new Date(),_0x47296b=_0x3686c3['getHours'](),_0x3deab1=_0x385287[_0x2b14d0(0x1e6)]();let _0x466284=0.1;if(_0x47296b>=0x17||_0x47296b<=0x6)_0x466284=0x1;else{if(_0x47296b>=0xd&&_0x47296b<=0xf)_0x466284=0.8;else{if(_0x47296b>=0x14&&_0x47296b<=0x17)_0x466284=0.4;}}let _0x50ec96=0.1;if(_0x3deab1[_0x2b14d0(0x1fe)](_0x2b14d0(0x1e9))||_0x3deab1[_0x2b14d0(0x1fe)](_0x2b14d0(0x1f7)))_0x50ec96=0x1;else{if(_0x3deab1[_0x2b14d0(0x1fe)](_0x2b14d0(0x1f1))||_0x3deab1[_0x2b14d0(0x1fe)](_0x2b14d0(0x1df))||_0x3deab1[_0x2b14d0(0x1fe)](_0x2b14d0(0x20d)))_0x50ec96=0.6;else{if(_0x3deab1[_0x2b14d0(0x1fe)](_0x2b14d0(0x1f9))||_0x3deab1['includes']('wc'))_0x50ec96=0.05;}}let _0x49cb80=0.5;const _0x4b2413=_0x50ec96*0.5+_0x466284*0.3+_0x49cb80*0.2;return parseFloat(_0x4b2413[_0x2b14d0(0x1dc)](0x2));}async function updateLocation(_0xeb8c9a,_0x46537a){const _0x3b7d3a=a2_0x41d976;if(!_0x46537a||_0x46537a===_0x3b7d3a(0x1f4))return;if(!await isActive(_0xeb8c9a)){resetTimer(_0xeb8c9a);return;}if(currentMonitoredRoom&&currentMonitoredRoom!==_0x46537a){const _0x328f22=await areRoomsConnected(_0xeb8c9a,currentMonitoredRoom,_0x46537a);if(!_0x328f22){const _0x266c7b=_0x3b7d3a(0x209)+_0x46537a+_0x3b7d3a(0x1de)+currentMonitoredRoom+'\x27.';_0xeb8c9a[_0x3b7d3a(0x1ee)][_0x3b7d3a(0x211)](_0x3b7d3a(0x1eb)+_0x266c7b+_0x3b7d3a(0x212)),await _0xeb8c9a['setStateAsync']('analysis.safety.deadMan.lastIgnored',{'val':JSON[_0x3b7d3a(0x1fb)]({'room':_0x46537a,'reason':_0x266c7b,'timestamp':Date[_0x3b7d3a(0x213)]()}),'ack':!![]});return;}resetTimer(_0xeb8c9a);}if(!currentMonitoredRoom){await _0xeb8c9a[_0x3b7d3a(0x1e3)](_0x3b7d3a(0x1ec),{'val':_0x46537a,'ack':!![]});const _0x4f9b79=await loadConfig(_0xeb8c9a);let _0x160ea8=getTimeoutRobust(_0x4f9b79,_0x46537a);const _0x3b7361=_0x46537a[_0x3b7d3a(0x1e6)]();if(!_0x160ea8)for(const _0xcaf1a5 in DEFAULT_TIMEOUTS){if(_0x3b7361[_0x3b7d3a(0x1fe)](_0xcaf1a5)){_0x160ea8=DEFAULT_TIMEOUTS[_0xcaf1a5];break;}}if(!_0x160ea8&&_0x4f9b79[_0x3b7d3a(0x1ef)])_0x160ea8=_0x4f9b79['default'];if(!_0x160ea8)return;currentMonitoredRoom=_0x46537a,startTimer(_0xeb8c9a,_0x160ea8,_0x46537a);}}function startTimer(_0x1791ed,_0x16070a,_0x6b2ecd){const _0x18b206=a2_0x41d976;if(activeTimer)clearTimeout(activeTimer);timeoutMs=_0x16070a*0x3c*0x3e8,startTime=Date[_0x18b206(0x213)](),alarmStage=0x0;const _0x523660=calculateSleepProbability(_0x6b2ecd||currentMonitoredRoom),_0x39ef58=_0x523660>0.65;_0x39ef58?(timeoutMs+=0x5a*0x3c*0x3e8,_0x1791ed['log'][_0x18b206(0x211)](_0x18b206(0x1dd)+(_0x523660*0x64)[_0x18b206(0x1dc)](0x0)+'%).\x20VerlÃ¤ngere\x20Timer\x20fÃ¼r\x20'+currentMonitoredRoom+_0x18b206(0x1e2)),_0x1791ed[_0x18b206(0x1e3)]('analysis.safety.deadMan.smartSleep',{'val':!![],'ack':!![]})):_0x1791ed[_0x18b206(0x1e3)](_0x18b206(0x1ea),{'val':![],'ack':!![]}),_0x1791ed[_0x18b206(0x1e3)](_0x18b206(0x1fa),{'val':_0x523660,'ack':!![]}),_0x1791ed[_0x18b206(0x1ee)]['info']('ðŸ‘¼\x20Schutzengel:\x20Ãœberwache\x20'+currentMonitoredRoom+_0x18b206(0x1e4)+_0x16070a+_0x18b206(0x20b)),_0x1791ed['setStateAsync']('analysis.safety.deadMan.alarmState',{'val':'ok','ack':!![]}),activeTimer=setTimeout(()=>triggerPreWarn(_0x1791ed),timeoutMs);}function a2_0x114c(_0x10a5c3,_0x4bb9fb){const _0x10c681=a2_0x5403();return a2_0x114c=function(_0x568881,_0xb34d1c){_0x568881=_0x568881-0x1d9;let _0x5403c4=_0x10c681[_0x568881];return _0x5403c4;},a2_0x114c(_0x10a5c3,_0x4bb9fb);}function resetTimer(_0x21d481){const _0x255885=a2_0x41d976;if(activeTimer)clearTimeout(activeTimer);activeTimer=null,currentMonitoredRoom=null,alarmStage=0x0,_0x21d481[_0x255885(0x1e3)](_0x255885(0x20a),{'val':'ok','ack':!![]}),_0x21d481['setStateAsync'](_0x255885(0x1ea),{'val':![],'ack':!![]}),_0x21d481['setStateAsync'](_0x255885(0x1fa),{'val':0x0,'ack':!![]});}async function triggerPreWarn(_0x3ca42b){const _0x4e9441=a2_0x41d976;alarmStage=0x1,await _0x3ca42b[_0x4e9441(0x1e3)]('analysis.safety.deadMan.alarmState',{'val':_0x4e9441(0x1f8),'ack':!![]});const _0x46a1eb=_0x4e9441(0x1f3)+currentMonitoredRoom+_0x4e9441(0x1db);_0x3ca42b[_0x4e9441(0x1ee)][_0x4e9441(0x20c)](_0x4e9441(0x1eb)+_0x46a1eb),await setup[_0x4e9441(0x1da)](_0x3ca42b,_0x4e9441(0x1fd)+_0x46a1eb),activeTimer=setTimeout(()=>triggerAlarm(_0x3ca42b),0x5*0x3c*0x3e8);}async function triggerAlarm(_0x2223d7){const _0x4c810f=a2_0x41d976;alarmStage=0x2,await _0x2223d7[_0x4c810f(0x1e3)]('analysis.safety.deadMan.alarmState',{'val':_0x4c810f(0x205),'ack':!![]});const _0x6836e0=_0x4c810f(0x1fc)+currentMonitoredRoom+'!';_0x2223d7[_0x4c810f(0x1ee)][_0x4c810f(0x1f5)]('[DeadMan]\x20'+_0x6836e0),await setup[_0x4c810f(0x1da)](_0x2223d7,_0x6836e0,![],!![]);}module[a2_0x41d976(0x1f6)]={'updateLocation':updateLocation};