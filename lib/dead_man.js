const a2_0x1819d2=a2_0x4459;(function(_0x2d2f1d,_0x251bd7){const _0x112acd=a2_0x4459,_0x38757d=_0x2d2f1d();while(!![]){try{const _0x7755cc=-parseInt(_0x112acd(0x197))/0x1*(-parseInt(_0x112acd(0x17d))/0x2)+parseInt(_0x112acd(0x188))/0x3+-parseInt(_0x112acd(0x177))/0x4*(-parseInt(_0x112acd(0x182))/0x5)+-parseInt(_0x112acd(0x16a))/0x6+-parseInt(_0x112acd(0x17e))/0x7*(-parseInt(_0x112acd(0x18d))/0x8)+-parseInt(_0x112acd(0x19a))/0x9+parseInt(_0x112acd(0x184))/0xa*(-parseInt(_0x112acd(0x18c))/0xb);if(_0x7755cc===_0x251bd7)break;else _0x38757d['push'](_0x38757d['shift']());}catch(_0x54d3d9){_0x38757d['push'](_0x38757d['shift']());}}}(a2_0xbce1,0xde80c));function a2_0x4459(_0x549c2e,_0x56be16){const _0x358dd2=a2_0xbce1();return a2_0x4459=function(_0x36ac20,_0x3871b9){_0x36ac20=_0x36ac20-0x168;let _0xbce16e=_0x358dd2[_0x36ac20];return _0xbce16e;},a2_0x4459(_0x549c2e,_0x56be16);}const a2_0x3871b9=(function(){let _0x3d3df9=!![];return function(_0x48f666,_0x1332a6){const _0x36c870=_0x3d3df9?function(){const _0x50858c=a2_0x4459;if(_0x1332a6){const _0xa24f61=_0x1332a6[_0x50858c(0x16d)](_0x48f666,arguments);return _0x1332a6=null,_0xa24f61;}}:function(){};return _0x3d3df9=![],_0x36c870;};}()),a2_0x36ac20=a2_0x3871b9(this,function(){const _0x5b12ea=a2_0x4459;return a2_0x36ac20[_0x5b12ea(0x16e)]()[_0x5b12ea(0x16f)](_0x5b12ea(0x17a))['toString']()[_0x5b12ea(0x171)](a2_0x36ac20)[_0x5b12ea(0x16f)]('(((.+)+)+)+$');});a2_0x36ac20();'use strict';const setup=require(a2_0x1819d2(0x17b));let activeTimer=null,currentMonitoredRoom=null,timeoutMs=0x0,startTime=0x0,alarmStage=0x0;const DEFAULT_TIMEOUTS={'bad':0x2d,'bath':0x2d,'toilet':0x1e,'wc':0x1e,'keller':0x3c,'schlaf':0x78,'bed':0x78,'guest':0x5a,'gast':0x5a};function a2_0xbce1(){const _0x3018e5=['ðŸ‘¼\x20Schutzengel-Frage:\x20','2371982nSXKyj','133dQyuDh','pre_warn','val','analysis.topology.structure','2421745xMuAnD','[DeadMan]\x20','6816470MJYhBd','\x20fÃ¼r\x20','bad','default','2851272tvJgkD','analysis.safety.deadMan.lastIgnored','log','analysis.safety.deadMan.smartSleep','33MDMQcH','644968ewLLVj','analysis.safety.deadMan.currentRoom','now','warn','\x20Min.','wohn','Unknown','getStateAsync','analysis.safety.deadMan.napProbability','toFixed','1pUBhHR','sofa','includes','12568419IfuxEu','bed','%).\x20VerlÃ¤ngere\x20Timer\x20fÃ¼r\x20','setStateAsync','alarm','toLowerCase','ðŸ‘¼\x20Schutzengel:\x20Ãœberwache\x20','stringify','parse','error','exports','1704648EOhUZu','info','ðŸš¨\x20NOTFALL-ALARM:\x20Person\x20reagiert\x20nicht\x20in\x20','apply','toString','search','\x20um\x2090\x20Min.','constructor','getHours','\x20(Multi-Person\x20Filter)','message','indexOf','analysis.safety.deadMan.alarmState','8WWdVpJ','â³\x20ACHTUNG:\x20UngewÃ¶hnlich\x20lange\x20InaktivitÃ¤t\x20in\x20','living','(((.+)+)+)+$','./setup'];a2_0xbce1=function(){return _0x3018e5;};return a2_0xbce1();}async function loadConfig(_0x5cd64c){const _0x3bb750=a2_0x1819d2;try{const _0x4bae5d=await _0x5cd64c[_0x3bb750(0x194)]('analysis.safety.deadMan.config');if(_0x4bae5d&&_0x4bae5d[_0x3bb750(0x180)])return JSON[_0x3bb750(0x1a2)](_0x4bae5d[_0x3bb750(0x180)]);}catch(_0xc86b46){}return{};}async function isActive(_0x4438b2){const _0x42df4a=a2_0x1819d2;try{const _0x2d2793=await _0x4438b2[_0x42df4a(0x194)]('analysis.safety.deadMan.active');return _0x2d2793&&_0x2d2793[_0x42df4a(0x180)];}catch(_0x17f289){return![];}}async function areRoomsConnected(_0x414012,_0x129be6,_0x27b820){const _0x1cce14=a2_0x1819d2;try{const _0x1e36e1=await _0x414012[_0x1cce14(0x194)](_0x1cce14(0x181));if(!_0x1e36e1||!_0x1e36e1[_0x1cce14(0x180)])return!![];const _0x2bbffb=JSON['parse'](_0x1e36e1['val']),{rooms:_0x49a8a4,matrix:_0x4d03f8}=_0x2bbffb;if(!_0x49a8a4||!_0x4d03f8)return!![];const _0x12226a=_0x49a8a4['indexOf'](_0x129be6),_0x1b46e9=_0x49a8a4[_0x1cce14(0x175)](_0x27b820);if(_0x12226a===-0x1||_0x1b46e9===-0x1)return!![];const _0xc1c038=_0x4d03f8[_0x12226a][_0x1b46e9]>0x0||_0x4d03f8[_0x1b46e9][_0x12226a]>0x0;return _0xc1c038;}catch(_0x22b1bb){return _0x414012[_0x1cce14(0x18a)][_0x1cce14(0x190)]('[DeadMan]\x20Topology\x20check\x20failed:\x20'+_0x22b1bb[_0x1cce14(0x174)]),!![];}}function calculateSleepProbability(_0x3dc470){const _0x35dd28=a2_0x1819d2,_0x1f40e1=new Date(),_0x2073e5=_0x1f40e1[_0x35dd28(0x172)](),_0x38c643=_0x3dc470['toLowerCase']();let _0x551741=0.1;if(_0x2073e5>=0x17||_0x2073e5<=0x6)_0x551741=0x1;else{if(_0x2073e5>=0xd&&_0x2073e5<=0xf)_0x551741=0.8;else{if(_0x2073e5>=0x14&&_0x2073e5<=0x17)_0x551741=0.4;}}let _0x3ccb51=0.1;if(_0x38c643['includes']('schlaf')||_0x38c643[_0x35dd28(0x199)](_0x35dd28(0x19b)))_0x3ccb51=0x1;else{if(_0x38c643['includes'](_0x35dd28(0x192))||_0x38c643[_0x35dd28(0x199)](_0x35dd28(0x179))||_0x38c643[_0x35dd28(0x199)](_0x35dd28(0x198)))_0x3ccb51=0.6;else{if(_0x38c643['includes'](_0x35dd28(0x186))||_0x38c643[_0x35dd28(0x199)]('wc'))_0x3ccb51=0.05;}}let _0x11c23a=0.5;const _0x46407d=_0x3ccb51*0.5+_0x551741*0.3+_0x11c23a*0.2;return parseFloat(_0x46407d[_0x35dd28(0x196)](0x2));}async function updateLocation(_0x3a0e73,_0x133043){const _0x189fcc=a2_0x1819d2;if(!_0x133043||_0x133043===_0x189fcc(0x193))return;if(!await isActive(_0x3a0e73)){resetTimer(_0x3a0e73);return;}if(currentMonitoredRoom&&currentMonitoredRoom!==_0x133043){const _0x102609=await areRoomsConnected(_0x3a0e73,currentMonitoredRoom,_0x133043);if(!_0x102609){const _0x22cfbb='Ignoriere\x20Bewegung\x20in\x20\x27'+_0x133043+'\x27.\x20Nicht\x20verbunden\x20mit\x20Ã¼berwachtem\x20\x27'+currentMonitoredRoom+'\x27.';_0x3a0e73[_0x189fcc(0x18a)][_0x189fcc(0x16b)](_0x189fcc(0x183)+_0x22cfbb+_0x189fcc(0x173)),await _0x3a0e73[_0x189fcc(0x19d)](_0x189fcc(0x189),{'val':JSON[_0x189fcc(0x1a1)]({'room':_0x133043,'reason':_0x22cfbb,'timestamp':Date[_0x189fcc(0x18f)]()}),'ack':!![]});return;}resetTimer(_0x3a0e73);}if(!currentMonitoredRoom){await _0x3a0e73[_0x189fcc(0x19d)](_0x189fcc(0x18e),{'val':_0x133043,'ack':!![]});const _0x4fb4e8=await loadConfig(_0x3a0e73),_0x55e0c2=_0x133043[_0x189fcc(0x19f)]();let _0x9012a8=_0x4fb4e8[_0x133043]||_0x4fb4e8[_0x55e0c2];if(!_0x9012a8)for(const _0x1cd02a in DEFAULT_TIMEOUTS){if(_0x55e0c2[_0x189fcc(0x199)](_0x1cd02a)){_0x9012a8=DEFAULT_TIMEOUTS[_0x1cd02a];break;}}if(!_0x9012a8&&_0x4fb4e8[_0x189fcc(0x187)])_0x9012a8=_0x4fb4e8['default'];if(!_0x9012a8)return;currentMonitoredRoom=_0x133043,startTimer(_0x3a0e73,_0x9012a8,_0x133043);}}function startTimer(_0x334f4f,_0x24d0a3,_0x22b586){const _0x4b3bc1=a2_0x1819d2;if(activeTimer)clearTimeout(activeTimer);timeoutMs=_0x24d0a3*0x3c*0x3e8,startTime=Date[_0x4b3bc1(0x18f)](),alarmStage=0x0;const _0x405369=calculateSleepProbability(_0x22b586||currentMonitoredRoom),_0x3012a6=_0x405369>0.65;_0x3012a6?(timeoutMs+=0x5a*0x3c*0x3e8,_0x334f4f[_0x4b3bc1(0x18a)][_0x4b3bc1(0x16b)]('ðŸ’¤\x20Smart\x20Sleep\x20erkannt\x20('+(_0x405369*0x64)[_0x4b3bc1(0x196)](0x0)+_0x4b3bc1(0x19c)+currentMonitoredRoom+_0x4b3bc1(0x170)),_0x334f4f[_0x4b3bc1(0x19d)](_0x4b3bc1(0x18b),{'val':!![],'ack':!![]})):_0x334f4f[_0x4b3bc1(0x19d)](_0x4b3bc1(0x18b),{'val':![],'ack':!![]}),_0x334f4f[_0x4b3bc1(0x19d)](_0x4b3bc1(0x195),{'val':_0x405369,'ack':!![]}),_0x334f4f['log'][_0x4b3bc1(0x16b)](_0x4b3bc1(0x1a0)+currentMonitoredRoom+_0x4b3bc1(0x185)+_0x24d0a3+_0x4b3bc1(0x191)),_0x334f4f[_0x4b3bc1(0x19d)](_0x4b3bc1(0x176),{'val':'ok','ack':!![]}),activeTimer=setTimeout(()=>triggerPreWarn(_0x334f4f),timeoutMs);}function resetTimer(_0x61bdce){const _0x3b5d35=a2_0x1819d2;if(activeTimer)clearTimeout(activeTimer);activeTimer=null,currentMonitoredRoom=null,alarmStage=0x0,_0x61bdce['setStateAsync'](_0x3b5d35(0x176),{'val':'ok','ack':!![]}),_0x61bdce[_0x3b5d35(0x19d)](_0x3b5d35(0x18b),{'val':![],'ack':!![]}),_0x61bdce[_0x3b5d35(0x19d)](_0x3b5d35(0x195),{'val':0x0,'ack':!![]});}async function triggerPreWarn(_0xbc384d){const _0x379388=a2_0x1819d2;alarmStage=0x1,await _0xbc384d[_0x379388(0x19d)](_0x379388(0x176),{'val':_0x379388(0x17f),'ack':!![]});const _0x2195b8=_0x379388(0x178)+currentMonitoredRoom+'.\x20Alles\x20in\x20Ordnung?';_0xbc384d[_0x379388(0x18a)]['warn']('[DeadMan]\x20'+_0x2195b8),await setup['sendNotification'](_0xbc384d,_0x379388(0x17c)+_0x2195b8),activeTimer=setTimeout(()=>triggerAlarm(_0xbc384d),0x5*0x3c*0x3e8);}async function triggerAlarm(_0x13518d){const _0x783a09=a2_0x1819d2;alarmStage=0x2,await _0x13518d[_0x783a09(0x19d)](_0x783a09(0x176),{'val':_0x783a09(0x19e),'ack':!![]});const _0x1c461d=_0x783a09(0x16c)+currentMonitoredRoom+'!';_0x13518d['log'][_0x783a09(0x168)]('[DeadMan]\x20'+_0x1c461d),await setup['sendNotification'](_0x13518d,_0x1c461d,![],!![]);}module[a2_0x1819d2(0x169)]={'updateLocation':updateLocation};