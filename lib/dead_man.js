const a2_0x5bb639=a2_0x2d8e;(function(_0x3e6412,_0x5643e5){const _0x398426=a2_0x2d8e,_0x58fd06=_0x3e6412();while(!![]){try{const _0x57f872=-parseInt(_0x398426(0x1cc))/0x1+-parseInt(_0x398426(0x1d5))/0x2*(parseInt(_0x398426(0x1ba))/0x3)+-parseInt(_0x398426(0x1ae))/0x4+parseInt(_0x398426(0x1c3))/0x5+parseInt(_0x398426(0x1e1))/0x6+-parseInt(_0x398426(0x1dd))/0x7+-parseInt(_0x398426(0x1df))/0x8*(-parseInt(_0x398426(0x1ca))/0x9);if(_0x57f872===_0x5643e5)break;else _0x58fd06['push'](_0x58fd06['shift']());}catch(_0x1fa084){_0x58fd06['push'](_0x58fd06['shift']());}}}(a2_0x17af,0x8ae25));const a2_0xe31cf3=(function(){let _0x5e895b=!![];return function(_0x21e612,_0x1e1be3){const _0x309c48=_0x5e895b?function(){const _0xf630a1=a2_0x2d8e;if(_0x1e1be3){const _0x32b812=_0x1e1be3[_0xf630a1(0x1d8)](_0x21e612,arguments);return _0x1e1be3=null,_0x32b812;}}:function(){};return _0x5e895b=![],_0x309c48;};}()),a2_0x1f7bfa=a2_0xe31cf3(this,function(){const _0x380c9a=a2_0x2d8e;return a2_0x1f7bfa[_0x380c9a(0x1b4)]()[_0x380c9a(0x1c9)](_0x380c9a(0x1bc))[_0x380c9a(0x1b4)]()[_0x380c9a(0x1e0)](a2_0x1f7bfa)['search']('(((.+)+)+)+$');});a2_0x1f7bfa();'use strict';const setup=require(a2_0x5bb639(0x1be));let activeTimer=null,currentMonitoredRoom=null,timeoutMs=0x0,startTime=0x0,alarmStage=0x0;function a2_0x17af(){const _0xa23c31=['pre_warn','val','[DeadMan]\x20Topology\x20check\x20failed:\x20','log','now','toString','sofa','.\x20Alles\x20in\x20Ordnung?','sendNotification','Ignoriere\x20Bewegung\x20in\x20\x27','Unknown','172365qXOWoI','ðŸ‘¼\x20Schutzengel-Frage:\x20','(((.+)+)+)+$','indexOf','./setup','\x20um\x2090\x20Min.','[DeadMan]\x20','alarm','parse','4398600ckAygr','getHours','\x20(Multi-Person\x20Filter)','warn','analysis.safety.deadMan.alarmState','includes','search','15241302NjdKzo','analysis.safety.deadMan.currentRoom','837081bljkey','getStateAsync','%).\x20VerlÃ¤ngere\x20Timer\x20fÃ¼r\x20','analysis.safety.deadMan.smartSleep','\x20fÃ¼r\x20','exports','ðŸ’¤\x20Smart\x20Sleep\x20erkannt\x20(','\x27.\x20Nicht\x20verbunden\x20mit\x20Ã¼berwachtem\x20\x27','analysis.safety.deadMan.napProbability','32YyNhuT','info','toLowerCase','apply','default','setStateAsync','living','analysis.safety.deadMan.config','3616200dkoGcb','bad','8wLpCZq','constructor','3595590aslsSw','bed','toFixed','â³\x20ACHTUNG:\x20UngewÃ¶hnlich\x20lange\x20InaktivitÃ¤t\x20in\x20','analysis.safety.deadMan.lastIgnored','1322532QApudL'];a2_0x17af=function(){return _0xa23c31;};return a2_0x17af();}const DEFAULT_TIMEOUTS={'bad':0x2d,'bath':0x2d,'toilet':0x1e,'wc':0x1e,'keller':0x3c,'schlaf':0x78,'bed':0x78,'guest':0x5a,'gast':0x5a};async function loadConfig(_0x1569de){const _0x3ace89=a2_0x5bb639;try{const _0x422b8c=await _0x1569de[_0x3ace89(0x1cd)](_0x3ace89(0x1dc));if(_0x422b8c&&_0x422b8c[_0x3ace89(0x1b0)])return JSON['parse'](_0x422b8c[_0x3ace89(0x1b0)]);}catch(_0x515190){}return{};}function a2_0x2d8e(_0x4d86a7,_0x3dee40){const _0x59aa66=a2_0x17af();return a2_0x2d8e=function(_0x1f7bfa,_0xe31cf3){_0x1f7bfa=_0x1f7bfa-0x1ad;let _0x17af9b=_0x59aa66[_0x1f7bfa];return _0x17af9b;},a2_0x2d8e(_0x4d86a7,_0x3dee40);}async function isActive(_0x32bd6b){const _0x4f3313=a2_0x5bb639;try{const _0x3883a9=await _0x32bd6b[_0x4f3313(0x1cd)]('analysis.safety.deadMan.active');return _0x3883a9&&_0x3883a9['val'];}catch(_0x452eaf){return![];}}async function areRoomsConnected(_0x268396,_0x358750,_0x45de77){const _0x1411e6=a2_0x5bb639;try{const _0x493912=await _0x268396[_0x1411e6(0x1cd)]('analysis.topology.structure');if(!_0x493912||!_0x493912[_0x1411e6(0x1b0)])return!![];const _0x3ef732=JSON[_0x1411e6(0x1c2)](_0x493912[_0x1411e6(0x1b0)]),{rooms:_0x4c8a99,matrix:_0x49ae39}=_0x3ef732;if(!_0x4c8a99||!_0x49ae39)return!![];const _0xe18617=_0x4c8a99['indexOf'](_0x358750),_0x32f89e=_0x4c8a99[_0x1411e6(0x1bd)](_0x45de77);if(_0xe18617===-0x1||_0x32f89e===-0x1)return!![];const _0x1307fe=_0x49ae39[_0xe18617][_0x32f89e]>0x0||_0x49ae39[_0x32f89e][_0xe18617]>0x0;return _0x1307fe;}catch(_0x508954){return _0x268396[_0x1411e6(0x1b2)][_0x1411e6(0x1c6)](_0x1411e6(0x1b1)+_0x508954['message']),!![];}}function calculateSleepProbability(_0x5b49e0){const _0x29183a=a2_0x5bb639,_0x3c6a08=new Date(),_0x45ac6f=_0x3c6a08[_0x29183a(0x1c4)](),_0x1a12ae=_0x5b49e0[_0x29183a(0x1d7)]();let _0x1e80e9=0.1;if(_0x45ac6f>=0x17||_0x45ac6f<=0x6)_0x1e80e9=0x1;else{if(_0x45ac6f>=0xd&&_0x45ac6f<=0xf)_0x1e80e9=0.8;else{if(_0x45ac6f>=0x14&&_0x45ac6f<=0x17)_0x1e80e9=0.4;}}let _0x5b2c54=0.1;if(_0x1a12ae[_0x29183a(0x1c8)]('schlaf')||_0x1a12ae['includes'](_0x29183a(0x1e2)))_0x5b2c54=0x1;else{if(_0x1a12ae[_0x29183a(0x1c8)]('wohn')||_0x1a12ae[_0x29183a(0x1c8)](_0x29183a(0x1db))||_0x1a12ae[_0x29183a(0x1c8)](_0x29183a(0x1b5)))_0x5b2c54=0.6;else{if(_0x1a12ae[_0x29183a(0x1c8)](_0x29183a(0x1de))||_0x1a12ae[_0x29183a(0x1c8)]('wc'))_0x5b2c54=0.05;}}let _0x11c9ed=0.5;const _0x10b221=_0x5b2c54*0.5+_0x1e80e9*0.3+_0x11c9ed*0.2;return parseFloat(_0x10b221[_0x29183a(0x1e3)](0x2));}async function updateLocation(_0x437f4e,_0x37ef25){const _0x243f1d=a2_0x5bb639;if(!_0x37ef25||_0x37ef25===_0x243f1d(0x1b9))return;if(!await isActive(_0x437f4e)){resetTimer(_0x437f4e);return;}if(currentMonitoredRoom&&currentMonitoredRoom!==_0x37ef25){const _0x274cd0=await areRoomsConnected(_0x437f4e,currentMonitoredRoom,_0x37ef25);if(!_0x274cd0){const _0x3938ad=_0x243f1d(0x1b8)+_0x37ef25+_0x243f1d(0x1d3)+currentMonitoredRoom+'\x27.';_0x437f4e[_0x243f1d(0x1b2)][_0x243f1d(0x1d6)](_0x243f1d(0x1c0)+_0x3938ad+_0x243f1d(0x1c5)),await _0x437f4e[_0x243f1d(0x1da)](_0x243f1d(0x1ad),{'val':JSON['stringify']({'room':_0x37ef25,'reason':_0x3938ad,'timestamp':Date[_0x243f1d(0x1b3)]()}),'ack':!![]});return;}resetTimer(_0x437f4e);}if(!currentMonitoredRoom){await _0x437f4e[_0x243f1d(0x1da)](_0x243f1d(0x1cb),{'val':_0x37ef25,'ack':!![]});const _0x54c6d0=await loadConfig(_0x437f4e),_0x5c15b9=_0x37ef25[_0x243f1d(0x1d7)]();let _0x3a0981=_0x54c6d0[_0x37ef25]||_0x54c6d0[_0x5c15b9];if(!_0x3a0981)for(const _0x4aeb00 in DEFAULT_TIMEOUTS){if(_0x5c15b9[_0x243f1d(0x1c8)](_0x4aeb00)){_0x3a0981=DEFAULT_TIMEOUTS[_0x4aeb00];break;}}if(!_0x3a0981&&_0x54c6d0['default'])_0x3a0981=_0x54c6d0[_0x243f1d(0x1d9)];if(!_0x3a0981)return;currentMonitoredRoom=_0x37ef25,startTimer(_0x437f4e,_0x3a0981,_0x37ef25);}}function startTimer(_0x524f88,_0x4eb3a4,_0x411631){const _0x475da8=a2_0x5bb639;if(activeTimer)clearTimeout(activeTimer);timeoutMs=_0x4eb3a4*0x3c*0x3e8,startTime=Date[_0x475da8(0x1b3)](),alarmStage=0x0;const _0x1c8b85=calculateSleepProbability(_0x411631||currentMonitoredRoom),_0x13e46a=_0x1c8b85>0.65;_0x13e46a?(timeoutMs+=0x5a*0x3c*0x3e8,_0x524f88[_0x475da8(0x1b2)][_0x475da8(0x1d6)](_0x475da8(0x1d2)+(_0x1c8b85*0x64)[_0x475da8(0x1e3)](0x0)+_0x475da8(0x1ce)+currentMonitoredRoom+_0x475da8(0x1bf)),_0x524f88[_0x475da8(0x1da)](_0x475da8(0x1cf),{'val':!![],'ack':!![]})):_0x524f88[_0x475da8(0x1da)](_0x475da8(0x1cf),{'val':![],'ack':!![]}),_0x524f88[_0x475da8(0x1da)](_0x475da8(0x1d4),{'val':_0x1c8b85,'ack':!![]}),_0x524f88[_0x475da8(0x1b2)][_0x475da8(0x1d6)]('ðŸ‘¼\x20Schutzengel:\x20Ãœberwache\x20'+currentMonitoredRoom+_0x475da8(0x1d0)+_0x4eb3a4+'\x20Min.'),_0x524f88[_0x475da8(0x1da)](_0x475da8(0x1c7),{'val':'ok','ack':!![]}),activeTimer=setTimeout(()=>triggerPreWarn(_0x524f88),timeoutMs);}function resetTimer(_0xe70ffd){const _0x448496=a2_0x5bb639;if(activeTimer)clearTimeout(activeTimer);activeTimer=null,currentMonitoredRoom=null,alarmStage=0x0,_0xe70ffd[_0x448496(0x1da)](_0x448496(0x1c7),{'val':'ok','ack':!![]}),_0xe70ffd[_0x448496(0x1da)](_0x448496(0x1cf),{'val':![],'ack':!![]}),_0xe70ffd['setStateAsync'](_0x448496(0x1d4),{'val':0x0,'ack':!![]});}async function triggerPreWarn(_0x31d657){const _0x3bdf07=a2_0x5bb639;alarmStage=0x1,await _0x31d657[_0x3bdf07(0x1da)]('analysis.safety.deadMan.alarmState',{'val':_0x3bdf07(0x1af),'ack':!![]});const _0x29e6c8=_0x3bdf07(0x1e4)+currentMonitoredRoom+_0x3bdf07(0x1b6);_0x31d657[_0x3bdf07(0x1b2)]['warn'](_0x3bdf07(0x1c0)+_0x29e6c8),await setup[_0x3bdf07(0x1b7)](_0x31d657,_0x3bdf07(0x1bb)+_0x29e6c8),activeTimer=setTimeout(()=>triggerAlarm(_0x31d657),0x5*0x3c*0x3e8);}async function triggerAlarm(_0x5be615){const _0x2b52d5=a2_0x5bb639;alarmStage=0x2,await _0x5be615[_0x2b52d5(0x1da)](_0x2b52d5(0x1c7),{'val':_0x2b52d5(0x1c1),'ack':!![]});const _0x371120='ðŸš¨\x20NOTFALL-ALARM:\x20Person\x20reagiert\x20nicht\x20in\x20'+currentMonitoredRoom+'!';_0x5be615['log']['error'](_0x2b52d5(0x1c0)+_0x371120),await setup[_0x2b52d5(0x1b7)](_0x5be615,_0x371120,![],!![]);}module[a2_0x5bb639(0x1d1)]={'updateLocation':updateLocation};