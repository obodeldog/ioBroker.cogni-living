const a2_0x485f32=a2_0xf433;(function(_0x3ce26b,_0x3392ee){const _0x1a9281=a2_0xf433,_0x560b0e=_0x3ce26b();while(!![]){try{const _0xf5b423=-parseInt(_0x1a9281(0x1b9))/0x1*(-parseInt(_0x1a9281(0x1b6))/0x2)+parseInt(_0x1a9281(0x1af))/0x3+-parseInt(_0x1a9281(0x1b0))/0x4*(parseInt(_0x1a9281(0x1a6))/0x5)+parseInt(_0x1a9281(0x1a8))/0x6+-parseInt(_0x1a9281(0x1bf))/0x7*(-parseInt(_0x1a9281(0x1c3))/0x8)+parseInt(_0x1a9281(0x1c1))/0x9+-parseInt(_0x1a9281(0x1b4))/0xa;if(_0xf5b423===_0x3392ee)break;else _0x560b0e['push'](_0x560b0e['shift']());}catch(_0x54c0d3){_0x560b0e['push'](_0x560b0e['shift']());}}}(a2_0x16e1,0x4fd53));const a2_0x43fe3f=(function(){let _0x2a62b1=!![];return function(_0x3d818a,_0x54879d){const _0x3e3a3b=_0x2a62b1?function(){if(_0x54879d){const _0x1f9c42=_0x54879d['apply'](_0x3d818a,arguments);return _0x54879d=null,_0x1f9c42;}}:function(){};return _0x2a62b1=![],_0x3e3a3b;};}()),a2_0x18795a=a2_0x43fe3f(this,function(){const _0x330ce0=a2_0xf433;return a2_0x18795a[_0x330ce0(0x1ad)]()[_0x330ce0(0x1b7)](_0x330ce0(0x1aa))[_0x330ce0(0x1ad)]()['constructor'](a2_0x18795a)[_0x330ce0(0x1b7)](_0x330ce0(0x1aa));});a2_0x18795a();'use strict';function a2_0x16e1(){const _0x153c82=['.\x20Alles\x20in\x20Ordnung?','[DeadMan]\x20','analysis.safety.deadMan.config','\x27.\x20Nicht\x20verbunden\x20mit\x20Ã¼berwachtem\x20\x27','stringify','info','analysis.topology.structure','[DeadMan]\x20Topology\x20check\x20failed:\x20','ðŸš¨\x20NOTFALL-ALARM:\x20Person\x20reagiert\x20nicht\x20in\x20','now','indexOf','\x20Min.','ðŸ‘¼\x20Schutzengel-Frage:\x20','toLowerCase','756895kwFeMz','parse','2962410fNXbpA','\x20(Multi-Person\x20Filter)','(((.+)+)+)+$','message','exports','toString','\x20fÃ¼r\x20','476673DUHsuV','4byNJuI','sendNotification','setStateAsync','includes','15960500wjZiEx','analysis.safety.deadMan.lastIgnored','86QQIiLX','search','analysis.safety.deadMan.currentRoom','15079ZSseVo','Ignoriere\x20Bewegung\x20in\x20\x27','val','./setup','log','analysis.safety.deadMan.alarmState','3429447eqDQNt','â³\x20ACHTUNG:\x20UngewÃ¶hnlich\x20lange\x20InaktivitÃ¤t\x20in\x20','2551320xCvscj','pre_warn','8jaNZYd','warn','getStateAsync'];a2_0x16e1=function(){return _0x153c82;};return a2_0x16e1();}const setup=require(a2_0x485f32(0x1bc));let activeTimer=null,currentMonitoredRoom=null,timeoutMs=0x0,startTime=0x0,alarmStage=0x0;const DEFAULT_TIMEOUTS={'bad':0x2d,'bath':0x2d,'toilet':0x1e,'wc':0x1e,'keller':0x3c};async function loadConfig(_0x3ed6a0){const _0x450a8a=a2_0x485f32;try{const _0x5d296c=await _0x3ed6a0['getStateAsync'](_0x450a8a(0x19a));if(_0x5d296c&&_0x5d296c[_0x450a8a(0x1bb)])return JSON[_0x450a8a(0x1a7)](_0x5d296c['val']);}catch(_0x38bfb1){}return{};}async function isActive(_0x156499){const _0x217ab6=a2_0x485f32;try{const _0x29fdd8=await _0x156499[_0x217ab6(0x197)]('analysis.safety.deadMan.active');return _0x29fdd8&&_0x29fdd8['val'];}catch(_0x3fec6b){return![];}}async function areRoomsConnected(_0x214868,_0x39b2b3,_0x4f3b8a){const _0x59edf7=a2_0x485f32;try{const _0x2527ea=await _0x214868['getStateAsync'](_0x59edf7(0x19e));if(!_0x2527ea||!_0x2527ea[_0x59edf7(0x1bb)])return!![];const _0x2cc8a6=JSON[_0x59edf7(0x1a7)](_0x2527ea[_0x59edf7(0x1bb)]),{rooms:_0x3acbc3,matrix:_0x53a98b}=_0x2cc8a6;if(!_0x3acbc3||!_0x53a98b)return!![];const _0x25b821=_0x3acbc3[_0x59edf7(0x1a2)](_0x39b2b3),_0x28608f=_0x3acbc3[_0x59edf7(0x1a2)](_0x4f3b8a);if(_0x25b821===-0x1||_0x28608f===-0x1)return!![];const _0x34b86b=_0x53a98b[_0x25b821][_0x28608f]>0x0||_0x53a98b[_0x28608f][_0x25b821]>0x0;return _0x34b86b;}catch(_0x3f2ad6){return _0x214868[_0x59edf7(0x1bd)][_0x59edf7(0x196)](_0x59edf7(0x19f)+_0x3f2ad6[_0x59edf7(0x1ab)]),!![];}}async function updateLocation(_0x1542cc,_0xa003d7){const _0x554411=a2_0x485f32;if(!_0xa003d7||_0xa003d7==='Unknown')return;if(!await isActive(_0x1542cc)){resetTimer(_0x1542cc);return;}if(currentMonitoredRoom&&currentMonitoredRoom!==_0xa003d7){const _0xe49bb6=await areRoomsConnected(_0x1542cc,currentMonitoredRoom,_0xa003d7);if(!_0xe49bb6){const _0x325c14=_0x554411(0x1ba)+_0xa003d7+_0x554411(0x19b)+currentMonitoredRoom+'\x27.';_0x1542cc[_0x554411(0x1bd)][_0x554411(0x19d)](_0x554411(0x199)+_0x325c14+_0x554411(0x1a9)),await _0x1542cc[_0x554411(0x1b2)](_0x554411(0x1b5),{'val':JSON[_0x554411(0x19c)]({'room':_0xa003d7,'reason':_0x325c14,'timestamp':Date[_0x554411(0x1a1)]()}),'ack':!![]});return;}resetTimer(_0x1542cc);}if(!currentMonitoredRoom){await _0x1542cc[_0x554411(0x1b2)](_0x554411(0x1b8),{'val':_0xa003d7,'ack':!![]});const _0x3ef3ff=await loadConfig(_0x1542cc),_0x4a1446=_0xa003d7[_0x554411(0x1a5)]();let _0x1c64d4=_0x3ef3ff[_0xa003d7]||_0x3ef3ff[_0x4a1446];if(!_0x1c64d4)for(const _0x44625e in DEFAULT_TIMEOUTS){if(_0x4a1446[_0x554411(0x1b3)](_0x44625e)){_0x1c64d4=DEFAULT_TIMEOUTS[_0x44625e];break;}}if(!_0x1c64d4&&_0x3ef3ff['default'])_0x1c64d4=_0x3ef3ff['default'];if(!_0x1c64d4)return;currentMonitoredRoom=_0xa003d7,startTimer(_0x1542cc,_0x1c64d4);}}function startTimer(_0x734267,_0xb72786){const _0x1622ef=a2_0x485f32;if(activeTimer)clearTimeout(activeTimer);timeoutMs=_0xb72786*0x3c*0x3e8,startTime=Date[_0x1622ef(0x1a1)](),alarmStage=0x0,_0x734267[_0x1622ef(0x1bd)]['info']('ðŸ‘¼\x20Schutzengel:\x20Ãœberwache\x20'+currentMonitoredRoom+_0x1622ef(0x1ae)+_0xb72786+_0x1622ef(0x1a3)),_0x734267[_0x1622ef(0x1b2)]('analysis.safety.deadMan.alarmState',{'val':'ok','ack':!![]}),activeTimer=setTimeout(()=>triggerPreWarn(_0x734267),timeoutMs);}function resetTimer(_0x34adba){const _0x42a13b=a2_0x485f32;if(activeTimer)clearTimeout(activeTimer);activeTimer=null,currentMonitoredRoom=null,alarmStage=0x0,_0x34adba['setStateAsync'](_0x42a13b(0x1be),{'val':'ok','ack':!![]});}async function triggerPreWarn(_0x4c93d8){const _0x49db36=a2_0x485f32;alarmStage=0x1,await _0x4c93d8[_0x49db36(0x1b2)](_0x49db36(0x1be),{'val':_0x49db36(0x1c2),'ack':!![]});const _0x183085=_0x49db36(0x1c0)+currentMonitoredRoom+_0x49db36(0x198);_0x4c93d8[_0x49db36(0x1bd)][_0x49db36(0x196)]('[DeadMan]\x20'+_0x183085),await setup[_0x49db36(0x1b1)](_0x4c93d8,_0x49db36(0x1a4)+_0x183085),activeTimer=setTimeout(()=>triggerAlarm(_0x4c93d8),0x5*0x3c*0x3e8);}function a2_0xf433(_0x5e08d9,_0x4aa432){const _0x10f533=a2_0x16e1();return a2_0xf433=function(_0x18795a,_0x43fe3f){_0x18795a=_0x18795a-0x196;let _0x16e1cc=_0x10f533[_0x18795a];return _0x16e1cc;},a2_0xf433(_0x5e08d9,_0x4aa432);}async function triggerAlarm(_0x18ee02){const _0x3b463e=a2_0x485f32;alarmStage=0x2,await _0x18ee02['setStateAsync'](_0x3b463e(0x1be),{'val':'alarm','ack':!![]});const _0x15dc5a=_0x3b463e(0x1a0)+currentMonitoredRoom+'!';_0x18ee02['log']['error'](_0x3b463e(0x199)+_0x15dc5a),await setup[_0x3b463e(0x1b1)](_0x18ee02,_0x15dc5a,![],!![]);}module[a2_0x485f32(0x1ac)]={'updateLocation':updateLocation};