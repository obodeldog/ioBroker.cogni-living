const a2_0x342af0=a2_0x18f3;(function(_0x107ef1,_0x1080a2){const _0xcb3896=a2_0x18f3,_0x1d877a=_0x107ef1();while(!![]){try{const _0x28c2e3=parseInt(_0xcb3896(0x13d))/0x1+parseInt(_0xcb3896(0x121))/0x2*(parseInt(_0xcb3896(0x12d))/0x3)+-parseInt(_0xcb3896(0x134))/0x4*(-parseInt(_0xcb3896(0x10a))/0x5)+parseInt(_0xcb3896(0x109))/0x6+-parseInt(_0xcb3896(0x139))/0x7+-parseInt(_0xcb3896(0x112))/0x8+-parseInt(_0xcb3896(0x132))/0x9*(-parseInt(_0xcb3896(0x114))/0xa);if(_0x28c2e3===_0x1080a2)break;else _0x1d877a['push'](_0x1d877a['shift']());}catch(_0x1a0a96){_0x1d877a['push'](_0x1d877a['shift']());}}}(a2_0x5d81,0x827af));const a2_0x4def28=(function(){let _0x4170d5=!![];return function(_0x3e552a,_0x24f844){const _0x40c231=_0x4170d5?function(){const _0x4b5728=a2_0x18f3;if(_0x24f844){const _0x2867f2=_0x24f844[_0x4b5728(0x10c)](_0x3e552a,arguments);return _0x24f844=null,_0x2867f2;}}:function(){};return _0x4170d5=![],_0x40c231;};}()),a2_0x4de90c=a2_0x4def28(this,function(){const _0x597e84=a2_0x18f3;return a2_0x4de90c[_0x597e84(0x111)]()[_0x597e84(0x10e)]('(((.+)+)+)+$')['toString']()[_0x597e84(0x11c)](a2_0x4de90c)['search'](_0x597e84(0x125));});a2_0x4de90c();'use strict';const setup=require(a2_0x342af0(0x122));let activeTimer=null,currentMonitoredRoom=null,timeoutMs=0x0,startTime=0x0,alarmStage=0x0;const DEFAULT_TIMEOUTS={'bad':0x2d,'bath':0x2d,'toilet':0x1e,'wc':0x1e,'keller':0x3c,'schlaf':0x78,'bed':0x78,'guest':0x5a,'gast':0x5a};function getTimeoutRobust(_0x4c5f3a,_0x406eab){const _0x833c65=a2_0x342af0;if(!_0x4c5f3a||!_0x406eab)return undefined;if(_0x4c5f3a[_0x406eab])return _0x4c5f3a[_0x406eab];const _0xd00b71=_0x406eab['toLowerCase']()[_0x833c65(0x13c)](/[^a-z0-9]/g,'');for(const _0x5bafc0 in _0x4c5f3a){const _0x161d07=_0x5bafc0[_0x833c65(0x10d)]()[_0x833c65(0x13c)](/[^a-z0-9]/g,'');if(_0x161d07===_0xd00b71)return _0x4c5f3a[_0x5bafc0];}const _0x1edcc1=_0x406eab[_0x833c65(0x10d)]();if(_0x4c5f3a[_0x1edcc1])return _0x4c5f3a[_0x1edcc1];return undefined;}async function loadConfig(_0x59d9cb){const _0x35508c=a2_0x342af0;try{const _0x5f5b7e=await _0x59d9cb['getStateAsync']('analysis.safety.deadMan.config');if(_0x5f5b7e&&_0x5f5b7e[_0x35508c(0x120)])return JSON[_0x35508c(0x11b)](_0x5f5b7e[_0x35508c(0x120)]);}catch(_0x9b3b75){}return{};}async function isActive(_0x11194a){const _0x511386=a2_0x342af0;try{const _0x463810=await _0x11194a[_0x511386(0x107)](_0x511386(0x138));return _0x463810&&_0x463810[_0x511386(0x120)];}catch(_0x389111){return![];}}async function areRoomsConnected(_0x1c2b61,_0x31184d,_0x178156){const _0x1faddf=a2_0x342af0;try{const _0x2632c6=await _0x1c2b61[_0x1faddf(0x107)](_0x1faddf(0x110));if(!_0x2632c6||!_0x2632c6[_0x1faddf(0x120)])return!![];const _0x19a9e1=JSON[_0x1faddf(0x11b)](_0x2632c6[_0x1faddf(0x120)]),{rooms:_0x2f4d9b,matrix:_0x2c5de1}=_0x19a9e1;if(!_0x2f4d9b||!_0x2c5de1)return!![];const _0x4156ad=_0x2f4d9b[_0x1faddf(0x11e)](_0x31184d),_0x47f502=_0x2f4d9b[_0x1faddf(0x11e)](_0x178156);if(_0x4156ad===-0x1||_0x47f502===-0x1)return!![];const _0x24aceb=_0x2c5de1[_0x4156ad][_0x47f502]>0x0||_0x2c5de1[_0x47f502][_0x4156ad]>0x0;return _0x24aceb;}catch(_0x277289){return _0x1c2b61['log'][_0x1faddf(0x126)](_0x1faddf(0x12b)+_0x277289[_0x1faddf(0x133)]),!![];}}function calculateSleepProbability(_0x154a88){const _0x4c9336=a2_0x342af0,_0x560382=new Date(),_0x2577bd=_0x560382['getHours'](),_0x32405b=_0x154a88['toLowerCase']();let _0x412d0b=0.1;if(_0x2577bd>=0x17||_0x2577bd<=0x6)_0x412d0b=0x1;else{if(_0x2577bd>=0xd&&_0x2577bd<=0xf)_0x412d0b=0.8;else{if(_0x2577bd>=0x14&&_0x2577bd<=0x17)_0x412d0b=0.4;}}let _0x2c55be=0.1;if(_0x32405b[_0x4c9336(0x11a)](_0x4c9336(0x128))||_0x32405b[_0x4c9336(0x11a)]('bed'))_0x2c55be=0x1;else{if(_0x32405b[_0x4c9336(0x11a)](_0x4c9336(0x12f))||_0x32405b[_0x4c9336(0x11a)](_0x4c9336(0x136))||_0x32405b['includes'](_0x4c9336(0x12e)))_0x2c55be=0.6;else{if(_0x32405b[_0x4c9336(0x11a)]('bad')||_0x32405b[_0x4c9336(0x11a)]('wc'))_0x2c55be=0.05;}}let _0x3ab84c=0.5;const _0x3e6d2d=_0x2c55be*0.5+_0x412d0b*0.3+_0x3ab84c*0.2;return parseFloat(_0x3e6d2d[_0x4c9336(0x129)](0x2));}async function updateLocation(_0xe3739,_0x1b668d){const _0x28bcc3=a2_0x342af0;if(!_0x1b668d||_0x1b668d===_0x28bcc3(0x105))return;if(!await isActive(_0xe3739)){resetTimer(_0xe3739);return;}if(currentMonitoredRoom&&currentMonitoredRoom!==_0x1b668d){const _0x8aea6f=await areRoomsConnected(_0xe3739,currentMonitoredRoom,_0x1b668d);if(!_0x8aea6f){const _0x5c325d='Ignoriere\x20Bewegung\x20in\x20\x27'+_0x1b668d+_0x28bcc3(0x10f)+currentMonitoredRoom+'\x27.';_0xe3739[_0x28bcc3(0x131)][_0x28bcc3(0x13a)](_0x28bcc3(0x135)+_0x5c325d+_0x28bcc3(0x118)),await _0xe3739[_0x28bcc3(0x116)]('analysis.safety.deadMan.lastIgnored',{'val':JSON['stringify']({'room':_0x1b668d,'reason':_0x5c325d,'timestamp':Date[_0x28bcc3(0x11d)]()}),'ack':!![]});return;}resetTimer(_0xe3739);}if(!currentMonitoredRoom){await _0xe3739[_0x28bcc3(0x116)](_0x28bcc3(0x137),{'val':_0x1b668d,'ack':!![]});const _0x2b9a38=await loadConfig(_0xe3739);let _0x4d49fe=getTimeoutRobust(_0x2b9a38,_0x1b668d);const _0x11f124=_0x1b668d[_0x28bcc3(0x10d)]();if(!_0x4d49fe)for(const _0xc295f9 in DEFAULT_TIMEOUTS){if(_0x11f124['includes'](_0xc295f9)){_0x4d49fe=DEFAULT_TIMEOUTS[_0xc295f9];break;}}if(!_0x4d49fe&&_0x2b9a38[_0x28bcc3(0x12c)])_0x4d49fe=_0x2b9a38[_0x28bcc3(0x12c)];if(!_0x4d49fe)return;currentMonitoredRoom=_0x1b668d,startTimer(_0xe3739,_0x4d49fe,_0x1b668d);}}function startTimer(_0x4a1c6e,_0x54b9e8,_0x3cab42){const _0x2f3159=a2_0x342af0;if(activeTimer)clearTimeout(activeTimer);timeoutMs=_0x54b9e8*0x3c*0x3e8,startTime=Date[_0x2f3159(0x11d)](),alarmStage=0x0;const _0x2adcfb=calculateSleepProbability(_0x3cab42||currentMonitoredRoom),_0x5ad4e0=_0x2adcfb>0.65;_0x5ad4e0?(timeoutMs+=0x5a*0x3c*0x3e8,_0x4a1c6e[_0x2f3159(0x131)][_0x2f3159(0x13a)](_0x2f3159(0x106)+(_0x2adcfb*0x64)[_0x2f3159(0x129)](0x0)+'%).\x20Verl√§ngere\x20Timer\x20f√ºr\x20'+currentMonitoredRoom+_0x2f3159(0x119)),_0x4a1c6e[_0x2f3159(0x116)]('analysis.safety.deadMan.smartSleep',{'val':!![],'ack':!![]})):_0x4a1c6e[_0x2f3159(0x116)](_0x2f3159(0x13e),{'val':![],'ack':!![]}),_0x4a1c6e[_0x2f3159(0x116)](_0x2f3159(0x127),{'val':_0x2adcfb,'ack':!![]}),_0x4a1c6e[_0x2f3159(0x131)][_0x2f3159(0x13a)](_0x2f3159(0x113)+currentMonitoredRoom+_0x2f3159(0x115)+_0x54b9e8+_0x2f3159(0x12a)),_0x4a1c6e['setStateAsync'](_0x2f3159(0x10b),{'val':'ok','ack':!![]}),activeTimer=setTimeout(()=>triggerPreWarn(_0x4a1c6e),timeoutMs);}function resetTimer(_0x49d118){const _0x44755d=a2_0x342af0;if(activeTimer)clearTimeout(activeTimer);activeTimer=null,currentMonitoredRoom=null,alarmStage=0x0,_0x49d118['setStateAsync'](_0x44755d(0x10b),{'val':'ok','ack':!![]}),_0x49d118[_0x44755d(0x116)]('analysis.safety.deadMan.smartSleep',{'val':![],'ack':!![]}),_0x49d118[_0x44755d(0x116)](_0x44755d(0x127),{'val':0x0,'ack':!![]});}async function triggerPreWarn(_0x289cac){const _0x19716c=a2_0x342af0;alarmStage=0x1,await _0x289cac['setStateAsync'](_0x19716c(0x10b),{'val':'pre_warn','ack':!![]});const _0x34b944=_0x19716c(0x108)+currentMonitoredRoom+_0x19716c(0x130);_0x289cac[_0x19716c(0x131)][_0x19716c(0x126)](_0x19716c(0x135)+_0x34b944),await setup['sendNotification'](_0x289cac,_0x19716c(0x117)+_0x34b944),activeTimer=setTimeout(()=>triggerAlarm(_0x289cac),0x5*0x3c*0x3e8);}function a2_0x18f3(_0x4c0737,_0x712839){const _0x379f82=a2_0x5d81();return a2_0x18f3=function(_0x4de90c,_0x4def28){_0x4de90c=_0x4de90c-0x105;let _0x5d813b=_0x379f82[_0x4de90c];return _0x5d813b;},a2_0x18f3(_0x4c0737,_0x712839);}async function triggerAlarm(_0x26317f){const _0x168c07=a2_0x342af0;alarmStage=0x2,await _0x26317f[_0x168c07(0x116)](_0x168c07(0x10b),{'val':_0x168c07(0x123),'ack':!![]});const _0x584505=_0x168c07(0x13b)+currentMonitoredRoom+'!';_0x26317f[_0x168c07(0x131)][_0x168c07(0x11f)]('[DeadMan]\x20'+_0x584505),await setup[_0x168c07(0x124)](_0x26317f,_0x584505,![],!![]);}module['exports']={'updateLocation':updateLocation};function a2_0x5d81(){const _0xab24df=['getStateAsync','‚è≥\x20ACHTUNG:\x20Ungew√∂hnlich\x20lange\x20Inaktivit√§t\x20in\x20','2952180rIOMEl','1385yXHklN','analysis.safety.deadMan.alarmState','apply','toLowerCase','search','\x27.\x20Nicht\x20verbunden\x20mit\x20√ºberwachtem\x20\x27','analysis.topology.structure','toString','8256368gRpCEz','üëº\x20Schutzengel:\x20√úberwache\x20','60OuXGac','\x20f√ºr\x20','setStateAsync','üëº\x20Schutzengel-Frage:\x20','\x20(Multi-Person\x20Filter)','\x20um\x2090\x20Min.','includes','parse','constructor','now','indexOf','error','val','10WkoRiD','./setup','alarm','sendNotification','(((.+)+)+)+$','warn','analysis.safety.deadMan.napProbability','schlaf','toFixed','\x20Min.','[DeadMan]\x20Topology\x20check\x20failed:\x20','default','61113CeTOpA','sofa','wohn','.\x20Alles\x20in\x20Ordnung?','log','1947006BCcyxP','message','3092nJIpEf','[DeadMan]\x20','living','analysis.safety.deadMan.currentRoom','analysis.safety.deadMan.active','6170815meyweK','info','üö®\x20NOTFALL-ALARM:\x20Person\x20reagiert\x20nicht\x20in\x20','replace','342028ygJdEr','analysis.safety.deadMan.smartSleep','Unknown','üí§\x20Smart\x20Sleep\x20erkannt\x20('];a2_0x5d81=function(){return _0xab24df;};return a2_0x5d81();}