const a2_0x410d87=a2_0x1f84;(function(_0x160c3a,_0x516052){const _0x4c7ff8=a2_0x1f84,_0x201df6=_0x160c3a();while(!![]){try{const _0xe3c0aa=parseInt(_0x4c7ff8(0x1ea))/0x1+-parseInt(_0x4c7ff8(0x1e0))/0x2+-parseInt(_0x4c7ff8(0x1cb))/0x3+parseInt(_0x4c7ff8(0x1fa))/0x4+-parseInt(_0x4c7ff8(0x1eb))/0x5+-parseInt(_0x4c7ff8(0x1d1))/0x6+-parseInt(_0x4c7ff8(0x1d4))/0x7*(-parseInt(_0x4c7ff8(0x1dd))/0x8);if(_0xe3c0aa===_0x516052)break;else _0x201df6['push'](_0x201df6['shift']());}catch(_0x1459dd){_0x201df6['push'](_0x201df6['shift']());}}}(a2_0x9ebc,0x8d40f));const a2_0x100562=(function(){let _0x3ba12e=!![];return function(_0x22df50,_0x4b1366){const _0x48a132=_0x3ba12e?function(){const _0xe3f5e1=a2_0x1f84;if(_0x4b1366){const _0x681061=_0x4b1366[_0xe3f5e1(0x1e9)](_0x22df50,arguments);return _0x4b1366=null,_0x681061;}}:function(){};return _0x3ba12e=![],_0x48a132;};}()),a2_0x575401=a2_0x100562(this,function(){const _0x317239=a2_0x1f84;return a2_0x575401[_0x317239(0x1fc)]()['search'](_0x317239(0x1f6))['toString']()[_0x317239(0x1d5)](a2_0x575401)[_0x317239(0x1e6)](_0x317239(0x1f6));});function a2_0x9ebc(){const _0x518985=['replace','alarm','log','warn','getHours','4380864IQqvbX','ðŸ’¤\x20Smart\x20Sleep\x20erkannt\x20(','Ignoriere\x20Bewegung\x20in\x20\x27','21KJvLDl','constructor','pre_warn','ðŸš¨\x20NOTFALL-ALARM:\x20Person\x20reagiert\x20nicht\x20in\x20','val','includes','setStateAsync','\x20Min.','now','5421496VwWEXZ','analysis.safety.deadMan.lastIgnored','indexOf','252078dXkGFr','getStateAsync','info','exports','parse','analysis.safety.deadMan.napProbability','search','analysis.safety.deadMan.smartSleep','%).\x20VerlÃ¤ngere\x20Timer\x20fÃ¼r\x20','apply','611216GOKOIw','4326215QBolND','.\x20Alles\x20in\x20Ordnung?','\x20fÃ¼r\x20','analysis.safety.deadMan.alarmState','Unknown','stringify','[DeadMan]\x20','message','ðŸ‘¼\x20Schutzengel:\x20Ãœberwache\x20','\x20(Multi-Person\x20Filter)','sofa','(((.+)+)+)+$','analysis.safety.deadMan.currentRoom','â³\x20ACHTUNG:\x20UngewÃ¶hnlich\x20lange\x20InaktivitÃ¤t\x20in\x20','./setup','2976880zKyDNr','ðŸ‘¼\x20Schutzengel-Frage:\x20','toString','wohn','toFixed','toLowerCase','sendNotification','default','3265488szsojY'];a2_0x9ebc=function(){return _0x518985;};return a2_0x9ebc();}a2_0x575401();'use strict';const setup=require(a2_0x410d87(0x1f9));let activeTimer=null,currentMonitoredRoom=null,timeoutMs=0x0,startTime=0x0,alarmStage=0x0;const DEFAULT_TIMEOUTS={'bad':0x2d,'bath':0x2d,'toilet':0x1e,'wc':0x1e,'keller':0x3c,'schlaf':0x78,'bed':0x78,'guest':0x5a,'gast':0x5a};function getTimeoutRobust(_0x20c26f,_0x5ef690){const _0x5cad47=a2_0x410d87;if(!_0x20c26f||!_0x5ef690)return undefined;if(_0x20c26f[_0x5ef690])return _0x20c26f[_0x5ef690];const _0x4bb3e6=_0x5ef690[_0x5cad47(0x1c8)]()[_0x5cad47(0x1cc)](/[^a-z0-9]/g,'');for(const _0x2cbccb in _0x20c26f){const _0x4fb702=_0x2cbccb[_0x5cad47(0x1c8)]()['replace'](/[^a-z0-9]/g,'');if(_0x4fb702===_0x4bb3e6)return _0x20c26f[_0x2cbccb];}const _0x380c37=_0x5ef690[_0x5cad47(0x1c8)]();if(_0x20c26f[_0x380c37])return _0x20c26f[_0x380c37];return undefined;}async function loadConfig(_0x26b14e){const _0x63f904=a2_0x410d87;try{const _0xd69c83=await _0x26b14e[_0x63f904(0x1e1)]('analysis.safety.deadMan.config');if(_0xd69c83&&_0xd69c83[_0x63f904(0x1d8)])return JSON[_0x63f904(0x1e4)](_0xd69c83[_0x63f904(0x1d8)]);}catch(_0x211a07){}return{};}async function isActive(_0x5eaff7){const _0x5ae2a8=a2_0x410d87;try{const _0x545f65=await _0x5eaff7[_0x5ae2a8(0x1e1)]('analysis.safety.deadMan.active');return _0x545f65&&_0x545f65[_0x5ae2a8(0x1d8)];}catch(_0x2480c1){return![];}}async function areRoomsConnected(_0x2ed577,_0x453808,_0x46eae5){const _0x53ee14=a2_0x410d87;try{const _0x218842=await _0x2ed577['getStateAsync']('analysis.topology.structure');if(!_0x218842||!_0x218842[_0x53ee14(0x1d8)])return!![];const _0x37985=JSON[_0x53ee14(0x1e4)](_0x218842['val']),{rooms:_0x119d3e,matrix:_0x50a939}=_0x37985;if(!_0x119d3e||!_0x50a939)return!![];const _0x456ff2=_0x119d3e[_0x53ee14(0x1df)](_0x453808),_0x2c81c0=_0x119d3e[_0x53ee14(0x1df)](_0x46eae5);if(_0x456ff2===-0x1||_0x2c81c0===-0x1)return!![];const _0x34b789=_0x50a939[_0x456ff2][_0x2c81c0]>0x0||_0x50a939[_0x2c81c0][_0x456ff2]>0x0;return _0x34b789;}catch(_0x360a8b){return _0x2ed577['log'][_0x53ee14(0x1cf)]('[DeadMan]\x20Topology\x20check\x20failed:\x20'+_0x360a8b[_0x53ee14(0x1f2)]),!![];}}function calculateSleepProbability(_0x413adb){const _0x3060a3=a2_0x410d87,_0x4b3785=new Date(),_0xd9511e=_0x4b3785[_0x3060a3(0x1d0)](),_0x3a2558=_0x413adb[_0x3060a3(0x1c8)]();let _0x4d2baf=0.1;if(_0xd9511e>=0x17||_0xd9511e<=0x6)_0x4d2baf=0x1;else{if(_0xd9511e>=0xd&&_0xd9511e<=0xf)_0x4d2baf=0.8;else{if(_0xd9511e>=0x14&&_0xd9511e<=0x17)_0x4d2baf=0.4;}}let _0x445468=0.1;if(_0x3a2558['includes']('schlaf')||_0x3a2558[_0x3060a3(0x1d9)]('bed'))_0x445468=0x1;else{if(_0x3a2558[_0x3060a3(0x1d9)](_0x3060a3(0x1fd))||_0x3a2558['includes']('living')||_0x3a2558[_0x3060a3(0x1d9)](_0x3060a3(0x1f5)))_0x445468=0.6;else{if(_0x3a2558['includes']('bad')||_0x3a2558[_0x3060a3(0x1d9)]('wc'))_0x445468=0.05;}}let _0x121938=0.5;const _0x54f476=_0x445468*0.5+_0x4d2baf*0.3+_0x121938*0.2;return parseFloat(_0x54f476[_0x3060a3(0x1c7)](0x2));}async function updateLocation(_0x3cc933,_0x58dd5d){const _0x3adc69=a2_0x410d87;if(!_0x58dd5d||_0x58dd5d===_0x3adc69(0x1ef))return;if(!await isActive(_0x3cc933)){resetTimer(_0x3cc933);return;}if(currentMonitoredRoom&&currentMonitoredRoom!==_0x58dd5d){const _0x3ce89a=await areRoomsConnected(_0x3cc933,currentMonitoredRoom,_0x58dd5d);if(!_0x3ce89a){const _0x1d145c=_0x3adc69(0x1d3)+_0x58dd5d+'\x27.\x20Nicht\x20verbunden\x20mit\x20Ã¼berwachtem\x20\x27'+currentMonitoredRoom+'\x27.';_0x3cc933[_0x3adc69(0x1ce)][_0x3adc69(0x1e2)](_0x3adc69(0x1f1)+_0x1d145c+_0x3adc69(0x1f4)),await _0x3cc933['setStateAsync'](_0x3adc69(0x1de),{'val':JSON[_0x3adc69(0x1f0)]({'room':_0x58dd5d,'reason':_0x1d145c,'timestamp':Date['now']()}),'ack':!![]});return;}resetTimer(_0x3cc933);}if(!currentMonitoredRoom){await _0x3cc933[_0x3adc69(0x1da)](_0x3adc69(0x1f7),{'val':_0x58dd5d,'ack':!![]});const _0xf1205d=await loadConfig(_0x3cc933);let _0x4aa522=getTimeoutRobust(_0xf1205d,_0x58dd5d);const _0x42f5c1=_0x58dd5d['toLowerCase']();if(!_0x4aa522)for(const _0x511081 in DEFAULT_TIMEOUTS){if(_0x42f5c1[_0x3adc69(0x1d9)](_0x511081)){_0x4aa522=DEFAULT_TIMEOUTS[_0x511081];break;}}if(!_0x4aa522&&_0xf1205d[_0x3adc69(0x1ca)])_0x4aa522=_0xf1205d['default'];if(!_0x4aa522)return;currentMonitoredRoom=_0x58dd5d,startTimer(_0x3cc933,_0x4aa522,_0x58dd5d);}}function startTimer(_0x4ea4ea,_0x944e19,_0x2a6031){const _0x211184=a2_0x410d87;if(activeTimer)clearTimeout(activeTimer);timeoutMs=_0x944e19*0x3c*0x3e8,startTime=Date[_0x211184(0x1dc)](),alarmStage=0x0;const _0x233982=calculateSleepProbability(_0x2a6031||currentMonitoredRoom),_0x4f4ccc=_0x233982>0.65;_0x4f4ccc?(timeoutMs+=0x5a*0x3c*0x3e8,_0x4ea4ea[_0x211184(0x1ce)]['info'](_0x211184(0x1d2)+(_0x233982*0x64)[_0x211184(0x1c7)](0x0)+_0x211184(0x1e8)+currentMonitoredRoom+'\x20um\x2090\x20Min.'),_0x4ea4ea[_0x211184(0x1da)]('analysis.safety.deadMan.smartSleep',{'val':!![],'ack':!![]})):_0x4ea4ea[_0x211184(0x1da)](_0x211184(0x1e7),{'val':![],'ack':!![]}),_0x4ea4ea[_0x211184(0x1da)](_0x211184(0x1e5),{'val':_0x233982,'ack':!![]}),_0x4ea4ea[_0x211184(0x1ce)][_0x211184(0x1e2)](_0x211184(0x1f3)+currentMonitoredRoom+_0x211184(0x1ed)+_0x944e19+_0x211184(0x1db)),_0x4ea4ea[_0x211184(0x1da)](_0x211184(0x1ee),{'val':'ok','ack':!![]}),activeTimer=setTimeout(()=>triggerPreWarn(_0x4ea4ea),timeoutMs);}function resetTimer(_0x2072d6){const _0x2c993b=a2_0x410d87;if(activeTimer)clearTimeout(activeTimer);activeTimer=null,currentMonitoredRoom=null,alarmStage=0x0,_0x2072d6['setStateAsync'](_0x2c993b(0x1ee),{'val':'ok','ack':!![]}),_0x2072d6[_0x2c993b(0x1da)](_0x2c993b(0x1e7),{'val':![],'ack':!![]}),_0x2072d6[_0x2c993b(0x1da)](_0x2c993b(0x1e5),{'val':0x0,'ack':!![]});}async function triggerPreWarn(_0xed884e){const _0x153172=a2_0x410d87;alarmStage=0x1,await _0xed884e[_0x153172(0x1da)](_0x153172(0x1ee),{'val':_0x153172(0x1d6),'ack':!![]});const _0x10d255=_0x153172(0x1f8)+currentMonitoredRoom+_0x153172(0x1ec);_0xed884e['log'][_0x153172(0x1cf)](_0x153172(0x1f1)+_0x10d255),await setup[_0x153172(0x1c9)](_0xed884e,_0x153172(0x1fb)+_0x10d255),activeTimer=setTimeout(()=>triggerAlarm(_0xed884e),0x5*0x3c*0x3e8);}async function triggerAlarm(_0x39272b){const _0x529df3=a2_0x410d87;alarmStage=0x2,await _0x39272b[_0x529df3(0x1da)]('analysis.safety.deadMan.alarmState',{'val':_0x529df3(0x1cd),'ack':!![]});const _0x2d7166=_0x529df3(0x1d7)+currentMonitoredRoom+'!';_0x39272b[_0x529df3(0x1ce)]['error'](_0x529df3(0x1f1)+_0x2d7166),await setup[_0x529df3(0x1c9)](_0x39272b,_0x2d7166,![],!![]);}function a2_0x1f84(_0x1bdb50,_0x18b9f5){const _0x1dec5d=a2_0x9ebc();return a2_0x1f84=function(_0x575401,_0x100562){_0x575401=_0x575401-0x1c7;let _0x9ebcb2=_0x1dec5d[_0x575401];return _0x9ebcb2;},a2_0x1f84(_0x1bdb50,_0x18b9f5);}module[a2_0x410d87(0x1e3)]={'updateLocation':updateLocation};