const a2_0x4c2dd8=a2_0x11ce;(function(_0x293030,_0x3e143e){const _0x2deaf2=a2_0x11ce,_0x2e9a25=_0x293030();while(!![]){try{const _0x5904a6=-parseInt(_0x2deaf2(0x94))/0x1+-parseInt(_0x2deaf2(0x87))/0x2+-parseInt(_0x2deaf2(0x90))/0x3+parseInt(_0x2deaf2(0xa1))/0x4*(parseInt(_0x2deaf2(0x84))/0x5)+-parseInt(_0x2deaf2(0x97))/0x6+-parseInt(_0x2deaf2(0x7d))/0x7*(-parseInt(_0x2deaf2(0x75))/0x8)+parseInt(_0x2deaf2(0x91))/0x9*(parseInt(_0x2deaf2(0x93))/0xa);if(_0x5904a6===_0x3e143e)break;else _0x2e9a25['push'](_0x2e9a25['shift']());}catch(_0x26d90f){_0x2e9a25['push'](_0x2e9a25['shift']());}}}(a2_0x2214,0xbef0e));function a2_0x2214(){const _0x662f66=['analysis.safety.deadMan.active','info','Ignoriere\x20Bewegung\x20in\x20\x27','setStateAsync','1964235XggAlk','36sybCkz','getStateAsync','4796710ebDJbH','317570flEfBI','replace','./setup','6655440QAZPdH','wohn','\x20um\x2090\x20Min.','.\x20Alles\x20in\x20Ordnung?','(((.+)+)+)+$','analysis.safety.deadMan.smartSleep','schlaf','indexOf','analysis.topology.structure','toLowerCase','949744YImoIR','val','now','warn','\x20(Multi-Person\x20Filter)','[DeadMan]\x20Topology\x20check\x20failed:\x20','\x20fÃ¼r\x20','search','%).\x20VerlÃ¤ngere\x20Timer\x20fÃ¼r\x20','log','[DeadMan]\x20','408992nFpimy','analysis.safety.deadMan.currentRoom','Unknown','ðŸ‘¼\x20Schutzengel-Frage:\x20','\x27.\x20Nicht\x20verbunden\x20mit\x20Ã¼berwachtem\x20\x27','analysis.safety.deadMan.lastIgnored','getHours','apply','182FkMlbO','default','stringify','message','toString','analysis.safety.deadMan.alarmState','parse','5JIyVBd','constructor','analysis.safety.deadMan.napProbability','1243390kQcGlg','includes','toFixed','\x20Min.','pre_warn'];a2_0x2214=function(){return _0x662f66;};return a2_0x2214();}const a2_0x5776d3=(function(){let _0x1878a7=!![];return function(_0x5dbd9c,_0x3ce795){const _0x527acd=_0x1878a7?function(){const _0x3dae2a=a2_0x11ce;if(_0x3ce795){const _0x5c1350=_0x3ce795[_0x3dae2a(0x7c)](_0x5dbd9c,arguments);return _0x3ce795=null,_0x5c1350;}}:function(){};return _0x1878a7=![],_0x527acd;};}()),a2_0x52b65a=a2_0x5776d3(this,function(){const _0x49f94a=a2_0x11ce;return a2_0x52b65a[_0x49f94a(0x81)]()[_0x49f94a(0x71)](_0x49f94a(0x9b))[_0x49f94a(0x81)]()[_0x49f94a(0x85)](a2_0x52b65a)[_0x49f94a(0x71)](_0x49f94a(0x9b));});function a2_0x11ce(_0x40cb47,_0x483615){const _0x219c2f=a2_0x2214();return a2_0x11ce=function(_0x52b65a,_0x5776d3){_0x52b65a=_0x52b65a-0x6e;let _0x22140c=_0x219c2f[_0x52b65a];return _0x22140c;},a2_0x11ce(_0x40cb47,_0x483615);}a2_0x52b65a();'use strict';const setup=require(a2_0x4c2dd8(0x96));let activeTimer=null,currentMonitoredRoom=null,timeoutMs=0x0,startTime=0x0,alarmStage=0x0;const DEFAULT_TIMEOUTS={'bad':0x2d,'bath':0x2d,'toilet':0x1e,'wc':0x1e,'keller':0x3c,'schlaf':0x78,'bed':0x78,'guest':0x5a,'gast':0x5a};function getTimeoutRobust(_0x23cb17,_0x4e14d){const _0x3b5ce5=a2_0x4c2dd8;if(!_0x23cb17||!_0x4e14d)return undefined;if(_0x23cb17[_0x4e14d])return _0x23cb17[_0x4e14d];const _0xac217e=_0x4e14d[_0x3b5ce5(0xa0)]()[_0x3b5ce5(0x95)](/[^a-z0-9]/g,'');for(const _0x59d312 in _0x23cb17){const _0x5d5ffe=_0x59d312['toLowerCase']()['replace'](/[^a-z0-9]/g,'');if(_0x5d5ffe===_0xac217e)return _0x23cb17[_0x59d312];}const _0x156a62=_0x4e14d[_0x3b5ce5(0xa0)]();if(_0x23cb17[_0x156a62])return _0x23cb17[_0x156a62];return undefined;}async function loadConfig(_0x372d25){const _0x4e01d5=a2_0x4c2dd8;try{const _0x37edf4=await _0x372d25[_0x4e01d5(0x92)]('analysis.safety.deadMan.config');if(_0x37edf4&&_0x37edf4[_0x4e01d5(0xa2)])return JSON[_0x4e01d5(0x83)](_0x37edf4[_0x4e01d5(0xa2)]);}catch(_0x2ca4d0){}return{};}async function isActive(_0x41113f){const _0x49fc3b=a2_0x4c2dd8;try{const _0x56a195=await _0x41113f['getStateAsync'](_0x49fc3b(0x8c));return _0x56a195&&_0x56a195[_0x49fc3b(0xa2)];}catch(_0x3eba84){return![];}}async function areRoomsConnected(_0x25c5c4,_0x182e51,_0x280bb8){const _0x7b2403=a2_0x4c2dd8;try{const _0xcc2d43=await _0x25c5c4[_0x7b2403(0x92)](_0x7b2403(0x9f));if(!_0xcc2d43||!_0xcc2d43[_0x7b2403(0xa2)])return!![];const _0x34276a=JSON[_0x7b2403(0x83)](_0xcc2d43[_0x7b2403(0xa2)]),{rooms:_0x20270c,matrix:_0x4a5378}=_0x34276a;if(!_0x20270c||!_0x4a5378)return!![];const _0x4fac45=_0x20270c[_0x7b2403(0x9e)](_0x182e51),_0x51acb5=_0x20270c[_0x7b2403(0x9e)](_0x280bb8);if(_0x4fac45===-0x1||_0x51acb5===-0x1)return!![];const _0x2ba8ce=_0x4a5378[_0x4fac45][_0x51acb5]>0x0||_0x4a5378[_0x51acb5][_0x4fac45]>0x0;return _0x2ba8ce;}catch(_0x56038f){return _0x25c5c4['log'][_0x7b2403(0xa4)](_0x7b2403(0x6f)+_0x56038f[_0x7b2403(0x80)]),!![];}}function calculateSleepProbability(_0x3bfc6a){const _0x18aaa0=a2_0x4c2dd8,_0x5ace78=new Date(),_0x400746=_0x5ace78[_0x18aaa0(0x7b)](),_0xe81c4e=_0x3bfc6a[_0x18aaa0(0xa0)]();let _0x58c273=0.1;if(_0x400746>=0x17||_0x400746<=0x6)_0x58c273=0x1;else{if(_0x400746>=0xd&&_0x400746<=0xf)_0x58c273=0.8;else{if(_0x400746>=0x14&&_0x400746<=0x17)_0x58c273=0.4;}}let _0x182087=0.1;if(_0xe81c4e[_0x18aaa0(0x88)](_0x18aaa0(0x9d))||_0xe81c4e['includes']('bed'))_0x182087=0x1;else{if(_0xe81c4e[_0x18aaa0(0x88)](_0x18aaa0(0x98))||_0xe81c4e['includes']('living')||_0xe81c4e[_0x18aaa0(0x88)]('sofa'))_0x182087=0.6;else{if(_0xe81c4e[_0x18aaa0(0x88)]('bad')||_0xe81c4e[_0x18aaa0(0x88)]('wc'))_0x182087=0.05;}}let _0x163089=0.5;const _0x9b8ad4=_0x182087*0.5+_0x58c273*0.3+_0x163089*0.2;return parseFloat(_0x9b8ad4[_0x18aaa0(0x89)](0x2));}async function updateLocation(_0x4fd6b2,_0x16a473){const _0x38edfa=a2_0x4c2dd8;if(!_0x16a473||_0x16a473===_0x38edfa(0x77))return;if(!await isActive(_0x4fd6b2)){resetTimer(_0x4fd6b2);return;}if(currentMonitoredRoom&&currentMonitoredRoom!==_0x16a473){const _0x270d7b=await areRoomsConnected(_0x4fd6b2,currentMonitoredRoom,_0x16a473);if(!_0x270d7b){const _0x38bd80=_0x38edfa(0x8e)+_0x16a473+_0x38edfa(0x79)+currentMonitoredRoom+'\x27.';_0x4fd6b2['log']['info'](_0x38edfa(0x74)+_0x38bd80+_0x38edfa(0x6e)),await _0x4fd6b2[_0x38edfa(0x8f)](_0x38edfa(0x7a),{'val':JSON[_0x38edfa(0x7f)]({'room':_0x16a473,'reason':_0x38bd80,'timestamp':Date['now']()}),'ack':!![]});return;}resetTimer(_0x4fd6b2);}if(!currentMonitoredRoom){await _0x4fd6b2['setStateAsync'](_0x38edfa(0x76),{'val':_0x16a473,'ack':!![]});const _0x46b964=await loadConfig(_0x4fd6b2);let _0x322aac=getTimeoutRobust(_0x46b964,_0x16a473);const _0x47931d=_0x16a473[_0x38edfa(0xa0)]();if(!_0x322aac)for(const _0x308512 in DEFAULT_TIMEOUTS){if(_0x47931d['includes'](_0x308512)){_0x322aac=DEFAULT_TIMEOUTS[_0x308512];break;}}if(!_0x322aac&&_0x46b964['default'])_0x322aac=_0x46b964[_0x38edfa(0x7e)];if(!_0x322aac)return;currentMonitoredRoom=_0x16a473,startTimer(_0x4fd6b2,_0x322aac,_0x16a473);}}function startTimer(_0x1434ca,_0x15dcb2,_0x998268){const _0x4bd9a4=a2_0x4c2dd8;if(activeTimer)clearTimeout(activeTimer);timeoutMs=_0x15dcb2*0x3c*0x3e8,startTime=Date[_0x4bd9a4(0xa3)](),alarmStage=0x0;const _0x47f73f=calculateSleepProbability(_0x998268||currentMonitoredRoom),_0x2e01f5=_0x47f73f>0.65;_0x2e01f5?(timeoutMs+=0x5a*0x3c*0x3e8,_0x1434ca[_0x4bd9a4(0x73)][_0x4bd9a4(0x8d)]('ðŸ’¤\x20Smart\x20Sleep\x20erkannt\x20('+(_0x47f73f*0x64)[_0x4bd9a4(0x89)](0x0)+_0x4bd9a4(0x72)+currentMonitoredRoom+_0x4bd9a4(0x99)),_0x1434ca[_0x4bd9a4(0x8f)](_0x4bd9a4(0x9c),{'val':!![],'ack':!![]})):_0x1434ca['setStateAsync'](_0x4bd9a4(0x9c),{'val':![],'ack':!![]}),_0x1434ca[_0x4bd9a4(0x8f)](_0x4bd9a4(0x86),{'val':_0x47f73f,'ack':!![]}),_0x1434ca['log'][_0x4bd9a4(0x8d)]('ðŸ‘¼\x20Schutzengel:\x20Ãœberwache\x20'+currentMonitoredRoom+_0x4bd9a4(0x70)+_0x15dcb2+_0x4bd9a4(0x8a)),_0x1434ca[_0x4bd9a4(0x8f)](_0x4bd9a4(0x82),{'val':'ok','ack':!![]}),activeTimer=setTimeout(()=>triggerPreWarn(_0x1434ca),timeoutMs);}function resetTimer(_0xb19e12){const _0x2ae9e4=a2_0x4c2dd8;if(activeTimer)clearTimeout(activeTimer);activeTimer=null,currentMonitoredRoom=null,alarmStage=0x0,_0xb19e12[_0x2ae9e4(0x8f)](_0x2ae9e4(0x82),{'val':'ok','ack':!![]}),_0xb19e12['setStateAsync']('analysis.safety.deadMan.smartSleep',{'val':![],'ack':!![]}),_0xb19e12[_0x2ae9e4(0x8f)](_0x2ae9e4(0x86),{'val':0x0,'ack':!![]});}async function triggerPreWarn(_0x4266ce){const _0x360145=a2_0x4c2dd8;alarmStage=0x1,await _0x4266ce[_0x360145(0x8f)](_0x360145(0x82),{'val':_0x360145(0x8b),'ack':!![]});const _0x365f00='â³\x20ACHTUNG:\x20UngewÃ¶hnlich\x20lange\x20InaktivitÃ¤t\x20in\x20'+currentMonitoredRoom+_0x360145(0x9a);_0x4266ce[_0x360145(0x73)][_0x360145(0xa4)]('[DeadMan]\x20'+_0x365f00),await setup['sendNotification'](_0x4266ce,_0x360145(0x78)+_0x365f00),activeTimer=setTimeout(()=>triggerAlarm(_0x4266ce),0x5*0x3c*0x3e8);}async function triggerAlarm(_0x1bffcd){const _0xf6afc9=a2_0x4c2dd8;alarmStage=0x2,await _0x1bffcd[_0xf6afc9(0x8f)]('analysis.safety.deadMan.alarmState',{'val':'alarm','ack':!![]});const _0x4887df='ðŸš¨\x20NOTFALL-ALARM:\x20Person\x20reagiert\x20nicht\x20in\x20'+currentMonitoredRoom+'!';_0x1bffcd['log']['error'](_0xf6afc9(0x74)+_0x4887df),await setup['sendNotification'](_0x1bffcd,_0x4887df,![],!![]);}module['exports']={'updateLocation':updateLocation};