const a2_0x2ee4ab=a2_0x2c7c;(function(_0xc4bb26,_0x592be7){const _0x28abe1=a2_0x2c7c,_0x23a8e1=_0xc4bb26();while(!![]){try{const _0x35d717=-parseInt(_0x28abe1(0xd0))/0x1+parseInt(_0x28abe1(0xf2))/0x2*(-parseInt(_0x28abe1(0xde))/0x3)+-parseInt(_0x28abe1(0xd5))/0x4+-parseInt(_0x28abe1(0xcc))/0x5*(-parseInt(_0x28abe1(0xf5))/0x6)+-parseInt(_0x28abe1(0xcd))/0x7+-parseInt(_0x28abe1(0xc2))/0x8*(-parseInt(_0x28abe1(0xdc))/0x9)+parseInt(_0x28abe1(0xd8))/0xa;if(_0x35d717===_0x592be7)break;else _0x23a8e1['push'](_0x23a8e1['shift']());}catch(_0x2db359){_0x23a8e1['push'](_0x23a8e1['shift']());}}}(a2_0xb39a,0x76eff));const a2_0xaaa6cf=(function(){let _0x2a952b=!![];return function(_0x43e546,_0xd77598){const _0x152aef=_0x2a952b?function(){if(_0xd77598){const _0x51c7e5=_0xd77598['apply'](_0x43e546,arguments);return _0xd77598=null,_0x51c7e5;}}:function(){};return _0x2a952b=![],_0x152aef;};}()),a2_0x489956=a2_0xaaa6cf(this,function(){const _0x4161c6=a2_0x2c7c;return a2_0x489956[_0x4161c6(0xdd)]()[_0x4161c6(0xea)](_0x4161c6(0xc1))[_0x4161c6(0xdd)]()[_0x4161c6(0xd2)](a2_0x489956)[_0x4161c6(0xea)](_0x4161c6(0xc1));});a2_0x489956();'use strict';const setup=require('./setup');let activeTimer=null,currentMonitoredRoom=null,timeoutMs=0x0,startTime=0x0,alarmStage=0x0;const DEFAULT_TIMEOUTS={'bad':0x2d,'bath':0x2d,'toilet':0x1e,'wc':0x1e,'keller':0x3c,'schlaf':0x78,'bed':0x78,'guest':0x5a,'gast':0x5a};function getTimeoutRobust(_0x25c01e,_0x2e3599){const _0x3d6ffa=a2_0x2c7c;if(!_0x25c01e||!_0x2e3599)return undefined;if(_0x25c01e[_0x2e3599])return _0x25c01e[_0x2e3599];const _0x398759=_0x2e3599[_0x3d6ffa(0xf4)]()[_0x3d6ffa(0xdb)](/[^a-z0-9]/g,'');for(const _0x295852 in _0x25c01e){const _0x1c40af=_0x295852[_0x3d6ffa(0xf4)]()[_0x3d6ffa(0xdb)](/[^a-z0-9]/g,'');if(_0x1c40af===_0x398759)return _0x25c01e[_0x295852];}const _0x4d5b43=_0x2e3599[_0x3d6ffa(0xf4)]();if(_0x25c01e[_0x4d5b43])return _0x25c01e[_0x4d5b43];return undefined;}async function loadConfig(_0x191580){const _0x517e6f=a2_0x2c7c;try{const _0x2ec2a6=await _0x191580['getStateAsync']('analysis.safety.deadMan.config');if(_0x2ec2a6&&_0x2ec2a6[_0x517e6f(0xec)])return JSON[_0x517e6f(0xf7)](_0x2ec2a6[_0x517e6f(0xec)]);}catch(_0x4c0675){}return{};}async function isActive(_0x5da1b1){const _0x446a01=a2_0x2c7c;try{const _0x5f4a0c=await _0x5da1b1[_0x446a01(0xc9)]('analysis.safety.deadMan.active');return _0x5f4a0c&&_0x5f4a0c[_0x446a01(0xec)];}catch(_0x192069){return![];}}async function areRoomsConnected(_0x5859d0,_0x10c03b,_0x516cfe){const _0x358e53=a2_0x2c7c;try{const _0x3f17ae=await _0x5859d0['getStateAsync']('analysis.topology.structure');if(!_0x3f17ae||!_0x3f17ae['val'])return!![];const _0x3d6878=JSON[_0x358e53(0xf7)](_0x3f17ae[_0x358e53(0xec)]),{rooms:_0x58f663,matrix:_0x29b74b}=_0x3d6878;if(!_0x58f663||!_0x29b74b)return!![];const _0xe0c48c=_0x58f663[_0x358e53(0xef)](_0x10c03b),_0x347e27=_0x58f663['indexOf'](_0x516cfe);if(_0xe0c48c===-0x1||_0x347e27===-0x1)return!![];const _0x1c1a11=_0x29b74b[_0xe0c48c][_0x347e27]>0x0||_0x29b74b[_0x347e27][_0xe0c48c]>0x0;return _0x1c1a11;}catch(_0x42a357){return _0x5859d0['log']['warn'](_0x358e53(0xd9)+_0x42a357[_0x358e53(0xe1)]),!![];}}function calculateSleepProbability(_0xfd7573){const _0x30ae8f=a2_0x2c7c,_0x29a08b=new Date(),_0x2cbe09=_0x29a08b[_0x30ae8f(0xe3)](),_0x17b649=_0xfd7573['toLowerCase']();let _0x2c1a3c=0.1;if(_0x2cbe09>=0x17||_0x2cbe09<=0x6)_0x2c1a3c=0x1;else{if(_0x2cbe09>=0xd&&_0x2cbe09<=0xf)_0x2c1a3c=0.8;else{if(_0x2cbe09>=0x14&&_0x2cbe09<=0x17)_0x2c1a3c=0.4;}}let _0x1bd207=0.1;if(_0x17b649[_0x30ae8f(0xd1)](_0x30ae8f(0xca))||_0x17b649[_0x30ae8f(0xd1)](_0x30ae8f(0xcf)))_0x1bd207=0x1;else{if(_0x17b649[_0x30ae8f(0xd1)](_0x30ae8f(0xe6))||_0x17b649[_0x30ae8f(0xd1)]('living')||_0x17b649[_0x30ae8f(0xd1)](_0x30ae8f(0xce)))_0x1bd207=0.6;else{if(_0x17b649['includes']('bad')||_0x17b649['includes']('wc'))_0x1bd207=0.05;}}let _0x29e7e8=0.5;const _0x613c1e=_0x1bd207*0.5+_0x2c1a3c*0.3+_0x29e7e8*0.2;return parseFloat(_0x613c1e['toFixed'](0x2));}async function updateLocation(_0x363bac,_0x22eb47){const _0x3e0178=a2_0x2c7c;if(!_0x22eb47||_0x22eb47===_0x3e0178(0xc8))return;if(!await isActive(_0x363bac)){resetTimer(_0x363bac);return;}if(currentMonitoredRoom&&currentMonitoredRoom!==_0x22eb47){const _0x356f09=await areRoomsConnected(_0x363bac,currentMonitoredRoom,_0x22eb47);if(!_0x356f09){const _0x13f986='Ignoriere\x20Bewegung\x20in\x20\x27'+_0x22eb47+_0x3e0178(0xe8)+currentMonitoredRoom+'\x27.';_0x363bac[_0x3e0178(0xc7)]['info']('[DeadMan]\x20'+_0x13f986+_0x3e0178(0xf1)),await _0x363bac['setStateAsync'](_0x3e0178(0xe2),{'val':JSON['stringify']({'room':_0x22eb47,'reason':_0x13f986,'timestamp':Date['now']()}),'ack':!![]});return;}resetTimer(_0x363bac);}if(!currentMonitoredRoom){await _0x363bac[_0x3e0178(0xd7)](_0x3e0178(0xf3),{'val':_0x22eb47,'ack':!![]});const _0x5a522e=await loadConfig(_0x363bac);let _0x5a0fd1=getTimeoutRobust(_0x5a522e,_0x22eb47);const _0x5d9d5a=_0x22eb47['toLowerCase']();if(!_0x5a0fd1)for(const _0x50d052 in DEFAULT_TIMEOUTS){if(_0x5d9d5a['includes'](_0x50d052)){_0x5a0fd1=DEFAULT_TIMEOUTS[_0x50d052];break;}}if(!_0x5a0fd1&&_0x5a522e[_0x3e0178(0xf0)])_0x5a0fd1=_0x5a522e[_0x3e0178(0xf0)];if(!_0x5a0fd1)return;currentMonitoredRoom=_0x22eb47,startTimer(_0x363bac,_0x5a0fd1,_0x22eb47);}}function startTimer(_0x12b21d,_0x4aedaa,_0x503ea9){const _0x3d581a=a2_0x2c7c;if(activeTimer)clearTimeout(activeTimer);timeoutMs=_0x4aedaa*0x3c*0x3e8,startTime=Date[_0x3d581a(0xcb)](),alarmStage=0x0;const _0x5e804b=calculateSleepProbability(_0x503ea9||currentMonitoredRoom),_0x196c6e=_0x5e804b>0.65;_0x196c6e?(timeoutMs+=0x5a*0x3c*0x3e8,_0x12b21d[_0x3d581a(0xc7)][_0x3d581a(0xc3)](_0x3d581a(0xc4)+(_0x5e804b*0x64)['toFixed'](0x0)+_0x3d581a(0xdf)+currentMonitoredRoom+_0x3d581a(0xc5)),_0x12b21d[_0x3d581a(0xd7)](_0x3d581a(0xee),{'val':!![],'ack':!![]})):_0x12b21d['setStateAsync'](_0x3d581a(0xee),{'val':![],'ack':!![]}),_0x12b21d['setStateAsync'](_0x3d581a(0xd3),{'val':_0x5e804b,'ack':!![]}),_0x12b21d[_0x3d581a(0xc7)][_0x3d581a(0xc3)](_0x3d581a(0xe0)+currentMonitoredRoom+_0x3d581a(0xe7)+_0x4aedaa+_0x3d581a(0xd6)),_0x12b21d[_0x3d581a(0xd7)](_0x3d581a(0xe9),{'val':'ok','ack':!![]}),activeTimer=setTimeout(()=>triggerPreWarn(_0x12b21d),timeoutMs);}function resetTimer(_0x5f3e03){const _0x3e85f8=a2_0x2c7c;if(activeTimer)clearTimeout(activeTimer);activeTimer=null,currentMonitoredRoom=null,alarmStage=0x0,_0x5f3e03['setStateAsync'](_0x3e85f8(0xe9),{'val':'ok','ack':!![]}),_0x5f3e03[_0x3e85f8(0xd7)](_0x3e85f8(0xee),{'val':![],'ack':!![]}),_0x5f3e03['setStateAsync'](_0x3e85f8(0xd3),{'val':0x0,'ack':!![]});}async function triggerPreWarn(_0x4076c4){const _0x2d943c=a2_0x2c7c;alarmStage=0x1,await _0x4076c4[_0x2d943c(0xd7)](_0x2d943c(0xe9),{'val':_0x2d943c(0xf6),'ack':!![]});const _0x254954=_0x2d943c(0xd4)+currentMonitoredRoom+_0x2d943c(0xe4);_0x4076c4['log'][_0x2d943c(0xeb)](_0x2d943c(0xda)+_0x254954),await setup['sendNotification'](_0x4076c4,'üëº\x20Schutzengel-Frage:\x20'+_0x254954),activeTimer=setTimeout(()=>triggerAlarm(_0x4076c4),0x5*0x3c*0x3e8);}function a2_0xb39a(){const _0x35788d=['includes','constructor','analysis.safety.deadMan.napProbability','‚è≥\x20ACHTUNG:\x20Ungew√∂hnlich\x20lange\x20Inaktivit√§t\x20in\x20','477940cuafrW','\x20Min.','setStateAsync','13362380gSYPBc','[DeadMan]\x20Topology\x20check\x20failed:\x20','[DeadMan]\x20','replace','9UWogSI','toString','6SPmXMF','%).\x20Verl√§ngere\x20Timer\x20f√ºr\x20','üëº\x20Schutzengel:\x20√úberwache\x20','message','analysis.safety.deadMan.lastIgnored','getHours','.\x20Alles\x20in\x20Ordnung?','exports','wohn','\x20f√ºr\x20','\x27.\x20Nicht\x20verbunden\x20mit\x20√ºberwachtem\x20\x27','analysis.safety.deadMan.alarmState','search','warn','val','error','analysis.safety.deadMan.smartSleep','indexOf','default','\x20(Multi-Person\x20Filter)','180598qkizPc','analysis.safety.deadMan.currentRoom','toLowerCase','26454fYwCxt','pre_warn','parse','(((.+)+)+)+$','2142880YBMQFl','info','üí§\x20Smart\x20Sleep\x20erkannt\x20(','\x20um\x2090\x20Min.','alarm','log','Unknown','getStateAsync','schlaf','now','115TunGjM','4417483MbhDeA','sofa','bed','287186KpdirW'];a2_0xb39a=function(){return _0x35788d;};return a2_0xb39a();}function a2_0x2c7c(_0x2c561d,_0xdbc26){const _0x1b6902=a2_0xb39a();return a2_0x2c7c=function(_0x489956,_0xaaa6cf){_0x489956=_0x489956-0xc1;let _0xb39ad7=_0x1b6902[_0x489956];return _0xb39ad7;},a2_0x2c7c(_0x2c561d,_0xdbc26);}async function triggerAlarm(_0x546f56){const _0x41484f=a2_0x2c7c;alarmStage=0x2,await _0x546f56[_0x41484f(0xd7)](_0x41484f(0xe9),{'val':_0x41484f(0xc6),'ack':!![]});const _0x1b3d93='üö®\x20NOTFALL-ALARM:\x20Person\x20reagiert\x20nicht\x20in\x20'+currentMonitoredRoom+'!';_0x546f56[_0x41484f(0xc7)][_0x41484f(0xed)]('[DeadMan]\x20'+_0x1b3d93),await setup['sendNotification'](_0x546f56,_0x1b3d93,![],!![]);}module[a2_0x2ee4ab(0xe5)]={'updateLocation':updateLocation};