const a2_0x241a10=a2_0x3c4d;(function(_0xe44ffb,_0x522726){const _0x21fc3f=a2_0x3c4d,_0x5d4c10=_0xe44ffb();while(!![]){try{const _0x5ab09e=-parseInt(_0x21fc3f(0x16a))/0x1*(parseInt(_0x21fc3f(0x15a))/0x2)+-parseInt(_0x21fc3f(0x157))/0x3*(parseInt(_0x21fc3f(0x141))/0x4)+parseInt(_0x21fc3f(0x152))/0x5+-parseInt(_0x21fc3f(0x13f))/0x6*(parseInt(_0x21fc3f(0x14c))/0x7)+-parseInt(_0x21fc3f(0x14a))/0x8+-parseInt(_0x21fc3f(0x14b))/0x9*(-parseInt(_0x21fc3f(0x150))/0xa)+-parseInt(_0x21fc3f(0x147))/0xb*(-parseInt(_0x21fc3f(0x133))/0xc);if(_0x5ab09e===_0x522726)break;else _0x5d4c10['push'](_0x5d4c10['shift']());}catch(_0x3b4989){_0x5d4c10['push'](_0x5d4c10['shift']());}}}(a2_0x1349,0x7a720));function a2_0x1349(){const _0x17832d=['error','â³\x20ACHTUNG:\x20UngewÃ¶hnlich\x20lange\x20InaktivitÃ¤t\x20in\x20','[DeadMan]\x20','121bOvZCI','[DeadMan]\x20Topology\x20check\x20failed:\x20','sendNotification','6369464YLhsXt','2421smhBkT','7isZYbR','analysis.safety.deadMan.alarmState','parse','\x27.\x20Nicht\x20verbunden\x20mit\x20Ã¼berwachtem\x20\x27','29690NtbnWJ','warn','4006210yJkVpm','analysis.safety.deadMan.active','log','\x20Min.','ðŸ’¤\x20Smart\x20Sleep\x20erkannt\x20(','32871uLOhBK','exports','analysis.safety.deadMan.napProbability','386882jhgrHZ','val','analysis.safety.deadMan.config','pre_warn','constructor','analysis.topology.structure','bad','message','default','Ignoriere\x20Bewegung\x20in\x20\x27','wohn','getStateAsync','sofa','ðŸš¨\x20NOTFALL-ALARM:\x20Person\x20reagiert\x20nicht\x20in\x20','\x20fÃ¼r\x20','setStateAsync','4zXUOuC','(((.+)+)+)+$','includes','info','search','getHours','.\x20Alles\x20in\x20Ordnung?','toFixed','alarm','toString','1757688OrwsMr','now','analysis.safety.deadMan.lastIgnored','stringify','\x20um\x2090\x20Min.','\x20(Multi-Person\x20Filter)','Unknown','analysis.safety.deadMan.smartSleep','indexOf','toLowerCase','./setup','bed','4536834nFwffk','ðŸ‘¼\x20Schutzengel:\x20Ãœberwache\x20','140WqvkBp','ðŸ‘¼\x20Schutzengel-Frage:\x20','replace'];a2_0x1349=function(){return _0x17832d;};return a2_0x1349();}const a2_0x394741=(function(){let _0x191509=!![];return function(_0x391417,_0x3aa0a1){const _0x61c0fa=_0x191509?function(){if(_0x3aa0a1){const _0x2c2f74=_0x3aa0a1['apply'](_0x391417,arguments);return _0x3aa0a1=null,_0x2c2f74;}}:function(){};return _0x191509=![],_0x61c0fa;};}()),a2_0x41aa8a=a2_0x394741(this,function(){const _0x576e59=a2_0x3c4d;return a2_0x41aa8a[_0x576e59(0x132)]()[_0x576e59(0x12d)](_0x576e59(0x12a))[_0x576e59(0x132)]()[_0x576e59(0x15e)](a2_0x41aa8a)['search'](_0x576e59(0x12a));});a2_0x41aa8a();'use strict';const setup=require(a2_0x241a10(0x13d));let activeTimer=null,currentMonitoredRoom=null,timeoutMs=0x0,startTime=0x0,alarmStage=0x0;const DEFAULT_TIMEOUTS={'bad':0x2d,'bath':0x2d,'toilet':0x1e,'wc':0x1e,'keller':0x3c,'schlaf':0x78,'bed':0x78,'guest':0x5a,'gast':0x5a};function getTimeoutRobust(_0x349a27,_0x43c406){const _0x25e03c=a2_0x241a10;if(!_0x349a27||!_0x43c406)return undefined;if(_0x349a27[_0x43c406])return _0x349a27[_0x43c406];const _0x1be0b1=_0x43c406['toLowerCase']()['replace'](/[^a-z0-9]/g,'');for(const _0x397d79 in _0x349a27){const _0x369180=_0x397d79[_0x25e03c(0x13c)]()[_0x25e03c(0x143)](/[^a-z0-9]/g,'');if(_0x369180===_0x1be0b1)return _0x349a27[_0x397d79];}const _0x53f083=_0x43c406[_0x25e03c(0x13c)]();if(_0x349a27[_0x53f083])return _0x349a27[_0x53f083];return undefined;}async function loadConfig(_0x2cf859){const _0x85e803=a2_0x241a10;try{const _0x1a7ca6=await _0x2cf859['getStateAsync'](_0x85e803(0x15c));if(_0x1a7ca6&&_0x1a7ca6[_0x85e803(0x15b)])return JSON[_0x85e803(0x14e)](_0x1a7ca6[_0x85e803(0x15b)]);}catch(_0x2b9b39){}return{};}async function isActive(_0x588d2b){const _0x586115=a2_0x241a10;try{const _0x4f98a7=await _0x588d2b[_0x586115(0x165)](_0x586115(0x153));return _0x4f98a7&&_0x4f98a7[_0x586115(0x15b)];}catch(_0x337f4f){return![];}}async function areRoomsConnected(_0x6b9bdf,_0xd0adcd,_0x2cda4b){const _0x6ce3e8=a2_0x241a10;try{const _0x44449a=await _0x6b9bdf['getStateAsync'](_0x6ce3e8(0x15f));if(!_0x44449a||!_0x44449a[_0x6ce3e8(0x15b)])return!![];const _0x1eb361=JSON['parse'](_0x44449a['val']),{rooms:_0x3bdf5d,matrix:_0x1f1d6b}=_0x1eb361;if(!_0x3bdf5d||!_0x1f1d6b)return!![];const _0x12e0db=_0x3bdf5d[_0x6ce3e8(0x13b)](_0xd0adcd),_0x46cd1b=_0x3bdf5d[_0x6ce3e8(0x13b)](_0x2cda4b);if(_0x12e0db===-0x1||_0x46cd1b===-0x1)return!![];const _0x1a9bc5=_0x1f1d6b[_0x12e0db][_0x46cd1b]>0x0||_0x1f1d6b[_0x46cd1b][_0x12e0db]>0x0;return _0x1a9bc5;}catch(_0x17ae24){return _0x6b9bdf[_0x6ce3e8(0x154)][_0x6ce3e8(0x151)](_0x6ce3e8(0x148)+_0x17ae24[_0x6ce3e8(0x161)]),!![];}}function calculateSleepProbability(_0x1f8a0a){const _0x456e5a=a2_0x241a10,_0x519b25=new Date(),_0x5aa4d6=_0x519b25[_0x456e5a(0x12e)](),_0x1fc628=_0x1f8a0a[_0x456e5a(0x13c)]();let _0x417a6b=0.1;if(_0x5aa4d6>=0x17||_0x5aa4d6<=0x6)_0x417a6b=0x1;else{if(_0x5aa4d6>=0xd&&_0x5aa4d6<=0xf)_0x417a6b=0.8;else{if(_0x5aa4d6>=0x14&&_0x5aa4d6<=0x17)_0x417a6b=0.4;}}let _0x55bbe2=0.1;if(_0x1fc628['includes']('schlaf')||_0x1fc628[_0x456e5a(0x12b)](_0x456e5a(0x13e)))_0x55bbe2=0x1;else{if(_0x1fc628[_0x456e5a(0x12b)](_0x456e5a(0x164))||_0x1fc628['includes']('living')||_0x1fc628[_0x456e5a(0x12b)](_0x456e5a(0x166)))_0x55bbe2=0.6;else{if(_0x1fc628[_0x456e5a(0x12b)](_0x456e5a(0x160))||_0x1fc628[_0x456e5a(0x12b)]('wc'))_0x55bbe2=0.05;}}let _0x619be2=0.5;const _0xdae21a=_0x55bbe2*0.5+_0x417a6b*0.3+_0x619be2*0.2;return parseFloat(_0xdae21a[_0x456e5a(0x130)](0x2));}async function updateLocation(_0x185cfd,_0x51f73d){const _0x2a4ced=a2_0x241a10;if(!_0x51f73d||_0x51f73d===_0x2a4ced(0x139))return;if(!await isActive(_0x185cfd)){resetTimer(_0x185cfd);return;}if(currentMonitoredRoom&&currentMonitoredRoom!==_0x51f73d){const _0x6e015c=await areRoomsConnected(_0x185cfd,currentMonitoredRoom,_0x51f73d);if(!_0x6e015c){const _0x2f3f95=_0x2a4ced(0x163)+_0x51f73d+_0x2a4ced(0x14f)+currentMonitoredRoom+'\x27.';_0x185cfd[_0x2a4ced(0x154)][_0x2a4ced(0x12c)]('[DeadMan]\x20'+_0x2f3f95+_0x2a4ced(0x138)),await _0x185cfd[_0x2a4ced(0x169)](_0x2a4ced(0x135),{'val':JSON[_0x2a4ced(0x136)]({'room':_0x51f73d,'reason':_0x2f3f95,'timestamp':Date[_0x2a4ced(0x134)]()}),'ack':!![]});return;}resetTimer(_0x185cfd);}if(!currentMonitoredRoom){await _0x185cfd[_0x2a4ced(0x169)]('analysis.safety.deadMan.currentRoom',{'val':_0x51f73d,'ack':!![]});const _0x47ef94=await loadConfig(_0x185cfd);let _0x497c5a=getTimeoutRobust(_0x47ef94,_0x51f73d);const _0x2fbce1=_0x51f73d[_0x2a4ced(0x13c)]();if(!_0x497c5a)for(const _0x5d1326 in DEFAULT_TIMEOUTS){if(_0x2fbce1[_0x2a4ced(0x12b)](_0x5d1326)){_0x497c5a=DEFAULT_TIMEOUTS[_0x5d1326];break;}}if(!_0x497c5a&&_0x47ef94['default'])_0x497c5a=_0x47ef94[_0x2a4ced(0x162)];if(!_0x497c5a)return;currentMonitoredRoom=_0x51f73d,startTimer(_0x185cfd,_0x497c5a,_0x51f73d);}}function startTimer(_0x1704e9,_0x96e0df,_0x29007f){const _0x5f4410=a2_0x241a10;if(activeTimer)clearTimeout(activeTimer);timeoutMs=_0x96e0df*0x3c*0x3e8,startTime=Date[_0x5f4410(0x134)](),alarmStage=0x0;const _0x468ddd=calculateSleepProbability(_0x29007f||currentMonitoredRoom),_0x541258=_0x468ddd>0.65;_0x541258?(timeoutMs+=0x5a*0x3c*0x3e8,_0x1704e9[_0x5f4410(0x154)]['info'](_0x5f4410(0x156)+(_0x468ddd*0x64)[_0x5f4410(0x130)](0x0)+'%).\x20VerlÃ¤ngere\x20Timer\x20fÃ¼r\x20'+currentMonitoredRoom+_0x5f4410(0x137)),_0x1704e9[_0x5f4410(0x169)](_0x5f4410(0x13a),{'val':!![],'ack':!![]})):_0x1704e9[_0x5f4410(0x169)](_0x5f4410(0x13a),{'val':![],'ack':!![]}),_0x1704e9[_0x5f4410(0x169)](_0x5f4410(0x159),{'val':_0x468ddd,'ack':!![]}),_0x1704e9[_0x5f4410(0x154)][_0x5f4410(0x12c)](_0x5f4410(0x140)+currentMonitoredRoom+_0x5f4410(0x168)+_0x96e0df+_0x5f4410(0x155)),_0x1704e9[_0x5f4410(0x169)](_0x5f4410(0x14d),{'val':'ok','ack':!![]}),activeTimer=setTimeout(()=>triggerPreWarn(_0x1704e9),timeoutMs);}function a2_0x3c4d(_0x53688e,_0x1d703d){const _0x44e4fc=a2_0x1349();return a2_0x3c4d=function(_0x41aa8a,_0x394741){_0x41aa8a=_0x41aa8a-0x12a;let _0x1349bc=_0x44e4fc[_0x41aa8a];return _0x1349bc;},a2_0x3c4d(_0x53688e,_0x1d703d);}function resetTimer(_0x48c071){const _0x5677c6=a2_0x241a10;if(activeTimer)clearTimeout(activeTimer);activeTimer=null,currentMonitoredRoom=null,alarmStage=0x0,_0x48c071['setStateAsync'](_0x5677c6(0x14d),{'val':'ok','ack':!![]}),_0x48c071[_0x5677c6(0x169)](_0x5677c6(0x13a),{'val':![],'ack':!![]}),_0x48c071[_0x5677c6(0x169)](_0x5677c6(0x159),{'val':0x0,'ack':!![]});}async function triggerPreWarn(_0x3ebd20){const _0x2ddafc=a2_0x241a10;alarmStage=0x1,await _0x3ebd20['setStateAsync'](_0x2ddafc(0x14d),{'val':_0x2ddafc(0x15d),'ack':!![]});const _0x52b79c=_0x2ddafc(0x145)+currentMonitoredRoom+_0x2ddafc(0x12f);_0x3ebd20[_0x2ddafc(0x154)][_0x2ddafc(0x151)](_0x2ddafc(0x146)+_0x52b79c),await setup[_0x2ddafc(0x149)](_0x3ebd20,_0x2ddafc(0x142)+_0x52b79c),activeTimer=setTimeout(()=>triggerAlarm(_0x3ebd20),0x5*0x3c*0x3e8);}async function triggerAlarm(_0x100e16){const _0xa765e3=a2_0x241a10;alarmStage=0x2,await _0x100e16[_0xa765e3(0x169)]('analysis.safety.deadMan.alarmState',{'val':_0xa765e3(0x131),'ack':!![]});const _0x5bf426=_0xa765e3(0x167)+currentMonitoredRoom+'!';_0x100e16[_0xa765e3(0x154)][_0xa765e3(0x144)](_0xa765e3(0x146)+_0x5bf426),await setup[_0xa765e3(0x149)](_0x100e16,_0x5bf426,![],!![]);}module[a2_0x241a10(0x158)]={'updateLocation':updateLocation};