const a2_0x5b58c5=a2_0x3a70;(function(_0x1d4c2f,_0x5da910){const _0x53f68=a2_0x3a70,_0x2bc7e5=_0x1d4c2f();while(!![]){try{const _0x263172=-parseInt(_0x53f68(0xac))/0x1+parseInt(_0x53f68(0x92))/0x2*(parseInt(_0x53f68(0xb3))/0x3)+-parseInt(_0x53f68(0x93))/0x4*(parseInt(_0x53f68(0xab))/0x5)+parseInt(_0x53f68(0x9b))/0x6+parseInt(_0x53f68(0x7d))/0x7+-parseInt(_0x53f68(0xb2))/0x8+-parseInt(_0x53f68(0xa6))/0x9;if(_0x263172===_0x5da910)break;else _0x2bc7e5['push'](_0x2bc7e5['shift']());}catch(_0x39765f){_0x2bc7e5['push'](_0x2bc7e5['shift']());}}}(a2_0x51d7,0x55bc3));const a2_0xe6b6aa=(function(){let _0x1424db=!![];return function(_0x267119,_0x1f342a){const _0xfa287e=_0x1424db?function(){const _0x651c63=a2_0x3a70;if(_0x1f342a){const _0x5da8ff=_0x1f342a[_0x651c63(0xb1)](_0x267119,arguments);return _0x1f342a=null,_0x5da8ff;}}:function(){};return _0x1424db=![],_0xfa287e;};}()),a2_0x409f14=a2_0xe6b6aa(this,function(){const _0x5904eb=a2_0x3a70;return a2_0x409f14[_0x5904eb(0xb4)]()[_0x5904eb(0xa0)](_0x5904eb(0xa5))['toString']()[_0x5904eb(0x7f)](a2_0x409f14)[_0x5904eb(0xa0)]('(((.+)+)+)+$');});a2_0x409f14();'use strict';const setup=require(a2_0x5b58c5(0x87));let activeTimer=null,currentMonitoredRoom=null,timeoutMs=0x0,startTime=0x0,alarmStage=0x0;const DEFAULT_TIMEOUTS={'bad':0x2d,'bath':0x2d,'toilet':0x1e,'wc':0x1e,'keller':0x3c,'schlaf':0x78,'bed':0x78,'guest':0x5a,'gast':0x5a};function getTimeoutRobust(_0x2d5940,_0x4bdfab){const _0x3173b8=a2_0x5b58c5;if(!_0x2d5940||!_0x4bdfab)return undefined;if(_0x2d5940[_0x4bdfab])return _0x2d5940[_0x4bdfab];const _0x1c0723=_0x4bdfab[_0x3173b8(0x9d)]()[_0x3173b8(0x80)](/[^a-z0-9]/g,'');for(const _0x58baf7 in _0x2d5940){const _0x372990=_0x58baf7[_0x3173b8(0x9d)]()[_0x3173b8(0x80)](/[^a-z0-9]/g,'');if(_0x372990===_0x1c0723)return _0x2d5940[_0x58baf7];}const _0x4f51f6=_0x4bdfab[_0x3173b8(0x9d)]();if(_0x2d5940[_0x4f51f6])return _0x2d5940[_0x4f51f6];return undefined;}async function loadConfig(_0x27b0f4){const _0x3a23c0=a2_0x5b58c5;try{const _0x1aae31=await _0x27b0f4[_0x3a23c0(0x8a)](_0x3a23c0(0x8c));if(_0x1aae31&&_0x1aae31[_0x3a23c0(0x9a)])return JSON[_0x3a23c0(0x9e)](_0x1aae31[_0x3a23c0(0x9a)]);}catch(_0x187d42){}return{};}async function isActive(_0x1d5d6b){const _0x399fd9=a2_0x5b58c5;try{const _0x37f4a4=await _0x1d5d6b[_0x399fd9(0x8a)](_0x399fd9(0x86));return _0x37f4a4&&_0x37f4a4[_0x399fd9(0x9a)];}catch(_0x59a9c6){return![];}}function a2_0x3a70(_0x4e0140,_0x793cf4){const _0x179bac=a2_0x51d7();return a2_0x3a70=function(_0x409f14,_0xe6b6aa){_0x409f14=_0x409f14-0x7b;let _0x51d75c=_0x179bac[_0x409f14];return _0x51d75c;},a2_0x3a70(_0x4e0140,_0x793cf4);}async function areRoomsConnected(_0x526b36,_0x5810e0,_0xaa780c){const _0x5178f4=a2_0x5b58c5;try{const _0xf498a7=await _0x526b36[_0x5178f4(0x8a)](_0x5178f4(0x7e));if(!_0xf498a7||!_0xf498a7[_0x5178f4(0x9a)])return!![];const _0x533478=JSON[_0x5178f4(0x9e)](_0xf498a7[_0x5178f4(0x9a)]),{rooms:_0x5966cf,matrix:_0x256a3a}=_0x533478;if(!_0x5966cf||!_0x256a3a)return!![];const _0x5ea6c4=_0x5966cf[_0x5178f4(0x8d)](_0x5810e0),_0x4b901f=_0x5966cf[_0x5178f4(0x8d)](_0xaa780c);if(_0x5ea6c4===-0x1||_0x4b901f===-0x1)return!![];const _0x2e167e=_0x256a3a[_0x5ea6c4][_0x4b901f]>0x0||_0x256a3a[_0x4b901f][_0x5ea6c4]>0x0;return _0x2e167e;}catch(_0x2b32a5){return _0x526b36[_0x5178f4(0xad)][_0x5178f4(0xa7)](_0x5178f4(0xaa)+_0x2b32a5[_0x5178f4(0x9c)]),!![];}}function calculateSleepProbability(_0x306f9d){const _0x36b173=a2_0x5b58c5,_0x1a2521=new Date(),_0x2cc346=_0x1a2521['getHours'](),_0x3b0040=_0x306f9d['toLowerCase']();let _0x34513e=0.1;if(_0x2cc346>=0x17||_0x2cc346<=0x6)_0x34513e=0x1;else{if(_0x2cc346>=0xd&&_0x2cc346<=0xf)_0x34513e=0.8;else{if(_0x2cc346>=0x14&&_0x2cc346<=0x17)_0x34513e=0.4;}}let _0x27fcdc=0.1;if(_0x3b0040[_0x36b173(0x83)](_0x36b173(0x95))||_0x3b0040['includes'](_0x36b173(0x8b)))_0x27fcdc=0x1;else{if(_0x3b0040[_0x36b173(0x83)]('wohn')||_0x3b0040[_0x36b173(0x83)](_0x36b173(0x96))||_0x3b0040[_0x36b173(0x83)](_0x36b173(0xa2)))_0x27fcdc=0.6;else{if(_0x3b0040[_0x36b173(0x83)](_0x36b173(0xa1))||_0x3b0040[_0x36b173(0x83)]('wc'))_0x27fcdc=0.05;}}let _0x38cfa0=0.5;const _0x3964d4=_0x27fcdc*0.5+_0x34513e*0.3+_0x38cfa0*0.2;return parseFloat(_0x3964d4[_0x36b173(0x82)](0x2));}async function updateLocation(_0x4f3566,_0x4b745a){const _0x17b765=a2_0x5b58c5;if(!_0x4b745a||_0x4b745a==='Unknown')return;if(!await isActive(_0x4f3566)){resetTimer(_0x4f3566);return;}if(currentMonitoredRoom&&currentMonitoredRoom!==_0x4b745a){const _0xf9e8aa=await areRoomsConnected(_0x4f3566,currentMonitoredRoom,_0x4b745a);if(!_0xf9e8aa){const _0x3f80c6=_0x17b765(0xa4)+_0x4b745a+'\x27.\x20Nicht\x20verbunden\x20mit\x20Ã¼berwachtem\x20\x27'+currentMonitoredRoom+'\x27.';_0x4f3566[_0x17b765(0xad)][_0x17b765(0x9f)](_0x17b765(0x88)+_0x3f80c6+_0x17b765(0xa3)),await _0x4f3566[_0x17b765(0xaf)]('analysis.safety.deadMan.lastIgnored',{'val':JSON[_0x17b765(0x94)]({'room':_0x4b745a,'reason':_0x3f80c6,'timestamp':Date['now']()}),'ack':!![]});return;}resetTimer(_0x4f3566);}if(!currentMonitoredRoom){await _0x4f3566[_0x17b765(0xaf)]('analysis.safety.deadMan.currentRoom',{'val':_0x4b745a,'ack':!![]});const _0x4bdefb=await loadConfig(_0x4f3566);let _0x449575=getTimeoutRobust(_0x4bdefb,_0x4b745a);const _0x3fcab0=_0x4b745a['toLowerCase']();if(!_0x449575)for(const _0x27d536 in DEFAULT_TIMEOUTS){if(_0x3fcab0[_0x17b765(0x83)](_0x27d536)){_0x449575=DEFAULT_TIMEOUTS[_0x27d536];break;}}if(!_0x449575&&_0x4bdefb[_0x17b765(0x89)])_0x449575=_0x4bdefb[_0x17b765(0x89)];if(!_0x449575)return;currentMonitoredRoom=_0x4b745a,startTimer(_0x4f3566,_0x449575,_0x4b745a);}}function a2_0x51d7(){const _0x5016fa=['info','search','bad','sofa','\x20(Multi-Person\x20Filter)','Ignoriere\x20Bewegung\x20in\x20\x27','(((.+)+)+)+$','1391535YImDgY','warn','now','sendNotification','[DeadMan]\x20Topology\x20check\x20failed:\x20','1667245GsUVjl','80937ylrWnq','log','ðŸ‘¼\x20Schutzengel:\x20Ãœberwache\x20','setStateAsync','\x20um\x2090\x20Min.','apply','4721208PdPUfF','6Sqyaes','toString','â³\x20ACHTUNG:\x20UngewÃ¶hnlich\x20lange\x20InaktivitÃ¤t\x20in\x20','alarm','2089766ZCqgAb','analysis.topology.structure','constructor','replace','.\x20Alles\x20in\x20Ordnung?','toFixed','includes','\x20Min.','\x20fÃ¼r\x20','analysis.safety.deadMan.active','./setup','[DeadMan]\x20','default','getStateAsync','bed','analysis.safety.deadMan.config','indexOf','pre_warn','analysis.safety.deadMan.alarmState','exports','ðŸ‘¼\x20Schutzengel-Frage:\x20','688612fJVILG','4nZooOe','stringify','schlaf','living','analysis.safety.deadMan.smartSleep','error','%).\x20VerlÃ¤ngere\x20Timer\x20fÃ¼r\x20','val','3139038USNQci','message','toLowerCase','parse'];a2_0x51d7=function(){return _0x5016fa;};return a2_0x51d7();}function startTimer(_0x5dd4f6,_0x4fb159,_0x25eec2){const _0x305ad4=a2_0x5b58c5;if(activeTimer)clearTimeout(activeTimer);timeoutMs=_0x4fb159*0x3c*0x3e8,startTime=Date[_0x305ad4(0xa8)](),alarmStage=0x0;const _0x4937ff=calculateSleepProbability(_0x25eec2||currentMonitoredRoom),_0xd67d0f=_0x4937ff>0.65;_0xd67d0f?(timeoutMs+=0x5a*0x3c*0x3e8,_0x5dd4f6['log'][_0x305ad4(0x9f)]('ðŸ’¤\x20Smart\x20Sleep\x20erkannt\x20('+(_0x4937ff*0x64)['toFixed'](0x0)+_0x305ad4(0x99)+currentMonitoredRoom+_0x305ad4(0xb0)),_0x5dd4f6['setStateAsync'](_0x305ad4(0x97),{'val':!![],'ack':!![]})):_0x5dd4f6['setStateAsync'](_0x305ad4(0x97),{'val':![],'ack':!![]}),_0x5dd4f6[_0x305ad4(0xaf)]('analysis.safety.deadMan.napProbability',{'val':_0x4937ff,'ack':!![]}),_0x5dd4f6['log']['info'](_0x305ad4(0xae)+currentMonitoredRoom+_0x305ad4(0x85)+_0x4fb159+_0x305ad4(0x84)),_0x5dd4f6['setStateAsync'](_0x305ad4(0x8f),{'val':'ok','ack':!![]}),activeTimer=setTimeout(()=>triggerPreWarn(_0x5dd4f6),timeoutMs);}function resetTimer(_0x3d7d46){const _0x15485c=a2_0x5b58c5;if(activeTimer)clearTimeout(activeTimer);activeTimer=null,currentMonitoredRoom=null,alarmStage=0x0,_0x3d7d46[_0x15485c(0xaf)]('analysis.safety.deadMan.alarmState',{'val':'ok','ack':!![]}),_0x3d7d46[_0x15485c(0xaf)](_0x15485c(0x97),{'val':![],'ack':!![]}),_0x3d7d46[_0x15485c(0xaf)]('analysis.safety.deadMan.napProbability',{'val':0x0,'ack':!![]});}async function triggerPreWarn(_0x591ef2){const _0x13ad5c=a2_0x5b58c5;alarmStage=0x1,await _0x591ef2['setStateAsync'](_0x13ad5c(0x8f),{'val':_0x13ad5c(0x8e),'ack':!![]});const _0x5c171e=_0x13ad5c(0x7b)+currentMonitoredRoom+_0x13ad5c(0x81);_0x591ef2[_0x13ad5c(0xad)]['warn']('[DeadMan]\x20'+_0x5c171e),await setup[_0x13ad5c(0xa9)](_0x591ef2,_0x13ad5c(0x91)+_0x5c171e),activeTimer=setTimeout(()=>triggerAlarm(_0x591ef2),0x5*0x3c*0x3e8);}async function triggerAlarm(_0xbd8e94){const _0x5deb96=a2_0x5b58c5;alarmStage=0x2,await _0xbd8e94[_0x5deb96(0xaf)](_0x5deb96(0x8f),{'val':_0x5deb96(0x7c),'ack':!![]});const _0x373bd7='ðŸš¨\x20NOTFALL-ALARM:\x20Person\x20reagiert\x20nicht\x20in\x20'+currentMonitoredRoom+'!';_0xbd8e94['log'][_0x5deb96(0x98)](_0x5deb96(0x88)+_0x373bd7),await setup['sendNotification'](_0xbd8e94,_0x373bd7,![],!![]);}module[a2_0x5b58c5(0x90)]={'updateLocation':updateLocation};