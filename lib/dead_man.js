const a2_0x1a7362=a2_0x3cc7;(function(_0x4e811d,_0x1a4333){const _0x40cf7e=a2_0x3cc7,_0x5325d8=_0x4e811d();while(!![]){try{const _0x3b307b=-parseInt(_0x40cf7e(0xef))/0x1+parseInt(_0x40cf7e(0xf2))/0x2*(parseInt(_0x40cf7e(0xf8))/0x3)+-parseInt(_0x40cf7e(0xdc))/0x4*(parseInt(_0x40cf7e(0xea))/0x5)+parseInt(_0x40cf7e(0xcd))/0x6*(parseInt(_0x40cf7e(0xf5))/0x7)+parseInt(_0x40cf7e(0x107))/0x8*(-parseInt(_0x40cf7e(0x101))/0x9)+-parseInt(_0x40cf7e(0xdd))/0xa*(parseInt(_0x40cf7e(0xf9))/0xb)+-parseInt(_0x40cf7e(0xeb))/0xc*(-parseInt(_0x40cf7e(0xf7))/0xd);if(_0x3b307b===_0x1a4333)break;else _0x5325d8['push'](_0x5325d8['shift']());}catch(_0x9949d){_0x5325d8['push'](_0x5325d8['shift']());}}}(a2_0x2a63,0x1bc87));const a2_0x2b0ac7=(function(){let _0x1bce38=!![];return function(_0xeaab85,_0x1613b0){const _0x720e7d=_0x1bce38?function(){const _0x28a3d2=a2_0x3cc7;if(_0x1613b0){const _0x143740=_0x1613b0[_0x28a3d2(0xd8)](_0xeaab85,arguments);return _0x1613b0=null,_0x143740;}}:function(){};return _0x1bce38=![],_0x720e7d;};}()),a2_0x30aea7=a2_0x2b0ac7(this,function(){const _0x11ef3a=a2_0x3cc7;return a2_0x30aea7[_0x11ef3a(0xf0)]()['search'](_0x11ef3a(0xec))[_0x11ef3a(0xf0)]()[_0x11ef3a(0xf1)](a2_0x30aea7)['search'](_0x11ef3a(0xec));});a2_0x30aea7();'use strict';const setup=require(a2_0x1a7362(0xe5));let activeTimer=null,currentMonitoredRoom=null,timeoutMs=0x0,startTime=0x0,alarmStage=0x0;const DEFAULT_TIMEOUTS={'bad':0x2d,'bath':0x2d,'toilet':0x1e,'wc':0x1e,'keller':0x3c,'schlaf':0x78,'bed':0x78,'guest':0x5a,'gast':0x5a};function getTimeoutRobust(_0x175ebe,_0x484366){const _0x1bc22b=a2_0x1a7362;if(!_0x175ebe||!_0x484366)return undefined;if(_0x175ebe[_0x484366])return _0x175ebe[_0x484366];const _0x4695ed=_0x484366[_0x1bc22b(0x106)]()[_0x1bc22b(0xe4)](/[^a-z0-9]/g,'');for(const _0x22cfb2 in _0x175ebe){const _0x42fb0f=_0x22cfb2[_0x1bc22b(0x106)]()[_0x1bc22b(0xe4)](/[^a-z0-9]/g,'');if(_0x42fb0f===_0x4695ed)return _0x175ebe[_0x22cfb2];}const _0x53eced=_0x484366[_0x1bc22b(0x106)]();if(_0x175ebe[_0x53eced])return _0x175ebe[_0x53eced];return undefined;}async function loadConfig(_0x4a80ec){const _0x182287=a2_0x1a7362;try{const _0x545ac2=await _0x4a80ec['getStateAsync'](_0x182287(0xe2));if(_0x545ac2&&_0x545ac2[_0x182287(0xde)])return JSON[_0x182287(0xff)](_0x545ac2[_0x182287(0xde)]);}catch(_0x319a84){}return{};}async function isActive(_0x55999d){const _0xe091f0=a2_0x1a7362;try{const _0x2f75fa=await _0x55999d[_0xe091f0(0xd4)](_0xe091f0(0xc9));return _0x2f75fa&&_0x2f75fa[_0xe091f0(0xde)];}catch(_0x5c3756){return![];}}async function areRoomsConnected(_0x1cabd7,_0x1a6181,_0x44fadf){const _0x53c4fe=a2_0x1a7362;try{const _0x5e4a09=await _0x1cabd7['getStateAsync'](_0x53c4fe(0x104));if(!_0x5e4a09||!_0x5e4a09[_0x53c4fe(0xde)])return!![];const _0x30e687=JSON['parse'](_0x5e4a09[_0x53c4fe(0xde)]),{rooms:_0x39ad8c,matrix:_0x43fb14}=_0x30e687;if(!_0x39ad8c||!_0x43fb14)return!![];const _0x419740=_0x39ad8c[_0x53c4fe(0xd2)](_0x1a6181),_0x59057d=_0x39ad8c['indexOf'](_0x44fadf);if(_0x419740===-0x1||_0x59057d===-0x1)return!![];const _0x1af32c=_0x43fb14[_0x419740][_0x59057d]>0x0||_0x43fb14[_0x59057d][_0x419740]>0x0;return _0x1af32c;}catch(_0x4e4e30){return _0x1cabd7[_0x53c4fe(0xe7)][_0x53c4fe(0xf6)](_0x53c4fe(0xcc)+_0x4e4e30[_0x53c4fe(0xf3)]),!![];}}function calculateSleepProbability(_0x21e514){const _0x5c2c68=a2_0x1a7362,_0x306c29=new Date(),_0xb465fd=_0x306c29[_0x5c2c68(0xfd)](),_0x1f8020=_0x21e514[_0x5c2c68(0x106)]();let _0x45b957=0.1;if(_0xb465fd>=0x17||_0xb465fd<=0x6)_0x45b957=0x1;else{if(_0xb465fd>=0xd&&_0xb465fd<=0xf)_0x45b957=0.8;else{if(_0xb465fd>=0x14&&_0xb465fd<=0x17)_0x45b957=0.4;}}let _0x2676d6=0.1;if(_0x1f8020[_0x5c2c68(0xd6)](_0x5c2c68(0xe3))||_0x1f8020['includes'](_0x5c2c68(0xe9)))_0x2676d6=0x1;else{if(_0x1f8020[_0x5c2c68(0xd6)](_0x5c2c68(0xd3))||_0x1f8020[_0x5c2c68(0xd6)](_0x5c2c68(0xe0))||_0x1f8020['includes']('sofa'))_0x2676d6=0.6;else{if(_0x1f8020['includes'](_0x5c2c68(0xe8))||_0x1f8020[_0x5c2c68(0xd6)]('wc'))_0x2676d6=0.05;}}let _0x423ec2=0.5;const _0x5ba789=_0x2676d6*0.5+_0x45b957*0.3+_0x423ec2*0.2;return parseFloat(_0x5ba789['toFixed'](0x2));}function a2_0x2a63(){const _0x471188=['(((.+)+)+)+$','sendNotification','\x20(Multi-Person\x20Filter)','144612WiSNnP','toString','constructor','9678wTtYKd','message','info','14xqLcHo','warn','24167vBZcge','3sRHYJZ','187HTpKMs','now','default','[DeadMan]\x20','getHours','toFixed','parse','\x20Min.','545886MFnbne','%).\x20VerlÃ¤ngere\x20Timer\x20fÃ¼r\x20','setStateAsync','analysis.topology.structure','alarm','toLowerCase','8ovUpMJ','ðŸ‘¼\x20Schutzengel:\x20Ãœberwache\x20','analysis.safety.deadMan.active','analysis.safety.deadMan.alarmState','\x27.\x20Nicht\x20verbunden\x20mit\x20Ã¼berwachtem\x20\x27','[DeadMan]\x20Topology\x20check\x20failed:\x20','60378CEWrpA','stringify','Ignoriere\x20Bewegung\x20in\x20\x27','ðŸ‘¼\x20Schutzengel-Frage:\x20','exports','indexOf','wohn','getStateAsync','ðŸ’¤\x20Smart\x20Sleep\x20erkannt\x20(','includes','.\x20Alles\x20in\x20Ordnung?','apply','error','pre_warn','analysis.safety.deadMan.smartSleep','228lOwaks','14380GlBOtC','val','analysis.safety.deadMan.napProbability','living','ðŸš¨\x20NOTFALL-ALARM:\x20Person\x20reagiert\x20nicht\x20in\x20','analysis.safety.deadMan.config','schlaf','replace','./setup','\x20fÃ¼r\x20','log','bad','bed','10705zURvbe','2844yEaisS'];a2_0x2a63=function(){return _0x471188;};return a2_0x2a63();}async function updateLocation(_0x39c538,_0x2beef8){const _0x5d1e94=a2_0x1a7362;if(!_0x2beef8||_0x2beef8==='Unknown')return;if(!await isActive(_0x39c538)){resetTimer(_0x39c538);return;}if(currentMonitoredRoom&&currentMonitoredRoom!==_0x2beef8){const _0x1a3861=await areRoomsConnected(_0x39c538,currentMonitoredRoom,_0x2beef8);if(!_0x1a3861){const _0x16c9fa=_0x5d1e94(0xcf)+_0x2beef8+_0x5d1e94(0xcb)+currentMonitoredRoom+'\x27.';_0x39c538[_0x5d1e94(0xe7)][_0x5d1e94(0xf4)](_0x5d1e94(0xfc)+_0x16c9fa+_0x5d1e94(0xee)),await _0x39c538[_0x5d1e94(0x103)]('analysis.safety.deadMan.lastIgnored',{'val':JSON[_0x5d1e94(0xce)]({'room':_0x2beef8,'reason':_0x16c9fa,'timestamp':Date[_0x5d1e94(0xfa)]()}),'ack':!![]});return;}resetTimer(_0x39c538);}if(!currentMonitoredRoom){await _0x39c538['setStateAsync']('analysis.safety.deadMan.currentRoom',{'val':_0x2beef8,'ack':!![]});const _0x494c7a=await loadConfig(_0x39c538);let _0x45128d=getTimeoutRobust(_0x494c7a,_0x2beef8);const _0x1d0341=_0x2beef8['toLowerCase']();if(!_0x45128d)for(const _0x1a319a in DEFAULT_TIMEOUTS){if(_0x1d0341[_0x5d1e94(0xd6)](_0x1a319a)){_0x45128d=DEFAULT_TIMEOUTS[_0x1a319a];break;}}if(!_0x45128d&&_0x494c7a[_0x5d1e94(0xfb)])_0x45128d=_0x494c7a['default'];if(!_0x45128d)return;currentMonitoredRoom=_0x2beef8,startTimer(_0x39c538,_0x45128d,_0x2beef8);}}function startTimer(_0x36f4f5,_0x11e696,_0x24e98c){const _0x498519=a2_0x1a7362;if(activeTimer)clearTimeout(activeTimer);timeoutMs=_0x11e696*0x3c*0x3e8,startTime=Date[_0x498519(0xfa)](),alarmStage=0x0;const _0x273c82=calculateSleepProbability(_0x24e98c||currentMonitoredRoom),_0x217ae7=_0x273c82>0.65;_0x217ae7?(timeoutMs+=0x5a*0x3c*0x3e8,_0x36f4f5[_0x498519(0xe7)][_0x498519(0xf4)](_0x498519(0xd5)+(_0x273c82*0x64)[_0x498519(0xfe)](0x0)+_0x498519(0x102)+currentMonitoredRoom+'\x20um\x2090\x20Min.'),_0x36f4f5[_0x498519(0x103)](_0x498519(0xdb),{'val':!![],'ack':!![]})):_0x36f4f5[_0x498519(0x103)](_0x498519(0xdb),{'val':![],'ack':!![]}),_0x36f4f5[_0x498519(0x103)](_0x498519(0xdf),{'val':_0x273c82,'ack':!![]}),_0x36f4f5['log'][_0x498519(0xf4)](_0x498519(0xc8)+currentMonitoredRoom+_0x498519(0xe6)+_0x11e696+_0x498519(0x100)),_0x36f4f5[_0x498519(0x103)](_0x498519(0xca),{'val':'ok','ack':!![]}),activeTimer=setTimeout(()=>triggerPreWarn(_0x36f4f5),timeoutMs);}function a2_0x3cc7(_0x5e27cc,_0x586ed5){const _0x244713=a2_0x2a63();return a2_0x3cc7=function(_0x30aea7,_0x2b0ac7){_0x30aea7=_0x30aea7-0xc8;let _0x2a6310=_0x244713[_0x30aea7];return _0x2a6310;},a2_0x3cc7(_0x5e27cc,_0x586ed5);}function resetTimer(_0xf73f5a){const _0x5b114a=a2_0x1a7362;if(activeTimer)clearTimeout(activeTimer);activeTimer=null,currentMonitoredRoom=null,alarmStage=0x0,_0xf73f5a[_0x5b114a(0x103)](_0x5b114a(0xca),{'val':'ok','ack':!![]}),_0xf73f5a[_0x5b114a(0x103)]('analysis.safety.deadMan.smartSleep',{'val':![],'ack':!![]}),_0xf73f5a[_0x5b114a(0x103)](_0x5b114a(0xdf),{'val':0x0,'ack':!![]});}async function triggerPreWarn(_0x593641){const _0x43a72f=a2_0x1a7362;alarmStage=0x1,await _0x593641['setStateAsync'](_0x43a72f(0xca),{'val':_0x43a72f(0xda),'ack':!![]});const _0x135542='â³\x20ACHTUNG:\x20UngewÃ¶hnlich\x20lange\x20InaktivitÃ¤t\x20in\x20'+currentMonitoredRoom+_0x43a72f(0xd7);_0x593641[_0x43a72f(0xe7)]['warn'](_0x43a72f(0xfc)+_0x135542),await setup[_0x43a72f(0xed)](_0x593641,_0x43a72f(0xd0)+_0x135542),activeTimer=setTimeout(()=>triggerAlarm(_0x593641),0x5*0x3c*0x3e8);}async function triggerAlarm(_0x558726){const _0xce9a85=a2_0x1a7362;alarmStage=0x2,await _0x558726[_0xce9a85(0x103)](_0xce9a85(0xca),{'val':_0xce9a85(0x105),'ack':!![]});const _0x4c72a6=_0xce9a85(0xe1)+currentMonitoredRoom+'!';_0x558726[_0xce9a85(0xe7)][_0xce9a85(0xd9)]('[DeadMan]\x20'+_0x4c72a6),await setup['sendNotification'](_0x558726,_0x4c72a6,![],!![]);}module[a2_0x1a7362(0xd1)]={'updateLocation':updateLocation};