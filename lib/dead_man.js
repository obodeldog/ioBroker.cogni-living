const a2_0x317dd0=a2_0x50a2;(function(_0x15a454,_0xdf22a2){const _0x4fe9cd=a2_0x50a2,_0x14d1c0=_0x15a454();while(!![]){try{const _0x4e3262=-parseInt(_0x4fe9cd(0x150))/0x1*(parseInt(_0x4fe9cd(0x147))/0x2)+-parseInt(_0x4fe9cd(0x142))/0x3*(-parseInt(_0x4fe9cd(0x162))/0x4)+parseInt(_0x4fe9cd(0x14c))/0x5+parseInt(_0x4fe9cd(0x146))/0x6+parseInt(_0x4fe9cd(0x159))/0x7*(-parseInt(_0x4fe9cd(0x166))/0x8)+-parseInt(_0x4fe9cd(0x158))/0x9*(parseInt(_0x4fe9cd(0x13e))/0xa)+parseInt(_0x4fe9cd(0x14b))/0xb;if(_0x4e3262===_0xdf22a2)break;else _0x14d1c0['push'](_0x14d1c0['shift']());}catch(_0x5dec93){_0x14d1c0['push'](_0x14d1c0['shift']());}}}(a2_0x525a,0xce2ff));const a2_0x1e8881=(function(){let _0x4fc304=!![];return function(_0x3a8fea,_0x2fd988){const _0x1b6984=_0x4fc304?function(){const _0x2ff25a=a2_0x50a2;if(_0x2fd988){const _0x560f47=_0x2fd988[_0x2ff25a(0x155)](_0x3a8fea,arguments);return _0x2fd988=null,_0x560f47;}}:function(){};return _0x4fc304=![],_0x1b6984;};}()),a2_0x25eafb=a2_0x1e8881(this,function(){const _0x47cc58=a2_0x50a2;return a2_0x25eafb[_0x47cc58(0x15f)]()[_0x47cc58(0x15d)](_0x47cc58(0x160))['toString']()['constructor'](a2_0x25eafb)[_0x47cc58(0x15d)](_0x47cc58(0x160));});a2_0x25eafb();'use strict';const setup=require(a2_0x317dd0(0x15c));let activeTimer=null,currentMonitoredRoom=null,timeoutMs=0x0,startTime=0x0,alarmStage=0x0;const DEFAULT_TIMEOUTS={'bad':0x2d,'bath':0x2d,'toilet':0x1e,'wc':0x1e,'keller':0x3c};function a2_0x50a2(_0x119367,_0x5e027b){const _0x14a03f=a2_0x525a();return a2_0x50a2=function(_0x25eafb,_0x1e8881){_0x25eafb=_0x25eafb-0x13b;let _0x525ae9=_0x14a03f[_0x25eafb];return _0x525ae9;},a2_0x50a2(_0x119367,_0x5e027b);}async function loadConfig(_0x254e39){const _0x24f561=a2_0x317dd0;try{const _0x289fa6=await _0x254e39[_0x24f561(0x15e)]('analysis.safety.deadMan.config');if(_0x289fa6&&_0x289fa6['val'])return JSON[_0x24f561(0x165)](_0x289fa6[_0x24f561(0x144)]);}catch(_0x164fe2){}return{};}async function isActive(_0x2a900c){const _0x7dabf0=a2_0x317dd0;try{const _0x5674b=await _0x2a900c[_0x7dabf0(0x15e)](_0x7dabf0(0x153));return _0x5674b&&_0x5674b[_0x7dabf0(0x144)];}catch(_0x2442df){return![];}}async function areRoomsConnected(_0x2e0659,_0x3153a9,_0x1f2144){const _0x5c7466=a2_0x317dd0;try{const _0x57276f=await _0x2e0659[_0x5c7466(0x15e)](_0x5c7466(0x13f));if(!_0x57276f||!_0x57276f['val'])return!![];const _0xc9af78=JSON[_0x5c7466(0x165)](_0x57276f['val']),{rooms:_0x5373ae,matrix:_0x5362b7}=_0xc9af78;if(!_0x5373ae||!_0x5362b7)return!![];const _0x9a5e25=_0x5373ae[_0x5c7466(0x14f)](_0x3153a9),_0xb93f0f=_0x5373ae[_0x5c7466(0x14f)](_0x1f2144);if(_0x9a5e25===-0x1||_0xb93f0f===-0x1)return!![];const _0x3b6b5a=_0x5362b7[_0x9a5e25][_0xb93f0f]>0x0||_0x5362b7[_0xb93f0f][_0x9a5e25]>0x0;return _0x3b6b5a;}catch(_0x11e7f1){return _0x2e0659[_0x5c7466(0x152)][_0x5c7466(0x161)](_0x5c7466(0x141)+_0x11e7f1['message']),!![];}}async function updateLocation(_0xc18ad7,_0x53efc2){const _0x580f28=a2_0x317dd0;if(!_0x53efc2||_0x53efc2===_0x580f28(0x163))return;if(!await isActive(_0xc18ad7)){resetTimer(_0xc18ad7);return;}if(currentMonitoredRoom&&currentMonitoredRoom!==_0x53efc2){const _0xf46243=await areRoomsConnected(_0xc18ad7,currentMonitoredRoom,_0x53efc2);if(!_0xf46243){const _0x18113d='Ignoriere\x20Bewegung\x20in\x20\x27'+_0x53efc2+_0x580f28(0x13b)+currentMonitoredRoom+'\x27.';_0xc18ad7[_0x580f28(0x152)][_0x580f28(0x14d)]('[DeadMan]\x20'+_0x18113d+_0x580f28(0x157)),await _0xc18ad7[_0x580f28(0x140)](_0x580f28(0x15b),{'val':JSON[_0x580f28(0x148)]({'room':_0x53efc2,'reason':_0x18113d,'timestamp':Date['now']()}),'ack':!![]});return;}resetTimer(_0xc18ad7);}if(!currentMonitoredRoom){await _0xc18ad7[_0x580f28(0x140)](_0x580f28(0x164),{'val':_0x53efc2,'ack':!![]});const _0x3bb965=await loadConfig(_0xc18ad7),_0x3b9d9b=_0x53efc2[_0x580f28(0x13c)]();let _0x545828=_0x3bb965[_0x53efc2]||_0x3bb965[_0x3b9d9b];if(!_0x545828)for(const _0x347579 in DEFAULT_TIMEOUTS){if(_0x3b9d9b[_0x580f28(0x15a)](_0x347579)){_0x545828=DEFAULT_TIMEOUTS[_0x347579];break;}}if(!_0x545828&&_0x3bb965['default'])_0x545828=_0x3bb965['default'];if(!_0x545828)return;currentMonitoredRoom=_0x53efc2,startTimer(_0xc18ad7,_0x545828);}}function a2_0x525a(){const _0x341a59=['(((.+)+)+)+$','warn','1748QHqlgK','Unknown','analysis.safety.deadMan.currentRoom','parse','1432brSEEE','\x27.\x20Nicht\x20verbunden\x20mit\x20Ã¼berwachtem\x20\x27','toLowerCase','error','3331830kMreak','analysis.topology.structure','setStateAsync','[DeadMan]\x20Topology\x20check\x20failed:\x20','2958DhtITd','[DeadMan]\x20','val','ðŸ‘¼\x20Schutzengel-Frage:\x20','7624422fxmjKA','2TICGhF','stringify','analysis.safety.deadMan.alarmState','ðŸš¨\x20NOTFALL-ALARM:\x20Person\x20reagiert\x20nicht\x20in\x20','23229767AitNrz','215025xpUJrG','info','sendNotification','indexOf','465462zRMOoX','now','log','analysis.safety.deadMan.active','â³\x20ACHTUNG:\x20UngewÃ¶hnlich\x20lange\x20InaktivitÃ¤t\x20in\x20','apply','\x20Min.','\x20(Multi-Person\x20Filter)','45SZbjzZ','34433eMVMlf','includes','analysis.safety.deadMan.lastIgnored','./setup','search','getStateAsync','toString'];a2_0x525a=function(){return _0x341a59;};return a2_0x525a();}function startTimer(_0x518ab5,_0x2ba0ae){const _0x5087a3=a2_0x317dd0;if(activeTimer)clearTimeout(activeTimer);timeoutMs=_0x2ba0ae*0x3c*0x3e8,startTime=Date[_0x5087a3(0x151)](),alarmStage=0x0,_0x518ab5[_0x5087a3(0x152)][_0x5087a3(0x14d)]('ðŸ‘¼\x20Schutzengel:\x20Ãœberwache\x20'+currentMonitoredRoom+'\x20fÃ¼r\x20'+_0x2ba0ae+_0x5087a3(0x156)),_0x518ab5[_0x5087a3(0x140)](_0x5087a3(0x149),{'val':'ok','ack':!![]}),activeTimer=setTimeout(()=>triggerPreWarn(_0x518ab5),timeoutMs);}function resetTimer(_0x14e1d7){const _0x2e2941=a2_0x317dd0;if(activeTimer)clearTimeout(activeTimer);activeTimer=null,currentMonitoredRoom=null,alarmStage=0x0,_0x14e1d7[_0x2e2941(0x140)](_0x2e2941(0x149),{'val':'ok','ack':!![]});}async function triggerPreWarn(_0x47112e){const _0x22e7c3=a2_0x317dd0;alarmStage=0x1,await _0x47112e[_0x22e7c3(0x140)](_0x22e7c3(0x149),{'val':'pre_warn','ack':!![]});const _0x2c6c79=_0x22e7c3(0x154)+currentMonitoredRoom+'.\x20Alles\x20in\x20Ordnung?';_0x47112e[_0x22e7c3(0x152)][_0x22e7c3(0x161)](_0x22e7c3(0x143)+_0x2c6c79),await setup[_0x22e7c3(0x14e)](_0x47112e,_0x22e7c3(0x145)+_0x2c6c79),activeTimer=setTimeout(()=>triggerAlarm(_0x47112e),0x5*0x3c*0x3e8);}async function triggerAlarm(_0x18592e){const _0x1427b2=a2_0x317dd0;alarmStage=0x2,await _0x18592e['setStateAsync'](_0x1427b2(0x149),{'val':'alarm','ack':!![]});const _0xfc9bb0=_0x1427b2(0x14a)+currentMonitoredRoom+'!';_0x18592e[_0x1427b2(0x152)][_0x1427b2(0x13d)](_0x1427b2(0x143)+_0xfc9bb0),await setup['sendNotification'](_0x18592e,_0xfc9bb0,![],!![]);}module['exports']={'updateLocation':updateLocation};