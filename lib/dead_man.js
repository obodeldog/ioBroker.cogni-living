function a2_0x15ef(){const _0x1f5008=['exports','965lYexLx','constructor','\x20(Multi-Person\x20Filter)','apply','analysis.topology.structure','val','568uapXku','[DeadMan]\x20Topology\x20check\x20failed:\x20','setStateAsync','warn','ðŸ’¤\x20Smart\x20Sleep\x20erkannt\x20(','\x27.\x20Nicht\x20verbunden\x20mit\x20Ã¼berwachtem\x20\x27','getStateAsync','analysis.safety.deadMan.active','460273NPEQWV','pre_warn','ðŸ‘¼\x20Schutzengel:\x20Ãœberwache\x20','Ignoriere\x20Bewegung\x20in\x20\x27','%).\x20VerlÃ¤ngere\x20Timer\x20fÃ¼r\x20','parse','search','getHours','default','analysis.safety.deadMan.smartSleep','14467608hvEdbm','replace','(((.+)+)+)+$','sendNotification','280ADztiY','\x20um\x2090\x20Min.','analysis.safety.deadMan.config','schlaf','./setup','log','3443755ZicZgL','bed','living','[DeadMan]\x20','wohn','7WjKNaJ','16791pHRqPP','analysis.safety.deadMan.napProbability','toLowerCase','191930kfZaJd','analysis.safety.deadMan.lastIgnored','analysis.safety.deadMan.alarmState','138699ligSEL','includes','â³\x20ACHTUNG:\x20UngewÃ¶hnlich\x20lange\x20InaktivitÃ¤t\x20in\x20','indexOf','30UdtQdu','ðŸš¨\x20NOTFALL-ALARM:\x20Person\x20reagiert\x20nicht\x20in\x20','toString','info','Unknown','stringify','message','18678CDiPYJ','toFixed'];a2_0x15ef=function(){return _0x1f5008;};return a2_0x15ef();}const a2_0x2ee920=a2_0x3e82;(function(_0x11caf6,_0x14ee45){const _0xd074b3=a2_0x3e82,_0x27ed5b=_0x11caf6();while(!![]){try{const _0x344ae1=parseInt(_0xd074b3(0x95))/0x1*(-parseInt(_0xd074b3(0x99))/0x2)+parseInt(_0xd074b3(0x96))/0x3*(-parseInt(_0xd074b3(0x74))/0x4)+-parseInt(_0xd074b3(0x6e))/0x5*(-parseInt(_0xd074b3(0x6b))/0x6)+parseInt(_0xd074b3(0x90))/0x7+parseInt(_0xd074b3(0x8a))/0x8*(-parseInt(_0xd074b3(0x9c))/0x9)+-parseInt(_0xd074b3(0x64))/0xa*(-parseInt(_0xd074b3(0x7c))/0xb)+parseInt(_0xd074b3(0x86))/0xc;if(_0x344ae1===_0x14ee45)break;else _0x27ed5b['push'](_0x27ed5b['shift']());}catch(_0xc8b3df){_0x27ed5b['push'](_0x27ed5b['shift']());}}}(a2_0x15ef,0x660e7));function a2_0x3e82(_0x2e1e02,_0x28bbbf){const _0x2ee7d8=a2_0x15ef();return a2_0x3e82=function(_0x5ada43,_0x26d5c3){_0x5ada43=_0x5ada43-0x64;let _0x15ef0a=_0x2ee7d8[_0x5ada43];return _0x15ef0a;},a2_0x3e82(_0x2e1e02,_0x28bbbf);}const a2_0x26d5c3=(function(){let _0x9ab94b=!![];return function(_0x5d64ab,_0x1f7443){const _0x4c6235=_0x9ab94b?function(){const _0x12d80a=a2_0x3e82;if(_0x1f7443){const _0x45fd17=_0x1f7443[_0x12d80a(0x71)](_0x5d64ab,arguments);return _0x1f7443=null,_0x45fd17;}}:function(){};return _0x9ab94b=![],_0x4c6235;};}()),a2_0x5ada43=a2_0x26d5c3(this,function(){const _0x5de455=a2_0x3e82;return a2_0x5ada43['toString']()[_0x5de455(0x82)](_0x5de455(0x88))[_0x5de455(0x66)]()[_0x5de455(0x6f)](a2_0x5ada43)[_0x5de455(0x82)](_0x5de455(0x88));});a2_0x5ada43();'use strict';const setup=require(a2_0x2ee920(0x8e));let activeTimer=null,currentMonitoredRoom=null,timeoutMs=0x0,startTime=0x0,alarmStage=0x0;const DEFAULT_TIMEOUTS={'bad':0x2d,'bath':0x2d,'toilet':0x1e,'wc':0x1e,'keller':0x3c,'schlaf':0x78,'bed':0x78,'guest':0x5a,'gast':0x5a};function getTimeoutRobust(_0x20e062,_0x50fbac){const _0x26804=a2_0x2ee920;if(!_0x20e062||!_0x50fbac)return undefined;if(_0x20e062[_0x50fbac])return _0x20e062[_0x50fbac];const _0x5760ae=_0x50fbac['toLowerCase']()['replace'](/[^a-z0-9]/g,'');for(const _0x3e1b39 in _0x20e062){const _0x2a8180=_0x3e1b39['toLowerCase']()[_0x26804(0x87)](/[^a-z0-9]/g,'');if(_0x2a8180===_0x5760ae)return _0x20e062[_0x3e1b39];}const _0x2fa9fa=_0x50fbac[_0x26804(0x98)]();if(_0x20e062[_0x2fa9fa])return _0x20e062[_0x2fa9fa];return undefined;}async function loadConfig(_0x286664){const _0x4af080=a2_0x2ee920;try{const _0x461e36=await _0x286664[_0x4af080(0x7a)](_0x4af080(0x8c));if(_0x461e36&&_0x461e36[_0x4af080(0x73)])return JSON['parse'](_0x461e36[_0x4af080(0x73)]);}catch(_0x31ad2f){}return{};}async function isActive(_0x598e4e){const _0x8a3c21=a2_0x2ee920;try{const _0x5ac015=await _0x598e4e[_0x8a3c21(0x7a)](_0x8a3c21(0x7b));return _0x5ac015&&_0x5ac015['val'];}catch(_0x269661){return![];}}async function areRoomsConnected(_0x4616f4,_0x5c74d1,_0x462a19){const _0x3def37=a2_0x2ee920;try{const _0x59a605=await _0x4616f4[_0x3def37(0x7a)](_0x3def37(0x72));if(!_0x59a605||!_0x59a605['val'])return!![];const _0x161e93=JSON[_0x3def37(0x81)](_0x59a605[_0x3def37(0x73)]),{rooms:_0x3890c7,matrix:_0x46e31e}=_0x161e93;if(!_0x3890c7||!_0x46e31e)return!![];const _0x2800fc=_0x3890c7[_0x3def37(0x9f)](_0x5c74d1),_0x56a419=_0x3890c7['indexOf'](_0x462a19);if(_0x2800fc===-0x1||_0x56a419===-0x1)return!![];const _0x110d73=_0x46e31e[_0x2800fc][_0x56a419]>0x0||_0x46e31e[_0x56a419][_0x2800fc]>0x0;return _0x110d73;}catch(_0x6e07b0){return _0x4616f4[_0x3def37(0x8f)]['warn'](_0x3def37(0x75)+_0x6e07b0[_0x3def37(0x6a)]),!![];}}function calculateSleepProbability(_0x37c2ee){const _0x3123fd=a2_0x2ee920,_0x4d9734=new Date(),_0x4424e1=_0x4d9734[_0x3123fd(0x83)](),_0x4ca9e5=_0x37c2ee[_0x3123fd(0x98)]();let _0x45624f=0.1;if(_0x4424e1>=0x17||_0x4424e1<=0x6)_0x45624f=0x1;else{if(_0x4424e1>=0xd&&_0x4424e1<=0xf)_0x45624f=0.8;else{if(_0x4424e1>=0x14&&_0x4424e1<=0x17)_0x45624f=0.4;}}let _0x59551d=0.1;if(_0x4ca9e5[_0x3123fd(0x9d)](_0x3123fd(0x8d))||_0x4ca9e5[_0x3123fd(0x9d)](_0x3123fd(0x91)))_0x59551d=0x1;else{if(_0x4ca9e5[_0x3123fd(0x9d)](_0x3123fd(0x94))||_0x4ca9e5['includes'](_0x3123fd(0x92))||_0x4ca9e5[_0x3123fd(0x9d)]('sofa'))_0x59551d=0.6;else{if(_0x4ca9e5['includes']('bad')||_0x4ca9e5[_0x3123fd(0x9d)]('wc'))_0x59551d=0.05;}}let _0x1ce154=0.5;const _0x259796=_0x59551d*0.5+_0x45624f*0.3+_0x1ce154*0.2;return parseFloat(_0x259796[_0x3123fd(0x6c)](0x2));}async function updateLocation(_0x47c2fc,_0x517975){const _0x2d24db=a2_0x2ee920;if(!_0x517975||_0x517975===_0x2d24db(0x68))return;if(!await isActive(_0x47c2fc)){resetTimer(_0x47c2fc);return;}if(currentMonitoredRoom&&currentMonitoredRoom!==_0x517975){const _0x3b10a4=await areRoomsConnected(_0x47c2fc,currentMonitoredRoom,_0x517975);if(!_0x3b10a4){const _0x403ad9=_0x2d24db(0x7f)+_0x517975+_0x2d24db(0x79)+currentMonitoredRoom+'\x27.';_0x47c2fc[_0x2d24db(0x8f)]['info'](_0x2d24db(0x93)+_0x403ad9+_0x2d24db(0x70)),await _0x47c2fc[_0x2d24db(0x76)](_0x2d24db(0x9a),{'val':JSON[_0x2d24db(0x69)]({'room':_0x517975,'reason':_0x403ad9,'timestamp':Date['now']()}),'ack':!![]});return;}resetTimer(_0x47c2fc);}if(!currentMonitoredRoom){await _0x47c2fc[_0x2d24db(0x76)]('analysis.safety.deadMan.currentRoom',{'val':_0x517975,'ack':!![]});const _0x4c7533=await loadConfig(_0x47c2fc);let _0x3156d8=getTimeoutRobust(_0x4c7533,_0x517975);const _0x83323f=_0x517975['toLowerCase']();if(!_0x3156d8)for(const _0x1dcf2e in DEFAULT_TIMEOUTS){if(_0x83323f[_0x2d24db(0x9d)](_0x1dcf2e)){_0x3156d8=DEFAULT_TIMEOUTS[_0x1dcf2e];break;}}if(!_0x3156d8&&_0x4c7533[_0x2d24db(0x84)])_0x3156d8=_0x4c7533[_0x2d24db(0x84)];if(!_0x3156d8)return;currentMonitoredRoom=_0x517975,startTimer(_0x47c2fc,_0x3156d8,_0x517975);}}function startTimer(_0x1492a3,_0x5b8bf2,_0x202c74){const _0x4f1f42=a2_0x2ee920;if(activeTimer)clearTimeout(activeTimer);timeoutMs=_0x5b8bf2*0x3c*0x3e8,startTime=Date['now'](),alarmStage=0x0;const _0x4c620f=calculateSleepProbability(_0x202c74||currentMonitoredRoom),_0x3cd204=_0x4c620f>0.65;_0x3cd204?(timeoutMs+=0x5a*0x3c*0x3e8,_0x1492a3['log'][_0x4f1f42(0x67)](_0x4f1f42(0x78)+(_0x4c620f*0x64)[_0x4f1f42(0x6c)](0x0)+_0x4f1f42(0x80)+currentMonitoredRoom+_0x4f1f42(0x8b)),_0x1492a3['setStateAsync'](_0x4f1f42(0x85),{'val':!![],'ack':!![]})):_0x1492a3[_0x4f1f42(0x76)](_0x4f1f42(0x85),{'val':![],'ack':!![]}),_0x1492a3[_0x4f1f42(0x76)](_0x4f1f42(0x97),{'val':_0x4c620f,'ack':!![]}),_0x1492a3[_0x4f1f42(0x8f)][_0x4f1f42(0x67)](_0x4f1f42(0x7e)+currentMonitoredRoom+'\x20fÃ¼r\x20'+_0x5b8bf2+'\x20Min.'),_0x1492a3[_0x4f1f42(0x76)](_0x4f1f42(0x9b),{'val':'ok','ack':!![]}),activeTimer=setTimeout(()=>triggerPreWarn(_0x1492a3),timeoutMs);}function resetTimer(_0x2b2fb2){const _0x17c14c=a2_0x2ee920;if(activeTimer)clearTimeout(activeTimer);activeTimer=null,currentMonitoredRoom=null,alarmStage=0x0,_0x2b2fb2[_0x17c14c(0x76)]('analysis.safety.deadMan.alarmState',{'val':'ok','ack':!![]}),_0x2b2fb2[_0x17c14c(0x76)](_0x17c14c(0x85),{'val':![],'ack':!![]}),_0x2b2fb2[_0x17c14c(0x76)](_0x17c14c(0x97),{'val':0x0,'ack':!![]});}async function triggerPreWarn(_0x296ae9){const _0x21c371=a2_0x2ee920;alarmStage=0x1,await _0x296ae9[_0x21c371(0x76)](_0x21c371(0x9b),{'val':_0x21c371(0x7d),'ack':!![]});const _0x56caa0=_0x21c371(0x9e)+currentMonitoredRoom+'.\x20Alles\x20in\x20Ordnung?';_0x296ae9[_0x21c371(0x8f)][_0x21c371(0x77)](_0x21c371(0x93)+_0x56caa0),await setup[_0x21c371(0x89)](_0x296ae9,'ðŸ‘¼\x20Schutzengel-Frage:\x20'+_0x56caa0),activeTimer=setTimeout(()=>triggerAlarm(_0x296ae9),0x5*0x3c*0x3e8);}async function triggerAlarm(_0x19b5f7){const _0x32ad09=a2_0x2ee920;alarmStage=0x2,await _0x19b5f7['setStateAsync'](_0x32ad09(0x9b),{'val':'alarm','ack':!![]});const _0x597342=_0x32ad09(0x65)+currentMonitoredRoom+'!';_0x19b5f7[_0x32ad09(0x8f)]['error'](_0x32ad09(0x93)+_0x597342),await setup[_0x32ad09(0x89)](_0x19b5f7,_0x597342,![],!![]);}module[a2_0x2ee920(0x6d)]={'updateLocation':updateLocation};