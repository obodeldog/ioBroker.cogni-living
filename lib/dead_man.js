const a2_0x3684aa=a2_0x44e0;function a2_0x44e0(_0x2aba6b,_0x2ff8fe){const _0x210cad=a2_0x2420();return a2_0x44e0=function(_0x4c378d,_0x24a99b){_0x4c378d=_0x4c378d-0xef;let _0x2420f3=_0x210cad[_0x4c378d];return _0x2420f3;},a2_0x44e0(_0x2aba6b,_0x2ff8fe);}(function(_0x48e83a,_0x36db60){const _0x535c00=a2_0x44e0,_0x55bccd=_0x48e83a();while(!![]){try{const _0x2f5346=-parseInt(_0x535c00(0x10a))/0x1+parseInt(_0x535c00(0x123))/0x2+-parseInt(_0x535c00(0x110))/0x3*(-parseInt(_0x535c00(0xfe))/0x4)+parseInt(_0x535c00(0x107))/0x5*(parseInt(_0x535c00(0x120))/0x6)+-parseInt(_0x535c00(0x100))/0x7*(parseInt(_0x535c00(0x109))/0x8)+parseInt(_0x535c00(0xf0))/0x9*(-parseInt(_0x535c00(0x11d))/0xa)+parseInt(_0x535c00(0x12a))/0xb*(-parseInt(_0x535c00(0xf4))/0xc);if(_0x2f5346===_0x36db60)break;else _0x55bccd['push'](_0x55bccd['shift']());}catch(_0x3dc6d9){_0x55bccd['push'](_0x55bccd['shift']());}}}(a2_0x2420,0x69bd3));const a2_0x24a99b=(function(){let _0x157de1=!![];return function(_0x471dbc,_0x348338){const _0x64884=_0x157de1?function(){const _0x276aa3=a2_0x44e0;if(_0x348338){const _0x3d021f=_0x348338[_0x276aa3(0x117)](_0x471dbc,arguments);return _0x348338=null,_0x3d021f;}}:function(){};return _0x157de1=![],_0x64884;};}()),a2_0x4c378d=a2_0x24a99b(this,function(){const _0x39fc6c=a2_0x44e0;return a2_0x4c378d['toString']()[_0x39fc6c(0x101)]('(((.+)+)+)+$')[_0x39fc6c(0x125)]()[_0x39fc6c(0xf6)](a2_0x4c378d)[_0x39fc6c(0x101)](_0x39fc6c(0xf1));});a2_0x4c378d();'use strict';const setup=require(a2_0x3684aa(0x11b));let activeTimer=null,currentMonitoredRoom=null,timeoutMs=0x0,startTime=0x0,alarmStage=0x0;const DEFAULT_TIMEOUTS={'bad':0x2d,'bath':0x2d,'toilet':0x1e,'wc':0x1e,'keller':0x3c,'schlaf':0x78,'bed':0x78,'guest':0x5a,'gast':0x5a};function getTimeoutRobust(_0x27fc4c,_0x53be9a){const _0x30a630=a2_0x3684aa;if(!_0x27fc4c||!_0x53be9a)return undefined;if(_0x27fc4c[_0x53be9a])return _0x27fc4c[_0x53be9a];const _0x4e7aca=_0x53be9a[_0x30a630(0x11a)]()[_0x30a630(0x124)](/[^a-z0-9]/g,'');for(const _0x5f5585 in _0x27fc4c){const _0x4ecf7e=_0x5f5585[_0x30a630(0x11a)]()[_0x30a630(0x124)](/[^a-z0-9]/g,'');if(_0x4ecf7e===_0x4e7aca)return _0x27fc4c[_0x5f5585];}const _0x574ea8=_0x53be9a[_0x30a630(0x11a)]();if(_0x27fc4c[_0x574ea8])return _0x27fc4c[_0x574ea8];return undefined;}function a2_0x2420(){const _0x589104=['replace','toString','toFixed','%).\x20VerlÃ¤ngere\x20Timer\x20fÃ¼r\x20','analysis.safety.deadMan.napProbability','sofa','1749tRkNCV','analysis.topology.structure','18YqInCm','(((.+)+)+)+$','includes','Ignoriere\x20Bewegung\x20in\x20\x27','24048wIxRgx','analysis.safety.deadMan.config','constructor','analysis.safety.deadMan.currentRoom','\x20um\x2090\x20Min.','parse','default','â³\x20ACHTUNG:\x20UngewÃ¶hnlich\x20lange\x20InaktivitÃ¤t\x20in\x20','analysis.safety.deadMan.alarmState','ðŸ‘¼\x20Schutzengel-Frage:\x20','1547588vZIkDb','analysis.safety.deadMan.smartSleep','28qabTRE','search','exports','[DeadMan]\x20','pre_warn','\x27.\x20Nicht\x20verbunden\x20mit\x20Ã¼berwachtem\x20\x27','analysis.safety.deadMan.lastIgnored','6260BBjqKa','error','417528esIkOX','264411bGRHgQ','ðŸ’¤\x20Smart\x20Sleep\x20erkannt\x20(','wohn','getStateAsync','sendNotification','bad','3nXIgRm','val','ðŸ‘¼\x20Schutzengel:\x20Ãœberwache\x20','ðŸš¨\x20NOTFALL-ALARM:\x20Person\x20reagiert\x20nicht\x20in\x20','setStateAsync','info','\x20fÃ¼r\x20','apply','alarm','indexOf','toLowerCase','./setup','warn','1786120RrJFQH','schlaf','stringify','1986BhpWiH','log','.\x20Alles\x20in\x20Ordnung?','1561666QaXYIt'];a2_0x2420=function(){return _0x589104;};return a2_0x2420();}async function loadConfig(_0x1e2626){const _0x33e6c2=a2_0x3684aa;try{const _0x389e94=await _0x1e2626[_0x33e6c2(0x10d)](_0x33e6c2(0xf5));if(_0x389e94&&_0x389e94[_0x33e6c2(0x111)])return JSON[_0x33e6c2(0xf9)](_0x389e94[_0x33e6c2(0x111)]);}catch(_0x4cb1f4){}return{};}async function isActive(_0xae3b88){try{const _0x421f4c=await _0xae3b88['getStateAsync']('analysis.safety.deadMan.active');return _0x421f4c&&_0x421f4c['val'];}catch(_0xc89edb){return![];}}async function areRoomsConnected(_0x4fc6cc,_0x214a7b,_0x5446ff){const _0x530761=a2_0x3684aa;try{const _0x260f7d=await _0x4fc6cc['getStateAsync'](_0x530761(0xef));if(!_0x260f7d||!_0x260f7d[_0x530761(0x111)])return!![];const _0x4524df=JSON['parse'](_0x260f7d[_0x530761(0x111)]),{rooms:_0x2aabdf,matrix:_0x5ebab2}=_0x4524df;if(!_0x2aabdf||!_0x5ebab2)return!![];const _0xc92e40=_0x2aabdf[_0x530761(0x119)](_0x214a7b),_0x360806=_0x2aabdf[_0x530761(0x119)](_0x5446ff);if(_0xc92e40===-0x1||_0x360806===-0x1)return!![];const _0x14d7af=_0x5ebab2[_0xc92e40][_0x360806]>0x0||_0x5ebab2[_0x360806][_0xc92e40]>0x0;return _0x14d7af;}catch(_0x59d4db){return _0x4fc6cc['log'][_0x530761(0x11c)]('[DeadMan]\x20Topology\x20check\x20failed:\x20'+_0x59d4db['message']),!![];}}function calculateSleepProbability(_0x59908c){const _0x2ff6b1=a2_0x3684aa,_0x1fc8b0=new Date(),_0xa6b8e0=_0x1fc8b0['getHours'](),_0x493a20=_0x59908c[_0x2ff6b1(0x11a)]();let _0x39d761=0.1;if(_0xa6b8e0>=0x17||_0xa6b8e0<=0x6)_0x39d761=0x1;else{if(_0xa6b8e0>=0xd&&_0xa6b8e0<=0xf)_0x39d761=0.8;else{if(_0xa6b8e0>=0x14&&_0xa6b8e0<=0x17)_0x39d761=0.4;}}let _0x38ad86=0.1;if(_0x493a20[_0x2ff6b1(0xf2)](_0x2ff6b1(0x11e))||_0x493a20['includes']('bed'))_0x38ad86=0x1;else{if(_0x493a20[_0x2ff6b1(0xf2)](_0x2ff6b1(0x10c))||_0x493a20['includes']('living')||_0x493a20['includes'](_0x2ff6b1(0x129)))_0x38ad86=0.6;else{if(_0x493a20[_0x2ff6b1(0xf2)](_0x2ff6b1(0x10f))||_0x493a20['includes']('wc'))_0x38ad86=0.05;}}let _0x309597=0.5;const _0x5eee4d=_0x38ad86*0.5+_0x39d761*0.3+_0x309597*0.2;return parseFloat(_0x5eee4d[_0x2ff6b1(0x126)](0x2));}async function updateLocation(_0x1aca30,_0x482123){const _0x317976=a2_0x3684aa;if(!_0x482123||_0x482123==='Unknown')return;if(!await isActive(_0x1aca30)){resetTimer(_0x1aca30);return;}if(currentMonitoredRoom&&currentMonitoredRoom!==_0x482123){const _0x3806e8=await areRoomsConnected(_0x1aca30,currentMonitoredRoom,_0x482123);if(!_0x3806e8){const _0x24fe27=_0x317976(0xf3)+_0x482123+_0x317976(0x105)+currentMonitoredRoom+'\x27.';_0x1aca30[_0x317976(0x121)][_0x317976(0x115)]('[DeadMan]\x20'+_0x24fe27+'\x20(Multi-Person\x20Filter)'),await _0x1aca30[_0x317976(0x114)](_0x317976(0x106),{'val':JSON[_0x317976(0x11f)]({'room':_0x482123,'reason':_0x24fe27,'timestamp':Date['now']()}),'ack':!![]});return;}resetTimer(_0x1aca30);}if(!currentMonitoredRoom){await _0x1aca30[_0x317976(0x114)](_0x317976(0xf7),{'val':_0x482123,'ack':!![]});const _0x5094b9=await loadConfig(_0x1aca30);let _0x4a9946=getTimeoutRobust(_0x5094b9,_0x482123);const _0x4d63cd=_0x482123[_0x317976(0x11a)]();if(!_0x4a9946)for(const _0x43dc1e in DEFAULT_TIMEOUTS){if(_0x4d63cd[_0x317976(0xf2)](_0x43dc1e)){_0x4a9946=DEFAULT_TIMEOUTS[_0x43dc1e];break;}}if(!_0x4a9946&&_0x5094b9['default'])_0x4a9946=_0x5094b9[_0x317976(0xfa)];if(!_0x4a9946)return;currentMonitoredRoom=_0x482123,startTimer(_0x1aca30,_0x4a9946,_0x482123);}}function startTimer(_0x29d070,_0x5306c7,_0x104fac){const _0x3da265=a2_0x3684aa;if(activeTimer)clearTimeout(activeTimer);timeoutMs=_0x5306c7*0x3c*0x3e8,startTime=Date['now'](),alarmStage=0x0;const _0x7ce9ec=calculateSleepProbability(_0x104fac||currentMonitoredRoom),_0x652b99=_0x7ce9ec>0.65;_0x652b99?(timeoutMs+=0x5a*0x3c*0x3e8,_0x29d070['log'][_0x3da265(0x115)](_0x3da265(0x10b)+(_0x7ce9ec*0x64)['toFixed'](0x0)+_0x3da265(0x127)+currentMonitoredRoom+_0x3da265(0xf8)),_0x29d070[_0x3da265(0x114)](_0x3da265(0xff),{'val':!![],'ack':!![]})):_0x29d070[_0x3da265(0x114)](_0x3da265(0xff),{'val':![],'ack':!![]}),_0x29d070[_0x3da265(0x114)]('analysis.safety.deadMan.napProbability',{'val':_0x7ce9ec,'ack':!![]}),_0x29d070['log']['info'](_0x3da265(0x112)+currentMonitoredRoom+_0x3da265(0x116)+_0x5306c7+'\x20Min.'),_0x29d070[_0x3da265(0x114)]('analysis.safety.deadMan.alarmState',{'val':'ok','ack':!![]}),activeTimer=setTimeout(()=>triggerPreWarn(_0x29d070),timeoutMs);}function resetTimer(_0x30112c){const _0x2cfecf=a2_0x3684aa;if(activeTimer)clearTimeout(activeTimer);activeTimer=null,currentMonitoredRoom=null,alarmStage=0x0,_0x30112c['setStateAsync'](_0x2cfecf(0xfc),{'val':'ok','ack':!![]}),_0x30112c[_0x2cfecf(0x114)](_0x2cfecf(0xff),{'val':![],'ack':!![]}),_0x30112c[_0x2cfecf(0x114)](_0x2cfecf(0x128),{'val':0x0,'ack':!![]});}async function triggerPreWarn(_0x1840d0){const _0x24f6ce=a2_0x3684aa;alarmStage=0x1,await _0x1840d0['setStateAsync'](_0x24f6ce(0xfc),{'val':_0x24f6ce(0x104),'ack':!![]});const _0x389d98=_0x24f6ce(0xfb)+currentMonitoredRoom+_0x24f6ce(0x122);_0x1840d0['log'][_0x24f6ce(0x11c)]('[DeadMan]\x20'+_0x389d98),await setup['sendNotification'](_0x1840d0,_0x24f6ce(0xfd)+_0x389d98),activeTimer=setTimeout(()=>triggerAlarm(_0x1840d0),0x5*0x3c*0x3e8);}async function triggerAlarm(_0x14125d){const _0x23e1b8=a2_0x3684aa;alarmStage=0x2,await _0x14125d[_0x23e1b8(0x114)](_0x23e1b8(0xfc),{'val':_0x23e1b8(0x118),'ack':!![]});const _0x550a7b=_0x23e1b8(0x113)+currentMonitoredRoom+'!';_0x14125d[_0x23e1b8(0x121)][_0x23e1b8(0x108)](_0x23e1b8(0x103)+_0x550a7b),await setup[_0x23e1b8(0x10e)](_0x14125d,_0x550a7b,![],!![]);}module[a2_0x3684aa(0x102)]={'updateLocation':updateLocation};