const a2_0x4b3c97=a2_0x530d;(function(_0x4afe77,_0x32aaa5){const _0x13e7dd=a2_0x530d,_0x2ea097=_0x4afe77();while(!![]){try{const _0x449993=parseInt(_0x13e7dd(0x134))/0x1+parseInt(_0x13e7dd(0x15e))/0x2*(-parseInt(_0x13e7dd(0x14a))/0x3)+parseInt(_0x13e7dd(0x153))/0x4+-parseInt(_0x13e7dd(0x159))/0x5+parseInt(_0x13e7dd(0x146))/0x6+-parseInt(_0x13e7dd(0x15f))/0x7*(-parseInt(_0x13e7dd(0x12c))/0x8)+-parseInt(_0x13e7dd(0x160))/0x9;if(_0x449993===_0x32aaa5)break;else _0x2ea097['push'](_0x2ea097['shift']());}catch(_0x283bfa){_0x2ea097['push'](_0x2ea097['shift']());}}}(a2_0x1038,0x3991f));const a2_0x1e02b1=(function(){let _0x508849=!![];return function(_0x4bb274,_0x2de0b4){const _0x4cf317=_0x508849?function(){if(_0x2de0b4){const _0x2f1cc6=_0x2de0b4['apply'](_0x4bb274,arguments);return _0x2de0b4=null,_0x2f1cc6;}}:function(){};return _0x508849=![],_0x4cf317;};}()),a2_0x17f765=a2_0x1e02b1(this,function(){const _0x363711=a2_0x530d;return a2_0x17f765[_0x363711(0x148)]()[_0x363711(0x13a)]('(((.+)+)+)+$')[_0x363711(0x148)]()[_0x363711(0x137)](a2_0x17f765)[_0x363711(0x13a)](_0x363711(0x154));});a2_0x17f765();'use strict';const setup=require(a2_0x4b3c97(0x151));function a2_0x1038(){const _0x5a2553=['Ignoriere\x20Bewegung\x20in\x20\x27','search','stringify','bed','â³\x20ACHTUNG:\x20UngewÃ¶hnlich\x20lange\x20InaktivitÃ¤t\x20in\x20','default','analysis.safety.deadMan.alarmState','sendNotification','now','sofa','warn','wohn','message','1603392mSeDNT','analysis.safety.deadMan.currentRoom','toString','analysis.safety.deadMan.active','33315JkVmiA','parse','.\x20Alles\x20in\x20Ordnung?','setStateAsync','bad','%).\x20VerlÃ¤ngere\x20Timer\x20fÃ¼r\x20','\x20(Multi-Person\x20Filter)','./setup','analysis.safety.deadMan.napProbability','1530520vUvzzW','(((.+)+)+)+$','\x20fÃ¼r\x20','analysis.safety.deadMan.lastIgnored','val','includes','2173160YRAIus','indexOf','pre_warn','getStateAsync','[DeadMan]\x20','22OwoWio','202951elSrPK','1553589roTbRx','error','ðŸ‘¼\x20Schutzengel:\x20Ãœberwache\x20','replace','80KimCpU','\x20Min.','living','info','analysis.topology.structure','analysis.safety.deadMan.smartSleep','toLowerCase','[DeadMan]\x20Topology\x20check\x20failed:\x20','25423PEzpEY','getHours','Unknown','constructor','log'];a2_0x1038=function(){return _0x5a2553;};return a2_0x1038();}let activeTimer=null,currentMonitoredRoom=null,timeoutMs=0x0,startTime=0x0,alarmStage=0x0;const DEFAULT_TIMEOUTS={'bad':0x2d,'bath':0x2d,'toilet':0x1e,'wc':0x1e,'keller':0x3c,'schlaf':0x78,'bed':0x78,'guest':0x5a,'gast':0x5a};function getTimeoutRobust(_0x109b3b,_0x23a2de){const _0x2f1a68=a2_0x4b3c97;if(!_0x109b3b||!_0x23a2de)return undefined;if(_0x109b3b[_0x23a2de])return _0x109b3b[_0x23a2de];const _0x254b8c=_0x23a2de[_0x2f1a68(0x132)]()[_0x2f1a68(0x12b)](/[^a-z0-9]/g,'');for(const _0x192394 in _0x109b3b){const _0x1116a5=_0x192394[_0x2f1a68(0x132)]()[_0x2f1a68(0x12b)](/[^a-z0-9]/g,'');if(_0x1116a5===_0x254b8c)return _0x109b3b[_0x192394];}const _0x4d6acb=_0x23a2de['toLowerCase']();if(_0x109b3b[_0x4d6acb])return _0x109b3b[_0x4d6acb];return undefined;}async function loadConfig(_0x232dcc){const _0x5f3bc9=a2_0x4b3c97;try{const _0x13adf3=await _0x232dcc['getStateAsync']('analysis.safety.deadMan.config');if(_0x13adf3&&_0x13adf3[_0x5f3bc9(0x157)])return JSON[_0x5f3bc9(0x14b)](_0x13adf3[_0x5f3bc9(0x157)]);}catch(_0x1adc4d){}return{};}async function isActive(_0x48a849){const _0x18be13=a2_0x4b3c97;try{const _0x1c1b62=await _0x48a849[_0x18be13(0x15c)](_0x18be13(0x149));return _0x1c1b62&&_0x1c1b62[_0x18be13(0x157)];}catch(_0x5b98b2){return![];}}async function areRoomsConnected(_0x1886aa,_0x51b35e,_0x57ac00){const _0x3c0246=a2_0x4b3c97;try{const _0xc7fe1=await _0x1886aa[_0x3c0246(0x15c)](_0x3c0246(0x130));if(!_0xc7fe1||!_0xc7fe1[_0x3c0246(0x157)])return!![];const _0x1b2d83=JSON['parse'](_0xc7fe1['val']),{rooms:_0x26e145,matrix:_0x6df884}=_0x1b2d83;if(!_0x26e145||!_0x6df884)return!![];const _0xd3c4e9=_0x26e145[_0x3c0246(0x15a)](_0x51b35e),_0x41d888=_0x26e145[_0x3c0246(0x15a)](_0x57ac00);if(_0xd3c4e9===-0x1||_0x41d888===-0x1)return!![];const _0x46bfc7=_0x6df884[_0xd3c4e9][_0x41d888]>0x0||_0x6df884[_0x41d888][_0xd3c4e9]>0x0;return _0x46bfc7;}catch(_0x474478){return _0x1886aa[_0x3c0246(0x138)][_0x3c0246(0x143)](_0x3c0246(0x133)+_0x474478[_0x3c0246(0x145)]),!![];}}function calculateSleepProbability(_0xa34395){const _0x16257d=a2_0x4b3c97,_0x3b1b74=new Date(),_0x5134d9=_0x3b1b74[_0x16257d(0x135)](),_0xf37fe3=_0xa34395[_0x16257d(0x132)]();let _0x2ed1cf=0.1;if(_0x5134d9>=0x17||_0x5134d9<=0x6)_0x2ed1cf=0x1;else{if(_0x5134d9>=0xd&&_0x5134d9<=0xf)_0x2ed1cf=0.8;else{if(_0x5134d9>=0x14&&_0x5134d9<=0x17)_0x2ed1cf=0.4;}}let _0x2cfd1c=0.1;if(_0xf37fe3[_0x16257d(0x158)]('schlaf')||_0xf37fe3['includes'](_0x16257d(0x13c)))_0x2cfd1c=0x1;else{if(_0xf37fe3[_0x16257d(0x158)](_0x16257d(0x144))||_0xf37fe3[_0x16257d(0x158)](_0x16257d(0x12e))||_0xf37fe3[_0x16257d(0x158)](_0x16257d(0x142)))_0x2cfd1c=0.6;else{if(_0xf37fe3[_0x16257d(0x158)](_0x16257d(0x14e))||_0xf37fe3[_0x16257d(0x158)]('wc'))_0x2cfd1c=0.05;}}let _0x399571=0.5;const _0x20c898=_0x2cfd1c*0.5+_0x2ed1cf*0.3+_0x399571*0.2;return parseFloat(_0x20c898['toFixed'](0x2));}function a2_0x530d(_0x277963,_0xf05c02){const _0x20d656=a2_0x1038();return a2_0x530d=function(_0x17f765,_0x1e02b1){_0x17f765=_0x17f765-0x129;let _0x1038d1=_0x20d656[_0x17f765];return _0x1038d1;},a2_0x530d(_0x277963,_0xf05c02);}async function updateLocation(_0x17c6b8,_0x2af29b){const _0x41a9dd=a2_0x4b3c97;if(!_0x2af29b||_0x2af29b===_0x41a9dd(0x136))return;if(!await isActive(_0x17c6b8)){resetTimer(_0x17c6b8);return;}if(currentMonitoredRoom&&currentMonitoredRoom!==_0x2af29b){const _0x23c3c5=await areRoomsConnected(_0x17c6b8,currentMonitoredRoom,_0x2af29b);if(!_0x23c3c5){const _0x4c1cdb=_0x41a9dd(0x139)+_0x2af29b+'\x27.\x20Nicht\x20verbunden\x20mit\x20Ã¼berwachtem\x20\x27'+currentMonitoredRoom+'\x27.';_0x17c6b8[_0x41a9dd(0x138)]['info'](_0x41a9dd(0x15d)+_0x4c1cdb+_0x41a9dd(0x150)),await _0x17c6b8['setStateAsync'](_0x41a9dd(0x156),{'val':JSON[_0x41a9dd(0x13b)]({'room':_0x2af29b,'reason':_0x4c1cdb,'timestamp':Date[_0x41a9dd(0x141)]()}),'ack':!![]});return;}resetTimer(_0x17c6b8);}if(!currentMonitoredRoom){await _0x17c6b8[_0x41a9dd(0x14d)](_0x41a9dd(0x147),{'val':_0x2af29b,'ack':!![]});const _0x4d8977=await loadConfig(_0x17c6b8);let _0x162733=getTimeoutRobust(_0x4d8977,_0x2af29b);const _0x27d587=_0x2af29b['toLowerCase']();if(!_0x162733)for(const _0x8d3afd in DEFAULT_TIMEOUTS){if(_0x27d587[_0x41a9dd(0x158)](_0x8d3afd)){_0x162733=DEFAULT_TIMEOUTS[_0x8d3afd];break;}}if(!_0x162733&&_0x4d8977[_0x41a9dd(0x13e)])_0x162733=_0x4d8977['default'];if(!_0x162733)return;currentMonitoredRoom=_0x2af29b,startTimer(_0x17c6b8,_0x162733,_0x2af29b);}}function startTimer(_0x3c7a8a,_0xdf9429,_0x39f952){const _0x5db8ab=a2_0x4b3c97;if(activeTimer)clearTimeout(activeTimer);timeoutMs=_0xdf9429*0x3c*0x3e8,startTime=Date[_0x5db8ab(0x141)](),alarmStage=0x0;const _0x181bbb=calculateSleepProbability(_0x39f952||currentMonitoredRoom),_0x3fc4fb=_0x181bbb>0.65;_0x3fc4fb?(timeoutMs+=0x5a*0x3c*0x3e8,_0x3c7a8a['log'][_0x5db8ab(0x12f)]('ðŸ’¤\x20Smart\x20Sleep\x20erkannt\x20('+(_0x181bbb*0x64)['toFixed'](0x0)+_0x5db8ab(0x14f)+currentMonitoredRoom+'\x20um\x2090\x20Min.'),_0x3c7a8a[_0x5db8ab(0x14d)](_0x5db8ab(0x131),{'val':!![],'ack':!![]})):_0x3c7a8a['setStateAsync']('analysis.safety.deadMan.smartSleep',{'val':![],'ack':!![]}),_0x3c7a8a[_0x5db8ab(0x14d)](_0x5db8ab(0x152),{'val':_0x181bbb,'ack':!![]}),_0x3c7a8a['log'][_0x5db8ab(0x12f)](_0x5db8ab(0x12a)+currentMonitoredRoom+_0x5db8ab(0x155)+_0xdf9429+_0x5db8ab(0x12d)),_0x3c7a8a[_0x5db8ab(0x14d)](_0x5db8ab(0x13f),{'val':'ok','ack':!![]}),activeTimer=setTimeout(()=>triggerPreWarn(_0x3c7a8a),timeoutMs);}function resetTimer(_0x353b88){const _0x156fe1=a2_0x4b3c97;if(activeTimer)clearTimeout(activeTimer);activeTimer=null,currentMonitoredRoom=null,alarmStage=0x0,_0x353b88[_0x156fe1(0x14d)](_0x156fe1(0x13f),{'val':'ok','ack':!![]}),_0x353b88['setStateAsync'](_0x156fe1(0x131),{'val':![],'ack':!![]}),_0x353b88[_0x156fe1(0x14d)](_0x156fe1(0x152),{'val':0x0,'ack':!![]});}async function triggerPreWarn(_0x37fcdb){const _0x2d0dbf=a2_0x4b3c97;alarmStage=0x1,await _0x37fcdb['setStateAsync'](_0x2d0dbf(0x13f),{'val':_0x2d0dbf(0x15b),'ack':!![]});const _0x2efc00=_0x2d0dbf(0x13d)+currentMonitoredRoom+_0x2d0dbf(0x14c);_0x37fcdb['log'][_0x2d0dbf(0x143)](_0x2d0dbf(0x15d)+_0x2efc00),await setup[_0x2d0dbf(0x140)](_0x37fcdb,'ðŸ‘¼\x20Schutzengel-Frage:\x20'+_0x2efc00),activeTimer=setTimeout(()=>triggerAlarm(_0x37fcdb),0x5*0x3c*0x3e8);}async function triggerAlarm(_0xc153ef){const _0x8c7cc1=a2_0x4b3c97;alarmStage=0x2,await _0xc153ef[_0x8c7cc1(0x14d)](_0x8c7cc1(0x13f),{'val':'alarm','ack':!![]});const _0x38ead3='ðŸš¨\x20NOTFALL-ALARM:\x20Person\x20reagiert\x20nicht\x20in\x20'+currentMonitoredRoom+'!';_0xc153ef['log'][_0x8c7cc1(0x129)]('[DeadMan]\x20'+_0x38ead3),await setup[_0x8c7cc1(0x140)](_0xc153ef,_0x38ead3,![],!![]);}module['exports']={'updateLocation':updateLocation};