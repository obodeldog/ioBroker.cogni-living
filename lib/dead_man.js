const a2_0x3c368e=a2_0x4c2a;(function(_0x427053,_0x37d6ae){const _0x3c997a=a2_0x4c2a,_0x418da6=_0x427053();while(!![]){try{const _0x3e59f5=parseInt(_0x3c997a(0x1ff))/0x1*(parseInt(_0x3c997a(0x206))/0x2)+parseInt(_0x3c997a(0x219))/0x3+parseInt(_0x3c997a(0x214))/0x4*(-parseInt(_0x3c997a(0x20e))/0x5)+parseInt(_0x3c997a(0x205))/0x6+parseInt(_0x3c997a(0x215))/0x7*(-parseInt(_0x3c997a(0x220))/0x8)+parseInt(_0x3c997a(0x203))/0x9*(parseInt(_0x3c997a(0x201))/0xa)+-parseInt(_0x3c997a(0x20c))/0xb;if(_0x3e59f5===_0x37d6ae)break;else _0x418da6['push'](_0x418da6['shift']());}catch(_0x3b4bde){_0x418da6['push'](_0x418da6['shift']());}}}(a2_0x1bcf,0x285a0));const a2_0x20ee18=(function(){let _0x2d1f49=!![];return function(_0x1d95ee,_0x4e78d9){const _0x24e6c9=_0x2d1f49?function(){const _0x41973d=a2_0x4c2a;if(_0x4e78d9){const _0x526006=_0x4e78d9[_0x41973d(0x21b)](_0x1d95ee,arguments);return _0x4e78d9=null,_0x526006;}}:function(){};return _0x2d1f49=![],_0x24e6c9;};}()),a2_0x129b04=a2_0x20ee18(this,function(){const _0x7b3c31=a2_0x4c2a;return a2_0x129b04[_0x7b3c31(0x20a)]()[_0x7b3c31(0x20d)]('(((.+)+)+)+$')[_0x7b3c31(0x20a)]()['constructor'](a2_0x129b04)[_0x7b3c31(0x20d)](_0x7b3c31(0x1f5));});a2_0x129b04();'use strict';const setup=require(a2_0x3c368e(0x1eb));let activeTimer=null,currentMonitoredRoom=null,timeoutMs=0x0,startTime=0x0,alarmStage=0x0;const DEFAULT_TIMEOUTS={'bad':0x2d,'bath':0x2d,'toilet':0x1e,'wc':0x1e,'keller':0x3c,'schlaf':0x78,'bed':0x78,'guest':0x5a,'gast':0x5a};function getTimeoutRobust(_0x49a904,_0x260e8c){const _0x58e2d6=a2_0x3c368e;if(!_0x49a904||!_0x260e8c)return undefined;if(_0x49a904[_0x260e8c])return _0x49a904[_0x260e8c];const _0x371928=_0x260e8c[_0x58e2d6(0x223)]()['replace'](/[^a-z0-9]/g,'');for(const _0x18d90e in _0x49a904){const _0x5d3388=_0x18d90e[_0x58e2d6(0x223)]()[_0x58e2d6(0x1fe)](/[^a-z0-9]/g,'');if(_0x5d3388===_0x371928)return _0x49a904[_0x18d90e];}const _0x2dbbb8=_0x260e8c[_0x58e2d6(0x223)]();if(_0x49a904[_0x2dbbb8])return _0x49a904[_0x2dbbb8];return undefined;}async function loadConfig(_0x550d21){const _0x548ba6=a2_0x3c368e;try{const _0x1e46b4=await _0x550d21['getStateAsync']('analysis.safety.deadMan.config');if(_0x1e46b4&&_0x1e46b4['val'])return JSON[_0x548ba6(0x226)](_0x1e46b4[_0x548ba6(0x217)]);}catch(_0x31d464){}return{};}function a2_0x4c2a(_0x3dba43,_0x53a7cc){const _0x5c7cf5=a2_0x1bcf();return a2_0x4c2a=function(_0x129b04,_0x20ee18){_0x129b04=_0x129b04-0x1e9;let _0x1bcf92=_0x5c7cf5[_0x129b04];return _0x1bcf92;},a2_0x4c2a(_0x3dba43,_0x53a7cc);}async function isActive(_0x4cb48d){const _0x2d3b8b=a2_0x3c368e;try{const _0x33c082=await _0x4cb48d[_0x2d3b8b(0x209)](_0x2d3b8b(0x225));return _0x33c082&&_0x33c082[_0x2d3b8b(0x217)];}catch(_0x216535){return![];}}function a2_0x1bcf(){const _0x206bee=['toLowerCase','\x27.\x20Nicht\x20verbunden\x20mit\x20Ã¼berwachtem\x20\x27','analysis.safety.deadMan.active','parse','Ignoriere\x20Bewegung\x20in\x20\x27','sendNotification','analysis.safety.deadMan.alarmState','./setup','warn','\x20um\x2090\x20Min.','pre_warn','\x20(Multi-Person\x20Filter)','indexOf','\x20fÃ¼r\x20','log','info','sofa','(((.+)+)+)+$','ðŸ‘¼\x20Schutzengel:\x20Ãœberwache\x20','[DeadMan]\x20','includes','living','toFixed','.\x20Alles\x20in\x20Ordnung?','bed','ðŸš¨\x20NOTFALL-ALARM:\x20Person\x20reagiert\x20nicht\x20in\x20','replace','1pmkYTW','analysis.safety.deadMan.lastIgnored','30PGayIM','ðŸ’¤\x20Smart\x20Sleep\x20erkannt\x20(','590589dKKDnN','error','1136082toVuxx','169118BuUkpP','bad','\x20Min.','getStateAsync','toString','analysis.safety.deadMan.smartSleep','3037100vmJwwR','search','10dhzKXc','analysis.safety.deadMan.currentRoom','analysis.safety.deadMan.napProbability','schlaf','wohn','stringify','392136sAqMXO','2702PalnFK','getHours','val','ðŸ‘¼\x20Schutzengel-Frage:\x20','982923lbLHLz','exports','apply','[DeadMan]\x20Topology\x20check\x20failed:\x20','now','alarm','â³\x20ACHTUNG:\x20UngewÃ¶hnlich\x20lange\x20InaktivitÃ¤t\x20in\x20','3336IgXZtI','default','setStateAsync'];a2_0x1bcf=function(){return _0x206bee;};return a2_0x1bcf();}async function areRoomsConnected(_0x52f1f8,_0x12115a,_0x19235d){const _0x142d2d=a2_0x3c368e;try{const _0x2c02b0=await _0x52f1f8['getStateAsync']('analysis.topology.structure');if(!_0x2c02b0||!_0x2c02b0[_0x142d2d(0x217)])return!![];const _0x14a939=JSON[_0x142d2d(0x226)](_0x2c02b0[_0x142d2d(0x217)]),{rooms:_0x4141aa,matrix:_0x5a50b7}=_0x14a939;if(!_0x4141aa||!_0x5a50b7)return!![];const _0x4f670d=_0x4141aa[_0x142d2d(0x1f0)](_0x12115a),_0x2ead9a=_0x4141aa[_0x142d2d(0x1f0)](_0x19235d);if(_0x4f670d===-0x1||_0x2ead9a===-0x1)return!![];const _0x475e5a=_0x5a50b7[_0x4f670d][_0x2ead9a]>0x0||_0x5a50b7[_0x2ead9a][_0x4f670d]>0x0;return _0x475e5a;}catch(_0x413729){return _0x52f1f8[_0x142d2d(0x1f2)][_0x142d2d(0x1ec)](_0x142d2d(0x21c)+_0x413729['message']),!![];}}function calculateSleepProbability(_0x4c753e){const _0x24bd30=a2_0x3c368e,_0x37fc0f=new Date(),_0x525de1=_0x37fc0f[_0x24bd30(0x216)](),_0x3902f5=_0x4c753e['toLowerCase']();let _0x1df46c=0.1;if(_0x525de1>=0x17||_0x525de1<=0x6)_0x1df46c=0x1;else{if(_0x525de1>=0xd&&_0x525de1<=0xf)_0x1df46c=0.8;else{if(_0x525de1>=0x14&&_0x525de1<=0x17)_0x1df46c=0.4;}}let _0x32a7ed=0.1;if(_0x3902f5[_0x24bd30(0x1f8)](_0x24bd30(0x211))||_0x3902f5[_0x24bd30(0x1f8)](_0x24bd30(0x1fc)))_0x32a7ed=0x1;else{if(_0x3902f5[_0x24bd30(0x1f8)](_0x24bd30(0x212))||_0x3902f5[_0x24bd30(0x1f8)](_0x24bd30(0x1f9))||_0x3902f5[_0x24bd30(0x1f8)](_0x24bd30(0x1f4)))_0x32a7ed=0.6;else{if(_0x3902f5[_0x24bd30(0x1f8)](_0x24bd30(0x207))||_0x3902f5[_0x24bd30(0x1f8)]('wc'))_0x32a7ed=0.05;}}let _0x521a72=0.5;const _0x1fbfbc=_0x32a7ed*0.5+_0x1df46c*0.3+_0x521a72*0.2;return parseFloat(_0x1fbfbc[_0x24bd30(0x1fa)](0x2));}async function updateLocation(_0x280353,_0x326dd7){const _0xb5a2a8=a2_0x3c368e;if(!_0x326dd7||_0x326dd7==='Unknown')return;if(!await isActive(_0x280353)){resetTimer(_0x280353);return;}if(currentMonitoredRoom&&currentMonitoredRoom!==_0x326dd7){const _0x1ff0cb=await areRoomsConnected(_0x280353,currentMonitoredRoom,_0x326dd7);if(!_0x1ff0cb){const _0x29abe1=_0xb5a2a8(0x227)+_0x326dd7+_0xb5a2a8(0x224)+currentMonitoredRoom+'\x27.';_0x280353['log'][_0xb5a2a8(0x1f3)](_0xb5a2a8(0x1f7)+_0x29abe1+_0xb5a2a8(0x1ef)),await _0x280353[_0xb5a2a8(0x222)](_0xb5a2a8(0x200),{'val':JSON[_0xb5a2a8(0x213)]({'room':_0x326dd7,'reason':_0x29abe1,'timestamp':Date[_0xb5a2a8(0x21d)]()}),'ack':!![]});return;}resetTimer(_0x280353);}if(!currentMonitoredRoom){await _0x280353[_0xb5a2a8(0x222)](_0xb5a2a8(0x20f),{'val':_0x326dd7,'ack':!![]});const _0x31c1f2=await loadConfig(_0x280353);let _0xb88acd=getTimeoutRobust(_0x31c1f2,_0x326dd7);const _0x3f70d6=_0x326dd7[_0xb5a2a8(0x223)]();if(!_0xb88acd)for(const _0x4442ee in DEFAULT_TIMEOUTS){if(_0x3f70d6[_0xb5a2a8(0x1f8)](_0x4442ee)){_0xb88acd=DEFAULT_TIMEOUTS[_0x4442ee];break;}}if(!_0xb88acd&&_0x31c1f2[_0xb5a2a8(0x221)])_0xb88acd=_0x31c1f2['default'];if(!_0xb88acd)return;currentMonitoredRoom=_0x326dd7,startTimer(_0x280353,_0xb88acd,_0x326dd7);}}function startTimer(_0x2a54b3,_0x3685c5,_0x28f963){const _0x5b56e3=a2_0x3c368e;if(activeTimer)clearTimeout(activeTimer);timeoutMs=_0x3685c5*0x3c*0x3e8,startTime=Date[_0x5b56e3(0x21d)](),alarmStage=0x0;const _0x171b87=calculateSleepProbability(_0x28f963||currentMonitoredRoom),_0x337c56=_0x171b87>0.65;_0x337c56?(timeoutMs+=0x5a*0x3c*0x3e8,_0x2a54b3[_0x5b56e3(0x1f2)][_0x5b56e3(0x1f3)](_0x5b56e3(0x202)+(_0x171b87*0x64)['toFixed'](0x0)+'%).\x20VerlÃ¤ngere\x20Timer\x20fÃ¼r\x20'+currentMonitoredRoom+_0x5b56e3(0x1ed)),_0x2a54b3['setStateAsync'](_0x5b56e3(0x20b),{'val':!![],'ack':!![]})):_0x2a54b3[_0x5b56e3(0x222)](_0x5b56e3(0x20b),{'val':![],'ack':!![]}),_0x2a54b3[_0x5b56e3(0x222)]('analysis.safety.deadMan.napProbability',{'val':_0x171b87,'ack':!![]}),_0x2a54b3[_0x5b56e3(0x1f2)][_0x5b56e3(0x1f3)](_0x5b56e3(0x1f6)+currentMonitoredRoom+_0x5b56e3(0x1f1)+_0x3685c5+_0x5b56e3(0x208)),_0x2a54b3[_0x5b56e3(0x222)](_0x5b56e3(0x1ea),{'val':'ok','ack':!![]}),activeTimer=setTimeout(()=>triggerPreWarn(_0x2a54b3),timeoutMs);}function resetTimer(_0x2a368b){const _0x3e93e0=a2_0x3c368e;if(activeTimer)clearTimeout(activeTimer);activeTimer=null,currentMonitoredRoom=null,alarmStage=0x0,_0x2a368b['setStateAsync'](_0x3e93e0(0x1ea),{'val':'ok','ack':!![]}),_0x2a368b[_0x3e93e0(0x222)](_0x3e93e0(0x20b),{'val':![],'ack':!![]}),_0x2a368b[_0x3e93e0(0x222)](_0x3e93e0(0x210),{'val':0x0,'ack':!![]});}async function triggerPreWarn(_0x1fd096){const _0x5e12d6=a2_0x3c368e;alarmStage=0x1,await _0x1fd096[_0x5e12d6(0x222)](_0x5e12d6(0x1ea),{'val':_0x5e12d6(0x1ee),'ack':!![]});const _0x25aa6f=_0x5e12d6(0x21f)+currentMonitoredRoom+_0x5e12d6(0x1fb);_0x1fd096[_0x5e12d6(0x1f2)][_0x5e12d6(0x1ec)](_0x5e12d6(0x1f7)+_0x25aa6f),await setup['sendNotification'](_0x1fd096,_0x5e12d6(0x218)+_0x25aa6f),activeTimer=setTimeout(()=>triggerAlarm(_0x1fd096),0x5*0x3c*0x3e8);}async function triggerAlarm(_0x48cd8b){const _0x5c2d70=a2_0x3c368e;alarmStage=0x2,await _0x48cd8b['setStateAsync'](_0x5c2d70(0x1ea),{'val':_0x5c2d70(0x21e),'ack':!![]});const _0x50c464=_0x5c2d70(0x1fd)+currentMonitoredRoom+'!';_0x48cd8b[_0x5c2d70(0x1f2)][_0x5c2d70(0x204)]('[DeadMan]\x20'+_0x50c464),await setup[_0x5c2d70(0x1e9)](_0x48cd8b,_0x50c464,![],!![]);}module[a2_0x3c368e(0x21a)]={'updateLocation':updateLocation};