const a2_0xa1c01=a2_0x2259;(function(_0x50cd17,_0x2c9835){const _0x552248=a2_0x2259,_0x79cbc3=_0x50cd17();while(!![]){try{const _0x3b7ab1=parseInt(_0x552248(0x151))/0x1+-parseInt(_0x552248(0x178))/0x2*(parseInt(_0x552248(0x148))/0x3)+parseInt(_0x552248(0x146))/0x4*(-parseInt(_0x552248(0x177))/0x5)+parseInt(_0x552248(0x157))/0x6*(-parseInt(_0x552248(0x164))/0x7)+parseInt(_0x552248(0x15a))/0x8*(-parseInt(_0x552248(0x142))/0x9)+-parseInt(_0x552248(0x15d))/0xa*(-parseInt(_0x552248(0x143))/0xb)+parseInt(_0x552248(0x163))/0xc*(parseInt(_0x552248(0x171))/0xd);if(_0x3b7ab1===_0x2c9835)break;else _0x79cbc3['push'](_0x79cbc3['shift']());}catch(_0x5cace3){_0x79cbc3['push'](_0x79cbc3['shift']());}}}(a2_0x22f2,0xece66));const a2_0x5bba98=(function(){let _0x30ceca=!![];return function(_0x5428ed,_0x22f9b3){const _0x576904=_0x30ceca?function(){const _0x35bf31=a2_0x2259;if(_0x22f9b3){const _0x4ed705=_0x22f9b3[_0x35bf31(0x153)](_0x5428ed,arguments);return _0x22f9b3=null,_0x4ed705;}}:function(){};return _0x30ceca=![],_0x576904;};}()),a2_0x19cb81=a2_0x5bba98(this,function(){const _0x5cb23b=a2_0x2259;return a2_0x19cb81[_0x5cb23b(0x14d)]()[_0x5cb23b(0x15c)](_0x5cb23b(0x154))[_0x5cb23b(0x14d)]()['constructor'](a2_0x19cb81)[_0x5cb23b(0x15c)](_0x5cb23b(0x154));});a2_0x19cb81();function a2_0x2259(_0x4f0619,_0xbba5b0){const _0x102895=a2_0x22f2();return a2_0x2259=function(_0x19cb81,_0x5bba98){_0x19cb81=_0x19cb81-0x142;let _0x22f2a4=_0x102895[_0x19cb81];return _0x22f2a4;},a2_0x2259(_0x4f0619,_0xbba5b0);}'use strict';const setup=require(a2_0xa1c01(0x166));let activeTimer=null,currentMonitoredRoom=null,timeoutMs=0x0,startTime=0x0,alarmStage=0x0;function a2_0x22f2(){const _0x512a83=['[DeadMan]\x20','ðŸ‘¼\x20Schutzengel-Frage:\x20','getHours','ðŸš¨\x20NOTFALL-ALARM:\x20Person\x20reagiert\x20nicht\x20in\x20','58415HhhrCb','20PtCrhT','val','\x20fÃ¼r\x20','exports','\x20(Multi-Person\x20Filter)','toLowerCase','1008ZgUsjM','19479647joMbJm','analysis.safety.deadMan.lastIgnored','message','448rTScrf','log','310320ZGeKAL','default','sofa','replace','ðŸ‘¼\x20Schutzengel:\x20Ãœberwache\x20','toString','analysis.safety.deadMan.config','setStateAsync','indexOf','54388EilUAR','bed','apply','(((.+)+)+)+$','living','Unknown','843366ZeCYIC','parse','info','93088EldYPp','now','search','10BYYhBk','analysis.safety.deadMan.active','includes','analysis.safety.deadMan.alarmState','Ignoriere\x20Bewegung\x20in\x20\x27','sendNotification','13836hmNZYJ','63DDJuaA','\x27.\x20Nicht\x20verbunden\x20mit\x20Ã¼berwachtem\x20\x27','./setup','â³\x20ACHTUNG:\x20UngewÃ¶hnlich\x20lange\x20InaktivitÃ¤t\x20in\x20','toFixed','alarm','getStateAsync','pre_warn','error','wohn','analysis.safety.deadMan.napProbability','stringify','schlaf','45734NbteYy','analysis.safety.deadMan.smartSleep'];a2_0x22f2=function(){return _0x512a83;};return a2_0x22f2();}const DEFAULT_TIMEOUTS={'bad':0x2d,'bath':0x2d,'toilet':0x1e,'wc':0x1e,'keller':0x3c,'schlaf':0x78,'bed':0x78,'guest':0x5a,'gast':0x5a};function getTimeoutRobust(_0x51c3aa,_0x1a00f8){const _0x3c773f=a2_0xa1c01;if(!_0x51c3aa||!_0x1a00f8)return undefined;if(_0x51c3aa[_0x1a00f8])return _0x51c3aa[_0x1a00f8];const _0x2aeadd=_0x1a00f8[_0x3c773f(0x17d)]()[_0x3c773f(0x14b)](/[^a-z0-9]/g,'');for(const _0x1faa36 in _0x51c3aa){const _0x408b7d=_0x1faa36[_0x3c773f(0x17d)]()[_0x3c773f(0x14b)](/[^a-z0-9]/g,'');if(_0x408b7d===_0x2aeadd)return _0x51c3aa[_0x1faa36];}const _0x169a40=_0x1a00f8['toLowerCase']();if(_0x51c3aa[_0x169a40])return _0x51c3aa[_0x169a40];return undefined;}async function loadConfig(_0x51bdd6){const _0x10b0c7=a2_0xa1c01;try{const _0x3719f8=await _0x51bdd6[_0x10b0c7(0x16a)](_0x10b0c7(0x14e));if(_0x3719f8&&_0x3719f8[_0x10b0c7(0x179)])return JSON[_0x10b0c7(0x158)](_0x3719f8['val']);}catch(_0x1792db){}return{};}async function isActive(_0x1784bb){const _0x753d7=a2_0xa1c01;try{const _0x5d0425=await _0x1784bb[_0x753d7(0x16a)](_0x753d7(0x15e));return _0x5d0425&&_0x5d0425[_0x753d7(0x179)];}catch(_0x444277){return![];}}async function areRoomsConnected(_0x38c497,_0x27082e,_0x15acad){const _0x53336d=a2_0xa1c01;try{const _0x4b47b2=await _0x38c497['getStateAsync']('analysis.topology.structure');if(!_0x4b47b2||!_0x4b47b2[_0x53336d(0x179)])return!![];const _0x3376c6=JSON[_0x53336d(0x158)](_0x4b47b2[_0x53336d(0x179)]),{rooms:_0xa2844e,matrix:_0xafb040}=_0x3376c6;if(!_0xa2844e||!_0xafb040)return!![];const _0x54888f=_0xa2844e[_0x53336d(0x150)](_0x27082e),_0x1987b1=_0xa2844e[_0x53336d(0x150)](_0x15acad);if(_0x54888f===-0x1||_0x1987b1===-0x1)return!![];const _0x20797a=_0xafb040[_0x54888f][_0x1987b1]>0x0||_0xafb040[_0x1987b1][_0x54888f]>0x0;return _0x20797a;}catch(_0x4e8a27){return _0x38c497[_0x53336d(0x147)]['warn']('[DeadMan]\x20Topology\x20check\x20failed:\x20'+_0x4e8a27[_0x53336d(0x145)]),!![];}}function calculateSleepProbability(_0x491a10){const _0xa9bfc0=a2_0xa1c01,_0x513a57=new Date(),_0x4303da=_0x513a57[_0xa9bfc0(0x175)](),_0x18ee2c=_0x491a10[_0xa9bfc0(0x17d)]();let _0x5d4d3d=0.1;if(_0x4303da>=0x17||_0x4303da<=0x6)_0x5d4d3d=0x1;else{if(_0x4303da>=0xd&&_0x4303da<=0xf)_0x5d4d3d=0.8;else{if(_0x4303da>=0x14&&_0x4303da<=0x17)_0x5d4d3d=0.4;}}let _0x1570da=0.1;if(_0x18ee2c[_0xa9bfc0(0x15f)](_0xa9bfc0(0x170))||_0x18ee2c['includes'](_0xa9bfc0(0x152)))_0x1570da=0x1;else{if(_0x18ee2c[_0xa9bfc0(0x15f)](_0xa9bfc0(0x16d))||_0x18ee2c['includes'](_0xa9bfc0(0x155))||_0x18ee2c[_0xa9bfc0(0x15f)](_0xa9bfc0(0x14a)))_0x1570da=0.6;else{if(_0x18ee2c[_0xa9bfc0(0x15f)]('bad')||_0x18ee2c['includes']('wc'))_0x1570da=0.05;}}let _0x27f760=0.5;const _0x19920d=_0x1570da*0.5+_0x5d4d3d*0.3+_0x27f760*0.2;return parseFloat(_0x19920d[_0xa9bfc0(0x168)](0x2));}async function updateLocation(_0x4814bb,_0x1897d1){const _0x2aec18=a2_0xa1c01;if(!_0x1897d1||_0x1897d1===_0x2aec18(0x156))return;if(!await isActive(_0x4814bb)){resetTimer(_0x4814bb);return;}if(currentMonitoredRoom&&currentMonitoredRoom!==_0x1897d1){const _0x391f98=await areRoomsConnected(_0x4814bb,currentMonitoredRoom,_0x1897d1);if(!_0x391f98){const _0x505406=_0x2aec18(0x161)+_0x1897d1+_0x2aec18(0x165)+currentMonitoredRoom+'\x27.';_0x4814bb[_0x2aec18(0x147)][_0x2aec18(0x159)](_0x2aec18(0x173)+_0x505406+_0x2aec18(0x17c)),await _0x4814bb[_0x2aec18(0x14f)](_0x2aec18(0x144),{'val':JSON[_0x2aec18(0x16f)]({'room':_0x1897d1,'reason':_0x505406,'timestamp':Date[_0x2aec18(0x15b)]()}),'ack':!![]});return;}resetTimer(_0x4814bb);}if(!currentMonitoredRoom){await _0x4814bb[_0x2aec18(0x14f)]('analysis.safety.deadMan.currentRoom',{'val':_0x1897d1,'ack':!![]});const _0x13a633=await loadConfig(_0x4814bb);let _0x23b7c9=getTimeoutRobust(_0x13a633,_0x1897d1);const _0x5a8371=_0x1897d1[_0x2aec18(0x17d)]();if(!_0x23b7c9)for(const _0x1c8807 in DEFAULT_TIMEOUTS){if(_0x5a8371[_0x2aec18(0x15f)](_0x1c8807)){_0x23b7c9=DEFAULT_TIMEOUTS[_0x1c8807];break;}}if(!_0x23b7c9&&_0x13a633[_0x2aec18(0x149)])_0x23b7c9=_0x13a633[_0x2aec18(0x149)];if(!_0x23b7c9)return;currentMonitoredRoom=_0x1897d1,startTimer(_0x4814bb,_0x23b7c9,_0x1897d1);}}function startTimer(_0x5764c8,_0x129e37,_0x42d5e8){const _0x4a205e=a2_0xa1c01;if(activeTimer)clearTimeout(activeTimer);timeoutMs=_0x129e37*0x3c*0x3e8,startTime=Date[_0x4a205e(0x15b)](),alarmStage=0x0;const _0x56c421=calculateSleepProbability(_0x42d5e8||currentMonitoredRoom),_0x40ea11=_0x56c421>0.65;_0x40ea11?(timeoutMs+=0x5a*0x3c*0x3e8,_0x5764c8[_0x4a205e(0x147)][_0x4a205e(0x159)]('ðŸ’¤\x20Smart\x20Sleep\x20erkannt\x20('+(_0x56c421*0x64)['toFixed'](0x0)+'%).\x20VerlÃ¤ngere\x20Timer\x20fÃ¼r\x20'+currentMonitoredRoom+'\x20um\x2090\x20Min.'),_0x5764c8[_0x4a205e(0x14f)](_0x4a205e(0x172),{'val':!![],'ack':!![]})):_0x5764c8['setStateAsync'](_0x4a205e(0x172),{'val':![],'ack':!![]}),_0x5764c8[_0x4a205e(0x14f)](_0x4a205e(0x16e),{'val':_0x56c421,'ack':!![]}),_0x5764c8[_0x4a205e(0x147)]['info'](_0x4a205e(0x14c)+currentMonitoredRoom+_0x4a205e(0x17a)+_0x129e37+'\x20Min.'),_0x5764c8[_0x4a205e(0x14f)](_0x4a205e(0x160),{'val':'ok','ack':!![]}),activeTimer=setTimeout(()=>triggerPreWarn(_0x5764c8),timeoutMs);}function resetTimer(_0x55d943){const _0x537bd6=a2_0xa1c01;if(activeTimer)clearTimeout(activeTimer);activeTimer=null,currentMonitoredRoom=null,alarmStage=0x0,_0x55d943[_0x537bd6(0x14f)](_0x537bd6(0x160),{'val':'ok','ack':!![]}),_0x55d943[_0x537bd6(0x14f)](_0x537bd6(0x172),{'val':![],'ack':!![]}),_0x55d943[_0x537bd6(0x14f)](_0x537bd6(0x16e),{'val':0x0,'ack':!![]});}async function triggerPreWarn(_0x28f3e6){const _0x49bd6f=a2_0xa1c01;alarmStage=0x1,await _0x28f3e6[_0x49bd6f(0x14f)](_0x49bd6f(0x160),{'val':_0x49bd6f(0x16b),'ack':!![]});const _0x4a0e3a=_0x49bd6f(0x167)+currentMonitoredRoom+'.\x20Alles\x20in\x20Ordnung?';_0x28f3e6[_0x49bd6f(0x147)]['warn'](_0x49bd6f(0x173)+_0x4a0e3a),await setup[_0x49bd6f(0x162)](_0x28f3e6,_0x49bd6f(0x174)+_0x4a0e3a),activeTimer=setTimeout(()=>triggerAlarm(_0x28f3e6),0x5*0x3c*0x3e8);}async function triggerAlarm(_0x64e768){const _0x5c39f3=a2_0xa1c01;alarmStage=0x2,await _0x64e768[_0x5c39f3(0x14f)]('analysis.safety.deadMan.alarmState',{'val':_0x5c39f3(0x169),'ack':!![]});const _0xc878d2=_0x5c39f3(0x176)+currentMonitoredRoom+'!';_0x64e768[_0x5c39f3(0x147)][_0x5c39f3(0x16c)]('[DeadMan]\x20'+_0xc878d2),await setup[_0x5c39f3(0x162)](_0x64e768,_0xc878d2,![],!![]);}module[a2_0xa1c01(0x17b)]={'updateLocation':updateLocation};