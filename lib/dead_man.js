const a2_0xdf697d=a2_0x5d32;function a2_0x133b(){const _0x152711=['analysis.safety.deadMan.lastIgnored','getHours','now','985630eJwfUN','exports','stringify','pre_warn','Ignoriere\x20Bewegung\x20in\x20\x27','\x20um\x2090\x20Min.','26736060lRrNTa','8GOMfpX','6693075fKLMuC','1593240TdlDzn','living','toLowerCase','analysis.safety.deadMan.config','alarm','1966384gUNQIv','analysis.safety.deadMan.alarmState','[DeadMan]\x20','(((.+)+)+)+$','sendNotification','analysis.topology.structure','toFixed','setStateAsync','parse','ðŸš¨\x20NOTFALL-ALARM:\x20Person\x20reagiert\x20nicht\x20in\x20','analysis.safety.deadMan.currentRoom','indexOf','wohn','log','ðŸ’¤\x20Smart\x20Sleep\x20erkannt\x20(','bad','info','71078uSKdQb','constructor','\x20fÃ¼r\x20','error','6075244rcmGBJ','warn','\x20(Multi-Person\x20Filter)','default','toString','4xoYrHr','analysis.safety.deadMan.napProbability','getStateAsync','analysis.safety.deadMan.smartSleep','val','.\x20Alles\x20in\x20Ordnung?','./setup','includes','analysis.safety.deadMan.active','[DeadMan]\x20Topology\x20check\x20failed:\x20','12FQYNSL'];a2_0x133b=function(){return _0x152711;};return a2_0x133b();}(function(_0x2ce0c3,_0x185d61){const _0x209488=a2_0x5d32,_0x501fe1=_0x2ce0c3();while(!![]){try{const _0x3d6d40=-parseInt(_0x209488(0x17d))/0x1*(parseInt(_0x209488(0x186))/0x2)+parseInt(_0x209488(0x167))/0x3+-parseInt(_0x209488(0x16c))/0x4+parseInt(_0x209488(0x15e))/0x5*(-parseInt(_0x209488(0x15a))/0x6)+-parseInt(_0x209488(0x181))/0x7+parseInt(_0x209488(0x165))/0x8*(-parseInt(_0x209488(0x166))/0x9)+parseInt(_0x209488(0x164))/0xa;if(_0x3d6d40===_0x185d61)break;else _0x501fe1['push'](_0x501fe1['shift']());}catch(_0x41c3ef){_0x501fe1['push'](_0x501fe1['shift']());}}}(a2_0x133b,0x89f7b));const a2_0x1c95bd=(function(){let _0x4b7fa2=!![];return function(_0x2c404e,_0x38851c){const _0x14b842=_0x4b7fa2?function(){if(_0x38851c){const _0x5e33c3=_0x38851c['apply'](_0x2c404e,arguments);return _0x38851c=null,_0x5e33c3;}}:function(){};return _0x4b7fa2=![],_0x14b842;};}()),a2_0x5d3108=a2_0x1c95bd(this,function(){const _0x54ad49=a2_0x5d32;return a2_0x5d3108[_0x54ad49(0x185)]()['search'](_0x54ad49(0x16f))['toString']()[_0x54ad49(0x17e)](a2_0x5d3108)['search'](_0x54ad49(0x16f));});a2_0x5d3108();'use strict';const setup=require(a2_0xdf697d(0x18c));let activeTimer=null,currentMonitoredRoom=null,timeoutMs=0x0,startTime=0x0,alarmStage=0x0;const DEFAULT_TIMEOUTS={'bad':0x2d,'bath':0x2d,'toilet':0x1e,'wc':0x1e,'keller':0x3c,'schlaf':0x78,'bed':0x78,'guest':0x5a,'gast':0x5a};async function loadConfig(_0x1849e2){const _0x4b7c69=a2_0xdf697d;try{const _0x42fc57=await _0x1849e2[_0x4b7c69(0x188)](_0x4b7c69(0x16a));if(_0x42fc57&&_0x42fc57['val'])return JSON[_0x4b7c69(0x174)](_0x42fc57[_0x4b7c69(0x18a)]);}catch(_0x2f6463){}return{};}async function isActive(_0x4de586){const _0x3fbcda=a2_0xdf697d;try{const _0x16e9c4=await _0x4de586[_0x3fbcda(0x188)](_0x3fbcda(0x18e));return _0x16e9c4&&_0x16e9c4['val'];}catch(_0x28cbf4){return![];}}async function areRoomsConnected(_0x18131d,_0x479b72,_0x495a23){const _0x476db9=a2_0xdf697d;try{const _0x4ed9b2=await _0x18131d[_0x476db9(0x188)](_0x476db9(0x171));if(!_0x4ed9b2||!_0x4ed9b2['val'])return!![];const _0x5084eb=JSON['parse'](_0x4ed9b2['val']),{rooms:_0x141f5c,matrix:_0x41aa35}=_0x5084eb;if(!_0x141f5c||!_0x41aa35)return!![];const _0x445706=_0x141f5c[_0x476db9(0x177)](_0x479b72),_0x3003e7=_0x141f5c[_0x476db9(0x177)](_0x495a23);if(_0x445706===-0x1||_0x3003e7===-0x1)return!![];const _0x1ef4ff=_0x41aa35[_0x445706][_0x3003e7]>0x0||_0x41aa35[_0x3003e7][_0x445706]>0x0;return _0x1ef4ff;}catch(_0x120f7a){return _0x18131d[_0x476db9(0x179)]['warn'](_0x476db9(0x18f)+_0x120f7a['message']),!![];}}function calculateSleepProbability(_0x2ec4f7){const _0x23d74f=a2_0xdf697d,_0x578001=new Date(),_0xfe2ac2=_0x578001[_0x23d74f(0x15c)](),_0x65af7d=_0x2ec4f7['toLowerCase']();let _0x1c8a1e=0.1;if(_0xfe2ac2>=0x17||_0xfe2ac2<=0x6)_0x1c8a1e=0x1;else{if(_0xfe2ac2>=0xd&&_0xfe2ac2<=0xf)_0x1c8a1e=0.8;else{if(_0xfe2ac2>=0x14&&_0xfe2ac2<=0x17)_0x1c8a1e=0.4;}}let _0x504b67=0.1;if(_0x65af7d[_0x23d74f(0x18d)]('schlaf')||_0x65af7d['includes']('bed'))_0x504b67=0x1;else{if(_0x65af7d[_0x23d74f(0x18d)](_0x23d74f(0x178))||_0x65af7d[_0x23d74f(0x18d)](_0x23d74f(0x168))||_0x65af7d['includes']('sofa'))_0x504b67=0.6;else{if(_0x65af7d[_0x23d74f(0x18d)](_0x23d74f(0x17b))||_0x65af7d[_0x23d74f(0x18d)]('wc'))_0x504b67=0.05;}}let _0x1fe23a=0.5;const _0x313eba=_0x504b67*0.5+_0x1c8a1e*0.3+_0x1fe23a*0.2;return parseFloat(_0x313eba['toFixed'](0x2));}async function updateLocation(_0x654cd4,_0x2daafe){const _0x53298f=a2_0xdf697d;if(!_0x2daafe||_0x2daafe==='Unknown')return;if(!await isActive(_0x654cd4)){resetTimer(_0x654cd4);return;}if(currentMonitoredRoom&&currentMonitoredRoom!==_0x2daafe){const _0x4cf3e2=await areRoomsConnected(_0x654cd4,currentMonitoredRoom,_0x2daafe);if(!_0x4cf3e2){const _0x4a9e03=_0x53298f(0x162)+_0x2daafe+'\x27.\x20Nicht\x20verbunden\x20mit\x20Ã¼berwachtem\x20\x27'+currentMonitoredRoom+'\x27.';_0x654cd4[_0x53298f(0x179)][_0x53298f(0x17c)](_0x53298f(0x16e)+_0x4a9e03+_0x53298f(0x183)),await _0x654cd4[_0x53298f(0x173)](_0x53298f(0x15b),{'val':JSON[_0x53298f(0x160)]({'room':_0x2daafe,'reason':_0x4a9e03,'timestamp':Date[_0x53298f(0x15d)]()}),'ack':!![]});return;}resetTimer(_0x654cd4);}if(!currentMonitoredRoom){await _0x654cd4['setStateAsync'](_0x53298f(0x176),{'val':_0x2daafe,'ack':!![]});const _0x38dc75=await loadConfig(_0x654cd4),_0xd03290=_0x2daafe[_0x53298f(0x169)]();let _0x3bfef3=_0x38dc75[_0x2daafe]||_0x38dc75[_0xd03290];if(!_0x3bfef3)for(const _0x4501c9 in DEFAULT_TIMEOUTS){if(_0xd03290[_0x53298f(0x18d)](_0x4501c9)){_0x3bfef3=DEFAULT_TIMEOUTS[_0x4501c9];break;}}if(!_0x3bfef3&&_0x38dc75[_0x53298f(0x184)])_0x3bfef3=_0x38dc75['default'];if(!_0x3bfef3)return;currentMonitoredRoom=_0x2daafe,startTimer(_0x654cd4,_0x3bfef3,_0x2daafe);}}function startTimer(_0x39042a,_0x53ff41,_0x429f46){const _0x1a69fb=a2_0xdf697d;if(activeTimer)clearTimeout(activeTimer);timeoutMs=_0x53ff41*0x3c*0x3e8,startTime=Date[_0x1a69fb(0x15d)](),alarmStage=0x0;const _0x489aa4=calculateSleepProbability(_0x429f46||currentMonitoredRoom),_0x10236a=_0x489aa4>0.65;_0x10236a?(timeoutMs+=0x5a*0x3c*0x3e8,_0x39042a[_0x1a69fb(0x179)][_0x1a69fb(0x17c)](_0x1a69fb(0x17a)+(_0x489aa4*0x64)[_0x1a69fb(0x172)](0x0)+'%).\x20VerlÃ¤ngere\x20Timer\x20fÃ¼r\x20'+currentMonitoredRoom+_0x1a69fb(0x163)),_0x39042a['setStateAsync'](_0x1a69fb(0x189),{'val':!![],'ack':!![]})):_0x39042a[_0x1a69fb(0x173)]('analysis.safety.deadMan.smartSleep',{'val':![],'ack':!![]}),_0x39042a[_0x1a69fb(0x173)](_0x1a69fb(0x187),{'val':_0x489aa4,'ack':!![]}),_0x39042a[_0x1a69fb(0x179)][_0x1a69fb(0x17c)]('ðŸ‘¼\x20Schutzengel:\x20Ãœberwache\x20'+currentMonitoredRoom+_0x1a69fb(0x17f)+_0x53ff41+'\x20Min.'),_0x39042a['setStateAsync'](_0x1a69fb(0x16d),{'val':'ok','ack':!![]}),activeTimer=setTimeout(()=>triggerPreWarn(_0x39042a),timeoutMs);}function resetTimer(_0x1d8503){const _0x4e6d93=a2_0xdf697d;if(activeTimer)clearTimeout(activeTimer);activeTimer=null,currentMonitoredRoom=null,alarmStage=0x0,_0x1d8503[_0x4e6d93(0x173)](_0x4e6d93(0x16d),{'val':'ok','ack':!![]}),_0x1d8503[_0x4e6d93(0x173)](_0x4e6d93(0x189),{'val':![],'ack':!![]}),_0x1d8503[_0x4e6d93(0x173)](_0x4e6d93(0x187),{'val':0x0,'ack':!![]});}async function triggerPreWarn(_0x18d0bd){const _0x5291e5=a2_0xdf697d;alarmStage=0x1,await _0x18d0bd[_0x5291e5(0x173)]('analysis.safety.deadMan.alarmState',{'val':_0x5291e5(0x161),'ack':!![]});const _0x3bbdd4='â³\x20ACHTUNG:\x20UngewÃ¶hnlich\x20lange\x20InaktivitÃ¤t\x20in\x20'+currentMonitoredRoom+_0x5291e5(0x18b);_0x18d0bd[_0x5291e5(0x179)][_0x5291e5(0x182)](_0x5291e5(0x16e)+_0x3bbdd4),await setup[_0x5291e5(0x170)](_0x18d0bd,'ðŸ‘¼\x20Schutzengel-Frage:\x20'+_0x3bbdd4),activeTimer=setTimeout(()=>triggerAlarm(_0x18d0bd),0x5*0x3c*0x3e8);}function a2_0x5d32(_0x4bbc3e,_0x17180c){const _0xcdec5c=a2_0x133b();return a2_0x5d32=function(_0x5d3108,_0x1c95bd){_0x5d3108=_0x5d3108-0x15a;let _0x133b3a=_0xcdec5c[_0x5d3108];return _0x133b3a;},a2_0x5d32(_0x4bbc3e,_0x17180c);}async function triggerAlarm(_0x56f4d9){const _0x174339=a2_0xdf697d;alarmStage=0x2,await _0x56f4d9[_0x174339(0x173)]('analysis.safety.deadMan.alarmState',{'val':_0x174339(0x16b),'ack':!![]});const _0x4553e8=_0x174339(0x175)+currentMonitoredRoom+'!';_0x56f4d9[_0x174339(0x179)][_0x174339(0x180)](_0x174339(0x16e)+_0x4553e8),await setup[_0x174339(0x170)](_0x56f4d9,_0x4553e8,![],!![]);}module[a2_0xdf697d(0x15f)]={'updateLocation':updateLocation};