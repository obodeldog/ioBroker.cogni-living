const a2_0x3852fc=a2_0x4b93;function a2_0x4b93(_0x38b476,_0x4e3c2f){const _0x4eaeb0=a2_0x1019();return a2_0x4b93=function(_0x574507,_0x5dd81c){_0x574507=_0x574507-0x138;let _0x10196a=_0x4eaeb0[_0x574507];return _0x10196a;},a2_0x4b93(_0x38b476,_0x4e3c2f);}(function(_0x3ec3a5,_0x411034){const _0xf84e6c=a2_0x4b93,_0x4a47b9=_0x3ec3a5();while(!![]){try{const _0x23ba23=-parseInt(_0xf84e6c(0x16f))/0x1*(parseInt(_0xf84e6c(0x14f))/0x2)+-parseInt(_0xf84e6c(0x13f))/0x3*(-parseInt(_0xf84e6c(0x13e))/0x4)+parseInt(_0xf84e6c(0x13b))/0x5+parseInt(_0xf84e6c(0x154))/0x6*(-parseInt(_0xf84e6c(0x168))/0x7)+parseInt(_0xf84e6c(0x139))/0x8+-parseInt(_0xf84e6c(0x147))/0x9+parseInt(_0xf84e6c(0x13a))/0xa;if(_0x23ba23===_0x411034)break;else _0x4a47b9['push'](_0x4a47b9['shift']());}catch(_0x25cac0){_0x4a47b9['push'](_0x4a47b9['shift']());}}}(a2_0x1019,0xecf6a));const a2_0x5dd81c=(function(){let _0x180ff1=!![];return function(_0xfa440e,_0x472eb7){const _0x1f111a=_0x180ff1?function(){const _0x5c426f=a2_0x4b93;if(_0x472eb7){const _0x1e7db6=_0x472eb7[_0x5c426f(0x13c)](_0xfa440e,arguments);return _0x472eb7=null,_0x1e7db6;}}:function(){};return _0x180ff1=![],_0x1f111a;};}()),a2_0x574507=a2_0x5dd81c(this,function(){const _0x1af4d6=a2_0x4b93;return a2_0x574507[_0x1af4d6(0x150)]()[_0x1af4d6(0x14b)](_0x1af4d6(0x16d))[_0x1af4d6(0x150)]()[_0x1af4d6(0x155)](a2_0x574507)['search']('(((.+)+)+)+$');});a2_0x574507();'use strict';const setup=require(a2_0x3852fc(0x143));let activeTimer=null,currentMonitoredRoom=null,timeoutMs=0x0,startTime=0x0,alarmStage=0x0;function a2_0x1019(){const _0x342397=['\x20Min.','stringify','2349326gdOLDu','log','alarm','val','[DeadMan]\x20','(((.+)+)+)+$','%).\x20VerlÃ¤ngere\x20Timer\x20fÃ¼r\x20','1pigFmC','setStateAsync','toFixed','bad','7491736QoUvHQ','8290190ttRcDk','8706605nfEpBN','apply','analysis.safety.deadMan.alarmState','4214024NXUQmj','3LDOyGj','\x20um\x2090\x20Min.','ðŸ‘¼\x20Schutzengel-Frage:\x20','pre_warn','./setup','info','sendNotification','Ignoriere\x20Bewegung\x20in\x20\x27','17308944abrmKz','living','Unknown','getHours','search','warn','bed','analysis.safety.deadMan.napProbability','2661754rwyhuM','toString','schlaf','analysis.safety.deadMan.smartSleep','error','6sBVLQz','constructor','indexOf','analysis.safety.deadMan.active','ðŸ’¤\x20Smart\x20Sleep\x20erkannt\x20(','default','â³\x20ACHTUNG:\x20UngewÃ¶hnlich\x20lange\x20InaktivitÃ¤t\x20in\x20','\x27.\x20Nicht\x20verbunden\x20mit\x20Ã¼berwachtem\x20\x27','message','ðŸš¨\x20NOTFALL-ALARM:\x20Person\x20reagiert\x20nicht\x20in\x20','toLowerCase','analysis.safety.deadMan.config','analysis.safety.deadMan.lastIgnored','.\x20Alles\x20in\x20Ordnung?','includes','exports','parse','ðŸ‘¼\x20Schutzengel:\x20Ãœberwache\x20'];a2_0x1019=function(){return _0x342397;};return a2_0x1019();}const DEFAULT_TIMEOUTS={'bad':0x2d,'bath':0x2d,'toilet':0x1e,'wc':0x1e,'keller':0x3c,'schlaf':0x78,'bed':0x78,'guest':0x5a,'gast':0x5a};async function loadConfig(_0x362264){const _0x7c9ff8=a2_0x3852fc;try{const _0x228086=await _0x362264['getStateAsync'](_0x7c9ff8(0x15f));if(_0x228086&&_0x228086[_0x7c9ff8(0x16b)])return JSON[_0x7c9ff8(0x164)](_0x228086['val']);}catch(_0xcd80a6){}return{};}async function isActive(_0x50ccf2){const _0x4bf3cd=a2_0x3852fc;try{const _0x537551=await _0x50ccf2['getStateAsync'](_0x4bf3cd(0x157));return _0x537551&&_0x537551['val'];}catch(_0x52a54c){return![];}}async function areRoomsConnected(_0x8512a6,_0x2718b2,_0x2065e1){const _0x2a7af9=a2_0x3852fc;try{const _0x1f70c1=await _0x8512a6['getStateAsync']('analysis.topology.structure');if(!_0x1f70c1||!_0x1f70c1[_0x2a7af9(0x16b)])return!![];const _0x3fde28=JSON[_0x2a7af9(0x164)](_0x1f70c1[_0x2a7af9(0x16b)]),{rooms:_0x4e8afc,matrix:_0x50f8d8}=_0x3fde28;if(!_0x4e8afc||!_0x50f8d8)return!![];const _0x7faa85=_0x4e8afc[_0x2a7af9(0x156)](_0x2718b2),_0x573fea=_0x4e8afc[_0x2a7af9(0x156)](_0x2065e1);if(_0x7faa85===-0x1||_0x573fea===-0x1)return!![];const _0x4511ff=_0x50f8d8[_0x7faa85][_0x573fea]>0x0||_0x50f8d8[_0x573fea][_0x7faa85]>0x0;return _0x4511ff;}catch(_0x217dc5){return _0x8512a6[_0x2a7af9(0x169)][_0x2a7af9(0x14c)]('[DeadMan]\x20Topology\x20check\x20failed:\x20'+_0x217dc5[_0x2a7af9(0x15c)]),!![];}}function calculateSleepProbability(_0x29803d){const _0x269296=a2_0x3852fc,_0x257981=new Date(),_0x449675=_0x257981[_0x269296(0x14a)](),_0x4e7d71=_0x29803d[_0x269296(0x15e)]();let _0x2cb9be=0.1;if(_0x449675>=0x17||_0x449675<=0x6)_0x2cb9be=0x1;else{if(_0x449675>=0xd&&_0x449675<=0xf)_0x2cb9be=0.8;else{if(_0x449675>=0x14&&_0x449675<=0x17)_0x2cb9be=0.4;}}let _0x3f50ba=0.1;if(_0x4e7d71[_0x269296(0x162)](_0x269296(0x151))||_0x4e7d71['includes'](_0x269296(0x14d)))_0x3f50ba=0x1;else{if(_0x4e7d71['includes']('wohn')||_0x4e7d71[_0x269296(0x162)](_0x269296(0x148))||_0x4e7d71[_0x269296(0x162)]('sofa'))_0x3f50ba=0.6;else{if(_0x4e7d71[_0x269296(0x162)](_0x269296(0x138))||_0x4e7d71['includes']('wc'))_0x3f50ba=0.05;}}let _0x3b360e=0.5;const _0xdab046=_0x3f50ba*0.5+_0x2cb9be*0.3+_0x3b360e*0.2;return parseFloat(_0xdab046['toFixed'](0x2));}async function updateLocation(_0x523c78,_0xe5fd19){const _0xc59af8=a2_0x3852fc;if(!_0xe5fd19||_0xe5fd19===_0xc59af8(0x149))return;if(!await isActive(_0x523c78)){resetTimer(_0x523c78);return;}if(currentMonitoredRoom&&currentMonitoredRoom!==_0xe5fd19){const _0x49cb39=await areRoomsConnected(_0x523c78,currentMonitoredRoom,_0xe5fd19);if(!_0x49cb39){const _0x52a9d0=_0xc59af8(0x146)+_0xe5fd19+_0xc59af8(0x15b)+currentMonitoredRoom+'\x27.';_0x523c78[_0xc59af8(0x169)][_0xc59af8(0x144)](_0xc59af8(0x16c)+_0x52a9d0+'\x20(Multi-Person\x20Filter)'),await _0x523c78[_0xc59af8(0x170)](_0xc59af8(0x160),{'val':JSON[_0xc59af8(0x167)]({'room':_0xe5fd19,'reason':_0x52a9d0,'timestamp':Date['now']()}),'ack':!![]});return;}resetTimer(_0x523c78);}if(!currentMonitoredRoom){await _0x523c78[_0xc59af8(0x170)]('analysis.safety.deadMan.currentRoom',{'val':_0xe5fd19,'ack':!![]});const _0x134c91=await loadConfig(_0x523c78),_0x24161b=_0xe5fd19[_0xc59af8(0x15e)]();let _0x231151=_0x134c91[_0xe5fd19]||_0x134c91[_0x24161b];if(!_0x231151)for(const _0x50363a in DEFAULT_TIMEOUTS){if(_0x24161b['includes'](_0x50363a)){_0x231151=DEFAULT_TIMEOUTS[_0x50363a];break;}}if(!_0x231151&&_0x134c91[_0xc59af8(0x159)])_0x231151=_0x134c91['default'];if(!_0x231151)return;currentMonitoredRoom=_0xe5fd19,startTimer(_0x523c78,_0x231151,_0xe5fd19);}}function startTimer(_0x55e51d,_0x4e10fa,_0x57beec){const _0x2150aa=a2_0x3852fc;if(activeTimer)clearTimeout(activeTimer);timeoutMs=_0x4e10fa*0x3c*0x3e8,startTime=Date['now'](),alarmStage=0x0;const _0x440d69=calculateSleepProbability(_0x57beec||currentMonitoredRoom),_0x57b251=_0x440d69>0.65;_0x57b251?(timeoutMs+=0x5a*0x3c*0x3e8,_0x55e51d[_0x2150aa(0x169)][_0x2150aa(0x144)](_0x2150aa(0x158)+(_0x440d69*0x64)[_0x2150aa(0x171)](0x0)+_0x2150aa(0x16e)+currentMonitoredRoom+_0x2150aa(0x140)),_0x55e51d[_0x2150aa(0x170)]('analysis.safety.deadMan.smartSleep',{'val':!![],'ack':!![]})):_0x55e51d[_0x2150aa(0x170)](_0x2150aa(0x152),{'val':![],'ack':!![]}),_0x55e51d[_0x2150aa(0x170)](_0x2150aa(0x14e),{'val':_0x440d69,'ack':!![]}),_0x55e51d[_0x2150aa(0x169)][_0x2150aa(0x144)](_0x2150aa(0x165)+currentMonitoredRoom+'\x20fÃ¼r\x20'+_0x4e10fa+_0x2150aa(0x166)),_0x55e51d[_0x2150aa(0x170)](_0x2150aa(0x13d),{'val':'ok','ack':!![]}),activeTimer=setTimeout(()=>triggerPreWarn(_0x55e51d),timeoutMs);}function resetTimer(_0x473ab2){const _0x133b63=a2_0x3852fc;if(activeTimer)clearTimeout(activeTimer);activeTimer=null,currentMonitoredRoom=null,alarmStage=0x0,_0x473ab2['setStateAsync'](_0x133b63(0x13d),{'val':'ok','ack':!![]}),_0x473ab2[_0x133b63(0x170)](_0x133b63(0x152),{'val':![],'ack':!![]}),_0x473ab2[_0x133b63(0x170)](_0x133b63(0x14e),{'val':0x0,'ack':!![]});}async function triggerPreWarn(_0x4a49dd){const _0x20eafe=a2_0x3852fc;alarmStage=0x1,await _0x4a49dd[_0x20eafe(0x170)](_0x20eafe(0x13d),{'val':_0x20eafe(0x142),'ack':!![]});const _0x25ac49=_0x20eafe(0x15a)+currentMonitoredRoom+_0x20eafe(0x161);_0x4a49dd['log'][_0x20eafe(0x14c)]('[DeadMan]\x20'+_0x25ac49),await setup['sendNotification'](_0x4a49dd,_0x20eafe(0x141)+_0x25ac49),activeTimer=setTimeout(()=>triggerAlarm(_0x4a49dd),0x5*0x3c*0x3e8);}async function triggerAlarm(_0x9246d4){const _0x13c0e3=a2_0x3852fc;alarmStage=0x2,await _0x9246d4[_0x13c0e3(0x170)](_0x13c0e3(0x13d),{'val':_0x13c0e3(0x16a),'ack':!![]});const _0x5f0387=_0x13c0e3(0x15d)+currentMonitoredRoom+'!';_0x9246d4[_0x13c0e3(0x169)][_0x13c0e3(0x153)](_0x13c0e3(0x16c)+_0x5f0387),await setup[_0x13c0e3(0x145)](_0x9246d4,_0x5f0387,![],!![]);}module[a2_0x3852fc(0x163)]={'updateLocation':updateLocation};