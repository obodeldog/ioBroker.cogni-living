function a2_0x17af(){const _0x17837e=['analysis.safety.deadMan.smartSleep','val','./setup','sendNotification','40064HBEFUW','info','replace','schlaf','indexOf','14ZzCqHF','\x20fÃ¼r\x20','toLowerCase','search','\x20um\x2090\x20Min.','analysis.safety.deadMan.currentRoom','now','living','error','%).\x20VerlÃ¤ngere\x20Timer\x20fÃ¼r\x20','stringify','â³\x20ACHTUNG:\x20UngewÃ¶hnlich\x20lange\x20InaktivitÃ¤t\x20in\x20','ðŸ’¤\x20Smart\x20Sleep\x20erkannt\x20(','getStateAsync','[DeadMan]\x20Topology\x20check\x20failed:\x20','includes','[DeadMan]\x20','bed','analysis.safety.deadMan.napProbability','33968BtBnIR','analysis.safety.deadMan.config','ðŸ‘¼\x20Schutzengel-Frage:\x20','443205eMjdDs','setStateAsync','3763440cfiZBN','2nUIgtk','Unknown','\x20Min.','default','toString','757900EICoZH','Ignoriere\x20Bewegung\x20in\x20\x27','114yIyFED','80239gxYDlT','sofa','710058StiHQw','alarm','\x20(Multi-Person\x20Filter)','log','warn','analysis.safety.deadMan.alarmState','wohn','constructor','toFixed','.\x20Alles\x20in\x20Ordnung?','parse'];a2_0x17af=function(){return _0x17837e;};return a2_0x17af();}const a2_0x3760ee=a2_0x34a8;(function(_0x43611c,_0x316df2){const _0x2f4d16=a2_0x34a8,_0x2d08b6=_0x43611c();while(!![]){try{const _0x4d21d9=-parseInt(_0x2f4d16(0x10e))/0x1*(parseInt(_0x2f4d16(0x106))/0x2)+-parseInt(_0x2f4d16(0x10d))/0x3*(-parseInt(_0x2f4d16(0x100))/0x4)+-parseInt(_0x2f4d16(0x10b))/0x5+parseInt(_0x2f4d16(0x110))/0x6*(-parseInt(_0x2f4d16(0x124))/0x7)+-parseInt(_0x2f4d16(0x11f))/0x8+-parseInt(_0x2f4d16(0x103))/0x9+parseInt(_0x2f4d16(0x105))/0xa;if(_0x4d21d9===_0x316df2)break;else _0x2d08b6['push'](_0x2d08b6['shift']());}catch(_0x543cc1){_0x2d08b6['push'](_0x2d08b6['shift']());}}}(a2_0x17af,0x2b09a));const a2_0x294b79=(function(){let _0x2928b4=!![];return function(_0x70596,_0x3e29cb){const _0x5e826f=_0x2928b4?function(){if(_0x3e29cb){const _0x14fb4a=_0x3e29cb['apply'](_0x70596,arguments);return _0x3e29cb=null,_0x14fb4a;}}:function(){};return _0x2928b4=![],_0x5e826f;};}()),a2_0x275500=a2_0x294b79(this,function(){const _0x5e7918=a2_0x34a8;return a2_0x275500['toString']()['search']('(((.+)+)+)+$')[_0x5e7918(0x10a)]()[_0x5e7918(0x117)](a2_0x275500)[_0x5e7918(0x127)]('(((.+)+)+)+$');});a2_0x275500();'use strict';function a2_0x34a8(_0x503b49,_0x2663d9){const _0x120f17=a2_0x17af();return a2_0x34a8=function(_0x275500,_0x294b79){_0x275500=_0x275500-0xf4;let _0x17afe5=_0x120f17[_0x275500];return _0x17afe5;},a2_0x34a8(_0x503b49,_0x2663d9);}const setup=require(a2_0x3760ee(0x11d));let activeTimer=null,currentMonitoredRoom=null,timeoutMs=0x0,startTime=0x0,alarmStage=0x0;const DEFAULT_TIMEOUTS={'bad':0x2d,'bath':0x2d,'toilet':0x1e,'wc':0x1e,'keller':0x3c,'schlaf':0x78,'bed':0x78,'guest':0x5a,'gast':0x5a};function getTimeoutRobust(_0x5da54f,_0x481dd8){const _0x49ef41=a2_0x3760ee;if(!_0x5da54f||!_0x481dd8)return undefined;if(_0x5da54f[_0x481dd8])return _0x5da54f[_0x481dd8];const _0x37d894=_0x481dd8[_0x49ef41(0x126)]()[_0x49ef41(0x121)](/[^a-z0-9]/g,'');for(const _0x23a0b5 in _0x5da54f){const _0x208e27=_0x23a0b5[_0x49ef41(0x126)]()[_0x49ef41(0x121)](/[^a-z0-9]/g,'');if(_0x208e27===_0x37d894)return _0x5da54f[_0x23a0b5];}const _0x1d5832=_0x481dd8[_0x49ef41(0x126)]();if(_0x5da54f[_0x1d5832])return _0x5da54f[_0x1d5832];return undefined;}async function loadConfig(_0xd615f9){const _0x55c7d6=a2_0x3760ee;try{const _0x38145b=await _0xd615f9[_0x55c7d6(0xfa)](_0x55c7d6(0x101));if(_0x38145b&&_0x38145b['val'])return JSON[_0x55c7d6(0x11a)](_0x38145b[_0x55c7d6(0x11c)]);}catch(_0x43699a){}return{};}async function isActive(_0x59bc45){const _0x3b0bb4=a2_0x3760ee;try{const _0x171649=await _0x59bc45[_0x3b0bb4(0xfa)]('analysis.safety.deadMan.active');return _0x171649&&_0x171649[_0x3b0bb4(0x11c)];}catch(_0x5f4664){return![];}}async function areRoomsConnected(_0x1131c0,_0x94a12a,_0x56452a){const _0x2ba00b=a2_0x3760ee;try{const _0x8d659d=await _0x1131c0[_0x2ba00b(0xfa)]('analysis.topology.structure');if(!_0x8d659d||!_0x8d659d[_0x2ba00b(0x11c)])return!![];const _0x29415a=JSON[_0x2ba00b(0x11a)](_0x8d659d[_0x2ba00b(0x11c)]),{rooms:_0x263b84,matrix:_0x5642f0}=_0x29415a;if(!_0x263b84||!_0x5642f0)return!![];const _0xca8c3f=_0x263b84[_0x2ba00b(0x123)](_0x94a12a),_0x1fc623=_0x263b84['indexOf'](_0x56452a);if(_0xca8c3f===-0x1||_0x1fc623===-0x1)return!![];const _0xd95bde=_0x5642f0[_0xca8c3f][_0x1fc623]>0x0||_0x5642f0[_0x1fc623][_0xca8c3f]>0x0;return _0xd95bde;}catch(_0x1b487a){return _0x1131c0[_0x2ba00b(0x113)][_0x2ba00b(0x114)](_0x2ba00b(0xfb)+_0x1b487a['message']),!![];}}function calculateSleepProbability(_0x5d6a72){const _0x2aa34b=a2_0x3760ee,_0xba605a=new Date(),_0x330a41=_0xba605a['getHours'](),_0x5f5a02=_0x5d6a72['toLowerCase']();let _0x4b7d67=0.1;if(_0x330a41>=0x17||_0x330a41<=0x6)_0x4b7d67=0x1;else{if(_0x330a41>=0xd&&_0x330a41<=0xf)_0x4b7d67=0.8;else{if(_0x330a41>=0x14&&_0x330a41<=0x17)_0x4b7d67=0.4;}}let _0x48af48=0.1;if(_0x5f5a02[_0x2aa34b(0xfc)](_0x2aa34b(0x122))||_0x5f5a02['includes'](_0x2aa34b(0xfe)))_0x48af48=0x1;else{if(_0x5f5a02[_0x2aa34b(0xfc)](_0x2aa34b(0x116))||_0x5f5a02[_0x2aa34b(0xfc)](_0x2aa34b(0xf4))||_0x5f5a02[_0x2aa34b(0xfc)](_0x2aa34b(0x10f)))_0x48af48=0.6;else{if(_0x5f5a02['includes']('bad')||_0x5f5a02[_0x2aa34b(0xfc)]('wc'))_0x48af48=0.05;}}let _0x368c29=0.5;const _0x2f6063=_0x48af48*0.5+_0x4b7d67*0.3+_0x368c29*0.2;return parseFloat(_0x2f6063[_0x2aa34b(0x118)](0x2));}async function updateLocation(_0x48a495,_0x4bdc98){const _0x5b5ce8=a2_0x3760ee;if(!_0x4bdc98||_0x4bdc98===_0x5b5ce8(0x107))return;if(!await isActive(_0x48a495)){resetTimer(_0x48a495);return;}if(currentMonitoredRoom&&currentMonitoredRoom!==_0x4bdc98){const _0x3f6df2=await areRoomsConnected(_0x48a495,currentMonitoredRoom,_0x4bdc98);if(!_0x3f6df2){const _0x472cec=_0x5b5ce8(0x10c)+_0x4bdc98+'\x27.\x20Nicht\x20verbunden\x20mit\x20Ã¼berwachtem\x20\x27'+currentMonitoredRoom+'\x27.';_0x48a495[_0x5b5ce8(0x113)]['info'](_0x5b5ce8(0xfd)+_0x472cec+_0x5b5ce8(0x112)),await _0x48a495['setStateAsync']('analysis.safety.deadMan.lastIgnored',{'val':JSON[_0x5b5ce8(0xf7)]({'room':_0x4bdc98,'reason':_0x472cec,'timestamp':Date[_0x5b5ce8(0x12a)]()}),'ack':!![]});return;}resetTimer(_0x48a495);}if(!currentMonitoredRoom){await _0x48a495['setStateAsync'](_0x5b5ce8(0x129),{'val':_0x4bdc98,'ack':!![]});const _0x15be85=await loadConfig(_0x48a495);let _0x4896e1=getTimeoutRobust(_0x15be85,_0x4bdc98);const _0x5084fc=_0x4bdc98[_0x5b5ce8(0x126)]();if(!_0x4896e1)for(const _0x48b3ff in DEFAULT_TIMEOUTS){if(_0x5084fc[_0x5b5ce8(0xfc)](_0x48b3ff)){_0x4896e1=DEFAULT_TIMEOUTS[_0x48b3ff];break;}}if(!_0x4896e1&&_0x15be85[_0x5b5ce8(0x109)])_0x4896e1=_0x15be85[_0x5b5ce8(0x109)];if(!_0x4896e1)return;currentMonitoredRoom=_0x4bdc98,startTimer(_0x48a495,_0x4896e1,_0x4bdc98);}}function startTimer(_0x29adab,_0x5de5d9,_0x46133f){const _0xc35a87=a2_0x3760ee;if(activeTimer)clearTimeout(activeTimer);timeoutMs=_0x5de5d9*0x3c*0x3e8,startTime=Date['now'](),alarmStage=0x0;const _0x5bec2f=calculateSleepProbability(_0x46133f||currentMonitoredRoom),_0x1fc0e6=_0x5bec2f>0.65;_0x1fc0e6?(timeoutMs+=0x5a*0x3c*0x3e8,_0x29adab[_0xc35a87(0x113)][_0xc35a87(0x120)](_0xc35a87(0xf9)+(_0x5bec2f*0x64)[_0xc35a87(0x118)](0x0)+_0xc35a87(0xf6)+currentMonitoredRoom+_0xc35a87(0x128)),_0x29adab[_0xc35a87(0x104)](_0xc35a87(0x11b),{'val':!![],'ack':!![]})):_0x29adab[_0xc35a87(0x104)]('analysis.safety.deadMan.smartSleep',{'val':![],'ack':!![]}),_0x29adab[_0xc35a87(0x104)](_0xc35a87(0xff),{'val':_0x5bec2f,'ack':!![]}),_0x29adab[_0xc35a87(0x113)][_0xc35a87(0x120)]('ðŸ‘¼\x20Schutzengel:\x20Ãœberwache\x20'+currentMonitoredRoom+_0xc35a87(0x125)+_0x5de5d9+_0xc35a87(0x108)),_0x29adab['setStateAsync']('analysis.safety.deadMan.alarmState',{'val':'ok','ack':!![]}),activeTimer=setTimeout(()=>triggerPreWarn(_0x29adab),timeoutMs);}function resetTimer(_0x127d92){const _0x292cc5=a2_0x3760ee;if(activeTimer)clearTimeout(activeTimer);activeTimer=null,currentMonitoredRoom=null,alarmStage=0x0,_0x127d92[_0x292cc5(0x104)](_0x292cc5(0x115),{'val':'ok','ack':!![]}),_0x127d92[_0x292cc5(0x104)]('analysis.safety.deadMan.smartSleep',{'val':![],'ack':!![]}),_0x127d92['setStateAsync'](_0x292cc5(0xff),{'val':0x0,'ack':!![]});}async function triggerPreWarn(_0x2b3853){const _0x585433=a2_0x3760ee;alarmStage=0x1,await _0x2b3853[_0x585433(0x104)](_0x585433(0x115),{'val':'pre_warn','ack':!![]});const _0x81552b=_0x585433(0xf8)+currentMonitoredRoom+_0x585433(0x119);_0x2b3853['log']['warn'](_0x585433(0xfd)+_0x81552b),await setup[_0x585433(0x11e)](_0x2b3853,_0x585433(0x102)+_0x81552b),activeTimer=setTimeout(()=>triggerAlarm(_0x2b3853),0x5*0x3c*0x3e8);}async function triggerAlarm(_0x18f463){const _0x37c084=a2_0x3760ee;alarmStage=0x2,await _0x18f463[_0x37c084(0x104)](_0x37c084(0x115),{'val':_0x37c084(0x111),'ack':!![]});const _0x3a57f9='ðŸš¨\x20NOTFALL-ALARM:\x20Person\x20reagiert\x20nicht\x20in\x20'+currentMonitoredRoom+'!';_0x18f463[_0x37c084(0x113)][_0x37c084(0xf5)]('[DeadMan]\x20'+_0x3a57f9),await setup[_0x37c084(0x11e)](_0x18f463,_0x3a57f9,![],!![]);}module['exports']={'updateLocation':updateLocation};