const a2_0x20d8fa=a2_0x168d;(function(_0x2fffd3,_0x31d9fe){const _0xa0d9b5=a2_0x168d,_0x337721=_0x2fffd3();while(!![]){try{const _0x358c25=-parseInt(_0xa0d9b5(0x1ef))/0x1+parseInt(_0xa0d9b5(0x201))/0x2+-parseInt(_0xa0d9b5(0x1f8))/0x3*(-parseInt(_0xa0d9b5(0x1f4))/0x4)+parseInt(_0xa0d9b5(0x1d2))/0x5*(parseInt(_0xa0d9b5(0x1ea))/0x6)+-parseInt(_0xa0d9b5(0x20a))/0x7*(parseInt(_0xa0d9b5(0x1d4))/0x8)+-parseInt(_0xa0d9b5(0x1ee))/0x9+-parseInt(_0xa0d9b5(0x1f3))/0xa;if(_0x358c25===_0x31d9fe)break;else _0x337721['push'](_0x337721['shift']());}catch(_0x1f5b6f){_0x337721['push'](_0x337721['shift']());}}}(a2_0x5537,0xdffd5));const a2_0x2cb95f=(function(){let _0x4a9218=!![];return function(_0x32a9a4,_0x15a70c){const _0x56bc16=_0x4a9218?function(){const _0x432731=a2_0x168d;if(_0x15a70c){const _0x229c8b=_0x15a70c[_0x432731(0x1db)](_0x32a9a4,arguments);return _0x15a70c=null,_0x229c8b;}}:function(){};return _0x4a9218=![],_0x56bc16;};}()),a2_0x2c3721=a2_0x2cb95f(this,function(){const _0xe8bacb=a2_0x168d;return a2_0x2c3721[_0xe8bacb(0x20e)]()['search'](_0xe8bacb(0x20d))['toString']()['constructor'](a2_0x2c3721)[_0xe8bacb(0x1d8)](_0xe8bacb(0x20d));});a2_0x2c3721();'use strict';const setup=require(a2_0x20d8fa(0x1fb));let activeTimer=null,currentMonitoredRoom=null,timeoutMs=0x0,startTime=0x0,alarmStage=0x0;const DEFAULT_TIMEOUTS={'bad':0x2d,'bath':0x2d,'toilet':0x1e,'wc':0x1e,'keller':0x3c,'schlaf':0x78,'bed':0x78,'guest':0x5a,'gast':0x5a};function getTimeoutRobust(_0x15de4c,_0x51b0f2){const _0x31d525=a2_0x20d8fa;if(!_0x15de4c||!_0x51b0f2)return undefined;if(_0x15de4c[_0x51b0f2])return _0x15de4c[_0x51b0f2];const _0x431a8c=_0x51b0f2['toLowerCase']()[_0x31d525(0x206)](/[^a-z0-9]/g,'');for(const _0x25461f in _0x15de4c){const _0x5456bf=_0x25461f['toLowerCase']()[_0x31d525(0x206)](/[^a-z0-9]/g,'');if(_0x5456bf===_0x431a8c)return _0x15de4c[_0x25461f];}const _0x2ab4ce=_0x51b0f2['toLowerCase']();if(_0x15de4c[_0x2ab4ce])return _0x15de4c[_0x2ab4ce];return undefined;}async function loadConfig(_0x160447){const _0x1baf7f=a2_0x20d8fa;try{const _0x1ee0cc=await _0x160447['getStateAsync'](_0x1baf7f(0x1e4));if(_0x1ee0cc&&_0x1ee0cc[_0x1baf7f(0x1d3)])return JSON['parse'](_0x1ee0cc[_0x1baf7f(0x1d3)]);}catch(_0x1289c3){}return{};}async function isActive(_0x2598ac){const _0x381e35=a2_0x20d8fa;try{const _0x5caf7c=await _0x2598ac[_0x381e35(0x1f2)](_0x381e35(0x1f7));return _0x5caf7c&&_0x5caf7c['val'];}catch(_0x227dca){return![];}}async function areRoomsConnected(_0x1cc426,_0x586cc5,_0x39a5a0){const _0x3baede=a2_0x20d8fa;try{const _0x217f1c=await _0x1cc426['getStateAsync']('analysis.topology.structure');if(!_0x217f1c||!_0x217f1c[_0x3baede(0x1d3)])return!![];const _0x3df9b6=JSON['parse'](_0x217f1c[_0x3baede(0x1d3)]),{rooms:_0x41d33f,matrix:_0x4ca866}=_0x3df9b6;if(!_0x41d33f||!_0x4ca866)return!![];const _0x402454=_0x41d33f[_0x3baede(0x1eb)](_0x586cc5),_0x13c232=_0x41d33f[_0x3baede(0x1eb)](_0x39a5a0);if(_0x402454===-0x1||_0x13c232===-0x1)return!![];const _0x5a88fb=_0x4ca866[_0x402454][_0x13c232]>0x0||_0x4ca866[_0x13c232][_0x402454]>0x0;return _0x5a88fb;}catch(_0x4e6bc8){return _0x1cc426[_0x3baede(0x1fe)][_0x3baede(0x1da)](_0x3baede(0x1de)+_0x4e6bc8['message']),!![];}}function calculateSleepProbability(_0x1f34aa){const _0x5b2248=a2_0x20d8fa,_0x5bd5b5=new Date(),_0x1f0518=_0x5bd5b5[_0x5b2248(0x1e3)](),_0x1d3eb1=_0x1f34aa[_0x5b2248(0x1dc)]();let _0x4fd208=0.1;if(_0x1f0518>=0x17||_0x1f0518<=0x6)_0x4fd208=0x1;else{if(_0x1f0518>=0xd&&_0x1f0518<=0xf)_0x4fd208=0.8;else{if(_0x1f0518>=0x14&&_0x1f0518<=0x17)_0x4fd208=0.4;}}let _0x54f1a9=0.1;if(_0x1d3eb1['includes'](_0x5b2248(0x1d5))||_0x1d3eb1[_0x5b2248(0x1f5)](_0x5b2248(0x1ff)))_0x54f1a9=0x1;else{if(_0x1d3eb1[_0x5b2248(0x1f5)](_0x5b2248(0x1e5))||_0x1d3eb1[_0x5b2248(0x1f5)]('living')||_0x1d3eb1[_0x5b2248(0x1f5)](_0x5b2248(0x202)))_0x54f1a9=0.6;else{if(_0x1d3eb1[_0x5b2248(0x1f5)](_0x5b2248(0x1e0))||_0x1d3eb1[_0x5b2248(0x1f5)]('wc'))_0x54f1a9=0.05;}}let _0x445a0d=0.5;const _0x36f90b=_0x54f1a9*0.5+_0x4fd208*0.3+_0x445a0d*0.2;return parseFloat(_0x36f90b[_0x5b2248(0x1f6)](0x2));}async function updateLocation(_0x45fab0,_0x4a907d){const _0x1c8563=a2_0x20d8fa;if(!_0x4a907d||_0x4a907d===_0x1c8563(0x20b))return;if(!await isActive(_0x45fab0)){resetTimer(_0x45fab0);return;}if(currentMonitoredRoom&&currentMonitoredRoom!==_0x4a907d){const _0x4c89e7=await areRoomsConnected(_0x45fab0,currentMonitoredRoom,_0x4a907d);if(!_0x4c89e7){const _0x578793=_0x1c8563(0x1e1)+_0x4a907d+_0x1c8563(0x1fd)+currentMonitoredRoom+'\x27.';_0x45fab0[_0x1c8563(0x1fe)]['info'](_0x1c8563(0x20c)+_0x578793+_0x1c8563(0x1df)),await _0x45fab0[_0x1c8563(0x208)](_0x1c8563(0x207),{'val':JSON['stringify']({'room':_0x4a907d,'reason':_0x578793,'timestamp':Date[_0x1c8563(0x1d6)]()}),'ack':!![]});return;}resetTimer(_0x45fab0);}if(!currentMonitoredRoom){await _0x45fab0[_0x1c8563(0x208)](_0x1c8563(0x1fc),{'val':_0x4a907d,'ack':!![]});const _0x5ec245=await loadConfig(_0x45fab0);let _0xb9a21b=getTimeoutRobust(_0x5ec245,_0x4a907d);const _0xa7b554=_0x4a907d[_0x1c8563(0x1dc)]();if(!_0xb9a21b)for(const _0x59e48b in DEFAULT_TIMEOUTS){if(_0xa7b554[_0x1c8563(0x1f5)](_0x59e48b)){_0xb9a21b=DEFAULT_TIMEOUTS[_0x59e48b];break;}}if(!_0xb9a21b&&_0x5ec245['default'])_0xb9a21b=_0x5ec245[_0x1c8563(0x204)];if(!_0xb9a21b)return;currentMonitoredRoom=_0x4a907d,startTimer(_0x45fab0,_0xb9a21b,_0x4a907d);}}function startTimer(_0x4cf13f,_0x538d27,_0x5d78dc){const _0x3e6613=a2_0x20d8fa;if(activeTimer)clearTimeout(activeTimer);timeoutMs=_0x538d27*0x3c*0x3e8,startTime=Date[_0x3e6613(0x1d6)](),alarmStage=0x0;const _0x5c9047=calculateSleepProbability(_0x5d78dc||currentMonitoredRoom),_0x410a50=_0x5c9047>0.65;_0x410a50?(timeoutMs+=0x5a*0x3c*0x3e8,_0x4cf13f[_0x3e6613(0x1fe)][_0x3e6613(0x20f)](_0x3e6613(0x1f9)+(_0x5c9047*0x64)['toFixed'](0x0)+_0x3e6613(0x1d9)+currentMonitoredRoom+_0x3e6613(0x1ed)),_0x4cf13f['setStateAsync']('analysis.safety.deadMan.smartSleep',{'val':!![],'ack':!![]})):_0x4cf13f[_0x3e6613(0x208)](_0x3e6613(0x1f1),{'val':![],'ack':!![]}),_0x4cf13f[_0x3e6613(0x208)]('analysis.safety.deadMan.napProbability',{'val':_0x5c9047,'ack':!![]}),_0x4cf13f[_0x3e6613(0x1fe)][_0x3e6613(0x20f)](_0x3e6613(0x203)+currentMonitoredRoom+_0x3e6613(0x1fa)+_0x538d27+_0x3e6613(0x1f0)),_0x4cf13f[_0x3e6613(0x208)](_0x3e6613(0x205),{'val':'ok','ack':!![]}),activeTimer=setTimeout(()=>triggerPreWarn(_0x4cf13f),timeoutMs);}function resetTimer(_0x588127){const _0x30215f=a2_0x20d8fa;if(activeTimer)clearTimeout(activeTimer);activeTimer=null,currentMonitoredRoom=null,alarmStage=0x0,_0x588127[_0x30215f(0x208)](_0x30215f(0x205),{'val':'ok','ack':!![]}),_0x588127[_0x30215f(0x208)]('analysis.safety.deadMan.smartSleep',{'val':![],'ack':!![]}),_0x588127[_0x30215f(0x208)](_0x30215f(0x1e8),{'val':0x0,'ack':!![]});}function a2_0x5537(){const _0x46a8e1=['7sdsPsB','Unknown','[DeadMan]\x20','(((.+)+)+)+$','toString','info','15TwCxPw','val','11411408UddiqI','schlaf','now','alarm','search','%).\x20VerlÃ¤ngere\x20Timer\x20fÃ¼r\x20','warn','apply','toLowerCase','pre_warn','[DeadMan]\x20Topology\x20check\x20failed:\x20','\x20(Multi-Person\x20Filter)','bad','Ignoriere\x20Bewegung\x20in\x20\x27','sendNotification','getHours','analysis.safety.deadMan.config','wohn','ðŸ‘¼\x20Schutzengel-Frage:\x20','error','analysis.safety.deadMan.napProbability','â³\x20ACHTUNG:\x20UngewÃ¶hnlich\x20lange\x20InaktivitÃ¤t\x20in\x20','2816454PLHDQi','indexOf','ðŸš¨\x20NOTFALL-ALARM:\x20Person\x20reagiert\x20nicht\x20in\x20','\x20um\x2090\x20Min.','8205111FZwxgX','456703XySPjo','\x20Min.','analysis.safety.deadMan.smartSleep','getStateAsync','12404730wCXcxC','2764BHcExw','includes','toFixed','analysis.safety.deadMan.active','7701cwTwdQ','ðŸ’¤\x20Smart\x20Sleep\x20erkannt\x20(','\x20fÃ¼r\x20','./setup','analysis.safety.deadMan.currentRoom','\x27.\x20Nicht\x20verbunden\x20mit\x20Ã¼berwachtem\x20\x27','log','bed','exports','3541436VfcYYM','sofa','ðŸ‘¼\x20Schutzengel:\x20Ãœberwache\x20','default','analysis.safety.deadMan.alarmState','replace','analysis.safety.deadMan.lastIgnored','setStateAsync','.\x20Alles\x20in\x20Ordnung?'];a2_0x5537=function(){return _0x46a8e1;};return a2_0x5537();}function a2_0x168d(_0x55414d,_0x145b35){const _0xed1d36=a2_0x5537();return a2_0x168d=function(_0x2c3721,_0x2cb95f){_0x2c3721=_0x2c3721-0x1d2;let _0x553715=_0xed1d36[_0x2c3721];return _0x553715;},a2_0x168d(_0x55414d,_0x145b35);}async function triggerPreWarn(_0xc92f2c){const _0xfc68b=a2_0x20d8fa;alarmStage=0x1,await _0xc92f2c[_0xfc68b(0x208)](_0xfc68b(0x205),{'val':_0xfc68b(0x1dd),'ack':!![]});const _0x9de6f3=_0xfc68b(0x1e9)+currentMonitoredRoom+_0xfc68b(0x209);_0xc92f2c[_0xfc68b(0x1fe)][_0xfc68b(0x1da)](_0xfc68b(0x20c)+_0x9de6f3),await setup[_0xfc68b(0x1e2)](_0xc92f2c,_0xfc68b(0x1e6)+_0x9de6f3),activeTimer=setTimeout(()=>triggerAlarm(_0xc92f2c),0x5*0x3c*0x3e8);}async function triggerAlarm(_0x216a42){const _0x1631f6=a2_0x20d8fa;alarmStage=0x2,await _0x216a42[_0x1631f6(0x208)](_0x1631f6(0x205),{'val':_0x1631f6(0x1d7),'ack':!![]});const _0x45b53a=_0x1631f6(0x1ec)+currentMonitoredRoom+'!';_0x216a42[_0x1631f6(0x1fe)][_0x1631f6(0x1e7)](_0x1631f6(0x20c)+_0x45b53a),await setup['sendNotification'](_0x216a42,_0x45b53a,![],!![]);}module[a2_0x20d8fa(0x200)]={'updateLocation':updateLocation};