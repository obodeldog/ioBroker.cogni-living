function a2_0x20ca(){const _0x39b628=['analysis.safety.deadMan.alarmState','36MivTnz','setStateAsync','log','./setup','â³\x20ACHTUNG:\x20UngewÃ¶hnlich\x20lange\x20InaktivitÃ¤t\x20in\x20','sendNotification','val','[DeadMan]\x20Topology\x20check\x20failed:\x20','5284755BBYNBR','apply','now','analysis.safety.deadMan.active','living','analysis.safety.deadMan.lastIgnored','%).\x20VerlÃ¤ngere\x20Timer\x20fÃ¼r\x20','toLowerCase','indexOf','546athwms','pre_warn','analysis.topology.structure','getHours','1149BWFpAX','220qcNIoB','ðŸ’¤\x20Smart\x20Sleep\x20erkannt\x20(','\x20fÃ¼r\x20','info','schlaf','.\x20Alles\x20in\x20Ordnung?','warn','(((.+)+)+)+$','constructor','exports','parse','2778OOkBxK','9159xszDMm','analysis.safety.deadMan.config','Ignoriere\x20Bewegung\x20in\x20\x27','error','\x27.\x20Nicht\x20verbunden\x20mit\x20Ã¼berwachtem\x20\x27','14JsDPvP','[DeadMan]\x20','31350NUzbat','wohn','ðŸ‘¼\x20Schutzengel-Frage:\x20','toString','analysis.safety.deadMan.smartSleep','analysis.safety.deadMan.napProbability','\x20um\x2090\x20Min.','stringify','message','16785492VWAaAM','search','toFixed','2309072oZDrkl','includes','default','replace','bad','1705eBjbIA'];a2_0x20ca=function(){return _0x39b628;};return a2_0x20ca();}const a2_0x1eeec1=a2_0x53db;(function(_0x3c1e0f,_0x52acca){const _0x37d2c4=a2_0x53db,_0x2a6229=_0x3c1e0f();while(!![]){try{const _0x23f5b6=parseInt(_0x37d2c4(0xbe))/0x1*(parseInt(_0x37d2c4(0xba))/0x2)+-parseInt(_0x37d2c4(0x8f))/0x3*(parseInt(_0x37d2c4(0xa9))/0x4)+-parseInt(_0x37d2c4(0xa7))/0x5*(parseInt(_0x37d2c4(0x8e))/0x6)+-parseInt(_0x37d2c4(0x94))/0x7*(parseInt(_0x37d2c4(0xa2))/0x8)+-parseInt(_0x37d2c4(0xb1))/0x9+-parseInt(_0x37d2c4(0xbf))/0xa*(parseInt(_0x37d2c4(0x96))/0xb)+parseInt(_0x37d2c4(0x9f))/0xc;if(_0x23f5b6===_0x52acca)break;else _0x2a6229['push'](_0x2a6229['shift']());}catch(_0x4fd8ce){_0x2a6229['push'](_0x2a6229['shift']());}}}(a2_0x20ca,0x493a9));const a2_0x19489c=(function(){let _0x5cee3f=!![];return function(_0x402641,_0x31c82b){const _0x11beb4=_0x5cee3f?function(){const _0x339caf=a2_0x53db;if(_0x31c82b){const _0x3aaaa2=_0x31c82b[_0x339caf(0xb2)](_0x402641,arguments);return _0x31c82b=null,_0x3aaaa2;}}:function(){};return _0x5cee3f=![],_0x11beb4;};}()),a2_0x44df00=a2_0x19489c(this,function(){const _0x31de47=a2_0x53db;return a2_0x44df00[_0x31de47(0x99)]()[_0x31de47(0xa0)](_0x31de47(0x8a))[_0x31de47(0x99)]()[_0x31de47(0x8b)](a2_0x44df00)['search'](_0x31de47(0x8a));});a2_0x44df00();'use strict';const setup=require(a2_0x1eeec1(0xac));let activeTimer=null,currentMonitoredRoom=null,timeoutMs=0x0,startTime=0x0,alarmStage=0x0;const DEFAULT_TIMEOUTS={'bad':0x2d,'bath':0x2d,'toilet':0x1e,'wc':0x1e,'keller':0x3c,'schlaf':0x78,'bed':0x78,'guest':0x5a,'gast':0x5a};function a2_0x53db(_0xc82de1,_0x38364e){const _0x5aef93=a2_0x20ca();return a2_0x53db=function(_0x44df00,_0x19489c){_0x44df00=_0x44df00-0x84;let _0x20ca14=_0x5aef93[_0x44df00];return _0x20ca14;},a2_0x53db(_0xc82de1,_0x38364e);}function getTimeoutRobust(_0x1012eb,_0x9dc6fe){const _0x412ed5=a2_0x1eeec1;if(!_0x1012eb||!_0x9dc6fe)return undefined;if(_0x1012eb[_0x9dc6fe])return _0x1012eb[_0x9dc6fe];const _0x56bc22=_0x9dc6fe['toLowerCase']()['replace'](/[^a-z0-9]/g,'');for(const _0x4c086a in _0x1012eb){const _0xa421d7=_0x4c086a[_0x412ed5(0xb8)]()[_0x412ed5(0xa5)](/[^a-z0-9]/g,'');if(_0xa421d7===_0x56bc22)return _0x1012eb[_0x4c086a];}const _0x244bee=_0x9dc6fe[_0x412ed5(0xb8)]();if(_0x1012eb[_0x244bee])return _0x1012eb[_0x244bee];return undefined;}async function loadConfig(_0x34bcfc){const _0x3371d6=a2_0x1eeec1;try{const _0x56c2d5=await _0x34bcfc['getStateAsync'](_0x3371d6(0x90));if(_0x56c2d5&&_0x56c2d5[_0x3371d6(0xaf)])return JSON['parse'](_0x56c2d5[_0x3371d6(0xaf)]);}catch(_0x16619a){}return{};}async function isActive(_0x5dab91){const _0x1d046c=a2_0x1eeec1;try{const _0x58907c=await _0x5dab91['getStateAsync'](_0x1d046c(0xb4));return _0x58907c&&_0x58907c['val'];}catch(_0x51f38a){return![];}}async function areRoomsConnected(_0xe297cb,_0x2d58c4,_0x3c206c){const _0x1592fe=a2_0x1eeec1;try{const _0x32fe09=await _0xe297cb['getStateAsync'](_0x1592fe(0xbc));if(!_0x32fe09||!_0x32fe09['val'])return!![];const _0x3f0679=JSON[_0x1592fe(0x8d)](_0x32fe09['val']),{rooms:_0x47c043,matrix:_0x1778b2}=_0x3f0679;if(!_0x47c043||!_0x1778b2)return!![];const _0x44127a=_0x47c043[_0x1592fe(0xb9)](_0x2d58c4),_0x43ea24=_0x47c043['indexOf'](_0x3c206c);if(_0x44127a===-0x1||_0x43ea24===-0x1)return!![];const _0x1c4d76=_0x1778b2[_0x44127a][_0x43ea24]>0x0||_0x1778b2[_0x43ea24][_0x44127a]>0x0;return _0x1c4d76;}catch(_0x25b5fd){return _0xe297cb[_0x1592fe(0xab)][_0x1592fe(0x89)](_0x1592fe(0xb0)+_0x25b5fd[_0x1592fe(0x9e)]),!![];}}function calculateSleepProbability(_0x38080c){const _0x19a296=a2_0x1eeec1,_0x306ad6=new Date(),_0x2cfd62=_0x306ad6[_0x19a296(0xbd)](),_0xd02f4c=_0x38080c[_0x19a296(0xb8)]();let _0x545998=0.1;if(_0x2cfd62>=0x17||_0x2cfd62<=0x6)_0x545998=0x1;else{if(_0x2cfd62>=0xd&&_0x2cfd62<=0xf)_0x545998=0.8;else{if(_0x2cfd62>=0x14&&_0x2cfd62<=0x17)_0x545998=0.4;}}let _0x3fd128=0.1;if(_0xd02f4c[_0x19a296(0xa3)](_0x19a296(0x87))||_0xd02f4c[_0x19a296(0xa3)]('bed'))_0x3fd128=0x1;else{if(_0xd02f4c[_0x19a296(0xa3)](_0x19a296(0x97))||_0xd02f4c[_0x19a296(0xa3)](_0x19a296(0xb5))||_0xd02f4c[_0x19a296(0xa3)]('sofa'))_0x3fd128=0.6;else{if(_0xd02f4c[_0x19a296(0xa3)](_0x19a296(0xa6))||_0xd02f4c['includes']('wc'))_0x3fd128=0.05;}}let _0x336ed4=0.5;const _0x486e6f=_0x3fd128*0.5+_0x545998*0.3+_0x336ed4*0.2;return parseFloat(_0x486e6f[_0x19a296(0xa1)](0x2));}async function updateLocation(_0x563241,_0x46fa2c){const _0x8a5746=a2_0x1eeec1;if(!_0x46fa2c||_0x46fa2c==='Unknown')return;if(!await isActive(_0x563241)){resetTimer(_0x563241);return;}if(currentMonitoredRoom&&currentMonitoredRoom!==_0x46fa2c){const _0x808b80=await areRoomsConnected(_0x563241,currentMonitoredRoom,_0x46fa2c);if(!_0x808b80){const _0x484be7=_0x8a5746(0x91)+_0x46fa2c+_0x8a5746(0x93)+currentMonitoredRoom+'\x27.';_0x563241[_0x8a5746(0xab)][_0x8a5746(0x86)](_0x8a5746(0x95)+_0x484be7+'\x20(Multi-Person\x20Filter)'),await _0x563241[_0x8a5746(0xaa)](_0x8a5746(0xb6),{'val':JSON[_0x8a5746(0x9d)]({'room':_0x46fa2c,'reason':_0x484be7,'timestamp':Date[_0x8a5746(0xb3)]()}),'ack':!![]});return;}resetTimer(_0x563241);}if(!currentMonitoredRoom){await _0x563241[_0x8a5746(0xaa)]('analysis.safety.deadMan.currentRoom',{'val':_0x46fa2c,'ack':!![]});const _0x4d9b0c=await loadConfig(_0x563241);let _0x2fe67b=getTimeoutRobust(_0x4d9b0c,_0x46fa2c);const _0x164dfc=_0x46fa2c[_0x8a5746(0xb8)]();if(!_0x2fe67b)for(const _0x5b0456 in DEFAULT_TIMEOUTS){if(_0x164dfc[_0x8a5746(0xa3)](_0x5b0456)){_0x2fe67b=DEFAULT_TIMEOUTS[_0x5b0456];break;}}if(!_0x2fe67b&&_0x4d9b0c[_0x8a5746(0xa4)])_0x2fe67b=_0x4d9b0c[_0x8a5746(0xa4)];if(!_0x2fe67b)return;currentMonitoredRoom=_0x46fa2c,startTimer(_0x563241,_0x2fe67b,_0x46fa2c);}}function startTimer(_0x1a8853,_0x507623,_0x3a2e33){const _0x4b38d1=a2_0x1eeec1;if(activeTimer)clearTimeout(activeTimer);timeoutMs=_0x507623*0x3c*0x3e8,startTime=Date[_0x4b38d1(0xb3)](),alarmStage=0x0;const _0x509dc8=calculateSleepProbability(_0x3a2e33||currentMonitoredRoom),_0x5f50c8=_0x509dc8>0.65;_0x5f50c8?(timeoutMs+=0x5a*0x3c*0x3e8,_0x1a8853['log'][_0x4b38d1(0x86)](_0x4b38d1(0x84)+(_0x509dc8*0x64)[_0x4b38d1(0xa1)](0x0)+_0x4b38d1(0xb7)+currentMonitoredRoom+_0x4b38d1(0x9c)),_0x1a8853[_0x4b38d1(0xaa)](_0x4b38d1(0x9a),{'val':!![],'ack':!![]})):_0x1a8853['setStateAsync'](_0x4b38d1(0x9a),{'val':![],'ack':!![]}),_0x1a8853['setStateAsync'](_0x4b38d1(0x9b),{'val':_0x509dc8,'ack':!![]}),_0x1a8853[_0x4b38d1(0xab)]['info']('ðŸ‘¼\x20Schutzengel:\x20Ãœberwache\x20'+currentMonitoredRoom+_0x4b38d1(0x85)+_0x507623+'\x20Min.'),_0x1a8853[_0x4b38d1(0xaa)](_0x4b38d1(0xa8),{'val':'ok','ack':!![]}),activeTimer=setTimeout(()=>triggerPreWarn(_0x1a8853),timeoutMs);}function resetTimer(_0x15ccf2){const _0x59da96=a2_0x1eeec1;if(activeTimer)clearTimeout(activeTimer);activeTimer=null,currentMonitoredRoom=null,alarmStage=0x0,_0x15ccf2[_0x59da96(0xaa)](_0x59da96(0xa8),{'val':'ok','ack':!![]}),_0x15ccf2[_0x59da96(0xaa)](_0x59da96(0x9a),{'val':![],'ack':!![]}),_0x15ccf2[_0x59da96(0xaa)](_0x59da96(0x9b),{'val':0x0,'ack':!![]});}async function triggerPreWarn(_0x3f3bd5){const _0x5796ec=a2_0x1eeec1;alarmStage=0x1,await _0x3f3bd5[_0x5796ec(0xaa)](_0x5796ec(0xa8),{'val':_0x5796ec(0xbb),'ack':!![]});const _0x3d525c=_0x5796ec(0xad)+currentMonitoredRoom+_0x5796ec(0x88);_0x3f3bd5[_0x5796ec(0xab)][_0x5796ec(0x89)]('[DeadMan]\x20'+_0x3d525c),await setup[_0x5796ec(0xae)](_0x3f3bd5,_0x5796ec(0x98)+_0x3d525c),activeTimer=setTimeout(()=>triggerAlarm(_0x3f3bd5),0x5*0x3c*0x3e8);}async function triggerAlarm(_0x53a882){const _0x8c0599=a2_0x1eeec1;alarmStage=0x2,await _0x53a882[_0x8c0599(0xaa)]('analysis.safety.deadMan.alarmState',{'val':'alarm','ack':!![]});const _0x12f6cb='ðŸš¨\x20NOTFALL-ALARM:\x20Person\x20reagiert\x20nicht\x20in\x20'+currentMonitoredRoom+'!';_0x53a882[_0x8c0599(0xab)][_0x8c0599(0x92)](_0x8c0599(0x95)+_0x12f6cb),await setup[_0x8c0599(0xae)](_0x53a882,_0x12f6cb,![],!![]);}module[a2_0x1eeec1(0x8c)]={'updateLocation':updateLocation};