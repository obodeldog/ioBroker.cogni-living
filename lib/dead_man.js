const a2_0x526678=a2_0xbd3c;(function(_0x218e7f,_0x540083){const _0x484600=a2_0xbd3c,_0xf514a5=_0x218e7f();while(!![]){try{const _0x350e19=parseInt(_0x484600(0x1ad))/0x1+-parseInt(_0x484600(0x1a9))/0x2*(parseInt(_0x484600(0x180))/0x3)+-parseInt(_0x484600(0x18a))/0x4+-parseInt(_0x484600(0x196))/0x5+parseInt(_0x484600(0x175))/0x6*(-parseInt(_0x484600(0x183))/0x7)+parseInt(_0x484600(0x177))/0x8+parseInt(_0x484600(0x1ab))/0x9;if(_0x350e19===_0x540083)break;else _0xf514a5['push'](_0xf514a5['shift']());}catch(_0x8cbea3){_0xf514a5['push'](_0xf514a5['shift']());}}}(a2_0x48c3,0x8151e));const a2_0x1b6120=(function(){let _0x1c0fd9=!![];return function(_0x1d2ab7,_0x2f922e){const _0x58bdad=_0x1c0fd9?function(){const _0x1c8312=a2_0xbd3c;if(_0x2f922e){const _0x48f8a2=_0x2f922e[_0x1c8312(0x194)](_0x1d2ab7,arguments);return _0x2f922e=null,_0x48f8a2;}}:function(){};return _0x1c0fd9=![],_0x58bdad;};}()),a2_0x1d9c29=a2_0x1b6120(this,function(){const _0xbc9743=a2_0xbd3c;return a2_0x1d9c29['toString']()[_0xbc9743(0x189)]('(((.+)+)+)+$')[_0xbc9743(0x17d)]()[_0xbc9743(0x17f)](a2_0x1d9c29)[_0xbc9743(0x189)]('(((.+)+)+)+$');});a2_0x1d9c29();'use strict';const setup=require(a2_0x526678(0x1ac));let activeTimer=null,currentMonitoredRoom=null,timeoutMs=0x0,startTime=0x0,alarmStage=0x0;function a2_0xbd3c(_0x23c644,_0x196314){const _0x49c6c7=a2_0x48c3();return a2_0xbd3c=function(_0x1d9c29,_0x1b6120){_0x1d9c29=_0x1d9c29-0x175;let _0x48c375=_0x49c6c7[_0x1d9c29];return _0x48c375;},a2_0xbd3c(_0x23c644,_0x196314);}const DEFAULT_TIMEOUTS={'bad':0x2d,'bath':0x2d,'toilet':0x1e,'wc':0x1e,'keller':0x3c,'schlaf':0x78,'bed':0x78,'guest':0x5a,'gast':0x5a};function a2_0x48c3(){const _0x3b22e6=['4875145mgHVnx','parse','\x20um\x2090\x20Min.','warn','\x27.\x20Nicht\x20verbunden\x20mit\x20Ã¼berwachtem\x20\x27','â³\x20ACHTUNG:\x20UngewÃ¶hnlich\x20lange\x20InaktivitÃ¤t\x20in\x20','replace','\x20fÃ¼r\x20','includes','analysis.safety.deadMan.config','toLowerCase','.\x20Alles\x20in\x20Ordnung?','getHours','now','analysis.safety.deadMan.smartSleep','%).\x20VerlÃ¤ngere\x20Timer\x20fÃ¼r\x20','message','ðŸš¨\x20NOTFALL-ALARM:\x20Person\x20reagiert\x20nicht\x20in\x20','analysis.safety.deadMan.active','19672qByWmx','setStateAsync','11472219ICoIqB','./setup','289884vNqmbz','\x20Min.','bed','108olsqDC','ðŸ‘¼\x20Schutzengel-Frage:\x20','5430504DStZdW','analysis.topology.structure','ðŸ‘¼\x20Schutzengel:\x20Ãœberwache\x20','getStateAsync','error','analysis.safety.deadMan.currentRoom','toString','analysis.safety.deadMan.napProbability','constructor','195fUZKiP','stringify','analysis.safety.deadMan.alarmState','16387RFuQpG','[DeadMan]\x20','log','info','wohn','Ignoriere\x20Bewegung\x20in\x20\x27','search','228748YeaUce','indexOf','default','sendNotification','Unknown','val','\x20(Multi-Person\x20Filter)','exports','toFixed','[DeadMan]\x20Topology\x20check\x20failed:\x20','apply','pre_warn'];a2_0x48c3=function(){return _0x3b22e6;};return a2_0x48c3();}function getTimeoutRobust(_0x44f763,_0x2b2740){const _0x59b9db=a2_0x526678;if(!_0x44f763||!_0x2b2740)return undefined;if(_0x44f763[_0x2b2740])return _0x44f763[_0x2b2740];const _0x1b82fa=_0x2b2740[_0x59b9db(0x1a0)]()[_0x59b9db(0x19c)](/[^a-z0-9]/g,'');for(const _0x207aae in _0x44f763){const _0x1298f7=_0x207aae[_0x59b9db(0x1a0)]()[_0x59b9db(0x19c)](/[^a-z0-9]/g,'');if(_0x1298f7===_0x1b82fa)return _0x44f763[_0x207aae];}const _0x259a57=_0x2b2740[_0x59b9db(0x1a0)]();if(_0x44f763[_0x259a57])return _0x44f763[_0x259a57];return undefined;}async function loadConfig(_0x101095){const _0x4ebe5f=a2_0x526678;try{const _0x4a17ab=await _0x101095[_0x4ebe5f(0x17a)](_0x4ebe5f(0x19f));if(_0x4a17ab&&_0x4a17ab[_0x4ebe5f(0x18f)])return JSON[_0x4ebe5f(0x197)](_0x4a17ab[_0x4ebe5f(0x18f)]);}catch(_0xab4032){}return{};}async function isActive(_0x9e07ed){const _0x52e142=a2_0x526678;try{const _0x1ae2aa=await _0x9e07ed[_0x52e142(0x17a)](_0x52e142(0x1a8));return _0x1ae2aa&&_0x1ae2aa[_0x52e142(0x18f)];}catch(_0x289946){return![];}}async function areRoomsConnected(_0x39d081,_0x19c063,_0xb570c3){const _0x46bbbb=a2_0x526678;try{const _0x12d924=await _0x39d081['getStateAsync'](_0x46bbbb(0x178));if(!_0x12d924||!_0x12d924[_0x46bbbb(0x18f)])return!![];const _0x301702=JSON[_0x46bbbb(0x197)](_0x12d924[_0x46bbbb(0x18f)]),{rooms:_0x5eb673,matrix:_0x32c667}=_0x301702;if(!_0x5eb673||!_0x32c667)return!![];const _0x1d6f64=_0x5eb673[_0x46bbbb(0x18b)](_0x19c063),_0x4d0439=_0x5eb673['indexOf'](_0xb570c3);if(_0x1d6f64===-0x1||_0x4d0439===-0x1)return!![];const _0x1fd7f8=_0x32c667[_0x1d6f64][_0x4d0439]>0x0||_0x32c667[_0x4d0439][_0x1d6f64]>0x0;return _0x1fd7f8;}catch(_0x4b0c26){return _0x39d081[_0x46bbbb(0x185)][_0x46bbbb(0x199)](_0x46bbbb(0x193)+_0x4b0c26[_0x46bbbb(0x1a6)]),!![];}}function calculateSleepProbability(_0x42f67e){const _0x280f19=a2_0x526678,_0x3bd0de=new Date(),_0x58b6e9=_0x3bd0de[_0x280f19(0x1a2)](),_0x3257a6=_0x42f67e[_0x280f19(0x1a0)]();let _0x15f507=0.1;if(_0x58b6e9>=0x17||_0x58b6e9<=0x6)_0x15f507=0x1;else{if(_0x58b6e9>=0xd&&_0x58b6e9<=0xf)_0x15f507=0.8;else{if(_0x58b6e9>=0x14&&_0x58b6e9<=0x17)_0x15f507=0.4;}}let _0x28cdb7=0.1;if(_0x3257a6[_0x280f19(0x19e)]('schlaf')||_0x3257a6['includes'](_0x280f19(0x1af)))_0x28cdb7=0x1;else{if(_0x3257a6[_0x280f19(0x19e)](_0x280f19(0x187))||_0x3257a6[_0x280f19(0x19e)]('living')||_0x3257a6['includes']('sofa'))_0x28cdb7=0.6;else{if(_0x3257a6[_0x280f19(0x19e)]('bad')||_0x3257a6[_0x280f19(0x19e)]('wc'))_0x28cdb7=0.05;}}let _0x53e929=0.5;const _0x4635a8=_0x28cdb7*0.5+_0x15f507*0.3+_0x53e929*0.2;return parseFloat(_0x4635a8[_0x280f19(0x192)](0x2));}async function updateLocation(_0x34514c,_0x17d6fa){const _0x2fb36e=a2_0x526678;if(!_0x17d6fa||_0x17d6fa===_0x2fb36e(0x18e))return;if(!await isActive(_0x34514c)){resetTimer(_0x34514c);return;}if(currentMonitoredRoom&&currentMonitoredRoom!==_0x17d6fa){const _0x4df1d2=await areRoomsConnected(_0x34514c,currentMonitoredRoom,_0x17d6fa);if(!_0x4df1d2){const _0x596cab=_0x2fb36e(0x188)+_0x17d6fa+_0x2fb36e(0x19a)+currentMonitoredRoom+'\x27.';_0x34514c[_0x2fb36e(0x185)][_0x2fb36e(0x186)](_0x2fb36e(0x184)+_0x596cab+_0x2fb36e(0x190)),await _0x34514c[_0x2fb36e(0x1aa)]('analysis.safety.deadMan.lastIgnored',{'val':JSON[_0x2fb36e(0x181)]({'room':_0x17d6fa,'reason':_0x596cab,'timestamp':Date[_0x2fb36e(0x1a3)]()}),'ack':!![]});return;}resetTimer(_0x34514c);}if(!currentMonitoredRoom){await _0x34514c[_0x2fb36e(0x1aa)](_0x2fb36e(0x17c),{'val':_0x17d6fa,'ack':!![]});const _0x1a4ac1=await loadConfig(_0x34514c);let _0x37a26e=getTimeoutRobust(_0x1a4ac1,_0x17d6fa);const _0x5aa254=_0x17d6fa[_0x2fb36e(0x1a0)]();if(!_0x37a26e)for(const _0x443447 in DEFAULT_TIMEOUTS){if(_0x5aa254['includes'](_0x443447)){_0x37a26e=DEFAULT_TIMEOUTS[_0x443447];break;}}if(!_0x37a26e&&_0x1a4ac1[_0x2fb36e(0x18c)])_0x37a26e=_0x1a4ac1['default'];if(!_0x37a26e)return;currentMonitoredRoom=_0x17d6fa,startTimer(_0x34514c,_0x37a26e,_0x17d6fa);}}function startTimer(_0x4df444,_0x3ce6da,_0x25adba){const _0xdacab4=a2_0x526678;if(activeTimer)clearTimeout(activeTimer);timeoutMs=_0x3ce6da*0x3c*0x3e8,startTime=Date[_0xdacab4(0x1a3)](),alarmStage=0x0;const _0xcba8b7=calculateSleepProbability(_0x25adba||currentMonitoredRoom),_0x24db93=_0xcba8b7>0.65;_0x24db93?(timeoutMs+=0x5a*0x3c*0x3e8,_0x4df444[_0xdacab4(0x185)]['info']('ðŸ’¤\x20Smart\x20Sleep\x20erkannt\x20('+(_0xcba8b7*0x64)[_0xdacab4(0x192)](0x0)+_0xdacab4(0x1a5)+currentMonitoredRoom+_0xdacab4(0x198)),_0x4df444['setStateAsync'](_0xdacab4(0x1a4),{'val':!![],'ack':!![]})):_0x4df444[_0xdacab4(0x1aa)](_0xdacab4(0x1a4),{'val':![],'ack':!![]}),_0x4df444[_0xdacab4(0x1aa)](_0xdacab4(0x17e),{'val':_0xcba8b7,'ack':!![]}),_0x4df444[_0xdacab4(0x185)]['info'](_0xdacab4(0x179)+currentMonitoredRoom+_0xdacab4(0x19d)+_0x3ce6da+_0xdacab4(0x1ae)),_0x4df444[_0xdacab4(0x1aa)](_0xdacab4(0x182),{'val':'ok','ack':!![]}),activeTimer=setTimeout(()=>triggerPreWarn(_0x4df444),timeoutMs);}function resetTimer(_0x191edf){const _0xb76c57=a2_0x526678;if(activeTimer)clearTimeout(activeTimer);activeTimer=null,currentMonitoredRoom=null,alarmStage=0x0,_0x191edf[_0xb76c57(0x1aa)](_0xb76c57(0x182),{'val':'ok','ack':!![]}),_0x191edf['setStateAsync'](_0xb76c57(0x1a4),{'val':![],'ack':!![]}),_0x191edf[_0xb76c57(0x1aa)](_0xb76c57(0x17e),{'val':0x0,'ack':!![]});}async function triggerPreWarn(_0x224911){const _0x485abf=a2_0x526678;alarmStage=0x1,await _0x224911['setStateAsync']('analysis.safety.deadMan.alarmState',{'val':_0x485abf(0x195),'ack':!![]});const _0x255010=_0x485abf(0x19b)+currentMonitoredRoom+_0x485abf(0x1a1);_0x224911[_0x485abf(0x185)][_0x485abf(0x199)](_0x485abf(0x184)+_0x255010),await setup[_0x485abf(0x18d)](_0x224911,_0x485abf(0x176)+_0x255010),activeTimer=setTimeout(()=>triggerAlarm(_0x224911),0x5*0x3c*0x3e8);}async function triggerAlarm(_0x45ca6b){const _0x52773d=a2_0x526678;alarmStage=0x2,await _0x45ca6b[_0x52773d(0x1aa)](_0x52773d(0x182),{'val':'alarm','ack':!![]});const _0x3999c8=_0x52773d(0x1a7)+currentMonitoredRoom+'!';_0x45ca6b[_0x52773d(0x185)][_0x52773d(0x17b)](_0x52773d(0x184)+_0x3999c8),await setup[_0x52773d(0x18d)](_0x45ca6b,_0x3999c8,![],!![]);}module[a2_0x526678(0x191)]={'updateLocation':updateLocation};