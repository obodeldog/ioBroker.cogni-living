const a2_0x27b9dd=a2_0x59a9;(function(_0x4595e0,_0x843fff){const _0x327e5e=a2_0x59a9,_0x13240b=_0x4595e0();while(!![]){try{const _0x3fa5ce=-parseInt(_0x327e5e(0x8e))/0x1+parseInt(_0x327e5e(0x8d))/0x2*(-parseInt(_0x327e5e(0x95))/0x3)+-parseInt(_0x327e5e(0x83))/0x4+parseInt(_0x327e5e(0x80))/0x5*(parseInt(_0x327e5e(0x91))/0x6)+parseInt(_0x327e5e(0x9f))/0x7*(-parseInt(_0x327e5e(0x8c))/0x8)+parseInt(_0x327e5e(0x7b))/0x9+parseInt(_0x327e5e(0xa2))/0xa;if(_0x3fa5ce===_0x843fff)break;else _0x13240b['push'](_0x13240b['shift']());}catch(_0x5396b8){_0x13240b['push'](_0x13240b['shift']());}}}(a2_0x5c65,0x9a946));const a2_0x56667e=(function(){let _0x188b61=!![];return function(_0x4e2120,_0xd0bfbb){const _0x55d82f=_0x188b61?function(){if(_0xd0bfbb){const _0x3afc1c=_0xd0bfbb['apply'](_0x4e2120,arguments);return _0xd0bfbb=null,_0x3afc1c;}}:function(){};return _0x188b61=![],_0x55d82f;};}()),a2_0x459aae=a2_0x56667e(this,function(){const _0x2057e6=a2_0x59a9;return a2_0x459aae['toString']()[_0x2057e6(0x77)](_0x2057e6(0x7d))[_0x2057e6(0x87)]()['constructor'](a2_0x459aae)[_0x2057e6(0x77)](_0x2057e6(0x7d));});a2_0x459aae();'use strict';const setup=require(a2_0x27b9dd(0x7c));function a2_0x59a9(_0x44d7dc,_0x5b0392){const _0x5ea991=a2_0x5c65();return a2_0x59a9=function(_0x459aae,_0x56667e){_0x459aae=_0x459aae-0x77;let _0x5c65f3=_0x5ea991[_0x459aae];return _0x5c65f3;},a2_0x59a9(_0x44d7dc,_0x5b0392);}let activeTimer=null,currentMonitoredRoom=null,timeoutMs=0x0,startTime=0x0,alarmStage=0x0;const DEFAULT_TIMEOUTS={'bad':0x2d,'bath':0x2d,'toilet':0x1e,'wc':0x1e,'keller':0x3c};async function loadConfig(_0x49ed56){const _0x143738=a2_0x27b9dd;try{const _0x4c29b8=await _0x49ed56['getStateAsync']('analysis.safety.deadMan.config');if(_0x4c29b8&&_0x4c29b8['val'])return JSON[_0x143738(0x90)](_0x4c29b8[_0x143738(0x9c)]);}catch(_0x1cec3d){}return{};}async function isActive(_0x46c025){const _0x3e3021=a2_0x27b9dd;try{const _0x388161=await _0x46c025[_0x3e3021(0x89)](_0x3e3021(0x99));return _0x388161&&_0x388161[_0x3e3021(0x9c)];}catch(_0x5d055e){return![];}}async function areRoomsConnected(_0x107be2,_0x46cebb,_0x3e8a78){const _0x2dfc5d=a2_0x27b9dd;try{const _0x1de2e1=await _0x107be2[_0x2dfc5d(0x89)]('analysis.topology.structure');if(!_0x1de2e1||!_0x1de2e1[_0x2dfc5d(0x9c)])return!![];const _0xc04ac0=JSON[_0x2dfc5d(0x90)](_0x1de2e1[_0x2dfc5d(0x9c)]),{rooms:_0xfffc33,matrix:_0x310942}=_0xc04ac0;if(!_0xfffc33||!_0x310942)return!![];const _0x5debea=_0xfffc33[_0x2dfc5d(0x79)](_0x46cebb),_0x1ca087=_0xfffc33[_0x2dfc5d(0x79)](_0x3e8a78);if(_0x5debea===-0x1||_0x1ca087===-0x1)return!![];const _0x2d4abe=_0x310942[_0x5debea][_0x1ca087]>0x0||_0x310942[_0x1ca087][_0x5debea]>0x0;return _0x2d4abe;}catch(_0x41af4b){return _0x107be2[_0x2dfc5d(0x97)][_0x2dfc5d(0x88)]('[DeadMan]\x20Topology\x20check\x20failed:\x20'+_0x41af4b['message']),!![];}}async function updateLocation(_0x5c26fc,_0x120d5d){const _0x3e6e94=a2_0x27b9dd;if(!_0x120d5d||_0x120d5d===_0x3e6e94(0x8f))return;if(!await isActive(_0x5c26fc)){resetTimer(_0x5c26fc);return;}if(currentMonitoredRoom&&currentMonitoredRoom!==_0x120d5d){const _0x14dedb=await areRoomsConnected(_0x5c26fc,currentMonitoredRoom,_0x120d5d);if(!_0x14dedb){const _0x481a04=_0x3e6e94(0xa1)+_0x120d5d+_0x3e6e94(0xa3)+currentMonitoredRoom+'\x27.';_0x5c26fc[_0x3e6e94(0x97)][_0x3e6e94(0x84)](_0x3e6e94(0x93)+_0x481a04+_0x3e6e94(0x82)),await _0x5c26fc[_0x3e6e94(0x8b)](_0x3e6e94(0x98),{'val':JSON[_0x3e6e94(0x7f)]({'room':_0x120d5d,'reason':_0x481a04,'timestamp':Date['now']()}),'ack':!![]});return;}resetTimer(_0x5c26fc);}if(!currentMonitoredRoom){await _0x5c26fc[_0x3e6e94(0x8b)](_0x3e6e94(0x86),{'val':_0x120d5d,'ack':!![]});const _0x5e8be7=await loadConfig(_0x5c26fc),_0x32f6fc=_0x120d5d[_0x3e6e94(0x9b)]();let _0x2e3b1f=_0x5e8be7[_0x120d5d]||_0x5e8be7[_0x32f6fc];if(!_0x2e3b1f)for(const _0x28a772 in DEFAULT_TIMEOUTS){if(_0x32f6fc[_0x3e6e94(0x81)](_0x28a772)){_0x2e3b1f=DEFAULT_TIMEOUTS[_0x28a772];break;}}if(!_0x2e3b1f&&_0x5e8be7[_0x3e6e94(0x9d)])_0x2e3b1f=_0x5e8be7[_0x3e6e94(0x9d)];if(!_0x2e3b1f)return;currentMonitoredRoom=_0x120d5d,startTimer(_0x5c26fc,_0x2e3b1f);}}function startTimer(_0x1b6b0f,_0x1b24a4){const _0x1ddfa2=a2_0x27b9dd;if(activeTimer)clearTimeout(activeTimer);timeoutMs=_0x1b24a4*0x3c*0x3e8,startTime=Date['now'](),alarmStage=0x0,_0x1b6b0f[_0x1ddfa2(0x97)][_0x1ddfa2(0x84)](_0x1ddfa2(0x9e)+currentMonitoredRoom+'\x20fÃ¼r\x20'+_0x1b24a4+_0x1ddfa2(0x78)),_0x1b6b0f[_0x1ddfa2(0x8b)](_0x1ddfa2(0x8a),{'val':'ok','ack':!![]}),activeTimer=setTimeout(()=>triggerPreWarn(_0x1b6b0f),timeoutMs);}function resetTimer(_0xd97030){const _0x41996e=a2_0x27b9dd;if(activeTimer)clearTimeout(activeTimer);activeTimer=null,currentMonitoredRoom=null,alarmStage=0x0,_0xd97030[_0x41996e(0x8b)]('analysis.safety.deadMan.alarmState',{'val':'ok','ack':!![]});}function a2_0x5c65(){const _0x484068=['analysis.safety.deadMan.active','.\x20Alles\x20in\x20Ordnung?','toLowerCase','val','default','ðŸ‘¼\x20Schutzengel:\x20Ãœberwache\x20','5846393zHDsaQ','ðŸ‘¼\x20Schutzengel-Frage:\x20','Ignoriere\x20Bewegung\x20in\x20\x27','16981910bFGJkQ','\x27.\x20Nicht\x20verbunden\x20mit\x20Ã¼berwachtem\x20\x27','search','\x20Min.','indexOf','pre_warn','6013656fdeLXl','./setup','(((.+)+)+)+$','sendNotification','stringify','4596465lOKnee','includes','\x20(Multi-Person\x20Filter)','2065436AhSpZw','info','â³\x20ACHTUNG:\x20UngewÃ¶hnlich\x20lange\x20InaktivitÃ¤t\x20in\x20','analysis.safety.deadMan.currentRoom','toString','warn','getStateAsync','analysis.safety.deadMan.alarmState','setStateAsync','8cfpzah','224342rSJsVQ','964439OXnKZN','Unknown','parse','6wNaMWr','alarm','[DeadMan]\x20','error','9RttWiM','exports','log','analysis.safety.deadMan.lastIgnored'];a2_0x5c65=function(){return _0x484068;};return a2_0x5c65();}async function triggerPreWarn(_0x126eee){const _0x5452b3=a2_0x27b9dd;alarmStage=0x1,await _0x126eee[_0x5452b3(0x8b)](_0x5452b3(0x8a),{'val':_0x5452b3(0x7a),'ack':!![]});const _0x13da38=_0x5452b3(0x85)+currentMonitoredRoom+_0x5452b3(0x9a);_0x126eee[_0x5452b3(0x97)][_0x5452b3(0x88)]('[DeadMan]\x20'+_0x13da38),await setup['sendNotification'](_0x126eee,_0x5452b3(0xa0)+_0x13da38),activeTimer=setTimeout(()=>triggerAlarm(_0x126eee),0x5*0x3c*0x3e8);}async function triggerAlarm(_0x78399a){const _0x2f1989=a2_0x27b9dd;alarmStage=0x2,await _0x78399a[_0x2f1989(0x8b)](_0x2f1989(0x8a),{'val':_0x2f1989(0x92),'ack':!![]});const _0x569a5d='ðŸš¨\x20NOTFALL-ALARM:\x20Person\x20reagiert\x20nicht\x20in\x20'+currentMonitoredRoom+'!';_0x78399a['log'][_0x2f1989(0x94)](_0x2f1989(0x93)+_0x569a5d),await setup[_0x2f1989(0x7e)](_0x78399a,_0x569a5d,![],!![]);}module[a2_0x27b9dd(0x96)]={'updateLocation':updateLocation};