const a2_0x51d823=a2_0xebd1;function a2_0xebd1(_0x224c59,_0x22220e){const _0x1c7e0c=a2_0x1a14();return a2_0xebd1=function(_0x5bb764,_0x3b4284){_0x5bb764=_0x5bb764-0x7c;let _0x1a14b3=_0x1c7e0c[_0x5bb764];return _0x1a14b3;},a2_0xebd1(_0x224c59,_0x22220e);}(function(_0x52f153,_0x373205){const _0x25b768=a2_0xebd1,_0x1f4715=_0x52f153();while(!![]){try{const _0x121758=-parseInt(_0x25b768(0xa3))/0x1*(parseInt(_0x25b768(0x95))/0x2)+-parseInt(_0x25b768(0xa7))/0x3*(parseInt(_0x25b768(0xa8))/0x4)+parseInt(_0x25b768(0xb5))/0x5+-parseInt(_0x25b768(0xa4))/0x6+parseInt(_0x25b768(0x89))/0x7*(parseInt(_0x25b768(0x83))/0x8)+parseInt(_0x25b768(0x91))/0x9*(-parseInt(_0x25b768(0x8e))/0xa)+parseInt(_0x25b768(0x81))/0xb;if(_0x121758===_0x373205)break;else _0x1f4715['push'](_0x1f4715['shift']());}catch(_0x484e50){_0x1f4715['push'](_0x1f4715['shift']());}}}(a2_0x1a14,0x42ed3));const a2_0x3b4284=(function(){let _0x5514fb=!![];return function(_0x1e61d9,_0x347c3d){const _0x19b7ae=_0x5514fb?function(){const _0x205920=a2_0xebd1;if(_0x347c3d){const _0x270678=_0x347c3d[_0x205920(0x7c)](_0x1e61d9,arguments);return _0x347c3d=null,_0x270678;}}:function(){};return _0x5514fb=![],_0x19b7ae;};}()),a2_0x5bb764=a2_0x3b4284(this,function(){const _0xd5ba33=a2_0xebd1;return a2_0x5bb764[_0xd5ba33(0xad)]()[_0xd5ba33(0x87)](_0xd5ba33(0x8f))[_0xd5ba33(0xad)]()['constructor'](a2_0x5bb764)[_0xd5ba33(0x87)]('(((.+)+)+)+$');});a2_0x5bb764();'use strict';const setup=require(a2_0x51d823(0x9b));let activeTimer=null,currentMonitoredRoom=null,timeoutMs=0x0,startTime=0x0,alarmStage=0x0;const DEFAULT_TIMEOUTS={'bad':0x2d,'bath':0x2d,'toilet':0x1e,'wc':0x1e,'keller':0x3c,'schlaf':0x78,'bed':0x78,'guest':0x5a,'gast':0x5a};function getTimeoutRobust(_0x1747a0,_0x58428f){const _0x8df1b0=a2_0x51d823;if(!_0x1747a0||!_0x58428f)return undefined;if(_0x1747a0[_0x58428f])return _0x1747a0[_0x58428f];const _0x3505b6=_0x58428f['toLowerCase']()[_0x8df1b0(0x9c)](/[^a-z0-9]/g,'');for(const _0x47215c in _0x1747a0){const _0xb6f36b=_0x47215c[_0x8df1b0(0x86)]()[_0x8df1b0(0x9c)](/[^a-z0-9]/g,'');if(_0xb6f36b===_0x3505b6)return _0x1747a0[_0x47215c];}const _0x11790b=_0x58428f['toLowerCase']();if(_0x1747a0[_0x11790b])return _0x1747a0[_0x11790b];return undefined;}async function loadConfig(_0x1ce4a0){const _0xb97cdc=a2_0x51d823;try{const _0x22ebe2=await _0x1ce4a0[_0xb97cdc(0x97)]('analysis.safety.deadMan.config');if(_0x22ebe2&&_0x22ebe2[_0xb97cdc(0xaa)])return JSON[_0xb97cdc(0xae)](_0x22ebe2[_0xb97cdc(0xaa)]);}catch(_0x4b596f){}return{};}async function isActive(_0x568bd4){const _0x4a186e=a2_0x51d823;try{const _0x2090b0=await _0x568bd4[_0x4a186e(0x97)](_0x4a186e(0xab));return _0x2090b0&&_0x2090b0[_0x4a186e(0xaa)];}catch(_0x1b44d9){return![];}}async function areRoomsConnected(_0x27da74,_0x5da836,_0x2ae822){const _0xf86d70=a2_0x51d823;try{const _0x21d4a9=await _0x27da74['getStateAsync']('analysis.topology.structure');if(!_0x21d4a9||!_0x21d4a9['val'])return!![];const _0x5cf84c=JSON[_0xf86d70(0xae)](_0x21d4a9[_0xf86d70(0xaa)]),{rooms:_0x561712,matrix:_0x4d6c26}=_0x5cf84c;if(!_0x561712||!_0x4d6c26)return!![];const _0x48bea4=_0x561712[_0xf86d70(0x96)](_0x5da836),_0x212dee=_0x561712[_0xf86d70(0x96)](_0x2ae822);if(_0x48bea4===-0x1||_0x212dee===-0x1)return!![];const _0x320adc=_0x4d6c26[_0x48bea4][_0x212dee]>0x0||_0x4d6c26[_0x212dee][_0x48bea4]>0x0;return _0x320adc;}catch(_0x327e96){return _0x27da74[_0xf86d70(0xa0)]['warn'](_0xf86d70(0x90)+_0x327e96['message']),!![];}}function calculateSleepProbability(_0x3b8047){const _0x189603=a2_0x51d823,_0x58f790=new Date(),_0x21ad74=_0x58f790[_0x189603(0x8b)](),_0x468493=_0x3b8047[_0x189603(0x86)]();let _0x5f34d3=0.1;if(_0x21ad74>=0x17||_0x21ad74<=0x6)_0x5f34d3=0x1;else{if(_0x21ad74>=0xd&&_0x21ad74<=0xf)_0x5f34d3=0.8;else{if(_0x21ad74>=0x14&&_0x21ad74<=0x17)_0x5f34d3=0.4;}}let _0x1ded6c=0.1;if(_0x468493[_0x189603(0xa1)](_0x189603(0x7e))||_0x468493[_0x189603(0xa1)](_0x189603(0x99)))_0x1ded6c=0x1;else{if(_0x468493[_0x189603(0xa1)]('wohn')||_0x468493['includes']('living')||_0x468493[_0x189603(0xa1)](_0x189603(0x9f)))_0x1ded6c=0.6;else{if(_0x468493['includes']('bad')||_0x468493[_0x189603(0xa1)]('wc'))_0x1ded6c=0.05;}}let _0x2ad9ef=0.5;const _0x49b9b2=_0x1ded6c*0.5+_0x5f34d3*0.3+_0x2ad9ef*0.2;return parseFloat(_0x49b9b2[_0x189603(0x7d)](0x2));}async function updateLocation(_0xcb20fe,_0x5d99b1){const _0x246384=a2_0x51d823;if(!_0x5d99b1||_0x5d99b1===_0x246384(0x8d))return;if(!await isActive(_0xcb20fe)){resetTimer(_0xcb20fe);return;}if(currentMonitoredRoom&&currentMonitoredRoom!==_0x5d99b1){const _0x5778cc=await areRoomsConnected(_0xcb20fe,currentMonitoredRoom,_0x5d99b1);if(!_0x5778cc){const _0x5a9a04='Ignoriere\x20Bewegung\x20in\x20\x27'+_0x5d99b1+_0x246384(0xa2)+currentMonitoredRoom+'\x27.';_0xcb20fe['log']['info']('[DeadMan]\x20'+_0x5a9a04+_0x246384(0x7f)),await _0xcb20fe['setStateAsync'](_0x246384(0xb1),{'val':JSON[_0x246384(0x9d)]({'room':_0x5d99b1,'reason':_0x5a9a04,'timestamp':Date['now']()}),'ack':!![]});return;}resetTimer(_0xcb20fe);}if(!currentMonitoredRoom){await _0xcb20fe[_0x246384(0xb4)](_0x246384(0xa9),{'val':_0x5d99b1,'ack':!![]});const _0x458a1f=await loadConfig(_0xcb20fe);let _0x53c1f1=getTimeoutRobust(_0x458a1f,_0x5d99b1);const _0x193394=_0x5d99b1[_0x246384(0x86)]();if(!_0x53c1f1)for(const _0x47e119 in DEFAULT_TIMEOUTS){if(_0x193394[_0x246384(0xa1)](_0x47e119)){_0x53c1f1=DEFAULT_TIMEOUTS[_0x47e119];break;}}if(!_0x53c1f1&&_0x458a1f[_0x246384(0xb0)])_0x53c1f1=_0x458a1f[_0x246384(0xb0)];if(!_0x53c1f1)return;currentMonitoredRoom=_0x5d99b1,startTimer(_0xcb20fe,_0x53c1f1,_0x5d99b1);}}function startTimer(_0x4a2132,_0x3f59bb,_0x323a83){const _0x4751c4=a2_0x51d823;if(activeTimer)clearTimeout(activeTimer);timeoutMs=_0x3f59bb*0x3c*0x3e8,startTime=Date[_0x4751c4(0xb3)](),alarmStage=0x0;const _0x3a7406=calculateSleepProbability(_0x323a83||currentMonitoredRoom),_0x3cb8c7=_0x3a7406>0.65;_0x3cb8c7?(timeoutMs+=0x5a*0x3c*0x3e8,_0x4a2132[_0x4751c4(0xa0)]['info'](_0x4751c4(0x94)+(_0x3a7406*0x64)[_0x4751c4(0x7d)](0x0)+'%).\x20Verl√§ngere\x20Timer\x20f√ºr\x20'+currentMonitoredRoom+_0x4751c4(0x98)),_0x4a2132[_0x4751c4(0xb4)](_0x4751c4(0x93),{'val':!![],'ack':!![]})):_0x4a2132[_0x4751c4(0xb4)]('analysis.safety.deadMan.smartSleep',{'val':![],'ack':!![]}),_0x4a2132[_0x4751c4(0xb4)](_0x4751c4(0x8c),{'val':_0x3a7406,'ack':!![]}),_0x4a2132['log'][_0x4751c4(0x82)](_0x4751c4(0xac)+currentMonitoredRoom+_0x4751c4(0x84)+_0x3f59bb+_0x4751c4(0x8a)),_0x4a2132[_0x4751c4(0xb4)]('analysis.safety.deadMan.alarmState',{'val':'ok','ack':!![]}),activeTimer=setTimeout(()=>triggerPreWarn(_0x4a2132),timeoutMs);}function resetTimer(_0x23175c){const _0x217f50=a2_0x51d823;if(activeTimer)clearTimeout(activeTimer);activeTimer=null,currentMonitoredRoom=null,alarmStage=0x0,_0x23175c[_0x217f50(0xb4)](_0x217f50(0x92),{'val':'ok','ack':!![]}),_0x23175c[_0x217f50(0xb4)]('analysis.safety.deadMan.smartSleep',{'val':![],'ack':!![]}),_0x23175c['setStateAsync'](_0x217f50(0x8c),{'val':0x0,'ack':!![]});}async function triggerPreWarn(_0x5a176a){const _0x1e1244=a2_0x51d823;alarmStage=0x1,await _0x5a176a['setStateAsync'](_0x1e1244(0x92),{'val':_0x1e1244(0xb6),'ack':!![]});const _0x2f2c1b=_0x1e1244(0xa6)+currentMonitoredRoom+_0x1e1244(0xaf);_0x5a176a[_0x1e1244(0xa0)]['warn'](_0x1e1244(0xa5)+_0x2f2c1b),await setup[_0x1e1244(0x9a)](_0x5a176a,_0x1e1244(0x9e)+_0x2f2c1b),activeTimer=setTimeout(()=>triggerAlarm(_0x5a176a),0x5*0x3c*0x3e8);}async function triggerAlarm(_0x371c40){const _0x867bb9=a2_0x51d823;alarmStage=0x2,await _0x371c40[_0x867bb9(0xb4)](_0x867bb9(0x92),{'val':_0x867bb9(0x88),'ack':!![]});const _0x23f879=_0x867bb9(0x85)+currentMonitoredRoom+'!';_0x371c40['log'][_0x867bb9(0xb2)](_0x867bb9(0xa5)+_0x23f879),await setup['sendNotification'](_0x371c40,_0x23f879,![],!![]);}function a2_0x1a14(){const _0x1a5717=['(((.+)+)+)+$','[DeadMan]\x20Topology\x20check\x20failed:\x20','73269hVlcLt','analysis.safety.deadMan.alarmState','analysis.safety.deadMan.smartSleep','üí§\x20Smart\x20Sleep\x20erkannt\x20(','76fWbtya','indexOf','getStateAsync','\x20um\x2090\x20Min.','bed','sendNotification','./setup','replace','stringify','üëº\x20Schutzengel-Frage:\x20','sofa','log','includes','\x27.\x20Nicht\x20verbunden\x20mit\x20√ºberwachtem\x20\x27','9561QOuGNF','2574852sgwJtR','[DeadMan]\x20','‚è≥\x20ACHTUNG:\x20Ungew√∂hnlich\x20lange\x20Inaktivit√§t\x20in\x20','16809vodgUP','4rvqEzW','analysis.safety.deadMan.currentRoom','val','analysis.safety.deadMan.active','üëº\x20Schutzengel:\x20√úberwache\x20','toString','parse','.\x20Alles\x20in\x20Ordnung?','default','analysis.safety.deadMan.lastIgnored','error','now','setStateAsync','1265550WKcZyM','pre_warn','apply','toFixed','schlaf','\x20(Multi-Person\x20Filter)','exports','6390054AQWsaS','info','424ThDUjx','\x20f√ºr\x20','üö®\x20NOTFALL-ALARM:\x20Person\x20reagiert\x20nicht\x20in\x20','toLowerCase','search','alarm','38983NRpsuV','\x20Min.','getHours','analysis.safety.deadMan.napProbability','Unknown','70MTTPsP'];a2_0x1a14=function(){return _0x1a5717;};return a2_0x1a14();}module[a2_0x51d823(0x80)]={'updateLocation':updateLocation};