const a2_0x3b6ea9=a2_0x4f15;(function(_0x2af746,_0x11ec15){const _0x364952=a2_0x4f15,_0x3199ed=_0x2af746();while(!![]){try{const _0x2d9786=parseInt(_0x364952(0x1af))/0x1*(-parseInt(_0x364952(0x18b))/0x2)+-parseInt(_0x364952(0x1be))/0x3+-parseInt(_0x364952(0x193))/0x4+-parseInt(_0x364952(0x1b6))/0x5+parseInt(_0x364952(0x1c1))/0x6+-parseInt(_0x364952(0x1a1))/0x7+parseInt(_0x364952(0x1c2))/0x8;if(_0x2d9786===_0x11ec15)break;else _0x3199ed['push'](_0x3199ed['shift']());}catch(_0x33dda3){_0x3199ed['push'](_0x3199ed['shift']());}}}(a2_0x9332,0x7d415));const a2_0x15e767=(function(){let _0x5a4075=!![];return function(_0x5f32b5,_0x229a11){const _0x56a4bd=_0x5a4075?function(){const _0x59ba16=a2_0x4f15;if(_0x229a11){const _0x1792bb=_0x229a11[_0x59ba16(0x199)](_0x5f32b5,arguments);return _0x229a11=null,_0x1792bb;}}:function(){};return _0x5a4075=![],_0x56a4bd;};}()),a2_0x14f751=a2_0x15e767(this,function(){const _0xe459fa=a2_0x4f15;return a2_0x14f751['toString']()['search'](_0xe459fa(0x1aa))[_0xe459fa(0x19e)]()[_0xe459fa(0x197)](a2_0x14f751)[_0xe459fa(0x195)](_0xe459fa(0x1aa));});a2_0x14f751();'use strict';const setup=require('./setup');let activeTimer=null,currentMonitoredRoom=null,timeoutMs=0x0,startTime=0x0,alarmStage=0x0;const DEFAULT_TIMEOUTS={'bad':0x2d,'bath':0x2d,'toilet':0x1e,'wc':0x1e,'keller':0x3c,'schlaf':0x78,'bed':0x78,'guest':0x5a,'gast':0x5a};function getTimeoutRobust(_0x6bab67,_0x2c35fb){const _0x5ae147=a2_0x4f15;if(!_0x6bab67||!_0x2c35fb)return undefined;if(_0x6bab67[_0x2c35fb])return _0x6bab67[_0x2c35fb];const _0x55eb55=_0x2c35fb[_0x5ae147(0x19c)]()[_0x5ae147(0x1b9)](/[^a-z0-9]/g,'');for(const _0x34c026 in _0x6bab67){const _0x552137=_0x34c026[_0x5ae147(0x19c)]()[_0x5ae147(0x1b9)](/[^a-z0-9]/g,'');if(_0x552137===_0x55eb55)return _0x6bab67[_0x34c026];}const _0x567e27=_0x2c35fb[_0x5ae147(0x19c)]();if(_0x6bab67[_0x567e27])return _0x6bab67[_0x567e27];return undefined;}function a2_0x4f15(_0x443351,_0x52da80){const _0x724129=a2_0x9332();return a2_0x4f15=function(_0x14f751,_0x15e767){_0x14f751=_0x14f751-0x18a;let _0x93322c=_0x724129[_0x14f751];return _0x93322c;},a2_0x4f15(_0x443351,_0x52da80);}async function loadConfig(_0x3cd90a){const _0x58cc83=a2_0x4f15;try{const _0x37be50=await _0x3cd90a[_0x58cc83(0x1a7)](_0x58cc83(0x1a3));if(_0x37be50&&_0x37be50['val'])return JSON[_0x58cc83(0x1bc)](_0x37be50[_0x58cc83(0x1ab)]);}catch(_0xfc5c68){}return{};}async function isActive(_0x4c9ef6){const _0x5e1d15=a2_0x4f15;try{const _0x4b1845=await _0x4c9ef6[_0x5e1d15(0x1a7)](_0x5e1d15(0x18d));return _0x4b1845&&_0x4b1845[_0x5e1d15(0x1ab)];}catch(_0x565eee){return![];}}async function areRoomsConnected(_0x198226,_0x22b03a,_0x491e01){const _0x1ad4e2=a2_0x4f15;try{const _0x1c785e=await _0x198226[_0x1ad4e2(0x1a7)](_0x1ad4e2(0x1ba));if(!_0x1c785e||!_0x1c785e['val'])return!![];const _0x5e66a4=JSON[_0x1ad4e2(0x1bc)](_0x1c785e[_0x1ad4e2(0x1ab)]),{rooms:_0x4335d0,matrix:_0x3ffd9f}=_0x5e66a4;if(!_0x4335d0||!_0x3ffd9f)return!![];const _0x1ca8ca=_0x4335d0[_0x1ad4e2(0x1a5)](_0x22b03a),_0x485564=_0x4335d0['indexOf'](_0x491e01);if(_0x1ca8ca===-0x1||_0x485564===-0x1)return!![];const _0x483d83=_0x3ffd9f[_0x1ca8ca][_0x485564]>0x0||_0x3ffd9f[_0x485564][_0x1ca8ca]>0x0;return _0x483d83;}catch(_0x341501){return _0x198226[_0x1ad4e2(0x1bf)][_0x1ad4e2(0x192)](_0x1ad4e2(0x1b0)+_0x341501[_0x1ad4e2(0x1b4)]),!![];}}function calculateSleepProbability(_0x5c73b9){const _0x547cf5=a2_0x4f15,_0xf376c2=new Date(),_0x39b109=_0xf376c2['getHours'](),_0x2c5728=_0x5c73b9[_0x547cf5(0x19c)]();let _0x1eb1e7=0.1;if(_0x39b109>=0x17||_0x39b109<=0x6)_0x1eb1e7=0x1;else{if(_0x39b109>=0xd&&_0x39b109<=0xf)_0x1eb1e7=0.8;else{if(_0x39b109>=0x14&&_0x39b109<=0x17)_0x1eb1e7=0.4;}}let _0x2e0138=0.1;if(_0x2c5728['includes'](_0x547cf5(0x18f))||_0x2c5728[_0x547cf5(0x19f)](_0x547cf5(0x1a0)))_0x2e0138=0x1;else{if(_0x2c5728[_0x547cf5(0x19f)](_0x547cf5(0x1b3))||_0x2c5728[_0x547cf5(0x19f)]('living')||_0x2c5728[_0x547cf5(0x19f)]('sofa'))_0x2e0138=0.6;else{if(_0x2c5728[_0x547cf5(0x19f)](_0x547cf5(0x1a4))||_0x2c5728[_0x547cf5(0x19f)]('wc'))_0x2e0138=0.05;}}let _0x43976d=0.5;const _0x350cac=_0x2e0138*0.5+_0x1eb1e7*0.3+_0x43976d*0.2;return parseFloat(_0x350cac[_0x547cf5(0x1ad)](0x2));}async function updateLocation(_0x5e3f5c,_0x5bba9f){const _0x55518d=a2_0x4f15;if(!_0x5bba9f||_0x5bba9f===_0x55518d(0x19d))return;if(!await isActive(_0x5e3f5c)){resetTimer(_0x5e3f5c);return;}if(currentMonitoredRoom&&currentMonitoredRoom!==_0x5bba9f){const _0x147813=await areRoomsConnected(_0x5e3f5c,currentMonitoredRoom,_0x5bba9f);if(!_0x147813){const _0x4b4be6=_0x55518d(0x198)+_0x5bba9f+_0x55518d(0x1b5)+currentMonitoredRoom+'\x27.';_0x5e3f5c['log'][_0x55518d(0x1b2)]('[DeadMan]\x20'+_0x4b4be6+'\x20(Multi-Person\x20Filter)'),await _0x5e3f5c['setStateAsync'](_0x55518d(0x1a2),{'val':JSON[_0x55518d(0x190)]({'room':_0x5bba9f,'reason':_0x4b4be6,'timestamp':Date[_0x55518d(0x1a6)]()}),'ack':!![]});return;}resetTimer(_0x5e3f5c);}if(!currentMonitoredRoom){await _0x5e3f5c[_0x55518d(0x1b1)](_0x55518d(0x1ae),{'val':_0x5bba9f,'ack':!![]});const _0x4f07a6=await loadConfig(_0x5e3f5c);let _0x206b21=getTimeoutRobust(_0x4f07a6,_0x5bba9f);const _0x533b93=_0x5bba9f['toLowerCase']();if(!_0x206b21)for(const _0x2a22c2 in DEFAULT_TIMEOUTS){if(_0x533b93[_0x55518d(0x19f)](_0x2a22c2)){_0x206b21=DEFAULT_TIMEOUTS[_0x2a22c2];break;}}if(!_0x206b21&&_0x4f07a6[_0x55518d(0x194)])_0x206b21=_0x4f07a6[_0x55518d(0x194)];if(!_0x206b21)return;currentMonitoredRoom=_0x5bba9f,startTimer(_0x5e3f5c,_0x206b21,_0x5bba9f);}}function startTimer(_0x3fc682,_0x566b7d,_0x4211a5){const _0x15aac9=a2_0x4f15;if(activeTimer)clearTimeout(activeTimer);timeoutMs=_0x566b7d*0x3c*0x3e8,startTime=Date[_0x15aac9(0x1a6)](),alarmStage=0x0;const _0x3e0b20=calculateSleepProbability(_0x4211a5||currentMonitoredRoom),_0x528410=_0x3e0b20>0.65;_0x528410?(timeoutMs+=0x5a*0x3c*0x3e8,_0x3fc682[_0x15aac9(0x1bf)]['info'](_0x15aac9(0x18c)+(_0x3e0b20*0x64)[_0x15aac9(0x1ad)](0x0)+_0x15aac9(0x18e)+currentMonitoredRoom+_0x15aac9(0x1ac)),_0x3fc682[_0x15aac9(0x1b1)](_0x15aac9(0x1a9),{'val':!![],'ack':!![]})):_0x3fc682['setStateAsync'](_0x15aac9(0x1a9),{'val':![],'ack':!![]}),_0x3fc682[_0x15aac9(0x1b1)]('analysis.safety.deadMan.napProbability',{'val':_0x3e0b20,'ack':!![]}),_0x3fc682[_0x15aac9(0x1bf)][_0x15aac9(0x1b2)](_0x15aac9(0x1bb)+currentMonitoredRoom+'\x20f√ºr\x20'+_0x566b7d+'\x20Min.'),_0x3fc682[_0x15aac9(0x1b1)](_0x15aac9(0x1b7),{'val':'ok','ack':!![]}),activeTimer=setTimeout(()=>triggerPreWarn(_0x3fc682),timeoutMs);}function resetTimer(_0x306132){const _0x4c67e2=a2_0x4f15;if(activeTimer)clearTimeout(activeTimer);activeTimer=null,currentMonitoredRoom=null,alarmStage=0x0,_0x306132[_0x4c67e2(0x1b1)](_0x4c67e2(0x1b7),{'val':'ok','ack':!![]}),_0x306132[_0x4c67e2(0x1b1)](_0x4c67e2(0x1a9),{'val':![],'ack':!![]}),_0x306132[_0x4c67e2(0x1b1)](_0x4c67e2(0x1b8),{'val':0x0,'ack':!![]});}async function triggerPreWarn(_0x345443){const _0xed69d2=a2_0x4f15;alarmStage=0x1,await _0x345443[_0xed69d2(0x1b1)]('analysis.safety.deadMan.alarmState',{'val':_0xed69d2(0x1bd),'ack':!![]});const _0x13a9e5=_0xed69d2(0x191)+currentMonitoredRoom+_0xed69d2(0x19a);_0x345443[_0xed69d2(0x1bf)][_0xed69d2(0x192)](_0xed69d2(0x1a8)+_0x13a9e5),await setup['sendNotification'](_0x345443,'üëº\x20Schutzengel-Frage:\x20'+_0x13a9e5),activeTimer=setTimeout(()=>triggerAlarm(_0x345443),0x5*0x3c*0x3e8);}function a2_0x9332(){const _0x134fa8=['üëº\x20Schutzengel:\x20√úberwache\x20','parse','pre_warn','2199354TYFgUu','log','error','5687682vAKoDs','17006240jVyXqx','exports','2brnWrG','üí§\x20Smart\x20Sleep\x20erkannt\x20(','analysis.safety.deadMan.active','%).\x20Verl√§ngere\x20Timer\x20f√ºr\x20','schlaf','stringify','‚è≥\x20ACHTUNG:\x20Ungew√∂hnlich\x20lange\x20Inaktivit√§t\x20in\x20','warn','811060nntcBz','default','search','sendNotification','constructor','Ignoriere\x20Bewegung\x20in\x20\x27','apply','.\x20Alles\x20in\x20Ordnung?','üö®\x20NOTFALL-ALARM:\x20Person\x20reagiert\x20nicht\x20in\x20','toLowerCase','Unknown','toString','includes','bed','5222476MVzTTC','analysis.safety.deadMan.lastIgnored','analysis.safety.deadMan.config','bad','indexOf','now','getStateAsync','[DeadMan]\x20','analysis.safety.deadMan.smartSleep','(((.+)+)+)+$','val','\x20um\x2090\x20Min.','toFixed','analysis.safety.deadMan.currentRoom','276163fwlkOC','[DeadMan]\x20Topology\x20check\x20failed:\x20','setStateAsync','info','wohn','message','\x27.\x20Nicht\x20verbunden\x20mit\x20√ºberwachtem\x20\x27','3012840YcAvZt','analysis.safety.deadMan.alarmState','analysis.safety.deadMan.napProbability','replace','analysis.topology.structure'];a2_0x9332=function(){return _0x134fa8;};return a2_0x9332();}async function triggerAlarm(_0x32f364){const _0x4859de=a2_0x4f15;alarmStage=0x2,await _0x32f364[_0x4859de(0x1b1)](_0x4859de(0x1b7),{'val':'alarm','ack':!![]});const _0x53d4d8=_0x4859de(0x19b)+currentMonitoredRoom+'!';_0x32f364[_0x4859de(0x1bf)][_0x4859de(0x1c0)](_0x4859de(0x1a8)+_0x53d4d8),await setup[_0x4859de(0x196)](_0x32f364,_0x53d4d8,![],!![]);}module[a2_0x3b6ea9(0x18a)]={'updateLocation':updateLocation};