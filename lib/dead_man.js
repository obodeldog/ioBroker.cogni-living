const a2_0x558946=a2_0x2329;(function(_0x36e2f7,_0xb384f7){const _0x6bd811=a2_0x2329,_0x8f8aa4=_0x36e2f7();while(!![]){try{const _0x372961=parseInt(_0x6bd811(0x101))/0x1+parseInt(_0x6bd811(0x126))/0x2*(-parseInt(_0x6bd811(0x107))/0x3)+-parseInt(_0x6bd811(0x11d))/0x4+-parseInt(_0x6bd811(0x127))/0x5*(parseInt(_0x6bd811(0x12a))/0x6)+-parseInt(_0x6bd811(0x12d))/0x7*(parseInt(_0x6bd811(0x114))/0x8)+parseInt(_0x6bd811(0x121))/0x9*(-parseInt(_0x6bd811(0xf3))/0xa)+parseInt(_0x6bd811(0x124))/0xb;if(_0x372961===_0xb384f7)break;else _0x8f8aa4['push'](_0x8f8aa4['shift']());}catch(_0x43001f){_0x8f8aa4['push'](_0x8f8aa4['shift']());}}}(a2_0xdca7,0x86ef1));const a2_0x5d28e4=(function(){let _0x2148f0=!![];return function(_0x50c2ff,_0x4d6657){const _0x3c2128=_0x2148f0?function(){const _0x3a6018=a2_0x2329;if(_0x4d6657){const _0x580dd4=_0x4d6657[_0x3a6018(0x100)](_0x50c2ff,arguments);return _0x4d6657=null,_0x580dd4;}}:function(){};return _0x2148f0=![],_0x3c2128;};}()),a2_0x24dae8=a2_0x5d28e4(this,function(){const _0x412403=a2_0x2329;return a2_0x24dae8['toString']()[_0x412403(0x10e)](_0x412403(0x113))[_0x412403(0x112)]()['constructor'](a2_0x24dae8)[_0x412403(0x10e)]('(((.+)+)+)+$');});a2_0x24dae8();function a2_0xdca7(){const _0x5bae88=['6892KzUBxW','6365WNMMcE','\x20um\x2090\x20Min.','\x20(Multi-Person\x20Filter)','2202EcHSzK','error','info','294pKNlza','analysis.safety.deadMan.lastIgnored','[DeadMan]\x20','2868880LxEogr','replace','alarm','val','analysis.safety.deadMan.alarmState','ðŸ’¤\x20Smart\x20Sleep\x20erkannt\x20(','living','.\x20Alles\x20in\x20Ordnung?','analysis.safety.deadMan.smartSleep','default','wohn','pre_warn','toLowerCase','apply','621372OjGwZK','exports','indexOf','Ignoriere\x20Bewegung\x20in\x20\x27','getStateAsync','ðŸ‘¼\x20Schutzengel:\x20Ãœberwache\x20','252GtRvlZ','parse','\x20fÃ¼r\x20','â³\x20ACHTUNG:\x20UngewÃ¶hnlich\x20lange\x20InaktivitÃ¤t\x20in\x20','schlaf','ðŸ‘¼\x20Schutzengel-Frage:\x20','analysis.safety.deadMan.currentRoom','search','./setup','%).\x20VerlÃ¤ngere\x20Timer\x20fÃ¼r\x20','sendNotification','toString','(((.+)+)+)+$','50712oucdno','includes','\x20Min.','analysis.safety.deadMan.active','analysis.topology.structure','log','toFixed','setStateAsync','\x27.\x20Nicht\x20verbunden\x20mit\x20Ã¼berwachtem\x20\x27','174480kqJjBa','getHours','now','ðŸš¨\x20NOTFALL-ALARM:\x20Person\x20reagiert\x20nicht\x20in\x20','9CwDrWR','analysis.safety.deadMan.napProbability','warn','14131898oDmPhH','Unknown'];a2_0xdca7=function(){return _0x5bae88;};return a2_0xdca7();}'use strict';const setup=require(a2_0x558946(0x10f));function a2_0x2329(_0x58a760,_0x445940){const _0x496ffc=a2_0xdca7();return a2_0x2329=function(_0x24dae8,_0x5d28e4){_0x24dae8=_0x24dae8-0xf2;let _0xdca70b=_0x496ffc[_0x24dae8];return _0xdca70b;},a2_0x2329(_0x58a760,_0x445940);}let activeTimer=null,currentMonitoredRoom=null,timeoutMs=0x0,startTime=0x0,alarmStage=0x0;const DEFAULT_TIMEOUTS={'bad':0x2d,'bath':0x2d,'toilet':0x1e,'wc':0x1e,'keller':0x3c,'schlaf':0x78,'bed':0x78,'guest':0x5a,'gast':0x5a};function getTimeoutRobust(_0x121519,_0x502164){const _0x1f9f08=a2_0x558946;if(!_0x121519||!_0x502164)return undefined;if(_0x121519[_0x502164])return _0x121519[_0x502164];const _0x49ae6c=_0x502164[_0x1f9f08(0xff)]()[_0x1f9f08(0xf4)](/[^a-z0-9]/g,'');for(const _0x424f93 in _0x121519){const _0x3e0a48=_0x424f93[_0x1f9f08(0xff)]()['replace'](/[^a-z0-9]/g,'');if(_0x3e0a48===_0x49ae6c)return _0x121519[_0x424f93];}const _0x5d10c0=_0x502164['toLowerCase']();if(_0x121519[_0x5d10c0])return _0x121519[_0x5d10c0];return undefined;}async function loadConfig(_0x3e9283){const _0x4e3385=a2_0x558946;try{const _0xc8077f=await _0x3e9283[_0x4e3385(0x105)]('analysis.safety.deadMan.config');if(_0xc8077f&&_0xc8077f['val'])return JSON['parse'](_0xc8077f[_0x4e3385(0xf6)]);}catch(_0x3d6622){}return{};}async function isActive(_0x2b0640){const _0x2b7e4c=a2_0x558946;try{const _0x16e1d5=await _0x2b0640[_0x2b7e4c(0x105)](_0x2b7e4c(0x117));return _0x16e1d5&&_0x16e1d5[_0x2b7e4c(0xf6)];}catch(_0x2d4646){return![];}}async function areRoomsConnected(_0x313733,_0x2d751e,_0x5399e7){const _0x3fd0c0=a2_0x558946;try{const _0x3149f9=await _0x313733[_0x3fd0c0(0x105)](_0x3fd0c0(0x118));if(!_0x3149f9||!_0x3149f9[_0x3fd0c0(0xf6)])return!![];const _0x3f0cf9=JSON[_0x3fd0c0(0x108)](_0x3149f9['val']),{rooms:_0x24c5b5,matrix:_0x10e4a2}=_0x3f0cf9;if(!_0x24c5b5||!_0x10e4a2)return!![];const _0x1fd58f=_0x24c5b5[_0x3fd0c0(0x103)](_0x2d751e),_0x143fad=_0x24c5b5['indexOf'](_0x5399e7);if(_0x1fd58f===-0x1||_0x143fad===-0x1)return!![];const _0x5e1b00=_0x10e4a2[_0x1fd58f][_0x143fad]>0x0||_0x10e4a2[_0x143fad][_0x1fd58f]>0x0;return _0x5e1b00;}catch(_0x5e3663){return _0x313733[_0x3fd0c0(0x119)][_0x3fd0c0(0x123)]('[DeadMan]\x20Topology\x20check\x20failed:\x20'+_0x5e3663['message']),!![];}}function calculateSleepProbability(_0x57eb48){const _0x40f07c=a2_0x558946,_0x5b4d64=new Date(),_0xc03c9b=_0x5b4d64[_0x40f07c(0x11e)](),_0x2d308a=_0x57eb48[_0x40f07c(0xff)]();let _0x3105b7=0.1;if(_0xc03c9b>=0x17||_0xc03c9b<=0x6)_0x3105b7=0x1;else{if(_0xc03c9b>=0xd&&_0xc03c9b<=0xf)_0x3105b7=0.8;else{if(_0xc03c9b>=0x14&&_0xc03c9b<=0x17)_0x3105b7=0.4;}}let _0x32bfe8=0.1;if(_0x2d308a['includes'](_0x40f07c(0x10b))||_0x2d308a[_0x40f07c(0x115)]('bed'))_0x32bfe8=0x1;else{if(_0x2d308a[_0x40f07c(0x115)](_0x40f07c(0xfd))||_0x2d308a[_0x40f07c(0x115)](_0x40f07c(0xf9))||_0x2d308a[_0x40f07c(0x115)]('sofa'))_0x32bfe8=0.6;else{if(_0x2d308a[_0x40f07c(0x115)]('bad')||_0x2d308a[_0x40f07c(0x115)]('wc'))_0x32bfe8=0.05;}}let _0x22c3af=0.5;const _0x2d2c6c=_0x32bfe8*0.5+_0x3105b7*0.3+_0x22c3af*0.2;return parseFloat(_0x2d2c6c[_0x40f07c(0x11a)](0x2));}async function updateLocation(_0x377801,_0x32d366){const _0x25ffce=a2_0x558946;if(!_0x32d366||_0x32d366===_0x25ffce(0x125))return;if(!await isActive(_0x377801)){resetTimer(_0x377801);return;}if(currentMonitoredRoom&&currentMonitoredRoom!==_0x32d366){const _0x465b0c=await areRoomsConnected(_0x377801,currentMonitoredRoom,_0x32d366);if(!_0x465b0c){const _0x1c10ff=_0x25ffce(0x104)+_0x32d366+_0x25ffce(0x11c)+currentMonitoredRoom+'\x27.';_0x377801[_0x25ffce(0x119)]['info'](_0x25ffce(0xf2)+_0x1c10ff+_0x25ffce(0x129)),await _0x377801['setStateAsync'](_0x25ffce(0x12e),{'val':JSON['stringify']({'room':_0x32d366,'reason':_0x1c10ff,'timestamp':Date[_0x25ffce(0x11f)]()}),'ack':!![]});return;}resetTimer(_0x377801);}if(!currentMonitoredRoom){await _0x377801['setStateAsync'](_0x25ffce(0x10d),{'val':_0x32d366,'ack':!![]});const _0x49ec3d=await loadConfig(_0x377801);let _0x245071=getTimeoutRobust(_0x49ec3d,_0x32d366);const _0x146251=_0x32d366[_0x25ffce(0xff)]();if(!_0x245071)for(const _0x4e5db6 in DEFAULT_TIMEOUTS){if(_0x146251['includes'](_0x4e5db6)){_0x245071=DEFAULT_TIMEOUTS[_0x4e5db6];break;}}if(!_0x245071&&_0x49ec3d[_0x25ffce(0xfc)])_0x245071=_0x49ec3d[_0x25ffce(0xfc)];if(!_0x245071)return;currentMonitoredRoom=_0x32d366,startTimer(_0x377801,_0x245071,_0x32d366);}}function startTimer(_0x3181f6,_0x4221c0,_0x43f536){const _0x543cb0=a2_0x558946;if(activeTimer)clearTimeout(activeTimer);timeoutMs=_0x4221c0*0x3c*0x3e8,startTime=Date[_0x543cb0(0x11f)](),alarmStage=0x0;const _0x107f31=calculateSleepProbability(_0x43f536||currentMonitoredRoom),_0x466ca2=_0x107f31>0.65;_0x466ca2?(timeoutMs+=0x5a*0x3c*0x3e8,_0x3181f6[_0x543cb0(0x119)]['info'](_0x543cb0(0xf8)+(_0x107f31*0x64)[_0x543cb0(0x11a)](0x0)+_0x543cb0(0x110)+currentMonitoredRoom+_0x543cb0(0x128)),_0x3181f6['setStateAsync']('analysis.safety.deadMan.smartSleep',{'val':!![],'ack':!![]})):_0x3181f6['setStateAsync'](_0x543cb0(0xfb),{'val':![],'ack':!![]}),_0x3181f6['setStateAsync'](_0x543cb0(0x122),{'val':_0x107f31,'ack':!![]}),_0x3181f6[_0x543cb0(0x119)][_0x543cb0(0x12c)](_0x543cb0(0x106)+currentMonitoredRoom+_0x543cb0(0x109)+_0x4221c0+_0x543cb0(0x116)),_0x3181f6['setStateAsync'](_0x543cb0(0xf7),{'val':'ok','ack':!![]}),activeTimer=setTimeout(()=>triggerPreWarn(_0x3181f6),timeoutMs);}function resetTimer(_0x7dd830){const _0x5c5d7f=a2_0x558946;if(activeTimer)clearTimeout(activeTimer);activeTimer=null,currentMonitoredRoom=null,alarmStage=0x0,_0x7dd830[_0x5c5d7f(0x11b)](_0x5c5d7f(0xf7),{'val':'ok','ack':!![]}),_0x7dd830[_0x5c5d7f(0x11b)](_0x5c5d7f(0xfb),{'val':![],'ack':!![]}),_0x7dd830[_0x5c5d7f(0x11b)](_0x5c5d7f(0x122),{'val':0x0,'ack':!![]});}async function triggerPreWarn(_0x52a4ce){const _0x142d5a=a2_0x558946;alarmStage=0x1,await _0x52a4ce[_0x142d5a(0x11b)]('analysis.safety.deadMan.alarmState',{'val':_0x142d5a(0xfe),'ack':!![]});const _0x30cd31=_0x142d5a(0x10a)+currentMonitoredRoom+_0x142d5a(0xfa);_0x52a4ce[_0x142d5a(0x119)][_0x142d5a(0x123)](_0x142d5a(0xf2)+_0x30cd31),await setup[_0x142d5a(0x111)](_0x52a4ce,_0x142d5a(0x10c)+_0x30cd31),activeTimer=setTimeout(()=>triggerAlarm(_0x52a4ce),0x5*0x3c*0x3e8);}async function triggerAlarm(_0x3fb32d){const _0x895f6f=a2_0x558946;alarmStage=0x2,await _0x3fb32d[_0x895f6f(0x11b)](_0x895f6f(0xf7),{'val':_0x895f6f(0xf5),'ack':!![]});const _0x358916=_0x895f6f(0x120)+currentMonitoredRoom+'!';_0x3fb32d[_0x895f6f(0x119)][_0x895f6f(0x12b)](_0x895f6f(0xf2)+_0x358916),await setup[_0x895f6f(0x111)](_0x3fb32d,_0x358916,![],!![]);}module[a2_0x558946(0x102)]={'updateLocation':updateLocation};