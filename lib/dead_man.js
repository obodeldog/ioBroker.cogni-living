const a2_0x38a7ff=a2_0x38f4;(function(_0x464027,_0x10dc22){const _0x1720b3=a2_0x38f4,_0x40e8b4=_0x464027();while(!![]){try{const _0x54cd63=parseInt(_0x1720b3(0xbc))/0x1+parseInt(_0x1720b3(0xc9))/0x2+-parseInt(_0x1720b3(0x9c))/0x3*(parseInt(_0x1720b3(0xaf))/0x4)+-parseInt(_0x1720b3(0xac))/0x5+parseInt(_0x1720b3(0x9d))/0x6+parseInt(_0x1720b3(0xb2))/0x7+parseInt(_0x1720b3(0xa4))/0x8*(-parseInt(_0x1720b3(0xa6))/0x9);if(_0x54cd63===_0x10dc22)break;else _0x40e8b4['push'](_0x40e8b4['shift']());}catch(_0x118901){_0x40e8b4['push'](_0x40e8b4['shift']());}}}(a2_0x6297,0x69909));const a2_0x48625b=(function(){let _0x13a59b=!![];return function(_0x164e36,_0x5ee832){const _0xa4ba78=_0x13a59b?function(){const _0x2aa2bd=a2_0x38f4;if(_0x5ee832){const _0x1413bd=_0x5ee832[_0x2aa2bd(0xba)](_0x164e36,arguments);return _0x5ee832=null,_0x1413bd;}}:function(){};return _0x13a59b=![],_0xa4ba78;};}()),a2_0x503ee0=a2_0x48625b(this,function(){const _0x10c03b=a2_0x38f4;return a2_0x503ee0[_0x10c03b(0xbb)]()[_0x10c03b(0x9e)](_0x10c03b(0xa9))['toString']()['constructor'](a2_0x503ee0)[_0x10c03b(0x9e)]('(((.+)+)+)+$');});a2_0x503ee0();function a2_0x6297(){const _0xf2792e=['Ignoriere\x20Bewegung\x20in\x20\x27','val','(((.+)+)+)+$','setStateAsync','log','1267020tQvNNG','error','\x20fÃ¼r\x20','1965412EhCxSB','stringify','\x20Min.','4249581AgWBbC','./setup','warn','parse','now','analysis.safety.deadMan.lastIgnored','toLowerCase','getStateAsync','apply','toString','186896NRSmtc','[DeadMan]\x20Topology\x20check\x20failed:\x20','ðŸ‘¼\x20Schutzengel-Frage:\x20','.\x20Alles\x20in\x20Ordnung?','sendNotification','analysis.safety.deadMan.currentRoom','analysis.safety.deadMan.alarmState','analysis.topology.structure','indexOf','includes','pre_warn','alarm','analysis.safety.deadMan.config','1439884sgHVzT','info','3JJuFXJ','3105210mWmbXj','search','default','analysis.safety.deadMan.active','ðŸ‘¼\x20Schutzengel:\x20Ãœberwache\x20','[DeadMan]\x20','â³\x20ACHTUNG:\x20UngewÃ¶hnlich\x20lange\x20InaktivitÃ¤t\x20in\x20','6834448fbFJVK','Unknown','9CVJVPy'];a2_0x6297=function(){return _0xf2792e;};return a2_0x6297();}'use strict';const setup=require(a2_0x38a7ff(0xb3));let activeTimer=null,currentMonitoredRoom=null,timeoutMs=0x0,startTime=0x0,alarmStage=0x0;function a2_0x38f4(_0x33c2f6,_0x15ef43){const _0x580183=a2_0x6297();return a2_0x38f4=function(_0x503ee0,_0x48625b){_0x503ee0=_0x503ee0-0x9b;let _0x629776=_0x580183[_0x503ee0];return _0x629776;},a2_0x38f4(_0x33c2f6,_0x15ef43);}const DEFAULT_TIMEOUTS={'bad':0x2d,'bath':0x2d,'toilet':0x1e,'wc':0x1e,'keller':0x3c};async function loadConfig(_0x4b5a53){const _0x2194d7=a2_0x38a7ff;try{const _0x48a202=await _0x4b5a53[_0x2194d7(0xb9)](_0x2194d7(0xc8));if(_0x48a202&&_0x48a202[_0x2194d7(0xa8)])return JSON['parse'](_0x48a202['val']);}catch(_0x331439){}return{};}async function isActive(_0x13b3d2){const _0x3d0f7f=a2_0x38a7ff;try{const _0x195a63=await _0x13b3d2['getStateAsync'](_0x3d0f7f(0xa0));return _0x195a63&&_0x195a63[_0x3d0f7f(0xa8)];}catch(_0x396825){return![];}}async function areRoomsConnected(_0x19e96a,_0x5ebc97,_0x56771e){const _0xf5f18=a2_0x38a7ff;try{const _0x1be9b1=await _0x19e96a[_0xf5f18(0xb9)](_0xf5f18(0xc3));if(!_0x1be9b1||!_0x1be9b1[_0xf5f18(0xa8)])return!![];const _0x360a65=JSON[_0xf5f18(0xb5)](_0x1be9b1[_0xf5f18(0xa8)]),{rooms:_0x315229,matrix:_0x43130c}=_0x360a65;if(!_0x315229||!_0x43130c)return!![];const _0x1dca00=_0x315229['indexOf'](_0x5ebc97),_0x6287d6=_0x315229[_0xf5f18(0xc4)](_0x56771e);if(_0x1dca00===-0x1||_0x6287d6===-0x1)return!![];const _0x58953f=_0x43130c[_0x1dca00][_0x6287d6]>0x0||_0x43130c[_0x6287d6][_0x1dca00]>0x0;return _0x58953f;}catch(_0x3c3f0e){return _0x19e96a[_0xf5f18(0xab)][_0xf5f18(0xb4)](_0xf5f18(0xbd)+_0x3c3f0e['message']),!![];}}async function updateLocation(_0x11aa93,_0x10ffcc){const _0xd3c7c8=a2_0x38a7ff;if(!_0x10ffcc||_0x10ffcc===_0xd3c7c8(0xa5))return;if(!await isActive(_0x11aa93)){resetTimer(_0x11aa93);return;}if(currentMonitoredRoom&&currentMonitoredRoom!==_0x10ffcc){const _0x4553ca=await areRoomsConnected(_0x11aa93,currentMonitoredRoom,_0x10ffcc);if(!_0x4553ca){const _0x3a96e9=_0xd3c7c8(0xa7)+_0x10ffcc+'\x27.\x20Nicht\x20verbunden\x20mit\x20Ã¼berwachtem\x20\x27'+currentMonitoredRoom+'\x27.';_0x11aa93[_0xd3c7c8(0xab)][_0xd3c7c8(0x9b)](_0xd3c7c8(0xa2)+_0x3a96e9+'\x20(Multi-Person\x20Filter)'),await _0x11aa93[_0xd3c7c8(0xaa)](_0xd3c7c8(0xb7),{'val':JSON[_0xd3c7c8(0xb0)]({'room':_0x10ffcc,'reason':_0x3a96e9,'timestamp':Date[_0xd3c7c8(0xb6)]()}),'ack':!![]});return;}resetTimer(_0x11aa93);}if(!currentMonitoredRoom){await _0x11aa93[_0xd3c7c8(0xaa)](_0xd3c7c8(0xc1),{'val':_0x10ffcc,'ack':!![]});const _0x519a94=await loadConfig(_0x11aa93),_0x18cdf0=_0x10ffcc[_0xd3c7c8(0xb8)]();let _0x327305=_0x519a94[_0x10ffcc]||_0x519a94[_0x18cdf0];if(!_0x327305)for(const _0x4cf5f5 in DEFAULT_TIMEOUTS){if(_0x18cdf0[_0xd3c7c8(0xc5)](_0x4cf5f5)){_0x327305=DEFAULT_TIMEOUTS[_0x4cf5f5];break;}}if(!_0x327305&&_0x519a94[_0xd3c7c8(0x9f)])_0x327305=_0x519a94[_0xd3c7c8(0x9f)];if(!_0x327305)return;currentMonitoredRoom=_0x10ffcc,startTimer(_0x11aa93,_0x327305);}}function startTimer(_0x1eaa12,_0x3fa865){const _0x58a83d=a2_0x38a7ff;if(activeTimer)clearTimeout(activeTimer);timeoutMs=_0x3fa865*0x3c*0x3e8,startTime=Date[_0x58a83d(0xb6)](),alarmStage=0x0,_0x1eaa12[_0x58a83d(0xab)][_0x58a83d(0x9b)](_0x58a83d(0xa1)+currentMonitoredRoom+_0x58a83d(0xae)+_0x3fa865+_0x58a83d(0xb1)),_0x1eaa12['setStateAsync']('analysis.safety.deadMan.alarmState',{'val':'ok','ack':!![]}),activeTimer=setTimeout(()=>triggerPreWarn(_0x1eaa12),timeoutMs);}function resetTimer(_0x2e3293){const _0x4bf016=a2_0x38a7ff;if(activeTimer)clearTimeout(activeTimer);activeTimer=null,currentMonitoredRoom=null,alarmStage=0x0,_0x2e3293[_0x4bf016(0xaa)](_0x4bf016(0xc2),{'val':'ok','ack':!![]});}async function triggerPreWarn(_0x4d7a0e){const _0x4fd07e=a2_0x38a7ff;alarmStage=0x1,await _0x4d7a0e['setStateAsync'](_0x4fd07e(0xc2),{'val':_0x4fd07e(0xc6),'ack':!![]});const _0x11fcd7=_0x4fd07e(0xa3)+currentMonitoredRoom+_0x4fd07e(0xbf);_0x4d7a0e['log'][_0x4fd07e(0xb4)](_0x4fd07e(0xa2)+_0x11fcd7),await setup[_0x4fd07e(0xc0)](_0x4d7a0e,_0x4fd07e(0xbe)+_0x11fcd7),activeTimer=setTimeout(()=>triggerAlarm(_0x4d7a0e),0x5*0x3c*0x3e8);}async function triggerAlarm(_0x1d3fb8){const _0x3124de=a2_0x38a7ff;alarmStage=0x2,await _0x1d3fb8['setStateAsync'](_0x3124de(0xc2),{'val':_0x3124de(0xc7),'ack':!![]});const _0x391a79='ðŸš¨\x20NOTFALL-ALARM:\x20Person\x20reagiert\x20nicht\x20in\x20'+currentMonitoredRoom+'!';_0x1d3fb8['log'][_0x3124de(0xad)](_0x3124de(0xa2)+_0x391a79),await setup[_0x3124de(0xc0)](_0x1d3fb8,_0x391a79,![],!![]);}module['exports']={'updateLocation':updateLocation};