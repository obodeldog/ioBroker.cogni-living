const a2_0x4dde66=a2_0x58f6;(function(_0x3bcd20,_0x397e4c){const _0x4bdf96=a2_0x58f6,_0x40483e=_0x3bcd20();while(!![]){try{const _0x18248b=-parseInt(_0x4bdf96(0x161))/0x1*(-parseInt(_0x4bdf96(0x17f))/0x2)+-parseInt(_0x4bdf96(0x16a))/0x3*(parseInt(_0x4bdf96(0x170))/0x4)+-parseInt(_0x4bdf96(0x18f))/0x5*(parseInt(_0x4bdf96(0x168))/0x6)+parseInt(_0x4bdf96(0x17b))/0x7+-parseInt(_0x4bdf96(0x17d))/0x8*(-parseInt(_0x4bdf96(0x182))/0x9)+-parseInt(_0x4bdf96(0x167))/0xa+parseInt(_0x4bdf96(0x194))/0xb;if(_0x18248b===_0x397e4c)break;else _0x40483e['push'](_0x40483e['shift']());}catch(_0x2680e2){_0x40483e['push'](_0x40483e['shift']());}}}(a2_0x4f21,0xa87eb));const a2_0x4d8d6a=(function(){let _0x3e618a=!![];return function(_0x394675,_0x5a8cb9){const _0x4eefe1=_0x3e618a?function(){if(_0x5a8cb9){const _0x1a11d7=_0x5a8cb9['apply'](_0x394675,arguments);return _0x5a8cb9=null,_0x1a11d7;}}:function(){};return _0x3e618a=![],_0x4eefe1;};}()),a2_0xacf9fd=a2_0x4d8d6a(this,function(){const _0x954758=a2_0x58f6;return a2_0xacf9fd[_0x954758(0x189)]()[_0x954758(0x184)](_0x954758(0x160))[_0x954758(0x189)]()['constructor'](a2_0xacf9fd)['search']('(((.+)+)+)+$');});a2_0xacf9fd();'use strict';const setup=require('./setup');function a2_0x58f6(_0xc28b28,_0x264ac2){const _0x319a39=a2_0x4f21();return a2_0x58f6=function(_0xacf9fd,_0x4d8d6a){_0xacf9fd=_0xacf9fd-0x15d;let _0x4f211a=_0x319a39[_0xacf9fd];return _0x4f211a;},a2_0x58f6(_0xc28b28,_0x264ac2);}let activeTimer=null,currentMonitoredRoom=null,timeoutMs=0x0,startTime=0x0,alarmStage=0x0;const DEFAULT_TIMEOUTS={'bad':0x2d,'bath':0x2d,'toilet':0x1e,'wc':0x1e,'keller':0x3c,'schlaf':0x78,'bed':0x78,'guest':0x5a,'gast':0x5a};async function loadConfig(_0xf594c){const _0x5aab0f=a2_0x58f6;try{const _0x5c57f8=await _0xf594c[_0x5aab0f(0x176)]('analysis.safety.deadMan.config');if(_0x5c57f8&&_0x5c57f8[_0x5aab0f(0x166)])return JSON[_0x5aab0f(0x174)](_0x5c57f8['val']);}catch(_0x48afa4){}return{};}async function isActive(_0x4b0481){const _0x852b12=a2_0x58f6;try{const _0x19a766=await _0x4b0481['getStateAsync'](_0x852b12(0x187));return _0x19a766&&_0x19a766[_0x852b12(0x166)];}catch(_0x1f279a){return![];}}async function areRoomsConnected(_0x1e665c,_0x2336e2,_0x16e1e9){const _0x4b974e=a2_0x58f6;try{const _0x1b0a08=await _0x1e665c[_0x4b974e(0x176)](_0x4b974e(0x175));if(!_0x1b0a08||!_0x1b0a08[_0x4b974e(0x166)])return!![];const _0x4380bb=JSON[_0x4b974e(0x174)](_0x1b0a08[_0x4b974e(0x166)]),{rooms:_0x19ed59,matrix:_0x54e0b0}=_0x4380bb;if(!_0x19ed59||!_0x54e0b0)return!![];const _0x163fb6=_0x19ed59[_0x4b974e(0x16b)](_0x2336e2),_0x16b483=_0x19ed59[_0x4b974e(0x16b)](_0x16e1e9);if(_0x163fb6===-0x1||_0x16b483===-0x1)return!![];const _0xe6f088=_0x54e0b0[_0x163fb6][_0x16b483]>0x0||_0x54e0b0[_0x16b483][_0x163fb6]>0x0;return _0xe6f088;}catch(_0x31cfe4){return _0x1e665c[_0x4b974e(0x180)]['warn'](_0x4b974e(0x162)+_0x31cfe4[_0x4b974e(0x17a)]),!![];}}function calculateSleepProbability(_0x287aed){const _0x129283=a2_0x58f6,_0x38f95b=new Date(),_0x44aabc=_0x38f95b[_0x129283(0x16d)](),_0x29b7e6=_0x287aed[_0x129283(0x18a)]();let _0x53ba24=0.1;if(_0x44aabc>=0x17||_0x44aabc<=0x6)_0x53ba24=0x1;else{if(_0x44aabc>=0xd&&_0x44aabc<=0xf)_0x53ba24=0.8;else{if(_0x44aabc>=0x14&&_0x44aabc<=0x17)_0x53ba24=0.4;}}let _0x26b281=0.1;if(_0x29b7e6[_0x129283(0x17c)](_0x129283(0x164))||_0x29b7e6[_0x129283(0x17c)]('bed'))_0x26b281=0x1;else{if(_0x29b7e6['includes'](_0x129283(0x191))||_0x29b7e6[_0x129283(0x17c)]('living')||_0x29b7e6['includes']('sofa'))_0x26b281=0.6;else{if(_0x29b7e6[_0x129283(0x17c)](_0x129283(0x18b))||_0x29b7e6['includes']('wc'))_0x26b281=0.05;}}let _0x316b0a=0.5;const _0xa6483c=_0x26b281*0.5+_0x53ba24*0.3+_0x316b0a*0.2;return parseFloat(_0xa6483c[_0x129283(0x177)](0x2));}async function updateLocation(_0x4540f3,_0x2dc872){const _0x1be612=a2_0x58f6;if(!_0x2dc872||_0x2dc872===_0x1be612(0x178))return;if(!await isActive(_0x4540f3)){resetTimer(_0x4540f3);return;}if(currentMonitoredRoom&&currentMonitoredRoom!==_0x2dc872){const _0x1a7ea3=await areRoomsConnected(_0x4540f3,currentMonitoredRoom,_0x2dc872);if(!_0x1a7ea3){const _0x132d1e=_0x1be612(0x18e)+_0x2dc872+_0x1be612(0x192)+currentMonitoredRoom+'\x27.';_0x4540f3[_0x1be612(0x180)]['info']('[DeadMan]\x20'+_0x132d1e+_0x1be612(0x169)),await _0x4540f3[_0x1be612(0x188)](_0x1be612(0x185),{'val':JSON[_0x1be612(0x15d)]({'room':_0x2dc872,'reason':_0x132d1e,'timestamp':Date[_0x1be612(0x16c)]()}),'ack':!![]});return;}resetTimer(_0x4540f3);}if(!currentMonitoredRoom){await _0x4540f3[_0x1be612(0x188)](_0x1be612(0x15f),{'val':_0x2dc872,'ack':!![]});const _0x1b859e=await loadConfig(_0x4540f3),_0x29517b=_0x2dc872['toLowerCase']();let _0x5c07e9=_0x1b859e[_0x2dc872]||_0x1b859e[_0x29517b];if(!_0x5c07e9)for(const _0x40bf59 in DEFAULT_TIMEOUTS){if(_0x29517b[_0x1be612(0x17c)](_0x40bf59)){_0x5c07e9=DEFAULT_TIMEOUTS[_0x40bf59];break;}}if(!_0x5c07e9&&_0x1b859e[_0x1be612(0x18c)])_0x5c07e9=_0x1b859e[_0x1be612(0x18c)];if(!_0x5c07e9)return;currentMonitoredRoom=_0x2dc872,startTimer(_0x4540f3,_0x5c07e9,_0x2dc872);}}function startTimer(_0x427631,_0x283a36,_0x1e2296){const _0x4b9364=a2_0x58f6;if(activeTimer)clearTimeout(activeTimer);timeoutMs=_0x283a36*0x3c*0x3e8,startTime=Date[_0x4b9364(0x16c)](),alarmStage=0x0;const _0x46cfc9=calculateSleepProbability(_0x1e2296||currentMonitoredRoom),_0x4fff01=_0x46cfc9>0.65;_0x4fff01?(timeoutMs+=0x5a*0x3c*0x3e8,_0x427631['log'][_0x4b9364(0x181)]('üí§\x20Smart\x20Sleep\x20erkannt\x20('+(_0x46cfc9*0x64)['toFixed'](0x0)+_0x4b9364(0x179)+currentMonitoredRoom+_0x4b9364(0x15e)),_0x427631['setStateAsync'](_0x4b9364(0x16e),{'val':!![],'ack':!![]})):_0x427631[_0x4b9364(0x188)]('analysis.safety.deadMan.smartSleep',{'val':![],'ack':!![]}),_0x427631[_0x4b9364(0x188)]('analysis.safety.deadMan.napProbability',{'val':_0x46cfc9,'ack':!![]}),_0x427631[_0x4b9364(0x180)][_0x4b9364(0x181)]('üëº\x20Schutzengel:\x20√úberwache\x20'+currentMonitoredRoom+_0x4b9364(0x163)+_0x283a36+_0x4b9364(0x18d)),_0x427631[_0x4b9364(0x188)](_0x4b9364(0x183),{'val':'ok','ack':!![]}),activeTimer=setTimeout(()=>triggerPreWarn(_0x427631),timeoutMs);}function resetTimer(_0x1ee6c3){const _0x177d1d=a2_0x58f6;if(activeTimer)clearTimeout(activeTimer);activeTimer=null,currentMonitoredRoom=null,alarmStage=0x0,_0x1ee6c3[_0x177d1d(0x188)](_0x177d1d(0x183),{'val':'ok','ack':!![]}),_0x1ee6c3[_0x177d1d(0x188)]('analysis.safety.deadMan.smartSleep',{'val':![],'ack':!![]}),_0x1ee6c3['setStateAsync']('analysis.safety.deadMan.napProbability',{'val':0x0,'ack':!![]});}async function triggerPreWarn(_0x54371c){const _0x125c23=a2_0x58f6;alarmStage=0x1,await _0x54371c[_0x125c23(0x188)](_0x125c23(0x183),{'val':_0x125c23(0x17e),'ack':!![]});const _0xda224c=_0x125c23(0x172)+currentMonitoredRoom+'.\x20Alles\x20in\x20Ordnung?';_0x54371c[_0x125c23(0x180)]['warn'](_0x125c23(0x165)+_0xda224c),await setup[_0x125c23(0x193)](_0x54371c,_0x125c23(0x190)+_0xda224c),activeTimer=setTimeout(()=>triggerAlarm(_0x54371c),0x5*0x3c*0x3e8);}async function triggerAlarm(_0x2112a0){const _0x1424c2=a2_0x58f6;alarmStage=0x2,await _0x2112a0[_0x1424c2(0x188)](_0x1424c2(0x183),{'val':_0x1424c2(0x16f),'ack':!![]});const _0x4a421a=_0x1424c2(0x171)+currentMonitoredRoom+'!';_0x2112a0[_0x1424c2(0x180)][_0x1424c2(0x173)](_0x1424c2(0x165)+_0x4a421a),await setup[_0x1424c2(0x193)](_0x2112a0,_0x4a421a,![],!![]);}function a2_0x4f21(){const _0x4e8419=['analysis.topology.structure','getStateAsync','toFixed','Unknown','%).\x20Verl√§ngere\x20Timer\x20f√ºr\x20','message','5333874BqKPPG','includes','11392ZsfccS','pre_warn','74618ZQBveY','log','info','2556DWXnXp','analysis.safety.deadMan.alarmState','search','analysis.safety.deadMan.lastIgnored','exports','analysis.safety.deadMan.active','setStateAsync','toString','toLowerCase','bad','default','\x20Min.','Ignoriere\x20Bewegung\x20in\x20\x27','5rSgzor','üëº\x20Schutzengel-Frage:\x20','wohn','\x27.\x20Nicht\x20verbunden\x20mit\x20√ºberwachtem\x20\x27','sendNotification','17039231BeRfcC','stringify','\x20um\x2090\x20Min.','analysis.safety.deadMan.currentRoom','(((.+)+)+)+$','2zDCsTt','[DeadMan]\x20Topology\x20check\x20failed:\x20','\x20f√ºr\x20','schlaf','[DeadMan]\x20','val','868270qSwCGc','7560114GPvsSD','\x20(Multi-Person\x20Filter)','3WZtmRe','indexOf','now','getHours','analysis.safety.deadMan.smartSleep','alarm','3012144zGBaGq','üö®\x20NOTFALL-ALARM:\x20Person\x20reagiert\x20nicht\x20in\x20','‚è≥\x20ACHTUNG:\x20Ungew√∂hnlich\x20lange\x20Inaktivit√§t\x20in\x20','error','parse'];a2_0x4f21=function(){return _0x4e8419;};return a2_0x4f21();}module[a2_0x4dde66(0x186)]={'updateLocation':updateLocation};