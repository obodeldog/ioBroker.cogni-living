const a2_0x36760d=a2_0xcdfa;(function(_0x29b94d,_0x5e2a11){const _0x1b92ed=a2_0xcdfa,_0x29fe56=_0x29b94d();while(!![]){try{const _0x52f525=parseInt(_0x1b92ed(0x86))/0x1+parseInt(_0x1b92ed(0x9b))/0x2+parseInt(_0x1b92ed(0x91))/0x3+parseInt(_0x1b92ed(0xa7))/0x4*(parseInt(_0x1b92ed(0x8e))/0x5)+-parseInt(_0x1b92ed(0xa2))/0x6+-parseInt(_0x1b92ed(0xa9))/0x7*(parseInt(_0x1b92ed(0x87))/0x8)+-parseInt(_0x1b92ed(0x8f))/0x9*(parseInt(_0x1b92ed(0x88))/0xa);if(_0x52f525===_0x5e2a11)break;else _0x29fe56['push'](_0x29fe56['shift']());}catch(_0x351266){_0x29fe56['push'](_0x29fe56['shift']());}}}(a2_0x2646,0xdeb83));const a2_0x3f1e5b=(function(){let _0x5d8a29=!![];return function(_0x2b861c,_0x34543e){const _0x2f8b7a=_0x5d8a29?function(){const _0x3db818=a2_0xcdfa;if(_0x34543e){const _0x33a4bc=_0x34543e[_0x3db818(0xa8)](_0x2b861c,arguments);return _0x34543e=null,_0x33a4bc;}}:function(){};return _0x5d8a29=![],_0x2f8b7a;};}()),a2_0x3c02fa=a2_0x3f1e5b(this,function(){const _0x110cd9=a2_0xcdfa;return a2_0x3c02fa[_0x110cd9(0xa5)]()['search'](_0x110cd9(0xab))[_0x110cd9(0xa5)]()[_0x110cd9(0x97)](a2_0x3c02fa)[_0x110cd9(0x85)](_0x110cd9(0xab));});a2_0x3c02fa();function a2_0x2646(){const _0x32255e=['\x20fÃ¼r\x20','analysis.safety.deadMan.currentRoom','\x20(Multi-Person\x20Filter)','analysis.safety.deadMan.alarmState','constructor','./setup','analysis.safety.deadMan.active','info','2155646qWTxZB','\x27.\x20Nicht\x20verbunden\x20mit\x20Ã¼berwachtem\x20\x27','analysis.safety.deadMan.lastIgnored','default','stringify','now','warn','6218388ixLvLi','getStateAsync','toLowerCase','toString','error','704KtJppN','apply','346927xCpdeH','[DeadMan]\x20Topology\x20check\x20failed:\x20','(((.+)+)+)+$','indexOf','log','Unknown','analysis.safety.deadMan.config','includes','val','Ignoriere\x20Bewegung\x20in\x20\x27','sendNotification','search','856218vijJrm','8rvysvM','80TieRgf','parse','ðŸ‘¼\x20Schutzengel-Frage:\x20','setStateAsync','[DeadMan]\x20','â³\x20ACHTUNG:\x20UngewÃ¶hnlich\x20lange\x20InaktivitÃ¤t\x20in\x20','40675qtKmKn','2374263aVHNFL','analysis.topology.structure','2228619yoMBaT','alarm'];a2_0x2646=function(){return _0x32255e;};return a2_0x2646();}'use strict';const setup=require(a2_0x36760d(0x98));let activeTimer=null,currentMonitoredRoom=null,timeoutMs=0x0,startTime=0x0,alarmStage=0x0;function a2_0xcdfa(_0x5bb763,_0xf956e4){const _0x552b28=a2_0x2646();return a2_0xcdfa=function(_0x3c02fa,_0x3f1e5b){_0x3c02fa=_0x3c02fa-0x7f;let _0x26466b=_0x552b28[_0x3c02fa];return _0x26466b;},a2_0xcdfa(_0x5bb763,_0xf956e4);}const DEFAULT_TIMEOUTS={'bad':0x2d,'bath':0x2d,'toilet':0x1e,'wc':0x1e,'keller':0x3c};async function loadConfig(_0xc25a84){const _0x349d85=a2_0x36760d;try{const _0x5599f7=await _0xc25a84[_0x349d85(0xa3)](_0x349d85(0x80));if(_0x5599f7&&_0x5599f7[_0x349d85(0x82)])return JSON[_0x349d85(0x89)](_0x5599f7[_0x349d85(0x82)]);}catch(_0x23c4cd){}return{};}async function isActive(_0x3cfdc4){const _0x2c8fca=a2_0x36760d;try{const _0x34a0a2=await _0x3cfdc4[_0x2c8fca(0xa3)](_0x2c8fca(0x99));return _0x34a0a2&&_0x34a0a2[_0x2c8fca(0x82)];}catch(_0x1c55bf){return![];}}async function areRoomsConnected(_0x11b59e,_0x4ac06d,_0x123c42){const _0x79921f=a2_0x36760d;try{const _0x4b26a2=await _0x11b59e[_0x79921f(0xa3)](_0x79921f(0x90));if(!_0x4b26a2||!_0x4b26a2[_0x79921f(0x82)])return!![];const _0x546e53=JSON[_0x79921f(0x89)](_0x4b26a2[_0x79921f(0x82)]),{rooms:_0x414234,matrix:_0x4a530d}=_0x546e53;if(!_0x414234||!_0x4a530d)return!![];const _0x404778=_0x414234[_0x79921f(0xac)](_0x4ac06d),_0x1bcf3e=_0x414234['indexOf'](_0x123c42);if(_0x404778===-0x1||_0x1bcf3e===-0x1)return!![];const _0x3367f7=_0x4a530d[_0x404778][_0x1bcf3e]>0x0||_0x4a530d[_0x1bcf3e][_0x404778]>0x0;return _0x3367f7;}catch(_0x5ac315){return _0x11b59e[_0x79921f(0xad)][_0x79921f(0xa1)](_0x79921f(0xaa)+_0x5ac315['message']),!![];}}async function updateLocation(_0x513a9a,_0x4134a4){const _0x17cd74=a2_0x36760d;if(!_0x4134a4||_0x4134a4===_0x17cd74(0x7f))return;if(!await isActive(_0x513a9a)){resetTimer(_0x513a9a);return;}if(currentMonitoredRoom&&currentMonitoredRoom!==_0x4134a4){const _0x483582=await areRoomsConnected(_0x513a9a,currentMonitoredRoom,_0x4134a4);if(!_0x483582){const _0x4cc800=_0x17cd74(0x83)+_0x4134a4+_0x17cd74(0x9c)+currentMonitoredRoom+'\x27.';_0x513a9a[_0x17cd74(0xad)][_0x17cd74(0x9a)](_0x17cd74(0x8c)+_0x4cc800+_0x17cd74(0x95)),await _0x513a9a[_0x17cd74(0x8b)](_0x17cd74(0x9d),{'val':JSON[_0x17cd74(0x9f)]({'room':_0x4134a4,'reason':_0x4cc800,'timestamp':Date[_0x17cd74(0xa0)]()}),'ack':!![]});return;}resetTimer(_0x513a9a);}if(!currentMonitoredRoom){await _0x513a9a[_0x17cd74(0x8b)](_0x17cd74(0x94),{'val':_0x4134a4,'ack':!![]});const _0x44f007=await loadConfig(_0x513a9a),_0x3a25b3=_0x4134a4[_0x17cd74(0xa4)]();let _0x1da00a=_0x44f007[_0x4134a4]||_0x44f007[_0x3a25b3];if(!_0x1da00a)for(const _0x978983 in DEFAULT_TIMEOUTS){if(_0x3a25b3[_0x17cd74(0x81)](_0x978983)){_0x1da00a=DEFAULT_TIMEOUTS[_0x978983];break;}}if(!_0x1da00a&&_0x44f007['default'])_0x1da00a=_0x44f007[_0x17cd74(0x9e)];if(!_0x1da00a)return;currentMonitoredRoom=_0x4134a4,startTimer(_0x513a9a,_0x1da00a);}}function startTimer(_0x532bd3,_0x4ef28d){const _0x5ca165=a2_0x36760d;if(activeTimer)clearTimeout(activeTimer);timeoutMs=_0x4ef28d*0x3c*0x3e8,startTime=Date[_0x5ca165(0xa0)](),alarmStage=0x0,_0x532bd3[_0x5ca165(0xad)][_0x5ca165(0x9a)]('ðŸ‘¼\x20Schutzengel:\x20Ãœberwache\x20'+currentMonitoredRoom+_0x5ca165(0x93)+_0x4ef28d+'\x20Min.'),_0x532bd3[_0x5ca165(0x8b)](_0x5ca165(0x96),{'val':'ok','ack':!![]}),activeTimer=setTimeout(()=>triggerPreWarn(_0x532bd3),timeoutMs);}function resetTimer(_0x49b62f){const _0x578e68=a2_0x36760d;if(activeTimer)clearTimeout(activeTimer);activeTimer=null,currentMonitoredRoom=null,alarmStage=0x0,_0x49b62f['setStateAsync'](_0x578e68(0x96),{'val':'ok','ack':!![]});}async function triggerPreWarn(_0x44ee1a){const _0x3addc1=a2_0x36760d;alarmStage=0x1,await _0x44ee1a['setStateAsync'](_0x3addc1(0x96),{'val':'pre_warn','ack':!![]});const _0x222887=_0x3addc1(0x8d)+currentMonitoredRoom+'.\x20Alles\x20in\x20Ordnung?';_0x44ee1a[_0x3addc1(0xad)]['warn'](_0x3addc1(0x8c)+_0x222887),await setup[_0x3addc1(0x84)](_0x44ee1a,_0x3addc1(0x8a)+_0x222887),activeTimer=setTimeout(()=>triggerAlarm(_0x44ee1a),0x5*0x3c*0x3e8);}async function triggerAlarm(_0x5b05c5){const _0x1e3c2c=a2_0x36760d;alarmStage=0x2,await _0x5b05c5[_0x1e3c2c(0x8b)]('analysis.safety.deadMan.alarmState',{'val':_0x1e3c2c(0x92),'ack':!![]});const _0x3a4ca0='ðŸš¨\x20NOTFALL-ALARM:\x20Person\x20reagiert\x20nicht\x20in\x20'+currentMonitoredRoom+'!';_0x5b05c5['log'][_0x1e3c2c(0xa6)]('[DeadMan]\x20'+_0x3a4ca0),await setup['sendNotification'](_0x5b05c5,_0x3a4ca0,![],!![]);}module['exports']={'updateLocation':updateLocation};