const a2_0xcffcfc=a2_0x2124;function a2_0xa355(){const _0x4de6cc=['includes','replace','message','analysis.safety.deadMan.currentRoom','ðŸ‘¼\x20Schutzengel:\x20Ãœberwache\x20','warn','7230853VtBOkG','3280776wLIvfi','1695yqohUk','\x20Min.','now','.\x20Alles\x20in\x20Ordnung?','./setup','470265masGzn','analysis.safety.deadMan.alarmState','wohn','living','(((.+)+)+)+$','[DeadMan]\x20','val','bad','Unknown','info','sofa','pre_warn','getStateAsync','toFixed','default','\x27.\x20Nicht\x20verbunden\x20mit\x20Ã¼berwachtem\x20\x27','analysis.safety.deadMan.smartSleep','schlaf','toLowerCase','analysis.safety.deadMan.napProbability','ðŸ‘¼\x20Schutzengel-Frage:\x20','search','log','analysis.topology.structure','stringify','ðŸš¨\x20NOTFALL-ALARM:\x20Person\x20reagiert\x20nicht\x20in\x20','36eEeuIg','465186bfSuFh','apply','555093LHUckW','4458UPurvG','[DeadMan]\x20Topology\x20check\x20failed:\x20','ðŸ’¤\x20Smart\x20Sleep\x20erkannt\x20(','sendNotification','%).\x20VerlÃ¤ngere\x20Timer\x20fÃ¼r\x20','2154248nopeLo','930VxcZJH','setStateAsync','analysis.safety.deadMan.config','analysis.safety.deadMan.lastIgnored','4RuFwqH','toString','constructor','Ignoriere\x20Bewegung\x20in\x20\x27'];a2_0xa355=function(){return _0x4de6cc;};return a2_0xa355();}(function(_0x3bdb38,_0x373e42){const _0x41df90=a2_0x2124,_0x487fe0=_0x3bdb38();while(!![]){try{const _0x249512=-parseInt(_0x41df90(0x1d3))/0x1+parseInt(_0x41df90(0x1c2))/0x2*(-parseInt(_0x41df90(0x1b5))/0x3)+-parseInt(_0x41df90(0x1cd))/0x4+-parseInt(_0x41df90(0x1ce))/0x5*(parseInt(_0x41df90(0x1b8))/0x6)+-parseInt(_0x41df90(0x1cc))/0x7+parseInt(_0x41df90(0x1bd))/0x8*(-parseInt(_0x41df90(0x1b4))/0x9)+-parseInt(_0x41df90(0x1be))/0xa*(-parseInt(_0x41df90(0x1b7))/0xb);if(_0x249512===_0x373e42)break;else _0x487fe0['push'](_0x487fe0['shift']());}catch(_0x2c590c){_0x487fe0['push'](_0x487fe0['shift']());}}}(a2_0xa355,0xb2580));const a2_0x5bc3c1=(function(){let _0x4e9db5=!![];return function(_0x16690d,_0x5c5e2f){const _0x16e563=_0x4e9db5?function(){const _0x3de117=a2_0x2124;if(_0x5c5e2f){const _0x57e9fb=_0x5c5e2f[_0x3de117(0x1b6)](_0x16690d,arguments);return _0x5c5e2f=null,_0x57e9fb;}}:function(){};return _0x4e9db5=![],_0x16e563;};}()),a2_0xe68a70=a2_0x5bc3c1(this,function(){const _0x16e034=a2_0x2124;return a2_0xe68a70[_0x16e034(0x1c3)]()[_0x16e034(0x1af)](_0x16e034(0x19e))['toString']()[_0x16e034(0x1c4)](a2_0xe68a70)['search'](_0x16e034(0x19e));});a2_0xe68a70();'use strict';const setup=require(a2_0xcffcfc(0x1d2));let activeTimer=null,currentMonitoredRoom=null,timeoutMs=0x0,startTime=0x0,alarmStage=0x0;const DEFAULT_TIMEOUTS={'bad':0x2d,'bath':0x2d,'toilet':0x1e,'wc':0x1e,'keller':0x3c,'schlaf':0x78,'bed':0x78,'guest':0x5a,'gast':0x5a};function getTimeoutRobust(_0x2773c0,_0x45c973){const _0x257dea=a2_0xcffcfc;if(!_0x2773c0||!_0x45c973)return undefined;if(_0x2773c0[_0x45c973])return _0x2773c0[_0x45c973];const _0x4bd98f=_0x45c973[_0x257dea(0x1ac)]()[_0x257dea(0x1c7)](/[^a-z0-9]/g,'');for(const _0xeec876 in _0x2773c0){const _0x16c455=_0xeec876[_0x257dea(0x1ac)]()[_0x257dea(0x1c7)](/[^a-z0-9]/g,'');if(_0x16c455===_0x4bd98f)return _0x2773c0[_0xeec876];}const _0x45639a=_0x45c973['toLowerCase']();if(_0x2773c0[_0x45639a])return _0x2773c0[_0x45639a];return undefined;}async function loadConfig(_0x5efb5d){const _0x11f537=a2_0xcffcfc;try{const _0x143aae=await _0x5efb5d[_0x11f537(0x1a6)](_0x11f537(0x1c0));if(_0x143aae&&_0x143aae['val'])return JSON['parse'](_0x143aae['val']);}catch(_0x3c02d3){}return{};}async function isActive(_0x15162b){const _0x4a537a=a2_0xcffcfc;try{const _0x53983c=await _0x15162b['getStateAsync']('analysis.safety.deadMan.active');return _0x53983c&&_0x53983c[_0x4a537a(0x1a0)];}catch(_0x4ee0bc){return![];}}async function areRoomsConnected(_0x2713ef,_0x3e15ac,_0x3fe622){const _0xbc6d43=a2_0xcffcfc;try{const _0x2daa1c=await _0x2713ef[_0xbc6d43(0x1a6)](_0xbc6d43(0x1b1));if(!_0x2daa1c||!_0x2daa1c[_0xbc6d43(0x1a0)])return!![];const _0x4df58f=JSON['parse'](_0x2daa1c[_0xbc6d43(0x1a0)]),{rooms:_0x5c0b97,matrix:_0x264626}=_0x4df58f;if(!_0x5c0b97||!_0x264626)return!![];const _0x4b67e3=_0x5c0b97['indexOf'](_0x3e15ac),_0x129d32=_0x5c0b97['indexOf'](_0x3fe622);if(_0x4b67e3===-0x1||_0x129d32===-0x1)return!![];const _0xd239cc=_0x264626[_0x4b67e3][_0x129d32]>0x0||_0x264626[_0x129d32][_0x4b67e3]>0x0;return _0xd239cc;}catch(_0xfeec52){return _0x2713ef[_0xbc6d43(0x1b0)][_0xbc6d43(0x1cb)](_0xbc6d43(0x1b9)+_0xfeec52[_0xbc6d43(0x1c8)]),!![];}}function calculateSleepProbability(_0xd4b9a9){const _0xf60420=a2_0xcffcfc,_0x25fe7e=new Date(),_0x5eeca3=_0x25fe7e['getHours'](),_0x4619db=_0xd4b9a9['toLowerCase']();let _0xb4d39e=0.1;if(_0x5eeca3>=0x17||_0x5eeca3<=0x6)_0xb4d39e=0x1;else{if(_0x5eeca3>=0xd&&_0x5eeca3<=0xf)_0xb4d39e=0.8;else{if(_0x5eeca3>=0x14&&_0x5eeca3<=0x17)_0xb4d39e=0.4;}}let _0x2563f2=0.1;if(_0x4619db[_0xf60420(0x1c6)](_0xf60420(0x1ab))||_0x4619db['includes']('bed'))_0x2563f2=0x1;else{if(_0x4619db[_0xf60420(0x1c6)](_0xf60420(0x19c))||_0x4619db[_0xf60420(0x1c6)](_0xf60420(0x19d))||_0x4619db[_0xf60420(0x1c6)](_0xf60420(0x1a4)))_0x2563f2=0.6;else{if(_0x4619db[_0xf60420(0x1c6)](_0xf60420(0x1a1))||_0x4619db[_0xf60420(0x1c6)]('wc'))_0x2563f2=0.05;}}let _0x1ff253=0.5;const _0x4e6213=_0x2563f2*0.5+_0xb4d39e*0.3+_0x1ff253*0.2;return parseFloat(_0x4e6213[_0xf60420(0x1a7)](0x2));}async function updateLocation(_0x433a54,_0x38804a){const _0x39b42b=a2_0xcffcfc;if(!_0x38804a||_0x38804a===_0x39b42b(0x1a2))return;if(!await isActive(_0x433a54)){resetTimer(_0x433a54);return;}if(currentMonitoredRoom&&currentMonitoredRoom!==_0x38804a){const _0x27ac1e=await areRoomsConnected(_0x433a54,currentMonitoredRoom,_0x38804a);if(!_0x27ac1e){const _0x140b58=_0x39b42b(0x1c5)+_0x38804a+_0x39b42b(0x1a9)+currentMonitoredRoom+'\x27.';_0x433a54[_0x39b42b(0x1b0)][_0x39b42b(0x1a3)]('[DeadMan]\x20'+_0x140b58+'\x20(Multi-Person\x20Filter)'),await _0x433a54[_0x39b42b(0x1bf)](_0x39b42b(0x1c1),{'val':JSON[_0x39b42b(0x1b2)]({'room':_0x38804a,'reason':_0x140b58,'timestamp':Date[_0x39b42b(0x1d0)]()}),'ack':!![]});return;}resetTimer(_0x433a54);}if(!currentMonitoredRoom){await _0x433a54['setStateAsync'](_0x39b42b(0x1c9),{'val':_0x38804a,'ack':!![]});const _0x2ac2e3=await loadConfig(_0x433a54);let _0x2c412e=getTimeoutRobust(_0x2ac2e3,_0x38804a);const _0x4f9814=_0x38804a[_0x39b42b(0x1ac)]();if(!_0x2c412e)for(const _0x1d0f46 in DEFAULT_TIMEOUTS){if(_0x4f9814['includes'](_0x1d0f46)){_0x2c412e=DEFAULT_TIMEOUTS[_0x1d0f46];break;}}if(!_0x2c412e&&_0x2ac2e3[_0x39b42b(0x1a8)])_0x2c412e=_0x2ac2e3[_0x39b42b(0x1a8)];if(!_0x2c412e)return;currentMonitoredRoom=_0x38804a,startTimer(_0x433a54,_0x2c412e,_0x38804a);}}function startTimer(_0x15c0de,_0x18351d,_0x4998e6){const _0x4d1271=a2_0xcffcfc;if(activeTimer)clearTimeout(activeTimer);timeoutMs=_0x18351d*0x3c*0x3e8,startTime=Date[_0x4d1271(0x1d0)](),alarmStage=0x0;const _0x24ef45=calculateSleepProbability(_0x4998e6||currentMonitoredRoom),_0x1b6a2c=_0x24ef45>0.65;_0x1b6a2c?(timeoutMs+=0x5a*0x3c*0x3e8,_0x15c0de[_0x4d1271(0x1b0)][_0x4d1271(0x1a3)](_0x4d1271(0x1ba)+(_0x24ef45*0x64)[_0x4d1271(0x1a7)](0x0)+_0x4d1271(0x1bc)+currentMonitoredRoom+'\x20um\x2090\x20Min.'),_0x15c0de['setStateAsync'](_0x4d1271(0x1aa),{'val':!![],'ack':!![]})):_0x15c0de[_0x4d1271(0x1bf)](_0x4d1271(0x1aa),{'val':![],'ack':!![]}),_0x15c0de['setStateAsync']('analysis.safety.deadMan.napProbability',{'val':_0x24ef45,'ack':!![]}),_0x15c0de['log'][_0x4d1271(0x1a3)](_0x4d1271(0x1ca)+currentMonitoredRoom+'\x20fÃ¼r\x20'+_0x18351d+_0x4d1271(0x1cf)),_0x15c0de[_0x4d1271(0x1bf)](_0x4d1271(0x19b),{'val':'ok','ack':!![]}),activeTimer=setTimeout(()=>triggerPreWarn(_0x15c0de),timeoutMs);}function resetTimer(_0x33cebb){const _0x56e272=a2_0xcffcfc;if(activeTimer)clearTimeout(activeTimer);activeTimer=null,currentMonitoredRoom=null,alarmStage=0x0,_0x33cebb[_0x56e272(0x1bf)](_0x56e272(0x19b),{'val':'ok','ack':!![]}),_0x33cebb[_0x56e272(0x1bf)](_0x56e272(0x1aa),{'val':![],'ack':!![]}),_0x33cebb[_0x56e272(0x1bf)](_0x56e272(0x1ad),{'val':0x0,'ack':!![]});}async function triggerPreWarn(_0x158938){const _0x370525=a2_0xcffcfc;alarmStage=0x1,await _0x158938[_0x370525(0x1bf)](_0x370525(0x19b),{'val':_0x370525(0x1a5),'ack':!![]});const _0x26fb34='â³\x20ACHTUNG:\x20UngewÃ¶hnlich\x20lange\x20InaktivitÃ¤t\x20in\x20'+currentMonitoredRoom+_0x370525(0x1d1);_0x158938[_0x370525(0x1b0)][_0x370525(0x1cb)]('[DeadMan]\x20'+_0x26fb34),await setup['sendNotification'](_0x158938,_0x370525(0x1ae)+_0x26fb34),activeTimer=setTimeout(()=>triggerAlarm(_0x158938),0x5*0x3c*0x3e8);}async function triggerAlarm(_0xf3b5f7){const _0x4e7804=a2_0xcffcfc;alarmStage=0x2,await _0xf3b5f7[_0x4e7804(0x1bf)](_0x4e7804(0x19b),{'val':'alarm','ack':!![]});const _0x165684=_0x4e7804(0x1b3)+currentMonitoredRoom+'!';_0xf3b5f7['log']['error'](_0x4e7804(0x19f)+_0x165684),await setup[_0x4e7804(0x1bb)](_0xf3b5f7,_0x165684,![],!![]);}function a2_0x2124(_0x55fbbe,_0x3ffde9){const _0x8202c8=a2_0xa355();return a2_0x2124=function(_0xe68a70,_0x5bc3c1){_0xe68a70=_0xe68a70-0x19b;let _0xa355b7=_0x8202c8[_0xe68a70];return _0xa355b7;},a2_0x2124(_0x55fbbe,_0x3ffde9);}module['exports']={'updateLocation':updateLocation};