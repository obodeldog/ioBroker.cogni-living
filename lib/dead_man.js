(function(_0x438d73,_0x721791){const _0x3e18c7=a2_0x5388,_0x2ce008=_0x438d73();while(!![]){try{const _0x55d0a3=-parseInt(_0x3e18c7(0x1c9))/0x1+parseInt(_0x3e18c7(0x1d9))/0x2+parseInt(_0x3e18c7(0x1c8))/0x3+parseInt(_0x3e18c7(0x1cf))/0x4+parseInt(_0x3e18c7(0x1f1))/0x5+parseInt(_0x3e18c7(0x1e1))/0x6*(parseInt(_0x3e18c7(0x1f0))/0x7)+-parseInt(_0x3e18c7(0x1ee))/0x8;if(_0x55d0a3===_0x721791)break;else _0x2ce008['push'](_0x2ce008['shift']());}catch(_0x991ae5){_0x2ce008['push'](_0x2ce008['shift']());}}}(a2_0x5c1a,0xb14a7));const a2_0x30ef2b=(function(){let _0x326131=!![];return function(_0x4ecd65,_0x1f3cd7){const _0x1f5135=_0x326131?function(){const _0x20437e=a2_0x5388;if(_0x1f3cd7){const _0x524d7b=_0x1f3cd7[_0x20437e(0x1f5)](_0x4ecd65,arguments);return _0x1f3cd7=null,_0x524d7b;}}:function(){};return _0x326131=![],_0x1f5135;};}()),a2_0x32935c=a2_0x30ef2b(this,function(){const _0x34f377=a2_0x5388;return a2_0x32935c[_0x34f377(0x1ea)]()[_0x34f377(0x1df)](_0x34f377(0x1f3))[_0x34f377(0x1ea)]()['constructor'](a2_0x32935c)[_0x34f377(0x1df)](_0x34f377(0x1f3));});a2_0x32935c();'use strict';const setup=require('./setup');function a2_0x5388(_0x52ecc4,_0x575d0e){const _0x35938f=a2_0x5c1a();return a2_0x5388=function(_0x32935c,_0x30ef2b){_0x32935c=_0x32935c-0x1c3;let _0x5c1ac8=_0x35938f[_0x32935c];return _0x5c1ac8;},a2_0x5388(_0x52ecc4,_0x575d0e);}let activeTimer=null,currentMonitoredRoom=null,timeoutMs=0x0,startTime=0x0,alarmStage=0x0;const DEFAULT_TIMEOUTS={'bad':0x2d,'bath':0x2d,'toilet':0x1e,'wc':0x1e,'keller':0x3c,'schlaf':0x78,'bed':0x78,'guest':0x5a,'gast':0x5a};async function loadConfig(_0x4cdfe4){const _0x218669=a2_0x5388;try{const _0x231481=await _0x4cdfe4[_0x218669(0x1d2)](_0x218669(0x1f7));if(_0x231481&&_0x231481[_0x218669(0x1f6)])return JSON[_0x218669(0x1da)](_0x231481[_0x218669(0x1f6)]);}catch(_0x4605cd){}return{};}async function isActive(_0x132fdc){const _0x33af41=a2_0x5388;try{const _0x26b0f3=await _0x132fdc[_0x33af41(0x1d2)]('analysis.safety.deadMan.active');return _0x26b0f3&&_0x26b0f3[_0x33af41(0x1f6)];}catch(_0x565850){return![];}}async function areRoomsConnected(_0x27deae,_0x3d5b60,_0x50d2f0){const _0xcc2b7b=a2_0x5388;try{const _0xc2874d=await _0x27deae['getStateAsync']('analysis.topology.structure');if(!_0xc2874d||!_0xc2874d[_0xcc2b7b(0x1f6)])return!![];const _0x136374=JSON[_0xcc2b7b(0x1da)](_0xc2874d[_0xcc2b7b(0x1f6)]),{rooms:_0x1f3ee6,matrix:_0x12a271}=_0x136374;if(!_0x1f3ee6||!_0x12a271)return!![];const _0x46b490=_0x1f3ee6[_0xcc2b7b(0x1d6)](_0x3d5b60),_0xedf6f8=_0x1f3ee6[_0xcc2b7b(0x1d6)](_0x50d2f0);if(_0x46b490===-0x1||_0xedf6f8===-0x1)return!![];const _0x5b4b49=_0x12a271[_0x46b490][_0xedf6f8]>0x0||_0x12a271[_0xedf6f8][_0x46b490]>0x0;return _0x5b4b49;}catch(_0x5f32c4){return _0x27deae[_0xcc2b7b(0x1c3)][_0xcc2b7b(0x1e3)](_0xcc2b7b(0x1c4)+_0x5f32c4[_0xcc2b7b(0x1d7)]),!![];}}function calculateSleepProbability(_0x254cd1){const _0x3504c0=a2_0x5388,_0x4e6632=new Date(),_0x1dce3e=_0x4e6632['getHours'](),_0x3f3c04=_0x254cd1[_0x3504c0(0x1ef)]();let _0x3187f5=0.1;if(_0x1dce3e>=0x17||_0x1dce3e<=0x6)_0x3187f5=0x1;else{if(_0x1dce3e>=0xd&&_0x1dce3e<=0xf)_0x3187f5=0.8;else{if(_0x1dce3e>=0x14&&_0x1dce3e<=0x17)_0x3187f5=0.4;}}let _0x29078c=0.1;if(_0x3f3c04['includes'](_0x3504c0(0x1c6))||_0x3f3c04[_0x3504c0(0x1e0)](_0x3504c0(0x1f2)))_0x29078c=0x1;else{if(_0x3f3c04[_0x3504c0(0x1e0)](_0x3504c0(0x1cc))||_0x3f3c04['includes'](_0x3504c0(0x1c7))||_0x3f3c04[_0x3504c0(0x1e0)](_0x3504c0(0x1e8)))_0x29078c=0.6;else{if(_0x3f3c04[_0x3504c0(0x1e0)](_0x3504c0(0x1dd))||_0x3f3c04['includes']('wc'))_0x29078c=0.05;}}let _0x415d4d=0.5;const _0x2ea325=_0x29078c*0.5+_0x3187f5*0.3+_0x415d4d*0.2;return parseFloat(_0x2ea325[_0x3504c0(0x1ce)](0x2));}function a2_0x5c1a(){const _0x420d0c=['(((.+)+)+)+$','.\x20Alles\x20in\x20Ordnung?','apply','val','analysis.safety.deadMan.config','ðŸ‘¼\x20Schutzengel:\x20Ãœberwache\x20','log','[DeadMan]\x20Topology\x20check\x20failed:\x20','setStateAsync','schlaf','living','1567497QcAJcS','622064hJlyQb','error','analysis.safety.deadMan.napProbability','wohn','analysis.safety.deadMan.smartSleep','toFixed','5151772UubelW','ðŸš¨\x20NOTFALL-ALARM:\x20Person\x20reagiert\x20nicht\x20in\x20','analysis.safety.deadMan.lastIgnored','getStateAsync','analysis.safety.deadMan.currentRoom','pre_warn','%).\x20VerlÃ¤ngere\x20Timer\x20fÃ¼r\x20','indexOf','message','sendNotification','306706hjzgDv','parse','[DeadMan]\x20','\x20(Multi-Person\x20Filter)','bad','stringify','search','includes','1722726mNxgLJ','ðŸ’¤\x20Smart\x20Sleep\x20erkannt\x20(','warn','now','info','â³\x20ACHTUNG:\x20UngewÃ¶hnlich\x20lange\x20InaktivitÃ¤t\x20in\x20','Ignoriere\x20Bewegung\x20in\x20\x27','sofa','\x20Min.','toString','analysis.safety.deadMan.alarmState','\x20fÃ¼r\x20','ðŸ‘¼\x20Schutzengel-Frage:\x20','19380856bhFXnn','toLowerCase','21XeTATI','4728480iEnwgu','bed'];a2_0x5c1a=function(){return _0x420d0c;};return a2_0x5c1a();}async function updateLocation(_0x359f40,_0x1d8d9e){const _0x43c048=a2_0x5388;if(!_0x1d8d9e||_0x1d8d9e==='Unknown')return;if(!await isActive(_0x359f40)){resetTimer(_0x359f40);return;}if(currentMonitoredRoom&&currentMonitoredRoom!==_0x1d8d9e){const _0x3ce6b5=await areRoomsConnected(_0x359f40,currentMonitoredRoom,_0x1d8d9e);if(!_0x3ce6b5){const _0x3fa061=_0x43c048(0x1e7)+_0x1d8d9e+'\x27.\x20Nicht\x20verbunden\x20mit\x20Ã¼berwachtem\x20\x27'+currentMonitoredRoom+'\x27.';_0x359f40[_0x43c048(0x1c3)][_0x43c048(0x1e5)](_0x43c048(0x1db)+_0x3fa061+_0x43c048(0x1dc)),await _0x359f40['setStateAsync'](_0x43c048(0x1d1),{'val':JSON[_0x43c048(0x1de)]({'room':_0x1d8d9e,'reason':_0x3fa061,'timestamp':Date[_0x43c048(0x1e4)]()}),'ack':!![]});return;}resetTimer(_0x359f40);}if(!currentMonitoredRoom){await _0x359f40[_0x43c048(0x1c5)](_0x43c048(0x1d3),{'val':_0x1d8d9e,'ack':!![]});const _0x1189e4=await loadConfig(_0x359f40),_0x37887f=_0x1d8d9e['toLowerCase']();let _0x353a24=_0x1189e4[_0x1d8d9e]||_0x1189e4[_0x37887f];if(!_0x353a24)for(const _0xf1194e in DEFAULT_TIMEOUTS){if(_0x37887f[_0x43c048(0x1e0)](_0xf1194e)){_0x353a24=DEFAULT_TIMEOUTS[_0xf1194e];break;}}if(!_0x353a24&&_0x1189e4['default'])_0x353a24=_0x1189e4['default'];if(!_0x353a24)return;currentMonitoredRoom=_0x1d8d9e,startTimer(_0x359f40,_0x353a24,_0x1d8d9e);}}function startTimer(_0x3691e2,_0x2c3380,_0x2590ca){const _0x16f6b0=a2_0x5388;if(activeTimer)clearTimeout(activeTimer);timeoutMs=_0x2c3380*0x3c*0x3e8,startTime=Date[_0x16f6b0(0x1e4)](),alarmStage=0x0;const _0x309ca3=calculateSleepProbability(_0x2590ca||currentMonitoredRoom),_0x3b18b3=_0x309ca3>0.65;_0x3b18b3?(timeoutMs+=0x5a*0x3c*0x3e8,_0x3691e2['log'][_0x16f6b0(0x1e5)](_0x16f6b0(0x1e2)+(_0x309ca3*0x64)['toFixed'](0x0)+_0x16f6b0(0x1d5)+currentMonitoredRoom+'\x20um\x2090\x20Min.'),_0x3691e2[_0x16f6b0(0x1c5)](_0x16f6b0(0x1cd),{'val':!![],'ack':!![]})):_0x3691e2[_0x16f6b0(0x1c5)](_0x16f6b0(0x1cd),{'val':![],'ack':!![]}),_0x3691e2['setStateAsync']('analysis.safety.deadMan.napProbability',{'val':_0x309ca3,'ack':!![]}),_0x3691e2[_0x16f6b0(0x1c3)][_0x16f6b0(0x1e5)](_0x16f6b0(0x1f8)+currentMonitoredRoom+_0x16f6b0(0x1ec)+_0x2c3380+_0x16f6b0(0x1e9)),_0x3691e2[_0x16f6b0(0x1c5)](_0x16f6b0(0x1eb),{'val':'ok','ack':!![]}),activeTimer=setTimeout(()=>triggerPreWarn(_0x3691e2),timeoutMs);}function resetTimer(_0x5db33a){const _0x43c2ed=a2_0x5388;if(activeTimer)clearTimeout(activeTimer);activeTimer=null,currentMonitoredRoom=null,alarmStage=0x0,_0x5db33a[_0x43c2ed(0x1c5)](_0x43c2ed(0x1eb),{'val':'ok','ack':!![]}),_0x5db33a[_0x43c2ed(0x1c5)](_0x43c2ed(0x1cd),{'val':![],'ack':!![]}),_0x5db33a[_0x43c2ed(0x1c5)](_0x43c2ed(0x1cb),{'val':0x0,'ack':!![]});}async function triggerPreWarn(_0x3c6f12){const _0x5a8edd=a2_0x5388;alarmStage=0x1,await _0x3c6f12[_0x5a8edd(0x1c5)](_0x5a8edd(0x1eb),{'val':_0x5a8edd(0x1d4),'ack':!![]});const _0x345058=_0x5a8edd(0x1e6)+currentMonitoredRoom+_0x5a8edd(0x1f4);_0x3c6f12[_0x5a8edd(0x1c3)][_0x5a8edd(0x1e3)](_0x5a8edd(0x1db)+_0x345058),await setup[_0x5a8edd(0x1d8)](_0x3c6f12,_0x5a8edd(0x1ed)+_0x345058),activeTimer=setTimeout(()=>triggerAlarm(_0x3c6f12),0x5*0x3c*0x3e8);}async function triggerAlarm(_0x280940){const _0x33114f=a2_0x5388;alarmStage=0x2,await _0x280940[_0x33114f(0x1c5)]('analysis.safety.deadMan.alarmState',{'val':'alarm','ack':!![]});const _0x16b455=_0x33114f(0x1d0)+currentMonitoredRoom+'!';_0x280940['log'][_0x33114f(0x1ca)](_0x33114f(0x1db)+_0x16b455),await setup[_0x33114f(0x1d8)](_0x280940,_0x16b455,![],!![]);}module['exports']={'updateLocation':updateLocation};