const a2_0x4587e6=a2_0x3c8e;(function(_0x2c4585,_0x3b42a9){const _0x70eb3=a2_0x3c8e,_0x46ca8d=_0x2c4585();while(!![]){try{const _0x25557c=parseInt(_0x70eb3(0x13f))/0x1+parseInt(_0x70eb3(0x129))/0x2*(-parseInt(_0x70eb3(0x145))/0x3)+-parseInt(_0x70eb3(0x136))/0x4+-parseInt(_0x70eb3(0x134))/0x5*(-parseInt(_0x70eb3(0x151))/0x6)+parseInt(_0x70eb3(0x148))/0x7+parseInt(_0x70eb3(0x12d))/0x8*(-parseInt(_0x70eb3(0x14a))/0x9)+-parseInt(_0x70eb3(0x14f))/0xa*(-parseInt(_0x70eb3(0x152))/0xb);if(_0x25557c===_0x3b42a9)break;else _0x46ca8d['push'](_0x46ca8d['shift']());}catch(_0x59a895){_0x46ca8d['push'](_0x46ca8d['shift']());}}}(a2_0x1451,0x1fc87));const a2_0x42e082=(function(){let _0x2cf5e3=!![];return function(_0x4bb8eb,_0x12e199){const _0x4b1f4c=_0x2cf5e3?function(){const _0x3ddebe=a2_0x3c8e;if(_0x12e199){const _0x31609a=_0x12e199[_0x3ddebe(0x128)](_0x4bb8eb,arguments);return _0x12e199=null,_0x31609a;}}:function(){};return _0x2cf5e3=![],_0x4b1f4c;};}()),a2_0x1b3af4=a2_0x42e082(this,function(){const _0x2f0f69=a2_0x3c8e;return a2_0x1b3af4[_0x2f0f69(0x124)]()[_0x2f0f69(0x141)]('(((.+)+)+)+$')['toString']()['constructor'](a2_0x1b3af4)[_0x2f0f69(0x141)]('(((.+)+)+)+$');});a2_0x1b3af4();'use strict';function a2_0x1451(){const _0x29b0c7=['warn','2823kCbncH','ðŸ’¤\x20Smart\x20Sleep\x20erkannt\x20(','val','301483KgexsC','replace','9KETPnU','analysis.safety.deadMan.currentRoom','%).\x20VerlÃ¤ngere\x20Timer\x20fÃ¼r\x20','setStateAsync','alarm','1472860ylCcoR','analysis.safety.deadMan.config','564NPeIgm','11KRFhlt','indexOf','Ignoriere\x20Bewegung\x20in\x20\x27','now','ðŸ‘¼\x20Schutzengel-Frage:\x20','analysis.safety.deadMan.active','error','analysis.safety.deadMan.lastIgnored','â³\x20ACHTUNG:\x20UngewÃ¶hnlich\x20lange\x20InaktivitÃ¤t\x20in\x20','toString','schlaf','getStateAsync','analysis.safety.deadMan.alarmState','apply','168fRkQSv','includes','parse','\x20um\x2090\x20Min.','1851272xfsKuc','toFixed','analysis.safety.deadMan.smartSleep','exports','analysis.safety.deadMan.napProbability','[DeadMan]\x20Topology\x20check\x20failed:\x20','sofa','6870RQFYdk','toLowerCase','454064WvAONr','\x20fÃ¼r\x20','analysis.topology.structure','.\x20Alles\x20in\x20Ordnung?','wohn','log','info','\x20(Multi-Person\x20Filter)','[DeadMan]\x20','234641laETMt','sendNotification','search','\x27.\x20Nicht\x20verbunden\x20mit\x20Ã¼berwachtem\x20\x27','living'];a2_0x1451=function(){return _0x29b0c7;};return a2_0x1451();}const setup=require('./setup');let activeTimer=null,currentMonitoredRoom=null,timeoutMs=0x0,startTime=0x0,alarmStage=0x0;const DEFAULT_TIMEOUTS={'bad':0x2d,'bath':0x2d,'toilet':0x1e,'wc':0x1e,'keller':0x3c,'schlaf':0x78,'bed':0x78,'guest':0x5a,'gast':0x5a};function getTimeoutRobust(_0x385f62,_0xcfd263){const _0x21957e=a2_0x3c8e;if(!_0x385f62||!_0xcfd263)return undefined;if(_0x385f62[_0xcfd263])return _0x385f62[_0xcfd263];const _0x3b18e1=_0xcfd263[_0x21957e(0x135)]()[_0x21957e(0x149)](/[^a-z0-9]/g,'');for(const _0x54ce5b in _0x385f62){const _0x2fdab9=_0x54ce5b[_0x21957e(0x135)]()[_0x21957e(0x149)](/[^a-z0-9]/g,'');if(_0x2fdab9===_0x3b18e1)return _0x385f62[_0x54ce5b];}const _0x2fa701=_0xcfd263[_0x21957e(0x135)]();if(_0x385f62[_0x2fa701])return _0x385f62[_0x2fa701];return undefined;}async function loadConfig(_0x4df9ec){const _0x21f953=a2_0x3c8e;try{const _0x4170c5=await _0x4df9ec['getStateAsync'](_0x21f953(0x150));if(_0x4170c5&&_0x4170c5[_0x21f953(0x147)])return JSON[_0x21f953(0x12b)](_0x4170c5[_0x21f953(0x147)]);}catch(_0xf9a584){}return{};}async function isActive(_0x22873b){const _0x34e1e7=a2_0x3c8e;try{const _0xb21829=await _0x22873b[_0x34e1e7(0x126)](_0x34e1e7(0x157));return _0xb21829&&_0xb21829[_0x34e1e7(0x147)];}catch(_0x263ea7){return![];}}async function areRoomsConnected(_0x3c7888,_0x14bbc3,_0x1bd5fd){const _0x871c09=a2_0x3c8e;try{const _0x146b7a=await _0x3c7888['getStateAsync'](_0x871c09(0x138));if(!_0x146b7a||!_0x146b7a['val'])return!![];const _0x61fe=JSON[_0x871c09(0x12b)](_0x146b7a['val']),{rooms:_0x9c94ba,matrix:_0x169444}=_0x61fe;if(!_0x9c94ba||!_0x169444)return!![];const _0x54ec26=_0x9c94ba[_0x871c09(0x153)](_0x14bbc3),_0x5ccab4=_0x9c94ba['indexOf'](_0x1bd5fd);if(_0x54ec26===-0x1||_0x5ccab4===-0x1)return!![];const _0x54a3d9=_0x169444[_0x54ec26][_0x5ccab4]>0x0||_0x169444[_0x5ccab4][_0x54ec26]>0x0;return _0x54a3d9;}catch(_0x15b82a){return _0x3c7888[_0x871c09(0x13b)][_0x871c09(0x144)](_0x871c09(0x132)+_0x15b82a['message']),!![];}}function calculateSleepProbability(_0x20bb25){const _0x36f249=a2_0x3c8e,_0x4e5b2b=new Date(),_0x16938e=_0x4e5b2b['getHours'](),_0x4f8b79=_0x20bb25[_0x36f249(0x135)]();let _0x3e694d=0.1;if(_0x16938e>=0x17||_0x16938e<=0x6)_0x3e694d=0x1;else{if(_0x16938e>=0xd&&_0x16938e<=0xf)_0x3e694d=0.8;else{if(_0x16938e>=0x14&&_0x16938e<=0x17)_0x3e694d=0.4;}}let _0x290227=0.1;if(_0x4f8b79['includes'](_0x36f249(0x125))||_0x4f8b79[_0x36f249(0x12a)]('bed'))_0x290227=0x1;else{if(_0x4f8b79[_0x36f249(0x12a)](_0x36f249(0x13a))||_0x4f8b79[_0x36f249(0x12a)](_0x36f249(0x143))||_0x4f8b79['includes'](_0x36f249(0x133)))_0x290227=0.6;else{if(_0x4f8b79[_0x36f249(0x12a)]('bad')||_0x4f8b79['includes']('wc'))_0x290227=0.05;}}let _0xc1af77=0.5;const _0x430117=_0x290227*0.5+_0x3e694d*0.3+_0xc1af77*0.2;return parseFloat(_0x430117[_0x36f249(0x12e)](0x2));}async function updateLocation(_0x5cf756,_0x3f59ab){const _0x400894=a2_0x3c8e;if(!_0x3f59ab||_0x3f59ab==='Unknown')return;if(!await isActive(_0x5cf756)){resetTimer(_0x5cf756);return;}if(currentMonitoredRoom&&currentMonitoredRoom!==_0x3f59ab){const _0x3a0143=await areRoomsConnected(_0x5cf756,currentMonitoredRoom,_0x3f59ab);if(!_0x3a0143){const _0x71fede=_0x400894(0x154)+_0x3f59ab+_0x400894(0x142)+currentMonitoredRoom+'\x27.';_0x5cf756['log'][_0x400894(0x13c)]('[DeadMan]\x20'+_0x71fede+_0x400894(0x13d)),await _0x5cf756[_0x400894(0x14d)](_0x400894(0x159),{'val':JSON['stringify']({'room':_0x3f59ab,'reason':_0x71fede,'timestamp':Date['now']()}),'ack':!![]});return;}resetTimer(_0x5cf756);}if(!currentMonitoredRoom){await _0x5cf756[_0x400894(0x14d)](_0x400894(0x14b),{'val':_0x3f59ab,'ack':!![]});const _0x15d96f=await loadConfig(_0x5cf756);let _0x45515f=getTimeoutRobust(_0x15d96f,_0x3f59ab);const _0x5a1960=_0x3f59ab[_0x400894(0x135)]();if(!_0x45515f)for(const _0x49706d in DEFAULT_TIMEOUTS){if(_0x5a1960[_0x400894(0x12a)](_0x49706d)){_0x45515f=DEFAULT_TIMEOUTS[_0x49706d];break;}}if(!_0x45515f&&_0x15d96f['default'])_0x45515f=_0x15d96f['default'];if(!_0x45515f)return;currentMonitoredRoom=_0x3f59ab,startTimer(_0x5cf756,_0x45515f,_0x3f59ab);}}function startTimer(_0x2545a5,_0x43aefd,_0x5017fd){const _0x4b1b24=a2_0x3c8e;if(activeTimer)clearTimeout(activeTimer);timeoutMs=_0x43aefd*0x3c*0x3e8,startTime=Date[_0x4b1b24(0x155)](),alarmStage=0x0;const _0x2ae220=calculateSleepProbability(_0x5017fd||currentMonitoredRoom),_0xb1dad8=_0x2ae220>0.65;_0xb1dad8?(timeoutMs+=0x5a*0x3c*0x3e8,_0x2545a5[_0x4b1b24(0x13b)]['info'](_0x4b1b24(0x146)+(_0x2ae220*0x64)[_0x4b1b24(0x12e)](0x0)+_0x4b1b24(0x14c)+currentMonitoredRoom+_0x4b1b24(0x12c)),_0x2545a5[_0x4b1b24(0x14d)](_0x4b1b24(0x12f),{'val':!![],'ack':!![]})):_0x2545a5['setStateAsync']('analysis.safety.deadMan.smartSleep',{'val':![],'ack':!![]}),_0x2545a5[_0x4b1b24(0x14d)]('analysis.safety.deadMan.napProbability',{'val':_0x2ae220,'ack':!![]}),_0x2545a5[_0x4b1b24(0x13b)]['info']('ðŸ‘¼\x20Schutzengel:\x20Ãœberwache\x20'+currentMonitoredRoom+_0x4b1b24(0x137)+_0x43aefd+'\x20Min.'),_0x2545a5['setStateAsync'](_0x4b1b24(0x127),{'val':'ok','ack':!![]}),activeTimer=setTimeout(()=>triggerPreWarn(_0x2545a5),timeoutMs);}function resetTimer(_0xdfb94d){const _0x32a19d=a2_0x3c8e;if(activeTimer)clearTimeout(activeTimer);activeTimer=null,currentMonitoredRoom=null,alarmStage=0x0,_0xdfb94d[_0x32a19d(0x14d)](_0x32a19d(0x127),{'val':'ok','ack':!![]}),_0xdfb94d[_0x32a19d(0x14d)](_0x32a19d(0x12f),{'val':![],'ack':!![]}),_0xdfb94d[_0x32a19d(0x14d)](_0x32a19d(0x131),{'val':0x0,'ack':!![]});}async function triggerPreWarn(_0x43be8e){const _0x48de59=a2_0x3c8e;alarmStage=0x1,await _0x43be8e[_0x48de59(0x14d)](_0x48de59(0x127),{'val':'pre_warn','ack':!![]});const _0x4e13c2=_0x48de59(0x123)+currentMonitoredRoom+_0x48de59(0x139);_0x43be8e[_0x48de59(0x13b)]['warn'](_0x48de59(0x13e)+_0x4e13c2),await setup[_0x48de59(0x140)](_0x43be8e,_0x48de59(0x156)+_0x4e13c2),activeTimer=setTimeout(()=>triggerAlarm(_0x43be8e),0x5*0x3c*0x3e8);}async function triggerAlarm(_0x221eb9){const _0x46277f=a2_0x3c8e;alarmStage=0x2,await _0x221eb9['setStateAsync']('analysis.safety.deadMan.alarmState',{'val':_0x46277f(0x14e),'ack':!![]});const _0x35237f='ðŸš¨\x20NOTFALL-ALARM:\x20Person\x20reagiert\x20nicht\x20in\x20'+currentMonitoredRoom+'!';_0x221eb9['log'][_0x46277f(0x158)](_0x46277f(0x13e)+_0x35237f),await setup[_0x46277f(0x140)](_0x221eb9,_0x35237f,![],!![]);}function a2_0x3c8e(_0x3dbdb8,_0x3bc888){const _0x35e6d4=a2_0x1451();return a2_0x3c8e=function(_0x1b3af4,_0x42e082){_0x1b3af4=_0x1b3af4-0x123;let _0x145152=_0x35e6d4[_0x1b3af4];return _0x145152;},a2_0x3c8e(_0x3dbdb8,_0x3bc888);}module[a2_0x4587e6(0x130)]={'updateLocation':updateLocation};