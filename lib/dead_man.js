function a2_0x40f9(_0x876a33,_0x1c918b){const _0x188f40=a2_0x31ba();return a2_0x40f9=function(_0x17bac3,_0x4a8299){_0x17bac3=_0x17bac3-0x1ca;let _0x31ba7f=_0x188f40[_0x17bac3];return _0x31ba7f;},a2_0x40f9(_0x876a33,_0x1c918b);}const a2_0x26c40f=a2_0x40f9;(function(_0x315b4a,_0x4756a0){const _0x9fefc9=a2_0x40f9,_0x46bda1=_0x315b4a();while(!![]){try{const _0x2a9271=-parseInt(_0x9fefc9(0x1f5))/0x1*(-parseInt(_0x9fefc9(0x1d8))/0x2)+parseInt(_0x9fefc9(0x1f7))/0x3+-parseInt(_0x9fefc9(0x1d7))/0x4+-parseInt(_0x9fefc9(0x1cf))/0x5*(-parseInt(_0x9fefc9(0x1dc))/0x6)+-parseInt(_0x9fefc9(0x1de))/0x7+-parseInt(_0x9fefc9(0x1e1))/0x8*(-parseInt(_0x9fefc9(0x1ed))/0x9)+-parseInt(_0x9fefc9(0x1e6))/0xa;if(_0x2a9271===_0x4756a0)break;else _0x46bda1['push'](_0x46bda1['shift']());}catch(_0x1a6f00){_0x46bda1['push'](_0x46bda1['shift']());}}}(a2_0x31ba,0xc0132));function a2_0x31ba(){const _0x5b8d51=['analysis.safety.deadMan.lastIgnored','indexOf','558477jLlLaV','(((.+)+)+)+$','getStateAsync','\x20fÃ¼r\x20','[DeadMan]\x20Topology\x20check\x20failed:\x20','\x27.\x20Nicht\x20verbunden\x20mit\x20Ã¼berwachtem\x20\x27','[DeadMan]\x20','parse','238571TTLDDi','ðŸš¨\x20NOTFALL-ALARM:\x20Person\x20reagiert\x20nicht\x20in\x20','4693425lstcjB','analysis.topology.structure','warn','â³\x20ACHTUNG:\x20UngewÃ¶hnlich\x20lange\x20InaktivitÃ¤t\x20in\x20','analysis.safety.deadMan.currentRoom','now','default','5JfGekT','ðŸ‘¼\x20Schutzengel-Frage:\x20','analysis.safety.deadMan.alarmState','ðŸ‘¼\x20Schutzengel:\x20Ãœberwache\x20','exports','.\x20Alles\x20in\x20Ordnung?','toLowerCase','error','3816548ZBrbLH','8GOYDIb','val','Ignoriere\x20Bewegung\x20in\x20\x27','constructor','7853304OYZVkG','log','9785405WQVAMS','sendNotification','\x20Min.','152nGMmFb','analysis.safety.deadMan.active','search','toString','pre_warn','18678600DJNcwi','info','message','includes','setStateAsync'];a2_0x31ba=function(){return _0x5b8d51;};return a2_0x31ba();}const a2_0x4a8299=(function(){let _0x53b32c=!![];return function(_0x56f921,_0x192c7f){const _0x3f17a1=_0x53b32c?function(){if(_0x192c7f){const _0x2eecaa=_0x192c7f['apply'](_0x56f921,arguments);return _0x192c7f=null,_0x2eecaa;}}:function(){};return _0x53b32c=![],_0x3f17a1;};}()),a2_0x17bac3=a2_0x4a8299(this,function(){const _0x3470e7=a2_0x40f9;return a2_0x17bac3[_0x3470e7(0x1e4)]()[_0x3470e7(0x1e3)](_0x3470e7(0x1ee))[_0x3470e7(0x1e4)]()[_0x3470e7(0x1db)](a2_0x17bac3)[_0x3470e7(0x1e3)](_0x3470e7(0x1ee));});a2_0x17bac3();'use strict';const setup=require('./setup');let activeTimer=null,currentMonitoredRoom=null,timeoutMs=0x0,startTime=0x0,alarmStage=0x0;const DEFAULT_TIMEOUTS={'bad':0x2d,'bath':0x2d,'toilet':0x1e,'wc':0x1e,'keller':0x3c};async function loadConfig(_0x12f820){const _0x48f9d2=a2_0x40f9;try{const _0x448c2e=await _0x12f820['getStateAsync']('analysis.safety.deadMan.config');if(_0x448c2e&&_0x448c2e['val'])return JSON[_0x48f9d2(0x1f4)](_0x448c2e[_0x48f9d2(0x1d9)]);}catch(_0x2acd89){}return{};}async function isActive(_0x114a05){const _0x4520df=a2_0x40f9;try{const _0x2feb47=await _0x114a05[_0x4520df(0x1ef)](_0x4520df(0x1e2));return _0x2feb47&&_0x2feb47[_0x4520df(0x1d9)];}catch(_0x145401){return![];}}async function areRoomsConnected(_0x180442,_0xb524ea,_0x4150ad){const _0x167c07=a2_0x40f9;try{const _0x384704=await _0x180442[_0x167c07(0x1ef)](_0x167c07(0x1f8));if(!_0x384704||!_0x384704[_0x167c07(0x1d9)])return!![];const _0x2eb912=JSON[_0x167c07(0x1f4)](_0x384704['val']),{rooms:_0xf2c68,matrix:_0x3ebb83}=_0x2eb912;if(!_0xf2c68||!_0x3ebb83)return!![];const _0x1357b2=_0xf2c68[_0x167c07(0x1ec)](_0xb524ea),_0x3d137a=_0xf2c68['indexOf'](_0x4150ad);if(_0x1357b2===-0x1||_0x3d137a===-0x1)return!![];const _0x664715=_0x3ebb83[_0x1357b2][_0x3d137a]>0x0||_0x3ebb83[_0x3d137a][_0x1357b2]>0x0;return _0x664715;}catch(_0x24349d){return _0x180442[_0x167c07(0x1dd)]['warn'](_0x167c07(0x1f1)+_0x24349d[_0x167c07(0x1e8)]),!![];}}async function updateLocation(_0x12164e,_0x2cafc2){const _0x5cf090=a2_0x40f9;if(!_0x2cafc2||_0x2cafc2==='Unknown')return;if(!await isActive(_0x12164e)){resetTimer(_0x12164e);return;}if(currentMonitoredRoom&&currentMonitoredRoom!==_0x2cafc2){const _0x46eaa4=await areRoomsConnected(_0x12164e,currentMonitoredRoom,_0x2cafc2);if(!_0x46eaa4){const _0x4b3b13=_0x5cf090(0x1da)+_0x2cafc2+_0x5cf090(0x1f2)+currentMonitoredRoom+'\x27.';_0x12164e[_0x5cf090(0x1dd)]['info']('[DeadMan]\x20'+_0x4b3b13+'\x20(Multi-Person\x20Filter)'),await _0x12164e[_0x5cf090(0x1ea)](_0x5cf090(0x1eb),{'val':JSON['stringify']({'room':_0x2cafc2,'reason':_0x4b3b13,'timestamp':Date[_0x5cf090(0x1cd)]()}),'ack':!![]});return;}resetTimer(_0x12164e);}if(!currentMonitoredRoom){await _0x12164e[_0x5cf090(0x1ea)](_0x5cf090(0x1cc),{'val':_0x2cafc2,'ack':!![]});const _0x2f829a=await loadConfig(_0x12164e),_0x18ed9d=_0x2cafc2[_0x5cf090(0x1d5)]();let _0x1a3f27=_0x2f829a[_0x2cafc2]||_0x2f829a[_0x18ed9d];if(!_0x1a3f27)for(const _0x201db6 in DEFAULT_TIMEOUTS){if(_0x18ed9d[_0x5cf090(0x1e9)](_0x201db6)){_0x1a3f27=DEFAULT_TIMEOUTS[_0x201db6];break;}}if(!_0x1a3f27&&_0x2f829a[_0x5cf090(0x1ce)])_0x1a3f27=_0x2f829a[_0x5cf090(0x1ce)];if(!_0x1a3f27)return;currentMonitoredRoom=_0x2cafc2,startTimer(_0x12164e,_0x1a3f27);}}function startTimer(_0x2f81fe,_0x1f151f){const _0x4cf8bb=a2_0x40f9;if(activeTimer)clearTimeout(activeTimer);timeoutMs=_0x1f151f*0x3c*0x3e8,startTime=Date[_0x4cf8bb(0x1cd)](),alarmStage=0x0,_0x2f81fe[_0x4cf8bb(0x1dd)][_0x4cf8bb(0x1e7)](_0x4cf8bb(0x1d2)+currentMonitoredRoom+_0x4cf8bb(0x1f0)+_0x1f151f+_0x4cf8bb(0x1e0)),_0x2f81fe[_0x4cf8bb(0x1ea)](_0x4cf8bb(0x1d1),{'val':'ok','ack':!![]}),activeTimer=setTimeout(()=>triggerPreWarn(_0x2f81fe),timeoutMs);}function resetTimer(_0x48ea4f){const _0x32df93=a2_0x40f9;if(activeTimer)clearTimeout(activeTimer);activeTimer=null,currentMonitoredRoom=null,alarmStage=0x0,_0x48ea4f[_0x32df93(0x1ea)](_0x32df93(0x1d1),{'val':'ok','ack':!![]});}async function triggerPreWarn(_0x544f2d){const _0x3b78a0=a2_0x40f9;alarmStage=0x1,await _0x544f2d['setStateAsync'](_0x3b78a0(0x1d1),{'val':_0x3b78a0(0x1e5),'ack':!![]});const _0x3e3a34=_0x3b78a0(0x1cb)+currentMonitoredRoom+_0x3b78a0(0x1d4);_0x544f2d[_0x3b78a0(0x1dd)][_0x3b78a0(0x1ca)](_0x3b78a0(0x1f3)+_0x3e3a34),await setup[_0x3b78a0(0x1df)](_0x544f2d,_0x3b78a0(0x1d0)+_0x3e3a34),activeTimer=setTimeout(()=>triggerAlarm(_0x544f2d),0x5*0x3c*0x3e8);}async function triggerAlarm(_0x2bf8ff){const _0x30c5b3=a2_0x40f9;alarmStage=0x2,await _0x2bf8ff[_0x30c5b3(0x1ea)]('analysis.safety.deadMan.alarmState',{'val':'alarm','ack':!![]});const _0x48aeb8=_0x30c5b3(0x1f6)+currentMonitoredRoom+'!';_0x2bf8ff[_0x30c5b3(0x1dd)][_0x30c5b3(0x1d6)](_0x30c5b3(0x1f3)+_0x48aeb8),await setup['sendNotification'](_0x2bf8ff,_0x48aeb8,![],!![]);}module[a2_0x26c40f(0x1d3)]={'updateLocation':updateLocation};