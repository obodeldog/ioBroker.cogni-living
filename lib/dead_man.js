const a2_0x3799f8=a2_0x1afc;(function(_0x22e25e,_0x14728d){const _0x5658ce=a2_0x1afc,_0x205501=_0x22e25e();while(!![]){try{const _0x5d8b0f=parseInt(_0x5658ce(0x1a8))/0x1*(-parseInt(_0x5658ce(0x1a1))/0x2)+-parseInt(_0x5658ce(0x1bc))/0x3+parseInt(_0x5658ce(0x1b4))/0x4+parseInt(_0x5658ce(0x19e))/0x5*(parseInt(_0x5658ce(0x1b2))/0x6)+-parseInt(_0x5658ce(0x192))/0x7+-parseInt(_0x5658ce(0x1a5))/0x8+parseInt(_0x5658ce(0x196))/0x9;if(_0x5d8b0f===_0x14728d)break;else _0x205501['push'](_0x205501['shift']());}catch(_0x43fb8b){_0x205501['push'](_0x205501['shift']());}}}(a2_0x141d,0xb2bd9));const a2_0x4e60b4=(function(){let _0x280abe=!![];return function(_0x4b84fa,_0xbd35d0){const _0xc8b607=_0x280abe?function(){const _0x20d9e3=a2_0x1afc;if(_0xbd35d0){const _0x19b08e=_0xbd35d0[_0x20d9e3(0x19f)](_0x4b84fa,arguments);return _0xbd35d0=null,_0x19b08e;}}:function(){};return _0x280abe=![],_0xc8b607;};}()),a2_0x3a17fb=a2_0x4e60b4(this,function(){const _0x29e9ec=a2_0x1afc;return a2_0x3a17fb[_0x29e9ec(0x187)]()[_0x29e9ec(0x1ba)](_0x29e9ec(0x1a6))[_0x29e9ec(0x187)]()[_0x29e9ec(0x1ad)](a2_0x3a17fb)[_0x29e9ec(0x1ba)](_0x29e9ec(0x1a6));});a2_0x3a17fb();'use strict';const setup=require(a2_0x3799f8(0x19a));let activeTimer=null,currentMonitoredRoom=null,timeoutMs=0x0,startTime=0x0,alarmStage=0x0;const DEFAULT_TIMEOUTS={'bad':0x2d,'bath':0x2d,'toilet':0x1e,'wc':0x1e,'keller':0x3c,'schlaf':0x78,'bed':0x78,'guest':0x5a,'gast':0x5a};function getTimeoutRobust(_0x3e8d2f,_0x2fe850){const _0x5943b4=a2_0x3799f8;if(!_0x3e8d2f||!_0x2fe850)return undefined;if(_0x3e8d2f[_0x2fe850])return _0x3e8d2f[_0x2fe850];const _0x325161=_0x2fe850['toLowerCase']()[_0x5943b4(0x1bb)](/[^a-z0-9]/g,'');for(const _0x59d47e in _0x3e8d2f){const _0x5333ce=_0x59d47e[_0x5943b4(0x190)]()[_0x5943b4(0x1bb)](/[^a-z0-9]/g,'');if(_0x5333ce===_0x325161)return _0x3e8d2f[_0x59d47e];}const _0x571196=_0x2fe850[_0x5943b4(0x190)]();if(_0x3e8d2f[_0x571196])return _0x3e8d2f[_0x571196];return undefined;}async function loadConfig(_0x4bf178){const _0x4d5046=a2_0x3799f8;try{const _0x4c0278=await _0x4bf178[_0x4d5046(0x1a4)]('analysis.safety.deadMan.config');if(_0x4c0278&&_0x4c0278[_0x4d5046(0x1aa)])return JSON[_0x4d5046(0x1a0)](_0x4c0278[_0x4d5046(0x1aa)]);}catch(_0x52d509){}return{};}async function isActive(_0x178c14){const _0x1131a9=a2_0x3799f8;try{const _0x215da9=await _0x178c14[_0x1131a9(0x1a4)]('analysis.safety.deadMan.active');return _0x215da9&&_0x215da9[_0x1131a9(0x1aa)];}catch(_0x990541){return![];}}async function areRoomsConnected(_0x2f3f93,_0x590353,_0xc064d){const _0x18026b=a2_0x3799f8;try{const _0x2cd1a5=await _0x2f3f93['getStateAsync'](_0x18026b(0x19c));if(!_0x2cd1a5||!_0x2cd1a5[_0x18026b(0x1aa)])return!![];const _0x180ce2=JSON[_0x18026b(0x1a0)](_0x2cd1a5[_0x18026b(0x1aa)]),{rooms:_0x375e38,matrix:_0x2180f2}=_0x180ce2;if(!_0x375e38||!_0x2180f2)return!![];const _0x811947=_0x375e38[_0x18026b(0x194)](_0x590353),_0x2d7786=_0x375e38[_0x18026b(0x194)](_0xc064d);if(_0x811947===-0x1||_0x2d7786===-0x1)return!![];const _0x111731=_0x2180f2[_0x811947][_0x2d7786]>0x0||_0x2180f2[_0x2d7786][_0x811947]>0x0;return _0x111731;}catch(_0x427256){return _0x2f3f93[_0x18026b(0x1b5)][_0x18026b(0x195)]('[DeadMan]\x20Topology\x20check\x20failed:\x20'+_0x427256[_0x18026b(0x1b3)]),!![];}}function calculateSleepProbability(_0x3cd5ae){const _0x19fb0c=a2_0x3799f8,_0x57f070=new Date(),_0x4078f4=_0x57f070[_0x19fb0c(0x1a3)](),_0x31ad97=_0x3cd5ae[_0x19fb0c(0x190)]();let _0x42f96a=0.1;if(_0x4078f4>=0x17||_0x4078f4<=0x6)_0x42f96a=0x1;else{if(_0x4078f4>=0xd&&_0x4078f4<=0xf)_0x42f96a=0.8;else{if(_0x4078f4>=0x14&&_0x4078f4<=0x17)_0x42f96a=0.4;}}let _0x406a8c=0.1;if(_0x31ad97[_0x19fb0c(0x1ac)]('schlaf')||_0x31ad97['includes'](_0x19fb0c(0x1b6)))_0x406a8c=0x1;else{if(_0x31ad97[_0x19fb0c(0x1ac)](_0x19fb0c(0x18f))||_0x31ad97[_0x19fb0c(0x1ac)](_0x19fb0c(0x1a7))||_0x31ad97[_0x19fb0c(0x1ac)](_0x19fb0c(0x18a)))_0x406a8c=0.6;else{if(_0x31ad97[_0x19fb0c(0x1ac)](_0x19fb0c(0x198))||_0x31ad97['includes']('wc'))_0x406a8c=0.05;}}let _0x40fcc3=0.5;const _0x46c606=_0x406a8c*0.5+_0x42f96a*0.3+_0x40fcc3*0.2;return parseFloat(_0x46c606[_0x19fb0c(0x19b)](0x2));}async function updateLocation(_0x370d61,_0x405b9f){const _0x44fecf=a2_0x3799f8;if(!_0x405b9f||_0x405b9f===_0x44fecf(0x197))return;if(!await isActive(_0x370d61)){resetTimer(_0x370d61);return;}if(currentMonitoredRoom&&currentMonitoredRoom!==_0x405b9f){const _0x2093e6=await areRoomsConnected(_0x370d61,currentMonitoredRoom,_0x405b9f);if(!_0x2093e6){const _0x199f6a=_0x44fecf(0x1b9)+_0x405b9f+_0x44fecf(0x199)+currentMonitoredRoom+'\x27.';_0x370d61[_0x44fecf(0x1b5)][_0x44fecf(0x1a9)]('[DeadMan]\x20'+_0x199f6a+_0x44fecf(0x1a2)),await _0x370d61['setStateAsync'](_0x44fecf(0x18e),{'val':JSON[_0x44fecf(0x1b0)]({'room':_0x405b9f,'reason':_0x199f6a,'timestamp':Date['now']()}),'ack':!![]});return;}resetTimer(_0x370d61);}if(!currentMonitoredRoom){await _0x370d61['setStateAsync'](_0x44fecf(0x18c),{'val':_0x405b9f,'ack':!![]});const _0x21df5d=await loadConfig(_0x370d61);let _0x23ab3c=getTimeoutRobust(_0x21df5d,_0x405b9f);const _0x487aa2=_0x405b9f[_0x44fecf(0x190)]();if(!_0x23ab3c)for(const _0x1f9df9 in DEFAULT_TIMEOUTS){if(_0x487aa2[_0x44fecf(0x1ac)](_0x1f9df9)){_0x23ab3c=DEFAULT_TIMEOUTS[_0x1f9df9];break;}}if(!_0x23ab3c&&_0x21df5d['default'])_0x23ab3c=_0x21df5d['default'];if(!_0x23ab3c)return;currentMonitoredRoom=_0x405b9f,startTimer(_0x370d61,_0x23ab3c,_0x405b9f);}}function a2_0x141d(){const _0x3a5920=['getHours','getStateAsync','9626856roWyPF','(((.+)+)+)+$','living','75221dxKuDC','info','val','analysis.safety.deadMan.alarmState','includes','constructor','\x20fÃ¼r\x20','sendNotification','stringify','â³\x20ACHTUNG:\x20UngewÃ¶hnlich\x20lange\x20InaktivitÃ¤t\x20in\x20','2830488wmqMOS','message','4073512ijjagY','log','bed','analysis.safety.deadMan.napProbability','analysis.safety.deadMan.smartSleep','Ignoriere\x20Bewegung\x20in\x20\x27','search','replace','1474995UljRfz','alarm','setStateAsync','error','toString','%).\x20VerlÃ¤ngere\x20Timer\x20fÃ¼r\x20','pre_warn','sofa','ðŸ’¤\x20Smart\x20Sleep\x20erkannt\x20(','analysis.safety.deadMan.currentRoom','now','analysis.safety.deadMan.lastIgnored','wohn','toLowerCase','.\x20Alles\x20in\x20Ordnung?','7743554jKysEM','ðŸ‘¼\x20Schutzengel-Frage:\x20','indexOf','warn','25652232ZWmnAC','Unknown','bad','\x27.\x20Nicht\x20verbunden\x20mit\x20Ã¼berwachtem\x20\x27','./setup','toFixed','analysis.topology.structure','\x20um\x2090\x20Min.','10psfLLW','apply','parse','34MKliYN','\x20(Multi-Person\x20Filter)'];a2_0x141d=function(){return _0x3a5920;};return a2_0x141d();}function startTimer(_0x33c75e,_0x518149,_0x366809){const _0x1d3dd5=a2_0x3799f8;if(activeTimer)clearTimeout(activeTimer);timeoutMs=_0x518149*0x3c*0x3e8,startTime=Date[_0x1d3dd5(0x18d)](),alarmStage=0x0;const _0x281dec=calculateSleepProbability(_0x366809||currentMonitoredRoom),_0x413d69=_0x281dec>0.65;_0x413d69?(timeoutMs+=0x5a*0x3c*0x3e8,_0x33c75e[_0x1d3dd5(0x1b5)][_0x1d3dd5(0x1a9)](_0x1d3dd5(0x18b)+(_0x281dec*0x64)['toFixed'](0x0)+_0x1d3dd5(0x188)+currentMonitoredRoom+_0x1d3dd5(0x19d)),_0x33c75e['setStateAsync'](_0x1d3dd5(0x1b8),{'val':!![],'ack':!![]})):_0x33c75e[_0x1d3dd5(0x185)](_0x1d3dd5(0x1b8),{'val':![],'ack':!![]}),_0x33c75e[_0x1d3dd5(0x185)](_0x1d3dd5(0x1b7),{'val':_0x281dec,'ack':!![]}),_0x33c75e['log'][_0x1d3dd5(0x1a9)]('ðŸ‘¼\x20Schutzengel:\x20Ãœberwache\x20'+currentMonitoredRoom+_0x1d3dd5(0x1ae)+_0x518149+'\x20Min.'),_0x33c75e[_0x1d3dd5(0x185)](_0x1d3dd5(0x1ab),{'val':'ok','ack':!![]}),activeTimer=setTimeout(()=>triggerPreWarn(_0x33c75e),timeoutMs);}function a2_0x1afc(_0x28c2f9,_0x7defd2){const _0x5ab750=a2_0x141d();return a2_0x1afc=function(_0x3a17fb,_0x4e60b4){_0x3a17fb=_0x3a17fb-0x185;let _0x141dba=_0x5ab750[_0x3a17fb];return _0x141dba;},a2_0x1afc(_0x28c2f9,_0x7defd2);}function resetTimer(_0x1a9706){const _0x320a3e=a2_0x3799f8;if(activeTimer)clearTimeout(activeTimer);activeTimer=null,currentMonitoredRoom=null,alarmStage=0x0,_0x1a9706[_0x320a3e(0x185)](_0x320a3e(0x1ab),{'val':'ok','ack':!![]}),_0x1a9706[_0x320a3e(0x185)](_0x320a3e(0x1b8),{'val':![],'ack':!![]}),_0x1a9706[_0x320a3e(0x185)]('analysis.safety.deadMan.napProbability',{'val':0x0,'ack':!![]});}async function triggerPreWarn(_0x40d1fd){const _0x590db1=a2_0x3799f8;alarmStage=0x1,await _0x40d1fd[_0x590db1(0x185)](_0x590db1(0x1ab),{'val':_0x590db1(0x189),'ack':!![]});const _0x590392=_0x590db1(0x1b1)+currentMonitoredRoom+_0x590db1(0x191);_0x40d1fd[_0x590db1(0x1b5)][_0x590db1(0x195)]('[DeadMan]\x20'+_0x590392),await setup[_0x590db1(0x1af)](_0x40d1fd,_0x590db1(0x193)+_0x590392),activeTimer=setTimeout(()=>triggerAlarm(_0x40d1fd),0x5*0x3c*0x3e8);}async function triggerAlarm(_0xbbff82){const _0x4f5e78=a2_0x3799f8;alarmStage=0x2,await _0xbbff82['setStateAsync'](_0x4f5e78(0x1ab),{'val':_0x4f5e78(0x1bd),'ack':!![]});const _0x2f02ca='ðŸš¨\x20NOTFALL-ALARM:\x20Person\x20reagiert\x20nicht\x20in\x20'+currentMonitoredRoom+'!';_0xbbff82[_0x4f5e78(0x1b5)][_0x4f5e78(0x186)]('[DeadMan]\x20'+_0x2f02ca),await setup[_0x4f5e78(0x1af)](_0xbbff82,_0x2f02ca,![],!![]);}module['exports']={'updateLocation':updateLocation};