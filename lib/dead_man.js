(function(_0x3a6eae,_0x10b538){const _0x3b682a=a2_0x58a5,_0x2fde4b=_0x3a6eae();while(!![]){try{const _0x4bc75e=-parseInt(_0x3b682a(0x11c))/0x1+-parseInt(_0x3b682a(0x121))/0x2*(-parseInt(_0x3b682a(0x12c))/0x3)+parseInt(_0x3b682a(0xfd))/0x4*(parseInt(_0x3b682a(0xf9))/0x5)+-parseInt(_0x3b682a(0x123))/0x6+-parseInt(_0x3b682a(0x127))/0x7*(parseInt(_0x3b682a(0x113))/0x8)+parseInt(_0x3b682a(0x105))/0x9+-parseInt(_0x3b682a(0x118))/0xa*(-parseInt(_0x3b682a(0xf7))/0xb);if(_0x4bc75e===_0x10b538)break;else _0x2fde4b['push'](_0x2fde4b['shift']());}catch(_0x212c49){_0x2fde4b['push'](_0x2fde4b['shift']());}}}(a2_0xcb5e,0xd46c7));const a2_0x51ee29=(function(){let _0x4285ee=!![];return function(_0x4848b1,_0x9ebc8e){const _0x483109=_0x4285ee?function(){const _0x2c4476=a2_0x58a5;if(_0x9ebc8e){const _0x18f1c3=_0x9ebc8e[_0x2c4476(0x128)](_0x4848b1,arguments);return _0x9ebc8e=null,_0x18f1c3;}}:function(){};return _0x4285ee=![],_0x483109;};}()),a2_0x17d1ad=a2_0x51ee29(this,function(){const _0x2dedb8=a2_0x58a5;return a2_0x17d1ad['toString']()['search'](_0x2dedb8(0x10c))['toString']()['constructor'](a2_0x17d1ad)[_0x2dedb8(0x129)](_0x2dedb8(0x10c));});function a2_0xcb5e(){const _0x832e44=['1388936mpFeLq','%).\x20VerlÃ¤ngere\x20Timer\x20fÃ¼r\x20','includes','analysis.safety.deadMan.currentRoom','message','alarm','indexOf','stringify','12861153RghPOB','ðŸš¨\x20NOTFALL-ALARM:\x20Person\x20reagiert\x20nicht\x20in\x20','now','[DeadMan]\x20','living','sofa','analysis.safety.deadMan.smartSleep','(((.+)+)+)+$','.\x20Alles\x20in\x20Ordnung?','ðŸ‘¼\x20Schutzengel-Frage:\x20','\x20(Multi-Person\x20Filter)','sendNotification','getStateAsync','analysis.safety.deadMan.active','32NQlXKU','ðŸ’¤\x20Smart\x20Sleep\x20erkannt\x20(','[DeadMan]\x20Topology\x20check\x20failed:\x20','toLowerCase','log','10tmUudh','bad','warn','wohn','1260804RkAreu','analysis.safety.deadMan.alarmState','val','\x20Min.','\x20fÃ¼r\x20','111414ClSkIF','schlaf','5433432DCAfRT','setStateAsync','analysis.safety.deadMan.napProbability','default','58002NmNCFk','apply','search','replace','ðŸ‘¼\x20Schutzengel:\x20Ãœberwache\x20','63znGMgu','Unknown','bed','1358599wcheOk','error','5plVibZ','Ignoriere\x20Bewegung\x20in\x20\x27','toFixed','\x27.\x20Nicht\x20verbunden\x20mit\x20Ã¼berwachtem\x20\x27'];a2_0xcb5e=function(){return _0x832e44;};return a2_0xcb5e();}a2_0x17d1ad();'use strict';const setup=require('./setup');let activeTimer=null,currentMonitoredRoom=null,timeoutMs=0x0,startTime=0x0,alarmStage=0x0;const DEFAULT_TIMEOUTS={'bad':0x2d,'bath':0x2d,'toilet':0x1e,'wc':0x1e,'keller':0x3c,'schlaf':0x78,'bed':0x78,'guest':0x5a,'gast':0x5a};function getTimeoutRobust(_0x932b5,_0x51acfc){const _0xab8d68=a2_0x58a5;if(!_0x932b5||!_0x51acfc)return undefined;if(_0x932b5[_0x51acfc])return _0x932b5[_0x51acfc];const _0x43077e=_0x51acfc['toLowerCase']()[_0xab8d68(0x12a)](/[^a-z0-9]/g,'');for(const _0xb3dd97 in _0x932b5){const _0x2eb6e1=_0xb3dd97['toLowerCase']()['replace'](/[^a-z0-9]/g,'');if(_0x2eb6e1===_0x43077e)return _0x932b5[_0xb3dd97];}const _0xc80310=_0x51acfc[_0xab8d68(0x116)]();if(_0x932b5[_0xc80310])return _0x932b5[_0xc80310];return undefined;}async function loadConfig(_0x628478){const _0x4ed1d1=a2_0x58a5;try{const _0x3939d0=await _0x628478[_0x4ed1d1(0x111)]('analysis.safety.deadMan.config');if(_0x3939d0&&_0x3939d0['val'])return JSON['parse'](_0x3939d0[_0x4ed1d1(0x11e)]);}catch(_0x46a3cd){}return{};}function a2_0x58a5(_0x10068b,_0x4be2bb){const _0x2dbbb1=a2_0xcb5e();return a2_0x58a5=function(_0x17d1ad,_0x51ee29){_0x17d1ad=_0x17d1ad-0xf7;let _0xcb5e64=_0x2dbbb1[_0x17d1ad];return _0xcb5e64;},a2_0x58a5(_0x10068b,_0x4be2bb);}async function isActive(_0xa32cc6){const _0x4c2131=a2_0x58a5;try{const _0x554031=await _0xa32cc6['getStateAsync'](_0x4c2131(0x112));return _0x554031&&_0x554031['val'];}catch(_0x44331b){return![];}}async function areRoomsConnected(_0x5330a9,_0x5f17eb,_0x2ba136){const _0x6431d8=a2_0x58a5;try{const _0x122fd0=await _0x5330a9['getStateAsync']('analysis.topology.structure');if(!_0x122fd0||!_0x122fd0['val'])return!![];const _0xb5739b=JSON['parse'](_0x122fd0['val']),{rooms:_0x4eebae,matrix:_0x1efdab}=_0xb5739b;if(!_0x4eebae||!_0x1efdab)return!![];const _0x2f8dc1=_0x4eebae['indexOf'](_0x5f17eb),_0xaba54a=_0x4eebae[_0x6431d8(0x103)](_0x2ba136);if(_0x2f8dc1===-0x1||_0xaba54a===-0x1)return!![];const _0x3c6f0a=_0x1efdab[_0x2f8dc1][_0xaba54a]>0x0||_0x1efdab[_0xaba54a][_0x2f8dc1]>0x0;return _0x3c6f0a;}catch(_0x111aa0){return _0x5330a9[_0x6431d8(0x117)][_0x6431d8(0x11a)](_0x6431d8(0x115)+_0x111aa0[_0x6431d8(0x101)]),!![];}}function calculateSleepProbability(_0x310d02){const _0x3f7ea8=a2_0x58a5,_0x424d88=new Date(),_0x4d3d8b=_0x424d88['getHours'](),_0x2cd29c=_0x310d02[_0x3f7ea8(0x116)]();let _0x2f7454=0.1;if(_0x4d3d8b>=0x17||_0x4d3d8b<=0x6)_0x2f7454=0x1;else{if(_0x4d3d8b>=0xd&&_0x4d3d8b<=0xf)_0x2f7454=0.8;else{if(_0x4d3d8b>=0x14&&_0x4d3d8b<=0x17)_0x2f7454=0.4;}}let _0x3e98c2=0.1;if(_0x2cd29c['includes'](_0x3f7ea8(0x122))||_0x2cd29c[_0x3f7ea8(0xff)](_0x3f7ea8(0x12e)))_0x3e98c2=0x1;else{if(_0x2cd29c['includes'](_0x3f7ea8(0x11b))||_0x2cd29c[_0x3f7ea8(0xff)](_0x3f7ea8(0x109))||_0x2cd29c[_0x3f7ea8(0xff)](_0x3f7ea8(0x10a)))_0x3e98c2=0.6;else{if(_0x2cd29c[_0x3f7ea8(0xff)](_0x3f7ea8(0x119))||_0x2cd29c[_0x3f7ea8(0xff)]('wc'))_0x3e98c2=0.05;}}let _0x2cf133=0.5;const _0x515fc8=_0x3e98c2*0.5+_0x2f7454*0.3+_0x2cf133*0.2;return parseFloat(_0x515fc8[_0x3f7ea8(0xfb)](0x2));}async function updateLocation(_0xec5cb1,_0x14bcd7){const _0x203093=a2_0x58a5;if(!_0x14bcd7||_0x14bcd7===_0x203093(0x12d))return;if(!await isActive(_0xec5cb1)){resetTimer(_0xec5cb1);return;}if(currentMonitoredRoom&&currentMonitoredRoom!==_0x14bcd7){const _0x2bfc72=await areRoomsConnected(_0xec5cb1,currentMonitoredRoom,_0x14bcd7);if(!_0x2bfc72){const _0x1c1568=_0x203093(0xfa)+_0x14bcd7+_0x203093(0xfc)+currentMonitoredRoom+'\x27.';_0xec5cb1['log']['info'](_0x203093(0x108)+_0x1c1568+_0x203093(0x10f)),await _0xec5cb1['setStateAsync']('analysis.safety.deadMan.lastIgnored',{'val':JSON[_0x203093(0x104)]({'room':_0x14bcd7,'reason':_0x1c1568,'timestamp':Date['now']()}),'ack':!![]});return;}resetTimer(_0xec5cb1);}if(!currentMonitoredRoom){await _0xec5cb1[_0x203093(0x124)](_0x203093(0x100),{'val':_0x14bcd7,'ack':!![]});const _0x47b2b9=await loadConfig(_0xec5cb1);let _0x30e0e1=getTimeoutRobust(_0x47b2b9,_0x14bcd7);const _0xe00e6=_0x14bcd7[_0x203093(0x116)]();if(!_0x30e0e1)for(const _0x12d98c in DEFAULT_TIMEOUTS){if(_0xe00e6[_0x203093(0xff)](_0x12d98c)){_0x30e0e1=DEFAULT_TIMEOUTS[_0x12d98c];break;}}if(!_0x30e0e1&&_0x47b2b9[_0x203093(0x126)])_0x30e0e1=_0x47b2b9[_0x203093(0x126)];if(!_0x30e0e1)return;currentMonitoredRoom=_0x14bcd7,startTimer(_0xec5cb1,_0x30e0e1,_0x14bcd7);}}function startTimer(_0x32e7ac,_0x17904c,_0x1378b4){const _0x337e8d=a2_0x58a5;if(activeTimer)clearTimeout(activeTimer);timeoutMs=_0x17904c*0x3c*0x3e8,startTime=Date[_0x337e8d(0x107)](),alarmStage=0x0;const _0x485450=calculateSleepProbability(_0x1378b4||currentMonitoredRoom),_0x564a3b=_0x485450>0.65;_0x564a3b?(timeoutMs+=0x5a*0x3c*0x3e8,_0x32e7ac[_0x337e8d(0x117)]['info'](_0x337e8d(0x114)+(_0x485450*0x64)[_0x337e8d(0xfb)](0x0)+_0x337e8d(0xfe)+currentMonitoredRoom+'\x20um\x2090\x20Min.'),_0x32e7ac[_0x337e8d(0x124)](_0x337e8d(0x10b),{'val':!![],'ack':!![]})):_0x32e7ac['setStateAsync']('analysis.safety.deadMan.smartSleep',{'val':![],'ack':!![]}),_0x32e7ac[_0x337e8d(0x124)](_0x337e8d(0x125),{'val':_0x485450,'ack':!![]}),_0x32e7ac[_0x337e8d(0x117)]['info'](_0x337e8d(0x12b)+currentMonitoredRoom+_0x337e8d(0x120)+_0x17904c+_0x337e8d(0x11f)),_0x32e7ac['setStateAsync']('analysis.safety.deadMan.alarmState',{'val':'ok','ack':!![]}),activeTimer=setTimeout(()=>triggerPreWarn(_0x32e7ac),timeoutMs);}function resetTimer(_0x36749d){const _0x3dac39=a2_0x58a5;if(activeTimer)clearTimeout(activeTimer);activeTimer=null,currentMonitoredRoom=null,alarmStage=0x0,_0x36749d['setStateAsync'](_0x3dac39(0x11d),{'val':'ok','ack':!![]}),_0x36749d[_0x3dac39(0x124)](_0x3dac39(0x10b),{'val':![],'ack':!![]}),_0x36749d[_0x3dac39(0x124)](_0x3dac39(0x125),{'val':0x0,'ack':!![]});}async function triggerPreWarn(_0x551c89){const _0x3cd10e=a2_0x58a5;alarmStage=0x1,await _0x551c89[_0x3cd10e(0x124)]('analysis.safety.deadMan.alarmState',{'val':'pre_warn','ack':!![]});const _0x1039a5='â³\x20ACHTUNG:\x20UngewÃ¶hnlich\x20lange\x20InaktivitÃ¤t\x20in\x20'+currentMonitoredRoom+_0x3cd10e(0x10d);_0x551c89['log'][_0x3cd10e(0x11a)](_0x3cd10e(0x108)+_0x1039a5),await setup[_0x3cd10e(0x110)](_0x551c89,_0x3cd10e(0x10e)+_0x1039a5),activeTimer=setTimeout(()=>triggerAlarm(_0x551c89),0x5*0x3c*0x3e8);}async function triggerAlarm(_0x4d369a){const _0x343f89=a2_0x58a5;alarmStage=0x2,await _0x4d369a[_0x343f89(0x124)]('analysis.safety.deadMan.alarmState',{'val':_0x343f89(0x102),'ack':!![]});const _0x249c92=_0x343f89(0x106)+currentMonitoredRoom+'!';_0x4d369a[_0x343f89(0x117)][_0x343f89(0xf8)](_0x343f89(0x108)+_0x249c92),await setup[_0x343f89(0x110)](_0x4d369a,_0x249c92,![],!![]);}module['exports']={'updateLocation':updateLocation};