const a2_0x2ad3d2=a2_0x5911;(function(_0x49640f,_0x477103){const _0x1c9457=a2_0x5911,_0x385f7d=_0x49640f();while(!![]){try{const _0x580677=parseInt(_0x1c9457(0x214))/0x1*(-parseInt(_0x1c9457(0x1fc))/0x2)+parseInt(_0x1c9457(0x205))/0x3*(-parseInt(_0x1c9457(0x20c))/0x4)+parseInt(_0x1c9457(0x20b))/0x5*(parseInt(_0x1c9457(0x218))/0x6)+-parseInt(_0x1c9457(0x1f6))/0x7+-parseInt(_0x1c9457(0x21b))/0x8*(parseInt(_0x1c9457(0x219))/0x9)+parseInt(_0x1c9457(0x1f0))/0xa*(-parseInt(_0x1c9457(0x207))/0xb)+-parseInt(_0x1c9457(0x1e7))/0xc*(-parseInt(_0x1c9457(0x1e3))/0xd);if(_0x580677===_0x477103)break;else _0x385f7d['push'](_0x385f7d['shift']());}catch(_0x2b6845){_0x385f7d['push'](_0x385f7d['shift']());}}}(a2_0x27e2,0x42ef6));const a2_0x31a7bc=(function(){let _0x212ac3=!![];return function(_0x3c9094,_0x1ee55f){const _0x18bbf9=_0x212ac3?function(){const _0x46bddd=a2_0x5911;if(_0x1ee55f){const _0x590b4b=_0x1ee55f[_0x46bddd(0x20d)](_0x3c9094,arguments);return _0x1ee55f=null,_0x590b4b;}}:function(){};return _0x212ac3=![],_0x18bbf9;};}()),a2_0x2e1659=a2_0x31a7bc(this,function(){const _0x29e8ea=a2_0x5911;return a2_0x2e1659[_0x29e8ea(0x21c)]()[_0x29e8ea(0x1e8)]('(((.+)+)+)+$')[_0x29e8ea(0x21c)]()[_0x29e8ea(0x1e5)](a2_0x2e1659)['search']('(((.+)+)+)+$');});a2_0x2e1659();'use strict';const setup=require(a2_0x2ad3d2(0x208));let activeTimer=null,currentMonitoredRoom=null,timeoutMs=0x0,startTime=0x0,alarmStage=0x0;function a2_0x5911(_0x4a1045,_0x3176f7){const _0x4e960c=a2_0x27e2();return a2_0x5911=function(_0x2e1659,_0x31a7bc){_0x2e1659=_0x2e1659-0x1e2;let _0x27e290=_0x4e960c[_0x2e1659];return _0x27e290;},a2_0x5911(_0x4a1045,_0x3176f7);}const DEFAULT_TIMEOUTS={'bad':0x2d,'bath':0x2d,'toilet':0x1e,'wc':0x1e,'keller':0x3c,'schlaf':0x78,'bed':0x78,'guest':0x5a,'gast':0x5a};function getTimeoutRobust(_0x2806d3,_0x529cc8){const _0x578a49=a2_0x2ad3d2;if(!_0x2806d3||!_0x529cc8)return undefined;if(_0x2806d3[_0x529cc8])return _0x2806d3[_0x529cc8];const _0x1ecdfb=_0x529cc8[_0x578a49(0x1ee)]()[_0x578a49(0x1ec)](/[^a-z0-9]/g,'');for(const _0x6a8dcf in _0x2806d3){const _0x258940=_0x6a8dcf[_0x578a49(0x1ee)]()[_0x578a49(0x1ec)](/[^a-z0-9]/g,'');if(_0x258940===_0x1ecdfb)return _0x2806d3[_0x6a8dcf];}const _0x78e7d4=_0x529cc8[_0x578a49(0x1ee)]();if(_0x2806d3[_0x78e7d4])return _0x2806d3[_0x78e7d4];return undefined;}async function loadConfig(_0x17df19){const _0x29975b=a2_0x2ad3d2;try{const _0x2edeb8=await _0x17df19[_0x29975b(0x1f4)](_0x29975b(0x209));if(_0x2edeb8&&_0x2edeb8[_0x29975b(0x1e9)])return JSON[_0x29975b(0x201)](_0x2edeb8['val']);}catch(_0x29be6b){}return{};}async function isActive(_0x4a1555){const _0x473fcf=a2_0x2ad3d2;try{const _0x4893d2=await _0x4a1555[_0x473fcf(0x1f4)]('analysis.safety.deadMan.active');return _0x4893d2&&_0x4893d2[_0x473fcf(0x1e9)];}catch(_0x5135de){return![];}}async function areRoomsConnected(_0x25dada,_0x1a94a9,_0x55c6c9){const _0x3b6f57=a2_0x2ad3d2;try{const _0x4dcfdf=await _0x25dada[_0x3b6f57(0x1f4)](_0x3b6f57(0x206));if(!_0x4dcfdf||!_0x4dcfdf[_0x3b6f57(0x1e9)])return!![];const _0x258d53=JSON[_0x3b6f57(0x201)](_0x4dcfdf[_0x3b6f57(0x1e9)]),{rooms:_0x374526,matrix:_0x40c869}=_0x258d53;if(!_0x374526||!_0x40c869)return!![];const _0x4bf0de=_0x374526['indexOf'](_0x1a94a9),_0x2b43a7=_0x374526[_0x3b6f57(0x1eb)](_0x55c6c9);if(_0x4bf0de===-0x1||_0x2b43a7===-0x1)return!![];const _0x4e75b8=_0x40c869[_0x4bf0de][_0x2b43a7]>0x0||_0x40c869[_0x2b43a7][_0x4bf0de]>0x0;return _0x4e75b8;}catch(_0x204773){return _0x25dada[_0x3b6f57(0x1f5)][_0x3b6f57(0x1fb)]('[DeadMan]\x20Topology\x20check\x20failed:\x20'+_0x204773['message']),!![];}}function a2_0x27e2(){const _0x2484b2=['288TVBWQP','stringify','103352sDAihY','toString','ðŸ’¤\x20Smart\x20Sleep\x20erkannt\x20(','13LbJPDe','Unknown','constructor','info','15390516TpYixS','search','val','includes','indexOf','replace','analysis.safety.deadMan.alarmState','toLowerCase','analysis.safety.deadMan.lastIgnored','30accRpx','ðŸ‘¼\x20Schutzengel-Frage:\x20','\x20Min.','getHours','getStateAsync','log','85680URGSYT','default','toFixed','analysis.safety.deadMan.smartSleep','\x20fÃ¼r\x20','warn','2HkCnqq','analysis.safety.deadMan.napProbability','sendNotification','wohn','analysis.safety.deadMan.currentRoom','parse','.\x20Alles\x20in\x20Ordnung?','[DeadMan]\x20','\x20um\x2090\x20Min.','129666OnzOqw','analysis.topology.structure','1519529JkuqUu','./setup','analysis.safety.deadMan.config','exports','65wNIVnq','4PcuguS','apply','ðŸ‘¼\x20Schutzengel:\x20Ãœberwache\x20','alarm','\x27.\x20Nicht\x20verbunden\x20mit\x20Ã¼berwachtem\x20\x27','setStateAsync','schlaf','now','326239joIVJk','â³\x20ACHTUNG:\x20UngewÃ¶hnlich\x20lange\x20InaktivitÃ¤t\x20in\x20','pre_warn','ðŸš¨\x20NOTFALL-ALARM:\x20Person\x20reagiert\x20nicht\x20in\x20','92838PhAzlR'];a2_0x27e2=function(){return _0x2484b2;};return a2_0x27e2();}function calculateSleepProbability(_0xd34ccb){const _0x3ccf5f=a2_0x2ad3d2,_0x98873b=new Date(),_0x49e2b2=_0x98873b[_0x3ccf5f(0x1f3)](),_0x3103c9=_0xd34ccb[_0x3ccf5f(0x1ee)]();let _0x28122d=0.1;if(_0x49e2b2>=0x17||_0x49e2b2<=0x6)_0x28122d=0x1;else{if(_0x49e2b2>=0xd&&_0x49e2b2<=0xf)_0x28122d=0.8;else{if(_0x49e2b2>=0x14&&_0x49e2b2<=0x17)_0x28122d=0.4;}}let _0x1e994c=0.1;if(_0x3103c9['includes'](_0x3ccf5f(0x212))||_0x3103c9['includes']('bed'))_0x1e994c=0x1;else{if(_0x3103c9[_0x3ccf5f(0x1ea)](_0x3ccf5f(0x1ff))||_0x3103c9[_0x3ccf5f(0x1ea)]('living')||_0x3103c9[_0x3ccf5f(0x1ea)]('sofa'))_0x1e994c=0.6;else{if(_0x3103c9['includes']('bad')||_0x3103c9[_0x3ccf5f(0x1ea)]('wc'))_0x1e994c=0.05;}}let _0x509432=0.5;const _0xa72ced=_0x1e994c*0.5+_0x28122d*0.3+_0x509432*0.2;return parseFloat(_0xa72ced[_0x3ccf5f(0x1f8)](0x2));}async function updateLocation(_0xc56997,_0x275641){const _0x46c720=a2_0x2ad3d2;if(!_0x275641||_0x275641===_0x46c720(0x1e4))return;if(!await isActive(_0xc56997)){resetTimer(_0xc56997);return;}if(currentMonitoredRoom&&currentMonitoredRoom!==_0x275641){const _0x38c8da=await areRoomsConnected(_0xc56997,currentMonitoredRoom,_0x275641);if(!_0x38c8da){const _0x1fd5fa='Ignoriere\x20Bewegung\x20in\x20\x27'+_0x275641+_0x46c720(0x210)+currentMonitoredRoom+'\x27.';_0xc56997['log'][_0x46c720(0x1e6)](_0x46c720(0x203)+_0x1fd5fa+'\x20(Multi-Person\x20Filter)'),await _0xc56997[_0x46c720(0x211)](_0x46c720(0x1ef),{'val':JSON[_0x46c720(0x21a)]({'room':_0x275641,'reason':_0x1fd5fa,'timestamp':Date[_0x46c720(0x213)]()}),'ack':!![]});return;}resetTimer(_0xc56997);}if(!currentMonitoredRoom){await _0xc56997[_0x46c720(0x211)](_0x46c720(0x200),{'val':_0x275641,'ack':!![]});const _0x10ce43=await loadConfig(_0xc56997);let _0x16df61=getTimeoutRobust(_0x10ce43,_0x275641);const _0x2af4b7=_0x275641['toLowerCase']();if(!_0x16df61)for(const _0x231c49 in DEFAULT_TIMEOUTS){if(_0x2af4b7['includes'](_0x231c49)){_0x16df61=DEFAULT_TIMEOUTS[_0x231c49];break;}}if(!_0x16df61&&_0x10ce43['default'])_0x16df61=_0x10ce43[_0x46c720(0x1f7)];if(!_0x16df61)return;currentMonitoredRoom=_0x275641,startTimer(_0xc56997,_0x16df61,_0x275641);}}function startTimer(_0x187e7f,_0x5b7d8f,_0xdf3142){const _0x423f86=a2_0x2ad3d2;if(activeTimer)clearTimeout(activeTimer);timeoutMs=_0x5b7d8f*0x3c*0x3e8,startTime=Date['now'](),alarmStage=0x0;const _0x56b4e3=calculateSleepProbability(_0xdf3142||currentMonitoredRoom),_0x454648=_0x56b4e3>0.65;_0x454648?(timeoutMs+=0x5a*0x3c*0x3e8,_0x187e7f[_0x423f86(0x1f5)][_0x423f86(0x1e6)](_0x423f86(0x1e2)+(_0x56b4e3*0x64)[_0x423f86(0x1f8)](0x0)+'%).\x20VerlÃ¤ngere\x20Timer\x20fÃ¼r\x20'+currentMonitoredRoom+_0x423f86(0x204)),_0x187e7f[_0x423f86(0x211)]('analysis.safety.deadMan.smartSleep',{'val':!![],'ack':!![]})):_0x187e7f[_0x423f86(0x211)](_0x423f86(0x1f9),{'val':![],'ack':!![]}),_0x187e7f[_0x423f86(0x211)](_0x423f86(0x1fd),{'val':_0x56b4e3,'ack':!![]}),_0x187e7f['log'][_0x423f86(0x1e6)](_0x423f86(0x20e)+currentMonitoredRoom+_0x423f86(0x1fa)+_0x5b7d8f+_0x423f86(0x1f2)),_0x187e7f[_0x423f86(0x211)]('analysis.safety.deadMan.alarmState',{'val':'ok','ack':!![]}),activeTimer=setTimeout(()=>triggerPreWarn(_0x187e7f),timeoutMs);}function resetTimer(_0x529536){const _0x295407=a2_0x2ad3d2;if(activeTimer)clearTimeout(activeTimer);activeTimer=null,currentMonitoredRoom=null,alarmStage=0x0,_0x529536[_0x295407(0x211)](_0x295407(0x1ed),{'val':'ok','ack':!![]}),_0x529536[_0x295407(0x211)](_0x295407(0x1f9),{'val':![],'ack':!![]}),_0x529536[_0x295407(0x211)]('analysis.safety.deadMan.napProbability',{'val':0x0,'ack':!![]});}async function triggerPreWarn(_0x51dd1d){const _0x1cf7bd=a2_0x2ad3d2;alarmStage=0x1,await _0x51dd1d['setStateAsync'](_0x1cf7bd(0x1ed),{'val':_0x1cf7bd(0x216),'ack':!![]});const _0x4a78d3=_0x1cf7bd(0x215)+currentMonitoredRoom+_0x1cf7bd(0x202);_0x51dd1d['log']['warn'](_0x1cf7bd(0x203)+_0x4a78d3),await setup[_0x1cf7bd(0x1fe)](_0x51dd1d,_0x1cf7bd(0x1f1)+_0x4a78d3),activeTimer=setTimeout(()=>triggerAlarm(_0x51dd1d),0x5*0x3c*0x3e8);}async function triggerAlarm(_0x5bfaed){const _0x1bccc6=a2_0x2ad3d2;alarmStage=0x2,await _0x5bfaed[_0x1bccc6(0x211)](_0x1bccc6(0x1ed),{'val':_0x1bccc6(0x20f),'ack':!![]});const _0x3ebece=_0x1bccc6(0x217)+currentMonitoredRoom+'!';_0x5bfaed[_0x1bccc6(0x1f5)]['error'](_0x1bccc6(0x203)+_0x3ebece),await setup[_0x1bccc6(0x1fe)](_0x5bfaed,_0x3ebece,![],!![]);}module[a2_0x2ad3d2(0x20a)]={'updateLocation':updateLocation};