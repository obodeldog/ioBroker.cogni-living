function a2_0x553b(){const _0x214efa=['pre_warn','\x20fÃ¼r\x20','./setup','info','message','2TcoxMa','getStateAsync','wohn','analysis.safety.deadMan.napProbability','[DeadMan]\x20','schlaf','ðŸ‘¼\x20Schutzengel-Frage:\x20','Ignoriere\x20Bewegung\x20in\x20\x27','parse','ðŸ‘¼\x20Schutzengel:\x20Ãœberwache\x20','analysis.topology.structure','log','default','(((.+)+)+)+$','stringify','analysis.safety.deadMan.smartSleep','\x27.\x20Nicht\x20verbunden\x20mit\x20Ã¼berwachtem\x20\x27','%).\x20VerlÃ¤ngere\x20Timer\x20fÃ¼r\x20','warn','sendNotification','search','now','bed','7xxYurC','ðŸš¨\x20NOTFALL-ALARM:\x20Person\x20reagiert\x20nicht\x20in\x20','\x20um\x2090\x20Min.','analysis.safety.deadMan.currentRoom','\x20Min.','setStateAsync','4492905grIxwG','apply','\x20(Multi-Person\x20Filter)','115573pwdqfX','.\x20Alles\x20in\x20Ordnung?','11835864ktJmvv','â³\x20ACHTUNG:\x20UngewÃ¶hnlich\x20lange\x20InaktivitÃ¤t\x20in\x20','toLowerCase','toFixed','indexOf','getHours','381021pqmOAJ','843732NJJhTS','includes','exports','analysis.safety.deadMan.active','error','analysis.safety.deadMan.lastIgnored','1305032BLvWUj','sofa','toString','analysis.safety.deadMan.alarmState','2430684rqdzhS','[DeadMan]\x20Topology\x20check\x20failed:\x20','val','living','replace','analysis.safety.deadMan.config','bad'];a2_0x553b=function(){return _0x214efa;};return a2_0x553b();}const a2_0x292f4e=a2_0x5048;(function(_0x1c4a01,_0x57751b){const _0x101920=a2_0x5048,_0x123acf=_0x1c4a01();while(!![]){try{const _0xe9d677=parseInt(_0x101920(0x163))/0x1*(-parseInt(_0x101920(0x143))/0x2)+-parseInt(_0x101920(0x16b))/0x3+-parseInt(_0x101920(0x16c))/0x4+-parseInt(_0x101920(0x160))/0x5+parseInt(_0x101920(0x176))/0x6+-parseInt(_0x101920(0x15a))/0x7*(-parseInt(_0x101920(0x172))/0x8)+parseInt(_0x101920(0x165))/0x9;if(_0xe9d677===_0x57751b)break;else _0x123acf['push'](_0x123acf['shift']());}catch(_0x11e65c){_0x123acf['push'](_0x123acf['shift']());}}}(a2_0x553b,0x81b2d));const a2_0xab99bb=(function(){let _0xb82ee2=!![];return function(_0xe786ea,_0x26e881){const _0x243e4e=_0xb82ee2?function(){const _0x4cba7d=a2_0x5048;if(_0x26e881){const _0x1f8317=_0x26e881[_0x4cba7d(0x161)](_0xe786ea,arguments);return _0x26e881=null,_0x1f8317;}}:function(){};return _0xb82ee2=![],_0x243e4e;};}()),a2_0x177d47=a2_0xab99bb(this,function(){const _0x599d70=a2_0x5048;return a2_0x177d47[_0x599d70(0x174)]()[_0x599d70(0x157)](_0x599d70(0x150))['toString']()['constructor'](a2_0x177d47)['search'](_0x599d70(0x150));});a2_0x177d47();'use strict';const setup=require(a2_0x292f4e(0x140));let activeTimer=null,currentMonitoredRoom=null,timeoutMs=0x0,startTime=0x0,alarmStage=0x0;const DEFAULT_TIMEOUTS={'bad':0x2d,'bath':0x2d,'toilet':0x1e,'wc':0x1e,'keller':0x3c,'schlaf':0x78,'bed':0x78,'guest':0x5a,'gast':0x5a};function getTimeoutRobust(_0x5e161a,_0x39e944){const _0x491806=a2_0x292f4e;if(!_0x5e161a||!_0x39e944)return undefined;if(_0x5e161a[_0x39e944])return _0x5e161a[_0x39e944];const _0x32bc3e=_0x39e944[_0x491806(0x167)]()[_0x491806(0x17a)](/[^a-z0-9]/g,'');for(const _0x20c977 in _0x5e161a){const _0x58ee98=_0x20c977[_0x491806(0x167)]()[_0x491806(0x17a)](/[^a-z0-9]/g,'');if(_0x58ee98===_0x32bc3e)return _0x5e161a[_0x20c977];}const _0x2e2b5f=_0x39e944[_0x491806(0x167)]();if(_0x5e161a[_0x2e2b5f])return _0x5e161a[_0x2e2b5f];return undefined;}async function loadConfig(_0x38e873){const _0x1c963b=a2_0x292f4e;try{const _0x2ef783=await _0x38e873[_0x1c963b(0x144)](_0x1c963b(0x17b));if(_0x2ef783&&_0x2ef783[_0x1c963b(0x178)])return JSON['parse'](_0x2ef783[_0x1c963b(0x178)]);}catch(_0x55f9d3){}return{};}async function isActive(_0xe4a0ee){const _0x2a9cd8=a2_0x292f4e;try{const _0xafd8a6=await _0xe4a0ee['getStateAsync'](_0x2a9cd8(0x16f));return _0xafd8a6&&_0xafd8a6[_0x2a9cd8(0x178)];}catch(_0x1f1c19){return![];}}async function areRoomsConnected(_0x99c498,_0x26e669,_0x4f2a2c){const _0x373753=a2_0x292f4e;try{const _0x1c4051=await _0x99c498['getStateAsync'](_0x373753(0x14d));if(!_0x1c4051||!_0x1c4051['val'])return!![];const _0x38bc3f=JSON[_0x373753(0x14b)](_0x1c4051[_0x373753(0x178)]),{rooms:_0x386485,matrix:_0x414e50}=_0x38bc3f;if(!_0x386485||!_0x414e50)return!![];const _0x37f00e=_0x386485[_0x373753(0x169)](_0x26e669),_0x423497=_0x386485[_0x373753(0x169)](_0x4f2a2c);if(_0x37f00e===-0x1||_0x423497===-0x1)return!![];const _0xbe693b=_0x414e50[_0x37f00e][_0x423497]>0x0||_0x414e50[_0x423497][_0x37f00e]>0x0;return _0xbe693b;}catch(_0x3cef76){return _0x99c498[_0x373753(0x14e)][_0x373753(0x155)](_0x373753(0x177)+_0x3cef76[_0x373753(0x142)]),!![];}}function calculateSleepProbability(_0xa9b583){const _0x4da283=a2_0x292f4e,_0x9fbed9=new Date(),_0x548b11=_0x9fbed9[_0x4da283(0x16a)](),_0x1bcd78=_0xa9b583[_0x4da283(0x167)]();let _0x1328ce=0.1;if(_0x548b11>=0x17||_0x548b11<=0x6)_0x1328ce=0x1;else{if(_0x548b11>=0xd&&_0x548b11<=0xf)_0x1328ce=0.8;else{if(_0x548b11>=0x14&&_0x548b11<=0x17)_0x1328ce=0.4;}}let _0x31bbc0=0.1;if(_0x1bcd78['includes'](_0x4da283(0x148))||_0x1bcd78[_0x4da283(0x16d)](_0x4da283(0x159)))_0x31bbc0=0x1;else{if(_0x1bcd78[_0x4da283(0x16d)](_0x4da283(0x145))||_0x1bcd78[_0x4da283(0x16d)](_0x4da283(0x179))||_0x1bcd78[_0x4da283(0x16d)](_0x4da283(0x173)))_0x31bbc0=0.6;else{if(_0x1bcd78['includes'](_0x4da283(0x17c))||_0x1bcd78[_0x4da283(0x16d)]('wc'))_0x31bbc0=0.05;}}let _0x583ce6=0.5;const _0x28ab71=_0x31bbc0*0.5+_0x1328ce*0.3+_0x583ce6*0.2;return parseFloat(_0x28ab71['toFixed'](0x2));}function a2_0x5048(_0xd455e6,_0x82729){const _0x268a2b=a2_0x553b();return a2_0x5048=function(_0x177d47,_0xab99bb){_0x177d47=_0x177d47-0x13f;let _0x553b1e=_0x268a2b[_0x177d47];return _0x553b1e;},a2_0x5048(_0xd455e6,_0x82729);}async function updateLocation(_0x265497,_0x1ad0f1){const _0x4c36cc=a2_0x292f4e;if(!_0x1ad0f1||_0x1ad0f1==='Unknown')return;if(!await isActive(_0x265497)){resetTimer(_0x265497);return;}if(currentMonitoredRoom&&currentMonitoredRoom!==_0x1ad0f1){const _0x2b9729=await areRoomsConnected(_0x265497,currentMonitoredRoom,_0x1ad0f1);if(!_0x2b9729){const _0x9ab164=_0x4c36cc(0x14a)+_0x1ad0f1+_0x4c36cc(0x153)+currentMonitoredRoom+'\x27.';_0x265497['log'][_0x4c36cc(0x141)](_0x4c36cc(0x147)+_0x9ab164+_0x4c36cc(0x162)),await _0x265497[_0x4c36cc(0x15f)](_0x4c36cc(0x171),{'val':JSON[_0x4c36cc(0x151)]({'room':_0x1ad0f1,'reason':_0x9ab164,'timestamp':Date[_0x4c36cc(0x158)]()}),'ack':!![]});return;}resetTimer(_0x265497);}if(!currentMonitoredRoom){await _0x265497[_0x4c36cc(0x15f)](_0x4c36cc(0x15d),{'val':_0x1ad0f1,'ack':!![]});const _0x5f56d7=await loadConfig(_0x265497);let _0x4d8f1c=getTimeoutRobust(_0x5f56d7,_0x1ad0f1);const _0x47051a=_0x1ad0f1[_0x4c36cc(0x167)]();if(!_0x4d8f1c)for(const _0x1c903b in DEFAULT_TIMEOUTS){if(_0x47051a[_0x4c36cc(0x16d)](_0x1c903b)){_0x4d8f1c=DEFAULT_TIMEOUTS[_0x1c903b];break;}}if(!_0x4d8f1c&&_0x5f56d7['default'])_0x4d8f1c=_0x5f56d7[_0x4c36cc(0x14f)];if(!_0x4d8f1c)return;currentMonitoredRoom=_0x1ad0f1,startTimer(_0x265497,_0x4d8f1c,_0x1ad0f1);}}function startTimer(_0xdbfe1a,_0x1dc5c7,_0xde4abd){const _0xb1e996=a2_0x292f4e;if(activeTimer)clearTimeout(activeTimer);timeoutMs=_0x1dc5c7*0x3c*0x3e8,startTime=Date[_0xb1e996(0x158)](),alarmStage=0x0;const _0x1c5c63=calculateSleepProbability(_0xde4abd||currentMonitoredRoom),_0x2717d8=_0x1c5c63>0.65;_0x2717d8?(timeoutMs+=0x5a*0x3c*0x3e8,_0xdbfe1a[_0xb1e996(0x14e)][_0xb1e996(0x141)]('ðŸ’¤\x20Smart\x20Sleep\x20erkannt\x20('+(_0x1c5c63*0x64)[_0xb1e996(0x168)](0x0)+_0xb1e996(0x154)+currentMonitoredRoom+_0xb1e996(0x15c)),_0xdbfe1a[_0xb1e996(0x15f)](_0xb1e996(0x152),{'val':!![],'ack':!![]})):_0xdbfe1a[_0xb1e996(0x15f)](_0xb1e996(0x152),{'val':![],'ack':!![]}),_0xdbfe1a[_0xb1e996(0x15f)]('analysis.safety.deadMan.napProbability',{'val':_0x1c5c63,'ack':!![]}),_0xdbfe1a['log'][_0xb1e996(0x141)](_0xb1e996(0x14c)+currentMonitoredRoom+_0xb1e996(0x13f)+_0x1dc5c7+_0xb1e996(0x15e)),_0xdbfe1a['setStateAsync']('analysis.safety.deadMan.alarmState',{'val':'ok','ack':!![]}),activeTimer=setTimeout(()=>triggerPreWarn(_0xdbfe1a),timeoutMs);}function resetTimer(_0x39f914){const _0x479d31=a2_0x292f4e;if(activeTimer)clearTimeout(activeTimer);activeTimer=null,currentMonitoredRoom=null,alarmStage=0x0,_0x39f914['setStateAsync'](_0x479d31(0x175),{'val':'ok','ack':!![]}),_0x39f914['setStateAsync'](_0x479d31(0x152),{'val':![],'ack':!![]}),_0x39f914[_0x479d31(0x15f)](_0x479d31(0x146),{'val':0x0,'ack':!![]});}async function triggerPreWarn(_0x304a30){const _0x1efd34=a2_0x292f4e;alarmStage=0x1,await _0x304a30[_0x1efd34(0x15f)]('analysis.safety.deadMan.alarmState',{'val':_0x1efd34(0x17d),'ack':!![]});const _0x1476aa=_0x1efd34(0x166)+currentMonitoredRoom+_0x1efd34(0x164);_0x304a30[_0x1efd34(0x14e)][_0x1efd34(0x155)]('[DeadMan]\x20'+_0x1476aa),await setup['sendNotification'](_0x304a30,_0x1efd34(0x149)+_0x1476aa),activeTimer=setTimeout(()=>triggerAlarm(_0x304a30),0x5*0x3c*0x3e8);}async function triggerAlarm(_0x4ef184){const _0x54d7e1=a2_0x292f4e;alarmStage=0x2,await _0x4ef184['setStateAsync'](_0x54d7e1(0x175),{'val':'alarm','ack':!![]});const _0x1eae0c=_0x54d7e1(0x15b)+currentMonitoredRoom+'!';_0x4ef184[_0x54d7e1(0x14e)][_0x54d7e1(0x170)](_0x54d7e1(0x147)+_0x1eae0c),await setup[_0x54d7e1(0x156)](_0x4ef184,_0x1eae0c,![],!![]);}module[a2_0x292f4e(0x16e)]={'updateLocation':updateLocation};