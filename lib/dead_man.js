const a2_0x1150df=a2_0x446c;(function(_0x4eb0cd,_0x4efcdb){const _0x18a6a5=a2_0x446c,_0x364525=_0x4eb0cd();while(!![]){try{const _0x3155b2=parseInt(_0x18a6a5(0x1c7))/0x1*(-parseInt(_0x18a6a5(0x1ca))/0x2)+parseInt(_0x18a6a5(0x1b7))/0x3+-parseInt(_0x18a6a5(0x1df))/0x4+-parseInt(_0x18a6a5(0x1b1))/0x5*(parseInt(_0x18a6a5(0x1b4))/0x6)+-parseInt(_0x18a6a5(0x1e5))/0x7*(-parseInt(_0x18a6a5(0x1c8))/0x8)+parseInt(_0x18a6a5(0x1b9))/0x9+-parseInt(_0x18a6a5(0x1da))/0xa*(parseInt(_0x18a6a5(0x1b6))/0xb);if(_0x3155b2===_0x4efcdb)break;else _0x364525['push'](_0x364525['shift']());}catch(_0x509f62){_0x364525['push'](_0x364525['shift']());}}}(a2_0x4be2,0x36e2a));const a2_0xde60f2=(function(){let _0x3d774a=!![];return function(_0x543d83,_0x1c909d){const _0x59d42d=_0x3d774a?function(){if(_0x1c909d){const _0x36d0fb=_0x1c909d['apply'](_0x543d83,arguments);return _0x1c909d=null,_0x36d0fb;}}:function(){};return _0x3d774a=![],_0x59d42d;};}()),a2_0x2fdb42=a2_0xde60f2(this,function(){const _0x1565d1=a2_0x446c;return a2_0x2fdb42['toString']()[_0x1565d1(0x1bb)](_0x1565d1(0x1e1))[_0x1565d1(0x1ba)]()[_0x1565d1(0x1e2)](a2_0x2fdb42)[_0x1565d1(0x1bb)](_0x1565d1(0x1e1));});a2_0x2fdb42();'use strict';const setup=require('./setup');let activeTimer=null,currentMonitoredRoom=null,timeoutMs=0x0,startTime=0x0,alarmStage=0x0;const DEFAULT_TIMEOUTS={'bad':0x2d,'bath':0x2d,'toilet':0x1e,'wc':0x1e,'keller':0x3c,'schlaf':0x78,'bed':0x78,'guest':0x5a,'gast':0x5a};function getTimeoutRobust(_0x2b4c85,_0xb42886){const _0x2035bb=a2_0x446c;if(!_0x2b4c85||!_0xb42886)return undefined;if(_0x2b4c85[_0xb42886])return _0x2b4c85[_0xb42886];const _0x1bc323=_0xb42886[_0x2035bb(0x1c9)]()[_0x2035bb(0x1cc)](/[^a-z0-9]/g,'');for(const _0xf619e6 in _0x2b4c85){const _0x52f17d=_0xf619e6['toLowerCase']()[_0x2035bb(0x1cc)](/[^a-z0-9]/g,'');if(_0x52f17d===_0x1bc323)return _0x2b4c85[_0xf619e6];}const _0x2cb00f=_0xb42886[_0x2035bb(0x1c9)]();if(_0x2b4c85[_0x2cb00f])return _0x2b4c85[_0x2cb00f];return undefined;}function a2_0x446c(_0x15167d,_0xe0585d){const _0xb00bd1=a2_0x4be2();return a2_0x446c=function(_0x2fdb42,_0xde60f2){_0x2fdb42=_0x2fdb42-0x1b1;let _0x4be259=_0xb00bd1[_0x2fdb42];return _0x4be259;},a2_0x446c(_0x15167d,_0xe0585d);}async function loadConfig(_0x1d9099){const _0xfa07d2=a2_0x446c;try{const _0x1bf432=await _0x1d9099[_0xfa07d2(0x1c5)]('analysis.safety.deadMan.config');if(_0x1bf432&&_0x1bf432[_0xfa07d2(0x1b2)])return JSON[_0xfa07d2(0x1e7)](_0x1bf432[_0xfa07d2(0x1b2)]);}catch(_0xc56fae){}return{};}async function isActive(_0x4742b6){const _0x54057f=a2_0x446c;try{const _0x1449c2=await _0x4742b6[_0x54057f(0x1c5)](_0x54057f(0x1e4));return _0x1449c2&&_0x1449c2[_0x54057f(0x1b2)];}catch(_0x3f288a){return![];}}async function areRoomsConnected(_0x51fcc0,_0x401e9f,_0x165586){const _0x4b823d=a2_0x446c;try{const _0x300984=await _0x51fcc0[_0x4b823d(0x1c5)](_0x4b823d(0x1d4));if(!_0x300984||!_0x300984['val'])return!![];const _0x550914=JSON['parse'](_0x300984[_0x4b823d(0x1b2)]),{rooms:_0x4a076a,matrix:_0x36f032}=_0x550914;if(!_0x4a076a||!_0x36f032)return!![];const _0x381963=_0x4a076a[_0x4b823d(0x1c4)](_0x401e9f),_0x12351a=_0x4a076a[_0x4b823d(0x1c4)](_0x165586);if(_0x381963===-0x1||_0x12351a===-0x1)return!![];const _0x15a7d8=_0x36f032[_0x381963][_0x12351a]>0x0||_0x36f032[_0x12351a][_0x381963]>0x0;return _0x15a7d8;}catch(_0x1b6e20){return _0x51fcc0['log']['warn'](_0x4b823d(0x1c6)+_0x1b6e20[_0x4b823d(0x1e0)]),!![];}}function calculateSleepProbability(_0x3c5444){const _0xb98ab9=a2_0x446c,_0x52a000=new Date(),_0x5e2e45=_0x52a000[_0xb98ab9(0x1cf)](),_0x579e56=_0x3c5444[_0xb98ab9(0x1c9)]();let _0x43b599=0.1;if(_0x5e2e45>=0x17||_0x5e2e45<=0x6)_0x43b599=0x1;else{if(_0x5e2e45>=0xd&&_0x5e2e45<=0xf)_0x43b599=0.8;else{if(_0x5e2e45>=0x14&&_0x5e2e45<=0x17)_0x43b599=0.4;}}let _0x53fe0b=0.1;if(_0x579e56[_0xb98ab9(0x1c3)](_0xb98ab9(0x1b8))||_0x579e56[_0xb98ab9(0x1c3)]('bed'))_0x53fe0b=0x1;else{if(_0x579e56[_0xb98ab9(0x1c3)](_0xb98ab9(0x1d1))||_0x579e56[_0xb98ab9(0x1c3)]('living')||_0x579e56[_0xb98ab9(0x1c3)]('sofa'))_0x53fe0b=0.6;else{if(_0x579e56[_0xb98ab9(0x1c3)](_0xb98ab9(0x1d9))||_0x579e56[_0xb98ab9(0x1c3)]('wc'))_0x53fe0b=0.05;}}let _0x748219=0.5;const _0x1a9325=_0x53fe0b*0.5+_0x43b599*0.3+_0x748219*0.2;return parseFloat(_0x1a9325[_0xb98ab9(0x1e6)](0x2));}async function updateLocation(_0xa9c02a,_0x764cce){const _0x125018=a2_0x446c;if(!_0x764cce||_0x764cce==='Unknown')return;if(!await isActive(_0xa9c02a)){resetTimer(_0xa9c02a);return;}if(currentMonitoredRoom&&currentMonitoredRoom!==_0x764cce){const _0xe1502d=await areRoomsConnected(_0xa9c02a,currentMonitoredRoom,_0x764cce);if(!_0xe1502d){const _0x3311b7=_0x125018(0x1d8)+_0x764cce+'\x27.\x20Nicht\x20verbunden\x20mit\x20Ã¼berwachtem\x20\x27'+currentMonitoredRoom+'\x27.';_0xa9c02a[_0x125018(0x1bc)][_0x125018(0x1ce)](_0x125018(0x1c0)+_0x3311b7+_0x125018(0x1bd)),await _0xa9c02a['setStateAsync']('analysis.safety.deadMan.lastIgnored',{'val':JSON['stringify']({'room':_0x764cce,'reason':_0x3311b7,'timestamp':Date[_0x125018(0x1b3)]()}),'ack':!![]});return;}resetTimer(_0xa9c02a);}if(!currentMonitoredRoom){await _0xa9c02a['setStateAsync'](_0x125018(0x1d2),{'val':_0x764cce,'ack':!![]});const _0x24f5db=await loadConfig(_0xa9c02a);let _0x41a153=getTimeoutRobust(_0x24f5db,_0x764cce);const _0x343eb1=_0x764cce[_0x125018(0x1c9)]();if(!_0x41a153)for(const _0x2714a9 in DEFAULT_TIMEOUTS){if(_0x343eb1[_0x125018(0x1c3)](_0x2714a9)){_0x41a153=DEFAULT_TIMEOUTS[_0x2714a9];break;}}if(!_0x41a153&&_0x24f5db['default'])_0x41a153=_0x24f5db[_0x125018(0x1e3)];if(!_0x41a153)return;currentMonitoredRoom=_0x764cce,startTimer(_0xa9c02a,_0x41a153,_0x764cce);}}function startTimer(_0x48cdac,_0x3a47dd,_0x3245e3){const _0x1d7782=a2_0x446c;if(activeTimer)clearTimeout(activeTimer);timeoutMs=_0x3a47dd*0x3c*0x3e8,startTime=Date['now'](),alarmStage=0x0;const _0x1fdd5f=calculateSleepProbability(_0x3245e3||currentMonitoredRoom),_0x34c560=_0x1fdd5f>0.65;_0x34c560?(timeoutMs+=0x5a*0x3c*0x3e8,_0x48cdac[_0x1d7782(0x1bc)]['info'](_0x1d7782(0x1c2)+(_0x1fdd5f*0x64)[_0x1d7782(0x1e6)](0x0)+_0x1d7782(0x1d6)+currentMonitoredRoom+_0x1d7782(0x1db)),_0x48cdac[_0x1d7782(0x1d7)](_0x1d7782(0x1c1),{'val':!![],'ack':!![]})):_0x48cdac[_0x1d7782(0x1d7)](_0x1d7782(0x1c1),{'val':![],'ack':!![]}),_0x48cdac['setStateAsync'](_0x1d7782(0x1d3),{'val':_0x1fdd5f,'ack':!![]}),_0x48cdac[_0x1d7782(0x1bc)][_0x1d7782(0x1ce)]('ðŸ‘¼\x20Schutzengel:\x20Ãœberwache\x20'+currentMonitoredRoom+_0x1d7782(0x1de)+_0x3a47dd+_0x1d7782(0x1dd)),_0x48cdac[_0x1d7782(0x1d7)](_0x1d7782(0x1bf),{'val':'ok','ack':!![]}),activeTimer=setTimeout(()=>triggerPreWarn(_0x48cdac),timeoutMs);}function a2_0x4be2(){const _0x4dc040=['%).\x20VerlÃ¤ngere\x20Timer\x20fÃ¼r\x20','setStateAsync','Ignoriere\x20Bewegung\x20in\x20\x27','bad','110anCgof','\x20um\x2090\x20Min.','â³\x20ACHTUNG:\x20UngewÃ¶hnlich\x20lange\x20InaktivitÃ¤t\x20in\x20','\x20Min.','\x20fÃ¼r\x20','431128WGRJEk','message','(((.+)+)+)+$','constructor','default','analysis.safety.deadMan.active','2485qxCZdk','toFixed','parse','10OxFeMi','val','now','228870CIZupG','ðŸš¨\x20NOTFALL-ALARM:\x20Person\x20reagiert\x20nicht\x20in\x20','316283JRTpHD','1027773DyTiXs','schlaf','260217cXXUUV','toString','search','log','\x20(Multi-Person\x20Filter)','.\x20Alles\x20in\x20Ordnung?','analysis.safety.deadMan.alarmState','[DeadMan]\x20','analysis.safety.deadMan.smartSleep','ðŸ’¤\x20Smart\x20Sleep\x20erkannt\x20(','includes','indexOf','getStateAsync','[DeadMan]\x20Topology\x20check\x20failed:\x20','1ronBxp','8984RrePGP','toLowerCase','90008zDPhDV','sendNotification','replace','exports','info','getHours','ðŸ‘¼\x20Schutzengel-Frage:\x20','wohn','analysis.safety.deadMan.currentRoom','analysis.safety.deadMan.napProbability','analysis.topology.structure','warn'];a2_0x4be2=function(){return _0x4dc040;};return a2_0x4be2();}function resetTimer(_0x495a40){const _0x34717b=a2_0x446c;if(activeTimer)clearTimeout(activeTimer);activeTimer=null,currentMonitoredRoom=null,alarmStage=0x0,_0x495a40[_0x34717b(0x1d7)](_0x34717b(0x1bf),{'val':'ok','ack':!![]}),_0x495a40['setStateAsync'](_0x34717b(0x1c1),{'val':![],'ack':!![]}),_0x495a40[_0x34717b(0x1d7)](_0x34717b(0x1d3),{'val':0x0,'ack':!![]});}async function triggerPreWarn(_0x361701){const _0xfa5752=a2_0x446c;alarmStage=0x1,await _0x361701[_0xfa5752(0x1d7)](_0xfa5752(0x1bf),{'val':'pre_warn','ack':!![]});const _0x1691bf=_0xfa5752(0x1dc)+currentMonitoredRoom+_0xfa5752(0x1be);_0x361701[_0xfa5752(0x1bc)][_0xfa5752(0x1d5)](_0xfa5752(0x1c0)+_0x1691bf),await setup[_0xfa5752(0x1cb)](_0x361701,_0xfa5752(0x1d0)+_0x1691bf),activeTimer=setTimeout(()=>triggerAlarm(_0x361701),0x5*0x3c*0x3e8);}async function triggerAlarm(_0x2448f1){const _0x2c47e1=a2_0x446c;alarmStage=0x2,await _0x2448f1[_0x2c47e1(0x1d7)](_0x2c47e1(0x1bf),{'val':'alarm','ack':!![]});const _0xeb41be=_0x2c47e1(0x1b5)+currentMonitoredRoom+'!';_0x2448f1[_0x2c47e1(0x1bc)]['error']('[DeadMan]\x20'+_0xeb41be),await setup[_0x2c47e1(0x1cb)](_0x2448f1,_0xeb41be,![],!![]);}module[a2_0x1150df(0x1cd)]={'updateLocation':updateLocation};