const a2_0x1fe2f3=a2_0x3176;(function(_0x34499c,_0xfaec47){const _0x274bc8=a2_0x3176,_0x1f9e4a=_0x34499c();while(!![]){try{const _0x22ff28=-parseInt(_0x274bc8(0x14c))/0x1*(-parseInt(_0x274bc8(0x145))/0x2)+parseInt(_0x274bc8(0x143))/0x3*(parseInt(_0x274bc8(0x156))/0x4)+parseInt(_0x274bc8(0x14a))/0x5*(-parseInt(_0x274bc8(0x14b))/0x6)+parseInt(_0x274bc8(0x162))/0x7*(-parseInt(_0x274bc8(0x14f))/0x8)+-parseInt(_0x274bc8(0x157))/0x9*(parseInt(_0x274bc8(0x13e))/0xa)+-parseInt(_0x274bc8(0x158))/0xb+parseInt(_0x274bc8(0x14d))/0xc;if(_0x22ff28===_0xfaec47)break;else _0x1f9e4a['push'](_0x1f9e4a['shift']());}catch(_0x53d39e){_0x1f9e4a['push'](_0x1f9e4a['shift']());}}}(a2_0xa474,0x4e01d));function a2_0x3176(_0x14e60a,_0x2c5310){const _0x48cdb0=a2_0xa474();return a2_0x3176=function(_0x4f5b42,_0x3a918f){_0x4f5b42=_0x4f5b42-0x13a;let _0xa474eb=_0x48cdb0[_0x4f5b42];return _0xa474eb;},a2_0x3176(_0x14e60a,_0x2c5310);}function a2_0xa474(){const _0x4d5279=['exports','Ignoriere\x20Bewegung\x20in\x20\x27','search','ðŸ‘¼\x20Schutzengel:\x20Ãœberwache\x20','ðŸš¨\x20NOTFALL-ALARM:\x20Person\x20reagiert\x20nicht\x20in\x20','toLowerCase','parse','indexOf','[DeadMan]\x20','analysis.topology.structure','10CdmOqU','error','toString','sendNotification','getStateAsync','6hUhQEW','constructor','958byAWZp','val','(((.+)+)+)+$','\x27.\x20Nicht\x20verbunden\x20mit\x20Ã¼berwachtem\x20\x27','analysis.safety.deadMan.config','559660FOnaRC','24czrvnO','1086WlRuXC','11798832MPWnbs','apply','104QHDnkM','setStateAsync','log','[DeadMan]\x20Topology\x20check\x20failed:\x20','analysis.safety.deadMan.alarmState','pre_warn','Unknown','345688mJzIVq','3283191vWHyCy','4762593BNsgKg','message','info','now','alarm','warn','analysis.safety.deadMan.currentRoom','default','\x20(Multi-Person\x20Filter)','analysis.safety.deadMan.lastIgnored','59913bXxZKL'];a2_0xa474=function(){return _0x4d5279;};return a2_0xa474();}const a2_0x3a918f=(function(){let _0x233e62=!![];return function(_0x24d9fb,_0x1d6063){const _0x4c77dc=_0x233e62?function(){const _0x51f2fb=a2_0x3176;if(_0x1d6063){const _0x528b03=_0x1d6063[_0x51f2fb(0x14e)](_0x24d9fb,arguments);return _0x1d6063=null,_0x528b03;}}:function(){};return _0x233e62=![],_0x4c77dc;};}()),a2_0x4f5b42=a2_0x3a918f(this,function(){const _0x204423=a2_0x3176;return a2_0x4f5b42[_0x204423(0x140)]()[_0x204423(0x165)](_0x204423(0x147))[_0x204423(0x140)]()[_0x204423(0x144)](a2_0x4f5b42)['search']('(((.+)+)+)+$');});a2_0x4f5b42();'use strict';const setup=require('./setup');let activeTimer=null,currentMonitoredRoom=null,timeoutMs=0x0,startTime=0x0,alarmStage=0x0;const DEFAULT_TIMEOUTS={'bad':0x2d,'bath':0x2d,'toilet':0x1e,'wc':0x1e,'keller':0x3c};async function loadConfig(_0x90c02d){const _0x3951ee=a2_0x3176;try{const _0x193422=await _0x90c02d[_0x3951ee(0x142)](_0x3951ee(0x149));if(_0x193422&&_0x193422[_0x3951ee(0x146)])return JSON[_0x3951ee(0x13a)](_0x193422[_0x3951ee(0x146)]);}catch(_0x4c4362){}return{};}async function isActive(_0x558c32){const _0x44a22c=a2_0x3176;try{const _0x2c132c=await _0x558c32[_0x44a22c(0x142)]('analysis.safety.deadMan.active');return _0x2c132c&&_0x2c132c[_0x44a22c(0x146)];}catch(_0x37d287){return![];}}async function areRoomsConnected(_0x271947,_0xc14d17,_0x50a0d9){const _0x426a77=a2_0x3176;try{const _0x3f23f6=await _0x271947[_0x426a77(0x142)](_0x426a77(0x13d));if(!_0x3f23f6||!_0x3f23f6['val'])return!![];const _0x11f42c=JSON[_0x426a77(0x13a)](_0x3f23f6[_0x426a77(0x146)]),{rooms:_0x3a526f,matrix:_0x5f3745}=_0x11f42c;if(!_0x3a526f||!_0x5f3745)return!![];const _0x40d269=_0x3a526f[_0x426a77(0x13b)](_0xc14d17),_0x10ab31=_0x3a526f[_0x426a77(0x13b)](_0x50a0d9);if(_0x40d269===-0x1||_0x10ab31===-0x1)return!![];const _0x515276=_0x5f3745[_0x40d269][_0x10ab31]>0x0||_0x5f3745[_0x10ab31][_0x40d269]>0x0;return _0x515276;}catch(_0x1a3095){return _0x271947[_0x426a77(0x151)]['warn'](_0x426a77(0x152)+_0x1a3095[_0x426a77(0x159)]),!![];}}async function updateLocation(_0x34cd95,_0x41ff4e){const _0x6c03ea=a2_0x3176;if(!_0x41ff4e||_0x41ff4e===_0x6c03ea(0x155))return;if(!await isActive(_0x34cd95)){resetTimer(_0x34cd95);return;}if(currentMonitoredRoom&&currentMonitoredRoom!==_0x41ff4e){const _0x52dfae=await areRoomsConnected(_0x34cd95,currentMonitoredRoom,_0x41ff4e);if(!_0x52dfae){const _0x58dc55=_0x6c03ea(0x164)+_0x41ff4e+_0x6c03ea(0x148)+currentMonitoredRoom+'\x27.';_0x34cd95['log'][_0x6c03ea(0x15a)](_0x6c03ea(0x13c)+_0x58dc55+_0x6c03ea(0x160)),await _0x34cd95['setStateAsync'](_0x6c03ea(0x161),{'val':JSON['stringify']({'room':_0x41ff4e,'reason':_0x58dc55,'timestamp':Date[_0x6c03ea(0x15b)]()}),'ack':!![]});return;}resetTimer(_0x34cd95);}if(!currentMonitoredRoom){await _0x34cd95[_0x6c03ea(0x150)](_0x6c03ea(0x15e),{'val':_0x41ff4e,'ack':!![]});const _0x41fef7=await loadConfig(_0x34cd95),_0x567086=_0x41ff4e[_0x6c03ea(0x168)]();let _0x2b81d8=_0x41fef7[_0x41ff4e]||_0x41fef7[_0x567086];if(!_0x2b81d8)for(const _0x40402f in DEFAULT_TIMEOUTS){if(_0x567086['includes'](_0x40402f)){_0x2b81d8=DEFAULT_TIMEOUTS[_0x40402f];break;}}if(!_0x2b81d8&&_0x41fef7['default'])_0x2b81d8=_0x41fef7[_0x6c03ea(0x15f)];if(!_0x2b81d8)return;currentMonitoredRoom=_0x41ff4e,startTimer(_0x34cd95,_0x2b81d8);}}function startTimer(_0x2fa781,_0x1a3b80){const _0x312bbf=a2_0x3176;if(activeTimer)clearTimeout(activeTimer);timeoutMs=_0x1a3b80*0x3c*0x3e8,startTime=Date['now'](),alarmStage=0x0,_0x2fa781['log'][_0x312bbf(0x15a)](_0x312bbf(0x166)+currentMonitoredRoom+'\x20fÃ¼r\x20'+_0x1a3b80+'\x20Min.'),_0x2fa781['setStateAsync'](_0x312bbf(0x153),{'val':'ok','ack':!![]}),activeTimer=setTimeout(()=>triggerPreWarn(_0x2fa781),timeoutMs);}function resetTimer(_0x3331eb){const _0x497679=a2_0x3176;if(activeTimer)clearTimeout(activeTimer);activeTimer=null,currentMonitoredRoom=null,alarmStage=0x0,_0x3331eb[_0x497679(0x150)](_0x497679(0x153),{'val':'ok','ack':!![]});}async function triggerPreWarn(_0x1d0c64){const _0x1e63fb=a2_0x3176;alarmStage=0x1,await _0x1d0c64[_0x1e63fb(0x150)]('analysis.safety.deadMan.alarmState',{'val':_0x1e63fb(0x154),'ack':!![]});const _0x23472b='â³\x20ACHTUNG:\x20UngewÃ¶hnlich\x20lange\x20InaktivitÃ¤t\x20in\x20'+currentMonitoredRoom+'.\x20Alles\x20in\x20Ordnung?';_0x1d0c64[_0x1e63fb(0x151)][_0x1e63fb(0x15d)](_0x1e63fb(0x13c)+_0x23472b),await setup[_0x1e63fb(0x141)](_0x1d0c64,'ðŸ‘¼\x20Schutzengel-Frage:\x20'+_0x23472b),activeTimer=setTimeout(()=>triggerAlarm(_0x1d0c64),0x5*0x3c*0x3e8);}async function triggerAlarm(_0x22ff92){const _0x1d86a5=a2_0x3176;alarmStage=0x2,await _0x22ff92[_0x1d86a5(0x150)](_0x1d86a5(0x153),{'val':_0x1d86a5(0x15c),'ack':!![]});const _0x46cafd=_0x1d86a5(0x167)+currentMonitoredRoom+'!';_0x22ff92['log'][_0x1d86a5(0x13f)](_0x1d86a5(0x13c)+_0x46cafd),await setup[_0x1d86a5(0x141)](_0x22ff92,_0x46cafd,![],!![]);}module[a2_0x1fe2f3(0x163)]={'updateLocation':updateLocation};