(function(_0x37f6c1,_0x258cd8){const _0x5ae5ad=a2_0x9355,_0x3d8553=_0x37f6c1();while(!![]){try{const _0x593ee0=-parseInt(_0x5ae5ad(0x118))/0x1+-parseInt(_0x5ae5ad(0x133))/0x2+-parseInt(_0x5ae5ad(0x115))/0x3*(parseInt(_0x5ae5ad(0x12d))/0x4)+parseInt(_0x5ae5ad(0x10c))/0x5*(-parseInt(_0x5ae5ad(0x122))/0x6)+-parseInt(_0x5ae5ad(0x129))/0x7+parseInt(_0x5ae5ad(0x10f))/0x8*(parseInt(_0x5ae5ad(0x103))/0x9)+-parseInt(_0x5ae5ad(0x117))/0xa*(-parseInt(_0x5ae5ad(0x11c))/0xb);if(_0x593ee0===_0x258cd8)break;else _0x3d8553['push'](_0x3d8553['shift']());}catch(_0x32218e){_0x3d8553['push'](_0x3d8553['shift']());}}}(a2_0x439f,0x46cb3));const a2_0x3901e3=(function(){let _0x1daaeb=!![];return function(_0x6ad44d,_0x5bb225){const _0x21cdf6=_0x1daaeb?function(){const _0x368327=a2_0x9355;if(_0x5bb225){const _0x39ced7=_0x5bb225[_0x368327(0x135)](_0x6ad44d,arguments);return _0x5bb225=null,_0x39ced7;}}:function(){};return _0x1daaeb=![],_0x21cdf6;};}()),a2_0x3d45bd=a2_0x3901e3(this,function(){const _0x236c22=a2_0x9355;return a2_0x3d45bd['toString']()['search'](_0x236c22(0x109))[_0x236c22(0x10a)]()[_0x236c22(0x11a)](a2_0x3d45bd)['search'](_0x236c22(0x109));});a2_0x3d45bd();'use strict';const setup=require('./setup');let activeTimer=null,currentMonitoredRoom=null,timeoutMs=0x0,startTime=0x0,alarmStage=0x0;const DEFAULT_TIMEOUTS={'bad':0x2d,'bath':0x2d,'toilet':0x1e,'wc':0x1e,'keller':0x3c,'schlaf':0x78,'bed':0x78,'guest':0x5a,'gast':0x5a};async function loadConfig(_0x28d59a){const _0x553ee0=a2_0x9355;try{const _0x512e30=await _0x28d59a[_0x553ee0(0x128)]('analysis.safety.deadMan.config');if(_0x512e30&&_0x512e30[_0x553ee0(0x12a)])return JSON['parse'](_0x512e30[_0x553ee0(0x12a)]);}catch(_0x1558c3){}return{};}async function isActive(_0x13e2c6){const _0xfd618e=a2_0x9355;try{const _0x4dea27=await _0x13e2c6[_0xfd618e(0x128)]('analysis.safety.deadMan.active');return _0x4dea27&&_0x4dea27['val'];}catch(_0x36f4f9){return![];}}async function areRoomsConnected(_0x362d96,_0x3a5a5c,_0xf2c4ed){const _0x2526f6=a2_0x9355;try{const _0x41c122=await _0x362d96[_0x2526f6(0x128)](_0x2526f6(0x102));if(!_0x41c122||!_0x41c122['val'])return!![];const _0xda1505=JSON[_0x2526f6(0x11d)](_0x41c122[_0x2526f6(0x12a)]),{rooms:_0x244abb,matrix:_0x523bd7}=_0xda1505;if(!_0x244abb||!_0x523bd7)return!![];const _0x3a032d=_0x244abb[_0x2526f6(0x10e)](_0x3a5a5c),_0x5cd5a7=_0x244abb[_0x2526f6(0x10e)](_0xf2c4ed);if(_0x3a032d===-0x1||_0x5cd5a7===-0x1)return!![];const _0x434c16=_0x523bd7[_0x3a032d][_0x5cd5a7]>0x0||_0x523bd7[_0x5cd5a7][_0x3a032d]>0x0;return _0x434c16;}catch(_0x2d0554){return _0x362d96[_0x2526f6(0x12e)][_0x2526f6(0x13a)](_0x2526f6(0x108)+_0x2d0554['message']),!![];}}function calculateSleepProbability(_0x3f63c0){const _0xe7644a=a2_0x9355,_0x1ce33d=new Date(),_0x89371a=_0x1ce33d[_0xe7644a(0x123)](),_0x2acc3c=_0x3f63c0[_0xe7644a(0x120)]();let _0x250f89=0.1;if(_0x89371a>=0x17||_0x89371a<=0x6)_0x250f89=0x1;else{if(_0x89371a>=0xd&&_0x89371a<=0xf)_0x250f89=0.8;else{if(_0x89371a>=0x14&&_0x89371a<=0x17)_0x250f89=0.4;}}let _0xe8d81e=0.1;if(_0x2acc3c[_0xe7644a(0x104)](_0xe7644a(0x139))||_0x2acc3c[_0xe7644a(0x104)](_0xe7644a(0x126)))_0xe8d81e=0x1;else{if(_0x2acc3c[_0xe7644a(0x104)](_0xe7644a(0x110))||_0x2acc3c[_0xe7644a(0x104)](_0xe7644a(0x12b))||_0x2acc3c['includes'](_0xe7644a(0x12f)))_0xe8d81e=0.6;else{if(_0x2acc3c[_0xe7644a(0x104)]('bad')||_0x2acc3c[_0xe7644a(0x104)]('wc'))_0xe8d81e=0.05;}}let _0x326c9d=0.5;const _0x59a6fa=_0xe8d81e*0.5+_0x250f89*0.3+_0x326c9d*0.2;return parseFloat(_0x59a6fa[_0xe7644a(0x130)](0x2));}async function updateLocation(_0x1be7d0,_0x2798b4){const _0x401857=a2_0x9355;if(!_0x2798b4||_0x2798b4===_0x401857(0x113))return;if(!await isActive(_0x1be7d0)){resetTimer(_0x1be7d0);return;}if(currentMonitoredRoom&&currentMonitoredRoom!==_0x2798b4){const _0xe0860b=await areRoomsConnected(_0x1be7d0,currentMonitoredRoom,_0x2798b4);if(!_0xe0860b){const _0x6ea430='Ignoriere\x20Bewegung\x20in\x20\x27'+_0x2798b4+_0x401857(0x11f)+currentMonitoredRoom+'\x27.';_0x1be7d0[_0x401857(0x12e)][_0x401857(0x106)](_0x401857(0x132)+_0x6ea430+_0x401857(0x119)),await _0x1be7d0[_0x401857(0x121)]('analysis.safety.deadMan.lastIgnored',{'val':JSON[_0x401857(0x127)]({'room':_0x2798b4,'reason':_0x6ea430,'timestamp':Date[_0x401857(0x11e)]()}),'ack':!![]});return;}resetTimer(_0x1be7d0);}if(!currentMonitoredRoom){await _0x1be7d0['setStateAsync'](_0x401857(0x111),{'val':_0x2798b4,'ack':!![]});const _0x206bf3=await loadConfig(_0x1be7d0),_0x3dac7=_0x2798b4[_0x401857(0x120)]();let _0x1cb43b=_0x206bf3[_0x2798b4]||_0x206bf3[_0x3dac7];if(!_0x1cb43b)for(const _0x42a2ee in DEFAULT_TIMEOUTS){if(_0x3dac7[_0x401857(0x104)](_0x42a2ee)){_0x1cb43b=DEFAULT_TIMEOUTS[_0x42a2ee];break;}}if(!_0x1cb43b&&_0x206bf3[_0x401857(0x105)])_0x1cb43b=_0x206bf3[_0x401857(0x105)];if(!_0x1cb43b)return;currentMonitoredRoom=_0x2798b4,startTimer(_0x1be7d0,_0x1cb43b,_0x2798b4);}}function startTimer(_0x3d829a,_0x392e59,_0x32364f){const _0x29f137=a2_0x9355;if(activeTimer)clearTimeout(activeTimer);timeoutMs=_0x392e59*0x3c*0x3e8,startTime=Date[_0x29f137(0x11e)](),alarmStage=0x0;const _0x4ece9b=calculateSleepProbability(_0x32364f||currentMonitoredRoom),_0x3adec2=_0x4ece9b>0.65;_0x3adec2?(timeoutMs+=0x5a*0x3c*0x3e8,_0x3d829a[_0x29f137(0x12e)][_0x29f137(0x106)]('üí§\x20Smart\x20Sleep\x20erkannt\x20('+(_0x4ece9b*0x64)['toFixed'](0x0)+'%).\x20Verl√§ngere\x20Timer\x20f√ºr\x20'+currentMonitoredRoom+_0x29f137(0x124)),_0x3d829a[_0x29f137(0x121)]('analysis.safety.deadMan.smartSleep',{'val':!![],'ack':!![]})):_0x3d829a[_0x29f137(0x121)](_0x29f137(0x137),{'val':![],'ack':!![]}),_0x3d829a[_0x29f137(0x121)]('analysis.safety.deadMan.napProbability',{'val':_0x4ece9b,'ack':!![]}),_0x3d829a[_0x29f137(0x12e)]['info'](_0x29f137(0x136)+currentMonitoredRoom+_0x29f137(0x10b)+_0x392e59+_0x29f137(0x112)),_0x3d829a[_0x29f137(0x121)](_0x29f137(0x131),{'val':'ok','ack':!![]}),activeTimer=setTimeout(()=>triggerPreWarn(_0x3d829a),timeoutMs);}function resetTimer(_0x43a5ab){const _0x224c05=a2_0x9355;if(activeTimer)clearTimeout(activeTimer);activeTimer=null,currentMonitoredRoom=null,alarmStage=0x0,_0x43a5ab[_0x224c05(0x121)](_0x224c05(0x131),{'val':'ok','ack':!![]}),_0x43a5ab[_0x224c05(0x121)]('analysis.safety.deadMan.smartSleep',{'val':![],'ack':!![]}),_0x43a5ab[_0x224c05(0x121)](_0x224c05(0x10d),{'val':0x0,'ack':!![]});}async function triggerPreWarn(_0x2b63d1){const _0x4b5371=a2_0x9355;alarmStage=0x1,await _0x2b63d1[_0x4b5371(0x121)](_0x4b5371(0x131),{'val':_0x4b5371(0x116),'ack':!![]});const _0x30b35e=_0x4b5371(0x12c)+currentMonitoredRoom+_0x4b5371(0x107);_0x2b63d1[_0x4b5371(0x12e)][_0x4b5371(0x13a)](_0x4b5371(0x132)+_0x30b35e),await setup[_0x4b5371(0x134)](_0x2b63d1,_0x4b5371(0x125)+_0x30b35e),activeTimer=setTimeout(()=>triggerAlarm(_0x2b63d1),0x5*0x3c*0x3e8);}function a2_0x439f(){const _0x2d087a=['includes','default','info','.\x20Alles\x20in\x20Ordnung?','[DeadMan]\x20Topology\x20check\x20failed:\x20','(((.+)+)+)+$','toString','\x20f√ºr\x20','225BDLjlD','analysis.safety.deadMan.napProbability','indexOf','2128376ZhpiiJ','wohn','analysis.safety.deadMan.currentRoom','\x20Min.','Unknown','error','4341fTcwKI','pre_warn','744770LmwusB','313828NkUpdI','\x20(Multi-Person\x20Filter)','constructor','üö®\x20NOTFALL-ALARM:\x20Person\x20reagiert\x20nicht\x20in\x20','165OEPThY','parse','now','\x27.\x20Nicht\x20verbunden\x20mit\x20√ºberwachtem\x20\x27','toLowerCase','setStateAsync','15930kudnGs','getHours','\x20um\x2090\x20Min.','üëº\x20Schutzengel-Frage:\x20','bed','stringify','getStateAsync','3063809HFtQJI','val','living','‚è≥\x20ACHTUNG:\x20Ungew√∂hnlich\x20lange\x20Inaktivit√§t\x20in\x20','436pupvIv','log','sofa','toFixed','analysis.safety.deadMan.alarmState','[DeadMan]\x20','129036kamemN','sendNotification','apply','üëº\x20Schutzengel:\x20√úberwache\x20','analysis.safety.deadMan.smartSleep','alarm','schlaf','warn','analysis.topology.structure','9OSxVUO'];a2_0x439f=function(){return _0x2d087a;};return a2_0x439f();}function a2_0x9355(_0x54ae71,_0x5f2d81){const _0x2e28b0=a2_0x439f();return a2_0x9355=function(_0x3d45bd,_0x3901e3){_0x3d45bd=_0x3d45bd-0x102;let _0x439f7a=_0x2e28b0[_0x3d45bd];return _0x439f7a;},a2_0x9355(_0x54ae71,_0x5f2d81);}async function triggerAlarm(_0x2af790){const _0x1df057=a2_0x9355;alarmStage=0x2,await _0x2af790[_0x1df057(0x121)]('analysis.safety.deadMan.alarmState',{'val':_0x1df057(0x138),'ack':!![]});const _0x50ef70=_0x1df057(0x11b)+currentMonitoredRoom+'!';_0x2af790['log'][_0x1df057(0x114)](_0x1df057(0x132)+_0x50ef70),await setup['sendNotification'](_0x2af790,_0x50ef70,![],!![]);}module['exports']={'updateLocation':updateLocation};