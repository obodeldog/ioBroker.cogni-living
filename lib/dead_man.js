const a2_0xbc236e=a2_0x5adc;(function(_0x4c8916,_0x443700){const _0x49913e=a2_0x5adc,_0x49d5ea=_0x4c8916();while(!![]){try{const _0x52c334=parseInt(_0x49913e(0x1db))/0x1+parseInt(_0x49913e(0x1d3))/0x2*(-parseInt(_0x49913e(0x1ac))/0x3)+-parseInt(_0x49913e(0x1a6))/0x4*(parseInt(_0x49913e(0x1a0))/0x5)+-parseInt(_0x49913e(0x1bd))/0x6+-parseInt(_0x49913e(0x1cb))/0x7+-parseInt(_0x49913e(0x1b1))/0x8+parseInt(_0x49913e(0x1c5))/0x9*(parseInt(_0x49913e(0x1b8))/0xa);if(_0x52c334===_0x443700)break;else _0x49d5ea['push'](_0x49d5ea['shift']());}catch(_0x2c0bf3){_0x49d5ea['push'](_0x49d5ea['shift']());}}}(a2_0x3d50,0x71451));const a2_0x500575=(function(){let _0x52d86e=!![];return function(_0xafe761,_0x50449d){const _0x52093e=_0x52d86e?function(){const _0x93c3a6=a2_0x5adc;if(_0x50449d){const _0x5bc445=_0x50449d[_0x93c3a6(0x1b2)](_0xafe761,arguments);return _0x50449d=null,_0x5bc445;}}:function(){};return _0x52d86e=![],_0x52093e;};}()),a2_0x5a8913=a2_0x500575(this,function(){const _0x3be676=a2_0x5adc;return a2_0x5a8913[_0x3be676(0x1a5)]()[_0x3be676(0x1c9)](_0x3be676(0x1ca))[_0x3be676(0x1a5)]()[_0x3be676(0x1be)](a2_0x5a8913)[_0x3be676(0x1c9)](_0x3be676(0x1ca));});a2_0x5a8913();'use strict';const setup=require(a2_0xbc236e(0x1cd));let activeTimer=null,currentMonitoredRoom=null,timeoutMs=0x0,startTime=0x0,alarmStage=0x0;const DEFAULT_TIMEOUTS={'bad':0x2d,'bath':0x2d,'toilet':0x1e,'wc':0x1e,'keller':0x3c,'schlaf':0x78,'bed':0x78,'guest':0x5a,'gast':0x5a};function getTimeoutRobust(_0x489d98,_0x5ea0a5){const _0x5660fd=a2_0xbc236e;if(!_0x489d98||!_0x5ea0a5)return undefined;if(_0x489d98[_0x5ea0a5])return _0x489d98[_0x5ea0a5];const _0x17100d=_0x5ea0a5[_0x5660fd(0x1d2)]()['replace'](/[^a-z0-9]/g,'');for(const _0x590ea1 in _0x489d98){const _0x479c59=_0x590ea1['toLowerCase']()[_0x5660fd(0x1a8)](/[^a-z0-9]/g,'');if(_0x479c59===_0x17100d)return _0x489d98[_0x590ea1];}const _0x771eea=_0x5ea0a5['toLowerCase']();if(_0x489d98[_0x771eea])return _0x489d98[_0x771eea];return undefined;}async function loadConfig(_0x19561a){const _0x13c1a9=a2_0xbc236e;try{const _0x633e46=await _0x19561a[_0x13c1a9(0x1b6)](_0x13c1a9(0x1da));if(_0x633e46&&_0x633e46[_0x13c1a9(0x1c0)])return JSON[_0x13c1a9(0x1a9)](_0x633e46[_0x13c1a9(0x1c0)]);}catch(_0x130d14){}return{};}async function isActive(_0x41ed6e){const _0x344a2d=a2_0xbc236e;try{const _0x179baa=await _0x41ed6e[_0x344a2d(0x1b6)]('analysis.safety.deadMan.active');return _0x179baa&&_0x179baa[_0x344a2d(0x1c0)];}catch(_0x877b2d){return![];}}async function areRoomsConnected(_0x9438d7,_0x36f7e,_0x47b4dc){const _0x195472=a2_0xbc236e;try{const _0x146efc=await _0x9438d7['getStateAsync']('analysis.topology.structure');if(!_0x146efc||!_0x146efc[_0x195472(0x1c0)])return!![];const _0x3b771f=JSON[_0x195472(0x1a9)](_0x146efc[_0x195472(0x1c0)]),{rooms:_0x5b4d4a,matrix:_0x478b68}=_0x3b771f;if(!_0x5b4d4a||!_0x478b68)return!![];const _0x1b9088=_0x5b4d4a[_0x195472(0x1c6)](_0x36f7e),_0x3423ec=_0x5b4d4a[_0x195472(0x1c6)](_0x47b4dc);if(_0x1b9088===-0x1||_0x3423ec===-0x1)return!![];const _0x375df9=_0x478b68[_0x1b9088][_0x3423ec]>0x0||_0x478b68[_0x3423ec][_0x1b9088]>0x0;return _0x375df9;}catch(_0x2ebc26){return _0x9438d7['log'][_0x195472(0x1d5)](_0x195472(0x1c1)+_0x2ebc26[_0x195472(0x1b0)]),!![];}}function a2_0x3d50(){const _0x43123d=['parse','toFixed','alarm','6YZgfDg','sofa','\x20Min.','info','message','5267112qIfLYJ','apply','analysis.safety.deadMan.smartSleep','log','\x20um\x2090\x20Min.','getStateAsync','analysis.safety.deadMan.lastIgnored','26747530nLLSyZ','getHours','stringify','[DeadMan]\x20','setStateAsync','3974040pIjDVj','constructor','Unknown','val','[DeadMan]\x20Topology\x20check\x20failed:\x20','Ignoriere\x20Bewegung\x20in\x20\x27','includes','exports','9XHRotX','indexOf','ðŸ‘¼\x20Schutzengel:\x20Ãœberwache\x20','bad','search','(((.+)+)+)+$','1839971ISALzn','pre_warn','./setup','ðŸš¨\x20NOTFALL-ALARM:\x20Person\x20reagiert\x20nicht\x20in\x20','ðŸ‘¼\x20Schutzengel-Frage:\x20','default','bed','toLowerCase','438982EcKsjo','living','warn','analysis.safety.deadMan.napProbability','\x20fÃ¼r\x20','analysis.safety.deadMan.currentRoom','now','analysis.safety.deadMan.config','336497mmrrNC','2623665urbrtY','analysis.safety.deadMan.alarmState','wohn','error','%).\x20VerlÃ¤ngere\x20Timer\x20fÃ¼r\x20','toString','4OJMbIo','schlaf','replace'];a2_0x3d50=function(){return _0x43123d;};return a2_0x3d50();}function calculateSleepProbability(_0x26037b){const _0x999835=a2_0xbc236e,_0x42b9a1=new Date(),_0x25d91c=_0x42b9a1[_0x999835(0x1b9)](),_0x1f1f8c=_0x26037b[_0x999835(0x1d2)]();let _0x29f348=0.1;if(_0x25d91c>=0x17||_0x25d91c<=0x6)_0x29f348=0x1;else{if(_0x25d91c>=0xd&&_0x25d91c<=0xf)_0x29f348=0.8;else{if(_0x25d91c>=0x14&&_0x25d91c<=0x17)_0x29f348=0.4;}}let _0x426946=0.1;if(_0x1f1f8c[_0x999835(0x1c3)](_0x999835(0x1a7))||_0x1f1f8c[_0x999835(0x1c3)](_0x999835(0x1d1)))_0x426946=0x1;else{if(_0x1f1f8c[_0x999835(0x1c3)](_0x999835(0x1a2))||_0x1f1f8c[_0x999835(0x1c3)](_0x999835(0x1d4))||_0x1f1f8c['includes'](_0x999835(0x1ad)))_0x426946=0.6;else{if(_0x1f1f8c[_0x999835(0x1c3)](_0x999835(0x1c8))||_0x1f1f8c['includes']('wc'))_0x426946=0.05;}}let _0x3dd119=0.5;const _0x525282=_0x426946*0.5+_0x29f348*0.3+_0x3dd119*0.2;return parseFloat(_0x525282[_0x999835(0x1aa)](0x2));}function a2_0x5adc(_0x4d6c7c,_0x286a55){const _0x4e997f=a2_0x3d50();return a2_0x5adc=function(_0x5a8913,_0x500575){_0x5a8913=_0x5a8913-0x1a0;let _0x3d5033=_0x4e997f[_0x5a8913];return _0x3d5033;},a2_0x5adc(_0x4d6c7c,_0x286a55);}async function updateLocation(_0x567ea1,_0x245cbb){const _0xa13b37=a2_0xbc236e;if(!_0x245cbb||_0x245cbb===_0xa13b37(0x1bf))return;if(!await isActive(_0x567ea1)){resetTimer(_0x567ea1);return;}if(currentMonitoredRoom&&currentMonitoredRoom!==_0x245cbb){const _0x187e1f=await areRoomsConnected(_0x567ea1,currentMonitoredRoom,_0x245cbb);if(!_0x187e1f){const _0x186a76=_0xa13b37(0x1c2)+_0x245cbb+'\x27.\x20Nicht\x20verbunden\x20mit\x20Ã¼berwachtem\x20\x27'+currentMonitoredRoom+'\x27.';_0x567ea1[_0xa13b37(0x1b4)][_0xa13b37(0x1af)]('[DeadMan]\x20'+_0x186a76+'\x20(Multi-Person\x20Filter)'),await _0x567ea1[_0xa13b37(0x1bc)](_0xa13b37(0x1b7),{'val':JSON[_0xa13b37(0x1ba)]({'room':_0x245cbb,'reason':_0x186a76,'timestamp':Date[_0xa13b37(0x1d9)]()}),'ack':!![]});return;}resetTimer(_0x567ea1);}if(!currentMonitoredRoom){await _0x567ea1['setStateAsync'](_0xa13b37(0x1d8),{'val':_0x245cbb,'ack':!![]});const _0x1b0124=await loadConfig(_0x567ea1);let _0x563ad1=getTimeoutRobust(_0x1b0124,_0x245cbb);const _0x20cbfc=_0x245cbb[_0xa13b37(0x1d2)]();if(!_0x563ad1)for(const _0x38a32f in DEFAULT_TIMEOUTS){if(_0x20cbfc[_0xa13b37(0x1c3)](_0x38a32f)){_0x563ad1=DEFAULT_TIMEOUTS[_0x38a32f];break;}}if(!_0x563ad1&&_0x1b0124[_0xa13b37(0x1d0)])_0x563ad1=_0x1b0124[_0xa13b37(0x1d0)];if(!_0x563ad1)return;currentMonitoredRoom=_0x245cbb,startTimer(_0x567ea1,_0x563ad1,_0x245cbb);}}function startTimer(_0x2ed68a,_0x1eb42c,_0x192a19){const _0x48b188=a2_0xbc236e;if(activeTimer)clearTimeout(activeTimer);timeoutMs=_0x1eb42c*0x3c*0x3e8,startTime=Date['now'](),alarmStage=0x0;const _0xca1df9=calculateSleepProbability(_0x192a19||currentMonitoredRoom),_0xb2c84c=_0xca1df9>0.65;_0xb2c84c?(timeoutMs+=0x5a*0x3c*0x3e8,_0x2ed68a[_0x48b188(0x1b4)][_0x48b188(0x1af)]('ðŸ’¤\x20Smart\x20Sleep\x20erkannt\x20('+(_0xca1df9*0x64)['toFixed'](0x0)+_0x48b188(0x1a4)+currentMonitoredRoom+_0x48b188(0x1b5)),_0x2ed68a[_0x48b188(0x1bc)](_0x48b188(0x1b3),{'val':!![],'ack':!![]})):_0x2ed68a[_0x48b188(0x1bc)](_0x48b188(0x1b3),{'val':![],'ack':!![]}),_0x2ed68a[_0x48b188(0x1bc)](_0x48b188(0x1d6),{'val':_0xca1df9,'ack':!![]}),_0x2ed68a[_0x48b188(0x1b4)][_0x48b188(0x1af)](_0x48b188(0x1c7)+currentMonitoredRoom+_0x48b188(0x1d7)+_0x1eb42c+_0x48b188(0x1ae)),_0x2ed68a[_0x48b188(0x1bc)](_0x48b188(0x1a1),{'val':'ok','ack':!![]}),activeTimer=setTimeout(()=>triggerPreWarn(_0x2ed68a),timeoutMs);}function resetTimer(_0x5e774d){const _0x1cb63f=a2_0xbc236e;if(activeTimer)clearTimeout(activeTimer);activeTimer=null,currentMonitoredRoom=null,alarmStage=0x0,_0x5e774d[_0x1cb63f(0x1bc)](_0x1cb63f(0x1a1),{'val':'ok','ack':!![]}),_0x5e774d[_0x1cb63f(0x1bc)](_0x1cb63f(0x1b3),{'val':![],'ack':!![]}),_0x5e774d[_0x1cb63f(0x1bc)]('analysis.safety.deadMan.napProbability',{'val':0x0,'ack':!![]});}async function triggerPreWarn(_0x7fbc9e){const _0xb2819a=a2_0xbc236e;alarmStage=0x1,await _0x7fbc9e[_0xb2819a(0x1bc)]('analysis.safety.deadMan.alarmState',{'val':_0xb2819a(0x1cc),'ack':!![]});const _0x5f07aa='â³\x20ACHTUNG:\x20UngewÃ¶hnlich\x20lange\x20InaktivitÃ¤t\x20in\x20'+currentMonitoredRoom+'.\x20Alles\x20in\x20Ordnung?';_0x7fbc9e[_0xb2819a(0x1b4)][_0xb2819a(0x1d5)](_0xb2819a(0x1bb)+_0x5f07aa),await setup['sendNotification'](_0x7fbc9e,_0xb2819a(0x1cf)+_0x5f07aa),activeTimer=setTimeout(()=>triggerAlarm(_0x7fbc9e),0x5*0x3c*0x3e8);}async function triggerAlarm(_0x5aadcc){const _0x263d4c=a2_0xbc236e;alarmStage=0x2,await _0x5aadcc[_0x263d4c(0x1bc)](_0x263d4c(0x1a1),{'val':_0x263d4c(0x1ab),'ack':!![]});const _0x327ec0=_0x263d4c(0x1ce)+currentMonitoredRoom+'!';_0x5aadcc[_0x263d4c(0x1b4)][_0x263d4c(0x1a3)](_0x263d4c(0x1bb)+_0x327ec0),await setup['sendNotification'](_0x5aadcc,_0x327ec0,![],!![]);}module[a2_0xbc236e(0x1c4)]={'updateLocation':updateLocation};