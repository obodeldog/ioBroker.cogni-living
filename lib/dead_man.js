const a2_0x2ebb75=a2_0x97e4;(function(_0x371b5d,_0x2054f3){const _0x29d300=a2_0x97e4,_0x1d10a5=_0x371b5d();while(!![]){try{const _0x5336b3=parseInt(_0x29d300(0x200))/0x1+-parseInt(_0x29d300(0x1ff))/0x2*(parseInt(_0x29d300(0x1db))/0x3)+-parseInt(_0x29d300(0x1ee))/0x4*(parseInt(_0x29d300(0x215))/0x5)+parseInt(_0x29d300(0x208))/0x6*(-parseInt(_0x29d300(0x1fc))/0x7)+parseInt(_0x29d300(0x210))/0x8+-parseInt(_0x29d300(0x1eb))/0x9*(parseInt(_0x29d300(0x1dc))/0xa)+parseInt(_0x29d300(0x1e2))/0xb*(parseInt(_0x29d300(0x203))/0xc);if(_0x5336b3===_0x2054f3)break;else _0x1d10a5['push'](_0x1d10a5['shift']());}catch(_0x666d4){_0x1d10a5['push'](_0x1d10a5['shift']());}}}(a2_0x2697,0x4dde1));const a2_0xadebb6=(function(){let _0x521387=!![];return function(_0x26e3b1,_0x552dfa){const _0x473882=_0x521387?function(){const _0x159077=a2_0x97e4;if(_0x552dfa){const _0x1cdf01=_0x552dfa[_0x159077(0x204)](_0x26e3b1,arguments);return _0x552dfa=null,_0x1cdf01;}}:function(){};return _0x521387=![],_0x473882;};}()),a2_0x35ef99=a2_0xadebb6(this,function(){const _0x4813d5=a2_0x97e4;return a2_0x35ef99['toString']()['search']('(((.+)+)+)+$')[_0x4813d5(0x1f2)]()[_0x4813d5(0x20c)](a2_0x35ef99)[_0x4813d5(0x1ec)]('(((.+)+)+)+$');});a2_0x35ef99();'use strict';const setup=require(a2_0x2ebb75(0x1e0));function a2_0x2697(){const _0x4600ff=['warn','[DeadMan]\x20','now','Ignoriere\x20Bewegung\x20in\x20\x27','3564372seJXvW','getStateAsync','toLowerCase','2JhCgoz','153433mqaSpS','ðŸ‘¼\x20Schutzengel-Frage:\x20','\x20(Multi-Person\x20Filter)','3609816YoZCIV','apply','includes','analysis.safety.deadMan.smartSleep','bad','6BjeRDT','analysis.safety.deadMan.alarmState','bed','schlaf','constructor','living','wohn','val','2998776zjJsdW','message','parse','[DeadMan]\x20Topology\x20check\x20failed:\x20','â³\x20ACHTUNG:\x20UngewÃ¶hnlich\x20lange\x20InaktivitÃ¤t\x20in\x20','166850zhWmLZ','\x20Min.','error','960915joKuWS','1154380rdalvv','ðŸ‘¼\x20Schutzengel:\x20Ãœberwache\x20','toFixed','alarm','./setup','analysis.safety.deadMan.napProbability','33sMLHsd','default','analysis.safety.deadMan.lastIgnored','log','stringify','ðŸ’¤\x20Smart\x20Sleep\x20erkannt\x20(','setStateAsync','analysis.safety.deadMan.config','replace','9vSwUtH','search','sofa','20dIvMEV','Unknown','sendNotification','analysis.safety.deadMan.currentRoom','toString','pre_warn','info','ðŸš¨\x20NOTFALL-ALARM:\x20Person\x20reagiert\x20nicht\x20in\x20','analysis.topology.structure','getHours'];a2_0x2697=function(){return _0x4600ff;};return a2_0x2697();}function a2_0x97e4(_0x241167,_0x229c52){const _0x5bbaa1=a2_0x2697();return a2_0x97e4=function(_0x35ef99,_0xadebb6){_0x35ef99=_0x35ef99-0x1da;let _0x2697d2=_0x5bbaa1[_0x35ef99];return _0x2697d2;},a2_0x97e4(_0x241167,_0x229c52);}let activeTimer=null,currentMonitoredRoom=null,timeoutMs=0x0,startTime=0x0,alarmStage=0x0;const DEFAULT_TIMEOUTS={'bad':0x2d,'bath':0x2d,'toilet':0x1e,'wc':0x1e,'keller':0x3c,'schlaf':0x78,'bed':0x78,'guest':0x5a,'gast':0x5a};function getTimeoutRobust(_0x192b18,_0x34e977){const _0x234054=a2_0x2ebb75;if(!_0x192b18||!_0x34e977)return undefined;if(_0x192b18[_0x34e977])return _0x192b18[_0x34e977];const _0x2b89d1=_0x34e977['toLowerCase']()[_0x234054(0x1ea)](/[^a-z0-9]/g,'');for(const _0x1955aa in _0x192b18){const _0x8811c1=_0x1955aa[_0x234054(0x1fe)]()[_0x234054(0x1ea)](/[^a-z0-9]/g,'');if(_0x8811c1===_0x2b89d1)return _0x192b18[_0x1955aa];}const _0x229f39=_0x34e977[_0x234054(0x1fe)]();if(_0x192b18[_0x229f39])return _0x192b18[_0x229f39];return undefined;}async function loadConfig(_0x47ec7a){const _0x401ea1=a2_0x2ebb75;try{const _0xbcf3ee=await _0x47ec7a[_0x401ea1(0x1fd)](_0x401ea1(0x1e9));if(_0xbcf3ee&&_0xbcf3ee[_0x401ea1(0x20f)])return JSON[_0x401ea1(0x212)](_0xbcf3ee[_0x401ea1(0x20f)]);}catch(_0x5149b7){}return{};}async function isActive(_0x523fba){const _0x4e56b8=a2_0x2ebb75;try{const _0x1a248e=await _0x523fba[_0x4e56b8(0x1fd)]('analysis.safety.deadMan.active');return _0x1a248e&&_0x1a248e['val'];}catch(_0x1aa3fc){return![];}}async function areRoomsConnected(_0x215758,_0x4c0288,_0x38e38e){const _0x451ba1=a2_0x2ebb75;try{const _0xb0ca32=await _0x215758[_0x451ba1(0x1fd)](_0x451ba1(0x1f6));if(!_0xb0ca32||!_0xb0ca32[_0x451ba1(0x20f)])return!![];const _0x17e159=JSON[_0x451ba1(0x212)](_0xb0ca32[_0x451ba1(0x20f)]),{rooms:_0x3b0bf6,matrix:_0x22f135}=_0x17e159;if(!_0x3b0bf6||!_0x22f135)return!![];const _0x572568=_0x3b0bf6['indexOf'](_0x4c0288),_0x83eb6c=_0x3b0bf6['indexOf'](_0x38e38e);if(_0x572568===-0x1||_0x83eb6c===-0x1)return!![];const _0x17abaf=_0x22f135[_0x572568][_0x83eb6c]>0x0||_0x22f135[_0x83eb6c][_0x572568]>0x0;return _0x17abaf;}catch(_0x1fc968){return _0x215758[_0x451ba1(0x1e5)][_0x451ba1(0x1f8)](_0x451ba1(0x213)+_0x1fc968[_0x451ba1(0x211)]),!![];}}function calculateSleepProbability(_0x40e614){const _0x4a4a0b=a2_0x2ebb75,_0x3d4afa=new Date(),_0x5c98e9=_0x3d4afa[_0x4a4a0b(0x1f7)](),_0x1c9454=_0x40e614[_0x4a4a0b(0x1fe)]();let _0x3538b3=0.1;if(_0x5c98e9>=0x17||_0x5c98e9<=0x6)_0x3538b3=0x1;else{if(_0x5c98e9>=0xd&&_0x5c98e9<=0xf)_0x3538b3=0.8;else{if(_0x5c98e9>=0x14&&_0x5c98e9<=0x17)_0x3538b3=0.4;}}let _0x2d7abc=0.1;if(_0x1c9454[_0x4a4a0b(0x205)](_0x4a4a0b(0x20b))||_0x1c9454[_0x4a4a0b(0x205)](_0x4a4a0b(0x20a)))_0x2d7abc=0x1;else{if(_0x1c9454[_0x4a4a0b(0x205)](_0x4a4a0b(0x20e))||_0x1c9454[_0x4a4a0b(0x205)](_0x4a4a0b(0x20d))||_0x1c9454[_0x4a4a0b(0x205)](_0x4a4a0b(0x1ed)))_0x2d7abc=0.6;else{if(_0x1c9454[_0x4a4a0b(0x205)](_0x4a4a0b(0x207))||_0x1c9454[_0x4a4a0b(0x205)]('wc'))_0x2d7abc=0.05;}}let _0x4b8f76=0.5;const _0x50b7bc=_0x2d7abc*0.5+_0x3538b3*0.3+_0x4b8f76*0.2;return parseFloat(_0x50b7bc[_0x4a4a0b(0x1de)](0x2));}async function updateLocation(_0x59ef8d,_0x12fa89){const _0x4ca177=a2_0x2ebb75;if(!_0x12fa89||_0x12fa89===_0x4ca177(0x1ef))return;if(!await isActive(_0x59ef8d)){resetTimer(_0x59ef8d);return;}if(currentMonitoredRoom&&currentMonitoredRoom!==_0x12fa89){const _0x5f2acb=await areRoomsConnected(_0x59ef8d,currentMonitoredRoom,_0x12fa89);if(!_0x5f2acb){const _0x30ee4e=_0x4ca177(0x1fb)+_0x12fa89+'\x27.\x20Nicht\x20verbunden\x20mit\x20Ã¼berwachtem\x20\x27'+currentMonitoredRoom+'\x27.';_0x59ef8d['log'][_0x4ca177(0x1f4)](_0x4ca177(0x1f9)+_0x30ee4e+_0x4ca177(0x202)),await _0x59ef8d['setStateAsync'](_0x4ca177(0x1e4),{'val':JSON[_0x4ca177(0x1e6)]({'room':_0x12fa89,'reason':_0x30ee4e,'timestamp':Date[_0x4ca177(0x1fa)]()}),'ack':!![]});return;}resetTimer(_0x59ef8d);}if(!currentMonitoredRoom){await _0x59ef8d[_0x4ca177(0x1e8)](_0x4ca177(0x1f1),{'val':_0x12fa89,'ack':!![]});const _0x11f855=await loadConfig(_0x59ef8d);let _0x546557=getTimeoutRobust(_0x11f855,_0x12fa89);const _0x205eae=_0x12fa89['toLowerCase']();if(!_0x546557)for(const _0x2978c7 in DEFAULT_TIMEOUTS){if(_0x205eae[_0x4ca177(0x205)](_0x2978c7)){_0x546557=DEFAULT_TIMEOUTS[_0x2978c7];break;}}if(!_0x546557&&_0x11f855[_0x4ca177(0x1e3)])_0x546557=_0x11f855[_0x4ca177(0x1e3)];if(!_0x546557)return;currentMonitoredRoom=_0x12fa89,startTimer(_0x59ef8d,_0x546557,_0x12fa89);}}function startTimer(_0x2b948e,_0x25b56e,_0x1f0ab6){const _0x4a1a1e=a2_0x2ebb75;if(activeTimer)clearTimeout(activeTimer);timeoutMs=_0x25b56e*0x3c*0x3e8,startTime=Date[_0x4a1a1e(0x1fa)](),alarmStage=0x0;const _0x53b04c=calculateSleepProbability(_0x1f0ab6||currentMonitoredRoom),_0x5eaa96=_0x53b04c>0.65;_0x5eaa96?(timeoutMs+=0x5a*0x3c*0x3e8,_0x2b948e['log']['info'](_0x4a1a1e(0x1e7)+(_0x53b04c*0x64)['toFixed'](0x0)+'%).\x20VerlÃ¤ngere\x20Timer\x20fÃ¼r\x20'+currentMonitoredRoom+'\x20um\x2090\x20Min.'),_0x2b948e[_0x4a1a1e(0x1e8)]('analysis.safety.deadMan.smartSleep',{'val':!![],'ack':!![]})):_0x2b948e[_0x4a1a1e(0x1e8)](_0x4a1a1e(0x206),{'val':![],'ack':!![]}),_0x2b948e['setStateAsync'](_0x4a1a1e(0x1e1),{'val':_0x53b04c,'ack':!![]}),_0x2b948e['log'][_0x4a1a1e(0x1f4)](_0x4a1a1e(0x1dd)+currentMonitoredRoom+'\x20fÃ¼r\x20'+_0x25b56e+_0x4a1a1e(0x216)),_0x2b948e[_0x4a1a1e(0x1e8)]('analysis.safety.deadMan.alarmState',{'val':'ok','ack':!![]}),activeTimer=setTimeout(()=>triggerPreWarn(_0x2b948e),timeoutMs);}function resetTimer(_0x22ee3f){const _0x263699=a2_0x2ebb75;if(activeTimer)clearTimeout(activeTimer);activeTimer=null,currentMonitoredRoom=null,alarmStage=0x0,_0x22ee3f[_0x263699(0x1e8)](_0x263699(0x209),{'val':'ok','ack':!![]}),_0x22ee3f['setStateAsync']('analysis.safety.deadMan.smartSleep',{'val':![],'ack':!![]}),_0x22ee3f[_0x263699(0x1e8)](_0x263699(0x1e1),{'val':0x0,'ack':!![]});}async function triggerPreWarn(_0x11cae7){const _0x341875=a2_0x2ebb75;alarmStage=0x1,await _0x11cae7[_0x341875(0x1e8)]('analysis.safety.deadMan.alarmState',{'val':_0x341875(0x1f3),'ack':!![]});const _0x5c0371=_0x341875(0x214)+currentMonitoredRoom+'.\x20Alles\x20in\x20Ordnung?';_0x11cae7[_0x341875(0x1e5)][_0x341875(0x1f8)](_0x341875(0x1f9)+_0x5c0371),await setup['sendNotification'](_0x11cae7,_0x341875(0x201)+_0x5c0371),activeTimer=setTimeout(()=>triggerAlarm(_0x11cae7),0x5*0x3c*0x3e8);}async function triggerAlarm(_0x46aff7){const _0xd6f668=a2_0x2ebb75;alarmStage=0x2,await _0x46aff7[_0xd6f668(0x1e8)](_0xd6f668(0x209),{'val':_0xd6f668(0x1df),'ack':!![]});const _0x559a32=_0xd6f668(0x1f5)+currentMonitoredRoom+'!';_0x46aff7[_0xd6f668(0x1e5)][_0xd6f668(0x1da)](_0xd6f668(0x1f9)+_0x559a32),await setup[_0xd6f668(0x1f0)](_0x46aff7,_0x559a32,![],!![]);}module['exports']={'updateLocation':updateLocation};