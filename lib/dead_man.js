const a2_0x40236c=a2_0xa23c;(function(_0x8d83d7,_0x90e54d){const _0x2d11b4=a2_0xa23c,_0x55fec5=_0x8d83d7();while(!![]){try{const _0x5f29c4=parseInt(_0x2d11b4(0xe8))/0x1+parseInt(_0x2d11b4(0xee))/0x2*(parseInt(_0x2d11b4(0xc7))/0x3)+-parseInt(_0x2d11b4(0xc5))/0x4+-parseInt(_0x2d11b4(0xc8))/0x5*(-parseInt(_0x2d11b4(0xe7))/0x6)+parseInt(_0x2d11b4(0xd2))/0x7*(-parseInt(_0x2d11b4(0xe0))/0x8)+parseInt(_0x2d11b4(0xea))/0x9+-parseInt(_0x2d11b4(0xd6))/0xa*(parseInt(_0x2d11b4(0xdb))/0xb);if(_0x5f29c4===_0x90e54d)break;else _0x55fec5['push'](_0x55fec5['shift']());}catch(_0x7f5826){_0x55fec5['push'](_0x55fec5['shift']());}}}(a2_0x4e35,0x6cca4));const a2_0x575e90=(function(){let _0x18e735=!![];return function(_0x539b83,_0x5c7b89){const _0x59146e=_0x18e735?function(){const _0x8e83d7=a2_0xa23c;if(_0x5c7b89){const _0x165a01=_0x5c7b89[_0x8e83d7(0xe9)](_0x539b83,arguments);return _0x5c7b89=null,_0x165a01;}}:function(){};return _0x18e735=![],_0x59146e;};}()),a2_0xb1f6dd=a2_0x575e90(this,function(){const _0x48ea5c=a2_0xa23c;return a2_0xb1f6dd[_0x48ea5c(0xdf)]()[_0x48ea5c(0xdc)](_0x48ea5c(0xde))[_0x48ea5c(0xdf)]()[_0x48ea5c(0xce)](a2_0xb1f6dd)[_0x48ea5c(0xdc)](_0x48ea5c(0xde));});a2_0xb1f6dd();function a2_0x4e35(){const _0x427ad0=['\x20Min.','\x20fÃ¼r\x20','message','14810hVVvRQ','analysis.safety.deadMan.active','exports','analysis.topology.structure','ðŸš¨\x20NOTFALL-ALARM:\x20Person\x20reagiert\x20nicht\x20in\x20','7403MDBTWs','search','getStateAsync','(((.+)+)+)+$','toString','8RprdwB','./setup','info','analysis.safety.deadMan.alarmState','default','log','warn','158562PbgSWr','861794LjwYKV','apply','4774266YQmBVz','error','ðŸ‘¼\x20Schutzengel:\x20Ãœberwache\x20','\x27.\x20Nicht\x20verbunden\x20mit\x20Ã¼berwachtem\x20\x27','588836qDopnb','stringify','now','864472jUTJrO','alarm','6EqmWyH','95frIkRg','[DeadMan]\x20Topology\x20check\x20failed:\x20','indexOf','\x20(Multi-Person\x20Filter)','val','setStateAsync','constructor','[DeadMan]\x20','Unknown','toLowerCase','5773474AqHksU'];a2_0x4e35=function(){return _0x427ad0;};return a2_0x4e35();}'use strict';const setup=require(a2_0x40236c(0xe1));let activeTimer=null,currentMonitoredRoom=null,timeoutMs=0x0,startTime=0x0,alarmStage=0x0;const DEFAULT_TIMEOUTS={'bad':0x2d,'bath':0x2d,'toilet':0x1e,'wc':0x1e,'keller':0x3c};async function loadConfig(_0x3258de){const _0x9e34b5=a2_0x40236c;try{const _0x51a962=await _0x3258de[_0x9e34b5(0xdd)]('analysis.safety.deadMan.config');if(_0x51a962&&_0x51a962[_0x9e34b5(0xcc)])return JSON['parse'](_0x51a962[_0x9e34b5(0xcc)]);}catch(_0x38ee0f){}return{};}async function isActive(_0x281649){const _0x2e09e7=a2_0x40236c;try{const _0x5bd9c7=await _0x281649[_0x2e09e7(0xdd)](_0x2e09e7(0xd7));return _0x5bd9c7&&_0x5bd9c7[_0x2e09e7(0xcc)];}catch(_0x29600a){return![];}}async function areRoomsConnected(_0x49891d,_0x1ad588,_0x41c76a){const _0x485ac5=a2_0x40236c;try{const _0x289721=await _0x49891d['getStateAsync'](_0x485ac5(0xd9));if(!_0x289721||!_0x289721[_0x485ac5(0xcc)])return!![];const _0x38d3a2=JSON['parse'](_0x289721[_0x485ac5(0xcc)]),{rooms:_0xc87eb5,matrix:_0x325d77}=_0x38d3a2;if(!_0xc87eb5||!_0x325d77)return!![];const _0x5050a9=_0xc87eb5[_0x485ac5(0xca)](_0x1ad588),_0x5a585e=_0xc87eb5[_0x485ac5(0xca)](_0x41c76a);if(_0x5050a9===-0x1||_0x5a585e===-0x1)return!![];const _0x463751=_0x325d77[_0x5050a9][_0x5a585e]>0x0||_0x325d77[_0x5a585e][_0x5050a9]>0x0;return _0x463751;}catch(_0x3e0c18){return _0x49891d[_0x485ac5(0xe5)][_0x485ac5(0xe6)](_0x485ac5(0xc9)+_0x3e0c18[_0x485ac5(0xd5)]),!![];}}async function updateLocation(_0x3e8963,_0xa01be3){const _0x322d27=a2_0x40236c;if(!_0xa01be3||_0xa01be3===_0x322d27(0xd0))return;if(!await isActive(_0x3e8963)){resetTimer(_0x3e8963);return;}if(currentMonitoredRoom&&currentMonitoredRoom!==_0xa01be3){const _0x50a4d7=await areRoomsConnected(_0x3e8963,currentMonitoredRoom,_0xa01be3);if(!_0x50a4d7){const _0x261bf9='Ignoriere\x20Bewegung\x20in\x20\x27'+_0xa01be3+_0x322d27(0xed)+currentMonitoredRoom+'\x27.';_0x3e8963[_0x322d27(0xe5)][_0x322d27(0xe2)]('[DeadMan]\x20'+_0x261bf9+_0x322d27(0xcb)),await _0x3e8963[_0x322d27(0xcd)]('analysis.safety.deadMan.lastIgnored',{'val':JSON[_0x322d27(0xc3)]({'room':_0xa01be3,'reason':_0x261bf9,'timestamp':Date[_0x322d27(0xc4)]()}),'ack':!![]});return;}resetTimer(_0x3e8963);}if(!currentMonitoredRoom){await _0x3e8963[_0x322d27(0xcd)]('analysis.safety.deadMan.currentRoom',{'val':_0xa01be3,'ack':!![]});const _0x4a202b=await loadConfig(_0x3e8963),_0x484c26=_0xa01be3[_0x322d27(0xd1)]();let _0x571bd2=_0x4a202b[_0xa01be3]||_0x4a202b[_0x484c26];if(!_0x571bd2)for(const _0x3663da in DEFAULT_TIMEOUTS){if(_0x484c26['includes'](_0x3663da)){_0x571bd2=DEFAULT_TIMEOUTS[_0x3663da];break;}}if(!_0x571bd2&&_0x4a202b[_0x322d27(0xe4)])_0x571bd2=_0x4a202b['default'];if(!_0x571bd2)return;currentMonitoredRoom=_0xa01be3,startTimer(_0x3e8963,_0x571bd2);}}function startTimer(_0x24e983,_0x2eb494){const _0x22aec9=a2_0x40236c;if(activeTimer)clearTimeout(activeTimer);timeoutMs=_0x2eb494*0x3c*0x3e8,startTime=Date[_0x22aec9(0xc4)](),alarmStage=0x0,_0x24e983[_0x22aec9(0xe5)][_0x22aec9(0xe2)](_0x22aec9(0xec)+currentMonitoredRoom+_0x22aec9(0xd4)+_0x2eb494+_0x22aec9(0xd3)),_0x24e983[_0x22aec9(0xcd)](_0x22aec9(0xe3),{'val':'ok','ack':!![]}),activeTimer=setTimeout(()=>triggerPreWarn(_0x24e983),timeoutMs);}function resetTimer(_0x547725){const _0x2cf0cf=a2_0x40236c;if(activeTimer)clearTimeout(activeTimer);activeTimer=null,currentMonitoredRoom=null,alarmStage=0x0,_0x547725[_0x2cf0cf(0xcd)](_0x2cf0cf(0xe3),{'val':'ok','ack':!![]});}async function triggerPreWarn(_0x19b8bb){const _0x3cb3a9=a2_0x40236c;alarmStage=0x1,await _0x19b8bb[_0x3cb3a9(0xcd)]('analysis.safety.deadMan.alarmState',{'val':'pre_warn','ack':!![]});const _0x3bf0eb='â³\x20ACHTUNG:\x20UngewÃ¶hnlich\x20lange\x20InaktivitÃ¤t\x20in\x20'+currentMonitoredRoom+'.\x20Alles\x20in\x20Ordnung?';_0x19b8bb[_0x3cb3a9(0xe5)][_0x3cb3a9(0xe6)](_0x3cb3a9(0xcf)+_0x3bf0eb),await setup['sendNotification'](_0x19b8bb,'ðŸ‘¼\x20Schutzengel-Frage:\x20'+_0x3bf0eb),activeTimer=setTimeout(()=>triggerAlarm(_0x19b8bb),0x5*0x3c*0x3e8);}function a2_0xa23c(_0x534c5b,_0x45788b){const _0x80da38=a2_0x4e35();return a2_0xa23c=function(_0xb1f6dd,_0x575e90){_0xb1f6dd=_0xb1f6dd-0xc3;let _0x4e35db=_0x80da38[_0xb1f6dd];return _0x4e35db;},a2_0xa23c(_0x534c5b,_0x45788b);}async function triggerAlarm(_0x16f50a){const _0x112ecb=a2_0x40236c;alarmStage=0x2,await _0x16f50a[_0x112ecb(0xcd)](_0x112ecb(0xe3),{'val':_0x112ecb(0xc6),'ack':!![]});const _0x33e794=_0x112ecb(0xda)+currentMonitoredRoom+'!';_0x16f50a[_0x112ecb(0xe5)][_0x112ecb(0xeb)]('[DeadMan]\x20'+_0x33e794),await setup['sendNotification'](_0x16f50a,_0x33e794,![],!![]);}module[a2_0x40236c(0xd8)]={'updateLocation':updateLocation};