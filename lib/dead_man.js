const a2_0x38b5fc=a2_0x162b;(function(_0x279538,_0x21c97d){const _0x41e785=a2_0x162b,_0xac40d=_0x279538();while(!![]){try{const _0x29de82=-parseInt(_0x41e785(0x1d7))/0x1+parseInt(_0x41e785(0x1d3))/0x2+-parseInt(_0x41e785(0x1c6))/0x3*(parseInt(_0x41e785(0x1e1))/0x4)+-parseInt(_0x41e785(0x1b7))/0x5*(parseInt(_0x41e785(0x1c2))/0x6)+-parseInt(_0x41e785(0x1cf))/0x7+parseInt(_0x41e785(0x1c7))/0x8+-parseInt(_0x41e785(0x1da))/0x9*(-parseInt(_0x41e785(0x1d9))/0xa);if(_0x29de82===_0x21c97d)break;else _0xac40d['push'](_0xac40d['shift']());}catch(_0x3643a1){_0xac40d['push'](_0xac40d['shift']());}}}(a2_0x41e8,0xb3428));const a2_0xb32c0e=(function(){let _0x921e2a=!![];return function(_0x40676b,_0x41b09){const _0x50153a=_0x921e2a?function(){const _0x3c5922=a2_0x162b;if(_0x41b09){const _0x526aff=_0x41b09[_0x3c5922(0x1cd)](_0x40676b,arguments);return _0x41b09=null,_0x526aff;}}:function(){};return _0x921e2a=![],_0x50153a;};}()),a2_0x227d57=a2_0xb32c0e(this,function(){const _0x56daf1=a2_0x162b;return a2_0x227d57[_0x56daf1(0x1c5)]()['search']('(((.+)+)+)+$')[_0x56daf1(0x1c5)]()['constructor'](a2_0x227d57)[_0x56daf1(0x1d8)](_0x56daf1(0x1dc));});a2_0x227d57();'use strict';const setup=require(a2_0x38b5fc(0x1c3));let activeTimer=null,currentMonitoredRoom=null,timeoutMs=0x0,startTime=0x0,alarmStage=0x0;const DEFAULT_TIMEOUTS={'bad':0x2d,'bath':0x2d,'toilet':0x1e,'wc':0x1e,'keller':0x3c};async function loadConfig(_0x3b0beb){const _0x58a607=a2_0x38b5fc;try{const _0x267e24=await _0x3b0beb['getStateAsync'](_0x58a607(0x1bb));if(_0x267e24&&_0x267e24[_0x58a607(0x1c8)])return JSON[_0x58a607(0x1dd)](_0x267e24[_0x58a607(0x1c8)]);}catch(_0x5c94fd){}return{};}async function isActive(_0x59a8d9){const _0x455296=a2_0x38b5fc;try{const _0x4318a5=await _0x59a8d9[_0x455296(0x1d2)](_0x455296(0x1ca));return _0x4318a5&&_0x4318a5['val'];}catch(_0x247081){return![];}}function a2_0x41e8(){const _0xbf4f48=['search','26230370UDEtRE','9RsHlBy','ðŸ‘¼\x20Schutzengel-Frage:\x20','(((.+)+)+)+$','parse','default','Unknown','warn','148GeLwVa','message','\x20fÃ¼r\x20','Ignoriere\x20Bewegung\x20in\x20\x27','analysis.topology.structure','stringify','330oeNnev','analysis.safety.deadMan.alarmState','includes','info','analysis.safety.deadMan.config','\x27.\x20Nicht\x20verbunden\x20mit\x20Ã¼berwachtem\x20\x27','\x20Min.','setStateAsync','analysis.safety.deadMan.lastIgnored','indexOf','log','122016rFixRj','./setup','.\x20Alles\x20in\x20Ordnung?','toString','65739bGSiAE','5117336mZgRMK','val','sendNotification','analysis.safety.deadMan.active','error','pre_warn','apply','analysis.safety.deadMan.currentRoom','6758703uiqXQz','ðŸ‘¼\x20Schutzengel:\x20Ãœberwache\x20','alarm','getStateAsync','1594674JKoXje','[DeadMan]\x20','now','exports','207307MLvUyj'];a2_0x41e8=function(){return _0xbf4f48;};return a2_0x41e8();}async function areRoomsConnected(_0x4f569a,_0x4613c7,_0x45f25c){const _0xdea2d9=a2_0x38b5fc;try{const _0x234e89=await _0x4f569a['getStateAsync'](_0xdea2d9(0x1b5));if(!_0x234e89||!_0x234e89[_0xdea2d9(0x1c8)])return!![];const _0x45c21f=JSON['parse'](_0x234e89[_0xdea2d9(0x1c8)]),{rooms:_0xeb8f44,matrix:_0x4a95ec}=_0x45c21f;if(!_0xeb8f44||!_0x4a95ec)return!![];const _0x16fed5=_0xeb8f44[_0xdea2d9(0x1c0)](_0x4613c7),_0x236abf=_0xeb8f44['indexOf'](_0x45f25c);if(_0x16fed5===-0x1||_0x236abf===-0x1)return!![];const _0x25f1ff=_0x4a95ec[_0x16fed5][_0x236abf]>0x0||_0x4a95ec[_0x236abf][_0x16fed5]>0x0;return _0x25f1ff;}catch(_0x530ae1){return _0x4f569a[_0xdea2d9(0x1c1)]['warn']('[DeadMan]\x20Topology\x20check\x20failed:\x20'+_0x530ae1[_0xdea2d9(0x1e2)]),!![];}}function a2_0x162b(_0x4e3ec4,_0x579acf){const _0x137f07=a2_0x41e8();return a2_0x162b=function(_0x227d57,_0xb32c0e){_0x227d57=_0x227d57-0x1b4;let _0x41e8fa=_0x137f07[_0x227d57];return _0x41e8fa;},a2_0x162b(_0x4e3ec4,_0x579acf);}async function updateLocation(_0x55391f,_0x6babd1){const _0x24f90b=a2_0x38b5fc;if(!_0x6babd1||_0x6babd1===_0x24f90b(0x1df))return;if(!await isActive(_0x55391f)){resetTimer(_0x55391f);return;}if(currentMonitoredRoom&&currentMonitoredRoom!==_0x6babd1){const _0xefd455=await areRoomsConnected(_0x55391f,currentMonitoredRoom,_0x6babd1);if(!_0xefd455){const _0x25ed76=_0x24f90b(0x1b4)+_0x6babd1+_0x24f90b(0x1bc)+currentMonitoredRoom+'\x27.';_0x55391f[_0x24f90b(0x1c1)][_0x24f90b(0x1ba)]('[DeadMan]\x20'+_0x25ed76+'\x20(Multi-Person\x20Filter)'),await _0x55391f['setStateAsync'](_0x24f90b(0x1bf),{'val':JSON[_0x24f90b(0x1b6)]({'room':_0x6babd1,'reason':_0x25ed76,'timestamp':Date[_0x24f90b(0x1d5)]()}),'ack':!![]});return;}resetTimer(_0x55391f);}if(!currentMonitoredRoom){await _0x55391f['setStateAsync'](_0x24f90b(0x1ce),{'val':_0x6babd1,'ack':!![]});const _0x4b019c=await loadConfig(_0x55391f),_0x3c7f9d=_0x6babd1['toLowerCase']();let _0x364918=_0x4b019c[_0x6babd1]||_0x4b019c[_0x3c7f9d];if(!_0x364918)for(const _0x376ec4 in DEFAULT_TIMEOUTS){if(_0x3c7f9d[_0x24f90b(0x1b9)](_0x376ec4)){_0x364918=DEFAULT_TIMEOUTS[_0x376ec4];break;}}if(!_0x364918&&_0x4b019c[_0x24f90b(0x1de)])_0x364918=_0x4b019c['default'];if(!_0x364918)return;currentMonitoredRoom=_0x6babd1,startTimer(_0x55391f,_0x364918);}}function startTimer(_0x31cf35,_0x4da85b){const _0x206bc8=a2_0x38b5fc;if(activeTimer)clearTimeout(activeTimer);timeoutMs=_0x4da85b*0x3c*0x3e8,startTime=Date['now'](),alarmStage=0x0,_0x31cf35[_0x206bc8(0x1c1)]['info'](_0x206bc8(0x1d0)+currentMonitoredRoom+_0x206bc8(0x1e3)+_0x4da85b+_0x206bc8(0x1bd)),_0x31cf35[_0x206bc8(0x1be)]('analysis.safety.deadMan.alarmState',{'val':'ok','ack':!![]}),activeTimer=setTimeout(()=>triggerPreWarn(_0x31cf35),timeoutMs);}function resetTimer(_0x54b6e5){const _0x45f385=a2_0x38b5fc;if(activeTimer)clearTimeout(activeTimer);activeTimer=null,currentMonitoredRoom=null,alarmStage=0x0,_0x54b6e5[_0x45f385(0x1be)](_0x45f385(0x1b8),{'val':'ok','ack':!![]});}async function triggerPreWarn(_0x1f3f64){const _0x448d5e=a2_0x38b5fc;alarmStage=0x1,await _0x1f3f64[_0x448d5e(0x1be)](_0x448d5e(0x1b8),{'val':_0x448d5e(0x1cc),'ack':!![]});const _0x4d84df='â³\x20ACHTUNG:\x20UngewÃ¶hnlich\x20lange\x20InaktivitÃ¤t\x20in\x20'+currentMonitoredRoom+_0x448d5e(0x1c4);_0x1f3f64['log'][_0x448d5e(0x1e0)](_0x448d5e(0x1d4)+_0x4d84df),await setup[_0x448d5e(0x1c9)](_0x1f3f64,_0x448d5e(0x1db)+_0x4d84df),activeTimer=setTimeout(()=>triggerAlarm(_0x1f3f64),0x5*0x3c*0x3e8);}async function triggerAlarm(_0xa20c95){const _0x171c22=a2_0x38b5fc;alarmStage=0x2,await _0xa20c95[_0x171c22(0x1be)](_0x171c22(0x1b8),{'val':_0x171c22(0x1d1),'ack':!![]});const _0x27d1ef='ðŸš¨\x20NOTFALL-ALARM:\x20Person\x20reagiert\x20nicht\x20in\x20'+currentMonitoredRoom+'!';_0xa20c95['log'][_0x171c22(0x1cb)](_0x171c22(0x1d4)+_0x27d1ef),await setup[_0x171c22(0x1c9)](_0xa20c95,_0x27d1ef,![],!![]);}module[a2_0x38b5fc(0x1d6)]={'updateLocation':updateLocation};