const a2_0x4e96ba=a2_0x46ed;(function(_0x578350,_0x109c75){const _0x5a1ffd=a2_0x46ed,_0x385546=_0x578350();while(!![]){try{const _0x1aeddb=parseInt(_0x5a1ffd(0x1e1))/0x1*(parseInt(_0x5a1ffd(0x1dd))/0x2)+-parseInt(_0x5a1ffd(0x1d6))/0x3+-parseInt(_0x5a1ffd(0x1de))/0x4+-parseInt(_0x5a1ffd(0x1d3))/0x5+-parseInt(_0x5a1ffd(0x1e6))/0x6*(-parseInt(_0x5a1ffd(0x1cf))/0x7)+parseInt(_0x5a1ffd(0x1f2))/0x8+parseInt(_0x5a1ffd(0x1dc))/0x9*(-parseInt(_0x5a1ffd(0x1e0))/0xa);if(_0x1aeddb===_0x109c75)break;else _0x385546['push'](_0x385546['shift']());}catch(_0x5bb111){_0x385546['push'](_0x385546['shift']());}}}(a2_0x434d,0x88063));const a2_0xdf98a7=(function(){let _0x3d49ee=!![];return function(_0x51876c,_0x1e9267){const _0x468aaa=_0x3d49ee?function(){const _0x376e06=a2_0x46ed;if(_0x1e9267){const _0x5baf3f=_0x1e9267[_0x376e06(0x1b8)](_0x51876c,arguments);return _0x1e9267=null,_0x5baf3f;}}:function(){};return _0x3d49ee=![],_0x468aaa;};}()),a2_0x1ccea9=a2_0xdf98a7(this,function(){const _0x1c694e=a2_0x46ed;return a2_0x1ccea9[_0x1c694e(0x1d0)]()[_0x1c694e(0x1e8)](_0x1c694e(0x1da))[_0x1c694e(0x1d0)]()[_0x1c694e(0x1e4)](a2_0x1ccea9)[_0x1c694e(0x1e8)](_0x1c694e(0x1da));});a2_0x1ccea9();'use strict';function a2_0x46ed(_0x2b16f5,_0x518e74){const _0x44bbef=a2_0x434d();return a2_0x46ed=function(_0x1ccea9,_0xdf98a7){_0x1ccea9=_0x1ccea9-0x1b8;let _0x434d57=_0x44bbef[_0x1ccea9];return _0x434d57;},a2_0x46ed(_0x2b16f5,_0x518e74);}const setup=require('./setup');let activeTimer=null,currentMonitoredRoom=null,timeoutMs=0x0,startTime=0x0,alarmStage=0x0;const DEFAULT_TIMEOUTS={'bad':0x2d,'bath':0x2d,'toilet':0x1e,'wc':0x1e,'keller':0x3c,'schlaf':0x78,'bed':0x78,'guest':0x5a,'gast':0x5a};function a2_0x434d(){const _0x11451f=['analysis.safety.deadMan.currentRoom','ðŸ‘¼\x20Schutzengel-Frage:\x20','ðŸ’¤\x20Smart\x20Sleep\x20erkannt\x20(','[DeadMan]\x20Topology\x20check\x20failed:\x20','Ignoriere\x20Bewegung\x20in\x20\x27','analysis.safety.deadMan.config','pre_warn','log','setStateAsync','analysis.safety.deadMan.lastIgnored','info','\x27.\x20Nicht\x20verbunden\x20mit\x20Ã¼berwachtem\x20\x27','val','sofa','toFixed','parse','Unknown','119PiYkId','toString','exports','ðŸš¨\x20NOTFALL-ALARM:\x20Person\x20reagiert\x20nicht\x20in\x20','5364030YBtdeL','replace','bed','965490vxcMsq','stringify','indexOf','ðŸ‘¼\x20Schutzengel:\x20Ãœberwache\x20','(((.+)+)+)+$','schlaf','576GOnFcG','1712786KMIWxV','417832NATqwS','default','7660MjBOiN','1oWVPIz','\x20um\x2090\x20Min.','analysis.safety.deadMan.alarmState','constructor','warn','372306JtnmKZ','wohn','search','%).\x20VerlÃ¤ngere\x20Timer\x20fÃ¼r\x20','error','getStateAsync','analysis.safety.deadMan.napProbability','sendNotification','[DeadMan]\x20','\x20Min.','analysis.safety.deadMan.smartSleep','bad','1552104vkKzJf','\x20fÃ¼r\x20','apply','message','now','includes','â³\x20ACHTUNG:\x20UngewÃ¶hnlich\x20lange\x20InaktivitÃ¤t\x20in\x20','toLowerCase'];a2_0x434d=function(){return _0x11451f;};return a2_0x434d();}function getTimeoutRobust(_0x22566a,_0xeb599f){const _0x229bba=a2_0x46ed;if(!_0x22566a||!_0xeb599f)return undefined;if(_0x22566a[_0xeb599f])return _0x22566a[_0xeb599f];const _0x3c66d4=_0xeb599f[_0x229bba(0x1bd)]()[_0x229bba(0x1d4)](/[^a-z0-9]/g,'');for(const _0x42dbd6 in _0x22566a){const _0x1c0add=_0x42dbd6[_0x229bba(0x1bd)]()[_0x229bba(0x1d4)](/[^a-z0-9]/g,'');if(_0x1c0add===_0x3c66d4)return _0x22566a[_0x42dbd6];}const _0x2b686b=_0xeb599f[_0x229bba(0x1bd)]();if(_0x22566a[_0x2b686b])return _0x22566a[_0x2b686b];return undefined;}async function loadConfig(_0x403298){const _0x2ba2bd=a2_0x46ed;try{const _0x58cc85=await _0x403298[_0x2ba2bd(0x1eb)](_0x2ba2bd(0x1c3));if(_0x58cc85&&_0x58cc85[_0x2ba2bd(0x1ca)])return JSON[_0x2ba2bd(0x1cd)](_0x58cc85['val']);}catch(_0x1f1e9f){}return{};}async function isActive(_0x585d4e){const _0x514abf=a2_0x46ed;try{const _0x395154=await _0x585d4e[_0x514abf(0x1eb)]('analysis.safety.deadMan.active');return _0x395154&&_0x395154[_0x514abf(0x1ca)];}catch(_0x1bc8c8){return![];}}async function areRoomsConnected(_0xa62cb5,_0x5d81df,_0x5c35e7){const _0x27da16=a2_0x46ed;try{const _0x18a7d0=await _0xa62cb5[_0x27da16(0x1eb)]('analysis.topology.structure');if(!_0x18a7d0||!_0x18a7d0[_0x27da16(0x1ca)])return!![];const _0x5cc5bc=JSON['parse'](_0x18a7d0['val']),{rooms:_0x189ab6,matrix:_0x4b5cc2}=_0x5cc5bc;if(!_0x189ab6||!_0x4b5cc2)return!![];const _0x301b7c=_0x189ab6[_0x27da16(0x1d8)](_0x5d81df),_0x4157ec=_0x189ab6[_0x27da16(0x1d8)](_0x5c35e7);if(_0x301b7c===-0x1||_0x4157ec===-0x1)return!![];const _0x489b69=_0x4b5cc2[_0x301b7c][_0x4157ec]>0x0||_0x4b5cc2[_0x4157ec][_0x301b7c]>0x0;return _0x489b69;}catch(_0x4cab93){return _0xa62cb5[_0x27da16(0x1c5)][_0x27da16(0x1e5)](_0x27da16(0x1c1)+_0x4cab93[_0x27da16(0x1b9)]),!![];}}function calculateSleepProbability(_0x42e506){const _0x5d7b81=a2_0x46ed,_0x481383=new Date(),_0x2e7bec=_0x481383['getHours'](),_0x2cd151=_0x42e506[_0x5d7b81(0x1bd)]();let _0x5ccc97=0.1;if(_0x2e7bec>=0x17||_0x2e7bec<=0x6)_0x5ccc97=0x1;else{if(_0x2e7bec>=0xd&&_0x2e7bec<=0xf)_0x5ccc97=0.8;else{if(_0x2e7bec>=0x14&&_0x2e7bec<=0x17)_0x5ccc97=0.4;}}let _0xb1a9c9=0.1;if(_0x2cd151[_0x5d7b81(0x1bb)](_0x5d7b81(0x1db))||_0x2cd151['includes'](_0x5d7b81(0x1d5)))_0xb1a9c9=0x1;else{if(_0x2cd151['includes'](_0x5d7b81(0x1e7))||_0x2cd151['includes']('living')||_0x2cd151[_0x5d7b81(0x1bb)](_0x5d7b81(0x1cb)))_0xb1a9c9=0.6;else{if(_0x2cd151[_0x5d7b81(0x1bb)](_0x5d7b81(0x1f1))||_0x2cd151[_0x5d7b81(0x1bb)]('wc'))_0xb1a9c9=0.05;}}let _0x243d38=0.5;const _0x20ecc2=_0xb1a9c9*0.5+_0x5ccc97*0.3+_0x243d38*0.2;return parseFloat(_0x20ecc2[_0x5d7b81(0x1cc)](0x2));}async function updateLocation(_0x4aa5d6,_0xe0dad1){const _0x52f0ae=a2_0x46ed;if(!_0xe0dad1||_0xe0dad1===_0x52f0ae(0x1ce))return;if(!await isActive(_0x4aa5d6)){resetTimer(_0x4aa5d6);return;}if(currentMonitoredRoom&&currentMonitoredRoom!==_0xe0dad1){const _0x5b3edf=await areRoomsConnected(_0x4aa5d6,currentMonitoredRoom,_0xe0dad1);if(!_0x5b3edf){const _0xbfc611=_0x52f0ae(0x1c2)+_0xe0dad1+_0x52f0ae(0x1c9)+currentMonitoredRoom+'\x27.';_0x4aa5d6[_0x52f0ae(0x1c5)][_0x52f0ae(0x1c8)](_0x52f0ae(0x1ee)+_0xbfc611+'\x20(Multi-Person\x20Filter)'),await _0x4aa5d6[_0x52f0ae(0x1c6)](_0x52f0ae(0x1c7),{'val':JSON[_0x52f0ae(0x1d7)]({'room':_0xe0dad1,'reason':_0xbfc611,'timestamp':Date[_0x52f0ae(0x1ba)]()}),'ack':!![]});return;}resetTimer(_0x4aa5d6);}if(!currentMonitoredRoom){await _0x4aa5d6['setStateAsync'](_0x52f0ae(0x1be),{'val':_0xe0dad1,'ack':!![]});const _0x52c6fa=await loadConfig(_0x4aa5d6);let _0x56c492=getTimeoutRobust(_0x52c6fa,_0xe0dad1);const _0x230536=_0xe0dad1[_0x52f0ae(0x1bd)]();if(!_0x56c492)for(const _0x5f47ec in DEFAULT_TIMEOUTS){if(_0x230536[_0x52f0ae(0x1bb)](_0x5f47ec)){_0x56c492=DEFAULT_TIMEOUTS[_0x5f47ec];break;}}if(!_0x56c492&&_0x52c6fa['default'])_0x56c492=_0x52c6fa[_0x52f0ae(0x1df)];if(!_0x56c492)return;currentMonitoredRoom=_0xe0dad1,startTimer(_0x4aa5d6,_0x56c492,_0xe0dad1);}}function startTimer(_0x49f047,_0x405ab9,_0x3dd7a5){const _0x174ed4=a2_0x46ed;if(activeTimer)clearTimeout(activeTimer);timeoutMs=_0x405ab9*0x3c*0x3e8,startTime=Date[_0x174ed4(0x1ba)](),alarmStage=0x0;const _0x363b2a=calculateSleepProbability(_0x3dd7a5||currentMonitoredRoom),_0x50d68c=_0x363b2a>0.65;_0x50d68c?(timeoutMs+=0x5a*0x3c*0x3e8,_0x49f047[_0x174ed4(0x1c5)][_0x174ed4(0x1c8)](_0x174ed4(0x1c0)+(_0x363b2a*0x64)[_0x174ed4(0x1cc)](0x0)+_0x174ed4(0x1e9)+currentMonitoredRoom+_0x174ed4(0x1e2)),_0x49f047[_0x174ed4(0x1c6)](_0x174ed4(0x1f0),{'val':!![],'ack':!![]})):_0x49f047['setStateAsync'](_0x174ed4(0x1f0),{'val':![],'ack':!![]}),_0x49f047[_0x174ed4(0x1c6)](_0x174ed4(0x1ec),{'val':_0x363b2a,'ack':!![]}),_0x49f047[_0x174ed4(0x1c5)][_0x174ed4(0x1c8)](_0x174ed4(0x1d9)+currentMonitoredRoom+_0x174ed4(0x1f3)+_0x405ab9+_0x174ed4(0x1ef)),_0x49f047[_0x174ed4(0x1c6)](_0x174ed4(0x1e3),{'val':'ok','ack':!![]}),activeTimer=setTimeout(()=>triggerPreWarn(_0x49f047),timeoutMs);}function resetTimer(_0x197f58){const _0x16007c=a2_0x46ed;if(activeTimer)clearTimeout(activeTimer);activeTimer=null,currentMonitoredRoom=null,alarmStage=0x0,_0x197f58['setStateAsync'](_0x16007c(0x1e3),{'val':'ok','ack':!![]}),_0x197f58[_0x16007c(0x1c6)]('analysis.safety.deadMan.smartSleep',{'val':![],'ack':!![]}),_0x197f58['setStateAsync'](_0x16007c(0x1ec),{'val':0x0,'ack':!![]});}async function triggerPreWarn(_0x30e1c7){const _0x2868ba=a2_0x46ed;alarmStage=0x1,await _0x30e1c7[_0x2868ba(0x1c6)](_0x2868ba(0x1e3),{'val':_0x2868ba(0x1c4),'ack':!![]});const _0x1d4629=_0x2868ba(0x1bc)+currentMonitoredRoom+'.\x20Alles\x20in\x20Ordnung?';_0x30e1c7[_0x2868ba(0x1c5)]['warn'](_0x2868ba(0x1ee)+_0x1d4629),await setup[_0x2868ba(0x1ed)](_0x30e1c7,_0x2868ba(0x1bf)+_0x1d4629),activeTimer=setTimeout(()=>triggerAlarm(_0x30e1c7),0x5*0x3c*0x3e8);}async function triggerAlarm(_0x33a000){const _0x3fc126=a2_0x46ed;alarmStage=0x2,await _0x33a000[_0x3fc126(0x1c6)](_0x3fc126(0x1e3),{'val':'alarm','ack':!![]});const _0x259f45=_0x3fc126(0x1d2)+currentMonitoredRoom+'!';_0x33a000['log'][_0x3fc126(0x1ea)](_0x3fc126(0x1ee)+_0x259f45),await setup[_0x3fc126(0x1ed)](_0x33a000,_0x259f45,![],!![]);}module[a2_0x4e96ba(0x1d1)]={'updateLocation':updateLocation};