const a2_0x2c1b04=a2_0x315f;(function(_0x7eaa8d,_0x2dbc68){const _0x2015c7=a2_0x315f,_0x3a56e3=_0x7eaa8d();while(!![]){try{const _0x45fafe=parseInt(_0x2015c7(0x8f))/0x1+parseInt(_0x2015c7(0x9c))/0x2+parseInt(_0x2015c7(0x88))/0x3+parseInt(_0x2015c7(0x87))/0x4+-parseInt(_0x2015c7(0x7c))/0x5+-parseInt(_0x2015c7(0x66))/0x6+-parseInt(_0x2015c7(0x79))/0x7;if(_0x45fafe===_0x2dbc68)break;else _0x3a56e3['push'](_0x3a56e3['shift']());}catch(_0x1147b1){_0x3a56e3['push'](_0x3a56e3['shift']());}}}(a2_0x2ba9,0xc8fe7));const a2_0x248feb=(function(){let _0x284b6a=!![];return function(_0x58c05a,_0x27b1ce){const _0xa37db6=_0x284b6a?function(){const _0x7b3abf=a2_0x315f;if(_0x27b1ce){const _0x49b38b=_0x27b1ce[_0x7b3abf(0x97)](_0x58c05a,arguments);return _0x27b1ce=null,_0x49b38b;}}:function(){};return _0x284b6a=![],_0xa37db6;};}()),a2_0x24f3a5=a2_0x248feb(this,function(){const _0x2e487c=a2_0x315f;return a2_0x24f3a5[_0x2e487c(0x6c)]()[_0x2e487c(0x7f)]('(((.+)+)+)+$')['toString']()['constructor'](a2_0x24f3a5)[_0x2e487c(0x7f)]('(((.+)+)+)+$');});function a2_0x315f(_0x5f32fc,_0x5494a2){const _0x34341f=a2_0x2ba9();return a2_0x315f=function(_0x24f3a5,_0x248feb){_0x24f3a5=_0x24f3a5-0x66;let _0x2ba901=_0x34341f[_0x24f3a5];return _0x2ba901;},a2_0x315f(_0x5f32fc,_0x5494a2);}a2_0x24f3a5();'use strict';const setup=require(a2_0x2c1b04(0x7b));let activeTimer=null,currentMonitoredRoom=null,timeoutMs=0x0,startTime=0x0,alarmStage=0x0;const DEFAULT_TIMEOUTS={'bad':0x2d,'bath':0x2d,'toilet':0x1e,'wc':0x1e,'keller':0x3c,'schlaf':0x78,'bed':0x78,'guest':0x5a,'gast':0x5a};function getTimeoutRobust(_0x131e98,_0x3be471){const _0x5ea9c6=a2_0x2c1b04;if(!_0x131e98||!_0x3be471)return undefined;if(_0x131e98[_0x3be471])return _0x131e98[_0x3be471];const _0xcf12dd=_0x3be471[_0x5ea9c6(0x75)]()[_0x5ea9c6(0x91)](/[^a-z0-9]/g,'');for(const _0x561f1f in _0x131e98){const _0x1d65c6=_0x561f1f[_0x5ea9c6(0x75)]()[_0x5ea9c6(0x91)](/[^a-z0-9]/g,'');if(_0x1d65c6===_0xcf12dd)return _0x131e98[_0x561f1f];}const _0x151c11=_0x3be471['toLowerCase']();if(_0x131e98[_0x151c11])return _0x131e98[_0x151c11];return undefined;}function a2_0x2ba9(){const _0x201e66=['analysis.safety.deadMan.lastIgnored','\x20um\x2090\x20Min.','1626112wAvFTj','2633871wGSiYg','\x27.\x20Nicht\x20verbunden\x20mit\x20Ã¼berwachtem\x20\x27','warn','analysis.safety.deadMan.napProbability','bad','\x20Min.','ðŸ‘¼\x20Schutzengel-Frage:\x20','538049WJcrNx','default','replace','[DeadMan]\x20','analysis.topology.structure','schlaf','Ignoriere\x20Bewegung\x20in\x20\x27','analysis.safety.deadMan.config','apply','ðŸ‘¼\x20Schutzengel:\x20Ãœberwache\x20','val','\x20fÃ¼r\x20','info','2467878GtPblV','parse','4874256yMnOOV','getHours','analysis.safety.deadMan.currentRoom','log','Unknown','bed','toString','sofa','living','includes','stringify','indexOf','sendNotification','ðŸš¨\x20NOTFALL-ALARM:\x20Person\x20reagiert\x20nicht\x20in\x20','wohn','toLowerCase','getStateAsync','ðŸ’¤\x20Smart\x20Sleep\x20erkannt\x20(','analysis.safety.deadMan.smartSleep','9574929PodFfE','now','./setup','264895nHBkGQ','exports','pre_warn','search','error','toFixed','[DeadMan]\x20Topology\x20check\x20failed:\x20','setStateAsync','analysis.safety.deadMan.alarmState'];a2_0x2ba9=function(){return _0x201e66;};return a2_0x2ba9();}async function loadConfig(_0xc95c13){const _0xc8d0e8=a2_0x2c1b04;try{const _0x5d6f22=await _0xc95c13[_0xc8d0e8(0x76)](_0xc8d0e8(0x96));if(_0x5d6f22&&_0x5d6f22['val'])return JSON[_0xc8d0e8(0x9d)](_0x5d6f22['val']);}catch(_0x524c61){}return{};}async function isActive(_0x36439b){const _0x82d31e=a2_0x2c1b04;try{const _0x130a53=await _0x36439b[_0x82d31e(0x76)]('analysis.safety.deadMan.active');return _0x130a53&&_0x130a53[_0x82d31e(0x99)];}catch(_0x21b03f){return![];}}async function areRoomsConnected(_0x1e469c,_0xc43b4,_0x1f4c8f){const _0x2b77d3=a2_0x2c1b04;try{const _0x225d52=await _0x1e469c[_0x2b77d3(0x76)](_0x2b77d3(0x93));if(!_0x225d52||!_0x225d52[_0x2b77d3(0x99)])return!![];const _0x378deb=JSON[_0x2b77d3(0x9d)](_0x225d52['val']),{rooms:_0x1d0b82,matrix:_0x28028b}=_0x378deb;if(!_0x1d0b82||!_0x28028b)return!![];const _0x3c6fbd=_0x1d0b82['indexOf'](_0xc43b4),_0x329059=_0x1d0b82[_0x2b77d3(0x71)](_0x1f4c8f);if(_0x3c6fbd===-0x1||_0x329059===-0x1)return!![];const _0x985951=_0x28028b[_0x3c6fbd][_0x329059]>0x0||_0x28028b[_0x329059][_0x3c6fbd]>0x0;return _0x985951;}catch(_0x5611a3){return _0x1e469c[_0x2b77d3(0x69)][_0x2b77d3(0x8a)](_0x2b77d3(0x82)+_0x5611a3['message']),!![];}}function calculateSleepProbability(_0x8c2ab1){const _0x21bfc7=a2_0x2c1b04,_0xd33199=new Date(),_0x35017a=_0xd33199[_0x21bfc7(0x67)](),_0x1b7da1=_0x8c2ab1['toLowerCase']();let _0x3c11fb=0.1;if(_0x35017a>=0x17||_0x35017a<=0x6)_0x3c11fb=0x1;else{if(_0x35017a>=0xd&&_0x35017a<=0xf)_0x3c11fb=0.8;else{if(_0x35017a>=0x14&&_0x35017a<=0x17)_0x3c11fb=0.4;}}let _0x27dbab=0.1;if(_0x1b7da1['includes'](_0x21bfc7(0x94))||_0x1b7da1[_0x21bfc7(0x6f)](_0x21bfc7(0x6b)))_0x27dbab=0x1;else{if(_0x1b7da1['includes'](_0x21bfc7(0x74))||_0x1b7da1[_0x21bfc7(0x6f)](_0x21bfc7(0x6e))||_0x1b7da1[_0x21bfc7(0x6f)](_0x21bfc7(0x6d)))_0x27dbab=0.6;else{if(_0x1b7da1['includes'](_0x21bfc7(0x8c))||_0x1b7da1[_0x21bfc7(0x6f)]('wc'))_0x27dbab=0.05;}}let _0x3ac060=0.5;const _0x26bcd3=_0x27dbab*0.5+_0x3c11fb*0.3+_0x3ac060*0.2;return parseFloat(_0x26bcd3['toFixed'](0x2));}async function updateLocation(_0x3a61ba,_0x45d94d){const _0x170629=a2_0x2c1b04;if(!_0x45d94d||_0x45d94d===_0x170629(0x6a))return;if(!await isActive(_0x3a61ba)){resetTimer(_0x3a61ba);return;}if(currentMonitoredRoom&&currentMonitoredRoom!==_0x45d94d){const _0x225f10=await areRoomsConnected(_0x3a61ba,currentMonitoredRoom,_0x45d94d);if(!_0x225f10){const _0xd5086d=_0x170629(0x95)+_0x45d94d+_0x170629(0x89)+currentMonitoredRoom+'\x27.';_0x3a61ba['log']['info'](_0x170629(0x92)+_0xd5086d+'\x20(Multi-Person\x20Filter)'),await _0x3a61ba[_0x170629(0x83)](_0x170629(0x85),{'val':JSON[_0x170629(0x70)]({'room':_0x45d94d,'reason':_0xd5086d,'timestamp':Date['now']()}),'ack':!![]});return;}resetTimer(_0x3a61ba);}if(!currentMonitoredRoom){await _0x3a61ba[_0x170629(0x83)](_0x170629(0x68),{'val':_0x45d94d,'ack':!![]});const _0x923525=await loadConfig(_0x3a61ba);let _0x1873df=getTimeoutRobust(_0x923525,_0x45d94d);const _0x170e1a=_0x45d94d[_0x170629(0x75)]();if(!_0x1873df)for(const _0x8c8d57 in DEFAULT_TIMEOUTS){if(_0x170e1a[_0x170629(0x6f)](_0x8c8d57)){_0x1873df=DEFAULT_TIMEOUTS[_0x8c8d57];break;}}if(!_0x1873df&&_0x923525[_0x170629(0x90)])_0x1873df=_0x923525[_0x170629(0x90)];if(!_0x1873df)return;currentMonitoredRoom=_0x45d94d,startTimer(_0x3a61ba,_0x1873df,_0x45d94d);}}function startTimer(_0x17ad82,_0x1a549d,_0x3bcfec){const _0x57d45c=a2_0x2c1b04;if(activeTimer)clearTimeout(activeTimer);timeoutMs=_0x1a549d*0x3c*0x3e8,startTime=Date[_0x57d45c(0x7a)](),alarmStage=0x0;const _0x534e3b=calculateSleepProbability(_0x3bcfec||currentMonitoredRoom),_0x446d3f=_0x534e3b>0.65;_0x446d3f?(timeoutMs+=0x5a*0x3c*0x3e8,_0x17ad82['log']['info'](_0x57d45c(0x77)+(_0x534e3b*0x64)[_0x57d45c(0x81)](0x0)+'%).\x20VerlÃ¤ngere\x20Timer\x20fÃ¼r\x20'+currentMonitoredRoom+_0x57d45c(0x86)),_0x17ad82[_0x57d45c(0x83)](_0x57d45c(0x78),{'val':!![],'ack':!![]})):_0x17ad82[_0x57d45c(0x83)](_0x57d45c(0x78),{'val':![],'ack':!![]}),_0x17ad82[_0x57d45c(0x83)](_0x57d45c(0x8b),{'val':_0x534e3b,'ack':!![]}),_0x17ad82[_0x57d45c(0x69)][_0x57d45c(0x9b)](_0x57d45c(0x98)+currentMonitoredRoom+_0x57d45c(0x9a)+_0x1a549d+_0x57d45c(0x8d)),_0x17ad82[_0x57d45c(0x83)]('analysis.safety.deadMan.alarmState',{'val':'ok','ack':!![]}),activeTimer=setTimeout(()=>triggerPreWarn(_0x17ad82),timeoutMs);}function resetTimer(_0x2955cc){const _0x236224=a2_0x2c1b04;if(activeTimer)clearTimeout(activeTimer);activeTimer=null,currentMonitoredRoom=null,alarmStage=0x0,_0x2955cc[_0x236224(0x83)](_0x236224(0x84),{'val':'ok','ack':!![]}),_0x2955cc['setStateAsync']('analysis.safety.deadMan.smartSleep',{'val':![],'ack':!![]}),_0x2955cc['setStateAsync'](_0x236224(0x8b),{'val':0x0,'ack':!![]});}async function triggerPreWarn(_0x14f8c3){const _0x23ed3d=a2_0x2c1b04;alarmStage=0x1,await _0x14f8c3[_0x23ed3d(0x83)]('analysis.safety.deadMan.alarmState',{'val':_0x23ed3d(0x7e),'ack':!![]});const _0x589a20='â³\x20ACHTUNG:\x20UngewÃ¶hnlich\x20lange\x20InaktivitÃ¤t\x20in\x20'+currentMonitoredRoom+'.\x20Alles\x20in\x20Ordnung?';_0x14f8c3[_0x23ed3d(0x69)][_0x23ed3d(0x8a)]('[DeadMan]\x20'+_0x589a20),await setup[_0x23ed3d(0x72)](_0x14f8c3,_0x23ed3d(0x8e)+_0x589a20),activeTimer=setTimeout(()=>triggerAlarm(_0x14f8c3),0x5*0x3c*0x3e8);}async function triggerAlarm(_0x130257){const _0x16d23a=a2_0x2c1b04;alarmStage=0x2,await _0x130257[_0x16d23a(0x83)](_0x16d23a(0x84),{'val':'alarm','ack':!![]});const _0x11f7d9=_0x16d23a(0x73)+currentMonitoredRoom+'!';_0x130257[_0x16d23a(0x69)][_0x16d23a(0x80)]('[DeadMan]\x20'+_0x11f7d9),await setup[_0x16d23a(0x72)](_0x130257,_0x11f7d9,![],!![]);}module[a2_0x2c1b04(0x7d)]={'updateLocation':updateLocation};