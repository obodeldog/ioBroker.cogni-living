function a2_0x1318(){const _0x2099d0=['12tQqTpd','25082068srzvYZ','analysis.safety.deadMan.alarmState','\x20um\x2090\x20Min.','\x20(Multi-Person\x20Filter)','ðŸš¨\x20NOTFALL-ALARM:\x20Person\x20reagiert\x20nicht\x20in\x20','\x20Min.','analysis.safety.deadMan.currentRoom','analysis.safety.deadMan.lastIgnored','getStateAsync','%).\x20VerlÃ¤ngere\x20Timer\x20fÃ¼r\x20','analysis.topology.structure','message','10wVJSWY','Unknown','124104DSsxaY','126EpTheK','toFixed','setStateAsync','1081624dflmdC','\x27.\x20Nicht\x20verbunden\x20mit\x20Ã¼berwachtem\x20\x27','warn','sendNotification','getHours','apply','\x20fÃ¼r\x20','ðŸ‘¼\x20Schutzengel-Frage:\x20','650223Wpfzjy','[DeadMan]\x20Topology\x20check\x20failed:\x20','indexOf','103386DRpjTy','now','stringify','search','parse','log','./setup','info','[DeadMan]\x20','toString','ðŸ’¤\x20Smart\x20Sleep\x20erkannt\x20(','7551980BwAbPK','error','bad','pre_warn','alarm','living','analysis.safety.deadMan.active','726662ZxxLwx','â³\x20ACHTUNG:\x20UngewÃ¶hnlich\x20lange\x20InaktivitÃ¤t\x20in\x20','exports','constructor','val','analysis.safety.deadMan.smartSleep','56DPPUIn','analysis.safety.deadMan.napProbability','(((.+)+)+)+$','replace','toLowerCase','includes','default'];a2_0x1318=function(){return _0x2099d0;};return a2_0x1318();}const a2_0x28738c=a2_0x23f1;(function(_0x3ff60a,_0x35d971){const _0x522ada=a2_0x23f1,_0x309340=_0x3ff60a();while(!![]){try{const _0x37b988=parseInt(_0x522ada(0x11d))/0x1+-parseInt(_0x522ada(0xed))/0x2*(parseInt(_0x522ada(0x10b))/0x3)+parseInt(_0x522ada(0x100))/0x4*(parseInt(_0x522ada(0xfa))/0x5)+parseInt(_0x522ada(0xfc))/0x6*(parseInt(_0x522ada(0xfd))/0x7)+parseInt(_0x522ada(0xe6))/0x8*(parseInt(_0x522ada(0x108))/0x9)+parseInt(_0x522ada(0x116))/0xa+-parseInt(_0x522ada(0xee))/0xb;if(_0x37b988===_0x35d971)break;else _0x309340['push'](_0x309340['shift']());}catch(_0xf6abb0){_0x309340['push'](_0x309340['shift']());}}}(a2_0x1318,0x65039));const a2_0x2e697b=(function(){let _0x3a892f=!![];return function(_0x4be583,_0x360a3e){const _0x2292c0=_0x3a892f?function(){const _0x4066cc=a2_0x23f1;if(_0x360a3e){const _0x1c2ae1=_0x360a3e[_0x4066cc(0x105)](_0x4be583,arguments);return _0x360a3e=null,_0x1c2ae1;}}:function(){};return _0x3a892f=![],_0x2292c0;};}()),a2_0x46ee3a=a2_0x2e697b(this,function(){const _0x3bb7e2=a2_0x23f1;return a2_0x46ee3a['toString']()[_0x3bb7e2(0x10e)](_0x3bb7e2(0xe8))[_0x3bb7e2(0x114)]()[_0x3bb7e2(0xe3)](a2_0x46ee3a)[_0x3bb7e2(0x10e)]('(((.+)+)+)+$');});a2_0x46ee3a();'use strict';const setup=require(a2_0x28738c(0x111));let activeTimer=null,currentMonitoredRoom=null,timeoutMs=0x0,startTime=0x0,alarmStage=0x0;const DEFAULT_TIMEOUTS={'bad':0x2d,'bath':0x2d,'toilet':0x1e,'wc':0x1e,'keller':0x3c,'schlaf':0x78,'bed':0x78,'guest':0x5a,'gast':0x5a};function getTimeoutRobust(_0x5a3f76,_0x3e4a1a){const _0x5f216f=a2_0x28738c;if(!_0x5a3f76||!_0x3e4a1a)return undefined;if(_0x5a3f76[_0x3e4a1a])return _0x5a3f76[_0x3e4a1a];const _0x52aa2c=_0x3e4a1a[_0x5f216f(0xea)]()['replace'](/[^a-z0-9]/g,'');for(const _0x2fd0cf in _0x5a3f76){const _0x3fe853=_0x2fd0cf['toLowerCase']()[_0x5f216f(0xe9)](/[^a-z0-9]/g,'');if(_0x3fe853===_0x52aa2c)return _0x5a3f76[_0x2fd0cf];}const _0x3aff1a=_0x3e4a1a[_0x5f216f(0xea)]();if(_0x5a3f76[_0x3aff1a])return _0x5a3f76[_0x3aff1a];return undefined;}function a2_0x23f1(_0x12df27,_0x3cc76a){const _0x28e9ea=a2_0x1318();return a2_0x23f1=function(_0x46ee3a,_0x2e697b){_0x46ee3a=_0x46ee3a-0xe2;let _0x1318ed=_0x28e9ea[_0x46ee3a];return _0x1318ed;},a2_0x23f1(_0x12df27,_0x3cc76a);}async function loadConfig(_0x5cde06){const _0x3b2eb3=a2_0x28738c;try{const _0x61b214=await _0x5cde06[_0x3b2eb3(0xf6)]('analysis.safety.deadMan.config');if(_0x61b214&&_0x61b214[_0x3b2eb3(0xe4)])return JSON[_0x3b2eb3(0x10f)](_0x61b214['val']);}catch(_0x3696cd){}return{};}async function isActive(_0x5481b6){const _0x12df39=a2_0x28738c;try{const _0x401255=await _0x5481b6[_0x12df39(0xf6)](_0x12df39(0x11c));return _0x401255&&_0x401255['val'];}catch(_0x19b63e){return![];}}async function areRoomsConnected(_0x5a320e,_0x45cb97,_0x4a05c9){const _0x5e5c70=a2_0x28738c;try{const _0x337bd3=await _0x5a320e['getStateAsync'](_0x5e5c70(0xf8));if(!_0x337bd3||!_0x337bd3[_0x5e5c70(0xe4)])return!![];const _0x58653f=JSON[_0x5e5c70(0x10f)](_0x337bd3[_0x5e5c70(0xe4)]),{rooms:_0x8c4ce6,matrix:_0x21e6ef}=_0x58653f;if(!_0x8c4ce6||!_0x21e6ef)return!![];const _0xd5f3a2=_0x8c4ce6[_0x5e5c70(0x10a)](_0x45cb97),_0x28b79d=_0x8c4ce6[_0x5e5c70(0x10a)](_0x4a05c9);if(_0xd5f3a2===-0x1||_0x28b79d===-0x1)return!![];const _0x46de11=_0x21e6ef[_0xd5f3a2][_0x28b79d]>0x0||_0x21e6ef[_0x28b79d][_0xd5f3a2]>0x0;return _0x46de11;}catch(_0x430b6d){return _0x5a320e[_0x5e5c70(0x110)][_0x5e5c70(0x102)](_0x5e5c70(0x109)+_0x430b6d[_0x5e5c70(0xf9)]),!![];}}function calculateSleepProbability(_0x557f79){const _0x347258=a2_0x28738c,_0x9e0e69=new Date(),_0x40003f=_0x9e0e69[_0x347258(0x104)](),_0x163f00=_0x557f79['toLowerCase']();let _0x109f7d=0.1;if(_0x40003f>=0x17||_0x40003f<=0x6)_0x109f7d=0x1;else{if(_0x40003f>=0xd&&_0x40003f<=0xf)_0x109f7d=0.8;else{if(_0x40003f>=0x14&&_0x40003f<=0x17)_0x109f7d=0.4;}}let _0x3f6f2a=0.1;if(_0x163f00[_0x347258(0xeb)]('schlaf')||_0x163f00[_0x347258(0xeb)]('bed'))_0x3f6f2a=0x1;else{if(_0x163f00[_0x347258(0xeb)]('wohn')||_0x163f00[_0x347258(0xeb)](_0x347258(0x11b))||_0x163f00[_0x347258(0xeb)]('sofa'))_0x3f6f2a=0.6;else{if(_0x163f00[_0x347258(0xeb)](_0x347258(0x118))||_0x163f00[_0x347258(0xeb)]('wc'))_0x3f6f2a=0.05;}}let _0x3205e8=0.5;const _0x23cc03=_0x3f6f2a*0.5+_0x109f7d*0.3+_0x3205e8*0.2;return parseFloat(_0x23cc03[_0x347258(0xfe)](0x2));}async function updateLocation(_0x206e91,_0x3491bd){const _0x25957f=a2_0x28738c;if(!_0x3491bd||_0x3491bd===_0x25957f(0xfb))return;if(!await isActive(_0x206e91)){resetTimer(_0x206e91);return;}if(currentMonitoredRoom&&currentMonitoredRoom!==_0x3491bd){const _0xede554=await areRoomsConnected(_0x206e91,currentMonitoredRoom,_0x3491bd);if(!_0xede554){const _0x360852='Ignoriere\x20Bewegung\x20in\x20\x27'+_0x3491bd+_0x25957f(0x101)+currentMonitoredRoom+'\x27.';_0x206e91[_0x25957f(0x110)][_0x25957f(0x112)](_0x25957f(0x113)+_0x360852+_0x25957f(0xf1)),await _0x206e91[_0x25957f(0xff)](_0x25957f(0xf5),{'val':JSON[_0x25957f(0x10d)]({'room':_0x3491bd,'reason':_0x360852,'timestamp':Date[_0x25957f(0x10c)]()}),'ack':!![]});return;}resetTimer(_0x206e91);}if(!currentMonitoredRoom){await _0x206e91[_0x25957f(0xff)](_0x25957f(0xf4),{'val':_0x3491bd,'ack':!![]});const _0x200214=await loadConfig(_0x206e91);let _0x14f413=getTimeoutRobust(_0x200214,_0x3491bd);const _0x35790f=_0x3491bd[_0x25957f(0xea)]();if(!_0x14f413)for(const _0x595b8f in DEFAULT_TIMEOUTS){if(_0x35790f[_0x25957f(0xeb)](_0x595b8f)){_0x14f413=DEFAULT_TIMEOUTS[_0x595b8f];break;}}if(!_0x14f413&&_0x200214['default'])_0x14f413=_0x200214[_0x25957f(0xec)];if(!_0x14f413)return;currentMonitoredRoom=_0x3491bd,startTimer(_0x206e91,_0x14f413,_0x3491bd);}}function startTimer(_0x361dae,_0x16982e,_0xe59bf7){const _0x12cd81=a2_0x28738c;if(activeTimer)clearTimeout(activeTimer);timeoutMs=_0x16982e*0x3c*0x3e8,startTime=Date[_0x12cd81(0x10c)](),alarmStage=0x0;const _0x5cbbad=calculateSleepProbability(_0xe59bf7||currentMonitoredRoom),_0x4abc72=_0x5cbbad>0.65;_0x4abc72?(timeoutMs+=0x5a*0x3c*0x3e8,_0x361dae[_0x12cd81(0x110)][_0x12cd81(0x112)](_0x12cd81(0x115)+(_0x5cbbad*0x64)[_0x12cd81(0xfe)](0x0)+_0x12cd81(0xf7)+currentMonitoredRoom+_0x12cd81(0xf0)),_0x361dae[_0x12cd81(0xff)]('analysis.safety.deadMan.smartSleep',{'val':!![],'ack':!![]})):_0x361dae[_0x12cd81(0xff)]('analysis.safety.deadMan.smartSleep',{'val':![],'ack':!![]}),_0x361dae[_0x12cd81(0xff)](_0x12cd81(0xe7),{'val':_0x5cbbad,'ack':!![]}),_0x361dae[_0x12cd81(0x110)][_0x12cd81(0x112)]('ðŸ‘¼\x20Schutzengel:\x20Ãœberwache\x20'+currentMonitoredRoom+_0x12cd81(0x106)+_0x16982e+_0x12cd81(0xf3)),_0x361dae['setStateAsync'](_0x12cd81(0xef),{'val':'ok','ack':!![]}),activeTimer=setTimeout(()=>triggerPreWarn(_0x361dae),timeoutMs);}function resetTimer(_0x4e2e0f){const _0x3751d2=a2_0x28738c;if(activeTimer)clearTimeout(activeTimer);activeTimer=null,currentMonitoredRoom=null,alarmStage=0x0,_0x4e2e0f[_0x3751d2(0xff)]('analysis.safety.deadMan.alarmState',{'val':'ok','ack':!![]}),_0x4e2e0f['setStateAsync'](_0x3751d2(0xe5),{'val':![],'ack':!![]}),_0x4e2e0f['setStateAsync'](_0x3751d2(0xe7),{'val':0x0,'ack':!![]});}async function triggerPreWarn(_0x3203e2){const _0x56e5cd=a2_0x28738c;alarmStage=0x1,await _0x3203e2[_0x56e5cd(0xff)](_0x56e5cd(0xef),{'val':_0x56e5cd(0x119),'ack':!![]});const _0x21d7d1=_0x56e5cd(0x11e)+currentMonitoredRoom+'.\x20Alles\x20in\x20Ordnung?';_0x3203e2[_0x56e5cd(0x110)]['warn']('[DeadMan]\x20'+_0x21d7d1),await setup[_0x56e5cd(0x103)](_0x3203e2,_0x56e5cd(0x107)+_0x21d7d1),activeTimer=setTimeout(()=>triggerAlarm(_0x3203e2),0x5*0x3c*0x3e8);}async function triggerAlarm(_0x1cb206){const _0x31615c=a2_0x28738c;alarmStage=0x2,await _0x1cb206[_0x31615c(0xff)](_0x31615c(0xef),{'val':_0x31615c(0x11a),'ack':!![]});const _0x448efe=_0x31615c(0xf2)+currentMonitoredRoom+'!';_0x1cb206[_0x31615c(0x110)][_0x31615c(0x117)](_0x31615c(0x113)+_0x448efe),await setup[_0x31615c(0x103)](_0x1cb206,_0x448efe,![],!![]);}module[a2_0x28738c(0xe2)]={'updateLocation':updateLocation};