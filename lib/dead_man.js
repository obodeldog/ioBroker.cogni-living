function a2_0x5d30(){const _0x3dd43d=['includes','ðŸ‘¼\x20Schutzengel:\x20Ãœberwache\x20','29675UKfeKF','info','val','analysis.topology.structure','16175291ercwpx','indexOf','analysis.safety.deadMan.alarmState','1074124antfiD','analysis.safety.deadMan.active','./setup','ðŸ‘¼\x20Schutzengel-Frage:\x20','\x20um\x2090\x20Min.','â³\x20ACHTUNG:\x20UngewÃ¶hnlich\x20lange\x20InaktivitÃ¤t\x20in\x20','\x20fÃ¼r\x20','(((.+)+)+)+$','12yvqzaz','ðŸš¨\x20NOTFALL-ALARM:\x20Person\x20reagiert\x20nicht\x20in\x20','pre_warn','parse','[DeadMan]\x20Topology\x20check\x20failed:\x20','bad','toLowerCase','1589103hbJkEZ','schlaf','bed','log','default','639Xwfjbb','12grJFQi','Ignoriere\x20Bewegung\x20in\x20\x27','wohn','alarm','31167KxvVCd','\x20Min.','replace','toString','analysis.safety.deadMan.config','sendNotification','Unknown','3780vjriID','2938AAObxO','[DeadMan]\x20','analysis.safety.deadMan.smartSleep','now','exports','getStateAsync','constructor','49xWoojj','toFixed','apply','738992XKuKWv','analysis.safety.deadMan.napProbability','analysis.safety.deadMan.lastIgnored','setStateAsync'];a2_0x5d30=function(){return _0x3dd43d;};return a2_0x5d30();}const a2_0x276dbd=a2_0x1ed5;(function(_0x4d8701,_0x21d289){const _0x1471bf=a2_0x1ed5,_0x424082=_0x4d8701();while(!![]){try{const _0x439deb=parseInt(_0x1471bf(0x201))/0x1*(-parseInt(_0x1471bf(0x20e))/0x2)+-parseInt(_0x1471bf(0x1fc))/0x3+parseInt(_0x1471bf(0x1ed))/0x4+parseInt(_0x1471bf(0x1e6))/0x5*(parseInt(_0x1471bf(0x1f5))/0x6)+parseInt(_0x1471bf(0x215))/0x7*(-parseInt(_0x1471bf(0x1e0))/0x8)+-parseInt(_0x1471bf(0x206))/0x9*(-parseInt(_0x1471bf(0x20d))/0xa)+-parseInt(_0x1471bf(0x1ea))/0xb*(-parseInt(_0x1471bf(0x202))/0xc);if(_0x439deb===_0x21d289)break;else _0x424082['push'](_0x424082['shift']());}catch(_0x862dd9){_0x424082['push'](_0x424082['shift']());}}}(a2_0x5d30,0xe6af6));const a2_0x3dfc0e=(function(){let _0x219c2f=!![];return function(_0x4c2f5,_0x3aff74){const _0x4d6d69=_0x219c2f?function(){const _0x2eb945=a2_0x1ed5;if(_0x3aff74){const _0x34650a=_0x3aff74[_0x2eb945(0x1df)](_0x4c2f5,arguments);return _0x3aff74=null,_0x34650a;}}:function(){};return _0x219c2f=![],_0x4d6d69;};}()),a2_0x51d15e=a2_0x3dfc0e(this,function(){const _0x30b33a=a2_0x1ed5;return a2_0x51d15e[_0x30b33a(0x209)]()['search'](_0x30b33a(0x1f4))[_0x30b33a(0x209)]()[_0x30b33a(0x214)](a2_0x51d15e)['search'](_0x30b33a(0x1f4));});a2_0x51d15e();'use strict';const setup=require(a2_0x276dbd(0x1ef));let activeTimer=null,currentMonitoredRoom=null,timeoutMs=0x0,startTime=0x0,alarmStage=0x0;const DEFAULT_TIMEOUTS={'bad':0x2d,'bath':0x2d,'toilet':0x1e,'wc':0x1e,'keller':0x3c,'schlaf':0x78,'bed':0x78,'guest':0x5a,'gast':0x5a};function getTimeoutRobust(_0x48985b,_0x163dc4){const _0xc136d5=a2_0x276dbd;if(!_0x48985b||!_0x163dc4)return undefined;if(_0x48985b[_0x163dc4])return _0x48985b[_0x163dc4];const _0x31411f=_0x163dc4[_0xc136d5(0x1fb)]()[_0xc136d5(0x208)](/[^a-z0-9]/g,'');for(const _0x24216c in _0x48985b){const _0x4bf31e=_0x24216c['toLowerCase']()[_0xc136d5(0x208)](/[^a-z0-9]/g,'');if(_0x4bf31e===_0x31411f)return _0x48985b[_0x24216c];}const _0x26b95d=_0x163dc4[_0xc136d5(0x1fb)]();if(_0x48985b[_0x26b95d])return _0x48985b[_0x26b95d];return undefined;}async function loadConfig(_0x2bb2fb){const _0x2c27d4=a2_0x276dbd;try{const _0x32175d=await _0x2bb2fb['getStateAsync'](_0x2c27d4(0x20a));if(_0x32175d&&_0x32175d['val'])return JSON[_0x2c27d4(0x1f8)](_0x32175d[_0x2c27d4(0x1e8)]);}catch(_0x50040f){}return{};}async function isActive(_0x13c3fb){const _0x43ef88=a2_0x276dbd;try{const _0x17170d=await _0x13c3fb['getStateAsync'](_0x43ef88(0x1ee));return _0x17170d&&_0x17170d[_0x43ef88(0x1e8)];}catch(_0x2a18aa){return![];}}async function areRoomsConnected(_0x4d46fd,_0x412669,_0x33f612){const _0x57e22d=a2_0x276dbd;try{const _0x4ac81d=await _0x4d46fd[_0x57e22d(0x213)](_0x57e22d(0x1e9));if(!_0x4ac81d||!_0x4ac81d[_0x57e22d(0x1e8)])return!![];const _0x5455ec=JSON[_0x57e22d(0x1f8)](_0x4ac81d[_0x57e22d(0x1e8)]),{rooms:_0x5afd8e,matrix:_0x1ec210}=_0x5455ec;if(!_0x5afd8e||!_0x1ec210)return!![];const _0x54b24f=_0x5afd8e['indexOf'](_0x412669),_0x39a737=_0x5afd8e[_0x57e22d(0x1eb)](_0x33f612);if(_0x54b24f===-0x1||_0x39a737===-0x1)return!![];const _0x3417a7=_0x1ec210[_0x54b24f][_0x39a737]>0x0||_0x1ec210[_0x39a737][_0x54b24f]>0x0;return _0x3417a7;}catch(_0x5f6888){return _0x4d46fd['log']['warn'](_0x57e22d(0x1f9)+_0x5f6888['message']),!![];}}function a2_0x1ed5(_0x5206fb,_0xc6c622){const _0x58d703=a2_0x5d30();return a2_0x1ed5=function(_0x51d15e,_0x3dfc0e){_0x51d15e=_0x51d15e-0x1df;let _0x5d30fe=_0x58d703[_0x51d15e];return _0x5d30fe;},a2_0x1ed5(_0x5206fb,_0xc6c622);}function calculateSleepProbability(_0x4e7e76){const _0x3b104c=a2_0x276dbd,_0x5d884d=new Date(),_0x542c70=_0x5d884d['getHours'](),_0x42cb9b=_0x4e7e76[_0x3b104c(0x1fb)]();let _0x52a91a=0.1;if(_0x542c70>=0x17||_0x542c70<=0x6)_0x52a91a=0x1;else{if(_0x542c70>=0xd&&_0x542c70<=0xf)_0x52a91a=0.8;else{if(_0x542c70>=0x14&&_0x542c70<=0x17)_0x52a91a=0.4;}}let _0x39b52b=0.1;if(_0x42cb9b[_0x3b104c(0x1e4)](_0x3b104c(0x1fd))||_0x42cb9b['includes'](_0x3b104c(0x1fe)))_0x39b52b=0x1;else{if(_0x42cb9b[_0x3b104c(0x1e4)](_0x3b104c(0x204))||_0x42cb9b['includes']('living')||_0x42cb9b[_0x3b104c(0x1e4)]('sofa'))_0x39b52b=0.6;else{if(_0x42cb9b[_0x3b104c(0x1e4)](_0x3b104c(0x1fa))||_0x42cb9b['includes']('wc'))_0x39b52b=0.05;}}let _0x29ece7=0.5;const _0x532ae8=_0x39b52b*0.5+_0x52a91a*0.3+_0x29ece7*0.2;return parseFloat(_0x532ae8[_0x3b104c(0x216)](0x2));}async function updateLocation(_0x493a2d,_0x1a7878){const _0x448329=a2_0x276dbd;if(!_0x1a7878||_0x1a7878===_0x448329(0x20c))return;if(!await isActive(_0x493a2d)){resetTimer(_0x493a2d);return;}if(currentMonitoredRoom&&currentMonitoredRoom!==_0x1a7878){const _0x2d6ba2=await areRoomsConnected(_0x493a2d,currentMonitoredRoom,_0x1a7878);if(!_0x2d6ba2){const _0x256941=_0x448329(0x203)+_0x1a7878+'\x27.\x20Nicht\x20verbunden\x20mit\x20Ã¼berwachtem\x20\x27'+currentMonitoredRoom+'\x27.';_0x493a2d['log']['info']('[DeadMan]\x20'+_0x256941+'\x20(Multi-Person\x20Filter)'),await _0x493a2d[_0x448329(0x1e3)](_0x448329(0x1e2),{'val':JSON['stringify']({'room':_0x1a7878,'reason':_0x256941,'timestamp':Date[_0x448329(0x211)]()}),'ack':!![]});return;}resetTimer(_0x493a2d);}if(!currentMonitoredRoom){await _0x493a2d[_0x448329(0x1e3)]('analysis.safety.deadMan.currentRoom',{'val':_0x1a7878,'ack':!![]});const _0x30638b=await loadConfig(_0x493a2d);let _0x57dad7=getTimeoutRobust(_0x30638b,_0x1a7878);const _0x4f241b=_0x1a7878[_0x448329(0x1fb)]();if(!_0x57dad7)for(const _0x2e3915 in DEFAULT_TIMEOUTS){if(_0x4f241b[_0x448329(0x1e4)](_0x2e3915)){_0x57dad7=DEFAULT_TIMEOUTS[_0x2e3915];break;}}if(!_0x57dad7&&_0x30638b['default'])_0x57dad7=_0x30638b[_0x448329(0x200)];if(!_0x57dad7)return;currentMonitoredRoom=_0x1a7878,startTimer(_0x493a2d,_0x57dad7,_0x1a7878);}}function startTimer(_0x123fd6,_0xeda85c,_0xc65a2c){const _0x273681=a2_0x276dbd;if(activeTimer)clearTimeout(activeTimer);timeoutMs=_0xeda85c*0x3c*0x3e8,startTime=Date[_0x273681(0x211)](),alarmStage=0x0;const _0x21cef8=calculateSleepProbability(_0xc65a2c||currentMonitoredRoom),_0x3699e1=_0x21cef8>0.65;_0x3699e1?(timeoutMs+=0x5a*0x3c*0x3e8,_0x123fd6[_0x273681(0x1ff)][_0x273681(0x1e7)]('ðŸ’¤\x20Smart\x20Sleep\x20erkannt\x20('+(_0x21cef8*0x64)[_0x273681(0x216)](0x0)+'%).\x20VerlÃ¤ngere\x20Timer\x20fÃ¼r\x20'+currentMonitoredRoom+_0x273681(0x1f1)),_0x123fd6['setStateAsync']('analysis.safety.deadMan.smartSleep',{'val':!![],'ack':!![]})):_0x123fd6['setStateAsync'](_0x273681(0x210),{'val':![],'ack':!![]}),_0x123fd6[_0x273681(0x1e3)]('analysis.safety.deadMan.napProbability',{'val':_0x21cef8,'ack':!![]}),_0x123fd6[_0x273681(0x1ff)][_0x273681(0x1e7)](_0x273681(0x1e5)+currentMonitoredRoom+_0x273681(0x1f3)+_0xeda85c+_0x273681(0x207)),_0x123fd6['setStateAsync'](_0x273681(0x1ec),{'val':'ok','ack':!![]}),activeTimer=setTimeout(()=>triggerPreWarn(_0x123fd6),timeoutMs);}function resetTimer(_0x3cf443){const _0x44294c=a2_0x276dbd;if(activeTimer)clearTimeout(activeTimer);activeTimer=null,currentMonitoredRoom=null,alarmStage=0x0,_0x3cf443[_0x44294c(0x1e3)](_0x44294c(0x1ec),{'val':'ok','ack':!![]}),_0x3cf443[_0x44294c(0x1e3)](_0x44294c(0x210),{'val':![],'ack':!![]}),_0x3cf443['setStateAsync'](_0x44294c(0x1e1),{'val':0x0,'ack':!![]});}async function triggerPreWarn(_0x3c2781){const _0x19ea9a=a2_0x276dbd;alarmStage=0x1,await _0x3c2781['setStateAsync'](_0x19ea9a(0x1ec),{'val':_0x19ea9a(0x1f7),'ack':!![]});const _0x1c0bf4=_0x19ea9a(0x1f2)+currentMonitoredRoom+'.\x20Alles\x20in\x20Ordnung?';_0x3c2781[_0x19ea9a(0x1ff)]['warn'](_0x19ea9a(0x20f)+_0x1c0bf4),await setup['sendNotification'](_0x3c2781,_0x19ea9a(0x1f0)+_0x1c0bf4),activeTimer=setTimeout(()=>triggerAlarm(_0x3c2781),0x5*0x3c*0x3e8);}async function triggerAlarm(_0x1cff55){const _0x2db78d=a2_0x276dbd;alarmStage=0x2,await _0x1cff55[_0x2db78d(0x1e3)](_0x2db78d(0x1ec),{'val':_0x2db78d(0x205),'ack':!![]});const _0x17b6c3=_0x2db78d(0x1f6)+currentMonitoredRoom+'!';_0x1cff55[_0x2db78d(0x1ff)]['error']('[DeadMan]\x20'+_0x17b6c3),await setup[_0x2db78d(0x20b)](_0x1cff55,_0x17b6c3,![],!![]);}module[a2_0x276dbd(0x212)]={'updateLocation':updateLocation};