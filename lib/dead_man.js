const a2_0x12a746=a2_0x3fb3;(function(_0x4b8912,_0x209fba){const _0x3e9869=a2_0x3fb3,_0x258b63=_0x4b8912();while(!![]){try{const _0xad3677=-parseInt(_0x3e9869(0x81))/0x1*(parseInt(_0x3e9869(0x75))/0x2)+parseInt(_0x3e9869(0x9d))/0x3+-parseInt(_0x3e9869(0x95))/0x4*(parseInt(_0x3e9869(0x84))/0x5)+-parseInt(_0x3e9869(0x74))/0x6+parseInt(_0x3e9869(0x7a))/0x7*(parseInt(_0x3e9869(0x70))/0x8)+parseInt(_0x3e9869(0xa4))/0x9+parseInt(_0x3e9869(0x76))/0xa*(-parseInt(_0x3e9869(0x9f))/0xb);if(_0xad3677===_0x209fba)break;else _0x258b63['push'](_0x258b63['shift']());}catch(_0x44c8cb){_0x258b63['push'](_0x258b63['shift']());}}}(a2_0x55f2,0xb9a86));const a2_0x3cc728=(function(){let _0x106ba6=!![];return function(_0x23b0fe,_0x2cb24a){const _0x1035a1=_0x106ba6?function(){if(_0x2cb24a){const _0x29cf51=_0x2cb24a['apply'](_0x23b0fe,arguments);return _0x2cb24a=null,_0x29cf51;}}:function(){};return _0x106ba6=![],_0x1035a1;};}()),a2_0x21ece3=a2_0x3cc728(this,function(){const _0x2ff3f2=a2_0x3fb3;return a2_0x21ece3['toString']()[_0x2ff3f2(0x79)](_0x2ff3f2(0x7b))[_0x2ff3f2(0x92)]()['constructor'](a2_0x21ece3)[_0x2ff3f2(0x79)](_0x2ff3f2(0x7b));});a2_0x21ece3();'use strict';const setup=require(a2_0x12a746(0x8c));function a2_0x3fb3(_0x5ad41a,_0x2dcfd2){const _0x5c2c71=a2_0x55f2();return a2_0x3fb3=function(_0x21ece3,_0x3cc728){_0x21ece3=_0x21ece3-0x6d;let _0x55f23e=_0x5c2c71[_0x21ece3];return _0x55f23e;},a2_0x3fb3(_0x5ad41a,_0x2dcfd2);}let activeTimer=null,currentMonitoredRoom=null,timeoutMs=0x0,startTime=0x0,alarmStage=0x0;const DEFAULT_TIMEOUTS={'bad':0x2d,'bath':0x2d,'toilet':0x1e,'wc':0x1e,'keller':0x3c,'schlaf':0x78,'bed':0x78,'guest':0x5a,'gast':0x5a};async function loadConfig(_0x1a9d8c){const _0x418f8b=a2_0x12a746;try{const _0x420668=await _0x1a9d8c[_0x418f8b(0x8e)](_0x418f8b(0x94));if(_0x420668&&_0x420668[_0x418f8b(0x82)])return JSON[_0x418f8b(0x78)](_0x420668['val']);}catch(_0x51b55c){}return{};}function a2_0x55f2(){const _0x234249=['3959025yowtEt','%).\x20VerlÃ¤ngere\x20Timer\x20fÃ¼r\x20','738694gqtjDY','sofa','wohn','ðŸ‘¼\x20Schutzengel:\x20Ãœberwache\x20','living','10137069swDfbp','setStateAsync','\x20Min.','ðŸš¨\x20NOTFALL-ALARM:\x20Person\x20reagiert\x20nicht\x20in\x20','\x20fÃ¼r\x20','\x27.\x20Nicht\x20verbunden\x20mit\x20Ã¼berwachtem\x20\x27','now','147656NHTbUH','[DeadMan]\x20Topology\x20check\x20failed:\x20','bad','indexOf','131394JwKoSl','1542eJlyVk','370ZxMtmF','analysis.safety.deadMan.currentRoom','parse','search','504KhFQxF','(((.+)+)+)+$','info','analysis.safety.deadMan.napProbability','[DeadMan]\x20','log','analysis.safety.deadMan.alarmState','157cscamy','val','pre_warn','967055EmksxS','schlaf','includes','\x20(Multi-Person\x20Filter)','Ignoriere\x20Bewegung\x20in\x20\x27','stringify','getHours','sendNotification','./setup','\x20um\x2090\x20Min.','getStateAsync','Unknown','alarm','toFixed','toString','ðŸ‘¼\x20Schutzengel-Frage:\x20','analysis.safety.deadMan.config','8XoWzXn','default','analysis.safety.deadMan.smartSleep','ðŸ’¤\x20Smart\x20Sleep\x20erkannt\x20(','message','analysis.topology.structure','toLowerCase','.\x20Alles\x20in\x20Ordnung?'];a2_0x55f2=function(){return _0x234249;};return a2_0x55f2();}async function isActive(_0x2de46d){const _0x4022e9=a2_0x12a746;try{const _0x2560ac=await _0x2de46d['getStateAsync']('analysis.safety.deadMan.active');return _0x2560ac&&_0x2560ac[_0x4022e9(0x82)];}catch(_0x55770a){return![];}}async function areRoomsConnected(_0x123ecc,_0x4ee2ba,_0x4df691){const _0x5d832b=a2_0x12a746;try{const _0x2b4849=await _0x123ecc[_0x5d832b(0x8e)](_0x5d832b(0x9a));if(!_0x2b4849||!_0x2b4849['val'])return!![];const _0x2475dc=JSON[_0x5d832b(0x78)](_0x2b4849[_0x5d832b(0x82)]),{rooms:_0xe9279,matrix:_0x4693cc}=_0x2475dc;if(!_0xe9279||!_0x4693cc)return!![];const _0x56a318=_0xe9279['indexOf'](_0x4ee2ba),_0x59bd0f=_0xe9279[_0x5d832b(0x73)](_0x4df691);if(_0x56a318===-0x1||_0x59bd0f===-0x1)return!![];const _0x150aa1=_0x4693cc[_0x56a318][_0x59bd0f]>0x0||_0x4693cc[_0x59bd0f][_0x56a318]>0x0;return _0x150aa1;}catch(_0x221901){return _0x123ecc[_0x5d832b(0x7f)]['warn'](_0x5d832b(0x71)+_0x221901[_0x5d832b(0x99)]),!![];}}function calculateSleepProbability(_0x4bf18b){const _0x47a445=a2_0x12a746,_0x49589a=new Date(),_0x58aed9=_0x49589a[_0x47a445(0x8a)](),_0x241cfb=_0x4bf18b[_0x47a445(0x9b)]();let _0x2a2dae=0.1;if(_0x58aed9>=0x17||_0x58aed9<=0x6)_0x2a2dae=0x1;else{if(_0x58aed9>=0xd&&_0x58aed9<=0xf)_0x2a2dae=0.8;else{if(_0x58aed9>=0x14&&_0x58aed9<=0x17)_0x2a2dae=0.4;}}let _0x4b21f4=0.1;if(_0x241cfb[_0x47a445(0x86)](_0x47a445(0x85))||_0x241cfb[_0x47a445(0x86)]('bed'))_0x4b21f4=0x1;else{if(_0x241cfb[_0x47a445(0x86)](_0x47a445(0xa1))||_0x241cfb[_0x47a445(0x86)](_0x47a445(0xa3))||_0x241cfb['includes'](_0x47a445(0xa0)))_0x4b21f4=0.6;else{if(_0x241cfb[_0x47a445(0x86)](_0x47a445(0x72))||_0x241cfb[_0x47a445(0x86)]('wc'))_0x4b21f4=0.05;}}let _0x1552a3=0.5;const _0x2d8f50=_0x4b21f4*0.5+_0x2a2dae*0.3+_0x1552a3*0.2;return parseFloat(_0x2d8f50[_0x47a445(0x91)](0x2));}async function updateLocation(_0x47915e,_0x1b69a7){const _0x1c26a4=a2_0x12a746;if(!_0x1b69a7||_0x1b69a7===_0x1c26a4(0x8f))return;if(!await isActive(_0x47915e)){resetTimer(_0x47915e);return;}if(currentMonitoredRoom&&currentMonitoredRoom!==_0x1b69a7){const _0x377c5f=await areRoomsConnected(_0x47915e,currentMonitoredRoom,_0x1b69a7);if(!_0x377c5f){const _0x49c26b=_0x1c26a4(0x88)+_0x1b69a7+_0x1c26a4(0x6e)+currentMonitoredRoom+'\x27.';_0x47915e['log']['info'](_0x1c26a4(0x7e)+_0x49c26b+_0x1c26a4(0x87)),await _0x47915e[_0x1c26a4(0xa5)]('analysis.safety.deadMan.lastIgnored',{'val':JSON[_0x1c26a4(0x89)]({'room':_0x1b69a7,'reason':_0x49c26b,'timestamp':Date[_0x1c26a4(0x6f)]()}),'ack':!![]});return;}resetTimer(_0x47915e);}if(!currentMonitoredRoom){await _0x47915e[_0x1c26a4(0xa5)](_0x1c26a4(0x77),{'val':_0x1b69a7,'ack':!![]});const _0x560f03=await loadConfig(_0x47915e),_0x1c9995=_0x1b69a7[_0x1c26a4(0x9b)]();let _0x1601a6=_0x560f03[_0x1b69a7]||_0x560f03[_0x1c9995];if(!_0x1601a6)for(const _0x161178 in DEFAULT_TIMEOUTS){if(_0x1c9995[_0x1c26a4(0x86)](_0x161178)){_0x1601a6=DEFAULT_TIMEOUTS[_0x161178];break;}}if(!_0x1601a6&&_0x560f03[_0x1c26a4(0x96)])_0x1601a6=_0x560f03[_0x1c26a4(0x96)];if(!_0x1601a6)return;currentMonitoredRoom=_0x1b69a7,startTimer(_0x47915e,_0x1601a6,_0x1b69a7);}}function startTimer(_0x1fb988,_0x13efbc,_0x40b20c){const _0x97905d=a2_0x12a746;if(activeTimer)clearTimeout(activeTimer);timeoutMs=_0x13efbc*0x3c*0x3e8,startTime=Date['now'](),alarmStage=0x0;const _0x478a48=calculateSleepProbability(_0x40b20c||currentMonitoredRoom),_0x46ffeb=_0x478a48>0.65;_0x46ffeb?(timeoutMs+=0x5a*0x3c*0x3e8,_0x1fb988[_0x97905d(0x7f)][_0x97905d(0x7c)](_0x97905d(0x98)+(_0x478a48*0x64)['toFixed'](0x0)+_0x97905d(0x9e)+currentMonitoredRoom+_0x97905d(0x8d)),_0x1fb988[_0x97905d(0xa5)](_0x97905d(0x97),{'val':!![],'ack':!![]})):_0x1fb988[_0x97905d(0xa5)]('analysis.safety.deadMan.smartSleep',{'val':![],'ack':!![]}),_0x1fb988[_0x97905d(0xa5)]('analysis.safety.deadMan.napProbability',{'val':_0x478a48,'ack':!![]}),_0x1fb988[_0x97905d(0x7f)][_0x97905d(0x7c)](_0x97905d(0xa2)+currentMonitoredRoom+_0x97905d(0x6d)+_0x13efbc+_0x97905d(0xa6)),_0x1fb988[_0x97905d(0xa5)]('analysis.safety.deadMan.alarmState',{'val':'ok','ack':!![]}),activeTimer=setTimeout(()=>triggerPreWarn(_0x1fb988),timeoutMs);}function resetTimer(_0x1d92fc){const _0x390b86=a2_0x12a746;if(activeTimer)clearTimeout(activeTimer);activeTimer=null,currentMonitoredRoom=null,alarmStage=0x0,_0x1d92fc['setStateAsync'](_0x390b86(0x80),{'val':'ok','ack':!![]}),_0x1d92fc['setStateAsync']('analysis.safety.deadMan.smartSleep',{'val':![],'ack':!![]}),_0x1d92fc[_0x390b86(0xa5)](_0x390b86(0x7d),{'val':0x0,'ack':!![]});}async function triggerPreWarn(_0x5a3fb8){const _0x206aa0=a2_0x12a746;alarmStage=0x1,await _0x5a3fb8['setStateAsync'](_0x206aa0(0x80),{'val':_0x206aa0(0x83),'ack':!![]});const _0x159787='â³\x20ACHTUNG:\x20UngewÃ¶hnlich\x20lange\x20InaktivitÃ¤t\x20in\x20'+currentMonitoredRoom+_0x206aa0(0x9c);_0x5a3fb8['log']['warn'](_0x206aa0(0x7e)+_0x159787),await setup[_0x206aa0(0x8b)](_0x5a3fb8,_0x206aa0(0x93)+_0x159787),activeTimer=setTimeout(()=>triggerAlarm(_0x5a3fb8),0x5*0x3c*0x3e8);}async function triggerAlarm(_0x2abcec){const _0x5de58c=a2_0x12a746;alarmStage=0x2,await _0x2abcec[_0x5de58c(0xa5)](_0x5de58c(0x80),{'val':_0x5de58c(0x90),'ack':!![]});const _0xd034cc=_0x5de58c(0xa7)+currentMonitoredRoom+'!';_0x2abcec[_0x5de58c(0x7f)]['error']('[DeadMan]\x20'+_0xd034cc),await setup[_0x5de58c(0x8b)](_0x2abcec,_0xd034cc,![],!![]);}module['exports']={'updateLocation':updateLocation};