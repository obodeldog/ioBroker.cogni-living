const a2_0xb4f78a=a2_0x400b;(function(_0x3e0ceb,_0x49028b){const _0x21fb7d=a2_0x400b,_0x51b3c7=_0x3e0ceb();while(!![]){try{const _0x2ef47c=parseInt(_0x21fb7d(0xaa))/0x1*(parseInt(_0x21fb7d(0x94))/0x2)+-parseInt(_0x21fb7d(0xa8))/0x3+parseInt(_0x21fb7d(0xc0))/0x4+parseInt(_0x21fb7d(0x93))/0x5*(parseInt(_0x21fb7d(0xc8))/0x6)+-parseInt(_0x21fb7d(0x9a))/0x7*(-parseInt(_0x21fb7d(0xc4))/0x8)+parseInt(_0x21fb7d(0x98))/0x9*(-parseInt(_0x21fb7d(0xc9))/0xa)+-parseInt(_0x21fb7d(0x90))/0xb*(parseInt(_0x21fb7d(0xa4))/0xc);if(_0x2ef47c===_0x49028b)break;else _0x51b3c7['push'](_0x51b3c7['shift']());}catch(_0xc48140){_0x51b3c7['push'](_0x51b3c7['shift']());}}}(a2_0x50e7,0xb50e7));const a2_0x1e557e=(function(){let _0x2b3b04=!![];return function(_0x17ced5,_0x492093){const _0x468e5b=_0x2b3b04?function(){const _0x39addc=a2_0x400b;if(_0x492093){const _0x823356=_0x492093[_0x39addc(0xa7)](_0x17ced5,arguments);return _0x492093=null,_0x823356;}}:function(){};return _0x2b3b04=![],_0x468e5b;};}()),a2_0xf2d306=a2_0x1e557e(this,function(){const _0x4dfc2b=a2_0x400b;return a2_0xf2d306[_0x4dfc2b(0xab)]()[_0x4dfc2b(0xb8)]('(((.+)+)+)+$')[_0x4dfc2b(0xab)]()['constructor'](a2_0xf2d306)['search'](_0x4dfc2b(0xad));});a2_0xf2d306();'use strict';const setup=require(a2_0xb4f78a(0xc3));let activeTimer=null,currentMonitoredRoom=null,timeoutMs=0x0,startTime=0x0,alarmStage=0x0;const DEFAULT_TIMEOUTS={'bad':0x2d,'bath':0x2d,'toilet':0x1e,'wc':0x1e,'keller':0x3c,'schlaf':0x78,'bed':0x78,'guest':0x5a,'gast':0x5a};async function loadConfig(_0x3fb27b){const _0x492466=a2_0xb4f78a;try{const _0x502012=await _0x3fb27b[_0x492466(0x97)](_0x492466(0xc6));if(_0x502012&&_0x502012[_0x492466(0xbb)])return JSON[_0x492466(0x9b)](_0x502012[_0x492466(0xbb)]);}catch(_0x107cf4){}return{};}function a2_0x50e7(){const _0x2423bf=['605gMAxJt','schlaf','\x20(Multi-Person\x20Filter)','235UpGTDt','5784iLQFND','\x20Min.','â³\x20ACHTUNG:\x20UngewÃ¶hnlich\x20lange\x20InaktivitÃ¤t\x20in\x20','getStateAsync','279pjMimN','pre_warn','49OoLGMx','parse','sendNotification','analysis.safety.deadMan.lastIgnored','stringify','log','indexOf','analysis.safety.deadMan.currentRoom','toFixed','analysis.safety.deadMan.active','648540qRTpQQ','\x27.\x20Nicht\x20verbunden\x20mit\x20Ã¼berwachtem\x20\x27','sofa','apply','931473TICawx','%).\x20VerlÃ¤ngere\x20Timer\x20fÃ¼r\x20','397aBokUA','toString','ðŸ‘¼\x20Schutzengel:\x20Ãœberwache\x20','(((.+)+)+)+$','Unknown','\x20fÃ¼r\x20','default','wohn','ðŸ‘¼\x20Schutzengel-Frage:\x20','ðŸš¨\x20NOTFALL-ALARM:\x20Person\x20reagiert\x20nicht\x20in\x20','analysis.safety.deadMan.smartSleep','analysis.safety.deadMan.napProbability','analysis.topology.structure','includes','search','exports','bed','val','error','getHours','info','ðŸ’¤\x20Smart\x20Sleep\x20erkannt\x20(','5810080biEpcb','\x20um\x2090\x20Min.','.\x20Alles\x20in\x20Ordnung?','./setup','1664496nvBFSr','Ignoriere\x20Bewegung\x20in\x20\x27','analysis.safety.deadMan.config','warn','104886uTBlvA','275520KPerNu','setStateAsync','[DeadMan]\x20','[DeadMan]\x20Topology\x20check\x20failed:\x20','bad','analysis.safety.deadMan.alarmState','alarm'];a2_0x50e7=function(){return _0x2423bf;};return a2_0x50e7();}async function isActive(_0x355438){const _0x3486df=a2_0xb4f78a;try{const _0x4ec055=await _0x355438[_0x3486df(0x97)](_0x3486df(0xa3));return _0x4ec055&&_0x4ec055[_0x3486df(0xbb)];}catch(_0x2fa1cc){return![];}}function a2_0x400b(_0x475eeb,_0x72237c){const _0x2e816e=a2_0x50e7();return a2_0x400b=function(_0xf2d306,_0x1e557e){_0xf2d306=_0xf2d306-0x90;let _0x50e757=_0x2e816e[_0xf2d306];return _0x50e757;},a2_0x400b(_0x475eeb,_0x72237c);}async function areRoomsConnected(_0x1b2451,_0x325640,_0x48c5b5){const _0x20397b=a2_0xb4f78a;try{const _0x40964=await _0x1b2451[_0x20397b(0x97)](_0x20397b(0xb6));if(!_0x40964||!_0x40964[_0x20397b(0xbb)])return!![];const _0x40421a=JSON['parse'](_0x40964[_0x20397b(0xbb)]),{rooms:_0x56a738,matrix:_0x2c81c4}=_0x40421a;if(!_0x56a738||!_0x2c81c4)return!![];const _0x1dc99e=_0x56a738[_0x20397b(0xa0)](_0x325640),_0x215b2e=_0x56a738[_0x20397b(0xa0)](_0x48c5b5);if(_0x1dc99e===-0x1||_0x215b2e===-0x1)return!![];const _0x3e8ffa=_0x2c81c4[_0x1dc99e][_0x215b2e]>0x0||_0x2c81c4[_0x215b2e][_0x1dc99e]>0x0;return _0x3e8ffa;}catch(_0x3252b5){return _0x1b2451['log']['warn'](_0x20397b(0xcc)+_0x3252b5['message']),!![];}}function calculateSleepProbability(_0x535dbe){const _0x2205b7=a2_0xb4f78a,_0x17535d=new Date(),_0x2c3718=_0x17535d[_0x2205b7(0xbd)](),_0x2b9b3b=_0x535dbe['toLowerCase']();let _0x5dbf8c=0.1;if(_0x2c3718>=0x17||_0x2c3718<=0x6)_0x5dbf8c=0x1;else{if(_0x2c3718>=0xd&&_0x2c3718<=0xf)_0x5dbf8c=0.8;else{if(_0x2c3718>=0x14&&_0x2c3718<=0x17)_0x5dbf8c=0.4;}}let _0x1e2da8=0.1;if(_0x2b9b3b[_0x2205b7(0xb7)](_0x2205b7(0x91))||_0x2b9b3b[_0x2205b7(0xb7)](_0x2205b7(0xba)))_0x1e2da8=0x1;else{if(_0x2b9b3b[_0x2205b7(0xb7)](_0x2205b7(0xb1))||_0x2b9b3b[_0x2205b7(0xb7)]('living')||_0x2b9b3b[_0x2205b7(0xb7)](_0x2205b7(0xa6)))_0x1e2da8=0.6;else{if(_0x2b9b3b[_0x2205b7(0xb7)](_0x2205b7(0xcd))||_0x2b9b3b['includes']('wc'))_0x1e2da8=0.05;}}let _0x13c9c1=0.5;const _0x276c21=_0x1e2da8*0.5+_0x5dbf8c*0.3+_0x13c9c1*0.2;return parseFloat(_0x276c21['toFixed'](0x2));}async function updateLocation(_0x1b7c12,_0xf4c003){const _0x1541e3=a2_0xb4f78a;if(!_0xf4c003||_0xf4c003===_0x1541e3(0xae))return;if(!await isActive(_0x1b7c12)){resetTimer(_0x1b7c12);return;}if(currentMonitoredRoom&&currentMonitoredRoom!==_0xf4c003){const _0x31ea97=await areRoomsConnected(_0x1b7c12,currentMonitoredRoom,_0xf4c003);if(!_0x31ea97){const _0x39c4c1=_0x1541e3(0xc5)+_0xf4c003+_0x1541e3(0xa5)+currentMonitoredRoom+'\x27.';_0x1b7c12[_0x1541e3(0x9f)][_0x1541e3(0xbe)](_0x1541e3(0xcb)+_0x39c4c1+_0x1541e3(0x92)),await _0x1b7c12['setStateAsync'](_0x1541e3(0x9d),{'val':JSON[_0x1541e3(0x9e)]({'room':_0xf4c003,'reason':_0x39c4c1,'timestamp':Date['now']()}),'ack':!![]});return;}resetTimer(_0x1b7c12);}if(!currentMonitoredRoom){await _0x1b7c12[_0x1541e3(0xca)](_0x1541e3(0xa1),{'val':_0xf4c003,'ack':!![]});const _0x2a7099=await loadConfig(_0x1b7c12),_0x55582b=_0xf4c003['toLowerCase']();let _0x4dfa49=_0x2a7099[_0xf4c003]||_0x2a7099[_0x55582b];if(!_0x4dfa49)for(const _0x2c11ac in DEFAULT_TIMEOUTS){if(_0x55582b[_0x1541e3(0xb7)](_0x2c11ac)){_0x4dfa49=DEFAULT_TIMEOUTS[_0x2c11ac];break;}}if(!_0x4dfa49&&_0x2a7099[_0x1541e3(0xb0)])_0x4dfa49=_0x2a7099[_0x1541e3(0xb0)];if(!_0x4dfa49)return;currentMonitoredRoom=_0xf4c003,startTimer(_0x1b7c12,_0x4dfa49,_0xf4c003);}}function startTimer(_0x3bd504,_0x313101,_0x27911c){const _0x1dc256=a2_0xb4f78a;if(activeTimer)clearTimeout(activeTimer);timeoutMs=_0x313101*0x3c*0x3e8,startTime=Date['now'](),alarmStage=0x0;const _0x517f39=calculateSleepProbability(_0x27911c||currentMonitoredRoom),_0x2773e9=_0x517f39>0.65;_0x2773e9?(timeoutMs+=0x5a*0x3c*0x3e8,_0x3bd504['log'][_0x1dc256(0xbe)](_0x1dc256(0xbf)+(_0x517f39*0x64)[_0x1dc256(0xa2)](0x0)+_0x1dc256(0xa9)+currentMonitoredRoom+_0x1dc256(0xc1)),_0x3bd504[_0x1dc256(0xca)](_0x1dc256(0xb4),{'val':!![],'ack':!![]})):_0x3bd504[_0x1dc256(0xca)]('analysis.safety.deadMan.smartSleep',{'val':![],'ack':!![]}),_0x3bd504[_0x1dc256(0xca)](_0x1dc256(0xb5),{'val':_0x517f39,'ack':!![]}),_0x3bd504['log'][_0x1dc256(0xbe)](_0x1dc256(0xac)+currentMonitoredRoom+_0x1dc256(0xaf)+_0x313101+_0x1dc256(0x95)),_0x3bd504[_0x1dc256(0xca)](_0x1dc256(0xce),{'val':'ok','ack':!![]}),activeTimer=setTimeout(()=>triggerPreWarn(_0x3bd504),timeoutMs);}function resetTimer(_0x80f0f2){const _0x5a7a90=a2_0xb4f78a;if(activeTimer)clearTimeout(activeTimer);activeTimer=null,currentMonitoredRoom=null,alarmStage=0x0,_0x80f0f2['setStateAsync'](_0x5a7a90(0xce),{'val':'ok','ack':!![]}),_0x80f0f2[_0x5a7a90(0xca)](_0x5a7a90(0xb4),{'val':![],'ack':!![]}),_0x80f0f2[_0x5a7a90(0xca)](_0x5a7a90(0xb5),{'val':0x0,'ack':!![]});}async function triggerPreWarn(_0x384fa5){const _0xeb82e4=a2_0xb4f78a;alarmStage=0x1,await _0x384fa5['setStateAsync'](_0xeb82e4(0xce),{'val':_0xeb82e4(0x99),'ack':!![]});const _0x32e86f=_0xeb82e4(0x96)+currentMonitoredRoom+_0xeb82e4(0xc2);_0x384fa5[_0xeb82e4(0x9f)][_0xeb82e4(0xc7)](_0xeb82e4(0xcb)+_0x32e86f),await setup[_0xeb82e4(0x9c)](_0x384fa5,_0xeb82e4(0xb2)+_0x32e86f),activeTimer=setTimeout(()=>triggerAlarm(_0x384fa5),0x5*0x3c*0x3e8);}async function triggerAlarm(_0x49c08e){const _0x132974=a2_0xb4f78a;alarmStage=0x2,await _0x49c08e[_0x132974(0xca)]('analysis.safety.deadMan.alarmState',{'val':_0x132974(0xcf),'ack':!![]});const _0x174351=_0x132974(0xb3)+currentMonitoredRoom+'!';_0x49c08e[_0x132974(0x9f)][_0x132974(0xbc)](_0x132974(0xcb)+_0x174351),await setup['sendNotification'](_0x49c08e,_0x174351,![],!![]);}module[a2_0xb4f78a(0xb9)]={'updateLocation':updateLocation};