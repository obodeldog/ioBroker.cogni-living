const a2_0x4cf58b=a2_0x3376;(function(_0x90457a,_0x1f80ed){const _0x4efe7d=a2_0x3376,_0x22a9a5=_0x90457a();while(!![]){try{const _0x11b05e=parseInt(_0x4efe7d(0x175))/0x1*(-parseInt(_0x4efe7d(0x186))/0x2)+-parseInt(_0x4efe7d(0x176))/0x3+parseInt(_0x4efe7d(0x157))/0x4*(-parseInt(_0x4efe7d(0x16d))/0x5)+parseInt(_0x4efe7d(0x151))/0x6*(parseInt(_0x4efe7d(0x15c))/0x7)+-parseInt(_0x4efe7d(0x170))/0x8+parseInt(_0x4efe7d(0x14f))/0x9*(-parseInt(_0x4efe7d(0x16f))/0xa)+-parseInt(_0x4efe7d(0x179))/0xb*(-parseInt(_0x4efe7d(0x167))/0xc);if(_0x11b05e===_0x1f80ed)break;else _0x22a9a5['push'](_0x22a9a5['shift']());}catch(_0x1873c8){_0x22a9a5['push'](_0x22a9a5['shift']());}}}(a2_0x4ca7,0xded22));const a2_0x29b572=(function(){let _0x193d9c=!![];return function(_0x4255cc,_0x597845){const _0x4bfa7e=_0x193d9c?function(){const _0x29f0d7=a2_0x3376;if(_0x597845){const _0x35b228=_0x597845[_0x29f0d7(0x185)](_0x4255cc,arguments);return _0x597845=null,_0x35b228;}}:function(){};return _0x193d9c=![],_0x4bfa7e;};}()),a2_0x3b6880=a2_0x29b572(this,function(){const _0xdfe098=a2_0x3376;return a2_0x3b6880[_0xdfe098(0x17e)]()[_0xdfe098(0x15a)](_0xdfe098(0x163))[_0xdfe098(0x17e)]()[_0xdfe098(0x16b)](a2_0x3b6880)[_0xdfe098(0x15a)](_0xdfe098(0x163));});a2_0x3b6880();'use strict';const setup=require(a2_0x4cf58b(0x187));function a2_0x3376(_0x3a3b00,_0x48bf29){const _0x3f4dc0=a2_0x4ca7();return a2_0x3376=function(_0x3b6880,_0x29b572){_0x3b6880=_0x3b6880-0x14c;let _0x4ca73a=_0x3f4dc0[_0x3b6880];return _0x4ca73a;},a2_0x3376(_0x3a3b00,_0x48bf29);}let activeTimer=null,currentMonitoredRoom=null,timeoutMs=0x0,startTime=0x0,alarmStage=0x0;const DEFAULT_TIMEOUTS={'bad':0x2d,'bath':0x2d,'toilet':0x1e,'wc':0x1e,'keller':0x3c,'schlaf':0x78,'bed':0x78,'guest':0x5a,'gast':0x5a};function getTimeoutRobust(_0x2d5768,_0x50bdd7){const _0x2251dc=a2_0x4cf58b;if(!_0x2d5768||!_0x50bdd7)return undefined;if(_0x2d5768[_0x50bdd7])return _0x2d5768[_0x50bdd7];const _0x228e37=_0x50bdd7[_0x2251dc(0x161)]()[_0x2251dc(0x14e)](/[^a-z0-9]/g,'');for(const _0x254c41 in _0x2d5768){const _0x21c26a=_0x254c41[_0x2251dc(0x161)]()[_0x2251dc(0x14e)](/[^a-z0-9]/g,'');if(_0x21c26a===_0x228e37)return _0x2d5768[_0x254c41];}const _0x47f68d=_0x50bdd7[_0x2251dc(0x161)]();if(_0x2d5768[_0x47f68d])return _0x2d5768[_0x47f68d];return undefined;}async function loadConfig(_0xe2d1f6){const _0x2db4c3=a2_0x4cf58b;try{const _0x2ec4c9=await _0xe2d1f6[_0x2db4c3(0x158)](_0x2db4c3(0x17a));if(_0x2ec4c9&&_0x2ec4c9['val'])return JSON[_0x2db4c3(0x150)](_0x2ec4c9[_0x2db4c3(0x182)]);}catch(_0x582024){}return{};}async function isActive(_0x5428b6){const _0x324349=a2_0x4cf58b;try{const _0x4ba73f=await _0x5428b6[_0x324349(0x158)](_0x324349(0x14c));return _0x4ba73f&&_0x4ba73f[_0x324349(0x182)];}catch(_0x4d2bc7){return![];}}async function areRoomsConnected(_0x464837,_0x2d02b3,_0x115743){const _0x155bdb=a2_0x4cf58b;try{const _0x591b3a=await _0x464837[_0x155bdb(0x158)](_0x155bdb(0x156));if(!_0x591b3a||!_0x591b3a[_0x155bdb(0x182)])return!![];const _0x4141df=JSON[_0x155bdb(0x150)](_0x591b3a['val']),{rooms:_0x46efbb,matrix:_0x381694}=_0x4141df;if(!_0x46efbb||!_0x381694)return!![];const _0x5c44ac=_0x46efbb['indexOf'](_0x2d02b3),_0x506a9b=_0x46efbb['indexOf'](_0x115743);if(_0x5c44ac===-0x1||_0x506a9b===-0x1)return!![];const _0x12aaf8=_0x381694[_0x5c44ac][_0x506a9b]>0x0||_0x381694[_0x506a9b][_0x5c44ac]>0x0;return _0x12aaf8;}catch(_0x52d1ea){return _0x464837[_0x155bdb(0x15e)][_0x155bdb(0x17b)](_0x155bdb(0x169)+_0x52d1ea[_0x155bdb(0x181)]),!![];}}function calculateSleepProbability(_0x2f9ef7){const _0x5659da=a2_0x4cf58b,_0x1af60c=new Date(),_0x1ee978=_0x1af60c[_0x5659da(0x17f)](),_0xd543dc=_0x2f9ef7[_0x5659da(0x161)]();let _0x34c524=0.1;if(_0x1ee978>=0x17||_0x1ee978<=0x6)_0x34c524=0x1;else{if(_0x1ee978>=0xd&&_0x1ee978<=0xf)_0x34c524=0.8;else{if(_0x1ee978>=0x14&&_0x1ee978<=0x17)_0x34c524=0.4;}}let _0x53a054=0.1;if(_0xd543dc['includes']('schlaf')||_0xd543dc['includes'](_0x5659da(0x16a)))_0x53a054=0x1;else{if(_0xd543dc[_0x5659da(0x184)](_0x5659da(0x152))||_0xd543dc[_0x5659da(0x184)](_0x5659da(0x15b))||_0xd543dc['includes'](_0x5659da(0x14d)))_0x53a054=0.6;else{if(_0xd543dc['includes'](_0x5659da(0x166))||_0xd543dc['includes']('wc'))_0x53a054=0.05;}}let _0x2eff04=0.5;const _0xa6335d=_0x53a054*0.5+_0x34c524*0.3+_0x2eff04*0.2;return parseFloat(_0xa6335d['toFixed'](0x2));}async function updateLocation(_0x3d186e,_0xf30ba6){const _0x34bbf6=a2_0x4cf58b;if(!_0xf30ba6||_0xf30ba6===_0x34bbf6(0x174))return;if(!await isActive(_0x3d186e)){resetTimer(_0x3d186e);return;}if(currentMonitoredRoom&&currentMonitoredRoom!==_0xf30ba6){const _0x3174f5=await areRoomsConnected(_0x3d186e,currentMonitoredRoom,_0xf30ba6);if(!_0x3174f5){const _0x2ac487='Ignoriere\x20Bewegung\x20in\x20\x27'+_0xf30ba6+_0x34bbf6(0x15d)+currentMonitoredRoom+'\x27.';_0x3d186e[_0x34bbf6(0x15e)][_0x34bbf6(0x17c)]('[DeadMan]\x20'+_0x2ac487+_0x34bbf6(0x16c)),await _0x3d186e[_0x34bbf6(0x180)]('analysis.safety.deadMan.lastIgnored',{'val':JSON['stringify']({'room':_0xf30ba6,'reason':_0x2ac487,'timestamp':Date['now']()}),'ack':!![]});return;}resetTimer(_0x3d186e);}if(!currentMonitoredRoom){await _0x3d186e[_0x34bbf6(0x180)](_0x34bbf6(0x165),{'val':_0xf30ba6,'ack':!![]});const _0x20354d=await loadConfig(_0x3d186e);let _0x361648=getTimeoutRobust(_0x20354d,_0xf30ba6);const _0x57437a=_0xf30ba6[_0x34bbf6(0x161)]();if(!_0x361648)for(const _0x53fbe4 in DEFAULT_TIMEOUTS){if(_0x57437a['includes'](_0x53fbe4)){_0x361648=DEFAULT_TIMEOUTS[_0x53fbe4];break;}}if(!_0x361648&&_0x20354d[_0x34bbf6(0x177)])_0x361648=_0x20354d['default'];if(!_0x361648)return;currentMonitoredRoom=_0xf30ba6,startTimer(_0x3d186e,_0x361648,_0xf30ba6);}}function a2_0x4ca7(){const _0x54dbf8=['\x27.\x20Nicht\x20verbunden\x20mit\x20Ã¼berwachtem\x20\x27','log','â³\x20ACHTUNG:\x20UngewÃ¶hnlich\x20lange\x20InaktivitÃ¤t\x20in\x20','analysis.safety.deadMan.napProbability','toLowerCase','\x20fÃ¼r\x20','(((.+)+)+)+$','now','analysis.safety.deadMan.currentRoom','bad','27446472XIRMRI','analysis.safety.deadMan.alarmState','[DeadMan]\x20Topology\x20check\x20failed:\x20','bed','constructor','\x20(Multi-Person\x20Filter)','290nLHoGe','[DeadMan]\x20','10HxPCqX','3206824GJzUpR','sendNotification','ðŸ’¤\x20Smart\x20Sleep\x20erkannt\x20(','exports','Unknown','192154DNnkeO','2025723uJanMh','default','ðŸ‘¼\x20Schutzengel-Frage:\x20','22LmmLqs','analysis.safety.deadMan.config','warn','info','toFixed','toString','getHours','setStateAsync','message','val','\x20Min.','includes','apply','18PfTAit','./setup','analysis.safety.deadMan.active','sofa','replace','8419401fdXIME','parse','5168862HwuHSm','wohn','analysis.safety.deadMan.smartSleep','alarm','.\x20Alles\x20in\x20Ordnung?','analysis.topology.structure','53948EEWKnb','getStateAsync','ðŸ‘¼\x20Schutzengel:\x20Ãœberwache\x20','search','living','7plbRwA'];a2_0x4ca7=function(){return _0x54dbf8;};return a2_0x4ca7();}function startTimer(_0x27900e,_0x274342,_0x2b60f4){const _0x219d38=a2_0x4cf58b;if(activeTimer)clearTimeout(activeTimer);timeoutMs=_0x274342*0x3c*0x3e8,startTime=Date[_0x219d38(0x164)](),alarmStage=0x0;const _0x3dfc54=calculateSleepProbability(_0x2b60f4||currentMonitoredRoom),_0x4b79b1=_0x3dfc54>0.65;_0x4b79b1?(timeoutMs+=0x5a*0x3c*0x3e8,_0x27900e[_0x219d38(0x15e)][_0x219d38(0x17c)](_0x219d38(0x172)+(_0x3dfc54*0x64)[_0x219d38(0x17d)](0x0)+'%).\x20VerlÃ¤ngere\x20Timer\x20fÃ¼r\x20'+currentMonitoredRoom+'\x20um\x2090\x20Min.'),_0x27900e[_0x219d38(0x180)](_0x219d38(0x153),{'val':!![],'ack':!![]})):_0x27900e[_0x219d38(0x180)](_0x219d38(0x153),{'val':![],'ack':!![]}),_0x27900e[_0x219d38(0x180)](_0x219d38(0x160),{'val':_0x3dfc54,'ack':!![]}),_0x27900e[_0x219d38(0x15e)]['info'](_0x219d38(0x159)+currentMonitoredRoom+_0x219d38(0x162)+_0x274342+_0x219d38(0x183)),_0x27900e['setStateAsync'](_0x219d38(0x168),{'val':'ok','ack':!![]}),activeTimer=setTimeout(()=>triggerPreWarn(_0x27900e),timeoutMs);}function resetTimer(_0x50ae67){const _0x31f00b=a2_0x4cf58b;if(activeTimer)clearTimeout(activeTimer);activeTimer=null,currentMonitoredRoom=null,alarmStage=0x0,_0x50ae67['setStateAsync'](_0x31f00b(0x168),{'val':'ok','ack':!![]}),_0x50ae67[_0x31f00b(0x180)]('analysis.safety.deadMan.smartSleep',{'val':![],'ack':!![]}),_0x50ae67[_0x31f00b(0x180)](_0x31f00b(0x160),{'val':0x0,'ack':!![]});}async function triggerPreWarn(_0x3df61c){const _0x4a33d3=a2_0x4cf58b;alarmStage=0x1,await _0x3df61c['setStateAsync'](_0x4a33d3(0x168),{'val':'pre_warn','ack':!![]});const _0x1e9a57=_0x4a33d3(0x15f)+currentMonitoredRoom+_0x4a33d3(0x155);_0x3df61c[_0x4a33d3(0x15e)][_0x4a33d3(0x17b)](_0x4a33d3(0x16e)+_0x1e9a57),await setup[_0x4a33d3(0x171)](_0x3df61c,_0x4a33d3(0x178)+_0x1e9a57),activeTimer=setTimeout(()=>triggerAlarm(_0x3df61c),0x5*0x3c*0x3e8);}async function triggerAlarm(_0x44c3db){const _0x171e6e=a2_0x4cf58b;alarmStage=0x2,await _0x44c3db[_0x171e6e(0x180)](_0x171e6e(0x168),{'val':_0x171e6e(0x154),'ack':!![]});const _0x1fc839='ðŸš¨\x20NOTFALL-ALARM:\x20Person\x20reagiert\x20nicht\x20in\x20'+currentMonitoredRoom+'!';_0x44c3db[_0x171e6e(0x15e)]['error'](_0x171e6e(0x16e)+_0x1fc839),await setup[_0x171e6e(0x171)](_0x44c3db,_0x1fc839,![],!![]);}module[a2_0x4cf58b(0x173)]={'updateLocation':updateLocation};