const a2_0x27b9e0=a2_0x50a0;(function(_0x4e14b9,_0x575611){const _0x4ebc43=a2_0x50a0,_0x2cf94d=_0x4e14b9();while(!![]){try{const _0x5c101b=parseInt(_0x4ebc43(0x135))/0x1*(parseInt(_0x4ebc43(0x116))/0x2)+parseInt(_0x4ebc43(0x138))/0x3+parseInt(_0x4ebc43(0x123))/0x4*(parseInt(_0x4ebc43(0x12f))/0x5)+parseInt(_0x4ebc43(0x12e))/0x6+-parseInt(_0x4ebc43(0x12c))/0x7*(-parseInt(_0x4ebc43(0x133))/0x8)+-parseInt(_0x4ebc43(0x111))/0x9+parseInt(_0x4ebc43(0x122))/0xa*(-parseInt(_0x4ebc43(0x139))/0xb);if(_0x5c101b===_0x575611)break;else _0x2cf94d['push'](_0x2cf94d['shift']());}catch(_0x2840a1){_0x2cf94d['push'](_0x2cf94d['shift']());}}}(a2_0x3e73,0x6248a));function a2_0x3e73(){const _0x28401e=['now','(((.+)+)+)+$','[DeadMan]\x20','val','message','alarm','3520oblKtT','3624xokLPz','analysis.topology.structure','ðŸ‘¼\x20Schutzengel-Frage:\x20','includes','sendNotification','stringify','\x27.\x20Nicht\x20verbunden\x20mit\x20Ã¼berwachtem\x20\x27','./setup','analysis.safety.deadMan.active','7ZyTOvJ','analysis.safety.deadMan.config','3489426kmKTZx','865NNfUZM','analysis.safety.deadMan.alarmState','\x20Min.','\x20fÃ¼r\x20','1477496VWeURb','setStateAsync','79277poTdKR','Unknown','default','1170486FvXucs','27687zjHYMO','info','constructor','getStateAsync','pre_warn','exports','1648422rCNdoa','parse','warn','ðŸ‘¼\x20Schutzengel:\x20Ãœberwache\x20','toLowerCase','4buxfWi','search','toString','ðŸš¨\x20NOTFALL-ALARM:\x20Person\x20reagiert\x20nicht\x20in\x20','â³\x20ACHTUNG:\x20UngewÃ¶hnlich\x20lange\x20InaktivitÃ¤t\x20in\x20','log'];a2_0x3e73=function(){return _0x28401e;};return a2_0x3e73();}const a2_0x1a0134=(function(){let _0x11313f=!![];return function(_0x4852a4,_0x57b91d){const _0x4060fe=_0x11313f?function(){if(_0x57b91d){const _0x38cd59=_0x57b91d['apply'](_0x4852a4,arguments);return _0x57b91d=null,_0x38cd59;}}:function(){};return _0x11313f=![],_0x4060fe;};}()),a2_0x20723=a2_0x1a0134(this,function(){const _0x40392c=a2_0x50a0;return a2_0x20723[_0x40392c(0x118)]()[_0x40392c(0x117)](_0x40392c(0x11d))[_0x40392c(0x118)]()[_0x40392c(0x10d)](a2_0x20723)['search'](_0x40392c(0x11d));});a2_0x20723();'use strict';const setup=require(a2_0x27b9e0(0x12a));let activeTimer=null,currentMonitoredRoom=null,timeoutMs=0x0,startTime=0x0,alarmStage=0x0;const DEFAULT_TIMEOUTS={'bad':0x2d,'bath':0x2d,'toilet':0x1e,'wc':0x1e,'keller':0x3c};async function loadConfig(_0x137c66){const _0x233f54=a2_0x27b9e0;try{const _0x320d04=await _0x137c66['getStateAsync'](_0x233f54(0x12d));if(_0x320d04&&_0x320d04[_0x233f54(0x11f)])return JSON[_0x233f54(0x112)](_0x320d04[_0x233f54(0x11f)]);}catch(_0x422763){}return{};}async function isActive(_0x411a9d){const _0x45add7=a2_0x27b9e0;try{const _0xca9709=await _0x411a9d[_0x45add7(0x10e)](_0x45add7(0x12b));return _0xca9709&&_0xca9709[_0x45add7(0x11f)];}catch(_0x29557a){return![];}}async function areRoomsConnected(_0x289efd,_0x10e660,_0x186fdb){const _0x168503=a2_0x27b9e0;try{const _0xe08230=await _0x289efd[_0x168503(0x10e)](_0x168503(0x124));if(!_0xe08230||!_0xe08230[_0x168503(0x11f)])return!![];const _0x53416c=JSON[_0x168503(0x112)](_0xe08230[_0x168503(0x11f)]),{rooms:_0x1e10b4,matrix:_0x259e3d}=_0x53416c;if(!_0x1e10b4||!_0x259e3d)return!![];const _0x30fe62=_0x1e10b4['indexOf'](_0x10e660),_0x1de48e=_0x1e10b4['indexOf'](_0x186fdb);if(_0x30fe62===-0x1||_0x1de48e===-0x1)return!![];const _0x3f5901=_0x259e3d[_0x30fe62][_0x1de48e]>0x0||_0x259e3d[_0x1de48e][_0x30fe62]>0x0;return _0x3f5901;}catch(_0x342238){return _0x289efd[_0x168503(0x11b)][_0x168503(0x113)]('[DeadMan]\x20Topology\x20check\x20failed:\x20'+_0x342238[_0x168503(0x120)]),!![];}}function a2_0x50a0(_0x2a1172,_0x5414e5){const _0x45873e=a2_0x3e73();return a2_0x50a0=function(_0x20723,_0x1a0134){_0x20723=_0x20723-0x10d;let _0x3e7387=_0x45873e[_0x20723];return _0x3e7387;},a2_0x50a0(_0x2a1172,_0x5414e5);}async function updateLocation(_0x198ec3,_0x3bee7e){const _0x706558=a2_0x27b9e0;if(!_0x3bee7e||_0x3bee7e===_0x706558(0x136))return;if(!await isActive(_0x198ec3)){resetTimer(_0x198ec3);return;}if(currentMonitoredRoom&&currentMonitoredRoom!==_0x3bee7e){const _0x35e9af=await areRoomsConnected(_0x198ec3,currentMonitoredRoom,_0x3bee7e);if(!_0x35e9af){const _0x528901='Ignoriere\x20Bewegung\x20in\x20\x27'+_0x3bee7e+_0x706558(0x129)+currentMonitoredRoom+'\x27.';_0x198ec3[_0x706558(0x11b)][_0x706558(0x13a)](_0x706558(0x11e)+_0x528901+'\x20(Multi-Person\x20Filter)'),await _0x198ec3[_0x706558(0x134)]('analysis.safety.deadMan.lastIgnored',{'val':JSON[_0x706558(0x128)]({'room':_0x3bee7e,'reason':_0x528901,'timestamp':Date[_0x706558(0x11c)]()}),'ack':!![]});return;}resetTimer(_0x198ec3);}if(!currentMonitoredRoom){await _0x198ec3[_0x706558(0x134)]('analysis.safety.deadMan.currentRoom',{'val':_0x3bee7e,'ack':!![]});const _0x29a3cb=await loadConfig(_0x198ec3),_0x1ceb1b=_0x3bee7e[_0x706558(0x115)]();let _0x43085c=_0x29a3cb[_0x3bee7e]||_0x29a3cb[_0x1ceb1b];if(!_0x43085c)for(const _0x25f09e in DEFAULT_TIMEOUTS){if(_0x1ceb1b[_0x706558(0x126)](_0x25f09e)){_0x43085c=DEFAULT_TIMEOUTS[_0x25f09e];break;}}if(!_0x43085c&&_0x29a3cb['default'])_0x43085c=_0x29a3cb[_0x706558(0x137)];if(!_0x43085c)return;currentMonitoredRoom=_0x3bee7e,startTimer(_0x198ec3,_0x43085c);}}function startTimer(_0xb9eb7a,_0x18bc34){const _0x4229ad=a2_0x27b9e0;if(activeTimer)clearTimeout(activeTimer);timeoutMs=_0x18bc34*0x3c*0x3e8,startTime=Date[_0x4229ad(0x11c)](),alarmStage=0x0,_0xb9eb7a['log']['info'](_0x4229ad(0x114)+currentMonitoredRoom+_0x4229ad(0x132)+_0x18bc34+_0x4229ad(0x131)),_0xb9eb7a[_0x4229ad(0x134)](_0x4229ad(0x130),{'val':'ok','ack':!![]}),activeTimer=setTimeout(()=>triggerPreWarn(_0xb9eb7a),timeoutMs);}function resetTimer(_0x5adbae){const _0x3129f5=a2_0x27b9e0;if(activeTimer)clearTimeout(activeTimer);activeTimer=null,currentMonitoredRoom=null,alarmStage=0x0,_0x5adbae[_0x3129f5(0x134)](_0x3129f5(0x130),{'val':'ok','ack':!![]});}async function triggerPreWarn(_0x773c88){const _0x5df238=a2_0x27b9e0;alarmStage=0x1,await _0x773c88[_0x5df238(0x134)](_0x5df238(0x130),{'val':_0x5df238(0x10f),'ack':!![]});const _0x456f04=_0x5df238(0x11a)+currentMonitoredRoom+'.\x20Alles\x20in\x20Ordnung?';_0x773c88['log']['warn'](_0x5df238(0x11e)+_0x456f04),await setup[_0x5df238(0x127)](_0x773c88,_0x5df238(0x125)+_0x456f04),activeTimer=setTimeout(()=>triggerAlarm(_0x773c88),0x5*0x3c*0x3e8);}async function triggerAlarm(_0x281806){const _0x16b6c1=a2_0x27b9e0;alarmStage=0x2,await _0x281806[_0x16b6c1(0x134)](_0x16b6c1(0x130),{'val':_0x16b6c1(0x121),'ack':!![]});const _0x58cfc4=_0x16b6c1(0x119)+currentMonitoredRoom+'!';_0x281806[_0x16b6c1(0x11b)]['error'](_0x16b6c1(0x11e)+_0x58cfc4),await setup[_0x16b6c1(0x127)](_0x281806,_0x58cfc4,![],!![]);}module[a2_0x27b9e0(0x110)]={'updateLocation':updateLocation};