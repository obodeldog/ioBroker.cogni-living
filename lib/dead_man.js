const a2_0x5d945b=a2_0x3453;function a2_0x25a8(){const _0x14bc0e=['toLowerCase','.\x20Alles\x20in\x20Ordnung?','analysis.safety.deadMan.config','ðŸš¨\x20NOTFALL-ALARM:\x20Person\x20reagiert\x20nicht\x20in\x20','30TqzjmD','constructor','now','alarm','(((.+)+)+)+$','Unknown','ðŸ‘¼\x20Schutzengel:\x20Ãœberwache\x20','436539xVVgQw','schlaf','log','wohn','analysis.topology.structure','\x20fÃ¼r\x20','analysis.safety.deadMan.smartSleep','analysis.safety.deadMan.alarmState','sendNotification','parse','4798764WITwhn','pre_warn','2943465hYzyRF','getHours','\x20(Multi-Person\x20Filter)','toString','warn','includes','%).\x20VerlÃ¤ngere\x20Timer\x20fÃ¼r\x20','\x20um\x2090\x20Min.','info','error','16YiGUOC','toFixed','[DeadMan]\x20','indexOf','analysis.safety.deadMan.currentRoom','682262jTKjfk','sofa','40GzTYxu','bad','15661340AIccKo','analysis.safety.deadMan.napProbability','replace','setStateAsync','\x20Min.','default','analysis.safety.deadMan.active','ðŸ’¤\x20Smart\x20Sleep\x20erkannt\x20(','val','stringify','getStateAsync','exports','1240186lEkcZY','living','ðŸ‘¼\x20Schutzengel-Frage:\x20','[DeadMan]\x20Topology\x20check\x20failed:\x20','search','762424pSgUQz','Ignoriere\x20Bewegung\x20in\x20\x27'];a2_0x25a8=function(){return _0x14bc0e;};return a2_0x25a8();}(function(_0x2fb815,_0x28d373){const _0x2fe4ab=a2_0x3453,_0x1f7c17=_0x2fb815();while(!![]){try{const _0x1b5017=-parseInt(_0x2fe4ab(0x80))/0x1+parseInt(_0x2fe4ab(0x7b))/0x2+-parseInt(_0x2fe4ab(0x8d))/0x3*(-parseInt(_0x2fe4ab(0xaa))/0x4)+-parseInt(_0x2fe4ab(0x99))/0x5+-parseInt(_0x2fe4ab(0x86))/0x6*(parseInt(_0x2fe4ab(0xa8))/0x7)+-parseInt(_0x2fe4ab(0xa3))/0x8*(parseInt(_0x2fe4ab(0x97))/0x9)+parseInt(_0x2fe4ab(0x6f))/0xa;if(_0x1b5017===_0x28d373)break;else _0x1f7c17['push'](_0x1f7c17['shift']());}catch(_0x594f42){_0x1f7c17['push'](_0x1f7c17['shift']());}}}(a2_0x25a8,0xb3d06));const a2_0x2d9dcb=(function(){let _0x11aaab=!![];return function(_0x39128b,_0x3190c6){const _0x45f255=_0x11aaab?function(){if(_0x3190c6){const _0x8bbf54=_0x3190c6['apply'](_0x39128b,arguments);return _0x3190c6=null,_0x8bbf54;}}:function(){};return _0x11aaab=![],_0x45f255;};}()),a2_0x20c09f=a2_0x2d9dcb(this,function(){const _0x4cf79a=a2_0x3453;return a2_0x20c09f[_0x4cf79a(0x9c)]()[_0x4cf79a(0x7f)]('(((.+)+)+)+$')[_0x4cf79a(0x9c)]()[_0x4cf79a(0x87)](a2_0x20c09f)['search'](_0x4cf79a(0x8a));});a2_0x20c09f();'use strict';const setup=require('./setup');let activeTimer=null,currentMonitoredRoom=null,timeoutMs=0x0,startTime=0x0,alarmStage=0x0;const DEFAULT_TIMEOUTS={'bad':0x2d,'bath':0x2d,'toilet':0x1e,'wc':0x1e,'keller':0x3c,'schlaf':0x78,'bed':0x78,'guest':0x5a,'gast':0x5a};function getTimeoutRobust(_0x4b0c77,_0x452fc1){const _0x46e7d7=a2_0x3453;if(!_0x4b0c77||!_0x452fc1)return undefined;if(_0x4b0c77[_0x452fc1])return _0x4b0c77[_0x452fc1];const _0x4ad460=_0x452fc1[_0x46e7d7(0x82)]()[_0x46e7d7(0x71)](/[^a-z0-9]/g,'');for(const _0x1808a8 in _0x4b0c77){const _0x11b3cd=_0x1808a8[_0x46e7d7(0x82)]()['replace'](/[^a-z0-9]/g,'');if(_0x11b3cd===_0x4ad460)return _0x4b0c77[_0x1808a8];}const _0x3126ca=_0x452fc1['toLowerCase']();if(_0x4b0c77[_0x3126ca])return _0x4b0c77[_0x3126ca];return undefined;}async function loadConfig(_0x285ce2){const _0x3cdc54=a2_0x3453;try{const _0x30f602=await _0x285ce2['getStateAsync'](_0x3cdc54(0x84));if(_0x30f602&&_0x30f602['val'])return JSON[_0x3cdc54(0x96)](_0x30f602[_0x3cdc54(0x77)]);}catch(_0x1e3819){}return{};}async function isActive(_0x3b1219){const _0x5954d7=a2_0x3453;try{const _0x40d8f0=await _0x3b1219[_0x5954d7(0x79)](_0x5954d7(0x75));return _0x40d8f0&&_0x40d8f0[_0x5954d7(0x77)];}catch(_0x1ee99a){return![];}}async function areRoomsConnected(_0xf78937,_0x438620,_0x17eab3){const _0x3e8da2=a2_0x3453;try{const _0x51b800=await _0xf78937[_0x3e8da2(0x79)](_0x3e8da2(0x91));if(!_0x51b800||!_0x51b800[_0x3e8da2(0x77)])return!![];const _0x5cfd4c=JSON[_0x3e8da2(0x96)](_0x51b800['val']),{rooms:_0x2432c3,matrix:_0xb53143}=_0x5cfd4c;if(!_0x2432c3||!_0xb53143)return!![];const _0xcc8e83=_0x2432c3[_0x3e8da2(0xa6)](_0x438620),_0x216736=_0x2432c3[_0x3e8da2(0xa6)](_0x17eab3);if(_0xcc8e83===-0x1||_0x216736===-0x1)return!![];const _0x4e0d88=_0xb53143[_0xcc8e83][_0x216736]>0x0||_0xb53143[_0x216736][_0xcc8e83]>0x0;return _0x4e0d88;}catch(_0x28b949){return _0xf78937[_0x3e8da2(0x8f)][_0x3e8da2(0x9d)](_0x3e8da2(0x7e)+_0x28b949['message']),!![];}}function calculateSleepProbability(_0x1e359e){const _0x332691=a2_0x3453,_0xb7920c=new Date(),_0x5d770b=_0xb7920c[_0x332691(0x9a)](),_0x54a748=_0x1e359e[_0x332691(0x82)]();let _0x5c3f8f=0.1;if(_0x5d770b>=0x17||_0x5d770b<=0x6)_0x5c3f8f=0x1;else{if(_0x5d770b>=0xd&&_0x5d770b<=0xf)_0x5c3f8f=0.8;else{if(_0x5d770b>=0x14&&_0x5d770b<=0x17)_0x5c3f8f=0.4;}}let _0x48144f=0.1;if(_0x54a748[_0x332691(0x9e)](_0x332691(0x8e))||_0x54a748['includes']('bed'))_0x48144f=0x1;else{if(_0x54a748[_0x332691(0x9e)](_0x332691(0x90))||_0x54a748[_0x332691(0x9e)](_0x332691(0x7c))||_0x54a748[_0x332691(0x9e)](_0x332691(0xa9)))_0x48144f=0.6;else{if(_0x54a748['includes'](_0x332691(0x6e))||_0x54a748[_0x332691(0x9e)]('wc'))_0x48144f=0.05;}}let _0x5744ec=0.5;const _0x234057=_0x48144f*0.5+_0x5c3f8f*0.3+_0x5744ec*0.2;return parseFloat(_0x234057[_0x332691(0xa4)](0x2));}async function updateLocation(_0x43a6fe,_0x37acaf){const _0x58cb5a=a2_0x3453;if(!_0x37acaf||_0x37acaf===_0x58cb5a(0x8b))return;if(!await isActive(_0x43a6fe)){resetTimer(_0x43a6fe);return;}if(currentMonitoredRoom&&currentMonitoredRoom!==_0x37acaf){const _0x175587=await areRoomsConnected(_0x43a6fe,currentMonitoredRoom,_0x37acaf);if(!_0x175587){const _0x15ddd2=_0x58cb5a(0x81)+_0x37acaf+'\x27.\x20Nicht\x20verbunden\x20mit\x20Ã¼berwachtem\x20\x27'+currentMonitoredRoom+'\x27.';_0x43a6fe[_0x58cb5a(0x8f)][_0x58cb5a(0xa1)](_0x58cb5a(0xa5)+_0x15ddd2+_0x58cb5a(0x9b)),await _0x43a6fe[_0x58cb5a(0x72)]('analysis.safety.deadMan.lastIgnored',{'val':JSON[_0x58cb5a(0x78)]({'room':_0x37acaf,'reason':_0x15ddd2,'timestamp':Date[_0x58cb5a(0x88)]()}),'ack':!![]});return;}resetTimer(_0x43a6fe);}if(!currentMonitoredRoom){await _0x43a6fe[_0x58cb5a(0x72)](_0x58cb5a(0xa7),{'val':_0x37acaf,'ack':!![]});const _0x38fe86=await loadConfig(_0x43a6fe);let _0x13d807=getTimeoutRobust(_0x38fe86,_0x37acaf);const _0xd7abea=_0x37acaf['toLowerCase']();if(!_0x13d807)for(const _0x319a50 in DEFAULT_TIMEOUTS){if(_0xd7abea[_0x58cb5a(0x9e)](_0x319a50)){_0x13d807=DEFAULT_TIMEOUTS[_0x319a50];break;}}if(!_0x13d807&&_0x38fe86[_0x58cb5a(0x74)])_0x13d807=_0x38fe86[_0x58cb5a(0x74)];if(!_0x13d807)return;currentMonitoredRoom=_0x37acaf,startTimer(_0x43a6fe,_0x13d807,_0x37acaf);}}function startTimer(_0x4db183,_0x18d932,_0x4a268f){const _0x3a9cc7=a2_0x3453;if(activeTimer)clearTimeout(activeTimer);timeoutMs=_0x18d932*0x3c*0x3e8,startTime=Date[_0x3a9cc7(0x88)](),alarmStage=0x0;const _0x336a03=calculateSleepProbability(_0x4a268f||currentMonitoredRoom),_0x2b2f66=_0x336a03>0.65;_0x2b2f66?(timeoutMs+=0x5a*0x3c*0x3e8,_0x4db183[_0x3a9cc7(0x8f)]['info'](_0x3a9cc7(0x76)+(_0x336a03*0x64)['toFixed'](0x0)+_0x3a9cc7(0x9f)+currentMonitoredRoom+_0x3a9cc7(0xa0)),_0x4db183[_0x3a9cc7(0x72)](_0x3a9cc7(0x93),{'val':!![],'ack':!![]})):_0x4db183['setStateAsync'](_0x3a9cc7(0x93),{'val':![],'ack':!![]}),_0x4db183[_0x3a9cc7(0x72)](_0x3a9cc7(0x70),{'val':_0x336a03,'ack':!![]}),_0x4db183[_0x3a9cc7(0x8f)]['info'](_0x3a9cc7(0x8c)+currentMonitoredRoom+_0x3a9cc7(0x92)+_0x18d932+_0x3a9cc7(0x73)),_0x4db183[_0x3a9cc7(0x72)](_0x3a9cc7(0x94),{'val':'ok','ack':!![]}),activeTimer=setTimeout(()=>triggerPreWarn(_0x4db183),timeoutMs);}function resetTimer(_0x347073){const _0x514a86=a2_0x3453;if(activeTimer)clearTimeout(activeTimer);activeTimer=null,currentMonitoredRoom=null,alarmStage=0x0,_0x347073[_0x514a86(0x72)](_0x514a86(0x94),{'val':'ok','ack':!![]}),_0x347073[_0x514a86(0x72)](_0x514a86(0x93),{'val':![],'ack':!![]}),_0x347073[_0x514a86(0x72)]('analysis.safety.deadMan.napProbability',{'val':0x0,'ack':!![]});}async function triggerPreWarn(_0x2b8156){const _0x141e55=a2_0x3453;alarmStage=0x1,await _0x2b8156[_0x141e55(0x72)](_0x141e55(0x94),{'val':_0x141e55(0x98),'ack':!![]});const _0x22519a='â³\x20ACHTUNG:\x20UngewÃ¶hnlich\x20lange\x20InaktivitÃ¤t\x20in\x20'+currentMonitoredRoom+_0x141e55(0x83);_0x2b8156[_0x141e55(0x8f)]['warn']('[DeadMan]\x20'+_0x22519a),await setup[_0x141e55(0x95)](_0x2b8156,_0x141e55(0x7d)+_0x22519a),activeTimer=setTimeout(()=>triggerAlarm(_0x2b8156),0x5*0x3c*0x3e8);}function a2_0x3453(_0x2762ec,_0x545dba){const _0x362626=a2_0x25a8();return a2_0x3453=function(_0x20c09f,_0x2d9dcb){_0x20c09f=_0x20c09f-0x6e;let _0x25a8bc=_0x362626[_0x20c09f];return _0x25a8bc;},a2_0x3453(_0x2762ec,_0x545dba);}async function triggerAlarm(_0x4a4c14){const _0x5e7fc8=a2_0x3453;alarmStage=0x2,await _0x4a4c14[_0x5e7fc8(0x72)](_0x5e7fc8(0x94),{'val':_0x5e7fc8(0x89),'ack':!![]});const _0x56845a=_0x5e7fc8(0x85)+currentMonitoredRoom+'!';_0x4a4c14[_0x5e7fc8(0x8f)][_0x5e7fc8(0xa2)]('[DeadMan]\x20'+_0x56845a),await setup[_0x5e7fc8(0x95)](_0x4a4c14,_0x56845a,![],!![]);}module[a2_0x5d945b(0x7a)]={'updateLocation':updateLocation};