const a2_0x34cd6c=a2_0x4719;function a2_0x4719(_0xfb8c25,_0x1f629c){const _0x7cd64a=a2_0x20ba();return a2_0x4719=function(_0x2ceb44,_0x3b223a){_0x2ceb44=_0x2ceb44-0x195;let _0x20bafe=_0x7cd64a[_0x2ceb44];return _0x20bafe;},a2_0x4719(_0xfb8c25,_0x1f629c);}(function(_0x52ab2f,_0x45ba40){const _0xfca68e=a2_0x4719,_0x25cbfb=_0x52ab2f();while(!![]){try{const _0x3eb22c=parseInt(_0xfca68e(0x1d1))/0x1*(-parseInt(_0xfca68e(0x1c4))/0x2)+-parseInt(_0xfca68e(0x1a8))/0x3*(-parseInt(_0xfca68e(0x19b))/0x4)+-parseInt(_0xfca68e(0x1b7))/0x5+-parseInt(_0xfca68e(0x198))/0x6*(parseInt(_0xfca68e(0x1af))/0x7)+parseInt(_0xfca68e(0x1a2))/0x8*(parseInt(_0xfca68e(0x1c8))/0x9)+parseInt(_0xfca68e(0x1a3))/0xa*(-parseInt(_0xfca68e(0x1a7))/0xb)+-parseInt(_0xfca68e(0x1c1))/0xc*(-parseInt(_0xfca68e(0x1c6))/0xd);if(_0x3eb22c===_0x45ba40)break;else _0x25cbfb['push'](_0x25cbfb['shift']());}catch(_0x3f06bc){_0x25cbfb['push'](_0x25cbfb['shift']());}}}(a2_0x20ba,0x82bf5));const a2_0x3b223a=(function(){let _0xe7c01a=!![];return function(_0x4cbf12,_0x2ce0ad){const _0x306693=_0xe7c01a?function(){const _0x19ece6=a2_0x4719;if(_0x2ce0ad){const _0x365415=_0x2ce0ad[_0x19ece6(0x1a0)](_0x4cbf12,arguments);return _0x2ce0ad=null,_0x365415;}}:function(){};return _0xe7c01a=![],_0x306693;};}()),a2_0x2ceb44=a2_0x3b223a(this,function(){const _0x453962=a2_0x4719;return a2_0x2ceb44[_0x453962(0x1b1)]()[_0x453962(0x1c5)](_0x453962(0x1b8))[_0x453962(0x1b1)]()[_0x453962(0x1a5)](a2_0x2ceb44)[_0x453962(0x1c5)](_0x453962(0x1b8));});a2_0x2ceb44();'use strict';const setup=require(a2_0x34cd6c(0x1ab));let activeTimer=null,currentMonitoredRoom=null,timeoutMs=0x0,startTime=0x0,alarmStage=0x0;function a2_0x20ba(){const _0x3525af=['error','warn','Unknown','alarm','sofa','bed','11654HAYNwt','now','bad','toLowerCase','5628ZIwelw','ðŸ‘¼\x20Schutzengel-Frage:\x20','analysis.safety.deadMan.alarmState','4BaFoCA','stringify','log','getStateAsync','schlaf','apply','\x20um\x2090\x20Min.','2024iUXvHL','1955270sjYzQy','%).\x20VerlÃ¤ngere\x20Timer\x20fÃ¼r\x20','constructor','ðŸš¨\x20NOTFALL-ALARM:\x20Person\x20reagiert\x20nicht\x20in\x20','55OIUQsp','349386lWaeAI','\x20(Multi-Person\x20Filter)','analysis.safety.deadMan.lastIgnored','./setup','analysis.safety.deadMan.smartSleep','wohn','sendNotification','7931HhNxGz','default','toString','[DeadMan]\x20','analysis.safety.deadMan.config','replace','analysis.safety.deadMan.active','indexOf','78215PFVFiG','(((.+)+)+)+$','toFixed','[DeadMan]\x20Topology\x20check\x20failed:\x20','info','\x20Min.','analysis.safety.deadMan.currentRoom','living','ðŸ’¤\x20Smart\x20Sleep\x20erkannt\x20(','includes','12vhzUjR','analysis.safety.deadMan.napProbability','analysis.topology.structure','58TaYdAl','search','26249119bJQbSg','setStateAsync','28242jfzLma','exports','val'];a2_0x20ba=function(){return _0x3525af;};return a2_0x20ba();}const DEFAULT_TIMEOUTS={'bad':0x2d,'bath':0x2d,'toilet':0x1e,'wc':0x1e,'keller':0x3c,'schlaf':0x78,'bed':0x78,'guest':0x5a,'gast':0x5a};function getTimeoutRobust(_0x4b5f07,_0x5239d7){const _0x2f1d36=a2_0x34cd6c;if(!_0x4b5f07||!_0x5239d7)return undefined;if(_0x4b5f07[_0x5239d7])return _0x4b5f07[_0x5239d7];const _0xe51556=_0x5239d7['toLowerCase']()[_0x2f1d36(0x1b4)](/[^a-z0-9]/g,'');for(const _0x263115 in _0x4b5f07){const _0x4b172c=_0x263115[_0x2f1d36(0x197)]()['replace'](/[^a-z0-9]/g,'');if(_0x4b172c===_0xe51556)return _0x4b5f07[_0x263115];}const _0x5ed76e=_0x5239d7['toLowerCase']();if(_0x4b5f07[_0x5ed76e])return _0x4b5f07[_0x5ed76e];return undefined;}async function loadConfig(_0x5d48be){const _0x38ffa6=a2_0x34cd6c;try{const _0x42cfdb=await _0x5d48be[_0x38ffa6(0x19e)](_0x38ffa6(0x1b3));if(_0x42cfdb&&_0x42cfdb[_0x38ffa6(0x1ca)])return JSON['parse'](_0x42cfdb[_0x38ffa6(0x1ca)]);}catch(_0x1003e7){}return{};}async function isActive(_0x50cf4b){const _0x639b36=a2_0x34cd6c;try{const _0x2312bf=await _0x50cf4b[_0x639b36(0x19e)](_0x639b36(0x1b5));return _0x2312bf&&_0x2312bf['val'];}catch(_0x4e8d38){return![];}}async function areRoomsConnected(_0x263c17,_0xdb0823,_0x1f1980){const _0x23c151=a2_0x34cd6c;try{const _0xb5891e=await _0x263c17[_0x23c151(0x19e)](_0x23c151(0x1c3));if(!_0xb5891e||!_0xb5891e[_0x23c151(0x1ca)])return!![];const _0xf87dd9=JSON['parse'](_0xb5891e[_0x23c151(0x1ca)]),{rooms:_0x338691,matrix:_0x2095ff}=_0xf87dd9;if(!_0x338691||!_0x2095ff)return!![];const _0x1b5f5f=_0x338691[_0x23c151(0x1b6)](_0xdb0823),_0x2c45a2=_0x338691[_0x23c151(0x1b6)](_0x1f1980);if(_0x1b5f5f===-0x1||_0x2c45a2===-0x1)return!![];const _0x215105=_0x2095ff[_0x1b5f5f][_0x2c45a2]>0x0||_0x2095ff[_0x2c45a2][_0x1b5f5f]>0x0;return _0x215105;}catch(_0x5a2cd8){return _0x263c17[_0x23c151(0x19d)][_0x23c151(0x1cc)](_0x23c151(0x1ba)+_0x5a2cd8['message']),!![];}}function calculateSleepProbability(_0x1e5d3b){const _0x2f140d=a2_0x34cd6c,_0x355369=new Date(),_0x52fada=_0x355369['getHours'](),_0x51510b=_0x1e5d3b[_0x2f140d(0x197)]();let _0x1594be=0.1;if(_0x52fada>=0x17||_0x52fada<=0x6)_0x1594be=0x1;else{if(_0x52fada>=0xd&&_0x52fada<=0xf)_0x1594be=0.8;else{if(_0x52fada>=0x14&&_0x52fada<=0x17)_0x1594be=0.4;}}let _0x1810f8=0.1;if(_0x51510b[_0x2f140d(0x1c0)](_0x2f140d(0x19f))||_0x51510b[_0x2f140d(0x1c0)](_0x2f140d(0x1d0)))_0x1810f8=0x1;else{if(_0x51510b[_0x2f140d(0x1c0)](_0x2f140d(0x1ad))||_0x51510b[_0x2f140d(0x1c0)](_0x2f140d(0x1be))||_0x51510b[_0x2f140d(0x1c0)](_0x2f140d(0x1cf)))_0x1810f8=0.6;else{if(_0x51510b['includes'](_0x2f140d(0x196))||_0x51510b['includes']('wc'))_0x1810f8=0.05;}}let _0x32006b=0.5;const _0x1447b7=_0x1810f8*0.5+_0x1594be*0.3+_0x32006b*0.2;return parseFloat(_0x1447b7['toFixed'](0x2));}async function updateLocation(_0x55db44,_0x4f0fab){const _0x142104=a2_0x34cd6c;if(!_0x4f0fab||_0x4f0fab===_0x142104(0x1cd))return;if(!await isActive(_0x55db44)){resetTimer(_0x55db44);return;}if(currentMonitoredRoom&&currentMonitoredRoom!==_0x4f0fab){const _0x479c08=await areRoomsConnected(_0x55db44,currentMonitoredRoom,_0x4f0fab);if(!_0x479c08){const _0x1b44e3='Ignoriere\x20Bewegung\x20in\x20\x27'+_0x4f0fab+'\x27.\x20Nicht\x20verbunden\x20mit\x20Ã¼berwachtem\x20\x27'+currentMonitoredRoom+'\x27.';_0x55db44[_0x142104(0x19d)][_0x142104(0x1bb)](_0x142104(0x1b2)+_0x1b44e3+_0x142104(0x1a9)),await _0x55db44[_0x142104(0x1c7)](_0x142104(0x1aa),{'val':JSON[_0x142104(0x19c)]({'room':_0x4f0fab,'reason':_0x1b44e3,'timestamp':Date['now']()}),'ack':!![]});return;}resetTimer(_0x55db44);}if(!currentMonitoredRoom){await _0x55db44[_0x142104(0x1c7)](_0x142104(0x1bd),{'val':_0x4f0fab,'ack':!![]});const _0x5e1c7d=await loadConfig(_0x55db44);let _0x1b60e6=getTimeoutRobust(_0x5e1c7d,_0x4f0fab);const _0x95db06=_0x4f0fab['toLowerCase']();if(!_0x1b60e6)for(const _0x3fe014 in DEFAULT_TIMEOUTS){if(_0x95db06['includes'](_0x3fe014)){_0x1b60e6=DEFAULT_TIMEOUTS[_0x3fe014];break;}}if(!_0x1b60e6&&_0x5e1c7d[_0x142104(0x1b0)])_0x1b60e6=_0x5e1c7d[_0x142104(0x1b0)];if(!_0x1b60e6)return;currentMonitoredRoom=_0x4f0fab,startTimer(_0x55db44,_0x1b60e6,_0x4f0fab);}}function startTimer(_0xe4b87d,_0x3be170,_0x5dde08){const _0x1c07cf=a2_0x34cd6c;if(activeTimer)clearTimeout(activeTimer);timeoutMs=_0x3be170*0x3c*0x3e8,startTime=Date[_0x1c07cf(0x195)](),alarmStage=0x0;const _0x3aad0e=calculateSleepProbability(_0x5dde08||currentMonitoredRoom),_0x5e4d05=_0x3aad0e>0.65;_0x5e4d05?(timeoutMs+=0x5a*0x3c*0x3e8,_0xe4b87d[_0x1c07cf(0x19d)][_0x1c07cf(0x1bb)](_0x1c07cf(0x1bf)+(_0x3aad0e*0x64)[_0x1c07cf(0x1b9)](0x0)+_0x1c07cf(0x1a4)+currentMonitoredRoom+_0x1c07cf(0x1a1)),_0xe4b87d[_0x1c07cf(0x1c7)](_0x1c07cf(0x1ac),{'val':!![],'ack':!![]})):_0xe4b87d[_0x1c07cf(0x1c7)](_0x1c07cf(0x1ac),{'val':![],'ack':!![]}),_0xe4b87d[_0x1c07cf(0x1c7)]('analysis.safety.deadMan.napProbability',{'val':_0x3aad0e,'ack':!![]}),_0xe4b87d['log'][_0x1c07cf(0x1bb)]('ðŸ‘¼\x20Schutzengel:\x20Ãœberwache\x20'+currentMonitoredRoom+'\x20fÃ¼r\x20'+_0x3be170+_0x1c07cf(0x1bc)),_0xe4b87d[_0x1c07cf(0x1c7)](_0x1c07cf(0x19a),{'val':'ok','ack':!![]}),activeTimer=setTimeout(()=>triggerPreWarn(_0xe4b87d),timeoutMs);}function resetTimer(_0x5c68da){const _0x5a095a=a2_0x34cd6c;if(activeTimer)clearTimeout(activeTimer);activeTimer=null,currentMonitoredRoom=null,alarmStage=0x0,_0x5c68da[_0x5a095a(0x1c7)]('analysis.safety.deadMan.alarmState',{'val':'ok','ack':!![]}),_0x5c68da[_0x5a095a(0x1c7)](_0x5a095a(0x1ac),{'val':![],'ack':!![]}),_0x5c68da[_0x5a095a(0x1c7)](_0x5a095a(0x1c2),{'val':0x0,'ack':!![]});}async function triggerPreWarn(_0x3f046a){const _0x9356d6=a2_0x34cd6c;alarmStage=0x1,await _0x3f046a[_0x9356d6(0x1c7)]('analysis.safety.deadMan.alarmState',{'val':'pre_warn','ack':!![]});const _0x231ebe='â³\x20ACHTUNG:\x20UngewÃ¶hnlich\x20lange\x20InaktivitÃ¤t\x20in\x20'+currentMonitoredRoom+'.\x20Alles\x20in\x20Ordnung?';_0x3f046a[_0x9356d6(0x19d)]['warn']('[DeadMan]\x20'+_0x231ebe),await setup[_0x9356d6(0x1ae)](_0x3f046a,_0x9356d6(0x199)+_0x231ebe),activeTimer=setTimeout(()=>triggerAlarm(_0x3f046a),0x5*0x3c*0x3e8);}async function triggerAlarm(_0x45af2f){const _0x232a95=a2_0x34cd6c;alarmStage=0x2,await _0x45af2f[_0x232a95(0x1c7)]('analysis.safety.deadMan.alarmState',{'val':_0x232a95(0x1ce),'ack':!![]});const _0x3562f9=_0x232a95(0x1a6)+currentMonitoredRoom+'!';_0x45af2f[_0x232a95(0x19d)][_0x232a95(0x1cb)](_0x232a95(0x1b2)+_0x3562f9),await setup[_0x232a95(0x1ae)](_0x45af2f,_0x3562f9,![],!![]);}module[a2_0x34cd6c(0x1c9)]={'updateLocation':updateLocation};