const a2_0x1dfd39=a2_0x4a33;function a2_0x4a33(_0x100df3,_0x50a97c){const _0x528e80=a2_0x39eb();return a2_0x4a33=function(_0xf6a64f,_0x9fda7a){_0xf6a64f=_0xf6a64f-0x1ba;let _0x39ebb8=_0x528e80[_0xf6a64f];return _0x39ebb8;},a2_0x4a33(_0x100df3,_0x50a97c);}(function(_0x507601,_0x343d72){const _0xddb40b=a2_0x4a33,_0x15de31=_0x507601();while(!![]){try{const _0x497a58=parseInt(_0xddb40b(0x1e9))/0x1+-parseInt(_0xddb40b(0x1bb))/0x2+parseInt(_0xddb40b(0x1c4))/0x3*(parseInt(_0xddb40b(0x1c3))/0x4)+-parseInt(_0xddb40b(0x1de))/0x5*(-parseInt(_0xddb40b(0x1e4))/0x6)+-parseInt(_0xddb40b(0x1ef))/0x7+-parseInt(_0xddb40b(0x1bc))/0x8*(-parseInt(_0xddb40b(0x1e5))/0x9)+-parseInt(_0xddb40b(0x1c9))/0xa;if(_0x497a58===_0x343d72)break;else _0x15de31['push'](_0x15de31['shift']());}catch(_0xafac84){_0x15de31['push'](_0x15de31['shift']());}}}(a2_0x39eb,0x7852e));const a2_0x9fda7a=(function(){let _0x39ecdd=!![];return function(_0x27b334,_0x458f51){const _0x32bbb7=_0x39ecdd?function(){const _0x339459=a2_0x4a33;if(_0x458f51){const _0x1328c7=_0x458f51[_0x339459(0x1d7)](_0x27b334,arguments);return _0x458f51=null,_0x1328c7;}}:function(){};return _0x39ecdd=![],_0x32bbb7;};}()),a2_0xf6a64f=a2_0x9fda7a(this,function(){const _0x4bb3cd=a2_0x4a33;return a2_0xf6a64f[_0x4bb3cd(0x1ca)]()[_0x4bb3cd(0x1e3)](_0x4bb3cd(0x1c0))[_0x4bb3cd(0x1ca)]()[_0x4bb3cd(0x1d8)](a2_0xf6a64f)['search'](_0x4bb3cd(0x1c0));});a2_0xf6a64f();'use strict';const setup=require(a2_0x1dfd39(0x1cb));let activeTimer=null,currentMonitoredRoom=null,timeoutMs=0x0,startTime=0x0,alarmStage=0x0;const DEFAULT_TIMEOUTS={'bad':0x2d,'bath':0x2d,'toilet':0x1e,'wc':0x1e,'keller':0x3c,'schlaf':0x78,'bed':0x78,'guest':0x5a,'gast':0x5a};function getTimeoutRobust(_0x1ed3f4,_0x385812){const _0xfb2801=a2_0x1dfd39;if(!_0x1ed3f4||!_0x385812)return undefined;if(_0x1ed3f4[_0x385812])return _0x1ed3f4[_0x385812];const _0x4eb3b2=_0x385812[_0xfb2801(0x1dd)]()[_0xfb2801(0x1ba)](/[^a-z0-9]/g,'');for(const _0xf9af9d in _0x1ed3f4){const _0x2d54dd=_0xf9af9d[_0xfb2801(0x1dd)]()[_0xfb2801(0x1ba)](/[^a-z0-9]/g,'');if(_0x2d54dd===_0x4eb3b2)return _0x1ed3f4[_0xf9af9d];}const _0x26d015=_0x385812[_0xfb2801(0x1dd)]();if(_0x1ed3f4[_0x26d015])return _0x1ed3f4[_0x26d015];return undefined;}async function loadConfig(_0x30b590){const _0x27b5cc=a2_0x1dfd39;try{const _0x3b75b8=await _0x30b590[_0x27b5cc(0x1c5)]('analysis.safety.deadMan.config');if(_0x3b75b8&&_0x3b75b8['val'])return JSON['parse'](_0x3b75b8['val']);}catch(_0x48e18e){}return{};}async function isActive(_0x26d306){const _0x73b0f7=a2_0x1dfd39;try{const _0x427371=await _0x26d306['getStateAsync'](_0x73b0f7(0x1d0));return _0x427371&&_0x427371[_0x73b0f7(0x1cd)];}catch(_0x15da2d){return![];}}async function areRoomsConnected(_0x2548a5,_0x3c24fa,_0x3417bf){const _0x50f8d2=a2_0x1dfd39;try{const _0x2a24d5=await _0x2548a5[_0x50f8d2(0x1c5)](_0x50f8d2(0x1d5));if(!_0x2a24d5||!_0x2a24d5[_0x50f8d2(0x1cd)])return!![];const _0x52c54b=JSON[_0x50f8d2(0x1ce)](_0x2a24d5[_0x50f8d2(0x1cd)]),{rooms:_0x52af53,matrix:_0x40dd2f}=_0x52c54b;if(!_0x52af53||!_0x40dd2f)return!![];const _0x11e1f0=_0x52af53[_0x50f8d2(0x1eb)](_0x3c24fa),_0x436e31=_0x52af53[_0x50f8d2(0x1eb)](_0x3417bf);if(_0x11e1f0===-0x1||_0x436e31===-0x1)return!![];const _0x53e044=_0x40dd2f[_0x11e1f0][_0x436e31]>0x0||_0x40dd2f[_0x436e31][_0x11e1f0]>0x0;return _0x53e044;}catch(_0x4d3832){return _0x2548a5[_0x50f8d2(0x1d4)][_0x50f8d2(0x1bd)](_0x50f8d2(0x1e1)+_0x4d3832[_0x50f8d2(0x1dc)]),!![];}}function calculateSleepProbability(_0x49554b){const _0x314562=a2_0x1dfd39,_0x1ec29d=new Date(),_0x3cc679=_0x1ec29d[_0x314562(0x1c1)](),_0x41adc1=_0x49554b[_0x314562(0x1dd)]();let _0x9dc4fa=0.1;if(_0x3cc679>=0x17||_0x3cc679<=0x6)_0x9dc4fa=0x1;else{if(_0x3cc679>=0xd&&_0x3cc679<=0xf)_0x9dc4fa=0.8;else{if(_0x3cc679>=0x14&&_0x3cc679<=0x17)_0x9dc4fa=0.4;}}let _0x2f8df1=0.1;if(_0x41adc1[_0x314562(0x1df)](_0x314562(0x1d3))||_0x41adc1['includes'](_0x314562(0x1ec)))_0x2f8df1=0x1;else{if(_0x41adc1[_0x314562(0x1df)]('wohn')||_0x41adc1['includes']('living')||_0x41adc1[_0x314562(0x1df)](_0x314562(0x1cc)))_0x2f8df1=0.6;else{if(_0x41adc1[_0x314562(0x1df)](_0x314562(0x1bf))||_0x41adc1[_0x314562(0x1df)]('wc'))_0x2f8df1=0.05;}}let _0x3b593a=0.5;const _0x1232ea=_0x2f8df1*0.5+_0x9dc4fa*0.3+_0x3b593a*0.2;return parseFloat(_0x1232ea[_0x314562(0x1c8)](0x2));}async function updateLocation(_0x11106e,_0x347ecb){const _0x4b225b=a2_0x1dfd39;if(!_0x347ecb||_0x347ecb==='Unknown')return;if(!await isActive(_0x11106e)){resetTimer(_0x11106e);return;}if(currentMonitoredRoom&&currentMonitoredRoom!==_0x347ecb){const _0x5c82f7=await areRoomsConnected(_0x11106e,currentMonitoredRoom,_0x347ecb);if(!_0x5c82f7){const _0x3cab6c='Ignoriere\x20Bewegung\x20in\x20\x27'+_0x347ecb+_0x4b225b(0x1d2)+currentMonitoredRoom+'\x27.';_0x11106e[_0x4b225b(0x1d4)]['info'](_0x4b225b(0x1c7)+_0x3cab6c+_0x4b225b(0x1cf)),await _0x11106e[_0x4b225b(0x1ee)]('analysis.safety.deadMan.lastIgnored',{'val':JSON['stringify']({'room':_0x347ecb,'reason':_0x3cab6c,'timestamp':Date[_0x4b225b(0x1ea)]()}),'ack':!![]});return;}resetTimer(_0x11106e);}if(!currentMonitoredRoom){await _0x11106e[_0x4b225b(0x1ee)](_0x4b225b(0x1c2),{'val':_0x347ecb,'ack':!![]});const _0x27d143=await loadConfig(_0x11106e);let _0x2de961=getTimeoutRobust(_0x27d143,_0x347ecb);const _0x4299cf=_0x347ecb[_0x4b225b(0x1dd)]();if(!_0x2de961)for(const _0x1941e2 in DEFAULT_TIMEOUTS){if(_0x4299cf[_0x4b225b(0x1df)](_0x1941e2)){_0x2de961=DEFAULT_TIMEOUTS[_0x1941e2];break;}}if(!_0x2de961&&_0x27d143[_0x4b225b(0x1e8)])_0x2de961=_0x27d143[_0x4b225b(0x1e8)];if(!_0x2de961)return;currentMonitoredRoom=_0x347ecb,startTimer(_0x11106e,_0x2de961,_0x347ecb);}}function startTimer(_0x38d0e5,_0xb2e505,_0x30a8c2){const _0x4e9ecd=a2_0x1dfd39;if(activeTimer)clearTimeout(activeTimer);timeoutMs=_0xb2e505*0x3c*0x3e8,startTime=Date[_0x4e9ecd(0x1ea)](),alarmStage=0x0;const _0x350d71=calculateSleepProbability(_0x30a8c2||currentMonitoredRoom),_0x3dc78b=_0x350d71>0.65;_0x3dc78b?(timeoutMs+=0x5a*0x3c*0x3e8,_0x38d0e5['log']['info'](_0x4e9ecd(0x1e2)+(_0x350d71*0x64)['toFixed'](0x0)+_0x4e9ecd(0x1ed)+currentMonitoredRoom+_0x4e9ecd(0x1db)),_0x38d0e5[_0x4e9ecd(0x1ee)]('analysis.safety.deadMan.smartSleep',{'val':!![],'ack':!![]})):_0x38d0e5[_0x4e9ecd(0x1ee)](_0x4e9ecd(0x1e6),{'val':![],'ack':!![]}),_0x38d0e5['setStateAsync'](_0x4e9ecd(0x1e7),{'val':_0x350d71,'ack':!![]}),_0x38d0e5[_0x4e9ecd(0x1d4)]['info']('ðŸ‘¼\x20Schutzengel:\x20Ãœberwache\x20'+currentMonitoredRoom+'\x20fÃ¼r\x20'+_0xb2e505+'\x20Min.'),_0x38d0e5[_0x4e9ecd(0x1ee)](_0x4e9ecd(0x1be),{'val':'ok','ack':!![]}),activeTimer=setTimeout(()=>triggerPreWarn(_0x38d0e5),timeoutMs);}function resetTimer(_0x555548){const _0x32553a=a2_0x1dfd39;if(activeTimer)clearTimeout(activeTimer);activeTimer=null,currentMonitoredRoom=null,alarmStage=0x0,_0x555548[_0x32553a(0x1ee)](_0x32553a(0x1be),{'val':'ok','ack':!![]}),_0x555548['setStateAsync']('analysis.safety.deadMan.smartSleep',{'val':![],'ack':!![]}),_0x555548[_0x32553a(0x1ee)]('analysis.safety.deadMan.napProbability',{'val':0x0,'ack':!![]});}async function triggerPreWarn(_0x53b892){const _0xd3e352=a2_0x1dfd39;alarmStage=0x1,await _0x53b892[_0xd3e352(0x1ee)](_0xd3e352(0x1be),{'val':_0xd3e352(0x1e0),'ack':!![]});const _0x3424b4='â³\x20ACHTUNG:\x20UngewÃ¶hnlich\x20lange\x20InaktivitÃ¤t\x20in\x20'+currentMonitoredRoom+'.\x20Alles\x20in\x20Ordnung?';_0x53b892['log'][_0xd3e352(0x1bd)](_0xd3e352(0x1c7)+_0x3424b4),await setup['sendNotification'](_0x53b892,_0xd3e352(0x1d1)+_0x3424b4),activeTimer=setTimeout(()=>triggerAlarm(_0x53b892),0x5*0x3c*0x3e8);}async function triggerAlarm(_0x2f60e9){const _0x9d3f43=a2_0x1dfd39;alarmStage=0x2,await _0x2f60e9[_0x9d3f43(0x1ee)](_0x9d3f43(0x1be),{'val':_0x9d3f43(0x1da),'ack':!![]});const _0x25afb6=_0x9d3f43(0x1d6)+currentMonitoredRoom+'!';_0x2f60e9['log'][_0x9d3f43(0x1d9)](_0x9d3f43(0x1c7)+_0x25afb6),await setup['sendNotification'](_0x2f60e9,_0x25afb6,![],!![]);}module[a2_0x1dfd39(0x1c6)]={'updateLocation':updateLocation};function a2_0x39eb(){const _0x25f462=['bed','%).\x20VerlÃ¤ngere\x20Timer\x20fÃ¼r\x20','setStateAsync','3683568CEFMcc','replace','534310GcheEN','3696Uxvwnq','warn','analysis.safety.deadMan.alarmState','bad','(((.+)+)+)+$','getHours','analysis.safety.deadMan.currentRoom','402004Rfesvv','27xoCctS','getStateAsync','exports','[DeadMan]\x20','toFixed','8492260ZEeQHp','toString','./setup','sofa','val','parse','\x20(Multi-Person\x20Filter)','analysis.safety.deadMan.active','ðŸ‘¼\x20Schutzengel-Frage:\x20','\x27.\x20Nicht\x20verbunden\x20mit\x20Ã¼berwachtem\x20\x27','schlaf','log','analysis.topology.structure','ðŸš¨\x20NOTFALL-ALARM:\x20Person\x20reagiert\x20nicht\x20in\x20','apply','constructor','error','alarm','\x20um\x2090\x20Min.','message','toLowerCase','3965935nfetzI','includes','pre_warn','[DeadMan]\x20Topology\x20check\x20failed:\x20','ðŸ’¤\x20Smart\x20Sleep\x20erkannt\x20(','search','6cGaXFU','6453RmQZkw','analysis.safety.deadMan.smartSleep','analysis.safety.deadMan.napProbability','default','106501ibbSKV','now','indexOf'];a2_0x39eb=function(){return _0x25f462;};return a2_0x39eb();}