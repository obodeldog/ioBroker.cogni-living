const a2_0x56df8c=a2_0x274d;(function(_0x4f7b81,_0x3683ea){const _0x3e8ea4=a2_0x274d,_0xe9aa34=_0x4f7b81();while(!![]){try{const _0x5c108a=parseInt(_0x3e8ea4(0x176))/0x1*(parseInt(_0x3e8ea4(0x144))/0x2)+parseInt(_0x3e8ea4(0x146))/0x3+parseInt(_0x3e8ea4(0x169))/0x4+-parseInt(_0x3e8ea4(0x15c))/0x5+parseInt(_0x3e8ea4(0x13b))/0x6+parseInt(_0x3e8ea4(0x157))/0x7*(-parseInt(_0x3e8ea4(0x151))/0x8)+parseInt(_0x3e8ea4(0x166))/0x9*(-parseInt(_0x3e8ea4(0x15b))/0xa);if(_0x5c108a===_0x3683ea)break;else _0xe9aa34['push'](_0xe9aa34['shift']());}catch(_0x40a41c){_0xe9aa34['push'](_0xe9aa34['shift']());}}}(a2_0x3d4b,0x45635));const a2_0x58a303=(function(){let _0x75c7=!![];return function(_0x4fb7d8,_0x2c496d){const _0x50e997=_0x75c7?function(){const _0x78b72b=a2_0x274d;if(_0x2c496d){const _0x20ef1f=_0x2c496d[_0x78b72b(0x161)](_0x4fb7d8,arguments);return _0x2c496d=null,_0x20ef1f;}}:function(){};return _0x75c7=![],_0x50e997;};}()),a2_0x1b98db=a2_0x58a303(this,function(){const _0x5d9fe3=a2_0x274d;return a2_0x1b98db['toString']()[_0x5d9fe3(0x14f)](_0x5d9fe3(0x140))[_0x5d9fe3(0x177)]()[_0x5d9fe3(0x155)](a2_0x1b98db)[_0x5d9fe3(0x14f)](_0x5d9fe3(0x140));});a2_0x1b98db();'use strict';const setup=require(a2_0x56df8c(0x14a));let activeTimer=null,currentMonitoredRoom=null,timeoutMs=0x0,startTime=0x0,alarmStage=0x0;const DEFAULT_TIMEOUTS={'bad':0x2d,'bath':0x2d,'toilet':0x1e,'wc':0x1e,'keller':0x3c,'schlaf':0x78,'bed':0x78,'guest':0x5a,'gast':0x5a};function getTimeoutRobust(_0x18a1df,_0xee99c4){const _0x50e846=a2_0x56df8c;if(!_0x18a1df||!_0xee99c4)return undefined;if(_0x18a1df[_0xee99c4])return _0x18a1df[_0xee99c4];const _0x2dda38=_0xee99c4[_0x50e846(0x172)]()[_0x50e846(0x143)](/[^a-z0-9]/g,'');for(const _0x7262b5 in _0x18a1df){const _0x2091ec=_0x7262b5['toLowerCase']()[_0x50e846(0x143)](/[^a-z0-9]/g,'');if(_0x2091ec===_0x2dda38)return _0x18a1df[_0x7262b5];}const _0x14d1b2=_0xee99c4['toLowerCase']();if(_0x18a1df[_0x14d1b2])return _0x18a1df[_0x14d1b2];return undefined;}async function loadConfig(_0x4ec02d){const _0x1b6525=a2_0x56df8c;try{const _0x50bc3a=await _0x4ec02d[_0x1b6525(0x170)](_0x1b6525(0x16b));if(_0x50bc3a&&_0x50bc3a[_0x1b6525(0x15e)])return JSON[_0x1b6525(0x14e)](_0x50bc3a['val']);}catch(_0x569b51){}return{};}async function isActive(_0x31fa5e){const _0x10de0f=a2_0x56df8c;try{const _0x364de0=await _0x31fa5e[_0x10de0f(0x170)](_0x10de0f(0x16a));return _0x364de0&&_0x364de0[_0x10de0f(0x15e)];}catch(_0x5a7b6e){return![];}}async function areRoomsConnected(_0x1e2e18,_0x197f52,_0x2f1af0){const _0x2ee126=a2_0x56df8c;try{const _0x428aa1=await _0x1e2e18['getStateAsync'](_0x2ee126(0x16c));if(!_0x428aa1||!_0x428aa1[_0x2ee126(0x15e)])return!![];const _0x84363f=JSON[_0x2ee126(0x14e)](_0x428aa1[_0x2ee126(0x15e)]),{rooms:_0x405385,matrix:_0xcd8308}=_0x84363f;if(!_0x405385||!_0xcd8308)return!![];const _0x145d2d=_0x405385[_0x2ee126(0x175)](_0x197f52),_0xb1c21a=_0x405385[_0x2ee126(0x175)](_0x2f1af0);if(_0x145d2d===-0x1||_0xb1c21a===-0x1)return!![];const _0x2d2cb7=_0xcd8308[_0x145d2d][_0xb1c21a]>0x0||_0xcd8308[_0xb1c21a][_0x145d2d]>0x0;return _0x2d2cb7;}catch(_0x44ca27){return _0x1e2e18['log'][_0x2ee126(0x16d)](_0x2ee126(0x158)+_0x44ca27[_0x2ee126(0x174)]),!![];}}function calculateSleepProbability(_0x4a10a7){const _0x434dad=a2_0x56df8c,_0x167f98=new Date(),_0x51642f=_0x167f98['getHours'](),_0x9e04c5=_0x4a10a7[_0x434dad(0x172)]();let _0x3fc0c6=0.1;if(_0x51642f>=0x17||_0x51642f<=0x6)_0x3fc0c6=0x1;else{if(_0x51642f>=0xd&&_0x51642f<=0xf)_0x3fc0c6=0.8;else{if(_0x51642f>=0x14&&_0x51642f<=0x17)_0x3fc0c6=0.4;}}let _0x3e6e16=0.1;if(_0x9e04c5['includes'](_0x434dad(0x162))||_0x9e04c5['includes'](_0x434dad(0x15a)))_0x3e6e16=0x1;else{if(_0x9e04c5[_0x434dad(0x16f)](_0x434dad(0x16e))||_0x9e04c5[_0x434dad(0x16f)](_0x434dad(0x14d))||_0x9e04c5['includes'](_0x434dad(0x165)))_0x3e6e16=0.6;else{if(_0x9e04c5[_0x434dad(0x16f)](_0x434dad(0x160))||_0x9e04c5[_0x434dad(0x16f)]('wc'))_0x3e6e16=0.05;}}let _0x15057e=0.5;const _0x53c904=_0x3e6e16*0.5+_0x3fc0c6*0.3+_0x15057e*0.2;return parseFloat(_0x53c904[_0x434dad(0x153)](0x2));}function a2_0x274d(_0x513804,_0x326778){const _0x184b09=a2_0x3d4b();return a2_0x274d=function(_0x1b98db,_0x58a303){_0x1b98db=_0x1b98db-0x139;let _0x3d4b8f=_0x184b09[_0x1b98db];return _0x3d4b8f;},a2_0x274d(_0x513804,_0x326778);}async function updateLocation(_0xdd81fc,_0x4a7904){const _0x12b39a=a2_0x56df8c;if(!_0x4a7904||_0x4a7904===_0x12b39a(0x156))return;if(!await isActive(_0xdd81fc)){resetTimer(_0xdd81fc);return;}if(currentMonitoredRoom&&currentMonitoredRoom!==_0x4a7904){const _0x371b6e=await areRoomsConnected(_0xdd81fc,currentMonitoredRoom,_0x4a7904);if(!_0x371b6e){const _0x58cf39=_0x12b39a(0x141)+_0x4a7904+_0x12b39a(0x13a)+currentMonitoredRoom+'\x27.';_0xdd81fc[_0x12b39a(0x15d)][_0x12b39a(0x13c)](_0x12b39a(0x167)+_0x58cf39+_0x12b39a(0x147)),await _0xdd81fc[_0x12b39a(0x13f)](_0x12b39a(0x15f),{'val':JSON[_0x12b39a(0x159)]({'room':_0x4a7904,'reason':_0x58cf39,'timestamp':Date[_0x12b39a(0x152)]()}),'ack':!![]});return;}resetTimer(_0xdd81fc);}if(!currentMonitoredRoom){await _0xdd81fc['setStateAsync'](_0x12b39a(0x173),{'val':_0x4a7904,'ack':!![]});const _0x40bb58=await loadConfig(_0xdd81fc);let _0x1a5f32=getTimeoutRobust(_0x40bb58,_0x4a7904);const _0x2d5490=_0x4a7904[_0x12b39a(0x172)]();if(!_0x1a5f32)for(const _0x361b6d in DEFAULT_TIMEOUTS){if(_0x2d5490[_0x12b39a(0x16f)](_0x361b6d)){_0x1a5f32=DEFAULT_TIMEOUTS[_0x361b6d];break;}}if(!_0x1a5f32&&_0x40bb58[_0x12b39a(0x148)])_0x1a5f32=_0x40bb58[_0x12b39a(0x148)];if(!_0x1a5f32)return;currentMonitoredRoom=_0x4a7904,startTimer(_0xdd81fc,_0x1a5f32,_0x4a7904);}}function startTimer(_0x3af327,_0xf5dd8b,_0x33dd34){const _0x148746=a2_0x56df8c;if(activeTimer)clearTimeout(activeTimer);timeoutMs=_0xf5dd8b*0x3c*0x3e8,startTime=Date['now'](),alarmStage=0x0;const _0x333d17=calculateSleepProbability(_0x33dd34||currentMonitoredRoom),_0x2a212b=_0x333d17>0.65;_0x2a212b?(timeoutMs+=0x5a*0x3c*0x3e8,_0x3af327[_0x148746(0x15d)]['info'](_0x148746(0x171)+(_0x333d17*0x64)[_0x148746(0x153)](0x0)+_0x148746(0x13e)+currentMonitoredRoom+'\x20um\x2090\x20Min.'),_0x3af327['setStateAsync'](_0x148746(0x14c),{'val':!![],'ack':!![]})):_0x3af327[_0x148746(0x13f)](_0x148746(0x14c),{'val':![],'ack':!![]}),_0x3af327[_0x148746(0x13f)](_0x148746(0x139),{'val':_0x333d17,'ack':!![]}),_0x3af327[_0x148746(0x15d)][_0x148746(0x13c)](_0x148746(0x164)+currentMonitoredRoom+_0x148746(0x154)+_0xf5dd8b+_0x148746(0x13d)),_0x3af327['setStateAsync'](_0x148746(0x163),{'val':'ok','ack':!![]}),activeTimer=setTimeout(()=>triggerPreWarn(_0x3af327),timeoutMs);}function resetTimer(_0x2673b4){const _0xbe77c=a2_0x56df8c;if(activeTimer)clearTimeout(activeTimer);activeTimer=null,currentMonitoredRoom=null,alarmStage=0x0,_0x2673b4[_0xbe77c(0x13f)]('analysis.safety.deadMan.alarmState',{'val':'ok','ack':!![]}),_0x2673b4['setStateAsync']('analysis.safety.deadMan.smartSleep',{'val':![],'ack':!![]}),_0x2673b4[_0xbe77c(0x13f)]('analysis.safety.deadMan.napProbability',{'val':0x0,'ack':!![]});}async function triggerPreWarn(_0x14fbb5){const _0x1bb5b3=a2_0x56df8c;alarmStage=0x1,await _0x14fbb5[_0x1bb5b3(0x13f)](_0x1bb5b3(0x163),{'val':_0x1bb5b3(0x14b),'ack':!![]});const _0x318ee1=_0x1bb5b3(0x145)+currentMonitoredRoom+'.\x20Alles\x20in\x20Ordnung?';_0x14fbb5[_0x1bb5b3(0x15d)][_0x1bb5b3(0x16d)](_0x1bb5b3(0x167)+_0x318ee1),await setup[_0x1bb5b3(0x168)](_0x14fbb5,'üëº\x20Schutzengel-Frage:\x20'+_0x318ee1),activeTimer=setTimeout(()=>triggerAlarm(_0x14fbb5),0x5*0x3c*0x3e8);}async function triggerAlarm(_0xd92177){const _0x56c306=a2_0x56df8c;alarmStage=0x2,await _0xd92177[_0x56c306(0x13f)](_0x56c306(0x163),{'val':'alarm','ack':!![]});const _0x516980=_0x56c306(0x142)+currentMonitoredRoom+'!';_0xd92177['log'][_0x56c306(0x150)](_0x56c306(0x167)+_0x516980),await setup['sendNotification'](_0xd92177,_0x516980,![],!![]);}function a2_0x3d4b(){const _0x44dde3=['analysis.topology.structure','warn','wohn','includes','getStateAsync','üí§\x20Smart\x20Sleep\x20erkannt\x20(','toLowerCase','analysis.safety.deadMan.currentRoom','message','indexOf','44383uWNFoy','toString','analysis.safety.deadMan.napProbability','\x27.\x20Nicht\x20verbunden\x20mit\x20√ºberwachtem\x20\x27','811362xOVEgN','info','\x20Min.','%).\x20Verl√§ngere\x20Timer\x20f√ºr\x20','setStateAsync','(((.+)+)+)+$','Ignoriere\x20Bewegung\x20in\x20\x27','üö®\x20NOTFALL-ALARM:\x20Person\x20reagiert\x20nicht\x20in\x20','replace','18WyDWEi','‚è≥\x20ACHTUNG:\x20Ungew√∂hnlich\x20lange\x20Inaktivit√§t\x20in\x20','515970jhUHNQ','\x20(Multi-Person\x20Filter)','default','exports','./setup','pre_warn','analysis.safety.deadMan.smartSleep','living','parse','search','error','392pxbJdP','now','toFixed','\x20f√ºr\x20','constructor','Unknown','35525OIPKjX','[DeadMan]\x20Topology\x20check\x20failed:\x20','stringify','bed','460KHTPVV','721840PKVEMQ','log','val','analysis.safety.deadMan.lastIgnored','bad','apply','schlaf','analysis.safety.deadMan.alarmState','üëº\x20Schutzengel:\x20√úberwache\x20','sofa','70920zUOCtO','[DeadMan]\x20','sendNotification','1332288yLcrMu','analysis.safety.deadMan.active','analysis.safety.deadMan.config'];a2_0x3d4b=function(){return _0x44dde3;};return a2_0x3d4b();}module[a2_0x56df8c(0x149)]={'updateLocation':updateLocation};