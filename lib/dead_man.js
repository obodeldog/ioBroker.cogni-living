const a2_0x4f5ae0=a2_0x5874;(function(_0x161ebe,_0x10346b){const _0x8d70ca=a2_0x5874,_0x50d391=_0x161ebe();while(!![]){try{const _0x4dcee2=parseInt(_0x8d70ca(0xb4))/0x1*(-parseInt(_0x8d70ca(0xbf))/0x2)+parseInt(_0x8d70ca(0xb5))/0x3*(parseInt(_0x8d70ca(0xcd))/0x4)+-parseInt(_0x8d70ca(0xb1))/0x5+parseInt(_0x8d70ca(0xb3))/0x6+-parseInt(_0x8d70ca(0xca))/0x7*(parseInt(_0x8d70ca(0xb2))/0x8)+parseInt(_0x8d70ca(0xd4))/0x9+parseInt(_0x8d70ca(0xae))/0xa*(parseInt(_0x8d70ca(0xbb))/0xb);if(_0x4dcee2===_0x10346b)break;else _0x50d391['push'](_0x50d391['shift']());}catch(_0x214fbb){_0x50d391['push'](_0x50d391['shift']());}}}(a2_0x2445,0x62cd5));const a2_0x2ba8e9=(function(){let _0x3dc60f=!![];return function(_0x27c55d,_0x100aab){const _0x33dbb7=_0x3dc60f?function(){const _0x453852=a2_0x5874;if(_0x100aab){const _0x3e7c16=_0x100aab[_0x453852(0xaa)](_0x27c55d,arguments);return _0x100aab=null,_0x3e7c16;}}:function(){};return _0x3dc60f=![],_0x33dbb7;};}()),a2_0x47da76=a2_0x2ba8e9(this,function(){const _0xabd6f1=a2_0x5874;return a2_0x47da76['toString']()['search'](_0xabd6f1(0xcb))[_0xabd6f1(0xc6)]()[_0xabd6f1(0xc7)](a2_0x47da76)[_0xabd6f1(0xcf)](_0xabd6f1(0xcb));});a2_0x47da76();'use strict';const setup=require(a2_0x4f5ae0(0xd0));function a2_0x5874(_0x591147,_0x575888){const _0x375e8b=a2_0x2445();return a2_0x5874=function(_0x47da76,_0x2ba8e9){_0x47da76=_0x47da76-0xa7;let _0x24456f=_0x375e8b[_0x47da76];return _0x24456f;},a2_0x5874(_0x591147,_0x575888);}let activeTimer=null,currentMonitoredRoom=null,timeoutMs=0x0,startTime=0x0,alarmStage=0x0;const DEFAULT_TIMEOUTS={'bad':0x2d,'bath':0x2d,'toilet':0x1e,'wc':0x1e,'keller':0x3c};async function loadConfig(_0x4ca823){const _0xa8cdab=a2_0x4f5ae0;try{const _0xc1bc19=await _0x4ca823['getStateAsync']('analysis.safety.deadMan.config');if(_0xc1bc19&&_0xc1bc19[_0xa8cdab(0xb0)])return JSON[_0xa8cdab(0xba)](_0xc1bc19[_0xa8cdab(0xb0)]);}catch(_0x3afe6c){}return{};}async function isActive(_0x645b48){const _0x457fc2=a2_0x4f5ae0;try{const _0x52c5a1=await _0x645b48[_0x457fc2(0xb7)](_0x457fc2(0xbc));return _0x52c5a1&&_0x52c5a1[_0x457fc2(0xb0)];}catch(_0x18e931){return![];}}async function areRoomsConnected(_0x1e84ce,_0x5956dc,_0xcb94c6){const _0x2fe697=a2_0x4f5ae0;try{const _0x1950e9=await _0x1e84ce[_0x2fe697(0xb7)]('analysis.topology.structure');if(!_0x1950e9||!_0x1950e9[_0x2fe697(0xb0)])return!![];const _0x388e9f=JSON[_0x2fe697(0xba)](_0x1950e9[_0x2fe697(0xb0)]),{rooms:_0x5bfb65,matrix:_0x3db851}=_0x388e9f;if(!_0x5bfb65||!_0x3db851)return!![];const _0x4f7394=_0x5bfb65[_0x2fe697(0xd1)](_0x5956dc),_0x46bb7b=_0x5bfb65[_0x2fe697(0xd1)](_0xcb94c6);if(_0x4f7394===-0x1||_0x46bb7b===-0x1)return!![];const _0x27b495=_0x3db851[_0x4f7394][_0x46bb7b]>0x0||_0x3db851[_0x46bb7b][_0x4f7394]>0x0;return _0x27b495;}catch(_0x58feac){return _0x1e84ce[_0x2fe697(0xaf)][_0x2fe697(0xce)]('[DeadMan]\x20Topology\x20check\x20failed:\x20'+_0x58feac[_0x2fe697(0xbd)]),!![];}}async function updateLocation(_0x3e551a,_0xbd2383){const _0xb53aa7=a2_0x4f5ae0;if(!_0xbd2383||_0xbd2383===_0xb53aa7(0xa9))return;if(!await isActive(_0x3e551a)){resetTimer(_0x3e551a);return;}if(currentMonitoredRoom&&currentMonitoredRoom!==_0xbd2383){const _0x237d73=await areRoomsConnected(_0x3e551a,currentMonitoredRoom,_0xbd2383);if(!_0x237d73){const _0x348c9d='Ignoriere\x20Bewegung\x20in\x20\x27'+_0xbd2383+_0xb53aa7(0xb9)+currentMonitoredRoom+'\x27.';_0x3e551a[_0xb53aa7(0xaf)][_0xb53aa7(0xb6)]('[DeadMan]\x20'+_0x348c9d+_0xb53aa7(0xc2)),await _0x3e551a['setStateAsync'](_0xb53aa7(0xd3),{'val':JSON[_0xb53aa7(0xb8)]({'room':_0xbd2383,'reason':_0x348c9d,'timestamp':Date[_0xb53aa7(0xd2)]()}),'ack':!![]});return;}resetTimer(_0x3e551a);}if(!currentMonitoredRoom){await _0x3e551a[_0xb53aa7(0xac)](_0xb53aa7(0xbe),{'val':_0xbd2383,'ack':!![]});const _0x35f73a=await loadConfig(_0x3e551a),_0x13acd8=_0xbd2383[_0xb53aa7(0xa8)]();let _0x5e0d33=_0x35f73a[_0xbd2383]||_0x35f73a[_0x13acd8];if(!_0x5e0d33)for(const _0x7d2f18 in DEFAULT_TIMEOUTS){if(_0x13acd8[_0xb53aa7(0xc3)](_0x7d2f18)){_0x5e0d33=DEFAULT_TIMEOUTS[_0x7d2f18];break;}}if(!_0x5e0d33&&_0x35f73a[_0xb53aa7(0xc1)])_0x5e0d33=_0x35f73a[_0xb53aa7(0xc1)];if(!_0x5e0d33)return;currentMonitoredRoom=_0xbd2383,startTimer(_0x3e551a,_0x5e0d33);}}function a2_0x2445(){const _0x258820=['default','\x20(Multi-Person\x20Filter)','includes','analysis.safety.deadMan.alarmState','sendNotification','toString','constructor','alarm','error','301IlYmyJ','(((.+)+)+)+$','[DeadMan]\x20','44aqwSKi','warn','search','./setup','indexOf','now','analysis.safety.deadMan.lastIgnored','593028CCEvqb','exports','toLowerCase','Unknown','apply','â³\x20ACHTUNG:\x20UngewÃ¶hnlich\x20lange\x20InaktivitÃ¤t\x20in\x20','setStateAsync','ðŸ‘¼\x20Schutzengel:\x20Ãœberwache\x20','10IWsEDA','log','val','2862215REMZUP','48536IFDNJL','2947236TjGFUH','151WwPhIG','161151qlLTxj','info','getStateAsync','stringify','\x27.\x20Nicht\x20verbunden\x20mit\x20Ã¼berwachtem\x20\x27','parse','5925183tMltVb','analysis.safety.deadMan.active','message','analysis.safety.deadMan.currentRoom','5942RqDhNl','pre_warn'];a2_0x2445=function(){return _0x258820;};return a2_0x2445();}function startTimer(_0x27175c,_0x3f2a18){const _0x3d069e=a2_0x4f5ae0;if(activeTimer)clearTimeout(activeTimer);timeoutMs=_0x3f2a18*0x3c*0x3e8,startTime=Date['now'](),alarmStage=0x0,_0x27175c['log'][_0x3d069e(0xb6)](_0x3d069e(0xad)+currentMonitoredRoom+'\x20fÃ¼r\x20'+_0x3f2a18+'\x20Min.'),_0x27175c['setStateAsync'](_0x3d069e(0xc4),{'val':'ok','ack':!![]}),activeTimer=setTimeout(()=>triggerPreWarn(_0x27175c),timeoutMs);}function resetTimer(_0x320c90){const _0x47181c=a2_0x4f5ae0;if(activeTimer)clearTimeout(activeTimer);activeTimer=null,currentMonitoredRoom=null,alarmStage=0x0,_0x320c90[_0x47181c(0xac)](_0x47181c(0xc4),{'val':'ok','ack':!![]});}async function triggerPreWarn(_0xbe85be){const _0x225663=a2_0x4f5ae0;alarmStage=0x1,await _0xbe85be[_0x225663(0xac)]('analysis.safety.deadMan.alarmState',{'val':_0x225663(0xc0),'ack':!![]});const _0x1445e0=_0x225663(0xab)+currentMonitoredRoom+'.\x20Alles\x20in\x20Ordnung?';_0xbe85be['log'][_0x225663(0xce)](_0x225663(0xcc)+_0x1445e0),await setup['sendNotification'](_0xbe85be,'ðŸ‘¼\x20Schutzengel-Frage:\x20'+_0x1445e0),activeTimer=setTimeout(()=>triggerAlarm(_0xbe85be),0x5*0x3c*0x3e8);}async function triggerAlarm(_0x3b5e19){const _0x54cc71=a2_0x4f5ae0;alarmStage=0x2,await _0x3b5e19['setStateAsync'](_0x54cc71(0xc4),{'val':_0x54cc71(0xc8),'ack':!![]});const _0x2a8b84='ðŸš¨\x20NOTFALL-ALARM:\x20Person\x20reagiert\x20nicht\x20in\x20'+currentMonitoredRoom+'!';_0x3b5e19[_0x54cc71(0xaf)][_0x54cc71(0xc9)]('[DeadMan]\x20'+_0x2a8b84),await setup[_0x54cc71(0xc5)](_0x3b5e19,_0x2a8b84,![],!![]);}module[a2_0x4f5ae0(0xa7)]={'updateLocation':updateLocation};