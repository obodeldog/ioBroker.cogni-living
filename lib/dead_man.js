const a2_0xb17392=a2_0x28ec;(function(_0x3f74fa,_0x4c44a0){const _0x34932a=a2_0x28ec,_0x3fd47d=_0x3f74fa();while(!![]){try{const _0x58c11e=-parseInt(_0x34932a(0x166))/0x1+parseInt(_0x34932a(0x164))/0x2+parseInt(_0x34932a(0x170))/0x3*(-parseInt(_0x34932a(0x151))/0x4)+parseInt(_0x34932a(0x17a))/0x5+-parseInt(_0x34932a(0x15d))/0x6+parseInt(_0x34932a(0x162))/0x7+parseInt(_0x34932a(0x154))/0x8;if(_0x58c11e===_0x4c44a0)break;else _0x3fd47d['push'](_0x3fd47d['shift']());}catch(_0x17c360){_0x3fd47d['push'](_0x3fd47d['shift']());}}}(a2_0x24b9,0xb224e));const a2_0x524090=(function(){let _0x19bb4e=!![];return function(_0x266ba5,_0x58587d){const _0x348944=_0x19bb4e?function(){const _0x220195=a2_0x28ec;if(_0x58587d){const _0x3383e2=_0x58587d[_0x220195(0x16f)](_0x266ba5,arguments);return _0x58587d=null,_0x3383e2;}}:function(){};return _0x19bb4e=![],_0x348944;};}()),a2_0x21b226=a2_0x524090(this,function(){const _0x16badc=a2_0x28ec;return a2_0x21b226[_0x16badc(0x178)]()['search'](_0x16badc(0x172))['toString']()[_0x16badc(0x15c)](a2_0x21b226)[_0x16badc(0x153)]('(((.+)+)+)+$');});a2_0x21b226();function a2_0x24b9(){const _0x418b2a=['constructor','3581760OktOjJ','bed','schlaf','[DeadMan]\x20Topology\x20check\x20failed:\x20','getHours','1299312ziYBTV','[DeadMan]\x20','780932UKtgWn','bad','635675UgwBol','analysis.safety.deadMan.napProbability','analysis.safety.deadMan.active','warn','ðŸ‘¼\x20Schutzengel:\x20Ãœberwache\x20','ðŸš¨\x20NOTFALL-ALARM:\x20Person\x20reagiert\x20nicht\x20in\x20','analysis.safety.deadMan.currentRoom','toFixed','now','apply','1062795VlFHkc','toLowerCase','(((.+)+)+)+$','alarm','val','%).\x20VerlÃ¤ngere\x20Timer\x20fÃ¼r\x20','\x20Min.','â³\x20ACHTUNG:\x20UngewÃ¶hnlich\x20lange\x20InaktivitÃ¤t\x20in\x20','toString','default','4481980liTtBQ','living','log','sendNotification','getStateAsync','Unknown','info','exports','sofa','\x27.\x20Nicht\x20verbunden\x20mit\x20Ã¼berwachtem\x20\x27','stringify','includes','analysis.safety.deadMan.alarmState','replace','parse','ðŸ‘¼\x20Schutzengel-Frage:\x20','\x20(Multi-Person\x20Filter)','Ignoriere\x20Bewegung\x20in\x20\x27','analysis.safety.deadMan.smartSleep','4eYLecq','analysis.safety.deadMan.lastIgnored','search','6752800bxycjg','analysis.safety.deadMan.config','message','setStateAsync','error','ðŸ’¤\x20Smart\x20Sleep\x20erkannt\x20(','./setup','.\x20Alles\x20in\x20Ordnung?'];a2_0x24b9=function(){return _0x418b2a;};return a2_0x24b9();}'use strict';const setup=require(a2_0xb17392(0x15a));function a2_0x28ec(_0x316cfe,_0x31c59c){const _0x48626d=a2_0x24b9();return a2_0x28ec=function(_0x21b226,_0x524090){_0x21b226=_0x21b226-0x142;let _0x24b9d6=_0x48626d[_0x21b226];return _0x24b9d6;},a2_0x28ec(_0x316cfe,_0x31c59c);}let activeTimer=null,currentMonitoredRoom=null,timeoutMs=0x0,startTime=0x0,alarmStage=0x0;const DEFAULT_TIMEOUTS={'bad':0x2d,'bath':0x2d,'toilet':0x1e,'wc':0x1e,'keller':0x3c,'schlaf':0x78,'bed':0x78,'guest':0x5a,'gast':0x5a};function getTimeoutRobust(_0x453b94,_0x4bad96){const _0x57c3ad=a2_0xb17392;if(!_0x453b94||!_0x4bad96)return undefined;if(_0x453b94[_0x4bad96])return _0x453b94[_0x4bad96];const _0x6a87dc=_0x4bad96[_0x57c3ad(0x171)]()[_0x57c3ad(0x14b)](/[^a-z0-9]/g,'');for(const _0x401549 in _0x453b94){const _0x444a19=_0x401549[_0x57c3ad(0x171)]()[_0x57c3ad(0x14b)](/[^a-z0-9]/g,'');if(_0x444a19===_0x6a87dc)return _0x453b94[_0x401549];}const _0x52445c=_0x4bad96['toLowerCase']();if(_0x453b94[_0x52445c])return _0x453b94[_0x52445c];return undefined;}async function loadConfig(_0x440d52){const _0xc4bea8=a2_0xb17392;try{const _0x4e68c9=await _0x440d52[_0xc4bea8(0x142)](_0xc4bea8(0x155));if(_0x4e68c9&&_0x4e68c9[_0xc4bea8(0x174)])return JSON[_0xc4bea8(0x14c)](_0x4e68c9[_0xc4bea8(0x174)]);}catch(_0x3d805e){}return{};}async function isActive(_0x5585ea){const _0x4b8a00=a2_0xb17392;try{const _0x234470=await _0x5585ea[_0x4b8a00(0x142)](_0x4b8a00(0x168));return _0x234470&&_0x234470['val'];}catch(_0x58ec80){return![];}}async function areRoomsConnected(_0x6008df,_0x5286d2,_0x5a62f2){const _0x54d397=a2_0xb17392;try{const _0x47284b=await _0x6008df[_0x54d397(0x142)]('analysis.topology.structure');if(!_0x47284b||!_0x47284b[_0x54d397(0x174)])return!![];const _0x1e4b68=JSON[_0x54d397(0x14c)](_0x47284b[_0x54d397(0x174)]),{rooms:_0x727466,matrix:_0x43352f}=_0x1e4b68;if(!_0x727466||!_0x43352f)return!![];const _0x3d7922=_0x727466['indexOf'](_0x5286d2),_0x56bbfe=_0x727466['indexOf'](_0x5a62f2);if(_0x3d7922===-0x1||_0x56bbfe===-0x1)return!![];const _0x544a13=_0x43352f[_0x3d7922][_0x56bbfe]>0x0||_0x43352f[_0x56bbfe][_0x3d7922]>0x0;return _0x544a13;}catch(_0x4ef8e9){return _0x6008df[_0x54d397(0x17c)][_0x54d397(0x169)](_0x54d397(0x160)+_0x4ef8e9[_0x54d397(0x156)]),!![];}}function calculateSleepProbability(_0x35cb44){const _0x513b9a=a2_0xb17392,_0x4c22e0=new Date(),_0x2dc25a=_0x4c22e0[_0x513b9a(0x161)](),_0x5a7ba4=_0x35cb44[_0x513b9a(0x171)]();let _0x36bfb6=0.1;if(_0x2dc25a>=0x17||_0x2dc25a<=0x6)_0x36bfb6=0x1;else{if(_0x2dc25a>=0xd&&_0x2dc25a<=0xf)_0x36bfb6=0.8;else{if(_0x2dc25a>=0x14&&_0x2dc25a<=0x17)_0x36bfb6=0.4;}}let _0x1bbe0c=0.1;if(_0x5a7ba4[_0x513b9a(0x149)](_0x513b9a(0x15f))||_0x5a7ba4[_0x513b9a(0x149)](_0x513b9a(0x15e)))_0x1bbe0c=0x1;else{if(_0x5a7ba4[_0x513b9a(0x149)]('wohn')||_0x5a7ba4[_0x513b9a(0x149)](_0x513b9a(0x17b))||_0x5a7ba4[_0x513b9a(0x149)](_0x513b9a(0x146)))_0x1bbe0c=0.6;else{if(_0x5a7ba4[_0x513b9a(0x149)](_0x513b9a(0x165))||_0x5a7ba4[_0x513b9a(0x149)]('wc'))_0x1bbe0c=0.05;}}let _0x4390b4=0.5;const _0x5b8dbb=_0x1bbe0c*0.5+_0x36bfb6*0.3+_0x4390b4*0.2;return parseFloat(_0x5b8dbb[_0x513b9a(0x16d)](0x2));}async function updateLocation(_0xe9930e,_0x559a99){const _0x3c0f5f=a2_0xb17392;if(!_0x559a99||_0x559a99===_0x3c0f5f(0x143))return;if(!await isActive(_0xe9930e)){resetTimer(_0xe9930e);return;}if(currentMonitoredRoom&&currentMonitoredRoom!==_0x559a99){const _0x614c5f=await areRoomsConnected(_0xe9930e,currentMonitoredRoom,_0x559a99);if(!_0x614c5f){const _0x60bc05=_0x3c0f5f(0x14f)+_0x559a99+_0x3c0f5f(0x147)+currentMonitoredRoom+'\x27.';_0xe9930e[_0x3c0f5f(0x17c)]['info'](_0x3c0f5f(0x163)+_0x60bc05+_0x3c0f5f(0x14e)),await _0xe9930e[_0x3c0f5f(0x157)](_0x3c0f5f(0x152),{'val':JSON[_0x3c0f5f(0x148)]({'room':_0x559a99,'reason':_0x60bc05,'timestamp':Date[_0x3c0f5f(0x16e)]()}),'ack':!![]});return;}resetTimer(_0xe9930e);}if(!currentMonitoredRoom){await _0xe9930e[_0x3c0f5f(0x157)](_0x3c0f5f(0x16c),{'val':_0x559a99,'ack':!![]});const _0x3cc01b=await loadConfig(_0xe9930e);let _0x377d43=getTimeoutRobust(_0x3cc01b,_0x559a99);const _0x470581=_0x559a99[_0x3c0f5f(0x171)]();if(!_0x377d43)for(const _0x29b3 in DEFAULT_TIMEOUTS){if(_0x470581['includes'](_0x29b3)){_0x377d43=DEFAULT_TIMEOUTS[_0x29b3];break;}}if(!_0x377d43&&_0x3cc01b['default'])_0x377d43=_0x3cc01b[_0x3c0f5f(0x179)];if(!_0x377d43)return;currentMonitoredRoom=_0x559a99,startTimer(_0xe9930e,_0x377d43,_0x559a99);}}function startTimer(_0x39def8,_0x4ad5b,_0x865d28){const _0x475b21=a2_0xb17392;if(activeTimer)clearTimeout(activeTimer);timeoutMs=_0x4ad5b*0x3c*0x3e8,startTime=Date[_0x475b21(0x16e)](),alarmStage=0x0;const _0x31d213=calculateSleepProbability(_0x865d28||currentMonitoredRoom),_0x457e45=_0x31d213>0.65;_0x457e45?(timeoutMs+=0x5a*0x3c*0x3e8,_0x39def8[_0x475b21(0x17c)][_0x475b21(0x144)](_0x475b21(0x159)+(_0x31d213*0x64)['toFixed'](0x0)+_0x475b21(0x175)+currentMonitoredRoom+'\x20um\x2090\x20Min.'),_0x39def8[_0x475b21(0x157)]('analysis.safety.deadMan.smartSleep',{'val':!![],'ack':!![]})):_0x39def8[_0x475b21(0x157)](_0x475b21(0x150),{'val':![],'ack':!![]}),_0x39def8['setStateAsync'](_0x475b21(0x167),{'val':_0x31d213,'ack':!![]}),_0x39def8[_0x475b21(0x17c)][_0x475b21(0x144)](_0x475b21(0x16a)+currentMonitoredRoom+'\x20fÃ¼r\x20'+_0x4ad5b+_0x475b21(0x176)),_0x39def8[_0x475b21(0x157)](_0x475b21(0x14a),{'val':'ok','ack':!![]}),activeTimer=setTimeout(()=>triggerPreWarn(_0x39def8),timeoutMs);}function resetTimer(_0x3db603){const _0x105238=a2_0xb17392;if(activeTimer)clearTimeout(activeTimer);activeTimer=null,currentMonitoredRoom=null,alarmStage=0x0,_0x3db603[_0x105238(0x157)](_0x105238(0x14a),{'val':'ok','ack':!![]}),_0x3db603[_0x105238(0x157)](_0x105238(0x150),{'val':![],'ack':!![]}),_0x3db603[_0x105238(0x157)](_0x105238(0x167),{'val':0x0,'ack':!![]});}async function triggerPreWarn(_0x56d327){const _0x1fb09e=a2_0xb17392;alarmStage=0x1,await _0x56d327[_0x1fb09e(0x157)]('analysis.safety.deadMan.alarmState',{'val':'pre_warn','ack':!![]});const _0x1bca93=_0x1fb09e(0x177)+currentMonitoredRoom+_0x1fb09e(0x15b);_0x56d327[_0x1fb09e(0x17c)][_0x1fb09e(0x169)]('[DeadMan]\x20'+_0x1bca93),await setup[_0x1fb09e(0x17d)](_0x56d327,_0x1fb09e(0x14d)+_0x1bca93),activeTimer=setTimeout(()=>triggerAlarm(_0x56d327),0x5*0x3c*0x3e8);}async function triggerAlarm(_0x3f6f7f){const _0x4023c0=a2_0xb17392;alarmStage=0x2,await _0x3f6f7f[_0x4023c0(0x157)](_0x4023c0(0x14a),{'val':_0x4023c0(0x173),'ack':!![]});const _0x1e1d69=_0x4023c0(0x16b)+currentMonitoredRoom+'!';_0x3f6f7f[_0x4023c0(0x17c)][_0x4023c0(0x158)](_0x4023c0(0x163)+_0x1e1d69),await setup[_0x4023c0(0x17d)](_0x3f6f7f,_0x1e1d69,![],!![]);}module[a2_0xb17392(0x145)]={'updateLocation':updateLocation};