const a2_0x146a2e=a2_0x5951;(function(_0x1023eb,_0x1e0e3e){const _0x269957=a2_0x5951,_0x1747b6=_0x1023eb();while(!![]){try{const _0x3017e2=-parseInt(_0x269957(0x1c2))/0x1*(parseInt(_0x269957(0x1b6))/0x2)+parseInt(_0x269957(0x1c5))/0x3*(parseInt(_0x269957(0x1c7))/0x4)+parseInt(_0x269957(0x1c1))/0x5+-parseInt(_0x269957(0x1ca))/0x6+-parseInt(_0x269957(0x1d1))/0x7*(-parseInt(_0x269957(0x1cc))/0x8)+parseInt(_0x269957(0x1b3))/0x9+-parseInt(_0x269957(0x1d8))/0xa*(-parseInt(_0x269957(0x1da))/0xb);if(_0x3017e2===_0x1e0e3e)break;else _0x1747b6['push'](_0x1747b6['shift']());}catch(_0x4b231a){_0x1747b6['push'](_0x1747b6['shift']());}}}(a2_0x3688,0x496da));const a2_0x441079=(function(){let _0x764263=!![];return function(_0x17d73f,_0x58a4ac){const _0x36a67d=_0x764263?function(){if(_0x58a4ac){const _0x723985=_0x58a4ac['apply'](_0x17d73f,arguments);return _0x58a4ac=null,_0x723985;}}:function(){};return _0x764263=![],_0x36a67d;};}()),a2_0x4cf088=a2_0x441079(this,function(){const _0x24f39e=a2_0x5951;return a2_0x4cf088[_0x24f39e(0x1b7)]()[_0x24f39e(0x1be)](_0x24f39e(0x1c8))[_0x24f39e(0x1b7)]()['constructor'](a2_0x4cf088)[_0x24f39e(0x1be)]('(((.+)+)+)+$');});a2_0x4cf088();'use strict';const setup=require(a2_0x146a2e(0x1cb));let activeTimer=null,currentMonitoredRoom=null,timeoutMs=0x0,startTime=0x0,alarmStage=0x0;const DEFAULT_TIMEOUTS={'bad':0x2d,'bath':0x2d,'toilet':0x1e,'wc':0x1e,'keller':0x3c,'schlaf':0x78,'bed':0x78,'guest':0x5a,'gast':0x5a};function a2_0x5951(_0x326cf7,_0x14f7ef){const _0x31df2a=a2_0x3688();return a2_0x5951=function(_0x4cf088,_0x441079){_0x4cf088=_0x4cf088-0x1af;let _0x3688a5=_0x31df2a[_0x4cf088];return _0x3688a5;},a2_0x5951(_0x326cf7,_0x14f7ef);}async function loadConfig(_0xaab135){const _0x231376=a2_0x146a2e;try{const _0x2a0aa0=await _0xaab135[_0x231376(0x1b0)]('analysis.safety.deadMan.config');if(_0x2a0aa0&&_0x2a0aa0['val'])return JSON[_0x231376(0x1ce)](_0x2a0aa0[_0x231376(0x1b1)]);}catch(_0x299ff2){}return{};}async function isActive(_0x137d54){const _0x5e3df2=a2_0x146a2e;try{const _0x432089=await _0x137d54[_0x5e3df2(0x1b0)](_0x5e3df2(0x1d3));return _0x432089&&_0x432089[_0x5e3df2(0x1b1)];}catch(_0x4059bc){return![];}}async function areRoomsConnected(_0x486966,_0x44a776,_0x49f052){const _0x20ac2f=a2_0x146a2e;try{const _0xd7aee0=await _0x486966[_0x20ac2f(0x1b0)]('analysis.topology.structure');if(!_0xd7aee0||!_0xd7aee0[_0x20ac2f(0x1b1)])return!![];const _0x2d3491=JSON[_0x20ac2f(0x1ce)](_0xd7aee0['val']),{rooms:_0x128439,matrix:_0x525b1b}=_0x2d3491;if(!_0x128439||!_0x525b1b)return!![];const _0x243497=_0x128439[_0x20ac2f(0x1df)](_0x44a776),_0x5bcdbc=_0x128439[_0x20ac2f(0x1df)](_0x49f052);if(_0x243497===-0x1||_0x5bcdbc===-0x1)return!![];const _0x1b53d7=_0x525b1b[_0x243497][_0x5bcdbc]>0x0||_0x525b1b[_0x5bcdbc][_0x243497]>0x0;return _0x1b53d7;}catch(_0x5fbf2d){return _0x486966[_0x20ac2f(0x1d4)][_0x20ac2f(0x1d6)](_0x20ac2f(0x1ba)+_0x5fbf2d[_0x20ac2f(0x1d0)]),!![];}}function calculateSleepProbability(_0x35510f){const _0x511640=a2_0x146a2e,_0x2d4167=new Date(),_0x1cba5d=_0x2d4167[_0x511640(0x1b5)](),_0x8e4dcf=_0x35510f[_0x511640(0x1d7)]();let _0x441297=0.1;if(_0x1cba5d>=0x17||_0x1cba5d<=0x6)_0x441297=0x1;else{if(_0x1cba5d>=0xd&&_0x1cba5d<=0xf)_0x441297=0.8;else{if(_0x1cba5d>=0x14&&_0x1cba5d<=0x17)_0x441297=0.4;}}let _0x3f0d43=0.1;if(_0x8e4dcf['includes'](_0x511640(0x1b4))||_0x8e4dcf[_0x511640(0x1cf)]('bed'))_0x3f0d43=0x1;else{if(_0x8e4dcf[_0x511640(0x1cf)](_0x511640(0x1e3))||_0x8e4dcf[_0x511640(0x1cf)](_0x511640(0x1bb))||_0x8e4dcf['includes'](_0x511640(0x1e0)))_0x3f0d43=0.6;else{if(_0x8e4dcf[_0x511640(0x1cf)](_0x511640(0x1de))||_0x8e4dcf[_0x511640(0x1cf)]('wc'))_0x3f0d43=0.05;}}let _0x9480f4=0.5;const _0x357298=_0x3f0d43*0.5+_0x441297*0.3+_0x9480f4*0.2;return parseFloat(_0x357298['toFixed'](0x2));}async function updateLocation(_0x249b33,_0x150d81){const _0x1c901f=a2_0x146a2e;if(!_0x150d81||_0x150d81===_0x1c901f(0x1d9))return;if(!await isActive(_0x249b33)){resetTimer(_0x249b33);return;}if(currentMonitoredRoom&&currentMonitoredRoom!==_0x150d81){const _0x87f41=await areRoomsConnected(_0x249b33,currentMonitoredRoom,_0x150d81);if(!_0x87f41){const _0x12293b='Ignoriere\x20Bewegung\x20in\x20\x27'+_0x150d81+'\x27.\x20Nicht\x20verbunden\x20mit\x20√ºberwachtem\x20\x27'+currentMonitoredRoom+'\x27.';_0x249b33[_0x1c901f(0x1d4)][_0x1c901f(0x1bd)](_0x1c901f(0x1b2)+_0x12293b+_0x1c901f(0x1db)),await _0x249b33[_0x1c901f(0x1cd)]('analysis.safety.deadMan.lastIgnored',{'val':JSON['stringify']({'room':_0x150d81,'reason':_0x12293b,'timestamp':Date[_0x1c901f(0x1dd)]()}),'ack':!![]});return;}resetTimer(_0x249b33);}if(!currentMonitoredRoom){await _0x249b33[_0x1c901f(0x1cd)](_0x1c901f(0x1c6),{'val':_0x150d81,'ack':!![]});const _0x2bc917=await loadConfig(_0x249b33),_0x511b3a=_0x150d81[_0x1c901f(0x1d7)]();let _0x3d542f=_0x2bc917[_0x150d81]||_0x2bc917[_0x511b3a];if(!_0x3d542f)for(const _0x4e7bd3 in DEFAULT_TIMEOUTS){if(_0x511b3a['includes'](_0x4e7bd3)){_0x3d542f=DEFAULT_TIMEOUTS[_0x4e7bd3];break;}}if(!_0x3d542f&&_0x2bc917['default'])_0x3d542f=_0x2bc917[_0x1c901f(0x1e5)];if(!_0x3d542f)return;currentMonitoredRoom=_0x150d81,startTimer(_0x249b33,_0x3d542f,_0x150d81);}}function startTimer(_0x113c76,_0x486178,_0x70283d){const _0xf00ece=a2_0x146a2e;if(activeTimer)clearTimeout(activeTimer);timeoutMs=_0x486178*0x3c*0x3e8,startTime=Date[_0xf00ece(0x1dd)](),alarmStage=0x0;const _0x4b4637=calculateSleepProbability(_0x70283d||currentMonitoredRoom),_0x2ad53c=_0x4b4637>0.65;_0x2ad53c?(timeoutMs+=0x5a*0x3c*0x3e8,_0x113c76['log'][_0xf00ece(0x1bd)]('üí§\x20Smart\x20Sleep\x20erkannt\x20('+(_0x4b4637*0x64)[_0xf00ece(0x1e1)](0x0)+_0xf00ece(0x1e2)+currentMonitoredRoom+'\x20um\x2090\x20Min.'),_0x113c76['setStateAsync'](_0xf00ece(0x1bf),{'val':!![],'ack':!![]})):_0x113c76[_0xf00ece(0x1cd)](_0xf00ece(0x1bf),{'val':![],'ack':!![]}),_0x113c76[_0xf00ece(0x1cd)](_0xf00ece(0x1e4),{'val':_0x4b4637,'ack':!![]}),_0x113c76['log'][_0xf00ece(0x1bd)](_0xf00ece(0x1af)+currentMonitoredRoom+_0xf00ece(0x1c4)+_0x486178+_0xf00ece(0x1bc)),_0x113c76[_0xf00ece(0x1cd)](_0xf00ece(0x1b8),{'val':'ok','ack':!![]}),activeTimer=setTimeout(()=>triggerPreWarn(_0x113c76),timeoutMs);}function resetTimer(_0x246b74){const _0x19d7e9=a2_0x146a2e;if(activeTimer)clearTimeout(activeTimer);activeTimer=null,currentMonitoredRoom=null,alarmStage=0x0,_0x246b74['setStateAsync'](_0x19d7e9(0x1b8),{'val':'ok','ack':!![]}),_0x246b74['setStateAsync'](_0x19d7e9(0x1bf),{'val':![],'ack':!![]}),_0x246b74['setStateAsync']('analysis.safety.deadMan.napProbability',{'val':0x0,'ack':!![]});}async function triggerPreWarn(_0x535e50){const _0x45374f=a2_0x146a2e;alarmStage=0x1,await _0x535e50['setStateAsync']('analysis.safety.deadMan.alarmState',{'val':_0x45374f(0x1c3),'ack':!![]});const _0x4fa440=_0x45374f(0x1c9)+currentMonitoredRoom+'.\x20Alles\x20in\x20Ordnung?';_0x535e50[_0x45374f(0x1d4)]['warn'](_0x45374f(0x1b2)+_0x4fa440),await setup[_0x45374f(0x1c0)](_0x535e50,_0x45374f(0x1dc)+_0x4fa440),activeTimer=setTimeout(()=>triggerAlarm(_0x535e50),0x5*0x3c*0x3e8);}async function triggerAlarm(_0x2e909b){const _0x2afca7=a2_0x146a2e;alarmStage=0x2,await _0x2e909b[_0x2afca7(0x1cd)](_0x2afca7(0x1b8),{'val':_0x2afca7(0x1d2),'ack':!![]});const _0x172a71='üö®\x20NOTFALL-ALARM:\x20Person\x20reagiert\x20nicht\x20in\x20'+currentMonitoredRoom+'!';_0x2e909b[_0x2afca7(0x1d4)][_0x2afca7(0x1b9)]('[DeadMan]\x20'+_0x172a71),await setup['sendNotification'](_0x2e909b,_0x172a71,![],!![]);}module[a2_0x146a2e(0x1d5)]={'updateLocation':updateLocation};function a2_0x3688(){const _0x7d1d=['\x20f√ºr\x20','69jhjiJd','analysis.safety.deadMan.currentRoom','69532ZGXuuI','(((.+)+)+)+$','‚è≥\x20ACHTUNG:\x20Ungew√∂hnlich\x20lange\x20Inaktivit√§t\x20in\x20','2644224xPhiUA','./setup','32nOXAVv','setStateAsync','parse','includes','message','21469NvzIxd','alarm','analysis.safety.deadMan.active','log','exports','warn','toLowerCase','300PKZhBy','Unknown','31427wHGKOD','\x20(Multi-Person\x20Filter)','üëº\x20Schutzengel-Frage:\x20','now','bad','indexOf','sofa','toFixed','%).\x20Verl√§ngere\x20Timer\x20f√ºr\x20','wohn','analysis.safety.deadMan.napProbability','default','üëº\x20Schutzengel:\x20√úberwache\x20','getStateAsync','val','[DeadMan]\x20','1834812fLZjiq','schlaf','getHours','47934vyIGBW','toString','analysis.safety.deadMan.alarmState','error','[DeadMan]\x20Topology\x20check\x20failed:\x20','living','\x20Min.','info','search','analysis.safety.deadMan.smartSleep','sendNotification','1397405ZOewdc','10voiKyI','pre_warn'];a2_0x3688=function(){return _0x7d1d;};return a2_0x3688();}