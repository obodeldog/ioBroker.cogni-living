const a2_0x277cb7=a2_0x23b2;(function(_0x304ef8,_0x340fd5){const _0x19fee0=a2_0x23b2,_0x11533d=_0x304ef8();while(!![]){try{const _0x5476a2=parseInt(_0x19fee0(0x1f4))/0x1*(-parseInt(_0x19fee0(0x21a))/0x2)+parseInt(_0x19fee0(0x217))/0x3*(-parseInt(_0x19fee0(0x212))/0x4)+parseInt(_0x19fee0(0x21d))/0x5*(-parseInt(_0x19fee0(0x1fb))/0x6)+parseInt(_0x19fee0(0x206))/0x7*(-parseInt(_0x19fee0(0x207))/0x8)+parseInt(_0x19fee0(0x224))/0x9*(parseInt(_0x19fee0(0x220))/0xa)+parseInt(_0x19fee0(0x1f7))/0xb+-parseInt(_0x19fee0(0x214))/0xc*(-parseInt(_0x19fee0(0x21e))/0xd);if(_0x5476a2===_0x340fd5)break;else _0x11533d['push'](_0x11533d['shift']());}catch(_0x3e4234){_0x11533d['push'](_0x11533d['shift']());}}}(a2_0x43fd,0x75fa0));const a2_0x97f744=(function(){let _0x1096e9=!![];return function(_0x5980f1,_0x1920ea){const _0x269100=_0x1096e9?function(){const _0x17f33b=a2_0x23b2;if(_0x1920ea){const _0x3e1f8c=_0x1920ea[_0x17f33b(0x22e)](_0x5980f1,arguments);return _0x1920ea=null,_0x3e1f8c;}}:function(){};return _0x1096e9=![],_0x269100;};}()),a2_0x3e4151=a2_0x97f744(this,function(){const _0x5077d0=a2_0x23b2;return a2_0x3e4151[_0x5077d0(0x223)]()[_0x5077d0(0x203)](_0x5077d0(0x1fd))[_0x5077d0(0x223)]()[_0x5077d0(0x208)](a2_0x3e4151)[_0x5077d0(0x203)](_0x5077d0(0x1fd));});function a2_0x43fd(){const _0x23ad89=['ðŸ‘¼\x20Schutzengel-Frage:\x20','(((.+)+)+)+$','val','analysis.safety.deadMan.lastIgnored','wohn','./setup','exports','search','pre_warn','analysis.safety.deadMan.napProbability','252nHJIZc','206552LjKEbP','constructor','analysis.safety.deadMan.alarmState','toLowerCase','ðŸ’¤\x20Smart\x20Sleep\x20erkannt\x20(','analysis.topology.structure','alarm','setStateAsync','log','sendNotification','schlaf','4THZtex','bed','3065628lxJBbi','getStateAsync','message','2891919uGHXHE','living','\x20um\x2090\x20Min.','2GQovhd','includes','analysis.safety.deadMan.smartSleep','719725QhVVTK','117pXfEGJ','ðŸš¨\x20NOTFALL-ALARM:\x20Person\x20reagiert\x20nicht\x20in\x20','24020dwGorC','indexOf','replace','toString','1899IniXrS','error','analysis.safety.deadMan.config','now','ðŸ‘¼\x20Schutzengel:\x20Ãœberwache\x20','warn','\x20fÃ¼r\x20','parse','bad','[DeadMan]\x20Topology\x20check\x20failed:\x20','apply','\x27.\x20Nicht\x20verbunden\x20mit\x20Ã¼berwachtem\x20\x27','648257ieNzpJ','[DeadMan]\x20','analysis.safety.deadMan.active','3991328iPIVCD','toFixed','info','\x20(Multi-Person\x20Filter)','6ujwfKt'];a2_0x43fd=function(){return _0x23ad89;};return a2_0x43fd();}a2_0x3e4151();'use strict';const setup=require(a2_0x277cb7(0x201));let activeTimer=null,currentMonitoredRoom=null,timeoutMs=0x0,startTime=0x0,alarmStage=0x0;const DEFAULT_TIMEOUTS={'bad':0x2d,'bath':0x2d,'toilet':0x1e,'wc':0x1e,'keller':0x3c,'schlaf':0x78,'bed':0x78,'guest':0x5a,'gast':0x5a};function getTimeoutRobust(_0x254a2e,_0x56f9f2){const _0x1a896e=a2_0x277cb7;if(!_0x254a2e||!_0x56f9f2)return undefined;if(_0x254a2e[_0x56f9f2])return _0x254a2e[_0x56f9f2];const _0x47b3c3=_0x56f9f2[_0x1a896e(0x20a)]()['replace'](/[^a-z0-9]/g,'');for(const _0x23590f in _0x254a2e){const _0x34b8ec=_0x23590f[_0x1a896e(0x20a)]()[_0x1a896e(0x222)](/[^a-z0-9]/g,'');if(_0x34b8ec===_0x47b3c3)return _0x254a2e[_0x23590f];}const _0x82e9c1=_0x56f9f2[_0x1a896e(0x20a)]();if(_0x254a2e[_0x82e9c1])return _0x254a2e[_0x82e9c1];return undefined;}async function loadConfig(_0x1be8a0){const _0x394547=a2_0x277cb7;try{const _0x23452b=await _0x1be8a0[_0x394547(0x215)](_0x394547(0x226));if(_0x23452b&&_0x23452b[_0x394547(0x1fe)])return JSON['parse'](_0x23452b[_0x394547(0x1fe)]);}catch(_0x5795d6){}return{};}async function isActive(_0x3d816e){const _0x530362=a2_0x277cb7;try{const _0x14f07a=await _0x3d816e[_0x530362(0x215)](_0x530362(0x1f6));return _0x14f07a&&_0x14f07a[_0x530362(0x1fe)];}catch(_0x59b750){return![];}}async function areRoomsConnected(_0x149e15,_0x53f3f7,_0x5d2696){const _0x501855=a2_0x277cb7;try{const _0x580ba1=await _0x149e15[_0x501855(0x215)](_0x501855(0x20c));if(!_0x580ba1||!_0x580ba1[_0x501855(0x1fe)])return!![];const _0x1008c3=JSON[_0x501855(0x22b)](_0x580ba1[_0x501855(0x1fe)]),{rooms:_0x28ea84,matrix:_0x306c46}=_0x1008c3;if(!_0x28ea84||!_0x306c46)return!![];const _0x44d6f1=_0x28ea84[_0x501855(0x221)](_0x53f3f7),_0x5b1853=_0x28ea84[_0x501855(0x221)](_0x5d2696);if(_0x44d6f1===-0x1||_0x5b1853===-0x1)return!![];const _0x405cc3=_0x306c46[_0x44d6f1][_0x5b1853]>0x0||_0x306c46[_0x5b1853][_0x44d6f1]>0x0;return _0x405cc3;}catch(_0x35bf03){return _0x149e15[_0x501855(0x20f)][_0x501855(0x229)](_0x501855(0x22d)+_0x35bf03[_0x501855(0x216)]),!![];}}function calculateSleepProbability(_0x4cfbb7){const _0xeb21dc=a2_0x277cb7,_0x4926ba=new Date(),_0xd232c2=_0x4926ba['getHours'](),_0x49fdcb=_0x4cfbb7[_0xeb21dc(0x20a)]();let _0x5591a8=0.1;if(_0xd232c2>=0x17||_0xd232c2<=0x6)_0x5591a8=0x1;else{if(_0xd232c2>=0xd&&_0xd232c2<=0xf)_0x5591a8=0.8;else{if(_0xd232c2>=0x14&&_0xd232c2<=0x17)_0x5591a8=0.4;}}let _0x239261=0.1;if(_0x49fdcb['includes'](_0xeb21dc(0x211))||_0x49fdcb[_0xeb21dc(0x21b)](_0xeb21dc(0x213)))_0x239261=0x1;else{if(_0x49fdcb['includes'](_0xeb21dc(0x200))||_0x49fdcb['includes'](_0xeb21dc(0x218))||_0x49fdcb[_0xeb21dc(0x21b)]('sofa'))_0x239261=0.6;else{if(_0x49fdcb[_0xeb21dc(0x21b)](_0xeb21dc(0x22c))||_0x49fdcb[_0xeb21dc(0x21b)]('wc'))_0x239261=0.05;}}let _0x4baa25=0.5;const _0x45c330=_0x239261*0.5+_0x5591a8*0.3+_0x4baa25*0.2;return parseFloat(_0x45c330[_0xeb21dc(0x1f8)](0x2));}async function updateLocation(_0x4223e0,_0x1ec45d){const _0x1173b0=a2_0x277cb7;if(!_0x1ec45d||_0x1ec45d==='Unknown')return;if(!await isActive(_0x4223e0)){resetTimer(_0x4223e0);return;}if(currentMonitoredRoom&&currentMonitoredRoom!==_0x1ec45d){const _0x2a4ad1=await areRoomsConnected(_0x4223e0,currentMonitoredRoom,_0x1ec45d);if(!_0x2a4ad1){const _0x337b70='Ignoriere\x20Bewegung\x20in\x20\x27'+_0x1ec45d+_0x1173b0(0x22f)+currentMonitoredRoom+'\x27.';_0x4223e0[_0x1173b0(0x20f)]['info'](_0x1173b0(0x1f5)+_0x337b70+_0x1173b0(0x1fa)),await _0x4223e0[_0x1173b0(0x20e)](_0x1173b0(0x1ff),{'val':JSON['stringify']({'room':_0x1ec45d,'reason':_0x337b70,'timestamp':Date[_0x1173b0(0x227)]()}),'ack':!![]});return;}resetTimer(_0x4223e0);}if(!currentMonitoredRoom){await _0x4223e0['setStateAsync']('analysis.safety.deadMan.currentRoom',{'val':_0x1ec45d,'ack':!![]});const _0xbf53e8=await loadConfig(_0x4223e0);let _0xd00373=getTimeoutRobust(_0xbf53e8,_0x1ec45d);const _0x4cd635=_0x1ec45d[_0x1173b0(0x20a)]();if(!_0xd00373)for(const _0x36c642 in DEFAULT_TIMEOUTS){if(_0x4cd635['includes'](_0x36c642)){_0xd00373=DEFAULT_TIMEOUTS[_0x36c642];break;}}if(!_0xd00373&&_0xbf53e8['default'])_0xd00373=_0xbf53e8['default'];if(!_0xd00373)return;currentMonitoredRoom=_0x1ec45d,startTimer(_0x4223e0,_0xd00373,_0x1ec45d);}}function a2_0x23b2(_0x302857,_0x15d895){const _0x24d181=a2_0x43fd();return a2_0x23b2=function(_0x3e4151,_0x97f744){_0x3e4151=_0x3e4151-0x1f4;let _0x43fd4a=_0x24d181[_0x3e4151];return _0x43fd4a;},a2_0x23b2(_0x302857,_0x15d895);}function startTimer(_0x5dd283,_0x3c4578,_0x452342){const _0x2649d3=a2_0x277cb7;if(activeTimer)clearTimeout(activeTimer);timeoutMs=_0x3c4578*0x3c*0x3e8,startTime=Date[_0x2649d3(0x227)](),alarmStage=0x0;const _0x4fde73=calculateSleepProbability(_0x452342||currentMonitoredRoom),_0x3679dc=_0x4fde73>0.65;_0x3679dc?(timeoutMs+=0x5a*0x3c*0x3e8,_0x5dd283[_0x2649d3(0x20f)][_0x2649d3(0x1f9)](_0x2649d3(0x20b)+(_0x4fde73*0x64)[_0x2649d3(0x1f8)](0x0)+'%).\x20VerlÃ¤ngere\x20Timer\x20fÃ¼r\x20'+currentMonitoredRoom+_0x2649d3(0x219)),_0x5dd283[_0x2649d3(0x20e)](_0x2649d3(0x21c),{'val':!![],'ack':!![]})):_0x5dd283[_0x2649d3(0x20e)](_0x2649d3(0x21c),{'val':![],'ack':!![]}),_0x5dd283['setStateAsync'](_0x2649d3(0x205),{'val':_0x4fde73,'ack':!![]}),_0x5dd283['log'][_0x2649d3(0x1f9)](_0x2649d3(0x228)+currentMonitoredRoom+_0x2649d3(0x22a)+_0x3c4578+'\x20Min.'),_0x5dd283[_0x2649d3(0x20e)](_0x2649d3(0x209),{'val':'ok','ack':!![]}),activeTimer=setTimeout(()=>triggerPreWarn(_0x5dd283),timeoutMs);}function resetTimer(_0x291fef){const _0x2daadb=a2_0x277cb7;if(activeTimer)clearTimeout(activeTimer);activeTimer=null,currentMonitoredRoom=null,alarmStage=0x0,_0x291fef['setStateAsync'](_0x2daadb(0x209),{'val':'ok','ack':!![]}),_0x291fef[_0x2daadb(0x20e)](_0x2daadb(0x21c),{'val':![],'ack':!![]}),_0x291fef[_0x2daadb(0x20e)](_0x2daadb(0x205),{'val':0x0,'ack':!![]});}async function triggerPreWarn(_0x1fe41c){const _0x2ca7e0=a2_0x277cb7;alarmStage=0x1,await _0x1fe41c[_0x2ca7e0(0x20e)](_0x2ca7e0(0x209),{'val':_0x2ca7e0(0x204),'ack':!![]});const _0x129858='â³\x20ACHTUNG:\x20UngewÃ¶hnlich\x20lange\x20InaktivitÃ¤t\x20in\x20'+currentMonitoredRoom+'.\x20Alles\x20in\x20Ordnung?';_0x1fe41c[_0x2ca7e0(0x20f)]['warn']('[DeadMan]\x20'+_0x129858),await setup['sendNotification'](_0x1fe41c,_0x2ca7e0(0x1fc)+_0x129858),activeTimer=setTimeout(()=>triggerAlarm(_0x1fe41c),0x5*0x3c*0x3e8);}async function triggerAlarm(_0x99758f){const _0x235fd7=a2_0x277cb7;alarmStage=0x2,await _0x99758f[_0x235fd7(0x20e)](_0x235fd7(0x209),{'val':_0x235fd7(0x20d),'ack':!![]});const _0x920165=_0x235fd7(0x21f)+currentMonitoredRoom+'!';_0x99758f['log'][_0x235fd7(0x225)](_0x235fd7(0x1f5)+_0x920165),await setup[_0x235fd7(0x210)](_0x99758f,_0x920165,![],!![]);}module[a2_0x277cb7(0x202)]={'updateLocation':updateLocation};