const a2_0x4559a6=a2_0x2d6e;(function(_0x3a37da,_0x3cbe15){const _0xf745a9=a2_0x2d6e,_0x4466e2=_0x3a37da();while(!![]){try{const _0x2409e2=-parseInt(_0xf745a9(0x1c1))/0x1+parseInt(_0xf745a9(0x1bb))/0x2*(parseInt(_0xf745a9(0x1d0))/0x3)+-parseInt(_0xf745a9(0x1b8))/0x4+-parseInt(_0xf745a9(0x1bf))/0x5+parseInt(_0xf745a9(0x1c9))/0x6*(parseInt(_0xf745a9(0x1b3))/0x7)+parseInt(_0xf745a9(0x1c4))/0x8+-parseInt(_0xf745a9(0x1d1))/0x9*(-parseInt(_0xf745a9(0x1b9))/0xa);if(_0x2409e2===_0x3cbe15)break;else _0x4466e2['push'](_0x4466e2['shift']());}catch(_0x57b2bb){_0x4466e2['push'](_0x4466e2['shift']());}}}(a2_0x22c8,0x66aa4));const a2_0x7aa986=(function(){let _0x3e25f1=!![];return function(_0x1423fc,_0x3c0b96){const _0x5cb383=_0x3e25f1?function(){const _0x415127=a2_0x2d6e;if(_0x3c0b96){const _0x54643c=_0x3c0b96[_0x415127(0x1e3)](_0x1423fc,arguments);return _0x3c0b96=null,_0x54643c;}}:function(){};return _0x3e25f1=![],_0x5cb383;};}()),a2_0x529e60=a2_0x7aa986(this,function(){const _0x2bf79a=a2_0x2d6e;return a2_0x529e60['toString']()[_0x2bf79a(0x1e0)](_0x2bf79a(0x1d3))[_0x2bf79a(0x1ae)]()[_0x2bf79a(0x1ad)](a2_0x529e60)[_0x2bf79a(0x1e0)](_0x2bf79a(0x1d3));});a2_0x529e60();'use strict';const setup=require(a2_0x4559a6(0x1c8));function a2_0x2d6e(_0x97d1ab,_0x32440a){const _0x5e1779=a2_0x22c8();return a2_0x2d6e=function(_0x529e60,_0x7aa986){_0x529e60=_0x529e60-0x1aa;let _0x22c844=_0x5e1779[_0x529e60];return _0x22c844;},a2_0x2d6e(_0x97d1ab,_0x32440a);}let activeTimer=null,currentMonitoredRoom=null,timeoutMs=0x0,startTime=0x0,alarmStage=0x0;const DEFAULT_TIMEOUTS={'bad':0x2d,'bath':0x2d,'toilet':0x1e,'wc':0x1e,'keller':0x3c,'schlaf':0x78,'bed':0x78,'guest':0x5a,'gast':0x5a};function a2_0x22c8(){const _0x20d2ff=['apply','analysis.topology.structure','val','indexOf','constructor','toString','warn','[DeadMan]\x20','analysis.safety.deadMan.alarmState','[DeadMan]\x20Topology\x20check\x20failed:\x20','2015986zxrvFG','schlaf','sofa','ðŸ‘¼\x20Schutzengel:\x20Ãœberwache\x20','toLowerCase','1492752JXwlaD','2564910aGsrgc','\x20um\x2090\x20Min.','10BXsMPk','pre_warn','ðŸ‘¼\x20Schutzengel-Frage:\x20','analysis.safety.deadMan.smartSleep','3209770stlcuo','living','173165vEVSky','\x27.\x20Nicht\x20verbunden\x20mit\x20Ã¼berwachtem\x20\x27','getStateAsync','1855272BRwblh','analysis.safety.deadMan.napProbability','exports','â³\x20ACHTUNG:\x20UngewÃ¶hnlich\x20lange\x20InaktivitÃ¤t\x20in\x20','./setup','12UZIrWA','info','\x20Min.','default','analysis.safety.deadMan.currentRoom','\x20fÃ¼r\x20','now','18867jZRqdQ','27WvBPDX','ðŸš¨\x20NOTFALL-ALARM:\x20Person\x20reagiert\x20nicht\x20in\x20','(((.+)+)+)+$','replace','log','Unknown','sendNotification','setStateAsync','%).\x20VerlÃ¤ngere\x20Timer\x20fÃ¼r\x20','includes','\x20(Multi-Person\x20Filter)','toFixed','bed','.\x20Alles\x20in\x20Ordnung?','parse','search','wohn','ðŸ’¤\x20Smart\x20Sleep\x20erkannt\x20('];a2_0x22c8=function(){return _0x20d2ff;};return a2_0x22c8();}function getTimeoutRobust(_0x213f07,_0x1d0847){const _0x78de35=a2_0x4559a6;if(!_0x213f07||!_0x1d0847)return undefined;if(_0x213f07[_0x1d0847])return _0x213f07[_0x1d0847];const _0x5969d2=_0x1d0847[_0x78de35(0x1b7)]()[_0x78de35(0x1d4)](/[^a-z0-9]/g,'');for(const _0x137a17 in _0x213f07){const _0x20addf=_0x137a17[_0x78de35(0x1b7)]()[_0x78de35(0x1d4)](/[^a-z0-9]/g,'');if(_0x20addf===_0x5969d2)return _0x213f07[_0x137a17];}const _0x2670d1=_0x1d0847[_0x78de35(0x1b7)]();if(_0x213f07[_0x2670d1])return _0x213f07[_0x2670d1];return undefined;}async function loadConfig(_0x47645c){const _0x5193fc=a2_0x4559a6;try{const _0x5a7afc=await _0x47645c[_0x5193fc(0x1c3)]('analysis.safety.deadMan.config');if(_0x5a7afc&&_0x5a7afc[_0x5193fc(0x1ab)])return JSON['parse'](_0x5a7afc[_0x5193fc(0x1ab)]);}catch(_0x5f2131){}return{};}async function isActive(_0x35b5c2){const _0x3210c4=a2_0x4559a6;try{const _0xc3fb52=await _0x35b5c2[_0x3210c4(0x1c3)]('analysis.safety.deadMan.active');return _0xc3fb52&&_0xc3fb52['val'];}catch(_0x3f0c29){return![];}}async function areRoomsConnected(_0x4fcbf4,_0x49c03b,_0xb89a8){const _0x17032e=a2_0x4559a6;try{const _0x2ebf64=await _0x4fcbf4[_0x17032e(0x1c3)](_0x17032e(0x1aa));if(!_0x2ebf64||!_0x2ebf64[_0x17032e(0x1ab)])return!![];const _0x3b3223=JSON[_0x17032e(0x1df)](_0x2ebf64['val']),{rooms:_0x59dc24,matrix:_0x37801e}=_0x3b3223;if(!_0x59dc24||!_0x37801e)return!![];const _0x100f90=_0x59dc24[_0x17032e(0x1ac)](_0x49c03b),_0x379d4d=_0x59dc24[_0x17032e(0x1ac)](_0xb89a8);if(_0x100f90===-0x1||_0x379d4d===-0x1)return!![];const _0x27acdd=_0x37801e[_0x100f90][_0x379d4d]>0x0||_0x37801e[_0x379d4d][_0x100f90]>0x0;return _0x27acdd;}catch(_0x31e302){return _0x4fcbf4['log'][_0x17032e(0x1af)](_0x17032e(0x1b2)+_0x31e302['message']),!![];}}function calculateSleepProbability(_0x5beb35){const _0x20e3cf=a2_0x4559a6,_0xd224e7=new Date(),_0x3eba20=_0xd224e7['getHours'](),_0xcce112=_0x5beb35[_0x20e3cf(0x1b7)]();let _0x2c8a2e=0.1;if(_0x3eba20>=0x17||_0x3eba20<=0x6)_0x2c8a2e=0x1;else{if(_0x3eba20>=0xd&&_0x3eba20<=0xf)_0x2c8a2e=0.8;else{if(_0x3eba20>=0x14&&_0x3eba20<=0x17)_0x2c8a2e=0.4;}}let _0x145fa1=0.1;if(_0xcce112[_0x20e3cf(0x1da)](_0x20e3cf(0x1b4))||_0xcce112[_0x20e3cf(0x1da)](_0x20e3cf(0x1dd)))_0x145fa1=0x1;else{if(_0xcce112[_0x20e3cf(0x1da)](_0x20e3cf(0x1e1))||_0xcce112[_0x20e3cf(0x1da)](_0x20e3cf(0x1c0))||_0xcce112[_0x20e3cf(0x1da)](_0x20e3cf(0x1b5)))_0x145fa1=0.6;else{if(_0xcce112[_0x20e3cf(0x1da)]('bad')||_0xcce112[_0x20e3cf(0x1da)]('wc'))_0x145fa1=0.05;}}let _0x2acba5=0.5;const _0x32e3b7=_0x145fa1*0.5+_0x2c8a2e*0.3+_0x2acba5*0.2;return parseFloat(_0x32e3b7[_0x20e3cf(0x1dc)](0x2));}async function updateLocation(_0x409bb2,_0x5aa544){const _0x64adb1=a2_0x4559a6;if(!_0x5aa544||_0x5aa544===_0x64adb1(0x1d6))return;if(!await isActive(_0x409bb2)){resetTimer(_0x409bb2);return;}if(currentMonitoredRoom&&currentMonitoredRoom!==_0x5aa544){const _0x5d6abc=await areRoomsConnected(_0x409bb2,currentMonitoredRoom,_0x5aa544);if(!_0x5d6abc){const _0x2e6802='Ignoriere\x20Bewegung\x20in\x20\x27'+_0x5aa544+_0x64adb1(0x1c2)+currentMonitoredRoom+'\x27.';_0x409bb2[_0x64adb1(0x1d5)][_0x64adb1(0x1ca)](_0x64adb1(0x1b0)+_0x2e6802+_0x64adb1(0x1db)),await _0x409bb2['setStateAsync']('analysis.safety.deadMan.lastIgnored',{'val':JSON['stringify']({'room':_0x5aa544,'reason':_0x2e6802,'timestamp':Date['now']()}),'ack':!![]});return;}resetTimer(_0x409bb2);}if(!currentMonitoredRoom){await _0x409bb2[_0x64adb1(0x1d8)](_0x64adb1(0x1cd),{'val':_0x5aa544,'ack':!![]});const _0x2ddd01=await loadConfig(_0x409bb2);let _0x1a228e=getTimeoutRobust(_0x2ddd01,_0x5aa544);const _0x41f10d=_0x5aa544[_0x64adb1(0x1b7)]();if(!_0x1a228e)for(const _0x4ea007 in DEFAULT_TIMEOUTS){if(_0x41f10d['includes'](_0x4ea007)){_0x1a228e=DEFAULT_TIMEOUTS[_0x4ea007];break;}}if(!_0x1a228e&&_0x2ddd01[_0x64adb1(0x1cc)])_0x1a228e=_0x2ddd01[_0x64adb1(0x1cc)];if(!_0x1a228e)return;currentMonitoredRoom=_0x5aa544,startTimer(_0x409bb2,_0x1a228e,_0x5aa544);}}function startTimer(_0x4f74ec,_0x372bfd,_0x5e20ef){const _0x4f87b9=a2_0x4559a6;if(activeTimer)clearTimeout(activeTimer);timeoutMs=_0x372bfd*0x3c*0x3e8,startTime=Date[_0x4f87b9(0x1cf)](),alarmStage=0x0;const _0x3f1b8d=calculateSleepProbability(_0x5e20ef||currentMonitoredRoom),_0x47e589=_0x3f1b8d>0.65;_0x47e589?(timeoutMs+=0x5a*0x3c*0x3e8,_0x4f74ec[_0x4f87b9(0x1d5)]['info'](_0x4f87b9(0x1e2)+(_0x3f1b8d*0x64)['toFixed'](0x0)+_0x4f87b9(0x1d9)+currentMonitoredRoom+_0x4f87b9(0x1ba)),_0x4f74ec[_0x4f87b9(0x1d8)](_0x4f87b9(0x1be),{'val':!![],'ack':!![]})):_0x4f74ec['setStateAsync'](_0x4f87b9(0x1be),{'val':![],'ack':!![]}),_0x4f74ec[_0x4f87b9(0x1d8)](_0x4f87b9(0x1c5),{'val':_0x3f1b8d,'ack':!![]}),_0x4f74ec[_0x4f87b9(0x1d5)]['info'](_0x4f87b9(0x1b6)+currentMonitoredRoom+_0x4f87b9(0x1ce)+_0x372bfd+_0x4f87b9(0x1cb)),_0x4f74ec['setStateAsync'](_0x4f87b9(0x1b1),{'val':'ok','ack':!![]}),activeTimer=setTimeout(()=>triggerPreWarn(_0x4f74ec),timeoutMs);}function resetTimer(_0x1d2cdf){const _0x1df870=a2_0x4559a6;if(activeTimer)clearTimeout(activeTimer);activeTimer=null,currentMonitoredRoom=null,alarmStage=0x0,_0x1d2cdf[_0x1df870(0x1d8)]('analysis.safety.deadMan.alarmState',{'val':'ok','ack':!![]}),_0x1d2cdf[_0x1df870(0x1d8)](_0x1df870(0x1be),{'val':![],'ack':!![]}),_0x1d2cdf[_0x1df870(0x1d8)](_0x1df870(0x1c5),{'val':0x0,'ack':!![]});}async function triggerPreWarn(_0x46fca3){const _0x2ad9d8=a2_0x4559a6;alarmStage=0x1,await _0x46fca3['setStateAsync'](_0x2ad9d8(0x1b1),{'val':_0x2ad9d8(0x1bc),'ack':!![]});const _0x16b03d=_0x2ad9d8(0x1c7)+currentMonitoredRoom+_0x2ad9d8(0x1de);_0x46fca3[_0x2ad9d8(0x1d5)][_0x2ad9d8(0x1af)](_0x2ad9d8(0x1b0)+_0x16b03d),await setup['sendNotification'](_0x46fca3,_0x2ad9d8(0x1bd)+_0x16b03d),activeTimer=setTimeout(()=>triggerAlarm(_0x46fca3),0x5*0x3c*0x3e8);}async function triggerAlarm(_0x8a3e5b){const _0x5c72a4=a2_0x4559a6;alarmStage=0x2,await _0x8a3e5b[_0x5c72a4(0x1d8)](_0x5c72a4(0x1b1),{'val':'alarm','ack':!![]});const _0x5befb2=_0x5c72a4(0x1d2)+currentMonitoredRoom+'!';_0x8a3e5b['log']['error'](_0x5c72a4(0x1b0)+_0x5befb2),await setup[_0x5c72a4(0x1d7)](_0x8a3e5b,_0x5befb2,![],!![]);}module[a2_0x4559a6(0x1c6)]={'updateLocation':updateLocation};