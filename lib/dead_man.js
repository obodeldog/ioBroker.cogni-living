const a2_0x2e29ea=a2_0x5d54;(function(_0x28de8d,_0x15d0a8){const _0x3e7641=a2_0x5d54,_0x467930=_0x28de8d();while(!![]){try{const _0x591c55=parseInt(_0x3e7641(0xa9))/0x1+parseInt(_0x3e7641(0x9c))/0x2*(parseInt(_0x3e7641(0x9e))/0x3)+parseInt(_0x3e7641(0xbb))/0x4*(-parseInt(_0x3e7641(0xb0))/0x5)+parseInt(_0x3e7641(0xce))/0x6*(parseInt(_0x3e7641(0xbf))/0x7)+parseInt(_0x3e7641(0xa7))/0x8+parseInt(_0x3e7641(0xc8))/0x9*(-parseInt(_0x3e7641(0xc2))/0xa)+-parseInt(_0x3e7641(0xac))/0xb;if(_0x591c55===_0x15d0a8)break;else _0x467930['push'](_0x467930['shift']());}catch(_0x228a6c){_0x467930['push'](_0x467930['shift']());}}}(a2_0x30f7,0x9e004));const a2_0x31fd71=(function(){let _0x41b9f0=!![];return function(_0xcaa481,_0x3c8050){const _0x24e10b=_0x41b9f0?function(){const _0xaa4fc1=a2_0x5d54;if(_0x3c8050){const _0xf7912=_0x3c8050[_0xaa4fc1(0xa4)](_0xcaa481,arguments);return _0x3c8050=null,_0xf7912;}}:function(){};return _0x41b9f0=![],_0x24e10b;};}()),a2_0x121efb=a2_0x31fd71(this,function(){const _0x46a9c3=a2_0x5d54;return a2_0x121efb[_0x46a9c3(0xb1)]()[_0x46a9c3(0xbe)]('(((.+)+)+)+$')['toString']()[_0x46a9c3(0xad)](a2_0x121efb)[_0x46a9c3(0xbe)](_0x46a9c3(0xc7));});function a2_0x30f7(){const _0x2333d5=['â³\x20ACHTUNG:\x20UngewÃ¶hnlich\x20lange\x20InaktivitÃ¤t\x20in\x20','2UDISIr','\x20um\x2090\x20Min.','3112359vQuVmH','parse','analysis.safety.deadMan.config','Ignoriere\x20Bewegung\x20in\x20\x27','now','getHours','apply','analysis.safety.deadMan.currentRoom','log','1180840sKcBDY','wohn','455050NLWRCp','analysis.safety.deadMan.lastIgnored','[DeadMan]\x20Topology\x20check\x20failed:\x20','9062548waEkXU','constructor','info','default','4190qzyMkl','toString','setStateAsync','bad','.\x20Alles\x20in\x20Ordnung?','./setup','sofa','toFixed','message','sendNotification','includes','4756XzPSzB','analysis.safety.deadMan.alarmState','analysis.safety.deadMan.napProbability','search','1036OaFZaX','\x20fÃ¼r\x20','warn','3310CRHfqV','toLowerCase','getStateAsync','replace','[DeadMan]\x20','(((.+)+)+)+$','306jWdAns','indexOf','analysis.safety.deadMan.active','\x20(Multi-Person\x20Filter)','analysis.safety.deadMan.smartSleep','error','33996LHWBfk','alarm','%).\x20VerlÃ¤ngere\x20Timer\x20fÃ¼r\x20','stringify','ðŸ‘¼\x20Schutzengel-Frage:\x20','val','analysis.topology.structure','\x27.\x20Nicht\x20verbunden\x20mit\x20Ã¼berwachtem\x20\x27','living'];a2_0x30f7=function(){return _0x2333d5;};return a2_0x30f7();}a2_0x121efb();'use strict';const setup=require(a2_0x2e29ea(0xb5));let activeTimer=null,currentMonitoredRoom=null,timeoutMs=0x0,startTime=0x0,alarmStage=0x0;const DEFAULT_TIMEOUTS={'bad':0x2d,'bath':0x2d,'toilet':0x1e,'wc':0x1e,'keller':0x3c,'schlaf':0x78,'bed':0x78,'guest':0x5a,'gast':0x5a};function getTimeoutRobust(_0xf66892,_0x2f9461){const _0x25f449=a2_0x2e29ea;if(!_0xf66892||!_0x2f9461)return undefined;if(_0xf66892[_0x2f9461])return _0xf66892[_0x2f9461];const _0x35f204=_0x2f9461[_0x25f449(0xc3)]()[_0x25f449(0xc5)](/[^a-z0-9]/g,'');for(const _0x17cef2 in _0xf66892){const _0x1fb3cc=_0x17cef2[_0x25f449(0xc3)]()[_0x25f449(0xc5)](/[^a-z0-9]/g,'');if(_0x1fb3cc===_0x35f204)return _0xf66892[_0x17cef2];}const _0x439b05=_0x2f9461[_0x25f449(0xc3)]();if(_0xf66892[_0x439b05])return _0xf66892[_0x439b05];return undefined;}async function loadConfig(_0x12e748){const _0x230ab6=a2_0x2e29ea;try{const _0x27cbed=await _0x12e748[_0x230ab6(0xc4)](_0x230ab6(0xa0));if(_0x27cbed&&_0x27cbed[_0x230ab6(0x97)])return JSON[_0x230ab6(0x9f)](_0x27cbed['val']);}catch(_0x561112){}return{};}async function isActive(_0x76ad57){const _0x51b6b7=a2_0x2e29ea;try{const _0x4407cf=await _0x76ad57[_0x51b6b7(0xc4)](_0x51b6b7(0xca));return _0x4407cf&&_0x4407cf[_0x51b6b7(0x97)];}catch(_0x2efb86){return![];}}async function areRoomsConnected(_0x13556e,_0x294f00,_0x459bc8){const _0x1f3f4a=a2_0x2e29ea;try{const _0x5a867e=await _0x13556e['getStateAsync'](_0x1f3f4a(0x98));if(!_0x5a867e||!_0x5a867e[_0x1f3f4a(0x97)])return!![];const _0x3e00e5=JSON['parse'](_0x5a867e[_0x1f3f4a(0x97)]),{rooms:_0x40ac57,matrix:_0x36df7a}=_0x3e00e5;if(!_0x40ac57||!_0x36df7a)return!![];const _0x675b19=_0x40ac57[_0x1f3f4a(0xc9)](_0x294f00),_0x2ab0df=_0x40ac57['indexOf'](_0x459bc8);if(_0x675b19===-0x1||_0x2ab0df===-0x1)return!![];const _0xab48df=_0x36df7a[_0x675b19][_0x2ab0df]>0x0||_0x36df7a[_0x2ab0df][_0x675b19]>0x0;return _0xab48df;}catch(_0x267ef6){return _0x13556e[_0x1f3f4a(0xa6)][_0x1f3f4a(0xc1)](_0x1f3f4a(0xab)+_0x267ef6[_0x1f3f4a(0xb8)]),!![];}}function calculateSleepProbability(_0x53d216){const _0xeef9a0=a2_0x2e29ea,_0x631722=new Date(),_0x521cd3=_0x631722[_0xeef9a0(0xa3)](),_0x9c01dd=_0x53d216['toLowerCase']();let _0x1ae832=0.1;if(_0x521cd3>=0x17||_0x521cd3<=0x6)_0x1ae832=0x1;else{if(_0x521cd3>=0xd&&_0x521cd3<=0xf)_0x1ae832=0.8;else{if(_0x521cd3>=0x14&&_0x521cd3<=0x17)_0x1ae832=0.4;}}let _0x242bbe=0.1;if(_0x9c01dd['includes']('schlaf')||_0x9c01dd[_0xeef9a0(0xba)]('bed'))_0x242bbe=0x1;else{if(_0x9c01dd[_0xeef9a0(0xba)](_0xeef9a0(0xa8))||_0x9c01dd['includes'](_0xeef9a0(0x9a))||_0x9c01dd[_0xeef9a0(0xba)](_0xeef9a0(0xb6)))_0x242bbe=0.6;else{if(_0x9c01dd['includes'](_0xeef9a0(0xb3))||_0x9c01dd['includes']('wc'))_0x242bbe=0.05;}}let _0x214ff9=0.5;const _0x2b09e4=_0x242bbe*0.5+_0x1ae832*0.3+_0x214ff9*0.2;return parseFloat(_0x2b09e4[_0xeef9a0(0xb7)](0x2));}async function updateLocation(_0x3894ad,_0x35c24f){const _0x2c8ef3=a2_0x2e29ea;if(!_0x35c24f||_0x35c24f==='Unknown')return;if(!await isActive(_0x3894ad)){resetTimer(_0x3894ad);return;}if(currentMonitoredRoom&&currentMonitoredRoom!==_0x35c24f){const _0x4a22dd=await areRoomsConnected(_0x3894ad,currentMonitoredRoom,_0x35c24f);if(!_0x4a22dd){const _0x87e823=_0x2c8ef3(0xa1)+_0x35c24f+_0x2c8ef3(0x99)+currentMonitoredRoom+'\x27.';_0x3894ad['log'][_0x2c8ef3(0xae)]('[DeadMan]\x20'+_0x87e823+_0x2c8ef3(0xcb)),await _0x3894ad[_0x2c8ef3(0xb2)](_0x2c8ef3(0xaa),{'val':JSON[_0x2c8ef3(0xd1)]({'room':_0x35c24f,'reason':_0x87e823,'timestamp':Date[_0x2c8ef3(0xa2)]()}),'ack':!![]});return;}resetTimer(_0x3894ad);}if(!currentMonitoredRoom){await _0x3894ad['setStateAsync'](_0x2c8ef3(0xa5),{'val':_0x35c24f,'ack':!![]});const _0xeb07c4=await loadConfig(_0x3894ad);let _0x608d2a=getTimeoutRobust(_0xeb07c4,_0x35c24f);const _0xd70de4=_0x35c24f[_0x2c8ef3(0xc3)]();if(!_0x608d2a)for(const _0x3f627f in DEFAULT_TIMEOUTS){if(_0xd70de4['includes'](_0x3f627f)){_0x608d2a=DEFAULT_TIMEOUTS[_0x3f627f];break;}}if(!_0x608d2a&&_0xeb07c4[_0x2c8ef3(0xaf)])_0x608d2a=_0xeb07c4[_0x2c8ef3(0xaf)];if(!_0x608d2a)return;currentMonitoredRoom=_0x35c24f,startTimer(_0x3894ad,_0x608d2a,_0x35c24f);}}function a2_0x5d54(_0x500b12,_0x21e0a5){const _0x14b99b=a2_0x30f7();return a2_0x5d54=function(_0x121efb,_0x31fd71){_0x121efb=_0x121efb-0x96;let _0x30f73e=_0x14b99b[_0x121efb];return _0x30f73e;},a2_0x5d54(_0x500b12,_0x21e0a5);}function startTimer(_0xf7e36d,_0x4c420a,_0x33f207){const _0x1b3764=a2_0x2e29ea;if(activeTimer)clearTimeout(activeTimer);timeoutMs=_0x4c420a*0x3c*0x3e8,startTime=Date[_0x1b3764(0xa2)](),alarmStage=0x0;const _0x4bc0ea=calculateSleepProbability(_0x33f207||currentMonitoredRoom),_0x372a64=_0x4bc0ea>0.65;_0x372a64?(timeoutMs+=0x5a*0x3c*0x3e8,_0xf7e36d[_0x1b3764(0xa6)][_0x1b3764(0xae)]('ðŸ’¤\x20Smart\x20Sleep\x20erkannt\x20('+(_0x4bc0ea*0x64)[_0x1b3764(0xb7)](0x0)+_0x1b3764(0xd0)+currentMonitoredRoom+_0x1b3764(0x9d)),_0xf7e36d[_0x1b3764(0xb2)](_0x1b3764(0xcc),{'val':!![],'ack':!![]})):_0xf7e36d[_0x1b3764(0xb2)](_0x1b3764(0xcc),{'val':![],'ack':!![]}),_0xf7e36d[_0x1b3764(0xb2)](_0x1b3764(0xbd),{'val':_0x4bc0ea,'ack':!![]}),_0xf7e36d[_0x1b3764(0xa6)][_0x1b3764(0xae)]('ðŸ‘¼\x20Schutzengel:\x20Ãœberwache\x20'+currentMonitoredRoom+_0x1b3764(0xc0)+_0x4c420a+'\x20Min.'),_0xf7e36d[_0x1b3764(0xb2)]('analysis.safety.deadMan.alarmState',{'val':'ok','ack':!![]}),activeTimer=setTimeout(()=>triggerPreWarn(_0xf7e36d),timeoutMs);}function resetTimer(_0x4f2302){const _0x3e9be8=a2_0x2e29ea;if(activeTimer)clearTimeout(activeTimer);activeTimer=null,currentMonitoredRoom=null,alarmStage=0x0,_0x4f2302[_0x3e9be8(0xb2)](_0x3e9be8(0xbc),{'val':'ok','ack':!![]}),_0x4f2302[_0x3e9be8(0xb2)](_0x3e9be8(0xcc),{'val':![],'ack':!![]}),_0x4f2302[_0x3e9be8(0xb2)](_0x3e9be8(0xbd),{'val':0x0,'ack':!![]});}async function triggerPreWarn(_0x1aa17f){const _0x518594=a2_0x2e29ea;alarmStage=0x1,await _0x1aa17f[_0x518594(0xb2)](_0x518594(0xbc),{'val':'pre_warn','ack':!![]});const _0x2a89fc=_0x518594(0x9b)+currentMonitoredRoom+_0x518594(0xb4);_0x1aa17f[_0x518594(0xa6)][_0x518594(0xc1)](_0x518594(0xc6)+_0x2a89fc),await setup[_0x518594(0xb9)](_0x1aa17f,_0x518594(0x96)+_0x2a89fc),activeTimer=setTimeout(()=>triggerAlarm(_0x1aa17f),0x5*0x3c*0x3e8);}async function triggerAlarm(_0x32f169){const _0x4f6631=a2_0x2e29ea;alarmStage=0x2,await _0x32f169[_0x4f6631(0xb2)](_0x4f6631(0xbc),{'val':_0x4f6631(0xcf),'ack':!![]});const _0x40ba15='ðŸš¨\x20NOTFALL-ALARM:\x20Person\x20reagiert\x20nicht\x20in\x20'+currentMonitoredRoom+'!';_0x32f169['log'][_0x4f6631(0xcd)](_0x4f6631(0xc6)+_0x40ba15),await setup[_0x4f6631(0xb9)](_0x32f169,_0x40ba15,![],!![]);}module['exports']={'updateLocation':updateLocation};