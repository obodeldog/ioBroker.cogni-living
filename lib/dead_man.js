const a2_0x3858bb=a2_0x3141;(function(_0x2aa9ce,_0x1e3ea1){const _0x5c5c4b=a2_0x3141,_0x5e5de3=_0x2aa9ce();while(!![]){try{const _0x3b8fc3=parseInt(_0x5c5c4b(0x204))/0x1*(parseInt(_0x5c5c4b(0x20c))/0x2)+parseInt(_0x5c5c4b(0x1eb))/0x3+-parseInt(_0x5c5c4b(0x213))/0x4+-parseInt(_0x5c5c4b(0x205))/0x5+parseInt(_0x5c5c4b(0x1e2))/0x6*(-parseInt(_0x5c5c4b(0x209))/0x7)+parseInt(_0x5c5c4b(0x216))/0x8*(-parseInt(_0x5c5c4b(0x214))/0x9)+parseInt(_0x5c5c4b(0x20d))/0xa;if(_0x3b8fc3===_0x1e3ea1)break;else _0x5e5de3['push'](_0x5e5de3['shift']());}catch(_0x1c0386){_0x5e5de3['push'](_0x5e5de3['shift']());}}}(a2_0x457a,0xa6284));const a2_0x4d76a1=(function(){let _0x523284=!![];return function(_0x3e7e75,_0x201f01){const _0x18e629=_0x523284?function(){const _0xbe47fd=a2_0x3141;if(_0x201f01){const _0x3ae8dd=_0x201f01[_0xbe47fd(0x1f4)](_0x3e7e75,arguments);return _0x201f01=null,_0x3ae8dd;}}:function(){};return _0x523284=![],_0x18e629;};}()),a2_0x50724d=a2_0x4d76a1(this,function(){const _0x49012f=a2_0x3141;return a2_0x50724d[_0x49012f(0x1fb)]()[_0x49012f(0x208)]('(((.+)+)+)+$')[_0x49012f(0x1fb)]()[_0x49012f(0x1df)](a2_0x50724d)['search']('(((.+)+)+)+$');});a2_0x50724d();'use strict';const setup=require(a2_0x3858bb(0x1fc));function a2_0x3141(_0xe363b5,_0x34618f){const _0x547b34=a2_0x457a();return a2_0x3141=function(_0x50724d,_0x4d76a1){_0x50724d=_0x50724d-0x1df;let _0x457aae=_0x547b34[_0x50724d];return _0x457aae;},a2_0x3141(_0xe363b5,_0x34618f);}let activeTimer=null,currentMonitoredRoom=null,timeoutMs=0x0,startTime=0x0,alarmStage=0x0;const DEFAULT_TIMEOUTS={'bad':0x2d,'bath':0x2d,'toilet':0x1e,'wc':0x1e,'keller':0x3c,'schlaf':0x78,'bed':0x78,'guest':0x5a,'gast':0x5a};function getTimeoutRobust(_0x56f2a4,_0x41f163){const _0x4e22a4=a2_0x3858bb;if(!_0x56f2a4||!_0x41f163)return undefined;if(_0x56f2a4[_0x41f163])return _0x56f2a4[_0x41f163];const _0x4b05f4=_0x41f163[_0x4e22a4(0x203)]()['replace'](/[^a-z0-9]/g,'');for(const _0x42503c in _0x56f2a4){const _0x5dec82=_0x42503c[_0x4e22a4(0x203)]()[_0x4e22a4(0x1f9)](/[^a-z0-9]/g,'');if(_0x5dec82===_0x4b05f4)return _0x56f2a4[_0x42503c];}const _0x11f445=_0x41f163[_0x4e22a4(0x203)]();if(_0x56f2a4[_0x11f445])return _0x56f2a4[_0x11f445];return undefined;}async function loadConfig(_0x2544ce){const _0x37b9f1=a2_0x3858bb;try{const _0x587911=await _0x2544ce[_0x37b9f1(0x1e4)](_0x37b9f1(0x1ef));if(_0x587911&&_0x587911[_0x37b9f1(0x20f)])return JSON['parse'](_0x587911['val']);}catch(_0x1f8613){}return{};}async function isActive(_0x443ec0){const _0x456ed6=a2_0x3858bb;try{const _0x2acb29=await _0x443ec0[_0x456ed6(0x1e4)](_0x456ed6(0x20e));return _0x2acb29&&_0x2acb29['val'];}catch(_0x5449b4){return![];}}async function areRoomsConnected(_0x284b00,_0x2af47a,_0x50206d){const _0x320a3a=a2_0x3858bb;try{const _0x2b8db2=await _0x284b00[_0x320a3a(0x1e4)](_0x320a3a(0x219));if(!_0x2b8db2||!_0x2b8db2[_0x320a3a(0x20f)])return!![];const _0x23540d=JSON[_0x320a3a(0x206)](_0x2b8db2[_0x320a3a(0x20f)]),{rooms:_0x56deb4,matrix:_0x4ffa58}=_0x23540d;if(!_0x56deb4||!_0x4ffa58)return!![];const _0xbde526=_0x56deb4[_0x320a3a(0x20b)](_0x2af47a),_0x40b136=_0x56deb4[_0x320a3a(0x20b)](_0x50206d);if(_0xbde526===-0x1||_0x40b136===-0x1)return!![];const _0x5ce36c=_0x4ffa58[_0xbde526][_0x40b136]>0x0||_0x4ffa58[_0x40b136][_0xbde526]>0x0;return _0x5ce36c;}catch(_0x49ad5e){return _0x284b00[_0x320a3a(0x1ff)][_0x320a3a(0x217)](_0x320a3a(0x1e6)+_0x49ad5e[_0x320a3a(0x1f7)]),!![];}}function calculateSleepProbability(_0x51e244){const _0x3e9862=a2_0x3858bb,_0x125fac=new Date(),_0x3bc787=_0x125fac[_0x3e9862(0x21c)](),_0x2bf3aa=_0x51e244[_0x3e9862(0x203)]();let _0x747d82=0.1;if(_0x3bc787>=0x17||_0x3bc787<=0x6)_0x747d82=0x1;else{if(_0x3bc787>=0xd&&_0x3bc787<=0xf)_0x747d82=0.8;else{if(_0x3bc787>=0x14&&_0x3bc787<=0x17)_0x747d82=0.4;}}let _0x7b1e2a=0.1;if(_0x2bf3aa[_0x3e9862(0x1ec)](_0x3e9862(0x215))||_0x2bf3aa['includes'](_0x3e9862(0x1e1)))_0x7b1e2a=0x1;else{if(_0x2bf3aa['includes'](_0x3e9862(0x21b))||_0x2bf3aa[_0x3e9862(0x1ec)](_0x3e9862(0x1ea))||_0x2bf3aa[_0x3e9862(0x1ec)](_0x3e9862(0x1fe)))_0x7b1e2a=0.6;else{if(_0x2bf3aa[_0x3e9862(0x1ec)](_0x3e9862(0x1f0))||_0x2bf3aa[_0x3e9862(0x1ec)]('wc'))_0x7b1e2a=0.05;}}let _0x16976f=0.5;const _0x9cfd6c=_0x7b1e2a*0.5+_0x747d82*0.3+_0x16976f*0.2;return parseFloat(_0x9cfd6c[_0x3e9862(0x207)](0x2));}async function updateLocation(_0x211650,_0x463ec4){const _0x4e52aa=a2_0x3858bb;if(!_0x463ec4||_0x463ec4===_0x4e52aa(0x1ed))return;if(!await isActive(_0x211650)){resetTimer(_0x211650);return;}if(currentMonitoredRoom&&currentMonitoredRoom!==_0x463ec4){const _0x2640bf=await areRoomsConnected(_0x211650,currentMonitoredRoom,_0x463ec4);if(!_0x2640bf){const _0x2bae7d=_0x4e52aa(0x1f8)+_0x463ec4+_0x4e52aa(0x1e8)+currentMonitoredRoom+'\x27.';_0x211650[_0x4e52aa(0x1ff)][_0x4e52aa(0x218)]('[DeadMan]\x20'+_0x2bae7d+_0x4e52aa(0x1f3)),await _0x211650[_0x4e52aa(0x210)](_0x4e52aa(0x1e3),{'val':JSON['stringify']({'room':_0x463ec4,'reason':_0x2bae7d,'timestamp':Date['now']()}),'ack':!![]});return;}resetTimer(_0x211650);}if(!currentMonitoredRoom){await _0x211650[_0x4e52aa(0x210)](_0x4e52aa(0x1fd),{'val':_0x463ec4,'ack':!![]});const _0x49b950=await loadConfig(_0x211650);let _0x316681=getTimeoutRobust(_0x49b950,_0x463ec4);const _0x18b339=_0x463ec4[_0x4e52aa(0x203)]();if(!_0x316681)for(const _0xabc559 in DEFAULT_TIMEOUTS){if(_0x18b339[_0x4e52aa(0x1ec)](_0xabc559)){_0x316681=DEFAULT_TIMEOUTS[_0xabc559];break;}}if(!_0x316681&&_0x49b950['default'])_0x316681=_0x49b950['default'];if(!_0x316681)return;currentMonitoredRoom=_0x463ec4,startTimer(_0x211650,_0x316681,_0x463ec4);}}function startTimer(_0x27c3a8,_0x18f09a,_0x3a1f90){const _0x39d540=a2_0x3858bb;if(activeTimer)clearTimeout(activeTimer);timeoutMs=_0x18f09a*0x3c*0x3e8,startTime=Date[_0x39d540(0x202)](),alarmStage=0x0;const _0x38b85a=calculateSleepProbability(_0x3a1f90||currentMonitoredRoom),_0xc3c8e2=_0x38b85a>0.65;_0xc3c8e2?(timeoutMs+=0x5a*0x3c*0x3e8,_0x27c3a8['log']['info']('ðŸ’¤\x20Smart\x20Sleep\x20erkannt\x20('+(_0x38b85a*0x64)[_0x39d540(0x207)](0x0)+_0x39d540(0x1e9)+currentMonitoredRoom+_0x39d540(0x1f2)),_0x27c3a8[_0x39d540(0x210)](_0x39d540(0x20a),{'val':!![],'ack':!![]})):_0x27c3a8[_0x39d540(0x210)](_0x39d540(0x20a),{'val':![],'ack':!![]}),_0x27c3a8[_0x39d540(0x210)](_0x39d540(0x200),{'val':_0x38b85a,'ack':!![]}),_0x27c3a8[_0x39d540(0x1ff)][_0x39d540(0x218)](_0x39d540(0x211)+currentMonitoredRoom+_0x39d540(0x212)+_0x18f09a+_0x39d540(0x1fa)),_0x27c3a8[_0x39d540(0x210)](_0x39d540(0x1e0),{'val':'ok','ack':!![]}),activeTimer=setTimeout(()=>triggerPreWarn(_0x27c3a8),timeoutMs);}function resetTimer(_0x594c82){const _0xd8fe90=a2_0x3858bb;if(activeTimer)clearTimeout(activeTimer);activeTimer=null,currentMonitoredRoom=null,alarmStage=0x0,_0x594c82[_0xd8fe90(0x210)](_0xd8fe90(0x1e0),{'val':'ok','ack':!![]}),_0x594c82[_0xd8fe90(0x210)](_0xd8fe90(0x20a),{'val':![],'ack':!![]}),_0x594c82[_0xd8fe90(0x210)]('analysis.safety.deadMan.napProbability',{'val':0x0,'ack':!![]});}async function triggerPreWarn(_0x108a36){const _0xff16a4=a2_0x3858bb;alarmStage=0x1,await _0x108a36[_0xff16a4(0x210)]('analysis.safety.deadMan.alarmState',{'val':_0xff16a4(0x1f6),'ack':!![]});const _0x5e7ec8='â³\x20ACHTUNG:\x20UngewÃ¶hnlich\x20lange\x20InaktivitÃ¤t\x20in\x20'+currentMonitoredRoom+_0xff16a4(0x1e5);_0x108a36['log'][_0xff16a4(0x217)](_0xff16a4(0x1f5)+_0x5e7ec8),await setup[_0xff16a4(0x1f1)](_0x108a36,_0xff16a4(0x201)+_0x5e7ec8),activeTimer=setTimeout(()=>triggerAlarm(_0x108a36),0x5*0x3c*0x3e8);}function a2_0x457a(){const _0x34cff1=['sendNotification','\x20um\x2090\x20Min.','\x20(Multi-Person\x20Filter)','apply','[DeadMan]\x20','pre_warn','message','Ignoriere\x20Bewegung\x20in\x20\x27','replace','\x20Min.','toString','./setup','analysis.safety.deadMan.currentRoom','sofa','log','analysis.safety.deadMan.napProbability','ðŸ‘¼\x20Schutzengel-Frage:\x20','now','toLowerCase','26521IJpJQJ','2643325gPeZon','parse','toFixed','search','126dBDqVv','analysis.safety.deadMan.smartSleep','indexOf','72RDZsGS','13949200ashpXX','analysis.safety.deadMan.active','val','setStateAsync','ðŸ‘¼\x20Schutzengel:\x20Ãœberwache\x20','\x20fÃ¼r\x20','1073408lIzEUy','12086217JHpnpG','schlaf','8BliBOx','warn','info','analysis.topology.structure','error','wohn','getHours','constructor','analysis.safety.deadMan.alarmState','bed','155244rMtdOZ','analysis.safety.deadMan.lastIgnored','getStateAsync','.\x20Alles\x20in\x20Ordnung?','[DeadMan]\x20Topology\x20check\x20failed:\x20','exports','\x27.\x20Nicht\x20verbunden\x20mit\x20Ã¼berwachtem\x20\x27','%).\x20VerlÃ¤ngere\x20Timer\x20fÃ¼r\x20','living','2809698XabWZl','includes','Unknown','ðŸš¨\x20NOTFALL-ALARM:\x20Person\x20reagiert\x20nicht\x20in\x20','analysis.safety.deadMan.config','bad'];a2_0x457a=function(){return _0x34cff1;};return a2_0x457a();}async function triggerAlarm(_0x79219a){const _0x2d1d26=a2_0x3858bb;alarmStage=0x2,await _0x79219a[_0x2d1d26(0x210)](_0x2d1d26(0x1e0),{'val':'alarm','ack':!![]});const _0x20395c=_0x2d1d26(0x1ee)+currentMonitoredRoom+'!';_0x79219a['log'][_0x2d1d26(0x21a)](_0x2d1d26(0x1f5)+_0x20395c),await setup['sendNotification'](_0x79219a,_0x20395c,![],!![]);}module[a2_0x3858bb(0x1e7)]={'updateLocation':updateLocation};