const a2_0x573d62=a2_0x544d;(function(_0x39253b,_0x15d347){const _0x19cda1=a2_0x544d,_0x2f2ea2=_0x39253b();while(!![]){try{const _0x1ddaa7=-parseInt(_0x19cda1(0x208))/0x1*(parseInt(_0x19cda1(0x20c))/0x2)+-parseInt(_0x19cda1(0x219))/0x3*(-parseInt(_0x19cda1(0x1f6))/0x4)+parseInt(_0x19cda1(0x204))/0x5*(parseInt(_0x19cda1(0x215))/0x6)+-parseInt(_0x19cda1(0x217))/0x7*(parseInt(_0x19cda1(0x1fd))/0x8)+parseInt(_0x19cda1(0x201))/0x9*(-parseInt(_0x19cda1(0x212))/0xa)+parseInt(_0x19cda1(0x210))/0xb+-parseInt(_0x19cda1(0x1f3))/0xc*(-parseInt(_0x19cda1(0x1f0))/0xd);if(_0x1ddaa7===_0x15d347)break;else _0x2f2ea2['push'](_0x2f2ea2['shift']());}catch(_0x1b0f05){_0x2f2ea2['push'](_0x2f2ea2['shift']());}}}(a2_0xb0ef,0x7faab));const a2_0xe0f817=(function(){let _0x4f9b9b=!![];return function(_0x3f57a4,_0x415d8a){const _0x47441b=_0x4f9b9b?function(){const _0x5c60b1=a2_0x544d;if(_0x415d8a){const _0x54fc81=_0x415d8a[_0x5c60b1(0x21a)](_0x3f57a4,arguments);return _0x415d8a=null,_0x54fc81;}}:function(){};return _0x4f9b9b=![],_0x47441b;};}()),a2_0x1f67d2=a2_0xe0f817(this,function(){const _0x4c2ca9=a2_0x544d;return a2_0x1f67d2[_0x4c2ca9(0x1ff)]()[_0x4c2ca9(0x1fc)]('(((.+)+)+)+$')['toString']()['constructor'](a2_0x1f67d2)[_0x4c2ca9(0x1fc)](_0x4c2ca9(0x205));});a2_0x1f67d2();'use strict';const setup=require('./setup');let activeTimer=null,currentMonitoredRoom=null,timeoutMs=0x0,startTime=0x0,alarmStage=0x0;function a2_0xb0ef(){const _0x10e5f7=['4HxQqOh','error','analysis.safety.deadMan.config','default','9217076ZRMpzZ','toLowerCase','1070wUmwin','warn','analysis.topology.structure','12zoKoEQ','\x20Min.','14DFEzJU','\x20fÃ¼r\x20','22983UEQzIe','apply','analysis.safety.deadMan.lastIgnored','â³\x20ACHTUNG:\x20UngewÃ¶hnlich\x20lange\x20InaktivitÃ¤t\x20in\x20','log','sendNotification','message','\x20(Multi-Person\x20Filter)','2362906yXpWTO','exports','now','24zzuaZG','val','parse','32GZtOvI','ðŸ‘¼\x20Schutzengel:\x20Ãœberwache\x20','getStateAsync','analysis.safety.deadMan.active','setStateAsync','ðŸš¨\x20NOTFALL-ALARM:\x20Person\x20reagiert\x20nicht\x20in\x20','search','2779240OvBmtl','ðŸ‘¼\x20Schutzengel-Frage:\x20','toString','stringify','15453yNqTQN','includes','indexOf','1769370XuuyZM','(((.+)+)+)+$','[DeadMan]\x20','Unknown','284512FZZjAU','info','analysis.safety.deadMan.alarmState','analysis.safety.deadMan.currentRoom'];a2_0xb0ef=function(){return _0x10e5f7;};return a2_0xb0ef();}const DEFAULT_TIMEOUTS={'bad':0x2d,'bath':0x2d,'toilet':0x1e,'wc':0x1e,'keller':0x3c};async function loadConfig(_0x1cc19b){const _0x2d9520=a2_0x544d;try{const _0x4c1158=await _0x1cc19b[_0x2d9520(0x1f8)](_0x2d9520(0x20e));if(_0x4c1158&&_0x4c1158[_0x2d9520(0x1f4)])return JSON[_0x2d9520(0x1f5)](_0x4c1158[_0x2d9520(0x1f4)]);}catch(_0x282596){}return{};}async function isActive(_0x2096f8){const _0x2fdc95=a2_0x544d;try{const _0x1bb2c2=await _0x2096f8[_0x2fdc95(0x1f8)](_0x2fdc95(0x1f9));return _0x1bb2c2&&_0x1bb2c2[_0x2fdc95(0x1f4)];}catch(_0x3bd76a){return![];}}async function areRoomsConnected(_0x83de4c,_0x2d8161,_0x31f626){const _0x113be5=a2_0x544d;try{const _0xa927dd=await _0x83de4c[_0x113be5(0x1f8)](_0x113be5(0x214));if(!_0xa927dd||!_0xa927dd['val'])return!![];const _0x199915=JSON['parse'](_0xa927dd['val']),{rooms:_0x23d991,matrix:_0x573bed}=_0x199915;if(!_0x23d991||!_0x573bed)return!![];const _0x5e9560=_0x23d991[_0x113be5(0x203)](_0x2d8161),_0x3cb618=_0x23d991['indexOf'](_0x31f626);if(_0x5e9560===-0x1||_0x3cb618===-0x1)return!![];const _0x2592b8=_0x573bed[_0x5e9560][_0x3cb618]>0x0||_0x573bed[_0x3cb618][_0x5e9560]>0x0;return _0x2592b8;}catch(_0x285d5e){return _0x83de4c[_0x113be5(0x1ec)][_0x113be5(0x213)]('[DeadMan]\x20Topology\x20check\x20failed:\x20'+_0x285d5e[_0x113be5(0x1ee)]),!![];}}function a2_0x544d(_0x11776f,_0x3590c3){const _0x54de29=a2_0xb0ef();return a2_0x544d=function(_0x1f67d2,_0xe0f817){_0x1f67d2=_0x1f67d2-0x1ec;let _0xb0efa=_0x54de29[_0x1f67d2];return _0xb0efa;},a2_0x544d(_0x11776f,_0x3590c3);}async function updateLocation(_0x3df8ab,_0x10ed4b){const _0x44e37b=a2_0x544d;if(!_0x10ed4b||_0x10ed4b===_0x44e37b(0x207))return;if(!await isActive(_0x3df8ab)){resetTimer(_0x3df8ab);return;}if(currentMonitoredRoom&&currentMonitoredRoom!==_0x10ed4b){const _0x11eb74=await areRoomsConnected(_0x3df8ab,currentMonitoredRoom,_0x10ed4b);if(!_0x11eb74){const _0x21ac5d='Ignoriere\x20Bewegung\x20in\x20\x27'+_0x10ed4b+'\x27.\x20Nicht\x20verbunden\x20mit\x20Ã¼berwachtem\x20\x27'+currentMonitoredRoom+'\x27.';_0x3df8ab[_0x44e37b(0x1ec)][_0x44e37b(0x209)](_0x44e37b(0x206)+_0x21ac5d+_0x44e37b(0x1ef)),await _0x3df8ab[_0x44e37b(0x1fa)](_0x44e37b(0x21b),{'val':JSON[_0x44e37b(0x200)]({'room':_0x10ed4b,'reason':_0x21ac5d,'timestamp':Date[_0x44e37b(0x1f2)]()}),'ack':!![]});return;}resetTimer(_0x3df8ab);}if(!currentMonitoredRoom){await _0x3df8ab['setStateAsync'](_0x44e37b(0x20b),{'val':_0x10ed4b,'ack':!![]});const _0x4767c8=await loadConfig(_0x3df8ab),_0x9a89f7=_0x10ed4b[_0x44e37b(0x211)]();let _0x17ce71=_0x4767c8[_0x10ed4b]||_0x4767c8[_0x9a89f7];if(!_0x17ce71)for(const _0x5c9ade in DEFAULT_TIMEOUTS){if(_0x9a89f7[_0x44e37b(0x202)](_0x5c9ade)){_0x17ce71=DEFAULT_TIMEOUTS[_0x5c9ade];break;}}if(!_0x17ce71&&_0x4767c8[_0x44e37b(0x20f)])_0x17ce71=_0x4767c8[_0x44e37b(0x20f)];if(!_0x17ce71)return;currentMonitoredRoom=_0x10ed4b,startTimer(_0x3df8ab,_0x17ce71);}}function startTimer(_0x2e156a,_0x50a85c){const _0x2d5f3b=a2_0x544d;if(activeTimer)clearTimeout(activeTimer);timeoutMs=_0x50a85c*0x3c*0x3e8,startTime=Date['now'](),alarmStage=0x0,_0x2e156a[_0x2d5f3b(0x1ec)][_0x2d5f3b(0x209)](_0x2d5f3b(0x1f7)+currentMonitoredRoom+_0x2d5f3b(0x218)+_0x50a85c+_0x2d5f3b(0x216)),_0x2e156a['setStateAsync'](_0x2d5f3b(0x20a),{'val':'ok','ack':!![]}),activeTimer=setTimeout(()=>triggerPreWarn(_0x2e156a),timeoutMs);}function resetTimer(_0x378ec0){const _0x143a1d=a2_0x544d;if(activeTimer)clearTimeout(activeTimer);activeTimer=null,currentMonitoredRoom=null,alarmStage=0x0,_0x378ec0[_0x143a1d(0x1fa)](_0x143a1d(0x20a),{'val':'ok','ack':!![]});}async function triggerPreWarn(_0x50b69b){const _0x569129=a2_0x544d;alarmStage=0x1,await _0x50b69b[_0x569129(0x1fa)](_0x569129(0x20a),{'val':'pre_warn','ack':!![]});const _0x386733=_0x569129(0x21c)+currentMonitoredRoom+'.\x20Alles\x20in\x20Ordnung?';_0x50b69b[_0x569129(0x1ec)]['warn']('[DeadMan]\x20'+_0x386733),await setup[_0x569129(0x1ed)](_0x50b69b,_0x569129(0x1fe)+_0x386733),activeTimer=setTimeout(()=>triggerAlarm(_0x50b69b),0x5*0x3c*0x3e8);}async function triggerAlarm(_0x54cb0b){const _0x2bf0fd=a2_0x544d;alarmStage=0x2,await _0x54cb0b[_0x2bf0fd(0x1fa)]('analysis.safety.deadMan.alarmState',{'val':'alarm','ack':!![]});const _0x29e0cf=_0x2bf0fd(0x1fb)+currentMonitoredRoom+'!';_0x54cb0b[_0x2bf0fd(0x1ec)][_0x2bf0fd(0x20d)](_0x2bf0fd(0x206)+_0x29e0cf),await setup['sendNotification'](_0x54cb0b,_0x29e0cf,![],!![]);}module[a2_0x573d62(0x1f1)]={'updateLocation':updateLocation};