const a2_0x284e46=a2_0x5487;(function(_0x2580d,_0x2cf3ea){const _0x517d34=a2_0x5487,_0x588f10=_0x2580d();while(!![]){try{const _0x3fda09=parseInt(_0x517d34(0x1d4))/0x1*(-parseInt(_0x517d34(0x1f6))/0x2)+-parseInt(_0x517d34(0x1c8))/0x3+-parseInt(_0x517d34(0x1e9))/0x4+-parseInt(_0x517d34(0x1cb))/0x5+parseInt(_0x517d34(0x1dd))/0x6+-parseInt(_0x517d34(0x1d8))/0x7*(parseInt(_0x517d34(0x1c4))/0x8)+parseInt(_0x517d34(0x1c3))/0x9;if(_0x3fda09===_0x2cf3ea)break;else _0x588f10['push'](_0x588f10['shift']());}catch(_0x4d5a6a){_0x588f10['push'](_0x588f10['shift']());}}}(a2_0x5baa,0x97f3c));const a2_0x3d801e=(function(){let _0x1010ee=!![];return function(_0x1e0f38,_0x165a5e){const _0x10c9b6=_0x1010ee?function(){const _0x4b5242=a2_0x5487;if(_0x165a5e){const _0x52881f=_0x165a5e[_0x4b5242(0x1df)](_0x1e0f38,arguments);return _0x165a5e=null,_0x52881f;}}:function(){};return _0x1010ee=![],_0x10c9b6;};}()),a2_0x37ef57=a2_0x3d801e(this,function(){const _0x134564=a2_0x5487;return a2_0x37ef57[_0x134564(0x1f5)]()[_0x134564(0x1e3)](_0x134564(0x1db))['toString']()[_0x134564(0x1e1)](a2_0x37ef57)[_0x134564(0x1e3)](_0x134564(0x1db));});a2_0x37ef57();'use strict';const setup=require(a2_0x284e46(0x1d2));let activeTimer=null,currentMonitoredRoom=null,timeoutMs=0x0,startTime=0x0,alarmStage=0x0;const DEFAULT_TIMEOUTS={'bad':0x2d,'bath':0x2d,'toilet':0x1e,'wc':0x1e,'keller':0x3c,'schlaf':0x78,'bed':0x78,'guest':0x5a,'gast':0x5a};function a2_0x5487(_0x5926ac,_0x518063){const _0x1273de=a2_0x5baa();return a2_0x5487=function(_0x37ef57,_0x3d801e){_0x37ef57=_0x37ef57-0x1c3;let _0x5baab7=_0x1273de[_0x37ef57];return _0x5baab7;},a2_0x5487(_0x5926ac,_0x518063);}function getTimeoutRobust(_0x1234da,_0x780609){const _0x5a3e0e=a2_0x284e46;if(!_0x1234da||!_0x780609)return undefined;if(_0x1234da[_0x780609])return _0x1234da[_0x780609];const _0x57eae8=_0x780609['toLowerCase']()[_0x5a3e0e(0x1d6)](/[^a-z0-9]/g,'');for(const _0x55292a in _0x1234da){const _0xa51271=_0x55292a['toLowerCase']()[_0x5a3e0e(0x1d6)](/[^a-z0-9]/g,'');if(_0xa51271===_0x57eae8)return _0x1234da[_0x55292a];}const _0x509b93=_0x780609[_0x5a3e0e(0x1f2)]();if(_0x1234da[_0x509b93])return _0x1234da[_0x509b93];return undefined;}async function loadConfig(_0x4d147e){const _0x4b62f4=a2_0x284e46;try{const _0x5aa54d=await _0x4d147e[_0x4b62f4(0x1d9)](_0x4b62f4(0x1d0));if(_0x5aa54d&&_0x5aa54d[_0x4b62f4(0x1f4)])return JSON['parse'](_0x5aa54d[_0x4b62f4(0x1f4)]);}catch(_0x17794d){}return{};}async function isActive(_0x30b83a){const _0x53c57c=a2_0x284e46;try{const _0xef694d=await _0x30b83a[_0x53c57c(0x1d9)](_0x53c57c(0x1f3));return _0xef694d&&_0xef694d[_0x53c57c(0x1f4)];}catch(_0x19269a){return![];}}async function areRoomsConnected(_0x448491,_0xb40f1c,_0x595bdb){const _0x50b0da=a2_0x284e46;try{const _0x40dbbf=await _0x448491['getStateAsync']('analysis.topology.structure');if(!_0x40dbbf||!_0x40dbbf[_0x50b0da(0x1f4)])return!![];const _0x15f7f2=JSON[_0x50b0da(0x1e5)](_0x40dbbf[_0x50b0da(0x1f4)]),{rooms:_0x5914d0,matrix:_0x3f6060}=_0x15f7f2;if(!_0x5914d0||!_0x3f6060)return!![];const _0x383821=_0x5914d0[_0x50b0da(0x1ea)](_0xb40f1c),_0x3fe88b=_0x5914d0['indexOf'](_0x595bdb);if(_0x383821===-0x1||_0x3fe88b===-0x1)return!![];const _0xc0a396=_0x3f6060[_0x383821][_0x3fe88b]>0x0||_0x3f6060[_0x3fe88b][_0x383821]>0x0;return _0xc0a396;}catch(_0x1effbe){return _0x448491['log']['warn'](_0x50b0da(0x1ec)+_0x1effbe['message']),!![];}}function calculateSleepProbability(_0x441492){const _0x1149b6=a2_0x284e46,_0x1c3770=new Date(),_0x4939cc=_0x1c3770['getHours'](),_0x3b906e=_0x441492[_0x1149b6(0x1f2)]();let _0x5edf9a=0.1;if(_0x4939cc>=0x17||_0x4939cc<=0x6)_0x5edf9a=0x1;else{if(_0x4939cc>=0xd&&_0x4939cc<=0xf)_0x5edf9a=0.8;else{if(_0x4939cc>=0x14&&_0x4939cc<=0x17)_0x5edf9a=0.4;}}let _0x4442bd=0.1;if(_0x3b906e[_0x1149b6(0x1cc)]('schlaf')||_0x3b906e[_0x1149b6(0x1cc)](_0x1149b6(0x1da)))_0x4442bd=0x1;else{if(_0x3b906e[_0x1149b6(0x1cc)]('wohn')||_0x3b906e[_0x1149b6(0x1cc)](_0x1149b6(0x1f9))||_0x3b906e[_0x1149b6(0x1cc)](_0x1149b6(0x1de)))_0x4442bd=0.6;else{if(_0x3b906e['includes']('bad')||_0x3b906e[_0x1149b6(0x1cc)]('wc'))_0x4442bd=0.05;}}let _0x18fe56=0.5;const _0x2ac8a8=_0x4442bd*0.5+_0x5edf9a*0.3+_0x18fe56*0.2;return parseFloat(_0x2ac8a8['toFixed'](0x2));}async function updateLocation(_0x6c589b,_0x264e5c){const _0xe169d8=a2_0x284e46;if(!_0x264e5c||_0x264e5c==='Unknown')return;if(!await isActive(_0x6c589b)){resetTimer(_0x6c589b);return;}if(currentMonitoredRoom&&currentMonitoredRoom!==_0x264e5c){const _0x5bb471=await areRoomsConnected(_0x6c589b,currentMonitoredRoom,_0x264e5c);if(!_0x5bb471){const _0x5e50d0=_0xe169d8(0x1f8)+_0x264e5c+_0xe169d8(0x1dc)+currentMonitoredRoom+'\x27.';_0x6c589b[_0xe169d8(0x1d7)][_0xe169d8(0x1c9)]('[DeadMan]\x20'+_0x5e50d0+_0xe169d8(0x1f1)),await _0x6c589b[_0xe169d8(0x1c7)](_0xe169d8(0x1f0),{'val':JSON[_0xe169d8(0x1e4)]({'room':_0x264e5c,'reason':_0x5e50d0,'timestamp':Date[_0xe169d8(0x1ef)]()}),'ack':!![]});return;}resetTimer(_0x6c589b);}if(!currentMonitoredRoom){await _0x6c589b[_0xe169d8(0x1c7)](_0xe169d8(0x1cd),{'val':_0x264e5c,'ack':!![]});const _0x5dba4e=await loadConfig(_0x6c589b);let _0x1885dd=getTimeoutRobust(_0x5dba4e,_0x264e5c);const _0x2d0a0c=_0x264e5c[_0xe169d8(0x1f2)]();if(!_0x1885dd)for(const _0x17073f in DEFAULT_TIMEOUTS){if(_0x2d0a0c[_0xe169d8(0x1cc)](_0x17073f)){_0x1885dd=DEFAULT_TIMEOUTS[_0x17073f];break;}}if(!_0x1885dd&&_0x5dba4e[_0xe169d8(0x1d1)])_0x1885dd=_0x5dba4e[_0xe169d8(0x1d1)];if(!_0x1885dd)return;currentMonitoredRoom=_0x264e5c,startTimer(_0x6c589b,_0x1885dd,_0x264e5c);}}function startTimer(_0xe962b7,_0x33c1eb,_0x484d56){const _0x3ba087=a2_0x284e46;if(activeTimer)clearTimeout(activeTimer);timeoutMs=_0x33c1eb*0x3c*0x3e8,startTime=Date[_0x3ba087(0x1ef)](),alarmStage=0x0;const _0x9dd80e=calculateSleepProbability(_0x484d56||currentMonitoredRoom),_0x24eb44=_0x9dd80e>0.65;_0x24eb44?(timeoutMs+=0x5a*0x3c*0x3e8,_0xe962b7[_0x3ba087(0x1d7)][_0x3ba087(0x1c9)](_0x3ba087(0x1e0)+(_0x9dd80e*0x64)['toFixed'](0x0)+_0x3ba087(0x1c6)+currentMonitoredRoom+_0x3ba087(0x1d5)),_0xe962b7[_0x3ba087(0x1c7)](_0x3ba087(0x1c5),{'val':!![],'ack':!![]})):_0xe962b7['setStateAsync']('analysis.safety.deadMan.smartSleep',{'val':![],'ack':!![]}),_0xe962b7[_0x3ba087(0x1c7)](_0x3ba087(0x1e7),{'val':_0x9dd80e,'ack':!![]}),_0xe962b7[_0x3ba087(0x1d7)][_0x3ba087(0x1c9)]('üëº\x20Schutzengel:\x20√úberwache\x20'+currentMonitoredRoom+_0x3ba087(0x1d3)+_0x33c1eb+_0x3ba087(0x1f7)),_0xe962b7[_0x3ba087(0x1c7)](_0x3ba087(0x1ce),{'val':'ok','ack':!![]}),activeTimer=setTimeout(()=>triggerPreWarn(_0xe962b7),timeoutMs);}function resetTimer(_0x3de839){const _0x16e4e5=a2_0x284e46;if(activeTimer)clearTimeout(activeTimer);activeTimer=null,currentMonitoredRoom=null,alarmStage=0x0,_0x3de839['setStateAsync']('analysis.safety.deadMan.alarmState',{'val':'ok','ack':!![]}),_0x3de839[_0x16e4e5(0x1c7)]('analysis.safety.deadMan.smartSleep',{'val':![],'ack':!![]}),_0x3de839[_0x16e4e5(0x1c7)](_0x16e4e5(0x1e7),{'val':0x0,'ack':!![]});}async function triggerPreWarn(_0x320c2d){const _0x744762=a2_0x284e46;alarmStage=0x1,await _0x320c2d[_0x744762(0x1c7)]('analysis.safety.deadMan.alarmState',{'val':'pre_warn','ack':!![]});const _0x580b49=_0x744762(0x1e8)+currentMonitoredRoom+_0x744762(0x1ee);_0x320c2d['log'][_0x744762(0x1cf)]('[DeadMan]\x20'+_0x580b49),await setup[_0x744762(0x1ed)](_0x320c2d,_0x744762(0x1ca)+_0x580b49),activeTimer=setTimeout(()=>triggerAlarm(_0x320c2d),0x5*0x3c*0x3e8);}function a2_0x5baa(){const _0x4dff38=['%).\x20Verl√§ngere\x20Timer\x20f√ºr\x20','setStateAsync','650787IbsOCg','info','üëº\x20Schutzengel-Frage:\x20','1859940eczPqI','includes','analysis.safety.deadMan.currentRoom','analysis.safety.deadMan.alarmState','warn','analysis.safety.deadMan.config','default','./setup','\x20f√ºr\x20','165pxKvDC','\x20um\x2090\x20Min.','replace','log','113806iGtJOw','getStateAsync','bed','(((.+)+)+)+$','\x27.\x20Nicht\x20verbunden\x20mit\x20√ºberwachtem\x20\x27','870474WIQRJL','sofa','apply','üí§\x20Smart\x20Sleep\x20erkannt\x20(','constructor','[DeadMan]\x20','search','stringify','parse','exports','analysis.safety.deadMan.napProbability','‚è≥\x20ACHTUNG:\x20Ungew√∂hnlich\x20lange\x20Inaktivit√§t\x20in\x20','2320012rkKnhB','indexOf','alarm','[DeadMan]\x20Topology\x20check\x20failed:\x20','sendNotification','.\x20Alles\x20in\x20Ordnung?','now','analysis.safety.deadMan.lastIgnored','\x20(Multi-Person\x20Filter)','toLowerCase','analysis.safety.deadMan.active','val','toString','13336kmQefd','\x20Min.','Ignoriere\x20Bewegung\x20in\x20\x27','living','33204789IICZOm','464Rhmpzq','analysis.safety.deadMan.smartSleep'];a2_0x5baa=function(){return _0x4dff38;};return a2_0x5baa();}async function triggerAlarm(_0x3a080c){const _0x14d63a=a2_0x284e46;alarmStage=0x2,await _0x3a080c['setStateAsync'](_0x14d63a(0x1ce),{'val':_0x14d63a(0x1eb),'ack':!![]});const _0x5ccf9a='üö®\x20NOTFALL-ALARM:\x20Person\x20reagiert\x20nicht\x20in\x20'+currentMonitoredRoom+'!';_0x3a080c[_0x14d63a(0x1d7)]['error'](_0x14d63a(0x1e2)+_0x5ccf9a),await setup[_0x14d63a(0x1ed)](_0x3a080c,_0x5ccf9a,![],!![]);}module[a2_0x284e46(0x1e6)]={'updateLocation':updateLocation};