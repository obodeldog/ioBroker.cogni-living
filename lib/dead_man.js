const a2_0x45cf37=a2_0x4a65;(function(_0x28f18f,_0x21eca3){const _0x39ba19=a2_0x4a65,_0x283583=_0x28f18f();while(!![]){try{const _0x59d260=-parseInt(_0x39ba19(0xfd))/0x1*(parseInt(_0x39ba19(0xf1))/0x2)+-parseInt(_0x39ba19(0x116))/0x3*(parseInt(_0x39ba19(0x106))/0x4)+-parseInt(_0x39ba19(0x110))/0x5+-parseInt(_0x39ba19(0x118))/0x6+-parseInt(_0x39ba19(0x11e))/0x7+parseInt(_0x39ba19(0x104))/0x8*(-parseInt(_0x39ba19(0x102))/0x9)+parseInt(_0x39ba19(0xf9))/0xa*(parseInt(_0x39ba19(0x126))/0xb);if(_0x59d260===_0x21eca3)break;else _0x283583['push'](_0x283583['shift']());}catch(_0x4fbb0c){_0x283583['push'](_0x283583['shift']());}}}(a2_0x2a33,0xa054e));const a2_0x6c1df4=(function(){let _0x18e2ce=!![];return function(_0x219d55,_0x4fc0b9){const _0xb367c7=_0x18e2ce?function(){const _0x2820b1=a2_0x4a65;if(_0x4fc0b9){const _0x6a6647=_0x4fc0b9[_0x2820b1(0x10f)](_0x219d55,arguments);return _0x4fc0b9=null,_0x6a6647;}}:function(){};return _0x18e2ce=![],_0xb367c7;};}()),a2_0x37dadc=a2_0x6c1df4(this,function(){const _0x3ca0f8=a2_0x4a65;return a2_0x37dadc[_0x3ca0f8(0x107)]()[_0x3ca0f8(0xf2)]('(((.+)+)+)+$')[_0x3ca0f8(0x107)]()[_0x3ca0f8(0x101)](a2_0x37dadc)[_0x3ca0f8(0xf2)](_0x3ca0f8(0x111));});a2_0x37dadc();'use strict';const setup=require(a2_0x45cf37(0x117));let activeTimer=null,currentMonitoredRoom=null,timeoutMs=0x0,startTime=0x0,alarmStage=0x0;const DEFAULT_TIMEOUTS={'bad':0x2d,'bath':0x2d,'toilet':0x1e,'wc':0x1e,'keller':0x3c,'schlaf':0x78,'bed':0x78,'guest':0x5a,'gast':0x5a};function a2_0x2a33(){const _0x4bfa8f=['%).\x20VerlÃ¤ngere\x20Timer\x20fÃ¼r\x20','getStateAsync','analysis.topology.structure','alarm','apply','625135uXJHWK','(((.+)+)+)+$','warn','â³\x20ACHTUNG:\x20UngewÃ¶hnlich\x20lange\x20InaktivitÃ¤t\x20in\x20','Ignoriere\x20Bewegung\x20in\x20\x27','parse','121131jhchIx','./setup','4875516sYEMxT','\x27.\x20Nicht\x20verbunden\x20mit\x20Ã¼berwachtem\x20\x27','analysis.safety.deadMan.currentRoom','analysis.safety.deadMan.smartSleep','replace','schlaf','6509601pdGtfX','indexOf','ðŸš¨\x20NOTFALL-ALARM:\x20Person\x20reagiert\x20nicht\x20in\x20','\x20Min.','setStateAsync','ðŸ‘¼\x20Schutzengel:\x20Ãœberwache\x20','living','default','11bEdJhp','val','[DeadMan]\x20','analysis.safety.deadMan.napProbability','toLowerCase','\x20(Multi-Person\x20Filter)','pre_warn','2LFTJFO','search','analysis.safety.deadMan.alarmState','ðŸ‘¼\x20Schutzengel-Frage:\x20','info','Unknown','includes','\x20fÃ¼r\x20','46377070YQZVZp','message','analysis.safety.deadMan.config','toFixed','1150385ZCrJKT','analysis.safety.deadMan.active','log','error','constructor','1323jQFXxD','[DeadMan]\x20Topology\x20check\x20failed:\x20','48016PYqEJm','.\x20Alles\x20in\x20Ordnung?','8kvXGqJ','toString','ðŸ’¤\x20Smart\x20Sleep\x20erkannt\x20(','sendNotification','getHours'];a2_0x2a33=function(){return _0x4bfa8f;};return a2_0x2a33();}function getTimeoutRobust(_0x1d1b86,_0xe8395){const _0x4534a=a2_0x45cf37;if(!_0x1d1b86||!_0xe8395)return undefined;if(_0x1d1b86[_0xe8395])return _0x1d1b86[_0xe8395];const _0x39f8dd=_0xe8395[_0x4534a(0x12a)]()[_0x4534a(0x11c)](/[^a-z0-9]/g,'');for(const _0x2c0a7d in _0x1d1b86){const _0x4ba1c3=_0x2c0a7d['toLowerCase']()[_0x4534a(0x11c)](/[^a-z0-9]/g,'');if(_0x4ba1c3===_0x39f8dd)return _0x1d1b86[_0x2c0a7d];}const _0x56599d=_0xe8395['toLowerCase']();if(_0x1d1b86[_0x56599d])return _0x1d1b86[_0x56599d];return undefined;}async function loadConfig(_0x3934bb){const _0x1188ee=a2_0x45cf37;try{const _0x1a185c=await _0x3934bb[_0x1188ee(0x10c)](_0x1188ee(0xfb));if(_0x1a185c&&_0x1a185c[_0x1188ee(0x127)])return JSON[_0x1188ee(0x115)](_0x1a185c[_0x1188ee(0x127)]);}catch(_0x3162dc){}return{};}async function isActive(_0x5cf487){const _0x56746a=a2_0x45cf37;try{const _0x3dadf6=await _0x5cf487[_0x56746a(0x10c)](_0x56746a(0xfe));return _0x3dadf6&&_0x3dadf6[_0x56746a(0x127)];}catch(_0x2feed4){return![];}}async function areRoomsConnected(_0xdfbb4f,_0x8ab1cb,_0x6dd90){const _0x31d4d3=a2_0x45cf37;try{const _0x1e336e=await _0xdfbb4f[_0x31d4d3(0x10c)](_0x31d4d3(0x10d));if(!_0x1e336e||!_0x1e336e[_0x31d4d3(0x127)])return!![];const _0x6ceb66=JSON[_0x31d4d3(0x115)](_0x1e336e[_0x31d4d3(0x127)]),{rooms:_0x14f649,matrix:_0x5d2894}=_0x6ceb66;if(!_0x14f649||!_0x5d2894)return!![];const _0x491bb3=_0x14f649[_0x31d4d3(0x11f)](_0x8ab1cb),_0x2c93ba=_0x14f649[_0x31d4d3(0x11f)](_0x6dd90);if(_0x491bb3===-0x1||_0x2c93ba===-0x1)return!![];const _0x173a7d=_0x5d2894[_0x491bb3][_0x2c93ba]>0x0||_0x5d2894[_0x2c93ba][_0x491bb3]>0x0;return _0x173a7d;}catch(_0x5be8fc){return _0xdfbb4f[_0x31d4d3(0xff)][_0x31d4d3(0x112)](_0x31d4d3(0x103)+_0x5be8fc[_0x31d4d3(0xfa)]),!![];}}function calculateSleepProbability(_0x3ed03d){const _0x528527=a2_0x45cf37,_0x25120a=new Date(),_0x36047b=_0x25120a[_0x528527(0x10a)](),_0x458658=_0x3ed03d[_0x528527(0x12a)]();let _0x145529=0.1;if(_0x36047b>=0x17||_0x36047b<=0x6)_0x145529=0x1;else{if(_0x36047b>=0xd&&_0x36047b<=0xf)_0x145529=0.8;else{if(_0x36047b>=0x14&&_0x36047b<=0x17)_0x145529=0.4;}}let _0x16fa23=0.1;if(_0x458658[_0x528527(0xf7)](_0x528527(0x11d))||_0x458658[_0x528527(0xf7)]('bed'))_0x16fa23=0x1;else{if(_0x458658['includes']('wohn')||_0x458658[_0x528527(0xf7)](_0x528527(0x124))||_0x458658['includes']('sofa'))_0x16fa23=0.6;else{if(_0x458658['includes']('bad')||_0x458658[_0x528527(0xf7)]('wc'))_0x16fa23=0.05;}}let _0x1ce1ce=0.5;const _0x386e65=_0x16fa23*0.5+_0x145529*0.3+_0x1ce1ce*0.2;return parseFloat(_0x386e65[_0x528527(0xfc)](0x2));}async function updateLocation(_0x28e340,_0x397648){const _0x20b746=a2_0x45cf37;if(!_0x397648||_0x397648===_0x20b746(0xf6))return;if(!await isActive(_0x28e340)){resetTimer(_0x28e340);return;}if(currentMonitoredRoom&&currentMonitoredRoom!==_0x397648){const _0x9d6fe2=await areRoomsConnected(_0x28e340,currentMonitoredRoom,_0x397648);if(!_0x9d6fe2){const _0x428088=_0x20b746(0x114)+_0x397648+_0x20b746(0x119)+currentMonitoredRoom+'\x27.';_0x28e340[_0x20b746(0xff)]['info'](_0x20b746(0x128)+_0x428088+_0x20b746(0xef)),await _0x28e340[_0x20b746(0x122)]('analysis.safety.deadMan.lastIgnored',{'val':JSON['stringify']({'room':_0x397648,'reason':_0x428088,'timestamp':Date['now']()}),'ack':!![]});return;}resetTimer(_0x28e340);}if(!currentMonitoredRoom){await _0x28e340['setStateAsync'](_0x20b746(0x11a),{'val':_0x397648,'ack':!![]});const _0x317483=await loadConfig(_0x28e340);let _0x58c61d=getTimeoutRobust(_0x317483,_0x397648);const _0x41ba57=_0x397648[_0x20b746(0x12a)]();if(!_0x58c61d)for(const _0x3821c8 in DEFAULT_TIMEOUTS){if(_0x41ba57[_0x20b746(0xf7)](_0x3821c8)){_0x58c61d=DEFAULT_TIMEOUTS[_0x3821c8];break;}}if(!_0x58c61d&&_0x317483[_0x20b746(0x125)])_0x58c61d=_0x317483[_0x20b746(0x125)];if(!_0x58c61d)return;currentMonitoredRoom=_0x397648,startTimer(_0x28e340,_0x58c61d,_0x397648);}}function startTimer(_0x48c6f7,_0x3fbea3,_0x2a910f){const _0x11ed45=a2_0x45cf37;if(activeTimer)clearTimeout(activeTimer);timeoutMs=_0x3fbea3*0x3c*0x3e8,startTime=Date['now'](),alarmStage=0x0;const _0x5e8dc4=calculateSleepProbability(_0x2a910f||currentMonitoredRoom),_0x20ecdf=_0x5e8dc4>0.65;_0x20ecdf?(timeoutMs+=0x5a*0x3c*0x3e8,_0x48c6f7[_0x11ed45(0xff)][_0x11ed45(0xf5)](_0x11ed45(0x108)+(_0x5e8dc4*0x64)['toFixed'](0x0)+_0x11ed45(0x10b)+currentMonitoredRoom+'\x20um\x2090\x20Min.'),_0x48c6f7[_0x11ed45(0x122)](_0x11ed45(0x11b),{'val':!![],'ack':!![]})):_0x48c6f7[_0x11ed45(0x122)](_0x11ed45(0x11b),{'val':![],'ack':!![]}),_0x48c6f7[_0x11ed45(0x122)]('analysis.safety.deadMan.napProbability',{'val':_0x5e8dc4,'ack':!![]}),_0x48c6f7[_0x11ed45(0xff)][_0x11ed45(0xf5)](_0x11ed45(0x123)+currentMonitoredRoom+_0x11ed45(0xf8)+_0x3fbea3+_0x11ed45(0x121)),_0x48c6f7['setStateAsync'](_0x11ed45(0xf3),{'val':'ok','ack':!![]}),activeTimer=setTimeout(()=>triggerPreWarn(_0x48c6f7),timeoutMs);}function resetTimer(_0x4f7743){const _0x58d64f=a2_0x45cf37;if(activeTimer)clearTimeout(activeTimer);activeTimer=null,currentMonitoredRoom=null,alarmStage=0x0,_0x4f7743[_0x58d64f(0x122)](_0x58d64f(0xf3),{'val':'ok','ack':!![]}),_0x4f7743[_0x58d64f(0x122)](_0x58d64f(0x11b),{'val':![],'ack':!![]}),_0x4f7743[_0x58d64f(0x122)](_0x58d64f(0x129),{'val':0x0,'ack':!![]});}async function triggerPreWarn(_0x466010){const _0x4a25d1=a2_0x45cf37;alarmStage=0x1,await _0x466010[_0x4a25d1(0x122)](_0x4a25d1(0xf3),{'val':_0x4a25d1(0xf0),'ack':!![]});const _0x58d6e1=_0x4a25d1(0x113)+currentMonitoredRoom+_0x4a25d1(0x105);_0x466010[_0x4a25d1(0xff)]['warn']('[DeadMan]\x20'+_0x58d6e1),await setup[_0x4a25d1(0x109)](_0x466010,_0x4a25d1(0xf4)+_0x58d6e1),activeTimer=setTimeout(()=>triggerAlarm(_0x466010),0x5*0x3c*0x3e8);}function a2_0x4a65(_0x371d19,_0x2b0256){const _0x560e80=a2_0x2a33();return a2_0x4a65=function(_0x37dadc,_0x6c1df4){_0x37dadc=_0x37dadc-0xef;let _0x2a33fd=_0x560e80[_0x37dadc];return _0x2a33fd;},a2_0x4a65(_0x371d19,_0x2b0256);}async function triggerAlarm(_0x4c21ee){const _0x15f902=a2_0x45cf37;alarmStage=0x2,await _0x4c21ee[_0x15f902(0x122)](_0x15f902(0xf3),{'val':_0x15f902(0x10e),'ack':!![]});const _0x45d234=_0x15f902(0x120)+currentMonitoredRoom+'!';_0x4c21ee['log'][_0x15f902(0x100)](_0x15f902(0x128)+_0x45d234),await setup['sendNotification'](_0x4c21ee,_0x45d234,![],!![]);}module['exports']={'updateLocation':updateLocation};