const a2_0x243bb3=a2_0x9e6c;(function(_0x53966,_0x11a028){const _0x5206f3=a2_0x9e6c,_0x19dc8a=_0x53966();while(!![]){try{const _0x419a96=-parseInt(_0x5206f3(0xd6))/0x1*(parseInt(_0x5206f3(0xdd))/0x2)+parseInt(_0x5206f3(0xd8))/0x3*(-parseInt(_0x5206f3(0xae))/0x4)+parseInt(_0x5206f3(0xc1))/0x5+parseInt(_0x5206f3(0xd2))/0x6*(-parseInt(_0x5206f3(0xc2))/0x7)+-parseInt(_0x5206f3(0xad))/0x8+-parseInt(_0x5206f3(0xb4))/0x9*(parseInt(_0x5206f3(0xce))/0xa)+parseInt(_0x5206f3(0xb9))/0xb;if(_0x419a96===_0x11a028)break;else _0x19dc8a['push'](_0x19dc8a['shift']());}catch(_0x92f968){_0x19dc8a['push'](_0x19dc8a['shift']());}}}(a2_0x4b5d,0x413ed));function a2_0x4b5d(){const _0x280a1c=['toLowerCase','alarm','(((.+)+)+)+$','34FCrUcI','pre_warn','setStateAsync','default','info','constructor','analysis.safety.deadMan.active','analysis.safety.deadMan.lastIgnored','analysis.safety.deadMan.config','indexOf','Ignoriere\x20Bewegung\x20in\x20\x27','2054208xbUblB','1892fjcqxC','val','stringify','ðŸš¨\x20NOTFALL-ALARM:\x20Person\x20reagiert\x20nicht\x20in\x20','.\x20Alles\x20in\x20Ordnung?','now','1737RaDfOz','log','sofa','toFixed','Unknown','12802163RcWJig','analysis.safety.deadMan.napProbability','analysis.safety.deadMan.currentRoom','parse','replace','exports','\x20um\x2090\x20Min.','\x20(Multi-Person\x20Filter)','228470MLTsyD','770QibUZt','ðŸ‘¼\x20Schutzengel-Frage:\x20','[DeadMan]\x20','ðŸ’¤\x20Smart\x20Sleep\x20erkannt\x20(','includes','wohn','warn','\x20fÃ¼r\x20','bad','living','analysis.safety.deadMan.alarmState','getStateAsync','26030UzPpgr','%).\x20VerlÃ¤ngere\x20Timer\x20fÃ¼r\x20','sendNotification','schlaf','5514BFNpZd','getHours','analysis.safety.deadMan.smartSleep','error','4464nbYprF','search','39iioksa','\x27.\x20Nicht\x20verbunden\x20mit\x20Ã¼berwachtem\x20\x27'];a2_0x4b5d=function(){return _0x280a1c;};return a2_0x4b5d();}const a2_0x3e9c44=(function(){let _0x32d487=!![];return function(_0x13ae0e,_0x4548cc){const _0x55d97a=_0x32d487?function(){if(_0x4548cc){const _0x10e415=_0x4548cc['apply'](_0x13ae0e,arguments);return _0x4548cc=null,_0x10e415;}}:function(){};return _0x32d487=![],_0x55d97a;};}()),a2_0x5c9bed=a2_0x3e9c44(this,function(){const _0x36622b=a2_0x9e6c;return a2_0x5c9bed['toString']()[_0x36622b(0xd7)]('(((.+)+)+)+$')['toString']()[_0x36622b(0xe2)](a2_0x5c9bed)[_0x36622b(0xd7)](_0x36622b(0xdc));});a2_0x5c9bed();'use strict';function a2_0x9e6c(_0xf03b27,_0x3f801a){const _0x4ab102=a2_0x4b5d();return a2_0x9e6c=function(_0x5c9bed,_0x3e9c44){_0x5c9bed=_0x5c9bed-0xab;let _0x4b5d7e=_0x4ab102[_0x5c9bed];return _0x4b5d7e;},a2_0x9e6c(_0xf03b27,_0x3f801a);}const setup=require('./setup');let activeTimer=null,currentMonitoredRoom=null,timeoutMs=0x0,startTime=0x0,alarmStage=0x0;const DEFAULT_TIMEOUTS={'bad':0x2d,'bath':0x2d,'toilet':0x1e,'wc':0x1e,'keller':0x3c,'schlaf':0x78,'bed':0x78,'guest':0x5a,'gast':0x5a};function getTimeoutRobust(_0x335aaa,_0x2868fa){const _0x3c1f75=a2_0x9e6c;if(!_0x335aaa||!_0x2868fa)return undefined;if(_0x335aaa[_0x2868fa])return _0x335aaa[_0x2868fa];const _0x162d0d=_0x2868fa[_0x3c1f75(0xda)]()[_0x3c1f75(0xbd)](/[^a-z0-9]/g,'');for(const _0xc8c4f7 in _0x335aaa){const _0x5a1934=_0xc8c4f7[_0x3c1f75(0xda)]()['replace'](/[^a-z0-9]/g,'');if(_0x5a1934===_0x162d0d)return _0x335aaa[_0xc8c4f7];}const _0x3b7b1f=_0x2868fa[_0x3c1f75(0xda)]();if(_0x335aaa[_0x3b7b1f])return _0x335aaa[_0x3b7b1f];return undefined;}async function loadConfig(_0xb9442b){const _0x1b9fb7=a2_0x9e6c;try{const _0x391ab5=await _0xb9442b['getStateAsync'](_0x1b9fb7(0xe5));if(_0x391ab5&&_0x391ab5[_0x1b9fb7(0xaf)])return JSON[_0x1b9fb7(0xbc)](_0x391ab5[_0x1b9fb7(0xaf)]);}catch(_0x587384){}return{};}async function isActive(_0x27e172){const _0x44fc62=a2_0x9e6c;try{const _0x56f527=await _0x27e172['getStateAsync'](_0x44fc62(0xe3));return _0x56f527&&_0x56f527['val'];}catch(_0x357c37){return![];}}async function areRoomsConnected(_0x2e7641,_0x3a4c91,_0x31bdf2){const _0x41d4d0=a2_0x9e6c;try{const _0x1e8dd3=await _0x2e7641[_0x41d4d0(0xcd)]('analysis.topology.structure');if(!_0x1e8dd3||!_0x1e8dd3[_0x41d4d0(0xaf)])return!![];const _0x4d509e=JSON[_0x41d4d0(0xbc)](_0x1e8dd3[_0x41d4d0(0xaf)]),{rooms:_0x15216c,matrix:_0x5f5237}=_0x4d509e;if(!_0x15216c||!_0x5f5237)return!![];const _0x409fb4=_0x15216c[_0x41d4d0(0xab)](_0x3a4c91),_0x12ec2e=_0x15216c[_0x41d4d0(0xab)](_0x31bdf2);if(_0x409fb4===-0x1||_0x12ec2e===-0x1)return!![];const _0x42bbc6=_0x5f5237[_0x409fb4][_0x12ec2e]>0x0||_0x5f5237[_0x12ec2e][_0x409fb4]>0x0;return _0x42bbc6;}catch(_0x58cf2a){return _0x2e7641[_0x41d4d0(0xb5)][_0x41d4d0(0xc8)]('[DeadMan]\x20Topology\x20check\x20failed:\x20'+_0x58cf2a['message']),!![];}}function calculateSleepProbability(_0x1d1911){const _0xff5130=a2_0x9e6c,_0x4162b6=new Date(),_0x3285bc=_0x4162b6[_0xff5130(0xd3)](),_0x275030=_0x1d1911['toLowerCase']();let _0x42d7c2=0.1;if(_0x3285bc>=0x17||_0x3285bc<=0x6)_0x42d7c2=0x1;else{if(_0x3285bc>=0xd&&_0x3285bc<=0xf)_0x42d7c2=0.8;else{if(_0x3285bc>=0x14&&_0x3285bc<=0x17)_0x42d7c2=0.4;}}let _0x5d1fe0=0.1;if(_0x275030[_0xff5130(0xc6)](_0xff5130(0xd1))||_0x275030[_0xff5130(0xc6)]('bed'))_0x5d1fe0=0x1;else{if(_0x275030['includes'](_0xff5130(0xc7))||_0x275030['includes'](_0xff5130(0xcb))||_0x275030['includes'](_0xff5130(0xb6)))_0x5d1fe0=0.6;else{if(_0x275030['includes'](_0xff5130(0xca))||_0x275030[_0xff5130(0xc6)]('wc'))_0x5d1fe0=0.05;}}let _0x549fbd=0.5;const _0x115787=_0x5d1fe0*0.5+_0x42d7c2*0.3+_0x549fbd*0.2;return parseFloat(_0x115787[_0xff5130(0xb7)](0x2));}async function updateLocation(_0x5cdf05,_0x2876dc){const _0x104356=a2_0x9e6c;if(!_0x2876dc||_0x2876dc===_0x104356(0xb8))return;if(!await isActive(_0x5cdf05)){resetTimer(_0x5cdf05);return;}if(currentMonitoredRoom&&currentMonitoredRoom!==_0x2876dc){const _0xaac8c2=await areRoomsConnected(_0x5cdf05,currentMonitoredRoom,_0x2876dc);if(!_0xaac8c2){const _0x113175=_0x104356(0xac)+_0x2876dc+_0x104356(0xd9)+currentMonitoredRoom+'\x27.';_0x5cdf05['log'][_0x104356(0xe1)]('[DeadMan]\x20'+_0x113175+_0x104356(0xc0)),await _0x5cdf05[_0x104356(0xdf)](_0x104356(0xe4),{'val':JSON[_0x104356(0xb0)]({'room':_0x2876dc,'reason':_0x113175,'timestamp':Date[_0x104356(0xb3)]()}),'ack':!![]});return;}resetTimer(_0x5cdf05);}if(!currentMonitoredRoom){await _0x5cdf05[_0x104356(0xdf)](_0x104356(0xbb),{'val':_0x2876dc,'ack':!![]});const _0x24ec4f=await loadConfig(_0x5cdf05);let _0x5b2dd0=getTimeoutRobust(_0x24ec4f,_0x2876dc);const _0xe1bfc0=_0x2876dc[_0x104356(0xda)]();if(!_0x5b2dd0)for(const _0x2b0e23 in DEFAULT_TIMEOUTS){if(_0xe1bfc0[_0x104356(0xc6)](_0x2b0e23)){_0x5b2dd0=DEFAULT_TIMEOUTS[_0x2b0e23];break;}}if(!_0x5b2dd0&&_0x24ec4f[_0x104356(0xe0)])_0x5b2dd0=_0x24ec4f[_0x104356(0xe0)];if(!_0x5b2dd0)return;currentMonitoredRoom=_0x2876dc,startTimer(_0x5cdf05,_0x5b2dd0,_0x2876dc);}}function startTimer(_0x10bc90,_0x2fee92,_0x5313e1){const _0x4dcaf2=a2_0x9e6c;if(activeTimer)clearTimeout(activeTimer);timeoutMs=_0x2fee92*0x3c*0x3e8,startTime=Date[_0x4dcaf2(0xb3)](),alarmStage=0x0;const _0x97cbc6=calculateSleepProbability(_0x5313e1||currentMonitoredRoom),_0x56c841=_0x97cbc6>0.65;_0x56c841?(timeoutMs+=0x5a*0x3c*0x3e8,_0x10bc90[_0x4dcaf2(0xb5)]['info'](_0x4dcaf2(0xc5)+(_0x97cbc6*0x64)['toFixed'](0x0)+_0x4dcaf2(0xcf)+currentMonitoredRoom+_0x4dcaf2(0xbf)),_0x10bc90[_0x4dcaf2(0xdf)](_0x4dcaf2(0xd4),{'val':!![],'ack':!![]})):_0x10bc90[_0x4dcaf2(0xdf)](_0x4dcaf2(0xd4),{'val':![],'ack':!![]}),_0x10bc90[_0x4dcaf2(0xdf)](_0x4dcaf2(0xba),{'val':_0x97cbc6,'ack':!![]}),_0x10bc90[_0x4dcaf2(0xb5)][_0x4dcaf2(0xe1)]('ðŸ‘¼\x20Schutzengel:\x20Ãœberwache\x20'+currentMonitoredRoom+_0x4dcaf2(0xc9)+_0x2fee92+'\x20Min.'),_0x10bc90['setStateAsync'](_0x4dcaf2(0xcc),{'val':'ok','ack':!![]}),activeTimer=setTimeout(()=>triggerPreWarn(_0x10bc90),timeoutMs);}function resetTimer(_0x36e74a){const _0x2feb2c=a2_0x9e6c;if(activeTimer)clearTimeout(activeTimer);activeTimer=null,currentMonitoredRoom=null,alarmStage=0x0,_0x36e74a[_0x2feb2c(0xdf)](_0x2feb2c(0xcc),{'val':'ok','ack':!![]}),_0x36e74a[_0x2feb2c(0xdf)](_0x2feb2c(0xd4),{'val':![],'ack':!![]}),_0x36e74a[_0x2feb2c(0xdf)](_0x2feb2c(0xba),{'val':0x0,'ack':!![]});}async function triggerPreWarn(_0x1cda91){const _0x5982f1=a2_0x9e6c;alarmStage=0x1,await _0x1cda91[_0x5982f1(0xdf)]('analysis.safety.deadMan.alarmState',{'val':_0x5982f1(0xde),'ack':!![]});const _0x3915c4='â³\x20ACHTUNG:\x20UngewÃ¶hnlich\x20lange\x20InaktivitÃ¤t\x20in\x20'+currentMonitoredRoom+_0x5982f1(0xb2);_0x1cda91[_0x5982f1(0xb5)][_0x5982f1(0xc8)](_0x5982f1(0xc4)+_0x3915c4),await setup[_0x5982f1(0xd0)](_0x1cda91,_0x5982f1(0xc3)+_0x3915c4),activeTimer=setTimeout(()=>triggerAlarm(_0x1cda91),0x5*0x3c*0x3e8);}async function triggerAlarm(_0x2c1752){const _0x1a910a=a2_0x9e6c;alarmStage=0x2,await _0x2c1752[_0x1a910a(0xdf)](_0x1a910a(0xcc),{'val':_0x1a910a(0xdb),'ack':!![]});const _0x6b2bcc=_0x1a910a(0xb1)+currentMonitoredRoom+'!';_0x2c1752[_0x1a910a(0xb5)][_0x1a910a(0xd5)](_0x1a910a(0xc4)+_0x6b2bcc),await setup[_0x1a910a(0xd0)](_0x2c1752,_0x6b2bcc,![],!![]);}module[a2_0x243bb3(0xbe)]={'updateLocation':updateLocation};