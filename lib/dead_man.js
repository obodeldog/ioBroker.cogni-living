const a2_0x157e07=a2_0xf260;function a2_0xf260(_0x5e4841,_0x102c5c){const _0x46347a=a2_0x444a();return a2_0xf260=function(_0x5d0794,_0x5044f0){_0x5d0794=_0x5d0794-0x106;let _0x444aed=_0x46347a[_0x5d0794];return _0x444aed;},a2_0xf260(_0x5e4841,_0x102c5c);}(function(_0x1d7452,_0x303b63){const _0x4f96fd=a2_0xf260,_0x1d2691=_0x1d7452();while(!![]){try{const _0xf7b507=parseInt(_0x4f96fd(0x124))/0x1+-parseInt(_0x4f96fd(0x12c))/0x2+-parseInt(_0x4f96fd(0x13a))/0x3+parseInt(_0x4f96fd(0x137))/0x4*(-parseInt(_0x4f96fd(0x115))/0x5)+-parseInt(_0x4f96fd(0x123))/0x6+-parseInt(_0x4f96fd(0x117))/0x7*(parseInt(_0x4f96fd(0x122))/0x8)+parseInt(_0x4f96fd(0x118))/0x9;if(_0xf7b507===_0x303b63)break;else _0x1d2691['push'](_0x1d2691['shift']());}catch(_0x5e59df){_0x1d2691['push'](_0x1d2691['shift']());}}}(a2_0x444a,0x52a02));const a2_0x5044f0=(function(){let _0x1325ea=!![];return function(_0x4d7b7b,_0x359c12){const _0x581cb4=_0x1325ea?function(){const _0xe04b1=a2_0xf260;if(_0x359c12){const _0x21ce48=_0x359c12[_0xe04b1(0x134)](_0x4d7b7b,arguments);return _0x359c12=null,_0x21ce48;}}:function(){};return _0x1325ea=![],_0x581cb4;};}()),a2_0x5d0794=a2_0x5044f0(this,function(){const _0xab6198=a2_0xf260;return a2_0x5d0794[_0xab6198(0x11f)]()[_0xab6198(0x11d)](_0xab6198(0x138))[_0xab6198(0x11f)]()[_0xab6198(0x11b)](a2_0x5d0794)[_0xab6198(0x11d)]('(((.+)+)+)+$');});a2_0x5d0794();'use strict';const setup=require(a2_0x157e07(0x12b));let activeTimer=null,currentMonitoredRoom=null,timeoutMs=0x0,startTime=0x0,alarmStage=0x0;const DEFAULT_TIMEOUTS={'bad':0x2d,'bath':0x2d,'toilet':0x1e,'wc':0x1e,'keller':0x3c,'schlaf':0x78,'bed':0x78,'guest':0x5a,'gast':0x5a};function getTimeoutRobust(_0x581266,_0x2f21bc){const _0x3decbe=a2_0x157e07;if(!_0x581266||!_0x2f21bc)return undefined;if(_0x581266[_0x2f21bc])return _0x581266[_0x2f21bc];const _0x27cc77=_0x2f21bc[_0x3decbe(0x131)]()[_0x3decbe(0x12a)](/[^a-z0-9]/g,'');for(const _0x1c53a0 in _0x581266){const _0x4bec44=_0x1c53a0[_0x3decbe(0x131)]()[_0x3decbe(0x12a)](/[^a-z0-9]/g,'');if(_0x4bec44===_0x27cc77)return _0x581266[_0x1c53a0];}const _0x47adbc=_0x2f21bc['toLowerCase']();if(_0x581266[_0x47adbc])return _0x581266[_0x47adbc];return undefined;}async function loadConfig(_0x2d51d7){const _0x5aa770=a2_0x157e07;try{const _0x2666f2=await _0x2d51d7['getStateAsync'](_0x5aa770(0x126));if(_0x2666f2&&_0x2666f2[_0x5aa770(0x10f)])return JSON[_0x5aa770(0x130)](_0x2666f2[_0x5aa770(0x10f)]);}catch(_0x8e249a){}return{};}async function isActive(_0x48a933){const _0x1dfbc5=a2_0x157e07;try{const _0x38df3e=await _0x48a933[_0x1dfbc5(0x135)](_0x1dfbc5(0x11c));return _0x38df3e&&_0x38df3e[_0x1dfbc5(0x10f)];}catch(_0x118426){return![];}}async function areRoomsConnected(_0x298222,_0x502e5a,_0x575a4e){const _0x1908ad=a2_0x157e07;try{const _0x137855=await _0x298222['getStateAsync'](_0x1908ad(0x139));if(!_0x137855||!_0x137855[_0x1908ad(0x10f)])return!![];const _0x46f26f=JSON['parse'](_0x137855[_0x1908ad(0x10f)]),{rooms:_0x56c827,matrix:_0x2694e3}=_0x46f26f;if(!_0x56c827||!_0x2694e3)return!![];const _0x5ea9d5=_0x56c827[_0x1908ad(0x112)](_0x502e5a),_0x15dd1e=_0x56c827[_0x1908ad(0x112)](_0x575a4e);if(_0x5ea9d5===-0x1||_0x15dd1e===-0x1)return!![];const _0x1959bb=_0x2694e3[_0x5ea9d5][_0x15dd1e]>0x0||_0x2694e3[_0x15dd1e][_0x5ea9d5]>0x0;return _0x1959bb;}catch(_0x43b9f7){return _0x298222['log'][_0x1908ad(0x12e)](_0x1908ad(0x129)+_0x43b9f7['message']),!![];}}function calculateSleepProbability(_0x6a7b3b){const _0x5c28b3=a2_0x157e07,_0x1db74a=new Date(),_0x183c50=_0x1db74a[_0x5c28b3(0x121)](),_0x1b248b=_0x6a7b3b['toLowerCase']();let _0xe0d749=0.1;if(_0x183c50>=0x17||_0x183c50<=0x6)_0xe0d749=0x1;else{if(_0x183c50>=0xd&&_0x183c50<=0xf)_0xe0d749=0.8;else{if(_0x183c50>=0x14&&_0x183c50<=0x17)_0xe0d749=0.4;}}let _0x35eef1=0.1;if(_0x1b248b['includes']('schlaf')||_0x1b248b[_0x5c28b3(0x128)]('bed'))_0x35eef1=0x1;else{if(_0x1b248b[_0x5c28b3(0x128)](_0x5c28b3(0x10c))||_0x1b248b[_0x5c28b3(0x128)]('living')||_0x1b248b[_0x5c28b3(0x128)]('sofa'))_0x35eef1=0.6;else{if(_0x1b248b[_0x5c28b3(0x128)](_0x5c28b3(0x10e))||_0x1b248b['includes']('wc'))_0x35eef1=0.05;}}let _0x1c7253=0.5;const _0x4a7714=_0x35eef1*0.5+_0xe0d749*0.3+_0x1c7253*0.2;return parseFloat(_0x4a7714[_0x5c28b3(0x111)](0x2));}async function updateLocation(_0x442ac4,_0x5bac01){const _0x2f466a=a2_0x157e07;if(!_0x5bac01||_0x5bac01===_0x2f466a(0x119))return;if(!await isActive(_0x442ac4)){resetTimer(_0x442ac4);return;}if(currentMonitoredRoom&&currentMonitoredRoom!==_0x5bac01){const _0x5e7ac2=await areRoomsConnected(_0x442ac4,currentMonitoredRoom,_0x5bac01);if(!_0x5e7ac2){const _0x2fbe52='Ignoriere\x20Bewegung\x20in\x20\x27'+_0x5bac01+'\x27.\x20Nicht\x20verbunden\x20mit\x20Ã¼berwachtem\x20\x27'+currentMonitoredRoom+'\x27.';_0x442ac4[_0x2f466a(0x132)][_0x2f466a(0x12f)](_0x2f466a(0x127)+_0x2fbe52+_0x2f466a(0x113)),await _0x442ac4[_0x2f466a(0x10a)](_0x2f466a(0x108),{'val':JSON[_0x2f466a(0x136)]({'room':_0x5bac01,'reason':_0x2fbe52,'timestamp':Date[_0x2f466a(0x125)]()}),'ack':!![]});return;}resetTimer(_0x442ac4);}if(!currentMonitoredRoom){await _0x442ac4[_0x2f466a(0x10a)](_0x2f466a(0x10d),{'val':_0x5bac01,'ack':!![]});const _0x236a35=await loadConfig(_0x442ac4);let _0x148793=getTimeoutRobust(_0x236a35,_0x5bac01);const _0x4aeccd=_0x5bac01[_0x2f466a(0x131)]();if(!_0x148793)for(const _0x2a7323 in DEFAULT_TIMEOUTS){if(_0x4aeccd['includes'](_0x2a7323)){_0x148793=DEFAULT_TIMEOUTS[_0x2a7323];break;}}if(!_0x148793&&_0x236a35['default'])_0x148793=_0x236a35[_0x2f466a(0x11e)];if(!_0x148793)return;currentMonitoredRoom=_0x5bac01,startTimer(_0x442ac4,_0x148793,_0x5bac01);}}function a2_0x444a(){const _0x1035eb=['2179584PSbmqk','454273blSmoD','now','analysis.safety.deadMan.config','[DeadMan]\x20','includes','[DeadMan]\x20Topology\x20check\x20failed:\x20','replace','./setup','318604apHGtP','analysis.safety.deadMan.alarmState','warn','info','parse','toLowerCase','log','alarm','apply','getStateAsync','stringify','1357912fpwClF','(((.+)+)+)+$','analysis.topology.structure','1710006vHManu','analysis.safety.deadMan.napProbability','\x20Min.','analysis.safety.deadMan.smartSleep','analysis.safety.deadMan.lastIgnored','ðŸš¨\x20NOTFALL-ALARM:\x20Person\x20reagiert\x20nicht\x20in\x20','setStateAsync','.\x20Alles\x20in\x20Ordnung?','wohn','analysis.safety.deadMan.currentRoom','bad','val','ðŸ’¤\x20Smart\x20Sleep\x20erkannt\x20(','toFixed','indexOf','\x20(Multi-Person\x20Filter)','sendNotification','5rpEmvv','%).\x20VerlÃ¤ngere\x20Timer\x20fÃ¼r\x20','56bmGnrS','15205455xtkRUb','Unknown','ðŸ‘¼\x20Schutzengel-Frage:\x20','constructor','analysis.safety.deadMan.active','search','default','toString','pre_warn','getHours','373288qShwVz'];a2_0x444a=function(){return _0x1035eb;};return a2_0x444a();}function startTimer(_0x3e7f1a,_0x46afb5,_0x3758cf){const _0x2687e6=a2_0x157e07;if(activeTimer)clearTimeout(activeTimer);timeoutMs=_0x46afb5*0x3c*0x3e8,startTime=Date[_0x2687e6(0x125)](),alarmStage=0x0;const _0x440bae=calculateSleepProbability(_0x3758cf||currentMonitoredRoom),_0x1c0ac5=_0x440bae>0.65;_0x1c0ac5?(timeoutMs+=0x5a*0x3c*0x3e8,_0x3e7f1a[_0x2687e6(0x132)][_0x2687e6(0x12f)](_0x2687e6(0x110)+(_0x440bae*0x64)['toFixed'](0x0)+_0x2687e6(0x116)+currentMonitoredRoom+'\x20um\x2090\x20Min.'),_0x3e7f1a[_0x2687e6(0x10a)](_0x2687e6(0x107),{'val':!![],'ack':!![]})):_0x3e7f1a[_0x2687e6(0x10a)](_0x2687e6(0x107),{'val':![],'ack':!![]}),_0x3e7f1a[_0x2687e6(0x10a)]('analysis.safety.deadMan.napProbability',{'val':_0x440bae,'ack':!![]}),_0x3e7f1a[_0x2687e6(0x132)]['info']('ðŸ‘¼\x20Schutzengel:\x20Ãœberwache\x20'+currentMonitoredRoom+'\x20fÃ¼r\x20'+_0x46afb5+_0x2687e6(0x106)),_0x3e7f1a[_0x2687e6(0x10a)]('analysis.safety.deadMan.alarmState',{'val':'ok','ack':!![]}),activeTimer=setTimeout(()=>triggerPreWarn(_0x3e7f1a),timeoutMs);}function resetTimer(_0xff2c5c){const _0x26a949=a2_0x157e07;if(activeTimer)clearTimeout(activeTimer);activeTimer=null,currentMonitoredRoom=null,alarmStage=0x0,_0xff2c5c[_0x26a949(0x10a)](_0x26a949(0x12d),{'val':'ok','ack':!![]}),_0xff2c5c[_0x26a949(0x10a)]('analysis.safety.deadMan.smartSleep',{'val':![],'ack':!![]}),_0xff2c5c[_0x26a949(0x10a)](_0x26a949(0x13b),{'val':0x0,'ack':!![]});}async function triggerPreWarn(_0x312d3c){const _0xb83085=a2_0x157e07;alarmStage=0x1,await _0x312d3c['setStateAsync'](_0xb83085(0x12d),{'val':_0xb83085(0x120),'ack':!![]});const _0x252f8e='â³\x20ACHTUNG:\x20UngewÃ¶hnlich\x20lange\x20InaktivitÃ¤t\x20in\x20'+currentMonitoredRoom+_0xb83085(0x10b);_0x312d3c['log']['warn'](_0xb83085(0x127)+_0x252f8e),await setup[_0xb83085(0x114)](_0x312d3c,_0xb83085(0x11a)+_0x252f8e),activeTimer=setTimeout(()=>triggerAlarm(_0x312d3c),0x5*0x3c*0x3e8);}async function triggerAlarm(_0x4676df){const _0x49ff67=a2_0x157e07;alarmStage=0x2,await _0x4676df[_0x49ff67(0x10a)]('analysis.safety.deadMan.alarmState',{'val':_0x49ff67(0x133),'ack':!![]});const _0x13296b=_0x49ff67(0x109)+currentMonitoredRoom+'!';_0x4676df[_0x49ff67(0x132)]['error']('[DeadMan]\x20'+_0x13296b),await setup['sendNotification'](_0x4676df,_0x13296b,![],!![]);}module['exports']={'updateLocation':updateLocation};