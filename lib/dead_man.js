const a2_0x552eda=a2_0x1adb;(function(_0x17cd23,_0x256c04){const _0x30b1f9=a2_0x1adb,_0x5868b2=_0x17cd23();while(!![]){try{const _0x3c3ede=-parseInt(_0x30b1f9(0xf8))/0x1*(parseInt(_0x30b1f9(0xf0))/0x2)+parseInt(_0x30b1f9(0xef))/0x3+parseInt(_0x30b1f9(0xe6))/0x4*(-parseInt(_0x30b1f9(0x10a))/0x5)+parseInt(_0x30b1f9(0x109))/0x6+-parseInt(_0x30b1f9(0x10b))/0x7*(-parseInt(_0x30b1f9(0x119))/0x8)+-parseInt(_0x30b1f9(0xf9))/0x9*(-parseInt(_0x30b1f9(0xe3))/0xa)+-parseInt(_0x30b1f9(0x103))/0xb;if(_0x3c3ede===_0x256c04)break;else _0x5868b2['push'](_0x5868b2['shift']());}catch(_0x36e4f9){_0x5868b2['push'](_0x5868b2['shift']());}}}(a2_0x126b,0x608a8));function a2_0x1adb(_0x56ed4b,_0x359f59){const _0x4a9924=a2_0x126b();return a2_0x1adb=function(_0x59a023,_0x1d3079){_0x59a023=_0x59a023-0xe0;let _0x126b59=_0x4a9924[_0x59a023];return _0x126b59;},a2_0x1adb(_0x56ed4b,_0x359f59);}const a2_0x1d3079=(function(){let _0x2dc671=!![];return function(_0x467114,_0x3340c6){const _0x45d876=_0x2dc671?function(){if(_0x3340c6){const _0x15a25d=_0x3340c6['apply'](_0x467114,arguments);return _0x3340c6=null,_0x15a25d;}}:function(){};return _0x2dc671=![],_0x45d876;};}()),a2_0x59a023=a2_0x1d3079(this,function(){const _0x522b36=a2_0x1adb;return a2_0x59a023['toString']()[_0x522b36(0x108)](_0x522b36(0x10e))['toString']()['constructor'](a2_0x59a023)[_0x522b36(0x108)](_0x522b36(0x10e));});a2_0x59a023();'use strict';const setup=require(a2_0x552eda(0x11b));let activeTimer=null,currentMonitoredRoom=null,timeoutMs=0x0,startTime=0x0,alarmStage=0x0;const DEFAULT_TIMEOUTS={'bad':0x2d,'bath':0x2d,'toilet':0x1e,'wc':0x1e,'keller':0x3c,'schlaf':0x78,'bed':0x78,'guest':0x5a,'gast':0x5a};function getTimeoutRobust(_0x52b73f,_0x442928){const _0x2062d8=a2_0x552eda;if(!_0x52b73f||!_0x442928)return undefined;if(_0x52b73f[_0x442928])return _0x52b73f[_0x442928];const _0x59d8f9=_0x442928[_0x2062d8(0xe1)]()[_0x2062d8(0x10d)](/[^a-z0-9]/g,'');for(const _0x3eba4d in _0x52b73f){const _0x442d74=_0x3eba4d[_0x2062d8(0xe1)]()[_0x2062d8(0x10d)](/[^a-z0-9]/g,'');if(_0x442d74===_0x59d8f9)return _0x52b73f[_0x3eba4d];}const _0x5eaa9c=_0x442928[_0x2062d8(0xe1)]();if(_0x52b73f[_0x5eaa9c])return _0x52b73f[_0x5eaa9c];return undefined;}async function loadConfig(_0x1b567a){const _0x474b3f=a2_0x552eda;try{const _0x44b038=await _0x1b567a[_0x474b3f(0xf3)]('analysis.safety.deadMan.config');if(_0x44b038&&_0x44b038['val'])return JSON[_0x474b3f(0xf1)](_0x44b038[_0x474b3f(0x112)]);}catch(_0x500dfd){}return{};}async function isActive(_0x12faf8){const _0x4d0793=a2_0x552eda;try{const _0xdb287a=await _0x12faf8['getStateAsync'](_0x4d0793(0x11a));return _0xdb287a&&_0xdb287a['val'];}catch(_0x2b41ce){return![];}}async function areRoomsConnected(_0x3ac421,_0x4541df,_0x54da5a){const _0x3c7dd3=a2_0x552eda;try{const _0x3bdc65=await _0x3ac421[_0x3c7dd3(0xf3)](_0x3c7dd3(0xe8));if(!_0x3bdc65||!_0x3bdc65[_0x3c7dd3(0x112)])return!![];const _0x286237=JSON['parse'](_0x3bdc65[_0x3c7dd3(0x112)]),{rooms:_0xdd612,matrix:_0x685b38}=_0x286237;if(!_0xdd612||!_0x685b38)return!![];const _0xa678c4=_0xdd612['indexOf'](_0x4541df),_0x478246=_0xdd612[_0x3c7dd3(0x111)](_0x54da5a);if(_0xa678c4===-0x1||_0x478246===-0x1)return!![];const _0x513f94=_0x685b38[_0xa678c4][_0x478246]>0x0||_0x685b38[_0x478246][_0xa678c4]>0x0;return _0x513f94;}catch(_0x66a8ae){return _0x3ac421[_0x3c7dd3(0xed)][_0x3c7dd3(0xf2)](_0x3c7dd3(0x100)+_0x66a8ae[_0x3c7dd3(0xfe)]),!![];}}function calculateSleepProbability(_0x4d7149){const _0x59d1b7=a2_0x552eda,_0x15bee3=new Date(),_0x419ece=_0x15bee3[_0x59d1b7(0xe2)](),_0x568d2c=_0x4d7149[_0x59d1b7(0xe1)]();let _0x3ba9ce=0.1;if(_0x419ece>=0x17||_0x419ece<=0x6)_0x3ba9ce=0x1;else{if(_0x419ece>=0xd&&_0x419ece<=0xf)_0x3ba9ce=0.8;else{if(_0x419ece>=0x14&&_0x419ece<=0x17)_0x3ba9ce=0.4;}}let _0x289121=0.1;if(_0x568d2c[_0x59d1b7(0xfd)](_0x59d1b7(0x102))||_0x568d2c[_0x59d1b7(0xfd)](_0x59d1b7(0xfc)))_0x289121=0x1;else{if(_0x568d2c[_0x59d1b7(0xfd)](_0x59d1b7(0xe0))||_0x568d2c[_0x59d1b7(0xfd)](_0x59d1b7(0x10f))||_0x568d2c[_0x59d1b7(0xfd)](_0x59d1b7(0xe9)))_0x289121=0.6;else{if(_0x568d2c[_0x59d1b7(0xfd)](_0x59d1b7(0x113))||_0x568d2c[_0x59d1b7(0xfd)]('wc'))_0x289121=0.05;}}let _0x1d2653=0.5;const _0x31b0e3=_0x289121*0.5+_0x3ba9ce*0.3+_0x1d2653*0.2;return parseFloat(_0x31b0e3[_0x59d1b7(0xeb)](0x2));}async function updateLocation(_0x26ac14,_0xd1dc18){const _0x782d4=a2_0x552eda;if(!_0xd1dc18||_0xd1dc18===_0x782d4(0x11c))return;if(!await isActive(_0x26ac14)){resetTimer(_0x26ac14);return;}if(currentMonitoredRoom&&currentMonitoredRoom!==_0xd1dc18){const _0x5eaee8=await areRoomsConnected(_0x26ac14,currentMonitoredRoom,_0xd1dc18);if(!_0x5eaee8){const _0x422f78=_0x782d4(0xf4)+_0xd1dc18+'\x27.\x20Nicht\x20verbunden\x20mit\x20Ã¼berwachtem\x20\x27'+currentMonitoredRoom+'\x27.';_0x26ac14[_0x782d4(0xed)][_0x782d4(0xea)](_0x782d4(0x105)+_0x422f78+_0x782d4(0xe7)),await _0x26ac14['setStateAsync']('analysis.safety.deadMan.lastIgnored',{'val':JSON[_0x782d4(0x107)]({'room':_0xd1dc18,'reason':_0x422f78,'timestamp':Date[_0x782d4(0x116)]()}),'ack':!![]});return;}resetTimer(_0x26ac14);}if(!currentMonitoredRoom){await _0x26ac14['setStateAsync'](_0x782d4(0x115),{'val':_0xd1dc18,'ack':!![]});const _0x5ef29f=await loadConfig(_0x26ac14);let _0x2da30f=getTimeoutRobust(_0x5ef29f,_0xd1dc18);const _0x317b8d=_0xd1dc18['toLowerCase']();if(!_0x2da30f)for(const _0x14effb in DEFAULT_TIMEOUTS){if(_0x317b8d[_0x782d4(0xfd)](_0x14effb)){_0x2da30f=DEFAULT_TIMEOUTS[_0x14effb];break;}}if(!_0x2da30f&&_0x5ef29f['default'])_0x2da30f=_0x5ef29f[_0x782d4(0xf7)];if(!_0x2da30f)return;currentMonitoredRoom=_0xd1dc18,startTimer(_0x26ac14,_0x2da30f,_0xd1dc18);}}function a2_0x126b(){const _0x6a582c=['log','\x20um\x2090\x20Min.','548175tluouv','289774IYapUf','parse','warn','getStateAsync','Ignoriere\x20Bewegung\x20in\x20\x27','alarm','â³\x20ACHTUNG:\x20UngewÃ¶hnlich\x20lange\x20InaktivitÃ¤t\x20in\x20','default','2dgPBdY','1242NzHxZN','analysis.safety.deadMan.napProbability','\x20fÃ¼r\x20','bed','includes','message','.\x20Alles\x20in\x20Ordnung?','[DeadMan]\x20Topology\x20check\x20failed:\x20','ðŸ’¤\x20Smart\x20Sleep\x20erkannt\x20(','schlaf','5558839qBfZEC','setStateAsync','[DeadMan]\x20','%).\x20VerlÃ¤ngere\x20Timer\x20fÃ¼r\x20','stringify','search','3961104pTLoch','25DMASMJ','413jSNiKt','\x20Min.','replace','(((.+)+)+)+$','living','ðŸš¨\x20NOTFALL-ALARM:\x20Person\x20reagiert\x20nicht\x20in\x20','indexOf','val','bad','exports','analysis.safety.deadMan.currentRoom','now','analysis.safety.deadMan.smartSleep','pre_warn','65496tJgxdZ','analysis.safety.deadMan.active','./setup','Unknown','wohn','toLowerCase','getHours','36460fYSMXR','ðŸ‘¼\x20Schutzengel-Frage:\x20','analysis.safety.deadMan.alarmState','510828SPCGuv','\x20(Multi-Person\x20Filter)','analysis.topology.structure','sofa','info','toFixed','sendNotification'];a2_0x126b=function(){return _0x6a582c;};return a2_0x126b();}function startTimer(_0x3a9f04,_0x179e4c,_0x33df8b){const _0x2b7f02=a2_0x552eda;if(activeTimer)clearTimeout(activeTimer);timeoutMs=_0x179e4c*0x3c*0x3e8,startTime=Date['now'](),alarmStage=0x0;const _0x1772e1=calculateSleepProbability(_0x33df8b||currentMonitoredRoom),_0x16c9d5=_0x1772e1>0.65;_0x16c9d5?(timeoutMs+=0x5a*0x3c*0x3e8,_0x3a9f04[_0x2b7f02(0xed)][_0x2b7f02(0xea)](_0x2b7f02(0x101)+(_0x1772e1*0x64)[_0x2b7f02(0xeb)](0x0)+_0x2b7f02(0x106)+currentMonitoredRoom+_0x2b7f02(0xee)),_0x3a9f04[_0x2b7f02(0x104)](_0x2b7f02(0x117),{'val':!![],'ack':!![]})):_0x3a9f04[_0x2b7f02(0x104)](_0x2b7f02(0x117),{'val':![],'ack':!![]}),_0x3a9f04[_0x2b7f02(0x104)](_0x2b7f02(0xfa),{'val':_0x1772e1,'ack':!![]}),_0x3a9f04[_0x2b7f02(0xed)][_0x2b7f02(0xea)]('ðŸ‘¼\x20Schutzengel:\x20Ãœberwache\x20'+currentMonitoredRoom+_0x2b7f02(0xfb)+_0x179e4c+_0x2b7f02(0x10c)),_0x3a9f04['setStateAsync'](_0x2b7f02(0xe5),{'val':'ok','ack':!![]}),activeTimer=setTimeout(()=>triggerPreWarn(_0x3a9f04),timeoutMs);}function resetTimer(_0x4130d9){const _0x369517=a2_0x552eda;if(activeTimer)clearTimeout(activeTimer);activeTimer=null,currentMonitoredRoom=null,alarmStage=0x0,_0x4130d9[_0x369517(0x104)](_0x369517(0xe5),{'val':'ok','ack':!![]}),_0x4130d9[_0x369517(0x104)](_0x369517(0x117),{'val':![],'ack':!![]}),_0x4130d9[_0x369517(0x104)](_0x369517(0xfa),{'val':0x0,'ack':!![]});}async function triggerPreWarn(_0x2bffff){const _0x49c25e=a2_0x552eda;alarmStage=0x1,await _0x2bffff['setStateAsync'](_0x49c25e(0xe5),{'val':_0x49c25e(0x118),'ack':!![]});const _0x5e3f53=_0x49c25e(0xf6)+currentMonitoredRoom+_0x49c25e(0xff);_0x2bffff[_0x49c25e(0xed)]['warn'](_0x49c25e(0x105)+_0x5e3f53),await setup[_0x49c25e(0xec)](_0x2bffff,_0x49c25e(0xe4)+_0x5e3f53),activeTimer=setTimeout(()=>triggerAlarm(_0x2bffff),0x5*0x3c*0x3e8);}async function triggerAlarm(_0x5bf51c){const _0xbc5362=a2_0x552eda;alarmStage=0x2,await _0x5bf51c[_0xbc5362(0x104)](_0xbc5362(0xe5),{'val':_0xbc5362(0xf5),'ack':!![]});const _0x5360e8=_0xbc5362(0x110)+currentMonitoredRoom+'!';_0x5bf51c['log']['error'](_0xbc5362(0x105)+_0x5360e8),await setup[_0xbc5362(0xec)](_0x5bf51c,_0x5360e8,![],!![]);}module[a2_0x552eda(0x114)]={'updateLocation':updateLocation};