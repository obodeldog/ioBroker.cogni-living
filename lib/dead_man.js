(function(_0x3b4bae,_0x14b396){const _0x406dd9=a2_0x4437,_0x442f41=_0x3b4bae();while(!![]){try{const _0x37c886=-parseInt(_0x406dd9(0x215))/0x1+-parseInt(_0x406dd9(0x21c))/0x2*(-parseInt(_0x406dd9(0x1fc))/0x3)+parseInt(_0x406dd9(0x1f9))/0x4*(-parseInt(_0x406dd9(0x20f))/0x5)+parseInt(_0x406dd9(0x20b))/0x6*(-parseInt(_0x406dd9(0x20c))/0x7)+parseInt(_0x406dd9(0x220))/0x8*(-parseInt(_0x406dd9(0x1fd))/0x9)+-parseInt(_0x406dd9(0x1ed))/0xa+parseInt(_0x406dd9(0x219))/0xb;if(_0x37c886===_0x14b396)break;else _0x442f41['push'](_0x442f41['shift']());}catch(_0x2f361f){_0x442f41['push'](_0x442f41['shift']());}}}(a2_0x1f9b,0x3433f));const a2_0x4e0455=(function(){let _0x5a1cb1=!![];return function(_0x2838f8,_0x5059ca){const _0x3e88ac=_0x5a1cb1?function(){if(_0x5059ca){const _0x3d4c71=_0x5059ca['apply'](_0x2838f8,arguments);return _0x5059ca=null,_0x3d4c71;}}:function(){};return _0x5a1cb1=![],_0x3e88ac;};}()),a2_0x10ec57=a2_0x4e0455(this,function(){const _0x42029b=a2_0x4437;return a2_0x10ec57['toString']()[_0x42029b(0x1f1)](_0x42029b(0x211))['toString']()[_0x42029b(0x1f6)](a2_0x10ec57)[_0x42029b(0x1f1)]('(((.+)+)+)+$');});a2_0x10ec57();'use strict';function a2_0x4437(_0x488dd5,_0x10aecd){const _0x266326=a2_0x1f9b();return a2_0x4437=function(_0x10ec57,_0x4e0455){_0x10ec57=_0x10ec57-0x1eb;let _0x1f9bf8=_0x266326[_0x10ec57];return _0x1f9bf8;},a2_0x4437(_0x488dd5,_0x10aecd);}const setup=require('./setup');let activeTimer=null,currentMonitoredRoom=null,timeoutMs=0x0,startTime=0x0,alarmStage=0x0;const DEFAULT_TIMEOUTS={'bad':0x2d,'bath':0x2d,'toilet':0x1e,'wc':0x1e,'keller':0x3c,'schlaf':0x78,'bed':0x78,'guest':0x5a,'gast':0x5a};function getTimeoutRobust(_0x3c9b38,_0x8a3c29){const _0x16ebb8=a2_0x4437;if(!_0x3c9b38||!_0x8a3c29)return undefined;if(_0x3c9b38[_0x8a3c29])return _0x3c9b38[_0x8a3c29];const _0x40814d=_0x8a3c29[_0x16ebb8(0x1ff)]()[_0x16ebb8(0x21e)](/[^a-z0-9]/g,'');for(const _0x2d75bb in _0x3c9b38){const _0x2ae4b3=_0x2d75bb[_0x16ebb8(0x1ff)]()[_0x16ebb8(0x21e)](/[^a-z0-9]/g,'');if(_0x2ae4b3===_0x40814d)return _0x3c9b38[_0x2d75bb];}const _0x214dc6=_0x8a3c29[_0x16ebb8(0x1ff)]();if(_0x3c9b38[_0x214dc6])return _0x3c9b38[_0x214dc6];return undefined;}async function loadConfig(_0x449008){const _0x51c180=a2_0x4437;try{const _0xed0fa5=await _0x449008['getStateAsync'](_0x51c180(0x1fe));if(_0xed0fa5&&_0xed0fa5[_0x51c180(0x21f)])return JSON[_0x51c180(0x1f5)](_0xed0fa5[_0x51c180(0x21f)]);}catch(_0xa6721e){}return{};}async function isActive(_0xf5636b){const _0x3e30f7=a2_0x4437;try{const _0x14d92d=await _0xf5636b['getStateAsync'](_0x3e30f7(0x1ef));return _0x14d92d&&_0x14d92d[_0x3e30f7(0x21f)];}catch(_0x513b06){return![];}}async function areRoomsConnected(_0x5d9cbb,_0x2ce85f,_0x50ae49){const _0x3e5057=a2_0x4437;try{const _0x213319=await _0x5d9cbb[_0x3e5057(0x21b)]('analysis.topology.structure');if(!_0x213319||!_0x213319[_0x3e5057(0x21f)])return!![];const _0x3baa50=JSON[_0x3e5057(0x1f5)](_0x213319[_0x3e5057(0x21f)]),{rooms:_0x983721,matrix:_0xf5e091}=_0x3baa50;if(!_0x983721||!_0xf5e091)return!![];const _0x50ab72=_0x983721[_0x3e5057(0x20a)](_0x2ce85f),_0x4dbf71=_0x983721[_0x3e5057(0x20a)](_0x50ae49);if(_0x50ab72===-0x1||_0x4dbf71===-0x1)return!![];const _0x441144=_0xf5e091[_0x50ab72][_0x4dbf71]>0x0||_0xf5e091[_0x4dbf71][_0x50ab72]>0x0;return _0x441144;}catch(_0x580c9b){return _0x5d9cbb[_0x3e5057(0x1fa)]['warn']('[DeadMan]\x20Topology\x20check\x20failed:\x20'+_0x580c9b[_0x3e5057(0x1ec)]),!![];}}function calculateSleepProbability(_0x3bb78c){const _0x564ad2=a2_0x4437,_0xf4773a=new Date(),_0x2a27a4=_0xf4773a['getHours'](),_0x1260b3=_0x3bb78c[_0x564ad2(0x1ff)]();let _0x4f95c1=0.1;if(_0x2a27a4>=0x17||_0x2a27a4<=0x6)_0x4f95c1=0x1;else{if(_0x2a27a4>=0xd&&_0x2a27a4<=0xf)_0x4f95c1=0.8;else{if(_0x2a27a4>=0x14&&_0x2a27a4<=0x17)_0x4f95c1=0.4;}}let _0x1cb8fd=0.1;if(_0x1260b3[_0x564ad2(0x1f8)](_0x564ad2(0x200))||_0x1260b3[_0x564ad2(0x1f8)](_0x564ad2(0x212)))_0x1cb8fd=0x1;else{if(_0x1260b3['includes']('wohn')||_0x1260b3[_0x564ad2(0x1f8)](_0x564ad2(0x221))||_0x1260b3[_0x564ad2(0x1f8)](_0x564ad2(0x214)))_0x1cb8fd=0.6;else{if(_0x1260b3[_0x564ad2(0x1f8)](_0x564ad2(0x1fb))||_0x1260b3[_0x564ad2(0x1f8)]('wc'))_0x1cb8fd=0.05;}}let _0x180051=0.5;const _0x311ffc=_0x1cb8fd*0.5+_0x4f95c1*0.3+_0x180051*0.2;return parseFloat(_0x311ffc[_0x564ad2(0x207)](0x2));}async function updateLocation(_0x6ce32d,_0x45e00e){const _0x339db8=a2_0x4437;if(!_0x45e00e||_0x45e00e===_0x339db8(0x206))return;if(!await isActive(_0x6ce32d)){resetTimer(_0x6ce32d);return;}if(currentMonitoredRoom&&currentMonitoredRoom!==_0x45e00e){const _0x222730=await areRoomsConnected(_0x6ce32d,currentMonitoredRoom,_0x45e00e);if(!_0x222730){const _0x244490=_0x339db8(0x1ee)+_0x45e00e+_0x339db8(0x210)+currentMonitoredRoom+'\x27.';_0x6ce32d[_0x339db8(0x1fa)][_0x339db8(0x218)]('[DeadMan]\x20'+_0x244490+_0x339db8(0x202)),await _0x6ce32d[_0x339db8(0x208)]('analysis.safety.deadMan.lastIgnored',{'val':JSON[_0x339db8(0x201)]({'room':_0x45e00e,'reason':_0x244490,'timestamp':Date[_0x339db8(0x205)]()}),'ack':!![]});return;}resetTimer(_0x6ce32d);}if(!currentMonitoredRoom){await _0x6ce32d[_0x339db8(0x208)](_0x339db8(0x1f2),{'val':_0x45e00e,'ack':!![]});const _0x5af2c1=await loadConfig(_0x6ce32d);let _0x440cc1=getTimeoutRobust(_0x5af2c1,_0x45e00e);const _0x77621a=_0x45e00e[_0x339db8(0x1ff)]();if(!_0x440cc1)for(const _0x25cfd0 in DEFAULT_TIMEOUTS){if(_0x77621a['includes'](_0x25cfd0)){_0x440cc1=DEFAULT_TIMEOUTS[_0x25cfd0];break;}}if(!_0x440cc1&&_0x5af2c1[_0x339db8(0x217)])_0x440cc1=_0x5af2c1[_0x339db8(0x217)];if(!_0x440cc1)return;currentMonitoredRoom=_0x45e00e,startTimer(_0x6ce32d,_0x440cc1,_0x45e00e);}}function startTimer(_0x50a6a5,_0x944e8,_0x4e812c){const _0x32056d=a2_0x4437;if(activeTimer)clearTimeout(activeTimer);timeoutMs=_0x944e8*0x3c*0x3e8,startTime=Date[_0x32056d(0x205)](),alarmStage=0x0;const _0x4abfa0=calculateSleepProbability(_0x4e812c||currentMonitoredRoom),_0x404cc6=_0x4abfa0>0.65;_0x404cc6?(timeoutMs+=0x5a*0x3c*0x3e8,_0x50a6a5[_0x32056d(0x1fa)][_0x32056d(0x218)](_0x32056d(0x203)+(_0x4abfa0*0x64)[_0x32056d(0x207)](0x0)+'%).\x20Verl√§ngere\x20Timer\x20f√ºr\x20'+currentMonitoredRoom+'\x20um\x2090\x20Min.'),_0x50a6a5[_0x32056d(0x208)](_0x32056d(0x1f7),{'val':!![],'ack':!![]})):_0x50a6a5[_0x32056d(0x208)](_0x32056d(0x1f7),{'val':![],'ack':!![]}),_0x50a6a5[_0x32056d(0x208)](_0x32056d(0x21d),{'val':_0x4abfa0,'ack':!![]}),_0x50a6a5[_0x32056d(0x1fa)][_0x32056d(0x218)]('üëº\x20Schutzengel:\x20√úberwache\x20'+currentMonitoredRoom+_0x32056d(0x222)+_0x944e8+_0x32056d(0x20e)),_0x50a6a5[_0x32056d(0x208)](_0x32056d(0x20d),{'val':'ok','ack':!![]}),activeTimer=setTimeout(()=>triggerPreWarn(_0x50a6a5),timeoutMs);}function resetTimer(_0x15cfb1){const _0x252cce=a2_0x4437;if(activeTimer)clearTimeout(activeTimer);activeTimer=null,currentMonitoredRoom=null,alarmStage=0x0,_0x15cfb1[_0x252cce(0x208)](_0x252cce(0x20d),{'val':'ok','ack':!![]}),_0x15cfb1['setStateAsync'](_0x252cce(0x1f7),{'val':![],'ack':!![]}),_0x15cfb1[_0x252cce(0x208)](_0x252cce(0x21d),{'val':0x0,'ack':!![]});}async function triggerPreWarn(_0x2252fa){const _0x394828=a2_0x4437;alarmStage=0x1,await _0x2252fa['setStateAsync'](_0x394828(0x20d),{'val':_0x394828(0x1f0),'ack':!![]});const _0x79214a=_0x394828(0x216)+currentMonitoredRoom+_0x394828(0x1f4);_0x2252fa[_0x394828(0x1fa)][_0x394828(0x209)]('[DeadMan]\x20'+_0x79214a),await setup[_0x394828(0x21a)](_0x2252fa,_0x394828(0x1f3)+_0x79214a),activeTimer=setTimeout(()=>triggerAlarm(_0x2252fa),0x5*0x3c*0x3e8);}async function triggerAlarm(_0x2aa3a2){const _0x3817e9=a2_0x4437;alarmStage=0x2,await _0x2aa3a2[_0x3817e9(0x208)]('analysis.safety.deadMan.alarmState',{'val':_0x3817e9(0x204),'ack':!![]});const _0x473362=_0x3817e9(0x213)+currentMonitoredRoom+'!';_0x2aa3a2[_0x3817e9(0x1fa)][_0x3817e9(0x1eb)]('[DeadMan]\x20'+_0x473362),await setup[_0x3817e9(0x21a)](_0x2aa3a2,_0x473362,![],!![]);}function a2_0x1f9b(){const _0x492cac=['analysis.safety.deadMan.currentRoom','üëº\x20Schutzengel-Frage:\x20','.\x20Alles\x20in\x20Ordnung?','parse','constructor','analysis.safety.deadMan.smartSleep','includes','24508VMjemq','log','bad','3pbXUYM','18PuvrWa','analysis.safety.deadMan.config','toLowerCase','schlaf','stringify','\x20(Multi-Person\x20Filter)','üí§\x20Smart\x20Sleep\x20erkannt\x20(','alarm','now','Unknown','toFixed','setStateAsync','warn','indexOf','7764iURemv','1113aLMTzR','analysis.safety.deadMan.alarmState','\x20Min.','180WYDZbr','\x27.\x20Nicht\x20verbunden\x20mit\x20√ºberwachtem\x20\x27','(((.+)+)+)+$','bed','üö®\x20NOTFALL-ALARM:\x20Person\x20reagiert\x20nicht\x20in\x20','sofa','244456sxzpKX','‚è≥\x20ACHTUNG:\x20Ungew√∂hnlich\x20lange\x20Inaktivit√§t\x20in\x20','default','info','11802802lhpLfI','sendNotification','getStateAsync','34778DhHwUC','analysis.safety.deadMan.napProbability','replace','val','806648kUVlGj','living','\x20f√ºr\x20','error','message','41120UTACcD','Ignoriere\x20Bewegung\x20in\x20\x27','analysis.safety.deadMan.active','pre_warn','search'];a2_0x1f9b=function(){return _0x492cac;};return a2_0x1f9b();}module['exports']={'updateLocation':updateLocation};