const a2_0x2dc76d=a2_0x1862;(function(_0x130e92,_0x504cce){const _0x5220bc=a2_0x1862,_0x1c3388=_0x130e92();while(!![]){try{const _0x3d6142=-parseInt(_0x5220bc(0xd1))/0x1+parseInt(_0x5220bc(0xfe))/0x2+parseInt(_0x5220bc(0xcf))/0x3*(-parseInt(_0x5220bc(0xf9))/0x4)+-parseInt(_0x5220bc(0xe8))/0x5*(-parseInt(_0x5220bc(0xd4))/0x6)+-parseInt(_0x5220bc(0xdf))/0x7+-parseInt(_0x5220bc(0xe4))/0x8+parseInt(_0x5220bc(0xd5))/0x9*(parseInt(_0x5220bc(0xcb))/0xa);if(_0x3d6142===_0x504cce)break;else _0x1c3388['push'](_0x1c3388['shift']());}catch(_0x282320){_0x1c3388['push'](_0x1c3388['shift']());}}}(a2_0x390e,0xd3c52));const a2_0x4e1e70=(function(){let _0x484cba=!![];return function(_0x2b4a25,_0x137c45){const _0x52d36b=_0x484cba?function(){const _0x2d963c=a2_0x1862;if(_0x137c45){const _0x5ac2a8=_0x137c45[_0x2d963c(0xf8)](_0x2b4a25,arguments);return _0x137c45=null,_0x5ac2a8;}}:function(){};return _0x484cba=![],_0x52d36b;};}()),a2_0x2d5b64=a2_0x4e1e70(this,function(){const _0x45011f=a2_0x1862;return a2_0x2d5b64[_0x45011f(0xe0)]()[_0x45011f(0xf0)](_0x45011f(0xe5))[_0x45011f(0xe0)]()[_0x45011f(0xd3)](a2_0x2d5b64)[_0x45011f(0xf0)]('(((.+)+)+)+$');});a2_0x2d5b64();'use strict';function a2_0x390e(){const _0x58970a=['message','1057752EkkTRh','analysis.safety.deadMan.smartSleep','living','toFixed','\x20(Multi-Person\x20Filter)','val','Unknown','log','setStateAsync','parse','\x27.\x20Nicht\x20verbunden\x20mit\x20Ã¼berwachtem\x20\x27','analysis.safety.deadMan.currentRoom','34335410YAkZCq','analysis.safety.deadMan.config','%).\x20VerlÃ¤ngere\x20Timer\x20fÃ¼r\x20','analysis.safety.deadMan.alarmState','4110066GoTYvJ','now','1638849NHNnSE','getStateAsync','constructor','6rdUluR','9SeCgYa','â³\x20ACHTUNG:\x20UngewÃ¶hnlich\x20lange\x20InaktivitÃ¤t\x20in\x20','analysis.safety.deadMan.napProbability','\x20fÃ¼r\x20','analysis.topology.structure','wohn','ðŸ’¤\x20Smart\x20Sleep\x20erkannt\x20(','exports','info','[DeadMan]\x20Topology\x20check\x20failed:\x20','1255366jxzfic','toString','analysis.safety.deadMan.active','includes','ðŸš¨\x20NOTFALL-ALARM:\x20Person\x20reagiert\x20nicht\x20in\x20','4633176VBrbZb','(((.+)+)+)+$','stringify','\x20Min.','3361745pIxxfG','ðŸ‘¼\x20Schutzengel-Frage:\x20','Ignoriere\x20Bewegung\x20in\x20\x27','bad','.\x20Alles\x20in\x20Ordnung?','./setup','getHours','[DeadMan]\x20','search','default','\x20um\x2090\x20Min.','sofa','warn','indexOf','analysis.safety.deadMan.lastIgnored','sendNotification','apply','4UWvPXW','ðŸ‘¼\x20Schutzengel:\x20Ãœberwache\x20','alarm','toLowerCase'];a2_0x390e=function(){return _0x58970a;};return a2_0x390e();}const setup=require(a2_0x2dc76d(0xed));function a2_0x1862(_0x154888,_0x19940d){const _0x3d8b59=a2_0x390e();return a2_0x1862=function(_0x2d5b64,_0x4e1e70){_0x2d5b64=_0x2d5b64-0xc1;let _0x390e36=_0x3d8b59[_0x2d5b64];return _0x390e36;},a2_0x1862(_0x154888,_0x19940d);}let activeTimer=null,currentMonitoredRoom=null,timeoutMs=0x0,startTime=0x0,alarmStage=0x0;const DEFAULT_TIMEOUTS={'bad':0x2d,'bath':0x2d,'toilet':0x1e,'wc':0x1e,'keller':0x3c,'schlaf':0x78,'bed':0x78,'guest':0x5a,'gast':0x5a};async function loadConfig(_0x3769c0){const _0x57c9f1=a2_0x2dc76d;try{const _0x39cb73=await _0x3769c0['getStateAsync'](_0x57c9f1(0xcc));if(_0x39cb73&&_0x39cb73[_0x57c9f1(0xc4)])return JSON['parse'](_0x39cb73['val']);}catch(_0x5d996b){}return{};}async function isActive(_0x314381){const _0x46c5aa=a2_0x2dc76d;try{const _0x217aa3=await _0x314381['getStateAsync'](_0x46c5aa(0xe1));return _0x217aa3&&_0x217aa3['val'];}catch(_0x3f9809){return![];}}async function areRoomsConnected(_0x53fa51,_0x3ac240,_0x2e3af3){const _0x1bfc50=a2_0x2dc76d;try{const _0x6e26b5=await _0x53fa51[_0x1bfc50(0xd2)](_0x1bfc50(0xd9));if(!_0x6e26b5||!_0x6e26b5[_0x1bfc50(0xc4)])return!![];const _0x28e338=JSON[_0x1bfc50(0xc8)](_0x6e26b5[_0x1bfc50(0xc4)]),{rooms:_0xa9d1f4,matrix:_0x305434}=_0x28e338;if(!_0xa9d1f4||!_0x305434)return!![];const _0x16423a=_0xa9d1f4['indexOf'](_0x3ac240),_0x3a2bae=_0xa9d1f4[_0x1bfc50(0xf5)](_0x2e3af3);if(_0x16423a===-0x1||_0x3a2bae===-0x1)return!![];const _0x5d67c9=_0x305434[_0x16423a][_0x3a2bae]>0x0||_0x305434[_0x3a2bae][_0x16423a]>0x0;return _0x5d67c9;}catch(_0x12ace7){return _0x53fa51['log'][_0x1bfc50(0xf4)](_0x1bfc50(0xde)+_0x12ace7[_0x1bfc50(0xfd)]),!![];}}function calculateSleepProbability(_0x3f8a00){const _0x220aea=a2_0x2dc76d,_0x45a15a=new Date(),_0x420741=_0x45a15a[_0x220aea(0xee)](),_0x54fff3=_0x3f8a00[_0x220aea(0xfc)]();let _0x40d611=0.1;if(_0x420741>=0x17||_0x420741<=0x6)_0x40d611=0x1;else{if(_0x420741>=0xd&&_0x420741<=0xf)_0x40d611=0.8;else{if(_0x420741>=0x14&&_0x420741<=0x17)_0x40d611=0.4;}}let _0x54258a=0.1;if(_0x54fff3[_0x220aea(0xe2)]('schlaf')||_0x54fff3[_0x220aea(0xe2)]('bed'))_0x54258a=0x1;else{if(_0x54fff3['includes'](_0x220aea(0xda))||_0x54fff3['includes'](_0x220aea(0xc1))||_0x54fff3['includes'](_0x220aea(0xf3)))_0x54258a=0.6;else{if(_0x54fff3[_0x220aea(0xe2)](_0x220aea(0xeb))||_0x54fff3[_0x220aea(0xe2)]('wc'))_0x54258a=0.05;}}let _0x20f477=0.5;const _0x462572=_0x54258a*0.5+_0x40d611*0.3+_0x20f477*0.2;return parseFloat(_0x462572[_0x220aea(0xc2)](0x2));}async function updateLocation(_0x431772,_0x380644){const _0xebeb33=a2_0x2dc76d;if(!_0x380644||_0x380644===_0xebeb33(0xc5))return;if(!await isActive(_0x431772)){resetTimer(_0x431772);return;}if(currentMonitoredRoom&&currentMonitoredRoom!==_0x380644){const _0x1718f1=await areRoomsConnected(_0x431772,currentMonitoredRoom,_0x380644);if(!_0x1718f1){const _0x2b6c3a=_0xebeb33(0xea)+_0x380644+_0xebeb33(0xc9)+currentMonitoredRoom+'\x27.';_0x431772['log'][_0xebeb33(0xdd)](_0xebeb33(0xef)+_0x2b6c3a+_0xebeb33(0xc3)),await _0x431772[_0xebeb33(0xc7)](_0xebeb33(0xf6),{'val':JSON[_0xebeb33(0xe6)]({'room':_0x380644,'reason':_0x2b6c3a,'timestamp':Date[_0xebeb33(0xd0)]()}),'ack':!![]});return;}resetTimer(_0x431772);}if(!currentMonitoredRoom){await _0x431772[_0xebeb33(0xc7)](_0xebeb33(0xca),{'val':_0x380644,'ack':!![]});const _0x599837=await loadConfig(_0x431772),_0x213ac7=_0x380644[_0xebeb33(0xfc)]();let _0x469f2d=_0x599837[_0x380644]||_0x599837[_0x213ac7];if(!_0x469f2d)for(const _0x336a88 in DEFAULT_TIMEOUTS){if(_0x213ac7[_0xebeb33(0xe2)](_0x336a88)){_0x469f2d=DEFAULT_TIMEOUTS[_0x336a88];break;}}if(!_0x469f2d&&_0x599837[_0xebeb33(0xf1)])_0x469f2d=_0x599837['default'];if(!_0x469f2d)return;currentMonitoredRoom=_0x380644,startTimer(_0x431772,_0x469f2d,_0x380644);}}function startTimer(_0x3b3056,_0x4a8851,_0x15ebc2){const _0x3dc72b=a2_0x2dc76d;if(activeTimer)clearTimeout(activeTimer);timeoutMs=_0x4a8851*0x3c*0x3e8,startTime=Date[_0x3dc72b(0xd0)](),alarmStage=0x0;const _0x417d76=calculateSleepProbability(_0x15ebc2||currentMonitoredRoom),_0xd91479=_0x417d76>0.65;_0xd91479?(timeoutMs+=0x5a*0x3c*0x3e8,_0x3b3056[_0x3dc72b(0xc6)][_0x3dc72b(0xdd)](_0x3dc72b(0xdb)+(_0x417d76*0x64)[_0x3dc72b(0xc2)](0x0)+_0x3dc72b(0xcd)+currentMonitoredRoom+_0x3dc72b(0xf2)),_0x3b3056[_0x3dc72b(0xc7)](_0x3dc72b(0xff),{'val':!![],'ack':!![]})):_0x3b3056[_0x3dc72b(0xc7)](_0x3dc72b(0xff),{'val':![],'ack':!![]}),_0x3b3056[_0x3dc72b(0xc7)](_0x3dc72b(0xd7),{'val':_0x417d76,'ack':!![]}),_0x3b3056[_0x3dc72b(0xc6)][_0x3dc72b(0xdd)](_0x3dc72b(0xfa)+currentMonitoredRoom+_0x3dc72b(0xd8)+_0x4a8851+_0x3dc72b(0xe7)),_0x3b3056[_0x3dc72b(0xc7)](_0x3dc72b(0xce),{'val':'ok','ack':!![]}),activeTimer=setTimeout(()=>triggerPreWarn(_0x3b3056),timeoutMs);}function resetTimer(_0x72c745){const _0x4ee8f4=a2_0x2dc76d;if(activeTimer)clearTimeout(activeTimer);activeTimer=null,currentMonitoredRoom=null,alarmStage=0x0,_0x72c745[_0x4ee8f4(0xc7)]('analysis.safety.deadMan.alarmState',{'val':'ok','ack':!![]}),_0x72c745[_0x4ee8f4(0xc7)](_0x4ee8f4(0xff),{'val':![],'ack':!![]}),_0x72c745[_0x4ee8f4(0xc7)](_0x4ee8f4(0xd7),{'val':0x0,'ack':!![]});}async function triggerPreWarn(_0x46976b){const _0x2c22e0=a2_0x2dc76d;alarmStage=0x1,await _0x46976b[_0x2c22e0(0xc7)]('analysis.safety.deadMan.alarmState',{'val':'pre_warn','ack':!![]});const _0x4aa012=_0x2c22e0(0xd6)+currentMonitoredRoom+_0x2c22e0(0xec);_0x46976b['log']['warn'](_0x2c22e0(0xef)+_0x4aa012),await setup[_0x2c22e0(0xf7)](_0x46976b,_0x2c22e0(0xe9)+_0x4aa012),activeTimer=setTimeout(()=>triggerAlarm(_0x46976b),0x5*0x3c*0x3e8);}async function triggerAlarm(_0xad0cf5){const _0x3be933=a2_0x2dc76d;alarmStage=0x2,await _0xad0cf5[_0x3be933(0xc7)](_0x3be933(0xce),{'val':_0x3be933(0xfb),'ack':!![]});const _0x250572=_0x3be933(0xe3)+currentMonitoredRoom+'!';_0xad0cf5[_0x3be933(0xc6)]['error'](_0x3be933(0xef)+_0x250572),await setup[_0x3be933(0xf7)](_0xad0cf5,_0x250572,![],!![]);}module[a2_0x2dc76d(0xdc)]={'updateLocation':updateLocation};