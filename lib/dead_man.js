const a2_0x51f10d=a2_0x4cbf;(function(_0x5800c3,_0x507bf6){const _0x404dad=a2_0x4cbf,_0x12b8ab=_0x5800c3();while(!![]){try{const _0x3c292f=parseInt(_0x404dad(0x20b))/0x1+-parseInt(_0x404dad(0x205))/0x2+parseInt(_0x404dad(0x1ee))/0x3*(-parseInt(_0x404dad(0x1f9))/0x4)+parseInt(_0x404dad(0x200))/0x5*(-parseInt(_0x404dad(0x1fc))/0x6)+parseInt(_0x404dad(0x20e))/0x7*(-parseInt(_0x404dad(0x204))/0x8)+-parseInt(_0x404dad(0x1ed))/0x9*(parseInt(_0x404dad(0x1f4))/0xa)+parseInt(_0x404dad(0x1f0))/0xb;if(_0x3c292f===_0x507bf6)break;else _0x12b8ab['push'](_0x12b8ab['shift']());}catch(_0x5dbdb3){_0x12b8ab['push'](_0x12b8ab['shift']());}}}(a2_0x52f8,0xa9192));const a2_0xc495fb=(function(){let _0x55556b=!![];return function(_0x39fc51,_0x2ef498){const _0x54600f=_0x55556b?function(){const _0xdea2f8=a2_0x4cbf;if(_0x2ef498){const _0x1c93b9=_0x2ef498[_0xdea2f8(0x1ef)](_0x39fc51,arguments);return _0x2ef498=null,_0x1c93b9;}}:function(){};return _0x55556b=![],_0x54600f;};}()),a2_0x27d61a=a2_0xc495fb(this,function(){const _0x209e4e=a2_0x4cbf;return a2_0x27d61a['toString']()[_0x209e4e(0x1eb)](_0x209e4e(0x20a))[_0x209e4e(0x20d)]()[_0x209e4e(0x1fd)](a2_0x27d61a)[_0x209e4e(0x1eb)](_0x209e4e(0x20a));});a2_0x27d61a();'use strict';const setup=require('./setup');let activeTimer=null,currentMonitoredRoom=null,timeoutMs=0x0,startTime=0x0,alarmStage=0x0;const DEFAULT_TIMEOUTS={'bad':0x2d,'bath':0x2d,'toilet':0x1e,'wc':0x1e,'keller':0x3c};async function loadConfig(_0x2a2a2f){const _0x5045e0=a2_0x4cbf;try{const _0x564b80=await _0x2a2a2f['getStateAsync'](_0x5045e0(0x209));if(_0x564b80&&_0x564b80[_0x5045e0(0x1ea)])return JSON[_0x5045e0(0x1f3)](_0x564b80[_0x5045e0(0x1ea)]);}catch(_0x312658){}return{};}function a2_0x4cbf(_0x5dfa5c,_0x105bcb){const _0x4fbf3f=a2_0x52f8();return a2_0x4cbf=function(_0x27d61a,_0xc495fb){_0x27d61a=_0x27d61a-0x1ea;let _0x52f896=_0x4fbf3f[_0x27d61a];return _0x52f896;},a2_0x4cbf(_0x5dfa5c,_0x105bcb);}async function isActive(_0x52b7b1){const _0x1b9ac9=a2_0x4cbf;try{const _0x2463d8=await _0x52b7b1[_0x1b9ac9(0x20c)](_0x1b9ac9(0x215));return _0x2463d8&&_0x2463d8[_0x1b9ac9(0x1ea)];}catch(_0x13cf7c){return![];}}function a2_0x52f8(){const _0x56763c=['error','alarm','analysis.safety.deadMan.active','log','pre_warn','ðŸ‘¼\x20Schutzengel-Frage:\x20','val','search','\x20fÃ¼r\x20','23724GqzPvU','9jzfdWB','apply','34673848pvYWKf','[DeadMan]\x20Ignoriere\x20Bewegung\x20in\x20\x27','sendNotification','parse','2080JjQHys','indexOf','[DeadMan]\x20Topology\x20check\x20failed:\x20','ðŸ‘¼\x20Schutzengel:\x20Ãœberwache\x20','includes','475388sAVdxo','exports','analysis.safety.deadMan.currentRoom','672atdaTa','constructor','â³\x20ACHTUNG:\x20UngewÃ¶hnlich\x20lange\x20InaktivitÃ¤t\x20in\x20','analysis.topology.structure','32230aqdwQv','\x27.\x20(Multi-Person\x20Filter)','info','analysis.safety.deadMan.alarmState','1056wmDkyD','1052894oueZkP','message','default','.\x20Alles\x20in\x20Ordnung?','analysis.safety.deadMan.config','(((.+)+)+)+$','756418AapfGE','getStateAsync','toString','56357amzSjo','toLowerCase','[DeadMan]\x20','setStateAsync','ðŸš¨\x20NOTFALL-ALARM:\x20Person\x20reagiert\x20nicht\x20in\x20'];a2_0x52f8=function(){return _0x56763c;};return a2_0x52f8();}async function areRoomsConnected(_0x233430,_0x57d8e1,_0x4e045b){const _0x1cdcac=a2_0x4cbf;try{const _0x45ebd4=await _0x233430['getStateAsync'](_0x1cdcac(0x1ff));if(!_0x45ebd4||!_0x45ebd4[_0x1cdcac(0x1ea)])return!![];const _0x5e6613=JSON[_0x1cdcac(0x1f3)](_0x45ebd4[_0x1cdcac(0x1ea)]),{rooms:_0x4ce994,matrix:_0xabf718}=_0x5e6613;if(!_0x4ce994||!_0xabf718)return!![];const _0x58c40d=_0x4ce994[_0x1cdcac(0x1f5)](_0x57d8e1),_0x1cd15f=_0x4ce994[_0x1cdcac(0x1f5)](_0x4e045b);if(_0x58c40d===-0x1||_0x1cd15f===-0x1)return!![];const _0x51f209=_0xabf718[_0x58c40d][_0x1cd15f]>0x0||_0xabf718[_0x1cd15f][_0x58c40d]>0x0;return _0x51f209;}catch(_0x300bbc){return _0x233430[_0x1cdcac(0x216)]['warn'](_0x1cdcac(0x1f6)+_0x300bbc[_0x1cdcac(0x206)]),!![];}}async function updateLocation(_0x314b1b,_0x379e39){const _0x59bd1c=a2_0x4cbf;if(!_0x379e39||_0x379e39==='Unknown')return;if(!await isActive(_0x314b1b)){resetTimer(_0x314b1b);return;}if(currentMonitoredRoom&&currentMonitoredRoom!==_0x379e39){const _0xbd167e=await areRoomsConnected(_0x314b1b,currentMonitoredRoom,_0x379e39);if(!_0xbd167e){_0x314b1b[_0x59bd1c(0x216)][_0x59bd1c(0x202)](_0x59bd1c(0x1f1)+_0x379e39+'\x27.\x20Nicht\x20verbunden\x20mit\x20Ã¼berwachtem\x20\x27'+currentMonitoredRoom+_0x59bd1c(0x201));return;}resetTimer(_0x314b1b);}if(!currentMonitoredRoom){await _0x314b1b[_0x59bd1c(0x211)](_0x59bd1c(0x1fb),{'val':_0x379e39,'ack':!![]});const _0x46102b=await loadConfig(_0x314b1b),_0x2ad3fe=_0x379e39[_0x59bd1c(0x20f)]();let _0x4131fe=_0x46102b[_0x379e39]||_0x46102b[_0x2ad3fe];if(!_0x4131fe)for(const _0x19fa05 in DEFAULT_TIMEOUTS){if(_0x2ad3fe[_0x59bd1c(0x1f8)](_0x19fa05)){_0x4131fe=DEFAULT_TIMEOUTS[_0x19fa05];break;}}if(!_0x4131fe&&_0x46102b[_0x59bd1c(0x207)])_0x4131fe=_0x46102b[_0x59bd1c(0x207)];if(!_0x4131fe)return;currentMonitoredRoom=_0x379e39,startTimer(_0x314b1b,_0x4131fe);}}function startTimer(_0x28112c,_0x2621a0){const _0xf42d15=a2_0x4cbf;if(activeTimer)clearTimeout(activeTimer);timeoutMs=_0x2621a0*0x3c*0x3e8,startTime=Date['now'](),alarmStage=0x0,_0x28112c[_0xf42d15(0x216)]['info'](_0xf42d15(0x1f7)+currentMonitoredRoom+_0xf42d15(0x1ec)+_0x2621a0+'\x20Min.'),_0x28112c[_0xf42d15(0x211)]('analysis.safety.deadMan.alarmState',{'val':'ok','ack':!![]}),activeTimer=setTimeout(()=>triggerPreWarn(_0x28112c),timeoutMs);}function resetTimer(_0xcc8e06){const _0x4b68bb=a2_0x4cbf;if(activeTimer)clearTimeout(activeTimer);activeTimer=null,currentMonitoredRoom=null,alarmStage=0x0,_0xcc8e06[_0x4b68bb(0x211)](_0x4b68bb(0x203),{'val':'ok','ack':!![]});}async function triggerPreWarn(_0x2c9fdd){const _0x28170f=a2_0x4cbf;alarmStage=0x1,await _0x2c9fdd[_0x28170f(0x211)](_0x28170f(0x203),{'val':_0x28170f(0x217),'ack':!![]});const _0x5b1f32=_0x28170f(0x1fe)+currentMonitoredRoom+_0x28170f(0x208);_0x2c9fdd[_0x28170f(0x216)]['warn'](_0x28170f(0x210)+_0x5b1f32),await setup[_0x28170f(0x1f2)](_0x2c9fdd,_0x28170f(0x218)+_0x5b1f32),activeTimer=setTimeout(()=>triggerAlarm(_0x2c9fdd),0x5*0x3c*0x3e8);}async function triggerAlarm(_0x43e9f8){const _0x36ad68=a2_0x4cbf;alarmStage=0x2,await _0x43e9f8[_0x36ad68(0x211)]('analysis.safety.deadMan.alarmState',{'val':_0x36ad68(0x214),'ack':!![]});const _0xed6fee=_0x36ad68(0x212)+currentMonitoredRoom+'!';_0x43e9f8[_0x36ad68(0x216)][_0x36ad68(0x213)]('[DeadMan]\x20'+_0xed6fee),await setup['sendNotification'](_0x43e9f8,_0xed6fee,![],!![]);}module[a2_0x51f10d(0x1fa)]={'updateLocation':updateLocation};