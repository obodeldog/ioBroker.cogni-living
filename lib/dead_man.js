const a2_0x3ceed9=a2_0x49ea;(function(_0x17688b,_0x1663a8){const _0x3e92a1=a2_0x49ea,_0x59d95f=_0x17688b();while(!![]){try{const _0x5bb530=parseInt(_0x3e92a1(0xf8))/0x1+-parseInt(_0x3e92a1(0x102))/0x2*(-parseInt(_0x3e92a1(0xe1))/0x3)+-parseInt(_0x3e92a1(0xfc))/0x4*(parseInt(_0x3e92a1(0xeb))/0x5)+parseInt(_0x3e92a1(0xde))/0x6+parseInt(_0x3e92a1(0x100))/0x7+-parseInt(_0x3e92a1(0x101))/0x8*(-parseInt(_0x3e92a1(0xfa))/0x9)+-parseInt(_0x3e92a1(0xe7))/0xa;if(_0x5bb530===_0x1663a8)break;else _0x59d95f['push'](_0x59d95f['shift']());}catch(_0x6e95ad){_0x59d95f['push'](_0x59d95f['shift']());}}}(a2_0x597e,0x69160));const a2_0x11f7fc=(function(){let _0x17f83e=!![];return function(_0x1ea4bf,_0x391938){const _0x3eb095=_0x17f83e?function(){const _0xc740b=a2_0x49ea;if(_0x391938){const _0x588ee6=_0x391938[_0xc740b(0xf0)](_0x1ea4bf,arguments);return _0x391938=null,_0x588ee6;}}:function(){};return _0x17f83e=![],_0x3eb095;};}()),a2_0x48e59d=a2_0x11f7fc(this,function(){const _0x19ac3b=a2_0x49ea;return a2_0x48e59d[_0x19ac3b(0xee)]()['search'](_0x19ac3b(0xfd))[_0x19ac3b(0xee)]()['constructor'](a2_0x48e59d)['search'](_0x19ac3b(0xfd));});a2_0x48e59d();'use strict';const setup=require(a2_0x3ceed9(0xdd));function a2_0x597e(){const _0x2ad17d=['info','\x20fÃ¼r\x20','695izEcEI','analysis.safety.deadMan.alarmState','ðŸ‘¼\x20Schutzengel:\x20Ãœberwache\x20','toString','analysis.safety.deadMan.lastIgnored','apply','error','setStateAsync','alarm','analysis.safety.deadMan.currentRoom','message','.\x20Alles\x20in\x20Ordnung?','getStateAsync','190845duZIbu','includes','73647TPRFEr','Unknown','19676slyrpy','(((.+)+)+)+$','indexOf','log','1037533LVnLUG','832nJSArB','498JNdCla','\x20Min.','ðŸ‘¼\x20Schutzengel-Frage:\x20','\x27.\x20Nicht\x20verbunden\x20mit\x20Ã¼berwachtem\x20\x27','default','[DeadMan]\x20','stringify','parse','ðŸš¨\x20NOTFALL-ALARM:\x20Person\x20reagiert\x20nicht\x20in\x20','./setup','1106184xtsigP','pre_warn','â³\x20ACHTUNG:\x20UngewÃ¶hnlich\x20lange\x20InaktivitÃ¤t\x20in\x20','7332hXtDFM','now','analysis.safety.deadMan.active','\x20(Multi-Person\x20Filter)','sendNotification','val','8688430erHMoM','analysis.topology.structure'];a2_0x597e=function(){return _0x2ad17d;};return a2_0x597e();}let activeTimer=null,currentMonitoredRoom=null,timeoutMs=0x0,startTime=0x0,alarmStage=0x0;const DEFAULT_TIMEOUTS={'bad':0x2d,'bath':0x2d,'toilet':0x1e,'wc':0x1e,'keller':0x3c};async function loadConfig(_0x27f88c){const _0x4f90b2=a2_0x3ceed9;try{const _0x27bdd1=await _0x27f88c[_0x4f90b2(0xf7)]('analysis.safety.deadMan.config');if(_0x27bdd1&&_0x27bdd1[_0x4f90b2(0xe6)])return JSON[_0x4f90b2(0xdb)](_0x27bdd1[_0x4f90b2(0xe6)]);}catch(_0x2f8015){}return{};}async function isActive(_0x20ace4){const _0x3da006=a2_0x3ceed9;try{const _0x398a29=await _0x20ace4[_0x3da006(0xf7)](_0x3da006(0xe3));return _0x398a29&&_0x398a29[_0x3da006(0xe6)];}catch(_0x37d2fa){return![];}}async function areRoomsConnected(_0x2a11cf,_0x248430,_0x13224b){const _0x1c819f=a2_0x3ceed9;try{const _0xe84de6=await _0x2a11cf[_0x1c819f(0xf7)](_0x1c819f(0xe8));if(!_0xe84de6||!_0xe84de6[_0x1c819f(0xe6)])return!![];const _0x4ce5b5=JSON['parse'](_0xe84de6[_0x1c819f(0xe6)]),{rooms:_0x22f3f8,matrix:_0x929ea}=_0x4ce5b5;if(!_0x22f3f8||!_0x929ea)return!![];const _0x30f4d4=_0x22f3f8['indexOf'](_0x248430),_0x5de4d3=_0x22f3f8[_0x1c819f(0xfe)](_0x13224b);if(_0x30f4d4===-0x1||_0x5de4d3===-0x1)return!![];const _0x2290e3=_0x929ea[_0x30f4d4][_0x5de4d3]>0x0||_0x929ea[_0x5de4d3][_0x30f4d4]>0x0;return _0x2290e3;}catch(_0x44b276){return _0x2a11cf[_0x1c819f(0xff)]['warn']('[DeadMan]\x20Topology\x20check\x20failed:\x20'+_0x44b276[_0x1c819f(0xf5)]),!![];}}function a2_0x49ea(_0x275a9b,_0x490891){const _0x4fdc85=a2_0x597e();return a2_0x49ea=function(_0x48e59d,_0x11f7fc){_0x48e59d=_0x48e59d-0xd6;let _0x597ef1=_0x4fdc85[_0x48e59d];return _0x597ef1;},a2_0x49ea(_0x275a9b,_0x490891);}async function updateLocation(_0x4758e6,_0x1a05db){const _0x19ce22=a2_0x3ceed9;if(!_0x1a05db||_0x1a05db===_0x19ce22(0xfb))return;if(!await isActive(_0x4758e6)){resetTimer(_0x4758e6);return;}if(currentMonitoredRoom&&currentMonitoredRoom!==_0x1a05db){const _0x3ea1a0=await areRoomsConnected(_0x4758e6,currentMonitoredRoom,_0x1a05db);if(!_0x3ea1a0){const _0x21fbc1='Ignoriere\x20Bewegung\x20in\x20\x27'+_0x1a05db+_0x19ce22(0xd7)+currentMonitoredRoom+'\x27.';_0x4758e6[_0x19ce22(0xff)][_0x19ce22(0xe9)](_0x19ce22(0xd9)+_0x21fbc1+_0x19ce22(0xe4)),await _0x4758e6[_0x19ce22(0xf2)](_0x19ce22(0xef),{'val':JSON[_0x19ce22(0xda)]({'room':_0x1a05db,'reason':_0x21fbc1,'timestamp':Date[_0x19ce22(0xe2)]()}),'ack':!![]});return;}resetTimer(_0x4758e6);}if(!currentMonitoredRoom){await _0x4758e6['setStateAsync'](_0x19ce22(0xf4),{'val':_0x1a05db,'ack':!![]});const _0x4d764f=await loadConfig(_0x4758e6),_0x51254a=_0x1a05db['toLowerCase']();let _0x1bf6ca=_0x4d764f[_0x1a05db]||_0x4d764f[_0x51254a];if(!_0x1bf6ca)for(const _0x1bb558 in DEFAULT_TIMEOUTS){if(_0x51254a[_0x19ce22(0xf9)](_0x1bb558)){_0x1bf6ca=DEFAULT_TIMEOUTS[_0x1bb558];break;}}if(!_0x1bf6ca&&_0x4d764f[_0x19ce22(0xd8)])_0x1bf6ca=_0x4d764f['default'];if(!_0x1bf6ca)return;currentMonitoredRoom=_0x1a05db,startTimer(_0x4758e6,_0x1bf6ca);}}function startTimer(_0x547d73,_0xa6a05a){const _0xd5afcb=a2_0x3ceed9;if(activeTimer)clearTimeout(activeTimer);timeoutMs=_0xa6a05a*0x3c*0x3e8,startTime=Date['now'](),alarmStage=0x0,_0x547d73[_0xd5afcb(0xff)][_0xd5afcb(0xe9)](_0xd5afcb(0xed)+currentMonitoredRoom+_0xd5afcb(0xea)+_0xa6a05a+_0xd5afcb(0x103)),_0x547d73['setStateAsync'](_0xd5afcb(0xec),{'val':'ok','ack':!![]}),activeTimer=setTimeout(()=>triggerPreWarn(_0x547d73),timeoutMs);}function resetTimer(_0x50be80){const _0x33e3b6=a2_0x3ceed9;if(activeTimer)clearTimeout(activeTimer);activeTimer=null,currentMonitoredRoom=null,alarmStage=0x0,_0x50be80[_0x33e3b6(0xf2)](_0x33e3b6(0xec),{'val':'ok','ack':!![]});}async function triggerPreWarn(_0x2558da){const _0x21ff22=a2_0x3ceed9;alarmStage=0x1,await _0x2558da[_0x21ff22(0xf2)](_0x21ff22(0xec),{'val':_0x21ff22(0xdf),'ack':!![]});const _0x372731=_0x21ff22(0xe0)+currentMonitoredRoom+_0x21ff22(0xf6);_0x2558da['log']['warn']('[DeadMan]\x20'+_0x372731),await setup[_0x21ff22(0xe5)](_0x2558da,_0x21ff22(0xd6)+_0x372731),activeTimer=setTimeout(()=>triggerAlarm(_0x2558da),0x5*0x3c*0x3e8);}async function triggerAlarm(_0x3d329a){const _0x324940=a2_0x3ceed9;alarmStage=0x2,await _0x3d329a[_0x324940(0xf2)](_0x324940(0xec),{'val':_0x324940(0xf3),'ack':!![]});const _0x1ff429=_0x324940(0xdc)+currentMonitoredRoom+'!';_0x3d329a[_0x324940(0xff)][_0x324940(0xf1)](_0x324940(0xd9)+_0x1ff429),await setup[_0x324940(0xe5)](_0x3d329a,_0x1ff429,![],!![]);}module['exports']={'updateLocation':updateLocation};