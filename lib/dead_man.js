const a2_0x416478=a2_0x1a43;(function(_0x51794d,_0x232dd4){const _0x501d38=a2_0x1a43,_0x4fd4c5=_0x51794d();while(!![]){try{const _0x56dcf0=parseInt(_0x501d38(0xca))/0x1+parseInt(_0x501d38(0xdb))/0x2+parseInt(_0x501d38(0xd1))/0x3*(parseInt(_0x501d38(0xe4))/0x4)+parseInt(_0x501d38(0xd2))/0x5*(parseInt(_0x501d38(0xcf))/0x6)+-parseInt(_0x501d38(0xf2))/0x7+parseInt(_0x501d38(0xc6))/0x8+-parseInt(_0x501d38(0xc8))/0x9;if(_0x56dcf0===_0x232dd4)break;else _0x4fd4c5['push'](_0x4fd4c5['shift']());}catch(_0x509638){_0x4fd4c5['push'](_0x4fd4c5['shift']());}}}(a2_0x20c9,0x486e5));const a2_0x523c6d=(function(){let _0x1b27fd=!![];return function(_0x233372,_0x353186){const _0x20f94f=_0x1b27fd?function(){if(_0x353186){const _0xd192d1=_0x353186['apply'](_0x233372,arguments);return _0x353186=null,_0xd192d1;}}:function(){};return _0x1b27fd=![],_0x20f94f;};}()),a2_0x584c43=a2_0x523c6d(this,function(){const _0x364a9c=a2_0x1a43;return a2_0x584c43[_0x364a9c(0xe3)]()[_0x364a9c(0xcc)]('(((.+)+)+)+$')['toString']()[_0x364a9c(0xbe)](a2_0x584c43)[_0x364a9c(0xcc)]('(((.+)+)+)+$');});a2_0x584c43();'use strict';const setup=require(a2_0x416478(0xd7));function a2_0x1a43(_0x1a85cc,_0x3fe127){const _0x2c3636=a2_0x20c9();return a2_0x1a43=function(_0x584c43,_0x523c6d){_0x584c43=_0x584c43-0xbd;let _0x20c9fe=_0x2c3636[_0x584c43];return _0x20c9fe;},a2_0x1a43(_0x1a85cc,_0x3fe127);}let activeTimer=null,currentMonitoredRoom=null,timeoutMs=0x0,startTime=0x0,alarmStage=0x0;const DEFAULT_TIMEOUTS={'bad':0x2d,'bath':0x2d,'toilet':0x1e,'wc':0x1e,'keller':0x3c,'schlaf':0x78,'bed':0x78,'guest':0x5a,'gast':0x5a};function getTimeoutRobust(_0x3a1f7b,_0x3a6ea5){const _0x50208e=a2_0x416478;if(!_0x3a1f7b||!_0x3a6ea5)return undefined;if(_0x3a1f7b[_0x3a6ea5])return _0x3a1f7b[_0x3a6ea5];const _0x480a68=_0x3a6ea5['toLowerCase']()['replace'](/[^a-z0-9]/g,'');for(const _0x46ba06 in _0x3a1f7b){const _0x43919c=_0x46ba06[_0x50208e(0xbd)]()[_0x50208e(0xf3)](/[^a-z0-9]/g,'');if(_0x43919c===_0x480a68)return _0x3a1f7b[_0x46ba06];}const _0x24bd06=_0x3a6ea5[_0x50208e(0xbd)]();if(_0x3a1f7b[_0x24bd06])return _0x3a1f7b[_0x24bd06];return undefined;}async function loadConfig(_0x23251a){const _0x6363e0=a2_0x416478;try{const _0x1d7e9a=await _0x23251a[_0x6363e0(0xda)](_0x6363e0(0xc4));if(_0x1d7e9a&&_0x1d7e9a[_0x6363e0(0xe8)])return JSON['parse'](_0x1d7e9a[_0x6363e0(0xe8)]);}catch(_0x458841){}return{};}async function isActive(_0x5cab19){const _0x2526d2=a2_0x416478;try{const _0x44e0b3=await _0x5cab19['getStateAsync'](_0x2526d2(0xf5));return _0x44e0b3&&_0x44e0b3['val'];}catch(_0x4c86dd){return![];}}async function areRoomsConnected(_0x44754c,_0x5f47f3,_0xc0886a){const _0x1a8747=a2_0x416478;try{const _0x4d7c7a=await _0x44754c[_0x1a8747(0xda)](_0x1a8747(0xcd));if(!_0x4d7c7a||!_0x4d7c7a[_0x1a8747(0xe8)])return!![];const _0x32c3ab=JSON[_0x1a8747(0xbf)](_0x4d7c7a[_0x1a8747(0xe8)]),{rooms:_0x637afe,matrix:_0x2d563a}=_0x32c3ab;if(!_0x637afe||!_0x2d563a)return!![];const _0x50d8a3=_0x637afe['indexOf'](_0x5f47f3),_0x4b637f=_0x637afe['indexOf'](_0xc0886a);if(_0x50d8a3===-0x1||_0x4b637f===-0x1)return!![];const _0x310b4f=_0x2d563a[_0x50d8a3][_0x4b637f]>0x0||_0x2d563a[_0x4b637f][_0x50d8a3]>0x0;return _0x310b4f;}catch(_0x25be68){return _0x44754c['log'][_0x1a8747(0xc2)](_0x1a8747(0xf4)+_0x25be68['message']),!![];}}function calculateSleepProbability(_0x4e07e9){const _0x1b0d39=a2_0x416478,_0x519cc2=new Date(),_0x3660be=_0x519cc2[_0x1b0d39(0xe0)](),_0x305958=_0x4e07e9[_0x1b0d39(0xbd)]();let _0x3e4a35=0.1;if(_0x3660be>=0x17||_0x3660be<=0x6)_0x3e4a35=0x1;else{if(_0x3660be>=0xd&&_0x3660be<=0xf)_0x3e4a35=0.8;else{if(_0x3660be>=0x14&&_0x3660be<=0x17)_0x3e4a35=0.4;}}let _0x546b70=0.1;if(_0x305958[_0x1b0d39(0xde)]('schlaf')||_0x305958[_0x1b0d39(0xde)](_0x1b0d39(0xcb)))_0x546b70=0x1;else{if(_0x305958[_0x1b0d39(0xde)](_0x1b0d39(0xc9))||_0x305958['includes'](_0x1b0d39(0xc1))||_0x305958['includes'](_0x1b0d39(0xd5)))_0x546b70=0.6;else{if(_0x305958[_0x1b0d39(0xde)](_0x1b0d39(0xea))||_0x305958[_0x1b0d39(0xde)]('wc'))_0x546b70=0.05;}}let _0x281ec1=0.5;const _0x2f960b=_0x546b70*0.5+_0x3e4a35*0.3+_0x281ec1*0.2;return parseFloat(_0x2f960b['toFixed'](0x2));}async function updateLocation(_0x518403,_0x4d0266){const _0x4b9800=a2_0x416478;if(!_0x4d0266||_0x4d0266==='Unknown')return;if(!await isActive(_0x518403)){resetTimer(_0x518403);return;}if(currentMonitoredRoom&&currentMonitoredRoom!==_0x4d0266){const _0x528610=await areRoomsConnected(_0x518403,currentMonitoredRoom,_0x4d0266);if(!_0x528610){const _0x4bea6d=_0x4b9800(0xe6)+_0x4d0266+_0x4b9800(0xe1)+currentMonitoredRoom+'\x27.';_0x518403['log'][_0x4b9800(0xe5)]('[DeadMan]\x20'+_0x4bea6d+_0x4b9800(0xdc)),await _0x518403[_0x4b9800(0xc5)]('analysis.safety.deadMan.lastIgnored',{'val':JSON[_0x4b9800(0xdd)]({'room':_0x4d0266,'reason':_0x4bea6d,'timestamp':Date[_0x4b9800(0xc3)]()}),'ack':!![]});return;}resetTimer(_0x518403);}if(!currentMonitoredRoom){await _0x518403[_0x4b9800(0xc5)](_0x4b9800(0xe2),{'val':_0x4d0266,'ack':!![]});const _0x152ca9=await loadConfig(_0x518403);let _0x17fc8=getTimeoutRobust(_0x152ca9,_0x4d0266);const _0x19163f=_0x4d0266[_0x4b9800(0xbd)]();if(!_0x17fc8)for(const _0x5c1791 in DEFAULT_TIMEOUTS){if(_0x19163f[_0x4b9800(0xde)](_0x5c1791)){_0x17fc8=DEFAULT_TIMEOUTS[_0x5c1791];break;}}if(!_0x17fc8&&_0x152ca9[_0x4b9800(0xec)])_0x17fc8=_0x152ca9[_0x4b9800(0xec)];if(!_0x17fc8)return;currentMonitoredRoom=_0x4d0266,startTimer(_0x518403,_0x17fc8,_0x4d0266);}}function a2_0x20c9(){const _0x2be127=['41891DCTpxy','bed','search','analysis.topology.structure','[DeadMan]\x20','372LlyxLV','%).\x20VerlÃ¤ngere\x20Timer\x20fÃ¼r\x20','208911nchQPr','3065ExDhNG','ðŸ’¤\x20Smart\x20Sleep\x20erkannt\x20(','log','sofa','ðŸ‘¼\x20Schutzengel-Frage:\x20','./setup','ðŸš¨\x20NOTFALL-ALARM:\x20Person\x20reagiert\x20nicht\x20in\x20','alarm','getStateAsync','454876QmQrEJ','\x20(Multi-Person\x20Filter)','stringify','includes','analysis.safety.deadMan.alarmState','getHours','\x27.\x20Nicht\x20verbunden\x20mit\x20Ã¼berwachtem\x20\x27','analysis.safety.deadMan.currentRoom','toString','8HYqexh','info','Ignoriere\x20Bewegung\x20in\x20\x27','exports','val','\x20fÃ¼r\x20','bad','.\x20Alles\x20in\x20Ordnung?','default','\x20Min.','\x20um\x2090\x20Min.','analysis.safety.deadMan.smartSleep','error','pre_warn','2698927ljXrwA','replace','[DeadMan]\x20Topology\x20check\x20failed:\x20','analysis.safety.deadMan.active','analysis.safety.deadMan.napProbability','ðŸ‘¼\x20Schutzengel:\x20Ãœberwache\x20','toLowerCase','constructor','parse','â³\x20ACHTUNG:\x20UngewÃ¶hnlich\x20lange\x20InaktivitÃ¤t\x20in\x20','living','warn','now','analysis.safety.deadMan.config','setStateAsync','3507720cKevac','sendNotification','1825524rNAATi','wohn'];a2_0x20c9=function(){return _0x2be127;};return a2_0x20c9();}function startTimer(_0x4e3506,_0x250737,_0x1d2574){const _0x2de074=a2_0x416478;if(activeTimer)clearTimeout(activeTimer);timeoutMs=_0x250737*0x3c*0x3e8,startTime=Date['now'](),alarmStage=0x0;const _0x51c5c0=calculateSleepProbability(_0x1d2574||currentMonitoredRoom),_0x25d221=_0x51c5c0>0.65;_0x25d221?(timeoutMs+=0x5a*0x3c*0x3e8,_0x4e3506[_0x2de074(0xd4)][_0x2de074(0xe5)](_0x2de074(0xd3)+(_0x51c5c0*0x64)['toFixed'](0x0)+_0x2de074(0xd0)+currentMonitoredRoom+_0x2de074(0xee)),_0x4e3506[_0x2de074(0xc5)]('analysis.safety.deadMan.smartSleep',{'val':!![],'ack':!![]})):_0x4e3506[_0x2de074(0xc5)](_0x2de074(0xef),{'val':![],'ack':!![]}),_0x4e3506['setStateAsync'](_0x2de074(0xf6),{'val':_0x51c5c0,'ack':!![]}),_0x4e3506[_0x2de074(0xd4)]['info'](_0x2de074(0xf7)+currentMonitoredRoom+_0x2de074(0xe9)+_0x250737+_0x2de074(0xed)),_0x4e3506[_0x2de074(0xc5)](_0x2de074(0xdf),{'val':'ok','ack':!![]}),activeTimer=setTimeout(()=>triggerPreWarn(_0x4e3506),timeoutMs);}function resetTimer(_0x437f64){const _0x158710=a2_0x416478;if(activeTimer)clearTimeout(activeTimer);activeTimer=null,currentMonitoredRoom=null,alarmStage=0x0,_0x437f64[_0x158710(0xc5)](_0x158710(0xdf),{'val':'ok','ack':!![]}),_0x437f64['setStateAsync'](_0x158710(0xef),{'val':![],'ack':!![]}),_0x437f64[_0x158710(0xc5)](_0x158710(0xf6),{'val':0x0,'ack':!![]});}async function triggerPreWarn(_0x4d2b9a){const _0x115d4b=a2_0x416478;alarmStage=0x1,await _0x4d2b9a[_0x115d4b(0xc5)](_0x115d4b(0xdf),{'val':_0x115d4b(0xf1),'ack':!![]});const _0x28cb24=_0x115d4b(0xc0)+currentMonitoredRoom+_0x115d4b(0xeb);_0x4d2b9a[_0x115d4b(0xd4)][_0x115d4b(0xc2)]('[DeadMan]\x20'+_0x28cb24),await setup[_0x115d4b(0xc7)](_0x4d2b9a,_0x115d4b(0xd6)+_0x28cb24),activeTimer=setTimeout(()=>triggerAlarm(_0x4d2b9a),0x5*0x3c*0x3e8);}async function triggerAlarm(_0x8d5fa0){const _0x4ddd38=a2_0x416478;alarmStage=0x2,await _0x8d5fa0[_0x4ddd38(0xc5)](_0x4ddd38(0xdf),{'val':_0x4ddd38(0xd9),'ack':!![]});const _0x557e70=_0x4ddd38(0xd8)+currentMonitoredRoom+'!';_0x8d5fa0[_0x4ddd38(0xd4)][_0x4ddd38(0xf0)](_0x4ddd38(0xce)+_0x557e70),await setup['sendNotification'](_0x8d5fa0,_0x557e70,![],!![]);}module[a2_0x416478(0xe7)]={'updateLocation':updateLocation};