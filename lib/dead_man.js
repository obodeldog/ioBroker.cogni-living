const a2_0x12ab33=a2_0x1870;function a2_0x1870(_0x48a9d1,_0x34b2ec){const _0x544aa2=a2_0x326a();return a2_0x1870=function(_0x2e6af5,_0x37e276){_0x2e6af5=_0x2e6af5-0x198;let _0x326ab4=_0x544aa2[_0x2e6af5];return _0x326ab4;},a2_0x1870(_0x48a9d1,_0x34b2ec);}(function(_0x72f4a9,_0x52df24){const _0x40a8bb=a2_0x1870,_0x513807=_0x72f4a9();while(!![]){try{const _0x181c5d=-parseInt(_0x40a8bb(0x1c2))/0x1+-parseInt(_0x40a8bb(0x1aa))/0x2*(-parseInt(_0x40a8bb(0x1a7))/0x3)+parseInt(_0x40a8bb(0x1a5))/0x4*(parseInt(_0x40a8bb(0x1ca))/0x5)+parseInt(_0x40a8bb(0x1b2))/0x6*(parseInt(_0x40a8bb(0x1cd))/0x7)+parseInt(_0x40a8bb(0x1a8))/0x8+-parseInt(_0x40a8bb(0x1d1))/0x9*(-parseInt(_0x40a8bb(0x19b))/0xa)+-parseInt(_0x40a8bb(0x1ce))/0xb;if(_0x181c5d===_0x52df24)break;else _0x513807['push'](_0x513807['shift']());}catch(_0x170b52){_0x513807['push'](_0x513807['shift']());}}}(a2_0x326a,0xd14cf));const a2_0x37e276=(function(){let _0x2b6280=!![];return function(_0xced0ba,_0x19300a){const _0x4142e1=_0x2b6280?function(){const _0x5c5ff2=a2_0x1870;if(_0x19300a){const _0x4d7239=_0x19300a[_0x5c5ff2(0x1a6)](_0xced0ba,arguments);return _0x19300a=null,_0x4d7239;}}:function(){};return _0x2b6280=![],_0x4142e1;};}()),a2_0x2e6af5=a2_0x37e276(this,function(){const _0x367bdd=a2_0x1870;return a2_0x2e6af5[_0x367bdd(0x199)]()[_0x367bdd(0x1b9)](_0x367bdd(0x1ad))[_0x367bdd(0x199)]()[_0x367bdd(0x19f)](a2_0x2e6af5)[_0x367bdd(0x1b9)](_0x367bdd(0x1ad));});a2_0x2e6af5();'use strict';const setup=require(a2_0x12ab33(0x1b7));let activeTimer=null,currentMonitoredRoom=null,timeoutMs=0x0,startTime=0x0,alarmStage=0x0;const DEFAULT_TIMEOUTS={'bad':0x2d,'bath':0x2d,'toilet':0x1e,'wc':0x1e,'keller':0x3c,'schlaf':0x78,'bed':0x78,'guest':0x5a,'gast':0x5a};function a2_0x326a(){const _0x143a29=['./setup','getHours','search','\x20Min.','now','toLowerCase','ðŸš¨\x20NOTFALL-ALARM:\x20Person\x20reagiert\x20nicht\x20in\x20','indexOf','[DeadMan]\x20','\x20fÃ¼r\x20','Ignoriere\x20Bewegung\x20in\x20\x27','15537uqxFwo','â³\x20ACHTUNG:\x20UngewÃ¶hnlich\x20lange\x20InaktivitÃ¤t\x20in\x20','analysis.safety.deadMan.alarmState','\x27.\x20Nicht\x20verbunden\x20mit\x20Ã¼berwachtem\x20\x27','bad','toFixed','\x20um\x2090\x20Min.','parse','1005aoDIdn','default','warn','22211xCrSfU','40170724AmoeuF','log','Unknown','9PPkQNh','exports','toString','info','4960060oUOWPa','val','pre_warn','wohn','constructor','analysis.safety.deadMan.napProbability','sofa','bed','setStateAsync','analysis.safety.deadMan.active','16204JoGfbk','apply','1195611kMdysB','13211448iCdVrN','getStateAsync','2jBqMmJ','alarm','living','(((.+)+)+)+$','includes','sendNotification','replace','\x20(Multi-Person\x20Filter)','2202vbXMyD','analysis.safety.deadMan.config','%).\x20VerlÃ¤ngere\x20Timer\x20fÃ¼r\x20','analysis.safety.deadMan.smartSleep','ðŸ’¤\x20Smart\x20Sleep\x20erkannt\x20('];a2_0x326a=function(){return _0x143a29;};return a2_0x326a();}function getTimeoutRobust(_0x43a81f,_0xaded22){const _0x9de03f=a2_0x12ab33;if(!_0x43a81f||!_0xaded22)return undefined;if(_0x43a81f[_0xaded22])return _0x43a81f[_0xaded22];const _0xf41647=_0xaded22[_0x9de03f(0x1bc)]()['replace'](/[^a-z0-9]/g,'');for(const _0x46e8c2 in _0x43a81f){const _0x52d314=_0x46e8c2[_0x9de03f(0x1bc)]()[_0x9de03f(0x1b0)](/[^a-z0-9]/g,'');if(_0x52d314===_0xf41647)return _0x43a81f[_0x46e8c2];}const _0xade31f=_0xaded22['toLowerCase']();if(_0x43a81f[_0xade31f])return _0x43a81f[_0xade31f];return undefined;}async function loadConfig(_0x9ceaff){const _0x1997ee=a2_0x12ab33;try{const _0x2aad28=await _0x9ceaff[_0x1997ee(0x1a9)](_0x1997ee(0x1b3));if(_0x2aad28&&_0x2aad28['val'])return JSON[_0x1997ee(0x1c9)](_0x2aad28[_0x1997ee(0x19c)]);}catch(_0x43acf4){}return{};}async function isActive(_0x5d088b){const _0xef6e09=a2_0x12ab33;try{const _0x304809=await _0x5d088b[_0xef6e09(0x1a9)](_0xef6e09(0x1a4));return _0x304809&&_0x304809['val'];}catch(_0x2fd826){return![];}}async function areRoomsConnected(_0x3c79ee,_0x5bc666,_0x24ce79){const _0x8b7f18=a2_0x12ab33;try{const _0x3098eb=await _0x3c79ee[_0x8b7f18(0x1a9)]('analysis.topology.structure');if(!_0x3098eb||!_0x3098eb[_0x8b7f18(0x19c)])return!![];const _0x34cd96=JSON[_0x8b7f18(0x1c9)](_0x3098eb[_0x8b7f18(0x19c)]),{rooms:_0x34f74f,matrix:_0x3c9a52}=_0x34cd96;if(!_0x34f74f||!_0x3c9a52)return!![];const _0x1d4edd=_0x34f74f[_0x8b7f18(0x1be)](_0x5bc666),_0x2e7067=_0x34f74f[_0x8b7f18(0x1be)](_0x24ce79);if(_0x1d4edd===-0x1||_0x2e7067===-0x1)return!![];const _0x4fa091=_0x3c9a52[_0x1d4edd][_0x2e7067]>0x0||_0x3c9a52[_0x2e7067][_0x1d4edd]>0x0;return _0x4fa091;}catch(_0x3bd06f){return _0x3c79ee['log'][_0x8b7f18(0x1cc)]('[DeadMan]\x20Topology\x20check\x20failed:\x20'+_0x3bd06f['message']),!![];}}function calculateSleepProbability(_0xdd7ed7){const _0x27fd58=a2_0x12ab33,_0x59aae6=new Date(),_0x359f8f=_0x59aae6[_0x27fd58(0x1b8)](),_0x3e7818=_0xdd7ed7['toLowerCase']();let _0x18c648=0.1;if(_0x359f8f>=0x17||_0x359f8f<=0x6)_0x18c648=0x1;else{if(_0x359f8f>=0xd&&_0x359f8f<=0xf)_0x18c648=0.8;else{if(_0x359f8f>=0x14&&_0x359f8f<=0x17)_0x18c648=0.4;}}let _0x476c44=0.1;if(_0x3e7818[_0x27fd58(0x1ae)]('schlaf')||_0x3e7818[_0x27fd58(0x1ae)](_0x27fd58(0x1a2)))_0x476c44=0x1;else{if(_0x3e7818[_0x27fd58(0x1ae)](_0x27fd58(0x19e))||_0x3e7818[_0x27fd58(0x1ae)](_0x27fd58(0x1ac))||_0x3e7818[_0x27fd58(0x1ae)](_0x27fd58(0x1a1)))_0x476c44=0.6;else{if(_0x3e7818[_0x27fd58(0x1ae)](_0x27fd58(0x1c6))||_0x3e7818[_0x27fd58(0x1ae)]('wc'))_0x476c44=0.05;}}let _0x140940=0.5;const _0x1c6a1d=_0x476c44*0.5+_0x18c648*0.3+_0x140940*0.2;return parseFloat(_0x1c6a1d['toFixed'](0x2));}async function updateLocation(_0x87ce81,_0x142f6e){const _0x20ea8e=a2_0x12ab33;if(!_0x142f6e||_0x142f6e===_0x20ea8e(0x1d0))return;if(!await isActive(_0x87ce81)){resetTimer(_0x87ce81);return;}if(currentMonitoredRoom&&currentMonitoredRoom!==_0x142f6e){const _0xe59f05=await areRoomsConnected(_0x87ce81,currentMonitoredRoom,_0x142f6e);if(!_0xe59f05){const _0x38f1a7=_0x20ea8e(0x1c1)+_0x142f6e+_0x20ea8e(0x1c5)+currentMonitoredRoom+'\x27.';_0x87ce81['log']['info'](_0x20ea8e(0x1bf)+_0x38f1a7+_0x20ea8e(0x1b1)),await _0x87ce81[_0x20ea8e(0x1a3)]('analysis.safety.deadMan.lastIgnored',{'val':JSON['stringify']({'room':_0x142f6e,'reason':_0x38f1a7,'timestamp':Date[_0x20ea8e(0x1bb)]()}),'ack':!![]});return;}resetTimer(_0x87ce81);}if(!currentMonitoredRoom){await _0x87ce81[_0x20ea8e(0x1a3)]('analysis.safety.deadMan.currentRoom',{'val':_0x142f6e,'ack':!![]});const _0x8d614e=await loadConfig(_0x87ce81);let _0x3a1173=getTimeoutRobust(_0x8d614e,_0x142f6e);const _0x1f2763=_0x142f6e[_0x20ea8e(0x1bc)]();if(!_0x3a1173)for(const _0x579bb9 in DEFAULT_TIMEOUTS){if(_0x1f2763['includes'](_0x579bb9)){_0x3a1173=DEFAULT_TIMEOUTS[_0x579bb9];break;}}if(!_0x3a1173&&_0x8d614e[_0x20ea8e(0x1cb)])_0x3a1173=_0x8d614e[_0x20ea8e(0x1cb)];if(!_0x3a1173)return;currentMonitoredRoom=_0x142f6e,startTimer(_0x87ce81,_0x3a1173,_0x142f6e);}}function startTimer(_0x212ca1,_0x1f2ea4,_0x1ccc0f){const _0x70b098=a2_0x12ab33;if(activeTimer)clearTimeout(activeTimer);timeoutMs=_0x1f2ea4*0x3c*0x3e8,startTime=Date[_0x70b098(0x1bb)](),alarmStage=0x0;const _0x8369a8=calculateSleepProbability(_0x1ccc0f||currentMonitoredRoom),_0x5a459e=_0x8369a8>0.65;_0x5a459e?(timeoutMs+=0x5a*0x3c*0x3e8,_0x212ca1['log'][_0x70b098(0x19a)](_0x70b098(0x1b6)+(_0x8369a8*0x64)[_0x70b098(0x1c7)](0x0)+_0x70b098(0x1b4)+currentMonitoredRoom+_0x70b098(0x1c8)),_0x212ca1[_0x70b098(0x1a3)](_0x70b098(0x1b5),{'val':!![],'ack':!![]})):_0x212ca1[_0x70b098(0x1a3)](_0x70b098(0x1b5),{'val':![],'ack':!![]}),_0x212ca1['setStateAsync']('analysis.safety.deadMan.napProbability',{'val':_0x8369a8,'ack':!![]}),_0x212ca1[_0x70b098(0x1cf)][_0x70b098(0x19a)]('ðŸ‘¼\x20Schutzengel:\x20Ãœberwache\x20'+currentMonitoredRoom+_0x70b098(0x1c0)+_0x1f2ea4+_0x70b098(0x1ba)),_0x212ca1[_0x70b098(0x1a3)]('analysis.safety.deadMan.alarmState',{'val':'ok','ack':!![]}),activeTimer=setTimeout(()=>triggerPreWarn(_0x212ca1),timeoutMs);}function resetTimer(_0x240a5d){const _0x2e2eac=a2_0x12ab33;if(activeTimer)clearTimeout(activeTimer);activeTimer=null,currentMonitoredRoom=null,alarmStage=0x0,_0x240a5d['setStateAsync'](_0x2e2eac(0x1c4),{'val':'ok','ack':!![]}),_0x240a5d['setStateAsync']('analysis.safety.deadMan.smartSleep',{'val':![],'ack':!![]}),_0x240a5d['setStateAsync'](_0x2e2eac(0x1a0),{'val':0x0,'ack':!![]});}async function triggerPreWarn(_0x5f394f){const _0x11af63=a2_0x12ab33;alarmStage=0x1,await _0x5f394f[_0x11af63(0x1a3)](_0x11af63(0x1c4),{'val':_0x11af63(0x19d),'ack':!![]});const _0x686744=_0x11af63(0x1c3)+currentMonitoredRoom+'.\x20Alles\x20in\x20Ordnung?';_0x5f394f[_0x11af63(0x1cf)][_0x11af63(0x1cc)]('[DeadMan]\x20'+_0x686744),await setup[_0x11af63(0x1af)](_0x5f394f,'ðŸ‘¼\x20Schutzengel-Frage:\x20'+_0x686744),activeTimer=setTimeout(()=>triggerAlarm(_0x5f394f),0x5*0x3c*0x3e8);}async function triggerAlarm(_0x190451){const _0x53943e=a2_0x12ab33;alarmStage=0x2,await _0x190451[_0x53943e(0x1a3)](_0x53943e(0x1c4),{'val':_0x53943e(0x1ab),'ack':!![]});const _0x485538=_0x53943e(0x1bd)+currentMonitoredRoom+'!';_0x190451['log']['error'](_0x53943e(0x1bf)+_0x485538),await setup[_0x53943e(0x1af)](_0x190451,_0x485538,![],!![]);}module[a2_0x12ab33(0x198)]={'updateLocation':updateLocation};