const a2_0x40adba=a2_0x4364;(function(_0x4f9d36,_0x35a8bf){const _0xe4e70a=a2_0x4364,_0x36d879=_0x4f9d36();while(!![]){try{const _0x45aa00=-parseInt(_0xe4e70a(0x10f))/0x1*(parseInt(_0xe4e70a(0x127))/0x2)+parseInt(_0xe4e70a(0x113))/0x3+-parseInt(_0xe4e70a(0x102))/0x4*(parseInt(_0xe4e70a(0x11e))/0x5)+parseInt(_0xe4e70a(0xf9))/0x6+parseInt(_0xe4e70a(0x11a))/0x7*(parseInt(_0xe4e70a(0x104))/0x8)+-parseInt(_0xe4e70a(0x11b))/0x9*(-parseInt(_0xe4e70a(0xfd))/0xa)+parseInt(_0xe4e70a(0x10a))/0xb*(-parseInt(_0xe4e70a(0xfb))/0xc);if(_0x45aa00===_0x35a8bf)break;else _0x36d879['push'](_0x36d879['shift']());}catch(_0x37e02a){_0x36d879['push'](_0x36d879['shift']());}}}(a2_0x312f,0xbe0ac));const a2_0x3171b0=(function(){let _0x34cc92=!![];return function(_0x17a90a,_0x333a0c){const _0x55296a=_0x34cc92?function(){const _0x2d8839=a2_0x4364;if(_0x333a0c){const _0xd49e51=_0x333a0c[_0x2d8839(0x10c)](_0x17a90a,arguments);return _0x333a0c=null,_0xd49e51;}}:function(){};return _0x34cc92=![],_0x55296a;};}()),a2_0x4611d1=a2_0x3171b0(this,function(){const _0x1dea70=a2_0x4364;return a2_0x4611d1['toString']()[_0x1dea70(0x105)](_0x1dea70(0x131))[_0x1dea70(0x120)]()[_0x1dea70(0x129)](a2_0x4611d1)[_0x1dea70(0x105)](_0x1dea70(0x131));});a2_0x4611d1();'use strict';const setup=require(a2_0x40adba(0x116));let activeTimer=null,currentMonitoredRoom=null,timeoutMs=0x0,startTime=0x0,alarmStage=0x0;const DEFAULT_TIMEOUTS={'bad':0x2d,'bath':0x2d,'toilet':0x1e,'wc':0x1e,'keller':0x3c,'schlaf':0x78,'bed':0x78,'guest':0x5a,'gast':0x5a};async function loadConfig(_0x2c5209){const _0x2a66cb=a2_0x40adba;try{const _0x506a3e=await _0x2c5209[_0x2a66cb(0x100)]('analysis.safety.deadMan.config');if(_0x506a3e&&_0x506a3e[_0x2a66cb(0xfc)])return JSON['parse'](_0x506a3e[_0x2a66cb(0xfc)]);}catch(_0x526b52){}return{};}async function isActive(_0xa9d934){const _0x405e9f=a2_0x40adba;try{const _0x24e8eb=await _0xa9d934[_0x405e9f(0x100)](_0x405e9f(0x132));return _0x24e8eb&&_0x24e8eb[_0x405e9f(0xfc)];}catch(_0x43bfe4){return![];}}async function areRoomsConnected(_0x159ff7,_0xf76f2a,_0x488e2c){const _0x2cb288=a2_0x40adba;try{const _0x2d73e4=await _0x159ff7[_0x2cb288(0x100)]('analysis.topology.structure');if(!_0x2d73e4||!_0x2d73e4[_0x2cb288(0xfc)])return!![];const _0x421a77=JSON[_0x2cb288(0x130)](_0x2d73e4[_0x2cb288(0xfc)]),{rooms:_0x115db9,matrix:_0x58d845}=_0x421a77;if(!_0x115db9||!_0x58d845)return!![];const _0x3e61ea=_0x115db9[_0x2cb288(0x10b)](_0xf76f2a),_0x2d5000=_0x115db9[_0x2cb288(0x10b)](_0x488e2c);if(_0x3e61ea===-0x1||_0x2d5000===-0x1)return!![];const _0x169900=_0x58d845[_0x3e61ea][_0x2d5000]>0x0||_0x58d845[_0x2d5000][_0x3e61ea]>0x0;return _0x169900;}catch(_0x5d8a8b){return _0x159ff7[_0x2cb288(0x118)][_0x2cb288(0x10e)](_0x2cb288(0x11c)+_0x5d8a8b[_0x2cb288(0x134)]),!![];}}function calculateSleepProbability(_0x1a02f1){const _0x5b0edd=a2_0x40adba,_0x406ecb=new Date(),_0x86d71c=_0x406ecb[_0x5b0edd(0x109)](),_0x21f1ff=_0x1a02f1['toLowerCase']();let _0x30d383=0.1;if(_0x86d71c>=0x17||_0x86d71c<=0x6)_0x30d383=0x1;else{if(_0x86d71c>=0xd&&_0x86d71c<=0xf)_0x30d383=0.8;else{if(_0x86d71c>=0x14&&_0x86d71c<=0x17)_0x30d383=0.4;}}let _0x7d54cf=0.1;if(_0x21f1ff[_0x5b0edd(0x128)](_0x5b0edd(0xff))||_0x21f1ff[_0x5b0edd(0x128)](_0x5b0edd(0x101)))_0x7d54cf=0x1;else{if(_0x21f1ff[_0x5b0edd(0x128)](_0x5b0edd(0x115))||_0x21f1ff['includes'](_0x5b0edd(0x11f))||_0x21f1ff[_0x5b0edd(0x128)](_0x5b0edd(0x12d)))_0x7d54cf=0.6;else{if(_0x21f1ff[_0x5b0edd(0x128)](_0x5b0edd(0x117))||_0x21f1ff[_0x5b0edd(0x128)]('wc'))_0x7d54cf=0.05;}}let _0x431e50=0.5;const _0x37e4fc=_0x7d54cf*0.5+_0x30d383*0.3+_0x431e50*0.2;return parseFloat(_0x37e4fc[_0x5b0edd(0x12e)](0x2));}async function updateLocation(_0x5909cf,_0x125816){const _0x552858=a2_0x40adba;if(!_0x125816||_0x125816===_0x552858(0x107))return;if(!await isActive(_0x5909cf)){resetTimer(_0x5909cf);return;}if(currentMonitoredRoom&&currentMonitoredRoom!==_0x125816){const _0x2410ca=await areRoomsConnected(_0x5909cf,currentMonitoredRoom,_0x125816);if(!_0x2410ca){const _0x53acd1=_0x552858(0x123)+_0x125816+_0x552858(0x12a)+currentMonitoredRoom+'\x27.';_0x5909cf[_0x552858(0x118)][_0x552858(0x12b)](_0x552858(0x124)+_0x53acd1+'\x20(Multi-Person\x20Filter)'),await _0x5909cf[_0x552858(0x12c)]('analysis.safety.deadMan.lastIgnored',{'val':JSON[_0x552858(0xfe)]({'room':_0x125816,'reason':_0x53acd1,'timestamp':Date[_0x552858(0x125)]()}),'ack':!![]});return;}resetTimer(_0x5909cf);}if(!currentMonitoredRoom){await _0x5909cf[_0x552858(0x12c)](_0x552858(0x119),{'val':_0x125816,'ack':!![]});const _0x34cace=await loadConfig(_0x5909cf),_0x551bd6=_0x125816[_0x552858(0x110)]();let _0x3e4317=_0x34cace[_0x125816]||_0x34cace[_0x551bd6];if(!_0x3e4317)for(const _0x341cfa in DEFAULT_TIMEOUTS){if(_0x551bd6['includes'](_0x341cfa)){_0x3e4317=DEFAULT_TIMEOUTS[_0x341cfa];break;}}if(!_0x3e4317&&_0x34cace[_0x552858(0x122)])_0x3e4317=_0x34cace[_0x552858(0x122)];if(!_0x3e4317)return;currentMonitoredRoom=_0x125816,startTimer(_0x5909cf,_0x3e4317,_0x125816);}}function startTimer(_0x1fe592,_0x10780f,_0x2545eb){const _0x4ad7a7=a2_0x40adba;if(activeTimer)clearTimeout(activeTimer);timeoutMs=_0x10780f*0x3c*0x3e8,startTime=Date[_0x4ad7a7(0x125)](),alarmStage=0x0;const _0x207d34=calculateSleepProbability(_0x2545eb||currentMonitoredRoom),_0x343f13=_0x207d34>0.65;_0x343f13?(timeoutMs+=0x5a*0x3c*0x3e8,_0x1fe592[_0x4ad7a7(0x118)][_0x4ad7a7(0x12b)](_0x4ad7a7(0x114)+(_0x207d34*0x64)[_0x4ad7a7(0x12e)](0x0)+'%).\x20VerlÃ¤ngere\x20Timer\x20fÃ¼r\x20'+currentMonitoredRoom+_0x4ad7a7(0x126)),_0x1fe592['setStateAsync'](_0x4ad7a7(0x12f),{'val':!![],'ack':!![]})):_0x1fe592[_0x4ad7a7(0x12c)](_0x4ad7a7(0x12f),{'val':![],'ack':!![]}),_0x1fe592[_0x4ad7a7(0x12c)](_0x4ad7a7(0xfa),{'val':_0x207d34,'ack':!![]}),_0x1fe592['log'][_0x4ad7a7(0x12b)](_0x4ad7a7(0x111)+currentMonitoredRoom+_0x4ad7a7(0x108)+_0x10780f+_0x4ad7a7(0xf8)),_0x1fe592['setStateAsync'](_0x4ad7a7(0x10d),{'val':'ok','ack':!![]}),activeTimer=setTimeout(()=>triggerPreWarn(_0x1fe592),timeoutMs);}function resetTimer(_0x1f83ac){const _0x22e524=a2_0x40adba;if(activeTimer)clearTimeout(activeTimer);activeTimer=null,currentMonitoredRoom=null,alarmStage=0x0,_0x1f83ac[_0x22e524(0x12c)](_0x22e524(0x10d),{'val':'ok','ack':!![]}),_0x1f83ac['setStateAsync'](_0x22e524(0x12f),{'val':![],'ack':!![]}),_0x1f83ac[_0x22e524(0x12c)](_0x22e524(0xfa),{'val':0x0,'ack':!![]});}async function triggerPreWarn(_0x1768c6){const _0x284c55=a2_0x40adba;alarmStage=0x1,await _0x1768c6[_0x284c55(0x12c)](_0x284c55(0x10d),{'val':_0x284c55(0x11d),'ack':!![]});const _0x5dfe26='â³\x20ACHTUNG:\x20UngewÃ¶hnlich\x20lange\x20InaktivitÃ¤t\x20in\x20'+currentMonitoredRoom+_0x284c55(0x133);_0x1768c6[_0x284c55(0x118)][_0x284c55(0x10e)](_0x284c55(0x124)+_0x5dfe26),await setup[_0x284c55(0x121)](_0x1768c6,_0x284c55(0x112)+_0x5dfe26),activeTimer=setTimeout(()=>triggerAlarm(_0x1768c6),0x5*0x3c*0x3e8);}function a2_0x312f(){const _0x430f5f=['9250788wgUlLW','analysis.safety.deadMan.napProbability','972hkaMYm','val','10bMNPOG','stringify','schlaf','getStateAsync','bed','3648028rHeQOi','alarm','2546624QVikki','search','ðŸš¨\x20NOTFALL-ALARM:\x20Person\x20reagiert\x20nicht\x20in\x20','Unknown','\x20fÃ¼r\x20','getHours','259501DkIfxT','indexOf','apply','analysis.safety.deadMan.alarmState','warn','20HMhlPu','toLowerCase','ðŸ‘¼\x20Schutzengel:\x20Ãœberwache\x20','ðŸ‘¼\x20Schutzengel-Frage:\x20','779880nsXwRz','ðŸ’¤\x20Smart\x20Sleep\x20erkannt\x20(','wohn','./setup','bad','log','analysis.safety.deadMan.currentRoom','28XiiXrG','12948120VrpvaJ','[DeadMan]\x20Topology\x20check\x20failed:\x20','pre_warn','5QcpkJy','living','toString','sendNotification','default','Ignoriere\x20Bewegung\x20in\x20\x27','[DeadMan]\x20','now','\x20um\x2090\x20Min.','91246yTtsBa','includes','constructor','\x27.\x20Nicht\x20verbunden\x20mit\x20Ã¼berwachtem\x20\x27','info','setStateAsync','sofa','toFixed','analysis.safety.deadMan.smartSleep','parse','(((.+)+)+)+$','analysis.safety.deadMan.active','.\x20Alles\x20in\x20Ordnung?','message','\x20Min.'];a2_0x312f=function(){return _0x430f5f;};return a2_0x312f();}async function triggerAlarm(_0x44ce9b){const _0x44610a=a2_0x40adba;alarmStage=0x2,await _0x44ce9b[_0x44610a(0x12c)](_0x44610a(0x10d),{'val':_0x44610a(0x103),'ack':!![]});const _0x9f24ce=_0x44610a(0x106)+currentMonitoredRoom+'!';_0x44ce9b['log']['error']('[DeadMan]\x20'+_0x9f24ce),await setup['sendNotification'](_0x44ce9b,_0x9f24ce,![],!![]);}function a2_0x4364(_0x3d80cc,_0x2d016f){const _0x53fbb9=a2_0x312f();return a2_0x4364=function(_0x4611d1,_0x3171b0){_0x4611d1=_0x4611d1-0xf8;let _0x312f03=_0x53fbb9[_0x4611d1];return _0x312f03;},a2_0x4364(_0x3d80cc,_0x2d016f);}module['exports']={'updateLocation':updateLocation};