const a2_0x360c56=a2_0x2c0a;(function(_0x55f16f,_0x5c7ef9){const _0x56d4b8=a2_0x2c0a,_0x3cf266=_0x55f16f();while(!![]){try{const _0x2ba9b9=parseInt(_0x56d4b8(0xc7))/0x1+-parseInt(_0x56d4b8(0xd1))/0x2+-parseInt(_0x56d4b8(0xbb))/0x3+parseInt(_0x56d4b8(0xcd))/0x4+-parseInt(_0x56d4b8(0xcb))/0x5+parseInt(_0x56d4b8(0xc0))/0x6*(-parseInt(_0x56d4b8(0xe2))/0x7)+parseInt(_0x56d4b8(0xec))/0x8*(parseInt(_0x56d4b8(0xc2))/0x9);if(_0x2ba9b9===_0x5c7ef9)break;else _0x3cf266['push'](_0x3cf266['shift']());}catch(_0x1a5107){_0x3cf266['push'](_0x3cf266['shift']());}}}(a2_0x376c,0x94e56));const a2_0x20bd64=(function(){let _0x631a1c=!![];return function(_0x1b69a0,_0x3da54c){const _0x34b94b=_0x631a1c?function(){if(_0x3da54c){const _0x40ab2e=_0x3da54c['apply'](_0x1b69a0,arguments);return _0x3da54c=null,_0x40ab2e;}}:function(){};return _0x631a1c=![],_0x34b94b;};}()),a2_0x5b03ac=a2_0x20bd64(this,function(){const _0x21aab0=a2_0x2c0a;return a2_0x5b03ac[_0x21aab0(0xc4)]()[_0x21aab0(0xba)](_0x21aab0(0xbf))[_0x21aab0(0xc4)]()['constructor'](a2_0x5b03ac)[_0x21aab0(0xba)](_0x21aab0(0xbf));});a2_0x5b03ac();'use strict';const setup=require(a2_0x360c56(0xd8));let activeTimer=null,currentMonitoredRoom=null,timeoutMs=0x0,startTime=0x0,alarmStage=0x0;const DEFAULT_TIMEOUTS={'bad':0x2d,'bath':0x2d,'toilet':0x1e,'wc':0x1e,'keller':0x3c,'schlaf':0x78,'bed':0x78,'guest':0x5a,'gast':0x5a};function getTimeoutRobust(_0x1cda6f,_0xb01176){const _0x57bbe5=a2_0x360c56;if(!_0x1cda6f||!_0xb01176)return undefined;if(_0x1cda6f[_0xb01176])return _0x1cda6f[_0xb01176];const _0x5eafcc=_0xb01176[_0x57bbe5(0xbd)]()[_0x57bbe5(0xe0)](/[^a-z0-9]/g,'');for(const _0x112d59 in _0x1cda6f){const _0x1a5ee4=_0x112d59[_0x57bbe5(0xbd)]()[_0x57bbe5(0xe0)](/[^a-z0-9]/g,'');if(_0x1a5ee4===_0x5eafcc)return _0x1cda6f[_0x112d59];}const _0x21bf78=_0xb01176[_0x57bbe5(0xbd)]();if(_0x1cda6f[_0x21bf78])return _0x1cda6f[_0x21bf78];return undefined;}async function loadConfig(_0x3f0f41){const _0xcd3c5e=a2_0x360c56;try{const _0x3e51c8=await _0x3f0f41[_0xcd3c5e(0xc8)](_0xcd3c5e(0xd7));if(_0x3e51c8&&_0x3e51c8[_0xcd3c5e(0xed)])return JSON['parse'](_0x3e51c8[_0xcd3c5e(0xed)]);}catch(_0x477d15){}return{};}async function isActive(_0x21131f){const _0x5b8906=a2_0x360c56;try{const _0x578d49=await _0x21131f[_0x5b8906(0xc8)](_0x5b8906(0xdd));return _0x578d49&&_0x578d49[_0x5b8906(0xed)];}catch(_0x189c9d){return![];}}function a2_0x376c(){const _0x1f528a=['log','analysis.safety.deadMan.alarmState','analysis.safety.deadMan.config','./setup','analysis.safety.deadMan.smartSleep','error','[DeadMan]\x20','default','analysis.safety.deadMan.active','schlaf','[DeadMan]\x20Topology\x20check\x20failed:\x20','replace','\x20um\x2090\x20Min.','1099QxcGwl','\x20(Multi-Person\x20Filter)','â³\x20ACHTUNG:\x20UngewÃ¶hnlich\x20lange\x20InaktivitÃ¤t\x20in\x20','wohn','bed','ðŸš¨\x20NOTFALL-ALARM:\x20Person\x20reagiert\x20nicht\x20in\x20','getHours','%).\x20VerlÃ¤ngere\x20Timer\x20fÃ¼r\x20','stringify','indexOf','2331664ELfSVu','val','analysis.topology.structure','bad','analysis.safety.deadMan.currentRoom','search','3284958jvQiew','\x20Min.','toLowerCase','analysis.safety.deadMan.lastIgnored','(((.+)+)+)+$','32622ZBenGT','info','72PHbtmj','warn','toString','includes','pre_warn','433322hDQltJ','getStateAsync','ðŸ‘¼\x20Schutzengel-Frage:\x20','now','547650nsJbrt','setStateAsync','2776756xZbkcB','sendNotification','Unknown','toFixed','1582344kVEEoe','\x20fÃ¼r\x20','\x27.\x20Nicht\x20verbunden\x20mit\x20Ã¼berwachtem\x20\x27','.\x20Alles\x20in\x20Ordnung?'];a2_0x376c=function(){return _0x1f528a;};return a2_0x376c();}async function areRoomsConnected(_0x1c316f,_0x39cb6e,_0x1738d4){const _0x575041=a2_0x360c56;try{const _0xbcbe8d=await _0x1c316f[_0x575041(0xc8)](_0x575041(0xb7));if(!_0xbcbe8d||!_0xbcbe8d[_0x575041(0xed)])return!![];const _0x50af2a=JSON['parse'](_0xbcbe8d[_0x575041(0xed)]),{rooms:_0x58a8ed,matrix:_0x314e67}=_0x50af2a;if(!_0x58a8ed||!_0x314e67)return!![];const _0x2f64be=_0x58a8ed['indexOf'](_0x39cb6e),_0xe1dccc=_0x58a8ed[_0x575041(0xeb)](_0x1738d4);if(_0x2f64be===-0x1||_0xe1dccc===-0x1)return!![];const _0x54df19=_0x314e67[_0x2f64be][_0xe1dccc]>0x0||_0x314e67[_0xe1dccc][_0x2f64be]>0x0;return _0x54df19;}catch(_0xf9eae1){return _0x1c316f['log'][_0x575041(0xc3)](_0x575041(0xdf)+_0xf9eae1['message']),!![];}}function a2_0x2c0a(_0xb317d8,_0x14732b){const _0x53d856=a2_0x376c();return a2_0x2c0a=function(_0x5b03ac,_0x20bd64){_0x5b03ac=_0x5b03ac-0xb7;let _0x376c74=_0x53d856[_0x5b03ac];return _0x376c74;},a2_0x2c0a(_0xb317d8,_0x14732b);}function calculateSleepProbability(_0x1b848d){const _0x2be0ca=a2_0x360c56,_0x7c899f=new Date(),_0x21d63f=_0x7c899f[_0x2be0ca(0xe8)](),_0xf9c569=_0x1b848d[_0x2be0ca(0xbd)]();let _0x4915f9=0.1;if(_0x21d63f>=0x17||_0x21d63f<=0x6)_0x4915f9=0x1;else{if(_0x21d63f>=0xd&&_0x21d63f<=0xf)_0x4915f9=0.8;else{if(_0x21d63f>=0x14&&_0x21d63f<=0x17)_0x4915f9=0.4;}}let _0x186b7d=0.1;if(_0xf9c569[_0x2be0ca(0xc5)](_0x2be0ca(0xde))||_0xf9c569[_0x2be0ca(0xc5)](_0x2be0ca(0xe6)))_0x186b7d=0x1;else{if(_0xf9c569[_0x2be0ca(0xc5)](_0x2be0ca(0xe5))||_0xf9c569['includes']('living')||_0xf9c569[_0x2be0ca(0xc5)]('sofa'))_0x186b7d=0.6;else{if(_0xf9c569[_0x2be0ca(0xc5)](_0x2be0ca(0xb8))||_0xf9c569[_0x2be0ca(0xc5)]('wc'))_0x186b7d=0.05;}}let _0x2af182=0.5;const _0x4d919f=_0x186b7d*0.5+_0x4915f9*0.3+_0x2af182*0.2;return parseFloat(_0x4d919f[_0x2be0ca(0xd0)](0x2));}async function updateLocation(_0x5a3e9a,_0x18677f){const _0x87101c=a2_0x360c56;if(!_0x18677f||_0x18677f===_0x87101c(0xcf))return;if(!await isActive(_0x5a3e9a)){resetTimer(_0x5a3e9a);return;}if(currentMonitoredRoom&&currentMonitoredRoom!==_0x18677f){const _0x5e987c=await areRoomsConnected(_0x5a3e9a,currentMonitoredRoom,_0x18677f);if(!_0x5e987c){const _0x3263c1='Ignoriere\x20Bewegung\x20in\x20\x27'+_0x18677f+_0x87101c(0xd3)+currentMonitoredRoom+'\x27.';_0x5a3e9a[_0x87101c(0xd5)][_0x87101c(0xc1)]('[DeadMan]\x20'+_0x3263c1+_0x87101c(0xe3)),await _0x5a3e9a[_0x87101c(0xcc)](_0x87101c(0xbe),{'val':JSON[_0x87101c(0xea)]({'room':_0x18677f,'reason':_0x3263c1,'timestamp':Date[_0x87101c(0xca)]()}),'ack':!![]});return;}resetTimer(_0x5a3e9a);}if(!currentMonitoredRoom){await _0x5a3e9a[_0x87101c(0xcc)](_0x87101c(0xb9),{'val':_0x18677f,'ack':!![]});const _0x305aea=await loadConfig(_0x5a3e9a);let _0x2872d3=getTimeoutRobust(_0x305aea,_0x18677f);const _0x59cb41=_0x18677f[_0x87101c(0xbd)]();if(!_0x2872d3)for(const _0x3b5a8a in DEFAULT_TIMEOUTS){if(_0x59cb41[_0x87101c(0xc5)](_0x3b5a8a)){_0x2872d3=DEFAULT_TIMEOUTS[_0x3b5a8a];break;}}if(!_0x2872d3&&_0x305aea[_0x87101c(0xdc)])_0x2872d3=_0x305aea['default'];if(!_0x2872d3)return;currentMonitoredRoom=_0x18677f,startTimer(_0x5a3e9a,_0x2872d3,_0x18677f);}}function startTimer(_0x3e5463,_0x506882,_0x2bf12a){const _0x453eff=a2_0x360c56;if(activeTimer)clearTimeout(activeTimer);timeoutMs=_0x506882*0x3c*0x3e8,startTime=Date[_0x453eff(0xca)](),alarmStage=0x0;const _0x3ddf41=calculateSleepProbability(_0x2bf12a||currentMonitoredRoom),_0x5d22e7=_0x3ddf41>0.65;_0x5d22e7?(timeoutMs+=0x5a*0x3c*0x3e8,_0x3e5463['log']['info']('ðŸ’¤\x20Smart\x20Sleep\x20erkannt\x20('+(_0x3ddf41*0x64)['toFixed'](0x0)+_0x453eff(0xe9)+currentMonitoredRoom+_0x453eff(0xe1)),_0x3e5463['setStateAsync']('analysis.safety.deadMan.smartSleep',{'val':!![],'ack':!![]})):_0x3e5463['setStateAsync'](_0x453eff(0xd9),{'val':![],'ack':!![]}),_0x3e5463[_0x453eff(0xcc)]('analysis.safety.deadMan.napProbability',{'val':_0x3ddf41,'ack':!![]}),_0x3e5463[_0x453eff(0xd5)][_0x453eff(0xc1)]('ðŸ‘¼\x20Schutzengel:\x20Ãœberwache\x20'+currentMonitoredRoom+_0x453eff(0xd2)+_0x506882+_0x453eff(0xbc)),_0x3e5463['setStateAsync'](_0x453eff(0xd6),{'val':'ok','ack':!![]}),activeTimer=setTimeout(()=>triggerPreWarn(_0x3e5463),timeoutMs);}function resetTimer(_0x19cc07){const _0x5c8687=a2_0x360c56;if(activeTimer)clearTimeout(activeTimer);activeTimer=null,currentMonitoredRoom=null,alarmStage=0x0,_0x19cc07['setStateAsync'](_0x5c8687(0xd6),{'val':'ok','ack':!![]}),_0x19cc07['setStateAsync'](_0x5c8687(0xd9),{'val':![],'ack':!![]}),_0x19cc07['setStateAsync']('analysis.safety.deadMan.napProbability',{'val':0x0,'ack':!![]});}async function triggerPreWarn(_0x1aea9d){const _0x4c1c79=a2_0x360c56;alarmStage=0x1,await _0x1aea9d[_0x4c1c79(0xcc)](_0x4c1c79(0xd6),{'val':_0x4c1c79(0xc6),'ack':!![]});const _0x3927a5=_0x4c1c79(0xe4)+currentMonitoredRoom+_0x4c1c79(0xd4);_0x1aea9d[_0x4c1c79(0xd5)][_0x4c1c79(0xc3)](_0x4c1c79(0xdb)+_0x3927a5),await setup[_0x4c1c79(0xce)](_0x1aea9d,_0x4c1c79(0xc9)+_0x3927a5),activeTimer=setTimeout(()=>triggerAlarm(_0x1aea9d),0x5*0x3c*0x3e8);}async function triggerAlarm(_0x1bd351){const _0x237e19=a2_0x360c56;alarmStage=0x2,await _0x1bd351['setStateAsync'](_0x237e19(0xd6),{'val':'alarm','ack':!![]});const _0x547520=_0x237e19(0xe7)+currentMonitoredRoom+'!';_0x1bd351[_0x237e19(0xd5)][_0x237e19(0xda)](_0x237e19(0xdb)+_0x547520),await setup['sendNotification'](_0x1bd351,_0x547520,![],!![]);}module['exports']={'updateLocation':updateLocation};