const a2_0x251d25=a2_0x3c14;(function(_0x44a63e,_0x54de0a){const _0x580cc5=a2_0x3c14,_0x683b1a=_0x44a63e();while(!![]){try{const _0x5c0ebb=-parseInt(_0x580cc5(0x1f9))/0x1+-parseInt(_0x580cc5(0x204))/0x2*(-parseInt(_0x580cc5(0x214))/0x3)+-parseInt(_0x580cc5(0x1f1))/0x4*(-parseInt(_0x580cc5(0x209))/0x5)+parseInt(_0x580cc5(0x20b))/0x6*(parseInt(_0x580cc5(0x210))/0x7)+parseInt(_0x580cc5(0x1f6))/0x8+parseInt(_0x580cc5(0x20d))/0x9*(parseInt(_0x580cc5(0x219))/0xa)+parseInt(_0x580cc5(0x205))/0xb*(-parseInt(_0x580cc5(0x206))/0xc);if(_0x5c0ebb===_0x54de0a)break;else _0x683b1a['push'](_0x683b1a['shift']());}catch(_0x228bf9){_0x683b1a['push'](_0x683b1a['shift']());}}}(a2_0xc793,0x8c933));const a2_0x5ee8bb=(function(){let _0x33d9ea=!![];return function(_0x38efc7,_0x4c3324){const _0x3ac43d=_0x33d9ea?function(){const _0x253429=a2_0x3c14;if(_0x4c3324){const _0x35d101=_0x4c3324[_0x253429(0x1ef)](_0x38efc7,arguments);return _0x4c3324=null,_0x35d101;}}:function(){};return _0x33d9ea=![],_0x3ac43d;};}()),a2_0x25882d=a2_0x5ee8bb(this,function(){const _0x24d1a3=a2_0x3c14;return a2_0x25882d[_0x24d1a3(0x1f5)]()[_0x24d1a3(0x20e)](_0x24d1a3(0x200))['toString']()['constructor'](a2_0x25882d)['search']('(((.+)+)+)+$');});a2_0x25882d();'use strict';function a2_0xc793(){const _0x11e181=['error','Unknown','(((.+)+)+)+$','exports','ðŸ‘¼\x20Schutzengel-Frage:\x20','getStateAsync','88716yKZJRB','2789534DZVwCQ','84ibRpwF','Ignoriere\x20Bewegung\x20in\x20\x27','parse','545TkAbat','analysis.safety.deadMan.alarmState','14214Vaglin','warn','11943MOSfzK','search','setStateAsync','3388toXMJd','\x20(Multi-Person\x20Filter)','sendNotification','\x20Min.','6qiDQfr','analysis.safety.deadMan.config','ðŸš¨\x20NOTFALL-ALARM:\x20Person\x20reagiert\x20nicht\x20in\x20','default','analysis.safety.deadMan.lastIgnored','470hIkUaQ','[DeadMan]\x20Topology\x20check\x20failed:\x20','â³\x20ACHTUNG:\x20UngewÃ¶hnlich\x20lange\x20InaktivitÃ¤t\x20in\x20','stringify','info','[DeadMan]\x20','apply','indexOf','36676ZsVCfe','now','\x20fÃ¼r\x20','includes','toString','970376nvUVYg','val','.\x20Alles\x20in\x20Ordnung?','67446BjNFpB','./setup','\x27.\x20Nicht\x20verbunden\x20mit\x20Ã¼berwachtem\x20\x27','toLowerCase','log'];a2_0xc793=function(){return _0x11e181;};return a2_0xc793();}const setup=require(a2_0x251d25(0x1fa));let activeTimer=null,currentMonitoredRoom=null,timeoutMs=0x0,startTime=0x0,alarmStage=0x0;const DEFAULT_TIMEOUTS={'bad':0x2d,'bath':0x2d,'toilet':0x1e,'wc':0x1e,'keller':0x3c};async function loadConfig(_0x5d5fce){const _0x13f065=a2_0x251d25;try{const _0x2488b0=await _0x5d5fce[_0x13f065(0x203)](_0x13f065(0x215));if(_0x2488b0&&_0x2488b0['val'])return JSON[_0x13f065(0x208)](_0x2488b0[_0x13f065(0x1f7)]);}catch(_0x283594){}return{};}async function isActive(_0x15a117){const _0x4edd72=a2_0x251d25;try{const _0x682606=await _0x15a117[_0x4edd72(0x203)]('analysis.safety.deadMan.active');return _0x682606&&_0x682606[_0x4edd72(0x1f7)];}catch(_0x41fb84){return![];}}async function areRoomsConnected(_0x9ef891,_0x55f343,_0x1c6689){const _0x2a5184=a2_0x251d25;try{const _0x22a224=await _0x9ef891[_0x2a5184(0x203)]('analysis.topology.structure');if(!_0x22a224||!_0x22a224[_0x2a5184(0x1f7)])return!![];const _0x391df0=JSON[_0x2a5184(0x208)](_0x22a224['val']),{rooms:_0x400ccc,matrix:_0x3f9c56}=_0x391df0;if(!_0x400ccc||!_0x3f9c56)return!![];const _0x5181b8=_0x400ccc['indexOf'](_0x55f343),_0x9720e=_0x400ccc[_0x2a5184(0x1f0)](_0x1c6689);if(_0x5181b8===-0x1||_0x9720e===-0x1)return!![];const _0x718249=_0x3f9c56[_0x5181b8][_0x9720e]>0x0||_0x3f9c56[_0x9720e][_0x5181b8]>0x0;return _0x718249;}catch(_0x17a6a5){return _0x9ef891['log'][_0x2a5184(0x20c)](_0x2a5184(0x21a)+_0x17a6a5['message']),!![];}}async function updateLocation(_0x526f0d,_0x5195e5){const _0xedd663=a2_0x251d25;if(!_0x5195e5||_0x5195e5===_0xedd663(0x1ff))return;if(!await isActive(_0x526f0d)){resetTimer(_0x526f0d);return;}if(currentMonitoredRoom&&currentMonitoredRoom!==_0x5195e5){const _0x476465=await areRoomsConnected(_0x526f0d,currentMonitoredRoom,_0x5195e5);if(!_0x476465){const _0x3b0c52=_0xedd663(0x207)+_0x5195e5+_0xedd663(0x1fb)+currentMonitoredRoom+'\x27.';_0x526f0d[_0xedd663(0x1fd)][_0xedd663(0x1ed)](_0xedd663(0x1ee)+_0x3b0c52+_0xedd663(0x211)),await _0x526f0d[_0xedd663(0x20f)](_0xedd663(0x218),{'val':JSON[_0xedd663(0x1ec)]({'room':_0x5195e5,'reason':_0x3b0c52,'timestamp':Date[_0xedd663(0x1f2)]()}),'ack':!![]});return;}resetTimer(_0x526f0d);}if(!currentMonitoredRoom){await _0x526f0d['setStateAsync']('analysis.safety.deadMan.currentRoom',{'val':_0x5195e5,'ack':!![]});const _0x5b3443=await loadConfig(_0x526f0d),_0x314db6=_0x5195e5[_0xedd663(0x1fc)]();let _0x205d46=_0x5b3443[_0x5195e5]||_0x5b3443[_0x314db6];if(!_0x205d46)for(const _0x57c063 in DEFAULT_TIMEOUTS){if(_0x314db6[_0xedd663(0x1f4)](_0x57c063)){_0x205d46=DEFAULT_TIMEOUTS[_0x57c063];break;}}if(!_0x205d46&&_0x5b3443[_0xedd663(0x217)])_0x205d46=_0x5b3443[_0xedd663(0x217)];if(!_0x205d46)return;currentMonitoredRoom=_0x5195e5,startTimer(_0x526f0d,_0x205d46);}}function a2_0x3c14(_0x636e93,_0x5e7d11){const _0x5e4472=a2_0xc793();return a2_0x3c14=function(_0x25882d,_0x5ee8bb){_0x25882d=_0x25882d-0x1ec;let _0xc79374=_0x5e4472[_0x25882d];return _0xc79374;},a2_0x3c14(_0x636e93,_0x5e7d11);}function startTimer(_0x486872,_0x37c342){const _0x114586=a2_0x251d25;if(activeTimer)clearTimeout(activeTimer);timeoutMs=_0x37c342*0x3c*0x3e8,startTime=Date['now'](),alarmStage=0x0,_0x486872[_0x114586(0x1fd)][_0x114586(0x1ed)]('ðŸ‘¼\x20Schutzengel:\x20Ãœberwache\x20'+currentMonitoredRoom+_0x114586(0x1f3)+_0x37c342+_0x114586(0x213)),_0x486872[_0x114586(0x20f)](_0x114586(0x20a),{'val':'ok','ack':!![]}),activeTimer=setTimeout(()=>triggerPreWarn(_0x486872),timeoutMs);}function resetTimer(_0x2cfb21){const _0x5c6ba1=a2_0x251d25;if(activeTimer)clearTimeout(activeTimer);activeTimer=null,currentMonitoredRoom=null,alarmStage=0x0,_0x2cfb21[_0x5c6ba1(0x20f)](_0x5c6ba1(0x20a),{'val':'ok','ack':!![]});}async function triggerPreWarn(_0x1e9927){const _0x19a8c6=a2_0x251d25;alarmStage=0x1,await _0x1e9927[_0x19a8c6(0x20f)](_0x19a8c6(0x20a),{'val':'pre_warn','ack':!![]});const _0x216582=_0x19a8c6(0x21b)+currentMonitoredRoom+_0x19a8c6(0x1f8);_0x1e9927[_0x19a8c6(0x1fd)]['warn'](_0x19a8c6(0x1ee)+_0x216582),await setup[_0x19a8c6(0x212)](_0x1e9927,_0x19a8c6(0x202)+_0x216582),activeTimer=setTimeout(()=>triggerAlarm(_0x1e9927),0x5*0x3c*0x3e8);}async function triggerAlarm(_0x2934b9){const _0x4075c6=a2_0x251d25;alarmStage=0x2,await _0x2934b9[_0x4075c6(0x20f)](_0x4075c6(0x20a),{'val':'alarm','ack':!![]});const _0x520bc5=_0x4075c6(0x216)+currentMonitoredRoom+'!';_0x2934b9[_0x4075c6(0x1fd)][_0x4075c6(0x1fe)](_0x4075c6(0x1ee)+_0x520bc5),await setup[_0x4075c6(0x212)](_0x2934b9,_0x520bc5,![],!![]);}module[a2_0x251d25(0x201)]={'updateLocation':updateLocation};