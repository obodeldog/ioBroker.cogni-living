const a2_0x2be027=a2_0x5ac7;(function(_0x5cfba8,_0x45271f){const _0x4bb3f5=a2_0x5ac7,_0xabe255=_0x5cfba8();while(!![]){try{const _0xa211bb=parseInt(_0x4bb3f5(0xe2))/0x1+-parseInt(_0x4bb3f5(0xe0))/0x2*(-parseInt(_0x4bb3f5(0xcc))/0x3)+parseInt(_0x4bb3f5(0xc5))/0x4*(parseInt(_0x4bb3f5(0xe3))/0x5)+parseInt(_0x4bb3f5(0xdd))/0x6*(parseInt(_0x4bb3f5(0xcb))/0x7)+parseInt(_0x4bb3f5(0xe5))/0x8+-parseInt(_0x4bb3f5(0xda))/0x9+parseInt(_0x4bb3f5(0xbf))/0xa*(-parseInt(_0x4bb3f5(0xd5))/0xb);if(_0xa211bb===_0x45271f)break;else _0xabe255['push'](_0xabe255['shift']());}catch(_0x5ae30b){_0xabe255['push'](_0xabe255['shift']());}}}(a2_0x3d59,0x1cc2a));const a2_0x4b4dc6=(function(){let _0x3d4ff0=!![];return function(_0x40ddb5,_0x1e8fc1){const _0x12bb6c=_0x3d4ff0?function(){if(_0x1e8fc1){const _0x2e6d4d=_0x1e8fc1['apply'](_0x40ddb5,arguments);return _0x1e8fc1=null,_0x2e6d4d;}}:function(){};return _0x3d4ff0=![],_0x12bb6c;};}()),a2_0x20f6a8=a2_0x4b4dc6(this,function(){const _0x27e44b=a2_0x5ac7;return a2_0x20f6a8[_0x27e44b(0xd0)]()[_0x27e44b(0xd7)](_0x27e44b(0xc0))[_0x27e44b(0xd0)]()[_0x27e44b(0xe6)](a2_0x20f6a8)[_0x27e44b(0xd7)](_0x27e44b(0xc0));});a2_0x20f6a8();'use strict';const setup=require('./setup');let activeTimer=null,currentMonitoredRoom=null,timeoutMs=0x0,startTime=0x0,alarmStage=0x0;const DEFAULT_TIMEOUTS={'bad':0x2d,'bath':0x2d,'toilet':0x1e,'wc':0x1e,'keller':0x3c};async function loadConfig(_0x1c5309){const _0x12b1ee=a2_0x5ac7;try{const _0x29cb53=await _0x1c5309[_0x12b1ee(0xd1)](_0x12b1ee(0xdf));if(_0x29cb53&&_0x29cb53[_0x12b1ee(0xde)])return JSON['parse'](_0x29cb53['val']);}catch(_0x12c41c){}return{};}async function isActive(_0x5f1685){const _0x2d6530=a2_0x5ac7;try{const _0x480e69=await _0x5f1685['getStateAsync'](_0x2d6530(0xc1));return _0x480e69&&_0x480e69[_0x2d6530(0xde)];}catch(_0x243af0){return![];}}async function areRoomsConnected(_0x58c93d,_0x257d21,_0x5732ce){const _0x188cb9=a2_0x5ac7;try{const _0x37a124=await _0x58c93d[_0x188cb9(0xd1)](_0x188cb9(0xe1));if(!_0x37a124||!_0x37a124[_0x188cb9(0xde)])return!![];const _0xeeaa86=JSON['parse'](_0x37a124['val']),{rooms:_0x521b04,matrix:_0x43a3d7}=_0xeeaa86;if(!_0x521b04||!_0x43a3d7)return!![];const _0x56ea32=_0x521b04[_0x188cb9(0xbc)](_0x257d21),_0x34a159=_0x521b04[_0x188cb9(0xbc)](_0x5732ce);if(_0x56ea32===-0x1||_0x34a159===-0x1)return!![];const _0x3ec3d3=_0x43a3d7[_0x56ea32][_0x34a159]>0x0||_0x43a3d7[_0x34a159][_0x56ea32]>0x0;return _0x3ec3d3;}catch(_0x3257b3){return _0x58c93d[_0x188cb9(0xbb)][_0x188cb9(0xdc)](_0x188cb9(0xd6)+_0x3257b3[_0x188cb9(0xd2)]),!![];}}async function updateLocation(_0x398b36,_0x2b3f5c){const _0x2d3eeb=a2_0x5ac7;if(!_0x2b3f5c||_0x2b3f5c===_0x2d3eeb(0xd8))return;if(!await isActive(_0x398b36)){resetTimer(_0x398b36);return;}if(currentMonitoredRoom&&currentMonitoredRoom!==_0x2b3f5c){const _0x1e4f09=await areRoomsConnected(_0x398b36,currentMonitoredRoom,_0x2b3f5c);if(!_0x1e4f09){const _0x25a8f6=_0x2d3eeb(0xd9)+_0x2b3f5c+_0x2d3eeb(0xd3)+currentMonitoredRoom+'\x27.';_0x398b36[_0x2d3eeb(0xbb)][_0x2d3eeb(0xdb)](_0x2d3eeb(0xe4)+_0x25a8f6+'\x20(Multi-Person\x20Filter)'),await _0x398b36[_0x2d3eeb(0xc8)]('analysis.safety.deadMan.lastIgnored',{'val':JSON[_0x2d3eeb(0xc4)]({'room':_0x2b3f5c,'reason':_0x25a8f6,'timestamp':Date[_0x2d3eeb(0xca)]()}),'ack':!![]});return;}resetTimer(_0x398b36);}if(!currentMonitoredRoom){await _0x398b36[_0x2d3eeb(0xc8)](_0x2d3eeb(0xce),{'val':_0x2b3f5c,'ack':!![]});const _0x5e5062=await loadConfig(_0x398b36),_0x257efd=_0x2b3f5c['toLowerCase']();let _0x3c3094=_0x5e5062[_0x2b3f5c]||_0x5e5062[_0x257efd];if(!_0x3c3094)for(const _0x30041a in DEFAULT_TIMEOUTS){if(_0x257efd[_0x2d3eeb(0xd4)](_0x30041a)){_0x3c3094=DEFAULT_TIMEOUTS[_0x30041a];break;}}if(!_0x3c3094&&_0x5e5062[_0x2d3eeb(0xe7)])_0x3c3094=_0x5e5062[_0x2d3eeb(0xe7)];if(!_0x3c3094)return;currentMonitoredRoom=_0x2b3f5c,startTimer(_0x398b36,_0x3c3094);}}function startTimer(_0x48489a,_0x21d3f6){const _0x2575b7=a2_0x5ac7;if(activeTimer)clearTimeout(activeTimer);timeoutMs=_0x21d3f6*0x3c*0x3e8,startTime=Date[_0x2575b7(0xca)](),alarmStage=0x0,_0x48489a[_0x2575b7(0xbb)][_0x2575b7(0xdb)]('ðŸ‘¼\x20Schutzengel:\x20Ãœberwache\x20'+currentMonitoredRoom+_0x2575b7(0xbd)+_0x21d3f6+_0x2575b7(0xc3)),_0x48489a[_0x2575b7(0xc8)]('analysis.safety.deadMan.alarmState',{'val':'ok','ack':!![]}),activeTimer=setTimeout(()=>triggerPreWarn(_0x48489a),timeoutMs);}function resetTimer(_0x575fcb){const _0x2dfde1=a2_0x5ac7;if(activeTimer)clearTimeout(activeTimer);activeTimer=null,currentMonitoredRoom=null,alarmStage=0x0,_0x575fcb[_0x2dfde1(0xc8)](_0x2dfde1(0xcd),{'val':'ok','ack':!![]});}async function triggerPreWarn(_0xf407c){const _0x74150c=a2_0x5ac7;alarmStage=0x1,await _0xf407c[_0x74150c(0xc8)](_0x74150c(0xcd),{'val':'pre_warn','ack':!![]});const _0x176e8f='â³\x20ACHTUNG:\x20UngewÃ¶hnlich\x20lange\x20InaktivitÃ¤t\x20in\x20'+currentMonitoredRoom+_0x74150c(0xc2);_0xf407c[_0x74150c(0xbb)]['warn'](_0x74150c(0xe4)+_0x176e8f),await setup['sendNotification'](_0xf407c,_0x74150c(0xc9)+_0x176e8f),activeTimer=setTimeout(()=>triggerAlarm(_0xf407c),0x5*0x3c*0x3e8);}async function triggerAlarm(_0x598cba){const _0x3903da=a2_0x5ac7;alarmStage=0x2,await _0x598cba[_0x3903da(0xc8)]('analysis.safety.deadMan.alarmState',{'val':'alarm','ack':!![]});const _0x133264=_0x3903da(0xc7)+currentMonitoredRoom+'!';_0x598cba[_0x3903da(0xbb)][_0x3903da(0xcf)](_0x3903da(0xe4)+_0x133264),await setup[_0x3903da(0xbe)](_0x598cba,_0x133264,![],!![]);}function a2_0x5ac7(_0x5a32fe,_0x173256){const _0x14ba4d=a2_0x3d59();return a2_0x5ac7=function(_0x20f6a8,_0x4b4dc6){_0x20f6a8=_0x20f6a8-0xbb;let _0x3d59fe=_0x14ba4d[_0x20f6a8];return _0x3d59fe;},a2_0x5ac7(_0x5a32fe,_0x173256);}module[a2_0x2be027(0xc6)]={'updateLocation':updateLocation};function a2_0x3d59(){const _0x3fe84c=['[DeadMan]\x20','1111920ohTsYl','constructor','default','log','indexOf','\x20fÃ¼r\x20','sendNotification','10FWmCUv','(((.+)+)+)+$','analysis.safety.deadMan.active','.\x20Alles\x20in\x20Ordnung?','\x20Min.','stringify','99664TIMaDJ','exports','ðŸš¨\x20NOTFALL-ALARM:\x20Person\x20reagiert\x20nicht\x20in\x20','setStateAsync','ðŸ‘¼\x20Schutzengel-Frage:\x20','now','42OGNdjX','35133NccFbf','analysis.safety.deadMan.alarmState','analysis.safety.deadMan.currentRoom','error','toString','getStateAsync','message','\x27.\x20Nicht\x20verbunden\x20mit\x20Ã¼berwachtem\x20\x27','includes','6397127HhDWgo','[DeadMan]\x20Topology\x20check\x20failed:\x20','search','Unknown','Ignoriere\x20Bewegung\x20in\x20\x27','214749rTDIDg','info','warn','123882KmmFSv','val','analysis.safety.deadMan.config','22SoyNYJ','analysis.topology.structure','231863eRmBEl','20xKuNFp'];a2_0x3d59=function(){return _0x3fe84c;};return a2_0x3d59();}