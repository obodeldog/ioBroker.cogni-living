const a2_0x108a79=a2_0x18b1;(function(_0x5a9d04,_0xdc1163){const _0x2123e6=a2_0x18b1,_0x2d7cc2=_0x5a9d04();while(!![]){try{const _0x2881b3=parseInt(_0x2123e6(0x1ff))/0x1+parseInt(_0x2123e6(0x211))/0x2+parseInt(_0x2123e6(0x1f9))/0x3+parseInt(_0x2123e6(0x215))/0x4+-parseInt(_0x2123e6(0x228))/0x5+parseInt(_0x2123e6(0x21e))/0x6*(-parseInt(_0x2123e6(0x213))/0x7)+-parseInt(_0x2123e6(0x206))/0x8*(parseInt(_0x2123e6(0x225))/0x9);if(_0x2881b3===_0xdc1163)break;else _0x2d7cc2['push'](_0x2d7cc2['shift']());}catch(_0xfb28ac){_0x2d7cc2['push'](_0x2d7cc2['shift']());}}}(a2_0x3474,0x8ae92));const a2_0x227084=(function(){let _0x37d2e1=!![];return function(_0x2411db,_0x468138){const _0x57a6ce=_0x37d2e1?function(){if(_0x468138){const _0x1b57f2=_0x468138['apply'](_0x2411db,arguments);return _0x468138=null,_0x1b57f2;}}:function(){};return _0x37d2e1=![],_0x57a6ce;};}()),a2_0x465463=a2_0x227084(this,function(){const _0x2a2806=a2_0x18b1;return a2_0x465463['toString']()[_0x2a2806(0x209)]('(((.+)+)+)+$')[_0x2a2806(0x21b)]()['constructor'](a2_0x465463)['search'](_0x2a2806(0x20d));});a2_0x465463();'use strict';const setup=require(a2_0x108a79(0x214));function a2_0x3474(){const _0x424038=['includes','.\x20Alles\x20in\x20Ordnung?','ðŸ‘¼\x20Schutzengel-Frage:\x20','info','getStateAsync','â³\x20ACHTUNG:\x20UngewÃ¶hnlich\x20lange\x20InaktivitÃ¤t\x20in\x20','20528XvbUQW','analysis.safety.deadMan.currentRoom','toFixed','search','ðŸ‘¼\x20Schutzengel:\x20Ãœberwache\x20','analysis.safety.deadMan.alarmState','toLowerCase','(((.+)+)+)+$','[DeadMan]\x20','analysis.safety.deadMan.lastIgnored','ðŸš¨\x20NOTFALL-ALARM:\x20Person\x20reagiert\x20nicht\x20in\x20','1913904YuQfHY','message','7JlyEev','./setup','2881560JsDoGF','\x20um\x2090\x20Min.','setStateAsync','warn','\x27.\x20Nicht\x20verbunden\x20mit\x20Ã¼berwachtem\x20\x27','sofa','toString','sendNotification','exports','6278598XMNtDP','error','bad','analysis.topology.structure','alarm','val','analysis.safety.deadMan.smartSleep','2241wlktjs','parse','now','2260770iUUhIB','Ignoriere\x20Bewegung\x20in\x20\x27','wohn','indexOf','living','getHours','analysis.safety.deadMan.active','ðŸ’¤\x20Smart\x20Sleep\x20erkannt\x20(','analysis.safety.deadMan.napProbability','analysis.safety.deadMan.config','\x20(Multi-Person\x20Filter)','442902ARpPMq','default','pre_warn','stringify','log','%).\x20VerlÃ¤ngere\x20Timer\x20fÃ¼r\x20','881523mdnmlO'];a2_0x3474=function(){return _0x424038;};return a2_0x3474();}let activeTimer=null,currentMonitoredRoom=null,timeoutMs=0x0,startTime=0x0,alarmStage=0x0;const DEFAULT_TIMEOUTS={'bad':0x2d,'bath':0x2d,'toilet':0x1e,'wc':0x1e,'keller':0x3c,'schlaf':0x78,'bed':0x78,'guest':0x5a,'gast':0x5a};async function loadConfig(_0x2fa60c){const _0x5592f6=a2_0x108a79;try{const _0x5b1adc=await _0x2fa60c['getStateAsync'](_0x5592f6(0x1f7));if(_0x5b1adc&&_0x5b1adc[_0x5592f6(0x223)])return JSON[_0x5592f6(0x226)](_0x5b1adc[_0x5592f6(0x223)]);}catch(_0x11e08c){}return{};}async function isActive(_0x23648e){const _0x1b2317=a2_0x108a79;try{const _0x2ee773=await _0x23648e[_0x1b2317(0x204)](_0x1b2317(0x1f4));return _0x2ee773&&_0x2ee773['val'];}catch(_0x1a3eff){return![];}}async function areRoomsConnected(_0x5555aa,_0x5e2b3a,_0x325456){const _0x1fe659=a2_0x108a79;try{const _0x1a0a99=await _0x5555aa[_0x1fe659(0x204)](_0x1fe659(0x221));if(!_0x1a0a99||!_0x1a0a99[_0x1fe659(0x223)])return!![];const _0x253547=JSON['parse'](_0x1a0a99[_0x1fe659(0x223)]),{rooms:_0x2adbaa,matrix:_0x38ece8}=_0x253547;if(!_0x2adbaa||!_0x38ece8)return!![];const _0x539c65=_0x2adbaa[_0x1fe659(0x1f1)](_0x5e2b3a),_0x11c056=_0x2adbaa['indexOf'](_0x325456);if(_0x539c65===-0x1||_0x11c056===-0x1)return!![];const _0x358031=_0x38ece8[_0x539c65][_0x11c056]>0x0||_0x38ece8[_0x11c056][_0x539c65]>0x0;return _0x358031;}catch(_0x2e1950){return _0x5555aa[_0x1fe659(0x1fd)][_0x1fe659(0x218)]('[DeadMan]\x20Topology\x20check\x20failed:\x20'+_0x2e1950[_0x1fe659(0x212)]),!![];}}function a2_0x18b1(_0x1d68ea,_0x2db56a){const _0x51c481=a2_0x3474();return a2_0x18b1=function(_0x465463,_0x227084){_0x465463=_0x465463-0x1f0;let _0x3474f3=_0x51c481[_0x465463];return _0x3474f3;},a2_0x18b1(_0x1d68ea,_0x2db56a);}function calculateSleepProbability(_0x45f1ca){const _0x305016=a2_0x108a79,_0x60b9ab=new Date(),_0x592633=_0x60b9ab[_0x305016(0x1f3)](),_0x8756fb=_0x45f1ca[_0x305016(0x20c)]();let _0x4f633b=0.1;if(_0x592633>=0x17||_0x592633<=0x6)_0x4f633b=0x1;else{if(_0x592633>=0xd&&_0x592633<=0xf)_0x4f633b=0.8;else{if(_0x592633>=0x14&&_0x592633<=0x17)_0x4f633b=0.4;}}let _0x18ec5e=0.1;if(_0x8756fb[_0x305016(0x200)]('schlaf')||_0x8756fb[_0x305016(0x200)]('bed'))_0x18ec5e=0x1;else{if(_0x8756fb['includes'](_0x305016(0x1f0))||_0x8756fb[_0x305016(0x200)](_0x305016(0x1f2))||_0x8756fb[_0x305016(0x200)](_0x305016(0x21a)))_0x18ec5e=0.6;else{if(_0x8756fb[_0x305016(0x200)](_0x305016(0x220))||_0x8756fb[_0x305016(0x200)]('wc'))_0x18ec5e=0.05;}}let _0x3d118e=0.5;const _0x171768=_0x18ec5e*0.5+_0x4f633b*0.3+_0x3d118e*0.2;return parseFloat(_0x171768[_0x305016(0x208)](0x2));}async function updateLocation(_0x29bd56,_0x104082){const _0x5f0aa2=a2_0x108a79;if(!_0x104082||_0x104082==='Unknown')return;if(!await isActive(_0x29bd56)){resetTimer(_0x29bd56);return;}if(currentMonitoredRoom&&currentMonitoredRoom!==_0x104082){const _0x3ab10e=await areRoomsConnected(_0x29bd56,currentMonitoredRoom,_0x104082);if(!_0x3ab10e){const _0x572b04=_0x5f0aa2(0x229)+_0x104082+_0x5f0aa2(0x219)+currentMonitoredRoom+'\x27.';_0x29bd56[_0x5f0aa2(0x1fd)][_0x5f0aa2(0x203)](_0x5f0aa2(0x20e)+_0x572b04+_0x5f0aa2(0x1f8)),await _0x29bd56[_0x5f0aa2(0x217)](_0x5f0aa2(0x20f),{'val':JSON[_0x5f0aa2(0x1fc)]({'room':_0x104082,'reason':_0x572b04,'timestamp':Date[_0x5f0aa2(0x227)]()}),'ack':!![]});return;}resetTimer(_0x29bd56);}if(!currentMonitoredRoom){await _0x29bd56[_0x5f0aa2(0x217)](_0x5f0aa2(0x207),{'val':_0x104082,'ack':!![]});const _0xc6460d=await loadConfig(_0x29bd56),_0x45a11f=_0x104082[_0x5f0aa2(0x20c)]();let _0x1e214d=_0xc6460d[_0x104082]||_0xc6460d[_0x45a11f];if(!_0x1e214d)for(const _0x4524b9 in DEFAULT_TIMEOUTS){if(_0x45a11f[_0x5f0aa2(0x200)](_0x4524b9)){_0x1e214d=DEFAULT_TIMEOUTS[_0x4524b9];break;}}if(!_0x1e214d&&_0xc6460d['default'])_0x1e214d=_0xc6460d[_0x5f0aa2(0x1fa)];if(!_0x1e214d)return;currentMonitoredRoom=_0x104082,startTimer(_0x29bd56,_0x1e214d,_0x104082);}}function startTimer(_0x166cc5,_0x4ee1c7,_0x120cfa){const _0x4fda88=a2_0x108a79;if(activeTimer)clearTimeout(activeTimer);timeoutMs=_0x4ee1c7*0x3c*0x3e8,startTime=Date['now'](),alarmStage=0x0;const _0x7c4a4c=calculateSleepProbability(_0x120cfa||currentMonitoredRoom),_0x5941ed=_0x7c4a4c>0.65;_0x5941ed?(timeoutMs+=0x5a*0x3c*0x3e8,_0x166cc5[_0x4fda88(0x1fd)]['info'](_0x4fda88(0x1f5)+(_0x7c4a4c*0x64)[_0x4fda88(0x208)](0x0)+_0x4fda88(0x1fe)+currentMonitoredRoom+_0x4fda88(0x216)),_0x166cc5[_0x4fda88(0x217)](_0x4fda88(0x224),{'val':!![],'ack':!![]})):_0x166cc5[_0x4fda88(0x217)](_0x4fda88(0x224),{'val':![],'ack':!![]}),_0x166cc5['setStateAsync'](_0x4fda88(0x1f6),{'val':_0x7c4a4c,'ack':!![]}),_0x166cc5[_0x4fda88(0x1fd)]['info'](_0x4fda88(0x20a)+currentMonitoredRoom+'\x20fÃ¼r\x20'+_0x4ee1c7+'\x20Min.'),_0x166cc5[_0x4fda88(0x217)](_0x4fda88(0x20b),{'val':'ok','ack':!![]}),activeTimer=setTimeout(()=>triggerPreWarn(_0x166cc5),timeoutMs);}function resetTimer(_0x3cb709){const _0x53e4e3=a2_0x108a79;if(activeTimer)clearTimeout(activeTimer);activeTimer=null,currentMonitoredRoom=null,alarmStage=0x0,_0x3cb709[_0x53e4e3(0x217)](_0x53e4e3(0x20b),{'val':'ok','ack':!![]}),_0x3cb709['setStateAsync']('analysis.safety.deadMan.smartSleep',{'val':![],'ack':!![]}),_0x3cb709['setStateAsync'](_0x53e4e3(0x1f6),{'val':0x0,'ack':!![]});}async function triggerPreWarn(_0x1f8892){const _0x1fdbef=a2_0x108a79;alarmStage=0x1,await _0x1f8892[_0x1fdbef(0x217)](_0x1fdbef(0x20b),{'val':_0x1fdbef(0x1fb),'ack':!![]});const _0x1aee82=_0x1fdbef(0x205)+currentMonitoredRoom+_0x1fdbef(0x201);_0x1f8892['log'][_0x1fdbef(0x218)]('[DeadMan]\x20'+_0x1aee82),await setup['sendNotification'](_0x1f8892,_0x1fdbef(0x202)+_0x1aee82),activeTimer=setTimeout(()=>triggerAlarm(_0x1f8892),0x5*0x3c*0x3e8);}async function triggerAlarm(_0x422c2b){const _0x36354f=a2_0x108a79;alarmStage=0x2,await _0x422c2b[_0x36354f(0x217)](_0x36354f(0x20b),{'val':_0x36354f(0x222),'ack':!![]});const _0x2099e3=_0x36354f(0x210)+currentMonitoredRoom+'!';_0x422c2b[_0x36354f(0x1fd)][_0x36354f(0x21f)](_0x36354f(0x20e)+_0x2099e3),await setup[_0x36354f(0x21c)](_0x422c2b,_0x2099e3,![],!![]);}module[a2_0x108a79(0x21d)]={'updateLocation':updateLocation};