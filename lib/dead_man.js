const a2_0x385541=a2_0x1c85;(function(_0x1d79bc,_0x16be58){const _0x3e87c3=a2_0x1c85,_0x5954c3=_0x1d79bc();while(!![]){try{const _0x5eb700=-parseInt(_0x3e87c3(0xfa))/0x1+-parseInt(_0x3e87c3(0x112))/0x2*(parseInt(_0x3e87c3(0x116))/0x3)+parseInt(_0x3e87c3(0xf5))/0x4*(parseInt(_0x3e87c3(0xf9))/0x5)+-parseInt(_0x3e87c3(0xf7))/0x6*(-parseInt(_0x3e87c3(0x103))/0x7)+parseInt(_0x3e87c3(0xfb))/0x8+-parseInt(_0x3e87c3(0xf1))/0x9*(-parseInt(_0x3e87c3(0xfc))/0xa)+parseInt(_0x3e87c3(0x119))/0xb*(-parseInt(_0x3e87c3(0x109))/0xc);if(_0x5eb700===_0x16be58)break;else _0x5954c3['push'](_0x5954c3['shift']());}catch(_0x2424c9){_0x5954c3['push'](_0x5954c3['shift']());}}}(a2_0x1829,0x7d677));const a2_0x435c55=(function(){let _0x37b1c0=!![];return function(_0x4ac754,_0x170d1c){const _0x31266e=_0x37b1c0?function(){const _0x181f07=a2_0x1c85;if(_0x170d1c){const _0x60848=_0x170d1c[_0x181f07(0x10f)](_0x4ac754,arguments);return _0x170d1c=null,_0x60848;}}:function(){};return _0x37b1c0=![],_0x31266e;};}()),a2_0x79d1a7=a2_0x435c55(this,function(){const _0x427623=a2_0x1c85;return a2_0x79d1a7['toString']()[_0x427623(0xeb)]('(((.+)+)+)+$')['toString']()['constructor'](a2_0x79d1a7)[_0x427623(0xeb)](_0x427623(0x117));});a2_0x79d1a7();'use strict';const setup=require('./setup');let activeTimer=null,currentMonitoredRoom=null,timeoutMs=0x0,startTime=0x0,alarmStage=0x0;const DEFAULT_TIMEOUTS={'bad':0x2d,'bath':0x2d,'toilet':0x1e,'wc':0x1e,'keller':0x3c,'schlaf':0x78,'bed':0x78,'guest':0x5a,'gast':0x5a};function getTimeoutRobust(_0xbebf1,_0x30345f){const _0x1b3861=a2_0x1c85;if(!_0xbebf1||!_0x30345f)return undefined;if(_0xbebf1[_0x30345f])return _0xbebf1[_0x30345f];const _0x3fc2d3=_0x30345f[_0x1b3861(0xf4)]()['replace'](/[^a-z0-9]/g,'');for(const _0x4d0062 in _0xbebf1){const _0x5ed171=_0x4d0062[_0x1b3861(0xf4)]()[_0x1b3861(0x121)](/[^a-z0-9]/g,'');if(_0x5ed171===_0x3fc2d3)return _0xbebf1[_0x4d0062];}const _0x33130f=_0x30345f['toLowerCase']();if(_0xbebf1[_0x33130f])return _0xbebf1[_0x33130f];return undefined;}async function loadConfig(_0x5509f4){const _0x3d1c66=a2_0x1c85;try{const _0x577590=await _0x5509f4[_0x3d1c66(0x108)]('analysis.safety.deadMan.config');if(_0x577590&&_0x577590['val'])return JSON[_0x3d1c66(0x11c)](_0x577590[_0x3d1c66(0xf0)]);}catch(_0x1f8a60){}return{};}async function isActive(_0x42290c){const _0x26ce5a=a2_0x1c85;try{const _0x5d79e5=await _0x42290c[_0x26ce5a(0x108)](_0x26ce5a(0x102));return _0x5d79e5&&_0x5d79e5['val'];}catch(_0x3e7ba5){return![];}}function a2_0x1829(){const _0x423367=['search','setStateAsync','analysis.safety.deadMan.smartSleep','bed','alarm','val','252txSbWC','info','sofa','toLowerCase','795152TKhJeH','default','47454XpoUJT','Unknown','20jlmbWY','638136rIeFer','6572096LYPcjc','246520bPbxuN','pre_warn','%).\x20VerlÃ¤ngere\x20Timer\x20fÃ¼r\x20','toFixed','ðŸš¨\x20NOTFALL-ALARM:\x20Person\x20reagiert\x20nicht\x20in\x20','warn','analysis.safety.deadMan.active','322atARws','sendNotification','ðŸ‘¼\x20Schutzengel-Frage:\x20','schlaf','includes','getStateAsync','8114796DivcPR','bad','Ignoriere\x20Bewegung\x20in\x20\x27','\x20(Multi-Person\x20Filter)','log','error','apply','analysis.safety.deadMan.alarmState','now','2068NELRuG','â³\x20ACHTUNG:\x20UngewÃ¶hnlich\x20lange\x20InaktivitÃ¤t\x20in\x20','[DeadMan]\x20','analysis.safety.deadMan.currentRoom','2445hPozes','(((.+)+)+)+$','exports','11gdlYfG','analysis.safety.deadMan.napProbability','indexOf','parse','\x27.\x20Nicht\x20verbunden\x20mit\x20Ã¼berwachtem\x20\x27','ðŸ’¤\x20Smart\x20Sleep\x20erkannt\x20(','analysis.safety.deadMan.lastIgnored','living','replace','[DeadMan]\x20Topology\x20check\x20failed:\x20'];a2_0x1829=function(){return _0x423367;};return a2_0x1829();}async function areRoomsConnected(_0x7e51d2,_0x252cb4,_0xa6bec0){const _0x3581e8=a2_0x1c85;try{const _0x16cbad=await _0x7e51d2[_0x3581e8(0x108)]('analysis.topology.structure');if(!_0x16cbad||!_0x16cbad['val'])return!![];const _0x2bf183=JSON['parse'](_0x16cbad['val']),{rooms:_0x237ed2,matrix:_0x15c8c3}=_0x2bf183;if(!_0x237ed2||!_0x15c8c3)return!![];const _0x148dc6=_0x237ed2[_0x3581e8(0x11b)](_0x252cb4),_0x2beec4=_0x237ed2[_0x3581e8(0x11b)](_0xa6bec0);if(_0x148dc6===-0x1||_0x2beec4===-0x1)return!![];const _0x132f0f=_0x15c8c3[_0x148dc6][_0x2beec4]>0x0||_0x15c8c3[_0x2beec4][_0x148dc6]>0x0;return _0x132f0f;}catch(_0x574dca){return _0x7e51d2[_0x3581e8(0x10d)]['warn'](_0x3581e8(0xea)+_0x574dca['message']),!![];}}function calculateSleepProbability(_0x2c95a4){const _0x1d9225=a2_0x1c85,_0x5c27e9=new Date(),_0x12b868=_0x5c27e9['getHours'](),_0x3cd322=_0x2c95a4[_0x1d9225(0xf4)]();let _0x52be2e=0.1;if(_0x12b868>=0x17||_0x12b868<=0x6)_0x52be2e=0x1;else{if(_0x12b868>=0xd&&_0x12b868<=0xf)_0x52be2e=0.8;else{if(_0x12b868>=0x14&&_0x12b868<=0x17)_0x52be2e=0.4;}}let _0x32b8b3=0.1;if(_0x3cd322[_0x1d9225(0x107)](_0x1d9225(0x106))||_0x3cd322[_0x1d9225(0x107)](_0x1d9225(0xee)))_0x32b8b3=0x1;else{if(_0x3cd322['includes']('wohn')||_0x3cd322[_0x1d9225(0x107)](_0x1d9225(0x120))||_0x3cd322[_0x1d9225(0x107)](_0x1d9225(0xf3)))_0x32b8b3=0.6;else{if(_0x3cd322[_0x1d9225(0x107)](_0x1d9225(0x10a))||_0x3cd322[_0x1d9225(0x107)]('wc'))_0x32b8b3=0.05;}}let _0x477a0b=0.5;const _0xd9963=_0x32b8b3*0.5+_0x52be2e*0.3+_0x477a0b*0.2;return parseFloat(_0xd9963[_0x1d9225(0xff)](0x2));}async function updateLocation(_0x26f5b6,_0x11fbb3){const _0x5364bc=a2_0x1c85;if(!_0x11fbb3||_0x11fbb3===_0x5364bc(0xf8))return;if(!await isActive(_0x26f5b6)){resetTimer(_0x26f5b6);return;}if(currentMonitoredRoom&&currentMonitoredRoom!==_0x11fbb3){const _0x5e0ffc=await areRoomsConnected(_0x26f5b6,currentMonitoredRoom,_0x11fbb3);if(!_0x5e0ffc){const _0x3c3534=_0x5364bc(0x10b)+_0x11fbb3+_0x5364bc(0x11d)+currentMonitoredRoom+'\x27.';_0x26f5b6[_0x5364bc(0x10d)][_0x5364bc(0xf2)](_0x5364bc(0x114)+_0x3c3534+_0x5364bc(0x10c)),await _0x26f5b6[_0x5364bc(0xec)](_0x5364bc(0x11f),{'val':JSON['stringify']({'room':_0x11fbb3,'reason':_0x3c3534,'timestamp':Date[_0x5364bc(0x111)]()}),'ack':!![]});return;}resetTimer(_0x26f5b6);}if(!currentMonitoredRoom){await _0x26f5b6[_0x5364bc(0xec)](_0x5364bc(0x115),{'val':_0x11fbb3,'ack':!![]});const _0x733bc8=await loadConfig(_0x26f5b6);let _0x449d34=getTimeoutRobust(_0x733bc8,_0x11fbb3);const _0x26947f=_0x11fbb3[_0x5364bc(0xf4)]();if(!_0x449d34)for(const _0x31485a in DEFAULT_TIMEOUTS){if(_0x26947f[_0x5364bc(0x107)](_0x31485a)){_0x449d34=DEFAULT_TIMEOUTS[_0x31485a];break;}}if(!_0x449d34&&_0x733bc8[_0x5364bc(0xf6)])_0x449d34=_0x733bc8[_0x5364bc(0xf6)];if(!_0x449d34)return;currentMonitoredRoom=_0x11fbb3,startTimer(_0x26f5b6,_0x449d34,_0x11fbb3);}}function startTimer(_0x5e623b,_0x1f0dec,_0x19845c){const _0x240321=a2_0x1c85;if(activeTimer)clearTimeout(activeTimer);timeoutMs=_0x1f0dec*0x3c*0x3e8,startTime=Date[_0x240321(0x111)](),alarmStage=0x0;const _0x3a0113=calculateSleepProbability(_0x19845c||currentMonitoredRoom),_0x3ab3f1=_0x3a0113>0.65;_0x3ab3f1?(timeoutMs+=0x5a*0x3c*0x3e8,_0x5e623b[_0x240321(0x10d)][_0x240321(0xf2)](_0x240321(0x11e)+(_0x3a0113*0x64)['toFixed'](0x0)+_0x240321(0xfe)+currentMonitoredRoom+'\x20um\x2090\x20Min.'),_0x5e623b[_0x240321(0xec)](_0x240321(0xed),{'val':!![],'ack':!![]})):_0x5e623b[_0x240321(0xec)]('analysis.safety.deadMan.smartSleep',{'val':![],'ack':!![]}),_0x5e623b[_0x240321(0xec)](_0x240321(0x11a),{'val':_0x3a0113,'ack':!![]}),_0x5e623b[_0x240321(0x10d)][_0x240321(0xf2)]('ðŸ‘¼\x20Schutzengel:\x20Ãœberwache\x20'+currentMonitoredRoom+'\x20fÃ¼r\x20'+_0x1f0dec+'\x20Min.'),_0x5e623b[_0x240321(0xec)](_0x240321(0x110),{'val':'ok','ack':!![]}),activeTimer=setTimeout(()=>triggerPreWarn(_0x5e623b),timeoutMs);}function a2_0x1c85(_0x171360,_0x4f15c6){const _0x231763=a2_0x1829();return a2_0x1c85=function(_0x79d1a7,_0x435c55){_0x79d1a7=_0x79d1a7-0xea;let _0x1829e9=_0x231763[_0x79d1a7];return _0x1829e9;},a2_0x1c85(_0x171360,_0x4f15c6);}function resetTimer(_0x20033c){const _0x6f36a9=a2_0x1c85;if(activeTimer)clearTimeout(activeTimer);activeTimer=null,currentMonitoredRoom=null,alarmStage=0x0,_0x20033c['setStateAsync'](_0x6f36a9(0x110),{'val':'ok','ack':!![]}),_0x20033c[_0x6f36a9(0xec)](_0x6f36a9(0xed),{'val':![],'ack':!![]}),_0x20033c[_0x6f36a9(0xec)](_0x6f36a9(0x11a),{'val':0x0,'ack':!![]});}async function triggerPreWarn(_0x3d22d2){const _0x3d9382=a2_0x1c85;alarmStage=0x1,await _0x3d22d2[_0x3d9382(0xec)]('analysis.safety.deadMan.alarmState',{'val':_0x3d9382(0xfd),'ack':!![]});const _0x457274=_0x3d9382(0x113)+currentMonitoredRoom+'.\x20Alles\x20in\x20Ordnung?';_0x3d22d2[_0x3d9382(0x10d)][_0x3d9382(0x101)](_0x3d9382(0x114)+_0x457274),await setup['sendNotification'](_0x3d22d2,_0x3d9382(0x105)+_0x457274),activeTimer=setTimeout(()=>triggerAlarm(_0x3d22d2),0x5*0x3c*0x3e8);}async function triggerAlarm(_0x1a6408){const _0x59be92=a2_0x1c85;alarmStage=0x2,await _0x1a6408[_0x59be92(0xec)](_0x59be92(0x110),{'val':_0x59be92(0xef),'ack':!![]});const _0x4792d0=_0x59be92(0x100)+currentMonitoredRoom+'!';_0x1a6408['log'][_0x59be92(0x10e)](_0x59be92(0x114)+_0x4792d0),await setup[_0x59be92(0x104)](_0x1a6408,_0x4792d0,![],!![]);}module[a2_0x385541(0x118)]={'updateLocation':updateLocation};