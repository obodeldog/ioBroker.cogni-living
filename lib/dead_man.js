const a2_0x4d65cb=a2_0x2354;(function(_0xe4af52,_0x5c0944){const _0x24a0e5=a2_0x2354,_0x16a236=_0xe4af52();while(!![]){try{const _0x5ef82a=parseInt(_0x24a0e5(0x18b))/0x1+parseInt(_0x24a0e5(0x16f))/0x2+parseInt(_0x24a0e5(0x173))/0x3+-parseInt(_0x24a0e5(0x17b))/0x4+-parseInt(_0x24a0e5(0x16e))/0x5*(parseInt(_0x24a0e5(0x191))/0x6)+-parseInt(_0x24a0e5(0x190))/0x7+parseInt(_0x24a0e5(0x175))/0x8;if(_0x5ef82a===_0x5c0944)break;else _0x16a236['push'](_0x16a236['shift']());}catch(_0x4841c9){_0x16a236['push'](_0x16a236['shift']());}}}(a2_0xa560,0x69295));function a2_0x2354(_0x499121,_0x17033e){const _0x23694e=a2_0xa560();return a2_0x2354=function(_0x54e4c2,_0x453b95){_0x54e4c2=_0x54e4c2-0x165;let _0xa56091=_0x23694e[_0x54e4c2];return _0xa56091;},a2_0x2354(_0x499121,_0x17033e);}const a2_0x453b95=(function(){let _0x3123b1=!![];return function(_0x40b01b,_0x13fc46){const _0x24cccf=_0x3123b1?function(){if(_0x13fc46){const _0x1ee6ae=_0x13fc46['apply'](_0x40b01b,arguments);return _0x13fc46=null,_0x1ee6ae;}}:function(){};return _0x3123b1=![],_0x24cccf;};}()),a2_0x54e4c2=a2_0x453b95(this,function(){const _0x45f8ed=a2_0x2354;return a2_0x54e4c2[_0x45f8ed(0x188)]()['search']('(((.+)+)+)+$')[_0x45f8ed(0x188)]()['constructor'](a2_0x54e4c2)[_0x45f8ed(0x166)](_0x45f8ed(0x182));});a2_0x54e4c2();'use strict';const setup=require(a2_0x4d65cb(0x17d));let activeTimer=null,currentMonitoredRoom=null,timeoutMs=0x0,startTime=0x0,alarmStage=0x0;const DEFAULT_TIMEOUTS={'bad':0x2d,'bath':0x2d,'toilet':0x1e,'wc':0x1e,'keller':0x3c,'schlaf':0x78,'bed':0x78,'guest':0x5a,'gast':0x5a};function getTimeoutRobust(_0x3e86a3,_0x32f3a6){const _0x1538dd=a2_0x4d65cb;if(!_0x3e86a3||!_0x32f3a6)return undefined;if(_0x3e86a3[_0x32f3a6])return _0x3e86a3[_0x32f3a6];const _0x1b775c=_0x32f3a6[_0x1538dd(0x18c)]()[_0x1538dd(0x181)](/[^a-z0-9]/g,'');for(const _0x2477b9 in _0x3e86a3){const _0x2d5a09=_0x2477b9['toLowerCase']()[_0x1538dd(0x181)](/[^a-z0-9]/g,'');if(_0x2d5a09===_0x1b775c)return _0x3e86a3[_0x2477b9];}const _0x5c6a2a=_0x32f3a6['toLowerCase']();if(_0x3e86a3[_0x5c6a2a])return _0x3e86a3[_0x5c6a2a];return undefined;}async function loadConfig(_0x3c5671){const _0x335676=a2_0x4d65cb;try{const _0x1c3df7=await _0x3c5671[_0x335676(0x172)](_0x335676(0x197));if(_0x1c3df7&&_0x1c3df7[_0x335676(0x16d)])return JSON[_0x335676(0x18a)](_0x1c3df7['val']);}catch(_0x37376d){}return{};}async function isActive(_0x4ad0a1){const _0x4fa546=a2_0x4d65cb;try{const _0x346f33=await _0x4ad0a1['getStateAsync'](_0x4fa546(0x180));return _0x346f33&&_0x346f33[_0x4fa546(0x16d)];}catch(_0x109e85){return![];}}async function areRoomsConnected(_0x514b50,_0x2d796e,_0x4d84cf){const _0x3a70c8=a2_0x4d65cb;try{const _0x201b19=await _0x514b50[_0x3a70c8(0x172)](_0x3a70c8(0x170));if(!_0x201b19||!_0x201b19[_0x3a70c8(0x16d)])return!![];const _0x26ce43=JSON[_0x3a70c8(0x18a)](_0x201b19['val']),{rooms:_0x12912e,matrix:_0x51ecd0}=_0x26ce43;if(!_0x12912e||!_0x51ecd0)return!![];const _0x3b5637=_0x12912e[_0x3a70c8(0x16b)](_0x2d796e),_0x4bda9b=_0x12912e[_0x3a70c8(0x16b)](_0x4d84cf);if(_0x3b5637===-0x1||_0x4bda9b===-0x1)return!![];const _0x5b92bb=_0x51ecd0[_0x3b5637][_0x4bda9b]>0x0||_0x51ecd0[_0x4bda9b][_0x3b5637]>0x0;return _0x5b92bb;}catch(_0x7a90b5){return _0x514b50[_0x3a70c8(0x171)]['warn'](_0x3a70c8(0x196)+_0x7a90b5['message']),!![];}}function a2_0xa560(){const _0x3a446d=['replace','(((.+)+)+)+$','%).\x20VerlÃ¤ngere\x20Timer\x20fÃ¼r\x20','analysis.safety.deadMan.napProbability','living','sofa','wohn','toString','default','parse','595441LFahCH','toLowerCase','toFixed','error','pre_warn','244867qDnxhN','336636DIPifk','includes','ðŸ‘¼\x20Schutzengel-Frage:\x20','analysis.safety.deadMan.smartSleep','getHours','[DeadMan]\x20Topology\x20check\x20failed:\x20','analysis.safety.deadMan.config','bed','info','analysis.safety.deadMan.lastIgnored','sendNotification','exports','\x20(Multi-Person\x20Filter)','analysis.safety.deadMan.currentRoom','\x27.\x20Nicht\x20verbunden\x20mit\x20Ã¼berwachtem\x20\x27','search','analysis.safety.deadMan.alarmState','ðŸ‘¼\x20Schutzengel:\x20Ãœberwache\x20','[DeadMan]\x20','\x20fÃ¼r\x20','indexOf','stringify','val','75beySTh','1184408yLxEzV','analysis.topology.structure','log','getStateAsync','1118742HDXcna','\x20Min.','3035240SGokKl','ðŸš¨\x20NOTFALL-ALARM:\x20Person\x20reagiert\x20nicht\x20in\x20','.\x20Alles\x20in\x20Ordnung?','ðŸ’¤\x20Smart\x20Sleep\x20erkannt\x20(','\x20um\x2090\x20Min.','Ignoriere\x20Bewegung\x20in\x20\x27','2530608jrJHMw','now','./setup','Unknown','setStateAsync','analysis.safety.deadMan.active'];a2_0xa560=function(){return _0x3a446d;};return a2_0xa560();}function calculateSleepProbability(_0x18aebb){const _0x556c5b=a2_0x4d65cb,_0x32b523=new Date(),_0x5f89cc=_0x32b523[_0x556c5b(0x195)](),_0xdfbbe7=_0x18aebb[_0x556c5b(0x18c)]();let _0x5d11ca=0.1;if(_0x5f89cc>=0x17||_0x5f89cc<=0x6)_0x5d11ca=0x1;else{if(_0x5f89cc>=0xd&&_0x5f89cc<=0xf)_0x5d11ca=0.8;else{if(_0x5f89cc>=0x14&&_0x5f89cc<=0x17)_0x5d11ca=0.4;}}let _0x21375e=0.1;if(_0xdfbbe7[_0x556c5b(0x192)]('schlaf')||_0xdfbbe7[_0x556c5b(0x192)](_0x556c5b(0x198)))_0x21375e=0x1;else{if(_0xdfbbe7[_0x556c5b(0x192)](_0x556c5b(0x187))||_0xdfbbe7[_0x556c5b(0x192)](_0x556c5b(0x185))||_0xdfbbe7['includes'](_0x556c5b(0x186)))_0x21375e=0.6;else{if(_0xdfbbe7['includes']('bad')||_0xdfbbe7[_0x556c5b(0x192)]('wc'))_0x21375e=0.05;}}let _0x8dd250=0.5;const _0x24bc89=_0x21375e*0.5+_0x5d11ca*0.3+_0x8dd250*0.2;return parseFloat(_0x24bc89[_0x556c5b(0x18d)](0x2));}async function updateLocation(_0x5f0ef7,_0x5d71cf){const _0x1f3d36=a2_0x4d65cb;if(!_0x5d71cf||_0x5d71cf===_0x1f3d36(0x17e))return;if(!await isActive(_0x5f0ef7)){resetTimer(_0x5f0ef7);return;}if(currentMonitoredRoom&&currentMonitoredRoom!==_0x5d71cf){const _0x2fb0b7=await areRoomsConnected(_0x5f0ef7,currentMonitoredRoom,_0x5d71cf);if(!_0x2fb0b7){const _0x540788=_0x1f3d36(0x17a)+_0x5d71cf+_0x1f3d36(0x165)+currentMonitoredRoom+'\x27.';_0x5f0ef7[_0x1f3d36(0x171)][_0x1f3d36(0x199)](_0x1f3d36(0x169)+_0x540788+_0x1f3d36(0x19d)),await _0x5f0ef7[_0x1f3d36(0x17f)](_0x1f3d36(0x19a),{'val':JSON[_0x1f3d36(0x16c)]({'room':_0x5d71cf,'reason':_0x540788,'timestamp':Date[_0x1f3d36(0x17c)]()}),'ack':!![]});return;}resetTimer(_0x5f0ef7);}if(!currentMonitoredRoom){await _0x5f0ef7['setStateAsync'](_0x1f3d36(0x19e),{'val':_0x5d71cf,'ack':!![]});const _0x342221=await loadConfig(_0x5f0ef7);let _0x4668ed=getTimeoutRobust(_0x342221,_0x5d71cf);const _0x2db2ea=_0x5d71cf[_0x1f3d36(0x18c)]();if(!_0x4668ed)for(const _0x3bba78 in DEFAULT_TIMEOUTS){if(_0x2db2ea[_0x1f3d36(0x192)](_0x3bba78)){_0x4668ed=DEFAULT_TIMEOUTS[_0x3bba78];break;}}if(!_0x4668ed&&_0x342221[_0x1f3d36(0x189)])_0x4668ed=_0x342221[_0x1f3d36(0x189)];if(!_0x4668ed)return;currentMonitoredRoom=_0x5d71cf,startTimer(_0x5f0ef7,_0x4668ed,_0x5d71cf);}}function startTimer(_0x350c9a,_0x2e74ab,_0x4cc3ed){const _0x27192c=a2_0x4d65cb;if(activeTimer)clearTimeout(activeTimer);timeoutMs=_0x2e74ab*0x3c*0x3e8,startTime=Date['now'](),alarmStage=0x0;const _0x1e88c7=calculateSleepProbability(_0x4cc3ed||currentMonitoredRoom),_0x1de23e=_0x1e88c7>0.65;_0x1de23e?(timeoutMs+=0x5a*0x3c*0x3e8,_0x350c9a[_0x27192c(0x171)][_0x27192c(0x199)](_0x27192c(0x178)+(_0x1e88c7*0x64)[_0x27192c(0x18d)](0x0)+_0x27192c(0x183)+currentMonitoredRoom+_0x27192c(0x179)),_0x350c9a[_0x27192c(0x17f)](_0x27192c(0x194),{'val':!![],'ack':!![]})):_0x350c9a[_0x27192c(0x17f)](_0x27192c(0x194),{'val':![],'ack':!![]}),_0x350c9a[_0x27192c(0x17f)](_0x27192c(0x184),{'val':_0x1e88c7,'ack':!![]}),_0x350c9a[_0x27192c(0x171)][_0x27192c(0x199)](_0x27192c(0x168)+currentMonitoredRoom+_0x27192c(0x16a)+_0x2e74ab+_0x27192c(0x174)),_0x350c9a['setStateAsync']('analysis.safety.deadMan.alarmState',{'val':'ok','ack':!![]}),activeTimer=setTimeout(()=>triggerPreWarn(_0x350c9a),timeoutMs);}function resetTimer(_0x4dc60b){const _0x485555=a2_0x4d65cb;if(activeTimer)clearTimeout(activeTimer);activeTimer=null,currentMonitoredRoom=null,alarmStage=0x0,_0x4dc60b['setStateAsync'](_0x485555(0x167),{'val':'ok','ack':!![]}),_0x4dc60b[_0x485555(0x17f)](_0x485555(0x194),{'val':![],'ack':!![]}),_0x4dc60b[_0x485555(0x17f)](_0x485555(0x184),{'val':0x0,'ack':!![]});}async function triggerPreWarn(_0x299b0a){const _0x5b1989=a2_0x4d65cb;alarmStage=0x1,await _0x299b0a['setStateAsync'](_0x5b1989(0x167),{'val':_0x5b1989(0x18f),'ack':!![]});const _0x453bf6='â³\x20ACHTUNG:\x20UngewÃ¶hnlich\x20lange\x20InaktivitÃ¤t\x20in\x20'+currentMonitoredRoom+_0x5b1989(0x177);_0x299b0a['log']['warn'](_0x5b1989(0x169)+_0x453bf6),await setup[_0x5b1989(0x19b)](_0x299b0a,_0x5b1989(0x193)+_0x453bf6),activeTimer=setTimeout(()=>triggerAlarm(_0x299b0a),0x5*0x3c*0x3e8);}async function triggerAlarm(_0x19f303){const _0x26a602=a2_0x4d65cb;alarmStage=0x2,await _0x19f303[_0x26a602(0x17f)](_0x26a602(0x167),{'val':'alarm','ack':!![]});const _0x14976f=_0x26a602(0x176)+currentMonitoredRoom+'!';_0x19f303[_0x26a602(0x171)][_0x26a602(0x18e)](_0x26a602(0x169)+_0x14976f),await setup[_0x26a602(0x19b)](_0x19f303,_0x14976f,![],!![]);}module[a2_0x4d65cb(0x19c)]={'updateLocation':updateLocation};