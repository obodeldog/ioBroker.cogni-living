const a2_0x55548b=a2_0x3ece;(function(_0x336d50,_0x36e7b3){const _0x5b175e=a2_0x3ece,_0x17053a=_0x336d50();while(!![]){try{const _0x488994=-parseInt(_0x5b175e(0x128))/0x1*(-parseInt(_0x5b175e(0x121))/0x2)+parseInt(_0x5b175e(0x13e))/0x3*(-parseInt(_0x5b175e(0x12f))/0x4)+-parseInt(_0x5b175e(0x13c))/0x5+-parseInt(_0x5b175e(0x12c))/0x6+-parseInt(_0x5b175e(0x132))/0x7+-parseInt(_0x5b175e(0x134))/0x8+parseInt(_0x5b175e(0x143))/0x9;if(_0x488994===_0x36e7b3)break;else _0x17053a['push'](_0x17053a['shift']());}catch(_0x4ab7ce){_0x17053a['push'](_0x17053a['shift']());}}}(a2_0x416f,0xd8228));const a2_0x44929f=(function(){let _0x3733ed=!![];return function(_0xfff1dd,_0x27ac6a){const _0x3c089d=_0x3733ed?function(){const _0x288294=a2_0x3ece;if(_0x27ac6a){const _0xb05cf7=_0x27ac6a[_0x288294(0x138)](_0xfff1dd,arguments);return _0x27ac6a=null,_0xb05cf7;}}:function(){};return _0x3733ed=![],_0x3c089d;};}()),a2_0x334b32=a2_0x44929f(this,function(){const _0x53af0b=a2_0x3ece;return a2_0x334b32[_0x53af0b(0x120)]()[_0x53af0b(0x148)]('(((.+)+)+)+$')[_0x53af0b(0x120)]()[_0x53af0b(0x137)](a2_0x334b32)['search']('(((.+)+)+)+$');});a2_0x334b32();'use strict';const setup=require('./setup');let activeTimer=null,currentMonitoredRoom=null,timeoutMs=0x0,startTime=0x0,alarmStage=0x0;const DEFAULT_TIMEOUTS={'bad':0x2d,'bath':0x2d,'toilet':0x1e,'wc':0x1e,'keller':0x3c};async function loadConfig(_0x5c17ce){const _0x55cede=a2_0x3ece;try{const _0x1a52e8=await _0x5c17ce['getStateAsync'](_0x55cede(0x135));if(_0x1a52e8&&_0x1a52e8[_0x55cede(0x125)])return JSON['parse'](_0x1a52e8[_0x55cede(0x125)]);}catch(_0x5628ef){}return{};}function a2_0x3ece(_0x496c2c,_0x5c83be){const _0x4d8967=a2_0x416f();return a2_0x3ece=function(_0x334b32,_0x44929f){_0x334b32=_0x334b32-0x11f;let _0x416fc7=_0x4d8967[_0x334b32];return _0x416fc7;},a2_0x3ece(_0x496c2c,_0x5c83be);}function a2_0x416f(){const _0x531445=['44381619SHFixT','ðŸš¨\x20NOTFALL-ALARM:\x20Person\x20reagiert\x20nicht\x20in\x20','warn','getStateAsync','analysis.safety.deadMan.active','search','includes','toString','241940yGCSuw','analysis.safety.deadMan.currentRoom','log','â³\x20ACHTUNG:\x20UngewÃ¶hnlich\x20lange\x20InaktivitÃ¤t\x20in\x20','val','error','ðŸ‘¼\x20Schutzengel-Frage:\x20','3UHHrak','analysis.topology.structure','default','pre_warn','10216818kJVtQE','parse','analysis.safety.deadMan.lastIgnored','2972680cNNaWc','stringify','[DeadMan]\x20Topology\x20check\x20failed:\x20','10120614mCpKEF','\x20fÃ¼r\x20','3676560ZQNEYv','analysis.safety.deadMan.config','sendNotification','constructor','apply','ðŸ‘¼\x20Schutzengel:\x20Ãœberwache\x20','exports','Ignoriere\x20Bewegung\x20in\x20\x27','287840ttXLsD','message','3bTqZmN','setStateAsync','\x20Min.','analysis.safety.deadMan.alarmState','[DeadMan]\x20'];a2_0x416f=function(){return _0x531445;};return a2_0x416f();}async function isActive(_0x1a5520){const _0x565e6d=a2_0x3ece;try{const _0x4b22bf=await _0x1a5520[_0x565e6d(0x146)](_0x565e6d(0x147));return _0x4b22bf&&_0x4b22bf[_0x565e6d(0x125)];}catch(_0xdb24ef){return![];}}async function areRoomsConnected(_0x30e7ff,_0x5bd716,_0x6d87dd){const _0xc33fe8=a2_0x3ece;try{const _0x2b7a98=await _0x30e7ff[_0xc33fe8(0x146)](_0xc33fe8(0x129));if(!_0x2b7a98||!_0x2b7a98[_0xc33fe8(0x125)])return!![];const _0x114cba=JSON[_0xc33fe8(0x12d)](_0x2b7a98[_0xc33fe8(0x125)]),{rooms:_0xf1aa71,matrix:_0x210525}=_0x114cba;if(!_0xf1aa71||!_0x210525)return!![];const _0x5299bb=_0xf1aa71['indexOf'](_0x5bd716),_0xfc847d=_0xf1aa71['indexOf'](_0x6d87dd);if(_0x5299bb===-0x1||_0xfc847d===-0x1)return!![];const _0x48e743=_0x210525[_0x5299bb][_0xfc847d]>0x0||_0x210525[_0xfc847d][_0x5299bb]>0x0;return _0x48e743;}catch(_0x46d91e){return _0x30e7ff[_0xc33fe8(0x123)][_0xc33fe8(0x145)](_0xc33fe8(0x131)+_0x46d91e[_0xc33fe8(0x13d)]),!![];}}async function updateLocation(_0x26f609,_0x1f8d67){const _0x3f79c1=a2_0x3ece;if(!_0x1f8d67||_0x1f8d67==='Unknown')return;if(!await isActive(_0x26f609)){resetTimer(_0x26f609);return;}if(currentMonitoredRoom&&currentMonitoredRoom!==_0x1f8d67){const _0x363ca1=await areRoomsConnected(_0x26f609,currentMonitoredRoom,_0x1f8d67);if(!_0x363ca1){const _0x283c91=_0x3f79c1(0x13b)+_0x1f8d67+'\x27.\x20Nicht\x20verbunden\x20mit\x20Ã¼berwachtem\x20\x27'+currentMonitoredRoom+'\x27.';_0x26f609[_0x3f79c1(0x123)]['info'](_0x3f79c1(0x142)+_0x283c91+'\x20(Multi-Person\x20Filter)'),await _0x26f609[_0x3f79c1(0x13f)](_0x3f79c1(0x12e),{'val':JSON[_0x3f79c1(0x130)]({'room':_0x1f8d67,'reason':_0x283c91,'timestamp':Date['now']()}),'ack':!![]});return;}resetTimer(_0x26f609);}if(!currentMonitoredRoom){await _0x26f609[_0x3f79c1(0x13f)](_0x3f79c1(0x122),{'val':_0x1f8d67,'ack':!![]});const _0x5c97b6=await loadConfig(_0x26f609),_0x12c229=_0x1f8d67['toLowerCase']();let _0x20724e=_0x5c97b6[_0x1f8d67]||_0x5c97b6[_0x12c229];if(!_0x20724e)for(const _0x20b32a in DEFAULT_TIMEOUTS){if(_0x12c229[_0x3f79c1(0x11f)](_0x20b32a)){_0x20724e=DEFAULT_TIMEOUTS[_0x20b32a];break;}}if(!_0x20724e&&_0x5c97b6[_0x3f79c1(0x12a)])_0x20724e=_0x5c97b6[_0x3f79c1(0x12a)];if(!_0x20724e)return;currentMonitoredRoom=_0x1f8d67,startTimer(_0x26f609,_0x20724e);}}function startTimer(_0x53cad6,_0x2d9469){const _0x1f0b8b=a2_0x3ece;if(activeTimer)clearTimeout(activeTimer);timeoutMs=_0x2d9469*0x3c*0x3e8,startTime=Date['now'](),alarmStage=0x0,_0x53cad6[_0x1f0b8b(0x123)]['info'](_0x1f0b8b(0x139)+currentMonitoredRoom+_0x1f0b8b(0x133)+_0x2d9469+_0x1f0b8b(0x140)),_0x53cad6['setStateAsync'](_0x1f0b8b(0x141),{'val':'ok','ack':!![]}),activeTimer=setTimeout(()=>triggerPreWarn(_0x53cad6),timeoutMs);}function resetTimer(_0x3bb01b){if(activeTimer)clearTimeout(activeTimer);activeTimer=null,currentMonitoredRoom=null,alarmStage=0x0,_0x3bb01b['setStateAsync']('analysis.safety.deadMan.alarmState',{'val':'ok','ack':!![]});}async function triggerPreWarn(_0x4da3f7){const _0x324e68=a2_0x3ece;alarmStage=0x1,await _0x4da3f7[_0x324e68(0x13f)](_0x324e68(0x141),{'val':_0x324e68(0x12b),'ack':!![]});const _0x2a2762=_0x324e68(0x124)+currentMonitoredRoom+'.\x20Alles\x20in\x20Ordnung?';_0x4da3f7['log'][_0x324e68(0x145)](_0x324e68(0x142)+_0x2a2762),await setup[_0x324e68(0x136)](_0x4da3f7,_0x324e68(0x127)+_0x2a2762),activeTimer=setTimeout(()=>triggerAlarm(_0x4da3f7),0x5*0x3c*0x3e8);}async function triggerAlarm(_0xd6f815){const _0x1c6d17=a2_0x3ece;alarmStage=0x2,await _0xd6f815[_0x1c6d17(0x13f)]('analysis.safety.deadMan.alarmState',{'val':'alarm','ack':!![]});const _0x32c0d7=_0x1c6d17(0x144)+currentMonitoredRoom+'!';_0xd6f815[_0x1c6d17(0x123)][_0x1c6d17(0x126)](_0x1c6d17(0x142)+_0x32c0d7),await setup[_0x1c6d17(0x136)](_0xd6f815,_0x32c0d7,![],!![]);}module[a2_0x55548b(0x13a)]={'updateLocation':updateLocation};