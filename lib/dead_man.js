const a2_0x122958=a2_0x1c8b;(function(_0x3d12d3,_0x3b1b08){const _0x4357fc=a2_0x1c8b,_0x24cbaa=_0x3d12d3();while(!![]){try{const _0x2c16d8=-parseInt(_0x4357fc(0x151))/0x1*(-parseInt(_0x4357fc(0x139))/0x2)+parseInt(_0x4357fc(0x138))/0x3*(parseInt(_0x4357fc(0x13c))/0x4)+-parseInt(_0x4357fc(0x155))/0x5*(-parseInt(_0x4357fc(0x130))/0x6)+parseInt(_0x4357fc(0x142))/0x7*(-parseInt(_0x4357fc(0x144))/0x8)+parseInt(_0x4357fc(0x14b))/0x9*(parseInt(_0x4357fc(0x141))/0xa)+-parseInt(_0x4357fc(0x133))/0xb*(-parseInt(_0x4357fc(0x13f))/0xc)+-parseInt(_0x4357fc(0x149))/0xd*(parseInt(_0x4357fc(0x14e))/0xe);if(_0x2c16d8===_0x3b1b08)break;else _0x24cbaa['push'](_0x24cbaa['shift']());}catch(_0x11a5db){_0x24cbaa['push'](_0x24cbaa['shift']());}}}(a2_0x5983,0x600b8));const a2_0x4af7f3=(function(){let _0x4e4299=!![];return function(_0x5ea4f2,_0x54cd1d){const _0x5569c9=_0x4e4299?function(){if(_0x54cd1d){const _0x576ba2=_0x54cd1d['apply'](_0x5ea4f2,arguments);return _0x54cd1d=null,_0x576ba2;}}:function(){};return _0x4e4299=![],_0x5569c9;};}()),a2_0x22b9ea=a2_0x4af7f3(this,function(){const _0x35e589=a2_0x1c8b;return a2_0x22b9ea[_0x35e589(0x15a)]()[_0x35e589(0x140)](_0x35e589(0x143))[_0x35e589(0x15a)]()[_0x35e589(0x14d)](a2_0x22b9ea)['search'](_0x35e589(0x143));});a2_0x22b9ea();'use strict';const setup=require(a2_0x122958(0x136));let activeTimer=null,currentMonitoredRoom=null,timeoutMs=0x0,startTime=0x0,alarmStage=0x0;function a2_0x1c8b(_0x3a4d76,_0xf2e82a){const _0x1ec205=a2_0x5983();return a2_0x1c8b=function(_0x22b9ea,_0x4af7f3){_0x22b9ea=_0x22b9ea-0x12e;let _0x5983b1=_0x1ec205[_0x22b9ea];return _0x5983b1;},a2_0x1c8b(_0x3a4d76,_0xf2e82a);}const DEFAULT_TIMEOUTS={'bad':0x2d,'bath':0x2d,'toilet':0x1e,'wc':0x1e,'keller':0x3c};async function loadConfig(_0x3084cf){const _0x3da04b=a2_0x122958;try{const _0x4dff22=await _0x3084cf['getStateAsync'](_0x3da04b(0x135));if(_0x4dff22&&_0x4dff22['val'])return JSON['parse'](_0x4dff22[_0x3da04b(0x14a)]);}catch(_0x5bf467){}return{};}async function isActive(_0x13fa77){const _0xbbe201=a2_0x122958;try{const _0x178160=await _0x13fa77[_0xbbe201(0x152)](_0xbbe201(0x154));return _0x178160&&_0x178160['val'];}catch(_0x188d3d){return![];}}function a2_0x5983(){const _0xfa87af=['constructor','6132dfMWPz','default','now','1916ukEEkL','getStateAsync','ðŸ‘¼\x20Schutzengel-Frage:\x20','analysis.safety.deadMan.active','5mGqNTk','setStateAsync','stringify','analysis.safety.deadMan.alarmState','\x20fÃ¼r\x20','toString','log','[DeadMan]\x20','sendNotification','2069238fXJIJy','ðŸš¨\x20NOTFALL-ALARM:\x20Person\x20reagiert\x20nicht\x20in\x20','â³\x20ACHTUNG:\x20UngewÃ¶hnlich\x20lange\x20InaktivitÃ¤t\x20in\x20','16181FRldEs','[DeadMan]\x20Topology\x20check\x20failed:\x20','analysis.safety.deadMan.config','./setup','error','186UGVZuu','196NRiQiA','info','indexOf','48092bAZOhX','pre_warn','message','3144WRuMEy','search','2890owjcyw','12313nuIEHC','(((.+)+)+)+$','2344hXAtyf','\x27.\x20Nicht\x20verbunden\x20mit\x20Ã¼berwachtem\x20\x27','analysis.safety.deadMan.lastIgnored','includes','toLowerCase','27014eQeVus','val','4842UAmWur','ðŸ‘¼\x20Schutzengel:\x20Ãœberwache\x20'];a2_0x5983=function(){return _0xfa87af;};return a2_0x5983();}async function areRoomsConnected(_0x507160,_0xd07a3d,_0x4cc492){const _0x39862e=a2_0x122958;try{const _0x4107e5=await _0x507160[_0x39862e(0x152)]('analysis.topology.structure');if(!_0x4107e5||!_0x4107e5[_0x39862e(0x14a)])return!![];const _0x5bb8d0=JSON['parse'](_0x4107e5[_0x39862e(0x14a)]),{rooms:_0x4a5247,matrix:_0x532752}=_0x5bb8d0;if(!_0x4a5247||!_0x532752)return!![];const _0x380a63=_0x4a5247[_0x39862e(0x13b)](_0xd07a3d),_0x35416c=_0x4a5247[_0x39862e(0x13b)](_0x4cc492);if(_0x380a63===-0x1||_0x35416c===-0x1)return!![];const _0x4bccde=_0x532752[_0x380a63][_0x35416c]>0x0||_0x532752[_0x35416c][_0x380a63]>0x0;return _0x4bccde;}catch(_0x411579){return _0x507160[_0x39862e(0x15b)]['warn'](_0x39862e(0x134)+_0x411579[_0x39862e(0x13e)]),!![];}}async function updateLocation(_0xedc25e,_0x2e2420){const _0x135aff=a2_0x122958;if(!_0x2e2420||_0x2e2420==='Unknown')return;if(!await isActive(_0xedc25e)){resetTimer(_0xedc25e);return;}if(currentMonitoredRoom&&currentMonitoredRoom!==_0x2e2420){const _0x4cd11a=await areRoomsConnected(_0xedc25e,currentMonitoredRoom,_0x2e2420);if(!_0x4cd11a){const _0x5c4927='Ignoriere\x20Bewegung\x20in\x20\x27'+_0x2e2420+_0x135aff(0x145)+currentMonitoredRoom+'\x27.';_0xedc25e[_0x135aff(0x15b)][_0x135aff(0x13a)](_0x135aff(0x12e)+_0x5c4927+'\x20(Multi-Person\x20Filter)'),await _0xedc25e[_0x135aff(0x156)](_0x135aff(0x146),{'val':JSON[_0x135aff(0x157)]({'room':_0x2e2420,'reason':_0x5c4927,'timestamp':Date[_0x135aff(0x150)]()}),'ack':!![]});return;}resetTimer(_0xedc25e);}if(!currentMonitoredRoom){await _0xedc25e['setStateAsync']('analysis.safety.deadMan.currentRoom',{'val':_0x2e2420,'ack':!![]});const _0x4cd7f5=await loadConfig(_0xedc25e),_0x5b076d=_0x2e2420[_0x135aff(0x148)]();let _0xdf342b=_0x4cd7f5[_0x2e2420]||_0x4cd7f5[_0x5b076d];if(!_0xdf342b)for(const _0x34f05c in DEFAULT_TIMEOUTS){if(_0x5b076d[_0x135aff(0x147)](_0x34f05c)){_0xdf342b=DEFAULT_TIMEOUTS[_0x34f05c];break;}}if(!_0xdf342b&&_0x4cd7f5[_0x135aff(0x14f)])_0xdf342b=_0x4cd7f5[_0x135aff(0x14f)];if(!_0xdf342b)return;currentMonitoredRoom=_0x2e2420,startTimer(_0xedc25e,_0xdf342b);}}function startTimer(_0x36ef76,_0x32d46c){const _0x1952e2=a2_0x122958;if(activeTimer)clearTimeout(activeTimer);timeoutMs=_0x32d46c*0x3c*0x3e8,startTime=Date['now'](),alarmStage=0x0,_0x36ef76[_0x1952e2(0x15b)][_0x1952e2(0x13a)](_0x1952e2(0x14c)+currentMonitoredRoom+_0x1952e2(0x159)+_0x32d46c+'\x20Min.'),_0x36ef76[_0x1952e2(0x156)](_0x1952e2(0x158),{'val':'ok','ack':!![]}),activeTimer=setTimeout(()=>triggerPreWarn(_0x36ef76),timeoutMs);}function resetTimer(_0x43c5d0){const _0x5f1ee0=a2_0x122958;if(activeTimer)clearTimeout(activeTimer);activeTimer=null,currentMonitoredRoom=null,alarmStage=0x0,_0x43c5d0[_0x5f1ee0(0x156)]('analysis.safety.deadMan.alarmState',{'val':'ok','ack':!![]});}async function triggerPreWarn(_0x302752){const _0x37ee3f=a2_0x122958;alarmStage=0x1,await _0x302752[_0x37ee3f(0x156)](_0x37ee3f(0x158),{'val':_0x37ee3f(0x13d),'ack':!![]});const _0x85b453=_0x37ee3f(0x132)+currentMonitoredRoom+'.\x20Alles\x20in\x20Ordnung?';_0x302752[_0x37ee3f(0x15b)]['warn'](_0x37ee3f(0x12e)+_0x85b453),await setup[_0x37ee3f(0x12f)](_0x302752,_0x37ee3f(0x153)+_0x85b453),activeTimer=setTimeout(()=>triggerAlarm(_0x302752),0x5*0x3c*0x3e8);}async function triggerAlarm(_0x38fe80){const _0x31aa1a=a2_0x122958;alarmStage=0x2,await _0x38fe80[_0x31aa1a(0x156)](_0x31aa1a(0x158),{'val':'alarm','ack':!![]});const _0x33e93b=_0x31aa1a(0x131)+currentMonitoredRoom+'!';_0x38fe80[_0x31aa1a(0x15b)][_0x31aa1a(0x137)]('[DeadMan]\x20'+_0x33e93b),await setup[_0x31aa1a(0x12f)](_0x38fe80,_0x33e93b,![],!![]);}module['exports']={'updateLocation':updateLocation};