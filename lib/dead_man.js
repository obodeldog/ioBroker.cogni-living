function a2_0x2a13(_0x46946d,_0x1a0847){const _0x3847fd=a2_0x4ccb();return a2_0x2a13=function(_0x46e9d5,_0x399e6f){_0x46e9d5=_0x46e9d5-0x120;let _0x4ccb5b=_0x3847fd[_0x46e9d5];return _0x4ccb5b;},a2_0x2a13(_0x46946d,_0x1a0847);}const a2_0xad2f5b=a2_0x2a13;(function(_0x17cecc,_0x5b2fd0){const _0x2bda58=a2_0x2a13,_0x4f67cc=_0x17cecc();while(!![]){try{const _0x18a239=-parseInt(_0x2bda58(0x13b))/0x1*(parseInt(_0x2bda58(0x124))/0x2)+-parseInt(_0x2bda58(0x12b))/0x3+-parseInt(_0x2bda58(0x14a))/0x4+parseInt(_0x2bda58(0x12c))/0x5+-parseInt(_0x2bda58(0x122))/0x6*(-parseInt(_0x2bda58(0x151))/0x7)+-parseInt(_0x2bda58(0x141))/0x8+parseInt(_0x2bda58(0x144))/0x9;if(_0x18a239===_0x5b2fd0)break;else _0x4f67cc['push'](_0x4f67cc['shift']());}catch(_0x5dce1a){_0x4f67cc['push'](_0x4f67cc['shift']());}}}(a2_0x4ccb,0x47068));const a2_0x399e6f=(function(){let _0x31303c=!![];return function(_0x56eda7,_0x4abf4b){const _0x44bae3=_0x31303c?function(){const _0x46dd89=a2_0x2a13;if(_0x4abf4b){const _0x462004=_0x4abf4b[_0x46dd89(0x13a)](_0x56eda7,arguments);return _0x4abf4b=null,_0x462004;}}:function(){};return _0x31303c=![],_0x44bae3;};}()),a2_0x46e9d5=a2_0x399e6f(this,function(){const _0x432fdb=a2_0x2a13;return a2_0x46e9d5[_0x432fdb(0x12e)]()[_0x432fdb(0x139)](_0x432fdb(0x137))[_0x432fdb(0x12e)]()['constructor'](a2_0x46e9d5)[_0x432fdb(0x139)](_0x432fdb(0x137));});a2_0x46e9d5();'use strict';const setup=require('./setup');let activeTimer=null,currentMonitoredRoom=null,timeoutMs=0x0,startTime=0x0,alarmStage=0x0;const DEFAULT_TIMEOUTS={'bad':0x2d,'bath':0x2d,'toilet':0x1e,'wc':0x1e,'keller':0x3c,'schlaf':0x78,'bed':0x78,'guest':0x5a,'gast':0x5a};async function loadConfig(_0x5219df){const _0x367bb8=a2_0x2a13;try{const _0x5b2b39=await _0x5219df[_0x367bb8(0x129)](_0x367bb8(0x12d));if(_0x5b2b39&&_0x5b2b39[_0x367bb8(0x140)])return JSON[_0x367bb8(0x135)](_0x5b2b39['val']);}catch(_0xf2078a){}return{};}async function isActive(_0x55cfa2){const _0x3229db=a2_0x2a13;try{const _0x24124e=await _0x55cfa2['getStateAsync']('analysis.safety.deadMan.active');return _0x24124e&&_0x24124e[_0x3229db(0x140)];}catch(_0x3df2d2){return![];}}async function areRoomsConnected(_0x5e02d8,_0x469011,_0x4329b2){const _0x209a59=a2_0x2a13;try{const _0x326759=await _0x5e02d8['getStateAsync']('analysis.topology.structure');if(!_0x326759||!_0x326759[_0x209a59(0x140)])return!![];const _0x4b0daf=JSON[_0x209a59(0x135)](_0x326759[_0x209a59(0x140)]),{rooms:_0x3778e3,matrix:_0xb5c60f}=_0x4b0daf;if(!_0x3778e3||!_0xb5c60f)return!![];const _0x360892=_0x3778e3[_0x209a59(0x145)](_0x469011),_0x26e91d=_0x3778e3[_0x209a59(0x145)](_0x4329b2);if(_0x360892===-0x1||_0x26e91d===-0x1)return!![];const _0x4efcd7=_0xb5c60f[_0x360892][_0x26e91d]>0x0||_0xb5c60f[_0x26e91d][_0x360892]>0x0;return _0x4efcd7;}catch(_0x747f38){return _0x5e02d8[_0x209a59(0x14b)][_0x209a59(0x13e)](_0x209a59(0x14e)+_0x747f38[_0x209a59(0x150)]),!![];}}function calculateSleepProbability(_0x40e48f){const _0x3146e3=a2_0x2a13,_0x11c4a6=new Date(),_0x3b5249=_0x11c4a6['getHours'](),_0x5e97be=_0x40e48f['toLowerCase']();let _0x5be4a7=0.1;if(_0x3b5249>=0x17||_0x3b5249<=0x6)_0x5be4a7=0x1;else{if(_0x3b5249>=0xd&&_0x3b5249<=0xf)_0x5be4a7=0.8;else{if(_0x3b5249>=0x14&&_0x3b5249<=0x17)_0x5be4a7=0.4;}}let _0x19cd32=0.1;if(_0x5e97be[_0x3146e3(0x13f)]('schlaf')||_0x5e97be[_0x3146e3(0x13f)](_0x3146e3(0x147)))_0x19cd32=0x1;else{if(_0x5e97be[_0x3146e3(0x13f)](_0x3146e3(0x148))||_0x5e97be[_0x3146e3(0x13f)](_0x3146e3(0x14c))||_0x5e97be[_0x3146e3(0x13f)](_0x3146e3(0x12f)))_0x19cd32=0.6;else{if(_0x5e97be['includes'](_0x3146e3(0x130))||_0x5e97be[_0x3146e3(0x13f)]('wc'))_0x19cd32=0.05;}}let _0x1b7116=0.5;const _0x31e852=_0x19cd32*0.5+_0x5be4a7*0.3+_0x1b7116*0.2;return parseFloat(_0x31e852[_0x3146e3(0x127)](0x2));}async function updateLocation(_0x28632f,_0x47a503){const _0x1e2155=a2_0x2a13;if(!_0x47a503||_0x47a503==='Unknown')return;if(!await isActive(_0x28632f)){resetTimer(_0x28632f);return;}if(currentMonitoredRoom&&currentMonitoredRoom!==_0x47a503){const _0xa6f101=await areRoomsConnected(_0x28632f,currentMonitoredRoom,_0x47a503);if(!_0xa6f101){const _0x106d06=_0x1e2155(0x138)+_0x47a503+_0x1e2155(0x136)+currentMonitoredRoom+'\x27.';_0x28632f[_0x1e2155(0x14b)][_0x1e2155(0x152)]('[DeadMan]\x20'+_0x106d06+'\x20(Multi-Person\x20Filter)'),await _0x28632f[_0x1e2155(0x13d)]('analysis.safety.deadMan.lastIgnored',{'val':JSON[_0x1e2155(0x14f)]({'room':_0x47a503,'reason':_0x106d06,'timestamp':Date[_0x1e2155(0x125)]()}),'ack':!![]});return;}resetTimer(_0x28632f);}if(!currentMonitoredRoom){await _0x28632f[_0x1e2155(0x13d)]('analysis.safety.deadMan.currentRoom',{'val':_0x47a503,'ack':!![]});const _0x16f30b=await loadConfig(_0x28632f),_0x2a7b39=_0x47a503[_0x1e2155(0x146)]();let _0x8879e1=_0x16f30b[_0x47a503]||_0x16f30b[_0x2a7b39];if(!_0x8879e1)for(const _0x34a416 in DEFAULT_TIMEOUTS){if(_0x2a7b39[_0x1e2155(0x13f)](_0x34a416)){_0x8879e1=DEFAULT_TIMEOUTS[_0x34a416];break;}}if(!_0x8879e1&&_0x16f30b[_0x1e2155(0x149)])_0x8879e1=_0x16f30b[_0x1e2155(0x149)];if(!_0x8879e1)return;currentMonitoredRoom=_0x47a503,startTimer(_0x28632f,_0x8879e1,_0x47a503);}}function startTimer(_0x53f0b2,_0x746e07,_0x37f511){const _0x1fb3fc=a2_0x2a13;if(activeTimer)clearTimeout(activeTimer);timeoutMs=_0x746e07*0x3c*0x3e8,startTime=Date[_0x1fb3fc(0x125)](),alarmStage=0x0;const _0x4f0d21=calculateSleepProbability(_0x37f511||currentMonitoredRoom),_0x300fbe=_0x4f0d21>0.65;_0x300fbe?(timeoutMs+=0x5a*0x3c*0x3e8,_0x53f0b2[_0x1fb3fc(0x14b)][_0x1fb3fc(0x152)](_0x1fb3fc(0x120)+(_0x4f0d21*0x64)[_0x1fb3fc(0x127)](0x0)+'%).\x20VerlÃ¤ngere\x20Timer\x20fÃ¼r\x20'+currentMonitoredRoom+_0x1fb3fc(0x133)),_0x53f0b2[_0x1fb3fc(0x13d)]('analysis.safety.deadMan.smartSleep',{'val':!![],'ack':!![]})):_0x53f0b2[_0x1fb3fc(0x13d)](_0x1fb3fc(0x142),{'val':![],'ack':!![]}),_0x53f0b2[_0x1fb3fc(0x13d)]('analysis.safety.deadMan.napProbability',{'val':_0x4f0d21,'ack':!![]}),_0x53f0b2[_0x1fb3fc(0x14b)][_0x1fb3fc(0x152)](_0x1fb3fc(0x121)+currentMonitoredRoom+_0x1fb3fc(0x154)+_0x746e07+_0x1fb3fc(0x143)),_0x53f0b2[_0x1fb3fc(0x13d)]('analysis.safety.deadMan.alarmState',{'val':'ok','ack':!![]}),activeTimer=setTimeout(()=>triggerPreWarn(_0x53f0b2),timeoutMs);}function a2_0x4ccb(){const _0x261f8c=['error','[DeadMan]\x20Topology\x20check\x20failed:\x20','stringify','message','14jhieeK','info','pre_warn','\x20fÃ¼r\x20','ðŸ’¤\x20Smart\x20Sleep\x20erkannt\x20(','ðŸ‘¼\x20Schutzengel:\x20Ãœberwache\x20','144324wQNHBW','analysis.safety.deadMan.alarmState','20FrsrIQ','now','.\x20Alles\x20in\x20Ordnung?','toFixed','ðŸš¨\x20NOTFALL-ALARM:\x20Person\x20reagiert\x20nicht\x20in\x20','getStateAsync','alarm','795378ZGIVdw','350785RFEtxV','analysis.safety.deadMan.config','toString','sofa','bad','sendNotification','ðŸ‘¼\x20Schutzengel-Frage:\x20','\x20um\x2090\x20Min.','[DeadMan]\x20','parse','\x27.\x20Nicht\x20verbunden\x20mit\x20Ã¼berwachtem\x20\x27','(((.+)+)+)+$','Ignoriere\x20Bewegung\x20in\x20\x27','search','apply','20716VISWQa','exports','setStateAsync','warn','includes','val','1458160SktSHY','analysis.safety.deadMan.smartSleep','\x20Min.','7576749JTqGWf','indexOf','toLowerCase','bed','wohn','default','58600tfXLLp','log','living'];a2_0x4ccb=function(){return _0x261f8c;};return a2_0x4ccb();}function resetTimer(_0x3d8b37){const _0x2d6eb8=a2_0x2a13;if(activeTimer)clearTimeout(activeTimer);activeTimer=null,currentMonitoredRoom=null,alarmStage=0x0,_0x3d8b37['setStateAsync'](_0x2d6eb8(0x123),{'val':'ok','ack':!![]}),_0x3d8b37[_0x2d6eb8(0x13d)]('analysis.safety.deadMan.smartSleep',{'val':![],'ack':!![]}),_0x3d8b37[_0x2d6eb8(0x13d)]('analysis.safety.deadMan.napProbability',{'val':0x0,'ack':!![]});}async function triggerPreWarn(_0x4a8585){const _0x1f9501=a2_0x2a13;alarmStage=0x1,await _0x4a8585[_0x1f9501(0x13d)](_0x1f9501(0x123),{'val':_0x1f9501(0x153),'ack':!![]});const _0x5744ea='â³\x20ACHTUNG:\x20UngewÃ¶hnlich\x20lange\x20InaktivitÃ¤t\x20in\x20'+currentMonitoredRoom+_0x1f9501(0x126);_0x4a8585[_0x1f9501(0x14b)][_0x1f9501(0x13e)](_0x1f9501(0x134)+_0x5744ea),await setup['sendNotification'](_0x4a8585,_0x1f9501(0x132)+_0x5744ea),activeTimer=setTimeout(()=>triggerAlarm(_0x4a8585),0x5*0x3c*0x3e8);}async function triggerAlarm(_0x377d77){const _0x2d9256=a2_0x2a13;alarmStage=0x2,await _0x377d77[_0x2d9256(0x13d)](_0x2d9256(0x123),{'val':_0x2d9256(0x12a),'ack':!![]});const _0x13ab94=_0x2d9256(0x128)+currentMonitoredRoom+'!';_0x377d77[_0x2d9256(0x14b)][_0x2d9256(0x14d)](_0x2d9256(0x134)+_0x13ab94),await setup[_0x2d9256(0x131)](_0x377d77,_0x13ab94,![],!![]);}module[a2_0xad2f5b(0x13c)]={'updateLocation':updateLocation};