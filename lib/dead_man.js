const a2_0x27e3fd=a2_0x31f3;function a2_0x3b45(){const _0x55bdab=['1855088CqfgaC','1273958sHGski','parse','toLowerCase','694340AcTXbi','info','ðŸ‘¼\x20Schutzengel-Frage:\x20','bad','replace','ðŸš¨\x20NOTFALL-ALARM:\x20Person\x20reagiert\x20nicht\x20in\x20','(((.+)+)+)+$','analysis.safety.deadMan.currentRoom','62FJYKTJ','analysis.safety.deadMan.alarmState','analysis.safety.deadMan.config','./setup','pre_warn','default','1883860hXLlmI','ðŸ’¤\x20Smart\x20Sleep\x20erkannt\x20(','.\x20Alles\x20in\x20Ordnung?','log','now','18WCjjkS','92886hKWlmT','sofa','warn','toFixed','search','exports','schlaf','732192JBDcyb','231dugxqY','toString','constructor','wohn','analysis.topology.structure','includes','message','\x20fÃ¼r\x20','val','\x20um\x2090\x20Min.','16697835xozDET','[DeadMan]\x20Topology\x20check\x20failed:\x20','setStateAsync','apply','sendNotification','indexOf','error','bed','analysis.safety.deadMan.lastIgnored','alarm','analysis.safety.deadMan.smartSleep','Unknown','\x20(Multi-Person\x20Filter)','15BqIopz','getHours','ðŸ‘¼\x20Schutzengel:\x20Ãœberwache\x20','analysis.safety.deadMan.napProbability','analysis.safety.deadMan.active','[DeadMan]\x20'];a2_0x3b45=function(){return _0x55bdab;};return a2_0x3b45();}(function(_0x5064f4,_0x8c4915){const _0x1f35cf=a2_0x31f3,_0x15381f=_0x5064f4();while(!![]){try{const _0x38c3b3=parseInt(_0x1f35cf(0x189))/0x1+parseInt(_0x1f35cf(0x176))/0x2*(parseInt(_0x1f35cf(0x182))/0x3)+parseInt(_0x1f35cf(0x17c))/0x4*(-parseInt(_0x1f35cf(0x164))/0x5)+parseInt(_0x1f35cf(0x181))/0x6*(parseInt(_0x1f35cf(0x16b))/0x7)+-parseInt(_0x1f35cf(0x16a))/0x8+parseInt(_0x1f35cf(0x157))/0x9+-parseInt(_0x1f35cf(0x16e))/0xa*(parseInt(_0x1f35cf(0x18a))/0xb);if(_0x38c3b3===_0x8c4915)break;else _0x15381f['push'](_0x15381f['shift']());}catch(_0x22e58a){_0x15381f['push'](_0x15381f['shift']());}}}(a2_0x3b45,0xf1cd0));const a2_0x2aa797=(function(){let _0x139f85=!![];return function(_0x48bea3,_0x4b4c80){const _0x59768f=_0x139f85?function(){const _0x242b1d=a2_0x31f3;if(_0x4b4c80){const _0x4ee049=_0x4b4c80[_0x242b1d(0x15a)](_0x48bea3,arguments);return _0x4b4c80=null,_0x4ee049;}}:function(){};return _0x139f85=![],_0x59768f;};}()),a2_0x6aa9c3=a2_0x2aa797(this,function(){const _0x239ad9=a2_0x31f3;return a2_0x6aa9c3[_0x239ad9(0x18b)]()[_0x239ad9(0x186)](_0x239ad9(0x174))[_0x239ad9(0x18b)]()[_0x239ad9(0x18c)](a2_0x6aa9c3)['search']('(((.+)+)+)+$');});a2_0x6aa9c3();'use strict';const setup=require(a2_0x27e3fd(0x179));let activeTimer=null,currentMonitoredRoom=null,timeoutMs=0x0,startTime=0x0,alarmStage=0x0;const DEFAULT_TIMEOUTS={'bad':0x2d,'bath':0x2d,'toilet':0x1e,'wc':0x1e,'keller':0x3c,'schlaf':0x78,'bed':0x78,'guest':0x5a,'gast':0x5a};function getTimeoutRobust(_0x1ecacf,_0x477ca6){const _0x1dc804=a2_0x27e3fd;if(!_0x1ecacf||!_0x477ca6)return undefined;if(_0x1ecacf[_0x477ca6])return _0x1ecacf[_0x477ca6];const _0x8374b=_0x477ca6[_0x1dc804(0x16d)]()['replace'](/[^a-z0-9]/g,'');for(const _0xa3f3cc in _0x1ecacf){const _0x2e28ea=_0xa3f3cc[_0x1dc804(0x16d)]()[_0x1dc804(0x172)](/[^a-z0-9]/g,'');if(_0x2e28ea===_0x8374b)return _0x1ecacf[_0xa3f3cc];}const _0x697c2a=_0x477ca6[_0x1dc804(0x16d)]();if(_0x1ecacf[_0x697c2a])return _0x1ecacf[_0x697c2a];return undefined;}async function loadConfig(_0x310eba){const _0x3710f3=a2_0x27e3fd;try{const _0x3280dd=await _0x310eba['getStateAsync'](_0x3710f3(0x178));if(_0x3280dd&&_0x3280dd[_0x3710f3(0x155)])return JSON[_0x3710f3(0x16c)](_0x3280dd[_0x3710f3(0x155)]);}catch(_0x25878e){}return{};}async function isActive(_0x8b0df1){const _0x580dfe=a2_0x27e3fd;try{const _0x50a36f=await _0x8b0df1['getStateAsync'](_0x580dfe(0x168));return _0x50a36f&&_0x50a36f[_0x580dfe(0x155)];}catch(_0x34c1b5){return![];}}async function areRoomsConnected(_0x5d3500,_0x4090ec,_0x211c26){const _0x3a00e6=a2_0x27e3fd;try{const _0x5b877d=await _0x5d3500['getStateAsync'](_0x3a00e6(0x18e));if(!_0x5b877d||!_0x5b877d[_0x3a00e6(0x155)])return!![];const _0x546a77=JSON[_0x3a00e6(0x16c)](_0x5b877d['val']),{rooms:_0x2c47a6,matrix:_0x3118e2}=_0x546a77;if(!_0x2c47a6||!_0x3118e2)return!![];const _0x4f64b9=_0x2c47a6[_0x3a00e6(0x15c)](_0x4090ec),_0x148aba=_0x2c47a6[_0x3a00e6(0x15c)](_0x211c26);if(_0x4f64b9===-0x1||_0x148aba===-0x1)return!![];const _0x3dacd1=_0x3118e2[_0x4f64b9][_0x148aba]>0x0||_0x3118e2[_0x148aba][_0x4f64b9]>0x0;return _0x3dacd1;}catch(_0x44cb21){return _0x5d3500[_0x3a00e6(0x17f)][_0x3a00e6(0x184)](_0x3a00e6(0x158)+_0x44cb21[_0x3a00e6(0x190)]),!![];}}function calculateSleepProbability(_0x12817f){const _0x52c59e=a2_0x27e3fd,_0x6ee2e2=new Date(),_0x4ff33f=_0x6ee2e2[_0x52c59e(0x165)](),_0x1e97fa=_0x12817f['toLowerCase']();let _0x55c350=0.1;if(_0x4ff33f>=0x17||_0x4ff33f<=0x6)_0x55c350=0x1;else{if(_0x4ff33f>=0xd&&_0x4ff33f<=0xf)_0x55c350=0.8;else{if(_0x4ff33f>=0x14&&_0x4ff33f<=0x17)_0x55c350=0.4;}}let _0x382725=0.1;if(_0x1e97fa['includes'](_0x52c59e(0x188))||_0x1e97fa[_0x52c59e(0x18f)](_0x52c59e(0x15e)))_0x382725=0x1;else{if(_0x1e97fa[_0x52c59e(0x18f)](_0x52c59e(0x18d))||_0x1e97fa[_0x52c59e(0x18f)]('living')||_0x1e97fa[_0x52c59e(0x18f)](_0x52c59e(0x183)))_0x382725=0.6;else{if(_0x1e97fa[_0x52c59e(0x18f)](_0x52c59e(0x171))||_0x1e97fa[_0x52c59e(0x18f)]('wc'))_0x382725=0.05;}}let _0x497e07=0.5;const _0x824add=_0x382725*0.5+_0x55c350*0.3+_0x497e07*0.2;return parseFloat(_0x824add[_0x52c59e(0x185)](0x2));}async function updateLocation(_0x54036a,_0xccb989){const _0x6042f8=a2_0x27e3fd;if(!_0xccb989||_0xccb989===_0x6042f8(0x162))return;if(!await isActive(_0x54036a)){resetTimer(_0x54036a);return;}if(currentMonitoredRoom&&currentMonitoredRoom!==_0xccb989){const _0x555c64=await areRoomsConnected(_0x54036a,currentMonitoredRoom,_0xccb989);if(!_0x555c64){const _0x4cfd8d='Ignoriere\x20Bewegung\x20in\x20\x27'+_0xccb989+'\x27.\x20Nicht\x20verbunden\x20mit\x20Ã¼berwachtem\x20\x27'+currentMonitoredRoom+'\x27.';_0x54036a[_0x6042f8(0x17f)][_0x6042f8(0x16f)](_0x6042f8(0x169)+_0x4cfd8d+_0x6042f8(0x163)),await _0x54036a[_0x6042f8(0x159)](_0x6042f8(0x15f),{'val':JSON['stringify']({'room':_0xccb989,'reason':_0x4cfd8d,'timestamp':Date[_0x6042f8(0x180)]()}),'ack':!![]});return;}resetTimer(_0x54036a);}if(!currentMonitoredRoom){await _0x54036a['setStateAsync'](_0x6042f8(0x175),{'val':_0xccb989,'ack':!![]});const _0x1b30d9=await loadConfig(_0x54036a);let _0xb7ef13=getTimeoutRobust(_0x1b30d9,_0xccb989);const _0x3d1053=_0xccb989[_0x6042f8(0x16d)]();if(!_0xb7ef13)for(const _0x3d5d3f in DEFAULT_TIMEOUTS){if(_0x3d1053[_0x6042f8(0x18f)](_0x3d5d3f)){_0xb7ef13=DEFAULT_TIMEOUTS[_0x3d5d3f];break;}}if(!_0xb7ef13&&_0x1b30d9[_0x6042f8(0x17b)])_0xb7ef13=_0x1b30d9[_0x6042f8(0x17b)];if(!_0xb7ef13)return;currentMonitoredRoom=_0xccb989,startTimer(_0x54036a,_0xb7ef13,_0xccb989);}}function startTimer(_0x4ed280,_0x4e9821,_0x11019a){const _0x24cdbf=a2_0x27e3fd;if(activeTimer)clearTimeout(activeTimer);timeoutMs=_0x4e9821*0x3c*0x3e8,startTime=Date['now'](),alarmStage=0x0;const _0x2b4eb1=calculateSleepProbability(_0x11019a||currentMonitoredRoom),_0x872cf1=_0x2b4eb1>0.65;_0x872cf1?(timeoutMs+=0x5a*0x3c*0x3e8,_0x4ed280['log'][_0x24cdbf(0x16f)](_0x24cdbf(0x17d)+(_0x2b4eb1*0x64)[_0x24cdbf(0x185)](0x0)+'%).\x20VerlÃ¤ngere\x20Timer\x20fÃ¼r\x20'+currentMonitoredRoom+_0x24cdbf(0x156)),_0x4ed280[_0x24cdbf(0x159)]('analysis.safety.deadMan.smartSleep',{'val':!![],'ack':!![]})):_0x4ed280[_0x24cdbf(0x159)]('analysis.safety.deadMan.smartSleep',{'val':![],'ack':!![]}),_0x4ed280['setStateAsync'](_0x24cdbf(0x167),{'val':_0x2b4eb1,'ack':!![]}),_0x4ed280[_0x24cdbf(0x17f)][_0x24cdbf(0x16f)](_0x24cdbf(0x166)+currentMonitoredRoom+_0x24cdbf(0x191)+_0x4e9821+'\x20Min.'),_0x4ed280[_0x24cdbf(0x159)](_0x24cdbf(0x177),{'val':'ok','ack':!![]}),activeTimer=setTimeout(()=>triggerPreWarn(_0x4ed280),timeoutMs);}function a2_0x31f3(_0x1ac66b,_0x95eb93){const _0x1f2f29=a2_0x3b45();return a2_0x31f3=function(_0x6aa9c3,_0x2aa797){_0x6aa9c3=_0x6aa9c3-0x155;let _0x3b4570=_0x1f2f29[_0x6aa9c3];return _0x3b4570;},a2_0x31f3(_0x1ac66b,_0x95eb93);}function resetTimer(_0x540bb8){const _0x6d9adc=a2_0x27e3fd;if(activeTimer)clearTimeout(activeTimer);activeTimer=null,currentMonitoredRoom=null,alarmStage=0x0,_0x540bb8['setStateAsync'](_0x6d9adc(0x177),{'val':'ok','ack':!![]}),_0x540bb8['setStateAsync'](_0x6d9adc(0x161),{'val':![],'ack':!![]}),_0x540bb8['setStateAsync'](_0x6d9adc(0x167),{'val':0x0,'ack':!![]});}async function triggerPreWarn(_0x4fddee){const _0x4931bc=a2_0x27e3fd;alarmStage=0x1,await _0x4fddee[_0x4931bc(0x159)]('analysis.safety.deadMan.alarmState',{'val':_0x4931bc(0x17a),'ack':!![]});const _0x2934d5='â³\x20ACHTUNG:\x20UngewÃ¶hnlich\x20lange\x20InaktivitÃ¤t\x20in\x20'+currentMonitoredRoom+_0x4931bc(0x17e);_0x4fddee[_0x4931bc(0x17f)]['warn'](_0x4931bc(0x169)+_0x2934d5),await setup[_0x4931bc(0x15b)](_0x4fddee,_0x4931bc(0x170)+_0x2934d5),activeTimer=setTimeout(()=>triggerAlarm(_0x4fddee),0x5*0x3c*0x3e8);}async function triggerAlarm(_0x4a45ec){const _0x2575bb=a2_0x27e3fd;alarmStage=0x2,await _0x4a45ec[_0x2575bb(0x159)](_0x2575bb(0x177),{'val':_0x2575bb(0x160),'ack':!![]});const _0x5bda72=_0x2575bb(0x173)+currentMonitoredRoom+'!';_0x4a45ec[_0x2575bb(0x17f)][_0x2575bb(0x15d)](_0x2575bb(0x169)+_0x5bda72),await setup[_0x2575bb(0x15b)](_0x4a45ec,_0x5bda72,![],!![]);}module[a2_0x27e3fd(0x187)]={'updateLocation':updateLocation};