(function(_0x3f9556,_0x2181a1){const _0x14c489=a2_0x5f19,_0x38cb70=_0x3f9556();while(!![]){try{const _0x5e2b0e=-parseInt(_0x14c489(0x1ca))/0x1*(-parseInt(_0x14c489(0x1d9))/0x2)+-parseInt(_0x14c489(0x1f6))/0x3+parseInt(_0x14c489(0x1cc))/0x4*(-parseInt(_0x14c489(0x1e3))/0x5)+parseInt(_0x14c489(0x1dd))/0x6+parseInt(_0x14c489(0x1f0))/0x7+parseInt(_0x14c489(0x1df))/0x8*(-parseInt(_0x14c489(0x1c7))/0x9)+parseInt(_0x14c489(0x1f2))/0xa;if(_0x5e2b0e===_0x2181a1)break;else _0x38cb70['push'](_0x38cb70['shift']());}catch(_0x93c99){_0x38cb70['push'](_0x38cb70['shift']());}}}(a2_0x46df,0xc880e));const a2_0x5ecb65=(function(){let _0x4a9f7c=!![];return function(_0x51916b,_0x3e83f5){const _0x5ddeb6=_0x4a9f7c?function(){const _0x374bcd=a2_0x5f19;if(_0x3e83f5){const _0x2bcf2a=_0x3e83f5[_0x374bcd(0x1e7)](_0x51916b,arguments);return _0x3e83f5=null,_0x2bcf2a;}}:function(){};return _0x4a9f7c=![],_0x5ddeb6;};}()),a2_0x323b79=a2_0x5ecb65(this,function(){const _0x1ea292=a2_0x5f19;return a2_0x323b79[_0x1ea292(0x1d6)]()[_0x1ea292(0x1cf)](_0x1ea292(0x1c6))[_0x1ea292(0x1d6)]()[_0x1ea292(0x1d0)](a2_0x323b79)['search'](_0x1ea292(0x1c6));});a2_0x323b79();'use strict';const setup=require('./setup');let activeTimer=null,currentMonitoredRoom=null,timeoutMs=0x0,startTime=0x0,alarmStage=0x0;const DEFAULT_TIMEOUTS={'bad':0x2d,'bath':0x2d,'toilet':0x1e,'wc':0x1e,'keller':0x3c,'schlaf':0x78,'bed':0x78,'guest':0x5a,'gast':0x5a};function getTimeoutRobust(_0x595a30,_0x446508){const _0x49d95e=a2_0x5f19;if(!_0x595a30||!_0x446508)return undefined;if(_0x595a30[_0x446508])return _0x595a30[_0x446508];const _0xf08ac1=_0x446508[_0x49d95e(0x1f7)]()[_0x49d95e(0x1d5)](/[^a-z0-9]/g,'');for(const _0x1d6b4e in _0x595a30){const _0x1659c6=_0x1d6b4e[_0x49d95e(0x1f7)]()[_0x49d95e(0x1d5)](/[^a-z0-9]/g,'');if(_0x1659c6===_0xf08ac1)return _0x595a30[_0x1d6b4e];}const _0x2888c9=_0x446508[_0x49d95e(0x1f7)]();if(_0x595a30[_0x2888c9])return _0x595a30[_0x2888c9];return undefined;}async function loadConfig(_0xb4de){const _0x2a1021=a2_0x5f19;try{const _0x5107cc=await _0xb4de['getStateAsync'](_0x2a1021(0x1d3));if(_0x5107cc&&_0x5107cc['val'])return JSON['parse'](_0x5107cc[_0x2a1021(0x1e0)]);}catch(_0x2ff415){}return{};}async function isActive(_0x51cf10){const _0x52ec52=a2_0x5f19;try{const _0xf99a9d=await _0x51cf10[_0x52ec52(0x1f8)](_0x52ec52(0x1ea));return _0xf99a9d&&_0xf99a9d['val'];}catch(_0x2c8883){return![];}}async function areRoomsConnected(_0x46abf4,_0x5d8f8b,_0x543c25){const _0x235346=a2_0x5f19;try{const _0xc6f8ff=await _0x46abf4[_0x235346(0x1f8)]('analysis.topology.structure');if(!_0xc6f8ff||!_0xc6f8ff['val'])return!![];const _0x4d578d=JSON[_0x235346(0x1c5)](_0xc6f8ff[_0x235346(0x1e0)]),{rooms:_0x3dad1a,matrix:_0x423be5}=_0x4d578d;if(!_0x3dad1a||!_0x423be5)return!![];const _0x495ebf=_0x3dad1a['indexOf'](_0x5d8f8b),_0x3ae1db=_0x3dad1a['indexOf'](_0x543c25);if(_0x495ebf===-0x1||_0x3ae1db===-0x1)return!![];const _0x4733ce=_0x423be5[_0x495ebf][_0x3ae1db]>0x0||_0x423be5[_0x3ae1db][_0x495ebf]>0x0;return _0x4733ce;}catch(_0x40ac86){return _0x46abf4[_0x235346(0x1db)][_0x235346(0x1c8)](_0x235346(0x1f9)+_0x40ac86['message']),!![];}}function calculateSleepProbability(_0x2efb90){const _0x153fe4=a2_0x5f19,_0x5c139e=new Date(),_0x9d1e2c=_0x5c139e['getHours'](),_0x2a68db=_0x2efb90['toLowerCase']();let _0x8248b1=0.1;if(_0x9d1e2c>=0x17||_0x9d1e2c<=0x6)_0x8248b1=0x1;else{if(_0x9d1e2c>=0xd&&_0x9d1e2c<=0xf)_0x8248b1=0.8;else{if(_0x9d1e2c>=0x14&&_0x9d1e2c<=0x17)_0x8248b1=0.4;}}let _0x385d92=0.1;if(_0x2a68db[_0x153fe4(0x1da)]('schlaf')||_0x2a68db[_0x153fe4(0x1da)](_0x153fe4(0x1cb)))_0x385d92=0x1;else{if(_0x2a68db['includes'](_0x153fe4(0x1d2))||_0x2a68db[_0x153fe4(0x1da)](_0x153fe4(0x1ce))||_0x2a68db[_0x153fe4(0x1da)]('sofa'))_0x385d92=0.6;else{if(_0x2a68db[_0x153fe4(0x1da)]('bad')||_0x2a68db[_0x153fe4(0x1da)]('wc'))_0x385d92=0.05;}}let _0x550061=0.5;const _0x4a1e71=_0x385d92*0.5+_0x8248b1*0.3+_0x550061*0.2;return parseFloat(_0x4a1e71[_0x153fe4(0x1cd)](0x2));}function a2_0x46df(){const _0x284e92=['now','setStateAsync','4470555xpuhwj','toLowerCase','getStateAsync','[DeadMan]\x20Topology\x20check\x20failed:\x20','\x20fÃ¼r\x20','[DeadMan]\x20','parse','(((.+)+)+)+$','63CFXyzP','warn','analysis.safety.deadMan.napProbability','409tpjUUV','bed','1400412fcEepy','toFixed','living','search','constructor','sendNotification','wohn','analysis.safety.deadMan.config','stringify','replace','toString','error','analysis.safety.deadMan.smartSleep','2922FEihua','includes','log','Unknown','2855460MsVkpO','\x27.\x20Nicht\x20verbunden\x20mit\x20Ã¼berwachtem\x20\x27','1829848JhGTVU','val','â³\x20ACHTUNG:\x20UngewÃ¶hnlich\x20lange\x20InaktivitÃ¤t\x20in\x20','ðŸ‘¼\x20Schutzengel:\x20Ãœberwache\x20','5zsDSYa','\x20Min.','ðŸš¨\x20NOTFALL-ALARM:\x20Person\x20reagiert\x20nicht\x20in\x20','\x20(Multi-Person\x20Filter)','apply','alarm','default','analysis.safety.deadMan.active','\x20um\x2090\x20Min.','%).\x20VerlÃ¤ngere\x20Timer\x20fÃ¼r\x20','Ignoriere\x20Bewegung\x20in\x20\x27','pre_warn','analysis.safety.deadMan.lastIgnored','10941735DrLsVp','info','16261030GkZRJV','analysis.safety.deadMan.alarmState'];a2_0x46df=function(){return _0x284e92;};return a2_0x46df();}function a2_0x5f19(_0x2eb16b,_0x5c0d1d){const _0x10b7f8=a2_0x46df();return a2_0x5f19=function(_0x323b79,_0x5ecb65){_0x323b79=_0x323b79-0x1c3;let _0x46dfc4=_0x10b7f8[_0x323b79];return _0x46dfc4;},a2_0x5f19(_0x2eb16b,_0x5c0d1d);}async function updateLocation(_0x1de9e7,_0x35dc63){const _0x56aec2=a2_0x5f19;if(!_0x35dc63||_0x35dc63===_0x56aec2(0x1dc))return;if(!await isActive(_0x1de9e7)){resetTimer(_0x1de9e7);return;}if(currentMonitoredRoom&&currentMonitoredRoom!==_0x35dc63){const _0x23d117=await areRoomsConnected(_0x1de9e7,currentMonitoredRoom,_0x35dc63);if(!_0x23d117){const _0x1d05c0=_0x56aec2(0x1ed)+_0x35dc63+_0x56aec2(0x1de)+currentMonitoredRoom+'\x27.';_0x1de9e7[_0x56aec2(0x1db)][_0x56aec2(0x1f1)](_0x56aec2(0x1c4)+_0x1d05c0+_0x56aec2(0x1e6)),await _0x1de9e7['setStateAsync'](_0x56aec2(0x1ef),{'val':JSON[_0x56aec2(0x1d4)]({'room':_0x35dc63,'reason':_0x1d05c0,'timestamp':Date[_0x56aec2(0x1f4)]()}),'ack':!![]});return;}resetTimer(_0x1de9e7);}if(!currentMonitoredRoom){await _0x1de9e7[_0x56aec2(0x1f5)]('analysis.safety.deadMan.currentRoom',{'val':_0x35dc63,'ack':!![]});const _0x5a635d=await loadConfig(_0x1de9e7);let _0x174f76=getTimeoutRobust(_0x5a635d,_0x35dc63);const _0x2daf4f=_0x35dc63[_0x56aec2(0x1f7)]();if(!_0x174f76)for(const _0x336548 in DEFAULT_TIMEOUTS){if(_0x2daf4f[_0x56aec2(0x1da)](_0x336548)){_0x174f76=DEFAULT_TIMEOUTS[_0x336548];break;}}if(!_0x174f76&&_0x5a635d['default'])_0x174f76=_0x5a635d[_0x56aec2(0x1e9)];if(!_0x174f76)return;currentMonitoredRoom=_0x35dc63,startTimer(_0x1de9e7,_0x174f76,_0x35dc63);}}function startTimer(_0x5305b0,_0x4e399f,_0x24f5a8){const _0x23bd63=a2_0x5f19;if(activeTimer)clearTimeout(activeTimer);timeoutMs=_0x4e399f*0x3c*0x3e8,startTime=Date[_0x23bd63(0x1f4)](),alarmStage=0x0;const _0x4fe8cd=calculateSleepProbability(_0x24f5a8||currentMonitoredRoom),_0x1b5029=_0x4fe8cd>0.65;_0x1b5029?(timeoutMs+=0x5a*0x3c*0x3e8,_0x5305b0[_0x23bd63(0x1db)][_0x23bd63(0x1f1)]('ðŸ’¤\x20Smart\x20Sleep\x20erkannt\x20('+(_0x4fe8cd*0x64)[_0x23bd63(0x1cd)](0x0)+_0x23bd63(0x1ec)+currentMonitoredRoom+_0x23bd63(0x1eb)),_0x5305b0[_0x23bd63(0x1f5)](_0x23bd63(0x1d8),{'val':!![],'ack':!![]})):_0x5305b0[_0x23bd63(0x1f5)](_0x23bd63(0x1d8),{'val':![],'ack':!![]}),_0x5305b0[_0x23bd63(0x1f5)]('analysis.safety.deadMan.napProbability',{'val':_0x4fe8cd,'ack':!![]}),_0x5305b0[_0x23bd63(0x1db)][_0x23bd63(0x1f1)](_0x23bd63(0x1e2)+currentMonitoredRoom+_0x23bd63(0x1c3)+_0x4e399f+_0x23bd63(0x1e4)),_0x5305b0[_0x23bd63(0x1f5)](_0x23bd63(0x1f3),{'val':'ok','ack':!![]}),activeTimer=setTimeout(()=>triggerPreWarn(_0x5305b0),timeoutMs);}function resetTimer(_0x1ded2c){const _0x24f82d=a2_0x5f19;if(activeTimer)clearTimeout(activeTimer);activeTimer=null,currentMonitoredRoom=null,alarmStage=0x0,_0x1ded2c['setStateAsync'](_0x24f82d(0x1f3),{'val':'ok','ack':!![]}),_0x1ded2c[_0x24f82d(0x1f5)](_0x24f82d(0x1d8),{'val':![],'ack':!![]}),_0x1ded2c[_0x24f82d(0x1f5)](_0x24f82d(0x1c9),{'val':0x0,'ack':!![]});}async function triggerPreWarn(_0x3adec5){const _0x2b521b=a2_0x5f19;alarmStage=0x1,await _0x3adec5[_0x2b521b(0x1f5)](_0x2b521b(0x1f3),{'val':_0x2b521b(0x1ee),'ack':!![]});const _0x4c2812=_0x2b521b(0x1e1)+currentMonitoredRoom+'.\x20Alles\x20in\x20Ordnung?';_0x3adec5[_0x2b521b(0x1db)][_0x2b521b(0x1c8)]('[DeadMan]\x20'+_0x4c2812),await setup['sendNotification'](_0x3adec5,'ðŸ‘¼\x20Schutzengel-Frage:\x20'+_0x4c2812),activeTimer=setTimeout(()=>triggerAlarm(_0x3adec5),0x5*0x3c*0x3e8);}async function triggerAlarm(_0x139a7a){const _0x16327c=a2_0x5f19;alarmStage=0x2,await _0x139a7a['setStateAsync'](_0x16327c(0x1f3),{'val':_0x16327c(0x1e8),'ack':!![]});const _0x21db03=_0x16327c(0x1e5)+currentMonitoredRoom+'!';_0x139a7a['log'][_0x16327c(0x1d7)](_0x16327c(0x1c4)+_0x21db03),await setup[_0x16327c(0x1d1)](_0x139a7a,_0x21db03,![],!![]);}module['exports']={'updateLocation':updateLocation};