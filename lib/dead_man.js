const a2_0x52707a=a2_0x80a0;(function(_0x19a38f,_0x30a97b){const _0x5038d4=a2_0x80a0,_0x2a1469=_0x19a38f();while(!![]){try{const _0x6ff12=-parseInt(_0x5038d4(0xa2))/0x1+-parseInt(_0x5038d4(0x8d))/0x2*(parseInt(_0x5038d4(0xad))/0x3)+parseInt(_0x5038d4(0x9d))/0x4+parseInt(_0x5038d4(0xb8))/0x5+parseInt(_0x5038d4(0x8f))/0x6*(-parseInt(_0x5038d4(0xae))/0x7)+-parseInt(_0x5038d4(0xac))/0x8*(-parseInt(_0x5038d4(0x84))/0x9)+-parseInt(_0x5038d4(0x90))/0xa*(parseInt(_0x5038d4(0xa7))/0xb);if(_0x6ff12===_0x30a97b)break;else _0x2a1469['push'](_0x2a1469['shift']());}catch(_0x241010){_0x2a1469['push'](_0x2a1469['shift']());}}}(a2_0x1d60,0x25c36));const a2_0x4c03d0=(function(){let _0x2297aa=!![];return function(_0x305ae6,_0x49db25){const _0x48fe78=_0x2297aa?function(){const _0x122a77=a2_0x80a0;if(_0x49db25){const _0x46baf0=_0x49db25[_0x122a77(0x85)](_0x305ae6,arguments);return _0x49db25=null,_0x46baf0;}}:function(){};return _0x2297aa=![],_0x48fe78;};}()),a2_0x5c0756=a2_0x4c03d0(this,function(){const _0x457132=a2_0x80a0;return a2_0x5c0756[_0x457132(0xa4)]()[_0x457132(0xb0)](_0x457132(0x8a))[_0x457132(0xa4)]()['constructor'](a2_0x5c0756)['search'](_0x457132(0x8a));});a2_0x5c0756();'use strict';function a2_0x80a0(_0x2783b5,_0x197cf9){const _0xd96fc3=a2_0x1d60();return a2_0x80a0=function(_0x5c0756,_0x4c03d0){_0x5c0756=_0x5c0756-0x7b;let _0x1d6034=_0xd96fc3[_0x5c0756];return _0x1d6034;},a2_0x80a0(_0x2783b5,_0x197cf9);}const setup=require(a2_0x52707a(0x87));let activeTimer=null,currentMonitoredRoom=null,timeoutMs=0x0,startTime=0x0,alarmStage=0x0;const DEFAULT_TIMEOUTS={'bad':0x2d,'bath':0x2d,'toilet':0x1e,'wc':0x1e,'keller':0x3c,'schlaf':0x78,'bed':0x78,'guest':0x5a,'gast':0x5a};function getTimeoutRobust(_0x372964,_0xa82657){const _0x589837=a2_0x52707a;if(!_0x372964||!_0xa82657)return undefined;if(_0x372964[_0xa82657])return _0x372964[_0xa82657];const _0x3d0106=_0xa82657[_0x589837(0x88)]()[_0x589837(0x9f)](/[^a-z0-9]/g,'');for(const _0x48e786 in _0x372964){const _0x4ef579=_0x48e786['toLowerCase']()[_0x589837(0x9f)](/[^a-z0-9]/g,'');if(_0x4ef579===_0x3d0106)return _0x372964[_0x48e786];}const _0x4418dd=_0xa82657[_0x589837(0x88)]();if(_0x372964[_0x4418dd])return _0x372964[_0x4418dd];return undefined;}async function loadConfig(_0x536b09){const _0x3244d8=a2_0x52707a;try{const _0x34c88e=await _0x536b09[_0x3244d8(0x98)]('analysis.safety.deadMan.config');if(_0x34c88e&&_0x34c88e[_0x3244d8(0x89)])return JSON['parse'](_0x34c88e[_0x3244d8(0x89)]);}catch(_0x2542ca){}return{};}async function isActive(_0x3de2cd){const _0x4332d5=a2_0x52707a;try{const _0xe827d4=await _0x3de2cd[_0x4332d5(0x98)](_0x4332d5(0x9b));return _0xe827d4&&_0xe827d4[_0x4332d5(0x89)];}catch(_0x39cb72){return![];}}async function areRoomsConnected(_0x398b52,_0x3a2a5f,_0x121599){const _0x4e9c4e=a2_0x52707a;try{const _0x1c504b=await _0x398b52[_0x4e9c4e(0x98)](_0x4e9c4e(0x94));if(!_0x1c504b||!_0x1c504b[_0x4e9c4e(0x89)])return!![];const _0x335336=JSON[_0x4e9c4e(0x7f)](_0x1c504b['val']),{rooms:_0x46f138,matrix:_0x30a4aa}=_0x335336;if(!_0x46f138||!_0x30a4aa)return!![];const _0x528045=_0x46f138[_0x4e9c4e(0x99)](_0x3a2a5f),_0x5cb1e1=_0x46f138['indexOf'](_0x121599);if(_0x528045===-0x1||_0x5cb1e1===-0x1)return!![];const _0x3bf372=_0x30a4aa[_0x528045][_0x5cb1e1]>0x0||_0x30a4aa[_0x5cb1e1][_0x528045]>0x0;return _0x3bf372;}catch(_0x1feb82){return _0x398b52['log'][_0x4e9c4e(0x96)]('[DeadMan]\x20Topology\x20check\x20failed:\x20'+_0x1feb82[_0x4e9c4e(0x82)]),!![];}}function calculateSleepProbability(_0x9a6c5){const _0x7fbbdb=a2_0x52707a,_0x556ef8=new Date(),_0x24503=_0x556ef8[_0x7fbbdb(0x7c)](),_0x2600ed=_0x9a6c5[_0x7fbbdb(0x88)]();let _0x13f0ad=0.1;if(_0x24503>=0x17||_0x24503<=0x6)_0x13f0ad=0x1;else{if(_0x24503>=0xd&&_0x24503<=0xf)_0x13f0ad=0.8;else{if(_0x24503>=0x14&&_0x24503<=0x17)_0x13f0ad=0.4;}}let _0x4f2f21=0.1;if(_0x2600ed[_0x7fbbdb(0x8e)](_0x7fbbdb(0xb9))||_0x2600ed[_0x7fbbdb(0x8e)](_0x7fbbdb(0x91)))_0x4f2f21=0x1;else{if(_0x2600ed[_0x7fbbdb(0x8e)]('wohn')||_0x2600ed[_0x7fbbdb(0x8e)](_0x7fbbdb(0xaa))||_0x2600ed[_0x7fbbdb(0x8e)](_0x7fbbdb(0x80)))_0x4f2f21=0.6;else{if(_0x2600ed[_0x7fbbdb(0x8e)](_0x7fbbdb(0x8c))||_0x2600ed[_0x7fbbdb(0x8e)]('wc'))_0x4f2f21=0.05;}}let _0x56d91d=0.5;const _0x52a0e8=_0x4f2f21*0.5+_0x13f0ad*0.3+_0x56d91d*0.2;return parseFloat(_0x52a0e8['toFixed'](0x2));}async function updateLocation(_0x17341f,_0x38d21d){const _0x1292ea=a2_0x52707a;if(!_0x38d21d||_0x38d21d===_0x1292ea(0xa9))return;if(!await isActive(_0x17341f)){resetTimer(_0x17341f);return;}if(currentMonitoredRoom&&currentMonitoredRoom!==_0x38d21d){const _0x31ef4f=await areRoomsConnected(_0x17341f,currentMonitoredRoom,_0x38d21d);if(!_0x31ef4f){const _0x263829=_0x1292ea(0xb2)+_0x38d21d+_0x1292ea(0x9e)+currentMonitoredRoom+'\x27.';_0x17341f[_0x1292ea(0xa0)][_0x1292ea(0xb1)](_0x1292ea(0x81)+_0x263829+'\x20(Multi-Person\x20Filter)'),await _0x17341f[_0x1292ea(0x7d)](_0x1292ea(0x93),{'val':JSON[_0x1292ea(0xa6)]({'room':_0x38d21d,'reason':_0x263829,'timestamp':Date[_0x1292ea(0x97)]()}),'ack':!![]});return;}resetTimer(_0x17341f);}if(!currentMonitoredRoom){await _0x17341f['setStateAsync'](_0x1292ea(0x8b),{'val':_0x38d21d,'ack':!![]});const _0x31505b=await loadConfig(_0x17341f);let _0x1acf28=getTimeoutRobust(_0x31505b,_0x38d21d);const _0x4c3a2b=_0x38d21d[_0x1292ea(0x88)]();if(!_0x1acf28)for(const _0x6af235 in DEFAULT_TIMEOUTS){if(_0x4c3a2b[_0x1292ea(0x8e)](_0x6af235)){_0x1acf28=DEFAULT_TIMEOUTS[_0x6af235];break;}}if(!_0x1acf28&&_0x31505b[_0x1292ea(0xb5)])_0x1acf28=_0x31505b[_0x1292ea(0xb5)];if(!_0x1acf28)return;currentMonitoredRoom=_0x38d21d,startTimer(_0x17341f,_0x1acf28,_0x38d21d);}}function startTimer(_0x3b57e4,_0x38a78c,_0x153d84){const _0x18993e=a2_0x52707a;if(activeTimer)clearTimeout(activeTimer);timeoutMs=_0x38a78c*0x3c*0x3e8,startTime=Date[_0x18993e(0x97)](),alarmStage=0x0;const _0x724ec0=calculateSleepProbability(_0x153d84||currentMonitoredRoom),_0x492bc3=_0x724ec0>0.65;_0x492bc3?(timeoutMs+=0x5a*0x3c*0x3e8,_0x3b57e4[_0x18993e(0xa0)]['info'](_0x18993e(0xb3)+(_0x724ec0*0x64)[_0x18993e(0x9c)](0x0)+'%).\x20VerlÃ¤ngere\x20Timer\x20fÃ¼r\x20'+currentMonitoredRoom+_0x18993e(0xb6)),_0x3b57e4[_0x18993e(0x7d)]('analysis.safety.deadMan.smartSleep',{'val':!![],'ack':!![]})):_0x3b57e4[_0x18993e(0x7d)](_0x18993e(0x7b),{'val':![],'ack':!![]}),_0x3b57e4[_0x18993e(0x7d)](_0x18993e(0xaf),{'val':_0x724ec0,'ack':!![]}),_0x3b57e4[_0x18993e(0xa0)][_0x18993e(0xb1)](_0x18993e(0x86)+currentMonitoredRoom+_0x18993e(0xa8)+_0x38a78c+_0x18993e(0xb4)),_0x3b57e4['setStateAsync'](_0x18993e(0x92),{'val':'ok','ack':!![]}),activeTimer=setTimeout(()=>triggerPreWarn(_0x3b57e4),timeoutMs);}function resetTimer(_0x32b8a2){const _0x27617a=a2_0x52707a;if(activeTimer)clearTimeout(activeTimer);activeTimer=null,currentMonitoredRoom=null,alarmStage=0x0,_0x32b8a2[_0x27617a(0x7d)](_0x27617a(0x92),{'val':'ok','ack':!![]}),_0x32b8a2[_0x27617a(0x7d)](_0x27617a(0x7b),{'val':![],'ack':!![]}),_0x32b8a2[_0x27617a(0x7d)]('analysis.safety.deadMan.napProbability',{'val':0x0,'ack':!![]});}function a2_0x1d60(){const _0x556802=['308LDTLcs','analysis.safety.deadMan.napProbability','search','info','Ignoriere\x20Bewegung\x20in\x20\x27','ðŸ’¤\x20Smart\x20Sleep\x20erkannt\x20(','\x20Min.','default','\x20um\x2090\x20Min.','â³\x20ACHTUNG:\x20UngewÃ¶hnlich\x20lange\x20InaktivitÃ¤t\x20in\x20','1527605PlrFMx','schlaf','analysis.safety.deadMan.smartSleep','getHours','setStateAsync','exports','parse','sofa','[DeadMan]\x20','message','sendNotification','18alegsV','apply','ðŸ‘¼\x20Schutzengel:\x20Ãœberwache\x20','./setup','toLowerCase','val','(((.+)+)+)+$','analysis.safety.deadMan.currentRoom','bad','13170JiIhCZ','includes','33054zhqXUZ','1070jOFmEH','bed','analysis.safety.deadMan.alarmState','analysis.safety.deadMan.lastIgnored','analysis.topology.structure','pre_warn','warn','now','getStateAsync','indexOf','ðŸš¨\x20NOTFALL-ALARM:\x20Person\x20reagiert\x20nicht\x20in\x20','analysis.safety.deadMan.active','toFixed','632244bcGlgp','\x27.\x20Nicht\x20verbunden\x20mit\x20Ã¼berwachtem\x20\x27','replace','log','error','93022uuxBzf','.\x20Alles\x20in\x20Ordnung?','toString','alarm','stringify','14938rILQfw','\x20fÃ¼r\x20','Unknown','living','ðŸ‘¼\x20Schutzengel-Frage:\x20','1056040vowJIH','42QjfgvQ'];a2_0x1d60=function(){return _0x556802;};return a2_0x1d60();}async function triggerPreWarn(_0x2bf8cc){const _0x5c292f=a2_0x52707a;alarmStage=0x1,await _0x2bf8cc[_0x5c292f(0x7d)](_0x5c292f(0x92),{'val':_0x5c292f(0x95),'ack':!![]});const _0x4fd82d=_0x5c292f(0xb7)+currentMonitoredRoom+_0x5c292f(0xa3);_0x2bf8cc[_0x5c292f(0xa0)][_0x5c292f(0x96)](_0x5c292f(0x81)+_0x4fd82d),await setup[_0x5c292f(0x83)](_0x2bf8cc,_0x5c292f(0xab)+_0x4fd82d),activeTimer=setTimeout(()=>triggerAlarm(_0x2bf8cc),0x5*0x3c*0x3e8);}async function triggerAlarm(_0x15cbba){const _0x56e3b6=a2_0x52707a;alarmStage=0x2,await _0x15cbba[_0x56e3b6(0x7d)](_0x56e3b6(0x92),{'val':_0x56e3b6(0xa5),'ack':!![]});const _0x5e6b3b=_0x56e3b6(0x9a)+currentMonitoredRoom+'!';_0x15cbba['log'][_0x56e3b6(0xa1)](_0x56e3b6(0x81)+_0x5e6b3b),await setup[_0x56e3b6(0x83)](_0x15cbba,_0x5e6b3b,![],!![]);}module[a2_0x52707a(0x7e)]={'updateLocation':updateLocation};