const a2_0x24d2ca=a2_0x1f22;(function(_0x4deaee,_0x3fdcb9){const _0x2ddb25=a2_0x1f22,_0x242c84=_0x4deaee();while(!![]){try{const _0x1eaf4d=parseInt(_0x2ddb25(0x1e3))/0x1+-parseInt(_0x2ddb25(0x1e7))/0x2*(parseInt(_0x2ddb25(0x1e4))/0x3)+parseInt(_0x2ddb25(0x1d8))/0x4+-parseInt(_0x2ddb25(0x1e5))/0x5+parseInt(_0x2ddb25(0x1e0))/0x6+parseInt(_0x2ddb25(0x1df))/0x7+-parseInt(_0x2ddb25(0x1eb))/0x8;if(_0x1eaf4d===_0x3fdcb9)break;else _0x242c84['push'](_0x242c84['shift']());}catch(_0xd468c5){_0x242c84['push'](_0x242c84['shift']());}}}(a2_0x554d,0xc42af));const a2_0x3e1a26=(function(){let _0x1be6e2=!![];return function(_0x3574f1,_0x1cb760){const _0x5edc79=_0x1be6e2?function(){const _0x1ab254=a2_0x1f22;if(_0x1cb760){const _0xf11a92=_0x1cb760[_0x1ab254(0x1f8)](_0x3574f1,arguments);return _0x1cb760=null,_0xf11a92;}}:function(){};return _0x1be6e2=![],_0x5edc79;};}()),a2_0xd70b52=a2_0x3e1a26(this,function(){const _0x320314=a2_0x1f22;return a2_0xd70b52['toString']()['search'](_0x320314(0x1ce))['toString']()[_0x320314(0x1f7)](a2_0xd70b52)[_0x320314(0x1e6)]('(((.+)+)+)+$');});a2_0xd70b52();function a2_0x554d(){const _0x24079e=['2952398RuoCHt','log','ðŸ‘¼\x20Schutzengel-Frage:\x20','ðŸ’¤\x20Smart\x20Sleep\x20erkannt\x20(','1537896gGMmLv','alarm','./setup','bed','default','â³\x20ACHTUNG:\x20UngewÃ¶hnlich\x20lange\x20InaktivitÃ¤t\x20in\x20','sendNotification','analysis.safety.deadMan.smartSleep','toFixed','analysis.safety.deadMan.active','\x20fÃ¼r\x20','val','constructor','apply','getStateAsync','replace','analysis.safety.deadMan.config','now','Ignoriere\x20Bewegung\x20in\x20\x27','toLowerCase','message','includes','\x20Min.','\x27.\x20Nicht\x20verbunden\x20mit\x20Ã¼berwachtem\x20\x27','(((.+)+)+)+$','\x20(Multi-Person\x20Filter)','warn','analysis.safety.deadMan.alarmState','[DeadMan]\x20','pre_warn','setStateAsync','exports','bad','analysis.safety.deadMan.currentRoom','393876ZZpsiL','analysis.safety.deadMan.napProbability','error','schlaf','sofa','indexOf','\x20um\x2090\x20Min.','10960460kFSKLq','1829892JxEwzv','[DeadMan]\x20Topology\x20check\x20failed:\x20','info','957724aFPwHV','3XRoIyP','2275080XuovvP','search'];a2_0x554d=function(){return _0x24079e;};return a2_0x554d();}'use strict';const setup=require(a2_0x24d2ca(0x1ed));let activeTimer=null,currentMonitoredRoom=null,timeoutMs=0x0,startTime=0x0,alarmStage=0x0;function a2_0x1f22(_0x19360b,_0x4911da){const _0x466582=a2_0x554d();return a2_0x1f22=function(_0xd70b52,_0x3e1a26){_0xd70b52=_0xd70b52-0x1c4;let _0x554d1a=_0x466582[_0xd70b52];return _0x554d1a;},a2_0x1f22(_0x19360b,_0x4911da);}const DEFAULT_TIMEOUTS={'bad':0x2d,'bath':0x2d,'toilet':0x1e,'wc':0x1e,'keller':0x3c,'schlaf':0x78,'bed':0x78,'guest':0x5a,'gast':0x5a};function getTimeoutRobust(_0x28abab,_0x50a65d){const _0x5fbac6=a2_0x24d2ca;if(!_0x28abab||!_0x50a65d)return undefined;if(_0x28abab[_0x50a65d])return _0x28abab[_0x50a65d];const _0x5c6974=_0x50a65d[_0x5fbac6(0x1c9)]()[_0x5fbac6(0x1c5)](/[^a-z0-9]/g,'');for(const _0x224515 in _0x28abab){const _0x3b9f14=_0x224515[_0x5fbac6(0x1c9)]()[_0x5fbac6(0x1c5)](/[^a-z0-9]/g,'');if(_0x3b9f14===_0x5c6974)return _0x28abab[_0x224515];}const _0x3b8ee2=_0x50a65d['toLowerCase']();if(_0x28abab[_0x3b8ee2])return _0x28abab[_0x3b8ee2];return undefined;}async function loadConfig(_0x13f4b6){const _0x30d807=a2_0x24d2ca;try{const _0x2fd71b=await _0x13f4b6[_0x30d807(0x1c4)](_0x30d807(0x1c6));if(_0x2fd71b&&_0x2fd71b[_0x30d807(0x1f6)])return JSON['parse'](_0x2fd71b[_0x30d807(0x1f6)]);}catch(_0x34859a){}return{};}async function isActive(_0x51fb03){const _0x1b5549=a2_0x24d2ca;try{const _0x2481bf=await _0x51fb03[_0x1b5549(0x1c4)](_0x1b5549(0x1f4));return _0x2481bf&&_0x2481bf[_0x1b5549(0x1f6)];}catch(_0x12ad7d){return![];}}async function areRoomsConnected(_0x208f8f,_0x5e6c7e,_0x5eaec){const _0x30ae65=a2_0x24d2ca;try{const _0x25a0c7=await _0x208f8f['getStateAsync']('analysis.topology.structure');if(!_0x25a0c7||!_0x25a0c7[_0x30ae65(0x1f6)])return!![];const _0xb17169=JSON['parse'](_0x25a0c7[_0x30ae65(0x1f6)]),{rooms:_0x437a39,matrix:_0x56442c}=_0xb17169;if(!_0x437a39||!_0x56442c)return!![];const _0x1bc1c2=_0x437a39['indexOf'](_0x5e6c7e),_0x792b26=_0x437a39[_0x30ae65(0x1dd)](_0x5eaec);if(_0x1bc1c2===-0x1||_0x792b26===-0x1)return!![];const _0x13b4b8=_0x56442c[_0x1bc1c2][_0x792b26]>0x0||_0x56442c[_0x792b26][_0x1bc1c2]>0x0;return _0x13b4b8;}catch(_0x34b8ed){return _0x208f8f[_0x30ae65(0x1e8)]['warn'](_0x30ae65(0x1e1)+_0x34b8ed[_0x30ae65(0x1ca)]),!![];}}function calculateSleepProbability(_0x296e24){const _0x5b0c59=a2_0x24d2ca,_0x3e0ddb=new Date(),_0x4e1e22=_0x3e0ddb['getHours'](),_0x5f000f=_0x296e24[_0x5b0c59(0x1c9)]();let _0x2a8d4e=0.1;if(_0x4e1e22>=0x17||_0x4e1e22<=0x6)_0x2a8d4e=0x1;else{if(_0x4e1e22>=0xd&&_0x4e1e22<=0xf)_0x2a8d4e=0.8;else{if(_0x4e1e22>=0x14&&_0x4e1e22<=0x17)_0x2a8d4e=0.4;}}let _0xdffdbb=0.1;if(_0x5f000f[_0x5b0c59(0x1cb)](_0x5b0c59(0x1db))||_0x5f000f[_0x5b0c59(0x1cb)](_0x5b0c59(0x1ee)))_0xdffdbb=0x1;else{if(_0x5f000f['includes']('wohn')||_0x5f000f[_0x5b0c59(0x1cb)]('living')||_0x5f000f[_0x5b0c59(0x1cb)](_0x5b0c59(0x1dc)))_0xdffdbb=0.6;else{if(_0x5f000f[_0x5b0c59(0x1cb)](_0x5b0c59(0x1d6))||_0x5f000f[_0x5b0c59(0x1cb)]('wc'))_0xdffdbb=0.05;}}let _0x37311c=0.5;const _0x28edc5=_0xdffdbb*0.5+_0x2a8d4e*0.3+_0x37311c*0.2;return parseFloat(_0x28edc5[_0x5b0c59(0x1f3)](0x2));}async function updateLocation(_0x4666bb,_0x52509a){const _0x431bb1=a2_0x24d2ca;if(!_0x52509a||_0x52509a==='Unknown')return;if(!await isActive(_0x4666bb)){resetTimer(_0x4666bb);return;}if(currentMonitoredRoom&&currentMonitoredRoom!==_0x52509a){const _0x517a4b=await areRoomsConnected(_0x4666bb,currentMonitoredRoom,_0x52509a);if(!_0x517a4b){const _0x50cfb9=_0x431bb1(0x1c8)+_0x52509a+_0x431bb1(0x1cd)+currentMonitoredRoom+'\x27.';_0x4666bb[_0x431bb1(0x1e8)][_0x431bb1(0x1e2)](_0x431bb1(0x1d2)+_0x50cfb9+_0x431bb1(0x1cf)),await _0x4666bb[_0x431bb1(0x1d4)]('analysis.safety.deadMan.lastIgnored',{'val':JSON['stringify']({'room':_0x52509a,'reason':_0x50cfb9,'timestamp':Date[_0x431bb1(0x1c7)]()}),'ack':!![]});return;}resetTimer(_0x4666bb);}if(!currentMonitoredRoom){await _0x4666bb[_0x431bb1(0x1d4)](_0x431bb1(0x1d7),{'val':_0x52509a,'ack':!![]});const _0x7ced91=await loadConfig(_0x4666bb);let _0x2d9b35=getTimeoutRobust(_0x7ced91,_0x52509a);const _0x2a22c0=_0x52509a[_0x431bb1(0x1c9)]();if(!_0x2d9b35)for(const _0x3144dc in DEFAULT_TIMEOUTS){if(_0x2a22c0['includes'](_0x3144dc)){_0x2d9b35=DEFAULT_TIMEOUTS[_0x3144dc];break;}}if(!_0x2d9b35&&_0x7ced91[_0x431bb1(0x1ef)])_0x2d9b35=_0x7ced91[_0x431bb1(0x1ef)];if(!_0x2d9b35)return;currentMonitoredRoom=_0x52509a,startTimer(_0x4666bb,_0x2d9b35,_0x52509a);}}function startTimer(_0x3ba4bb,_0x47c709,_0x2f689f){const _0x63bfb7=a2_0x24d2ca;if(activeTimer)clearTimeout(activeTimer);timeoutMs=_0x47c709*0x3c*0x3e8,startTime=Date['now'](),alarmStage=0x0;const _0x2c68f9=calculateSleepProbability(_0x2f689f||currentMonitoredRoom),_0x38fb84=_0x2c68f9>0.65;_0x38fb84?(timeoutMs+=0x5a*0x3c*0x3e8,_0x3ba4bb['log'][_0x63bfb7(0x1e2)](_0x63bfb7(0x1ea)+(_0x2c68f9*0x64)['toFixed'](0x0)+'%).\x20VerlÃ¤ngere\x20Timer\x20fÃ¼r\x20'+currentMonitoredRoom+_0x63bfb7(0x1de)),_0x3ba4bb[_0x63bfb7(0x1d4)](_0x63bfb7(0x1f2),{'val':!![],'ack':!![]})):_0x3ba4bb[_0x63bfb7(0x1d4)](_0x63bfb7(0x1f2),{'val':![],'ack':!![]}),_0x3ba4bb[_0x63bfb7(0x1d4)](_0x63bfb7(0x1d9),{'val':_0x2c68f9,'ack':!![]}),_0x3ba4bb['log'][_0x63bfb7(0x1e2)]('ðŸ‘¼\x20Schutzengel:\x20Ãœberwache\x20'+currentMonitoredRoom+_0x63bfb7(0x1f5)+_0x47c709+_0x63bfb7(0x1cc)),_0x3ba4bb[_0x63bfb7(0x1d4)]('analysis.safety.deadMan.alarmState',{'val':'ok','ack':!![]}),activeTimer=setTimeout(()=>triggerPreWarn(_0x3ba4bb),timeoutMs);}function resetTimer(_0x42d799){const _0x504564=a2_0x24d2ca;if(activeTimer)clearTimeout(activeTimer);activeTimer=null,currentMonitoredRoom=null,alarmStage=0x0,_0x42d799[_0x504564(0x1d4)](_0x504564(0x1d1),{'val':'ok','ack':!![]}),_0x42d799[_0x504564(0x1d4)](_0x504564(0x1f2),{'val':![],'ack':!![]}),_0x42d799[_0x504564(0x1d4)](_0x504564(0x1d9),{'val':0x0,'ack':!![]});}async function triggerPreWarn(_0x2cb9f8){const _0x5d5fc4=a2_0x24d2ca;alarmStage=0x1,await _0x2cb9f8['setStateAsync'](_0x5d5fc4(0x1d1),{'val':_0x5d5fc4(0x1d3),'ack':!![]});const _0x490a75=_0x5d5fc4(0x1f0)+currentMonitoredRoom+'.\x20Alles\x20in\x20Ordnung?';_0x2cb9f8['log'][_0x5d5fc4(0x1d0)](_0x5d5fc4(0x1d2)+_0x490a75),await setup[_0x5d5fc4(0x1f1)](_0x2cb9f8,_0x5d5fc4(0x1e9)+_0x490a75),activeTimer=setTimeout(()=>triggerAlarm(_0x2cb9f8),0x5*0x3c*0x3e8);}async function triggerAlarm(_0x17469f){const _0x3342b0=a2_0x24d2ca;alarmStage=0x2,await _0x17469f[_0x3342b0(0x1d4)](_0x3342b0(0x1d1),{'val':_0x3342b0(0x1ec),'ack':!![]});const _0x538dd4='ðŸš¨\x20NOTFALL-ALARM:\x20Person\x20reagiert\x20nicht\x20in\x20'+currentMonitoredRoom+'!';_0x17469f[_0x3342b0(0x1e8)][_0x3342b0(0x1da)](_0x3342b0(0x1d2)+_0x538dd4),await setup[_0x3342b0(0x1f1)](_0x17469f,_0x538dd4,![],!![]);}module[a2_0x24d2ca(0x1d5)]={'updateLocation':updateLocation};