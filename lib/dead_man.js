(function(_0x2b6395,_0x2cd2e5){const _0x161705=a2_0x2cb9,_0x542a9c=_0x2b6395();while(!![]){try{const _0x4cf6cf=parseInt(_0x161705(0xa1))/0x1*(-parseInt(_0x161705(0x82))/0x2)+parseInt(_0x161705(0x90))/0x3+parseInt(_0x161705(0x71))/0x4+parseInt(_0x161705(0x8e))/0x5*(-parseInt(_0x161705(0x7c))/0x6)+-parseInt(_0x161705(0x8f))/0x7+-parseInt(_0x161705(0x9b))/0x8+parseInt(_0x161705(0x94))/0x9;if(_0x4cf6cf===_0x2cd2e5)break;else _0x542a9c['push'](_0x542a9c['shift']());}catch(_0x142c13){_0x542a9c['push'](_0x542a9c['shift']());}}}(a2_0xd44c,0xd9e78));const a2_0x5b1b92=(function(){let _0x5e1219=!![];return function(_0xdbe550,_0x49e00a){const _0x172c26=_0x5e1219?function(){const _0x37940a=a2_0x2cb9;if(_0x49e00a){const _0x306214=_0x49e00a[_0x37940a(0x83)](_0xdbe550,arguments);return _0x49e00a=null,_0x306214;}}:function(){};return _0x5e1219=![],_0x172c26;};}()),a2_0x5e8e17=a2_0x5b1b92(this,function(){const _0x381570=a2_0x2cb9;return a2_0x5e8e17['toString']()['search'](_0x381570(0xa5))['toString']()['constructor'](a2_0x5e8e17)[_0x381570(0x78)]('(((.+)+)+)+$');});a2_0x5e8e17();'use strict';const setup=require('./setup');let activeTimer=null,currentMonitoredRoom=null,timeoutMs=0x0,startTime=0x0,alarmStage=0x0;const DEFAULT_TIMEOUTS={'bad':0x2d,'bath':0x2d,'toilet':0x1e,'wc':0x1e,'keller':0x3c,'schlaf':0x78,'bed':0x78,'guest':0x5a,'gast':0x5a};function getTimeoutRobust(_0x29837c,_0x4b5451){const _0x185ab8=a2_0x2cb9;if(!_0x29837c||!_0x4b5451)return undefined;if(_0x29837c[_0x4b5451])return _0x29837c[_0x4b5451];const _0x2f1d0d=_0x4b5451[_0x185ab8(0x80)]()[_0x185ab8(0x75)](/[^a-z0-9]/g,'');for(const _0x2f1031 in _0x29837c){const _0x26fd86=_0x2f1031['toLowerCase']()['replace'](/[^a-z0-9]/g,'');if(_0x26fd86===_0x2f1d0d)return _0x29837c[_0x2f1031];}const _0x42c6ec=_0x4b5451[_0x185ab8(0x80)]();if(_0x29837c[_0x42c6ec])return _0x29837c[_0x42c6ec];return undefined;}function a2_0xd44c(){const _0x126df3=['error','default','val','755dbNMmE','2829680MzJHee','387900OLYpjY','includes','analysis.safety.deadMan.config','pre_warn','16279074wWJbzJ','analysis.safety.deadMan.active','analysis.safety.deadMan.napProbability','\x20(Multi-Person\x20Filter)','%).\x20VerlÃ¤ngere\x20Timer\x20fÃ¼r\x20','[DeadMan]\x20Topology\x20check\x20failed:\x20','Unknown','5638208hLkggR','analysis.safety.deadMan.currentRoom','ðŸ‘¼\x20Schutzengel-Frage:\x20','log','ðŸ’¤\x20Smart\x20Sleep\x20erkannt\x20(','\x20Min.','1133632XFgfFi','analysis.safety.deadMan.smartSleep','getStateAsync','alarm','(((.+)+)+)+$','analysis.safety.deadMan.lastIgnored','5335012NzUjrV','indexOf','sendNotification','getHours','replace','info','bed','search','living','warn','\x20fÃ¼r\x20','5430xzWTdh','ðŸ‘¼\x20Schutzengel:\x20Ãœberwache\x20','setStateAsync','parse','toLowerCase','toFixed','2TMgILo','apply','wohn','analysis.safety.deadMan.alarmState','ðŸš¨\x20NOTFALL-ALARM:\x20Person\x20reagiert\x20nicht\x20in\x20','stringify','.\x20Alles\x20in\x20Ordnung?','[DeadMan]\x20','now'];a2_0xd44c=function(){return _0x126df3;};return a2_0xd44c();}function a2_0x2cb9(_0x6c799d,_0x1f5f53){const _0x35750c=a2_0xd44c();return a2_0x2cb9=function(_0x5e8e17,_0x5b1b92){_0x5e8e17=_0x5e8e17-0x71;let _0xd44cd3=_0x35750c[_0x5e8e17];return _0xd44cd3;},a2_0x2cb9(_0x6c799d,_0x1f5f53);}async function loadConfig(_0x26d87c){const _0x1ecfa6=a2_0x2cb9;try{const _0x3e148e=await _0x26d87c['getStateAsync'](_0x1ecfa6(0x92));if(_0x3e148e&&_0x3e148e['val'])return JSON['parse'](_0x3e148e[_0x1ecfa6(0x8d)]);}catch(_0xf94ca0){}return{};}async function isActive(_0x233c7b){const _0x2ac442=a2_0x2cb9;try{const _0x4ab845=await _0x233c7b[_0x2ac442(0xa3)](_0x2ac442(0x95));return _0x4ab845&&_0x4ab845[_0x2ac442(0x8d)];}catch(_0x36f4b8){return![];}}async function areRoomsConnected(_0x14d18e,_0x437d16,_0x55a51f){const _0x5974bb=a2_0x2cb9;try{const _0x5074bd=await _0x14d18e[_0x5974bb(0xa3)]('analysis.topology.structure');if(!_0x5074bd||!_0x5074bd[_0x5974bb(0x8d)])return!![];const _0x128039=JSON[_0x5974bb(0x7f)](_0x5074bd[_0x5974bb(0x8d)]),{rooms:_0x458c5e,matrix:_0x31b7f9}=_0x128039;if(!_0x458c5e||!_0x31b7f9)return!![];const _0x1c1c59=_0x458c5e[_0x5974bb(0x72)](_0x437d16),_0x5bff47=_0x458c5e[_0x5974bb(0x72)](_0x55a51f);if(_0x1c1c59===-0x1||_0x5bff47===-0x1)return!![];const _0x58ecee=_0x31b7f9[_0x1c1c59][_0x5bff47]>0x0||_0x31b7f9[_0x5bff47][_0x1c1c59]>0x0;return _0x58ecee;}catch(_0x490cbf){return _0x14d18e['log']['warn'](_0x5974bb(0x99)+_0x490cbf['message']),!![];}}function calculateSleepProbability(_0x16f5f3){const _0x4c94fb=a2_0x2cb9,_0x7de7b5=new Date(),_0x229623=_0x7de7b5[_0x4c94fb(0x74)](),_0xf4278a=_0x16f5f3[_0x4c94fb(0x80)]();let _0x3cfb22=0.1;if(_0x229623>=0x17||_0x229623<=0x6)_0x3cfb22=0x1;else{if(_0x229623>=0xd&&_0x229623<=0xf)_0x3cfb22=0.8;else{if(_0x229623>=0x14&&_0x229623<=0x17)_0x3cfb22=0.4;}}let _0x35b5cf=0.1;if(_0xf4278a[_0x4c94fb(0x91)]('schlaf')||_0xf4278a[_0x4c94fb(0x91)](_0x4c94fb(0x77)))_0x35b5cf=0x1;else{if(_0xf4278a[_0x4c94fb(0x91)](_0x4c94fb(0x84))||_0xf4278a[_0x4c94fb(0x91)](_0x4c94fb(0x79))||_0xf4278a['includes']('sofa'))_0x35b5cf=0.6;else{if(_0xf4278a[_0x4c94fb(0x91)]('bad')||_0xf4278a[_0x4c94fb(0x91)]('wc'))_0x35b5cf=0.05;}}let _0x24acdf=0.5;const _0x4bf700=_0x35b5cf*0.5+_0x3cfb22*0.3+_0x24acdf*0.2;return parseFloat(_0x4bf700[_0x4c94fb(0x81)](0x2));}async function updateLocation(_0x1bdee5,_0xcbaa89){const _0x4ded16=a2_0x2cb9;if(!_0xcbaa89||_0xcbaa89===_0x4ded16(0x9a))return;if(!await isActive(_0x1bdee5)){resetTimer(_0x1bdee5);return;}if(currentMonitoredRoom&&currentMonitoredRoom!==_0xcbaa89){const _0x287c80=await areRoomsConnected(_0x1bdee5,currentMonitoredRoom,_0xcbaa89);if(!_0x287c80){const _0x36e41c='Ignoriere\x20Bewegung\x20in\x20\x27'+_0xcbaa89+'\x27.\x20Nicht\x20verbunden\x20mit\x20Ã¼berwachtem\x20\x27'+currentMonitoredRoom+'\x27.';_0x1bdee5['log'][_0x4ded16(0x76)](_0x4ded16(0x89)+_0x36e41c+_0x4ded16(0x97)),await _0x1bdee5[_0x4ded16(0x7e)](_0x4ded16(0xa6),{'val':JSON[_0x4ded16(0x87)]({'room':_0xcbaa89,'reason':_0x36e41c,'timestamp':Date[_0x4ded16(0x8a)]()}),'ack':!![]});return;}resetTimer(_0x1bdee5);}if(!currentMonitoredRoom){await _0x1bdee5[_0x4ded16(0x7e)](_0x4ded16(0x9c),{'val':_0xcbaa89,'ack':!![]});const _0x140418=await loadConfig(_0x1bdee5);let _0x4526ce=getTimeoutRobust(_0x140418,_0xcbaa89);const _0x104de0=_0xcbaa89[_0x4ded16(0x80)]();if(!_0x4526ce)for(const _0x3ef446 in DEFAULT_TIMEOUTS){if(_0x104de0[_0x4ded16(0x91)](_0x3ef446)){_0x4526ce=DEFAULT_TIMEOUTS[_0x3ef446];break;}}if(!_0x4526ce&&_0x140418[_0x4ded16(0x8c)])_0x4526ce=_0x140418[_0x4ded16(0x8c)];if(!_0x4526ce)return;currentMonitoredRoom=_0xcbaa89,startTimer(_0x1bdee5,_0x4526ce,_0xcbaa89);}}function startTimer(_0x5deb5a,_0x1b1b7b,_0x265498){const _0x4de567=a2_0x2cb9;if(activeTimer)clearTimeout(activeTimer);timeoutMs=_0x1b1b7b*0x3c*0x3e8,startTime=Date['now'](),alarmStage=0x0;const _0x2b57c3=calculateSleepProbability(_0x265498||currentMonitoredRoom),_0x581cb6=_0x2b57c3>0.65;_0x581cb6?(timeoutMs+=0x5a*0x3c*0x3e8,_0x5deb5a[_0x4de567(0x9e)][_0x4de567(0x76)](_0x4de567(0x9f)+(_0x2b57c3*0x64)[_0x4de567(0x81)](0x0)+_0x4de567(0x98)+currentMonitoredRoom+'\x20um\x2090\x20Min.'),_0x5deb5a['setStateAsync'](_0x4de567(0xa2),{'val':!![],'ack':!![]})):_0x5deb5a[_0x4de567(0x7e)]('analysis.safety.deadMan.smartSleep',{'val':![],'ack':!![]}),_0x5deb5a[_0x4de567(0x7e)]('analysis.safety.deadMan.napProbability',{'val':_0x2b57c3,'ack':!![]}),_0x5deb5a['log'][_0x4de567(0x76)](_0x4de567(0x7d)+currentMonitoredRoom+_0x4de567(0x7b)+_0x1b1b7b+_0x4de567(0xa0)),_0x5deb5a[_0x4de567(0x7e)](_0x4de567(0x85),{'val':'ok','ack':!![]}),activeTimer=setTimeout(()=>triggerPreWarn(_0x5deb5a),timeoutMs);}function resetTimer(_0x2db574){const _0x56ef6b=a2_0x2cb9;if(activeTimer)clearTimeout(activeTimer);activeTimer=null,currentMonitoredRoom=null,alarmStage=0x0,_0x2db574[_0x56ef6b(0x7e)](_0x56ef6b(0x85),{'val':'ok','ack':!![]}),_0x2db574[_0x56ef6b(0x7e)](_0x56ef6b(0xa2),{'val':![],'ack':!![]}),_0x2db574['setStateAsync'](_0x56ef6b(0x96),{'val':0x0,'ack':!![]});}async function triggerPreWarn(_0xeda0cb){const _0x2f78c6=a2_0x2cb9;alarmStage=0x1,await _0xeda0cb[_0x2f78c6(0x7e)]('analysis.safety.deadMan.alarmState',{'val':_0x2f78c6(0x93),'ack':!![]});const _0x197213='â³\x20ACHTUNG:\x20UngewÃ¶hnlich\x20lange\x20InaktivitÃ¤t\x20in\x20'+currentMonitoredRoom+_0x2f78c6(0x88);_0xeda0cb[_0x2f78c6(0x9e)][_0x2f78c6(0x7a)](_0x2f78c6(0x89)+_0x197213),await setup[_0x2f78c6(0x73)](_0xeda0cb,_0x2f78c6(0x9d)+_0x197213),activeTimer=setTimeout(()=>triggerAlarm(_0xeda0cb),0x5*0x3c*0x3e8);}async function triggerAlarm(_0x1e1d5d){const _0x32a1b7=a2_0x2cb9;alarmStage=0x2,await _0x1e1d5d[_0x32a1b7(0x7e)](_0x32a1b7(0x85),{'val':_0x32a1b7(0xa4),'ack':!![]});const _0x38e561=_0x32a1b7(0x86)+currentMonitoredRoom+'!';_0x1e1d5d['log'][_0x32a1b7(0x8b)](_0x32a1b7(0x89)+_0x38e561),await setup['sendNotification'](_0x1e1d5d,_0x38e561,![],!![]);}module['exports']={'updateLocation':updateLocation};