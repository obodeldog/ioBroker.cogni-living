const a2_0x285942=a2_0x2044;(function(_0x44af9a,_0x4dcb35){const _0x14be62=a2_0x2044,_0x4c5df6=_0x44af9a();while(!![]){try{const _0x70d7fc=-parseInt(_0x14be62(0x113))/0x1+-parseInt(_0x14be62(0x10a))/0x2*(parseInt(_0x14be62(0xfe))/0x3)+parseInt(_0x14be62(0xff))/0x4*(-parseInt(_0x14be62(0x104))/0x5)+-parseInt(_0x14be62(0x10c))/0x6*(parseInt(_0x14be62(0x111))/0x7)+parseInt(_0x14be62(0x12b))/0x8*(-parseInt(_0x14be62(0x107))/0x9)+-parseInt(_0x14be62(0x122))/0xa+parseInt(_0x14be62(0x128))/0xb*(parseInt(_0x14be62(0x10f))/0xc);if(_0x70d7fc===_0x4dcb35)break;else _0x4c5df6['push'](_0x4c5df6['shift']());}catch(_0x5496bb){_0x4c5df6['push'](_0x4c5df6['shift']());}}}(a2_0x14b5,0xa7f8e));const a2_0xb68a8a=(function(){let _0x566c26=!![];return function(_0x5bed02,_0xa33775){const _0x5d0ba2=_0x566c26?function(){const _0x57b90e=a2_0x2044;if(_0xa33775){const _0x5f07d2=_0xa33775[_0x57b90e(0x10b)](_0x5bed02,arguments);return _0xa33775=null,_0x5f07d2;}}:function(){};return _0x566c26=![],_0x5d0ba2;};}()),a2_0x39ed83=a2_0xb68a8a(this,function(){const _0x20084a=a2_0x2044;return a2_0x39ed83[_0x20084a(0x126)]()['search'](_0x20084a(0x117))[_0x20084a(0x126)]()[_0x20084a(0x109)](a2_0x39ed83)[_0x20084a(0x129)](_0x20084a(0x117));});function a2_0x14b5(){const _0x459595=['parse','167421qWlibP','4sciElI','ðŸ‘¼\x20Schutzengel-Frage:\x20','getStateAsync','sendNotification','analysis.safety.deadMan.currentRoom','3369870WGWGAz','./setup','analysis.safety.deadMan.alarmState','36toBgeq','log','constructor','18ZMdpUf','apply','848118ttFXeY','info','now','22038636muNvhW','ðŸ‘¼\x20Schutzengel:\x20Ãœberwache\x20','7dmdtya','[DeadMan]\x20Topology\x20check\x20failed:\x20','308755OxRuPD','default','setStateAsync','â³\x20ACHTUNG:\x20UngewÃ¶hnlich\x20lange\x20InaktivitÃ¤t\x20in\x20','(((.+)+)+)+$','\x27.\x20Nicht\x20verbunden\x20mit\x20Ã¼berwachtem\x20\x27','analysis.topology.structure','alarm','toLowerCase','indexOf','\x20fÃ¼r\x20','[DeadMan]\x20','stringify','analysis.safety.deadMan.lastIgnored','Unknown','7758310hXLgUD','ðŸš¨\x20NOTFALL-ALARM:\x20Person\x20reagiert\x20nicht\x20in\x20','analysis.safety.deadMan.active','\x20(Multi-Person\x20Filter)','toString','val','22Frjvib','search','pre_warn','1165832fZmwfx'];a2_0x14b5=function(){return _0x459595;};return a2_0x14b5();}a2_0x39ed83();'use strict';const setup=require(a2_0x285942(0x105));let activeTimer=null,currentMonitoredRoom=null,timeoutMs=0x0,startTime=0x0,alarmStage=0x0;const DEFAULT_TIMEOUTS={'bad':0x2d,'bath':0x2d,'toilet':0x1e,'wc':0x1e,'keller':0x3c};async function loadConfig(_0x185793){const _0x4620a6=a2_0x285942;try{const _0x496fd9=await _0x185793[_0x4620a6(0x101)]('analysis.safety.deadMan.config');if(_0x496fd9&&_0x496fd9[_0x4620a6(0x127)])return JSON[_0x4620a6(0xfd)](_0x496fd9[_0x4620a6(0x127)]);}catch(_0x439532){}return{};}function a2_0x2044(_0x64face,_0x1a927f){const _0x476e30=a2_0x14b5();return a2_0x2044=function(_0x39ed83,_0xb68a8a){_0x39ed83=_0x39ed83-0xfd;let _0x14b5bd=_0x476e30[_0x39ed83];return _0x14b5bd;},a2_0x2044(_0x64face,_0x1a927f);}async function isActive(_0x12d911){const _0x2ade57=a2_0x285942;try{const _0x1338af=await _0x12d911['getStateAsync'](_0x2ade57(0x124));return _0x1338af&&_0x1338af[_0x2ade57(0x127)];}catch(_0x1f66e9){return![];}}async function areRoomsConnected(_0x1cd4da,_0x10e4f7,_0x231a82){const _0x4515f7=a2_0x285942;try{const _0x2d0d08=await _0x1cd4da['getStateAsync'](_0x4515f7(0x119));if(!_0x2d0d08||!_0x2d0d08[_0x4515f7(0x127)])return!![];const _0x462566=JSON[_0x4515f7(0xfd)](_0x2d0d08['val']),{rooms:_0x492995,matrix:_0x514e9e}=_0x462566;if(!_0x492995||!_0x514e9e)return!![];const _0x10c87c=_0x492995[_0x4515f7(0x11c)](_0x10e4f7),_0x349434=_0x492995[_0x4515f7(0x11c)](_0x231a82);if(_0x10c87c===-0x1||_0x349434===-0x1)return!![];const _0x38d9cc=_0x514e9e[_0x10c87c][_0x349434]>0x0||_0x514e9e[_0x349434][_0x10c87c]>0x0;return _0x38d9cc;}catch(_0x2b87f9){return _0x1cd4da['log']['warn'](_0x4515f7(0x112)+_0x2b87f9['message']),!![];}}async function updateLocation(_0x8180dc,_0x5b094d){const _0xa8f810=a2_0x285942;if(!_0x5b094d||_0x5b094d===_0xa8f810(0x121))return;if(!await isActive(_0x8180dc)){resetTimer(_0x8180dc);return;}if(currentMonitoredRoom&&currentMonitoredRoom!==_0x5b094d){const _0x5e4d73=await areRoomsConnected(_0x8180dc,currentMonitoredRoom,_0x5b094d);if(!_0x5e4d73){const _0x261db9='Ignoriere\x20Bewegung\x20in\x20\x27'+_0x5b094d+_0xa8f810(0x118)+currentMonitoredRoom+'\x27.';_0x8180dc[_0xa8f810(0x108)][_0xa8f810(0x10d)](_0xa8f810(0x11e)+_0x261db9+_0xa8f810(0x125)),await _0x8180dc[_0xa8f810(0x115)](_0xa8f810(0x120),{'val':JSON[_0xa8f810(0x11f)]({'room':_0x5b094d,'reason':_0x261db9,'timestamp':Date[_0xa8f810(0x10e)]()}),'ack':!![]});return;}resetTimer(_0x8180dc);}if(!currentMonitoredRoom){await _0x8180dc[_0xa8f810(0x115)](_0xa8f810(0x103),{'val':_0x5b094d,'ack':!![]});const _0x39fded=await loadConfig(_0x8180dc),_0x19584b=_0x5b094d[_0xa8f810(0x11b)]();let _0x17762e=_0x39fded[_0x5b094d]||_0x39fded[_0x19584b];if(!_0x17762e)for(const _0x531b76 in DEFAULT_TIMEOUTS){if(_0x19584b['includes'](_0x531b76)){_0x17762e=DEFAULT_TIMEOUTS[_0x531b76];break;}}if(!_0x17762e&&_0x39fded[_0xa8f810(0x114)])_0x17762e=_0x39fded[_0xa8f810(0x114)];if(!_0x17762e)return;currentMonitoredRoom=_0x5b094d,startTimer(_0x8180dc,_0x17762e);}}function startTimer(_0x36aa53,_0x3d5765){const _0x19a729=a2_0x285942;if(activeTimer)clearTimeout(activeTimer);timeoutMs=_0x3d5765*0x3c*0x3e8,startTime=Date['now'](),alarmStage=0x0,_0x36aa53[_0x19a729(0x108)][_0x19a729(0x10d)](_0x19a729(0x110)+currentMonitoredRoom+_0x19a729(0x11d)+_0x3d5765+'\x20Min.'),_0x36aa53[_0x19a729(0x115)](_0x19a729(0x106),{'val':'ok','ack':!![]}),activeTimer=setTimeout(()=>triggerPreWarn(_0x36aa53),timeoutMs);}function resetTimer(_0x207978){const _0x1cc56f=a2_0x285942;if(activeTimer)clearTimeout(activeTimer);activeTimer=null,currentMonitoredRoom=null,alarmStage=0x0,_0x207978[_0x1cc56f(0x115)](_0x1cc56f(0x106),{'val':'ok','ack':!![]});}async function triggerPreWarn(_0x671ed5){const _0x114796=a2_0x285942;alarmStage=0x1,await _0x671ed5[_0x114796(0x115)](_0x114796(0x106),{'val':_0x114796(0x12a),'ack':!![]});const _0x12c565=_0x114796(0x116)+currentMonitoredRoom+'.\x20Alles\x20in\x20Ordnung?';_0x671ed5['log']['warn'](_0x114796(0x11e)+_0x12c565),await setup[_0x114796(0x102)](_0x671ed5,_0x114796(0x100)+_0x12c565),activeTimer=setTimeout(()=>triggerAlarm(_0x671ed5),0x5*0x3c*0x3e8);}async function triggerAlarm(_0x5c2817){const _0x5031e2=a2_0x285942;alarmStage=0x2,await _0x5c2817[_0x5031e2(0x115)](_0x5031e2(0x106),{'val':_0x5031e2(0x11a),'ack':!![]});const _0xdc3829=_0x5031e2(0x123)+currentMonitoredRoom+'!';_0x5c2817[_0x5031e2(0x108)]['error'](_0x5031e2(0x11e)+_0xdc3829),await setup[_0x5031e2(0x102)](_0x5c2817,_0xdc3829,![],!![]);}module['exports']={'updateLocation':updateLocation};