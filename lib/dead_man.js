const a2_0x5a98b3=a2_0x206f;(function(_0x14425b,_0x872dac){const _0x66c2cf=a2_0x206f,_0x4a53fd=_0x14425b();while(!![]){try{const _0x1fcd6a=-parseInt(_0x66c2cf(0x17a))/0x1*(parseInt(_0x66c2cf(0x16f))/0x2)+parseInt(_0x66c2cf(0x183))/0x3+parseInt(_0x66c2cf(0x17f))/0x4+-parseInt(_0x66c2cf(0x198))/0x5+parseInt(_0x66c2cf(0x189))/0x6+parseInt(_0x66c2cf(0x17c))/0x7+parseInt(_0x66c2cf(0x191))/0x8*(-parseInt(_0x66c2cf(0x16c))/0x9);if(_0x1fcd6a===_0x872dac)break;else _0x4a53fd['push'](_0x4a53fd['shift']());}catch(_0xf4c8d4){_0x4a53fd['push'](_0x4a53fd['shift']());}}}(a2_0x2f0c,0x869a6));const a2_0x493902=(function(){let _0x3a5872=!![];return function(_0x2bbcb8,_0x5e46ea){const _0x5c1765=_0x3a5872?function(){if(_0x5e46ea){const _0x3ec47f=_0x5e46ea['apply'](_0x2bbcb8,arguments);return _0x5e46ea=null,_0x3ec47f;}}:function(){};return _0x3a5872=![],_0x5c1765;};}()),a2_0x5ce8ac=a2_0x493902(this,function(){const _0x52e5c9=a2_0x206f;return a2_0x5ce8ac['toString']()[_0x52e5c9(0x17b)](_0x52e5c9(0x16b))['toString']()[_0x52e5c9(0x19a)](a2_0x5ce8ac)['search'](_0x52e5c9(0x16b));});a2_0x5ce8ac();'use strict';const setup=require(a2_0x5a98b3(0x19f));let activeTimer=null,currentMonitoredRoom=null,timeoutMs=0x0,startTime=0x0,alarmStage=0x0;const DEFAULT_TIMEOUTS={'bad':0x2d,'bath':0x2d,'toilet':0x1e,'wc':0x1e,'keller':0x3c,'schlaf':0x78,'bed':0x78,'guest':0x5a,'gast':0x5a};function getTimeoutRobust(_0xb07ca2,_0x72293){const _0x1b6763=a2_0x5a98b3;if(!_0xb07ca2||!_0x72293)return undefined;if(_0xb07ca2[_0x72293])return _0xb07ca2[_0x72293];const _0x2143e2=_0x72293[_0x1b6763(0x188)]()[_0x1b6763(0x194)](/[^a-z0-9]/g,'');for(const _0x3b1606 in _0xb07ca2){const _0x52666a=_0x3b1606[_0x1b6763(0x188)]()['replace'](/[^a-z0-9]/g,'');if(_0x52666a===_0x2143e2)return _0xb07ca2[_0x3b1606];}const _0x53b26f=_0x72293[_0x1b6763(0x188)]();if(_0xb07ca2[_0x53b26f])return _0xb07ca2[_0x53b26f];return undefined;}async function loadConfig(_0x456e0d){const _0x10a50f=a2_0x5a98b3;try{const _0x2a06b2=await _0x456e0d[_0x10a50f(0x187)](_0x10a50f(0x179));if(_0x2a06b2&&_0x2a06b2[_0x10a50f(0x16d)])return JSON[_0x10a50f(0x19d)](_0x2a06b2[_0x10a50f(0x16d)]);}catch(_0x17c81f){}return{};}async function isActive(_0x49a3a4){const _0x269200=a2_0x5a98b3;try{const _0x11928a=await _0x49a3a4[_0x269200(0x187)](_0x269200(0x171));return _0x11928a&&_0x11928a[_0x269200(0x16d)];}catch(_0x2b8d25){return![];}}async function areRoomsConnected(_0x43a33e,_0x1dd77b,_0x2be2a9){const _0x408263=a2_0x5a98b3;try{const _0xdaca40=await _0x43a33e[_0x408263(0x187)]('analysis.topology.structure');if(!_0xdaca40||!_0xdaca40[_0x408263(0x16d)])return!![];const _0x3a1ebe=JSON['parse'](_0xdaca40['val']),{rooms:_0x149778,matrix:_0x36fca0}=_0x3a1ebe;if(!_0x149778||!_0x36fca0)return!![];const _0x40baf5=_0x149778[_0x408263(0x199)](_0x1dd77b),_0x3891cf=_0x149778[_0x408263(0x199)](_0x2be2a9);if(_0x40baf5===-0x1||_0x3891cf===-0x1)return!![];const _0x57e2d1=_0x36fca0[_0x40baf5][_0x3891cf]>0x0||_0x36fca0[_0x3891cf][_0x40baf5]>0x0;return _0x57e2d1;}catch(_0x1501d4){return _0x43a33e[_0x408263(0x181)][_0x408263(0x172)]('[DeadMan]\x20Topology\x20check\x20failed:\x20'+_0x1501d4[_0x408263(0x17e)]),!![];}}function calculateSleepProbability(_0x574ccb){const _0x3ee7ae=a2_0x5a98b3,_0x28ce73=new Date(),_0x49083a=_0x28ce73['getHours'](),_0x1457f9=_0x574ccb[_0x3ee7ae(0x188)]();let _0x109ee9=0.1;if(_0x49083a>=0x17||_0x49083a<=0x6)_0x109ee9=0x1;else{if(_0x49083a>=0xd&&_0x49083a<=0xf)_0x109ee9=0.8;else{if(_0x49083a>=0x14&&_0x49083a<=0x17)_0x109ee9=0.4;}}let _0x5637ef=0.1;if(_0x1457f9[_0x3ee7ae(0x186)](_0x3ee7ae(0x196))||_0x1457f9[_0x3ee7ae(0x186)]('bed'))_0x5637ef=0x1;else{if(_0x1457f9[_0x3ee7ae(0x186)](_0x3ee7ae(0x193))||_0x1457f9[_0x3ee7ae(0x186)](_0x3ee7ae(0x173))||_0x1457f9['includes'](_0x3ee7ae(0x18d)))_0x5637ef=0.6;else{if(_0x1457f9[_0x3ee7ae(0x186)]('bad')||_0x1457f9[_0x3ee7ae(0x186)]('wc'))_0x5637ef=0.05;}}let _0x40d0b8=0.5;const _0x1eea8c=_0x5637ef*0.5+_0x109ee9*0.3+_0x40d0b8*0.2;return parseFloat(_0x1eea8c[_0x3ee7ae(0x192)](0x2));}async function updateLocation(_0x65b557,_0x145e4b){const _0x5b1520=a2_0x5a98b3;if(!_0x145e4b||_0x145e4b===_0x5b1520(0x16e))return;if(!await isActive(_0x65b557)){resetTimer(_0x65b557);return;}if(currentMonitoredRoom&&currentMonitoredRoom!==_0x145e4b){const _0x4207ad=await areRoomsConnected(_0x65b557,currentMonitoredRoom,_0x145e4b);if(!_0x4207ad){const _0x50994c=_0x5b1520(0x190)+_0x145e4b+_0x5b1520(0x17d)+currentMonitoredRoom+'\x27.';_0x65b557[_0x5b1520(0x181)][_0x5b1520(0x169)](_0x5b1520(0x18c)+_0x50994c+_0x5b1520(0x19c)),await _0x65b557[_0x5b1520(0x176)](_0x5b1520(0x195),{'val':JSON[_0x5b1520(0x170)]({'room':_0x145e4b,'reason':_0x50994c,'timestamp':Date[_0x5b1520(0x197)]()}),'ack':!![]});return;}resetTimer(_0x65b557);}if(!currentMonitoredRoom){await _0x65b557[_0x5b1520(0x176)]('analysis.safety.deadMan.currentRoom',{'val':_0x145e4b,'ack':!![]});const _0x407451=await loadConfig(_0x65b557);let _0x3f5cf0=getTimeoutRobust(_0x407451,_0x145e4b);const _0x377f47=_0x145e4b[_0x5b1520(0x188)]();if(!_0x3f5cf0)for(const _0x23c0d8 in DEFAULT_TIMEOUTS){if(_0x377f47['includes'](_0x23c0d8)){_0x3f5cf0=DEFAULT_TIMEOUTS[_0x23c0d8];break;}}if(!_0x3f5cf0&&_0x407451[_0x5b1520(0x18e)])_0x3f5cf0=_0x407451[_0x5b1520(0x18e)];if(!_0x3f5cf0)return;currentMonitoredRoom=_0x145e4b,startTimer(_0x65b557,_0x3f5cf0,_0x145e4b);}}function startTimer(_0x10da24,_0x23c6e4,_0x55bd65){const _0x78a009=a2_0x5a98b3;if(activeTimer)clearTimeout(activeTimer);timeoutMs=_0x23c6e4*0x3c*0x3e8,startTime=Date[_0x78a009(0x197)](),alarmStage=0x0;const _0x22a704=calculateSleepProbability(_0x55bd65||currentMonitoredRoom),_0x3ce76a=_0x22a704>0.65;_0x3ce76a?(timeoutMs+=0x5a*0x3c*0x3e8,_0x10da24[_0x78a009(0x181)][_0x78a009(0x169)](_0x78a009(0x18a)+(_0x22a704*0x64)[_0x78a009(0x192)](0x0)+_0x78a009(0x19e)+currentMonitoredRoom+_0x78a009(0x182)),_0x10da24[_0x78a009(0x176)]('analysis.safety.deadMan.smartSleep',{'val':!![],'ack':!![]})):_0x10da24[_0x78a009(0x176)]('analysis.safety.deadMan.smartSleep',{'val':![],'ack':!![]}),_0x10da24[_0x78a009(0x176)](_0x78a009(0x168),{'val':_0x22a704,'ack':!![]}),_0x10da24['log']['info'](_0x78a009(0x19b)+currentMonitoredRoom+_0x78a009(0x18f)+_0x23c6e4+_0x78a009(0x184)),_0x10da24[_0x78a009(0x176)](_0x78a009(0x180),{'val':'ok','ack':!![]}),activeTimer=setTimeout(()=>triggerPreWarn(_0x10da24),timeoutMs);}function resetTimer(_0x158397){const _0x5f4831=a2_0x5a98b3;if(activeTimer)clearTimeout(activeTimer);activeTimer=null,currentMonitoredRoom=null,alarmStage=0x0,_0x158397[_0x5f4831(0x176)](_0x5f4831(0x180),{'val':'ok','ack':!![]}),_0x158397[_0x5f4831(0x176)](_0x5f4831(0x174),{'val':![],'ack':!![]}),_0x158397['setStateAsync'](_0x5f4831(0x168),{'val':0x0,'ack':!![]});}async function triggerPreWarn(_0x40073f){const _0xed853d=a2_0x5a98b3;alarmStage=0x1,await _0x40073f[_0xed853d(0x176)](_0xed853d(0x180),{'val':_0xed853d(0x178),'ack':!![]});const _0x102791=_0xed853d(0x16a)+currentMonitoredRoom+'.\x20Alles\x20in\x20Ordnung?';_0x40073f[_0xed853d(0x181)][_0xed853d(0x172)]('[DeadMan]\x20'+_0x102791),await setup[_0xed853d(0x18b)](_0x40073f,_0xed853d(0x177)+_0x102791),activeTimer=setTimeout(()=>triggerAlarm(_0x40073f),0x5*0x3c*0x3e8);}async function triggerAlarm(_0x46629f){const _0x326d4f=a2_0x5a98b3;alarmStage=0x2,await _0x46629f[_0x326d4f(0x176)]('analysis.safety.deadMan.alarmState',{'val':_0x326d4f(0x175),'ack':!![]});const _0x25b52c=_0x326d4f(0x185)+currentMonitoredRoom+'!';_0x46629f['log']['error'](_0x326d4f(0x18c)+_0x25b52c),await setup['sendNotification'](_0x46629f,_0x25b52c,![],!![]);}function a2_0x206f(_0x45c242,_0xb6219f){const _0x216469=a2_0x2f0c();return a2_0x206f=function(_0x5ce8ac,_0x493902){_0x5ce8ac=_0x5ce8ac-0x168;let _0x2f0c43=_0x216469[_0x5ce8ac];return _0x2f0c43;},a2_0x206f(_0x45c242,_0xb6219f);}function a2_0x2f0c(){const _0x31af8f=['üí§\x20Smart\x20Sleep\x20erkannt\x20(','sendNotification','[DeadMan]\x20','sofa','default','\x20f√ºr\x20','Ignoriere\x20Bewegung\x20in\x20\x27','16dzUOvP','toFixed','wohn','replace','analysis.safety.deadMan.lastIgnored','schlaf','now','2470680JDWzCa','indexOf','constructor','üëº\x20Schutzengel:\x20√úberwache\x20','\x20(Multi-Person\x20Filter)','parse','%).\x20Verl√§ngere\x20Timer\x20f√ºr\x20','./setup','exports','analysis.safety.deadMan.napProbability','info','‚è≥\x20ACHTUNG:\x20Ungew√∂hnlich\x20lange\x20Inaktivit√§t\x20in\x20','(((.+)+)+)+$','2404746DjQfjQ','val','Unknown','949162URnlQR','stringify','analysis.safety.deadMan.active','warn','living','analysis.safety.deadMan.smartSleep','alarm','setStateAsync','üëº\x20Schutzengel-Frage:\x20','pre_warn','analysis.safety.deadMan.config','1LyOCRi','search','5016130BFjNKm','\x27.\x20Nicht\x20verbunden\x20mit\x20√ºberwachtem\x20\x27','message','296468AmhPbo','analysis.safety.deadMan.alarmState','log','\x20um\x2090\x20Min.','637356YwAvCq','\x20Min.','üö®\x20NOTFALL-ALARM:\x20Person\x20reagiert\x20nicht\x20in\x20','includes','getStateAsync','toLowerCase','6307680fEyMsn'];a2_0x2f0c=function(){return _0x31af8f;};return a2_0x2f0c();}module[a2_0x5a98b3(0x1a0)]={'updateLocation':updateLocation};