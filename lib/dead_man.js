function a2_0x4b6e(_0x1b566b,_0x973c7b){const _0x3e3302=a2_0x3b8f();return a2_0x4b6e=function(_0x1b23e0,_0x51430b){_0x1b23e0=_0x1b23e0-0x1a5;let _0x3b8f88=_0x3e3302[_0x1b23e0];return _0x3b8f88;},a2_0x4b6e(_0x1b566b,_0x973c7b);}const a2_0x1ccdea=a2_0x4b6e;(function(_0x1475f8,_0x19be28){const _0x152249=a2_0x4b6e,_0x3aa30d=_0x1475f8();while(!![]){try{const _0x3b9de4=parseInt(_0x152249(0x1ae))/0x1+-parseInt(_0x152249(0x1b2))/0x2+-parseInt(_0x152249(0x1d6))/0x3*(parseInt(_0x152249(0x1cb))/0x4)+-parseInt(_0x152249(0x1ce))/0x5*(parseInt(_0x152249(0x1cc))/0x6)+-parseInt(_0x152249(0x1a8))/0x7+parseInt(_0x152249(0x1be))/0x8*(-parseInt(_0x152249(0x1d0))/0x9)+parseInt(_0x152249(0x1c4))/0xa;if(_0x3b9de4===_0x19be28)break;else _0x3aa30d['push'](_0x3aa30d['shift']());}catch(_0x4a3365){_0x3aa30d['push'](_0x3aa30d['shift']());}}}(a2_0x3b8f,0x383a5));const a2_0x51430b=(function(){let _0x1964ff=!![];return function(_0x35fb39,_0x16ae31){const _0x4b205f=_0x1964ff?function(){if(_0x16ae31){const _0x4de1f8=_0x16ae31['apply'](_0x35fb39,arguments);return _0x16ae31=null,_0x4de1f8;}}:function(){};return _0x1964ff=![],_0x4b205f;};}()),a2_0x1b23e0=a2_0x51430b(this,function(){const _0x41bd17=a2_0x4b6e;return a2_0x1b23e0['toString']()[_0x41bd17(0x1d9)](_0x41bd17(0x1a5))[_0x41bd17(0x1b0)]()[_0x41bd17(0x1d1)](a2_0x1b23e0)[_0x41bd17(0x1d9)](_0x41bd17(0x1a5));});a2_0x1b23e0();'use strict';const setup=require(a2_0x1ccdea(0x1bb));function a2_0x3b8f(){const _0x1ad42b=['2041857AUfTZe','constructor','info','analysis.safety.deadMan.config','analysis.topology.structure','sendNotification','3plphCp','getHours','getStateAsync','search','bad','%).\x20VerlÃ¤ngere\x20Timer\x20fÃ¼r\x20','includes','ðŸ’¤\x20Smart\x20Sleep\x20erkannt\x20(','bed','(((.+)+)+)+$','message','ðŸ‘¼\x20Schutzengel-Frage:\x20','1528282jTvWlL','setStateAsync','analysis.safety.deadMan.lastIgnored','\x20um\x2090\x20Min.','now','alarm','33279RpSgCr','val','toString','analysis.safety.deadMan.smartSleep','447622VicAfA','\x27.\x20Nicht\x20verbunden\x20mit\x20Ã¼berwachtem\x20\x27','ðŸ‘¼\x20Schutzengel:\x20Ãœberwache\x20','analysis.safety.deadMan.napProbability','error','ðŸš¨\x20NOTFALL-ALARM:\x20Person\x20reagiert\x20nicht\x20in\x20','parse','pre_warn','.\x20Alles\x20in\x20Ordnung?','./setup','toLowerCase','schlaf','8DsCqTm','analysis.safety.deadMan.alarmState','Unknown','\x20(Multi-Person\x20Filter)','log','warn','12041240RuHPkw','default','replace','living','analysis.safety.deadMan.currentRoom','toFixed','indexOf','405380IMazDh','18tbaPoz','[DeadMan]\x20','394565POCFQA','\x20fÃ¼r\x20'];a2_0x3b8f=function(){return _0x1ad42b;};return a2_0x3b8f();}let activeTimer=null,currentMonitoredRoom=null,timeoutMs=0x0,startTime=0x0,alarmStage=0x0;const DEFAULT_TIMEOUTS={'bad':0x2d,'bath':0x2d,'toilet':0x1e,'wc':0x1e,'keller':0x3c,'schlaf':0x78,'bed':0x78,'guest':0x5a,'gast':0x5a};function getTimeoutRobust(_0x2c01c0,_0x13edf5){const _0x4bedc0=a2_0x1ccdea;if(!_0x2c01c0||!_0x13edf5)return undefined;if(_0x2c01c0[_0x13edf5])return _0x2c01c0[_0x13edf5];const _0x18462f=_0x13edf5['toLowerCase']()[_0x4bedc0(0x1c6)](/[^a-z0-9]/g,'');for(const _0x2f9012 in _0x2c01c0){const _0x136ee4=_0x2f9012['toLowerCase']()[_0x4bedc0(0x1c6)](/[^a-z0-9]/g,'');if(_0x136ee4===_0x18462f)return _0x2c01c0[_0x2f9012];}const _0x17ed7=_0x13edf5[_0x4bedc0(0x1bc)]();if(_0x2c01c0[_0x17ed7])return _0x2c01c0[_0x17ed7];return undefined;}async function loadConfig(_0x5a9f87){const _0x584ae3=a2_0x1ccdea;try{const _0x56ea55=await _0x5a9f87['getStateAsync'](_0x584ae3(0x1d3));if(_0x56ea55&&_0x56ea55[_0x584ae3(0x1af)])return JSON[_0x584ae3(0x1b8)](_0x56ea55[_0x584ae3(0x1af)]);}catch(_0x529f91){}return{};}async function isActive(_0x31a563){const _0x144cbf=a2_0x1ccdea;try{const _0x5169ea=await _0x31a563[_0x144cbf(0x1d8)]('analysis.safety.deadMan.active');return _0x5169ea&&_0x5169ea[_0x144cbf(0x1af)];}catch(_0x592115){return![];}}async function areRoomsConnected(_0x532f3f,_0x20a25d,_0x13bb66){const _0x1bf421=a2_0x1ccdea;try{const _0x11e95f=await _0x532f3f[_0x1bf421(0x1d8)](_0x1bf421(0x1d4));if(!_0x11e95f||!_0x11e95f['val'])return!![];const _0x26e33e=JSON['parse'](_0x11e95f['val']),{rooms:_0x434851,matrix:_0x32d2ed}=_0x26e33e;if(!_0x434851||!_0x32d2ed)return!![];const _0x3ae137=_0x434851[_0x1bf421(0x1ca)](_0x20a25d),_0xad1f3f=_0x434851[_0x1bf421(0x1ca)](_0x13bb66);if(_0x3ae137===-0x1||_0xad1f3f===-0x1)return!![];const _0x2c85cc=_0x32d2ed[_0x3ae137][_0xad1f3f]>0x0||_0x32d2ed[_0xad1f3f][_0x3ae137]>0x0;return _0x2c85cc;}catch(_0x503f24){return _0x532f3f[_0x1bf421(0x1c2)][_0x1bf421(0x1c3)]('[DeadMan]\x20Topology\x20check\x20failed:\x20'+_0x503f24[_0x1bf421(0x1a6)]),!![];}}function calculateSleepProbability(_0x35a246){const _0x809e10=a2_0x1ccdea,_0x182eb8=new Date(),_0x472925=_0x182eb8[_0x809e10(0x1d7)](),_0x11b2da=_0x35a246[_0x809e10(0x1bc)]();let _0x44383d=0.1;if(_0x472925>=0x17||_0x472925<=0x6)_0x44383d=0x1;else{if(_0x472925>=0xd&&_0x472925<=0xf)_0x44383d=0.8;else{if(_0x472925>=0x14&&_0x472925<=0x17)_0x44383d=0.4;}}let _0x42afa0=0.1;if(_0x11b2da[_0x809e10(0x1dc)](_0x809e10(0x1bd))||_0x11b2da[_0x809e10(0x1dc)](_0x809e10(0x1de)))_0x42afa0=0x1;else{if(_0x11b2da[_0x809e10(0x1dc)]('wohn')||_0x11b2da[_0x809e10(0x1dc)](_0x809e10(0x1c7))||_0x11b2da[_0x809e10(0x1dc)]('sofa'))_0x42afa0=0.6;else{if(_0x11b2da[_0x809e10(0x1dc)](_0x809e10(0x1da))||_0x11b2da['includes']('wc'))_0x42afa0=0.05;}}let _0xa4c3ef=0.5;const _0x3bf989=_0x42afa0*0.5+_0x44383d*0.3+_0xa4c3ef*0.2;return parseFloat(_0x3bf989[_0x809e10(0x1c9)](0x2));}async function updateLocation(_0x5ab176,_0x264cca){const _0x2eeb12=a2_0x1ccdea;if(!_0x264cca||_0x264cca===_0x2eeb12(0x1c0))return;if(!await isActive(_0x5ab176)){resetTimer(_0x5ab176);return;}if(currentMonitoredRoom&&currentMonitoredRoom!==_0x264cca){const _0x6db945=await areRoomsConnected(_0x5ab176,currentMonitoredRoom,_0x264cca);if(!_0x6db945){const _0x114c4a='Ignoriere\x20Bewegung\x20in\x20\x27'+_0x264cca+_0x2eeb12(0x1b3)+currentMonitoredRoom+'\x27.';_0x5ab176[_0x2eeb12(0x1c2)]['info'](_0x2eeb12(0x1cd)+_0x114c4a+_0x2eeb12(0x1c1)),await _0x5ab176[_0x2eeb12(0x1a9)](_0x2eeb12(0x1aa),{'val':JSON['stringify']({'room':_0x264cca,'reason':_0x114c4a,'timestamp':Date[_0x2eeb12(0x1ac)]()}),'ack':!![]});return;}resetTimer(_0x5ab176);}if(!currentMonitoredRoom){await _0x5ab176[_0x2eeb12(0x1a9)](_0x2eeb12(0x1c8),{'val':_0x264cca,'ack':!![]});const _0xaac91f=await loadConfig(_0x5ab176);let _0x510e88=getTimeoutRobust(_0xaac91f,_0x264cca);const _0x4e1e7a=_0x264cca['toLowerCase']();if(!_0x510e88)for(const _0x48047d in DEFAULT_TIMEOUTS){if(_0x4e1e7a[_0x2eeb12(0x1dc)](_0x48047d)){_0x510e88=DEFAULT_TIMEOUTS[_0x48047d];break;}}if(!_0x510e88&&_0xaac91f[_0x2eeb12(0x1c5)])_0x510e88=_0xaac91f[_0x2eeb12(0x1c5)];if(!_0x510e88)return;currentMonitoredRoom=_0x264cca,startTimer(_0x5ab176,_0x510e88,_0x264cca);}}function startTimer(_0x3425cb,_0x503a5b,_0x14026e){const _0x4cd75f=a2_0x1ccdea;if(activeTimer)clearTimeout(activeTimer);timeoutMs=_0x503a5b*0x3c*0x3e8,startTime=Date[_0x4cd75f(0x1ac)](),alarmStage=0x0;const _0x3d6df0=calculateSleepProbability(_0x14026e||currentMonitoredRoom),_0xcc0d7c=_0x3d6df0>0.65;_0xcc0d7c?(timeoutMs+=0x5a*0x3c*0x3e8,_0x3425cb[_0x4cd75f(0x1c2)][_0x4cd75f(0x1d2)](_0x4cd75f(0x1dd)+(_0x3d6df0*0x64)[_0x4cd75f(0x1c9)](0x0)+_0x4cd75f(0x1db)+currentMonitoredRoom+_0x4cd75f(0x1ab)),_0x3425cb[_0x4cd75f(0x1a9)]('analysis.safety.deadMan.smartSleep',{'val':!![],'ack':!![]})):_0x3425cb['setStateAsync'](_0x4cd75f(0x1b1),{'val':![],'ack':!![]}),_0x3425cb[_0x4cd75f(0x1a9)](_0x4cd75f(0x1b5),{'val':_0x3d6df0,'ack':!![]}),_0x3425cb[_0x4cd75f(0x1c2)][_0x4cd75f(0x1d2)](_0x4cd75f(0x1b4)+currentMonitoredRoom+_0x4cd75f(0x1cf)+_0x503a5b+'\x20Min.'),_0x3425cb[_0x4cd75f(0x1a9)](_0x4cd75f(0x1bf),{'val':'ok','ack':!![]}),activeTimer=setTimeout(()=>triggerPreWarn(_0x3425cb),timeoutMs);}function resetTimer(_0x40203d){const _0x492d83=a2_0x1ccdea;if(activeTimer)clearTimeout(activeTimer);activeTimer=null,currentMonitoredRoom=null,alarmStage=0x0,_0x40203d[_0x492d83(0x1a9)](_0x492d83(0x1bf),{'val':'ok','ack':!![]}),_0x40203d[_0x492d83(0x1a9)]('analysis.safety.deadMan.smartSleep',{'val':![],'ack':!![]}),_0x40203d[_0x492d83(0x1a9)]('analysis.safety.deadMan.napProbability',{'val':0x0,'ack':!![]});}async function triggerPreWarn(_0x22962c){const _0x33a8f5=a2_0x1ccdea;alarmStage=0x1,await _0x22962c[_0x33a8f5(0x1a9)](_0x33a8f5(0x1bf),{'val':_0x33a8f5(0x1b9),'ack':!![]});const _0x12cec2='â³\x20ACHTUNG:\x20UngewÃ¶hnlich\x20lange\x20InaktivitÃ¤t\x20in\x20'+currentMonitoredRoom+_0x33a8f5(0x1ba);_0x22962c[_0x33a8f5(0x1c2)]['warn'](_0x33a8f5(0x1cd)+_0x12cec2),await setup['sendNotification'](_0x22962c,_0x33a8f5(0x1a7)+_0x12cec2),activeTimer=setTimeout(()=>triggerAlarm(_0x22962c),0x5*0x3c*0x3e8);}async function triggerAlarm(_0x16c4e4){const _0x9436d8=a2_0x1ccdea;alarmStage=0x2,await _0x16c4e4['setStateAsync']('analysis.safety.deadMan.alarmState',{'val':_0x9436d8(0x1ad),'ack':!![]});const _0x39efe8=_0x9436d8(0x1b7)+currentMonitoredRoom+'!';_0x16c4e4[_0x9436d8(0x1c2)][_0x9436d8(0x1b6)]('[DeadMan]\x20'+_0x39efe8),await setup[_0x9436d8(0x1d5)](_0x16c4e4,_0x39efe8,![],!![]);}module['exports']={'updateLocation':updateLocation};