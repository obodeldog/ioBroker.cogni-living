const a2_0xb09326=a2_0xe95d;(function(_0x554789,_0xf8d6fc){const _0x317e3c=a2_0xe95d,_0x3c4a01=_0x554789();while(!![]){try{const _0x25256f=parseInt(_0x317e3c(0x18f))/0x1+parseInt(_0x317e3c(0x192))/0x2+-parseInt(_0x317e3c(0x165))/0x3+-parseInt(_0x317e3c(0x181))/0x4+-parseInt(_0x317e3c(0x198))/0x5*(parseInt(_0x317e3c(0x184))/0x6)+-parseInt(_0x317e3c(0x191))/0x7*(-parseInt(_0x317e3c(0x18a))/0x8)+parseInt(_0x317e3c(0x187))/0x9;if(_0x25256f===_0xf8d6fc)break;else _0x3c4a01['push'](_0x3c4a01['shift']());}catch(_0x2082ac){_0x3c4a01['push'](_0x3c4a01['shift']());}}}(a2_0x4f33,0x57a64));const a2_0x4a1b0e=(function(){let _0x4e7d55=!![];return function(_0x5f1f05,_0xaf0d91){const _0x2c05e6=_0x4e7d55?function(){if(_0xaf0d91){const _0x4f476f=_0xaf0d91['apply'](_0x5f1f05,arguments);return _0xaf0d91=null,_0x4f476f;}}:function(){};return _0x4e7d55=![],_0x2c05e6;};}()),a2_0x3d2174=a2_0x4a1b0e(this,function(){const _0x519d66=a2_0xe95d;return a2_0x3d2174[_0x519d66(0x180)]()[_0x519d66(0x183)](_0x519d66(0x17e))[_0x519d66(0x180)]()['constructor'](a2_0x3d2174)[_0x519d66(0x183)](_0x519d66(0x17e));});function a2_0xe95d(_0x46952c,_0x55165e){const _0x574228=a2_0x4f33();return a2_0xe95d=function(_0x3d2174,_0x4a1b0e){_0x3d2174=_0x3d2174-0x161;let _0x4f3385=_0x574228[_0x3d2174];return _0x4f3385;},a2_0xe95d(_0x46952c,_0x55165e);}a2_0x3d2174();'use strict';function a2_0x4f33(){const _0x21f52d=['analysis.safety.deadMan.lastIgnored','944qcKXXT','ðŸ’¤\x20Smart\x20Sleep\x20erkannt\x20(','getHours','./setup','\x20fÃ¼r\x20','391618JeXpvk','[DeadMan]\x20Topology\x20check\x20failed:\x20','13608liEGcu','890212LUhbFI','analysis.safety.deadMan.smartSleep','replace','ðŸš¨\x20NOTFALL-ALARM:\x20Person\x20reagiert\x20nicht\x20in\x20','analysis.safety.deadMan.alarmState','toLowerCase','6250BVIiqe','error','warn','val','setStateAsync','1152399ygDMss','parse','indexOf','includes','sendNotification','analysis.safety.deadMan.active','ðŸ‘¼\x20Schutzengel:\x20Ãœberwache\x20','\x20um\x2090\x20Min.','wohn','info','schlaf','\x20Min.','.\x20Alles\x20in\x20Ordnung?','bed','\x27.\x20Nicht\x20verbunden\x20mit\x20Ã¼berwachtem\x20\x27','getStateAsync','Ignoriere\x20Bewegung\x20in\x20\x27','[DeadMan]\x20','living','â³\x20ACHTUNG:\x20UngewÃ¶hnlich\x20lange\x20InaktivitÃ¤t\x20in\x20','analysis.safety.deadMan.config','analysis.topology.structure','bad','default','analysis.safety.deadMan.napProbability','(((.+)+)+)+$','log','toString','2354612RwAPkg','sofa','search','1002iUXsIN','toFixed','now','4269888bsezzu','alarm'];a2_0x4f33=function(){return _0x21f52d;};return a2_0x4f33();}const setup=require(a2_0xb09326(0x18d));let activeTimer=null,currentMonitoredRoom=null,timeoutMs=0x0,startTime=0x0,alarmStage=0x0;const DEFAULT_TIMEOUTS={'bad':0x2d,'bath':0x2d,'toilet':0x1e,'wc':0x1e,'keller':0x3c,'schlaf':0x78,'bed':0x78,'guest':0x5a,'gast':0x5a};function getTimeoutRobust(_0x3d94b7,_0x1b5399){const _0x2a54ed=a2_0xb09326;if(!_0x3d94b7||!_0x1b5399)return undefined;if(_0x3d94b7[_0x1b5399])return _0x3d94b7[_0x1b5399];const _0x27d7ca=_0x1b5399['toLowerCase']()[_0x2a54ed(0x194)](/[^a-z0-9]/g,'');for(const _0x4bcb23 in _0x3d94b7){const _0xe18315=_0x4bcb23['toLowerCase']()[_0x2a54ed(0x194)](/[^a-z0-9]/g,'');if(_0xe18315===_0x27d7ca)return _0x3d94b7[_0x4bcb23];}const _0x2fdae9=_0x1b5399[_0x2a54ed(0x197)]();if(_0x3d94b7[_0x2fdae9])return _0x3d94b7[_0x2fdae9];return undefined;}async function loadConfig(_0xab1fc9){const _0x20c45e=a2_0xb09326;try{const _0x35a61d=await _0xab1fc9[_0x20c45e(0x174)](_0x20c45e(0x179));if(_0x35a61d&&_0x35a61d[_0x20c45e(0x163)])return JSON[_0x20c45e(0x166)](_0x35a61d['val']);}catch(_0x38c6f4){}return{};}async function isActive(_0x4a2482){const _0x3845d8=a2_0xb09326;try{const _0xf23d9d=await _0x4a2482['getStateAsync'](_0x3845d8(0x16a));return _0xf23d9d&&_0xf23d9d[_0x3845d8(0x163)];}catch(_0x1e88e2){return![];}}async function areRoomsConnected(_0x41bda1,_0x37e8e1,_0x1af8f7){const _0x141d0f=a2_0xb09326;try{const _0x344428=await _0x41bda1[_0x141d0f(0x174)](_0x141d0f(0x17a));if(!_0x344428||!_0x344428[_0x141d0f(0x163)])return!![];const _0xd30226=JSON[_0x141d0f(0x166)](_0x344428[_0x141d0f(0x163)]),{rooms:_0x75838b,matrix:_0x1c326d}=_0xd30226;if(!_0x75838b||!_0x1c326d)return!![];const _0x5d24d0=_0x75838b[_0x141d0f(0x167)](_0x37e8e1),_0x4e5172=_0x75838b['indexOf'](_0x1af8f7);if(_0x5d24d0===-0x1||_0x4e5172===-0x1)return!![];const _0x1f26bb=_0x1c326d[_0x5d24d0][_0x4e5172]>0x0||_0x1c326d[_0x4e5172][_0x5d24d0]>0x0;return _0x1f26bb;}catch(_0x105f77){return _0x41bda1[_0x141d0f(0x17f)][_0x141d0f(0x162)](_0x141d0f(0x190)+_0x105f77['message']),!![];}}function calculateSleepProbability(_0x4d2c58){const _0x44814d=a2_0xb09326,_0x45c100=new Date(),_0xc5033d=_0x45c100[_0x44814d(0x18c)](),_0xf6b085=_0x4d2c58['toLowerCase']();let _0x3eabe0=0.1;if(_0xc5033d>=0x17||_0xc5033d<=0x6)_0x3eabe0=0x1;else{if(_0xc5033d>=0xd&&_0xc5033d<=0xf)_0x3eabe0=0.8;else{if(_0xc5033d>=0x14&&_0xc5033d<=0x17)_0x3eabe0=0.4;}}let _0x104855=0.1;if(_0xf6b085[_0x44814d(0x168)](_0x44814d(0x16f))||_0xf6b085[_0x44814d(0x168)](_0x44814d(0x172)))_0x104855=0x1;else{if(_0xf6b085[_0x44814d(0x168)](_0x44814d(0x16d))||_0xf6b085[_0x44814d(0x168)](_0x44814d(0x177))||_0xf6b085[_0x44814d(0x168)](_0x44814d(0x182)))_0x104855=0.6;else{if(_0xf6b085[_0x44814d(0x168)](_0x44814d(0x17b))||_0xf6b085['includes']('wc'))_0x104855=0.05;}}let _0x135f9a=0.5;const _0xf94f0f=_0x104855*0.5+_0x3eabe0*0.3+_0x135f9a*0.2;return parseFloat(_0xf94f0f[_0x44814d(0x185)](0x2));}async function updateLocation(_0x10261c,_0x533eaf){const _0x322d86=a2_0xb09326;if(!_0x533eaf||_0x533eaf==='Unknown')return;if(!await isActive(_0x10261c)){resetTimer(_0x10261c);return;}if(currentMonitoredRoom&&currentMonitoredRoom!==_0x533eaf){const _0x15249e=await areRoomsConnected(_0x10261c,currentMonitoredRoom,_0x533eaf);if(!_0x15249e){const _0x1b5fb0=_0x322d86(0x175)+_0x533eaf+_0x322d86(0x173)+currentMonitoredRoom+'\x27.';_0x10261c[_0x322d86(0x17f)]['info'](_0x322d86(0x176)+_0x1b5fb0+'\x20(Multi-Person\x20Filter)'),await _0x10261c[_0x322d86(0x164)](_0x322d86(0x189),{'val':JSON['stringify']({'room':_0x533eaf,'reason':_0x1b5fb0,'timestamp':Date['now']()}),'ack':!![]});return;}resetTimer(_0x10261c);}if(!currentMonitoredRoom){await _0x10261c[_0x322d86(0x164)]('analysis.safety.deadMan.currentRoom',{'val':_0x533eaf,'ack':!![]});const _0x3a1053=await loadConfig(_0x10261c);let _0x46915e=getTimeoutRobust(_0x3a1053,_0x533eaf);const _0x135711=_0x533eaf['toLowerCase']();if(!_0x46915e)for(const _0x406ead in DEFAULT_TIMEOUTS){if(_0x135711[_0x322d86(0x168)](_0x406ead)){_0x46915e=DEFAULT_TIMEOUTS[_0x406ead];break;}}if(!_0x46915e&&_0x3a1053['default'])_0x46915e=_0x3a1053[_0x322d86(0x17c)];if(!_0x46915e)return;currentMonitoredRoom=_0x533eaf,startTimer(_0x10261c,_0x46915e,_0x533eaf);}}function startTimer(_0x39c8dc,_0x31c05b,_0x3d8615){const _0x41eef8=a2_0xb09326;if(activeTimer)clearTimeout(activeTimer);timeoutMs=_0x31c05b*0x3c*0x3e8,startTime=Date[_0x41eef8(0x186)](),alarmStage=0x0;const _0x5c3683=calculateSleepProbability(_0x3d8615||currentMonitoredRoom),_0x5ab552=_0x5c3683>0.65;_0x5ab552?(timeoutMs+=0x5a*0x3c*0x3e8,_0x39c8dc[_0x41eef8(0x17f)][_0x41eef8(0x16e)](_0x41eef8(0x18b)+(_0x5c3683*0x64)[_0x41eef8(0x185)](0x0)+'%).\x20VerlÃ¤ngere\x20Timer\x20fÃ¼r\x20'+currentMonitoredRoom+_0x41eef8(0x16c)),_0x39c8dc[_0x41eef8(0x164)](_0x41eef8(0x193),{'val':!![],'ack':!![]})):_0x39c8dc[_0x41eef8(0x164)]('analysis.safety.deadMan.smartSleep',{'val':![],'ack':!![]}),_0x39c8dc[_0x41eef8(0x164)](_0x41eef8(0x17d),{'val':_0x5c3683,'ack':!![]}),_0x39c8dc[_0x41eef8(0x17f)][_0x41eef8(0x16e)](_0x41eef8(0x16b)+currentMonitoredRoom+_0x41eef8(0x18e)+_0x31c05b+_0x41eef8(0x170)),_0x39c8dc[_0x41eef8(0x164)](_0x41eef8(0x196),{'val':'ok','ack':!![]}),activeTimer=setTimeout(()=>triggerPreWarn(_0x39c8dc),timeoutMs);}function resetTimer(_0xa0ff14){const _0x237336=a2_0xb09326;if(activeTimer)clearTimeout(activeTimer);activeTimer=null,currentMonitoredRoom=null,alarmStage=0x0,_0xa0ff14[_0x237336(0x164)]('analysis.safety.deadMan.alarmState',{'val':'ok','ack':!![]}),_0xa0ff14[_0x237336(0x164)]('analysis.safety.deadMan.smartSleep',{'val':![],'ack':!![]}),_0xa0ff14['setStateAsync'](_0x237336(0x17d),{'val':0x0,'ack':!![]});}async function triggerPreWarn(_0x4c7d6b){const _0x2eb074=a2_0xb09326;alarmStage=0x1,await _0x4c7d6b['setStateAsync'](_0x2eb074(0x196),{'val':'pre_warn','ack':!![]});const _0x3d3a50=_0x2eb074(0x178)+currentMonitoredRoom+_0x2eb074(0x171);_0x4c7d6b['log'][_0x2eb074(0x162)](_0x2eb074(0x176)+_0x3d3a50),await setup[_0x2eb074(0x169)](_0x4c7d6b,'ðŸ‘¼\x20Schutzengel-Frage:\x20'+_0x3d3a50),activeTimer=setTimeout(()=>triggerAlarm(_0x4c7d6b),0x5*0x3c*0x3e8);}async function triggerAlarm(_0x19a42b){const _0x358ef8=a2_0xb09326;alarmStage=0x2,await _0x19a42b[_0x358ef8(0x164)](_0x358ef8(0x196),{'val':_0x358ef8(0x188),'ack':!![]});const _0x989a0b=_0x358ef8(0x195)+currentMonitoredRoom+'!';_0x19a42b[_0x358ef8(0x17f)][_0x358ef8(0x161)](_0x358ef8(0x176)+_0x989a0b),await setup[_0x358ef8(0x169)](_0x19a42b,_0x989a0b,![],!![]);}module['exports']={'updateLocation':updateLocation};