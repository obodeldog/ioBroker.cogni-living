(function(_0x372b02,_0x583afb){const _0x5e72aa=a2_0x43b9,_0x1be231=_0x372b02();while(!![]){try{const _0x586cd3=parseInt(_0x5e72aa(0x15c))/0x1+parseInt(_0x5e72aa(0x159))/0x2+-parseInt(_0x5e72aa(0x163))/0x3+parseInt(_0x5e72aa(0x18b))/0x4*(-parseInt(_0x5e72aa(0x161))/0x5)+-parseInt(_0x5e72aa(0x15e))/0x6*(parseInt(_0x5e72aa(0x16c))/0x7)+-parseInt(_0x5e72aa(0x17e))/0x8*(parseInt(_0x5e72aa(0x16e))/0x9)+-parseInt(_0x5e72aa(0x16d))/0xa*(-parseInt(_0x5e72aa(0x173))/0xb);if(_0x586cd3===_0x583afb)break;else _0x1be231['push'](_0x1be231['shift']());}catch(_0x3f7c5b){_0x1be231['push'](_0x1be231['shift']());}}}(a2_0x24ed,0xe3f34));const a2_0x80ad73=(function(){let _0x4142cb=!![];return function(_0x49702f,_0x701b85){const _0x2b7d39=_0x4142cb?function(){const _0x58b6f6=a2_0x43b9;if(_0x701b85){const _0x4a1cad=_0x701b85[_0x58b6f6(0x18e)](_0x49702f,arguments);return _0x701b85=null,_0x4a1cad;}}:function(){};return _0x4142cb=![],_0x2b7d39;};}()),a2_0x54200c=a2_0x80ad73(this,function(){const _0x5bada4=a2_0x43b9;return a2_0x54200c[_0x5bada4(0x187)]()[_0x5bada4(0x190)](_0x5bada4(0x181))[_0x5bada4(0x187)]()[_0x5bada4(0x184)](a2_0x54200c)['search']('(((.+)+)+)+$');});a2_0x54200c();'use strict';const setup=require('./setup');let activeTimer=null,currentMonitoredRoom=null,timeoutMs=0x0,startTime=0x0,alarmStage=0x0;function a2_0x24ed(){const _0x60c1fc=['4613814cJQkNw','message','log','.\x20Alles\x20in\x20Ordnung?','\x20um\x2090\x20Min.','11tcmEAo','default','replace','alarm','now','ðŸ‘¼\x20Schutzengel-Frage:\x20','ðŸ‘¼\x20Schutzengel:\x20Ãœberwache\x20','setStateAsync','warn','sofa','includes','8AQTcbM','analysis.safety.deadMan.smartSleep','analysis.safety.deadMan.config','(((.+)+)+)+$','â³\x20ACHTUNG:\x20UngewÃ¶hnlich\x20lange\x20InaktivitÃ¤t\x20in\x20','Ignoriere\x20Bewegung\x20in\x20\x27','constructor','\x20Min.','parse','toString','getStateAsync','info','val','204CASNsD','Unknown','indexOf','apply','\x20fÃ¼r\x20','search','getHours','wohn','3570896SZxorv','analysis.topology.structure','error','301679UBZPky','analysis.safety.deadMan.currentRoom','436446fcwyYv','ðŸ’¤\x20Smart\x20Sleep\x20erkannt\x20(','analysis.safety.deadMan.napProbability','40375SlMBgM','living','3844140VVzijC','sendNotification','analysis.safety.deadMan.alarmState','bad','toFixed','[DeadMan]\x20','\x27.\x20Nicht\x20verbunden\x20mit\x20Ã¼berwachtem\x20\x27','ðŸš¨\x20NOTFALL-ALARM:\x20Person\x20reagiert\x20nicht\x20in\x20','toLowerCase','7CdgGQh','11251490KxKqhk'];a2_0x24ed=function(){return _0x60c1fc;};return a2_0x24ed();}const DEFAULT_TIMEOUTS={'bad':0x2d,'bath':0x2d,'toilet':0x1e,'wc':0x1e,'keller':0x3c,'schlaf':0x78,'bed':0x78,'guest':0x5a,'gast':0x5a};function getTimeoutRobust(_0x1b9480,_0x98c1c5){const _0x3da53d=a2_0x43b9;if(!_0x1b9480||!_0x98c1c5)return undefined;if(_0x1b9480[_0x98c1c5])return _0x1b9480[_0x98c1c5];const _0x342cef=_0x98c1c5[_0x3da53d(0x16b)]()[_0x3da53d(0x175)](/[^a-z0-9]/g,'');for(const _0x3d3fc6 in _0x1b9480){const _0x5e654d=_0x3d3fc6[_0x3da53d(0x16b)]()['replace'](/[^a-z0-9]/g,'');if(_0x5e654d===_0x342cef)return _0x1b9480[_0x3d3fc6];}const _0x99c482=_0x98c1c5[_0x3da53d(0x16b)]();if(_0x1b9480[_0x99c482])return _0x1b9480[_0x99c482];return undefined;}async function loadConfig(_0x41eb02){const _0x5733b7=a2_0x43b9;try{const _0x1e01c0=await _0x41eb02[_0x5733b7(0x188)](_0x5733b7(0x180));if(_0x1e01c0&&_0x1e01c0['val'])return JSON[_0x5733b7(0x186)](_0x1e01c0['val']);}catch(_0x5b8c04){}return{};}async function isActive(_0x505db7){const _0x4098b5=a2_0x43b9;try{const _0x4bc8df=await _0x505db7['getStateAsync']('analysis.safety.deadMan.active');return _0x4bc8df&&_0x4bc8df[_0x4098b5(0x18a)];}catch(_0xaa47a5){return![];}}async function areRoomsConnected(_0x595a37,_0x32d946,_0x104778){const _0x362677=a2_0x43b9;try{const _0x3bb059=await _0x595a37[_0x362677(0x188)](_0x362677(0x15a));if(!_0x3bb059||!_0x3bb059[_0x362677(0x18a)])return!![];const _0x2bc8a3=JSON['parse'](_0x3bb059[_0x362677(0x18a)]),{rooms:_0x34cf56,matrix:_0x40803a}=_0x2bc8a3;if(!_0x34cf56||!_0x40803a)return!![];const _0x30b85b=_0x34cf56[_0x362677(0x18d)](_0x32d946),_0x1ccdb3=_0x34cf56[_0x362677(0x18d)](_0x104778);if(_0x30b85b===-0x1||_0x1ccdb3===-0x1)return!![];const _0x3c7887=_0x40803a[_0x30b85b][_0x1ccdb3]>0x0||_0x40803a[_0x1ccdb3][_0x30b85b]>0x0;return _0x3c7887;}catch(_0x50b790){return _0x595a37[_0x362677(0x170)][_0x362677(0x17b)]('[DeadMan]\x20Topology\x20check\x20failed:\x20'+_0x50b790[_0x362677(0x16f)]),!![];}}function calculateSleepProbability(_0x3d2b9c){const _0x32c24f=a2_0x43b9,_0x50a34c=new Date(),_0x4ce047=_0x50a34c[_0x32c24f(0x157)](),_0x45b4f1=_0x3d2b9c[_0x32c24f(0x16b)]();let _0x3d7ca7=0.1;if(_0x4ce047>=0x17||_0x4ce047<=0x6)_0x3d7ca7=0x1;else{if(_0x4ce047>=0xd&&_0x4ce047<=0xf)_0x3d7ca7=0.8;else{if(_0x4ce047>=0x14&&_0x4ce047<=0x17)_0x3d7ca7=0.4;}}let _0xac36f3=0.1;if(_0x45b4f1[_0x32c24f(0x17d)]('schlaf')||_0x45b4f1[_0x32c24f(0x17d)]('bed'))_0xac36f3=0x1;else{if(_0x45b4f1[_0x32c24f(0x17d)](_0x32c24f(0x158))||_0x45b4f1[_0x32c24f(0x17d)](_0x32c24f(0x162))||_0x45b4f1['includes'](_0x32c24f(0x17c)))_0xac36f3=0.6;else{if(_0x45b4f1[_0x32c24f(0x17d)](_0x32c24f(0x166))||_0x45b4f1[_0x32c24f(0x17d)]('wc'))_0xac36f3=0.05;}}let _0x70c984=0.5;const _0x28950e=_0xac36f3*0.5+_0x3d7ca7*0.3+_0x70c984*0.2;return parseFloat(_0x28950e[_0x32c24f(0x167)](0x2));}async function updateLocation(_0x569490,_0x4d80b1){const _0x42f68c=a2_0x43b9;if(!_0x4d80b1||_0x4d80b1===_0x42f68c(0x18c))return;if(!await isActive(_0x569490)){resetTimer(_0x569490);return;}if(currentMonitoredRoom&&currentMonitoredRoom!==_0x4d80b1){const _0x3c227d=await areRoomsConnected(_0x569490,currentMonitoredRoom,_0x4d80b1);if(!_0x3c227d){const _0x4d9e4b=_0x42f68c(0x183)+_0x4d80b1+_0x42f68c(0x169)+currentMonitoredRoom+'\x27.';_0x569490[_0x42f68c(0x170)][_0x42f68c(0x189)](_0x42f68c(0x168)+_0x4d9e4b+'\x20(Multi-Person\x20Filter)'),await _0x569490[_0x42f68c(0x17a)]('analysis.safety.deadMan.lastIgnored',{'val':JSON['stringify']({'room':_0x4d80b1,'reason':_0x4d9e4b,'timestamp':Date[_0x42f68c(0x177)]()}),'ack':!![]});return;}resetTimer(_0x569490);}if(!currentMonitoredRoom){await _0x569490[_0x42f68c(0x17a)](_0x42f68c(0x15d),{'val':_0x4d80b1,'ack':!![]});const _0x2297b5=await loadConfig(_0x569490);let _0x2d0a01=getTimeoutRobust(_0x2297b5,_0x4d80b1);const _0x1b1eec=_0x4d80b1['toLowerCase']();if(!_0x2d0a01)for(const _0x3a3746 in DEFAULT_TIMEOUTS){if(_0x1b1eec['includes'](_0x3a3746)){_0x2d0a01=DEFAULT_TIMEOUTS[_0x3a3746];break;}}if(!_0x2d0a01&&_0x2297b5['default'])_0x2d0a01=_0x2297b5[_0x42f68c(0x174)];if(!_0x2d0a01)return;currentMonitoredRoom=_0x4d80b1,startTimer(_0x569490,_0x2d0a01,_0x4d80b1);}}function a2_0x43b9(_0x4fa51a,_0x2fe84d){const _0x23ae0b=a2_0x24ed();return a2_0x43b9=function(_0x54200c,_0x80ad73){_0x54200c=_0x54200c-0x157;let _0x24eda5=_0x23ae0b[_0x54200c];return _0x24eda5;},a2_0x43b9(_0x4fa51a,_0x2fe84d);}function startTimer(_0x241d30,_0x3798cb,_0x3b6335){const _0x4bee9d=a2_0x43b9;if(activeTimer)clearTimeout(activeTimer);timeoutMs=_0x3798cb*0x3c*0x3e8,startTime=Date['now'](),alarmStage=0x0;const _0xd32058=calculateSleepProbability(_0x3b6335||currentMonitoredRoom),_0x15103b=_0xd32058>0.65;_0x15103b?(timeoutMs+=0x5a*0x3c*0x3e8,_0x241d30[_0x4bee9d(0x170)][_0x4bee9d(0x189)](_0x4bee9d(0x15f)+(_0xd32058*0x64)[_0x4bee9d(0x167)](0x0)+'%).\x20VerlÃ¤ngere\x20Timer\x20fÃ¼r\x20'+currentMonitoredRoom+_0x4bee9d(0x172)),_0x241d30[_0x4bee9d(0x17a)](_0x4bee9d(0x17f),{'val':!![],'ack':!![]})):_0x241d30[_0x4bee9d(0x17a)]('analysis.safety.deadMan.smartSleep',{'val':![],'ack':!![]}),_0x241d30[_0x4bee9d(0x17a)](_0x4bee9d(0x160),{'val':_0xd32058,'ack':!![]}),_0x241d30[_0x4bee9d(0x170)]['info'](_0x4bee9d(0x179)+currentMonitoredRoom+_0x4bee9d(0x18f)+_0x3798cb+_0x4bee9d(0x185)),_0x241d30[_0x4bee9d(0x17a)](_0x4bee9d(0x165),{'val':'ok','ack':!![]}),activeTimer=setTimeout(()=>triggerPreWarn(_0x241d30),timeoutMs);}function resetTimer(_0x5ebdda){const _0x245026=a2_0x43b9;if(activeTimer)clearTimeout(activeTimer);activeTimer=null,currentMonitoredRoom=null,alarmStage=0x0,_0x5ebdda[_0x245026(0x17a)](_0x245026(0x165),{'val':'ok','ack':!![]}),_0x5ebdda[_0x245026(0x17a)]('analysis.safety.deadMan.smartSleep',{'val':![],'ack':!![]}),_0x5ebdda[_0x245026(0x17a)]('analysis.safety.deadMan.napProbability',{'val':0x0,'ack':!![]});}async function triggerPreWarn(_0x52668a){const _0x43885e=a2_0x43b9;alarmStage=0x1,await _0x52668a[_0x43885e(0x17a)](_0x43885e(0x165),{'val':'pre_warn','ack':!![]});const _0xb033f=_0x43885e(0x182)+currentMonitoredRoom+_0x43885e(0x171);_0x52668a[_0x43885e(0x170)]['warn'](_0x43885e(0x168)+_0xb033f),await setup[_0x43885e(0x164)](_0x52668a,_0x43885e(0x178)+_0xb033f),activeTimer=setTimeout(()=>triggerAlarm(_0x52668a),0x5*0x3c*0x3e8);}async function triggerAlarm(_0x52fe4f){const _0x42b153=a2_0x43b9;alarmStage=0x2,await _0x52fe4f[_0x42b153(0x17a)](_0x42b153(0x165),{'val':_0x42b153(0x176),'ack':!![]});const _0x32819d=_0x42b153(0x16a)+currentMonitoredRoom+'!';_0x52fe4f[_0x42b153(0x170)][_0x42b153(0x15b)]('[DeadMan]\x20'+_0x32819d),await setup['sendNotification'](_0x52fe4f,_0x32819d,![],!![]);}module['exports']={'updateLocation':updateLocation};