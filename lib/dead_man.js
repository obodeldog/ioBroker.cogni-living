const a2_0x408b8a=a2_0x3e60;(function(_0x3301ee,_0xee34df){const _0x59d1f5=a2_0x3e60,_0x4f3fc7=_0x3301ee();while(!![]){try{const _0xe95bd9=-parseInt(_0x59d1f5(0xf4))/0x1+-parseInt(_0x59d1f5(0xf5))/0x2+-parseInt(_0x59d1f5(0x106))/0x3+-parseInt(_0x59d1f5(0x105))/0x4*(parseInt(_0x59d1f5(0xf3))/0x5)+parseInt(_0x59d1f5(0xf6))/0x6*(parseInt(_0x59d1f5(0x117))/0x7)+parseInt(_0x59d1f5(0x112))/0x8+parseInt(_0x59d1f5(0x110))/0x9;if(_0xe95bd9===_0xee34df)break;else _0x4f3fc7['push'](_0x4f3fc7['shift']());}catch(_0x5642ee){_0x4f3fc7['push'](_0x4f3fc7['shift']());}}}(a2_0x5666,0xad336));function a2_0x5666(){const _0x3c7575=['5cAzxyl','1149974USjUtX','1663752TMpFBP','450AlCgjx','now','default','ðŸ‘¼\x20Schutzengel:\x20Ãœberwache\x20','indexOf','analysis.safety.deadMan.active','getStateAsync','analysis.safety.deadMan.lastIgnored','analysis.safety.deadMan.config','toString','Unknown','alarm','â³\x20ACHTUNG:\x20UngewÃ¶hnlich\x20lange\x20InaktivitÃ¤t\x20in\x20','message','sendNotification','2596556acRXnx','407949NApXLJ','./setup','analysis.safety.deadMan.currentRoom','search','\x20(Multi-Person\x20Filter)','apply','[DeadMan]\x20','\x20fÃ¼r\x20','\x20Min.','val','27688671OFjfCc','ðŸš¨\x20NOTFALL-ALARM:\x20Person\x20reagiert\x20nicht\x20in\x20','2537864ZNCPdX','warn','log','(((.+)+)+)+$','error','7714CljxhU','stringify','setStateAsync','analysis.safety.deadMan.alarmState','parse','\x27.\x20Nicht\x20verbunden\x20mit\x20Ã¼berwachtem\x20\x27','Ignoriere\x20Bewegung\x20in\x20\x27','.\x20Alles\x20in\x20Ordnung?','info','exports'];a2_0x5666=function(){return _0x3c7575;};return a2_0x5666();}const a2_0x1b2ae0=(function(){let _0x1eb503=!![];return function(_0x18ba81,_0x5cfdc1){const _0x4c06c6=_0x1eb503?function(){const _0x50048b=a2_0x3e60;if(_0x5cfdc1){const _0x3e516e=_0x5cfdc1[_0x50048b(0x10b)](_0x18ba81,arguments);return _0x5cfdc1=null,_0x3e516e;}}:function(){};return _0x1eb503=![],_0x4c06c6;};}()),a2_0x49bb8f=a2_0x1b2ae0(this,function(){const _0x4d7775=a2_0x3e60;return a2_0x49bb8f[_0x4d7775(0xff)]()[_0x4d7775(0x109)](_0x4d7775(0x115))['toString']()['constructor'](a2_0x49bb8f)[_0x4d7775(0x109)](_0x4d7775(0x115));});a2_0x49bb8f();'use strict';const setup=require(a2_0x408b8a(0x107));let activeTimer=null,currentMonitoredRoom=null,timeoutMs=0x0,startTime=0x0,alarmStage=0x0;const DEFAULT_TIMEOUTS={'bad':0x2d,'bath':0x2d,'toilet':0x1e,'wc':0x1e,'keller':0x3c};async function loadConfig(_0x392ad8){const _0x102be5=a2_0x408b8a;try{const _0x3771ac=await _0x392ad8[_0x102be5(0xfc)](_0x102be5(0xfe));if(_0x3771ac&&_0x3771ac[_0x102be5(0x10f)])return JSON[_0x102be5(0xed)](_0x3771ac['val']);}catch(_0x3e922e){}return{};}async function isActive(_0x2970fc){const _0x32bdb4=a2_0x408b8a;try{const _0xe5bea4=await _0x2970fc[_0x32bdb4(0xfc)](_0x32bdb4(0xfb));return _0xe5bea4&&_0xe5bea4['val'];}catch(_0x1b1ec9){return![];}}function a2_0x3e60(_0x57baf8,_0x18d26c){const _0x343ab2=a2_0x5666();return a2_0x3e60=function(_0x49bb8f,_0x1b2ae0){_0x49bb8f=_0x49bb8f-0xeb;let _0x566648=_0x343ab2[_0x49bb8f];return _0x566648;},a2_0x3e60(_0x57baf8,_0x18d26c);}async function areRoomsConnected(_0x148f9a,_0x37c16c,_0x378079){const _0x4c1f67=a2_0x408b8a;try{const _0x3ed0b7=await _0x148f9a['getStateAsync']('analysis.topology.structure');if(!_0x3ed0b7||!_0x3ed0b7[_0x4c1f67(0x10f)])return!![];const _0x58383f=JSON['parse'](_0x3ed0b7['val']),{rooms:_0x26ff6f,matrix:_0x5aac9a}=_0x58383f;if(!_0x26ff6f||!_0x5aac9a)return!![];const _0x53eb7b=_0x26ff6f[_0x4c1f67(0xfa)](_0x37c16c),_0x2d26c2=_0x26ff6f[_0x4c1f67(0xfa)](_0x378079);if(_0x53eb7b===-0x1||_0x2d26c2===-0x1)return!![];const _0x55cec1=_0x5aac9a[_0x53eb7b][_0x2d26c2]>0x0||_0x5aac9a[_0x2d26c2][_0x53eb7b]>0x0;return _0x55cec1;}catch(_0x4486dc){return _0x148f9a[_0x4c1f67(0x114)][_0x4c1f67(0x113)]('[DeadMan]\x20Topology\x20check\x20failed:\x20'+_0x4486dc[_0x4c1f67(0x103)]),!![];}}async function updateLocation(_0x2dc9bd,_0x3551b2){const _0xcb6a58=a2_0x408b8a;if(!_0x3551b2||_0x3551b2===_0xcb6a58(0x100))return;if(!await isActive(_0x2dc9bd)){resetTimer(_0x2dc9bd);return;}if(currentMonitoredRoom&&currentMonitoredRoom!==_0x3551b2){const _0x11f743=await areRoomsConnected(_0x2dc9bd,currentMonitoredRoom,_0x3551b2);if(!_0x11f743){const _0x53e5bd=_0xcb6a58(0xef)+_0x3551b2+_0xcb6a58(0xee)+currentMonitoredRoom+'\x27.';_0x2dc9bd[_0xcb6a58(0x114)][_0xcb6a58(0xf1)]('[DeadMan]\x20'+_0x53e5bd+_0xcb6a58(0x10a)),await _0x2dc9bd[_0xcb6a58(0xeb)](_0xcb6a58(0xfd),{'val':JSON[_0xcb6a58(0x118)]({'room':_0x3551b2,'reason':_0x53e5bd,'timestamp':Date[_0xcb6a58(0xf7)]()}),'ack':!![]});return;}resetTimer(_0x2dc9bd);}if(!currentMonitoredRoom){await _0x2dc9bd[_0xcb6a58(0xeb)](_0xcb6a58(0x108),{'val':_0x3551b2,'ack':!![]});const _0x27a36b=await loadConfig(_0x2dc9bd),_0x4c63a9=_0x3551b2['toLowerCase']();let _0x5c5edc=_0x27a36b[_0x3551b2]||_0x27a36b[_0x4c63a9];if(!_0x5c5edc)for(const _0x35079f in DEFAULT_TIMEOUTS){if(_0x4c63a9['includes'](_0x35079f)){_0x5c5edc=DEFAULT_TIMEOUTS[_0x35079f];break;}}if(!_0x5c5edc&&_0x27a36b[_0xcb6a58(0xf8)])_0x5c5edc=_0x27a36b[_0xcb6a58(0xf8)];if(!_0x5c5edc)return;currentMonitoredRoom=_0x3551b2,startTimer(_0x2dc9bd,_0x5c5edc);}}function startTimer(_0x2338a2,_0x243254){const _0x216f7f=a2_0x408b8a;if(activeTimer)clearTimeout(activeTimer);timeoutMs=_0x243254*0x3c*0x3e8,startTime=Date['now'](),alarmStage=0x0,_0x2338a2[_0x216f7f(0x114)][_0x216f7f(0xf1)](_0x216f7f(0xf9)+currentMonitoredRoom+_0x216f7f(0x10d)+_0x243254+_0x216f7f(0x10e)),_0x2338a2[_0x216f7f(0xeb)]('analysis.safety.deadMan.alarmState',{'val':'ok','ack':!![]}),activeTimer=setTimeout(()=>triggerPreWarn(_0x2338a2),timeoutMs);}function resetTimer(_0x3bdf71){const _0x15d0a7=a2_0x408b8a;if(activeTimer)clearTimeout(activeTimer);activeTimer=null,currentMonitoredRoom=null,alarmStage=0x0,_0x3bdf71[_0x15d0a7(0xeb)](_0x15d0a7(0xec),{'val':'ok','ack':!![]});}async function triggerPreWarn(_0x3c3be3){const _0x450b4d=a2_0x408b8a;alarmStage=0x1,await _0x3c3be3['setStateAsync'](_0x450b4d(0xec),{'val':'pre_warn','ack':!![]});const _0x9945a7=_0x450b4d(0x102)+currentMonitoredRoom+_0x450b4d(0xf0);_0x3c3be3[_0x450b4d(0x114)][_0x450b4d(0x113)](_0x450b4d(0x10c)+_0x9945a7),await setup[_0x450b4d(0x104)](_0x3c3be3,'ðŸ‘¼\x20Schutzengel-Frage:\x20'+_0x9945a7),activeTimer=setTimeout(()=>triggerAlarm(_0x3c3be3),0x5*0x3c*0x3e8);}async function triggerAlarm(_0x3b2cfe){const _0xd86673=a2_0x408b8a;alarmStage=0x2,await _0x3b2cfe[_0xd86673(0xeb)](_0xd86673(0xec),{'val':_0xd86673(0x101),'ack':!![]});const _0x2984fe=_0xd86673(0x111)+currentMonitoredRoom+'!';_0x3b2cfe[_0xd86673(0x114)][_0xd86673(0x116)](_0xd86673(0x10c)+_0x2984fe),await setup['sendNotification'](_0x3b2cfe,_0x2984fe,![],!![]);}module[a2_0x408b8a(0xf2)]={'updateLocation':updateLocation};