const a2_0x25d1e6=a2_0x1be6;(function(_0x5bfcea,_0x3ae327){const _0x596547=a2_0x1be6,_0x233a9b=_0x5bfcea();while(!![]){try{const _0x5001a6=parseInt(_0x596547(0xa2))/0x1*(parseInt(_0x596547(0xab))/0x2)+parseInt(_0x596547(0xce))/0x3*(parseInt(_0x596547(0xa4))/0x4)+-parseInt(_0x596547(0xb5))/0x5+-parseInt(_0x596547(0xae))/0x6*(parseInt(_0x596547(0xcf))/0x7)+-parseInt(_0x596547(0x9e))/0x8*(parseInt(_0x596547(0xaf))/0x9)+parseInt(_0x596547(0x9c))/0xa*(parseInt(_0x596547(0xcb))/0xb)+parseInt(_0x596547(0xd2))/0xc*(parseInt(_0x596547(0xc4))/0xd);if(_0x5001a6===_0x3ae327)break;else _0x233a9b['push'](_0x233a9b['shift']());}catch(_0x16ce5e){_0x233a9b['push'](_0x233a9b['shift']());}}}(a2_0x3c49,0x9a993));const a2_0x135523=(function(){let _0x20814c=!![];return function(_0x5be86c,_0x4dbc9d){const _0x393447=_0x20814c?function(){if(_0x4dbc9d){const _0x40aa29=_0x4dbc9d['apply'](_0x5be86c,arguments);return _0x4dbc9d=null,_0x40aa29;}}:function(){};return _0x20814c=![],_0x393447;};}()),a2_0x1954aa=a2_0x135523(this,function(){const _0x286411=a2_0x1be6;return a2_0x1954aa[_0x286411(0xc3)]()['search']('(((.+)+)+)+$')[_0x286411(0xc3)]()[_0x286411(0x94)](a2_0x1954aa)[_0x286411(0x96)]('(((.+)+)+)+$');});a2_0x1954aa();'use strict';const setup=require(a2_0x25d1e6(0xb0));let activeTimer=null,currentMonitoredRoom=null,timeoutMs=0x0,startTime=0x0,alarmStage=0x0;function a2_0x1be6(_0x30e70c,_0x3be8b8){const _0x335fc2=a2_0x3c49();return a2_0x1be6=function(_0x1954aa,_0x135523){_0x1954aa=_0x1954aa-0x94;let _0x3c49f0=_0x335fc2[_0x1954aa];return _0x3c49f0;},a2_0x1be6(_0x30e70c,_0x3be8b8);}const DEFAULT_TIMEOUTS={'bad':0x2d,'bath':0x2d,'toilet':0x1e,'wc':0x1e,'keller':0x3c,'schlaf':0x78,'bed':0x78,'guest':0x5a,'gast':0x5a};function getTimeoutRobust(_0x29298d,_0x592d02){const _0x3fbb0b=a2_0x25d1e6;if(!_0x29298d||!_0x592d02)return undefined;if(_0x29298d[_0x592d02])return _0x29298d[_0x592d02];const _0x2a20da=_0x592d02['toLowerCase']()[_0x3fbb0b(0x9a)](/[^a-z0-9]/g,'');for(const _0x3f1255 in _0x29298d){const _0x3a4706=_0x3f1255[_0x3fbb0b(0xb1)]()[_0x3fbb0b(0x9a)](/[^a-z0-9]/g,'');if(_0x3a4706===_0x2a20da)return _0x29298d[_0x3f1255];}const _0x2b9825=_0x592d02[_0x3fbb0b(0xb1)]();if(_0x29298d[_0x2b9825])return _0x29298d[_0x2b9825];return undefined;}async function loadConfig(_0x2ebcce){const _0x2b7ace=a2_0x25d1e6;try{const _0x4bfad7=await _0x2ebcce[_0x2b7ace(0xb7)](_0x2b7ace(0xb4));if(_0x4bfad7&&_0x4bfad7[_0x2b7ace(0xa8)])return JSON[_0x2b7ace(0xa6)](_0x4bfad7[_0x2b7ace(0xa8)]);}catch(_0x3c4487){}return{};}async function isActive(_0x16deeb){const _0x3befbf=a2_0x25d1e6;try{const _0x7e87d8=await _0x16deeb[_0x3befbf(0xb7)](_0x3befbf(0xa1));return _0x7e87d8&&_0x7e87d8[_0x3befbf(0xa8)];}catch(_0x2eec05){return![];}}async function areRoomsConnected(_0x403188,_0x233714,_0x4a555f){const _0x2a500e=a2_0x25d1e6;try{const _0x5605e8=await _0x403188[_0x2a500e(0xb7)](_0x2a500e(0xbf));if(!_0x5605e8||!_0x5605e8[_0x2a500e(0xa8)])return!![];const _0x5854ac=JSON[_0x2a500e(0xa6)](_0x5605e8['val']),{rooms:_0x4fe0f0,matrix:_0x48e624}=_0x5854ac;if(!_0x4fe0f0||!_0x48e624)return!![];const _0xd50e0e=_0x4fe0f0[_0x2a500e(0x98)](_0x233714),_0x3c3516=_0x4fe0f0[_0x2a500e(0x98)](_0x4a555f);if(_0xd50e0e===-0x1||_0x3c3516===-0x1)return!![];const _0xd3ac0=_0x48e624[_0xd50e0e][_0x3c3516]>0x0||_0x48e624[_0x3c3516][_0xd50e0e]>0x0;return _0xd3ac0;}catch(_0x9a3dd){return _0x403188[_0x2a500e(0xc9)][_0x2a500e(0xcd)](_0x2a500e(0xa3)+_0x9a3dd[_0x2a500e(0xaa)]),!![];}}function a2_0x3c49(){const _0x39340a=['â³\x20ACHTUNG:\x20UngewÃ¶hnlich\x20lange\x20InaktivitÃ¤t\x20in\x20','analysis.safety.deadMan.currentRoom','analysis.safety.deadMan.config','4642130HUWdZV','bed','getStateAsync','pre_warn','stringify','toFixed','\x20fÃ¼r\x20','%).\x20VerlÃ¤ngere\x20Timer\x20fÃ¼r\x20','analysis.safety.deadMan.smartSleep','\x20um\x2090\x20Min.','analysis.topology.structure','[DeadMan]\x20','analysis.safety.deadMan.napProbability','living','toString','3115138hCnbyx','ðŸ’¤\x20Smart\x20Sleep\x20erkannt\x20(','includes','Unknown','ðŸš¨\x20NOTFALL-ALARM:\x20Person\x20reagiert\x20nicht\x20in\x20','log','now','1034OaTMah','bad','warn','630kHRVKh','228102jVkiOw','setStateAsync','\x20(Multi-Person\x20Filter)','24ZlSSos','alarm','wohn','constructor','sofa','search','\x20Min.','indexOf','schlaf','replace','.\x20Alles\x20in\x20Ordnung?','69370gTuaIf','info','4976LHhhJy','sendNotification','analysis.safety.deadMan.alarmState','analysis.safety.deadMan.active','64517ZCubIi','[DeadMan]\x20Topology\x20check\x20failed:\x20','19836oBQQgb','ðŸ‘¼\x20Schutzengel-Frage:\x20','parse','getHours','val','ðŸ‘¼\x20Schutzengel:\x20Ãœberwache\x20','message','26uleWzM','Ignoriere\x20Bewegung\x20in\x20\x27','default','90DOBDQA','13905EVLfSZ','./setup','toLowerCase'];a2_0x3c49=function(){return _0x39340a;};return a2_0x3c49();}function calculateSleepProbability(_0x1685f2){const _0x11eafb=a2_0x25d1e6,_0x4e58e1=new Date(),_0x3522e2=_0x4e58e1[_0x11eafb(0xa7)](),_0xd4572d=_0x1685f2[_0x11eafb(0xb1)]();let _0x3764bc=0.1;if(_0x3522e2>=0x17||_0x3522e2<=0x6)_0x3764bc=0x1;else{if(_0x3522e2>=0xd&&_0x3522e2<=0xf)_0x3764bc=0.8;else{if(_0x3522e2>=0x14&&_0x3522e2<=0x17)_0x3764bc=0.4;}}let _0x751406=0.1;if(_0xd4572d[_0x11eafb(0xc6)](_0x11eafb(0x99))||_0xd4572d[_0x11eafb(0xc6)](_0x11eafb(0xb6)))_0x751406=0x1;else{if(_0xd4572d[_0x11eafb(0xc6)](_0x11eafb(0xd4))||_0xd4572d['includes'](_0x11eafb(0xc2))||_0xd4572d[_0x11eafb(0xc6)](_0x11eafb(0x95)))_0x751406=0.6;else{if(_0xd4572d['includes'](_0x11eafb(0xcc))||_0xd4572d[_0x11eafb(0xc6)]('wc'))_0x751406=0.05;}}let _0x1c970a=0.5;const _0x1452c3=_0x751406*0.5+_0x3764bc*0.3+_0x1c970a*0.2;return parseFloat(_0x1452c3[_0x11eafb(0xba)](0x2));}async function updateLocation(_0x45d5a1,_0x4c932d){const _0x5577f1=a2_0x25d1e6;if(!_0x4c932d||_0x4c932d===_0x5577f1(0xc7))return;if(!await isActive(_0x45d5a1)){resetTimer(_0x45d5a1);return;}if(currentMonitoredRoom&&currentMonitoredRoom!==_0x4c932d){const _0x4742e0=await areRoomsConnected(_0x45d5a1,currentMonitoredRoom,_0x4c932d);if(!_0x4742e0){const _0x2e5a0e=_0x5577f1(0xac)+_0x4c932d+'\x27.\x20Nicht\x20verbunden\x20mit\x20Ã¼berwachtem\x20\x27'+currentMonitoredRoom+'\x27.';_0x45d5a1[_0x5577f1(0xc9)]['info']('[DeadMan]\x20'+_0x2e5a0e+_0x5577f1(0xd1)),await _0x45d5a1[_0x5577f1(0xd0)]('analysis.safety.deadMan.lastIgnored',{'val':JSON[_0x5577f1(0xb9)]({'room':_0x4c932d,'reason':_0x2e5a0e,'timestamp':Date['now']()}),'ack':!![]});return;}resetTimer(_0x45d5a1);}if(!currentMonitoredRoom){await _0x45d5a1[_0x5577f1(0xd0)](_0x5577f1(0xb3),{'val':_0x4c932d,'ack':!![]});const _0x5ca3d6=await loadConfig(_0x45d5a1);let _0x415404=getTimeoutRobust(_0x5ca3d6,_0x4c932d);const _0x19fce9=_0x4c932d[_0x5577f1(0xb1)]();if(!_0x415404)for(const _0x34b0d7 in DEFAULT_TIMEOUTS){if(_0x19fce9[_0x5577f1(0xc6)](_0x34b0d7)){_0x415404=DEFAULT_TIMEOUTS[_0x34b0d7];break;}}if(!_0x415404&&_0x5ca3d6[_0x5577f1(0xad)])_0x415404=_0x5ca3d6['default'];if(!_0x415404)return;currentMonitoredRoom=_0x4c932d,startTimer(_0x45d5a1,_0x415404,_0x4c932d);}}function startTimer(_0x58571d,_0xa4a6d,_0x42d5d6){const _0x25255d=a2_0x25d1e6;if(activeTimer)clearTimeout(activeTimer);timeoutMs=_0xa4a6d*0x3c*0x3e8,startTime=Date[_0x25255d(0xca)](),alarmStage=0x0;const _0x2ae87d=calculateSleepProbability(_0x42d5d6||currentMonitoredRoom),_0x130bfa=_0x2ae87d>0.65;_0x130bfa?(timeoutMs+=0x5a*0x3c*0x3e8,_0x58571d[_0x25255d(0xc9)][_0x25255d(0x9d)](_0x25255d(0xc5)+(_0x2ae87d*0x64)[_0x25255d(0xba)](0x0)+_0x25255d(0xbc)+currentMonitoredRoom+_0x25255d(0xbe)),_0x58571d[_0x25255d(0xd0)](_0x25255d(0xbd),{'val':!![],'ack':!![]})):_0x58571d[_0x25255d(0xd0)](_0x25255d(0xbd),{'val':![],'ack':!![]}),_0x58571d[_0x25255d(0xd0)]('analysis.safety.deadMan.napProbability',{'val':_0x2ae87d,'ack':!![]}),_0x58571d['log'][_0x25255d(0x9d)](_0x25255d(0xa9)+currentMonitoredRoom+_0x25255d(0xbb)+_0xa4a6d+_0x25255d(0x97)),_0x58571d[_0x25255d(0xd0)](_0x25255d(0xa0),{'val':'ok','ack':!![]}),activeTimer=setTimeout(()=>triggerPreWarn(_0x58571d),timeoutMs);}function resetTimer(_0x3be29b){const _0x146462=a2_0x25d1e6;if(activeTimer)clearTimeout(activeTimer);activeTimer=null,currentMonitoredRoom=null,alarmStage=0x0,_0x3be29b[_0x146462(0xd0)](_0x146462(0xa0),{'val':'ok','ack':!![]}),_0x3be29b[_0x146462(0xd0)]('analysis.safety.deadMan.smartSleep',{'val':![],'ack':!![]}),_0x3be29b['setStateAsync'](_0x146462(0xc1),{'val':0x0,'ack':!![]});}async function triggerPreWarn(_0x294bd8){const _0x8f75e9=a2_0x25d1e6;alarmStage=0x1,await _0x294bd8[_0x8f75e9(0xd0)](_0x8f75e9(0xa0),{'val':_0x8f75e9(0xb8),'ack':!![]});const _0x478bee=_0x8f75e9(0xb2)+currentMonitoredRoom+_0x8f75e9(0x9b);_0x294bd8[_0x8f75e9(0xc9)][_0x8f75e9(0xcd)](_0x8f75e9(0xc0)+_0x478bee),await setup[_0x8f75e9(0x9f)](_0x294bd8,_0x8f75e9(0xa5)+_0x478bee),activeTimer=setTimeout(()=>triggerAlarm(_0x294bd8),0x5*0x3c*0x3e8);}async function triggerAlarm(_0x1d9b85){const _0x1e4cb2=a2_0x25d1e6;alarmStage=0x2,await _0x1d9b85[_0x1e4cb2(0xd0)](_0x1e4cb2(0xa0),{'val':_0x1e4cb2(0xd3),'ack':!![]});const _0x52cb5a=_0x1e4cb2(0xc8)+currentMonitoredRoom+'!';_0x1d9b85[_0x1e4cb2(0xc9)]['error'](_0x1e4cb2(0xc0)+_0x52cb5a),await setup[_0x1e4cb2(0x9f)](_0x1d9b85,_0x52cb5a,![],!![]);}module['exports']={'updateLocation':updateLocation};