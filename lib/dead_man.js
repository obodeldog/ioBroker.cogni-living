const a2_0x523834=a2_0xa4cd;(function(_0x121531,_0x5db900){const _0x38e8bb=a2_0xa4cd,_0x56b302=_0x121531();while(!![]){try{const _0x51d2c2=-parseInt(_0x38e8bb(0x161))/0x1+parseInt(_0x38e8bb(0x15a))/0x2*(parseInt(_0x38e8bb(0x13a))/0x3)+parseInt(_0x38e8bb(0x153))/0x4+parseInt(_0x38e8bb(0x151))/0x5+parseInt(_0x38e8bb(0x15d))/0x6+parseInt(_0x38e8bb(0x16a))/0x7+-parseInt(_0x38e8bb(0x148))/0x8;if(_0x51d2c2===_0x5db900)break;else _0x56b302['push'](_0x56b302['shift']());}catch(_0x11fa38){_0x56b302['push'](_0x56b302['shift']());}}}(a2_0xe40e,0xbb24a));const a2_0x535efd=(function(){let _0x3f97fa=!![];return function(_0x59c9f9,_0x412412){const _0x4af18b=_0x3f97fa?function(){const _0x5ab1a4=a2_0xa4cd;if(_0x412412){const _0x61dabd=_0x412412[_0x5ab1a4(0x13c)](_0x59c9f9,arguments);return _0x412412=null,_0x61dabd;}}:function(){};return _0x3f97fa=![],_0x4af18b;};}()),a2_0x595dbd=a2_0x535efd(this,function(){const _0x21794f=a2_0xa4cd;return a2_0x595dbd[_0x21794f(0x171)]()[_0x21794f(0x166)](_0x21794f(0x16d))[_0x21794f(0x171)]()['constructor'](a2_0x595dbd)[_0x21794f(0x166)](_0x21794f(0x16d));});a2_0x595dbd();'use strict';const setup=require(a2_0x523834(0x156));let activeTimer=null,currentMonitoredRoom=null,timeoutMs=0x0,startTime=0x0,alarmStage=0x0;const DEFAULT_TIMEOUTS={'bad':0x2d,'bath':0x2d,'toilet':0x1e,'wc':0x1e,'keller':0x3c,'schlaf':0x78,'bed':0x78,'guest':0x5a,'gast':0x5a};function getTimeoutRobust(_0x365a99,_0x474fc8){const _0x1faa2a=a2_0x523834;if(!_0x365a99||!_0x474fc8)return undefined;if(_0x365a99[_0x474fc8])return _0x365a99[_0x474fc8];const _0x1c2fb8=_0x474fc8['toLowerCase']()['replace'](/[^a-z0-9]/g,'');for(const _0x4b5b65 in _0x365a99){const _0x11bd67=_0x4b5b65['toLowerCase']()[_0x1faa2a(0x160)](/[^a-z0-9]/g,'');if(_0x11bd67===_0x1c2fb8)return _0x365a99[_0x4b5b65];}const _0x3cde00=_0x474fc8[_0x1faa2a(0x141)]();if(_0x365a99[_0x3cde00])return _0x365a99[_0x3cde00];return undefined;}async function loadConfig(_0x498ce3){const _0x4626d5=a2_0x523834;try{const _0x36e9b8=await _0x498ce3[_0x4626d5(0x172)](_0x4626d5(0x13e));if(_0x36e9b8&&_0x36e9b8[_0x4626d5(0x14f)])return JSON['parse'](_0x36e9b8['val']);}catch(_0x14d7bd){}return{};}async function isActive(_0x3e1c3e){const _0x1510b2=a2_0x523834;try{const _0x2c0db9=await _0x3e1c3e['getStateAsync'](_0x1510b2(0x15e));return _0x2c0db9&&_0x2c0db9[_0x1510b2(0x14f)];}catch(_0x3924c4){return![];}}async function areRoomsConnected(_0x171c13,_0x263917,_0x50a4b7){const _0x13a3a0=a2_0x523834;try{const _0x31c57a=await _0x171c13[_0x13a3a0(0x172)](_0x13a3a0(0x142));if(!_0x31c57a||!_0x31c57a[_0x13a3a0(0x14f)])return!![];const _0x447466=JSON[_0x13a3a0(0x167)](_0x31c57a['val']),{rooms:_0x1b6a42,matrix:_0x340eac}=_0x447466;if(!_0x1b6a42||!_0x340eac)return!![];const _0x4f8c08=_0x1b6a42['indexOf'](_0x263917),_0x157a8d=_0x1b6a42[_0x13a3a0(0x154)](_0x50a4b7);if(_0x4f8c08===-0x1||_0x157a8d===-0x1)return!![];const _0x5ae5fe=_0x340eac[_0x4f8c08][_0x157a8d]>0x0||_0x340eac[_0x157a8d][_0x4f8c08]>0x0;return _0x5ae5fe;}catch(_0x3791c1){return _0x171c13[_0x13a3a0(0x13f)][_0x13a3a0(0x14d)](_0x13a3a0(0x16f)+_0x3791c1[_0x13a3a0(0x149)]),!![];}}function calculateSleepProbability(_0x2e5bd8){const _0x4f8613=a2_0x523834,_0x492fe0=new Date(),_0x3140d3=_0x492fe0['getHours'](),_0xe8d3b4=_0x2e5bd8[_0x4f8613(0x141)]();let _0x588d44=0.1;if(_0x3140d3>=0x17||_0x3140d3<=0x6)_0x588d44=0x1;else{if(_0x3140d3>=0xd&&_0x3140d3<=0xf)_0x588d44=0.8;else{if(_0x3140d3>=0x14&&_0x3140d3<=0x17)_0x588d44=0.4;}}let _0x5b99a5=0.1;if(_0xe8d3b4['includes']('schlaf')||_0xe8d3b4[_0x4f8613(0x14b)](_0x4f8613(0x14c)))_0x5b99a5=0x1;else{if(_0xe8d3b4['includes'](_0x4f8613(0x139))||_0xe8d3b4[_0x4f8613(0x14b)]('living')||_0xe8d3b4[_0x4f8613(0x14b)](_0x4f8613(0x143)))_0x5b99a5=0.6;else{if(_0xe8d3b4['includes'](_0x4f8613(0x14e))||_0xe8d3b4['includes']('wc'))_0x5b99a5=0.05;}}let _0x170ab7=0.5;const _0x4ba915=_0x5b99a5*0.5+_0x588d44*0.3+_0x170ab7*0.2;return parseFloat(_0x4ba915[_0x4f8613(0x13b)](0x2));}async function updateLocation(_0x388c5b,_0x551852){const _0x367e09=a2_0x523834;if(!_0x551852||_0x551852===_0x367e09(0x157))return;if(!await isActive(_0x388c5b)){resetTimer(_0x388c5b);return;}if(currentMonitoredRoom&&currentMonitoredRoom!==_0x551852){const _0x301258=await areRoomsConnected(_0x388c5b,currentMonitoredRoom,_0x551852);if(!_0x301258){const _0x2df8f7='Ignoriere\x20Bewegung\x20in\x20\x27'+_0x551852+_0x367e09(0x144)+currentMonitoredRoom+'\x27.';_0x388c5b[_0x367e09(0x13f)][_0x367e09(0x15b)](_0x367e09(0x155)+_0x2df8f7+_0x367e09(0x150)),await _0x388c5b[_0x367e09(0x169)](_0x367e09(0x15f),{'val':JSON['stringify']({'room':_0x551852,'reason':_0x2df8f7,'timestamp':Date[_0x367e09(0x170)]()}),'ack':!![]});return;}resetTimer(_0x388c5b);}if(!currentMonitoredRoom){await _0x388c5b['setStateAsync'](_0x367e09(0x16b),{'val':_0x551852,'ack':!![]});const _0x69e704=await loadConfig(_0x388c5b);let _0x485f4f=getTimeoutRobust(_0x69e704,_0x551852);const _0x5a083f=_0x551852[_0x367e09(0x141)]();if(!_0x485f4f)for(const _0x88ac84 in DEFAULT_TIMEOUTS){if(_0x5a083f[_0x367e09(0x14b)](_0x88ac84)){_0x485f4f=DEFAULT_TIMEOUTS[_0x88ac84];break;}}if(!_0x485f4f&&_0x69e704[_0x367e09(0x162)])_0x485f4f=_0x69e704[_0x367e09(0x162)];if(!_0x485f4f)return;currentMonitoredRoom=_0x551852,startTimer(_0x388c5b,_0x485f4f,_0x551852);}}function startTimer(_0x55c7b9,_0xa1105d,_0x9f1ca7){const _0x20ca71=a2_0x523834;if(activeTimer)clearTimeout(activeTimer);timeoutMs=_0xa1105d*0x3c*0x3e8,startTime=Date['now'](),alarmStage=0x0;const _0x1155bf=calculateSleepProbability(_0x9f1ca7||currentMonitoredRoom),_0x5ab6ef=_0x1155bf>0.65;_0x5ab6ef?(timeoutMs+=0x5a*0x3c*0x3e8,_0x55c7b9[_0x20ca71(0x13f)][_0x20ca71(0x15b)](_0x20ca71(0x147)+(_0x1155bf*0x64)[_0x20ca71(0x13b)](0x0)+_0x20ca71(0x159)+currentMonitoredRoom+_0x20ca71(0x158)),_0x55c7b9['setStateAsync'](_0x20ca71(0x16e),{'val':!![],'ack':!![]})):_0x55c7b9[_0x20ca71(0x169)](_0x20ca71(0x16e),{'val':![],'ack':!![]}),_0x55c7b9[_0x20ca71(0x169)](_0x20ca71(0x15c),{'val':_0x1155bf,'ack':!![]}),_0x55c7b9['log'][_0x20ca71(0x15b)](_0x20ca71(0x163)+currentMonitoredRoom+_0x20ca71(0x164)+_0xa1105d+_0x20ca71(0x152)),_0x55c7b9[_0x20ca71(0x169)]('analysis.safety.deadMan.alarmState',{'val':'ok','ack':!![]}),activeTimer=setTimeout(()=>triggerPreWarn(_0x55c7b9),timeoutMs);}function resetTimer(_0x1af08c){const _0x910617=a2_0x523834;if(activeTimer)clearTimeout(activeTimer);activeTimer=null,currentMonitoredRoom=null,alarmStage=0x0,_0x1af08c['setStateAsync']('analysis.safety.deadMan.alarmState',{'val':'ok','ack':!![]}),_0x1af08c[_0x910617(0x169)](_0x910617(0x16e),{'val':![],'ack':!![]}),_0x1af08c[_0x910617(0x169)](_0x910617(0x15c),{'val':0x0,'ack':!![]});}function a2_0xe40e(){const _0x18c9cb=['analysis.safety.deadMan.napProbability','542418iIEPKk','analysis.safety.deadMan.active','analysis.safety.deadMan.lastIgnored','replace','1294194tKaXio','default','ðŸ‘¼\x20Schutzengel:\x20Ãœberwache\x20','\x20fÃ¼r\x20','analysis.safety.deadMan.alarmState','search','parse','.\x20Alles\x20in\x20Ordnung?','setStateAsync','8535779CEvKiC','analysis.safety.deadMan.currentRoom','exports','(((.+)+)+)+$','analysis.safety.deadMan.smartSleep','[DeadMan]\x20Topology\x20check\x20failed:\x20','now','toString','getStateAsync','wohn','1604487ZMzkEZ','toFixed','apply','error','analysis.safety.deadMan.config','log','ðŸš¨\x20NOTFALL-ALARM:\x20Person\x20reagiert\x20nicht\x20in\x20','toLowerCase','analysis.topology.structure','sofa','\x27.\x20Nicht\x20verbunden\x20mit\x20Ã¼berwachtem\x20\x27','sendNotification','pre_warn','ðŸ’¤\x20Smart\x20Sleep\x20erkannt\x20(','6224584wajMqh','message','ðŸ‘¼\x20Schutzengel-Frage:\x20','includes','bed','warn','bad','val','\x20(Multi-Person\x20Filter)','2144430qkPovY','\x20Min.','2261160xewsix','indexOf','[DeadMan]\x20','./setup','Unknown','\x20um\x2090\x20Min.','%).\x20VerlÃ¤ngere\x20Timer\x20fÃ¼r\x20','2CBFacL','info'];a2_0xe40e=function(){return _0x18c9cb;};return a2_0xe40e();}async function triggerPreWarn(_0x52603b){const _0x568170=a2_0x523834;alarmStage=0x1,await _0x52603b['setStateAsync'](_0x568170(0x165),{'val':_0x568170(0x146),'ack':!![]});const _0x455de0='â³\x20ACHTUNG:\x20UngewÃ¶hnlich\x20lange\x20InaktivitÃ¤t\x20in\x20'+currentMonitoredRoom+_0x568170(0x168);_0x52603b[_0x568170(0x13f)]['warn'](_0x568170(0x155)+_0x455de0),await setup[_0x568170(0x145)](_0x52603b,_0x568170(0x14a)+_0x455de0),activeTimer=setTimeout(()=>triggerAlarm(_0x52603b),0x5*0x3c*0x3e8);}function a2_0xa4cd(_0x272900,_0x229d8b){const _0x46afcc=a2_0xe40e();return a2_0xa4cd=function(_0x595dbd,_0x535efd){_0x595dbd=_0x595dbd-0x139;let _0xe40eb1=_0x46afcc[_0x595dbd];return _0xe40eb1;},a2_0xa4cd(_0x272900,_0x229d8b);}async function triggerAlarm(_0x2c277a){const _0x5ae5be=a2_0x523834;alarmStage=0x2,await _0x2c277a[_0x5ae5be(0x169)]('analysis.safety.deadMan.alarmState',{'val':'alarm','ack':!![]});const _0x5a5fba=_0x5ae5be(0x140)+currentMonitoredRoom+'!';_0x2c277a[_0x5ae5be(0x13f)][_0x5ae5be(0x13d)](_0x5ae5be(0x155)+_0x5a5fba),await setup[_0x5ae5be(0x145)](_0x2c277a,_0x5a5fba,![],!![]);}module[a2_0x523834(0x16c)]={'updateLocation':updateLocation};