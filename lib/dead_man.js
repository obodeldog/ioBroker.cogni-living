const a2_0x558d5c=a2_0x3d7d;(function(_0xe4d341,_0x4dd524){const _0x1ed541=a2_0x3d7d,_0x5ba374=_0xe4d341();while(!![]){try{const _0x561c78=parseInt(_0x1ed541(0x1c5))/0x1*(-parseInt(_0x1ed541(0x1bf))/0x2)+-parseInt(_0x1ed541(0x1db))/0x3+-parseInt(_0x1ed541(0x1ce))/0x4*(-parseInt(_0x1ed541(0x1b9))/0x5)+parseInt(_0x1ed541(0x1d3))/0x6*(-parseInt(_0x1ed541(0x1d9))/0x7)+-parseInt(_0x1ed541(0x1e7))/0x8+parseInt(_0x1ed541(0x1bc))/0x9+parseInt(_0x1ed541(0x1de))/0xa;if(_0x561c78===_0x4dd524)break;else _0x5ba374['push'](_0x5ba374['shift']());}catch(_0xa00533){_0x5ba374['push'](_0x5ba374['shift']());}}}(a2_0x35e3,0xb56d0));const a2_0x330760=(function(){let _0x1a1dc9=!![];return function(_0xeae5a6,_0x3d8f38){const _0x4831de=_0x1a1dc9?function(){const _0x13c785=a2_0x3d7d;if(_0x3d8f38){const _0x5dc3cf=_0x3d8f38[_0x13c785(0x1b0)](_0xeae5a6,arguments);return _0x3d8f38=null,_0x5dc3cf;}}:function(){};return _0x1a1dc9=![],_0x4831de;};}()),a2_0x431e65=a2_0x330760(this,function(){const _0x528fba=a2_0x3d7d;return a2_0x431e65[_0x528fba(0x1b5)]()[_0x528fba(0x1e3)](_0x528fba(0x1e1))['toString']()['constructor'](a2_0x431e65)[_0x528fba(0x1e3)](_0x528fba(0x1e1));});a2_0x431e65();'use strict';const setup=require(a2_0x558d5c(0x1d8));let activeTimer=null,currentMonitoredRoom=null,timeoutMs=0x0,startTime=0x0,alarmStage=0x0;const DEFAULT_TIMEOUTS={'bad':0x2d,'bath':0x2d,'toilet':0x1e,'wc':0x1e,'keller':0x3c,'schlaf':0x78,'bed':0x78,'guest':0x5a,'gast':0x5a};function a2_0x35e3(){const _0x226ac6=['toFixed','default','[DeadMan]\x20','8YrLyVd','\x20um\x2090\x20Min.','now','\x20Min.','\x20fÃ¼r\x20','4769106TCtbrS','schlaf','wohn','ðŸ‘¼\x20Schutzengel:\x20Ãœberwache\x20','toLowerCase','./setup','7QTuttj','analysis.topology.structure','1154361LtnOEe','Ignoriere\x20Bewegung\x20in\x20\x27','parse','14744530vfXyHi','getHours','ðŸ‘¼\x20Schutzengel-Frage:\x20','(((.+)+)+)+$','analysis.safety.deadMan.smartSleep','search','sendNotification','warn','indexOf','6564480XSamuX','val','analysis.safety.deadMan.napProbability','apply','\x27.\x20Nicht\x20verbunden\x20mit\x20Ã¼berwachtem\x20\x27','getStateAsync','log','includes','toString','exports','analysis.safety.deadMan.lastIgnored','analysis.safety.deadMan.alarmState','3609430sYGIJc','error','stringify','10222596RwXBUt','pre_warn','analysis.safety.deadMan.currentRoom','6dwTLSn','setStateAsync','ðŸš¨\x20NOTFALL-ALARM:\x20Person\x20reagiert\x20nicht\x20in\x20','%).\x20VerlÃ¤ngere\x20Timer\x20fÃ¼r\x20','\x20(Multi-Person\x20Filter)','Unknown','436917Eltwot','analysis.safety.deadMan.active','bed','.\x20Alles\x20in\x20Ordnung?','message','replace'];a2_0x35e3=function(){return _0x226ac6;};return a2_0x35e3();}function getTimeoutRobust(_0x2d5e80,_0x32f456){const _0x1feb49=a2_0x558d5c;if(!_0x2d5e80||!_0x32f456)return undefined;if(_0x2d5e80[_0x32f456])return _0x2d5e80[_0x32f456];const _0xdcaa1e=_0x32f456['toLowerCase']()['replace'](/[^a-z0-9]/g,'');for(const _0xbfbe2f in _0x2d5e80){const _0x19240c=_0xbfbe2f[_0x1feb49(0x1d7)]()[_0x1feb49(0x1ca)](/[^a-z0-9]/g,'');if(_0x19240c===_0xdcaa1e)return _0x2d5e80[_0xbfbe2f];}const _0x23e5a8=_0x32f456[_0x1feb49(0x1d7)]();if(_0x2d5e80[_0x23e5a8])return _0x2d5e80[_0x23e5a8];return undefined;}async function loadConfig(_0x54b2e1){const _0x1cf3d5=a2_0x558d5c;try{const _0x55424a=await _0x54b2e1['getStateAsync']('analysis.safety.deadMan.config');if(_0x55424a&&_0x55424a['val'])return JSON[_0x1cf3d5(0x1dd)](_0x55424a[_0x1cf3d5(0x1e8)]);}catch(_0x414ee2){}return{};}async function isActive(_0x223627){const _0x3273aa=a2_0x558d5c;try{const _0x1267a0=await _0x223627[_0x3273aa(0x1b2)](_0x3273aa(0x1c6));return _0x1267a0&&_0x1267a0['val'];}catch(_0xb10500){return![];}}async function areRoomsConnected(_0x26924f,_0x131c83,_0x138559){const _0x1a0a39=a2_0x558d5c;try{const _0x5474e2=await _0x26924f['getStateAsync'](_0x1a0a39(0x1da));if(!_0x5474e2||!_0x5474e2[_0x1a0a39(0x1e8)])return!![];const _0x339793=JSON[_0x1a0a39(0x1dd)](_0x5474e2['val']),{rooms:_0xb61dd7,matrix:_0x113d6e}=_0x339793;if(!_0xb61dd7||!_0x113d6e)return!![];const _0x2523ac=_0xb61dd7[_0x1a0a39(0x1e6)](_0x131c83),_0x51cf7d=_0xb61dd7[_0x1a0a39(0x1e6)](_0x138559);if(_0x2523ac===-0x1||_0x51cf7d===-0x1)return!![];const _0x1cd506=_0x113d6e[_0x2523ac][_0x51cf7d]>0x0||_0x113d6e[_0x51cf7d][_0x2523ac]>0x0;return _0x1cd506;}catch(_0x395b90){return _0x26924f[_0x1a0a39(0x1b3)][_0x1a0a39(0x1e5)]('[DeadMan]\x20Topology\x20check\x20failed:\x20'+_0x395b90[_0x1a0a39(0x1c9)]),!![];}}function a2_0x3d7d(_0x18c7fc,_0x1ea9c3){const _0x2da9c9=a2_0x35e3();return a2_0x3d7d=function(_0x431e65,_0x330760){_0x431e65=_0x431e65-0x1b0;let _0x35e32f=_0x2da9c9[_0x431e65];return _0x35e32f;},a2_0x3d7d(_0x18c7fc,_0x1ea9c3);}function calculateSleepProbability(_0x996443){const _0x5a3255=a2_0x558d5c,_0x1bb2e5=new Date(),_0x5125ef=_0x1bb2e5[_0x5a3255(0x1df)](),_0xf9b825=_0x996443[_0x5a3255(0x1d7)]();let _0x2deed1=0.1;if(_0x5125ef>=0x17||_0x5125ef<=0x6)_0x2deed1=0x1;else{if(_0x5125ef>=0xd&&_0x5125ef<=0xf)_0x2deed1=0.8;else{if(_0x5125ef>=0x14&&_0x5125ef<=0x17)_0x2deed1=0.4;}}let _0x5bcd2d=0.1;if(_0xf9b825[_0x5a3255(0x1b4)](_0x5a3255(0x1d4))||_0xf9b825[_0x5a3255(0x1b4)](_0x5a3255(0x1c7)))_0x5bcd2d=0x1;else{if(_0xf9b825[_0x5a3255(0x1b4)](_0x5a3255(0x1d5))||_0xf9b825[_0x5a3255(0x1b4)]('living')||_0xf9b825[_0x5a3255(0x1b4)]('sofa'))_0x5bcd2d=0.6;else{if(_0xf9b825['includes']('bad')||_0xf9b825[_0x5a3255(0x1b4)]('wc'))_0x5bcd2d=0.05;}}let _0x5765db=0.5;const _0x1a1c93=_0x5bcd2d*0.5+_0x2deed1*0.3+_0x5765db*0.2;return parseFloat(_0x1a1c93[_0x5a3255(0x1cb)](0x2));}async function updateLocation(_0x5e22b2,_0x3809c6){const _0x52f6c1=a2_0x558d5c;if(!_0x3809c6||_0x3809c6===_0x52f6c1(0x1c4))return;if(!await isActive(_0x5e22b2)){resetTimer(_0x5e22b2);return;}if(currentMonitoredRoom&&currentMonitoredRoom!==_0x3809c6){const _0x17e88b=await areRoomsConnected(_0x5e22b2,currentMonitoredRoom,_0x3809c6);if(!_0x17e88b){const _0x38b14f=_0x52f6c1(0x1dc)+_0x3809c6+_0x52f6c1(0x1b1)+currentMonitoredRoom+'\x27.';_0x5e22b2[_0x52f6c1(0x1b3)]['info'](_0x52f6c1(0x1cd)+_0x38b14f+_0x52f6c1(0x1c3)),await _0x5e22b2[_0x52f6c1(0x1c0)](_0x52f6c1(0x1b7),{'val':JSON[_0x52f6c1(0x1bb)]({'room':_0x3809c6,'reason':_0x38b14f,'timestamp':Date[_0x52f6c1(0x1d0)]()}),'ack':!![]});return;}resetTimer(_0x5e22b2);}if(!currentMonitoredRoom){await _0x5e22b2[_0x52f6c1(0x1c0)](_0x52f6c1(0x1be),{'val':_0x3809c6,'ack':!![]});const _0x255983=await loadConfig(_0x5e22b2);let _0x386ee8=getTimeoutRobust(_0x255983,_0x3809c6);const _0x38f0ac=_0x3809c6['toLowerCase']();if(!_0x386ee8)for(const _0x44864f in DEFAULT_TIMEOUTS){if(_0x38f0ac[_0x52f6c1(0x1b4)](_0x44864f)){_0x386ee8=DEFAULT_TIMEOUTS[_0x44864f];break;}}if(!_0x386ee8&&_0x255983[_0x52f6c1(0x1cc)])_0x386ee8=_0x255983[_0x52f6c1(0x1cc)];if(!_0x386ee8)return;currentMonitoredRoom=_0x3809c6,startTimer(_0x5e22b2,_0x386ee8,_0x3809c6);}}function startTimer(_0x4b3240,_0x15c8f1,_0xefb2a0){const _0x5b62ff=a2_0x558d5c;if(activeTimer)clearTimeout(activeTimer);timeoutMs=_0x15c8f1*0x3c*0x3e8,startTime=Date[_0x5b62ff(0x1d0)](),alarmStage=0x0;const _0x5a5a31=calculateSleepProbability(_0xefb2a0||currentMonitoredRoom),_0x446d67=_0x5a5a31>0.65;_0x446d67?(timeoutMs+=0x5a*0x3c*0x3e8,_0x4b3240[_0x5b62ff(0x1b3)]['info']('ðŸ’¤\x20Smart\x20Sleep\x20erkannt\x20('+(_0x5a5a31*0x64)[_0x5b62ff(0x1cb)](0x0)+_0x5b62ff(0x1c2)+currentMonitoredRoom+_0x5b62ff(0x1cf)),_0x4b3240['setStateAsync'](_0x5b62ff(0x1e2),{'val':!![],'ack':!![]})):_0x4b3240['setStateAsync'](_0x5b62ff(0x1e2),{'val':![],'ack':!![]}),_0x4b3240['setStateAsync']('analysis.safety.deadMan.napProbability',{'val':_0x5a5a31,'ack':!![]}),_0x4b3240['log']['info'](_0x5b62ff(0x1d6)+currentMonitoredRoom+_0x5b62ff(0x1d2)+_0x15c8f1+_0x5b62ff(0x1d1)),_0x4b3240[_0x5b62ff(0x1c0)](_0x5b62ff(0x1b8),{'val':'ok','ack':!![]}),activeTimer=setTimeout(()=>triggerPreWarn(_0x4b3240),timeoutMs);}function resetTimer(_0x254b5a){const _0x32033e=a2_0x558d5c;if(activeTimer)clearTimeout(activeTimer);activeTimer=null,currentMonitoredRoom=null,alarmStage=0x0,_0x254b5a['setStateAsync'](_0x32033e(0x1b8),{'val':'ok','ack':!![]}),_0x254b5a[_0x32033e(0x1c0)](_0x32033e(0x1e2),{'val':![],'ack':!![]}),_0x254b5a['setStateAsync'](_0x32033e(0x1e9),{'val':0x0,'ack':!![]});}async function triggerPreWarn(_0x3469dc){const _0x1149c1=a2_0x558d5c;alarmStage=0x1,await _0x3469dc[_0x1149c1(0x1c0)]('analysis.safety.deadMan.alarmState',{'val':_0x1149c1(0x1bd),'ack':!![]});const _0x5044a7='â³\x20ACHTUNG:\x20UngewÃ¶hnlich\x20lange\x20InaktivitÃ¤t\x20in\x20'+currentMonitoredRoom+_0x1149c1(0x1c8);_0x3469dc[_0x1149c1(0x1b3)][_0x1149c1(0x1e5)](_0x1149c1(0x1cd)+_0x5044a7),await setup[_0x1149c1(0x1e4)](_0x3469dc,_0x1149c1(0x1e0)+_0x5044a7),activeTimer=setTimeout(()=>triggerAlarm(_0x3469dc),0x5*0x3c*0x3e8);}async function triggerAlarm(_0x5b3b50){const _0x3d3da4=a2_0x558d5c;alarmStage=0x2,await _0x5b3b50['setStateAsync'](_0x3d3da4(0x1b8),{'val':'alarm','ack':!![]});const _0x42c318=_0x3d3da4(0x1c1)+currentMonitoredRoom+'!';_0x5b3b50[_0x3d3da4(0x1b3)][_0x3d3da4(0x1ba)](_0x3d3da4(0x1cd)+_0x42c318),await setup[_0x3d3da4(0x1e4)](_0x5b3b50,_0x42c318,![],!![]);}module[a2_0x558d5c(0x1b6)]={'updateLocation':updateLocation};