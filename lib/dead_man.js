function a2_0x1448(_0x502f43,_0x186985){const _0x59c192=a2_0x4723();return a2_0x1448=function(_0x5488e2,_0x21ea9b){_0x5488e2=_0x5488e2-0x120;let _0x472327=_0x59c192[_0x5488e2];return _0x472327;},a2_0x1448(_0x502f43,_0x186985);}const a2_0x3eb2db=a2_0x1448;(function(_0x25e5e3,_0x34013d){const _0x35e73a=a2_0x1448,_0x202863=_0x25e5e3();while(!![]){try{const _0x1f5861=parseInt(_0x35e73a(0x144))/0x1+parseInt(_0x35e73a(0x154))/0x2*(parseInt(_0x35e73a(0x13b))/0x3)+parseInt(_0x35e73a(0x145))/0x4*(-parseInt(_0x35e73a(0x13a))/0x5)+parseInt(_0x35e73a(0x125))/0x6+parseInt(_0x35e73a(0x13f))/0x7*(parseInt(_0x35e73a(0x130))/0x8)+-parseInt(_0x35e73a(0x140))/0x9*(parseInt(_0x35e73a(0x149))/0xa)+parseInt(_0x35e73a(0x142))/0xb;if(_0x1f5861===_0x34013d)break;else _0x202863['push'](_0x202863['shift']());}catch(_0x38797e){_0x202863['push'](_0x202863['shift']());}}}(a2_0x4723,0xa2722));const a2_0x21ea9b=(function(){let _0x50b0a6=!![];return function(_0x32c9ac,_0x50d2bd){const _0x635bf0=_0x50b0a6?function(){const _0x2ee52c=a2_0x1448;if(_0x50d2bd){const _0x477b32=_0x50d2bd[_0x2ee52c(0x147)](_0x32c9ac,arguments);return _0x50d2bd=null,_0x477b32;}}:function(){};return _0x50b0a6=![],_0x635bf0;};}()),a2_0x5488e2=a2_0x21ea9b(this,function(){const _0x10b191=a2_0x1448;return a2_0x5488e2[_0x10b191(0x133)]()['search'](_0x10b191(0x15b))['toString']()['constructor'](a2_0x5488e2)[_0x10b191(0x14d)](_0x10b191(0x15b));});a2_0x5488e2();function a2_0x4723(){const _0x4c843b=['includes','ðŸ‘¼\x20Schutzengel:\x20Ãœberwache\x20','analysis.safety.deadMan.napProbability','analysis.safety.deadMan.lastIgnored','\x27.\x20Nicht\x20verbunden\x20mit\x20Ã¼berwachtem\x20\x27','val','analysis.safety.deadMan.currentRoom','8NZjTsD','stringify','â³\x20ACHTUNG:\x20UngewÃ¶hnlich\x20lange\x20InaktivitÃ¤t\x20in\x20','toString','warn','schlaf','\x20(Multi-Person\x20Filter)','exports','analysis.topology.structure','analysis.safety.deadMan.active','5893915uCAJJm','803211jTPGre','\x20um\x2090\x20Min.','\x20fÃ¼r\x20','Unknown','2344139eARuKc','9464481CICOUY','.\x20Alles\x20in\x20Ordnung?','6128892UFvtwY','%).\x20VerlÃ¤ngere\x20Timer\x20fÃ¼r\x20','635890mKpjdt','4uVgrGD','error','apply','default','10TTcKHu','indexOf','[DeadMan]\x20Topology\x20check\x20failed:\x20','[DeadMan]\x20','search','\x20Min.','parse','pre_warn','message','sendNotification','ðŸ‘¼\x20Schutzengel-Frage:\x20','6PfHAiB','toFixed','./setup','setStateAsync','ðŸ’¤\x20Smart\x20Sleep\x20erkannt\x20(','sofa','getStateAsync','(((.+)+)+)+$','now','analysis.safety.deadMan.config','analysis.safety.deadMan.smartSleep','analysis.safety.deadMan.alarmState','alarm','ðŸš¨\x20NOTFALL-ALARM:\x20Person\x20reagiert\x20nicht\x20in\x20','3387720noVxMV','toLowerCase','info','log'];a2_0x4723=function(){return _0x4c843b;};return a2_0x4723();}'use strict';const setup=require(a2_0x3eb2db(0x156));let activeTimer=null,currentMonitoredRoom=null,timeoutMs=0x0,startTime=0x0,alarmStage=0x0;const DEFAULT_TIMEOUTS={'bad':0x2d,'bath':0x2d,'toilet':0x1e,'wc':0x1e,'keller':0x3c,'schlaf':0x78,'bed':0x78,'guest':0x5a,'gast':0x5a};async function loadConfig(_0x4ffe2e){const _0x46c0ab=a2_0x3eb2db;try{const _0x5abc43=await _0x4ffe2e['getStateAsync'](_0x46c0ab(0x120));if(_0x5abc43&&_0x5abc43[_0x46c0ab(0x12e)])return JSON[_0x46c0ab(0x14f)](_0x5abc43[_0x46c0ab(0x12e)]);}catch(_0xa2c92e){}return{};}async function isActive(_0x5a16d5){const _0x4558c6=a2_0x3eb2db;try{const _0x4c67f1=await _0x5a16d5[_0x4558c6(0x15a)](_0x4558c6(0x139));return _0x4c67f1&&_0x4c67f1[_0x4558c6(0x12e)];}catch(_0x126080){return![];}}async function areRoomsConnected(_0x20fc2d,_0x4494ee,_0x636c33){const _0x2dac6c=a2_0x3eb2db;try{const _0x382d1a=await _0x20fc2d[_0x2dac6c(0x15a)](_0x2dac6c(0x138));if(!_0x382d1a||!_0x382d1a[_0x2dac6c(0x12e)])return!![];const _0x10a01d=JSON[_0x2dac6c(0x14f)](_0x382d1a['val']),{rooms:_0x1789d3,matrix:_0x27feec}=_0x10a01d;if(!_0x1789d3||!_0x27feec)return!![];const _0x512809=_0x1789d3[_0x2dac6c(0x14a)](_0x4494ee),_0x580299=_0x1789d3['indexOf'](_0x636c33);if(_0x512809===-0x1||_0x580299===-0x1)return!![];const _0x501944=_0x27feec[_0x512809][_0x580299]>0x0||_0x27feec[_0x580299][_0x512809]>0x0;return _0x501944;}catch(_0x52dc44){return _0x20fc2d[_0x2dac6c(0x128)][_0x2dac6c(0x134)](_0x2dac6c(0x14b)+_0x52dc44[_0x2dac6c(0x151)]),!![];}}function calculateSleepProbability(_0xc1ea41){const _0x5732e7=a2_0x3eb2db,_0x462975=new Date(),_0x4461a4=_0x462975['getHours'](),_0xa0c3da=_0xc1ea41[_0x5732e7(0x126)]();let _0x5b46a7=0.1;if(_0x4461a4>=0x17||_0x4461a4<=0x6)_0x5b46a7=0x1;else{if(_0x4461a4>=0xd&&_0x4461a4<=0xf)_0x5b46a7=0.8;else{if(_0x4461a4>=0x14&&_0x4461a4<=0x17)_0x5b46a7=0.4;}}let _0x458908=0.1;if(_0xa0c3da[_0x5732e7(0x129)](_0x5732e7(0x135))||_0xa0c3da[_0x5732e7(0x129)]('bed'))_0x458908=0x1;else{if(_0xa0c3da['includes']('wohn')||_0xa0c3da['includes']('living')||_0xa0c3da[_0x5732e7(0x129)](_0x5732e7(0x159)))_0x458908=0.6;else{if(_0xa0c3da[_0x5732e7(0x129)]('bad')||_0xa0c3da[_0x5732e7(0x129)]('wc'))_0x458908=0.05;}}let _0x58d803=0.5;const _0x2d5274=_0x458908*0.5+_0x5b46a7*0.3+_0x58d803*0.2;return parseFloat(_0x2d5274[_0x5732e7(0x155)](0x2));}async function updateLocation(_0x17b2a6,_0x3cdf38){const _0xd5fa7d=a2_0x3eb2db;if(!_0x3cdf38||_0x3cdf38===_0xd5fa7d(0x13e))return;if(!await isActive(_0x17b2a6)){resetTimer(_0x17b2a6);return;}if(currentMonitoredRoom&&currentMonitoredRoom!==_0x3cdf38){const _0x880aa8=await areRoomsConnected(_0x17b2a6,currentMonitoredRoom,_0x3cdf38);if(!_0x880aa8){const _0x304128='Ignoriere\x20Bewegung\x20in\x20\x27'+_0x3cdf38+_0xd5fa7d(0x12d)+currentMonitoredRoom+'\x27.';_0x17b2a6['log'][_0xd5fa7d(0x127)](_0xd5fa7d(0x14c)+_0x304128+_0xd5fa7d(0x136)),await _0x17b2a6[_0xd5fa7d(0x157)](_0xd5fa7d(0x12c),{'val':JSON[_0xd5fa7d(0x131)]({'room':_0x3cdf38,'reason':_0x304128,'timestamp':Date[_0xd5fa7d(0x15c)]()}),'ack':!![]});return;}resetTimer(_0x17b2a6);}if(!currentMonitoredRoom){await _0x17b2a6[_0xd5fa7d(0x157)](_0xd5fa7d(0x12f),{'val':_0x3cdf38,'ack':!![]});const _0x1395fe=await loadConfig(_0x17b2a6),_0x253a46=_0x3cdf38[_0xd5fa7d(0x126)]();let _0xc9a9f2=_0x1395fe[_0x3cdf38]||_0x1395fe[_0x253a46];if(!_0xc9a9f2)for(const _0x4837ab in DEFAULT_TIMEOUTS){if(_0x253a46[_0xd5fa7d(0x129)](_0x4837ab)){_0xc9a9f2=DEFAULT_TIMEOUTS[_0x4837ab];break;}}if(!_0xc9a9f2&&_0x1395fe[_0xd5fa7d(0x148)])_0xc9a9f2=_0x1395fe[_0xd5fa7d(0x148)];if(!_0xc9a9f2)return;currentMonitoredRoom=_0x3cdf38,startTimer(_0x17b2a6,_0xc9a9f2,_0x3cdf38);}}function startTimer(_0x4ea4bd,_0x550e62,_0x2addf4){const _0x1f3309=a2_0x3eb2db;if(activeTimer)clearTimeout(activeTimer);timeoutMs=_0x550e62*0x3c*0x3e8,startTime=Date[_0x1f3309(0x15c)](),alarmStage=0x0;const _0x53ebc6=calculateSleepProbability(_0x2addf4||currentMonitoredRoom),_0x2fe885=_0x53ebc6>0.65;_0x2fe885?(timeoutMs+=0x5a*0x3c*0x3e8,_0x4ea4bd[_0x1f3309(0x128)]['info'](_0x1f3309(0x158)+(_0x53ebc6*0x64)[_0x1f3309(0x155)](0x0)+_0x1f3309(0x143)+currentMonitoredRoom+_0x1f3309(0x13c)),_0x4ea4bd[_0x1f3309(0x157)](_0x1f3309(0x121),{'val':!![],'ack':!![]})):_0x4ea4bd[_0x1f3309(0x157)]('analysis.safety.deadMan.smartSleep',{'val':![],'ack':!![]}),_0x4ea4bd['setStateAsync'](_0x1f3309(0x12b),{'val':_0x53ebc6,'ack':!![]}),_0x4ea4bd['log']['info'](_0x1f3309(0x12a)+currentMonitoredRoom+_0x1f3309(0x13d)+_0x550e62+_0x1f3309(0x14e)),_0x4ea4bd[_0x1f3309(0x157)]('analysis.safety.deadMan.alarmState',{'val':'ok','ack':!![]}),activeTimer=setTimeout(()=>triggerPreWarn(_0x4ea4bd),timeoutMs);}function resetTimer(_0x5c4bac){const _0x2f604a=a2_0x3eb2db;if(activeTimer)clearTimeout(activeTimer);activeTimer=null,currentMonitoredRoom=null,alarmStage=0x0,_0x5c4bac[_0x2f604a(0x157)](_0x2f604a(0x122),{'val':'ok','ack':!![]}),_0x5c4bac[_0x2f604a(0x157)](_0x2f604a(0x121),{'val':![],'ack':!![]}),_0x5c4bac['setStateAsync'](_0x2f604a(0x12b),{'val':0x0,'ack':!![]});}async function triggerPreWarn(_0x46f5f9){const _0x221c8a=a2_0x3eb2db;alarmStage=0x1,await _0x46f5f9[_0x221c8a(0x157)](_0x221c8a(0x122),{'val':_0x221c8a(0x150),'ack':!![]});const _0x5b570a=_0x221c8a(0x132)+currentMonitoredRoom+_0x221c8a(0x141);_0x46f5f9[_0x221c8a(0x128)][_0x221c8a(0x134)](_0x221c8a(0x14c)+_0x5b570a),await setup[_0x221c8a(0x152)](_0x46f5f9,_0x221c8a(0x153)+_0x5b570a),activeTimer=setTimeout(()=>triggerAlarm(_0x46f5f9),0x5*0x3c*0x3e8);}async function triggerAlarm(_0x20371a){const _0x387816=a2_0x3eb2db;alarmStage=0x2,await _0x20371a[_0x387816(0x157)]('analysis.safety.deadMan.alarmState',{'val':_0x387816(0x123),'ack':!![]});const _0x58e2a5=_0x387816(0x124)+currentMonitoredRoom+'!';_0x20371a['log'][_0x387816(0x146)](_0x387816(0x14c)+_0x58e2a5),await setup[_0x387816(0x152)](_0x20371a,_0x58e2a5,![],!![]);}module[a2_0x3eb2db(0x137)]={'updateLocation':updateLocation};