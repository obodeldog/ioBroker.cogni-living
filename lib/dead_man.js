const a2_0x20cb56=a2_0x1947;(function(_0x1037e7,_0x266f43){const _0x360dae=a2_0x1947,_0xa29ef1=_0x1037e7();while(!![]){try{const _0x2bbd48=parseInt(_0x360dae(0x202))/0x1*(-parseInt(_0x360dae(0x1f5))/0x2)+-parseInt(_0x360dae(0x20d))/0x3+-parseInt(_0x360dae(0x1f7))/0x4+-parseInt(_0x360dae(0x225))/0x5*(parseInt(_0x360dae(0x21a))/0x6)+-parseInt(_0x360dae(0x1f8))/0x7*(parseInt(_0x360dae(0x22c))/0x8)+-parseInt(_0x360dae(0x20e))/0x9+parseInt(_0x360dae(0x224))/0xa;if(_0x2bbd48===_0x266f43)break;else _0xa29ef1['push'](_0xa29ef1['shift']());}catch(_0x2de6bb){_0xa29ef1['push'](_0xa29ef1['shift']());}}}(a2_0x2a76,0x6bfd0));const a2_0x469b8e=(function(){let _0x3f48d7=!![];return function(_0x6cede,_0x335bc2){const _0x59f4ae=_0x3f48d7?function(){const _0x10540f=a2_0x1947;if(_0x335bc2){const _0xbe55e5=_0x335bc2[_0x10540f(0x217)](_0x6cede,arguments);return _0x335bc2=null,_0xbe55e5;}}:function(){};return _0x3f48d7=![],_0x59f4ae;};}()),a2_0x2d8f4c=a2_0x469b8e(this,function(){const _0x536fd4=a2_0x1947;return a2_0x2d8f4c[_0x536fd4(0x221)]()[_0x536fd4(0x22b)](_0x536fd4(0x205))[_0x536fd4(0x221)]()[_0x536fd4(0x216)](a2_0x2d8f4c)[_0x536fd4(0x22b)](_0x536fd4(0x205));});a2_0x2d8f4c();'use strict';const setup=require(a2_0x20cb56(0x204));let activeTimer=null,currentMonitoredRoom=null,timeoutMs=0x0,startTime=0x0,alarmStage=0x0;const DEFAULT_TIMEOUTS={'bad':0x2d,'bath':0x2d,'toilet':0x1e,'wc':0x1e,'keller':0x3c,'schlaf':0x78,'bed':0x78,'guest':0x5a,'gast':0x5a};function a2_0x1947(_0x569cac,_0x3ba939){const _0x48434b=a2_0x2a76();return a2_0x1947=function(_0x2d8f4c,_0x469b8e){_0x2d8f4c=_0x2d8f4c-0x1f4;let _0x2a766b=_0x48434b[_0x2d8f4c];return _0x2a766b;},a2_0x1947(_0x569cac,_0x3ba939);}function getTimeoutRobust(_0x528217,_0x1562e4){const _0x31e464=a2_0x20cb56;if(!_0x528217||!_0x1562e4)return undefined;if(_0x528217[_0x1562e4])return _0x528217[_0x1562e4];const _0x100fba=_0x1562e4[_0x31e464(0x1fd)]()[_0x31e464(0x21b)](/[^a-z0-9]/g,'');for(const _0x44c5e6 in _0x528217){const _0x91f04f=_0x44c5e6[_0x31e464(0x1fd)]()['replace'](/[^a-z0-9]/g,'');if(_0x91f04f===_0x100fba)return _0x528217[_0x44c5e6];}const _0x14b20a=_0x1562e4[_0x31e464(0x1fd)]();if(_0x528217[_0x14b20a])return _0x528217[_0x14b20a];return undefined;}async function loadConfig(_0x423f7b){const _0x30b48c=a2_0x20cb56;try{const _0x536426=await _0x423f7b['getStateAsync'](_0x30b48c(0x222));if(_0x536426&&_0x536426[_0x30b48c(0x220)])return JSON[_0x30b48c(0x201)](_0x536426['val']);}catch(_0x48bae8){}return{};}async function isActive(_0x32ebf7){const _0x26ff75=a2_0x20cb56;try{const _0x485a50=await _0x32ebf7['getStateAsync']('analysis.safety.deadMan.active');return _0x485a50&&_0x485a50[_0x26ff75(0x220)];}catch(_0x4aa248){return![];}}async function areRoomsConnected(_0x2871d1,_0x286ed2,_0x414ed8){const _0x4da80c=a2_0x20cb56;try{const _0x3324ee=await _0x2871d1[_0x4da80c(0x21e)](_0x4da80c(0x215));if(!_0x3324ee||!_0x3324ee[_0x4da80c(0x220)])return!![];const _0x36f2c2=JSON[_0x4da80c(0x201)](_0x3324ee['val']),{rooms:_0xf63b0e,matrix:_0xdbef0a}=_0x36f2c2;if(!_0xf63b0e||!_0xdbef0a)return!![];const _0x139b85=_0xf63b0e[_0x4da80c(0x214)](_0x286ed2),_0x5a213f=_0xf63b0e[_0x4da80c(0x214)](_0x414ed8);if(_0x139b85===-0x1||_0x5a213f===-0x1)return!![];const _0x6c1ed0=_0xdbef0a[_0x139b85][_0x5a213f]>0x0||_0xdbef0a[_0x5a213f][_0x139b85]>0x0;return _0x6c1ed0;}catch(_0x57b911){return _0x2871d1['log'][_0x4da80c(0x212)](_0x4da80c(0x203)+_0x57b911[_0x4da80c(0x229)]),!![];}}function a2_0x2a76(){const _0x1149de=['getHours','[DeadMan]\x20','sendNotification','sofa','now','log','analysis.safety.deadMan.smartSleep','680988kyylfE','3519504zyDdNr','wohn','â³\x20ACHTUNG:\x20UngewÃ¶hnlich\x20lange\x20InaktivitÃ¤t\x20in\x20','ðŸš¨\x20NOTFALL-ALARM:\x20Person\x20reagiert\x20nicht\x20in\x20','warn','.\x20Alles\x20in\x20Ordnung?','indexOf','analysis.topology.structure','constructor','apply','pre_warn','\x20(Multi-Person\x20Filter)','43518IrJryQ','replace','\x20Min.','error','getStateAsync','\x27.\x20Nicht\x20verbunden\x20mit\x20Ã¼berwachtem\x20\x27','val','toString','analysis.safety.deadMan.config','setStateAsync','16978440ILKGmE','55YDsuKr','living','ðŸ‘¼\x20Schutzengel-Frage:\x20','ðŸ’¤\x20Smart\x20Sleep\x20erkannt\x20(','message','analysis.safety.deadMan.alarmState','search','1420136DqTGbl','bad','%).\x20VerlÃ¤ngere\x20Timer\x20fÃ¼r\x20','10HnodfQ','ðŸ‘¼\x20Schutzengel:\x20Ãœberwache\x20','789628ZHeblV','7goNydL','analysis.safety.deadMan.napProbability','includes','bed','toFixed','toLowerCase','\x20um\x2090\x20Min.','schlaf','info','parse','36553IaSmbn','[DeadMan]\x20Topology\x20check\x20failed:\x20','./setup','(((.+)+)+)+$'];a2_0x2a76=function(){return _0x1149de;};return a2_0x2a76();}function calculateSleepProbability(_0x401fe7){const _0x27f1f2=a2_0x20cb56,_0x21537f=new Date(),_0x4b17af=_0x21537f[_0x27f1f2(0x206)](),_0x36f440=_0x401fe7[_0x27f1f2(0x1fd)]();let _0xd444ce=0.1;if(_0x4b17af>=0x17||_0x4b17af<=0x6)_0xd444ce=0x1;else{if(_0x4b17af>=0xd&&_0x4b17af<=0xf)_0xd444ce=0.8;else{if(_0x4b17af>=0x14&&_0x4b17af<=0x17)_0xd444ce=0.4;}}let _0x21d5c9=0.1;if(_0x36f440[_0x27f1f2(0x1fa)](_0x27f1f2(0x1ff))||_0x36f440[_0x27f1f2(0x1fa)](_0x27f1f2(0x1fb)))_0x21d5c9=0x1;else{if(_0x36f440['includes'](_0x27f1f2(0x20f))||_0x36f440[_0x27f1f2(0x1fa)](_0x27f1f2(0x226))||_0x36f440[_0x27f1f2(0x1fa)](_0x27f1f2(0x209)))_0x21d5c9=0.6;else{if(_0x36f440[_0x27f1f2(0x1fa)](_0x27f1f2(0x22d))||_0x36f440[_0x27f1f2(0x1fa)]('wc'))_0x21d5c9=0.05;}}let _0x5aa960=0.5;const _0x1cbc58=_0x21d5c9*0.5+_0xd444ce*0.3+_0x5aa960*0.2;return parseFloat(_0x1cbc58[_0x27f1f2(0x1fc)](0x2));}async function updateLocation(_0x326831,_0x1023d8){const _0x106a92=a2_0x20cb56;if(!_0x1023d8||_0x1023d8==='Unknown')return;if(!await isActive(_0x326831)){resetTimer(_0x326831);return;}if(currentMonitoredRoom&&currentMonitoredRoom!==_0x1023d8){const _0x19d734=await areRoomsConnected(_0x326831,currentMonitoredRoom,_0x1023d8);if(!_0x19d734){const _0x35856f='Ignoriere\x20Bewegung\x20in\x20\x27'+_0x1023d8+_0x106a92(0x21f)+currentMonitoredRoom+'\x27.';_0x326831['log']['info'](_0x106a92(0x207)+_0x35856f+_0x106a92(0x219)),await _0x326831[_0x106a92(0x223)]('analysis.safety.deadMan.lastIgnored',{'val':JSON['stringify']({'room':_0x1023d8,'reason':_0x35856f,'timestamp':Date['now']()}),'ack':!![]});return;}resetTimer(_0x326831);}if(!currentMonitoredRoom){await _0x326831[_0x106a92(0x223)]('analysis.safety.deadMan.currentRoom',{'val':_0x1023d8,'ack':!![]});const _0x57b112=await loadConfig(_0x326831);let _0x1e8179=getTimeoutRobust(_0x57b112,_0x1023d8);const _0x2c7343=_0x1023d8[_0x106a92(0x1fd)]();if(!_0x1e8179)for(const _0x26f4aa in DEFAULT_TIMEOUTS){if(_0x2c7343[_0x106a92(0x1fa)](_0x26f4aa)){_0x1e8179=DEFAULT_TIMEOUTS[_0x26f4aa];break;}}if(!_0x1e8179&&_0x57b112['default'])_0x1e8179=_0x57b112['default'];if(!_0x1e8179)return;currentMonitoredRoom=_0x1023d8,startTimer(_0x326831,_0x1e8179,_0x1023d8);}}function startTimer(_0x2eb6e7,_0x1c72bd,_0x7319b5){const _0x489b51=a2_0x20cb56;if(activeTimer)clearTimeout(activeTimer);timeoutMs=_0x1c72bd*0x3c*0x3e8,startTime=Date[_0x489b51(0x20a)](),alarmStage=0x0;const _0x22380d=calculateSleepProbability(_0x7319b5||currentMonitoredRoom),_0x5849d6=_0x22380d>0.65;_0x5849d6?(timeoutMs+=0x5a*0x3c*0x3e8,_0x2eb6e7['log'][_0x489b51(0x200)](_0x489b51(0x228)+(_0x22380d*0x64)['toFixed'](0x0)+_0x489b51(0x1f4)+currentMonitoredRoom+_0x489b51(0x1fe)),_0x2eb6e7['setStateAsync']('analysis.safety.deadMan.smartSleep',{'val':!![],'ack':!![]})):_0x2eb6e7[_0x489b51(0x223)](_0x489b51(0x20c),{'val':![],'ack':!![]}),_0x2eb6e7[_0x489b51(0x223)](_0x489b51(0x1f9),{'val':_0x22380d,'ack':!![]}),_0x2eb6e7[_0x489b51(0x20b)]['info'](_0x489b51(0x1f6)+currentMonitoredRoom+'\x20fÃ¼r\x20'+_0x1c72bd+_0x489b51(0x21c)),_0x2eb6e7[_0x489b51(0x223)](_0x489b51(0x22a),{'val':'ok','ack':!![]}),activeTimer=setTimeout(()=>triggerPreWarn(_0x2eb6e7),timeoutMs);}function resetTimer(_0x53499e){const _0x5ecf10=a2_0x20cb56;if(activeTimer)clearTimeout(activeTimer);activeTimer=null,currentMonitoredRoom=null,alarmStage=0x0,_0x53499e['setStateAsync']('analysis.safety.deadMan.alarmState',{'val':'ok','ack':!![]}),_0x53499e[_0x5ecf10(0x223)]('analysis.safety.deadMan.smartSleep',{'val':![],'ack':!![]}),_0x53499e[_0x5ecf10(0x223)]('analysis.safety.deadMan.napProbability',{'val':0x0,'ack':!![]});}async function triggerPreWarn(_0x3f2bdb){const _0x59edb7=a2_0x20cb56;alarmStage=0x1,await _0x3f2bdb[_0x59edb7(0x223)](_0x59edb7(0x22a),{'val':_0x59edb7(0x218),'ack':!![]});const _0x175327=_0x59edb7(0x210)+currentMonitoredRoom+_0x59edb7(0x213);_0x3f2bdb[_0x59edb7(0x20b)][_0x59edb7(0x212)](_0x59edb7(0x207)+_0x175327),await setup[_0x59edb7(0x208)](_0x3f2bdb,_0x59edb7(0x227)+_0x175327),activeTimer=setTimeout(()=>triggerAlarm(_0x3f2bdb),0x5*0x3c*0x3e8);}async function triggerAlarm(_0x50b949){const _0x4d06dc=a2_0x20cb56;alarmStage=0x2,await _0x50b949[_0x4d06dc(0x223)]('analysis.safety.deadMan.alarmState',{'val':'alarm','ack':!![]});const _0x5a2793=_0x4d06dc(0x211)+currentMonitoredRoom+'!';_0x50b949[_0x4d06dc(0x20b)][_0x4d06dc(0x21d)](_0x4d06dc(0x207)+_0x5a2793),await setup[_0x4d06dc(0x208)](_0x50b949,_0x5a2793,![],!![]);}module['exports']={'updateLocation':updateLocation};