const a2_0x56a537=a2_0x4f69;(function(_0x3713e9,_0x21f18a){const _0x14c128=a2_0x4f69,_0x4725b0=_0x3713e9();while(!![]){try{const _0x5a44bc=parseInt(_0x14c128(0x1c9))/0x1*(parseInt(_0x14c128(0x1bc))/0x2)+-parseInt(_0x14c128(0x1e1))/0x3+-parseInt(_0x14c128(0x1d7))/0x4+parseInt(_0x14c128(0x1ca))/0x5+parseInt(_0x14c128(0x1c6))/0x6+parseInt(_0x14c128(0x1c4))/0x7*(parseInt(_0x14c128(0x1d3))/0x8)+parseInt(_0x14c128(0x1e4))/0x9;if(_0x5a44bc===_0x21f18a)break;else _0x4725b0['push'](_0x4725b0['shift']());}catch(_0x3f514e){_0x4725b0['push'](_0x4725b0['shift']());}}}(a2_0x8f29,0xce5b0));const a2_0x5a16d2=(function(){let _0x467195=!![];return function(_0x216d29,_0x4997f7){const _0x529f67=_0x467195?function(){if(_0x4997f7){const _0x22cfd1=_0x4997f7['apply'](_0x216d29,arguments);return _0x4997f7=null,_0x22cfd1;}}:function(){};return _0x467195=![],_0x529f67;};}()),a2_0x2e40e9=a2_0x5a16d2(this,function(){const _0x549571=a2_0x4f69;return a2_0x2e40e9['toString']()[_0x549571(0x1b6)](_0x549571(0x1b9))[_0x549571(0x1e6)]()[_0x549571(0x1bf)](a2_0x2e40e9)[_0x549571(0x1b6)](_0x549571(0x1b9));});a2_0x2e40e9();'use strict';const setup=require(a2_0x56a537(0x1d0));let activeTimer=null,currentMonitoredRoom=null,timeoutMs=0x0,startTime=0x0,alarmStage=0x0;const DEFAULT_TIMEOUTS={'bad':0x2d,'bath':0x2d,'toilet':0x1e,'wc':0x1e,'keller':0x3c,'schlaf':0x78,'bed':0x78,'guest':0x5a,'gast':0x5a};function getTimeoutRobust(_0x3cc011,_0x28f44b){const _0x3e701d=a2_0x56a537;if(!_0x3cc011||!_0x28f44b)return undefined;if(_0x3cc011[_0x28f44b])return _0x3cc011[_0x28f44b];const _0x16e42e=_0x28f44b[_0x3e701d(0x1c3)]()[_0x3e701d(0x1e8)](/[^a-z0-9]/g,'');for(const _0x5c0b1d in _0x3cc011){const _0xd93b3e=_0x5c0b1d[_0x3e701d(0x1c3)]()['replace'](/[^a-z0-9]/g,'');if(_0xd93b3e===_0x16e42e)return _0x3cc011[_0x5c0b1d];}const _0x1656a9=_0x28f44b[_0x3e701d(0x1c3)]();if(_0x3cc011[_0x1656a9])return _0x3cc011[_0x1656a9];return undefined;}async function loadConfig(_0x5ab060){const _0x10d1d0=a2_0x56a537;try{const _0x41c814=await _0x5ab060[_0x10d1d0(0x1d2)](_0x10d1d0(0x1dc));if(_0x41c814&&_0x41c814[_0x10d1d0(0x1db)])return JSON[_0x10d1d0(0x1cc)](_0x41c814[_0x10d1d0(0x1db)]);}catch(_0x33a9b0){}return{};}function a2_0x8f29(){const _0x14d394=['analysis.safety.deadMan.lastIgnored','824868VOdCWn','ðŸ’¤\x20Smart\x20Sleep\x20erkannt\x20(','toString','warn','replace','log','wohn','\x20fÃ¼r\x20','schlaf','search','living','Ignoriere\x20Bewegung\x20in\x20\x27','(((.+)+)+)+$','setStateAsync','analysis.safety.deadMan.currentRoom','505550qywIrN','ðŸ‘¼\x20Schutzengel:\x20Ãœberwache\x20','message','constructor','alarm','analysis.safety.deadMan.alarmState','now','toLowerCase','7eGYXEn','pre_warn','255492Tdqtpd','.\x20Alles\x20in\x20Ordnung?','[DeadMan]\x20','1eWfwBv','5387975AfiddI','bed','parse','getHours','ðŸ‘¼\x20Schutzengel-Frage:\x20','analysis.safety.deadMan.smartSleep','./setup','\x20Min.','getStateAsync','6800888zNJwmW','ðŸš¨\x20NOTFALL-ALARM:\x20Person\x20reagiert\x20nicht\x20in\x20','info','sofa','1563096yEJmME','analysis.safety.deadMan.napProbability','default','stringify','val','analysis.safety.deadMan.config','indexOf','toFixed','Unknown','includes','3236127lEQoxH','bad'];a2_0x8f29=function(){return _0x14d394;};return a2_0x8f29();}async function isActive(_0x4f856b){const _0x375703=a2_0x56a537;try{const _0x401ebd=await _0x4f856b[_0x375703(0x1d2)]('analysis.safety.deadMan.active');return _0x401ebd&&_0x401ebd[_0x375703(0x1db)];}catch(_0x2d1176){return![];}}async function areRoomsConnected(_0x10ff4e,_0x282d10,_0x356cbb){const _0xcdf912=a2_0x56a537;try{const _0x2ed32a=await _0x10ff4e[_0xcdf912(0x1d2)]('analysis.topology.structure');if(!_0x2ed32a||!_0x2ed32a[_0xcdf912(0x1db)])return!![];const _0x36e023=JSON[_0xcdf912(0x1cc)](_0x2ed32a[_0xcdf912(0x1db)]),{rooms:_0x24a73f,matrix:_0x23c2af}=_0x36e023;if(!_0x24a73f||!_0x23c2af)return!![];const _0x56d1b8=_0x24a73f['indexOf'](_0x282d10),_0x4c37a5=_0x24a73f[_0xcdf912(0x1dd)](_0x356cbb);if(_0x56d1b8===-0x1||_0x4c37a5===-0x1)return!![];const _0x363386=_0x23c2af[_0x56d1b8][_0x4c37a5]>0x0||_0x23c2af[_0x4c37a5][_0x56d1b8]>0x0;return _0x363386;}catch(_0x246ef6){return _0x10ff4e[_0xcdf912(0x1e9)][_0xcdf912(0x1e7)]('[DeadMan]\x20Topology\x20check\x20failed:\x20'+_0x246ef6[_0xcdf912(0x1be)]),!![];}}function calculateSleepProbability(_0x3a0c57){const _0x251b3c=a2_0x56a537,_0x4bc6d2=new Date(),_0x6553b5=_0x4bc6d2[_0x251b3c(0x1cd)](),_0x33ab77=_0x3a0c57['toLowerCase']();let _0x215079=0.1;if(_0x6553b5>=0x17||_0x6553b5<=0x6)_0x215079=0x1;else{if(_0x6553b5>=0xd&&_0x6553b5<=0xf)_0x215079=0.8;else{if(_0x6553b5>=0x14&&_0x6553b5<=0x17)_0x215079=0.4;}}let _0x1ffb5f=0.1;if(_0x33ab77[_0x251b3c(0x1e0)](_0x251b3c(0x1b5))||_0x33ab77[_0x251b3c(0x1e0)](_0x251b3c(0x1cb)))_0x1ffb5f=0x1;else{if(_0x33ab77[_0x251b3c(0x1e0)](_0x251b3c(0x1ea))||_0x33ab77[_0x251b3c(0x1e0)](_0x251b3c(0x1b7))||_0x33ab77[_0x251b3c(0x1e0)](_0x251b3c(0x1d6)))_0x1ffb5f=0.6;else{if(_0x33ab77[_0x251b3c(0x1e0)](_0x251b3c(0x1e2))||_0x33ab77[_0x251b3c(0x1e0)]('wc'))_0x1ffb5f=0.05;}}let _0x303fef=0.5;const _0x519918=_0x1ffb5f*0.5+_0x215079*0.3+_0x303fef*0.2;return parseFloat(_0x519918[_0x251b3c(0x1de)](0x2));}async function updateLocation(_0x386187,_0x44f09b){const _0x58a014=a2_0x56a537;if(!_0x44f09b||_0x44f09b===_0x58a014(0x1df))return;if(!await isActive(_0x386187)){resetTimer(_0x386187);return;}if(currentMonitoredRoom&&currentMonitoredRoom!==_0x44f09b){const _0x40b805=await areRoomsConnected(_0x386187,currentMonitoredRoom,_0x44f09b);if(!_0x40b805){const _0x38c21a=_0x58a014(0x1b8)+_0x44f09b+'\x27.\x20Nicht\x20verbunden\x20mit\x20Ã¼berwachtem\x20\x27'+currentMonitoredRoom+'\x27.';_0x386187[_0x58a014(0x1e9)][_0x58a014(0x1d5)](_0x58a014(0x1c8)+_0x38c21a+'\x20(Multi-Person\x20Filter)'),await _0x386187['setStateAsync'](_0x58a014(0x1e3),{'val':JSON[_0x58a014(0x1da)]({'room':_0x44f09b,'reason':_0x38c21a,'timestamp':Date[_0x58a014(0x1c2)]()}),'ack':!![]});return;}resetTimer(_0x386187);}if(!currentMonitoredRoom){await _0x386187[_0x58a014(0x1ba)](_0x58a014(0x1bb),{'val':_0x44f09b,'ack':!![]});const _0x26a49d=await loadConfig(_0x386187);let _0x92e3a2=getTimeoutRobust(_0x26a49d,_0x44f09b);const _0x2b7c8c=_0x44f09b[_0x58a014(0x1c3)]();if(!_0x92e3a2)for(const _0x1721bb in DEFAULT_TIMEOUTS){if(_0x2b7c8c[_0x58a014(0x1e0)](_0x1721bb)){_0x92e3a2=DEFAULT_TIMEOUTS[_0x1721bb];break;}}if(!_0x92e3a2&&_0x26a49d[_0x58a014(0x1d9)])_0x92e3a2=_0x26a49d['default'];if(!_0x92e3a2)return;currentMonitoredRoom=_0x44f09b,startTimer(_0x386187,_0x92e3a2,_0x44f09b);}}function startTimer(_0x5f4187,_0x121d18,_0xfece7f){const _0x1263df=a2_0x56a537;if(activeTimer)clearTimeout(activeTimer);timeoutMs=_0x121d18*0x3c*0x3e8,startTime=Date[_0x1263df(0x1c2)](),alarmStage=0x0;const _0x587a2e=calculateSleepProbability(_0xfece7f||currentMonitoredRoom),_0x65b2d8=_0x587a2e>0.65;_0x65b2d8?(timeoutMs+=0x5a*0x3c*0x3e8,_0x5f4187[_0x1263df(0x1e9)][_0x1263df(0x1d5)](_0x1263df(0x1e5)+(_0x587a2e*0x64)[_0x1263df(0x1de)](0x0)+'%).\x20VerlÃ¤ngere\x20Timer\x20fÃ¼r\x20'+currentMonitoredRoom+'\x20um\x2090\x20Min.'),_0x5f4187[_0x1263df(0x1ba)](_0x1263df(0x1cf),{'val':!![],'ack':!![]})):_0x5f4187[_0x1263df(0x1ba)](_0x1263df(0x1cf),{'val':![],'ack':!![]}),_0x5f4187[_0x1263df(0x1ba)](_0x1263df(0x1d8),{'val':_0x587a2e,'ack':!![]}),_0x5f4187[_0x1263df(0x1e9)]['info'](_0x1263df(0x1bd)+currentMonitoredRoom+_0x1263df(0x1eb)+_0x121d18+_0x1263df(0x1d1)),_0x5f4187[_0x1263df(0x1ba)](_0x1263df(0x1c1),{'val':'ok','ack':!![]}),activeTimer=setTimeout(()=>triggerPreWarn(_0x5f4187),timeoutMs);}function resetTimer(_0x4b34fb){const _0x4660ce=a2_0x56a537;if(activeTimer)clearTimeout(activeTimer);activeTimer=null,currentMonitoredRoom=null,alarmStage=0x0,_0x4b34fb[_0x4660ce(0x1ba)]('analysis.safety.deadMan.alarmState',{'val':'ok','ack':!![]}),_0x4b34fb[_0x4660ce(0x1ba)](_0x4660ce(0x1cf),{'val':![],'ack':!![]}),_0x4b34fb['setStateAsync'](_0x4660ce(0x1d8),{'val':0x0,'ack':!![]});}async function triggerPreWarn(_0x166f0c){const _0x1dc75e=a2_0x56a537;alarmStage=0x1,await _0x166f0c['setStateAsync'](_0x1dc75e(0x1c1),{'val':_0x1dc75e(0x1c5),'ack':!![]});const _0x2a2cb6='â³\x20ACHTUNG:\x20UngewÃ¶hnlich\x20lange\x20InaktivitÃ¤t\x20in\x20'+currentMonitoredRoom+_0x1dc75e(0x1c7);_0x166f0c['log'][_0x1dc75e(0x1e7)]('[DeadMan]\x20'+_0x2a2cb6),await setup['sendNotification'](_0x166f0c,_0x1dc75e(0x1ce)+_0x2a2cb6),activeTimer=setTimeout(()=>triggerAlarm(_0x166f0c),0x5*0x3c*0x3e8);}async function triggerAlarm(_0x43a2a9){const _0x1a4559=a2_0x56a537;alarmStage=0x2,await _0x43a2a9[_0x1a4559(0x1ba)](_0x1a4559(0x1c1),{'val':_0x1a4559(0x1c0),'ack':!![]});const _0x25fdbf=_0x1a4559(0x1d4)+currentMonitoredRoom+'!';_0x43a2a9[_0x1a4559(0x1e9)]['error'](_0x1a4559(0x1c8)+_0x25fdbf),await setup['sendNotification'](_0x43a2a9,_0x25fdbf,![],!![]);}function a2_0x4f69(_0x114024,_0x167fd1){const _0x12be2a=a2_0x8f29();return a2_0x4f69=function(_0x2e40e9,_0x5a16d2){_0x2e40e9=_0x2e40e9-0x1b5;let _0x8f296c=_0x12be2a[_0x2e40e9];return _0x8f296c;},a2_0x4f69(_0x114024,_0x167fd1);}module['exports']={'updateLocation':updateLocation};