const a2_0x1a25c2=a2_0x5aae;(function(_0x59a272,_0x520b36){const _0x378aee=a2_0x5aae,_0x33f2fb=_0x59a272();while(!![]){try{const _0x2f1ea1=parseInt(_0x378aee(0x1b1))/0x1*(-parseInt(_0x378aee(0x1a5))/0x2)+-parseInt(_0x378aee(0x1af))/0x3*(-parseInt(_0x378aee(0x1bf))/0x4)+parseInt(_0x378aee(0x1d4))/0x5+parseInt(_0x378aee(0x1ad))/0x6*(-parseInt(_0x378aee(0x1d3))/0x7)+parseInt(_0x378aee(0x1c8))/0x8*(-parseInt(_0x378aee(0x1a8))/0x9)+parseInt(_0x378aee(0x19a))/0xa+parseInt(_0x378aee(0x1a3))/0xb;if(_0x2f1ea1===_0x520b36)break;else _0x33f2fb['push'](_0x33f2fb['shift']());}catch(_0x1ce6bc){_0x33f2fb['push'](_0x33f2fb['shift']());}}}(a2_0x4ba4,0xe8fe9));const a2_0x206f5b=(function(){let _0x159039=!![];return function(_0x4d4fe1,_0xdfa918){const _0x2e2302=_0x159039?function(){const _0x1a4271=a2_0x5aae;if(_0xdfa918){const _0x552073=_0xdfa918[_0x1a4271(0x1c3)](_0x4d4fe1,arguments);return _0xdfa918=null,_0x552073;}}:function(){};return _0x159039=![],_0x2e2302;};}()),a2_0x32f78f=a2_0x206f5b(this,function(){const _0x273b59=a2_0x5aae;return a2_0x32f78f[_0x273b59(0x19c)]()[_0x273b59(0x1a1)](_0x273b59(0x1b4))[_0x273b59(0x19c)]()[_0x273b59(0x1d6)](a2_0x32f78f)[_0x273b59(0x1a1)](_0x273b59(0x1b4));});function a2_0x5aae(_0x435740,_0x2056b3){const _0xc67312=a2_0x4ba4();return a2_0x5aae=function(_0x32f78f,_0x206f5b){_0x32f78f=_0x32f78f-0x19a;let _0x4ba429=_0xc67312[_0x32f78f];return _0x4ba429;},a2_0x5aae(_0x435740,_0x2056b3);}a2_0x32f78f();'use strict';const setup=require(a2_0x1a25c2(0x1a2));let activeTimer=null,currentMonitoredRoom=null,timeoutMs=0x0,startTime=0x0,alarmStage=0x0;const DEFAULT_TIMEOUTS={'bad':0x2d,'bath':0x2d,'toilet':0x1e,'wc':0x1e,'keller':0x3c,'schlaf':0x78,'bed':0x78,'guest':0x5a,'gast':0x5a};function getTimeoutRobust(_0x5613ac,_0x2f0a47){const _0x540649=a2_0x1a25c2;if(!_0x5613ac||!_0x2f0a47)return undefined;if(_0x5613ac[_0x2f0a47])return _0x5613ac[_0x2f0a47];const _0x37e020=_0x2f0a47['toLowerCase']()[_0x540649(0x1a6)](/[^a-z0-9]/g,'');for(const _0x5183cf in _0x5613ac){const _0x192405=_0x5183cf['toLowerCase']()[_0x540649(0x1a6)](/[^a-z0-9]/g,'');if(_0x192405===_0x37e020)return _0x5613ac[_0x5183cf];}const _0x2e9272=_0x2f0a47[_0x540649(0x1ae)]();if(_0x5613ac[_0x2e9272])return _0x5613ac[_0x2e9272];return undefined;}async function loadConfig(_0x285cd4){const _0x334d56=a2_0x1a25c2;try{const _0x243fe4=await _0x285cd4[_0x334d56(0x1d0)](_0x334d56(0x1c6));if(_0x243fe4&&_0x243fe4[_0x334d56(0x1b5)])return JSON['parse'](_0x243fe4[_0x334d56(0x1b5)]);}catch(_0x4733be){}return{};}async function isActive(_0x1e7ad3){const _0x1145fd=a2_0x1a25c2;try{const _0x1bf6bd=await _0x1e7ad3[_0x1145fd(0x1d0)](_0x1145fd(0x1aa));return _0x1bf6bd&&_0x1bf6bd['val'];}catch(_0x100fcb){return![];}}async function areRoomsConnected(_0x309366,_0xdaf098,_0x2f2639){const _0x5a399c=a2_0x1a25c2;try{const _0x4123df=await _0x309366['getStateAsync'](_0x5a399c(0x1c0));if(!_0x4123df||!_0x4123df[_0x5a399c(0x1b5)])return!![];const _0x162687=JSON[_0x5a399c(0x1b7)](_0x4123df[_0x5a399c(0x1b5)]),{rooms:_0x149dcc,matrix:_0x334888}=_0x162687;if(!_0x149dcc||!_0x334888)return!![];const _0x4efc92=_0x149dcc[_0x5a399c(0x1c5)](_0xdaf098),_0x3d511e=_0x149dcc['indexOf'](_0x2f2639);if(_0x4efc92===-0x1||_0x3d511e===-0x1)return!![];const _0x582f0c=_0x334888[_0x4efc92][_0x3d511e]>0x0||_0x334888[_0x3d511e][_0x4efc92]>0x0;return _0x582f0c;}catch(_0x361602){return _0x309366[_0x5a399c(0x1ac)][_0x5a399c(0x1ca)](_0x5a399c(0x1a9)+_0x361602[_0x5a399c(0x1cf)]),!![];}}function calculateSleepProbability(_0x41c1f2){const _0xbb36cf=a2_0x1a25c2,_0x2ff513=new Date(),_0x204d90=_0x2ff513[_0xbb36cf(0x1bd)](),_0x4c91b3=_0x41c1f2[_0xbb36cf(0x1ae)]();let _0xa73976=0.1;if(_0x204d90>=0x17||_0x204d90<=0x6)_0xa73976=0x1;else{if(_0x204d90>=0xd&&_0x204d90<=0xf)_0xa73976=0.8;else{if(_0x204d90>=0x14&&_0x204d90<=0x17)_0xa73976=0.4;}}let _0x1b0d57=0.1;if(_0x4c91b3[_0xbb36cf(0x19e)](_0xbb36cf(0x1d1))||_0x4c91b3[_0xbb36cf(0x19e)](_0xbb36cf(0x1b8)))_0x1b0d57=0x1;else{if(_0x4c91b3['includes'](_0xbb36cf(0x19f))||_0x4c91b3[_0xbb36cf(0x19e)](_0xbb36cf(0x1b9))||_0x4c91b3[_0xbb36cf(0x19e)](_0xbb36cf(0x1cd)))_0x1b0d57=0.6;else{if(_0x4c91b3[_0xbb36cf(0x19e)]('bad')||_0x4c91b3[_0xbb36cf(0x19e)]('wc'))_0x1b0d57=0.05;}}let _0x5e7c85=0.5;const _0x323f3c=_0x1b0d57*0.5+_0xa73976*0.3+_0x5e7c85*0.2;return parseFloat(_0x323f3c['toFixed'](0x2));}async function updateLocation(_0x20ad48,_0x2b7b07){const _0x26d531=a2_0x1a25c2;if(!_0x2b7b07||_0x2b7b07===_0x26d531(0x1c1))return;if(!await isActive(_0x20ad48)){resetTimer(_0x20ad48);return;}if(currentMonitoredRoom&&currentMonitoredRoom!==_0x2b7b07){const _0x526de9=await areRoomsConnected(_0x20ad48,currentMonitoredRoom,_0x2b7b07);if(!_0x526de9){const _0x39415a=_0x26d531(0x1b3)+_0x2b7b07+'\x27.\x20Nicht\x20verbunden\x20mit\x20Ã¼berwachtem\x20\x27'+currentMonitoredRoom+'\x27.';_0x20ad48[_0x26d531(0x1ac)][_0x26d531(0x19b)](_0x26d531(0x1bb)+_0x39415a+_0x26d531(0x1c7)),await _0x20ad48[_0x26d531(0x1b0)](_0x26d531(0x1a4),{'val':JSON[_0x26d531(0x1b6)]({'room':_0x2b7b07,'reason':_0x39415a,'timestamp':Date['now']()}),'ack':!![]});return;}resetTimer(_0x20ad48);}if(!currentMonitoredRoom){await _0x20ad48[_0x26d531(0x1b0)]('analysis.safety.deadMan.currentRoom',{'val':_0x2b7b07,'ack':!![]});const _0x23e468=await loadConfig(_0x20ad48);let _0x271c46=getTimeoutRobust(_0x23e468,_0x2b7b07);const _0x258834=_0x2b7b07[_0x26d531(0x1ae)]();if(!_0x271c46)for(const _0x441111 in DEFAULT_TIMEOUTS){if(_0x258834['includes'](_0x441111)){_0x271c46=DEFAULT_TIMEOUTS[_0x441111];break;}}if(!_0x271c46&&_0x23e468[_0x26d531(0x19d)])_0x271c46=_0x23e468['default'];if(!_0x271c46)return;currentMonitoredRoom=_0x2b7b07,startTimer(_0x20ad48,_0x271c46,_0x2b7b07);}}function startTimer(_0x56743d,_0x2a5943,_0x3b21b4){const _0x327b79=a2_0x1a25c2;if(activeTimer)clearTimeout(activeTimer);timeoutMs=_0x2a5943*0x3c*0x3e8,startTime=Date['now'](),alarmStage=0x0;const _0x3148ee=calculateSleepProbability(_0x3b21b4||currentMonitoredRoom),_0x1df66f=_0x3148ee>0.65;_0x1df66f?(timeoutMs+=0x5a*0x3c*0x3e8,_0x56743d[_0x327b79(0x1ac)]['info'](_0x327b79(0x1d5)+(_0x3148ee*0x64)['toFixed'](0x0)+_0x327b79(0x1c4)+currentMonitoredRoom+'\x20um\x2090\x20Min.'),_0x56743d[_0x327b79(0x1b0)](_0x327b79(0x1be),{'val':!![],'ack':!![]})):_0x56743d[_0x327b79(0x1b0)](_0x327b79(0x1be),{'val':![],'ack':!![]}),_0x56743d[_0x327b79(0x1b0)](_0x327b79(0x1bc),{'val':_0x3148ee,'ack':!![]}),_0x56743d[_0x327b79(0x1ac)][_0x327b79(0x19b)](_0x327b79(0x1cb)+currentMonitoredRoom+_0x327b79(0x1ce)+_0x2a5943+'\x20Min.'),_0x56743d[_0x327b79(0x1b0)](_0x327b79(0x1d2),{'val':'ok','ack':!![]}),activeTimer=setTimeout(()=>triggerPreWarn(_0x56743d),timeoutMs);}function resetTimer(_0x2d979c){const _0x1dcb1c=a2_0x1a25c2;if(activeTimer)clearTimeout(activeTimer);activeTimer=null,currentMonitoredRoom=null,alarmStage=0x0,_0x2d979c[_0x1dcb1c(0x1b0)](_0x1dcb1c(0x1d2),{'val':'ok','ack':!![]}),_0x2d979c[_0x1dcb1c(0x1b0)]('analysis.safety.deadMan.smartSleep',{'val':![],'ack':!![]}),_0x2d979c[_0x1dcb1c(0x1b0)](_0x1dcb1c(0x1bc),{'val':0x0,'ack':!![]});}function a2_0x4ba4(){const _0x2ac41=['replace','sendNotification','9tfsRTb','[DeadMan]\x20Topology\x20check\x20failed:\x20','analysis.safety.deadMan.active','.\x20Alles\x20in\x20Ordnung?','log','126PngBqO','toLowerCase','66QBPYHJ','setStateAsync','670399bwiOgl','alarm','Ignoriere\x20Bewegung\x20in\x20\x27','(((.+)+)+)+$','val','stringify','parse','bed','living','error','[DeadMan]\x20','analysis.safety.deadMan.napProbability','getHours','analysis.safety.deadMan.smartSleep','121020aOFmAi','analysis.topology.structure','Unknown','ðŸ‘¼\x20Schutzengel-Frage:\x20','apply','%).\x20VerlÃ¤ngere\x20Timer\x20fÃ¼r\x20','indexOf','analysis.safety.deadMan.config','\x20(Multi-Person\x20Filter)','4971592WGfrWW','ðŸš¨\x20NOTFALL-ALARM:\x20Person\x20reagiert\x20nicht\x20in\x20','warn','ðŸ‘¼\x20Schutzengel:\x20Ãœberwache\x20','pre_warn','sofa','\x20fÃ¼r\x20','message','getStateAsync','schlaf','analysis.safety.deadMan.alarmState','43631kDqeIX','8939230gcPevS','ðŸ’¤\x20Smart\x20Sleep\x20erkannt\x20(','constructor','277670WPzhOc','info','toString','default','includes','wohn','â³\x20ACHTUNG:\x20UngewÃ¶hnlich\x20lange\x20InaktivitÃ¤t\x20in\x20','search','./setup','6228882EVqKdZ','analysis.safety.deadMan.lastIgnored','4rOOeTj'];a2_0x4ba4=function(){return _0x2ac41;};return a2_0x4ba4();}async function triggerPreWarn(_0xc8813b){const _0x59263f=a2_0x1a25c2;alarmStage=0x1,await _0xc8813b[_0x59263f(0x1b0)](_0x59263f(0x1d2),{'val':_0x59263f(0x1cc),'ack':!![]});const _0x3f1fd3=_0x59263f(0x1a0)+currentMonitoredRoom+_0x59263f(0x1ab);_0xc8813b['log'][_0x59263f(0x1ca)]('[DeadMan]\x20'+_0x3f1fd3),await setup[_0x59263f(0x1a7)](_0xc8813b,_0x59263f(0x1c2)+_0x3f1fd3),activeTimer=setTimeout(()=>triggerAlarm(_0xc8813b),0x5*0x3c*0x3e8);}async function triggerAlarm(_0x3ad8a8){const _0x1584ee=a2_0x1a25c2;alarmStage=0x2,await _0x3ad8a8[_0x1584ee(0x1b0)](_0x1584ee(0x1d2),{'val':_0x1584ee(0x1b2),'ack':!![]});const _0x2d2d78=_0x1584ee(0x1c9)+currentMonitoredRoom+'!';_0x3ad8a8[_0x1584ee(0x1ac)][_0x1584ee(0x1ba)]('[DeadMan]\x20'+_0x2d2d78),await setup[_0x1584ee(0x1a7)](_0x3ad8a8,_0x2d2d78,![],!![]);}module['exports']={'updateLocation':updateLocation};