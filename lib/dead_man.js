const a2_0x3eeea4=a2_0x5e5e;(function(_0x3cc511,_0x2308ba){const _0x5039ef=a2_0x5e5e,_0x5e2eb8=_0x3cc511();while(!![]){try{const _0x3c79e5=parseInt(_0x5039ef(0xfc))/0x1*(parseInt(_0x5039ef(0xe5))/0x2)+parseInt(_0x5039ef(0xf2))/0x3*(parseInt(_0x5039ef(0xea))/0x4)+parseInt(_0x5039ef(0xec))/0x5*(parseInt(_0x5039ef(0xf5))/0x6)+parseInt(_0x5039ef(0xe6))/0x7+-parseInt(_0x5039ef(0xeb))/0x8*(-parseInt(_0x5039ef(0xf6))/0x9)+parseInt(_0x5039ef(0xdd))/0xa*(parseInt(_0x5039ef(0xce))/0xb)+-parseInt(_0x5039ef(0xf9))/0xc;if(_0x3c79e5===_0x2308ba)break;else _0x5e2eb8['push'](_0x5e2eb8['shift']());}catch(_0x2cf46e){_0x5e2eb8['push'](_0x5e2eb8['shift']());}}}(a2_0x143b,0x23e27));const a2_0x43158a=(function(){let _0x4ad6c6=!![];return function(_0x4f6b11,_0x42071e){const _0x141c79=_0x4ad6c6?function(){const _0xdbe815=a2_0x5e5e;if(_0x42071e){const _0xe81032=_0x42071e[_0xdbe815(0xe0)](_0x4f6b11,arguments);return _0x42071e=null,_0xe81032;}}:function(){};return _0x4ad6c6=![],_0x141c79;};}()),a2_0x503f3c=a2_0x43158a(this,function(){const _0x4ce874=a2_0x5e5e;return a2_0x503f3c[_0x4ce874(0xf0)]()['search'](_0x4ce874(0xd5))[_0x4ce874(0xf0)]()['constructor'](a2_0x503f3c)[_0x4ce874(0xe7)](_0x4ce874(0xd5));});a2_0x503f3c();'use strict';const setup=require(a2_0x3eeea4(0xd6));function a2_0x5e5e(_0x156ed0,_0x42c112){const _0x3f6350=a2_0x143b();return a2_0x5e5e=function(_0x503f3c,_0x43158a){_0x503f3c=_0x503f3c-0xce;let _0x143b79=_0x3f6350[_0x503f3c];return _0x143b79;},a2_0x5e5e(_0x156ed0,_0x42c112);}let activeTimer=null,currentMonitoredRoom=null,timeoutMs=0x0,startTime=0x0,alarmStage=0x0;const DEFAULT_TIMEOUTS={'bad':0x2d,'bath':0x2d,'toilet':0x1e,'wc':0x1e,'keller':0x3c};async function loadConfig(_0x595d77){try{const _0x33845f=await _0x595d77['getStateAsync']('analysis.safety.deadMan.config');if(_0x33845f&&_0x33845f['val'])return JSON['parse'](_0x33845f['val']);}catch(_0x16c5e6){}return{};}async function isActive(_0x10fdea){const _0x32fb02=a2_0x3eeea4;try{const _0x4fc8fb=await _0x10fdea[_0x32fb02(0xe8)]('analysis.safety.deadMan.active');return _0x4fc8fb&&_0x4fc8fb[_0x32fb02(0xef)];}catch(_0x138aec){return![];}}async function areRoomsConnected(_0x28cd41,_0x6f514b,_0x25b6bd){const _0x47a1d9=a2_0x3eeea4;try{const _0x4634e1=await _0x28cd41[_0x47a1d9(0xe8)]('analysis.topology.structure');if(!_0x4634e1||!_0x4634e1[_0x47a1d9(0xef)])return!![];const _0x249b83=JSON[_0x47a1d9(0xee)](_0x4634e1[_0x47a1d9(0xef)]),{rooms:_0x4722d4,matrix:_0x19b615}=_0x249b83;if(!_0x4722d4||!_0x19b615)return!![];const _0x27bf58=_0x4722d4[_0x47a1d9(0xf8)](_0x6f514b),_0xaf7e09=_0x4722d4[_0x47a1d9(0xf8)](_0x25b6bd);if(_0x27bf58===-0x1||_0xaf7e09===-0x1)return!![];const _0x453e71=_0x19b615[_0x27bf58][_0xaf7e09]>0x0||_0x19b615[_0xaf7e09][_0x27bf58]>0x0;return _0x453e71;}catch(_0x4170d6){return _0x28cd41['log']['warn'](_0x47a1d9(0xf7)+_0x4170d6[_0x47a1d9(0xde)]),!![];}}async function updateLocation(_0x370ac3,_0x525ddc){const _0x35d314=a2_0x3eeea4;if(!_0x525ddc||_0x525ddc==='Unknown')return;if(!await isActive(_0x370ac3)){resetTimer(_0x370ac3);return;}if(currentMonitoredRoom&&currentMonitoredRoom!==_0x525ddc){const _0x295441=await areRoomsConnected(_0x370ac3,currentMonitoredRoom,_0x525ddc);if(!_0x295441){const _0x23e84f=_0x35d314(0xdc)+_0x525ddc+'\x27.\x20Nicht\x20verbunden\x20mit\x20√ºberwachtem\x20\x27'+currentMonitoredRoom+'\x27.';_0x370ac3['log']['info']('[DeadMan]\x20'+_0x23e84f+_0x35d314(0xd8)),await _0x370ac3['setStateAsync'](_0x35d314(0xe2),{'val':JSON['stringify']({'room':_0x525ddc,'reason':_0x23e84f,'timestamp':Date[_0x35d314(0xf3)]()}),'ack':!![]});return;}resetTimer(_0x370ac3);}if(!currentMonitoredRoom){await _0x370ac3['setStateAsync'](_0x35d314(0xcf),{'val':_0x525ddc,'ack':!![]});const _0x5d1975=await loadConfig(_0x370ac3),_0x263fd3=_0x525ddc[_0x35d314(0xd9)]();let _0x296fbe=_0x5d1975[_0x525ddc]||_0x5d1975[_0x263fd3];if(!_0x296fbe)for(const _0x32e77c in DEFAULT_TIMEOUTS){if(_0x263fd3[_0x35d314(0xdf)](_0x32e77c)){_0x296fbe=DEFAULT_TIMEOUTS[_0x32e77c];break;}}if(!_0x296fbe&&_0x5d1975[_0x35d314(0xe4)])_0x296fbe=_0x5d1975[_0x35d314(0xe4)];if(!_0x296fbe)return;currentMonitoredRoom=_0x525ddc,startTimer(_0x370ac3,_0x296fbe);}}function startTimer(_0x190c3b,_0x3a0fd3){const _0x51e988=a2_0x3eeea4;if(activeTimer)clearTimeout(activeTimer);timeoutMs=_0x3a0fd3*0x3c*0x3e8,startTime=Date['now'](),alarmStage=0x0,_0x190c3b[_0x51e988(0xd4)][_0x51e988(0xf4)](_0x51e988(0xe3)+currentMonitoredRoom+_0x51e988(0xda)+_0x3a0fd3+_0x51e988(0xd7)),_0x190c3b['setStateAsync'](_0x51e988(0xdb),{'val':'ok','ack':!![]}),activeTimer=setTimeout(()=>triggerPreWarn(_0x190c3b),timeoutMs);}function resetTimer(_0x4872ee){const _0x3ff904=a2_0x3eeea4;if(activeTimer)clearTimeout(activeTimer);activeTimer=null,currentMonitoredRoom=null,alarmStage=0x0,_0x4872ee[_0x3ff904(0xf1)](_0x3ff904(0xdb),{'val':'ok','ack':!![]});}async function triggerPreWarn(_0x2e1ef9){const _0x2f1d9d=a2_0x3eeea4;alarmStage=0x1,await _0x2e1ef9[_0x2f1d9d(0xf1)]('analysis.safety.deadMan.alarmState',{'val':_0x2f1d9d(0xd0),'ack':!![]});const _0x10707a=_0x2f1d9d(0xfb)+currentMonitoredRoom+_0x2f1d9d(0xd1);_0x2e1ef9['log'][_0x2f1d9d(0xfa)](_0x2f1d9d(0xe9)+_0x10707a),await setup['sendNotification'](_0x2e1ef9,_0x2f1d9d(0xed)+_0x10707a),activeTimer=setTimeout(()=>triggerAlarm(_0x2e1ef9),0x5*0x3c*0x3e8);}function a2_0x143b(){const _0x1aa71b=['(((.+)+)+)+$','./setup','\x20Min.','\x20(Multi-Person\x20Filter)','toLowerCase','\x20f√ºr\x20','analysis.safety.deadMan.alarmState','Ignoriere\x20Bewegung\x20in\x20\x27','10vTEzsS','message','includes','apply','error','analysis.safety.deadMan.lastIgnored','üëº\x20Schutzengel:\x20√úberwache\x20','default','100316xUmMoe','166453ZvBJNf','search','getStateAsync','[DeadMan]\x20','562508btrNAf','3768PqIoPG','5gufddo','üëº\x20Schutzengel-Frage:\x20','parse','val','toString','setStateAsync','3TZEhXb','now','info','1411038BpdISU','702SDNTQr','[DeadMan]\x20Topology\x20check\x20failed:\x20','indexOf','6109524HrEuBk','warn','‚è≥\x20ACHTUNG:\x20Ungew√∂hnlich\x20lange\x20Inaktivit√§t\x20in\x20','3DJrRnz','762509Kveszj','analysis.safety.deadMan.currentRoom','pre_warn','.\x20Alles\x20in\x20Ordnung?','exports','alarm','log'];a2_0x143b=function(){return _0x1aa71b;};return a2_0x143b();}async function triggerAlarm(_0x8f7c1d){const _0x4cfd5a=a2_0x3eeea4;alarmStage=0x2,await _0x8f7c1d[_0x4cfd5a(0xf1)]('analysis.safety.deadMan.alarmState',{'val':_0x4cfd5a(0xd3),'ack':!![]});const _0x1d1c4a='üö®\x20NOTFALL-ALARM:\x20Person\x20reagiert\x20nicht\x20in\x20'+currentMonitoredRoom+'!';_0x8f7c1d['log'][_0x4cfd5a(0xe1)](_0x4cfd5a(0xe9)+_0x1d1c4a),await setup['sendNotification'](_0x8f7c1d,_0x1d1c4a,![],!![]);}module[a2_0x3eeea4(0xd2)]={'updateLocation':updateLocation};