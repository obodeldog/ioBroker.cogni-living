const a2_0x215efd=a2_0x18a5;(function(_0x48f8ac,_0x5a47e0){const _0x56ebcc=a2_0x18a5,_0x1e6b67=_0x48f8ac();while(!![]){try{const _0x37535d=-parseInt(_0x56ebcc(0x1ce))/0x1*(-parseInt(_0x56ebcc(0x1c9))/0x2)+parseInt(_0x56ebcc(0x1c6))/0x3+-parseInt(_0x56ebcc(0x1b4))/0x4+-parseInt(_0x56ebcc(0x1d6))/0x5*(-parseInt(_0x56ebcc(0x1ad))/0x6)+parseInt(_0x56ebcc(0x1b1))/0x7+-parseInt(_0x56ebcc(0x1d0))/0x8*(parseInt(_0x56ebcc(0x1be))/0x9)+-parseInt(_0x56ebcc(0x1c4))/0xa;if(_0x37535d===_0x5a47e0)break;else _0x1e6b67['push'](_0x1e6b67['shift']());}catch(_0x17b24d){_0x1e6b67['push'](_0x1e6b67['shift']());}}}(a2_0x2744,0x83f4a));const a2_0x3ff6b0=(function(){let _0x3966fb=!![];return function(_0x160f5b,_0x47ffff){const _0x5875db=_0x3966fb?function(){const _0x4cfb27=a2_0x18a5;if(_0x47ffff){const _0x4c58eb=_0x47ffff[_0x4cfb27(0x1b8)](_0x160f5b,arguments);return _0x47ffff=null,_0x4c58eb;}}:function(){};return _0x3966fb=![],_0x5875db;};}()),a2_0x2aa981=a2_0x3ff6b0(this,function(){const _0x340d47=a2_0x18a5;return a2_0x2aa981[_0x340d47(0x1c5)]()['search'](_0x340d47(0x1a4))[_0x340d47(0x1c5)]()[_0x340d47(0x1a3)](a2_0x2aa981)[_0x340d47(0x1ae)](_0x340d47(0x1a4));});a2_0x2aa981();'use strict';const setup=require(a2_0x215efd(0x1bc));let activeTimer=null,currentMonitoredRoom=null,timeoutMs=0x0,startTime=0x0,alarmStage=0x0;const DEFAULT_TIMEOUTS={'bad':0x2d,'bath':0x2d,'toilet':0x1e,'wc':0x1e,'keller':0x3c,'schlaf':0x78,'bed':0x78,'guest':0x5a,'gast':0x5a};function getTimeoutRobust(_0x447374,_0xd757db){const _0x21f995=a2_0x215efd;if(!_0x447374||!_0xd757db)return undefined;if(_0x447374[_0xd757db])return _0x447374[_0xd757db];const _0x516378=_0xd757db[_0x21f995(0x1b0)]()['replace'](/[^a-z0-9]/g,'');for(const _0x1c5d5b in _0x447374){const _0x11e9f6=_0x1c5d5b[_0x21f995(0x1b0)]()[_0x21f995(0x1cd)](/[^a-z0-9]/g,'');if(_0x11e9f6===_0x516378)return _0x447374[_0x1c5d5b];}const _0x33e9b7=_0xd757db['toLowerCase']();if(_0x447374[_0x33e9b7])return _0x447374[_0x33e9b7];return undefined;}async function loadConfig(_0x51ee13){const _0x16cf2e=a2_0x215efd;try{const _0x3643f6=await _0x51ee13[_0x16cf2e(0x1b3)](_0x16cf2e(0x1cc));if(_0x3643f6&&_0x3643f6[_0x16cf2e(0x1bd)])return JSON[_0x16cf2e(0x1cf)](_0x3643f6[_0x16cf2e(0x1bd)]);}catch(_0x98ba51){}return{};}async function isActive(_0x418491){const _0x20fba2=a2_0x215efd;try{const _0x5e4923=await _0x418491[_0x20fba2(0x1b3)]('analysis.safety.deadMan.active');return _0x5e4923&&_0x5e4923[_0x20fba2(0x1bd)];}catch(_0x395c32){return![];}}async function areRoomsConnected(_0x56467f,_0x247af4,_0x439f75){const _0x8d75f5=a2_0x215efd;try{const _0x5b7ed3=await _0x56467f[_0x8d75f5(0x1b3)](_0x8d75f5(0x1c2));if(!_0x5b7ed3||!_0x5b7ed3[_0x8d75f5(0x1bd)])return!![];const _0x395d03=JSON['parse'](_0x5b7ed3[_0x8d75f5(0x1bd)]),{rooms:_0x4d36df,matrix:_0x4d5e97}=_0x395d03;if(!_0x4d36df||!_0x4d5e97)return!![];const _0x5c9137=_0x4d36df['indexOf'](_0x247af4),_0xd43b=_0x4d36df[_0x8d75f5(0x1bf)](_0x439f75);if(_0x5c9137===-0x1||_0xd43b===-0x1)return!![];const _0x315e46=_0x4d5e97[_0x5c9137][_0xd43b]>0x0||_0x4d5e97[_0xd43b][_0x5c9137]>0x0;return _0x315e46;}catch(_0x17e0b6){return _0x56467f['log']['warn']('[DeadMan]\x20Topology\x20check\x20failed:\x20'+_0x17e0b6[_0x8d75f5(0x1ab)]),!![];}}function calculateSleepProbability(_0x581913){const _0x524532=a2_0x215efd,_0x156b71=new Date(),_0x2adc86=_0x156b71['getHours'](),_0x5866dd=_0x581913[_0x524532(0x1b0)]();let _0x50aa2a=0.1;if(_0x2adc86>=0x17||_0x2adc86<=0x6)_0x50aa2a=0x1;else{if(_0x2adc86>=0xd&&_0x2adc86<=0xf)_0x50aa2a=0.8;else{if(_0x2adc86>=0x14&&_0x2adc86<=0x17)_0x50aa2a=0.4;}}let _0x500b5d=0.1;if(_0x5866dd['includes'](_0x524532(0x1a2))||_0x5866dd['includes'](_0x524532(0x1c7)))_0x500b5d=0x1;else{if(_0x5866dd['includes'](_0x524532(0x1a5))||_0x5866dd[_0x524532(0x1d4)](_0x524532(0x1b6))||_0x5866dd[_0x524532(0x1d4)](_0x524532(0x1d2)))_0x500b5d=0.6;else{if(_0x5866dd[_0x524532(0x1d4)](_0x524532(0x1b5))||_0x5866dd[_0x524532(0x1d4)]('wc'))_0x500b5d=0.05;}}let _0xdd841d=0.5;const _0x15476c=_0x500b5d*0.5+_0x50aa2a*0.3+_0xdd841d*0.2;return parseFloat(_0x15476c[_0x524532(0x1d7)](0x2));}function a2_0x18a5(_0x209cd5,_0x6d00c6){const _0x122c0b=a2_0x2744();return a2_0x18a5=function(_0x2aa981,_0x3ff6b0){_0x2aa981=_0x2aa981-0x19f;let _0x2744f0=_0x122c0b[_0x2aa981];return _0x2744f0;},a2_0x18a5(_0x209cd5,_0x6d00c6);}async function updateLocation(_0x251a15,_0xd7a799){const _0x193883=a2_0x215efd;if(!_0xd7a799||_0xd7a799===_0x193883(0x1b7))return;if(!await isActive(_0x251a15)){resetTimer(_0x251a15);return;}if(currentMonitoredRoom&&currentMonitoredRoom!==_0xd7a799){const _0x16ad7e=await areRoomsConnected(_0x251a15,currentMonitoredRoom,_0xd7a799);if(!_0x16ad7e){const _0x272264=_0x193883(0x1a1)+_0xd7a799+_0x193883(0x1d5)+currentMonitoredRoom+'\x27.';_0x251a15[_0x193883(0x19f)][_0x193883(0x1ac)](_0x193883(0x1a9)+_0x272264+_0x193883(0x1cb)),await _0x251a15[_0x193883(0x1c8)](_0x193883(0x1d3),{'val':JSON[_0x193883(0x1d8)]({'room':_0xd7a799,'reason':_0x272264,'timestamp':Date[_0x193883(0x1a7)]()}),'ack':!![]});return;}resetTimer(_0x251a15);}if(!currentMonitoredRoom){await _0x251a15[_0x193883(0x1c8)](_0x193883(0x1d1),{'val':_0xd7a799,'ack':!![]});const _0x4d4886=await loadConfig(_0x251a15);let _0x461773=getTimeoutRobust(_0x4d4886,_0xd7a799);const _0xbb446e=_0xd7a799[_0x193883(0x1b0)]();if(!_0x461773)for(const _0x57ccbd in DEFAULT_TIMEOUTS){if(_0xbb446e['includes'](_0x57ccbd)){_0x461773=DEFAULT_TIMEOUTS[_0x57ccbd];break;}}if(!_0x461773&&_0x4d4886[_0x193883(0x1bb)])_0x461773=_0x4d4886[_0x193883(0x1bb)];if(!_0x461773)return;currentMonitoredRoom=_0xd7a799,startTimer(_0x251a15,_0x461773,_0xd7a799);}}function startTimer(_0x4670d3,_0x4cd37b,_0x1e9395){const _0x29c359=a2_0x215efd;if(activeTimer)clearTimeout(activeTimer);timeoutMs=_0x4cd37b*0x3c*0x3e8,startTime=Date[_0x29c359(0x1a7)](),alarmStage=0x0;const _0x23a392=calculateSleepProbability(_0x1e9395||currentMonitoredRoom),_0x41fbc2=_0x23a392>0.65;_0x41fbc2?(timeoutMs+=0x5a*0x3c*0x3e8,_0x4670d3['log'][_0x29c359(0x1ac)](_0x29c359(0x1aa)+(_0x23a392*0x64)['toFixed'](0x0)+_0x29c359(0x1b2)+currentMonitoredRoom+_0x29c359(0x1a0)),_0x4670d3['setStateAsync']('analysis.safety.deadMan.smartSleep',{'val':!![],'ack':!![]})):_0x4670d3[_0x29c359(0x1c8)](_0x29c359(0x1ca),{'val':![],'ack':!![]}),_0x4670d3[_0x29c359(0x1c8)]('analysis.safety.deadMan.napProbability',{'val':_0x23a392,'ack':!![]}),_0x4670d3[_0x29c359(0x19f)][_0x29c359(0x1ac)]('üëº\x20Schutzengel:\x20√úberwache\x20'+currentMonitoredRoom+'\x20f√ºr\x20'+_0x4cd37b+_0x29c359(0x1a8)),_0x4670d3[_0x29c359(0x1c8)](_0x29c359(0x1c3),{'val':'ok','ack':!![]}),activeTimer=setTimeout(()=>triggerPreWarn(_0x4670d3),timeoutMs);}function resetTimer(_0x2cd68b){const _0xd79820=a2_0x215efd;if(activeTimer)clearTimeout(activeTimer);activeTimer=null,currentMonitoredRoom=null,alarmStage=0x0,_0x2cd68b[_0xd79820(0x1c8)]('analysis.safety.deadMan.alarmState',{'val':'ok','ack':!![]}),_0x2cd68b[_0xd79820(0x1c8)](_0xd79820(0x1ca),{'val':![],'ack':!![]}),_0x2cd68b[_0xd79820(0x1c8)](_0xd79820(0x1ba),{'val':0x0,'ack':!![]});}async function triggerPreWarn(_0x14ad1b){const _0x38a7b9=a2_0x215efd;alarmStage=0x1,await _0x14ad1b[_0x38a7b9(0x1c8)]('analysis.safety.deadMan.alarmState',{'val':'pre_warn','ack':!![]});const _0x4534eb=_0x38a7b9(0x1c0)+currentMonitoredRoom+'.\x20Alles\x20in\x20Ordnung?';_0x14ad1b[_0x38a7b9(0x19f)]['warn']('[DeadMan]\x20'+_0x4534eb),await setup[_0x38a7b9(0x1af)](_0x14ad1b,_0x38a7b9(0x1a6)+_0x4534eb),activeTimer=setTimeout(()=>triggerAlarm(_0x14ad1b),0x5*0x3c*0x3e8);}async function triggerAlarm(_0x3d8121){const _0x5048a2=a2_0x215efd;alarmStage=0x2,await _0x3d8121[_0x5048a2(0x1c8)](_0x5048a2(0x1c3),{'val':_0x5048a2(0x1b9),'ack':!![]});const _0x3c273a=_0x5048a2(0x1d9)+currentMonitoredRoom+'!';_0x3d8121[_0x5048a2(0x19f)][_0x5048a2(0x1c1)](_0x5048a2(0x1a9)+_0x3c273a),await setup[_0x5048a2(0x1af)](_0x3d8121,_0x3c273a,![],!![]);}module['exports']={'updateLocation':updateLocation};function a2_0x2744(){const _0x34ee3d=['\x20um\x2090\x20Min.','Ignoriere\x20Bewegung\x20in\x20\x27','schlaf','constructor','(((.+)+)+)+$','wohn','üëº\x20Schutzengel-Frage:\x20','now','\x20Min.','[DeadMan]\x20','üí§\x20Smart\x20Sleep\x20erkannt\x20(','message','info','874758hpZlRn','search','sendNotification','toLowerCase','4298490MImOqA','%).\x20Verl√§ngere\x20Timer\x20f√ºr\x20','getStateAsync','47808UCJVVE','bad','living','Unknown','apply','alarm','analysis.safety.deadMan.napProbability','default','./setup','val','873ZmtPmx','indexOf','‚è≥\x20ACHTUNG:\x20Ungew√∂hnlich\x20lange\x20Inaktivit√§t\x20in\x20','error','analysis.topology.structure','analysis.safety.deadMan.alarmState','12783970SYVINz','toString','882096NvTabi','bed','setStateAsync','229396vGZcfg','analysis.safety.deadMan.smartSleep','\x20(Multi-Person\x20Filter)','analysis.safety.deadMan.config','replace','8KQHGUI','parse','71720meLBgd','analysis.safety.deadMan.currentRoom','sofa','analysis.safety.deadMan.lastIgnored','includes','\x27.\x20Nicht\x20verbunden\x20mit\x20√ºberwachtem\x20\x27','30uxGREY','toFixed','stringify','üö®\x20NOTFALL-ALARM:\x20Person\x20reagiert\x20nicht\x20in\x20','log'];a2_0x2744=function(){return _0x34ee3d;};return a2_0x2744();}