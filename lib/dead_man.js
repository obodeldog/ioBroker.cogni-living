const a2_0x1bd0f8=a2_0x4520;(function(_0x35a8e2,_0x474261){const _0x24119a=a2_0x4520,_0x72d820=_0x35a8e2();while(!![]){try{const _0x40b9b4=-parseInt(_0x24119a(0xb6))/0x1*(-parseInt(_0x24119a(0xc3))/0x2)+-parseInt(_0x24119a(0xb0))/0x3*(-parseInt(_0x24119a(0xbf))/0x4)+-parseInt(_0x24119a(0x8f))/0x5+-parseInt(_0x24119a(0xa9))/0x6+-parseInt(_0x24119a(0x94))/0x7*(parseInt(_0x24119a(0x97))/0x8)+parseInt(_0x24119a(0xb8))/0x9+-parseInt(_0x24119a(0xba))/0xa*(parseInt(_0x24119a(0x8e))/0xb);if(_0x40b9b4===_0x474261)break;else _0x72d820['push'](_0x72d820['shift']());}catch(_0x145193){_0x72d820['push'](_0x72d820['shift']());}}}(a2_0x260b,0xc0d5f));function a2_0x260b(){const _0x2bf992=['error','stringify','wohn','toString','search','59HFvZkp','living','7103880DCtzwz','ðŸš¨\x20NOTFALL-ALARM:\x20Person\x20reagiert\x20nicht\x20in\x20','4030OzQJuR','analysis.safety.deadMan.smartSleep','(((.+)+)+)+$','toLowerCase','analysis.safety.deadMan.alarmState','1947692CLDfSB','pre_warn','sendNotification','\x20fÃ¼r\x20','43004ISzeaB','schlaf','analysis.safety.deadMan.napProbability','\x20um\x2090\x20Min.','Ignoriere\x20Bewegung\x20in\x20\x27','warn','toFixed','now','setStateAsync','analysis.topology.structure','5115mrCvCd','2914405tuYnSz','analysis.safety.deadMan.currentRoom','getStateAsync','bed','%).\x20VerlÃ¤ngere\x20Timer\x20fÃ¼r\x20','427IprdSa','analysis.safety.deadMan.lastIgnored','parse','48568yjstfJ','analysis.safety.deadMan.config','default','exports','ðŸ‘¼\x20Schutzengel:\x20Ãœberwache\x20','ðŸ’¤\x20Smart\x20Sleep\x20erkannt\x20(','log','val','message','./setup','analysis.safety.deadMan.active','\x20(Multi-Person\x20Filter)','info','getHours','â³\x20ACHTUNG:\x20UngewÃ¶hnlich\x20lange\x20InaktivitÃ¤t\x20in\x20','includes','\x27.\x20Nicht\x20verbunden\x20mit\x20Ã¼berwachtem\x20\x27','.\x20Alles\x20in\x20Ordnung?','3686394jlyqiP','[DeadMan]\x20','\x20Min.','indexOf','sofa','[DeadMan]\x20Topology\x20check\x20failed:\x20','replace','3cxkXzP'];a2_0x260b=function(){return _0x2bf992;};return a2_0x260b();}const a2_0x519dad=(function(){let _0x30e94c=!![];return function(_0x4afcad,_0x3f53d8){const _0xae0051=_0x30e94c?function(){if(_0x3f53d8){const _0x5cc4ae=_0x3f53d8['apply'](_0x4afcad,arguments);return _0x3f53d8=null,_0x5cc4ae;}}:function(){};return _0x30e94c=![],_0xae0051;};}()),a2_0x2468d4=a2_0x519dad(this,function(){const _0x3910ba=a2_0x4520;return a2_0x2468d4[_0x3910ba(0xb4)]()[_0x3910ba(0xb5)]('(((.+)+)+)+$')['toString']()['constructor'](a2_0x2468d4)['search'](_0x3910ba(0xbc));});a2_0x2468d4();'use strict';const setup=require(a2_0x1bd0f8(0xa0));let activeTimer=null,currentMonitoredRoom=null,timeoutMs=0x0,startTime=0x0,alarmStage=0x0;const DEFAULT_TIMEOUTS={'bad':0x2d,'bath':0x2d,'toilet':0x1e,'wc':0x1e,'keller':0x3c,'schlaf':0x78,'bed':0x78,'guest':0x5a,'gast':0x5a};function getTimeoutRobust(_0x108f6d,_0x34e9c8){const _0x2bce85=a2_0x1bd0f8;if(!_0x108f6d||!_0x34e9c8)return undefined;if(_0x108f6d[_0x34e9c8])return _0x108f6d[_0x34e9c8];const _0x4b6947=_0x34e9c8['toLowerCase']()[_0x2bce85(0xaf)](/[^a-z0-9]/g,'');for(const _0x4387b6 in _0x108f6d){const _0x5b7359=_0x4387b6[_0x2bce85(0xbd)]()[_0x2bce85(0xaf)](/[^a-z0-9]/g,'');if(_0x5b7359===_0x4b6947)return _0x108f6d[_0x4387b6];}const _0x1899c6=_0x34e9c8[_0x2bce85(0xbd)]();if(_0x108f6d[_0x1899c6])return _0x108f6d[_0x1899c6];return undefined;}async function loadConfig(_0x358706){const _0x58c353=a2_0x1bd0f8;try{const _0x165424=await _0x358706[_0x58c353(0x91)](_0x58c353(0x98));if(_0x165424&&_0x165424['val'])return JSON[_0x58c353(0x96)](_0x165424[_0x58c353(0x9e)]);}catch(_0x2abecd){}return{};}async function isActive(_0x4cb281){const _0xf5a31=a2_0x1bd0f8;try{const _0x488c0a=await _0x4cb281[_0xf5a31(0x91)](_0xf5a31(0xa1));return _0x488c0a&&_0x488c0a[_0xf5a31(0x9e)];}catch(_0x4dc74c){return![];}}async function areRoomsConnected(_0x4f0760,_0x23fe64,_0x54536e){const _0x52258a=a2_0x1bd0f8;try{const _0x574546=await _0x4f0760[_0x52258a(0x91)](_0x52258a(0x8d));if(!_0x574546||!_0x574546[_0x52258a(0x9e)])return!![];const _0x92cbbd=JSON['parse'](_0x574546[_0x52258a(0x9e)]),{rooms:_0x194b93,matrix:_0x42bab4}=_0x92cbbd;if(!_0x194b93||!_0x42bab4)return!![];const _0x10a4aa=_0x194b93[_0x52258a(0xac)](_0x23fe64),_0x3e8b20=_0x194b93[_0x52258a(0xac)](_0x54536e);if(_0x10a4aa===-0x1||_0x3e8b20===-0x1)return!![];const _0x340c60=_0x42bab4[_0x10a4aa][_0x3e8b20]>0x0||_0x42bab4[_0x3e8b20][_0x10a4aa]>0x0;return _0x340c60;}catch(_0x55a741){return _0x4f0760[_0x52258a(0x9d)]['warn'](_0x52258a(0xae)+_0x55a741[_0x52258a(0x9f)]),!![];}}function a2_0x4520(_0x57ef70,_0x15cb7c){const _0x53a020=a2_0x260b();return a2_0x4520=function(_0x2468d4,_0x519dad){_0x2468d4=_0x2468d4-0x87;let _0x260bd4=_0x53a020[_0x2468d4];return _0x260bd4;},a2_0x4520(_0x57ef70,_0x15cb7c);}function calculateSleepProbability(_0x473d98){const _0x5d4774=a2_0x1bd0f8,_0xe6dbd2=new Date(),_0x5dc083=_0xe6dbd2[_0x5d4774(0xa4)](),_0x39d8a3=_0x473d98['toLowerCase']();let _0xa52035=0.1;if(_0x5dc083>=0x17||_0x5dc083<=0x6)_0xa52035=0x1;else{if(_0x5dc083>=0xd&&_0x5dc083<=0xf)_0xa52035=0.8;else{if(_0x5dc083>=0x14&&_0x5dc083<=0x17)_0xa52035=0.4;}}let _0x5ba4b7=0.1;if(_0x39d8a3['includes'](_0x5d4774(0xc4))||_0x39d8a3['includes'](_0x5d4774(0x92)))_0x5ba4b7=0x1;else{if(_0x39d8a3[_0x5d4774(0xa6)](_0x5d4774(0xb3))||_0x39d8a3['includes'](_0x5d4774(0xb7))||_0x39d8a3[_0x5d4774(0xa6)](_0x5d4774(0xad)))_0x5ba4b7=0.6;else{if(_0x39d8a3[_0x5d4774(0xa6)]('bad')||_0x39d8a3[_0x5d4774(0xa6)]('wc'))_0x5ba4b7=0.05;}}let _0x50f951=0.5;const _0x264cad=_0x5ba4b7*0.5+_0xa52035*0.3+_0x50f951*0.2;return parseFloat(_0x264cad[_0x5d4774(0x8a)](0x2));}async function updateLocation(_0x488b25,_0x25213d){const _0x564df=a2_0x1bd0f8;if(!_0x25213d||_0x25213d==='Unknown')return;if(!await isActive(_0x488b25)){resetTimer(_0x488b25);return;}if(currentMonitoredRoom&&currentMonitoredRoom!==_0x25213d){const _0x50f63c=await areRoomsConnected(_0x488b25,currentMonitoredRoom,_0x25213d);if(!_0x50f63c){const _0x26d90f=_0x564df(0x88)+_0x25213d+_0x564df(0xa7)+currentMonitoredRoom+'\x27.';_0x488b25[_0x564df(0x9d)][_0x564df(0xa3)]('[DeadMan]\x20'+_0x26d90f+_0x564df(0xa2)),await _0x488b25[_0x564df(0x8c)](_0x564df(0x95),{'val':JSON[_0x564df(0xb2)]({'room':_0x25213d,'reason':_0x26d90f,'timestamp':Date[_0x564df(0x8b)]()}),'ack':!![]});return;}resetTimer(_0x488b25);}if(!currentMonitoredRoom){await _0x488b25[_0x564df(0x8c)](_0x564df(0x90),{'val':_0x25213d,'ack':!![]});const _0xb8fbdb=await loadConfig(_0x488b25);let _0x3470e9=getTimeoutRobust(_0xb8fbdb,_0x25213d);const _0x2e1686=_0x25213d[_0x564df(0xbd)]();if(!_0x3470e9)for(const _0x4a1e48 in DEFAULT_TIMEOUTS){if(_0x2e1686['includes'](_0x4a1e48)){_0x3470e9=DEFAULT_TIMEOUTS[_0x4a1e48];break;}}if(!_0x3470e9&&_0xb8fbdb['default'])_0x3470e9=_0xb8fbdb[_0x564df(0x99)];if(!_0x3470e9)return;currentMonitoredRoom=_0x25213d,startTimer(_0x488b25,_0x3470e9,_0x25213d);}}function startTimer(_0x1cc706,_0x3fe987,_0x32f73b){const _0x44bee4=a2_0x1bd0f8;if(activeTimer)clearTimeout(activeTimer);timeoutMs=_0x3fe987*0x3c*0x3e8,startTime=Date['now'](),alarmStage=0x0;const _0x406dd4=calculateSleepProbability(_0x32f73b||currentMonitoredRoom),_0x1b288c=_0x406dd4>0.65;_0x1b288c?(timeoutMs+=0x5a*0x3c*0x3e8,_0x1cc706[_0x44bee4(0x9d)][_0x44bee4(0xa3)](_0x44bee4(0x9c)+(_0x406dd4*0x64)['toFixed'](0x0)+_0x44bee4(0x93)+currentMonitoredRoom+_0x44bee4(0x87)),_0x1cc706[_0x44bee4(0x8c)]('analysis.safety.deadMan.smartSleep',{'val':!![],'ack':!![]})):_0x1cc706['setStateAsync'](_0x44bee4(0xbb),{'val':![],'ack':!![]}),_0x1cc706[_0x44bee4(0x8c)](_0x44bee4(0xc5),{'val':_0x406dd4,'ack':!![]}),_0x1cc706[_0x44bee4(0x9d)]['info'](_0x44bee4(0x9b)+currentMonitoredRoom+_0x44bee4(0xc2)+_0x3fe987+_0x44bee4(0xab)),_0x1cc706[_0x44bee4(0x8c)](_0x44bee4(0xbe),{'val':'ok','ack':!![]}),activeTimer=setTimeout(()=>triggerPreWarn(_0x1cc706),timeoutMs);}function resetTimer(_0x3a68a2){const _0x2aa3ec=a2_0x1bd0f8;if(activeTimer)clearTimeout(activeTimer);activeTimer=null,currentMonitoredRoom=null,alarmStage=0x0,_0x3a68a2[_0x2aa3ec(0x8c)](_0x2aa3ec(0xbe),{'val':'ok','ack':!![]}),_0x3a68a2[_0x2aa3ec(0x8c)](_0x2aa3ec(0xbb),{'val':![],'ack':!![]}),_0x3a68a2[_0x2aa3ec(0x8c)](_0x2aa3ec(0xc5),{'val':0x0,'ack':!![]});}async function triggerPreWarn(_0x3eebd8){const _0x5228a9=a2_0x1bd0f8;alarmStage=0x1,await _0x3eebd8[_0x5228a9(0x8c)]('analysis.safety.deadMan.alarmState',{'val':_0x5228a9(0xc0),'ack':!![]});const _0x230aa5=_0x5228a9(0xa5)+currentMonitoredRoom+_0x5228a9(0xa8);_0x3eebd8[_0x5228a9(0x9d)][_0x5228a9(0x89)](_0x5228a9(0xaa)+_0x230aa5),await setup[_0x5228a9(0xc1)](_0x3eebd8,'ðŸ‘¼\x20Schutzengel-Frage:\x20'+_0x230aa5),activeTimer=setTimeout(()=>triggerAlarm(_0x3eebd8),0x5*0x3c*0x3e8);}async function triggerAlarm(_0x19e9fe){const _0x18ff2c=a2_0x1bd0f8;alarmStage=0x2,await _0x19e9fe['setStateAsync'](_0x18ff2c(0xbe),{'val':'alarm','ack':!![]});const _0x53badc=_0x18ff2c(0xb9)+currentMonitoredRoom+'!';_0x19e9fe[_0x18ff2c(0x9d)][_0x18ff2c(0xb1)](_0x18ff2c(0xaa)+_0x53badc),await setup['sendNotification'](_0x19e9fe,_0x53badc,![],!![]);}module[a2_0x1bd0f8(0x9a)]={'updateLocation':updateLocation};