const a2_0x58e931=a2_0x4106;(function(_0x4d8743,_0x5f7459){const _0xcfe8b0=a2_0x4106,_0x17744a=_0x4d8743();while(!![]){try{const _0x106d2b=-parseInt(_0xcfe8b0(0x183))/0x1*(-parseInt(_0xcfe8b0(0x186))/0x2)+-parseInt(_0xcfe8b0(0x179))/0x3*(-parseInt(_0xcfe8b0(0x16b))/0x4)+-parseInt(_0xcfe8b0(0x18d))/0x5*(-parseInt(_0xcfe8b0(0x175))/0x6)+parseInt(_0xcfe8b0(0x180))/0x7+-parseInt(_0xcfe8b0(0x165))/0x8*(-parseInt(_0xcfe8b0(0x177))/0x9)+-parseInt(_0xcfe8b0(0x17a))/0xa+-parseInt(_0xcfe8b0(0x185))/0xb;if(_0x106d2b===_0x5f7459)break;else _0x17744a['push'](_0x17744a['shift']());}catch(_0x1efadd){_0x17744a['push'](_0x17744a['shift']());}}}(a2_0x22ed,0x463ae));const a2_0x5b3aca=(function(){let _0xdaa477=!![];return function(_0x2ba021,_0x168d96){const _0x4d451c=_0xdaa477?function(){const _0x43de8d=a2_0x4106;if(_0x168d96){const _0x63f5a9=_0x168d96[_0x43de8d(0x17b)](_0x2ba021,arguments);return _0x168d96=null,_0x63f5a9;}}:function(){};return _0xdaa477=![],_0x4d451c;};}()),a2_0x301d6b=a2_0x5b3aca(this,function(){const _0x1a68b7=a2_0x4106;return a2_0x301d6b[_0x1a68b7(0x176)]()['search'](_0x1a68b7(0x166))[_0x1a68b7(0x176)]()['constructor'](a2_0x301d6b)['search']('(((.+)+)+)+$');});a2_0x301d6b();'use strict';const setup=require(a2_0x58e931(0x178));let activeTimer=null,currentMonitoredRoom=null,timeoutMs=0x0,startTime=0x0,alarmStage=0x0;const DEFAULT_TIMEOUTS={'bad':0x2d,'bath':0x2d,'toilet':0x1e,'wc':0x1e,'keller':0x3c,'schlaf':0x78,'bed':0x78,'guest':0x5a,'gast':0x5a};async function loadConfig(_0x1c6f9b){const _0x5bdd54=a2_0x58e931;try{const _0x59b88d=await _0x1c6f9b['getStateAsync'](_0x5bdd54(0x193));if(_0x59b88d&&_0x59b88d[_0x5bdd54(0x167)])return JSON[_0x5bdd54(0x181)](_0x59b88d[_0x5bdd54(0x167)]);}catch(_0xca8b3e){}return{};}async function isActive(_0x55a039){const _0x4ec6f9=a2_0x58e931;try{const _0x13fce9=await _0x55a039[_0x4ec6f9(0x169)]('analysis.safety.deadMan.active');return _0x13fce9&&_0x13fce9[_0x4ec6f9(0x167)];}catch(_0xe408bc){return![];}}function a2_0x22ed(){const _0x25f0ed=['warn','1325276DSEKbW','error','sofa','bad','toLowerCase','default','[DeadMan]\x20Topology\x20check\x20failed:\x20','toFixed','analysis.topology.structure','includes','6EtyXZB','toString','26622BDGvFk','./setup','3txwdXU','3142320YjINOL','apply','â³\x20ACHTUNG:\x20UngewÃ¶hnlich\x20lange\x20InaktivitÃ¤t\x20in\x20','message','analysis.safety.deadMan.lastIgnored','analysis.safety.deadMan.napProbability','2558402hcfumK','parse','analysis.safety.deadMan.currentRoom','3sSlHhK','\x20um\x2090\x20Min.','11218735VpnEFh','217942LxhlDk','now','bed','ðŸ’¤\x20Smart\x20Sleep\x20erkannt\x20(','indexOf','ðŸ‘¼\x20Schutzengel-Frage:\x20','getHours','1718365bzGNpz','info','sendNotification','log','\x27.\x20Nicht\x20verbunden\x20mit\x20Ã¼berwachtem\x20\x27','wohn','analysis.safety.deadMan.config','living','exports','setStateAsync','analysis.safety.deadMan.alarmState','688XHuyMm','(((.+)+)+)+$','val','analysis.safety.deadMan.smartSleep','getStateAsync'];a2_0x22ed=function(){return _0x25f0ed;};return a2_0x22ed();}async function areRoomsConnected(_0x246574,_0x39ce9b,_0x272daa){const _0x15e790=a2_0x58e931;try{const _0x24c25e=await _0x246574['getStateAsync'](_0x15e790(0x173));if(!_0x24c25e||!_0x24c25e['val'])return!![];const _0x49b318=JSON[_0x15e790(0x181)](_0x24c25e[_0x15e790(0x167)]),{rooms:_0x5442a8,matrix:_0x208b8f}=_0x49b318;if(!_0x5442a8||!_0x208b8f)return!![];const _0x3445f2=_0x5442a8[_0x15e790(0x18a)](_0x39ce9b),_0x4a0f73=_0x5442a8[_0x15e790(0x18a)](_0x272daa);if(_0x3445f2===-0x1||_0x4a0f73===-0x1)return!![];const _0x370657=_0x208b8f[_0x3445f2][_0x4a0f73]>0x0||_0x208b8f[_0x4a0f73][_0x3445f2]>0x0;return _0x370657;}catch(_0x5edbfc){return _0x246574[_0x15e790(0x190)][_0x15e790(0x16a)](_0x15e790(0x171)+_0x5edbfc[_0x15e790(0x17d)]),!![];}}function calculateSleepProbability(_0x4e3683){const _0x14acfb=a2_0x58e931,_0x3f631e=new Date(),_0x4158a7=_0x3f631e[_0x14acfb(0x18c)](),_0x1e178f=_0x4e3683[_0x14acfb(0x16f)]();let _0x5d5172=0.1;if(_0x4158a7>=0x17||_0x4158a7<=0x6)_0x5d5172=0x1;else{if(_0x4158a7>=0xd&&_0x4158a7<=0xf)_0x5d5172=0.8;else{if(_0x4158a7>=0x14&&_0x4158a7<=0x17)_0x5d5172=0.4;}}let _0x185d95=0.1;if(_0x1e178f[_0x14acfb(0x174)]('schlaf')||_0x1e178f['includes'](_0x14acfb(0x188)))_0x185d95=0x1;else{if(_0x1e178f[_0x14acfb(0x174)](_0x14acfb(0x192))||_0x1e178f[_0x14acfb(0x174)](_0x14acfb(0x161))||_0x1e178f[_0x14acfb(0x174)](_0x14acfb(0x16d)))_0x185d95=0.6;else{if(_0x1e178f[_0x14acfb(0x174)](_0x14acfb(0x16e))||_0x1e178f[_0x14acfb(0x174)]('wc'))_0x185d95=0.05;}}let _0x2873a3=0.5;const _0x69fa8a=_0x185d95*0.5+_0x5d5172*0.3+_0x2873a3*0.2;return parseFloat(_0x69fa8a['toFixed'](0x2));}async function updateLocation(_0x6a2cc2,_0x3e94d6){const _0x2ca770=a2_0x58e931;if(!_0x3e94d6||_0x3e94d6==='Unknown')return;if(!await isActive(_0x6a2cc2)){resetTimer(_0x6a2cc2);return;}if(currentMonitoredRoom&&currentMonitoredRoom!==_0x3e94d6){const _0x4deddd=await areRoomsConnected(_0x6a2cc2,currentMonitoredRoom,_0x3e94d6);if(!_0x4deddd){const _0x5777ac='Ignoriere\x20Bewegung\x20in\x20\x27'+_0x3e94d6+_0x2ca770(0x191)+currentMonitoredRoom+'\x27.';_0x6a2cc2[_0x2ca770(0x190)][_0x2ca770(0x18e)]('[DeadMan]\x20'+_0x5777ac+'\x20(Multi-Person\x20Filter)'),await _0x6a2cc2[_0x2ca770(0x163)](_0x2ca770(0x17e),{'val':JSON['stringify']({'room':_0x3e94d6,'reason':_0x5777ac,'timestamp':Date[_0x2ca770(0x187)]()}),'ack':!![]});return;}resetTimer(_0x6a2cc2);}if(!currentMonitoredRoom){await _0x6a2cc2[_0x2ca770(0x163)](_0x2ca770(0x182),{'val':_0x3e94d6,'ack':!![]});const _0x174a13=await loadConfig(_0x6a2cc2),_0x328828=_0x3e94d6[_0x2ca770(0x16f)]();let _0x3a2b5c=_0x174a13[_0x3e94d6]||_0x174a13[_0x328828];if(!_0x3a2b5c)for(const _0x25961c in DEFAULT_TIMEOUTS){if(_0x328828['includes'](_0x25961c)){_0x3a2b5c=DEFAULT_TIMEOUTS[_0x25961c];break;}}if(!_0x3a2b5c&&_0x174a13[_0x2ca770(0x170)])_0x3a2b5c=_0x174a13[_0x2ca770(0x170)];if(!_0x3a2b5c)return;currentMonitoredRoom=_0x3e94d6,startTimer(_0x6a2cc2,_0x3a2b5c,_0x3e94d6);}}function startTimer(_0x4b2a6b,_0x4ec26f,_0xa01b35){const _0xcd13e7=a2_0x58e931;if(activeTimer)clearTimeout(activeTimer);timeoutMs=_0x4ec26f*0x3c*0x3e8,startTime=Date[_0xcd13e7(0x187)](),alarmStage=0x0;const _0x3c8002=calculateSleepProbability(_0xa01b35||currentMonitoredRoom),_0x49a7f2=_0x3c8002>0.65;_0x49a7f2?(timeoutMs+=0x5a*0x3c*0x3e8,_0x4b2a6b[_0xcd13e7(0x190)][_0xcd13e7(0x18e)](_0xcd13e7(0x189)+(_0x3c8002*0x64)[_0xcd13e7(0x172)](0x0)+'%).\x20VerlÃ¤ngere\x20Timer\x20fÃ¼r\x20'+currentMonitoredRoom+_0xcd13e7(0x184)),_0x4b2a6b[_0xcd13e7(0x163)](_0xcd13e7(0x168),{'val':!![],'ack':!![]})):_0x4b2a6b[_0xcd13e7(0x163)](_0xcd13e7(0x168),{'val':![],'ack':!![]}),_0x4b2a6b[_0xcd13e7(0x163)](_0xcd13e7(0x17f),{'val':_0x3c8002,'ack':!![]}),_0x4b2a6b['log'][_0xcd13e7(0x18e)]('ðŸ‘¼\x20Schutzengel:\x20Ãœberwache\x20'+currentMonitoredRoom+'\x20fÃ¼r\x20'+_0x4ec26f+'\x20Min.'),_0x4b2a6b['setStateAsync'](_0xcd13e7(0x164),{'val':'ok','ack':!![]}),activeTimer=setTimeout(()=>triggerPreWarn(_0x4b2a6b),timeoutMs);}function resetTimer(_0x56f1e2){const _0x5144d5=a2_0x58e931;if(activeTimer)clearTimeout(activeTimer);activeTimer=null,currentMonitoredRoom=null,alarmStage=0x0,_0x56f1e2[_0x5144d5(0x163)](_0x5144d5(0x164),{'val':'ok','ack':!![]}),_0x56f1e2[_0x5144d5(0x163)](_0x5144d5(0x168),{'val':![],'ack':!![]}),_0x56f1e2[_0x5144d5(0x163)]('analysis.safety.deadMan.napProbability',{'val':0x0,'ack':!![]});}async function triggerPreWarn(_0x5b409e){const _0x26981f=a2_0x58e931;alarmStage=0x1,await _0x5b409e[_0x26981f(0x163)]('analysis.safety.deadMan.alarmState',{'val':'pre_warn','ack':!![]});const _0x40512d=_0x26981f(0x17c)+currentMonitoredRoom+'.\x20Alles\x20in\x20Ordnung?';_0x5b409e[_0x26981f(0x190)][_0x26981f(0x16a)]('[DeadMan]\x20'+_0x40512d),await setup[_0x26981f(0x18f)](_0x5b409e,_0x26981f(0x18b)+_0x40512d),activeTimer=setTimeout(()=>triggerAlarm(_0x5b409e),0x5*0x3c*0x3e8);}async function triggerAlarm(_0x61342d){const _0x5b925d=a2_0x58e931;alarmStage=0x2,await _0x61342d[_0x5b925d(0x163)]('analysis.safety.deadMan.alarmState',{'val':'alarm','ack':!![]});const _0x660e5c='ðŸš¨\x20NOTFALL-ALARM:\x20Person\x20reagiert\x20nicht\x20in\x20'+currentMonitoredRoom+'!';_0x61342d['log'][_0x5b925d(0x16c)]('[DeadMan]\x20'+_0x660e5c),await setup['sendNotification'](_0x61342d,_0x660e5c,![],!![]);}function a2_0x4106(_0x50166b,_0x18c6b7){const _0x34d201=a2_0x22ed();return a2_0x4106=function(_0x301d6b,_0x5b3aca){_0x301d6b=_0x301d6b-0x161;let _0x22ed61=_0x34d201[_0x301d6b];return _0x22ed61;},a2_0x4106(_0x50166b,_0x18c6b7);}module[a2_0x58e931(0x162)]={'updateLocation':updateLocation};