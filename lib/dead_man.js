function a2_0x37bb(_0x5349ba,_0x255793){const _0x1e9897=a2_0x3ab2();return a2_0x37bb=function(_0x10513b,_0x45c146){_0x10513b=_0x10513b-0x17a;let _0x3ab2ff=_0x1e9897[_0x10513b];return _0x3ab2ff;},a2_0x37bb(_0x5349ba,_0x255793);}const a2_0x1bc9de=a2_0x37bb;(function(_0x5db57b,_0x4f3a87){const _0x1d7bf=a2_0x37bb,_0x1b852c=_0x5db57b();while(!![]){try{const _0xfe1bf8=-parseInt(_0x1d7bf(0x19b))/0x1+-parseInt(_0x1d7bf(0x19f))/0x2*(parseInt(_0x1d7bf(0x19e))/0x3)+-parseInt(_0x1d7bf(0x1a0))/0x4*(parseInt(_0x1d7bf(0x1a8))/0x5)+-parseInt(_0x1d7bf(0x17c))/0x6*(-parseInt(_0x1d7bf(0x192))/0x7)+parseInt(_0x1d7bf(0x186))/0x8+parseInt(_0x1d7bf(0x1a6))/0x9*(parseInt(_0x1d7bf(0x1b1))/0xa)+parseInt(_0x1d7bf(0x18f))/0xb;if(_0xfe1bf8===_0x4f3a87)break;else _0x1b852c['push'](_0x1b852c['shift']());}catch(_0x697c9){_0x1b852c['push'](_0x1b852c['shift']());}}}(a2_0x3ab2,0x98df8));const a2_0x45c146=(function(){let _0x4ff4c5=!![];return function(_0x1243c4,_0x2a7b4b){const _0x4213eb=_0x4ff4c5?function(){if(_0x2a7b4b){const _0x2657cd=_0x2a7b4b['apply'](_0x1243c4,arguments);return _0x2a7b4b=null,_0x2657cd;}}:function(){};return _0x4ff4c5=![],_0x4213eb;};}()),a2_0x10513b=a2_0x45c146(this,function(){const _0x3c4fa=a2_0x37bb;return a2_0x10513b[_0x3c4fa(0x198)]()[_0x3c4fa(0x182)]('(((.+)+)+)+$')[_0x3c4fa(0x198)]()[_0x3c4fa(0x189)](a2_0x10513b)[_0x3c4fa(0x182)](_0x3c4fa(0x1b0));});a2_0x10513b();'use strict';const setup=require(a2_0x1bc9de(0x180));let activeTimer=null,currentMonitoredRoom=null,timeoutMs=0x0,startTime=0x0,alarmStage=0x0;const DEFAULT_TIMEOUTS={'bad':0x2d,'bath':0x2d,'toilet':0x1e,'wc':0x1e,'keller':0x3c,'schlaf':0x78,'bed':0x78,'guest':0x5a,'gast':0x5a};function getTimeoutRobust(_0x1a12cf,_0x3d3461){const _0x4e5171=a2_0x1bc9de;if(!_0x1a12cf||!_0x3d3461)return undefined;if(_0x1a12cf[_0x3d3461])return _0x1a12cf[_0x3d3461];const _0x2ba605=_0x3d3461[_0x4e5171(0x19c)]()[_0x4e5171(0x1a5)](/[^a-z0-9]/g,'');for(const _0xb8e8e6 in _0x1a12cf){const _0x268e94=_0xb8e8e6[_0x4e5171(0x19c)]()[_0x4e5171(0x1a5)](/[^a-z0-9]/g,'');if(_0x268e94===_0x2ba605)return _0x1a12cf[_0xb8e8e6];}const _0xaa2b64=_0x3d3461[_0x4e5171(0x19c)]();if(_0x1a12cf[_0xaa2b64])return _0x1a12cf[_0xaa2b64];return undefined;}async function loadConfig(_0x247cf8){const _0x3f95c0=a2_0x1bc9de;try{const _0x539f59=await _0x247cf8[_0x3f95c0(0x1aa)](_0x3f95c0(0x1ad));if(_0x539f59&&_0x539f59[_0x3f95c0(0x185)])return JSON[_0x3f95c0(0x1b3)](_0x539f59[_0x3f95c0(0x185)]);}catch(_0x56d78d){}return{};}function a2_0x3ab2(){const _0x13827f=['./setup','wohn','search','includes','.\x20Alles\x20in\x20Ordnung?','val','6881424dwrzfS','indexOf','info','constructor','ðŸš¨\x20NOTFALL-ALARM:\x20Person\x20reagiert\x20nicht\x20in\x20','â³\x20ACHTUNG:\x20UngewÃ¶hnlich\x20lange\x20InaktivitÃ¤t\x20in\x20','analysis.safety.deadMan.smartSleep','%).\x20VerlÃ¤ngere\x20Timer\x20fÃ¼r\x20','ðŸ’¤\x20Smart\x20Sleep\x20erkannt\x20(','4616755pctViG','log','analysis.safety.deadMan.alarmState','1876sBTaGX','stringify','Ignoriere\x20Bewegung\x20in\x20\x27','alarm','ðŸ‘¼\x20Schutzengel-Frage:\x20','error','toString','\x27.\x20Nicht\x20verbunden\x20mit\x20Ã¼berwachtem\x20\x27','[DeadMan]\x20Topology\x20check\x20failed:\x20','1094451YNegUh','toLowerCase','toFixed','535713LgnONm','6SINCVQ','371204AspkjJ','\x20fÃ¼r\x20','getHours','warn','[DeadMan]\x20','replace','1546101VceFTn','analysis.safety.deadMan.currentRoom','10xBTujA','analysis.safety.deadMan.napProbability','getStateAsync','living','sendNotification','analysis.safety.deadMan.config','pre_warn','\x20um\x2090\x20Min.','(((.+)+)+)+$','30nyyLHQ','setStateAsync','parse','\x20(Multi-Person\x20Filter)','bad','14478HoLkIQ','Unknown','\x20Min.','default'];a2_0x3ab2=function(){return _0x13827f;};return a2_0x3ab2();}async function isActive(_0x3fe01f){const _0x2e2c83=a2_0x1bc9de;try{const _0x3a930c=await _0x3fe01f[_0x2e2c83(0x1aa)]('analysis.safety.deadMan.active');return _0x3a930c&&_0x3a930c[_0x2e2c83(0x185)];}catch(_0x180447){return![];}}async function areRoomsConnected(_0x3a1e08,_0x24e724,_0x438cd4){const _0x58d9c6=a2_0x1bc9de;try{const _0x5e6e79=await _0x3a1e08[_0x58d9c6(0x1aa)]('analysis.topology.structure');if(!_0x5e6e79||!_0x5e6e79[_0x58d9c6(0x185)])return!![];const _0xf062f2=JSON[_0x58d9c6(0x1b3)](_0x5e6e79[_0x58d9c6(0x185)]),{rooms:_0x3301ca,matrix:_0x296125}=_0xf062f2;if(!_0x3301ca||!_0x296125)return!![];const _0x52cc91=_0x3301ca[_0x58d9c6(0x187)](_0x24e724),_0xbe628a=_0x3301ca[_0x58d9c6(0x187)](_0x438cd4);if(_0x52cc91===-0x1||_0xbe628a===-0x1)return!![];const _0x2ff256=_0x296125[_0x52cc91][_0xbe628a]>0x0||_0x296125[_0xbe628a][_0x52cc91]>0x0;return _0x2ff256;}catch(_0x1ac04a){return _0x3a1e08[_0x58d9c6(0x190)]['warn'](_0x58d9c6(0x19a)+_0x1ac04a['message']),!![];}}function calculateSleepProbability(_0x10b85c){const _0x4b5881=a2_0x1bc9de,_0x46b10b=new Date(),_0x3f64d0=_0x46b10b[_0x4b5881(0x1a2)](),_0x32f4ef=_0x10b85c[_0x4b5881(0x19c)]();let _0x412b8a=0.1;if(_0x3f64d0>=0x17||_0x3f64d0<=0x6)_0x412b8a=0x1;else{if(_0x3f64d0>=0xd&&_0x3f64d0<=0xf)_0x412b8a=0.8;else{if(_0x3f64d0>=0x14&&_0x3f64d0<=0x17)_0x412b8a=0.4;}}let _0x572d1c=0.1;if(_0x32f4ef[_0x4b5881(0x183)]('schlaf')||_0x32f4ef['includes']('bed'))_0x572d1c=0x1;else{if(_0x32f4ef[_0x4b5881(0x183)](_0x4b5881(0x181))||_0x32f4ef['includes'](_0x4b5881(0x1ab))||_0x32f4ef[_0x4b5881(0x183)]('sofa'))_0x572d1c=0.6;else{if(_0x32f4ef[_0x4b5881(0x183)](_0x4b5881(0x17b))||_0x32f4ef[_0x4b5881(0x183)]('wc'))_0x572d1c=0.05;}}let _0x3cdc11=0.5;const _0x1d125f=_0x572d1c*0.5+_0x412b8a*0.3+_0x3cdc11*0.2;return parseFloat(_0x1d125f[_0x4b5881(0x19d)](0x2));}async function updateLocation(_0x1a8d52,_0xa76321){const _0x3ced78=a2_0x1bc9de;if(!_0xa76321||_0xa76321===_0x3ced78(0x17d))return;if(!await isActive(_0x1a8d52)){resetTimer(_0x1a8d52);return;}if(currentMonitoredRoom&&currentMonitoredRoom!==_0xa76321){const _0x376eef=await areRoomsConnected(_0x1a8d52,currentMonitoredRoom,_0xa76321);if(!_0x376eef){const _0x20bb59=_0x3ced78(0x194)+_0xa76321+_0x3ced78(0x199)+currentMonitoredRoom+'\x27.';_0x1a8d52[_0x3ced78(0x190)][_0x3ced78(0x188)]('[DeadMan]\x20'+_0x20bb59+_0x3ced78(0x17a)),await _0x1a8d52[_0x3ced78(0x1b2)]('analysis.safety.deadMan.lastIgnored',{'val':JSON[_0x3ced78(0x193)]({'room':_0xa76321,'reason':_0x20bb59,'timestamp':Date['now']()}),'ack':!![]});return;}resetTimer(_0x1a8d52);}if(!currentMonitoredRoom){await _0x1a8d52['setStateAsync'](_0x3ced78(0x1a7),{'val':_0xa76321,'ack':!![]});const _0x53e0b3=await loadConfig(_0x1a8d52);let _0x2f5058=getTimeoutRobust(_0x53e0b3,_0xa76321);const _0x2aa7d1=_0xa76321[_0x3ced78(0x19c)]();if(!_0x2f5058)for(const _0x3ad93d in DEFAULT_TIMEOUTS){if(_0x2aa7d1[_0x3ced78(0x183)](_0x3ad93d)){_0x2f5058=DEFAULT_TIMEOUTS[_0x3ad93d];break;}}if(!_0x2f5058&&_0x53e0b3[_0x3ced78(0x17f)])_0x2f5058=_0x53e0b3[_0x3ced78(0x17f)];if(!_0x2f5058)return;currentMonitoredRoom=_0xa76321,startTimer(_0x1a8d52,_0x2f5058,_0xa76321);}}function startTimer(_0xd63527,_0x1be994,_0x5768b6){const _0x40ccf0=a2_0x1bc9de;if(activeTimer)clearTimeout(activeTimer);timeoutMs=_0x1be994*0x3c*0x3e8,startTime=Date['now'](),alarmStage=0x0;const _0x4423ef=calculateSleepProbability(_0x5768b6||currentMonitoredRoom),_0x540054=_0x4423ef>0.65;_0x540054?(timeoutMs+=0x5a*0x3c*0x3e8,_0xd63527[_0x40ccf0(0x190)]['info'](_0x40ccf0(0x18e)+(_0x4423ef*0x64)[_0x40ccf0(0x19d)](0x0)+_0x40ccf0(0x18d)+currentMonitoredRoom+_0x40ccf0(0x1af)),_0xd63527['setStateAsync'](_0x40ccf0(0x18c),{'val':!![],'ack':!![]})):_0xd63527['setStateAsync'](_0x40ccf0(0x18c),{'val':![],'ack':!![]}),_0xd63527[_0x40ccf0(0x1b2)](_0x40ccf0(0x1a9),{'val':_0x4423ef,'ack':!![]}),_0xd63527[_0x40ccf0(0x190)][_0x40ccf0(0x188)]('ðŸ‘¼\x20Schutzengel:\x20Ãœberwache\x20'+currentMonitoredRoom+_0x40ccf0(0x1a1)+_0x1be994+_0x40ccf0(0x17e)),_0xd63527['setStateAsync'](_0x40ccf0(0x191),{'val':'ok','ack':!![]}),activeTimer=setTimeout(()=>triggerPreWarn(_0xd63527),timeoutMs);}function resetTimer(_0x38a0da){const _0x179e40=a2_0x1bc9de;if(activeTimer)clearTimeout(activeTimer);activeTimer=null,currentMonitoredRoom=null,alarmStage=0x0,_0x38a0da[_0x179e40(0x1b2)]('analysis.safety.deadMan.alarmState',{'val':'ok','ack':!![]}),_0x38a0da['setStateAsync'](_0x179e40(0x18c),{'val':![],'ack':!![]}),_0x38a0da[_0x179e40(0x1b2)]('analysis.safety.deadMan.napProbability',{'val':0x0,'ack':!![]});}async function triggerPreWarn(_0x5040e3){const _0x1d8b05=a2_0x1bc9de;alarmStage=0x1,await _0x5040e3[_0x1d8b05(0x1b2)](_0x1d8b05(0x191),{'val':_0x1d8b05(0x1ae),'ack':!![]});const _0x34aeaa=_0x1d8b05(0x18b)+currentMonitoredRoom+_0x1d8b05(0x184);_0x5040e3[_0x1d8b05(0x190)][_0x1d8b05(0x1a3)](_0x1d8b05(0x1a4)+_0x34aeaa),await setup['sendNotification'](_0x5040e3,_0x1d8b05(0x196)+_0x34aeaa),activeTimer=setTimeout(()=>triggerAlarm(_0x5040e3),0x5*0x3c*0x3e8);}async function triggerAlarm(_0x47d61a){const _0x123b30=a2_0x1bc9de;alarmStage=0x2,await _0x47d61a[_0x123b30(0x1b2)](_0x123b30(0x191),{'val':_0x123b30(0x195),'ack':!![]});const _0x21a4f1=_0x123b30(0x18a)+currentMonitoredRoom+'!';_0x47d61a['log'][_0x123b30(0x197)](_0x123b30(0x1a4)+_0x21a4f1),await setup[_0x123b30(0x1ac)](_0x47d61a,_0x21a4f1,![],!![]);}module['exports']={'updateLocation':updateLocation};