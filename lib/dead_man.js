const a2_0x4838ee=a2_0x3d24;(function(_0x8e3485,_0x5b9dfd){const _0x3ff337=a2_0x3d24,_0x1cf798=_0x8e3485();while(!![]){try{const _0x2df825=-parseInt(_0x3ff337(0x18c))/0x1+-parseInt(_0x3ff337(0x182))/0x2*(parseInt(_0x3ff337(0x18f))/0x3)+-parseInt(_0x3ff337(0x17d))/0x4+-parseInt(_0x3ff337(0x18e))/0x5+-parseInt(_0x3ff337(0x194))/0x6+-parseInt(_0x3ff337(0x191))/0x7+parseInt(_0x3ff337(0x190))/0x8;if(_0x2df825===_0x5b9dfd)break;else _0x1cf798['push'](_0x1cf798['shift']());}catch(_0x510d88){_0x1cf798['push'](_0x1cf798['shift']());}}}(a2_0x1e78,0x3ed43));const a2_0x31a046=(function(){let _0x7fb002=!![];return function(_0x3ef944,_0x15f26b){const _0x1841ad=_0x7fb002?function(){const _0x3b18e3=a2_0x3d24;if(_0x15f26b){const _0x5b60cc=_0x15f26b[_0x3b18e3(0x177)](_0x3ef944,arguments);return _0x15f26b=null,_0x5b60cc;}}:function(){};return _0x7fb002=![],_0x1841ad;};}()),a2_0x1f5bd1=a2_0x31a046(this,function(){const _0x552ee0=a2_0x3d24;return a2_0x1f5bd1[_0x552ee0(0x175)]()[_0x552ee0(0x188)](_0x552ee0(0x186))[_0x552ee0(0x175)]()[_0x552ee0(0x199)](a2_0x1f5bd1)['search'](_0x552ee0(0x186));});a2_0x1f5bd1();'use strict';const setup=require(a2_0x4838ee(0x17f));let activeTimer=null,currentMonitoredRoom=null,timeoutMs=0x0,startTime=0x0,alarmStage=0x0;const DEFAULT_TIMEOUTS={'bad':0x2d,'bath':0x2d,'toilet':0x1e,'wc':0x1e,'keller':0x3c};async function loadConfig(_0x592c99){const _0x469315=a2_0x4838ee;try{const _0x4880df=await _0x592c99[_0x469315(0x17c)](_0x469315(0x173));if(_0x4880df&&_0x4880df[_0x469315(0x17a)])return JSON[_0x469315(0x189)](_0x4880df[_0x469315(0x17a)]);}catch(_0x12b28f){}return{};}async function isActive(_0x427a62){const _0x23959b=a2_0x4838ee;try{const _0x2f6e65=await _0x427a62[_0x23959b(0x17c)](_0x23959b(0x18b));return _0x2f6e65&&_0x2f6e65[_0x23959b(0x17a)];}catch(_0x4e0d80){return![];}}async function areRoomsConnected(_0x24c3d0,_0x4cf009,_0x535423){const _0x17889a=a2_0x4838ee;try{const _0x561d88=await _0x24c3d0[_0x17889a(0x17c)](_0x17889a(0x197));if(!_0x561d88||!_0x561d88[_0x17889a(0x17a)])return!![];const _0x4ab2af=JSON['parse'](_0x561d88['val']),{rooms:_0x3c565c,matrix:_0x1084fa}=_0x4ab2af;if(!_0x3c565c||!_0x1084fa)return!![];const _0x23404e=_0x3c565c[_0x17889a(0x184)](_0x4cf009),_0x45a9a4=_0x3c565c['indexOf'](_0x535423);if(_0x23404e===-0x1||_0x45a9a4===-0x1)return!![];const _0x3b3d9b=_0x1084fa[_0x23404e][_0x45a9a4]>0x0||_0x1084fa[_0x45a9a4][_0x23404e]>0x0;return _0x3b3d9b;}catch(_0x238cbb){return _0x24c3d0[_0x17889a(0x170)][_0x17889a(0x192)]('[DeadMan]\x20Topology\x20check\x20failed:\x20'+_0x238cbb['message']),!![];}}async function updateLocation(_0x578ec1,_0x52512b){const _0x3aaaf2=a2_0x4838ee;if(!_0x52512b||_0x52512b==='Unknown')return;if(!await isActive(_0x578ec1)){resetTimer(_0x578ec1);return;}if(currentMonitoredRoom&&currentMonitoredRoom!==_0x52512b){const _0x5f2511=await areRoomsConnected(_0x578ec1,currentMonitoredRoom,_0x52512b);if(!_0x5f2511){const _0x188766=_0x3aaaf2(0x179)+_0x52512b+_0x3aaaf2(0x178)+currentMonitoredRoom+'\x27.';_0x578ec1[_0x3aaaf2(0x170)]['info'](_0x3aaaf2(0x18a)+_0x188766+_0x3aaaf2(0x185)),await _0x578ec1[_0x3aaaf2(0x181)](_0x3aaaf2(0x17e),{'val':JSON['stringify']({'room':_0x52512b,'reason':_0x188766,'timestamp':Date['now']()}),'ack':!![]});return;}resetTimer(_0x578ec1);}if(!currentMonitoredRoom){await _0x578ec1['setStateAsync']('analysis.safety.deadMan.currentRoom',{'val':_0x52512b,'ack':!![]});const _0x3bc4d2=await loadConfig(_0x578ec1),_0x467813=_0x52512b[_0x3aaaf2(0x180)]();let _0x2d0f74=_0x3bc4d2[_0x52512b]||_0x3bc4d2[_0x467813];if(!_0x2d0f74)for(const _0x4e0d4b in DEFAULT_TIMEOUTS){if(_0x467813[_0x3aaaf2(0x18d)](_0x4e0d4b)){_0x2d0f74=DEFAULT_TIMEOUTS[_0x4e0d4b];break;}}if(!_0x2d0f74&&_0x3bc4d2[_0x3aaaf2(0x16f)])_0x2d0f74=_0x3bc4d2[_0x3aaaf2(0x16f)];if(!_0x2d0f74)return;currentMonitoredRoom=_0x52512b,startTimer(_0x578ec1,_0x2d0f74);}}function startTimer(_0x55ab45,_0x20cecc){const _0x4d6c63=a2_0x4838ee;if(activeTimer)clearTimeout(activeTimer);timeoutMs=_0x20cecc*0x3c*0x3e8,startTime=Date[_0x4d6c63(0x187)](),alarmStage=0x0,_0x55ab45[_0x4d6c63(0x170)][_0x4d6c63(0x174)](_0x4d6c63(0x16e)+currentMonitoredRoom+_0x4d6c63(0x198)+_0x20cecc+_0x4d6c63(0x17b)),_0x55ab45[_0x4d6c63(0x181)](_0x4d6c63(0x195),{'val':'ok','ack':!![]}),activeTimer=setTimeout(()=>triggerPreWarn(_0x55ab45),timeoutMs);}function resetTimer(_0x463d48){const _0x486e3b=a2_0x4838ee;if(activeTimer)clearTimeout(activeTimer);activeTimer=null,currentMonitoredRoom=null,alarmStage=0x0,_0x463d48['setStateAsync'](_0x486e3b(0x195),{'val':'ok','ack':!![]});}function a2_0x1e78(){const _0x27258a=['alarm','analysis.topology.structure','\x20fÃ¼r\x20','constructor','error','sendNotification','ðŸ‘¼\x20Schutzengel:\x20Ãœberwache\x20','default','log','ðŸ‘¼\x20Schutzengel-Frage:\x20','ðŸš¨\x20NOTFALL-ALARM:\x20Person\x20reagiert\x20nicht\x20in\x20','analysis.safety.deadMan.config','info','toString','â³\x20ACHTUNG:\x20UngewÃ¶hnlich\x20lange\x20InaktivitÃ¤t\x20in\x20','apply','\x27.\x20Nicht\x20verbunden\x20mit\x20Ã¼berwachtem\x20\x27','Ignoriere\x20Bewegung\x20in\x20\x27','val','\x20Min.','getStateAsync','1778028PvwWBR','analysis.safety.deadMan.lastIgnored','./setup','toLowerCase','setStateAsync','115066KHJjhc','pre_warn','indexOf','\x20(Multi-Person\x20Filter)','(((.+)+)+)+$','now','search','parse','[DeadMan]\x20','analysis.safety.deadMan.active','6220cPmUht','includes','2161805SITlhj','24dzCSin','17893600xTJqrV','3391017LXEjOk','warn','exports','909420AFgSBO','analysis.safety.deadMan.alarmState'];a2_0x1e78=function(){return _0x27258a;};return a2_0x1e78();}function a2_0x3d24(_0x17252a,_0x3ffd03){const _0x50fb62=a2_0x1e78();return a2_0x3d24=function(_0x1f5bd1,_0x31a046){_0x1f5bd1=_0x1f5bd1-0x16c;let _0x1e788b=_0x50fb62[_0x1f5bd1];return _0x1e788b;},a2_0x3d24(_0x17252a,_0x3ffd03);}async function triggerPreWarn(_0x5ac674){const _0x16c392=a2_0x4838ee;alarmStage=0x1,await _0x5ac674['setStateAsync'](_0x16c392(0x195),{'val':_0x16c392(0x183),'ack':!![]});const _0x38a6d1=_0x16c392(0x176)+currentMonitoredRoom+'.\x20Alles\x20in\x20Ordnung?';_0x5ac674[_0x16c392(0x170)]['warn'](_0x16c392(0x18a)+_0x38a6d1),await setup[_0x16c392(0x16d)](_0x5ac674,_0x16c392(0x171)+_0x38a6d1),activeTimer=setTimeout(()=>triggerAlarm(_0x5ac674),0x5*0x3c*0x3e8);}async function triggerAlarm(_0x587e29){const _0x3183c5=a2_0x4838ee;alarmStage=0x2,await _0x587e29['setStateAsync'](_0x3183c5(0x195),{'val':_0x3183c5(0x196),'ack':!![]});const _0x22e29c=_0x3183c5(0x172)+currentMonitoredRoom+'!';_0x587e29[_0x3183c5(0x170)][_0x3183c5(0x16c)]('[DeadMan]\x20'+_0x22e29c),await setup['sendNotification'](_0x587e29,_0x22e29c,![],!![]);}module[a2_0x4838ee(0x193)]={'updateLocation':updateLocation};