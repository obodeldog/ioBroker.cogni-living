const a2_0x16ac57=a2_0x376d;function a2_0x376d(_0x51fa48,_0x188a7d){const _0x5d28e9=a2_0x406a();return a2_0x376d=function(_0x2262ea,_0x2e6fc6){_0x2262ea=_0x2262ea-0x193;let _0x406a77=_0x5d28e9[_0x2262ea];return _0x406a77;},a2_0x376d(_0x51fa48,_0x188a7d);}(function(_0x91461c,_0x105b07){const _0x116a00=a2_0x376d,_0x76fff2=_0x91461c();while(!![]){try{const _0x4adbe5=parseInt(_0x116a00(0x1bd))/0x1*(parseInt(_0x116a00(0x1c3))/0x2)+parseInt(_0x116a00(0x1b9))/0x3*(-parseInt(_0x116a00(0x197))/0x4)+parseInt(_0x116a00(0x198))/0x5*(parseInt(_0x116a00(0x1c4))/0x6)+parseInt(_0x116a00(0x1b6))/0x7+parseInt(_0x116a00(0x19b))/0x8+parseInt(_0x116a00(0x1c7))/0x9+-parseInt(_0x116a00(0x19a))/0xa*(parseInt(_0x116a00(0x1a5))/0xb);if(_0x4adbe5===_0x105b07)break;else _0x76fff2['push'](_0x76fff2['shift']());}catch(_0x10bb16){_0x76fff2['push'](_0x76fff2['shift']());}}}(a2_0x406a,0x789ca));const a2_0x2e6fc6=(function(){let _0x513889=!![];return function(_0x408d8b,_0x316f12){const _0x19ead9=_0x513889?function(){const _0xc4c154=a2_0x376d;if(_0x316f12){const _0x4efc1c=_0x316f12[_0xc4c154(0x194)](_0x408d8b,arguments);return _0x316f12=null,_0x4efc1c;}}:function(){};return _0x513889=![],_0x19ead9;};}()),a2_0x2262ea=a2_0x2e6fc6(this,function(){const _0x5f385b=a2_0x376d;return a2_0x2262ea['toString']()[_0x5f385b(0x1b2)](_0x5f385b(0x1b7))['toString']()[_0x5f385b(0x1c1)](a2_0x2262ea)[_0x5f385b(0x1b2)](_0x5f385b(0x1b7));});a2_0x2262ea();'use strict';const setup=require(a2_0x16ac57(0x1a0));let activeTimer=null,currentMonitoredRoom=null,timeoutMs=0x0,startTime=0x0,alarmStage=0x0;const DEFAULT_TIMEOUTS={'bad':0x2d,'bath':0x2d,'toilet':0x1e,'wc':0x1e,'keller':0x3c,'schlaf':0x78,'bed':0x78,'guest':0x5a,'gast':0x5a};function getTimeoutRobust(_0x4d1218,_0x4b6c8b){const _0x150b98=a2_0x16ac57;if(!_0x4d1218||!_0x4b6c8b)return undefined;if(_0x4d1218[_0x4b6c8b])return _0x4d1218[_0x4b6c8b];const _0x46ffb8=_0x4b6c8b[_0x150b98(0x19c)]()['replace'](/[^a-z0-9]/g,'');for(const _0x4c55cd in _0x4d1218){const _0x47d622=_0x4c55cd[_0x150b98(0x19c)]()[_0x150b98(0x1b1)](/[^a-z0-9]/g,'');if(_0x47d622===_0x46ffb8)return _0x4d1218[_0x4c55cd];}const _0x2136a7=_0x4b6c8b[_0x150b98(0x19c)]();if(_0x4d1218[_0x2136a7])return _0x4d1218[_0x2136a7];return undefined;}async function loadConfig(_0x45e9ae){const _0xbd7da8=a2_0x16ac57;try{const _0x4c56ae=await _0x45e9ae[_0xbd7da8(0x1a3)](_0xbd7da8(0x1bc));if(_0x4c56ae&&_0x4c56ae['val'])return JSON['parse'](_0x4c56ae[_0xbd7da8(0x1bb)]);}catch(_0x5f0c96){}return{};}async function isActive(_0x169c86){const _0x2a20ea=a2_0x16ac57;try{const _0x54d3a8=await _0x169c86[_0x2a20ea(0x1a3)](_0x2a20ea(0x1c6));return _0x54d3a8&&_0x54d3a8[_0x2a20ea(0x1bb)];}catch(_0x182779){return![];}}async function areRoomsConnected(_0x279eab,_0x5102b6,_0x183a65){const _0x12cc58=a2_0x16ac57;try{const _0x2fbc42=await _0x279eab[_0x12cc58(0x1a3)](_0x12cc58(0x193));if(!_0x2fbc42||!_0x2fbc42['val'])return!![];const _0x5841b5=JSON['parse'](_0x2fbc42[_0x12cc58(0x1bb)]),{rooms:_0x310344,matrix:_0x329cd8}=_0x5841b5;if(!_0x310344||!_0x329cd8)return!![];const _0x55a568=_0x310344['indexOf'](_0x5102b6),_0xf2723e=_0x310344[_0x12cc58(0x1af)](_0x183a65);if(_0x55a568===-0x1||_0xf2723e===-0x1)return!![];const _0xdfe97a=_0x329cd8[_0x55a568][_0xf2723e]>0x0||_0x329cd8[_0xf2723e][_0x55a568]>0x0;return _0xdfe97a;}catch(_0xcccdb6){return _0x279eab[_0x12cc58(0x1b0)]['warn'](_0x12cc58(0x1ae)+_0xcccdb6['message']),!![];}}function calculateSleepProbability(_0x597edf){const _0x9a6486=a2_0x16ac57,_0x4c7d6d=new Date(),_0x441dc9=_0x4c7d6d[_0x9a6486(0x1a2)](),_0x177c00=_0x597edf['toLowerCase']();let _0x50a3af=0.1;if(_0x441dc9>=0x17||_0x441dc9<=0x6)_0x50a3af=0x1;else{if(_0x441dc9>=0xd&&_0x441dc9<=0xf)_0x50a3af=0.8;else{if(_0x441dc9>=0x14&&_0x441dc9<=0x17)_0x50a3af=0.4;}}let _0x54d659=0.1;if(_0x177c00[_0x9a6486(0x1ac)]('schlaf')||_0x177c00['includes'](_0x9a6486(0x1c8)))_0x54d659=0x1;else{if(_0x177c00[_0x9a6486(0x1ac)](_0x9a6486(0x19e))||_0x177c00[_0x9a6486(0x1ac)](_0x9a6486(0x1a6))||_0x177c00[_0x9a6486(0x1ac)](_0x9a6486(0x1c5)))_0x54d659=0.6;else{if(_0x177c00[_0x9a6486(0x1ac)](_0x9a6486(0x1a7))||_0x177c00['includes']('wc'))_0x54d659=0.05;}}let _0x177d31=0.5;const _0x2f5469=_0x54d659*0.5+_0x50a3af*0.3+_0x177d31*0.2;return parseFloat(_0x2f5469['toFixed'](0x2));}async function updateLocation(_0x21a88d,_0x2e10fc){const _0xf64a4d=a2_0x16ac57;if(!_0x2e10fc||_0x2e10fc==='Unknown')return;if(!await isActive(_0x21a88d)){resetTimer(_0x21a88d);return;}if(currentMonitoredRoom&&currentMonitoredRoom!==_0x2e10fc){const _0x529ebb=await areRoomsConnected(_0x21a88d,currentMonitoredRoom,_0x2e10fc);if(!_0x529ebb){const _0x388485=_0xf64a4d(0x1b4)+_0x2e10fc+_0xf64a4d(0x1a8)+currentMonitoredRoom+'\x27.';_0x21a88d[_0xf64a4d(0x1b0)][_0xf64a4d(0x1c2)](_0xf64a4d(0x195)+_0x388485+_0xf64a4d(0x1c0)),await _0x21a88d[_0xf64a4d(0x1ba)]('analysis.safety.deadMan.lastIgnored',{'val':JSON[_0xf64a4d(0x1b5)]({'room':_0x2e10fc,'reason':_0x388485,'timestamp':Date[_0xf64a4d(0x1a9)]()}),'ack':!![]});return;}resetTimer(_0x21a88d);}if(!currentMonitoredRoom){await _0x21a88d[_0xf64a4d(0x1ba)](_0xf64a4d(0x1ca),{'val':_0x2e10fc,'ack':!![]});const _0x354815=await loadConfig(_0x21a88d);let _0x6d152c=getTimeoutRobust(_0x354815,_0x2e10fc);const _0x5433db=_0x2e10fc['toLowerCase']();if(!_0x6d152c)for(const _0x33ef3b in DEFAULT_TIMEOUTS){if(_0x5433db[_0xf64a4d(0x1ac)](_0x33ef3b)){_0x6d152c=DEFAULT_TIMEOUTS[_0x33ef3b];break;}}if(!_0x6d152c&&_0x354815[_0xf64a4d(0x19f)])_0x6d152c=_0x354815[_0xf64a4d(0x19f)];if(!_0x6d152c)return;currentMonitoredRoom=_0x2e10fc,startTimer(_0x21a88d,_0x6d152c,_0x2e10fc);}}function startTimer(_0x4a1ddd,_0x3b66b6,_0x44db7e){const _0x14d7da=a2_0x16ac57;if(activeTimer)clearTimeout(activeTimer);timeoutMs=_0x3b66b6*0x3c*0x3e8,startTime=Date[_0x14d7da(0x1a9)](),alarmStage=0x0;const _0x37b473=calculateSleepProbability(_0x44db7e||currentMonitoredRoom),_0x5a5393=_0x37b473>0.65;_0x5a5393?(timeoutMs+=0x5a*0x3c*0x3e8,_0x4a1ddd[_0x14d7da(0x1b0)][_0x14d7da(0x1c2)]('üí§\x20Smart\x20Sleep\x20erkannt\x20('+(_0x37b473*0x64)[_0x14d7da(0x1cb)](0x0)+_0x14d7da(0x1bf)+currentMonitoredRoom+'\x20um\x2090\x20Min.'),_0x4a1ddd[_0x14d7da(0x1ba)]('analysis.safety.deadMan.smartSleep',{'val':!![],'ack':!![]})):_0x4a1ddd[_0x14d7da(0x1ba)](_0x14d7da(0x1ad),{'val':![],'ack':!![]}),_0x4a1ddd[_0x14d7da(0x1ba)]('analysis.safety.deadMan.napProbability',{'val':_0x37b473,'ack':!![]}),_0x4a1ddd['log']['info'](_0x14d7da(0x196)+currentMonitoredRoom+_0x14d7da(0x1b3)+_0x3b66b6+_0x14d7da(0x1be)),_0x4a1ddd[_0x14d7da(0x1ba)](_0x14d7da(0x1c9),{'val':'ok','ack':!![]}),activeTimer=setTimeout(()=>triggerPreWarn(_0x4a1ddd),timeoutMs);}function resetTimer(_0xb9a7c8){const _0x38d048=a2_0x16ac57;if(activeTimer)clearTimeout(activeTimer);activeTimer=null,currentMonitoredRoom=null,alarmStage=0x0,_0xb9a7c8[_0x38d048(0x1ba)]('analysis.safety.deadMan.alarmState',{'val':'ok','ack':!![]}),_0xb9a7c8['setStateAsync'](_0x38d048(0x1ad),{'val':![],'ack':!![]}),_0xb9a7c8['setStateAsync'](_0x38d048(0x1aa),{'val':0x0,'ack':!![]});}async function triggerPreWarn(_0x1ac1ee){const _0x558ccd=a2_0x16ac57;alarmStage=0x1,await _0x1ac1ee['setStateAsync'](_0x558ccd(0x1c9),{'val':_0x558ccd(0x199),'ack':!![]});const _0xa776d5=_0x558ccd(0x1a1)+currentMonitoredRoom+'.\x20Alles\x20in\x20Ordnung?';_0x1ac1ee[_0x558ccd(0x1b0)][_0x558ccd(0x19d)]('[DeadMan]\x20'+_0xa776d5),await setup[_0x558ccd(0x1b8)](_0x1ac1ee,_0x558ccd(0x1a4)+_0xa776d5),activeTimer=setTimeout(()=>triggerAlarm(_0x1ac1ee),0x5*0x3c*0x3e8);}function a2_0x406a(){const _0x21dc43=['\x20f√ºr\x20','Ignoriere\x20Bewegung\x20in\x20\x27','stringify','390943OlVdjB','(((.+)+)+)+$','sendNotification','12063ACyWew','setStateAsync','val','analysis.safety.deadMan.config','5yBmBFW','\x20Min.','%).\x20Verl√§ngere\x20Timer\x20f√ºr\x20','\x20(Multi-Person\x20Filter)','constructor','info','74086daxwqr','834eDIbpd','sofa','analysis.safety.deadMan.active','1468197fEpVmZ','bed','analysis.safety.deadMan.alarmState','analysis.safety.deadMan.currentRoom','toFixed','analysis.topology.structure','apply','[DeadMan]\x20','üëº\x20Schutzengel:\x20√úberwache\x20','548OdFmrK','32385qbbkHp','pre_warn','1209950lGIWvs','3730984NSuaRe','toLowerCase','warn','wohn','default','./setup','‚è≥\x20ACHTUNG:\x20Ungew√∂hnlich\x20lange\x20Inaktivit√§t\x20in\x20','getHours','getStateAsync','üëº\x20Schutzengel-Frage:\x20','66RyriGf','living','bad','\x27.\x20Nicht\x20verbunden\x20mit\x20√ºberwachtem\x20\x27','now','analysis.safety.deadMan.napProbability','error','includes','analysis.safety.deadMan.smartSleep','[DeadMan]\x20Topology\x20check\x20failed:\x20','indexOf','log','replace','search'];a2_0x406a=function(){return _0x21dc43;};return a2_0x406a();}async function triggerAlarm(_0x55f9d5){const _0x3ae247=a2_0x16ac57;alarmStage=0x2,await _0x55f9d5[_0x3ae247(0x1ba)](_0x3ae247(0x1c9),{'val':'alarm','ack':!![]});const _0x4a65ae='üö®\x20NOTFALL-ALARM:\x20Person\x20reagiert\x20nicht\x20in\x20'+currentMonitoredRoom+'!';_0x55f9d5[_0x3ae247(0x1b0)][_0x3ae247(0x1ab)](_0x3ae247(0x195)+_0x4a65ae),await setup[_0x3ae247(0x1b8)](_0x55f9d5,_0x4a65ae,![],!![]);}module['exports']={'updateLocation':updateLocation};