const a2_0x4a9958=a2_0x99f5;(function(_0x9add63,_0x5e5c35){const _0x3e92bf=a2_0x99f5,_0x575a1e=_0x9add63();while(!![]){try{const _0x404931=parseInt(_0x3e92bf(0x200))/0x1*(parseInt(_0x3e92bf(0x201))/0x2)+-parseInt(_0x3e92bf(0x206))/0x3*(parseInt(_0x3e92bf(0x210))/0x4)+-parseInt(_0x3e92bf(0x209))/0x5+-parseInt(_0x3e92bf(0x1fe))/0x6*(-parseInt(_0x3e92bf(0x208))/0x7)+-parseInt(_0x3e92bf(0x1f5))/0x8+-parseInt(_0x3e92bf(0x1f8))/0x9*(-parseInt(_0x3e92bf(0x216))/0xa)+parseInt(_0x3e92bf(0x1fc))/0xb*(-parseInt(_0x3e92bf(0x21a))/0xc);if(_0x404931===_0x5e5c35)break;else _0x575a1e['push'](_0x575a1e['shift']());}catch(_0x3835ad){_0x575a1e['push'](_0x575a1e['shift']());}}}(a2_0x5df4,0x4b028));const a2_0x4f6512=(function(){let _0x11476a=!![];return function(_0x4b45d4,_0x327356){const _0x19efc1=_0x11476a?function(){const _0x9c788a=a2_0x99f5;if(_0x327356){const _0x365c8d=_0x327356[_0x9c788a(0x212)](_0x4b45d4,arguments);return _0x327356=null,_0x365c8d;}}:function(){};return _0x11476a=![],_0x19efc1;};}()),a2_0x183b54=a2_0x4f6512(this,function(){const _0x92f43a=a2_0x99f5;return a2_0x183b54['toString']()[_0x92f43a(0x21d)]('(((.+)+)+)+$')[_0x92f43a(0x20d)]()[_0x92f43a(0x21b)](a2_0x183b54)[_0x92f43a(0x21d)]('(((.+)+)+)+$');});a2_0x183b54();'use strict';const setup=require(a2_0x4a9958(0x1f9));function a2_0x5df4(){const _0x3816b5=['toString','indexOf','warn','604OGPxFu','error','apply','setStateAsync','\x20fÃ¼r\x20','default','5717490GUNPJZ','analysis.safety.deadMan.active','alarm','parse','156VxuLfF','constructor','\x20Min.','search','exports','ðŸ‘¼\x20Schutzengel-Frage:\x20','message','toLowerCase','ðŸ‘¼\x20Schutzengel:\x20Ãœberwache\x20','analysis.safety.deadMan.alarmState','.\x20Alles\x20in\x20Ordnung?','analysis.safety.deadMan.lastIgnored','includes','analysis.safety.deadMan.currentRoom','2677712vconBw','[DeadMan]\x20','\x20(Multi-Person\x20Filter)','9LAjwoT','./setup','stringify','ðŸš¨\x20NOTFALL-ALARM:\x20Person\x20reagiert\x20nicht\x20in\x20','362494PrvDVg','info','852966RTmoJV','pre_warn','11eeNfGe','107988IKKPUc','analysis.topology.structure','[DeadMan]\x20Topology\x20check\x20failed:\x20','Ignoriere\x20Bewegung\x20in\x20\x27','val','3282NlDPfN','sendNotification','21PwSjip','1783080crDfzi','â³\x20ACHTUNG:\x20UngewÃ¶hnlich\x20lange\x20InaktivitÃ¤t\x20in\x20','getStateAsync','log'];a2_0x5df4=function(){return _0x3816b5;};return a2_0x5df4();}let activeTimer=null,currentMonitoredRoom=null,timeoutMs=0x0,startTime=0x0,alarmStage=0x0;const DEFAULT_TIMEOUTS={'bad':0x2d,'bath':0x2d,'toilet':0x1e,'wc':0x1e,'keller':0x3c};async function loadConfig(_0x1d2323){const _0x2accfb=a2_0x4a9958;try{const _0x24579f=await _0x1d2323['getStateAsync']('analysis.safety.deadMan.config');if(_0x24579f&&_0x24579f['val'])return JSON[_0x2accfb(0x219)](_0x24579f['val']);}catch(_0x4150f0){}return{};}async function isActive(_0x54f899){const _0x568300=a2_0x4a9958;try{const _0x3bc1fa=await _0x54f899[_0x568300(0x20b)](_0x568300(0x217));return _0x3bc1fa&&_0x3bc1fa[_0x568300(0x205)];}catch(_0x224f3c){return![];}}async function areRoomsConnected(_0x347fbf,_0x17f77f,_0x2b16f8){const _0x1cd886=a2_0x4a9958;try{const _0x451492=await _0x347fbf[_0x1cd886(0x20b)](_0x1cd886(0x202));if(!_0x451492||!_0x451492[_0x1cd886(0x205)])return!![];const _0x177e1a=JSON[_0x1cd886(0x219)](_0x451492[_0x1cd886(0x205)]),{rooms:_0x13cda4,matrix:_0x21460f}=_0x177e1a;if(!_0x13cda4||!_0x21460f)return!![];const _0x32890=_0x13cda4[_0x1cd886(0x20e)](_0x17f77f),_0x14c9db=_0x13cda4[_0x1cd886(0x20e)](_0x2b16f8);if(_0x32890===-0x1||_0x14c9db===-0x1)return!![];const _0x237197=_0x21460f[_0x32890][_0x14c9db]>0x0||_0x21460f[_0x14c9db][_0x32890]>0x0;return _0x237197;}catch(_0xe6a9b5){return _0x347fbf['log']['warn'](_0x1cd886(0x203)+_0xe6a9b5[_0x1cd886(0x220)]),!![];}}function a2_0x99f5(_0xcd1635,_0x54861c){const _0x1634ca=a2_0x5df4();return a2_0x99f5=function(_0x183b54,_0x4f6512){_0x183b54=_0x183b54-0x1ef;let _0x5df4cc=_0x1634ca[_0x183b54];return _0x5df4cc;},a2_0x99f5(_0xcd1635,_0x54861c);}async function updateLocation(_0x3d23ab,_0x2c09eb){const _0x1036f9=a2_0x4a9958;if(!_0x2c09eb||_0x2c09eb==='Unknown')return;if(!await isActive(_0x3d23ab)){resetTimer(_0x3d23ab);return;}if(currentMonitoredRoom&&currentMonitoredRoom!==_0x2c09eb){const _0x54b98d=await areRoomsConnected(_0x3d23ab,currentMonitoredRoom,_0x2c09eb);if(!_0x54b98d){const _0x3d858a=_0x1036f9(0x204)+_0x2c09eb+'\x27.\x20Nicht\x20verbunden\x20mit\x20Ã¼berwachtem\x20\x27'+currentMonitoredRoom+'\x27.';_0x3d23ab[_0x1036f9(0x20c)][_0x1036f9(0x1fd)](_0x1036f9(0x1f6)+_0x3d858a+_0x1036f9(0x1f7)),await _0x3d23ab[_0x1036f9(0x213)](_0x1036f9(0x1f2),{'val':JSON[_0x1036f9(0x1fa)]({'room':_0x2c09eb,'reason':_0x3d858a,'timestamp':Date['now']()}),'ack':!![]});return;}resetTimer(_0x3d23ab);}if(!currentMonitoredRoom){await _0x3d23ab[_0x1036f9(0x213)](_0x1036f9(0x1f4),{'val':_0x2c09eb,'ack':!![]});const _0x1333b5=await loadConfig(_0x3d23ab),_0x5696d1=_0x2c09eb[_0x1036f9(0x221)]();let _0x24eda7=_0x1333b5[_0x2c09eb]||_0x1333b5[_0x5696d1];if(!_0x24eda7)for(const _0x420123 in DEFAULT_TIMEOUTS){if(_0x5696d1[_0x1036f9(0x1f3)](_0x420123)){_0x24eda7=DEFAULT_TIMEOUTS[_0x420123];break;}}if(!_0x24eda7&&_0x1333b5[_0x1036f9(0x215)])_0x24eda7=_0x1333b5['default'];if(!_0x24eda7)return;currentMonitoredRoom=_0x2c09eb,startTimer(_0x3d23ab,_0x24eda7);}}function startTimer(_0x1db309,_0xff9aad){const _0x1bb175=a2_0x4a9958;if(activeTimer)clearTimeout(activeTimer);timeoutMs=_0xff9aad*0x3c*0x3e8,startTime=Date['now'](),alarmStage=0x0,_0x1db309[_0x1bb175(0x20c)][_0x1bb175(0x1fd)](_0x1bb175(0x1ef)+currentMonitoredRoom+_0x1bb175(0x214)+_0xff9aad+_0x1bb175(0x21c)),_0x1db309['setStateAsync']('analysis.safety.deadMan.alarmState',{'val':'ok','ack':!![]}),activeTimer=setTimeout(()=>triggerPreWarn(_0x1db309),timeoutMs);}function resetTimer(_0x4f221e){const _0x10220f=a2_0x4a9958;if(activeTimer)clearTimeout(activeTimer);activeTimer=null,currentMonitoredRoom=null,alarmStage=0x0,_0x4f221e[_0x10220f(0x213)]('analysis.safety.deadMan.alarmState',{'val':'ok','ack':!![]});}async function triggerPreWarn(_0x58f3d8){const _0x2e3060=a2_0x4a9958;alarmStage=0x1,await _0x58f3d8['setStateAsync'](_0x2e3060(0x1f0),{'val':_0x2e3060(0x1ff),'ack':!![]});const _0x396c24=_0x2e3060(0x20a)+currentMonitoredRoom+_0x2e3060(0x1f1);_0x58f3d8[_0x2e3060(0x20c)][_0x2e3060(0x20f)](_0x2e3060(0x1f6)+_0x396c24),await setup['sendNotification'](_0x58f3d8,_0x2e3060(0x21f)+_0x396c24),activeTimer=setTimeout(()=>triggerAlarm(_0x58f3d8),0x5*0x3c*0x3e8);}async function triggerAlarm(_0x101ec5){const _0xcb1f7=a2_0x4a9958;alarmStage=0x2,await _0x101ec5['setStateAsync'](_0xcb1f7(0x1f0),{'val':_0xcb1f7(0x218),'ack':!![]});const _0x364b31=_0xcb1f7(0x1fb)+currentMonitoredRoom+'!';_0x101ec5[_0xcb1f7(0x20c)][_0xcb1f7(0x211)](_0xcb1f7(0x1f6)+_0x364b31),await setup[_0xcb1f7(0x207)](_0x101ec5,_0x364b31,![],!![]);}module[a2_0x4a9958(0x21e)]={'updateLocation':updateLocation};