const a2_0x1ff7bf=a2_0x252d;(function(_0x56ad02,_0x51b997){const _0x4c3ac8=a2_0x252d,_0x44be68=_0x56ad02();while(!![]){try{const _0x2415c9=-parseInt(_0x4c3ac8(0x159))/0x1+-parseInt(_0x4c3ac8(0x148))/0x2*(-parseInt(_0x4c3ac8(0x150))/0x3)+parseInt(_0x4c3ac8(0x152))/0x4+-parseInt(_0x4c3ac8(0x161))/0x5+-parseInt(_0x4c3ac8(0x14b))/0x6*(parseInt(_0x4c3ac8(0x13f))/0x7)+parseInt(_0x4c3ac8(0x137))/0x8+parseInt(_0x4c3ac8(0x13b))/0x9;if(_0x2415c9===_0x51b997)break;else _0x44be68['push'](_0x44be68['shift']());}catch(_0x1e5754){_0x44be68['push'](_0x44be68['shift']());}}}(a2_0x5f00,0xb73fb));const a2_0x3bb389=(function(){let _0x4218c1=!![];return function(_0xc404ea,_0x4fa8ff){const _0x170e7a=_0x4218c1?function(){if(_0x4fa8ff){const _0x4af018=_0x4fa8ff['apply'](_0xc404ea,arguments);return _0x4fa8ff=null,_0x4af018;}}:function(){};return _0x4218c1=![],_0x170e7a;};}()),a2_0x542b3e=a2_0x3bb389(this,function(){const _0x24f5e2=a2_0x252d;return a2_0x542b3e['toString']()[_0x24f5e2(0x153)](_0x24f5e2(0x16b))[_0x24f5e2(0x144)]()[_0x24f5e2(0x14a)](a2_0x542b3e)[_0x24f5e2(0x153)](_0x24f5e2(0x16b));});a2_0x542b3e();'use strict';const setup=require(a2_0x1ff7bf(0x157));let activeTimer=null,currentMonitoredRoom=null,timeoutMs=0x0,startTime=0x0,alarmStage=0x0;const DEFAULT_TIMEOUTS={'bad':0x2d,'bath':0x2d,'toilet':0x1e,'wc':0x1e,'keller':0x3c,'schlaf':0x78,'bed':0x78,'guest':0x5a,'gast':0x5a};function a2_0x252d(_0x1275eb,_0x274d57){const _0x359097=a2_0x5f00();return a2_0x252d=function(_0x542b3e,_0x3bb389){_0x542b3e=_0x542b3e-0x134;let _0x5f007c=_0x359097[_0x542b3e];return _0x5f007c;},a2_0x252d(_0x1275eb,_0x274d57);}function getTimeoutRobust(_0x240e71,_0x376e92){const _0x5eb270=a2_0x1ff7bf;if(!_0x240e71||!_0x376e92)return undefined;if(_0x240e71[_0x376e92])return _0x240e71[_0x376e92];const _0x3a3471=_0x376e92['toLowerCase']()['replace'](/[^a-z0-9]/g,'');for(const _0x566dbf in _0x240e71){const _0x2cc4db=_0x566dbf[_0x5eb270(0x145)]()[_0x5eb270(0x138)](/[^a-z0-9]/g,'');if(_0x2cc4db===_0x3a3471)return _0x240e71[_0x566dbf];}const _0x2bff7f=_0x376e92['toLowerCase']();if(_0x240e71[_0x2bff7f])return _0x240e71[_0x2bff7f];return undefined;}async function loadConfig(_0x5b8edc){const _0x439b03=a2_0x1ff7bf;try{const _0x420f16=await _0x5b8edc[_0x439b03(0x147)](_0x439b03(0x162));if(_0x420f16&&_0x420f16[_0x439b03(0x16a)])return JSON[_0x439b03(0x164)](_0x420f16[_0x439b03(0x16a)]);}catch(_0x33212a){}return{};}async function isActive(_0x2cc6e9){const _0x51490b=a2_0x1ff7bf;try{const _0x1ea90e=await _0x2cc6e9['getStateAsync'](_0x51490b(0x166));return _0x1ea90e&&_0x1ea90e[_0x51490b(0x16a)];}catch(_0x2b1c50){return![];}}async function areRoomsConnected(_0x568d33,_0x5d605e,_0x299068){const _0x27b2b9=a2_0x1ff7bf;try{const _0x5a60f5=await _0x568d33[_0x27b2b9(0x147)](_0x27b2b9(0x151));if(!_0x5a60f5||!_0x5a60f5[_0x27b2b9(0x16a)])return!![];const _0x5c530a=JSON['parse'](_0x5a60f5[_0x27b2b9(0x16a)]),{rooms:_0x1c1f63,matrix:_0x481e3a}=_0x5c530a;if(!_0x1c1f63||!_0x481e3a)return!![];const _0x228cf4=_0x1c1f63['indexOf'](_0x5d605e),_0x32cb2b=_0x1c1f63[_0x27b2b9(0x139)](_0x299068);if(_0x228cf4===-0x1||_0x32cb2b===-0x1)return!![];const _0x2ce0bb=_0x481e3a[_0x228cf4][_0x32cb2b]>0x0||_0x481e3a[_0x32cb2b][_0x228cf4]>0x0;return _0x2ce0bb;}catch(_0x491d85){return _0x568d33[_0x27b2b9(0x155)]['warn']('[DeadMan]\x20Topology\x20check\x20failed:\x20'+_0x491d85[_0x27b2b9(0x146)]),!![];}}function calculateSleepProbability(_0x46427b){const _0x1db81f=a2_0x1ff7bf,_0x461062=new Date(),_0x23fe25=_0x461062['getHours'](),_0x4c6ae0=_0x46427b[_0x1db81f(0x145)]();let _0x379e0b=0.1;if(_0x23fe25>=0x17||_0x23fe25<=0x6)_0x379e0b=0x1;else{if(_0x23fe25>=0xd&&_0x23fe25<=0xf)_0x379e0b=0.8;else{if(_0x23fe25>=0x14&&_0x23fe25<=0x17)_0x379e0b=0.4;}}let _0x3244f6=0.1;if(_0x4c6ae0['includes'](_0x1db81f(0x149))||_0x4c6ae0[_0x1db81f(0x143)](_0x1db81f(0x169)))_0x3244f6=0x1;else{if(_0x4c6ae0[_0x1db81f(0x143)](_0x1db81f(0x165))||_0x4c6ae0[_0x1db81f(0x143)](_0x1db81f(0x13a))||_0x4c6ae0['includes']('sofa'))_0x3244f6=0.6;else{if(_0x4c6ae0[_0x1db81f(0x143)](_0x1db81f(0x13d))||_0x4c6ae0['includes']('wc'))_0x3244f6=0.05;}}let _0x3d85e2=0.5;const _0x158b64=_0x3244f6*0.5+_0x379e0b*0.3+_0x3d85e2*0.2;return parseFloat(_0x158b64[_0x1db81f(0x141)](0x2));}function a2_0x5f00(){const _0xa0a9f8=['sendNotification','toFixed','analysis.safety.deadMan.smartSleep','includes','toString','toLowerCase','message','getStateAsync','2gOrjio','schlaf','constructor','6GFODEc','exports','\x20Min.','Ignoriere\x20Bewegung\x20in\x20\x27','error','238137UaxZCu','analysis.topology.structure','4590620CRhRiI','search','default','log','\x20um\x2090\x20Min.','./setup','pre_warn','1256083NRabpj','â³\x20ACHTUNG:\x20UngewÃ¶hnlich\x20lange\x20InaktivitÃ¤t\x20in\x20','.\x20Alles\x20in\x20Ordnung?','ðŸ‘¼\x20Schutzengel-Frage:\x20','alarm','setStateAsync','stringify','warn','4345970aFOCIk','analysis.safety.deadMan.config','analysis.safety.deadMan.currentRoom','parse','wohn','analysis.safety.deadMan.active','\x20(Multi-Person\x20Filter)','analysis.safety.deadMan.lastIgnored','bed','val','(((.+)+)+)+$','info','%).\x20VerlÃ¤ngere\x20Timer\x20fÃ¼r\x20','\x20fÃ¼r\x20','now','10612864eZGxPS','replace','indexOf','living','3714633TCHwhX','analysis.safety.deadMan.alarmState','bad','[DeadMan]\x20','633605CgQqcP'];a2_0x5f00=function(){return _0xa0a9f8;};return a2_0x5f00();}async function updateLocation(_0x50bbe0,_0x436bf7){const _0x29ca23=a2_0x1ff7bf;if(!_0x436bf7||_0x436bf7==='Unknown')return;if(!await isActive(_0x50bbe0)){resetTimer(_0x50bbe0);return;}if(currentMonitoredRoom&&currentMonitoredRoom!==_0x436bf7){const _0xecd5cc=await areRoomsConnected(_0x50bbe0,currentMonitoredRoom,_0x436bf7);if(!_0xecd5cc){const _0x930784=_0x29ca23(0x14e)+_0x436bf7+'\x27.\x20Nicht\x20verbunden\x20mit\x20Ã¼berwachtem\x20\x27'+currentMonitoredRoom+'\x27.';_0x50bbe0[_0x29ca23(0x155)][_0x29ca23(0x16c)]('[DeadMan]\x20'+_0x930784+_0x29ca23(0x167)),await _0x50bbe0['setStateAsync'](_0x29ca23(0x168),{'val':JSON[_0x29ca23(0x15f)]({'room':_0x436bf7,'reason':_0x930784,'timestamp':Date[_0x29ca23(0x136)]()}),'ack':!![]});return;}resetTimer(_0x50bbe0);}if(!currentMonitoredRoom){await _0x50bbe0[_0x29ca23(0x15e)](_0x29ca23(0x163),{'val':_0x436bf7,'ack':!![]});const _0xdd8488=await loadConfig(_0x50bbe0);let _0xc407dc=getTimeoutRobust(_0xdd8488,_0x436bf7);const _0x925ac3=_0x436bf7[_0x29ca23(0x145)]();if(!_0xc407dc)for(const _0xb6c5a5 in DEFAULT_TIMEOUTS){if(_0x925ac3[_0x29ca23(0x143)](_0xb6c5a5)){_0xc407dc=DEFAULT_TIMEOUTS[_0xb6c5a5];break;}}if(!_0xc407dc&&_0xdd8488[_0x29ca23(0x154)])_0xc407dc=_0xdd8488[_0x29ca23(0x154)];if(!_0xc407dc)return;currentMonitoredRoom=_0x436bf7,startTimer(_0x50bbe0,_0xc407dc,_0x436bf7);}}function startTimer(_0x31aec7,_0x2fcded,_0x106d68){const _0x3b1838=a2_0x1ff7bf;if(activeTimer)clearTimeout(activeTimer);timeoutMs=_0x2fcded*0x3c*0x3e8,startTime=Date[_0x3b1838(0x136)](),alarmStage=0x0;const _0x475694=calculateSleepProbability(_0x106d68||currentMonitoredRoom),_0xaaf765=_0x475694>0.65;_0xaaf765?(timeoutMs+=0x5a*0x3c*0x3e8,_0x31aec7[_0x3b1838(0x155)][_0x3b1838(0x16c)]('ðŸ’¤\x20Smart\x20Sleep\x20erkannt\x20('+(_0x475694*0x64)[_0x3b1838(0x141)](0x0)+_0x3b1838(0x134)+currentMonitoredRoom+_0x3b1838(0x156)),_0x31aec7[_0x3b1838(0x15e)](_0x3b1838(0x142),{'val':!![],'ack':!![]})):_0x31aec7[_0x3b1838(0x15e)]('analysis.safety.deadMan.smartSleep',{'val':![],'ack':!![]}),_0x31aec7[_0x3b1838(0x15e)]('analysis.safety.deadMan.napProbability',{'val':_0x475694,'ack':!![]}),_0x31aec7[_0x3b1838(0x155)]['info']('ðŸ‘¼\x20Schutzengel:\x20Ãœberwache\x20'+currentMonitoredRoom+_0x3b1838(0x135)+_0x2fcded+_0x3b1838(0x14d)),_0x31aec7[_0x3b1838(0x15e)]('analysis.safety.deadMan.alarmState',{'val':'ok','ack':!![]}),activeTimer=setTimeout(()=>triggerPreWarn(_0x31aec7),timeoutMs);}function resetTimer(_0x428e5a){const _0x3656b7=a2_0x1ff7bf;if(activeTimer)clearTimeout(activeTimer);activeTimer=null,currentMonitoredRoom=null,alarmStage=0x0,_0x428e5a[_0x3656b7(0x15e)]('analysis.safety.deadMan.alarmState',{'val':'ok','ack':!![]}),_0x428e5a[_0x3656b7(0x15e)]('analysis.safety.deadMan.smartSleep',{'val':![],'ack':!![]}),_0x428e5a[_0x3656b7(0x15e)]('analysis.safety.deadMan.napProbability',{'val':0x0,'ack':!![]});}async function triggerPreWarn(_0x1daf08){const _0x56d045=a2_0x1ff7bf;alarmStage=0x1,await _0x1daf08[_0x56d045(0x15e)](_0x56d045(0x13c),{'val':_0x56d045(0x158),'ack':!![]});const _0x2cf887=_0x56d045(0x15a)+currentMonitoredRoom+_0x56d045(0x15b);_0x1daf08[_0x56d045(0x155)][_0x56d045(0x160)]('[DeadMan]\x20'+_0x2cf887),await setup[_0x56d045(0x140)](_0x1daf08,_0x56d045(0x15c)+_0x2cf887),activeTimer=setTimeout(()=>triggerAlarm(_0x1daf08),0x5*0x3c*0x3e8);}async function triggerAlarm(_0x41024b){const _0x1401c3=a2_0x1ff7bf;alarmStage=0x2,await _0x41024b[_0x1401c3(0x15e)]('analysis.safety.deadMan.alarmState',{'val':_0x1401c3(0x15d),'ack':!![]});const _0xf1d2ae='ðŸš¨\x20NOTFALL-ALARM:\x20Person\x20reagiert\x20nicht\x20in\x20'+currentMonitoredRoom+'!';_0x41024b[_0x1401c3(0x155)][_0x1401c3(0x14f)](_0x1401c3(0x13e)+_0xf1d2ae),await setup['sendNotification'](_0x41024b,_0xf1d2ae,![],!![]);}module[a2_0x1ff7bf(0x14c)]={'updateLocation':updateLocation};