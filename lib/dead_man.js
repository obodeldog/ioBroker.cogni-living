const a2_0x378617=a2_0x1374;(function(_0x353bf1,_0x52d2b7){const _0xef13f5=a2_0x1374,_0xba174b=_0x353bf1();while(!![]){try{const _0x224b72=-parseInt(_0xef13f5(0x190))/0x1+parseInt(_0xef13f5(0x16e))/0x2+parseInt(_0xef13f5(0x15f))/0x3*(-parseInt(_0xef13f5(0x17a))/0x4)+-parseInt(_0xef13f5(0x166))/0x5*(parseInt(_0xef13f5(0x180))/0x6)+parseInt(_0xef13f5(0x18e))/0x7+-parseInt(_0xef13f5(0x179))/0x8*(-parseInt(_0xef13f5(0x191))/0x9)+-parseInt(_0xef13f5(0x177))/0xa;if(_0x224b72===_0x52d2b7)break;else _0xba174b['push'](_0xba174b['shift']());}catch(_0x1d6c60){_0xba174b['push'](_0xba174b['shift']());}}}(a2_0xc679,0xee3d3));const a2_0x59d9ba=(function(){let _0x42f2d3=!![];return function(_0x25faf9,_0x53fbba){const _0x33833d=_0x42f2d3?function(){const _0x26bf6f=a2_0x1374;if(_0x53fbba){const _0x1593b0=_0x53fbba[_0x26bf6f(0x18f)](_0x25faf9,arguments);return _0x53fbba=null,_0x1593b0;}}:function(){};return _0x42f2d3=![],_0x33833d;};}()),a2_0x339cc8=a2_0x59d9ba(this,function(){const _0x6e58bc=a2_0x1374;return a2_0x339cc8[_0x6e58bc(0x172)]()[_0x6e58bc(0x17e)](_0x6e58bc(0x181))['toString']()['constructor'](a2_0x339cc8)['search'](_0x6e58bc(0x181));});a2_0x339cc8();'use strict';const setup=require(a2_0x378617(0x169));let activeTimer=null,currentMonitoredRoom=null,timeoutMs=0x0,startTime=0x0,alarmStage=0x0;function a2_0x1374(_0x1a53f2,_0xd00b03){const _0x544fb7=a2_0xc679();return a2_0x1374=function(_0x339cc8,_0x59d9ba){_0x339cc8=_0x339cc8-0x15d;let _0xc679eb=_0x544fb7[_0x339cc8];return _0xc679eb;},a2_0x1374(_0x1a53f2,_0xd00b03);}const DEFAULT_TIMEOUTS={'bad':0x2d,'bath':0x2d,'toilet':0x1e,'wc':0x1e,'keller':0x3c,'schlaf':0x78,'bed':0x78,'guest':0x5a,'gast':0x5a};function getTimeoutRobust(_0x4b199d,_0x43c9f1){const _0x28e3cf=a2_0x378617;if(!_0x4b199d||!_0x43c9f1)return undefined;if(_0x4b199d[_0x43c9f1])return _0x4b199d[_0x43c9f1];const _0x22ea53=_0x43c9f1['toLowerCase']()['replace'](/[^a-z0-9]/g,'');for(const _0x1d1a26 in _0x4b199d){const _0x3c729b=_0x1d1a26[_0x28e3cf(0x189)]()[_0x28e3cf(0x18b)](/[^a-z0-9]/g,'');if(_0x3c729b===_0x22ea53)return _0x4b199d[_0x1d1a26];}const _0x1b16f5=_0x43c9f1[_0x28e3cf(0x189)]();if(_0x4b199d[_0x1b16f5])return _0x4b199d[_0x1b16f5];return undefined;}async function loadConfig(_0x49f927){const _0x4a3360=a2_0x378617;try{const _0x449564=await _0x49f927[_0x4a3360(0x182)]('analysis.safety.deadMan.config');if(_0x449564&&_0x449564[_0x4a3360(0x176)])return JSON[_0x4a3360(0x164)](_0x449564['val']);}catch(_0x111097){}return{};}async function isActive(_0x5a90da){const _0x441ba1=a2_0x378617;try{const _0x21003c=await _0x5a90da[_0x441ba1(0x182)]('analysis.safety.deadMan.active');return _0x21003c&&_0x21003c[_0x441ba1(0x176)];}catch(_0x1e76b7){return![];}}async function areRoomsConnected(_0x43afe4,_0xf749c9,_0x26a095){const _0x5aa313=a2_0x378617;try{const _0x516993=await _0x43afe4[_0x5aa313(0x182)](_0x5aa313(0x18c));if(!_0x516993||!_0x516993[_0x5aa313(0x176)])return!![];const _0x32431d=JSON[_0x5aa313(0x164)](_0x516993[_0x5aa313(0x176)]),{rooms:_0x2d712f,matrix:_0x31dd05}=_0x32431d;if(!_0x2d712f||!_0x31dd05)return!![];const _0x1ab2b0=_0x2d712f[_0x5aa313(0x17c)](_0xf749c9),_0x1c18ea=_0x2d712f[_0x5aa313(0x17c)](_0x26a095);if(_0x1ab2b0===-0x1||_0x1c18ea===-0x1)return!![];const _0x249b50=_0x31dd05[_0x1ab2b0][_0x1c18ea]>0x0||_0x31dd05[_0x1c18ea][_0x1ab2b0]>0x0;return _0x249b50;}catch(_0x1a6004){return _0x43afe4[_0x5aa313(0x188)][_0x5aa313(0x171)](_0x5aa313(0x194)+_0x1a6004[_0x5aa313(0x178)]),!![];}}function calculateSleepProbability(_0x5a45ea){const _0x24f078=a2_0x378617,_0x508fa6=new Date(),_0x4965b0=_0x508fa6['getHours'](),_0x2c203f=_0x5a45ea[_0x24f078(0x189)]();let _0x520e39=0.1;if(_0x4965b0>=0x17||_0x4965b0<=0x6)_0x520e39=0x1;else{if(_0x4965b0>=0xd&&_0x4965b0<=0xf)_0x520e39=0.8;else{if(_0x4965b0>=0x14&&_0x4965b0<=0x17)_0x520e39=0.4;}}let _0x308853=0.1;if(_0x2c203f['includes'](_0x24f078(0x165))||_0x2c203f[_0x24f078(0x175)](_0x24f078(0x16c)))_0x308853=0x1;else{if(_0x2c203f['includes'](_0x24f078(0x18a))||_0x2c203f[_0x24f078(0x175)](_0x24f078(0x193))||_0x2c203f[_0x24f078(0x175)](_0x24f078(0x187)))_0x308853=0.6;else{if(_0x2c203f['includes'](_0x24f078(0x170))||_0x2c203f['includes']('wc'))_0x308853=0.05;}}let _0x540aab=0.5;const _0x162dcc=_0x308853*0.5+_0x520e39*0.3+_0x540aab*0.2;return parseFloat(_0x162dcc['toFixed'](0x2));}async function updateLocation(_0x17245a,_0x3188df){const _0x4aa1b4=a2_0x378617;if(!_0x3188df||_0x3188df===_0x4aa1b4(0x186))return;if(!await isActive(_0x17245a)){resetTimer(_0x17245a);return;}if(currentMonitoredRoom&&currentMonitoredRoom!==_0x3188df){const _0x5df84e=await areRoomsConnected(_0x17245a,currentMonitoredRoom,_0x3188df);if(!_0x5df84e){const _0x452ae2='Ignoriere\x20Bewegung\x20in\x20\x27'+_0x3188df+'\x27.\x20Nicht\x20verbunden\x20mit\x20Ã¼berwachtem\x20\x27'+currentMonitoredRoom+'\x27.';_0x17245a[_0x4aa1b4(0x188)][_0x4aa1b4(0x173)](_0x4aa1b4(0x17f)+_0x452ae2+_0x4aa1b4(0x183)),await _0x17245a[_0x4aa1b4(0x15d)](_0x4aa1b4(0x184),{'val':JSON[_0x4aa1b4(0x16d)]({'room':_0x3188df,'reason':_0x452ae2,'timestamp':Date[_0x4aa1b4(0x195)]()}),'ack':!![]});return;}resetTimer(_0x17245a);}if(!currentMonitoredRoom){await _0x17245a['setStateAsync'](_0x4aa1b4(0x16f),{'val':_0x3188df,'ack':!![]});const _0x81cb99=await loadConfig(_0x17245a);let _0x476b3d=getTimeoutRobust(_0x81cb99,_0x3188df);const _0x4673bc=_0x3188df[_0x4aa1b4(0x189)]();if(!_0x476b3d)for(const _0x49b9e0 in DEFAULT_TIMEOUTS){if(_0x4673bc[_0x4aa1b4(0x175)](_0x49b9e0)){_0x476b3d=DEFAULT_TIMEOUTS[_0x49b9e0];break;}}if(!_0x476b3d&&_0x81cb99[_0x4aa1b4(0x16a)])_0x476b3d=_0x81cb99[_0x4aa1b4(0x16a)];if(!_0x476b3d)return;currentMonitoredRoom=_0x3188df,startTimer(_0x17245a,_0x476b3d,_0x3188df);}}function startTimer(_0xa530bd,_0xd3982f,_0x583faf){const _0x453d25=a2_0x378617;if(activeTimer)clearTimeout(activeTimer);timeoutMs=_0xd3982f*0x3c*0x3e8,startTime=Date[_0x453d25(0x195)](),alarmStage=0x0;const _0x3ac4c0=calculateSleepProbability(_0x583faf||currentMonitoredRoom),_0x2001c6=_0x3ac4c0>0.65;_0x2001c6?(timeoutMs+=0x5a*0x3c*0x3e8,_0xa530bd[_0x453d25(0x188)]['info']('ðŸ’¤\x20Smart\x20Sleep\x20erkannt\x20('+(_0x3ac4c0*0x64)['toFixed'](0x0)+_0x453d25(0x17b)+currentMonitoredRoom+_0x453d25(0x185)),_0xa530bd['setStateAsync'](_0x453d25(0x18d),{'val':!![],'ack':!![]})):_0xa530bd[_0x453d25(0x15d)](_0x453d25(0x18d),{'val':![],'ack':!![]}),_0xa530bd[_0x453d25(0x15d)]('analysis.safety.deadMan.napProbability',{'val':_0x3ac4c0,'ack':!![]}),_0xa530bd['log'][_0x453d25(0x173)](_0x453d25(0x162)+currentMonitoredRoom+_0x453d25(0x17d)+_0xd3982f+_0x453d25(0x163)),_0xa530bd[_0x453d25(0x15d)](_0x453d25(0x196),{'val':'ok','ack':!![]}),activeTimer=setTimeout(()=>triggerPreWarn(_0xa530bd),timeoutMs);}function resetTimer(_0x255ab0){const _0x3aae18=a2_0x378617;if(activeTimer)clearTimeout(activeTimer);activeTimer=null,currentMonitoredRoom=null,alarmStage=0x0,_0x255ab0['setStateAsync'](_0x3aae18(0x196),{'val':'ok','ack':!![]}),_0x255ab0[_0x3aae18(0x15d)](_0x3aae18(0x18d),{'val':![],'ack':!![]}),_0x255ab0[_0x3aae18(0x15d)](_0x3aae18(0x192),{'val':0x0,'ack':!![]});}function a2_0xc679(){const _0xf3cd2d=['833640NvCWMA','6785972fMupRD','%).\x20VerlÃ¤ngere\x20Timer\x20fÃ¼r\x20','indexOf','\x20fÃ¼r\x20','search','[DeadMan]\x20','570LMjinW','(((.+)+)+)+$','getStateAsync','\x20(Multi-Person\x20Filter)','analysis.safety.deadMan.lastIgnored','\x20um\x2090\x20Min.','Unknown','sofa','log','toLowerCase','wohn','replace','analysis.topology.structure','analysis.safety.deadMan.smartSleep','12562921wShdDQ','apply','32722dJyUST','153ZrtImJ','analysis.safety.deadMan.napProbability','living','[DeadMan]\x20Topology\x20check\x20failed:\x20','now','analysis.safety.deadMan.alarmState','setStateAsync','sendNotification','3hwPAgm','pre_warn','ðŸš¨\x20NOTFALL-ALARM:\x20Person\x20reagiert\x20nicht\x20in\x20','ðŸ‘¼\x20Schutzengel:\x20Ãœberwache\x20','\x20Min.','parse','schlaf','40125sCkRNF','.\x20Alles\x20in\x20Ordnung?','ðŸ‘¼\x20Schutzengel-Frage:\x20','./setup','default','error','bed','stringify','2503176QQUOZb','analysis.safety.deadMan.currentRoom','bad','warn','toString','info','â³\x20ACHTUNG:\x20UngewÃ¶hnlich\x20lange\x20InaktivitÃ¤t\x20in\x20','includes','val','13503590YFxFRk','message'];a2_0xc679=function(){return _0xf3cd2d;};return a2_0xc679();}async function triggerPreWarn(_0x3f02bb){const _0x335bef=a2_0x378617;alarmStage=0x1,await _0x3f02bb['setStateAsync'](_0x335bef(0x196),{'val':_0x335bef(0x160),'ack':!![]});const _0xf76779=_0x335bef(0x174)+currentMonitoredRoom+_0x335bef(0x167);_0x3f02bb[_0x335bef(0x188)]['warn'](_0x335bef(0x17f)+_0xf76779),await setup[_0x335bef(0x15e)](_0x3f02bb,_0x335bef(0x168)+_0xf76779),activeTimer=setTimeout(()=>triggerAlarm(_0x3f02bb),0x5*0x3c*0x3e8);}async function triggerAlarm(_0x12c319){const _0x3bbad4=a2_0x378617;alarmStage=0x2,await _0x12c319[_0x3bbad4(0x15d)]('analysis.safety.deadMan.alarmState',{'val':'alarm','ack':!![]});const _0x209809=_0x3bbad4(0x161)+currentMonitoredRoom+'!';_0x12c319['log'][_0x3bbad4(0x16b)](_0x3bbad4(0x17f)+_0x209809),await setup[_0x3bbad4(0x15e)](_0x12c319,_0x209809,![],!![]);}module['exports']={'updateLocation':updateLocation};