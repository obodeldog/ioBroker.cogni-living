const a2_0x5633e2=a2_0x4ec9;(function(_0x1ceb80,_0x4a0bed){const _0x2d1c81=a2_0x4ec9,_0x107e98=_0x1ceb80();while(!![]){try{const _0x1433dd=parseInt(_0x2d1c81(0x128))/0x1*(parseInt(_0x2d1c81(0x137))/0x2)+parseInt(_0x2d1c81(0x13d))/0x3*(-parseInt(_0x2d1c81(0x11b))/0x4)+-parseInt(_0x2d1c81(0x132))/0x5*(parseInt(_0x2d1c81(0x11f))/0x6)+parseInt(_0x2d1c81(0x114))/0x7+-parseInt(_0x2d1c81(0x131))/0x8*(-parseInt(_0x2d1c81(0x118))/0x9)+-parseInt(_0x2d1c81(0x138))/0xa+-parseInt(_0x2d1c81(0x143))/0xb;if(_0x1433dd===_0x4a0bed)break;else _0x107e98['push'](_0x107e98['shift']());}catch(_0x1ba6f9){_0x107e98['push'](_0x107e98['shift']());}}}(a2_0x550b,0xa521a));function a2_0x550b(){const _0x16c897=['setStateAsync','exports','3885624tNJwgX','analysis.topology.structure','bed','158420zYLIYD','â³\x20ACHTUNG:\x20UngewÃ¶hnlich\x20lange\x20InaktivitÃ¤t\x20in\x20','search','analysis.safety.deadMan.napProbability','24vFyxut','./setup','stringify','parse','toFixed','getHours','\x20Min.','Ignoriere\x20Bewegung\x20in\x20\x27','default','595lOeAPV','indexOf','alarm','message','apply','\x20(Multi-Person\x20Filter)','analysis.safety.deadMan.alarmState','\x20um\x2090\x20Min.','pre_warn','8uxXyIX','574715CIFkug','error','now','info','toString','3158ZOOYLS','1290790YewQRG','\x20fÃ¼r\x20','log','ðŸš¨\x20NOTFALL-ALARM:\x20Person\x20reagiert\x20nicht\x20in\x20','toLowerCase','9CVVSeZ','living','warn','includes','val','%).\x20VerlÃ¤ngere\x20Timer\x20fÃ¼r\x20','8378953VsIZlT','analysis.safety.deadMan.config','[DeadMan]\x20','ðŸ‘¼\x20Schutzengel-Frage:\x20','ðŸ’¤\x20Smart\x20Sleep\x20erkannt\x20(','analysis.safety.deadMan.lastIgnored','analysis.safety.deadMan.active','wohn','schlaf','Unknown','getStateAsync','ðŸ‘¼\x20Schutzengel:\x20Ãœberwache\x20','(((.+)+)+)+$','constructor','sofa','sendNotification','5421682grssgJ','analysis.safety.deadMan.smartSleep'];a2_0x550b=function(){return _0x16c897;};return a2_0x550b();}const a2_0x4616a0=(function(){let _0x17ed61=!![];return function(_0x12bdb2,_0x13252f){const _0xe49e78=_0x17ed61?function(){const _0x621fca=a2_0x4ec9;if(_0x13252f){const _0x448f72=_0x13252f[_0x621fca(0x12c)](_0x12bdb2,arguments);return _0x13252f=null,_0x448f72;}}:function(){};return _0x17ed61=![],_0xe49e78;};}()),a2_0x574de3=a2_0x4616a0(this,function(){const _0x4e60cf=a2_0x4ec9;return a2_0x574de3[_0x4e60cf(0x136)]()[_0x4e60cf(0x11d)](_0x4e60cf(0x14f))[_0x4e60cf(0x136)]()[_0x4e60cf(0x150)](a2_0x574de3)[_0x4e60cf(0x11d)](_0x4e60cf(0x14f));});a2_0x574de3();'use strict';const setup=require(a2_0x5633e2(0x120));let activeTimer=null,currentMonitoredRoom=null,timeoutMs=0x0,startTime=0x0,alarmStage=0x0;const DEFAULT_TIMEOUTS={'bad':0x2d,'bath':0x2d,'toilet':0x1e,'wc':0x1e,'keller':0x3c,'schlaf':0x78,'bed':0x78,'guest':0x5a,'gast':0x5a};async function loadConfig(_0x150930){const _0x5b013f=a2_0x5633e2;try{const _0x3ed4c4=await _0x150930[_0x5b013f(0x14d)](_0x5b013f(0x144));if(_0x3ed4c4&&_0x3ed4c4[_0x5b013f(0x141)])return JSON[_0x5b013f(0x122)](_0x3ed4c4[_0x5b013f(0x141)]);}catch(_0x2b9319){}return{};}async function isActive(_0xed8852){const _0x3d2d80=a2_0x5633e2;try{const _0x17e751=await _0xed8852[_0x3d2d80(0x14d)](_0x3d2d80(0x149));return _0x17e751&&_0x17e751[_0x3d2d80(0x141)];}catch(_0x56b1ab){return![];}}async function areRoomsConnected(_0x32e4b2,_0x396ffa,_0x4d2df4){const _0x315d00=a2_0x5633e2;try{const _0x2dcdaa=await _0x32e4b2[_0x315d00(0x14d)](_0x315d00(0x119));if(!_0x2dcdaa||!_0x2dcdaa[_0x315d00(0x141)])return!![];const _0x2ba4ac=JSON[_0x315d00(0x122)](_0x2dcdaa[_0x315d00(0x141)]),{rooms:_0x59a379,matrix:_0x2bb189}=_0x2ba4ac;if(!_0x59a379||!_0x2bb189)return!![];const _0x2ba8f2=_0x59a379[_0x315d00(0x129)](_0x396ffa),_0x4b8589=_0x59a379[_0x315d00(0x129)](_0x4d2df4);if(_0x2ba8f2===-0x1||_0x4b8589===-0x1)return!![];const _0x129788=_0x2bb189[_0x2ba8f2][_0x4b8589]>0x0||_0x2bb189[_0x4b8589][_0x2ba8f2]>0x0;return _0x129788;}catch(_0x2e1c4c){return _0x32e4b2[_0x315d00(0x13a)][_0x315d00(0x13f)]('[DeadMan]\x20Topology\x20check\x20failed:\x20'+_0x2e1c4c[_0x315d00(0x12b)]),!![];}}function a2_0x4ec9(_0x11814d,_0x1d4839){const _0x2cae22=a2_0x550b();return a2_0x4ec9=function(_0x574de3,_0x4616a0){_0x574de3=_0x574de3-0x112;let _0x550ba0=_0x2cae22[_0x574de3];return _0x550ba0;},a2_0x4ec9(_0x11814d,_0x1d4839);}function calculateSleepProbability(_0x315847){const _0x3fc3fd=a2_0x5633e2,_0x28e229=new Date(),_0x481971=_0x28e229[_0x3fc3fd(0x124)](),_0x234632=_0x315847[_0x3fc3fd(0x13c)]();let _0x357ce6=0.1;if(_0x481971>=0x17||_0x481971<=0x6)_0x357ce6=0x1;else{if(_0x481971>=0xd&&_0x481971<=0xf)_0x357ce6=0.8;else{if(_0x481971>=0x14&&_0x481971<=0x17)_0x357ce6=0.4;}}let _0x99694f=0.1;if(_0x234632[_0x3fc3fd(0x140)](_0x3fc3fd(0x14b))||_0x234632['includes'](_0x3fc3fd(0x11a)))_0x99694f=0x1;else{if(_0x234632['includes'](_0x3fc3fd(0x14a))||_0x234632[_0x3fc3fd(0x140)](_0x3fc3fd(0x13e))||_0x234632[_0x3fc3fd(0x140)](_0x3fc3fd(0x112)))_0x99694f=0.6;else{if(_0x234632['includes']('bad')||_0x234632[_0x3fc3fd(0x140)]('wc'))_0x99694f=0.05;}}let _0x1867c5=0.5;const _0x841c9a=_0x99694f*0.5+_0x357ce6*0.3+_0x1867c5*0.2;return parseFloat(_0x841c9a[_0x3fc3fd(0x123)](0x2));}async function updateLocation(_0x264870,_0x4f1023){const _0x32d06e=a2_0x5633e2;if(!_0x4f1023||_0x4f1023===_0x32d06e(0x14c))return;if(!await isActive(_0x264870)){resetTimer(_0x264870);return;}if(currentMonitoredRoom&&currentMonitoredRoom!==_0x4f1023){const _0x4e556d=await areRoomsConnected(_0x264870,currentMonitoredRoom,_0x4f1023);if(!_0x4e556d){const _0x134f54=_0x32d06e(0x126)+_0x4f1023+'\x27.\x20Nicht\x20verbunden\x20mit\x20Ã¼berwachtem\x20\x27'+currentMonitoredRoom+'\x27.';_0x264870[_0x32d06e(0x13a)][_0x32d06e(0x135)]('[DeadMan]\x20'+_0x134f54+_0x32d06e(0x12d)),await _0x264870[_0x32d06e(0x116)](_0x32d06e(0x148),{'val':JSON[_0x32d06e(0x121)]({'room':_0x4f1023,'reason':_0x134f54,'timestamp':Date[_0x32d06e(0x134)]()}),'ack':!![]});return;}resetTimer(_0x264870);}if(!currentMonitoredRoom){await _0x264870[_0x32d06e(0x116)]('analysis.safety.deadMan.currentRoom',{'val':_0x4f1023,'ack':!![]});const _0x7bf19f=await loadConfig(_0x264870),_0x384149=_0x4f1023['toLowerCase']();let _0x1dde6f=_0x7bf19f[_0x4f1023]||_0x7bf19f[_0x384149];if(!_0x1dde6f)for(const _0x45ecc5 in DEFAULT_TIMEOUTS){if(_0x384149[_0x32d06e(0x140)](_0x45ecc5)){_0x1dde6f=DEFAULT_TIMEOUTS[_0x45ecc5];break;}}if(!_0x1dde6f&&_0x7bf19f[_0x32d06e(0x127)])_0x1dde6f=_0x7bf19f[_0x32d06e(0x127)];if(!_0x1dde6f)return;currentMonitoredRoom=_0x4f1023,startTimer(_0x264870,_0x1dde6f,_0x4f1023);}}function startTimer(_0x57442c,_0x110c55,_0x5b5194){const _0xef6467=a2_0x5633e2;if(activeTimer)clearTimeout(activeTimer);timeoutMs=_0x110c55*0x3c*0x3e8,startTime=Date[_0xef6467(0x134)](),alarmStage=0x0;const _0x37f3d7=calculateSleepProbability(_0x5b5194||currentMonitoredRoom),_0xa22000=_0x37f3d7>0.65;_0xa22000?(timeoutMs+=0x5a*0x3c*0x3e8,_0x57442c[_0xef6467(0x13a)][_0xef6467(0x135)](_0xef6467(0x147)+(_0x37f3d7*0x64)[_0xef6467(0x123)](0x0)+_0xef6467(0x142)+currentMonitoredRoom+_0xef6467(0x12f)),_0x57442c['setStateAsync'](_0xef6467(0x115),{'val':!![],'ack':!![]})):_0x57442c[_0xef6467(0x116)](_0xef6467(0x115),{'val':![],'ack':!![]}),_0x57442c['setStateAsync'](_0xef6467(0x11e),{'val':_0x37f3d7,'ack':!![]}),_0x57442c['log']['info'](_0xef6467(0x14e)+currentMonitoredRoom+_0xef6467(0x139)+_0x110c55+_0xef6467(0x125)),_0x57442c[_0xef6467(0x116)]('analysis.safety.deadMan.alarmState',{'val':'ok','ack':!![]}),activeTimer=setTimeout(()=>triggerPreWarn(_0x57442c),timeoutMs);}function resetTimer(_0x5da35b){const _0x465419=a2_0x5633e2;if(activeTimer)clearTimeout(activeTimer);activeTimer=null,currentMonitoredRoom=null,alarmStage=0x0,_0x5da35b[_0x465419(0x116)]('analysis.safety.deadMan.alarmState',{'val':'ok','ack':!![]}),_0x5da35b[_0x465419(0x116)](_0x465419(0x115),{'val':![],'ack':!![]}),_0x5da35b[_0x465419(0x116)]('analysis.safety.deadMan.napProbability',{'val':0x0,'ack':!![]});}async function triggerPreWarn(_0x325c52){const _0x9b5aba=a2_0x5633e2;alarmStage=0x1,await _0x325c52[_0x9b5aba(0x116)](_0x9b5aba(0x12e),{'val':_0x9b5aba(0x130),'ack':!![]});const _0x385d1d=_0x9b5aba(0x11c)+currentMonitoredRoom+'.\x20Alles\x20in\x20Ordnung?';_0x325c52[_0x9b5aba(0x13a)]['warn'](_0x9b5aba(0x145)+_0x385d1d),await setup[_0x9b5aba(0x113)](_0x325c52,_0x9b5aba(0x146)+_0x385d1d),activeTimer=setTimeout(()=>triggerAlarm(_0x325c52),0x5*0x3c*0x3e8);}async function triggerAlarm(_0x31db55){const _0x7d2077=a2_0x5633e2;alarmStage=0x2,await _0x31db55[_0x7d2077(0x116)]('analysis.safety.deadMan.alarmState',{'val':_0x7d2077(0x12a),'ack':!![]});const _0x4605f8=_0x7d2077(0x13b)+currentMonitoredRoom+'!';_0x31db55[_0x7d2077(0x13a)][_0x7d2077(0x133)](_0x7d2077(0x145)+_0x4605f8),await setup['sendNotification'](_0x31db55,_0x4605f8,![],!![]);}module[a2_0x5633e2(0x117)]={'updateLocation':updateLocation};