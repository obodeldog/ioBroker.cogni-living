function a2_0xa22f(_0x346e6c,_0x443b90){const _0x53f62c=a2_0x2edb();return a2_0xa22f=function(_0x317df5,_0x13e909){_0x317df5=_0x317df5-0x16e;let _0x2edbc8=_0x53f62c[_0x317df5];return _0x2edbc8;},a2_0xa22f(_0x346e6c,_0x443b90);}(function(_0x3a9604,_0x3af62e){const _0x194ca8=a2_0xa22f,_0x90d19=_0x3a9604();while(!![]){try{const _0x31f91b=-parseInt(_0x194ca8(0x194))/0x1+parseInt(_0x194ca8(0x177))/0x2*(-parseInt(_0x194ca8(0x19f))/0x3)+-parseInt(_0x194ca8(0x198))/0x4+-parseInt(_0x194ca8(0x17d))/0x5*(-parseInt(_0x194ca8(0x19d))/0x6)+parseInt(_0x194ca8(0x17e))/0x7*(parseInt(_0x194ca8(0x17a))/0x8)+-parseInt(_0x194ca8(0x16e))/0x9*(parseInt(_0x194ca8(0x193))/0xa)+parseInt(_0x194ca8(0x19e))/0xb*(parseInt(_0x194ca8(0x1a3))/0xc);if(_0x31f91b===_0x3af62e)break;else _0x90d19['push'](_0x90d19['shift']());}catch(_0x15a5fe){_0x90d19['push'](_0x90d19['shift']());}}}(a2_0x2edb,0x72ad3));const a2_0x13e909=(function(){let _0x24a6f8=!![];return function(_0x43550c,_0x5e5306){const _0x563d15=_0x24a6f8?function(){const _0x2c9775=a2_0xa22f;if(_0x5e5306){const _0x34b088=_0x5e5306[_0x2c9775(0x171)](_0x43550c,arguments);return _0x5e5306=null,_0x34b088;}}:function(){};return _0x24a6f8=![],_0x563d15;};}()),a2_0x317df5=a2_0x13e909(this,function(){const _0x5a7679=a2_0xa22f;return a2_0x317df5[_0x5a7679(0x170)]()[_0x5a7679(0x1a6)](_0x5a7679(0x185))[_0x5a7679(0x170)]()[_0x5a7679(0x195)](a2_0x317df5)[_0x5a7679(0x1a6)](_0x5a7679(0x185));});a2_0x317df5();'use strict';const setup=require('./setup');let activeTimer=null,currentMonitoredRoom=null,timeoutMs=0x0,startTime=0x0,alarmStage=0x0;const DEFAULT_TIMEOUTS={'bad':0x2d,'bath':0x2d,'toilet':0x1e,'wc':0x1e,'keller':0x3c,'schlaf':0x78,'bed':0x78,'guest':0x5a,'gast':0x5a};function getTimeoutRobust(_0x3ee895,_0x9bc7aa){const _0x36fe37=a2_0xa22f;if(!_0x3ee895||!_0x9bc7aa)return undefined;if(_0x3ee895[_0x9bc7aa])return _0x3ee895[_0x9bc7aa];const _0x2e8901=_0x9bc7aa[_0x36fe37(0x176)]()[_0x36fe37(0x175)](/[^a-z0-9]/g,'');for(const _0x3160b9 in _0x3ee895){const _0xa3b72b=_0x3160b9['toLowerCase']()['replace'](/[^a-z0-9]/g,'');if(_0xa3b72b===_0x2e8901)return _0x3ee895[_0x3160b9];}const _0x4b4ccc=_0x9bc7aa[_0x36fe37(0x176)]();if(_0x3ee895[_0x4b4ccc])return _0x3ee895[_0x4b4ccc];return undefined;}async function loadConfig(_0x339a0d){const _0x1e5b89=a2_0xa22f;try{const _0x3bedb3=await _0x339a0d[_0x1e5b89(0x196)](_0x1e5b89(0x186));if(_0x3bedb3&&_0x3bedb3['val'])return JSON[_0x1e5b89(0x179)](_0x3bedb3[_0x1e5b89(0x184)]);}catch(_0x33bedc){}return{};}async function isActive(_0x374dbd){const _0x245645=a2_0xa22f;try{const _0x525481=await _0x374dbd[_0x245645(0x196)](_0x245645(0x183));return _0x525481&&_0x525481[_0x245645(0x184)];}catch(_0x3a2a48){return![];}}function a2_0x2edb(){const _0x2c5a58=['now','error','.\x20Alles\x20in\x20Ordnung?','sofa','bad','4541990wSevtY','797232PZYRcS','constructor','getStateAsync','Ignoriere\x20Bewegung\x20in\x20\x27','1608456RuptOg','[DeadMan]\x20Topology\x20check\x20failed:\x20','default','warn','\x20um\x2090\x20Min.','162WSPNTI','23276209tsfLqS','206031xXYrdJ','includes','Unknown','setStateAsync','12EyVjQG','analysis.safety.deadMan.lastIgnored','indexOf','search','\x20(Multi-Person\x20Filter)','log','9zltXzJ','info','toString','apply','analysis.safety.deadMan.currentRoom','pre_warn','sendNotification','replace','toLowerCase','22dEMkGY','living','parse','615320wyLieC','\x20Min.','analysis.safety.deadMan.alarmState','126995WqeSBD','7KSiKeR','message','stringify','ðŸ‘¼\x20Schutzengel:\x20Ãœberwache\x20','\x20fÃ¼r\x20','analysis.safety.deadMan.active','val','(((.+)+)+)+$','analysis.safety.deadMan.config','%).\x20VerlÃ¤ngere\x20Timer\x20fÃ¼r\x20','getHours','analysis.safety.deadMan.smartSleep','[DeadMan]\x20','bed','analysis.safety.deadMan.napProbability','toFixed'];a2_0x2edb=function(){return _0x2c5a58;};return a2_0x2edb();}async function areRoomsConnected(_0x18bc15,_0x445aa2,_0x235615){const _0x3ae11e=a2_0xa22f;try{const _0x3151ca=await _0x18bc15[_0x3ae11e(0x196)]('analysis.topology.structure');if(!_0x3151ca||!_0x3151ca[_0x3ae11e(0x184)])return!![];const _0x27fda2=JSON['parse'](_0x3151ca['val']),{rooms:_0x2a8875,matrix:_0x41951e}=_0x27fda2;if(!_0x2a8875||!_0x41951e)return!![];const _0x5b3fc0=_0x2a8875[_0x3ae11e(0x1a5)](_0x445aa2),_0x4a296c=_0x2a8875[_0x3ae11e(0x1a5)](_0x235615);if(_0x5b3fc0===-0x1||_0x4a296c===-0x1)return!![];const _0x2990f0=_0x41951e[_0x5b3fc0][_0x4a296c]>0x0||_0x41951e[_0x4a296c][_0x5b3fc0]>0x0;return _0x2990f0;}catch(_0x2a53ee){return _0x18bc15['log'][_0x3ae11e(0x19b)](_0x3ae11e(0x199)+_0x2a53ee[_0x3ae11e(0x17f)]),!![];}}function calculateSleepProbability(_0x2471ae){const _0x493884=a2_0xa22f,_0x5066c8=new Date(),_0x1d28d0=_0x5066c8[_0x493884(0x188)](),_0x4ac23e=_0x2471ae['toLowerCase']();let _0x44a92f=0.1;if(_0x1d28d0>=0x17||_0x1d28d0<=0x6)_0x44a92f=0x1;else{if(_0x1d28d0>=0xd&&_0x1d28d0<=0xf)_0x44a92f=0.8;else{if(_0x1d28d0>=0x14&&_0x1d28d0<=0x17)_0x44a92f=0.4;}}let _0x175db0=0.1;if(_0x4ac23e[_0x493884(0x1a0)]('schlaf')||_0x4ac23e[_0x493884(0x1a0)](_0x493884(0x18b)))_0x175db0=0x1;else{if(_0x4ac23e[_0x493884(0x1a0)]('wohn')||_0x4ac23e['includes'](_0x493884(0x178))||_0x4ac23e[_0x493884(0x1a0)](_0x493884(0x191)))_0x175db0=0.6;else{if(_0x4ac23e['includes'](_0x493884(0x192))||_0x4ac23e[_0x493884(0x1a0)]('wc'))_0x175db0=0.05;}}let _0x2fd960=0.5;const _0x345c1c=_0x175db0*0.5+_0x44a92f*0.3+_0x2fd960*0.2;return parseFloat(_0x345c1c[_0x493884(0x18d)](0x2));}async function updateLocation(_0xebe04e,_0x3506cb){const _0x3cbaa3=a2_0xa22f;if(!_0x3506cb||_0x3506cb===_0x3cbaa3(0x1a1))return;if(!await isActive(_0xebe04e)){resetTimer(_0xebe04e);return;}if(currentMonitoredRoom&&currentMonitoredRoom!==_0x3506cb){const _0x3c728a=await areRoomsConnected(_0xebe04e,currentMonitoredRoom,_0x3506cb);if(!_0x3c728a){const _0x7622ae=_0x3cbaa3(0x197)+_0x3506cb+'\x27.\x20Nicht\x20verbunden\x20mit\x20Ã¼berwachtem\x20\x27'+currentMonitoredRoom+'\x27.';_0xebe04e[_0x3cbaa3(0x1a8)]['info'](_0x3cbaa3(0x18a)+_0x7622ae+_0x3cbaa3(0x1a7)),await _0xebe04e[_0x3cbaa3(0x1a2)](_0x3cbaa3(0x1a4),{'val':JSON[_0x3cbaa3(0x180)]({'room':_0x3506cb,'reason':_0x7622ae,'timestamp':Date[_0x3cbaa3(0x18e)]()}),'ack':!![]});return;}resetTimer(_0xebe04e);}if(!currentMonitoredRoom){await _0xebe04e[_0x3cbaa3(0x1a2)](_0x3cbaa3(0x172),{'val':_0x3506cb,'ack':!![]});const _0x32c904=await loadConfig(_0xebe04e);let _0x4c7e7d=getTimeoutRobust(_0x32c904,_0x3506cb);const _0x5305c2=_0x3506cb[_0x3cbaa3(0x176)]();if(!_0x4c7e7d)for(const _0x3ed462 in DEFAULT_TIMEOUTS){if(_0x5305c2[_0x3cbaa3(0x1a0)](_0x3ed462)){_0x4c7e7d=DEFAULT_TIMEOUTS[_0x3ed462];break;}}if(!_0x4c7e7d&&_0x32c904[_0x3cbaa3(0x19a)])_0x4c7e7d=_0x32c904['default'];if(!_0x4c7e7d)return;currentMonitoredRoom=_0x3506cb,startTimer(_0xebe04e,_0x4c7e7d,_0x3506cb);}}function startTimer(_0x182003,_0x53cdbb,_0x490bc6){const _0x11012a=a2_0xa22f;if(activeTimer)clearTimeout(activeTimer);timeoutMs=_0x53cdbb*0x3c*0x3e8,startTime=Date[_0x11012a(0x18e)](),alarmStage=0x0;const _0x44e90c=calculateSleepProbability(_0x490bc6||currentMonitoredRoom),_0x204f9c=_0x44e90c>0.65;_0x204f9c?(timeoutMs+=0x5a*0x3c*0x3e8,_0x182003[_0x11012a(0x1a8)][_0x11012a(0x16f)]('ðŸ’¤\x20Smart\x20Sleep\x20erkannt\x20('+(_0x44e90c*0x64)[_0x11012a(0x18d)](0x0)+_0x11012a(0x187)+currentMonitoredRoom+_0x11012a(0x19c)),_0x182003[_0x11012a(0x1a2)]('analysis.safety.deadMan.smartSleep',{'val':!![],'ack':!![]})):_0x182003[_0x11012a(0x1a2)](_0x11012a(0x189),{'val':![],'ack':!![]}),_0x182003['setStateAsync'](_0x11012a(0x18c),{'val':_0x44e90c,'ack':!![]}),_0x182003[_0x11012a(0x1a8)][_0x11012a(0x16f)](_0x11012a(0x181)+currentMonitoredRoom+_0x11012a(0x182)+_0x53cdbb+_0x11012a(0x17b)),_0x182003['setStateAsync'](_0x11012a(0x17c),{'val':'ok','ack':!![]}),activeTimer=setTimeout(()=>triggerPreWarn(_0x182003),timeoutMs);}function resetTimer(_0x5e2994){const _0x260af7=a2_0xa22f;if(activeTimer)clearTimeout(activeTimer);activeTimer=null,currentMonitoredRoom=null,alarmStage=0x0,_0x5e2994[_0x260af7(0x1a2)]('analysis.safety.deadMan.alarmState',{'val':'ok','ack':!![]}),_0x5e2994[_0x260af7(0x1a2)](_0x260af7(0x189),{'val':![],'ack':!![]}),_0x5e2994[_0x260af7(0x1a2)]('analysis.safety.deadMan.napProbability',{'val':0x0,'ack':!![]});}async function triggerPreWarn(_0x466c11){const _0x461bd8=a2_0xa22f;alarmStage=0x1,await _0x466c11['setStateAsync']('analysis.safety.deadMan.alarmState',{'val':_0x461bd8(0x173),'ack':!![]});const _0x4e61f0='â³\x20ACHTUNG:\x20UngewÃ¶hnlich\x20lange\x20InaktivitÃ¤t\x20in\x20'+currentMonitoredRoom+_0x461bd8(0x190);_0x466c11[_0x461bd8(0x1a8)][_0x461bd8(0x19b)]('[DeadMan]\x20'+_0x4e61f0),await setup[_0x461bd8(0x174)](_0x466c11,'ðŸ‘¼\x20Schutzengel-Frage:\x20'+_0x4e61f0),activeTimer=setTimeout(()=>triggerAlarm(_0x466c11),0x5*0x3c*0x3e8);}async function triggerAlarm(_0x2172ae){const _0x3608a6=a2_0xa22f;alarmStage=0x2,await _0x2172ae[_0x3608a6(0x1a2)](_0x3608a6(0x17c),{'val':'alarm','ack':!![]});const _0x264072='ðŸš¨\x20NOTFALL-ALARM:\x20Person\x20reagiert\x20nicht\x20in\x20'+currentMonitoredRoom+'!';_0x2172ae[_0x3608a6(0x1a8)][_0x3608a6(0x18f)]('[DeadMan]\x20'+_0x264072),await setup[_0x3608a6(0x174)](_0x2172ae,_0x264072,![],!![]);}module['exports']={'updateLocation':updateLocation};