const a2_0x19d9fb=a2_0xbf21;(function(_0x59bda9,_0x337d58){const _0x35ac88=a2_0xbf21,_0x5e5867=_0x59bda9();while(!![]){try{const _0x2609e9=-parseInt(_0x35ac88(0x1eb))/0x1*(parseInt(_0x35ac88(0x218))/0x2)+parseInt(_0x35ac88(0x215))/0x3+-parseInt(_0x35ac88(0x221))/0x4+-parseInt(_0x35ac88(0x21f))/0x5*(-parseInt(_0x35ac88(0x220))/0x6)+-parseInt(_0x35ac88(0x206))/0x7+parseInt(_0x35ac88(0x20d))/0x8*(parseInt(_0x35ac88(0x21e))/0x9)+parseInt(_0x35ac88(0x211))/0xa*(parseInt(_0x35ac88(0x1ed))/0xb);if(_0x2609e9===_0x337d58)break;else _0x5e5867['push'](_0x5e5867['shift']());}catch(_0x3f7393){_0x5e5867['push'](_0x5e5867['shift']());}}}(a2_0x1825,0x3c758));const a2_0x33df98=(function(){let _0x204c8a=!![];return function(_0x53dc8e,_0x10cf81){const _0x24de7d=_0x204c8a?function(){const _0x3552af=a2_0xbf21;if(_0x10cf81){const _0x373829=_0x10cf81[_0x3552af(0x1f1)](_0x53dc8e,arguments);return _0x10cf81=null,_0x373829;}}:function(){};return _0x204c8a=![],_0x24de7d;};}()),a2_0x200a11=a2_0x33df98(this,function(){const _0x50ad03=a2_0xbf21;return a2_0x200a11['toString']()[_0x50ad03(0x212)](_0x50ad03(0x203))[_0x50ad03(0x216)]()[_0x50ad03(0x20e)](a2_0x200a11)[_0x50ad03(0x212)](_0x50ad03(0x203));});a2_0x200a11();'use strict';const setup=require(a2_0x19d9fb(0x200));let activeTimer=null,currentMonitoredRoom=null,timeoutMs=0x0,startTime=0x0,alarmStage=0x0;const DEFAULT_TIMEOUTS={'bad':0x2d,'bath':0x2d,'toilet':0x1e,'wc':0x1e,'keller':0x3c,'schlaf':0x78,'bed':0x78,'guest':0x5a,'gast':0x5a};function a2_0xbf21(_0x435c2e,_0x55687e){const _0x447ddd=a2_0x1825();return a2_0xbf21=function(_0x200a11,_0x33df98){_0x200a11=_0x200a11-0x1e9;let _0x182559=_0x447ddd[_0x200a11];return _0x182559;},a2_0xbf21(_0x435c2e,_0x55687e);}function a2_0x1825(){const _0xfd0cb4=['434NkqwHZ','error','.\x20Alles\x20in\x20Ordnung?','analysis.topology.structure','toFixed','\x20(Multi-Person\x20Filter)','162252ZTpOXQ','65315QnEDXh','30GialOk','133584yxzlvm','sendNotification','getStateAsync','pre_warn','\x20fÃ¼r\x20','analysis.safety.deadMan.active','parse','1801sKsqHi','val','429ZAYYQk','analysis.safety.deadMan.smartSleep','toLowerCase','default','apply','ðŸ‘¼\x20Schutzengel:\x20Ãœberwache\x20','now','includes','living','warn','wohn','Unknown','[DeadMan]\x20Topology\x20check\x20failed:\x20','schlaf','analysis.safety.deadMan.lastIgnored','â³\x20ACHTUNG:\x20UngewÃ¶hnlich\x20lange\x20InaktivitÃ¤t\x20in\x20','analysis.safety.deadMan.napProbability','indexOf','analysis.safety.deadMan.config','./setup','exports','\x27.\x20Nicht\x20verbunden\x20mit\x20Ã¼berwachtem\x20\x27','(((.+)+)+)+$','getHours','alarm','516362IlRgII','log','info','ðŸ‘¼\x20Schutzengel-Frage:\x20','ðŸ’¤\x20Smart\x20Sleep\x20erkannt\x20(','analysis.safety.deadMan.alarmState','[DeadMan]\x20','24rvFeoC','constructor','analysis.safety.deadMan.currentRoom','\x20Min.','72810Hrctvt','search','stringify','bad','1026783aUZgtP','toString','setStateAsync'];a2_0x1825=function(){return _0xfd0cb4;};return a2_0x1825();}async function loadConfig(_0x5a9c12){const _0x1fe1c6=a2_0x19d9fb;try{const _0x13292a=await _0x5a9c12[_0x1fe1c6(0x223)](_0x1fe1c6(0x1ff));if(_0x13292a&&_0x13292a[_0x1fe1c6(0x1ec)])return JSON[_0x1fe1c6(0x1ea)](_0x13292a['val']);}catch(_0x4f75c7){}return{};}async function isActive(_0x26c18a){const _0x16723a=a2_0x19d9fb;try{const _0x8f099e=await _0x26c18a[_0x16723a(0x223)](_0x16723a(0x1e9));return _0x8f099e&&_0x8f099e[_0x16723a(0x1ec)];}catch(_0xf4949c){return![];}}async function areRoomsConnected(_0x3deafe,_0x73e19f,_0x5d4a49){const _0x50db9c=a2_0x19d9fb;try{const _0x4fac35=await _0x3deafe[_0x50db9c(0x223)](_0x50db9c(0x21b));if(!_0x4fac35||!_0x4fac35[_0x50db9c(0x1ec)])return!![];const _0x527f0f=JSON[_0x50db9c(0x1ea)](_0x4fac35[_0x50db9c(0x1ec)]),{rooms:_0xddc47c,matrix:_0x4f9e3f}=_0x527f0f;if(!_0xddc47c||!_0x4f9e3f)return!![];const _0xb5647f=_0xddc47c[_0x50db9c(0x1fe)](_0x73e19f),_0x5851f9=_0xddc47c[_0x50db9c(0x1fe)](_0x5d4a49);if(_0xb5647f===-0x1||_0x5851f9===-0x1)return!![];const _0x29990c=_0x4f9e3f[_0xb5647f][_0x5851f9]>0x0||_0x4f9e3f[_0x5851f9][_0xb5647f]>0x0;return _0x29990c;}catch(_0x46f582){return _0x3deafe[_0x50db9c(0x207)][_0x50db9c(0x1f6)](_0x50db9c(0x1f9)+_0x46f582['message']),!![];}}function calculateSleepProbability(_0x2d3349){const _0x31b069=a2_0x19d9fb,_0x16678e=new Date(),_0x215d26=_0x16678e[_0x31b069(0x204)](),_0x1d110f=_0x2d3349[_0x31b069(0x1ef)]();let _0x444080=0.1;if(_0x215d26>=0x17||_0x215d26<=0x6)_0x444080=0x1;else{if(_0x215d26>=0xd&&_0x215d26<=0xf)_0x444080=0.8;else{if(_0x215d26>=0x14&&_0x215d26<=0x17)_0x444080=0.4;}}let _0x46c98e=0.1;if(_0x1d110f[_0x31b069(0x1f4)](_0x31b069(0x1fa))||_0x1d110f[_0x31b069(0x1f4)]('bed'))_0x46c98e=0x1;else{if(_0x1d110f[_0x31b069(0x1f4)](_0x31b069(0x1f7))||_0x1d110f['includes'](_0x31b069(0x1f5))||_0x1d110f[_0x31b069(0x1f4)]('sofa'))_0x46c98e=0.6;else{if(_0x1d110f[_0x31b069(0x1f4)](_0x31b069(0x214))||_0x1d110f['includes']('wc'))_0x46c98e=0.05;}}let _0x81519c=0.5;const _0x529481=_0x46c98e*0.5+_0x444080*0.3+_0x81519c*0.2;return parseFloat(_0x529481[_0x31b069(0x21c)](0x2));}async function updateLocation(_0x2978f3,_0x375e5c){const _0x26d576=a2_0x19d9fb;if(!_0x375e5c||_0x375e5c===_0x26d576(0x1f8))return;if(!await isActive(_0x2978f3)){resetTimer(_0x2978f3);return;}if(currentMonitoredRoom&&currentMonitoredRoom!==_0x375e5c){const _0x262427=await areRoomsConnected(_0x2978f3,currentMonitoredRoom,_0x375e5c);if(!_0x262427){const _0x63d7c2='Ignoriere\x20Bewegung\x20in\x20\x27'+_0x375e5c+_0x26d576(0x202)+currentMonitoredRoom+'\x27.';_0x2978f3['log'][_0x26d576(0x208)](_0x26d576(0x20c)+_0x63d7c2+_0x26d576(0x21d)),await _0x2978f3[_0x26d576(0x217)](_0x26d576(0x1fb),{'val':JSON[_0x26d576(0x213)]({'room':_0x375e5c,'reason':_0x63d7c2,'timestamp':Date[_0x26d576(0x1f3)]()}),'ack':!![]});return;}resetTimer(_0x2978f3);}if(!currentMonitoredRoom){await _0x2978f3[_0x26d576(0x217)](_0x26d576(0x20f),{'val':_0x375e5c,'ack':!![]});const _0x77b45b=await loadConfig(_0x2978f3),_0x4ab002=_0x375e5c[_0x26d576(0x1ef)]();let _0x3d3bdf=_0x77b45b[_0x375e5c]||_0x77b45b[_0x4ab002];if(!_0x3d3bdf)for(const _0x1c70e4 in DEFAULT_TIMEOUTS){if(_0x4ab002[_0x26d576(0x1f4)](_0x1c70e4)){_0x3d3bdf=DEFAULT_TIMEOUTS[_0x1c70e4];break;}}if(!_0x3d3bdf&&_0x77b45b['default'])_0x3d3bdf=_0x77b45b[_0x26d576(0x1f0)];if(!_0x3d3bdf)return;currentMonitoredRoom=_0x375e5c,startTimer(_0x2978f3,_0x3d3bdf,_0x375e5c);}}function startTimer(_0x400a83,_0x4dd394,_0x5567f1){const _0x45de4c=a2_0x19d9fb;if(activeTimer)clearTimeout(activeTimer);timeoutMs=_0x4dd394*0x3c*0x3e8,startTime=Date[_0x45de4c(0x1f3)](),alarmStage=0x0;const _0x369fa4=calculateSleepProbability(_0x5567f1||currentMonitoredRoom),_0x3aff96=_0x369fa4>0.65;_0x3aff96?(timeoutMs+=0x5a*0x3c*0x3e8,_0x400a83[_0x45de4c(0x207)][_0x45de4c(0x208)](_0x45de4c(0x20a)+(_0x369fa4*0x64)[_0x45de4c(0x21c)](0x0)+'%).\x20VerlÃ¤ngere\x20Timer\x20fÃ¼r\x20'+currentMonitoredRoom+'\x20um\x2090\x20Min.'),_0x400a83[_0x45de4c(0x217)](_0x45de4c(0x1ee),{'val':!![],'ack':!![]})):_0x400a83[_0x45de4c(0x217)](_0x45de4c(0x1ee),{'val':![],'ack':!![]}),_0x400a83[_0x45de4c(0x217)](_0x45de4c(0x1fd),{'val':_0x369fa4,'ack':!![]}),_0x400a83[_0x45de4c(0x207)][_0x45de4c(0x208)](_0x45de4c(0x1f2)+currentMonitoredRoom+_0x45de4c(0x225)+_0x4dd394+_0x45de4c(0x210)),_0x400a83[_0x45de4c(0x217)](_0x45de4c(0x20b),{'val':'ok','ack':!![]}),activeTimer=setTimeout(()=>triggerPreWarn(_0x400a83),timeoutMs);}function resetTimer(_0x5b3990){const _0x554ec2=a2_0x19d9fb;if(activeTimer)clearTimeout(activeTimer);activeTimer=null,currentMonitoredRoom=null,alarmStage=0x0,_0x5b3990[_0x554ec2(0x217)]('analysis.safety.deadMan.alarmState',{'val':'ok','ack':!![]}),_0x5b3990[_0x554ec2(0x217)](_0x554ec2(0x1ee),{'val':![],'ack':!![]}),_0x5b3990['setStateAsync'](_0x554ec2(0x1fd),{'val':0x0,'ack':!![]});}async function triggerPreWarn(_0x1bf594){const _0x2d0e29=a2_0x19d9fb;alarmStage=0x1,await _0x1bf594[_0x2d0e29(0x217)]('analysis.safety.deadMan.alarmState',{'val':_0x2d0e29(0x224),'ack':!![]});const _0x16bdf0=_0x2d0e29(0x1fc)+currentMonitoredRoom+_0x2d0e29(0x21a);_0x1bf594[_0x2d0e29(0x207)]['warn']('[DeadMan]\x20'+_0x16bdf0),await setup[_0x2d0e29(0x222)](_0x1bf594,_0x2d0e29(0x209)+_0x16bdf0),activeTimer=setTimeout(()=>triggerAlarm(_0x1bf594),0x5*0x3c*0x3e8);}async function triggerAlarm(_0x31d4be){const _0x9b7755=a2_0x19d9fb;alarmStage=0x2,await _0x31d4be[_0x9b7755(0x217)](_0x9b7755(0x20b),{'val':_0x9b7755(0x205),'ack':!![]});const _0x15b886='ðŸš¨\x20NOTFALL-ALARM:\x20Person\x20reagiert\x20nicht\x20in\x20'+currentMonitoredRoom+'!';_0x31d4be['log'][_0x9b7755(0x219)]('[DeadMan]\x20'+_0x15b886),await setup[_0x9b7755(0x222)](_0x31d4be,_0x15b886,![],!![]);}module[a2_0x19d9fb(0x201)]={'updateLocation':updateLocation};