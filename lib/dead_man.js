const a2_0x11f346=a2_0x4d77;(function(_0x563028,_0x2b9c4a){const _0x320aeb=a2_0x4d77,_0x39d40d=_0x563028();while(!![]){try{const _0x4ce722=parseInt(_0x320aeb(0xbd))/0x1*(parseInt(_0x320aeb(0xa7))/0x2)+-parseInt(_0x320aeb(0x8e))/0x3+parseInt(_0x320aeb(0x8f))/0x4+-parseInt(_0x320aeb(0x93))/0x5+parseInt(_0x320aeb(0xaf))/0x6*(parseInt(_0x320aeb(0xb8))/0x7)+parseInt(_0x320aeb(0xb1))/0x8*(parseInt(_0x320aeb(0x9f))/0x9)+-parseInt(_0x320aeb(0x8d))/0xa*(parseInt(_0x320aeb(0xb4))/0xb);if(_0x4ce722===_0x2b9c4a)break;else _0x39d40d['push'](_0x39d40d['shift']());}catch(_0x58cb85){_0x39d40d['push'](_0x39d40d['shift']());}}}(a2_0x4989,0xce821));const a2_0x4b6efa=(function(){let _0x112385=!![];return function(_0x28e5eb,_0x1e7ff6){const _0x5820bd=_0x112385?function(){const _0xcc5a5e=a2_0x4d77;if(_0x1e7ff6){const _0x120a91=_0x1e7ff6[_0xcc5a5e(0x9b)](_0x28e5eb,arguments);return _0x1e7ff6=null,_0x120a91;}}:function(){};return _0x112385=![],_0x5820bd;};}()),a2_0x27a18b=a2_0x4b6efa(this,function(){const _0x448bf0=a2_0x4d77;return a2_0x27a18b[_0x448bf0(0xbe)]()[_0x448bf0(0xaa)](_0x448bf0(0xa0))[_0x448bf0(0xbe)]()[_0x448bf0(0xa1)](a2_0x27a18b)[_0x448bf0(0xaa)]('(((.+)+)+)+$');});a2_0x27a18b();'use strict';const setup=require(a2_0x11f346(0xb0));let activeTimer=null,currentMonitoredRoom=null,timeoutMs=0x0,startTime=0x0,alarmStage=0x0;const DEFAULT_TIMEOUTS={'bad':0x2d,'bath':0x2d,'toilet':0x1e,'wc':0x1e,'keller':0x3c,'schlaf':0x78,'bed':0x78,'guest':0x5a,'gast':0x5a};function getTimeoutRobust(_0x28c427,_0x237766){const _0x520ba3=a2_0x11f346;if(!_0x28c427||!_0x237766)return undefined;if(_0x28c427[_0x237766])return _0x28c427[_0x237766];const _0x57c0fc=_0x237766[_0x520ba3(0xac)]()['replace'](/[^a-z0-9]/g,'');for(const _0x56a737 in _0x28c427){const _0x4bf1e8=_0x56a737['toLowerCase']()[_0x520ba3(0xa9)](/[^a-z0-9]/g,'');if(_0x4bf1e8===_0x57c0fc)return _0x28c427[_0x56a737];}const _0x29c216=_0x237766[_0x520ba3(0xac)]();if(_0x28c427[_0x29c216])return _0x28c427[_0x29c216];return undefined;}async function loadConfig(_0x5d0193){const _0x1fcac0=a2_0x11f346;try{const _0x1a9e40=await _0x5d0193[_0x1fcac0(0xb2)]('analysis.safety.deadMan.config');if(_0x1a9e40&&_0x1a9e40[_0x1fcac0(0x91)])return JSON[_0x1fcac0(0xa3)](_0x1a9e40[_0x1fcac0(0x91)]);}catch(_0x158982){}return{};}async function isActive(_0x174333){const _0x52e6e9=a2_0x11f346;try{const _0x58433c=await _0x174333[_0x52e6e9(0xb2)]('analysis.safety.deadMan.active');return _0x58433c&&_0x58433c[_0x52e6e9(0x91)];}catch(_0x149f44){return![];}}async function areRoomsConnected(_0x441342,_0xfbc416,_0x36f58d){const _0x531575=a2_0x11f346;try{const _0x48f238=await _0x441342[_0x531575(0xb2)](_0x531575(0xae));if(!_0x48f238||!_0x48f238[_0x531575(0x91)])return!![];const _0x16a934=JSON[_0x531575(0xa3)](_0x48f238['val']),{rooms:_0x57ba3c,matrix:_0x267855}=_0x16a934;if(!_0x57ba3c||!_0x267855)return!![];const _0x52ea7a=_0x57ba3c[_0x531575(0xb6)](_0xfbc416),_0x15fa6a=_0x57ba3c[_0x531575(0xb6)](_0x36f58d);if(_0x52ea7a===-0x1||_0x15fa6a===-0x1)return!![];const _0x5cc237=_0x267855[_0x52ea7a][_0x15fa6a]>0x0||_0x267855[_0x15fa6a][_0x52ea7a]>0x0;return _0x5cc237;}catch(_0x446188){return _0x441342[_0x531575(0xc2)]['warn']('[DeadMan]\x20Topology\x20check\x20failed:\x20'+_0x446188[_0x531575(0x9e)]),!![];}}function calculateSleepProbability(_0x33a967){const _0x563265=a2_0x11f346,_0x4088db=new Date(),_0x45060f=_0x4088db[_0x563265(0xb7)](),_0xd9cf97=_0x33a967[_0x563265(0xac)]();let _0x297e9f=0.1;if(_0x45060f>=0x17||_0x45060f<=0x6)_0x297e9f=0x1;else{if(_0x45060f>=0xd&&_0x45060f<=0xf)_0x297e9f=0.8;else{if(_0x45060f>=0x14&&_0x45060f<=0x17)_0x297e9f=0.4;}}let _0x393015=0.1;if(_0xd9cf97[_0x563265(0xbb)](_0x563265(0x90))||_0xd9cf97[_0x563265(0xbb)](_0x563265(0xa5)))_0x393015=0x1;else{if(_0xd9cf97['includes']('wohn')||_0xd9cf97['includes'](_0x563265(0xc3))||_0xd9cf97['includes'](_0x563265(0xb5)))_0x393015=0.6;else{if(_0xd9cf97[_0x563265(0xbb)](_0x563265(0x9a))||_0xd9cf97[_0x563265(0xbb)]('wc'))_0x393015=0.05;}}let _0x322e49=0.5;const _0x891c36=_0x393015*0.5+_0x297e9f*0.3+_0x322e49*0.2;return parseFloat(_0x891c36['toFixed'](0x2));}async function updateLocation(_0x539a46,_0x2eb8c0){const _0x1c19f5=a2_0x11f346;if(!_0x2eb8c0||_0x2eb8c0===_0x1c19f5(0xc0))return;if(!await isActive(_0x539a46)){resetTimer(_0x539a46);return;}if(currentMonitoredRoom&&currentMonitoredRoom!==_0x2eb8c0){const _0x41a91a=await areRoomsConnected(_0x539a46,currentMonitoredRoom,_0x2eb8c0);if(!_0x41a91a){const _0x3a32a7=_0x1c19f5(0xc4)+_0x2eb8c0+_0x1c19f5(0xb3)+currentMonitoredRoom+'\x27.';_0x539a46[_0x1c19f5(0xc2)]['info'](_0x1c19f5(0x9c)+_0x3a32a7+'\x20(Multi-Person\x20Filter)'),await _0x539a46[_0x1c19f5(0x8c)](_0x1c19f5(0xab),{'val':JSON[_0x1c19f5(0xa6)]({'room':_0x2eb8c0,'reason':_0x3a32a7,'timestamp':Date[_0x1c19f5(0xc1)]()}),'ack':!![]});return;}resetTimer(_0x539a46);}if(!currentMonitoredRoom){await _0x539a46[_0x1c19f5(0x8c)](_0x1c19f5(0x92),{'val':_0x2eb8c0,'ack':!![]});const _0x56f6eb=await loadConfig(_0x539a46);let _0x3cf4f2=getTimeoutRobust(_0x56f6eb,_0x2eb8c0);const _0x588c58=_0x2eb8c0[_0x1c19f5(0xac)]();if(!_0x3cf4f2)for(const _0x11a717 in DEFAULT_TIMEOUTS){if(_0x588c58['includes'](_0x11a717)){_0x3cf4f2=DEFAULT_TIMEOUTS[_0x11a717];break;}}if(!_0x3cf4f2&&_0x56f6eb[_0x1c19f5(0xa4)])_0x3cf4f2=_0x56f6eb[_0x1c19f5(0xa4)];if(!_0x3cf4f2)return;currentMonitoredRoom=_0x2eb8c0,startTimer(_0x539a46,_0x3cf4f2,_0x2eb8c0);}}function a2_0x4d77(_0x5441f4,_0xbd68ea){const _0xee6ba0=a2_0x4989();return a2_0x4d77=function(_0x27a18b,_0x4b6efa){_0x27a18b=_0x27a18b-0x8c;let _0x498958=_0xee6ba0[_0x27a18b];return _0x498958;},a2_0x4d77(_0x5441f4,_0xbd68ea);}function startTimer(_0x4c5a76,_0x366ce3,_0x3ede50){const _0x2a7464=a2_0x11f346;if(activeTimer)clearTimeout(activeTimer);timeoutMs=_0x366ce3*0x3c*0x3e8,startTime=Date[_0x2a7464(0xc1)](),alarmStage=0x0;const _0x5769a7=calculateSleepProbability(_0x3ede50||currentMonitoredRoom),_0x59d184=_0x5769a7>0.65;_0x59d184?(timeoutMs+=0x5a*0x3c*0x3e8,_0x4c5a76[_0x2a7464(0xc2)][_0x2a7464(0xa8)]('ðŸ’¤\x20Smart\x20Sleep\x20erkannt\x20('+(_0x5769a7*0x64)[_0x2a7464(0x97)](0x0)+_0x2a7464(0x9d)+currentMonitoredRoom+'\x20um\x2090\x20Min.'),_0x4c5a76[_0x2a7464(0x8c)](_0x2a7464(0x94),{'val':!![],'ack':!![]})):_0x4c5a76['setStateAsync'](_0x2a7464(0x94),{'val':![],'ack':!![]}),_0x4c5a76['setStateAsync']('analysis.safety.deadMan.napProbability',{'val':_0x5769a7,'ack':!![]}),_0x4c5a76[_0x2a7464(0xc2)][_0x2a7464(0xa8)](_0x2a7464(0x95)+currentMonitoredRoom+_0x2a7464(0x96)+_0x366ce3+_0x2a7464(0xba)),_0x4c5a76[_0x2a7464(0x8c)](_0x2a7464(0xbc),{'val':'ok','ack':!![]}),activeTimer=setTimeout(()=>triggerPreWarn(_0x4c5a76),timeoutMs);}function resetTimer(_0x43d9d1){const _0x57e652=a2_0x11f346;if(activeTimer)clearTimeout(activeTimer);activeTimer=null,currentMonitoredRoom=null,alarmStage=0x0,_0x43d9d1[_0x57e652(0x8c)](_0x57e652(0xbc),{'val':'ok','ack':!![]}),_0x43d9d1[_0x57e652(0x8c)](_0x57e652(0x94),{'val':![],'ack':!![]}),_0x43d9d1[_0x57e652(0x8c)](_0x57e652(0xa2),{'val':0x0,'ack':!![]});}async function triggerPreWarn(_0x1fb0ae){const _0x339d41=a2_0x11f346;alarmStage=0x1,await _0x1fb0ae['setStateAsync'](_0x339d41(0xbc),{'val':'pre_warn','ack':!![]});const _0x23fb36='â³\x20ACHTUNG:\x20UngewÃ¶hnlich\x20lange\x20InaktivitÃ¤t\x20in\x20'+currentMonitoredRoom+'.\x20Alles\x20in\x20Ordnung?';_0x1fb0ae['log']['warn']('[DeadMan]\x20'+_0x23fb36),await setup['sendNotification'](_0x1fb0ae,_0x339d41(0xbf)+_0x23fb36),activeTimer=setTimeout(()=>triggerAlarm(_0x1fb0ae),0x5*0x3c*0x3e8);}async function triggerAlarm(_0x615b46){const _0x561085=a2_0x11f346;alarmStage=0x2,await _0x615b46[_0x561085(0x8c)](_0x561085(0xbc),{'val':_0x561085(0x98),'ack':!![]});const _0x19dbd0=_0x561085(0x99)+currentMonitoredRoom+'!';_0x615b46['log'][_0x561085(0xad)](_0x561085(0x9c)+_0x19dbd0),await setup['sendNotification'](_0x615b46,_0x19dbd0,![],!![]);}module[a2_0x11f346(0xb9)]={'updateLocation':updateLocation};function a2_0x4989(){const _0x175124=['constructor','analysis.safety.deadMan.napProbability','parse','default','bed','stringify','1592876NfnIET','info','replace','search','analysis.safety.deadMan.lastIgnored','toLowerCase','error','analysis.topology.structure','9300SNzQVT','./setup','8XcaaVp','getStateAsync','\x27.\x20Nicht\x20verbunden\x20mit\x20Ã¼berwachtem\x20\x27','30492eSYTpB','sofa','indexOf','getHours','105VXRYaQ','exports','\x20Min.','includes','analysis.safety.deadMan.alarmState','2zKjkBr','toString','ðŸ‘¼\x20Schutzengel-Frage:\x20','Unknown','now','log','living','Ignoriere\x20Bewegung\x20in\x20\x27','setStateAsync','11820ZecoBm','803049WSJykv','5747060ltRpor','schlaf','val','analysis.safety.deadMan.currentRoom','1079525baKZLC','analysis.safety.deadMan.smartSleep','ðŸ‘¼\x20Schutzengel:\x20Ãœberwache\x20','\x20fÃ¼r\x20','toFixed','alarm','ðŸš¨\x20NOTFALL-ALARM:\x20Person\x20reagiert\x20nicht\x20in\x20','bad','apply','[DeadMan]\x20','%).\x20VerlÃ¤ngere\x20Timer\x20fÃ¼r\x20','message','13977522RPpNQM','(((.+)+)+)+$'];a2_0x4989=function(){return _0x175124;};return a2_0x4989();}