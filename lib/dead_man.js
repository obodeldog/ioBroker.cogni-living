const a2_0x34e3cf=a2_0x21a8;(function(_0x3ab44f,_0x245463){const _0x164dea=a2_0x21a8,_0x1a7cf7=_0x3ab44f();while(!![]){try{const _0x14fe2c=parseInt(_0x164dea(0x9c))/0x1*(parseInt(_0x164dea(0xac))/0x2)+parseInt(_0x164dea(0xaa))/0x3+-parseInt(_0x164dea(0x94))/0x4+-parseInt(_0x164dea(0xa9))/0x5+parseInt(_0x164dea(0xb0))/0x6*(parseInt(_0x164dea(0xbc))/0x7)+-parseInt(_0x164dea(0xa0))/0x8*(-parseInt(_0x164dea(0xad))/0x9)+parseInt(_0x164dea(0x99))/0xa;if(_0x14fe2c===_0x245463)break;else _0x1a7cf7['push'](_0x1a7cf7['shift']());}catch(_0x5aa4ff){_0x1a7cf7['push'](_0x1a7cf7['shift']());}}}(a2_0x3e76,0xba17a));const a2_0x219105=(function(){let _0x3ecdac=!![];return function(_0xde1f5a,_0x1ce177){const _0x1748db=_0x3ecdac?function(){const _0x3dd608=a2_0x21a8;if(_0x1ce177){const _0x113814=_0x1ce177[_0x3dd608(0xc5)](_0xde1f5a,arguments);return _0x1ce177=null,_0x113814;}}:function(){};return _0x3ecdac=![],_0x1748db;};}()),a2_0x57a440=a2_0x219105(this,function(){const _0x103a18=a2_0x21a8;return a2_0x57a440['toString']()['search']('(((.+)+)+)+$')[_0x103a18(0x8f)]()[_0x103a18(0xae)](a2_0x57a440)['search']('(((.+)+)+)+$');});a2_0x57a440();'use strict';const setup=require('./setup');function a2_0x3e76(){const _0x162ec3=['wohn','stringify','2kWjYEh','default','val','bed','104OQIshi','\x20fÃ¼r\x20','info','error','sofa','now','ðŸš¨\x20NOTFALL-ALARM:\x20Person\x20reagiert\x20nicht\x20in\x20','includes','exports','6846630GSaMdz','487047vmbOBW','schlaf','410234QuOeAX','660834jUbSyG','constructor','getHours','456cawwIR','living','analysis.safety.deadMan.napProbability','ðŸ‘¼\x20Schutzengel:\x20Ãœberwache\x20','\x20(Multi-Person\x20Filter)','parse','toLowerCase','warn','analysis.safety.deadMan.active','analysis.safety.deadMan.config','.\x20Alles\x20in\x20Ordnung?','[DeadMan]\x20','102046xDHquw','analysis.safety.deadMan.alarmState','bad','alarm','\x27.\x20Nicht\x20verbunden\x20mit\x20Ã¼berwachtem\x20\x27','indexOf','ðŸ‘¼\x20Schutzengel-Frage:\x20','toFixed','\x20Min.','apply','getStateAsync','analysis.safety.deadMan.smartSleep','toString','setStateAsync','log','sendNotification','â³\x20ACHTUNG:\x20UngewÃ¶hnlich\x20lange\x20InaktivitÃ¤t\x20in\x20','4424544VNNEYh','analysis.safety.deadMan.currentRoom','analysis.topology.structure','[DeadMan]\x20Topology\x20check\x20failed:\x20','%).\x20VerlÃ¤ngere\x20Timer\x20fÃ¼r\x20','6026470BWUzLq'];a2_0x3e76=function(){return _0x162ec3;};return a2_0x3e76();}let activeTimer=null,currentMonitoredRoom=null,timeoutMs=0x0,startTime=0x0,alarmStage=0x0;const DEFAULT_TIMEOUTS={'bad':0x2d,'bath':0x2d,'toilet':0x1e,'wc':0x1e,'keller':0x3c,'schlaf':0x78,'bed':0x78,'guest':0x5a,'gast':0x5a};async function loadConfig(_0x57a0fd){const _0x4b5470=a2_0x21a8;try{const _0x1bf429=await _0x57a0fd[_0x4b5470(0x8d)](_0x4b5470(0xb9));if(_0x1bf429&&_0x1bf429[_0x4b5470(0x9e)])return JSON[_0x4b5470(0xb5)](_0x1bf429['val']);}catch(_0x1c5e50){}return{};}async function isActive(_0x45afa7){const _0x2abe0c=a2_0x21a8;try{const _0x5631ad=await _0x45afa7[_0x2abe0c(0x8d)](_0x2abe0c(0xb8));return _0x5631ad&&_0x5631ad[_0x2abe0c(0x9e)];}catch(_0x55de8b){return![];}}async function areRoomsConnected(_0x7afb1f,_0x2d6320,_0x24b3e9){const _0x378f7d=a2_0x21a8;try{const _0x322a9b=await _0x7afb1f[_0x378f7d(0x8d)](_0x378f7d(0x96));if(!_0x322a9b||!_0x322a9b[_0x378f7d(0x9e)])return!![];const _0x14f5a0=JSON[_0x378f7d(0xb5)](_0x322a9b[_0x378f7d(0x9e)]),{rooms:_0x2b66b7,matrix:_0x185fcc}=_0x14f5a0;if(!_0x2b66b7||!_0x185fcc)return!![];const _0x1efaa9=_0x2b66b7[_0x378f7d(0xc1)](_0x2d6320),_0x3156ed=_0x2b66b7[_0x378f7d(0xc1)](_0x24b3e9);if(_0x1efaa9===-0x1||_0x3156ed===-0x1)return!![];const _0x3d34da=_0x185fcc[_0x1efaa9][_0x3156ed]>0x0||_0x185fcc[_0x3156ed][_0x1efaa9]>0x0;return _0x3d34da;}catch(_0x45367e){return _0x7afb1f[_0x378f7d(0x91)]['warn'](_0x378f7d(0x97)+_0x45367e['message']),!![];}}function calculateSleepProbability(_0x396d78){const _0x378030=a2_0x21a8,_0x7576d1=new Date(),_0x1a5767=_0x7576d1[_0x378030(0xaf)](),_0x48b113=_0x396d78[_0x378030(0xb6)]();let _0x35f69f=0.1;if(_0x1a5767>=0x17||_0x1a5767<=0x6)_0x35f69f=0x1;else{if(_0x1a5767>=0xd&&_0x1a5767<=0xf)_0x35f69f=0.8;else{if(_0x1a5767>=0x14&&_0x1a5767<=0x17)_0x35f69f=0.4;}}let _0x5165aa=0.1;if(_0x48b113['includes'](_0x378030(0xab))||_0x48b113[_0x378030(0xa7)](_0x378030(0x9f)))_0x5165aa=0x1;else{if(_0x48b113['includes'](_0x378030(0x9a))||_0x48b113['includes'](_0x378030(0xb1))||_0x48b113[_0x378030(0xa7)](_0x378030(0xa4)))_0x5165aa=0.6;else{if(_0x48b113['includes'](_0x378030(0xbe))||_0x48b113[_0x378030(0xa7)]('wc'))_0x5165aa=0.05;}}let _0x16d1ed=0.5;const _0x40ff7c=_0x5165aa*0.5+_0x35f69f*0.3+_0x16d1ed*0.2;return parseFloat(_0x40ff7c[_0x378030(0xc3)](0x2));}async function updateLocation(_0x160d8c,_0x4de38a){const _0x37a897=a2_0x21a8;if(!_0x4de38a||_0x4de38a==='Unknown')return;if(!await isActive(_0x160d8c)){resetTimer(_0x160d8c);return;}if(currentMonitoredRoom&&currentMonitoredRoom!==_0x4de38a){const _0x31e149=await areRoomsConnected(_0x160d8c,currentMonitoredRoom,_0x4de38a);if(!_0x31e149){const _0x2b13c7='Ignoriere\x20Bewegung\x20in\x20\x27'+_0x4de38a+_0x37a897(0xc0)+currentMonitoredRoom+'\x27.';_0x160d8c[_0x37a897(0x91)][_0x37a897(0xa2)](_0x37a897(0xbb)+_0x2b13c7+_0x37a897(0xb4)),await _0x160d8c['setStateAsync']('analysis.safety.deadMan.lastIgnored',{'val':JSON[_0x37a897(0x9b)]({'room':_0x4de38a,'reason':_0x2b13c7,'timestamp':Date['now']()}),'ack':!![]});return;}resetTimer(_0x160d8c);}if(!currentMonitoredRoom){await _0x160d8c[_0x37a897(0x90)](_0x37a897(0x95),{'val':_0x4de38a,'ack':!![]});const _0x2165fe=await loadConfig(_0x160d8c),_0x13140e=_0x4de38a[_0x37a897(0xb6)]();let _0x46c3ff=_0x2165fe[_0x4de38a]||_0x2165fe[_0x13140e];if(!_0x46c3ff)for(const _0x482c5b in DEFAULT_TIMEOUTS){if(_0x13140e[_0x37a897(0xa7)](_0x482c5b)){_0x46c3ff=DEFAULT_TIMEOUTS[_0x482c5b];break;}}if(!_0x46c3ff&&_0x2165fe['default'])_0x46c3ff=_0x2165fe[_0x37a897(0x9d)];if(!_0x46c3ff)return;currentMonitoredRoom=_0x4de38a,startTimer(_0x160d8c,_0x46c3ff,_0x4de38a);}}function startTimer(_0x567851,_0x2f5d8e,_0x4079ac){const _0xc54f5e=a2_0x21a8;if(activeTimer)clearTimeout(activeTimer);timeoutMs=_0x2f5d8e*0x3c*0x3e8,startTime=Date[_0xc54f5e(0xa5)](),alarmStage=0x0;const _0x38580d=calculateSleepProbability(_0x4079ac||currentMonitoredRoom),_0x13a504=_0x38580d>0.65;_0x13a504?(timeoutMs+=0x5a*0x3c*0x3e8,_0x567851[_0xc54f5e(0x91)][_0xc54f5e(0xa2)]('ðŸ’¤\x20Smart\x20Sleep\x20erkannt\x20('+(_0x38580d*0x64)['toFixed'](0x0)+_0xc54f5e(0x98)+currentMonitoredRoom+'\x20um\x2090\x20Min.'),_0x567851[_0xc54f5e(0x90)](_0xc54f5e(0x8e),{'val':!![],'ack':!![]})):_0x567851['setStateAsync'](_0xc54f5e(0x8e),{'val':![],'ack':!![]}),_0x567851[_0xc54f5e(0x90)](_0xc54f5e(0xb2),{'val':_0x38580d,'ack':!![]}),_0x567851[_0xc54f5e(0x91)][_0xc54f5e(0xa2)](_0xc54f5e(0xb3)+currentMonitoredRoom+_0xc54f5e(0xa1)+_0x2f5d8e+_0xc54f5e(0xc4)),_0x567851[_0xc54f5e(0x90)](_0xc54f5e(0xbd),{'val':'ok','ack':!![]}),activeTimer=setTimeout(()=>triggerPreWarn(_0x567851),timeoutMs);}function a2_0x21a8(_0x362aa0,_0x5e4a77){const _0x5e38fd=a2_0x3e76();return a2_0x21a8=function(_0x57a440,_0x219105){_0x57a440=_0x57a440-0x8d;let _0x3e76fe=_0x5e38fd[_0x57a440];return _0x3e76fe;},a2_0x21a8(_0x362aa0,_0x5e4a77);}function resetTimer(_0x224ea7){const _0x16636c=a2_0x21a8;if(activeTimer)clearTimeout(activeTimer);activeTimer=null,currentMonitoredRoom=null,alarmStage=0x0,_0x224ea7['setStateAsync'](_0x16636c(0xbd),{'val':'ok','ack':!![]}),_0x224ea7[_0x16636c(0x90)]('analysis.safety.deadMan.smartSleep',{'val':![],'ack':!![]}),_0x224ea7[_0x16636c(0x90)](_0x16636c(0xb2),{'val':0x0,'ack':!![]});}async function triggerPreWarn(_0x2f6eb4){const _0x53b970=a2_0x21a8;alarmStage=0x1,await _0x2f6eb4['setStateAsync'](_0x53b970(0xbd),{'val':'pre_warn','ack':!![]});const _0x42537d=_0x53b970(0x93)+currentMonitoredRoom+_0x53b970(0xba);_0x2f6eb4[_0x53b970(0x91)][_0x53b970(0xb7)](_0x53b970(0xbb)+_0x42537d),await setup['sendNotification'](_0x2f6eb4,_0x53b970(0xc2)+_0x42537d),activeTimer=setTimeout(()=>triggerAlarm(_0x2f6eb4),0x5*0x3c*0x3e8);}async function triggerAlarm(_0x171d5d){const _0x2ffd75=a2_0x21a8;alarmStage=0x2,await _0x171d5d[_0x2ffd75(0x90)](_0x2ffd75(0xbd),{'val':_0x2ffd75(0xbf),'ack':!![]});const _0x306b6c=_0x2ffd75(0xa6)+currentMonitoredRoom+'!';_0x171d5d[_0x2ffd75(0x91)][_0x2ffd75(0xa3)](_0x2ffd75(0xbb)+_0x306b6c),await setup[_0x2ffd75(0x92)](_0x171d5d,_0x306b6c,![],!![]);}module[a2_0x34e3cf(0xa8)]={'updateLocation':updateLocation};