const a2_0x4a4461=a2_0xa46a;(function(_0x1884dc,_0x27bbaa){const _0x5b9509=a2_0xa46a,_0xaab7b6=_0x1884dc();while(!![]){try{const _0x19f53c=-parseInt(_0x5b9509(0x79))/0x1+parseInt(_0x5b9509(0x9c))/0x2*(parseInt(_0x5b9509(0x90))/0x3)+parseInt(_0x5b9509(0x92))/0x4+parseInt(_0x5b9509(0x85))/0x5*(parseInt(_0x5b9509(0x98))/0x6)+parseInt(_0x5b9509(0x97))/0x7+-parseInt(_0x5b9509(0x8e))/0x8*(parseInt(_0x5b9509(0x77))/0x9)+-parseInt(_0x5b9509(0x95))/0xa;if(_0x19f53c===_0x27bbaa)break;else _0xaab7b6['push'](_0xaab7b6['shift']());}catch(_0x36819b){_0xaab7b6['push'](_0xaab7b6['shift']());}}}(a2_0x3682,0xb1dd1));function a2_0x3682(){const _0x18bf7d=['12sATiXY','stringify','5023448SolpfF','indexOf','analysis.safety.deadMan.active','16742580DQJrvr','search','8985823YgfUxx','3546gnvWmA','pre_warn','ðŸ‘¼\x20Schutzengel-Frage:\x20','setStateAsync','52282JtERYu','now','constructor','info','toString','.\x20Alles\x20in\x20Ordnung?','2397420SOMkbn','(((.+)+)+)+$','178735JAzRPX','ðŸš¨\x20NOTFALL-ALARM:\x20Person\x20reagiert\x20nicht\x20in\x20','ðŸ‘¼\x20Schutzengel:\x20Ãœberwache\x20','includes','\x20Min.','analysis.topology.structure','\x27.\x20Nicht\x20verbunden\x20mit\x20Ã¼berwachtem\x20\x27','getStateAsync','\x20fÃ¼r\x20','toLowerCase','exports','./setup','8485uHOGKi','analysis.safety.deadMan.config','log','sendNotification','warn','â³\x20ACHTUNG:\x20UngewÃ¶hnlich\x20lange\x20InaktivitÃ¤t\x20in\x20','analysis.safety.deadMan.alarmState','Ignoriere\x20Bewegung\x20in\x20\x27','val','32eegVGM','default'];a2_0x3682=function(){return _0x18bf7d;};return a2_0x3682();}function a2_0xa46a(_0x225521,_0x23a4b5){const _0x16d925=a2_0x3682();return a2_0xa46a=function(_0x5ba1ff,_0x3b2e9b){_0x5ba1ff=_0x5ba1ff-0x72;let _0x368206=_0x16d925[_0x5ba1ff];return _0x368206;},a2_0xa46a(_0x225521,_0x23a4b5);}const a2_0x3b2e9b=(function(){let _0x4170fe=!![];return function(_0x20dc42,_0xaab95){const _0xd06852=_0x4170fe?function(){if(_0xaab95){const _0x4c7f7a=_0xaab95['apply'](_0x20dc42,arguments);return _0xaab95=null,_0x4c7f7a;}}:function(){};return _0x4170fe=![],_0xd06852;};}()),a2_0x5ba1ff=a2_0x3b2e9b(this,function(){const _0x3f8958=a2_0xa46a;return a2_0x5ba1ff[_0x3f8958(0x75)]()[_0x3f8958(0x96)](_0x3f8958(0x78))[_0x3f8958(0x75)]()[_0x3f8958(0x73)](a2_0x5ba1ff)['search'](_0x3f8958(0x78));});a2_0x5ba1ff();'use strict';const setup=require(a2_0x4a4461(0x84));let activeTimer=null,currentMonitoredRoom=null,timeoutMs=0x0,startTime=0x0,alarmStage=0x0;const DEFAULT_TIMEOUTS={'bad':0x2d,'bath':0x2d,'toilet':0x1e,'wc':0x1e,'keller':0x3c};async function loadConfig(_0x3d8d6b){const _0x4ee546=a2_0x4a4461;try{const _0x3f6082=await _0x3d8d6b['getStateAsync'](_0x4ee546(0x86));if(_0x3f6082&&_0x3f6082[_0x4ee546(0x8d)])return JSON['parse'](_0x3f6082[_0x4ee546(0x8d)]);}catch(_0x55a2f4){}return{};}async function isActive(_0x38e232){const _0x55f82f=a2_0x4a4461;try{const _0x2a2cee=await _0x38e232[_0x55f82f(0x80)](_0x55f82f(0x94));return _0x2a2cee&&_0x2a2cee[_0x55f82f(0x8d)];}catch(_0xd38f1d){return![];}}async function areRoomsConnected(_0x375d73,_0xa87f52,_0x58ae3a){const _0x461768=a2_0x4a4461;try{const _0x28cfad=await _0x375d73['getStateAsync'](_0x461768(0x7e));if(!_0x28cfad||!_0x28cfad[_0x461768(0x8d)])return!![];const _0x751609=JSON['parse'](_0x28cfad[_0x461768(0x8d)]),{rooms:_0x38338d,matrix:_0xb10c20}=_0x751609;if(!_0x38338d||!_0xb10c20)return!![];const _0x4fcc4e=_0x38338d[_0x461768(0x93)](_0xa87f52),_0x51e726=_0x38338d[_0x461768(0x93)](_0x58ae3a);if(_0x4fcc4e===-0x1||_0x51e726===-0x1)return!![];const _0x1bb427=_0xb10c20[_0x4fcc4e][_0x51e726]>0x0||_0xb10c20[_0x51e726][_0x4fcc4e]>0x0;return _0x1bb427;}catch(_0x43302d){return _0x375d73['log'][_0x461768(0x89)]('[DeadMan]\x20Topology\x20check\x20failed:\x20'+_0x43302d['message']),!![];}}async function updateLocation(_0x123b36,_0x3bddc5){const _0x2c730a=a2_0x4a4461;if(!_0x3bddc5||_0x3bddc5==='Unknown')return;if(!await isActive(_0x123b36)){resetTimer(_0x123b36);return;}if(currentMonitoredRoom&&currentMonitoredRoom!==_0x3bddc5){const _0x82b71a=await areRoomsConnected(_0x123b36,currentMonitoredRoom,_0x3bddc5);if(!_0x82b71a){const _0x1a0e01=_0x2c730a(0x8c)+_0x3bddc5+_0x2c730a(0x7f)+currentMonitoredRoom+'\x27.';_0x123b36[_0x2c730a(0x87)][_0x2c730a(0x74)]('[DeadMan]\x20'+_0x1a0e01+'\x20(Multi-Person\x20Filter)'),await _0x123b36[_0x2c730a(0x9b)]('analysis.safety.deadMan.lastIgnored',{'val':JSON[_0x2c730a(0x91)]({'room':_0x3bddc5,'reason':_0x1a0e01,'timestamp':Date[_0x2c730a(0x72)]()}),'ack':!![]});return;}resetTimer(_0x123b36);}if(!currentMonitoredRoom){await _0x123b36[_0x2c730a(0x9b)]('analysis.safety.deadMan.currentRoom',{'val':_0x3bddc5,'ack':!![]});const _0x36fb87=await loadConfig(_0x123b36),_0x1138ac=_0x3bddc5[_0x2c730a(0x82)]();let _0x4b5d2d=_0x36fb87[_0x3bddc5]||_0x36fb87[_0x1138ac];if(!_0x4b5d2d)for(const _0x4901e9 in DEFAULT_TIMEOUTS){if(_0x1138ac[_0x2c730a(0x7c)](_0x4901e9)){_0x4b5d2d=DEFAULT_TIMEOUTS[_0x4901e9];break;}}if(!_0x4b5d2d&&_0x36fb87[_0x2c730a(0x8f)])_0x4b5d2d=_0x36fb87['default'];if(!_0x4b5d2d)return;currentMonitoredRoom=_0x3bddc5,startTimer(_0x123b36,_0x4b5d2d);}}function startTimer(_0x247955,_0x9629cb){const _0xa86cd8=a2_0x4a4461;if(activeTimer)clearTimeout(activeTimer);timeoutMs=_0x9629cb*0x3c*0x3e8,startTime=Date[_0xa86cd8(0x72)](),alarmStage=0x0,_0x247955[_0xa86cd8(0x87)][_0xa86cd8(0x74)](_0xa86cd8(0x7b)+currentMonitoredRoom+_0xa86cd8(0x81)+_0x9629cb+_0xa86cd8(0x7d)),_0x247955[_0xa86cd8(0x9b)](_0xa86cd8(0x8b),{'val':'ok','ack':!![]}),activeTimer=setTimeout(()=>triggerPreWarn(_0x247955),timeoutMs);}function resetTimer(_0x48bc6e){const _0x48f0e4=a2_0x4a4461;if(activeTimer)clearTimeout(activeTimer);activeTimer=null,currentMonitoredRoom=null,alarmStage=0x0,_0x48bc6e['setStateAsync'](_0x48f0e4(0x8b),{'val':'ok','ack':!![]});}async function triggerPreWarn(_0x3559dd){const _0x9a0d9d=a2_0x4a4461;alarmStage=0x1,await _0x3559dd[_0x9a0d9d(0x9b)]('analysis.safety.deadMan.alarmState',{'val':_0x9a0d9d(0x99),'ack':!![]});const _0x214669=_0x9a0d9d(0x8a)+currentMonitoredRoom+_0x9a0d9d(0x76);_0x3559dd[_0x9a0d9d(0x87)][_0x9a0d9d(0x89)]('[DeadMan]\x20'+_0x214669),await setup[_0x9a0d9d(0x88)](_0x3559dd,_0x9a0d9d(0x9a)+_0x214669),activeTimer=setTimeout(()=>triggerAlarm(_0x3559dd),0x5*0x3c*0x3e8);}async function triggerAlarm(_0x39e9ef){const _0xe52763=a2_0x4a4461;alarmStage=0x2,await _0x39e9ef[_0xe52763(0x9b)]('analysis.safety.deadMan.alarmState',{'val':'alarm','ack':!![]});const _0x3078b4=_0xe52763(0x7a)+currentMonitoredRoom+'!';_0x39e9ef[_0xe52763(0x87)]['error']('[DeadMan]\x20'+_0x3078b4),await setup[_0xe52763(0x88)](_0x39e9ef,_0x3078b4,![],!![]);}module[a2_0x4a4461(0x83)]={'updateLocation':updateLocation};