const a2_0xeee101=a2_0x4b87;(function(_0xdaf8c4,_0x569b2c){const _0x472f53=a2_0x4b87,_0x3fdaac=_0xdaf8c4();while(!![]){try{const _0x2ffb9d=parseInt(_0x472f53(0x104))/0x1*(parseInt(_0x472f53(0x120))/0x2)+parseInt(_0x472f53(0x124))/0x3*(parseInt(_0x472f53(0x102))/0x4)+parseInt(_0x472f53(0x117))/0x5+parseInt(_0x472f53(0x113))/0x6*(-parseInt(_0x472f53(0x112))/0x7)+parseInt(_0x472f53(0xef))/0x8+-parseInt(_0x472f53(0x10a))/0x9*(-parseInt(_0x472f53(0x116))/0xa)+-parseInt(_0x472f53(0x11a))/0xb;if(_0x2ffb9d===_0x569b2c)break;else _0x3fdaac['push'](_0x3fdaac['shift']());}catch(_0x16c498){_0x3fdaac['push'](_0x3fdaac['shift']());}}}(a2_0x29bd,0xc26a7));const a2_0x39967e=(function(){let _0x11d0cd=!![];return function(_0x329dac,_0x56e39a){const _0x2a4e9b=_0x11d0cd?function(){const _0x49c228=a2_0x4b87;if(_0x56e39a){const _0x3805dd=_0x56e39a[_0x49c228(0x10c)](_0x329dac,arguments);return _0x56e39a=null,_0x3805dd;}}:function(){};return _0x11d0cd=![],_0x2a4e9b;};}()),a2_0xf3ae11=a2_0x39967e(this,function(){const _0x6d7627=a2_0x4b87;return a2_0xf3ae11[_0x6d7627(0xf8)]()[_0x6d7627(0xfc)](_0x6d7627(0xec))['toString']()[_0x6d7627(0x10d)](a2_0xf3ae11)[_0x6d7627(0xfc)]('(((.+)+)+)+$');});a2_0xf3ae11();'use strict';const setup=require(a2_0xeee101(0x11b));let activeTimer=null,currentMonitoredRoom=null,timeoutMs=0x0,startTime=0x0,alarmStage=0x0;function a2_0x4b87(_0xf7355c,_0x1cd32d){const _0x896c64=a2_0x29bd();return a2_0x4b87=function(_0xf3ae11,_0x39967e){_0xf3ae11=_0xf3ae11-0xe9;let _0x29bdf4=_0x896c64[_0xf3ae11];return _0x29bdf4;},a2_0x4b87(_0xf7355c,_0x1cd32d);}const DEFAULT_TIMEOUTS={'bad':0x2d,'bath':0x2d,'toilet':0x1e,'wc':0x1e,'keller':0x3c,'schlaf':0x78,'bed':0x78,'guest':0x5a,'gast':0x5a};function getTimeoutRobust(_0x1e6997,_0x2952a1){const _0x5ccd3d=a2_0xeee101;if(!_0x1e6997||!_0x2952a1)return undefined;if(_0x1e6997[_0x2952a1])return _0x1e6997[_0x2952a1];const _0x13b2ea=_0x2952a1['toLowerCase']()['replace'](/[^a-z0-9]/g,'');for(const _0xa79b4f in _0x1e6997){const _0x2111f3=_0xa79b4f[_0x5ccd3d(0x123)]()['replace'](/[^a-z0-9]/g,'');if(_0x2111f3===_0x13b2ea)return _0x1e6997[_0xa79b4f];}const _0x433255=_0x2952a1['toLowerCase']();if(_0x1e6997[_0x433255])return _0x1e6997[_0x433255];return undefined;}async function loadConfig(_0x17908d){const _0x7e56df=a2_0xeee101;try{const _0x245dac=await _0x17908d[_0x7e56df(0x11e)](_0x7e56df(0xfd));if(_0x245dac&&_0x245dac[_0x7e56df(0x114)])return JSON['parse'](_0x245dac[_0x7e56df(0x114)]);}catch(_0x4b8293){}return{};}async function isActive(_0x1fe53b){const _0x22b036=a2_0xeee101;try{const _0x4842cd=await _0x1fe53b['getStateAsync'](_0x22b036(0x119));return _0x4842cd&&_0x4842cd[_0x22b036(0x114)];}catch(_0x2e5dfd){return![];}}async function areRoomsConnected(_0x3b17e2,_0xd8ece7,_0x488f4d){const _0x20efa3=a2_0xeee101;try{const _0xb071b1=await _0x3b17e2[_0x20efa3(0x11e)]('analysis.topology.structure');if(!_0xb071b1||!_0xb071b1[_0x20efa3(0x114)])return!![];const _0x28e0c2=JSON[_0x20efa3(0x108)](_0xb071b1[_0x20efa3(0x114)]),{rooms:_0x4e80b8,matrix:_0xf75734}=_0x28e0c2;if(!_0x4e80b8||!_0xf75734)return!![];const _0x7b0a0c=_0x4e80b8[_0x20efa3(0x11d)](_0xd8ece7),_0x26bf1c=_0x4e80b8['indexOf'](_0x488f4d);if(_0x7b0a0c===-0x1||_0x26bf1c===-0x1)return!![];const _0x3add2e=_0xf75734[_0x7b0a0c][_0x26bf1c]>0x0||_0xf75734[_0x26bf1c][_0x7b0a0c]>0x0;return _0x3add2e;}catch(_0x1ce21c){return _0x3b17e2[_0x20efa3(0xf6)]['warn']('[DeadMan]\x20Topology\x20check\x20failed:\x20'+_0x1ce21c[_0x20efa3(0xf2)]),!![];}}function a2_0x29bd(){const _0x1deca5=['ðŸ’¤\x20Smart\x20Sleep\x20erkannt\x20(','apply','constructor','sofa','analysis.safety.deadMan.currentRoom','getHours','[DeadMan]\x20','177611eTAFGx','366UiTBMT','val','stringify','521380cApalx','3516690SktHyH','analysis.safety.deadMan.smartSleep','analysis.safety.deadMan.active','38086345avSgDG','./setup','\x20fÃ¼r\x20','indexOf','getStateAsync','error','14XLeJLX','default','\x20(Multi-Person\x20Filter)','toLowerCase','2838QZvTyy','â³\x20ACHTUNG:\x20UngewÃ¶hnlich\x20lange\x20InaktivitÃ¤t\x20in\x20','living','now','\x20um\x2090\x20Min.','(((.+)+)+)+$','bad','\x20Min.','12527984vJVVmM','analysis.safety.deadMan.alarmState','analysis.safety.deadMan.napProbability','message','schlaf','ðŸš¨\x20NOTFALL-ALARM:\x20Person\x20reagiert\x20nicht\x20in\x20','setStateAsync','log','Unknown','toString','toFixed','%).\x20VerlÃ¤ngere\x20Timer\x20fÃ¼r\x20','info','search','analysis.safety.deadMan.config','bed','wohn','.\x20Alles\x20in\x20Ordnung?','ðŸ‘¼\x20Schutzengel-Frage:\x20','4000GMwaPa','alarm','221197QUWNBu','sendNotification','Ignoriere\x20Bewegung\x20in\x20\x27','pre_warn','parse','includes','180QxtHYi'];a2_0x29bd=function(){return _0x1deca5;};return a2_0x29bd();}function calculateSleepProbability(_0x75237b){const _0x394676=a2_0xeee101,_0x1dcf95=new Date(),_0x1e21c9=_0x1dcf95[_0x394676(0x110)](),_0x416d59=_0x75237b['toLowerCase']();let _0x23b553=0.1;if(_0x1e21c9>=0x17||_0x1e21c9<=0x6)_0x23b553=0x1;else{if(_0x1e21c9>=0xd&&_0x1e21c9<=0xf)_0x23b553=0.8;else{if(_0x1e21c9>=0x14&&_0x1e21c9<=0x17)_0x23b553=0.4;}}let _0x1f717f=0.1;if(_0x416d59[_0x394676(0x109)](_0x394676(0xf3))||_0x416d59[_0x394676(0x109)](_0x394676(0xfe)))_0x1f717f=0x1;else{if(_0x416d59['includes'](_0x394676(0xff))||_0x416d59[_0x394676(0x109)](_0x394676(0xe9))||_0x416d59[_0x394676(0x109)](_0x394676(0x10e)))_0x1f717f=0.6;else{if(_0x416d59[_0x394676(0x109)](_0x394676(0xed))||_0x416d59[_0x394676(0x109)]('wc'))_0x1f717f=0.05;}}let _0x17eec7=0.5;const _0x49cd93=_0x1f717f*0.5+_0x23b553*0.3+_0x17eec7*0.2;return parseFloat(_0x49cd93['toFixed'](0x2));}async function updateLocation(_0x45e2b6,_0x1cb844){const _0x443aff=a2_0xeee101;if(!_0x1cb844||_0x1cb844===_0x443aff(0xf7))return;if(!await isActive(_0x45e2b6)){resetTimer(_0x45e2b6);return;}if(currentMonitoredRoom&&currentMonitoredRoom!==_0x1cb844){const _0x230c74=await areRoomsConnected(_0x45e2b6,currentMonitoredRoom,_0x1cb844);if(!_0x230c74){const _0x5d9729=_0x443aff(0x106)+_0x1cb844+'\x27.\x20Nicht\x20verbunden\x20mit\x20Ã¼berwachtem\x20\x27'+currentMonitoredRoom+'\x27.';_0x45e2b6[_0x443aff(0xf6)][_0x443aff(0xfb)](_0x443aff(0x111)+_0x5d9729+_0x443aff(0x122)),await _0x45e2b6[_0x443aff(0xf5)]('analysis.safety.deadMan.lastIgnored',{'val':JSON[_0x443aff(0x115)]({'room':_0x1cb844,'reason':_0x5d9729,'timestamp':Date[_0x443aff(0xea)]()}),'ack':!![]});return;}resetTimer(_0x45e2b6);}if(!currentMonitoredRoom){await _0x45e2b6[_0x443aff(0xf5)](_0x443aff(0x10f),{'val':_0x1cb844,'ack':!![]});const _0x2659b0=await loadConfig(_0x45e2b6);let _0x5bbd35=getTimeoutRobust(_0x2659b0,_0x1cb844);const _0x3fb927=_0x1cb844['toLowerCase']();if(!_0x5bbd35)for(const _0x136ce1 in DEFAULT_TIMEOUTS){if(_0x3fb927[_0x443aff(0x109)](_0x136ce1)){_0x5bbd35=DEFAULT_TIMEOUTS[_0x136ce1];break;}}if(!_0x5bbd35&&_0x2659b0[_0x443aff(0x121)])_0x5bbd35=_0x2659b0[_0x443aff(0x121)];if(!_0x5bbd35)return;currentMonitoredRoom=_0x1cb844,startTimer(_0x45e2b6,_0x5bbd35,_0x1cb844);}}function startTimer(_0x169271,_0x3bab5f,_0x3b4439){const _0x46cb8b=a2_0xeee101;if(activeTimer)clearTimeout(activeTimer);timeoutMs=_0x3bab5f*0x3c*0x3e8,startTime=Date['now'](),alarmStage=0x0;const _0x1884b8=calculateSleepProbability(_0x3b4439||currentMonitoredRoom),_0x5a60f7=_0x1884b8>0.65;_0x5a60f7?(timeoutMs+=0x5a*0x3c*0x3e8,_0x169271[_0x46cb8b(0xf6)][_0x46cb8b(0xfb)](_0x46cb8b(0x10b)+(_0x1884b8*0x64)[_0x46cb8b(0xf9)](0x0)+_0x46cb8b(0xfa)+currentMonitoredRoom+_0x46cb8b(0xeb)),_0x169271[_0x46cb8b(0xf5)](_0x46cb8b(0x118),{'val':!![],'ack':!![]})):_0x169271['setStateAsync'](_0x46cb8b(0x118),{'val':![],'ack':!![]}),_0x169271[_0x46cb8b(0xf5)](_0x46cb8b(0xf1),{'val':_0x1884b8,'ack':!![]}),_0x169271['log'][_0x46cb8b(0xfb)]('ðŸ‘¼\x20Schutzengel:\x20Ãœberwache\x20'+currentMonitoredRoom+_0x46cb8b(0x11c)+_0x3bab5f+_0x46cb8b(0xee)),_0x169271[_0x46cb8b(0xf5)](_0x46cb8b(0xf0),{'val':'ok','ack':!![]}),activeTimer=setTimeout(()=>triggerPreWarn(_0x169271),timeoutMs);}function resetTimer(_0xe89ec4){const _0x49444b=a2_0xeee101;if(activeTimer)clearTimeout(activeTimer);activeTimer=null,currentMonitoredRoom=null,alarmStage=0x0,_0xe89ec4[_0x49444b(0xf5)](_0x49444b(0xf0),{'val':'ok','ack':!![]}),_0xe89ec4[_0x49444b(0xf5)]('analysis.safety.deadMan.smartSleep',{'val':![],'ack':!![]}),_0xe89ec4[_0x49444b(0xf5)](_0x49444b(0xf1),{'val':0x0,'ack':!![]});}async function triggerPreWarn(_0x2151f6){const _0x291669=a2_0xeee101;alarmStage=0x1,await _0x2151f6['setStateAsync'](_0x291669(0xf0),{'val':_0x291669(0x107),'ack':!![]});const _0x10ab67=_0x291669(0x125)+currentMonitoredRoom+_0x291669(0x100);_0x2151f6[_0x291669(0xf6)]['warn'](_0x291669(0x111)+_0x10ab67),await setup[_0x291669(0x105)](_0x2151f6,_0x291669(0x101)+_0x10ab67),activeTimer=setTimeout(()=>triggerAlarm(_0x2151f6),0x5*0x3c*0x3e8);}async function triggerAlarm(_0x5baac9){const _0x152ca2=a2_0xeee101;alarmStage=0x2,await _0x5baac9[_0x152ca2(0xf5)](_0x152ca2(0xf0),{'val':_0x152ca2(0x103),'ack':!![]});const _0x4d4d98=_0x152ca2(0xf4)+currentMonitoredRoom+'!';_0x5baac9['log'][_0x152ca2(0x11f)]('[DeadMan]\x20'+_0x4d4d98),await setup[_0x152ca2(0x105)](_0x5baac9,_0x4d4d98,![],!![]);}module['exports']={'updateLocation':updateLocation};