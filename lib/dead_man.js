const a2_0x5cb80b=a2_0x4563;(function(_0x40ade4,_0x3a77ee){const _0x1a295c=a2_0x4563,_0x45ca4d=_0x40ade4();while(!![]){try{const _0x4ab545=-parseInt(_0x1a295c(0x18f))/0x1+parseInt(_0x1a295c(0x188))/0x2+-parseInt(_0x1a295c(0x1ac))/0x3*(-parseInt(_0x1a295c(0x18e))/0x4)+parseInt(_0x1a295c(0x1a4))/0x5*(parseInt(_0x1a295c(0x198))/0x6)+-parseInt(_0x1a295c(0x18c))/0x7*(-parseInt(_0x1a295c(0x185))/0x8)+parseInt(_0x1a295c(0x19a))/0x9*(parseInt(_0x1a295c(0x184))/0xa)+-parseInt(_0x1a295c(0x19f))/0xb*(parseInt(_0x1a295c(0x1a3))/0xc);if(_0x4ab545===_0x3a77ee)break;else _0x45ca4d['push'](_0x45ca4d['shift']());}catch(_0x18551d){_0x45ca4d['push'](_0x45ca4d['shift']());}}}(a2_0x310c,0x1f152));function a2_0x4563(_0x590e4e,_0x439064){const _0x475fe3=a2_0x310c();return a2_0x4563=function(_0x4e70e5,_0xc93c97){_0x4e70e5=_0x4e70e5-0x181;let _0x310c4e=_0x475fe3[_0x4e70e5];return _0x310c4e;},a2_0x4563(_0x590e4e,_0x439064);}const a2_0xc93c97=(function(){let _0x4e004b=!![];return function(_0x1b8c4e,_0xbd11a9){const _0x3a832f=_0x4e004b?function(){if(_0xbd11a9){const _0xe270ae=_0xbd11a9['apply'](_0x1b8c4e,arguments);return _0xbd11a9=null,_0xe270ae;}}:function(){};return _0x4e004b=![],_0x3a832f;};}()),a2_0x4e70e5=a2_0xc93c97(this,function(){const _0x40ec6c=a2_0x4563;return a2_0x4e70e5[_0x40ec6c(0x19c)]()[_0x40ec6c(0x192)]('(((.+)+)+)+$')[_0x40ec6c(0x19c)]()[_0x40ec6c(0x199)](a2_0x4e70e5)[_0x40ec6c(0x192)](_0x40ec6c(0x18a));});function a2_0x310c(){const _0x31126a=['ðŸš¨\x20NOTFALL-ALARM:\x20Person\x20reagiert\x20nicht\x20in\x20','[DeadMan]\x20Topology\x20check\x20failed:\x20','33xJrutz','log','now','alarm','1116036NLbTPF','20585HJfRiI','error','pre_warn','sendNotification','ðŸ‘¼\x20Schutzengel-Frage:\x20','getStateAsync','parse','analysis.safety.deadMan.lastIgnored','3672czATvm','\x20(Multi-Person\x20Filter)','info','indexOf','stringify','\x20Min.','\x27.\x20Nicht\x20verbunden\x20mit\x20Ã¼berwachtem\x20\x27','Ignoriere\x20Bewegung\x20in\x20\x27','\x20fÃ¼r\x20','Unknown','1045530teTggO','70248qDRRtq','./setup','â³\x20ACHTUNG:\x20UngewÃ¶hnlich\x20lange\x20InaktivitÃ¤t\x20in\x20','403404MDDRwK','setStateAsync','(((.+)+)+)+$','message','14vxEFyY','val','284bLInyE','125419QruWlR','analysis.safety.deadMan.alarmState','warn','search','default','toLowerCase','ðŸ‘¼\x20Schutzengel:\x20Ãœberwache\x20','analysis.safety.deadMan.currentRoom','includes','24wAuClu','constructor','18ZkBIua','exports','toString'];a2_0x310c=function(){return _0x31126a;};return a2_0x310c();}a2_0x4e70e5();'use strict';const setup=require(a2_0x5cb80b(0x186));let activeTimer=null,currentMonitoredRoom=null,timeoutMs=0x0,startTime=0x0,alarmStage=0x0;const DEFAULT_TIMEOUTS={'bad':0x2d,'bath':0x2d,'toilet':0x1e,'wc':0x1e,'keller':0x3c};async function loadConfig(_0x1b13a8){const _0x522753=a2_0x5cb80b;try{const _0x3fde6=await _0x1b13a8[_0x522753(0x1a9)]('analysis.safety.deadMan.config');if(_0x3fde6&&_0x3fde6['val'])return JSON[_0x522753(0x1aa)](_0x3fde6[_0x522753(0x18d)]);}catch(_0x33cfa0){}return{};}async function isActive(_0x19926c){const _0x47b574=a2_0x5cb80b;try{const _0x50b1a1=await _0x19926c[_0x47b574(0x1a9)]('analysis.safety.deadMan.active');return _0x50b1a1&&_0x50b1a1[_0x47b574(0x18d)];}catch(_0x31d454){return![];}}async function areRoomsConnected(_0x3e5020,_0x2d69d4,_0x3e70b2){const _0x3fec7c=a2_0x5cb80b;try{const _0x6ac0bc=await _0x3e5020[_0x3fec7c(0x1a9)]('analysis.topology.structure');if(!_0x6ac0bc||!_0x6ac0bc[_0x3fec7c(0x18d)])return!![];const _0x44fe73=JSON['parse'](_0x6ac0bc[_0x3fec7c(0x18d)]),{rooms:_0x181c05,matrix:_0x46bba1}=_0x44fe73;if(!_0x181c05||!_0x46bba1)return!![];const _0x13e693=_0x181c05[_0x3fec7c(0x1af)](_0x2d69d4),_0xdb2f4a=_0x181c05[_0x3fec7c(0x1af)](_0x3e70b2);if(_0x13e693===-0x1||_0xdb2f4a===-0x1)return!![];const _0x49726e=_0x46bba1[_0x13e693][_0xdb2f4a]>0x0||_0x46bba1[_0xdb2f4a][_0x13e693]>0x0;return _0x49726e;}catch(_0x1df7e1){return _0x3e5020[_0x3fec7c(0x1a0)][_0x3fec7c(0x191)](_0x3fec7c(0x19e)+_0x1df7e1[_0x3fec7c(0x18b)]),!![];}}async function updateLocation(_0x5687f0,_0x3d658b){const _0x1d6c14=a2_0x5cb80b;if(!_0x3d658b||_0x3d658b===_0x1d6c14(0x183))return;if(!await isActive(_0x5687f0)){resetTimer(_0x5687f0);return;}if(currentMonitoredRoom&&currentMonitoredRoom!==_0x3d658b){const _0x4ac79e=await areRoomsConnected(_0x5687f0,currentMonitoredRoom,_0x3d658b);if(!_0x4ac79e){const _0x264615=_0x1d6c14(0x181)+_0x3d658b+_0x1d6c14(0x1b2)+currentMonitoredRoom+'\x27.';_0x5687f0[_0x1d6c14(0x1a0)][_0x1d6c14(0x1ae)]('[DeadMan]\x20'+_0x264615+_0x1d6c14(0x1ad)),await _0x5687f0['setStateAsync'](_0x1d6c14(0x1ab),{'val':JSON[_0x1d6c14(0x1b0)]({'room':_0x3d658b,'reason':_0x264615,'timestamp':Date[_0x1d6c14(0x1a1)]()}),'ack':!![]});return;}resetTimer(_0x5687f0);}if(!currentMonitoredRoom){await _0x5687f0[_0x1d6c14(0x189)](_0x1d6c14(0x196),{'val':_0x3d658b,'ack':!![]});const _0x3d7d01=await loadConfig(_0x5687f0),_0x5dac6a=_0x3d658b[_0x1d6c14(0x194)]();let _0x408b2c=_0x3d7d01[_0x3d658b]||_0x3d7d01[_0x5dac6a];if(!_0x408b2c)for(const _0x45ff20 in DEFAULT_TIMEOUTS){if(_0x5dac6a[_0x1d6c14(0x197)](_0x45ff20)){_0x408b2c=DEFAULT_TIMEOUTS[_0x45ff20];break;}}if(!_0x408b2c&&_0x3d7d01[_0x1d6c14(0x193)])_0x408b2c=_0x3d7d01[_0x1d6c14(0x193)];if(!_0x408b2c)return;currentMonitoredRoom=_0x3d658b,startTimer(_0x5687f0,_0x408b2c);}}function startTimer(_0x184577,_0x102367){const _0x2d2571=a2_0x5cb80b;if(activeTimer)clearTimeout(activeTimer);timeoutMs=_0x102367*0x3c*0x3e8,startTime=Date[_0x2d2571(0x1a1)](),alarmStage=0x0,_0x184577[_0x2d2571(0x1a0)][_0x2d2571(0x1ae)](_0x2d2571(0x195)+currentMonitoredRoom+_0x2d2571(0x182)+_0x102367+_0x2d2571(0x1b1)),_0x184577[_0x2d2571(0x189)](_0x2d2571(0x190),{'val':'ok','ack':!![]}),activeTimer=setTimeout(()=>triggerPreWarn(_0x184577),timeoutMs);}function resetTimer(_0x1bc550){const _0x1d98fa=a2_0x5cb80b;if(activeTimer)clearTimeout(activeTimer);activeTimer=null,currentMonitoredRoom=null,alarmStage=0x0,_0x1bc550['setStateAsync'](_0x1d98fa(0x190),{'val':'ok','ack':!![]});}async function triggerPreWarn(_0x3abbce){const _0x437507=a2_0x5cb80b;alarmStage=0x1,await _0x3abbce[_0x437507(0x189)]('analysis.safety.deadMan.alarmState',{'val':_0x437507(0x1a6),'ack':!![]});const _0x1a4bfc=_0x437507(0x187)+currentMonitoredRoom+'.\x20Alles\x20in\x20Ordnung?';_0x3abbce['log'][_0x437507(0x191)]('[DeadMan]\x20'+_0x1a4bfc),await setup[_0x437507(0x1a7)](_0x3abbce,_0x437507(0x1a8)+_0x1a4bfc),activeTimer=setTimeout(()=>triggerAlarm(_0x3abbce),0x5*0x3c*0x3e8);}async function triggerAlarm(_0x27e29d){const _0x216495=a2_0x5cb80b;alarmStage=0x2,await _0x27e29d[_0x216495(0x189)](_0x216495(0x190),{'val':_0x216495(0x1a2),'ack':!![]});const _0x54e7d2=_0x216495(0x19d)+currentMonitoredRoom+'!';_0x27e29d[_0x216495(0x1a0)][_0x216495(0x1a5)]('[DeadMan]\x20'+_0x54e7d2),await setup[_0x216495(0x1a7)](_0x27e29d,_0x54e7d2,![],!![]);}module[a2_0x5cb80b(0x19b)]={'updateLocation':updateLocation};