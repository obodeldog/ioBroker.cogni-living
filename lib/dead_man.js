const a2_0x39e9d6=a2_0x1780;(function(_0xb06f25,_0x4a82c8){const _0x1fdb1d=a2_0x1780,_0x3db385=_0xb06f25();while(!![]){try{const _0x37ca5f=parseInt(_0x1fdb1d(0x147))/0x1*(-parseInt(_0x1fdb1d(0x17c))/0x2)+-parseInt(_0x1fdb1d(0x143))/0x3*(-parseInt(_0x1fdb1d(0x14c))/0x4)+parseInt(_0x1fdb1d(0x176))/0x5+parseInt(_0x1fdb1d(0x162))/0x6+parseInt(_0x1fdb1d(0x169))/0x7*(parseInt(_0x1fdb1d(0x171))/0x8)+parseInt(_0x1fdb1d(0x14b))/0x9*(parseInt(_0x1fdb1d(0x178))/0xa)+-parseInt(_0x1fdb1d(0x177))/0xb*(parseInt(_0x1fdb1d(0x156))/0xc);if(_0x37ca5f===_0x4a82c8)break;else _0x3db385['push'](_0x3db385['shift']());}catch(_0x9e0600){_0x3db385['push'](_0x3db385['shift']());}}}(a2_0x52c7,0x1e964));const a2_0x1d34d8=(function(){let _0x98e4e=!![];return function(_0x46fe8f,_0x31357b){const _0x540de1=_0x98e4e?function(){if(_0x31357b){const _0x2ca9bd=_0x31357b['apply'](_0x46fe8f,arguments);return _0x31357b=null,_0x2ca9bd;}}:function(){};return _0x98e4e=![],_0x540de1;};}()),a2_0x2c1bd6=a2_0x1d34d8(this,function(){const _0x64c3d=a2_0x1780;return a2_0x2c1bd6[_0x64c3d(0x16c)]()[_0x64c3d(0x151)]('(((.+)+)+)+$')[_0x64c3d(0x16c)]()[_0x64c3d(0x144)](a2_0x2c1bd6)[_0x64c3d(0x151)](_0x64c3d(0x16d));});a2_0x2c1bd6();'use strict';const setup=require(a2_0x39e9d6(0x17a));let activeTimer=null,currentMonitoredRoom=null,timeoutMs=0x0,startTime=0x0,alarmStage=0x0;const DEFAULT_TIMEOUTS={'bad':0x2d,'bath':0x2d,'toilet':0x1e,'wc':0x1e,'keller':0x3c,'schlaf':0x78,'bed':0x78,'guest':0x5a,'gast':0x5a};function getTimeoutRobust(_0x27ea12,_0x407324){const _0x24f1ae=a2_0x39e9d6;if(!_0x27ea12||!_0x407324)return undefined;if(_0x27ea12[_0x407324])return _0x27ea12[_0x407324];const _0x350f8d=_0x407324['toLowerCase']()[_0x24f1ae(0x165)](/[^a-z0-9]/g,'');for(const _0x1e4370 in _0x27ea12){const _0xa86e49=_0x1e4370[_0x24f1ae(0x16b)]()['replace'](/[^a-z0-9]/g,'');if(_0xa86e49===_0x350f8d)return _0x27ea12[_0x1e4370];}const _0x29c839=_0x407324['toLowerCase']();if(_0x27ea12[_0x29c839])return _0x27ea12[_0x29c839];return undefined;}async function loadConfig(_0x5c12a6){const _0x2eaf8f=a2_0x39e9d6;try{const _0x512df1=await _0x5c12a6[_0x2eaf8f(0x16a)](_0x2eaf8f(0x172));if(_0x512df1&&_0x512df1[_0x2eaf8f(0x173)])return JSON['parse'](_0x512df1[_0x2eaf8f(0x173)]);}catch(_0x4f335a){}return{};}function a2_0x1780(_0x11d189,_0x11b006){const _0x2adb4b=a2_0x52c7();return a2_0x1780=function(_0x2c1bd6,_0x1d34d8){_0x2c1bd6=_0x2c1bd6-0x142;let _0x52c751=_0x2adb4b[_0x2c1bd6];return _0x52c751;},a2_0x1780(_0x11d189,_0x11b006);}async function isActive(_0x4a9e9f){const _0x2a1d91=a2_0x39e9d6;try{const _0x32bbed=await _0x4a9e9f[_0x2a1d91(0x16a)](_0x2a1d91(0x150));return _0x32bbed&&_0x32bbed[_0x2a1d91(0x173)];}catch(_0x3fe946){return![];}}function a2_0x52c7(){const _0x1ad4e2=['wohn','114384qoUGbP','toFixed','parse','[DeadMan]\x20','indexOf','info','now','analysis.safety.deadMan.smartSleep','analysis.safety.deadMan.napProbability','alarm','analysis.topology.structure','ðŸš¨\x20NOTFALL-ALARM:\x20Person\x20reagiert\x20nicht\x20in\x20','1326780IyVNwc','log','analysis.safety.deadMan.lastIgnored','replace','ðŸ‘¼\x20Schutzengel-Frage:\x20','includes','Ignoriere\x20Bewegung\x20in\x20\x27','14QZjIEy','getStateAsync','toLowerCase','toString','(((.+)+)+)+$','\x20(Multi-Person\x20Filter)','%).\x20VerlÃ¤ngere\x20Timer\x20fÃ¼r\x20','sofa','99312jaPwBR','analysis.safety.deadMan.config','val','ðŸ‘¼\x20Schutzengel:\x20Ãœberwache\x20','stringify','214800mgErAX','220NgSAId','1930mmOVxL','exports','./setup','setStateAsync','35632zkEXRt','default','\x20fÃ¼r\x20','3LAqkDW','constructor','analysis.safety.deadMan.currentRoom','getHours','11YVvbSf','warn','error','\x20um\x2090\x20Min.','4869vxwHJb','474276WzimQt','sendNotification','analysis.safety.deadMan.alarmState','bed','analysis.safety.deadMan.active','search','living','â³\x20ACHTUNG:\x20UngewÃ¶hnlich\x20lange\x20InaktivitÃ¤t\x20in\x20','\x20Min.'];a2_0x52c7=function(){return _0x1ad4e2;};return a2_0x52c7();}async function areRoomsConnected(_0x3f18a1,_0x36f718,_0x50d831){const _0x4c80ec=a2_0x39e9d6;try{const _0x1fa488=await _0x3f18a1[_0x4c80ec(0x16a)](_0x4c80ec(0x160));if(!_0x1fa488||!_0x1fa488[_0x4c80ec(0x173)])return!![];const _0x555106=JSON[_0x4c80ec(0x158)](_0x1fa488[_0x4c80ec(0x173)]),{rooms:_0x49ddfa,matrix:_0x5c0ac5}=_0x555106;if(!_0x49ddfa||!_0x5c0ac5)return!![];const _0x2faaa8=_0x49ddfa[_0x4c80ec(0x15a)](_0x36f718),_0x9148bb=_0x49ddfa['indexOf'](_0x50d831);if(_0x2faaa8===-0x1||_0x9148bb===-0x1)return!![];const _0xc8bd54=_0x5c0ac5[_0x2faaa8][_0x9148bb]>0x0||_0x5c0ac5[_0x9148bb][_0x2faaa8]>0x0;return _0xc8bd54;}catch(_0x3aad56){return _0x3f18a1[_0x4c80ec(0x163)][_0x4c80ec(0x148)]('[DeadMan]\x20Topology\x20check\x20failed:\x20'+_0x3aad56['message']),!![];}}function calculateSleepProbability(_0x15198b){const _0x5a6314=a2_0x39e9d6,_0x5eedb3=new Date(),_0x254ae6=_0x5eedb3[_0x5a6314(0x146)](),_0x324b4b=_0x15198b['toLowerCase']();let _0x327f13=0.1;if(_0x254ae6>=0x17||_0x254ae6<=0x6)_0x327f13=0x1;else{if(_0x254ae6>=0xd&&_0x254ae6<=0xf)_0x327f13=0.8;else{if(_0x254ae6>=0x14&&_0x254ae6<=0x17)_0x327f13=0.4;}}let _0x2754a0=0.1;if(_0x324b4b[_0x5a6314(0x167)]('schlaf')||_0x324b4b[_0x5a6314(0x167)](_0x5a6314(0x14f)))_0x2754a0=0x1;else{if(_0x324b4b[_0x5a6314(0x167)](_0x5a6314(0x155))||_0x324b4b['includes'](_0x5a6314(0x152))||_0x324b4b[_0x5a6314(0x167)](_0x5a6314(0x170)))_0x2754a0=0.6;else{if(_0x324b4b[_0x5a6314(0x167)]('bad')||_0x324b4b['includes']('wc'))_0x2754a0=0.05;}}let _0x580559=0.5;const _0x3d9349=_0x2754a0*0.5+_0x327f13*0.3+_0x580559*0.2;return parseFloat(_0x3d9349[_0x5a6314(0x157)](0x2));}async function updateLocation(_0x40e900,_0x5cf6ed){const _0x4be9ee=a2_0x39e9d6;if(!_0x5cf6ed||_0x5cf6ed==='Unknown')return;if(!await isActive(_0x40e900)){resetTimer(_0x40e900);return;}if(currentMonitoredRoom&&currentMonitoredRoom!==_0x5cf6ed){const _0x1705ea=await areRoomsConnected(_0x40e900,currentMonitoredRoom,_0x5cf6ed);if(!_0x1705ea){const _0x23e74f=_0x4be9ee(0x168)+_0x5cf6ed+'\x27.\x20Nicht\x20verbunden\x20mit\x20Ã¼berwachtem\x20\x27'+currentMonitoredRoom+'\x27.';_0x40e900[_0x4be9ee(0x163)][_0x4be9ee(0x15b)](_0x4be9ee(0x159)+_0x23e74f+_0x4be9ee(0x16e)),await _0x40e900['setStateAsync'](_0x4be9ee(0x164),{'val':JSON[_0x4be9ee(0x175)]({'room':_0x5cf6ed,'reason':_0x23e74f,'timestamp':Date[_0x4be9ee(0x15c)]()}),'ack':!![]});return;}resetTimer(_0x40e900);}if(!currentMonitoredRoom){await _0x40e900[_0x4be9ee(0x17b)](_0x4be9ee(0x145),{'val':_0x5cf6ed,'ack':!![]});const _0x3fca03=await loadConfig(_0x40e900);let _0x232712=getTimeoutRobust(_0x3fca03,_0x5cf6ed);const _0x2c7a1d=_0x5cf6ed['toLowerCase']();if(!_0x232712)for(const _0x51074a in DEFAULT_TIMEOUTS){if(_0x2c7a1d[_0x4be9ee(0x167)](_0x51074a)){_0x232712=DEFAULT_TIMEOUTS[_0x51074a];break;}}if(!_0x232712&&_0x3fca03[_0x4be9ee(0x17d)])_0x232712=_0x3fca03['default'];if(!_0x232712)return;currentMonitoredRoom=_0x5cf6ed,startTimer(_0x40e900,_0x232712,_0x5cf6ed);}}function startTimer(_0x59226c,_0x4290be,_0x53c8c3){const _0x21ff1f=a2_0x39e9d6;if(activeTimer)clearTimeout(activeTimer);timeoutMs=_0x4290be*0x3c*0x3e8,startTime=Date[_0x21ff1f(0x15c)](),alarmStage=0x0;const _0x4c8701=calculateSleepProbability(_0x53c8c3||currentMonitoredRoom),_0xd0cc77=_0x4c8701>0.65;_0xd0cc77?(timeoutMs+=0x5a*0x3c*0x3e8,_0x59226c[_0x21ff1f(0x163)][_0x21ff1f(0x15b)]('ðŸ’¤\x20Smart\x20Sleep\x20erkannt\x20('+(_0x4c8701*0x64)['toFixed'](0x0)+_0x21ff1f(0x16f)+currentMonitoredRoom+_0x21ff1f(0x14a)),_0x59226c[_0x21ff1f(0x17b)](_0x21ff1f(0x15d),{'val':!![],'ack':!![]})):_0x59226c[_0x21ff1f(0x17b)]('analysis.safety.deadMan.smartSleep',{'val':![],'ack':!![]}),_0x59226c[_0x21ff1f(0x17b)]('analysis.safety.deadMan.napProbability',{'val':_0x4c8701,'ack':!![]}),_0x59226c[_0x21ff1f(0x163)][_0x21ff1f(0x15b)](_0x21ff1f(0x174)+currentMonitoredRoom+_0x21ff1f(0x142)+_0x4290be+_0x21ff1f(0x154)),_0x59226c[_0x21ff1f(0x17b)](_0x21ff1f(0x14e),{'val':'ok','ack':!![]}),activeTimer=setTimeout(()=>triggerPreWarn(_0x59226c),timeoutMs);}function resetTimer(_0x1d4378){const _0x5e387e=a2_0x39e9d6;if(activeTimer)clearTimeout(activeTimer);activeTimer=null,currentMonitoredRoom=null,alarmStage=0x0,_0x1d4378[_0x5e387e(0x17b)]('analysis.safety.deadMan.alarmState',{'val':'ok','ack':!![]}),_0x1d4378[_0x5e387e(0x17b)](_0x5e387e(0x15d),{'val':![],'ack':!![]}),_0x1d4378[_0x5e387e(0x17b)](_0x5e387e(0x15e),{'val':0x0,'ack':!![]});}async function triggerPreWarn(_0x4e44c1){const _0x57a559=a2_0x39e9d6;alarmStage=0x1,await _0x4e44c1[_0x57a559(0x17b)](_0x57a559(0x14e),{'val':'pre_warn','ack':!![]});const _0xfd40fc=_0x57a559(0x153)+currentMonitoredRoom+'.\x20Alles\x20in\x20Ordnung?';_0x4e44c1[_0x57a559(0x163)][_0x57a559(0x148)](_0x57a559(0x159)+_0xfd40fc),await setup['sendNotification'](_0x4e44c1,_0x57a559(0x166)+_0xfd40fc),activeTimer=setTimeout(()=>triggerAlarm(_0x4e44c1),0x5*0x3c*0x3e8);}async function triggerAlarm(_0xe60254){const _0x29c0aa=a2_0x39e9d6;alarmStage=0x2,await _0xe60254[_0x29c0aa(0x17b)](_0x29c0aa(0x14e),{'val':_0x29c0aa(0x15f),'ack':!![]});const _0x45d13c=_0x29c0aa(0x161)+currentMonitoredRoom+'!';_0xe60254[_0x29c0aa(0x163)][_0x29c0aa(0x149)]('[DeadMan]\x20'+_0x45d13c),await setup[_0x29c0aa(0x14d)](_0xe60254,_0x45d13c,![],!![]);}module[a2_0x39e9d6(0x179)]={'updateLocation':updateLocation};