const a2_0x1b5863=a2_0x33fd;(function(_0x11d0b0,_0x15a89a){const _0x33a6d8=a2_0x33fd,_0x4f2d57=_0x11d0b0();while(!![]){try{const _0x21ce47=-parseInt(_0x33a6d8(0x1d1))/0x1*(-parseInt(_0x33a6d8(0x1e9))/0x2)+-parseInt(_0x33a6d8(0x1ef))/0x3+-parseInt(_0x33a6d8(0x1e5))/0x4*(-parseInt(_0x33a6d8(0x1f1))/0x5)+-parseInt(_0x33a6d8(0x1e3))/0x6+parseInt(_0x33a6d8(0x1ee))/0x7*(parseInt(_0x33a6d8(0x1d5))/0x8)+-parseInt(_0x33a6d8(0x1e6))/0x9*(parseInt(_0x33a6d8(0x1ed))/0xa)+parseInt(_0x33a6d8(0x1e7))/0xb*(parseInt(_0x33a6d8(0x1d6))/0xc);if(_0x21ce47===_0x15a89a)break;else _0x4f2d57['push'](_0x4f2d57['shift']());}catch(_0x301710){_0x4f2d57['push'](_0x4f2d57['shift']());}}}(a2_0x1254,0x2cf62));const a2_0x1a0f19=(function(){let _0x36c067=!![];return function(_0x3f899f,_0x2a8172){const _0x47341e=_0x36c067?function(){const _0x3cc006=a2_0x33fd;if(_0x2a8172){const _0x484a8b=_0x2a8172[_0x3cc006(0x1fc)](_0x3f899f,arguments);return _0x2a8172=null,_0x484a8b;}}:function(){};return _0x36c067=![],_0x47341e;};}()),a2_0x3300fb=a2_0x1a0f19(this,function(){const _0x9b2332=a2_0x33fd;return a2_0x3300fb[_0x9b2332(0x1e0)]()[_0x9b2332(0x1fe)](_0x9b2332(0x1e1))[_0x9b2332(0x1e0)]()[_0x9b2332(0x1f2)](a2_0x3300fb)['search'](_0x9b2332(0x1e1));});a2_0x3300fb();function a2_0x33fd(_0x5bd19d,_0x278af6){const _0x4c95c0=a2_0x1254();return a2_0x33fd=function(_0x3300fb,_0x1a0f19){_0x3300fb=_0x3300fb-0x1ce;let _0x12546c=_0x4c95c0[_0x3300fb];return _0x12546c;},a2_0x33fd(_0x5bd19d,_0x278af6);}'use strict';const setup=require(a2_0x1b5863(0x1e4));let activeTimer=null,currentMonitoredRoom=null,timeoutMs=0x0,startTime=0x0,alarmStage=0x0;function a2_0x1254(){const _0x488fd0=['analysis.safety.deadMan.config','206BRBuLD','error','pre_warn','stringify','630130ZfpsWH','301tDyiQr','250860pYmliG','.\x20Alles\x20in\x20Ordnung?','33785fDxIvp','constructor','analysis.safety.deadMan.active','alarm','info','â³\x20ACHTUNG:\x20UngewÃ¶hnlich\x20lange\x20InaktivitÃ¤t\x20in\x20','analysis.safety.deadMan.alarmState','message','toLowerCase','indexOf','sendNotification','apply','includes','search','now','getStateAsync','parse','1347LWKdBq','val','[DeadMan]\x20Topology\x20check\x20failed:\x20','\x27.\x20Nicht\x20verbunden\x20mit\x20Ã¼berwachtem\x20\x27','808HZswgs','843996MrpTqC','ðŸš¨\x20NOTFALL-ALARM:\x20Person\x20reagiert\x20nicht\x20in\x20','ðŸ‘¼\x20Schutzengel:\x20Ãœberwache\x20','log','setStateAsync','analysis.topology.structure','default','[DeadMan]\x20','\x20fÃ¼r\x20','ðŸ‘¼\x20Schutzengel-Frage:\x20','toString','(((.+)+)+)+$','warn','1524wvWNBU','./setup','28WUpLdD','9erdZgq','22MQlybi'];a2_0x1254=function(){return _0x488fd0;};return a2_0x1254();}const DEFAULT_TIMEOUTS={'bad':0x2d,'bath':0x2d,'toilet':0x1e,'wc':0x1e,'keller':0x3c};async function loadConfig(_0x21bc57){const _0xe1f8fb=a2_0x1b5863;try{const _0x58c461=await _0x21bc57['getStateAsync'](_0xe1f8fb(0x1e8));if(_0x58c461&&_0x58c461[_0xe1f8fb(0x1d2)])return JSON[_0xe1f8fb(0x1d0)](_0x58c461['val']);}catch(_0xc20dec){}return{};}async function isActive(_0x4312e2){const _0x474960=a2_0x1b5863;try{const _0x25826d=await _0x4312e2[_0x474960(0x1cf)](_0x474960(0x1f3));return _0x25826d&&_0x25826d[_0x474960(0x1d2)];}catch(_0x37f8fe){return![];}}async function areRoomsConnected(_0x1664d3,_0x39d6d5,_0x555395){const _0x264401=a2_0x1b5863;try{const _0x1b99a5=await _0x1664d3[_0x264401(0x1cf)](_0x264401(0x1db));if(!_0x1b99a5||!_0x1b99a5[_0x264401(0x1d2)])return!![];const _0x35d42a=JSON[_0x264401(0x1d0)](_0x1b99a5[_0x264401(0x1d2)]),{rooms:_0x535afa,matrix:_0x218dd4}=_0x35d42a;if(!_0x535afa||!_0x218dd4)return!![];const _0x3e9d4c=_0x535afa[_0x264401(0x1fa)](_0x39d6d5),_0x38a2bd=_0x535afa[_0x264401(0x1fa)](_0x555395);if(_0x3e9d4c===-0x1||_0x38a2bd===-0x1)return!![];const _0xfd8557=_0x218dd4[_0x3e9d4c][_0x38a2bd]>0x0||_0x218dd4[_0x38a2bd][_0x3e9d4c]>0x0;return _0xfd8557;}catch(_0x33ee9b){return _0x1664d3[_0x264401(0x1d9)]['warn'](_0x264401(0x1d3)+_0x33ee9b[_0x264401(0x1f8)]),!![];}}async function updateLocation(_0x11ebef,_0x2f4ad9){const _0x127324=a2_0x1b5863;if(!_0x2f4ad9||_0x2f4ad9==='Unknown')return;if(!await isActive(_0x11ebef)){resetTimer(_0x11ebef);return;}if(currentMonitoredRoom&&currentMonitoredRoom!==_0x2f4ad9){const _0x1de107=await areRoomsConnected(_0x11ebef,currentMonitoredRoom,_0x2f4ad9);if(!_0x1de107){const _0x9496e6='Ignoriere\x20Bewegung\x20in\x20\x27'+_0x2f4ad9+_0x127324(0x1d4)+currentMonitoredRoom+'\x27.';_0x11ebef['log'][_0x127324(0x1f5)](_0x127324(0x1dd)+_0x9496e6+'\x20(Multi-Person\x20Filter)'),await _0x11ebef['setStateAsync']('analysis.safety.deadMan.lastIgnored',{'val':JSON[_0x127324(0x1ec)]({'room':_0x2f4ad9,'reason':_0x9496e6,'timestamp':Date[_0x127324(0x1ce)]()}),'ack':!![]});return;}resetTimer(_0x11ebef);}if(!currentMonitoredRoom){await _0x11ebef['setStateAsync']('analysis.safety.deadMan.currentRoom',{'val':_0x2f4ad9,'ack':!![]});const _0x2e26f5=await loadConfig(_0x11ebef),_0x3a719b=_0x2f4ad9[_0x127324(0x1f9)]();let _0x14ab31=_0x2e26f5[_0x2f4ad9]||_0x2e26f5[_0x3a719b];if(!_0x14ab31)for(const _0x2830aa in DEFAULT_TIMEOUTS){if(_0x3a719b[_0x127324(0x1fd)](_0x2830aa)){_0x14ab31=DEFAULT_TIMEOUTS[_0x2830aa];break;}}if(!_0x14ab31&&_0x2e26f5[_0x127324(0x1dc)])_0x14ab31=_0x2e26f5[_0x127324(0x1dc)];if(!_0x14ab31)return;currentMonitoredRoom=_0x2f4ad9,startTimer(_0x11ebef,_0x14ab31);}}function startTimer(_0x30fda0,_0x506dfe){const _0x1cbf95=a2_0x1b5863;if(activeTimer)clearTimeout(activeTimer);timeoutMs=_0x506dfe*0x3c*0x3e8,startTime=Date['now'](),alarmStage=0x0,_0x30fda0['log'][_0x1cbf95(0x1f5)](_0x1cbf95(0x1d8)+currentMonitoredRoom+_0x1cbf95(0x1de)+_0x506dfe+'\x20Min.'),_0x30fda0[_0x1cbf95(0x1da)]('analysis.safety.deadMan.alarmState',{'val':'ok','ack':!![]}),activeTimer=setTimeout(()=>triggerPreWarn(_0x30fda0),timeoutMs);}function resetTimer(_0x4dfea){const _0x565f04=a2_0x1b5863;if(activeTimer)clearTimeout(activeTimer);activeTimer=null,currentMonitoredRoom=null,alarmStage=0x0,_0x4dfea['setStateAsync'](_0x565f04(0x1f7),{'val':'ok','ack':!![]});}async function triggerPreWarn(_0x131003){const _0x5d69db=a2_0x1b5863;alarmStage=0x1,await _0x131003['setStateAsync'](_0x5d69db(0x1f7),{'val':_0x5d69db(0x1eb),'ack':!![]});const _0x7fba44=_0x5d69db(0x1f6)+currentMonitoredRoom+_0x5d69db(0x1f0);_0x131003[_0x5d69db(0x1d9)][_0x5d69db(0x1e2)]('[DeadMan]\x20'+_0x7fba44),await setup[_0x5d69db(0x1fb)](_0x131003,_0x5d69db(0x1df)+_0x7fba44),activeTimer=setTimeout(()=>triggerAlarm(_0x131003),0x5*0x3c*0x3e8);}async function triggerAlarm(_0x34d742){const _0x19ba73=a2_0x1b5863;alarmStage=0x2,await _0x34d742['setStateAsync']('analysis.safety.deadMan.alarmState',{'val':_0x19ba73(0x1f4),'ack':!![]});const _0x52b85d=_0x19ba73(0x1d7)+currentMonitoredRoom+'!';_0x34d742[_0x19ba73(0x1d9)][_0x19ba73(0x1ea)](_0x19ba73(0x1dd)+_0x52b85d),await setup[_0x19ba73(0x1fb)](_0x34d742,_0x52b85d,![],!![]);}module['exports']={'updateLocation':updateLocation};