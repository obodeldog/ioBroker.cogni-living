function a2_0xcb54(){const _0xcf3da5=['4HJwHjX','getStateAsync','analysis.safety.deadMan.lastIgnored','ðŸ‘¼\x20Schutzengel:\x20Ãœberwache\x20','6850yaINSj','val','setStateAsync','11gyLkOw','includes','(((.+)+)+)+$','ðŸš¨\x20NOTFALL-ALARM:\x20Person\x20reagiert\x20nicht\x20in\x20','apply','\x20Min.','parse','sofa','analysis.safety.deadMan.active','ðŸ’¤\x20Smart\x20Sleep\x20erkannt\x20(','constructor','./setup','10024692YwQIRa','exports','analysis.safety.deadMan.napProbability','analysis.safety.deadMan.smartSleep','analysis.safety.deadMan.alarmState','[DeadMan]\x20Topology\x20check\x20failed:\x20','\x20fÃ¼r\x20','toFixed','1083205yRLpAv','schlaf','\x27.\x20Nicht\x20verbunden\x20mit\x20Ã¼berwachtem\x20\x27','\x20(Multi-Person\x20Filter)','%).\x20VerlÃ¤ngere\x20Timer\x20fÃ¼r\x20','7FAFQLD','analysis.safety.deadMan.config','bed','pre_warn','analysis.safety.deadMan.currentRoom','1809960SUGXyA','\x20um\x2090\x20Min.','replace','stringify','ðŸ‘¼\x20Schutzengel-Frage:\x20','living','search','toLowerCase','log','8002728NKBlne','1041351BKlAGj','info','bad','1928psQOfk','default','error','Unknown','now','[DeadMan]\x20','sendNotification','getHours','45crzwrP','warn','3453810FjKFgF'];a2_0xcb54=function(){return _0xcf3da5;};return a2_0xcb54();}const a2_0x5e6a1f=a2_0x2b96;(function(_0x328be4,_0xc9d6a2){const _0x4a0cce=a2_0x2b96,_0x5664f1=_0x328be4();while(!![]){try{const _0x1db89d=parseInt(_0x4a0cce(0x16a))/0x1+parseInt(_0x4a0cce(0x14f))/0x2*(-parseInt(_0x4a0cce(0x141))/0x3)+parseInt(_0x4a0cce(0x144))/0x4*(parseInt(_0x4a0cce(0x153))/0x5)+-parseInt(_0x4a0cce(0x14e))/0x6*(-parseInt(_0x4a0cce(0x16f))/0x7)+-parseInt(_0x4a0cce(0x140))/0x8+-parseInt(_0x4a0cce(0x14c))/0x9*(-parseInt(_0x4a0cce(0x174))/0xa)+-parseInt(_0x4a0cce(0x156))/0xb*(parseInt(_0x4a0cce(0x162))/0xc);if(_0x1db89d===_0xc9d6a2)break;else _0x5664f1['push'](_0x5664f1['shift']());}catch(_0x148f87){_0x5664f1['push'](_0x5664f1['shift']());}}}(a2_0xcb54,0xa97b2));const a2_0x160deb=(function(){let _0x157547=!![];return function(_0x43f59a,_0x30ce1b){const _0x4050aa=_0x157547?function(){const _0x2580bf=a2_0x2b96;if(_0x30ce1b){const _0x133e99=_0x30ce1b[_0x2580bf(0x15a)](_0x43f59a,arguments);return _0x30ce1b=null,_0x133e99;}}:function(){};return _0x157547=![],_0x4050aa;};}()),a2_0x2411a1=a2_0x160deb(this,function(){const _0xcfa751=a2_0x2b96;return a2_0x2411a1['toString']()[_0xcfa751(0x13d)](_0xcfa751(0x158))['toString']()[_0xcfa751(0x160)](a2_0x2411a1)[_0xcfa751(0x13d)](_0xcfa751(0x158));});a2_0x2411a1();'use strict';const setup=require(a2_0x5e6a1f(0x161));let activeTimer=null,currentMonitoredRoom=null,timeoutMs=0x0,startTime=0x0,alarmStage=0x0;function a2_0x2b96(_0xadd9fe,_0xde15d4){const _0x4fa933=a2_0xcb54();return a2_0x2b96=function(_0x2411a1,_0x160deb){_0x2411a1=_0x2411a1-0x13a;let _0xcb549e=_0x4fa933[_0x2411a1];return _0xcb549e;},a2_0x2b96(_0xadd9fe,_0xde15d4);}const DEFAULT_TIMEOUTS={'bad':0x2d,'bath':0x2d,'toilet':0x1e,'wc':0x1e,'keller':0x3c,'schlaf':0x78,'bed':0x78,'guest':0x5a,'gast':0x5a};function getTimeoutRobust(_0x2f7395,_0x27922b){const _0x54f93c=a2_0x5e6a1f;if(!_0x2f7395||!_0x27922b)return undefined;if(_0x2f7395[_0x27922b])return _0x2f7395[_0x27922b];const _0x1ba0a5=_0x27922b[_0x54f93c(0x13e)]()[_0x54f93c(0x176)](/[^a-z0-9]/g,'');for(const _0x2c35d9 in _0x2f7395){const _0x45b8fb=_0x2c35d9[_0x54f93c(0x13e)]()[_0x54f93c(0x176)](/[^a-z0-9]/g,'');if(_0x45b8fb===_0x1ba0a5)return _0x2f7395[_0x2c35d9];}const _0x250960=_0x27922b[_0x54f93c(0x13e)]();if(_0x2f7395[_0x250960])return _0x2f7395[_0x250960];return undefined;}async function loadConfig(_0x2614a4){const _0x2b8e14=a2_0x5e6a1f;try{const _0x178873=await _0x2614a4['getStateAsync'](_0x2b8e14(0x170));if(_0x178873&&_0x178873['val'])return JSON[_0x2b8e14(0x15c)](_0x178873['val']);}catch(_0x516ea2){}return{};}async function isActive(_0x3b0262){const _0x18bf3c=a2_0x5e6a1f;try{const _0x4d9dba=await _0x3b0262['getStateAsync'](_0x18bf3c(0x15e));return _0x4d9dba&&_0x4d9dba[_0x18bf3c(0x154)];}catch(_0x4cef9f){return![];}}async function areRoomsConnected(_0x2a008c,_0x46f388,_0x168df2){const _0x4c9199=a2_0x5e6a1f;try{const _0x2b8080=await _0x2a008c[_0x4c9199(0x150)]('analysis.topology.structure');if(!_0x2b8080||!_0x2b8080[_0x4c9199(0x154)])return!![];const _0x168a42=JSON[_0x4c9199(0x15c)](_0x2b8080[_0x4c9199(0x154)]),{rooms:_0x5ad57c,matrix:_0x3881b6}=_0x168a42;if(!_0x5ad57c||!_0x3881b6)return!![];const _0x41b514=_0x5ad57c['indexOf'](_0x46f388),_0x528a88=_0x5ad57c['indexOf'](_0x168df2);if(_0x41b514===-0x1||_0x528a88===-0x1)return!![];const _0x33a4f1=_0x3881b6[_0x41b514][_0x528a88]>0x0||_0x3881b6[_0x528a88][_0x41b514]>0x0;return _0x33a4f1;}catch(_0xeb3803){return _0x2a008c[_0x4c9199(0x13f)][_0x4c9199(0x14d)](_0x4c9199(0x167)+_0xeb3803['message']),!![];}}function calculateSleepProbability(_0x5ae1b5){const _0x56674e=a2_0x5e6a1f,_0x10f044=new Date(),_0x355815=_0x10f044[_0x56674e(0x14b)](),_0x39ab1c=_0x5ae1b5[_0x56674e(0x13e)]();let _0x1a1da2=0.1;if(_0x355815>=0x17||_0x355815<=0x6)_0x1a1da2=0x1;else{if(_0x355815>=0xd&&_0x355815<=0xf)_0x1a1da2=0.8;else{if(_0x355815>=0x14&&_0x355815<=0x17)_0x1a1da2=0.4;}}let _0x3be2fa=0.1;if(_0x39ab1c[_0x56674e(0x157)](_0x56674e(0x16b))||_0x39ab1c[_0x56674e(0x157)](_0x56674e(0x171)))_0x3be2fa=0x1;else{if(_0x39ab1c[_0x56674e(0x157)]('wohn')||_0x39ab1c[_0x56674e(0x157)](_0x56674e(0x13c))||_0x39ab1c[_0x56674e(0x157)](_0x56674e(0x15d)))_0x3be2fa=0.6;else{if(_0x39ab1c[_0x56674e(0x157)](_0x56674e(0x143))||_0x39ab1c['includes']('wc'))_0x3be2fa=0.05;}}let _0x49cd10=0.5;const _0x28d912=_0x3be2fa*0.5+_0x1a1da2*0.3+_0x49cd10*0.2;return parseFloat(_0x28d912[_0x56674e(0x169)](0x2));}async function updateLocation(_0x2ac71a,_0x1c6c83){const _0x11bf50=a2_0x5e6a1f;if(!_0x1c6c83||_0x1c6c83===_0x11bf50(0x147))return;if(!await isActive(_0x2ac71a)){resetTimer(_0x2ac71a);return;}if(currentMonitoredRoom&&currentMonitoredRoom!==_0x1c6c83){const _0x3cea96=await areRoomsConnected(_0x2ac71a,currentMonitoredRoom,_0x1c6c83);if(!_0x3cea96){const _0x4eba45='Ignoriere\x20Bewegung\x20in\x20\x27'+_0x1c6c83+_0x11bf50(0x16c)+currentMonitoredRoom+'\x27.';_0x2ac71a[_0x11bf50(0x13f)][_0x11bf50(0x142)](_0x11bf50(0x149)+_0x4eba45+_0x11bf50(0x16d)),await _0x2ac71a[_0x11bf50(0x155)](_0x11bf50(0x151),{'val':JSON[_0x11bf50(0x13a)]({'room':_0x1c6c83,'reason':_0x4eba45,'timestamp':Date[_0x11bf50(0x148)]()}),'ack':!![]});return;}resetTimer(_0x2ac71a);}if(!currentMonitoredRoom){await _0x2ac71a[_0x11bf50(0x155)](_0x11bf50(0x173),{'val':_0x1c6c83,'ack':!![]});const _0x1ad4ea=await loadConfig(_0x2ac71a);let _0xc3c3ef=getTimeoutRobust(_0x1ad4ea,_0x1c6c83);const _0x5e8fff=_0x1c6c83[_0x11bf50(0x13e)]();if(!_0xc3c3ef)for(const _0x43e2ed in DEFAULT_TIMEOUTS){if(_0x5e8fff[_0x11bf50(0x157)](_0x43e2ed)){_0xc3c3ef=DEFAULT_TIMEOUTS[_0x43e2ed];break;}}if(!_0xc3c3ef&&_0x1ad4ea[_0x11bf50(0x145)])_0xc3c3ef=_0x1ad4ea[_0x11bf50(0x145)];if(!_0xc3c3ef)return;currentMonitoredRoom=_0x1c6c83,startTimer(_0x2ac71a,_0xc3c3ef,_0x1c6c83);}}function startTimer(_0x563c20,_0x494b53,_0x397646){const _0x540814=a2_0x5e6a1f;if(activeTimer)clearTimeout(activeTimer);timeoutMs=_0x494b53*0x3c*0x3e8,startTime=Date['now'](),alarmStage=0x0;const _0x17e658=calculateSleepProbability(_0x397646||currentMonitoredRoom),_0x1ea705=_0x17e658>0.65;_0x1ea705?(timeoutMs+=0x5a*0x3c*0x3e8,_0x563c20['log'][_0x540814(0x142)](_0x540814(0x15f)+(_0x17e658*0x64)['toFixed'](0x0)+_0x540814(0x16e)+currentMonitoredRoom+_0x540814(0x175)),_0x563c20[_0x540814(0x155)](_0x540814(0x165),{'val':!![],'ack':!![]})):_0x563c20[_0x540814(0x155)](_0x540814(0x165),{'val':![],'ack':!![]}),_0x563c20['setStateAsync'](_0x540814(0x164),{'val':_0x17e658,'ack':!![]}),_0x563c20[_0x540814(0x13f)]['info'](_0x540814(0x152)+currentMonitoredRoom+_0x540814(0x168)+_0x494b53+_0x540814(0x15b)),_0x563c20[_0x540814(0x155)](_0x540814(0x166),{'val':'ok','ack':!![]}),activeTimer=setTimeout(()=>triggerPreWarn(_0x563c20),timeoutMs);}function resetTimer(_0x19e758){const _0x5d6113=a2_0x5e6a1f;if(activeTimer)clearTimeout(activeTimer);activeTimer=null,currentMonitoredRoom=null,alarmStage=0x0,_0x19e758[_0x5d6113(0x155)](_0x5d6113(0x166),{'val':'ok','ack':!![]}),_0x19e758[_0x5d6113(0x155)](_0x5d6113(0x165),{'val':![],'ack':!![]}),_0x19e758[_0x5d6113(0x155)](_0x5d6113(0x164),{'val':0x0,'ack':!![]});}async function triggerPreWarn(_0x353491){const _0x34b569=a2_0x5e6a1f;alarmStage=0x1,await _0x353491[_0x34b569(0x155)](_0x34b569(0x166),{'val':_0x34b569(0x172),'ack':!![]});const _0x2536be='â³\x20ACHTUNG:\x20UngewÃ¶hnlich\x20lange\x20InaktivitÃ¤t\x20in\x20'+currentMonitoredRoom+'.\x20Alles\x20in\x20Ordnung?';_0x353491['log'][_0x34b569(0x14d)](_0x34b569(0x149)+_0x2536be),await setup[_0x34b569(0x14a)](_0x353491,_0x34b569(0x13b)+_0x2536be),activeTimer=setTimeout(()=>triggerAlarm(_0x353491),0x5*0x3c*0x3e8);}async function triggerAlarm(_0x3cd346){const _0x3b0a7f=a2_0x5e6a1f;alarmStage=0x2,await _0x3cd346[_0x3b0a7f(0x155)]('analysis.safety.deadMan.alarmState',{'val':'alarm','ack':!![]});const _0x4114b1=_0x3b0a7f(0x159)+currentMonitoredRoom+'!';_0x3cd346[_0x3b0a7f(0x13f)][_0x3b0a7f(0x146)]('[DeadMan]\x20'+_0x4114b1),await setup[_0x3b0a7f(0x14a)](_0x3cd346,_0x4114b1,![],!![]);}module[a2_0x5e6a1f(0x163)]={'updateLocation':updateLocation};