const a2_0x5b70fc=a2_0x3320;(function(_0x1d796b,_0x537f15){const _0x30fc13=a2_0x3320,_0x54d5a5=_0x1d796b();while(!![]){try{const _0x495254=-parseInt(_0x30fc13(0x133))/0x1*(parseInt(_0x30fc13(0x139))/0x2)+-parseInt(_0x30fc13(0x160))/0x3*(-parseInt(_0x30fc13(0x15d))/0x4)+parseInt(_0x30fc13(0x15b))/0x5+parseInt(_0x30fc13(0x15e))/0x6*(parseInt(_0x30fc13(0x14a))/0x7)+parseInt(_0x30fc13(0x135))/0x8+parseInt(_0x30fc13(0x156))/0x9*(parseInt(_0x30fc13(0x131))/0xa)+-parseInt(_0x30fc13(0x12b))/0xb*(parseInt(_0x30fc13(0x148))/0xc);if(_0x495254===_0x537f15)break;else _0x54d5a5['push'](_0x54d5a5['shift']());}catch(_0x2c97fb){_0x54d5a5['push'](_0x54d5a5['shift']());}}}(a2_0x2203,0xea31c));const a2_0x4615ac=(function(){let _0x4fa0cb=!![];return function(_0x31b364,_0x3b1442){const _0x127039=_0x4fa0cb?function(){const _0x2eb00d=a2_0x3320;if(_0x3b1442){const _0xb700c0=_0x3b1442[_0x2eb00d(0x13a)](_0x31b364,arguments);return _0x3b1442=null,_0xb700c0;}}:function(){};return _0x4fa0cb=![],_0x127039;};}()),a2_0x3b477f=a2_0x4615ac(this,function(){const _0x56d91b=a2_0x3320;return a2_0x3b477f[_0x56d91b(0x161)]()['search'](_0x56d91b(0x154))['toString']()[_0x56d91b(0x12e)](a2_0x3b477f)[_0x56d91b(0x155)](_0x56d91b(0x154));});a2_0x3b477f();'use strict';const setup=require(a2_0x5b70fc(0x146));let activeTimer=null,currentMonitoredRoom=null,timeoutMs=0x0,startTime=0x0,alarmStage=0x0;const DEFAULT_TIMEOUTS={'bad':0x2d,'bath':0x2d,'toilet':0x1e,'wc':0x1e,'keller':0x3c,'schlaf':0x78,'bed':0x78,'guest':0x5a,'gast':0x5a};function getTimeoutRobust(_0x4dac72,_0x400b0d){const _0x8f7bf7=a2_0x5b70fc;if(!_0x4dac72||!_0x400b0d)return undefined;if(_0x4dac72[_0x400b0d])return _0x4dac72[_0x400b0d];const _0x53b5ca=_0x400b0d[_0x8f7bf7(0x144)]()[_0x8f7bf7(0x12a)](/[^a-z0-9]/g,'');for(const _0xe9aabb in _0x4dac72){const _0x31e4b6=_0xe9aabb['toLowerCase']()[_0x8f7bf7(0x12a)](/[^a-z0-9]/g,'');if(_0x31e4b6===_0x53b5ca)return _0x4dac72[_0xe9aabb];}const _0xe80b2e=_0x400b0d[_0x8f7bf7(0x144)]();if(_0x4dac72[_0xe80b2e])return _0x4dac72[_0xe80b2e];return undefined;}async function loadConfig(_0x562f94){const _0x1f7b8f=a2_0x5b70fc;try{const _0x414b9a=await _0x562f94[_0x1f7b8f(0x164)]('analysis.safety.deadMan.config');if(_0x414b9a&&_0x414b9a[_0x1f7b8f(0x137)])return JSON[_0x1f7b8f(0x140)](_0x414b9a[_0x1f7b8f(0x137)]);}catch(_0x55c661){}return{};}async function isActive(_0x42c044){const _0x5ae050=a2_0x5b70fc;try{const _0x5cc4e6=await _0x42c044[_0x5ae050(0x164)](_0x5ae050(0x145));return _0x5cc4e6&&_0x5cc4e6['val'];}catch(_0x4cc34b){return![];}}async function areRoomsConnected(_0x23f6fb,_0xef6cb8,_0x5622a3){const _0x340f2a=a2_0x5b70fc;try{const _0x1ea3b7=await _0x23f6fb[_0x340f2a(0x164)](_0x340f2a(0x13b));if(!_0x1ea3b7||!_0x1ea3b7[_0x340f2a(0x137)])return!![];const _0x25a1fc=JSON['parse'](_0x1ea3b7[_0x340f2a(0x137)]),{rooms:_0x2fd218,matrix:_0x530871}=_0x25a1fc;if(!_0x2fd218||!_0x530871)return!![];const _0x2fda24=_0x2fd218[_0x340f2a(0x14c)](_0xef6cb8),_0xea20c=_0x2fd218[_0x340f2a(0x14c)](_0x5622a3);if(_0x2fda24===-0x1||_0xea20c===-0x1)return!![];const _0x4f278e=_0x530871[_0x2fda24][_0xea20c]>0x0||_0x530871[_0xea20c][_0x2fda24]>0x0;return _0x4f278e;}catch(_0x45d10c){return _0x23f6fb['log']['warn'](_0x340f2a(0x153)+_0x45d10c[_0x340f2a(0x14d)]),!![];}}function calculateSleepProbability(_0x35a5c9){const _0x243605=a2_0x5b70fc,_0x5e8649=new Date(),_0x5c38ca=_0x5e8649[_0x243605(0x130)](),_0x2f8f43=_0x35a5c9[_0x243605(0x144)]();let _0x53d799=0.1;if(_0x5c38ca>=0x17||_0x5c38ca<=0x6)_0x53d799=0x1;else{if(_0x5c38ca>=0xd&&_0x5c38ca<=0xf)_0x53d799=0.8;else{if(_0x5c38ca>=0x14&&_0x5c38ca<=0x17)_0x53d799=0.4;}}let _0x482784=0.1;if(_0x2f8f43[_0x243605(0x15a)](_0x243605(0x143))||_0x2f8f43[_0x243605(0x15a)](_0x243605(0x141)))_0x482784=0x1;else{if(_0x2f8f43[_0x243605(0x15a)]('wohn')||_0x2f8f43[_0x243605(0x15a)](_0x243605(0x13c))||_0x2f8f43['includes'](_0x243605(0x14f)))_0x482784=0.6;else{if(_0x2f8f43[_0x243605(0x15a)](_0x243605(0x13f))||_0x2f8f43[_0x243605(0x15a)]('wc'))_0x482784=0.05;}}let _0x5bf723=0.5;const _0x468099=_0x482784*0.5+_0x53d799*0.3+_0x5bf723*0.2;return parseFloat(_0x468099[_0x243605(0x147)](0x2));}async function updateLocation(_0x5a350a,_0x5f9c53){const _0x329845=a2_0x5b70fc;if(!_0x5f9c53||_0x5f9c53===_0x329845(0x129))return;if(!await isActive(_0x5a350a)){resetTimer(_0x5a350a);return;}if(currentMonitoredRoom&&currentMonitoredRoom!==_0x5f9c53){const _0x2525a9=await areRoomsConnected(_0x5a350a,currentMonitoredRoom,_0x5f9c53);if(!_0x2525a9){const _0x2987ff=_0x329845(0x138)+_0x5f9c53+'\x27.\x20Nicht\x20verbunden\x20mit\x20Ã¼berwachtem\x20\x27'+currentMonitoredRoom+'\x27.';_0x5a350a[_0x329845(0x150)][_0x329845(0x166)](_0x329845(0x12d)+_0x2987ff+_0x329845(0x12f)),await _0x5a350a[_0x329845(0x151)](_0x329845(0x13d),{'val':JSON['stringify']({'room':_0x5f9c53,'reason':_0x2987ff,'timestamp':Date[_0x329845(0x142)]()}),'ack':!![]});return;}resetTimer(_0x5a350a);}if(!currentMonitoredRoom){await _0x5a350a[_0x329845(0x151)](_0x329845(0x159),{'val':_0x5f9c53,'ack':!![]});const _0x430734=await loadConfig(_0x5a350a);let _0xdffba6=getTimeoutRobust(_0x430734,_0x5f9c53);const _0xf8d09d=_0x5f9c53[_0x329845(0x144)]();if(!_0xdffba6)for(const _0x1cefec in DEFAULT_TIMEOUTS){if(_0xf8d09d[_0x329845(0x15a)](_0x1cefec)){_0xdffba6=DEFAULT_TIMEOUTS[_0x1cefec];break;}}if(!_0xdffba6&&_0x430734[_0x329845(0x13e)])_0xdffba6=_0x430734['default'];if(!_0xdffba6)return;currentMonitoredRoom=_0x5f9c53,startTimer(_0x5a350a,_0xdffba6,_0x5f9c53);}}function a2_0x3320(_0x5dd9ac,_0x4da4e6){const _0x325f13=a2_0x2203();return a2_0x3320=function(_0x3b477f,_0x4615ac){_0x3b477f=_0x3b477f-0x129;let _0x22039e=_0x325f13[_0x3b477f];return _0x22039e;},a2_0x3320(_0x5dd9ac,_0x4da4e6);}function startTimer(_0x146179,_0xc6169a,_0x7d6f62){const _0x2cfec4=a2_0x5b70fc;if(activeTimer)clearTimeout(activeTimer);timeoutMs=_0xc6169a*0x3c*0x3e8,startTime=Date[_0x2cfec4(0x142)](),alarmStage=0x0;const _0x5ee228=calculateSleepProbability(_0x7d6f62||currentMonitoredRoom),_0x98dc60=_0x5ee228>0.65;_0x98dc60?(timeoutMs+=0x5a*0x3c*0x3e8,_0x146179['log'][_0x2cfec4(0x166)](_0x2cfec4(0x132)+(_0x5ee228*0x64)[_0x2cfec4(0x147)](0x0)+_0x2cfec4(0x157)+currentMonitoredRoom+_0x2cfec4(0x162)),_0x146179['setStateAsync'](_0x2cfec4(0x152),{'val':!![],'ack':!![]})):_0x146179[_0x2cfec4(0x151)]('analysis.safety.deadMan.smartSleep',{'val':![],'ack':!![]}),_0x146179['setStateAsync'](_0x2cfec4(0x149),{'val':_0x5ee228,'ack':!![]}),_0x146179[_0x2cfec4(0x150)]['info']('ðŸ‘¼\x20Schutzengel:\x20Ãœberwache\x20'+currentMonitoredRoom+_0x2cfec4(0x158)+_0xc6169a+_0x2cfec4(0x167)),_0x146179['setStateAsync'](_0x2cfec4(0x134),{'val':'ok','ack':!![]}),activeTimer=setTimeout(()=>triggerPreWarn(_0x146179),timeoutMs);}function resetTimer(_0x2a84f5){const _0x2f5b4e=a2_0x5b70fc;if(activeTimer)clearTimeout(activeTimer);activeTimer=null,currentMonitoredRoom=null,alarmStage=0x0,_0x2a84f5['setStateAsync'](_0x2f5b4e(0x134),{'val':'ok','ack':!![]}),_0x2a84f5['setStateAsync'](_0x2f5b4e(0x152),{'val':![],'ack':!![]}),_0x2a84f5[_0x2f5b4e(0x151)](_0x2f5b4e(0x149),{'val':0x0,'ack':!![]});}async function triggerPreWarn(_0x472a4f){const _0x7d5fa1=a2_0x5b70fc;alarmStage=0x1,await _0x472a4f['setStateAsync'](_0x7d5fa1(0x134),{'val':_0x7d5fa1(0x136),'ack':!![]});const _0x27a9ee='â³\x20ACHTUNG:\x20UngewÃ¶hnlich\x20lange\x20InaktivitÃ¤t\x20in\x20'+currentMonitoredRoom+_0x7d5fa1(0x165);_0x472a4f[_0x7d5fa1(0x150)][_0x7d5fa1(0x14e)]('[DeadMan]\x20'+_0x27a9ee),await setup[_0x7d5fa1(0x15c)](_0x472a4f,_0x7d5fa1(0x12c)+_0x27a9ee),activeTimer=setTimeout(()=>triggerAlarm(_0x472a4f),0x5*0x3c*0x3e8);}async function triggerAlarm(_0x129906){const _0x2c9029=a2_0x5b70fc;alarmStage=0x2,await _0x129906[_0x2c9029(0x151)](_0x2c9029(0x134),{'val':'alarm','ack':!![]});const _0x1845ce=_0x2c9029(0x163)+currentMonitoredRoom+'!';_0x129906['log'][_0x2c9029(0x14b)](_0x2c9029(0x12d)+_0x1845ce),await setup[_0x2c9029(0x15c)](_0x129906,_0x1845ce,![],!![]);}module[a2_0x5b70fc(0x15f)]={'updateLocation':updateLocation};function a2_0x2203(){const _0x46ab2a=['schlaf','toLowerCase','analysis.safety.deadMan.active','./setup','toFixed','1260YaXmhU','analysis.safety.deadMan.napProbability','504zdDOJo','error','indexOf','message','warn','sofa','log','setStateAsync','analysis.safety.deadMan.smartSleep','[DeadMan]\x20Topology\x20check\x20failed:\x20','(((.+)+)+)+$','search','612JWoROl','%).\x20VerlÃ¤ngere\x20Timer\x20fÃ¼r\x20','\x20fÃ¼r\x20','analysis.safety.deadMan.currentRoom','includes','4287220FsgenY','sendNotification','1156284oMgdms','138114yrUCFn','exports','3xXqPwr','toString','\x20um\x2090\x20Min.','ðŸš¨\x20NOTFALL-ALARM:\x20Person\x20reagiert\x20nicht\x20in\x20','getStateAsync','.\x20Alles\x20in\x20Ordnung?','info','\x20Min.','Unknown','replace','135454LMiZMR','ðŸ‘¼\x20Schutzengel-Frage:\x20','[DeadMan]\x20','constructor','\x20(Multi-Person\x20Filter)','getHours','89650zqDRUk','ðŸ’¤\x20Smart\x20Sleep\x20erkannt\x20(','2617YXSuJQ','analysis.safety.deadMan.alarmState','4192600qchjCG','pre_warn','val','Ignoriere\x20Bewegung\x20in\x20\x27','1288NnvYIS','apply','analysis.topology.structure','living','analysis.safety.deadMan.lastIgnored','default','bad','parse','bed','now'];a2_0x2203=function(){return _0x46ab2a;};return a2_0x2203();}