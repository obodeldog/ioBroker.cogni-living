const a2_0x7f87a5=a2_0x4eb7;(function(_0x4e8799,_0x26107c){const _0x480a25=a2_0x4eb7,_0x2a67df=_0x4e8799();while(!![]){try{const _0x1fa41f=parseInt(_0x480a25(0xfc))/0x1*(parseInt(_0x480a25(0xfa))/0x2)+parseInt(_0x480a25(0xf5))/0x3*(-parseInt(_0x480a25(0xf6))/0x4)+parseInt(_0x480a25(0xf9))/0x5*(-parseInt(_0x480a25(0x11c))/0x6)+-parseInt(_0x480a25(0x101))/0x7*(parseInt(_0x480a25(0x118))/0x8)+-parseInt(_0x480a25(0x115))/0x9*(-parseInt(_0x480a25(0x11b))/0xa)+parseInt(_0x480a25(0x111))/0xb+parseInt(_0x480a25(0x122))/0xc;if(_0x1fa41f===_0x26107c)break;else _0x2a67df['push'](_0x2a67df['shift']());}catch(_0x323b9b){_0x2a67df['push'](_0x2a67df['shift']());}}}(a2_0x51d9,0x345ea));const a2_0x4de3b4=(function(){let _0x4fa6be=!![];return function(_0x34695d,_0x2874bf){const _0x198749=_0x4fa6be?function(){const _0x8dee7f=a2_0x4eb7;if(_0x2874bf){const _0x3421b6=_0x2874bf[_0x8dee7f(0x121)](_0x34695d,arguments);return _0x2874bf=null,_0x3421b6;}}:function(){};return _0x4fa6be=![],_0x198749;};}()),a2_0xa143a0=a2_0x4de3b4(this,function(){const _0x5ce158=a2_0x4eb7;return a2_0xa143a0[_0x5ce158(0xfe)]()[_0x5ce158(0x11a)](_0x5ce158(0x102))[_0x5ce158(0xfe)]()[_0x5ce158(0x125)](a2_0xa143a0)[_0x5ce158(0x11a)](_0x5ce158(0x102));});function a2_0x51d9(){const _0x96a066=['3MIpVIV','610388lrgDkk','setStateAsync','living','895yorcYU','1532aFoXJo','log','283JMEZms','getHours','toString','parse','val','723499uKDGDI','(((.+)+)+)+$','\x20Min.','message','ðŸš¨\x20NOTFALL-ALARM:\x20Person\x20reagiert\x20nicht\x20in\x20','.\x20Alles\x20in\x20Ordnung?','info','Ignoriere\x20Bewegung\x20in\x20\x27','toFixed','schlaf','includes','stringify','analysis.safety.deadMan.smartSleep','now','%).\x20VerlÃ¤ngere\x20Timer\x20fÃ¼r\x20','sofa','3978810OyaavS','analysis.safety.deadMan.currentRoom','exports','error','639NeeLWy','analysis.safety.deadMan.lastIgnored','[DeadMan]\x20Topology\x20check\x20failed:\x20','24qpeCai','ðŸ’¤\x20Smart\x20Sleep\x20erkannt\x20(','search','13570EHCsXZ','12222ztCHtQ','[DeadMan]\x20','warn','default','analysis.safety.deadMan.napProbability','apply','4403544HOtswk','getStateAsync','indexOf','constructor','sendNotification','toLowerCase','\x20(Multi-Person\x20Filter)','analysis.safety.deadMan.alarmState','bed','\x20fÃ¼r\x20','ðŸ‘¼\x20Schutzengel:\x20Ãœberwache\x20','pre_warn','Unknown','bad'];a2_0x51d9=function(){return _0x96a066;};return a2_0x51d9();}a2_0xa143a0();function a2_0x4eb7(_0x1da3de,_0x1cab50){const _0x247ae9=a2_0x51d9();return a2_0x4eb7=function(_0xa143a0,_0x4de3b4){_0xa143a0=_0xa143a0-0xee;let _0x51d980=_0x247ae9[_0xa143a0];return _0x51d980;},a2_0x4eb7(_0x1da3de,_0x1cab50);}'use strict';const setup=require('./setup');let activeTimer=null,currentMonitoredRoom=null,timeoutMs=0x0,startTime=0x0,alarmStage=0x0;const DEFAULT_TIMEOUTS={'bad':0x2d,'bath':0x2d,'toilet':0x1e,'wc':0x1e,'keller':0x3c,'schlaf':0x78,'bed':0x78,'guest':0x5a,'gast':0x5a};async function loadConfig(_0x1ff97c){const _0x4d0ae9=a2_0x4eb7;try{const _0xba8e2b=await _0x1ff97c[_0x4d0ae9(0x123)]('analysis.safety.deadMan.config');if(_0xba8e2b&&_0xba8e2b[_0x4d0ae9(0x100)])return JSON[_0x4d0ae9(0xff)](_0xba8e2b[_0x4d0ae9(0x100)]);}catch(_0x1b25b7){}return{};}async function isActive(_0x464587){const _0x10b8b9=a2_0x4eb7;try{const _0x34a7cc=await _0x464587[_0x10b8b9(0x123)]('analysis.safety.deadMan.active');return _0x34a7cc&&_0x34a7cc[_0x10b8b9(0x100)];}catch(_0x531cb5){return![];}}async function areRoomsConnected(_0x334133,_0x49ec09,_0x58612d){const _0x520c4d=a2_0x4eb7;try{const _0x190fa0=await _0x334133[_0x520c4d(0x123)]('analysis.topology.structure');if(!_0x190fa0||!_0x190fa0[_0x520c4d(0x100)])return!![];const _0xe585b1=JSON[_0x520c4d(0xff)](_0x190fa0[_0x520c4d(0x100)]),{rooms:_0x3e62ee,matrix:_0x36735d}=_0xe585b1;if(!_0x3e62ee||!_0x36735d)return!![];const _0x38e77f=_0x3e62ee[_0x520c4d(0x124)](_0x49ec09),_0x5a2d0e=_0x3e62ee[_0x520c4d(0x124)](_0x58612d);if(_0x38e77f===-0x1||_0x5a2d0e===-0x1)return!![];const _0x360c41=_0x36735d[_0x38e77f][_0x5a2d0e]>0x0||_0x36735d[_0x5a2d0e][_0x38e77f]>0x0;return _0x360c41;}catch(_0x386258){return _0x334133[_0x520c4d(0xfb)][_0x520c4d(0x11e)](_0x520c4d(0x117)+_0x386258[_0x520c4d(0x104)]),!![];}}function calculateSleepProbability(_0x5d2898){const _0x2649c6=a2_0x4eb7,_0x4c88e5=new Date(),_0x11ada9=_0x4c88e5[_0x2649c6(0xfd)](),_0x2f4106=_0x5d2898['toLowerCase']();let _0x5cfc48=0.1;if(_0x11ada9>=0x17||_0x11ada9<=0x6)_0x5cfc48=0x1;else{if(_0x11ada9>=0xd&&_0x11ada9<=0xf)_0x5cfc48=0.8;else{if(_0x11ada9>=0x14&&_0x11ada9<=0x17)_0x5cfc48=0.4;}}let _0x26953b=0.1;if(_0x2f4106['includes'](_0x2649c6(0x10a))||_0x2f4106[_0x2649c6(0x10b)](_0x2649c6(0xef)))_0x26953b=0x1;else{if(_0x2f4106[_0x2649c6(0x10b)]('wohn')||_0x2f4106[_0x2649c6(0x10b)](_0x2649c6(0xf8))||_0x2f4106[_0x2649c6(0x10b)](_0x2649c6(0x110)))_0x26953b=0.6;else{if(_0x2f4106['includes'](_0x2649c6(0xf4))||_0x2f4106[_0x2649c6(0x10b)]('wc'))_0x26953b=0.05;}}let _0x381572=0.5;const _0x233c76=_0x26953b*0.5+_0x5cfc48*0.3+_0x381572*0.2;return parseFloat(_0x233c76['toFixed'](0x2));}async function updateLocation(_0x30a06f,_0x3252c7){const _0x513785=a2_0x4eb7;if(!_0x3252c7||_0x3252c7===_0x513785(0xf3))return;if(!await isActive(_0x30a06f)){resetTimer(_0x30a06f);return;}if(currentMonitoredRoom&&currentMonitoredRoom!==_0x3252c7){const _0x1b931c=await areRoomsConnected(_0x30a06f,currentMonitoredRoom,_0x3252c7);if(!_0x1b931c){const _0x244b76=_0x513785(0x108)+_0x3252c7+'\x27.\x20Nicht\x20verbunden\x20mit\x20Ã¼berwachtem\x20\x27'+currentMonitoredRoom+'\x27.';_0x30a06f[_0x513785(0xfb)][_0x513785(0x107)](_0x513785(0x11d)+_0x244b76+_0x513785(0x128)),await _0x30a06f[_0x513785(0xf7)](_0x513785(0x116),{'val':JSON[_0x513785(0x10c)]({'room':_0x3252c7,'reason':_0x244b76,'timestamp':Date['now']()}),'ack':!![]});return;}resetTimer(_0x30a06f);}if(!currentMonitoredRoom){await _0x30a06f['setStateAsync'](_0x513785(0x112),{'val':_0x3252c7,'ack':!![]});const _0x19f612=await loadConfig(_0x30a06f),_0x359199=_0x3252c7[_0x513785(0x127)]();let _0xd6d3b4=_0x19f612[_0x3252c7]||_0x19f612[_0x359199];if(!_0xd6d3b4)for(const _0x44719c in DEFAULT_TIMEOUTS){if(_0x359199['includes'](_0x44719c)){_0xd6d3b4=DEFAULT_TIMEOUTS[_0x44719c];break;}}if(!_0xd6d3b4&&_0x19f612[_0x513785(0x11f)])_0xd6d3b4=_0x19f612[_0x513785(0x11f)];if(!_0xd6d3b4)return;currentMonitoredRoom=_0x3252c7,startTimer(_0x30a06f,_0xd6d3b4,_0x3252c7);}}function startTimer(_0x1cced2,_0x2cf06d,_0x3780e4){const _0x5c476c=a2_0x4eb7;if(activeTimer)clearTimeout(activeTimer);timeoutMs=_0x2cf06d*0x3c*0x3e8,startTime=Date[_0x5c476c(0x10e)](),alarmStage=0x0;const _0x1967bc=calculateSleepProbability(_0x3780e4||currentMonitoredRoom),_0x12be66=_0x1967bc>0.65;_0x12be66?(timeoutMs+=0x5a*0x3c*0x3e8,_0x1cced2[_0x5c476c(0xfb)][_0x5c476c(0x107)](_0x5c476c(0x119)+(_0x1967bc*0x64)[_0x5c476c(0x109)](0x0)+_0x5c476c(0x10f)+currentMonitoredRoom+'\x20um\x2090\x20Min.'),_0x1cced2[_0x5c476c(0xf7)](_0x5c476c(0x10d),{'val':!![],'ack':!![]})):_0x1cced2[_0x5c476c(0xf7)](_0x5c476c(0x10d),{'val':![],'ack':!![]}),_0x1cced2[_0x5c476c(0xf7)](_0x5c476c(0x120),{'val':_0x1967bc,'ack':!![]}),_0x1cced2[_0x5c476c(0xfb)][_0x5c476c(0x107)](_0x5c476c(0xf1)+currentMonitoredRoom+_0x5c476c(0xf0)+_0x2cf06d+_0x5c476c(0x103)),_0x1cced2['setStateAsync'](_0x5c476c(0xee),{'val':'ok','ack':!![]}),activeTimer=setTimeout(()=>triggerPreWarn(_0x1cced2),timeoutMs);}function resetTimer(_0x4b52e5){const _0x5f1318=a2_0x4eb7;if(activeTimer)clearTimeout(activeTimer);activeTimer=null,currentMonitoredRoom=null,alarmStage=0x0,_0x4b52e5['setStateAsync'](_0x5f1318(0xee),{'val':'ok','ack':!![]}),_0x4b52e5[_0x5f1318(0xf7)](_0x5f1318(0x10d),{'val':![],'ack':!![]}),_0x4b52e5[_0x5f1318(0xf7)](_0x5f1318(0x120),{'val':0x0,'ack':!![]});}async function triggerPreWarn(_0x257b82){const _0x29aa4c=a2_0x4eb7;alarmStage=0x1,await _0x257b82[_0x29aa4c(0xf7)](_0x29aa4c(0xee),{'val':_0x29aa4c(0xf2),'ack':!![]});const _0x4bc9be='â³\x20ACHTUNG:\x20UngewÃ¶hnlich\x20lange\x20InaktivitÃ¤t\x20in\x20'+currentMonitoredRoom+_0x29aa4c(0x106);_0x257b82[_0x29aa4c(0xfb)][_0x29aa4c(0x11e)]('[DeadMan]\x20'+_0x4bc9be),await setup[_0x29aa4c(0x126)](_0x257b82,'ðŸ‘¼\x20Schutzengel-Frage:\x20'+_0x4bc9be),activeTimer=setTimeout(()=>triggerAlarm(_0x257b82),0x5*0x3c*0x3e8);}async function triggerAlarm(_0x32e82a){const _0x101cab=a2_0x4eb7;alarmStage=0x2,await _0x32e82a['setStateAsync'](_0x101cab(0xee),{'val':'alarm','ack':!![]});const _0xe86e78=_0x101cab(0x105)+currentMonitoredRoom+'!';_0x32e82a[_0x101cab(0xfb)][_0x101cab(0x114)](_0x101cab(0x11d)+_0xe86e78),await setup[_0x101cab(0x126)](_0x32e82a,_0xe86e78,![],!![]);}module[a2_0x7f87a5(0x113)]={'updateLocation':updateLocation};