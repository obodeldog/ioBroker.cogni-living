const a2_0x35e601=a2_0xd5c7;(function(_0xf3e04d,_0x68a7f4){const _0x542b79=a2_0xd5c7,_0x456386=_0xf3e04d();while(!![]){try{const _0x331bc0=parseInt(_0x542b79(0xe5))/0x1+parseInt(_0x542b79(0xdb))/0x2*(-parseInt(_0x542b79(0xed))/0x3)+-parseInt(_0x542b79(0xd2))/0x4*(parseInt(_0x542b79(0xec))/0x5)+-parseInt(_0x542b79(0xe2))/0x6*(parseInt(_0x542b79(0xdd))/0x7)+-parseInt(_0x542b79(0xd7))/0x8*(-parseInt(_0x542b79(0xee))/0x9)+parseInt(_0x542b79(0xef))/0xa*(parseInt(_0x542b79(0xe0))/0xb)+parseInt(_0x542b79(0xe9))/0xc*(parseInt(_0x542b79(0xf9))/0xd);if(_0x331bc0===_0x68a7f4)break;else _0x456386['push'](_0x456386['shift']());}catch(_0x2f398c){_0x456386['push'](_0x456386['shift']());}}}(a2_0x5115,0xd1f30));const a2_0x16a269=(function(){let _0x33ee09=!![];return function(_0x4e2cc4,_0x5dcd2c){const _0x19ff4d=_0x33ee09?function(){if(_0x5dcd2c){const _0xf5f9d1=_0x5dcd2c['apply'](_0x4e2cc4,arguments);return _0x5dcd2c=null,_0xf5f9d1;}}:function(){};return _0x33ee09=![],_0x19ff4d;};}()),a2_0x599a4d=a2_0x16a269(this,function(){const _0x4dcc0a=a2_0xd5c7;return a2_0x599a4d[_0x4dcc0a(0xd3)]()[_0x4dcc0a(0xd5)]('(((.+)+)+)+$')[_0x4dcc0a(0xd3)]()[_0x4dcc0a(0xd9)](a2_0x599a4d)[_0x4dcc0a(0xd5)](_0x4dcc0a(0xfa));});function a2_0x5115(){const _0x2cbd22=['778715CeEgga','3BREXdU','99KRYogU','7690cxGNjW','info','val','error','\x20(Multi-Person\x20Filter)','\x20Min.','setStateAsync','[DeadMan]\x20Topology\x20check\x20failed:\x20','stringify','analysis.safety.deadMan.currentRoom','13UPqfuB','(((.+)+)+)+$','toLowerCase','ðŸš¨\x20NOTFALL-ALARM:\x20Person\x20reagiert\x20nicht\x20in\x20','indexOf','analysis.safety.deadMan.config','analysis.safety.deadMan.lastIgnored','message','8gzshIp','toString','log','search','now','279424Zfbufn','sendNotification','constructor','default','2300770IPqvhz','\x20fÃ¼r\x20','9939937QvJFFi','warn','Ignoriere\x20Bewegung\x20in\x20\x27','6644RodiWE','[DeadMan]\x20','6LREePc','exports','parse','902341uSWOCx','analysis.safety.deadMan.alarmState','ðŸ‘¼\x20Schutzengel:\x20Ãœberwache\x20','getStateAsync','23889468XUJAHc','.\x20Alles\x20in\x20Ordnung?','Unknown'];a2_0x5115=function(){return _0x2cbd22;};return a2_0x5115();}a2_0x599a4d();'use strict';const setup=require('./setup');function a2_0xd5c7(_0x3639c1,_0x37bae3){const _0x25a3c5=a2_0x5115();return a2_0xd5c7=function(_0x599a4d,_0x16a269){_0x599a4d=_0x599a4d-0xcc;let _0x511505=_0x25a3c5[_0x599a4d];return _0x511505;},a2_0xd5c7(_0x3639c1,_0x37bae3);}let activeTimer=null,currentMonitoredRoom=null,timeoutMs=0x0,startTime=0x0,alarmStage=0x0;const DEFAULT_TIMEOUTS={'bad':0x2d,'bath':0x2d,'toilet':0x1e,'wc':0x1e,'keller':0x3c};async function loadConfig(_0xe68135){const _0xd1e3e6=a2_0xd5c7;try{const _0x3b095c=await _0xe68135['getStateAsync'](_0xd1e3e6(0xcf));if(_0x3b095c&&_0x3b095c[_0xd1e3e6(0xf1)])return JSON[_0xd1e3e6(0xe4)](_0x3b095c[_0xd1e3e6(0xf1)]);}catch(_0x5d42b9){}return{};}async function isActive(_0xa59f66){const _0x3031e4=a2_0xd5c7;try{const _0x58b92b=await _0xa59f66[_0x3031e4(0xe8)]('analysis.safety.deadMan.active');return _0x58b92b&&_0x58b92b['val'];}catch(_0x1aa17b){return![];}}async function areRoomsConnected(_0x4f370b,_0x2cd220,_0x10d894){const _0xcd2388=a2_0xd5c7;try{const _0x30266a=await _0x4f370b[_0xcd2388(0xe8)]('analysis.topology.structure');if(!_0x30266a||!_0x30266a[_0xcd2388(0xf1)])return!![];const _0x56f9da=JSON[_0xcd2388(0xe4)](_0x30266a[_0xcd2388(0xf1)]),{rooms:_0x543b0b,matrix:_0xcc2e9f}=_0x56f9da;if(!_0x543b0b||!_0xcc2e9f)return!![];const _0x5a39b0=_0x543b0b['indexOf'](_0x2cd220),_0x5918b4=_0x543b0b[_0xcd2388(0xce)](_0x10d894);if(_0x5a39b0===-0x1||_0x5918b4===-0x1)return!![];const _0x193b7a=_0xcc2e9f[_0x5a39b0][_0x5918b4]>0x0||_0xcc2e9f[_0x5918b4][_0x5a39b0]>0x0;return _0x193b7a;}catch(_0x4846ce){return _0x4f370b[_0xcd2388(0xd4)][_0xcd2388(0xde)](_0xcd2388(0xf6)+_0x4846ce[_0xcd2388(0xd1)]),!![];}}async function updateLocation(_0x520c46,_0x240430){const _0x25dce0=a2_0xd5c7;if(!_0x240430||_0x240430===_0x25dce0(0xeb))return;if(!await isActive(_0x520c46)){resetTimer(_0x520c46);return;}if(currentMonitoredRoom&&currentMonitoredRoom!==_0x240430){const _0x2600f4=await areRoomsConnected(_0x520c46,currentMonitoredRoom,_0x240430);if(!_0x2600f4){const _0x4f4af5=_0x25dce0(0xdf)+_0x240430+'\x27.\x20Nicht\x20verbunden\x20mit\x20Ã¼berwachtem\x20\x27'+currentMonitoredRoom+'\x27.';_0x520c46[_0x25dce0(0xd4)][_0x25dce0(0xf0)](_0x25dce0(0xe1)+_0x4f4af5+_0x25dce0(0xf3)),await _0x520c46[_0x25dce0(0xf5)](_0x25dce0(0xd0),{'val':JSON[_0x25dce0(0xf7)]({'room':_0x240430,'reason':_0x4f4af5,'timestamp':Date[_0x25dce0(0xd6)]()}),'ack':!![]});return;}resetTimer(_0x520c46);}if(!currentMonitoredRoom){await _0x520c46[_0x25dce0(0xf5)](_0x25dce0(0xf8),{'val':_0x240430,'ack':!![]});const _0x4e397b=await loadConfig(_0x520c46),_0x3ed5b0=_0x240430[_0x25dce0(0xcc)]();let _0x1b15f7=_0x4e397b[_0x240430]||_0x4e397b[_0x3ed5b0];if(!_0x1b15f7)for(const _0x30a6c2 in DEFAULT_TIMEOUTS){if(_0x3ed5b0['includes'](_0x30a6c2)){_0x1b15f7=DEFAULT_TIMEOUTS[_0x30a6c2];break;}}if(!_0x1b15f7&&_0x4e397b[_0x25dce0(0xda)])_0x1b15f7=_0x4e397b[_0x25dce0(0xda)];if(!_0x1b15f7)return;currentMonitoredRoom=_0x240430,startTimer(_0x520c46,_0x1b15f7);}}function startTimer(_0x1dd543,_0x444745){const _0x294e16=a2_0xd5c7;if(activeTimer)clearTimeout(activeTimer);timeoutMs=_0x444745*0x3c*0x3e8,startTime=Date['now'](),alarmStage=0x0,_0x1dd543[_0x294e16(0xd4)][_0x294e16(0xf0)](_0x294e16(0xe7)+currentMonitoredRoom+_0x294e16(0xdc)+_0x444745+_0x294e16(0xf4)),_0x1dd543[_0x294e16(0xf5)]('analysis.safety.deadMan.alarmState',{'val':'ok','ack':!![]}),activeTimer=setTimeout(()=>triggerPreWarn(_0x1dd543),timeoutMs);}function resetTimer(_0x17018c){const _0x4e4253=a2_0xd5c7;if(activeTimer)clearTimeout(activeTimer);activeTimer=null,currentMonitoredRoom=null,alarmStage=0x0,_0x17018c[_0x4e4253(0xf5)](_0x4e4253(0xe6),{'val':'ok','ack':!![]});}async function triggerPreWarn(_0x16a324){const _0xc63462=a2_0xd5c7;alarmStage=0x1,await _0x16a324[_0xc63462(0xf5)]('analysis.safety.deadMan.alarmState',{'val':'pre_warn','ack':!![]});const _0x3e08e3='â³\x20ACHTUNG:\x20UngewÃ¶hnlich\x20lange\x20InaktivitÃ¤t\x20in\x20'+currentMonitoredRoom+_0xc63462(0xea);_0x16a324[_0xc63462(0xd4)][_0xc63462(0xde)](_0xc63462(0xe1)+_0x3e08e3),await setup[_0xc63462(0xd8)](_0x16a324,'ðŸ‘¼\x20Schutzengel-Frage:\x20'+_0x3e08e3),activeTimer=setTimeout(()=>triggerAlarm(_0x16a324),0x5*0x3c*0x3e8);}async function triggerAlarm(_0x213229){const _0x47b6ec=a2_0xd5c7;alarmStage=0x2,await _0x213229['setStateAsync'](_0x47b6ec(0xe6),{'val':'alarm','ack':!![]});const _0x473a9f=_0x47b6ec(0xcd)+currentMonitoredRoom+'!';_0x213229[_0x47b6ec(0xd4)][_0x47b6ec(0xf2)]('[DeadMan]\x20'+_0x473a9f),await setup[_0x47b6ec(0xd8)](_0x213229,_0x473a9f,![],!![]);}module[a2_0x35e601(0xe3)]={'updateLocation':updateLocation};