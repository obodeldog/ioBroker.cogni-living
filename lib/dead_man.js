const a2_0x3e30a2=a2_0xde61;(function(_0x1a0bf7,_0x1edc08){const _0x4adc66=a2_0xde61,_0xf38d19=_0x1a0bf7();while(!![]){try{const _0x1dcca3=-parseInt(_0x4adc66(0x1e2))/0x1+-parseInt(_0x4adc66(0x1f6))/0x2+parseInt(_0x4adc66(0x1e6))/0x3*(-parseInt(_0x4adc66(0x1e4))/0x4)+-parseInt(_0x4adc66(0x1f3))/0x5*(-parseInt(_0x4adc66(0x20e))/0x6)+-parseInt(_0x4adc66(0x20c))/0x7*(-parseInt(_0x4adc66(0x1e9))/0x8)+-parseInt(_0x4adc66(0x204))/0x9+parseInt(_0x4adc66(0x1f7))/0xa;if(_0x1dcca3===_0x1edc08)break;else _0xf38d19['push'](_0xf38d19['shift']());}catch(_0x562940){_0xf38d19['push'](_0xf38d19['shift']());}}}(a2_0x56b3,0x8e7de));const a2_0x64d4f1=(function(){let _0x14f3a1=!![];return function(_0x1be2bc,_0x19e5fe){const _0x14e26e=_0x14f3a1?function(){const _0x4c2fb8=a2_0xde61;if(_0x19e5fe){const _0x456037=_0x19e5fe[_0x4c2fb8(0x205)](_0x1be2bc,arguments);return _0x19e5fe=null,_0x456037;}}:function(){};return _0x14f3a1=![],_0x14e26e;};}()),a2_0x512ba0=a2_0x64d4f1(this,function(){const _0x5c3514=a2_0xde61;return a2_0x512ba0[_0x5c3514(0x208)]()[_0x5c3514(0x214)](_0x5c3514(0x1e5))['toString']()[_0x5c3514(0x20d)](a2_0x512ba0)['search']('(((.+)+)+)+$');});a2_0x512ba0();'use strict';const setup=require(a2_0x3e30a2(0x209));let activeTimer=null,currentMonitoredRoom=null,timeoutMs=0x0,startTime=0x0,alarmStage=0x0;const DEFAULT_TIMEOUTS={'bad':0x2d,'bath':0x2d,'toilet':0x1e,'wc':0x1e,'keller':0x3c,'schlaf':0x78,'bed':0x78,'guest':0x5a,'gast':0x5a};function getTimeoutRobust(_0x3a5907,_0x5e20bd){const _0x171f91=a2_0x3e30a2;if(!_0x3a5907||!_0x5e20bd)return undefined;if(_0x3a5907[_0x5e20bd])return _0x3a5907[_0x5e20bd];const _0x47aadd=_0x5e20bd[_0x171f91(0x215)]()[_0x171f91(0x200)](/[^a-z0-9]/g,'');for(const _0x345413 in _0x3a5907){const _0x397a2b=_0x345413['toLowerCase']()[_0x171f91(0x200)](/[^a-z0-9]/g,'');if(_0x397a2b===_0x47aadd)return _0x3a5907[_0x345413];}const _0x1203ff=_0x5e20bd[_0x171f91(0x215)]();if(_0x3a5907[_0x1203ff])return _0x3a5907[_0x1203ff];return undefined;}async function loadConfig(_0x5cf218){const _0x2d6130=a2_0x3e30a2;try{const _0x30680f=await _0x5cf218[_0x2d6130(0x20f)](_0x2d6130(0x1f4));if(_0x30680f&&_0x30680f[_0x2d6130(0x1eb)])return JSON[_0x2d6130(0x216)](_0x30680f[_0x2d6130(0x1eb)]);}catch(_0x594c55){}return{};}function a2_0xde61(_0x4b0b8c,_0x1b1150){const _0x18cc79=a2_0x56b3();return a2_0xde61=function(_0x512ba0,_0x64d4f1){_0x512ba0=_0x512ba0-0x1e2;let _0x56b3a3=_0x18cc79[_0x512ba0];return _0x56b3a3;},a2_0xde61(_0x4b0b8c,_0x1b1150);}function a2_0x56b3(){const _0x4cf2e8=['warn','message','info','living','analysis.safety.deadMan.currentRoom','ðŸ‘¼\x20Schutzengel-Frage:\x20','sendNotification','5llHsYR','analysis.safety.deadMan.config','bed','2149904iqOESV','28355700wmkuMI','exports','log','analysis.safety.deadMan.alarmState','Ignoriere\x20Bewegung\x20in\x20\x27','bad','indexOf','now','stringify','replace','\x20(Multi-Person\x20Filter)','\x20fÃ¼r\x20','alarm','1200042HqFSUs','apply','error','sofa','toString','./setup','ðŸ’¤\x20Smart\x20Sleep\x20erkannt\x20(','toFixed','792309lLuzQt','constructor','1477662CLaCbz','getStateAsync','getHours','pre_warn','includes','%).\x20VerlÃ¤ngere\x20Timer\x20fÃ¼r\x20','search','toLowerCase','parse','setStateAsync','â³\x20ACHTUNG:\x20UngewÃ¶hnlich\x20lange\x20InaktivitÃ¤t\x20in\x20','[DeadMan]\x20','ðŸš¨\x20NOTFALL-ALARM:\x20Person\x20reagiert\x20nicht\x20in\x20','242005LPJvdK','wohn','1548124FMPYLi','(((.+)+)+)+$','9FVWgiX','schlaf','analysis.topology.structure','8fJDLrg','analysis.safety.deadMan.napProbability','val'];a2_0x56b3=function(){return _0x4cf2e8;};return a2_0x56b3();}async function isActive(_0x1eb446){const _0x5db9a7=a2_0x3e30a2;try{const _0x1b3777=await _0x1eb446[_0x5db9a7(0x20f)]('analysis.safety.deadMan.active');return _0x1b3777&&_0x1b3777[_0x5db9a7(0x1eb)];}catch(_0x36ced8){return![];}}async function areRoomsConnected(_0x5d9a15,_0x1cdc61,_0x1aed12){const _0x21445a=a2_0x3e30a2;try{const _0x4ad990=await _0x5d9a15[_0x21445a(0x20f)](_0x21445a(0x1e8));if(!_0x4ad990||!_0x4ad990[_0x21445a(0x1eb)])return!![];const _0x2ec634=JSON[_0x21445a(0x216)](_0x4ad990['val']),{rooms:_0x284011,matrix:_0x33d2f5}=_0x2ec634;if(!_0x284011||!_0x33d2f5)return!![];const _0x5114e6=_0x284011[_0x21445a(0x1fd)](_0x1cdc61),_0x57627f=_0x284011['indexOf'](_0x1aed12);if(_0x5114e6===-0x1||_0x57627f===-0x1)return!![];const _0x1515fa=_0x33d2f5[_0x5114e6][_0x57627f]>0x0||_0x33d2f5[_0x57627f][_0x5114e6]>0x0;return _0x1515fa;}catch(_0x5b7068){return _0x5d9a15[_0x21445a(0x1f9)]['warn']('[DeadMan]\x20Topology\x20check\x20failed:\x20'+_0x5b7068[_0x21445a(0x1ed)]),!![];}}function calculateSleepProbability(_0x3a90ab){const _0x401a7c=a2_0x3e30a2,_0x4a4f9e=new Date(),_0x5792c7=_0x4a4f9e[_0x401a7c(0x210)](),_0x3c7a07=_0x3a90ab[_0x401a7c(0x215)]();let _0x5eec3f=0.1;if(_0x5792c7>=0x17||_0x5792c7<=0x6)_0x5eec3f=0x1;else{if(_0x5792c7>=0xd&&_0x5792c7<=0xf)_0x5eec3f=0.8;else{if(_0x5792c7>=0x14&&_0x5792c7<=0x17)_0x5eec3f=0.4;}}let _0x42a82e=0.1;if(_0x3c7a07[_0x401a7c(0x212)](_0x401a7c(0x1e7))||_0x3c7a07[_0x401a7c(0x212)](_0x401a7c(0x1f5)))_0x42a82e=0x1;else{if(_0x3c7a07['includes'](_0x401a7c(0x1e3))||_0x3c7a07[_0x401a7c(0x212)](_0x401a7c(0x1ef))||_0x3c7a07[_0x401a7c(0x212)](_0x401a7c(0x207)))_0x42a82e=0.6;else{if(_0x3c7a07['includes'](_0x401a7c(0x1fc))||_0x3c7a07['includes']('wc'))_0x42a82e=0.05;}}let _0x4f84e6=0.5;const _0x2ddc0d=_0x42a82e*0.5+_0x5eec3f*0.3+_0x4f84e6*0.2;return parseFloat(_0x2ddc0d['toFixed'](0x2));}async function updateLocation(_0x4bb17a,_0x3e55a0){const _0x3e0841=a2_0x3e30a2;if(!_0x3e55a0||_0x3e55a0==='Unknown')return;if(!await isActive(_0x4bb17a)){resetTimer(_0x4bb17a);return;}if(currentMonitoredRoom&&currentMonitoredRoom!==_0x3e55a0){const _0x576e83=await areRoomsConnected(_0x4bb17a,currentMonitoredRoom,_0x3e55a0);if(!_0x576e83){const _0x3be42c=_0x3e0841(0x1fb)+_0x3e55a0+'\x27.\x20Nicht\x20verbunden\x20mit\x20Ã¼berwachtem\x20\x27'+currentMonitoredRoom+'\x27.';_0x4bb17a[_0x3e0841(0x1f9)][_0x3e0841(0x1ee)](_0x3e0841(0x219)+_0x3be42c+_0x3e0841(0x201)),await _0x4bb17a[_0x3e0841(0x217)]('analysis.safety.deadMan.lastIgnored',{'val':JSON[_0x3e0841(0x1ff)]({'room':_0x3e55a0,'reason':_0x3be42c,'timestamp':Date[_0x3e0841(0x1fe)]()}),'ack':!![]});return;}resetTimer(_0x4bb17a);}if(!currentMonitoredRoom){await _0x4bb17a[_0x3e0841(0x217)](_0x3e0841(0x1f0),{'val':_0x3e55a0,'ack':!![]});const _0x1ae359=await loadConfig(_0x4bb17a);let _0x180106=getTimeoutRobust(_0x1ae359,_0x3e55a0);const _0x4863f9=_0x3e55a0[_0x3e0841(0x215)]();if(!_0x180106)for(const _0x4f40b8 in DEFAULT_TIMEOUTS){if(_0x4863f9['includes'](_0x4f40b8)){_0x180106=DEFAULT_TIMEOUTS[_0x4f40b8];break;}}if(!_0x180106&&_0x1ae359['default'])_0x180106=_0x1ae359['default'];if(!_0x180106)return;currentMonitoredRoom=_0x3e55a0,startTimer(_0x4bb17a,_0x180106,_0x3e55a0);}}function startTimer(_0x4a5a5d,_0x34f18b,_0x4bad22){const _0x25e622=a2_0x3e30a2;if(activeTimer)clearTimeout(activeTimer);timeoutMs=_0x34f18b*0x3c*0x3e8,startTime=Date[_0x25e622(0x1fe)](),alarmStage=0x0;const _0x34b4a9=calculateSleepProbability(_0x4bad22||currentMonitoredRoom),_0xd0af41=_0x34b4a9>0.65;_0xd0af41?(timeoutMs+=0x5a*0x3c*0x3e8,_0x4a5a5d[_0x25e622(0x1f9)]['info'](_0x25e622(0x20a)+(_0x34b4a9*0x64)[_0x25e622(0x20b)](0x0)+_0x25e622(0x213)+currentMonitoredRoom+'\x20um\x2090\x20Min.'),_0x4a5a5d[_0x25e622(0x217)]('analysis.safety.deadMan.smartSleep',{'val':!![],'ack':!![]})):_0x4a5a5d['setStateAsync']('analysis.safety.deadMan.smartSleep',{'val':![],'ack':!![]}),_0x4a5a5d[_0x25e622(0x217)]('analysis.safety.deadMan.napProbability',{'val':_0x34b4a9,'ack':!![]}),_0x4a5a5d[_0x25e622(0x1f9)][_0x25e622(0x1ee)]('ðŸ‘¼\x20Schutzengel:\x20Ãœberwache\x20'+currentMonitoredRoom+_0x25e622(0x202)+_0x34f18b+'\x20Min.'),_0x4a5a5d[_0x25e622(0x217)](_0x25e622(0x1fa),{'val':'ok','ack':!![]}),activeTimer=setTimeout(()=>triggerPreWarn(_0x4a5a5d),timeoutMs);}function resetTimer(_0x654457){const _0x831153=a2_0x3e30a2;if(activeTimer)clearTimeout(activeTimer);activeTimer=null,currentMonitoredRoom=null,alarmStage=0x0,_0x654457[_0x831153(0x217)](_0x831153(0x1fa),{'val':'ok','ack':!![]}),_0x654457[_0x831153(0x217)]('analysis.safety.deadMan.smartSleep',{'val':![],'ack':!![]}),_0x654457[_0x831153(0x217)](_0x831153(0x1ea),{'val':0x0,'ack':!![]});}async function triggerPreWarn(_0x65ed2a){const _0x44217e=a2_0x3e30a2;alarmStage=0x1,await _0x65ed2a[_0x44217e(0x217)]('analysis.safety.deadMan.alarmState',{'val':_0x44217e(0x211),'ack':!![]});const _0x39a71d=_0x44217e(0x218)+currentMonitoredRoom+'.\x20Alles\x20in\x20Ordnung?';_0x65ed2a[_0x44217e(0x1f9)][_0x44217e(0x1ec)](_0x44217e(0x219)+_0x39a71d),await setup[_0x44217e(0x1f2)](_0x65ed2a,_0x44217e(0x1f1)+_0x39a71d),activeTimer=setTimeout(()=>triggerAlarm(_0x65ed2a),0x5*0x3c*0x3e8);}async function triggerAlarm(_0x438e32){const _0x55f0b9=a2_0x3e30a2;alarmStage=0x2,await _0x438e32[_0x55f0b9(0x217)]('analysis.safety.deadMan.alarmState',{'val':_0x55f0b9(0x203),'ack':!![]});const _0x387faf=_0x55f0b9(0x21a)+currentMonitoredRoom+'!';_0x438e32[_0x55f0b9(0x1f9)][_0x55f0b9(0x206)](_0x55f0b9(0x219)+_0x387faf),await setup[_0x55f0b9(0x1f2)](_0x438e32,_0x387faf,![],!![]);}module[a2_0x3e30a2(0x1f8)]={'updateLocation':updateLocation};