const a2_0x15f646=a2_0xece6;(function(_0xd04205,_0x5c9f49){const _0x4c4152=a2_0xece6,_0x27f9c7=_0xd04205();while(!![]){try{const _0x4bac8e=-parseInt(_0x4c4152(0xfe))/0x1+-parseInt(_0x4c4152(0x121))/0x2*(parseInt(_0x4c4152(0x119))/0x3)+parseInt(_0x4c4152(0x117))/0x4+parseInt(_0x4c4152(0xf9))/0x5+parseInt(_0x4c4152(0xfb))/0x6*(parseInt(_0x4c4152(0x123))/0x7)+parseInt(_0x4c4152(0x118))/0x8*(parseInt(_0x4c4152(0x10d))/0x9)+-parseInt(_0x4c4152(0xfc))/0xa;if(_0x4bac8e===_0x5c9f49)break;else _0x27f9c7['push'](_0x27f9c7['shift']());}catch(_0x4dd8bf){_0x27f9c7['push'](_0x27f9c7['shift']());}}}(a2_0x4439,0x3180c));const a2_0x4a1a1f=(function(){let _0x1b034e=!![];return function(_0x2ba762,_0xe35dd){const _0x43308d=_0x1b034e?function(){const _0x4fffa6=a2_0xece6;if(_0xe35dd){const _0x1f8a9d=_0xe35dd[_0x4fffa6(0xfd)](_0x2ba762,arguments);return _0xe35dd=null,_0x1f8a9d;}}:function(){};return _0x1b034e=![],_0x43308d;};}()),a2_0x2b8490=a2_0x4a1a1f(this,function(){const _0x26822b=a2_0xece6;return a2_0x2b8490[_0x26822b(0x113)]()[_0x26822b(0x110)]('(((.+)+)+)+$')['toString']()[_0x26822b(0xea)](a2_0x2b8490)[_0x26822b(0x110)](_0x26822b(0xeb));});a2_0x2b8490();'use strict';const setup=require(a2_0x15f646(0x11d));let activeTimer=null,currentMonitoredRoom=null,timeoutMs=0x0,startTime=0x0,alarmStage=0x0;const DEFAULT_TIMEOUTS={'bad':0x2d,'bath':0x2d,'toilet':0x1e,'wc':0x1e,'keller':0x3c,'schlaf':0x78,'bed':0x78,'guest':0x5a,'gast':0x5a};function getTimeoutRobust(_0x45517a,_0x361a5f){const _0x12ed58=a2_0x15f646;if(!_0x45517a||!_0x361a5f)return undefined;if(_0x45517a[_0x361a5f])return _0x45517a[_0x361a5f];const _0x36aa71=_0x361a5f['toLowerCase']()[_0x12ed58(0x10c)](/[^a-z0-9]/g,'');for(const _0x5ea305 in _0x45517a){const _0x2100c9=_0x5ea305[_0x12ed58(0xe9)]()[_0x12ed58(0x10c)](/[^a-z0-9]/g,'');if(_0x2100c9===_0x36aa71)return _0x45517a[_0x5ea305];}const _0x6e0843=_0x361a5f['toLowerCase']();if(_0x45517a[_0x6e0843])return _0x45517a[_0x6e0843];return undefined;}async function loadConfig(_0x20a049){const _0x3c767c=a2_0x15f646;try{const _0x4dd856=await _0x20a049[_0x3c767c(0xf3)]('analysis.safety.deadMan.config');if(_0x4dd856&&_0x4dd856[_0x3c767c(0xff)])return JSON[_0x3c767c(0x111)](_0x4dd856[_0x3c767c(0xff)]);}catch(_0x361daf){}return{};}async function isActive(_0x1cb3d6){const _0x120a41=a2_0x15f646;try{const _0x302414=await _0x1cb3d6[_0x120a41(0xf3)](_0x120a41(0x115));return _0x302414&&_0x302414[_0x120a41(0xff)];}catch(_0x53979a){return![];}}async function areRoomsConnected(_0x32dca1,_0x3e0df9,_0x4272b0){const _0x4f4b33=a2_0x15f646;try{const _0x3236e7=await _0x32dca1['getStateAsync'](_0x4f4b33(0xf6));if(!_0x3236e7||!_0x3236e7[_0x4f4b33(0xff)])return!![];const _0x4b52e1=JSON[_0x4f4b33(0x111)](_0x3236e7[_0x4f4b33(0xff)]),{rooms:_0x32bc36,matrix:_0x3490ca}=_0x4b52e1;if(!_0x32bc36||!_0x3490ca)return!![];const _0x2d9248=_0x32bc36[_0x4f4b33(0x11c)](_0x3e0df9),_0x111545=_0x32bc36['indexOf'](_0x4272b0);if(_0x2d9248===-0x1||_0x111545===-0x1)return!![];const _0x665d5c=_0x3490ca[_0x2d9248][_0x111545]>0x0||_0x3490ca[_0x111545][_0x2d9248]>0x0;return _0x665d5c;}catch(_0xb5ec86){return _0x32dca1[_0x4f4b33(0x122)]['warn'](_0x4f4b33(0x107)+_0xb5ec86['message']),!![];}}function calculateSleepProbability(_0x5e899d){const _0x401468=a2_0x15f646,_0x101544=new Date(),_0x58c914=_0x101544[_0x401468(0x106)](),_0x492402=_0x5e899d[_0x401468(0xe9)]();let _0x5687e6=0.1;if(_0x58c914>=0x17||_0x58c914<=0x6)_0x5687e6=0x1;else{if(_0x58c914>=0xd&&_0x58c914<=0xf)_0x5687e6=0.8;else{if(_0x58c914>=0x14&&_0x58c914<=0x17)_0x5687e6=0.4;}}let _0x4a73ad=0.1;if(_0x492402[_0x401468(0xee)](_0x401468(0xf4))||_0x492402[_0x401468(0xee)](_0x401468(0x125)))_0x4a73ad=0x1;else{if(_0x492402['includes'](_0x401468(0x11a))||_0x492402[_0x401468(0xee)](_0x401468(0x10b))||_0x492402[_0x401468(0xee)]('sofa'))_0x4a73ad=0.6;else{if(_0x492402[_0x401468(0xee)](_0x401468(0x11e))||_0x492402[_0x401468(0xee)]('wc'))_0x4a73ad=0.05;}}let _0x3a9d10=0.5;const _0x532fde=_0x4a73ad*0.5+_0x5687e6*0.3+_0x3a9d10*0.2;return parseFloat(_0x532fde[_0x401468(0x124)](0x2));}async function updateLocation(_0x34055d,_0x57975b){const _0x50b6fd=a2_0x15f646;if(!_0x57975b||_0x57975b===_0x50b6fd(0xf2))return;if(!await isActive(_0x34055d)){resetTimer(_0x34055d);return;}if(currentMonitoredRoom&&currentMonitoredRoom!==_0x57975b){const _0x14f42f=await areRoomsConnected(_0x34055d,currentMonitoredRoom,_0x57975b);if(!_0x14f42f){const _0x61c75a=_0x50b6fd(0x108)+_0x57975b+_0x50b6fd(0x10a)+currentMonitoredRoom+'\x27.';_0x34055d['log']['info'](_0x50b6fd(0x102)+_0x61c75a+_0x50b6fd(0x103)),await _0x34055d['setStateAsync'](_0x50b6fd(0xf8),{'val':JSON[_0x50b6fd(0x105)]({'room':_0x57975b,'reason':_0x61c75a,'timestamp':Date[_0x50b6fd(0xec)]()}),'ack':!![]});return;}resetTimer(_0x34055d);}if(!currentMonitoredRoom){await _0x34055d['setStateAsync'](_0x50b6fd(0x104),{'val':_0x57975b,'ack':!![]});const _0x5f3504=await loadConfig(_0x34055d);let _0x423a26=getTimeoutRobust(_0x5f3504,_0x57975b);const _0x1d0871=_0x57975b[_0x50b6fd(0xe9)]();if(!_0x423a26)for(const _0x5c5d18 in DEFAULT_TIMEOUTS){if(_0x1d0871[_0x50b6fd(0xee)](_0x5c5d18)){_0x423a26=DEFAULT_TIMEOUTS[_0x5c5d18];break;}}if(!_0x423a26&&_0x5f3504[_0x50b6fd(0x109)])_0x423a26=_0x5f3504[_0x50b6fd(0x109)];if(!_0x423a26)return;currentMonitoredRoom=_0x57975b,startTimer(_0x34055d,_0x423a26,_0x57975b);}}function a2_0xece6(_0x2a4157,_0x4f681c){const _0x191cb2=a2_0x4439();return a2_0xece6=function(_0x2b8490,_0x4a1a1f){_0x2b8490=_0x2b8490-0xe9;let _0x4439e1=_0x191cb2[_0x2b8490];return _0x4439e1;},a2_0xece6(_0x2a4157,_0x4f681c);}function startTimer(_0xb743aa,_0x4e101b,_0x258970){const _0x79b4c1=a2_0x15f646;if(activeTimer)clearTimeout(activeTimer);timeoutMs=_0x4e101b*0x3c*0x3e8,startTime=Date['now'](),alarmStage=0x0;const _0xaf9bcb=calculateSleepProbability(_0x258970||currentMonitoredRoom),_0x2127c6=_0xaf9bcb>0.65;_0x2127c6?(timeoutMs+=0x5a*0x3c*0x3e8,_0xb743aa[_0x79b4c1(0x122)]['info'](_0x79b4c1(0x114)+(_0xaf9bcb*0x64)[_0x79b4c1(0x124)](0x0)+_0x79b4c1(0x11b)+currentMonitoredRoom+_0x79b4c1(0xfa)),_0xb743aa['setStateAsync']('analysis.safety.deadMan.smartSleep',{'val':!![],'ack':!![]})):_0xb743aa['setStateAsync'](_0x79b4c1(0xf0),{'val':![],'ack':!![]}),_0xb743aa[_0x79b4c1(0x10f)]('analysis.safety.deadMan.napProbability',{'val':_0xaf9bcb,'ack':!![]}),_0xb743aa[_0x79b4c1(0x122)][_0x79b4c1(0x100)](_0x79b4c1(0xef)+currentMonitoredRoom+'\x20fÃ¼r\x20'+_0x4e101b+_0x79b4c1(0xf7)),_0xb743aa[_0x79b4c1(0x10f)](_0x79b4c1(0x10e),{'val':'ok','ack':!![]}),activeTimer=setTimeout(()=>triggerPreWarn(_0xb743aa),timeoutMs);}function a2_0x4439(){const _0x178a70=['getStateAsync','schlaf','warn','analysis.topology.structure','\x20Min.','analysis.safety.deadMan.lastIgnored','1115620nCpsVY','\x20um\x2090\x20Min.','232758YKpYjH','6784690XIJlDA','apply','22164OMOzHL','val','info','exports','[DeadMan]\x20','\x20(Multi-Person\x20Filter)','analysis.safety.deadMan.currentRoom','stringify','getHours','[DeadMan]\x20Topology\x20check\x20failed:\x20','Ignoriere\x20Bewegung\x20in\x20\x27','default','\x27.\x20Nicht\x20verbunden\x20mit\x20Ã¼berwachtem\x20\x27','living','replace','1404657DheweP','analysis.safety.deadMan.alarmState','setStateAsync','search','parse','sendNotification','toString','ðŸ’¤\x20Smart\x20Sleep\x20erkannt\x20(','analysis.safety.deadMan.active','pre_warn','132720uqtBgP','16NqaJzV','258Erzloa','wohn','%).\x20VerlÃ¤ngere\x20Timer\x20fÃ¼r\x20','indexOf','./setup','bad','ðŸ‘¼\x20Schutzengel-Frage:\x20','analysis.safety.deadMan.napProbability','330ccDtGZ','log','63wLTqDl','toFixed','bed','toLowerCase','constructor','(((.+)+)+)+$','now','alarm','includes','ðŸ‘¼\x20Schutzengel:\x20Ãœberwache\x20','analysis.safety.deadMan.smartSleep','.\x20Alles\x20in\x20Ordnung?','Unknown'];a2_0x4439=function(){return _0x178a70;};return a2_0x4439();}function resetTimer(_0x2dbe63){const _0x39f762=a2_0x15f646;if(activeTimer)clearTimeout(activeTimer);activeTimer=null,currentMonitoredRoom=null,alarmStage=0x0,_0x2dbe63['setStateAsync']('analysis.safety.deadMan.alarmState',{'val':'ok','ack':!![]}),_0x2dbe63[_0x39f762(0x10f)](_0x39f762(0xf0),{'val':![],'ack':!![]}),_0x2dbe63[_0x39f762(0x10f)](_0x39f762(0x120),{'val':0x0,'ack':!![]});}async function triggerPreWarn(_0x576e52){const _0x3840ae=a2_0x15f646;alarmStage=0x1,await _0x576e52[_0x3840ae(0x10f)](_0x3840ae(0x10e),{'val':_0x3840ae(0x116),'ack':!![]});const _0x916bc2='â³\x20ACHTUNG:\x20UngewÃ¶hnlich\x20lange\x20InaktivitÃ¤t\x20in\x20'+currentMonitoredRoom+_0x3840ae(0xf1);_0x576e52[_0x3840ae(0x122)][_0x3840ae(0xf5)](_0x3840ae(0x102)+_0x916bc2),await setup[_0x3840ae(0x112)](_0x576e52,_0x3840ae(0x11f)+_0x916bc2),activeTimer=setTimeout(()=>triggerAlarm(_0x576e52),0x5*0x3c*0x3e8);}async function triggerAlarm(_0x40ae85){const _0x53e440=a2_0x15f646;alarmStage=0x2,await _0x40ae85[_0x53e440(0x10f)](_0x53e440(0x10e),{'val':_0x53e440(0xed),'ack':!![]});const _0x2442b7='ðŸš¨\x20NOTFALL-ALARM:\x20Person\x20reagiert\x20nicht\x20in\x20'+currentMonitoredRoom+'!';_0x40ae85[_0x53e440(0x122)]['error']('[DeadMan]\x20'+_0x2442b7),await setup[_0x53e440(0x112)](_0x40ae85,_0x2442b7,![],!![]);}module[a2_0x15f646(0x101)]={'updateLocation':updateLocation};