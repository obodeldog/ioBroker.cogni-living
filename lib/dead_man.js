const a2_0x499a1d=a2_0x3308;(function(_0x33811c,_0x5bd863){const _0x4ad71d=a2_0x3308,_0x27ce00=_0x33811c();while(!![]){try{const _0x98fe2f=parseInt(_0x4ad71d(0x1eb))/0x1*(parseInt(_0x4ad71d(0x1f0))/0x2)+parseInt(_0x4ad71d(0x1ed))/0x3*(parseInt(_0x4ad71d(0x225))/0x4)+parseInt(_0x4ad71d(0x1ff))/0x5*(parseInt(_0x4ad71d(0x1fd))/0x6)+-parseInt(_0x4ad71d(0x207))/0x7+parseInt(_0x4ad71d(0x204))/0x8*(-parseInt(_0x4ad71d(0x215))/0x9)+-parseInt(_0x4ad71d(0x1f2))/0xa+parseInt(_0x4ad71d(0x216))/0xb;if(_0x98fe2f===_0x5bd863)break;else _0x27ce00['push'](_0x27ce00['shift']());}catch(_0x1d6e3b){_0x27ce00['push'](_0x27ce00['shift']());}}}(a2_0x45f1,0xdb3da));const a2_0xe7bfdd=(function(){let _0x3aec8d=!![];return function(_0x54afbd,_0xd26d6d){const _0xf42cee=_0x3aec8d?function(){const _0x2d5d64=a2_0x3308;if(_0xd26d6d){const _0x544142=_0xd26d6d[_0x2d5d64(0x1f6)](_0x54afbd,arguments);return _0xd26d6d=null,_0x544142;}}:function(){};return _0x3aec8d=![],_0xf42cee;};}()),a2_0xb5d52c=a2_0xe7bfdd(this,function(){const _0x2fee22=a2_0x3308;return a2_0xb5d52c[_0x2fee22(0x217)]()[_0x2fee22(0x1f9)](_0x2fee22(0x223))[_0x2fee22(0x217)]()[_0x2fee22(0x20f)](a2_0xb5d52c)[_0x2fee22(0x1f9)](_0x2fee22(0x223));});a2_0xb5d52c();'use strict';function a2_0x3308(_0x48c354,_0x31b38f){const _0x5ebb05=a2_0x45f1();return a2_0x3308=function(_0xb5d52c,_0xe7bfdd){_0xb5d52c=_0xb5d52c-0x1eb;let _0x45f163=_0x5ebb05[_0xb5d52c];return _0x45f163;},a2_0x3308(_0x48c354,_0x31b38f);}const setup=require(a2_0x499a1d(0x220));function a2_0x45f1(){const _0x597f04=['parse','%).\x20VerlÃ¤ngere\x20Timer\x20fÃ¼r\x20','search','message','analysis.safety.deadMan.napProbability','error','573258aBVkjG','bed','65OzmXIC','â³\x20ACHTUNG:\x20UngewÃ¶hnlich\x20lange\x20InaktivitÃ¤t\x20in\x20','default','analysis.safety.deadMan.alarmState','getStateAsync','4507464PCcirS','living','analysis.topology.structure','1519329XebIWL','sendNotification','val','info','ðŸ‘¼\x20Schutzengel:\x20Ãœberwache\x20','\x20um\x2090\x20Min.','[DeadMan]\x20Topology\x20check\x20failed:\x20','toFixed','constructor','pre_warn','\x27.\x20Nicht\x20verbunden\x20mit\x20Ã¼berwachtem\x20\x27','analysis.safety.deadMan.config','ðŸš¨\x20NOTFALL-ALARM:\x20Person\x20reagiert\x20nicht\x20in\x20','wohn','9LOfnNt','2011119ttuYBI','toString','Ignoriere\x20Bewegung\x20in\x20\x27','[DeadMan]\x20','now','ðŸ‘¼\x20Schutzengel-Frage:\x20','setStateAsync','replace','log','getHours','./setup','analysis.safety.deadMan.currentRoom','analysis.safety.deadMan.lastIgnored','(((.+)+)+)+$','toLowerCase','175444ZiCqdr','indexOf','\x20(Multi-Person\x20Filter)','104273rebkOV','stringify','36YlfVbm','analysis.safety.deadMan.smartSleep','exports','2opzlvI','includes','3770030dRovGA','.\x20Alles\x20in\x20Ordnung?','Unknown','\x20fÃ¼r\x20','apply'];a2_0x45f1=function(){return _0x597f04;};return a2_0x45f1();}let activeTimer=null,currentMonitoredRoom=null,timeoutMs=0x0,startTime=0x0,alarmStage=0x0;const DEFAULT_TIMEOUTS={'bad':0x2d,'bath':0x2d,'toilet':0x1e,'wc':0x1e,'keller':0x3c,'schlaf':0x78,'bed':0x78,'guest':0x5a,'gast':0x5a};function getTimeoutRobust(_0x3d4e1a,_0x29e380){const _0x5220a7=a2_0x499a1d;if(!_0x3d4e1a||!_0x29e380)return undefined;if(_0x3d4e1a[_0x29e380])return _0x3d4e1a[_0x29e380];const _0x444ed1=_0x29e380[_0x5220a7(0x224)]()[_0x5220a7(0x21d)](/[^a-z0-9]/g,'');for(const _0x3c7cc3 in _0x3d4e1a){const _0x3435e0=_0x3c7cc3['toLowerCase']()['replace'](/[^a-z0-9]/g,'');if(_0x3435e0===_0x444ed1)return _0x3d4e1a[_0x3c7cc3];}const _0x47c518=_0x29e380[_0x5220a7(0x224)]();if(_0x3d4e1a[_0x47c518])return _0x3d4e1a[_0x47c518];return undefined;}async function loadConfig(_0x50794e){const _0x334069=a2_0x499a1d;try{const _0x54ad4c=await _0x50794e[_0x334069(0x203)](_0x334069(0x212));if(_0x54ad4c&&_0x54ad4c[_0x334069(0x209)])return JSON[_0x334069(0x1f7)](_0x54ad4c['val']);}catch(_0x17501c){}return{};}async function isActive(_0x15d014){const _0x4d3c31=a2_0x499a1d;try{const _0x5909de=await _0x15d014[_0x4d3c31(0x203)]('analysis.safety.deadMan.active');return _0x5909de&&_0x5909de[_0x4d3c31(0x209)];}catch(_0x15d97c){return![];}}async function areRoomsConnected(_0x3c53a1,_0x59a754,_0x2eba33){const _0x500ca0=a2_0x499a1d;try{const _0x55c7eb=await _0x3c53a1['getStateAsync'](_0x500ca0(0x206));if(!_0x55c7eb||!_0x55c7eb[_0x500ca0(0x209)])return!![];const _0x59d29e=JSON['parse'](_0x55c7eb[_0x500ca0(0x209)]),{rooms:_0x355210,matrix:_0x58e7c4}=_0x59d29e;if(!_0x355210||!_0x58e7c4)return!![];const _0x5edf1f=_0x355210[_0x500ca0(0x226)](_0x59a754),_0x237755=_0x355210[_0x500ca0(0x226)](_0x2eba33);if(_0x5edf1f===-0x1||_0x237755===-0x1)return!![];const _0x5cead9=_0x58e7c4[_0x5edf1f][_0x237755]>0x0||_0x58e7c4[_0x237755][_0x5edf1f]>0x0;return _0x5cead9;}catch(_0x25bfa9){return _0x3c53a1[_0x500ca0(0x21e)]['warn'](_0x500ca0(0x20d)+_0x25bfa9[_0x500ca0(0x1fa)]),!![];}}function calculateSleepProbability(_0xfa595a){const _0x5e310a=a2_0x499a1d,_0x4caed8=new Date(),_0x567221=_0x4caed8[_0x5e310a(0x21f)](),_0x32eaee=_0xfa595a[_0x5e310a(0x224)]();let _0x56f01a=0.1;if(_0x567221>=0x17||_0x567221<=0x6)_0x56f01a=0x1;else{if(_0x567221>=0xd&&_0x567221<=0xf)_0x56f01a=0.8;else{if(_0x567221>=0x14&&_0x567221<=0x17)_0x56f01a=0.4;}}let _0x5e4d60=0.1;if(_0x32eaee[_0x5e310a(0x1f1)]('schlaf')||_0x32eaee[_0x5e310a(0x1f1)](_0x5e310a(0x1fe)))_0x5e4d60=0x1;else{if(_0x32eaee['includes'](_0x5e310a(0x214))||_0x32eaee[_0x5e310a(0x1f1)](_0x5e310a(0x205))||_0x32eaee[_0x5e310a(0x1f1)]('sofa'))_0x5e4d60=0.6;else{if(_0x32eaee[_0x5e310a(0x1f1)]('bad')||_0x32eaee[_0x5e310a(0x1f1)]('wc'))_0x5e4d60=0.05;}}let _0x187934=0.5;const _0x8e8788=_0x5e4d60*0.5+_0x56f01a*0.3+_0x187934*0.2;return parseFloat(_0x8e8788[_0x5e310a(0x20e)](0x2));}async function updateLocation(_0x69dc9e,_0x32d7b0){const _0x33b8e0=a2_0x499a1d;if(!_0x32d7b0||_0x32d7b0===_0x33b8e0(0x1f4))return;if(!await isActive(_0x69dc9e)){resetTimer(_0x69dc9e);return;}if(currentMonitoredRoom&&currentMonitoredRoom!==_0x32d7b0){const _0xe2f4bc=await areRoomsConnected(_0x69dc9e,currentMonitoredRoom,_0x32d7b0);if(!_0xe2f4bc){const _0x397e12=_0x33b8e0(0x218)+_0x32d7b0+_0x33b8e0(0x211)+currentMonitoredRoom+'\x27.';_0x69dc9e['log'][_0x33b8e0(0x20a)](_0x33b8e0(0x219)+_0x397e12+_0x33b8e0(0x227)),await _0x69dc9e[_0x33b8e0(0x21c)](_0x33b8e0(0x222),{'val':JSON[_0x33b8e0(0x1ec)]({'room':_0x32d7b0,'reason':_0x397e12,'timestamp':Date[_0x33b8e0(0x21a)]()}),'ack':!![]});return;}resetTimer(_0x69dc9e);}if(!currentMonitoredRoom){await _0x69dc9e[_0x33b8e0(0x21c)](_0x33b8e0(0x221),{'val':_0x32d7b0,'ack':!![]});const _0x49b62a=await loadConfig(_0x69dc9e);let _0x3620c1=getTimeoutRobust(_0x49b62a,_0x32d7b0);const _0x1063dd=_0x32d7b0[_0x33b8e0(0x224)]();if(!_0x3620c1)for(const _0x583ef2 in DEFAULT_TIMEOUTS){if(_0x1063dd[_0x33b8e0(0x1f1)](_0x583ef2)){_0x3620c1=DEFAULT_TIMEOUTS[_0x583ef2];break;}}if(!_0x3620c1&&_0x49b62a['default'])_0x3620c1=_0x49b62a[_0x33b8e0(0x201)];if(!_0x3620c1)return;currentMonitoredRoom=_0x32d7b0,startTimer(_0x69dc9e,_0x3620c1,_0x32d7b0);}}function startTimer(_0x477938,_0x3eddeb,_0x2f8472){const _0x19d23b=a2_0x499a1d;if(activeTimer)clearTimeout(activeTimer);timeoutMs=_0x3eddeb*0x3c*0x3e8,startTime=Date[_0x19d23b(0x21a)](),alarmStage=0x0;const _0x59554e=calculateSleepProbability(_0x2f8472||currentMonitoredRoom),_0x3f61ae=_0x59554e>0.65;_0x3f61ae?(timeoutMs+=0x5a*0x3c*0x3e8,_0x477938[_0x19d23b(0x21e)]['info']('ðŸ’¤\x20Smart\x20Sleep\x20erkannt\x20('+(_0x59554e*0x64)[_0x19d23b(0x20e)](0x0)+_0x19d23b(0x1f8)+currentMonitoredRoom+_0x19d23b(0x20c)),_0x477938[_0x19d23b(0x21c)](_0x19d23b(0x1ee),{'val':!![],'ack':!![]})):_0x477938['setStateAsync'](_0x19d23b(0x1ee),{'val':![],'ack':!![]}),_0x477938[_0x19d23b(0x21c)](_0x19d23b(0x1fb),{'val':_0x59554e,'ack':!![]}),_0x477938[_0x19d23b(0x21e)][_0x19d23b(0x20a)](_0x19d23b(0x20b)+currentMonitoredRoom+_0x19d23b(0x1f5)+_0x3eddeb+'\x20Min.'),_0x477938[_0x19d23b(0x21c)]('analysis.safety.deadMan.alarmState',{'val':'ok','ack':!![]}),activeTimer=setTimeout(()=>triggerPreWarn(_0x477938),timeoutMs);}function resetTimer(_0x582dc0){const _0x405dd5=a2_0x499a1d;if(activeTimer)clearTimeout(activeTimer);activeTimer=null,currentMonitoredRoom=null,alarmStage=0x0,_0x582dc0[_0x405dd5(0x21c)](_0x405dd5(0x202),{'val':'ok','ack':!![]}),_0x582dc0[_0x405dd5(0x21c)](_0x405dd5(0x1ee),{'val':![],'ack':!![]}),_0x582dc0['setStateAsync'](_0x405dd5(0x1fb),{'val':0x0,'ack':!![]});}async function triggerPreWarn(_0x2d3f47){const _0xc49b28=a2_0x499a1d;alarmStage=0x1,await _0x2d3f47[_0xc49b28(0x21c)](_0xc49b28(0x202),{'val':_0xc49b28(0x210),'ack':!![]});const _0x159604=_0xc49b28(0x200)+currentMonitoredRoom+_0xc49b28(0x1f3);_0x2d3f47[_0xc49b28(0x21e)]['warn']('[DeadMan]\x20'+_0x159604),await setup[_0xc49b28(0x208)](_0x2d3f47,_0xc49b28(0x21b)+_0x159604),activeTimer=setTimeout(()=>triggerAlarm(_0x2d3f47),0x5*0x3c*0x3e8);}async function triggerAlarm(_0x4ae249){const _0x21ab0c=a2_0x499a1d;alarmStage=0x2,await _0x4ae249['setStateAsync'](_0x21ab0c(0x202),{'val':'alarm','ack':!![]});const _0x276402=_0x21ab0c(0x213)+currentMonitoredRoom+'!';_0x4ae249['log'][_0x21ab0c(0x1fc)](_0x21ab0c(0x219)+_0x276402),await setup[_0x21ab0c(0x208)](_0x4ae249,_0x276402,![],!![]);}module[a2_0x499a1d(0x1ef)]={'updateLocation':updateLocation};