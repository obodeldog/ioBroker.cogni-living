const a2_0x533e39=a2_0x3864;(function(_0x2068a9,_0x2a49d6){const _0x54022b=a2_0x3864,_0xca3271=_0x2068a9();while(!![]){try{const _0x208f2b=-parseInt(_0x54022b(0x176))/0x1+-parseInt(_0x54022b(0x157))/0x2*(-parseInt(_0x54022b(0x15f))/0x3)+parseInt(_0x54022b(0x167))/0x4*(-parseInt(_0x54022b(0x162))/0x5)+-parseInt(_0x54022b(0x169))/0x6*(-parseInt(_0x54022b(0x156))/0x7)+parseInt(_0x54022b(0x159))/0x8+-parseInt(_0x54022b(0x166))/0x9*(parseInt(_0x54022b(0x151))/0xa)+-parseInt(_0x54022b(0x160))/0xb*(-parseInt(_0x54022b(0x161))/0xc);if(_0x208f2b===_0x2a49d6)break;else _0xca3271['push'](_0xca3271['shift']());}catch(_0xc0b0ec){_0xca3271['push'](_0xca3271['shift']());}}}(a2_0x4d56,0x333b0));function a2_0x4d56(){const _0x2dce0a=['3YoNjBG','11qBDVCo','6027132LGIOVu','5MCGUDg','error','parse','message','4410CSfcWw','711564ifAqsM','.\x20Alles\x20in\x20Ordnung?','10866LFQaHH','now','constructor','analysis.topology.structure','info','analysis.safety.deadMan.currentRoom','\x20(Multi-Person\x20Filter)','[DeadMan]\x20','alarm','indexOf','./setup','exports','[DeadMan]\x20Topology\x20check\x20failed:\x20','100936jsROqM','â³\x20ACHTUNG:\x20UngewÃ¶hnlich\x20lange\x20InaktivitÃ¤t\x20in\x20','analysis.safety.deadMan.alarmState','setStateAsync','ðŸ‘¼\x20Schutzengel:\x20Ãœberwache\x20','\x20Min.','getStateAsync','toLowerCase','log','default','includes','950aGwNvB','analysis.safety.deadMan.active','val','(((.+)+)+)+$','analysis.safety.deadMan.lastIgnored','28pCLIgp','46378AtgTOK','ðŸš¨\x20NOTFALL-ALARM:\x20Person\x20reagiert\x20nicht\x20in\x20','20184vzhpml','toString','analysis.safety.deadMan.config','warn','search','ðŸ‘¼\x20Schutzengel-Frage:\x20'];a2_0x4d56=function(){return _0x2dce0a;};return a2_0x4d56();}const a2_0x387a74=(function(){let _0x3cbb81=!![];return function(_0x14321f,_0x4f7dbc){const _0x400de2=_0x3cbb81?function(){if(_0x4f7dbc){const _0xadcc9d=_0x4f7dbc['apply'](_0x14321f,arguments);return _0x4f7dbc=null,_0xadcc9d;}}:function(){};return _0x3cbb81=![],_0x400de2;};}()),a2_0x56a824=a2_0x387a74(this,function(){const _0x1dc33c=a2_0x3864;return a2_0x56a824[_0x1dc33c(0x15a)]()['search'](_0x1dc33c(0x154))['toString']()[_0x1dc33c(0x16b)](a2_0x56a824)[_0x1dc33c(0x15d)](_0x1dc33c(0x154));});a2_0x56a824();'use strict';const setup=require(a2_0x533e39(0x173));function a2_0x3864(_0x561675,_0x252ebf){const _0x463256=a2_0x4d56();return a2_0x3864=function(_0x56a824,_0x387a74){_0x56a824=_0x56a824-0x14d;let _0x4d5621=_0x463256[_0x56a824];return _0x4d5621;},a2_0x3864(_0x561675,_0x252ebf);}let activeTimer=null,currentMonitoredRoom=null,timeoutMs=0x0,startTime=0x0,alarmStage=0x0;const DEFAULT_TIMEOUTS={'bad':0x2d,'bath':0x2d,'toilet':0x1e,'wc':0x1e,'keller':0x3c};async function loadConfig(_0x57743a){const _0x309e5c=a2_0x533e39;try{const _0x4f74e1=await _0x57743a['getStateAsync'](_0x309e5c(0x15b));if(_0x4f74e1&&_0x4f74e1['val'])return JSON[_0x309e5c(0x164)](_0x4f74e1[_0x309e5c(0x153)]);}catch(_0x54fe6d){}return{};}async function isActive(_0x191370){const _0x51efd1=a2_0x533e39;try{const _0x3fc9a0=await _0x191370[_0x51efd1(0x17c)](_0x51efd1(0x152));return _0x3fc9a0&&_0x3fc9a0[_0x51efd1(0x153)];}catch(_0x22ef30){return![];}}async function areRoomsConnected(_0x41ea93,_0x2878a4,_0x2cc583){const _0x1a859b=a2_0x533e39;try{const _0xed5e76=await _0x41ea93['getStateAsync'](_0x1a859b(0x16c));if(!_0xed5e76||!_0xed5e76['val'])return!![];const _0x43e90f=JSON['parse'](_0xed5e76[_0x1a859b(0x153)]),{rooms:_0x547776,matrix:_0x58b464}=_0x43e90f;if(!_0x547776||!_0x58b464)return!![];const _0x21a140=_0x547776['indexOf'](_0x2878a4),_0x5a4bc8=_0x547776[_0x1a859b(0x172)](_0x2cc583);if(_0x21a140===-0x1||_0x5a4bc8===-0x1)return!![];const _0x1d3a6c=_0x58b464[_0x21a140][_0x5a4bc8]>0x0||_0x58b464[_0x5a4bc8][_0x21a140]>0x0;return _0x1d3a6c;}catch(_0xe41445){return _0x41ea93['log'][_0x1a859b(0x15c)](_0x1a859b(0x175)+_0xe41445[_0x1a859b(0x165)]),!![];}}async function updateLocation(_0x5e87e7,_0xbc97da){const _0x4bbb4f=a2_0x533e39;if(!_0xbc97da||_0xbc97da==='Unknown')return;if(!await isActive(_0x5e87e7)){resetTimer(_0x5e87e7);return;}if(currentMonitoredRoom&&currentMonitoredRoom!==_0xbc97da){const _0x55443f=await areRoomsConnected(_0x5e87e7,currentMonitoredRoom,_0xbc97da);if(!_0x55443f){const _0x4c6b95='Ignoriere\x20Bewegung\x20in\x20\x27'+_0xbc97da+'\x27.\x20Nicht\x20verbunden\x20mit\x20Ã¼berwachtem\x20\x27'+currentMonitoredRoom+'\x27.';_0x5e87e7[_0x4bbb4f(0x14e)][_0x4bbb4f(0x16d)]('[DeadMan]\x20'+_0x4c6b95+_0x4bbb4f(0x16f)),await _0x5e87e7[_0x4bbb4f(0x179)](_0x4bbb4f(0x155),{'val':JSON['stringify']({'room':_0xbc97da,'reason':_0x4c6b95,'timestamp':Date[_0x4bbb4f(0x16a)]()}),'ack':!![]});return;}resetTimer(_0x5e87e7);}if(!currentMonitoredRoom){await _0x5e87e7[_0x4bbb4f(0x179)](_0x4bbb4f(0x16e),{'val':_0xbc97da,'ack':!![]});const _0x417a32=await loadConfig(_0x5e87e7),_0x46db1b=_0xbc97da[_0x4bbb4f(0x14d)]();let _0x4bee51=_0x417a32[_0xbc97da]||_0x417a32[_0x46db1b];if(!_0x4bee51)for(const _0x34a565 in DEFAULT_TIMEOUTS){if(_0x46db1b[_0x4bbb4f(0x150)](_0x34a565)){_0x4bee51=DEFAULT_TIMEOUTS[_0x34a565];break;}}if(!_0x4bee51&&_0x417a32['default'])_0x4bee51=_0x417a32[_0x4bbb4f(0x14f)];if(!_0x4bee51)return;currentMonitoredRoom=_0xbc97da,startTimer(_0x5e87e7,_0x4bee51);}}function startTimer(_0x3cf3be,_0x5edf10){const _0x275a5e=a2_0x533e39;if(activeTimer)clearTimeout(activeTimer);timeoutMs=_0x5edf10*0x3c*0x3e8,startTime=Date[_0x275a5e(0x16a)](),alarmStage=0x0,_0x3cf3be[_0x275a5e(0x14e)][_0x275a5e(0x16d)](_0x275a5e(0x17a)+currentMonitoredRoom+'\x20fÃ¼r\x20'+_0x5edf10+_0x275a5e(0x17b)),_0x3cf3be[_0x275a5e(0x179)](_0x275a5e(0x178),{'val':'ok','ack':!![]}),activeTimer=setTimeout(()=>triggerPreWarn(_0x3cf3be),timeoutMs);}function resetTimer(_0x20a1a6){const _0x3bb554=a2_0x533e39;if(activeTimer)clearTimeout(activeTimer);activeTimer=null,currentMonitoredRoom=null,alarmStage=0x0,_0x20a1a6[_0x3bb554(0x179)](_0x3bb554(0x178),{'val':'ok','ack':!![]});}async function triggerPreWarn(_0x526374){const _0x2b4e1e=a2_0x533e39;alarmStage=0x1,await _0x526374[_0x2b4e1e(0x179)]('analysis.safety.deadMan.alarmState',{'val':'pre_warn','ack':!![]});const _0x148b01=_0x2b4e1e(0x177)+currentMonitoredRoom+_0x2b4e1e(0x168);_0x526374[_0x2b4e1e(0x14e)][_0x2b4e1e(0x15c)](_0x2b4e1e(0x170)+_0x148b01),await setup['sendNotification'](_0x526374,_0x2b4e1e(0x15e)+_0x148b01),activeTimer=setTimeout(()=>triggerAlarm(_0x526374),0x5*0x3c*0x3e8);}async function triggerAlarm(_0x1721d5){const _0x2ed250=a2_0x533e39;alarmStage=0x2,await _0x1721d5[_0x2ed250(0x179)](_0x2ed250(0x178),{'val':_0x2ed250(0x171),'ack':!![]});const _0x4f91c8=_0x2ed250(0x158)+currentMonitoredRoom+'!';_0x1721d5[_0x2ed250(0x14e)][_0x2ed250(0x163)](_0x2ed250(0x170)+_0x4f91c8),await setup['sendNotification'](_0x1721d5,_0x4f91c8,![],!![]);}module[a2_0x533e39(0x174)]={'updateLocation':updateLocation};