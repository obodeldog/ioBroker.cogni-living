const a2_0x3b8495=a2_0x1a7b;(function(_0x3591ca,_0xcc6c11){const _0x983d8c=a2_0x1a7b,_0x477260=_0x3591ca();while(!![]){try{const _0x57c687=parseInt(_0x983d8c(0x11c))/0x1+-parseInt(_0x983d8c(0x13f))/0x2+parseInt(_0x983d8c(0x144))/0x3+parseInt(_0x983d8c(0x138))/0x4+parseInt(_0x983d8c(0x128))/0x5+parseInt(_0x983d8c(0x11b))/0x6+-parseInt(_0x983d8c(0x143))/0x7;if(_0x57c687===_0xcc6c11)break;else _0x477260['push'](_0x477260['shift']());}catch(_0x1c064d){_0x477260['push'](_0x477260['shift']());}}}(a2_0x4287,0xdd289));const a2_0x14c846=(function(){let _0x2f0959=!![];return function(_0x255105,_0x134fd3){const _0x442c55=_0x2f0959?function(){const _0x2016cd=a2_0x1a7b;if(_0x134fd3){const _0xdf2d00=_0x134fd3[_0x2016cd(0x145)](_0x255105,arguments);return _0x134fd3=null,_0xdf2d00;}}:function(){};return _0x2f0959=![],_0x442c55;};}()),a2_0x36690f=a2_0x14c846(this,function(){const _0x25879b=a2_0x1a7b;return a2_0x36690f['toString']()['search']('(((.+)+)+)+$')[_0x25879b(0x137)]()[_0x25879b(0x129)](a2_0x36690f)[_0x25879b(0x126)](_0x25879b(0x131));});a2_0x36690f();'use strict';const setup=require(a2_0x3b8495(0x13d));let activeTimer=null,currentMonitoredRoom=null,timeoutMs=0x0,startTime=0x0,alarmStage=0x0;const DEFAULT_TIMEOUTS={'bad':0x2d,'bath':0x2d,'toilet':0x1e,'wc':0x1e,'keller':0x3c,'schlaf':0x78,'bed':0x78,'guest':0x5a,'gast':0x5a};async function loadConfig(_0xf32d5d){const _0x555ef2=a2_0x3b8495;try{const _0x54fb7f=await _0xf32d5d['getStateAsync']('analysis.safety.deadMan.config');if(_0x54fb7f&&_0x54fb7f[_0x555ef2(0x139)])return JSON[_0x555ef2(0x119)](_0x54fb7f[_0x555ef2(0x139)]);}catch(_0x4c30ec){}return{};}function a2_0x1a7b(_0x5da7f0,_0x141b93){const _0x3484a5=a2_0x4287();return a2_0x1a7b=function(_0x36690f,_0x14c846){_0x36690f=_0x36690f-0x112;let _0x428709=_0x3484a5[_0x36690f];return _0x428709;},a2_0x1a7b(_0x5da7f0,_0x141b93);}async function isActive(_0x195a9e){const _0x14b965=a2_0x3b8495;try{const _0xfd5dbf=await _0x195a9e[_0x14b965(0x123)](_0x14b965(0x122));return _0xfd5dbf&&_0xfd5dbf[_0x14b965(0x139)];}catch(_0x34203e){return![];}}async function areRoomsConnected(_0x4f9fe9,_0x2301fa,_0x4ca22e){const _0x1f4774=a2_0x3b8495;try{const _0x4c9d39=await _0x4f9fe9[_0x1f4774(0x123)](_0x1f4774(0x132));if(!_0x4c9d39||!_0x4c9d39[_0x1f4774(0x139)])return!![];const _0x3bc883=JSON[_0x1f4774(0x119)](_0x4c9d39['val']),{rooms:_0x2aa340,matrix:_0x4f9f0c}=_0x3bc883;if(!_0x2aa340||!_0x4f9f0c)return!![];const _0x4e31bf=_0x2aa340[_0x1f4774(0x116)](_0x2301fa),_0x10e5c0=_0x2aa340[_0x1f4774(0x116)](_0x4ca22e);if(_0x4e31bf===-0x1||_0x10e5c0===-0x1)return!![];const _0x370571=_0x4f9f0c[_0x4e31bf][_0x10e5c0]>0x0||_0x4f9f0c[_0x10e5c0][_0x4e31bf]>0x0;return _0x370571;}catch(_0x7e36fa){return _0x4f9fe9['log'][_0x1f4774(0x11f)](_0x1f4774(0x13e)+_0x7e36fa[_0x1f4774(0x125)]),!![];}}function calculateSleepProbability(_0x545832){const _0x3b5055=a2_0x3b8495,_0x225a0d=new Date(),_0x4e4d29=_0x225a0d[_0x3b5055(0x142)](),_0x5cd35d=_0x545832['toLowerCase']();let _0x3dafb5=0.1;if(_0x4e4d29>=0x17||_0x4e4d29<=0x6)_0x3dafb5=0x1;else{if(_0x4e4d29>=0xd&&_0x4e4d29<=0xf)_0x3dafb5=0.8;else{if(_0x4e4d29>=0x14&&_0x4e4d29<=0x17)_0x3dafb5=0.4;}}let _0x5a5c8b=0.1;if(_0x5cd35d['includes']('schlaf')||_0x5cd35d[_0x3b5055(0x147)](_0x3b5055(0x140)))_0x5a5c8b=0x1;else{if(_0x5cd35d[_0x3b5055(0x147)]('wohn')||_0x5cd35d[_0x3b5055(0x147)](_0x3b5055(0x114))||_0x5cd35d['includes'](_0x3b5055(0x118)))_0x5a5c8b=0.6;else{if(_0x5cd35d[_0x3b5055(0x147)](_0x3b5055(0x12c))||_0x5cd35d['includes']('wc'))_0x5a5c8b=0.05;}}let _0x569723=0.5;const _0x241683=_0x5a5c8b*0.5+_0x3dafb5*0.3+_0x569723*0.2;return parseFloat(_0x241683['toFixed'](0x2));}async function updateLocation(_0x9ced70,_0x3f1458){const _0x4a0c1f=a2_0x3b8495;if(!_0x3f1458||_0x3f1458===_0x4a0c1f(0x13a))return;if(!await isActive(_0x9ced70)){resetTimer(_0x9ced70);return;}if(currentMonitoredRoom&&currentMonitoredRoom!==_0x3f1458){const _0x1a5035=await areRoomsConnected(_0x9ced70,currentMonitoredRoom,_0x3f1458);if(!_0x1a5035){const _0x318aba=_0x4a0c1f(0x112)+_0x3f1458+'\x27.\x20Nicht\x20verbunden\x20mit\x20√ºberwachtem\x20\x27'+currentMonitoredRoom+'\x27.';_0x9ced70[_0x4a0c1f(0x146)][_0x4a0c1f(0x135)]('[DeadMan]\x20'+_0x318aba+_0x4a0c1f(0x136)),await _0x9ced70[_0x4a0c1f(0x12f)]('analysis.safety.deadMan.lastIgnored',{'val':JSON['stringify']({'room':_0x3f1458,'reason':_0x318aba,'timestamp':Date[_0x4a0c1f(0x120)]()}),'ack':!![]});return;}resetTimer(_0x9ced70);}if(!currentMonitoredRoom){await _0x9ced70[_0x4a0c1f(0x12f)](_0x4a0c1f(0x12a),{'val':_0x3f1458,'ack':!![]});const _0x260042=await loadConfig(_0x9ced70),_0x23245f=_0x3f1458[_0x4a0c1f(0x134)]();let _0x438b9b=_0x260042[_0x3f1458]||_0x260042[_0x23245f];if(!_0x438b9b)for(const _0x2d6576 in DEFAULT_TIMEOUTS){if(_0x23245f[_0x4a0c1f(0x147)](_0x2d6576)){_0x438b9b=DEFAULT_TIMEOUTS[_0x2d6576];break;}}if(!_0x438b9b&&_0x260042[_0x4a0c1f(0x113)])_0x438b9b=_0x260042['default'];if(!_0x438b9b)return;currentMonitoredRoom=_0x3f1458,startTimer(_0x9ced70,_0x438b9b,_0x3f1458);}}function startTimer(_0x55271c,_0x3dacb9,_0xf3eb25){const _0xe6a084=a2_0x3b8495;if(activeTimer)clearTimeout(activeTimer);timeoutMs=_0x3dacb9*0x3c*0x3e8,startTime=Date[_0xe6a084(0x120)](),alarmStage=0x0;const _0x8df36f=calculateSleepProbability(_0xf3eb25||currentMonitoredRoom),_0xccd57f=_0x8df36f>0.65;_0xccd57f?(timeoutMs+=0x5a*0x3c*0x3e8,_0x55271c[_0xe6a084(0x146)][_0xe6a084(0x135)]('üí§\x20Smart\x20Sleep\x20erkannt\x20('+(_0x8df36f*0x64)[_0xe6a084(0x11d)](0x0)+_0xe6a084(0x13c)+currentMonitoredRoom+_0xe6a084(0x12d)),_0x55271c[_0xe6a084(0x12f)](_0xe6a084(0x12e),{'val':!![],'ack':!![]})):_0x55271c[_0xe6a084(0x12f)](_0xe6a084(0x12e),{'val':![],'ack':!![]}),_0x55271c[_0xe6a084(0x12f)](_0xe6a084(0x124),{'val':_0x8df36f,'ack':!![]}),_0x55271c[_0xe6a084(0x146)][_0xe6a084(0x135)](_0xe6a084(0x141)+currentMonitoredRoom+_0xe6a084(0x115)+_0x3dacb9+'\x20Min.'),_0x55271c[_0xe6a084(0x12f)](_0xe6a084(0x11e),{'val':'ok','ack':!![]}),activeTimer=setTimeout(()=>triggerPreWarn(_0x55271c),timeoutMs);}function resetTimer(_0xdb87a0){const _0x4d19c2=a2_0x3b8495;if(activeTimer)clearTimeout(activeTimer);activeTimer=null,currentMonitoredRoom=null,alarmStage=0x0,_0xdb87a0[_0x4d19c2(0x12f)](_0x4d19c2(0x11e),{'val':'ok','ack':!![]}),_0xdb87a0[_0x4d19c2(0x12f)](_0x4d19c2(0x12e),{'val':![],'ack':!![]}),_0xdb87a0[_0x4d19c2(0x12f)](_0x4d19c2(0x124),{'val':0x0,'ack':!![]});}async function triggerPreWarn(_0x35cb64){const _0x4e2586=a2_0x3b8495;alarmStage=0x1,await _0x35cb64[_0x4e2586(0x12f)](_0x4e2586(0x11e),{'val':'pre_warn','ack':!![]});const _0x14e368=_0x4e2586(0x12b)+currentMonitoredRoom+'.\x20Alles\x20in\x20Ordnung?';_0x35cb64[_0x4e2586(0x146)][_0x4e2586(0x11f)](_0x4e2586(0x133)+_0x14e368),await setup[_0x4e2586(0x11a)](_0x35cb64,_0x4e2586(0x130)+_0x14e368),activeTimer=setTimeout(()=>triggerAlarm(_0x35cb64),0x5*0x3c*0x3e8);}function a2_0x4287(){const _0x439e79=['error','sofa','parse','sendNotification','10377480npiCjJ','633727hzialT','toFixed','analysis.safety.deadMan.alarmState','warn','now','üö®\x20NOTFALL-ALARM:\x20Person\x20reagiert\x20nicht\x20in\x20','analysis.safety.deadMan.active','getStateAsync','analysis.safety.deadMan.napProbability','message','search','alarm','4736620JBhUdf','constructor','analysis.safety.deadMan.currentRoom','‚è≥\x20ACHTUNG:\x20Ungew√∂hnlich\x20lange\x20Inaktivit√§t\x20in\x20','bad','\x20um\x2090\x20Min.','analysis.safety.deadMan.smartSleep','setStateAsync','üëº\x20Schutzengel-Frage:\x20','(((.+)+)+)+$','analysis.topology.structure','[DeadMan]\x20','toLowerCase','info','\x20(Multi-Person\x20Filter)','toString','1700072kASChl','val','Unknown','exports','%).\x20Verl√§ngere\x20Timer\x20f√ºr\x20','./setup','[DeadMan]\x20Topology\x20check\x20failed:\x20','223116awyalE','bed','üëº\x20Schutzengel:\x20√úberwache\x20','getHours','20091764DSGEwQ','456078gVfgbD','apply','log','includes','Ignoriere\x20Bewegung\x20in\x20\x27','default','living','\x20f√ºr\x20','indexOf'];a2_0x4287=function(){return _0x439e79;};return a2_0x4287();}async function triggerAlarm(_0x48a1a4){const _0xf312e=a2_0x3b8495;alarmStage=0x2,await _0x48a1a4[_0xf312e(0x12f)](_0xf312e(0x11e),{'val':_0xf312e(0x127),'ack':!![]});const _0x2beec1=_0xf312e(0x121)+currentMonitoredRoom+'!';_0x48a1a4[_0xf312e(0x146)][_0xf312e(0x117)]('[DeadMan]\x20'+_0x2beec1),await setup[_0xf312e(0x11a)](_0x48a1a4,_0x2beec1,![],!![]);}module[a2_0x3b8495(0x13b)]={'updateLocation':updateLocation};