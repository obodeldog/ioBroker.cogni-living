const a2_0x44fa3f=a2_0x1b29;(function(_0x3bab39,_0x223eef){const _0x503da1=a2_0x1b29,_0x29a2e9=_0x3bab39();while(!![]){try{const _0x157fad=-parseInt(_0x503da1(0xc4))/0x1+-parseInt(_0x503da1(0xcd))/0x2*(-parseInt(_0x503da1(0xcb))/0x3)+-parseInt(_0x503da1(0xe6))/0x4+parseInt(_0x503da1(0xe4))/0x5*(-parseInt(_0x503da1(0xe5))/0x6)+parseInt(_0x503da1(0xcc))/0x7+parseInt(_0x503da1(0xe0))/0x8+parseInt(_0x503da1(0xc7))/0x9*(-parseInt(_0x503da1(0xe3))/0xa);if(_0x157fad===_0x223eef)break;else _0x29a2e9['push'](_0x29a2e9['shift']());}catch(_0x5a638c){_0x29a2e9['push'](_0x29a2e9['shift']());}}}(a2_0x54f2,0x9c415));const a2_0x1ff41b=(function(){let _0xa638c8=!![];return function(_0x50fe2a,_0x369754){const _0x13440b=_0xa638c8?function(){const _0x2dcbcb=a2_0x1b29;if(_0x369754){const _0x1cdf43=_0x369754[_0x2dcbcb(0xe1)](_0x50fe2a,arguments);return _0x369754=null,_0x1cdf43;}}:function(){};return _0xa638c8=![],_0x13440b;};}()),a2_0x1dec84=a2_0x1ff41b(this,function(){const _0x15d84b=a2_0x1b29;return a2_0x1dec84['toString']()[_0x15d84b(0xef)](_0x15d84b(0xdc))[_0x15d84b(0xc8)]()[_0x15d84b(0xdf)](a2_0x1dec84)['search']('(((.+)+)+)+$');});a2_0x1dec84();'use strict';const setup=require(a2_0x44fa3f(0xe7));let activeTimer=null,currentMonitoredRoom=null,timeoutMs=0x0,startTime=0x0,alarmStage=0x0;const DEFAULT_TIMEOUTS={'bad':0x2d,'bath':0x2d,'toilet':0x1e,'wc':0x1e,'keller':0x3c};function a2_0x1b29(_0x8b9568,_0x22f2a6){const _0x31437a=a2_0x54f2();return a2_0x1b29=function(_0x1dec84,_0x1ff41b){_0x1dec84=_0x1dec84-0xc0;let _0x54f24b=_0x31437a[_0x1dec84];return _0x54f24b;},a2_0x1b29(_0x8b9568,_0x22f2a6);}async function loadConfig(_0x188d73){const _0x3c6153=a2_0x44fa3f;try{const _0x48da45=await _0x188d73[_0x3c6153(0xce)](_0x3c6153(0xc5));if(_0x48da45&&_0x48da45[_0x3c6153(0xd2)])return JSON[_0x3c6153(0xea)](_0x48da45['val']);}catch(_0x3e3371){}return{};}async function isActive(_0x9d673e){const _0x2e210c=a2_0x44fa3f;try{const _0x1644a1=await _0x9d673e[_0x2e210c(0xce)](_0x2e210c(0xcf));return _0x1644a1&&_0x1644a1[_0x2e210c(0xd2)];}catch(_0x3f225e){return![];}}async function areRoomsConnected(_0x260fef,_0x512775,_0x1b6cc3){const _0x3fca02=a2_0x44fa3f;try{const _0x15d9b9=await _0x260fef[_0x3fca02(0xce)](_0x3fca02(0xc0));if(!_0x15d9b9||!_0x15d9b9['val'])return!![];const _0x45d16b=JSON[_0x3fca02(0xea)](_0x15d9b9[_0x3fca02(0xd2)]),{rooms:_0x5b6bc1,matrix:_0x3ed18f}=_0x45d16b;if(!_0x5b6bc1||!_0x3ed18f)return!![];const _0x19dc5e=_0x5b6bc1[_0x3fca02(0xee)](_0x512775),_0x2fd29b=_0x5b6bc1[_0x3fca02(0xee)](_0x1b6cc3);if(_0x19dc5e===-0x1||_0x2fd29b===-0x1)return!![];const _0x1135b5=_0x3ed18f[_0x19dc5e][_0x2fd29b]>0x0||_0x3ed18f[_0x2fd29b][_0x19dc5e]>0x0;return _0x1135b5;}catch(_0x339ef1){return _0x260fef[_0x3fca02(0xdd)][_0x3fca02(0xd8)](_0x3fca02(0xd7)+_0x339ef1[_0x3fca02(0xc6)]),!![];}}async function updateLocation(_0x251741,_0x157ab2){const _0x5626b4=a2_0x44fa3f;if(!_0x157ab2||_0x157ab2==='Unknown')return;if(!await isActive(_0x251741)){resetTimer(_0x251741);return;}if(currentMonitoredRoom&&currentMonitoredRoom!==_0x157ab2){const _0x162882=await areRoomsConnected(_0x251741,currentMonitoredRoom,_0x157ab2);if(!_0x162882){const _0x33a75c=_0x5626b4(0xd1)+_0x157ab2+_0x5626b4(0xc1)+currentMonitoredRoom+'\x27.';_0x251741[_0x5626b4(0xdd)][_0x5626b4(0xca)]('[DeadMan]\x20'+_0x33a75c+_0x5626b4(0xd0)),await _0x251741[_0x5626b4(0xd6)]('analysis.safety.deadMan.lastIgnored',{'val':JSON[_0x5626b4(0xe2)]({'room':_0x157ab2,'reason':_0x33a75c,'timestamp':Date[_0x5626b4(0xe9)]()}),'ack':!![]});return;}resetTimer(_0x251741);}if(!currentMonitoredRoom){await _0x251741['setStateAsync'](_0x5626b4(0xc3),{'val':_0x157ab2,'ack':!![]});const _0x656901=await loadConfig(_0x251741),_0x147790=_0x157ab2[_0x5626b4(0xed)]();let _0x9fe03d=_0x656901[_0x157ab2]||_0x656901[_0x147790];if(!_0x9fe03d)for(const _0x34eaf4 in DEFAULT_TIMEOUTS){if(_0x147790[_0x5626b4(0xde)](_0x34eaf4)){_0x9fe03d=DEFAULT_TIMEOUTS[_0x34eaf4];break;}}if(!_0x9fe03d&&_0x656901[_0x5626b4(0xdb)])_0x9fe03d=_0x656901[_0x5626b4(0xdb)];if(!_0x9fe03d)return;currentMonitoredRoom=_0x157ab2,startTimer(_0x251741,_0x9fe03d);}}function startTimer(_0x2f5d3d,_0x45d845){const _0x3d8b21=a2_0x44fa3f;if(activeTimer)clearTimeout(activeTimer);timeoutMs=_0x45d845*0x3c*0x3e8,startTime=Date[_0x3d8b21(0xe9)](),alarmStage=0x0,_0x2f5d3d['log']['info'](_0x3d8b21(0xd5)+currentMonitoredRoom+_0x3d8b21(0xec)+_0x45d845+_0x3d8b21(0xd4)),_0x2f5d3d[_0x3d8b21(0xd6)]('analysis.safety.deadMan.alarmState',{'val':'ok','ack':!![]}),activeTimer=setTimeout(()=>triggerPreWarn(_0x2f5d3d),timeoutMs);}function resetTimer(_0xd9761b){const _0x56431b=a2_0x44fa3f;if(activeTimer)clearTimeout(activeTimer);activeTimer=null,currentMonitoredRoom=null,alarmStage=0x0,_0xd9761b['setStateAsync'](_0x56431b(0xc2),{'val':'ok','ack':!![]});}async function triggerPreWarn(_0x4a9491){const _0x2ed78c=a2_0x44fa3f;alarmStage=0x1,await _0x4a9491[_0x2ed78c(0xd6)](_0x2ed78c(0xc2),{'val':_0x2ed78c(0xd9),'ack':!![]});const _0x52c8e7='â³\x20ACHTUNG:\x20UngewÃ¶hnlich\x20lange\x20InaktivitÃ¤t\x20in\x20'+currentMonitoredRoom+_0x2ed78c(0xe8);_0x4a9491['log'][_0x2ed78c(0xd8)](_0x2ed78c(0xd3)+_0x52c8e7),await setup[_0x2ed78c(0xda)](_0x4a9491,_0x2ed78c(0xc9)+_0x52c8e7),activeTimer=setTimeout(()=>triggerAlarm(_0x4a9491),0x5*0x3c*0x3e8);}async function triggerAlarm(_0x4874d0){const _0x5e90b3=a2_0x44fa3f;alarmStage=0x2,await _0x4874d0['setStateAsync'](_0x5e90b3(0xc2),{'val':'alarm','ack':!![]});const _0x3f261d='ðŸš¨\x20NOTFALL-ALARM:\x20Person\x20reagiert\x20nicht\x20in\x20'+currentMonitoredRoom+'!';_0x4874d0[_0x5e90b3(0xdd)][_0x5e90b3(0xeb)](_0x5e90b3(0xd3)+_0x3f261d),await setup[_0x5e90b3(0xda)](_0x4874d0,_0x3f261d,![],!![]);}function a2_0x54f2(){const _0x501b3f=['\x20Min.','ðŸ‘¼\x20Schutzengel:\x20Ãœberwache\x20','setStateAsync','[DeadMan]\x20Topology\x20check\x20failed:\x20','warn','pre_warn','sendNotification','default','(((.+)+)+)+$','log','includes','constructor','9065136lGxJVn','apply','stringify','10oOslPd','45ofsdto','791622Kvltln','611604blMMyT','./setup','.\x20Alles\x20in\x20Ordnung?','now','parse','error','\x20fÃ¼r\x20','toLowerCase','indexOf','search','analysis.topology.structure','\x27.\x20Nicht\x20verbunden\x20mit\x20Ã¼berwachtem\x20\x27','analysis.safety.deadMan.alarmState','analysis.safety.deadMan.currentRoom','310246Icsiqv','analysis.safety.deadMan.config','message','2844360fUVRZj','toString','ðŸ‘¼\x20Schutzengel-Frage:\x20','info','369189wvAzMb','8591611zFqFnO','4DfpXNW','getStateAsync','analysis.safety.deadMan.active','\x20(Multi-Person\x20Filter)','Ignoriere\x20Bewegung\x20in\x20\x27','val','[DeadMan]\x20'];a2_0x54f2=function(){return _0x501b3f;};return a2_0x54f2();}module['exports']={'updateLocation':updateLocation};