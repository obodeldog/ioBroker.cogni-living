const a2_0x3ac8c4=a2_0x270e;(function(_0x39d4e9,_0x3a5643){const _0xda4359=a2_0x270e,_0x3f487b=_0x39d4e9();while(!![]){try{const _0x1d90ba=-parseInt(_0xda4359(0x17b))/0x1+-parseInt(_0xda4359(0x17e))/0x2*(parseInt(_0xda4359(0x162))/0x3)+-parseInt(_0xda4359(0x16d))/0x4*(-parseInt(_0xda4359(0x153))/0x5)+parseInt(_0xda4359(0x167))/0x6+parseInt(_0xda4359(0x180))/0x7*(parseInt(_0xda4359(0x17c))/0x8)+-parseInt(_0xda4359(0x182))/0x9+parseInt(_0xda4359(0x184))/0xa;if(_0x1d90ba===_0x3a5643)break;else _0x3f487b['push'](_0x3f487b['shift']());}catch(_0x319a61){_0x3f487b['push'](_0x3f487b['shift']());}}}(a2_0x616f,0xb7808));const a2_0x305926=(function(){let _0x49bfb2=!![];return function(_0x105a3a,_0x36043f){const _0x222083=_0x49bfb2?function(){const _0xf51efd=a2_0x270e;if(_0x36043f){const _0x876418=_0x36043f[_0xf51efd(0x17d)](_0x105a3a,arguments);return _0x36043f=null,_0x876418;}}:function(){};return _0x49bfb2=![],_0x222083;};}()),a2_0x3fbb82=a2_0x305926(this,function(){const _0x6c5352=a2_0x270e;return a2_0x3fbb82['toString']()[_0x6c5352(0x17a)](_0x6c5352(0x178))[_0x6c5352(0x177)]()['constructor'](a2_0x3fbb82)[_0x6c5352(0x17a)]('(((.+)+)+)+$');});a2_0x3fbb82();'use strict';const setup=require('./setup');function a2_0x616f(){const _0x595e8d=['3lqFomK','ðŸš¨\x20NOTFALL-ALARM:\x20Person\x20reagiert\x20nicht\x20in\x20','setStateAsync','analysis.safety.deadMan.currentRoom','\x20(Multi-Person\x20Filter)','1652994JgwwcZ','replace','val','sendNotification','analysis.safety.deadMan.alarmState','error','117004oBhjvq','analysis.safety.deadMan.smartSleep','exports','living','%).\x20VerlÃ¤ngere\x20Timer\x20fÃ¼r\x20','\x27.\x20Nicht\x20verbunden\x20mit\x20Ã¼berwachtem\x20\x27','parse','info','[DeadMan]\x20','Unknown','toString','(((.+)+)+)+$','bed','search','1323438LsXuuS','1384pgjVeD','apply','931954faiVvM','alarm','8092WAWbLP','ðŸ’¤\x20Smart\x20Sleep\x20erkannt\x20(','13427352FhhHpt','analysis.safety.deadMan.active','22119340IldfYW','getStateAsync','log','.\x20Alles\x20in\x20Ordnung?','Ignoriere\x20Bewegung\x20in\x20\x27','now','getHours','bad','toFixed','230fAitIF','toLowerCase','warn','wohn','includes','default','indexOf','\x20um\x2090\x20Min.','\x20Min.','ðŸ‘¼\x20Schutzengel-Frage:\x20','sofa','pre_warn','ðŸ‘¼\x20Schutzengel:\x20Ãœberwache\x20','schlaf','analysis.safety.deadMan.napProbability'];a2_0x616f=function(){return _0x595e8d;};return a2_0x616f();}function a2_0x270e(_0x49bfee,_0x5bf600){const _0x105ffa=a2_0x616f();return a2_0x270e=function(_0x3fbb82,_0x305926){_0x3fbb82=_0x3fbb82-0x14e;let _0x616f24=_0x105ffa[_0x3fbb82];return _0x616f24;},a2_0x270e(_0x49bfee,_0x5bf600);}let activeTimer=null,currentMonitoredRoom=null,timeoutMs=0x0,startTime=0x0,alarmStage=0x0;const DEFAULT_TIMEOUTS={'bad':0x2d,'bath':0x2d,'toilet':0x1e,'wc':0x1e,'keller':0x3c,'schlaf':0x78,'bed':0x78,'guest':0x5a,'gast':0x5a};function getTimeoutRobust(_0x116d78,_0x296d7c){const _0x3da9cb=a2_0x270e;if(!_0x116d78||!_0x296d7c)return undefined;if(_0x116d78[_0x296d7c])return _0x116d78[_0x296d7c];const _0x3f5675=_0x296d7c[_0x3da9cb(0x154)]()['replace'](/[^a-z0-9]/g,'');for(const _0x257151 in _0x116d78){const _0x7c16fc=_0x257151[_0x3da9cb(0x154)]()[_0x3da9cb(0x168)](/[^a-z0-9]/g,'');if(_0x7c16fc===_0x3f5675)return _0x116d78[_0x257151];}const _0x46b07c=_0x296d7c[_0x3da9cb(0x154)]();if(_0x116d78[_0x46b07c])return _0x116d78[_0x46b07c];return undefined;}async function loadConfig(_0xd195){const _0x193331=a2_0x270e;try{const _0x1ac319=await _0xd195[_0x193331(0x185)]('analysis.safety.deadMan.config');if(_0x1ac319&&_0x1ac319[_0x193331(0x169)])return JSON[_0x193331(0x173)](_0x1ac319[_0x193331(0x169)]);}catch(_0x5a9022){}return{};}async function isActive(_0x382f35){const _0x193b55=a2_0x270e;try{const _0x13db20=await _0x382f35[_0x193b55(0x185)](_0x193b55(0x183));return _0x13db20&&_0x13db20[_0x193b55(0x169)];}catch(_0x105ddd){return![];}}async function areRoomsConnected(_0x4e178f,_0x21f529,_0x3b11aa){const _0x584fca=a2_0x270e;try{const _0x593962=await _0x4e178f['getStateAsync']('analysis.topology.structure');if(!_0x593962||!_0x593962[_0x584fca(0x169)])return!![];const _0x468db4=JSON[_0x584fca(0x173)](_0x593962[_0x584fca(0x169)]),{rooms:_0x3b2601,matrix:_0x1d22bf}=_0x468db4;if(!_0x3b2601||!_0x1d22bf)return!![];const _0x29137f=_0x3b2601[_0x584fca(0x159)](_0x21f529),_0x3e9353=_0x3b2601[_0x584fca(0x159)](_0x3b11aa);if(_0x29137f===-0x1||_0x3e9353===-0x1)return!![];const _0x453892=_0x1d22bf[_0x29137f][_0x3e9353]>0x0||_0x1d22bf[_0x3e9353][_0x29137f]>0x0;return _0x453892;}catch(_0x23bf82){return _0x4e178f['log'][_0x584fca(0x155)]('[DeadMan]\x20Topology\x20check\x20failed:\x20'+_0x23bf82['message']),!![];}}function calculateSleepProbability(_0x238b56){const _0x1b7f3a=a2_0x270e,_0x570e47=new Date(),_0x2647e3=_0x570e47[_0x1b7f3a(0x150)](),_0x263db5=_0x238b56[_0x1b7f3a(0x154)]();let _0x50ae17=0.1;if(_0x2647e3>=0x17||_0x2647e3<=0x6)_0x50ae17=0x1;else{if(_0x2647e3>=0xd&&_0x2647e3<=0xf)_0x50ae17=0.8;else{if(_0x2647e3>=0x14&&_0x2647e3<=0x17)_0x50ae17=0.4;}}let _0x1501aa=0.1;if(_0x263db5[_0x1b7f3a(0x157)](_0x1b7f3a(0x160))||_0x263db5[_0x1b7f3a(0x157)](_0x1b7f3a(0x179)))_0x1501aa=0x1;else{if(_0x263db5['includes'](_0x1b7f3a(0x156))||_0x263db5[_0x1b7f3a(0x157)](_0x1b7f3a(0x170))||_0x263db5[_0x1b7f3a(0x157)](_0x1b7f3a(0x15d)))_0x1501aa=0.6;else{if(_0x263db5[_0x1b7f3a(0x157)](_0x1b7f3a(0x151))||_0x263db5[_0x1b7f3a(0x157)]('wc'))_0x1501aa=0.05;}}let _0x2f2459=0.5;const _0xd3ed90=_0x1501aa*0.5+_0x50ae17*0.3+_0x2f2459*0.2;return parseFloat(_0xd3ed90[_0x1b7f3a(0x152)](0x2));}async function updateLocation(_0x34def4,_0x4377c1){const _0x2bf121=a2_0x270e;if(!_0x4377c1||_0x4377c1===_0x2bf121(0x176))return;if(!await isActive(_0x34def4)){resetTimer(_0x34def4);return;}if(currentMonitoredRoom&&currentMonitoredRoom!==_0x4377c1){const _0x5df930=await areRoomsConnected(_0x34def4,currentMonitoredRoom,_0x4377c1);if(!_0x5df930){const _0x3f229d=_0x2bf121(0x14e)+_0x4377c1+_0x2bf121(0x172)+currentMonitoredRoom+'\x27.';_0x34def4[_0x2bf121(0x186)][_0x2bf121(0x174)](_0x2bf121(0x175)+_0x3f229d+_0x2bf121(0x166)),await _0x34def4['setStateAsync']('analysis.safety.deadMan.lastIgnored',{'val':JSON['stringify']({'room':_0x4377c1,'reason':_0x3f229d,'timestamp':Date[_0x2bf121(0x14f)]()}),'ack':!![]});return;}resetTimer(_0x34def4);}if(!currentMonitoredRoom){await _0x34def4[_0x2bf121(0x164)](_0x2bf121(0x165),{'val':_0x4377c1,'ack':!![]});const _0x9a6fca=await loadConfig(_0x34def4);let _0x11b405=getTimeoutRobust(_0x9a6fca,_0x4377c1);const _0x3f2a5c=_0x4377c1['toLowerCase']();if(!_0x11b405)for(const _0x28cd55 in DEFAULT_TIMEOUTS){if(_0x3f2a5c[_0x2bf121(0x157)](_0x28cd55)){_0x11b405=DEFAULT_TIMEOUTS[_0x28cd55];break;}}if(!_0x11b405&&_0x9a6fca[_0x2bf121(0x158)])_0x11b405=_0x9a6fca[_0x2bf121(0x158)];if(!_0x11b405)return;currentMonitoredRoom=_0x4377c1,startTimer(_0x34def4,_0x11b405,_0x4377c1);}}function startTimer(_0x159d12,_0xe8e835,_0x178147){const _0x303e6=a2_0x270e;if(activeTimer)clearTimeout(activeTimer);timeoutMs=_0xe8e835*0x3c*0x3e8,startTime=Date[_0x303e6(0x14f)](),alarmStage=0x0;const _0xa09c68=calculateSleepProbability(_0x178147||currentMonitoredRoom),_0x409edf=_0xa09c68>0.65;_0x409edf?(timeoutMs+=0x5a*0x3c*0x3e8,_0x159d12['log'][_0x303e6(0x174)](_0x303e6(0x181)+(_0xa09c68*0x64)[_0x303e6(0x152)](0x0)+_0x303e6(0x171)+currentMonitoredRoom+_0x303e6(0x15a)),_0x159d12[_0x303e6(0x164)](_0x303e6(0x16e),{'val':!![],'ack':!![]})):_0x159d12[_0x303e6(0x164)]('analysis.safety.deadMan.smartSleep',{'val':![],'ack':!![]}),_0x159d12[_0x303e6(0x164)]('analysis.safety.deadMan.napProbability',{'val':_0xa09c68,'ack':!![]}),_0x159d12[_0x303e6(0x186)]['info'](_0x303e6(0x15f)+currentMonitoredRoom+'\x20fÃ¼r\x20'+_0xe8e835+_0x303e6(0x15b)),_0x159d12[_0x303e6(0x164)](_0x303e6(0x16b),{'val':'ok','ack':!![]}),activeTimer=setTimeout(()=>triggerPreWarn(_0x159d12),timeoutMs);}function resetTimer(_0x1cd471){const _0x1dccfe=a2_0x270e;if(activeTimer)clearTimeout(activeTimer);activeTimer=null,currentMonitoredRoom=null,alarmStage=0x0,_0x1cd471[_0x1dccfe(0x164)]('analysis.safety.deadMan.alarmState',{'val':'ok','ack':!![]}),_0x1cd471[_0x1dccfe(0x164)](_0x1dccfe(0x16e),{'val':![],'ack':!![]}),_0x1cd471[_0x1dccfe(0x164)](_0x1dccfe(0x161),{'val':0x0,'ack':!![]});}async function triggerPreWarn(_0x3a0264){const _0x221e48=a2_0x270e;alarmStage=0x1,await _0x3a0264['setStateAsync'](_0x221e48(0x16b),{'val':_0x221e48(0x15e),'ack':!![]});const _0x20332e='â³\x20ACHTUNG:\x20UngewÃ¶hnlich\x20lange\x20InaktivitÃ¤t\x20in\x20'+currentMonitoredRoom+_0x221e48(0x187);_0x3a0264[_0x221e48(0x186)][_0x221e48(0x155)](_0x221e48(0x175)+_0x20332e),await setup['sendNotification'](_0x3a0264,_0x221e48(0x15c)+_0x20332e),activeTimer=setTimeout(()=>triggerAlarm(_0x3a0264),0x5*0x3c*0x3e8);}async function triggerAlarm(_0x2b9e9f){const _0x51696f=a2_0x270e;alarmStage=0x2,await _0x2b9e9f[_0x51696f(0x164)](_0x51696f(0x16b),{'val':_0x51696f(0x17f),'ack':!![]});const _0x3c2b34=_0x51696f(0x163)+currentMonitoredRoom+'!';_0x2b9e9f[_0x51696f(0x186)][_0x51696f(0x16c)](_0x51696f(0x175)+_0x3c2b34),await setup[_0x51696f(0x16a)](_0x2b9e9f,_0x3c2b34,![],!![]);}module[a2_0x3ac8c4(0x16f)]={'updateLocation':updateLocation};