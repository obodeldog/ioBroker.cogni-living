const a2_0x340a43=a2_0x3cee;(function(_0x3cd604,_0xc2f3f0){const _0x1fd40e=a2_0x3cee,_0x5c6a97=_0x3cd604();while(!![]){try{const _0x24852f=-parseInt(_0x1fd40e(0xcc))/0x1*(parseInt(_0x1fd40e(0xaa))/0x2)+-parseInt(_0x1fd40e(0xbe))/0x3+parseInt(_0x1fd40e(0xa0))/0x4*(-parseInt(_0x1fd40e(0xcb))/0x5)+-parseInt(_0x1fd40e(0xba))/0x6*(-parseInt(_0x1fd40e(0xb0))/0x7)+-parseInt(_0x1fd40e(0xbc))/0x8*(-parseInt(_0x1fd40e(0x9f))/0x9)+parseInt(_0x1fd40e(0xd1))/0xa*(-parseInt(_0x1fd40e(0xda))/0xb)+parseInt(_0x1fd40e(0xd8))/0xc*(parseInt(_0x1fd40e(0xa2))/0xd);if(_0x24852f===_0xc2f3f0)break;else _0x5c6a97['push'](_0x5c6a97['shift']());}catch(_0x4be93c){_0x5c6a97['push'](_0x5c6a97['shift']());}}}(a2_0x1e27,0xe68c0));const a2_0x3be384=(function(){let _0x35c6cf=!![];return function(_0xbefbb,_0x4e39b2){const _0x2fa719=_0x35c6cf?function(){if(_0x4e39b2){const _0x5d9490=_0x4e39b2['apply'](_0xbefbb,arguments);return _0x4e39b2=null,_0x5d9490;}}:function(){};return _0x35c6cf=![],_0x2fa719;};}()),a2_0x4cfa93=a2_0x3be384(this,function(){const _0x213465=a2_0x3cee;return a2_0x4cfa93[_0x213465(0xc2)]()[_0x213465(0xb2)](_0x213465(0xb7))['toString']()[_0x213465(0x9d)](a2_0x4cfa93)[_0x213465(0xb2)](_0x213465(0xb7));});function a2_0x1e27(){const _0x6026e4=['ðŸ’¤\x20Smart\x20Sleep\x20erkannt\x20(','analysis.safety.deadMan.napProbability','[DeadMan]\x20','(((.+)+)+)+$','wohn','Ignoriere\x20Bewegung\x20in\x20\x27','28116PjmIbL','\x27.\x20Nicht\x20verbunden\x20mit\x20Ã¼berwachtem\x20\x27','4262888hAUWeu','getHours','4090308vTRpkc','Unknown','living','analysis.safety.deadMan.lastIgnored','toString','[DeadMan]\x20Topology\x20check\x20failed:\x20','exports','replace','ðŸ‘¼\x20Schutzengel:\x20Ãœberwache\x20','bad','ðŸ‘¼\x20Schutzengel-Frage:\x20','.\x20Alles\x20in\x20Ordnung?','setStateAsync','2405YwGepI','2922awubIL','analysis.safety.deadMan.config','log','stringify','analysis.safety.deadMan.alarmState','10uLSrtZ','\x20(Multi-Person\x20Filter)','info','toLowerCase','ðŸš¨\x20NOTFALL-ALARM:\x20Person\x20reagiert\x20nicht\x20in\x20','pre_warn','getStateAsync','20040LqvMVD','message','16448234njzOWs','sendNotification','\x20fÃ¼r\x20','constructor','sofa','27uZrtaB','11868vMIShM','includes','33917YgEHUY','\x20Min.','%).\x20VerlÃ¤ngere\x20Timer\x20fÃ¼r\x20','parse','â³\x20ACHTUNG:\x20UngewÃ¶hnlich\x20lange\x20InaktivitÃ¤t\x20in\x20','warn','analysis.topology.structure','analysis.safety.deadMan.smartSleep','612OcBtiH','error','alarm','val','toFixed','indexOf','252zPzcEC','bed','search','\x20um\x2090\x20Min.'];a2_0x1e27=function(){return _0x6026e4;};return a2_0x1e27();}a2_0x4cfa93();'use strict';function a2_0x3cee(_0x298d57,_0x24115c){const _0x3c482c=a2_0x1e27();return a2_0x3cee=function(_0x4cfa93,_0x3be384){_0x4cfa93=_0x4cfa93-0x9c;let _0x1e2726=_0x3c482c[_0x4cfa93];return _0x1e2726;},a2_0x3cee(_0x298d57,_0x24115c);}const setup=require('./setup');let activeTimer=null,currentMonitoredRoom=null,timeoutMs=0x0,startTime=0x0,alarmStage=0x0;const DEFAULT_TIMEOUTS={'bad':0x2d,'bath':0x2d,'toilet':0x1e,'wc':0x1e,'keller':0x3c,'schlaf':0x78,'bed':0x78,'guest':0x5a,'gast':0x5a};function getTimeoutRobust(_0x54cfc0,_0x4f8978){const _0x69eb1d=a2_0x3cee;if(!_0x54cfc0||!_0x4f8978)return undefined;if(_0x54cfc0[_0x4f8978])return _0x54cfc0[_0x4f8978];const _0x3f69ba=_0x4f8978[_0x69eb1d(0xd4)]()[_0x69eb1d(0xc5)](/[^a-z0-9]/g,'');for(const _0x557a61 in _0x54cfc0){const _0x1a03cc=_0x557a61[_0x69eb1d(0xd4)]()[_0x69eb1d(0xc5)](/[^a-z0-9]/g,'');if(_0x1a03cc===_0x3f69ba)return _0x54cfc0[_0x557a61];}const _0x3e9f13=_0x4f8978[_0x69eb1d(0xd4)]();if(_0x54cfc0[_0x3e9f13])return _0x54cfc0[_0x3e9f13];return undefined;}async function loadConfig(_0x2b6520){const _0xf2d0ea=a2_0x3cee;try{const _0x2f4813=await _0x2b6520[_0xf2d0ea(0xd7)](_0xf2d0ea(0xcd));if(_0x2f4813&&_0x2f4813[_0xf2d0ea(0xad)])return JSON['parse'](_0x2f4813[_0xf2d0ea(0xad)]);}catch(_0x2894c9){}return{};}async function isActive(_0x28e400){const _0x11b4fc=a2_0x3cee;try{const _0x432dde=await _0x28e400[_0x11b4fc(0xd7)]('analysis.safety.deadMan.active');return _0x432dde&&_0x432dde['val'];}catch(_0x168745){return![];}}async function areRoomsConnected(_0x52eb14,_0x2f94b6,_0x1a5d94){const _0x796caa=a2_0x3cee;try{const _0x1711d1=await _0x52eb14['getStateAsync'](_0x796caa(0xa8));if(!_0x1711d1||!_0x1711d1[_0x796caa(0xad)])return!![];const _0x36d61c=JSON[_0x796caa(0xa5)](_0x1711d1[_0x796caa(0xad)]),{rooms:_0x5cb94c,matrix:_0x1f455e}=_0x36d61c;if(!_0x5cb94c||!_0x1f455e)return!![];const _0x594136=_0x5cb94c[_0x796caa(0xaf)](_0x2f94b6),_0x1df89c=_0x5cb94c[_0x796caa(0xaf)](_0x1a5d94);if(_0x594136===-0x1||_0x1df89c===-0x1)return!![];const _0x17edb2=_0x1f455e[_0x594136][_0x1df89c]>0x0||_0x1f455e[_0x1df89c][_0x594136]>0x0;return _0x17edb2;}catch(_0x177064){return _0x52eb14['log']['warn'](_0x796caa(0xc3)+_0x177064[_0x796caa(0xd9)]),!![];}}function calculateSleepProbability(_0x2d6e00){const _0x380537=a2_0x3cee,_0x88d89=new Date(),_0x2bc269=_0x88d89[_0x380537(0xbd)](),_0x15f2d5=_0x2d6e00[_0x380537(0xd4)]();let _0x22aa9a=0.1;if(_0x2bc269>=0x17||_0x2bc269<=0x6)_0x22aa9a=0x1;else{if(_0x2bc269>=0xd&&_0x2bc269<=0xf)_0x22aa9a=0.8;else{if(_0x2bc269>=0x14&&_0x2bc269<=0x17)_0x22aa9a=0.4;}}let _0x33f4ac=0.1;if(_0x15f2d5['includes']('schlaf')||_0x15f2d5[_0x380537(0xa1)](_0x380537(0xb1)))_0x33f4ac=0x1;else{if(_0x15f2d5['includes'](_0x380537(0xb8))||_0x15f2d5[_0x380537(0xa1)](_0x380537(0xc0))||_0x15f2d5['includes'](_0x380537(0x9e)))_0x33f4ac=0.6;else{if(_0x15f2d5['includes'](_0x380537(0xc7))||_0x15f2d5['includes']('wc'))_0x33f4ac=0.05;}}let _0x2b5e76=0.5;const _0x522c65=_0x33f4ac*0.5+_0x22aa9a*0.3+_0x2b5e76*0.2;return parseFloat(_0x522c65['toFixed'](0x2));}async function updateLocation(_0x465809,_0x1177dc){const _0x14668f=a2_0x3cee;if(!_0x1177dc||_0x1177dc===_0x14668f(0xbf))return;if(!await isActive(_0x465809)){resetTimer(_0x465809);return;}if(currentMonitoredRoom&&currentMonitoredRoom!==_0x1177dc){const _0x5f0c84=await areRoomsConnected(_0x465809,currentMonitoredRoom,_0x1177dc);if(!_0x5f0c84){const _0x24712b=_0x14668f(0xb9)+_0x1177dc+_0x14668f(0xbb)+currentMonitoredRoom+'\x27.';_0x465809['log']['info'](_0x14668f(0xb6)+_0x24712b+_0x14668f(0xd2)),await _0x465809[_0x14668f(0xca)](_0x14668f(0xc1),{'val':JSON[_0x14668f(0xcf)]({'room':_0x1177dc,'reason':_0x24712b,'timestamp':Date['now']()}),'ack':!![]});return;}resetTimer(_0x465809);}if(!currentMonitoredRoom){await _0x465809[_0x14668f(0xca)]('analysis.safety.deadMan.currentRoom',{'val':_0x1177dc,'ack':!![]});const _0x448ed3=await loadConfig(_0x465809);let _0x5d6ba8=getTimeoutRobust(_0x448ed3,_0x1177dc);const _0x419b2e=_0x1177dc['toLowerCase']();if(!_0x5d6ba8)for(const _0x3d021 in DEFAULT_TIMEOUTS){if(_0x419b2e[_0x14668f(0xa1)](_0x3d021)){_0x5d6ba8=DEFAULT_TIMEOUTS[_0x3d021];break;}}if(!_0x5d6ba8&&_0x448ed3['default'])_0x5d6ba8=_0x448ed3['default'];if(!_0x5d6ba8)return;currentMonitoredRoom=_0x1177dc,startTimer(_0x465809,_0x5d6ba8,_0x1177dc);}}function startTimer(_0x2ff0e6,_0x976d1a,_0x1b340a){const _0x44c3af=a2_0x3cee;if(activeTimer)clearTimeout(activeTimer);timeoutMs=_0x976d1a*0x3c*0x3e8,startTime=Date['now'](),alarmStage=0x0;const _0x57a3bc=calculateSleepProbability(_0x1b340a||currentMonitoredRoom),_0x28bcd9=_0x57a3bc>0.65;_0x28bcd9?(timeoutMs+=0x5a*0x3c*0x3e8,_0x2ff0e6[_0x44c3af(0xce)][_0x44c3af(0xd3)](_0x44c3af(0xb4)+(_0x57a3bc*0x64)[_0x44c3af(0xae)](0x0)+_0x44c3af(0xa4)+currentMonitoredRoom+_0x44c3af(0xb3)),_0x2ff0e6[_0x44c3af(0xca)](_0x44c3af(0xa9),{'val':!![],'ack':!![]})):_0x2ff0e6[_0x44c3af(0xca)](_0x44c3af(0xa9),{'val':![],'ack':!![]}),_0x2ff0e6[_0x44c3af(0xca)](_0x44c3af(0xb5),{'val':_0x57a3bc,'ack':!![]}),_0x2ff0e6[_0x44c3af(0xce)][_0x44c3af(0xd3)](_0x44c3af(0xc6)+currentMonitoredRoom+_0x44c3af(0x9c)+_0x976d1a+_0x44c3af(0xa3)),_0x2ff0e6[_0x44c3af(0xca)]('analysis.safety.deadMan.alarmState',{'val':'ok','ack':!![]}),activeTimer=setTimeout(()=>triggerPreWarn(_0x2ff0e6),timeoutMs);}function resetTimer(_0x563b35){const _0x1dd60d=a2_0x3cee;if(activeTimer)clearTimeout(activeTimer);activeTimer=null,currentMonitoredRoom=null,alarmStage=0x0,_0x563b35['setStateAsync'](_0x1dd60d(0xd0),{'val':'ok','ack':!![]}),_0x563b35[_0x1dd60d(0xca)](_0x1dd60d(0xa9),{'val':![],'ack':!![]}),_0x563b35[_0x1dd60d(0xca)](_0x1dd60d(0xb5),{'val':0x0,'ack':!![]});}async function triggerPreWarn(_0x4d2882){const _0x3fc58e=a2_0x3cee;alarmStage=0x1,await _0x4d2882['setStateAsync'](_0x3fc58e(0xd0),{'val':_0x3fc58e(0xd6),'ack':!![]});const _0x34c5f1=_0x3fc58e(0xa6)+currentMonitoredRoom+_0x3fc58e(0xc9);_0x4d2882['log'][_0x3fc58e(0xa7)](_0x3fc58e(0xb6)+_0x34c5f1),await setup[_0x3fc58e(0xdb)](_0x4d2882,_0x3fc58e(0xc8)+_0x34c5f1),activeTimer=setTimeout(()=>triggerAlarm(_0x4d2882),0x5*0x3c*0x3e8);}async function triggerAlarm(_0xccc80d){const _0x103eb1=a2_0x3cee;alarmStage=0x2,await _0xccc80d['setStateAsync']('analysis.safety.deadMan.alarmState',{'val':_0x103eb1(0xac),'ack':!![]});const _0x1d6b65=_0x103eb1(0xd5)+currentMonitoredRoom+'!';_0xccc80d[_0x103eb1(0xce)][_0x103eb1(0xab)](_0x103eb1(0xb6)+_0x1d6b65),await setup[_0x103eb1(0xdb)](_0xccc80d,_0x1d6b65,![],!![]);}module[a2_0x340a43(0xc4)]={'updateLocation':updateLocation};