const a2_0xb0bfc2=a2_0x14e8;(function(_0x8ea1c5,_0x484be7){const _0x2f3e70=a2_0x14e8,_0x717db1=_0x8ea1c5();while(!![]){try{const _0xe3888b=-parseInt(_0x2f3e70(0x1b5))/0x1*(-parseInt(_0x2f3e70(0x1ac))/0x2)+parseInt(_0x2f3e70(0x1a7))/0x3+-parseInt(_0x2f3e70(0x197))/0x4*(-parseInt(_0x2f3e70(0x186))/0x5)+-parseInt(_0x2f3e70(0x18b))/0x6*(parseInt(_0x2f3e70(0x188))/0x7)+-parseInt(_0x2f3e70(0x1bd))/0x8+-parseInt(_0x2f3e70(0x199))/0x9*(-parseInt(_0x2f3e70(0x191))/0xa)+-parseInt(_0x2f3e70(0x1a1))/0xb*(parseInt(_0x2f3e70(0x1a2))/0xc);if(_0xe3888b===_0x484be7)break;else _0x717db1['push'](_0x717db1['shift']());}catch(_0x6e3a44){_0x717db1['push'](_0x717db1['shift']());}}}(a2_0x4a6e,0xd0887));const a2_0xc5d335=(function(){let _0x386789=!![];return function(_0x1c8c08,_0xe8d47a){const _0x42a395=_0x386789?function(){if(_0xe8d47a){const _0x32f125=_0xe8d47a['apply'](_0x1c8c08,arguments);return _0xe8d47a=null,_0x32f125;}}:function(){};return _0x386789=![],_0x42a395;};}()),a2_0xd59a84=a2_0xc5d335(this,function(){const _0xe9d402=a2_0x14e8;return a2_0xd59a84[_0xe9d402(0x1b7)]()[_0xe9d402(0x18c)](_0xe9d402(0x1c1))[_0xe9d402(0x1b7)]()[_0xe9d402(0x1b6)](a2_0xd59a84)[_0xe9d402(0x18c)]('(((.+)+)+)+$');});a2_0xd59a84();'use strict';const setup=require(a2_0xb0bfc2(0x1be));let activeTimer=null,currentMonitoredRoom=null,timeoutMs=0x0,startTime=0x0,alarmStage=0x0;const DEFAULT_TIMEOUTS={'bad':0x2d,'bath':0x2d,'toilet':0x1e,'wc':0x1e,'keller':0x3c,'schlaf':0x78,'bed':0x78,'guest':0x5a,'gast':0x5a};function getTimeoutRobust(_0x3955d0,_0x414126){const _0x2ee6ba=a2_0xb0bfc2;if(!_0x3955d0||!_0x414126)return undefined;if(_0x3955d0[_0x414126])return _0x3955d0[_0x414126];const _0x14015e=_0x414126[_0x2ee6ba(0x198)]()[_0x2ee6ba(0x1b1)](/[^a-z0-9]/g,'');for(const _0x50a4ca in _0x3955d0){const _0x140a7a=_0x50a4ca[_0x2ee6ba(0x198)]()[_0x2ee6ba(0x1b1)](/[^a-z0-9]/g,'');if(_0x140a7a===_0x14015e)return _0x3955d0[_0x50a4ca];}const _0x1bb3d5=_0x414126[_0x2ee6ba(0x198)]();if(_0x3955d0[_0x1bb3d5])return _0x3955d0[_0x1bb3d5];return undefined;}async function loadConfig(_0x2c47ba){const _0xae28d6=a2_0xb0bfc2;try{const _0x172e69=await _0x2c47ba[_0xae28d6(0x18d)](_0xae28d6(0x19b));if(_0x172e69&&_0x172e69['val'])return JSON[_0xae28d6(0x1bc)](_0x172e69[_0xae28d6(0x19c)]);}catch(_0x394fbe){}return{};}async function isActive(_0x1f2a6d){const _0x443d0c=a2_0xb0bfc2;try{const _0x465f52=await _0x1f2a6d[_0x443d0c(0x18d)](_0x443d0c(0x1ae));return _0x465f52&&_0x465f52[_0x443d0c(0x19c)];}catch(_0x57b010){return![];}}async function areRoomsConnected(_0x25a0f4,_0x492f7b,_0x1c16ec){const _0x259b11=a2_0xb0bfc2;try{const _0x4b112b=await _0x25a0f4[_0x259b11(0x18d)](_0x259b11(0x1c0));if(!_0x4b112b||!_0x4b112b['val'])return!![];const _0x1364be=JSON['parse'](_0x4b112b['val']),{rooms:_0x3e927b,matrix:_0x4afb2a}=_0x1364be;if(!_0x3e927b||!_0x4afb2a)return!![];const _0x3eb384=_0x3e927b['indexOf'](_0x492f7b),_0x42771b=_0x3e927b[_0x259b11(0x18f)](_0x1c16ec);if(_0x3eb384===-0x1||_0x42771b===-0x1)return!![];const _0x307aed=_0x4afb2a[_0x3eb384][_0x42771b]>0x0||_0x4afb2a[_0x42771b][_0x3eb384]>0x0;return _0x307aed;}catch(_0x4cc376){return _0x25a0f4['log'][_0x259b11(0x189)](_0x259b11(0x196)+_0x4cc376[_0x259b11(0x1a6)]),!![];}}function calculateSleepProbability(_0x26b6bf){const _0x1e08b6=a2_0xb0bfc2,_0x14022a=new Date(),_0x4db90d=_0x14022a[_0x1e08b6(0x1aa)](),_0x2775f5=_0x26b6bf[_0x1e08b6(0x198)]();let _0x2faffe=0.1;if(_0x4db90d>=0x17||_0x4db90d<=0x6)_0x2faffe=0x1;else{if(_0x4db90d>=0xd&&_0x4db90d<=0xf)_0x2faffe=0.8;else{if(_0x4db90d>=0x14&&_0x4db90d<=0x17)_0x2faffe=0.4;}}let _0x1e622d=0.1;if(_0x2775f5[_0x1e08b6(0x190)](_0x1e08b6(0x1b4))||_0x2775f5[_0x1e08b6(0x190)]('bed'))_0x1e622d=0x1;else{if(_0x2775f5['includes']('wohn')||_0x2775f5['includes'](_0x1e08b6(0x19f))||_0x2775f5[_0x1e08b6(0x190)]('sofa'))_0x1e622d=0.6;else{if(_0x2775f5['includes'](_0x1e08b6(0x1b8))||_0x2775f5['includes']('wc'))_0x1e622d=0.05;}}let _0x4b6153=0.5;const _0x10e950=_0x1e622d*0.5+_0x2faffe*0.3+_0x4b6153*0.2;return parseFloat(_0x10e950[_0x1e08b6(0x187)](0x2));}async function updateLocation(_0x340755,_0x3e5684){const _0x595933=a2_0xb0bfc2;if(!_0x3e5684||_0x3e5684===_0x595933(0x1b0))return;if(!await isActive(_0x340755)){resetTimer(_0x340755);return;}if(currentMonitoredRoom&&currentMonitoredRoom!==_0x3e5684){const _0x1b6967=await areRoomsConnected(_0x340755,currentMonitoredRoom,_0x3e5684);if(!_0x1b6967){const _0x579f1e=_0x595933(0x195)+_0x3e5684+_0x595933(0x1ba)+currentMonitoredRoom+'\x27.';_0x340755[_0x595933(0x1b3)][_0x595933(0x1bb)](_0x595933(0x1b9)+_0x579f1e+_0x595933(0x192)),await _0x340755[_0x595933(0x1bf)]('analysis.safety.deadMan.lastIgnored',{'val':JSON[_0x595933(0x1a0)]({'room':_0x3e5684,'reason':_0x579f1e,'timestamp':Date['now']()}),'ack':!![]});return;}resetTimer(_0x340755);}if(!currentMonitoredRoom){await _0x340755[_0x595933(0x1bf)]('analysis.safety.deadMan.currentRoom',{'val':_0x3e5684,'ack':!![]});const _0x325a28=await loadConfig(_0x340755);let _0x7c8c2=getTimeoutRobust(_0x325a28,_0x3e5684);const _0x8cc081=_0x3e5684[_0x595933(0x198)]();if(!_0x7c8c2)for(const _0x459800 in DEFAULT_TIMEOUTS){if(_0x8cc081[_0x595933(0x190)](_0x459800)){_0x7c8c2=DEFAULT_TIMEOUTS[_0x459800];break;}}if(!_0x7c8c2&&_0x325a28['default'])_0x7c8c2=_0x325a28[_0x595933(0x19e)];if(!_0x7c8c2)return;currentMonitoredRoom=_0x3e5684,startTimer(_0x340755,_0x7c8c2,_0x3e5684);}}function startTimer(_0x1e9370,_0x335381,_0x5ef881){const _0xd5feaa=a2_0xb0bfc2;if(activeTimer)clearTimeout(activeTimer);timeoutMs=_0x335381*0x3c*0x3e8,startTime=Date[_0xd5feaa(0x18a)](),alarmStage=0x0;const _0x1348ab=calculateSleepProbability(_0x5ef881||currentMonitoredRoom),_0x194d8b=_0x1348ab>0.65;_0x194d8b?(timeoutMs+=0x5a*0x3c*0x3e8,_0x1e9370[_0xd5feaa(0x1b3)][_0xd5feaa(0x1bb)](_0xd5feaa(0x194)+(_0x1348ab*0x64)[_0xd5feaa(0x187)](0x0)+_0xd5feaa(0x1ab)+currentMonitoredRoom+_0xd5feaa(0x1af)),_0x1e9370['setStateAsync'](_0xd5feaa(0x19a),{'val':!![],'ack':!![]})):_0x1e9370['setStateAsync'](_0xd5feaa(0x19a),{'val':![],'ack':!![]}),_0x1e9370[_0xd5feaa(0x1bf)](_0xd5feaa(0x193),{'val':_0x1348ab,'ack':!![]}),_0x1e9370['log'][_0xd5feaa(0x1bb)]('ðŸ‘¼\x20Schutzengel:\x20Ãœberwache\x20'+currentMonitoredRoom+_0xd5feaa(0x1a5)+_0x335381+_0xd5feaa(0x1a9)),_0x1e9370[_0xd5feaa(0x1bf)]('analysis.safety.deadMan.alarmState',{'val':'ok','ack':!![]}),activeTimer=setTimeout(()=>triggerPreWarn(_0x1e9370),timeoutMs);}function a2_0x4a6e(){const _0xb42951=['message','3861513orbjfU','error','\x20Min.','getHours','%).\x20VerlÃ¤ngere\x20Timer\x20fÃ¼r\x20','62078HrEMZu','sendNotification','analysis.safety.deadMan.active','\x20um\x2090\x20Min.','Unknown','replace','analysis.safety.deadMan.alarmState','log','schlaf','19ADSMQk','constructor','toString','bad','[DeadMan]\x20','\x27.\x20Nicht\x20verbunden\x20mit\x20Ã¼berwachtem\x20\x27','info','parse','6541680ffknDy','./setup','setStateAsync','analysis.topology.structure','(((.+)+)+)+$','36725hqsqMr','toFixed','469XmuvWb','warn','now','117966ytkxTC','search','getStateAsync','ðŸ‘¼\x20Schutzengel-Frage:\x20','indexOf','includes','908260uuYPdc','\x20(Multi-Person\x20Filter)','analysis.safety.deadMan.napProbability','ðŸ’¤\x20Smart\x20Sleep\x20erkannt\x20(','Ignoriere\x20Bewegung\x20in\x20\x27','[DeadMan]\x20Topology\x20check\x20failed:\x20','716xJCSzc','toLowerCase','126Fzcbgz','analysis.safety.deadMan.smartSleep','analysis.safety.deadMan.config','val','â³\x20ACHTUNG:\x20UngewÃ¶hnlich\x20lange\x20InaktivitÃ¤t\x20in\x20','default','living','stringify','99mpjFNr','1965444nqzbtq','.\x20Alles\x20in\x20Ordnung?','alarm','\x20fÃ¼r\x20'];a2_0x4a6e=function(){return _0xb42951;};return a2_0x4a6e();}function resetTimer(_0x5b62d1){const _0x43d5f9=a2_0xb0bfc2;if(activeTimer)clearTimeout(activeTimer);activeTimer=null,currentMonitoredRoom=null,alarmStage=0x0,_0x5b62d1['setStateAsync'](_0x43d5f9(0x1b2),{'val':'ok','ack':!![]}),_0x5b62d1[_0x43d5f9(0x1bf)](_0x43d5f9(0x19a),{'val':![],'ack':!![]}),_0x5b62d1['setStateAsync'](_0x43d5f9(0x193),{'val':0x0,'ack':!![]});}async function triggerPreWarn(_0x264741){const _0xb92719=a2_0xb0bfc2;alarmStage=0x1,await _0x264741['setStateAsync']('analysis.safety.deadMan.alarmState',{'val':'pre_warn','ack':!![]});const _0x53ad62=_0xb92719(0x19d)+currentMonitoredRoom+_0xb92719(0x1a3);_0x264741[_0xb92719(0x1b3)]['warn'](_0xb92719(0x1b9)+_0x53ad62),await setup['sendNotification'](_0x264741,_0xb92719(0x18e)+_0x53ad62),activeTimer=setTimeout(()=>triggerAlarm(_0x264741),0x5*0x3c*0x3e8);}async function triggerAlarm(_0x52ca67){const _0x106296=a2_0xb0bfc2;alarmStage=0x2,await _0x52ca67[_0x106296(0x1bf)](_0x106296(0x1b2),{'val':_0x106296(0x1a4),'ack':!![]});const _0x2acf61='ðŸš¨\x20NOTFALL-ALARM:\x20Person\x20reagiert\x20nicht\x20in\x20'+currentMonitoredRoom+'!';_0x52ca67[_0x106296(0x1b3)][_0x106296(0x1a8)](_0x106296(0x1b9)+_0x2acf61),await setup[_0x106296(0x1ad)](_0x52ca67,_0x2acf61,![],!![]);}function a2_0x14e8(_0x74fb8,_0x113c27){const _0x54a8a2=a2_0x4a6e();return a2_0x14e8=function(_0xd59a84,_0xc5d335){_0xd59a84=_0xd59a84-0x186;let _0x4a6ee6=_0x54a8a2[_0xd59a84];return _0x4a6ee6;},a2_0x14e8(_0x74fb8,_0x113c27);}module['exports']={'updateLocation':updateLocation};