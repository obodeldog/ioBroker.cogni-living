const a2_0x248854=a2_0x1764;(function(_0x4919c8,_0x337050){const _0x2d0097=a2_0x1764,_0x4be382=_0x4919c8();while(!![]){try{const _0x2c15fc=parseInt(_0x2d0097(0xac))/0x1*(-parseInt(_0x2d0097(0x86))/0x2)+parseInt(_0x2d0097(0x9d))/0x3+-parseInt(_0x2d0097(0xa6))/0x4*(-parseInt(_0x2d0097(0x87))/0x5)+-parseInt(_0x2d0097(0x7c))/0x6+-parseInt(_0x2d0097(0xa1))/0x7*(parseInt(_0x2d0097(0x8f))/0x8)+-parseInt(_0x2d0097(0x92))/0x9+parseInt(_0x2d0097(0xaa))/0xa;if(_0x2c15fc===_0x337050)break;else _0x4be382['push'](_0x4be382['shift']());}catch(_0x399e89){_0x4be382['push'](_0x4be382['shift']());}}}(a2_0x5109,0xe0ca6));const a2_0x16a274=(function(){let _0x30f852=!![];return function(_0x5d0dcf,_0xb82177){const _0x15cb8f=_0x30f852?function(){const _0x21a944=a2_0x1764;if(_0xb82177){const _0x335f72=_0xb82177[_0x21a944(0xaf)](_0x5d0dcf,arguments);return _0xb82177=null,_0x335f72;}}:function(){};return _0x30f852=![],_0x15cb8f;};}()),a2_0x2312a7=a2_0x16a274(this,function(){const _0x2bd73b=a2_0x1764;return a2_0x2312a7[_0x2bd73b(0xab)]()[_0x2bd73b(0x91)](_0x2bd73b(0x83))[_0x2bd73b(0xab)]()[_0x2bd73b(0x7f)](a2_0x2312a7)[_0x2bd73b(0x91)](_0x2bd73b(0x83));});a2_0x2312a7();function a2_0x1764(_0x37c1a3,_0x1c860d){const _0x53127d=a2_0x5109();return a2_0x1764=function(_0x2312a7,_0x16a274){_0x2312a7=_0x2312a7-0x76;let _0x51098f=_0x53127d[_0x2312a7];return _0x51098f;},a2_0x1764(_0x37c1a3,_0x1c860d);}'use strict';const setup=require(a2_0x248854(0x8d));let activeTimer=null,currentMonitoredRoom=null,timeoutMs=0x0,startTime=0x0,alarmStage=0x0;const DEFAULT_TIMEOUTS={'bad':0x2d,'bath':0x2d,'toilet':0x1e,'wc':0x1e,'keller':0x3c,'schlaf':0x78,'bed':0x78,'guest':0x5a,'gast':0x5a};async function loadConfig(_0x20cda4){const _0x2ca1fa=a2_0x248854;try{const _0xc6749d=await _0x20cda4['getStateAsync']('analysis.safety.deadMan.config');if(_0xc6749d&&_0xc6749d[_0x2ca1fa(0xa9)])return JSON[_0x2ca1fa(0xa8)](_0xc6749d[_0x2ca1fa(0xa9)]);}catch(_0x1c2069){}return{};}async function isActive(_0xd70db7){const _0x4f6fb3=a2_0x248854;try{const _0x217410=await _0xd70db7['getStateAsync'](_0x4f6fb3(0xb0));return _0x217410&&_0x217410[_0x4f6fb3(0xa9)];}catch(_0x62abbe){return![];}}function a2_0x5109(){const _0x8ec081=['2575272hnsWGk','toLowerCase','.\x20Alles\x20in\x20Ordnung?','stringify','5922JqlGLO','getStateAsync','message','exports','sendNotification','6073368buzqyL','bad','parse','val','41006010JIPGjH','toString','719veoLUt','includes','ðŸ‘¼\x20Schutzengel-Frage:\x20','apply','analysis.safety.deadMan.active','\x20fÃ¼r\x20','analysis.safety.deadMan.alarmState','now','warn','bed','pre_warn','sofa','ðŸš¨\x20NOTFALL-ALARM:\x20Person\x20reagiert\x20nicht\x20in\x20','wohn','6163992PAhRBY','analysis.safety.deadMan.smartSleep','analysis.topology.structure','constructor','living','default','[DeadMan]\x20Topology\x20check\x20failed:\x20','(((.+)+)+)+$','info','alarm','4874qwlAng','5dJOvkV','error','analysis.safety.deadMan.currentRoom','log','Unknown','analysis.safety.deadMan.lastIgnored','./setup','\x20(Multi-Person\x20Filter)','17256oXFqpJ','ðŸ‘¼\x20Schutzengel:\x20Ãœberwache\x20','search','8570412BESGHX','setStateAsync','%).\x20VerlÃ¤ngere\x20Timer\x20fÃ¼r\x20','schlaf','indexOf','[DeadMan]\x20','Ignoriere\x20Bewegung\x20in\x20\x27','analysis.safety.deadMan.napProbability','toFixed','â³\x20ACHTUNG:\x20UngewÃ¶hnlich\x20lange\x20InaktivitÃ¤t\x20in\x20','\x20um\x2090\x20Min.'];a2_0x5109=function(){return _0x8ec081;};return a2_0x5109();}async function areRoomsConnected(_0x2b3099,_0x15ee19,_0x1d945c){const _0x7fb1cb=a2_0x248854;try{const _0x4fa904=await _0x2b3099[_0x7fb1cb(0xa2)](_0x7fb1cb(0x7e));if(!_0x4fa904||!_0x4fa904[_0x7fb1cb(0xa9)])return!![];const _0x278227=JSON['parse'](_0x4fa904[_0x7fb1cb(0xa9)]),{rooms:_0x2d0609,matrix:_0x25493e}=_0x278227;if(!_0x2d0609||!_0x25493e)return!![];const _0x15040c=_0x2d0609[_0x7fb1cb(0x96)](_0x15ee19),_0x3ac0dc=_0x2d0609[_0x7fb1cb(0x96)](_0x1d945c);if(_0x15040c===-0x1||_0x3ac0dc===-0x1)return!![];const _0x50ef2e=_0x25493e[_0x15040c][_0x3ac0dc]>0x0||_0x25493e[_0x3ac0dc][_0x15040c]>0x0;return _0x50ef2e;}catch(_0xbe55bb){return _0x2b3099[_0x7fb1cb(0x8a)][_0x7fb1cb(0x76)](_0x7fb1cb(0x82)+_0xbe55bb[_0x7fb1cb(0xa3)]),!![];}}function calculateSleepProbability(_0x286b27){const _0x4b2fb6=a2_0x248854,_0x5959a7=new Date(),_0x5a9f2f=_0x5959a7['getHours'](),_0x1c4f5c=_0x286b27[_0x4b2fb6(0x9e)]();let _0x37c0c9=0.1;if(_0x5a9f2f>=0x17||_0x5a9f2f<=0x6)_0x37c0c9=0x1;else{if(_0x5a9f2f>=0xd&&_0x5a9f2f<=0xf)_0x37c0c9=0.8;else{if(_0x5a9f2f>=0x14&&_0x5a9f2f<=0x17)_0x37c0c9=0.4;}}let _0x595d92=0.1;if(_0x1c4f5c['includes'](_0x4b2fb6(0x95))||_0x1c4f5c[_0x4b2fb6(0xad)](_0x4b2fb6(0x77)))_0x595d92=0x1;else{if(_0x1c4f5c['includes'](_0x4b2fb6(0x7b))||_0x1c4f5c[_0x4b2fb6(0xad)](_0x4b2fb6(0x80))||_0x1c4f5c['includes'](_0x4b2fb6(0x79)))_0x595d92=0.6;else{if(_0x1c4f5c[_0x4b2fb6(0xad)](_0x4b2fb6(0xa7))||_0x1c4f5c[_0x4b2fb6(0xad)]('wc'))_0x595d92=0.05;}}let _0x4e56bb=0.5;const _0x362a33=_0x595d92*0.5+_0x37c0c9*0.3+_0x4e56bb*0.2;return parseFloat(_0x362a33[_0x4b2fb6(0x9a)](0x2));}async function updateLocation(_0x213701,_0x94c49b){const _0x32448e=a2_0x248854;if(!_0x94c49b||_0x94c49b===_0x32448e(0x8b))return;if(!await isActive(_0x213701)){resetTimer(_0x213701);return;}if(currentMonitoredRoom&&currentMonitoredRoom!==_0x94c49b){const _0x48c968=await areRoomsConnected(_0x213701,currentMonitoredRoom,_0x94c49b);if(!_0x48c968){const _0x29a448=_0x32448e(0x98)+_0x94c49b+'\x27.\x20Nicht\x20verbunden\x20mit\x20Ã¼berwachtem\x20\x27'+currentMonitoredRoom+'\x27.';_0x213701[_0x32448e(0x8a)][_0x32448e(0x84)](_0x32448e(0x97)+_0x29a448+_0x32448e(0x8e)),await _0x213701[_0x32448e(0x93)](_0x32448e(0x8c),{'val':JSON[_0x32448e(0xa0)]({'room':_0x94c49b,'reason':_0x29a448,'timestamp':Date['now']()}),'ack':!![]});return;}resetTimer(_0x213701);}if(!currentMonitoredRoom){await _0x213701['setStateAsync'](_0x32448e(0x89),{'val':_0x94c49b,'ack':!![]});const _0x113dc6=await loadConfig(_0x213701),_0x45e568=_0x94c49b[_0x32448e(0x9e)]();let _0x23a485=_0x113dc6[_0x94c49b]||_0x113dc6[_0x45e568];if(!_0x23a485)for(const _0xe5a0e4 in DEFAULT_TIMEOUTS){if(_0x45e568[_0x32448e(0xad)](_0xe5a0e4)){_0x23a485=DEFAULT_TIMEOUTS[_0xe5a0e4];break;}}if(!_0x23a485&&_0x113dc6['default'])_0x23a485=_0x113dc6[_0x32448e(0x81)];if(!_0x23a485)return;currentMonitoredRoom=_0x94c49b,startTimer(_0x213701,_0x23a485,_0x94c49b);}}function startTimer(_0x30a9ec,_0x239e23,_0x534eeb){const _0x246c8f=a2_0x248854;if(activeTimer)clearTimeout(activeTimer);timeoutMs=_0x239e23*0x3c*0x3e8,startTime=Date[_0x246c8f(0xb3)](),alarmStage=0x0;const _0x38e2df=calculateSleepProbability(_0x534eeb||currentMonitoredRoom),_0x3402b5=_0x38e2df>0.65;_0x3402b5?(timeoutMs+=0x5a*0x3c*0x3e8,_0x30a9ec['log'][_0x246c8f(0x84)]('ðŸ’¤\x20Smart\x20Sleep\x20erkannt\x20('+(_0x38e2df*0x64)[_0x246c8f(0x9a)](0x0)+_0x246c8f(0x94)+currentMonitoredRoom+_0x246c8f(0x9c)),_0x30a9ec[_0x246c8f(0x93)](_0x246c8f(0x7d),{'val':!![],'ack':!![]})):_0x30a9ec[_0x246c8f(0x93)](_0x246c8f(0x7d),{'val':![],'ack':!![]}),_0x30a9ec[_0x246c8f(0x93)](_0x246c8f(0x99),{'val':_0x38e2df,'ack':!![]}),_0x30a9ec[_0x246c8f(0x8a)][_0x246c8f(0x84)](_0x246c8f(0x90)+currentMonitoredRoom+_0x246c8f(0xb1)+_0x239e23+'\x20Min.'),_0x30a9ec[_0x246c8f(0x93)](_0x246c8f(0xb2),{'val':'ok','ack':!![]}),activeTimer=setTimeout(()=>triggerPreWarn(_0x30a9ec),timeoutMs);}function resetTimer(_0x37defe){const _0x2becb5=a2_0x248854;if(activeTimer)clearTimeout(activeTimer);activeTimer=null,currentMonitoredRoom=null,alarmStage=0x0,_0x37defe[_0x2becb5(0x93)](_0x2becb5(0xb2),{'val':'ok','ack':!![]}),_0x37defe[_0x2becb5(0x93)](_0x2becb5(0x7d),{'val':![],'ack':!![]}),_0x37defe['setStateAsync'](_0x2becb5(0x99),{'val':0x0,'ack':!![]});}async function triggerPreWarn(_0x559d97){const _0x3ca347=a2_0x248854;alarmStage=0x1,await _0x559d97[_0x3ca347(0x93)]('analysis.safety.deadMan.alarmState',{'val':_0x3ca347(0x78),'ack':!![]});const _0x241a2f=_0x3ca347(0x9b)+currentMonitoredRoom+_0x3ca347(0x9f);_0x559d97[_0x3ca347(0x8a)][_0x3ca347(0x76)](_0x3ca347(0x97)+_0x241a2f),await setup[_0x3ca347(0xa5)](_0x559d97,_0x3ca347(0xae)+_0x241a2f),activeTimer=setTimeout(()=>triggerAlarm(_0x559d97),0x5*0x3c*0x3e8);}async function triggerAlarm(_0x23752d){const _0x268605=a2_0x248854;alarmStage=0x2,await _0x23752d['setStateAsync'](_0x268605(0xb2),{'val':_0x268605(0x85),'ack':!![]});const _0x49e4df=_0x268605(0x7a)+currentMonitoredRoom+'!';_0x23752d['log'][_0x268605(0x88)]('[DeadMan]\x20'+_0x49e4df),await setup[_0x268605(0xa5)](_0x23752d,_0x49e4df,![],!![]);}module[a2_0x248854(0xa4)]={'updateLocation':updateLocation};