const a2_0x1fb29c=a2_0x2b06;(function(_0x964c3,_0x1c6a18){const _0xaf32f8=a2_0x2b06,_0x38ed15=_0x964c3();while(!![]){try{const _0x24177f=-parseInt(_0xaf32f8(0x106))/0x1*(parseInt(_0xaf32f8(0x114))/0x2)+parseInt(_0xaf32f8(0x10f))/0x3*(parseInt(_0xaf32f8(0xe4))/0x4)+-parseInt(_0xaf32f8(0x100))/0x5+parseInt(_0xaf32f8(0x101))/0x6*(-parseInt(_0xaf32f8(0xe7))/0x7)+parseInt(_0xaf32f8(0x112))/0x8+-parseInt(_0xaf32f8(0xf7))/0x9*(parseInt(_0xaf32f8(0x110))/0xa)+parseInt(_0xaf32f8(0xf9))/0xb*(parseInt(_0xaf32f8(0xef))/0xc);if(_0x24177f===_0x1c6a18)break;else _0x38ed15['push'](_0x38ed15['shift']());}catch(_0x5a06d4){_0x38ed15['push'](_0x38ed15['shift']());}}}(a2_0x16e6,0xd74bb));const a2_0x2eb448=(function(){let _0x3def0d=!![];return function(_0xade8c3,_0x13f97e){const _0x48a7ec=_0x3def0d?function(){const _0xb2db18=a2_0x2b06;if(_0x13f97e){const _0x448742=_0x13f97e[_0xb2db18(0x103)](_0xade8c3,arguments);return _0x13f97e=null,_0x448742;}}:function(){};return _0x3def0d=![],_0x48a7ec;};}()),a2_0x190973=a2_0x2eb448(this,function(){const _0x386430=a2_0x2b06;return a2_0x190973[_0x386430(0x102)]()[_0x386430(0x115)](_0x386430(0xf4))[_0x386430(0x102)]()[_0x386430(0x10a)](a2_0x190973)[_0x386430(0x115)](_0x386430(0xf4));});a2_0x190973();'use strict';const setup=require(a2_0x1fb29c(0xf5));let activeTimer=null,currentMonitoredRoom=null,timeoutMs=0x0,startTime=0x0,alarmStage=0x0;function a2_0x2b06(_0x565deb,_0x3e4d55){const _0x183062=a2_0x16e6();return a2_0x2b06=function(_0x190973,_0x2eb448){_0x190973=_0x190973-0xe4;let _0x16e6d9=_0x183062[_0x190973];return _0x16e6d9;},a2_0x2b06(_0x565deb,_0x3e4d55);}const DEFAULT_TIMEOUTS={'bad':0x2d,'bath':0x2d,'toilet':0x1e,'wc':0x1e,'keller':0x3c,'schlaf':0x78,'bed':0x78,'guest':0x5a,'gast':0x5a};function getTimeoutRobust(_0x39652b,_0xec02b5){const _0x3e519e=a2_0x1fb29c;if(!_0x39652b||!_0xec02b5)return undefined;if(_0x39652b[_0xec02b5])return _0x39652b[_0xec02b5];const _0x1cded6=_0xec02b5[_0x3e519e(0x11e)]()['replace'](/[^a-z0-9]/g,'');for(const _0x166bb3 in _0x39652b){const _0x321549=_0x166bb3[_0x3e519e(0x11e)]()[_0x3e519e(0x116)](/[^a-z0-9]/g,'');if(_0x321549===_0x1cded6)return _0x39652b[_0x166bb3];}const _0x407f45=_0xec02b5[_0x3e519e(0x11e)]();if(_0x39652b[_0x407f45])return _0x39652b[_0x407f45];return undefined;}async function loadConfig(_0x5d2566){const _0x56555b=a2_0x1fb29c;try{const _0x45103b=await _0x5d2566['getStateAsync'](_0x56555b(0xeb));if(_0x45103b&&_0x45103b['val'])return JSON[_0x56555b(0x11c)](_0x45103b['val']);}catch(_0x6b7ffe){}return{};}async function isActive(_0x33fb4e){const _0x3d1641=a2_0x1fb29c;try{const _0x5f5126=await _0x33fb4e['getStateAsync'](_0x3d1641(0xe9));return _0x5f5126&&_0x5f5126['val'];}catch(_0x3626b7){return![];}}async function areRoomsConnected(_0x81b1a2,_0x2d4787,_0x916a4d){const _0xf6a9f5=a2_0x1fb29c;try{const _0x35c60d=await _0x81b1a2[_0xf6a9f5(0xf3)]('analysis.topology.structure');if(!_0x35c60d||!_0x35c60d[_0xf6a9f5(0xfb)])return!![];const _0x39f3b4=JSON['parse'](_0x35c60d['val']),{rooms:_0x5e1b23,matrix:_0x4a9816}=_0x39f3b4;if(!_0x5e1b23||!_0x4a9816)return!![];const _0x21632c=_0x5e1b23['indexOf'](_0x2d4787),_0xe2b78e=_0x5e1b23[_0xf6a9f5(0xea)](_0x916a4d);if(_0x21632c===-0x1||_0xe2b78e===-0x1)return!![];const _0x34d2c4=_0x4a9816[_0x21632c][_0xe2b78e]>0x0||_0x4a9816[_0xe2b78e][_0x21632c]>0x0;return _0x34d2c4;}catch(_0x57ac67){return _0x81b1a2[_0xf6a9f5(0x10b)]['warn']('[DeadMan]\x20Topology\x20check\x20failed:\x20'+_0x57ac67[_0xf6a9f5(0x11a)]),!![];}}function calculateSleepProbability(_0x14e8ff){const _0x44e64c=a2_0x1fb29c,_0x262903=new Date(),_0x24b1bd=_0x262903[_0x44e64c(0x111)](),_0x18d2c7=_0x14e8ff[_0x44e64c(0x11e)]();let _0x5a3489=0.1;if(_0x24b1bd>=0x17||_0x24b1bd<=0x6)_0x5a3489=0x1;else{if(_0x24b1bd>=0xd&&_0x24b1bd<=0xf)_0x5a3489=0.8;else{if(_0x24b1bd>=0x14&&_0x24b1bd<=0x17)_0x5a3489=0.4;}}let _0x9a63a2=0.1;if(_0x18d2c7[_0x44e64c(0x109)](_0x44e64c(0x10d))||_0x18d2c7[_0x44e64c(0x109)](_0x44e64c(0xe5)))_0x9a63a2=0x1;else{if(_0x18d2c7['includes'](_0x44e64c(0x117))||_0x18d2c7[_0x44e64c(0x109)](_0x44e64c(0x119))||_0x18d2c7[_0x44e64c(0x109)](_0x44e64c(0xee)))_0x9a63a2=0.6;else{if(_0x18d2c7[_0x44e64c(0x109)]('bad')||_0x18d2c7[_0x44e64c(0x109)]('wc'))_0x9a63a2=0.05;}}let _0x8161bd=0.5;const _0x1dde57=_0x9a63a2*0.5+_0x5a3489*0.3+_0x8161bd*0.2;return parseFloat(_0x1dde57[_0x44e64c(0xf1)](0x2));}async function updateLocation(_0x5e7074,_0x2feefc){const _0xe1afb=a2_0x1fb29c;if(!_0x2feefc||_0x2feefc===_0xe1afb(0x10e))return;if(!await isActive(_0x5e7074)){resetTimer(_0x5e7074);return;}if(currentMonitoredRoom&&currentMonitoredRoom!==_0x2feefc){const _0x4d907e=await areRoomsConnected(_0x5e7074,currentMonitoredRoom,_0x2feefc);if(!_0x4d907e){const _0x40a6d4=_0xe1afb(0xfc)+_0x2feefc+'\x27.\x20Nicht\x20verbunden\x20mit\x20Ã¼berwachtem\x20\x27'+currentMonitoredRoom+'\x27.';_0x5e7074[_0xe1afb(0x10b)][_0xe1afb(0x107)](_0xe1afb(0xed)+_0x40a6d4+_0xe1afb(0xfa)),await _0x5e7074[_0xe1afb(0x108)]('analysis.safety.deadMan.lastIgnored',{'val':JSON[_0xe1afb(0x11d)]({'room':_0x2feefc,'reason':_0x40a6d4,'timestamp':Date[_0xe1afb(0xec)]()}),'ack':!![]});return;}resetTimer(_0x5e7074);}if(!currentMonitoredRoom){await _0x5e7074['setStateAsync'](_0xe1afb(0xf0),{'val':_0x2feefc,'ack':!![]});const _0x558874=await loadConfig(_0x5e7074);let _0x5afda3=getTimeoutRobust(_0x558874,_0x2feefc);const _0x455f91=_0x2feefc[_0xe1afb(0x11e)]();if(!_0x5afda3)for(const _0x13e726 in DEFAULT_TIMEOUTS){if(_0x455f91[_0xe1afb(0x109)](_0x13e726)){_0x5afda3=DEFAULT_TIMEOUTS[_0x13e726];break;}}if(!_0x5afda3&&_0x558874[_0xe1afb(0xf8)])_0x5afda3=_0x558874[_0xe1afb(0xf8)];if(!_0x5afda3)return;currentMonitoredRoom=_0x2feefc,startTimer(_0x5e7074,_0x5afda3,_0x2feefc);}}function a2_0x16e6(){const _0x2cc47f=['246098ZvAthJ','search','replace','wohn','analysis.safety.deadMan.smartSleep','living','message','error','parse','stringify','toLowerCase','372JxAQfx','bed','%).\x20VerlÃ¤ngere\x20Timer\x20fÃ¼r\x20','3766xXCZfh','sendNotification','analysis.safety.deadMan.active','indexOf','analysis.safety.deadMan.config','now','[DeadMan]\x20','sofa','7164yVCQWf','analysis.safety.deadMan.currentRoom','toFixed','ðŸš¨\x20NOTFALL-ALARM:\x20Person\x20reagiert\x20nicht\x20in\x20','getStateAsync','(((.+)+)+)+$','./setup','analysis.safety.deadMan.napProbability','63ovIWdO','default','74162Dtycqy','\x20(Multi-Person\x20Filter)','val','Ignoriere\x20Bewegung\x20in\x20\x27','warn','\x20Min.','ðŸ’¤\x20Smart\x20Sleep\x20erkannt\x20(','8214945svMhIY','6318Gyctoa','toString','apply','alarm','analysis.safety.deadMan.alarmState','9TKjcCO','info','setStateAsync','includes','constructor','log','ðŸ‘¼\x20Schutzengel:\x20Ãœberwache\x20','schlaf','Unknown','29487ZgfmtN','1678630fGxFEi','getHours','3478120XFSqfv','\x20um\x2090\x20Min.'];a2_0x16e6=function(){return _0x2cc47f;};return a2_0x16e6();}function startTimer(_0x95c896,_0x14704e,_0x25aa9c){const _0x45fd67=a2_0x1fb29c;if(activeTimer)clearTimeout(activeTimer);timeoutMs=_0x14704e*0x3c*0x3e8,startTime=Date[_0x45fd67(0xec)](),alarmStage=0x0;const _0x54c084=calculateSleepProbability(_0x25aa9c||currentMonitoredRoom),_0x38414a=_0x54c084>0.65;_0x38414a?(timeoutMs+=0x5a*0x3c*0x3e8,_0x95c896[_0x45fd67(0x10b)][_0x45fd67(0x107)](_0x45fd67(0xff)+(_0x54c084*0x64)[_0x45fd67(0xf1)](0x0)+_0x45fd67(0xe6)+currentMonitoredRoom+_0x45fd67(0x113)),_0x95c896[_0x45fd67(0x108)](_0x45fd67(0x118),{'val':!![],'ack':!![]})):_0x95c896[_0x45fd67(0x108)]('analysis.safety.deadMan.smartSleep',{'val':![],'ack':!![]}),_0x95c896[_0x45fd67(0x108)](_0x45fd67(0xf6),{'val':_0x54c084,'ack':!![]}),_0x95c896[_0x45fd67(0x10b)]['info'](_0x45fd67(0x10c)+currentMonitoredRoom+'\x20fÃ¼r\x20'+_0x14704e+_0x45fd67(0xfe)),_0x95c896[_0x45fd67(0x108)]('analysis.safety.deadMan.alarmState',{'val':'ok','ack':!![]}),activeTimer=setTimeout(()=>triggerPreWarn(_0x95c896),timeoutMs);}function resetTimer(_0x5212ac){const _0x50baf2=a2_0x1fb29c;if(activeTimer)clearTimeout(activeTimer);activeTimer=null,currentMonitoredRoom=null,alarmStage=0x0,_0x5212ac['setStateAsync'](_0x50baf2(0x105),{'val':'ok','ack':!![]}),_0x5212ac[_0x50baf2(0x108)]('analysis.safety.deadMan.smartSleep',{'val':![],'ack':!![]}),_0x5212ac[_0x50baf2(0x108)](_0x50baf2(0xf6),{'val':0x0,'ack':!![]});}async function triggerPreWarn(_0x3c4387){const _0x1a5cec=a2_0x1fb29c;alarmStage=0x1,await _0x3c4387[_0x1a5cec(0x108)](_0x1a5cec(0x105),{'val':'pre_warn','ack':!![]});const _0x1028b0='â³\x20ACHTUNG:\x20UngewÃ¶hnlich\x20lange\x20InaktivitÃ¤t\x20in\x20'+currentMonitoredRoom+'.\x20Alles\x20in\x20Ordnung?';_0x3c4387['log'][_0x1a5cec(0xfd)](_0x1a5cec(0xed)+_0x1028b0),await setup[_0x1a5cec(0xe8)](_0x3c4387,'ðŸ‘¼\x20Schutzengel-Frage:\x20'+_0x1028b0),activeTimer=setTimeout(()=>triggerAlarm(_0x3c4387),0x5*0x3c*0x3e8);}async function triggerAlarm(_0x5e4b08){const _0x46ed3a=a2_0x1fb29c;alarmStage=0x2,await _0x5e4b08[_0x46ed3a(0x108)]('analysis.safety.deadMan.alarmState',{'val':_0x46ed3a(0x104),'ack':!![]});const _0x4460de=_0x46ed3a(0xf2)+currentMonitoredRoom+'!';_0x5e4b08['log'][_0x46ed3a(0x11b)](_0x46ed3a(0xed)+_0x4460de),await setup[_0x46ed3a(0xe8)](_0x5e4b08,_0x4460de,![],!![]);}module['exports']={'updateLocation':updateLocation};