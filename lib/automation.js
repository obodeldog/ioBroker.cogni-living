const a1_0x12e19b=a1_0x30ad;(function(_0xe0b1f0,_0x2b79e4){const _0x3f6c55=a1_0x30ad,_0x3c823b=_0xe0b1f0();while(!![]){try{const _0xe86ba8=parseInt(_0x3f6c55(0xbd))/0x1*(-parseInt(_0x3f6c55(0xfa))/0x2)+parseInt(_0x3f6c55(0xf3))/0x3+parseInt(_0x3f6c55(0x11f))/0x4*(-parseInt(_0x3f6c55(0xfb))/0x5)+-parseInt(_0x3f6c55(0x106))/0x6*(-parseInt(_0x3f6c55(0xb2))/0x7)+parseInt(_0x3f6c55(0x11d))/0x8*(-parseInt(_0x3f6c55(0xda))/0x9)+parseInt(_0x3f6c55(0xe0))/0xa+parseInt(_0x3f6c55(0xc2))/0xb*(parseInt(_0x3f6c55(0x7a))/0xc);if(_0xe86ba8===_0x2b79e4)break;else _0x3c823b['push'](_0x3c823b['shift']());}catch(_0x36c99e){_0x3c823b['push'](_0x3c823b['shift']());}}}(a1_0x2f6a,0xdde8d));const a1_0x5a1711=(function(){let _0x5e5226=!![];return function(_0x442bea,_0x37ac26){const _0x535385=_0x5e5226?function(){const _0x1690fa=a1_0x30ad;if(_0x37ac26){const _0x3c965e=_0x37ac26[_0x1690fa(0x7c)](_0x442bea,arguments);return _0x37ac26=null,_0x3c965e;}}:function(){};return _0x5e5226=![],_0x535385;};}()),a1_0x4acacd=a1_0x5a1711(this,function(){const _0x25e0c0=a1_0x30ad;return a1_0x4acacd[_0x25e0c0(0xa1)]()[_0x25e0c0(0xe6)]('(((.+)+)+)+$')['toString']()['constructor'](a1_0x4acacd)['search'](_0x25e0c0(0xe2));});function a1_0x2f6a(){const _0x206ef6=['2onjfxv','7005085zhmRjU','temperature','reason','write','number','switch','.1.LEVEL','valve','now','local_temperature','event','6xAfhEE','Â°C).\x20Sparmodus\x20beendet!','\x20ist\x20auf\x20','ðŸŽ“\x20[RL-FEEDBACK]\x20Lerne\x20aus\x20Fehler:\x20','sensor','config','remove','stringify','soll','target_temperature','ðŸ“…\x20SMART\x20SCHEDULE\x20(Phase):\x20\x27Globaler\x20Start\x27\x20erkannt.\x20Heize\x20Haus\x20auf\x20(Vorlauf:\x20','value.valve','current_heating_setpoint','PERFECT','normal','trim','analysis.automation.mode','type','Calendar\x20Check\x20Error:\x20','level.valve','PrÃ¤diktion:\x20','SET','_calName','32eQjonb','splice','4cvgGBY','\x20wurde\x20manuell\x20erhÃ¶ht.','valveMapping','[WATCHDOG]\x20','messwert','state','Â°C!\x20(Puffer:\x20','map','.1.ACTUAL_TEMPERATURE','sendToPythonWrapper','info','ACTUAL_TEMPERATURE','\x27\x20(Match:\x20','.1.TEMPERATURE','Nicht\x20gefunden','sort','ðŸ”¥\x20[MPC\x20ACTION]\x20Heize\x20','common','warn','264lLCIOZ','error','apply','Â°C\x20->\x20','Fehlt','\x20durch\x20Kalender\x20geÃ¤ndert.\x20Keine\x20RL-Strafe.','hm-rpc','light','calendarInstance','\x20erreicht\x20Limit\x20(','replace','./ai_agent','summary','ankunft','getForeignObjectsAsync','includes','slice','_date','analysis.automation.confidenceThreshold','location','values','system.mode','stellwert','toUpperCase','.data.table','room','isArray','\x20min).','length','ðŸ§¹\x20[MPC\x20CLEANUP]\x20','cal_','useCalendar','ðŸŒ¬ï¸\x20[MPC\x20WATCHDOG]\x20','Â°C!\x20(Puffer\x20leer).','off','actual','Â°C.','occupied_heating_setpoint','push','toString','getStateAsync','eventStart','getForeignObjectAsync','join','devices','score','\x20gestartet/vorbei.\x20Gebe\x20Raum\x20frei.','toLowerCase','setpoint','Â°C\x20abgesenkt!\x20Zwinge\x20zurÃ¼ck\x20auf\x20','too_cold','rÃ¼ckkehr','dimmer','Â°C\x20(Kalender-Schutz)','calendarSelection','log','11459203Nidzud','getTime','analysis.automation.lastAction','\x20min)','\x20->\x20','\x20->\x20Schalte\x20','forEach','Enforcement\x20Monitor\x20Error:\x20','add','analysis.energy.mpcActiveInterventions','Manuelles\x20Mapping','838177YNHsKZ',':\x20Absenkung\x20auf\x20','\x20wieder\x20auf\x20','thermostat','[CAL]\x20','576158xnNoOL','level','val','Â°C).\x20Entferne\x20Status.','thermostatMapping','analysis.energy.activeEnforcements','[MPC]\x20','Â°C\x20(via\x20','Ist','TRAIN_RL_PENALTY',']:\x20Raum-Trigger\x20\x27','setForeignStateAsync','Soll','window','analysis.energy.ventilationAlerts','active','message','.1.SET_POINT_TEMPERATURE','exports','until','Auto-Erkennung','Unbekannt','ðŸ“…\x20[MPC\x20INFO]\x20','filter','1065321pivnhg','target','findIndex','date','thermostat.setpoint','SET_POINT_TEMPERATURE','3733220tubuBI','level.temperature','(((.+)+)+)+$','[FORCE]\x20','rescue_','minutes_safe','search','parse','ðŸƒ\x20[MPC\x20ACTION]\x20Senke\x20','string','ðŸš¨\x20[MPC\x20WATCHDOG]\x20','find','setStateAsync',':\x20Aufheizen\x20auf\x20','wert','analysis.energy.warmupTimes','split','triggerTime','.4.SET_TEMPERATURE','1376832PUDilW','ðŸš¨\x20[ENFORCEMENT]\x20Hardware-Profil\x20hat\x20','getForeignStateAsync','name','\x20auf\x20','mpc_','set'];a1_0x2f6a=function(){return _0x206ef6;};return a1_0x2f6a();}a1_0x4acacd();'use strict';const aiAgent=require(a1_0x12e19b(0x85)),COOLDOWN_MS=0x3c*0x3e8,CAL_COOLDOWN_MS=0x5a*0x3c*0x3e8,RESCUE_LOCK_MS=0x78*0x3c*0x3e8,ECO_TEMP=0x11,lastActions={};function normalize(_0x459e82){const _0x439e02=a1_0x12e19b;if(!_0x459e82)return'';return _0x459e82[_0x439e02(0xa9)]()[_0x439e02(0x84)](/\s+/g,'')[_0x439e02(0x115)]();}async function logAutomationAction(_0xfca032,_0x138f5e){const _0x28cf43=a1_0x12e19b;await _0xfca032[_0x28cf43(0xec)](_0x28cf43(0xb4),{'val':_0x138f5e,'ack':!![]});try{const _0x234203='analysis.automation.actionLog',_0x5584e9=await _0xfca032[_0x28cf43(0xa2)](_0x234203);let _0x244cc8=[];if(_0x5584e9&&_0x5584e9[_0x28cf43(0xc4)])try{_0x244cc8=JSON['parse'](_0x5584e9[_0x28cf43(0xc4)]);}catch(_0xd48f74){}_0x244cc8['unshift']({'ts':Date[_0x28cf43(0x103)](),'msg':_0x138f5e});if(_0x244cc8[_0x28cf43(0x96)]>0x32)_0x244cc8=_0x244cc8[_0x28cf43(0x8a)](0x0,0x32);await _0xfca032[_0x28cf43(0xec)](_0x234203,{'val':JSON[_0x28cf43(0x10d)](_0x244cc8),'ack':!![]});}catch(_0x286ac3){}}function a1_0x30ad(_0x520084,_0x13a739){const _0x96da1a=a1_0x2f6a();return a1_0x30ad=function(_0x4acacd,_0x5a1711){_0x4acacd=_0x4acacd-0x7a;let _0x2f6a43=_0x96da1a[_0x4acacd];return _0x2f6a43;},a1_0x30ad(_0x520084,_0x13a739);}async function handlePrediction(_0x5f3ca2,_0x66fca1,_0x4f562c){const _0x5e4d7d=a1_0x12e19b;if(!_0x66fca1||_0x66fca1==='Unknown')return;let _0x3baf64=_0x5e4d7d(0x9c),_0x1771f8=0.6;try{const _0x4b3691=await _0x5f3ca2[_0x5e4d7d(0xa2)](_0x5e4d7d(0x116));if(_0x4b3691&&_0x4b3691[_0x5e4d7d(0xc4)])_0x3baf64=_0x4b3691[_0x5e4d7d(0xc4)];const _0x407235=await _0x5f3ca2[_0x5e4d7d(0xa2)](_0x5e4d7d(0x8c));if(_0x407235&&_0x407235[_0x5e4d7d(0xc4)])_0x1771f8=_0x407235[_0x5e4d7d(0xc4)];}catch(_0x137034){}if(_0x3baf64==='off'||_0x4f562c<_0x1771f8)return;const _0x1a65ff=Date[_0x5e4d7d(0x103)]();if(lastActions[_0x66fca1]&&_0x1a65ff-lastActions[_0x66fca1]<COOLDOWN_MS)return;const _0x1d0155=_0x5f3ca2['config'][_0x5e4d7d(0xa6)]||[],_0x27e4fc=normalize(_0x66fca1),_0x3ee6d6=_0x1d0155[_0x5e4d7d(0xeb)](_0x3ec452=>normalize(_0x3ec452[_0x5e4d7d(0x8d)])===_0x27e4fc&&(_0x3ec452['type']===_0x5e4d7d(0x81)||_0x3ec452['type']===_0x5e4d7d(0xae)||_0x3ec452[_0x5e4d7d(0x117)]===_0x5e4d7d(0x100)));if(!_0x3ee6d6)return;const _0x53d0f3=await aiAgent['consultButler'](_0x5f3ca2,_0x66fca1,_0x3ee6d6[_0x5e4d7d(0xf6)],_0x4f562c);if(!_0x53d0f3['approved'])return;const _0x18233f=_0x5e4d7d(0x11a)+_0x66fca1+_0x5e4d7d(0xb7)+_0x3ee6d6[_0x5e4d7d(0xf6)]+'\x20('+_0x53d0f3[_0x5e4d7d(0xfd)]+')';await logAutomationAction(_0x5f3ca2,'['+_0x3baf64[_0x5e4d7d(0x91)]()+']\x20'+_0x18233f);if(_0x3baf64===_0x5e4d7d(0xd1)){const _0x3001c9=await _0x5f3ca2['getForeignStateAsync'](_0x3ee6d6['id']);(!_0x3001c9||!_0x3001c9[_0x5e4d7d(0xc4)]&&_0x3001c9[_0x5e4d7d(0xc4)]!==!![])&&await _0x5f3ca2[_0x5e4d7d(0xcd)](_0x3ee6d6['id'],!![]),lastActions[_0x66fca1]=_0x1a65ff;}}async function findRelatedId(_0x3aabe5,_0x5883e1,_0xb11949=a1_0x12e19b(0xaa)){const _0x151b7f=a1_0x12e19b;if(_0xb11949===_0x151b7f(0xaa)&&_0x3aabe5['config'][_0x151b7f(0xc6)]){let _0x5aa1f2=_0x3aabe5[_0x151b7f(0x10b)][_0x151b7f(0xc6)];if(typeof _0x5aa1f2==='string')try{_0x5aa1f2=JSON[_0x151b7f(0xe7)](_0x5aa1f2);}catch(_0xb9a595){}if(_0x5aa1f2&&_0x5aa1f2[_0x5883e1])return _0x5aa1f2[_0x5883e1];}if(_0xb11949===_0x151b7f(0x102)&&_0x3aabe5[_0x151b7f(0x10b)]['valveMapping']){let _0x80f17e=_0x3aabe5[_0x151b7f(0x10b)][_0x151b7f(0x121)];if(typeof _0x80f17e==='string')try{_0x80f17e=JSON[_0x151b7f(0xe7)](_0x80f17e);}catch(_0x1c85f5){}if(_0x80f17e&&_0x80f17e[_0x5883e1])return _0x80f17e[_0x5883e1];}let _0x7108cb=[];if(_0xb11949==='setpoint')_0x7108cb=[{'s':_0x151b7f(0x127),'t':_0x151b7f(0xd3)},{'s':_0x151b7f(0x12c),'t':_0x151b7f(0xd3)},{'s':'.1.TEMPERATURE','t':_0x151b7f(0xf2)},{'s':_0x151b7f(0x12a),'t':_0x151b7f(0xdf)},{'s':'local_temperature','t':_0x151b7f(0x9f)},{'s':'local_temperature','t':_0x151b7f(0x112)},{'s':_0x151b7f(0xfc),'t':_0x151b7f(0x10f)},{'s':'ACTUAL','t':_0x151b7f(0x11b)},{'s':_0x151b7f(0xca),'t':_0x151b7f(0xce)},{'s':_0x151b7f(0xfc),'t':_0x151b7f(0xaa)}];else _0xb11949===_0x151b7f(0x102)&&(_0x7108cb=[{'s':'.1.ACTUAL_TEMPERATURE','t':_0x151b7f(0x101)},{'s':'.1.TEMPERATURE','t':'.1.LEVEL'},{'s':_0x151b7f(0x12c),'t':'.4.VALVE_STATE'},{'s':_0x151b7f(0x104),'t':'pi_heating_demand'},{'s':_0x151b7f(0xfc),'t':'valve_position'},{'s':_0x151b7f(0xfc),'t':_0x151b7f(0xc3)}]);for(const _0xd6e134 of _0x7108cb){if(_0x5883e1[_0x151b7f(0x89)](_0xd6e134['s'])){const _0x26c8ab=_0x5883e1[_0x151b7f(0x84)](_0xd6e134['s'],_0xd6e134['t']),_0x590b01=await _0x3aabe5[_0x151b7f(0xa4)](_0x26c8ab);if(_0x590b01)return _0x26c8ab;}}try{const _0x5b08c7=_0x5883e1['split']('.');if(_0x5b08c7[_0x151b7f(0x96)]>0x2){const _0x41686a=_0x5b08c7[_0x151b7f(0x8a)](0x0,-0x1)[_0x151b7f(0xa5)]('.'),_0x51a96f=await _0x3aabe5[_0x151b7f(0x88)](_0x41686a+'.*'),_0x5a6659=[],_0x3f7cb4=_0x5883e1[_0x151b7f(0xf0)](/[._]+/)[_0x151b7f(0xd9)](_0x432164=>!['openknx','0',_0x151b7f(0x80),'ist',_0x151b7f(0xee),_0x151b7f(0xfc),_0x151b7f(0x9d),_0x151b7f(0x10a),_0x151b7f(0x123),_0x151b7f(0x124)][_0x151b7f(0x89)](_0x432164[_0x151b7f(0xa9)]()));for(const [_0x3fd3b6,_0x4a3a2d]of Object['entries'](_0x51a96f)){if(_0x3fd3b6===_0x5883e1)continue;if(_0x4a3a2d&&_0x4a3a2d[_0x151b7f(0x130)]){const _0x9aa7ab=_0x3fd3b6[_0x151b7f(0xa9)](),_0x19c5b1=(_0x4a3a2d[_0x151b7f(0x130)]['role']||'')[_0x151b7f(0xa9)](),_0x26e180=(_0x4a3a2d['common']['unit']||'')[_0x151b7f(0xa9)]();let _0x4a3e08=![];if(_0xb11949===_0x151b7f(0xaa)&&_0x4a3a2d[_0x151b7f(0x130)][_0x151b7f(0xfe)]===!![])_0x4a3e08=_0x9aa7ab[_0x151b7f(0x89)](_0x151b7f(0xf9))||_0x9aa7ab['includes'](_0x151b7f(0x10e))||_0x9aa7ab['includes']('target')||_0x19c5b1[_0x151b7f(0x89)](_0x151b7f(0xe1))||_0x19c5b1[_0x151b7f(0x89)](_0x151b7f(0xde));else _0xb11949===_0x151b7f(0x102)&&(_0x4a3e08=_0x9aa7ab['includes'](_0x151b7f(0xc3))||_0x9aa7ab[_0x151b7f(0x89)]('valve')||_0x9aa7ab[_0x151b7f(0x89)](_0x151b7f(0x90))||_0x9aa7ab[_0x151b7f(0x89)]('position')||_0x19c5b1[_0x151b7f(0x89)](_0x151b7f(0x119))||_0x19c5b1[_0x151b7f(0x89)](_0x151b7f(0x111))||_0x26e180['includes']('%'));if(_0x4a3e08){const _0x1322a8=_0x3fd3b6[_0x151b7f(0xf0)](/[._]+/)[_0x151b7f(0x126)](_0x5f13e0=>_0x5f13e0[_0x151b7f(0xa9)]());let _0x4e88fc=0x0;_0x3f7cb4['forEach'](_0x2fd3c3=>{const _0x4a4de4=_0x151b7f;if(_0x1322a8[_0x4a4de4(0x89)](_0x2fd3c3[_0x4a4de4(0xa9)]()))_0x4e88fc++;}),_0x5a6659[_0x151b7f(0xa0)]({'id':_0x3fd3b6,'score':_0x4e88fc});}}}if(_0x5a6659[_0x151b7f(0x96)]>0x0){_0x5a6659[_0x151b7f(0x12e)]((_0x5061d9,_0x2b1662)=>_0x2b1662[_0x151b7f(0xa7)]-_0x5061d9[_0x151b7f(0xa7)]);if(_0x5a6659[0x0]['score']>0x0)return _0x5a6659[0x0]['id'];}}}catch(_0x4a1643){}return null;}async function scanThermostats(_0x17bf65){const _0x2bf3db=a1_0x12e19b,_0x4cfdad=_0x17bf65[_0x2bf3db(0x10b)]['devices']||[],_0x1e8b84=[],_0x3e4b99=_0x4cfdad[_0x2bf3db(0xd9)](_0x52efad=>_0x52efad['id']&&_0x52efad['id'][_0x2bf3db(0x89)](_0x2bf3db(0xfc))||_0x52efad['type']&&[_0x2bf3db(0xfc),_0x2bf3db(0xc0),'sensor'][_0x2bf3db(0x89)](_0x52efad[_0x2bf3db(0x117)])||_0x52efad['name']&&_0x52efad['name'][_0x2bf3db(0xa9)]()['includes']('temp'));for(const _0x36afaa of _0x3e4b99){const _0x52562b=await findRelatedId(_0x17bf65,_0x36afaa['id'],_0x2bf3db(0xaa)),_0x3a5257=await findRelatedId(_0x17bf65,_0x36afaa['id'],_0x2bf3db(0x102));let _0x22f01d=_0x2bf3db(0x12d),_0x12b226=![],_0x3c5da6=_0x17bf65['config'][_0x2bf3db(0xc6)]||{};if(typeof _0x3c5da6===_0x2bf3db(0xe9))try{_0x3c5da6=JSON[_0x2bf3db(0xe7)](_0x3c5da6);}catch(_0x550ef2){}let _0x1751cd=_0x17bf65[_0x2bf3db(0x10b)][_0x2bf3db(0x121)]||{};if(typeof _0x1751cd===_0x2bf3db(0xe9))try{_0x1751cd=JSON['parse'](_0x1751cd);}catch(_0x207050){}if(_0x3c5da6[_0x36afaa['id']]&&_0x3c5da6[_0x36afaa['id']]===_0x52562b||_0x1751cd[_0x36afaa['id']]&&_0x1751cd[_0x36afaa['id']]===_0x3a5257)_0x22f01d=_0x2bf3db(0xbc),_0x12b226=!![];else(_0x52562b||_0x3a5257)&&(_0x22f01d=_0x2bf3db(0xd6));_0x1e8b84[_0x2bf3db(0xa0)]({'room':_0x36afaa[_0x2bf3db(0x8d)]||'Unbekannt','sensorId':_0x36afaa['id'],'setpointId':_0x52562b||'-','valveId':_0x3a5257||'-','source':_0x22f01d,'isManual':_0x12b226,'status':_0x52562b&&_0x3a5257?_0x2bf3db(0x113):_0x52562b?'OK':_0x2bf3db(0x7e)});}return _0x1e8b84[_0x2bf3db(0x12e)]((_0x589440,_0x3638d1)=>_0x589440[_0x2bf3db(0x93)]['localeCompare'](_0x3638d1[_0x2bf3db(0x93)]));}async function updateSchedulePreview(_0x175de3){const _0x3079ad=a1_0x12e19b;if(!_0x175de3[_0x3079ad(0x10b)]['useCalendar']||!_0x175de3[_0x3079ad(0x10b)][_0x3079ad(0x82)])return;let _0x521346={};try{const _0x345208=await _0x175de3[_0x3079ad(0xa2)]('analysis.energy.warmupTimes');if(_0x345208&&_0x345208['val'])_0x521346=JSON[_0x3079ad(0xe7)](_0x345208['val']);}catch(_0x343e25){}const _0x572796=[],_0x190cdf=Date[_0x3079ad(0x103)](),_0x1ca567=0x30*0x3c*0x3c*0x3e8;try{const _0x461e83=await _0x175de3[_0x3079ad(0xf5)](_0x175de3[_0x3079ad(0x10b)][_0x3079ad(0x82)]+_0x3079ad(0x92));if(!_0x461e83||!_0x461e83['val'])return;const _0x536b1f=JSON[_0x3079ad(0xe7)](_0x461e83[_0x3079ad(0xc4)]),_0x23b787=_0x175de3[_0x3079ad(0x10b)]['calendarSelection']||[],_0xdb129d=_0x175de3[_0x3079ad(0x10b)][_0x3079ad(0xa6)]||[],_0x79ab9d=new Set();_0xdb129d[_0x3079ad(0xb8)](_0x1c7761=>{const _0x56fd48=_0x3079ad;if(_0x1c7761[_0x56fd48(0x8d)])_0x79ab9d['add'](_0x1c7761[_0x56fd48(0x8d)]);});for(const _0x507f99 of _0x536b1f){if(_0x507f99[_0x3079ad(0x11c)]&&_0x23b787[_0x3079ad(0x96)]>0x0&&!_0x23b787[_0x3079ad(0x89)](_0x507f99[_0x3079ad(0x11c)]))continue;const _0x4d8be2=_0x507f99['_date']||_0x507f99[_0x3079ad(0xa3)]||_0x507f99[_0x3079ad(0xdd)];if(!_0x4d8be2)continue;const _0xa480a0=new Date(_0x4d8be2),_0x4dda4e=_0xa480a0[_0x3079ad(0xb3)]();if(isNaN(_0x4dda4e))continue;if(_0x4dda4e<_0x190cdf)continue;if(_0x4dda4e>_0x190cdf+_0x1ca567)continue;const _0x118542=(_0x507f99[_0x3079ad(0x105)]||_0x507f99[_0x3079ad(0x86)]||'')[_0x3079ad(0xa9)]();let _0x360a2e=![],_0x5cca14=[],_0x5dc893=_0x507f99['event']||_0x507f99[_0x3079ad(0x86)]||_0x3079ad(0xd7);if(_0x118542[_0x3079ad(0x89)]('urlaub\x20ende')||_0x118542[_0x3079ad(0x89)]('rÃ¼ckkehr')||_0x118542['includes']('ankunft'))_0x360a2e=!![],_0x5cca14=Array['from'](_0x79ab9d);else for(const _0x2ac00e of _0x79ab9d){if(_0x118542['includes'](_0x2ac00e[_0x3079ad(0xa9)]()))_0x5cca14['push'](_0x2ac00e);}_0x5cca14[_0x3079ad(0x96)]>0x0&&_0x5cca14[_0x3079ad(0xb8)](_0x1fae36=>{const _0x33c748=_0x3079ad;let _0x434673=0x3c;if(_0x360a2e){let _0x2c37c5=0x0;Object[_0x33c748(0x8e)](_0x521346)[_0x33c748(0xb8)](_0x4235b6=>{if(_0x4235b6>_0x2c37c5)_0x2c37c5=_0x4235b6;}),_0x434673=_0x2c37c5>0x0?_0x2c37c5:0x78;}else _0x434673=_0x521346[_0x1fae36]||0x3c;const _0x3cc32f=new Date(_0x4dda4e-_0x434673*0xea60);_0x572796[_0x33c748(0xa0)]({'eventTime':_0x4dda4e,'triggerTime':_0x3cc32f['getTime'](),'room':_0x1fae36,'minutes':_0x434673,'reason':_0x5dc893,'isGlobal':_0x360a2e});});}}catch(_0x3e958c){}_0x572796[_0x3079ad(0x12e)]((_0x2b3d60,_0x581835)=>_0x2b3d60['triggerTime']-_0x581835[_0x3079ad(0xf1)]);const _0x16b60a=_0x572796[_0x3079ad(0x8a)](0x0,0x5);await _0x175de3['setStateAsync']('analysis.energy.schedulePreview',{'val':JSON[_0x3079ad(0x10d)](_0x16b60a),'ack':!![]});}async function monitorEnforcements(_0x38d311){const _0x51bd83=a1_0x12e19b;try{const _0x3af6d5='analysis.energy.activeEnforcements',_0x16a235=await _0x38d311[_0x51bd83(0xa2)](_0x3af6d5);if(!_0x16a235||!_0x16a235[_0x51bd83(0xc4)])return;let _0x131020=[];try{_0x131020=JSON[_0x51bd83(0xe7)](_0x16a235[_0x51bd83(0xc4)]);}catch(_0x43057d){return;}if(!Array[_0x51bd83(0x94)](_0x131020)||_0x131020[_0x51bd83(0x96)]===0x0)return;const _0x2c9dba=Date['now'](),_0x315aa6=_0x38d311[_0x51bd83(0x10b)][_0x51bd83(0xa6)]||[];let _0x325f63=![];for(let _0x40ffe3=_0x131020['length']-0x1;_0x40ffe3>=0x0;_0x40ffe3--){const _0x5d6797=_0x131020[_0x40ffe3];if(_0x2c9dba>=_0x5d6797[_0x51bd83(0xd5)]){_0x38d311[_0x51bd83(0xb1)][_0x51bd83(0x129)]('ðŸ“…\x20[ENFORCEMENT]\x20Kalender-Event\x20in\x20'+_0x5d6797[_0x51bd83(0x93)]+_0x51bd83(0xa8)),_0x131020['splice'](_0x40ffe3,0x1),_0x325f63=!![];continue;}const _0x3c88cd=_0x315aa6[_0x51bd83(0xeb)](_0x28b3b9=>normalize(_0x28b3b9[_0x51bd83(0x8d)])===normalize(_0x5d6797[_0x51bd83(0x93)])&&(_0x28b3b9[_0x51bd83(0x117)]===_0x51bd83(0xfc)||_0x28b3b9['type']===_0x51bd83(0xc0)));if(_0x3c88cd){const _0xfa3d03=await findRelatedId(_0x38d311,_0x3c88cd['id'],_0x51bd83(0xaa));if(_0xfa3d03){const _0x582e2a=await _0x38d311['getForeignStateAsync'](_0xfa3d03);_0x582e2a&&typeof _0x582e2a[_0x51bd83(0xc4)]===_0x51bd83(0xff)&&(_0x582e2a[_0x51bd83(0xc4)]<0xf&&(_0x38d311['log'][_0x51bd83(0x131)](_0x51bd83(0xf4)+_0x5d6797[_0x51bd83(0x93)]+_0x51bd83(0xf7)+_0x582e2a[_0x51bd83(0xc4)]+_0x51bd83(0xab)+_0x5d6797[_0x51bd83(0xdb)]+_0x51bd83(0x9e)),await _0x38d311[_0x51bd83(0xcd)](_0xfa3d03,_0x5d6797[_0x51bd83(0xdb)]),await logAutomationAction(_0x38d311,_0x51bd83(0xe3)+_0x5d6797['room']+':\x20'+_0x582e2a[_0x51bd83(0xc4)]+_0x51bd83(0x7d)+_0x5d6797['target']+_0x51bd83(0xaf))));}}}_0x325f63&&await _0x38d311['setStateAsync'](_0x3af6d5,{'val':JSON[_0x51bd83(0x10d)](_0x131020),'ack':!![]});}catch(_0xcded29){_0x38d311[_0x51bd83(0xb1)][_0x51bd83(0x7b)](_0x51bd83(0xb9)+_0xcded29['message']);}}async function checkCalendarTriggers(_0xdf6ccc){const _0x413328=a1_0x12e19b;if(!_0xdf6ccc[_0x413328(0x10b)][_0x413328(0x99)]||!_0xdf6ccc[_0x413328(0x10b)][_0x413328(0x82)])return;await updateSchedulePreview(_0xdf6ccc);let _0x1cdf18={},_0x1c186f={};try{const _0x5adb1f=await _0xdf6ccc['getStateAsync'](_0x413328(0xef));if(_0x5adb1f&&_0x5adb1f[_0x413328(0xc4)])_0x1cdf18=JSON['parse'](_0x5adb1f['val']);const _0x5f5173=await _0xdf6ccc[_0x413328(0xa2)]('analysis.energy.warmupSources');if(_0x5f5173&&_0x5f5173[_0x413328(0xc4)])_0x1c186f=JSON[_0x413328(0xe7)](_0x5f5173[_0x413328(0xc4)]);}catch(_0x4eb955){}let _0x4dc36a={'default':0x15};try{const _0x3fd082=await _0xdf6ccc[_0x413328(0xa2)]('analysis.energy.warmupTargets');if(_0x3fd082&&_0x3fd082[_0x413328(0xc4)])_0x4dc36a=JSON['parse'](_0x3fd082['val']);}catch(_0x2d93d9){}let _0x23eba4=[];try{const _0x293996=await _0xdf6ccc['getStateAsync'](_0x413328(0xc7));if(_0x293996&&_0x293996[_0x413328(0xc4)])_0x23eba4=JSON['parse'](_0x293996[_0x413328(0xc4)]);}catch(_0x11aecc){}try{const _0x2b0660=await _0xdf6ccc[_0x413328(0xf5)](_0xdf6ccc[_0x413328(0x10b)][_0x413328(0x82)]+_0x413328(0x92));if(!_0x2b0660||!_0x2b0660[_0x413328(0xc4)])return;const _0x3ae347=JSON[_0x413328(0xe7)](_0x2b0660['val']),_0x428244=Date[_0x413328(0x103)](),_0x1b06c1=_0xdf6ccc['config'][_0x413328(0xa6)]||[],_0x1ef309=_0xdf6ccc['config'][_0x413328(0xb0)]||[];let _0x20bc83=![];for(const _0x1fc56e of _0x3ae347){if(_0x1fc56e['_calName']&&_0x1ef309[_0x413328(0x96)]>0x0&&!_0x1ef309['includes'](_0x1fc56e[_0x413328(0x11c)]))continue;const _0x31f4b0=_0x1fc56e[_0x413328(0x8b)]||_0x1fc56e[_0x413328(0xa3)]||_0x1fc56e['date'];if(!_0x31f4b0)continue;const _0x5d7175=new Date(_0x31f4b0);if(isNaN(_0x5d7175['getTime']()))continue;const _0x4a1bde=(_0x1fc56e[_0x413328(0x105)]||_0x1fc56e[_0x413328(0x86)]||'')[_0x413328(0xa9)]();if(_0x4a1bde[_0x413328(0x89)]('urlaub\x20ende')||_0x4a1bde['includes'](_0x413328(0xad))||_0x4a1bde[_0x413328(0x89)](_0x413328(0x87))){let _0xce0f84=0x0;Object[_0x413328(0x8e)](_0x1cdf18)[_0x413328(0xb8)](_0x427b24=>{if(_0x427b24>_0xce0f84)_0xce0f84=_0x427b24;});if(_0xce0f84===0x0)_0xce0f84=0x78;const _0x65b6f1=_0x5d7175['getTime']()-_0xce0f84*0xea60;_0x428244>=_0x65b6f1&&_0x428244<_0x5d7175['getTime']()&&(_0xdf6ccc['currentSystemMode']!=='normal'&&(_0xdf6ccc[_0x413328(0xb1)]['info'](_0x413328(0x110)+_0xce0f84+_0x413328(0x95)),await _0xdf6ccc[_0x413328(0xec)](_0x413328(0x8f),{'val':_0x413328(0x114),'ack':![]})));}for(const _0x41aca1 of _0x1b06c1){if(_0x41aca1[_0x413328(0x8d)]){const _0x489c1e=_0x41aca1[_0x413328(0x8d)][_0x413328(0xa9)](),_0x164e56=(_0x41aca1[_0x413328(0xf6)]||'')[_0x413328(0xa9)]();let _0x34de09=_0x4a1bde['includes'](_0x489c1e);!_0x34de09&&_0x164e56[_0x413328(0x96)]>0x3&&_0x4a1bde[_0x413328(0x89)](_0x164e56)&&(_0x34de09=!![]);if(_0x34de09){const _0x2f8da8=_0x1cdf18[_0x41aca1[_0x413328(0x8d)]]||0x3c,_0x5dac1c=_0x1c186f[_0x41aca1[_0x413328(0x8d)]]||'Classic',_0xcd0b5d=_0x5d7175[_0x413328(0xb3)]()-_0x2f8da8*0xea60;if(_0x428244>=_0xcd0b5d&&_0x428244<_0x5d7175[_0x413328(0xb3)]()){const _0x3f6c95=lastActions[_0x413328(0x98)+_0x41aca1[_0x413328(0x8d)]];if(_0x3f6c95&&_0x428244-_0x3f6c95<CAL_COOLDOWN_MS)continue;const _0x1bd88d=await findRelatedId(_0xdf6ccc,_0x41aca1['id'],'setpoint');if(_0x1bd88d){let _0x2237c8=_0x4dc36a[_0x41aca1[_0x413328(0x8d)]];if(_0x2237c8===undefined)_0x2237c8=_0x4dc36a['default'];if(_0x2237c8===undefined)_0x2237c8=0x15;const _0x16aa51=await _0xdf6ccc[_0x413328(0xf5)](_0x1bd88d);if(_0x16aa51&&typeof _0x16aa51['val']===_0x413328(0xff)&&_0x16aa51['val']<_0x2237c8-0.5){_0xdf6ccc[_0x413328(0xb1)][_0x413328(0x129)]('ðŸ“…\x20SMART\x20SCHEDULE\x20['+_0x5dac1c+_0x413328(0xcc)+_0x41aca1['location']+_0x413328(0x12b)+_0x4a1bde+')\x20aktiv.\x20Heize\x20auf\x20'+_0x2237c8+'Â°C\x20(Vorlauf:\x20'+_0x2f8da8+_0x413328(0x95)),await _0xdf6ccc[_0x413328(0xcd)](_0x1bd88d,_0x2237c8),await logAutomationAction(_0xdf6ccc,_0x413328(0xc1)+_0x41aca1[_0x413328(0x8d)]+_0x413328(0xb6)+_0x2237c8+_0x413328(0xc9)+_0x5dac1c+')'),lastActions[_0x413328(0x98)+_0x41aca1[_0x413328(0x8d)]]=_0x428244;const _0x3eb5f7=_0x23eba4[_0x413328(0xdc)](_0x293d15=>_0x293d15[_0x413328(0x93)]===_0x41aca1['location']);if(_0x3eb5f7!==-0x1)_0x23eba4[_0x413328(0x11e)](_0x3eb5f7,0x1);_0x23eba4[_0x413328(0xa0)]({'room':_0x41aca1[_0x413328(0x8d)],'target':_0x2237c8,'until':_0x5d7175[_0x413328(0xb3)]()}),_0x20bc83=!![];}}}}}}}_0x20bc83&&await _0xdf6ccc[_0x413328(0xec)]('analysis.energy.activeEnforcements',{'val':JSON[_0x413328(0x10d)](_0x23eba4),'ack':!![]});}catch(_0x1f59c5){_0xdf6ccc[_0x413328(0xb1)][_0x413328(0x131)](_0x413328(0x118)+_0x1f59c5[_0x413328(0xd2)]);}}async function manageMpcIntervention(_0x1bd27c,_0x541500,_0x4cc5d){const _0x3dbf78=a1_0x12e19b;try{const _0x460207=_0x3dbf78(0xbb),_0xf29e5=await _0x1bd27c['getStateAsync'](_0x460207);let _0x27745b=[];if(_0xf29e5&&_0xf29e5[_0x3dbf78(0xc4)])try{_0x27745b=JSON[_0x3dbf78(0xe7)](_0xf29e5[_0x3dbf78(0xc4)]);}catch(_0x40891f){}const _0x4d5717=_0x27745b['indexOf'](_0x541500);if(_0x4cc5d===_0x3dbf78(0xba))_0x4d5717===-0x1&&(_0x27745b['push'](_0x541500),await _0x1bd27c[_0x3dbf78(0xec)](_0x460207,{'val':JSON[_0x3dbf78(0x10d)](_0x27745b),'ack':!![]}));else _0x4cc5d===_0x3dbf78(0x10c)&&(_0x4d5717!==-0x1&&(_0x27745b[_0x3dbf78(0x11e)](_0x4d5717,0x1),await _0x1bd27c[_0x3dbf78(0xec)](_0x460207,{'val':JSON[_0x3dbf78(0x10d)](_0x27745b),'ack':!![]})));}catch(_0x3ca450){}}async function cleanupGhostInterventions(_0x8d6fbb){const _0x3a4b7d=a1_0x12e19b;try{const _0x105a2f=_0x3a4b7d(0xbb),_0x4521bc=await _0x8d6fbb[_0x3a4b7d(0xa2)](_0x105a2f);if(!_0x4521bc||!_0x4521bc[_0x3a4b7d(0xc4)])return;const _0x24d7a8=JSON[_0x3a4b7d(0xe7)](_0x4521bc[_0x3a4b7d(0xc4)]);if(!Array[_0x3a4b7d(0x94)](_0x24d7a8)||_0x24d7a8[_0x3a4b7d(0x96)]===0x0)return;let _0x40ffc3={'default':0x15};try{const _0x599b5d=await _0x8d6fbb[_0x3a4b7d(0xa2)]('analysis.energy.warmupTargets');if(_0x599b5d&&_0x599b5d[_0x3a4b7d(0xc4)])_0x40ffc3=JSON[_0x3a4b7d(0xe7)](_0x599b5d[_0x3a4b7d(0xc4)]);}catch(_0x2118db){}let _0x10fd60=[];try{const _0x16c06e=await _0x8d6fbb['getStateAsync'](_0x3a4b7d(0xd0));if(_0x16c06e&&_0x16c06e['val'])_0x10fd60=JSON[_0x3a4b7d(0xe7)](_0x16c06e[_0x3a4b7d(0xc4)]);}catch(_0x18e2dd){}const _0x3f1e56=_0x8d6fbb['config']['devices']||[];let _0x256cc7=![];for(let _0x5805f3=_0x24d7a8[_0x3a4b7d(0x96)]-0x1;_0x5805f3>=0x0;_0x5805f3--){const _0x3b51e0=_0x24d7a8[_0x5805f3],_0x1e34d1=_0x3f1e56['find'](_0x57dbbe=>normalize(_0x57dbbe['location'])===normalize(_0x3b51e0)&&(_0x57dbbe[_0x3a4b7d(0x117)]===_0x3a4b7d(0xfc)||_0x57dbbe[_0x3a4b7d(0x117)]===_0x3a4b7d(0xc0)));if(!_0x1e34d1){_0x8d6fbb[_0x3a4b7d(0xb1)]['warn']('ðŸ§¹\x20[MPC\x20CLEANUP]\x20Raum\x20\x27'+_0x3b51e0+'\x27\x20hat\x20kein\x20GerÃ¤t\x20mehr.\x20LÃ¶sche\x20Eintrag.'),_0x24d7a8[_0x3a4b7d(0x11e)](_0x5805f3,0x1),_0x256cc7=!![];continue;}if(_0x1e34d1){const _0x3930e5=await findRelatedId(_0x8d6fbb,_0x1e34d1['id'],'setpoint'),_0x1730f2=await _0x8d6fbb[_0x3a4b7d(0xf5)](_0x1e34d1['id']);if(_0x3930e5){const _0x373f6f=await _0x8d6fbb[_0x3a4b7d(0xf5)](_0x3930e5);if(_0x373f6f&&typeof _0x373f6f[_0x3a4b7d(0xc4)]===_0x3a4b7d(0xff)){let _0x54642b=![],_0x770542='';Math['abs'](_0x373f6f['val']-ECO_TEMP)>0.5&&(_0x54642b=!![],_0x770542='manual');if(!_0x54642b&&_0x1730f2&&typeof _0x1730f2[_0x3a4b7d(0xc4)]===_0x3a4b7d(0xff)){const _0x3c170e=_0x40ffc3[_0x3b51e0]||_0x40ffc3['default']||0x15;_0x1730f2['val']<_0x3c170e+0.2&&(_0x54642b=!![],_0x770542=_0x3a4b7d(0xac));}if(_0x54642b){if(_0x770542==='manual'){_0x8d6fbb['log'][_0x3a4b7d(0x129)](_0x3a4b7d(0x97)+_0x3b51e0+_0x3a4b7d(0x108)+_0x373f6f[_0x3a4b7d(0xc4)]+'Â°C\x20(nicht\x20'+ECO_TEMP+_0x3a4b7d(0xc5));const _0x272dd7=lastActions[_0x3a4b7d(0x98)+_0x3b51e0],_0x711e79=_0x272dd7&&Date[_0x3a4b7d(0x103)]()-_0x272dd7<0x2*0x3c*0x3e8;if(!_0x711e79&&_0x373f6f['val']>ECO_TEMP+0.5)_0x8d6fbb[_0x3a4b7d(0x128)]&&(_0x8d6fbb[_0x3a4b7d(0xb1)][_0x3a4b7d(0x129)](_0x3a4b7d(0x109)+_0x3b51e0+_0x3a4b7d(0x120)),_0x8d6fbb[_0x3a4b7d(0x128)](_0x3a4b7d(0xcb),{'room':_0x3b51e0}));else _0x711e79&&_0x8d6fbb[_0x3a4b7d(0xb1)]['info'](_0x3a4b7d(0xd8)+_0x3b51e0+_0x3a4b7d(0x7f));}else{if(_0x770542===_0x3a4b7d(0xac)){let _0x28c17c=![];if(_0x10fd60[_0x3a4b7d(0xeb)](_0x417a9c=>_0x417a9c['room']===_0x3b51e0))_0x28c17c=!![];const _0x19992e=_0x3f1e56[_0x3a4b7d(0xd9)](_0x55dc37=>normalize(_0x55dc37[_0x3a4b7d(0x8d)])===normalize(_0x3b51e0)&&(_0x55dc37[_0x3a4b7d(0x117)]===_0x3a4b7d(0xcf)||_0x55dc37['type']===_0x3a4b7d(0x10a)||_0x55dc37[_0x3a4b7d(0x117)]==='contact'));for(const _0x241285 of _0x19992e){try{const _0x327cb9=await _0x8d6fbb[_0x3a4b7d(0xf5)](_0x241285['id']);if(_0x327cb9&&(_0x327cb9[_0x3a4b7d(0xc4)]===!![]||_0x327cb9[_0x3a4b7d(0xc4)]===0x1||String(_0x327cb9[_0x3a4b7d(0xc4)])[_0x3a4b7d(0xa9)]()==='open'))_0x28c17c=!![];}catch(_0x52de15){}}if(_0x28c17c)_0x8d6fbb[_0x3a4b7d(0xb1)]['info'](_0x3a4b7d(0x9a)+_0x3b51e0+'\x20ist\x20zu\x20kalt,\x20ABER\x20Fenster\x20offen/LÃ¼ftung\x20erkannt.\x20Heize\x20NICHT,\x20entferne\x20nur\x20Status.');else{const _0x29fc34=_0x40ffc3[_0x3b51e0]||_0x40ffc3['default']||0x15;_0x8d6fbb[_0x3a4b7d(0xb1)][_0x3a4b7d(0x129)](_0x3a4b7d(0xea)+_0x3b51e0+_0x3a4b7d(0x83)+_0x1730f2[_0x3a4b7d(0xc4)]+'Â°C\x20<\x20'+(_0x29fc34+0.2)+_0x3a4b7d(0x107)),await _0x8d6fbb[_0x3a4b7d(0xcd)](_0x3930e5,_0x29fc34),await logAutomationAction(_0x8d6fbb,_0x3a4b7d(0x122)+_0x3b51e0+':\x20Puffer\x20leer\x20->\x20Heizen\x20auf\x20'+_0x29fc34+'Â°C'),lastActions['rescue_'+_0x3b51e0]=Date[_0x3a4b7d(0x103)]();}}}_0x24d7a8[_0x3a4b7d(0x11e)](_0x5805f3,0x1),_0x256cc7=!![];}}}}}_0x256cc7&&await _0x8d6fbb['setStateAsync'](_0x105a2f,{'val':JSON['stringify'](_0x24d7a8),'ack':!![]});}catch(_0x6a3dbf){}}async function applyEnergySavings(_0x51ddb7,_0x49b358){const _0x2235da=a1_0x12e19b;await cleanupGhostInterventions(_0x51ddb7);if(!_0x49b358||_0x49b358[_0x2235da(0x96)]===0x0)return;const _0x17e784=_0x51ddb7['config'][_0x2235da(0xa6)]||[],_0x294ac5=Date['now']();for(const _0x50087e of _0x49b358){const _0x332eca=_0x50087e[_0x2235da(0x93)],_0x272e22=_0x50087e[_0x2235da(0xe5)],_0x247f0a=_0x50087e[_0x2235da(0xdb)]||0x15;if(lastActions[_0x2235da(0xe4)+_0x332eca]&&_0x294ac5-lastActions[_0x2235da(0xe4)+_0x332eca]<RESCUE_LOCK_MS)continue;const _0xe3fc1c=_0x17e784[_0x2235da(0xeb)](_0x1ba267=>normalize(_0x1ba267[_0x2235da(0x8d)])===normalize(_0x332eca)&&(_0x1ba267[_0x2235da(0x117)]===_0x2235da(0xfc)||_0x1ba267[_0x2235da(0x117)]===_0x2235da(0xc0)));if(!_0xe3fc1c)continue;const _0x3da398=await findRelatedId(_0x51ddb7,_0xe3fc1c['id'],_0x2235da(0xaa));if(_0x3da398){if(lastActions[_0x2235da(0xf8)+_0x332eca]&&_0x294ac5-lastActions[_0x2235da(0xf8)+_0x332eca]<0x1e*0x3c*0x3e8)continue;const _0x437a0=await _0x51ddb7[_0x2235da(0xf5)](_0x3da398);if(_0x437a0&&typeof _0x437a0[_0x2235da(0xc4)]==='number'){const _0x2afdc5=_0x437a0[_0x2235da(0xc4)];_0x2afdc5!==ECO_TEMP&&await manageMpcIntervention(_0x51ddb7,_0x332eca,_0x2235da(0x10c));if(_0x272e22>0x1e)_0x2afdc5>ECO_TEMP+0.5&&(_0x51ddb7[_0x2235da(0xb1)][_0x2235da(0x129)](_0x2235da(0xe8)+_0x332eca+'\x20auf\x20'+ECO_TEMP+_0x2235da(0x125)+_0x272e22+_0x2235da(0xb5)),await _0x51ddb7[_0x2235da(0xcd)](_0x3da398,ECO_TEMP),await manageMpcIntervention(_0x51ddb7,_0x332eca,_0x2235da(0xba)),lastActions[_0x2235da(0xf8)+_0x332eca]=_0x294ac5,await logAutomationAction(_0x51ddb7,_0x2235da(0xc8)+_0x332eca+_0x2235da(0xbe)+ECO_TEMP+'Â°C'));else _0x272e22<=0xf&&(_0x2afdc5<_0x247f0a&&(_0x51ddb7[_0x2235da(0xb1)][_0x2235da(0x129)](_0x2235da(0x12f)+_0x332eca+_0x2235da(0xbf)+_0x247f0a+_0x2235da(0x9b)),await _0x51ddb7['setForeignStateAsync'](_0x3da398,_0x247f0a),await manageMpcIntervention(_0x51ddb7,_0x332eca,_0x2235da(0x10c)),lastActions['mpc_'+_0x332eca]=_0x294ac5,await logAutomationAction(_0x51ddb7,_0x2235da(0xc8)+_0x332eca+_0x2235da(0xed)+_0x247f0a+'Â°C')));}}else _0x51ddb7[_0x2235da(0xb1)][_0x2235da(0x131)]('[MPC\x20WARNING]\x20Kein\x20Setpoint\x20fÃ¼r\x20'+_0x332eca+'\x20gefunden!');}}module[a1_0x12e19b(0xd4)]={'handlePrediction':handlePrediction,'applyEnergySavings':applyEnergySavings,'scanThermostats':scanThermostats,'checkCalendarTriggers':checkCalendarTriggers,'monitorEnforcements':monitorEnforcements,'updateSchedulePreview':updateSchedulePreview,'cleanupGhostInterventions':cleanupGhostInterventions};