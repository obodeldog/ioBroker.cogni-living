const a1_0xebff04=a1_0x4310;(function(_0x445103,_0x51fadf){const _0x253172=a1_0x4310,_0x49543b=_0x445103();while(!![]){try{const _0x36825e=parseInt(_0x253172(0x144))/0x1*(parseInt(_0x253172(0x121))/0x2)+-parseInt(_0x253172(0x130))/0x3+parseInt(_0x253172(0x123))/0x4*(-parseInt(_0x253172(0x11d))/0x5)+parseInt(_0x253172(0x12c))/0x6+parseInt(_0x253172(0x11f))/0x7+-parseInt(_0x253172(0x139))/0x8+-parseInt(_0x253172(0x13a))/0x9*(-parseInt(_0x253172(0x13d))/0xa);if(_0x36825e===_0x51fadf)break;else _0x49543b['push'](_0x49543b['shift']());}catch(_0x32ab18){_0x49543b['push'](_0x49543b['shift']());}}}(a1_0x5c75,0xdd4e7));const a1_0x3f602f=(function(){let _0x4616e5=!![];return function(_0x180d49,_0x1b8dc5){const _0x161395=_0x4616e5?function(){if(_0x1b8dc5){const _0x3f36bc=_0x1b8dc5['apply'](_0x180d49,arguments);return _0x1b8dc5=null,_0x3f36bc;}}:function(){};return _0x4616e5=![],_0x161395;};}()),a1_0x47f70a=a1_0x3f602f(this,function(){const _0x40a000=a1_0x4310;return a1_0x47f70a[_0x40a000(0x13b)]()[_0x40a000(0x118)](_0x40a000(0x11e))['toString']()['constructor'](a1_0x47f70a)[_0x40a000(0x118)]('(((.+)+)+)+$');});a1_0x47f70a();function a1_0x4310(_0x56d8f2,_0x10f538){const _0x10b92d=a1_0x5c75();return a1_0x4310=function(_0x47f70a,_0x3f602f){_0x47f70a=_0x47f70a-0x113;let _0x5c750c=_0x10b92d[_0x47f70a];return _0x5c750c;},a1_0x4310(_0x56d8f2,_0x10f538);}function a1_0x5c75(){const _0x168f65=['config','SET_POINT_TEMPERATURE','val','off','find','12295664hMnQvQ','289017PVshPx','toString','ACTUAL_TEMPERATURE','1010TbfioD','üçÉ\x20MPC\x20Autonomy:\x20Senke\x20','.1.ACTUAL_TEMPERATURE','toLowerCase','getStateAsync','replace','name','504934OTgtOm','setForeignStateAsync','¬∞C\x20(Coasting\x20m√∂glich:\x20','location','log','debug','search','devices','.1.TEMPERATURE','[MPC]\x20','approved','255qxVoBP','(((.+)+)+)+$','2358265DYTNpm','üîç\x20Device-Search\x20failed\x20for\x20predicted\x20room\x20\x27','4bcygmv','\x20min)','52924HuvJIZ','getForeignStateAsync','mpc_',':\x20-1¬∞C\x20(Sparpotenzial\x20genutzt)','dimmer','.1.SET_POINT_TEMPERATURE','analysis.automation.mode','exports','reason','695280GGFdde','setStateAsync','now','light','4763538UhTGDh','type','Pr√§diktion:\x20','getForeignObjectAsync'];a1_0x5c75=function(){return _0x168f65;};return a1_0x5c75();}'use strict';const aiAgent=require('./ai_agent'),COOLDOWN_MS=0x3c*0x3e8,lastActions={};function normalize(_0x16f584){const _0x46e115=a1_0x4310;if(!_0x16f584)return'';return _0x16f584[_0x46e115(0x140)]()[_0x46e115(0x142)](/\s+/g,'')['trim']();}async function handlePrediction(_0x40d8af,_0x580e93,_0x525237){const _0x23907d=a1_0x4310;if(!_0x580e93||_0x580e93==='Unknown')return;let _0x2f0226=_0x23907d(0x137),_0x44bf9b=0.6;try{const _0x2a44a9=await _0x40d8af[_0x23907d(0x141)](_0x23907d(0x129));if(_0x2a44a9&&_0x2a44a9[_0x23907d(0x136)])_0x2f0226=_0x2a44a9['val'];const _0x2adc8c=await _0x40d8af['getStateAsync']('analysis.automation.confidenceThreshold');if(_0x2adc8c&&_0x2adc8c['val'])_0x44bf9b=_0x2adc8c[_0x23907d(0x136)];}catch(_0x57be41){}if(_0x2f0226===_0x23907d(0x137)||_0x525237<_0x44bf9b)return;const _0x3d0828=Date[_0x23907d(0x12e)]();if(lastActions[_0x580e93]&&_0x3d0828-lastActions[_0x580e93]<COOLDOWN_MS)return;const _0x2d8099=_0x40d8af[_0x23907d(0x134)][_0x23907d(0x119)]||[],_0x5dbf96=normalize(_0x580e93),_0x5c8f26=_0x2d8099[_0x23907d(0x138)](_0x3a8ece=>normalize(_0x3a8ece[_0x23907d(0x115)])===_0x5dbf96&&(_0x3a8ece['type']===_0x23907d(0x12f)||_0x3a8ece['type']===_0x23907d(0x127)||_0x3a8ece[_0x23907d(0x131)]==='switch'));if(!_0x5c8f26){_0x40d8af[_0x23907d(0x116)][_0x23907d(0x117)](_0x23907d(0x120)+_0x580e93+'\x27.');return;}const _0x338945=await aiAgent['consultButler'](_0x40d8af,_0x580e93,_0x5c8f26[_0x23907d(0x143)],_0x525237);if(!_0x338945[_0x23907d(0x11c)])return;const _0x7fcc6e=_0x23907d(0x132)+_0x580e93+'\x20->\x20Schalte\x20'+_0x5c8f26[_0x23907d(0x143)]+'\x20('+_0x338945[_0x23907d(0x12b)]+')';await _0x40d8af[_0x23907d(0x12d)]('analysis.automation.lastAction',{'val':'['+_0x2f0226['toUpperCase']()+']\x20'+_0x7fcc6e,'ack':!![]});if(_0x2f0226==='active'){const _0x4483ef=await _0x40d8af[_0x23907d(0x124)](_0x5c8f26['id']);(!_0x4483ef||!_0x4483ef[_0x23907d(0x136)]&&_0x4483ef['val']!==!![])&&await _0x40d8af[_0x23907d(0x113)](_0x5c8f26['id'],!![]),lastActions[_0x580e93]=_0x3d0828;}}async function applyEnergySavings(_0xa9e90a,_0x1b8b03){const _0x14f2d3=a1_0x4310,_0x10174c=_0xa9e90a[_0x14f2d3(0x134)][_0x14f2d3(0x119)]||[];for(const _0x2e20de of _0x1b8b03){const _0x471965=_0x2e20de['room'],_0x5e97ef=_0x2e20de['minutes_safe'],_0x5296f9=Date['now']();if(lastActions[_0x14f2d3(0x125)+_0x471965]&&_0x5296f9-lastActions[_0x14f2d3(0x125)+_0x471965]<0x1e*0x3c*0x3e8)continue;const _0x47e71c=_0x10174c[_0x14f2d3(0x138)](_0x40ac59=>normalize(_0x40ac59[_0x14f2d3(0x115)])===normalize(_0x471965));if(!_0x47e71c)continue;const _0x4a9dd8=_0x47e71c['id'];let _0x4d27e5=null;const _0x250d5e=[_0x4a9dd8[_0x14f2d3(0x142)](_0x14f2d3(0x13f),_0x14f2d3(0x128)),_0x4a9dd8[_0x14f2d3(0x142)](_0x14f2d3(0x11a),'.4.SET_TEMPERATURE'),_0x4a9dd8[_0x14f2d3(0x142)](_0x14f2d3(0x13c),_0x14f2d3(0x135))];for(const _0x473fec of _0x250d5e){const _0x4d03ca=await _0xa9e90a[_0x14f2d3(0x133)](_0x473fec);if(_0x4d03ca){_0x4d27e5=_0x473fec;break;}}if(_0x4d27e5){const _0x382150=await _0xa9e90a['getForeignStateAsync'](_0x4d27e5);if(_0x382150&&typeof _0x382150[_0x14f2d3(0x136)]==='number'){const _0x1a0ab6=_0x382150[_0x14f2d3(0x136)];if(_0x5e97ef>0x1e&&_0x1a0ab6>0x11){const _0x4eaca6=_0x1a0ab6-0x1;_0xa9e90a[_0x14f2d3(0x116)]['info'](_0x14f2d3(0x13e)+_0x471965+'\x20('+_0x4d27e5+')\x20auf\x20'+_0x4eaca6+_0x14f2d3(0x114)+_0x5e97ef+_0x14f2d3(0x122)),await _0xa9e90a['setForeignStateAsync'](_0x4d27e5,_0x4eaca6),lastActions['mpc_'+_0x471965]=_0x5296f9,await _0xa9e90a[_0x14f2d3(0x12d)]('analysis.automation.lastAction',{'val':_0x14f2d3(0x11b)+_0x471965+_0x14f2d3(0x126),'ack':!![]});}}}}}module[a1_0xebff04(0x12a)]={'handlePrediction':handlePrediction,'applyEnergySavings':applyEnergySavings};