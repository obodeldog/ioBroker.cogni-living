function a1_0x52a9(_0x4bdb18,_0x5bc31f){const _0x11d931=a1_0x3d81();return a1_0x52a9=function(_0x9b6a91,_0x339225){_0x9b6a91=_0x9b6a91-0x1d5;let _0x3d8108=_0x11d931[_0x9b6a91];return _0x3d8108;},a1_0x52a9(_0x4bdb18,_0x5bc31f);}const a1_0x3f05e8=a1_0x52a9;(function(_0x28fdfd,_0x1e5ad9){const _0x15d2e1=a1_0x52a9,_0x527d75=_0x28fdfd();while(!![]){try{const _0x7cf654=-parseInt(_0x15d2e1(0x20f))/0x1+parseInt(_0x15d2e1(0x277))/0x2*(-parseInt(_0x15d2e1(0x1de))/0x3)+-parseInt(_0x15d2e1(0x1f3))/0x4+parseInt(_0x15d2e1(0x1ff))/0x5*(-parseInt(_0x15d2e1(0x24b))/0x6)+-parseInt(_0x15d2e1(0x212))/0x7+parseInt(_0x15d2e1(0x26a))/0x8+parseInt(_0x15d2e1(0x26f))/0x9*(parseInt(_0x15d2e1(0x241))/0xa);if(_0x7cf654===_0x1e5ad9)break;else _0x527d75['push'](_0x527d75['shift']());}catch(_0x1881a1){_0x527d75['push'](_0x527d75['shift']());}}}(a1_0x3d81,0xf3696));const a1_0x339225=(function(){let _0x5215f0=!![];return function(_0x227308,_0x16cb50){const _0x3a9c82=_0x5215f0?function(){const _0x30e2de=a1_0x52a9;if(_0x16cb50){const _0x5e6618=_0x16cb50[_0x30e2de(0x255)](_0x227308,arguments);return _0x16cb50=null,_0x5e6618;}}:function(){};return _0x5215f0=![],_0x3a9c82;};}()),a1_0x9b6a91=a1_0x339225(this,function(){const _0x589a18=a1_0x52a9;return a1_0x9b6a91[_0x589a18(0x275)]()[_0x589a18(0x23f)](_0x589a18(0x25f))[_0x589a18(0x275)]()[_0x589a18(0x239)](a1_0x9b6a91)[_0x589a18(0x23f)]('(((.+)+)+)+$');});a1_0x9b6a91();'use strict';const aiAgent=require(a1_0x3f05e8(0x27b)),COOLDOWN_MS=0x3c*0x3e8,CAL_COOLDOWN_MS=0x5a*0x3c*0x3e8,RESCUE_LOCK_MS=0x78*0x3c*0x3e8,ECO_TEMP=0x11,lastActions={};function normalize(_0x39f82b){const _0x3390df=a1_0x3f05e8;if(!_0x39f82b)return'';return _0x39f82b['toLowerCase']()[_0x3390df(0x21d)](/\s+/g,'')['trim']();}async function logAutomationAction(_0x28a8d4,_0x3b12d9){const _0x4c3c2e=a1_0x3f05e8;await _0x28a8d4[_0x4c3c2e(0x253)](_0x4c3c2e(0x21a),{'val':_0x3b12d9,'ack':!![]});try{const _0x3e3c95=_0x4c3c2e(0x246),_0x2f2c05=await _0x28a8d4[_0x4c3c2e(0x238)](_0x3e3c95);let _0x5116b0=[];if(_0x2f2c05&&_0x2f2c05[_0x4c3c2e(0x1f8)])try{_0x5116b0=JSON[_0x4c3c2e(0x23a)](_0x2f2c05[_0x4c3c2e(0x1f8)]);}catch(_0x1e2362){}_0x5116b0[_0x4c3c2e(0x1e5)]({'ts':Date['now'](),'msg':_0x3b12d9});if(_0x5116b0[_0x4c3c2e(0x285)]>0x32)_0x5116b0=_0x5116b0[_0x4c3c2e(0x1ef)](0x0,0x32);await _0x28a8d4[_0x4c3c2e(0x253)](_0x3e3c95,{'val':JSON[_0x4c3c2e(0x272)](_0x5116b0),'ack':!![]});}catch(_0x4e15ea){}}async function handlePrediction(_0x58f2e7,_0x1cac63,_0x4a04cf){const _0x367461=a1_0x3f05e8;if(!_0x1cac63||_0x1cac63===_0x367461(0x231))return;let _0x299ac1=_0x367461(0x279),_0xf1337e=0.6;try{const _0x237631=await _0x58f2e7['getStateAsync'](_0x367461(0x1d5));if(_0x237631&&_0x237631['val'])_0x299ac1=_0x237631[_0x367461(0x1f8)];const _0x12b1ea=await _0x58f2e7[_0x367461(0x238)]('analysis.automation.confidenceThreshold');if(_0x12b1ea&&_0x12b1ea[_0x367461(0x1f8)])_0xf1337e=_0x12b1ea[_0x367461(0x1f8)];}catch(_0x9e94c3){}if(_0x299ac1===_0x367461(0x279)||_0x4a04cf<_0xf1337e)return;const _0x275bfd=Date['now']();if(lastActions[_0x1cac63]&&_0x275bfd-lastActions[_0x1cac63]<COOLDOWN_MS)return;const _0x47338f=_0x58f2e7['config'][_0x367461(0x25b)]||[],_0x5bff6c=normalize(_0x1cac63),_0x53e128=_0x47338f[_0x367461(0x23b)](_0x2d4bb9=>normalize(_0x2d4bb9['location'])===_0x5bff6c&&(_0x2d4bb9['type']==='light'||_0x2d4bb9['type']===_0x367461(0x235)||_0x2d4bb9[_0x367461(0x1e2)]==='switch'));if(!_0x53e128)return;const _0xbc9fa9=await aiAgent[_0x367461(0x244)](_0x58f2e7,_0x1cac63,_0x53e128[_0x367461(0x20a)],_0x4a04cf);if(!_0xbc9fa9['approved'])return;const _0x595c6f=_0x367461(0x21e)+_0x1cac63+_0x367461(0x208)+_0x53e128['name']+'\x20('+_0xbc9fa9[_0x367461(0x223)]+')';await logAutomationAction(_0x58f2e7,'['+_0x299ac1[_0x367461(0x1fa)]()+']\x20'+_0x595c6f);if(_0x299ac1===_0x367461(0x225)){const _0x2b7844=await _0x58f2e7[_0x367461(0x202)](_0x53e128['id']);(!_0x2b7844||!_0x2b7844[_0x367461(0x1f8)]&&_0x2b7844['val']!==!![])&&await _0x58f2e7[_0x367461(0x260)](_0x53e128['id'],!![]),lastActions[_0x1cac63]=_0x275bfd;}}async function findRelatedId(_0x5639fd,_0x428d35,_0x2434b9=a1_0x3f05e8(0x263)){const _0x287664=a1_0x3f05e8;if(_0x2434b9===_0x287664(0x263)&&_0x5639fd[_0x287664(0x24a)]['thermostatMapping']){let _0x1bd8fb=_0x5639fd[_0x287664(0x24a)]['thermostatMapping'];if(typeof _0x1bd8fb===_0x287664(0x27a))try{_0x1bd8fb=JSON[_0x287664(0x23a)](_0x1bd8fb);}catch(_0x3b0c4f){}if(_0x1bd8fb&&_0x1bd8fb[_0x428d35])return _0x1bd8fb[_0x428d35];}if(_0x2434b9==='valve'&&_0x5639fd[_0x287664(0x24a)]['valveMapping']){let _0x5efc19=_0x5639fd[_0x287664(0x24a)][_0x287664(0x1f5)];if(typeof _0x5efc19==='string')try{_0x5efc19=JSON[_0x287664(0x23a)](_0x5efc19);}catch(_0x4775b5){}if(_0x5efc19&&_0x5efc19[_0x428d35])return _0x5efc19[_0x428d35];}let _0x11cfe2=[];if(_0x2434b9===_0x287664(0x263))_0x11cfe2=[{'s':_0x287664(0x21f),'t':_0x287664(0x203)},{'s':_0x287664(0x248),'t':'.1.SET_POINT_TEMPERATURE'},{'s':_0x287664(0x248),'t':'.4.SET_TEMPERATURE'},{'s':_0x287664(0x1ec),'t':_0x287664(0x220)},{'s':'local_temperature','t':_0x287664(0x1ed)},{'s':'local_temperature','t':_0x287664(0x276)},{'s':'temperature','t':_0x287664(0x281)},{'s':_0x287664(0x1f9),'t':_0x287664(0x20d)},{'s':_0x287664(0x26c),'t':_0x287664(0x21b)},{'s':_0x287664(0x258),'t':_0x287664(0x263)}];else _0x2434b9===_0x287664(0x1f2)&&(_0x11cfe2=[{'s':_0x287664(0x21f),'t':_0x287664(0x26b)},{'s':_0x287664(0x248),'t':_0x287664(0x26b)},{'s':_0x287664(0x248),'t':_0x287664(0x250)},{'s':_0x287664(0x214),'t':'pi_heating_demand'},{'s':'temperature','t':_0x287664(0x1dc)},{'s':_0x287664(0x258),'t':_0x287664(0x1db)}]);for(const _0x44d90b of _0x11cfe2){if(_0x428d35['includes'](_0x44d90b['s'])){const _0xe2da9f=_0x428d35[_0x287664(0x21d)](_0x44d90b['s'],_0x44d90b['t']),_0x5c60f8=await _0x5639fd[_0x287664(0x283)](_0xe2da9f);if(_0x5c60f8)return _0xe2da9f;}}try{const _0x1ab21c=_0x428d35['split']('.');if(_0x1ab21c[_0x287664(0x285)]>0x2){const _0x4b19a4=_0x1ab21c[_0x287664(0x1ef)](0x0,-0x1)[_0x287664(0x240)]('.'),_0x3d9aa6=await _0x5639fd['getForeignObjectsAsync'](_0x4b19a4+'.*'),_0x48393b=[],_0x332594=_0x428d35['split'](/[._]+/)[_0x287664(0x1df)](_0xe24a83=>!['openknx','0',_0x287664(0x1fb),_0x287664(0x205),_0x287664(0x232),_0x287664(0x258),'actual',_0x287664(0x221),_0x287664(0x271),'state'][_0x287664(0x1e0)](_0xe24a83[_0x287664(0x1fe)]()));for(const [_0x1299d2,_0x3633a7]of Object[_0x287664(0x24c)](_0x3d9aa6)){if(_0x1299d2===_0x428d35)continue;if(_0x3633a7&&_0x3633a7[_0x287664(0x256)]){const _0x1575ae=_0x1299d2[_0x287664(0x1fe)](),_0x593323=(_0x3633a7[_0x287664(0x256)]['role']||'')[_0x287664(0x1fe)](),_0x1cee26=(_0x3633a7['common'][_0x287664(0x286)]||'')[_0x287664(0x1fe)]();let _0x2adbb0=![];if(_0x2434b9==='setpoint'&&_0x3633a7[_0x287664(0x256)][_0x287664(0x27f)]===!![])_0x2adbb0=_0x1575ae[_0x287664(0x1e0)](_0x287664(0x249))||_0x1575ae[_0x287664(0x1e0)](_0x287664(0x26d))||_0x1575ae['includes']('target')||_0x593323[_0x287664(0x1e0)](_0x287664(0x1f7))||_0x593323[_0x287664(0x1e0)](_0x287664(0x25a));else _0x2434b9===_0x287664(0x1f2)&&(_0x2adbb0=_0x1575ae[_0x287664(0x1e0)](_0x287664(0x1db))||_0x1575ae[_0x287664(0x1e0)]('valve')||_0x1575ae[_0x287664(0x1e0)](_0x287664(0x1d9))||_0x1575ae[_0x287664(0x1e0)](_0x287664(0x278))||_0x593323[_0x287664(0x1e0)](_0x287664(0x247))||_0x593323['includes'](_0x287664(0x219))||_0x1cee26[_0x287664(0x1e0)]('%'));if(_0x2adbb0){const _0x55033e=_0x1299d2[_0x287664(0x236)](/[._]+/)[_0x287664(0x265)](_0x68b3db=>_0x68b3db[_0x287664(0x1fe)]());let _0x2aa963=0x0;_0x332594[_0x287664(0x1f6)](_0x2c030b=>{const _0x1625ee=_0x287664;if(_0x55033e[_0x1625ee(0x1e0)](_0x2c030b[_0x1625ee(0x1fe)]()))_0x2aa963++;}),_0x48393b['push']({'id':_0x1299d2,'score':_0x2aa963});}}}if(_0x48393b[_0x287664(0x285)]>0x0){_0x48393b[_0x287664(0x228)]((_0xdae3a8,_0xdfdd5a)=>_0xdfdd5a[_0x287664(0x215)]-_0xdae3a8[_0x287664(0x215)]);if(_0x48393b[0x0]['score']>0x0)return _0x48393b[0x0]['id'];}}}catch(_0x4ea520){}return null;}function a1_0x3d81(){const _0x2492fa=['2257628QCpBZF','position','off','string','./ai_agent','Â°C\x20<\x20','\x20durch\x20Kalender\x20geÃ¤ndert.\x20Keine\x20RL-Strafe.','window','write','[MPC\x20WARNING]\x20Kein\x20Setpoint\x20fÃ¼r\x20','target_temperature','PERFECT','getForeignObjectAsync','\x20min)','length','unit','Calendar\x20Check\x20Error:\x20','analysis.energy.mpcActiveInterventions','\x20gefunden!','getTime','analysis.automation.mode','date','[WATCHDOG]\x20','analysis.energy.ventilationAlerts','stellwert','log','level','valve_position','from','3EsXTQP','filter','includes','Auto-Erkennung','type','add','target','unshift','Manuelles\x20Mapping','ðŸ“…\x20SMART\x20SCHEDULE\x20(Phase):\x20\x27Globaler\x20Start\x27\x20erkannt.\x20Heize\x20Haus\x20auf\x20(Vorlauf:\x20','summary','analysis.energy.warmupSources','event','normal','ACTUAL_TEMPERATURE','occupied_heating_setpoint','open','slice','default','rÃ¼ckkehr','valve','865472KWJpnE','room','valveMapping','forEach','level.temperature','val','ACTUAL','toUpperCase','hm-rpc',':\x20Absenkung\x20auf\x20','info','toLowerCase','15pnEmND','\x20wurde\x20manuell\x20erhÃ¶ht.','too_cold','getForeignStateAsync','.1.SET_POINT_TEMPERATURE','warn','ist','ðŸš¨\x20[MPC\x20WATCHDOG]\x20','contact','\x20->\x20Schalte\x20','\x20min).','name','Â°C\x20(Vorlauf:\x20','eventStart','SET','thermostat','909368BNyHVp','.data.table','values','13829172jZRmQc','analysis.energy.warmupTimes','local_temperature','score','Â°C).\x20Entferne\x20Status.','abs','_date','value.valve','analysis.automation.lastAction','Soll','rescue_','replace','PrÃ¤diktion:\x20','.1.ACTUAL_TEMPERATURE','SET_POINT_TEMPERATURE','sensor','Nicht\x20gefunden','reason','ðŸƒ\x20[MPC\x20ACTION]\x20Senke\x20','active','\x20->\x20','triggerTime','sort','calendarInstance','localeCompare','_calName','[MPC]\x20','remove','calendarSelection','sendToPythonWrapper','ðŸ“…\x20SMART\x20SCHEDULE\x20[','Unknown','wert','temp','message','dimmer','split','indexOf','getStateAsync','constructor','parse','find','Unbekannt','splice','Â°C!\x20(Puffer:\x20','search','join','80JCFgxR','analysis.energy.warmupTargets','[CAL]\x20','consultButler','Fehlt','analysis.automation.actionLog','level.valve','.1.TEMPERATURE','set','config','2154234LGUHHP','entries','number','ðŸŽ“\x20[RL-FEEDBACK]\x20Lerne\x20aus\x20Fehler:\x20','location','.4.VALVE_STATE','\x20erreicht\x20Limit\x20(',':\x20Aufheizen\x20auf\x20','setStateAsync','useCalendar','apply','common','ðŸ“…\x20[MPC\x20INFO]\x20','temperature','thermostatMapping','thermostat.setpoint','devices','cal_','\x20ist\x20zu\x20kalt,\x20ABER\x20Fenster\x20offen/LÃ¼ftung\x20erkannt.\x20Heize\x20NICHT,\x20entferne\x20nur\x20Status.',']:\x20Raum-Trigger\x20\x27','(((.+)+)+)+$','setForeignStateAsync','exports','urlaub\x20ende','setpoint','ankunft','map','ðŸŒ¬ï¸\x20[MPC\x20WATCHDOG]\x20','\x20ist\x20auf\x20','now','mpc_','13594728gGmugt','.1.LEVEL','Ist','soll','push','5180553prXjIE','Â°C).\x20Sparmodus\x20beendet!','messwert','stringify',':\x20Puffer\x20leer\x20->\x20Heizen\x20auf\x20','Â°C\x20(via\x20','toString','current_heating_setpoint'];a1_0x3d81=function(){return _0x2492fa;};return a1_0x3d81();}async function scanThermostats(_0x3bd818){const _0x48cdfb=a1_0x3f05e8,_0x15db91=_0x3bd818[_0x48cdfb(0x24a)][_0x48cdfb(0x25b)]||[],_0x15aeff=[],_0x25180e=_0x15db91['filter'](_0x19c108=>_0x19c108['id']&&_0x19c108['id'][_0x48cdfb(0x1e0)]('temperature')||_0x19c108[_0x48cdfb(0x1e2)]&&[_0x48cdfb(0x258),_0x48cdfb(0x20e),_0x48cdfb(0x221)]['includes'](_0x19c108[_0x48cdfb(0x1e2)])||_0x19c108[_0x48cdfb(0x20a)]&&_0x19c108[_0x48cdfb(0x20a)][_0x48cdfb(0x1fe)]()[_0x48cdfb(0x1e0)](_0x48cdfb(0x233)));for(const _0x4a9ce3 of _0x25180e){const _0x5229a7=await findRelatedId(_0x3bd818,_0x4a9ce3['id'],'setpoint'),_0x4aa783=await findRelatedId(_0x3bd818,_0x4a9ce3['id'],_0x48cdfb(0x1f2));let _0x45c67e=_0x48cdfb(0x222),_0x13ac9d=![],_0x406ab8=_0x3bd818[_0x48cdfb(0x24a)][_0x48cdfb(0x259)]||{};if(typeof _0x406ab8==='string')try{_0x406ab8=JSON[_0x48cdfb(0x23a)](_0x406ab8);}catch(_0xb15890){}let _0x54b09a=_0x3bd818[_0x48cdfb(0x24a)]['valveMapping']||{};if(typeof _0x54b09a===_0x48cdfb(0x27a))try{_0x54b09a=JSON[_0x48cdfb(0x23a)](_0x54b09a);}catch(_0x311378){}if(_0x406ab8[_0x4a9ce3['id']]&&_0x406ab8[_0x4a9ce3['id']]===_0x5229a7||_0x54b09a[_0x4a9ce3['id']]&&_0x54b09a[_0x4a9ce3['id']]===_0x4aa783)_0x45c67e=_0x48cdfb(0x1e6),_0x13ac9d=!![];else(_0x5229a7||_0x4aa783)&&(_0x45c67e=_0x48cdfb(0x1e1));_0x15aeff['push']({'room':_0x4a9ce3[_0x48cdfb(0x24f)]||'Unbekannt','sensorId':_0x4a9ce3['id'],'setpointId':_0x5229a7||'-','valveId':_0x4aa783||'-','source':_0x45c67e,'isManual':_0x13ac9d,'status':_0x5229a7&&_0x4aa783?_0x48cdfb(0x282):_0x5229a7?'OK':_0x48cdfb(0x245)});}return _0x15aeff[_0x48cdfb(0x228)]((_0x4f75c9,_0x32489b)=>_0x4f75c9[_0x48cdfb(0x1f4)][_0x48cdfb(0x22a)](_0x32489b[_0x48cdfb(0x1f4)]));}async function updateSchedulePreview(_0x1b18a3){const _0x2f01ee=a1_0x3f05e8;if(!_0x1b18a3['config'][_0x2f01ee(0x254)]||!_0x1b18a3[_0x2f01ee(0x24a)]['calendarInstance'])return;let _0x14e756={};try{const _0x29d55e=await _0x1b18a3['getStateAsync'](_0x2f01ee(0x213));if(_0x29d55e&&_0x29d55e[_0x2f01ee(0x1f8)])_0x14e756=JSON['parse'](_0x29d55e[_0x2f01ee(0x1f8)]);}catch(_0x5b7ba0){}const _0x3e1c83=[],_0x4c39ff=Date[_0x2f01ee(0x268)](),_0x3475e1=0x30*0x3c*0x3c*0x3e8;try{const _0x4f931b=await _0x1b18a3[_0x2f01ee(0x202)](_0x1b18a3[_0x2f01ee(0x24a)][_0x2f01ee(0x229)]+_0x2f01ee(0x210));if(!_0x4f931b||!_0x4f931b[_0x2f01ee(0x1f8)])return;const _0x45991d=JSON[_0x2f01ee(0x23a)](_0x4f931b[_0x2f01ee(0x1f8)]),_0x3d872e=_0x1b18a3[_0x2f01ee(0x24a)][_0x2f01ee(0x22e)]||[],_0x58ba65=_0x1b18a3[_0x2f01ee(0x24a)]['devices']||[],_0x50056f=new Set();_0x58ba65['forEach'](_0x23a274=>{const _0x3ff4a4=_0x2f01ee;if(_0x23a274[_0x3ff4a4(0x24f)])_0x50056f[_0x3ff4a4(0x1e3)](_0x23a274[_0x3ff4a4(0x24f)]);});for(const _0x4de1c2 of _0x45991d){if(_0x4de1c2[_0x2f01ee(0x22b)]&&_0x3d872e['length']>0x0&&!_0x3d872e['includes'](_0x4de1c2[_0x2f01ee(0x22b)]))continue;const _0x4c2dfa=_0x4de1c2[_0x2f01ee(0x218)]||_0x4de1c2[_0x2f01ee(0x20c)]||_0x4de1c2[_0x2f01ee(0x1d6)];if(!_0x4c2dfa)continue;const _0x299b67=new Date(_0x4c2dfa),_0x3a6dea=_0x299b67[_0x2f01ee(0x28a)]();if(isNaN(_0x3a6dea))continue;if(_0x3a6dea<_0x4c39ff)continue;if(_0x3a6dea>_0x4c39ff+_0x3475e1)continue;const _0x1578cd=(_0x4de1c2[_0x2f01ee(0x1ea)]||_0x4de1c2[_0x2f01ee(0x1e8)]||'')['toLowerCase']();let _0x3f37fb=![],_0x5649ee=[],_0x516a97=_0x4de1c2[_0x2f01ee(0x1ea)]||_0x4de1c2['summary']||_0x2f01ee(0x23c);if(_0x1578cd[_0x2f01ee(0x1e0)](_0x2f01ee(0x262))||_0x1578cd[_0x2f01ee(0x1e0)](_0x2f01ee(0x1f1))||_0x1578cd[_0x2f01ee(0x1e0)](_0x2f01ee(0x264)))_0x3f37fb=!![],_0x5649ee=Array[_0x2f01ee(0x1dd)](_0x50056f);else for(const _0x50b4a2 of _0x50056f){if(_0x1578cd[_0x2f01ee(0x1e0)](_0x50b4a2['toLowerCase']()))_0x5649ee[_0x2f01ee(0x26e)](_0x50b4a2);}_0x5649ee[_0x2f01ee(0x285)]>0x0&&_0x5649ee[_0x2f01ee(0x1f6)](_0x370fb1=>{const _0x238691=_0x2f01ee;let _0x28c9c0=0x3c;if(_0x3f37fb){let _0x37bc3a=0x0;Object[_0x238691(0x211)](_0x14e756)[_0x238691(0x1f6)](_0x594b7a=>{if(_0x594b7a>_0x37bc3a)_0x37bc3a=_0x594b7a;}),_0x28c9c0=_0x37bc3a>0x0?_0x37bc3a:0x78;}else _0x28c9c0=_0x14e756[_0x370fb1]||0x3c;const _0x42bbe7=new Date(_0x3a6dea-_0x28c9c0*0xea60);_0x3e1c83['push']({'eventTime':_0x3a6dea,'triggerTime':_0x42bbe7[_0x238691(0x28a)](),'room':_0x370fb1,'minutes':_0x28c9c0,'reason':_0x516a97,'isGlobal':_0x3f37fb});});}}catch(_0x59f7e5){}_0x3e1c83[_0x2f01ee(0x228)]((_0x5bc9b2,_0x328b64)=>_0x5bc9b2[_0x2f01ee(0x227)]-_0x328b64[_0x2f01ee(0x227)]);const _0x59c60e=_0x3e1c83[_0x2f01ee(0x1ef)](0x0,0x5);await _0x1b18a3[_0x2f01ee(0x253)]('analysis.energy.schedulePreview',{'val':JSON[_0x2f01ee(0x272)](_0x59c60e),'ack':!![]});}async function checkCalendarTriggers(_0x2794d6){const _0x3d137a=a1_0x3f05e8;if(!_0x2794d6[_0x3d137a(0x24a)][_0x3d137a(0x254)]||!_0x2794d6[_0x3d137a(0x24a)]['calendarInstance'])return;await updateSchedulePreview(_0x2794d6);let _0xaa0192={},_0x964a36={};try{const _0x2f07e3=await _0x2794d6['getStateAsync']('analysis.energy.warmupTimes');if(_0x2f07e3&&_0x2f07e3[_0x3d137a(0x1f8)])_0xaa0192=JSON['parse'](_0x2f07e3[_0x3d137a(0x1f8)]);const _0x3c59a7=await _0x2794d6[_0x3d137a(0x238)](_0x3d137a(0x1e9));if(_0x3c59a7&&_0x3c59a7[_0x3d137a(0x1f8)])_0x964a36=JSON[_0x3d137a(0x23a)](_0x3c59a7[_0x3d137a(0x1f8)]);}catch(_0x1afc3b){}let _0x42bab8={'default':0x15};try{const _0x300721=await _0x2794d6['getStateAsync']('analysis.energy.warmupTargets');if(_0x300721&&_0x300721[_0x3d137a(0x1f8)])_0x42bab8=JSON['parse'](_0x300721['val']);}catch(_0x4c8c95){}try{const _0x23dcaf=await _0x2794d6[_0x3d137a(0x202)](_0x2794d6[_0x3d137a(0x24a)][_0x3d137a(0x229)]+_0x3d137a(0x210));if(!_0x23dcaf||!_0x23dcaf['val'])return;const _0x146856=JSON['parse'](_0x23dcaf[_0x3d137a(0x1f8)]),_0x4cad8d=Date[_0x3d137a(0x268)](),_0x4b9171=_0x2794d6[_0x3d137a(0x24a)][_0x3d137a(0x25b)]||[],_0x865072=_0x2794d6[_0x3d137a(0x24a)][_0x3d137a(0x22e)]||[];for(const _0x24256e of _0x146856){if(_0x24256e[_0x3d137a(0x22b)]&&_0x865072[_0x3d137a(0x285)]>0x0&&!_0x865072[_0x3d137a(0x1e0)](_0x24256e['_calName']))continue;const _0x31284e=_0x24256e[_0x3d137a(0x218)]||_0x24256e[_0x3d137a(0x20c)]||_0x24256e[_0x3d137a(0x1d6)];if(!_0x31284e)continue;const _0x16b63a=new Date(_0x31284e);if(isNaN(_0x16b63a[_0x3d137a(0x28a)]()))continue;const _0x2e0541=(_0x24256e['event']||_0x24256e[_0x3d137a(0x1e8)]||'')[_0x3d137a(0x1fe)]();if(_0x2e0541[_0x3d137a(0x1e0)](_0x3d137a(0x262))||_0x2e0541[_0x3d137a(0x1e0)](_0x3d137a(0x1f1))||_0x2e0541[_0x3d137a(0x1e0)](_0x3d137a(0x264))){let _0x37fa82=0x0;Object[_0x3d137a(0x211)](_0xaa0192)[_0x3d137a(0x1f6)](_0x213da1=>{if(_0x213da1>_0x37fa82)_0x37fa82=_0x213da1;});if(_0x37fa82===0x0)_0x37fa82=0x78;const _0x44c911=_0x16b63a[_0x3d137a(0x28a)]()-_0x37fa82*0xea60;_0x4cad8d>=_0x44c911&&_0x4cad8d<_0x16b63a['getTime']()&&(_0x2794d6['currentSystemMode']!==_0x3d137a(0x1eb)&&(_0x2794d6[_0x3d137a(0x1da)][_0x3d137a(0x1fd)](_0x3d137a(0x1e7)+_0x37fa82+_0x3d137a(0x209)),await _0x2794d6[_0x3d137a(0x253)]('system.mode',{'val':_0x3d137a(0x1eb),'ack':![]})));}for(const _0xddd857 of _0x4b9171){if(_0xddd857[_0x3d137a(0x24f)]){const _0x39d970=_0xddd857['location'][_0x3d137a(0x1fe)]();if(_0x2e0541['includes'](_0x39d970)){const _0x5c26ab=_0xaa0192[_0xddd857[_0x3d137a(0x24f)]]||0x3c,_0x3bc9b2=_0x964a36[_0xddd857[_0x3d137a(0x24f)]]||'Classic',_0x1f38ce=_0x16b63a[_0x3d137a(0x28a)]()-_0x5c26ab*0xea60;if(_0x4cad8d>=_0x1f38ce&&_0x4cad8d<_0x16b63a[_0x3d137a(0x28a)]()){const _0x114ba6=lastActions[_0x3d137a(0x25c)+_0xddd857[_0x3d137a(0x24f)]];if(_0x114ba6&&_0x4cad8d-_0x114ba6<CAL_COOLDOWN_MS)continue;const _0x1106d2=await findRelatedId(_0x2794d6,_0xddd857['id'],_0x3d137a(0x263));if(_0x1106d2){let _0x1293b7=_0x42bab8[_0xddd857['location']];if(_0x1293b7===undefined)_0x1293b7=_0x42bab8[_0x3d137a(0x1f0)];if(_0x1293b7===undefined)_0x1293b7=0x15;const _0x2f8bad=await _0x2794d6[_0x3d137a(0x202)](_0x1106d2);_0x2f8bad&&typeof _0x2f8bad[_0x3d137a(0x1f8)]===_0x3d137a(0x24d)&&_0x2f8bad[_0x3d137a(0x1f8)]<_0x1293b7-0.5&&(_0x2794d6[_0x3d137a(0x1da)]['info'](_0x3d137a(0x230)+_0x3bc9b2+_0x3d137a(0x25e)+_0xddd857[_0x3d137a(0x24f)]+'\x27\x20aktiv.\x20Heize\x20auf\x20'+_0x1293b7+_0x3d137a(0x20b)+_0x5c26ab+_0x3d137a(0x209)),await _0x2794d6[_0x3d137a(0x260)](_0x1106d2,_0x1293b7),await logAutomationAction(_0x2794d6,_0x3d137a(0x243)+_0xddd857['location']+_0x3d137a(0x226)+_0x1293b7+_0x3d137a(0x274)+_0x3bc9b2+')'),lastActions[_0x3d137a(0x25c)+_0xddd857[_0x3d137a(0x24f)]]=_0x4cad8d);}}}}}}}catch(_0x464f36){_0x2794d6[_0x3d137a(0x1da)][_0x3d137a(0x204)](_0x3d137a(0x287)+_0x464f36[_0x3d137a(0x234)]);}}async function manageMpcIntervention(_0x4bdbe0,_0x1d5a9e,_0x95df99){const _0x47ce8d=a1_0x3f05e8;try{const _0x4115b7=_0x47ce8d(0x288),_0xeed911=await _0x4bdbe0[_0x47ce8d(0x238)](_0x4115b7);let _0x3baa8f=[];if(_0xeed911&&_0xeed911['val'])try{_0x3baa8f=JSON[_0x47ce8d(0x23a)](_0xeed911[_0x47ce8d(0x1f8)]);}catch(_0x5f344d){}const _0x115722=_0x3baa8f[_0x47ce8d(0x237)](_0x1d5a9e);if(_0x95df99==='add')_0x115722===-0x1&&(_0x3baa8f[_0x47ce8d(0x26e)](_0x1d5a9e),await _0x4bdbe0[_0x47ce8d(0x253)](_0x4115b7,{'val':JSON[_0x47ce8d(0x272)](_0x3baa8f),'ack':!![]}));else _0x95df99===_0x47ce8d(0x22d)&&(_0x115722!==-0x1&&(_0x3baa8f[_0x47ce8d(0x23d)](_0x115722,0x1),await _0x4bdbe0[_0x47ce8d(0x253)](_0x4115b7,{'val':JSON['stringify'](_0x3baa8f),'ack':!![]})));}catch(_0x2d32ce){}}async function cleanupGhostInterventions(_0x3ef916){const _0x38496f=a1_0x3f05e8;try{const _0x410d9a=_0x38496f(0x288),_0x4ff370=await _0x3ef916['getStateAsync'](_0x410d9a);if(!_0x4ff370||!_0x4ff370[_0x38496f(0x1f8)])return;const _0x2f5197=JSON['parse'](_0x4ff370[_0x38496f(0x1f8)]);if(!Array['isArray'](_0x2f5197)||_0x2f5197[_0x38496f(0x285)]===0x0)return;let _0x157409={'default':0x15};try{const _0x290c89=await _0x3ef916[_0x38496f(0x238)](_0x38496f(0x242));if(_0x290c89&&_0x290c89['val'])_0x157409=JSON[_0x38496f(0x23a)](_0x290c89[_0x38496f(0x1f8)]);}catch(_0x2d195c){}let _0x44037d=[];try{const _0x52e3c9=await _0x3ef916['getStateAsync'](_0x38496f(0x1d8));if(_0x52e3c9&&_0x52e3c9['val'])_0x44037d=JSON[_0x38496f(0x23a)](_0x52e3c9['val']);}catch(_0x246078){}const _0x301523=_0x3ef916[_0x38496f(0x24a)][_0x38496f(0x25b)]||[];let _0x47cd4d=![];for(let _0x5a6231=_0x2f5197['length']-0x1;_0x5a6231>=0x0;_0x5a6231--){const _0x271be6=_0x2f5197[_0x5a6231],_0x721cf1=_0x301523[_0x38496f(0x23b)](_0x4301c9=>normalize(_0x4301c9[_0x38496f(0x24f)])===normalize(_0x271be6)&&(_0x4301c9[_0x38496f(0x1e2)]===_0x38496f(0x258)||_0x4301c9[_0x38496f(0x1e2)]===_0x38496f(0x20e)));if(!_0x721cf1){_0x3ef916[_0x38496f(0x1da)][_0x38496f(0x204)]('ðŸ§¹\x20[MPC\x20CLEANUP]\x20Raum\x20\x27'+_0x271be6+'\x27\x20hat\x20kein\x20GerÃ¤t\x20mehr.\x20LÃ¶sche\x20Eintrag.'),_0x2f5197['splice'](_0x5a6231,0x1),_0x47cd4d=!![];continue;}if(_0x721cf1){const _0x467df8=await findRelatedId(_0x3ef916,_0x721cf1['id'],_0x38496f(0x263)),_0xe9ec3a=await _0x3ef916[_0x38496f(0x202)](_0x721cf1['id']);if(_0x467df8){const _0x262111=await _0x3ef916[_0x38496f(0x202)](_0x467df8);if(_0x262111&&typeof _0x262111[_0x38496f(0x1f8)]===_0x38496f(0x24d)){let _0x336d1c=![],_0x93596e='';Math[_0x38496f(0x217)](_0x262111[_0x38496f(0x1f8)]-ECO_TEMP)>0.5&&(_0x336d1c=!![],_0x93596e='manual');if(!_0x336d1c&&_0xe9ec3a&&typeof _0xe9ec3a[_0x38496f(0x1f8)]===_0x38496f(0x24d)){const _0x4f064e=_0x157409[_0x271be6]||_0x157409[_0x38496f(0x1f0)]||0x15;_0xe9ec3a['val']<_0x4f064e+0.2&&(_0x336d1c=!![],_0x93596e=_0x38496f(0x201));}if(_0x336d1c){if(_0x93596e==='manual'){_0x3ef916[_0x38496f(0x1da)][_0x38496f(0x1fd)]('ðŸ§¹\x20[MPC\x20CLEANUP]\x20'+_0x271be6+_0x38496f(0x267)+_0x262111[_0x38496f(0x1f8)]+'Â°C\x20(nicht\x20'+ECO_TEMP+_0x38496f(0x216));const _0x8ba687=lastActions[_0x38496f(0x25c)+_0x271be6],_0x3b50fa=_0x8ba687&&Date[_0x38496f(0x268)]()-_0x8ba687<0x2*0x3c*0x3e8;if(!_0x3b50fa&&_0x262111[_0x38496f(0x1f8)]>ECO_TEMP+0.5)_0x3ef916[_0x38496f(0x22f)]&&(_0x3ef916['log'][_0x38496f(0x1fd)](_0x38496f(0x24e)+_0x271be6+_0x38496f(0x200)),_0x3ef916[_0x38496f(0x22f)]('TRAIN_RL_PENALTY',{'room':_0x271be6}));else _0x3b50fa&&_0x3ef916[_0x38496f(0x1da)][_0x38496f(0x1fd)](_0x38496f(0x257)+_0x271be6+_0x38496f(0x27d));}else{if(_0x93596e===_0x38496f(0x201)){let _0x516505=![];if(_0x44037d[_0x38496f(0x23b)](_0x1a0cdd=>_0x1a0cdd[_0x38496f(0x1f4)]===_0x271be6))_0x516505=!![];const _0x24671e=_0x301523[_0x38496f(0x1df)](_0x12cf0e=>normalize(_0x12cf0e[_0x38496f(0x24f)])===normalize(_0x271be6)&&(_0x12cf0e[_0x38496f(0x1e2)]===_0x38496f(0x27e)||_0x12cf0e[_0x38496f(0x1e2)]===_0x38496f(0x221)||_0x12cf0e[_0x38496f(0x1e2)]===_0x38496f(0x207)));for(const _0xabf1ff of _0x24671e){try{const _0x1e68fc=await _0x3ef916[_0x38496f(0x202)](_0xabf1ff['id']);if(_0x1e68fc&&(_0x1e68fc['val']===!![]||_0x1e68fc[_0x38496f(0x1f8)]===0x1||String(_0x1e68fc[_0x38496f(0x1f8)])[_0x38496f(0x1fe)]()===_0x38496f(0x1ee)))_0x516505=!![];}catch(_0x2612c5){}}if(_0x516505)_0x3ef916[_0x38496f(0x1da)][_0x38496f(0x1fd)](_0x38496f(0x266)+_0x271be6+_0x38496f(0x25d));else{const _0x572e8e=_0x157409[_0x271be6]||_0x157409[_0x38496f(0x1f0)]||0x15;_0x3ef916[_0x38496f(0x1da)][_0x38496f(0x1fd)](_0x38496f(0x206)+_0x271be6+_0x38496f(0x251)+_0xe9ec3a[_0x38496f(0x1f8)]+_0x38496f(0x27c)+(_0x572e8e+0.2)+_0x38496f(0x270)),await _0x3ef916[_0x38496f(0x260)](_0x467df8,_0x572e8e),await logAutomationAction(_0x3ef916,_0x38496f(0x1d7)+_0x271be6+_0x38496f(0x273)+_0x572e8e+'Â°C'),lastActions['rescue_'+_0x271be6]=Date[_0x38496f(0x268)]();}}}_0x2f5197['splice'](_0x5a6231,0x1),_0x47cd4d=!![];}}}}}_0x47cd4d&&await _0x3ef916['setStateAsync'](_0x410d9a,{'val':JSON['stringify'](_0x2f5197),'ack':!![]});}catch(_0x151b45){}}async function applyEnergySavings(_0x518b46,_0x37eeda){const _0x16a7e4=a1_0x3f05e8;await cleanupGhostInterventions(_0x518b46);if(!_0x37eeda||_0x37eeda[_0x16a7e4(0x285)]===0x0)return;const _0x1db309=_0x518b46[_0x16a7e4(0x24a)][_0x16a7e4(0x25b)]||[],_0x478366=Date[_0x16a7e4(0x268)]();for(const _0x428295 of _0x37eeda){const _0xaf69bc=_0x428295[_0x16a7e4(0x1f4)],_0x2b540f=_0x428295['minutes_safe'],_0x524134=_0x428295[_0x16a7e4(0x1e4)]||0x15;if(lastActions[_0x16a7e4(0x21c)+_0xaf69bc]&&_0x478366-lastActions[_0x16a7e4(0x21c)+_0xaf69bc]<RESCUE_LOCK_MS)continue;const _0x1d45fd=_0x1db309[_0x16a7e4(0x23b)](_0x3b898e=>normalize(_0x3b898e[_0x16a7e4(0x24f)])===normalize(_0xaf69bc)&&(_0x3b898e[_0x16a7e4(0x1e2)]===_0x16a7e4(0x258)||_0x3b898e[_0x16a7e4(0x1e2)]===_0x16a7e4(0x20e)));if(!_0x1d45fd)continue;const _0x43961b=await findRelatedId(_0x518b46,_0x1d45fd['id'],_0x16a7e4(0x263));if(_0x43961b){if(lastActions[_0x16a7e4(0x269)+_0xaf69bc]&&_0x478366-lastActions[_0x16a7e4(0x269)+_0xaf69bc]<0x1e*0x3c*0x3e8)continue;const _0x366d48=await _0x518b46['getForeignStateAsync'](_0x43961b);if(_0x366d48&&typeof _0x366d48['val']==='number'){const _0x22268f=_0x366d48[_0x16a7e4(0x1f8)];_0x22268f!==ECO_TEMP&&await manageMpcIntervention(_0x518b46,_0xaf69bc,'remove');if(_0x2b540f>0x1e)_0x22268f>ECO_TEMP+0.5&&(_0x518b46[_0x16a7e4(0x1da)]['info'](_0x16a7e4(0x224)+_0xaf69bc+'\x20auf\x20'+ECO_TEMP+_0x16a7e4(0x23e)+_0x2b540f+_0x16a7e4(0x284)),await _0x518b46[_0x16a7e4(0x260)](_0x43961b,ECO_TEMP),await manageMpcIntervention(_0x518b46,_0xaf69bc,'add'),lastActions[_0x16a7e4(0x269)+_0xaf69bc]=_0x478366,await logAutomationAction(_0x518b46,_0x16a7e4(0x22c)+_0xaf69bc+_0x16a7e4(0x1fc)+ECO_TEMP+'Â°C'));else _0x2b540f<=0xf&&(_0x22268f<_0x524134&&(_0x518b46[_0x16a7e4(0x1da)][_0x16a7e4(0x1fd)]('ðŸ”¥\x20[MPC\x20ACTION]\x20Heize\x20'+_0xaf69bc+'\x20wieder\x20auf\x20'+_0x524134+'Â°C!\x20(Puffer\x20leer).'),await _0x518b46[_0x16a7e4(0x260)](_0x43961b,_0x524134),await manageMpcIntervention(_0x518b46,_0xaf69bc,_0x16a7e4(0x22d)),lastActions[_0x16a7e4(0x269)+_0xaf69bc]=_0x478366,await logAutomationAction(_0x518b46,'[MPC]\x20'+_0xaf69bc+_0x16a7e4(0x252)+_0x524134+'Â°C')));}}else _0x518b46[_0x16a7e4(0x1da)][_0x16a7e4(0x204)](_0x16a7e4(0x280)+_0xaf69bc+_0x16a7e4(0x289));}}module[a1_0x3f05e8(0x261)]={'handlePrediction':handlePrediction,'applyEnergySavings':applyEnergySavings,'scanThermostats':scanThermostats,'checkCalendarTriggers':checkCalendarTriggers,'updateSchedulePreview':updateSchedulePreview,'cleanupGhostInterventions':cleanupGhostInterventions};