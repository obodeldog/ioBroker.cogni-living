function a1_0x1be7(){const _0x95bd4a=['off','trim','apply','temperature','debug','number','temp','string','location','search','getStateAsync','85484wIhTQY','104434rraFmK','approved','replace','filter','.1.SET_POINT_TEMPERATURE','common','thermostatMapping','15sZtqrq','39168imGYsC','.4.SET_TEMPERATURE','üçÉ\x20MPC\x20Autonomy:\x20Senke\x20','localeCompare','\x20->\x20Schalte\x20','mpc_','info','room','analysis.automation.mode','Unknown','üîç\x20Device-Search\x20failed\x20for\x20predicted\x20room\x20\x27','minutes_safe','Nicht\x20gefunden','join','Unbekannt','SET',')\x20auf\x20','Auto-Erkennung','1600aHIxel','setStateAsync','¬∞C\x20(Coasting\x20m√∂glich:\x20','slice','local_temperature','setForeignStateAsync','split','ACTUAL','thermostat','type','SET_POINT_TEMPERATURE','name','\x20min)','set','[MPC]\x20','1644pELNWW','Manuelles\x20Mapping','sort','log','721840SsohQo','devices','getForeignObjectAsync','entries','analysis.automation.lastAction','82950WHcGDp','sensor','168uLANZO','current_heating_setpoint','17Ovdxuu','write','level.temperature','constructor','4802980dijZyA','soll','occupied_heating_setpoint','val','dimmer',':\x20-1¬∞C\x20(Sparpotenzial\x20genutzt)','Pr√§diktion:\x20','find','.1.TEMPERATURE','exports','config','now','toUpperCase','(((.+)+)+)+$','light','toLowerCase','getForeignStateAsync','includes','parse','7720aAhIIF','switch','.1.ACTUAL_TEMPERATURE','toString'];a1_0x1be7=function(){return _0x95bd4a;};return a1_0x1be7();}const a1_0x2b0d7e=a1_0x3fbf;(function(_0xd98573,_0x321c66){const _0x556b59=a1_0x3fbf,_0xe38660=_0xd98573();while(!![]){try{const _0x68bc12=-parseInt(_0x556b59(0x18d))/0x1*(-parseInt(_0x556b59(0x156))/0x2)+parseInt(_0x556b59(0x15e))/0x3*(-parseInt(_0x556b59(0x1a4))/0x4)+parseInt(_0x556b59(0x184))/0x5+-parseInt(_0x556b59(0x189))/0x6*(parseInt(_0x556b59(0x18b))/0x7)+parseInt(_0x556b59(0x171))/0x8*(-parseInt(_0x556b59(0x15f))/0x9)+-parseInt(_0x556b59(0x191))/0xa+parseInt(_0x556b59(0x157))/0xb*(parseInt(_0x556b59(0x180))/0xc);if(_0x68bc12===_0x321c66)break;else _0xe38660['push'](_0xe38660['shift']());}catch(_0x8b8317){_0xe38660['push'](_0xe38660['shift']());}}}(a1_0x1be7,0x75118));function a1_0x3fbf(_0x38b1b6,_0x3a4cf3){const _0x54af2f=a1_0x1be7();return a1_0x3fbf=function(_0x4a8586,_0x5e7c64){_0x4a8586=_0x4a8586-0x153;let _0x1be70b=_0x54af2f[_0x4a8586];return _0x1be70b;},a1_0x3fbf(_0x38b1b6,_0x3a4cf3);}const a1_0x5e7c64=(function(){let _0x4d972e=!![];return function(_0x3402a8,_0x470f34){const _0x240ff1=_0x4d972e?function(){const _0x34bb6d=a1_0x3fbf;if(_0x470f34){const _0xfa017d=_0x470f34[_0x34bb6d(0x1aa)](_0x3402a8,arguments);return _0x470f34=null,_0xfa017d;}}:function(){};return _0x4d972e=![],_0x240ff1;};}()),a1_0x4a8586=a1_0x5e7c64(this,function(){const _0x3e9ce5=a1_0x3fbf;return a1_0x4a8586[_0x3e9ce5(0x1a7)]()[_0x3e9ce5(0x154)](_0x3e9ce5(0x19e))[_0x3e9ce5(0x1a7)]()[_0x3e9ce5(0x190)](a1_0x4a8586)[_0x3e9ce5(0x154)](_0x3e9ce5(0x19e));});a1_0x4a8586();'use strict';const aiAgent=require('./ai_agent'),COOLDOWN_MS=0x3c*0x3e8,lastActions={};function normalize(_0x13d2ed){const _0x1d8228=a1_0x3fbf;if(!_0x13d2ed)return'';return _0x13d2ed['toLowerCase']()[_0x1d8228(0x159)](/\s+/g,'')[_0x1d8228(0x1a9)]();}async function handlePrediction(_0x84d662,_0x14e313,_0x527392){const _0x13c2e0=a1_0x3fbf;if(!_0x14e313||_0x14e313===_0x13c2e0(0x168))return;let _0x7fd425='off',_0x5c25c3=0.6;try{const _0x3efe4c=await _0x84d662[_0x13c2e0(0x155)](_0x13c2e0(0x167));if(_0x3efe4c&&_0x3efe4c[_0x13c2e0(0x194)])_0x7fd425=_0x3efe4c['val'];const _0x58767d=await _0x84d662[_0x13c2e0(0x155)]('analysis.automation.confidenceThreshold');if(_0x58767d&&_0x58767d['val'])_0x5c25c3=_0x58767d[_0x13c2e0(0x194)];}catch(_0x2a698a){}if(_0x7fd425===_0x13c2e0(0x1a8)||_0x527392<_0x5c25c3)return;const _0x34bf78=Date['now']();if(lastActions[_0x14e313]&&_0x34bf78-lastActions[_0x14e313]<COOLDOWN_MS)return;const _0x93bbf=_0x84d662[_0x13c2e0(0x19b)][_0x13c2e0(0x185)]||[],_0x1f63ce=normalize(_0x14e313),_0x3a5cd3=_0x93bbf['find'](_0x5e266d=>normalize(_0x5e266d[_0x13c2e0(0x153)])===_0x1f63ce&&(_0x5e266d['type']===_0x13c2e0(0x19f)||_0x5e266d[_0x13c2e0(0x17a)]===_0x13c2e0(0x195)||_0x5e266d[_0x13c2e0(0x17a)]===_0x13c2e0(0x1a5)));if(!_0x3a5cd3){_0x84d662[_0x13c2e0(0x183)][_0x13c2e0(0x1ac)](_0x13c2e0(0x169)+_0x14e313+'\x27.');return;}const _0x20154c=await aiAgent['consultButler'](_0x84d662,_0x14e313,_0x3a5cd3['name'],_0x527392);if(!_0x20154c[_0x13c2e0(0x158)])return;const _0x3b15b2=_0x13c2e0(0x197)+_0x14e313+_0x13c2e0(0x163)+_0x3a5cd3[_0x13c2e0(0x17c)]+'\x20('+_0x20154c['reason']+')';await _0x84d662[_0x13c2e0(0x172)](_0x13c2e0(0x188),{'val':'['+_0x7fd425[_0x13c2e0(0x19d)]()+']\x20'+_0x3b15b2,'ack':!![]});if(_0x7fd425==='active'){const _0x3112b9=await _0x84d662[_0x13c2e0(0x1a1)](_0x3a5cd3['id']);(!_0x3112b9||!_0x3112b9[_0x13c2e0(0x194)]&&_0x3112b9['val']!==!![])&&await _0x84d662[_0x13c2e0(0x176)](_0x3a5cd3['id'],!![]),lastActions[_0x14e313]=_0x34bf78;}}async function findSetpointId(_0xb7758d,_0x109dc0){const _0x9c243f=a1_0x3fbf;if(_0xb7758d[_0x9c243f(0x19b)]['thermostatMapping']){let _0x25556c=_0xb7758d['config'][_0x9c243f(0x15d)];if(typeof _0x25556c==='string')try{_0x25556c=JSON[_0x9c243f(0x1a3)](_0x25556c);}catch(_0x268d8c){_0x25556c={};}if(_0x25556c&&_0x25556c[_0x109dc0])return _0x25556c[_0x109dc0];}const _0x1aaaed=[{'s':_0x9c243f(0x1a6),'t':_0x9c243f(0x15b)},{'s':_0x9c243f(0x199),'t':_0x9c243f(0x160)},{'s':'ACTUAL_TEMPERATURE','t':_0x9c243f(0x17b)},{'s':_0x9c243f(0x175),'t':_0x9c243f(0x193)},{'s':_0x9c243f(0x175),'t':_0x9c243f(0x18c)},{'s':_0x9c243f(0x1ab),'t':'target_temperature'},{'s':_0x9c243f(0x178),'t':_0x9c243f(0x16e)},{'s':'Ist','t':'Soll'},{'s':_0x9c243f(0x1ab),'t':'setpoint'}];for(const _0x47a9d0 of _0x1aaaed){if(_0x109dc0[_0x9c243f(0x1a2)](_0x47a9d0['s'])){const _0x5bf399=_0x109dc0[_0x9c243f(0x159)](_0x47a9d0['s'],_0x47a9d0['t']),_0x4d4509=await _0xb7758d[_0x9c243f(0x186)](_0x5bf399);if(_0x4d4509)return _0x5bf399;}}try{const _0x95dcc8=_0x109dc0[_0x9c243f(0x177)]('.');if(_0x95dcc8['length']>0x2){const _0x1eef07=_0x95dcc8[_0x9c243f(0x174)](0x0,-0x1)[_0x9c243f(0x16c)]('.'),_0x37bd63=await _0xb7758d['getForeignObjectsAsync'](_0x1eef07+'.*');for(const [_0x111aea,_0x1d62d2]of Object[_0x9c243f(0x187)](_0x37bd63)){if(_0x111aea===_0x109dc0)continue;if(_0x1d62d2&&_0x1d62d2[_0x9c243f(0x15c)]&&_0x1d62d2[_0x9c243f(0x15c)][_0x9c243f(0x18e)]===!![]){const _0x2b675f=_0x111aea[_0x9c243f(0x1a0)](),_0x39e2d4=(_0x1d62d2[_0x9c243f(0x15c)]['role']||'')[_0x9c243f(0x1a0)]();if(_0x2b675f[_0x9c243f(0x1a2)](_0x9c243f(0x17e))||_0x2b675f['includes'](_0x9c243f(0x192))||_0x2b675f['includes']('target')||_0x39e2d4['includes'](_0x9c243f(0x18f))||_0x39e2d4['includes'](_0x9c243f(0x179)))return _0x111aea;}}}}catch(_0x4c445c){}return null;}async function scanThermostats(_0x18d156){const _0x88a264=a1_0x3fbf,_0x4f57ee=_0x18d156[_0x88a264(0x19b)]['devices']||[],_0x5ecb73=[],_0x2fe96c=_0x4f57ee[_0x88a264(0x15a)](_0x33ed6f=>_0x33ed6f['id']&&_0x33ed6f['id'][_0x88a264(0x1a2)](_0x88a264(0x1ab))||_0x33ed6f[_0x88a264(0x17a)]&&[_0x88a264(0x1ab),_0x88a264(0x179),_0x88a264(0x18a)]['includes'](_0x33ed6f[_0x88a264(0x17a)])||_0x33ed6f[_0x88a264(0x17c)]&&_0x33ed6f[_0x88a264(0x17c)]['toLowerCase']()[_0x88a264(0x1a2)](_0x88a264(0x1ae)));for(const _0x13bdcb of _0x2fe96c){const _0x427711=await findSetpointId(_0x18d156,_0x13bdcb['id']);let _0x4ef238=_0x88a264(0x16b),_0x3ebe5f=![],_0x3ab056=_0x18d156[_0x88a264(0x19b)][_0x88a264(0x15d)]||{};if(typeof _0x3ab056===_0x88a264(0x1af))try{_0x3ab056=JSON['parse'](_0x3ab056);}catch(_0x130b7e){}if(_0x3ab056[_0x13bdcb['id']]&&_0x3ab056[_0x13bdcb['id']]===_0x427711)_0x4ef238=_0x88a264(0x181),_0x3ebe5f=!![];else _0x427711&&(_0x4ef238=_0x88a264(0x170));_0x5ecb73['push']({'room':_0x13bdcb[_0x88a264(0x153)]||_0x88a264(0x16d),'sensorId':_0x13bdcb['id'],'setpointId':_0x427711||'-','source':_0x4ef238,'isManual':_0x3ebe5f,'status':_0x427711?'OK':'Fehlt'});}return _0x5ecb73[_0x88a264(0x182)]((_0xaf8a2b,_0x307616)=>_0xaf8a2b['room'][_0x88a264(0x162)](_0x307616[_0x88a264(0x166)]));}async function applyEnergySavings(_0x52231e,_0x51f7e4){const _0x199d39=a1_0x3fbf,_0x1d39b6=_0x52231e['config'][_0x199d39(0x185)]||[];for(const _0x38fa62 of _0x51f7e4){const _0x5039ae=_0x38fa62[_0x199d39(0x166)],_0x266004=_0x38fa62[_0x199d39(0x16a)],_0x10bb20=Date[_0x199d39(0x19c)]();if(lastActions[_0x199d39(0x164)+_0x5039ae]&&_0x10bb20-lastActions[_0x199d39(0x164)+_0x5039ae]<0x1e*0x3c*0x3e8)continue;const _0xdc61b=_0x1d39b6[_0x199d39(0x198)](_0x5193c5=>normalize(_0x5193c5[_0x199d39(0x153)])===normalize(_0x5039ae));if(!_0xdc61b)continue;const _0x1323e2=await findSetpointId(_0x52231e,_0xdc61b['id']);if(_0x1323e2){const _0x239b7e=await _0x52231e[_0x199d39(0x1a1)](_0x1323e2);if(_0x239b7e&&typeof _0x239b7e[_0x199d39(0x194)]===_0x199d39(0x1ad)){const _0x48981f=_0x239b7e[_0x199d39(0x194)];if(_0x266004>0x1e&&_0x48981f>0x11){const _0x5a5cc9=_0x48981f-0x1;_0x52231e[_0x199d39(0x183)][_0x199d39(0x165)](_0x199d39(0x161)+_0x5039ae+'\x20('+_0x1323e2+_0x199d39(0x16f)+_0x5a5cc9+_0x199d39(0x173)+_0x266004+_0x199d39(0x17d)),await _0x52231e[_0x199d39(0x176)](_0x1323e2,_0x5a5cc9),lastActions[_0x199d39(0x164)+_0x5039ae]=_0x10bb20,await _0x52231e['setStateAsync'](_0x199d39(0x188),{'val':_0x199d39(0x17f)+_0x5039ae+_0x199d39(0x196),'ack':!![]});}}}}}module[a1_0x2b0d7e(0x19a)]={'handlePrediction':handlePrediction,'applyEnergySavings':applyEnergySavings,'scanThermostats':scanThermostats};