const a1_0x4c137a=a1_0x5c57;function a1_0x4dbd(){const _0xacf758=['rÃ¼ckkehr','\x20->\x20Schalte\x20','now','state','ankunft','calendarSelection','Fehlt','val','mpc_','.4.VALVE_STATE','off','level','trim','(((.+)+)+)+$','parse','entries','ðŸ“…\x20SMART\x20SCHEDULE:\x20Raum-Trigger\x20\x27','info','./ai_agent','ðŸ“…\x20SMART\x20SCHEDULE:\x20\x27Globaler\x20Start\x27\x20erkannt\x20(','role','room','level.valve','system.mode','thermostat','Auto-Erkennung','.4.SET_TEMPERATURE','getStateAsync','Â°C\x20(Coasting\x20mÃ¶glich:\x20','join','wert','.1.LEVEL','dimmer','name','value.valve','ðŸ”\x20Device-Search\x20failed\x20for\x20predicted\x20room\x20\x27','apply','3118108iIsvBd','find','pi_heating_demand','location','ACTUAL_TEMPERATURE','getTime','setStateAsync','urlaub\x20ende','filter','soll','position','stellwert','valve_position','sort','547375DZZnFG','warn','push','config','ist','eventStart','getForeignStateAsync','active','target_temperature','[CAL]\x20','9BdxRYK','temp','local_temperature','normal','analysis.automation.lastAction','getForeignObjectsAsync','toString','hm-rpc','\x20min)','useCalendar','light','toUpperCase','constructor','write','sensor','30eoIbrH','_calName','398004sWqMKy','length','SET_POINT_TEMPERATURE','Unbekannt','942740pnLUxS','values','Soll','228776AHWWqY','slice','actual','setpoint','74OJXUoC','analysis.energy.warmupTimes','minutes_safe','9749wJHifn','.1.SET_POINT_TEMPERATURE','PERFECT','.1.ACTUAL_TEMPERATURE','Ist','22JOAeyi','41451zuCJwC','ðŸƒ\x20MPC\x20Autonomy:\x20Senke\x20','score','split','calendarInstance',').\x20Heize\x20auf\x2021Â°C\x20(Vorlauf:\x20','common','devices','setForeignStateAsync','occupied_heating_setpoint','forEach','temperature','target','160iyJCDL','\x20->\x2021Â°C','event','type','switch','valve','consultButler',').\x20Heize\x20ganzes\x20Haus\x20auf\x20(Vorlauf:\x20','current_heating_setpoint','.1.TEMPERATURE','toLowerCase','Nicht\x20gefunden','log','unit','replace','search','includes','debug','Unknown'];a1_0x4dbd=function(){return _0xacf758;};return a1_0x4dbd();}(function(_0x112651,_0x42fcbb){const _0x9a6009=a1_0x5c57,_0x298cdd=_0x112651();while(!![]){try{const _0x1d621a=parseInt(_0x9a6009(0x129))/0x1*(-parseInt(_0x9a6009(0x126))/0x2)+parseInt(_0x9a6009(0x12f))/0x3*(parseInt(_0x9a6009(0xba))/0x4)+-parseInt(_0x9a6009(0x100))/0x5*(parseInt(_0x9a6009(0x119))/0x6)+parseInt(_0x9a6009(0xf2))/0x7+-parseInt(_0x9a6009(0x122))/0x8*(parseInt(_0x9a6009(0x10a))/0x9)+parseInt(_0x9a6009(0x11f))/0xa*(parseInt(_0x9a6009(0x12e))/0xb)+parseInt(_0x9a6009(0x11b))/0xc;if(_0x1d621a===_0x42fcbb)break;else _0x298cdd['push'](_0x298cdd['shift']());}catch(_0x52b1f9){_0x298cdd['push'](_0x298cdd['shift']());}}}(a1_0x4dbd,0x45212));const a1_0x4d54cb=(function(){let _0x1c62af=!![];return function(_0x197b7b,_0x7f9ef6){const _0x29e74f=_0x1c62af?function(){const _0x8d346c=a1_0x5c57;if(_0x7f9ef6){const _0x3e4292=_0x7f9ef6[_0x8d346c(0xf1)](_0x197b7b,arguments);return _0x7f9ef6=null,_0x3e4292;}}:function(){};return _0x1c62af=![],_0x29e74f;};}()),a1_0x3d317c=a1_0x4d54cb(this,function(){const _0x2bbfa8=a1_0x5c57;return a1_0x3d317c[_0x2bbfa8(0x110)]()['search'](_0x2bbfa8(0xda))[_0x2bbfa8(0x110)]()[_0x2bbfa8(0x116)](a1_0x3d317c)[_0x2bbfa8(0xc9)](_0x2bbfa8(0xda));});a1_0x3d317c();'use strict';function a1_0x5c57(_0x48569c,_0x9f3840){const _0x136c54=a1_0x4dbd();return a1_0x5c57=function(_0x3d317c,_0x4d54cb){_0x3d317c=_0x3d317c-0xb7;let _0x4dbdc6=_0x136c54[_0x3d317c];return _0x4dbdc6;},a1_0x5c57(_0x48569c,_0x9f3840);}const aiAgent=require(a1_0x4c137a(0xdf)),COOLDOWN_MS=0x3c*0x3e8,lastActions={};function normalize(_0x40b1cf){const _0x369bfc=a1_0x4c137a;if(!_0x40b1cf)return'';return _0x40b1cf[_0x369bfc(0xc4)]()[_0x369bfc(0xc8)](/\s+/g,'')[_0x369bfc(0xd9)]();}async function handlePrediction(_0x495dab,_0x5682b5,_0x3cae7a){const _0x3c33ad=a1_0x4c137a;if(!_0x5682b5||_0x5682b5===_0x3c33ad(0xcc))return;let _0x41fb91=_0x3c33ad(0xd7),_0x37bbfb=0.6;try{const _0x4391fd=await _0x495dab[_0x3c33ad(0xe8)]('analysis.automation.mode');if(_0x4391fd&&_0x4391fd[_0x3c33ad(0xd4)])_0x41fb91=_0x4391fd[_0x3c33ad(0xd4)];const _0x1ad0af=await _0x495dab['getStateAsync']('analysis.automation.confidenceThreshold');if(_0x1ad0af&&_0x1ad0af[_0x3c33ad(0xd4)])_0x37bbfb=_0x1ad0af['val'];}catch(_0x17aa9e){}if(_0x41fb91===_0x3c33ad(0xd7)||_0x3cae7a<_0x37bbfb)return;const _0x28f417=Date['now']();if(lastActions[_0x5682b5]&&_0x28f417-lastActions[_0x5682b5]<COOLDOWN_MS)return;const _0x27685d=_0x495dab[_0x3c33ad(0x103)][_0x3c33ad(0x136)]||[],_0x9f75ae=normalize(_0x5682b5),_0x224510=_0x27685d[_0x3c33ad(0xf3)](_0x476650=>normalize(_0x476650['location'])===_0x9f75ae&&(_0x476650[_0x3c33ad(0xbd)]===_0x3c33ad(0x114)||_0x476650[_0x3c33ad(0xbd)]===_0x3c33ad(0xed)||_0x476650[_0x3c33ad(0xbd)]===_0x3c33ad(0xbe)));if(!_0x224510){_0x495dab[_0x3c33ad(0xc6)][_0x3c33ad(0xcb)](_0x3c33ad(0xf0)+_0x5682b5+'\x27.');return;}const _0x4b29bc=await aiAgent[_0x3c33ad(0xc0)](_0x495dab,_0x5682b5,_0x224510['name'],_0x3cae7a);if(!_0x4b29bc['approved'])return;const _0xa9fed2='PrÃ¤diktion:\x20'+_0x5682b5+_0x3c33ad(0xce)+_0x224510['name']+'\x20('+_0x4b29bc['reason']+')';await _0x495dab['setStateAsync'](_0x3c33ad(0x10e),{'val':'['+_0x41fb91[_0x3c33ad(0x115)]()+']\x20'+_0xa9fed2,'ack':!![]});if(_0x41fb91===_0x3c33ad(0x107)){const _0x16ae12=await _0x495dab[_0x3c33ad(0x106)](_0x224510['id']);(!_0x16ae12||!_0x16ae12[_0x3c33ad(0xd4)]&&_0x16ae12[_0x3c33ad(0xd4)]!==!![])&&await _0x495dab['setForeignStateAsync'](_0x224510['id'],!![]),lastActions[_0x5682b5]=_0x28f417;}}async function findRelatedId(_0x9ef137,_0x4fbf9e,_0x2d6751=a1_0x4c137a(0x125)){const _0x1e3bf5=a1_0x4c137a;let _0x56deab=[];if(_0x2d6751===_0x1e3bf5(0x125))_0x56deab=[{'s':_0x1e3bf5(0x12c),'t':_0x1e3bf5(0x12a)},{'s':'.1.TEMPERATURE','t':'.1.SET_POINT_TEMPERATURE'},{'s':'.1.TEMPERATURE','t':_0x1e3bf5(0xe7)},{'s':_0x1e3bf5(0xf6),'t':_0x1e3bf5(0x11d)},{'s':_0x1e3bf5(0x10c),'t':_0x1e3bf5(0x138)},{'s':_0x1e3bf5(0x10c),'t':_0x1e3bf5(0xc2)},{'s':'temperature','t':_0x1e3bf5(0x108)},{'s':'ACTUAL','t':'SET'},{'s':_0x1e3bf5(0x12d),'t':_0x1e3bf5(0x121)},{'s':_0x1e3bf5(0xb8),'t':_0x1e3bf5(0x125)}];else _0x2d6751===_0x1e3bf5(0xbf)&&(_0x56deab=[{'s':_0x1e3bf5(0x12c),'t':_0x1e3bf5(0xec)},{'s':_0x1e3bf5(0xc3),'t':_0x1e3bf5(0xec)},{'s':_0x1e3bf5(0xc3),'t':_0x1e3bf5(0xd6)},{'s':_0x1e3bf5(0x10c),'t':_0x1e3bf5(0xf4)},{'s':'temperature','t':_0x1e3bf5(0xfe)},{'s':_0x1e3bf5(0xb8),'t':_0x1e3bf5(0xd8)}]);for(const _0xd89585 of _0x56deab){if(_0x4fbf9e[_0x1e3bf5(0xca)](_0xd89585['s'])){const _0x25802a=_0x4fbf9e[_0x1e3bf5(0xc8)](_0xd89585['s'],_0xd89585['t']),_0x33c470=await _0x9ef137['getForeignObjectAsync'](_0x25802a);if(_0x33c470)return _0x25802a;}}try{const _0x481c70=_0x4fbf9e[_0x1e3bf5(0x132)]('.');if(_0x481c70['length']>0x2){const _0xc7bb4e=_0x481c70[_0x1e3bf5(0x123)](0x0,-0x1)[_0x1e3bf5(0xea)]('.'),_0x18a4d6=await _0x9ef137[_0x1e3bf5(0x10f)](_0xc7bb4e+'.*'),_0x10d89a=[],_0x53b5b9=_0x4fbf9e[_0x1e3bf5(0x132)](/[._]+/)[_0x1e3bf5(0xfa)](_0xd2b950=>!['openknx','0',_0x1e3bf5(0x111),_0x1e3bf5(0x104),_0x1e3bf5(0xeb),_0x1e3bf5(0xb8),_0x1e3bf5(0x124),_0x1e3bf5(0x118),'messwert',_0x1e3bf5(0xd0)][_0x1e3bf5(0xca)](_0xd2b950['toLowerCase']()));for(const [_0x40e7d7,_0x570f08]of Object[_0x1e3bf5(0xdc)](_0x18a4d6)){if(_0x40e7d7===_0x4fbf9e)continue;if(_0x570f08&&_0x570f08[_0x1e3bf5(0x135)]){const _0x465568=_0x40e7d7['toLowerCase'](),_0x561228=(_0x570f08['common'][_0x1e3bf5(0xe1)]||'')[_0x1e3bf5(0xc4)](),_0xfe40c0=(_0x570f08[_0x1e3bf5(0x135)][_0x1e3bf5(0xc7)]||'')[_0x1e3bf5(0xc4)]();let _0x57d982=![];if(_0x2d6751===_0x1e3bf5(0x125)&&_0x570f08['common'][_0x1e3bf5(0x117)]===!![])_0x57d982=_0x465568['includes']('set')||_0x465568[_0x1e3bf5(0xca)](_0x1e3bf5(0xfb))||_0x465568[_0x1e3bf5(0xca)](_0x1e3bf5(0xb9))||_0x561228[_0x1e3bf5(0xca)]('level.temperature')||_0x561228[_0x1e3bf5(0xca)]('thermostat.setpoint');else _0x2d6751===_0x1e3bf5(0xbf)&&(_0x57d982=_0x465568[_0x1e3bf5(0xca)](_0x1e3bf5(0xd8))||_0x465568[_0x1e3bf5(0xca)](_0x1e3bf5(0xbf))||_0x465568[_0x1e3bf5(0xca)](_0x1e3bf5(0xfd))||_0x465568[_0x1e3bf5(0xca)](_0x1e3bf5(0xfc))||_0x561228['includes'](_0x1e3bf5(0xe3))||_0x561228[_0x1e3bf5(0xca)](_0x1e3bf5(0xef))||_0xfe40c0[_0x1e3bf5(0xca)]('%'));if(_0x57d982){const _0x390029=_0x40e7d7[_0x1e3bf5(0x132)](/[._]+/)['map'](_0x4c10d6=>_0x4c10d6[_0x1e3bf5(0xc4)]());let _0x58a23a=0x0;_0x53b5b9[_0x1e3bf5(0xb7)](_0x174b2f=>{const _0x2a2e81=_0x1e3bf5;if(_0x390029[_0x2a2e81(0xca)](_0x174b2f[_0x2a2e81(0xc4)]()))_0x58a23a++;}),_0x10d89a['push']({'id':_0x40e7d7,'score':_0x58a23a});}}}if(_0x10d89a[_0x1e3bf5(0x11c)]>0x0){_0x10d89a[_0x1e3bf5(0xff)]((_0x14e77a,_0x34d50a)=>_0x34d50a[_0x1e3bf5(0x131)]-_0x14e77a[_0x1e3bf5(0x131)]);if(_0x10d89a[0x0][_0x1e3bf5(0x131)]>0x0)return _0x10d89a[0x0]['id'];}}}catch(_0x283ace){}return null;}async function scanThermostats(_0x1a51d5){const _0x4d788d=a1_0x4c137a,_0xfaa2ad=_0x1a51d5[_0x4d788d(0x103)][_0x4d788d(0x136)]||[],_0x5b89a8=[],_0x43f61f=_0xfaa2ad[_0x4d788d(0xfa)](_0x2f1920=>_0x2f1920['id']&&_0x2f1920['id']['includes'](_0x4d788d(0xb8))||_0x2f1920[_0x4d788d(0xbd)]&&['temperature',_0x4d788d(0xe5),'sensor'][_0x4d788d(0xca)](_0x2f1920['type'])||_0x2f1920['name']&&_0x2f1920[_0x4d788d(0xee)][_0x4d788d(0xc4)]()[_0x4d788d(0xca)](_0x4d788d(0x10b)));for(const _0x17a63f of _0x43f61f){const _0xbe6684=await findRelatedId(_0x1a51d5,_0x17a63f['id'],_0x4d788d(0x125)),_0x57a2b1=await findRelatedId(_0x1a51d5,_0x17a63f['id'],'valve');let _0x562132=_0x4d788d(0xc5),_0x4ee6da=![],_0x510172=_0x1a51d5[_0x4d788d(0x103)]['thermostatMapping']||{};if(typeof _0x510172==='string')try{_0x510172=JSON[_0x4d788d(0xdb)](_0x510172);}catch(_0x225bbb){}if(_0x510172[_0x17a63f['id']]&&_0x510172[_0x17a63f['id']]===_0xbe6684)_0x562132='Manuelles\x20Mapping',_0x4ee6da=!![];else _0xbe6684&&(_0x562132=_0x4d788d(0xe6));_0x5b89a8[_0x4d788d(0x102)]({'room':_0x17a63f[_0x4d788d(0xf5)]||_0x4d788d(0x11e),'sensorId':_0x17a63f['id'],'setpointId':_0xbe6684||'-','valveId':_0x57a2b1||'-','source':_0x562132,'isManual':_0x4ee6da,'status':_0xbe6684&&_0x57a2b1?_0x4d788d(0x12b):_0xbe6684?'OK':_0x4d788d(0xd3)});}return _0x5b89a8[_0x4d788d(0xff)]((_0x11e05e,_0xbdcbd2)=>_0x11e05e[_0x4d788d(0xe2)]['localeCompare'](_0xbdcbd2[_0x4d788d(0xe2)]));}async function checkCalendarTriggers(_0x14cae9){const _0x401575=a1_0x4c137a;if(!_0x14cae9[_0x401575(0x103)][_0x401575(0x113)]||!_0x14cae9[_0x401575(0x103)][_0x401575(0x133)])return;let _0x3c86ef={};try{const _0x2a812d=await _0x14cae9[_0x401575(0xe8)](_0x401575(0x127));if(_0x2a812d&&_0x2a812d[_0x401575(0xd4)])_0x3c86ef=JSON[_0x401575(0xdb)](_0x2a812d[_0x401575(0xd4)]);}catch(_0x265cb4){}try{const _0x447b9b=await _0x14cae9['getForeignStateAsync'](_0x14cae9[_0x401575(0x103)]['calendarInstance']+'.data.table');if(!_0x447b9b||!_0x447b9b['val'])return;const _0x24e0e2=JSON[_0x401575(0xdb)](_0x447b9b[_0x401575(0xd4)]),_0x536075=new Date(),_0x236288=_0x14cae9['config'][_0x401575(0x136)]||[],_0x37cc64=_0x14cae9[_0x401575(0x103)][_0x401575(0xd2)]||[];for(const _0x7f8fd7 of _0x24e0e2){if(_0x7f8fd7[_0x401575(0x11a)]&&_0x37cc64['length']>0x0&&!_0x37cc64['includes'](_0x7f8fd7['_calName']))continue;const _0x426847=new Date(_0x7f8fd7[_0x401575(0x105)]),_0x3be01a=(_0x7f8fd7[_0x401575(0xbc)]||_0x7f8fd7['summary']||'')[_0x401575(0xc4)]();if(_0x3be01a[_0x401575(0xca)](_0x401575(0xf9))||_0x3be01a[_0x401575(0xca)](_0x401575(0xcd))||_0x3be01a['includes'](_0x401575(0xd1))){let _0x3aa20b=0x0;Object[_0x401575(0x120)](_0x3c86ef)[_0x401575(0xb7)](_0x571e6d=>{if(_0x571e6d>_0x3aa20b)_0x3aa20b=_0x571e6d;});if(_0x3aa20b===0x0)_0x3aa20b=0x78;const _0x5c5344=new Date(_0x426847[_0x401575(0xf7)]()-_0x3aa20b*0xea60),_0x127ece=_0x536075[_0x401575(0xf7)]()-_0x5c5344['getTime']();_0x127ece>=0x0&&_0x127ece<0xf*0xea60&&(_0x14cae9['log'][_0x401575(0xde)](_0x401575(0xe0)+_0x7f8fd7[_0x401575(0xbc)]+_0x401575(0xc1)+_0x3aa20b+'\x20min).'),await _0x14cae9[_0x401575(0xf8)](_0x401575(0xe4),{'val':_0x401575(0x10d),'ack':![]}));}for(const _0x4500a6 of _0x236288){if(_0x4500a6[_0x401575(0xf5)]){const _0x57ed48=_0x4500a6['location'][_0x401575(0xc4)]();if(_0x3be01a['includes'](_0x57ed48)){const _0x5ddaaa=_0x3c86ef[_0x4500a6[_0x401575(0xf5)]]||0x3c,_0x358b9c=new Date(_0x426847[_0x401575(0xf7)]()-_0x5ddaaa*0xea60),_0x44a331=_0x536075[_0x401575(0xf7)]()-_0x358b9c[_0x401575(0xf7)]();if(_0x44a331>=0x0&&_0x44a331<0xf*0xea60){const _0x594c0c=await findRelatedId(_0x14cae9,_0x4500a6['id'],_0x401575(0x125));_0x594c0c&&(_0x14cae9[_0x401575(0xc6)][_0x401575(0xde)](_0x401575(0xdd)+_0x4500a6[_0x401575(0xf5)]+'\x27\x20erkannt\x20('+_0x7f8fd7[_0x401575(0xbc)]+_0x401575(0x134)+_0x5ddaaa+'\x20min).'),await _0x14cae9['setForeignStateAsync'](_0x594c0c,0x15),await _0x14cae9[_0x401575(0xf8)](_0x401575(0x10e),{'val':_0x401575(0x109)+_0x4500a6[_0x401575(0xf5)]+_0x401575(0xbb),'ack':!![]}));}}}}}}catch(_0x4f4440){_0x14cae9['log'][_0x401575(0x101)]('Calendar\x20Check\x20Error:\x20'+_0x4f4440['message']);}}async function applyEnergySavings(_0xfc6914,_0xccdb73){const _0x36bbf5=a1_0x4c137a,_0x2c69c2=_0xfc6914[_0x36bbf5(0x103)][_0x36bbf5(0x136)]||[];for(const _0x525003 of _0xccdb73){const _0x34d278=_0x525003[_0x36bbf5(0xe2)],_0x9b97c1=_0x525003[_0x36bbf5(0x128)],_0x343a64=Date[_0x36bbf5(0xcf)]();if(lastActions[_0x36bbf5(0xd5)+_0x34d278]&&_0x343a64-lastActions['mpc_'+_0x34d278]<0x1e*0x3c*0x3e8)continue;const _0x1014e9=_0x2c69c2[_0x36bbf5(0xf3)](_0x2d446e=>normalize(_0x2d446e[_0x36bbf5(0xf5)])===normalize(_0x34d278));if(!_0x1014e9)continue;const _0x101b56=await findRelatedId(_0xfc6914,_0x1014e9['id'],_0x36bbf5(0x125));if(_0x101b56){const _0xd6a127=await _0xfc6914[_0x36bbf5(0x106)](_0x101b56);if(_0xd6a127&&typeof _0xd6a127[_0x36bbf5(0xd4)]==='number'){const _0xa5b956=_0xd6a127['val'];if(_0x9b97c1>0x1e&&_0xa5b956>0x11){const _0x139a34=_0xa5b956-0x1;_0xfc6914[_0x36bbf5(0xc6)]['info'](_0x36bbf5(0x130)+_0x34d278+'\x20('+_0x101b56+')\x20auf\x20'+_0x139a34+_0x36bbf5(0xe9)+_0x9b97c1+_0x36bbf5(0x112)),await _0xfc6914[_0x36bbf5(0x137)](_0x101b56,_0x139a34),lastActions[_0x36bbf5(0xd5)+_0x34d278]=_0x343a64,await _0xfc6914[_0x36bbf5(0xf8)](_0x36bbf5(0x10e),{'val':'[MPC]\x20'+_0x34d278+':\x20-1Â°C\x20(Sparpotenzial\x20genutzt)','ack':!![]});}}}}}module['exports']={'handlePrediction':handlePrediction,'applyEnergySavings':applyEnergySavings,'scanThermostats':scanThermostats,'checkCalendarTriggers':checkCalendarTriggers};