const a1_0x50b918=a1_0x5858;function a1_0x14f3(){const _0x1653fa=['local_temperature','Calendar\x20Check\x20Error:\x20','pi_heating_demand','5184724SwaRyo','Soll','10URcblL','.1.TEMPERATURE',').\x20Heize\x20auf\x2021Â°C\x20(Vorlauf:\x20','SET_POINT_TEMPERATURE','.4.SET_TEMPERATURE','valve_position','1690074wBbzaF','toString','Manuelles\x20Mapping','val','map','3KPfmKY','toLowerCase','score','.1.LEVEL','useCalendar','system.mode','stellwert','7335890FmLquF','consultButler','[CAL]\x20','\x20->\x20Schalte\x20','reason','current_heating_setpoint','\x20min)','slice','level','analysis.automation.confidenceThreshold','constructor','ðŸ“…\x20SMART\x20SCHEDULE:\x20\x27Globaler\x20Start\x27\x20erkannt\x20(','setpoint','setForeignStateAsync','write','./ai_agent','minutes_safe',':\x20-1Â°C\x20(Sparpotenzial\x20genutzt)','common','eventStart','ACTUAL_TEMPERATURE','valveMapping','exports','forEach','Unbekannt','Auto-Erkennung','find','devices','.1.ACTUAL_TEMPERATURE','target','mpc_','toUpperCase','PrÃ¤diktion:\x20','11466544pWvrBe','split','parse','number','warn','name','temperature','sort','location','1192522VnfWbj','1171017SkABYY','summary','temp','ðŸ”\x20Device-Search\x20failed\x20for\x20predicted\x20room\x20\x27','includes','[MPC]\x20','config','off','now','level.valve','openknx','log','message','approved','rÃ¼ckkehr','sensor','role','Unknown','occupied_heating_setpoint','28JEvFKA','filter','hm-rpc','state','calendarInstance','unit','event','getForeignStateAsync','messwert','316986EwpMaW','target_temperature','ACTUAL','getForeignObjectsAsync','setStateAsync','Nicht\x20gefunden','ankunft','valve','wert','ðŸƒ\x20MPC\x20Autonomy:\x20Senke\x20','length','(((.+)+)+)+$','room','trim','thermostatMapping','info',')\x20auf\x20','.1.SET_POINT_TEMPERATURE','type','search','string','analysis.automation.mode','\x20min).','ist','getTime','active','join','SET','getStateAsync','switch','entries','light','level.temperature','position','dimmer','calendarSelection','ðŸ“…\x20SMART\x20SCHEDULE:\x20Raum-Trigger\x20\x27','debug','replace','analysis.automation.lastAction','analysis.energy.warmupTimes','apply','_calName','\x20->\x2021Â°C'];a1_0x14f3=function(){return _0x1653fa;};return a1_0x14f3();}(function(_0x1cf055,_0x35a142){const _0x2e785e=a1_0x5858,_0x5b83d3=_0x1cf055();while(!![]){try{const _0x31d2f3=parseInt(_0x2e785e(0x16c))/0x1+parseInt(_0x2e785e(0x16b))/0x2*(parseInt(_0x2e785e(0x1c4))/0x3)+-parseInt(_0x2e785e(0x1b7))/0x4+-parseInt(_0x2e785e(0x1cb))/0x5+-parseInt(_0x2e785e(0x188))/0x6*(-parseInt(_0x2e785e(0x17f))/0x7)+parseInt(_0x2e785e(0x162))/0x8+parseInt(_0x2e785e(0x1bf))/0x9*(parseInt(_0x2e785e(0x1b9))/0xa);if(_0x31d2f3===_0x35a142)break;else _0x5b83d3['push'](_0x5b83d3['shift']());}catch(_0x15e67f){_0x5b83d3['push'](_0x5b83d3['shift']());}}}(a1_0x14f3,0xcc2fb));const a1_0x9ba12c=(function(){let _0x14ca43=!![];return function(_0x251e42,_0x5cafb2){const _0x4cf627=_0x14ca43?function(){const _0x25c72d=a1_0x5858;if(_0x5cafb2){const _0x3a9e9d=_0x5cafb2[_0x25c72d(0x1b1)](_0x251e42,arguments);return _0x5cafb2=null,_0x3a9e9d;}}:function(){};return _0x14ca43=![],_0x4cf627;};}()),a1_0x5d08ae=a1_0x9ba12c(this,function(){const _0x4ed702=a1_0x5858;return a1_0x5d08ae[_0x4ed702(0x1c0)]()[_0x4ed702(0x19b)](_0x4ed702(0x193))[_0x4ed702(0x1c0)]()[_0x4ed702(0x1d5)](a1_0x5d08ae)['search'](_0x4ed702(0x193));});a1_0x5d08ae();'use strict';const aiAgent=require(a1_0x50b918(0x1da)),COOLDOWN_MS=0x3c*0x3e8,lastActions={};function normalize(_0x255abd){const _0x1c4011=a1_0x50b918;if(!_0x255abd)return'';return _0x255abd['toLowerCase']()[_0x1c4011(0x1ae)](/\s+/g,'')[_0x1c4011(0x195)]();}async function handlePrediction(_0x1c8cc3,_0x12d711,_0x6f66b4){const _0x1c588f=a1_0x50b918;if(!_0x12d711||_0x12d711===_0x1c588f(0x17d))return;let _0x1f1246='off',_0x73b960=0.6;try{const _0x5d19aa=await _0x1c8cc3[_0x1c588f(0x1a4)](_0x1c588f(0x19d));if(_0x5d19aa&&_0x5d19aa['val'])_0x1f1246=_0x5d19aa[_0x1c588f(0x1c2)];const _0xc29451=await _0x1c8cc3[_0x1c588f(0x1a4)](_0x1c588f(0x1d4));if(_0xc29451&&_0xc29451[_0x1c588f(0x1c2)])_0x73b960=_0xc29451[_0x1c588f(0x1c2)];}catch(_0x17ec0a){}if(_0x1f1246===_0x1c588f(0x173)||_0x6f66b4<_0x73b960)return;const _0x431bf8=Date[_0x1c588f(0x174)]();if(lastActions[_0x12d711]&&_0x431bf8-lastActions[_0x12d711]<COOLDOWN_MS)return;const _0x594817=_0x1c8cc3[_0x1c588f(0x172)][_0x1c588f(0x15c)]||[],_0x443e45=normalize(_0x12d711),_0x1c6442=_0x594817[_0x1c588f(0x15b)](_0x372ab9=>normalize(_0x372ab9[_0x1c588f(0x16a)])===_0x443e45&&(_0x372ab9[_0x1c588f(0x19a)]===_0x1c588f(0x1a7)||_0x372ab9[_0x1c588f(0x19a)]===_0x1c588f(0x1aa)||_0x372ab9['type']===_0x1c588f(0x1a5)));if(!_0x1c6442){_0x1c8cc3[_0x1c588f(0x177)][_0x1c588f(0x1ad)](_0x1c588f(0x16f)+_0x12d711+'\x27.');return;}const _0x1ff4b8=await aiAgent[_0x1c588f(0x1cc)](_0x1c8cc3,_0x12d711,_0x1c6442[_0x1c588f(0x167)],_0x6f66b4);if(!_0x1ff4b8[_0x1c588f(0x179)])return;const _0x38e572=_0x1c588f(0x161)+_0x12d711+_0x1c588f(0x1ce)+_0x1c6442[_0x1c588f(0x167)]+'\x20('+_0x1ff4b8[_0x1c588f(0x1cf)]+')';await _0x1c8cc3['setStateAsync'](_0x1c588f(0x1af),{'val':'['+_0x1f1246[_0x1c588f(0x160)]()+']\x20'+_0x38e572,'ack':!![]});if(_0x1f1246===_0x1c588f(0x1a1)){const _0x2c6952=await _0x1c8cc3[_0x1c588f(0x186)](_0x1c6442['id']);(!_0x2c6952||!_0x2c6952[_0x1c588f(0x1c2)]&&_0x2c6952['val']!==!![])&&await _0x1c8cc3['setForeignStateAsync'](_0x1c6442['id'],!![]),lastActions[_0x12d711]=_0x431bf8;}}function a1_0x5858(_0x4877c3,_0x535fa1){const _0xfa8d56=a1_0x14f3();return a1_0x5858=function(_0x5d08ae,_0x9ba12c){_0x5d08ae=_0x5d08ae-0x153;let _0x14f31d=_0xfa8d56[_0x5d08ae];return _0x14f31d;},a1_0x5858(_0x4877c3,_0x535fa1);}async function findRelatedId(_0x18172f,_0x1df915,_0x31c5e1=a1_0x50b918(0x1d7)){const _0x2d828a=a1_0x50b918;if(_0x31c5e1===_0x2d828a(0x1d7)&&_0x18172f[_0x2d828a(0x172)][_0x2d828a(0x196)]){let _0x412e3c=_0x18172f[_0x2d828a(0x172)][_0x2d828a(0x196)];if(typeof _0x412e3c===_0x2d828a(0x19c))try{_0x412e3c=JSON[_0x2d828a(0x164)](_0x412e3c);}catch(_0x906bc6){}if(_0x412e3c&&_0x412e3c[_0x1df915])return _0x412e3c[_0x1df915];}if(_0x31c5e1===_0x2d828a(0x18f)&&_0x18172f[_0x2d828a(0x172)][_0x2d828a(0x156)]){let _0x46c569=_0x18172f[_0x2d828a(0x172)]['valveMapping'];if(typeof _0x46c569===_0x2d828a(0x19c))try{_0x46c569=JSON[_0x2d828a(0x164)](_0x46c569);}catch(_0x18140e){}if(_0x46c569&&_0x46c569[_0x1df915])return _0x46c569[_0x1df915];}let _0x5cd4fc=[];if(_0x31c5e1===_0x2d828a(0x1d7))_0x5cd4fc=[{'s':_0x2d828a(0x15d),'t':_0x2d828a(0x199)},{'s':_0x2d828a(0x1ba),'t':'.1.SET_POINT_TEMPERATURE'},{'s':_0x2d828a(0x1ba),'t':_0x2d828a(0x1bd)},{'s':_0x2d828a(0x155),'t':_0x2d828a(0x1bc)},{'s':'local_temperature','t':_0x2d828a(0x17e)},{'s':_0x2d828a(0x1b4),'t':_0x2d828a(0x1d0)},{'s':_0x2d828a(0x168),'t':_0x2d828a(0x189)},{'s':_0x2d828a(0x18a),'t':_0x2d828a(0x1a3)},{'s':'Ist','t':_0x2d828a(0x1b8)},{'s':_0x2d828a(0x168),'t':_0x2d828a(0x1d7)}];else _0x31c5e1===_0x2d828a(0x18f)&&(_0x5cd4fc=[{'s':_0x2d828a(0x15d),'t':_0x2d828a(0x1c7)},{'s':_0x2d828a(0x1ba),'t':_0x2d828a(0x1c7)},{'s':_0x2d828a(0x1ba),'t':'.4.VALVE_STATE'},{'s':_0x2d828a(0x1b4),'t':_0x2d828a(0x1b6)},{'s':'temperature','t':_0x2d828a(0x1be)},{'s':_0x2d828a(0x168),'t':'level'}]);for(const _0x37038b of _0x5cd4fc){if(_0x1df915[_0x2d828a(0x170)](_0x37038b['s'])){const _0x3abf9d=_0x1df915[_0x2d828a(0x1ae)](_0x37038b['s'],_0x37038b['t']),_0x2b04e2=await _0x18172f['getForeignObjectAsync'](_0x3abf9d);if(_0x2b04e2)return _0x3abf9d;}}try{const _0x162297=_0x1df915[_0x2d828a(0x163)]('.');if(_0x162297[_0x2d828a(0x192)]>0x2){const _0x2e14d1=_0x162297[_0x2d828a(0x1d2)](0x0,-0x1)[_0x2d828a(0x1a2)]('.'),_0x599225=await _0x18172f[_0x2d828a(0x18b)](_0x2e14d1+'.*'),_0x3eb7ad=[],_0x4c0b0b=_0x1df915[_0x2d828a(0x163)](/[._]+/)['filter'](_0x1ddbb2=>![_0x2d828a(0x176),'0',_0x2d828a(0x181),_0x2d828a(0x19f),_0x2d828a(0x190),_0x2d828a(0x168),'actual','sensor',_0x2d828a(0x187),_0x2d828a(0x182)][_0x2d828a(0x170)](_0x1ddbb2['toLowerCase']()));for(const [_0x4216f3,_0x5359ff]of Object[_0x2d828a(0x1a6)](_0x599225)){if(_0x4216f3===_0x1df915)continue;if(_0x5359ff&&_0x5359ff[_0x2d828a(0x153)]){const _0x3a3bd4=_0x4216f3[_0x2d828a(0x1c5)](),_0x2b92b3=(_0x5359ff[_0x2d828a(0x153)][_0x2d828a(0x17c)]||'')['toLowerCase'](),_0x1fd294=(_0x5359ff['common'][_0x2d828a(0x184)]||'')['toLowerCase']();let _0x330365=![];if(_0x31c5e1===_0x2d828a(0x1d7)&&_0x5359ff[_0x2d828a(0x153)][_0x2d828a(0x1d9)]===!![])_0x330365=_0x3a3bd4[_0x2d828a(0x170)]('set')||_0x3a3bd4['includes']('soll')||_0x3a3bd4[_0x2d828a(0x170)](_0x2d828a(0x15e))||_0x2b92b3[_0x2d828a(0x170)](_0x2d828a(0x1a8))||_0x2b92b3[_0x2d828a(0x170)]('thermostat.setpoint');else _0x31c5e1==='valve'&&(_0x330365=_0x3a3bd4[_0x2d828a(0x170)](_0x2d828a(0x1d3))||_0x3a3bd4['includes'](_0x2d828a(0x18f))||_0x3a3bd4[_0x2d828a(0x170)](_0x2d828a(0x1ca))||_0x3a3bd4[_0x2d828a(0x170)](_0x2d828a(0x1a9))||_0x2b92b3[_0x2d828a(0x170)](_0x2d828a(0x175))||_0x2b92b3[_0x2d828a(0x170)]('value.valve')||_0x1fd294['includes']('%'));if(_0x330365){const _0x30446e=_0x4216f3['split'](/[._]+/)[_0x2d828a(0x1c3)](_0x378db3=>_0x378db3['toLowerCase']());let _0x4c09bb=0x0;_0x4c0b0b[_0x2d828a(0x158)](_0x208817=>{const _0x11981a=_0x2d828a;if(_0x30446e[_0x11981a(0x170)](_0x208817[_0x11981a(0x1c5)]()))_0x4c09bb++;}),_0x3eb7ad['push']({'id':_0x4216f3,'score':_0x4c09bb});}}}if(_0x3eb7ad[_0x2d828a(0x192)]>0x0){_0x3eb7ad[_0x2d828a(0x169)]((_0x3156ea,_0x29500e)=>_0x29500e[_0x2d828a(0x1c6)]-_0x3156ea[_0x2d828a(0x1c6)]);if(_0x3eb7ad[0x0][_0x2d828a(0x1c6)]>0x0)return _0x3eb7ad[0x0]['id'];}}}catch(_0x5f0280){}return null;}async function scanThermostats(_0x2e8307){const _0x3f9d7f=a1_0x50b918,_0x477e9b=_0x2e8307[_0x3f9d7f(0x172)]['devices']||[],_0x28db02=[],_0xce7087=_0x477e9b[_0x3f9d7f(0x180)](_0x22b3e0=>_0x22b3e0['id']&&_0x22b3e0['id'][_0x3f9d7f(0x170)]('temperature')||_0x22b3e0[_0x3f9d7f(0x19a)]&&['temperature','thermostat',_0x3f9d7f(0x17b)]['includes'](_0x22b3e0[_0x3f9d7f(0x19a)])||_0x22b3e0[_0x3f9d7f(0x167)]&&_0x22b3e0[_0x3f9d7f(0x167)][_0x3f9d7f(0x1c5)]()['includes'](_0x3f9d7f(0x16e)));for(const _0x3360cd of _0xce7087){const _0x47c958=await findRelatedId(_0x2e8307,_0x3360cd['id'],_0x3f9d7f(0x1d7)),_0xa25140=await findRelatedId(_0x2e8307,_0x3360cd['id'],_0x3f9d7f(0x18f));let _0x71a3ce=_0x3f9d7f(0x18d),_0x1e51f4=![],_0x8bf984=_0x2e8307['config'][_0x3f9d7f(0x196)]||{};if(typeof _0x8bf984==='string')try{_0x8bf984=JSON[_0x3f9d7f(0x164)](_0x8bf984);}catch(_0x30f161){}let _0x5ec99f=_0x2e8307['config'][_0x3f9d7f(0x156)]||{};if(typeof _0x5ec99f===_0x3f9d7f(0x19c))try{_0x5ec99f=JSON[_0x3f9d7f(0x164)](_0x5ec99f);}catch(_0x2bd69c){}if(_0x8bf984[_0x3360cd['id']]&&_0x8bf984[_0x3360cd['id']]===_0x47c958||_0x5ec99f[_0x3360cd['id']]&&_0x5ec99f[_0x3360cd['id']]===_0xa25140)_0x71a3ce=_0x3f9d7f(0x1c1),_0x1e51f4=!![];else(_0x47c958||_0xa25140)&&(_0x71a3ce=_0x3f9d7f(0x15a));_0x28db02['push']({'room':_0x3360cd[_0x3f9d7f(0x16a)]||_0x3f9d7f(0x159),'sensorId':_0x3360cd['id'],'setpointId':_0x47c958||'-','valveId':_0xa25140||'-','source':_0x71a3ce,'isManual':_0x1e51f4,'status':_0x47c958&&_0xa25140?'PERFECT':_0x47c958?'OK':'Fehlt'});}return _0x28db02['sort']((_0x599c1c,_0x17228a)=>_0x599c1c[_0x3f9d7f(0x194)]['localeCompare'](_0x17228a['room']));}async function checkCalendarTriggers(_0x145a08){const _0x5645d2=a1_0x50b918;if(!_0x145a08[_0x5645d2(0x172)][_0x5645d2(0x1c8)]||!_0x145a08[_0x5645d2(0x172)][_0x5645d2(0x183)])return;let _0x503eff={};try{const _0x335e12=await _0x145a08[_0x5645d2(0x1a4)](_0x5645d2(0x1b0));if(_0x335e12&&_0x335e12['val'])_0x503eff=JSON[_0x5645d2(0x164)](_0x335e12[_0x5645d2(0x1c2)]);}catch(_0x298c41){}try{const _0x342783=await _0x145a08[_0x5645d2(0x186)](_0x145a08[_0x5645d2(0x172)][_0x5645d2(0x183)]+'.data.table');if(!_0x342783||!_0x342783['val'])return;const _0x14246e=JSON['parse'](_0x342783[_0x5645d2(0x1c2)]),_0x11308c=new Date(),_0x21e98d=_0x145a08[_0x5645d2(0x172)][_0x5645d2(0x15c)]||[],_0xa4d07d=_0x145a08[_0x5645d2(0x172)][_0x5645d2(0x1ab)]||[];for(const _0x25fb18 of _0x14246e){if(_0x25fb18[_0x5645d2(0x1b2)]&&_0xa4d07d[_0x5645d2(0x192)]>0x0&&!_0xa4d07d[_0x5645d2(0x170)](_0x25fb18[_0x5645d2(0x1b2)]))continue;const _0x46f6a3=new Date(_0x25fb18[_0x5645d2(0x154)]),_0x4b349a=(_0x25fb18['event']||_0x25fb18[_0x5645d2(0x16d)]||'')[_0x5645d2(0x1c5)]();if(_0x4b349a['includes']('urlaub\x20ende')||_0x4b349a[_0x5645d2(0x170)](_0x5645d2(0x17a))||_0x4b349a[_0x5645d2(0x170)](_0x5645d2(0x18e))){let _0x15b715=0x0;Object['values'](_0x503eff)['forEach'](_0x461bee=>{if(_0x461bee>_0x15b715)_0x15b715=_0x461bee;});if(_0x15b715===0x0)_0x15b715=0x78;const _0x23067c=new Date(_0x46f6a3[_0x5645d2(0x1a0)]()-_0x15b715*0xea60),_0x8fa3da=_0x11308c['getTime']()-_0x23067c[_0x5645d2(0x1a0)]();_0x8fa3da>=0x0&&_0x8fa3da<0xf*0xea60&&(_0x145a08['log'][_0x5645d2(0x197)](_0x5645d2(0x1d6)+_0x25fb18[_0x5645d2(0x185)]+').\x20Heize\x20ganzes\x20Haus\x20auf\x20(Vorlauf:\x20'+_0x15b715+'\x20min).'),await _0x145a08[_0x5645d2(0x18c)](_0x5645d2(0x1c9),{'val':'normal','ack':![]}));}for(const _0x3a4ba4 of _0x21e98d){if(_0x3a4ba4[_0x5645d2(0x16a)]){const _0x433eda=_0x3a4ba4['location'][_0x5645d2(0x1c5)]();if(_0x4b349a['includes'](_0x433eda)){const _0x1edce3=_0x503eff[_0x3a4ba4[_0x5645d2(0x16a)]]||0x3c,_0x12e5e4=new Date(_0x46f6a3['getTime']()-_0x1edce3*0xea60),_0x1c6d8c=_0x11308c[_0x5645d2(0x1a0)]()-_0x12e5e4[_0x5645d2(0x1a0)]();if(_0x1c6d8c>=0x0&&_0x1c6d8c<0xf*0xea60){const _0xff3e7a=await findRelatedId(_0x145a08,_0x3a4ba4['id'],'setpoint');_0xff3e7a&&(_0x145a08[_0x5645d2(0x177)][_0x5645d2(0x197)](_0x5645d2(0x1ac)+_0x3a4ba4['location']+'\x27\x20erkannt\x20('+_0x25fb18['event']+_0x5645d2(0x1bb)+_0x1edce3+_0x5645d2(0x19e)),await _0x145a08[_0x5645d2(0x1d8)](_0xff3e7a,0x15),await _0x145a08[_0x5645d2(0x18c)](_0x5645d2(0x1af),{'val':_0x5645d2(0x1cd)+_0x3a4ba4[_0x5645d2(0x16a)]+_0x5645d2(0x1b3),'ack':!![]}));}}}}}}catch(_0x1f475a){_0x145a08[_0x5645d2(0x177)][_0x5645d2(0x166)](_0x5645d2(0x1b5)+_0x1f475a[_0x5645d2(0x178)]);}}async function applyEnergySavings(_0x2a7728,_0x348677){const _0x288926=a1_0x50b918,_0x418c7d=_0x2a7728['config'][_0x288926(0x15c)]||[];for(const _0x2cfe43 of _0x348677){const _0x286593=_0x2cfe43['room'],_0x3aa943=_0x2cfe43[_0x288926(0x1db)],_0xc04f18=Date['now']();if(lastActions[_0x288926(0x15f)+_0x286593]&&_0xc04f18-lastActions[_0x288926(0x15f)+_0x286593]<0x1e*0x3c*0x3e8)continue;const _0x5961fa=_0x418c7d['find'](_0x55bd93=>normalize(_0x55bd93[_0x288926(0x16a)])===normalize(_0x286593));if(!_0x5961fa)continue;const _0x106dfa=await findRelatedId(_0x2a7728,_0x5961fa['id'],_0x288926(0x1d7));if(_0x106dfa){const _0x5cdf03=await _0x2a7728['getForeignStateAsync'](_0x106dfa);if(_0x5cdf03&&typeof _0x5cdf03[_0x288926(0x1c2)]===_0x288926(0x165)){const _0x5c2bcc=_0x5cdf03[_0x288926(0x1c2)];if(_0x3aa943>0x1e&&_0x5c2bcc>0x11){const _0x11ad8b=_0x5c2bcc-0x1;_0x2a7728['log'][_0x288926(0x197)](_0x288926(0x191)+_0x286593+'\x20('+_0x106dfa+_0x288926(0x198)+_0x11ad8b+'Â°C\x20(Coasting\x20mÃ¶glich:\x20'+_0x3aa943+_0x288926(0x1d1)),await _0x2a7728[_0x288926(0x1d8)](_0x106dfa,_0x11ad8b),lastActions['mpc_'+_0x286593]=_0xc04f18,await _0x2a7728[_0x288926(0x18c)]('analysis.automation.lastAction',{'val':_0x288926(0x171)+_0x286593+_0x288926(0x1dc),'ack':!![]});}}}}}module[a1_0x50b918(0x157)]={'handlePrediction':handlePrediction,'applyEnergySavings':applyEnergySavings,'scanThermostats':scanThermostats,'checkCalendarTriggers':checkCalendarTriggers};