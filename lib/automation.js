const a1_0x3b6152=a1_0x425d;(function(_0x1e7e03,_0x177e65){const _0x2319a9=a1_0x425d,_0x1ee4a7=_0x1e7e03();while(!![]){try{const _0x2e44bd=parseInt(_0x2319a9(0xeb))/0x1+parseInt(_0x2319a9(0x7f))/0x2+-parseInt(_0x2319a9(0xb5))/0x3+parseInt(_0x2319a9(0xb1))/0x4*(parseInt(_0x2319a9(0x7c))/0x5)+-parseInt(_0x2319a9(0xad))/0x6+-parseInt(_0x2319a9(0xda))/0x7*(-parseInt(_0x2319a9(0xd6))/0x8)+-parseInt(_0x2319a9(0x82))/0x9;if(_0x2e44bd===_0x177e65)break;else _0x1ee4a7['push'](_0x1ee4a7['shift']());}catch(_0x230a44){_0x1ee4a7['push'](_0x1ee4a7['shift']());}}}(a1_0x2205,0xd60a3));const a1_0x130356=(function(){let _0x152ed3=!![];return function(_0x4f1066,_0xda86c2){const _0x446106=_0x152ed3?function(){const _0x52a7e5=a1_0x425d;if(_0xda86c2){const _0x398d7a=_0xda86c2[_0x52a7e5(0xc8)](_0x4f1066,arguments);return _0xda86c2=null,_0x398d7a;}}:function(){};return _0x152ed3=![],_0x446106;};}()),a1_0x2ad592=a1_0x130356(this,function(){const _0x1e4c97=a1_0x425d;return a1_0x2ad592[_0x1e4c97(0xbd)]()[_0x1e4c97(0xee)](_0x1e4c97(0x77))[_0x1e4c97(0xbd)]()['constructor'](a1_0x2ad592)[_0x1e4c97(0xee)]('(((.+)+)+)+$');});a1_0x2ad592();'use strict';const aiAgent=require(a1_0x3b6152(0xe7)),COOLDOWN_MS=0x3c*0x3e8,CAL_COOLDOWN_MS=0x5a*0x3c*0x3e8,RESCUE_LOCK_MS=0x78*0x3c*0x3e8,ECO_TEMP=0x11,lastActions={};function normalize(_0x1f4113){const _0x5aba01=a1_0x3b6152;if(!_0x1f4113)return'';return _0x1f4113[_0x5aba01(0x110)]()[_0x5aba01(0xe6)](/\s+/g,'')['trim']();}async function logAutomationAction(_0x4e8915,_0x22d389){const _0x411191=a1_0x3b6152;await _0x4e8915[_0x411191(0xf3)](_0x411191(0xe2),{'val':_0x22d389,'ack':!![]});try{const _0x173b71='analysis.automation.actionLog',_0x14f048=await _0x4e8915[_0x411191(0x10f)](_0x173b71);let _0x3a2c3f=[];if(_0x14f048&&_0x14f048[_0x411191(0xc9)])try{_0x3a2c3f=JSON[_0x411191(0xe1)](_0x14f048[_0x411191(0xc9)]);}catch(_0x1f1ed4){}_0x3a2c3f[_0x411191(0xa8)]({'ts':Date[_0x411191(0xf6)](),'msg':_0x22d389});if(_0x3a2c3f[_0x411191(0x11c)]>0x32)_0x3a2c3f=_0x3a2c3f[_0x411191(0x96)](0x0,0x32);await _0x4e8915[_0x411191(0xf3)](_0x173b71,{'val':JSON[_0x411191(0xcf)](_0x3a2c3f),'ack':!![]});}catch(_0xc29c44){}}async function handlePrediction(_0x5f1f9e,_0x38993b,_0x5187a0){const _0x2c6f6b=a1_0x3b6152;if(!_0x38993b||_0x38993b==='Unknown')return;let _0x3f41cf=_0x2c6f6b(0x107),_0x79995c=0.6;try{const _0x5abd0a=await _0x5f1f9e[_0x2c6f6b(0x10f)](_0x2c6f6b(0x90));if(_0x5abd0a&&_0x5abd0a[_0x2c6f6b(0xc9)])_0x3f41cf=_0x5abd0a[_0x2c6f6b(0xc9)];const _0x40af2a=await _0x5f1f9e[_0x2c6f6b(0x10f)](_0x2c6f6b(0x119));if(_0x40af2a&&_0x40af2a[_0x2c6f6b(0xc9)])_0x79995c=_0x40af2a[_0x2c6f6b(0xc9)];}catch(_0x26dd14){}if(_0x3f41cf==='off'||_0x5187a0<_0x79995c)return;const _0x4745f8=Date['now']();if(lastActions[_0x38993b]&&_0x4745f8-lastActions[_0x38993b]<COOLDOWN_MS)return;const _0x208d9e=_0x5f1f9e[_0x2c6f6b(0xd0)][_0x2c6f6b(0xef)]||[],_0x1605ca=normalize(_0x38993b),_0x24c4b4=_0x208d9e[_0x2c6f6b(0xbb)](_0x302f16=>normalize(_0x302f16[_0x2c6f6b(0xe0)])===_0x1605ca&&(_0x302f16[_0x2c6f6b(0xec)]===_0x2c6f6b(0x102)||_0x302f16[_0x2c6f6b(0xec)]===_0x2c6f6b(0x10c)||_0x302f16[_0x2c6f6b(0xec)]===_0x2c6f6b(0x108)));if(!_0x24c4b4)return;const _0x2c10e8=await aiAgent[_0x2c6f6b(0xca)](_0x5f1f9e,_0x38993b,_0x24c4b4[_0x2c6f6b(0x8d)],_0x5187a0);if(!_0x2c10e8[_0x2c6f6b(0x92)])return;const _0x345948=_0x2c6f6b(0x80)+_0x38993b+_0x2c6f6b(0x8c)+_0x24c4b4[_0x2c6f6b(0x8d)]+'\x20('+_0x2c10e8['reason']+')';await logAutomationAction(_0x5f1f9e,'['+_0x3f41cf[_0x2c6f6b(0xf9)]()+']\x20'+_0x345948);if(_0x3f41cf===_0x2c6f6b(0xd8)){const _0x30fae2=await _0x5f1f9e[_0x2c6f6b(0x11d)](_0x24c4b4['id']);(!_0x30fae2||!_0x30fae2[_0x2c6f6b(0xc9)]&&_0x30fae2[_0x2c6f6b(0xc9)]!==!![])&&await _0x5f1f9e[_0x2c6f6b(0x9b)](_0x24c4b4['id'],!![]),lastActions[_0x38993b]=_0x4745f8;}}async function findRelatedId(_0x1ff1da,_0x451f6b,_0x1d69bb=a1_0x3b6152(0xe3)){const _0x242add=a1_0x3b6152;if(_0x1d69bb==='setpoint'&&_0x1ff1da[_0x242add(0xd0)][_0x242add(0x8a)]){let _0x121331=_0x1ff1da[_0x242add(0xd0)][_0x242add(0x8a)];if(typeof _0x121331==='string')try{_0x121331=JSON['parse'](_0x121331);}catch(_0x458bb7){}if(_0x121331&&_0x121331[_0x451f6b])return _0x121331[_0x451f6b];}if(_0x1d69bb===_0x242add(0x105)&&_0x1ff1da[_0x242add(0xd0)][_0x242add(0xd3)]){let _0x361654=_0x1ff1da[_0x242add(0xd0)]['valveMapping'];if(typeof _0x361654===_0x242add(0xd9))try{_0x361654=JSON['parse'](_0x361654);}catch(_0x309567){}if(_0x361654&&_0x361654[_0x451f6b])return _0x361654[_0x451f6b];}let _0x54eba2=[];if(_0x1d69bb===_0x242add(0xe3))_0x54eba2=[{'s':_0x242add(0x85),'t':_0x242add(0xe8)},{'s':_0x242add(0xc6),'t':_0x242add(0xe8)},{'s':_0x242add(0xc6),'t':_0x242add(0xfd)},{'s':_0x242add(0xf7),'t':_0x242add(0xbc)},{'s':_0x242add(0x84),'t':_0x242add(0x79)},{'s':_0x242add(0x84),'t':_0x242add(0xac)},{'s':_0x242add(0x112),'t':_0x242add(0x8f)},{'s':_0x242add(0x106),'t':_0x242add(0xb7)},{'s':'Ist','t':'Soll'},{'s':_0x242add(0x112),'t':_0x242add(0xe3)}];else _0x1d69bb===_0x242add(0x105)&&(_0x54eba2=[{'s':_0x242add(0x85),'t':_0x242add(0x86)},{'s':_0x242add(0xc6),'t':'.1.LEVEL'},{'s':'.1.TEMPERATURE','t':'.4.VALVE_STATE'},{'s':_0x242add(0x84),'t':_0x242add(0x76)},{'s':_0x242add(0x112),'t':_0x242add(0x95)},{'s':'temperature','t':'level'}]);for(const _0x4ab4ea of _0x54eba2){if(_0x451f6b[_0x242add(0x68)](_0x4ab4ea['s'])){const _0x12b044=_0x451f6b[_0x242add(0xe6)](_0x4ab4ea['s'],_0x4ab4ea['t']),_0x4e1624=await _0x1ff1da[_0x242add(0xd4)](_0x12b044);if(_0x4e1624)return _0x12b044;}}try{const _0x440b8a=_0x451f6b[_0x242add(0xbf)]('.');if(_0x440b8a['length']>0x2){const _0x433360=_0x440b8a[_0x242add(0x96)](0x0,-0x1)[_0x242add(0xdd)]('.'),_0x405e85=await _0x1ff1da[_0x242add(0x6c)](_0x433360+'.*'),_0x1db22f=[],_0x3a262c=_0x451f6b[_0x242add(0xbf)](/[._]+/)['filter'](_0x25563e=>![_0x242add(0x89),'0','hm-rpc',_0x242add(0xe4),_0x242add(0x94),_0x242add(0x112),_0x242add(0xa6),_0x242add(0xea),_0x242add(0xa1),_0x242add(0xb9)][_0x242add(0x68)](_0x25563e[_0x242add(0x110)]()));for(const [_0x8dbec5,_0x323f4c]of Object['entries'](_0x405e85)){if(_0x8dbec5===_0x451f6b)continue;if(_0x323f4c&&_0x323f4c[_0x242add(0xa2)]){const _0x11812f=_0x8dbec5[_0x242add(0x110)](),_0x984c37=(_0x323f4c[_0x242add(0xa2)][_0x242add(0xb3)]||'')[_0x242add(0x110)](),_0x50c3df=(_0x323f4c[_0x242add(0xa2)][_0x242add(0xf0)]||'')[_0x242add(0x110)]();let _0x3bf4b3=![];if(_0x1d69bb==='setpoint'&&_0x323f4c[_0x242add(0xa2)][_0x242add(0x10b)]===!![])_0x3bf4b3=_0x11812f[_0x242add(0x68)](_0x242add(0x8e))||_0x11812f[_0x242add(0x68)](_0x242add(0xf4))||_0x11812f[_0x242add(0x68)]('target')||_0x984c37['includes'](_0x242add(0xdb))||_0x984c37[_0x242add(0x68)](_0x242add(0xaa));else _0x1d69bb==='valve'&&(_0x3bf4b3=_0x11812f[_0x242add(0x68)](_0x242add(0xf2))||_0x11812f[_0x242add(0x68)](_0x242add(0x105))||_0x11812f['includes'](_0x242add(0x7b))||_0x11812f[_0x242add(0x68)]('position')||_0x984c37[_0x242add(0x68)](_0x242add(0xb8))||_0x984c37[_0x242add(0x68)](_0x242add(0x10d))||_0x50c3df[_0x242add(0x68)]('%'));if(_0x3bf4b3){const _0x4381dd=_0x8dbec5['split'](/[._]+/)[_0x242add(0x116)](_0x129102=>_0x129102['toLowerCase']());let _0x3dcd35=0x0;_0x3a262c['forEach'](_0x3a0f4b=>{const _0x23964c=_0x242add;if(_0x4381dd['includes'](_0x3a0f4b[_0x23964c(0x110)]()))_0x3dcd35++;}),_0x1db22f[_0x242add(0xcc)]({'id':_0x8dbec5,'score':_0x3dcd35});}}}if(_0x1db22f['length']>0x0){_0x1db22f['sort']((_0x3a850d,_0x2e8218)=>_0x2e8218[_0x242add(0x115)]-_0x3a850d[_0x242add(0x115)]);if(_0x1db22f[0x0][_0x242add(0x115)]>0x0)return _0x1db22f[0x0]['id'];}}}catch(_0x2cb0cf){}return null;}async function scanThermostats(_0x5ec3f1){const _0x8e4567=a1_0x3b6152,_0x3bc6a1=_0x5ec3f1['config'][_0x8e4567(0xef)]||[],_0x10135f=[],_0x499e7b=_0x3bc6a1[_0x8e4567(0xae)](_0x31802e=>_0x31802e['id']&&_0x31802e['id'][_0x8e4567(0x68)](_0x8e4567(0x112))||_0x31802e['type']&&['temperature',_0x8e4567(0xb4),_0x8e4567(0xea)][_0x8e4567(0x68)](_0x31802e['type'])||_0x31802e['name']&&_0x31802e['name'][_0x8e4567(0x110)]()['includes']('temp'));for(const _0x528ea2 of _0x499e7b){const _0x552a6b=await findRelatedId(_0x5ec3f1,_0x528ea2['id'],_0x8e4567(0xe3)),_0x36bdb5=await findRelatedId(_0x5ec3f1,_0x528ea2['id'],_0x8e4567(0x105));let _0x1975ed=_0x8e4567(0xcb),_0x19aeed=![],_0x45f62c=_0x5ec3f1['config']['thermostatMapping']||{};if(typeof _0x45f62c===_0x8e4567(0xd9))try{_0x45f62c=JSON[_0x8e4567(0xe1)](_0x45f62c);}catch(_0x3fa578){}let _0x572dcb=_0x5ec3f1[_0x8e4567(0xd0)][_0x8e4567(0xd3)]||{};if(typeof _0x572dcb===_0x8e4567(0xd9))try{_0x572dcb=JSON[_0x8e4567(0xe1)](_0x572dcb);}catch(_0x284e3c){}if(_0x45f62c[_0x528ea2['id']]&&_0x45f62c[_0x528ea2['id']]===_0x552a6b||_0x572dcb[_0x528ea2['id']]&&_0x572dcb[_0x528ea2['id']]===_0x36bdb5)_0x1975ed=_0x8e4567(0x78),_0x19aeed=!![];else(_0x552a6b||_0x36bdb5)&&(_0x1975ed=_0x8e4567(0x73));_0x10135f[_0x8e4567(0xcc)]({'room':_0x528ea2[_0x8e4567(0xe0)]||_0x8e4567(0xde),'sensorId':_0x528ea2['id'],'setpointId':_0x552a6b||'-','valveId':_0x36bdb5||'-','source':_0x1975ed,'isManual':_0x19aeed,'status':_0x552a6b&&_0x36bdb5?_0x8e4567(0x6b):_0x552a6b?'OK':_0x8e4567(0xe5)});}return _0x10135f[_0x8e4567(0x7e)]((_0x3a569e,_0x43c7c7)=>_0x3a569e[_0x8e4567(0xce)][_0x8e4567(0xa7)](_0x43c7c7[_0x8e4567(0xce)]));}async function updateSchedulePreview(_0x5794c1){const _0x86b1ee=a1_0x3b6152;if(!_0x5794c1['config']['useCalendar']||!_0x5794c1[_0x86b1ee(0xd0)][_0x86b1ee(0x6d)])return;let _0x2cacf2={};try{const _0x101b8a=await _0x5794c1[_0x86b1ee(0x10f)](_0x86b1ee(0xdc));if(_0x101b8a&&_0x101b8a[_0x86b1ee(0xc9)])_0x2cacf2=JSON[_0x86b1ee(0xe1)](_0x101b8a[_0x86b1ee(0xc9)]);}catch(_0x4ad8f5){}const _0x47941a=[],_0x25ba81=Date[_0x86b1ee(0xf6)](),_0x41d3ad=0x30*0x3c*0x3c*0x3e8;try{const _0x542c72=await _0x5794c1['getForeignStateAsync'](_0x5794c1['config'][_0x86b1ee(0x6d)]+_0x86b1ee(0xf5));if(!_0x542c72||!_0x542c72[_0x86b1ee(0xc9)])return;const _0x43075e=JSON['parse'](_0x542c72[_0x86b1ee(0xc9)]),_0x19b946=_0x5794c1['config']['calendarSelection']||[],_0x4b2a4b=_0x5794c1['config'][_0x86b1ee(0xef)]||[],_0x3c8688=new Set();_0x4b2a4b[_0x86b1ee(0x100)](_0x54d7e5=>{const _0x3c1de2=_0x86b1ee;if(_0x54d7e5[_0x3c1de2(0xe0)])_0x3c8688[_0x3c1de2(0x9c)](_0x54d7e5[_0x3c1de2(0xe0)]);});for(const _0x62cefb of _0x43075e){if(_0x62cefb['_calName']&&_0x19b946[_0x86b1ee(0x11c)]>0x0&&!_0x19b946['includes'](_0x62cefb[_0x86b1ee(0xfe)]))continue;const _0x1f7cdc=_0x62cefb['_date']||_0x62cefb[_0x86b1ee(0x9e)]||_0x62cefb[_0x86b1ee(0x114)];if(!_0x1f7cdc)continue;const _0x5bd13a=new Date(_0x1f7cdc),_0x3b5314=_0x5bd13a[_0x86b1ee(0xc2)]();if(isNaN(_0x3b5314))continue;if(_0x3b5314<_0x25ba81)continue;if(_0x3b5314>_0x25ba81+_0x41d3ad)continue;const _0x2ed5e8=(_0x62cefb[_0x86b1ee(0xed)]||_0x62cefb['summary']||'')[_0x86b1ee(0x110)]();let _0x26cdb0=![],_0x46d4c3=[],_0x60a88f=_0x62cefb['event']||_0x62cefb[_0x86b1ee(0xa9)]||'Unbekannt';if(_0x2ed5e8[_0x86b1ee(0x68)](_0x86b1ee(0x9a))||_0x2ed5e8[_0x86b1ee(0x68)](_0x86b1ee(0x7d))||_0x2ed5e8[_0x86b1ee(0x68)](_0x86b1ee(0xfa)))_0x26cdb0=!![],_0x46d4c3=Array['from'](_0x3c8688);else for(const _0x59eb38 of _0x3c8688){if(_0x2ed5e8[_0x86b1ee(0x68)](_0x59eb38[_0x86b1ee(0x110)]()))_0x46d4c3[_0x86b1ee(0xcc)](_0x59eb38);}_0x46d4c3[_0x86b1ee(0x11c)]>0x0&&_0x46d4c3[_0x86b1ee(0x100)](_0x497256=>{const _0x51499b=_0x86b1ee;let _0x18aa13=0x3c;if(_0x26cdb0){let _0x119cbe=0x0;Object[_0x51499b(0xe9)](_0x2cacf2)[_0x51499b(0x100)](_0x408da4=>{if(_0x408da4>_0x119cbe)_0x119cbe=_0x408da4;}),_0x18aa13=_0x119cbe>0x0?_0x119cbe:0x78;}else _0x18aa13=_0x2cacf2[_0x497256]||0x3c;const _0x2ceb7f=new Date(_0x3b5314-_0x18aa13*0xea60);_0x47941a[_0x51499b(0xcc)]({'eventTime':_0x3b5314,'triggerTime':_0x2ceb7f[_0x51499b(0xc2)](),'room':_0x497256,'minutes':_0x18aa13,'reason':_0x60a88f,'isGlobal':_0x26cdb0});});}}catch(_0x49467c){}_0x47941a['sort']((_0x24e9e6,_0x205e84)=>_0x24e9e6[_0x86b1ee(0xc4)]-_0x205e84[_0x86b1ee(0xc4)]);const _0x987c0c=_0x47941a[_0x86b1ee(0x96)](0x0,0x5);await _0x5794c1[_0x86b1ee(0xf3)]('analysis.energy.schedulePreview',{'val':JSON[_0x86b1ee(0xcf)](_0x987c0c),'ack':!![]});}async function checkCalendarTriggers(_0x318008){const _0x32d61d=a1_0x3b6152;if(!_0x318008[_0x32d61d(0xd0)][_0x32d61d(0x113)]||!_0x318008['config'][_0x32d61d(0x6d)])return;await updateSchedulePreview(_0x318008);let _0x58af76={},_0x5b7a62={};try{const _0x292d59=await _0x318008[_0x32d61d(0x10f)](_0x32d61d(0xdc));if(_0x292d59&&_0x292d59['val'])_0x58af76=JSON[_0x32d61d(0xe1)](_0x292d59[_0x32d61d(0xc9)]);const _0x1c5f5e=await _0x318008[_0x32d61d(0x10f)](_0x32d61d(0xa5));if(_0x1c5f5e&&_0x1c5f5e[_0x32d61d(0xc9)])_0x5b7a62=JSON[_0x32d61d(0xe1)](_0x1c5f5e[_0x32d61d(0xc9)]);}catch(_0x4a6dfe){}let _0x28c4f7={'default':0x15};try{const _0x50e069=await _0x318008[_0x32d61d(0x10f)](_0x32d61d(0x9f));if(_0x50e069&&_0x50e069[_0x32d61d(0xc9)])_0x28c4f7=JSON[_0x32d61d(0xe1)](_0x50e069['val']);}catch(_0x409b49){}try{const _0x38bee7=await _0x318008[_0x32d61d(0x11d)](_0x318008[_0x32d61d(0xd0)][_0x32d61d(0x6d)]+'.data.table');if(!_0x38bee7||!_0x38bee7[_0x32d61d(0xc9)])return;const _0x11be9c=JSON[_0x32d61d(0xe1)](_0x38bee7[_0x32d61d(0xc9)]),_0x10ffa1=Date['now'](),_0x32215c=_0x318008['config']['devices']||[],_0x32c176=_0x318008[_0x32d61d(0xd0)][_0x32d61d(0x81)]||[];for(const _0x4dee32 of _0x11be9c){if(_0x4dee32[_0x32d61d(0xfe)]&&_0x32c176['length']>0x0&&!_0x32c176['includes'](_0x4dee32['_calName']))continue;const _0x397b13=_0x4dee32[_0x32d61d(0xa0)]||_0x4dee32[_0x32d61d(0x9e)]||_0x4dee32[_0x32d61d(0x114)];if(!_0x397b13)continue;const _0x33f4b1=new Date(_0x397b13);if(isNaN(_0x33f4b1[_0x32d61d(0xc2)]()))continue;const _0x55f4a5=(_0x4dee32['event']||_0x4dee32[_0x32d61d(0xa9)]||'')[_0x32d61d(0x110)]();if(_0x55f4a5[_0x32d61d(0x68)](_0x32d61d(0x9a))||_0x55f4a5[_0x32d61d(0x68)](_0x32d61d(0x7d))||_0x55f4a5[_0x32d61d(0x68)]('ankunft')){let _0x3dc9a7=0x0;Object[_0x32d61d(0xe9)](_0x58af76)[_0x32d61d(0x100)](_0x220839=>{if(_0x220839>_0x3dc9a7)_0x3dc9a7=_0x220839;});if(_0x3dc9a7===0x0)_0x3dc9a7=0x78;const _0x42cd48=_0x33f4b1[_0x32d61d(0xc2)]()-_0x3dc9a7*0xea60;_0x10ffa1>=_0x42cd48&&_0x10ffa1<_0x33f4b1[_0x32d61d(0xc2)]()&&(_0x318008['currentSystemMode']!=='normal'&&(_0x318008[_0x32d61d(0x88)]['info'](_0x32d61d(0x99)+_0x3dc9a7+_0x32d61d(0xaf)),await _0x318008[_0x32d61d(0xf3)](_0x32d61d(0x101),{'val':'normal','ack':![]})));}for(const _0x5d32f9 of _0x32215c){if(_0x5d32f9[_0x32d61d(0xe0)]){const _0x277d4=_0x5d32f9['location'][_0x32d61d(0x110)]();if(_0x55f4a5[_0x32d61d(0x68)](_0x277d4)){const _0x198297=_0x58af76[_0x5d32f9[_0x32d61d(0xe0)]]||0x3c,_0x248ff2=_0x5b7a62[_0x5d32f9[_0x32d61d(0xe0)]]||_0x32d61d(0xc1),_0x3f385d=_0x33f4b1[_0x32d61d(0xc2)]()-_0x198297*0xea60;if(_0x10ffa1>=_0x3f385d&&_0x10ffa1<_0x33f4b1[_0x32d61d(0xc2)]()){const _0x42d379=lastActions[_0x32d61d(0x11b)+_0x5d32f9[_0x32d61d(0xe0)]];if(_0x42d379&&_0x10ffa1-_0x42d379<CAL_COOLDOWN_MS)continue;const _0x5a7f71=await findRelatedId(_0x318008,_0x5d32f9['id'],_0x32d61d(0xe3));if(_0x5a7f71){let _0x373578=_0x28c4f7[_0x5d32f9[_0x32d61d(0xe0)]];if(_0x373578===undefined)_0x373578=_0x28c4f7[_0x32d61d(0x91)];if(_0x373578===undefined)_0x373578=0x15;const _0x45da9a=await _0x318008['getForeignStateAsync'](_0x5a7f71);_0x45da9a&&typeof _0x45da9a[_0x32d61d(0xc9)]===_0x32d61d(0x104)&&_0x45da9a[_0x32d61d(0xc9)]<_0x373578-0.5&&(_0x318008[_0x32d61d(0x88)][_0x32d61d(0xa4)](_0x32d61d(0x6a)+_0x248ff2+_0x32d61d(0xb6)+_0x5d32f9['location']+_0x32d61d(0xc3)+_0x373578+_0x32d61d(0xbe)+_0x198297+_0x32d61d(0xaf)),await _0x318008[_0x32d61d(0x9b)](_0x5a7f71,_0x373578),await logAutomationAction(_0x318008,_0x32d61d(0x71)+_0x5d32f9[_0x32d61d(0xe0)]+_0x32d61d(0xa3)+_0x373578+'¬∞C\x20(via\x20'+_0x248ff2+')'),lastActions[_0x32d61d(0x11b)+_0x5d32f9[_0x32d61d(0xe0)]]=_0x10ffa1);}}}}}}}catch(_0x40edb8){_0x318008['log']['warn'](_0x32d61d(0xd5)+_0x40edb8[_0x32d61d(0xd2)]);}}async function manageMpcIntervention(_0x2987d0,_0x5bb38b,_0x47038c){const _0x140dde=a1_0x3b6152;try{const _0xe17980=_0x140dde(0x6e),_0x56e94e=await _0x2987d0[_0x140dde(0x10f)](_0xe17980);let _0x5ea127=[];if(_0x56e94e&&_0x56e94e[_0x140dde(0xc9)])try{_0x5ea127=JSON[_0x140dde(0xe1)](_0x56e94e[_0x140dde(0xc9)]);}catch(_0x149529){}const _0x49eb1b=_0x5ea127['indexOf'](_0x5bb38b);if(_0x47038c===_0x140dde(0x9c))_0x49eb1b===-0x1&&(_0x5ea127[_0x140dde(0xcc)](_0x5bb38b),await _0x2987d0['setStateAsync'](_0xe17980,{'val':JSON[_0x140dde(0xcf)](_0x5ea127),'ack':!![]}));else _0x47038c==='remove'&&(_0x49eb1b!==-0x1&&(_0x5ea127['splice'](_0x49eb1b,0x1),await _0x2987d0[_0x140dde(0xf3)](_0xe17980,{'val':JSON[_0x140dde(0xcf)](_0x5ea127),'ack':!![]})));}catch(_0x526f2f){}}async function cleanupGhostInterventions(_0x1ebed5){const _0x1aca47=a1_0x3b6152;try{const _0x47cf05='analysis.energy.mpcActiveInterventions',_0x15280c=await _0x1ebed5[_0x1aca47(0x10f)](_0x47cf05);if(!_0x15280c||!_0x15280c[_0x1aca47(0xc9)])return;const _0x1406d0=JSON[_0x1aca47(0xe1)](_0x15280c['val']);if(!Array['isArray'](_0x1406d0)||_0x1406d0[_0x1aca47(0x11c)]===0x0)return;let _0x44c7d3={'default':0x15};try{const _0x4f9053=await _0x1ebed5['getStateAsync'](_0x1aca47(0x9f));if(_0x4f9053&&_0x4f9053[_0x1aca47(0xc9)])_0x44c7d3=JSON[_0x1aca47(0xe1)](_0x4f9053[_0x1aca47(0xc9)]);}catch(_0x23d90a){}let _0x14164b=[];try{const _0x45e10b=await _0x1ebed5[_0x1aca47(0x10f)](_0x1aca47(0x111));if(_0x45e10b&&_0x45e10b[_0x1aca47(0xc9)])_0x14164b=JSON[_0x1aca47(0xe1)](_0x45e10b[_0x1aca47(0xc9)]);}catch(_0x421254){}const _0x5eb558=_0x1ebed5[_0x1aca47(0xd0)][_0x1aca47(0xef)]||[];let _0x3f41aa=![];for(let _0x57116e=_0x1406d0[_0x1aca47(0x11c)]-0x1;_0x57116e>=0x0;_0x57116e--){const _0x4e7e2a=_0x1406d0[_0x57116e],_0x264a89=_0x5eb558[_0x1aca47(0xbb)](_0x54d2d0=>normalize(_0x54d2d0[_0x1aca47(0xe0)])===normalize(_0x4e7e2a)&&(_0x54d2d0[_0x1aca47(0xec)]===_0x1aca47(0x112)||_0x54d2d0['type']==='thermostat'));if(!_0x264a89){_0x1ebed5['log'][_0x1aca47(0xd7)](_0x1aca47(0xdf)+_0x4e7e2a+_0x1aca47(0xb0)),_0x1406d0[_0x1aca47(0xc0)](_0x57116e,0x1),_0x3f41aa=!![];continue;}if(_0x264a89){const _0x59142f=await findRelatedId(_0x1ebed5,_0x264a89['id'],'setpoint'),_0x4622ac=await _0x1ebed5['getForeignStateAsync'](_0x264a89['id']);if(_0x59142f){const _0x4ff9f1=await _0x1ebed5[_0x1aca47(0x11d)](_0x59142f);if(_0x4ff9f1&&typeof _0x4ff9f1[_0x1aca47(0xc9)]==='number'){let _0x4f0c69=![],_0xf56fb='';Math[_0x1aca47(0xfc)](_0x4ff9f1['val']-ECO_TEMP)>0.5&&(_0x4f0c69=!![],_0xf56fb=_0x1aca47(0xcd));if(!_0x4f0c69&&_0x4622ac&&typeof _0x4622ac[_0x1aca47(0xc9)]===_0x1aca47(0x104)){const _0x4a76ec=_0x44c7d3[_0x4e7e2a]||_0x44c7d3[_0x1aca47(0x91)]||0x15;_0x4622ac[_0x1aca47(0xc9)]<_0x4a76ec+0.2&&(_0x4f0c69=!![],_0xf56fb='too_cold');}if(_0x4f0c69){if(_0xf56fb===_0x1aca47(0xcd)){_0x1ebed5[_0x1aca47(0x88)][_0x1aca47(0xa4)](_0x1aca47(0x74)+_0x4e7e2a+'\x20ist\x20auf\x20'+_0x4ff9f1[_0x1aca47(0xc9)]+_0x1aca47(0xf8)+ECO_TEMP+'¬∞C).\x20Entferne\x20Status.');const _0x1967cb=lastActions[_0x1aca47(0x11b)+_0x4e7e2a],_0x3ae38b=_0x1967cb&&Date[_0x1aca47(0xf6)]()-_0x1967cb<0x2*0x3c*0x3e8;if(!_0x3ae38b&&_0x4ff9f1[_0x1aca47(0xc9)]>ECO_TEMP+0.5)_0x1ebed5['sendToPythonWrapper']&&(_0x1ebed5[_0x1aca47(0x88)][_0x1aca47(0xa4)]('üéì\x20[RL-FEEDBACK]\x20Lerne\x20aus\x20Fehler:\x20'+_0x4e7e2a+_0x1aca47(0xff)),_0x1ebed5[_0x1aca47(0x93)](_0x1aca47(0xba),{'room':_0x4e7e2a}));else _0x3ae38b&&_0x1ebed5[_0x1aca47(0x88)][_0x1aca47(0xa4)](_0x1aca47(0x67)+_0x4e7e2a+_0x1aca47(0xb2));}else{if(_0xf56fb===_0x1aca47(0x118)){let _0xa485c=![];if(_0x14164b[_0x1aca47(0xbb)](_0x531149=>_0x531149[_0x1aca47(0xce)]===_0x4e7e2a))_0xa485c=!![];const _0x4dcdcf=_0x5eb558[_0x1aca47(0xae)](_0x4a3bbe=>normalize(_0x4a3bbe[_0x1aca47(0xe0)])===normalize(_0x4e7e2a)&&(_0x4a3bbe[_0x1aca47(0xec)]==='window'||_0x4a3bbe[_0x1aca47(0xec)]==='sensor'||_0x4a3bbe[_0x1aca47(0xec)]===_0x1aca47(0xc5)));for(const _0x49aa44 of _0x4dcdcf){try{const _0x459977=await _0x1ebed5[_0x1aca47(0x11d)](_0x49aa44['id']);if(_0x459977&&(_0x459977[_0x1aca47(0xc9)]===!![]||_0x459977['val']===0x1||String(_0x459977[_0x1aca47(0xc9)])[_0x1aca47(0x110)]()===_0x1aca47(0x11a)))_0xa485c=!![];}catch(_0x4e17f3){}}if(_0xa485c)_0x1ebed5['log'][_0x1aca47(0xa4)]('üå¨Ô∏è\x20[MPC\x20WATCHDOG]\x20'+_0x4e7e2a+_0x1aca47(0x83));else{const _0x5f92c6=_0x44c7d3[_0x4e7e2a]||_0x44c7d3['default']||0x15;_0x1ebed5[_0x1aca47(0x88)]['info'](_0x1aca47(0x70)+_0x4e7e2a+'\x20erreicht\x20Limit\x20('+_0x4622ac['val']+_0x1aca47(0x10e)+(_0x5f92c6+0.2)+_0x1aca47(0x117)),await _0x1ebed5[_0x1aca47(0x9b)](_0x59142f,_0x5f92c6),await logAutomationAction(_0x1ebed5,_0x1aca47(0xd1)+_0x4e7e2a+_0x1aca47(0x98)+_0x5f92c6+'¬∞C'),lastActions[_0x1aca47(0x75)+_0x4e7e2a]=Date[_0x1aca47(0xf6)]();}}}_0x1406d0[_0x1aca47(0xc0)](_0x57116e,0x1),_0x3f41aa=!![];}}}}}_0x3f41aa&&await _0x1ebed5[_0x1aca47(0xf3)](_0x47cf05,{'val':JSON[_0x1aca47(0xcf)](_0x1406d0),'ack':!![]});}catch(_0x5ca988){}}function a1_0x425d(_0x4b3cb0,_0x3016b8){const _0x249e9d=a1_0x2205();return a1_0x425d=function(_0x2ad592,_0x130356){_0x2ad592=_0x2ad592-0x67;let _0x2205e2=_0x249e9d[_0x2ad592];return _0x2205e2;},a1_0x425d(_0x4b3cb0,_0x3016b8);}async function applyEnergySavings(_0x43f67a,_0x1851dd){const _0x5ee28e=a1_0x3b6152;await cleanupGhostInterventions(_0x43f67a);if(!_0x1851dd||_0x1851dd[_0x5ee28e(0x11c)]===0x0)return;const _0x240c5a=_0x43f67a['config'][_0x5ee28e(0xef)]||[],_0x2a4b41=Date[_0x5ee28e(0xf6)]();for(const _0x1d516d of _0x1851dd){const _0x384f10=_0x1d516d[_0x5ee28e(0xce)],_0x1c2963=_0x1d516d[_0x5ee28e(0x69)],_0x47f00b=_0x1d516d['target']||0x15;if(lastActions[_0x5ee28e(0x75)+_0x384f10]&&_0x2a4b41-lastActions[_0x5ee28e(0x75)+_0x384f10]<RESCUE_LOCK_MS)continue;const _0x4dd5f7=_0x240c5a[_0x5ee28e(0xbb)](_0x629f74=>normalize(_0x629f74[_0x5ee28e(0xe0)])===normalize(_0x384f10)&&(_0x629f74[_0x5ee28e(0xec)]==='temperature'||_0x629f74[_0x5ee28e(0xec)]===_0x5ee28e(0xb4)));if(!_0x4dd5f7)continue;const _0x3f4fcc=await findRelatedId(_0x43f67a,_0x4dd5f7['id'],'setpoint');if(_0x3f4fcc){if(lastActions['mpc_'+_0x384f10]&&_0x2a4b41-lastActions[_0x5ee28e(0xc7)+_0x384f10]<0x1e*0x3c*0x3e8)continue;const _0x2c89d1=await _0x43f67a[_0x5ee28e(0x11d)](_0x3f4fcc);if(_0x2c89d1&&typeof _0x2c89d1[_0x5ee28e(0xc9)]===_0x5ee28e(0x104)){const _0x32077d=_0x2c89d1['val'];_0x32077d!==ECO_TEMP&&await manageMpcIntervention(_0x43f67a,_0x384f10,_0x5ee28e(0x9d));if(_0x1c2963>0x1e)_0x32077d>ECO_TEMP+0.5&&(_0x43f67a[_0x5ee28e(0x88)][_0x5ee28e(0xa4)](_0x5ee28e(0x97)+_0x384f10+_0x5ee28e(0x8b)+ECO_TEMP+_0x5ee28e(0x72)+_0x1c2963+_0x5ee28e(0x6f)),await _0x43f67a['setForeignStateAsync'](_0x3f4fcc,ECO_TEMP),await manageMpcIntervention(_0x43f67a,_0x384f10,_0x5ee28e(0x9c)),lastActions[_0x5ee28e(0xc7)+_0x384f10]=_0x2a4b41,await logAutomationAction(_0x43f67a,_0x5ee28e(0xf1)+_0x384f10+_0x5ee28e(0x103)+ECO_TEMP+'¬∞C'));else _0x1c2963<=0xf&&(_0x32077d<_0x47f00b&&(_0x43f67a['log'][_0x5ee28e(0xa4)](_0x5ee28e(0x7a)+_0x384f10+_0x5ee28e(0xab)+_0x47f00b+'¬∞C!\x20(Puffer\x20leer).'),await _0x43f67a['setForeignStateAsync'](_0x3f4fcc,_0x47f00b),await manageMpcIntervention(_0x43f67a,_0x384f10,_0x5ee28e(0x9d)),lastActions['mpc_'+_0x384f10]=_0x2a4b41,await logAutomationAction(_0x43f67a,_0x5ee28e(0xf1)+_0x384f10+_0x5ee28e(0x87)+_0x47f00b+'¬∞C')));}}else _0x43f67a['log'][_0x5ee28e(0xd7)](_0x5ee28e(0x10a)+_0x384f10+_0x5ee28e(0xfb));}}function a1_0x2205(){const _0x2b9313=['info','analysis.energy.warmupSources','actual','localeCompare','unshift','summary','thermostat.setpoint','\x20wieder\x20auf\x20','current_heating_setpoint','9477582cmoggO','filter','\x20min).','\x27\x20hat\x20kein\x20Ger√§t\x20mehr.\x20L√∂sche\x20Eintrag.','12pEMPny','\x20durch\x20Kalender\x20ge√§ndert.\x20Keine\x20RL-Strafe.','role','thermostat','1207722gDgmeG',']:\x20Raum-Trigger\x20\x27','SET','level.valve','state','TRAIN_RL_PENALTY','find','SET_POINT_TEMPERATURE','toString','¬∞C\x20(Vorlauf:\x20','split','splice','Classic','getTime','\x27\x20aktiv.\x20Heize\x20auf\x20','triggerTime','contact','.1.TEMPERATURE','mpc_','apply','val','consultButler','Nicht\x20gefunden','push','manual','room','stringify','config','[WATCHDOG]\x20','message','valveMapping','getForeignObjectAsync','Calendar\x20Check\x20Error:\x20','6297384BJWTxG','warn','active','string','7BsPiTQ','level.temperature','analysis.energy.warmupTimes','join','Unbekannt','üßπ\x20[MPC\x20CLEANUP]\x20Raum\x20\x27','location','parse','analysis.automation.lastAction','setpoint','ist','Fehlt','replace','./ai_agent','.1.SET_POINT_TEMPERATURE','values','sensor','1612666YhkHnH','type','event','search','devices','unit','[MPC]\x20','level','setStateAsync','soll','.data.table','now','ACTUAL_TEMPERATURE','¬∞C\x20(nicht\x20','toUpperCase','ankunft','\x20gefunden!','abs','.4.SET_TEMPERATURE','_calName','\x20wurde\x20manuell\x20erh√∂ht.','forEach','system.mode','light',':\x20Absenkung\x20auf\x20','number','valve','ACTUAL','off','switch','exports','[MPC\x20WARNING]\x20Kein\x20Setpoint\x20f√ºr\x20','write','dimmer','value.valve','¬∞C\x20<\x20','getStateAsync','toLowerCase','analysis.energy.ventilationAlerts','temperature','useCalendar','date','score','map','¬∞C).\x20Sparmodus\x20beendet!','too_cold','analysis.automation.confidenceThreshold','open','cal_','length','getForeignStateAsync','üìÖ\x20[MPC\x20INFO]\x20','includes','minutes_safe','üìÖ\x20SMART\x20SCHEDULE\x20[','PERFECT','getForeignObjectsAsync','calendarInstance','analysis.energy.mpcActiveInterventions','\x20min)','üö®\x20[MPC\x20WATCHDOG]\x20','[CAL]\x20','¬∞C!\x20(Puffer:\x20','Auto-Erkennung','üßπ\x20[MPC\x20CLEANUP]\x20','rescue_','pi_heating_demand','(((.+)+)+)+$','Manuelles\x20Mapping','occupied_heating_setpoint','üî•\x20[MPC\x20ACTION]\x20Heize\x20','stellwert','1612320jZGsjp','r√ºckkehr','sort','2394410wpddhe','Pr√§diktion:\x20','calendarSelection','15350022yGMDLL','\x20ist\x20zu\x20kalt,\x20ABER\x20Fenster\x20offen/L√ºftung\x20erkannt.\x20Heize\x20NICHT,\x20entferne\x20nur\x20Status.','local_temperature','.1.ACTUAL_TEMPERATURE','.1.LEVEL',':\x20Aufheizen\x20auf\x20','log','openknx','thermostatMapping','\x20auf\x20','\x20->\x20Schalte\x20','name','set','target_temperature','analysis.automation.mode','default','approved','sendToPythonWrapper','wert','valve_position','slice','üçÉ\x20[MPC\x20ACTION]\x20Senke\x20',':\x20Puffer\x20leer\x20->\x20Heizen\x20auf\x20','üìÖ\x20SMART\x20SCHEDULE\x20(Phase):\x20\x27Globaler\x20Start\x27\x20erkannt.\x20Heize\x20Haus\x20auf\x20(Vorlauf:\x20','urlaub\x20ende','setForeignStateAsync','add','remove','eventStart','analysis.energy.warmupTargets','_date','messwert','common','\x20->\x20'];a1_0x2205=function(){return _0x2b9313;};return a1_0x2205();}module[a1_0x3b6152(0x109)]={'handlePrediction':handlePrediction,'applyEnergySavings':applyEnergySavings,'scanThermostats':scanThermostats,'checkCalendarTriggers':checkCalendarTriggers,'updateSchedulePreview':updateSchedulePreview,'cleanupGhostInterventions':cleanupGhostInterventions};