function a1_0x38b2(){const _0x1a4168=['.1.TEMPERATURE','analysis.automation.confidenceThreshold','target_temperature','8MrZydC','reason','split','localeCompare','write','10KhxDvq','523117ynqckt','sensor','score','üçÉ\x20MPC\x20Autonomy:\x20Senke\x20','light','config','5871815YptAQK','set','sort','devices','constructor','type','parse','off','info','approved','messwert','Unknown','\x20->\x20Schalte\x20','analysis.automation.mode','entries','switch','6049043aOGvQE','target','Manuelles\x20Mapping','toUpperCase','find','dimmer','\x20min)','Unbekannt','setStateAsync','mpc_','thermostat.setpoint','3350778HbpEbP','name','Pr√§diktion:\x20','includes','openknx','Nicht\x20gefunden','Auto-Erkennung','analysis.automation.lastAction','setForeignStateAsync','length','42AHJsyc','thermostat','role','warn','val','(((.+)+)+)+$','message','thermostatMapping','consultButler','number','replace','getForeignObjectsAsync','339947SlGwmg','log','local_temperature','4BQrbRV','level.temperature','ACTUAL','getStateAsync','current_heating_setpoint','temp','filter','getForeignStateAsync','string','getForeignObjectAsync','minutes_safe','ist','ACTUAL_TEMPERATURE','hm-rpc','room','join','toString',')\x20auf\x20','1908280onMZvG','now','toLowerCase','Ist','12763791ybYcsX','üîç\x20Device-Search\x20failed\x20for\x20predicted\x20room\x20\x27','.1.ACTUAL_TEMPERATURE','Fehlt','location','.1.SET_POINT_TEMPERATURE','.4.SET_TEMPERATURE','temperature','forEach','search','push','debug'];a1_0x38b2=function(){return _0x1a4168;};return a1_0x38b2();}(function(_0x3e3184,_0x1a196b){const _0x2d589b=a1_0x2c91,_0x1432d4=_0x3e3184();while(!![]){try{const _0x48d65c=-parseInt(_0x2d589b(0x176))/0x1*(-parseInt(_0x2d589b(0x19e))/0x2)+-parseInt(_0x2d589b(0x1c5))/0x3+parseInt(_0x2d589b(0x179))/0x4*(parseInt(_0x2d589b(0x1aa))/0x5)+parseInt(_0x2d589b(0x1cf))/0x6*(parseInt(_0x2d589b(0x1a4))/0x7)+-parseInt(_0x2d589b(0x18b))/0x8+-parseInt(_0x2d589b(0x18f))/0x9*(parseInt(_0x2d589b(0x1a3))/0xa)+parseInt(_0x2d589b(0x1ba))/0xb;if(_0x48d65c===_0x1a196b)break;else _0x1432d4['push'](_0x1432d4['shift']());}catch(_0x3cff03){_0x1432d4['push'](_0x1432d4['shift']());}}}(a1_0x38b2,0xcb7f1));const a1_0x3f8f2f=(function(){let _0x371641=!![];return function(_0x8a2df,_0xdecfa3){const _0x31473b=_0x371641?function(){if(_0xdecfa3){const _0x472f3e=_0xdecfa3['apply'](_0x8a2df,arguments);return _0xdecfa3=null,_0x472f3e;}}:function(){};return _0x371641=![],_0x31473b;};}()),a1_0x226ad6=a1_0x3f8f2f(this,function(){const _0x52da63=a1_0x2c91;return a1_0x226ad6['toString']()[_0x52da63(0x198)](_0x52da63(0x1d4))[_0x52da63(0x189)]()[_0x52da63(0x1ae)](a1_0x226ad6)[_0x52da63(0x198)]('(((.+)+)+)+$');});a1_0x226ad6();'use strict';const aiAgent=require('./ai_agent'),COOLDOWN_MS=0x3c*0x3e8,lastActions={};function a1_0x2c91(_0x3b089f,_0x166295){const _0x55df7f=a1_0x38b2();return a1_0x2c91=function(_0x226ad6,_0x3f8f2f){_0x226ad6=_0x226ad6-0x172;let _0x38b2fe=_0x55df7f[_0x226ad6];return _0x38b2fe;},a1_0x2c91(_0x3b089f,_0x166295);}function normalize(_0x1c7b92){const _0x21f431=a1_0x2c91;if(!_0x1c7b92)return'';return _0x1c7b92['toLowerCase']()[_0x21f431(0x174)](/\s+/g,'')['trim']();}async function handlePrediction(_0x344658,_0x3bd1f4,_0x42485a){const _0x515403=a1_0x2c91;if(!_0x3bd1f4||_0x3bd1f4===_0x515403(0x1b5))return;let _0xa07c88=_0x515403(0x1b1),_0x767f7f=0.6;try{const _0x1e1ef2=await _0x344658[_0x515403(0x17c)](_0x515403(0x1b7));if(_0x1e1ef2&&_0x1e1ef2[_0x515403(0x1d3)])_0xa07c88=_0x1e1ef2[_0x515403(0x1d3)];const _0x43254e=await _0x344658[_0x515403(0x17c)](_0x515403(0x19c));if(_0x43254e&&_0x43254e[_0x515403(0x1d3)])_0x767f7f=_0x43254e[_0x515403(0x1d3)];}catch(_0x247651){}if(_0xa07c88===_0x515403(0x1b1)||_0x42485a<_0x767f7f)return;const _0x2b2d65=Date[_0x515403(0x18c)]();if(lastActions[_0x3bd1f4]&&_0x2b2d65-lastActions[_0x3bd1f4]<COOLDOWN_MS)return;const _0x28362f=_0x344658[_0x515403(0x1a9)][_0x515403(0x1ad)]||[],_0x55a126=normalize(_0x3bd1f4),_0x409faf=_0x28362f['find'](_0xd193a9=>normalize(_0xd193a9[_0x515403(0x193)])===_0x55a126&&(_0xd193a9[_0x515403(0x1af)]===_0x515403(0x1a8)||_0xd193a9[_0x515403(0x1af)]===_0x515403(0x1bf)||_0xd193a9[_0x515403(0x1af)]===_0x515403(0x1b9)));if(!_0x409faf){_0x344658[_0x515403(0x177)][_0x515403(0x19a)](_0x515403(0x190)+_0x3bd1f4+'\x27.');return;}const _0x20bc23=await aiAgent[_0x515403(0x172)](_0x344658,_0x3bd1f4,_0x409faf['name'],_0x42485a);if(!_0x20bc23[_0x515403(0x1b3)])return;const _0x25d872=_0x515403(0x1c7)+_0x3bd1f4+_0x515403(0x1b6)+_0x409faf[_0x515403(0x1c6)]+'\x20('+_0x20bc23[_0x515403(0x19f)]+')';await _0x344658[_0x515403(0x1c2)]('analysis.automation.lastAction',{'val':'['+_0xa07c88[_0x515403(0x1bd)]()+']\x20'+_0x25d872,'ack':!![]});if(_0xa07c88==='active'){const _0x50a0a5=await _0x344658[_0x515403(0x180)](_0x409faf['id']);(!_0x50a0a5||!_0x50a0a5[_0x515403(0x1d3)]&&_0x50a0a5['val']!==!![])&&await _0x344658[_0x515403(0x1cd)](_0x409faf['id'],!![]),lastActions[_0x3bd1f4]=_0x2b2d65;}}async function findSetpointId(_0x5d98e5,_0x595457){const _0x2a04ad=a1_0x2c91;if(_0x5d98e5[_0x2a04ad(0x1a9)][_0x2a04ad(0x1d6)]){let _0x5eb4e5=_0x5d98e5[_0x2a04ad(0x1a9)][_0x2a04ad(0x1d6)];if(typeof _0x5eb4e5==='string')try{_0x5eb4e5=JSON['parse'](_0x5eb4e5);}catch(_0x4681e0){_0x5eb4e5={};}if(_0x5eb4e5&&_0x5eb4e5[_0x595457])return _0x5eb4e5[_0x595457];}const _0xef178c=[{'s':_0x2a04ad(0x191),'t':_0x2a04ad(0x194)},{'s':_0x2a04ad(0x19b),'t':_0x2a04ad(0x195)},{'s':_0x2a04ad(0x185),'t':'SET_POINT_TEMPERATURE'},{'s':_0x2a04ad(0x178),'t':'occupied_heating_setpoint'},{'s':'local_temperature','t':_0x2a04ad(0x17d)},{'s':_0x2a04ad(0x196),'t':_0x2a04ad(0x19d)},{'s':_0x2a04ad(0x17b),'t':'SET'},{'s':_0x2a04ad(0x18e),'t':'Soll'},{'s':_0x2a04ad(0x196),'t':'setpoint'}];for(const _0x1d14bb of _0xef178c){if(_0x595457[_0x2a04ad(0x1c8)](_0x1d14bb['s'])){const _0xf1b4eb=_0x595457['replace'](_0x1d14bb['s'],_0x1d14bb['t']),_0x4dae5b=await _0x5d98e5[_0x2a04ad(0x182)](_0xf1b4eb);if(_0x4dae5b)return _0xf1b4eb;}}try{const _0x20ef92=_0x595457['split']('.');if(_0x20ef92['length']>0x2){const _0x447bf1=_0x20ef92['slice'](0x0,-0x1)[_0x2a04ad(0x188)]('.'),_0x12960b=await _0x5d98e5[_0x2a04ad(0x175)](_0x447bf1+'.*'),_0x5a2377=[],_0x2ae2bb=_0x595457[_0x2a04ad(0x1a0)](/[._]+/)[_0x2a04ad(0x17f)](_0x3e8e43=>![_0x2a04ad(0x1c9),'0',_0x2a04ad(0x186),_0x2a04ad(0x184),'wert',_0x2a04ad(0x196),'actual','sensor',_0x2a04ad(0x1b4),'state'][_0x2a04ad(0x1c8)](_0x3e8e43['toLowerCase']()));for(const [_0x2affdf,_0x407ac]of Object[_0x2a04ad(0x1b8)](_0x12960b)){if(_0x2affdf===_0x595457)continue;if(_0x407ac&&_0x407ac['common']&&_0x407ac['common'][_0x2a04ad(0x1a2)]===!![]){const _0x15a791=_0x2affdf[_0x2a04ad(0x18d)](),_0x510135=(_0x407ac['common'][_0x2a04ad(0x1d1)]||'')[_0x2a04ad(0x18d)](),_0x27e0c6=_0x15a791[_0x2a04ad(0x1c8)](_0x2a04ad(0x1ab))||_0x15a791[_0x2a04ad(0x1c8)]('soll')||_0x15a791[_0x2a04ad(0x1c8)](_0x2a04ad(0x1bb))||_0x510135['includes'](_0x2a04ad(0x17a))||_0x510135[_0x2a04ad(0x1c8)](_0x2a04ad(0x1c4));if(_0x27e0c6){const _0x4e90e5=_0x2affdf[_0x2a04ad(0x1a0)](/[._]+/)['map'](_0x569202=>_0x569202[_0x2a04ad(0x18d)]());let _0x4370e5=0x0;_0x2ae2bb[_0x2a04ad(0x197)](_0x471629=>{const _0x301386=_0x2a04ad;if(_0x4e90e5[_0x301386(0x1c8)](_0x471629[_0x301386(0x18d)]()))_0x4370e5++;}),_0x5a2377[_0x2a04ad(0x199)]({'id':_0x2affdf,'score':_0x4370e5});}}}if(_0x5a2377[_0x2a04ad(0x1ce)]>0x0){_0x5a2377[_0x2a04ad(0x1ac)]((_0x47432c,_0x39e385)=>_0x39e385[_0x2a04ad(0x1a6)]-_0x47432c['score']);const _0x5c85fb=_0x5a2377[0x0];if(_0x5c85fb[_0x2a04ad(0x1a6)]>0x0)return _0x5c85fb['id'];}}}catch(_0x2940af){_0x5d98e5[_0x2a04ad(0x177)][_0x2a04ad(0x1d2)]('Error\x20in\x20sibling\x20search:\x20'+_0x2940af[_0x2a04ad(0x1d5)]);}return null;}async function scanThermostats(_0x2de142){const _0x5a6081=a1_0x2c91,_0x1f248=_0x2de142[_0x5a6081(0x1a9)][_0x5a6081(0x1ad)]||[],_0x1c4e5a=[],_0x3c32b1=_0x1f248[_0x5a6081(0x17f)](_0x27110d=>_0x27110d['id']&&_0x27110d['id']['includes'](_0x5a6081(0x196))||_0x27110d['type']&&[_0x5a6081(0x196),_0x5a6081(0x1d0),_0x5a6081(0x1a5)][_0x5a6081(0x1c8)](_0x27110d[_0x5a6081(0x1af)])||_0x27110d[_0x5a6081(0x1c6)]&&_0x27110d[_0x5a6081(0x1c6)][_0x5a6081(0x18d)]()[_0x5a6081(0x1c8)](_0x5a6081(0x17e)));for(const _0x1db625 of _0x3c32b1){const _0x2116e4=await findSetpointId(_0x2de142,_0x1db625['id']);let _0x4f14c7=_0x5a6081(0x1ca),_0x541dbb=![],_0x3cde20=_0x2de142['config'][_0x5a6081(0x1d6)]||{};if(typeof _0x3cde20===_0x5a6081(0x181))try{_0x3cde20=JSON[_0x5a6081(0x1b0)](_0x3cde20);}catch(_0x1dea30){}if(_0x3cde20[_0x1db625['id']]&&_0x3cde20[_0x1db625['id']]===_0x2116e4)_0x4f14c7=_0x5a6081(0x1bc),_0x541dbb=!![];else _0x2116e4&&(_0x4f14c7=_0x5a6081(0x1cb));_0x1c4e5a['push']({'room':_0x1db625[_0x5a6081(0x193)]||_0x5a6081(0x1c1),'sensorId':_0x1db625['id'],'setpointId':_0x2116e4||'-','source':_0x4f14c7,'isManual':_0x541dbb,'status':_0x2116e4?'OK':_0x5a6081(0x192)});}return _0x1c4e5a[_0x5a6081(0x1ac)]((_0x5eebf8,_0x59cbd1)=>_0x5eebf8['room'][_0x5a6081(0x1a1)](_0x59cbd1['room']));}async function applyEnergySavings(_0xe0adb8,_0x2249c9){const _0x45b867=a1_0x2c91,_0x2fc13b=_0xe0adb8['config'][_0x45b867(0x1ad)]||[];for(const _0x47c2a2 of _0x2249c9){const _0x194b9a=_0x47c2a2[_0x45b867(0x187)],_0x4e8b40=_0x47c2a2[_0x45b867(0x183)],_0x413cc9=Date['now']();if(lastActions[_0x45b867(0x1c3)+_0x194b9a]&&_0x413cc9-lastActions['mpc_'+_0x194b9a]<0x1e*0x3c*0x3e8)continue;const _0x1d5027=_0x2fc13b[_0x45b867(0x1be)](_0x1ada99=>normalize(_0x1ada99['location'])===normalize(_0x194b9a));if(!_0x1d5027)continue;const _0x2342f8=await findSetpointId(_0xe0adb8,_0x1d5027['id']);if(_0x2342f8){const _0x1591e7=await _0xe0adb8[_0x45b867(0x180)](_0x2342f8);if(_0x1591e7&&typeof _0x1591e7[_0x45b867(0x1d3)]===_0x45b867(0x173)){const _0x39ef1c=_0x1591e7['val'];if(_0x4e8b40>0x1e&&_0x39ef1c>0x11){const _0x46e95b=_0x39ef1c-0x1;_0xe0adb8[_0x45b867(0x177)][_0x45b867(0x1b2)](_0x45b867(0x1a7)+_0x194b9a+'\x20('+_0x2342f8+_0x45b867(0x18a)+_0x46e95b+'¬∞C\x20(Coasting\x20m√∂glich:\x20'+_0x4e8b40+_0x45b867(0x1c0)),await _0xe0adb8[_0x45b867(0x1cd)](_0x2342f8,_0x46e95b),lastActions[_0x45b867(0x1c3)+_0x194b9a]=_0x413cc9,await _0xe0adb8[_0x45b867(0x1c2)](_0x45b867(0x1cc),{'val':'[MPC]\x20'+_0x194b9a+':\x20-1¬∞C\x20(Sparpotenzial\x20genutzt)','ack':!![]});}}}}}module['exports']={'handlePrediction':handlePrediction,'applyEnergySavings':applyEnergySavings,'scanThermostats':scanThermostats};