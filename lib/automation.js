const a1_0x5cd6f2=a1_0x4542;(function(_0x2503cc,_0x267f4f){const _0x359242=a1_0x4542,_0x37b080=_0x2503cc();while(!![]){try{const _0x1f5d25=-parseInt(_0x359242(0x19f))/0x1+-parseInt(_0x359242(0x19e))/0x2+parseInt(_0x359242(0x1bf))/0x3+-parseInt(_0x359242(0x1aa))/0x4*(parseInt(_0x359242(0x1bb))/0x5)+parseInt(_0x359242(0x1c3))/0x6+parseInt(_0x359242(0x1ae))/0x7*(parseInt(_0x359242(0x1c5))/0x8)+-parseInt(_0x359242(0x18e))/0x9*(-parseInt(_0x359242(0x198))/0xa);if(_0x1f5d25===_0x267f4f)break;else _0x37b080['push'](_0x37b080['shift']());}catch(_0x537d14){_0x37b080['push'](_0x37b080['shift']());}}}(a1_0x25a6,0xeeadf));const a1_0x2885ab=(function(){let _0x5857fa=!![];return function(_0x57e805,_0x14f4cc){const _0x361ac8=_0x5857fa?function(){const _0x75005d=a1_0x4542;if(_0x14f4cc){const _0xb92c46=_0x14f4cc[_0x75005d(0x1c9)](_0x57e805,arguments);return _0x14f4cc=null,_0xb92c46;}}:function(){};return _0x5857fa=![],_0x361ac8;};}()),a1_0x53d086=a1_0x2885ab(this,function(){const _0x3dcfd8=a1_0x4542;return a1_0x53d086['toString']()[_0x3dcfd8(0x1a9)](_0x3dcfd8(0x1e8))[_0x3dcfd8(0x1e5)]()[_0x3dcfd8(0x1d8)](a1_0x53d086)['search'](_0x3dcfd8(0x1e8));});a1_0x53d086();'use strict';const aiAgent=require(a1_0x5cd6f2(0x1e6)),COOLDOWN_MS=0x3c*0x3e8,lastActions={};function a1_0x4542(_0x2d30c5,_0x4eb28d){const _0x2300a8=a1_0x25a6();return a1_0x4542=function(_0x53d086,_0x2885ab){_0x53d086=_0x53d086-0x18d;let _0x25a63e=_0x2300a8[_0x53d086];return _0x25a63e;},a1_0x4542(_0x2d30c5,_0x4eb28d);}function normalize(_0x392341){const _0x523fd6=a1_0x5cd6f2;if(!_0x392341)return'';return _0x392341[_0x523fd6(0x19d)]()[_0x523fd6(0x1d2)](/\s+/g,'')[_0x523fd6(0x1d4)]();}async function handlePrediction(_0x5f540b,_0x357825,_0x849298){const _0x5148eb=a1_0x5cd6f2;if(!_0x357825||_0x357825===_0x5148eb(0x1d7))return;let _0x261f3b=_0x5148eb(0x1bc),_0x5f5aab=0.6;try{const _0x6eaafc=await _0x5f540b['getStateAsync'](_0x5148eb(0x1a0));if(_0x6eaafc&&_0x6eaafc[_0x5148eb(0x1e0)])_0x261f3b=_0x6eaafc[_0x5148eb(0x1e0)];const _0x2fc6dd=await _0x5f540b['getStateAsync'](_0x5148eb(0x191));if(_0x2fc6dd&&_0x2fc6dd[_0x5148eb(0x1e0)])_0x5f5aab=_0x2fc6dd[_0x5148eb(0x1e0)];}catch(_0x58ab29){}if(_0x261f3b===_0x5148eb(0x1bc)||_0x849298<_0x5f5aab)return;const _0xad1223=Date[_0x5148eb(0x1e3)]();if(lastActions[_0x357825]&&_0xad1223-lastActions[_0x357825]<COOLDOWN_MS)return;const _0x14acbe=_0x5f540b[_0x5148eb(0x1b6)]['devices']||[],_0x13d880=normalize(_0x357825),_0x4bb9bd=_0x14acbe[_0x5148eb(0x1d3)](_0x5374d9=>normalize(_0x5374d9['location'])===_0x13d880&&(_0x5374d9[_0x5148eb(0x1c7)]===_0x5148eb(0x1e4)||_0x5374d9[_0x5148eb(0x1c7)]===_0x5148eb(0x19b)||_0x5374d9[_0x5148eb(0x1c7)]==='switch'));if(!_0x4bb9bd){_0x5f540b[_0x5148eb(0x1dd)][_0x5148eb(0x1cb)](_0x5148eb(0x1b7)+_0x357825+'\x27.');return;}const _0x3d2210=await aiAgent[_0x5148eb(0x1c2)](_0x5f540b,_0x357825,_0x4bb9bd[_0x5148eb(0x1d5)],_0x849298);if(!_0x3d2210[_0x5148eb(0x1a3)])return;const _0x561688=_0x5148eb(0x1b3)+_0x357825+_0x5148eb(0x1b0)+_0x4bb9bd['name']+'\x20('+_0x3d2210['reason']+')';await _0x5f540b[_0x5148eb(0x1af)](_0x5148eb(0x1df),{'val':'['+_0x261f3b[_0x5148eb(0x1d1)]()+']\x20'+_0x561688,'ack':!![]});if(_0x261f3b===_0x5148eb(0x1a6)){const _0x4d4fab=await _0x5f540b['getForeignStateAsync'](_0x4bb9bd['id']);(!_0x4d4fab||!_0x4d4fab[_0x5148eb(0x1e0)]&&_0x4d4fab[_0x5148eb(0x1e0)]!==!![])&&await _0x5f540b[_0x5148eb(0x1d0)](_0x4bb9bd['id'],!![]),lastActions[_0x357825]=_0xad1223;}}async function findSetpointId(_0x2a6fa4,_0x1bd63e){const _0x35673a=a1_0x5cd6f2;if(_0x2a6fa4[_0x35673a(0x1b6)]['thermostatMapping']){let _0x382893=_0x2a6fa4[_0x35673a(0x1b6)]['thermostatMapping'];if(typeof _0x382893===_0x35673a(0x1c6))try{_0x382893=JSON[_0x35673a(0x1ce)](_0x382893);}catch(_0xf7bb66){_0x382893={};}if(_0x382893&&_0x382893[_0x1bd63e])return _0x382893[_0x1bd63e];}const _0x3dca95=[{'s':'.1.ACTUAL_TEMPERATURE','t':_0x35673a(0x18d)},{'s':_0x35673a(0x1be),'t':'.4.SET_TEMPERATURE'},{'s':_0x35673a(0x1b1),'t':_0x35673a(0x1e2)},{'s':'local_temperature','t':_0x35673a(0x1cc)},{'s':_0x35673a(0x1c8),'t':_0x35673a(0x190)},{'s':_0x35673a(0x1d6),'t':_0x35673a(0x1b2)},{'s':_0x35673a(0x1a5),'t':'SET'},{'s':_0x35673a(0x19a),'t':_0x35673a(0x18f)},{'s':_0x35673a(0x1d6),'t':_0x35673a(0x1dc)}];for(const _0xab9a55 of _0x3dca95){if(_0x1bd63e[_0x35673a(0x1a4)](_0xab9a55['s'])){const _0x1f64c0=_0x1bd63e[_0x35673a(0x1d2)](_0xab9a55['s'],_0xab9a55['t']),_0x5b3533=await _0x2a6fa4[_0x35673a(0x1b5)](_0x1f64c0);if(_0x5b3533)return _0x1f64c0;}}try{const _0x14dd66=_0x1bd63e[_0x35673a(0x1a8)]('.');if(_0x14dd66[_0x35673a(0x1ea)]>0x2){const _0x59eab4=_0x14dd66[_0x35673a(0x1b4)](0x0,-0x1)[_0x35673a(0x197)]('.'),_0x493902=await _0x2a6fa4[_0x35673a(0x1db)](_0x59eab4+'.*');for(const [_0x41c4a4,_0x4cc4a4]of Object[_0x35673a(0x1a1)](_0x493902)){if(_0x41c4a4===_0x1bd63e)continue;if(_0x4cc4a4&&_0x4cc4a4[_0x35673a(0x1bd)]&&_0x4cc4a4[_0x35673a(0x1bd)][_0x35673a(0x1de)]===!![]){const _0x494ac4=_0x41c4a4[_0x35673a(0x19d)](),_0x4dbf97=(_0x4cc4a4['common'][_0x35673a(0x196)]||'')[_0x35673a(0x19d)]();if(_0x494ac4[_0x35673a(0x1a4)](_0x35673a(0x193))||_0x494ac4[_0x35673a(0x1a4)](_0x35673a(0x1cf))||_0x494ac4[_0x35673a(0x1a4)](_0x35673a(0x1eb))||_0x4dbf97[_0x35673a(0x1a4)](_0x35673a(0x1ad))||_0x4dbf97[_0x35673a(0x1a4)]('thermostat'))return _0x41c4a4;}}}}catch(_0x1bee98){}return null;}function a1_0x25a6(){const _0x5a3725=['getForeignObjectAsync','config','ðŸ”\x20Device-Search\x20failed\x20for\x20predicted\x20room\x20\x27','temp','localeCompare','filter','623985ymVigq','off','common','.1.TEMPERATURE','1823964KAiuxz','Manuelles\x20Mapping','Fehlt','consultButler','159126oetgdJ','thermostatMapping','15040696UTRPSb','string','type','local_temperature','apply','minutes_safe','debug','occupied_heating_setpoint','thermostat','parse','soll','setForeignStateAsync','toUpperCase','replace','find','trim','name','temperature','Unknown','constructor','sensor','ðŸƒ\x20MPC\x20Autonomy:\x20Senke\x20','getForeignObjectsAsync','setpoint','log','write','analysis.automation.lastAction','val','\x20min)','SET_POINT_TEMPERATURE','now','light','toString','./ai_agent','sort','(((.+)+)+)+$','info','length','target','location','.1.SET_POINT_TEMPERATURE','19121814boldkT','Soll','current_heating_setpoint','analysis.automation.confidenceThreshold',')\x20auf\x20','set','mpc_','push','role','join','10ldABGt','[MPC]\x20','Ist','dimmer','room','toLowerCase','2732734wUbxec','1796056lGfPnS','analysis.automation.mode','entries','Unbekannt','approved','includes','ACTUAL','active','devices','split','search','16OtVyMp','Â°C\x20(Coasting\x20mÃ¶glich:\x20','number','level.temperature','7JUfTiv','setStateAsync','\x20->\x20Schalte\x20','ACTUAL_TEMPERATURE','target_temperature','PrÃ¤diktion:\x20','slice'];a1_0x25a6=function(){return _0x5a3725;};return a1_0x25a6();}async function scanThermostats(_0x108bc9){const _0x50fd20=a1_0x5cd6f2,_0x3e52a0=_0x108bc9['config'][_0x50fd20(0x1a7)]||[],_0x58a4b3=[],_0x346cc8=_0x3e52a0[_0x50fd20(0x1ba)](_0x5c9e5f=>_0x5c9e5f['id']&&_0x5c9e5f['id']['includes'](_0x50fd20(0x1d6))||_0x5c9e5f[_0x50fd20(0x1c7)]&&[_0x50fd20(0x1d6),_0x50fd20(0x1cd),_0x50fd20(0x1d9)]['includes'](_0x5c9e5f[_0x50fd20(0x1c7)])||_0x5c9e5f[_0x50fd20(0x1d5)]&&_0x5c9e5f[_0x50fd20(0x1d5)]['toLowerCase']()[_0x50fd20(0x1a4)](_0x50fd20(0x1b8)));for(const _0x918631 of _0x346cc8){const _0x46c80b=await findSetpointId(_0x108bc9,_0x918631['id']);let _0x235f93='Nicht\x20gefunden',_0x47a949=![],_0x2ed207=_0x108bc9['config'][_0x50fd20(0x1c4)]||{};if(typeof _0x2ed207===_0x50fd20(0x1c6))try{_0x2ed207=JSON[_0x50fd20(0x1ce)](_0x2ed207);}catch(_0x73d807){}if(_0x2ed207[_0x918631['id']]&&_0x2ed207[_0x918631['id']]===_0x46c80b)_0x235f93=_0x50fd20(0x1c0),_0x47a949=!![];else _0x46c80b&&(_0x235f93='Auto-Erkennung');_0x58a4b3[_0x50fd20(0x195)]({'room':_0x918631[_0x50fd20(0x1ec)]||_0x50fd20(0x1a2),'sensorId':_0x918631['id'],'setpointId':_0x46c80b||'-','source':_0x235f93,'isManual':_0x47a949,'status':_0x46c80b?'OK':_0x50fd20(0x1c1)});}return _0x58a4b3[_0x50fd20(0x1e7)]((_0x3c9657,_0x4cf259)=>_0x3c9657[_0x50fd20(0x19c)][_0x50fd20(0x1b9)](_0x4cf259['room']));}async function applyEnergySavings(_0x37cae5,_0x2a7780){const _0x48dcc4=a1_0x5cd6f2,_0x35e5b5=_0x37cae5['config']['devices']||[];for(const _0x5c1a8e of _0x2a7780){const _0x3fc4a4=_0x5c1a8e[_0x48dcc4(0x19c)],_0x374876=_0x5c1a8e[_0x48dcc4(0x1ca)],_0x44f648=Date['now']();if(lastActions[_0x48dcc4(0x194)+_0x3fc4a4]&&_0x44f648-lastActions[_0x48dcc4(0x194)+_0x3fc4a4]<0x1e*0x3c*0x3e8)continue;const _0x4521a6=_0x35e5b5[_0x48dcc4(0x1d3)](_0x20af66=>normalize(_0x20af66['location'])===normalize(_0x3fc4a4));if(!_0x4521a6)continue;const _0x41c9dd=await findSetpointId(_0x37cae5,_0x4521a6['id']);if(_0x41c9dd){const _0x1c7b71=await _0x37cae5['getForeignStateAsync'](_0x41c9dd);if(_0x1c7b71&&typeof _0x1c7b71[_0x48dcc4(0x1e0)]===_0x48dcc4(0x1ac)){const _0x4e88e5=_0x1c7b71[_0x48dcc4(0x1e0)];if(_0x374876>0x1e&&_0x4e88e5>0x11){const _0x5b6381=_0x4e88e5-0x1;_0x37cae5[_0x48dcc4(0x1dd)][_0x48dcc4(0x1e9)](_0x48dcc4(0x1da)+_0x3fc4a4+'\x20('+_0x41c9dd+_0x48dcc4(0x192)+_0x5b6381+_0x48dcc4(0x1ab)+_0x374876+_0x48dcc4(0x1e1)),await _0x37cae5[_0x48dcc4(0x1d0)](_0x41c9dd,_0x5b6381),lastActions[_0x48dcc4(0x194)+_0x3fc4a4]=_0x44f648,await _0x37cae5['setStateAsync']('analysis.automation.lastAction',{'val':_0x48dcc4(0x199)+_0x3fc4a4+':\x20-1Â°C\x20(Sparpotenzial\x20genutzt)','ack':!![]});}}}}}module['exports']={'handlePrediction':handlePrediction,'applyEnergySavings':applyEnergySavings,'scanThermostats':scanThermostats};