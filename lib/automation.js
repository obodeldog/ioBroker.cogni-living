const a1_0x2b68e6=a1_0xb69a;(function(_0x32d0d0,_0x304e87){const _0x37fcd1=a1_0xb69a,_0x31032e=_0x32d0d0();while(!![]){try{const _0x304eae=parseInt(_0x37fcd1(0x216))/0x1+parseInt(_0x37fcd1(0x279))/0x2+-parseInt(_0x37fcd1(0x214))/0x3*(parseInt(_0x37fcd1(0x26d))/0x4)+-parseInt(_0x37fcd1(0x218))/0x5*(parseInt(_0x37fcd1(0x1e1))/0x6)+-parseInt(_0x37fcd1(0x271))/0x7*(parseInt(_0x37fcd1(0x21a))/0x8)+parseInt(_0x37fcd1(0x248))/0x9*(parseInt(_0x37fcd1(0x273))/0xa)+parseInt(_0x37fcd1(0x23d))/0xb*(parseInt(_0x37fcd1(0x242))/0xc);if(_0x304eae===_0x304e87)break;else _0x31032e['push'](_0x31032e['shift']());}catch(_0x8ef990){_0x31032e['push'](_0x31032e['shift']());}}}(a1_0x2e30,0xe790f));const a1_0x55939d=(function(){let _0x4d0942=!![];return function(_0x55483d,_0xc4dac6){const _0x431003=_0x4d0942?function(){const _0x2d17db=a1_0xb69a;if(_0xc4dac6){const _0x268f43=_0xc4dac6[_0x2d17db(0x1f5)](_0x55483d,arguments);return _0xc4dac6=null,_0x268f43;}}:function(){};return _0x4d0942=![],_0x431003;};}()),a1_0x23e47a=a1_0x55939d(this,function(){const _0x1b3e10=a1_0xb69a;return a1_0x23e47a[_0x1b3e10(0x1e8)]()[_0x1b3e10(0x213)](_0x1b3e10(0x225))[_0x1b3e10(0x1e8)]()[_0x1b3e10(0x236)](a1_0x23e47a)['search'](_0x1b3e10(0x225));});a1_0x23e47a();'use strict';const aiAgent=require(a1_0x2b68e6(0x222)),COOLDOWN_MS=0x3c*0x3e8,CAL_COOLDOWN_MS=0x5a*0x3c*0x3e8,ECO_TEMP=0x11,lastActions={};function normalize(_0x8a7fdf){const _0x4ae5d1=a1_0x2b68e6;if(!_0x8a7fdf)return'';return _0x8a7fdf['toLowerCase']()[_0x4ae5d1(0x228)](/\s+/g,'')[_0x4ae5d1(0x259)]();}async function handlePrediction(_0x5bce3d,_0x477524,_0x1d9dad){const _0x39a0b7=a1_0x2b68e6;if(!_0x477524||_0x477524===_0x39a0b7(0x1f9))return;let _0x5ce191=_0x39a0b7(0x272),_0x522b4e=0.6;try{const _0x487613=await _0x5bce3d[_0x39a0b7(0x241)](_0x39a0b7(0x20b));if(_0x487613&&_0x487613['val'])_0x5ce191=_0x487613[_0x39a0b7(0x1eb)];const _0x1a6709=await _0x5bce3d[_0x39a0b7(0x241)](_0x39a0b7(0x21b));if(_0x1a6709&&_0x1a6709[_0x39a0b7(0x1eb)])_0x522b4e=_0x1a6709[_0x39a0b7(0x1eb)];}catch(_0x424fb7){}if(_0x5ce191===_0x39a0b7(0x272)||_0x1d9dad<_0x522b4e)return;const _0x547e90=Date[_0x39a0b7(0x205)]();if(lastActions[_0x477524]&&_0x547e90-lastActions[_0x477524]<COOLDOWN_MS)return;const _0x22d506=_0x5bce3d[_0x39a0b7(0x1f7)][_0x39a0b7(0x22d)]||[],_0x34daf9=normalize(_0x477524),_0x2fcf8e=_0x22d506['find'](_0x5333d0=>normalize(_0x5333d0[_0x39a0b7(0x1f0)])===_0x34daf9&&(_0x5333d0[_0x39a0b7(0x251)]===_0x39a0b7(0x1fa)||_0x5333d0['type']===_0x39a0b7(0x1ff)||_0x5333d0['type']==='switch'));if(!_0x2fcf8e)return;const _0x4b1bbf=await aiAgent['consultButler'](_0x5bce3d,_0x477524,_0x2fcf8e['name'],_0x1d9dad);if(!_0x4b1bbf[_0x39a0b7(0x221)])return;const _0x131162=_0x39a0b7(0x22f)+_0x477524+_0x39a0b7(0x1e7)+_0x2fcf8e['name']+'\x20('+_0x4b1bbf[_0x39a0b7(0x20c)]+')';await _0x5bce3d[_0x39a0b7(0x229)](_0x39a0b7(0x1f3),{'val':'['+_0x5ce191[_0x39a0b7(0x233)]()+']\x20'+_0x131162,'ack':!![]});if(_0x5ce191===_0x39a0b7(0x22c)){const _0x13dd67=await _0x5bce3d[_0x39a0b7(0x22e)](_0x2fcf8e['id']);(!_0x13dd67||!_0x13dd67[_0x39a0b7(0x1eb)]&&_0x13dd67[_0x39a0b7(0x1eb)]!==!![])&&await _0x5bce3d[_0x39a0b7(0x20e)](_0x2fcf8e['id'],!![]),lastActions[_0x477524]=_0x547e90;}}function a1_0x2e30(){const _0x3862ae=['(((.+)+)+)+$','name','setpoint','replace','setStateAsync','actual','push','active','devices','getForeignStateAsync','PrÃ¤diktion:\x20','filter','calendarInstance','.data.table','toUpperCase','temp','role','constructor','warn','level.valve','.1.SET_POINT_TEMPERATURE','valve','stellwert','\x20wieder\x20auf\x20','420486FgOoBJ','unit','Â°C!\x20(Puffer\x20leer).\x20->\x20ID:\x20','rÃ¼ckkehr','getStateAsync','168jxeLmv','[MPC\x20WARNING]\x20Kein\x20Setpoint\x20(Soll-Temp)\x20fÃ¼r\x20','\x20min).','parse','Fehlt','Nicht\x20gefunden','10673001grXebc','target_temperature','\x20min)\x20->\x20ID:\x20','info','Soll','normal','level.temperature','room','date','type','valve_position','\x20gefunden!\x20Bitte\x20\x27System\x27\x20Tab\x20prÃ¼fen.','hm-rpc','soll','Calendar\x20Check\x20Error:\x20','join','split','trim','temperature','from','.1.LEVEL','event','occupied_heating_setpoint','mpc_','sort','.4.SET_TEMPERATURE','toLowerCase','default','Auto-Erkennung','local_temperature','getTime','localeCompare','Unbekannt','set','ðŸ“…\x20SMART\x20SCHEDULE\x20(Phase):\x20\x27Globaler\x20Start\x27\x20erkannt\x20(','.1.TEMPERATURE','ACTUAL_TEMPERATURE','12qWFUtx','current_heating_setpoint','stringify','valveMapping','10189445IkdGWL','off','10mqezjx','ðŸƒ\x20[MPC\x20ACTION]\x20Senke\x20','SET_POINT_TEMPERATURE','values','analysis.energy.warmupTimes','_date','3598344eYvTDY','number','[CAL]\x20','triggerTime','SET','16032HPYYnq','_calName','state','forEach','message','Ist','\x20->\x20Schalte\x20','toString','common','getForeignObjectAsync','val','length','messwert','slice','add','location','getForeignObjectsAsync','minutes_safe','analysis.automation.lastAction',':\x20Absenkung\x20auf\x20','apply','Â°C!\x20(Aktuell:\x20','config','score','Unknown','light','level','pi_heating_demand','system.mode','string','dimmer','useCalendar','eventStart','currentSystemMode','Â°C\x20(Vorlauf:\x20','calendarSelection','now','summary','ðŸ”¥\x20[MPC\x20ACTION]\x20Heize\x20','.4.VALVE_STATE','write','thermostatMapping','analysis.automation.mode','reason','urlaub\x20ende','setForeignStateAsync','log','\x27\x20aktiv\x20(','thermostat','ankunft','search','359787ViBRCW','cal_','488844UPvCds','\x20->\x20','2330XDgVdz','target','8ANVaoS','analysis.automation.confidenceThreshold','thermostat.setpoint',':\x20Aufheizen\x20auf\x20','analysis.energy.schedulePreview','includes','.1.ACTUAL_TEMPERATURE','approved','./ai_agent','ACTUAL','openknx'];a1_0x2e30=function(){return _0x3862ae;};return a1_0x2e30();}function a1_0xb69a(_0x43cf22,_0x413566){const _0x3c3d8d=a1_0x2e30();return a1_0xb69a=function(_0x23e47a,_0x55939d){_0x23e47a=_0x23e47a-0x1e1;let _0x2e3083=_0x3c3d8d[_0x23e47a];return _0x2e3083;},a1_0xb69a(_0x43cf22,_0x413566);}async function findRelatedId(_0x10b7eb,_0x26be56,_0x59ca4c=a1_0x2b68e6(0x227)){const _0x4ad7f1=a1_0x2b68e6;if(_0x59ca4c===_0x4ad7f1(0x227)&&_0x10b7eb['config'][_0x4ad7f1(0x20a)]){let _0x5151b9=_0x10b7eb['config']['thermostatMapping'];if(typeof _0x5151b9===_0x4ad7f1(0x1fe))try{_0x5151b9=JSON[_0x4ad7f1(0x245)](_0x5151b9);}catch(_0xa77c74){}if(_0x5151b9&&_0x5151b9[_0x26be56])return _0x5151b9[_0x26be56];}if(_0x59ca4c===_0x4ad7f1(0x23a)&&_0x10b7eb['config'][_0x4ad7f1(0x270)]){let _0x2dd098=_0x10b7eb[_0x4ad7f1(0x1f7)][_0x4ad7f1(0x270)];if(typeof _0x2dd098===_0x4ad7f1(0x1fe))try{_0x2dd098=JSON[_0x4ad7f1(0x245)](_0x2dd098);}catch(_0x58888e){}if(_0x2dd098&&_0x2dd098[_0x26be56])return _0x2dd098[_0x26be56];}let _0x351ee2=[];if(_0x59ca4c==='setpoint')_0x351ee2=[{'s':_0x4ad7f1(0x220),'t':_0x4ad7f1(0x239)},{'s':_0x4ad7f1(0x26b),'t':'.1.SET_POINT_TEMPERATURE'},{'s':'.1.TEMPERATURE','t':_0x4ad7f1(0x261)},{'s':_0x4ad7f1(0x26c),'t':_0x4ad7f1(0x275)},{'s':_0x4ad7f1(0x265),'t':_0x4ad7f1(0x25e)},{'s':'local_temperature','t':_0x4ad7f1(0x26e)},{'s':_0x4ad7f1(0x25a),'t':_0x4ad7f1(0x249)},{'s':_0x4ad7f1(0x223),'t':_0x4ad7f1(0x27d)},{'s':_0x4ad7f1(0x1e6),'t':_0x4ad7f1(0x24c)},{'s':_0x4ad7f1(0x25a),'t':'setpoint'}];else _0x59ca4c==='valve'&&(_0x351ee2=[{'s':'.1.ACTUAL_TEMPERATURE','t':_0x4ad7f1(0x25c)},{'s':_0x4ad7f1(0x26b),'t':_0x4ad7f1(0x25c)},{'s':_0x4ad7f1(0x26b),'t':_0x4ad7f1(0x208)},{'s':_0x4ad7f1(0x265),'t':_0x4ad7f1(0x1fc)},{'s':_0x4ad7f1(0x25a),'t':_0x4ad7f1(0x252)},{'s':'temperature','t':_0x4ad7f1(0x1fb)}]);for(const _0x2f4ad9 of _0x351ee2){if(_0x26be56[_0x4ad7f1(0x21f)](_0x2f4ad9['s'])){const _0x1a29bf=_0x26be56[_0x4ad7f1(0x228)](_0x2f4ad9['s'],_0x2f4ad9['t']),_0x29e90d=await _0x10b7eb[_0x4ad7f1(0x1ea)](_0x1a29bf);if(_0x29e90d)return _0x1a29bf;}}try{const _0x42eaa6=_0x26be56['split']('.');if(_0x42eaa6['length']>0x2){const _0x5b39ea=_0x42eaa6['slice'](0x0,-0x1)[_0x4ad7f1(0x257)]('.'),_0xdac990=await _0x10b7eb[_0x4ad7f1(0x1f1)](_0x5b39ea+'.*'),_0x13d60c=[],_0x3ce4b5=_0x26be56['split'](/[._]+/)['filter'](_0x619655=>![_0x4ad7f1(0x224),'0',_0x4ad7f1(0x254),'ist','wert',_0x4ad7f1(0x25a),_0x4ad7f1(0x22a),'sensor',_0x4ad7f1(0x1ed),_0x4ad7f1(0x1e3)][_0x4ad7f1(0x21f)](_0x619655[_0x4ad7f1(0x262)]()));for(const [_0x16af4e,_0x332066]of Object['entries'](_0xdac990)){if(_0x16af4e===_0x26be56)continue;if(_0x332066&&_0x332066['common']){const _0x41f31d=_0x16af4e[_0x4ad7f1(0x262)](),_0x1497b4=(_0x332066[_0x4ad7f1(0x1e9)][_0x4ad7f1(0x235)]||'')[_0x4ad7f1(0x262)](),_0x15fc69=(_0x332066[_0x4ad7f1(0x1e9)][_0x4ad7f1(0x23e)]||'')['toLowerCase']();let _0x4b0af4=![];if(_0x59ca4c===_0x4ad7f1(0x227)&&_0x332066[_0x4ad7f1(0x1e9)][_0x4ad7f1(0x209)]===!![])_0x4b0af4=_0x41f31d[_0x4ad7f1(0x21f)](_0x4ad7f1(0x269))||_0x41f31d[_0x4ad7f1(0x21f)](_0x4ad7f1(0x255))||_0x41f31d['includes'](_0x4ad7f1(0x219))||_0x1497b4[_0x4ad7f1(0x21f)](_0x4ad7f1(0x24e))||_0x1497b4[_0x4ad7f1(0x21f)](_0x4ad7f1(0x21c));else _0x59ca4c===_0x4ad7f1(0x23a)&&(_0x4b0af4=_0x41f31d[_0x4ad7f1(0x21f)](_0x4ad7f1(0x1fb))||_0x41f31d[_0x4ad7f1(0x21f)](_0x4ad7f1(0x23a))||_0x41f31d[_0x4ad7f1(0x21f)](_0x4ad7f1(0x23b))||_0x41f31d['includes']('position')||_0x1497b4['includes'](_0x4ad7f1(0x238))||_0x1497b4[_0x4ad7f1(0x21f)]('value.valve')||_0x15fc69[_0x4ad7f1(0x21f)]('%'));if(_0x4b0af4){const _0x2d08d1=_0x16af4e[_0x4ad7f1(0x258)](/[._]+/)['map'](_0x411c84=>_0x411c84[_0x4ad7f1(0x262)]());let _0x49660c=0x0;_0x3ce4b5['forEach'](_0x30b8a9=>{const _0x1beba6=_0x4ad7f1;if(_0x2d08d1[_0x1beba6(0x21f)](_0x30b8a9['toLowerCase']()))_0x49660c++;}),_0x13d60c[_0x4ad7f1(0x22b)]({'id':_0x16af4e,'score':_0x49660c});}}}if(_0x13d60c[_0x4ad7f1(0x1ec)]>0x0){_0x13d60c[_0x4ad7f1(0x260)]((_0x2b0ec1,_0x43e690)=>_0x43e690[_0x4ad7f1(0x1f8)]-_0x2b0ec1[_0x4ad7f1(0x1f8)]);if(_0x13d60c[0x0][_0x4ad7f1(0x1f8)]>0x0)return _0x13d60c[0x0]['id'];}}}catch(_0x59e16b){}return null;}async function scanThermostats(_0x151ac0){const _0x4682a7=a1_0x2b68e6,_0x49d127=_0x151ac0['config'][_0x4682a7(0x22d)]||[],_0x3a5bbd=[],_0x14af05=_0x49d127[_0x4682a7(0x230)](_0x3c25da=>_0x3c25da['id']&&_0x3c25da['id'][_0x4682a7(0x21f)](_0x4682a7(0x25a))||_0x3c25da[_0x4682a7(0x251)]&&[_0x4682a7(0x25a),'thermostat','sensor'][_0x4682a7(0x21f)](_0x3c25da['type'])||_0x3c25da['name']&&_0x3c25da[_0x4682a7(0x226)][_0x4682a7(0x262)]()[_0x4682a7(0x21f)](_0x4682a7(0x234)));for(const _0x21c38a of _0x14af05){const _0x30e2ec=await findRelatedId(_0x151ac0,_0x21c38a['id'],'setpoint'),_0x38038b=await findRelatedId(_0x151ac0,_0x21c38a['id'],'valve');let _0x40e3db=_0x4682a7(0x247),_0x4569ff=![],_0x595195=_0x151ac0[_0x4682a7(0x1f7)][_0x4682a7(0x20a)]||{};if(typeof _0x595195===_0x4682a7(0x1fe))try{_0x595195=JSON[_0x4682a7(0x245)](_0x595195);}catch(_0x45fa91){}let _0x22ff5c=_0x151ac0[_0x4682a7(0x1f7)]['valveMapping']||{};if(typeof _0x22ff5c===_0x4682a7(0x1fe))try{_0x22ff5c=JSON[_0x4682a7(0x245)](_0x22ff5c);}catch(_0x2aa851){}if(_0x595195[_0x21c38a['id']]&&_0x595195[_0x21c38a['id']]===_0x30e2ec||_0x22ff5c[_0x21c38a['id']]&&_0x22ff5c[_0x21c38a['id']]===_0x38038b)_0x40e3db='Manuelles\x20Mapping',_0x4569ff=!![];else(_0x30e2ec||_0x38038b)&&(_0x40e3db=_0x4682a7(0x264));_0x3a5bbd[_0x4682a7(0x22b)]({'room':_0x21c38a[_0x4682a7(0x1f0)]||_0x4682a7(0x268),'sensorId':_0x21c38a['id'],'setpointId':_0x30e2ec||'-','valveId':_0x38038b||'-','source':_0x40e3db,'isManual':_0x4569ff,'status':_0x30e2ec&&_0x38038b?'PERFECT':_0x30e2ec?'OK':_0x4682a7(0x246)});}return _0x3a5bbd[_0x4682a7(0x260)]((_0x555dbb,_0xc207d5)=>_0x555dbb[_0x4682a7(0x24f)][_0x4682a7(0x267)](_0xc207d5[_0x4682a7(0x24f)]));}async function updateSchedulePreview(_0x46e1c5){const _0x2a8fe7=a1_0x2b68e6;if(!_0x46e1c5[_0x2a8fe7(0x1f7)][_0x2a8fe7(0x200)]||!_0x46e1c5[_0x2a8fe7(0x1f7)]['calendarInstance'])return;let _0x52bf80={};try{const _0x7c28ec=await _0x46e1c5['getStateAsync'](_0x2a8fe7(0x277));if(_0x7c28ec&&_0x7c28ec['val'])_0x52bf80=JSON[_0x2a8fe7(0x245)](_0x7c28ec[_0x2a8fe7(0x1eb)]);}catch(_0x14a9e3){}const _0x16dfd9=[],_0x5e194d=Date[_0x2a8fe7(0x205)](),_0x2d4d0e=0x30*0x3c*0x3c*0x3e8;try{const _0x55b53c=await _0x46e1c5[_0x2a8fe7(0x22e)](_0x46e1c5['config'][_0x2a8fe7(0x231)]+_0x2a8fe7(0x232));if(!_0x55b53c||!_0x55b53c[_0x2a8fe7(0x1eb)])return;const _0x2f839e=JSON['parse'](_0x55b53c['val']),_0xe0ba4e=_0x46e1c5[_0x2a8fe7(0x1f7)][_0x2a8fe7(0x204)]||[],_0x376b12=_0x46e1c5[_0x2a8fe7(0x1f7)][_0x2a8fe7(0x22d)]||[],_0x39458c=new Set();_0x376b12['forEach'](_0x4b930b=>{const _0x37e522=_0x2a8fe7;if(_0x4b930b[_0x37e522(0x1f0)])_0x39458c[_0x37e522(0x1ef)](_0x4b930b['location']);});for(const _0x4c1880 of _0x2f839e){if(_0x4c1880[_0x2a8fe7(0x1e2)]&&_0xe0ba4e['length']>0x0&&!_0xe0ba4e['includes'](_0x4c1880[_0x2a8fe7(0x1e2)]))continue;const _0x291cde=_0x4c1880['_date']||_0x4c1880[_0x2a8fe7(0x201)]||_0x4c1880['date'];if(!_0x291cde)continue;const _0xcdab38=new Date(_0x291cde),_0x2922c5=_0xcdab38[_0x2a8fe7(0x266)]();if(isNaN(_0x2922c5))continue;if(_0x2922c5<_0x5e194d)continue;if(_0x2922c5>_0x5e194d+_0x2d4d0e)continue;const _0x3fd2dc=(_0x4c1880['event']||_0x4c1880[_0x2a8fe7(0x206)]||'')[_0x2a8fe7(0x262)]();let _0x38c606=![],_0x43cce7=[],_0x38758b=_0x4c1880['event']||_0x4c1880['summary']||_0x2a8fe7(0x268);if(_0x3fd2dc[_0x2a8fe7(0x21f)](_0x2a8fe7(0x20d))||_0x3fd2dc[_0x2a8fe7(0x21f)](_0x2a8fe7(0x240))||_0x3fd2dc[_0x2a8fe7(0x21f)](_0x2a8fe7(0x212)))_0x38c606=!![],_0x43cce7=Array[_0x2a8fe7(0x25b)](_0x39458c);else for(const _0x4cbead of _0x39458c){_0x3fd2dc[_0x2a8fe7(0x21f)](_0x4cbead[_0x2a8fe7(0x262)]())&&_0x43cce7[_0x2a8fe7(0x22b)](_0x4cbead);}_0x43cce7[_0x2a8fe7(0x1ec)]>0x0&&_0x43cce7[_0x2a8fe7(0x1e4)](_0x790f5a=>{const _0x3dea52=_0x2a8fe7;let _0x3ca1ec=0x3c;if(_0x38c606){let _0x253de1=0x0;Object[_0x3dea52(0x276)](_0x52bf80)[_0x3dea52(0x1e4)](_0x1e7865=>{if(_0x1e7865>_0x253de1)_0x253de1=_0x1e7865;}),_0x3ca1ec=_0x253de1>0x0?_0x253de1:0x78;}else _0x3ca1ec=_0x52bf80[_0x790f5a]||0x3c;const _0x3a94ad=new Date(_0x2922c5-_0x3ca1ec*0xea60);_0x16dfd9[_0x3dea52(0x22b)]({'eventTime':_0x2922c5,'triggerTime':_0x3a94ad[_0x3dea52(0x266)](),'room':_0x790f5a,'minutes':_0x3ca1ec,'reason':_0x38758b,'isGlobal':_0x38c606});});}}catch(_0x2300e8){}_0x16dfd9['sort']((_0x3fd9e6,_0x52c83c)=>_0x3fd9e6[_0x2a8fe7(0x27c)]-_0x52c83c[_0x2a8fe7(0x27c)]);const _0x121ed8=_0x16dfd9[_0x2a8fe7(0x1ee)](0x0,0x5);await _0x46e1c5[_0x2a8fe7(0x229)](_0x2a8fe7(0x21e),{'val':JSON[_0x2a8fe7(0x26f)](_0x121ed8),'ack':!![]});}async function checkCalendarTriggers(_0x3eba21){const _0x4033a3=a1_0x2b68e6;if(!_0x3eba21[_0x4033a3(0x1f7)]['useCalendar']||!_0x3eba21[_0x4033a3(0x1f7)]['calendarInstance'])return;await updateSchedulePreview(_0x3eba21);let _0x45f230={};try{const _0x4d6c35=await _0x3eba21[_0x4033a3(0x241)](_0x4033a3(0x277));if(_0x4d6c35&&_0x4d6c35['val'])_0x45f230=JSON['parse'](_0x4d6c35[_0x4033a3(0x1eb)]);}catch(_0x50abef){}let _0x3b7a1c={'default':0x15};try{const _0xf893fa=await _0x3eba21[_0x4033a3(0x241)]('analysis.energy.warmupTargets');if(_0xf893fa&&_0xf893fa['val'])_0x3b7a1c=JSON[_0x4033a3(0x245)](_0xf893fa[_0x4033a3(0x1eb)]);}catch(_0xb95994){}try{const _0x561cd5=await _0x3eba21[_0x4033a3(0x22e)](_0x3eba21[_0x4033a3(0x1f7)]['calendarInstance']+_0x4033a3(0x232));if(!_0x561cd5||!_0x561cd5[_0x4033a3(0x1eb)])return;const _0x27c9c7=JSON[_0x4033a3(0x245)](_0x561cd5['val']),_0x501e89=Date[_0x4033a3(0x205)](),_0x2d1040=_0x3eba21[_0x4033a3(0x1f7)][_0x4033a3(0x22d)]||[],_0x15b505=_0x3eba21[_0x4033a3(0x1f7)][_0x4033a3(0x204)]||[];for(const _0x2324f9 of _0x27c9c7){if(_0x2324f9[_0x4033a3(0x1e2)]&&_0x15b505[_0x4033a3(0x1ec)]>0x0&&!_0x15b505[_0x4033a3(0x21f)](_0x2324f9[_0x4033a3(0x1e2)]))continue;const _0x151629=_0x2324f9[_0x4033a3(0x278)]||_0x2324f9['eventStart']||_0x2324f9[_0x4033a3(0x250)];if(!_0x151629)continue;const _0x16f882=new Date(_0x151629);if(isNaN(_0x16f882[_0x4033a3(0x266)]()))continue;const _0x35cef2=(_0x2324f9[_0x4033a3(0x25d)]||_0x2324f9[_0x4033a3(0x206)]||'')[_0x4033a3(0x262)]();if(_0x35cef2[_0x4033a3(0x21f)](_0x4033a3(0x20d))||_0x35cef2[_0x4033a3(0x21f)](_0x4033a3(0x240))||_0x35cef2['includes'](_0x4033a3(0x212))){let _0x4a6f70=0x0;Object[_0x4033a3(0x276)](_0x45f230)['forEach'](_0x4621b2=>{if(_0x4621b2>_0x4a6f70)_0x4a6f70=_0x4621b2;});if(_0x4a6f70===0x0)_0x4a6f70=0x78;const _0x3d8b25=_0x16f882['getTime']()-_0x4a6f70*0xea60;_0x501e89>=_0x3d8b25&&_0x501e89<_0x16f882['getTime']()&&(_0x3eba21[_0x4033a3(0x202)]!==_0x4033a3(0x24d)&&(_0x3eba21['log'][_0x4033a3(0x24b)](_0x4033a3(0x26a)+_0x2324f9[_0x4033a3(0x25d)]+').\x20Heize\x20ganzes\x20Haus\x20auf\x20(Vorlauf:\x20'+_0x4a6f70+_0x4033a3(0x244)),await _0x3eba21[_0x4033a3(0x229)](_0x4033a3(0x1fd),{'val':_0x4033a3(0x24d),'ack':![]})));}for(const _0xa20658 of _0x2d1040){if(_0xa20658['location']){const _0x1508e7=_0xa20658[_0x4033a3(0x1f0)][_0x4033a3(0x262)]();if(_0x35cef2[_0x4033a3(0x21f)](_0x1508e7)){const _0x2cc1ad=_0x45f230[_0xa20658[_0x4033a3(0x1f0)]]||0x3c,_0x1219d4=_0x16f882['getTime']()-_0x2cc1ad*0xea60;if(_0x501e89>=_0x1219d4&&_0x501e89<_0x16f882[_0x4033a3(0x266)]()){const _0x58c554=lastActions[_0x4033a3(0x215)+_0xa20658[_0x4033a3(0x1f0)]];if(_0x58c554&&_0x501e89-_0x58c554<CAL_COOLDOWN_MS)continue;const _0x545b84=await findRelatedId(_0x3eba21,_0xa20658['id'],_0x4033a3(0x227));if(_0x545b84){let _0x35aca8=_0x3b7a1c[_0xa20658[_0x4033a3(0x1f0)]];if(_0x35aca8===undefined)_0x35aca8=_0x3b7a1c[_0x4033a3(0x263)];if(_0x35aca8===undefined)_0x35aca8=0x15;const _0x25d073=await _0x3eba21[_0x4033a3(0x22e)](_0x545b84);_0x25d073&&typeof _0x25d073[_0x4033a3(0x1eb)]===_0x4033a3(0x27a)&&_0x25d073[_0x4033a3(0x1eb)]<_0x35aca8-0.5&&(_0x3eba21[_0x4033a3(0x20f)]['info']('ðŸ“…\x20SMART\x20SCHEDULE\x20(Catch-Up):\x20Raum-Trigger\x20\x27'+_0xa20658[_0x4033a3(0x1f0)]+_0x4033a3(0x210)+_0x2324f9[_0x4033a3(0x25d)]+').\x20Heize\x20auf\x20'+_0x35aca8+_0x4033a3(0x203)+_0x2cc1ad+_0x4033a3(0x244)),await _0x3eba21[_0x4033a3(0x20e)](_0x545b84,_0x35aca8),await _0x3eba21[_0x4033a3(0x229)](_0x4033a3(0x1f3),{'val':_0x4033a3(0x27b)+_0xa20658[_0x4033a3(0x1f0)]+_0x4033a3(0x217)+_0x35aca8+'Â°C','ack':!![]}),lastActions['cal_'+_0xa20658[_0x4033a3(0x1f0)]]=_0x501e89);}}}}}}}catch(_0x5e17e7){_0x3eba21[_0x4033a3(0x20f)][_0x4033a3(0x237)](_0x4033a3(0x256)+_0x5e17e7[_0x4033a3(0x1e5)]);}}async function applyEnergySavings(_0x197642,_0x49d259){const _0x5e36bf=a1_0x2b68e6;if(!_0x49d259||_0x49d259[_0x5e36bf(0x1ec)]===0x0)return;const _0x15fd60=_0x197642[_0x5e36bf(0x1f7)][_0x5e36bf(0x22d)]||[],_0xbb2151=Date[_0x5e36bf(0x205)]();for(const _0x4869df of _0x49d259){const _0x37275e=_0x4869df[_0x5e36bf(0x24f)],_0x3d37e8=_0x4869df[_0x5e36bf(0x1f2)],_0x1482b4=_0x4869df[_0x5e36bf(0x219)]||0x15,_0x4fe2f8=_0x15fd60['find'](_0x22a937=>normalize(_0x22a937[_0x5e36bf(0x1f0)])===normalize(_0x37275e)&&(_0x22a937[_0x5e36bf(0x251)]===_0x5e36bf(0x25a)||_0x22a937[_0x5e36bf(0x251)]===_0x5e36bf(0x211)));if(!_0x4fe2f8)continue;const _0x5f28b1=await findRelatedId(_0x197642,_0x4fe2f8['id'],_0x5e36bf(0x227));if(_0x5f28b1){if(lastActions[_0x5e36bf(0x25f)+_0x37275e]&&_0xbb2151-lastActions['mpc_'+_0x37275e]<0x1e*0x3c*0x3e8)continue;const _0x9d28bf=await _0x197642[_0x5e36bf(0x22e)](_0x5f28b1);if(_0x9d28bf&&typeof _0x9d28bf['val']===_0x5e36bf(0x27a)){const _0x2571b9=_0x9d28bf[_0x5e36bf(0x1eb)];if(_0x3d37e8>0x1e)_0x2571b9>ECO_TEMP+0.5&&(_0x197642[_0x5e36bf(0x20f)]['info'](_0x5e36bf(0x274)+_0x37275e+'\x20auf\x20'+ECO_TEMP+_0x5e36bf(0x1f6)+_0x2571b9+'Â°C,\x20Puffer:\x20'+_0x3d37e8+_0x5e36bf(0x24a)+_0x5f28b1),await _0x197642['setForeignStateAsync'](_0x5f28b1,ECO_TEMP),lastActions[_0x5e36bf(0x25f)+_0x37275e]=_0xbb2151,await _0x197642[_0x5e36bf(0x229)]('analysis.automation.lastAction',{'val':'[MPC]\x20'+_0x37275e+_0x5e36bf(0x1f4)+ECO_TEMP+'Â°C','ack':!![]}));else _0x3d37e8<=0xf&&(_0x2571b9<_0x1482b4&&(_0x197642[_0x5e36bf(0x20f)]['info'](_0x5e36bf(0x207)+_0x37275e+_0x5e36bf(0x23c)+_0x1482b4+_0x5e36bf(0x23f)+_0x5f28b1),await _0x197642[_0x5e36bf(0x20e)](_0x5f28b1,_0x1482b4),lastActions[_0x5e36bf(0x25f)+_0x37275e]=_0xbb2151,await _0x197642[_0x5e36bf(0x229)](_0x5e36bf(0x1f3),{'val':'[MPC]\x20'+_0x37275e+_0x5e36bf(0x21d)+_0x1482b4+'Â°C','ack':!![]})));}}else _0x197642['log'][_0x5e36bf(0x237)](_0x5e36bf(0x243)+_0x37275e+_0x5e36bf(0x253));}}module['exports']={'handlePrediction':handlePrediction,'applyEnergySavings':applyEnergySavings,'scanThermostats':scanThermostats,'checkCalendarTriggers':checkCalendarTriggers,'updateSchedulePreview':updateSchedulePreview};