const a1_0x5a627b=a1_0x14f9;(function(_0x507045,_0x45bb3b){const _0xa126e0=a1_0x14f9,_0x4b8a61=_0x507045();while(!![]){try{const _0x46b114=parseInt(_0xa126e0(0x165))/0x1*(-parseInt(_0xa126e0(0x15a))/0x2)+parseInt(_0xa126e0(0x15d))/0x3*(-parseInt(_0xa126e0(0x14d))/0x4)+-parseInt(_0xa126e0(0x158))/0x5+parseInt(_0xa126e0(0x167))/0x6+-parseInt(_0xa126e0(0x159))/0x7+-parseInt(_0xa126e0(0x139))/0x8*(-parseInt(_0xa126e0(0x17e))/0x9)+parseInt(_0xa126e0(0x16b))/0xa*(parseInt(_0xa126e0(0x17a))/0xb);if(_0x46b114===_0x45bb3b)break;else _0x4b8a61['push'](_0x4b8a61['shift']());}catch(_0x438d8d){_0x4b8a61['push'](_0x4b8a61['shift']());}}}(a1_0x1f4d,0x9a685));const a1_0x41018f=(function(){let _0x39a412=!![];return function(_0x296a3f,_0x62a18a){const _0xddc5f=_0x39a412?function(){const _0x4171a4=a1_0x14f9;if(_0x62a18a){const _0x1f3e98=_0x62a18a[_0x4171a4(0x181)](_0x296a3f,arguments);return _0x62a18a=null,_0x1f3e98;}}:function(){};return _0x39a412=![],_0xddc5f;};}()),a1_0x2e355d=a1_0x41018f(this,function(){const _0x32c38e=a1_0x14f9;return a1_0x2e355d['toString']()[_0x32c38e(0x123)](_0x32c38e(0x175))[_0x32c38e(0x18a)]()['constructor'](a1_0x2e355d)['search']('(((.+)+)+)+$');});a1_0x2e355d();'use strict';const aiAgent=require(a1_0x5a627b(0x16e)),COOLDOWN_MS=0x3c*0x3e8,lastActions={};function normalize(_0x354ddc){const _0x35ff80=a1_0x5a627b;if(!_0x354ddc)return'';return _0x354ddc[_0x35ff80(0x180)]()['replace'](/\s+/g,'')[_0x35ff80(0x16f)]();}function a1_0x14f9(_0x219803,_0x47b537){const _0x1fb9bc=a1_0x1f4d();return a1_0x14f9=function(_0x2e355d,_0x41018f){_0x2e355d=_0x2e355d-0x121;let _0x1f4dbf=_0x1fb9bc[_0x2e355d];return _0x1f4dbf;},a1_0x14f9(_0x219803,_0x47b537);}async function handlePrediction(_0x31586f,_0x3fb98b,_0x2a11fb){const _0x1eb226=a1_0x5a627b;if(!_0x3fb98b||_0x3fb98b===_0x1eb226(0x183))return;let _0x190788='off',_0x74f864=0.6;try{const _0x1c4881=await _0x31586f[_0x1eb226(0x13e)]('analysis.automation.mode');if(_0x1c4881&&_0x1c4881[_0x1eb226(0x16a)])_0x190788=_0x1c4881[_0x1eb226(0x16a)];const _0x3cf6ec=await _0x31586f[_0x1eb226(0x13e)](_0x1eb226(0x154));if(_0x3cf6ec&&_0x3cf6ec[_0x1eb226(0x16a)])_0x74f864=_0x3cf6ec[_0x1eb226(0x16a)];}catch(_0x4e55f7){}if(_0x190788===_0x1eb226(0x15e)||_0x2a11fb<_0x74f864)return;const _0x4d150f=Date[_0x1eb226(0x12f)]();if(lastActions[_0x3fb98b]&&_0x4d150f-lastActions[_0x3fb98b]<COOLDOWN_MS)return;const _0x4185e3=_0x31586f[_0x1eb226(0x148)][_0x1eb226(0x16c)]||[],_0x550e94=normalize(_0x3fb98b),_0x49d280=_0x4185e3[_0x1eb226(0x12a)](_0x5cff3c=>normalize(_0x5cff3c['location'])===_0x550e94&&(_0x5cff3c[_0x1eb226(0x132)]===_0x1eb226(0x171)||_0x5cff3c[_0x1eb226(0x132)]==='dimmer'||_0x5cff3c[_0x1eb226(0x132)]===_0x1eb226(0x178)));if(!_0x49d280){_0x31586f['log']['debug']('ðŸ”\x20Device-Search\x20failed\x20for\x20predicted\x20room\x20\x27'+_0x3fb98b+'\x27.');return;}const _0x4f0789=await aiAgent[_0x1eb226(0x155)](_0x31586f,_0x3fb98b,_0x49d280[_0x1eb226(0x163)],_0x2a11fb);if(!_0x4f0789[_0x1eb226(0x14e)])return;const _0x5b8d65=_0x1eb226(0x133)+_0x3fb98b+_0x1eb226(0x135)+_0x49d280[_0x1eb226(0x163)]+'\x20('+_0x4f0789[_0x1eb226(0x17f)]+')';await _0x31586f[_0x1eb226(0x12c)](_0x1eb226(0x143),{'val':'['+_0x190788[_0x1eb226(0x164)]()+']\x20'+_0x5b8d65,'ack':!![]});if(_0x190788===_0x1eb226(0x162)){const _0x2c8c9a=await _0x31586f[_0x1eb226(0x152)](_0x49d280['id']);(!_0x2c8c9a||!_0x2c8c9a[_0x1eb226(0x16a)]&&_0x2c8c9a[_0x1eb226(0x16a)]!==!![])&&await _0x31586f['setForeignStateAsync'](_0x49d280['id'],!![]),lastActions[_0x3fb98b]=_0x4d150f;}}function a1_0x1f4d(){const _0x2a56b8=['trim','mpc_','light','ðŸƒ\x20MPC\x20Autonomy:\x20Senke\x20','room','soll','(((.+)+)+)+$','getForeignObjectsAsync','location','switch','setpoint','143oekspe','actual','Unbekannt','localeCompare','1530GGmrQY','reason','toLowerCase','apply','length','Unknown','warn','messwert','number','target_temperature','parse','push','toString','replace',')\x20auf\x20','getForeignObjectAsync','level.temperature','search','[MPC]\x20','ACTUAL','thermostat.setpoint','ACTUAL_TEMPERATURE','entries','hm-rpc','find','filter','setStateAsync','Auto-Erkennung','role','now','.1.TEMPERATURE','join','type','PrÃ¤diktion:\x20','temp','\x20->\x20Schalte\x20','split','\x20min)','includes','16952MFUNfE','sort','SET_POINT_TEMPERATURE','score',':\x20-1Â°C\x20(Sparpotenzial\x20genutzt)','getStateAsync','thermostatMapping','exports','map','Manuelles\x20Mapping','analysis.automation.lastAction','thermostat','openknx','log','forEach','config','set','temperature','ist','Nicht\x20gefunden','1688392uzvMLy','approved','Ist','Error\x20in\x20sibling\x20search:\x20','string','getForeignStateAsync','SET','analysis.automation.confidenceThreshold','consultButler','target','info','5186305kWJfDc','5657295Kyrmkr','306jTONxh','.1.ACTUAL_TEMPERATURE','minutes_safe','6WufoPx','off','write','current_heating_setpoint','common','active','name','toUpperCase','3274fswhIm','local_temperature','1314630Hxdxsi','sensor','wert','val','2495140pTwUnA','devices','.1.SET_POINT_TEMPERATURE','./ai_agent'];a1_0x1f4d=function(){return _0x2a56b8;};return a1_0x1f4d();}async function findSetpointId(_0x4b4f9d,_0x40e1cd){const _0x5ef1be=a1_0x5a627b;if(_0x4b4f9d[_0x5ef1be(0x148)][_0x5ef1be(0x13f)]){let _0x226108=_0x4b4f9d[_0x5ef1be(0x148)][_0x5ef1be(0x13f)];if(typeof _0x226108===_0x5ef1be(0x151))try{_0x226108=JSON[_0x5ef1be(0x188)](_0x226108);}catch(_0x11956d){_0x226108={};}if(_0x226108&&_0x226108[_0x40e1cd])return _0x226108[_0x40e1cd];}const _0x39e87a=[{'s':_0x5ef1be(0x15b),'t':_0x5ef1be(0x16d)},{'s':_0x5ef1be(0x130),'t':'.4.SET_TEMPERATURE'},{'s':_0x5ef1be(0x127),'t':_0x5ef1be(0x13b)},{'s':_0x5ef1be(0x166),'t':'occupied_heating_setpoint'},{'s':_0x5ef1be(0x166),'t':_0x5ef1be(0x160)},{'s':_0x5ef1be(0x14a),'t':_0x5ef1be(0x187)},{'s':_0x5ef1be(0x125),'t':_0x5ef1be(0x153)},{'s':_0x5ef1be(0x14f),'t':'Soll'},{'s':_0x5ef1be(0x14a),'t':_0x5ef1be(0x179)}];for(const _0x39f46c of _0x39e87a){if(_0x40e1cd[_0x5ef1be(0x138)](_0x39f46c['s'])){const _0x323b91=_0x40e1cd[_0x5ef1be(0x18b)](_0x39f46c['s'],_0x39f46c['t']),_0x1f28db=await _0x4b4f9d[_0x5ef1be(0x121)](_0x323b91);if(_0x1f28db)return _0x323b91;}}try{const _0x45678c=_0x40e1cd['split']('.');if(_0x45678c[_0x5ef1be(0x182)]>0x2){const _0x425861=_0x45678c['slice'](0x0,-0x1)[_0x5ef1be(0x131)]('.'),_0x5716e3=await _0x4b4f9d[_0x5ef1be(0x176)](_0x425861+'.*'),_0x3d2f64=[],_0x49510c=_0x40e1cd[_0x5ef1be(0x136)](/[._]+/)[_0x5ef1be(0x12b)](_0xe13788=>![_0x5ef1be(0x145),'0',_0x5ef1be(0x129),_0x5ef1be(0x14b),_0x5ef1be(0x169),_0x5ef1be(0x14a),_0x5ef1be(0x17b),'sensor',_0x5ef1be(0x185),'state'][_0x5ef1be(0x138)](_0xe13788['toLowerCase']()));for(const [_0x2219fd,_0x4e8be9]of Object[_0x5ef1be(0x128)](_0x5716e3)){if(_0x2219fd===_0x40e1cd)continue;if(_0x4e8be9&&_0x4e8be9[_0x5ef1be(0x161)]&&_0x4e8be9[_0x5ef1be(0x161)][_0x5ef1be(0x15f)]===!![]){const _0x6cb536=_0x2219fd['toLowerCase'](),_0x4d237d=(_0x4e8be9['common'][_0x5ef1be(0x12e)]||'')['toLowerCase'](),_0x226198=_0x6cb536[_0x5ef1be(0x138)](_0x5ef1be(0x149))||_0x6cb536[_0x5ef1be(0x138)](_0x5ef1be(0x174))||_0x6cb536[_0x5ef1be(0x138)](_0x5ef1be(0x156))||_0x4d237d[_0x5ef1be(0x138)](_0x5ef1be(0x122))||_0x4d237d[_0x5ef1be(0x138)](_0x5ef1be(0x126));if(_0x226198){const _0x29bd71=_0x2219fd[_0x5ef1be(0x136)](/[._]+/)[_0x5ef1be(0x141)](_0x2df577=>_0x2df577[_0x5ef1be(0x180)]());let _0x2bee11=0x0;_0x49510c[_0x5ef1be(0x147)](_0x4afe6e=>{const _0x2d5f11=_0x5ef1be;if(_0x29bd71[_0x2d5f11(0x138)](_0x4afe6e[_0x2d5f11(0x180)]()))_0x2bee11++;}),_0x3d2f64[_0x5ef1be(0x189)]({'id':_0x2219fd,'score':_0x2bee11});}}}if(_0x3d2f64[_0x5ef1be(0x182)]>0x0){_0x3d2f64[_0x5ef1be(0x13a)]((_0x32ee74,_0x598d37)=>_0x598d37['score']-_0x32ee74[_0x5ef1be(0x13c)]);const _0x4d2776=_0x3d2f64[0x0];if(_0x4d2776[_0x5ef1be(0x13c)]>0x0)return _0x4d2776['id'];}}}catch(_0x502951){_0x4b4f9d['log'][_0x5ef1be(0x184)](_0x5ef1be(0x150)+_0x502951['message']);}return null;}async function scanThermostats(_0x39e5fa){const _0x5e4062=a1_0x5a627b,_0x4ca069=_0x39e5fa[_0x5e4062(0x148)]['devices']||[],_0x59f3c7=[],_0x362e36=_0x4ca069[_0x5e4062(0x12b)](_0x22353a=>_0x22353a['id']&&_0x22353a['id'][_0x5e4062(0x138)]('temperature')||_0x22353a['type']&&['temperature',_0x5e4062(0x144),_0x5e4062(0x168)]['includes'](_0x22353a['type'])||_0x22353a['name']&&_0x22353a[_0x5e4062(0x163)]['toLowerCase']()[_0x5e4062(0x138)](_0x5e4062(0x134)));for(const _0x20490d of _0x362e36){const _0x17e907=await findSetpointId(_0x39e5fa,_0x20490d['id']);let _0x8e5323=_0x5e4062(0x14c),_0x2dcdcf=![],_0x14a560=_0x39e5fa[_0x5e4062(0x148)]['thermostatMapping']||{};if(typeof _0x14a560==='string')try{_0x14a560=JSON['parse'](_0x14a560);}catch(_0x110013){}if(_0x14a560[_0x20490d['id']]&&_0x14a560[_0x20490d['id']]===_0x17e907)_0x8e5323=_0x5e4062(0x142),_0x2dcdcf=!![];else _0x17e907&&(_0x8e5323=_0x5e4062(0x12d));_0x59f3c7[_0x5e4062(0x189)]({'room':_0x20490d[_0x5e4062(0x177)]||_0x5e4062(0x17c),'sensorId':_0x20490d['id'],'setpointId':_0x17e907||'-','source':_0x8e5323,'isManual':_0x2dcdcf,'status':_0x17e907?'OK':'Fehlt'});}return _0x59f3c7[_0x5e4062(0x13a)]((_0x17b3dd,_0x5ca147)=>_0x17b3dd[_0x5e4062(0x173)][_0x5e4062(0x17d)](_0x5ca147[_0x5e4062(0x173)]));}async function applyEnergySavings(_0x47a81b,_0x5b53e3){const _0x5b676a=a1_0x5a627b,_0x162048=_0x47a81b[_0x5b676a(0x148)][_0x5b676a(0x16c)]||[];for(const _0x41167d of _0x5b53e3){const _0x780b55=_0x41167d['room'],_0x3cc18d=_0x41167d[_0x5b676a(0x15c)],_0x331939=Date['now']();if(lastActions['mpc_'+_0x780b55]&&_0x331939-lastActions[_0x5b676a(0x170)+_0x780b55]<0x1e*0x3c*0x3e8)continue;const _0x5ea1e4=_0x162048[_0x5b676a(0x12a)](_0x3b378b=>normalize(_0x3b378b['location'])===normalize(_0x780b55));if(!_0x5ea1e4)continue;const _0x527b1a=await findSetpointId(_0x47a81b,_0x5ea1e4['id']);if(_0x527b1a){const _0x192bc9=await _0x47a81b[_0x5b676a(0x152)](_0x527b1a);if(_0x192bc9&&typeof _0x192bc9[_0x5b676a(0x16a)]===_0x5b676a(0x186)){const _0x144c0e=_0x192bc9['val'];if(_0x3cc18d>0x1e&&_0x144c0e>0x11){const _0x13833a=_0x144c0e-0x1;_0x47a81b[_0x5b676a(0x146)][_0x5b676a(0x157)](_0x5b676a(0x172)+_0x780b55+'\x20('+_0x527b1a+_0x5b676a(0x18c)+_0x13833a+'Â°C\x20(Coasting\x20mÃ¶glich:\x20'+_0x3cc18d+_0x5b676a(0x137)),await _0x47a81b['setForeignStateAsync'](_0x527b1a,_0x13833a),lastActions[_0x5b676a(0x170)+_0x780b55]=_0x331939,await _0x47a81b[_0x5b676a(0x12c)](_0x5b676a(0x143),{'val':_0x5b676a(0x124)+_0x780b55+_0x5b676a(0x13d),'ack':!![]});}}}}}module[a1_0x5a627b(0x140)]={'handlePrediction':handlePrediction,'applyEnergySavings':applyEnergySavings,'scanThermostats':scanThermostats};