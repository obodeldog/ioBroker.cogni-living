const a1_0x301f07=a1_0x3276;(function(_0x345012,_0x5edcf1){const _0x2de66c=a1_0x3276,_0x4fe697=_0x345012();while(!![]){try{const _0x4d5665=parseInt(_0x2de66c(0x139))/0x1+-parseInt(_0x2de66c(0x152))/0x2+parseInt(_0x2de66c(0x136))/0x3+-parseInt(_0x2de66c(0x118))/0x4*(-parseInt(_0x2de66c(0x111))/0x5)+-parseInt(_0x2de66c(0x107))/0x6*(-parseInt(_0x2de66c(0x14d))/0x7)+-parseInt(_0x2de66c(0x114))/0x8+parseInt(_0x2de66c(0x116))/0x9*(-parseInt(_0x2de66c(0x10c))/0xa);if(_0x4d5665===_0x5edcf1)break;else _0x4fe697['push'](_0x4fe697['shift']());}catch(_0x31ed94){_0x4fe697['push'](_0x4fe697['shift']());}}}(a1_0x5e04,0x444b9));const a1_0x400db0=(function(){let _0xf4bd53=!![];return function(_0x1d2194,_0x183fdf){const _0x2cefbb=_0xf4bd53?function(){const _0x4f8a48=a1_0x3276;if(_0x183fdf){const _0x51dead=_0x183fdf[_0x4f8a48(0x157)](_0x1d2194,arguments);return _0x183fdf=null,_0x51dead;}}:function(){};return _0xf4bd53=![],_0x2cefbb;};}()),a1_0x434f79=a1_0x400db0(this,function(){const _0x45ad42=a1_0x3276;return a1_0x434f79[_0x45ad42(0x13c)]()[_0x45ad42(0x14e)](_0x45ad42(0x11b))[_0x45ad42(0x13c)]()[_0x45ad42(0x10f)](a1_0x434f79)[_0x45ad42(0x14e)]('(((.+)+)+)+$');});a1_0x434f79();'use strict';function a1_0x3276(_0x12a985,_0x13b59d){const _0x21e9f2=a1_0x5e04();return a1_0x3276=function(_0x434f79,_0x400db0){_0x434f79=_0x434f79-0x106;let _0x5e04ea=_0x21e9f2[_0x434f79];return _0x5e04ea;},a1_0x3276(_0x12a985,_0x13b59d);}const aiAgent=require(a1_0x301f07(0x129)),COOLDOWN_MS=0x3c*0x3e8,lastActions={};function a1_0x5e04(){const _0x39919f=['ACTUAL','toString','thermostat','.4.SET_TEMPERATURE','includes','trim','setForeignStateAsync','devices','localeCompare','room','getStateAsync','target_temperature','reason','name','location','setpoint','Auto-Erkennung','¬∞C\x20(Coasting\x20m√∂glich:\x20','82117pPpEns','search','thermostatMapping','config','replace','472098bgWJEZ','common','temperature','analysis.automation.lastAction',':\x20-1¬∞C\x20(Sparpotenzial\x20genutzt)','apply','string','analysis.automation.mode','entries','off','getForeignStateAsync','96vzyJZk','find','consultButler','toUpperCase','\x20min)','711810SDIfmE','type','Nicht\x20gefunden','constructor','SET_POINT_TEMPERATURE','5itEovU','SET','ACTUAL_TEMPERATURE','3372064DHPKat','slice','36JAMBPx','Fehlt','1415668JCRVZK','.1.SET_POINT_TEMPERATURE','log','(((.+)+)+)+$','exports','filter','Unknown','Soll','local_temperature','role','toLowerCase','light','temp','level.temperature',')\x20auf\x20','set','push','./ai_agent','sort','[MPC]\x20','info','current_heating_setpoint','getForeignObjectAsync','mpc_','Pr√§diktion:\x20','üçÉ\x20MPC\x20Autonomy:\x20Senke\x20','sensor','Unbekannt','now','parse','1461882utGUQf','occupied_heating_setpoint','length','193111lAxCHM','val'];a1_0x5e04=function(){return _0x39919f;};return a1_0x5e04();}function normalize(_0x3bbb77){const _0x3f3b10=a1_0x301f07;if(!_0x3bbb77)return'';return _0x3bbb77[_0x3f3b10(0x122)]()[_0x3f3b10(0x151)](/\s+/g,'')[_0x3f3b10(0x140)]();}async function handlePrediction(_0x4b6a2a,_0x59688b,_0x59ec6b){const _0x4863c7=a1_0x301f07;if(!_0x59688b||_0x59688b===_0x4863c7(0x11e))return;let _0x4e46f0=_0x4863c7(0x15b),_0x16d6b1=0.6;try{const _0x520ac2=await _0x4b6a2a[_0x4863c7(0x145)](_0x4863c7(0x159));if(_0x520ac2&&_0x520ac2[_0x4863c7(0x13a)])_0x4e46f0=_0x520ac2['val'];const _0x51be1c=await _0x4b6a2a[_0x4863c7(0x145)]('analysis.automation.confidenceThreshold');if(_0x51be1c&&_0x51be1c[_0x4863c7(0x13a)])_0x16d6b1=_0x51be1c[_0x4863c7(0x13a)];}catch(_0x192dc7){}if(_0x4e46f0===_0x4863c7(0x15b)||_0x59ec6b<_0x16d6b1)return;const _0xba66ff=Date[_0x4863c7(0x134)]();if(lastActions[_0x59688b]&&_0xba66ff-lastActions[_0x59688b]<COOLDOWN_MS)return;const _0x113abe=_0x4b6a2a[_0x4863c7(0x150)][_0x4863c7(0x142)]||[],_0x5ddb1e=normalize(_0x59688b),_0x176dcb=_0x113abe[_0x4863c7(0x108)](_0xf03408=>normalize(_0xf03408[_0x4863c7(0x149)])===_0x5ddb1e&&(_0xf03408[_0x4863c7(0x10d)]===_0x4863c7(0x123)||_0xf03408[_0x4863c7(0x10d)]==='dimmer'||_0xf03408[_0x4863c7(0x10d)]==='switch'));if(!_0x176dcb){_0x4b6a2a[_0x4863c7(0x11a)]['debug']('üîç\x20Device-Search\x20failed\x20for\x20predicted\x20room\x20\x27'+_0x59688b+'\x27.');return;}const _0x4db5a4=await aiAgent[_0x4863c7(0x109)](_0x4b6a2a,_0x59688b,_0x176dcb[_0x4863c7(0x148)],_0x59ec6b);if(!_0x4db5a4['approved'])return;const _0x31ab9f=_0x4863c7(0x130)+_0x59688b+'\x20->\x20Schalte\x20'+_0x176dcb[_0x4863c7(0x148)]+'\x20('+_0x4db5a4[_0x4863c7(0x147)]+')';await _0x4b6a2a['setStateAsync'](_0x4863c7(0x155),{'val':'['+_0x4e46f0[_0x4863c7(0x10a)]()+']\x20'+_0x31ab9f,'ack':!![]});if(_0x4e46f0==='active'){const _0x30c745=await _0x4b6a2a[_0x4863c7(0x106)](_0x176dcb['id']);(!_0x30c745||!_0x30c745[_0x4863c7(0x13a)]&&_0x30c745[_0x4863c7(0x13a)]!==!![])&&await _0x4b6a2a[_0x4863c7(0x141)](_0x176dcb['id'],!![]),lastActions[_0x59688b]=_0xba66ff;}}async function findSetpointId(_0x43d865,_0x294a00){const _0x5624c9=a1_0x301f07;if(_0x43d865[_0x5624c9(0x150)][_0x5624c9(0x14f)]){let _0x17fd01=_0x43d865[_0x5624c9(0x150)][_0x5624c9(0x14f)];if(typeof _0x17fd01===_0x5624c9(0x158))try{_0x17fd01=JSON[_0x5624c9(0x135)](_0x17fd01);}catch(_0x32d7db){_0x17fd01={};}if(_0x17fd01&&_0x17fd01[_0x294a00])return _0x17fd01[_0x294a00];}const _0xf74eab=[{'s':'.1.ACTUAL_TEMPERATURE','t':_0x5624c9(0x119)},{'s':'.1.TEMPERATURE','t':_0x5624c9(0x13e)},{'s':_0x5624c9(0x113),'t':_0x5624c9(0x110)},{'s':_0x5624c9(0x120),'t':_0x5624c9(0x137)},{'s':'local_temperature','t':_0x5624c9(0x12d)},{'s':_0x5624c9(0x154),'t':_0x5624c9(0x146)},{'s':_0x5624c9(0x13b),'t':_0x5624c9(0x112)},{'s':'Ist','t':_0x5624c9(0x11f)},{'s':_0x5624c9(0x154),'t':_0x5624c9(0x14a)}];for(const _0x1e0b81 of _0xf74eab){if(_0x294a00['includes'](_0x1e0b81['s'])){const _0x52702c=_0x294a00[_0x5624c9(0x151)](_0x1e0b81['s'],_0x1e0b81['t']),_0x16c674=await _0x43d865[_0x5624c9(0x12e)](_0x52702c);if(_0x16c674)return _0x52702c;}}try{const _0x272a6b=_0x294a00['split']('.');if(_0x272a6b[_0x5624c9(0x138)]>0x2){const _0x32d792=_0x272a6b[_0x5624c9(0x115)](0x0,-0x1)['join']('.'),_0x45f9dd=await _0x43d865['getForeignObjectsAsync'](_0x32d792+'.*');for(const [_0x281a39,_0x49568c]of Object[_0x5624c9(0x15a)](_0x45f9dd)){if(_0x281a39===_0x294a00)continue;if(_0x49568c&&_0x49568c[_0x5624c9(0x153)]&&_0x49568c['common']['write']===!![]){const _0x488bed=_0x281a39[_0x5624c9(0x122)](),_0x273f5a=(_0x49568c['common'][_0x5624c9(0x121)]||'')[_0x5624c9(0x122)]();if(_0x488bed[_0x5624c9(0x13f)](_0x5624c9(0x127))||_0x488bed[_0x5624c9(0x13f)]('soll')||_0x488bed['includes']('target')||_0x273f5a[_0x5624c9(0x13f)](_0x5624c9(0x125))||_0x273f5a[_0x5624c9(0x13f)]('thermostat'))return _0x281a39;}}}}catch(_0x272bed){}return null;}async function scanThermostats(_0x24d210){const _0x3bd024=a1_0x301f07,_0x43e8c9=_0x24d210[_0x3bd024(0x150)]['devices']||[],_0x33d1b6=[],_0x26bb01=_0x43e8c9[_0x3bd024(0x11d)](_0x2ad34c=>_0x2ad34c['id']&&_0x2ad34c['id'][_0x3bd024(0x13f)](_0x3bd024(0x154))||_0x2ad34c[_0x3bd024(0x10d)]&&[_0x3bd024(0x154),_0x3bd024(0x13d),_0x3bd024(0x132)][_0x3bd024(0x13f)](_0x2ad34c[_0x3bd024(0x10d)])||_0x2ad34c[_0x3bd024(0x148)]&&_0x2ad34c[_0x3bd024(0x148)][_0x3bd024(0x122)]()[_0x3bd024(0x13f)](_0x3bd024(0x124)));for(const _0x348a73 of _0x26bb01){const _0x2776e0=await findSetpointId(_0x24d210,_0x348a73['id']);let _0x4eff7a=_0x3bd024(0x10e),_0x2273e0=![],_0x3db900=_0x24d210['config'][_0x3bd024(0x14f)]||{};if(typeof _0x3db900===_0x3bd024(0x158))try{_0x3db900=JSON['parse'](_0x3db900);}catch(_0x1ec9a6){}if(_0x3db900[_0x348a73['id']]&&_0x3db900[_0x348a73['id']]===_0x2776e0)_0x4eff7a='Manuelles\x20Mapping',_0x2273e0=!![];else _0x2776e0&&(_0x4eff7a=_0x3bd024(0x14b));_0x33d1b6[_0x3bd024(0x128)]({'room':_0x348a73[_0x3bd024(0x149)]||_0x3bd024(0x133),'sensorId':_0x348a73['id'],'setpointId':_0x2776e0||'-','source':_0x4eff7a,'isManual':_0x2273e0,'status':_0x2776e0?'OK':_0x3bd024(0x117)});}return _0x33d1b6[_0x3bd024(0x12a)]((_0x2668eb,_0xa8908c)=>_0x2668eb[_0x3bd024(0x144)][_0x3bd024(0x143)](_0xa8908c[_0x3bd024(0x144)]));}async function applyEnergySavings(_0x495938,_0x55a52c){const _0x4b2e0a=a1_0x301f07,_0x5eae08=_0x495938['config'][_0x4b2e0a(0x142)]||[];for(const _0x4165f3 of _0x55a52c){const _0x33214e=_0x4165f3['room'],_0x2f5d86=_0x4165f3['minutes_safe'],_0xe28cb7=Date[_0x4b2e0a(0x134)]();if(lastActions[_0x4b2e0a(0x12f)+_0x33214e]&&_0xe28cb7-lastActions[_0x4b2e0a(0x12f)+_0x33214e]<0x1e*0x3c*0x3e8)continue;const _0x3e1fd6=_0x5eae08[_0x4b2e0a(0x108)](_0x1ab9a2=>normalize(_0x1ab9a2['location'])===normalize(_0x33214e));if(!_0x3e1fd6)continue;const _0x29ae0c=await findSetpointId(_0x495938,_0x3e1fd6['id']);if(_0x29ae0c){const _0x136972=await _0x495938[_0x4b2e0a(0x106)](_0x29ae0c);if(_0x136972&&typeof _0x136972[_0x4b2e0a(0x13a)]==='number'){const _0x5538e6=_0x136972[_0x4b2e0a(0x13a)];if(_0x2f5d86>0x1e&&_0x5538e6>0x11){const _0x2a3f1d=_0x5538e6-0x1;_0x495938[_0x4b2e0a(0x11a)][_0x4b2e0a(0x12c)](_0x4b2e0a(0x131)+_0x33214e+'\x20('+_0x29ae0c+_0x4b2e0a(0x126)+_0x2a3f1d+_0x4b2e0a(0x14c)+_0x2f5d86+_0x4b2e0a(0x10b)),await _0x495938[_0x4b2e0a(0x141)](_0x29ae0c,_0x2a3f1d),lastActions['mpc_'+_0x33214e]=_0xe28cb7,await _0x495938['setStateAsync'](_0x4b2e0a(0x155),{'val':_0x4b2e0a(0x12b)+_0x33214e+_0x4b2e0a(0x156),'ack':!![]});}}}}}module[a1_0x301f07(0x11c)]={'handlePrediction':handlePrediction,'applyEnergySavings':applyEnergySavings,'scanThermostats':scanThermostats};