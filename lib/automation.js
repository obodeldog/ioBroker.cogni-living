const a1_0x225553=a1_0x230e;(function(_0x5cec78,_0x1f182e){const _0x16a4f2=a1_0x230e,_0x3f9ddb=_0x5cec78();while(!![]){try{const _0x21d1f8=-parseInt(_0x16a4f2(0x15c))/0x1+-parseInt(_0x16a4f2(0x154))/0x2*(-parseInt(_0x16a4f2(0x151))/0x3)+parseInt(_0x16a4f2(0x109))/0x4+-parseInt(_0x16a4f2(0x13b))/0x5*(-parseInt(_0x16a4f2(0x104))/0x6)+parseInt(_0x16a4f2(0x14c))/0x7+parseInt(_0x16a4f2(0x17e))/0x8*(-parseInt(_0x16a4f2(0x11d))/0x9)+parseInt(_0x16a4f2(0x15a))/0xa*(-parseInt(_0x16a4f2(0x14b))/0xb);if(_0x21d1f8===_0x1f182e)break;else _0x3f9ddb['push'](_0x3f9ddb['shift']());}catch(_0x2e8dbf){_0x3f9ddb['push'](_0x3f9ddb['shift']());}}}(a1_0x4eb3,0xe12f4));const a1_0x60f242=(function(){let _0x514e6f=!![];return function(_0x5bc5f7,_0x1fdb16){const _0x2066a8=_0x514e6f?function(){const _0x4ed2fb=a1_0x230e;if(_0x1fdb16){const _0x35a72b=_0x1fdb16[_0x4ed2fb(0xf3)](_0x5bc5f7,arguments);return _0x1fdb16=null,_0x35a72b;}}:function(){};return _0x514e6f=![],_0x2066a8;};}()),a1_0x293702=a1_0x60f242(this,function(){const _0x40b1f7=a1_0x230e;return a1_0x293702[_0x40b1f7(0x11a)]()[_0x40b1f7(0x13f)]('(((.+)+)+)+$')[_0x40b1f7(0x11a)]()[_0x40b1f7(0x118)](a1_0x293702)[_0x40b1f7(0x13f)](_0x40b1f7(0x141));});a1_0x293702();'use strict';const aiAgent=require(a1_0x225553(0x164)),COOLDOWN_MS=0x3c*0x3e8,CAL_COOLDOWN_MS=0x5a*0x3c*0x3e8,ECO_TEMP=0x11,lastActions={};function a1_0x230e(_0x1f0223,_0x4dba48){const _0x5ed4f4=a1_0x4eb3();return a1_0x230e=function(_0x293702,_0x60f242){_0x293702=_0x293702-0xea;let _0x4eb3cb=_0x5ed4f4[_0x293702];return _0x4eb3cb;},a1_0x230e(_0x1f0223,_0x4dba48);}function normalize(_0x4519a2){const _0x5ed1b1=a1_0x225553;if(!_0x4519a2)return'';return _0x4519a2[_0x5ed1b1(0x123)]()['replace'](/\s+/g,'')['trim']();}async function logAutomationAction(_0x53186d,_0xd7d116){const _0x357d0d=a1_0x225553;await _0x53186d[_0x357d0d(0x138)](_0x357d0d(0xf1),{'val':_0xd7d116,'ack':!![]});try{const _0x537df1=_0x357d0d(0x111),_0x251df7=await _0x53186d[_0x357d0d(0x101)](_0x537df1);let _0x32441d=[];if(_0x251df7&&_0x251df7[_0x357d0d(0x174)])try{_0x32441d=JSON[_0x357d0d(0x116)](_0x251df7[_0x357d0d(0x174)]);}catch(_0x242086){}_0x32441d['unshift']({'ts':Date[_0x357d0d(0x117)](),'msg':_0xd7d116});if(_0x32441d[_0x357d0d(0x100)]>0x32)_0x32441d=_0x32441d[_0x357d0d(0x133)](0x0,0x32);await _0x53186d[_0x357d0d(0x138)](_0x537df1,{'val':JSON[_0x357d0d(0x135)](_0x32441d),'ack':!![]});}catch(_0x4811ca){}}async function handlePrediction(_0x2ce67f,_0x18bcf5,_0x495178){const _0x35d2ae=a1_0x225553;if(!_0x18bcf5||_0x18bcf5===_0x35d2ae(0x13e))return;let _0x2224fa=_0x35d2ae(0x144),_0x25ff64=0.6;try{const _0x3c210f=await _0x2ce67f[_0x35d2ae(0x101)](_0x35d2ae(0x176));if(_0x3c210f&&_0x3c210f[_0x35d2ae(0x174)])_0x2224fa=_0x3c210f['val'];const _0x9469fc=await _0x2ce67f[_0x35d2ae(0x101)](_0x35d2ae(0x163));if(_0x9469fc&&_0x9469fc[_0x35d2ae(0x174)])_0x25ff64=_0x9469fc['val'];}catch(_0x1ac680){}if(_0x2224fa==='off'||_0x495178<_0x25ff64)return;const _0x20e68f=Date[_0x35d2ae(0x117)]();if(lastActions[_0x18bcf5]&&_0x20e68f-lastActions[_0x18bcf5]<COOLDOWN_MS)return;const _0x5c4cc2=_0x2ce67f[_0x35d2ae(0x160)][_0x35d2ae(0x130)]||[],_0x59ab28=normalize(_0x18bcf5),_0x1f8a52=_0x5c4cc2[_0x35d2ae(0x16e)](_0x572ac3=>normalize(_0x572ac3[_0x35d2ae(0x142)])===_0x59ab28&&(_0x572ac3[_0x35d2ae(0x10f)]===_0x35d2ae(0x147)||_0x572ac3[_0x35d2ae(0x10f)]==='dimmer'||_0x572ac3[_0x35d2ae(0x10f)]===_0x35d2ae(0x13c)));if(!_0x1f8a52)return;const _0x560f15=await aiAgent['consultButler'](_0x2ce67f,_0x18bcf5,_0x1f8a52[_0x35d2ae(0xee)],_0x495178);if(!_0x560f15[_0x35d2ae(0x119)])return;const _0x2c9f0c='Pr√§diktion:\x20'+_0x18bcf5+_0x35d2ae(0x131)+_0x1f8a52[_0x35d2ae(0xee)]+'\x20('+_0x560f15[_0x35d2ae(0xf9)]+')';await logAutomationAction(_0x2ce67f,'['+_0x2224fa['toUpperCase']()+']\x20'+_0x2c9f0c);if(_0x2224fa===_0x35d2ae(0x15b)){const _0x55e6cf=await _0x2ce67f[_0x35d2ae(0x168)](_0x1f8a52['id']);(!_0x55e6cf||!_0x55e6cf[_0x35d2ae(0x174)]&&_0x55e6cf['val']!==!![])&&await _0x2ce67f[_0x35d2ae(0x17d)](_0x1f8a52['id'],!![]),lastActions[_0x18bcf5]=_0x20e68f;}}async function findRelatedId(_0x3580b0,_0x2c37c8,_0x34b9ae=a1_0x225553(0x171)){const _0x4d022e=a1_0x225553;if(_0x34b9ae===_0x4d022e(0x171)&&_0x3580b0[_0x4d022e(0x160)][_0x4d022e(0x185)]){let _0x476918=_0x3580b0['config'][_0x4d022e(0x185)];if(typeof _0x476918===_0x4d022e(0xf8))try{_0x476918=JSON['parse'](_0x476918);}catch(_0x2b1462){}if(_0x476918&&_0x476918[_0x2c37c8])return _0x476918[_0x2c37c8];}if(_0x34b9ae===_0x4d022e(0x162)&&_0x3580b0[_0x4d022e(0x160)][_0x4d022e(0xf7)]){let _0x47b9ac=_0x3580b0[_0x4d022e(0x160)][_0x4d022e(0xf7)];if(typeof _0x47b9ac===_0x4d022e(0xf8))try{_0x47b9ac=JSON['parse'](_0x47b9ac);}catch(_0x1ad276){}if(_0x47b9ac&&_0x47b9ac[_0x2c37c8])return _0x47b9ac[_0x2c37c8];}let _0x289183=[];if(_0x34b9ae===_0x4d022e(0x171))_0x289183=[{'s':_0x4d022e(0xf2),'t':'.1.SET_POINT_TEMPERATURE'},{'s':_0x4d022e(0x125),'t':'.1.SET_POINT_TEMPERATURE'},{'s':_0x4d022e(0x125),'t':'.4.SET_TEMPERATURE'},{'s':_0x4d022e(0x184),'t':_0x4d022e(0x12c)},{'s':_0x4d022e(0x13a),'t':_0x4d022e(0xff)},{'s':'local_temperature','t':_0x4d022e(0x143)},{'s':_0x4d022e(0x166),'t':_0x4d022e(0xfb)},{'s':_0x4d022e(0x158),'t':_0x4d022e(0x179)},{'s':'Ist','t':_0x4d022e(0x181)},{'s':_0x4d022e(0x166),'t':_0x4d022e(0x171)}];else _0x34b9ae===_0x4d022e(0x162)&&(_0x289183=[{'s':_0x4d022e(0xf2),'t':'.1.LEVEL'},{'s':'.1.TEMPERATURE','t':_0x4d022e(0x16a)},{'s':_0x4d022e(0x125),'t':_0x4d022e(0xf4)},{'s':_0x4d022e(0x13a),'t':_0x4d022e(0x12f)},{'s':_0x4d022e(0x166),'t':_0x4d022e(0x110)},{'s':_0x4d022e(0x166),'t':'level'}]);for(const _0x58c9ff of _0x289183){if(_0x2c37c8[_0x4d022e(0x15f)](_0x58c9ff['s'])){const _0x38e995=_0x2c37c8[_0x4d022e(0xeb)](_0x58c9ff['s'],_0x58c9ff['t']),_0x4cb820=await _0x3580b0[_0x4d022e(0xf5)](_0x38e995);if(_0x4cb820)return _0x38e995;}}try{const _0x5bd1ea=_0x2c37c8[_0x4d022e(0x137)]('.');if(_0x5bd1ea[_0x4d022e(0x100)]>0x2){const _0x123500=_0x5bd1ea['slice'](0x0,-0x1)[_0x4d022e(0x167)]('.'),_0x4f53a0=await _0x3580b0[_0x4d022e(0x173)](_0x123500+'.*'),_0xf4ea23=[],_0x284215=_0x2c37c8[_0x4d022e(0x137)](/[._]+/)[_0x4d022e(0x139)](_0x42acd2=>![_0x4d022e(0x127),'0',_0x4d022e(0x11f),_0x4d022e(0x183),_0x4d022e(0x129),_0x4d022e(0x166),_0x4d022e(0x113),_0x4d022e(0x140),_0x4d022e(0x11b),'state'][_0x4d022e(0x15f)](_0x42acd2['toLowerCase']()));for(const [_0x498c96,_0x34bc3f]of Object[_0x4d022e(0x112)](_0x4f53a0)){if(_0x498c96===_0x2c37c8)continue;if(_0x34bc3f&&_0x34bc3f['common']){const _0x1d8a70=_0x498c96['toLowerCase'](),_0x147379=(_0x34bc3f['common'][_0x4d022e(0x159)]||'')['toLowerCase'](),_0x22c785=(_0x34bc3f['common']['unit']||'')[_0x4d022e(0x123)]();let _0x3ba38a=![];if(_0x34b9ae===_0x4d022e(0x171)&&_0x34bc3f['common'][_0x4d022e(0x134)]===!![])_0x3ba38a=_0x1d8a70[_0x4d022e(0x15f)](_0x4d022e(0x14f))||_0x1d8a70['includes'](_0x4d022e(0x12d))||_0x1d8a70[_0x4d022e(0x15f)]('target')||_0x147379[_0x4d022e(0x15f)](_0x4d022e(0x155))||_0x147379[_0x4d022e(0x15f)](_0x4d022e(0xf0));else _0x34b9ae==='valve'&&(_0x3ba38a=_0x1d8a70[_0x4d022e(0x15f)](_0x4d022e(0x132))||_0x1d8a70['includes']('valve')||_0x1d8a70['includes'](_0x4d022e(0x17b))||_0x1d8a70[_0x4d022e(0x15f)]('position')||_0x147379[_0x4d022e(0x15f)](_0x4d022e(0x150))||_0x147379[_0x4d022e(0x15f)]('value.valve')||_0x22c785[_0x4d022e(0x15f)]('%'));if(_0x3ba38a){const _0x2a4129=_0x498c96[_0x4d022e(0x137)](/[._]+/)['map'](_0x3ab634=>_0x3ab634[_0x4d022e(0x123)]());let _0x13c112=0x0;_0x284215[_0x4d022e(0x152)](_0x276636=>{const _0x341a54=_0x4d022e;if(_0x2a4129['includes'](_0x276636[_0x341a54(0x123)]()))_0x13c112++;}),_0xf4ea23[_0x4d022e(0x102)]({'id':_0x498c96,'score':_0x13c112});}}}if(_0xf4ea23[_0x4d022e(0x100)]>0x0){_0xf4ea23[_0x4d022e(0xfd)]((_0x577133,_0x37c756)=>_0x37c756[_0x4d022e(0x157)]-_0x577133[_0x4d022e(0x157)]);if(_0xf4ea23[0x0]['score']>0x0)return _0xf4ea23[0x0]['id'];}}}catch(_0x20cb9b){}return null;}async function scanThermostats(_0x1c4131){const _0x4f096d=a1_0x225553,_0x2ecc0a=_0x1c4131['config']['devices']||[],_0x411677=[],_0x5b6a55=_0x2ecc0a['filter'](_0xd50ca=>_0xd50ca['id']&&_0xd50ca['id'][_0x4f096d(0x15f)](_0x4f096d(0x166))||_0xd50ca[_0x4f096d(0x10f)]&&['temperature','thermostat',_0x4f096d(0x140)][_0x4f096d(0x15f)](_0xd50ca[_0x4f096d(0x10f)])||_0xd50ca[_0x4f096d(0xee)]&&_0xd50ca['name'][_0x4f096d(0x123)]()[_0x4f096d(0x15f)]('temp'));for(const _0x329f15 of _0x5b6a55){const _0x1bd039=await findRelatedId(_0x1c4131,_0x329f15['id'],_0x4f096d(0x171)),_0xf4c32=await findRelatedId(_0x1c4131,_0x329f15['id'],_0x4f096d(0x162));let _0x16b017=_0x4f096d(0x165),_0x109942=![],_0x1a7c4d=_0x1c4131[_0x4f096d(0x160)][_0x4f096d(0x185)]||{};if(typeof _0x1a7c4d===_0x4f096d(0xf8))try{_0x1a7c4d=JSON[_0x4f096d(0x116)](_0x1a7c4d);}catch(_0x397db7){}let _0x51e104=_0x1c4131[_0x4f096d(0x160)]['valveMapping']||{};if(typeof _0x51e104===_0x4f096d(0xf8))try{_0x51e104=JSON['parse'](_0x51e104);}catch(_0x5f4042){}if(_0x1a7c4d[_0x329f15['id']]&&_0x1a7c4d[_0x329f15['id']]===_0x1bd039||_0x51e104[_0x329f15['id']]&&_0x51e104[_0x329f15['id']]===_0xf4c32)_0x16b017='Manuelles\x20Mapping',_0x109942=!![];else(_0x1bd039||_0xf4c32)&&(_0x16b017='Auto-Erkennung');_0x411677[_0x4f096d(0x102)]({'room':_0x329f15[_0x4f096d(0x142)]||_0x4f096d(0x12a),'sensorId':_0x329f15['id'],'setpointId':_0x1bd039||'-','valveId':_0xf4c32||'-','source':_0x16b017,'isManual':_0x109942,'status':_0x1bd039&&_0xf4c32?_0x4f096d(0x10a):_0x1bd039?'OK':'Fehlt'});}return _0x411677[_0x4f096d(0xfd)]((_0x3d9eb1,_0x59c330)=>_0x3d9eb1['room'][_0x4f096d(0xec)](_0x59c330[_0x4f096d(0x10b)]));}async function updateSchedulePreview(_0xd581f7){const _0x51bd61=a1_0x225553;if(!_0xd581f7[_0x51bd61(0x160)][_0x51bd61(0x105)]||!_0xd581f7['config'][_0x51bd61(0x136)])return;let _0x700fe5={};try{const _0x166ac1=await _0xd581f7[_0x51bd61(0x101)](_0x51bd61(0x126));if(_0x166ac1&&_0x166ac1[_0x51bd61(0x174)])_0x700fe5=JSON[_0x51bd61(0x116)](_0x166ac1[_0x51bd61(0x174)]);}catch(_0x262955){}const _0x21dbf7=[],_0x3c353a=Date[_0x51bd61(0x117)](),_0x51a69a=0x30*0x3c*0x3c*0x3e8;try{const _0x2c0e74=await _0xd581f7['getForeignStateAsync'](_0xd581f7[_0x51bd61(0x160)][_0x51bd61(0x136)]+'.data.table');if(!_0x2c0e74||!_0x2c0e74['val'])return;const _0x27487d=JSON['parse'](_0x2c0e74[_0x51bd61(0x174)]),_0x5b8e15=_0xd581f7[_0x51bd61(0x160)][_0x51bd61(0x161)]||[],_0xf4e85b=_0xd581f7[_0x51bd61(0x160)][_0x51bd61(0x130)]||[],_0x591e35=new Set();_0xf4e85b['forEach'](_0x47240e=>{const _0x1c53de=_0x51bd61;if(_0x47240e[_0x1c53de(0x142)])_0x591e35[_0x1c53de(0xed)](_0x47240e[_0x1c53de(0x142)]);});for(const _0x578bf4 of _0x27487d){if(_0x578bf4[_0x51bd61(0x146)]&&_0x5b8e15[_0x51bd61(0x100)]>0x0&&!_0x5b8e15[_0x51bd61(0x15f)](_0x578bf4[_0x51bd61(0x146)]))continue;const _0x5d3e16=_0x578bf4[_0x51bd61(0x16b)]||_0x578bf4[_0x51bd61(0x169)]||_0x578bf4['date'];if(!_0x5d3e16)continue;const _0x35c42e=new Date(_0x5d3e16),_0x2be0f6=_0x35c42e['getTime']();if(isNaN(_0x2be0f6))continue;if(_0x2be0f6<_0x3c353a)continue;if(_0x2be0f6>_0x3c353a+_0x51a69a)continue;const _0x35859b=(_0x578bf4[_0x51bd61(0x114)]||_0x578bf4[_0x51bd61(0x12e)]||'')[_0x51bd61(0x123)]();let _0x34f8f8=![],_0x3e99ee=[],_0xcd40e4=_0x578bf4['event']||_0x578bf4[_0x51bd61(0x12e)]||_0x51bd61(0x12a);if(_0x35859b['includes'](_0x51bd61(0xf6))||_0x35859b[_0x51bd61(0x15f)](_0x51bd61(0xfe))||_0x35859b[_0x51bd61(0x15f)](_0x51bd61(0x12b)))_0x34f8f8=!![],_0x3e99ee=Array[_0x51bd61(0x170)](_0x591e35);else for(const _0x4ea433 of _0x591e35){if(_0x35859b[_0x51bd61(0x15f)](_0x4ea433['toLowerCase']()))_0x3e99ee[_0x51bd61(0x102)](_0x4ea433);}_0x3e99ee['length']>0x0&&_0x3e99ee[_0x51bd61(0x152)](_0x345143=>{const _0x4a5cfe=_0x51bd61;let _0x3dc8fc=0x3c;if(_0x34f8f8){let _0x32f882=0x0;Object[_0x4a5cfe(0x14e)](_0x700fe5)[_0x4a5cfe(0x152)](_0xf38820=>{if(_0xf38820>_0x32f882)_0x32f882=_0xf38820;}),_0x3dc8fc=_0x32f882>0x0?_0x32f882:0x78;}else _0x3dc8fc=_0x700fe5[_0x345143]||0x3c;const _0x3c31ce=new Date(_0x2be0f6-_0x3dc8fc*0xea60);_0x21dbf7[_0x4a5cfe(0x102)]({'eventTime':_0x2be0f6,'triggerTime':_0x3c31ce[_0x4a5cfe(0x156)](),'room':_0x345143,'minutes':_0x3dc8fc,'reason':_0xcd40e4,'isGlobal':_0x34f8f8});});}}catch(_0x2546b6){}_0x21dbf7[_0x51bd61(0xfd)]((_0x38d97b,_0x3bf1eb)=>_0x38d97b['triggerTime']-_0x3bf1eb['triggerTime']);const _0xc56396=_0x21dbf7[_0x51bd61(0x133)](0x0,0x5);await _0xd581f7[_0x51bd61(0x138)]('analysis.energy.schedulePreview',{'val':JSON[_0x51bd61(0x135)](_0xc56396),'ack':!![]});}async function checkCalendarTriggers(_0x16519e){const _0x1db9b8=a1_0x225553;if(!_0x16519e['config']['useCalendar']||!_0x16519e['config'][_0x1db9b8(0x136)])return;await updateSchedulePreview(_0x16519e);let _0x2a9d48={},_0x35fea5={};try{const _0x4dfeb2=await _0x16519e[_0x1db9b8(0x101)](_0x1db9b8(0x126));if(_0x4dfeb2&&_0x4dfeb2[_0x1db9b8(0x174)])_0x2a9d48=JSON[_0x1db9b8(0x116)](_0x4dfeb2[_0x1db9b8(0x174)]);const _0x5e0656=await _0x16519e[_0x1db9b8(0x101)](_0x1db9b8(0x17c));if(_0x5e0656&&_0x5e0656[_0x1db9b8(0x174)])_0x35fea5=JSON[_0x1db9b8(0x116)](_0x5e0656['val']);}catch(_0x4179a0){}let _0xead460={'default':0x15};try{const _0x3a6116=await _0x16519e[_0x1db9b8(0x101)](_0x1db9b8(0x16d));if(_0x3a6116&&_0x3a6116[_0x1db9b8(0x174)])_0xead460=JSON[_0x1db9b8(0x116)](_0x3a6116['val']);}catch(_0x206fb5){}try{const _0x42901b=await _0x16519e[_0x1db9b8(0x168)](_0x16519e['config']['calendarInstance']+'.data.table');if(!_0x42901b||!_0x42901b['val'])return;const _0x4888cb=JSON[_0x1db9b8(0x116)](_0x42901b['val']),_0x1b7496=Date['now'](),_0x441591=_0x16519e['config'][_0x1db9b8(0x130)]||[],_0x430f6a=_0x16519e['config'][_0x1db9b8(0x161)]||[];for(const _0x2ee346 of _0x4888cb){if(_0x2ee346[_0x1db9b8(0x146)]&&_0x430f6a[_0x1db9b8(0x100)]>0x0&&!_0x430f6a[_0x1db9b8(0x15f)](_0x2ee346['_calName']))continue;const _0x32c11d=_0x2ee346[_0x1db9b8(0x16b)]||_0x2ee346[_0x1db9b8(0x169)]||_0x2ee346['date'];if(!_0x32c11d)continue;const _0x22a3ad=new Date(_0x32c11d);if(isNaN(_0x22a3ad[_0x1db9b8(0x156)]()))continue;const _0x519c1c=(_0x2ee346[_0x1db9b8(0x114)]||_0x2ee346['summary']||'')[_0x1db9b8(0x123)]();if(_0x519c1c['includes']('urlaub\x20ende')||_0x519c1c[_0x1db9b8(0x15f)](_0x1db9b8(0xfe))||_0x519c1c[_0x1db9b8(0x15f)]('ankunft')){let _0x34ade8=0x0;Object[_0x1db9b8(0x14e)](_0x2a9d48)['forEach'](_0x26e574=>{if(_0x26e574>_0x34ade8)_0x34ade8=_0x26e574;});if(_0x34ade8===0x0)_0x34ade8=0x78;const _0x5a10f8=_0x22a3ad[_0x1db9b8(0x156)]()-_0x34ade8*0xea60;_0x1b7496>=_0x5a10f8&&_0x1b7496<_0x22a3ad[_0x1db9b8(0x156)]()&&(_0x16519e[_0x1db9b8(0x16c)]!==_0x1db9b8(0x122)&&(_0x16519e[_0x1db9b8(0x16f)][_0x1db9b8(0x149)]('üìÖ\x20SMART\x20SCHEDULE\x20(Phase):\x20\x27Globaler\x20Start\x27\x20erkannt.\x20Heize\x20Haus\x20auf\x20(Vorlauf:\x20'+_0x34ade8+_0x1db9b8(0x106)),await _0x16519e['setStateAsync'](_0x1db9b8(0x186),{'val':_0x1db9b8(0x122),'ack':![]})));}for(const _0x172205 of _0x441591){if(_0x172205[_0x1db9b8(0x142)]){const _0x4ecb47=_0x172205[_0x1db9b8(0x142)][_0x1db9b8(0x123)]();if(_0x519c1c[_0x1db9b8(0x15f)](_0x4ecb47)){const _0x58ddd2=_0x2a9d48[_0x172205[_0x1db9b8(0x142)]]||0x3c,_0x39bda8=_0x35fea5[_0x172205['location']]||_0x1db9b8(0x10c),_0x1438d6=_0x22a3ad[_0x1db9b8(0x156)]()-_0x58ddd2*0xea60;if(_0x1b7496>=_0x1438d6&&_0x1b7496<_0x22a3ad[_0x1db9b8(0x156)]()){const _0x33f2ad=lastActions['cal_'+_0x172205['location']];if(_0x33f2ad&&_0x1b7496-_0x33f2ad<CAL_COOLDOWN_MS)continue;const _0x5c6090=await findRelatedId(_0x16519e,_0x172205['id'],_0x1db9b8(0x171));if(_0x5c6090){let _0x593341=_0xead460[_0x172205[_0x1db9b8(0x142)]];if(_0x593341===undefined)_0x593341=_0xead460[_0x1db9b8(0xef)];if(_0x593341===undefined)_0x593341=0x15;const _0x1b98fb=await _0x16519e[_0x1db9b8(0x168)](_0x5c6090);_0x1b98fb&&typeof _0x1b98fb[_0x1db9b8(0x174)]==='number'&&_0x1b98fb[_0x1db9b8(0x174)]<_0x593341-0.5&&(_0x16519e[_0x1db9b8(0x16f)]['info']('üìÖ\x20SMART\x20SCHEDULE\x20['+_0x39bda8+_0x1db9b8(0x11c)+_0x172205[_0x1db9b8(0x142)]+_0x1db9b8(0x121)+_0x593341+'¬∞C\x20(Vorlauf:\x20'+_0x58ddd2+'\x20min).'),await _0x16519e[_0x1db9b8(0x17d)](_0x5c6090,_0x593341),await logAutomationAction(_0x16519e,_0x1db9b8(0x177)+_0x172205[_0x1db9b8(0x142)]+_0x1db9b8(0x120)+_0x593341+_0x1db9b8(0x11e)+_0x39bda8+')'),lastActions[_0x1db9b8(0x103)+_0x172205['location']]=_0x1b7496);}}}}}}}catch(_0x3f0749){_0x16519e[_0x1db9b8(0x16f)][_0x1db9b8(0x153)](_0x1db9b8(0x128)+_0x3f0749['message']);}}async function manageMpcIntervention(_0x3f137e,_0x5e7dd8,_0x3646ac){const _0xc350f=a1_0x225553;try{const _0x35f3e3='analysis.energy.mpcActiveInterventions',_0x173072=await _0x3f137e['getStateAsync'](_0x35f3e3);let _0x280ea7=[];if(_0x173072&&_0x173072['val'])try{_0x280ea7=JSON['parse'](_0x173072[_0xc350f(0x174)]);}catch(_0x134c5b){}const _0x215e1f=_0x280ea7[_0xc350f(0x14d)](_0x5e7dd8);if(_0x3646ac==='add')_0x215e1f===-0x1&&(_0x280ea7[_0xc350f(0x102)](_0x5e7dd8),await _0x3f137e['setStateAsync'](_0x35f3e3,{'val':JSON[_0xc350f(0x135)](_0x280ea7),'ack':!![]}));else _0x3646ac===_0xc350f(0xfa)&&(_0x215e1f!==-0x1&&(_0x280ea7[_0xc350f(0x124)](_0x215e1f,0x1),await _0x3f137e['setStateAsync'](_0x35f3e3,{'val':JSON[_0xc350f(0x135)](_0x280ea7),'ack':!![]})));}catch(_0x26b423){}}async function cleanupGhostInterventions(_0x247e4a){const _0x821ac6=a1_0x225553;try{const _0xced367=_0x821ac6(0x182),_0x27825a=await _0x247e4a[_0x821ac6(0x101)](_0xced367);if(!_0x27825a||!_0x27825a[_0x821ac6(0x174)])return;const _0x127715=JSON[_0x821ac6(0x116)](_0x27825a[_0x821ac6(0x174)]);if(!Array[_0x821ac6(0x17a)](_0x127715)||_0x127715[_0x821ac6(0x100)]===0x0)return;const _0x35e967=_0x247e4a[_0x821ac6(0x160)][_0x821ac6(0x130)]||[];let _0xd6c13b=![];for(let _0x8d12ef=_0x127715[_0x821ac6(0x100)]-0x1;_0x8d12ef>=0x0;_0x8d12ef--){const _0x2f00f8=_0x127715[_0x8d12ef],_0x34d3e5=_0x35e967[_0x821ac6(0x16e)](_0x443d5e=>normalize(_0x443d5e[_0x821ac6(0x142)])===normalize(_0x2f00f8)&&(_0x443d5e['type']===_0x821ac6(0x166)||_0x443d5e[_0x821ac6(0x10f)]==='thermostat'));if(_0x34d3e5){const _0x59e651=await findRelatedId(_0x247e4a,_0x34d3e5['id'],_0x821ac6(0x171));if(_0x59e651){const _0x16cd67=await _0x247e4a[_0x821ac6(0x168)](_0x59e651);_0x16cd67&&typeof _0x16cd67[_0x821ac6(0x174)]===_0x821ac6(0x13d)&&(Math['abs'](_0x16cd67[_0x821ac6(0x174)]-ECO_TEMP)>0.5&&(_0x247e4a[_0x821ac6(0x16f)][_0x821ac6(0x149)](_0x821ac6(0x10d)+_0x2f00f8+_0x821ac6(0xfc)+_0x16cd67[_0x821ac6(0x174)]+_0x821ac6(0x148)+ECO_TEMP+_0x821ac6(0x10e)),_0x127715[_0x821ac6(0x124)](_0x8d12ef,0x1),_0xd6c13b=!![]));}}}_0xd6c13b&&await _0x247e4a[_0x821ac6(0x138)](_0xced367,{'val':JSON[_0x821ac6(0x135)](_0x127715),'ack':!![]});}catch(_0x258063){}}async function applyEnergySavings(_0x380beb,_0x106cac){const _0x11af6e=a1_0x225553;await cleanupGhostInterventions(_0x380beb);if(!_0x106cac||_0x106cac[_0x11af6e(0x100)]===0x0)return;const _0x5266c8=_0x380beb[_0x11af6e(0x160)][_0x11af6e(0x130)]||[],_0xd6bccb=Date['now']();for(const _0x2d4f96 of _0x106cac){const _0x2e791e=_0x2d4f96[_0x11af6e(0x10b)],_0x468819=_0x2d4f96[_0x11af6e(0x178)],_0x12a708=_0x2d4f96[_0x11af6e(0x145)]||0x15,_0x47be3f=_0x5266c8[_0x11af6e(0x16e)](_0x2e7528=>normalize(_0x2e7528[_0x11af6e(0x142)])===normalize(_0x2e791e)&&(_0x2e7528[_0x11af6e(0x10f)]==='temperature'||_0x2e7528[_0x11af6e(0x10f)]===_0x11af6e(0x17f)));if(!_0x47be3f)continue;const _0x5667f3=await findRelatedId(_0x380beb,_0x47be3f['id'],'setpoint');if(_0x5667f3){if(lastActions['mpc_'+_0x2e791e]&&_0xd6bccb-lastActions[_0x11af6e(0xea)+_0x2e791e]<0x1e*0x3c*0x3e8)continue;const _0x4c0c71=await _0x380beb[_0x11af6e(0x168)](_0x5667f3);if(_0x4c0c71&&typeof _0x4c0c71[_0x11af6e(0x174)]===_0x11af6e(0x13d)){const _0x59676b=_0x4c0c71[_0x11af6e(0x174)];_0x59676b!==ECO_TEMP&&await manageMpcIntervention(_0x380beb,_0x2e791e,_0x11af6e(0xfa));if(_0x468819>0x1e)_0x59676b>ECO_TEMP+0.5&&(_0x380beb['log'][_0x11af6e(0x149)](_0x11af6e(0x175)+_0x2e791e+_0x11af6e(0x15d)+ECO_TEMP+_0x11af6e(0x15e)+_0x468819+_0x11af6e(0x14a)),await _0x380beb[_0x11af6e(0x17d)](_0x5667f3,ECO_TEMP),await manageMpcIntervention(_0x380beb,_0x2e791e,_0x11af6e(0xed)),lastActions['mpc_'+_0x2e791e]=_0xd6bccb,await logAutomationAction(_0x380beb,_0x11af6e(0x115)+_0x2e791e+':\x20Absenkung\x20auf\x20'+ECO_TEMP+'¬∞C'));else _0x468819<=0xf&&(_0x59676b<_0x12a708&&(_0x380beb[_0x11af6e(0x16f)][_0x11af6e(0x149)](_0x11af6e(0x172)+_0x2e791e+_0x11af6e(0x180)+_0x12a708+'¬∞C!\x20(Puffer\x20leer).'),await _0x380beb['setForeignStateAsync'](_0x5667f3,_0x12a708),await manageMpcIntervention(_0x380beb,_0x2e791e,_0x11af6e(0xfa)),lastActions[_0x11af6e(0xea)+_0x2e791e]=_0xd6bccb,await logAutomationAction(_0x380beb,_0x11af6e(0x115)+_0x2e791e+_0x11af6e(0x107)+_0x12a708+'¬∞C')));}}else _0x380beb[_0x11af6e(0x16f)][_0x11af6e(0x153)](_0x11af6e(0x108)+_0x2e791e+'\x20gefunden!');}}module['exports']={'handlePrediction':handlePrediction,'applyEnergySavings':applyEnergySavings,'scanThermostats':scanThermostats,'checkCalendarTriggers':checkCalendarTriggers,'updateSchedulePreview':updateSchedulePreview};function a1_0x4eb3(){const _0xbc1f77=['¬∞C\x20(via\x20','hm-rpc','\x20->\x20','\x27\x20aktiv.\x20Heize\x20auf\x20','normal','toLowerCase','splice','.1.TEMPERATURE','analysis.energy.warmupTimes','openknx','Calendar\x20Check\x20Error:\x20','wert','Unbekannt','ankunft','SET_POINT_TEMPERATURE','soll','summary','pi_heating_demand','devices','\x20->\x20Schalte\x20','level','slice','write','stringify','calendarInstance','split','setStateAsync','filter','local_temperature','3455rwKCkg','switch','number','Unknown','search','sensor','(((.+)+)+)+$','location','current_heating_setpoint','off','target','_calName','light','¬∞C\x20(nicht\x20','info','\x20min)','21043bQhHfv','4094496oCNVFg','indexOf','values','set','level.valve','423FQenbF','forEach','warn','5794ITJuJZ','level.temperature','getTime','score','ACTUAL','role','2330XNxLCM','active','885247PdqqxC','\x20auf\x20','¬∞C!\x20(Puffer:\x20','includes','config','calendarSelection','valve','analysis.automation.confidenceThreshold','./ai_agent','Nicht\x20gefunden','temperature','join','getForeignStateAsync','eventStart','.1.LEVEL','_date','currentSystemMode','analysis.energy.warmupTargets','find','log','from','setpoint','üî•\x20[MPC\x20ACTION]\x20Heize\x20','getForeignObjectsAsync','val','üçÉ\x20[MPC\x20ACTION]\x20Senke\x20','analysis.automation.mode','[CAL]\x20','minutes_safe','SET','isArray','stellwert','analysis.energy.warmupSources','setForeignStateAsync','8KsnhHv','thermostat','\x20wieder\x20auf\x20','Soll','analysis.energy.mpcActiveInterventions','ist','ACTUAL_TEMPERATURE','thermostatMapping','system.mode','mpc_','replace','localeCompare','add','name','default','thermostat.setpoint','analysis.automation.lastAction','.1.ACTUAL_TEMPERATURE','apply','.4.VALVE_STATE','getForeignObjectAsync','urlaub\x20ende','valveMapping','string','reason','remove','target_temperature','\x20ist\x20auf\x20','sort','r√ºckkehr','occupied_heating_setpoint','length','getStateAsync','push','cal_','15294qaqkUJ','useCalendar','\x20min).',':\x20Aufheizen\x20auf\x20','[MPC\x20WARNING]\x20Kein\x20Setpoint\x20f√ºr\x20','1016888HUxKRr','PERFECT','room','Classic','üßπ\x20[MPC\x20CLEANUP]\x20','¬∞C).\x20Entferne\x20Status.','type','valve_position','analysis.automation.actionLog','entries','actual','event','[MPC]\x20','parse','now','constructor','approved','toString','messwert',']:\x20Raum-Trigger\x20\x27','6800886QuitOy'];a1_0x4eb3=function(){return _0xbc1f77;};return a1_0x4eb3();}