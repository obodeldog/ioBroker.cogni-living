const a1_0x52d53c=a1_0x2e14;(function(_0x3d5944,_0x120802){const _0x5ba8f5=a1_0x2e14,_0x5e805b=_0x3d5944();while(!![]){try{const _0x35fd92=-parseInt(_0x5ba8f5(0x1c6))/0x1*(parseInt(_0x5ba8f5(0x1f4))/0x2)+-parseInt(_0x5ba8f5(0x1cb))/0x3*(parseInt(_0x5ba8f5(0x1b7))/0x4)+parseInt(_0x5ba8f5(0x1a9))/0x5+-parseInt(_0x5ba8f5(0x1d6))/0x6+-parseInt(_0x5ba8f5(0x217))/0x7*(-parseInt(_0x5ba8f5(0x245))/0x8)+-parseInt(_0x5ba8f5(0x1e6))/0x9*(parseInt(_0x5ba8f5(0x1b2))/0xa)+parseInt(_0x5ba8f5(0x1af))/0xb;if(_0x35fd92===_0x120802)break;else _0x5e805b['push'](_0x5e805b['shift']());}catch(_0x5b393f){_0x5e805b['push'](_0x5e805b['shift']());}}}(a1_0x8a30,0x53a30));const a1_0x42df62=(function(){let _0x12dd4b=!![];return function(_0x7f60ff,_0x389503){const _0x102609=_0x12dd4b?function(){const _0x5bbc06=a1_0x2e14;if(_0x389503){const _0x139979=_0x389503[_0x5bbc06(0x1c3)](_0x7f60ff,arguments);return _0x389503=null,_0x139979;}}:function(){};return _0x12dd4b=![],_0x102609;};}()),a1_0x2f54cb=a1_0x42df62(this,function(){const _0x304696=a1_0x2e14;return a1_0x2f54cb[_0x304696(0x1f0)]()[_0x304696(0x1dd)]('(((.+)+)+)+$')[_0x304696(0x1f0)]()[_0x304696(0x1f3)](a1_0x2f54cb)[_0x304696(0x1dd)](_0x304696(0x196));});a1_0x2f54cb();'use strict';const aiAgent=require(a1_0x52d53c(0x238)),COOLDOWN_MS=0x3c*0x3e8,CAL_COOLDOWN_MS=0x5a*0x3c*0x3e8,RESCUE_LOCK_MS=0x78*0x3c*0x3e8,ECO_TEMP=0x11,lastActions={};function normalize(_0x50b183){const _0x17d24e=a1_0x52d53c;if(!_0x50b183)return'';return _0x50b183[_0x17d24e(0x20c)]()[_0x17d24e(0x1e4)](/\s+/g,'')['trim']();}async function logAutomationAction(_0x15e8b2,_0x10e083){const _0x1821d8=a1_0x52d53c;await _0x15e8b2[_0x1821d8(0x206)]('analysis.automation.lastAction',{'val':_0x10e083,'ack':!![]});try{const _0x439079='analysis.automation.actionLog',_0x25a348=await _0x15e8b2['getStateAsync'](_0x439079);let _0x4d5c54=[];if(_0x25a348&&_0x25a348[_0x1821d8(0x1bd)])try{_0x4d5c54=JSON[_0x1821d8(0x1e7)](_0x25a348[_0x1821d8(0x1bd)]);}catch(_0x54022f){}_0x4d5c54[_0x1821d8(0x22a)]({'ts':Date[_0x1821d8(0x1b9)](),'msg':_0x10e083});if(_0x4d5c54['length']>0x32)_0x4d5c54=_0x4d5c54[_0x1821d8(0x21f)](0x0,0x32);await _0x15e8b2[_0x1821d8(0x206)](_0x439079,{'val':JSON[_0x1821d8(0x23b)](_0x4d5c54),'ack':!![]});}catch(_0x2794e2){}}async function handlePrediction(_0x70f84e,_0x47596e,_0x1785eb){const _0x5b2d90=a1_0x52d53c;if(!_0x47596e||_0x47596e===_0x5b2d90(0x202))return;let _0x31bc25=_0x5b2d90(0x1c4),_0x3398cc=0.6;try{const _0xa5c54a=await _0x70f84e[_0x5b2d90(0x1a1)](_0x5b2d90(0x240));if(_0xa5c54a&&_0xa5c54a[_0x5b2d90(0x1bd)])_0x31bc25=_0xa5c54a['val'];const _0x2e5c05=await _0x70f84e[_0x5b2d90(0x1a1)](_0x5b2d90(0x1fe));if(_0x2e5c05&&_0x2e5c05['val'])_0x3398cc=_0x2e5c05[_0x5b2d90(0x1bd)];}catch(_0x218d7a){}if(_0x31bc25==='off'||_0x1785eb<_0x3398cc)return;const _0x1a71cf=Date[_0x5b2d90(0x1b9)]();if(lastActions[_0x47596e]&&_0x1a71cf-lastActions[_0x47596e]<COOLDOWN_MS)return;const _0xf3eec6=_0x70f84e['config'][_0x5b2d90(0x19d)]||[],_0x4fc2a9=normalize(_0x47596e),_0x2dc13d=_0xf3eec6['find'](_0x1eae78=>normalize(_0x1eae78[_0x5b2d90(0x1aa)])===_0x4fc2a9&&(_0x1eae78[_0x5b2d90(0x1fa)]===_0x5b2d90(0x233)||_0x1eae78[_0x5b2d90(0x1fa)]===_0x5b2d90(0x1f8)||_0x1eae78['type']===_0x5b2d90(0x1e3)));if(!_0x2dc13d)return;const _0x265f67=await aiAgent['consultButler'](_0x70f84e,_0x47596e,_0x2dc13d[_0x5b2d90(0x221)],_0x1785eb);if(!_0x265f67[_0x5b2d90(0x20b)])return;const _0x3e3108=_0x5b2d90(0x1e8)+_0x47596e+_0x5b2d90(0x213)+_0x2dc13d[_0x5b2d90(0x221)]+'\x20('+_0x265f67[_0x5b2d90(0x1de)]+')';await logAutomationAction(_0x70f84e,'['+_0x31bc25[_0x5b2d90(0x20a)]()+']\x20'+_0x3e3108);if(_0x31bc25===_0x5b2d90(0x205)){const _0x505a2c=await _0x70f84e[_0x5b2d90(0x21d)](_0x2dc13d['id']);(!_0x505a2c||!_0x505a2c[_0x5b2d90(0x1bd)]&&_0x505a2c[_0x5b2d90(0x1bd)]!==!![])&&await _0x70f84e['setForeignStateAsync'](_0x2dc13d['id'],!![]),lastActions[_0x47596e]=_0x1a71cf;}}async function findRelatedId(_0x17a61f,_0xf36241,_0x5aca33=a1_0x52d53c(0x21a)){const _0xa8f721=a1_0x52d53c;if(_0x5aca33===_0xa8f721(0x21a)&&_0x17a61f[_0xa8f721(0x1b3)][_0xa8f721(0x1ce)]){let _0x304e63=_0x17a61f[_0xa8f721(0x1b3)][_0xa8f721(0x1ce)];if(typeof _0x304e63==='string')try{_0x304e63=JSON['parse'](_0x304e63);}catch(_0xa6cd2c){}if(_0x304e63&&_0x304e63[_0xf36241])return _0x304e63[_0xf36241];}if(_0x5aca33===_0xa8f721(0x1f9)&&_0x17a61f[_0xa8f721(0x1b3)][_0xa8f721(0x1d5)]){let _0x23e3da=_0x17a61f['config']['valveMapping'];if(typeof _0x23e3da===_0xa8f721(0x1c2))try{_0x23e3da=JSON['parse'](_0x23e3da);}catch(_0x154739){}if(_0x23e3da&&_0x23e3da[_0xf36241])return _0x23e3da[_0xf36241];}let _0x44b795=[];if(_0x5aca33===_0xa8f721(0x21a))_0x44b795=[{'s':_0xa8f721(0x1bf),'t':_0xa8f721(0x1ef)},{'s':_0xa8f721(0x1ba),'t':_0xa8f721(0x1ef)},{'s':'.1.TEMPERATURE','t':_0xa8f721(0x1f1)},{'s':_0xa8f721(0x19a),'t':_0xa8f721(0x231)},{'s':_0xa8f721(0x192),'t':_0xa8f721(0x22d)},{'s':'local_temperature','t':_0xa8f721(0x1ca)},{'s':_0xa8f721(0x224),'t':_0xa8f721(0x19b)},{'s':_0xa8f721(0x1e1),'t':_0xa8f721(0x20f)},{'s':_0xa8f721(0x18f),'t':_0xa8f721(0x19c)},{'s':_0xa8f721(0x224),'t':_0xa8f721(0x21a)}];else _0x5aca33===_0xa8f721(0x1f9)&&(_0x44b795=[{'s':'.1.ACTUAL_TEMPERATURE','t':_0xa8f721(0x209)},{'s':'.1.TEMPERATURE','t':'.1.LEVEL'},{'s':'.1.TEMPERATURE','t':_0xa8f721(0x242)},{'s':_0xa8f721(0x192),'t':_0xa8f721(0x21e)},{'s':'temperature','t':'valve_position'},{'s':'temperature','t':'level'}]);for(const _0x55ef58 of _0x44b795){if(_0xf36241[_0xa8f721(0x239)](_0x55ef58['s'])){const _0x5c41d9=_0xf36241[_0xa8f721(0x1e4)](_0x55ef58['s'],_0x55ef58['t']),_0x1d3cd0=await _0x17a61f[_0xa8f721(0x23a)](_0x5c41d9);if(_0x1d3cd0)return _0x5c41d9;}}try{const _0x1f167f=_0xf36241['split']('.');if(_0x1f167f[_0xa8f721(0x1dc)]>0x2){const _0x3ef0f2=_0x1f167f[_0xa8f721(0x21f)](0x0,-0x1)[_0xa8f721(0x223)]('.'),_0x57c7a6=await _0x17a61f[_0xa8f721(0x1b5)](_0x3ef0f2+'.*'),_0xe92bf8=[],_0x823966=_0xf36241[_0xa8f721(0x210)](/[._]+/)[_0xa8f721(0x1a8)](_0x266a2c=>![_0xa8f721(0x200),'0','hm-rpc',_0xa8f721(0x1ae),_0xa8f721(0x1a2),_0xa8f721(0x224),_0xa8f721(0x1e2),'sensor','messwert',_0xa8f721(0x23d)]['includes'](_0x266a2c[_0xa8f721(0x20c)]()));for(const [_0x20701d,_0x43e96a]of Object['entries'](_0x57c7a6)){if(_0x20701d===_0xf36241)continue;if(_0x43e96a&&_0x43e96a['common']){const _0x107067=_0x20701d['toLowerCase'](),_0x44ed6e=(_0x43e96a[_0xa8f721(0x1ed)][_0xa8f721(0x1d2)]||'')[_0xa8f721(0x20c)](),_0x533c17=(_0x43e96a['common'][_0xa8f721(0x195)]||'')[_0xa8f721(0x20c)]();let _0x4498c5=![];if(_0x5aca33===_0xa8f721(0x21a)&&_0x43e96a['common'][_0xa8f721(0x207)]===!![])_0x4498c5=_0x107067[_0xa8f721(0x239)](_0xa8f721(0x1f5))||_0x107067[_0xa8f721(0x239)](_0xa8f721(0x1d8))||_0x107067[_0xa8f721(0x239)](_0xa8f721(0x203))||_0x44ed6e['includes']('level.temperature')||_0x44ed6e[_0xa8f721(0x239)](_0xa8f721(0x1fd));else _0x5aca33==='valve'&&(_0x4498c5=_0x107067[_0xa8f721(0x239)](_0xa8f721(0x1ff))||_0x107067[_0xa8f721(0x239)]('valve')||_0x107067[_0xa8f721(0x239)](_0xa8f721(0x1fb))||_0x107067[_0xa8f721(0x239)]('position')||_0x44ed6e['includes'](_0xa8f721(0x235))||_0x44ed6e[_0xa8f721(0x239)](_0xa8f721(0x1d9))||_0x533c17[_0xa8f721(0x239)]('%'));if(_0x4498c5){const _0x3d5b59=_0x20701d[_0xa8f721(0x210)](/[._]+/)[_0xa8f721(0x21c)](_0x551955=>_0x551955[_0xa8f721(0x20c)]());let _0x14a96a=0x0;_0x823966[_0xa8f721(0x1cc)](_0x157ad1=>{const _0x5bceaf=_0xa8f721;if(_0x3d5b59[_0x5bceaf(0x239)](_0x157ad1[_0x5bceaf(0x20c)]()))_0x14a96a++;}),_0xe92bf8[_0xa8f721(0x216)]({'id':_0x20701d,'score':_0x14a96a});}}}if(_0xe92bf8[_0xa8f721(0x1dc)]>0x0){_0xe92bf8[_0xa8f721(0x1f2)]((_0x18115d,_0x192d76)=>_0x192d76[_0xa8f721(0x227)]-_0x18115d[_0xa8f721(0x227)]);if(_0xe92bf8[0x0][_0xa8f721(0x227)]>0x0)return _0xe92bf8[0x0]['id'];}}}catch(_0x4f5c98){}return null;}async function scanThermostats(_0x3d8794){const _0x11dc75=a1_0x52d53c,_0x2ae435=_0x3d8794[_0x11dc75(0x1b3)][_0x11dc75(0x19d)]||[],_0x1d2340=[],_0x641796=_0x2ae435[_0x11dc75(0x1a8)](_0x508b61=>_0x508b61['id']&&_0x508b61['id'][_0x11dc75(0x239)](_0x11dc75(0x224))||_0x508b61[_0x11dc75(0x1fa)]&&[_0x11dc75(0x224),_0x11dc75(0x1a5),_0x11dc75(0x190)][_0x11dc75(0x239)](_0x508b61[_0x11dc75(0x1fa)])||_0x508b61[_0x11dc75(0x221)]&&_0x508b61[_0x11dc75(0x221)]['toLowerCase']()['includes']('temp'));for(const _0xf21ccd of _0x641796){const _0x5e77d4=await findRelatedId(_0x3d8794,_0xf21ccd['id'],'setpoint'),_0x3a4a2e=await findRelatedId(_0x3d8794,_0xf21ccd['id'],'valve');let _0x5cb33a=_0x11dc75(0x1e9),_0x14d31c=![],_0x46b455=_0x3d8794[_0x11dc75(0x1b3)]['thermostatMapping']||{};if(typeof _0x46b455===_0x11dc75(0x1c2))try{_0x46b455=JSON[_0x11dc75(0x1e7)](_0x46b455);}catch(_0x5c9802){}let _0x1dcfb0=_0x3d8794[_0x11dc75(0x1b3)]['valveMapping']||{};if(typeof _0x1dcfb0===_0x11dc75(0x1c2))try{_0x1dcfb0=JSON['parse'](_0x1dcfb0);}catch(_0x49f66a){}if(_0x46b455[_0xf21ccd['id']]&&_0x46b455[_0xf21ccd['id']]===_0x5e77d4||_0x1dcfb0[_0xf21ccd['id']]&&_0x1dcfb0[_0xf21ccd['id']]===_0x3a4a2e)_0x5cb33a='Manuelles\x20Mapping',_0x14d31c=!![];else(_0x5e77d4||_0x3a4a2e)&&(_0x5cb33a=_0x11dc75(0x22b));_0x1d2340[_0x11dc75(0x216)]({'room':_0xf21ccd[_0x11dc75(0x1aa)]||_0x11dc75(0x212),'sensorId':_0xf21ccd['id'],'setpointId':_0x5e77d4||'-','valveId':_0x3a4a2e||'-','source':_0x5cb33a,'isManual':_0x14d31c,'status':_0x5e77d4&&_0x3a4a2e?'PERFECT':_0x5e77d4?'OK':_0x11dc75(0x1a3)});}return _0x1d2340[_0x11dc75(0x1f2)]((_0x396224,_0x3d69ec)=>_0x396224[_0x11dc75(0x237)][_0x11dc75(0x1cd)](_0x3d69ec[_0x11dc75(0x237)]));}async function updateSchedulePreview(_0x3d3891){const _0x512642=a1_0x52d53c;if(!_0x3d3891['config'][_0x512642(0x1a0)]||!_0x3d3891['config'][_0x512642(0x232)])return;let _0x3df80e={};try{const _0x294123=await _0x3d3891[_0x512642(0x1a1)](_0x512642(0x22f));if(_0x294123&&_0x294123['val'])_0x3df80e=JSON['parse'](_0x294123['val']);}catch(_0x4def57){}const _0x54b9ca=[],_0x33e356=Date['now'](),_0x2d864d=0x30*0x3c*0x3c*0x3e8;try{const _0x374067=await _0x3d3891[_0x512642(0x21d)](_0x3d3891[_0x512642(0x1b3)][_0x512642(0x232)]+_0x512642(0x1ec));if(!_0x374067||!_0x374067[_0x512642(0x1bd)])return;const _0x211a5c=JSON[_0x512642(0x1e7)](_0x374067[_0x512642(0x1bd)]),_0xda81da=_0x3d3891[_0x512642(0x1b3)][_0x512642(0x191)]||[],_0x2230bc=_0x3d3891[_0x512642(0x1b3)][_0x512642(0x19d)]||[],_0x595115=new Set();_0x2230bc[_0x512642(0x1cc)](_0x5a2942=>{const _0xebe90f=_0x512642;if(_0x5a2942['location'])_0x595115['add'](_0x5a2942[_0xebe90f(0x1aa)]);});for(const _0x1d5427 of _0x211a5c){if(_0x1d5427[_0x512642(0x1ea)]&&_0xda81da[_0x512642(0x1dc)]>0x0&&!_0xda81da[_0x512642(0x239)](_0x1d5427[_0x512642(0x1ea)]))continue;const _0x187b1b=_0x1d5427['_date']||_0x1d5427[_0x512642(0x21b)]||_0x1d5427['date'];if(!_0x187b1b)continue;const _0x2ca5c1=new Date(_0x187b1b),_0x494197=_0x2ca5c1['getTime']();if(isNaN(_0x494197))continue;if(_0x494197<_0x33e356)continue;if(_0x494197>_0x33e356+_0x2d864d)continue;const _0x1f9769=(_0x1d5427[_0x512642(0x225)]||_0x1d5427['summary']||'')[_0x512642(0x20c)]();let _0x3e0da6=![],_0x14fe11=[],_0x193761=_0x1d5427['event']||_0x1d5427[_0x512642(0x1da)]||'Unbekannt';if(_0x1f9769[_0x512642(0x239)](_0x512642(0x23f))||_0x1f9769[_0x512642(0x239)](_0x512642(0x1c9))||_0x1f9769[_0x512642(0x239)]('ankunft'))_0x3e0da6=!![],_0x14fe11=Array[_0x512642(0x19f)](_0x595115);else for(const _0x5455d6 of _0x595115){if(_0x1f9769['includes'](_0x5455d6['toLowerCase']()))_0x14fe11[_0x512642(0x216)](_0x5455d6);}_0x14fe11[_0x512642(0x1dc)]>0x0&&_0x14fe11[_0x512642(0x1cc)](_0x1c8f1b=>{const _0x517eb6=_0x512642;let _0x193b7f=0x3c;if(_0x3e0da6){let _0x271175=0x0;Object[_0x517eb6(0x1ee)](_0x3df80e)[_0x517eb6(0x1cc)](_0x133e80=>{if(_0x133e80>_0x271175)_0x271175=_0x133e80;}),_0x193b7f=_0x271175>0x0?_0x271175:0x78;}else _0x193b7f=_0x3df80e[_0x1c8f1b]||0x3c;const _0x3651d0=new Date(_0x494197-_0x193b7f*0xea60);_0x54b9ca[_0x517eb6(0x216)]({'eventTime':_0x494197,'triggerTime':_0x3651d0['getTime'](),'room':_0x1c8f1b,'minutes':_0x193b7f,'reason':_0x193761,'isGlobal':_0x3e0da6});});}}catch(_0x4fe0ce){}_0x54b9ca['sort']((_0x447693,_0x296c92)=>_0x447693[_0x512642(0x228)]-_0x296c92[_0x512642(0x228)]);const _0x41a771=_0x54b9ca[_0x512642(0x21f)](0x0,0x5);await _0x3d3891[_0x512642(0x206)](_0x512642(0x1bc),{'val':JSON['stringify'](_0x41a771),'ack':!![]});}function a1_0x8a30(){const _0x49a979=['.1.ACTUAL_TEMPERATURE','\x20->\x20','message','string','apply','off','remove','189960QGuDHh','cal_','rescue_','rÃ¼ckkehr','current_heating_setpoint','37131DjGbzo','forEach','localeCompare','thermostatMapping','number','\x20auf\x20','\x20gefunden!','role','Â°C\x20(via\x20','Â°C\x20(Vorlauf:\x20','valveMapping','139770MlEJBw','getTime','soll','value.valve','summary','\x20wurde\x20manuell\x20erhÃ¶ht.','length','search','reason','contact','[MPC]\x20','ACTUAL','actual','switch','replace','[CAL]\x20','27hNFAeF','parse','PrÃ¤diktion:\x20','Nicht\x20gefunden','_calName',':\x20Absenkung\x20auf\x20','.data.table','common','values','.1.SET_POINT_TEMPERATURE','toString','.4.SET_TEMPERATURE','sort','constructor','2RiyAEa','set',']:\x20Raum-Trigger\x20\x27','Â°C!\x20(Puffer\x20leer).','dimmer','valve','type','stellwert','Â°C).\x20Entferne\x20Status.','thermostat.setpoint','analysis.automation.confidenceThreshold','level','openknx','find','Unknown','target','\x20wieder\x20auf\x20','active','setStateAsync','write','indexOf','.1.LEVEL','toUpperCase','approved','toLowerCase','window','\x20min)','SET','split','isArray','Unbekannt','\x20->\x20Schalte\x20','Â°C\x20<\x20','sendToPythonWrapper','push','28jkIXkG','currentSystemMode','add','setpoint','eventStart','map','getForeignStateAsync','pi_heating_demand','slice','mpc_','name','ðŸŽ“\x20[RL-FEEDBACK]\x20Lerne\x20aus\x20Fehler:\x20','join','temperature','event','analysis.energy.warmupSources','score','triggerTime','[WATCHDOG]\x20','unshift','Auto-Erkennung','log','occupied_heating_setpoint','\x20durch\x20Kalender\x20geÃ¤ndert.\x20Keine\x20RL-Strafe.','analysis.energy.warmupTimes','analysis.energy.warmupTargets','SET_POINT_TEMPERATURE','calendarInstance','light','\x20ist\x20auf\x20','level.valve','default','room','./ai_agent','includes','getForeignObjectAsync','stringify','Â°C\x20(nicht\x20','state','splice','urlaub\x20ende','analysis.automation.mode','system.mode','.4.VALVE_STATE','info','normal','456272zYDaPW','Ist','sensor','calendarSelection','local_temperature','Calendar\x20Check\x20Error:\x20','abs','unit','(((.+)+)+)+$','ðŸ“…\x20SMART\x20SCHEDULE\x20(Phase):\x20\x27Globaler\x20Start\x27\x20erkannt.\x20Heize\x20Haus\x20auf\x20(Vorlauf:\x20','Â°C).\x20Sparmodus\x20beendet!','warn','ACTUAL_TEMPERATURE','target_temperature','Soll','devices','\x27\x20hat\x20kein\x20GerÃ¤t\x20mehr.\x20LÃ¶sche\x20Eintrag.','from','useCalendar','getStateAsync','wert','Fehlt','ðŸƒ\x20[MPC\x20ACTION]\x20Senke\x20','thermostat','_date','too_cold','filter','2088170BCTIoW','location','analysis.energy.ventilationAlerts','manual','open','ist','7135029NsqOZs','\x20erreicht\x20Limit\x20(','TRAIN_RL_PENALTY','935430IwNBle','config','\x20min).','getForeignObjectsAsync','ankunft','148RMGoOu','setForeignStateAsync','now','.1.TEMPERATURE','ðŸš¨\x20[MPC\x20WATCHDOG]\x20','analysis.energy.schedulePreview','val','[MPC\x20WARNING]\x20Kein\x20Setpoint\x20fÃ¼r\x20'];a1_0x8a30=function(){return _0x49a979;};return a1_0x8a30();}async function checkCalendarTriggers(_0x2e1a4a){const _0x310295=a1_0x52d53c;if(!_0x2e1a4a[_0x310295(0x1b3)][_0x310295(0x1a0)]||!_0x2e1a4a[_0x310295(0x1b3)]['calendarInstance'])return;await updateSchedulePreview(_0x2e1a4a);let _0x9abe6e={},_0x17b8d4={};try{const _0x2463a7=await _0x2e1a4a[_0x310295(0x1a1)](_0x310295(0x22f));if(_0x2463a7&&_0x2463a7[_0x310295(0x1bd)])_0x9abe6e=JSON[_0x310295(0x1e7)](_0x2463a7[_0x310295(0x1bd)]);const _0x34a421=await _0x2e1a4a[_0x310295(0x1a1)](_0x310295(0x226));if(_0x34a421&&_0x34a421[_0x310295(0x1bd)])_0x17b8d4=JSON[_0x310295(0x1e7)](_0x34a421[_0x310295(0x1bd)]);}catch(_0x51b38b){}let _0x19ca32={'default':0x15};try{const _0x279968=await _0x2e1a4a[_0x310295(0x1a1)](_0x310295(0x230));if(_0x279968&&_0x279968[_0x310295(0x1bd)])_0x19ca32=JSON['parse'](_0x279968[_0x310295(0x1bd)]);}catch(_0x3b4e23){}try{const _0x5e530a=await _0x2e1a4a[_0x310295(0x21d)](_0x2e1a4a['config'][_0x310295(0x232)]+_0x310295(0x1ec));if(!_0x5e530a||!_0x5e530a['val'])return;const _0x2289ce=JSON[_0x310295(0x1e7)](_0x5e530a[_0x310295(0x1bd)]),_0x1b87ff=Date[_0x310295(0x1b9)](),_0x1d5deb=_0x2e1a4a[_0x310295(0x1b3)]['devices']||[],_0x2116fc=_0x2e1a4a['config']['calendarSelection']||[];for(const _0x45569d of _0x2289ce){if(_0x45569d[_0x310295(0x1ea)]&&_0x2116fc[_0x310295(0x1dc)]>0x0&&!_0x2116fc[_0x310295(0x239)](_0x45569d[_0x310295(0x1ea)]))continue;const _0x2eef80=_0x45569d[_0x310295(0x1a6)]||_0x45569d[_0x310295(0x21b)]||_0x45569d['date'];if(!_0x2eef80)continue;const _0x321a05=new Date(_0x2eef80);if(isNaN(_0x321a05[_0x310295(0x1d7)]()))continue;const _0x1471e1=(_0x45569d[_0x310295(0x225)]||_0x45569d[_0x310295(0x1da)]||'')[_0x310295(0x20c)]();if(_0x1471e1[_0x310295(0x239)](_0x310295(0x23f))||_0x1471e1[_0x310295(0x239)](_0x310295(0x1c9))||_0x1471e1[_0x310295(0x239)](_0x310295(0x1b6))){let _0x56a42c=0x0;Object[_0x310295(0x1ee)](_0x9abe6e)[_0x310295(0x1cc)](_0x123d5e=>{if(_0x123d5e>_0x56a42c)_0x56a42c=_0x123d5e;});if(_0x56a42c===0x0)_0x56a42c=0x78;const _0x1e3fad=_0x321a05[_0x310295(0x1d7)]()-_0x56a42c*0xea60;_0x1b87ff>=_0x1e3fad&&_0x1b87ff<_0x321a05['getTime']()&&(_0x2e1a4a[_0x310295(0x218)]!==_0x310295(0x244)&&(_0x2e1a4a[_0x310295(0x22c)]['info'](_0x310295(0x197)+_0x56a42c+_0x310295(0x1b4)),await _0x2e1a4a[_0x310295(0x206)](_0x310295(0x241),{'val':_0x310295(0x244),'ack':![]})));}for(const _0xd6ea4e of _0x1d5deb){if(_0xd6ea4e['location']){const _0x39be72=_0xd6ea4e[_0x310295(0x1aa)][_0x310295(0x20c)]();if(_0x1471e1['includes'](_0x39be72)){const _0x4d7fba=_0x9abe6e[_0xd6ea4e['location']]||0x3c,_0x5657c5=_0x17b8d4[_0xd6ea4e[_0x310295(0x1aa)]]||'Classic',_0x3ad9a9=_0x321a05[_0x310295(0x1d7)]()-_0x4d7fba*0xea60;if(_0x1b87ff>=_0x3ad9a9&&_0x1b87ff<_0x321a05['getTime']()){const _0x338921=lastActions[_0x310295(0x1c7)+_0xd6ea4e[_0x310295(0x1aa)]];if(_0x338921&&_0x1b87ff-_0x338921<CAL_COOLDOWN_MS)continue;const _0x447679=await findRelatedId(_0x2e1a4a,_0xd6ea4e['id'],_0x310295(0x21a));if(_0x447679){let _0xe9cfbb=_0x19ca32[_0xd6ea4e['location']];if(_0xe9cfbb===undefined)_0xe9cfbb=_0x19ca32[_0x310295(0x236)];if(_0xe9cfbb===undefined)_0xe9cfbb=0x15;const _0x31eed0=await _0x2e1a4a[_0x310295(0x21d)](_0x447679);_0x31eed0&&typeof _0x31eed0[_0x310295(0x1bd)]===_0x310295(0x1cf)&&_0x31eed0[_0x310295(0x1bd)]<_0xe9cfbb-0.5&&(_0x2e1a4a[_0x310295(0x22c)]['info']('ðŸ“…\x20SMART\x20SCHEDULE\x20['+_0x5657c5+_0x310295(0x1f6)+_0xd6ea4e[_0x310295(0x1aa)]+'\x27\x20aktiv.\x20Heize\x20auf\x20'+_0xe9cfbb+_0x310295(0x1d4)+_0x4d7fba+_0x310295(0x1b4)),await _0x2e1a4a[_0x310295(0x1b8)](_0x447679,_0xe9cfbb),await logAutomationAction(_0x2e1a4a,_0x310295(0x1e5)+_0xd6ea4e[_0x310295(0x1aa)]+_0x310295(0x1c0)+_0xe9cfbb+_0x310295(0x1d3)+_0x5657c5+')'),lastActions[_0x310295(0x1c7)+_0xd6ea4e[_0x310295(0x1aa)]]=_0x1b87ff);}}}}}}}catch(_0x5c4fd3){_0x2e1a4a[_0x310295(0x22c)][_0x310295(0x199)](_0x310295(0x193)+_0x5c4fd3[_0x310295(0x1c1)]);}}async function manageMpcIntervention(_0xda118,_0xa2838b,_0x4c23da){const _0x16d56e=a1_0x52d53c;try{const _0x1ff707='analysis.energy.mpcActiveInterventions',_0x40822e=await _0xda118[_0x16d56e(0x1a1)](_0x1ff707);let _0x2a497d=[];if(_0x40822e&&_0x40822e[_0x16d56e(0x1bd)])try{_0x2a497d=JSON[_0x16d56e(0x1e7)](_0x40822e[_0x16d56e(0x1bd)]);}catch(_0x20fe7e){}const _0x410329=_0x2a497d[_0x16d56e(0x208)](_0xa2838b);if(_0x4c23da===_0x16d56e(0x219))_0x410329===-0x1&&(_0x2a497d[_0x16d56e(0x216)](_0xa2838b),await _0xda118[_0x16d56e(0x206)](_0x1ff707,{'val':JSON[_0x16d56e(0x23b)](_0x2a497d),'ack':!![]}));else _0x4c23da===_0x16d56e(0x1c5)&&(_0x410329!==-0x1&&(_0x2a497d[_0x16d56e(0x23e)](_0x410329,0x1),await _0xda118[_0x16d56e(0x206)](_0x1ff707,{'val':JSON[_0x16d56e(0x23b)](_0x2a497d),'ack':!![]})));}catch(_0x833436){}}async function cleanupGhostInterventions(_0x20a5a4){const _0x2d673e=a1_0x52d53c;try{const _0x12e118='analysis.energy.mpcActiveInterventions',_0xbd3806=await _0x20a5a4['getStateAsync'](_0x12e118);if(!_0xbd3806||!_0xbd3806[_0x2d673e(0x1bd)])return;const _0xe5ebb4=JSON[_0x2d673e(0x1e7)](_0xbd3806['val']);if(!Array[_0x2d673e(0x211)](_0xe5ebb4)||_0xe5ebb4[_0x2d673e(0x1dc)]===0x0)return;let _0x14b48e={'default':0x15};try{const _0x3a5dfb=await _0x20a5a4['getStateAsync']('analysis.energy.warmupTargets');if(_0x3a5dfb&&_0x3a5dfb[_0x2d673e(0x1bd)])_0x14b48e=JSON[_0x2d673e(0x1e7)](_0x3a5dfb[_0x2d673e(0x1bd)]);}catch(_0x63920d){}let _0x393e1b=[];try{const _0x55d7d5=await _0x20a5a4[_0x2d673e(0x1a1)](_0x2d673e(0x1ab));if(_0x55d7d5&&_0x55d7d5[_0x2d673e(0x1bd)])_0x393e1b=JSON[_0x2d673e(0x1e7)](_0x55d7d5[_0x2d673e(0x1bd)]);}catch(_0x284522){}const _0x35ec97=_0x20a5a4[_0x2d673e(0x1b3)][_0x2d673e(0x19d)]||[];let _0x4fe139=![];for(let _0x23f65d=_0xe5ebb4['length']-0x1;_0x23f65d>=0x0;_0x23f65d--){const _0x56e004=_0xe5ebb4[_0x23f65d],_0x202ee4=_0x35ec97[_0x2d673e(0x201)](_0x2b1839=>normalize(_0x2b1839[_0x2d673e(0x1aa)])===normalize(_0x56e004)&&(_0x2b1839[_0x2d673e(0x1fa)]===_0x2d673e(0x224)||_0x2b1839[_0x2d673e(0x1fa)]===_0x2d673e(0x1a5)));if(!_0x202ee4){_0x20a5a4[_0x2d673e(0x22c)]['warn']('ðŸ§¹\x20[MPC\x20CLEANUP]\x20Raum\x20\x27'+_0x56e004+_0x2d673e(0x19e)),_0xe5ebb4[_0x2d673e(0x23e)](_0x23f65d,0x1),_0x4fe139=!![];continue;}if(_0x202ee4){const _0x553671=await findRelatedId(_0x20a5a4,_0x202ee4['id'],_0x2d673e(0x21a)),_0x549c55=await _0x20a5a4[_0x2d673e(0x21d)](_0x202ee4['id']);if(_0x553671){const _0x5d9e2f=await _0x20a5a4[_0x2d673e(0x21d)](_0x553671);if(_0x5d9e2f&&typeof _0x5d9e2f[_0x2d673e(0x1bd)]==='number'){let _0x1ad9de=![],_0x2e7538='';Math[_0x2d673e(0x194)](_0x5d9e2f[_0x2d673e(0x1bd)]-ECO_TEMP)>0.5&&(_0x1ad9de=!![],_0x2e7538='manual');if(!_0x1ad9de&&_0x549c55&&typeof _0x549c55['val']===_0x2d673e(0x1cf)){const _0x288b9b=_0x14b48e[_0x56e004]||_0x14b48e[_0x2d673e(0x236)]||0x15;_0x549c55[_0x2d673e(0x1bd)]<_0x288b9b+0.2&&(_0x1ad9de=!![],_0x2e7538=_0x2d673e(0x1a7));}if(_0x1ad9de){if(_0x2e7538===_0x2d673e(0x1ac)){_0x20a5a4[_0x2d673e(0x22c)]['info']('ðŸ§¹\x20[MPC\x20CLEANUP]\x20'+_0x56e004+_0x2d673e(0x234)+_0x5d9e2f[_0x2d673e(0x1bd)]+_0x2d673e(0x23c)+ECO_TEMP+_0x2d673e(0x1fc));const _0x3ff454=lastActions['cal_'+_0x56e004],_0x56c46c=_0x3ff454&&Date['now']()-_0x3ff454<0x2*0x3c*0x3e8;if(!_0x56c46c&&_0x5d9e2f['val']>ECO_TEMP+0.5)_0x20a5a4[_0x2d673e(0x215)]&&(_0x20a5a4['log'][_0x2d673e(0x243)](_0x2d673e(0x222)+_0x56e004+_0x2d673e(0x1db)),_0x20a5a4['sendToPythonWrapper'](_0x2d673e(0x1b1),{'room':_0x56e004}));else _0x56c46c&&_0x20a5a4['log']['info']('ðŸ“…\x20[MPC\x20INFO]\x20'+_0x56e004+_0x2d673e(0x22e));}else{if(_0x2e7538===_0x2d673e(0x1a7)){let _0x3e035b=![];if(_0x393e1b['find'](_0x8454d=>_0x8454d[_0x2d673e(0x237)]===_0x56e004))_0x3e035b=!![];const _0x5ba68c=_0x35ec97[_0x2d673e(0x1a8)](_0x445c79=>normalize(_0x445c79[_0x2d673e(0x1aa)])===normalize(_0x56e004)&&(_0x445c79[_0x2d673e(0x1fa)]===_0x2d673e(0x20d)||_0x445c79[_0x2d673e(0x1fa)]==='sensor'||_0x445c79['type']===_0x2d673e(0x1df)));for(const _0x429d61 of _0x5ba68c){try{const _0x282ab3=await _0x20a5a4['getForeignStateAsync'](_0x429d61['id']);if(_0x282ab3&&(_0x282ab3[_0x2d673e(0x1bd)]===!![]||_0x282ab3[_0x2d673e(0x1bd)]===0x1||String(_0x282ab3[_0x2d673e(0x1bd)])[_0x2d673e(0x20c)]()===_0x2d673e(0x1ad)))_0x3e035b=!![];}catch(_0x54c4a5){}}if(_0x3e035b)_0x20a5a4[_0x2d673e(0x22c)][_0x2d673e(0x243)]('ðŸŒ¬ï¸\x20[MPC\x20WATCHDOG]\x20'+_0x56e004+'\x20ist\x20zu\x20kalt,\x20ABER\x20Fenster\x20offen/LÃ¼ftung\x20erkannt.\x20Heize\x20NICHT,\x20entferne\x20nur\x20Status.');else{const _0x1bd5ff=_0x14b48e[_0x56e004]||_0x14b48e[_0x2d673e(0x236)]||0x15;_0x20a5a4[_0x2d673e(0x22c)][_0x2d673e(0x243)](_0x2d673e(0x1bb)+_0x56e004+_0x2d673e(0x1b0)+_0x549c55[_0x2d673e(0x1bd)]+_0x2d673e(0x214)+(_0x1bd5ff+0.2)+_0x2d673e(0x198)),await _0x20a5a4[_0x2d673e(0x1b8)](_0x553671,_0x1bd5ff),await logAutomationAction(_0x20a5a4,_0x2d673e(0x229)+_0x56e004+':\x20Puffer\x20leer\x20->\x20Heizen\x20auf\x20'+_0x1bd5ff+'Â°C'),lastActions['rescue_'+_0x56e004]=Date[_0x2d673e(0x1b9)]();}}}_0xe5ebb4[_0x2d673e(0x23e)](_0x23f65d,0x1),_0x4fe139=!![];}}}}}_0x4fe139&&await _0x20a5a4['setStateAsync'](_0x12e118,{'val':JSON[_0x2d673e(0x23b)](_0xe5ebb4),'ack':!![]});}catch(_0x44c695){}}function a1_0x2e14(_0x5849da,_0x20b800){const _0xdbf834=a1_0x8a30();return a1_0x2e14=function(_0x2f54cb,_0x42df62){_0x2f54cb=_0x2f54cb-0x18f;let _0x8a3051=_0xdbf834[_0x2f54cb];return _0x8a3051;},a1_0x2e14(_0x5849da,_0x20b800);}async function applyEnergySavings(_0xa58118,_0x30718e){const _0x3ce717=a1_0x52d53c;await cleanupGhostInterventions(_0xa58118);if(!_0x30718e||_0x30718e['length']===0x0)return;const _0x43a1c5=_0xa58118[_0x3ce717(0x1b3)]['devices']||[],_0x5d7159=Date[_0x3ce717(0x1b9)]();for(const _0x2c0225 of _0x30718e){const _0x28d20c=_0x2c0225[_0x3ce717(0x237)],_0x50b50f=_0x2c0225['minutes_safe'],_0x3ff0cd=_0x2c0225[_0x3ce717(0x203)]||0x15;if(lastActions[_0x3ce717(0x1c8)+_0x28d20c]&&_0x5d7159-lastActions['rescue_'+_0x28d20c]<RESCUE_LOCK_MS)continue;const _0x6476ea=_0x43a1c5[_0x3ce717(0x201)](_0x2de906=>normalize(_0x2de906[_0x3ce717(0x1aa)])===normalize(_0x28d20c)&&(_0x2de906[_0x3ce717(0x1fa)]===_0x3ce717(0x224)||_0x2de906[_0x3ce717(0x1fa)]===_0x3ce717(0x1a5)));if(!_0x6476ea)continue;const _0x3976c6=await findRelatedId(_0xa58118,_0x6476ea['id'],_0x3ce717(0x21a));if(_0x3976c6){if(lastActions[_0x3ce717(0x220)+_0x28d20c]&&_0x5d7159-lastActions[_0x3ce717(0x220)+_0x28d20c]<0x1e*0x3c*0x3e8)continue;const _0x2acff4=await _0xa58118[_0x3ce717(0x21d)](_0x3976c6);if(_0x2acff4&&typeof _0x2acff4[_0x3ce717(0x1bd)]===_0x3ce717(0x1cf)){const _0xe99fdc=_0x2acff4[_0x3ce717(0x1bd)];_0xe99fdc!==ECO_TEMP&&await manageMpcIntervention(_0xa58118,_0x28d20c,_0x3ce717(0x1c5));if(_0x50b50f>0x1e)_0xe99fdc>ECO_TEMP+0.5&&(_0xa58118['log'][_0x3ce717(0x243)](_0x3ce717(0x1a4)+_0x28d20c+_0x3ce717(0x1d0)+ECO_TEMP+'Â°C!\x20(Puffer:\x20'+_0x50b50f+_0x3ce717(0x20e)),await _0xa58118[_0x3ce717(0x1b8)](_0x3976c6,ECO_TEMP),await manageMpcIntervention(_0xa58118,_0x28d20c,_0x3ce717(0x219)),lastActions[_0x3ce717(0x220)+_0x28d20c]=_0x5d7159,await logAutomationAction(_0xa58118,'[MPC]\x20'+_0x28d20c+_0x3ce717(0x1eb)+ECO_TEMP+'Â°C'));else _0x50b50f<=0xf&&(_0xe99fdc<_0x3ff0cd&&(_0xa58118['log'][_0x3ce717(0x243)]('ðŸ”¥\x20[MPC\x20ACTION]\x20Heize\x20'+_0x28d20c+_0x3ce717(0x204)+_0x3ff0cd+_0x3ce717(0x1f7)),await _0xa58118[_0x3ce717(0x1b8)](_0x3976c6,_0x3ff0cd),await manageMpcIntervention(_0xa58118,_0x28d20c,_0x3ce717(0x1c5)),lastActions[_0x3ce717(0x220)+_0x28d20c]=_0x5d7159,await logAutomationAction(_0xa58118,_0x3ce717(0x1e0)+_0x28d20c+':\x20Aufheizen\x20auf\x20'+_0x3ff0cd+'Â°C')));}}else _0xa58118[_0x3ce717(0x22c)][_0x3ce717(0x199)](_0x3ce717(0x1be)+_0x28d20c+_0x3ce717(0x1d1));}}module['exports']={'handlePrediction':handlePrediction,'applyEnergySavings':applyEnergySavings,'scanThermostats':scanThermostats,'checkCalendarTriggers':checkCalendarTriggers,'updateSchedulePreview':updateSchedulePreview,'cleanupGhostInterventions':cleanupGhostInterventions};