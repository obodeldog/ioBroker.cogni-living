const a1_0x2d3e9d=a1_0x1ace;(function(_0x51779d,_0x528824){const _0x5c2edd=a1_0x1ace,_0x78104f=_0x51779d();while(!![]){try{const _0x16bab5=-parseInt(_0x5c2edd(0x1e7))/0x1+-parseInt(_0x5c2edd(0x265))/0x2*(-parseInt(_0x5c2edd(0x22a))/0x3)+-parseInt(_0x5c2edd(0x234))/0x4+parseInt(_0x5c2edd(0x1e3))/0x5+parseInt(_0x5c2edd(0x222))/0x6+-parseInt(_0x5c2edd(0x208))/0x7*(-parseInt(_0x5c2edd(0x1ef))/0x8)+-parseInt(_0x5c2edd(0x259))/0x9*(parseInt(_0x5c2edd(0x254))/0xa);if(_0x16bab5===_0x528824)break;else _0x78104f['push'](_0x78104f['shift']());}catch(_0x13bf4a){_0x78104f['push'](_0x78104f['shift']());}}}(a1_0x2c64,0xdf888));const a1_0x2f48b7=(function(){let _0x215b88=!![];return function(_0x1bb60d,_0x5a9157){const _0x826eed=_0x215b88?function(){const _0x395973=a1_0x1ace;if(_0x5a9157){const _0x45e283=_0x5a9157[_0x395973(0x27b)](_0x1bb60d,arguments);return _0x5a9157=null,_0x45e283;}}:function(){};return _0x215b88=![],_0x826eed;};}()),a1_0x28e60f=a1_0x2f48b7(this,function(){const _0x35ffee=a1_0x1ace;return a1_0x28e60f[_0x35ffee(0x23e)]()[_0x35ffee(0x22b)](_0x35ffee(0x260))['toString']()['constructor'](a1_0x28e60f)[_0x35ffee(0x22b)](_0x35ffee(0x260));});a1_0x28e60f();'use strict';const aiAgent=require(a1_0x2d3e9d(0x24d)),COOLDOWN_MS=0x3c*0x3e8,CAL_COOLDOWN_MS=0x5a*0x3c*0x3e8,RESCUE_LOCK_MS=0x78*0x3c*0x3e8,ECO_TEMP=0x11,lastActions={};function normalize(_0xc3284e){const _0x49e7f5=a1_0x2d3e9d;if(!_0xc3284e)return'';return _0xc3284e['toLowerCase']()['replace'](/\s+/g,'')[_0x49e7f5(0x270)]();}function a1_0x2c64(){const _0x155dd2=['info','_calName','normal','5572695EJzWJS','wert','Pr√§diktion:\x20','üå¨Ô∏è\x20[MPC\x20WATCHDOG]\x20','915610YNSMwZ','val','level.temperature','eventStart','r√ºckkehr','stellwert','common','stringify','8hjugiO','light','getTime','slice','current_heating_setpoint','analysis.automation.mode','soll','.1.TEMPERATURE','config','level','actual','write','mpc_','find','¬∞C\x20(via\x20','push','room','Nicht\x20gefunden','devices','valve','üö®\x20[MPC\x20WATCHDOG]\x20','üßπ\x20[MPC\x20CLEANUP]\x20','¬∞C).\x20Entferne\x20Status.','analysis.energy.warmupTargets','getForeignStateAsync','12088559NYlLiW','type','Soll','Unknown','analysis.energy.schedulePreview','SET_POINT_TEMPERATURE','calendarInstance','Calendar\x20Check\x20Error:\x20','\x20wieder\x20auf\x20','openknx','role','analysis.energy.warmupSources','¬∞C).\x20Sparmodus\x20beendet!','currentSystemMode','occupied_heating_setpoint','map','now','Unbekannt','name','\x20erreicht\x20Limit\x20(','includes','setForeignStateAsync','ACTUAL_TEMPERATURE','[MPC]\x20','message','indexOf','3439584kzyPYU','ACTUAL','splice','toUpperCase','temp',']:\x20Raum-Trigger\x20\x27','.data.table','entries','47241HPpkSG','search','window','length','.4.VALVE_STATE','getForeignObjectAsync','rescue_','_date','too_cold','.1.SET_POINT_TEMPERATURE','5091288fbhuGa','switch','analysis.energy.warmupTimes','üçÉ\x20[MPC\x20ACTION]\x20Senke\x20','minutes_safe','add','¬∞C\x20<\x20','values','analysis.energy.ventilationAlerts','unshift','toString','¬∞C\x20(Vorlauf:\x20','\x20min)','toLowerCase','getForeignObjectsAsync','reason','analysis.automation.lastAction','parse','temperature','sensor','.1.LEVEL','log','Ist','urlaub\x20ende','forEach','./ai_agent',':\x20Aufheizen\x20auf\x20','\x20auf\x20','unit','default','target','analysis.automation.actionLog','14430CwaDhZ','date','dimmer','.1.ACTUAL_TEMPERATURE','thermostat','7929frqhtZ','ankunft','\x20->\x20','valveMapping','thermostat.setpoint','useCalendar','filter','(((.+)+)+)+$','[MPC\x20WARNING]\x20Kein\x20Setpoint\x20f√ºr\x20','warn','join','triggerTime','122RRjWVv','hm-rpc',':\x20Puffer\x20leer\x20->\x20Heizen\x20auf\x20','contact','\x20min).','Fehlt','score','sendToPythonWrapper','calendarSelection','setpoint','messwert','trim','position','\x20->\x20Schalte\x20','üî•\x20[MPC\x20ACTION]\x20Heize\x20','üìÖ\x20[MPC\x20INFO]\x20','local_temperature','location','remove','.4.SET_TEMPERATURE','split','set','apply','state','event','\x20ist\x20auf\x20','üßπ\x20[MPC\x20CLEANUP]\x20Raum\x20\x27','approved','setStateAsync','\x27\x20hat\x20kein\x20Ger√§t\x20mehr.\x20L√∂sche\x20Eintrag.','cal_','from','\x27\x20aktiv.\x20Heize\x20auf\x20','thermostatMapping','Classic','¬∞C!\x20(Puffer:\x20','sort','\x20gefunden!','manual','Manuelles\x20Mapping','summary','analysis.energy.mpcActiveInterventions','isArray','getStateAsync','consultButler','üìÖ\x20SMART\x20SCHEDULE\x20(Phase):\x20\x27Globaler\x20Start\x27\x20erkannt.\x20Heize\x20Haus\x20auf\x20(Vorlauf:\x20','number','string'];a1_0x2c64=function(){return _0x155dd2;};return a1_0x2c64();}async function logAutomationAction(_0x17214b,_0x21acd9){const _0x54ef0e=a1_0x2d3e9d;await _0x17214b['setStateAsync'](_0x54ef0e(0x244),{'val':_0x21acd9,'ack':!![]});try{const _0x17a2ea=_0x54ef0e(0x253),_0xb4b202=await _0x17214b[_0x54ef0e(0x1db)](_0x17a2ea);let _0x44da39=[];if(_0xb4b202&&_0xb4b202['val'])try{_0x44da39=JSON['parse'](_0xb4b202[_0x54ef0e(0x1e8)]);}catch(_0x5e999f){}_0x44da39[_0x54ef0e(0x23d)]({'ts':Date[_0x54ef0e(0x218)](),'msg':_0x21acd9});if(_0x44da39[_0x54ef0e(0x22d)]>0x32)_0x44da39=_0x44da39[_0x54ef0e(0x1f2)](0x0,0x32);await _0x17214b[_0x54ef0e(0x281)](_0x17a2ea,{'val':JSON[_0x54ef0e(0x1ee)](_0x44da39),'ack':!![]});}catch(_0x451f5c){}}function a1_0x1ace(_0x197b4b,_0x379c45){const _0x3d237f=a1_0x2c64();return a1_0x1ace=function(_0x28e60f,_0x2f48b7){_0x28e60f=_0x28e60f-0x1d1;let _0x2c64c6=_0x3d237f[_0x28e60f];return _0x2c64c6;},a1_0x1ace(_0x197b4b,_0x379c45);}async function handlePrediction(_0x52821b,_0x5dc837,_0x3761e3){const _0x27aa2c=a1_0x2d3e9d;if(!_0x5dc837||_0x5dc837===_0x27aa2c(0x20b))return;let _0x123e86='off',_0x271e09=0.6;try{const _0x3940a0=await _0x52821b['getStateAsync'](_0x27aa2c(0x1f4));if(_0x3940a0&&_0x3940a0[_0x27aa2c(0x1e8)])_0x123e86=_0x3940a0[_0x27aa2c(0x1e8)];const _0x4226b6=await _0x52821b[_0x27aa2c(0x1db)]('analysis.automation.confidenceThreshold');if(_0x4226b6&&_0x4226b6[_0x27aa2c(0x1e8)])_0x271e09=_0x4226b6[_0x27aa2c(0x1e8)];}catch(_0x210154){}if(_0x123e86==='off'||_0x3761e3<_0x271e09)return;const _0x5df305=Date[_0x27aa2c(0x218)]();if(lastActions[_0x5dc837]&&_0x5df305-lastActions[_0x5dc837]<COOLDOWN_MS)return;const _0x125808=_0x52821b[_0x27aa2c(0x1f7)][_0x27aa2c(0x201)]||[],_0x488014=normalize(_0x5dc837),_0x4e770d=_0x125808['find'](_0x475223=>normalize(_0x475223[_0x27aa2c(0x276)])===_0x488014&&(_0x475223[_0x27aa2c(0x209)]===_0x27aa2c(0x1f0)||_0x475223[_0x27aa2c(0x209)]===_0x27aa2c(0x256)||_0x475223['type']===_0x27aa2c(0x235)));if(!_0x4e770d)return;const _0x299411=await aiAgent[_0x27aa2c(0x1dc)](_0x52821b,_0x5dc837,_0x4e770d['name'],_0x3761e3);if(!_0x299411[_0x27aa2c(0x280)])return;const _0x3a0bb1=_0x27aa2c(0x1e5)+_0x5dc837+_0x27aa2c(0x272)+_0x4e770d[_0x27aa2c(0x21a)]+'\x20('+_0x299411[_0x27aa2c(0x243)]+')';await logAutomationAction(_0x52821b,'['+_0x123e86[_0x27aa2c(0x225)]()+']\x20'+_0x3a0bb1);if(_0x123e86==='active'){const _0x490e1d=await _0x52821b[_0x27aa2c(0x207)](_0x4e770d['id']);(!_0x490e1d||!_0x490e1d[_0x27aa2c(0x1e8)]&&_0x490e1d[_0x27aa2c(0x1e8)]!==!![])&&await _0x52821b[_0x27aa2c(0x21d)](_0x4e770d['id'],!![]),lastActions[_0x5dc837]=_0x5df305;}}async function findRelatedId(_0x23556f,_0x4861ca,_0x409656='setpoint'){const _0x2bf3ee=a1_0x2d3e9d;if(_0x409656===_0x2bf3ee(0x26e)&&_0x23556f[_0x2bf3ee(0x1f7)]['thermostatMapping']){let _0x9f0441=_0x23556f[_0x2bf3ee(0x1f7)][_0x2bf3ee(0x1d1)];if(typeof _0x9f0441===_0x2bf3ee(0x1df))try{_0x9f0441=JSON[_0x2bf3ee(0x245)](_0x9f0441);}catch(_0x1a36b4){}if(_0x9f0441&&_0x9f0441[_0x4861ca])return _0x9f0441[_0x4861ca];}if(_0x409656===_0x2bf3ee(0x202)&&_0x23556f[_0x2bf3ee(0x1f7)]['valveMapping']){let _0x90a87=_0x23556f[_0x2bf3ee(0x1f7)][_0x2bf3ee(0x25c)];if(typeof _0x90a87===_0x2bf3ee(0x1df))try{_0x90a87=JSON[_0x2bf3ee(0x245)](_0x90a87);}catch(_0x583505){}if(_0x90a87&&_0x90a87[_0x4861ca])return _0x90a87[_0x4861ca];}let _0x136c1c=[];if(_0x409656===_0x2bf3ee(0x26e))_0x136c1c=[{'s':'.1.ACTUAL_TEMPERATURE','t':_0x2bf3ee(0x233)},{'s':'.1.TEMPERATURE','t':_0x2bf3ee(0x233)},{'s':_0x2bf3ee(0x1f6),'t':_0x2bf3ee(0x278)},{'s':_0x2bf3ee(0x21e),'t':_0x2bf3ee(0x20d)},{'s':_0x2bf3ee(0x275),'t':_0x2bf3ee(0x216)},{'s':_0x2bf3ee(0x275),'t':_0x2bf3ee(0x1f3)},{'s':_0x2bf3ee(0x246),'t':'target_temperature'},{'s':_0x2bf3ee(0x223),'t':'SET'},{'s':_0x2bf3ee(0x24a),'t':_0x2bf3ee(0x20a)},{'s':_0x2bf3ee(0x246),'t':_0x2bf3ee(0x26e)}];else _0x409656===_0x2bf3ee(0x202)&&(_0x136c1c=[{'s':_0x2bf3ee(0x257),'t':_0x2bf3ee(0x248)},{'s':'.1.TEMPERATURE','t':_0x2bf3ee(0x248)},{'s':_0x2bf3ee(0x1f6),'t':_0x2bf3ee(0x22e)},{'s':_0x2bf3ee(0x275),'t':'pi_heating_demand'},{'s':_0x2bf3ee(0x246),'t':'valve_position'},{'s':_0x2bf3ee(0x246),'t':_0x2bf3ee(0x1f8)}]);for(const _0x3921ca of _0x136c1c){if(_0x4861ca[_0x2bf3ee(0x21c)](_0x3921ca['s'])){const _0x1a5744=_0x4861ca['replace'](_0x3921ca['s'],_0x3921ca['t']),_0x20af02=await _0x23556f[_0x2bf3ee(0x22f)](_0x1a5744);if(_0x20af02)return _0x1a5744;}}try{const _0x24dfe7=_0x4861ca[_0x2bf3ee(0x279)]('.');if(_0x24dfe7[_0x2bf3ee(0x22d)]>0x2){const _0x1352f3=_0x24dfe7[_0x2bf3ee(0x1f2)](0x0,-0x1)[_0x2bf3ee(0x263)]('.'),_0x31ed1e=await _0x23556f[_0x2bf3ee(0x242)](_0x1352f3+'.*'),_0x5d0351=[],_0x1e366a=_0x4861ca[_0x2bf3ee(0x279)](/[._]+/)[_0x2bf3ee(0x25f)](_0x34beab=>![_0x2bf3ee(0x211),'0',_0x2bf3ee(0x266),'ist',_0x2bf3ee(0x1e4),'temperature',_0x2bf3ee(0x1f9),_0x2bf3ee(0x247),_0x2bf3ee(0x26f),_0x2bf3ee(0x27c)]['includes'](_0x34beab[_0x2bf3ee(0x241)]()));for(const [_0x570a23,_0x1ce4d2]of Object[_0x2bf3ee(0x229)](_0x31ed1e)){if(_0x570a23===_0x4861ca)continue;if(_0x1ce4d2&&_0x1ce4d2['common']){const _0x13e161=_0x570a23['toLowerCase'](),_0x231e35=(_0x1ce4d2[_0x2bf3ee(0x1ed)][_0x2bf3ee(0x212)]||'')[_0x2bf3ee(0x241)](),_0x259e33=(_0x1ce4d2[_0x2bf3ee(0x1ed)][_0x2bf3ee(0x250)]||'')[_0x2bf3ee(0x241)]();let _0xf16ad8=![];if(_0x409656==='setpoint'&&_0x1ce4d2[_0x2bf3ee(0x1ed)][_0x2bf3ee(0x1fa)]===!![])_0xf16ad8=_0x13e161[_0x2bf3ee(0x21c)](_0x2bf3ee(0x27a))||_0x13e161[_0x2bf3ee(0x21c)](_0x2bf3ee(0x1f5))||_0x13e161[_0x2bf3ee(0x21c)]('target')||_0x231e35[_0x2bf3ee(0x21c)](_0x2bf3ee(0x1e9))||_0x231e35[_0x2bf3ee(0x21c)](_0x2bf3ee(0x25d));else _0x409656===_0x2bf3ee(0x202)&&(_0xf16ad8=_0x13e161[_0x2bf3ee(0x21c)](_0x2bf3ee(0x1f8))||_0x13e161['includes']('valve')||_0x13e161[_0x2bf3ee(0x21c)](_0x2bf3ee(0x1ec))||_0x13e161['includes'](_0x2bf3ee(0x271))||_0x231e35['includes']('level.valve')||_0x231e35['includes']('value.valve')||_0x259e33['includes']('%'));if(_0xf16ad8){const _0x19590b=_0x570a23[_0x2bf3ee(0x279)](/[._]+/)[_0x2bf3ee(0x217)](_0x18cd7f=>_0x18cd7f['toLowerCase']());let _0x4b72f=0x0;_0x1e366a['forEach'](_0x6f4a6b=>{const _0x59bab8=_0x2bf3ee;if(_0x19590b[_0x59bab8(0x21c)](_0x6f4a6b['toLowerCase']()))_0x4b72f++;}),_0x5d0351['push']({'id':_0x570a23,'score':_0x4b72f});}}}if(_0x5d0351[_0x2bf3ee(0x22d)]>0x0){_0x5d0351[_0x2bf3ee(0x1d4)]((_0x4c92ac,_0xf47e3e)=>_0xf47e3e[_0x2bf3ee(0x26b)]-_0x4c92ac[_0x2bf3ee(0x26b)]);if(_0x5d0351[0x0][_0x2bf3ee(0x26b)]>0x0)return _0x5d0351[0x0]['id'];}}}catch(_0x168a15){}return null;}async function scanThermostats(_0x58baee){const _0x33007e=a1_0x2d3e9d,_0x3f2b2a=_0x58baee[_0x33007e(0x1f7)]['devices']||[],_0xe1ad9=[],_0x26c543=_0x3f2b2a[_0x33007e(0x25f)](_0x2f0b6c=>_0x2f0b6c['id']&&_0x2f0b6c['id'][_0x33007e(0x21c)](_0x33007e(0x246))||_0x2f0b6c['type']&&[_0x33007e(0x246),_0x33007e(0x258),_0x33007e(0x247)][_0x33007e(0x21c)](_0x2f0b6c[_0x33007e(0x209)])||_0x2f0b6c[_0x33007e(0x21a)]&&_0x2f0b6c['name']['toLowerCase']()[_0x33007e(0x21c)](_0x33007e(0x226)));for(const _0xc0dd64 of _0x26c543){const _0x37ccb1=await findRelatedId(_0x58baee,_0xc0dd64['id'],'setpoint'),_0x3a8ce1=await findRelatedId(_0x58baee,_0xc0dd64['id'],_0x33007e(0x202));let _0x39c3b8=_0x33007e(0x200),_0x44208c=![],_0x2eaa24=_0x58baee[_0x33007e(0x1f7)][_0x33007e(0x1d1)]||{};if(typeof _0x2eaa24===_0x33007e(0x1df))try{_0x2eaa24=JSON[_0x33007e(0x245)](_0x2eaa24);}catch(_0x32e63c){}let _0x162ac6=_0x58baee[_0x33007e(0x1f7)][_0x33007e(0x25c)]||{};if(typeof _0x162ac6===_0x33007e(0x1df))try{_0x162ac6=JSON[_0x33007e(0x245)](_0x162ac6);}catch(_0x126787){}if(_0x2eaa24[_0xc0dd64['id']]&&_0x2eaa24[_0xc0dd64['id']]===_0x37ccb1||_0x162ac6[_0xc0dd64['id']]&&_0x162ac6[_0xc0dd64['id']]===_0x3a8ce1)_0x39c3b8=_0x33007e(0x1d7),_0x44208c=!![];else(_0x37ccb1||_0x3a8ce1)&&(_0x39c3b8='Auto-Erkennung');_0xe1ad9[_0x33007e(0x1fe)]({'room':_0xc0dd64[_0x33007e(0x276)]||_0x33007e(0x219),'sensorId':_0xc0dd64['id'],'setpointId':_0x37ccb1||'-','valveId':_0x3a8ce1||'-','source':_0x39c3b8,'isManual':_0x44208c,'status':_0x37ccb1&&_0x3a8ce1?'PERFECT':_0x37ccb1?'OK':_0x33007e(0x26a)});}return _0xe1ad9['sort']((_0x3ad04e,_0x38e347)=>_0x3ad04e[_0x33007e(0x1ff)]['localeCompare'](_0x38e347['room']));}async function updateSchedulePreview(_0x5885b6){const _0x375f1e=a1_0x2d3e9d;if(!_0x5885b6[_0x375f1e(0x1f7)][_0x375f1e(0x25e)]||!_0x5885b6[_0x375f1e(0x1f7)][_0x375f1e(0x20e)])return;let _0x3a7950={};try{const _0x11d306=await _0x5885b6['getStateAsync'](_0x375f1e(0x236));if(_0x11d306&&_0x11d306[_0x375f1e(0x1e8)])_0x3a7950=JSON[_0x375f1e(0x245)](_0x11d306[_0x375f1e(0x1e8)]);}catch(_0x4927d2){}const _0x48773a=[],_0x516ae2=Date[_0x375f1e(0x218)](),_0x5930b4=0x30*0x3c*0x3c*0x3e8;try{const _0x230063=await _0x5885b6[_0x375f1e(0x207)](_0x5885b6['config'][_0x375f1e(0x20e)]+_0x375f1e(0x228));if(!_0x230063||!_0x230063[_0x375f1e(0x1e8)])return;const _0x24f872=JSON[_0x375f1e(0x245)](_0x230063['val']),_0x8a8cb=_0x5885b6[_0x375f1e(0x1f7)][_0x375f1e(0x26d)]||[],_0x512d0b=_0x5885b6[_0x375f1e(0x1f7)][_0x375f1e(0x201)]||[],_0x40c26d=new Set();_0x512d0b[_0x375f1e(0x24c)](_0x15555f=>{const _0x8694e=_0x375f1e;if(_0x15555f['location'])_0x40c26d[_0x8694e(0x239)](_0x15555f['location']);});for(const _0x23dbc8 of _0x24f872){if(_0x23dbc8['_calName']&&_0x8a8cb['length']>0x0&&!_0x8a8cb[_0x375f1e(0x21c)](_0x23dbc8[_0x375f1e(0x1e1)]))continue;const _0x517d16=_0x23dbc8['_date']||_0x23dbc8[_0x375f1e(0x1ea)]||_0x23dbc8['date'];if(!_0x517d16)continue;const _0xe1031=new Date(_0x517d16),_0x7c036a=_0xe1031[_0x375f1e(0x1f1)]();if(isNaN(_0x7c036a))continue;if(_0x7c036a<_0x516ae2)continue;if(_0x7c036a>_0x516ae2+_0x5930b4)continue;const _0x48f73a=(_0x23dbc8[_0x375f1e(0x27d)]||_0x23dbc8[_0x375f1e(0x1d8)]||'')[_0x375f1e(0x241)]();let _0x472542=![],_0x4b933d=[],_0x419484=_0x23dbc8[_0x375f1e(0x27d)]||_0x23dbc8[_0x375f1e(0x1d8)]||_0x375f1e(0x219);if(_0x48f73a[_0x375f1e(0x21c)](_0x375f1e(0x24b))||_0x48f73a[_0x375f1e(0x21c)](_0x375f1e(0x1eb))||_0x48f73a[_0x375f1e(0x21c)](_0x375f1e(0x25a)))_0x472542=!![],_0x4b933d=Array[_0x375f1e(0x284)](_0x40c26d);else for(const _0x4643ce of _0x40c26d){if(_0x48f73a['includes'](_0x4643ce[_0x375f1e(0x241)]()))_0x4b933d['push'](_0x4643ce);}_0x4b933d['length']>0x0&&_0x4b933d[_0x375f1e(0x24c)](_0x2cfea2=>{const _0x4858f1=_0x375f1e;let _0x487750=0x3c;if(_0x472542){let _0x2c3f80=0x0;Object[_0x4858f1(0x23b)](_0x3a7950)['forEach'](_0x6aaf29=>{if(_0x6aaf29>_0x2c3f80)_0x2c3f80=_0x6aaf29;}),_0x487750=_0x2c3f80>0x0?_0x2c3f80:0x78;}else _0x487750=_0x3a7950[_0x2cfea2]||0x3c;const _0x3f10a2=new Date(_0x7c036a-_0x487750*0xea60);_0x48773a['push']({'eventTime':_0x7c036a,'triggerTime':_0x3f10a2[_0x4858f1(0x1f1)](),'room':_0x2cfea2,'minutes':_0x487750,'reason':_0x419484,'isGlobal':_0x472542});});}}catch(_0x2f18b3){}_0x48773a[_0x375f1e(0x1d4)]((_0x544ceb,_0x4a2887)=>_0x544ceb[_0x375f1e(0x264)]-_0x4a2887['triggerTime']);const _0x55ac09=_0x48773a['slice'](0x0,0x5);await _0x5885b6[_0x375f1e(0x281)](_0x375f1e(0x20c),{'val':JSON['stringify'](_0x55ac09),'ack':!![]});}async function checkCalendarTriggers(_0x3d5090){const _0xc6091=a1_0x2d3e9d;if(!_0x3d5090[_0xc6091(0x1f7)][_0xc6091(0x25e)]||!_0x3d5090[_0xc6091(0x1f7)][_0xc6091(0x20e)])return;await updateSchedulePreview(_0x3d5090);let _0x57b4d8={},_0x1db70e={};try{const _0x5cc523=await _0x3d5090[_0xc6091(0x1db)]('analysis.energy.warmupTimes');if(_0x5cc523&&_0x5cc523[_0xc6091(0x1e8)])_0x57b4d8=JSON[_0xc6091(0x245)](_0x5cc523['val']);const _0x8ba330=await _0x3d5090[_0xc6091(0x1db)](_0xc6091(0x213));if(_0x8ba330&&_0x8ba330[_0xc6091(0x1e8)])_0x1db70e=JSON[_0xc6091(0x245)](_0x8ba330[_0xc6091(0x1e8)]);}catch(_0x3a23b6){}let _0x547486={'default':0x15};try{const _0x52a1ad=await _0x3d5090[_0xc6091(0x1db)](_0xc6091(0x206));if(_0x52a1ad&&_0x52a1ad[_0xc6091(0x1e8)])_0x547486=JSON[_0xc6091(0x245)](_0x52a1ad[_0xc6091(0x1e8)]);}catch(_0x2c64fb){}try{const _0x113c62=await _0x3d5090[_0xc6091(0x207)](_0x3d5090[_0xc6091(0x1f7)][_0xc6091(0x20e)]+_0xc6091(0x228));if(!_0x113c62||!_0x113c62[_0xc6091(0x1e8)])return;const _0x22663b=JSON[_0xc6091(0x245)](_0x113c62[_0xc6091(0x1e8)]),_0x2e221f=Date[_0xc6091(0x218)](),_0x5d8025=_0x3d5090['config']['devices']||[],_0x3a4ca6=_0x3d5090['config']['calendarSelection']||[];for(const _0x37a058 of _0x22663b){if(_0x37a058['_calName']&&_0x3a4ca6[_0xc6091(0x22d)]>0x0&&!_0x3a4ca6['includes'](_0x37a058[_0xc6091(0x1e1)]))continue;const _0x58529f=_0x37a058[_0xc6091(0x231)]||_0x37a058[_0xc6091(0x1ea)]||_0x37a058[_0xc6091(0x255)];if(!_0x58529f)continue;const _0x3b84e6=new Date(_0x58529f);if(isNaN(_0x3b84e6[_0xc6091(0x1f1)]()))continue;const _0x3f1f26=(_0x37a058[_0xc6091(0x27d)]||_0x37a058[_0xc6091(0x1d8)]||'')['toLowerCase']();if(_0x3f1f26[_0xc6091(0x21c)](_0xc6091(0x24b))||_0x3f1f26[_0xc6091(0x21c)](_0xc6091(0x1eb))||_0x3f1f26[_0xc6091(0x21c)](_0xc6091(0x25a))){let _0x7c8e6e=0x0;Object['values'](_0x57b4d8)[_0xc6091(0x24c)](_0xb82b3c=>{if(_0xb82b3c>_0x7c8e6e)_0x7c8e6e=_0xb82b3c;});if(_0x7c8e6e===0x0)_0x7c8e6e=0x78;const _0x44a59b=_0x3b84e6[_0xc6091(0x1f1)]()-_0x7c8e6e*0xea60;_0x2e221f>=_0x44a59b&&_0x2e221f<_0x3b84e6['getTime']()&&(_0x3d5090[_0xc6091(0x215)]!==_0xc6091(0x1e2)&&(_0x3d5090[_0xc6091(0x249)][_0xc6091(0x1e0)](_0xc6091(0x1dd)+_0x7c8e6e+_0xc6091(0x269)),await _0x3d5090[_0xc6091(0x281)]('system.mode',{'val':_0xc6091(0x1e2),'ack':![]})));}for(const _0x34efe3 of _0x5d8025){if(_0x34efe3['location']){const _0x16fdbe=_0x34efe3['location'][_0xc6091(0x241)]();if(_0x3f1f26[_0xc6091(0x21c)](_0x16fdbe)){const _0x463bd1=_0x57b4d8[_0x34efe3['location']]||0x3c,_0xa62034=_0x1db70e[_0x34efe3[_0xc6091(0x276)]]||_0xc6091(0x1d2),_0x3b5440=_0x3b84e6[_0xc6091(0x1f1)]()-_0x463bd1*0xea60;if(_0x2e221f>=_0x3b5440&&_0x2e221f<_0x3b84e6[_0xc6091(0x1f1)]()){const _0x1b7037=lastActions[_0xc6091(0x283)+_0x34efe3[_0xc6091(0x276)]];if(_0x1b7037&&_0x2e221f-_0x1b7037<CAL_COOLDOWN_MS)continue;const _0x477bb4=await findRelatedId(_0x3d5090,_0x34efe3['id'],_0xc6091(0x26e));if(_0x477bb4){let _0x556dbd=_0x547486[_0x34efe3[_0xc6091(0x276)]];if(_0x556dbd===undefined)_0x556dbd=_0x547486['default'];if(_0x556dbd===undefined)_0x556dbd=0x15;const _0x23be42=await _0x3d5090[_0xc6091(0x207)](_0x477bb4);_0x23be42&&typeof _0x23be42['val']===_0xc6091(0x1de)&&_0x23be42[_0xc6091(0x1e8)]<_0x556dbd-0.5&&(_0x3d5090[_0xc6091(0x249)][_0xc6091(0x1e0)]('üìÖ\x20SMART\x20SCHEDULE\x20['+_0xa62034+_0xc6091(0x227)+_0x34efe3[_0xc6091(0x276)]+_0xc6091(0x285)+_0x556dbd+_0xc6091(0x23f)+_0x463bd1+'\x20min).'),await _0x3d5090[_0xc6091(0x21d)](_0x477bb4,_0x556dbd),await logAutomationAction(_0x3d5090,'[CAL]\x20'+_0x34efe3[_0xc6091(0x276)]+_0xc6091(0x25b)+_0x556dbd+_0xc6091(0x1fd)+_0xa62034+')'),lastActions[_0xc6091(0x283)+_0x34efe3[_0xc6091(0x276)]]=_0x2e221f);}}}}}}}catch(_0x64e85c){_0x3d5090[_0xc6091(0x249)][_0xc6091(0x262)](_0xc6091(0x20f)+_0x64e85c[_0xc6091(0x220)]);}}async function manageMpcIntervention(_0x392d6a,_0x2a33fe,_0x4851b2){const _0x495319=a1_0x2d3e9d;try{const _0x377a50=_0x495319(0x1d9),_0xc9991e=await _0x392d6a['getStateAsync'](_0x377a50);let _0x411131=[];if(_0xc9991e&&_0xc9991e['val'])try{_0x411131=JSON['parse'](_0xc9991e[_0x495319(0x1e8)]);}catch(_0x5596eb){}const _0x55e591=_0x411131[_0x495319(0x221)](_0x2a33fe);if(_0x4851b2==='add')_0x55e591===-0x1&&(_0x411131[_0x495319(0x1fe)](_0x2a33fe),await _0x392d6a[_0x495319(0x281)](_0x377a50,{'val':JSON['stringify'](_0x411131),'ack':!![]}));else _0x4851b2==='remove'&&(_0x55e591!==-0x1&&(_0x411131[_0x495319(0x224)](_0x55e591,0x1),await _0x392d6a['setStateAsync'](_0x377a50,{'val':JSON[_0x495319(0x1ee)](_0x411131),'ack':!![]})));}catch(_0xd222cf){}}async function cleanupGhostInterventions(_0x213860){const _0x352af1=a1_0x2d3e9d;try{const _0x3d6492=_0x352af1(0x1d9),_0x53378a=await _0x213860[_0x352af1(0x1db)](_0x3d6492);if(!_0x53378a||!_0x53378a['val'])return;const _0x102939=JSON[_0x352af1(0x245)](_0x53378a['val']);if(!Array[_0x352af1(0x1da)](_0x102939)||_0x102939[_0x352af1(0x22d)]===0x0)return;let _0x2e4685={'default':0x15};try{const _0x5ba983=await _0x213860['getStateAsync']('analysis.energy.warmupTargets');if(_0x5ba983&&_0x5ba983[_0x352af1(0x1e8)])_0x2e4685=JSON[_0x352af1(0x245)](_0x5ba983[_0x352af1(0x1e8)]);}catch(_0x781037){}let _0x3e808d=[];try{const _0x3ea553=await _0x213860[_0x352af1(0x1db)](_0x352af1(0x23c));if(_0x3ea553&&_0x3ea553['val'])_0x3e808d=JSON['parse'](_0x3ea553['val']);}catch(_0x34b168){}const _0x2abe52=_0x213860[_0x352af1(0x1f7)][_0x352af1(0x201)]||[];let _0x471dfe=![];for(let _0x793e4f=_0x102939[_0x352af1(0x22d)]-0x1;_0x793e4f>=0x0;_0x793e4f--){const _0x5a9756=_0x102939[_0x793e4f],_0x3d8e56=_0x2abe52[_0x352af1(0x1fc)](_0x26652d=>normalize(_0x26652d[_0x352af1(0x276)])===normalize(_0x5a9756)&&(_0x26652d[_0x352af1(0x209)]===_0x352af1(0x246)||_0x26652d[_0x352af1(0x209)]==='thermostat'));if(!_0x3d8e56){_0x213860['log']['warn'](_0x352af1(0x27f)+_0x5a9756+_0x352af1(0x282)),_0x102939[_0x352af1(0x224)](_0x793e4f,0x1),_0x471dfe=!![];continue;}if(_0x3d8e56){const _0x21bb8b=await findRelatedId(_0x213860,_0x3d8e56['id'],'setpoint'),_0x28bd83=await _0x213860[_0x352af1(0x207)](_0x3d8e56['id']);if(_0x21bb8b){const _0x5a9438=await _0x213860[_0x352af1(0x207)](_0x21bb8b);if(_0x5a9438&&typeof _0x5a9438[_0x352af1(0x1e8)]===_0x352af1(0x1de)){let _0x54e890=![],_0x3146fd='';Math['abs'](_0x5a9438[_0x352af1(0x1e8)]-ECO_TEMP)>0.5&&(_0x54e890=!![],_0x3146fd=_0x352af1(0x1d6));if(!_0x54e890&&_0x28bd83&&typeof _0x28bd83[_0x352af1(0x1e8)]===_0x352af1(0x1de)){const _0x40455f=_0x2e4685[_0x5a9756]||_0x2e4685[_0x352af1(0x251)]||0x15;_0x28bd83['val']<_0x40455f+0.2&&(_0x54e890=!![],_0x3146fd=_0x352af1(0x232));}if(_0x54e890){if(_0x3146fd===_0x352af1(0x1d6)){_0x213860[_0x352af1(0x249)]['info'](_0x352af1(0x204)+_0x5a9756+_0x352af1(0x27e)+_0x5a9438['val']+'¬∞C\x20(nicht\x20'+ECO_TEMP+_0x352af1(0x205));const _0x338580=lastActions[_0x352af1(0x283)+_0x5a9756],_0x32963d=_0x338580&&Date[_0x352af1(0x218)]()-_0x338580<0x2*0x3c*0x3e8;if(!_0x32963d&&_0x5a9438[_0x352af1(0x1e8)]>ECO_TEMP+0.5)_0x213860[_0x352af1(0x26c)]&&(_0x213860[_0x352af1(0x249)]['info']('üéì\x20[RL-FEEDBACK]\x20Lerne\x20aus\x20Fehler:\x20'+_0x5a9756+'\x20wurde\x20manuell\x20erh√∂ht.'),_0x213860[_0x352af1(0x26c)]('TRAIN_RL_PENALTY',{'room':_0x5a9756}));else _0x32963d&&_0x213860[_0x352af1(0x249)][_0x352af1(0x1e0)](_0x352af1(0x274)+_0x5a9756+'\x20durch\x20Kalender\x20ge√§ndert.\x20Keine\x20RL-Strafe.');}else{if(_0x3146fd==='too_cold'){let _0x5c4606=![];if(_0x3e808d[_0x352af1(0x1fc)](_0xe12169=>_0xe12169[_0x352af1(0x1ff)]===_0x5a9756))_0x5c4606=!![];const _0x5c5b30=_0x2abe52[_0x352af1(0x25f)](_0x1e9c03=>normalize(_0x1e9c03['location'])===normalize(_0x5a9756)&&(_0x1e9c03[_0x352af1(0x209)]===_0x352af1(0x22c)||_0x1e9c03[_0x352af1(0x209)]===_0x352af1(0x247)||_0x1e9c03['type']===_0x352af1(0x268)));for(const _0x11fd77 of _0x5c5b30){try{const _0x397af5=await _0x213860['getForeignStateAsync'](_0x11fd77['id']);if(_0x397af5&&(_0x397af5['val']===!![]||_0x397af5['val']===0x1||String(_0x397af5['val'])[_0x352af1(0x241)]()==='open'))_0x5c4606=!![];}catch(_0x277627){}}if(_0x5c4606)_0x213860[_0x352af1(0x249)]['info'](_0x352af1(0x1e6)+_0x5a9756+'\x20ist\x20zu\x20kalt,\x20ABER\x20Fenster\x20offen/L√ºftung\x20erkannt.\x20Heize\x20NICHT,\x20entferne\x20nur\x20Status.');else{const _0x363170=_0x2e4685[_0x5a9756]||_0x2e4685[_0x352af1(0x251)]||0x15;_0x213860[_0x352af1(0x249)]['info'](_0x352af1(0x203)+_0x5a9756+_0x352af1(0x21b)+_0x28bd83[_0x352af1(0x1e8)]+_0x352af1(0x23a)+(_0x363170+0.2)+_0x352af1(0x214)),await _0x213860[_0x352af1(0x21d)](_0x21bb8b,_0x363170),await logAutomationAction(_0x213860,'[WATCHDOG]\x20'+_0x5a9756+_0x352af1(0x267)+_0x363170+'¬∞C'),lastActions[_0x352af1(0x230)+_0x5a9756]=Date[_0x352af1(0x218)]();}}}_0x102939[_0x352af1(0x224)](_0x793e4f,0x1),_0x471dfe=!![];}}}}}_0x471dfe&&await _0x213860[_0x352af1(0x281)](_0x3d6492,{'val':JSON[_0x352af1(0x1ee)](_0x102939),'ack':!![]});}catch(_0x362e41){}}async function applyEnergySavings(_0x5d01ca,_0x52cf60){const _0x2b9dbf=a1_0x2d3e9d;await cleanupGhostInterventions(_0x5d01ca);if(!_0x52cf60||_0x52cf60[_0x2b9dbf(0x22d)]===0x0)return;const _0x4dea4e=_0x5d01ca[_0x2b9dbf(0x1f7)][_0x2b9dbf(0x201)]||[],_0x929b0=Date['now']();for(const _0x1b5a8b of _0x52cf60){const _0x357bfe=_0x1b5a8b[_0x2b9dbf(0x1ff)],_0x2788ab=_0x1b5a8b[_0x2b9dbf(0x238)],_0x11fd7e=_0x1b5a8b[_0x2b9dbf(0x252)]||0x15;if(lastActions['rescue_'+_0x357bfe]&&_0x929b0-lastActions[_0x2b9dbf(0x230)+_0x357bfe]<RESCUE_LOCK_MS)continue;const _0x4212f2=_0x4dea4e[_0x2b9dbf(0x1fc)](_0x540b48=>normalize(_0x540b48['location'])===normalize(_0x357bfe)&&(_0x540b48['type']===_0x2b9dbf(0x246)||_0x540b48[_0x2b9dbf(0x209)]===_0x2b9dbf(0x258)));if(!_0x4212f2)continue;const _0x5258e6=await findRelatedId(_0x5d01ca,_0x4212f2['id'],_0x2b9dbf(0x26e));if(_0x5258e6){if(lastActions[_0x2b9dbf(0x1fb)+_0x357bfe]&&_0x929b0-lastActions[_0x2b9dbf(0x1fb)+_0x357bfe]<0x1e*0x3c*0x3e8)continue;const _0x50b271=await _0x5d01ca[_0x2b9dbf(0x207)](_0x5258e6);if(_0x50b271&&typeof _0x50b271[_0x2b9dbf(0x1e8)]==='number'){const _0x2bcfb0=_0x50b271['val'];_0x2bcfb0!==ECO_TEMP&&await manageMpcIntervention(_0x5d01ca,_0x357bfe,_0x2b9dbf(0x277));if(_0x2788ab>0x1e)_0x2bcfb0>ECO_TEMP+0.5&&(_0x5d01ca['log']['info'](_0x2b9dbf(0x237)+_0x357bfe+_0x2b9dbf(0x24f)+ECO_TEMP+_0x2b9dbf(0x1d3)+_0x2788ab+_0x2b9dbf(0x240)),await _0x5d01ca['setForeignStateAsync'](_0x5258e6,ECO_TEMP),await manageMpcIntervention(_0x5d01ca,_0x357bfe,_0x2b9dbf(0x239)),lastActions['mpc_'+_0x357bfe]=_0x929b0,await logAutomationAction(_0x5d01ca,_0x2b9dbf(0x21f)+_0x357bfe+':\x20Absenkung\x20auf\x20'+ECO_TEMP+'¬∞C'));else _0x2788ab<=0xf&&(_0x2bcfb0<_0x11fd7e&&(_0x5d01ca[_0x2b9dbf(0x249)][_0x2b9dbf(0x1e0)](_0x2b9dbf(0x273)+_0x357bfe+_0x2b9dbf(0x210)+_0x11fd7e+'¬∞C!\x20(Puffer\x20leer).'),await _0x5d01ca[_0x2b9dbf(0x21d)](_0x5258e6,_0x11fd7e),await manageMpcIntervention(_0x5d01ca,_0x357bfe,_0x2b9dbf(0x277)),lastActions[_0x2b9dbf(0x1fb)+_0x357bfe]=_0x929b0,await logAutomationAction(_0x5d01ca,_0x2b9dbf(0x21f)+_0x357bfe+_0x2b9dbf(0x24e)+_0x11fd7e+'¬∞C')));}}else _0x5d01ca[_0x2b9dbf(0x249)][_0x2b9dbf(0x262)](_0x2b9dbf(0x261)+_0x357bfe+_0x2b9dbf(0x1d5));}}module['exports']={'handlePrediction':handlePrediction,'applyEnergySavings':applyEnergySavings,'scanThermostats':scanThermostats,'checkCalendarTriggers':checkCalendarTriggers,'updateSchedulePreview':updateSchedulePreview,'cleanupGhostInterventions':cleanupGhostInterventions};