const a1_0x45dd71=a1_0x2297;(function(_0x102038,_0x51921a){const _0x205898=a1_0x2297,_0xd019a=_0x102038();while(!![]){try{const _0x2b0878=parseInt(_0x205898(0x1d9))/0x1+-parseInt(_0x205898(0x1dd))/0x2*(-parseInt(_0x205898(0x21e))/0x3)+-parseInt(_0x205898(0x1f4))/0x4*(-parseInt(_0x205898(0x1e7))/0x5)+-parseInt(_0x205898(0x203))/0x6+-parseInt(_0x205898(0x1db))/0x7*(-parseInt(_0x205898(0x249))/0x8)+-parseInt(_0x205898(0x1d3))/0x9*(parseInt(_0x205898(0x20e))/0xa)+-parseInt(_0x205898(0x1d5))/0xb;if(_0x2b0878===_0x51921a)break;else _0xd019a['push'](_0xd019a['shift']());}catch(_0x3e9713){_0xd019a['push'](_0xd019a['shift']());}}}(a1_0x4696,0xe7582));const a1_0x6f28ef=(function(){let _0x291944=!![];return function(_0x137d77,_0x469271){const _0x599f26=_0x291944?function(){if(_0x469271){const _0x5788af=_0x469271['apply'](_0x137d77,arguments);return _0x469271=null,_0x5788af;}}:function(){};return _0x291944=![],_0x599f26;};}()),a1_0x113ccf=a1_0x6f28ef(this,function(){const _0xe9ba7=a1_0x2297;return a1_0x113ccf[_0xe9ba7(0x237)]()[_0xe9ba7(0x1cc)](_0xe9ba7(0x1e9))['toString']()[_0xe9ba7(0x1c7)](a1_0x113ccf)['search']('(((.+)+)+)+$');});a1_0x113ccf();function a1_0x4696(){const _0x6a3658=['.4.VALVE_STATE','remove','toString','./ai_agent','\x20min)','useCalendar','wert','minutes_safe','location','room','level','_calName','\x20auf\x20','rescue_','trim','getStateAsync','\x20min).','light','¬∞C!\x20(Puffer:\x20','.1.LEVEL','8WLyGrI','unshift','stringify','eventStart','state','too_cold','config','filter','setForeignStateAsync','üìÖ\x20SMART\x20SCHEDULE\x20[','üßπ\x20[MPC\x20CLEANUP]\x20Raum\x20\x27','setStateAsync','from',':\x20Absenkung\x20auf\x20','triggerTime','thermostat.setpoint','default','stellwert','date','analysis.energy.ventilationAlerts','getForeignStateAsync','openknx','valve_position','valve','PERFECT','[MPC]\x20','urlaub\x20ende','add','\x20ist\x20zu\x20kalt,\x20ABER\x20Fenster\x20offen/L√ºftung\x20erkannt.\x20Heize\x20NICHT,\x20entferne\x20nur\x20Status.','current_heating_setpoint','.1.TEMPERATURE','find','level.temperature','.1.ACTUAL_TEMPERATURE','üö®\x20[MPC\x20WATCHDOG]\x20','calendarInstance','localeCompare','soll','toUpperCase','contact','temp','\x20->\x20','messwert','actual',':\x20Aufheizen\x20auf\x20','approved','valveMapping','üßπ\x20[MPC\x20CLEANUP]\x20','sendToPythonWrapper','active','local_temperature','mpc_','SET','\x20->\x20Schalte\x20','setpoint','constructor','isArray','parse','switch','warn','search','devices','¬∞C).\x20Entferne\x20Status.','.4.SET_TEMPERATURE','Classic','analysis.energy.schedulePreview','thermostatMapping','11034gRfPBB','toLowerCase','32663741ByabIk','[MPC\x20WARNING]\x20Kein\x20Setpoint\x20f√ºr\x20','info','analysis.automation.mode','1508310neefEK','consultButler','8531537iwdcRu','ACTUAL_TEMPERATURE','306DBPOeQ','analysis.automation.confidenceThreshold','analysis.energy.warmupTimes','Nicht\x20gefunden','temperature','manual','getForeignObjectsAsync','set','val','name','8555sCoJFW','replace','(((.+)+)+)+$','event','Calendar\x20Check\x20Error:\x20','analysis.energy.warmupTargets','Fehlt','[CAL]\x20','write','\x20ist\x20auf\x20','\x20gefunden!','log','\x20durch\x20Kalender\x20ge√§ndert.\x20Keine\x20RL-Strafe.','3480DIItQN','map','common','system.mode','¬∞C\x20(nicht\x20','ankunft','target_temperature','Ist','getTime','¬∞C!\x20(Puffer\x20leer).','_date','length','üéì\x20[RL-FEEDBACK]\x20Lerne\x20aus\x20Fehler:\x20','\x20erreicht\x20Limit\x20(','Manuelles\x20Mapping','9698850wqpgyt','includes','forEach','üìÖ\x20[MPC\x20INFO]\x20','message','exports','SET_POINT_TEMPERATURE','[WATCHDOG]\x20','¬∞C\x20<\x20','analysis.energy.mpcActiveInterventions','push','4430YDEVLs','\x27\x20aktiv.\x20Heize\x20auf\x20','window','Pr√§diktion:\x20','summary','now','sensor','.data.table','r√ºckkehr','TRAIN_RL_PENALTY','unit','score','thermostat','join','target','calendarSelection','36489iPWbqQ','type','level.valve','splice','values','analysis.energy.warmupSources','hm-rpc','normal','currentSystemMode','cal_','slice','sort','¬∞C\x20(Vorlauf:\x20','.1.SET_POINT_TEMPERATURE','\x27\x20hat\x20kein\x20Ger√§t\x20mehr.\x20L√∂sche\x20Eintrag.',']:\x20Raum-Trigger\x20\x27','ist','number','indexOf','off','üìÖ\x20SMART\x20SCHEDULE\x20(Phase):\x20\x27Globaler\x20Start\x27\x20erkannt.\x20Heize\x20Haus\x20auf\x20(Vorlauf:\x20','split','string'];a1_0x4696=function(){return _0x6a3658;};return a1_0x4696();}'use strict';function a1_0x2297(_0x5020d6,_0x27dfe4){const _0x24a3ad=a1_0x4696();return a1_0x2297=function(_0x113ccf,_0x6f28ef){_0x113ccf=_0x113ccf-0x1a5;let _0x469603=_0x24a3ad[_0x113ccf];return _0x469603;},a1_0x2297(_0x5020d6,_0x27dfe4);}const aiAgent=require(a1_0x45dd71(0x238)),COOLDOWN_MS=0x3c*0x3e8,CAL_COOLDOWN_MS=0x5a*0x3c*0x3e8,RESCUE_LOCK_MS=0x78*0x3c*0x3e8,ECO_TEMP=0x11,lastActions={};function normalize(_0x3e0d8c){const _0x1b4e3d=a1_0x45dd71;if(!_0x3e0d8c)return'';return _0x3e0d8c[_0x1b4e3d(0x1d4)]()['replace'](/\s+/g,'')[_0x1b4e3d(0x243)]();}async function logAutomationAction(_0x5b0333,_0x22f9e4){const _0x118b80=a1_0x45dd71;await _0x5b0333['setStateAsync']('analysis.automation.lastAction',{'val':_0x22f9e4,'ack':!![]});try{const _0x3b9bed='analysis.automation.actionLog',_0x17ebeb=await _0x5b0333[_0x118b80(0x244)](_0x3b9bed);let _0x52b7d5=[];if(_0x17ebeb&&_0x17ebeb[_0x118b80(0x1e5)])try{_0x52b7d5=JSON[_0x118b80(0x1c9)](_0x17ebeb['val']);}catch(_0x499bb0){}_0x52b7d5[_0x118b80(0x24a)]({'ts':Date[_0x118b80(0x213)](),'msg':_0x22f9e4});if(_0x52b7d5['length']>0x32)_0x52b7d5=_0x52b7d5[_0x118b80(0x228)](0x0,0x32);await _0x5b0333[_0x118b80(0x254)](_0x3b9bed,{'val':JSON[_0x118b80(0x24b)](_0x52b7d5),'ack':!![]});}catch(_0x3db9ce){}}async function handlePrediction(_0x4cf649,_0x2f7719,_0x54818d){const _0x2c5159=a1_0x45dd71;if(!_0x2f7719||_0x2f7719==='Unknown')return;let _0x234079=_0x2c5159(0x231),_0x217057=0.6;try{const _0x1d401a=await _0x4cf649[_0x2c5159(0x244)](_0x2c5159(0x1d8));if(_0x1d401a&&_0x1d401a['val'])_0x234079=_0x1d401a[_0x2c5159(0x1e5)];const _0x3d0e13=await _0x4cf649[_0x2c5159(0x244)](_0x2c5159(0x1de));if(_0x3d0e13&&_0x3d0e13[_0x2c5159(0x1e5)])_0x217057=_0x3d0e13[_0x2c5159(0x1e5)];}catch(_0x50c1e8){}if(_0x234079===_0x2c5159(0x231)||_0x54818d<_0x217057)return;const _0x55f631=Date[_0x2c5159(0x213)]();if(lastActions[_0x2f7719]&&_0x55f631-lastActions[_0x2f7719]<COOLDOWN_MS)return;const _0x4d40bf=_0x4cf649[_0x2c5159(0x24f)][_0x2c5159(0x1cd)]||[],_0x26ec2c=normalize(_0x2f7719),_0x48f49c=_0x4d40bf[_0x2c5159(0x1af)](_0x58ce1a=>normalize(_0x58ce1a['location'])===_0x26ec2c&&(_0x58ce1a['type']===_0x2c5159(0x246)||_0x58ce1a[_0x2c5159(0x21f)]==='dimmer'||_0x58ce1a[_0x2c5159(0x21f)]===_0x2c5159(0x1ca)));if(!_0x48f49c)return;const _0x2ad46e=await aiAgent[_0x2c5159(0x1da)](_0x4cf649,_0x2f7719,_0x48f49c[_0x2c5159(0x1e6)],_0x54818d);if(!_0x2ad46e[_0x2c5159(0x1bd)])return;const _0x27b0cc=_0x2c5159(0x211)+_0x2f7719+_0x2c5159(0x1c5)+_0x48f49c['name']+'\x20('+_0x2ad46e['reason']+')';await logAutomationAction(_0x4cf649,'['+_0x234079[_0x2c5159(0x1b6)]()+']\x20'+_0x27b0cc);if(_0x234079===_0x2c5159(0x1c1)){const _0x275c98=await _0x4cf649[_0x2c5159(0x25d)](_0x48f49c['id']);(!_0x275c98||!_0x275c98['val']&&_0x275c98[_0x2c5159(0x1e5)]!==!![])&&await _0x4cf649[_0x2c5159(0x251)](_0x48f49c['id'],!![]),lastActions[_0x2f7719]=_0x55f631;}}async function findRelatedId(_0x56957f,_0x5f30e8,_0x349494=a1_0x45dd71(0x1c6)){const _0xda4e17=a1_0x45dd71;if(_0x349494===_0xda4e17(0x1c6)&&_0x56957f['config'][_0xda4e17(0x1d2)]){let _0x1340af=_0x56957f[_0xda4e17(0x24f)][_0xda4e17(0x1d2)];if(typeof _0x1340af==='string')try{_0x1340af=JSON[_0xda4e17(0x1c9)](_0x1340af);}catch(_0xa6ad97){}if(_0x1340af&&_0x1340af[_0x5f30e8])return _0x1340af[_0x5f30e8];}if(_0x349494===_0xda4e17(0x1a7)&&_0x56957f[_0xda4e17(0x24f)][_0xda4e17(0x1be)]){let _0x3f7d11=_0x56957f[_0xda4e17(0x24f)][_0xda4e17(0x1be)];if(typeof _0x3f7d11===_0xda4e17(0x234))try{_0x3f7d11=JSON[_0xda4e17(0x1c9)](_0x3f7d11);}catch(_0x784e8c){}if(_0x3f7d11&&_0x3f7d11[_0x5f30e8])return _0x3f7d11[_0x5f30e8];}let _0x1f3da1=[];if(_0x349494===_0xda4e17(0x1c6))_0x1f3da1=[{'s':_0xda4e17(0x1b1),'t':_0xda4e17(0x22b)},{'s':'.1.TEMPERATURE','t':_0xda4e17(0x22b)},{'s':'.1.TEMPERATURE','t':_0xda4e17(0x1cf)},{'s':_0xda4e17(0x1dc),'t':_0xda4e17(0x209)},{'s':_0xda4e17(0x1c2),'t':'occupied_heating_setpoint'},{'s':_0xda4e17(0x1c2),'t':_0xda4e17(0x1ad)},{'s':_0xda4e17(0x1e1),'t':_0xda4e17(0x1fa)},{'s':'ACTUAL','t':_0xda4e17(0x1c4)},{'s':_0xda4e17(0x1fb),'t':'Soll'},{'s':'temperature','t':'setpoint'}];else _0x349494==='valve'&&(_0x1f3da1=[{'s':'.1.ACTUAL_TEMPERATURE','t':_0xda4e17(0x248)},{'s':_0xda4e17(0x1ae),'t':_0xda4e17(0x248)},{'s':_0xda4e17(0x1ae),'t':_0xda4e17(0x235)},{'s':'local_temperature','t':'pi_heating_demand'},{'s':_0xda4e17(0x1e1),'t':_0xda4e17(0x1a6)},{'s':_0xda4e17(0x1e1),'t':_0xda4e17(0x23f)}]);for(const _0x43ffab of _0x1f3da1){if(_0x5f30e8['includes'](_0x43ffab['s'])){const _0x242ff5=_0x5f30e8[_0xda4e17(0x1e8)](_0x43ffab['s'],_0x43ffab['t']),_0x45bddc=await _0x56957f['getForeignObjectAsync'](_0x242ff5);if(_0x45bddc)return _0x242ff5;}}try{const _0x153ecc=_0x5f30e8['split']('.');if(_0x153ecc[_0xda4e17(0x1ff)]>0x2){const _0xbbd9a9=_0x153ecc[_0xda4e17(0x228)](0x0,-0x1)[_0xda4e17(0x21b)]('.'),_0x39d0c4=await _0x56957f[_0xda4e17(0x1e3)](_0xbbd9a9+'.*'),_0x3c3ec8=[],_0x50ea8d=_0x5f30e8['split'](/[._]+/)[_0xda4e17(0x250)](_0x14f484=>![_0xda4e17(0x1a5),'0',_0xda4e17(0x224),_0xda4e17(0x22e),_0xda4e17(0x23b),_0xda4e17(0x1e1),_0xda4e17(0x1bb),_0xda4e17(0x214),_0xda4e17(0x1ba),_0xda4e17(0x24d)][_0xda4e17(0x204)](_0x14f484['toLowerCase']()));for(const [_0x1dc2da,_0x160bc0]of Object['entries'](_0x39d0c4)){if(_0x1dc2da===_0x5f30e8)continue;if(_0x160bc0&&_0x160bc0[_0xda4e17(0x1f6)]){const _0x36614f=_0x1dc2da['toLowerCase'](),_0x4a403d=(_0x160bc0['common']['role']||'')[_0xda4e17(0x1d4)](),_0x588296=(_0x160bc0['common'][_0xda4e17(0x218)]||'')[_0xda4e17(0x1d4)]();let _0x207ce4=![];if(_0x349494===_0xda4e17(0x1c6)&&_0x160bc0[_0xda4e17(0x1f6)][_0xda4e17(0x1ef)]===!![])_0x207ce4=_0x36614f[_0xda4e17(0x204)](_0xda4e17(0x1e4))||_0x36614f[_0xda4e17(0x204)](_0xda4e17(0x1b5))||_0x36614f[_0xda4e17(0x204)]('target')||_0x4a403d[_0xda4e17(0x204)](_0xda4e17(0x1b0))||_0x4a403d['includes'](_0xda4e17(0x258));else _0x349494===_0xda4e17(0x1a7)&&(_0x207ce4=_0x36614f[_0xda4e17(0x204)](_0xda4e17(0x23f))||_0x36614f[_0xda4e17(0x204)]('valve')||_0x36614f[_0xda4e17(0x204)](_0xda4e17(0x25a))||_0x36614f[_0xda4e17(0x204)]('position')||_0x4a403d['includes'](_0xda4e17(0x220))||_0x4a403d[_0xda4e17(0x204)]('value.valve')||_0x588296[_0xda4e17(0x204)]('%'));if(_0x207ce4){const _0x2a44db=_0x1dc2da[_0xda4e17(0x233)](/[._]+/)[_0xda4e17(0x1f5)](_0x2b7d3b=>_0x2b7d3b[_0xda4e17(0x1d4)]());let _0x54e7d4=0x0;_0x50ea8d['forEach'](_0x5c868a=>{const _0x5adbbe=_0xda4e17;if(_0x2a44db[_0x5adbbe(0x204)](_0x5c868a['toLowerCase']()))_0x54e7d4++;}),_0x3c3ec8['push']({'id':_0x1dc2da,'score':_0x54e7d4});}}}if(_0x3c3ec8[_0xda4e17(0x1ff)]>0x0){_0x3c3ec8[_0xda4e17(0x229)]((_0x2585c9,_0x3cdd05)=>_0x3cdd05[_0xda4e17(0x219)]-_0x2585c9['score']);if(_0x3c3ec8[0x0]['score']>0x0)return _0x3c3ec8[0x0]['id'];}}}catch(_0x348ced){}return null;}async function scanThermostats(_0x11dbcf){const _0x321714=a1_0x45dd71,_0x6fe8c5=_0x11dbcf[_0x321714(0x24f)][_0x321714(0x1cd)]||[],_0x181cd9=[],_0x544781=_0x6fe8c5[_0x321714(0x250)](_0x5221fb=>_0x5221fb['id']&&_0x5221fb['id'][_0x321714(0x204)](_0x321714(0x1e1))||_0x5221fb[_0x321714(0x21f)]&&['temperature',_0x321714(0x21a),'sensor']['includes'](_0x5221fb[_0x321714(0x21f)])||_0x5221fb['name']&&_0x5221fb[_0x321714(0x1e6)][_0x321714(0x1d4)]()[_0x321714(0x204)](_0x321714(0x1b8)));for(const _0x3ab62 of _0x544781){const _0x213b03=await findRelatedId(_0x11dbcf,_0x3ab62['id'],_0x321714(0x1c6)),_0x2c5a4a=await findRelatedId(_0x11dbcf,_0x3ab62['id'],_0x321714(0x1a7));let _0x4d5ef9=_0x321714(0x1e0),_0x2253e2=![],_0x284545=_0x11dbcf[_0x321714(0x24f)][_0x321714(0x1d2)]||{};if(typeof _0x284545==='string')try{_0x284545=JSON[_0x321714(0x1c9)](_0x284545);}catch(_0x62c4cd){}let _0xf49b22=_0x11dbcf[_0x321714(0x24f)][_0x321714(0x1be)]||{};if(typeof _0xf49b22===_0x321714(0x234))try{_0xf49b22=JSON[_0x321714(0x1c9)](_0xf49b22);}catch(_0x32d127){}if(_0x284545[_0x3ab62['id']]&&_0x284545[_0x3ab62['id']]===_0x213b03||_0xf49b22[_0x3ab62['id']]&&_0xf49b22[_0x3ab62['id']]===_0x2c5a4a)_0x4d5ef9=_0x321714(0x202),_0x2253e2=!![];else(_0x213b03||_0x2c5a4a)&&(_0x4d5ef9='Auto-Erkennung');_0x181cd9[_0x321714(0x20d)]({'room':_0x3ab62['location']||'Unbekannt','sensorId':_0x3ab62['id'],'setpointId':_0x213b03||'-','valveId':_0x2c5a4a||'-','source':_0x4d5ef9,'isManual':_0x2253e2,'status':_0x213b03&&_0x2c5a4a?_0x321714(0x1a8):_0x213b03?'OK':_0x321714(0x1ed)});}return _0x181cd9['sort']((_0x2d80c4,_0x26a92a)=>_0x2d80c4['room'][_0x321714(0x1b4)](_0x26a92a[_0x321714(0x23e)]));}async function updateSchedulePreview(_0x1018cb){const _0x1e7fc1=a1_0x45dd71;if(!_0x1018cb[_0x1e7fc1(0x24f)][_0x1e7fc1(0x23a)]||!_0x1018cb[_0x1e7fc1(0x24f)]['calendarInstance'])return;let _0x2d18a9={};try{const _0x4b9a51=await _0x1018cb[_0x1e7fc1(0x244)](_0x1e7fc1(0x1df));if(_0x4b9a51&&_0x4b9a51[_0x1e7fc1(0x1e5)])_0x2d18a9=JSON[_0x1e7fc1(0x1c9)](_0x4b9a51[_0x1e7fc1(0x1e5)]);}catch(_0x1f87b5){}const _0x5c7d7f=[],_0x48a751=Date[_0x1e7fc1(0x213)](),_0x53c060=0x30*0x3c*0x3c*0x3e8;try{const _0x427e2f=await _0x1018cb[_0x1e7fc1(0x25d)](_0x1018cb[_0x1e7fc1(0x24f)][_0x1e7fc1(0x1b3)]+_0x1e7fc1(0x215));if(!_0x427e2f||!_0x427e2f['val'])return;const _0x8cf678=JSON[_0x1e7fc1(0x1c9)](_0x427e2f[_0x1e7fc1(0x1e5)]),_0x94dda5=_0x1018cb[_0x1e7fc1(0x24f)][_0x1e7fc1(0x21d)]||[],_0x104ee6=_0x1018cb[_0x1e7fc1(0x24f)][_0x1e7fc1(0x1cd)]||[],_0x526196=new Set();_0x104ee6[_0x1e7fc1(0x205)](_0x4e02fe=>{const _0x544c27=_0x1e7fc1;if(_0x4e02fe[_0x544c27(0x23d)])_0x526196[_0x544c27(0x1ab)](_0x4e02fe[_0x544c27(0x23d)]);});for(const _0x2d941e of _0x8cf678){if(_0x2d941e[_0x1e7fc1(0x240)]&&_0x94dda5[_0x1e7fc1(0x1ff)]>0x0&&!_0x94dda5[_0x1e7fc1(0x204)](_0x2d941e[_0x1e7fc1(0x240)]))continue;const _0x3869bd=_0x2d941e[_0x1e7fc1(0x1fe)]||_0x2d941e[_0x1e7fc1(0x24c)]||_0x2d941e[_0x1e7fc1(0x25b)];if(!_0x3869bd)continue;const _0x4a6692=new Date(_0x3869bd),_0x522b97=_0x4a6692['getTime']();if(isNaN(_0x522b97))continue;if(_0x522b97<_0x48a751)continue;if(_0x522b97>_0x48a751+_0x53c060)continue;const _0xaaad4=(_0x2d941e['event']||_0x2d941e[_0x1e7fc1(0x212)]||'')['toLowerCase']();let _0x3c67f2=![],_0x365382=[],_0x23ff22=_0x2d941e[_0x1e7fc1(0x1ea)]||_0x2d941e[_0x1e7fc1(0x212)]||'Unbekannt';if(_0xaaad4[_0x1e7fc1(0x204)]('urlaub\x20ende')||_0xaaad4[_0x1e7fc1(0x204)](_0x1e7fc1(0x216))||_0xaaad4[_0x1e7fc1(0x204)](_0x1e7fc1(0x1f9)))_0x3c67f2=!![],_0x365382=Array[_0x1e7fc1(0x255)](_0x526196);else for(const _0x330241 of _0x526196){if(_0xaaad4[_0x1e7fc1(0x204)](_0x330241[_0x1e7fc1(0x1d4)]()))_0x365382['push'](_0x330241);}_0x365382['length']>0x0&&_0x365382[_0x1e7fc1(0x205)](_0x1914c6=>{const _0x2fa017=_0x1e7fc1;let _0x5f0dbf=0x3c;if(_0x3c67f2){let _0x1050c9=0x0;Object[_0x2fa017(0x222)](_0x2d18a9)[_0x2fa017(0x205)](_0x499d8a=>{if(_0x499d8a>_0x1050c9)_0x1050c9=_0x499d8a;}),_0x5f0dbf=_0x1050c9>0x0?_0x1050c9:0x78;}else _0x5f0dbf=_0x2d18a9[_0x1914c6]||0x3c;const _0x236368=new Date(_0x522b97-_0x5f0dbf*0xea60);_0x5c7d7f[_0x2fa017(0x20d)]({'eventTime':_0x522b97,'triggerTime':_0x236368['getTime'](),'room':_0x1914c6,'minutes':_0x5f0dbf,'reason':_0x23ff22,'isGlobal':_0x3c67f2});});}}catch(_0x3ed859){}_0x5c7d7f[_0x1e7fc1(0x229)]((_0x4d52db,_0x1a059d)=>_0x4d52db[_0x1e7fc1(0x257)]-_0x1a059d[_0x1e7fc1(0x257)]);const _0x2f4da7=_0x5c7d7f[_0x1e7fc1(0x228)](0x0,0x5);await _0x1018cb[_0x1e7fc1(0x254)](_0x1e7fc1(0x1d1),{'val':JSON[_0x1e7fc1(0x24b)](_0x2f4da7),'ack':!![]});}async function checkCalendarTriggers(_0x5e88c4){const _0x4d9d41=a1_0x45dd71;if(!_0x5e88c4['config'][_0x4d9d41(0x23a)]||!_0x5e88c4[_0x4d9d41(0x24f)]['calendarInstance'])return;await updateSchedulePreview(_0x5e88c4);let _0x1830fa={},_0x14d7a0={};try{const _0xf40f61=await _0x5e88c4[_0x4d9d41(0x244)]('analysis.energy.warmupTimes');if(_0xf40f61&&_0xf40f61[_0x4d9d41(0x1e5)])_0x1830fa=JSON[_0x4d9d41(0x1c9)](_0xf40f61[_0x4d9d41(0x1e5)]);const _0x32e5ba=await _0x5e88c4[_0x4d9d41(0x244)](_0x4d9d41(0x223));if(_0x32e5ba&&_0x32e5ba[_0x4d9d41(0x1e5)])_0x14d7a0=JSON[_0x4d9d41(0x1c9)](_0x32e5ba[_0x4d9d41(0x1e5)]);}catch(_0x1a6f15){}let _0x35f1ce={'default':0x15};try{const _0x17deeb=await _0x5e88c4[_0x4d9d41(0x244)](_0x4d9d41(0x1ec));if(_0x17deeb&&_0x17deeb[_0x4d9d41(0x1e5)])_0x35f1ce=JSON[_0x4d9d41(0x1c9)](_0x17deeb[_0x4d9d41(0x1e5)]);}catch(_0x1973b1){}try{const _0x536886=await _0x5e88c4['getForeignStateAsync'](_0x5e88c4[_0x4d9d41(0x24f)][_0x4d9d41(0x1b3)]+_0x4d9d41(0x215));if(!_0x536886||!_0x536886[_0x4d9d41(0x1e5)])return;const _0x232590=JSON[_0x4d9d41(0x1c9)](_0x536886['val']),_0x585117=Date[_0x4d9d41(0x213)](),_0x36cdfd=_0x5e88c4[_0x4d9d41(0x24f)][_0x4d9d41(0x1cd)]||[],_0x460df0=_0x5e88c4[_0x4d9d41(0x24f)][_0x4d9d41(0x21d)]||[];for(const _0x58c844 of _0x232590){if(_0x58c844[_0x4d9d41(0x240)]&&_0x460df0[_0x4d9d41(0x1ff)]>0x0&&!_0x460df0[_0x4d9d41(0x204)](_0x58c844[_0x4d9d41(0x240)]))continue;const _0x21e9b2=_0x58c844[_0x4d9d41(0x1fe)]||_0x58c844[_0x4d9d41(0x24c)]||_0x58c844['date'];if(!_0x21e9b2)continue;const _0x3bb7dc=new Date(_0x21e9b2);if(isNaN(_0x3bb7dc[_0x4d9d41(0x1fc)]()))continue;const _0x3c3522=(_0x58c844[_0x4d9d41(0x1ea)]||_0x58c844['summary']||'')['toLowerCase']();if(_0x3c3522[_0x4d9d41(0x204)](_0x4d9d41(0x1aa))||_0x3c3522['includes']('r√ºckkehr')||_0x3c3522['includes']('ankunft')){let _0x5cfb56=0x0;Object[_0x4d9d41(0x222)](_0x1830fa)[_0x4d9d41(0x205)](_0x5db051=>{if(_0x5db051>_0x5cfb56)_0x5cfb56=_0x5db051;});if(_0x5cfb56===0x0)_0x5cfb56=0x78;const _0xdce9ab=_0x3bb7dc[_0x4d9d41(0x1fc)]()-_0x5cfb56*0xea60;_0x585117>=_0xdce9ab&&_0x585117<_0x3bb7dc['getTime']()&&(_0x5e88c4[_0x4d9d41(0x226)]!==_0x4d9d41(0x225)&&(_0x5e88c4[_0x4d9d41(0x1f2)][_0x4d9d41(0x1d7)](_0x4d9d41(0x232)+_0x5cfb56+_0x4d9d41(0x245)),await _0x5e88c4[_0x4d9d41(0x254)](_0x4d9d41(0x1f7),{'val':_0x4d9d41(0x225),'ack':![]})));}for(const _0x1573ad of _0x36cdfd){if(_0x1573ad[_0x4d9d41(0x23d)]){const _0x292e45=_0x1573ad[_0x4d9d41(0x23d)][_0x4d9d41(0x1d4)]();if(_0x3c3522[_0x4d9d41(0x204)](_0x292e45)){const _0xa578c9=_0x1830fa[_0x1573ad[_0x4d9d41(0x23d)]]||0x3c,_0x81c55d=_0x14d7a0[_0x1573ad[_0x4d9d41(0x23d)]]||_0x4d9d41(0x1d0),_0x373d4d=_0x3bb7dc[_0x4d9d41(0x1fc)]()-_0xa578c9*0xea60;if(_0x585117>=_0x373d4d&&_0x585117<_0x3bb7dc[_0x4d9d41(0x1fc)]()){const _0x398287=lastActions[_0x4d9d41(0x227)+_0x1573ad[_0x4d9d41(0x23d)]];if(_0x398287&&_0x585117-_0x398287<CAL_COOLDOWN_MS)continue;const _0x2dde1f=await findRelatedId(_0x5e88c4,_0x1573ad['id'],'setpoint');if(_0x2dde1f){let _0x372d59=_0x35f1ce[_0x1573ad[_0x4d9d41(0x23d)]];if(_0x372d59===undefined)_0x372d59=_0x35f1ce['default'];if(_0x372d59===undefined)_0x372d59=0x15;const _0x44f6b1=await _0x5e88c4[_0x4d9d41(0x25d)](_0x2dde1f);_0x44f6b1&&typeof _0x44f6b1[_0x4d9d41(0x1e5)]===_0x4d9d41(0x22f)&&_0x44f6b1[_0x4d9d41(0x1e5)]<_0x372d59-0.5&&(_0x5e88c4['log'][_0x4d9d41(0x1d7)](_0x4d9d41(0x252)+_0x81c55d+_0x4d9d41(0x22d)+_0x1573ad[_0x4d9d41(0x23d)]+_0x4d9d41(0x20f)+_0x372d59+_0x4d9d41(0x22a)+_0xa578c9+_0x4d9d41(0x245)),await _0x5e88c4[_0x4d9d41(0x251)](_0x2dde1f,_0x372d59),await logAutomationAction(_0x5e88c4,_0x4d9d41(0x1ee)+_0x1573ad[_0x4d9d41(0x23d)]+_0x4d9d41(0x1b9)+_0x372d59+'¬∞C\x20(via\x20'+_0x81c55d+')'),lastActions[_0x4d9d41(0x227)+_0x1573ad[_0x4d9d41(0x23d)]]=_0x585117);}}}}}}}catch(_0x31bf22){_0x5e88c4[_0x4d9d41(0x1f2)]['warn'](_0x4d9d41(0x1eb)+_0x31bf22[_0x4d9d41(0x207)]);}}async function manageMpcIntervention(_0xb8d740,_0x1a5b60,_0x2ea281){const _0x50ceb6=a1_0x45dd71;try{const _0x543b19=_0x50ceb6(0x20c),_0x5189d5=await _0xb8d740['getStateAsync'](_0x543b19);let _0x3e99b2=[];if(_0x5189d5&&_0x5189d5[_0x50ceb6(0x1e5)])try{_0x3e99b2=JSON[_0x50ceb6(0x1c9)](_0x5189d5[_0x50ceb6(0x1e5)]);}catch(_0x3ea545){}const _0x2cd395=_0x3e99b2[_0x50ceb6(0x230)](_0x1a5b60);if(_0x2ea281===_0x50ceb6(0x1ab))_0x2cd395===-0x1&&(_0x3e99b2[_0x50ceb6(0x20d)](_0x1a5b60),await _0xb8d740[_0x50ceb6(0x254)](_0x543b19,{'val':JSON[_0x50ceb6(0x24b)](_0x3e99b2),'ack':!![]}));else _0x2ea281===_0x50ceb6(0x236)&&(_0x2cd395!==-0x1&&(_0x3e99b2[_0x50ceb6(0x221)](_0x2cd395,0x1),await _0xb8d740[_0x50ceb6(0x254)](_0x543b19,{'val':JSON[_0x50ceb6(0x24b)](_0x3e99b2),'ack':!![]})));}catch(_0x366708){}}async function cleanupGhostInterventions(_0x570caa){const _0x4321a3=a1_0x45dd71;try{const _0x3e6ac7='analysis.energy.mpcActiveInterventions',_0x38c50d=await _0x570caa['getStateAsync'](_0x3e6ac7);if(!_0x38c50d||!_0x38c50d[_0x4321a3(0x1e5)])return;const _0x5b7976=JSON[_0x4321a3(0x1c9)](_0x38c50d[_0x4321a3(0x1e5)]);if(!Array[_0x4321a3(0x1c8)](_0x5b7976)||_0x5b7976['length']===0x0)return;let _0x19d6b6={'default':0x15};try{const _0x452e38=await _0x570caa[_0x4321a3(0x244)](_0x4321a3(0x1ec));if(_0x452e38&&_0x452e38[_0x4321a3(0x1e5)])_0x19d6b6=JSON[_0x4321a3(0x1c9)](_0x452e38[_0x4321a3(0x1e5)]);}catch(_0x53f401){}let _0x2c0b04=[];try{const _0x154b5d=await _0x570caa[_0x4321a3(0x244)](_0x4321a3(0x25c));if(_0x154b5d&&_0x154b5d['val'])_0x2c0b04=JSON[_0x4321a3(0x1c9)](_0x154b5d['val']);}catch(_0x50c721){}const _0x27898f=_0x570caa['config'][_0x4321a3(0x1cd)]||[];let _0x53fcca=![];for(let _0x51ddab=_0x5b7976[_0x4321a3(0x1ff)]-0x1;_0x51ddab>=0x0;_0x51ddab--){const _0x3f2c79=_0x5b7976[_0x51ddab],_0x4f0b5a=_0x27898f[_0x4321a3(0x1af)](_0x503b5e=>normalize(_0x503b5e['location'])===normalize(_0x3f2c79)&&(_0x503b5e[_0x4321a3(0x21f)]===_0x4321a3(0x1e1)||_0x503b5e[_0x4321a3(0x21f)]===_0x4321a3(0x21a)));if(!_0x4f0b5a){_0x570caa[_0x4321a3(0x1f2)][_0x4321a3(0x1cb)](_0x4321a3(0x253)+_0x3f2c79+_0x4321a3(0x22c)),_0x5b7976[_0x4321a3(0x221)](_0x51ddab,0x1),_0x53fcca=!![];continue;}if(_0x4f0b5a){const _0x24439f=await findRelatedId(_0x570caa,_0x4f0b5a['id'],_0x4321a3(0x1c6)),_0x386e4=await _0x570caa['getForeignStateAsync'](_0x4f0b5a['id']);if(_0x24439f){const _0x4cdba2=await _0x570caa[_0x4321a3(0x25d)](_0x24439f);if(_0x4cdba2&&typeof _0x4cdba2[_0x4321a3(0x1e5)]===_0x4321a3(0x22f)){let _0x376568=![],_0x3e1ba3='';Math['abs'](_0x4cdba2[_0x4321a3(0x1e5)]-ECO_TEMP)>0.5&&(_0x376568=!![],_0x3e1ba3=_0x4321a3(0x1e2));if(!_0x376568&&_0x386e4&&typeof _0x386e4['val']===_0x4321a3(0x22f)){const _0x5243d4=_0x19d6b6[_0x3f2c79]||_0x19d6b6[_0x4321a3(0x259)]||0x15;_0x386e4[_0x4321a3(0x1e5)]<_0x5243d4+0.2&&(_0x376568=!![],_0x3e1ba3=_0x4321a3(0x24e));}if(_0x376568){if(_0x3e1ba3===_0x4321a3(0x1e2)){_0x570caa['log']['info'](_0x4321a3(0x1bf)+_0x3f2c79+_0x4321a3(0x1f0)+_0x4cdba2[_0x4321a3(0x1e5)]+_0x4321a3(0x1f8)+ECO_TEMP+_0x4321a3(0x1ce));const _0x103fea=lastActions[_0x4321a3(0x227)+_0x3f2c79],_0x3c9203=_0x103fea&&Date[_0x4321a3(0x213)]()-_0x103fea<0x2*0x3c*0x3e8;if(!_0x3c9203&&_0x4cdba2[_0x4321a3(0x1e5)]>ECO_TEMP+0.5)_0x570caa['sendToPythonWrapper']&&(_0x570caa[_0x4321a3(0x1f2)]['info'](_0x4321a3(0x200)+_0x3f2c79+'\x20wurde\x20manuell\x20erh√∂ht.'),_0x570caa[_0x4321a3(0x1c0)](_0x4321a3(0x217),{'room':_0x3f2c79}));else _0x3c9203&&_0x570caa[_0x4321a3(0x1f2)][_0x4321a3(0x1d7)](_0x4321a3(0x206)+_0x3f2c79+_0x4321a3(0x1f3));}else{if(_0x3e1ba3===_0x4321a3(0x24e)){let _0x47a952=![];if(_0x2c0b04['find'](_0x3adcc5=>_0x3adcc5[_0x4321a3(0x23e)]===_0x3f2c79))_0x47a952=!![];const _0x2d703d=_0x27898f[_0x4321a3(0x250)](_0x437633=>normalize(_0x437633[_0x4321a3(0x23d)])===normalize(_0x3f2c79)&&(_0x437633[_0x4321a3(0x21f)]===_0x4321a3(0x210)||_0x437633[_0x4321a3(0x21f)]===_0x4321a3(0x214)||_0x437633[_0x4321a3(0x21f)]===_0x4321a3(0x1b7)));for(const _0x5d89e1 of _0x2d703d){try{const _0x3df085=await _0x570caa[_0x4321a3(0x25d)](_0x5d89e1['id']);if(_0x3df085&&(_0x3df085[_0x4321a3(0x1e5)]===!![]||_0x3df085['val']===0x1||String(_0x3df085[_0x4321a3(0x1e5)])[_0x4321a3(0x1d4)]()==='open'))_0x47a952=!![];}catch(_0x537edf){}}if(_0x47a952)_0x570caa[_0x4321a3(0x1f2)]['info']('üå¨Ô∏è\x20[MPC\x20WATCHDOG]\x20'+_0x3f2c79+_0x4321a3(0x1ac));else{const _0x22de7d=_0x19d6b6[_0x3f2c79]||_0x19d6b6[_0x4321a3(0x259)]||0x15;_0x570caa[_0x4321a3(0x1f2)][_0x4321a3(0x1d7)](_0x4321a3(0x1b2)+_0x3f2c79+_0x4321a3(0x201)+_0x386e4[_0x4321a3(0x1e5)]+_0x4321a3(0x20b)+(_0x22de7d+0.2)+'¬∞C).\x20Sparmodus\x20beendet!'),await _0x570caa[_0x4321a3(0x251)](_0x24439f,_0x22de7d),await logAutomationAction(_0x570caa,_0x4321a3(0x20a)+_0x3f2c79+':\x20Puffer\x20leer\x20->\x20Heizen\x20auf\x20'+_0x22de7d+'¬∞C'),lastActions[_0x4321a3(0x242)+_0x3f2c79]=Date[_0x4321a3(0x213)]();}}}_0x5b7976[_0x4321a3(0x221)](_0x51ddab,0x1),_0x53fcca=!![];}}}}}_0x53fcca&&await _0x570caa[_0x4321a3(0x254)](_0x3e6ac7,{'val':JSON[_0x4321a3(0x24b)](_0x5b7976),'ack':!![]});}catch(_0x44e8b1){}}async function applyEnergySavings(_0x40b230,_0x136b23){const _0x55dd27=a1_0x45dd71;await cleanupGhostInterventions(_0x40b230);if(!_0x136b23||_0x136b23[_0x55dd27(0x1ff)]===0x0)return;const _0x2806be=_0x40b230[_0x55dd27(0x24f)][_0x55dd27(0x1cd)]||[],_0x51e7ad=Date['now']();for(const _0x39bb71 of _0x136b23){const _0x4fe49b=_0x39bb71[_0x55dd27(0x23e)],_0xce05f0=_0x39bb71[_0x55dd27(0x23c)],_0xfb462a=_0x39bb71[_0x55dd27(0x21c)]||0x15;if(lastActions[_0x55dd27(0x242)+_0x4fe49b]&&_0x51e7ad-lastActions[_0x55dd27(0x242)+_0x4fe49b]<RESCUE_LOCK_MS)continue;const _0x2b9e55=_0x2806be[_0x55dd27(0x1af)](_0x2bda2f=>normalize(_0x2bda2f[_0x55dd27(0x23d)])===normalize(_0x4fe49b)&&(_0x2bda2f[_0x55dd27(0x21f)]==='temperature'||_0x2bda2f['type']===_0x55dd27(0x21a)));if(!_0x2b9e55)continue;const _0x18d959=await findRelatedId(_0x40b230,_0x2b9e55['id'],_0x55dd27(0x1c6));if(_0x18d959){if(lastActions[_0x55dd27(0x1c3)+_0x4fe49b]&&_0x51e7ad-lastActions[_0x55dd27(0x1c3)+_0x4fe49b]<0x1e*0x3c*0x3e8)continue;const _0x3030e1=await _0x40b230[_0x55dd27(0x25d)](_0x18d959);if(_0x3030e1&&typeof _0x3030e1[_0x55dd27(0x1e5)]===_0x55dd27(0x22f)){const _0x42a1b7=_0x3030e1[_0x55dd27(0x1e5)];_0x42a1b7!==ECO_TEMP&&await manageMpcIntervention(_0x40b230,_0x4fe49b,_0x55dd27(0x236));if(_0xce05f0>0x1e)_0x42a1b7>ECO_TEMP+0.5&&(_0x40b230['log'][_0x55dd27(0x1d7)]('üçÉ\x20[MPC\x20ACTION]\x20Senke\x20'+_0x4fe49b+_0x55dd27(0x241)+ECO_TEMP+_0x55dd27(0x247)+_0xce05f0+_0x55dd27(0x239)),await _0x40b230[_0x55dd27(0x251)](_0x18d959,ECO_TEMP),await manageMpcIntervention(_0x40b230,_0x4fe49b,_0x55dd27(0x1ab)),lastActions['mpc_'+_0x4fe49b]=_0x51e7ad,await logAutomationAction(_0x40b230,_0x55dd27(0x1a9)+_0x4fe49b+_0x55dd27(0x256)+ECO_TEMP+'¬∞C'));else _0xce05f0<=0xf&&(_0x42a1b7<_0xfb462a&&(_0x40b230['log'][_0x55dd27(0x1d7)]('üî•\x20[MPC\x20ACTION]\x20Heize\x20'+_0x4fe49b+'\x20wieder\x20auf\x20'+_0xfb462a+_0x55dd27(0x1fd)),await _0x40b230[_0x55dd27(0x251)](_0x18d959,_0xfb462a),await manageMpcIntervention(_0x40b230,_0x4fe49b,_0x55dd27(0x236)),lastActions[_0x55dd27(0x1c3)+_0x4fe49b]=_0x51e7ad,await logAutomationAction(_0x40b230,_0x55dd27(0x1a9)+_0x4fe49b+_0x55dd27(0x1bc)+_0xfb462a+'¬∞C')));}}else _0x40b230['log'][_0x55dd27(0x1cb)](_0x55dd27(0x1d6)+_0x4fe49b+_0x55dd27(0x1f1));}}module[a1_0x45dd71(0x208)]={'handlePrediction':handlePrediction,'applyEnergySavings':applyEnergySavings,'scanThermostats':scanThermostats,'checkCalendarTriggers':checkCalendarTriggers,'updateSchedulePreview':updateSchedulePreview,'cleanupGhostInterventions':cleanupGhostInterventions};