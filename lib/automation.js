const a1_0x583132=a1_0x4aac;(function(_0x3b2e96,_0x1f3196){const _0x158be3=a1_0x4aac,_0x37a3d3=_0x3b2e96();while(!![]){try{const _0x290766=-parseInt(_0x158be3(0x156))/0x1+-parseInt(_0x158be3(0x14a))/0x2*(parseInt(_0x158be3(0x16c))/0x3)+parseInt(_0x158be3(0x18c))/0x4*(parseInt(_0x158be3(0xf7))/0x5)+-parseInt(_0x158be3(0x159))/0x6*(parseInt(_0x158be3(0x169))/0x7)+parseInt(_0x158be3(0x118))/0x8+-parseInt(_0x158be3(0x14c))/0x9*(parseInt(_0x158be3(0x12b))/0xa)+parseInt(_0x158be3(0x101))/0xb;if(_0x290766===_0x1f3196)break;else _0x37a3d3['push'](_0x37a3d3['shift']());}catch(_0x4517c8){_0x37a3d3['push'](_0x37a3d3['shift']());}}}(a1_0x2b63,0x58b06));const a1_0x24ac93=(function(){let _0x3f210f=!![];return function(_0x5be954,_0x4ee53b){const _0x5dc40a=_0x3f210f?function(){const _0x401460=a1_0x4aac;if(_0x4ee53b){const _0x1a8194=_0x4ee53b[_0x401460(0x13b)](_0x5be954,arguments);return _0x4ee53b=null,_0x1a8194;}}:function(){};return _0x3f210f=![],_0x5dc40a;};}()),a1_0x112827=a1_0x24ac93(this,function(){const _0x3a36ac=a1_0x4aac;return a1_0x112827[_0x3a36ac(0x141)]()[_0x3a36ac(0x176)](_0x3a36ac(0x12e))[_0x3a36ac(0x141)]()[_0x3a36ac(0x182)](a1_0x112827)[_0x3a36ac(0x176)](_0x3a36ac(0x12e));});a1_0x112827();'use strict';const aiAgent=require(a1_0x583132(0x163)),COOLDOWN_MS=0x3c*0x3e8,CAL_COOLDOWN_MS=0x5a*0x3c*0x3e8,ECO_TEMP=0x11,lastActions={};function normalize(_0x2ff88e){const _0x2328b7=a1_0x583132;if(!_0x2ff88e)return'';return _0x2ff88e[_0x2328b7(0x187)]()[_0x2328b7(0x18b)](/\s+/g,'')[_0x2328b7(0x132)]();}function a1_0x4aac(_0x4a90ac,_0xec945b){const _0x23f510=a1_0x2b63();return a1_0x4aac=function(_0x112827,_0x24ac93){_0x112827=_0x112827-0xf2;let _0x2b6338=_0x23f510[_0x112827];return _0x2b6338;},a1_0x4aac(_0x4a90ac,_0xec945b);}async function logAutomationAction(_0x5ee22e,_0x57eaf2){const _0x3a1d0a=a1_0x583132;await _0x5ee22e[_0x3a1d0a(0x168)](_0x3a1d0a(0x130),{'val':_0x57eaf2,'ack':!![]});try{const _0x164896=_0x3a1d0a(0x15d),_0x316caa=await _0x5ee22e[_0x3a1d0a(0x151)](_0x164896);let _0x4d7688=[];if(_0x316caa&&_0x316caa[_0x3a1d0a(0x17a)])try{_0x4d7688=JSON[_0x3a1d0a(0x192)](_0x316caa[_0x3a1d0a(0x17a)]);}catch(_0x5380b3){}_0x4d7688[_0x3a1d0a(0x131)]({'ts':Date[_0x3a1d0a(0x16a)](),'msg':_0x57eaf2});if(_0x4d7688[_0x3a1d0a(0x115)]>0x32)_0x4d7688=_0x4d7688['slice'](0x0,0x32);await _0x5ee22e[_0x3a1d0a(0x168)](_0x164896,{'val':JSON[_0x3a1d0a(0x135)](_0x4d7688),'ack':!![]});}catch(_0x2cc936){}}async function handlePrediction(_0x19cc00,_0x1a5899,_0x1e28bc){const _0x5c372a=a1_0x583132;if(!_0x1a5899||_0x1a5899===_0x5c372a(0xf6))return;let _0x2dba5f=_0x5c372a(0x170),_0x4a3939=0.6;try{const _0x4060e7=await _0x19cc00[_0x5c372a(0x151)](_0x5c372a(0x18d));if(_0x4060e7&&_0x4060e7[_0x5c372a(0x17a)])_0x2dba5f=_0x4060e7[_0x5c372a(0x17a)];const _0x49cbed=await _0x19cc00['getStateAsync']('analysis.automation.confidenceThreshold');if(_0x49cbed&&_0x49cbed['val'])_0x4a3939=_0x49cbed['val'];}catch(_0x5dda72){}if(_0x2dba5f==='off'||_0x1e28bc<_0x4a3939)return;const _0xed6334=Date[_0x5c372a(0x16a)]();if(lastActions[_0x1a5899]&&_0xed6334-lastActions[_0x1a5899]<COOLDOWN_MS)return;const _0x42c42c=_0x19cc00[_0x5c372a(0x145)][_0x5c372a(0x102)]||[],_0x3c7fc2=normalize(_0x1a5899),_0x464620=_0x42c42c['find'](_0x4f6ca7=>normalize(_0x4f6ca7[_0x5c372a(0x129)])===_0x3c7fc2&&(_0x4f6ca7[_0x5c372a(0x16f)]===_0x5c372a(0xfe)||_0x4f6ca7[_0x5c372a(0x16f)]==='dimmer'||_0x4f6ca7['type']===_0x5c372a(0x150)));if(!_0x464620)return;const _0x4a1163=await aiAgent[_0x5c372a(0x121)](_0x19cc00,_0x1a5899,_0x464620[_0x5c372a(0x149)],_0x1e28bc);if(!_0x4a1163[_0x5c372a(0x112)])return;const _0x12a9ae=_0x5c372a(0x13c)+_0x1a5899+'\x20->\x20Schalte\x20'+_0x464620[_0x5c372a(0x149)]+'\x20('+_0x4a1163['reason']+')';await logAutomationAction(_0x19cc00,'['+_0x2dba5f[_0x5c372a(0xfa)]()+']\x20'+_0x12a9ae);if(_0x2dba5f==='active'){const _0x10ad8d=await _0x19cc00['getForeignStateAsync'](_0x464620['id']);(!_0x10ad8d||!_0x10ad8d[_0x5c372a(0x17a)]&&_0x10ad8d[_0x5c372a(0x17a)]!==!![])&&await _0x19cc00[_0x5c372a(0x136)](_0x464620['id'],!![]),lastActions[_0x1a5899]=_0xed6334;}}async function findRelatedId(_0x344a46,_0x7b7c52,_0x51035a=a1_0x583132(0x175)){const _0x38596a=a1_0x583132;if(_0x51035a===_0x38596a(0x175)&&_0x344a46['config']['thermostatMapping']){let _0x1d320a=_0x344a46[_0x38596a(0x145)][_0x38596a(0x104)];if(typeof _0x1d320a==='string')try{_0x1d320a=JSON[_0x38596a(0x192)](_0x1d320a);}catch(_0x51d1e6){}if(_0x1d320a&&_0x1d320a[_0x7b7c52])return _0x1d320a[_0x7b7c52];}if(_0x51035a===_0x38596a(0xf2)&&_0x344a46[_0x38596a(0x145)]['valveMapping']){let _0x2c4444=_0x344a46[_0x38596a(0x145)]['valveMapping'];if(typeof _0x2c4444==='string')try{_0x2c4444=JSON[_0x38596a(0x192)](_0x2c4444);}catch(_0x2f611d){}if(_0x2c4444&&_0x2c4444[_0x7b7c52])return _0x2c4444[_0x7b7c52];}let _0x405881=[];if(_0x51035a===_0x38596a(0x175))_0x405881=[{'s':_0x38596a(0x18f),'t':'.1.SET_POINT_TEMPERATURE'},{'s':_0x38596a(0x154),'t':_0x38596a(0x153)},{'s':_0x38596a(0x154),'t':'.4.SET_TEMPERATURE'},{'s':_0x38596a(0x177),'t':_0x38596a(0x14f)},{'s':_0x38596a(0x186),'t':_0x38596a(0x195)},{'s':'local_temperature','t':'current_heating_setpoint'},{'s':_0x38596a(0x138),'t':_0x38596a(0x120)},{'s':_0x38596a(0x10c),'t':_0x38596a(0xf9)},{'s':_0x38596a(0x171),'t':_0x38596a(0x17d)},{'s':_0x38596a(0x138),'t':_0x38596a(0x175)}];else _0x51035a==='valve'&&(_0x405881=[{'s':'.1.ACTUAL_TEMPERATURE','t':_0x38596a(0x12a)},{'s':_0x38596a(0x154),'t':_0x38596a(0x12a)},{'s':'.1.TEMPERATURE','t':'.4.VALVE_STATE'},{'s':'local_temperature','t':_0x38596a(0x13e)},{'s':_0x38596a(0x138),'t':_0x38596a(0x140)},{'s':_0x38596a(0x138),'t':_0x38596a(0x16d)}]);for(const _0x4ac218 of _0x405881){if(_0x7b7c52['includes'](_0x4ac218['s'])){const _0x2841e5=_0x7b7c52[_0x38596a(0x18b)](_0x4ac218['s'],_0x4ac218['t']),_0x3ca9c7=await _0x344a46[_0x38596a(0x158)](_0x2841e5);if(_0x3ca9c7)return _0x2841e5;}}try{const _0xafcfd0=_0x7b7c52[_0x38596a(0xf5)]('.');if(_0xafcfd0[_0x38596a(0x115)]>0x2){const _0x386518=_0xafcfd0[_0x38596a(0x14d)](0x0,-0x1)['join']('.'),_0x42553=await _0x344a46[_0x38596a(0x123)](_0x386518+'.*'),_0x2df728=[],_0x4d3b52=_0x7b7c52[_0x38596a(0xf5)](/[._]+/)[_0x38596a(0x107)](_0x289a67=>![_0x38596a(0x137),'0','hm-rpc',_0x38596a(0xf3),'wert',_0x38596a(0x138),_0x38596a(0x188),_0x38596a(0xf4),_0x38596a(0x126),_0x38596a(0x161)][_0x38596a(0x179)](_0x289a67[_0x38596a(0x187)]()));for(const [_0x8f5741,_0x4f29de]of Object['entries'](_0x42553)){if(_0x8f5741===_0x7b7c52)continue;if(_0x4f29de&&_0x4f29de['common']){const _0x9e4bfa=_0x8f5741['toLowerCase'](),_0x1a2008=(_0x4f29de['common'][_0x38596a(0x17f)]||'')['toLowerCase'](),_0x27b67a=(_0x4f29de['common'][_0x38596a(0x178)]||'')['toLowerCase']();let _0x294621=![];if(_0x51035a==='setpoint'&&_0x4f29de[_0x38596a(0x18a)][_0x38596a(0x144)]===!![])_0x294621=_0x9e4bfa[_0x38596a(0x179)](_0x38596a(0x109))||_0x9e4bfa[_0x38596a(0x179)]('soll')||_0x9e4bfa[_0x38596a(0x179)](_0x38596a(0x116))||_0x1a2008[_0x38596a(0x179)](_0x38596a(0x17b))||_0x1a2008[_0x38596a(0x179)]('thermostat.setpoint');else _0x51035a==='valve'&&(_0x294621=_0x9e4bfa[_0x38596a(0x179)]('level')||_0x9e4bfa[_0x38596a(0x179)](_0x38596a(0xf2))||_0x9e4bfa[_0x38596a(0x179)](_0x38596a(0x155))||_0x9e4bfa[_0x38596a(0x179)]('position')||_0x1a2008['includes'](_0x38596a(0x143))||_0x1a2008[_0x38596a(0x179)]('value.valve')||_0x27b67a['includes']('%'));if(_0x294621){const _0x492b08=_0x8f5741[_0x38596a(0xf5)](/[._]+/)[_0x38596a(0x128)](_0x42fb6a=>_0x42fb6a[_0x38596a(0x187)]());let _0x445196=0x0;_0x4d3b52[_0x38596a(0x184)](_0x40bb7b=>{const _0x55ee2e=_0x38596a;if(_0x492b08['includes'](_0x40bb7b[_0x55ee2e(0x187)]()))_0x445196++;}),_0x2df728[_0x38596a(0x181)]({'id':_0x8f5741,'score':_0x445196});}}}if(_0x2df728[_0x38596a(0x115)]>0x0){_0x2df728[_0x38596a(0x15a)]((_0x364f84,_0x4f9bea)=>_0x4f9bea[_0x38596a(0x142)]-_0x364f84['score']);if(_0x2df728[0x0][_0x38596a(0x142)]>0x0)return _0x2df728[0x0]['id'];}}}catch(_0x4ad095){}return null;}function a1_0x2b63(){const _0x1c851a=['getForeignObjectsAsync','\x20wurde\x20manuell\x20erh√∂ht\x20(','Manuelles\x20Mapping','messwert','_calName','map','location','.1.LEVEL','6868250gyhCRa','¬∞C).','[MPC]\x20','(((.+)+)+)+$','warn','analysis.automation.lastAction','unshift','trim','analysis.energy.mpcActiveInterventions','triggerTime','stringify','setForeignStateAsync','openknx','temperature','ankunft','üéì\x20[RL-FEEDBACK]\x20Lerne\x20aus\x20Fehler:\x20','apply','Pr√§diktion:\x20','add','pi_heating_demand','\x20gefunden!','valve_position','toString','score','level.valve','write','config',':\x20Aufheizen\x20auf\x20','calendarInstance','number','name','980430qJuOvH','r√ºckkehr','9ZBhCHj','slice','¬∞C).\x20Entferne\x20Status.','SET_POINT_TEMPERATURE','switch','getStateAsync','üî•\x20[MPC\x20ACTION]\x20Heize\x20','.1.SET_POINT_TEMPERATURE','.1.TEMPERATURE','stellwert','127780fOhvOI','default','getForeignObjectAsync','48FInfIy','sort','from','log','analysis.automation.actionLog','üìÖ\x20SMART\x20SCHEDULE\x20(Phase):\x20\x27Globaler\x20Start\x27\x20erkannt.\x20Heize\x20Haus\x20auf\x20(Vorlauf:\x20','event','¬∞C\x20(Vorlauf:\x20','state','remove','./ai_agent','normal','Auto-Erkennung','getForeignStateAsync','analysis.energy.schedulePreview','setStateAsync','354424csVUYi','now','getTime','3YWFyIJ','level','summary','type','off','Ist','analysis.energy.warmupSources','info','temp','setpoint','search','ACTUAL_TEMPERATURE','unit','includes','val','level.temperature','find','Soll','\x20min)','role','string','push','constructor','\x20wurde\x20gesenkt\x20(Fenster/Aus).\x20Keine\x20RL-Strafe.','forEach','Unbekannt','local_temperature','toLowerCase','actual','thermostat','common','replace','4paiZHb','analysis.automation.mode','.data.table','.1.ACTUAL_TEMPERATURE','üìÖ\x20SMART\x20SCHEDULE\x20[','¬∞C\x20(via\x20','parse','Fehlt',']:\x20Raum-Trigger\x20\x27','occupied_heating_setpoint','valve','ist','sensor','split','Unknown','1498505nvhcyP','\x27\x20aktiv.\x20Heize\x20auf\x20','SET','toUpperCase','cal_','values','abs','light','minutes_safe','Calendar\x20Check\x20Error:\x20','16268186ufBWwF','devices','TRAIN_RL_PENALTY','thermostatMapping','\x20wieder\x20auf\x20','analysis.energy.warmupTimes','filter','\x20ist\x20auf\x20','set','room','urlaub\x20ende','ACTUAL','calendarSelection','system.mode','[CAL]\x20','\x20->\x20','exports','approved','sendToPythonWrapper','analysis.energy.warmupTargets','length','target','date','2356152zBxrOm','mpc_','useCalendar','‚ÑπÔ∏è\x20[MPC\x20INFO]\x20','PERFECT','[MPC\x20WARNING]\x20Kein\x20Setpoint\x20f√ºr\x20','splice','_date','target_temperature','consultButler','eventStart'];a1_0x2b63=function(){return _0x1c851a;};return a1_0x2b63();}async function scanThermostats(_0x441a46){const _0x4d9777=a1_0x583132,_0x571452=_0x441a46['config']['devices']||[],_0x35e72d=[],_0x2c442e=_0x571452[_0x4d9777(0x107)](_0x448668=>_0x448668['id']&&_0x448668['id'][_0x4d9777(0x179)](_0x4d9777(0x138))||_0x448668[_0x4d9777(0x16f)]&&[_0x4d9777(0x138),_0x4d9777(0x189),_0x4d9777(0xf4)][_0x4d9777(0x179)](_0x448668[_0x4d9777(0x16f)])||_0x448668[_0x4d9777(0x149)]&&_0x448668['name'][_0x4d9777(0x187)]()[_0x4d9777(0x179)](_0x4d9777(0x174)));for(const _0x2d1e46 of _0x2c442e){const _0x26b0cd=await findRelatedId(_0x441a46,_0x2d1e46['id'],_0x4d9777(0x175)),_0x1379a5=await findRelatedId(_0x441a46,_0x2d1e46['id'],_0x4d9777(0xf2));let _0x6065c9='Nicht\x20gefunden',_0x735764=![],_0x596e96=_0x441a46[_0x4d9777(0x145)][_0x4d9777(0x104)]||{};if(typeof _0x596e96===_0x4d9777(0x180))try{_0x596e96=JSON[_0x4d9777(0x192)](_0x596e96);}catch(_0x6a3c63){}let _0x2c262f=_0x441a46[_0x4d9777(0x145)]['valveMapping']||{};if(typeof _0x2c262f===_0x4d9777(0x180))try{_0x2c262f=JSON[_0x4d9777(0x192)](_0x2c262f);}catch(_0x296f2f){}if(_0x596e96[_0x2d1e46['id']]&&_0x596e96[_0x2d1e46['id']]===_0x26b0cd||_0x2c262f[_0x2d1e46['id']]&&_0x2c262f[_0x2d1e46['id']]===_0x1379a5)_0x6065c9=_0x4d9777(0x125),_0x735764=!![];else(_0x26b0cd||_0x1379a5)&&(_0x6065c9=_0x4d9777(0x165));_0x35e72d['push']({'room':_0x2d1e46['location']||_0x4d9777(0x185),'sensorId':_0x2d1e46['id'],'setpointId':_0x26b0cd||'-','valveId':_0x1379a5||'-','source':_0x6065c9,'isManual':_0x735764,'status':_0x26b0cd&&_0x1379a5?_0x4d9777(0x11c):_0x26b0cd?'OK':_0x4d9777(0x193)});}return _0x35e72d[_0x4d9777(0x15a)]((_0x32986d,_0x45704a)=>_0x32986d[_0x4d9777(0x10a)]['localeCompare'](_0x45704a[_0x4d9777(0x10a)]));}async function updateSchedulePreview(_0x551509){const _0x3c2a7d=a1_0x583132;if(!_0x551509['config'][_0x3c2a7d(0x11a)]||!_0x551509[_0x3c2a7d(0x145)][_0x3c2a7d(0x147)])return;let _0x14dcef={};try{const _0x2a20c5=await _0x551509[_0x3c2a7d(0x151)]('analysis.energy.warmupTimes');if(_0x2a20c5&&_0x2a20c5[_0x3c2a7d(0x17a)])_0x14dcef=JSON[_0x3c2a7d(0x192)](_0x2a20c5[_0x3c2a7d(0x17a)]);}catch(_0x1a4ea1){}const _0x5ad7de=[],_0x58675d=Date[_0x3c2a7d(0x16a)](),_0x1346f5=0x30*0x3c*0x3c*0x3e8;try{const _0x1ad402=await _0x551509['getForeignStateAsync'](_0x551509[_0x3c2a7d(0x145)]['calendarInstance']+'.data.table');if(!_0x1ad402||!_0x1ad402[_0x3c2a7d(0x17a)])return;const _0x22857d=JSON[_0x3c2a7d(0x192)](_0x1ad402[_0x3c2a7d(0x17a)]),_0x5abc60=_0x551509[_0x3c2a7d(0x145)][_0x3c2a7d(0x10d)]||[],_0x21dfc8=_0x551509['config'][_0x3c2a7d(0x102)]||[],_0x5168d9=new Set();_0x21dfc8[_0x3c2a7d(0x184)](_0x4c49a8=>{const _0x57b809=_0x3c2a7d;if(_0x4c49a8[_0x57b809(0x129)])_0x5168d9[_0x57b809(0x13d)](_0x4c49a8[_0x57b809(0x129)]);});for(const _0x3b3f7e of _0x22857d){if(_0x3b3f7e[_0x3c2a7d(0x127)]&&_0x5abc60[_0x3c2a7d(0x115)]>0x0&&!_0x5abc60[_0x3c2a7d(0x179)](_0x3b3f7e['_calName']))continue;const _0x262666=_0x3b3f7e[_0x3c2a7d(0x11f)]||_0x3b3f7e[_0x3c2a7d(0x122)]||_0x3b3f7e[_0x3c2a7d(0x117)];if(!_0x262666)continue;const _0x10a8f2=new Date(_0x262666),_0x17313e=_0x10a8f2[_0x3c2a7d(0x16b)]();if(isNaN(_0x17313e))continue;if(_0x17313e<_0x58675d)continue;if(_0x17313e>_0x58675d+_0x1346f5)continue;const _0x25b5fe=(_0x3b3f7e[_0x3c2a7d(0x15f)]||_0x3b3f7e[_0x3c2a7d(0x16e)]||'')[_0x3c2a7d(0x187)]();let _0x3c69e5=![],_0x2f1e54=[],_0xb69f03=_0x3b3f7e[_0x3c2a7d(0x15f)]||_0x3b3f7e['summary']||_0x3c2a7d(0x185);if(_0x25b5fe[_0x3c2a7d(0x179)]('urlaub\x20ende')||_0x25b5fe[_0x3c2a7d(0x179)](_0x3c2a7d(0x14b))||_0x25b5fe[_0x3c2a7d(0x179)]('ankunft'))_0x3c69e5=!![],_0x2f1e54=Array[_0x3c2a7d(0x15b)](_0x5168d9);else for(const _0x534736 of _0x5168d9){if(_0x25b5fe[_0x3c2a7d(0x179)](_0x534736[_0x3c2a7d(0x187)]()))_0x2f1e54[_0x3c2a7d(0x181)](_0x534736);}_0x2f1e54[_0x3c2a7d(0x115)]>0x0&&_0x2f1e54[_0x3c2a7d(0x184)](_0x4c2f9f=>{const _0x43465e=_0x3c2a7d;let _0x18cb5d=0x3c;if(_0x3c69e5){let _0x1d2186=0x0;Object[_0x43465e(0xfc)](_0x14dcef)[_0x43465e(0x184)](_0x27d68b=>{if(_0x27d68b>_0x1d2186)_0x1d2186=_0x27d68b;}),_0x18cb5d=_0x1d2186>0x0?_0x1d2186:0x78;}else _0x18cb5d=_0x14dcef[_0x4c2f9f]||0x3c;const _0xdbc7a=new Date(_0x17313e-_0x18cb5d*0xea60);_0x5ad7de[_0x43465e(0x181)]({'eventTime':_0x17313e,'triggerTime':_0xdbc7a[_0x43465e(0x16b)](),'room':_0x4c2f9f,'minutes':_0x18cb5d,'reason':_0xb69f03,'isGlobal':_0x3c69e5});});}}catch(_0x568d5d){}_0x5ad7de[_0x3c2a7d(0x15a)]((_0x398a32,_0x39260c)=>_0x398a32[_0x3c2a7d(0x134)]-_0x39260c[_0x3c2a7d(0x134)]);const _0x2ab4b4=_0x5ad7de[_0x3c2a7d(0x14d)](0x0,0x5);await _0x551509['setStateAsync'](_0x3c2a7d(0x167),{'val':JSON[_0x3c2a7d(0x135)](_0x2ab4b4),'ack':!![]});}async function checkCalendarTriggers(_0x3263eb){const _0x30d99a=a1_0x583132;if(!_0x3263eb['config']['useCalendar']||!_0x3263eb[_0x30d99a(0x145)]['calendarInstance'])return;await updateSchedulePreview(_0x3263eb);let _0x438e20={},_0x128918={};try{const _0xdfe9c6=await _0x3263eb['getStateAsync'](_0x30d99a(0x106));if(_0xdfe9c6&&_0xdfe9c6[_0x30d99a(0x17a)])_0x438e20=JSON[_0x30d99a(0x192)](_0xdfe9c6[_0x30d99a(0x17a)]);const _0x203a20=await _0x3263eb[_0x30d99a(0x151)](_0x30d99a(0x172));if(_0x203a20&&_0x203a20['val'])_0x128918=JSON[_0x30d99a(0x192)](_0x203a20[_0x30d99a(0x17a)]);}catch(_0xdc3b7e){}let _0x3ae679={'default':0x15};try{const _0x3dcf70=await _0x3263eb[_0x30d99a(0x151)](_0x30d99a(0x114));if(_0x3dcf70&&_0x3dcf70[_0x30d99a(0x17a)])_0x3ae679=JSON['parse'](_0x3dcf70[_0x30d99a(0x17a)]);}catch(_0x5ab3ce){}try{const _0x2798f8=await _0x3263eb[_0x30d99a(0x166)](_0x3263eb[_0x30d99a(0x145)][_0x30d99a(0x147)]+_0x30d99a(0x18e));if(!_0x2798f8||!_0x2798f8[_0x30d99a(0x17a)])return;const _0x65313d=JSON['parse'](_0x2798f8['val']),_0x3ea7cb=Date[_0x30d99a(0x16a)](),_0x500938=_0x3263eb[_0x30d99a(0x145)]['devices']||[],_0x4b76ff=_0x3263eb[_0x30d99a(0x145)][_0x30d99a(0x10d)]||[];for(const _0x8f6ba2 of _0x65313d){if(_0x8f6ba2[_0x30d99a(0x127)]&&_0x4b76ff['length']>0x0&&!_0x4b76ff['includes'](_0x8f6ba2[_0x30d99a(0x127)]))continue;const _0x4e8ffe=_0x8f6ba2[_0x30d99a(0x11f)]||_0x8f6ba2[_0x30d99a(0x122)]||_0x8f6ba2[_0x30d99a(0x117)];if(!_0x4e8ffe)continue;const _0x5f05ec=new Date(_0x4e8ffe);if(isNaN(_0x5f05ec['getTime']()))continue;const _0x3727df=(_0x8f6ba2[_0x30d99a(0x15f)]||_0x8f6ba2['summary']||'')[_0x30d99a(0x187)]();if(_0x3727df[_0x30d99a(0x179)](_0x30d99a(0x10b))||_0x3727df['includes'](_0x30d99a(0x14b))||_0x3727df['includes'](_0x30d99a(0x139))){let _0x3d683f=0x0;Object[_0x30d99a(0xfc)](_0x438e20)[_0x30d99a(0x184)](_0x26c9c1=>{if(_0x26c9c1>_0x3d683f)_0x3d683f=_0x26c9c1;});if(_0x3d683f===0x0)_0x3d683f=0x78;const _0x32d844=_0x5f05ec[_0x30d99a(0x16b)]()-_0x3d683f*0xea60;_0x3ea7cb>=_0x32d844&&_0x3ea7cb<_0x5f05ec[_0x30d99a(0x16b)]()&&(_0x3263eb['currentSystemMode']!==_0x30d99a(0x164)&&(_0x3263eb[_0x30d99a(0x15c)][_0x30d99a(0x173)](_0x30d99a(0x15e)+_0x3d683f+'\x20min).'),await _0x3263eb[_0x30d99a(0x168)](_0x30d99a(0x10e),{'val':_0x30d99a(0x164),'ack':![]})));}for(const _0x595f46 of _0x500938){if(_0x595f46[_0x30d99a(0x129)]){const _0x2fb0c5=_0x595f46[_0x30d99a(0x129)]['toLowerCase']();if(_0x3727df[_0x30d99a(0x179)](_0x2fb0c5)){const _0x234a6e=_0x438e20[_0x595f46[_0x30d99a(0x129)]]||0x3c,_0x5d151c=_0x128918[_0x595f46['location']]||'Classic',_0x132ae4=_0x5f05ec[_0x30d99a(0x16b)]()-_0x234a6e*0xea60;if(_0x3ea7cb>=_0x132ae4&&_0x3ea7cb<_0x5f05ec[_0x30d99a(0x16b)]()){const _0x1fd2af=lastActions[_0x30d99a(0xfb)+_0x595f46[_0x30d99a(0x129)]];if(_0x1fd2af&&_0x3ea7cb-_0x1fd2af<CAL_COOLDOWN_MS)continue;const _0xc4bde3=await findRelatedId(_0x3263eb,_0x595f46['id'],_0x30d99a(0x175));if(_0xc4bde3){let _0x53df97=_0x3ae679[_0x595f46['location']];if(_0x53df97===undefined)_0x53df97=_0x3ae679[_0x30d99a(0x157)];if(_0x53df97===undefined)_0x53df97=0x15;const _0x1f593a=await _0x3263eb['getForeignStateAsync'](_0xc4bde3);_0x1f593a&&typeof _0x1f593a[_0x30d99a(0x17a)]===_0x30d99a(0x148)&&_0x1f593a[_0x30d99a(0x17a)]<_0x53df97-0.5&&(_0x3263eb[_0x30d99a(0x15c)][_0x30d99a(0x173)](_0x30d99a(0x190)+_0x5d151c+_0x30d99a(0x194)+_0x595f46[_0x30d99a(0x129)]+_0x30d99a(0xf8)+_0x53df97+_0x30d99a(0x160)+_0x234a6e+'\x20min).'),await _0x3263eb[_0x30d99a(0x136)](_0xc4bde3,_0x53df97),await logAutomationAction(_0x3263eb,_0x30d99a(0x10f)+_0x595f46[_0x30d99a(0x129)]+_0x30d99a(0x110)+_0x53df97+_0x30d99a(0x191)+_0x5d151c+')'),lastActions[_0x30d99a(0xfb)+_0x595f46['location']]=_0x3ea7cb);}}}}}}}catch(_0x3c9283){_0x3263eb[_0x30d99a(0x15c)]['warn'](_0x30d99a(0x100)+_0x3c9283['message']);}}async function manageMpcIntervention(_0x4366a6,_0x15f79b,_0x3ae934){const _0x1bd5c6=a1_0x583132;try{const _0x390008='analysis.energy.mpcActiveInterventions',_0x428b06=await _0x4366a6['getStateAsync'](_0x390008);let _0x5271b5=[];if(_0x428b06&&_0x428b06[_0x1bd5c6(0x17a)])try{_0x5271b5=JSON[_0x1bd5c6(0x192)](_0x428b06[_0x1bd5c6(0x17a)]);}catch(_0x9d6848){}const _0x178a92=_0x5271b5['indexOf'](_0x15f79b);if(_0x3ae934===_0x1bd5c6(0x13d))_0x178a92===-0x1&&(_0x5271b5[_0x1bd5c6(0x181)](_0x15f79b),await _0x4366a6['setStateAsync'](_0x390008,{'val':JSON[_0x1bd5c6(0x135)](_0x5271b5),'ack':!![]}));else _0x3ae934==='remove'&&(_0x178a92!==-0x1&&(_0x5271b5[_0x1bd5c6(0x11e)](_0x178a92,0x1),await _0x4366a6[_0x1bd5c6(0x168)](_0x390008,{'val':JSON[_0x1bd5c6(0x135)](_0x5271b5),'ack':!![]})));}catch(_0x3b782e){}}async function cleanupGhostInterventions(_0xb08f30){const _0x1fa42c=a1_0x583132;try{const _0x142379=_0x1fa42c(0x133),_0x4698b6=await _0xb08f30['getStateAsync'](_0x142379);if(!_0x4698b6||!_0x4698b6[_0x1fa42c(0x17a)])return;const _0x20a804=JSON[_0x1fa42c(0x192)](_0x4698b6[_0x1fa42c(0x17a)]);if(!Array['isArray'](_0x20a804)||_0x20a804[_0x1fa42c(0x115)]===0x0)return;const _0x52d45f=_0xb08f30[_0x1fa42c(0x145)][_0x1fa42c(0x102)]||[];let _0x4080c2=![];for(let _0xe2c31c=_0x20a804[_0x1fa42c(0x115)]-0x1;_0xe2c31c>=0x0;_0xe2c31c--){const _0xa81e90=_0x20a804[_0xe2c31c],_0x159b30=_0x52d45f[_0x1fa42c(0x17c)](_0x16d89a=>normalize(_0x16d89a['location'])===normalize(_0xa81e90)&&(_0x16d89a[_0x1fa42c(0x16f)]===_0x1fa42c(0x138)||_0x16d89a[_0x1fa42c(0x16f)]===_0x1fa42c(0x189)));if(_0x159b30){const _0x4bfd30=await findRelatedId(_0xb08f30,_0x159b30['id'],'setpoint');if(_0x4bfd30){const _0x1d4efa=await _0xb08f30[_0x1fa42c(0x166)](_0x4bfd30);_0x1d4efa&&typeof _0x1d4efa[_0x1fa42c(0x17a)]==='number'&&(Math[_0x1fa42c(0xfd)](_0x1d4efa[_0x1fa42c(0x17a)]-ECO_TEMP)>0.5&&(_0xb08f30[_0x1fa42c(0x15c)][_0x1fa42c(0x173)]('üßπ\x20[MPC\x20CLEANUP]\x20'+_0xa81e90+_0x1fa42c(0x108)+_0x1d4efa['val']+'¬∞C\x20(nicht\x20'+ECO_TEMP+_0x1fa42c(0x14e)),_0x1d4efa[_0x1fa42c(0x17a)]>ECO_TEMP+0.5?_0xb08f30[_0x1fa42c(0x113)]&&(_0xb08f30['log'][_0x1fa42c(0x173)](_0x1fa42c(0x13a)+_0xa81e90+_0x1fa42c(0x124)+_0x1d4efa['val']+_0x1fa42c(0x12c)),_0xb08f30[_0x1fa42c(0x113)](_0x1fa42c(0x103),{'room':_0xa81e90})):_0xb08f30['log'][_0x1fa42c(0x173)](_0x1fa42c(0x11b)+_0xa81e90+_0x1fa42c(0x183)),_0x20a804[_0x1fa42c(0x11e)](_0xe2c31c,0x1),_0x4080c2=!![]));}}}_0x4080c2&&await _0xb08f30[_0x1fa42c(0x168)](_0x142379,{'val':JSON[_0x1fa42c(0x135)](_0x20a804),'ack':!![]});}catch(_0x147081){}}async function applyEnergySavings(_0x17bb83,_0x3d2d5a){const _0x38927b=a1_0x583132;await cleanupGhostInterventions(_0x17bb83);if(!_0x3d2d5a||_0x3d2d5a['length']===0x0)return;const _0x42b640=_0x17bb83[_0x38927b(0x145)][_0x38927b(0x102)]||[],_0x556afa=Date[_0x38927b(0x16a)]();for(const _0x41a7ce of _0x3d2d5a){const _0x12b996=_0x41a7ce[_0x38927b(0x10a)],_0x2e79f3=_0x41a7ce[_0x38927b(0xff)],_0x55315c=_0x41a7ce[_0x38927b(0x116)]||0x15,_0xe02f4=_0x42b640[_0x38927b(0x17c)](_0x16c302=>normalize(_0x16c302['location'])===normalize(_0x12b996)&&(_0x16c302[_0x38927b(0x16f)]===_0x38927b(0x138)||_0x16c302[_0x38927b(0x16f)]===_0x38927b(0x189)));if(!_0xe02f4)continue;const _0x4b4bac=await findRelatedId(_0x17bb83,_0xe02f4['id'],_0x38927b(0x175));if(_0x4b4bac){if(lastActions[_0x38927b(0x119)+_0x12b996]&&_0x556afa-lastActions['mpc_'+_0x12b996]<0x1e*0x3c*0x3e8)continue;const _0x4ee337=await _0x17bb83[_0x38927b(0x166)](_0x4b4bac);if(_0x4ee337&&typeof _0x4ee337['val']===_0x38927b(0x148)){const _0x1f2293=_0x4ee337[_0x38927b(0x17a)];_0x1f2293!==ECO_TEMP&&await manageMpcIntervention(_0x17bb83,_0x12b996,_0x38927b(0x162));if(_0x2e79f3>0x1e)_0x1f2293>ECO_TEMP+0.5&&(_0x17bb83[_0x38927b(0x15c)][_0x38927b(0x173)]('üçÉ\x20[MPC\x20ACTION]\x20Senke\x20'+_0x12b996+'\x20auf\x20'+ECO_TEMP+'¬∞C!\x20(Puffer:\x20'+_0x2e79f3+_0x38927b(0x17e)),await _0x17bb83[_0x38927b(0x136)](_0x4b4bac,ECO_TEMP),await manageMpcIntervention(_0x17bb83,_0x12b996,_0x38927b(0x13d)),lastActions[_0x38927b(0x119)+_0x12b996]=_0x556afa,await logAutomationAction(_0x17bb83,_0x38927b(0x12d)+_0x12b996+':\x20Absenkung\x20auf\x20'+ECO_TEMP+'¬∞C'));else _0x2e79f3<=0xf&&(_0x1f2293<_0x55315c&&(_0x17bb83[_0x38927b(0x15c)][_0x38927b(0x173)](_0x38927b(0x152)+_0x12b996+_0x38927b(0x105)+_0x55315c+'¬∞C!\x20(Puffer\x20leer).'),await _0x17bb83[_0x38927b(0x136)](_0x4b4bac,_0x55315c),await manageMpcIntervention(_0x17bb83,_0x12b996,_0x38927b(0x162)),lastActions[_0x38927b(0x119)+_0x12b996]=_0x556afa,await logAutomationAction(_0x17bb83,_0x38927b(0x12d)+_0x12b996+_0x38927b(0x146)+_0x55315c+'¬∞C')));}}else _0x17bb83['log'][_0x38927b(0x12f)](_0x38927b(0x11d)+_0x12b996+_0x38927b(0x13f));}}module[a1_0x583132(0x111)]={'handlePrediction':handlePrediction,'applyEnergySavings':applyEnergySavings,'scanThermostats':scanThermostats,'checkCalendarTriggers':checkCalendarTriggers,'updateSchedulePreview':updateSchedulePreview,'cleanupGhostInterventions':cleanupGhostInterventions};