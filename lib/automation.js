const a1_0x563d5e=a1_0x14ff;(function(_0x5942ce,_0x455861){const _0x37ac28=a1_0x14ff,_0xbbe0f1=_0x5942ce();while(!![]){try{const _0x1c2981=parseInt(_0x37ac28(0x141))/0x1+parseInt(_0x37ac28(0x166))/0x2+-parseInt(_0x37ac28(0x112))/0x3*(parseInt(_0x37ac28(0x10b))/0x4)+parseInt(_0x37ac28(0x140))/0x5+parseInt(_0x37ac28(0x182))/0x6+-parseInt(_0x37ac28(0x150))/0x7*(-parseInt(_0x37ac28(0x13a))/0x8)+parseInt(_0x37ac28(0x10c))/0x9*(-parseInt(_0x37ac28(0x105))/0xa);if(_0x1c2981===_0x455861)break;else _0xbbe0f1['push'](_0xbbe0f1['shift']());}catch(_0x34aab2){_0xbbe0f1['push'](_0xbbe0f1['shift']());}}}(a1_0x371f,0xe4670));const a1_0xdf9ea9=(function(){let _0x4ca29b=!![];return function(_0x4d43f7,_0x4150b5){const _0x43f06d=_0x4ca29b?function(){if(_0x4150b5){const _0x5cea56=_0x4150b5['apply'](_0x4d43f7,arguments);return _0x4150b5=null,_0x5cea56;}}:function(){};return _0x4ca29b=![],_0x43f06d;};}()),a1_0x3b4e42=a1_0xdf9ea9(this,function(){const _0x2b2ee0=a1_0x14ff;return a1_0x3b4e42[_0x2b2ee0(0x130)]()[_0x2b2ee0(0x13e)]('(((.+)+)+)+$')['toString']()['constructor'](a1_0x3b4e42)[_0x2b2ee0(0x13e)](_0x2b2ee0(0x170));});a1_0x3b4e42();'use strict';const aiAgent=require('./ai_agent'),COOLDOWN_MS=0x3c*0x3e8,CAL_COOLDOWN_MS=0x5a*0x3c*0x3e8,ECO_TEMP=0x11,lastActions={};function normalize(_0x498325){const _0x43bae6=a1_0x14ff;if(!_0x498325)return'';return _0x498325[_0x43bae6(0x137)]()[_0x43bae6(0xf6)](/\s+/g,'')[_0x43bae6(0xe9)]();}async function logAutomationAction(_0x507bf0,_0x4b9a97){const _0x1f1fc2=a1_0x14ff;await _0x507bf0[_0x1f1fc2(0x174)](_0x1f1fc2(0x10d),{'val':_0x4b9a97,'ack':!![]});try{const _0x2cbac4=_0x1f1fc2(0x122),_0x32e3e1=await _0x507bf0[_0x1f1fc2(0xf2)](_0x2cbac4);let _0x9686a7=[];if(_0x32e3e1&&_0x32e3e1[_0x1f1fc2(0x15b)])try{_0x9686a7=JSON[_0x1f1fc2(0x10f)](_0x32e3e1[_0x1f1fc2(0x15b)]);}catch(_0x17ded4){}_0x9686a7[_0x1f1fc2(0x15c)]({'ts':Date['now'](),'msg':_0x4b9a97});if(_0x9686a7[_0x1f1fc2(0x15f)]>0x32)_0x9686a7=_0x9686a7[_0x1f1fc2(0x16c)](0x0,0x32);await _0x507bf0[_0x1f1fc2(0x174)](_0x2cbac4,{'val':JSON[_0x1f1fc2(0xfd)](_0x9686a7),'ack':!![]});}catch(_0x5681b5){}}async function handlePrediction(_0x3566df,_0x1248ca,_0x480fbc){const _0x9142f1=a1_0x14ff;if(!_0x1248ca||_0x1248ca===_0x9142f1(0x17f))return;let _0x51da91=_0x9142f1(0xf3),_0x11c298=0.6;try{const _0x148d97=await _0x3566df['getStateAsync'](_0x9142f1(0x11a));if(_0x148d97&&_0x148d97[_0x9142f1(0x15b)])_0x51da91=_0x148d97[_0x9142f1(0x15b)];const _0x18fb08=await _0x3566df[_0x9142f1(0xf2)](_0x9142f1(0xe2));if(_0x18fb08&&_0x18fb08['val'])_0x11c298=_0x18fb08['val'];}catch(_0x42c2c1){}if(_0x51da91===_0x9142f1(0xf3)||_0x480fbc<_0x11c298)return;const _0x42875b=Date[_0x9142f1(0x17d)]();if(lastActions[_0x1248ca]&&_0x42875b-lastActions[_0x1248ca]<COOLDOWN_MS)return;const _0x5b9b92=_0x3566df[_0x9142f1(0x123)]['devices']||[],_0x55a883=normalize(_0x1248ca),_0x2ac249=_0x5b9b92[_0x9142f1(0x115)](_0x3dbd84=>normalize(_0x3dbd84[_0x9142f1(0x15d)])===_0x55a883&&(_0x3dbd84['type']===_0x9142f1(0x16d)||_0x3dbd84['type']==='dimmer'||_0x3dbd84[_0x9142f1(0x12d)]==='switch'));if(!_0x2ac249)return;const _0x11c2e6=await aiAgent['consultButler'](_0x3566df,_0x1248ca,_0x2ac249[_0x9142f1(0x151)],_0x480fbc);if(!_0x11c2e6['approved'])return;const _0x58415e=_0x9142f1(0x121)+_0x1248ca+_0x9142f1(0x175)+_0x2ac249[_0x9142f1(0x151)]+'\x20('+_0x11c2e6['reason']+')';await logAutomationAction(_0x3566df,'['+_0x51da91[_0x9142f1(0x12c)]()+']\x20'+_0x58415e);if(_0x51da91===_0x9142f1(0x176)){const _0x289c52=await _0x3566df['getForeignStateAsync'](_0x2ac249['id']);(!_0x289c52||!_0x289c52[_0x9142f1(0x15b)]&&_0x289c52[_0x9142f1(0x15b)]!==!![])&&await _0x3566df['setForeignStateAsync'](_0x2ac249['id'],!![]),lastActions[_0x1248ca]=_0x42875b;}}async function findRelatedId(_0x2b006c,_0x295b95,_0x4e118d=a1_0x563d5e(0x13f)){const _0x4e40a5=a1_0x563d5e;if(_0x4e118d===_0x4e40a5(0x13f)&&_0x2b006c[_0x4e40a5(0x123)]['thermostatMapping']){let _0x1633db=_0x2b006c[_0x4e40a5(0x123)][_0x4e40a5(0x11c)];if(typeof _0x1633db===_0x4e40a5(0x16b))try{_0x1633db=JSON['parse'](_0x1633db);}catch(_0x1b9469){}if(_0x1633db&&_0x1633db[_0x295b95])return _0x1633db[_0x295b95];}if(_0x4e118d===_0x4e40a5(0x12f)&&_0x2b006c[_0x4e40a5(0x123)][_0x4e40a5(0x138)]){let _0xeadbd6=_0x2b006c['config'][_0x4e40a5(0x138)];if(typeof _0xeadbd6==='string')try{_0xeadbd6=JSON[_0x4e40a5(0x10f)](_0xeadbd6);}catch(_0x2f646f){}if(_0xeadbd6&&_0xeadbd6[_0x295b95])return _0xeadbd6[_0x295b95];}let _0x1573a1=[];if(_0x4e118d===_0x4e40a5(0x13f))_0x1573a1=[{'s':_0x4e40a5(0x16f),'t':_0x4e40a5(0x133)},{'s':_0x4e40a5(0x103),'t':_0x4e40a5(0x133)},{'s':_0x4e40a5(0x103),'t':_0x4e40a5(0xfc)},{'s':'ACTUAL_TEMPERATURE','t':'SET_POINT_TEMPERATURE'},{'s':_0x4e40a5(0x134),'t':_0x4e40a5(0x111)},{'s':'local_temperature','t':_0x4e40a5(0xee)},{'s':'temperature','t':_0x4e40a5(0x17a)},{'s':_0x4e40a5(0x11b),'t':_0x4e40a5(0x13b)},{'s':_0x4e40a5(0x14d),'t':'Soll'},{'s':_0x4e40a5(0x102),'t':_0x4e40a5(0x13f)}];else _0x4e118d===_0x4e40a5(0x12f)&&(_0x1573a1=[{'s':_0x4e40a5(0x16f),'t':'.1.LEVEL'},{'s':_0x4e40a5(0x103),'t':_0x4e40a5(0x117)},{'s':'.1.TEMPERATURE','t':'.4.VALVE_STATE'},{'s':_0x4e40a5(0x134),'t':_0x4e40a5(0x154)},{'s':'temperature','t':_0x4e40a5(0x168)},{'s':_0x4e40a5(0x102),'t':_0x4e40a5(0x139)}]);for(const _0x4861db of _0x1573a1){if(_0x295b95['includes'](_0x4861db['s'])){const _0x33fb04=_0x295b95[_0x4e40a5(0xf6)](_0x4861db['s'],_0x4861db['t']),_0x503923=await _0x2b006c['getForeignObjectAsync'](_0x33fb04);if(_0x503923)return _0x33fb04;}}try{const _0x5d0d02=_0x295b95['split']('.');if(_0x5d0d02[_0x4e40a5(0x15f)]>0x2){const _0x17dc02=_0x5d0d02[_0x4e40a5(0x16c)](0x0,-0x1)[_0x4e40a5(0xeb)]('.'),_0x5768a4=await _0x2b006c[_0x4e40a5(0x155)](_0x17dc02+'.*'),_0x1074e6=[],_0x1ceec8=_0x295b95[_0x4e40a5(0x119)](/[._]+/)['filter'](_0x20b467=>![_0x4e40a5(0x106),'0',_0x4e40a5(0xfb),_0x4e40a5(0x16a),_0x4e40a5(0x15e),_0x4e40a5(0x102),_0x4e40a5(0x107),_0x4e40a5(0xed),_0x4e40a5(0x158),_0x4e40a5(0x172)][_0x4e40a5(0x13c)](_0x20b467[_0x4e40a5(0x137)]()));for(const [_0x25eb12,_0x42f025]of Object[_0x4e40a5(0x136)](_0x5768a4)){if(_0x25eb12===_0x295b95)continue;if(_0x42f025&&_0x42f025[_0x4e40a5(0x16e)]){const _0x43c6aa=_0x25eb12[_0x4e40a5(0x137)](),_0x4e26a3=(_0x42f025['common'][_0x4e40a5(0x118)]||'')[_0x4e40a5(0x137)](),_0x3cf04b=(_0x42f025[_0x4e40a5(0x16e)][_0x4e40a5(0x100)]||'')[_0x4e40a5(0x137)]();let _0xf27dea=![];if(_0x4e118d===_0x4e40a5(0x13f)&&_0x42f025[_0x4e40a5(0x16e)][_0x4e40a5(0x17b)]===!![])_0xf27dea=_0x43c6aa[_0x4e40a5(0x13c)](_0x4e40a5(0xe4))||_0x43c6aa[_0x4e40a5(0x13c)]('soll')||_0x43c6aa[_0x4e40a5(0x13c)]('target')||_0x4e26a3[_0x4e40a5(0x13c)](_0x4e40a5(0x147))||_0x4e26a3[_0x4e40a5(0x13c)](_0x4e40a5(0x14b));else _0x4e118d===_0x4e40a5(0x12f)&&(_0xf27dea=_0x43c6aa[_0x4e40a5(0x13c)](_0x4e40a5(0x139))||_0x43c6aa[_0x4e40a5(0x13c)](_0x4e40a5(0x12f))||_0x43c6aa['includes'](_0x4e40a5(0x110))||_0x43c6aa['includes'](_0x4e40a5(0xf5))||_0x4e26a3[_0x4e40a5(0x13c)](_0x4e40a5(0x162))||_0x4e26a3['includes']('value.valve')||_0x3cf04b[_0x4e40a5(0x13c)]('%'));if(_0xf27dea){const _0x5e3fe4=_0x25eb12[_0x4e40a5(0x119)](/[._]+/)['map'](_0xf24cdb=>_0xf24cdb[_0x4e40a5(0x137)]());let _0x54f330=0x0;_0x1ceec8[_0x4e40a5(0x177)](_0x54ad73=>{if(_0x5e3fe4['includes'](_0x54ad73['toLowerCase']()))_0x54f330++;}),_0x1074e6['push']({'id':_0x25eb12,'score':_0x54f330});}}}if(_0x1074e6['length']>0x0){_0x1074e6[_0x4e40a5(0x11d)]((_0x1ea338,_0x576710)=>_0x576710[_0x4e40a5(0xe7)]-_0x1ea338['score']);if(_0x1074e6[0x0][_0x4e40a5(0xe7)]>0x0)return _0x1074e6[0x0]['id'];}}}catch(_0x1f92fe){}return null;}async function scanThermostats(_0x5a5b2c){const _0x1c2186=a1_0x563d5e,_0x47dbcf=_0x5a5b2c[_0x1c2186(0x123)][_0x1c2186(0xea)]||[],_0x5c7073=[],_0x1a4853=_0x47dbcf[_0x1c2186(0x143)](_0x13b2ec=>_0x13b2ec['id']&&_0x13b2ec['id'][_0x1c2186(0x13c)](_0x1c2186(0x102))||_0x13b2ec[_0x1c2186(0x12d)]&&[_0x1c2186(0x102),_0x1c2186(0xff),_0x1c2186(0xed)]['includes'](_0x13b2ec[_0x1c2186(0x12d)])||_0x13b2ec['name']&&_0x13b2ec[_0x1c2186(0x151)][_0x1c2186(0x137)]()[_0x1c2186(0x13c)]('temp'));for(const _0x50537c of _0x1a4853){const _0x27ddf4=await findRelatedId(_0x5a5b2c,_0x50537c['id'],_0x1c2186(0x13f)),_0x4364d5=await findRelatedId(_0x5a5b2c,_0x50537c['id'],_0x1c2186(0x12f));let _0x368fa7=_0x1c2186(0x181),_0x591091=![],_0x76fb80=_0x5a5b2c[_0x1c2186(0x123)][_0x1c2186(0x11c)]||{};if(typeof _0x76fb80===_0x1c2186(0x16b))try{_0x76fb80=JSON[_0x1c2186(0x10f)](_0x76fb80);}catch(_0x51d4df){}let _0x3328c2=_0x5a5b2c[_0x1c2186(0x123)]['valveMapping']||{};if(typeof _0x3328c2===_0x1c2186(0x16b))try{_0x3328c2=JSON[_0x1c2186(0x10f)](_0x3328c2);}catch(_0xd459ca){}if(_0x76fb80[_0x50537c['id']]&&_0x76fb80[_0x50537c['id']]===_0x27ddf4||_0x3328c2[_0x50537c['id']]&&_0x3328c2[_0x50537c['id']]===_0x4364d5)_0x368fa7=_0x1c2186(0x159),_0x591091=!![];else(_0x27ddf4||_0x4364d5)&&(_0x368fa7=_0x1c2186(0x14e));_0x5c7073['push']({'room':_0x50537c[_0x1c2186(0x15d)]||_0x1c2186(0xf0),'sensorId':_0x50537c['id'],'setpointId':_0x27ddf4||'-','valveId':_0x4364d5||'-','source':_0x368fa7,'isManual':_0x591091,'status':_0x27ddf4&&_0x4364d5?_0x1c2186(0x144):_0x27ddf4?'OK':_0x1c2186(0xe5)});}return _0x5c7073[_0x1c2186(0x11d)]((_0x46b9c2,_0x261544)=>_0x46b9c2[_0x1c2186(0x128)][_0x1c2186(0x14c)](_0x261544[_0x1c2186(0x128)]));}async function updateSchedulePreview(_0x564ac2){const _0x23d2bb=a1_0x563d5e;if(!_0x564ac2['config'][_0x23d2bb(0xf9)]||!_0x564ac2[_0x23d2bb(0x123)][_0x23d2bb(0x183)])return;let _0x583ded={};try{const _0x162a79=await _0x564ac2[_0x23d2bb(0xf2)](_0x23d2bb(0x124));if(_0x162a79&&_0x162a79[_0x23d2bb(0x15b)])_0x583ded=JSON[_0x23d2bb(0x10f)](_0x162a79['val']);}catch(_0xcde887){}const _0x3e4a79=[],_0x246049=Date['now'](),_0x109307=0x30*0x3c*0x3c*0x3e8;try{const _0x51aa73=await _0x564ac2[_0x23d2bb(0xf8)](_0x564ac2[_0x23d2bb(0x123)][_0x23d2bb(0x183)]+_0x23d2bb(0x178));if(!_0x51aa73||!_0x51aa73[_0x23d2bb(0x15b)])return;const _0x5b668b=JSON['parse'](_0x51aa73['val']),_0xa9690a=_0x564ac2['config']['calendarSelection']||[],_0x585c9c=_0x564ac2['config'][_0x23d2bb(0xea)]||[],_0x505986=new Set();_0x585c9c['forEach'](_0x24e9d5=>{const _0x719771=_0x23d2bb;if(_0x24e9d5[_0x719771(0x15d)])_0x505986['add'](_0x24e9d5['location']);});for(const _0x1a6083 of _0x5b668b){if(_0x1a6083[_0x23d2bb(0x109)]&&_0xa9690a[_0x23d2bb(0x15f)]>0x0&&!_0xa9690a[_0x23d2bb(0x13c)](_0x1a6083['_calName']))continue;const _0x44aee3=_0x1a6083['_date']||_0x1a6083[_0x23d2bb(0xe3)]||_0x1a6083[_0x23d2bb(0x12b)];if(!_0x44aee3)continue;const _0x3f720f=new Date(_0x44aee3),_0x54de92=_0x3f720f[_0x23d2bb(0x116)]();if(isNaN(_0x54de92))continue;if(_0x54de92<_0x246049)continue;if(_0x54de92>_0x246049+_0x109307)continue;const _0x3ccd56=(_0x1a6083[_0x23d2bb(0x156)]||_0x1a6083['summary']||'')[_0x23d2bb(0x137)]();let _0x3441db=![],_0x8c6b26=[],_0x5deff9=_0x1a6083[_0x23d2bb(0x156)]||_0x1a6083[_0x23d2bb(0x127)]||'Unbekannt';if(_0x3ccd56[_0x23d2bb(0x13c)](_0x23d2bb(0x164))||_0x3ccd56[_0x23d2bb(0x13c)](_0x23d2bb(0xe0))||_0x3ccd56[_0x23d2bb(0x13c)](_0x23d2bb(0x145)))_0x3441db=!![],_0x8c6b26=Array[_0x23d2bb(0x125)](_0x505986);else for(const _0x292ae4 of _0x505986){if(_0x3ccd56['includes'](_0x292ae4[_0x23d2bb(0x137)]()))_0x8c6b26[_0x23d2bb(0xec)](_0x292ae4);}_0x8c6b26[_0x23d2bb(0x15f)]>0x0&&_0x8c6b26['forEach'](_0x33ef31=>{const _0x518ebf=_0x23d2bb;let _0x34c8bf=0x3c;if(_0x3441db){let _0x4202ad=0x0;Object[_0x518ebf(0x171)](_0x583ded)[_0x518ebf(0x177)](_0x267182=>{if(_0x267182>_0x4202ad)_0x4202ad=_0x267182;}),_0x34c8bf=_0x4202ad>0x0?_0x4202ad:0x78;}else _0x34c8bf=_0x583ded[_0x33ef31]||0x3c;const _0x742fe6=new Date(_0x54de92-_0x34c8bf*0xea60);_0x3e4a79[_0x518ebf(0xec)]({'eventTime':_0x54de92,'triggerTime':_0x742fe6[_0x518ebf(0x116)](),'room':_0x33ef31,'minutes':_0x34c8bf,'reason':_0x5deff9,'isGlobal':_0x3441db});});}}catch(_0x54345e){}_0x3e4a79[_0x23d2bb(0x11d)]((_0x3561db,_0x5effe7)=>_0x3561db[_0x23d2bb(0x132)]-_0x5effe7[_0x23d2bb(0x132)]);const _0x47c595=_0x3e4a79[_0x23d2bb(0x16c)](0x0,0x5);await _0x564ac2[_0x23d2bb(0x174)](_0x23d2bb(0x148),{'val':JSON['stringify'](_0x47c595),'ack':!![]});}async function checkCalendarTriggers(_0x3d3d0a){const _0x4bf311=a1_0x563d5e;if(!_0x3d3d0a[_0x4bf311(0x123)][_0x4bf311(0xf9)]||!_0x3d3d0a[_0x4bf311(0x123)]['calendarInstance'])return;await updateSchedulePreview(_0x3d3d0a);let _0x5ace49={},_0x5ef7d8={};try{const _0xe031a7=await _0x3d3d0a[_0x4bf311(0xf2)]('analysis.energy.warmupTimes');if(_0xe031a7&&_0xe031a7[_0x4bf311(0x15b)])_0x5ace49=JSON[_0x4bf311(0x10f)](_0xe031a7['val']);const _0x458872=await _0x3d3d0a[_0x4bf311(0xf2)](_0x4bf311(0x15a));if(_0x458872&&_0x458872[_0x4bf311(0x15b)])_0x5ef7d8=JSON[_0x4bf311(0x10f)](_0x458872[_0x4bf311(0x15b)]);}catch(_0x437300){}let _0x29c4b8={'default':0x15};try{const _0x39e4a6=await _0x3d3d0a['getStateAsync'](_0x4bf311(0x129));if(_0x39e4a6&&_0x39e4a6[_0x4bf311(0x15b)])_0x29c4b8=JSON[_0x4bf311(0x10f)](_0x39e4a6[_0x4bf311(0x15b)]);}catch(_0x1b7ed0){}try{const _0x4f4e08=await _0x3d3d0a['getForeignStateAsync'](_0x3d3d0a[_0x4bf311(0x123)][_0x4bf311(0x183)]+_0x4bf311(0x178));if(!_0x4f4e08||!_0x4f4e08['val'])return;const _0x33934a=JSON[_0x4bf311(0x10f)](_0x4f4e08[_0x4bf311(0x15b)]),_0x2553bd=Date[_0x4bf311(0x17d)](),_0x20250e=_0x3d3d0a[_0x4bf311(0x123)][_0x4bf311(0xea)]||[],_0x28c8a6=_0x3d3d0a['config'][_0x4bf311(0x10a)]||[];for(const _0x535c5b of _0x33934a){if(_0x535c5b[_0x4bf311(0x109)]&&_0x28c8a6[_0x4bf311(0x15f)]>0x0&&!_0x28c8a6['includes'](_0x535c5b[_0x4bf311(0x109)]))continue;const _0x38e435=_0x535c5b[_0x4bf311(0x142)]||_0x535c5b[_0x4bf311(0xe3)]||_0x535c5b['date'];if(!_0x38e435)continue;const _0xe730d=new Date(_0x38e435);if(isNaN(_0xe730d[_0x4bf311(0x116)]()))continue;const _0x5c4035=(_0x535c5b[_0x4bf311(0x156)]||_0x535c5b[_0x4bf311(0x127)]||'')[_0x4bf311(0x137)]();if(_0x5c4035[_0x4bf311(0x13c)]('urlaub\x20ende')||_0x5c4035[_0x4bf311(0x13c)]('rÃ¼ckkehr')||_0x5c4035[_0x4bf311(0x13c)](_0x4bf311(0x145))){let _0x316096=0x0;Object['values'](_0x5ace49)[_0x4bf311(0x177)](_0x129260=>{if(_0x129260>_0x316096)_0x316096=_0x129260;});if(_0x316096===0x0)_0x316096=0x78;const _0x4f1465=_0xe730d[_0x4bf311(0x116)]()-_0x316096*0xea60;_0x2553bd>=_0x4f1465&&_0x2553bd<_0xe730d[_0x4bf311(0x116)]()&&(_0x3d3d0a[_0x4bf311(0x104)]!==_0x4bf311(0xf7)&&(_0x3d3d0a[_0x4bf311(0x167)][_0x4bf311(0xef)](_0x4bf311(0x169)+_0x316096+_0x4bf311(0x13d)),await _0x3d3d0a['setStateAsync'](_0x4bf311(0xe6),{'val':'normal','ack':![]})));}for(const _0x25e3ec of _0x20250e){if(_0x25e3ec[_0x4bf311(0x15d)]){const _0x4b461e=_0x25e3ec[_0x4bf311(0x15d)]['toLowerCase']();if(_0x5c4035[_0x4bf311(0x13c)](_0x4b461e)){const _0x20654c=_0x5ace49[_0x25e3ec['location']]||0x3c,_0x17163d=_0x5ef7d8[_0x25e3ec[_0x4bf311(0x15d)]]||'Classic',_0x4f1c8f=_0xe730d[_0x4bf311(0x116)]()-_0x20654c*0xea60;if(_0x2553bd>=_0x4f1c8f&&_0x2553bd<_0xe730d[_0x4bf311(0x116)]()){const _0x1df4ce=lastActions[_0x4bf311(0xf1)+_0x25e3ec[_0x4bf311(0x15d)]];if(_0x1df4ce&&_0x2553bd-_0x1df4ce<CAL_COOLDOWN_MS)continue;const _0x40c41d=await findRelatedId(_0x3d3d0a,_0x25e3ec['id'],_0x4bf311(0x13f));if(_0x40c41d){let _0x44577e=_0x29c4b8[_0x25e3ec[_0x4bf311(0x15d)]];if(_0x44577e===undefined)_0x44577e=_0x29c4b8['default'];if(_0x44577e===undefined)_0x44577e=0x15;const _0x56dbbd=await _0x3d3d0a[_0x4bf311(0xf8)](_0x40c41d);_0x56dbbd&&typeof _0x56dbbd[_0x4bf311(0x15b)]===_0x4bf311(0x12e)&&_0x56dbbd[_0x4bf311(0x15b)]<_0x44577e-0.5&&(_0x3d3d0a[_0x4bf311(0x167)][_0x4bf311(0xef)](_0x4bf311(0x120)+_0x17163d+']:\x20Raum-Trigger\x20\x27'+_0x25e3ec[_0x4bf311(0x15d)]+'\x27\x20aktiv.\x20Heize\x20auf\x20'+_0x44577e+'Â°C\x20(Vorlauf:\x20'+_0x20654c+'\x20min).'),await _0x3d3d0a[_0x4bf311(0x165)](_0x40c41d,_0x44577e),await logAutomationAction(_0x3d3d0a,_0x4bf311(0x114)+_0x25e3ec[_0x4bf311(0x15d)]+'\x20->\x20'+_0x44577e+_0x4bf311(0xf4)+_0x17163d+')'),lastActions['cal_'+_0x25e3ec['location']]=_0x2553bd);}}}}}}}catch(_0x2239ee){_0x3d3d0a['log'][_0x4bf311(0x152)](_0x4bf311(0x157)+_0x2239ee[_0x4bf311(0xfe)]);}}async function manageMpcIntervention(_0x3003bd,_0x22fb2c,_0x59fe95){const _0x15943d=a1_0x563d5e;try{const _0x23082f=_0x15943d(0x161),_0x538122=await _0x3003bd['getStateAsync'](_0x23082f);let _0x4ba2f4=[];if(_0x538122&&_0x538122[_0x15943d(0x15b)])try{_0x4ba2f4=JSON[_0x15943d(0x10f)](_0x538122['val']);}catch(_0x51c212){}const _0xec2fa3=_0x4ba2f4[_0x15943d(0x113)](_0x22fb2c);if(_0x59fe95===_0x15943d(0x131))_0xec2fa3===-0x1&&(_0x4ba2f4[_0x15943d(0xec)](_0x22fb2c),await _0x3003bd[_0x15943d(0x174)](_0x23082f,{'val':JSON[_0x15943d(0xfd)](_0x4ba2f4),'ack':!![]}));else _0x59fe95===_0x15943d(0x126)&&(_0xec2fa3!==-0x1&&(_0x4ba2f4[_0x15943d(0x160)](_0xec2fa3,0x1),await _0x3003bd[_0x15943d(0x174)](_0x23082f,{'val':JSON['stringify'](_0x4ba2f4),'ack':!![]})));}catch(_0x2bb4ed){}}async function cleanupGhostInterventions(_0x43e961){const _0x5a6c26=a1_0x563d5e;try{const _0x117519=_0x5a6c26(0x161),_0x426d01=await _0x43e961[_0x5a6c26(0xf2)](_0x117519);if(!_0x426d01||!_0x426d01[_0x5a6c26(0x15b)])return;const _0x4feb63=JSON[_0x5a6c26(0x10f)](_0x426d01[_0x5a6c26(0x15b)]);if(!Array[_0x5a6c26(0xfa)](_0x4feb63)||_0x4feb63[_0x5a6c26(0x15f)]===0x0)return;const _0x25e8df=_0x43e961['config']['devices']||[];let _0x1c8ef7=![];for(let _0x181c96=_0x4feb63['length']-0x1;_0x181c96>=0x0;_0x181c96--){const _0x314c7d=_0x4feb63[_0x181c96],_0x8e7863=_0x25e8df[_0x5a6c26(0x115)](_0x10f5a5=>normalize(_0x10f5a5[_0x5a6c26(0x15d)])===normalize(_0x314c7d)&&(_0x10f5a5[_0x5a6c26(0x12d)]===_0x5a6c26(0x102)||_0x10f5a5[_0x5a6c26(0x12d)]===_0x5a6c26(0xff)));if(_0x8e7863){const _0x557d99=await findRelatedId(_0x43e961,_0x8e7863['id'],_0x5a6c26(0x13f));if(_0x557d99){const _0x5d330a=await _0x43e961['getForeignStateAsync'](_0x557d99);_0x5d330a&&typeof _0x5d330a['val']===_0x5a6c26(0x12e)&&(Math['abs'](_0x5d330a['val']-ECO_TEMP)>0.5&&(_0x43e961[_0x5a6c26(0x167)][_0x5a6c26(0xef)]('ðŸ§¹\x20[MPC\x20CLEANUP]\x20'+_0x314c7d+'\x20ist\x20auf\x20'+_0x5d330a[_0x5a6c26(0x15b)]+_0x5a6c26(0x10e)+ECO_TEMP+_0x5a6c26(0x180)),_0x5d330a[_0x5a6c26(0x15b)]>ECO_TEMP+0.5?_0x43e961['sendToPythonWrapper']&&(_0x43e961[_0x5a6c26(0x167)]['info'](_0x5a6c26(0x17c)+_0x314c7d+_0x5a6c26(0xe1)+_0x5d330a['val']+_0x5a6c26(0x14a)),_0x43e961[_0x5a6c26(0x108)](_0x5a6c26(0x173),{'room':_0x314c7d})):_0x43e961[_0x5a6c26(0x167)]['info'](_0x5a6c26(0x11f)+_0x314c7d+'\x20wurde\x20gesenkt\x20(Fenster/Aus).\x20Keine\x20RL-Strafe.'),_0x4feb63['splice'](_0x181c96,0x1),_0x1c8ef7=!![]));}}}_0x1c8ef7&&await _0x43e961[_0x5a6c26(0x174)](_0x117519,{'val':JSON[_0x5a6c26(0xfd)](_0x4feb63),'ack':!![]});}catch(_0x167658){}}async function applyEnergySavings(_0x340617,_0x327220){const _0x1db93f=a1_0x563d5e;await cleanupGhostInterventions(_0x340617);if(!_0x327220||_0x327220['length']===0x0)return;const _0x14f7ed=_0x340617[_0x1db93f(0x123)][_0x1db93f(0xea)]||[],_0x348e78=Date['now']();for(const _0x44b61d of _0x327220){const _0x71d405=_0x44b61d['room'],_0x14f6a9=_0x44b61d[_0x1db93f(0x163)],_0x27f8c0=_0x44b61d[_0x1db93f(0x146)]||0x15,_0x51bcec=_0x14f7ed[_0x1db93f(0x115)](_0x6f68ce=>normalize(_0x6f68ce[_0x1db93f(0x15d)])===normalize(_0x71d405)&&(_0x6f68ce[_0x1db93f(0x12d)]==='temperature'||_0x6f68ce[_0x1db93f(0x12d)]==='thermostat'));if(!_0x51bcec)continue;const _0x322f52=await findRelatedId(_0x340617,_0x51bcec['id'],_0x1db93f(0x13f));if(_0x322f52){if(lastActions[_0x1db93f(0x12a)+_0x71d405]&&_0x348e78-lastActions[_0x1db93f(0x12a)+_0x71d405]<0x1e*0x3c*0x3e8)continue;const _0x45f95f=await _0x340617['getForeignStateAsync'](_0x322f52);if(_0x45f95f&&typeof _0x45f95f[_0x1db93f(0x15b)]===_0x1db93f(0x12e)){const _0x29231e=_0x45f95f['val'];_0x29231e!==ECO_TEMP&&await manageMpcIntervention(_0x340617,_0x71d405,_0x1db93f(0x126));if(_0x14f6a9>0x1e)_0x29231e>ECO_TEMP+0.5&&(_0x340617[_0x1db93f(0x167)][_0x1db93f(0xef)](_0x1db93f(0x101)+_0x71d405+_0x1db93f(0xe8)+ECO_TEMP+_0x1db93f(0x14f)+_0x14f6a9+_0x1db93f(0x11e)),await _0x340617['setForeignStateAsync'](_0x322f52,ECO_TEMP),await manageMpcIntervention(_0x340617,_0x71d405,'add'),lastActions['mpc_'+_0x71d405]=_0x348e78,await logAutomationAction(_0x340617,_0x1db93f(0x149)+_0x71d405+':\x20Absenkung\x20auf\x20'+ECO_TEMP+'Â°C'));else _0x14f6a9<=0xf&&(_0x29231e<_0x27f8c0&&(_0x340617[_0x1db93f(0x167)][_0x1db93f(0xef)](_0x1db93f(0x135)+_0x71d405+_0x1db93f(0x179)+_0x27f8c0+'Â°C!\x20(Puffer\x20leer).'),await _0x340617[_0x1db93f(0x165)](_0x322f52,_0x27f8c0),await manageMpcIntervention(_0x340617,_0x71d405,_0x1db93f(0x126)),lastActions[_0x1db93f(0x12a)+_0x71d405]=_0x348e78,await logAutomationAction(_0x340617,_0x1db93f(0x149)+_0x71d405+':\x20Aufheizen\x20auf\x20'+_0x27f8c0+'Â°C')));}}else _0x340617['log']['warn']('[MPC\x20WARNING]\x20Kein\x20Setpoint\x20fÃ¼r\x20'+_0x71d405+_0x1db93f(0x17e));}}function a1_0x14ff(_0x194ab6,_0x308d47){const _0x3f4cba=a1_0x371f();return a1_0x14ff=function(_0x3b4e42,_0xdf9ea9){_0x3b4e42=_0x3b4e42-0xe0;let _0x371f3a=_0x3f4cba[_0x3b4e42];return _0x371f3a;},a1_0x14ff(_0x194ab6,_0x308d47);}function a1_0x371f(){const _0x2d6b7f=['getForeignStateAsync','useCalendar','isArray','hm-rpc','.4.SET_TEMPERATURE','stringify','message','thermostat','unit','ðŸƒ\x20[MPC\x20ACTION]\x20Senke\x20','temperature','.1.TEMPERATURE','currentSystemMode','32991610exlHtT','openknx','actual','sendToPythonWrapper','_calName','calendarSelection','4405020FaDZXg','9BPuRMC','analysis.automation.lastAction','Â°C\x20(nicht\x20','parse','stellwert','occupied_heating_setpoint','3PHCVEK','indexOf','[CAL]\x20','find','getTime','.1.LEVEL','role','split','analysis.automation.mode','ACTUAL','thermostatMapping','sort','\x20min)','â„¹ï¸\x20[MPC\x20INFO]\x20','ðŸ“…\x20SMART\x20SCHEDULE\x20[','PrÃ¤diktion:\x20','analysis.automation.actionLog','config','analysis.energy.warmupTimes','from','remove','summary','room','analysis.energy.warmupTargets','mpc_','date','toUpperCase','type','number','valve','toString','add','triggerTime','.1.SET_POINT_TEMPERATURE','local_temperature','ðŸ”¥\x20[MPC\x20ACTION]\x20Heize\x20','entries','toLowerCase','valveMapping','level','1323776lrYkdp','SET','includes','\x20min).','search','setpoint','8388815wVHvrO','445981EpkyAm','_date','filter','PERFECT','ankunft','target','level.temperature','analysis.energy.schedulePreview','[MPC]\x20','Â°C).','thermostat.setpoint','localeCompare','Ist','Auto-Erkennung','Â°C!\x20(Puffer:\x20','14wwHgxH','name','warn','exports','pi_heating_demand','getForeignObjectsAsync','event','Calendar\x20Check\x20Error:\x20','messwert','Manuelles\x20Mapping','analysis.energy.warmupSources','val','unshift','location','wert','length','splice','analysis.energy.mpcActiveInterventions','level.valve','minutes_safe','urlaub\x20ende','setForeignStateAsync','3245870WrwBQI','log','valve_position','ðŸ“…\x20SMART\x20SCHEDULE\x20(Phase):\x20\x27Globaler\x20Start\x27\x20erkannt.\x20Heize\x20Haus\x20auf\x20(Vorlauf:\x20','ist','string','slice','light','common','.1.ACTUAL_TEMPERATURE','(((.+)+)+)+$','values','state','TRAIN_RL_PENALTY','setStateAsync','\x20->\x20Schalte\x20','active','forEach','.data.table','\x20wieder\x20auf\x20','target_temperature','write','ðŸŽ“\x20[RL-FEEDBACK]\x20Lerne\x20aus\x20Fehler:\x20','now','\x20gefunden!','Unknown','Â°C).\x20Entferne\x20Status.','Nicht\x20gefunden','7549974abSORe','calendarInstance','rÃ¼ckkehr','\x20wurde\x20manuell\x20erhÃ¶ht\x20(','analysis.automation.confidenceThreshold','eventStart','set','Fehlt','system.mode','score','\x20auf\x20','trim','devices','join','push','sensor','current_heating_setpoint','info','Unbekannt','cal_','getStateAsync','off','Â°C\x20(via\x20','position','replace','normal'];a1_0x371f=function(){return _0x2d6b7f;};return a1_0x371f();}module[a1_0x563d5e(0x153)]={'handlePrediction':handlePrediction,'applyEnergySavings':applyEnergySavings,'scanThermostats':scanThermostats,'checkCalendarTriggers':checkCalendarTriggers,'updateSchedulePreview':updateSchedulePreview};