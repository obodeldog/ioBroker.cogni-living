const a1_0x453fd=a1_0x3bde;(function(_0x5a4712,_0x32ca26){const _0x1cd6bd=a1_0x3bde,_0x52ac30=_0x5a4712();while(!![]){try{const _0x245841=parseInt(_0x1cd6bd(0x1f2))/0x1+parseInt(_0x1cd6bd(0x18d))/0x2+parseInt(_0x1cd6bd(0x19c))/0x3+-parseInt(_0x1cd6bd(0x20b))/0x4+-parseInt(_0x1cd6bd(0x212))/0x5+-parseInt(_0x1cd6bd(0x20c))/0x6+parseInt(_0x1cd6bd(0x192))/0x7*(parseInt(_0x1cd6bd(0x1a2))/0x8);if(_0x245841===_0x32ca26)break;else _0x52ac30['push'](_0x52ac30['shift']());}catch(_0x4e1ab8){_0x52ac30['push'](_0x52ac30['shift']());}}}(a1_0x52f8,0x40f16));function a1_0x3bde(_0x77229,_0x2ff183){const _0x21ab5c=a1_0x52f8();return a1_0x3bde=function(_0x486d02,_0x477966){_0x486d02=_0x486d02-0x186;let _0x52f8d2=_0x21ab5c[_0x486d02];return _0x52f8d2;},a1_0x3bde(_0x77229,_0x2ff183);}const a1_0x477966=(function(){let _0x16c1b2=!![];return function(_0x15af3f,_0x27e52e){const _0x3267d9=_0x16c1b2?function(){if(_0x27e52e){const _0x5415f3=_0x27e52e['apply'](_0x15af3f,arguments);return _0x27e52e=null,_0x5415f3;}}:function(){};return _0x16c1b2=![],_0x3267d9;};}()),a1_0x486d02=a1_0x477966(this,function(){const _0x54be40=a1_0x3bde;return a1_0x486d02[_0x54be40(0x198)]()['search'](_0x54be40(0x1b9))[_0x54be40(0x198)]()['constructor'](a1_0x486d02)[_0x54be40(0x18b)](_0x54be40(0x1b9));});a1_0x486d02();'use strict';const aiAgent=require(a1_0x453fd(0x220)),COOLDOWN_MS=0x3c*0x3e8,CAL_COOLDOWN_MS=0x5a*0x3c*0x3e8,ECO_TEMP=0x11,lastActions={};function normalize(_0x40f1a7){const _0x2e98f0=a1_0x453fd;if(!_0x40f1a7)return'';return _0x40f1a7[_0x2e98f0(0x1c4)]()[_0x2e98f0(0x1e8)](/\s+/g,'')[_0x2e98f0(0x1e7)]();}async function logAutomationAction(_0x20d913,_0x29d175){const _0xd591b4=a1_0x453fd;await _0x20d913[_0xd591b4(0x219)]('analysis.automation.lastAction',{'val':_0x29d175,'ack':!![]});try{const _0x5e6e04='analysis.automation.actionLog',_0x24c08b=await _0x20d913[_0xd591b4(0x19e)](_0x5e6e04);let _0x5db7a5=[];if(_0x24c08b&&_0x24c08b[_0xd591b4(0x216)])try{_0x5db7a5=JSON[_0xd591b4(0x186)](_0x24c08b[_0xd591b4(0x216)]);}catch(_0x539093){}_0x5db7a5[_0xd591b4(0x199)]({'ts':Date['now'](),'msg':_0x29d175});if(_0x5db7a5[_0xd591b4(0x194)]>0x32)_0x5db7a5=_0x5db7a5[_0xd591b4(0x18a)](0x0,0x32);await _0x20d913[_0xd591b4(0x219)](_0x5e6e04,{'val':JSON[_0xd591b4(0x1a3)](_0x5db7a5),'ack':!![]});}catch(_0x5cd131){}}async function handlePrediction(_0x584f8c,_0x194351,_0xe5d2ca){const _0x2dd61a=a1_0x453fd;if(!_0x194351||_0x194351===_0x2dd61a(0x21e))return;let _0x40630e=_0x2dd61a(0x20a),_0x26be9a=0.6;try{const _0x360006=await _0x584f8c[_0x2dd61a(0x19e)](_0x2dd61a(0x1f1));if(_0x360006&&_0x360006[_0x2dd61a(0x216)])_0x40630e=_0x360006['val'];const _0x47c17d=await _0x584f8c[_0x2dd61a(0x19e)](_0x2dd61a(0x214));if(_0x47c17d&&_0x47c17d[_0x2dd61a(0x216)])_0x26be9a=_0x47c17d[_0x2dd61a(0x216)];}catch(_0x3a3f74){}if(_0x40630e===_0x2dd61a(0x20a)||_0xe5d2ca<_0x26be9a)return;const _0x577a91=Date[_0x2dd61a(0x1b2)]();if(lastActions[_0x194351]&&_0x577a91-lastActions[_0x194351]<COOLDOWN_MS)return;const _0x810f31=_0x584f8c['config']['devices']||[],_0x521e34=normalize(_0x194351),_0x95f802=_0x810f31[_0x2dd61a(0x1d4)](_0x2da787=>normalize(_0x2da787[_0x2dd61a(0x1cb)])===_0x521e34&&(_0x2da787['type']===_0x2dd61a(0x1a6)||_0x2da787[_0x2dd61a(0x1f6)]===_0x2dd61a(0x1dc)||_0x2da787[_0x2dd61a(0x1f6)]===_0x2dd61a(0x1f9)));if(!_0x95f802)return;const _0x5d306d=await aiAgent['consultButler'](_0x584f8c,_0x194351,_0x95f802[_0x2dd61a(0x18e)],_0xe5d2ca);if(!_0x5d306d[_0x2dd61a(0x1fc)])return;const _0x13424b='Pr√§diktion:\x20'+_0x194351+_0x2dd61a(0x19a)+_0x95f802[_0x2dd61a(0x18e)]+'\x20('+_0x5d306d['reason']+')';await logAutomationAction(_0x584f8c,'['+_0x40630e['toUpperCase']()+']\x20'+_0x13424b);if(_0x40630e===_0x2dd61a(0x213)){const _0x2ac786=await _0x584f8c[_0x2dd61a(0x1fe)](_0x95f802['id']);(!_0x2ac786||!_0x2ac786[_0x2dd61a(0x216)]&&_0x2ac786['val']!==!![])&&await _0x584f8c[_0x2dd61a(0x1b8)](_0x95f802['id'],!![]),lastActions[_0x194351]=_0x577a91;}}async function findRelatedId(_0x17ab47,_0x4c795b,_0x33950a=a1_0x453fd(0x1e3)){const _0x44a1ff=a1_0x453fd;if(_0x33950a===_0x44a1ff(0x1e3)&&_0x17ab47[_0x44a1ff(0x1ea)][_0x44a1ff(0x1c1)]){let _0x4b11c5=_0x17ab47[_0x44a1ff(0x1ea)]['thermostatMapping'];if(typeof _0x4b11c5===_0x44a1ff(0x1ab))try{_0x4b11c5=JSON[_0x44a1ff(0x186)](_0x4b11c5);}catch(_0x4dc45a){}if(_0x4b11c5&&_0x4b11c5[_0x4c795b])return _0x4b11c5[_0x4c795b];}if(_0x33950a===_0x44a1ff(0x1c7)&&_0x17ab47[_0x44a1ff(0x1ea)]['valveMapping']){let _0x183641=_0x17ab47[_0x44a1ff(0x1ea)][_0x44a1ff(0x206)];if(typeof _0x183641===_0x44a1ff(0x1ab))try{_0x183641=JSON[_0x44a1ff(0x186)](_0x183641);}catch(_0xe88bb3){}if(_0x183641&&_0x183641[_0x4c795b])return _0x183641[_0x4c795b];}let _0x43f633=[];if(_0x33950a===_0x44a1ff(0x1e3))_0x43f633=[{'s':_0x44a1ff(0x1db),'t':_0x44a1ff(0x19b)},{'s':_0x44a1ff(0x1c3),'t':_0x44a1ff(0x19b)},{'s':_0x44a1ff(0x1c3),'t':_0x44a1ff(0x1e1)},{'s':'ACTUAL_TEMPERATURE','t':'SET_POINT_TEMPERATURE'},{'s':_0x44a1ff(0x208),'t':_0x44a1ff(0x1bf)},{'s':_0x44a1ff(0x208),'t':'current_heating_setpoint'},{'s':_0x44a1ff(0x215),'t':_0x44a1ff(0x1d0)},{'s':_0x44a1ff(0x210),'t':_0x44a1ff(0x1aa)},{'s':_0x44a1ff(0x1c6),'t':_0x44a1ff(0x1ae)},{'s':'temperature','t':_0x44a1ff(0x1e3)}];else _0x33950a===_0x44a1ff(0x1c7)&&(_0x43f633=[{'s':_0x44a1ff(0x1db),'t':_0x44a1ff(0x1e9)},{'s':_0x44a1ff(0x1c3),'t':'.1.LEVEL'},{'s':_0x44a1ff(0x1c3),'t':'.4.VALVE_STATE'},{'s':'local_temperature','t':_0x44a1ff(0x209)},{'s':'temperature','t':_0x44a1ff(0x18c)},{'s':_0x44a1ff(0x215),'t':_0x44a1ff(0x1b7)}]);for(const _0x264ee0 of _0x43f633){if(_0x4c795b[_0x44a1ff(0x1e4)](_0x264ee0['s'])){const _0xfd5f72=_0x4c795b[_0x44a1ff(0x1e8)](_0x264ee0['s'],_0x264ee0['t']),_0x76fa97=await _0x17ab47[_0x44a1ff(0x1f4)](_0xfd5f72);if(_0x76fa97)return _0xfd5f72;}}try{const _0x45bc02=_0x4c795b[_0x44a1ff(0x189)]('.');if(_0x45bc02[_0x44a1ff(0x194)]>0x2){const _0x560d56=_0x45bc02[_0x44a1ff(0x18a)](0x0,-0x1)[_0x44a1ff(0x1ef)]('.'),_0x42c731=await _0x17ab47[_0x44a1ff(0x20d)](_0x560d56+'.*'),_0x56f552=[],_0x2da1d3=_0x4c795b[_0x44a1ff(0x189)](/[._]+/)[_0x44a1ff(0x1ec)](_0x4d0a3c=>![_0x44a1ff(0x20e),'0',_0x44a1ff(0x1ca),_0x44a1ff(0x1bc),_0x44a1ff(0x1a7),_0x44a1ff(0x215),_0x44a1ff(0x1e2),_0x44a1ff(0x1d5),'messwert',_0x44a1ff(0x1e0)]['includes'](_0x4d0a3c['toLowerCase']()));for(const [_0x2777c4,_0x54b814]of Object[_0x44a1ff(0x1df)](_0x42c731)){if(_0x2777c4===_0x4c795b)continue;if(_0x54b814&&_0x54b814[_0x44a1ff(0x1ed)]){const _0x28edce=_0x2777c4[_0x44a1ff(0x1c4)](),_0x16dd78=(_0x54b814[_0x44a1ff(0x1ed)]['role']||'')['toLowerCase'](),_0xea929a=(_0x54b814[_0x44a1ff(0x1ed)][_0x44a1ff(0x1f3)]||'')[_0x44a1ff(0x1c4)]();let _0x3bd3f6=![];if(_0x33950a==='setpoint'&&_0x54b814[_0x44a1ff(0x1ed)][_0x44a1ff(0x18f)]===!![])_0x3bd3f6=_0x28edce[_0x44a1ff(0x1e4)](_0x44a1ff(0x1b3))||_0x28edce['includes'](_0x44a1ff(0x1d1))||_0x28edce[_0x44a1ff(0x1e4)](_0x44a1ff(0x191))||_0x16dd78[_0x44a1ff(0x1e4)](_0x44a1ff(0x1de))||_0x16dd78[_0x44a1ff(0x1e4)](_0x44a1ff(0x19f));else _0x33950a===_0x44a1ff(0x1c7)&&(_0x3bd3f6=_0x28edce[_0x44a1ff(0x1e4)]('level')||_0x28edce[_0x44a1ff(0x1e4)](_0x44a1ff(0x1c7))||_0x28edce[_0x44a1ff(0x1e4)](_0x44a1ff(0x200))||_0x28edce['includes'](_0x44a1ff(0x1e5))||_0x16dd78[_0x44a1ff(0x1e4)](_0x44a1ff(0x1a1))||_0x16dd78['includes'](_0x44a1ff(0x1b4))||_0xea929a[_0x44a1ff(0x1e4)]('%'));if(_0x3bd3f6){const _0x532f27=_0x2777c4[_0x44a1ff(0x189)](/[._]+/)[_0x44a1ff(0x1b0)](_0x2841a0=>_0x2841a0[_0x44a1ff(0x1c4)]());let _0x3d1490=0x0;_0x2da1d3[_0x44a1ff(0x1d3)](_0x1bce0f=>{const _0x32681c=_0x44a1ff;if(_0x532f27[_0x32681c(0x1e4)](_0x1bce0f[_0x32681c(0x1c4)]()))_0x3d1490++;}),_0x56f552['push']({'id':_0x2777c4,'score':_0x3d1490});}}}if(_0x56f552[_0x44a1ff(0x194)]>0x0){_0x56f552[_0x44a1ff(0x1bd)]((_0x1f793f,_0x36807b)=>_0x36807b[_0x44a1ff(0x196)]-_0x1f793f['score']);if(_0x56f552[0x0][_0x44a1ff(0x196)]>0x0)return _0x56f552[0x0]['id'];}}}catch(_0xac6026){}return null;}async function scanThermostats(_0x499d0e){const _0x4fcccc=a1_0x453fd,_0xf23769=_0x499d0e[_0x4fcccc(0x1ea)][_0x4fcccc(0x195)]||[],_0x1a0d20=[],_0xbece1d=_0xf23769[_0x4fcccc(0x1ec)](_0x11064c=>_0x11064c['id']&&_0x11064c['id'][_0x4fcccc(0x1e4)](_0x4fcccc(0x215))||_0x11064c[_0x4fcccc(0x1f6)]&&[_0x4fcccc(0x215),_0x4fcccc(0x203),'sensor'][_0x4fcccc(0x1e4)](_0x11064c[_0x4fcccc(0x1f6)])||_0x11064c[_0x4fcccc(0x18e)]&&_0x11064c[_0x4fcccc(0x18e)][_0x4fcccc(0x1c4)]()['includes']('temp'));for(const _0x3c52dd of _0xbece1d){const _0x2f6d31=await findRelatedId(_0x499d0e,_0x3c52dd['id'],_0x4fcccc(0x1e3)),_0x3b08b2=await findRelatedId(_0x499d0e,_0x3c52dd['id'],_0x4fcccc(0x1c7));let _0x230d36=_0x4fcccc(0x1d9),_0x334163=![],_0x2c448e=_0x499d0e[_0x4fcccc(0x1ea)][_0x4fcccc(0x1c1)]||{};if(typeof _0x2c448e==='string')try{_0x2c448e=JSON[_0x4fcccc(0x186)](_0x2c448e);}catch(_0x5e7ee3){}let _0x4864cc=_0x499d0e[_0x4fcccc(0x1ea)][_0x4fcccc(0x206)]||{};if(typeof _0x4864cc===_0x4fcccc(0x1ab))try{_0x4864cc=JSON['parse'](_0x4864cc);}catch(_0x3264e8){}if(_0x2c448e[_0x3c52dd['id']]&&_0x2c448e[_0x3c52dd['id']]===_0x2f6d31||_0x4864cc[_0x3c52dd['id']]&&_0x4864cc[_0x3c52dd['id']]===_0x3b08b2)_0x230d36='Manuelles\x20Mapping',_0x334163=!![];else(_0x2f6d31||_0x3b08b2)&&(_0x230d36=_0x4fcccc(0x21b));_0x1a0d20['push']({'room':_0x3c52dd[_0x4fcccc(0x1cb)]||'Unbekannt','sensorId':_0x3c52dd['id'],'setpointId':_0x2f6d31||'-','valveId':_0x3b08b2||'-','source':_0x230d36,'isManual':_0x334163,'status':_0x2f6d31&&_0x3b08b2?'PERFECT':_0x2f6d31?'OK':_0x4fcccc(0x1fb)});}return _0x1a0d20[_0x4fcccc(0x1bd)]((_0x323b8a,_0x584bb9)=>_0x323b8a[_0x4fcccc(0x21c)][_0x4fcccc(0x1ff)](_0x584bb9['room']));}async function updateSchedulePreview(_0x516445){const _0x5f5724=a1_0x453fd;if(!_0x516445[_0x5f5724(0x1ea)][_0x5f5724(0x201)]||!_0x516445[_0x5f5724(0x1ea)][_0x5f5724(0x1af)])return;let _0x24af84={};try{const _0x24f5dd=await _0x516445[_0x5f5724(0x19e)]('analysis.energy.warmupTimes');if(_0x24f5dd&&_0x24f5dd['val'])_0x24af84=JSON[_0x5f5724(0x186)](_0x24f5dd['val']);}catch(_0x364270){}const _0x3ffe46=[],_0x3edcec=Date[_0x5f5724(0x1b2)](),_0x70c2ac=0x30*0x3c*0x3c*0x3e8;try{const _0x4b76f6=await _0x516445[_0x5f5724(0x1fe)](_0x516445['config'][_0x5f5724(0x1af)]+'.data.table');if(!_0x4b76f6||!_0x4b76f6['val'])return;const _0x9f0c98=JSON['parse'](_0x4b76f6['val']),_0x596798=_0x516445[_0x5f5724(0x1ea)][_0x5f5724(0x204)]||[],_0x359e2d=_0x516445['config'][_0x5f5724(0x195)]||[],_0x384de9=new Set();_0x359e2d[_0x5f5724(0x1d3)](_0x137b82=>{const _0xe3683a=_0x5f5724;if(_0x137b82[_0xe3683a(0x1cb)])_0x384de9['add'](_0x137b82[_0xe3683a(0x1cb)]);});for(const _0x1cb08f of _0x9f0c98){if(_0x1cb08f[_0x5f5724(0x21f)]&&_0x596798[_0x5f5724(0x194)]>0x0&&!_0x596798['includes'](_0x1cb08f[_0x5f5724(0x21f)]))continue;const _0x1e9b7d=_0x1cb08f[_0x5f5724(0x1c5)]||_0x1cb08f[_0x5f5724(0x1a9)]||_0x1cb08f[_0x5f5724(0x21d)];if(!_0x1e9b7d)continue;const _0x22521e=new Date(_0x1e9b7d),_0x56051b=_0x22521e[_0x5f5724(0x1fd)]();if(isNaN(_0x56051b))continue;if(_0x56051b<_0x3edcec)continue;if(_0x56051b>_0x3edcec+_0x70c2ac)continue;const _0x46af00=(_0x1cb08f[_0x5f5724(0x1b6)]||_0x1cb08f[_0x5f5724(0x21a)]||'')[_0x5f5724(0x1c4)]();let _0x35a492=![],_0x2743a4=[],_0x3ceae9=_0x1cb08f[_0x5f5724(0x1b6)]||_0x1cb08f[_0x5f5724(0x21a)]||_0x5f5724(0x193);if(_0x46af00[_0x5f5724(0x1e4)](_0x5f5724(0x1a8))||_0x46af00[_0x5f5724(0x1e4)](_0x5f5724(0x1ac))||_0x46af00[_0x5f5724(0x1e4)](_0x5f5724(0x1ee)))_0x35a492=!![],_0x2743a4=Array[_0x5f5724(0x1f7)](_0x384de9);else for(const _0x276718 of _0x384de9){if(_0x46af00[_0x5f5724(0x1e4)](_0x276718[_0x5f5724(0x1c4)]()))_0x2743a4['push'](_0x276718);}_0x2743a4[_0x5f5724(0x194)]>0x0&&_0x2743a4[_0x5f5724(0x1d3)](_0x1019e7=>{const _0x4c31b6=_0x5f5724;let _0x5c03e5=0x3c;if(_0x35a492){let _0x5591e9=0x0;Object[_0x4c31b6(0x1e6)](_0x24af84)[_0x4c31b6(0x1d3)](_0x10200e=>{if(_0x10200e>_0x5591e9)_0x5591e9=_0x10200e;}),_0x5c03e5=_0x5591e9>0x0?_0x5591e9:0x78;}else _0x5c03e5=_0x24af84[_0x1019e7]||0x3c;const _0x529be9=new Date(_0x56051b-_0x5c03e5*0xea60);_0x3ffe46['push']({'eventTime':_0x56051b,'triggerTime':_0x529be9[_0x4c31b6(0x1fd)](),'room':_0x1019e7,'minutes':_0x5c03e5,'reason':_0x3ceae9,'isGlobal':_0x35a492});});}}catch(_0x53750a){}_0x3ffe46[_0x5f5724(0x1bd)]((_0x5717bf,_0x4a6aa0)=>_0x5717bf[_0x5f5724(0x1d7)]-_0x4a6aa0[_0x5f5724(0x1d7)]);const _0x4d9eab=_0x3ffe46[_0x5f5724(0x18a)](0x0,0x5);await _0x516445[_0x5f5724(0x219)](_0x5f5724(0x1d2),{'val':JSON[_0x5f5724(0x1a3)](_0x4d9eab),'ack':!![]});}async function checkCalendarTriggers(_0x2c9cd7){const _0x285c7a=a1_0x453fd;if(!_0x2c9cd7['config']['useCalendar']||!_0x2c9cd7[_0x285c7a(0x1ea)][_0x285c7a(0x1af)])return;await updateSchedulePreview(_0x2c9cd7);let _0x37ca77={},_0x4db198={};try{const _0x2df339=await _0x2c9cd7['getStateAsync'](_0x285c7a(0x211));if(_0x2df339&&_0x2df339['val'])_0x37ca77=JSON[_0x285c7a(0x186)](_0x2df339['val']);const _0x565e32=await _0x2c9cd7[_0x285c7a(0x19e)](_0x285c7a(0x197));if(_0x565e32&&_0x565e32[_0x285c7a(0x216)])_0x4db198=JSON['parse'](_0x565e32[_0x285c7a(0x216)]);}catch(_0x4bf32f){}let _0x11f6ef={'default':0x15};try{const _0xc85eab=await _0x2c9cd7[_0x285c7a(0x19e)]('analysis.energy.warmupTargets');if(_0xc85eab&&_0xc85eab[_0x285c7a(0x216)])_0x11f6ef=JSON['parse'](_0xc85eab[_0x285c7a(0x216)]);}catch(_0x294269){}try{const _0x275765=await _0x2c9cd7[_0x285c7a(0x1fe)](_0x2c9cd7[_0x285c7a(0x1ea)]['calendarInstance']+_0x285c7a(0x1d8));if(!_0x275765||!_0x275765[_0x285c7a(0x216)])return;const _0x2b224c=JSON[_0x285c7a(0x186)](_0x275765[_0x285c7a(0x216)]),_0x1b0b7b=Date[_0x285c7a(0x1b2)](),_0x36c5d8=_0x2c9cd7[_0x285c7a(0x1ea)][_0x285c7a(0x195)]||[],_0x4bb878=_0x2c9cd7[_0x285c7a(0x1ea)]['calendarSelection']||[];for(const _0x3d26bb of _0x2b224c){if(_0x3d26bb[_0x285c7a(0x21f)]&&_0x4bb878['length']>0x0&&!_0x4bb878[_0x285c7a(0x1e4)](_0x3d26bb[_0x285c7a(0x21f)]))continue;const _0x3c09cd=_0x3d26bb[_0x285c7a(0x1c5)]||_0x3d26bb[_0x285c7a(0x1a9)]||_0x3d26bb[_0x285c7a(0x21d)];if(!_0x3c09cd)continue;const _0x716d51=new Date(_0x3c09cd);if(isNaN(_0x716d51['getTime']()))continue;const _0x3e6451=(_0x3d26bb[_0x285c7a(0x1b6)]||_0x3d26bb[_0x285c7a(0x21a)]||'')[_0x285c7a(0x1c4)]();if(_0x3e6451[_0x285c7a(0x1e4)]('urlaub\x20ende')||_0x3e6451[_0x285c7a(0x1e4)](_0x285c7a(0x1ac))||_0x3e6451[_0x285c7a(0x1e4)](_0x285c7a(0x1ee))){let _0x3f435f=0x0;Object[_0x285c7a(0x1e6)](_0x37ca77)[_0x285c7a(0x1d3)](_0x393154=>{if(_0x393154>_0x3f435f)_0x3f435f=_0x393154;});if(_0x3f435f===0x0)_0x3f435f=0x78;const _0x192234=_0x716d51[_0x285c7a(0x1fd)]()-_0x3f435f*0xea60;_0x1b0b7b>=_0x192234&&_0x1b0b7b<_0x716d51[_0x285c7a(0x1fd)]()&&(_0x2c9cd7['currentSystemMode']!==_0x285c7a(0x1cd)&&(_0x2c9cd7[_0x285c7a(0x1c0)][_0x285c7a(0x1f0)](_0x285c7a(0x1b5)+_0x3f435f+_0x285c7a(0x1c8)),await _0x2c9cd7[_0x285c7a(0x219)](_0x285c7a(0x207),{'val':_0x285c7a(0x1cd),'ack':![]})));}for(const _0x44502a of _0x36c5d8){if(_0x44502a[_0x285c7a(0x1cb)]){const _0x33c3e9=_0x44502a[_0x285c7a(0x1cb)][_0x285c7a(0x1c4)]();if(_0x3e6451['includes'](_0x33c3e9)){const _0x26b949=_0x37ca77[_0x44502a[_0x285c7a(0x1cb)]]||0x3c,_0x27c478=_0x4db198[_0x44502a['location']]||_0x285c7a(0x1be),_0x4704ec=_0x716d51['getTime']()-_0x26b949*0xea60;if(_0x1b0b7b>=_0x4704ec&&_0x1b0b7b<_0x716d51['getTime']()){const _0x2a2586=lastActions[_0x285c7a(0x1f5)+_0x44502a[_0x285c7a(0x1cb)]];if(_0x2a2586&&_0x1b0b7b-_0x2a2586<CAL_COOLDOWN_MS)continue;const _0x2dcf2e=await findRelatedId(_0x2c9cd7,_0x44502a['id'],_0x285c7a(0x1e3));if(_0x2dcf2e){let _0x55ffb9=_0x11f6ef[_0x44502a['location']];if(_0x55ffb9===undefined)_0x55ffb9=_0x11f6ef[_0x285c7a(0x217)];if(_0x55ffb9===undefined)_0x55ffb9=0x15;const _0x1ae742=await _0x2c9cd7['getForeignStateAsync'](_0x2dcf2e);_0x1ae742&&typeof _0x1ae742['val']==='number'&&_0x1ae742['val']<_0x55ffb9-0.5&&(_0x2c9cd7['log'][_0x285c7a(0x1f0)](_0x285c7a(0x1a4)+_0x27c478+_0x285c7a(0x188)+_0x44502a[_0x285c7a(0x1cb)]+'\x27\x20aktiv.\x20Heize\x20auf\x20'+_0x55ffb9+_0x285c7a(0x1a5)+_0x26b949+'\x20min).'),await _0x2c9cd7[_0x285c7a(0x1b8)](_0x2dcf2e,_0x55ffb9),await logAutomationAction(_0x2c9cd7,_0x285c7a(0x1cc)+_0x44502a[_0x285c7a(0x1cb)]+_0x285c7a(0x1dd)+_0x55ffb9+_0x285c7a(0x1da)+_0x27c478+')'),lastActions['cal_'+_0x44502a[_0x285c7a(0x1cb)]]=_0x1b0b7b);}}}}}}}catch(_0x5d1499){_0x2c9cd7[_0x285c7a(0x1c0)]['warn'](_0x285c7a(0x1eb)+_0x5d1499['message']);}}async function manageMpcIntervention(_0x5e5604,_0x544f57,_0x91281a){const _0x2bb6bf=a1_0x453fd;try{const _0x1e17fa=_0x2bb6bf(0x205),_0x100818=await _0x5e5604['getStateAsync'](_0x1e17fa);let _0x4b922d=[];if(_0x100818&&_0x100818[_0x2bb6bf(0x216)])try{_0x4b922d=JSON[_0x2bb6bf(0x186)](_0x100818[_0x2bb6bf(0x216)]);}catch(_0x3abd1b){}const _0x343fec=_0x4b922d[_0x2bb6bf(0x1d6)](_0x544f57);if(_0x91281a===_0x2bb6bf(0x1c2))_0x343fec===-0x1&&(_0x4b922d[_0x2bb6bf(0x1f8)](_0x544f57),await _0x5e5604[_0x2bb6bf(0x219)](_0x1e17fa,{'val':JSON[_0x2bb6bf(0x1a3)](_0x4b922d),'ack':!![]}));else _0x91281a===_0x2bb6bf(0x218)&&(_0x343fec!==-0x1&&(_0x4b922d[_0x2bb6bf(0x1a0)](_0x343fec,0x1),await _0x5e5604[_0x2bb6bf(0x219)](_0x1e17fa,{'val':JSON[_0x2bb6bf(0x1a3)](_0x4b922d),'ack':!![]})));}catch(_0x42176b){}}async function applyEnergySavings(_0x221d1f,_0xadbf2d){const _0x4045ca=a1_0x453fd;if(!_0xadbf2d||_0xadbf2d[_0x4045ca(0x194)]===0x0)return;const _0x5d9bb4=_0x221d1f[_0x4045ca(0x1ea)][_0x4045ca(0x195)]||[],_0x40201c=Date[_0x4045ca(0x1b2)]();for(const _0x11cc9e of _0xadbf2d){const _0x4fbd2d=_0x11cc9e['room'],_0x25176a=_0x11cc9e[_0x4045ca(0x1cf)],_0x20f46e=_0x11cc9e[_0x4045ca(0x191)]||0x15,_0x4f0f19=_0x5d9bb4[_0x4045ca(0x1d4)](_0x1facbb=>normalize(_0x1facbb[_0x4045ca(0x1cb)])===normalize(_0x4fbd2d)&&(_0x1facbb[_0x4045ca(0x1f6)]===_0x4045ca(0x215)||_0x1facbb[_0x4045ca(0x1f6)]===_0x4045ca(0x203)));if(!_0x4f0f19)continue;const _0x525118=await findRelatedId(_0x221d1f,_0x4f0f19['id'],'setpoint');if(_0x525118){if(lastActions[_0x4045ca(0x202)+_0x4fbd2d]&&_0x40201c-lastActions[_0x4045ca(0x202)+_0x4fbd2d]<0x1e*0x3c*0x3e8)continue;const _0x2285d2=await _0x221d1f[_0x4045ca(0x1fe)](_0x525118);if(_0x2285d2&&typeof _0x2285d2[_0x4045ca(0x216)]==='number'){const _0x4ab251=_0x2285d2[_0x4045ca(0x216)];_0x4ab251!==ECO_TEMP&&await manageMpcIntervention(_0x221d1f,_0x4fbd2d,'remove');if(_0x25176a>0x1e)_0x4ab251>ECO_TEMP+0.5&&(_0x221d1f[_0x4045ca(0x1c0)][_0x4045ca(0x1f0)]('üçÉ\x20[MPC\x20ACTION]\x20Senke\x20'+_0x4fbd2d+_0x4045ca(0x190)+ECO_TEMP+_0x4045ca(0x1ad)+_0x25176a+_0x4045ca(0x1b1)),await _0x221d1f[_0x4045ca(0x1b8)](_0x525118,ECO_TEMP),await manageMpcIntervention(_0x221d1f,_0x4fbd2d,_0x4045ca(0x1c2)),lastActions[_0x4045ca(0x202)+_0x4fbd2d]=_0x40201c,await logAutomationAction(_0x221d1f,_0x4045ca(0x20f)+_0x4fbd2d+_0x4045ca(0x187)+ECO_TEMP+'¬∞C'));else _0x25176a<=0xf&&(_0x4ab251<_0x20f46e&&(_0x221d1f[_0x4045ca(0x1c0)][_0x4045ca(0x1f0)](_0x4045ca(0x1fa)+_0x4fbd2d+_0x4045ca(0x1c9)+_0x20f46e+'¬∞C!\x20(Puffer\x20leer).'),await _0x221d1f[_0x4045ca(0x1b8)](_0x525118,_0x20f46e),await manageMpcIntervention(_0x221d1f,_0x4fbd2d,_0x4045ca(0x218)),lastActions[_0x4045ca(0x202)+_0x4fbd2d]=_0x40201c,await logAutomationAction(_0x221d1f,_0x4045ca(0x20f)+_0x4fbd2d+_0x4045ca(0x1bb)+_0x20f46e+'¬∞C')));}}else _0x221d1f[_0x4045ca(0x1c0)][_0x4045ca(0x221)](_0x4045ca(0x1ba)+_0x4fbd2d+_0x4045ca(0x1ce));}}module[a1_0x453fd(0x19d)]={'handlePrediction':handlePrediction,'applyEnergySavings':applyEnergySavings,'scanThermostats':scanThermostats,'checkCalendarTriggers':checkCalendarTriggers,'updateSchedulePreview':updateSchedulePreview};function a1_0x52f8(){const _0x1cff7a=['exports','getStateAsync','thermostat.setpoint','splice','level.valve','1600joxcKp','stringify','üìÖ\x20SMART\x20SCHEDULE\x20[','¬∞C\x20(Vorlauf:\x20','light','wert','urlaub\x20ende','eventStart','SET','string','r√ºckkehr','¬∞C!\x20(Puffer:\x20','Soll','calendarInstance','map','\x20min)','now','set','value.valve','üìÖ\x20SMART\x20SCHEDULE\x20(Phase):\x20\x27Globaler\x20Start\x27\x20erkannt.\x20Heize\x20Haus\x20auf\x20(Vorlauf:\x20','event','level','setForeignStateAsync','(((.+)+)+)+$','[MPC\x20WARNING]\x20Kein\x20Setpoint\x20f√ºr\x20',':\x20Aufheizen\x20auf\x20','ist','sort','Classic','occupied_heating_setpoint','log','thermostatMapping','add','.1.TEMPERATURE','toLowerCase','_date','Ist','valve','\x20min).','\x20wieder\x20auf\x20','hm-rpc','location','[CAL]\x20','normal','\x20gefunden!','minutes_safe','target_temperature','soll','analysis.energy.schedulePreview','forEach','find','sensor','indexOf','triggerTime','.data.table','Nicht\x20gefunden','¬∞C\x20(via\x20','.1.ACTUAL_TEMPERATURE','dimmer','\x20->\x20','level.temperature','entries','state','.4.SET_TEMPERATURE','actual','setpoint','includes','position','values','trim','replace','.1.LEVEL','config','Calendar\x20Check\x20Error:\x20','filter','common','ankunft','join','info','analysis.automation.mode','215007HHLFKm','unit','getForeignObjectAsync','cal_','type','from','push','switch','üî•\x20[MPC\x20ACTION]\x20Heize\x20','Fehlt','approved','getTime','getForeignStateAsync','localeCompare','stellwert','useCalendar','mpc_','thermostat','calendarSelection','analysis.energy.mpcActiveInterventions','valveMapping','system.mode','local_temperature','pi_heating_demand','off','1480272uWjEaz','436530FkgoKS','getForeignObjectsAsync','openknx','[MPC]\x20','ACTUAL','analysis.energy.warmupTimes','2126235EKEdaB','active','analysis.automation.confidenceThreshold','temperature','val','default','remove','setStateAsync','summary','Auto-Erkennung','room','date','Unknown','_calName','./ai_agent','warn','parse',':\x20Absenkung\x20auf\x20',']:\x20Raum-Trigger\x20\x27','split','slice','search','valve_position','290080rnKyPw','name','write','\x20auf\x20','target','12278ygrNIF','Unbekannt','length','devices','score','analysis.energy.warmupSources','toString','unshift','\x20->\x20Schalte\x20','.1.SET_POINT_TEMPERATURE','1269687PHdpat'];a1_0x52f8=function(){return _0x1cff7a;};return a1_0x52f8();}