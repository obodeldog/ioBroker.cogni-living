const a1_0x4aa0a9=a1_0x2797;(function(_0x158b20,_0x274706){const _0x19e8dc=a1_0x2797,_0x5d7c9d=_0x158b20();while(!![]){try{const _0x6768f0=parseInt(_0x19e8dc(0x15b))/0x1+parseInt(_0x19e8dc(0x167))/0x2*(parseInt(_0x19e8dc(0x1b2))/0x3)+parseInt(_0x19e8dc(0x1f1))/0x4+-parseInt(_0x19e8dc(0x179))/0x5+-parseInt(_0x19e8dc(0x1ee))/0x6*(-parseInt(_0x19e8dc(0x1eb))/0x7)+-parseInt(_0x19e8dc(0x17d))/0x8*(-parseInt(_0x19e8dc(0x17a))/0x9)+-parseInt(_0x19e8dc(0x1d5))/0xa;if(_0x6768f0===_0x274706)break;else _0x5d7c9d['push'](_0x5d7c9d['shift']());}catch(_0x354b98){_0x5d7c9d['push'](_0x5d7c9d['shift']());}}}(a1_0xe690,0xe66af));const a1_0x34c85f=(function(){let _0x213471=!![];return function(_0x38c4a1,_0x21e1dc){const _0x12467f=_0x213471?function(){const _0x1f15b6=a1_0x2797;if(_0x21e1dc){const _0x283be4=_0x21e1dc[_0x1f15b6(0x18f)](_0x38c4a1,arguments);return _0x21e1dc=null,_0x283be4;}}:function(){};return _0x213471=![],_0x12467f;};}()),a1_0xbcb22e=a1_0x34c85f(this,function(){const _0x52bf71=a1_0x2797;return a1_0xbcb22e[_0x52bf71(0x183)]()[_0x52bf71(0x1ea)](_0x52bf71(0x170))[_0x52bf71(0x183)]()[_0x52bf71(0x19a)](a1_0xbcb22e)[_0x52bf71(0x1ea)](_0x52bf71(0x170));});a1_0xbcb22e();'use strict';const aiAgent=require(a1_0x4aa0a9(0x1c9)),COOLDOWN_MS=0x3c*0x3e8,CAL_COOLDOWN_MS=0x5a*0x3c*0x3e8,RESCUE_LOCK_MS=0x78*0x3c*0x3e8,ECO_TEMP=0x11,lastActions={};function normalize(_0x35eeee){const _0x585834=a1_0x4aa0a9;if(!_0x35eeee)return'';return _0x35eeee[_0x585834(0x1b0)]()[_0x585834(0x1bc)](/\s+/g,'')[_0x585834(0x1f4)]();}async function logAutomationAction(_0x74ce21,_0xc62ba0){const _0x4716dc=a1_0x4aa0a9;await _0x74ce21[_0x4716dc(0x192)](_0x4716dc(0x1e2),{'val':_0xc62ba0,'ack':!![]});try{const _0x564e55=_0x4716dc(0x164),_0x4ef9a1=await _0x74ce21[_0x4716dc(0x1d9)](_0x564e55);let _0x29eeb1=[];if(_0x4ef9a1&&_0x4ef9a1['val'])try{_0x29eeb1=JSON[_0x4716dc(0x178)](_0x4ef9a1[_0x4716dc(0x1b6)]);}catch(_0x5a1eb1){}_0x29eeb1[_0x4716dc(0x1cc)]({'ts':Date[_0x4716dc(0x1c6)](),'msg':_0xc62ba0});if(_0x29eeb1['length']>0x32)_0x29eeb1=_0x29eeb1[_0x4716dc(0x1ba)](0x0,0x32);await _0x74ce21[_0x4716dc(0x192)](_0x564e55,{'val':JSON[_0x4716dc(0x188)](_0x29eeb1),'ack':!![]});}catch(_0x443539){}}async function handlePrediction(_0x12d676,_0x311473,_0x1ff41b){const _0x55f42f=a1_0x4aa0a9;if(!_0x311473||_0x311473==='Unknown')return;let _0x3ca7d8=_0x55f42f(0x1ce),_0x3b970e=0.6;try{const _0x4071d0=await _0x12d676[_0x55f42f(0x1d9)](_0x55f42f(0x1a9));if(_0x4071d0&&_0x4071d0[_0x55f42f(0x1b6)])_0x3ca7d8=_0x4071d0[_0x55f42f(0x1b6)];const _0x1e17b4=await _0x12d676['getStateAsync'](_0x55f42f(0x18b));if(_0x1e17b4&&_0x1e17b4[_0x55f42f(0x1b6)])_0x3b970e=_0x1e17b4[_0x55f42f(0x1b6)];}catch(_0x9cea04){}if(_0x3ca7d8===_0x55f42f(0x1ce)||_0x1ff41b<_0x3b970e)return;const _0x451f41=Date[_0x55f42f(0x1c6)]();if(lastActions[_0x311473]&&_0x451f41-lastActions[_0x311473]<COOLDOWN_MS)return;const _0x19e12e=_0x12d676['config']['devices']||[],_0x43e68c=normalize(_0x311473),_0x408ead=_0x19e12e[_0x55f42f(0x1b5)](_0x502316=>normalize(_0x502316[_0x55f42f(0x1fc)])===_0x43e68c&&(_0x502316[_0x55f42f(0x16f)]===_0x55f42f(0x197)||_0x502316[_0x55f42f(0x16f)]==='dimmer'||_0x502316[_0x55f42f(0x16f)]===_0x55f42f(0x161)));if(!_0x408ead)return;const _0x376f53=await aiAgent['consultButler'](_0x12d676,_0x311473,_0x408ead[_0x55f42f(0x1ec)],_0x1ff41b);if(!_0x376f53[_0x55f42f(0x1e5)])return;const _0x31c4db='Pr√§diktion:\x20'+_0x311473+_0x55f42f(0x193)+_0x408ead[_0x55f42f(0x1ec)]+'\x20('+_0x376f53[_0x55f42f(0x1c0)]+')';await logAutomationAction(_0x12d676,'['+_0x3ca7d8[_0x55f42f(0x16e)]()+']\x20'+_0x31c4db);if(_0x3ca7d8===_0x55f42f(0x175)){const _0x43f46a=await _0x12d676[_0x55f42f(0x1ef)](_0x408ead['id']);(!_0x43f46a||!_0x43f46a[_0x55f42f(0x1b6)]&&_0x43f46a[_0x55f42f(0x1b6)]!==!![])&&await _0x12d676['setForeignStateAsync'](_0x408ead['id'],!![]),lastActions[_0x311473]=_0x451f41;}}async function findRelatedId(_0x167d99,_0x3b406,_0x103941='setpoint'){const _0x49fdfe=a1_0x4aa0a9;if(_0x103941===_0x49fdfe(0x1c5)&&_0x167d99[_0x49fdfe(0x165)][_0x49fdfe(0x195)]){let _0x90cebe=_0x167d99[_0x49fdfe(0x165)][_0x49fdfe(0x195)];if(typeof _0x90cebe==='string')try{_0x90cebe=JSON[_0x49fdfe(0x178)](_0x90cebe);}catch(_0x3c0669){}if(_0x90cebe&&_0x90cebe[_0x3b406])return _0x90cebe[_0x3b406];}if(_0x103941===_0x49fdfe(0x172)&&_0x167d99[_0x49fdfe(0x165)][_0x49fdfe(0x1f7)]){let _0x5594a7=_0x167d99['config'][_0x49fdfe(0x1f7)];if(typeof _0x5594a7===_0x49fdfe(0x1d1))try{_0x5594a7=JSON[_0x49fdfe(0x178)](_0x5594a7);}catch(_0x4a4ec0){}if(_0x5594a7&&_0x5594a7[_0x3b406])return _0x5594a7[_0x3b406];}let _0x5860ff=[];if(_0x103941===_0x49fdfe(0x1c5))_0x5860ff=[{'s':_0x49fdfe(0x1d2),'t':'.1.SET_POINT_TEMPERATURE'},{'s':_0x49fdfe(0x196),'t':_0x49fdfe(0x1a6)},{'s':_0x49fdfe(0x196),'t':_0x49fdfe(0x1a4)},{'s':_0x49fdfe(0x1c3),'t':_0x49fdfe(0x1e3)},{'s':_0x49fdfe(0x1cd),'t':_0x49fdfe(0x198)},{'s':_0x49fdfe(0x1cd),'t':_0x49fdfe(0x1b1)},{'s':_0x49fdfe(0x180),'t':_0x49fdfe(0x1ac)},{'s':_0x49fdfe(0x163),'t':'SET'},{'s':_0x49fdfe(0x19d),'t':'Soll'},{'s':_0x49fdfe(0x180),'t':_0x49fdfe(0x1c5)}];else _0x103941===_0x49fdfe(0x172)&&(_0x5860ff=[{'s':'.1.ACTUAL_TEMPERATURE','t':'.1.LEVEL'},{'s':'.1.TEMPERATURE','t':'.1.LEVEL'},{'s':_0x49fdfe(0x196),'t':_0x49fdfe(0x1c1)},{'s':_0x49fdfe(0x1cd),'t':_0x49fdfe(0x1f6)},{'s':_0x49fdfe(0x180),'t':_0x49fdfe(0x1d0)},{'s':_0x49fdfe(0x180),'t':_0x49fdfe(0x156)}]);for(const _0xcd6ed2 of _0x5860ff){if(_0x3b406['includes'](_0xcd6ed2['s'])){const _0x3e7aa7=_0x3b406[_0x49fdfe(0x1bc)](_0xcd6ed2['s'],_0xcd6ed2['t']),_0x375f96=await _0x167d99['getForeignObjectAsync'](_0x3e7aa7);if(_0x375f96)return _0x3e7aa7;}}try{const _0x24a150=_0x3b406['split']('.');if(_0x24a150['length']>0x2){const _0x492b47=_0x24a150[_0x49fdfe(0x1ba)](0x0,-0x1)[_0x49fdfe(0x1f8)]('.'),_0x304554=await _0x167d99[_0x49fdfe(0x1a7)](_0x492b47+'.*'),_0x3c5bde=[],_0x326326=_0x3b406[_0x49fdfe(0x199)](/[._]+/)['filter'](_0x185054=>![_0x49fdfe(0x1e1),'0','hm-rpc',_0x49fdfe(0x15f),_0x49fdfe(0x1ff),_0x49fdfe(0x180),_0x49fdfe(0x1bd),'sensor','messwert','state'][_0x49fdfe(0x15a)](_0x185054[_0x49fdfe(0x1b0)]()));for(const [_0x1ac4bb,_0x54ba11]of Object[_0x49fdfe(0x194)](_0x304554)){if(_0x1ac4bb===_0x3b406)continue;if(_0x54ba11&&_0x54ba11[_0x49fdfe(0x169)]){const _0x4e463a=_0x1ac4bb['toLowerCase'](),_0x349ae0=(_0x54ba11[_0x49fdfe(0x169)][_0x49fdfe(0x1c7)]||'')['toLowerCase'](),_0xf0bac1=(_0x54ba11[_0x49fdfe(0x169)]['unit']||'')[_0x49fdfe(0x1b0)]();let _0x10fb71=![];if(_0x103941==='setpoint'&&_0x54ba11[_0x49fdfe(0x169)][_0x49fdfe(0x1da)]===!![])_0x10fb71=_0x4e463a[_0x49fdfe(0x15a)]('set')||_0x4e463a['includes'](_0x49fdfe(0x181))||_0x4e463a[_0x49fdfe(0x15a)](_0x49fdfe(0x1bb))||_0x349ae0['includes'](_0x49fdfe(0x18a))||_0x349ae0[_0x49fdfe(0x15a)](_0x49fdfe(0x1df));else _0x103941===_0x49fdfe(0x172)&&(_0x10fb71=_0x4e463a['includes'](_0x49fdfe(0x156))||_0x4e463a['includes'](_0x49fdfe(0x172))||_0x4e463a[_0x49fdfe(0x15a)](_0x49fdfe(0x16b))||_0x4e463a[_0x49fdfe(0x15a)]('position')||_0x349ae0[_0x49fdfe(0x15a)](_0x49fdfe(0x168))||_0x349ae0[_0x49fdfe(0x15a)](_0x49fdfe(0x173))||_0xf0bac1[_0x49fdfe(0x15a)]('%'));if(_0x10fb71){const _0x3fbd16=_0x1ac4bb[_0x49fdfe(0x199)](/[._]+/)[_0x49fdfe(0x17e)](_0x51347a=>_0x51347a[_0x49fdfe(0x1b0)]());let _0xb7e893=0x0;_0x326326[_0x49fdfe(0x1be)](_0x390f9f=>{const _0x46b842=_0x49fdfe;if(_0x3fbd16[_0x46b842(0x15a)](_0x390f9f[_0x46b842(0x1b0)]()))_0xb7e893++;}),_0x3c5bde[_0x49fdfe(0x185)]({'id':_0x1ac4bb,'score':_0xb7e893});}}}if(_0x3c5bde['length']>0x0){_0x3c5bde[_0x49fdfe(0x1a5)]((_0x4e5c9a,_0x31a64e)=>_0x31a64e[_0x49fdfe(0x1fb)]-_0x4e5c9a[_0x49fdfe(0x1fb)]);if(_0x3c5bde[0x0][_0x49fdfe(0x1fb)]>0x0)return _0x3c5bde[0x0]['id'];}}}catch(_0x4038c0){}return null;}async function scanThermostats(_0x5cb0a0){const _0x74ca98=a1_0x4aa0a9,_0x51ce97=_0x5cb0a0[_0x74ca98(0x165)][_0x74ca98(0x1d8)]||[],_0x376662=[],_0x9873ee=_0x51ce97[_0x74ca98(0x184)](_0x42fa45=>_0x42fa45['id']&&_0x42fa45['id'][_0x74ca98(0x15a)](_0x74ca98(0x180))||_0x42fa45[_0x74ca98(0x16f)]&&[_0x74ca98(0x180),_0x74ca98(0x190),_0x74ca98(0x1dd)][_0x74ca98(0x15a)](_0x42fa45[_0x74ca98(0x16f)])||_0x42fa45[_0x74ca98(0x1ec)]&&_0x42fa45[_0x74ca98(0x1ec)][_0x74ca98(0x1b0)]()[_0x74ca98(0x15a)](_0x74ca98(0x1ab)));for(const _0x539a94 of _0x9873ee){const _0x1d5810=await findRelatedId(_0x5cb0a0,_0x539a94['id'],_0x74ca98(0x1c5)),_0xd8ee59=await findRelatedId(_0x5cb0a0,_0x539a94['id'],'valve');let _0x26ddf9=_0x74ca98(0x1fe),_0xec4e0f=![],_0x246d75=_0x5cb0a0['config'][_0x74ca98(0x195)]||{};if(typeof _0x246d75===_0x74ca98(0x1d1))try{_0x246d75=JSON[_0x74ca98(0x178)](_0x246d75);}catch(_0x1fdede){}let _0x55f885=_0x5cb0a0['config'][_0x74ca98(0x1f7)]||{};if(typeof _0x55f885===_0x74ca98(0x1d1))try{_0x55f885=JSON[_0x74ca98(0x178)](_0x55f885);}catch(_0x28be8a){}if(_0x246d75[_0x539a94['id']]&&_0x246d75[_0x539a94['id']]===_0x1d5810||_0x55f885[_0x539a94['id']]&&_0x55f885[_0x539a94['id']]===_0xd8ee59)_0x26ddf9='Manuelles\x20Mapping',_0xec4e0f=!![];else(_0x1d5810||_0xd8ee59)&&(_0x26ddf9=_0x74ca98(0x1f2));_0x376662[_0x74ca98(0x185)]({'room':_0x539a94[_0x74ca98(0x1fc)]||_0x74ca98(0x191),'sensorId':_0x539a94['id'],'setpointId':_0x1d5810||'-','valveId':_0xd8ee59||'-','source':_0x26ddf9,'isManual':_0xec4e0f,'status':_0x1d5810&&_0xd8ee59?'PERFECT':_0x1d5810?'OK':_0x74ca98(0x1e4)});}return _0x376662['sort']((_0x4ec2b6,_0x42c5d9)=>_0x4ec2b6['room']['localeCompare'](_0x42c5d9[_0x74ca98(0x1a2)]));}function a1_0xe690(){const _0x2944fa=['value.valve','r√ºckkehr','active','üßπ\x20[MPC\x20CLEANUP]\x20Raum\x20\x27','analysis.energy.warmupTimes','parse','6867130pHfDkZ','828oDGiVx','\x27\x20aktiv.\x20Heize\x20auf\x20','currentSystemMode','74848tpOIWi','map','\x20min).','temperature','soll','üìÖ\x20SMART\x20SCHEDULE\x20(Phase):\x20\x27Globaler\x20Start\x27\x20erkannt.\x20Heize\x20Haus\x20auf\x20(Vorlauf:\x20','toString','filter','push','\x20auf\x20','¬∞C!\x20(Puffer\x20leer).','stringify','length','level.temperature','analysis.automation.confidenceThreshold','mpc_','triggerTime','üî•\x20[MPC\x20ACTION]\x20Heize\x20','apply','thermostat','Unbekannt','setStateAsync','\x20->\x20Schalte\x20','entries','thermostatMapping','.1.TEMPERATURE','light','occupied_heating_setpoint','split','constructor','\x20erreicht\x20Limit\x20(','_date','Ist','exports','log','remove','¬∞C\x20(via\x20','room','number','.4.SET_TEMPERATURE','sort','.1.SET_POINT_TEMPERATURE','getForeignObjectsAsync','¬∞C\x20(Vorlauf:\x20','analysis.automation.mode',':\x20Puffer\x20leer\x20->\x20Heizen\x20auf\x20','temp','target_temperature','Calendar\x20Check\x20Error:\x20','urlaub\x20ende','analysis.energy.ventilationAlerts','toLowerCase','current_heating_setpoint','4587378tHZuKR','summary','setForeignStateAsync','find','val','useCalendar','analysis.energy.schedulePreview','system.mode','slice','target','replace','actual','forEach','[MPC]\x20','reason','.4.VALVE_STATE','calendarSelection','ACTUAL_TEMPERATURE','normal','setpoint','now','role','getTime','./ai_agent','\x20gefunden!','analysis.energy.warmupTargets','unshift','local_temperature','off','.data.table','valve_position','string','.1.ACTUAL_TEMPERATURE','minutes_safe','¬∞C).\x20Sparmodus\x20beendet!','34060370pdRoqw','window','TRAIN_RL_PENALTY','devices','getStateAsync','write','\x20wieder\x20auf\x20','from','sensor','üå¨Ô∏è\x20[MPC\x20WATCHDOG]\x20','thermostat.setpoint','indexOf','openknx','analysis.automation.lastAction','SET_POINT_TEMPERATURE','Fehlt','approved','\x20min)','analysis.energy.warmupSources','manual','event','search','7GOSZvx','name','\x20ist\x20auf\x20','5909046eXtdoF','getForeignStateAsync','eventStart','7401288OuRPCT','Auto-Erkennung','calendarInstance','trim','¬∞C!\x20(Puffer:\x20','pi_heating_demand','valveMapping','join','\x20ist\x20zu\x20kalt,\x20ABER\x20Fenster\x20offen/L√ºftung\x20erkannt.\x20Heize\x20NICHT,\x20entferne\x20nur\x20Status.','_calName','score','location','info','Nicht\x20gefunden','wert','add','\x20durch\x20Kalender\x20ge√§ndert.\x20Keine\x20RL-Strafe.','üçÉ\x20[MPC\x20ACTION]\x20Senke\x20','cal_','level','warn','splice','üìÖ\x20[MPC\x20INFO]\x20','includes','498213pGYGmm','üìÖ\x20SMART\x20SCHEDULE\x20[','sendToPythonWrapper','rescue_','ist','default','switch','values','ACTUAL','analysis.automation.actionLog','config','¬∞C\x20(nicht\x20','2yMCpPs','level.valve','common','analysis.energy.mpcActiveInterventions','stellwert','ankunft','too_cold','toUpperCase','type','(((.+)+)+)+$','¬∞C\x20<\x20','valve'];a1_0xe690=function(){return _0x2944fa;};return a1_0xe690();}function a1_0x2797(_0x45c4c2,_0x3ba7b0){const _0x49135b=a1_0xe690();return a1_0x2797=function(_0xbcb22e,_0x34c85f){_0xbcb22e=_0xbcb22e-0x152;let _0xe69038=_0x49135b[_0xbcb22e];return _0xe69038;},a1_0x2797(_0x45c4c2,_0x3ba7b0);}async function updateSchedulePreview(_0x2dfe33){const _0x42f3ec=a1_0x4aa0a9;if(!_0x2dfe33['config'][_0x42f3ec(0x1b7)]||!_0x2dfe33['config'][_0x42f3ec(0x1f3)])return;let _0x19b69e={};try{const _0x446386=await _0x2dfe33[_0x42f3ec(0x1d9)]('analysis.energy.warmupTimes');if(_0x446386&&_0x446386[_0x42f3ec(0x1b6)])_0x19b69e=JSON[_0x42f3ec(0x178)](_0x446386[_0x42f3ec(0x1b6)]);}catch(_0x1be1ec){}const _0x42b3be=[],_0x58ea77=Date[_0x42f3ec(0x1c6)](),_0x16d521=0x30*0x3c*0x3c*0x3e8;try{const _0x2ec77c=await _0x2dfe33[_0x42f3ec(0x1ef)](_0x2dfe33['config']['calendarInstance']+_0x42f3ec(0x1cf));if(!_0x2ec77c||!_0x2ec77c[_0x42f3ec(0x1b6)])return;const _0x14ce79=JSON[_0x42f3ec(0x178)](_0x2ec77c[_0x42f3ec(0x1b6)]),_0x4f3749=_0x2dfe33['config']['calendarSelection']||[],_0x1f314e=_0x2dfe33[_0x42f3ec(0x165)][_0x42f3ec(0x1d8)]||[],_0x4d02de=new Set();_0x1f314e[_0x42f3ec(0x1be)](_0xb6553e=>{const _0x5c321c=_0x42f3ec;if(_0xb6553e[_0x5c321c(0x1fc)])_0x4d02de[_0x5c321c(0x152)](_0xb6553e[_0x5c321c(0x1fc)]);});for(const _0x32eab9 of _0x14ce79){if(_0x32eab9['_calName']&&_0x4f3749['length']>0x0&&!_0x4f3749[_0x42f3ec(0x15a)](_0x32eab9[_0x42f3ec(0x1fa)]))continue;const _0x2e417d=_0x32eab9[_0x42f3ec(0x19c)]||_0x32eab9[_0x42f3ec(0x1f0)]||_0x32eab9['date'];if(!_0x2e417d)continue;const _0xac13d3=new Date(_0x2e417d),_0xfeff3b=_0xac13d3[_0x42f3ec(0x1c8)]();if(isNaN(_0xfeff3b))continue;if(_0xfeff3b<_0x58ea77)continue;if(_0xfeff3b>_0x58ea77+_0x16d521)continue;const _0xc906e9=(_0x32eab9[_0x42f3ec(0x1e9)]||_0x32eab9[_0x42f3ec(0x1b3)]||'')[_0x42f3ec(0x1b0)]();let _0x53b5ab=![],_0x2a54b0=[],_0x555671=_0x32eab9[_0x42f3ec(0x1e9)]||_0x32eab9['summary']||_0x42f3ec(0x191);if(_0xc906e9['includes'](_0x42f3ec(0x1ae))||_0xc906e9[_0x42f3ec(0x15a)](_0x42f3ec(0x174))||_0xc906e9[_0x42f3ec(0x15a)](_0x42f3ec(0x16c)))_0x53b5ab=!![],_0x2a54b0=Array[_0x42f3ec(0x1dc)](_0x4d02de);else for(const _0xecd9ae of _0x4d02de){if(_0xc906e9[_0x42f3ec(0x15a)](_0xecd9ae[_0x42f3ec(0x1b0)]()))_0x2a54b0['push'](_0xecd9ae);}_0x2a54b0['length']>0x0&&_0x2a54b0[_0x42f3ec(0x1be)](_0x481b8c=>{const _0x225ea1=_0x42f3ec;let _0xf837de=0x3c;if(_0x53b5ab){let _0x48c48d=0x0;Object[_0x225ea1(0x162)](_0x19b69e)['forEach'](_0x28e324=>{if(_0x28e324>_0x48c48d)_0x48c48d=_0x28e324;}),_0xf837de=_0x48c48d>0x0?_0x48c48d:0x78;}else _0xf837de=_0x19b69e[_0x481b8c]||0x3c;const _0x241b64=new Date(_0xfeff3b-_0xf837de*0xea60);_0x42b3be['push']({'eventTime':_0xfeff3b,'triggerTime':_0x241b64[_0x225ea1(0x1c8)](),'room':_0x481b8c,'minutes':_0xf837de,'reason':_0x555671,'isGlobal':_0x53b5ab});});}}catch(_0x21884a){}_0x42b3be['sort']((_0x55f02a,_0x2fe0ec)=>_0x55f02a[_0x42f3ec(0x18d)]-_0x2fe0ec['triggerTime']);const _0x5327d9=_0x42b3be[_0x42f3ec(0x1ba)](0x0,0x5);await _0x2dfe33[_0x42f3ec(0x192)](_0x42f3ec(0x1b8),{'val':JSON[_0x42f3ec(0x188)](_0x5327d9),'ack':!![]});}async function checkCalendarTriggers(_0x531c25){const _0x447772=a1_0x4aa0a9;if(!_0x531c25[_0x447772(0x165)]['useCalendar']||!_0x531c25[_0x447772(0x165)]['calendarInstance'])return;await updateSchedulePreview(_0x531c25);let _0x1926f0={},_0x13733c={};try{const _0xf716b1=await _0x531c25[_0x447772(0x1d9)](_0x447772(0x177));if(_0xf716b1&&_0xf716b1['val'])_0x1926f0=JSON[_0x447772(0x178)](_0xf716b1[_0x447772(0x1b6)]);const _0x4a177=await _0x531c25[_0x447772(0x1d9)](_0x447772(0x1e7));if(_0x4a177&&_0x4a177['val'])_0x13733c=JSON[_0x447772(0x178)](_0x4a177[_0x447772(0x1b6)]);}catch(_0x3c8d70){}let _0x337349={'default':0x15};try{const _0x2886fc=await _0x531c25[_0x447772(0x1d9)]('analysis.energy.warmupTargets');if(_0x2886fc&&_0x2886fc[_0x447772(0x1b6)])_0x337349=JSON['parse'](_0x2886fc[_0x447772(0x1b6)]);}catch(_0xf6e2fb){}try{const _0x486476=await _0x531c25[_0x447772(0x1ef)](_0x531c25[_0x447772(0x165)]['calendarInstance']+_0x447772(0x1cf));if(!_0x486476||!_0x486476[_0x447772(0x1b6)])return;const _0x15719a=JSON[_0x447772(0x178)](_0x486476[_0x447772(0x1b6)]),_0x9d6671=Date[_0x447772(0x1c6)](),_0x222e90=_0x531c25['config'][_0x447772(0x1d8)]||[],_0x51d841=_0x531c25[_0x447772(0x165)][_0x447772(0x1c2)]||[];for(const _0x557e3f of _0x15719a){if(_0x557e3f[_0x447772(0x1fa)]&&_0x51d841['length']>0x0&&!_0x51d841['includes'](_0x557e3f[_0x447772(0x1fa)]))continue;const _0x2c4f9f=_0x557e3f['_date']||_0x557e3f['eventStart']||_0x557e3f['date'];if(!_0x2c4f9f)continue;const _0x1f1987=new Date(_0x2c4f9f);if(isNaN(_0x1f1987[_0x447772(0x1c8)]()))continue;const _0x593f52=(_0x557e3f['event']||_0x557e3f[_0x447772(0x1b3)]||'')[_0x447772(0x1b0)]();if(_0x593f52[_0x447772(0x15a)](_0x447772(0x1ae))||_0x593f52[_0x447772(0x15a)](_0x447772(0x174))||_0x593f52[_0x447772(0x15a)](_0x447772(0x16c))){let _0x9731=0x0;Object[_0x447772(0x162)](_0x1926f0)[_0x447772(0x1be)](_0x45a8a1=>{if(_0x45a8a1>_0x9731)_0x9731=_0x45a8a1;});if(_0x9731===0x0)_0x9731=0x78;const _0x52428f=_0x1f1987['getTime']()-_0x9731*0xea60;_0x9d6671>=_0x52428f&&_0x9d6671<_0x1f1987['getTime']()&&(_0x531c25[_0x447772(0x17c)]!=='normal'&&(_0x531c25[_0x447772(0x19f)][_0x447772(0x1fd)](_0x447772(0x182)+_0x9731+_0x447772(0x17f)),await _0x531c25[_0x447772(0x192)](_0x447772(0x1b9),{'val':_0x447772(0x1c4),'ack':![]})));}for(const _0x3bbeff of _0x222e90){if(_0x3bbeff[_0x447772(0x1fc)]){const _0x26fd86=_0x3bbeff[_0x447772(0x1fc)][_0x447772(0x1b0)]();if(_0x593f52[_0x447772(0x15a)](_0x26fd86)){const _0x1b0b62=_0x1926f0[_0x3bbeff[_0x447772(0x1fc)]]||0x3c,_0x20e9e2=_0x13733c[_0x3bbeff[_0x447772(0x1fc)]]||'Classic',_0x517d05=_0x1f1987['getTime']()-_0x1b0b62*0xea60;if(_0x9d6671>=_0x517d05&&_0x9d6671<_0x1f1987[_0x447772(0x1c8)]()){const _0x296416=lastActions[_0x447772(0x155)+_0x3bbeff[_0x447772(0x1fc)]];if(_0x296416&&_0x9d6671-_0x296416<CAL_COOLDOWN_MS)continue;const _0x2b8dda=await findRelatedId(_0x531c25,_0x3bbeff['id'],_0x447772(0x1c5));if(_0x2b8dda){let _0x2e0ac0=_0x337349[_0x3bbeff[_0x447772(0x1fc)]];if(_0x2e0ac0===undefined)_0x2e0ac0=_0x337349[_0x447772(0x160)];if(_0x2e0ac0===undefined)_0x2e0ac0=0x15;const _0x19c223=await _0x531c25[_0x447772(0x1ef)](_0x2b8dda);_0x19c223&&typeof _0x19c223[_0x447772(0x1b6)]===_0x447772(0x1a3)&&_0x19c223[_0x447772(0x1b6)]<_0x2e0ac0-0.5&&(_0x531c25[_0x447772(0x19f)][_0x447772(0x1fd)](_0x447772(0x15c)+_0x20e9e2+']:\x20Raum-Trigger\x20\x27'+_0x3bbeff[_0x447772(0x1fc)]+_0x447772(0x17b)+_0x2e0ac0+_0x447772(0x1a8)+_0x1b0b62+_0x447772(0x17f)),await _0x531c25[_0x447772(0x1b4)](_0x2b8dda,_0x2e0ac0),await logAutomationAction(_0x531c25,'[CAL]\x20'+_0x3bbeff[_0x447772(0x1fc)]+'\x20->\x20'+_0x2e0ac0+_0x447772(0x1a1)+_0x20e9e2+')'),lastActions['cal_'+_0x3bbeff[_0x447772(0x1fc)]]=_0x9d6671);}}}}}}}catch(_0x4d0b72){_0x531c25[_0x447772(0x19f)][_0x447772(0x157)](_0x447772(0x1ad)+_0x4d0b72['message']);}}async function manageMpcIntervention(_0x1f2e9d,_0x2ea626,_0x4c08fc){const _0x46a2b1=a1_0x4aa0a9;try{const _0x2e5f12=_0x46a2b1(0x16a),_0x38c755=await _0x1f2e9d[_0x46a2b1(0x1d9)](_0x2e5f12);let _0x426be6=[];if(_0x38c755&&_0x38c755['val'])try{_0x426be6=JSON[_0x46a2b1(0x178)](_0x38c755[_0x46a2b1(0x1b6)]);}catch(_0x39b98b){}const _0x34298a=_0x426be6[_0x46a2b1(0x1e0)](_0x2ea626);if(_0x4c08fc==='add')_0x34298a===-0x1&&(_0x426be6[_0x46a2b1(0x185)](_0x2ea626),await _0x1f2e9d[_0x46a2b1(0x192)](_0x2e5f12,{'val':JSON[_0x46a2b1(0x188)](_0x426be6),'ack':!![]}));else _0x4c08fc===_0x46a2b1(0x1a0)&&(_0x34298a!==-0x1&&(_0x426be6[_0x46a2b1(0x158)](_0x34298a,0x1),await _0x1f2e9d[_0x46a2b1(0x192)](_0x2e5f12,{'val':JSON[_0x46a2b1(0x188)](_0x426be6),'ack':!![]})));}catch(_0x1c19c4){}}async function cleanupGhostInterventions(_0x27edbf){const _0x364383=a1_0x4aa0a9;try{const _0x3d9494='analysis.energy.mpcActiveInterventions',_0x3d1b5b=await _0x27edbf[_0x364383(0x1d9)](_0x3d9494);if(!_0x3d1b5b||!_0x3d1b5b['val'])return;const _0x4d3194=JSON['parse'](_0x3d1b5b[_0x364383(0x1b6)]);if(!Array['isArray'](_0x4d3194)||_0x4d3194[_0x364383(0x189)]===0x0)return;let _0x3e7b66={'default':0x15};try{const _0x32008c=await _0x27edbf['getStateAsync'](_0x364383(0x1cb));if(_0x32008c&&_0x32008c[_0x364383(0x1b6)])_0x3e7b66=JSON[_0x364383(0x178)](_0x32008c[_0x364383(0x1b6)]);}catch(_0x378be9){}let _0x27022f=[];try{const _0xe7c85=await _0x27edbf[_0x364383(0x1d9)](_0x364383(0x1af));if(_0xe7c85&&_0xe7c85[_0x364383(0x1b6)])_0x27022f=JSON[_0x364383(0x178)](_0xe7c85[_0x364383(0x1b6)]);}catch(_0xa93d88){}const _0x1daf9c=_0x27edbf['config'][_0x364383(0x1d8)]||[];let _0x4e1386=![];for(let _0xab2132=_0x4d3194['length']-0x1;_0xab2132>=0x0;_0xab2132--){const _0x3139d2=_0x4d3194[_0xab2132],_0x237447=_0x1daf9c[_0x364383(0x1b5)](_0x2dba2e=>normalize(_0x2dba2e[_0x364383(0x1fc)])===normalize(_0x3139d2)&&(_0x2dba2e[_0x364383(0x16f)]===_0x364383(0x180)||_0x2dba2e[_0x364383(0x16f)]===_0x364383(0x190)));if(!_0x237447){_0x27edbf[_0x364383(0x19f)]['warn'](_0x364383(0x176)+_0x3139d2+'\x27\x20hat\x20kein\x20Ger√§t\x20mehr.\x20L√∂sche\x20Eintrag.'),_0x4d3194[_0x364383(0x158)](_0xab2132,0x1),_0x4e1386=!![];continue;}if(_0x237447){const _0x1ad26a=await findRelatedId(_0x27edbf,_0x237447['id'],'setpoint'),_0x34b77e=await _0x27edbf['getForeignStateAsync'](_0x237447['id']);if(_0x1ad26a){const _0x51d344=await _0x27edbf['getForeignStateAsync'](_0x1ad26a);if(_0x51d344&&typeof _0x51d344[_0x364383(0x1b6)]===_0x364383(0x1a3)){let _0x2681cd=![],_0x963b1f='';Math['abs'](_0x51d344[_0x364383(0x1b6)]-ECO_TEMP)>0.5&&(_0x2681cd=!![],_0x963b1f=_0x364383(0x1e8));if(!_0x2681cd&&_0x34b77e&&typeof _0x34b77e[_0x364383(0x1b6)]===_0x364383(0x1a3)){const _0x91bc71=_0x3e7b66[_0x3139d2]||_0x3e7b66[_0x364383(0x160)]||0x15;_0x34b77e[_0x364383(0x1b6)]<_0x91bc71+0.2&&(_0x2681cd=!![],_0x963b1f=_0x364383(0x16d));}if(_0x2681cd){if(_0x963b1f==='manual'){_0x27edbf[_0x364383(0x19f)][_0x364383(0x1fd)]('üßπ\x20[MPC\x20CLEANUP]\x20'+_0x3139d2+_0x364383(0x1ed)+_0x51d344[_0x364383(0x1b6)]+_0x364383(0x166)+ECO_TEMP+'¬∞C).\x20Entferne\x20Status.');const _0x317b4e=lastActions[_0x364383(0x155)+_0x3139d2],_0x456dc8=_0x317b4e&&Date['now']()-_0x317b4e<0x2*0x3c*0x3e8;if(!_0x456dc8&&_0x51d344['val']>ECO_TEMP+0.5)_0x27edbf['sendToPythonWrapper']&&(_0x27edbf[_0x364383(0x19f)][_0x364383(0x1fd)]('üéì\x20[RL-FEEDBACK]\x20Lerne\x20aus\x20Fehler:\x20'+_0x3139d2+'\x20wurde\x20manuell\x20erh√∂ht.'),_0x27edbf[_0x364383(0x15d)](_0x364383(0x1d7),{'room':_0x3139d2}));else _0x456dc8&&_0x27edbf['log'][_0x364383(0x1fd)](_0x364383(0x159)+_0x3139d2+_0x364383(0x153));}else{if(_0x963b1f===_0x364383(0x16d)){let _0x5858f8=![];if(_0x27022f[_0x364383(0x1b5)](_0x242f32=>_0x242f32['room']===_0x3139d2))_0x5858f8=!![];const _0x2b52a6=_0x1daf9c['filter'](_0x3b338e=>normalize(_0x3b338e[_0x364383(0x1fc)])===normalize(_0x3139d2)&&(_0x3b338e[_0x364383(0x16f)]===_0x364383(0x1d6)||_0x3b338e[_0x364383(0x16f)]===_0x364383(0x1dd)||_0x3b338e['type']==='contact'));for(const _0x1b2464 of _0x2b52a6){try{const _0x4f927b=await _0x27edbf[_0x364383(0x1ef)](_0x1b2464['id']);if(_0x4f927b&&(_0x4f927b[_0x364383(0x1b6)]===!![]||_0x4f927b[_0x364383(0x1b6)]===0x1||String(_0x4f927b[_0x364383(0x1b6)])[_0x364383(0x1b0)]()==='open'))_0x5858f8=!![];}catch(_0x296fd9){}}if(_0x5858f8)_0x27edbf[_0x364383(0x19f)]['info'](_0x364383(0x1de)+_0x3139d2+_0x364383(0x1f9));else{const _0x118bcd=_0x3e7b66[_0x3139d2]||_0x3e7b66['default']||0x15;_0x27edbf['log'][_0x364383(0x1fd)]('üö®\x20[MPC\x20WATCHDOG]\x20'+_0x3139d2+_0x364383(0x19b)+_0x34b77e[_0x364383(0x1b6)]+_0x364383(0x171)+(_0x118bcd+0.2)+_0x364383(0x1d4)),await _0x27edbf[_0x364383(0x1b4)](_0x1ad26a,_0x118bcd),await logAutomationAction(_0x27edbf,'[WATCHDOG]\x20'+_0x3139d2+_0x364383(0x1aa)+_0x118bcd+'¬∞C'),lastActions[_0x364383(0x15e)+_0x3139d2]=Date[_0x364383(0x1c6)]();}}}_0x4d3194[_0x364383(0x158)](_0xab2132,0x1),_0x4e1386=!![];}}}}}_0x4e1386&&await _0x27edbf['setStateAsync'](_0x3d9494,{'val':JSON[_0x364383(0x188)](_0x4d3194),'ack':!![]});}catch(_0x29234c){}}async function applyEnergySavings(_0x46936c,_0x12bedb){const _0x3574fe=a1_0x4aa0a9;await cleanupGhostInterventions(_0x46936c);if(!_0x12bedb||_0x12bedb['length']===0x0)return;const _0x33001c=_0x46936c[_0x3574fe(0x165)][_0x3574fe(0x1d8)]||[],_0x50b4b5=Date[_0x3574fe(0x1c6)]();for(const _0x5b9ff2 of _0x12bedb){const _0x4d0dc0=_0x5b9ff2[_0x3574fe(0x1a2)],_0x541ff9=_0x5b9ff2[_0x3574fe(0x1d3)],_0x2fba29=_0x5b9ff2['target']||0x15;if(lastActions[_0x3574fe(0x15e)+_0x4d0dc0]&&_0x50b4b5-lastActions[_0x3574fe(0x15e)+_0x4d0dc0]<RESCUE_LOCK_MS)continue;const _0x448981=_0x33001c[_0x3574fe(0x1b5)](_0x2aed8a=>normalize(_0x2aed8a[_0x3574fe(0x1fc)])===normalize(_0x4d0dc0)&&(_0x2aed8a['type']===_0x3574fe(0x180)||_0x2aed8a[_0x3574fe(0x16f)]===_0x3574fe(0x190)));if(!_0x448981)continue;const _0x1ed72d=await findRelatedId(_0x46936c,_0x448981['id'],_0x3574fe(0x1c5));if(_0x1ed72d){if(lastActions['mpc_'+_0x4d0dc0]&&_0x50b4b5-lastActions[_0x3574fe(0x18c)+_0x4d0dc0]<0x1e*0x3c*0x3e8)continue;const _0x1d9541=await _0x46936c[_0x3574fe(0x1ef)](_0x1ed72d);if(_0x1d9541&&typeof _0x1d9541[_0x3574fe(0x1b6)]===_0x3574fe(0x1a3)){const _0xa72ba6=_0x1d9541['val'];_0xa72ba6!==ECO_TEMP&&await manageMpcIntervention(_0x46936c,_0x4d0dc0,_0x3574fe(0x1a0));if(_0x541ff9>0x1e)_0xa72ba6>ECO_TEMP+0.5&&(_0x46936c['log'][_0x3574fe(0x1fd)](_0x3574fe(0x154)+_0x4d0dc0+_0x3574fe(0x186)+ECO_TEMP+_0x3574fe(0x1f5)+_0x541ff9+_0x3574fe(0x1e6)),await _0x46936c['setForeignStateAsync'](_0x1ed72d,ECO_TEMP),await manageMpcIntervention(_0x46936c,_0x4d0dc0,'add'),lastActions[_0x3574fe(0x18c)+_0x4d0dc0]=_0x50b4b5,await logAutomationAction(_0x46936c,_0x3574fe(0x1bf)+_0x4d0dc0+':\x20Absenkung\x20auf\x20'+ECO_TEMP+'¬∞C'));else _0x541ff9<=0xf&&(_0xa72ba6<_0x2fba29&&(_0x46936c[_0x3574fe(0x19f)][_0x3574fe(0x1fd)](_0x3574fe(0x18e)+_0x4d0dc0+_0x3574fe(0x1db)+_0x2fba29+_0x3574fe(0x187)),await _0x46936c[_0x3574fe(0x1b4)](_0x1ed72d,_0x2fba29),await manageMpcIntervention(_0x46936c,_0x4d0dc0,_0x3574fe(0x1a0)),lastActions[_0x3574fe(0x18c)+_0x4d0dc0]=_0x50b4b5,await logAutomationAction(_0x46936c,'[MPC]\x20'+_0x4d0dc0+':\x20Aufheizen\x20auf\x20'+_0x2fba29+'¬∞C')));}}else _0x46936c[_0x3574fe(0x19f)][_0x3574fe(0x157)]('[MPC\x20WARNING]\x20Kein\x20Setpoint\x20f√ºr\x20'+_0x4d0dc0+_0x3574fe(0x1ca));}}module[a1_0x4aa0a9(0x19e)]={'handlePrediction':handlePrediction,'applyEnergySavings':applyEnergySavings,'scanThermostats':scanThermostats,'checkCalendarTriggers':checkCalendarTriggers,'updateSchedulePreview':updateSchedulePreview,'cleanupGhostInterventions':cleanupGhostInterventions};