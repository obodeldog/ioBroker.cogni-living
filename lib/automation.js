const a1_0x4e8074=a1_0x9b12;(function(_0x1affa2,_0x3da567){const _0x2a51d9=a1_0x9b12,_0x407267=_0x1affa2();while(!![]){try{const _0x515d24=parseInt(_0x2a51d9(0xa9))/0x1+-parseInt(_0x2a51d9(0xf8))/0x2+parseInt(_0x2a51d9(0x7f))/0x3+parseInt(_0x2a51d9(0xc9))/0x4+parseInt(_0x2a51d9(0xca))/0x5+-parseInt(_0x2a51d9(0xab))/0x6+parseInt(_0x2a51d9(0x109))/0x7;if(_0x515d24===_0x3da567)break;else _0x407267['push'](_0x407267['shift']());}catch(_0x53ae69){_0x407267['push'](_0x407267['shift']());}}}(a1_0xed3a,0x3934a));const a1_0x3ecb48=(function(){let _0x5305fa=!![];return function(_0x4417d1,_0x353f73){const _0x4c91e7=_0x5305fa?function(){const _0x2a9835=a1_0x9b12;if(_0x353f73){const _0x4b5674=_0x353f73[_0x2a9835(0xcc)](_0x4417d1,arguments);return _0x353f73=null,_0x4b5674;}}:function(){};return _0x5305fa=![],_0x4c91e7;};}()),a1_0x1fb4d3=a1_0x3ecb48(this,function(){const _0x1f4733=a1_0x9b12;return a1_0x1fb4d3[_0x1f4733(0x89)]()[_0x1f4733(0xc8)](_0x1f4733(0x104))[_0x1f4733(0x89)]()[_0x1f4733(0x105)](a1_0x1fb4d3)[_0x1f4733(0xc8)](_0x1f4733(0x104));});a1_0x1fb4d3();'use strict';const aiAgent=require(a1_0x4e8074(0xf0)),COOLDOWN_MS=0x3c*0x3e8,CAL_COOLDOWN_MS=0x5a*0x3c*0x3e8,ECO_TEMP=0x11,lastActions={};function normalize(_0x207b0e){const _0x16452f=a1_0x4e8074;if(!_0x207b0e)return'';return _0x207b0e[_0x16452f(0x96)]()[_0x16452f(0xa1)](/\s+/g,'')['trim']();}async function logAutomationAction(_0xd37ab5,_0x5f4e69){const _0x1bdb88=a1_0x4e8074;await _0xd37ab5[_0x1bdb88(0xb9)](_0x1bdb88(0xa6),{'val':_0x5f4e69,'ack':!![]});try{const _0x396a12=_0x1bdb88(0x88),_0xc47ba7=await _0xd37ab5[_0x1bdb88(0xaf)](_0x396a12);let _0x410b9c=[];if(_0xc47ba7&&_0xc47ba7[_0x1bdb88(0x92)])try{_0x410b9c=JSON['parse'](_0xc47ba7[_0x1bdb88(0x92)]);}catch(_0x24c571){}_0x410b9c[_0x1bdb88(0x10c)]({'ts':Date['now'](),'msg':_0x5f4e69}),_0x410b9c[_0x1bdb88(0xfb)]>0x32&&(_0x410b9c=_0x410b9c['slice'](0x0,0x32)),await _0xd37ab5[_0x1bdb88(0xb9)](_0x396a12,{'val':JSON[_0x1bdb88(0xaa)](_0x410b9c),'ack':!![]});}catch(_0x38b7fb){}}async function handlePrediction(_0x18004a,_0x2a4c83,_0x1a5f1b){const _0x3458ce=a1_0x4e8074;if(!_0x2a4c83||_0x2a4c83===_0x3458ce(0x94))return;let _0x55ab10=_0x3458ce(0xe6),_0x25aa82=0.6;try{const _0x1f19d5=await _0x18004a['getStateAsync'](_0x3458ce(0xcb));if(_0x1f19d5&&_0x1f19d5['val'])_0x55ab10=_0x1f19d5[_0x3458ce(0x92)];const _0x7c15e1=await _0x18004a[_0x3458ce(0xaf)](_0x3458ce(0x100));if(_0x7c15e1&&_0x7c15e1['val'])_0x25aa82=_0x7c15e1['val'];}catch(_0x210384){}if(_0x55ab10==='off'||_0x1a5f1b<_0x25aa82)return;const _0x183fd3=Date[_0x3458ce(0x83)]();if(lastActions[_0x2a4c83]&&_0x183fd3-lastActions[_0x2a4c83]<COOLDOWN_MS)return;const _0x16ec3b=_0x18004a[_0x3458ce(0xc6)]['devices']||[],_0x4dd24d=normalize(_0x2a4c83),_0x29447e=_0x16ec3b['find'](_0x27aa3e=>normalize(_0x27aa3e[_0x3458ce(0xed)])===_0x4dd24d&&(_0x27aa3e[_0x3458ce(0xf5)]===_0x3458ce(0xa8)||_0x27aa3e[_0x3458ce(0xf5)]===_0x3458ce(0xb4)||_0x27aa3e['type']===_0x3458ce(0x10f)));if(!_0x29447e)return;const _0x5eb86b=await aiAgent[_0x3458ce(0x7c)](_0x18004a,_0x2a4c83,_0x29447e[_0x3458ce(0x111)],_0x1a5f1b);if(!_0x5eb86b['approved'])return;const _0x517c71=_0x3458ce(0xcf)+_0x2a4c83+_0x3458ce(0xb2)+_0x29447e[_0x3458ce(0x111)]+'\x20('+_0x5eb86b['reason']+')';await logAutomationAction(_0x18004a,'['+_0x55ab10[_0x3458ce(0x86)]()+']\x20'+_0x517c71);if(_0x55ab10==='active'){const _0x50d877=await _0x18004a[_0x3458ce(0xad)](_0x29447e['id']);(!_0x50d877||!_0x50d877[_0x3458ce(0x92)]&&_0x50d877[_0x3458ce(0x92)]!==!![])&&await _0x18004a[_0x3458ce(0x102)](_0x29447e['id'],!![]),lastActions[_0x2a4c83]=_0x183fd3;}}function a1_0x9b12(_0x2b1794,_0x446a02){const _0x30492d=a1_0xed3a();return a1_0x9b12=function(_0x1fb4d3,_0x3ecb48){_0x1fb4d3=_0x1fb4d3-0x7c;let _0xed3a8a=_0x30492d[_0x1fb4d3];return _0xed3a8a;},a1_0x9b12(_0x2b1794,_0x446a02);}async function findRelatedId(_0x8ac412,_0x3b0b6a,_0xc709a6=a1_0x4e8074(0xe1)){const _0x11858b=a1_0x4e8074;if(_0xc709a6===_0x11858b(0xe1)&&_0x8ac412[_0x11858b(0xc6)][_0x11858b(0x87)]){let _0x476882=_0x8ac412[_0x11858b(0xc6)][_0x11858b(0x87)];if(typeof _0x476882===_0x11858b(0xb7))try{_0x476882=JSON['parse'](_0x476882);}catch(_0x462deb){}if(_0x476882&&_0x476882[_0x3b0b6a])return _0x476882[_0x3b0b6a];}if(_0xc709a6===_0x11858b(0xa3)&&_0x8ac412[_0x11858b(0xc6)]['valveMapping']){let _0x4e8048=_0x8ac412[_0x11858b(0xc6)][_0x11858b(0xe0)];if(typeof _0x4e8048==='string')try{_0x4e8048=JSON[_0x11858b(0xeb)](_0x4e8048);}catch(_0xc950cb){}if(_0x4e8048&&_0x4e8048[_0x3b0b6a])return _0x4e8048[_0x3b0b6a];}let _0x513d88=[];if(_0xc709a6===_0x11858b(0xe1))_0x513d88=[{'s':_0x11858b(0xec),'t':_0x11858b(0xbd)},{'s':_0x11858b(0x107),'t':'.1.SET_POINT_TEMPERATURE'},{'s':'.1.TEMPERATURE','t':'.4.SET_TEMPERATURE'},{'s':'ACTUAL_TEMPERATURE','t':_0x11858b(0x9f)},{'s':_0x11858b(0x8e),'t':'occupied_heating_setpoint'},{'s':_0x11858b(0x8e),'t':_0x11858b(0x91)},{'s':_0x11858b(0x80),'t':_0x11858b(0xb8)},{'s':_0x11858b(0x93),'t':_0x11858b(0x9d)},{'s':_0x11858b(0xf9),'t':_0x11858b(0x90)},{'s':_0x11858b(0x80),'t':_0x11858b(0xe1)}];else _0xc709a6===_0x11858b(0xa3)&&(_0x513d88=[{'s':_0x11858b(0xec),'t':_0x11858b(0xde)},{'s':_0x11858b(0x107),'t':_0x11858b(0xde)},{'s':_0x11858b(0x107),'t':_0x11858b(0x9c)},{'s':'local_temperature','t':_0x11858b(0xf6)},{'s':_0x11858b(0x80),'t':_0x11858b(0xd5)},{'s':_0x11858b(0x80),'t':_0x11858b(0xc0)}]);for(const _0x489a67 of _0x513d88){if(_0x3b0b6a['includes'](_0x489a67['s'])){const _0x3578c7=_0x3b0b6a[_0x11858b(0xa1)](_0x489a67['s'],_0x489a67['t']),_0x5b1488=await _0x8ac412[_0x11858b(0x115)](_0x3578c7);if(_0x5b1488)return _0x3578c7;}}try{const _0x2a89a7=_0x3b0b6a[_0x11858b(0xf7)]('.');if(_0x2a89a7['length']>0x2){const _0x4bb81b=_0x2a89a7[_0x11858b(0xa7)](0x0,-0x1)[_0x11858b(0xf1)]('.'),_0x285a77=await _0x8ac412[_0x11858b(0xfd)](_0x4bb81b+'.*'),_0x2d0d1c=[],_0x571b86=_0x3b0b6a[_0x11858b(0xf7)](/[._]+/)['filter'](_0x190959=>!['openknx','0',_0x11858b(0xe8),_0x11858b(0xf3),_0x11858b(0x9e),'temperature',_0x11858b(0xda),_0x11858b(0xcd),_0x11858b(0xff),_0x11858b(0xd6)][_0x11858b(0x10b)](_0x190959['toLowerCase']()));for(const [_0x42705a,_0x23bfc6]of Object[_0x11858b(0xe2)](_0x285a77)){if(_0x42705a===_0x3b0b6a)continue;if(_0x23bfc6&&_0x23bfc6[_0x11858b(0xbc)]){const _0x4eeae0=_0x42705a[_0x11858b(0x96)](),_0x392093=(_0x23bfc6[_0x11858b(0xbc)][_0x11858b(0xae)]||'')[_0x11858b(0x96)](),_0x473237=(_0x23bfc6['common'][_0x11858b(0x82)]||'')['toLowerCase']();let _0x9c7c3c=![];if(_0xc709a6===_0x11858b(0xe1)&&_0x23bfc6[_0x11858b(0xbc)][_0x11858b(0xd0)]===!![])_0x9c7c3c=_0x4eeae0[_0x11858b(0x10b)]('set')||_0x4eeae0[_0x11858b(0x10b)]('soll')||_0x4eeae0['includes'](_0x11858b(0xb1))||_0x392093[_0x11858b(0x10b)](_0x11858b(0xc2))||_0x392093['includes']('thermostat.setpoint');else _0xc709a6===_0x11858b(0xa3)&&(_0x9c7c3c=_0x4eeae0[_0x11858b(0x10b)](_0x11858b(0xc0))||_0x4eeae0[_0x11858b(0x10b)]('valve')||_0x4eeae0['includes'](_0x11858b(0xbf))||_0x4eeae0[_0x11858b(0x10b)](_0x11858b(0x97))||_0x392093['includes'](_0x11858b(0xa0))||_0x392093['includes'](_0x11858b(0x8f))||_0x473237[_0x11858b(0x10b)]('%'));if(_0x9c7c3c){const _0x31d3ba=_0x42705a[_0x11858b(0xf7)](/[._]+/)[_0x11858b(0xfe)](_0x425c36=>_0x425c36['toLowerCase']());let _0x48a2cf=0x0;_0x571b86[_0x11858b(0xd4)](_0x1fe618=>{const _0x26d56b=_0x11858b;if(_0x31d3ba[_0x26d56b(0x10b)](_0x1fe618[_0x26d56b(0x96)]()))_0x48a2cf++;}),_0x2d0d1c['push']({'id':_0x42705a,'score':_0x48a2cf});}}}if(_0x2d0d1c[_0x11858b(0xfb)]>0x0){_0x2d0d1c[_0x11858b(0x113)]((_0x38c600,_0x22ae78)=>_0x22ae78[_0x11858b(0xfc)]-_0x38c600[_0x11858b(0xfc)]);if(_0x2d0d1c[0x0][_0x11858b(0xfc)]>0x0)return _0x2d0d1c[0x0]['id'];}}}catch(_0x2f27c7){}return null;}async function scanThermostats(_0x469e0c){const _0x1f7bb8=a1_0x4e8074,_0x557948=_0x469e0c[_0x1f7bb8(0xc6)][_0x1f7bb8(0x8d)]||[],_0x3cd3bf=[],_0x54bec5=_0x557948[_0x1f7bb8(0x84)](_0x3ab95d=>_0x3ab95d['id']&&_0x3ab95d['id'][_0x1f7bb8(0x10b)](_0x1f7bb8(0x80))||_0x3ab95d[_0x1f7bb8(0xf5)]&&[_0x1f7bb8(0x80),_0x1f7bb8(0x8c),_0x1f7bb8(0xcd)][_0x1f7bb8(0x10b)](_0x3ab95d['type'])||_0x3ab95d[_0x1f7bb8(0x111)]&&_0x3ab95d[_0x1f7bb8(0x111)][_0x1f7bb8(0x96)]()[_0x1f7bb8(0x10b)](_0x1f7bb8(0xc4)));for(const _0x5493a7 of _0x54bec5){const _0x390ee0=await findRelatedId(_0x469e0c,_0x5493a7['id'],'setpoint'),_0x657df=await findRelatedId(_0x469e0c,_0x5493a7['id'],'valve');let _0x217d1b='Nicht\x20gefunden',_0x257582=![],_0x4da7ac=_0x469e0c[_0x1f7bb8(0xc6)][_0x1f7bb8(0x87)]||{};if(typeof _0x4da7ac===_0x1f7bb8(0xb7))try{_0x4da7ac=JSON[_0x1f7bb8(0xeb)](_0x4da7ac);}catch(_0x2cd6b8){}let _0x15f8ba=_0x469e0c[_0x1f7bb8(0xc6)][_0x1f7bb8(0xe0)]||{};if(typeof _0x15f8ba===_0x1f7bb8(0xb7))try{_0x15f8ba=JSON['parse'](_0x15f8ba);}catch(_0x2db3eb){}if(_0x4da7ac[_0x5493a7['id']]&&_0x4da7ac[_0x5493a7['id']]===_0x390ee0||_0x15f8ba[_0x5493a7['id']]&&_0x15f8ba[_0x5493a7['id']]===_0x657df)_0x217d1b=_0x1f7bb8(0x7e),_0x257582=!![];else(_0x390ee0||_0x657df)&&(_0x217d1b=_0x1f7bb8(0x112));_0x3cd3bf[_0x1f7bb8(0xb5)]({'room':_0x5493a7['location']||_0x1f7bb8(0x81),'sensorId':_0x5493a7['id'],'setpointId':_0x390ee0||'-','valveId':_0x657df||'-','source':_0x217d1b,'isManual':_0x257582,'status':_0x390ee0&&_0x657df?_0x1f7bb8(0xe5):_0x390ee0?'OK':'Fehlt'});}return _0x3cd3bf[_0x1f7bb8(0x113)]((_0x237196,_0x5e1c90)=>_0x237196['room'][_0x1f7bb8(0xd9)](_0x5e1c90[_0x1f7bb8(0x108)]));}async function updateSchedulePreview(_0x275a2c){const _0x951a85=a1_0x4e8074;if(!_0x275a2c['config'][_0x951a85(0xd2)]||!_0x275a2c[_0x951a85(0xc6)]['calendarInstance'])return;let _0x7b2eae={};try{const _0x2da5b3=await _0x275a2c['getStateAsync'](_0x951a85(0x10d));if(_0x2da5b3&&_0x2da5b3[_0x951a85(0x92)])_0x7b2eae=JSON['parse'](_0x2da5b3[_0x951a85(0x92)]);}catch(_0x54a231){}const _0x5c1b06=[],_0x45857f=Date[_0x951a85(0x83)](),_0x2162ae=0x30*0x3c*0x3c*0x3e8;try{const _0x4998d3=await _0x275a2c[_0x951a85(0xad)](_0x275a2c[_0x951a85(0xc6)]['calendarInstance']+'.data.table');if(!_0x4998d3||!_0x4998d3[_0x951a85(0x92)])return;const _0x3ac219=JSON['parse'](_0x4998d3[_0x951a85(0x92)]),_0x10562b=_0x275a2c['config'][_0x951a85(0xdc)]||[],_0x317483=_0x275a2c[_0x951a85(0xc6)][_0x951a85(0x8d)]||[],_0x2a0646=new Set();_0x317483[_0x951a85(0xd4)](_0x2a5165=>{const _0x4c4a6d=_0x951a85;if(_0x2a5165[_0x4c4a6d(0xed)])_0x2a0646[_0x4c4a6d(0x103)](_0x2a5165[_0x4c4a6d(0xed)]);});for(const _0x289f19 of _0x3ac219){if(_0x289f19['_calName']&&_0x10562b[_0x951a85(0xfb)]>0x0&&!_0x10562b['includes'](_0x289f19['_calName']))continue;const _0x4822d7=_0x289f19[_0x951a85(0x101)]||_0x289f19[_0x951a85(0xc5)]||_0x289f19[_0x951a85(0xa5)];if(!_0x4822d7)continue;const _0x3269dd=new Date(_0x4822d7),_0x2e7824=_0x3269dd[_0x951a85(0xd8)]();if(isNaN(_0x2e7824))continue;if(_0x2e7824<_0x45857f)continue;if(_0x2e7824>_0x45857f+_0x2162ae)continue;const _0xb3858c=(_0x289f19[_0x951a85(0xf4)]||_0x289f19[_0x951a85(0x114)]||'')[_0x951a85(0x96)]();let _0x399576=![],_0x4982d5=[],_0x16ed31=_0x289f19[_0x951a85(0xf4)]||_0x289f19[_0x951a85(0x114)]||'Unbekannt';if(_0xb3858c[_0x951a85(0x10b)]('urlaub\x20ende')||_0xb3858c[_0x951a85(0x10b)]('rÃ¼ckkehr')||_0xb3858c[_0x951a85(0x10b)](_0x951a85(0x8a)))_0x399576=!![],_0x4982d5=Array[_0x951a85(0xac)](_0x2a0646);else for(const _0x35b755 of _0x2a0646){_0xb3858c[_0x951a85(0x10b)](_0x35b755[_0x951a85(0x96)]())&&_0x4982d5[_0x951a85(0xb5)](_0x35b755);}_0x4982d5[_0x951a85(0xfb)]>0x0&&_0x4982d5[_0x951a85(0xd4)](_0x4028f8=>{const _0x507c17=_0x951a85;let _0x6cc6fc=0x3c;if(_0x399576){let _0x257065=0x0;Object['values'](_0x7b2eae)['forEach'](_0x1c0a6c=>{if(_0x1c0a6c>_0x257065)_0x257065=_0x1c0a6c;}),_0x6cc6fc=_0x257065>0x0?_0x257065:0x78;}else _0x6cc6fc=_0x7b2eae[_0x4028f8]||0x3c;const _0x3d258a=new Date(_0x2e7824-_0x6cc6fc*0xea60);_0x5c1b06[_0x507c17(0xb5)]({'eventTime':_0x2e7824,'triggerTime':_0x3d258a[_0x507c17(0xd8)](),'room':_0x4028f8,'minutes':_0x6cc6fc,'reason':_0x16ed31,'isGlobal':_0x399576});});}}catch(_0x37ca54){}_0x5c1b06['sort']((_0x32601c,_0x4039ed)=>_0x32601c['triggerTime']-_0x4039ed[_0x951a85(0xc3)]);const _0x4c15f5=_0x5c1b06['slice'](0x0,0x5);await _0x275a2c['setStateAsync']('analysis.energy.schedulePreview',{'val':JSON[_0x951a85(0xaa)](_0x4c15f5),'ack':!![]});}async function checkCalendarTriggers(_0x5418bb){const _0x1d54ca=a1_0x4e8074;if(!_0x5418bb[_0x1d54ca(0xc6)][_0x1d54ca(0xd2)]||!_0x5418bb[_0x1d54ca(0xc6)][_0x1d54ca(0x110)])return;await updateSchedulePreview(_0x5418bb);let _0x56ea32={};try{const _0x5b9c12=await _0x5418bb[_0x1d54ca(0xaf)](_0x1d54ca(0x10d));if(_0x5b9c12&&_0x5b9c12['val'])_0x56ea32=JSON[_0x1d54ca(0xeb)](_0x5b9c12['val']);}catch(_0x457758){}let _0x564986={'default':0x15};try{const _0x2a1a04=await _0x5418bb[_0x1d54ca(0xaf)](_0x1d54ca(0x95));if(_0x2a1a04&&_0x2a1a04[_0x1d54ca(0x92)])_0x564986=JSON['parse'](_0x2a1a04[_0x1d54ca(0x92)]);}catch(_0x11d8ae){}try{const _0x362157=await _0x5418bb[_0x1d54ca(0xad)](_0x5418bb[_0x1d54ca(0xc6)][_0x1d54ca(0x110)]+_0x1d54ca(0x106));if(!_0x362157||!_0x362157['val'])return;const _0x5d4f32=JSON[_0x1d54ca(0xeb)](_0x362157[_0x1d54ca(0x92)]),_0xadb06c=Date[_0x1d54ca(0x83)](),_0x243ba4=_0x5418bb['config'][_0x1d54ca(0x8d)]||[],_0x21150f=_0x5418bb[_0x1d54ca(0xc6)][_0x1d54ca(0xdc)]||[];for(const _0x245d1e of _0x5d4f32){if(_0x245d1e[_0x1d54ca(0xa2)]&&_0x21150f[_0x1d54ca(0xfb)]>0x0&&!_0x21150f['includes'](_0x245d1e[_0x1d54ca(0xa2)]))continue;const _0x249bfe=_0x245d1e['_date']||_0x245d1e['eventStart']||_0x245d1e[_0x1d54ca(0xa5)];if(!_0x249bfe)continue;const _0x399099=new Date(_0x249bfe);if(isNaN(_0x399099[_0x1d54ca(0xd8)]()))continue;const _0x12dd54=(_0x245d1e['event']||_0x245d1e['summary']||'')['toLowerCase']();if(_0x12dd54[_0x1d54ca(0x10b)](_0x1d54ca(0x98))||_0x12dd54[_0x1d54ca(0x10b)]('rÃ¼ckkehr')||_0x12dd54[_0x1d54ca(0x10b)](_0x1d54ca(0x8a))){let _0x52d789=0x0;Object['values'](_0x56ea32)['forEach'](_0x1a8704=>{if(_0x1a8704>_0x52d789)_0x52d789=_0x1a8704;});if(_0x52d789===0x0)_0x52d789=0x78;const _0x5fa816=_0x399099[_0x1d54ca(0xd8)]()-_0x52d789*0xea60;_0xadb06c>=_0x5fa816&&_0xadb06c<_0x399099[_0x1d54ca(0xd8)]()&&(_0x5418bb[_0x1d54ca(0xe4)]!==_0x1d54ca(0xbb)&&(_0x5418bb[_0x1d54ca(0xb6)][_0x1d54ca(0xb0)](_0x1d54ca(0xd1)+_0x245d1e[_0x1d54ca(0xf4)]+_0x1d54ca(0xe9)+_0x52d789+'\x20min).'),await _0x5418bb['setStateAsync'](_0x1d54ca(0xc7),{'val':_0x1d54ca(0xbb),'ack':![]})));}for(const _0x588d20 of _0x243ba4){if(_0x588d20[_0x1d54ca(0xed)]){const _0x362c01=_0x588d20['location'][_0x1d54ca(0x96)]();if(_0x12dd54['includes'](_0x362c01)){const _0x5cac83=_0x56ea32[_0x588d20[_0x1d54ca(0xed)]]||0x3c,_0x7d793a=_0x399099[_0x1d54ca(0xd8)]()-_0x5cac83*0xea60;if(_0xadb06c>=_0x7d793a&&_0xadb06c<_0x399099[_0x1d54ca(0xd8)]()){const _0xfb8912=lastActions[_0x1d54ca(0xdf)+_0x588d20[_0x1d54ca(0xed)]];if(_0xfb8912&&_0xadb06c-_0xfb8912<CAL_COOLDOWN_MS)continue;const _0x2b6291=await findRelatedId(_0x5418bb,_0x588d20['id'],'setpoint');if(_0x2b6291){let _0x2329fa=_0x564986[_0x588d20[_0x1d54ca(0xed)]];if(_0x2329fa===undefined)_0x2329fa=_0x564986['default'];if(_0x2329fa===undefined)_0x2329fa=0x15;const _0x561016=await _0x5418bb['getForeignStateAsync'](_0x2b6291);_0x561016&&typeof _0x561016[_0x1d54ca(0x92)]===_0x1d54ca(0x8b)&&_0x561016[_0x1d54ca(0x92)]<_0x2329fa-0.5&&(_0x5418bb['log']['info'](_0x1d54ca(0xd7)+_0x588d20['location']+'\x27\x20aktiv\x20('+_0x245d1e[_0x1d54ca(0xf4)]+_0x1d54ca(0xe7)+_0x2329fa+_0x1d54ca(0xee)+_0x5cac83+_0x1d54ca(0xb3)),await _0x5418bb[_0x1d54ca(0x102)](_0x2b6291,_0x2329fa),await logAutomationAction(_0x5418bb,_0x1d54ca(0xd3)+_0x588d20['location']+_0x1d54ca(0xc1)+_0x2329fa+'Â°C'),lastActions['cal_'+_0x588d20['location']]=_0xadb06c);}}}}}}}catch(_0x256850){_0x5418bb[_0x1d54ca(0xb6)][_0x1d54ca(0x10a)](_0x1d54ca(0xbe)+_0x256850[_0x1d54ca(0xe3)]);}}async function manageMpcIntervention(_0x4fb0d8,_0x15f7be,_0x4b9c6f){const _0x3d20d4=a1_0x4e8074;try{const _0xadd31a=_0x3d20d4(0xea),_0x4b8aa6=await _0x4fb0d8[_0x3d20d4(0xaf)](_0xadd31a);let _0xa8704f=[];if(_0x4b8aa6&&_0x4b8aa6[_0x3d20d4(0x92)])try{_0xa8704f=JSON[_0x3d20d4(0xeb)](_0x4b8aa6[_0x3d20d4(0x92)]);}catch(_0x30ce11){}const _0x56f911=_0xa8704f[_0x3d20d4(0x10e)](_0x15f7be);if(_0x4b9c6f===_0x3d20d4(0x103))_0x56f911===-0x1&&(_0xa8704f['push'](_0x15f7be),await _0x4fb0d8[_0x3d20d4(0xb9)](_0xadd31a,{'val':JSON['stringify'](_0xa8704f),'ack':!![]}));else _0x4b9c6f===_0x3d20d4(0xfa)&&(_0x56f911!==-0x1&&(_0xa8704f['splice'](_0x56f911,0x1),await _0x4fb0d8[_0x3d20d4(0xb9)](_0xadd31a,{'val':JSON[_0x3d20d4(0xaa)](_0xa8704f),'ack':!![]})));}catch(_0x500f7f){}}function a1_0xed3a(){const _0x4166bb=['add','(((.+)+)+)+$','constructor','.data.table','.1.TEMPERATURE','room','2378439mgQngf','warn','includes','unshift','analysis.energy.warmupTimes','indexOf','switch','calendarInstance','name','Auto-Erkennung','sort','summary','getForeignObjectAsync','consultButler','\x20auf\x20','Manuelles\x20Mapping','111147KhkVKa','temperature','Unbekannt','unit','now','filter',':\x20Aufheizen\x20auf\x20','toUpperCase','thermostatMapping','analysis.automation.actionLog','toString','ankunft','number','thermostat','devices','local_temperature','value.valve','Soll','current_heating_setpoint','val','ACTUAL','Unknown','analysis.energy.warmupTargets','toLowerCase','position','urlaub\x20ende','find','ðŸƒ\x20[MPC\x20ACTION]\x20Senke\x20','mpc_','.4.VALVE_STATE','SET','wert','SET_POINT_TEMPERATURE','level.valve','replace','_calName','valve','Â°C!\x20(Aktuell:\x20','date','analysis.automation.lastAction','slice','light','252094YbTUBz','stringify','1474788clGjkN','from','getForeignStateAsync','role','getStateAsync','info','target','\x20->\x20Schalte\x20','\x20min).','dimmer','push','log','string','target_temperature','setStateAsync','\x20wieder\x20auf\x20','normal','common','.1.SET_POINT_TEMPERATURE','Calendar\x20Check\x20Error:\x20','stellwert','level','\x20->\x20','level.temperature','triggerTime','temp','eventStart','config','system.mode','search','106956NVxoFf','474675LLKqWS','analysis.automation.mode','apply','sensor','Â°C!\x20(Puffer\x20leer).\x20->\x20ID:\x20','PrÃ¤diktion:\x20','write','ðŸ“…\x20SMART\x20SCHEDULE\x20(Phase):\x20\x27Globaler\x20Start\x27\x20erkannt\x20(','useCalendar','[CAL]\x20','forEach','valve_position','state','ðŸ“…\x20SMART\x20SCHEDULE\x20(Catch-Up):\x20Raum-Trigger\x20\x27','getTime','localeCompare','actual','[MPC]\x20','calendarSelection','[MPC\x20WARNING]\x20Kein\x20Setpoint\x20(Soll-Temp)\x20fÃ¼r\x20','.1.LEVEL','cal_','valveMapping','setpoint','entries','message','currentSystemMode','PERFECT','off',').\x20Heize\x20auf\x20','hm-rpc',').\x20Heize\x20ganzes\x20Haus\x20auf\x20(Vorlauf:\x20','analysis.energy.mpcActiveInterventions','parse','.1.ACTUAL_TEMPERATURE','location','Â°C\x20(Vorlauf:\x20','Â°C,\x20Puffer:\x20','./ai_agent','join','\x20gefunden!\x20Bitte\x20\x27System\x27\x20Tab\x20prÃ¼fen.','ist','event','type','pi_heating_demand','split','540964Snvleq','Ist','remove','length','score','getForeignObjectsAsync','map','messwert','analysis.automation.confidenceThreshold','_date','setForeignStateAsync'];a1_0xed3a=function(){return _0x4166bb;};return a1_0xed3a();}async function applyEnergySavings(_0x1ebb39,_0x51a0a4){const _0x903aae=a1_0x4e8074;if(!_0x51a0a4||_0x51a0a4['length']===0x0)return;const _0x5d2532=_0x1ebb39[_0x903aae(0xc6)][_0x903aae(0x8d)]||[],_0x2cddef=Date[_0x903aae(0x83)]();for(const _0x202adb of _0x51a0a4){const _0x74d0d7=_0x202adb[_0x903aae(0x108)],_0x467a90=_0x202adb['minutes_safe'],_0x3cf560=_0x202adb['target']||0x15,_0x34c156=_0x5d2532[_0x903aae(0x99)](_0x3b4c84=>normalize(_0x3b4c84[_0x903aae(0xed)])===normalize(_0x74d0d7)&&(_0x3b4c84[_0x903aae(0xf5)]==='temperature'||_0x3b4c84[_0x903aae(0xf5)]===_0x903aae(0x8c)));if(!_0x34c156)continue;const _0x202acc=await findRelatedId(_0x1ebb39,_0x34c156['id'],_0x903aae(0xe1));if(_0x202acc){if(lastActions[_0x903aae(0x9b)+_0x74d0d7]&&_0x2cddef-lastActions[_0x903aae(0x9b)+_0x74d0d7]<0x1e*0x3c*0x3e8)continue;const _0x466bdb=await _0x1ebb39[_0x903aae(0xad)](_0x202acc);if(_0x466bdb&&typeof _0x466bdb[_0x903aae(0x92)]==='number'){const _0x58eeb5=_0x466bdb['val'];_0x58eeb5!==ECO_TEMP&&await manageMpcIntervention(_0x1ebb39,_0x74d0d7,_0x903aae(0xfa));if(_0x467a90>0x1e)_0x58eeb5>ECO_TEMP+0.5&&(_0x1ebb39['log'][_0x903aae(0xb0)](_0x903aae(0x9a)+_0x74d0d7+_0x903aae(0x7d)+ECO_TEMP+_0x903aae(0xa4)+_0x58eeb5+_0x903aae(0xef)+_0x467a90+'\x20min)\x20->\x20ID:\x20'+_0x202acc),await _0x1ebb39['setForeignStateAsync'](_0x202acc,ECO_TEMP),await manageMpcIntervention(_0x1ebb39,_0x74d0d7,_0x903aae(0x103)),lastActions[_0x903aae(0x9b)+_0x74d0d7]=_0x2cddef,await logAutomationAction(_0x1ebb39,_0x903aae(0xdb)+_0x74d0d7+':\x20Absenkung\x20auf\x20'+ECO_TEMP+'Â°C'));else _0x467a90<=0xf&&(_0x58eeb5<_0x3cf560&&(_0x1ebb39[_0x903aae(0xb6)]['info']('ðŸ”¥\x20[MPC\x20ACTION]\x20Heize\x20'+_0x74d0d7+_0x903aae(0xba)+_0x3cf560+_0x903aae(0xce)+_0x202acc),await _0x1ebb39[_0x903aae(0x102)](_0x202acc,_0x3cf560),await manageMpcIntervention(_0x1ebb39,_0x74d0d7,_0x903aae(0xfa)),lastActions['mpc_'+_0x74d0d7]=_0x2cddef,await logAutomationAction(_0x1ebb39,_0x903aae(0xdb)+_0x74d0d7+_0x903aae(0x85)+_0x3cf560+'Â°C')));}}else _0x1ebb39[_0x903aae(0xb6)]['warn'](_0x903aae(0xdd)+_0x74d0d7+_0x903aae(0xf2));}}module['exports']={'handlePrediction':handlePrediction,'applyEnergySavings':applyEnergySavings,'scanThermostats':scanThermostats,'checkCalendarTriggers':checkCalendarTriggers,'updateSchedulePreview':updateSchedulePreview};