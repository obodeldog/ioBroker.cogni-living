const a1_0x4b7e7a=a1_0x4d81;function a1_0x463e(){const _0x12ad25=['name','setpoint','map','dimmer','current_heating_setpoint','apply','find','\x27\x20erkannt\x20(','split','\x20wieder\x20auf\x20','trim','6010590mNEVDp','slice','6nkwovR','config','constructor','valve','getForeignStateAsync','log','¬∞C!\x20(Puffer\x20leer).\x20->\x20ID:\x20','Schedule\x20Preview\x20Error:\x20','add','entries','hm-rpc','parse','getStateAsync','common','[MPC]\x20','normal','ACTUAL_TEMPERATURE','string','val','getForeignObjectAsync','occupied_heating_setpoint','2604216wPxBgK',').\x20Heize\x20auf\x2021¬∞C\x20(Vorlauf:\x20','.1.LEVEL','ist','temp','.1.ACTUAL_TEMPERATURE','Manuelles\x20Mapping','thermostatMapping','search','155430mWpUxg','Soll','openknx','push','stellwert','analysis.energy.schedulePreview','replace','local_temperature','set','setStateAsync','room','\x20min).','.1.TEMPERATURE','info','triggerTime','includes','171oFvHlr','calendarInstance','switch','sensor','location','analysis.automation.mode','toLowerCase','.1.SET_POINT_TEMPERATURE',':\x20Absenkung\x20auf\x20','analysis.automation.lastAction','3795474WqwgsX','analysis.energy.warmupTimes','üìÖ\x20SMART\x20SCHEDULE:\x20\x27Globaler\x20Start\x27\x20erkannt\x20(','join','level','.data.table','filter','_calName','eventStart','valveMapping','\x20gefunden!\x20Bitte\x20\x27System\x27\x20Tab\x20pr√ºfen.','exports','Nicht\x20gefunden','wert','\x20->\x2021¬∞C','(((.+)+)+)+$','values','thermostat','unit','debug','level.valve','reason','calendarSelection','off','score','r√ºckkehr','mpc_','state','ACTUAL','[CAL]\x20','write','sort','thermostat.setpoint',':\x20Aufheizen\x20auf\x20','warn','target_temperature','role','devices','urlaub\x20ende','PERFECT','valve_position','üìÖ\x20SMART\x20SCHEDULE:\x20Raum-Trigger\x20\x27','27244FByvax','üîç\x20Device-Search\x20failed\x20for\x20predicted\x20room\x20\x27','8cqXENH','length','temperature','üçÉ\x20[MPC\x20ACTION]\x20Senke\x20','Auto-Erkennung','analysis.automation.confidenceThreshold','5086zekjPK','3314652JHhjgC','getTime','forEach',').\x20Heize\x20ganzes\x20Haus\x20auf\x20(Vorlauf:\x20','target','Unknown','now','.4.SET_TEMPERATURE','from','useCalendar','number','setForeignStateAsync','level.temperature','Fehlt','active','soll','SET_POINT_TEMPERATURE','message','Unbekannt','üî•\x20[MPC\x20ACTION]\x20Heize\x20','actual','toString','event','ankunft','type','summary','66eQqXFn'];a1_0x463e=function(){return _0x12ad25;};return a1_0x463e();}(function(_0x3ff9cb,_0x3623b2){const _0x46df07=a1_0x4d81,_0xca1539=_0x3ff9cb();while(!![]){try{const _0x57c2af=parseInt(_0x46df07(0x1b2))/0x1*(parseInt(_0x46df07(0x197))/0x2)+-parseInt(_0x46df07(0x165))/0x3+parseInt(_0x46df07(0x142))/0x4+-parseInt(_0x46df07(0x1be))/0x5*(-parseInt(_0x46df07(0x1c0))/0x6)+parseInt(_0x46df07(0x18f))/0x7*(-parseInt(_0x46df07(0x191))/0x8)+parseInt(_0x46df07(0x15b))/0x9*(-parseInt(_0x46df07(0x14b))/0xa)+parseInt(_0x46df07(0x198))/0xb;if(_0x57c2af===_0x3623b2)break;else _0xca1539['push'](_0xca1539['shift']());}catch(_0x2a4823){_0xca1539['push'](_0xca1539['shift']());}}}(a1_0x463e,0xb90d7));const a1_0x14f05c=(function(){let _0x59c715=!![];return function(_0x4e7d7e,_0x2286e7){const _0x38bb92=_0x59c715?function(){const _0x54f4a4=a1_0x4d81;if(_0x2286e7){const _0x3b32e6=_0x2286e7[_0x54f4a4(0x1b8)](_0x4e7d7e,arguments);return _0x2286e7=null,_0x3b32e6;}}:function(){};return _0x59c715=![],_0x38bb92;};}()),a1_0x5d0c40=a1_0x14f05c(this,function(){const _0x42d738=a1_0x4d81;return a1_0x5d0c40[_0x42d738(0x1ad)]()['search'](_0x42d738(0x174))[_0x42d738(0x1ad)]()[_0x42d738(0x1c2)](a1_0x5d0c40)[_0x42d738(0x14a)](_0x42d738(0x174));});a1_0x5d0c40();'use strict';const aiAgent=require('./ai_agent'),COOLDOWN_MS=0x3c*0x3e8,ECO_TEMP=0x11,lastActions={};function normalize(_0x1863f7){const _0x4adb22=a1_0x4d81;if(!_0x1863f7)return'';return _0x1863f7[_0x4adb22(0x161)]()[_0x4adb22(0x151)](/\s+/g,'')[_0x4adb22(0x1bd)]();}async function handlePrediction(_0x2f6f54,_0x13eaff,_0x3c1aa3){const _0x3c74e5=a1_0x4d81;if(!_0x13eaff||_0x13eaff===_0x3c74e5(0x19d))return;let _0x522a04=_0x3c74e5(0x17c),_0x204ad4=0.6;try{const _0x13ee08=await _0x2f6f54[_0x3c74e5(0x1cc)](_0x3c74e5(0x160));if(_0x13ee08&&_0x13ee08[_0x3c74e5(0x13f)])_0x522a04=_0x13ee08[_0x3c74e5(0x13f)];const _0x508951=await _0x2f6f54['getStateAsync'](_0x3c74e5(0x196));if(_0x508951&&_0x508951[_0x3c74e5(0x13f)])_0x204ad4=_0x508951[_0x3c74e5(0x13f)];}catch(_0xdc0b92){}if(_0x522a04==='off'||_0x3c1aa3<_0x204ad4)return;const _0x29d192=Date[_0x3c74e5(0x19e)]();if(lastActions[_0x13eaff]&&_0x29d192-lastActions[_0x13eaff]<COOLDOWN_MS)return;const _0x1600bd=_0x2f6f54['config'][_0x3c74e5(0x18a)]||[],_0x26a090=normalize(_0x13eaff),_0x2a05f6=_0x1600bd[_0x3c74e5(0x1b9)](_0x262247=>normalize(_0x262247['location'])===_0x26a090&&(_0x262247['type']==='light'||_0x262247[_0x3c74e5(0x1b0)]===_0x3c74e5(0x1b6)||_0x262247[_0x3c74e5(0x1b0)]===_0x3c74e5(0x15d)));if(!_0x2a05f6){_0x2f6f54['log'][_0x3c74e5(0x178)](_0x3c74e5(0x190)+_0x13eaff+'\x27.');return;}const _0x5483e1=await aiAgent['consultButler'](_0x2f6f54,_0x13eaff,_0x2a05f6[_0x3c74e5(0x1b3)],_0x3c1aa3);if(!_0x5483e1['approved'])return;const _0x4fb713='Pr√§diktion:\x20'+_0x13eaff+'\x20->\x20Schalte\x20'+_0x2a05f6['name']+'\x20('+_0x5483e1[_0x3c74e5(0x17a)]+')';await _0x2f6f54[_0x3c74e5(0x154)](_0x3c74e5(0x164),{'val':'['+_0x522a04['toUpperCase']()+']\x20'+_0x4fb713,'ack':!![]});if(_0x522a04===_0x3c74e5(0x1a6)){const _0x342edf=await _0x2f6f54['getForeignStateAsync'](_0x2a05f6['id']);(!_0x342edf||!_0x342edf[_0x3c74e5(0x13f)]&&_0x342edf[_0x3c74e5(0x13f)]!==!![])&&await _0x2f6f54[_0x3c74e5(0x1a3)](_0x2a05f6['id'],!![]),lastActions[_0x13eaff]=_0x29d192;}}async function findRelatedId(_0x5e7fdd,_0x555554,_0x19d369='setpoint'){const _0x507521=a1_0x4d81;if(_0x19d369===_0x507521(0x1b4)&&_0x5e7fdd[_0x507521(0x1c1)][_0x507521(0x149)]){let _0x45870e=_0x5e7fdd[_0x507521(0x1c1)]['thermostatMapping'];if(typeof _0x45870e===_0x507521(0x13e))try{_0x45870e=JSON['parse'](_0x45870e);}catch(_0x2e5b1c){}if(_0x45870e&&_0x45870e[_0x555554])return _0x45870e[_0x555554];}if(_0x19d369===_0x507521(0x1c3)&&_0x5e7fdd[_0x507521(0x1c1)][_0x507521(0x16e)]){let _0x450821=_0x5e7fdd['config'][_0x507521(0x16e)];if(typeof _0x450821==='string')try{_0x450821=JSON[_0x507521(0x1cb)](_0x450821);}catch(_0x514c14){}if(_0x450821&&_0x450821[_0x555554])return _0x450821[_0x555554];}let _0x57472a=[];if(_0x19d369===_0x507521(0x1b4))_0x57472a=[{'s':_0x507521(0x147),'t':_0x507521(0x162)},{'s':_0x507521(0x157),'t':_0x507521(0x162)},{'s':_0x507521(0x157),'t':_0x507521(0x19f)},{'s':_0x507521(0x13d),'t':_0x507521(0x1a8)},{'s':_0x507521(0x152),'t':_0x507521(0x141)},{'s':_0x507521(0x152),'t':_0x507521(0x1b7)},{'s':_0x507521(0x193),'t':_0x507521(0x188)},{'s':_0x507521(0x181),'t':'SET'},{'s':'Ist','t':_0x507521(0x14c)},{'s':_0x507521(0x193),'t':_0x507521(0x1b4)}];else _0x19d369===_0x507521(0x1c3)&&(_0x57472a=[{'s':_0x507521(0x147),'t':_0x507521(0x144)},{'s':_0x507521(0x157),'t':_0x507521(0x144)},{'s':_0x507521(0x157),'t':'.4.VALVE_STATE'},{'s':_0x507521(0x152),'t':'pi_heating_demand'},{'s':_0x507521(0x193),'t':_0x507521(0x18d)},{'s':_0x507521(0x193),'t':'level'}]);for(const _0x121f8d of _0x57472a){if(_0x555554[_0x507521(0x15a)](_0x121f8d['s'])){const _0x102af0=_0x555554['replace'](_0x121f8d['s'],_0x121f8d['t']),_0x11d4d5=await _0x5e7fdd[_0x507521(0x140)](_0x102af0);if(_0x11d4d5)return _0x102af0;}}try{const _0x28c190=_0x555554[_0x507521(0x1bb)]('.');if(_0x28c190[_0x507521(0x192)]>0x2){const _0x3e2098=_0x28c190[_0x507521(0x1bf)](0x0,-0x1)[_0x507521(0x168)]('.'),_0x13c083=await _0x5e7fdd['getForeignObjectsAsync'](_0x3e2098+'.*'),_0xa6d912=[],_0x5d42da=_0x555554[_0x507521(0x1bb)](/[._]+/)[_0x507521(0x16b)](_0x429f96=>![_0x507521(0x14d),'0',_0x507521(0x1ca),_0x507521(0x145),_0x507521(0x172),_0x507521(0x193),_0x507521(0x1ac),'sensor','messwert',_0x507521(0x180)][_0x507521(0x15a)](_0x429f96[_0x507521(0x161)]()));for(const [_0xbd1c99,_0x3edec7]of Object[_0x507521(0x1c9)](_0x13c083)){if(_0xbd1c99===_0x555554)continue;if(_0x3edec7&&_0x3edec7[_0x507521(0x1cd)]){const _0x3d4694=_0xbd1c99[_0x507521(0x161)](),_0x773d78=(_0x3edec7['common'][_0x507521(0x189)]||'')[_0x507521(0x161)](),_0x448114=(_0x3edec7[_0x507521(0x1cd)][_0x507521(0x177)]||'')[_0x507521(0x161)]();let _0x1d2711=![];if(_0x19d369==='setpoint'&&_0x3edec7[_0x507521(0x1cd)][_0x507521(0x183)]===!![])_0x1d2711=_0x3d4694[_0x507521(0x15a)](_0x507521(0x153))||_0x3d4694[_0x507521(0x15a)](_0x507521(0x1a7))||_0x3d4694[_0x507521(0x15a)](_0x507521(0x19c))||_0x773d78[_0x507521(0x15a)](_0x507521(0x1a4))||_0x773d78[_0x507521(0x15a)](_0x507521(0x185));else _0x19d369===_0x507521(0x1c3)&&(_0x1d2711=_0x3d4694[_0x507521(0x15a)](_0x507521(0x169))||_0x3d4694['includes']('valve')||_0x3d4694[_0x507521(0x15a)](_0x507521(0x14f))||_0x3d4694[_0x507521(0x15a)]('position')||_0x773d78[_0x507521(0x15a)](_0x507521(0x179))||_0x773d78[_0x507521(0x15a)]('value.valve')||_0x448114['includes']('%'));if(_0x1d2711){const _0x17911b=_0xbd1c99['split'](/[._]+/)[_0x507521(0x1b5)](_0x23d7a0=>_0x23d7a0[_0x507521(0x161)]());let _0x48fe7d=0x0;_0x5d42da[_0x507521(0x19a)](_0x132ade=>{const _0x2049c0=_0x507521;if(_0x17911b[_0x2049c0(0x15a)](_0x132ade[_0x2049c0(0x161)]()))_0x48fe7d++;}),_0xa6d912[_0x507521(0x14e)]({'id':_0xbd1c99,'score':_0x48fe7d});}}}if(_0xa6d912[_0x507521(0x192)]>0x0){_0xa6d912['sort']((_0x237f16,_0x23a985)=>_0x23a985[_0x507521(0x17d)]-_0x237f16['score']);if(_0xa6d912[0x0][_0x507521(0x17d)]>0x0)return _0xa6d912[0x0]['id'];}}}catch(_0x403141){}return null;}async function scanThermostats(_0x4d9664){const _0xfeb729=a1_0x4d81,_0x3e62d7=_0x4d9664[_0xfeb729(0x1c1)][_0xfeb729(0x18a)]||[],_0x2b04a7=[],_0x2a0517=_0x3e62d7[_0xfeb729(0x16b)](_0xaff9c2=>_0xaff9c2['id']&&_0xaff9c2['id'][_0xfeb729(0x15a)](_0xfeb729(0x193))||_0xaff9c2[_0xfeb729(0x1b0)]&&[_0xfeb729(0x193),_0xfeb729(0x176),_0xfeb729(0x15e)][_0xfeb729(0x15a)](_0xaff9c2['type'])||_0xaff9c2[_0xfeb729(0x1b3)]&&_0xaff9c2['name'][_0xfeb729(0x161)]()[_0xfeb729(0x15a)](_0xfeb729(0x146)));for(const _0x4e6dd4 of _0x2a0517){const _0x2b383c=await findRelatedId(_0x4d9664,_0x4e6dd4['id'],_0xfeb729(0x1b4)),_0x1f0c57=await findRelatedId(_0x4d9664,_0x4e6dd4['id'],_0xfeb729(0x1c3));let _0x47ba2e=_0xfeb729(0x171),_0x1a7299=![],_0x2f94da=_0x4d9664[_0xfeb729(0x1c1)][_0xfeb729(0x149)]||{};if(typeof _0x2f94da===_0xfeb729(0x13e))try{_0x2f94da=JSON[_0xfeb729(0x1cb)](_0x2f94da);}catch(_0xdb3fdc){}let _0x584849=_0x4d9664['config'][_0xfeb729(0x16e)]||{};if(typeof _0x584849===_0xfeb729(0x13e))try{_0x584849=JSON[_0xfeb729(0x1cb)](_0x584849);}catch(_0x4948da){}if(_0x2f94da[_0x4e6dd4['id']]&&_0x2f94da[_0x4e6dd4['id']]===_0x2b383c||_0x584849[_0x4e6dd4['id']]&&_0x584849[_0x4e6dd4['id']]===_0x1f0c57)_0x47ba2e=_0xfeb729(0x148),_0x1a7299=!![];else(_0x2b383c||_0x1f0c57)&&(_0x47ba2e=_0xfeb729(0x195));_0x2b04a7[_0xfeb729(0x14e)]({'room':_0x4e6dd4[_0xfeb729(0x15f)]||_0xfeb729(0x1aa),'sensorId':_0x4e6dd4['id'],'setpointId':_0x2b383c||'-','valveId':_0x1f0c57||'-','source':_0x47ba2e,'isManual':_0x1a7299,'status':_0x2b383c&&_0x1f0c57?_0xfeb729(0x18c):_0x2b383c?'OK':_0xfeb729(0x1a5)});}return _0x2b04a7[_0xfeb729(0x184)]((_0x590ab2,_0x2f04b6)=>_0x590ab2[_0xfeb729(0x155)]['localeCompare'](_0x2f04b6[_0xfeb729(0x155)]));}async function updateSchedulePreview(_0x165170){const _0x39e51a=a1_0x4d81;if(!_0x165170['config']['useCalendar']||!_0x165170['config']['calendarInstance'])return;let _0x3b7f52={};try{const _0x2c2774=await _0x165170[_0x39e51a(0x1cc)]('analysis.energy.warmupTimes');if(_0x2c2774&&_0x2c2774[_0x39e51a(0x13f)])_0x3b7f52=JSON[_0x39e51a(0x1cb)](_0x2c2774['val']);}catch(_0x248751){}const _0x2fd13b=[],_0x29d03b=Date['now'](),_0x2f6a58=0x30*0x3c*0x3c*0x3e8;try{const _0x281272=await _0x165170[_0x39e51a(0x1c4)](_0x165170[_0x39e51a(0x1c1)][_0x39e51a(0x15c)]+_0x39e51a(0x16a));if(!_0x281272||!_0x281272[_0x39e51a(0x13f)])return;const _0x70ccd6=JSON[_0x39e51a(0x1cb)](_0x281272['val']),_0x2d2e4a=_0x165170[_0x39e51a(0x1c1)][_0x39e51a(0x17b)]||[],_0x55449d=_0x165170[_0x39e51a(0x1c1)]['devices']||[],_0x2eefe8=new Set();_0x55449d[_0x39e51a(0x19a)](_0x20fe0c=>{const _0x1f01e3=_0x39e51a;if(_0x20fe0c['location'])_0x2eefe8[_0x1f01e3(0x1c8)](_0x20fe0c[_0x1f01e3(0x15f)]);});for(const _0x35f3a6 of _0x70ccd6){if(_0x35f3a6['_calName']&&_0x2d2e4a['length']>0x0&&!_0x2d2e4a[_0x39e51a(0x15a)](_0x35f3a6[_0x39e51a(0x16c)]))continue;const _0x4fbe08=new Date(_0x35f3a6[_0x39e51a(0x16d)]),_0xab2c38=_0x4fbe08['getTime']();if(_0xab2c38<_0x29d03b)continue;if(_0xab2c38>_0x29d03b+_0x2f6a58)continue;const _0x1e1e5d=(_0x35f3a6[_0x39e51a(0x1ae)]||_0x35f3a6['summary']||'')[_0x39e51a(0x161)]();let _0x3c0d31=![],_0x3a0645=[],_0x3b7514=_0x35f3a6[_0x39e51a(0x1ae)]||_0x35f3a6[_0x39e51a(0x1b1)]||'Unbekannt';if(_0x1e1e5d[_0x39e51a(0x15a)]('urlaub\x20ende')||_0x1e1e5d[_0x39e51a(0x15a)](_0x39e51a(0x17e))||_0x1e1e5d[_0x39e51a(0x15a)](_0x39e51a(0x1af)))_0x3c0d31=!![],_0x3a0645=Array[_0x39e51a(0x1a0)](_0x2eefe8);else for(const _0x2ffa84 of _0x2eefe8){_0x1e1e5d[_0x39e51a(0x15a)](_0x2ffa84['toLowerCase']())&&_0x3a0645[_0x39e51a(0x14e)](_0x2ffa84);}_0x3a0645['length']>0x0&&_0x3a0645[_0x39e51a(0x19a)](_0x2e539f=>{const _0x2bb530=_0x39e51a;let _0x4e0c64=0x3c;if(_0x3c0d31){let _0x31ea44=0x0;Object[_0x2bb530(0x175)](_0x3b7f52)[_0x2bb530(0x19a)](_0x5c495a=>{if(_0x5c495a>_0x31ea44)_0x31ea44=_0x5c495a;}),_0x4e0c64=_0x31ea44>0x0?_0x31ea44:0x78;}else _0x4e0c64=_0x3b7f52[_0x2e539f]||0x3c;const _0x470a1d=new Date(_0xab2c38-_0x4e0c64*0xea60);_0x2fd13b[_0x2bb530(0x14e)]({'eventTime':_0xab2c38,'triggerTime':_0x470a1d[_0x2bb530(0x199)](),'room':_0x2e539f,'minutes':_0x4e0c64,'reason':_0x3b7514,'isGlobal':_0x3c0d31});});}}catch(_0x5b81cc){_0x165170[_0x39e51a(0x1c5)][_0x39e51a(0x187)](_0x39e51a(0x1c7)+_0x5b81cc['message']);}_0x2fd13b[_0x39e51a(0x184)]((_0x479ce4,_0x3f193d)=>_0x479ce4[_0x39e51a(0x159)]-_0x3f193d[_0x39e51a(0x159)]);const _0x4b2b88=_0x2fd13b['slice'](0x0,0x5);await _0x165170[_0x39e51a(0x154)](_0x39e51a(0x150),{'val':JSON['stringify'](_0x4b2b88),'ack':!![]});}async function checkCalendarTriggers(_0x4d93dd){const _0xb9062a=a1_0x4d81;if(!_0x4d93dd['config'][_0xb9062a(0x1a1)]||!_0x4d93dd[_0xb9062a(0x1c1)][_0xb9062a(0x15c)])return;await updateSchedulePreview(_0x4d93dd);let _0x45f621={};try{const _0x2dc450=await _0x4d93dd['getStateAsync'](_0xb9062a(0x166));if(_0x2dc450&&_0x2dc450[_0xb9062a(0x13f)])_0x45f621=JSON[_0xb9062a(0x1cb)](_0x2dc450[_0xb9062a(0x13f)]);}catch(_0x3feaea){}try{const _0x3216bf=await _0x4d93dd[_0xb9062a(0x1c4)](_0x4d93dd[_0xb9062a(0x1c1)][_0xb9062a(0x15c)]+_0xb9062a(0x16a));if(!_0x3216bf||!_0x3216bf[_0xb9062a(0x13f)])return;const _0xf53927=JSON[_0xb9062a(0x1cb)](_0x3216bf['val']),_0x4ec4bc=new Date(),_0x503019=_0x4d93dd[_0xb9062a(0x1c1)][_0xb9062a(0x18a)]||[],_0x256015=_0x4d93dd[_0xb9062a(0x1c1)][_0xb9062a(0x17b)]||[];for(const _0x24cc32 of _0xf53927){if(_0x24cc32[_0xb9062a(0x16c)]&&_0x256015[_0xb9062a(0x192)]>0x0&&!_0x256015[_0xb9062a(0x15a)](_0x24cc32[_0xb9062a(0x16c)]))continue;const _0x324e1a=new Date(_0x24cc32['eventStart']),_0x13b13b=(_0x24cc32[_0xb9062a(0x1ae)]||_0x24cc32[_0xb9062a(0x1b1)]||'')[_0xb9062a(0x161)]();if(_0x13b13b['includes'](_0xb9062a(0x18b))||_0x13b13b['includes']('r√ºckkehr')||_0x13b13b[_0xb9062a(0x15a)](_0xb9062a(0x1af))){let _0x53f377=0x0;Object[_0xb9062a(0x175)](_0x45f621)[_0xb9062a(0x19a)](_0x181453=>{if(_0x181453>_0x53f377)_0x53f377=_0x181453;});if(_0x53f377===0x0)_0x53f377=0x78;const _0x286edd=new Date(_0x324e1a['getTime']()-_0x53f377*0xea60),_0x2b2518=_0x4ec4bc[_0xb9062a(0x199)]()-_0x286edd['getTime']();_0x2b2518>=0x0&&_0x2b2518<0xf*0xea60&&(_0x4d93dd['log'][_0xb9062a(0x158)](_0xb9062a(0x167)+_0x24cc32[_0xb9062a(0x1ae)]+_0xb9062a(0x19b)+_0x53f377+_0xb9062a(0x156)),await _0x4d93dd['setStateAsync']('system.mode',{'val':_0xb9062a(0x13c),'ack':![]}));}for(const _0x5a3f88 of _0x503019){if(_0x5a3f88[_0xb9062a(0x15f)]){const _0x2cc095=_0x5a3f88[_0xb9062a(0x15f)][_0xb9062a(0x161)]();if(_0x13b13b[_0xb9062a(0x15a)](_0x2cc095)){const _0x3fee10=_0x45f621[_0x5a3f88['location']]||0x3c,_0x3daff7=new Date(_0x324e1a[_0xb9062a(0x199)]()-_0x3fee10*0xea60),_0x1f01ef=_0x4ec4bc[_0xb9062a(0x199)]()-_0x3daff7[_0xb9062a(0x199)]();if(_0x1f01ef>=0x0&&_0x1f01ef<0xf*0xea60){const _0x44b445=await findRelatedId(_0x4d93dd,_0x5a3f88['id'],_0xb9062a(0x1b4));_0x44b445&&(_0x4d93dd[_0xb9062a(0x1c5)][_0xb9062a(0x158)](_0xb9062a(0x18e)+_0x5a3f88['location']+_0xb9062a(0x1ba)+_0x24cc32['event']+_0xb9062a(0x143)+_0x3fee10+_0xb9062a(0x156)),await _0x4d93dd[_0xb9062a(0x1a3)](_0x44b445,0x15),await _0x4d93dd[_0xb9062a(0x154)](_0xb9062a(0x164),{'val':_0xb9062a(0x182)+_0x5a3f88[_0xb9062a(0x15f)]+_0xb9062a(0x173),'ack':!![]}));}}}}}}catch(_0x4f5640){_0x4d93dd['log'][_0xb9062a(0x187)]('Calendar\x20Check\x20Error:\x20'+_0x4f5640[_0xb9062a(0x1a9)]);}}function a1_0x4d81(_0x5498b1,_0x45cd13){const _0x52cb98=a1_0x463e();return a1_0x4d81=function(_0x5d0c40,_0x14f05c){_0x5d0c40=_0x5d0c40-0x13b;let _0x463eb5=_0x52cb98[_0x5d0c40];return _0x463eb5;},a1_0x4d81(_0x5498b1,_0x45cd13);}async function applyEnergySavings(_0x21a867,_0x50e1af){const _0x3feac1=a1_0x4d81;if(!_0x50e1af||_0x50e1af[_0x3feac1(0x192)]===0x0)return;const _0x4c82d0=_0x21a867[_0x3feac1(0x1c1)][_0x3feac1(0x18a)]||[],_0x4881f5=Date[_0x3feac1(0x19e)]();for(const _0x4c5434 of _0x50e1af){const _0x5902eb=_0x4c5434['room'],_0x271046=_0x4c5434['minutes_safe'],_0x4ad0ca=_0x4c5434[_0x3feac1(0x19c)]||0x15,_0x11ed3a=_0x4c82d0[_0x3feac1(0x1b9)](_0xb53412=>normalize(_0xb53412[_0x3feac1(0x15f)])===normalize(_0x5902eb)&&(_0xb53412['type']===_0x3feac1(0x193)||_0xb53412['type']===_0x3feac1(0x176)));if(!_0x11ed3a)continue;const _0x597409=await findRelatedId(_0x21a867,_0x11ed3a['id'],'setpoint');if(_0x597409){if(lastActions[_0x3feac1(0x17f)+_0x5902eb]&&_0x4881f5-lastActions[_0x3feac1(0x17f)+_0x5902eb]<0x1e*0x3c*0x3e8)continue;const _0x21d717=await _0x21a867[_0x3feac1(0x1c4)](_0x597409);if(_0x21d717&&typeof _0x21d717[_0x3feac1(0x13f)]===_0x3feac1(0x1a2)){const _0x4797be=_0x21d717[_0x3feac1(0x13f)];if(_0x271046>0x1e)_0x4797be>ECO_TEMP+0.5&&(_0x21a867[_0x3feac1(0x1c5)][_0x3feac1(0x158)](_0x3feac1(0x194)+_0x5902eb+'\x20auf\x20'+ECO_TEMP+'¬∞C!\x20(Aktuell:\x20'+_0x4797be+'¬∞C,\x20Puffer:\x20'+_0x271046+'\x20min)\x20->\x20ID:\x20'+_0x597409),await _0x21a867[_0x3feac1(0x1a3)](_0x597409,ECO_TEMP),lastActions['mpc_'+_0x5902eb]=_0x4881f5,await _0x21a867[_0x3feac1(0x154)](_0x3feac1(0x164),{'val':_0x3feac1(0x13b)+_0x5902eb+_0x3feac1(0x163)+ECO_TEMP+'¬∞C','ack':!![]}));else _0x271046<=0xf&&(_0x4797be<_0x4ad0ca&&(_0x21a867[_0x3feac1(0x1c5)]['info'](_0x3feac1(0x1ab)+_0x5902eb+_0x3feac1(0x1bc)+_0x4ad0ca+_0x3feac1(0x1c6)+_0x597409),await _0x21a867[_0x3feac1(0x1a3)](_0x597409,_0x4ad0ca),lastActions[_0x3feac1(0x17f)+_0x5902eb]=_0x4881f5,await _0x21a867['setStateAsync']('analysis.automation.lastAction',{'val':_0x3feac1(0x13b)+_0x5902eb+_0x3feac1(0x186)+_0x4ad0ca+'¬∞C','ack':!![]})));}}else _0x21a867[_0x3feac1(0x1c5)]['warn']('[MPC\x20WARNING]\x20Kein\x20Setpoint\x20(Soll-Temp)\x20f√ºr\x20'+_0x5902eb+_0x3feac1(0x16f));}}module[a1_0x4b7e7a(0x170)]={'handlePrediction':handlePrediction,'applyEnergySavings':applyEnergySavings,'scanThermostats':scanThermostats,'checkCalendarTriggers':checkCalendarTriggers,'updateSchedulePreview':updateSchedulePreview};