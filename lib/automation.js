const a1_0x2da487=a1_0x1350;(function(_0x1cc604,_0x2cd489){const _0x5ca6c9=a1_0x1350,_0x57fe42=_0x1cc604();while(!![]){try{const _0xbc260a=-parseInt(_0x5ca6c9(0x1aa))/0x1*(parseInt(_0x5ca6c9(0x179))/0x2)+parseInt(_0x5ca6c9(0x181))/0x3+parseInt(_0x5ca6c9(0x183))/0x4+parseInt(_0x5ca6c9(0x198))/0x5+parseInt(_0x5ca6c9(0x1cd))/0x6*(parseInt(_0x5ca6c9(0x14c))/0x7)+-parseInt(_0x5ca6c9(0x1b6))/0x8*(parseInt(_0x5ca6c9(0x178))/0x9)+parseInt(_0x5ca6c9(0x154))/0xa*(-parseInt(_0x5ca6c9(0x1b8))/0xb);if(_0xbc260a===_0x2cd489)break;else _0x57fe42['push'](_0x57fe42['shift']());}catch(_0x127750){_0x57fe42['push'](_0x57fe42['shift']());}}}(a1_0x3cb8,0x38c68));const a1_0x3821a5=(function(){let _0x38e610=!![];return function(_0x157d85,_0x3cd443){const _0x30d9d6=_0x38e610?function(){const _0x599123=a1_0x1350;if(_0x3cd443){const _0x12da67=_0x3cd443[_0x599123(0x1e9)](_0x157d85,arguments);return _0x3cd443=null,_0x12da67;}}:function(){};return _0x38e610=![],_0x30d9d6;};}()),a1_0x29ce42=a1_0x3821a5(this,function(){const _0x5e2630=a1_0x1350;return a1_0x29ce42[_0x5e2630(0x1c0)]()['search'](_0x5e2630(0x1da))[_0x5e2630(0x1c0)]()[_0x5e2630(0x14d)](a1_0x29ce42)[_0x5e2630(0x1c1)](_0x5e2630(0x1da));});a1_0x29ce42();'use strict';const aiAgent=require(a1_0x2da487(0x1af)),COOLDOWN_MS=0x3c*0x3e8,CAL_COOLDOWN_MS=0x5a*0x3c*0x3e8,ECO_TEMP=0x11,lastActions={};function normalize(_0x3f08c1){const _0x59166d=a1_0x2da487;if(!_0x3f08c1)return'';return _0x3f08c1[_0x59166d(0x1c5)]()['replace'](/\s+/g,'')[_0x59166d(0x1e8)]();}async function logAutomationAction(_0x280d34,_0x4fd4e3){const _0x25c2bb=a1_0x2da487;await _0x280d34['setStateAsync'](_0x25c2bb(0x1b2),{'val':_0x4fd4e3,'ack':!![]});try{const _0x217341=_0x25c2bb(0x1c7),_0x1c5cb2=await _0x280d34[_0x25c2bb(0x19b)](_0x217341);let _0x37a544=[];if(_0x1c5cb2&&_0x1c5cb2[_0x25c2bb(0x1ad)])try{_0x37a544=JSON[_0x25c2bb(0x1cc)](_0x1c5cb2[_0x25c2bb(0x1ad)]);}catch(_0x37a6f1){}_0x37a544[_0x25c2bb(0x151)]({'ts':Date[_0x25c2bb(0x1ca)](),'msg':_0x4fd4e3});if(_0x37a544['length']>0x32)_0x37a544=_0x37a544[_0x25c2bb(0x15c)](0x0,0x32);await _0x280d34[_0x25c2bb(0x166)](_0x217341,{'val':JSON[_0x25c2bb(0x189)](_0x37a544),'ack':!![]});}catch(_0x386533){}}async function handlePrediction(_0x2bf917,_0x575383,_0x2bdcd3){const _0x2f94c1=a1_0x2da487;if(!_0x575383||_0x575383==='Unknown')return;let _0x1ab4d2=_0x2f94c1(0x17e),_0x2fa56d=0.6;try{const _0x2c2266=await _0x2bf917[_0x2f94c1(0x19b)](_0x2f94c1(0x169));if(_0x2c2266&&_0x2c2266[_0x2f94c1(0x1ad)])_0x1ab4d2=_0x2c2266['val'];const _0x499365=await _0x2bf917['getStateAsync']('analysis.automation.confidenceThreshold');if(_0x499365&&_0x499365['val'])_0x2fa56d=_0x499365[_0x2f94c1(0x1ad)];}catch(_0x21c4e8){}if(_0x1ab4d2==='off'||_0x2bdcd3<_0x2fa56d)return;const _0x2eed01=Date['now']();if(lastActions[_0x575383]&&_0x2eed01-lastActions[_0x575383]<COOLDOWN_MS)return;const _0x1848cd=_0x2bf917[_0x2f94c1(0x174)][_0x2f94c1(0x1e4)]||[],_0x2c25dd=normalize(_0x575383),_0x508309=_0x1848cd[_0x2f94c1(0x199)](_0x548c4a=>normalize(_0x548c4a[_0x2f94c1(0x14e)])===_0x2c25dd&&(_0x548c4a[_0x2f94c1(0x1b1)]===_0x2f94c1(0x1e1)||_0x548c4a[_0x2f94c1(0x1b1)]===_0x2f94c1(0x1b7)||_0x548c4a[_0x2f94c1(0x1b1)]===_0x2f94c1(0x19a)));if(!_0x508309)return;const _0x14c0da=await aiAgent['consultButler'](_0x2bf917,_0x575383,_0x508309['name'],_0x2bdcd3);if(!_0x14c0da['approved'])return;const _0x366940=_0x2f94c1(0x1ec)+_0x575383+_0x2f94c1(0x191)+_0x508309[_0x2f94c1(0x1c6)]+'\x20('+_0x14c0da[_0x2f94c1(0x1a9)]+')';await logAutomationAction(_0x2bf917,'['+_0x1ab4d2[_0x2f94c1(0x190)]()+']\x20'+_0x366940);if(_0x1ab4d2===_0x2f94c1(0x192)){const _0x4af7d3=await _0x2bf917['getForeignStateAsync'](_0x508309['id']);(!_0x4af7d3||!_0x4af7d3[_0x2f94c1(0x1ad)]&&_0x4af7d3[_0x2f94c1(0x1ad)]!==!![])&&await _0x2bf917[_0x2f94c1(0x1b4)](_0x508309['id'],!![]),lastActions[_0x575383]=_0x2eed01;}}async function findRelatedId(_0x64d81,_0x364ba5,_0x59a08c='setpoint'){const _0x7d8b6b=a1_0x2da487;if(_0x59a08c===_0x7d8b6b(0x1e7)&&_0x64d81[_0x7d8b6b(0x174)][_0x7d8b6b(0x1ef)]){let _0x48df49=_0x64d81[_0x7d8b6b(0x174)][_0x7d8b6b(0x1ef)];if(typeof _0x48df49===_0x7d8b6b(0x156))try{_0x48df49=JSON['parse'](_0x48df49);}catch(_0x32206f){}if(_0x48df49&&_0x48df49[_0x364ba5])return _0x48df49[_0x364ba5];}if(_0x59a08c===_0x7d8b6b(0x1ab)&&_0x64d81[_0x7d8b6b(0x174)][_0x7d8b6b(0x17c)]){let _0x102ff6=_0x64d81[_0x7d8b6b(0x174)][_0x7d8b6b(0x17c)];if(typeof _0x102ff6===_0x7d8b6b(0x156))try{_0x102ff6=JSON['parse'](_0x102ff6);}catch(_0xed4535){}if(_0x102ff6&&_0x102ff6[_0x364ba5])return _0x102ff6[_0x364ba5];}let _0x43a597=[];if(_0x59a08c==='setpoint')_0x43a597=[{'s':_0x7d8b6b(0x180),'t':_0x7d8b6b(0x1a0)},{'s':_0x7d8b6b(0x16e),'t':_0x7d8b6b(0x1a0)},{'s':_0x7d8b6b(0x16e),'t':_0x7d8b6b(0x1e3)},{'s':_0x7d8b6b(0x1de),'t':_0x7d8b6b(0x18f)},{'s':_0x7d8b6b(0x1df),'t':'occupied_heating_setpoint'},{'s':_0x7d8b6b(0x1df),'t':_0x7d8b6b(0x1e0)},{'s':_0x7d8b6b(0x15b),'t':_0x7d8b6b(0x1c9)},{'s':_0x7d8b6b(0x19e),'t':_0x7d8b6b(0x1ba)},{'s':'Ist','t':_0x7d8b6b(0x1d9)},{'s':'temperature','t':_0x7d8b6b(0x1e7)}];else _0x59a08c===_0x7d8b6b(0x1ab)&&(_0x43a597=[{'s':_0x7d8b6b(0x180),'t':'.1.LEVEL'},{'s':_0x7d8b6b(0x16e),'t':_0x7d8b6b(0x16f)},{'s':'.1.TEMPERATURE','t':'.4.VALVE_STATE'},{'s':_0x7d8b6b(0x1df),'t':_0x7d8b6b(0x1e5)},{'s':_0x7d8b6b(0x15b),'t':_0x7d8b6b(0x19f)},{'s':'temperature','t':'level'}]);for(const _0x12f54a of _0x43a597){if(_0x364ba5[_0x7d8b6b(0x16d)](_0x12f54a['s'])){const _0x443e3a=_0x364ba5[_0x7d8b6b(0x162)](_0x12f54a['s'],_0x12f54a['t']),_0x57f98e=await _0x64d81[_0x7d8b6b(0x1ed)](_0x443e3a);if(_0x57f98e)return _0x443e3a;}}try{const _0x5ca664=_0x364ba5['split']('.');if(_0x5ca664[_0x7d8b6b(0x1a3)]>0x2){const _0x38be3c=_0x5ca664[_0x7d8b6b(0x15c)](0x0,-0x1)[_0x7d8b6b(0x1a5)]('.'),_0x13df7a=await _0x64d81[_0x7d8b6b(0x194)](_0x38be3c+'.*'),_0x282673=[],_0x22bdf7=_0x364ba5[_0x7d8b6b(0x1d8)](/[._]+/)[_0x7d8b6b(0x17a)](_0x635504=>![_0x7d8b6b(0x1d1),'0','hm-rpc','ist',_0x7d8b6b(0x175),_0x7d8b6b(0x15b),_0x7d8b6b(0x1be),_0x7d8b6b(0x159),_0x7d8b6b(0x1c8),_0x7d8b6b(0x150)]['includes'](_0x635504[_0x7d8b6b(0x1c5)]()));for(const [_0x2bce92,_0x4fdcd9]of Object['entries'](_0x13df7a)){if(_0x2bce92===_0x364ba5)continue;if(_0x4fdcd9&&_0x4fdcd9['common']){const _0x1c4381=_0x2bce92[_0x7d8b6b(0x1c5)](),_0x2bcbec=(_0x4fdcd9[_0x7d8b6b(0x170)][_0x7d8b6b(0x157)]||'')['toLowerCase'](),_0x117a10=(_0x4fdcd9['common']['unit']||'')['toLowerCase']();let _0x4dd04a=![];if(_0x59a08c===_0x7d8b6b(0x1e7)&&_0x4fdcd9[_0x7d8b6b(0x170)][_0x7d8b6b(0x188)]===!![])_0x4dd04a=_0x1c4381[_0x7d8b6b(0x16d)](_0x7d8b6b(0x155))||_0x1c4381[_0x7d8b6b(0x16d)](_0x7d8b6b(0x1bc))||_0x1c4381[_0x7d8b6b(0x16d)]('target')||_0x2bcbec[_0x7d8b6b(0x16d)](_0x7d8b6b(0x173))||_0x2bcbec[_0x7d8b6b(0x16d)](_0x7d8b6b(0x16c));else _0x59a08c===_0x7d8b6b(0x1ab)&&(_0x4dd04a=_0x1c4381[_0x7d8b6b(0x16d)](_0x7d8b6b(0x1d4))||_0x1c4381[_0x7d8b6b(0x16d)](_0x7d8b6b(0x1ab))||_0x1c4381[_0x7d8b6b(0x16d)](_0x7d8b6b(0x1b5))||_0x1c4381[_0x7d8b6b(0x16d)](_0x7d8b6b(0x1a7))||_0x2bcbec[_0x7d8b6b(0x16d)](_0x7d8b6b(0x15f))||_0x2bcbec['includes'](_0x7d8b6b(0x15d))||_0x117a10[_0x7d8b6b(0x16d)]('%'));if(_0x4dd04a){const _0x1196be=_0x2bce92[_0x7d8b6b(0x1d8)](/[._]+/)[_0x7d8b6b(0x19d)](_0x3c63de=>_0x3c63de[_0x7d8b6b(0x1c5)]());let _0x1fbbae=0x0;_0x22bdf7[_0x7d8b6b(0x182)](_0x373fde=>{const _0x298695=_0x7d8b6b;if(_0x1196be[_0x298695(0x16d)](_0x373fde['toLowerCase']()))_0x1fbbae++;}),_0x282673[_0x7d8b6b(0x1b9)]({'id':_0x2bce92,'score':_0x1fbbae});}}}if(_0x282673['length']>0x0){_0x282673[_0x7d8b6b(0x186)]((_0x51d66f,_0x325eb6)=>_0x325eb6[_0x7d8b6b(0x164)]-_0x51d66f[_0x7d8b6b(0x164)]);if(_0x282673[0x0][_0x7d8b6b(0x164)]>0x0)return _0x282673[0x0]['id'];}}}catch(_0xb7b9c0){}return null;}async function scanThermostats(_0x416a14){const _0x1cfdab=a1_0x2da487,_0x5d05d1=_0x416a14[_0x1cfdab(0x174)][_0x1cfdab(0x1e4)]||[],_0x4aaff4=[],_0x23c264=_0x5d05d1[_0x1cfdab(0x17a)](_0x4acea7=>_0x4acea7['id']&&_0x4acea7['id']['includes'](_0x1cfdab(0x15b))||_0x4acea7[_0x1cfdab(0x1b1)]&&[_0x1cfdab(0x15b),_0x1cfdab(0x1e6),_0x1cfdab(0x159)][_0x1cfdab(0x16d)](_0x4acea7['type'])||_0x4acea7['name']&&_0x4acea7['name']['toLowerCase']()[_0x1cfdab(0x16d)](_0x1cfdab(0x161)));for(const _0x4a51c2 of _0x23c264){const _0x553c61=await findRelatedId(_0x416a14,_0x4a51c2['id'],_0x1cfdab(0x1e7)),_0xf492f2=await findRelatedId(_0x416a14,_0x4a51c2['id'],_0x1cfdab(0x1ab));let _0x1ef261=_0x1cfdab(0x1f1),_0x446466=![],_0xf4394c=_0x416a14['config'][_0x1cfdab(0x1ef)]||{};if(typeof _0xf4394c===_0x1cfdab(0x156))try{_0xf4394c=JSON[_0x1cfdab(0x1cc)](_0xf4394c);}catch(_0x1544ae){}let _0x23b83d=_0x416a14[_0x1cfdab(0x174)][_0x1cfdab(0x17c)]||{};if(typeof _0x23b83d===_0x1cfdab(0x156))try{_0x23b83d=JSON[_0x1cfdab(0x1cc)](_0x23b83d);}catch(_0x6b2dd9){}if(_0xf4394c[_0x4a51c2['id']]&&_0xf4394c[_0x4a51c2['id']]===_0x553c61||_0x23b83d[_0x4a51c2['id']]&&_0x23b83d[_0x4a51c2['id']]===_0xf492f2)_0x1ef261=_0x1cfdab(0x172),_0x446466=!![];else(_0x553c61||_0xf492f2)&&(_0x1ef261=_0x1cfdab(0x1bf));_0x4aaff4['push']({'room':_0x4a51c2[_0x1cfdab(0x14e)]||_0x1cfdab(0x1d2),'sensorId':_0x4a51c2['id'],'setpointId':_0x553c61||'-','valveId':_0xf492f2||'-','source':_0x1ef261,'isManual':_0x446466,'status':_0x553c61&&_0xf492f2?_0x1cfdab(0x196):_0x553c61?'OK':'Fehlt'});}return _0x4aaff4[_0x1cfdab(0x186)]((_0xa8704e,_0x2b6faa)=>_0xa8704e[_0x1cfdab(0x1dd)][_0x1cfdab(0x1a6)](_0x2b6faa[_0x1cfdab(0x1dd)]));}async function updateSchedulePreview(_0xa32ed7){const _0x60f1cd=a1_0x2da487;if(!_0xa32ed7[_0x60f1cd(0x174)][_0x60f1cd(0x1c3)]||!_0xa32ed7[_0x60f1cd(0x174)][_0x60f1cd(0x193)])return;let _0x46cf38={};try{const _0x47b3f4=await _0xa32ed7[_0x60f1cd(0x19b)]('analysis.energy.warmupTimes');if(_0x47b3f4&&_0x47b3f4[_0x60f1cd(0x1ad)])_0x46cf38=JSON[_0x60f1cd(0x1cc)](_0x47b3f4[_0x60f1cd(0x1ad)]);}catch(_0x1c1248){}const _0x1d972=[],_0x4faa4e=Date['now'](),_0x3ee066=0x30*0x3c*0x3c*0x3e8;try{const _0x4573d7=await _0xa32ed7[_0x60f1cd(0x15e)](_0xa32ed7[_0x60f1cd(0x174)][_0x60f1cd(0x193)]+_0x60f1cd(0x1ac));if(!_0x4573d7||!_0x4573d7[_0x60f1cd(0x1ad)])return;const _0x55a4bd=JSON['parse'](_0x4573d7[_0x60f1cd(0x1ad)]),_0xc5c0e9=_0xa32ed7[_0x60f1cd(0x174)][_0x60f1cd(0x1bd)]||[],_0x2cb21c=_0xa32ed7[_0x60f1cd(0x174)][_0x60f1cd(0x1e4)]||[],_0x34e82c=new Set();_0x2cb21c[_0x60f1cd(0x182)](_0x11a308=>{const _0x4f9c69=_0x60f1cd;if(_0x11a308[_0x4f9c69(0x14e)])_0x34e82c[_0x4f9c69(0x19c)](_0x11a308[_0x4f9c69(0x14e)]);});for(const _0x74cbd5 of _0x55a4bd){if(_0x74cbd5[_0x60f1cd(0x1ee)]&&_0xc5c0e9['length']>0x0&&!_0xc5c0e9[_0x60f1cd(0x16d)](_0x74cbd5[_0x60f1cd(0x1ee)]))continue;const _0x861ce3=_0x74cbd5[_0x60f1cd(0x195)]||_0x74cbd5['eventStart']||_0x74cbd5[_0x60f1cd(0x18e)];if(!_0x861ce3)continue;const _0x1a3159=new Date(_0x861ce3),_0x2ec879=_0x1a3159[_0x60f1cd(0x184)]();if(isNaN(_0x2ec879))continue;if(_0x2ec879<_0x4faa4e)continue;if(_0x2ec879>_0x4faa4e+_0x3ee066)continue;const _0x1f51ad=(_0x74cbd5[_0x60f1cd(0x1eb)]||_0x74cbd5[_0x60f1cd(0x18d)]||'')[_0x60f1cd(0x1c5)]();let _0x53ac37=![],_0x47c1e8=[],_0x2efd25=_0x74cbd5[_0x60f1cd(0x1eb)]||_0x74cbd5['summary']||_0x60f1cd(0x1d2);if(_0x1f51ad[_0x60f1cd(0x16d)]('urlaub\x20ende')||_0x1f51ad[_0x60f1cd(0x16d)](_0x60f1cd(0x14f))||_0x1f51ad[_0x60f1cd(0x16d)](_0x60f1cd(0x177)))_0x53ac37=!![],_0x47c1e8=Array[_0x60f1cd(0x185)](_0x34e82c);else for(const _0x5d2db0 of _0x34e82c){if(_0x1f51ad[_0x60f1cd(0x16d)](_0x5d2db0['toLowerCase']()))_0x47c1e8[_0x60f1cd(0x1b9)](_0x5d2db0);}_0x47c1e8['length']>0x0&&_0x47c1e8[_0x60f1cd(0x182)](_0xb71348=>{const _0xb717d8=_0x60f1cd;let _0x5b7b1b=0x3c;if(_0x53ac37){let _0x5dadb4=0x0;Object[_0xb717d8(0x1cb)](_0x46cf38)[_0xb717d8(0x182)](_0x495153=>{if(_0x495153>_0x5dadb4)_0x5dadb4=_0x495153;}),_0x5b7b1b=_0x5dadb4>0x0?_0x5dadb4:0x78;}else _0x5b7b1b=_0x46cf38[_0xb71348]||0x3c;const _0x37222e=new Date(_0x2ec879-_0x5b7b1b*0xea60);_0x1d972['push']({'eventTime':_0x2ec879,'triggerTime':_0x37222e['getTime'](),'room':_0xb71348,'minutes':_0x5b7b1b,'reason':_0x2efd25,'isGlobal':_0x53ac37});});}}catch(_0x4db74f){}_0x1d972[_0x60f1cd(0x186)]((_0x1d7028,_0x31a3b6)=>_0x1d7028[_0x60f1cd(0x1a1)]-_0x31a3b6[_0x60f1cd(0x1a1)]);const _0x5e026a=_0x1d972[_0x60f1cd(0x15c)](0x0,0x5);await _0xa32ed7[_0x60f1cd(0x166)](_0x60f1cd(0x1b0),{'val':JSON['stringify'](_0x5e026a),'ack':!![]});}function a1_0x1350(_0x4898b5,_0xd24ae){const _0x52d82a=a1_0x3cb8();return a1_0x1350=function(_0x29ce42,_0x3821a5){_0x29ce42=_0x29ce42-0x14c;let _0x3cb818=_0x52d82a[_0x29ce42];return _0x3cb818;},a1_0x1350(_0x4898b5,_0xd24ae);}async function checkCalendarTriggers(_0x2ee167){const _0x53d0e0=a1_0x2da487;if(!_0x2ee167[_0x53d0e0(0x174)]['useCalendar']||!_0x2ee167[_0x53d0e0(0x174)][_0x53d0e0(0x193)])return;await updateSchedulePreview(_0x2ee167);let _0x1517ef={},_0x204b0e={};try{const _0xc6aa75=await _0x2ee167[_0x53d0e0(0x19b)]('analysis.energy.warmupTimes');if(_0xc6aa75&&_0xc6aa75['val'])_0x1517ef=JSON['parse'](_0xc6aa75[_0x53d0e0(0x1ad)]);const _0xdcf7c5=await _0x2ee167[_0x53d0e0(0x19b)]('analysis.energy.warmupSources');if(_0xdcf7c5&&_0xdcf7c5['val'])_0x204b0e=JSON[_0x53d0e0(0x1cc)](_0xdcf7c5[_0x53d0e0(0x1ad)]);}catch(_0x32a687){}let _0x381f3c={'default':0x15};try{const _0x42e84b=await _0x2ee167[_0x53d0e0(0x19b)]('analysis.energy.warmupTargets');if(_0x42e84b&&_0x42e84b['val'])_0x381f3c=JSON['parse'](_0x42e84b[_0x53d0e0(0x1ad)]);}catch(_0x2724d5){}try{const _0x1fc187=await _0x2ee167[_0x53d0e0(0x15e)](_0x2ee167[_0x53d0e0(0x174)][_0x53d0e0(0x193)]+_0x53d0e0(0x1ac));if(!_0x1fc187||!_0x1fc187[_0x53d0e0(0x1ad)])return;const _0xe8ce3e=JSON['parse'](_0x1fc187['val']),_0x2b9047=Date[_0x53d0e0(0x1ca)](),_0x740ce5=_0x2ee167['config']['devices']||[],_0x2fc4dc=_0x2ee167['config'][_0x53d0e0(0x1bd)]||[];for(const _0x3f4fd7 of _0xe8ce3e){if(_0x3f4fd7[_0x53d0e0(0x1ee)]&&_0x2fc4dc['length']>0x0&&!_0x2fc4dc[_0x53d0e0(0x16d)](_0x3f4fd7[_0x53d0e0(0x1ee)]))continue;const _0x35707b=_0x3f4fd7['_date']||_0x3f4fd7[_0x53d0e0(0x1a8)]||_0x3f4fd7[_0x53d0e0(0x18e)];if(!_0x35707b)continue;const _0x3e65b0=new Date(_0x35707b);if(isNaN(_0x3e65b0[_0x53d0e0(0x184)]()))continue;const _0x2055c0=(_0x3f4fd7[_0x53d0e0(0x1eb)]||_0x3f4fd7[_0x53d0e0(0x18d)]||'')[_0x53d0e0(0x1c5)]();if(_0x2055c0[_0x53d0e0(0x16d)](_0x53d0e0(0x171))||_0x2055c0[_0x53d0e0(0x16d)](_0x53d0e0(0x14f))||_0x2055c0[_0x53d0e0(0x16d)](_0x53d0e0(0x177))){let _0x3c0a66=0x0;Object[_0x53d0e0(0x1cb)](_0x1517ef)['forEach'](_0x18604b=>{if(_0x18604b>_0x3c0a66)_0x3c0a66=_0x18604b;});if(_0x3c0a66===0x0)_0x3c0a66=0x78;const _0x9c5e23=_0x3e65b0['getTime']()-_0x3c0a66*0xea60;_0x2b9047>=_0x9c5e23&&_0x2b9047<_0x3e65b0[_0x53d0e0(0x184)]()&&(_0x2ee167[_0x53d0e0(0x158)]!==_0x53d0e0(0x168)&&(_0x2ee167[_0x53d0e0(0x18a)]['info']('üìÖ\x20SMART\x20SCHEDULE\x20(Phase):\x20\x27Globaler\x20Start\x27\x20erkannt.\x20Heize\x20Haus\x20auf\x20(Vorlauf:\x20'+_0x3c0a66+_0x53d0e0(0x1e2)),await _0x2ee167[_0x53d0e0(0x166)]('system.mode',{'val':'normal','ack':![]})));}for(const _0x25d02c of _0x740ce5){if(_0x25d02c['location']){const _0x25a049=_0x25d02c[_0x53d0e0(0x14e)][_0x53d0e0(0x1c5)]();if(_0x2055c0[_0x53d0e0(0x16d)](_0x25a049)){const _0x3d2d89=_0x1517ef[_0x25d02c[_0x53d0e0(0x14e)]]||0x3c,_0xa65dcf=_0x204b0e[_0x25d02c['location']]||'Classic',_0x3168d0=_0x3e65b0[_0x53d0e0(0x184)]()-_0x3d2d89*0xea60;if(_0x2b9047>=_0x3168d0&&_0x2b9047<_0x3e65b0['getTime']()){const _0x20662c=lastActions[_0x53d0e0(0x17d)+_0x25d02c[_0x53d0e0(0x14e)]];if(_0x20662c&&_0x2b9047-_0x20662c<CAL_COOLDOWN_MS)continue;const _0x3444fd=await findRelatedId(_0x2ee167,_0x25d02c['id'],'setpoint');if(_0x3444fd){let _0x2c8ac6=_0x381f3c[_0x25d02c[_0x53d0e0(0x14e)]];if(_0x2c8ac6===undefined)_0x2c8ac6=_0x381f3c[_0x53d0e0(0x1ea)];if(_0x2c8ac6===undefined)_0x2c8ac6=0x15;const _0x20727c=await _0x2ee167[_0x53d0e0(0x15e)](_0x3444fd);_0x20727c&&typeof _0x20727c[_0x53d0e0(0x1ad)]===_0x53d0e0(0x16a)&&_0x20727c[_0x53d0e0(0x1ad)]<_0x2c8ac6-0.5&&(_0x2ee167[_0x53d0e0(0x18a)][_0x53d0e0(0x176)](_0x53d0e0(0x17f)+_0xa65dcf+_0x53d0e0(0x1d0)+_0x25d02c['location']+_0x53d0e0(0x1f0)+_0x2c8ac6+_0x53d0e0(0x1dc)+_0x3d2d89+'\x20min).'),await _0x2ee167[_0x53d0e0(0x1b4)](_0x3444fd,_0x2c8ac6),await logAutomationAction(_0x2ee167,_0x53d0e0(0x187)+_0x25d02c[_0x53d0e0(0x14e)]+'\x20->\x20'+_0x2c8ac6+_0x53d0e0(0x1d7)+_0xa65dcf+')'),lastActions['cal_'+_0x25d02c[_0x53d0e0(0x14e)]]=_0x2b9047);}}}}}}}catch(_0x4a1507){_0x2ee167[_0x53d0e0(0x18a)]['warn'](_0x53d0e0(0x163)+_0x4a1507['message']);}}async function manageMpcIntervention(_0xeac4de,_0x258d18,_0x4dfc7c){const _0x1ae9fc=a1_0x2da487;try{const _0x16d7ad=_0x1ae9fc(0x18c),_0x1e832f=await _0xeac4de[_0x1ae9fc(0x19b)](_0x16d7ad);let _0x53963e=[];if(_0x1e832f&&_0x1e832f[_0x1ae9fc(0x1ad)])try{_0x53963e=JSON['parse'](_0x1e832f[_0x1ae9fc(0x1ad)]);}catch(_0x33093d){}const _0x14253e=_0x53963e['indexOf'](_0x258d18);if(_0x4dfc7c===_0x1ae9fc(0x19c))_0x14253e===-0x1&&(_0x53963e[_0x1ae9fc(0x1b9)](_0x258d18),await _0xeac4de[_0x1ae9fc(0x166)](_0x16d7ad,{'val':JSON[_0x1ae9fc(0x189)](_0x53963e),'ack':!![]}));else _0x4dfc7c===_0x1ae9fc(0x1d3)&&(_0x14253e!==-0x1&&(_0x53963e[_0x1ae9fc(0x1db)](_0x14253e,0x1),await _0xeac4de[_0x1ae9fc(0x166)](_0x16d7ad,{'val':JSON[_0x1ae9fc(0x189)](_0x53963e),'ack':!![]})));}catch(_0x289736){}}async function cleanupGhostInterventions(_0x122496){const _0x3e1530=a1_0x2da487;try{const _0x18d0a2=_0x3e1530(0x18c),_0x3a5b1b=await _0x122496[_0x3e1530(0x19b)](_0x18d0a2);if(!_0x3a5b1b||!_0x3a5b1b['val'])return;const _0x50b508=JSON[_0x3e1530(0x1cc)](_0x3a5b1b[_0x3e1530(0x1ad)]);if(!Array[_0x3e1530(0x160)](_0x50b508)||_0x50b508[_0x3e1530(0x1a3)]===0x0)return;const _0x612ee9=_0x122496[_0x3e1530(0x174)][_0x3e1530(0x1e4)]||[];let _0x4c5733=![];for(let _0x583afb=_0x50b508[_0x3e1530(0x1a3)]-0x1;_0x583afb>=0x0;_0x583afb--){const _0x5ce79c=_0x50b508[_0x583afb],_0x352cf4=_0x612ee9['find'](_0x3c1237=>normalize(_0x3c1237[_0x3e1530(0x14e)])===normalize(_0x5ce79c)&&(_0x3c1237[_0x3e1530(0x1b1)]===_0x3e1530(0x15b)||_0x3c1237['type']==='thermostat'));if(_0x352cf4){const _0x1b9789=await findRelatedId(_0x122496,_0x352cf4['id'],_0x3e1530(0x1e7));if(_0x1b9789){const _0x2ddb04=await _0x122496['getForeignStateAsync'](_0x1b9789);_0x2ddb04&&typeof _0x2ddb04[_0x3e1530(0x1ad)]===_0x3e1530(0x16a)&&(Math[_0x3e1530(0x18b)](_0x2ddb04['val']-ECO_TEMP)>0.5&&(_0x122496[_0x3e1530(0x18a)][_0x3e1530(0x176)](_0x3e1530(0x1a4)+_0x5ce79c+_0x3e1530(0x1c2)+_0x2ddb04['val']+_0x3e1530(0x1a2)+ECO_TEMP+_0x3e1530(0x1d5)),_0x122496[_0x3e1530(0x17b)]&&(_0x122496[_0x3e1530(0x18a)][_0x3e1530(0x176)](_0x3e1530(0x152)+_0x5ce79c+_0x3e1530(0x1c4)+ECO_TEMP+_0x3e1530(0x165)),_0x122496[_0x3e1530(0x17b)](_0x3e1530(0x16b),{'room':_0x5ce79c})),_0x50b508['splice'](_0x583afb,0x1),_0x4c5733=!![]));}}}_0x4c5733&&await _0x122496[_0x3e1530(0x166)](_0x18d0a2,{'val':JSON['stringify'](_0x50b508),'ack':!![]});}catch(_0x19858f){}}async function applyEnergySavings(_0x2815c2,_0x5909bc){const _0xe55ebb=a1_0x2da487;await cleanupGhostInterventions(_0x2815c2);if(!_0x5909bc||_0x5909bc['length']===0x0)return;const _0x1b4b83=_0x2815c2[_0xe55ebb(0x174)][_0xe55ebb(0x1e4)]||[],_0xf2e473=Date['now']();for(const _0x37cbed of _0x5909bc){const _0x164e99=_0x37cbed[_0xe55ebb(0x1dd)],_0x5561e1=_0x37cbed['minutes_safe'],_0x417edd=_0x37cbed[_0xe55ebb(0x1bb)]||0x15,_0x5eac24=_0x1b4b83['find'](_0x152804=>normalize(_0x152804['location'])===normalize(_0x164e99)&&(_0x152804[_0xe55ebb(0x1b1)]===_0xe55ebb(0x15b)||_0x152804[_0xe55ebb(0x1b1)]==='thermostat'));if(!_0x5eac24)continue;const _0x111ef3=await findRelatedId(_0x2815c2,_0x5eac24['id'],_0xe55ebb(0x1e7));if(_0x111ef3){if(lastActions[_0xe55ebb(0x153)+_0x164e99]&&_0xf2e473-lastActions[_0xe55ebb(0x153)+_0x164e99]<0x1e*0x3c*0x3e8)continue;const _0x424676=await _0x2815c2[_0xe55ebb(0x15e)](_0x111ef3);if(_0x424676&&typeof _0x424676['val']==='number'){const _0x55f4f5=_0x424676['val'];_0x55f4f5!==ECO_TEMP&&await manageMpcIntervention(_0x2815c2,_0x164e99,_0xe55ebb(0x1d3));if(_0x5561e1>0x1e)_0x55f4f5>ECO_TEMP+0.5&&(_0x2815c2[_0xe55ebb(0x18a)]['info']('üçÉ\x20[MPC\x20ACTION]\x20Senke\x20'+_0x164e99+_0xe55ebb(0x1b3)+ECO_TEMP+'¬∞C!\x20(Puffer:\x20'+_0x5561e1+_0xe55ebb(0x1ae)),await _0x2815c2[_0xe55ebb(0x1b4)](_0x111ef3,ECO_TEMP),await manageMpcIntervention(_0x2815c2,_0x164e99,_0xe55ebb(0x19c)),lastActions['mpc_'+_0x164e99]=_0xf2e473,await logAutomationAction(_0x2815c2,_0xe55ebb(0x15a)+_0x164e99+_0xe55ebb(0x1cf)+ECO_TEMP+'¬∞C'));else _0x5561e1<=0xf&&(_0x55f4f5<_0x417edd&&(_0x2815c2[_0xe55ebb(0x18a)][_0xe55ebb(0x176)](_0xe55ebb(0x197)+_0x164e99+'\x20wieder\x20auf\x20'+_0x417edd+'¬∞C!\x20(Puffer\x20leer).'),await _0x2815c2[_0xe55ebb(0x1b4)](_0x111ef3,_0x417edd),await manageMpcIntervention(_0x2815c2,_0x164e99,_0xe55ebb(0x1d3)),lastActions['mpc_'+_0x164e99]=_0xf2e473,await logAutomationAction(_0x2815c2,_0xe55ebb(0x15a)+_0x164e99+_0xe55ebb(0x167)+_0x417edd+'¬∞C')));}}else _0x2815c2[_0xe55ebb(0x18a)][_0xe55ebb(0x1d6)]('[MPC\x20WARNING]\x20Kein\x20Setpoint\x20f√ºr\x20'+_0x164e99+_0xe55ebb(0x1ce));}}function a1_0x3cb8(){const _0x3555ba=['üî•\x20[MPC\x20ACTION]\x20Heize\x20','1618120IJhpSI','find','switch','getStateAsync','add','map','ACTUAL','valve_position','.1.SET_POINT_TEMPERATURE','triggerTime','¬∞C\x20(nicht\x20','length','üßπ\x20[MPC\x20CLEANUP]\x20','join','localeCompare','position','eventStart','reason','103LvXevz','valve','.data.table','val','\x20min)','./ai_agent','analysis.energy.schedulePreview','type','analysis.automation.lastAction','\x20auf\x20','setForeignStateAsync','stellwert','72aGmYry','dimmer','37015iCAbmx','push','SET','target','soll','calendarSelection','actual','Auto-Erkennung','toString','search','\x20ist\x20auf\x20','useCalendar','\x20mag\x20keine\x20','toLowerCase','name','analysis.automation.actionLog','messwert','target_temperature','now','values','parse','66iMEXld','\x20gefunden!',':\x20Absenkung\x20auf\x20',']:\x20Raum-Trigger\x20\x27','openknx','Unbekannt','remove','level','¬∞C).\x20Entferne\x20Status.','warn','¬∞C\x20(via\x20','split','Soll','(((.+)+)+)+$','splice','¬∞C\x20(Vorlauf:\x20','room','ACTUAL_TEMPERATURE','local_temperature','current_heating_setpoint','light','\x20min).','.4.SET_TEMPERATURE','devices','pi_heating_demand','thermostat','setpoint','trim','apply','default','event','Pr√§diktion:\x20','getForeignObjectAsync','_calName','thermostatMapping','\x27\x20aktiv.\x20Heize\x20auf\x20','Nicht\x20gefunden','266966IFlEsw','constructor','location','r√ºckkehr','state','unshift','üéì\x20[RL-FEEDBACK]\x20Lerne\x20aus\x20Fehler:\x20','mpc_','410svJLiR','set','string','role','currentSystemMode','sensor','[MPC]\x20','temperature','slice','value.valve','getForeignStateAsync','level.valve','isArray','temp','replace','Calendar\x20Check\x20Error:\x20','score','¬∞C\x20um\x20diese\x20Zeit.','setStateAsync',':\x20Aufheizen\x20auf\x20','normal','analysis.automation.mode','number','TRAIN_RL_PENALTY','thermostat.setpoint','includes','.1.TEMPERATURE','.1.LEVEL','common','urlaub\x20ende','Manuelles\x20Mapping','level.temperature','config','wert','info','ankunft','452241zOlzIC','6082sdIpSo','filter','sendToPythonWrapper','valveMapping','cal_','off','üìÖ\x20SMART\x20SCHEDULE\x20[','.1.ACTUAL_TEMPERATURE','933618yxzeOs','forEach','326532Nklcyb','getTime','from','sort','[CAL]\x20','write','stringify','log','abs','analysis.energy.mpcActiveInterventions','summary','date','SET_POINT_TEMPERATURE','toUpperCase','\x20->\x20Schalte\x20','active','calendarInstance','getForeignObjectsAsync','_date','PERFECT'];a1_0x3cb8=function(){return _0x3555ba;};return a1_0x3cb8();}module['exports']={'handlePrediction':handlePrediction,'applyEnergySavings':applyEnergySavings,'scanThermostats':scanThermostats,'checkCalendarTriggers':checkCalendarTriggers,'updateSchedulePreview':updateSchedulePreview};