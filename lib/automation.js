const a1_0x29b400=a1_0x3956;(function(_0x16d57d,_0x182d26){const _0x56e25b=a1_0x3956,_0x56b952=_0x16d57d();while(!![]){try{const _0x3957d8=parseInt(_0x56e25b(0x14d))/0x1*(-parseInt(_0x56e25b(0xd9))/0x2)+-parseInt(_0x56e25b(0x132))/0x3*(-parseInt(_0x56e25b(0xe6))/0x4)+parseInt(_0x56e25b(0x10c))/0x5*(parseInt(_0x56e25b(0x12a))/0x6)+parseInt(_0x56e25b(0x14a))/0x7*(parseInt(_0x56e25b(0x155))/0x8)+parseInt(_0x56e25b(0x122))/0x9+parseInt(_0x56e25b(0x133))/0xa+parseInt(_0x56e25b(0x127))/0xb*(-parseInt(_0x56e25b(0x141))/0xc);if(_0x3957d8===_0x182d26)break;else _0x56b952['push'](_0x56b952['shift']());}catch(_0x14a7ee){_0x56b952['push'](_0x56b952['shift']());}}}(a1_0x38b0,0xb6a54));const a1_0x352a14=(function(){let _0x2273d2=!![];return function(_0xaa3de7,_0x2ba947){const _0x2a0f14=_0x2273d2?function(){if(_0x2ba947){const _0x476267=_0x2ba947['apply'](_0xaa3de7,arguments);return _0x2ba947=null,_0x476267;}}:function(){};return _0x2273d2=![],_0x2a0f14;};}()),a1_0x555682=a1_0x352a14(this,function(){const _0x3d2bdc=a1_0x3956;return a1_0x555682[_0x3d2bdc(0x142)]()[_0x3d2bdc(0x156)](_0x3d2bdc(0x153))[_0x3d2bdc(0x142)]()[_0x3d2bdc(0x136)](a1_0x555682)['search']('(((.+)+)+)+$');});a1_0x555682();'use strict';const aiAgent=require('./ai_agent'),COOLDOWN_MS=0x3c*0x3e8,lastActions={};function normalize(_0x33b716){const _0x936938=a1_0x3956;if(!_0x33b716)return'';return _0x33b716['toLowerCase']()[_0x936938(0x107)](/\s+/g,'')['trim']();}function a1_0x3956(_0x16285a,_0x2208d5){const _0x470041=a1_0x38b0();return a1_0x3956=function(_0x555682,_0x352a14){_0x555682=_0x555682-0xd8;let _0x38b0cd=_0x470041[_0x555682];return _0x38b0cd;},a1_0x3956(_0x16285a,_0x2208d5);}async function handlePrediction(_0x86a78f,_0x2cc32b,_0x3354b1){const _0x53b2a4=a1_0x3956;if(!_0x2cc32b||_0x2cc32b==='Unknown')return;let _0x54d9a4='off',_0x3f9b2d=0.6;try{const _0x231931=await _0x86a78f[_0x53b2a4(0x13a)]('analysis.automation.mode');if(_0x231931&&_0x231931[_0x53b2a4(0x144)])_0x54d9a4=_0x231931[_0x53b2a4(0x144)];const _0x2fb0cf=await _0x86a78f[_0x53b2a4(0x13a)](_0x53b2a4(0x146));if(_0x2fb0cf&&_0x2fb0cf['val'])_0x3f9b2d=_0x2fb0cf[_0x53b2a4(0x144)];}catch(_0x4ea143){}if(_0x54d9a4===_0x53b2a4(0xf9)||_0x3354b1<_0x3f9b2d)return;const _0x2a44a5=Date[_0x53b2a4(0x149)]();if(lastActions[_0x2cc32b]&&_0x2a44a5-lastActions[_0x2cc32b]<COOLDOWN_MS)return;const _0x27553e=_0x86a78f['config'][_0x53b2a4(0xf5)]||[],_0x1555e9=normalize(_0x2cc32b),_0x3d2a31=_0x27553e['find'](_0x56b03a=>normalize(_0x56b03a[_0x53b2a4(0xe9)])===_0x1555e9&&(_0x56b03a[_0x53b2a4(0x137)]===_0x53b2a4(0x111)||_0x56b03a[_0x53b2a4(0x137)]==='dimmer'||_0x56b03a[_0x53b2a4(0x137)]===_0x53b2a4(0xde)));if(!_0x3d2a31){_0x86a78f[_0x53b2a4(0xe8)]['debug'](_0x53b2a4(0x134)+_0x2cc32b+'\x27.');return;}const _0x3021a4=await aiAgent[_0x53b2a4(0xfa)](_0x86a78f,_0x2cc32b,_0x3d2a31[_0x53b2a4(0xf6)],_0x3354b1);if(!_0x3021a4[_0x53b2a4(0x12c)])return;const _0x2add6d='PrÃ¤diktion:\x20'+_0x2cc32b+'\x20->\x20Schalte\x20'+_0x3d2a31[_0x53b2a4(0xf6)]+'\x20('+_0x3021a4[_0x53b2a4(0x102)]+')';await _0x86a78f['setStateAsync']('analysis.automation.lastAction',{'val':'['+_0x54d9a4[_0x53b2a4(0xed)]()+']\x20'+_0x2add6d,'ack':!![]});if(_0x54d9a4==='active'){const _0x2ae08d=await _0x86a78f[_0x53b2a4(0x117)](_0x3d2a31['id']);(!_0x2ae08d||!_0x2ae08d[_0x53b2a4(0x144)]&&_0x2ae08d[_0x53b2a4(0x144)]!==!![])&&await _0x86a78f[_0x53b2a4(0x10f)](_0x3d2a31['id'],!![]),lastActions[_0x2cc32b]=_0x2a44a5;}}async function findRelatedId(_0x35e76c,_0x304549,_0x259c1e=a1_0x29b400(0xee)){const _0x58b6c5=a1_0x29b400;if(_0x259c1e===_0x58b6c5(0xee)&&_0x35e76c[_0x58b6c5(0xfd)][_0x58b6c5(0x15e)]){let _0x2167b3=_0x35e76c[_0x58b6c5(0xfd)][_0x58b6c5(0x15e)];if(typeof _0x2167b3===_0x58b6c5(0xea))try{_0x2167b3=JSON['parse'](_0x2167b3);}catch(_0x2e8a55){}if(_0x2167b3&&_0x2167b3[_0x304549])return _0x2167b3[_0x304549];}if(_0x259c1e===_0x58b6c5(0x15d)&&_0x35e76c[_0x58b6c5(0xfd)]['valveMapping']){let _0x300348=_0x35e76c['config'][_0x58b6c5(0x104)];if(typeof _0x300348===_0x58b6c5(0xea))try{_0x300348=JSON[_0x58b6c5(0x131)](_0x300348);}catch(_0x1ac644){}if(_0x300348&&_0x300348[_0x304549])return _0x300348[_0x304549];}let _0x125306=[];if(_0x259c1e===_0x58b6c5(0xee))_0x125306=[{'s':'.1.ACTUAL_TEMPERATURE','t':_0x58b6c5(0x130)},{'s':_0x58b6c5(0x11a),'t':_0x58b6c5(0x130)},{'s':_0x58b6c5(0x11a),'t':_0x58b6c5(0x124)},{'s':_0x58b6c5(0x139),'t':_0x58b6c5(0xf0)},{'s':_0x58b6c5(0x12d),'t':'occupied_heating_setpoint'},{'s':'local_temperature','t':_0x58b6c5(0x126)},{'s':'temperature','t':'target_temperature'},{'s':_0x58b6c5(0xe7),'t':_0x58b6c5(0x12f)},{'s':'Ist','t':_0x58b6c5(0xf7)},{'s':_0x58b6c5(0x13f),'t':_0x58b6c5(0xee)}];else _0x259c1e===_0x58b6c5(0x15d)&&(_0x125306=[{'s':_0x58b6c5(0x12e),'t':_0x58b6c5(0xdb)},{'s':_0x58b6c5(0x11a),'t':'.1.LEVEL'},{'s':_0x58b6c5(0x11a),'t':_0x58b6c5(0x159)},{'s':_0x58b6c5(0x12d),'t':_0x58b6c5(0x13d)},{'s':_0x58b6c5(0x13f),'t':_0x58b6c5(0x13b)},{'s':'temperature','t':'level'}]);for(const _0x208c77 of _0x125306){if(_0x304549['includes'](_0x208c77['s'])){const _0x51faa2=_0x304549['replace'](_0x208c77['s'],_0x208c77['t']),_0x2e80ac=await _0x35e76c[_0x58b6c5(0x116)](_0x51faa2);if(_0x2e80ac)return _0x51faa2;}}try{const _0x593134=_0x304549[_0x58b6c5(0x12b)]('.');if(_0x593134[_0x58b6c5(0xe4)]>0x2){const _0x30fc8b=_0x593134['slice'](0x0,-0x1)[_0x58b6c5(0xdd)]('.'),_0x159946=await _0x35e76c[_0x58b6c5(0x158)](_0x30fc8b+'.*'),_0x36a534=[],_0x377cc3=_0x304549[_0x58b6c5(0x12b)](/[._]+/)[_0x58b6c5(0x154)](_0x59f9ce=>![_0x58b6c5(0x110),'0',_0x58b6c5(0xd8),_0x58b6c5(0x140),_0x58b6c5(0xfb),'temperature',_0x58b6c5(0xe3),'sensor',_0x58b6c5(0xec),_0x58b6c5(0xda)][_0x58b6c5(0x13e)](_0x59f9ce[_0x58b6c5(0x106)]()));for(const [_0x1a8601,_0x234f87]of Object[_0x58b6c5(0x15c)](_0x159946)){if(_0x1a8601===_0x304549)continue;if(_0x234f87&&_0x234f87[_0x58b6c5(0x118)]){const _0x2866e2=_0x1a8601[_0x58b6c5(0x106)](),_0x275394=(_0x234f87['common'][_0x58b6c5(0xfc)]||'')['toLowerCase'](),_0x21c712=(_0x234f87[_0x58b6c5(0x118)][_0x58b6c5(0x109)]||'')['toLowerCase']();let _0x547eca=![];if(_0x259c1e===_0x58b6c5(0xee)&&_0x234f87[_0x58b6c5(0x118)]['write']===!![])_0x547eca=_0x2866e2[_0x58b6c5(0x13e)](_0x58b6c5(0xf2))||_0x2866e2['includes'](_0x58b6c5(0x14e))||_0x2866e2[_0x58b6c5(0x13e)](_0x58b6c5(0x11f))||_0x275394[_0x58b6c5(0x13e)](_0x58b6c5(0x11e))||_0x275394['includes'](_0x58b6c5(0x151));else _0x259c1e===_0x58b6c5(0x15d)&&(_0x547eca=_0x2866e2[_0x58b6c5(0x13e)](_0x58b6c5(0x114))||_0x2866e2[_0x58b6c5(0x13e)](_0x58b6c5(0x15d))||_0x2866e2[_0x58b6c5(0x13e)](_0x58b6c5(0x138))||_0x2866e2[_0x58b6c5(0x13e)](_0x58b6c5(0x150))||_0x275394[_0x58b6c5(0x13e)](_0x58b6c5(0x100))||_0x275394[_0x58b6c5(0x13e)]('value.valve')||_0x21c712[_0x58b6c5(0x13e)]('%'));if(_0x547eca){const _0x6d4494=_0x1a8601['split'](/[._]+/)['map'](_0x4a7890=>_0x4a7890[_0x58b6c5(0x106)]());let _0x40724b=0x0;_0x377cc3['forEach'](_0xafd4e7=>{const _0x35ac41=_0x58b6c5;if(_0x6d4494[_0x35ac41(0x13e)](_0xafd4e7[_0x35ac41(0x106)]()))_0x40724b++;}),_0x36a534[_0x58b6c5(0x147)]({'id':_0x1a8601,'score':_0x40724b});}}}if(_0x36a534[_0x58b6c5(0xe4)]>0x0){_0x36a534[_0x58b6c5(0xe5)]((_0x33a712,_0x1e63fc)=>_0x1e63fc[_0x58b6c5(0x115)]-_0x33a712['score']);if(_0x36a534[0x0]['score']>0x0)return _0x36a534[0x0]['id'];}}}catch(_0x87d2b1){}return null;}function a1_0x38b0(){const _0x166fa5=['Nicht\x20gefunden','(((.+)+)+)+$','filter','128RAtDhl','search','Calendar\x20Check\x20Error:\x20','getForeignObjectsAsync','.4.VALVE_STATE','event','Fehlt','entries','valve','thermostatMapping','hm-rpc','401524wiPtvd','state','.1.LEVEL','\x20min)','join','switch','ðŸ“…\x20SMART\x20SCHEDULE:\x20\x27Globaler\x20Start\x27\x20erkannt\x20(','values','PERFECT','setStateAsync','actual','length','sort','472PjSBYS','ACTUAL','log','location','string','.data.table','messwert','toUpperCase','setpoint','calendarInstance','SET_POINT_TEMPERATURE','minutes_safe','set','exports','useCalendar','devices','name','Soll','\x20min).','off','consultButler','wert','role','config','localeCompare','Â°C\x20(Coasting\x20mÃ¶glich:\x20','level.valve','rÃ¼ckkehr','reason',').\x20Heize\x20auf\x2021Â°C\x20(Vorlauf:\x20','valveMapping','_calName','toLowerCase','replace','eventStart','unit','ðŸ“…\x20SMART\x20SCHEDULE:\x20Raum-Trigger\x20\x27','Manuelles\x20Mapping','2190190AeuZJb','[MPC]\x20','\x20->\x2021Â°C','setForeignStateAsync','openknx','light','forEach','Auto-Erkennung','level','score','getForeignObjectAsync','getForeignStateAsync','common','normal','.1.TEMPERATURE','ankunft','find','message','level.temperature','target','warn','ðŸƒ\x20MPC\x20Autonomy:\x20Senke\x20','983781fAPzpX','getTime','.4.SET_TEMPERATURE','\x27\x20erkannt\x20(','current_heating_setpoint','4382851lFcQxf','urlaub\x20ende','room','6vhefsL','split','approved','local_temperature','.1.ACTUAL_TEMPERATURE','SET','.1.SET_POINT_TEMPERATURE','parse','6243RpLzTv','8686100AhNEaM','ðŸ”\x20Device-Search\x20failed\x20for\x20predicted\x20room\x20\x27','summary','constructor','type','stellwert','ACTUAL_TEMPERATURE','getStateAsync','valve_position','mpc_','pi_heating_demand','includes','temperature','ist','12DAOZWW','toString','[CAL]\x20','val','thermostat','analysis.automation.confidenceThreshold','push','info','now','38206uxrJwg','analysis.automation.lastAction','sensor','3RsvOdM','soll',')\x20auf\x20','position','thermostat.setpoint'];a1_0x38b0=function(){return _0x166fa5;};return a1_0x38b0();}async function scanThermostats(_0xafb9e9){const _0x58ba7d=a1_0x29b400,_0x144771=_0xafb9e9['config'][_0x58ba7d(0xf5)]||[],_0xc66c7=[],_0x5536cf=_0x144771[_0x58ba7d(0x154)](_0x1e8ffe=>_0x1e8ffe['id']&&_0x1e8ffe['id']['includes']('temperature')||_0x1e8ffe['type']&&[_0x58ba7d(0x13f),_0x58ba7d(0x145),_0x58ba7d(0x14c)]['includes'](_0x1e8ffe[_0x58ba7d(0x137)])||_0x1e8ffe['name']&&_0x1e8ffe[_0x58ba7d(0xf6)]['toLowerCase']()['includes']('temp'));for(const _0xc08f5a of _0x5536cf){const _0x5c1554=await findRelatedId(_0xafb9e9,_0xc08f5a['id'],_0x58ba7d(0xee)),_0x2b1f49=await findRelatedId(_0xafb9e9,_0xc08f5a['id'],_0x58ba7d(0x15d));let _0x2cd71e=_0x58ba7d(0x152),_0x205fc0=![],_0x29856f=_0xafb9e9[_0x58ba7d(0xfd)][_0x58ba7d(0x15e)]||{};if(typeof _0x29856f===_0x58ba7d(0xea))try{_0x29856f=JSON['parse'](_0x29856f);}catch(_0x31b42b){}let _0x23c75c=_0xafb9e9[_0x58ba7d(0xfd)][_0x58ba7d(0x104)]||{};if(typeof _0x23c75c==='string')try{_0x23c75c=JSON[_0x58ba7d(0x131)](_0x23c75c);}catch(_0x357394){}if(_0x29856f[_0xc08f5a['id']]&&_0x29856f[_0xc08f5a['id']]===_0x5c1554||_0x23c75c[_0xc08f5a['id']]&&_0x23c75c[_0xc08f5a['id']]===_0x2b1f49)_0x2cd71e=_0x58ba7d(0x10b),_0x205fc0=!![];else(_0x5c1554||_0x2b1f49)&&(_0x2cd71e=_0x58ba7d(0x113));_0xc66c7[_0x58ba7d(0x147)]({'room':_0xc08f5a[_0x58ba7d(0xe9)]||'Unbekannt','sensorId':_0xc08f5a['id'],'setpointId':_0x5c1554||'-','valveId':_0x2b1f49||'-','source':_0x2cd71e,'isManual':_0x205fc0,'status':_0x5c1554&&_0x2b1f49?_0x58ba7d(0xe1):_0x5c1554?'OK':_0x58ba7d(0x15b)});}return _0xc66c7['sort']((_0x32cf41,_0x22fbcc)=>_0x32cf41[_0x58ba7d(0x129)][_0x58ba7d(0xfe)](_0x22fbcc[_0x58ba7d(0x129)]));}async function checkCalendarTriggers(_0x379afa){const _0x4558a5=a1_0x29b400;if(!_0x379afa[_0x4558a5(0xfd)][_0x4558a5(0xf4)]||!_0x379afa[_0x4558a5(0xfd)]['calendarInstance'])return;let _0x1afdc9={};try{const _0x543104=await _0x379afa[_0x4558a5(0x13a)]('analysis.energy.warmupTimes');if(_0x543104&&_0x543104[_0x4558a5(0x144)])_0x1afdc9=JSON['parse'](_0x543104[_0x4558a5(0x144)]);}catch(_0x26f8eb){}try{const _0x5bdfc7=await _0x379afa['getForeignStateAsync'](_0x379afa[_0x4558a5(0xfd)][_0x4558a5(0xef)]+_0x4558a5(0xeb));if(!_0x5bdfc7||!_0x5bdfc7['val'])return;const _0x148827=JSON[_0x4558a5(0x131)](_0x5bdfc7[_0x4558a5(0x144)]),_0x460384=new Date(),_0x2df8bc=_0x379afa['config']['devices']||[],_0xbb7cec=_0x379afa['config']['calendarSelection']||[];for(const _0x336826 of _0x148827){if(_0x336826[_0x4558a5(0x105)]&&_0xbb7cec[_0x4558a5(0xe4)]>0x0&&!_0xbb7cec[_0x4558a5(0x13e)](_0x336826[_0x4558a5(0x105)]))continue;const _0x5f3bed=new Date(_0x336826[_0x4558a5(0x108)]),_0x5be55b=(_0x336826[_0x4558a5(0x15a)]||_0x336826[_0x4558a5(0x135)]||'')[_0x4558a5(0x106)]();if(_0x5be55b[_0x4558a5(0x13e)](_0x4558a5(0x128))||_0x5be55b[_0x4558a5(0x13e)](_0x4558a5(0x101))||_0x5be55b[_0x4558a5(0x13e)](_0x4558a5(0x11b))){let _0x59aeb8=0x0;Object[_0x4558a5(0xe0)](_0x1afdc9)[_0x4558a5(0x112)](_0x15c65e=>{if(_0x15c65e>_0x59aeb8)_0x59aeb8=_0x15c65e;});if(_0x59aeb8===0x0)_0x59aeb8=0x78;const _0x2ca98c=new Date(_0x5f3bed['getTime']()-_0x59aeb8*0xea60),_0x2e239d=_0x460384[_0x4558a5(0x123)]()-_0x2ca98c[_0x4558a5(0x123)]();_0x2e239d>=0x0&&_0x2e239d<0xf*0xea60&&(_0x379afa[_0x4558a5(0xe8)]['info'](_0x4558a5(0xdf)+_0x336826[_0x4558a5(0x15a)]+').\x20Heize\x20ganzes\x20Haus\x20auf\x20(Vorlauf:\x20'+_0x59aeb8+_0x4558a5(0xf8)),await _0x379afa[_0x4558a5(0xe2)]('system.mode',{'val':_0x4558a5(0x119),'ack':![]}));}for(const _0x3fa476 of _0x2df8bc){if(_0x3fa476[_0x4558a5(0xe9)]){const _0x392c3b=_0x3fa476[_0x4558a5(0xe9)]['toLowerCase']();if(_0x5be55b[_0x4558a5(0x13e)](_0x392c3b)){const _0x489cbd=_0x1afdc9[_0x3fa476[_0x4558a5(0xe9)]]||0x3c,_0x21b23=new Date(_0x5f3bed[_0x4558a5(0x123)]()-_0x489cbd*0xea60),_0x53f11d=_0x460384[_0x4558a5(0x123)]()-_0x21b23['getTime']();if(_0x53f11d>=0x0&&_0x53f11d<0xf*0xea60){const _0x173eda=await findRelatedId(_0x379afa,_0x3fa476['id'],_0x4558a5(0xee));_0x173eda&&(_0x379afa[_0x4558a5(0xe8)][_0x4558a5(0x148)](_0x4558a5(0x10a)+_0x3fa476[_0x4558a5(0xe9)]+_0x4558a5(0x125)+_0x336826[_0x4558a5(0x15a)]+_0x4558a5(0x103)+_0x489cbd+_0x4558a5(0xf8)),await _0x379afa['setForeignStateAsync'](_0x173eda,0x15),await _0x379afa[_0x4558a5(0xe2)](_0x4558a5(0x14b),{'val':_0x4558a5(0x143)+_0x3fa476[_0x4558a5(0xe9)]+_0x4558a5(0x10e),'ack':!![]}));}}}}}}catch(_0x5dc22b){_0x379afa[_0x4558a5(0xe8)][_0x4558a5(0x120)](_0x4558a5(0x157)+_0x5dc22b[_0x4558a5(0x11d)]);}}async function applyEnergySavings(_0x5e106e,_0x5f8a44){const _0x46c501=a1_0x29b400,_0x39fa8e=_0x5e106e[_0x46c501(0xfd)][_0x46c501(0xf5)]||[];for(const _0x2e00cf of _0x5f8a44){const _0x26d42a=_0x2e00cf[_0x46c501(0x129)],_0x1d7f4f=_0x2e00cf[_0x46c501(0xf1)],_0x418600=Date['now']();if(lastActions[_0x46c501(0x13c)+_0x26d42a]&&_0x418600-lastActions['mpc_'+_0x26d42a]<0x1e*0x3c*0x3e8)continue;const _0x3f449d=_0x39fa8e[_0x46c501(0x11c)](_0x412c66=>normalize(_0x412c66[_0x46c501(0xe9)])===normalize(_0x26d42a));if(!_0x3f449d)continue;const _0x1dd1c9=await findRelatedId(_0x5e106e,_0x3f449d['id'],_0x46c501(0xee));if(_0x1dd1c9){const _0x14d17b=await _0x5e106e[_0x46c501(0x117)](_0x1dd1c9);if(_0x14d17b&&typeof _0x14d17b[_0x46c501(0x144)]==='number'){const _0x5c509e=_0x14d17b['val'];if(_0x1d7f4f>0x1e&&_0x5c509e>0x11){const _0xcdb37a=_0x5c509e-0x1;_0x5e106e['log'][_0x46c501(0x148)](_0x46c501(0x121)+_0x26d42a+'\x20('+_0x1dd1c9+_0x46c501(0x14f)+_0xcdb37a+_0x46c501(0xff)+_0x1d7f4f+_0x46c501(0xdc)),await _0x5e106e[_0x46c501(0x10f)](_0x1dd1c9,_0xcdb37a),lastActions[_0x46c501(0x13c)+_0x26d42a]=_0x418600,await _0x5e106e[_0x46c501(0xe2)]('analysis.automation.lastAction',{'val':_0x46c501(0x10d)+_0x26d42a+':\x20-1Â°C\x20(Sparpotenzial\x20genutzt)','ack':!![]});}}}}}module[a1_0x29b400(0xf3)]={'handlePrediction':handlePrediction,'applyEnergySavings':applyEnergySavings,'scanThermostats':scanThermostats,'checkCalendarTriggers':checkCalendarTriggers};