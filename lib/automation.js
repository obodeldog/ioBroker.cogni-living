const a1_0x571815=a1_0x64bf;(function(_0x248547,_0x20975c){const _0x103961=a1_0x64bf,_0x540d67=_0x248547();while(!![]){try{const _0x3f183e=parseInt(_0x103961(0x1b5))/0x1+-parseInt(_0x103961(0x1e9))/0x2*(-parseInt(_0x103961(0x200))/0x3)+-parseInt(_0x103961(0x20e))/0x4*(parseInt(_0x103961(0x205))/0x5)+-parseInt(_0x103961(0x1f9))/0x6*(-parseInt(_0x103961(0x1c6))/0x7)+-parseInt(_0x103961(0x1e1))/0x8*(parseInt(_0x103961(0x1fc))/0x9)+-parseInt(_0x103961(0x1be))/0xa*(parseInt(_0x103961(0x1b6))/0xb)+parseInt(_0x103961(0x1da))/0xc*(parseInt(_0x103961(0x1fd))/0xd);if(_0x3f183e===_0x20975c)break;else _0x540d67['push'](_0x540d67['shift']());}catch(_0x48b989){_0x540d67['push'](_0x540d67['shift']());}}}(a1_0x3fbc,0x872db));const a1_0xfecc74=(function(){let _0x2adb4e=!![];return function(_0x1d09fb,_0x6014af){const _0x3bbf8a=_0x2adb4e?function(){const _0x4c670a=a1_0x64bf;if(_0x6014af){const _0x19b45c=_0x6014af[_0x4c670a(0x1ec)](_0x1d09fb,arguments);return _0x6014af=null,_0x19b45c;}}:function(){};return _0x2adb4e=![],_0x3bbf8a;};}()),a1_0x16c9cb=a1_0xfecc74(this,function(){const _0x33a45f=a1_0x64bf;return a1_0x16c9cb[_0x33a45f(0x1ee)]()[_0x33a45f(0x1ca)](_0x33a45f(0x201))[_0x33a45f(0x1ee)]()[_0x33a45f(0x1cd)](a1_0x16c9cb)[_0x33a45f(0x1ca)](_0x33a45f(0x201));});a1_0x16c9cb();'use strict';const aiAgent=require(a1_0x571815(0x1e0)),COOLDOWN_MS=0x3c*0x3e8,lastActions={};function normalize(_0x5e0a81){const _0x3293c4=a1_0x571815;if(!_0x5e0a81)return'';return _0x5e0a81[_0x3293c4(0x1f4)]()['replace'](/\s+/g,'')[_0x3293c4(0x1e4)]();}async function handlePrediction(_0x1ecc86,_0x80100a,_0x4e5448){const _0x135b55=a1_0x571815;if(!_0x80100a||_0x80100a===_0x135b55(0x1b9))return;let _0x9b70b3=_0x135b55(0x1f6),_0x497973=0.6;try{const _0x445079=await _0x1ecc86[_0x135b55(0x1e7)](_0x135b55(0x1ed));if(_0x445079&&_0x445079[_0x135b55(0x1fb)])_0x9b70b3=_0x445079[_0x135b55(0x1fb)];const _0x240b9d=await _0x1ecc86[_0x135b55(0x1e7)](_0x135b55(0x1e5));if(_0x240b9d&&_0x240b9d['val'])_0x497973=_0x240b9d[_0x135b55(0x1fb)];}catch(_0x2df19f){}if(_0x9b70b3===_0x135b55(0x1f6)||_0x4e5448<_0x497973)return;const _0x5e15ec=Date[_0x135b55(0x1d4)]();if(lastActions[_0x80100a]&&_0x5e15ec-lastActions[_0x80100a]<COOLDOWN_MS)return;const _0x13cd57=_0x1ecc86['config'][_0x135b55(0x1f8)]||[],_0x335db5=normalize(_0x80100a),_0x50e5a8=_0x13cd57[_0x135b55(0x1b3)](_0x3f718e=>normalize(_0x3f718e[_0x135b55(0x20f)])===_0x335db5&&(_0x3f718e['type']===_0x135b55(0x1c8)||_0x3f718e[_0x135b55(0x206)]===_0x135b55(0x1dd)||_0x3f718e[_0x135b55(0x206)]==='switch'));if(!_0x50e5a8){_0x1ecc86[_0x135b55(0x1f5)]['debug']('ðŸ”\x20Device-Search\x20failed\x20for\x20predicted\x20room\x20\x27'+_0x80100a+'\x27.');return;}const _0x401db0=await aiAgent[_0x135b55(0x1bc)](_0x1ecc86,_0x80100a,_0x50e5a8[_0x135b55(0x1cf)],_0x4e5448);if(!_0x401db0[_0x135b55(0x1c4)])return;const _0x3fc98c=_0x135b55(0x1af)+_0x80100a+_0x135b55(0x1fe)+_0x50e5a8['name']+'\x20('+_0x401db0[_0x135b55(0x209)]+')';await _0x1ecc86[_0x135b55(0x1ad)](_0x135b55(0x20b),{'val':'['+_0x9b70b3[_0x135b55(0x202)]()+']\x20'+_0x3fc98c,'ack':!![]});if(_0x9b70b3===_0x135b55(0x1c7)){const _0x3a0860=await _0x1ecc86[_0x135b55(0x1e2)](_0x50e5a8['id']);(!_0x3a0860||!_0x3a0860[_0x135b55(0x1fb)]&&_0x3a0860[_0x135b55(0x1fb)]!==!![])&&await _0x1ecc86[_0x135b55(0x1d9)](_0x50e5a8['id'],!![]),lastActions[_0x80100a]=_0x5e15ec;}}async function findSetpointId(_0x3a4144,_0x1888bd){const _0x58c03a=a1_0x571815;if(_0x3a4144[_0x58c03a(0x1d3)][_0x58c03a(0x1b7)]){let _0x370727=_0x3a4144[_0x58c03a(0x1d3)][_0x58c03a(0x1b7)];if(typeof _0x370727==='string')try{_0x370727=JSON['parse'](_0x370727);}catch(_0x5928fb){_0x370727={};}if(_0x370727&&_0x370727[_0x1888bd])return _0x370727[_0x1888bd];}const _0x25da90=[{'s':_0x58c03a(0x1f0),'t':_0x58c03a(0x1de)},{'s':'.1.TEMPERATURE','t':_0x58c03a(0x1ce)},{'s':_0x58c03a(0x204),'t':'SET_POINT_TEMPERATURE'},{'s':_0x58c03a(0x1bd),'t':'occupied_heating_setpoint'},{'s':_0x58c03a(0x1bd),'t':_0x58c03a(0x20d)},{'s':_0x58c03a(0x1c1),'t':_0x58c03a(0x1d7)},{'s':_0x58c03a(0x1cb),'t':'SET'},{'s':_0x58c03a(0x1b1),'t':_0x58c03a(0x1eb)},{'s':_0x58c03a(0x1c1),'t':_0x58c03a(0x1bf)}];for(const _0x42e744 of _0x25da90){if(_0x1888bd[_0x58c03a(0x1f1)](_0x42e744['s'])){const _0x4d43db=_0x1888bd['replace'](_0x42e744['s'],_0x42e744['t']),_0x410eab=await _0x3a4144[_0x58c03a(0x210)](_0x4d43db);if(_0x410eab)return _0x4d43db;}}try{const _0x497bec=_0x1888bd[_0x58c03a(0x212)]('.');if(_0x497bec['length']>0x2){const _0x29c67a=_0x497bec[_0x58c03a(0x1db)](0x0,-0x1)[_0x58c03a(0x1ae)]('.'),_0x3ad379=await _0x3a4144[_0x58c03a(0x1bb)](_0x29c67a+'.*'),_0x346ed4=[],_0xec9038=_0x1888bd[_0x58c03a(0x212)](/[._]+/)[_0x58c03a(0x1fa)](_0x2b1652=>!['openknx','0',_0x58c03a(0x1c9),_0x58c03a(0x1ef),_0x58c03a(0x207),'temperature','actual',_0x58c03a(0x1b0),_0x58c03a(0x1c2),_0x58c03a(0x1c0)][_0x58c03a(0x1f1)](_0x2b1652[_0x58c03a(0x1f4)]()));for(const [_0x5e7745,_0x4200e5]of Object['entries'](_0x3ad379)){if(_0x5e7745===_0x1888bd)continue;if(_0x4200e5&&_0x4200e5[_0x58c03a(0x1dc)]&&_0x4200e5['common']['write']===!![]){const _0x429b86=_0x5e7745[_0x58c03a(0x1f4)](),_0x5f0e62=(_0x4200e5[_0x58c03a(0x1dc)][_0x58c03a(0x1ba)]||'')['toLowerCase'](),_0x92cec9=_0x429b86[_0x58c03a(0x1f1)](_0x58c03a(0x20a))||_0x429b86[_0x58c03a(0x1f1)](_0x58c03a(0x1df))||_0x429b86[_0x58c03a(0x1f1)](_0x58c03a(0x1f2))||_0x5f0e62['includes'](_0x58c03a(0x1f7))||_0x5f0e62[_0x58c03a(0x1f1)](_0x58c03a(0x20c));if(_0x92cec9){const _0x2f0b87=_0x5e7745['split'](/[._]+/)['map'](_0x2e10dd=>_0x2e10dd['toLowerCase']());let _0x7b8b9f=0x0;_0xec9038[_0x58c03a(0x1b2)](_0x5ec00d=>{const _0x3d7664=_0x58c03a;if(_0x2f0b87[_0x3d7664(0x1f1)](_0x5ec00d[_0x3d7664(0x1f4)]()))_0x7b8b9f++;}),_0x346ed4[_0x58c03a(0x203)]({'id':_0x5e7745,'score':_0x7b8b9f});}}}if(_0x346ed4[_0x58c03a(0x1d6)]>0x0){_0x346ed4[_0x58c03a(0x1f3)]((_0x43269c,_0x1a195c)=>_0x1a195c[_0x58c03a(0x1ff)]-_0x43269c[_0x58c03a(0x1ff)]);const _0x3f2e52=_0x346ed4[0x0];if(_0x3f2e52[_0x58c03a(0x1ff)]>0x0)return _0x3f2e52['id'];}}}catch(_0xe9dd2b){_0x3a4144[_0x58c03a(0x1f5)][_0x58c03a(0x208)]('Error\x20in\x20sibling\x20search:\x20'+_0xe9dd2b[_0x58c03a(0x1d8)]);}return null;}async function scanThermostats(_0x2ba1f9){const _0x2314c3=a1_0x571815,_0x2f84e7=_0x2ba1f9[_0x2314c3(0x1d3)][_0x2314c3(0x1f8)]||[],_0x2dc39d=[],_0xee57cc=_0x2f84e7[_0x2314c3(0x1fa)](_0x1d3681=>_0x1d3681['id']&&_0x1d3681['id'][_0x2314c3(0x1f1)](_0x2314c3(0x1c1))||_0x1d3681['type']&&[_0x2314c3(0x1c1),_0x2314c3(0x1e8),_0x2314c3(0x1b0)][_0x2314c3(0x1f1)](_0x1d3681[_0x2314c3(0x206)])||_0x1d3681['name']&&_0x1d3681[_0x2314c3(0x1cf)]['toLowerCase']()[_0x2314c3(0x1f1)](_0x2314c3(0x1e6)));for(const _0x3cb3c0 of _0xee57cc){const _0x41bf85=await findSetpointId(_0x2ba1f9,_0x3cb3c0['id']);let _0x4ea6fc=_0x2314c3(0x1d1),_0x475be3=![],_0x823d30=_0x2ba1f9['config'][_0x2314c3(0x1b7)]||{};if(typeof _0x823d30==='string')try{_0x823d30=JSON[_0x2314c3(0x1c5)](_0x823d30);}catch(_0x31e09c){}if(_0x823d30[_0x3cb3c0['id']]&&_0x823d30[_0x3cb3c0['id']]===_0x41bf85)_0x4ea6fc='Manuelles\x20Mapping',_0x475be3=!![];else _0x41bf85&&(_0x4ea6fc=_0x2314c3(0x1b4));_0x2dc39d['push']({'room':_0x3cb3c0[_0x2314c3(0x20f)]||_0x2314c3(0x1cc),'sensorId':_0x3cb3c0['id'],'setpointId':_0x41bf85||'-','source':_0x4ea6fc,'isManual':_0x475be3,'status':_0x41bf85?'OK':_0x2314c3(0x1c3)});}return _0x2dc39d['sort']((_0x1db1e4,_0x230f76)=>_0x1db1e4[_0x2314c3(0x211)][_0x2314c3(0x1ea)](_0x230f76[_0x2314c3(0x211)]));}async function applyEnergySavings(_0x178889,_0x4d990c){const _0x3e6789=a1_0x571815,_0x22dfa2=_0x178889['config'][_0x3e6789(0x1f8)]||[];for(const _0x3d6936 of _0x4d990c){const _0x10e858=_0x3d6936['room'],_0x49cd6a=_0x3d6936['minutes_safe'],_0x289e27=Date['now']();if(lastActions[_0x3e6789(0x1e3)+_0x10e858]&&_0x289e27-lastActions[_0x3e6789(0x1e3)+_0x10e858]<0x1e*0x3c*0x3e8)continue;const _0x332238=_0x22dfa2[_0x3e6789(0x1b3)](_0x58a4e5=>normalize(_0x58a4e5['location'])===normalize(_0x10e858));if(!_0x332238)continue;const _0x4fafad=await findSetpointId(_0x178889,_0x332238['id']);if(_0x4fafad){const _0x47a2a7=await _0x178889['getForeignStateAsync'](_0x4fafad);if(_0x47a2a7&&typeof _0x47a2a7['val']==='number'){const _0x142bdf=_0x47a2a7[_0x3e6789(0x1fb)];if(_0x49cd6a>0x1e&&_0x142bdf>0x11){const _0x37fd02=_0x142bdf-0x1;_0x178889[_0x3e6789(0x1f5)][_0x3e6789(0x1d5)]('ðŸƒ\x20MPC\x20Autonomy:\x20Senke\x20'+_0x10e858+'\x20('+_0x4fafad+_0x3e6789(0x1d2)+_0x37fd02+_0x3e6789(0x1b8)+_0x49cd6a+'\x20min)'),await _0x178889[_0x3e6789(0x1d9)](_0x4fafad,_0x37fd02),lastActions['mpc_'+_0x10e858]=_0x289e27,await _0x178889[_0x3e6789(0x1ad)](_0x3e6789(0x20b),{'val':'[MPC]\x20'+_0x10e858+':\x20-1Â°C\x20(Sparpotenzial\x20genutzt)','ack':!![]});}}}}}module[a1_0x571815(0x1d0)]={'handlePrediction':handlePrediction,'applyEnergySavings':applyEnergySavings,'scanThermostats':scanThermostats};function a1_0x64bf(_0x2d69a4,_0x2a9e0){const _0x18ad54=a1_0x3fbc();return a1_0x64bf=function(_0x16c9cb,_0xfecc74){_0x16c9cb=_0x16c9cb-0x1ad;let _0x3fbc44=_0x18ad54[_0x16c9cb];return _0x3fbc44;},a1_0x64bf(_0x2d69a4,_0x2a9e0);}function a1_0x3fbc(){const _0x25f8b1=['local_temperature','80trUeAA','setpoint','state','temperature','messwert','Fehlt','approved','parse','2177QeUMhb','active','light','hm-rpc','search','ACTUAL','Unbekannt','constructor','.4.SET_TEMPERATURE','name','exports','Nicht\x20gefunden',')\x20auf\x20','config','now','info','length','target_temperature','message','setForeignStateAsync','1752snbUZP','slice','common','dimmer','.1.SET_POINT_TEMPERATURE','soll','./ai_agent','4640nhYloZ','getForeignStateAsync','mpc_','trim','analysis.automation.confidenceThreshold','temp','getStateAsync','thermostat','154076uFUnUu','localeCompare','Soll','apply','analysis.automation.mode','toString','ist','.1.ACTUAL_TEMPERATURE','includes','target','sort','toLowerCase','log','off','level.temperature','devices','11442LhcdZj','filter','val','12411inhRcx','29328IbPCNr','\x20->\x20Schalte\x20','score','24UZFpIG','(((.+)+)+)+$','toUpperCase','push','ACTUAL_TEMPERATURE','4538760BdwBOl','type','wert','warn','reason','set','analysis.automation.lastAction','thermostat.setpoint','current_heating_setpoint','4eXsyuI','location','getForeignObjectAsync','room','split','setStateAsync','join','PrÃ¤diktion:\x20','sensor','Ist','forEach','find','Auto-Erkennung','904098DHYJcA','249689QhDLAM','thermostatMapping','Â°C\x20(Coasting\x20mÃ¶glich:\x20','Unknown','role','getForeignObjectsAsync','consultButler'];a1_0x3fbc=function(){return _0x25f8b1;};return a1_0x3fbc();}