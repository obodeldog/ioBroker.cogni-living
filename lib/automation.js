const a1_0x3e4970=a1_0x216e;function a1_0x27d8(){const _0x2e467f=['calendarSelection','exports','setStateAsync','replace','valve','val','role','useCalendar','temperature','parse','triggerTime','(((.+)+)+)+$',']:\x20Raum-Trigger\x20\x27','active','calendarInstance','\x20->\x20Schalte\x20','Soll','119ZGTdpe','2467269fzeIIR','Â°C\x20(nicht\x20','values','[CAL]\x20','temp','off','analysis.automation.confidenceThreshold','\x20auf\x20','\x20wieder\x20auf\x20','mpc_','event','SET','.1.ACTUAL_TEMPERATURE','add','summary','unit','local_temperature','light','\x20->\x20','rÃ¼ckkehr','Â°C\x20(via\x20','getForeignStateAsync','minutes_safe','remove','PrÃ¤diktion:\x20','Nicht\x20gefunden','push','Â°C).\x20Entferne\x20Status.','.4.SET_TEMPERATURE','_date','search','devices','includes','log','analysis.energy.mpcActiveInterventions','\x27\x20aktiv.\x20Heize\x20auf\x20','26402753OAHtkY','getStateAsync','string','entries','system.mode','setpoint','switch','info','analysis.energy.warmupSources','join','30812ytyDhZ','level.temperature','24Kntfbf','forEach','.1.TEMPERATURE','common','Â°C\x20(Vorlauf:\x20','split','Auto-Erkennung','now','ankunft','constructor','type','from','ðŸ“…\x20SMART\x20SCHEDULE\x20(Phase):\x20\x27Globaler\x20Start\x27\x20erkannt.\x20Heize\x20Haus\x20auf\x20(Vorlauf:\x20','slice','sensor','filter','wert','config','348821WJaGnk','analysis.automation.lastAction','Unknown','Â°C!\x20(Puffer:\x20','default','\x20min).','.1.SET_POINT_TEMPERATURE','toLowerCase','getTime','thermostatMapping','270544AmNQtb','approved','valveMapping','analysis.energy.schedulePreview','sort','thermostat','normal','stringify','apply','[MPC]\x20','.data.table','dimmer','message','eventStart','openknx','pi_heating_demand','date','SET_POINT_TEMPERATURE','getForeignObjectsAsync','length','actual','15yjhCsE','ðŸ“…\x20SMART\x20SCHEDULE\x20[','state','target','analysis.automation.actionLog','[MPC\x20WARNING]\x20Kein\x20Setpoint\x20fÃ¼r\x20','toString','analysis.energy.warmupTimes','name','625EZsFTu','ðŸ§¹\x20[MPC\x20CLEANUP]\x20','location','write','find','./ai_agent','276HSBEGC','Manuelles\x20Mapping','ðŸƒ\x20[MPC\x20ACTION]\x20Senke\x20','target_temperature','valve_position','score','290rhVMEd','21936QsLBmP','localeCompare','warn','splice','Unbekannt','map','PERFECT','room','ist','.1.LEVEL','abs','trim','33764uozfjU','unshift','analysis.energy.warmupTargets','_calName','setForeignStateAsync','level.valve','value.valve','currentSystemMode','messwert','\x20min)','thermostat.setpoint','.4.VALVE_STATE','position','occupied_heating_setpoint'];a1_0x27d8=function(){return _0x2e467f;};return a1_0x27d8();}(function(_0x3f23ea,_0x483b9e){const _0x1220d1=a1_0x216e,_0x473d2a=_0x3f23ea();while(!![]){try{const _0x1591eb=-parseInt(_0x1220d1(0x110))/0x1*(parseInt(_0x1220d1(0xdd))/0x2)+-parseInt(_0x1220d1(0x11f))/0x3*(parseInt(_0x1220d1(0x132))/0x4)+parseInt(_0x1220d1(0x119))/0x5*(-parseInt(_0x1220d1(0x126))/0x6)+-parseInt(_0x1220d1(0x151))/0x7*(parseInt(_0x1220d1(0xfb))/0x8)+-parseInt(_0x1220d1(0x152))/0x9+-parseInt(_0x1220d1(0x125))/0xa*(parseInt(_0x1220d1(0xf1))/0xb)+parseInt(_0x1220d1(0xdf))/0xc*(parseInt(_0x1220d1(0xd3))/0xd);if(_0x1591eb===_0x483b9e)break;else _0x473d2a['push'](_0x473d2a['shift']());}catch(_0x58c705){_0x473d2a['push'](_0x473d2a['shift']());}}}(a1_0x27d8,0xca4da));const a1_0x253c28=(function(){let _0x1f2e7b=!![];return function(_0x4b5019,_0x5419a9){const _0x14a8c0=_0x1f2e7b?function(){const _0x404e01=a1_0x216e;if(_0x5419a9){const _0x5dd12e=_0x5419a9[_0x404e01(0x103)](_0x4b5019,arguments);return _0x5419a9=null,_0x5dd12e;}}:function(){};return _0x1f2e7b=![],_0x14a8c0;};}()),a1_0x237d5c=a1_0x253c28(this,function(){const _0x1fb5a7=a1_0x216e;return a1_0x237d5c['toString']()['search'](_0x1fb5a7(0x14b))[_0x1fb5a7(0x116)]()[_0x1fb5a7(0xe8)](a1_0x237d5c)[_0x1fb5a7(0xcd)]('(((.+)+)+)+$');});a1_0x237d5c();'use strict';const aiAgent=require(a1_0x3e4970(0x11e)),COOLDOWN_MS=0x3c*0x3e8,CAL_COOLDOWN_MS=0x5a*0x3c*0x3e8,ECO_TEMP=0x11,lastActions={};function normalize(_0x20fdba){const _0xf76550=a1_0x3e4970;if(!_0x20fdba)return'';return _0x20fdba['toLowerCase']()[_0xf76550(0x143)](/\s+/g,'')[_0xf76550(0x131)]();}async function logAutomationAction(_0x34e628,_0xed205){const _0x30e7c4=a1_0x3e4970;await _0x34e628['setStateAsync'](_0x30e7c4(0xf2),{'val':_0xed205,'ack':!![]});try{const _0x5690ce=_0x30e7c4(0x114),_0x55f463=await _0x34e628[_0x30e7c4(0xd4)](_0x5690ce);let _0x60ffec=[];if(_0x55f463&&_0x55f463[_0x30e7c4(0x145)])try{_0x60ffec=JSON[_0x30e7c4(0x149)](_0x55f463[_0x30e7c4(0x145)]);}catch(_0x449601){}_0x60ffec[_0x30e7c4(0x133)]({'ts':Date['now'](),'msg':_0xed205});if(_0x60ffec['length']>0x32)_0x60ffec=_0x60ffec[_0x30e7c4(0xec)](0x0,0x32);await _0x34e628[_0x30e7c4(0x142)](_0x5690ce,{'val':JSON[_0x30e7c4(0x102)](_0x60ffec),'ack':!![]});}catch(_0x5d91b0){}}async function handlePrediction(_0x3f2c02,_0x2c142b,_0x4e2bd2){const _0x3c055d=a1_0x3e4970;if(!_0x2c142b||_0x2c142b===_0x3c055d(0xf3))return;let _0x263350='off',_0x2a4def=0.6;try{const _0x5230af=await _0x3f2c02['getStateAsync']('analysis.automation.mode');if(_0x5230af&&_0x5230af[_0x3c055d(0x145)])_0x263350=_0x5230af[_0x3c055d(0x145)];const _0x335a32=await _0x3f2c02[_0x3c055d(0xd4)](_0x3c055d(0x158));if(_0x335a32&&_0x335a32['val'])_0x2a4def=_0x335a32[_0x3c055d(0x145)];}catch(_0x1d11ab){}if(_0x263350===_0x3c055d(0x157)||_0x4e2bd2<_0x2a4def)return;const _0x344067=Date['now']();if(lastActions[_0x2c142b]&&_0x344067-lastActions[_0x2c142b]<COOLDOWN_MS)return;const _0x2bff13=_0x3f2c02[_0x3c055d(0xf0)][_0x3c055d(0xce)]||[],_0x323577=normalize(_0x2c142b),_0x3530f1=_0x2bff13[_0x3c055d(0x11d)](_0x5edd7e=>normalize(_0x5edd7e[_0x3c055d(0x11b)])===_0x323577&&(_0x5edd7e[_0x3c055d(0xe9)]===_0x3c055d(0x163)||_0x5edd7e[_0x3c055d(0xe9)]===_0x3c055d(0x106)||_0x5edd7e[_0x3c055d(0xe9)]===_0x3c055d(0xd9)));if(!_0x3530f1)return;const _0x5a5848=await aiAgent['consultButler'](_0x3f2c02,_0x2c142b,_0x3530f1[_0x3c055d(0x118)],_0x4e2bd2);if(!_0x5a5848[_0x3c055d(0xfc)])return;const _0x219606=_0x3c055d(0x16a)+_0x2c142b+_0x3c055d(0x14f)+_0x3530f1[_0x3c055d(0x118)]+'\x20('+_0x5a5848['reason']+')';await logAutomationAction(_0x3f2c02,'['+_0x263350['toUpperCase']()+']\x20'+_0x219606);if(_0x263350===_0x3c055d(0x14d)){const _0x544356=await _0x3f2c02[_0x3c055d(0x167)](_0x3530f1['id']);(!_0x544356||!_0x544356['val']&&_0x544356[_0x3c055d(0x145)]!==!![])&&await _0x3f2c02[_0x3c055d(0x136)](_0x3530f1['id'],!![]),lastActions[_0x2c142b]=_0x344067;}}async function findRelatedId(_0x356274,_0x4dcd1f,_0x4767a0=a1_0x3e4970(0xd8)){const _0x1e240e=a1_0x3e4970;if(_0x4767a0===_0x1e240e(0xd8)&&_0x356274[_0x1e240e(0xf0)]['thermostatMapping']){let _0x37e8d0=_0x356274[_0x1e240e(0xf0)][_0x1e240e(0xfa)];if(typeof _0x37e8d0===_0x1e240e(0xd5))try{_0x37e8d0=JSON['parse'](_0x37e8d0);}catch(_0x5b03bb){}if(_0x37e8d0&&_0x37e8d0[_0x4dcd1f])return _0x37e8d0[_0x4dcd1f];}if(_0x4767a0==='valve'&&_0x356274[_0x1e240e(0xf0)][_0x1e240e(0xfd)]){let _0x47ad8e=_0x356274['config'][_0x1e240e(0xfd)];if(typeof _0x47ad8e===_0x1e240e(0xd5))try{_0x47ad8e=JSON['parse'](_0x47ad8e);}catch(_0x1f0c73){}if(_0x47ad8e&&_0x47ad8e[_0x4dcd1f])return _0x47ad8e[_0x4dcd1f];}let _0xd224aa=[];if(_0x4767a0===_0x1e240e(0xd8))_0xd224aa=[{'s':_0x1e240e(0x15e),'t':_0x1e240e(0xf7)},{'s':_0x1e240e(0xe1),'t':_0x1e240e(0xf7)},{'s':'.1.TEMPERATURE','t':_0x1e240e(0x16e)},{'s':'ACTUAL_TEMPERATURE','t':_0x1e240e(0x10c)},{'s':_0x1e240e(0x162),'t':_0x1e240e(0x13f)},{'s':'local_temperature','t':'current_heating_setpoint'},{'s':'temperature','t':_0x1e240e(0x122)},{'s':'ACTUAL','t':_0x1e240e(0x15d)},{'s':'Ist','t':_0x1e240e(0x150)},{'s':_0x1e240e(0x148),'t':_0x1e240e(0xd8)}];else _0x4767a0===_0x1e240e(0x144)&&(_0xd224aa=[{'s':_0x1e240e(0x15e),'t':_0x1e240e(0x12f)},{'s':_0x1e240e(0xe1),'t':_0x1e240e(0x12f)},{'s':_0x1e240e(0xe1),'t':_0x1e240e(0x13d)},{'s':'local_temperature','t':_0x1e240e(0x10a)},{'s':_0x1e240e(0x148),'t':_0x1e240e(0x123)},{'s':_0x1e240e(0x148),'t':'level'}]);for(const _0xdc3040 of _0xd224aa){if(_0x4dcd1f[_0x1e240e(0xcf)](_0xdc3040['s'])){const _0x1cb74d=_0x4dcd1f[_0x1e240e(0x143)](_0xdc3040['s'],_0xdc3040['t']),_0x8eebb2=await _0x356274['getForeignObjectAsync'](_0x1cb74d);if(_0x8eebb2)return _0x1cb74d;}}try{const _0x597747=_0x4dcd1f[_0x1e240e(0xe4)]('.');if(_0x597747[_0x1e240e(0x10e)]>0x2){const _0x9637e=_0x597747[_0x1e240e(0xec)](0x0,-0x1)[_0x1e240e(0xdc)]('.'),_0x1dd1cc=await _0x356274[_0x1e240e(0x10d)](_0x9637e+'.*'),_0x2b545f=[],_0x18a38d=_0x4dcd1f['split'](/[._]+/)[_0x1e240e(0xee)](_0x5a4072=>![_0x1e240e(0x109),'0','hm-rpc',_0x1e240e(0x12e),_0x1e240e(0xef),_0x1e240e(0x148),_0x1e240e(0x10f),'sensor',_0x1e240e(0x13a),_0x1e240e(0x112)][_0x1e240e(0xcf)](_0x5a4072[_0x1e240e(0xf8)]()));for(const [_0x4c232b,_0x467fb6]of Object[_0x1e240e(0xd6)](_0x1dd1cc)){if(_0x4c232b===_0x4dcd1f)continue;if(_0x467fb6&&_0x467fb6['common']){const _0x5b3720=_0x4c232b[_0x1e240e(0xf8)](),_0x91b73f=(_0x467fb6[_0x1e240e(0xe2)][_0x1e240e(0x146)]||'')[_0x1e240e(0xf8)](),_0x1ba1a0=(_0x467fb6['common'][_0x1e240e(0x161)]||'')[_0x1e240e(0xf8)]();let _0x5153f2=![];if(_0x4767a0===_0x1e240e(0xd8)&&_0x467fb6[_0x1e240e(0xe2)][_0x1e240e(0x11c)]===!![])_0x5153f2=_0x5b3720[_0x1e240e(0xcf)]('set')||_0x5b3720['includes']('soll')||_0x5b3720['includes']('target')||_0x91b73f['includes'](_0x1e240e(0xde))||_0x91b73f[_0x1e240e(0xcf)](_0x1e240e(0x13c));else _0x4767a0===_0x1e240e(0x144)&&(_0x5153f2=_0x5b3720[_0x1e240e(0xcf)]('level')||_0x5b3720[_0x1e240e(0xcf)]('valve')||_0x5b3720[_0x1e240e(0xcf)]('stellwert')||_0x5b3720[_0x1e240e(0xcf)](_0x1e240e(0x13e))||_0x91b73f[_0x1e240e(0xcf)](_0x1e240e(0x137))||_0x91b73f[_0x1e240e(0xcf)](_0x1e240e(0x138))||_0x1ba1a0['includes']('%'));if(_0x5153f2){const _0xffff6e=_0x4c232b['split'](/[._]+/)[_0x1e240e(0x12b)](_0x3b141b=>_0x3b141b['toLowerCase']());let _0x10e4b6=0x0;_0x18a38d[_0x1e240e(0xe0)](_0x45e197=>{const _0x3e4cd4=_0x1e240e;if(_0xffff6e[_0x3e4cd4(0xcf)](_0x45e197['toLowerCase']()))_0x10e4b6++;}),_0x2b545f[_0x1e240e(0x16c)]({'id':_0x4c232b,'score':_0x10e4b6});}}}if(_0x2b545f[_0x1e240e(0x10e)]>0x0){_0x2b545f[_0x1e240e(0xff)]((_0x2ca2ee,_0x119982)=>_0x119982[_0x1e240e(0x124)]-_0x2ca2ee[_0x1e240e(0x124)]);if(_0x2b545f[0x0][_0x1e240e(0x124)]>0x0)return _0x2b545f[0x0]['id'];}}}catch(_0x4d8d1b){}return null;}async function scanThermostats(_0x58382e){const _0x27d3e7=a1_0x3e4970,_0xf3c05=_0x58382e[_0x27d3e7(0xf0)][_0x27d3e7(0xce)]||[],_0xabda93=[],_0x1a30ea=_0xf3c05['filter'](_0x90732e=>_0x90732e['id']&&_0x90732e['id'][_0x27d3e7(0xcf)](_0x27d3e7(0x148))||_0x90732e['type']&&[_0x27d3e7(0x148),_0x27d3e7(0x100),_0x27d3e7(0xed)][_0x27d3e7(0xcf)](_0x90732e[_0x27d3e7(0xe9)])||_0x90732e[_0x27d3e7(0x118)]&&_0x90732e['name'][_0x27d3e7(0xf8)]()[_0x27d3e7(0xcf)](_0x27d3e7(0x156)));for(const _0x206c70 of _0x1a30ea){const _0x521a07=await findRelatedId(_0x58382e,_0x206c70['id'],_0x27d3e7(0xd8)),_0x1973f6=await findRelatedId(_0x58382e,_0x206c70['id'],_0x27d3e7(0x144));let _0x39ad44=_0x27d3e7(0x16b),_0x1adf33=![],_0x5e8ad5=_0x58382e[_0x27d3e7(0xf0)][_0x27d3e7(0xfa)]||{};if(typeof _0x5e8ad5===_0x27d3e7(0xd5))try{_0x5e8ad5=JSON['parse'](_0x5e8ad5);}catch(_0x3a5acf){}let _0x3fa08c=_0x58382e[_0x27d3e7(0xf0)][_0x27d3e7(0xfd)]||{};if(typeof _0x3fa08c==='string')try{_0x3fa08c=JSON[_0x27d3e7(0x149)](_0x3fa08c);}catch(_0x1dd3ea){}if(_0x5e8ad5[_0x206c70['id']]&&_0x5e8ad5[_0x206c70['id']]===_0x521a07||_0x3fa08c[_0x206c70['id']]&&_0x3fa08c[_0x206c70['id']]===_0x1973f6)_0x39ad44=_0x27d3e7(0x120),_0x1adf33=!![];else(_0x521a07||_0x1973f6)&&(_0x39ad44=_0x27d3e7(0xe5));_0xabda93['push']({'room':_0x206c70[_0x27d3e7(0x11b)]||'Unbekannt','sensorId':_0x206c70['id'],'setpointId':_0x521a07||'-','valveId':_0x1973f6||'-','source':_0x39ad44,'isManual':_0x1adf33,'status':_0x521a07&&_0x1973f6?_0x27d3e7(0x12c):_0x521a07?'OK':'Fehlt'});}return _0xabda93['sort']((_0x1286cb,_0x4d5024)=>_0x1286cb[_0x27d3e7(0x12d)][_0x27d3e7(0x127)](_0x4d5024[_0x27d3e7(0x12d)]));}async function updateSchedulePreview(_0x44aa6c){const _0x4c1e73=a1_0x3e4970;if(!_0x44aa6c[_0x4c1e73(0xf0)]['useCalendar']||!_0x44aa6c[_0x4c1e73(0xf0)]['calendarInstance'])return;let _0x1c06c2={};try{const _0xeeeebc=await _0x44aa6c[_0x4c1e73(0xd4)](_0x4c1e73(0x117));if(_0xeeeebc&&_0xeeeebc[_0x4c1e73(0x145)])_0x1c06c2=JSON['parse'](_0xeeeebc[_0x4c1e73(0x145)]);}catch(_0x279fbc){}const _0x21260e=[],_0x112a1b=Date[_0x4c1e73(0xe6)](),_0x26128a=0x30*0x3c*0x3c*0x3e8;try{const _0x460858=await _0x44aa6c[_0x4c1e73(0x167)](_0x44aa6c[_0x4c1e73(0xf0)][_0x4c1e73(0x14e)]+'.data.table');if(!_0x460858||!_0x460858[_0x4c1e73(0x145)])return;const _0x7d8a57=JSON['parse'](_0x460858[_0x4c1e73(0x145)]),_0x275340=_0x44aa6c[_0x4c1e73(0xf0)][_0x4c1e73(0x140)]||[],_0x192a2b=_0x44aa6c['config'][_0x4c1e73(0xce)]||[],_0x358fe9=new Set();_0x192a2b[_0x4c1e73(0xe0)](_0x1da2e7=>{const _0x87b777=_0x4c1e73;if(_0x1da2e7[_0x87b777(0x11b)])_0x358fe9[_0x87b777(0x15f)](_0x1da2e7['location']);});for(const _0x27548a of _0x7d8a57){if(_0x27548a['_calName']&&_0x275340['length']>0x0&&!_0x275340['includes'](_0x27548a['_calName']))continue;const _0x4d500a=_0x27548a[_0x4c1e73(0xcc)]||_0x27548a[_0x4c1e73(0x108)]||_0x27548a['date'];if(!_0x4d500a)continue;const _0x5b9f95=new Date(_0x4d500a),_0xc9051f=_0x5b9f95[_0x4c1e73(0xf9)]();if(isNaN(_0xc9051f))continue;if(_0xc9051f<_0x112a1b)continue;if(_0xc9051f>_0x112a1b+_0x26128a)continue;const _0x36a35f=(_0x27548a[_0x4c1e73(0x15c)]||_0x27548a[_0x4c1e73(0x160)]||'')['toLowerCase']();let _0x2d4bff=![],_0xf8eefa=[],_0x1dff74=_0x27548a[_0x4c1e73(0x15c)]||_0x27548a[_0x4c1e73(0x160)]||_0x4c1e73(0x12a);if(_0x36a35f[_0x4c1e73(0xcf)]('urlaub\x20ende')||_0x36a35f['includes'](_0x4c1e73(0x165))||_0x36a35f[_0x4c1e73(0xcf)](_0x4c1e73(0xe7)))_0x2d4bff=!![],_0xf8eefa=Array[_0x4c1e73(0xea)](_0x358fe9);else for(const _0x56b75d of _0x358fe9){if(_0x36a35f[_0x4c1e73(0xcf)](_0x56b75d[_0x4c1e73(0xf8)]()))_0xf8eefa[_0x4c1e73(0x16c)](_0x56b75d);}_0xf8eefa[_0x4c1e73(0x10e)]>0x0&&_0xf8eefa[_0x4c1e73(0xe0)](_0x11c8c9=>{const _0x472306=_0x4c1e73;let _0x5cd471=0x3c;if(_0x2d4bff){let _0x5660f9=0x0;Object[_0x472306(0x154)](_0x1c06c2)[_0x472306(0xe0)](_0x57a877=>{if(_0x57a877>_0x5660f9)_0x5660f9=_0x57a877;}),_0x5cd471=_0x5660f9>0x0?_0x5660f9:0x78;}else _0x5cd471=_0x1c06c2[_0x11c8c9]||0x3c;const _0x3f1b25=new Date(_0xc9051f-_0x5cd471*0xea60);_0x21260e['push']({'eventTime':_0xc9051f,'triggerTime':_0x3f1b25[_0x472306(0xf9)](),'room':_0x11c8c9,'minutes':_0x5cd471,'reason':_0x1dff74,'isGlobal':_0x2d4bff});});}}catch(_0x3368aa){}_0x21260e[_0x4c1e73(0xff)]((_0x4a64d0,_0xc329ae)=>_0x4a64d0[_0x4c1e73(0x14a)]-_0xc329ae[_0x4c1e73(0x14a)]);const _0x1e5a6f=_0x21260e[_0x4c1e73(0xec)](0x0,0x5);await _0x44aa6c[_0x4c1e73(0x142)](_0x4c1e73(0xfe),{'val':JSON[_0x4c1e73(0x102)](_0x1e5a6f),'ack':!![]});}async function checkCalendarTriggers(_0x3e25f6){const _0xf8c09d=a1_0x3e4970;if(!_0x3e25f6['config'][_0xf8c09d(0x147)]||!_0x3e25f6[_0xf8c09d(0xf0)][_0xf8c09d(0x14e)])return;await updateSchedulePreview(_0x3e25f6);let _0x1427da={},_0x11862a={};try{const _0x470acf=await _0x3e25f6[_0xf8c09d(0xd4)](_0xf8c09d(0x117));if(_0x470acf&&_0x470acf[_0xf8c09d(0x145)])_0x1427da=JSON[_0xf8c09d(0x149)](_0x470acf[_0xf8c09d(0x145)]);const _0x990a4f=await _0x3e25f6[_0xf8c09d(0xd4)](_0xf8c09d(0xdb));if(_0x990a4f&&_0x990a4f[_0xf8c09d(0x145)])_0x11862a=JSON[_0xf8c09d(0x149)](_0x990a4f[_0xf8c09d(0x145)]);}catch(_0x2b7730){}let _0xab40b0={'default':0x15};try{const _0x479c67=await _0x3e25f6[_0xf8c09d(0xd4)](_0xf8c09d(0x134));if(_0x479c67&&_0x479c67[_0xf8c09d(0x145)])_0xab40b0=JSON[_0xf8c09d(0x149)](_0x479c67['val']);}catch(_0xa1e65b){}try{const _0x36fce2=await _0x3e25f6[_0xf8c09d(0x167)](_0x3e25f6[_0xf8c09d(0xf0)][_0xf8c09d(0x14e)]+_0xf8c09d(0x105));if(!_0x36fce2||!_0x36fce2[_0xf8c09d(0x145)])return;const _0x9c212b=JSON[_0xf8c09d(0x149)](_0x36fce2[_0xf8c09d(0x145)]),_0x91837e=Date['now'](),_0x3e4e77=_0x3e25f6[_0xf8c09d(0xf0)][_0xf8c09d(0xce)]||[],_0x26306f=_0x3e25f6[_0xf8c09d(0xf0)][_0xf8c09d(0x140)]||[];for(const _0x24bdea of _0x9c212b){if(_0x24bdea[_0xf8c09d(0x135)]&&_0x26306f[_0xf8c09d(0x10e)]>0x0&&!_0x26306f[_0xf8c09d(0xcf)](_0x24bdea[_0xf8c09d(0x135)]))continue;const _0x75cbbf=_0x24bdea[_0xf8c09d(0xcc)]||_0x24bdea['eventStart']||_0x24bdea[_0xf8c09d(0x10b)];if(!_0x75cbbf)continue;const _0x5affb8=new Date(_0x75cbbf);if(isNaN(_0x5affb8['getTime']()))continue;const _0x4a2d78=(_0x24bdea[_0xf8c09d(0x15c)]||_0x24bdea['summary']||'')[_0xf8c09d(0xf8)]();if(_0x4a2d78['includes']('urlaub\x20ende')||_0x4a2d78[_0xf8c09d(0xcf)](_0xf8c09d(0x165))||_0x4a2d78[_0xf8c09d(0xcf)]('ankunft')){let _0x1ab76d=0x0;Object['values'](_0x1427da)[_0xf8c09d(0xe0)](_0x51ba8c=>{if(_0x51ba8c>_0x1ab76d)_0x1ab76d=_0x51ba8c;});if(_0x1ab76d===0x0)_0x1ab76d=0x78;const _0x2edfd7=_0x5affb8[_0xf8c09d(0xf9)]()-_0x1ab76d*0xea60;_0x91837e>=_0x2edfd7&&_0x91837e<_0x5affb8[_0xf8c09d(0xf9)]()&&(_0x3e25f6[_0xf8c09d(0x139)]!==_0xf8c09d(0x101)&&(_0x3e25f6[_0xf8c09d(0xd0)][_0xf8c09d(0xda)](_0xf8c09d(0xeb)+_0x1ab76d+_0xf8c09d(0xf6)),await _0x3e25f6['setStateAsync'](_0xf8c09d(0xd7),{'val':_0xf8c09d(0x101),'ack':![]})));}for(const _0x4c70c7 of _0x3e4e77){if(_0x4c70c7[_0xf8c09d(0x11b)]){const _0xcfce0e=_0x4c70c7[_0xf8c09d(0x11b)][_0xf8c09d(0xf8)]();if(_0x4a2d78[_0xf8c09d(0xcf)](_0xcfce0e)){const _0x4c8b1b=_0x1427da[_0x4c70c7['location']]||0x3c,_0x130705=_0x11862a[_0x4c70c7[_0xf8c09d(0x11b)]]||'Classic',_0x473db5=_0x5affb8[_0xf8c09d(0xf9)]()-_0x4c8b1b*0xea60;if(_0x91837e>=_0x473db5&&_0x91837e<_0x5affb8[_0xf8c09d(0xf9)]()){const _0x59d85b=lastActions['cal_'+_0x4c70c7[_0xf8c09d(0x11b)]];if(_0x59d85b&&_0x91837e-_0x59d85b<CAL_COOLDOWN_MS)continue;const _0x300f9f=await findRelatedId(_0x3e25f6,_0x4c70c7['id'],'setpoint');if(_0x300f9f){let _0x55a281=_0xab40b0[_0x4c70c7[_0xf8c09d(0x11b)]];if(_0x55a281===undefined)_0x55a281=_0xab40b0[_0xf8c09d(0xf5)];if(_0x55a281===undefined)_0x55a281=0x15;const _0x433bd3=await _0x3e25f6[_0xf8c09d(0x167)](_0x300f9f);_0x433bd3&&typeof _0x433bd3['val']==='number'&&_0x433bd3['val']<_0x55a281-0.5&&(_0x3e25f6[_0xf8c09d(0xd0)]['info'](_0xf8c09d(0x111)+_0x130705+_0xf8c09d(0x14c)+_0x4c70c7['location']+_0xf8c09d(0xd2)+_0x55a281+_0xf8c09d(0xe3)+_0x4c8b1b+_0xf8c09d(0xf6)),await _0x3e25f6[_0xf8c09d(0x136)](_0x300f9f,_0x55a281),await logAutomationAction(_0x3e25f6,_0xf8c09d(0x155)+_0x4c70c7['location']+_0xf8c09d(0x164)+_0x55a281+_0xf8c09d(0x166)+_0x130705+')'),lastActions['cal_'+_0x4c70c7[_0xf8c09d(0x11b)]]=_0x91837e);}}}}}}}catch(_0xb78ee9){_0x3e25f6[_0xf8c09d(0xd0)][_0xf8c09d(0x128)]('Calendar\x20Check\x20Error:\x20'+_0xb78ee9[_0xf8c09d(0x107)]);}}async function manageMpcIntervention(_0x3bf00d,_0x2b1e07,_0x19d3e4){const _0x4b5fcb=a1_0x3e4970;try{const _0x8570d0=_0x4b5fcb(0xd1),_0x5a39a4=await _0x3bf00d['getStateAsync'](_0x8570d0);let _0x491b1d=[];if(_0x5a39a4&&_0x5a39a4[_0x4b5fcb(0x145)])try{_0x491b1d=JSON[_0x4b5fcb(0x149)](_0x5a39a4['val']);}catch(_0x17c8a3){}const _0x46e88e=_0x491b1d['indexOf'](_0x2b1e07);if(_0x19d3e4===_0x4b5fcb(0x15f))_0x46e88e===-0x1&&(_0x491b1d[_0x4b5fcb(0x16c)](_0x2b1e07),await _0x3bf00d[_0x4b5fcb(0x142)](_0x8570d0,{'val':JSON[_0x4b5fcb(0x102)](_0x491b1d),'ack':!![]}));else _0x19d3e4===_0x4b5fcb(0x169)&&(_0x46e88e!==-0x1&&(_0x491b1d[_0x4b5fcb(0x129)](_0x46e88e,0x1),await _0x3bf00d['setStateAsync'](_0x8570d0,{'val':JSON[_0x4b5fcb(0x102)](_0x491b1d),'ack':!![]})));}catch(_0x5d031d){}}function a1_0x216e(_0x544760,_0x403b19){const _0x3e20d2=a1_0x27d8();return a1_0x216e=function(_0x237d5c,_0x253c28){_0x237d5c=_0x237d5c-0xcc;let _0x27d8bb=_0x3e20d2[_0x237d5c];return _0x27d8bb;},a1_0x216e(_0x544760,_0x403b19);}async function cleanupGhostInterventions(_0x50506d){const _0xb363c9=a1_0x3e4970;try{const _0x417e9=_0xb363c9(0xd1),_0x59fd97=await _0x50506d[_0xb363c9(0xd4)](_0x417e9);if(!_0x59fd97||!_0x59fd97[_0xb363c9(0x145)])return;const _0x15dc82=JSON['parse'](_0x59fd97[_0xb363c9(0x145)]);if(!Array['isArray'](_0x15dc82)||_0x15dc82[_0xb363c9(0x10e)]===0x0)return;const _0x4c95fd=_0x50506d[_0xb363c9(0xf0)][_0xb363c9(0xce)]||[];let _0x47c43c=![];for(let _0x22368b=_0x15dc82[_0xb363c9(0x10e)]-0x1;_0x22368b>=0x0;_0x22368b--){const _0x31f47f=_0x15dc82[_0x22368b],_0x5dce9b=_0x4c95fd['find'](_0x2ef05e=>normalize(_0x2ef05e[_0xb363c9(0x11b)])===normalize(_0x31f47f)&&(_0x2ef05e[_0xb363c9(0xe9)]===_0xb363c9(0x148)||_0x2ef05e['type']===_0xb363c9(0x100)));if(_0x5dce9b){const _0x2c06dd=await findRelatedId(_0x50506d,_0x5dce9b['id'],_0xb363c9(0xd8));if(_0x2c06dd){const _0x1a5253=await _0x50506d['getForeignStateAsync'](_0x2c06dd);_0x1a5253&&typeof _0x1a5253['val']==='number'&&(Math[_0xb363c9(0x130)](_0x1a5253['val']-ECO_TEMP)>0.5&&(_0x50506d[_0xb363c9(0xd0)][_0xb363c9(0xda)](_0xb363c9(0x11a)+_0x31f47f+'\x20ist\x20auf\x20'+_0x1a5253['val']+_0xb363c9(0x153)+ECO_TEMP+_0xb363c9(0x16d)),_0x15dc82[_0xb363c9(0x129)](_0x22368b,0x1),_0x47c43c=!![]));}}}_0x47c43c&&await _0x50506d[_0xb363c9(0x142)](_0x417e9,{'val':JSON[_0xb363c9(0x102)](_0x15dc82),'ack':!![]});}catch(_0x31d4dc){}}async function applyEnergySavings(_0x5c14e8,_0x4bdd91){const _0x164079=a1_0x3e4970;await cleanupGhostInterventions(_0x5c14e8);if(!_0x4bdd91||_0x4bdd91[_0x164079(0x10e)]===0x0)return;const _0x377488=_0x5c14e8['config'][_0x164079(0xce)]||[],_0x499f38=Date['now']();for(const _0x41c4ba of _0x4bdd91){const _0x25ec93=_0x41c4ba[_0x164079(0x12d)],_0x44f3cf=_0x41c4ba[_0x164079(0x168)],_0x45b436=_0x41c4ba[_0x164079(0x113)]||0x15,_0x40dab4=_0x377488[_0x164079(0x11d)](_0x5e9dbf=>normalize(_0x5e9dbf[_0x164079(0x11b)])===normalize(_0x25ec93)&&(_0x5e9dbf[_0x164079(0xe9)]==='temperature'||_0x5e9dbf[_0x164079(0xe9)]==='thermostat'));if(!_0x40dab4)continue;const _0x10dd4c=await findRelatedId(_0x5c14e8,_0x40dab4['id'],_0x164079(0xd8));if(_0x10dd4c){if(lastActions[_0x164079(0x15b)+_0x25ec93]&&_0x499f38-lastActions[_0x164079(0x15b)+_0x25ec93]<0x1e*0x3c*0x3e8)continue;const _0x4ebc0e=await _0x5c14e8['getForeignStateAsync'](_0x10dd4c);if(_0x4ebc0e&&typeof _0x4ebc0e[_0x164079(0x145)]==='number'){const _0x30b926=_0x4ebc0e[_0x164079(0x145)];_0x30b926!==ECO_TEMP&&await manageMpcIntervention(_0x5c14e8,_0x25ec93,_0x164079(0x169));if(_0x44f3cf>0x1e)_0x30b926>ECO_TEMP+0.5&&(_0x5c14e8[_0x164079(0xd0)][_0x164079(0xda)](_0x164079(0x121)+_0x25ec93+_0x164079(0x159)+ECO_TEMP+_0x164079(0xf4)+_0x44f3cf+_0x164079(0x13b)),await _0x5c14e8[_0x164079(0x136)](_0x10dd4c,ECO_TEMP),await manageMpcIntervention(_0x5c14e8,_0x25ec93,_0x164079(0x15f)),lastActions[_0x164079(0x15b)+_0x25ec93]=_0x499f38,await logAutomationAction(_0x5c14e8,_0x164079(0x104)+_0x25ec93+':\x20Absenkung\x20auf\x20'+ECO_TEMP+'Â°C'));else _0x44f3cf<=0xf&&(_0x30b926<_0x45b436&&(_0x5c14e8[_0x164079(0xd0)]['info']('ðŸ”¥\x20[MPC\x20ACTION]\x20Heize\x20'+_0x25ec93+_0x164079(0x15a)+_0x45b436+'Â°C!\x20(Puffer\x20leer).'),await _0x5c14e8['setForeignStateAsync'](_0x10dd4c,_0x45b436),await manageMpcIntervention(_0x5c14e8,_0x25ec93,'remove'),lastActions[_0x164079(0x15b)+_0x25ec93]=_0x499f38,await logAutomationAction(_0x5c14e8,_0x164079(0x104)+_0x25ec93+':\x20Aufheizen\x20auf\x20'+_0x45b436+'Â°C')));}}else _0x5c14e8[_0x164079(0xd0)][_0x164079(0x128)](_0x164079(0x115)+_0x25ec93+'\x20gefunden!');}}module[a1_0x3e4970(0x141)]={'handlePrediction':handlePrediction,'applyEnergySavings':applyEnergySavings,'scanThermostats':scanThermostats,'checkCalendarTriggers':checkCalendarTriggers,'updateSchedulePreview':updateSchedulePreview};