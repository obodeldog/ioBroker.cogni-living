const a1_0xa8ae40=a1_0x5bf8;(function(_0x4e5c2e,_0x2d86e3){const _0x5f04c9=a1_0x5bf8,_0x47294b=_0x4e5c2e();while(!![]){try{const _0x290469=-parseInt(_0x5f04c9(0x109))/0x1*(parseInt(_0x5f04c9(0x15d))/0x2)+parseInt(_0x5f04c9(0xe0))/0x3*(parseInt(_0x5f04c9(0xfb))/0x4)+parseInt(_0x5f04c9(0x125))/0x5+parseInt(_0x5f04c9(0xee))/0x6*(-parseInt(_0x5f04c9(0x14e))/0x7)+-parseInt(_0x5f04c9(0xd9))/0x8*(-parseInt(_0x5f04c9(0x14d))/0x9)+parseInt(_0x5f04c9(0x187))/0xa+-parseInt(_0x5f04c9(0x10a))/0xb;if(_0x290469===_0x2d86e3)break;else _0x47294b['push'](_0x47294b['shift']());}catch(_0x5a0586){_0x47294b['push'](_0x47294b['shift']());}}}(a1_0x35f8,0x8ac73));const a1_0x40ed81=(function(){let _0x47b0b2=!![];return function(_0x13efe5,_0x6d507e){const _0x51bb92=_0x47b0b2?function(){const _0x30e4e5=a1_0x5bf8;if(_0x6d507e){const _0x3545e3=_0x6d507e[_0x30e4e5(0x120)](_0x13efe5,arguments);return _0x6d507e=null,_0x3545e3;}}:function(){};return _0x47b0b2=![],_0x51bb92;};}()),a1_0x19030d=a1_0x40ed81(this,function(){const _0x5055ec=a1_0x5bf8;return a1_0x19030d['toString']()[_0x5055ec(0x153)](_0x5055ec(0x16d))[_0x5055ec(0x12c)]()[_0x5055ec(0x10e)](a1_0x19030d)[_0x5055ec(0x153)](_0x5055ec(0x16d));});a1_0x19030d();'use strict';const aiAgent=require(a1_0xa8ae40(0x141)),COOLDOWN_MS=0x3c*0x3e8,CAL_COOLDOWN_MS=0x5a*0x3c*0x3e8,RESCUE_LOCK_MS=0x78*0x3c*0x3e8,ECO_TEMP=0x11,lastActions={};function normalize(_0x58bf1e){const _0x4c5379=a1_0xa8ae40;if(!_0x58bf1e)return'';return _0x58bf1e[_0x4c5379(0x103)]()[_0x4c5379(0x160)](/\s+/g,'')[_0x4c5379(0xf0)]();}async function logAutomationAction(_0x326bb0,_0x2e8b86){const _0xbffc43=a1_0xa8ae40;await _0x326bb0['setStateAsync'](_0xbffc43(0xd3),{'val':_0x2e8b86,'ack':!![]});try{const _0x483c57='analysis.automation.actionLog',_0x273422=await _0x326bb0[_0xbffc43(0xd1)](_0x483c57);let _0xb61112=[];if(_0x273422&&_0x273422[_0xbffc43(0x189)])try{_0xb61112=JSON['parse'](_0x273422['val']);}catch(_0x28c91d){}_0xb61112[_0xbffc43(0x118)]({'ts':Date[_0xbffc43(0xed)](),'msg':_0x2e8b86});if(_0xb61112['length']>0x32)_0xb61112=_0xb61112['slice'](0x0,0x32);await _0x326bb0['setStateAsync'](_0x483c57,{'val':JSON[_0xbffc43(0x139)](_0xb61112),'ack':!![]});}catch(_0x3fe656){}}async function handlePrediction(_0x1edcf5,_0x17e9a0,_0x46c128){const _0x339ba2=a1_0xa8ae40;if(!_0x17e9a0||_0x17e9a0===_0x339ba2(0x17e))return;let _0x38ed8f=_0x339ba2(0x159),_0x3665b4=0.6;try{const _0x5e4075=await _0x1edcf5[_0x339ba2(0xd1)](_0x339ba2(0x11e));if(_0x5e4075&&_0x5e4075[_0x339ba2(0x189)])_0x38ed8f=_0x5e4075[_0x339ba2(0x189)];const _0x4f99a9=await _0x1edcf5[_0x339ba2(0xd1)](_0x339ba2(0x16c));if(_0x4f99a9&&_0x4f99a9['val'])_0x3665b4=_0x4f99a9[_0x339ba2(0x189)];}catch(_0x4908de){}if(_0x38ed8f===_0x339ba2(0x159)||_0x46c128<_0x3665b4)return;const _0x52593a=Date[_0x339ba2(0xed)]();if(lastActions[_0x17e9a0]&&_0x52593a-lastActions[_0x17e9a0]<COOLDOWN_MS)return;const _0x20ec58=_0x1edcf5[_0x339ba2(0x11b)][_0x339ba2(0x13f)]||[],_0x1e9112=normalize(_0x17e9a0),_0x4e6b8b=_0x20ec58[_0x339ba2(0x12e)](_0x111ca2=>normalize(_0x111ca2[_0x339ba2(0x158)])===_0x1e9112&&(_0x111ca2[_0x339ba2(0x127)]===_0x339ba2(0x180)||_0x111ca2['type']===_0x339ba2(0xe3)||_0x111ca2['type']==='switch'));if(!_0x4e6b8b)return;const _0x209865=await aiAgent[_0x339ba2(0x173)](_0x1edcf5,_0x17e9a0,_0x4e6b8b['name'],_0x46c128);if(!_0x209865['approved'])return;const _0x3f2085=_0x339ba2(0xe4)+_0x17e9a0+'\x20->\x20Schalte\x20'+_0x4e6b8b[_0x339ba2(0x183)]+'\x20('+_0x209865[_0x339ba2(0xe9)]+')';await logAutomationAction(_0x1edcf5,'['+_0x38ed8f[_0x339ba2(0x110)]()+']\x20'+_0x3f2085);if(_0x38ed8f==='active'){const _0x509165=await _0x1edcf5[_0x339ba2(0x137)](_0x4e6b8b['id']);(!_0x509165||!_0x509165['val']&&_0x509165['val']!==!![])&&await _0x1edcf5[_0x339ba2(0xf1)](_0x4e6b8b['id'],!![]),lastActions[_0x17e9a0]=_0x52593a;}}async function findRelatedId(_0x7ada94,_0x5567b9,_0x403185=a1_0xa8ae40(0x128)){const _0x40178a=a1_0xa8ae40;if(_0x403185===_0x40178a(0x128)&&_0x7ada94[_0x40178a(0x11b)][_0x40178a(0x15b)]){let _0x33ef07=_0x7ada94[_0x40178a(0x11b)][_0x40178a(0x15b)];if(typeof _0x33ef07===_0x40178a(0x181))try{_0x33ef07=JSON[_0x40178a(0x143)](_0x33ef07);}catch(_0x5bb66d){}if(_0x33ef07&&_0x33ef07[_0x5567b9])return _0x33ef07[_0x5567b9];}if(_0x403185==='valve'&&_0x7ada94[_0x40178a(0x11b)][_0x40178a(0x171)]){let _0x363454=_0x7ada94[_0x40178a(0x11b)]['valveMapping'];if(typeof _0x363454===_0x40178a(0x181))try{_0x363454=JSON[_0x40178a(0x143)](_0x363454);}catch(_0x5972cb){}if(_0x363454&&_0x363454[_0x5567b9])return _0x363454[_0x5567b9];}let _0x34ead4=[];if(_0x403185==='setpoint')_0x34ead4=[{'s':_0x40178a(0xf8),'t':_0x40178a(0x186)},{'s':_0x40178a(0x136),'t':_0x40178a(0x186)},{'s':_0x40178a(0x136),'t':_0x40178a(0x174)},{'s':'ACTUAL_TEMPERATURE','t':_0x40178a(0x119)},{'s':_0x40178a(0xd6),'t':_0x40178a(0xdd)},{'s':_0x40178a(0xd6),'t':'current_heating_setpoint'},{'s':_0x40178a(0x126),'t':_0x40178a(0x11f)},{'s':_0x40178a(0x172),'t':'SET'},{'s':_0x40178a(0x111),'t':_0x40178a(0x11a)},{'s':'temperature','t':'setpoint'}];else _0x403185===_0x40178a(0xe7)&&(_0x34ead4=[{'s':_0x40178a(0xf8),'t':_0x40178a(0xff)},{'s':_0x40178a(0x136),'t':_0x40178a(0xff)},{'s':_0x40178a(0x136),'t':_0x40178a(0x157)},{'s':_0x40178a(0xd6),'t':_0x40178a(0x12f)},{'s':'temperature','t':'valve_position'},{'s':_0x40178a(0x126),'t':'level'}]);for(const _0x24deab of _0x34ead4){if(_0x5567b9['includes'](_0x24deab['s'])){const _0x55b73c=_0x5567b9['replace'](_0x24deab['s'],_0x24deab['t']),_0x26eda3=await _0x7ada94[_0x40178a(0x140)](_0x55b73c);if(_0x26eda3)return _0x55b73c;}}try{const _0x452bec=_0x5567b9[_0x40178a(0x16a)]('.');if(_0x452bec['length']>0x2){const _0x53b69b=_0x452bec[_0x40178a(0x10f)](0x0,-0x1)[_0x40178a(0x104)]('.'),_0x20b45c=await _0x7ada94[_0x40178a(0x18a)](_0x53b69b+'.*'),_0x146e9a=[],_0x47cda9=_0x5567b9[_0x40178a(0x16a)](/[._]+/)[_0x40178a(0x124)](_0x3cdb83=>![_0x40178a(0x13a),'0','hm-rpc',_0x40178a(0xea),_0x40178a(0xec),_0x40178a(0x126),_0x40178a(0x167),_0x40178a(0x12a),_0x40178a(0xd5),_0x40178a(0x142)][_0x40178a(0x163)](_0x3cdb83['toLowerCase']()));for(const [_0xa550e,_0x4005b1]of Object[_0x40178a(0x14a)](_0x20b45c)){if(_0xa550e===_0x5567b9)continue;if(_0x4005b1&&_0x4005b1[_0x40178a(0x161)]){const _0x31316a=_0xa550e['toLowerCase'](),_0x1df10e=(_0x4005b1[_0x40178a(0x161)][_0x40178a(0x17d)]||'')[_0x40178a(0x103)](),_0x2fec32=(_0x4005b1[_0x40178a(0x161)]['unit']||'')[_0x40178a(0x103)]();let _0x50dbe1=![];if(_0x403185===_0x40178a(0x128)&&_0x4005b1['common'][_0x40178a(0x115)]===!![])_0x50dbe1=_0x31316a[_0x40178a(0x163)](_0x40178a(0x122))||_0x31316a['includes'](_0x40178a(0x18b))||_0x31316a[_0x40178a(0x163)](_0x40178a(0x101))||_0x1df10e['includes'](_0x40178a(0x149))||_0x1df10e[_0x40178a(0x163)](_0x40178a(0x146));else _0x403185==='valve'&&(_0x50dbe1=_0x31316a['includes'](_0x40178a(0xdf))||_0x31316a[_0x40178a(0x163)](_0x40178a(0xe7))||_0x31316a[_0x40178a(0x163)](_0x40178a(0x10b))||_0x31316a[_0x40178a(0x163)](_0x40178a(0xe5))||_0x1df10e[_0x40178a(0x163)](_0x40178a(0x175))||_0x1df10e[_0x40178a(0x163)](_0x40178a(0x107))||_0x2fec32[_0x40178a(0x163)]('%'));if(_0x50dbe1){const _0x1339dc=_0xa550e[_0x40178a(0x16a)](/[._]+/)[_0x40178a(0x105)](_0x35537d=>_0x35537d[_0x40178a(0x103)]());let _0xec4fab=0x0;_0x47cda9[_0x40178a(0x16e)](_0x1ca009=>{if(_0x1339dc['includes'](_0x1ca009['toLowerCase']()))_0xec4fab++;}),_0x146e9a[_0x40178a(0x166)]({'id':_0xa550e,'score':_0xec4fab});}}}if(_0x146e9a[_0x40178a(0x121)]>0x0){_0x146e9a['sort']((_0xf21fb3,_0x5ad96e)=>_0x5ad96e['score']-_0xf21fb3[_0x40178a(0xdc)]);if(_0x146e9a[0x0]['score']>0x0)return _0x146e9a[0x0]['id'];}}}catch(_0x9ee608){}return null;}function a1_0x35f8(){const _0xc8b8ad=['[MPC]\x20','filter','4761180XMmvze','temperature','type','setpoint','manual','sensor','number','toString','_date','find','pi_heating_demand','[CAL]\x20','analysis.energy.warmupSources','\x20wieder\x20auf\x20','log','thermostat','splice','.1.TEMPERATURE','getForeignStateAsync','Â°C\x20(Vorlauf:\x20','stringify','openknx',':\x20Absenkung\x20auf\x20','ðŸŽ“\x20[RL-FEEDBACK]\x20Lerne\x20aus\x20Fehler:\x20','setStateAsync','Calendar\x20Check\x20Error:\x20','devices','getForeignObjectAsync','./ai_agent','state','parse','ðŸš¨\x20[MPC\x20WATCHDOG]\x20','contact','thermostat.setpoint','exports','ðŸ”¥\x20[MPC\x20ACTION]\x20Heize\x20','level.temperature','entries','Â°C).\x20Entferne\x20Status.',':\x20Puffer\x20leer\x20->\x20Heizen\x20auf\x20','22338aPfNgb','126070bhkQQu','cal_','Â°C\x20(via\x20','\x20auf\x20','calendarInstance','search','eventStart','ðŸ“…\x20SMART\x20SCHEDULE\x20[','ðŸ“…\x20SMART\x20SCHEDULE\x20(Phase):\x20\x27Globaler\x20Start\x27\x20erkannt.\x20Heize\x20Haus\x20auf\x20(Vorlauf:\x20','.4.VALVE_STATE','location','off','normal','thermostatMapping','Â°C\x20<\x20','1189876FxCVfn','date','Â°C\x20(nicht\x20','replace','common','triggerTime','includes','ðŸ§¹\x20[MPC\x20CLEANUP]\x20','\x20min)','push','actual','calendarSelection','warn','split','analysis.energy.mpcActiveInterventions','analysis.automation.confidenceThreshold','(((.+)+)+)+$','forEach','ðŸƒ\x20[MPC\x20ACTION]\x20Senke\x20','\x20erreicht\x20Limit\x20(','valveMapping','ACTUAL','consultButler','.4.SET_TEMPERATURE','level.valve','\x20ist\x20auf\x20','info','add','Â°C!\x20(Puffer:\x20','Â°C!\x20(Puffer\x20leer).','PERFECT','ankunft','role','Unknown','\x20gefunden!','light','string','Â°C).\x20Sparmodus\x20beendet!','name','analysis.energy.ventilationAlerts','mpc_','.1.SET_POINT_TEMPERATURE','8796200bBqVrN','\x20ist\x20zu\x20kalt,\x20ABER\x20Fenster\x20offen/LÃ¼ftung\x20erkannt.\x20Heize\x20NICHT,\x20entferne\x20nur\x20Status.','val','getForeignObjectsAsync','soll','[WATCHDOG]\x20','[MPC\x20WARNING]\x20Kein\x20Setpoint\x20fÃ¼r\x20','getStateAsync','ðŸŒ¬ï¸\x20[MPC\x20WATCHDOG]\x20','analysis.automation.lastAction','Classic','messwert','local_temperature','analysis.energy.warmupTimes','\x20durch\x20Kalender\x20geÃ¤ndert.\x20Keine\x20RL-Strafe.','488bdqJxp','summary','ðŸ“…\x20[MPC\x20INFO]\x20','score','occupied_heating_setpoint','from','level','3kIUeiL','event','_calName','dimmer','PrÃ¤diktion:\x20','position','useCalendar','valve','room','reason','ist','default','wert','now','324ZclyAc','\x27\x20hat\x20kein\x20GerÃ¤t\x20mehr.\x20LÃ¶sche\x20Eintrag.','trim','setForeignStateAsync','analysis.energy.warmupTargets','analysis.energy.schedulePreview','minutes_safe','ðŸ§¹\x20[MPC\x20CLEANUP]\x20Raum\x20\x27','rÃ¼ckkehr','indexOf','.1.ACTUAL_TEMPERATURE','getTime','remove','1347876mtrHXl','sendToPythonWrapper',']:\x20Raum-Trigger\x20\x27','Unbekannt','.1.LEVEL','\x20min).','target','TRAIN_RL_PENALTY','toLowerCase','join','map','open','value.valve','rescue_','1POmDmj','2027454HSQkyb','stellwert','sort','.data.table','constructor','slice','toUpperCase','Ist',':\x20Aufheizen\x20auf\x20','Fehlt','temp','write','\x20->\x20','\x20wurde\x20manuell\x20erhÃ¶ht.','unshift','SET_POINT_TEMPERATURE','Soll','config','system.mode','urlaub\x20ende','analysis.automation.mode','target_temperature','apply','length','set'];a1_0x35f8=function(){return _0xc8b8ad;};return a1_0x35f8();}function a1_0x5bf8(_0x1ef4a4,_0x1f5c60){const _0x41964e=a1_0x35f8();return a1_0x5bf8=function(_0x19030d,_0x40ed81){_0x19030d=_0x19030d-0xd0;let _0x35f809=_0x41964e[_0x19030d];return _0x35f809;},a1_0x5bf8(_0x1ef4a4,_0x1f5c60);}async function scanThermostats(_0xfba81e){const _0x3486b0=a1_0xa8ae40,_0xe621ed=_0xfba81e[_0x3486b0(0x11b)][_0x3486b0(0x13f)]||[],_0x3d1175=[],_0x40ee08=_0xe621ed[_0x3486b0(0x124)](_0x2e6d76=>_0x2e6d76['id']&&_0x2e6d76['id']['includes'](_0x3486b0(0x126))||_0x2e6d76['type']&&[_0x3486b0(0x126),_0x3486b0(0x134),_0x3486b0(0x12a)][_0x3486b0(0x163)](_0x2e6d76['type'])||_0x2e6d76['name']&&_0x2e6d76[_0x3486b0(0x183)][_0x3486b0(0x103)]()[_0x3486b0(0x163)](_0x3486b0(0x114)));for(const _0x375b9c of _0x40ee08){const _0x10ad85=await findRelatedId(_0xfba81e,_0x375b9c['id'],_0x3486b0(0x128)),_0x2ce520=await findRelatedId(_0xfba81e,_0x375b9c['id'],'valve');let _0x3098e6='Nicht\x20gefunden',_0x1eaf54=![],_0xfa990a=_0xfba81e[_0x3486b0(0x11b)]['thermostatMapping']||{};if(typeof _0xfa990a===_0x3486b0(0x181))try{_0xfa990a=JSON[_0x3486b0(0x143)](_0xfa990a);}catch(_0x21227b){}let _0x558973=_0xfba81e['config'][_0x3486b0(0x171)]||{};if(typeof _0x558973===_0x3486b0(0x181))try{_0x558973=JSON[_0x3486b0(0x143)](_0x558973);}catch(_0xe64b80){}if(_0xfa990a[_0x375b9c['id']]&&_0xfa990a[_0x375b9c['id']]===_0x10ad85||_0x558973[_0x375b9c['id']]&&_0x558973[_0x375b9c['id']]===_0x2ce520)_0x3098e6='Manuelles\x20Mapping',_0x1eaf54=!![];else(_0x10ad85||_0x2ce520)&&(_0x3098e6='Auto-Erkennung');_0x3d1175[_0x3486b0(0x166)]({'room':_0x375b9c[_0x3486b0(0x158)]||_0x3486b0(0xfe),'sensorId':_0x375b9c['id'],'setpointId':_0x10ad85||'-','valveId':_0x2ce520||'-','source':_0x3098e6,'isManual':_0x1eaf54,'status':_0x10ad85&&_0x2ce520?_0x3486b0(0x17b):_0x10ad85?'OK':_0x3486b0(0x113)});}return _0x3d1175['sort']((_0xd7365d,_0x277274)=>_0xd7365d['room']['localeCompare'](_0x277274['room']));}async function updateSchedulePreview(_0x162bea){const _0xf10a7a=a1_0xa8ae40;if(!_0x162bea[_0xf10a7a(0x11b)][_0xf10a7a(0xe6)]||!_0x162bea[_0xf10a7a(0x11b)][_0xf10a7a(0x152)])return;let _0x39e323={};try{const _0x5d99ef=await _0x162bea[_0xf10a7a(0xd1)](_0xf10a7a(0xd7));if(_0x5d99ef&&_0x5d99ef[_0xf10a7a(0x189)])_0x39e323=JSON['parse'](_0x5d99ef['val']);}catch(_0x543efd){}const _0x2f1ea0=[],_0x492007=Date['now'](),_0xada55c=0x30*0x3c*0x3c*0x3e8;try{const _0x483b6a=await _0x162bea[_0xf10a7a(0x137)](_0x162bea[_0xf10a7a(0x11b)][_0xf10a7a(0x152)]+'.data.table');if(!_0x483b6a||!_0x483b6a[_0xf10a7a(0x189)])return;const _0x36ffd1=JSON[_0xf10a7a(0x143)](_0x483b6a['val']),_0x135783=_0x162bea[_0xf10a7a(0x11b)][_0xf10a7a(0x168)]||[],_0x46c273=_0x162bea['config'][_0xf10a7a(0x13f)]||[],_0xcd2ab2=new Set();_0x46c273[_0xf10a7a(0x16e)](_0xbd253a=>{const _0x247daa=_0xf10a7a;if(_0xbd253a['location'])_0xcd2ab2[_0x247daa(0x178)](_0xbd253a[_0x247daa(0x158)]);});for(const _0x5b6c61 of _0x36ffd1){if(_0x5b6c61[_0xf10a7a(0xe2)]&&_0x135783[_0xf10a7a(0x121)]>0x0&&!_0x135783[_0xf10a7a(0x163)](_0x5b6c61[_0xf10a7a(0xe2)]))continue;const _0x19d2c4=_0x5b6c61['_date']||_0x5b6c61[_0xf10a7a(0x154)]||_0x5b6c61['date'];if(!_0x19d2c4)continue;const _0x23d861=new Date(_0x19d2c4),_0x46e196=_0x23d861[_0xf10a7a(0xf9)]();if(isNaN(_0x46e196))continue;if(_0x46e196<_0x492007)continue;if(_0x46e196>_0x492007+_0xada55c)continue;const _0x27810e=(_0x5b6c61[_0xf10a7a(0xe1)]||_0x5b6c61[_0xf10a7a(0xda)]||'')[_0xf10a7a(0x103)]();let _0x34f65a=![],_0x2bb2ba=[],_0x3f04b5=_0x5b6c61[_0xf10a7a(0xe1)]||_0x5b6c61[_0xf10a7a(0xda)]||_0xf10a7a(0xfe);if(_0x27810e[_0xf10a7a(0x163)](_0xf10a7a(0x11d))||_0x27810e[_0xf10a7a(0x163)](_0xf10a7a(0xf6))||_0x27810e[_0xf10a7a(0x163)](_0xf10a7a(0x17c)))_0x34f65a=!![],_0x2bb2ba=Array[_0xf10a7a(0xde)](_0xcd2ab2);else for(const _0x3198bc of _0xcd2ab2){if(_0x27810e[_0xf10a7a(0x163)](_0x3198bc[_0xf10a7a(0x103)]()))_0x2bb2ba[_0xf10a7a(0x166)](_0x3198bc);}_0x2bb2ba[_0xf10a7a(0x121)]>0x0&&_0x2bb2ba[_0xf10a7a(0x16e)](_0xae6282=>{const _0x527dd3=_0xf10a7a;let _0x3c5d54=0x3c;if(_0x34f65a){let _0x4b20a2=0x0;Object['values'](_0x39e323)['forEach'](_0x27b40e=>{if(_0x27b40e>_0x4b20a2)_0x4b20a2=_0x27b40e;}),_0x3c5d54=_0x4b20a2>0x0?_0x4b20a2:0x78;}else _0x3c5d54=_0x39e323[_0xae6282]||0x3c;const _0x5ccefb=new Date(_0x46e196-_0x3c5d54*0xea60);_0x2f1ea0['push']({'eventTime':_0x46e196,'triggerTime':_0x5ccefb[_0x527dd3(0xf9)](),'room':_0xae6282,'minutes':_0x3c5d54,'reason':_0x3f04b5,'isGlobal':_0x34f65a});});}}catch(_0x319e93){}_0x2f1ea0[_0xf10a7a(0x10c)]((_0x51e050,_0x4aa728)=>_0x51e050[_0xf10a7a(0x162)]-_0x4aa728['triggerTime']);const _0x169b2d=_0x2f1ea0[_0xf10a7a(0x10f)](0x0,0x5);await _0x162bea['setStateAsync'](_0xf10a7a(0xf3),{'val':JSON['stringify'](_0x169b2d),'ack':!![]});}async function checkCalendarTriggers(_0x4d8721){const _0x26bea7=a1_0xa8ae40;if(!_0x4d8721[_0x26bea7(0x11b)][_0x26bea7(0xe6)]||!_0x4d8721[_0x26bea7(0x11b)][_0x26bea7(0x152)])return;await updateSchedulePreview(_0x4d8721);let _0x189ceb={},_0x3a0b77={};try{const _0x159132=await _0x4d8721[_0x26bea7(0xd1)]('analysis.energy.warmupTimes');if(_0x159132&&_0x159132[_0x26bea7(0x189)])_0x189ceb=JSON['parse'](_0x159132[_0x26bea7(0x189)]);const _0x1e0985=await _0x4d8721[_0x26bea7(0xd1)](_0x26bea7(0x131));if(_0x1e0985&&_0x1e0985[_0x26bea7(0x189)])_0x3a0b77=JSON[_0x26bea7(0x143)](_0x1e0985[_0x26bea7(0x189)]);}catch(_0x17a6a1){}let _0x4b5199={'default':0x15};try{const _0x25f227=await _0x4d8721[_0x26bea7(0xd1)](_0x26bea7(0xf2));if(_0x25f227&&_0x25f227[_0x26bea7(0x189)])_0x4b5199=JSON[_0x26bea7(0x143)](_0x25f227[_0x26bea7(0x189)]);}catch(_0x51c7da){}try{const _0x183a2a=await _0x4d8721[_0x26bea7(0x137)](_0x4d8721[_0x26bea7(0x11b)][_0x26bea7(0x152)]+_0x26bea7(0x10d));if(!_0x183a2a||!_0x183a2a[_0x26bea7(0x189)])return;const _0x429be2=JSON['parse'](_0x183a2a[_0x26bea7(0x189)]),_0x3d72c5=Date[_0x26bea7(0xed)](),_0x582390=_0x4d8721[_0x26bea7(0x11b)][_0x26bea7(0x13f)]||[],_0x39d1a=_0x4d8721[_0x26bea7(0x11b)][_0x26bea7(0x168)]||[];for(const _0x52f259 of _0x429be2){if(_0x52f259[_0x26bea7(0xe2)]&&_0x39d1a['length']>0x0&&!_0x39d1a[_0x26bea7(0x163)](_0x52f259[_0x26bea7(0xe2)]))continue;const _0x22f634=_0x52f259[_0x26bea7(0x12d)]||_0x52f259[_0x26bea7(0x154)]||_0x52f259[_0x26bea7(0x15e)];if(!_0x22f634)continue;const _0x3c6219=new Date(_0x22f634);if(isNaN(_0x3c6219[_0x26bea7(0xf9)]()))continue;const _0x245514=(_0x52f259['event']||_0x52f259[_0x26bea7(0xda)]||'')[_0x26bea7(0x103)]();if(_0x245514['includes']('urlaub\x20ende')||_0x245514[_0x26bea7(0x163)](_0x26bea7(0xf6))||_0x245514[_0x26bea7(0x163)](_0x26bea7(0x17c))){let _0x548e54=0x0;Object['values'](_0x189ceb)[_0x26bea7(0x16e)](_0x59d57d=>{if(_0x59d57d>_0x548e54)_0x548e54=_0x59d57d;});if(_0x548e54===0x0)_0x548e54=0x78;const _0x3c051d=_0x3c6219[_0x26bea7(0xf9)]()-_0x548e54*0xea60;_0x3d72c5>=_0x3c051d&&_0x3d72c5<_0x3c6219[_0x26bea7(0xf9)]()&&(_0x4d8721['currentSystemMode']!=='normal'&&(_0x4d8721[_0x26bea7(0x133)][_0x26bea7(0x177)](_0x26bea7(0x156)+_0x548e54+_0x26bea7(0x100)),await _0x4d8721[_0x26bea7(0x13d)](_0x26bea7(0x11c),{'val':_0x26bea7(0x15a),'ack':![]})));}for(const _0x186741 of _0x582390){if(_0x186741[_0x26bea7(0x158)]){const _0x380081=_0x186741[_0x26bea7(0x158)]['toLowerCase']();if(_0x245514[_0x26bea7(0x163)](_0x380081)){const _0x349b9a=_0x189ceb[_0x186741[_0x26bea7(0x158)]]||0x3c,_0x3ee883=_0x3a0b77[_0x186741[_0x26bea7(0x158)]]||_0x26bea7(0xd4),_0xeee4e5=_0x3c6219[_0x26bea7(0xf9)]()-_0x349b9a*0xea60;if(_0x3d72c5>=_0xeee4e5&&_0x3d72c5<_0x3c6219[_0x26bea7(0xf9)]()){const _0x5c116c=lastActions[_0x26bea7(0x14f)+_0x186741['location']];if(_0x5c116c&&_0x3d72c5-_0x5c116c<CAL_COOLDOWN_MS)continue;const _0x11eece=await findRelatedId(_0x4d8721,_0x186741['id'],_0x26bea7(0x128));if(_0x11eece){let _0x5cc7e5=_0x4b5199[_0x186741[_0x26bea7(0x158)]];if(_0x5cc7e5===undefined)_0x5cc7e5=_0x4b5199[_0x26bea7(0xeb)];if(_0x5cc7e5===undefined)_0x5cc7e5=0x15;const _0x7450d9=await _0x4d8721[_0x26bea7(0x137)](_0x11eece);_0x7450d9&&typeof _0x7450d9['val']===_0x26bea7(0x12b)&&_0x7450d9[_0x26bea7(0x189)]<_0x5cc7e5-0.5&&(_0x4d8721[_0x26bea7(0x133)]['info'](_0x26bea7(0x155)+_0x3ee883+_0x26bea7(0xfd)+_0x186741[_0x26bea7(0x158)]+'\x27\x20aktiv.\x20Heize\x20auf\x20'+_0x5cc7e5+_0x26bea7(0x138)+_0x349b9a+'\x20min).'),await _0x4d8721['setForeignStateAsync'](_0x11eece,_0x5cc7e5),await logAutomationAction(_0x4d8721,_0x26bea7(0x130)+_0x186741[_0x26bea7(0x158)]+_0x26bea7(0x116)+_0x5cc7e5+_0x26bea7(0x150)+_0x3ee883+')'),lastActions['cal_'+_0x186741[_0x26bea7(0x158)]]=_0x3d72c5);}}}}}}}catch(_0x474c34){_0x4d8721['log']['warn'](_0x26bea7(0x13e)+_0x474c34['message']);}}async function manageMpcIntervention(_0x5798a9,_0x1df78e,_0x378d56){const _0x312ad6=a1_0xa8ae40;try{const _0x3961fd=_0x312ad6(0x16b),_0x215eca=await _0x5798a9[_0x312ad6(0xd1)](_0x3961fd);let _0x256d21=[];if(_0x215eca&&_0x215eca[_0x312ad6(0x189)])try{_0x256d21=JSON[_0x312ad6(0x143)](_0x215eca['val']);}catch(_0x3bdd6b){}const _0x43b523=_0x256d21[_0x312ad6(0xf7)](_0x1df78e);if(_0x378d56===_0x312ad6(0x178))_0x43b523===-0x1&&(_0x256d21[_0x312ad6(0x166)](_0x1df78e),await _0x5798a9['setStateAsync'](_0x3961fd,{'val':JSON[_0x312ad6(0x139)](_0x256d21),'ack':!![]}));else _0x378d56===_0x312ad6(0xfa)&&(_0x43b523!==-0x1&&(_0x256d21[_0x312ad6(0x135)](_0x43b523,0x1),await _0x5798a9['setStateAsync'](_0x3961fd,{'val':JSON['stringify'](_0x256d21),'ack':!![]})));}catch(_0x5d2e89){}}async function cleanupGhostInterventions(_0x37067c){const _0x432a9c=a1_0xa8ae40;try{const _0x14b7b4=_0x432a9c(0x16b),_0x7f1710=await _0x37067c[_0x432a9c(0xd1)](_0x14b7b4);if(!_0x7f1710||!_0x7f1710[_0x432a9c(0x189)])return;const _0x201aa4=JSON[_0x432a9c(0x143)](_0x7f1710[_0x432a9c(0x189)]);if(!Array['isArray'](_0x201aa4)||_0x201aa4[_0x432a9c(0x121)]===0x0)return;let _0x2c4f5e={'default':0x15};try{const _0x5e6484=await _0x37067c[_0x432a9c(0xd1)](_0x432a9c(0xf2));if(_0x5e6484&&_0x5e6484[_0x432a9c(0x189)])_0x2c4f5e=JSON[_0x432a9c(0x143)](_0x5e6484[_0x432a9c(0x189)]);}catch(_0x14cfa9){}let _0x3e82cc=[];try{const _0x3b9842=await _0x37067c[_0x432a9c(0xd1)](_0x432a9c(0x184));if(_0x3b9842&&_0x3b9842['val'])_0x3e82cc=JSON['parse'](_0x3b9842[_0x432a9c(0x189)]);}catch(_0x34602d){}const _0x12eec2=_0x37067c[_0x432a9c(0x11b)][_0x432a9c(0x13f)]||[];let _0x221382=![];for(let _0xf2be12=_0x201aa4[_0x432a9c(0x121)]-0x1;_0xf2be12>=0x0;_0xf2be12--){const _0x3b80fd=_0x201aa4[_0xf2be12],_0x179097=_0x12eec2[_0x432a9c(0x12e)](_0x313897=>normalize(_0x313897['location'])===normalize(_0x3b80fd)&&(_0x313897[_0x432a9c(0x127)]===_0x432a9c(0x126)||_0x313897[_0x432a9c(0x127)]===_0x432a9c(0x134)));if(!_0x179097){_0x37067c[_0x432a9c(0x133)][_0x432a9c(0x169)](_0x432a9c(0xf5)+_0x3b80fd+_0x432a9c(0xef)),_0x201aa4[_0x432a9c(0x135)](_0xf2be12,0x1),_0x221382=!![];continue;}if(_0x179097){const _0x2f9cf4=await findRelatedId(_0x37067c,_0x179097['id'],_0x432a9c(0x128)),_0x9c2851=await _0x37067c[_0x432a9c(0x137)](_0x179097['id']);if(_0x2f9cf4){const _0x203d4c=await _0x37067c[_0x432a9c(0x137)](_0x2f9cf4);if(_0x203d4c&&typeof _0x203d4c[_0x432a9c(0x189)]===_0x432a9c(0x12b)){let _0x4d50a7=![],_0x5cb4f8='';Math['abs'](_0x203d4c[_0x432a9c(0x189)]-ECO_TEMP)>0.5&&(_0x4d50a7=!![],_0x5cb4f8=_0x432a9c(0x129));if(!_0x4d50a7&&_0x9c2851&&typeof _0x9c2851[_0x432a9c(0x189)]===_0x432a9c(0x12b)){const _0x2e78d7=_0x2c4f5e[_0x3b80fd]||_0x2c4f5e['default']||0x15;_0x9c2851[_0x432a9c(0x189)]<_0x2e78d7+0.2&&(_0x4d50a7=!![],_0x5cb4f8='too_cold');}if(_0x4d50a7){if(_0x5cb4f8===_0x432a9c(0x129)){_0x37067c[_0x432a9c(0x133)][_0x432a9c(0x177)](_0x432a9c(0x164)+_0x3b80fd+_0x432a9c(0x176)+_0x203d4c[_0x432a9c(0x189)]+_0x432a9c(0x15f)+ECO_TEMP+_0x432a9c(0x14b));const _0x3cc45a=lastActions[_0x432a9c(0x14f)+_0x3b80fd],_0x5d4bca=_0x3cc45a&&Date[_0x432a9c(0xed)]()-_0x3cc45a<0x2*0x3c*0x3e8;if(!_0x5d4bca&&_0x203d4c['val']>ECO_TEMP+0.5)_0x37067c[_0x432a9c(0xfc)]&&(_0x37067c[_0x432a9c(0x133)][_0x432a9c(0x177)](_0x432a9c(0x13c)+_0x3b80fd+_0x432a9c(0x117)),_0x37067c[_0x432a9c(0xfc)](_0x432a9c(0x102),{'room':_0x3b80fd}));else _0x5d4bca&&_0x37067c[_0x432a9c(0x133)][_0x432a9c(0x177)](_0x432a9c(0xdb)+_0x3b80fd+_0x432a9c(0xd8));}else{if(_0x5cb4f8==='too_cold'){let _0x2beab6=![];if(_0x3e82cc[_0x432a9c(0x12e)](_0xd3eed8=>_0xd3eed8['room']===_0x3b80fd))_0x2beab6=!![];const _0x26b0ef=_0x12eec2[_0x432a9c(0x124)](_0x318f10=>normalize(_0x318f10[_0x432a9c(0x158)])===normalize(_0x3b80fd)&&(_0x318f10[_0x432a9c(0x127)]==='window'||_0x318f10[_0x432a9c(0x127)]===_0x432a9c(0x12a)||_0x318f10[_0x432a9c(0x127)]===_0x432a9c(0x145)));for(const _0x392d3a of _0x26b0ef){try{const _0x2be20b=await _0x37067c[_0x432a9c(0x137)](_0x392d3a['id']);if(_0x2be20b&&(_0x2be20b[_0x432a9c(0x189)]===!![]||_0x2be20b[_0x432a9c(0x189)]===0x1||String(_0x2be20b[_0x432a9c(0x189)])[_0x432a9c(0x103)]()===_0x432a9c(0x106)))_0x2beab6=!![];}catch(_0x759218){}}if(_0x2beab6)_0x37067c[_0x432a9c(0x133)][_0x432a9c(0x177)](_0x432a9c(0xd2)+_0x3b80fd+_0x432a9c(0x188));else{const _0x549adb=_0x2c4f5e[_0x3b80fd]||_0x2c4f5e[_0x432a9c(0xeb)]||0x15;_0x37067c['log'][_0x432a9c(0x177)](_0x432a9c(0x144)+_0x3b80fd+_0x432a9c(0x170)+_0x9c2851[_0x432a9c(0x189)]+_0x432a9c(0x15c)+(_0x549adb+0.2)+_0x432a9c(0x182)),await _0x37067c['setForeignStateAsync'](_0x2f9cf4,_0x549adb),await logAutomationAction(_0x37067c,_0x432a9c(0x18c)+_0x3b80fd+_0x432a9c(0x14c)+_0x549adb+'Â°C'),lastActions[_0x432a9c(0x108)+_0x3b80fd]=Date['now']();}}}_0x201aa4[_0x432a9c(0x135)](_0xf2be12,0x1),_0x221382=!![];}}}}}_0x221382&&await _0x37067c[_0x432a9c(0x13d)](_0x14b7b4,{'val':JSON['stringify'](_0x201aa4),'ack':!![]});}catch(_0xa9e22){}}async function applyEnergySavings(_0x49918d,_0x51a353){const _0x54bd48=a1_0xa8ae40;await cleanupGhostInterventions(_0x49918d);if(!_0x51a353||_0x51a353[_0x54bd48(0x121)]===0x0)return;const _0x447cdd=_0x49918d['config']['devices']||[],_0x4c3030=Date[_0x54bd48(0xed)]();for(const _0x2f6053 of _0x51a353){const _0x45496a=_0x2f6053[_0x54bd48(0xe8)],_0x67e591=_0x2f6053[_0x54bd48(0xf4)],_0x19e60b=_0x2f6053[_0x54bd48(0x101)]||0x15;if(lastActions[_0x54bd48(0x108)+_0x45496a]&&_0x4c3030-lastActions[_0x54bd48(0x108)+_0x45496a]<RESCUE_LOCK_MS)continue;const _0xa863b7=_0x447cdd[_0x54bd48(0x12e)](_0x2b4c7f=>normalize(_0x2b4c7f['location'])===normalize(_0x45496a)&&(_0x2b4c7f[_0x54bd48(0x127)]===_0x54bd48(0x126)||_0x2b4c7f[_0x54bd48(0x127)]===_0x54bd48(0x134)));if(!_0xa863b7)continue;const _0x4a9044=await findRelatedId(_0x49918d,_0xa863b7['id'],_0x54bd48(0x128));if(_0x4a9044){if(lastActions['mpc_'+_0x45496a]&&_0x4c3030-lastActions[_0x54bd48(0x185)+_0x45496a]<0x1e*0x3c*0x3e8)continue;const _0x493bd1=await _0x49918d[_0x54bd48(0x137)](_0x4a9044);if(_0x493bd1&&typeof _0x493bd1[_0x54bd48(0x189)]==='number'){const _0x38597b=_0x493bd1[_0x54bd48(0x189)];_0x38597b!==ECO_TEMP&&await manageMpcIntervention(_0x49918d,_0x45496a,_0x54bd48(0xfa));if(_0x67e591>0x1e)_0x38597b>ECO_TEMP+0.5&&(_0x49918d[_0x54bd48(0x133)]['info'](_0x54bd48(0x16f)+_0x45496a+_0x54bd48(0x151)+ECO_TEMP+_0x54bd48(0x179)+_0x67e591+_0x54bd48(0x165)),await _0x49918d[_0x54bd48(0xf1)](_0x4a9044,ECO_TEMP),await manageMpcIntervention(_0x49918d,_0x45496a,_0x54bd48(0x178)),lastActions[_0x54bd48(0x185)+_0x45496a]=_0x4c3030,await logAutomationAction(_0x49918d,_0x54bd48(0x123)+_0x45496a+_0x54bd48(0x13b)+ECO_TEMP+'Â°C'));else _0x67e591<=0xf&&(_0x38597b<_0x19e60b&&(_0x49918d[_0x54bd48(0x133)][_0x54bd48(0x177)](_0x54bd48(0x148)+_0x45496a+_0x54bd48(0x132)+_0x19e60b+_0x54bd48(0x17a)),await _0x49918d['setForeignStateAsync'](_0x4a9044,_0x19e60b),await manageMpcIntervention(_0x49918d,_0x45496a,'remove'),lastActions['mpc_'+_0x45496a]=_0x4c3030,await logAutomationAction(_0x49918d,_0x54bd48(0x123)+_0x45496a+_0x54bd48(0x112)+_0x19e60b+'Â°C')));}}else _0x49918d[_0x54bd48(0x133)][_0x54bd48(0x169)](_0x54bd48(0xd0)+_0x45496a+_0x54bd48(0x17f));}}module[a1_0xa8ae40(0x147)]={'handlePrediction':handlePrediction,'applyEnergySavings':applyEnergySavings,'scanThermostats':scanThermostats,'checkCalendarTriggers':checkCalendarTriggers,'updateSchedulePreview':updateSchedulePreview,'cleanupGhostInterventions':cleanupGhostInterventions};