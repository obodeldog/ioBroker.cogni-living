const a1_0x5a59e4=a1_0x5cb4;(function(_0x10633a,_0x53b3e3){const _0x47c85c=a1_0x5cb4,_0x57bc19=_0x10633a();while(!![]){try{const _0x2750ef=-parseInt(_0x47c85c(0x111))/0x1*(-parseInt(_0x47c85c(0xdd))/0x2)+parseInt(_0x47c85c(0x10e))/0x3+-parseInt(_0x47c85c(0x124))/0x4*(parseInt(_0x47c85c(0x105))/0x5)+parseInt(_0x47c85c(0xce))/0x6+parseInt(_0x47c85c(0xcb))/0x7+-parseInt(_0x47c85c(0x12d))/0x8+-parseInt(_0x47c85c(0xf6))/0x9;if(_0x2750ef===_0x53b3e3)break;else _0x57bc19['push'](_0x57bc19['shift']());}catch(_0x594563){_0x57bc19['push'](_0x57bc19['shift']());}}}(a1_0x53a0,0x1f5a8));const a1_0x398418=(function(){let _0x4d1f1c=!![];return function(_0x244c56,_0x114dd0){const _0x5a6402=_0x4d1f1c?function(){const _0x2b2a2b=a1_0x5cb4;if(_0x114dd0){const _0x1ab702=_0x114dd0[_0x2b2a2b(0x109)](_0x244c56,arguments);return _0x114dd0=null,_0x1ab702;}}:function(){};return _0x4d1f1c=![],_0x5a6402;};}()),a1_0x1a8117=a1_0x398418(this,function(){const _0x58e74f=a1_0x5cb4;return a1_0x1a8117[_0x58e74f(0x12e)]()[_0x58e74f(0xe4)](_0x58e74f(0xf3))[_0x58e74f(0x12e)]()['constructor'](a1_0x1a8117)[_0x58e74f(0xe4)](_0x58e74f(0xf3));});function a1_0x53a0(){const _0x45d616=['approved','\x20->\x20Schalte\x20','reason','getStateAsync','search','üìÖ\x20SMART\x20SCHEDULE:\x20\x27Globaler\x20Start\x27\x20erkannt\x20(','wert','PERFECT','valveMapping','level','room','pi_heating_demand','getForeignObjectAsync','analysis.automation.confidenceThreshold','unit','getForeignStateAsync','location','valve','val','(((.+)+)+)+$','sensor','log','1485594WDwbze','toLowerCase','warn','minutes_safe','push','target_temperature','level.valve','r√ºckkehr','sort','summary','temperature','\x20min).','analysis.automation.mode','replace','level.temperature','1185PHtjLt','state','setpoint','.1.LEVEL','apply','Ist','üìÖ\x20SMART\x20SCHEDULE:\x20Raum-Trigger\x20\x27','Calendar\x20Check\x20Error:\x20','position','93243WNzWTP','[CAL]\x20','\x27\x20erkannt\x20(','2bgYoOY','consultButler','exports','normal','setStateAsync','eventStart','active','name','Auto-Erkennung','./ai_agent','string','off','forEach','role','SET_POINT_TEMPERATURE','useCalendar','valve_position','localeCompare','¬∞C\x20(Coasting\x20m√∂glich:\x20','92wlPiWf',')\x20auf\x20','[MPC]\x20','.1.ACTUAL_TEMPERATURE','getTime','thermostat','event','values','occupied_heating_setpoint','99152vRcTgm','toString','config','Fehlt','.1.SET_POINT_TEMPERATURE','ACTUAL_TEMPERATURE','common','set','trim','.4.VALVE_STATE','analysis.automation.lastAction','.4.SET_TEMPERATURE','slice','devices','type','local_temperature','info','join','current_heating_setpoint','mpc_','split','parse','750946DPRwFC','setForeignStateAsync','ACTUAL','915804rmsHzs','Nicht\x20gefunden','includes','number','message','switch','length','score','.1.TEMPERATURE','find','thermostatMapping',').\x20Heize\x20ganzes\x20Haus\x20auf\x20(Vorlauf:\x20','üîç\x20Device-Search\x20failed\x20for\x20predicted\x20room\x20\x27','calendarInstance','toUpperCase','20342LyuBNi','openknx','light'];a1_0x53a0=function(){return _0x45d616;};return a1_0x53a0();}a1_0x1a8117();'use strict';const aiAgent=require(a1_0x5a59e4(0x11a)),COOLDOWN_MS=0x3c*0x3e8,lastActions={};function a1_0x5cb4(_0x14573e,_0x2bbdb5){const _0x278851=a1_0x53a0();return a1_0x5cb4=function(_0x1a8117,_0x398418){_0x1a8117=_0x1a8117-0xc1;let _0x53a0e1=_0x278851[_0x1a8117];return _0x53a0e1;},a1_0x5cb4(_0x14573e,_0x2bbdb5);}function normalize(_0x22a883){const _0x2adeb6=a1_0x5a59e4;if(!_0x22a883)return'';return _0x22a883[_0x2adeb6(0xf7)]()['replace'](/\s+/g,'')[_0x2adeb6(0x135)]();}async function handlePrediction(_0x1825f7,_0x584fa9,_0xb5e88d){const _0x20aea7=a1_0x5a59e4;if(!_0x584fa9||_0x584fa9==='Unknown')return;let _0x1eb946=_0x20aea7(0x11c),_0x38144c=0.6;try{const _0x20cf94=await _0x1825f7[_0x20aea7(0xe3)](_0x20aea7(0x102));if(_0x20cf94&&_0x20cf94[_0x20aea7(0xf2)])_0x1eb946=_0x20cf94[_0x20aea7(0xf2)];const _0x1f8ddd=await _0x1825f7[_0x20aea7(0xe3)](_0x20aea7(0xed));if(_0x1f8ddd&&_0x1f8ddd[_0x20aea7(0xf2)])_0x38144c=_0x1f8ddd[_0x20aea7(0xf2)];}catch(_0x55e203){}if(_0x1eb946===_0x20aea7(0x11c)||_0xb5e88d<_0x38144c)return;const _0x457bfb=Date['now']();if(lastActions[_0x584fa9]&&_0x457bfb-lastActions[_0x584fa9]<COOLDOWN_MS)return;const _0x467ea5=_0x1825f7[_0x20aea7(0x12f)][_0x20aea7(0xc2)]||[],_0x3e607a=normalize(_0x584fa9),_0xfb4841=_0x467ea5[_0x20aea7(0xd7)](_0x3ba03b=>normalize(_0x3ba03b[_0x20aea7(0xf0)])===_0x3e607a&&(_0x3ba03b['type']===_0x20aea7(0xdf)||_0x3ba03b[_0x20aea7(0xc3)]==='dimmer'||_0x3ba03b['type']===_0x20aea7(0xd3)));if(!_0xfb4841){_0x1825f7[_0x20aea7(0xf5)]['debug'](_0x20aea7(0xda)+_0x584fa9+'\x27.');return;}const _0x818fbf=await aiAgent[_0x20aea7(0x112)](_0x1825f7,_0x584fa9,_0xfb4841[_0x20aea7(0x118)],_0xb5e88d);if(!_0x818fbf[_0x20aea7(0xe0)])return;const _0x5be7f2='Pr√§diktion:\x20'+_0x584fa9+_0x20aea7(0xe1)+_0xfb4841[_0x20aea7(0x118)]+'\x20('+_0x818fbf[_0x20aea7(0xe2)]+')';await _0x1825f7[_0x20aea7(0x115)](_0x20aea7(0x137),{'val':'['+_0x1eb946[_0x20aea7(0xdc)]()+']\x20'+_0x5be7f2,'ack':!![]});if(_0x1eb946===_0x20aea7(0x117)){const _0x2084cb=await _0x1825f7[_0x20aea7(0xef)](_0xfb4841['id']);(!_0x2084cb||!_0x2084cb['val']&&_0x2084cb[_0x20aea7(0xf2)]!==!![])&&await _0x1825f7['setForeignStateAsync'](_0xfb4841['id'],!![]),lastActions[_0x584fa9]=_0x457bfb;}}async function findRelatedId(_0x51ea6c,_0x556a8f,_0xa3ef1f='setpoint'){const _0x4c950c=a1_0x5a59e4;if(_0xa3ef1f===_0x4c950c(0x107)&&_0x51ea6c[_0x4c950c(0x12f)][_0x4c950c(0xd8)]){let _0x527e7e=_0x51ea6c['config'][_0x4c950c(0xd8)];if(typeof _0x527e7e===_0x4c950c(0x11b))try{_0x527e7e=JSON[_0x4c950c(0xca)](_0x527e7e);}catch(_0x260e43){}if(_0x527e7e&&_0x527e7e[_0x556a8f])return _0x527e7e[_0x556a8f];}if(_0xa3ef1f===_0x4c950c(0xf1)&&_0x51ea6c['config'][_0x4c950c(0xe8)]){let _0x3c733a=_0x51ea6c[_0x4c950c(0x12f)][_0x4c950c(0xe8)];if(typeof _0x3c733a===_0x4c950c(0x11b))try{_0x3c733a=JSON[_0x4c950c(0xca)](_0x3c733a);}catch(_0x15cfea){}if(_0x3c733a&&_0x3c733a[_0x556a8f])return _0x3c733a[_0x556a8f];}let _0x374dcc=[];if(_0xa3ef1f===_0x4c950c(0x107))_0x374dcc=[{'s':'.1.ACTUAL_TEMPERATURE','t':_0x4c950c(0x131)},{'s':'.1.TEMPERATURE','t':_0x4c950c(0x131)},{'s':_0x4c950c(0xd6),'t':_0x4c950c(0x138)},{'s':_0x4c950c(0x132),'t':_0x4c950c(0x11f)},{'s':_0x4c950c(0xc4),'t':_0x4c950c(0x12c)},{'s':'local_temperature','t':_0x4c950c(0xc7)},{'s':'temperature','t':_0x4c950c(0xfb)},{'s':_0x4c950c(0xcd),'t':'SET'},{'s':_0x4c950c(0x10a),'t':'Soll'},{'s':_0x4c950c(0x100),'t':'setpoint'}];else _0xa3ef1f===_0x4c950c(0xf1)&&(_0x374dcc=[{'s':_0x4c950c(0x127),'t':_0x4c950c(0x108)},{'s':_0x4c950c(0xd6),'t':_0x4c950c(0x108)},{'s':'.1.TEMPERATURE','t':_0x4c950c(0x136)},{'s':_0x4c950c(0xc4),'t':_0x4c950c(0xeb)},{'s':_0x4c950c(0x100),'t':_0x4c950c(0x121)},{'s':_0x4c950c(0x100),'t':'level'}]);for(const _0x2ef43d of _0x374dcc){if(_0x556a8f['includes'](_0x2ef43d['s'])){const _0x2aeb37=_0x556a8f[_0x4c950c(0x103)](_0x2ef43d['s'],_0x2ef43d['t']),_0xacf520=await _0x51ea6c[_0x4c950c(0xec)](_0x2aeb37);if(_0xacf520)return _0x2aeb37;}}try{const _0x3f45d7=_0x556a8f[_0x4c950c(0xc9)]('.');if(_0x3f45d7[_0x4c950c(0xd4)]>0x2){const _0x2bc6cc=_0x3f45d7[_0x4c950c(0xc1)](0x0,-0x1)[_0x4c950c(0xc6)]('.'),_0x5864c2=await _0x51ea6c['getForeignObjectsAsync'](_0x2bc6cc+'.*'),_0x5aca7c=[],_0x22731b=_0x556a8f[_0x4c950c(0xc9)](/[._]+/)['filter'](_0x4edb92=>![_0x4c950c(0xde),'0','hm-rpc','ist',_0x4c950c(0xe6),'temperature','actual',_0x4c950c(0xf4),'messwert',_0x4c950c(0x106)]['includes'](_0x4edb92[_0x4c950c(0xf7)]()));for(const [_0xcc6515,_0x4997cd]of Object['entries'](_0x5864c2)){if(_0xcc6515===_0x556a8f)continue;if(_0x4997cd&&_0x4997cd[_0x4c950c(0x133)]){const _0x83eb4=_0xcc6515[_0x4c950c(0xf7)](),_0x26e43e=(_0x4997cd[_0x4c950c(0x133)][_0x4c950c(0x11e)]||'')[_0x4c950c(0xf7)](),_0x399894=(_0x4997cd['common'][_0x4c950c(0xee)]||'')[_0x4c950c(0xf7)]();let _0x1828b1=![];if(_0xa3ef1f==='setpoint'&&_0x4997cd[_0x4c950c(0x133)]['write']===!![])_0x1828b1=_0x83eb4['includes'](_0x4c950c(0x134))||_0x83eb4['includes']('soll')||_0x83eb4[_0x4c950c(0xd0)]('target')||_0x26e43e[_0x4c950c(0xd0)](_0x4c950c(0x104))||_0x26e43e['includes']('thermostat.setpoint');else _0xa3ef1f===_0x4c950c(0xf1)&&(_0x1828b1=_0x83eb4['includes'](_0x4c950c(0xe9))||_0x83eb4[_0x4c950c(0xd0)](_0x4c950c(0xf1))||_0x83eb4[_0x4c950c(0xd0)]('stellwert')||_0x83eb4['includes'](_0x4c950c(0x10d))||_0x26e43e[_0x4c950c(0xd0)](_0x4c950c(0xfc))||_0x26e43e['includes']('value.valve')||_0x399894[_0x4c950c(0xd0)]('%'));if(_0x1828b1){const _0x713aae=_0xcc6515[_0x4c950c(0xc9)](/[._]+/)['map'](_0x4423a2=>_0x4423a2[_0x4c950c(0xf7)]());let _0x4dd5f5=0x0;_0x22731b[_0x4c950c(0x11d)](_0x556fb4=>{const _0x3f8362=_0x4c950c;if(_0x713aae['includes'](_0x556fb4[_0x3f8362(0xf7)]()))_0x4dd5f5++;}),_0x5aca7c[_0x4c950c(0xfa)]({'id':_0xcc6515,'score':_0x4dd5f5});}}}if(_0x5aca7c['length']>0x0){_0x5aca7c[_0x4c950c(0xfe)]((_0x13fee7,_0x11d4fe)=>_0x11d4fe[_0x4c950c(0xd5)]-_0x13fee7['score']);if(_0x5aca7c[0x0][_0x4c950c(0xd5)]>0x0)return _0x5aca7c[0x0]['id'];}}}catch(_0x36e3c1){}return null;}async function scanThermostats(_0x4ab6b7){const _0x3c9280=a1_0x5a59e4,_0x1f8361=_0x4ab6b7[_0x3c9280(0x12f)]['devices']||[],_0x293492=[],_0x5ea25a=_0x1f8361['filter'](_0x5cd010=>_0x5cd010['id']&&_0x5cd010['id'][_0x3c9280(0xd0)](_0x3c9280(0x100))||_0x5cd010[_0x3c9280(0xc3)]&&['temperature',_0x3c9280(0x129),'sensor'][_0x3c9280(0xd0)](_0x5cd010[_0x3c9280(0xc3)])||_0x5cd010[_0x3c9280(0x118)]&&_0x5cd010[_0x3c9280(0x118)][_0x3c9280(0xf7)]()['includes']('temp'));for(const _0x25bf74 of _0x5ea25a){const _0x273928=await findRelatedId(_0x4ab6b7,_0x25bf74['id'],'setpoint'),_0x506975=await findRelatedId(_0x4ab6b7,_0x25bf74['id'],_0x3c9280(0xf1));let _0x1fb60d=_0x3c9280(0xcf),_0x516fa9=![],_0x32d412=_0x4ab6b7[_0x3c9280(0x12f)]['thermostatMapping']||{};if(typeof _0x32d412==='string')try{_0x32d412=JSON[_0x3c9280(0xca)](_0x32d412);}catch(_0x383d7f){}let _0x2d919f=_0x4ab6b7[_0x3c9280(0x12f)][_0x3c9280(0xe8)]||{};if(typeof _0x2d919f===_0x3c9280(0x11b))try{_0x2d919f=JSON[_0x3c9280(0xca)](_0x2d919f);}catch(_0x526ee5){}if(_0x32d412[_0x25bf74['id']]&&_0x32d412[_0x25bf74['id']]===_0x273928||_0x2d919f[_0x25bf74['id']]&&_0x2d919f[_0x25bf74['id']]===_0x506975)_0x1fb60d='Manuelles\x20Mapping',_0x516fa9=!![];else(_0x273928||_0x506975)&&(_0x1fb60d=_0x3c9280(0x119));_0x293492[_0x3c9280(0xfa)]({'room':_0x25bf74[_0x3c9280(0xf0)]||'Unbekannt','sensorId':_0x25bf74['id'],'setpointId':_0x273928||'-','valveId':_0x506975||'-','source':_0x1fb60d,'isManual':_0x516fa9,'status':_0x273928&&_0x506975?_0x3c9280(0xe7):_0x273928?'OK':_0x3c9280(0x130)});}return _0x293492[_0x3c9280(0xfe)]((_0x1de541,_0x4bb5af)=>_0x1de541[_0x3c9280(0xea)][_0x3c9280(0x122)](_0x4bb5af[_0x3c9280(0xea)]));}async function checkCalendarTriggers(_0x3034a3){const _0x3e74be=a1_0x5a59e4;if(!_0x3034a3[_0x3e74be(0x12f)][_0x3e74be(0x120)]||!_0x3034a3[_0x3e74be(0x12f)][_0x3e74be(0xdb)])return;let _0x36de3e={};try{const _0x547d66=await _0x3034a3[_0x3e74be(0xe3)]('analysis.energy.warmupTimes');if(_0x547d66&&_0x547d66[_0x3e74be(0xf2)])_0x36de3e=JSON['parse'](_0x547d66[_0x3e74be(0xf2)]);}catch(_0x2e6437){}try{const _0x3ebf24=await _0x3034a3[_0x3e74be(0xef)](_0x3034a3[_0x3e74be(0x12f)]['calendarInstance']+'.data.table');if(!_0x3ebf24||!_0x3ebf24[_0x3e74be(0xf2)])return;const _0x288086=JSON[_0x3e74be(0xca)](_0x3ebf24[_0x3e74be(0xf2)]),_0xaa3022=new Date(),_0x125089=_0x3034a3[_0x3e74be(0x12f)][_0x3e74be(0xc2)]||[],_0x23120e=_0x3034a3[_0x3e74be(0x12f)]['calendarSelection']||[];for(const _0x5577eb of _0x288086){if(_0x5577eb['_calName']&&_0x23120e[_0x3e74be(0xd4)]>0x0&&!_0x23120e[_0x3e74be(0xd0)](_0x5577eb['_calName']))continue;const _0xe58c2b=new Date(_0x5577eb[_0x3e74be(0x116)]),_0x4ad5c2=(_0x5577eb[_0x3e74be(0x12a)]||_0x5577eb[_0x3e74be(0xff)]||'')[_0x3e74be(0xf7)]();if(_0x4ad5c2['includes']('urlaub\x20ende')||_0x4ad5c2['includes'](_0x3e74be(0xfd))||_0x4ad5c2[_0x3e74be(0xd0)]('ankunft')){let _0x5e4ef0=0x0;Object[_0x3e74be(0x12b)](_0x36de3e)[_0x3e74be(0x11d)](_0x23478e=>{if(_0x23478e>_0x5e4ef0)_0x5e4ef0=_0x23478e;});if(_0x5e4ef0===0x0)_0x5e4ef0=0x78;const _0x217476=new Date(_0xe58c2b[_0x3e74be(0x128)]()-_0x5e4ef0*0xea60),_0x1fd73c=_0xaa3022['getTime']()-_0x217476[_0x3e74be(0x128)]();_0x1fd73c>=0x0&&_0x1fd73c<0xf*0xea60&&(_0x3034a3[_0x3e74be(0xf5)][_0x3e74be(0xc5)](_0x3e74be(0xe5)+_0x5577eb['event']+_0x3e74be(0xd9)+_0x5e4ef0+'\x20min).'),await _0x3034a3['setStateAsync']('system.mode',{'val':_0x3e74be(0x114),'ack':![]}));}for(const _0x3578f3 of _0x125089){if(_0x3578f3[_0x3e74be(0xf0)]){const _0x327ac3=_0x3578f3['location'][_0x3e74be(0xf7)]();if(_0x4ad5c2[_0x3e74be(0xd0)](_0x327ac3)){const _0x38e7a5=_0x36de3e[_0x3578f3[_0x3e74be(0xf0)]]||0x3c,_0x2465d7=new Date(_0xe58c2b['getTime']()-_0x38e7a5*0xea60),_0x85af1f=_0xaa3022[_0x3e74be(0x128)]()-_0x2465d7[_0x3e74be(0x128)]();if(_0x85af1f>=0x0&&_0x85af1f<0xf*0xea60){const _0x137413=await findRelatedId(_0x3034a3,_0x3578f3['id'],_0x3e74be(0x107));_0x137413&&(_0x3034a3[_0x3e74be(0xf5)]['info'](_0x3e74be(0x10b)+_0x3578f3[_0x3e74be(0xf0)]+_0x3e74be(0x110)+_0x5577eb[_0x3e74be(0x12a)]+').\x20Heize\x20auf\x2021¬∞C\x20(Vorlauf:\x20'+_0x38e7a5+_0x3e74be(0x101)),await _0x3034a3[_0x3e74be(0xcc)](_0x137413,0x15),await _0x3034a3[_0x3e74be(0x115)](_0x3e74be(0x137),{'val':_0x3e74be(0x10f)+_0x3578f3[_0x3e74be(0xf0)]+'\x20->\x2021¬∞C','ack':!![]}));}}}}}}catch(_0x1d64be){_0x3034a3['log'][_0x3e74be(0xf8)](_0x3e74be(0x10c)+_0x1d64be[_0x3e74be(0xd2)]);}}async function applyEnergySavings(_0x174bd2,_0x2aa680){const _0x19578e=a1_0x5a59e4,_0x1741d3=_0x174bd2[_0x19578e(0x12f)][_0x19578e(0xc2)]||[];for(const _0x1d3e8d of _0x2aa680){const _0x4ad058=_0x1d3e8d[_0x19578e(0xea)],_0x44964a=_0x1d3e8d[_0x19578e(0xf9)],_0x531652=Date['now']();if(lastActions['mpc_'+_0x4ad058]&&_0x531652-lastActions[_0x19578e(0xc8)+_0x4ad058]<0x1e*0x3c*0x3e8)continue;const _0x3e5e44=_0x1741d3[_0x19578e(0xd7)](_0x29929e=>normalize(_0x29929e[_0x19578e(0xf0)])===normalize(_0x4ad058));if(!_0x3e5e44)continue;const _0x3bdd9a=await findRelatedId(_0x174bd2,_0x3e5e44['id'],_0x19578e(0x107));if(_0x3bdd9a){const _0x3dbea2=await _0x174bd2['getForeignStateAsync'](_0x3bdd9a);if(_0x3dbea2&&typeof _0x3dbea2[_0x19578e(0xf2)]===_0x19578e(0xd1)){const _0x553a3b=_0x3dbea2['val'];if(_0x44964a>0x1e&&_0x553a3b>0x11){const _0x26ea76=_0x553a3b-0x1;_0x174bd2[_0x19578e(0xf5)][_0x19578e(0xc5)]('üçÉ\x20MPC\x20Autonomy:\x20Senke\x20'+_0x4ad058+'\x20('+_0x3bdd9a+_0x19578e(0x125)+_0x26ea76+_0x19578e(0x123)+_0x44964a+'\x20min)'),await _0x174bd2[_0x19578e(0xcc)](_0x3bdd9a,_0x26ea76),lastActions[_0x19578e(0xc8)+_0x4ad058]=_0x531652,await _0x174bd2[_0x19578e(0x115)](_0x19578e(0x137),{'val':_0x19578e(0x126)+_0x4ad058+':\x20-1¬∞C\x20(Sparpotenzial\x20genutzt)','ack':!![]});}}}}}module[a1_0x5a59e4(0x113)]={'handlePrediction':handlePrediction,'applyEnergySavings':applyEnergySavings,'scanThermostats':scanThermostats,'checkCalendarTriggers':checkCalendarTriggers};