const a1_0x5127a6=a1_0x385e;(function(_0x269a1c,_0x25c1c7){const _0xe0b968=a1_0x385e,_0x3d7799=_0x269a1c();while(!![]){try{const _0xf5fe7a=parseInt(_0xe0b968(0x1f6))/0x1+-parseInt(_0xe0b968(0x17c))/0x2+-parseInt(_0xe0b968(0x1aa))/0x3*(parseInt(_0xe0b968(0x16d))/0x4)+parseInt(_0xe0b968(0x199))/0x5+-parseInt(_0xe0b968(0x162))/0x6*(-parseInt(_0xe0b968(0x161))/0x7)+-parseInt(_0xe0b968(0x207))/0x8+parseInt(_0xe0b968(0x1f4))/0x9*(parseInt(_0xe0b968(0x179))/0xa);if(_0xf5fe7a===_0x25c1c7)break;else _0x3d7799['push'](_0x3d7799['shift']());}catch(_0x3e19c8){_0x3d7799['push'](_0x3d7799['shift']());}}}(a1_0x5989,0x5de93));const a1_0x11f36e=(function(){let _0xeddf7b=!![];return function(_0x53a0f3,_0x1c9426){const _0xfabf29=_0xeddf7b?function(){if(_0x1c9426){const _0x185c17=_0x1c9426['apply'](_0x53a0f3,arguments);return _0x1c9426=null,_0x185c17;}}:function(){};return _0xeddf7b=![],_0xfabf29;};}()),a1_0x21ba09=a1_0x11f36e(this,function(){const _0x5a9857=a1_0x385e;return a1_0x21ba09[_0x5a9857(0x1cd)]()[_0x5a9857(0x1d1)](_0x5a9857(0x166))[_0x5a9857(0x1cd)]()[_0x5a9857(0x1df)](a1_0x21ba09)[_0x5a9857(0x1d1)](_0x5a9857(0x166));});a1_0x21ba09();'use strict';const aiAgent=require(a1_0x5127a6(0x178)),COOLDOWN_MS=0x3c*0x3e8,CAL_COOLDOWN_MS=0x5a*0x3c*0x3e8,RESCUE_LOCK_MS=0x78*0x3c*0x3e8,ECO_TEMP=0x11,lastActions={};function normalize(_0x43176e){const _0x315f90=a1_0x5127a6;if(!_0x43176e)return'';return _0x43176e[_0x315f90(0x216)]()[_0x315f90(0x1a4)](/\s+/g,'')[_0x315f90(0x1ca)]();}async function logAutomationAction(_0x448ea6,_0x149383){const _0x4459cf=a1_0x5127a6;await _0x448ea6['setStateAsync'](_0x4459cf(0x1b4),{'val':_0x149383,'ack':!![]});try{const _0x30420d=_0x4459cf(0x194),_0x5ddc7a=await _0x448ea6['getStateAsync'](_0x30420d);let _0xc42eea=[];if(_0x5ddc7a&&_0x5ddc7a[_0x4459cf(0x15f)])try{_0xc42eea=JSON[_0x4459cf(0x1c7)](_0x5ddc7a['val']);}catch(_0x80a44c){}_0xc42eea[_0x4459cf(0x16c)]({'ts':Date[_0x4459cf(0x1b2)](),'msg':_0x149383});if(_0xc42eea['length']>0x32)_0xc42eea=_0xc42eea['slice'](0x0,0x32);await _0x448ea6[_0x4459cf(0x1b9)](_0x30420d,{'val':JSON[_0x4459cf(0x1ef)](_0xc42eea),'ack':!![]});}catch(_0x497b25){}}async function handlePrediction(_0x2c53a1,_0x2112b9,_0x835f03){const _0x97f66a=a1_0x5127a6;if(!_0x2112b9||_0x2112b9==='Unknown')return;let _0x540d12=_0x97f66a(0x172),_0x315a3e=0.6;try{const _0x175a9e=await _0x2c53a1[_0x97f66a(0x1bf)](_0x97f66a(0x1f1));if(_0x175a9e&&_0x175a9e[_0x97f66a(0x15f)])_0x540d12=_0x175a9e[_0x97f66a(0x15f)];const _0x52b51b=await _0x2c53a1[_0x97f66a(0x1bf)](_0x97f66a(0x219));if(_0x52b51b&&_0x52b51b[_0x97f66a(0x15f)])_0x315a3e=_0x52b51b[_0x97f66a(0x15f)];}catch(_0x505361){}if(_0x540d12===_0x97f66a(0x172)||_0x835f03<_0x315a3e)return;const _0x176e3e=Date['now']();if(lastActions[_0x2112b9]&&_0x176e3e-lastActions[_0x2112b9]<COOLDOWN_MS)return;const _0x585930=_0x2c53a1[_0x97f66a(0x1ad)][_0x97f66a(0x1ed)]||[],_0x9bbc6=normalize(_0x2112b9),_0x413fcd=_0x585930[_0x97f66a(0x195)](_0x21b537=>normalize(_0x21b537[_0x97f66a(0x1c5)])===_0x9bbc6&&(_0x21b537[_0x97f66a(0x17a)]===_0x97f66a(0x20c)||_0x21b537[_0x97f66a(0x17a)]===_0x97f66a(0x160)||_0x21b537['type']===_0x97f66a(0x177)));if(!_0x413fcd)return;const _0x5a1642=await aiAgent[_0x97f66a(0x19f)](_0x2c53a1,_0x2112b9,_0x413fcd[_0x97f66a(0x209)],_0x835f03);if(!_0x5a1642[_0x97f66a(0x214)])return;const _0x168f9b=_0x97f66a(0x197)+_0x2112b9+_0x97f66a(0x1e1)+_0x413fcd[_0x97f66a(0x209)]+'\x20('+_0x5a1642[_0x97f66a(0x206)]+')';await logAutomationAction(_0x2c53a1,'['+_0x540d12[_0x97f66a(0x1e8)]()+']\x20'+_0x168f9b);if(_0x540d12===_0x97f66a(0x1ee)){const _0x1e3553=await _0x2c53a1[_0x97f66a(0x1c0)](_0x413fcd['id']);(!_0x1e3553||!_0x1e3553['val']&&_0x1e3553['val']!==!![])&&await _0x2c53a1['setForeignStateAsync'](_0x413fcd['id'],!![]),lastActions[_0x2112b9]=_0x176e3e;}}async function findRelatedId(_0x4defdf,_0x2190d9,_0x1a7043=a1_0x5127a6(0x19a)){const _0x505e07=a1_0x5127a6;if(_0x1a7043===_0x505e07(0x19a)&&_0x4defdf[_0x505e07(0x1ad)][_0x505e07(0x1c2)]){let _0x3dd9d1=_0x4defdf['config'][_0x505e07(0x1c2)];if(typeof _0x3dd9d1==='string')try{_0x3dd9d1=JSON[_0x505e07(0x1c7)](_0x3dd9d1);}catch(_0x108d90){}if(_0x3dd9d1&&_0x3dd9d1[_0x2190d9])return _0x3dd9d1[_0x2190d9];}if(_0x1a7043===_0x505e07(0x196)&&_0x4defdf[_0x505e07(0x1ad)][_0x505e07(0x1b6)]){let _0x597fcd=_0x4defdf[_0x505e07(0x1ad)]['valveMapping'];if(typeof _0x597fcd===_0x505e07(0x20a))try{_0x597fcd=JSON['parse'](_0x597fcd);}catch(_0xa31ead){}if(_0x597fcd&&_0x597fcd[_0x2190d9])return _0x597fcd[_0x2190d9];}let _0x393c24=[];if(_0x1a7043===_0x505e07(0x19a))_0x393c24=[{'s':_0x505e07(0x203),'t':_0x505e07(0x1a1)},{'s':_0x505e07(0x211),'t':_0x505e07(0x1a1)},{'s':_0x505e07(0x211),'t':_0x505e07(0x1bc)},{'s':_0x505e07(0x1e6),'t':_0x505e07(0x1fa)},{'s':_0x505e07(0x1b7),'t':_0x505e07(0x169)},{'s':_0x505e07(0x1b7),'t':_0x505e07(0x1c4)},{'s':_0x505e07(0x1f2),'t':_0x505e07(0x16f)},{'s':_0x505e07(0x1a7),'t':'SET'},{'s':_0x505e07(0x1b1),'t':_0x505e07(0x174)},{'s':_0x505e07(0x1f2),'t':_0x505e07(0x19a)}];else _0x1a7043==='valve'&&(_0x393c24=[{'s':_0x505e07(0x203),'t':_0x505e07(0x1c6)},{'s':_0x505e07(0x211),'t':'.1.LEVEL'},{'s':_0x505e07(0x211),'t':_0x505e07(0x193)},{'s':_0x505e07(0x1b7),'t':_0x505e07(0x1e5)},{'s':_0x505e07(0x1f2),'t':_0x505e07(0x191)},{'s':_0x505e07(0x1f2),'t':'level'}]);for(const _0xbb1497 of _0x393c24){if(_0x2190d9['includes'](_0xbb1497['s'])){const _0x1e3c46=_0x2190d9['replace'](_0xbb1497['s'],_0xbb1497['t']),_0x5bf728=await _0x4defdf[_0x505e07(0x188)](_0x1e3c46);if(_0x5bf728)return _0x1e3c46;}}try{const _0x31f97c=_0x2190d9[_0x505e07(0x187)]('.');if(_0x31f97c[_0x505e07(0x1ba)]>0x2){const _0x44c5a2=_0x31f97c[_0x505e07(0x202)](0x0,-0x1)[_0x505e07(0x1c9)]('.'),_0x29e462=await _0x4defdf[_0x505e07(0x1ea)](_0x44c5a2+'.*'),_0x5416e8=[],_0x3df686=_0x2190d9['split'](/[._]+/)[_0x505e07(0x1db)](_0x4fa173=>![_0x505e07(0x1e9),'0',_0x505e07(0x1da),_0x505e07(0x1ac),_0x505e07(0x200),_0x505e07(0x1f2),_0x505e07(0x215),'sensor',_0x505e07(0x1bd),_0x505e07(0x1be)]['includes'](_0x4fa173[_0x505e07(0x216)]()));for(const [_0x7cc2b3,_0x544459]of Object[_0x505e07(0x1d8)](_0x29e462)){if(_0x7cc2b3===_0x2190d9)continue;if(_0x544459&&_0x544459[_0x505e07(0x1f7)]){const _0x5f2271=_0x7cc2b3[_0x505e07(0x216)](),_0x3c8184=(_0x544459[_0x505e07(0x1f7)][_0x505e07(0x1e7)]||'')[_0x505e07(0x216)](),_0x59d2c2=(_0x544459[_0x505e07(0x1f7)][_0x505e07(0x1c3)]||'')['toLowerCase']();let _0x316173=![];if(_0x1a7043==='setpoint'&&_0x544459[_0x505e07(0x1f7)][_0x505e07(0x1e2)]===!![])_0x316173=_0x5f2271[_0x505e07(0x17e)](_0x505e07(0x19b))||_0x5f2271[_0x505e07(0x17e)](_0x505e07(0x19d))||_0x5f2271[_0x505e07(0x17e)](_0x505e07(0x16a))||_0x3c8184[_0x505e07(0x17e)](_0x505e07(0x164))||_0x3c8184[_0x505e07(0x17e)]('thermostat.setpoint');else _0x1a7043===_0x505e07(0x196)&&(_0x316173=_0x5f2271[_0x505e07(0x17e)]('level')||_0x5f2271[_0x505e07(0x17e)](_0x505e07(0x196))||_0x5f2271['includes'](_0x505e07(0x1ff))||_0x5f2271[_0x505e07(0x17e)](_0x505e07(0x190))||_0x3c8184['includes']('level.valve')||_0x3c8184['includes'](_0x505e07(0x1ab))||_0x59d2c2[_0x505e07(0x17e)]('%'));if(_0x316173){const _0x1b73a9=_0x7cc2b3[_0x505e07(0x187)](/[._]+/)[_0x505e07(0x17f)](_0x3ae331=>_0x3ae331[_0x505e07(0x216)]());let _0x4116ad=0x0;_0x3df686[_0x505e07(0x1c8)](_0x3b1b82=>{if(_0x1b73a9['includes'](_0x3b1b82['toLowerCase']()))_0x4116ad++;}),_0x5416e8['push']({'id':_0x7cc2b3,'score':_0x4116ad});}}}if(_0x5416e8[_0x505e07(0x1ba)]>0x0){_0x5416e8['sort']((_0x44996a,_0xf9e90d)=>_0xf9e90d[_0x505e07(0x1a8)]-_0x44996a['score']);if(_0x5416e8[0x0]['score']>0x0)return _0x5416e8[0x0]['id'];}}}catch(_0x35dcd7){}return null;}async function scanThermostats(_0x3d0a09){const _0x3853e2=a1_0x5127a6,_0x57798e=_0x3d0a09['config'][_0x3853e2(0x1ed)]||[],_0x4f7c5e=[],_0x28e553=_0x57798e[_0x3853e2(0x1db)](_0x28ae34=>_0x28ae34['id']&&_0x28ae34['id'][_0x3853e2(0x17e)]('temperature')||_0x28ae34[_0x3853e2(0x17a)]&&[_0x3853e2(0x1f2),_0x3853e2(0x1d2),'sensor'][_0x3853e2(0x17e)](_0x28ae34[_0x3853e2(0x17a)])||_0x28ae34[_0x3853e2(0x209)]&&_0x28ae34[_0x3853e2(0x209)]['toLowerCase']()[_0x3853e2(0x17e)]('temp'));for(const _0x4f3a13 of _0x28e553){const _0x305198=await findRelatedId(_0x3d0a09,_0x4f3a13['id'],_0x3853e2(0x19a)),_0x9a0571=await findRelatedId(_0x3d0a09,_0x4f3a13['id'],'valve');let _0x181080=_0x3853e2(0x1a3),_0x5e87da=![],_0x28a723=_0x3d0a09[_0x3853e2(0x1ad)][_0x3853e2(0x1c2)]||{};if(typeof _0x28a723===_0x3853e2(0x20a))try{_0x28a723=JSON[_0x3853e2(0x1c7)](_0x28a723);}catch(_0x2b9b2b){}let _0x480a99=_0x3d0a09['config'][_0x3853e2(0x1b6)]||{};if(typeof _0x480a99===_0x3853e2(0x20a))try{_0x480a99=JSON[_0x3853e2(0x1c7)](_0x480a99);}catch(_0x2dd0cc){}if(_0x28a723[_0x4f3a13['id']]&&_0x28a723[_0x4f3a13['id']]===_0x305198||_0x480a99[_0x4f3a13['id']]&&_0x480a99[_0x4f3a13['id']]===_0x9a0571)_0x181080=_0x3853e2(0x213),_0x5e87da=!![];else(_0x305198||_0x9a0571)&&(_0x181080=_0x3853e2(0x18c));_0x4f7c5e['push']({'room':_0x4f3a13[_0x3853e2(0x1c5)]||_0x3853e2(0x167),'sensorId':_0x4f3a13['id'],'setpointId':_0x305198||'-','valveId':_0x9a0571||'-','source':_0x181080,'isManual':_0x5e87da,'status':_0x305198&&_0x9a0571?'PERFECT':_0x305198?'OK':_0x3853e2(0x205)});}return _0x4f7c5e[_0x3853e2(0x16e)]((_0x5903ae,_0x3c84d5)=>_0x5903ae[_0x3853e2(0x17b)][_0x3853e2(0x1f9)](_0x3c84d5[_0x3853e2(0x17b)]));}async function updateSchedulePreview(_0x508f95){const _0x5e2e5a=a1_0x5127a6;if(!_0x508f95[_0x5e2e5a(0x1ad)][_0x5e2e5a(0x208)]||!_0x508f95['config']['calendarInstance'])return;let _0x3b9050={};try{const _0x5167bf=await _0x508f95[_0x5e2e5a(0x1bf)](_0x5e2e5a(0x17d));if(_0x5167bf&&_0x5167bf[_0x5e2e5a(0x15f)])_0x3b9050=JSON['parse'](_0x5167bf[_0x5e2e5a(0x15f)]);}catch(_0xd3534a){}const _0x233f46=[],_0x5eb9ec=Date[_0x5e2e5a(0x1b2)](),_0x1dc3c0=0x30*0x3c*0x3c*0x3e8;try{const _0xc71e04=await _0x508f95[_0x5e2e5a(0x1c0)](_0x508f95['config']['calendarInstance']+_0x5e2e5a(0x1bb));if(!_0xc71e04||!_0xc71e04['val'])return;const _0x234434=JSON[_0x5e2e5a(0x1c7)](_0xc71e04[_0x5e2e5a(0x15f)]),_0xf95ac9=_0x508f95[_0x5e2e5a(0x1ad)][_0x5e2e5a(0x201)]||[],_0x524552=_0x508f95['config'][_0x5e2e5a(0x1ed)]||[],_0x34a3ec=new Set();_0x524552[_0x5e2e5a(0x1c8)](_0x134b7f=>{const _0x24ec0d=_0x5e2e5a;if(_0x134b7f['location'])_0x34a3ec[_0x24ec0d(0x19e)](_0x134b7f[_0x24ec0d(0x1c5)]);});for(const _0x5e0095 of _0x234434){if(_0x5e0095[_0x5e2e5a(0x1d5)]&&_0xf95ac9[_0x5e2e5a(0x1ba)]>0x0&&!_0xf95ac9[_0x5e2e5a(0x17e)](_0x5e0095[_0x5e2e5a(0x1d5)]))continue;const _0x214f95=_0x5e0095[_0x5e2e5a(0x1ae)]||_0x5e0095[_0x5e2e5a(0x165)]||_0x5e0095[_0x5e2e5a(0x1fe)];if(!_0x214f95)continue;const _0x15e291=new Date(_0x214f95),_0x301576=_0x15e291[_0x5e2e5a(0x181)]();if(isNaN(_0x301576))continue;if(_0x301576<_0x5eb9ec)continue;if(_0x301576>_0x5eb9ec+_0x1dc3c0)continue;const _0x313091=(_0x5e0095[_0x5e2e5a(0x1d3)]||_0x5e0095[_0x5e2e5a(0x180)]||'')['toLowerCase']();let _0x3924a2=![],_0x23cfeb=[],_0x107f4a=_0x5e0095['event']||_0x5e0095[_0x5e2e5a(0x180)]||_0x5e2e5a(0x167);if(_0x313091[_0x5e2e5a(0x17e)]('urlaub\x20ende')||_0x313091[_0x5e2e5a(0x17e)]('r√ºckkehr')||_0x313091[_0x5e2e5a(0x17e)](_0x5e2e5a(0x1dd)))_0x3924a2=!![],_0x23cfeb=Array['from'](_0x34a3ec);else for(const _0x2904d8 of _0x34a3ec){if(_0x313091['includes'](_0x2904d8[_0x5e2e5a(0x216)]()))_0x23cfeb[_0x5e2e5a(0x1a9)](_0x2904d8);}_0x23cfeb['length']>0x0&&_0x23cfeb[_0x5e2e5a(0x1c8)](_0x2caf30=>{const _0x52ec79=_0x5e2e5a;let _0x1826e5=0x3c;if(_0x3924a2){let _0x31af06=0x0;Object[_0x52ec79(0x1e0)](_0x3b9050)['forEach'](_0x49308d=>{if(_0x49308d>_0x31af06)_0x31af06=_0x49308d;}),_0x1826e5=_0x31af06>0x0?_0x31af06:0x78;}else _0x1826e5=_0x3b9050[_0x2caf30]||0x3c;const _0x23c80c=new Date(_0x301576-_0x1826e5*0xea60);_0x233f46['push']({'eventTime':_0x301576,'triggerTime':_0x23c80c[_0x52ec79(0x181)](),'room':_0x2caf30,'minutes':_0x1826e5,'reason':_0x107f4a,'isGlobal':_0x3924a2});});}}catch(_0x472523){}_0x233f46[_0x5e2e5a(0x16e)]((_0x5d97f7,_0x5a66b3)=>_0x5d97f7['triggerTime']-_0x5a66b3[_0x5e2e5a(0x204)]);const _0xd2a267=_0x233f46[_0x5e2e5a(0x202)](0x0,0x5);await _0x508f95[_0x5e2e5a(0x1b9)]('analysis.energy.schedulePreview',{'val':JSON[_0x5e2e5a(0x1ef)](_0xd2a267),'ack':!![]});}async function checkCalendarTriggers(_0x3fee5d){const _0x1cf777=a1_0x5127a6;if(!_0x3fee5d[_0x1cf777(0x1ad)]['useCalendar']||!_0x3fee5d['config']['calendarInstance'])return;await updateSchedulePreview(_0x3fee5d);let _0x2084f6={},_0x26ad13={};try{const _0x7514df=await _0x3fee5d[_0x1cf777(0x1bf)]('analysis.energy.warmupTimes');if(_0x7514df&&_0x7514df['val'])_0x2084f6=JSON[_0x1cf777(0x1c7)](_0x7514df[_0x1cf777(0x15f)]);const _0x3e7c81=await _0x3fee5d[_0x1cf777(0x1bf)](_0x1cf777(0x175));if(_0x3e7c81&&_0x3e7c81[_0x1cf777(0x15f)])_0x26ad13=JSON[_0x1cf777(0x1c7)](_0x3e7c81[_0x1cf777(0x15f)]);}catch(_0x4fd14b){}let _0x1e44fb={'default':0x15};try{const _0x203fa5=await _0x3fee5d[_0x1cf777(0x1bf)](_0x1cf777(0x1a2));if(_0x203fa5&&_0x203fa5[_0x1cf777(0x15f)])_0x1e44fb=JSON[_0x1cf777(0x1c7)](_0x203fa5[_0x1cf777(0x15f)]);}catch(_0x175ebd){}try{const _0x2f1825=await _0x3fee5d[_0x1cf777(0x1c0)](_0x3fee5d['config'][_0x1cf777(0x173)]+_0x1cf777(0x1bb));if(!_0x2f1825||!_0x2f1825[_0x1cf777(0x15f)])return;const _0x2dfa95=JSON[_0x1cf777(0x1c7)](_0x2f1825['val']),_0x17a179=Date[_0x1cf777(0x1b2)](),_0x2c2b8a=_0x3fee5d['config'][_0x1cf777(0x1ed)]||[],_0x3e2fe0=_0x3fee5d['config'][_0x1cf777(0x201)]||[];for(const _0x2c5bcb of _0x2dfa95){if(_0x2c5bcb[_0x1cf777(0x1d5)]&&_0x3e2fe0[_0x1cf777(0x1ba)]>0x0&&!_0x3e2fe0[_0x1cf777(0x17e)](_0x2c5bcb[_0x1cf777(0x1d5)]))continue;const _0x436089=_0x2c5bcb['_date']||_0x2c5bcb[_0x1cf777(0x165)]||_0x2c5bcb[_0x1cf777(0x1fe)];if(!_0x436089)continue;const _0x1822be=new Date(_0x436089);if(isNaN(_0x1822be['getTime']()))continue;const _0x507432=(_0x2c5bcb[_0x1cf777(0x1d3)]||_0x2c5bcb[_0x1cf777(0x180)]||'')['toLowerCase']();if(_0x507432[_0x1cf777(0x17e)](_0x1cf777(0x185))||_0x507432[_0x1cf777(0x17e)]('r√ºckkehr')||_0x507432['includes'](_0x1cf777(0x1dd))){let _0x5785e2=0x0;Object['values'](_0x2084f6)[_0x1cf777(0x1c8)](_0x55a550=>{if(_0x55a550>_0x5785e2)_0x5785e2=_0x55a550;});if(_0x5785e2===0x0)_0x5785e2=0x78;const _0x4240a2=_0x1822be[_0x1cf777(0x181)]()-_0x5785e2*0xea60;_0x17a179>=_0x4240a2&&_0x17a179<_0x1822be['getTime']()&&(_0x3fee5d[_0x1cf777(0x1e3)]!==_0x1cf777(0x1de)&&(_0x3fee5d['log'][_0x1cf777(0x217)](_0x1cf777(0x18e)+_0x5785e2+'\x20min).'),await _0x3fee5d[_0x1cf777(0x1b9)]('system.mode',{'val':'normal','ack':![]})));}for(const _0x4ebab2 of _0x2c2b8a){if(_0x4ebab2['location']){const _0x275b88=_0x4ebab2[_0x1cf777(0x1c5)][_0x1cf777(0x216)]();if(_0x507432[_0x1cf777(0x17e)](_0x275b88)){const _0x38c7cd=_0x2084f6[_0x4ebab2[_0x1cf777(0x1c5)]]||0x3c,_0x4d0d5a=_0x26ad13[_0x4ebab2['location']]||_0x1cf777(0x184),_0x35bdca=_0x1822be['getTime']()-_0x38c7cd*0xea60;if(_0x17a179>=_0x35bdca&&_0x17a179<_0x1822be[_0x1cf777(0x181)]()){const _0x515c48=lastActions['cal_'+_0x4ebab2[_0x1cf777(0x1c5)]];if(_0x515c48&&_0x17a179-_0x515c48<CAL_COOLDOWN_MS)continue;const _0x51d0ca=await findRelatedId(_0x3fee5d,_0x4ebab2['id'],_0x1cf777(0x19a));if(_0x51d0ca){let _0x16e80a=_0x1e44fb[_0x4ebab2[_0x1cf777(0x1c5)]];if(_0x16e80a===undefined)_0x16e80a=_0x1e44fb[_0x1cf777(0x1cf)];if(_0x16e80a===undefined)_0x16e80a=0x15;const _0x4a8ebb=await _0x3fee5d['getForeignStateAsync'](_0x51d0ca);_0x4a8ebb&&typeof _0x4a8ebb[_0x1cf777(0x15f)]===_0x1cf777(0x1e4)&&_0x4a8ebb[_0x1cf777(0x15f)]<_0x16e80a-0.5&&(_0x3fee5d['log'][_0x1cf777(0x217)](_0x1cf777(0x198)+_0x4d0d5a+']:\x20Raum-Trigger\x20\x27'+_0x4ebab2['location']+_0x1cf777(0x1a0)+_0x16e80a+_0x1cf777(0x20b)+_0x38c7cd+'\x20min).'),await _0x3fee5d[_0x1cf777(0x163)](_0x51d0ca,_0x16e80a),await logAutomationAction(_0x3fee5d,'[CAL]\x20'+_0x4ebab2[_0x1cf777(0x1c5)]+_0x1cf777(0x1ce)+_0x16e80a+'¬∞C\x20(via\x20'+_0x4d0d5a+')'),lastActions['cal_'+_0x4ebab2[_0x1cf777(0x1c5)]]=_0x17a179);}}}}}}}catch(_0x2d3995){_0x3fee5d[_0x1cf777(0x18b)][_0x1cf777(0x1fd)]('Calendar\x20Check\x20Error:\x20'+_0x2d3995['message']);}}function a1_0x385e(_0x2a3c32,_0x25263f){const _0x379b86=a1_0x5989();return a1_0x385e=function(_0x21ba09,_0x11f36e){_0x21ba09=_0x21ba09-0x15f;let _0x59896a=_0x379b86[_0x21ba09];return _0x59896a;},a1_0x385e(_0x2a3c32,_0x25263f);}async function manageMpcIntervention(_0x1d2b77,_0x3efa67,_0x5b090b){const _0x55f9be=a1_0x5127a6;try{const _0x422520='analysis.energy.mpcActiveInterventions',_0x4a0f11=await _0x1d2b77[_0x55f9be(0x1bf)](_0x422520);let _0x49f414=[];if(_0x4a0f11&&_0x4a0f11[_0x55f9be(0x15f)])try{_0x49f414=JSON[_0x55f9be(0x1c7)](_0x4a0f11[_0x55f9be(0x15f)]);}catch(_0xbb9d15){}const _0x3db342=_0x49f414[_0x55f9be(0x1fb)](_0x3efa67);if(_0x5b090b===_0x55f9be(0x19e))_0x3db342===-0x1&&(_0x49f414['push'](_0x3efa67),await _0x1d2b77[_0x55f9be(0x1b9)](_0x422520,{'val':JSON[_0x55f9be(0x1ef)](_0x49f414),'ack':!![]}));else _0x5b090b===_0x55f9be(0x171)&&(_0x3db342!==-0x1&&(_0x49f414[_0x55f9be(0x1f0)](_0x3db342,0x1),await _0x1d2b77[_0x55f9be(0x1b9)](_0x422520,{'val':JSON[_0x55f9be(0x1ef)](_0x49f414),'ack':!![]})));}catch(_0x4d9d37){}}async function cleanupGhostInterventions(_0x1e4eab){const _0x541a9c=a1_0x5127a6;try{const _0x15fcde='analysis.energy.mpcActiveInterventions',_0x5b3c15=await _0x1e4eab[_0x541a9c(0x1bf)](_0x15fcde);if(!_0x5b3c15||!_0x5b3c15[_0x541a9c(0x15f)])return;const _0x330999=JSON[_0x541a9c(0x1c7)](_0x5b3c15[_0x541a9c(0x15f)]);if(!Array[_0x541a9c(0x170)](_0x330999)||_0x330999[_0x541a9c(0x1ba)]===0x0)return;let _0x184384={'default':0x15};try{const _0x47d33a=await _0x1e4eab[_0x541a9c(0x1bf)](_0x541a9c(0x1a2));if(_0x47d33a&&_0x47d33a[_0x541a9c(0x15f)])_0x184384=JSON[_0x541a9c(0x1c7)](_0x47d33a['val']);}catch(_0x2ef3fa){}let _0x19180e=[];try{const _0x392bc6=await _0x1e4eab[_0x541a9c(0x1bf)](_0x541a9c(0x189));if(_0x392bc6&&_0x392bc6[_0x541a9c(0x15f)])_0x19180e=JSON[_0x541a9c(0x1c7)](_0x392bc6[_0x541a9c(0x15f)]);}catch(_0xbb312c){}const _0x3ca041=_0x1e4eab[_0x541a9c(0x1ad)][_0x541a9c(0x1ed)]||[];let _0x528313=![];for(let _0x217225=_0x330999[_0x541a9c(0x1ba)]-0x1;_0x217225>=0x0;_0x217225--){const _0x96c531=_0x330999[_0x217225],_0x4b916d=_0x3ca041[_0x541a9c(0x195)](_0x2307c8=>normalize(_0x2307c8[_0x541a9c(0x1c5)])===normalize(_0x96c531)&&(_0x2307c8[_0x541a9c(0x17a)]===_0x541a9c(0x1f2)||_0x2307c8[_0x541a9c(0x17a)]==='thermostat'));if(!_0x4b916d){_0x1e4eab[_0x541a9c(0x18b)][_0x541a9c(0x1fd)](_0x541a9c(0x1af)+_0x96c531+_0x541a9c(0x182)),_0x330999[_0x541a9c(0x1f0)](_0x217225,0x1),_0x528313=!![];continue;}if(_0x4b916d){const _0x50bf13=await findRelatedId(_0x1e4eab,_0x4b916d['id'],_0x541a9c(0x19a)),_0x1958b7=await _0x1e4eab[_0x541a9c(0x1c0)](_0x4b916d['id']);if(_0x50bf13){const _0x1415b8=await _0x1e4eab[_0x541a9c(0x1c0)](_0x50bf13);if(_0x1415b8&&typeof _0x1415b8[_0x541a9c(0x15f)]==='number'){let _0x227655=![],_0x45e892='';Math['abs'](_0x1415b8['val']-ECO_TEMP)>0.5&&(_0x227655=!![],_0x45e892=_0x541a9c(0x176));if(!_0x227655&&_0x1958b7&&typeof _0x1958b7['val']===_0x541a9c(0x1e4)){const _0xc013b2=_0x184384[_0x96c531]||_0x184384['default']||0x15;_0x1958b7[_0x541a9c(0x15f)]<_0xc013b2+0.2&&(_0x227655=!![],_0x45e892='too_cold');}if(_0x227655){if(_0x45e892===_0x541a9c(0x176)){_0x1e4eab[_0x541a9c(0x18b)][_0x541a9c(0x217)](_0x541a9c(0x1d7)+_0x96c531+_0x541a9c(0x20f)+_0x1415b8[_0x541a9c(0x15f)]+_0x541a9c(0x1d0)+ECO_TEMP+'¬∞C).\x20Entferne\x20Status.');const _0x5a32db=lastActions[_0x541a9c(0x1cb)+_0x96c531],_0x389c19=_0x5a32db&&Date[_0x541a9c(0x1b2)]()-_0x5a32db<0x2*0x3c*0x3e8;if(!_0x389c19&&_0x1415b8[_0x541a9c(0x15f)]>ECO_TEMP+0.5)_0x1e4eab['sendToPythonWrapper']&&(_0x1e4eab[_0x541a9c(0x18b)]['info'](_0x541a9c(0x1ec)+_0x96c531+_0x541a9c(0x19c)),_0x1e4eab[_0x541a9c(0x1b3)](_0x541a9c(0x1c1),{'room':_0x96c531}));else _0x389c19&&_0x1e4eab[_0x541a9c(0x18b)][_0x541a9c(0x217)](_0x541a9c(0x192)+_0x96c531+_0x541a9c(0x1f5));}else{if(_0x45e892===_0x541a9c(0x183)){let _0x55ace0=![];if(_0x19180e[_0x541a9c(0x195)](_0x48db12=>_0x48db12[_0x541a9c(0x17b)]===_0x96c531))_0x55ace0=!![];const _0x5a91aa=_0x3ca041[_0x541a9c(0x1db)](_0x3561c2=>normalize(_0x3561c2['location'])===normalize(_0x96c531)&&(_0x3561c2[_0x541a9c(0x17a)]===_0x541a9c(0x1d4)||_0x3561c2['type']===_0x541a9c(0x168)||_0x3561c2[_0x541a9c(0x17a)]===_0x541a9c(0x1cc)));for(const _0x7ae078 of _0x5a91aa){try{const _0x1a5ef7=await _0x1e4eab[_0x541a9c(0x1c0)](_0x7ae078['id']);if(_0x1a5ef7&&(_0x1a5ef7[_0x541a9c(0x15f)]===!![]||_0x1a5ef7[_0x541a9c(0x15f)]===0x1||String(_0x1a5ef7['val'])[_0x541a9c(0x216)]()===_0x541a9c(0x1d9)))_0x55ace0=!![];}catch(_0x1ae84e){}}if(_0x55ace0)_0x1e4eab[_0x541a9c(0x18b)][_0x541a9c(0x217)](_0x541a9c(0x1f8)+_0x96c531+_0x541a9c(0x18a));else{const _0x4b87ff=_0x184384[_0x96c531]||_0x184384[_0x541a9c(0x1cf)]||0x15;_0x1e4eab[_0x541a9c(0x18b)][_0x541a9c(0x217)](_0x541a9c(0x1eb)+_0x96c531+_0x541a9c(0x210)+_0x1958b7['val']+_0x541a9c(0x1a5)+(_0x4b87ff+0.2)+_0x541a9c(0x212)),await _0x1e4eab[_0x541a9c(0x163)](_0x50bf13,_0x4b87ff),await logAutomationAction(_0x1e4eab,_0x541a9c(0x218)+_0x96c531+_0x541a9c(0x20e)+_0x4b87ff+'¬∞C'),lastActions['rescue_'+_0x96c531]=Date[_0x541a9c(0x1b2)]();}}}_0x330999['splice'](_0x217225,0x1),_0x528313=!![];}}}}}_0x528313&&await _0x1e4eab[_0x541a9c(0x1b9)](_0x15fcde,{'val':JSON[_0x541a9c(0x1ef)](_0x330999),'ack':!![]});}catch(_0x555b0d){}}function a1_0x5989(){const _0x14fe9a=['[MPC\x20WARNING]\x20Kein\x20Setpoint\x20f√ºr\x20','warn','date','stellwert','wert','calendarSelection','slice','.1.ACTUAL_TEMPERATURE','triggerTime','Fehlt','reason','5833128ATYEYw','useCalendar','name','string','¬∞C\x20(Vorlauf:\x20','light','exports',':\x20Puffer\x20leer\x20->\x20Heizen\x20auf\x20','\x20ist\x20auf\x20','\x20erreicht\x20Limit\x20(','.1.TEMPERATURE','¬∞C).\x20Sparmodus\x20beendet!','Manuelles\x20Mapping','approved','actual','toLowerCase','info','[WATCHDOG]\x20','analysis.automation.confidenceThreshold','val','dimmer','270823SDKMFk','108htRiVp','setForeignStateAsync','level.temperature','eventStart','(((.+)+)+)+$','Unbekannt','sensor','occupied_heating_setpoint','target','mpc_','unshift','12NSkBBd','sort','target_temperature','isArray','remove','off','calendarInstance','Soll','analysis.energy.warmupSources','manual','switch','./ai_agent','850370COZzng','type','room','1398630IeNiTs','analysis.energy.warmupTimes','includes','map','summary','getTime','\x27\x20hat\x20kein\x20Ger√§t\x20mehr.\x20L√∂sche\x20Eintrag.','too_cold','Classic','urlaub\x20ende','\x20auf\x20','split','getForeignObjectAsync','analysis.energy.ventilationAlerts','\x20ist\x20zu\x20kalt,\x20ABER\x20Fenster\x20offen/L√ºftung\x20erkannt.\x20Heize\x20NICHT,\x20entferne\x20nur\x20Status.','log','Auto-Erkennung','üî•\x20[MPC\x20ACTION]\x20Heize\x20','üìÖ\x20SMART\x20SCHEDULE\x20(Phase):\x20\x27Globaler\x20Start\x27\x20erkannt.\x20Heize\x20Haus\x20auf\x20(Vorlauf:\x20','üçÉ\x20[MPC\x20ACTION]\x20Senke\x20','position','valve_position','üìÖ\x20[MPC\x20INFO]\x20','.4.VALVE_STATE','analysis.automation.actionLog','find','valve','Pr√§diktion:\x20','üìÖ\x20SMART\x20SCHEDULE\x20[','800825Hcanme','setpoint','set','\x20wurde\x20manuell\x20erh√∂ht.','soll','add','consultButler','\x27\x20aktiv.\x20Heize\x20auf\x20','.1.SET_POINT_TEMPERATURE','analysis.energy.warmupTargets','Nicht\x20gefunden','replace','¬∞C\x20<\x20','¬∞C!\x20(Puffer\x20leer).','ACTUAL','score','push','331131NTYYpB','value.valve','ist','config','_date','üßπ\x20[MPC\x20CLEANUP]\x20Raum\x20\x27','\x20wieder\x20auf\x20','Ist','now','sendToPythonWrapper','analysis.automation.lastAction','\x20gefunden!','valveMapping','local_temperature','[MPC]\x20','setStateAsync','length','.data.table','.4.SET_TEMPERATURE','messwert','state','getStateAsync','getForeignStateAsync','TRAIN_RL_PENALTY','thermostatMapping','unit','current_heating_setpoint','location','.1.LEVEL','parse','forEach','join','trim','cal_','contact','toString','\x20->\x20','default','¬∞C\x20(nicht\x20','search','thermostat','event','window','_calName','\x20min)','üßπ\x20[MPC\x20CLEANUP]\x20','entries','open','hm-rpc','filter','rescue_','ankunft','normal','constructor','values','\x20->\x20Schalte\x20','write','currentSystemMode','number','pi_heating_demand','ACTUAL_TEMPERATURE','role','toUpperCase','openknx','getForeignObjectsAsync','üö®\x20[MPC\x20WATCHDOG]\x20','üéì\x20[RL-FEEDBACK]\x20Lerne\x20aus\x20Fehler:\x20','devices','active','stringify','splice','analysis.automation.mode','temperature',':\x20Absenkung\x20auf\x20','72POmKXO','\x20durch\x20Kalender\x20ge√§ndert.\x20Keine\x20RL-Strafe.','607383CKXbOE','common','üå¨Ô∏è\x20[MPC\x20WATCHDOG]\x20','localeCompare','SET_POINT_TEMPERATURE','indexOf'];a1_0x5989=function(){return _0x14fe9a;};return a1_0x5989();}async function applyEnergySavings(_0x139247,_0x5b10dd){const _0xe58d45=a1_0x5127a6;await cleanupGhostInterventions(_0x139247);if(!_0x5b10dd||_0x5b10dd[_0xe58d45(0x1ba)]===0x0)return;const _0x5b28ac=_0x139247[_0xe58d45(0x1ad)]['devices']||[],_0x5e1ad0=Date[_0xe58d45(0x1b2)]();for(const _0x5a9d41 of _0x5b10dd){const _0x58162e=_0x5a9d41[_0xe58d45(0x17b)],_0x29868c=_0x5a9d41['minutes_safe'],_0xc99208=_0x5a9d41[_0xe58d45(0x16a)]||0x15;if(lastActions[_0xe58d45(0x1dc)+_0x58162e]&&_0x5e1ad0-lastActions[_0xe58d45(0x1dc)+_0x58162e]<RESCUE_LOCK_MS)continue;const _0x334fac=_0x5b28ac[_0xe58d45(0x195)](_0x133ee4=>normalize(_0x133ee4[_0xe58d45(0x1c5)])===normalize(_0x58162e)&&(_0x133ee4[_0xe58d45(0x17a)]===_0xe58d45(0x1f2)||_0x133ee4[_0xe58d45(0x17a)]===_0xe58d45(0x1d2)));if(!_0x334fac)continue;const _0xe4bdfa=await findRelatedId(_0x139247,_0x334fac['id'],_0xe58d45(0x19a));if(_0xe4bdfa){if(lastActions['mpc_'+_0x58162e]&&_0x5e1ad0-lastActions[_0xe58d45(0x16b)+_0x58162e]<0x1e*0x3c*0x3e8)continue;const _0x2274aa=await _0x139247['getForeignStateAsync'](_0xe4bdfa);if(_0x2274aa&&typeof _0x2274aa[_0xe58d45(0x15f)]===_0xe58d45(0x1e4)){const _0x1f0adc=_0x2274aa['val'];_0x1f0adc!==ECO_TEMP&&await manageMpcIntervention(_0x139247,_0x58162e,_0xe58d45(0x171));if(_0x29868c>0x1e)_0x1f0adc>ECO_TEMP+0.5&&(_0x139247[_0xe58d45(0x18b)][_0xe58d45(0x217)](_0xe58d45(0x18f)+_0x58162e+_0xe58d45(0x186)+ECO_TEMP+'¬∞C!\x20(Puffer:\x20'+_0x29868c+_0xe58d45(0x1d6)),await _0x139247[_0xe58d45(0x163)](_0xe4bdfa,ECO_TEMP),await manageMpcIntervention(_0x139247,_0x58162e,_0xe58d45(0x19e)),lastActions[_0xe58d45(0x16b)+_0x58162e]=_0x5e1ad0,await logAutomationAction(_0x139247,'[MPC]\x20'+_0x58162e+_0xe58d45(0x1f3)+ECO_TEMP+'¬∞C'));else _0x29868c<=0xf&&(_0x1f0adc<_0xc99208&&(_0x139247[_0xe58d45(0x18b)][_0xe58d45(0x217)](_0xe58d45(0x18d)+_0x58162e+_0xe58d45(0x1b0)+_0xc99208+_0xe58d45(0x1a6)),await _0x139247[_0xe58d45(0x163)](_0xe4bdfa,_0xc99208),await manageMpcIntervention(_0x139247,_0x58162e,_0xe58d45(0x171)),lastActions[_0xe58d45(0x16b)+_0x58162e]=_0x5e1ad0,await logAutomationAction(_0x139247,_0xe58d45(0x1b8)+_0x58162e+':\x20Aufheizen\x20auf\x20'+_0xc99208+'¬∞C')));}}else _0x139247['log'][_0xe58d45(0x1fd)](_0xe58d45(0x1fc)+_0x58162e+_0xe58d45(0x1b5));}}module[a1_0x5127a6(0x20d)]={'handlePrediction':handlePrediction,'applyEnergySavings':applyEnergySavings,'scanThermostats':scanThermostats,'checkCalendarTriggers':checkCalendarTriggers,'updateSchedulePreview':updateSchedulePreview,'cleanupGhostInterventions':cleanupGhostInterventions};