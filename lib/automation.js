const a1_0x3230b6=a1_0x12ba;(function(_0x23d9c7,_0x184226){const _0x9b1f6e=a1_0x12ba,_0x145a73=_0x23d9c7();while(!![]){try{const _0x5f0ff4=parseInt(_0x9b1f6e(0x19e))/0x1*(-parseInt(_0x9b1f6e(0x1dc))/0x2)+parseInt(_0x9b1f6e(0x220))/0x3*(-parseInt(_0x9b1f6e(0x22e))/0x4)+parseInt(_0x9b1f6e(0x1f4))/0x5*(parseInt(_0x9b1f6e(0x1a7))/0x6)+-parseInt(_0x9b1f6e(0x207))/0x7*(-parseInt(_0x9b1f6e(0x1d0))/0x8)+-parseInt(_0x9b1f6e(0x1e9))/0x9+parseInt(_0x9b1f6e(0x1a1))/0xa*(parseInt(_0x9b1f6e(0x226))/0xb)+-parseInt(_0x9b1f6e(0x1b5))/0xc;if(_0x5f0ff4===_0x184226)break;else _0x145a73['push'](_0x145a73['shift']());}catch(_0x4ced16){_0x145a73['push'](_0x145a73['shift']());}}}(a1_0xb9a2,0xdfadb));function a1_0xb9a2(){const _0x3503f3=['string','switch','toFixed','[CAL-DEBUG]\x20->\x20Skipped:\x20No\x20date\x20found.','499866hAMqua','number','sensor','[CAL-DEBUG]\x20->\x20Skipped:\x20Too\x20far\x20in\x20future\x20(','position','reason','localeCompare','[CAL-DEBUG]\x20JSON\x20Parse\x20Error\x20for\x20table.','eventStart','./ai_agent','occupied_heating_setpoint','\x20->\x20Schalte\x20','.1.TEMPERATURE','now','22075452CiByby','analysis.energy.schedulePreview','push','getForeignObjectsAsync','values','setpoint','ðŸ“…\x20SMART\x20SCHEDULE:\x20\x27Globaler\x20Start\x27\x20erkannt\x20(','add','[MPC]\x20','[CAL-DEBUG]\x20Abort:\x20Calendar\x20not\x20configured.','warn','active','[CAL-DEBUG]\x20Checking\x20Event:\x20\x22','summary','find','.1.LEVEL','\x20min).','toString','consultButler','score','thermostat','rÃ¼ckkehr','off','devices','target_temperature','config','(((.+)+)+)+$','13443592ooMRbd','ðŸƒ\x20[MPC\x20ACTION]\x20Senke\x20','.1.SET_POINT_TEMPERATURE','type','getForeignObjectAsync','Soll','[CAL]\x20','Â°C!\x20(Puffer\x20leer).\x20->\x20ID:\x20','thermostat.setpoint','calendarSelection','Ist','ankunft','1964012VILiDE','analysis.automation.lastAction','\x20gefunden!\x20Bitte\x20\x27System\x27\x20Tab\x20prÃ¼fen.','ðŸ”¥\x20[MPC\x20ACTION]\x20Heize\x20','[CAL-DEBUG]\x20->\x20Skipped:\x20Invalid\x20Date\x20Format\x20(','triggerTime','h).','PERFECT','room','message','.1.ACTUAL_TEMPERATURE','.data.table','from','3461625PGJORc','info','ACTUAL_TEMPERATURE',').\x20Heize\x20ganzes\x20Haus\x20auf\x20(Vorlauf:\x20','log','Â°C!\x20(Aktuell:\x20','Manuelles\x20Mapping','length','\x27\x20erkannt\x20(','split','[MPC\x20WARNING]\x20Kein\x20Setpoint\x20(Soll-Temp)\x20fÃ¼r\x20','105bghAnx','trim','set','\x20events\x20in\x20ical.','\x20auf\x20','sort','state','ACTUAL','current_heating_setpoint','openknx','[CAL-DEBUG]\x20->\x20Skipped:\x20Past\x20event\x20(','setForeignStateAsync','join','toUpperCase','[CAL-DEBUG]\x20Final\x20Preview\x20List\x20Size:\x20','temp','map','target','Â°C,\x20Puffer:\x20','7iCnbNB','level.valve','getTime','event','system.mode','value.valve','temperature','getForeignStateAsync','thermostatMapping','useCalendar','[CAL-DEBUG]\x20Monitoring\x20rooms:\x20','forEach','replace','slice',':\x20Absenkung\x20auf\x20','[CAL-DEBUG]\x20Starting\x20Schedule\x20Preview...','urlaub\x20ende','light','calendarInstance','stringify','location','search','includes','[CAL-DEBUG]\x20->\x20No\x20room\x20matched\x20in\x20title.','date','12jAnkbS','filter','val','local_temperature','analysis.energy.warmupTimes','common','14045713qhtKwX','valve_position','apply','exports','[CAL-DEBUG]\x20Error:\x20','level.temperature','ist','[CAL-DEBUG]\x20->\x20MATCH\x20ROOM:\x20','584424EUWtYz','valveMapping','soll','valve','unit','getStateAsync','mpc_','role','Unbekannt','_date','toLowerCase','parse','h\x20ago).','constructor','_calName','setStateAsync','\x20->\x2021Â°C','.4.VALVE_STATE','1YbUHUa','dimmer','pi_heating_demand','10UEyezR','name'];a1_0xb9a2=function(){return _0x3503f3;};return a1_0xb9a2();}const a1_0x164534=(function(){let _0x133074=!![];return function(_0x2a20f7,_0x5666ba){const _0x370ed3=_0x133074?function(){const _0x84df5c=a1_0x12ba;if(_0x5666ba){const _0x5a473d=_0x5666ba[_0x84df5c(0x228)](_0x2a20f7,arguments);return _0x5666ba=null,_0x5a473d;}}:function(){};return _0x133074=![],_0x370ed3;};}()),a1_0x53102d=a1_0x164534(this,function(){const _0x160942=a1_0x12ba;return a1_0x53102d[_0x160942(0x1c6)]()['search'](_0x160942(0x1cf))['toString']()[_0x160942(0x23b)](a1_0x53102d)[_0x160942(0x21c)](_0x160942(0x1cf));});a1_0x53102d();'use strict';function a1_0x12ba(_0x4dc108,_0x31d65a){const _0x10ea30=a1_0xb9a2();return a1_0x12ba=function(_0x53102d,_0x164534){_0x53102d=_0x53102d-0x19b;let _0xb9a228=_0x10ea30[_0x53102d];return _0xb9a228;},a1_0x12ba(_0x4dc108,_0x31d65a);}const aiAgent=require(a1_0x3230b6(0x1b0)),COOLDOWN_MS=0x3c*0x3e8,ECO_TEMP=0x11,lastActions={};function normalize(_0xf1a4e4){const _0x2672c5=a1_0x3230b6;if(!_0xf1a4e4)return'';return _0xf1a4e4[_0x2672c5(0x238)]()[_0x2672c5(0x213)](/\s+/g,'')[_0x2672c5(0x1f5)]();}async function handlePrediction(_0xe03139,_0x25171f,_0x1095a9){const _0x58cd1e=a1_0x3230b6;if(!_0x25171f||_0x25171f==='Unknown')return;let _0x2c23eb=_0x58cd1e(0x1cb),_0x58acfa=0.6;try{const _0x18fadb=await _0xe03139['getStateAsync']('analysis.automation.mode');if(_0x18fadb&&_0x18fadb[_0x58cd1e(0x222)])_0x2c23eb=_0x18fadb['val'];const _0x1ef764=await _0xe03139[_0x58cd1e(0x233)]('analysis.automation.confidenceThreshold');if(_0x1ef764&&_0x1ef764[_0x58cd1e(0x222)])_0x58acfa=_0x1ef764[_0x58cd1e(0x222)];}catch(_0x1466b3){}if(_0x2c23eb===_0x58cd1e(0x1cb)||_0x1095a9<_0x58acfa)return;const _0x52a2ec=Date['now']();if(lastActions[_0x25171f]&&_0x52a2ec-lastActions[_0x25171f]<COOLDOWN_MS)return;const _0x33b339=_0xe03139[_0x58cd1e(0x1ce)][_0x58cd1e(0x1cc)]||[],_0x118612=normalize(_0x25171f),_0x1c3713=_0x33b339[_0x58cd1e(0x1c3)](_0x5d9b63=>normalize(_0x5d9b63[_0x58cd1e(0x21b)])===_0x118612&&(_0x5d9b63['type']===_0x58cd1e(0x218)||_0x5d9b63[_0x58cd1e(0x1d3)]===_0x58cd1e(0x19f)||_0x5d9b63['type']===_0x58cd1e(0x1a4)));if(!_0x1c3713)return;const _0x2cf249=await aiAgent[_0x58cd1e(0x1c7)](_0xe03139,_0x25171f,_0x1c3713[_0x58cd1e(0x1a2)],_0x1095a9);if(!_0x2cf249['approved'])return;const _0x22fed1='PrÃ¤diktion:\x20'+_0x25171f+_0x58cd1e(0x1b2)+_0x1c3713['name']+'\x20('+_0x2cf249[_0x58cd1e(0x1ac)]+')';await _0xe03139[_0x58cd1e(0x19b)](_0x58cd1e(0x1dd),{'val':'['+_0x2c23eb[_0x58cd1e(0x201)]()+']\x20'+_0x22fed1,'ack':!![]});if(_0x2c23eb===_0x58cd1e(0x1c0)){const _0x2d1d8a=await _0xe03139[_0x58cd1e(0x20e)](_0x1c3713['id']);(!_0x2d1d8a||!_0x2d1d8a['val']&&_0x2d1d8a[_0x58cd1e(0x222)]!==!![])&&await _0xe03139[_0x58cd1e(0x1ff)](_0x1c3713['id'],!![]),lastActions[_0x25171f]=_0x52a2ec;}}async function findRelatedId(_0x5c4b2f,_0x52b7fc,_0x4aeee4=a1_0x3230b6(0x1ba)){const _0x463fd0=a1_0x3230b6;if(_0x4aeee4===_0x463fd0(0x1ba)&&_0x5c4b2f[_0x463fd0(0x1ce)][_0x463fd0(0x20f)]){let _0x3bb62f=_0x5c4b2f[_0x463fd0(0x1ce)][_0x463fd0(0x20f)];if(typeof _0x3bb62f===_0x463fd0(0x1a3))try{_0x3bb62f=JSON[_0x463fd0(0x239)](_0x3bb62f);}catch(_0x9b7e2c){}if(_0x3bb62f&&_0x3bb62f[_0x52b7fc])return _0x3bb62f[_0x52b7fc];}if(_0x4aeee4==='valve'&&_0x5c4b2f[_0x463fd0(0x1ce)][_0x463fd0(0x22f)]){let _0x42943e=_0x5c4b2f[_0x463fd0(0x1ce)]['valveMapping'];if(typeof _0x42943e==='string')try{_0x42943e=JSON['parse'](_0x42943e);}catch(_0x16e188){}if(_0x42943e&&_0x42943e[_0x52b7fc])return _0x42943e[_0x52b7fc];}let _0x145f78=[];if(_0x4aeee4===_0x463fd0(0x1ba))_0x145f78=[{'s':_0x463fd0(0x1e6),'t':_0x463fd0(0x1d2)},{'s':'.1.TEMPERATURE','t':_0x463fd0(0x1d2)},{'s':_0x463fd0(0x1b3),'t':'.4.SET_TEMPERATURE'},{'s':_0x463fd0(0x1eb),'t':'SET_POINT_TEMPERATURE'},{'s':_0x463fd0(0x223),'t':_0x463fd0(0x1b1)},{'s':_0x463fd0(0x223),'t':_0x463fd0(0x1fc)},{'s':_0x463fd0(0x20d),'t':_0x463fd0(0x1cd)},{'s':_0x463fd0(0x1fb),'t':'SET'},{'s':_0x463fd0(0x1da),'t':_0x463fd0(0x1d5)},{'s':'temperature','t':_0x463fd0(0x1ba)}];else _0x4aeee4===_0x463fd0(0x231)&&(_0x145f78=[{'s':_0x463fd0(0x1e6),'t':_0x463fd0(0x1c4)},{'s':_0x463fd0(0x1b3),'t':_0x463fd0(0x1c4)},{'s':_0x463fd0(0x1b3),'t':_0x463fd0(0x19d)},{'s':'local_temperature','t':_0x463fd0(0x1a0)},{'s':_0x463fd0(0x20d),'t':_0x463fd0(0x227)},{'s':_0x463fd0(0x20d),'t':'level'}]);for(const _0x1f6326 of _0x145f78){if(_0x52b7fc[_0x463fd0(0x21d)](_0x1f6326['s'])){const _0x3f99b7=_0x52b7fc[_0x463fd0(0x213)](_0x1f6326['s'],_0x1f6326['t']),_0x59f14a=await _0x5c4b2f[_0x463fd0(0x1d4)](_0x3f99b7);if(_0x59f14a)return _0x3f99b7;}}try{const _0x565d19=_0x52b7fc[_0x463fd0(0x1f2)]('.');if(_0x565d19[_0x463fd0(0x1f0)]>0x2){const _0x1b2113=_0x565d19[_0x463fd0(0x214)](0x0,-0x1)[_0x463fd0(0x200)]('.'),_0x1bad67=await _0x5c4b2f[_0x463fd0(0x1b8)](_0x1b2113+'.*'),_0x3922dc=[],_0xdcbc05=_0x52b7fc[_0x463fd0(0x1f2)](/[._]+/)['filter'](_0x12eac9=>![_0x463fd0(0x1fd),'0','hm-rpc',_0x463fd0(0x22c),'wert',_0x463fd0(0x20d),'actual','sensor','messwert',_0x463fd0(0x1fa)][_0x463fd0(0x21d)](_0x12eac9[_0x463fd0(0x238)]()));for(const [_0x3ce7fa,_0xdcb58a]of Object['entries'](_0x1bad67)){if(_0x3ce7fa===_0x52b7fc)continue;if(_0xdcb58a&&_0xdcb58a[_0x463fd0(0x225)]){const _0x3993f4=_0x3ce7fa[_0x463fd0(0x238)](),_0x51e767=(_0xdcb58a['common'][_0x463fd0(0x235)]||'')['toLowerCase'](),_0x4be3f8=(_0xdcb58a[_0x463fd0(0x225)][_0x463fd0(0x232)]||'')[_0x463fd0(0x238)]();let _0x40e681=![];if(_0x4aeee4===_0x463fd0(0x1ba)&&_0xdcb58a[_0x463fd0(0x225)]['write']===!![])_0x40e681=_0x3993f4[_0x463fd0(0x21d)](_0x463fd0(0x1f6))||_0x3993f4['includes'](_0x463fd0(0x230))||_0x3993f4[_0x463fd0(0x21d)](_0x463fd0(0x205))||_0x51e767['includes'](_0x463fd0(0x22b))||_0x51e767[_0x463fd0(0x21d)](_0x463fd0(0x1d8));else _0x4aeee4===_0x463fd0(0x231)&&(_0x40e681=_0x3993f4[_0x463fd0(0x21d)]('level')||_0x3993f4[_0x463fd0(0x21d)](_0x463fd0(0x231))||_0x3993f4['includes']('stellwert')||_0x3993f4[_0x463fd0(0x21d)](_0x463fd0(0x1ab))||_0x51e767[_0x463fd0(0x21d)](_0x463fd0(0x208))||_0x51e767[_0x463fd0(0x21d)](_0x463fd0(0x20c))||_0x4be3f8[_0x463fd0(0x21d)]('%'));if(_0x40e681){const _0x4bd73b=_0x3ce7fa[_0x463fd0(0x1f2)](/[._]+/)[_0x463fd0(0x204)](_0x4b1095=>_0x4b1095[_0x463fd0(0x238)]());let _0x22d6b4=0x0;_0xdcbc05[_0x463fd0(0x212)](_0x26c590=>{const _0x4a134b=_0x463fd0;if(_0x4bd73b['includes'](_0x26c590[_0x4a134b(0x238)]()))_0x22d6b4++;}),_0x3922dc[_0x463fd0(0x1b7)]({'id':_0x3ce7fa,'score':_0x22d6b4});}}}if(_0x3922dc[_0x463fd0(0x1f0)]>0x0){_0x3922dc[_0x463fd0(0x1f9)]((_0x572749,_0x4feb91)=>_0x4feb91[_0x463fd0(0x1c8)]-_0x572749[_0x463fd0(0x1c8)]);if(_0x3922dc[0x0][_0x463fd0(0x1c8)]>0x0)return _0x3922dc[0x0]['id'];}}}catch(_0x5a029c){}return null;}async function scanThermostats(_0x447de8){const _0x236c84=a1_0x3230b6,_0xc685ba=_0x447de8['config']['devices']||[],_0x32c71b=[],_0x138e67=_0xc685ba[_0x236c84(0x221)](_0x592d46=>_0x592d46['id']&&_0x592d46['id'][_0x236c84(0x21d)](_0x236c84(0x20d))||_0x592d46[_0x236c84(0x1d3)]&&[_0x236c84(0x20d),'thermostat',_0x236c84(0x1a9)][_0x236c84(0x21d)](_0x592d46[_0x236c84(0x1d3)])||_0x592d46['name']&&_0x592d46[_0x236c84(0x1a2)][_0x236c84(0x238)]()[_0x236c84(0x21d)](_0x236c84(0x203)));for(const _0x485323 of _0x138e67){const _0x5199b5=await findRelatedId(_0x447de8,_0x485323['id'],_0x236c84(0x1ba)),_0x5734c7=await findRelatedId(_0x447de8,_0x485323['id'],_0x236c84(0x231));let _0x2021ce='Nicht\x20gefunden',_0x516405=![],_0x77e1a6=_0x447de8[_0x236c84(0x1ce)][_0x236c84(0x20f)]||{};if(typeof _0x77e1a6===_0x236c84(0x1a3))try{_0x77e1a6=JSON['parse'](_0x77e1a6);}catch(_0x38874c){}let _0x50d84d=_0x447de8[_0x236c84(0x1ce)][_0x236c84(0x22f)]||{};if(typeof _0x50d84d===_0x236c84(0x1a3))try{_0x50d84d=JSON['parse'](_0x50d84d);}catch(_0x296fc2){}if(_0x77e1a6[_0x485323['id']]&&_0x77e1a6[_0x485323['id']]===_0x5199b5||_0x50d84d[_0x485323['id']]&&_0x50d84d[_0x485323['id']]===_0x5734c7)_0x2021ce=_0x236c84(0x1ef),_0x516405=!![];else(_0x5199b5||_0x5734c7)&&(_0x2021ce='Auto-Erkennung');_0x32c71b['push']({'room':_0x485323[_0x236c84(0x21b)]||_0x236c84(0x236),'sensorId':_0x485323['id'],'setpointId':_0x5199b5||'-','valveId':_0x5734c7||'-','source':_0x2021ce,'isManual':_0x516405,'status':_0x5199b5&&_0x5734c7?_0x236c84(0x1e3):_0x5199b5?'OK':'Fehlt'});}return _0x32c71b['sort']((_0x2c0d88,_0x100050)=>_0x2c0d88[_0x236c84(0x1e4)][_0x236c84(0x1ad)](_0x100050[_0x236c84(0x1e4)]));}async function updateSchedulePreview(_0x3040f2){const _0x2bd9c3=a1_0x3230b6;_0x3040f2['log']['warn'](_0x2bd9c3(0x216));if(!_0x3040f2[_0x2bd9c3(0x1ce)][_0x2bd9c3(0x210)]||!_0x3040f2[_0x2bd9c3(0x1ce)][_0x2bd9c3(0x219)]){_0x3040f2[_0x2bd9c3(0x1ed)][_0x2bd9c3(0x1bf)](_0x2bd9c3(0x1be));return;}let _0x5d3001={};try{const _0x104103=await _0x3040f2['getStateAsync']('analysis.energy.warmupTimes');if(_0x104103&&_0x104103['val'])_0x5d3001=JSON[_0x2bd9c3(0x239)](_0x104103[_0x2bd9c3(0x222)]);}catch(_0x1d6f87){}const _0xce7dc1=[],_0x2191e9=Date[_0x2bd9c3(0x1b4)](),_0xbb159f=0x30*0x3c*0x3c*0x3e8;try{const _0x3ec5d8=await _0x3040f2['getForeignStateAsync'](_0x3040f2['config'][_0x2bd9c3(0x219)]+_0x2bd9c3(0x1e7));if(!_0x3ec5d8||!_0x3ec5d8[_0x2bd9c3(0x222)]){_0x3040f2[_0x2bd9c3(0x1ed)]['warn']('[CAL-DEBUG]\x20Abort:\x20ical\x20table\x20empty\x20or\x20not\x20found.');return;}let _0x41f2c6=[];try{_0x41f2c6=JSON['parse'](_0x3ec5d8[_0x2bd9c3(0x222)]);}catch(_0xdb04b){_0x3040f2[_0x2bd9c3(0x1ed)][_0x2bd9c3(0x1bf)](_0x2bd9c3(0x1ae));return;}_0x3040f2['log'][_0x2bd9c3(0x1bf)]('[CAL-DEBUG]\x20Found\x20'+_0x41f2c6[_0x2bd9c3(0x1f0)]+_0x2bd9c3(0x1f7));const _0x1481a8=_0x3040f2['config'][_0x2bd9c3(0x1d9)]||[],_0x2ee3d6=_0x3040f2[_0x2bd9c3(0x1ce)][_0x2bd9c3(0x1cc)]||[],_0x5981bf=new Set();_0x2ee3d6['forEach'](_0x1e152a=>{const _0x594a88=_0x2bd9c3;if(_0x1e152a[_0x594a88(0x21b)])_0x5981bf[_0x594a88(0x1bc)](_0x1e152a[_0x594a88(0x21b)]);}),_0x3040f2[_0x2bd9c3(0x1ed)]['warn'](_0x2bd9c3(0x211)+Array['from'](_0x5981bf)['join'](',\x20'));for(const _0x13730e of _0x41f2c6){const _0x557bf7=_0x13730e['event']||_0x13730e[_0x2bd9c3(0x1c2)]||'???';_0x3040f2['log'][_0x2bd9c3(0x1bf)](_0x2bd9c3(0x1c1)+_0x557bf7+'\x22');if(_0x13730e['_calName']&&_0x1481a8[_0x2bd9c3(0x1f0)]>0x0&&!_0x1481a8[_0x2bd9c3(0x21d)](_0x13730e[_0x2bd9c3(0x23c)])){_0x3040f2['log'][_0x2bd9c3(0x1bf)]('[CAL-DEBUG]\x20->\x20Skipped:\x20Wrong\x20Calendar\x20('+_0x13730e[_0x2bd9c3(0x23c)]+')');continue;}const _0x56b8f8=_0x13730e[_0x2bd9c3(0x237)]||_0x13730e[_0x2bd9c3(0x1af)]||_0x13730e[_0x2bd9c3(0x21f)];if(!_0x56b8f8){_0x3040f2['log']['warn'](_0x2bd9c3(0x1a6));continue;}const _0x37666c=new Date(_0x56b8f8),_0x28e8cb=_0x37666c['getTime']();if(isNaN(_0x28e8cb)){_0x3040f2[_0x2bd9c3(0x1ed)][_0x2bd9c3(0x1bf)](_0x2bd9c3(0x1e0)+_0x56b8f8+').');continue;}const _0x8fcfc1=(_0x28e8cb-_0x2191e9)/0x36ee80;if(_0x28e8cb<_0x2191e9){_0x3040f2[_0x2bd9c3(0x1ed)][_0x2bd9c3(0x1bf)](_0x2bd9c3(0x1fe)+_0x8fcfc1['toFixed'](0x1)+_0x2bd9c3(0x23a));continue;}if(_0x28e8cb>_0x2191e9+_0xbb159f){_0x3040f2[_0x2bd9c3(0x1ed)][_0x2bd9c3(0x1bf)](_0x2bd9c3(0x1aa)+_0x8fcfc1[_0x2bd9c3(0x1a5)](0x1)+_0x2bd9c3(0x1e2));continue;}const _0x520821=_0x557bf7[_0x2bd9c3(0x238)]();let _0x333a57=![],_0x37f1f5=[],_0x5c3fa9=_0x557bf7;if(_0x520821['includes']('urlaub\x20ende')||_0x520821[_0x2bd9c3(0x21d)](_0x2bd9c3(0x1ca))||_0x520821[_0x2bd9c3(0x21d)]('ankunft'))_0x333a57=!![],_0x37f1f5=Array[_0x2bd9c3(0x1e8)](_0x5981bf),_0x3040f2[_0x2bd9c3(0x1ed)][_0x2bd9c3(0x1bf)]('[CAL-DEBUG]\x20->\x20MATCH\x20GLOBAL!');else for(const _0x47986b of _0x5981bf){_0x520821[_0x2bd9c3(0x21d)](_0x47986b[_0x2bd9c3(0x238)]())&&(_0x37f1f5[_0x2bd9c3(0x1b7)](_0x47986b),_0x3040f2[_0x2bd9c3(0x1ed)][_0x2bd9c3(0x1bf)](_0x2bd9c3(0x22d)+_0x47986b));}_0x37f1f5['length']>0x0?_0x37f1f5[_0x2bd9c3(0x212)](_0x481cf8=>{const _0xa24404=_0x2bd9c3;let _0x4e79af=0x3c;if(_0x333a57){let _0x414246=0x0;Object[_0xa24404(0x1b9)](_0x5d3001)[_0xa24404(0x212)](_0x1041de=>{if(_0x1041de>_0x414246)_0x414246=_0x1041de;}),_0x4e79af=_0x414246>0x0?_0x414246:0x78;}else _0x4e79af=_0x5d3001[_0x481cf8]||0x3c;const _0x5e2c9c=new Date(_0x28e8cb-_0x4e79af*0xea60);_0xce7dc1['push']({'eventTime':_0x28e8cb,'triggerTime':_0x5e2c9c[_0xa24404(0x209)](),'room':_0x481cf8,'minutes':_0x4e79af,'reason':_0x5c3fa9,'isGlobal':_0x333a57});}):_0x3040f2['log'][_0x2bd9c3(0x1bf)](_0x2bd9c3(0x21e));}}catch(_0x20b484){_0x3040f2[_0x2bd9c3(0x1ed)][_0x2bd9c3(0x1bf)](_0x2bd9c3(0x22a)+_0x20b484[_0x2bd9c3(0x1e5)]);}_0xce7dc1[_0x2bd9c3(0x1f9)]((_0x19d88e,_0x400d06)=>_0x19d88e[_0x2bd9c3(0x1e1)]-_0x400d06['triggerTime']);const _0x9ad140=_0xce7dc1[_0x2bd9c3(0x214)](0x0,0x5);_0x3040f2[_0x2bd9c3(0x1ed)][_0x2bd9c3(0x1bf)](_0x2bd9c3(0x202)+_0x9ad140[_0x2bd9c3(0x1f0)]),await _0x3040f2['setStateAsync'](_0x2bd9c3(0x1b6),{'val':JSON[_0x2bd9c3(0x21a)](_0x9ad140),'ack':!![]});}async function checkCalendarTriggers(_0x10a204){const _0x300ba8=a1_0x3230b6;if(!_0x10a204['config'][_0x300ba8(0x210)]||!_0x10a204['config'][_0x300ba8(0x219)])return;await updateSchedulePreview(_0x10a204);let _0x5a70cc={};try{const _0x506034=await _0x10a204[_0x300ba8(0x233)](_0x300ba8(0x224));if(_0x506034&&_0x506034[_0x300ba8(0x222)])_0x5a70cc=JSON[_0x300ba8(0x239)](_0x506034[_0x300ba8(0x222)]);}catch(_0x3e55af){}try{const _0x23f933=await _0x10a204['getForeignStateAsync'](_0x10a204[_0x300ba8(0x1ce)][_0x300ba8(0x219)]+_0x300ba8(0x1e7));if(!_0x23f933||!_0x23f933[_0x300ba8(0x222)])return;const _0x184671=JSON[_0x300ba8(0x239)](_0x23f933['val']),_0x3fe6c2=new Date(),_0x313e81=_0x10a204[_0x300ba8(0x1ce)][_0x300ba8(0x1cc)]||[],_0x9d9222=_0x10a204[_0x300ba8(0x1ce)][_0x300ba8(0x1d9)]||[];for(const _0x393961 of _0x184671){if(_0x393961[_0x300ba8(0x23c)]&&_0x9d9222[_0x300ba8(0x1f0)]>0x0&&!_0x9d9222[_0x300ba8(0x21d)](_0x393961['_calName']))continue;const _0x2008c4=_0x393961[_0x300ba8(0x237)]||_0x393961[_0x300ba8(0x1af)]||_0x393961[_0x300ba8(0x21f)];if(!_0x2008c4)continue;const _0x2390de=new Date(_0x2008c4);if(isNaN(_0x2390de[_0x300ba8(0x209)]()))continue;const _0x3e6ff3=(_0x393961[_0x300ba8(0x20a)]||_0x393961[_0x300ba8(0x1c2)]||'')[_0x300ba8(0x238)]();if(_0x3e6ff3['includes'](_0x300ba8(0x217))||_0x3e6ff3['includes'](_0x300ba8(0x1ca))||_0x3e6ff3[_0x300ba8(0x21d)](_0x300ba8(0x1db))){let _0x39b82d=0x0;Object['values'](_0x5a70cc)[_0x300ba8(0x212)](_0x37d84b=>{if(_0x37d84b>_0x39b82d)_0x39b82d=_0x37d84b;});if(_0x39b82d===0x0)_0x39b82d=0x78;const _0x5e2cc0=new Date(_0x2390de[_0x300ba8(0x209)]()-_0x39b82d*0xea60),_0x1e8d53=_0x3fe6c2[_0x300ba8(0x209)]()-_0x5e2cc0['getTime']();_0x1e8d53>=0x0&&_0x1e8d53<0xf*0xea60&&(_0x10a204['log'][_0x300ba8(0x1ea)](_0x300ba8(0x1bb)+_0x393961['event']+_0x300ba8(0x1ec)+_0x39b82d+_0x300ba8(0x1c5)),await _0x10a204[_0x300ba8(0x19b)](_0x300ba8(0x20b),{'val':'normal','ack':![]}));}for(const _0x5dcd52 of _0x313e81){if(_0x5dcd52[_0x300ba8(0x21b)]){const _0x3d6088=_0x5dcd52[_0x300ba8(0x21b)][_0x300ba8(0x238)]();if(_0x3e6ff3['includes'](_0x3d6088)){const _0x2f859d=_0x5a70cc[_0x5dcd52[_0x300ba8(0x21b)]]||0x3c,_0x1fb1db=new Date(_0x2390de[_0x300ba8(0x209)]()-_0x2f859d*0xea60),_0x2b1f93=_0x3fe6c2['getTime']()-_0x1fb1db[_0x300ba8(0x209)]();if(_0x2b1f93>=0x0&&_0x2b1f93<0xf*0xea60){const _0x5dd534=await findRelatedId(_0x10a204,_0x5dcd52['id'],_0x300ba8(0x1ba));_0x5dd534&&(_0x10a204[_0x300ba8(0x1ed)][_0x300ba8(0x1ea)]('ðŸ“…\x20SMART\x20SCHEDULE:\x20Raum-Trigger\x20\x27'+_0x5dcd52[_0x300ba8(0x21b)]+_0x300ba8(0x1f1)+_0x393961[_0x300ba8(0x20a)]+').\x20Heize\x20auf\x2021Â°C\x20(Vorlauf:\x20'+_0x2f859d+_0x300ba8(0x1c5)),await _0x10a204[_0x300ba8(0x1ff)](_0x5dd534,0x15),await _0x10a204['setStateAsync'](_0x300ba8(0x1dd),{'val':_0x300ba8(0x1d6)+_0x5dcd52[_0x300ba8(0x21b)]+_0x300ba8(0x19c),'ack':!![]}));}}}}}}catch(_0x80e40a){_0x10a204[_0x300ba8(0x1ed)]['warn']('Calendar\x20Check\x20Error:\x20'+_0x80e40a['message']);}}async function applyEnergySavings(_0x1ee393,_0x59599c){const _0x5ae556=a1_0x3230b6;if(!_0x59599c||_0x59599c[_0x5ae556(0x1f0)]===0x0)return;const _0x39fcc1=_0x1ee393[_0x5ae556(0x1ce)][_0x5ae556(0x1cc)]||[],_0x41b8a8=Date[_0x5ae556(0x1b4)]();for(const _0x44c70b of _0x59599c){const _0x1df16b=_0x44c70b[_0x5ae556(0x1e4)],_0x22948c=_0x44c70b['minutes_safe'],_0x39dddb=_0x44c70b[_0x5ae556(0x205)]||0x15,_0x1ab823=_0x39fcc1['find'](_0x3fed36=>normalize(_0x3fed36[_0x5ae556(0x21b)])===normalize(_0x1df16b)&&(_0x3fed36[_0x5ae556(0x1d3)]===_0x5ae556(0x20d)||_0x3fed36[_0x5ae556(0x1d3)]===_0x5ae556(0x1c9)));if(!_0x1ab823)continue;const _0x4e512c=await findRelatedId(_0x1ee393,_0x1ab823['id'],_0x5ae556(0x1ba));if(_0x4e512c){if(lastActions[_0x5ae556(0x234)+_0x1df16b]&&_0x41b8a8-lastActions[_0x5ae556(0x234)+_0x1df16b]<0x1e*0x3c*0x3e8)continue;const _0x2fdb70=await _0x1ee393[_0x5ae556(0x20e)](_0x4e512c);if(_0x2fdb70&&typeof _0x2fdb70['val']===_0x5ae556(0x1a8)){const _0x3cd863=_0x2fdb70[_0x5ae556(0x222)];if(_0x22948c>0x1e)_0x3cd863>ECO_TEMP+0.5&&(_0x1ee393[_0x5ae556(0x1ed)]['info'](_0x5ae556(0x1d1)+_0x1df16b+_0x5ae556(0x1f8)+ECO_TEMP+_0x5ae556(0x1ee)+_0x3cd863+_0x5ae556(0x206)+_0x22948c+'\x20min)\x20->\x20ID:\x20'+_0x4e512c),await _0x1ee393[_0x5ae556(0x1ff)](_0x4e512c,ECO_TEMP),lastActions['mpc_'+_0x1df16b]=_0x41b8a8,await _0x1ee393[_0x5ae556(0x19b)](_0x5ae556(0x1dd),{'val':'[MPC]\x20'+_0x1df16b+_0x5ae556(0x215)+ECO_TEMP+'Â°C','ack':!![]}));else _0x22948c<=0xf&&(_0x3cd863<_0x39dddb&&(_0x1ee393[_0x5ae556(0x1ed)][_0x5ae556(0x1ea)](_0x5ae556(0x1df)+_0x1df16b+'\x20wieder\x20auf\x20'+_0x39dddb+_0x5ae556(0x1d7)+_0x4e512c),await _0x1ee393[_0x5ae556(0x1ff)](_0x4e512c,_0x39dddb),lastActions[_0x5ae556(0x234)+_0x1df16b]=_0x41b8a8,await _0x1ee393[_0x5ae556(0x19b)]('analysis.automation.lastAction',{'val':_0x5ae556(0x1bd)+_0x1df16b+':\x20Aufheizen\x20auf\x20'+_0x39dddb+'Â°C','ack':!![]})));}}else _0x1ee393['log'][_0x5ae556(0x1bf)](_0x5ae556(0x1f3)+_0x1df16b+_0x5ae556(0x1de));}}module[a1_0x3230b6(0x229)]={'handlePrediction':handlePrediction,'applyEnergySavings':applyEnergySavings,'scanThermostats':scanThermostats,'checkCalendarTriggers':checkCalendarTriggers,'updateSchedulePreview':updateSchedulePreview};