const a1_0x30ab7f=a1_0x4410;(function(_0x245465,_0x397da3){const _0x3d10be=a1_0x4410,_0x552137=_0x245465();while(!![]){try{const _0x37abc4=-parseInt(_0x3d10be(0x1fa))/0x1+parseInt(_0x3d10be(0x200))/0x2+-parseInt(_0x3d10be(0x182))/0x3+-parseInt(_0x3d10be(0x197))/0x4+-parseInt(_0x3d10be(0x1b1))/0x5*(parseInt(_0x3d10be(0x1c6))/0x6)+-parseInt(_0x3d10be(0x1fb))/0x7*(parseInt(_0x3d10be(0x1df))/0x8)+parseInt(_0x3d10be(0x1e5))/0x9;if(_0x37abc4===_0x397da3)break;else _0x552137['push'](_0x552137['shift']());}catch(_0x369091){_0x552137['push'](_0x552137['shift']());}}}(a1_0x2f66,0xe01ae));function a1_0x4410(_0x1db915,_0x558292){const _0x4d4c89=a1_0x2f66();return a1_0x4410=function(_0x385b95,_0xd9102c){_0x385b95=_0x385b95-0x16e;let _0x2f66c3=_0x4d4c89[_0x385b95];return _0x2f66c3;},a1_0x4410(_0x1db915,_0x558292);}const a1_0xd9102c=(function(){let _0x373c98=!![];return function(_0xc19062,_0x23de35){const _0x115ddd=_0x373c98?function(){if(_0x23de35){const _0x20fc0c=_0x23de35['apply'](_0xc19062,arguments);return _0x23de35=null,_0x20fc0c;}}:function(){};return _0x373c98=![],_0x115ddd;};}()),a1_0x385b95=a1_0xd9102c(this,function(){const _0x59fde7=a1_0x4410;return a1_0x385b95[_0x59fde7(0x1fc)]()[_0x59fde7(0x1be)](_0x59fde7(0x1eb))[_0x59fde7(0x1fc)]()[_0x59fde7(0x17d)](a1_0x385b95)['search'](_0x59fde7(0x1eb));});a1_0x385b95();'use strict';const aiAgent=require(a1_0x30ab7f(0x214)),COOLDOWN_MS=0x3c*0x3e8,CAL_COOLDOWN_MS=0x5a*0x3c*0x3e8,RESCUE_LOCK_MS=0x78*0x3c*0x3e8,ECO_TEMP=0x11,lastActions={};function normalize(_0x20f584){const _0xea1a1e=a1_0x30ab7f;if(!_0x20f584)return'';return _0x20f584[_0xea1a1e(0x206)]()[_0xea1a1e(0x1cb)](/\s+/g,'')[_0xea1a1e(0x1b0)]();}async function logAutomationAction(_0x56d213,_0x28bc48){const _0x1f5086=a1_0x30ab7f;await _0x56d213[_0x1f5086(0x190)](_0x1f5086(0x219),{'val':_0x28bc48,'ack':!![]});try{const _0x486c39=_0x1f5086(0x195),_0x5f2f89=await _0x56d213[_0x1f5086(0x1d3)](_0x486c39);let _0x1312b7=[];if(_0x5f2f89&&_0x5f2f89[_0x1f5086(0x175)])try{_0x1312b7=JSON[_0x1f5086(0x21a)](_0x5f2f89['val']);}catch(_0x544fa9){}_0x1312b7['unshift']({'ts':Date['now'](),'msg':_0x28bc48});if(_0x1312b7[_0x1f5086(0x1e4)]>0x32)_0x1312b7=_0x1312b7[_0x1f5086(0x20f)](0x0,0x32);await _0x56d213[_0x1f5086(0x190)](_0x486c39,{'val':JSON['stringify'](_0x1312b7),'ack':!![]});}catch(_0x388b42){}}async function handlePrediction(_0x24369a,_0x1c032c,_0x175b43){const _0xdb5031=a1_0x30ab7f;if(!_0x1c032c||_0x1c032c==='Unknown')return;let _0x49e3e1=_0xdb5031(0x196),_0x24687c=0.6;try{const _0x13dcfe=await _0x24369a[_0xdb5031(0x1d3)](_0xdb5031(0x1c5));if(_0x13dcfe&&_0x13dcfe[_0xdb5031(0x175)])_0x49e3e1=_0x13dcfe['val'];const _0x297f39=await _0x24369a[_0xdb5031(0x1d3)](_0xdb5031(0x212));if(_0x297f39&&_0x297f39['val'])_0x24687c=_0x297f39[_0xdb5031(0x175)];}catch(_0x408375){}if(_0x49e3e1===_0xdb5031(0x196)||_0x175b43<_0x24687c)return;const _0x14beeb=Date[_0xdb5031(0x1e1)]();if(lastActions[_0x1c032c]&&_0x14beeb-lastActions[_0x1c032c]<COOLDOWN_MS)return;const _0x5c20ae=_0x24369a['config'][_0xdb5031(0x1a6)]||[],_0x57df45=normalize(_0x1c032c),_0x53339b=_0x5c20ae[_0xdb5031(0x1a0)](_0x1aa40b=>normalize(_0x1aa40b[_0xdb5031(0x17a)])===_0x57df45&&(_0x1aa40b['type']===_0xdb5031(0x1ad)||_0x1aa40b[_0xdb5031(0x1ee)]===_0xdb5031(0x1ce)||_0x1aa40b[_0xdb5031(0x1ee)]==='switch'));if(!_0x53339b)return;const _0x4376d7=await aiAgent[_0xdb5031(0x193)](_0x24369a,_0x1c032c,_0x53339b[_0xdb5031(0x18b)],_0x175b43);if(!_0x4376d7[_0xdb5031(0x183)])return;const _0x6727c5=_0xdb5031(0x207)+_0x1c032c+_0xdb5031(0x213)+_0x53339b['name']+'\x20('+_0x4376d7[_0xdb5031(0x1c4)]+')';await logAutomationAction(_0x24369a,'['+_0x49e3e1[_0xdb5031(0x1f3)]()+']\x20'+_0x6727c5);if(_0x49e3e1===_0xdb5031(0x1c2)){const _0x42c84a=await _0x24369a[_0xdb5031(0x171)](_0x53339b['id']);(!_0x42c84a||!_0x42c84a[_0xdb5031(0x175)]&&_0x42c84a[_0xdb5031(0x175)]!==!![])&&await _0x24369a[_0xdb5031(0x1ac)](_0x53339b['id'],!![]),lastActions[_0x1c032c]=_0x14beeb;}}function a1_0x2f66(){const _0x1daa81=['dimmer','common','.data.table','entries','warn','getStateAsync','filter','map','analysis.energy.warmupSources','setpoint','message','Soll','from','valve','window','analysis.energy.warmupTimes','üßπ\x20[MPC\x20CLEANUP]\x20','6323056xlUdfQ','getForeignObjectsAsync','now','sort','_calName','length','43162956ExZnzu','role','üö®\x20[MPC\x20WATCHDOG]\x20','üìÖ\x20SMART\x20SCHEDULE\x20[','number','split','(((.+)+)+)+$','ACTUAL_TEMPERATURE','thermostatMapping','type','Unbekannt','open','PERFECT','thermostat','toUpperCase','valve_position','analysis.energy.warmupTargets',':\x20Absenkung\x20auf\x20','.1.LEVEL','normal','analysis.energy.ventilationAlerts','1711101XJiMWQ','7brzuli','toString','too_cold','current_heating_setpoint','temperature','2815460Phxhti','write','set','contact','.1.ACTUAL_TEMPERATURE','getTime','toLowerCase','Pr√§diktion:\x20','summary',']:\x20Raum-Trigger\x20\x27','analysis.energy.schedulePreview','local_temperature','sensor','valveMapping','openknx','slice','add','SET_POINT_TEMPERATURE','analysis.automation.confidenceThreshold','\x20->\x20Schalte\x20','./ai_agent','\x20min)','log','triggerTime','getForeignObjectAsync','analysis.automation.lastAction','parse','SET','¬∞C!\x20(Puffer:\x20','system.mode','[CAL]\x20','getForeignStateAsync','[WATCHDOG]\x20','r√ºckkehr','exports','val','cal_','date','.1.TEMPERATURE','forEach','location','üéì\x20[RL-FEEDBACK]\x20Lerne\x20aus\x20Fehler:\x20','.4.VALVE_STATE','constructor','\x20wieder\x20auf\x20','[MPC]\x20','Fehlt','\x20min).','2641491beBjyR','approved','calendarInstance','currentSystemMode','wert','values','¬∞C).\x20Sparmodus\x20beendet!','event','üìÖ\x20SMART\x20SCHEDULE\x20(Phase):\x20\x27Globaler\x20Start\x27\x20erkannt.\x20Heize\x20Haus\x20auf\x20(Vorlauf:\x20','name','useCalendar','TRAIN_RL_PENALTY','\x27\x20hat\x20kein\x20Ger√§t\x20mehr.\x20L√∂sche\x20Eintrag.','includes','setStateAsync','Manuelles\x20Mapping','room','consultButler','.4.SET_TEMPERATURE','analysis.automation.actionLog','off','4330392fOmilC','¬∞C\x20(Vorlauf:\x20','level.temperature','mpc_','splice','stringify','occupied_heating_setpoint','level.valve','score','find','Classic','minutes_safe','Ist','Nicht\x20gefunden','remove','devices','join','pi_heating_demand','manual','_date','urlaub\x20ende','setForeignStateAsync','light','ankunft','target','trim','5FzIEzW','\x20durch\x20Kalender\x20ge√§ndert.\x20Keine\x20RL-Strafe.','[MPC\x20WARNING]\x20Kein\x20Setpoint\x20f√ºr\x20','Calendar\x20Check\x20Error:\x20','info','level','default','\x20gefunden!','target_temperature','string','localeCompare','calendarSelection','\x27\x20aktiv.\x20Heize\x20auf\x20','search','push','eventStart','ACTUAL','active','.1.SET_POINT_TEMPERATURE','reason','analysis.automation.mode','4926612lrGYfj','analysis.energy.mpcActiveInterventions','config','¬∞C\x20<\x20','üî•\x20[MPC\x20ACTION]\x20Heize\x20','replace','rescue_','sendToPythonWrapper'];a1_0x2f66=function(){return _0x1daa81;};return a1_0x2f66();}async function findRelatedId(_0x288e55,_0xa86de8,_0x54718b='setpoint'){const _0x3a3f72=a1_0x30ab7f;if(_0x54718b===_0x3a3f72(0x1d7)&&_0x288e55['config'][_0x3a3f72(0x1ed)]){let _0x3a23fe=_0x288e55[_0x3a3f72(0x1c8)]['thermostatMapping'];if(typeof _0x3a23fe===_0x3a3f72(0x1ba))try{_0x3a23fe=JSON['parse'](_0x3a23fe);}catch(_0x5a18a0){}if(_0x3a23fe&&_0x3a23fe[_0xa86de8])return _0x3a23fe[_0xa86de8];}if(_0x54718b===_0x3a3f72(0x1db)&&_0x288e55[_0x3a3f72(0x1c8)][_0x3a3f72(0x20d)]){let _0x5d98f2=_0x288e55['config'][_0x3a3f72(0x20d)];if(typeof _0x5d98f2===_0x3a3f72(0x1ba))try{_0x5d98f2=JSON['parse'](_0x5d98f2);}catch(_0x1e5503){}if(_0x5d98f2&&_0x5d98f2[_0xa86de8])return _0x5d98f2[_0xa86de8];}let _0x169c10=[];if(_0x54718b==='setpoint')_0x169c10=[{'s':_0x3a3f72(0x204),'t':_0x3a3f72(0x1c3)},{'s':'.1.TEMPERATURE','t':_0x3a3f72(0x1c3)},{'s':_0x3a3f72(0x178),'t':_0x3a3f72(0x194)},{'s':_0x3a3f72(0x1ec),'t':_0x3a3f72(0x211)},{'s':_0x3a3f72(0x20b),'t':_0x3a3f72(0x19d)},{'s':_0x3a3f72(0x20b),'t':_0x3a3f72(0x1fe)},{'s':_0x3a3f72(0x1ff),'t':_0x3a3f72(0x1b9)},{'s':_0x3a3f72(0x1c1),'t':_0x3a3f72(0x21b)},{'s':_0x3a3f72(0x1a3),'t':_0x3a3f72(0x1d9)},{'s':_0x3a3f72(0x1ff),'t':_0x3a3f72(0x1d7)}];else _0x54718b===_0x3a3f72(0x1db)&&(_0x169c10=[{'s':_0x3a3f72(0x204),'t':_0x3a3f72(0x1f7)},{'s':'.1.TEMPERATURE','t':_0x3a3f72(0x1f7)},{'s':'.1.TEMPERATURE','t':_0x3a3f72(0x17c)},{'s':'local_temperature','t':_0x3a3f72(0x1a8)},{'s':_0x3a3f72(0x1ff),'t':_0x3a3f72(0x1f4)},{'s':_0x3a3f72(0x1ff),'t':'level'}]);for(const _0x468ec5 of _0x169c10){if(_0xa86de8[_0x3a3f72(0x18f)](_0x468ec5['s'])){const _0x4ee83b=_0xa86de8[_0x3a3f72(0x1cb)](_0x468ec5['s'],_0x468ec5['t']),_0x41a71a=await _0x288e55[_0x3a3f72(0x218)](_0x4ee83b);if(_0x41a71a)return _0x4ee83b;}}try{const _0x1022cb=_0xa86de8[_0x3a3f72(0x1ea)]('.');if(_0x1022cb[_0x3a3f72(0x1e4)]>0x2){const _0x20bb89=_0x1022cb[_0x3a3f72(0x20f)](0x0,-0x1)[_0x3a3f72(0x1a7)]('.'),_0x329bec=await _0x288e55[_0x3a3f72(0x1e0)](_0x20bb89+'.*'),_0x560d92=[],_0x5d670b=_0xa86de8['split'](/[._]+/)['filter'](_0x381509=>![_0x3a3f72(0x20e),'0','hm-rpc','ist',_0x3a3f72(0x186),_0x3a3f72(0x1ff),'actual',_0x3a3f72(0x20c),'messwert','state'][_0x3a3f72(0x18f)](_0x381509[_0x3a3f72(0x206)]()));for(const [_0x32fd42,_0x251084]of Object[_0x3a3f72(0x1d1)](_0x329bec)){if(_0x32fd42===_0xa86de8)continue;if(_0x251084&&_0x251084[_0x3a3f72(0x1cf)]){const _0x1e08b3=_0x32fd42['toLowerCase'](),_0x5db22c=(_0x251084[_0x3a3f72(0x1cf)][_0x3a3f72(0x1e6)]||'')[_0x3a3f72(0x206)](),_0x5197dd=(_0x251084[_0x3a3f72(0x1cf)]['unit']||'')[_0x3a3f72(0x206)]();let _0x1c8ddc=![];if(_0x54718b===_0x3a3f72(0x1d7)&&_0x251084['common'][_0x3a3f72(0x201)]===!![])_0x1c8ddc=_0x1e08b3[_0x3a3f72(0x18f)](_0x3a3f72(0x202))||_0x1e08b3['includes']('soll')||_0x1e08b3['includes']('target')||_0x5db22c[_0x3a3f72(0x18f)](_0x3a3f72(0x199))||_0x5db22c['includes']('thermostat.setpoint');else _0x54718b===_0x3a3f72(0x1db)&&(_0x1c8ddc=_0x1e08b3['includes'](_0x3a3f72(0x1b6))||_0x1e08b3[_0x3a3f72(0x18f)]('valve')||_0x1e08b3['includes']('stellwert')||_0x1e08b3[_0x3a3f72(0x18f)]('position')||_0x5db22c[_0x3a3f72(0x18f)](_0x3a3f72(0x19e))||_0x5db22c[_0x3a3f72(0x18f)]('value.valve')||_0x5197dd[_0x3a3f72(0x18f)]('%'));if(_0x1c8ddc){const _0x1791af=_0x32fd42[_0x3a3f72(0x1ea)](/[._]+/)[_0x3a3f72(0x1d5)](_0x1a77b4=>_0x1a77b4[_0x3a3f72(0x206)]());let _0x3a5a59=0x0;_0x5d670b[_0x3a3f72(0x179)](_0x1d608a=>{const _0x1feeed=_0x3a3f72;if(_0x1791af[_0x1feeed(0x18f)](_0x1d608a[_0x1feeed(0x206)]()))_0x3a5a59++;}),_0x560d92[_0x3a3f72(0x1bf)]({'id':_0x32fd42,'score':_0x3a5a59});}}}if(_0x560d92[_0x3a3f72(0x1e4)]>0x0){_0x560d92[_0x3a3f72(0x1e2)]((_0x5d205f,_0x35a5a6)=>_0x35a5a6[_0x3a3f72(0x19f)]-_0x5d205f[_0x3a3f72(0x19f)]);if(_0x560d92[0x0][_0x3a3f72(0x19f)]>0x0)return _0x560d92[0x0]['id'];}}}catch(_0x3fc228){}return null;}async function scanThermostats(_0x53de49){const _0x1bb44a=a1_0x30ab7f,_0x353b59=_0x53de49['config'][_0x1bb44a(0x1a6)]||[],_0x4404cd=[],_0x31afa2=_0x353b59[_0x1bb44a(0x1d4)](_0x4e3839=>_0x4e3839['id']&&_0x4e3839['id'][_0x1bb44a(0x18f)](_0x1bb44a(0x1ff))||_0x4e3839['type']&&['temperature',_0x1bb44a(0x1f2),'sensor'][_0x1bb44a(0x18f)](_0x4e3839[_0x1bb44a(0x1ee)])||_0x4e3839[_0x1bb44a(0x18b)]&&_0x4e3839[_0x1bb44a(0x18b)]['toLowerCase']()[_0x1bb44a(0x18f)]('temp'));for(const _0x2f9be9 of _0x31afa2){const _0x2004c6=await findRelatedId(_0x53de49,_0x2f9be9['id'],_0x1bb44a(0x1d7)),_0x164696=await findRelatedId(_0x53de49,_0x2f9be9['id'],'valve');let _0x498efb=_0x1bb44a(0x1a4),_0x182c80=![],_0x1cae73=_0x53de49[_0x1bb44a(0x1c8)]['thermostatMapping']||{};if(typeof _0x1cae73===_0x1bb44a(0x1ba))try{_0x1cae73=JSON[_0x1bb44a(0x21a)](_0x1cae73);}catch(_0x2385c9){}let _0x3127a3=_0x53de49[_0x1bb44a(0x1c8)][_0x1bb44a(0x20d)]||{};if(typeof _0x3127a3==='string')try{_0x3127a3=JSON['parse'](_0x3127a3);}catch(_0x6cb0dc){}if(_0x1cae73[_0x2f9be9['id']]&&_0x1cae73[_0x2f9be9['id']]===_0x2004c6||_0x3127a3[_0x2f9be9['id']]&&_0x3127a3[_0x2f9be9['id']]===_0x164696)_0x498efb=_0x1bb44a(0x191),_0x182c80=!![];else(_0x2004c6||_0x164696)&&(_0x498efb='Auto-Erkennung');_0x4404cd['push']({'room':_0x2f9be9[_0x1bb44a(0x17a)]||'Unbekannt','sensorId':_0x2f9be9['id'],'setpointId':_0x2004c6||'-','valveId':_0x164696||'-','source':_0x498efb,'isManual':_0x182c80,'status':_0x2004c6&&_0x164696?_0x1bb44a(0x1f1):_0x2004c6?'OK':_0x1bb44a(0x180)});}return _0x4404cd[_0x1bb44a(0x1e2)]((_0x2430f2,_0x1aaf07)=>_0x2430f2[_0x1bb44a(0x192)][_0x1bb44a(0x1bb)](_0x1aaf07[_0x1bb44a(0x192)]));}async function updateSchedulePreview(_0x1da318){const _0x202dd0=a1_0x30ab7f;if(!_0x1da318[_0x202dd0(0x1c8)][_0x202dd0(0x18c)]||!_0x1da318[_0x202dd0(0x1c8)]['calendarInstance'])return;let _0x36327d={};try{const _0x3b0bc3=await _0x1da318[_0x202dd0(0x1d3)](_0x202dd0(0x1dd));if(_0x3b0bc3&&_0x3b0bc3['val'])_0x36327d=JSON['parse'](_0x3b0bc3['val']);}catch(_0x4142ef){}const _0x20cf88=[],_0x88b8c5=Date[_0x202dd0(0x1e1)](),_0x5014f5=0x30*0x3c*0x3c*0x3e8;try{const _0x138943=await _0x1da318[_0x202dd0(0x171)](_0x1da318[_0x202dd0(0x1c8)]['calendarInstance']+'.data.table');if(!_0x138943||!_0x138943[_0x202dd0(0x175)])return;const _0x4a0095=JSON[_0x202dd0(0x21a)](_0x138943[_0x202dd0(0x175)]),_0x1b87be=_0x1da318['config'][_0x202dd0(0x1bc)]||[],_0x396511=_0x1da318[_0x202dd0(0x1c8)][_0x202dd0(0x1a6)]||[],_0x1a0dea=new Set();_0x396511[_0x202dd0(0x179)](_0x42e94a=>{const _0x5d9bc7=_0x202dd0;if(_0x42e94a[_0x5d9bc7(0x17a)])_0x1a0dea[_0x5d9bc7(0x210)](_0x42e94a[_0x5d9bc7(0x17a)]);});for(const _0x3e2327 of _0x4a0095){if(_0x3e2327[_0x202dd0(0x1e3)]&&_0x1b87be[_0x202dd0(0x1e4)]>0x0&&!_0x1b87be[_0x202dd0(0x18f)](_0x3e2327[_0x202dd0(0x1e3)]))continue;const _0x231867=_0x3e2327['_date']||_0x3e2327[_0x202dd0(0x1c0)]||_0x3e2327[_0x202dd0(0x177)];if(!_0x231867)continue;const _0x4270c7=new Date(_0x231867),_0x438157=_0x4270c7[_0x202dd0(0x205)]();if(isNaN(_0x438157))continue;if(_0x438157<_0x88b8c5)continue;if(_0x438157>_0x88b8c5+_0x5014f5)continue;const _0x3513cb=(_0x3e2327[_0x202dd0(0x189)]||_0x3e2327[_0x202dd0(0x208)]||'')[_0x202dd0(0x206)]();let _0x5be222=![],_0x2c10fd=[],_0x4583ad=_0x3e2327[_0x202dd0(0x189)]||_0x3e2327[_0x202dd0(0x208)]||_0x202dd0(0x1ef);if(_0x3513cb[_0x202dd0(0x18f)](_0x202dd0(0x1ab))||_0x3513cb['includes'](_0x202dd0(0x173))||_0x3513cb[_0x202dd0(0x18f)]('ankunft'))_0x5be222=!![],_0x2c10fd=Array[_0x202dd0(0x1da)](_0x1a0dea);else for(const _0x1a87dc of _0x1a0dea){if(_0x3513cb['includes'](_0x1a87dc['toLowerCase']()))_0x2c10fd[_0x202dd0(0x1bf)](_0x1a87dc);}_0x2c10fd[_0x202dd0(0x1e4)]>0x0&&_0x2c10fd[_0x202dd0(0x179)](_0x226b97=>{const _0x433b95=_0x202dd0;let _0x29addb=0x3c;if(_0x5be222){let _0x2883eb=0x0;Object[_0x433b95(0x187)](_0x36327d)['forEach'](_0x533352=>{if(_0x533352>_0x2883eb)_0x2883eb=_0x533352;}),_0x29addb=_0x2883eb>0x0?_0x2883eb:0x78;}else _0x29addb=_0x36327d[_0x226b97]||0x3c;const _0x46fc46=new Date(_0x438157-_0x29addb*0xea60);_0x20cf88['push']({'eventTime':_0x438157,'triggerTime':_0x46fc46[_0x433b95(0x205)](),'room':_0x226b97,'minutes':_0x29addb,'reason':_0x4583ad,'isGlobal':_0x5be222});});}}catch(_0x9e2fe8){}_0x20cf88[_0x202dd0(0x1e2)]((_0x28fd78,_0x35af8b)=>_0x28fd78[_0x202dd0(0x217)]-_0x35af8b['triggerTime']);const _0x390051=_0x20cf88['slice'](0x0,0x5);await _0x1da318[_0x202dd0(0x190)](_0x202dd0(0x20a),{'val':JSON[_0x202dd0(0x19c)](_0x390051),'ack':!![]});}async function checkCalendarTriggers(_0x18a1cd){const _0x2c2f09=a1_0x30ab7f;if(!_0x18a1cd[_0x2c2f09(0x1c8)][_0x2c2f09(0x18c)]||!_0x18a1cd[_0x2c2f09(0x1c8)][_0x2c2f09(0x184)])return;await updateSchedulePreview(_0x18a1cd);let _0xe392d8={},_0x808e2e={};try{const _0x49b26f=await _0x18a1cd['getStateAsync'](_0x2c2f09(0x1dd));if(_0x49b26f&&_0x49b26f[_0x2c2f09(0x175)])_0xe392d8=JSON[_0x2c2f09(0x21a)](_0x49b26f[_0x2c2f09(0x175)]);const _0x179e87=await _0x18a1cd['getStateAsync'](_0x2c2f09(0x1d6));if(_0x179e87&&_0x179e87['val'])_0x808e2e=JSON['parse'](_0x179e87[_0x2c2f09(0x175)]);}catch(_0x26b4af){}let _0x17192d={'default':0x15};try{const _0x1f37a1=await _0x18a1cd[_0x2c2f09(0x1d3)](_0x2c2f09(0x1f5));if(_0x1f37a1&&_0x1f37a1[_0x2c2f09(0x175)])_0x17192d=JSON[_0x2c2f09(0x21a)](_0x1f37a1[_0x2c2f09(0x175)]);}catch(_0x291b47){}try{const _0x4a94da=await _0x18a1cd['getForeignStateAsync'](_0x18a1cd[_0x2c2f09(0x1c8)]['calendarInstance']+_0x2c2f09(0x1d0));if(!_0x4a94da||!_0x4a94da[_0x2c2f09(0x175)])return;const _0x4a7b58=JSON[_0x2c2f09(0x21a)](_0x4a94da[_0x2c2f09(0x175)]),_0x4b227d=Date['now'](),_0x4d290b=_0x18a1cd[_0x2c2f09(0x1c8)]['devices']||[],_0x1ff8d4=_0x18a1cd['config'][_0x2c2f09(0x1bc)]||[];for(const _0x1b718f of _0x4a7b58){if(_0x1b718f['_calName']&&_0x1ff8d4[_0x2c2f09(0x1e4)]>0x0&&!_0x1ff8d4[_0x2c2f09(0x18f)](_0x1b718f[_0x2c2f09(0x1e3)]))continue;const _0x510e80=_0x1b718f[_0x2c2f09(0x1aa)]||_0x1b718f[_0x2c2f09(0x1c0)]||_0x1b718f[_0x2c2f09(0x177)];if(!_0x510e80)continue;const _0xc90f84=new Date(_0x510e80);if(isNaN(_0xc90f84[_0x2c2f09(0x205)]()))continue;const _0x28fa15=(_0x1b718f['event']||_0x1b718f[_0x2c2f09(0x208)]||'')[_0x2c2f09(0x206)]();if(_0x28fa15[_0x2c2f09(0x18f)](_0x2c2f09(0x1ab))||_0x28fa15[_0x2c2f09(0x18f)](_0x2c2f09(0x173))||_0x28fa15[_0x2c2f09(0x18f)](_0x2c2f09(0x1ae))){let _0x1f3101=0x0;Object['values'](_0xe392d8)[_0x2c2f09(0x179)](_0x243409=>{if(_0x243409>_0x1f3101)_0x1f3101=_0x243409;});if(_0x1f3101===0x0)_0x1f3101=0x78;const _0x3a908a=_0xc90f84[_0x2c2f09(0x205)]()-_0x1f3101*0xea60;_0x4b227d>=_0x3a908a&&_0x4b227d<_0xc90f84[_0x2c2f09(0x205)]()&&(_0x18a1cd[_0x2c2f09(0x185)]!==_0x2c2f09(0x1f8)&&(_0x18a1cd[_0x2c2f09(0x216)][_0x2c2f09(0x1b5)](_0x2c2f09(0x18a)+_0x1f3101+_0x2c2f09(0x181)),await _0x18a1cd[_0x2c2f09(0x190)](_0x2c2f09(0x16f),{'val':_0x2c2f09(0x1f8),'ack':![]})));}for(const _0x235349 of _0x4d290b){if(_0x235349[_0x2c2f09(0x17a)]){const _0x3d0368=_0x235349[_0x2c2f09(0x17a)]['toLowerCase']();if(_0x28fa15[_0x2c2f09(0x18f)](_0x3d0368)){const _0x23c20f=_0xe392d8[_0x235349[_0x2c2f09(0x17a)]]||0x3c,_0x118681=_0x808e2e[_0x235349['location']]||_0x2c2f09(0x1a1),_0x557c08=_0xc90f84['getTime']()-_0x23c20f*0xea60;if(_0x4b227d>=_0x557c08&&_0x4b227d<_0xc90f84['getTime']()){const _0x4965ec=lastActions[_0x2c2f09(0x176)+_0x235349[_0x2c2f09(0x17a)]];if(_0x4965ec&&_0x4b227d-_0x4965ec<CAL_COOLDOWN_MS)continue;const _0x2532cf=await findRelatedId(_0x18a1cd,_0x235349['id'],_0x2c2f09(0x1d7));if(_0x2532cf){let _0x11fec4=_0x17192d[_0x235349[_0x2c2f09(0x17a)]];if(_0x11fec4===undefined)_0x11fec4=_0x17192d['default'];if(_0x11fec4===undefined)_0x11fec4=0x15;const _0xf9c1a7=await _0x18a1cd[_0x2c2f09(0x171)](_0x2532cf);_0xf9c1a7&&typeof _0xf9c1a7[_0x2c2f09(0x175)]===_0x2c2f09(0x1e9)&&_0xf9c1a7[_0x2c2f09(0x175)]<_0x11fec4-0.5&&(_0x18a1cd[_0x2c2f09(0x216)][_0x2c2f09(0x1b5)](_0x2c2f09(0x1e8)+_0x118681+_0x2c2f09(0x209)+_0x235349[_0x2c2f09(0x17a)]+_0x2c2f09(0x1bd)+_0x11fec4+_0x2c2f09(0x198)+_0x23c20f+_0x2c2f09(0x181)),await _0x18a1cd[_0x2c2f09(0x1ac)](_0x2532cf,_0x11fec4),await logAutomationAction(_0x18a1cd,_0x2c2f09(0x170)+_0x235349[_0x2c2f09(0x17a)]+'\x20->\x20'+_0x11fec4+'¬∞C\x20(via\x20'+_0x118681+')'),lastActions[_0x2c2f09(0x176)+_0x235349[_0x2c2f09(0x17a)]]=_0x4b227d);}}}}}}}catch(_0x5292b8){_0x18a1cd['log'][_0x2c2f09(0x1d2)](_0x2c2f09(0x1b4)+_0x5292b8[_0x2c2f09(0x1d8)]);}}async function manageMpcIntervention(_0x5ce3d3,_0x5bc97b,_0x1cc161){const _0x43600f=a1_0x30ab7f;try{const _0x29454a=_0x43600f(0x1c7),_0xf1593b=await _0x5ce3d3[_0x43600f(0x1d3)](_0x29454a);let _0x32b662=[];if(_0xf1593b&&_0xf1593b['val'])try{_0x32b662=JSON[_0x43600f(0x21a)](_0xf1593b[_0x43600f(0x175)]);}catch(_0x5da2bf){}const _0x30f0e7=_0x32b662['indexOf'](_0x5bc97b);if(_0x1cc161==='add')_0x30f0e7===-0x1&&(_0x32b662[_0x43600f(0x1bf)](_0x5bc97b),await _0x5ce3d3[_0x43600f(0x190)](_0x29454a,{'val':JSON[_0x43600f(0x19c)](_0x32b662),'ack':!![]}));else _0x1cc161===_0x43600f(0x1a5)&&(_0x30f0e7!==-0x1&&(_0x32b662[_0x43600f(0x19b)](_0x30f0e7,0x1),await _0x5ce3d3[_0x43600f(0x190)](_0x29454a,{'val':JSON[_0x43600f(0x19c)](_0x32b662),'ack':!![]})));}catch(_0x5a0fe0){}}async function cleanupGhostInterventions(_0xf310e9){const _0x5eee73=a1_0x30ab7f;try{const _0x25d10e=_0x5eee73(0x1c7),_0x1ac681=await _0xf310e9[_0x5eee73(0x1d3)](_0x25d10e);if(!_0x1ac681||!_0x1ac681['val'])return;const _0x56ce5d=JSON[_0x5eee73(0x21a)](_0x1ac681[_0x5eee73(0x175)]);if(!Array['isArray'](_0x56ce5d)||_0x56ce5d[_0x5eee73(0x1e4)]===0x0)return;let _0x53e2e5={'default':0x15};try{const _0x12ef3d=await _0xf310e9[_0x5eee73(0x1d3)](_0x5eee73(0x1f5));if(_0x12ef3d&&_0x12ef3d[_0x5eee73(0x175)])_0x53e2e5=JSON[_0x5eee73(0x21a)](_0x12ef3d['val']);}catch(_0xfded9){}let _0x582e32=[];try{const _0x4b6f82=await _0xf310e9[_0x5eee73(0x1d3)](_0x5eee73(0x1f9));if(_0x4b6f82&&_0x4b6f82['val'])_0x582e32=JSON[_0x5eee73(0x21a)](_0x4b6f82[_0x5eee73(0x175)]);}catch(_0x3d3591){}const _0x519134=_0xf310e9[_0x5eee73(0x1c8)][_0x5eee73(0x1a6)]||[];let _0x5d5363=![];for(let _0x536d06=_0x56ce5d[_0x5eee73(0x1e4)]-0x1;_0x536d06>=0x0;_0x536d06--){const _0x305dc7=_0x56ce5d[_0x536d06],_0x107456=_0x519134['find'](_0x5e820f=>normalize(_0x5e820f[_0x5eee73(0x17a)])===normalize(_0x305dc7)&&(_0x5e820f['type']===_0x5eee73(0x1ff)||_0x5e820f[_0x5eee73(0x1ee)]==='thermostat'));if(!_0x107456){_0xf310e9[_0x5eee73(0x216)][_0x5eee73(0x1d2)]('üßπ\x20[MPC\x20CLEANUP]\x20Raum\x20\x27'+_0x305dc7+_0x5eee73(0x18e)),_0x56ce5d['splice'](_0x536d06,0x1),_0x5d5363=!![];continue;}if(_0x107456){const _0x1a4173=await findRelatedId(_0xf310e9,_0x107456['id'],_0x5eee73(0x1d7)),_0x434f5c=await _0xf310e9[_0x5eee73(0x171)](_0x107456['id']);if(_0x1a4173){const _0x12118c=await _0xf310e9[_0x5eee73(0x171)](_0x1a4173);if(_0x12118c&&typeof _0x12118c['val']===_0x5eee73(0x1e9)){let _0x4f4413=![],_0x396748='';Math['abs'](_0x12118c[_0x5eee73(0x175)]-ECO_TEMP)>0.5&&(_0x4f4413=!![],_0x396748=_0x5eee73(0x1a9));if(!_0x4f4413&&_0x434f5c&&typeof _0x434f5c[_0x5eee73(0x175)]===_0x5eee73(0x1e9)){const _0x1a92d9=_0x53e2e5[_0x305dc7]||_0x53e2e5[_0x5eee73(0x1b7)]||0x15;_0x434f5c[_0x5eee73(0x175)]<_0x1a92d9+0.2&&(_0x4f4413=!![],_0x396748=_0x5eee73(0x1fd));}if(_0x4f4413){if(_0x396748===_0x5eee73(0x1a9)){_0xf310e9[_0x5eee73(0x216)]['info'](_0x5eee73(0x1de)+_0x305dc7+'\x20ist\x20auf\x20'+_0x12118c['val']+'¬∞C\x20(nicht\x20'+ECO_TEMP+'¬∞C).\x20Entferne\x20Status.');const _0x15700b=lastActions[_0x5eee73(0x176)+_0x305dc7],_0x65e9e9=_0x15700b&&Date[_0x5eee73(0x1e1)]()-_0x15700b<0x2*0x3c*0x3e8;if(!_0x65e9e9&&_0x12118c['val']>ECO_TEMP+0.5)_0xf310e9[_0x5eee73(0x1cd)]&&(_0xf310e9[_0x5eee73(0x216)][_0x5eee73(0x1b5)](_0x5eee73(0x17b)+_0x305dc7+'\x20wurde\x20manuell\x20erh√∂ht.'),_0xf310e9['sendToPythonWrapper'](_0x5eee73(0x18d),{'room':_0x305dc7}));else _0x65e9e9&&_0xf310e9[_0x5eee73(0x216)]['info']('üìÖ\x20[MPC\x20INFO]\x20'+_0x305dc7+_0x5eee73(0x1b2));}else{if(_0x396748===_0x5eee73(0x1fd)){let _0x12f127=![];if(_0x582e32['find'](_0x5349ed=>_0x5349ed[_0x5eee73(0x192)]===_0x305dc7))_0x12f127=!![];const _0x53ef29=_0x519134[_0x5eee73(0x1d4)](_0x4e9ca3=>normalize(_0x4e9ca3['location'])===normalize(_0x305dc7)&&(_0x4e9ca3[_0x5eee73(0x1ee)]===_0x5eee73(0x1dc)||_0x4e9ca3[_0x5eee73(0x1ee)]==='sensor'||_0x4e9ca3[_0x5eee73(0x1ee)]===_0x5eee73(0x203)));for(const _0x437a7f of _0x53ef29){try{const _0x442919=await _0xf310e9[_0x5eee73(0x171)](_0x437a7f['id']);if(_0x442919&&(_0x442919[_0x5eee73(0x175)]===!![]||_0x442919['val']===0x1||String(_0x442919[_0x5eee73(0x175)])[_0x5eee73(0x206)]()===_0x5eee73(0x1f0)))_0x12f127=!![];}catch(_0x1dd2de){}}if(_0x12f127)_0xf310e9[_0x5eee73(0x216)][_0x5eee73(0x1b5)]('üå¨Ô∏è\x20[MPC\x20WATCHDOG]\x20'+_0x305dc7+'\x20ist\x20zu\x20kalt,\x20ABER\x20Fenster\x20offen/L√ºftung\x20erkannt.\x20Heize\x20NICHT,\x20entferne\x20nur\x20Status.');else{const _0x53940d=_0x53e2e5[_0x305dc7]||_0x53e2e5['default']||0x15;_0xf310e9[_0x5eee73(0x216)][_0x5eee73(0x1b5)](_0x5eee73(0x1e7)+_0x305dc7+'\x20erreicht\x20Limit\x20('+_0x434f5c['val']+_0x5eee73(0x1c9)+(_0x53940d+0.2)+_0x5eee73(0x188)),await _0xf310e9[_0x5eee73(0x1ac)](_0x1a4173,_0x53940d),await logAutomationAction(_0xf310e9,_0x5eee73(0x172)+_0x305dc7+':\x20Puffer\x20leer\x20->\x20Heizen\x20auf\x20'+_0x53940d+'¬∞C'),lastActions['rescue_'+_0x305dc7]=Date[_0x5eee73(0x1e1)]();}}}_0x56ce5d[_0x5eee73(0x19b)](_0x536d06,0x1),_0x5d5363=!![];}}}}}_0x5d5363&&await _0xf310e9[_0x5eee73(0x190)](_0x25d10e,{'val':JSON['stringify'](_0x56ce5d),'ack':!![]});}catch(_0x596209){}}async function applyEnergySavings(_0x1e6bf3,_0xcdfca3){const _0x195928=a1_0x30ab7f;await cleanupGhostInterventions(_0x1e6bf3);if(!_0xcdfca3||_0xcdfca3[_0x195928(0x1e4)]===0x0)return;const _0x3bd49a=_0x1e6bf3[_0x195928(0x1c8)][_0x195928(0x1a6)]||[],_0x5a1434=Date[_0x195928(0x1e1)]();for(const _0x3603ed of _0xcdfca3){const _0x480500=_0x3603ed[_0x195928(0x192)],_0x40ebdd=_0x3603ed[_0x195928(0x1a2)],_0x464937=_0x3603ed[_0x195928(0x1af)]||0x15;if(lastActions[_0x195928(0x1cc)+_0x480500]&&_0x5a1434-lastActions[_0x195928(0x1cc)+_0x480500]<RESCUE_LOCK_MS)continue;const _0xe10b87=_0x3bd49a['find'](_0x17c717=>normalize(_0x17c717[_0x195928(0x17a)])===normalize(_0x480500)&&(_0x17c717[_0x195928(0x1ee)]===_0x195928(0x1ff)||_0x17c717['type']===_0x195928(0x1f2)));if(!_0xe10b87)continue;const _0x294f41=await findRelatedId(_0x1e6bf3,_0xe10b87['id'],_0x195928(0x1d7));if(_0x294f41){if(lastActions['mpc_'+_0x480500]&&_0x5a1434-lastActions['mpc_'+_0x480500]<0x1e*0x3c*0x3e8)continue;const _0x592e56=await _0x1e6bf3[_0x195928(0x171)](_0x294f41);if(_0x592e56&&typeof _0x592e56[_0x195928(0x175)]===_0x195928(0x1e9)){const _0x37a6e7=_0x592e56[_0x195928(0x175)];_0x37a6e7!==ECO_TEMP&&await manageMpcIntervention(_0x1e6bf3,_0x480500,_0x195928(0x1a5));if(_0x40ebdd>0x1e)_0x37a6e7>ECO_TEMP+0.5&&(_0x1e6bf3[_0x195928(0x216)][_0x195928(0x1b5)]('üçÉ\x20[MPC\x20ACTION]\x20Senke\x20'+_0x480500+'\x20auf\x20'+ECO_TEMP+_0x195928(0x16e)+_0x40ebdd+_0x195928(0x215)),await _0x1e6bf3[_0x195928(0x1ac)](_0x294f41,ECO_TEMP),await manageMpcIntervention(_0x1e6bf3,_0x480500,'add'),lastActions[_0x195928(0x19a)+_0x480500]=_0x5a1434,await logAutomationAction(_0x1e6bf3,'[MPC]\x20'+_0x480500+_0x195928(0x1f6)+ECO_TEMP+'¬∞C'));else _0x40ebdd<=0xf&&(_0x37a6e7<_0x464937&&(_0x1e6bf3['log']['info'](_0x195928(0x1ca)+_0x480500+_0x195928(0x17e)+_0x464937+'¬∞C!\x20(Puffer\x20leer).'),await _0x1e6bf3[_0x195928(0x1ac)](_0x294f41,_0x464937),await manageMpcIntervention(_0x1e6bf3,_0x480500,_0x195928(0x1a5)),lastActions[_0x195928(0x19a)+_0x480500]=_0x5a1434,await logAutomationAction(_0x1e6bf3,_0x195928(0x17f)+_0x480500+':\x20Aufheizen\x20auf\x20'+_0x464937+'¬∞C')));}}else _0x1e6bf3[_0x195928(0x216)]['warn'](_0x195928(0x1b3)+_0x480500+_0x195928(0x1b8));}}module[a1_0x30ab7f(0x174)]={'handlePrediction':handlePrediction,'applyEnergySavings':applyEnergySavings,'scanThermostats':scanThermostats,'checkCalendarTriggers':checkCalendarTriggers,'updateSchedulePreview':updateSchedulePreview,'cleanupGhostInterventions':cleanupGhostInterventions};