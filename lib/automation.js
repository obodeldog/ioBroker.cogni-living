const a1_0x48af89=a1_0x2553;(function(_0x560f31,_0x17a1e5){const _0x1e39a9=a1_0x2553,_0x30259a=_0x560f31();while(!![]){try{const _0x2125d3=parseInt(_0x1e39a9(0x115))/0x1*(-parseInt(_0x1e39a9(0x166))/0x2)+parseInt(_0x1e39a9(0x136))/0x3*(-parseInt(_0x1e39a9(0x110))/0x4)+-parseInt(_0x1e39a9(0x101))/0x5+parseInt(_0x1e39a9(0xf6))/0x6*(-parseInt(_0x1e39a9(0xeb))/0x7)+parseInt(_0x1e39a9(0x11a))/0x8+-parseInt(_0x1e39a9(0x15a))/0x9+parseInt(_0x1e39a9(0x13f))/0xa;if(_0x2125d3===_0x17a1e5)break;else _0x30259a['push'](_0x30259a['shift']());}catch(_0x5761ea){_0x30259a['push'](_0x30259a['shift']());}}}(a1_0x2f6a,0xa4387));const a1_0x4da4b0=(function(){let _0x5d865e=!![];return function(_0x495cef,_0x569b12){const _0x5aed40=_0x5d865e?function(){const _0xd18b0=a1_0x2553;if(_0x569b12){const _0x5aadde=_0x569b12[_0xd18b0(0x121)](_0x495cef,arguments);return _0x569b12=null,_0x5aadde;}}:function(){};return _0x5d865e=![],_0x5aed40;};}()),a1_0x45cac9=a1_0x4da4b0(this,function(){const _0x364e95=a1_0x2553;return a1_0x45cac9[_0x364e95(0x152)]()['search'](_0x364e95(0xe9))[_0x364e95(0x152)]()[_0x364e95(0x109)](a1_0x45cac9)[_0x364e95(0xf5)](_0x364e95(0xe9));});a1_0x45cac9();'use strict';const aiAgent=require('./ai_agent'),COOLDOWN_MS=0x3c*0x3e8,CAL_COOLDOWN_MS=0x5a*0x3c*0x3e8,ECO_TEMP=0x11,lastActions={};function a1_0x2553(_0x11ba4d,_0x96e86d){const _0x2c780d=a1_0x2f6a();return a1_0x2553=function(_0x45cac9,_0x4da4b0){_0x45cac9=_0x45cac9-0xcd;let _0x2f6ad5=_0x2c780d[_0x45cac9];return _0x2f6ad5;},a1_0x2553(_0x11ba4d,_0x96e86d);}function normalize(_0x136b2a){const _0x2862d0=a1_0x2553;if(!_0x136b2a)return'';return _0x136b2a['toLowerCase']()[_0x2862d0(0x15d)](/\s+/g,'')[_0x2862d0(0xe2)]();}async function logAutomationAction(_0x34b05d,_0x31b146){const _0x5aa73e=a1_0x2553;await _0x34b05d[_0x5aa73e(0x147)]('analysis.automation.lastAction',{'val':_0x31b146,'ack':!![]});try{const _0x215112=_0x5aa73e(0xe3),_0x29298f=await _0x34b05d[_0x5aa73e(0x11c)](_0x215112);let _0x2d6a=[];if(_0x29298f&&_0x29298f[_0x5aa73e(0x13b)])try{_0x2d6a=JSON[_0x5aa73e(0xfb)](_0x29298f[_0x5aa73e(0x13b)]);}catch(_0x1e5278){}_0x2d6a[_0x5aa73e(0x14d)]({'ts':Date[_0x5aa73e(0x168)](),'msg':_0x31b146});if(_0x2d6a[_0x5aa73e(0x114)]>0x32)_0x2d6a=_0x2d6a['slice'](0x0,0x32);await _0x34b05d[_0x5aa73e(0x147)](_0x215112,{'val':JSON[_0x5aa73e(0x139)](_0x2d6a),'ack':!![]});}catch(_0x39ee96){}}async function handlePrediction(_0x42bfe6,_0x2cad90,_0x2c9983){const _0x488394=a1_0x2553;if(!_0x2cad90||_0x2cad90===_0x488394(0x11b))return;let _0x13740c=_0x488394(0x12f),_0xacfd7c=0.6;try{const _0x32f759=await _0x42bfe6['getStateAsync'](_0x488394(0xde));if(_0x32f759&&_0x32f759[_0x488394(0x13b)])_0x13740c=_0x32f759[_0x488394(0x13b)];const _0x190f15=await _0x42bfe6['getStateAsync'](_0x488394(0x16c));if(_0x190f15&&_0x190f15[_0x488394(0x13b)])_0xacfd7c=_0x190f15[_0x488394(0x13b)];}catch(_0x2f6006){}if(_0x13740c===_0x488394(0x12f)||_0x2c9983<_0xacfd7c)return;const _0x3560f5=Date['now']();if(lastActions[_0x2cad90]&&_0x3560f5-lastActions[_0x2cad90]<COOLDOWN_MS)return;const _0x2f4f01=_0x42bfe6[_0x488394(0x156)][_0x488394(0x106)]||[],_0x50ed5f=normalize(_0x2cad90),_0x53b43a=_0x2f4f01['find'](_0x444938=>normalize(_0x444938[_0x488394(0x134)])===_0x50ed5f&&(_0x444938['type']==='light'||_0x444938[_0x488394(0x122)]===_0x488394(0x169)||_0x444938[_0x488394(0x122)]===_0x488394(0x15e)));if(!_0x53b43a)return;const _0x3f7705=await aiAgent[_0x488394(0x128)](_0x42bfe6,_0x2cad90,_0x53b43a['name'],_0x2c9983);if(!_0x3f7705[_0x488394(0xd6)])return;const _0x3e80ad=_0x488394(0x13a)+_0x2cad90+_0x488394(0x153)+_0x53b43a[_0x488394(0x167)]+'\x20('+_0x3f7705[_0x488394(0x145)]+')';await logAutomationAction(_0x42bfe6,'['+_0x13740c[_0x488394(0x123)]()+']\x20'+_0x3e80ad);if(_0x13740c===_0x488394(0xce)){const _0x430a81=await _0x42bfe6['getForeignStateAsync'](_0x53b43a['id']);(!_0x430a81||!_0x430a81[_0x488394(0x13b)]&&_0x430a81[_0x488394(0x13b)]!==!![])&&await _0x42bfe6[_0x488394(0x119)](_0x53b43a['id'],!![]),lastActions[_0x2cad90]=_0x3560f5;}}async function findRelatedId(_0x549e3f,_0x5c7940,_0x242b19=a1_0x48af89(0x113)){const _0x1ea269=a1_0x48af89;if(_0x242b19===_0x1ea269(0x113)&&_0x549e3f[_0x1ea269(0x156)]['thermostatMapping']){let _0x147c1b=_0x549e3f[_0x1ea269(0x156)][_0x1ea269(0xdc)];if(typeof _0x147c1b===_0x1ea269(0xcd))try{_0x147c1b=JSON[_0x1ea269(0xfb)](_0x147c1b);}catch(_0x539a79){}if(_0x147c1b&&_0x147c1b[_0x5c7940])return _0x147c1b[_0x5c7940];}if(_0x242b19===_0x1ea269(0xf2)&&_0x549e3f['config'][_0x1ea269(0xec)]){let _0x3fd0c9=_0x549e3f['config'][_0x1ea269(0xec)];if(typeof _0x3fd0c9===_0x1ea269(0xcd))try{_0x3fd0c9=JSON['parse'](_0x3fd0c9);}catch(_0x148b15){}if(_0x3fd0c9&&_0x3fd0c9[_0x5c7940])return _0x3fd0c9[_0x5c7940];}let _0x5f3e73=[];if(_0x242b19==='setpoint')_0x5f3e73=[{'s':_0x1ea269(0x10c),'t':_0x1ea269(0xf1)},{'s':_0x1ea269(0x118),'t':'.1.SET_POINT_TEMPERATURE'},{'s':'.1.TEMPERATURE','t':_0x1ea269(0x12d)},{'s':'ACTUAL_TEMPERATURE','t':_0x1ea269(0xf4)},{'s':_0x1ea269(0xfa),'t':'occupied_heating_setpoint'},{'s':_0x1ea269(0xfa),'t':'current_heating_setpoint'},{'s':_0x1ea269(0x165),'t':_0x1ea269(0x144)},{'s':'ACTUAL','t':_0x1ea269(0x11f)},{'s':_0x1ea269(0x158),'t':_0x1ea269(0x155)},{'s':_0x1ea269(0x165),'t':_0x1ea269(0x113)}];else _0x242b19===_0x1ea269(0xf2)&&(_0x5f3e73=[{'s':_0x1ea269(0x10c),'t':'.1.LEVEL'},{'s':_0x1ea269(0x118),'t':_0x1ea269(0x13e)},{'s':'.1.TEMPERATURE','t':_0x1ea269(0x131)},{'s':_0x1ea269(0xfa),'t':_0x1ea269(0x148)},{'s':_0x1ea269(0x165),'t':'valve_position'},{'s':_0x1ea269(0x165),'t':_0x1ea269(0x12a)}]);for(const _0x16c179 of _0x5f3e73){if(_0x5c7940['includes'](_0x16c179['s'])){const _0x59a6ef=_0x5c7940['replace'](_0x16c179['s'],_0x16c179['t']),_0x29474d=await _0x549e3f[_0x1ea269(0x157)](_0x59a6ef);if(_0x29474d)return _0x59a6ef;}}try{const _0x5ad4bd=_0x5c7940[_0x1ea269(0xff)]('.');if(_0x5ad4bd['length']>0x2){const _0x529f99=_0x5ad4bd[_0x1ea269(0x120)](0x0,-0x1)[_0x1ea269(0x140)]('.'),_0x1cc18b=await _0x549e3f[_0x1ea269(0x116)](_0x529f99+'.*'),_0x36386b=[],_0x5ac087=_0x5c7940['split'](/[._]+/)['filter'](_0x13f9aa=>!['openknx','0','hm-rpc','ist',_0x1ea269(0x16b),'temperature',_0x1ea269(0x151),_0x1ea269(0x12e),_0x1ea269(0xed),_0x1ea269(0xfc)][_0x1ea269(0x161)](_0x13f9aa['toLowerCase']()));for(const [_0x25eae6,_0x46d005]of Object['entries'](_0x1cc18b)){if(_0x25eae6===_0x5c7940)continue;if(_0x46d005&&_0x46d005[_0x1ea269(0x164)]){const _0x575c88=_0x25eae6[_0x1ea269(0x11e)](),_0x525cb4=(_0x46d005['common']['role']||'')['toLowerCase'](),_0x135893=(_0x46d005[_0x1ea269(0x164)]['unit']||'')[_0x1ea269(0x11e)]();let _0x12e16b=![];if(_0x242b19==='setpoint'&&_0x46d005[_0x1ea269(0x164)]['write']===!![])_0x12e16b=_0x575c88['includes'](_0x1ea269(0x13d))||_0x575c88[_0x1ea269(0x161)](_0x1ea269(0x162))||_0x575c88[_0x1ea269(0x161)](_0x1ea269(0x124))||_0x525cb4[_0x1ea269(0x161)]('level.temperature')||_0x525cb4[_0x1ea269(0x161)](_0x1ea269(0x132));else _0x242b19==='valve'&&(_0x12e16b=_0x575c88[_0x1ea269(0x161)](_0x1ea269(0x12a))||_0x575c88[_0x1ea269(0x161)]('valve')||_0x575c88[_0x1ea269(0x161)](_0x1ea269(0x15c))||_0x575c88['includes'](_0x1ea269(0x130))||_0x525cb4[_0x1ea269(0x161)](_0x1ea269(0xdd))||_0x525cb4[_0x1ea269(0x161)](_0x1ea269(0x103))||_0x135893['includes']('%'));if(_0x12e16b){const _0x1a3891=_0x25eae6['split'](/[._]+/)[_0x1ea269(0xf3)](_0x140a72=>_0x140a72[_0x1ea269(0x11e)]());let _0x192cda=0x0;_0x5ac087['forEach'](_0x59b3b4=>{const _0x4a857f=_0x1ea269;if(_0x1a3891['includes'](_0x59b3b4[_0x4a857f(0x11e)]()))_0x192cda++;}),_0x36386b[_0x1ea269(0xf8)]({'id':_0x25eae6,'score':_0x192cda});}}}if(_0x36386b[_0x1ea269(0x114)]>0x0){_0x36386b['sort']((_0x3c4a26,_0x3e02be)=>_0x3e02be[_0x1ea269(0xf7)]-_0x3c4a26[_0x1ea269(0xf7)]);if(_0x36386b[0x0]['score']>0x0)return _0x36386b[0x0]['id'];}}}catch(_0x256e9){}return null;}async function scanThermostats(_0x14e181){const _0xbd8e35=a1_0x48af89,_0x18973c=_0x14e181[_0xbd8e35(0x156)][_0xbd8e35(0x106)]||[],_0x1f775f=[],_0x5ad02e=_0x18973c[_0xbd8e35(0xda)](_0x29735e=>_0x29735e['id']&&_0x29735e['id'][_0xbd8e35(0x161)](_0xbd8e35(0x165))||_0x29735e[_0xbd8e35(0x122)]&&[_0xbd8e35(0x165),_0xbd8e35(0xd7),'sensor'][_0xbd8e35(0x161)](_0x29735e[_0xbd8e35(0x122)])||_0x29735e['name']&&_0x29735e['name'][_0xbd8e35(0x11e)]()[_0xbd8e35(0x161)](_0xbd8e35(0x107)));for(const _0x11a071 of _0x5ad02e){const _0x5ad48a=await findRelatedId(_0x14e181,_0x11a071['id'],_0xbd8e35(0x113)),_0x5e355d=await findRelatedId(_0x14e181,_0x11a071['id'],_0xbd8e35(0xf2));let _0x27f702=_0xbd8e35(0xcf),_0x2d4350=![],_0x350218=_0x14e181[_0xbd8e35(0x156)][_0xbd8e35(0xdc)]||{};if(typeof _0x350218==='string')try{_0x350218=JSON[_0xbd8e35(0xfb)](_0x350218);}catch(_0x5c5a2e){}let _0x582d28=_0x14e181[_0xbd8e35(0x156)]['valveMapping']||{};if(typeof _0x582d28===_0xbd8e35(0xcd))try{_0x582d28=JSON['parse'](_0x582d28);}catch(_0x3d9918){}if(_0x350218[_0x11a071['id']]&&_0x350218[_0x11a071['id']]===_0x5ad48a||_0x582d28[_0x11a071['id']]&&_0x582d28[_0x11a071['id']]===_0x5e355d)_0x27f702=_0xbd8e35(0x129),_0x2d4350=!![];else(_0x5ad48a||_0x5e355d)&&(_0x27f702='Auto-Erkennung');_0x1f775f['push']({'room':_0x11a071[_0xbd8e35(0x134)]||_0xbd8e35(0xfe),'sensorId':_0x11a071['id'],'setpointId':_0x5ad48a||'-','valveId':_0x5e355d||'-','source':_0x27f702,'isManual':_0x2d4350,'status':_0x5ad48a&&_0x5e355d?'PERFECT':_0x5ad48a?'OK':'Fehlt'});}return _0x1f775f['sort']((_0x2afe20,_0x34886b)=>_0x2afe20[_0xbd8e35(0xe7)][_0xbd8e35(0xf9)](_0x34886b[_0xbd8e35(0xe7)]));}async function updateSchedulePreview(_0x5308dd){const _0x126511=a1_0x48af89;if(!_0x5308dd[_0x126511(0x156)][_0x126511(0xd4)]||!_0x5308dd[_0x126511(0x156)][_0x126511(0xd2)])return;let _0x357934={};try{const _0x5e032a=await _0x5308dd['getStateAsync'](_0x126511(0x141));if(_0x5e032a&&_0x5e032a[_0x126511(0x13b)])_0x357934=JSON[_0x126511(0xfb)](_0x5e032a['val']);}catch(_0x4adbc7){}const _0x5339a2=[],_0x35eee1=Date[_0x126511(0x168)](),_0x30f886=0x30*0x3c*0x3c*0x3e8;try{const _0x3611c4=await _0x5308dd[_0x126511(0x10e)](_0x5308dd[_0x126511(0x156)]['calendarInstance']+_0x126511(0xd0));if(!_0x3611c4||!_0x3611c4['val'])return;const _0x50da4b=JSON[_0x126511(0xfb)](_0x3611c4[_0x126511(0x13b)]),_0x517cf5=_0x5308dd['config'][_0x126511(0x112)]||[],_0x5f0404=_0x5308dd[_0x126511(0x156)][_0x126511(0x106)]||[],_0x1fc914=new Set();_0x5f0404['forEach'](_0x4c41b2=>{const _0x354d0d=_0x126511;if(_0x4c41b2['location'])_0x1fc914[_0x354d0d(0xe8)](_0x4c41b2[_0x354d0d(0x134)]);});for(const _0x30bc77 of _0x50da4b){if(_0x30bc77[_0x126511(0x11d)]&&_0x517cf5['length']>0x0&&!_0x517cf5[_0x126511(0x161)](_0x30bc77[_0x126511(0x11d)]))continue;const _0x178968=_0x30bc77[_0x126511(0x159)]||_0x30bc77[_0x126511(0x138)]||_0x30bc77['date'];if(!_0x178968)continue;const _0xdac4ab=new Date(_0x178968),_0x2dc2a3=_0xdac4ab[_0x126511(0x14a)]();if(isNaN(_0x2dc2a3))continue;if(_0x2dc2a3<_0x35eee1)continue;if(_0x2dc2a3>_0x35eee1+_0x30f886)continue;const _0xb3cc7a=(_0x30bc77[_0x126511(0x149)]||_0x30bc77[_0x126511(0xdb)]||'')[_0x126511(0x11e)]();let _0x3a9a30=![],_0x44b322=[],_0x76ef1f=_0x30bc77[_0x126511(0x149)]||_0x30bc77['summary']||_0x126511(0xfe);if(_0xb3cc7a[_0x126511(0x161)](_0x126511(0x146))||_0xb3cc7a[_0x126511(0x161)](_0x126511(0x14b))||_0xb3cc7a[_0x126511(0x161)]('ankunft'))_0x3a9a30=!![],_0x44b322=Array[_0x126511(0x117)](_0x1fc914);else for(const _0x49d3a0 of _0x1fc914){if(_0xb3cc7a[_0x126511(0x161)](_0x49d3a0[_0x126511(0x11e)]()))_0x44b322[_0x126511(0xf8)](_0x49d3a0);}_0x44b322[_0x126511(0x114)]>0x0&&_0x44b322['forEach'](_0x349bf5=>{const _0x321621=_0x126511;let _0x2ef102=0x3c;if(_0x3a9a30){let _0x3e7371=0x0;Object[_0x321621(0x102)](_0x357934)[_0x321621(0x14f)](_0x56d351=>{if(_0x56d351>_0x3e7371)_0x3e7371=_0x56d351;}),_0x2ef102=_0x3e7371>0x0?_0x3e7371:0x78;}else _0x2ef102=_0x357934[_0x349bf5]||0x3c;const _0x33cd93=new Date(_0x2dc2a3-_0x2ef102*0xea60);_0x5339a2[_0x321621(0xf8)]({'eventTime':_0x2dc2a3,'triggerTime':_0x33cd93[_0x321621(0x14a)](),'room':_0x349bf5,'minutes':_0x2ef102,'reason':_0x76ef1f,'isGlobal':_0x3a9a30});});}}catch(_0xfeaece){}_0x5339a2[_0x126511(0x15b)]((_0x2ebfd7,_0x544e0)=>_0x2ebfd7[_0x126511(0xe4)]-_0x544e0[_0x126511(0xe4)]);const _0x46e1b2=_0x5339a2[_0x126511(0x120)](0x0,0x5);await _0x5308dd[_0x126511(0x147)](_0x126511(0x133),{'val':JSON[_0x126511(0x139)](_0x46e1b2),'ack':!![]});}async function checkCalendarTriggers(_0x2fddee){const _0x42185a=a1_0x48af89;if(!_0x2fddee['config'][_0x42185a(0xd4)]||!_0x2fddee[_0x42185a(0x156)][_0x42185a(0xd2)])return;await updateSchedulePreview(_0x2fddee);let _0x16d33d={},_0x49f3fc={};try{const _0x9afb7d=await _0x2fddee[_0x42185a(0x11c)](_0x42185a(0x141));if(_0x9afb7d&&_0x9afb7d[_0x42185a(0x13b)])_0x16d33d=JSON['parse'](_0x9afb7d['val']);const _0x19c88a=await _0x2fddee[_0x42185a(0x11c)](_0x42185a(0xd9));if(_0x19c88a&&_0x19c88a[_0x42185a(0x13b)])_0x49f3fc=JSON['parse'](_0x19c88a[_0x42185a(0x13b)]);}catch(_0x2a27a4){}let _0x641d9a={'default':0x15};try{const _0x30d829=await _0x2fddee['getStateAsync'](_0x42185a(0xef));if(_0x30d829&&_0x30d829[_0x42185a(0x13b)])_0x641d9a=JSON[_0x42185a(0xfb)](_0x30d829['val']);}catch(_0x1329e0){}try{const _0x4c7712=await _0x2fddee['getForeignStateAsync'](_0x2fddee['config']['calendarInstance']+'.data.table');if(!_0x4c7712||!_0x4c7712[_0x42185a(0x13b)])return;const _0x3d854e=JSON['parse'](_0x4c7712[_0x42185a(0x13b)]),_0x121a89=Date[_0x42185a(0x168)](),_0x2b70d8=_0x2fddee[_0x42185a(0x156)][_0x42185a(0x106)]||[],_0x2a30dd=_0x2fddee[_0x42185a(0x156)][_0x42185a(0x112)]||[];for(const _0x4adcb3 of _0x3d854e){if(_0x4adcb3[_0x42185a(0x11d)]&&_0x2a30dd['length']>0x0&&!_0x2a30dd[_0x42185a(0x161)](_0x4adcb3[_0x42185a(0x11d)]))continue;const _0x36b9a7=_0x4adcb3[_0x42185a(0x159)]||_0x4adcb3[_0x42185a(0x138)]||_0x4adcb3[_0x42185a(0xd3)];if(!_0x36b9a7)continue;const _0xa96c3d=new Date(_0x36b9a7);if(isNaN(_0xa96c3d[_0x42185a(0x14a)]()))continue;const _0x2a9118=(_0x4adcb3[_0x42185a(0x149)]||_0x4adcb3[_0x42185a(0xdb)]||'')[_0x42185a(0x11e)]();if(_0x2a9118[_0x42185a(0x161)](_0x42185a(0x146))||_0x2a9118['includes'](_0x42185a(0x14b))||_0x2a9118[_0x42185a(0x161)](_0x42185a(0x137))){let _0x5bf7e0=0x0;Object[_0x42185a(0x102)](_0x16d33d)[_0x42185a(0x14f)](_0x57fa03=>{if(_0x57fa03>_0x5bf7e0)_0x5bf7e0=_0x57fa03;});if(_0x5bf7e0===0x0)_0x5bf7e0=0x78;const _0x569ad4=_0xa96c3d[_0x42185a(0x14a)]()-_0x5bf7e0*0xea60;_0x121a89>=_0x569ad4&&_0x121a89<_0xa96c3d['getTime']()&&(_0x2fddee['currentSystemMode']!==_0x42185a(0x125)&&(_0x2fddee['log'][_0x42185a(0x150)]('ðŸ“…\x20SMART\x20SCHEDULE\x20(Phase):\x20\x27Globaler\x20Start\x27\x20erkannt.\x20Heize\x20Haus\x20auf\x20(Vorlauf:\x20'+_0x5bf7e0+_0x42185a(0xe0)),await _0x2fddee[_0x42185a(0x147)]('system.mode',{'val':'normal','ack':![]})));}for(const _0xbc33d3 of _0x2b70d8){if(_0xbc33d3['location']){const _0x1b49a9=_0xbc33d3['location'][_0x42185a(0x11e)]();if(_0x2a9118[_0x42185a(0x161)](_0x1b49a9)){const _0x293e07=_0x16d33d[_0xbc33d3[_0x42185a(0x134)]]||0x3c,_0x4acf90=_0x49f3fc[_0xbc33d3['location']]||_0x42185a(0x15f),_0xfc7571=_0xa96c3d[_0x42185a(0x14a)]()-_0x293e07*0xea60;if(_0x121a89>=_0xfc7571&&_0x121a89<_0xa96c3d['getTime']()){const _0x541a2f=lastActions[_0x42185a(0xee)+_0xbc33d3['location']];if(_0x541a2f&&_0x121a89-_0x541a2f<CAL_COOLDOWN_MS)continue;const _0x5b2a4b=await findRelatedId(_0x2fddee,_0xbc33d3['id'],'setpoint');if(_0x5b2a4b){let _0x35366d=_0x641d9a[_0xbc33d3[_0x42185a(0x134)]];if(_0x35366d===undefined)_0x35366d=_0x641d9a['default'];if(_0x35366d===undefined)_0x35366d=0x15;const _0x46fc05=await _0x2fddee[_0x42185a(0x10e)](_0x5b2a4b);_0x46fc05&&typeof _0x46fc05['val']===_0x42185a(0x127)&&_0x46fc05[_0x42185a(0x13b)]<_0x35366d-0.5&&(_0x2fddee['log'][_0x42185a(0x150)]('ðŸ“…\x20SMART\x20SCHEDULE\x20['+_0x4acf90+_0x42185a(0x100)+_0xbc33d3[_0x42185a(0x134)]+_0x42185a(0x126)+_0x35366d+_0x42185a(0x143)+_0x293e07+_0x42185a(0xe0)),await _0x2fddee[_0x42185a(0x119)](_0x5b2a4b,_0x35366d),await logAutomationAction(_0x2fddee,_0x42185a(0xe1)+_0xbc33d3[_0x42185a(0x134)]+_0x42185a(0x10f)+_0x35366d+_0x42185a(0x163)+_0x4acf90+')'),lastActions[_0x42185a(0xee)+_0xbc33d3['location']]=_0x121a89);}}}}}}}catch(_0x1c8e6a){_0x2fddee[_0x42185a(0x13c)][_0x42185a(0xe6)](_0x42185a(0x10b)+_0x1c8e6a[_0x42185a(0x160)]);}}async function manageMpcIntervention(_0x1c6d6e,_0xb95495,_0x219da5){const _0x1d22ef=a1_0x48af89;try{const _0x3d85eb=_0x1d22ef(0xd1),_0x28ccc3=await _0x1c6d6e[_0x1d22ef(0x11c)](_0x3d85eb);let _0x112d07=[];if(_0x28ccc3&&_0x28ccc3[_0x1d22ef(0x13b)])try{_0x112d07=JSON[_0x1d22ef(0xfb)](_0x28ccc3[_0x1d22ef(0x13b)]);}catch(_0x1f010d){}const _0x574f3a=_0x112d07[_0x1d22ef(0x135)](_0xb95495);if(_0x219da5===_0x1d22ef(0xe8))_0x574f3a===-0x1&&(_0x112d07[_0x1d22ef(0xf8)](_0xb95495),await _0x1c6d6e['setStateAsync'](_0x3d85eb,{'val':JSON['stringify'](_0x112d07),'ack':!![]}));else _0x219da5===_0x1d22ef(0xd8)&&(_0x574f3a!==-0x1&&(_0x112d07[_0x1d22ef(0xd5)](_0x574f3a,0x1),await _0x1c6d6e['setStateAsync'](_0x3d85eb,{'val':JSON[_0x1d22ef(0x139)](_0x112d07),'ack':!![]})));}catch(_0x3b9d99){}}function a1_0x2f6a(){const _0x1c759e=['set','.1.LEVEL','48292540GVuqgM','join','analysis.energy.warmupTimes','find','Â°C\x20(Vorlauf:\x20','target_temperature','reason','urlaub\x20ende','setStateAsync','pi_heating_demand','event','getTime','rÃ¼ckkehr','Â°C).\x20Entferne\x20Status.','unshift','exports','forEach','info','actual','toString','\x20->\x20Schalte\x20','ðŸƒ\x20[MPC\x20ACTION]\x20Senke\x20','Soll','config','getForeignObjectAsync','Ist','_date','2476890sxGVNq','sort','stellwert','replace','switch','Classic','message','includes','soll','Â°C\x20(via\x20','common','temperature','2647832jybAoi','name','now','dimmer',':\x20Aufheizen\x20auf\x20','wert','analysis.automation.confidenceThreshold','string','active','Nicht\x20gefunden','.data.table','analysis.energy.mpcActiveInterventions','calendarInstance','date','useCalendar','splice','approved','thermostat','remove','analysis.energy.warmupSources','filter','summary','thermostatMapping','level.valve','analysis.automation.mode','minutes_safe','\x20min).','[CAL]\x20','trim','analysis.automation.actionLog','triggerTime','mpc_','warn','room','add','(((.+)+)+)+$','Â°C!\x20(Puffer\x20leer).','1778RAIeKx','valveMapping','messwert','cal_','analysis.energy.warmupTargets','abs','.1.SET_POINT_TEMPERATURE','valve','map','SET_POINT_TEMPERATURE','search','27582XHKlgj','score','push','localeCompare','local_temperature','parse','state','\x20gefunden!','Unbekannt','split',']:\x20Raum-Trigger\x20\x27','4284325RVauum','values','value.valve',':\x20Absenkung\x20auf\x20','isArray','devices','temp','[MPC\x20WARNING]\x20Kein\x20Setpoint\x20fÃ¼r\x20','constructor','ðŸ§¹\x20[MPC\x20CLEANUP]\x20','Calendar\x20Check\x20Error:\x20','.1.ACTUAL_TEMPERATURE','\x20ist\x20auf\x20','getForeignStateAsync','\x20->\x20','7564HPtWtu','ðŸ”¥\x20[MPC\x20ACTION]\x20Heize\x20','calendarSelection','setpoint','length','1nSiJYj','getForeignObjectsAsync','from','.1.TEMPERATURE','setForeignStateAsync','5614760zCoAWD','Unknown','getStateAsync','_calName','toLowerCase','SET','slice','apply','type','toUpperCase','target','normal','\x27\x20aktiv.\x20Heize\x20auf\x20','number','consultButler','Manuelles\x20Mapping','level','\x20wieder\x20auf\x20','Â°C!\x20(Puffer:\x20','.4.SET_TEMPERATURE','sensor','off','position','.4.VALVE_STATE','thermostat.setpoint','analysis.energy.schedulePreview','location','indexOf','1959hOODkh','ankunft','eventStart','stringify','PrÃ¤diktion:\x20','val','log'];a1_0x2f6a=function(){return _0x1c759e;};return a1_0x2f6a();}async function cleanupGhostInterventions(_0x5cf759){const _0x140821=a1_0x48af89;try{const _0x12d86e=_0x140821(0xd1),_0x1bc79c=await _0x5cf759['getStateAsync'](_0x12d86e);if(!_0x1bc79c||!_0x1bc79c['val'])return;const _0x2b6346=JSON[_0x140821(0xfb)](_0x1bc79c[_0x140821(0x13b)]);if(!Array[_0x140821(0x105)](_0x2b6346)||_0x2b6346[_0x140821(0x114)]===0x0)return;const _0x103857=_0x5cf759[_0x140821(0x156)][_0x140821(0x106)]||[];let _0x2099a0=![];for(let _0x33e338=_0x2b6346['length']-0x1;_0x33e338>=0x0;_0x33e338--){const _0x169ee3=_0x2b6346[_0x33e338],_0x325b41=_0x103857[_0x140821(0x142)](_0x11e8b9=>normalize(_0x11e8b9[_0x140821(0x134)])===normalize(_0x169ee3)&&(_0x11e8b9[_0x140821(0x122)]===_0x140821(0x165)||_0x11e8b9['type']===_0x140821(0xd7)));if(_0x325b41){const _0x4061ff=await findRelatedId(_0x5cf759,_0x325b41['id'],_0x140821(0x113));if(_0x4061ff){const _0x553ca7=await _0x5cf759[_0x140821(0x10e)](_0x4061ff);_0x553ca7&&typeof _0x553ca7[_0x140821(0x13b)]==='number'&&(Math[_0x140821(0xf0)](_0x553ca7[_0x140821(0x13b)]-ECO_TEMP)>0.5&&(_0x5cf759[_0x140821(0x13c)][_0x140821(0x150)](_0x140821(0x10a)+_0x169ee3+_0x140821(0x10d)+_0x553ca7[_0x140821(0x13b)]+'Â°C\x20(nicht\x20'+ECO_TEMP+_0x140821(0x14c)),_0x2b6346[_0x140821(0xd5)](_0x33e338,0x1),_0x2099a0=!![]));}}}_0x2099a0&&await _0x5cf759[_0x140821(0x147)](_0x12d86e,{'val':JSON[_0x140821(0x139)](_0x2b6346),'ack':!![]});}catch(_0x2d4405){}}async function applyEnergySavings(_0x510f8f,_0x3a8685){const _0x2264fb=a1_0x48af89;await cleanupGhostInterventions(_0x510f8f);if(!_0x3a8685||_0x3a8685['length']===0x0)return;const _0x110b97=_0x510f8f['config'][_0x2264fb(0x106)]||[],_0x533133=Date[_0x2264fb(0x168)]();for(const _0x4095e0 of _0x3a8685){const _0x5d3fec=_0x4095e0[_0x2264fb(0xe7)],_0x550771=_0x4095e0[_0x2264fb(0xdf)],_0xb7b358=_0x4095e0[_0x2264fb(0x124)]||0x15,_0x1f541d=_0x110b97[_0x2264fb(0x142)](_0x2aef26=>normalize(_0x2aef26[_0x2264fb(0x134)])===normalize(_0x5d3fec)&&(_0x2aef26[_0x2264fb(0x122)]===_0x2264fb(0x165)||_0x2aef26[_0x2264fb(0x122)]===_0x2264fb(0xd7)));if(!_0x1f541d)continue;const _0x33ea61=await findRelatedId(_0x510f8f,_0x1f541d['id'],_0x2264fb(0x113));if(_0x33ea61){if(lastActions[_0x2264fb(0xe5)+_0x5d3fec]&&_0x533133-lastActions[_0x2264fb(0xe5)+_0x5d3fec]<0x1e*0x3c*0x3e8)continue;const _0x5aada1=await _0x510f8f[_0x2264fb(0x10e)](_0x33ea61);if(_0x5aada1&&typeof _0x5aada1['val']==='number'){const _0x415b31=_0x5aada1[_0x2264fb(0x13b)];_0x415b31!==ECO_TEMP&&await manageMpcIntervention(_0x510f8f,_0x5d3fec,_0x2264fb(0xd8));if(_0x550771>0x1e)_0x415b31>ECO_TEMP+0.5&&(_0x510f8f[_0x2264fb(0x13c)]['info'](_0x2264fb(0x154)+_0x5d3fec+'\x20auf\x20'+ECO_TEMP+_0x2264fb(0x12c)+_0x550771+'\x20min)'),await _0x510f8f[_0x2264fb(0x119)](_0x33ea61,ECO_TEMP),await manageMpcIntervention(_0x510f8f,_0x5d3fec,_0x2264fb(0xe8)),lastActions[_0x2264fb(0xe5)+_0x5d3fec]=_0x533133,await logAutomationAction(_0x510f8f,'[MPC]\x20'+_0x5d3fec+_0x2264fb(0x104)+ECO_TEMP+'Â°C'));else _0x550771<=0xf&&(_0x415b31<_0xb7b358&&(_0x510f8f[_0x2264fb(0x13c)][_0x2264fb(0x150)](_0x2264fb(0x111)+_0x5d3fec+_0x2264fb(0x12b)+_0xb7b358+_0x2264fb(0xea)),await _0x510f8f[_0x2264fb(0x119)](_0x33ea61,_0xb7b358),await manageMpcIntervention(_0x510f8f,_0x5d3fec,_0x2264fb(0xd8)),lastActions[_0x2264fb(0xe5)+_0x5d3fec]=_0x533133,await logAutomationAction(_0x510f8f,'[MPC]\x20'+_0x5d3fec+_0x2264fb(0x16a)+_0xb7b358+'Â°C')));}}else _0x510f8f[_0x2264fb(0x13c)][_0x2264fb(0xe6)](_0x2264fb(0x108)+_0x5d3fec+_0x2264fb(0xfd));}}module[a1_0x48af89(0x14e)]={'handlePrediction':handlePrediction,'applyEnergySavings':applyEnergySavings,'scanThermostats':scanThermostats,'checkCalendarTriggers':checkCalendarTriggers,'updateSchedulePreview':updateSchedulePreview};