const a1_0x167009=a1_0x2490;(function(_0x3be759,_0x5bbc43){const _0xcce146=a1_0x2490,_0x6f9af0=_0x3be759();while(!![]){try{const _0x2e1197=-parseInt(_0xcce146(0xf8))/0x1*(parseInt(_0xcce146(0x142))/0x2)+parseInt(_0xcce146(0x143))/0x3*(-parseInt(_0xcce146(0x11e))/0x4)+-parseInt(_0xcce146(0x138))/0x5*(parseInt(_0xcce146(0x136))/0x6)+parseInt(_0xcce146(0xfb))/0x7+-parseInt(_0xcce146(0x163))/0x8*(-parseInt(_0xcce146(0x16d))/0x9)+parseInt(_0xcce146(0x159))/0xa*(parseInt(_0xcce146(0x109))/0xb)+-parseInt(_0xcce146(0x132))/0xc*(-parseInt(_0xcce146(0xfd))/0xd);if(_0x2e1197===_0x5bbc43)break;else _0x6f9af0['push'](_0x6f9af0['shift']());}catch(_0x1f2604){_0x6f9af0['push'](_0x6f9af0['shift']());}}}(a1_0x4ea0,0xd1ff4));const a1_0x27d896=(function(){let _0x4cfc6e=!![];return function(_0x4e44e3,_0x4bca9c){const _0x4353fb=_0x4cfc6e?function(){const _0x922bc3=a1_0x2490;if(_0x4bca9c){const _0x2e097e=_0x4bca9c[_0x922bc3(0xff)](_0x4e44e3,arguments);return _0x4bca9c=null,_0x2e097e;}}:function(){};return _0x4cfc6e=![],_0x4353fb;};}()),a1_0x589c3a=a1_0x27d896(this,function(){const _0x2f25ea=a1_0x2490;return a1_0x589c3a[_0x2f25ea(0x178)]()[_0x2f25ea(0x153)](_0x2f25ea(0x165))[_0x2f25ea(0x178)]()['constructor'](a1_0x589c3a)[_0x2f25ea(0x153)](_0x2f25ea(0x165));});a1_0x589c3a();function a1_0x2490(_0x13b607,_0x48854f){const _0x2fbecb=a1_0x4ea0();return a1_0x2490=function(_0x589c3a,_0x27d896){_0x589c3a=_0x589c3a-0xf1;let _0x4ea0fe=_0x2fbecb[_0x589c3a];return _0x4ea0fe;},a1_0x2490(_0x13b607,_0x48854f);}'use strict';const aiAgent=require(a1_0x167009(0x141)),COOLDOWN_MS=0x3c*0x3e8,CAL_COOLDOWN_MS=0x5a*0x3c*0x3e8,RESCUE_LOCK_MS=0x78*0x3c*0x3e8,ECO_TEMP=0x11,lastActions={};function normalize(_0x194d20){const _0x505955=a1_0x167009;if(!_0x194d20)return'';return _0x194d20[_0x505955(0x144)]()[_0x505955(0x158)](/\s+/g,'')[_0x505955(0x120)]();}async function logAutomationAction(_0x449d8d,_0x4674fa){const _0x487b09=a1_0x167009;await _0x449d8d[_0x487b09(0x128)](_0x487b09(0x192),{'val':_0x4674fa,'ack':!![]});try{const _0x461244=_0x487b09(0x19a),_0x2069f4=await _0x449d8d[_0x487b09(0x162)](_0x461244);let _0x47a0d9=[];if(_0x2069f4&&_0x2069f4[_0x487b09(0x130)])try{_0x47a0d9=JSON[_0x487b09(0x16a)](_0x2069f4['val']);}catch(_0x1c645c){}_0x47a0d9[_0x487b09(0x126)]({'ts':Date[_0x487b09(0x12a)](),'msg':_0x4674fa});if(_0x47a0d9[_0x487b09(0x16c)]>0x32)_0x47a0d9=_0x47a0d9[_0x487b09(0xfc)](0x0,0x32);await _0x449d8d[_0x487b09(0x128)](_0x461244,{'val':JSON['stringify'](_0x47a0d9),'ack':!![]});}catch(_0x23ad40){}}async function handlePrediction(_0x9304ec,_0x2ea80d,_0x16c15b){const _0x5f2a6f=a1_0x167009;if(!_0x2ea80d||_0x2ea80d===_0x5f2a6f(0x106))return;let _0x1c3796='off',_0x4de636=0.6;try{const _0x3d1d0c=await _0x9304ec['getStateAsync'](_0x5f2a6f(0x155));if(_0x3d1d0c&&_0x3d1d0c['val'])_0x1c3796=_0x3d1d0c[_0x5f2a6f(0x130)];const _0x46ca8d=await _0x9304ec[_0x5f2a6f(0x162)](_0x5f2a6f(0x122));if(_0x46ca8d&&_0x46ca8d[_0x5f2a6f(0x130)])_0x4de636=_0x46ca8d[_0x5f2a6f(0x130)];}catch(_0x2bebc9){}if(_0x1c3796==='off'||_0x16c15b<_0x4de636)return;const _0x3fe127=Date[_0x5f2a6f(0x12a)]();if(lastActions[_0x2ea80d]&&_0x3fe127-lastActions[_0x2ea80d]<COOLDOWN_MS)return;const _0x25c98f=_0x9304ec[_0x5f2a6f(0xf7)]['devices']||[],_0x61158d=normalize(_0x2ea80d),_0x317320=_0x25c98f['find'](_0x4502c3=>normalize(_0x4502c3['location'])===_0x61158d&&(_0x4502c3[_0x5f2a6f(0x133)]===_0x5f2a6f(0x14c)||_0x4502c3[_0x5f2a6f(0x133)]===_0x5f2a6f(0x14d)||_0x4502c3[_0x5f2a6f(0x133)]==='switch'));if(!_0x317320)return;const _0x5a083f=await aiAgent['consultButler'](_0x9304ec,_0x2ea80d,_0x317320['name'],_0x16c15b);if(!_0x5a083f[_0x5f2a6f(0x108)])return;const _0x19f964=_0x5f2a6f(0x14e)+_0x2ea80d+_0x5f2a6f(0x124)+_0x317320[_0x5f2a6f(0x18a)]+'\x20('+_0x5a083f[_0x5f2a6f(0x179)]+')';await logAutomationAction(_0x9304ec,'['+_0x1c3796[_0x5f2a6f(0x121)]()+']\x20'+_0x19f964);if(_0x1c3796===_0x5f2a6f(0x137)){const _0x4af62d=await _0x9304ec[_0x5f2a6f(0x16f)](_0x317320['id']);(!_0x4af62d||!_0x4af62d['val']&&_0x4af62d['val']!==!![])&&await _0x9304ec[_0x5f2a6f(0x10e)](_0x317320['id'],!![]),lastActions[_0x2ea80d]=_0x3fe127;}}async function findRelatedId(_0x36ff0f,_0x232672,_0x1aebed=a1_0x167009(0x181)){const _0x6332e8=a1_0x167009;if(_0x1aebed===_0x6332e8(0x181)&&_0x36ff0f[_0x6332e8(0xf7)][_0x6332e8(0x168)]){let _0x32035a=_0x36ff0f['config'][_0x6332e8(0x168)];if(typeof _0x32035a===_0x6332e8(0x105))try{_0x32035a=JSON[_0x6332e8(0x16a)](_0x32035a);}catch(_0x3cc3ff){}if(_0x32035a&&_0x32035a[_0x232672])return _0x32035a[_0x232672];}if(_0x1aebed===_0x6332e8(0x112)&&_0x36ff0f['config'][_0x6332e8(0x17e)]){let _0x140c34=_0x36ff0f[_0x6332e8(0xf7)][_0x6332e8(0x17e)];if(typeof _0x140c34==='string')try{_0x140c34=JSON[_0x6332e8(0x16a)](_0x140c34);}catch(_0x1a505e){}if(_0x140c34&&_0x140c34[_0x232672])return _0x140c34[_0x232672];}let _0x1ac89d=[];if(_0x1aebed===_0x6332e8(0x181))_0x1ac89d=[{'s':_0x6332e8(0x196),'t':_0x6332e8(0x127)},{'s':_0x6332e8(0x13d),'t':_0x6332e8(0x127)},{'s':_0x6332e8(0x13d),'t':'.4.SET_TEMPERATURE'},{'s':_0x6332e8(0x13f),'t':'SET_POINT_TEMPERATURE'},{'s':'local_temperature','t':_0x6332e8(0x182)},{'s':_0x6332e8(0x17b),'t':_0x6332e8(0x199)},{'s':_0x6332e8(0x157),'t':_0x6332e8(0x15b)},{'s':_0x6332e8(0xfa),'t':_0x6332e8(0x161)},{'s':_0x6332e8(0x113),'t':'Soll'},{'s':'temperature','t':_0x6332e8(0x181)}];else _0x1aebed===_0x6332e8(0x112)&&(_0x1ac89d=[{'s':_0x6332e8(0x196),'t':_0x6332e8(0x12b)},{'s':_0x6332e8(0x13d),'t':'.1.LEVEL'},{'s':_0x6332e8(0x13d),'t':_0x6332e8(0x107)},{'s':_0x6332e8(0x17b),'t':'pi_heating_demand'},{'s':'temperature','t':_0x6332e8(0x10b)},{'s':'temperature','t':_0x6332e8(0x14f)}]);for(const _0xb6d7ea of _0x1ac89d){if(_0x232672[_0x6332e8(0xf3)](_0xb6d7ea['s'])){const _0x2eac6e=_0x232672['replace'](_0xb6d7ea['s'],_0xb6d7ea['t']),_0x33cc0f=await _0x36ff0f['getForeignObjectAsync'](_0x2eac6e);if(_0x33cc0f)return _0x2eac6e;}}try{const _0x15063c=_0x232672[_0x6332e8(0x15c)]('.');if(_0x15063c['length']>0x2){const _0x9bf7a=_0x15063c['slice'](0x0,-0x1)['join']('.'),_0x4ce318=await _0x36ff0f[_0x6332e8(0x180)](_0x9bf7a+'.*'),_0x38669f=[],_0x5bfe59=_0x232672['split'](/[._]+/)['filter'](_0x561ebb=>!['openknx','0',_0x6332e8(0x13e),'ist','wert',_0x6332e8(0x157),'actual',_0x6332e8(0x15d),_0x6332e8(0x125),_0x6332e8(0x13b)][_0x6332e8(0xf3)](_0x561ebb['toLowerCase']()));for(const [_0xc1565b,_0x26c8b7]of Object[_0x6332e8(0x11a)](_0x4ce318)){if(_0xc1565b===_0x232672)continue;if(_0x26c8b7&&_0x26c8b7[_0x6332e8(0x101)]){const _0x17281c=_0xc1565b[_0x6332e8(0x144)](),_0x310f4c=(_0x26c8b7['common'][_0x6332e8(0x185)]||'')[_0x6332e8(0x144)](),_0x39eb7f=(_0x26c8b7[_0x6332e8(0x101)][_0x6332e8(0x10a)]||'')[_0x6332e8(0x144)]();let _0x4f709b=![];if(_0x1aebed==='setpoint'&&_0x26c8b7[_0x6332e8(0x101)][_0x6332e8(0x10d)]===!![])_0x4f709b=_0x17281c[_0x6332e8(0xf3)](_0x6332e8(0x147))||_0x17281c[_0x6332e8(0xf3)](_0x6332e8(0x11c))||_0x17281c[_0x6332e8(0xf3)](_0x6332e8(0x154))||_0x310f4c[_0x6332e8(0xf3)](_0x6332e8(0x169))||_0x310f4c[_0x6332e8(0xf3)](_0x6332e8(0x103));else _0x1aebed===_0x6332e8(0x112)&&(_0x4f709b=_0x17281c[_0x6332e8(0xf3)](_0x6332e8(0x14f))||_0x17281c[_0x6332e8(0xf3)](_0x6332e8(0x112))||_0x17281c[_0x6332e8(0xf3)](_0x6332e8(0x119))||_0x17281c[_0x6332e8(0xf3)](_0x6332e8(0x19b))||_0x310f4c[_0x6332e8(0xf3)](_0x6332e8(0x11b))||_0x310f4c[_0x6332e8(0xf3)]('value.valve')||_0x39eb7f[_0x6332e8(0xf3)]('%'));if(_0x4f709b){const _0x7a0d60=_0xc1565b[_0x6332e8(0x15c)](/[._]+/)[_0x6332e8(0x17d)](_0x54f409=>_0x54f409['toLowerCase']());let _0x5ec6cc=0x0;_0x5bfe59[_0x6332e8(0x111)](_0xa93274=>{const _0x44e130=_0x6332e8;if(_0x7a0d60[_0x44e130(0xf3)](_0xa93274['toLowerCase']()))_0x5ec6cc++;}),_0x38669f['push']({'id':_0xc1565b,'score':_0x5ec6cc});}}}if(_0x38669f[_0x6332e8(0x16c)]>0x0){_0x38669f[_0x6332e8(0x12c)]((_0x5ef0e5,_0xfaec66)=>_0xfaec66[_0x6332e8(0x16e)]-_0x5ef0e5[_0x6332e8(0x16e)]);if(_0x38669f[0x0][_0x6332e8(0x16e)]>0x0)return _0x38669f[0x0]['id'];}}}catch(_0x383312){}return null;}function a1_0x4ea0(){const _0x412116=['ACTUAL_TEMPERATURE','analysis.energy.warmupTargets','./ai_agent','518858VKxbor','1473819mTFdPK','toLowerCase','useCalendar','\x20ist\x20zu\x20kalt,\x20ABER\x20Fenster\x20offen/LÃ¼ftung\x20erkannt.\x20Heize\x20NICHT,\x20entferne\x20nur\x20Status.','set','ðŸƒ\x20[MPC\x20ACTION]\x20Senke\x20','calendarSelection','push','rÃ¼ckkehr','light','dimmer','PrÃ¤diktion:\x20','level','temp','ðŸ§¹\x20[MPC\x20CLEANUP]\x20','thermostat','search','target','analysis.automation.mode','.data.table','temperature','replace','495290iIKiTF','rescue_','target_temperature','split','sensor','warn','\x27\x20hat\x20kein\x20GerÃ¤t\x20mehr.\x20LÃ¶sche\x20Eintrag.','manual','SET','getStateAsync','78376XMlhAN','exports','(((.+)+)+)+$','filter','analysis.energy.warmupSources','thermostatMapping','level.temperature','parse','number','length','585sncMrk','score','getForeignStateAsync','\x20auf\x20','_date','\x20wieder\x20auf\x20','stringify','open','_calName','Â°C\x20(nicht\x20','Auto-Erkennung','toString','reason','room','local_temperature','triggerTime','map','valveMapping','[CAL]\x20','getForeignObjectsAsync','setpoint','occupied_heating_setpoint','[MPC\x20WARNING]\x20Kein\x20Setpoint\x20fÃ¼r\x20','splice','role','Â°C).\x20Sparmodus\x20beendet!','mpc_','ðŸ§¹\x20[MPC\x20CLEANUP]\x20Raum\x20\x27','cal_','name','ðŸš¨\x20[MPC\x20WATCHDOG]\x20','ankunft','system.mode','currentSystemMode','indexOf','normal','devices','analysis.automation.lastAction','Classic','[MPC]\x20','ðŸŒ¬ï¸\x20[MPC\x20WATCHDOG]\x20','.1.ACTUAL_TEMPERATURE','Â°C\x20(via\x20','ðŸ“…\x20SMART\x20SCHEDULE\x20(Phase):\x20\x27Globaler\x20Start\x27\x20erkannt.\x20Heize\x20Haus\x20auf\x20(Vorlauf:\x20','current_heating_setpoint','analysis.automation.actionLog','position','ðŸ“…\x20[MPC\x20INFO]\x20','analysis.energy.schedulePreview','summary','add','urlaub\x20ende','includes',':\x20Aufheizen\x20auf\x20','log','location','config','1udOvNg','find','ACTUAL','1055929YqaVtq','slice','12175683XluzVx','\x20gefunden!','apply','default','common','analysis.energy.warmupTimes','thermostat.setpoint','getTime','string','Unknown','.4.VALVE_STATE','approved','55wlzGFT','unit','valve_position','\x20durch\x20Kalender\x20geÃ¤ndert.\x20Keine\x20RL-Strafe.','write','setForeignStateAsync',':\x20Puffer\x20leer\x20->\x20Heizen\x20auf\x20','ðŸŽ“\x20[RL-FEEDBACK]\x20Lerne\x20aus\x20Fehler:\x20','forEach','valve','Ist','isArray','Â°C!\x20(Puffer\x20leer).','Unbekannt','too_cold','info','stellwert','entries','level.valve','soll','analysis.energy.mpcActiveInterventions','4KRaTtc','minutes_safe','trim','toUpperCase','analysis.automation.confidenceThreshold','\x20min).','\x20->\x20Schalte\x20','messwert','unshift','.1.SET_POINT_TEMPERATURE','setStateAsync','remove','now','.1.LEVEL','sort','Manuelles\x20Mapping','event','\x20ist\x20auf\x20','val','eventStart','12ZWgxql','type','analysis.energy.ventilationAlerts','contact','18FhybZL','active','601730NdUHmr','Â°C\x20<\x20','calendarInstance','state','values','.1.TEMPERATURE','hm-rpc'];a1_0x4ea0=function(){return _0x412116;};return a1_0x4ea0();}async function scanThermostats(_0x178dc6){const _0x4b3aa2=a1_0x167009,_0x443f22=_0x178dc6[_0x4b3aa2(0xf7)][_0x4b3aa2(0x191)]||[],_0x3b8cfa=[],_0x1b027c=_0x443f22[_0x4b3aa2(0x166)](_0x33c34c=>_0x33c34c['id']&&_0x33c34c['id']['includes'](_0x4b3aa2(0x157))||_0x33c34c[_0x4b3aa2(0x133)]&&[_0x4b3aa2(0x157),_0x4b3aa2(0x152),_0x4b3aa2(0x15d)]['includes'](_0x33c34c['type'])||_0x33c34c[_0x4b3aa2(0x18a)]&&_0x33c34c[_0x4b3aa2(0x18a)][_0x4b3aa2(0x144)]()['includes'](_0x4b3aa2(0x150)));for(const _0x2a988b of _0x1b027c){const _0x5e4127=await findRelatedId(_0x178dc6,_0x2a988b['id'],_0x4b3aa2(0x181)),_0x4aad75=await findRelatedId(_0x178dc6,_0x2a988b['id'],_0x4b3aa2(0x112));let _0x266799='Nicht\x20gefunden',_0x454587=![],_0x399000=_0x178dc6['config'][_0x4b3aa2(0x168)]||{};if(typeof _0x399000===_0x4b3aa2(0x105))try{_0x399000=JSON['parse'](_0x399000);}catch(_0x36b64c){}let _0x5fcfd=_0x178dc6['config']['valveMapping']||{};if(typeof _0x5fcfd===_0x4b3aa2(0x105))try{_0x5fcfd=JSON['parse'](_0x5fcfd);}catch(_0x75c989){}if(_0x399000[_0x2a988b['id']]&&_0x399000[_0x2a988b['id']]===_0x5e4127||_0x5fcfd[_0x2a988b['id']]&&_0x5fcfd[_0x2a988b['id']]===_0x4aad75)_0x266799=_0x4b3aa2(0x12d),_0x454587=!![];else(_0x5e4127||_0x4aad75)&&(_0x266799=_0x4b3aa2(0x177));_0x3b8cfa['push']({'room':_0x2a988b[_0x4b3aa2(0xf6)]||_0x4b3aa2(0x116),'sensorId':_0x2a988b['id'],'setpointId':_0x5e4127||'-','valveId':_0x4aad75||'-','source':_0x266799,'isManual':_0x454587,'status':_0x5e4127&&_0x4aad75?'PERFECT':_0x5e4127?'OK':'Fehlt'});}return _0x3b8cfa['sort']((_0x24963d,_0x3f6b68)=>_0x24963d['room']['localeCompare'](_0x3f6b68[_0x4b3aa2(0x17a)]));}async function updateSchedulePreview(_0x17b046){const _0x507410=a1_0x167009;if(!_0x17b046[_0x507410(0xf7)][_0x507410(0x145)]||!_0x17b046['config'][_0x507410(0x13a)])return;let _0x3df129={};try{const _0x4305d7=await _0x17b046[_0x507410(0x162)](_0x507410(0x102));if(_0x4305d7&&_0x4305d7[_0x507410(0x130)])_0x3df129=JSON[_0x507410(0x16a)](_0x4305d7[_0x507410(0x130)]);}catch(_0x516c00){}const _0x4e3d73=[],_0xd87f1a=Date[_0x507410(0x12a)](),_0x3628d3=0x30*0x3c*0x3c*0x3e8;try{const _0x527d2b=await _0x17b046[_0x507410(0x16f)](_0x17b046[_0x507410(0xf7)][_0x507410(0x13a)]+_0x507410(0x156));if(!_0x527d2b||!_0x527d2b[_0x507410(0x130)])return;const _0xea16bc=JSON['parse'](_0x527d2b['val']),_0x1d667c=_0x17b046[_0x507410(0xf7)][_0x507410(0x149)]||[],_0x75e1ad=_0x17b046[_0x507410(0xf7)][_0x507410(0x191)]||[],_0x184400=new Set();_0x75e1ad[_0x507410(0x111)](_0x52a167=>{const _0x2dc45b=_0x507410;if(_0x52a167['location'])_0x184400['add'](_0x52a167[_0x2dc45b(0xf6)]);});for(const _0xf9d3d of _0xea16bc){if(_0xf9d3d['_calName']&&_0x1d667c['length']>0x0&&!_0x1d667c[_0x507410(0xf3)](_0xf9d3d[_0x507410(0x175)]))continue;const _0x239d38=_0xf9d3d[_0x507410(0x171)]||_0xf9d3d[_0x507410(0x131)]||_0xf9d3d['date'];if(!_0x239d38)continue;const _0x229c4c=new Date(_0x239d38),_0x111c30=_0x229c4c['getTime']();if(isNaN(_0x111c30))continue;if(_0x111c30<_0xd87f1a)continue;if(_0x111c30>_0xd87f1a+_0x3628d3)continue;const _0x3e9577=(_0xf9d3d[_0x507410(0x12e)]||_0xf9d3d['summary']||'')['toLowerCase']();let _0x3c81e7=![],_0x30d85c=[],_0x522509=_0xf9d3d[_0x507410(0x12e)]||_0xf9d3d[_0x507410(0x19e)]||_0x507410(0x116);if(_0x3e9577[_0x507410(0xf3)](_0x507410(0xf2))||_0x3e9577[_0x507410(0xf3)](_0x507410(0x14b))||_0x3e9577[_0x507410(0xf3)]('ankunft'))_0x3c81e7=!![],_0x30d85c=Array['from'](_0x184400);else for(const _0x21f51e of _0x184400){if(_0x3e9577[_0x507410(0xf3)](_0x21f51e[_0x507410(0x144)]()))_0x30d85c['push'](_0x21f51e);}_0x30d85c['length']>0x0&&_0x30d85c[_0x507410(0x111)](_0x3d8294=>{const _0x10dca3=_0x507410;let _0xebb622=0x3c;if(_0x3c81e7){let _0x538206=0x0;Object['values'](_0x3df129)[_0x10dca3(0x111)](_0x46dc80=>{if(_0x46dc80>_0x538206)_0x538206=_0x46dc80;}),_0xebb622=_0x538206>0x0?_0x538206:0x78;}else _0xebb622=_0x3df129[_0x3d8294]||0x3c;const _0xece5ce=new Date(_0x111c30-_0xebb622*0xea60);_0x4e3d73[_0x10dca3(0x14a)]({'eventTime':_0x111c30,'triggerTime':_0xece5ce['getTime'](),'room':_0x3d8294,'minutes':_0xebb622,'reason':_0x522509,'isGlobal':_0x3c81e7});});}}catch(_0x4cf388){}_0x4e3d73['sort']((_0x4b6e23,_0x3195d7)=>_0x4b6e23['triggerTime']-_0x3195d7[_0x507410(0x17c)]);const _0x5b67ae=_0x4e3d73[_0x507410(0xfc)](0x0,0x5);await _0x17b046[_0x507410(0x128)](_0x507410(0x19d),{'val':JSON[_0x507410(0x173)](_0x5b67ae),'ack':!![]});}async function checkCalendarTriggers(_0x3cbe82){const _0x302909=a1_0x167009;if(!_0x3cbe82[_0x302909(0xf7)][_0x302909(0x145)]||!_0x3cbe82['config']['calendarInstance'])return;await updateSchedulePreview(_0x3cbe82);let _0x47ce4d={},_0x7ca694={};try{const _0x2f8237=await _0x3cbe82[_0x302909(0x162)](_0x302909(0x102));if(_0x2f8237&&_0x2f8237[_0x302909(0x130)])_0x47ce4d=JSON[_0x302909(0x16a)](_0x2f8237['val']);const _0x2bec40=await _0x3cbe82[_0x302909(0x162)](_0x302909(0x167));if(_0x2bec40&&_0x2bec40[_0x302909(0x130)])_0x7ca694=JSON[_0x302909(0x16a)](_0x2bec40[_0x302909(0x130)]);}catch(_0x4994b5){}let _0x1cbb67={'default':0x15};try{const _0x13d7fc=await _0x3cbe82[_0x302909(0x162)](_0x302909(0x140));if(_0x13d7fc&&_0x13d7fc[_0x302909(0x130)])_0x1cbb67=JSON[_0x302909(0x16a)](_0x13d7fc[_0x302909(0x130)]);}catch(_0x21cf1d){}try{const _0x487e01=await _0x3cbe82[_0x302909(0x16f)](_0x3cbe82['config']['calendarInstance']+_0x302909(0x156));if(!_0x487e01||!_0x487e01['val'])return;const _0x202339=JSON[_0x302909(0x16a)](_0x487e01[_0x302909(0x130)]),_0x285adb=Date[_0x302909(0x12a)](),_0x221bb5=_0x3cbe82[_0x302909(0xf7)][_0x302909(0x191)]||[],_0x46a192=_0x3cbe82['config']['calendarSelection']||[];for(const _0x528ec6 of _0x202339){if(_0x528ec6['_calName']&&_0x46a192['length']>0x0&&!_0x46a192['includes'](_0x528ec6['_calName']))continue;const _0x4f6a66=_0x528ec6[_0x302909(0x171)]||_0x528ec6['eventStart']||_0x528ec6['date'];if(!_0x4f6a66)continue;const _0x40a843=new Date(_0x4f6a66);if(isNaN(_0x40a843[_0x302909(0x104)]()))continue;const _0x151eed=(_0x528ec6[_0x302909(0x12e)]||_0x528ec6[_0x302909(0x19e)]||'')[_0x302909(0x144)]();if(_0x151eed[_0x302909(0xf3)](_0x302909(0xf2))||_0x151eed['includes'](_0x302909(0x14b))||_0x151eed[_0x302909(0xf3)](_0x302909(0x18c))){let _0xac72e1=0x0;Object[_0x302909(0x13c)](_0x47ce4d)[_0x302909(0x111)](_0x556d3a=>{if(_0x556d3a>_0xac72e1)_0xac72e1=_0x556d3a;});if(_0xac72e1===0x0)_0xac72e1=0x78;const _0x37ba86=_0x40a843[_0x302909(0x104)]()-_0xac72e1*0xea60;_0x285adb>=_0x37ba86&&_0x285adb<_0x40a843[_0x302909(0x104)]()&&(_0x3cbe82[_0x302909(0x18e)]!==_0x302909(0x190)&&(_0x3cbe82['log'][_0x302909(0x118)](_0x302909(0x198)+_0xac72e1+_0x302909(0x123)),await _0x3cbe82[_0x302909(0x128)](_0x302909(0x18d),{'val':'normal','ack':![]})));}for(const _0x9638cd of _0x221bb5){if(_0x9638cd[_0x302909(0xf6)]){const _0x4b4973=_0x9638cd['location']['toLowerCase']();if(_0x151eed[_0x302909(0xf3)](_0x4b4973)){const _0x5b9398=_0x47ce4d[_0x9638cd[_0x302909(0xf6)]]||0x3c,_0xdfc6=_0x7ca694[_0x9638cd[_0x302909(0xf6)]]||_0x302909(0x193),_0x24abba=_0x40a843[_0x302909(0x104)]()-_0x5b9398*0xea60;if(_0x285adb>=_0x24abba&&_0x285adb<_0x40a843['getTime']()){const _0x4f2684=lastActions[_0x302909(0x189)+_0x9638cd[_0x302909(0xf6)]];if(_0x4f2684&&_0x285adb-_0x4f2684<CAL_COOLDOWN_MS)continue;const _0x1a47f7=await findRelatedId(_0x3cbe82,_0x9638cd['id'],_0x302909(0x181));if(_0x1a47f7){let _0x31abec=_0x1cbb67[_0x9638cd[_0x302909(0xf6)]];if(_0x31abec===undefined)_0x31abec=_0x1cbb67[_0x302909(0x100)];if(_0x31abec===undefined)_0x31abec=0x15;const _0x288d65=await _0x3cbe82[_0x302909(0x16f)](_0x1a47f7);_0x288d65&&typeof _0x288d65['val']===_0x302909(0x16b)&&_0x288d65[_0x302909(0x130)]<_0x31abec-0.5&&(_0x3cbe82[_0x302909(0xf5)][_0x302909(0x118)]('ðŸ“…\x20SMART\x20SCHEDULE\x20['+_0xdfc6+']:\x20Raum-Trigger\x20\x27'+_0x9638cd[_0x302909(0xf6)]+'\x27\x20aktiv.\x20Heize\x20auf\x20'+_0x31abec+'Â°C\x20(Vorlauf:\x20'+_0x5b9398+_0x302909(0x123)),await _0x3cbe82[_0x302909(0x10e)](_0x1a47f7,_0x31abec),await logAutomationAction(_0x3cbe82,_0x302909(0x17f)+_0x9638cd['location']+'\x20->\x20'+_0x31abec+_0x302909(0x197)+_0xdfc6+')'),lastActions['cal_'+_0x9638cd[_0x302909(0xf6)]]=_0x285adb);}}}}}}}catch(_0x51d036){_0x3cbe82[_0x302909(0xf5)]['warn']('Calendar\x20Check\x20Error:\x20'+_0x51d036['message']);}}async function manageMpcIntervention(_0x2c8ff6,_0x29eeff,_0x5baccd){const _0xbe2726=a1_0x167009;try{const _0x4dd641=_0xbe2726(0x11d),_0x1777fc=await _0x2c8ff6[_0xbe2726(0x162)](_0x4dd641);let _0x23be57=[];if(_0x1777fc&&_0x1777fc[_0xbe2726(0x130)])try{_0x23be57=JSON[_0xbe2726(0x16a)](_0x1777fc[_0xbe2726(0x130)]);}catch(_0x26e01e){}const _0x1f06c5=_0x23be57[_0xbe2726(0x18f)](_0x29eeff);if(_0x5baccd===_0xbe2726(0xf1))_0x1f06c5===-0x1&&(_0x23be57[_0xbe2726(0x14a)](_0x29eeff),await _0x2c8ff6[_0xbe2726(0x128)](_0x4dd641,{'val':JSON[_0xbe2726(0x173)](_0x23be57),'ack':!![]}));else _0x5baccd==='remove'&&(_0x1f06c5!==-0x1&&(_0x23be57[_0xbe2726(0x184)](_0x1f06c5,0x1),await _0x2c8ff6[_0xbe2726(0x128)](_0x4dd641,{'val':JSON[_0xbe2726(0x173)](_0x23be57),'ack':!![]})));}catch(_0x4adac8){}}async function cleanupGhostInterventions(_0x311ca9){const _0x300856=a1_0x167009;try{const _0x2c0fb0=_0x300856(0x11d),_0xe87346=await _0x311ca9[_0x300856(0x162)](_0x2c0fb0);if(!_0xe87346||!_0xe87346[_0x300856(0x130)])return;const _0xa2aba=JSON[_0x300856(0x16a)](_0xe87346['val']);if(!Array[_0x300856(0x114)](_0xa2aba)||_0xa2aba[_0x300856(0x16c)]===0x0)return;let _0x573bc7={'default':0x15};try{const _0x38dd33=await _0x311ca9['getStateAsync'](_0x300856(0x140));if(_0x38dd33&&_0x38dd33[_0x300856(0x130)])_0x573bc7=JSON[_0x300856(0x16a)](_0x38dd33[_0x300856(0x130)]);}catch(_0x58740b){}let _0x1baa7e=[];try{const _0x58bc2f=await _0x311ca9['getStateAsync'](_0x300856(0x134));if(_0x58bc2f&&_0x58bc2f[_0x300856(0x130)])_0x1baa7e=JSON[_0x300856(0x16a)](_0x58bc2f[_0x300856(0x130)]);}catch(_0xf2d2e3){}const _0x365069=_0x311ca9['config'][_0x300856(0x191)]||[];let _0xf40e34=![];for(let _0x2c06f0=_0xa2aba[_0x300856(0x16c)]-0x1;_0x2c06f0>=0x0;_0x2c06f0--){const _0x4e3d47=_0xa2aba[_0x2c06f0],_0x3d18d5=_0x365069[_0x300856(0xf9)](_0x57d619=>normalize(_0x57d619[_0x300856(0xf6)])===normalize(_0x4e3d47)&&(_0x57d619[_0x300856(0x133)]===_0x300856(0x157)||_0x57d619[_0x300856(0x133)]==='thermostat'));if(!_0x3d18d5){_0x311ca9[_0x300856(0xf5)][_0x300856(0x15e)](_0x300856(0x188)+_0x4e3d47+_0x300856(0x15f)),_0xa2aba['splice'](_0x2c06f0,0x1),_0xf40e34=!![];continue;}if(_0x3d18d5){const _0x23b5a7=await findRelatedId(_0x311ca9,_0x3d18d5['id'],_0x300856(0x181)),_0x54e8c8=await _0x311ca9['getForeignStateAsync'](_0x3d18d5['id']);if(_0x23b5a7){const _0x3a4d99=await _0x311ca9[_0x300856(0x16f)](_0x23b5a7);if(_0x3a4d99&&typeof _0x3a4d99[_0x300856(0x130)]===_0x300856(0x16b)){let _0xc9bbc1=![],_0x3517ae='';Math['abs'](_0x3a4d99[_0x300856(0x130)]-ECO_TEMP)>0.5&&(_0xc9bbc1=!![],_0x3517ae='manual');if(!_0xc9bbc1&&_0x54e8c8&&typeof _0x54e8c8[_0x300856(0x130)]===_0x300856(0x16b)){const _0x4c24e2=_0x573bc7[_0x4e3d47]||_0x573bc7[_0x300856(0x100)]||0x15;_0x54e8c8[_0x300856(0x130)]<_0x4c24e2+0.2&&(_0xc9bbc1=!![],_0x3517ae=_0x300856(0x117));}if(_0xc9bbc1){if(_0x3517ae===_0x300856(0x160)){_0x311ca9[_0x300856(0xf5)]['info'](_0x300856(0x151)+_0x4e3d47+_0x300856(0x12f)+_0x3a4d99[_0x300856(0x130)]+_0x300856(0x176)+ECO_TEMP+'Â°C).\x20Entferne\x20Status.');const _0x412b92=lastActions[_0x300856(0x189)+_0x4e3d47],_0x3007d6=_0x412b92&&Date[_0x300856(0x12a)]()-_0x412b92<0x2*0x3c*0x3e8;if(!_0x3007d6&&_0x3a4d99['val']>ECO_TEMP+0.5)_0x311ca9['sendToPythonWrapper']&&(_0x311ca9[_0x300856(0xf5)][_0x300856(0x118)](_0x300856(0x110)+_0x4e3d47+'\x20wurde\x20manuell\x20erhÃ¶ht.'),_0x311ca9['sendToPythonWrapper']('TRAIN_RL_PENALTY',{'room':_0x4e3d47}));else _0x3007d6&&_0x311ca9['log']['info'](_0x300856(0x19c)+_0x4e3d47+_0x300856(0x10c));}else{if(_0x3517ae===_0x300856(0x117)){let _0x3dc7ce=![];if(_0x1baa7e[_0x300856(0xf9)](_0x24bf90=>_0x24bf90[_0x300856(0x17a)]===_0x4e3d47))_0x3dc7ce=!![];const _0x5cecd2=_0x365069['filter'](_0x37aee8=>normalize(_0x37aee8[_0x300856(0xf6)])===normalize(_0x4e3d47)&&(_0x37aee8['type']==='window'||_0x37aee8[_0x300856(0x133)]===_0x300856(0x15d)||_0x37aee8[_0x300856(0x133)]===_0x300856(0x135)));for(const _0x28922b of _0x5cecd2){try{const _0x4b1fa0=await _0x311ca9['getForeignStateAsync'](_0x28922b['id']);if(_0x4b1fa0&&(_0x4b1fa0['val']===!![]||_0x4b1fa0[_0x300856(0x130)]===0x1||String(_0x4b1fa0[_0x300856(0x130)])[_0x300856(0x144)]()===_0x300856(0x174)))_0x3dc7ce=!![];}catch(_0x5cbc45){}}if(_0x3dc7ce)_0x311ca9['log'][_0x300856(0x118)](_0x300856(0x195)+_0x4e3d47+_0x300856(0x146));else{const _0x4b8d09=_0x573bc7[_0x4e3d47]||_0x573bc7[_0x300856(0x100)]||0x15;_0x311ca9['log']['info'](_0x300856(0x18b)+_0x4e3d47+'\x20erreicht\x20Limit\x20('+_0x54e8c8['val']+_0x300856(0x139)+(_0x4b8d09+0.2)+_0x300856(0x186)),await _0x311ca9[_0x300856(0x10e)](_0x23b5a7,_0x4b8d09),await logAutomationAction(_0x311ca9,'[WATCHDOG]\x20'+_0x4e3d47+_0x300856(0x10f)+_0x4b8d09+'Â°C'),lastActions['rescue_'+_0x4e3d47]=Date['now']();}}}_0xa2aba[_0x300856(0x184)](_0x2c06f0,0x1),_0xf40e34=!![];}}}}}_0xf40e34&&await _0x311ca9[_0x300856(0x128)](_0x2c0fb0,{'val':JSON[_0x300856(0x173)](_0xa2aba),'ack':!![]});}catch(_0x1e215c){}}async function applyEnergySavings(_0x8af071,_0x26d962){const _0x35d77f=a1_0x167009;await cleanupGhostInterventions(_0x8af071);if(!_0x26d962||_0x26d962[_0x35d77f(0x16c)]===0x0)return;const _0x39f2e9=_0x8af071['config'][_0x35d77f(0x191)]||[],_0x5588a7=Date[_0x35d77f(0x12a)]();for(const _0x5de9b0 of _0x26d962){const _0x3eaf79=_0x5de9b0[_0x35d77f(0x17a)],_0x4ad0a9=_0x5de9b0[_0x35d77f(0x11f)],_0x32b215=_0x5de9b0[_0x35d77f(0x154)]||0x15;if(lastActions[_0x35d77f(0x15a)+_0x3eaf79]&&_0x5588a7-lastActions[_0x35d77f(0x15a)+_0x3eaf79]<RESCUE_LOCK_MS)continue;const _0x525db0=_0x39f2e9[_0x35d77f(0xf9)](_0x2fad93=>normalize(_0x2fad93[_0x35d77f(0xf6)])===normalize(_0x3eaf79)&&(_0x2fad93[_0x35d77f(0x133)]===_0x35d77f(0x157)||_0x2fad93[_0x35d77f(0x133)]==='thermostat'));if(!_0x525db0)continue;const _0x3f3d0e=await findRelatedId(_0x8af071,_0x525db0['id'],'setpoint');if(_0x3f3d0e){if(lastActions[_0x35d77f(0x187)+_0x3eaf79]&&_0x5588a7-lastActions[_0x35d77f(0x187)+_0x3eaf79]<0x1e*0x3c*0x3e8)continue;const _0x4020c4=await _0x8af071[_0x35d77f(0x16f)](_0x3f3d0e);if(_0x4020c4&&typeof _0x4020c4[_0x35d77f(0x130)]===_0x35d77f(0x16b)){const _0x1e355e=_0x4020c4[_0x35d77f(0x130)];_0x1e355e!==ECO_TEMP&&await manageMpcIntervention(_0x8af071,_0x3eaf79,_0x35d77f(0x129));if(_0x4ad0a9>0x1e)_0x1e355e>ECO_TEMP+0.5&&(_0x8af071[_0x35d77f(0xf5)][_0x35d77f(0x118)](_0x35d77f(0x148)+_0x3eaf79+_0x35d77f(0x170)+ECO_TEMP+'Â°C!\x20(Puffer:\x20'+_0x4ad0a9+'\x20min)'),await _0x8af071[_0x35d77f(0x10e)](_0x3f3d0e,ECO_TEMP),await manageMpcIntervention(_0x8af071,_0x3eaf79,_0x35d77f(0xf1)),lastActions[_0x35d77f(0x187)+_0x3eaf79]=_0x5588a7,await logAutomationAction(_0x8af071,_0x35d77f(0x194)+_0x3eaf79+':\x20Absenkung\x20auf\x20'+ECO_TEMP+'Â°C'));else _0x4ad0a9<=0xf&&(_0x1e355e<_0x32b215&&(_0x8af071[_0x35d77f(0xf5)][_0x35d77f(0x118)]('ðŸ”¥\x20[MPC\x20ACTION]\x20Heize\x20'+_0x3eaf79+_0x35d77f(0x172)+_0x32b215+_0x35d77f(0x115)),await _0x8af071[_0x35d77f(0x10e)](_0x3f3d0e,_0x32b215),await manageMpcIntervention(_0x8af071,_0x3eaf79,_0x35d77f(0x129)),lastActions[_0x35d77f(0x187)+_0x3eaf79]=_0x5588a7,await logAutomationAction(_0x8af071,_0x35d77f(0x194)+_0x3eaf79+_0x35d77f(0xf4)+_0x32b215+'Â°C')));}}else _0x8af071[_0x35d77f(0xf5)][_0x35d77f(0x15e)](_0x35d77f(0x183)+_0x3eaf79+_0x35d77f(0xfe));}}module[a1_0x167009(0x164)]={'handlePrediction':handlePrediction,'applyEnergySavings':applyEnergySavings,'scanThermostats':scanThermostats,'checkCalendarTriggers':checkCalendarTriggers,'updateSchedulePreview':updateSchedulePreview,'cleanupGhostInterventions':cleanupGhostInterventions};