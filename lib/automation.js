const a1_0x5e9e3a=a1_0x14ab;(function(_0x5a33db,_0x2f8120){const _0x3ab27c=a1_0x14ab,_0x277403=_0x5a33db();while(!![]){try{const _0x27ddbb=-parseInt(_0x3ab27c(0x122))/0x1+-parseInt(_0x3ab27c(0x129))/0x2+parseInt(_0x3ab27c(0x124))/0x3*(-parseInt(_0x3ab27c(0x139))/0x4)+parseInt(_0x3ab27c(0x165))/0x5+-parseInt(_0x3ab27c(0x14b))/0x6*(-parseInt(_0x3ab27c(0x160))/0x7)+parseInt(_0x3ab27c(0x120))/0x8+parseInt(_0x3ab27c(0x14c))/0x9*(parseInt(_0x3ab27c(0x12c))/0xa);if(_0x27ddbb===_0x2f8120)break;else _0x277403['push'](_0x277403['shift']());}catch(_0x2af2f3){_0x277403['push'](_0x277403['shift']());}}}(a1_0x2cf7,0x20d7a));const a1_0x4fe8a9=(function(){let _0xe775e6=!![];return function(_0x7f222d,_0x52a486){const _0x1786df=_0xe775e6?function(){const _0x55e183=a1_0x14ab;if(_0x52a486){const _0x460dcc=_0x52a486[_0x55e183(0x159)](_0x7f222d,arguments);return _0x52a486=null,_0x460dcc;}}:function(){};return _0xe775e6=![],_0x1786df;};}()),a1_0x535998=a1_0x4fe8a9(this,function(){const _0x1e9411=a1_0x14ab;return a1_0x535998[_0x1e9411(0x121)]()[_0x1e9411(0x15c)](_0x1e9411(0x152))[_0x1e9411(0x121)]()[_0x1e9411(0x119)](a1_0x535998)[_0x1e9411(0x15c)]('(((.+)+)+)+$');});a1_0x535998();'use strict';function a1_0x2cf7(){const _0x5e7cbb=['analysis.automation.lastAction','448090FKKajL','level.temperature','val','thermostatMapping','Manuelles\x20Mapping',':\x20-1¬∞C\x20(Sparpotenzial\x20genutzt)','filter','common','active','name','role',')\x20auf\x20','find','8OKjcAe','[MPC]\x20','ACTUAL','light','switch','Nicht\x20gefunden','config','parse','occupied_heating_setpoint','now','type','debug','devices','split','setForeignStateAsync','setStateAsync','mpc_','local_temperature','66eTPCFc','63QOHFHr','number','room','sensor','./ai_agent','getForeignStateAsync','(((.+)+)+)+$','reason','\x20->\x20Schalte\x20','toLowerCase','minutes_safe','Unbekannt','approved','apply','getStateAsync','Fehlt','search','target','string','replace','7189quQbXE','üîç\x20Device-Search\x20failed\x20for\x20predicted\x20room\x20\x27','temperature','ACTUAL_TEMPERATURE','off','642725NjUZdc','consultButler','temp','thermostat','.1.SET_POINT_TEMPERATURE','join','üçÉ\x20MPC\x20Autonomy:\x20Senke\x20','\x20min)','toUpperCase','sort','entries','constructor','slice','analysis.automation.confidenceThreshold','localeCompare','.1.TEMPERATURE','dimmer','includes','622600UgHiTn','toString','172108SBfwzU','Unknown','234483SGscUZ','location','target_temperature','info','Auto-Erkennung','136756tMcvls','log'];a1_0x2cf7=function(){return _0x5e7cbb;};return a1_0x2cf7();}const aiAgent=require(a1_0x5e9e3a(0x150)),COOLDOWN_MS=0x3c*0x3e8,lastActions={};function normalize(_0x57dc9d){const _0x309b65=a1_0x5e9e3a;if(!_0x57dc9d)return'';return _0x57dc9d[_0x309b65(0x155)]()[_0x309b65(0x15f)](/\s+/g,'')['trim']();}async function handlePrediction(_0x1217dc,_0x43fcd8,_0x35090f){const _0x534cd9=a1_0x5e9e3a;if(!_0x43fcd8||_0x43fcd8===_0x534cd9(0x123))return;let _0x2185ce=_0x534cd9(0x164),_0x52028c=0.6;try{const _0x804b6a=await _0x1217dc[_0x534cd9(0x15a)]('analysis.automation.mode');if(_0x804b6a&&_0x804b6a[_0x534cd9(0x12e)])_0x2185ce=_0x804b6a[_0x534cd9(0x12e)];const _0x3a55c5=await _0x1217dc[_0x534cd9(0x15a)](_0x534cd9(0x11b));if(_0x3a55c5&&_0x3a55c5[_0x534cd9(0x12e)])_0x52028c=_0x3a55c5[_0x534cd9(0x12e)];}catch(_0x36968d){}if(_0x2185ce===_0x534cd9(0x164)||_0x35090f<_0x52028c)return;const _0x151b86=Date[_0x534cd9(0x142)]();if(lastActions[_0x43fcd8]&&_0x151b86-lastActions[_0x43fcd8]<COOLDOWN_MS)return;const _0x2f09ec=_0x1217dc[_0x534cd9(0x13f)]['devices']||[],_0x5479df=normalize(_0x43fcd8),_0x14c7a6=_0x2f09ec[_0x534cd9(0x138)](_0x404ef1=>normalize(_0x404ef1[_0x534cd9(0x125)])===_0x5479df&&(_0x404ef1['type']===_0x534cd9(0x13c)||_0x404ef1['type']===_0x534cd9(0x11e)||_0x404ef1['type']===_0x534cd9(0x13d)));if(!_0x14c7a6){_0x1217dc[_0x534cd9(0x12a)][_0x534cd9(0x144)](_0x534cd9(0x161)+_0x43fcd8+'\x27.');return;}const _0x4295c7=await aiAgent[_0x534cd9(0x166)](_0x1217dc,_0x43fcd8,_0x14c7a6[_0x534cd9(0x135)],_0x35090f);if(!_0x4295c7[_0x534cd9(0x158)])return;const _0x5abc34='Pr√§diktion:\x20'+_0x43fcd8+_0x534cd9(0x154)+_0x14c7a6[_0x534cd9(0x135)]+'\x20('+_0x4295c7[_0x534cd9(0x153)]+')';await _0x1217dc[_0x534cd9(0x148)](_0x534cd9(0x12b),{'val':'['+_0x2185ce[_0x534cd9(0x16d)]()+']\x20'+_0x5abc34,'ack':!![]});if(_0x2185ce===_0x534cd9(0x134)){const _0x482793=await _0x1217dc['getForeignStateAsync'](_0x14c7a6['id']);(!_0x482793||!_0x482793[_0x534cd9(0x12e)]&&_0x482793[_0x534cd9(0x12e)]!==!![])&&await _0x1217dc[_0x534cd9(0x147)](_0x14c7a6['id'],!![]),lastActions[_0x43fcd8]=_0x151b86;}}async function findSetpointId(_0x4fd097,_0x3bf821){const _0x1013b6=a1_0x5e9e3a;if(_0x4fd097[_0x1013b6(0x13f)][_0x1013b6(0x12f)]){let _0x33efd2=_0x4fd097[_0x1013b6(0x13f)][_0x1013b6(0x12f)];if(typeof _0x33efd2===_0x1013b6(0x15e))try{_0x33efd2=JSON['parse'](_0x33efd2);}catch(_0x26083b){_0x33efd2={};}if(_0x33efd2&&_0x33efd2[_0x3bf821])return _0x33efd2[_0x3bf821];}const _0xc02894=[{'s':'.1.ACTUAL_TEMPERATURE','t':_0x1013b6(0x169)},{'s':_0x1013b6(0x11d),'t':'.4.SET_TEMPERATURE'},{'s':_0x1013b6(0x163),'t':'SET_POINT_TEMPERATURE'},{'s':_0x1013b6(0x14a),'t':_0x1013b6(0x141)},{'s':'local_temperature','t':'current_heating_setpoint'},{'s':_0x1013b6(0x162),'t':_0x1013b6(0x126)},{'s':_0x1013b6(0x13b),'t':'SET'},{'s':'Ist','t':'Soll'},{'s':_0x1013b6(0x162),'t':'setpoint'}];for(const _0x5a6cde of _0xc02894){if(_0x3bf821['includes'](_0x5a6cde['s'])){const _0x26c5f0=_0x3bf821['replace'](_0x5a6cde['s'],_0x5a6cde['t']),_0x17887f=await _0x4fd097['getForeignObjectAsync'](_0x26c5f0);if(_0x17887f)return _0x26c5f0;}}try{const _0x45a795=_0x3bf821[_0x1013b6(0x146)]('.');if(_0x45a795['length']>0x2){const _0x46a20d=_0x45a795[_0x1013b6(0x11a)](0x0,-0x1)[_0x1013b6(0x16a)]('.'),_0x1cf705=await _0x4fd097['getForeignObjectsAsync'](_0x46a20d+'.*');for(const [_0x465fb3,_0xded5ab]of Object[_0x1013b6(0x118)](_0x1cf705)){if(_0x465fb3===_0x3bf821)continue;if(_0xded5ab&&_0xded5ab[_0x1013b6(0x133)]&&_0xded5ab[_0x1013b6(0x133)]['write']===!![]){const _0x45f22f=_0x465fb3[_0x1013b6(0x155)](),_0x2f8fa3=(_0xded5ab[_0x1013b6(0x133)][_0x1013b6(0x136)]||'')[_0x1013b6(0x155)]();if(_0x45f22f['includes']('set')||_0x45f22f[_0x1013b6(0x11f)]('soll')||_0x45f22f[_0x1013b6(0x11f)](_0x1013b6(0x15d))||_0x2f8fa3['includes'](_0x1013b6(0x12d))||_0x2f8fa3[_0x1013b6(0x11f)](_0x1013b6(0x168)))return _0x465fb3;}}}}catch(_0x4c3634){}return null;}async function scanThermostats(_0x2cd51c){const _0x2256f2=a1_0x5e9e3a,_0x1f660b=_0x2cd51c['config'][_0x2256f2(0x145)]||[],_0x3da81d=[],_0x27ceca=_0x1f660b[_0x2256f2(0x132)](_0x106af6=>_0x106af6['id']&&_0x106af6['id'][_0x2256f2(0x11f)](_0x2256f2(0x162))||_0x106af6[_0x2256f2(0x143)]&&[_0x2256f2(0x162),'thermostat',_0x2256f2(0x14f)][_0x2256f2(0x11f)](_0x106af6[_0x2256f2(0x143)])||_0x106af6[_0x2256f2(0x135)]&&_0x106af6[_0x2256f2(0x135)][_0x2256f2(0x155)]()[_0x2256f2(0x11f)](_0x2256f2(0x167)));for(const _0x51d147 of _0x27ceca){const _0x2e07cb=await findSetpointId(_0x2cd51c,_0x51d147['id']);let _0x2f7a95=_0x2256f2(0x13e),_0x35c9f6=![],_0x27c9f7=_0x2cd51c[_0x2256f2(0x13f)][_0x2256f2(0x12f)]||{};if(typeof _0x27c9f7===_0x2256f2(0x15e))try{_0x27c9f7=JSON[_0x2256f2(0x140)](_0x27c9f7);}catch(_0x49ee39){}if(_0x27c9f7[_0x51d147['id']]&&_0x27c9f7[_0x51d147['id']]===_0x2e07cb)_0x2f7a95=_0x2256f2(0x130),_0x35c9f6=!![];else _0x2e07cb&&(_0x2f7a95=_0x2256f2(0x128));_0x3da81d['push']({'room':_0x51d147[_0x2256f2(0x125)]||_0x2256f2(0x157),'sensorId':_0x51d147['id'],'setpointId':_0x2e07cb||'-','source':_0x2f7a95,'isManual':_0x35c9f6,'status':_0x2e07cb?'OK':_0x2256f2(0x15b)});}return _0x3da81d[_0x2256f2(0x16e)]((_0x1d4c2f,_0x2cf0f4)=>_0x1d4c2f[_0x2256f2(0x14e)][_0x2256f2(0x11c)](_0x2cf0f4[_0x2256f2(0x14e)]));}async function applyEnergySavings(_0xcf9347,_0x148f0e){const _0x52068e=a1_0x5e9e3a,_0x1f16a2=_0xcf9347[_0x52068e(0x13f)][_0x52068e(0x145)]||[];for(const _0x21ab97 of _0x148f0e){const _0x3705fd=_0x21ab97['room'],_0xb852e4=_0x21ab97[_0x52068e(0x156)],_0x1e9bdd=Date['now']();if(lastActions[_0x52068e(0x149)+_0x3705fd]&&_0x1e9bdd-lastActions[_0x52068e(0x149)+_0x3705fd]<0x1e*0x3c*0x3e8)continue;const _0x143ef2=_0x1f16a2[_0x52068e(0x138)](_0x143ce2=>normalize(_0x143ce2[_0x52068e(0x125)])===normalize(_0x3705fd));if(!_0x143ef2)continue;const _0x1d5082=await findSetpointId(_0xcf9347,_0x143ef2['id']);if(_0x1d5082){const _0x2155ad=await _0xcf9347[_0x52068e(0x151)](_0x1d5082);if(_0x2155ad&&typeof _0x2155ad['val']===_0x52068e(0x14d)){const _0x5af685=_0x2155ad['val'];if(_0xb852e4>0x1e&&_0x5af685>0x11){const _0x103145=_0x5af685-0x1;_0xcf9347[_0x52068e(0x12a)][_0x52068e(0x127)](_0x52068e(0x16b)+_0x3705fd+'\x20('+_0x1d5082+_0x52068e(0x137)+_0x103145+'¬∞C\x20(Coasting\x20m√∂glich:\x20'+_0xb852e4+_0x52068e(0x16c)),await _0xcf9347[_0x52068e(0x147)](_0x1d5082,_0x103145),lastActions[_0x52068e(0x149)+_0x3705fd]=_0x1e9bdd,await _0xcf9347[_0x52068e(0x148)](_0x52068e(0x12b),{'val':_0x52068e(0x13a)+_0x3705fd+_0x52068e(0x131),'ack':!![]});}}}}}function a1_0x14ab(_0x41838d,_0x394570){const _0x3c2f46=a1_0x2cf7();return a1_0x14ab=function(_0x535998,_0x4fe8a9){_0x535998=_0x535998-0x118;let _0x2cf704=_0x3c2f46[_0x535998];return _0x2cf704;},a1_0x14ab(_0x41838d,_0x394570);}module['exports']={'handlePrediction':handlePrediction,'applyEnergySavings':applyEnergySavings,'scanThermostats':scanThermostats};