const a1_0x2cd2d0=a1_0xd92a;(function(_0x7259f5,_0x5fcc65){const _0x8c96ee=a1_0xd92a,_0x2c374d=_0x7259f5();while(!![]){try{const _0xea8ce3=parseInt(_0x8c96ee(0x11a))/0x1+parseInt(_0x8c96ee(0x16d))/0x2*(-parseInt(_0x8c96ee(0x123))/0x3)+-parseInt(_0x8c96ee(0x156))/0x4+parseInt(_0x8c96ee(0x16c))/0x5*(parseInt(_0x8c96ee(0x180))/0x6)+-parseInt(_0x8c96ee(0x13a))/0x7*(parseInt(_0x8c96ee(0xf1))/0x8)+-parseInt(_0x8c96ee(0x172))/0x9*(-parseInt(_0x8c96ee(0x17a))/0xa)+parseInt(_0x8c96ee(0x148))/0xb*(parseInt(_0x8c96ee(0x165))/0xc);if(_0xea8ce3===_0x5fcc65)break;else _0x2c374d['push'](_0x2c374d['shift']());}catch(_0x55f57d){_0x2c374d['push'](_0x2c374d['shift']());}}}(a1_0x3f44,0x20868));const a1_0x4cc0c3=(function(){let _0x33a1c3=!![];return function(_0x2c4fc2,_0x1b5430){const _0x5eb565=_0x33a1c3?function(){const _0x27d8f9=a1_0xd92a;if(_0x1b5430){const _0x47da7e=_0x1b5430[_0x27d8f9(0x13c)](_0x2c4fc2,arguments);return _0x1b5430=null,_0x47da7e;}}:function(){};return _0x33a1c3=![],_0x5eb565;};}()),a1_0x118abf=a1_0x4cc0c3(this,function(){const _0x5b2745=a1_0xd92a;return a1_0x118abf['toString']()[_0x5b2745(0x199)](_0x5b2745(0x183))[_0x5b2745(0x15d)]()[_0x5b2745(0xeb)](a1_0x118abf)[_0x5b2745(0x199)](_0x5b2745(0x183));});a1_0x118abf();'use strict';const aiAgent=require(a1_0x2cd2d0(0x155)),COOLDOWN_MS=0x3c*0x3e8,CAL_COOLDOWN_MS=0x5a*0x3c*0x3e8,RESCUE_LOCK_MS=0x78*0x3c*0x3e8,ECO_TEMP=0x11,lastActions={};function normalize(_0x26f05d){const _0x305b1c=a1_0x2cd2d0;if(!_0x26f05d)return'';return _0x26f05d[_0x305b1c(0x130)]()[_0x305b1c(0x107)](/\s+/g,'')[_0x305b1c(0x19a)]();}function a1_0x3f44(){const _0x5ef091=['84489wLYVhW','isArray','ðŸ§¹\x20[MPC\x20CLEANUP]\x20','date',':\x20Absenkung\x20auf\x20','ACTUAL_TEMPERATURE','reason','ðŸ”¥\x20[MPC\x20ACTION]\x20Heize\x20','contact','dimmer','\x27\x20aktiv.\x20Heize\x20auf\x20','forEach','length','toLowerCase','ACTUAL','analysis.energy.warmupTargets','local_temperature','room',']:\x20Raum-Trigger\x20\x27','setStateAsync','Â°C).\x20Entferne\x20Status.','ðŸ“…\x20[MPC\x20INFO]\x20','Â°C\x20(Vorlauf:\x20','548534ELwVLy','config','apply','temperature','[MPC]\x20','level',':\x20Aufheizen\x20auf\x20','\x20->\x20','entries','level.valve','Ist','ðŸ§¹\x20[MPC\x20CLEANUP]\x20Raum\x20\x27','localeCompare','SET','11VfZxBK','valveMapping','\x20min).','ðŸƒ\x20[MPC\x20ACTION]\x20Senke\x20','target','PrÃ¤diktion:\x20','rescue_','\x20ist\x20zu\x20kalt,\x20ABER\x20Fenster\x20offen/LÃ¼ftung\x20erkannt.\x20Heize\x20NICHT,\x20entferne\x20nur\x20Status.','switch','from','common','.1.TEMPERATURE','warn','./ai_agent','493856qZpNiv','message','active','set','.data.table','unit','Auto-Erkennung','toString','analysis.energy.warmupTimes','normal','Soll','ðŸŽ“\x20[RL-FEEDBACK]\x20Lerne\x20aus\x20Fehler:\x20','soll','\x20min)','analysis.energy.ventilationAlerts','3933420LxQqqw','analysis.automation.confidenceThreshold','Classic','off','analysis.energy.mpcActiveInterventions','indexOf','calendarInstance','313930WbeEhl','16ZvCAjP','too_cold','window','consultButler','type','18YLskgf','light','ðŸš¨\x20[MPC\x20WATCHDOG]\x20','remove','position','mpc_','system.mode','\x20erreicht\x20Limit\x20(','727000zyWGYD','abs','Calendar\x20Check\x20Error:\x20','.4.SET_TEMPERATURE','getForeignStateAsync','getStateAsync','6Lahsvg','ðŸ“…\x20SMART\x20SCHEDULE\x20[','toUpperCase','(((.+)+)+)+$','info','\x20->\x20Schalte\x20','val','triggerTime','TRAIN_RL_PENALTY','cal_','string','thermostat','setForeignStateAsync','.1.SET_POINT_TEMPERATURE','number','\x20auf\x20','exports','_calName','location','rÃ¼ckkehr','now','analysis.automation.actionLog','\x20gefunden!','eventStart','Unknown','search','trim','find','ðŸ“…\x20SMART\x20SCHEDULE\x20(Phase):\x20\x27Globaler\x20Start\x27\x20erkannt.\x20Heize\x20Haus\x20auf\x20(Vorlauf:\x20','.1.LEVEL','includes','event','stringify','push','default','valve','parse','constructor','Â°C\x20(nicht\x20','analysis.energy.schedulePreview','pi_heating_demand','split','sensor','24HUndKg','temp','SET_POINT_TEMPERATURE','filter','sort','\x20wurde\x20manuell\x20erhÃ¶ht.','analysis.automation.lastAction','summary','manual','.1.ACTUAL_TEMPERATURE','Unbekannt','[MPC\x20WARNING]\x20Kein\x20Setpoint\x20fÃ¼r\x20','[WATCHDOG]\x20','thermostatMapping','devices','log','urlaub\x20ende','level.temperature','[CAL]\x20','slice','role','state','replace','_date','openknx','minutes_safe','add','name','unshift','splice','getTime','currentSystemMode','wert','stellwert','thermostat.setpoint','map','analysis.energy.warmupSources','calendarSelection','\x20ist\x20auf\x20','sendToPythonWrapper','approved','181107QhMRhZ','useCalendar','target_temperature','\x27\x20hat\x20kein\x20GerÃ¤t\x20mehr.\x20LÃ¶sche\x20Eintrag.','open','ankunft','setpoint','messwert','ðŸŒ¬ï¸\x20[MPC\x20WATCHDOG]\x20'];a1_0x3f44=function(){return _0x5ef091;};return a1_0x3f44();}async function logAutomationAction(_0x139ac2,_0x203ad0){const _0x1cdfd1=a1_0x2cd2d0;await _0x139ac2[_0x1cdfd1(0x136)](_0x1cdfd1(0xf7),{'val':_0x203ad0,'ack':!![]});try{const _0x2e6976=_0x1cdfd1(0x195),_0x64c144=await _0x139ac2[_0x1cdfd1(0x17f)](_0x2e6976);let _0x5ad4d7=[];if(_0x64c144&&_0x64c144[_0x1cdfd1(0x186)])try{_0x5ad4d7=JSON[_0x1cdfd1(0xea)](_0x64c144[_0x1cdfd1(0x186)]);}catch(_0x4610d9){}_0x5ad4d7[_0x1cdfd1(0x10d)]({'ts':Date[_0x1cdfd1(0x194)](),'msg':_0x203ad0});if(_0x5ad4d7[_0x1cdfd1(0x12f)]>0x32)_0x5ad4d7=_0x5ad4d7[_0x1cdfd1(0x104)](0x0,0x32);await _0x139ac2[_0x1cdfd1(0x136)](_0x2e6976,{'val':JSON[_0x1cdfd1(0x1a0)](_0x5ad4d7),'ack':!![]});}catch(_0x1d4b93){}}async function handlePrediction(_0x2a52ef,_0x4b3dc7,_0x2e56bd){const _0x41df8c=a1_0x2cd2d0;if(!_0x4b3dc7||_0x4b3dc7===_0x41df8c(0x198))return;let _0x50b750=_0x41df8c(0x168),_0x36bb94=0.6;try{const _0x207420=await _0x2a52ef['getStateAsync']('analysis.automation.mode');if(_0x207420&&_0x207420[_0x41df8c(0x186)])_0x50b750=_0x207420[_0x41df8c(0x186)];const _0x1f7123=await _0x2a52ef[_0x41df8c(0x17f)](_0x41df8c(0x166));if(_0x1f7123&&_0x1f7123[_0x41df8c(0x186)])_0x36bb94=_0x1f7123['val'];}catch(_0xed3236){}if(_0x50b750==='off'||_0x2e56bd<_0x36bb94)return;const _0x37a829=Date['now']();if(lastActions[_0x4b3dc7]&&_0x37a829-lastActions[_0x4b3dc7]<COOLDOWN_MS)return;const _0x3af3e9=_0x2a52ef[_0x41df8c(0x13b)][_0x41df8c(0xff)]||[],_0x40c679=normalize(_0x4b3dc7),_0x398ccc=_0x3af3e9['find'](_0x47d48e=>normalize(_0x47d48e[_0x41df8c(0x192)])===_0x40c679&&(_0x47d48e[_0x41df8c(0x171)]===_0x41df8c(0x173)||_0x47d48e[_0x41df8c(0x171)]===_0x41df8c(0x12c)||_0x47d48e[_0x41df8c(0x171)]===_0x41df8c(0x150)));if(!_0x398ccc)return;const _0x58c1cb=await aiAgent[_0x41df8c(0x170)](_0x2a52ef,_0x4b3dc7,_0x398ccc['name'],_0x2e56bd);if(!_0x58c1cb[_0x41df8c(0x119)])return;const _0x237682=_0x41df8c(0x14d)+_0x4b3dc7+_0x41df8c(0x185)+_0x398ccc[_0x41df8c(0x10c)]+'\x20('+_0x58c1cb[_0x41df8c(0x129)]+')';await logAutomationAction(_0x2a52ef,'['+_0x50b750[_0x41df8c(0x182)]()+']\x20'+_0x237682);if(_0x50b750===_0x41df8c(0x158)){const _0x51b48f=await _0x2a52ef[_0x41df8c(0x17e)](_0x398ccc['id']);(!_0x51b48f||!_0x51b48f[_0x41df8c(0x186)]&&_0x51b48f[_0x41df8c(0x186)]!==!![])&&await _0x2a52ef[_0x41df8c(0x18c)](_0x398ccc['id'],!![]),lastActions[_0x4b3dc7]=_0x37a829;}}async function findRelatedId(_0xecc33c,_0x116d09,_0x292273=a1_0x2cd2d0(0x120)){const _0x4faa2c=a1_0x2cd2d0;if(_0x292273===_0x4faa2c(0x120)&&_0xecc33c[_0x4faa2c(0x13b)][_0x4faa2c(0xfe)]){let _0x594268=_0xecc33c[_0x4faa2c(0x13b)][_0x4faa2c(0xfe)];if(typeof _0x594268===_0x4faa2c(0x18a))try{_0x594268=JSON[_0x4faa2c(0xea)](_0x594268);}catch(_0x511509){}if(_0x594268&&_0x594268[_0x116d09])return _0x594268[_0x116d09];}if(_0x292273===_0x4faa2c(0xe9)&&_0xecc33c[_0x4faa2c(0x13b)][_0x4faa2c(0x149)]){let _0x48f4e4=_0xecc33c[_0x4faa2c(0x13b)]['valveMapping'];if(typeof _0x48f4e4===_0x4faa2c(0x18a))try{_0x48f4e4=JSON[_0x4faa2c(0xea)](_0x48f4e4);}catch(_0xa6f4b6){}if(_0x48f4e4&&_0x48f4e4[_0x116d09])return _0x48f4e4[_0x116d09];}let _0x574165=[];if(_0x292273===_0x4faa2c(0x120))_0x574165=[{'s':_0x4faa2c(0xfa),'t':'.1.SET_POINT_TEMPERATURE'},{'s':'.1.TEMPERATURE','t':_0x4faa2c(0x18d)},{'s':_0x4faa2c(0x153),'t':_0x4faa2c(0x17d)},{'s':_0x4faa2c(0x128),'t':_0x4faa2c(0xf3)},{'s':'local_temperature','t':'occupied_heating_setpoint'},{'s':_0x4faa2c(0x133),'t':'current_heating_setpoint'},{'s':_0x4faa2c(0x13d),'t':_0x4faa2c(0x11c)},{'s':_0x4faa2c(0x131),'t':_0x4faa2c(0x147)},{'s':_0x4faa2c(0x144),'t':_0x4faa2c(0x160)},{'s':_0x4faa2c(0x13d),'t':_0x4faa2c(0x120)}];else _0x292273===_0x4faa2c(0xe9)&&(_0x574165=[{'s':'.1.ACTUAL_TEMPERATURE','t':_0x4faa2c(0x19d)},{'s':_0x4faa2c(0x153),'t':'.1.LEVEL'},{'s':'.1.TEMPERATURE','t':'.4.VALVE_STATE'},{'s':_0x4faa2c(0x133),'t':_0x4faa2c(0xee)},{'s':_0x4faa2c(0x13d),'t':'valve_position'},{'s':_0x4faa2c(0x13d),'t':'level'}]);for(const _0x3de9fd of _0x574165){if(_0x116d09[_0x4faa2c(0x19e)](_0x3de9fd['s'])){const _0x2de3e8=_0x116d09[_0x4faa2c(0x107)](_0x3de9fd['s'],_0x3de9fd['t']),_0x479f08=await _0xecc33c['getForeignObjectAsync'](_0x2de3e8);if(_0x479f08)return _0x2de3e8;}}try{const _0xc2d94f=_0x116d09['split']('.');if(_0xc2d94f['length']>0x2){const _0x508fa5=_0xc2d94f[_0x4faa2c(0x104)](0x0,-0x1)['join']('.'),_0x51def9=await _0xecc33c['getForeignObjectsAsync'](_0x508fa5+'.*'),_0x4b4475=[],_0x2b08c6=_0x116d09[_0x4faa2c(0xef)](/[._]+/)[_0x4faa2c(0xf4)](_0x511154=>![_0x4faa2c(0x109),'0','hm-rpc','ist',_0x4faa2c(0x111),_0x4faa2c(0x13d),'actual',_0x4faa2c(0xf0),_0x4faa2c(0x121),_0x4faa2c(0x106)][_0x4faa2c(0x19e)](_0x511154[_0x4faa2c(0x130)]()));for(const [_0x32ad33,_0x2b6972]of Object[_0x4faa2c(0x142)](_0x51def9)){if(_0x32ad33===_0x116d09)continue;if(_0x2b6972&&_0x2b6972[_0x4faa2c(0x152)]){const _0x810db9=_0x32ad33[_0x4faa2c(0x130)](),_0x20b076=(_0x2b6972[_0x4faa2c(0x152)][_0x4faa2c(0x105)]||'')[_0x4faa2c(0x130)](),_0x224b0=(_0x2b6972['common'][_0x4faa2c(0x15b)]||'')[_0x4faa2c(0x130)]();let _0x34d8c6=![];if(_0x292273===_0x4faa2c(0x120)&&_0x2b6972['common']['write']===!![])_0x34d8c6=_0x810db9[_0x4faa2c(0x19e)](_0x4faa2c(0x159))||_0x810db9[_0x4faa2c(0x19e)](_0x4faa2c(0x162))||_0x810db9[_0x4faa2c(0x19e)](_0x4faa2c(0x14c))||_0x20b076[_0x4faa2c(0x19e)](_0x4faa2c(0x102))||_0x20b076[_0x4faa2c(0x19e)](_0x4faa2c(0x113));else _0x292273===_0x4faa2c(0xe9)&&(_0x34d8c6=_0x810db9['includes'](_0x4faa2c(0x13f))||_0x810db9[_0x4faa2c(0x19e)](_0x4faa2c(0xe9))||_0x810db9['includes'](_0x4faa2c(0x112))||_0x810db9['includes'](_0x4faa2c(0x176))||_0x20b076[_0x4faa2c(0x19e)](_0x4faa2c(0x143))||_0x20b076['includes']('value.valve')||_0x224b0[_0x4faa2c(0x19e)]('%'));if(_0x34d8c6){const _0x570a09=_0x32ad33[_0x4faa2c(0xef)](/[._]+/)[_0x4faa2c(0x114)](_0x4418f4=>_0x4418f4['toLowerCase']());let _0x1610fc=0x0;_0x2b08c6['forEach'](_0x36696d=>{const _0x2180cd=_0x4faa2c;if(_0x570a09[_0x2180cd(0x19e)](_0x36696d['toLowerCase']()))_0x1610fc++;}),_0x4b4475['push']({'id':_0x32ad33,'score':_0x1610fc});}}}if(_0x4b4475['length']>0x0){_0x4b4475['sort']((_0x519fda,_0x1191ae)=>_0x1191ae['score']-_0x519fda['score']);if(_0x4b4475[0x0]['score']>0x0)return _0x4b4475[0x0]['id'];}}}catch(_0x5ae783){}return null;}async function scanThermostats(_0xa56f95){const _0x8272b9=a1_0x2cd2d0,_0x2f6918=_0xa56f95[_0x8272b9(0x13b)][_0x8272b9(0xff)]||[],_0x4d86a5=[],_0x47eb1f=_0x2f6918[_0x8272b9(0xf4)](_0x52635b=>_0x52635b['id']&&_0x52635b['id'][_0x8272b9(0x19e)](_0x8272b9(0x13d))||_0x52635b[_0x8272b9(0x171)]&&[_0x8272b9(0x13d),_0x8272b9(0x18b),_0x8272b9(0xf0)][_0x8272b9(0x19e)](_0x52635b[_0x8272b9(0x171)])||_0x52635b[_0x8272b9(0x10c)]&&_0x52635b[_0x8272b9(0x10c)][_0x8272b9(0x130)]()[_0x8272b9(0x19e)](_0x8272b9(0xf2)));for(const _0x3cc5d0 of _0x47eb1f){const _0xad1fdd=await findRelatedId(_0xa56f95,_0x3cc5d0['id'],'setpoint'),_0x518e2e=await findRelatedId(_0xa56f95,_0x3cc5d0['id'],_0x8272b9(0xe9));let _0x4e79ee='Nicht\x20gefunden',_0x591e61=![],_0x36835f=_0xa56f95[_0x8272b9(0x13b)]['thermostatMapping']||{};if(typeof _0x36835f==='string')try{_0x36835f=JSON[_0x8272b9(0xea)](_0x36835f);}catch(_0x567bb2){}let _0x515bb3=_0xa56f95['config'][_0x8272b9(0x149)]||{};if(typeof _0x515bb3===_0x8272b9(0x18a))try{_0x515bb3=JSON['parse'](_0x515bb3);}catch(_0xffd097){}if(_0x36835f[_0x3cc5d0['id']]&&_0x36835f[_0x3cc5d0['id']]===_0xad1fdd||_0x515bb3[_0x3cc5d0['id']]&&_0x515bb3[_0x3cc5d0['id']]===_0x518e2e)_0x4e79ee='Manuelles\x20Mapping',_0x591e61=!![];else(_0xad1fdd||_0x518e2e)&&(_0x4e79ee=_0x8272b9(0x15c));_0x4d86a5[_0x8272b9(0x1a1)]({'room':_0x3cc5d0[_0x8272b9(0x192)]||'Unbekannt','sensorId':_0x3cc5d0['id'],'setpointId':_0xad1fdd||'-','valveId':_0x518e2e||'-','source':_0x4e79ee,'isManual':_0x591e61,'status':_0xad1fdd&&_0x518e2e?'PERFECT':_0xad1fdd?'OK':'Fehlt'});}return _0x4d86a5['sort']((_0x48644f,_0x23ff8c)=>_0x48644f[_0x8272b9(0x134)][_0x8272b9(0x146)](_0x23ff8c[_0x8272b9(0x134)]));}async function updateSchedulePreview(_0x4cc0e2){const _0x58767b=a1_0x2cd2d0;if(!_0x4cc0e2[_0x58767b(0x13b)][_0x58767b(0x11b)]||!_0x4cc0e2[_0x58767b(0x13b)]['calendarInstance'])return;let _0x522c5c={};try{const _0x38f9a9=await _0x4cc0e2[_0x58767b(0x17f)]('analysis.energy.warmupTimes');if(_0x38f9a9&&_0x38f9a9['val'])_0x522c5c=JSON[_0x58767b(0xea)](_0x38f9a9[_0x58767b(0x186)]);}catch(_0x4b8bf2){}const _0x1d18a4=[],_0xf5f67a=Date[_0x58767b(0x194)](),_0x1f0e3b=0x30*0x3c*0x3c*0x3e8;try{const _0x558590=await _0x4cc0e2[_0x58767b(0x17e)](_0x4cc0e2[_0x58767b(0x13b)][_0x58767b(0x16b)]+_0x58767b(0x15a));if(!_0x558590||!_0x558590[_0x58767b(0x186)])return;const _0xa79d90=JSON[_0x58767b(0xea)](_0x558590['val']),_0x43c519=_0x4cc0e2['config'][_0x58767b(0x116)]||[],_0x2be73b=_0x4cc0e2[_0x58767b(0x13b)][_0x58767b(0xff)]||[],_0x46fb11=new Set();_0x2be73b[_0x58767b(0x12e)](_0x3f8a76=>{const _0x422fbc=_0x58767b;if(_0x3f8a76[_0x422fbc(0x192)])_0x46fb11['add'](_0x3f8a76[_0x422fbc(0x192)]);});for(const _0x23a4ec of _0xa79d90){if(_0x23a4ec[_0x58767b(0x191)]&&_0x43c519[_0x58767b(0x12f)]>0x0&&!_0x43c519[_0x58767b(0x19e)](_0x23a4ec['_calName']))continue;const _0x47b7dc=_0x23a4ec[_0x58767b(0x108)]||_0x23a4ec['eventStart']||_0x23a4ec[_0x58767b(0x126)];if(!_0x47b7dc)continue;const _0x4c130b=new Date(_0x47b7dc),_0x2710c0=_0x4c130b[_0x58767b(0x10f)]();if(isNaN(_0x2710c0))continue;if(_0x2710c0<_0xf5f67a)continue;if(_0x2710c0>_0xf5f67a+_0x1f0e3b)continue;const _0x120423=(_0x23a4ec['event']||_0x23a4ec[_0x58767b(0xf8)]||'')[_0x58767b(0x130)]();let _0x54a1dd=![],_0x7bd490=[],_0x5136c8=_0x23a4ec[_0x58767b(0x19f)]||_0x23a4ec[_0x58767b(0xf8)]||_0x58767b(0xfb);if(_0x120423[_0x58767b(0x19e)](_0x58767b(0x101))||_0x120423[_0x58767b(0x19e)](_0x58767b(0x193))||_0x120423[_0x58767b(0x19e)](_0x58767b(0x11f)))_0x54a1dd=!![],_0x7bd490=Array[_0x58767b(0x151)](_0x46fb11);else for(const _0x10137e of _0x46fb11){if(_0x120423[_0x58767b(0x19e)](_0x10137e['toLowerCase']()))_0x7bd490[_0x58767b(0x1a1)](_0x10137e);}_0x7bd490['length']>0x0&&_0x7bd490[_0x58767b(0x12e)](_0xc1665a=>{const _0x3f8a1b=_0x58767b;let _0x334fbc=0x3c;if(_0x54a1dd){let _0x2c5382=0x0;Object['values'](_0x522c5c)[_0x3f8a1b(0x12e)](_0x4c44fc=>{if(_0x4c44fc>_0x2c5382)_0x2c5382=_0x4c44fc;}),_0x334fbc=_0x2c5382>0x0?_0x2c5382:0x78;}else _0x334fbc=_0x522c5c[_0xc1665a]||0x3c;const _0x12ac1b=new Date(_0x2710c0-_0x334fbc*0xea60);_0x1d18a4[_0x3f8a1b(0x1a1)]({'eventTime':_0x2710c0,'triggerTime':_0x12ac1b[_0x3f8a1b(0x10f)](),'room':_0xc1665a,'minutes':_0x334fbc,'reason':_0x5136c8,'isGlobal':_0x54a1dd});});}}catch(_0x5d065c){}_0x1d18a4[_0x58767b(0xf5)]((_0x27462d,_0x3f88a8)=>_0x27462d[_0x58767b(0x187)]-_0x3f88a8[_0x58767b(0x187)]);const _0xb259e8=_0x1d18a4[_0x58767b(0x104)](0x0,0x5);await _0x4cc0e2[_0x58767b(0x136)](_0x58767b(0xed),{'val':JSON['stringify'](_0xb259e8),'ack':!![]});}async function checkCalendarTriggers(_0x2e0eef){const _0x4dfbbc=a1_0x2cd2d0;if(!_0x2e0eef[_0x4dfbbc(0x13b)][_0x4dfbbc(0x11b)]||!_0x2e0eef['config']['calendarInstance'])return;await updateSchedulePreview(_0x2e0eef);let _0x10e90d={},_0x3dcd3a={};try{const _0x551353=await _0x2e0eef['getStateAsync'](_0x4dfbbc(0x15e));if(_0x551353&&_0x551353['val'])_0x10e90d=JSON[_0x4dfbbc(0xea)](_0x551353['val']);const _0xa9e786=await _0x2e0eef[_0x4dfbbc(0x17f)](_0x4dfbbc(0x115));if(_0xa9e786&&_0xa9e786[_0x4dfbbc(0x186)])_0x3dcd3a=JSON[_0x4dfbbc(0xea)](_0xa9e786[_0x4dfbbc(0x186)]);}catch(_0x51c3dc){}let _0x10513d={'default':0x15};try{const _0x8e9d30=await _0x2e0eef[_0x4dfbbc(0x17f)](_0x4dfbbc(0x132));if(_0x8e9d30&&_0x8e9d30['val'])_0x10513d=JSON[_0x4dfbbc(0xea)](_0x8e9d30[_0x4dfbbc(0x186)]);}catch(_0x2f40df){}try{const _0x248f7b=await _0x2e0eef[_0x4dfbbc(0x17e)](_0x2e0eef[_0x4dfbbc(0x13b)][_0x4dfbbc(0x16b)]+'.data.table');if(!_0x248f7b||!_0x248f7b[_0x4dfbbc(0x186)])return;const _0x33f910=JSON['parse'](_0x248f7b[_0x4dfbbc(0x186)]),_0x638e99=Date[_0x4dfbbc(0x194)](),_0x3b4025=_0x2e0eef['config'][_0x4dfbbc(0xff)]||[],_0x21f5af=_0x2e0eef['config'][_0x4dfbbc(0x116)]||[];for(const _0x559cfe of _0x33f910){if(_0x559cfe[_0x4dfbbc(0x191)]&&_0x21f5af[_0x4dfbbc(0x12f)]>0x0&&!_0x21f5af['includes'](_0x559cfe[_0x4dfbbc(0x191)]))continue;const _0x2165c7=_0x559cfe[_0x4dfbbc(0x108)]||_0x559cfe[_0x4dfbbc(0x197)]||_0x559cfe[_0x4dfbbc(0x126)];if(!_0x2165c7)continue;const _0x198de5=new Date(_0x2165c7);if(isNaN(_0x198de5[_0x4dfbbc(0x10f)]()))continue;const _0x419fc8=(_0x559cfe[_0x4dfbbc(0x19f)]||_0x559cfe['summary']||'')['toLowerCase']();if(_0x419fc8['includes']('urlaub\x20ende')||_0x419fc8['includes'](_0x4dfbbc(0x193))||_0x419fc8[_0x4dfbbc(0x19e)]('ankunft')){let _0x1aa2b4=0x0;Object['values'](_0x10e90d)[_0x4dfbbc(0x12e)](_0x813e64=>{if(_0x813e64>_0x1aa2b4)_0x1aa2b4=_0x813e64;});if(_0x1aa2b4===0x0)_0x1aa2b4=0x78;const _0x57645f=_0x198de5[_0x4dfbbc(0x10f)]()-_0x1aa2b4*0xea60;_0x638e99>=_0x57645f&&_0x638e99<_0x198de5[_0x4dfbbc(0x10f)]()&&(_0x2e0eef[_0x4dfbbc(0x110)]!==_0x4dfbbc(0x15f)&&(_0x2e0eef[_0x4dfbbc(0x100)][_0x4dfbbc(0x184)](_0x4dfbbc(0x19c)+_0x1aa2b4+_0x4dfbbc(0x14a)),await _0x2e0eef[_0x4dfbbc(0x136)](_0x4dfbbc(0x178),{'val':'normal','ack':![]})));}for(const _0x205440 of _0x3b4025){if(_0x205440['location']){const _0xe47816=_0x205440['location']['toLowerCase']();if(_0x419fc8[_0x4dfbbc(0x19e)](_0xe47816)){const _0x5091a4=_0x10e90d[_0x205440[_0x4dfbbc(0x192)]]||0x3c,_0xc9ce4=_0x3dcd3a[_0x205440[_0x4dfbbc(0x192)]]||_0x4dfbbc(0x167),_0x38d17d=_0x198de5[_0x4dfbbc(0x10f)]()-_0x5091a4*0xea60;if(_0x638e99>=_0x38d17d&&_0x638e99<_0x198de5[_0x4dfbbc(0x10f)]()){const _0x379921=lastActions['cal_'+_0x205440[_0x4dfbbc(0x192)]];if(_0x379921&&_0x638e99-_0x379921<CAL_COOLDOWN_MS)continue;const _0x530e0b=await findRelatedId(_0x2e0eef,_0x205440['id'],_0x4dfbbc(0x120));if(_0x530e0b){let _0x50a1c6=_0x10513d[_0x205440[_0x4dfbbc(0x192)]];if(_0x50a1c6===undefined)_0x50a1c6=_0x10513d['default'];if(_0x50a1c6===undefined)_0x50a1c6=0x15;const _0x2e9513=await _0x2e0eef[_0x4dfbbc(0x17e)](_0x530e0b);_0x2e9513&&typeof _0x2e9513[_0x4dfbbc(0x186)]===_0x4dfbbc(0x18e)&&_0x2e9513[_0x4dfbbc(0x186)]<_0x50a1c6-0.5&&(_0x2e0eef[_0x4dfbbc(0x100)][_0x4dfbbc(0x184)](_0x4dfbbc(0x181)+_0xc9ce4+_0x4dfbbc(0x135)+_0x205440[_0x4dfbbc(0x192)]+_0x4dfbbc(0x12d)+_0x50a1c6+_0x4dfbbc(0x139)+_0x5091a4+_0x4dfbbc(0x14a)),await _0x2e0eef['setForeignStateAsync'](_0x530e0b,_0x50a1c6),await logAutomationAction(_0x2e0eef,_0x4dfbbc(0x103)+_0x205440[_0x4dfbbc(0x192)]+_0x4dfbbc(0x141)+_0x50a1c6+'Â°C\x20(via\x20'+_0xc9ce4+')'),lastActions[_0x4dfbbc(0x189)+_0x205440['location']]=_0x638e99);}}}}}}}catch(_0x556911){_0x2e0eef[_0x4dfbbc(0x100)][_0x4dfbbc(0x154)](_0x4dfbbc(0x17c)+_0x556911[_0x4dfbbc(0x157)]);}}function a1_0xd92a(_0x43944f,_0x4c83ca){const _0xb2ac2e=a1_0x3f44();return a1_0xd92a=function(_0x118abf,_0x4cc0c3){_0x118abf=_0x118abf-0xe9;let _0x3f442d=_0xb2ac2e[_0x118abf];return _0x3f442d;},a1_0xd92a(_0x43944f,_0x4c83ca);}async function manageMpcIntervention(_0x3f503b,_0x24397e,_0x1fd645){const _0x55ae6e=a1_0x2cd2d0;try{const _0x484ba6=_0x55ae6e(0x169),_0x4acd06=await _0x3f503b['getStateAsync'](_0x484ba6);let _0x41fc6e=[];if(_0x4acd06&&_0x4acd06[_0x55ae6e(0x186)])try{_0x41fc6e=JSON[_0x55ae6e(0xea)](_0x4acd06['val']);}catch(_0x37e3a3){}const _0x241e57=_0x41fc6e[_0x55ae6e(0x16a)](_0x24397e);if(_0x1fd645==='add')_0x241e57===-0x1&&(_0x41fc6e['push'](_0x24397e),await _0x3f503b['setStateAsync'](_0x484ba6,{'val':JSON[_0x55ae6e(0x1a0)](_0x41fc6e),'ack':!![]}));else _0x1fd645===_0x55ae6e(0x175)&&(_0x241e57!==-0x1&&(_0x41fc6e['splice'](_0x241e57,0x1),await _0x3f503b[_0x55ae6e(0x136)](_0x484ba6,{'val':JSON[_0x55ae6e(0x1a0)](_0x41fc6e),'ack':!![]})));}catch(_0xb70faf){}}async function cleanupGhostInterventions(_0x1b3860){const _0x46e2be=a1_0x2cd2d0;try{const _0x3c7090=_0x46e2be(0x169),_0x2deedd=await _0x1b3860[_0x46e2be(0x17f)](_0x3c7090);if(!_0x2deedd||!_0x2deedd[_0x46e2be(0x186)])return;const _0x18b3ce=JSON[_0x46e2be(0xea)](_0x2deedd[_0x46e2be(0x186)]);if(!Array[_0x46e2be(0x124)](_0x18b3ce)||_0x18b3ce[_0x46e2be(0x12f)]===0x0)return;let _0x30b2cf={'default':0x15};try{const _0x1db06c=await _0x1b3860[_0x46e2be(0x17f)](_0x46e2be(0x132));if(_0x1db06c&&_0x1db06c['val'])_0x30b2cf=JSON[_0x46e2be(0xea)](_0x1db06c['val']);}catch(_0x1fa603){}let _0x642838=[];try{const _0x1aea7e=await _0x1b3860['getStateAsync'](_0x46e2be(0x164));if(_0x1aea7e&&_0x1aea7e[_0x46e2be(0x186)])_0x642838=JSON['parse'](_0x1aea7e[_0x46e2be(0x186)]);}catch(_0x4f12fa){}const _0x79d571=_0x1b3860['config'][_0x46e2be(0xff)]||[];let _0x1d9e3e=![];for(let _0x82900f=_0x18b3ce[_0x46e2be(0x12f)]-0x1;_0x82900f>=0x0;_0x82900f--){const _0xd13f7=_0x18b3ce[_0x82900f],_0x1b5275=_0x79d571[_0x46e2be(0x19b)](_0x4b3aa0=>normalize(_0x4b3aa0[_0x46e2be(0x192)])===normalize(_0xd13f7)&&(_0x4b3aa0[_0x46e2be(0x171)]==='temperature'||_0x4b3aa0[_0x46e2be(0x171)]===_0x46e2be(0x18b)));if(!_0x1b5275){_0x1b3860['log']['warn'](_0x46e2be(0x145)+_0xd13f7+_0x46e2be(0x11d)),_0x18b3ce['splice'](_0x82900f,0x1),_0x1d9e3e=!![];continue;}if(_0x1b5275){const _0x38d5e4=await findRelatedId(_0x1b3860,_0x1b5275['id'],_0x46e2be(0x120)),_0x5874e4=await _0x1b3860[_0x46e2be(0x17e)](_0x1b5275['id']);if(_0x38d5e4){const _0x56d90b=await _0x1b3860['getForeignStateAsync'](_0x38d5e4);if(_0x56d90b&&typeof _0x56d90b[_0x46e2be(0x186)]===_0x46e2be(0x18e)){let _0x11adb5=![],_0x16dde1='';Math[_0x46e2be(0x17b)](_0x56d90b[_0x46e2be(0x186)]-ECO_TEMP)>0.5&&(_0x11adb5=!![],_0x16dde1='manual');if(!_0x11adb5&&_0x5874e4&&typeof _0x5874e4[_0x46e2be(0x186)]===_0x46e2be(0x18e)){const _0x491e32=_0x30b2cf[_0xd13f7]||_0x30b2cf[_0x46e2be(0x1a2)]||0x15;_0x5874e4[_0x46e2be(0x186)]<_0x491e32+0.2&&(_0x11adb5=!![],_0x16dde1=_0x46e2be(0x16e));}if(_0x11adb5){if(_0x16dde1===_0x46e2be(0xf9)){_0x1b3860[_0x46e2be(0x100)][_0x46e2be(0x184)](_0x46e2be(0x125)+_0xd13f7+_0x46e2be(0x117)+_0x56d90b['val']+_0x46e2be(0xec)+ECO_TEMP+_0x46e2be(0x137));const _0x457e9f=lastActions[_0x46e2be(0x189)+_0xd13f7],_0x195f58=_0x457e9f&&Date[_0x46e2be(0x194)]()-_0x457e9f<0x2*0x3c*0x3e8;if(!_0x195f58&&_0x56d90b[_0x46e2be(0x186)]>ECO_TEMP+0.5)_0x1b3860['sendToPythonWrapper']&&(_0x1b3860['log'][_0x46e2be(0x184)](_0x46e2be(0x161)+_0xd13f7+_0x46e2be(0xf6)),_0x1b3860[_0x46e2be(0x118)](_0x46e2be(0x188),{'room':_0xd13f7}));else _0x195f58&&_0x1b3860['log'][_0x46e2be(0x184)](_0x46e2be(0x138)+_0xd13f7+'\x20durch\x20Kalender\x20geÃ¤ndert.\x20Keine\x20RL-Strafe.');}else{if(_0x16dde1===_0x46e2be(0x16e)){let _0x322b92=![];if(_0x642838[_0x46e2be(0x19b)](_0x318058=>_0x318058[_0x46e2be(0x134)]===_0xd13f7))_0x322b92=!![];const _0x235faa=_0x79d571[_0x46e2be(0xf4)](_0x2200d0=>normalize(_0x2200d0['location'])===normalize(_0xd13f7)&&(_0x2200d0['type']===_0x46e2be(0x16f)||_0x2200d0[_0x46e2be(0x171)]===_0x46e2be(0xf0)||_0x2200d0['type']===_0x46e2be(0x12b)));for(const _0x54a84f of _0x235faa){try{const _0x3e1081=await _0x1b3860['getForeignStateAsync'](_0x54a84f['id']);if(_0x3e1081&&(_0x3e1081[_0x46e2be(0x186)]===!![]||_0x3e1081[_0x46e2be(0x186)]===0x1||String(_0x3e1081[_0x46e2be(0x186)])[_0x46e2be(0x130)]()===_0x46e2be(0x11e)))_0x322b92=!![];}catch(_0x5a6cd9){}}if(_0x322b92)_0x1b3860['log'][_0x46e2be(0x184)](_0x46e2be(0x122)+_0xd13f7+_0x46e2be(0x14f));else{const _0x546aa5=_0x30b2cf[_0xd13f7]||_0x30b2cf[_0x46e2be(0x1a2)]||0x15;_0x1b3860[_0x46e2be(0x100)][_0x46e2be(0x184)](_0x46e2be(0x174)+_0xd13f7+_0x46e2be(0x179)+_0x5874e4[_0x46e2be(0x186)]+'Â°C\x20<\x20'+(_0x546aa5+0.2)+'Â°C).\x20Sparmodus\x20beendet!'),await _0x1b3860['setForeignStateAsync'](_0x38d5e4,_0x546aa5),await logAutomationAction(_0x1b3860,_0x46e2be(0xfd)+_0xd13f7+':\x20Puffer\x20leer\x20->\x20Heizen\x20auf\x20'+_0x546aa5+'Â°C'),lastActions[_0x46e2be(0x14e)+_0xd13f7]=Date[_0x46e2be(0x194)]();}}}_0x18b3ce[_0x46e2be(0x10e)](_0x82900f,0x1),_0x1d9e3e=!![];}}}}}_0x1d9e3e&&await _0x1b3860[_0x46e2be(0x136)](_0x3c7090,{'val':JSON[_0x46e2be(0x1a0)](_0x18b3ce),'ack':!![]});}catch(_0x425fb1){}}async function applyEnergySavings(_0x1a47c7,_0x50eeef){const _0x43cfd1=a1_0x2cd2d0;await cleanupGhostInterventions(_0x1a47c7);if(!_0x50eeef||_0x50eeef[_0x43cfd1(0x12f)]===0x0)return;const _0xedecce=_0x1a47c7['config'][_0x43cfd1(0xff)]||[],_0x265e81=Date['now']();for(const _0xf2d494 of _0x50eeef){const _0x28d07c=_0xf2d494[_0x43cfd1(0x134)],_0x782184=_0xf2d494[_0x43cfd1(0x10a)],_0x26e403=_0xf2d494['target']||0x15;if(lastActions[_0x43cfd1(0x14e)+_0x28d07c]&&_0x265e81-lastActions[_0x43cfd1(0x14e)+_0x28d07c]<RESCUE_LOCK_MS)continue;const _0x2d77e4=_0xedecce[_0x43cfd1(0x19b)](_0x2a470f=>normalize(_0x2a470f[_0x43cfd1(0x192)])===normalize(_0x28d07c)&&(_0x2a470f['type']===_0x43cfd1(0x13d)||_0x2a470f[_0x43cfd1(0x171)]===_0x43cfd1(0x18b)));if(!_0x2d77e4)continue;const _0x11c854=await findRelatedId(_0x1a47c7,_0x2d77e4['id'],'setpoint');if(_0x11c854){if(lastActions[_0x43cfd1(0x177)+_0x28d07c]&&_0x265e81-lastActions['mpc_'+_0x28d07c]<0x1e*0x3c*0x3e8)continue;const _0x1159e0=await _0x1a47c7[_0x43cfd1(0x17e)](_0x11c854);if(_0x1159e0&&typeof _0x1159e0['val']===_0x43cfd1(0x18e)){const _0xf60f56=_0x1159e0[_0x43cfd1(0x186)];_0xf60f56!==ECO_TEMP&&await manageMpcIntervention(_0x1a47c7,_0x28d07c,_0x43cfd1(0x175));if(_0x782184>0x1e)_0xf60f56>ECO_TEMP+0.5&&(_0x1a47c7[_0x43cfd1(0x100)][_0x43cfd1(0x184)](_0x43cfd1(0x14b)+_0x28d07c+_0x43cfd1(0x18f)+ECO_TEMP+'Â°C!\x20(Puffer:\x20'+_0x782184+_0x43cfd1(0x163)),await _0x1a47c7[_0x43cfd1(0x18c)](_0x11c854,ECO_TEMP),await manageMpcIntervention(_0x1a47c7,_0x28d07c,_0x43cfd1(0x10b)),lastActions['mpc_'+_0x28d07c]=_0x265e81,await logAutomationAction(_0x1a47c7,_0x43cfd1(0x13e)+_0x28d07c+_0x43cfd1(0x127)+ECO_TEMP+'Â°C'));else _0x782184<=0xf&&(_0xf60f56<_0x26e403&&(_0x1a47c7[_0x43cfd1(0x100)][_0x43cfd1(0x184)](_0x43cfd1(0x12a)+_0x28d07c+'\x20wieder\x20auf\x20'+_0x26e403+'Â°C!\x20(Puffer\x20leer).'),await _0x1a47c7['setForeignStateAsync'](_0x11c854,_0x26e403),await manageMpcIntervention(_0x1a47c7,_0x28d07c,_0x43cfd1(0x175)),lastActions['mpc_'+_0x28d07c]=_0x265e81,await logAutomationAction(_0x1a47c7,_0x43cfd1(0x13e)+_0x28d07c+_0x43cfd1(0x140)+_0x26e403+'Â°C')));}}else _0x1a47c7[_0x43cfd1(0x100)][_0x43cfd1(0x154)](_0x43cfd1(0xfc)+_0x28d07c+_0x43cfd1(0x196));}}module[a1_0x2cd2d0(0x190)]={'handlePrediction':handlePrediction,'applyEnergySavings':applyEnergySavings,'scanThermostats':scanThermostats,'checkCalendarTriggers':checkCalendarTriggers,'updateSchedulePreview':updateSchedulePreview,'cleanupGhostInterventions':cleanupGhostInterventions};