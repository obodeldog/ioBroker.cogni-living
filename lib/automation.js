const a1_0x2429a8=a1_0x48c4;(function(_0x226ecb,_0x2fd99e){const _0x219718=a1_0x48c4,_0x5f5fb5=_0x226ecb();while(!![]){try{const _0x3f7859=-parseInt(_0x219718(0xd0))/0x1*(parseInt(_0x219718(0xb1))/0x2)+-parseInt(_0x219718(0x99))/0x3*(-parseInt(_0x219718(0xf2))/0x4)+-parseInt(_0x219718(0xe9))/0x5*(parseInt(_0x219718(0x109))/0x6)+-parseInt(_0x219718(0xf8))/0x7+-parseInt(_0x219718(0x117))/0x8+parseInt(_0x219718(0xe8))/0x9+parseInt(_0x219718(0x140))/0xa*(parseInt(_0x219718(0x12d))/0xb);if(_0x3f7859===_0x2fd99e)break;else _0x5f5fb5['push'](_0x5f5fb5['shift']());}catch(_0x2752cf){_0x5f5fb5['push'](_0x5f5fb5['shift']());}}}(a1_0xfcc3,0x6d63f));const a1_0x252651=(function(){let _0x21fefb=!![];return function(_0x438754,_0x40e032){const _0x426a4a=_0x21fefb?function(){if(_0x40e032){const _0x4e64bb=_0x40e032['apply'](_0x438754,arguments);return _0x40e032=null,_0x4e64bb;}}:function(){};return _0x21fefb=![],_0x426a4a;};}()),a1_0x46a630=a1_0x252651(this,function(){const _0x20de99=a1_0x48c4;return a1_0x46a630['toString']()[_0x20de99(0xb6)](_0x20de99(0x13c))[_0x20de99(0xd4)]()[_0x20de99(0xea)](a1_0x46a630)['search'](_0x20de99(0x13c));});a1_0x46a630();'use strict';const aiAgent=require(a1_0x2429a8(0x110)),COOLDOWN_MS=0x3c*0x3e8,CAL_COOLDOWN_MS=0x5a*0x3c*0x3e8,RESCUE_LOCK_MS=0x78*0x3c*0x3e8,ECO_TEMP=0x11,lastActions={};function normalize(_0x2e3655){const _0x2827b0=a1_0x2429a8;if(!_0x2e3655)return'';return _0x2e3655[_0x2827b0(0xee)]()[_0x2827b0(0x12b)](/\s+/g,'')['trim']();}function a1_0x48c4(_0x578c1d,_0x4414ae){const _0xeaaa72=a1_0xfcc3();return a1_0x48c4=function(_0x46a630,_0x252651){_0x46a630=_0x46a630-0x8e;let _0xfcc331=_0xeaaa72[_0x46a630];return _0xfcc331;},a1_0x48c4(_0x578c1d,_0x4414ae);}async function logAutomationAction(_0xf423a,_0x3d335c){const _0x472bfb=a1_0x2429a8;await _0xf423a[_0x472bfb(0x11c)]('analysis.automation.lastAction',{'val':_0x3d335c,'ack':!![]});try{const _0x24e87f=_0x472bfb(0x139),_0x3eab58=await _0xf423a[_0x472bfb(0x126)](_0x24e87f);let _0x164f79=[];if(_0x3eab58&&_0x3eab58[_0x472bfb(0xef)])try{_0x164f79=JSON['parse'](_0x3eab58[_0x472bfb(0xef)]);}catch(_0x21b78b){}_0x164f79['unshift']({'ts':Date[_0x472bfb(0x10f)](),'msg':_0x3d335c});if(_0x164f79[_0x472bfb(0x141)]>0x32)_0x164f79=_0x164f79['slice'](0x0,0x32);await _0xf423a[_0x472bfb(0x11c)](_0x24e87f,{'val':JSON['stringify'](_0x164f79),'ack':!![]});}catch(_0x2894c1){}}async function handlePrediction(_0x99f4fb,_0x147462,_0x5082e9){const _0x4c38e3=a1_0x2429a8;if(!_0x147462||_0x147462===_0x4c38e3(0xd5))return;let _0x35b048='off',_0x173838=0.6;try{const _0x5839ea=await _0x99f4fb['getStateAsync']('analysis.automation.mode');if(_0x5839ea&&_0x5839ea[_0x4c38e3(0xef)])_0x35b048=_0x5839ea[_0x4c38e3(0xef)];const _0x53c1bf=await _0x99f4fb[_0x4c38e3(0x126)](_0x4c38e3(0xe1));if(_0x53c1bf&&_0x53c1bf[_0x4c38e3(0xef)])_0x173838=_0x53c1bf[_0x4c38e3(0xef)];}catch(_0x329ff1){}if(_0x35b048===_0x4c38e3(0xd3)||_0x5082e9<_0x173838)return;const _0x43ea79=Date[_0x4c38e3(0x10f)]();if(lastActions[_0x147462]&&_0x43ea79-lastActions[_0x147462]<COOLDOWN_MS)return;const _0x1d2c3b=_0x99f4fb[_0x4c38e3(0x9f)]['devices']||[],_0x18b9f8=normalize(_0x147462),_0x310d99=_0x1d2c3b[_0x4c38e3(0x10b)](_0x2c522c=>normalize(_0x2c522c[_0x4c38e3(0xa1)])===_0x18b9f8&&(_0x2c522c[_0x4c38e3(0x107)]===_0x4c38e3(0xfe)||_0x2c522c[_0x4c38e3(0x107)]===_0x4c38e3(0xfb)||_0x2c522c['type']===_0x4c38e3(0xd8)));if(!_0x310d99)return;const _0x2e30d3=await aiAgent[_0x4c38e3(0x8f)](_0x99f4fb,_0x147462,_0x310d99[_0x4c38e3(0x97)],_0x5082e9);if(!_0x2e30d3[_0x4c38e3(0x102)])return;const _0x10aa1e=_0x4c38e3(0xc5)+_0x147462+_0x4c38e3(0xbb)+_0x310d99[_0x4c38e3(0x97)]+'\x20('+_0x2e30d3[_0x4c38e3(0xcf)]+')';await logAutomationAction(_0x99f4fb,'['+_0x35b048[_0x4c38e3(0xa0)]()+']\x20'+_0x10aa1e);if(_0x35b048===_0x4c38e3(0xf0)){const _0x1d6012=await _0x99f4fb[_0x4c38e3(0x135)](_0x310d99['id']);(!_0x1d6012||!_0x1d6012[_0x4c38e3(0xef)]&&_0x1d6012[_0x4c38e3(0xef)]!==!![])&&await _0x99f4fb[_0x4c38e3(0x124)](_0x310d99['id'],!![]),lastActions[_0x147462]=_0x43ea79;}}async function findRelatedId(_0x2d4a87,_0x17d2fa,_0x2c29dd=a1_0x2429a8(0x118)){const _0x451ffc=a1_0x2429a8;if(_0x2c29dd===_0x451ffc(0x118)&&_0x2d4a87[_0x451ffc(0x9f)]['thermostatMapping']){let _0x3e826d=_0x2d4a87[_0x451ffc(0x9f)][_0x451ffc(0x125)];if(typeof _0x3e826d===_0x451ffc(0x132))try{_0x3e826d=JSON[_0x451ffc(0xb0)](_0x3e826d);}catch(_0x5a27f0){}if(_0x3e826d&&_0x3e826d[_0x17d2fa])return _0x3e826d[_0x17d2fa];}if(_0x2c29dd===_0x451ffc(0xab)&&_0x2d4a87[_0x451ffc(0x9f)]['valveMapping']){let _0x151bce=_0x2d4a87[_0x451ffc(0x9f)]['valveMapping'];if(typeof _0x151bce===_0x451ffc(0x132))try{_0x151bce=JSON[_0x451ffc(0xb0)](_0x151bce);}catch(_0x26ea27){}if(_0x151bce&&_0x151bce[_0x17d2fa])return _0x151bce[_0x17d2fa];}let _0x48b1da=[];if(_0x2c29dd===_0x451ffc(0x118))_0x48b1da=[{'s':_0x451ffc(0x115),'t':_0x451ffc(0x94)},{'s':_0x451ffc(0xbd),'t':_0x451ffc(0x94)},{'s':'.1.TEMPERATURE','t':_0x451ffc(0x9c)},{'s':_0x451ffc(0xb3),'t':_0x451ffc(0xe2)},{'s':_0x451ffc(0x127),'t':_0x451ffc(0xdd)},{'s':_0x451ffc(0x127),'t':_0x451ffc(0x9a)},{'s':_0x451ffc(0xdf),'t':_0x451ffc(0xf6)},{'s':_0x451ffc(0x10a),'t':'SET'},{'s':_0x451ffc(0x91),'t':'Soll'},{'s':_0x451ffc(0xdf),'t':_0x451ffc(0x118)}];else _0x2c29dd===_0x451ffc(0xab)&&(_0x48b1da=[{'s':_0x451ffc(0x115),'t':_0x451ffc(0xd1)},{'s':'.1.TEMPERATURE','t':_0x451ffc(0xd1)},{'s':_0x451ffc(0xbd),'t':_0x451ffc(0x106)},{'s':_0x451ffc(0x127),'t':_0x451ffc(0x114)},{'s':'temperature','t':_0x451ffc(0x104)},{'s':_0x451ffc(0xdf),'t':_0x451ffc(0x130)}]);for(const _0x3d0a2c of _0x48b1da){if(_0x17d2fa['includes'](_0x3d0a2c['s'])){const _0x58abb4=_0x17d2fa[_0x451ffc(0x12b)](_0x3d0a2c['s'],_0x3d0a2c['t']),_0x2207a7=await _0x2d4a87[_0x451ffc(0xd7)](_0x58abb4);if(_0x2207a7)return _0x58abb4;}}try{const _0x2026ca=_0x17d2fa[_0x451ffc(0x116)]('.');if(_0x2026ca['length']>0x2){const _0x1f8013=_0x2026ca[_0x451ffc(0xeb)](0x0,-0x1)[_0x451ffc(0x10c)]('.'),_0x29d612=await _0x2d4a87['getForeignObjectsAsync'](_0x1f8013+'.*'),_0x358742=[],_0x314309=_0x17d2fa[_0x451ffc(0x116)](/[._]+/)[_0x451ffc(0xa2)](_0x7d342b=>![_0x451ffc(0xe4),'0','hm-rpc',_0x451ffc(0xc1),'wert',_0x451ffc(0xdf),_0x451ffc(0xdb),'sensor','messwert',_0x451ffc(0xc4)][_0x451ffc(0xcb)](_0x7d342b[_0x451ffc(0xee)]()));for(const [_0x5bcb8a,_0x8c12da]of Object[_0x451ffc(0xaf)](_0x29d612)){if(_0x5bcb8a===_0x17d2fa)continue;if(_0x8c12da&&_0x8c12da[_0x451ffc(0x131)]){const _0x3154ff=_0x5bcb8a[_0x451ffc(0xee)](),_0x1bb2db=(_0x8c12da['common'][_0x451ffc(0xf3)]||'')[_0x451ffc(0xee)](),_0x259171=(_0x8c12da[_0x451ffc(0x131)]['unit']||'')[_0x451ffc(0xee)]();let _0x32421e=![];if(_0x2c29dd==='setpoint'&&_0x8c12da['common'][_0x451ffc(0x12e)]===!![])_0x32421e=_0x3154ff[_0x451ffc(0xcb)]('set')||_0x3154ff[_0x451ffc(0xcb)](_0x451ffc(0x111))||_0x3154ff['includes'](_0x451ffc(0xf4))||_0x1bb2db[_0x451ffc(0xcb)]('level.temperature')||_0x1bb2db[_0x451ffc(0xcb)](_0x451ffc(0x9d));else _0x2c29dd==='valve'&&(_0x32421e=_0x3154ff[_0x451ffc(0xcb)]('level')||_0x3154ff['includes'](_0x451ffc(0xab))||_0x3154ff[_0x451ffc(0xcb)](_0x451ffc(0x120))||_0x3154ff[_0x451ffc(0xcb)](_0x451ffc(0xd2))||_0x1bb2db[_0x451ffc(0xcb)]('level.valve')||_0x1bb2db['includes'](_0x451ffc(0xed))||_0x259171[_0x451ffc(0xcb)]('%'));if(_0x32421e){const _0xf886ab=_0x5bcb8a[_0x451ffc(0x116)](/[._]+/)[_0x451ffc(0x136)](_0x465f0d=>_0x465f0d[_0x451ffc(0xee)]());let _0x5d6d63=0x0;_0x314309['forEach'](_0xe29eef=>{const _0x30d6e7=_0x451ffc;if(_0xf886ab[_0x30d6e7(0xcb)](_0xe29eef[_0x30d6e7(0xee)]()))_0x5d6d63++;}),_0x358742[_0x451ffc(0xa8)]({'id':_0x5bcb8a,'score':_0x5d6d63});}}}if(_0x358742[_0x451ffc(0x141)]>0x0){_0x358742['sort']((_0x41c590,_0x1d8257)=>_0x1d8257['score']-_0x41c590['score']);if(_0x358742[0x0][_0x451ffc(0xaa)]>0x0)return _0x358742[0x0]['id'];}}}catch(_0x667b33){}return null;}async function scanThermostats(_0xc2e015){const _0x511aec=a1_0x2429a8,_0x1db8c9=_0xc2e015['config'][_0x511aec(0xff)]||[],_0x50cdc7=[],_0x264f03=_0x1db8c9[_0x511aec(0xa2)](_0x1a48a6=>_0x1a48a6['id']&&_0x1a48a6['id'][_0x511aec(0xcb)]('temperature')||_0x1a48a6['type']&&[_0x511aec(0xdf),_0x511aec(0xa9),_0x511aec(0xb9)]['includes'](_0x1a48a6[_0x511aec(0x107)])||_0x1a48a6[_0x511aec(0x97)]&&_0x1a48a6[_0x511aec(0x97)][_0x511aec(0xee)]()[_0x511aec(0xcb)](_0x511aec(0xbe)));for(const _0x417f85 of _0x264f03){const _0x115602=await findRelatedId(_0xc2e015,_0x417f85['id'],'setpoint'),_0x24da37=await findRelatedId(_0xc2e015,_0x417f85['id'],_0x511aec(0xab));let _0x2493d7=_0x511aec(0x100),_0x190fdc=![],_0x2782a2=_0xc2e015[_0x511aec(0x9f)]['thermostatMapping']||{};if(typeof _0x2782a2===_0x511aec(0x132))try{_0x2782a2=JSON[_0x511aec(0xb0)](_0x2782a2);}catch(_0x3c8ab0){}let _0x361962=_0xc2e015[_0x511aec(0x9f)][_0x511aec(0x9b)]||{};if(typeof _0x361962===_0x511aec(0x132))try{_0x361962=JSON[_0x511aec(0xb0)](_0x361962);}catch(_0x1a7bba){}if(_0x2782a2[_0x417f85['id']]&&_0x2782a2[_0x417f85['id']]===_0x115602||_0x361962[_0x417f85['id']]&&_0x361962[_0x417f85['id']]===_0x24da37)_0x2493d7='Manuelles\x20Mapping',_0x190fdc=!![];else(_0x115602||_0x24da37)&&(_0x2493d7=_0x511aec(0xe7));_0x50cdc7[_0x511aec(0xa8)]({'room':_0x417f85['location']||_0x511aec(0xf7),'sensorId':_0x417f85['id'],'setpointId':_0x115602||'-','valveId':_0x24da37||'-','source':_0x2493d7,'isManual':_0x190fdc,'status':_0x115602&&_0x24da37?_0x511aec(0x123):_0x115602?'OK':_0x511aec(0xf1)});}return _0x50cdc7['sort']((_0x51a35a,_0x576f2d)=>_0x51a35a[_0x511aec(0x138)][_0x511aec(0xb2)](_0x576f2d[_0x511aec(0x138)]));}async function updateSchedulePreview(_0x23b010){const _0x4f8b64=a1_0x2429a8;if(!_0x23b010[_0x4f8b64(0x9f)][_0x4f8b64(0xa7)]||!_0x23b010['config'][_0x4f8b64(0xc8)])return;let _0x5d3298={};try{const _0x1f6130=await _0x23b010[_0x4f8b64(0x126)](_0x4f8b64(0xc2));if(_0x1f6130&&_0x1f6130['val'])_0x5d3298=JSON[_0x4f8b64(0xb0)](_0x1f6130[_0x4f8b64(0xef)]);}catch(_0x2dfeed){}const _0x2de8b0=[],_0x4914fc=Date['now'](),_0x3e0c23=0x30*0x3c*0x3c*0x3e8;try{const _0x5a3e09=await _0x23b010[_0x4f8b64(0x135)](_0x23b010[_0x4f8b64(0x9f)]['calendarInstance']+'.data.table');if(!_0x5a3e09||!_0x5a3e09[_0x4f8b64(0xef)])return;const _0x2dcbe6=JSON[_0x4f8b64(0xb0)](_0x5a3e09[_0x4f8b64(0xef)]),_0x5a945e=_0x23b010[_0x4f8b64(0x9f)]['calendarSelection']||[],_0x473f5f=_0x23b010[_0x4f8b64(0x9f)][_0x4f8b64(0xff)]||[],_0xd2f1cf=new Set();_0x473f5f[_0x4f8b64(0xca)](_0x104658=>{const _0x2fb8b7=_0x4f8b64;if(_0x104658[_0x2fb8b7(0xa1)])_0xd2f1cf['add'](_0x104658[_0x2fb8b7(0xa1)]);});for(const _0x393876 of _0x2dcbe6){if(_0x393876[_0x4f8b64(0xa5)]&&_0x5a945e['length']>0x0&&!_0x5a945e[_0x4f8b64(0xcb)](_0x393876[_0x4f8b64(0xa5)]))continue;const _0x4a91b5=_0x393876[_0x4f8b64(0xb7)]||_0x393876[_0x4f8b64(0x121)]||_0x393876[_0x4f8b64(0x137)];if(!_0x4a91b5)continue;const _0xa63b77=new Date(_0x4a91b5),_0x52ab62=_0xa63b77[_0x4f8b64(0xad)]();if(isNaN(_0x52ab62))continue;if(_0x52ab62<_0x4914fc)continue;if(_0x52ab62>_0x4914fc+_0x3e0c23)continue;const _0x35cac5=(_0x393876['event']||_0x393876[_0x4f8b64(0xe5)]||'')[_0x4f8b64(0xee)]();let _0x19b7a1=![],_0x3a181e=[],_0x50836a=_0x393876[_0x4f8b64(0x98)]||_0x393876['summary']||'Unbekannt';if(_0x35cac5['includes']('urlaub\x20ende')||_0x35cac5[_0x4f8b64(0xcb)](_0x4f8b64(0x128))||_0x35cac5[_0x4f8b64(0xcb)]('ankunft'))_0x19b7a1=!![],_0x3a181e=Array[_0x4f8b64(0x101)](_0xd2f1cf);else for(const _0x4f3b34 of _0xd2f1cf){if(_0x35cac5[_0x4f8b64(0xcb)](_0x4f3b34['toLowerCase']()))_0x3a181e[_0x4f8b64(0xa8)](_0x4f3b34);}_0x3a181e[_0x4f8b64(0x141)]>0x0&&_0x3a181e[_0x4f8b64(0xca)](_0x221f0f=>{const _0x5bfbd9=_0x4f8b64;let _0x2726b5=0x3c;if(_0x19b7a1){let _0x1c1b71=0x0;Object[_0x5bfbd9(0xd6)](_0x5d3298)['forEach'](_0x14b9a7=>{if(_0x14b9a7>_0x1c1b71)_0x1c1b71=_0x14b9a7;}),_0x2726b5=_0x1c1b71>0x0?_0x1c1b71:0x78;}else _0x2726b5=_0x5d3298[_0x221f0f]||0x3c;const _0x6adecc=new Date(_0x52ab62-_0x2726b5*0xea60);_0x2de8b0['push']({'eventTime':_0x52ab62,'triggerTime':_0x6adecc[_0x5bfbd9(0xad)](),'room':_0x221f0f,'minutes':_0x2726b5,'reason':_0x50836a,'isGlobal':_0x19b7a1});});}}catch(_0x249acb){}_0x2de8b0['sort']((_0x1da35a,_0x266978)=>_0x1da35a[_0x4f8b64(0xf9)]-_0x266978[_0x4f8b64(0xf9)]);const _0x2ec01b=_0x2de8b0[_0x4f8b64(0xeb)](0x0,0x5);await _0x23b010[_0x4f8b64(0x11c)](_0x4f8b64(0xb5),{'val':JSON[_0x4f8b64(0xc3)](_0x2ec01b),'ack':!![]});}async function checkCalendarTriggers(_0x3bc8d1){const _0x1bba3d=a1_0x2429a8;if(!_0x3bc8d1[_0x1bba3d(0x9f)][_0x1bba3d(0xa7)]||!_0x3bc8d1['config']['calendarInstance'])return;await updateSchedulePreview(_0x3bc8d1);let _0xcd4603={},_0x241a2c={};try{const _0x96c71=await _0x3bc8d1[_0x1bba3d(0x126)](_0x1bba3d(0xc2));if(_0x96c71&&_0x96c71[_0x1bba3d(0xef)])_0xcd4603=JSON[_0x1bba3d(0xb0)](_0x96c71[_0x1bba3d(0xef)]);const _0x214e61=await _0x3bc8d1[_0x1bba3d(0x126)]('analysis.energy.warmupSources');if(_0x214e61&&_0x214e61[_0x1bba3d(0xef)])_0x241a2c=JSON['parse'](_0x214e61[_0x1bba3d(0xef)]);}catch(_0x423d61){}let _0x3263b5={'default':0x15};try{const _0x34f217=await _0x3bc8d1[_0x1bba3d(0x126)](_0x1bba3d(0xac));if(_0x34f217&&_0x34f217[_0x1bba3d(0xef)])_0x3263b5=JSON[_0x1bba3d(0xb0)](_0x34f217[_0x1bba3d(0xef)]);}catch(_0x523acf){}try{const _0x114b99=await _0x3bc8d1[_0x1bba3d(0x135)](_0x3bc8d1[_0x1bba3d(0x9f)]['calendarInstance']+_0x1bba3d(0xb8));if(!_0x114b99||!_0x114b99['val'])return;const _0xdb24d9=JSON['parse'](_0x114b99['val']),_0x40ce01=Date[_0x1bba3d(0x10f)](),_0x3102ef=_0x3bc8d1[_0x1bba3d(0x9f)][_0x1bba3d(0xff)]||[],_0xbfe4c8=_0x3bc8d1[_0x1bba3d(0x9f)][_0x1bba3d(0xdc)]||[];for(const _0xbddd87 of _0xdb24d9){if(_0xbddd87['_calName']&&_0xbfe4c8[_0x1bba3d(0x141)]>0x0&&!_0xbfe4c8[_0x1bba3d(0xcb)](_0xbddd87[_0x1bba3d(0xa5)]))continue;const _0x57e04f=_0xbddd87['_date']||_0xbddd87[_0x1bba3d(0x121)]||_0xbddd87[_0x1bba3d(0x137)];if(!_0x57e04f)continue;const _0x2eb3f3=new Date(_0x57e04f);if(isNaN(_0x2eb3f3[_0x1bba3d(0xad)]()))continue;const _0xeccfcd=(_0xbddd87[_0x1bba3d(0x98)]||_0xbddd87[_0x1bba3d(0xe5)]||'')[_0x1bba3d(0xee)]();if(_0xeccfcd[_0x1bba3d(0xcb)]('urlaub\x20ende')||_0xeccfcd[_0x1bba3d(0xcb)]('r√ºckkehr')||_0xeccfcd[_0x1bba3d(0xcb)](_0x1bba3d(0x113))){let _0x2f4c23=0x0;Object[_0x1bba3d(0xd6)](_0xcd4603)[_0x1bba3d(0xca)](_0x3a6b7c=>{if(_0x3a6b7c>_0x2f4c23)_0x2f4c23=_0x3a6b7c;});if(_0x2f4c23===0x0)_0x2f4c23=0x78;const _0x175af4=_0x2eb3f3[_0x1bba3d(0xad)]()-_0x2f4c23*0xea60;_0x40ce01>=_0x175af4&&_0x40ce01<_0x2eb3f3[_0x1bba3d(0xad)]()&&(_0x3bc8d1[_0x1bba3d(0x112)]!==_0x1bba3d(0x13b)&&(_0x3bc8d1['log']['info'](_0x1bba3d(0xce)+_0x2f4c23+'\x20min).'),await _0x3bc8d1[_0x1bba3d(0x11c)](_0x1bba3d(0x103),{'val':'normal','ack':![]})));}for(const _0x3a8aa7 of _0x3102ef){if(_0x3a8aa7[_0x1bba3d(0xa1)]){const _0x5e774a=_0x3a8aa7[_0x1bba3d(0xa1)][_0x1bba3d(0xee)]();if(_0xeccfcd[_0x1bba3d(0xcb)](_0x5e774a)){const _0x1cd0fc=_0xcd4603[_0x3a8aa7[_0x1bba3d(0xa1)]]||0x3c,_0x211241=_0x241a2c[_0x3a8aa7[_0x1bba3d(0xa1)]]||_0x1bba3d(0x9e),_0xc8488f=_0x2eb3f3[_0x1bba3d(0xad)]()-_0x1cd0fc*0xea60;if(_0x40ce01>=_0xc8488f&&_0x40ce01<_0x2eb3f3[_0x1bba3d(0xad)]()){const _0x10c0e0=lastActions[_0x1bba3d(0x95)+_0x3a8aa7['location']];if(_0x10c0e0&&_0x40ce01-_0x10c0e0<CAL_COOLDOWN_MS)continue;const _0x1f3d1d=await findRelatedId(_0x3bc8d1,_0x3a8aa7['id'],'setpoint');if(_0x1f3d1d){let _0x2d501e=_0x3263b5[_0x3a8aa7['location']];if(_0x2d501e===undefined)_0x2d501e=_0x3263b5['default'];if(_0x2d501e===undefined)_0x2d501e=0x15;const _0x1ccf15=await _0x3bc8d1['getForeignStateAsync'](_0x1f3d1d);_0x1ccf15&&typeof _0x1ccf15[_0x1bba3d(0xef)]==='number'&&_0x1ccf15[_0x1bba3d(0xef)]<_0x2d501e-0.5&&(_0x3bc8d1[_0x1bba3d(0x11e)][_0x1bba3d(0x11d)](_0x1bba3d(0x93)+_0x211241+_0x1bba3d(0x11a)+_0x3a8aa7[_0x1bba3d(0xa1)]+_0x1bba3d(0x12c)+_0x2d501e+_0x1bba3d(0x12a)+_0x1cd0fc+_0x1bba3d(0x133)),await _0x3bc8d1[_0x1bba3d(0x124)](_0x1f3d1d,_0x2d501e),await logAutomationAction(_0x3bc8d1,'[CAL]\x20'+_0x3a8aa7[_0x1bba3d(0xa1)]+_0x1bba3d(0xae)+_0x2d501e+'¬∞C\x20(via\x20'+_0x211241+')'),lastActions[_0x1bba3d(0x95)+_0x3a8aa7['location']]=_0x40ce01);}}}}}}}catch(_0x3ca33e){_0x3bc8d1[_0x1bba3d(0x11e)][_0x1bba3d(0x13d)](_0x1bba3d(0xa6)+_0x3ca33e['message']);}}async function manageMpcIntervention(_0x41b1da,_0x2ce858,_0x5b69e5){const _0x35b2d6=a1_0x2429a8;try{const _0x4d8572=_0x35b2d6(0x11b),_0x5c49d3=await _0x41b1da[_0x35b2d6(0x126)](_0x4d8572);let _0x2f8d3f=[];if(_0x5c49d3&&_0x5c49d3[_0x35b2d6(0xef)])try{_0x2f8d3f=JSON[_0x35b2d6(0xb0)](_0x5c49d3[_0x35b2d6(0xef)]);}catch(_0x2adf35){}const _0x4bb82e=_0x2f8d3f[_0x35b2d6(0xc9)](_0x2ce858);if(_0x5b69e5===_0x35b2d6(0xda))_0x4bb82e===-0x1&&(_0x2f8d3f['push'](_0x2ce858),await _0x41b1da[_0x35b2d6(0x11c)](_0x4d8572,{'val':JSON[_0x35b2d6(0xc3)](_0x2f8d3f),'ack':!![]}));else _0x5b69e5==='remove'&&(_0x4bb82e!==-0x1&&(_0x2f8d3f[_0x35b2d6(0xcc)](_0x4bb82e,0x1),await _0x41b1da[_0x35b2d6(0x11c)](_0x4d8572,{'val':JSON['stringify'](_0x2f8d3f),'ack':!![]})));}catch(_0x41ff8f){}}async function cleanupGhostInterventions(_0x29b5a0){const _0x4982b1=a1_0x2429a8;try{const _0x40502b=_0x4982b1(0x11b),_0x3057c9=await _0x29b5a0[_0x4982b1(0x126)](_0x40502b);if(!_0x3057c9||!_0x3057c9[_0x4982b1(0xef)])return;const _0xeb7cd=JSON[_0x4982b1(0xb0)](_0x3057c9[_0x4982b1(0xef)]);if(!Array[_0x4982b1(0xc0)](_0xeb7cd)||_0xeb7cd[_0x4982b1(0x141)]===0x0)return;let _0x29c7d1={'default':0x15};try{const _0x51ddab=await _0x29b5a0['getStateAsync']('analysis.energy.warmupTargets');if(_0x51ddab&&_0x51ddab[_0x4982b1(0xef)])_0x29c7d1=JSON['parse'](_0x51ddab['val']);}catch(_0x3debce){}let _0x39993b=[];try{const _0x1b897c=await _0x29b5a0[_0x4982b1(0x126)](_0x4982b1(0x13a));if(_0x1b897c&&_0x1b897c[_0x4982b1(0xef)])_0x39993b=JSON[_0x4982b1(0xb0)](_0x1b897c[_0x4982b1(0xef)]);}catch(_0xfd75eb){}const _0x11a9fa=_0x29b5a0[_0x4982b1(0x9f)][_0x4982b1(0xff)]||[];let _0x42c0d7=![];for(let _0x5960a8=_0xeb7cd['length']-0x1;_0x5960a8>=0x0;_0x5960a8--){const _0x4b6329=_0xeb7cd[_0x5960a8],_0x240420=_0x11a9fa[_0x4982b1(0x10b)](_0x33bbb4=>normalize(_0x33bbb4['location'])===normalize(_0x4b6329)&&(_0x33bbb4['type']===_0x4982b1(0xdf)||_0x33bbb4[_0x4982b1(0x107)]===_0x4982b1(0xa9)));if(!_0x240420){_0x29b5a0['log'][_0x4982b1(0x13d)]('üßπ\x20[MPC\x20CLEANUP]\x20Raum\x20\x27'+_0x4b6329+'\x27\x20hat\x20kein\x20Ger√§t\x20mehr.\x20L√∂sche\x20Eintrag.'),_0xeb7cd[_0x4982b1(0xcc)](_0x5960a8,0x1),_0x42c0d7=!![];continue;}if(_0x240420){const _0x711a5d=await findRelatedId(_0x29b5a0,_0x240420['id'],_0x4982b1(0x118)),_0x1703c5=await _0x29b5a0[_0x4982b1(0x135)](_0x240420['id']);if(_0x711a5d){const _0x1fc6c0=await _0x29b5a0[_0x4982b1(0x135)](_0x711a5d);if(_0x1fc6c0&&typeof _0x1fc6c0[_0x4982b1(0xef)]==='number'){let _0x4330bb=![],_0x464343='';Math[_0x4982b1(0x105)](_0x1fc6c0[_0x4982b1(0xef)]-ECO_TEMP)>0.5&&(_0x4330bb=!![],_0x464343=_0x4982b1(0x13e));if(!_0x4330bb&&_0x1703c5&&typeof _0x1703c5['val']===_0x4982b1(0xfd)){const _0x2ec981=_0x29c7d1[_0x4b6329]||_0x29c7d1[_0x4982b1(0x119)]||0x15;_0x1703c5[_0x4982b1(0xef)]<_0x2ec981+0.2&&(_0x4330bb=!![],_0x464343=_0x4982b1(0xb4));}if(_0x4330bb){if(_0x464343===_0x4982b1(0x13e)){_0x29b5a0[_0x4982b1(0x11e)]['info']('üßπ\x20[MPC\x20CLEANUP]\x20'+_0x4b6329+_0x4982b1(0xe3)+_0x1fc6c0[_0x4982b1(0xef)]+_0x4982b1(0x122)+ECO_TEMP+_0x4982b1(0xde));const _0x2aedb9=lastActions[_0x4982b1(0x95)+_0x4b6329],_0x49322c=_0x2aedb9&&Date[_0x4982b1(0x10f)]()-_0x2aedb9<0x2*0x3c*0x3e8;if(!_0x49322c&&_0x1fc6c0[_0x4982b1(0xef)]>ECO_TEMP+0.5)_0x29b5a0[_0x4982b1(0xf5)]&&(_0x29b5a0[_0x4982b1(0x11e)]['info']('üéì\x20[RL-FEEDBACK]\x20Lerne\x20aus\x20Fehler:\x20'+_0x4b6329+_0x4982b1(0x92)),_0x29b5a0[_0x4982b1(0xf5)](_0x4982b1(0xe0),{'room':_0x4b6329}));else _0x49322c&&_0x29b5a0['log'][_0x4982b1(0x11d)](_0x4982b1(0xe6)+_0x4b6329+_0x4982b1(0x12f));}else{if(_0x464343===_0x4982b1(0xb4)){let _0x295aa8=![];if(_0x39993b[_0x4982b1(0x10b)](_0x25abb6=>_0x25abb6[_0x4982b1(0x138)]===_0x4b6329))_0x295aa8=!![];const _0x8d5a59=_0x11a9fa[_0x4982b1(0xa2)](_0x15a93c=>normalize(_0x15a93c[_0x4982b1(0xa1)])===normalize(_0x4b6329)&&(_0x15a93c[_0x4982b1(0x107)]==='window'||_0x15a93c[_0x4982b1(0x107)]==='sensor'||_0x15a93c[_0x4982b1(0x107)]===_0x4982b1(0x10d)));for(const _0x14f0c4 of _0x8d5a59){try{const _0x3e4800=await _0x29b5a0[_0x4982b1(0x135)](_0x14f0c4['id']);if(_0x3e4800&&(_0x3e4800[_0x4982b1(0xef)]===!![]||_0x3e4800[_0x4982b1(0xef)]===0x1||String(_0x3e4800[_0x4982b1(0xef)])[_0x4982b1(0xee)]()===_0x4982b1(0x96)))_0x295aa8=!![];}catch(_0x51f425){}}if(_0x295aa8)_0x29b5a0['log']['info']('üå¨Ô∏è\x20[MPC\x20WATCHDOG]\x20'+_0x4b6329+'\x20ist\x20zu\x20kalt,\x20ABER\x20Fenster\x20offen/L√ºftung\x20erkannt.\x20Heize\x20NICHT,\x20entferne\x20nur\x20Status.');else{const _0x135c1a=_0x29c7d1[_0x4b6329]||_0x29c7d1[_0x4982b1(0x119)]||0x15;_0x29b5a0['log'][_0x4982b1(0x11d)](_0x4982b1(0xfc)+_0x4b6329+_0x4982b1(0xd9)+_0x1703c5[_0x4982b1(0xef)]+_0x4982b1(0xc6)+(_0x135c1a+0.2)+_0x4982b1(0x8e)),await _0x29b5a0[_0x4982b1(0x124)](_0x711a5d,_0x135c1a),await logAutomationAction(_0x29b5a0,_0x4982b1(0xbf)+_0x4b6329+_0x4982b1(0xa3)+_0x135c1a+'¬∞C'),lastActions[_0x4982b1(0x108)+_0x4b6329]=Date[_0x4982b1(0x10f)]();}}}_0xeb7cd[_0x4982b1(0xcc)](_0x5960a8,0x1),_0x42c0d7=!![];}}}}}_0x42c0d7&&await _0x29b5a0[_0x4982b1(0x11c)](_0x40502b,{'val':JSON[_0x4982b1(0xc3)](_0xeb7cd),'ack':!![]});}catch(_0x46545c){}}async function applyEnergySavings(_0x2d47b4,_0x396fd4){const _0x5d8421=a1_0x2429a8;await cleanupGhostInterventions(_0x2d47b4);if(!_0x396fd4||_0x396fd4[_0x5d8421(0x141)]===0x0)return;const _0x42fe53=_0x2d47b4[_0x5d8421(0x9f)][_0x5d8421(0xff)]||[],_0x267310=Date[_0x5d8421(0x10f)]();for(const _0x275970 of _0x396fd4){const _0x21c2c9=_0x275970['room'],_0x594eed=_0x275970['minutes_safe'],_0x3dffc3=_0x275970['target']||0x15;if(lastActions['rescue_'+_0x21c2c9]&&_0x267310-lastActions[_0x5d8421(0x108)+_0x21c2c9]<RESCUE_LOCK_MS)continue;const _0x27fcb3=_0x42fe53[_0x5d8421(0x10b)](_0x52619e=>normalize(_0x52619e['location'])===normalize(_0x21c2c9)&&(_0x52619e[_0x5d8421(0x107)]==='temperature'||_0x52619e[_0x5d8421(0x107)]==='thermostat'));if(!_0x27fcb3)continue;const _0xf83062=await findRelatedId(_0x2d47b4,_0x27fcb3['id'],_0x5d8421(0x118));if(_0xf83062){if(lastActions[_0x5d8421(0x90)+_0x21c2c9]&&_0x267310-lastActions[_0x5d8421(0x90)+_0x21c2c9]<0x1e*0x3c*0x3e8)continue;const _0x1cf567=await _0x2d47b4[_0x5d8421(0x135)](_0xf83062);if(_0x1cf567&&typeof _0x1cf567[_0x5d8421(0xef)]==='number'){const _0x4a61b7=_0x1cf567['val'];_0x4a61b7!==ECO_TEMP&&await manageMpcIntervention(_0x2d47b4,_0x21c2c9,_0x5d8421(0xcd));if(_0x594eed>0x1e)_0x4a61b7>ECO_TEMP+0.5&&(_0x2d47b4[_0x5d8421(0x11e)][_0x5d8421(0x11d)](_0x5d8421(0xba)+_0x21c2c9+_0x5d8421(0xec)+ECO_TEMP+_0x5d8421(0xc7)+_0x594eed+_0x5d8421(0xfa)),await _0x2d47b4['setForeignStateAsync'](_0xf83062,ECO_TEMP),await manageMpcIntervention(_0x2d47b4,_0x21c2c9,'add'),lastActions[_0x5d8421(0x90)+_0x21c2c9]=_0x267310,await logAutomationAction(_0x2d47b4,_0x5d8421(0x134)+_0x21c2c9+_0x5d8421(0xbc)+ECO_TEMP+'¬∞C'));else _0x594eed<=0xf&&(_0x4a61b7<_0x3dffc3&&(_0x2d47b4[_0x5d8421(0x11e)][_0x5d8421(0x11d)](_0x5d8421(0x13f)+_0x21c2c9+_0x5d8421(0x129)+_0x3dffc3+_0x5d8421(0xa4)),await _0x2d47b4[_0x5d8421(0x124)](_0xf83062,_0x3dffc3),await manageMpcIntervention(_0x2d47b4,_0x21c2c9,'remove'),lastActions[_0x5d8421(0x90)+_0x21c2c9]=_0x267310,await logAutomationAction(_0x2d47b4,_0x5d8421(0x134)+_0x21c2c9+_0x5d8421(0x11f)+_0x3dffc3+'¬∞C')));}}else _0x2d47b4[_0x5d8421(0x11e)][_0x5d8421(0x13d)]('[MPC\x20WARNING]\x20Kein\x20Setpoint\x20f√ºr\x20'+_0x21c2c9+_0x5d8421(0x10e));}}function a1_0xfcc3(){const _0x228795=['\x20erreicht\x20Limit\x20(','add','actual','calendarSelection','occupied_heating_setpoint','¬∞C).\x20Entferne\x20Status.','temperature','TRAIN_RL_PENALTY','analysis.automation.confidenceThreshold','SET_POINT_TEMPERATURE','\x20ist\x20auf\x20','openknx','summary','üìÖ\x20[MPC\x20INFO]\x20','Auto-Erkennung','5466843VEgTAG','120llpLIm','constructor','slice','\x20auf\x20','value.valve','toLowerCase','val','active','Fehlt','167860AMeKHs','role','target','sendToPythonWrapper','target_temperature','Unbekannt','4860135WAvPXm','triggerTime','\x20min)','dimmer','üö®\x20[MPC\x20WATCHDOG]\x20','number','light','devices','Nicht\x20gefunden','from','approved','system.mode','valve_position','abs','.4.VALVE_STATE','type','rescue_','92562Tpposi','ACTUAL','find','join','contact','\x20gefunden!','now','./ai_agent','soll','currentSystemMode','ankunft','pi_heating_demand','.1.ACTUAL_TEMPERATURE','split','2705584EeGOUZ','setpoint','default',']:\x20Raum-Trigger\x20\x27','analysis.energy.mpcActiveInterventions','setStateAsync','info','log',':\x20Aufheizen\x20auf\x20','stellwert','eventStart','¬∞C\x20(nicht\x20','PERFECT','setForeignStateAsync','thermostatMapping','getStateAsync','local_temperature','r√ºckkehr','\x20wieder\x20auf\x20','¬∞C\x20(Vorlauf:\x20','replace','\x27\x20aktiv.\x20Heize\x20auf\x20','419947pCPbFy','write','\x20durch\x20Kalender\x20ge√§ndert.\x20Keine\x20RL-Strafe.','level','common','string','\x20min).','[MPC]\x20','getForeignStateAsync','map','date','room','analysis.automation.actionLog','analysis.energy.ventilationAlerts','normal','(((.+)+)+)+$','warn','manual','üî•\x20[MPC\x20ACTION]\x20Heize\x20','300zCkwsz','length','¬∞C).\x20Sparmodus\x20beendet!','consultButler','mpc_','Ist','\x20wurde\x20manuell\x20erh√∂ht.','üìÖ\x20SMART\x20SCHEDULE\x20[','.1.SET_POINT_TEMPERATURE','cal_','open','name','event','63HsRUbg','current_heating_setpoint','valveMapping','.4.SET_TEMPERATURE','thermostat.setpoint','Classic','config','toUpperCase','location','filter',':\x20Puffer\x20leer\x20->\x20Heizen\x20auf\x20','¬∞C!\x20(Puffer\x20leer).','_calName','Calendar\x20Check\x20Error:\x20','useCalendar','push','thermostat','score','valve','analysis.energy.warmupTargets','getTime','\x20->\x20','entries','parse','2696uopBmz','localeCompare','ACTUAL_TEMPERATURE','too_cold','analysis.energy.schedulePreview','search','_date','.data.table','sensor','üçÉ\x20[MPC\x20ACTION]\x20Senke\x20','\x20->\x20Schalte\x20',':\x20Absenkung\x20auf\x20','.1.TEMPERATURE','temp','[WATCHDOG]\x20','isArray','ist','analysis.energy.warmupTimes','stringify','state','Pr√§diktion:\x20','¬∞C\x20<\x20','¬∞C!\x20(Puffer:\x20','calendarInstance','indexOf','forEach','includes','splice','remove','üìÖ\x20SMART\x20SCHEDULE\x20(Phase):\x20\x27Globaler\x20Start\x27\x20erkannt.\x20Heize\x20Haus\x20auf\x20(Vorlauf:\x20','reason','581uqxLmQ','.1.LEVEL','position','off','toString','Unknown','values','getForeignObjectAsync','switch'];a1_0xfcc3=function(){return _0x228795;};return a1_0xfcc3();}module['exports']={'handlePrediction':handlePrediction,'applyEnergySavings':applyEnergySavings,'scanThermostats':scanThermostats,'checkCalendarTriggers':checkCalendarTriggers,'updateSchedulePreview':updateSchedulePreview,'cleanupGhostInterventions':cleanupGhostInterventions};