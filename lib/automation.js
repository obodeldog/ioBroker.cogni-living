const a1_0x28c7e2=a1_0x2780;(function(_0x1dd569,_0x55c844){const _0x24edc6=a1_0x2780,_0x1e3e5f=_0x1dd569();while(!![]){try{const _0x8738c=-parseInt(_0x24edc6(0x132))/0x1+parseInt(_0x24edc6(0x11f))/0x2+parseInt(_0x24edc6(0xc8))/0x3*(-parseInt(_0x24edc6(0x167))/0x4)+-parseInt(_0x24edc6(0x117))/0x5+-parseInt(_0x24edc6(0xf3))/0x6*(parseInt(_0x24edc6(0xf6))/0x7)+-parseInt(_0x24edc6(0xfc))/0x8*(-parseInt(_0x24edc6(0x11c))/0x9)+parseInt(_0x24edc6(0xb8))/0xa;if(_0x8738c===_0x55c844)break;else _0x1e3e5f['push'](_0x1e3e5f['shift']());}catch(_0x46af88){_0x1e3e5f['push'](_0x1e3e5f['shift']());}}}(a1_0x2959,0x75dbc));const a1_0x3134a6=(function(){let _0x3f61cc=!![];return function(_0x1eab51,_0x29e27f){const _0x13c643=_0x3f61cc?function(){const _0x2e8669=a1_0x2780;if(_0x29e27f){const _0x11aa5f=_0x29e27f[_0x2e8669(0x127)](_0x1eab51,arguments);return _0x29e27f=null,_0x11aa5f;}}:function(){};return _0x3f61cc=![],_0x13c643;};}()),a1_0x3c8212=a1_0x3134a6(this,function(){const _0x4a93de=a1_0x2780;return a1_0x3c8212[_0x4a93de(0x179)]()[_0x4a93de(0xc2)](_0x4a93de(0xdc))['toString']()[_0x4a93de(0x128)](a1_0x3c8212)['search']('(((.+)+)+)+$');});a1_0x3c8212();'use strict';const aiAgent=require(a1_0x28c7e2(0xb5)),COOLDOWN_MS=0x3c*0x3e8,CAL_COOLDOWN_MS=0x5a*0x3c*0x3e8,RESCUE_LOCK_MS=0x78*0x3c*0x3e8,ECO_TEMP=0x11,lastActions={};function normalize(_0x48e6b8){const _0x51044b=a1_0x28c7e2;if(!_0x48e6b8)return'';return _0x48e6b8['toLowerCase']()[_0x51044b(0x107)](/\s+/g,'')[_0x51044b(0xc6)]();}function a1_0x2959(){const _0x339f5d=['push','stringify','Unbekannt','\x20min).','splice','mpc_','urlaub\x20ende','indexOf','eventStart','\x20wurde\x20manuell\x20erh√∂ht.','Classic','¬∞C!\x20(Puffer:\x20','default','find','forEach','switch','join','consultButler','score',']:\x20Raum-Trigger\x20\x27','date','üö®\x20[ENFORCEMENT]\x20Hardware-Profil\x20hat\x20','useCalendar','sendToPythonWrapper','until','47692kHtWrK','valveMapping','\x20->\x20','ankunft','.data.table','¬∞C.','event','toLowerCase','üßπ\x20[MPC\x20CLEANUP]\x20','summary','analysis.energy.warmupTargets','Nicht\x20gefunden',')\x20aktiv.\x20Heize\x20auf\x20','off','number','split','Pr√§diktion:\x20','\x20wieder\x20auf\x20','toString','stellwert','¬∞C).\x20Entferne\x20Status.','common','actual','./ai_agent','valve','[WATCHDOG]\x20','18762370VQjqCx','Fehlt','normal','target_temperature',':\x20Aufheizen\x20auf\x20','valve_position','val','analysis.energy.warmupTimes','Enforcement\x20Monitor\x20Error:\x20','state','search','occupied_heating_setpoint','\x20ist\x20auf\x20','r√ºckkehr','trim','\x27\x20hat\x20kein\x20Ger√§t\x20mehr.\x20L√∂sche\x20Eintrag.','237ErelzY','.1.TEMPERATURE','TRAIN_RL_PENALTY','length','temperature','Ist','Calendar\x20Check\x20Error:\x20','manual','contact','_date','filter','current_heating_setpoint','write','ist','¬∞C\x20(Kalender-Schutz)','triggerTime','devices','.1.SET_POINT_TEMPERATURE','wert','reason','(((.+)+)+)+$','sort',':\x20Puffer\x20leer\x20->\x20Heizen\x20auf\x20','getStateAsync','getForeignObjectAsync','üìÖ\x20SMART\x20SCHEDULE\x20[','unshift','[CAL]\x20','calendarSelection','¬∞C).\x20Sparmodus\x20beendet!','isArray','getTime','setForeignStateAsync','config','rescue_','includes','local_temperature','level','[FORCE]\x20','ACTUAL_TEMPERATURE','add','\x20auf\x20','üö®\x20[MPC\x20WATCHDOG]\x20','54DMtmSa','analysis.automation.lastAction','analysis.automation.confidenceThreshold','400323nwERjK','name','dimmer','soll','üìÖ\x20[MPC\x20INFO]\x20','cal_','8GBpXdv','getForeignObjectsAsync','.4.VALVE_STATE','location','\x27\x20(Match:\x20','ACTUAL',':\x20Absenkung\x20auf\x20','currentSystemMode','localeCompare','SET','SET_POINT_TEMPERATURE','replace','üî•\x20[MPC\x20ACTION]\x20Heize\x20','analysis.energy.mpcActiveInterventions','Unknown','entries','active','.1.ACTUAL_TEMPERATURE','\x20min)','message','info','set','open','thermostat','Manuelles\x20Mapping','[MPC\x20WARNING]\x20Kein\x20Setpoint\x20f√ºr\x20','¬∞C\x20<\x20','1667275SYdjpa','_calName','type','thermostatMapping','¬∞C\x20(Vorlauf:\x20','4725603jNwMcv','messwert','room','1102640rSPXkI','map','üßπ\x20[MPC\x20CLEANUP]\x20Raum\x20\x27','\x20ist\x20zu\x20kalt,\x20ABER\x20Fenster\x20offen/L√ºftung\x20erkannt.\x20Heize\x20NICHT,\x20entferne\x20nur\x20Status.','error','minutes_safe','analysis.energy.ventilationAlerts','analysis.automation.mode','apply','constructor','üå¨Ô∏è\x20[MPC\x20WATCHDOG]\x20','analysis.energy.activeEnforcements','üìÖ\x20SMART\x20SCHEDULE\x20(Phase):\x20\x27Globaler\x20Start\x27\x20erkannt.\x20Heize\x20Haus\x20auf\x20(Vorlauf:\x20','¬∞C\x20abgesenkt!\x20Zwinge\x20zur√ºck\x20auf\x20','setStateAsync','target','value.valve','string','warn','679803PeEhAM','setpoint','system.mode','\x20erreicht\x20Limit\x20(','parse','¬∞C\x20(nicht\x20','level.temperature','[MPC]\x20','getForeignStateAsync','log','light','üéì\x20[RL-FEEDBACK]\x20Lerne\x20aus\x20Fehler:\x20','sensor','findIndex','unit','remove','calendarInstance','analysis.energy.schedulePreview','.1.LEVEL','too_cold','slice','values','now','position','¬∞C\x20->\x20','toUpperCase','temp','openknx'];a1_0x2959=function(){return _0x339f5d;};return a1_0x2959();}async function logAutomationAction(_0x17ff4a,_0x426825){const _0x196dd4=a1_0x28c7e2;await _0x17ff4a[_0x196dd4(0x12d)](_0x196dd4(0xf4),{'val':_0x426825,'ack':!![]});try{const _0x470ca3='analysis.automation.actionLog',_0x250421=await _0x17ff4a[_0x196dd4(0xdf)](_0x470ca3);let _0x1f5e65=[];if(_0x250421&&_0x250421['val'])try{_0x1f5e65=JSON[_0x196dd4(0x136)](_0x250421[_0x196dd4(0xbe)]);}catch(_0xb26950){}_0x1f5e65[_0x196dd4(0xe2)]({'ts':Date[_0x196dd4(0x148)](),'msg':_0x426825});if(_0x1f5e65[_0x196dd4(0xcb)]>0x32)_0x1f5e65=_0x1f5e65[_0x196dd4(0x146)](0x0,0x32);await _0x17ff4a[_0x196dd4(0x12d)](_0x470ca3,{'val':JSON[_0x196dd4(0x14f)](_0x1f5e65),'ack':!![]});}catch(_0x225162){}}async function handlePrediction(_0x18d3ac,_0x37bd6e,_0x46c04d){const _0x382b90=a1_0x28c7e2;if(!_0x37bd6e||_0x37bd6e===_0x382b90(0x10a))return;let _0x2b6d01=_0x382b90(0x174),_0x5b3ed2=0.6;try{const _0x45900d=await _0x18d3ac[_0x382b90(0xdf)](_0x382b90(0x126));if(_0x45900d&&_0x45900d['val'])_0x2b6d01=_0x45900d[_0x382b90(0xbe)];const _0x3b6574=await _0x18d3ac[_0x382b90(0xdf)](_0x382b90(0xf5));if(_0x3b6574&&_0x3b6574['val'])_0x5b3ed2=_0x3b6574[_0x382b90(0xbe)];}catch(_0x2c7635){}if(_0x2b6d01===_0x382b90(0x174)||_0x46c04d<_0x5b3ed2)return;const _0x28c10d=Date[_0x382b90(0x148)]();if(lastActions[_0x37bd6e]&&_0x28c10d-lastActions[_0x37bd6e]<COOLDOWN_MS)return;const _0x2bf209=_0x18d3ac[_0x382b90(0xe9)][_0x382b90(0xd8)]||[],_0x472152=normalize(_0x37bd6e),_0x491da4=_0x2bf209['find'](_0x20242f=>normalize(_0x20242f[_0x382b90(0xff)])===_0x472152&&(_0x20242f[_0x382b90(0x119)]===_0x382b90(0x13c)||_0x20242f['type']===_0x382b90(0xf8)||_0x20242f[_0x382b90(0x119)]===_0x382b90(0x15d)));if(!_0x491da4)return;const _0x1ed81d=await aiAgent[_0x382b90(0x15f)](_0x18d3ac,_0x37bd6e,_0x491da4[_0x382b90(0xf7)],_0x46c04d);if(!_0x1ed81d['approved'])return;const _0x420f30=_0x382b90(0x177)+_0x37bd6e+'\x20->\x20Schalte\x20'+_0x491da4[_0x382b90(0xf7)]+'\x20('+_0x1ed81d[_0x382b90(0xdb)]+')';await logAutomationAction(_0x18d3ac,'['+_0x2b6d01[_0x382b90(0x14b)]()+']\x20'+_0x420f30);if(_0x2b6d01===_0x382b90(0x10c)){const _0x1045d9=await _0x18d3ac['getForeignStateAsync'](_0x491da4['id']);(!_0x1045d9||!_0x1045d9['val']&&_0x1045d9[_0x382b90(0xbe)]!==!![])&&await _0x18d3ac[_0x382b90(0xe8)](_0x491da4['id'],!![]),lastActions[_0x37bd6e]=_0x28c10d;}}async function findRelatedId(_0x145cb7,_0x15a657,_0x4f47ec=a1_0x28c7e2(0x133)){const _0x55f058=a1_0x28c7e2;if(_0x4f47ec===_0x55f058(0x133)&&_0x145cb7[_0x55f058(0xe9)][_0x55f058(0x11a)]){let _0xdfbf0a=_0x145cb7['config'][_0x55f058(0x11a)];if(typeof _0xdfbf0a===_0x55f058(0x130))try{_0xdfbf0a=JSON[_0x55f058(0x136)](_0xdfbf0a);}catch(_0x575ec9){}if(_0xdfbf0a&&_0xdfbf0a[_0x15a657])return _0xdfbf0a[_0x15a657];}if(_0x4f47ec==='valve'&&_0x145cb7[_0x55f058(0xe9)][_0x55f058(0x168)]){let _0x21d932=_0x145cb7['config'][_0x55f058(0x168)];if(typeof _0x21d932===_0x55f058(0x130))try{_0x21d932=JSON[_0x55f058(0x136)](_0x21d932);}catch(_0x4f9c53){}if(_0x21d932&&_0x21d932[_0x15a657])return _0x21d932[_0x15a657];}let _0x2316c9=[];if(_0x4f47ec===_0x55f058(0x133))_0x2316c9=[{'s':_0x55f058(0x10d),'t':_0x55f058(0xd9)},{'s':_0x55f058(0xc9),'t':_0x55f058(0xd9)},{'s':_0x55f058(0xc9),'t':'.4.SET_TEMPERATURE'},{'s':_0x55f058(0xef),'t':_0x55f058(0x106)},{'s':_0x55f058(0xec),'t':_0x55f058(0xc3)},{'s':_0x55f058(0xec),'t':_0x55f058(0xd3)},{'s':_0x55f058(0xcc),'t':_0x55f058(0xbb)},{'s':_0x55f058(0x101),'t':_0x55f058(0x105)},{'s':_0x55f058(0xcd),'t':'Soll'},{'s':'temperature','t':'setpoint'}];else _0x4f47ec===_0x55f058(0xb6)&&(_0x2316c9=[{'s':_0x55f058(0x10d),'t':_0x55f058(0x144)},{'s':_0x55f058(0xc9),'t':_0x55f058(0x144)},{'s':_0x55f058(0xc9),'t':_0x55f058(0xfe)},{'s':_0x55f058(0xec),'t':'pi_heating_demand'},{'s':_0x55f058(0xcc),'t':_0x55f058(0xbd)},{'s':_0x55f058(0xcc),'t':_0x55f058(0xed)}]);for(const _0x33c63f of _0x2316c9){if(_0x15a657[_0x55f058(0xeb)](_0x33c63f['s'])){const _0x2dcd54=_0x15a657['replace'](_0x33c63f['s'],_0x33c63f['t']),_0x54193d=await _0x145cb7[_0x55f058(0xe0)](_0x2dcd54);if(_0x54193d)return _0x2dcd54;}}try{const _0x21afed=_0x15a657[_0x55f058(0x176)]('.');if(_0x21afed[_0x55f058(0xcb)]>0x2){const _0x345434=_0x21afed['slice'](0x0,-0x1)[_0x55f058(0x15e)]('.'),_0x520661=await _0x145cb7[_0x55f058(0xfd)](_0x345434+'.*'),_0x45723e=[],_0x3467b2=_0x15a657[_0x55f058(0x176)](/[._]+/)[_0x55f058(0xd2)](_0x42bf75=>![_0x55f058(0x14d),'0','hm-rpc',_0x55f058(0xd5),_0x55f058(0xda),_0x55f058(0xcc),_0x55f058(0xb4),_0x55f058(0x13e),_0x55f058(0x11d),_0x55f058(0xc1)][_0x55f058(0xeb)](_0x42bf75[_0x55f058(0x16e)]()));for(const [_0x2c05e3,_0x563387]of Object[_0x55f058(0x10b)](_0x520661)){if(_0x2c05e3===_0x15a657)continue;if(_0x563387&&_0x563387[_0x55f058(0xb3)]){const _0x383396=_0x2c05e3[_0x55f058(0x16e)](),_0x4e6d19=(_0x563387[_0x55f058(0xb3)]['role']||'')[_0x55f058(0x16e)](),_0x249059=(_0x563387[_0x55f058(0xb3)][_0x55f058(0x140)]||'')['toLowerCase']();let _0x40d795=![];if(_0x4f47ec===_0x55f058(0x133)&&_0x563387[_0x55f058(0xb3)][_0x55f058(0xd4)]===!![])_0x40d795=_0x383396[_0x55f058(0xeb)](_0x55f058(0x111))||_0x383396[_0x55f058(0xeb)](_0x55f058(0xf9))||_0x383396[_0x55f058(0xeb)](_0x55f058(0x12e))||_0x4e6d19[_0x55f058(0xeb)](_0x55f058(0x138))||_0x4e6d19[_0x55f058(0xeb)]('thermostat.setpoint');else _0x4f47ec===_0x55f058(0xb6)&&(_0x40d795=_0x383396[_0x55f058(0xeb)](_0x55f058(0xed))||_0x383396[_0x55f058(0xeb)]('valve')||_0x383396[_0x55f058(0xeb)](_0x55f058(0x17a))||_0x383396[_0x55f058(0xeb)](_0x55f058(0x149))||_0x4e6d19[_0x55f058(0xeb)]('level.valve')||_0x4e6d19['includes'](_0x55f058(0x12f))||_0x249059[_0x55f058(0xeb)]('%'));if(_0x40d795){const _0x1b777e=_0x2c05e3['split'](/[._]+/)[_0x55f058(0x120)](_0x567a44=>_0x567a44['toLowerCase']());let _0x2a29a3=0x0;_0x3467b2[_0x55f058(0x15c)](_0x478bee=>{const _0xcbdabf=_0x55f058;if(_0x1b777e[_0xcbdabf(0xeb)](_0x478bee[_0xcbdabf(0x16e)]()))_0x2a29a3++;}),_0x45723e[_0x55f058(0x14e)]({'id':_0x2c05e3,'score':_0x2a29a3});}}}if(_0x45723e['length']>0x0){_0x45723e[_0x55f058(0xdd)]((_0x1d4be5,_0x233733)=>_0x233733['score']-_0x1d4be5[_0x55f058(0x160)]);if(_0x45723e[0x0]['score']>0x0)return _0x45723e[0x0]['id'];}}}catch(_0xd25cd6){}return null;}async function scanThermostats(_0x3a0516){const _0x336f68=a1_0x28c7e2,_0x2427eb=_0x3a0516[_0x336f68(0xe9)][_0x336f68(0xd8)]||[],_0x59a764=[],_0x279b50=_0x2427eb[_0x336f68(0xd2)](_0x45626b=>_0x45626b['id']&&_0x45626b['id'][_0x336f68(0xeb)](_0x336f68(0xcc))||_0x45626b[_0x336f68(0x119)]&&['temperature',_0x336f68(0x113),'sensor'][_0x336f68(0xeb)](_0x45626b[_0x336f68(0x119)])||_0x45626b[_0x336f68(0xf7)]&&_0x45626b[_0x336f68(0xf7)]['toLowerCase']()['includes'](_0x336f68(0x14c)));for(const _0x75589a of _0x279b50){const _0x4418f8=await findRelatedId(_0x3a0516,_0x75589a['id'],_0x336f68(0x133)),_0x5decbe=await findRelatedId(_0x3a0516,_0x75589a['id'],_0x336f68(0xb6));let _0x3e83d1=_0x336f68(0x172),_0x2096d6=![],_0x40d208=_0x3a0516[_0x336f68(0xe9)][_0x336f68(0x11a)]||{};if(typeof _0x40d208===_0x336f68(0x130))try{_0x40d208=JSON['parse'](_0x40d208);}catch(_0x1272e5){}let _0x469c61=_0x3a0516['config'][_0x336f68(0x168)]||{};if(typeof _0x469c61==='string')try{_0x469c61=JSON[_0x336f68(0x136)](_0x469c61);}catch(_0x3bb971){}if(_0x40d208[_0x75589a['id']]&&_0x40d208[_0x75589a['id']]===_0x4418f8||_0x469c61[_0x75589a['id']]&&_0x469c61[_0x75589a['id']]===_0x5decbe)_0x3e83d1=_0x336f68(0x114),_0x2096d6=!![];else(_0x4418f8||_0x5decbe)&&(_0x3e83d1='Auto-Erkennung');_0x59a764[_0x336f68(0x14e)]({'room':_0x75589a[_0x336f68(0xff)]||'Unbekannt','sensorId':_0x75589a['id'],'setpointId':_0x4418f8||'-','valveId':_0x5decbe||'-','source':_0x3e83d1,'isManual':_0x2096d6,'status':_0x4418f8&&_0x5decbe?'PERFECT':_0x4418f8?'OK':_0x336f68(0xb9)});}return _0x59a764[_0x336f68(0xdd)]((_0x49fcaf,_0x5dfffb)=>_0x49fcaf[_0x336f68(0x11e)][_0x336f68(0x104)](_0x5dfffb[_0x336f68(0x11e)]));}async function updateSchedulePreview(_0x45fb5d){const _0x462acf=a1_0x28c7e2;if(!_0x45fb5d[_0x462acf(0xe9)]['useCalendar']||!_0x45fb5d[_0x462acf(0xe9)][_0x462acf(0x142)])return;let _0x2581be={};try{const _0x42c35a=await _0x45fb5d[_0x462acf(0xdf)]('analysis.energy.warmupTimes');if(_0x42c35a&&_0x42c35a['val'])_0x2581be=JSON[_0x462acf(0x136)](_0x42c35a[_0x462acf(0xbe)]);}catch(_0x48aee2){}const _0x444218=[],_0x971538=Date[_0x462acf(0x148)](),_0x30bc42=0x30*0x3c*0x3c*0x3e8;try{const _0x49ac22=await _0x45fb5d[_0x462acf(0x13a)](_0x45fb5d[_0x462acf(0xe9)]['calendarInstance']+_0x462acf(0x16b));if(!_0x49ac22||!_0x49ac22[_0x462acf(0xbe)])return;const _0x1c203b=JSON['parse'](_0x49ac22[_0x462acf(0xbe)]),_0x267828=_0x45fb5d[_0x462acf(0xe9)][_0x462acf(0xe4)]||[],_0xbdf1b7=_0x45fb5d['config'][_0x462acf(0xd8)]||[],_0x25237c=new Set();_0xbdf1b7[_0x462acf(0x15c)](_0x3fc19e=>{const _0x1a3026=_0x462acf;if(_0x3fc19e['location'])_0x25237c[_0x1a3026(0xf0)](_0x3fc19e['location']);});for(const _0xf1e48d of _0x1c203b){if(_0xf1e48d[_0x462acf(0x118)]&&_0x267828[_0x462acf(0xcb)]>0x0&&!_0x267828[_0x462acf(0xeb)](_0xf1e48d[_0x462acf(0x118)]))continue;const _0xc700aa=_0xf1e48d['_date']||_0xf1e48d[_0x462acf(0x156)]||_0xf1e48d['date'];if(!_0xc700aa)continue;const _0x119659=new Date(_0xc700aa),_0x5535f2=_0x119659[_0x462acf(0xe7)]();if(isNaN(_0x5535f2))continue;if(_0x5535f2<_0x971538)continue;if(_0x5535f2>_0x971538+_0x30bc42)continue;const _0x1cf948=(_0xf1e48d[_0x462acf(0x16d)]||_0xf1e48d[_0x462acf(0x170)]||'')[_0x462acf(0x16e)]();let _0x321259=![],_0x1e239b=[],_0x5e9878=_0xf1e48d[_0x462acf(0x16d)]||_0xf1e48d[_0x462acf(0x170)]||_0x462acf(0x150);if(_0x1cf948[_0x462acf(0xeb)]('urlaub\x20ende')||_0x1cf948[_0x462acf(0xeb)](_0x462acf(0xc5))||_0x1cf948[_0x462acf(0xeb)](_0x462acf(0x16a)))_0x321259=!![],_0x1e239b=Array['from'](_0x25237c);else for(const _0x5352d2 of _0x25237c){if(_0x1cf948[_0x462acf(0xeb)](_0x5352d2[_0x462acf(0x16e)]()))_0x1e239b['push'](_0x5352d2);}_0x1e239b[_0x462acf(0xcb)]>0x0&&_0x1e239b[_0x462acf(0x15c)](_0x1c9065=>{const _0x2f24e6=_0x462acf;let _0xf0202=0x3c;if(_0x321259){let _0x15c366=0x0;Object[_0x2f24e6(0x147)](_0x2581be)[_0x2f24e6(0x15c)](_0x498d1f=>{if(_0x498d1f>_0x15c366)_0x15c366=_0x498d1f;}),_0xf0202=_0x15c366>0x0?_0x15c366:0x78;}else _0xf0202=_0x2581be[_0x1c9065]||0x3c;const _0x582061=new Date(_0x5535f2-_0xf0202*0xea60);_0x444218['push']({'eventTime':_0x5535f2,'triggerTime':_0x582061[_0x2f24e6(0xe7)](),'room':_0x1c9065,'minutes':_0xf0202,'reason':_0x5e9878,'isGlobal':_0x321259});});}}catch(_0x2e9a8f){}_0x444218[_0x462acf(0xdd)]((_0x1b4b97,_0x4c0342)=>_0x1b4b97[_0x462acf(0xd7)]-_0x4c0342[_0x462acf(0xd7)]);const _0x5e90f7=_0x444218[_0x462acf(0x146)](0x0,0x5);await _0x45fb5d[_0x462acf(0x12d)](_0x462acf(0x143),{'val':JSON[_0x462acf(0x14f)](_0x5e90f7),'ack':!![]});}async function monitorEnforcements(_0x1ff1c1){const _0x3cc680=a1_0x28c7e2;try{const _0x4ffd06=_0x3cc680(0x12a),_0x4dd1e6=await _0x1ff1c1[_0x3cc680(0xdf)](_0x4ffd06);if(!_0x4dd1e6||!_0x4dd1e6[_0x3cc680(0xbe)])return;let _0x289506=[];try{_0x289506=JSON['parse'](_0x4dd1e6['val']);}catch(_0x39be99){return;}if(!Array[_0x3cc680(0xe6)](_0x289506)||_0x289506[_0x3cc680(0xcb)]===0x0)return;const _0x2e86cb=Date[_0x3cc680(0x148)](),_0x2bbd87=_0x1ff1c1['config']['devices']||[];let _0x51af37=![];for(let _0x54f48c=_0x289506[_0x3cc680(0xcb)]-0x1;_0x54f48c>=0x0;_0x54f48c--){const _0x2efeac=_0x289506[_0x54f48c];if(_0x2e86cb>=_0x2efeac[_0x3cc680(0x166)]){_0x1ff1c1[_0x3cc680(0x13b)][_0x3cc680(0x110)]('üìÖ\x20[ENFORCEMENT]\x20Kalender-Event\x20in\x20'+_0x2efeac[_0x3cc680(0x11e)]+'\x20gestartet/vorbei.\x20Gebe\x20Raum\x20frei.'),_0x289506[_0x3cc680(0x152)](_0x54f48c,0x1),_0x51af37=!![];continue;}const _0x436a0a=_0x2bbd87[_0x3cc680(0x15b)](_0x123fdd=>normalize(_0x123fdd['location'])===normalize(_0x2efeac[_0x3cc680(0x11e)])&&(_0x123fdd[_0x3cc680(0x119)]===_0x3cc680(0xcc)||_0x123fdd[_0x3cc680(0x119)]===_0x3cc680(0x113)));if(_0x436a0a){const _0x56a881=await findRelatedId(_0x1ff1c1,_0x436a0a['id'],_0x3cc680(0x133));if(_0x56a881){const _0xa95feb=await _0x1ff1c1['getForeignStateAsync'](_0x56a881);_0xa95feb&&typeof _0xa95feb['val']===_0x3cc680(0x175)&&(_0xa95feb[_0x3cc680(0xbe)]<0xf&&(_0x1ff1c1[_0x3cc680(0x13b)][_0x3cc680(0x131)](_0x3cc680(0x163)+_0x2efeac[_0x3cc680(0x11e)]+_0x3cc680(0xf1)+_0xa95feb[_0x3cc680(0xbe)]+_0x3cc680(0x12c)+_0x2efeac['target']+_0x3cc680(0x16c)),await _0x1ff1c1[_0x3cc680(0xe8)](_0x56a881,_0x2efeac[_0x3cc680(0x12e)]),await logAutomationAction(_0x1ff1c1,_0x3cc680(0xee)+_0x2efeac[_0x3cc680(0x11e)]+':\x20'+_0xa95feb[_0x3cc680(0xbe)]+_0x3cc680(0x14a)+_0x2efeac[_0x3cc680(0x12e)]+_0x3cc680(0xd6))));}}}_0x51af37&&await _0x1ff1c1[_0x3cc680(0x12d)](_0x4ffd06,{'val':JSON[_0x3cc680(0x14f)](_0x289506),'ack':!![]});}catch(_0x45362c){_0x1ff1c1[_0x3cc680(0x13b)][_0x3cc680(0x123)](_0x3cc680(0xc0)+_0x45362c[_0x3cc680(0x10f)]);}}async function checkCalendarTriggers(_0x2de045){const _0x3f47bc=a1_0x28c7e2;if(!_0x2de045['config'][_0x3f47bc(0x164)]||!_0x2de045['config'][_0x3f47bc(0x142)])return;await updateSchedulePreview(_0x2de045);let _0x42b7ae={},_0x54d45c={};try{const _0x2a44fb=await _0x2de045[_0x3f47bc(0xdf)](_0x3f47bc(0xbf));if(_0x2a44fb&&_0x2a44fb[_0x3f47bc(0xbe)])_0x42b7ae=JSON[_0x3f47bc(0x136)](_0x2a44fb['val']);const _0x5be941=await _0x2de045['getStateAsync']('analysis.energy.warmupSources');if(_0x5be941&&_0x5be941[_0x3f47bc(0xbe)])_0x54d45c=JSON['parse'](_0x5be941['val']);}catch(_0x4d6aef){}let _0x4b267f={'default':0x15};try{const _0x418af9=await _0x2de045[_0x3f47bc(0xdf)](_0x3f47bc(0x171));if(_0x418af9&&_0x418af9[_0x3f47bc(0xbe)])_0x4b267f=JSON['parse'](_0x418af9[_0x3f47bc(0xbe)]);}catch(_0x3756bb){}let _0x13f9ff=[];try{const _0x6475dd=await _0x2de045[_0x3f47bc(0xdf)]('analysis.energy.activeEnforcements');if(_0x6475dd&&_0x6475dd[_0x3f47bc(0xbe)])_0x13f9ff=JSON[_0x3f47bc(0x136)](_0x6475dd['val']);}catch(_0x165a07){}try{const _0x124122=await _0x2de045['getForeignStateAsync'](_0x2de045[_0x3f47bc(0xe9)][_0x3f47bc(0x142)]+_0x3f47bc(0x16b));if(!_0x124122||!_0x124122[_0x3f47bc(0xbe)])return;const _0x37a439=JSON[_0x3f47bc(0x136)](_0x124122[_0x3f47bc(0xbe)]),_0x4bc7c0=Date[_0x3f47bc(0x148)](),_0x1ba852=_0x2de045[_0x3f47bc(0xe9)][_0x3f47bc(0xd8)]||[],_0x5cba4d=_0x2de045[_0x3f47bc(0xe9)][_0x3f47bc(0xe4)]||[];let _0x546d73=![];for(const _0x3b23a4 of _0x37a439){if(_0x3b23a4[_0x3f47bc(0x118)]&&_0x5cba4d[_0x3f47bc(0xcb)]>0x0&&!_0x5cba4d[_0x3f47bc(0xeb)](_0x3b23a4[_0x3f47bc(0x118)]))continue;const _0xfec1b1=_0x3b23a4[_0x3f47bc(0xd1)]||_0x3b23a4['eventStart']||_0x3b23a4[_0x3f47bc(0x162)];if(!_0xfec1b1)continue;const _0x154b45=new Date(_0xfec1b1);if(isNaN(_0x154b45['getTime']()))continue;const _0xbd9f2b=(_0x3b23a4[_0x3f47bc(0x16d)]||_0x3b23a4[_0x3f47bc(0x170)]||'')[_0x3f47bc(0x16e)]();if(_0xbd9f2b[_0x3f47bc(0xeb)](_0x3f47bc(0x154))||_0xbd9f2b[_0x3f47bc(0xeb)](_0x3f47bc(0xc5))||_0xbd9f2b[_0x3f47bc(0xeb)](_0x3f47bc(0x16a))){let _0x4b8f9d=0x0;Object[_0x3f47bc(0x147)](_0x42b7ae)['forEach'](_0x377c10=>{if(_0x377c10>_0x4b8f9d)_0x4b8f9d=_0x377c10;});if(_0x4b8f9d===0x0)_0x4b8f9d=0x78;const _0x1177f3=_0x154b45[_0x3f47bc(0xe7)]()-_0x4b8f9d*0xea60;_0x4bc7c0>=_0x1177f3&&_0x4bc7c0<_0x154b45[_0x3f47bc(0xe7)]()&&(_0x2de045[_0x3f47bc(0x103)]!==_0x3f47bc(0xba)&&(_0x2de045[_0x3f47bc(0x13b)][_0x3f47bc(0x110)](_0x3f47bc(0x12b)+_0x4b8f9d+_0x3f47bc(0x151)),await _0x2de045[_0x3f47bc(0x12d)](_0x3f47bc(0x134),{'val':_0x3f47bc(0xba),'ack':![]})));}for(const _0x52753c of _0x1ba852){if(_0x52753c[_0x3f47bc(0xff)]){const _0x248968=_0x52753c['location']['toLowerCase'](),_0x51ee54=(_0x52753c[_0x3f47bc(0xf7)]||'')['toLowerCase']();let _0xcd7be9=_0xbd9f2b['includes'](_0x248968);!_0xcd7be9&&_0x51ee54[_0x3f47bc(0xcb)]>0x3&&_0xbd9f2b[_0x3f47bc(0xeb)](_0x51ee54)&&(_0xcd7be9=!![]);if(_0xcd7be9){const _0x9d005=_0x42b7ae[_0x52753c[_0x3f47bc(0xff)]]||0x3c,_0x3ae2c7=_0x54d45c[_0x52753c[_0x3f47bc(0xff)]]||_0x3f47bc(0x158),_0x44b707=_0x154b45['getTime']()-_0x9d005*0xea60;if(_0x4bc7c0>=_0x44b707&&_0x4bc7c0<_0x154b45[_0x3f47bc(0xe7)]()){const _0x2b549e=lastActions[_0x3f47bc(0xfb)+_0x52753c[_0x3f47bc(0xff)]];if(_0x2b549e&&_0x4bc7c0-_0x2b549e<CAL_COOLDOWN_MS)continue;const _0x55e7ec=await findRelatedId(_0x2de045,_0x52753c['id'],'setpoint');if(_0x55e7ec){let _0x48b6f2=_0x4b267f[_0x52753c[_0x3f47bc(0xff)]];if(_0x48b6f2===undefined)_0x48b6f2=_0x4b267f[_0x3f47bc(0x15a)];if(_0x48b6f2===undefined)_0x48b6f2=0x15;const _0x90d12e=await _0x2de045[_0x3f47bc(0x13a)](_0x55e7ec);if(_0x90d12e&&typeof _0x90d12e[_0x3f47bc(0xbe)]==='number'&&_0x90d12e[_0x3f47bc(0xbe)]<_0x48b6f2-0.5){_0x2de045[_0x3f47bc(0x13b)][_0x3f47bc(0x110)](_0x3f47bc(0xe1)+_0x3ae2c7+_0x3f47bc(0x161)+_0x52753c[_0x3f47bc(0xff)]+_0x3f47bc(0x100)+_0xbd9f2b+_0x3f47bc(0x173)+_0x48b6f2+_0x3f47bc(0x11b)+_0x9d005+_0x3f47bc(0x151)),await _0x2de045['setForeignStateAsync'](_0x55e7ec,_0x48b6f2),await logAutomationAction(_0x2de045,_0x3f47bc(0xe3)+_0x52753c[_0x3f47bc(0xff)]+_0x3f47bc(0x169)+_0x48b6f2+'¬∞C\x20(via\x20'+_0x3ae2c7+')'),lastActions['cal_'+_0x52753c[_0x3f47bc(0xff)]]=_0x4bc7c0;const _0x5a7c3d=_0x13f9ff[_0x3f47bc(0x13f)](_0x17c902=>_0x17c902[_0x3f47bc(0x11e)]===_0x52753c[_0x3f47bc(0xff)]);if(_0x5a7c3d!==-0x1)_0x13f9ff[_0x3f47bc(0x152)](_0x5a7c3d,0x1);_0x13f9ff[_0x3f47bc(0x14e)]({'room':_0x52753c[_0x3f47bc(0xff)],'target':_0x48b6f2,'until':_0x154b45[_0x3f47bc(0xe7)]()}),_0x546d73=!![];}}}}}}}_0x546d73&&await _0x2de045[_0x3f47bc(0x12d)](_0x3f47bc(0x12a),{'val':JSON[_0x3f47bc(0x14f)](_0x13f9ff),'ack':!![]});}catch(_0x2d7868){_0x2de045['log'][_0x3f47bc(0x131)](_0x3f47bc(0xce)+_0x2d7868[_0x3f47bc(0x10f)]);}}async function manageMpcIntervention(_0x2c881b,_0x5e6e1e,_0x1c45ee){const _0x3ca181=a1_0x28c7e2;try{const _0x127516=_0x3ca181(0x109),_0x4ebc44=await _0x2c881b['getStateAsync'](_0x127516);let _0x2872a7=[];if(_0x4ebc44&&_0x4ebc44[_0x3ca181(0xbe)])try{_0x2872a7=JSON[_0x3ca181(0x136)](_0x4ebc44[_0x3ca181(0xbe)]);}catch(_0x1814c7){}const _0xe6d607=_0x2872a7[_0x3ca181(0x155)](_0x5e6e1e);if(_0x1c45ee===_0x3ca181(0xf0))_0xe6d607===-0x1&&(_0x2872a7[_0x3ca181(0x14e)](_0x5e6e1e),await _0x2c881b[_0x3ca181(0x12d)](_0x127516,{'val':JSON[_0x3ca181(0x14f)](_0x2872a7),'ack':!![]}));else _0x1c45ee==='remove'&&(_0xe6d607!==-0x1&&(_0x2872a7[_0x3ca181(0x152)](_0xe6d607,0x1),await _0x2c881b[_0x3ca181(0x12d)](_0x127516,{'val':JSON['stringify'](_0x2872a7),'ack':!![]})));}catch(_0xed60c9){}}async function cleanupGhostInterventions(_0x5d116){const _0x37442b=a1_0x28c7e2;try{const _0x421f57=_0x37442b(0x109),_0x5c3b68=await _0x5d116[_0x37442b(0xdf)](_0x421f57);if(!_0x5c3b68||!_0x5c3b68['val'])return;const _0x4d20fd=JSON['parse'](_0x5c3b68['val']);if(!Array['isArray'](_0x4d20fd)||_0x4d20fd[_0x37442b(0xcb)]===0x0)return;let _0x34264e={'default':0x15};try{const _0x943670=await _0x5d116['getStateAsync']('analysis.energy.warmupTargets');if(_0x943670&&_0x943670[_0x37442b(0xbe)])_0x34264e=JSON[_0x37442b(0x136)](_0x943670[_0x37442b(0xbe)]);}catch(_0x41f389){}let _0x50d0b6=[];try{const _0x90d0c8=await _0x5d116['getStateAsync'](_0x37442b(0x125));if(_0x90d0c8&&_0x90d0c8[_0x37442b(0xbe)])_0x50d0b6=JSON[_0x37442b(0x136)](_0x90d0c8[_0x37442b(0xbe)]);}catch(_0x5627a5){}const _0x674562=_0x5d116[_0x37442b(0xe9)]['devices']||[];let _0x567333=![];for(let _0x5c710e=_0x4d20fd[_0x37442b(0xcb)]-0x1;_0x5c710e>=0x0;_0x5c710e--){const _0x41e5c4=_0x4d20fd[_0x5c710e],_0xa80121=_0x674562[_0x37442b(0x15b)](_0x3e6613=>normalize(_0x3e6613[_0x37442b(0xff)])===normalize(_0x41e5c4)&&(_0x3e6613[_0x37442b(0x119)]==='temperature'||_0x3e6613[_0x37442b(0x119)]==='thermostat'));if(!_0xa80121){_0x5d116[_0x37442b(0x13b)][_0x37442b(0x131)](_0x37442b(0x121)+_0x41e5c4+_0x37442b(0xc7)),_0x4d20fd[_0x37442b(0x152)](_0x5c710e,0x1),_0x567333=!![];continue;}if(_0xa80121){const _0x22bffd=await findRelatedId(_0x5d116,_0xa80121['id'],_0x37442b(0x133)),_0x4c0d76=await _0x5d116['getForeignStateAsync'](_0xa80121['id']);if(_0x22bffd){const _0x4b824d=await _0x5d116[_0x37442b(0x13a)](_0x22bffd);if(_0x4b824d&&typeof _0x4b824d[_0x37442b(0xbe)]===_0x37442b(0x175)){let _0x283855=![],_0x556c68='';Math['abs'](_0x4b824d[_0x37442b(0xbe)]-ECO_TEMP)>0.5&&(_0x283855=!![],_0x556c68=_0x37442b(0xcf));if(!_0x283855&&_0x4c0d76&&typeof _0x4c0d76[_0x37442b(0xbe)]===_0x37442b(0x175)){const _0x77ed3d=_0x34264e[_0x41e5c4]||_0x34264e[_0x37442b(0x15a)]||0x15;_0x4c0d76[_0x37442b(0xbe)]<_0x77ed3d+0.2&&(_0x283855=!![],_0x556c68=_0x37442b(0x145));}if(_0x283855){if(_0x556c68===_0x37442b(0xcf)){_0x5d116[_0x37442b(0x13b)][_0x37442b(0x110)](_0x37442b(0x16f)+_0x41e5c4+_0x37442b(0xc4)+_0x4b824d[_0x37442b(0xbe)]+_0x37442b(0x137)+ECO_TEMP+_0x37442b(0xb2));const _0x57181d=lastActions[_0x37442b(0xfb)+_0x41e5c4],_0x200f58=_0x57181d&&Date[_0x37442b(0x148)]()-_0x57181d<0x2*0x3c*0x3e8;if(!_0x200f58&&_0x4b824d[_0x37442b(0xbe)]>ECO_TEMP+0.5)_0x5d116[_0x37442b(0x165)]&&(_0x5d116['log'][_0x37442b(0x110)](_0x37442b(0x13d)+_0x41e5c4+_0x37442b(0x157)),_0x5d116[_0x37442b(0x165)](_0x37442b(0xca),{'room':_0x41e5c4}));else _0x200f58&&_0x5d116[_0x37442b(0x13b)][_0x37442b(0x110)](_0x37442b(0xfa)+_0x41e5c4+'\x20durch\x20Kalender\x20ge√§ndert.\x20Keine\x20RL-Strafe.');}else{if(_0x556c68===_0x37442b(0x145)){let _0x342caa=![];if(_0x50d0b6[_0x37442b(0x15b)](_0x97719b=>_0x97719b[_0x37442b(0x11e)]===_0x41e5c4))_0x342caa=!![];const _0x297dc8=_0x674562[_0x37442b(0xd2)](_0x1832f8=>normalize(_0x1832f8[_0x37442b(0xff)])===normalize(_0x41e5c4)&&(_0x1832f8['type']==='window'||_0x1832f8[_0x37442b(0x119)]===_0x37442b(0x13e)||_0x1832f8[_0x37442b(0x119)]===_0x37442b(0xd0)));for(const _0x46ee36 of _0x297dc8){try{const _0x4baeee=await _0x5d116[_0x37442b(0x13a)](_0x46ee36['id']);if(_0x4baeee&&(_0x4baeee[_0x37442b(0xbe)]===!![]||_0x4baeee[_0x37442b(0xbe)]===0x1||String(_0x4baeee[_0x37442b(0xbe)])[_0x37442b(0x16e)]()===_0x37442b(0x112)))_0x342caa=!![];}catch(_0x260fd4){}}if(_0x342caa)_0x5d116[_0x37442b(0x13b)][_0x37442b(0x110)](_0x37442b(0x129)+_0x41e5c4+_0x37442b(0x122));else{const _0x1195c4=_0x34264e[_0x41e5c4]||_0x34264e[_0x37442b(0x15a)]||0x15;_0x5d116[_0x37442b(0x13b)][_0x37442b(0x110)](_0x37442b(0xf2)+_0x41e5c4+_0x37442b(0x135)+_0x4c0d76[_0x37442b(0xbe)]+_0x37442b(0x116)+(_0x1195c4+0.2)+_0x37442b(0xe5)),await _0x5d116[_0x37442b(0xe8)](_0x22bffd,_0x1195c4),await logAutomationAction(_0x5d116,_0x37442b(0xb7)+_0x41e5c4+_0x37442b(0xde)+_0x1195c4+'¬∞C'),lastActions[_0x37442b(0xea)+_0x41e5c4]=Date[_0x37442b(0x148)]();}}}_0x4d20fd[_0x37442b(0x152)](_0x5c710e,0x1),_0x567333=!![];}}}}}_0x567333&&await _0x5d116[_0x37442b(0x12d)](_0x421f57,{'val':JSON[_0x37442b(0x14f)](_0x4d20fd),'ack':!![]});}catch(_0x2fa6d2){}}function a1_0x2780(_0xe13496,_0xc1401e){const _0x327060=a1_0x2959();return a1_0x2780=function(_0x3c8212,_0x3134a6){_0x3c8212=_0x3c8212-0xb2;let _0x2959fa=_0x327060[_0x3c8212];return _0x2959fa;},a1_0x2780(_0xe13496,_0xc1401e);}async function applyEnergySavings(_0x25765c,_0x3b98e3){const _0x3f151f=a1_0x28c7e2;await cleanupGhostInterventions(_0x25765c);if(!_0x3b98e3||_0x3b98e3[_0x3f151f(0xcb)]===0x0)return;const _0x8658d1=_0x25765c[_0x3f151f(0xe9)][_0x3f151f(0xd8)]||[],_0xd34b33=Date[_0x3f151f(0x148)]();for(const _0x2ceba6 of _0x3b98e3){const _0x1dce05=_0x2ceba6['room'],_0x4641a6=_0x2ceba6[_0x3f151f(0x124)],_0x2a6adf=_0x2ceba6[_0x3f151f(0x12e)]||0x15;if(lastActions[_0x3f151f(0xea)+_0x1dce05]&&_0xd34b33-lastActions['rescue_'+_0x1dce05]<RESCUE_LOCK_MS)continue;const _0x49dbfe=_0x8658d1[_0x3f151f(0x15b)](_0x5b145e=>normalize(_0x5b145e[_0x3f151f(0xff)])===normalize(_0x1dce05)&&(_0x5b145e[_0x3f151f(0x119)]===_0x3f151f(0xcc)||_0x5b145e[_0x3f151f(0x119)]==='thermostat'));if(!_0x49dbfe)continue;const _0xc16358=await findRelatedId(_0x25765c,_0x49dbfe['id'],_0x3f151f(0x133));if(_0xc16358){if(lastActions[_0x3f151f(0x153)+_0x1dce05]&&_0xd34b33-lastActions[_0x3f151f(0x153)+_0x1dce05]<0x1e*0x3c*0x3e8)continue;const _0x37f372=await _0x25765c['getForeignStateAsync'](_0xc16358);if(_0x37f372&&typeof _0x37f372['val']===_0x3f151f(0x175)){const _0x29d5a1=_0x37f372[_0x3f151f(0xbe)];_0x29d5a1!==ECO_TEMP&&await manageMpcIntervention(_0x25765c,_0x1dce05,_0x3f151f(0x141));if(_0x4641a6>0x1e)_0x29d5a1>ECO_TEMP+0.5&&(_0x25765c[_0x3f151f(0x13b)][_0x3f151f(0x110)]('üçÉ\x20[MPC\x20ACTION]\x20Senke\x20'+_0x1dce05+'\x20auf\x20'+ECO_TEMP+_0x3f151f(0x159)+_0x4641a6+_0x3f151f(0x10e)),await _0x25765c[_0x3f151f(0xe8)](_0xc16358,ECO_TEMP),await manageMpcIntervention(_0x25765c,_0x1dce05,_0x3f151f(0xf0)),lastActions[_0x3f151f(0x153)+_0x1dce05]=_0xd34b33,await logAutomationAction(_0x25765c,_0x3f151f(0x139)+_0x1dce05+_0x3f151f(0x102)+ECO_TEMP+'¬∞C'));else _0x4641a6<=0xf&&(_0x29d5a1<_0x2a6adf&&(_0x25765c[_0x3f151f(0x13b)]['info'](_0x3f151f(0x108)+_0x1dce05+_0x3f151f(0x178)+_0x2a6adf+'¬∞C!\x20(Puffer\x20leer).'),await _0x25765c['setForeignStateAsync'](_0xc16358,_0x2a6adf),await manageMpcIntervention(_0x25765c,_0x1dce05,_0x3f151f(0x141)),lastActions['mpc_'+_0x1dce05]=_0xd34b33,await logAutomationAction(_0x25765c,'[MPC]\x20'+_0x1dce05+_0x3f151f(0xbc)+_0x2a6adf+'¬∞C')));}}else _0x25765c[_0x3f151f(0x13b)][_0x3f151f(0x131)](_0x3f151f(0x115)+_0x1dce05+'\x20gefunden!');}}module['exports']={'handlePrediction':handlePrediction,'applyEnergySavings':applyEnergySavings,'scanThermostats':scanThermostats,'checkCalendarTriggers':checkCalendarTriggers,'monitorEnforcements':monitorEnforcements,'updateSchedulePreview':updateSchedulePreview,'cleanupGhostInterventions':cleanupGhostInterventions};