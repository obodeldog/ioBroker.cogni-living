const a1_0x58e8be=a1_0x4bf7;(function(_0x478d26,_0x49f3e7){const _0x3395b6=a1_0x4bf7,_0x240a86=_0x478d26();while(!![]){try{const _0x154a91=-parseInt(_0x3395b6(0x1af))/0x1+-parseInt(_0x3395b6(0x1ca))/0x2*(-parseInt(_0x3395b6(0x1c5))/0x3)+-parseInt(_0x3395b6(0x19b))/0x4+parseInt(_0x3395b6(0x1b2))/0x5+-parseInt(_0x3395b6(0x1f0))/0x6*(parseInt(_0x3395b6(0x1e6))/0x7)+-parseInt(_0x3395b6(0x1cf))/0x8*(parseInt(_0x3395b6(0x1b0))/0x9)+parseInt(_0x3395b6(0x1a3))/0xa;if(_0x154a91===_0x49f3e7)break;else _0x240a86['push'](_0x240a86['shift']());}catch(_0x39d8b9){_0x240a86['push'](_0x240a86['shift']());}}}(a1_0x331d,0x50cff));const a1_0x12f1e9=(function(){let _0x1b14c5=!![];return function(_0x34c4ac,_0x148719){const _0x54890d=_0x1b14c5?function(){const _0x2a17a5=a1_0x4bf7;if(_0x148719){const _0x4c2591=_0x148719[_0x2a17a5(0x1ad)](_0x34c4ac,arguments);return _0x148719=null,_0x4c2591;}}:function(){};return _0x1b14c5=![],_0x54890d;};}()),a1_0x79d28e=a1_0x12f1e9(this,function(){const _0x140804=a1_0x4bf7;return a1_0x79d28e['toString']()[_0x140804(0x1a8)](_0x140804(0x19f))['toString']()['constructor'](a1_0x79d28e)[_0x140804(0x1a8)](_0x140804(0x19f));});a1_0x79d28e();'use strict';const aiAgent=require(a1_0x58e8be(0x19a)),COOLDOWN_MS=0x3c*0x3e8,lastActions={};function normalize(_0x382f89){const _0xe7e16a=a1_0x58e8be;if(!_0x382f89)return'';return _0x382f89[_0xe7e16a(0x1c7)]()[_0xe7e16a(0x1ed)](/\s+/g,'')['trim']();}function a1_0x331d(){const _0xfab149=['ACTUAL_TEMPERATURE','analysis.automation.lastAction','entries','SET_POINT_TEMPERATURE','Auto-Erkennung','Ist','active','split','.1.TEMPERATURE','Nicht\x20gefunden','role','off','val','¬∞C\x20(Coasting\x20m√∂glich:\x20','devices','find','common','switch','occupied_heating_setpoint','7HCyvEK','location','log','name','debug','slice','minutes_safe','replace','.1.ACTUAL_TEMPERATURE','.4.SET_TEMPERATURE','2889282NBKqBH','setForeignStateAsync','Unknown','parse','target','./ai_agent','258172hrqOFT','config',':\x20-1¬∞C\x20(Sparpotenzial\x20genutzt)','filter','(((.+)+)+)+$','local_temperature','localeCompare','sensor','13433210JrOPbE','now','length','level.temperature','number','search','toUpperCase','temp','\x20min)','\x20->\x20Schalte\x20','apply',')\x20auf\x20','514029isENLk','9810fQzCCg','push','2630205asaCqH','setpoint','setStateAsync','dimmer','info','getForeignObjectAsync','type','join','reason','Soll','light','current_heating_setpoint','write','[MPC]\x20','getForeignStateAsync','ACTUAL','getStateAsync','thermostat','temperature','27591mBYQIH','thermostatMapping','toLowerCase','approved','mpc_','24RVNquf','set','room','üçÉ\x20MPC\x20Autonomy:\x20Senke\x20','getForeignObjectsAsync','4320osjNkW','includes','.1.SET_POINT_TEMPERATURE','string'];a1_0x331d=function(){return _0xfab149;};return a1_0x331d();}async function handlePrediction(_0x5037bb,_0x3b5d7f,_0x58fa1b){const _0xc982e6=a1_0x58e8be;if(!_0x3b5d7f||_0x3b5d7f===_0xc982e6(0x1f2))return;let _0x258a4d='off',_0x1dc8e7=0.6;try{const _0x1a842c=await _0x5037bb['getStateAsync']('analysis.automation.mode');if(_0x1a842c&&_0x1a842c[_0xc982e6(0x1df)])_0x258a4d=_0x1a842c['val'];const _0x4a3c93=await _0x5037bb[_0xc982e6(0x1c2)]('analysis.automation.confidenceThreshold');if(_0x4a3c93&&_0x4a3c93[_0xc982e6(0x1df)])_0x1dc8e7=_0x4a3c93['val'];}catch(_0x2484cf){}if(_0x258a4d===_0xc982e6(0x1de)||_0x58fa1b<_0x1dc8e7)return;const _0x5de98e=Date[_0xc982e6(0x1a4)]();if(lastActions[_0x3b5d7f]&&_0x5de98e-lastActions[_0x3b5d7f]<COOLDOWN_MS)return;const _0x10ca87=_0x5037bb['config'][_0xc982e6(0x1e1)]||[],_0xbde89c=normalize(_0x3b5d7f),_0x4402b4=_0x10ca87[_0xc982e6(0x1e2)](_0x35e33c=>normalize(_0x35e33c[_0xc982e6(0x1e7)])===_0xbde89c&&(_0x35e33c[_0xc982e6(0x1b8)]===_0xc982e6(0x1bc)||_0x35e33c[_0xc982e6(0x1b8)]===_0xc982e6(0x1b5)||_0x35e33c['type']===_0xc982e6(0x1e4)));if(!_0x4402b4){_0x5037bb['log'][_0xc982e6(0x1ea)]('üîç\x20Device-Search\x20failed\x20for\x20predicted\x20room\x20\x27'+_0x3b5d7f+'\x27.');return;}const _0x10d731=await aiAgent['consultButler'](_0x5037bb,_0x3b5d7f,_0x4402b4['name'],_0x58fa1b);if(!_0x10d731[_0xc982e6(0x1c8)])return;const _0x150da7='Pr√§diktion:\x20'+_0x3b5d7f+_0xc982e6(0x1ac)+_0x4402b4[_0xc982e6(0x1e9)]+'\x20('+_0x10d731[_0xc982e6(0x1ba)]+')';await _0x5037bb[_0xc982e6(0x1b4)](_0xc982e6(0x1d4),{'val':'['+_0x258a4d[_0xc982e6(0x1a9)]()+']\x20'+_0x150da7,'ack':!![]});if(_0x258a4d===_0xc982e6(0x1d9)){const _0x2e6422=await _0x5037bb['getForeignStateAsync'](_0x4402b4['id']);(!_0x2e6422||!_0x2e6422[_0xc982e6(0x1df)]&&_0x2e6422[_0xc982e6(0x1df)]!==!![])&&await _0x5037bb[_0xc982e6(0x1f1)](_0x4402b4['id'],!![]),lastActions[_0x3b5d7f]=_0x5de98e;}}async function findSetpointId(_0x4bae99,_0x44cde5){const _0x406dc8=a1_0x58e8be;if(_0x4bae99[_0x406dc8(0x19c)]['thermostatMapping']){let _0x81d4=_0x4bae99['config'][_0x406dc8(0x1c6)];if(typeof _0x81d4===_0x406dc8(0x1d2))try{_0x81d4=JSON[_0x406dc8(0x1f3)](_0x81d4);}catch(_0x52576c){_0x81d4={};}if(_0x81d4&&_0x81d4[_0x44cde5])return _0x81d4[_0x44cde5];}const _0x4afc71=[{'s':_0x406dc8(0x1ee),'t':_0x406dc8(0x1d1)},{'s':_0x406dc8(0x1db),'t':_0x406dc8(0x1ef)},{'s':_0x406dc8(0x1d3),'t':_0x406dc8(0x1d6)},{'s':_0x406dc8(0x1a0),'t':_0x406dc8(0x1e5)},{'s':_0x406dc8(0x1a0),'t':_0x406dc8(0x1bd)},{'s':_0x406dc8(0x1c4),'t':'target_temperature'},{'s':_0x406dc8(0x1c1),'t':'SET'},{'s':_0x406dc8(0x1d8),'t':_0x406dc8(0x1bb)},{'s':_0x406dc8(0x1c4),'t':_0x406dc8(0x1b3)}];for(const _0xe44ef6 of _0x4afc71){if(_0x44cde5[_0x406dc8(0x1d0)](_0xe44ef6['s'])){const _0x461d08=_0x44cde5[_0x406dc8(0x1ed)](_0xe44ef6['s'],_0xe44ef6['t']),_0x17ef94=await _0x4bae99[_0x406dc8(0x1b7)](_0x461d08);if(_0x17ef94)return _0x461d08;}}try{const _0x4ab004=_0x44cde5[_0x406dc8(0x1da)]('.');if(_0x4ab004[_0x406dc8(0x1a5)]>0x2){const _0x116425=_0x4ab004[_0x406dc8(0x1eb)](0x0,-0x1)[_0x406dc8(0x1b9)]('.'),_0x5630ae=await _0x4bae99[_0x406dc8(0x1ce)](_0x116425+'.*');for(const [_0x5c04de,_0x5ea8d9]of Object[_0x406dc8(0x1d5)](_0x5630ae)){if(_0x5c04de===_0x44cde5)continue;if(_0x5ea8d9&&_0x5ea8d9[_0x406dc8(0x1e3)]&&_0x5ea8d9[_0x406dc8(0x1e3)][_0x406dc8(0x1be)]===!![]){const _0x1f3c96=_0x5c04de['toLowerCase'](),_0x4d9d92=(_0x5ea8d9[_0x406dc8(0x1e3)][_0x406dc8(0x1dd)]||'')[_0x406dc8(0x1c7)]();if(_0x1f3c96['includes'](_0x406dc8(0x1cb))||_0x1f3c96[_0x406dc8(0x1d0)]('soll')||_0x1f3c96[_0x406dc8(0x1d0)](_0x406dc8(0x199))||_0x4d9d92[_0x406dc8(0x1d0)](_0x406dc8(0x1a6))||_0x4d9d92[_0x406dc8(0x1d0)](_0x406dc8(0x1c3)))return _0x5c04de;}}}}catch(_0x36cbfb){}return null;}async function scanThermostats(_0x5311ab){const _0x3d8395=a1_0x58e8be,_0x5bcbd4=_0x5311ab['config'][_0x3d8395(0x1e1)]||[],_0x550ede=[],_0x94eb3=_0x5bcbd4[_0x3d8395(0x19e)](_0x33087b=>_0x33087b['id']&&_0x33087b['id'][_0x3d8395(0x1d0)]('temperature')||_0x33087b[_0x3d8395(0x1b8)]&&[_0x3d8395(0x1c4),_0x3d8395(0x1c3),_0x3d8395(0x1a2)][_0x3d8395(0x1d0)](_0x33087b[_0x3d8395(0x1b8)])||_0x33087b[_0x3d8395(0x1e9)]&&_0x33087b[_0x3d8395(0x1e9)]['toLowerCase']()[_0x3d8395(0x1d0)](_0x3d8395(0x1aa)));for(const _0x3ba587 of _0x94eb3){const _0x274191=await findSetpointId(_0x5311ab,_0x3ba587['id']);let _0x3495c1=_0x3d8395(0x1dc),_0x4fbb62=![],_0x48a1fb=_0x5311ab[_0x3d8395(0x19c)][_0x3d8395(0x1c6)]||{};if(typeof _0x48a1fb===_0x3d8395(0x1d2))try{_0x48a1fb=JSON[_0x3d8395(0x1f3)](_0x48a1fb);}catch(_0x98c341){}if(_0x48a1fb[_0x3ba587['id']]&&_0x48a1fb[_0x3ba587['id']]===_0x274191)_0x3495c1='Manuelles\x20Mapping',_0x4fbb62=!![];else _0x274191&&(_0x3495c1=_0x3d8395(0x1d7));_0x550ede[_0x3d8395(0x1b1)]({'room':_0x3ba587[_0x3d8395(0x1e7)]||'Unbekannt','sensorId':_0x3ba587['id'],'setpointId':_0x274191||'-','source':_0x3495c1,'isManual':_0x4fbb62,'status':_0x274191?'OK':'Fehlt'});}return _0x550ede['sort']((_0x5024a2,_0x5c885f)=>_0x5024a2[_0x3d8395(0x1cc)][_0x3d8395(0x1a1)](_0x5c885f[_0x3d8395(0x1cc)]));}async function applyEnergySavings(_0x41ef30,_0xc05da6){const _0x792d22=a1_0x58e8be,_0x46018e=_0x41ef30[_0x792d22(0x19c)][_0x792d22(0x1e1)]||[];for(const _0x46f193 of _0xc05da6){const _0x5f9678=_0x46f193[_0x792d22(0x1cc)],_0x5395c1=_0x46f193[_0x792d22(0x1ec)],_0x3631ef=Date[_0x792d22(0x1a4)]();if(lastActions['mpc_'+_0x5f9678]&&_0x3631ef-lastActions[_0x792d22(0x1c9)+_0x5f9678]<0x1e*0x3c*0x3e8)continue;const _0x6dffc8=_0x46018e[_0x792d22(0x1e2)](_0x48c7e6=>normalize(_0x48c7e6[_0x792d22(0x1e7)])===normalize(_0x5f9678));if(!_0x6dffc8)continue;const _0x42db46=await findSetpointId(_0x41ef30,_0x6dffc8['id']);if(_0x42db46){const _0x25aaeb=await _0x41ef30[_0x792d22(0x1c0)](_0x42db46);if(_0x25aaeb&&typeof _0x25aaeb['val']===_0x792d22(0x1a7)){const _0x5b8099=_0x25aaeb[_0x792d22(0x1df)];if(_0x5395c1>0x1e&&_0x5b8099>0x11){const _0xd5a057=_0x5b8099-0x1;_0x41ef30[_0x792d22(0x1e8)][_0x792d22(0x1b6)](_0x792d22(0x1cd)+_0x5f9678+'\x20('+_0x42db46+_0x792d22(0x1ae)+_0xd5a057+_0x792d22(0x1e0)+_0x5395c1+_0x792d22(0x1ab)),await _0x41ef30[_0x792d22(0x1f1)](_0x42db46,_0xd5a057),lastActions[_0x792d22(0x1c9)+_0x5f9678]=_0x3631ef,await _0x41ef30[_0x792d22(0x1b4)](_0x792d22(0x1d4),{'val':_0x792d22(0x1bf)+_0x5f9678+_0x792d22(0x19d),'ack':!![]});}}}}}function a1_0x4bf7(_0x529ce7,_0x3ed5fa){const _0x2b70b4=a1_0x331d();return a1_0x4bf7=function(_0x79d28e,_0x12f1e9){_0x79d28e=_0x79d28e-0x199;let _0x331daf=_0x2b70b4[_0x79d28e];return _0x331daf;},a1_0x4bf7(_0x529ce7,_0x3ed5fa);}module['exports']={'handlePrediction':handlePrediction,'applyEnergySavings':applyEnergySavings,'scanThermostats':scanThermostats};