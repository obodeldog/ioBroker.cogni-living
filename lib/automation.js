const a1_0x7aa3ad=a1_0x2a90;(function(_0x368ab1,_0x271d3b){const _0x1511e7=a1_0x2a90,_0x18eeb5=_0x368ab1();while(!![]){try{const _0x40252e=parseInt(_0x1511e7(0xd1))/0x1+-parseInt(_0x1511e7(0xf8))/0x2+-parseInt(_0x1511e7(0xcd))/0x3+parseInt(_0x1511e7(0xab))/0x4*(parseInt(_0x1511e7(0xa9))/0x5)+-parseInt(_0x1511e7(0x103))/0x6+-parseInt(_0x1511e7(0xee))/0x7*(parseInt(_0x1511e7(0x90))/0x8)+-parseInt(_0x1511e7(0x92))/0x9*(-parseInt(_0x1511e7(0x7d))/0xa);if(_0x40252e===_0x271d3b)break;else _0x18eeb5['push'](_0x18eeb5['shift']());}catch(_0x1a790a){_0x18eeb5['push'](_0x18eeb5['shift']());}}}(a1_0x4c34,0xce065));const a1_0x19ed55=(function(){let _0x11d0fa=!![];return function(_0x11a2a5,_0x497e8b){const _0x5c2931=_0x11d0fa?function(){const _0x2d9d57=a1_0x2a90;if(_0x497e8b){const _0x5aaa79=_0x497e8b[_0x2d9d57(0xf4)](_0x11a2a5,arguments);return _0x497e8b=null,_0x5aaa79;}}:function(){};return _0x11d0fa=![],_0x5c2931;};}()),a1_0x285118=a1_0x19ed55(this,function(){const _0x695274=a1_0x2a90;return a1_0x285118[_0x695274(0x110)]()[_0x695274(0x80)](_0x695274(0x10c))['toString']()[_0x695274(0x8f)](a1_0x285118)['search'](_0x695274(0x10c));});a1_0x285118();'use strict';const aiAgent=require(a1_0x7aa3ad(0x8c)),COOLDOWN_MS=0x3c*0x3e8,CAL_COOLDOWN_MS=0x5a*0x3c*0x3e8,ECO_TEMP=0x11,lastActions={};function normalize(_0x2c2e6e){const _0x891105=a1_0x7aa3ad;if(!_0x2c2e6e)return'';return _0x2c2e6e[_0x891105(0xdd)]()[_0x891105(0xf1)](/\s+/g,'')[_0x891105(0x111)]();}async function logAutomationAction(_0x307e27,_0x1ecbbe){const _0x1626e7=a1_0x7aa3ad;await _0x307e27[_0x1626e7(0xfa)](_0x1626e7(0xe5),{'val':_0x1ecbbe,'ack':!![]});try{const _0x37b55f=_0x1626e7(0x9f),_0x3a07a9=await _0x307e27['getStateAsync'](_0x37b55f);let _0x3bb80f=[];if(_0x3a07a9&&_0x3a07a9[_0x1626e7(0xf6)])try{_0x3bb80f=JSON[_0x1626e7(0x88)](_0x3a07a9[_0x1626e7(0xf6)]);}catch(_0x2776bf){}_0x3bb80f[_0x1626e7(0x108)]({'ts':Date[_0x1626e7(0x9c)](),'msg':_0x1ecbbe});if(_0x3bb80f[_0x1626e7(0x8d)]>0x32)_0x3bb80f=_0x3bb80f['slice'](0x0,0x32);await _0x307e27[_0x1626e7(0xfa)](_0x37b55f,{'val':JSON[_0x1626e7(0x10e)](_0x3bb80f),'ack':!![]});}catch(_0x13c87e){}}async function handlePrediction(_0x3b027e,_0x58cc80,_0x20a800){const _0x8dbbdf=a1_0x7aa3ad;if(!_0x58cc80||_0x58cc80===_0x8dbbdf(0x83))return;let _0x3e22a9='off',_0x45f97b=0.6;try{const _0x13b70f=await _0x3b027e[_0x8dbbdf(0xe0)](_0x8dbbdf(0xbf));if(_0x13b70f&&_0x13b70f[_0x8dbbdf(0xf6)])_0x3e22a9=_0x13b70f[_0x8dbbdf(0xf6)];const _0x48dfe8=await _0x3b027e[_0x8dbbdf(0xe0)](_0x8dbbdf(0xe1));if(_0x48dfe8&&_0x48dfe8[_0x8dbbdf(0xf6)])_0x45f97b=_0x48dfe8[_0x8dbbdf(0xf6)];}catch(_0x3534ac){}if(_0x3e22a9===_0x8dbbdf(0x9a)||_0x20a800<_0x45f97b)return;const _0x210510=Date['now']();if(lastActions[_0x58cc80]&&_0x210510-lastActions[_0x58cc80]<COOLDOWN_MS)return;const _0x42f69e=_0x3b027e[_0x8dbbdf(0x85)][_0x8dbbdf(0x119)]||[],_0xefeb3=normalize(_0x58cc80),_0x1a007d=_0x42f69e['find'](_0x2b3a6b=>normalize(_0x2b3a6b[_0x8dbbdf(0x9e)])===_0xefeb3&&(_0x2b3a6b[_0x8dbbdf(0xf9)]===_0x8dbbdf(0xea)||_0x2b3a6b[_0x8dbbdf(0xf9)]===_0x8dbbdf(0x95)||_0x2b3a6b[_0x8dbbdf(0xf9)]==='switch'));if(!_0x1a007d)return;const _0x32e4ad=await aiAgent[_0x8dbbdf(0x100)](_0x3b027e,_0x58cc80,_0x1a007d['name'],_0x20a800);if(!_0x32e4ad['approved'])return;const _0x4e933c='Pr√§diktion:\x20'+_0x58cc80+_0x8dbbdf(0x84)+_0x1a007d['name']+'\x20('+_0x32e4ad[_0x8dbbdf(0x97)]+')';await logAutomationAction(_0x3b027e,'['+_0x3e22a9[_0x8dbbdf(0xa8)]()+']\x20'+_0x4e933c);if(_0x3e22a9==='active'){const _0x107b0a=await _0x3b027e[_0x8dbbdf(0xd4)](_0x1a007d['id']);(!_0x107b0a||!_0x107b0a[_0x8dbbdf(0xf6)]&&_0x107b0a[_0x8dbbdf(0xf6)]!==!![])&&await _0x3b027e[_0x8dbbdf(0xf7)](_0x1a007d['id'],!![]),lastActions[_0x58cc80]=_0x210510;}}async function findRelatedId(_0x3e5181,_0x428b67,_0x2b031a=a1_0x7aa3ad(0x8b)){const _0x5a3e7d=a1_0x7aa3ad;if(_0x2b031a===_0x5a3e7d(0x8b)&&_0x3e5181[_0x5a3e7d(0x85)]['thermostatMapping']){let _0x30c19a=_0x3e5181['config'][_0x5a3e7d(0x11a)];if(typeof _0x30c19a===_0x5a3e7d(0xda))try{_0x30c19a=JSON['parse'](_0x30c19a);}catch(_0x1648c5){}if(_0x30c19a&&_0x30c19a[_0x428b67])return _0x30c19a[_0x428b67];}if(_0x2b031a==='valve'&&_0x3e5181[_0x5a3e7d(0x85)][_0x5a3e7d(0x101)]){let _0x27884d=_0x3e5181[_0x5a3e7d(0x85)][_0x5a3e7d(0x101)];if(typeof _0x27884d===_0x5a3e7d(0xda))try{_0x27884d=JSON[_0x5a3e7d(0x88)](_0x27884d);}catch(_0x212824){}if(_0x27884d&&_0x27884d[_0x428b67])return _0x27884d[_0x428b67];}let _0x11d9f6=[];if(_0x2b031a===_0x5a3e7d(0x8b))_0x11d9f6=[{'s':_0x5a3e7d(0xc1),'t':_0x5a3e7d(0x96)},{'s':_0x5a3e7d(0xe9),'t':_0x5a3e7d(0x96)},{'s':'.1.TEMPERATURE','t':'.4.SET_TEMPERATURE'},{'s':'ACTUAL_TEMPERATURE','t':_0x5a3e7d(0xb4)},{'s':'local_temperature','t':_0x5a3e7d(0xe8)},{'s':_0x5a3e7d(0xa7),'t':_0x5a3e7d(0x107)},{'s':_0x5a3e7d(0xde),'t':_0x5a3e7d(0xa6)},{'s':_0x5a3e7d(0xad),'t':_0x5a3e7d(0x10f)},{'s':'Ist','t':_0x5a3e7d(0x9d)},{'s':_0x5a3e7d(0xde),'t':_0x5a3e7d(0x8b)}];else _0x2b031a==='valve'&&(_0x11d9f6=[{'s':_0x5a3e7d(0xc1),'t':_0x5a3e7d(0xed)},{'s':'.1.TEMPERATURE','t':'.1.LEVEL'},{'s':_0x5a3e7d(0xe9),'t':_0x5a3e7d(0xac)},{'s':_0x5a3e7d(0xa7),'t':'pi_heating_demand'},{'s':'temperature','t':'valve_position'},{'s':_0x5a3e7d(0xde),'t':_0x5a3e7d(0xeb)}]);for(const _0xe047d8 of _0x11d9f6){if(_0x428b67['includes'](_0xe047d8['s'])){const _0x252e19=_0x428b67[_0x5a3e7d(0xf1)](_0xe047d8['s'],_0xe047d8['t']),_0x229bee=await _0x3e5181[_0x5a3e7d(0xff)](_0x252e19);if(_0x229bee)return _0x252e19;}}try{const _0x3d80fe=_0x428b67['split']('.');if(_0x3d80fe[_0x5a3e7d(0x8d)]>0x2){const _0x21838e=_0x3d80fe['slice'](0x0,-0x1)[_0x5a3e7d(0x116)]('.'),_0x31dbfc=await _0x3e5181['getForeignObjectsAsync'](_0x21838e+'.*'),_0x45260f=[],_0x1d4abf=_0x428b67[_0x5a3e7d(0x10d)](/[._]+/)[_0x5a3e7d(0xbb)](_0x4c7f9e=>![_0x5a3e7d(0x7e),'0',_0x5a3e7d(0xd8),_0x5a3e7d(0x105),'wert',_0x5a3e7d(0xde),_0x5a3e7d(0x87),_0x5a3e7d(0xd9),_0x5a3e7d(0xd5),_0x5a3e7d(0x89)][_0x5a3e7d(0x118)](_0x4c7f9e[_0x5a3e7d(0xdd)]()));for(const [_0x1a8da2,_0x41e7a5]of Object[_0x5a3e7d(0x113)](_0x31dbfc)){if(_0x1a8da2===_0x428b67)continue;if(_0x41e7a5&&_0x41e7a5['common']){const _0x434569=_0x1a8da2['toLowerCase'](),_0x1c0f5a=(_0x41e7a5[_0x5a3e7d(0xd6)][_0x5a3e7d(0xaf)]||'')['toLowerCase'](),_0xd1ff21=(_0x41e7a5[_0x5a3e7d(0xd6)][_0x5a3e7d(0xba)]||'')['toLowerCase']();let _0x4db8cf=![];if(_0x2b031a===_0x5a3e7d(0x8b)&&_0x41e7a5[_0x5a3e7d(0xd6)]['write']===!![])_0x4db8cf=_0x434569[_0x5a3e7d(0x118)](_0x5a3e7d(0x109))||_0x434569[_0x5a3e7d(0x118)](_0x5a3e7d(0xe4))||_0x434569[_0x5a3e7d(0x118)](_0x5a3e7d(0x10b))||_0x1c0f5a[_0x5a3e7d(0x118)](_0x5a3e7d(0xf2))||_0x1c0f5a[_0x5a3e7d(0x118)]('thermostat.setpoint');else _0x2b031a===_0x5a3e7d(0xaa)&&(_0x4db8cf=_0x434569['includes'](_0x5a3e7d(0xeb))||_0x434569[_0x5a3e7d(0x118)](_0x5a3e7d(0xaa))||_0x434569[_0x5a3e7d(0x118)](_0x5a3e7d(0x7f))||_0x434569[_0x5a3e7d(0x118)]('position')||_0x1c0f5a[_0x5a3e7d(0x118)](_0x5a3e7d(0xcf))||_0x1c0f5a[_0x5a3e7d(0x118)](_0x5a3e7d(0xa2))||_0xd1ff21[_0x5a3e7d(0x118)]('%'));if(_0x4db8cf){const _0x4b65be=_0x1a8da2[_0x5a3e7d(0x10d)](/[._]+/)['map'](_0x1a345b=>_0x1a345b[_0x5a3e7d(0xdd)]());let _0x24fa98=0x0;_0x1d4abf['forEach'](_0x3f2a48=>{const _0x4a7076=_0x5a3e7d;if(_0x4b65be[_0x4a7076(0x118)](_0x3f2a48[_0x4a7076(0xdd)]()))_0x24fa98++;}),_0x45260f['push']({'id':_0x1a8da2,'score':_0x24fa98});}}}if(_0x45260f['length']>0x0){_0x45260f[_0x5a3e7d(0xe3)]((_0x30c6a0,_0x3f3d48)=>_0x3f3d48['score']-_0x30c6a0['score']);if(_0x45260f[0x0]['score']>0x0)return _0x45260f[0x0]['id'];}}}catch(_0x1a3d04){}return null;}async function scanThermostats(_0x407640){const _0xc6a9cd=a1_0x7aa3ad,_0x300b8b=_0x407640[_0xc6a9cd(0x85)][_0xc6a9cd(0x119)]||[],_0x2d4ecd=[],_0xb0fbfb=_0x300b8b[_0xc6a9cd(0xbb)](_0xea3009=>_0xea3009['id']&&_0xea3009['id'][_0xc6a9cd(0x118)](_0xc6a9cd(0xde))||_0xea3009[_0xc6a9cd(0xf9)]&&[_0xc6a9cd(0xde),'thermostat','sensor'][_0xc6a9cd(0x118)](_0xea3009[_0xc6a9cd(0xf9)])||_0xea3009[_0xc6a9cd(0xbe)]&&_0xea3009[_0xc6a9cd(0xbe)][_0xc6a9cd(0xdd)]()[_0xc6a9cd(0x118)]('temp'));for(const _0x1a0df1 of _0xb0fbfb){const _0x3bfcec=await findRelatedId(_0x407640,_0x1a0df1['id'],_0xc6a9cd(0x8b)),_0x353ff1=await findRelatedId(_0x407640,_0x1a0df1['id'],_0xc6a9cd(0xaa));let _0x5a80fc=_0xc6a9cd(0x98),_0x1f0324=![],_0xb3e43d=_0x407640[_0xc6a9cd(0x85)][_0xc6a9cd(0x11a)]||{};if(typeof _0xb3e43d===_0xc6a9cd(0xda))try{_0xb3e43d=JSON[_0xc6a9cd(0x88)](_0xb3e43d);}catch(_0x47f2be){}let _0x4a40c2=_0x407640['config'][_0xc6a9cd(0x101)]||{};if(typeof _0x4a40c2===_0xc6a9cd(0xda))try{_0x4a40c2=JSON[_0xc6a9cd(0x88)](_0x4a40c2);}catch(_0x4e683d){}if(_0xb3e43d[_0x1a0df1['id']]&&_0xb3e43d[_0x1a0df1['id']]===_0x3bfcec||_0x4a40c2[_0x1a0df1['id']]&&_0x4a40c2[_0x1a0df1['id']]===_0x353ff1)_0x5a80fc=_0xc6a9cd(0xfb),_0x1f0324=!![];else(_0x3bfcec||_0x353ff1)&&(_0x5a80fc=_0xc6a9cd(0x104));_0x2d4ecd[_0xc6a9cd(0x8e)]({'room':_0x1a0df1[_0xc6a9cd(0x9e)]||_0xc6a9cd(0x9b),'sensorId':_0x1a0df1['id'],'setpointId':_0x3bfcec||'-','valveId':_0x353ff1||'-','source':_0x5a80fc,'isManual':_0x1f0324,'status':_0x3bfcec&&_0x353ff1?_0xc6a9cd(0xf3):_0x3bfcec?'OK':_0xc6a9cd(0xc2)});}return _0x2d4ecd['sort']((_0x128259,_0x12e036)=>_0x128259['room']['localeCompare'](_0x12e036['room']));}async function updateSchedulePreview(_0x2d2fa4){const _0x2f6f90=a1_0x7aa3ad;if(!_0x2d2fa4[_0x2f6f90(0x85)][_0x2f6f90(0xfc)]||!_0x2d2fa4[_0x2f6f90(0x85)][_0x2f6f90(0x94)])return;let _0x280526={};try{const _0x915c10=await _0x2d2fa4[_0x2f6f90(0xe0)]('analysis.energy.warmupTimes');if(_0x915c10&&_0x915c10['val'])_0x280526=JSON['parse'](_0x915c10[_0x2f6f90(0xf6)]);}catch(_0xf9338d){}const _0x260331=[],_0x1e3960=Date[_0x2f6f90(0x9c)](),_0x561308=0x30*0x3c*0x3c*0x3e8;try{const _0x3a0612=await _0x2d2fa4['getForeignStateAsync'](_0x2d2fa4[_0x2f6f90(0x85)]['calendarInstance']+_0x2f6f90(0xf0));if(!_0x3a0612||!_0x3a0612[_0x2f6f90(0xf6)])return;const _0x3b9855=JSON[_0x2f6f90(0x88)](_0x3a0612[_0x2f6f90(0xf6)]),_0x4f9044=_0x2d2fa4['config'][_0x2f6f90(0x114)]||[],_0xce4640=_0x2d2fa4[_0x2f6f90(0x85)]['devices']||[],_0x5c161a=new Set();_0xce4640[_0x2f6f90(0xd3)](_0x2eddad=>{if(_0x2eddad['location'])_0x5c161a['add'](_0x2eddad['location']);});for(const _0xdadfaf of _0x3b9855){if(_0xdadfaf[_0x2f6f90(0xb6)]&&_0x4f9044[_0x2f6f90(0x8d)]>0x0&&!_0x4f9044['includes'](_0xdadfaf[_0x2f6f90(0xb6)]))continue;const _0x2007eb=_0xdadfaf[_0x2f6f90(0xc0)]||_0xdadfaf[_0x2f6f90(0x106)]||_0xdadfaf[_0x2f6f90(0xef)];if(!_0x2007eb)continue;const _0x5b87a0=new Date(_0x2007eb),_0x497a2d=_0x5b87a0[_0x2f6f90(0xd2)]();if(isNaN(_0x497a2d))continue;if(_0x497a2d<_0x1e3960)continue;if(_0x497a2d>_0x1e3960+_0x561308)continue;const _0x989c84=(_0xdadfaf[_0x2f6f90(0x8a)]||_0xdadfaf[_0x2f6f90(0xc5)]||'')[_0x2f6f90(0xdd)]();let _0x33f1fd=![],_0x90705a=[],_0x1e8edc=_0xdadfaf[_0x2f6f90(0x8a)]||_0xdadfaf[_0x2f6f90(0xc5)]||_0x2f6f90(0x9b);if(_0x989c84[_0x2f6f90(0x118)](_0x2f6f90(0x7c))||_0x989c84[_0x2f6f90(0x118)]('r√ºckkehr')||_0x989c84['includes'](_0x2f6f90(0x10a)))_0x33f1fd=!![],_0x90705a=Array[_0x2f6f90(0x102)](_0x5c161a);else for(const _0x49ac6c of _0x5c161a){if(_0x989c84[_0x2f6f90(0x118)](_0x49ac6c[_0x2f6f90(0xdd)]()))_0x90705a[_0x2f6f90(0x8e)](_0x49ac6c);}_0x90705a[_0x2f6f90(0x8d)]>0x0&&_0x90705a['forEach'](_0x2119a6=>{const _0x48a549=_0x2f6f90;let _0x26770f=0x3c;if(_0x33f1fd){let _0x599c1e=0x0;Object[_0x48a549(0xc8)](_0x280526)[_0x48a549(0xd3)](_0x1c3463=>{if(_0x1c3463>_0x599c1e)_0x599c1e=_0x1c3463;}),_0x26770f=_0x599c1e>0x0?_0x599c1e:0x78;}else _0x26770f=_0x280526[_0x2119a6]||0x3c;const _0xdc0082=new Date(_0x497a2d-_0x26770f*0xea60);_0x260331[_0x48a549(0x8e)]({'eventTime':_0x497a2d,'triggerTime':_0xdc0082[_0x48a549(0xd2)](),'room':_0x2119a6,'minutes':_0x26770f,'reason':_0x1e8edc,'isGlobal':_0x33f1fd});});}}catch(_0x397e5f){}_0x260331[_0x2f6f90(0xe3)]((_0x4ef7d8,_0x1a0994)=>_0x4ef7d8[_0x2f6f90(0xae)]-_0x1a0994[_0x2f6f90(0xae)]);const _0x5028d5=_0x260331[_0x2f6f90(0xa4)](0x0,0x5);await _0x2d2fa4[_0x2f6f90(0xfa)](_0x2f6f90(0xf5),{'val':JSON['stringify'](_0x5028d5),'ack':!![]});}function a1_0x2a90(_0x549843,_0xfe3ae1){const _0x407410=a1_0x4c34();return a1_0x2a90=function(_0x285118,_0x19ed55){_0x285118=_0x285118-0x7c;let _0x4c347e=_0x407410[_0x285118];return _0x4c347e;},a1_0x2a90(_0x549843,_0xfe3ae1);}async function checkCalendarTriggers(_0x235719){const _0x42d75e=a1_0x7aa3ad;if(!_0x235719['config'][_0x42d75e(0xfc)]||!_0x235719[_0x42d75e(0x85)][_0x42d75e(0x94)])return;await updateSchedulePreview(_0x235719);let _0x55c5ad={},_0x1541ee={};try{const _0x1759eb=await _0x235719['getStateAsync'](_0x42d75e(0xd7));if(_0x1759eb&&_0x1759eb[_0x42d75e(0xf6)])_0x55c5ad=JSON[_0x42d75e(0x88)](_0x1759eb['val']);const _0x25bb23=await _0x235719['getStateAsync'](_0x42d75e(0xdb));if(_0x25bb23&&_0x25bb23[_0x42d75e(0xf6)])_0x1541ee=JSON[_0x42d75e(0x88)](_0x25bb23['val']);}catch(_0x75cc99){}let _0x2b4d11={'default':0x15};try{const _0x54190f=await _0x235719[_0x42d75e(0xe0)](_0x42d75e(0x99));if(_0x54190f&&_0x54190f[_0x42d75e(0xf6)])_0x2b4d11=JSON[_0x42d75e(0x88)](_0x54190f['val']);}catch(_0x416aa2){}try{const _0x325b54=await _0x235719[_0x42d75e(0xd4)](_0x235719[_0x42d75e(0x85)][_0x42d75e(0x94)]+_0x42d75e(0xf0));if(!_0x325b54||!_0x325b54[_0x42d75e(0xf6)])return;const _0x26156a=JSON[_0x42d75e(0x88)](_0x325b54[_0x42d75e(0xf6)]),_0x4215bf=Date['now'](),_0x2ba83b=_0x235719['config']['devices']||[],_0x34226d=_0x235719[_0x42d75e(0x85)][_0x42d75e(0x114)]||[];for(const _0xd49ed2 of _0x26156a){if(_0xd49ed2[_0x42d75e(0xb6)]&&_0x34226d[_0x42d75e(0x8d)]>0x0&&!_0x34226d['includes'](_0xd49ed2[_0x42d75e(0xb6)]))continue;const _0x45e238=_0xd49ed2[_0x42d75e(0xc0)]||_0xd49ed2[_0x42d75e(0x106)]||_0xd49ed2[_0x42d75e(0xef)];if(!_0x45e238)continue;const _0x4bc170=new Date(_0x45e238);if(isNaN(_0x4bc170[_0x42d75e(0xd2)]()))continue;const _0x32c497=(_0xd49ed2[_0x42d75e(0x8a)]||_0xd49ed2[_0x42d75e(0xc5)]||'')[_0x42d75e(0xdd)]();if(_0x32c497[_0x42d75e(0x118)](_0x42d75e(0x7c))||_0x32c497[_0x42d75e(0x118)](_0x42d75e(0xa0))||_0x32c497[_0x42d75e(0x118)](_0x42d75e(0x10a))){let _0x189b04=0x0;Object[_0x42d75e(0xc8)](_0x55c5ad)[_0x42d75e(0xd3)](_0x145932=>{if(_0x145932>_0x189b04)_0x189b04=_0x145932;});if(_0x189b04===0x0)_0x189b04=0x78;const _0x48d4af=_0x4bc170[_0x42d75e(0xd2)]()-_0x189b04*0xea60;_0x4215bf>=_0x48d4af&&_0x4215bf<_0x4bc170['getTime']()&&(_0x235719['currentSystemMode']!==_0x42d75e(0x112)&&(_0x235719['log']['info'](_0x42d75e(0xfe)+_0x189b04+_0x42d75e(0xca)),await _0x235719[_0x42d75e(0xfa)](_0x42d75e(0xb9),{'val':'normal','ack':![]})));}for(const _0x12ab24 of _0x2ba83b){if(_0x12ab24[_0x42d75e(0x9e)]){const _0x5d43a5=_0x12ab24[_0x42d75e(0x9e)][_0x42d75e(0xdd)]();if(_0x32c497['includes'](_0x5d43a5)){const _0x32616d=_0x55c5ad[_0x12ab24[_0x42d75e(0x9e)]]||0x3c,_0x5c3547=_0x1541ee[_0x12ab24[_0x42d75e(0x9e)]]||_0x42d75e(0xb5),_0x142072=_0x4bc170[_0x42d75e(0xd2)]()-_0x32616d*0xea60;if(_0x4215bf>=_0x142072&&_0x4215bf<_0x4bc170['getTime']()){const _0x49d70e=lastActions[_0x42d75e(0x93)+_0x12ab24[_0x42d75e(0x9e)]];if(_0x49d70e&&_0x4215bf-_0x49d70e<CAL_COOLDOWN_MS)continue;const _0x15533f=await findRelatedId(_0x235719,_0x12ab24['id'],_0x42d75e(0x8b));if(_0x15533f){let _0x55f8fa=_0x2b4d11[_0x12ab24[_0x42d75e(0x9e)]];if(_0x55f8fa===undefined)_0x55f8fa=_0x2b4d11[_0x42d75e(0xec)];if(_0x55f8fa===undefined)_0x55f8fa=0x15;const _0x3047cd=await _0x235719[_0x42d75e(0xd4)](_0x15533f);_0x3047cd&&typeof _0x3047cd[_0x42d75e(0xf6)]===_0x42d75e(0x81)&&_0x3047cd[_0x42d75e(0xf6)]<_0x55f8fa-0.5&&(_0x235719['log'][_0x42d75e(0xb1)](_0x42d75e(0x91)+_0x5c3547+_0x42d75e(0xce)+_0x12ab24[_0x42d75e(0x9e)]+_0x42d75e(0xc6)+_0x55f8fa+_0x42d75e(0xcb)+_0x32616d+_0x42d75e(0xca)),await _0x235719['setForeignStateAsync'](_0x15533f,_0x55f8fa),await logAutomationAction(_0x235719,'[CAL]\x20'+_0x12ab24['location']+_0x42d75e(0xbc)+_0x55f8fa+_0x42d75e(0xb7)+_0x5c3547+')'),lastActions['cal_'+_0x12ab24[_0x42d75e(0x9e)]]=_0x4215bf);}}}}}}}catch(_0x31c379){_0x235719[_0x42d75e(0x115)]['warn'](_0x42d75e(0xc4)+_0x31c379['message']);}}async function manageMpcIntervention(_0x404764,_0x2380a0,_0x1847bb){const _0x2fb1e1=a1_0x7aa3ad;try{const _0xcf9c34=_0x2fb1e1(0xa1),_0x5b879e=await _0x404764['getStateAsync'](_0xcf9c34);let _0x149e67=[];if(_0x5b879e&&_0x5b879e['val'])try{_0x149e67=JSON[_0x2fb1e1(0x88)](_0x5b879e[_0x2fb1e1(0xf6)]);}catch(_0x5c018b){}const _0x37b641=_0x149e67[_0x2fb1e1(0xcc)](_0x2380a0);if(_0x1847bb===_0x2fb1e1(0xe6))_0x37b641===-0x1&&(_0x149e67[_0x2fb1e1(0x8e)](_0x2380a0),await _0x404764[_0x2fb1e1(0xfa)](_0xcf9c34,{'val':JSON['stringify'](_0x149e67),'ack':!![]}));else _0x1847bb===_0x2fb1e1(0xdf)&&(_0x37b641!==-0x1&&(_0x149e67[_0x2fb1e1(0x82)](_0x37b641,0x1),await _0x404764[_0x2fb1e1(0xfa)](_0xcf9c34,{'val':JSON[_0x2fb1e1(0x10e)](_0x149e67),'ack':!![]})));}catch(_0xc5dba1){}}async function cleanupGhostInterventions(_0xd4831d){const _0x4616a9=a1_0x7aa3ad;try{const _0x187803=_0x4616a9(0xa1),_0x518610=await _0xd4831d['getStateAsync'](_0x187803);if(!_0x518610||!_0x518610['val'])return;const _0x5c6048=JSON['parse'](_0x518610[_0x4616a9(0xf6)]);if(!Array['isArray'](_0x5c6048)||_0x5c6048[_0x4616a9(0x8d)]===0x0)return;const _0x2c16c8=_0xd4831d[_0x4616a9(0x85)][_0x4616a9(0x119)]||[];let _0x48f0b2=![];for(let _0x4ded5c=_0x5c6048['length']-0x1;_0x4ded5c>=0x0;_0x4ded5c--){const _0x444458=_0x5c6048[_0x4ded5c],_0x968e11=_0x2c16c8['find'](_0x1ce1c9=>normalize(_0x1ce1c9[_0x4616a9(0x9e)])===normalize(_0x444458)&&(_0x1ce1c9[_0x4616a9(0xf9)]===_0x4616a9(0xde)||_0x1ce1c9[_0x4616a9(0xf9)]==='thermostat'));if(_0x968e11){const _0x4709f6=await findRelatedId(_0xd4831d,_0x968e11['id'],_0x4616a9(0x8b));if(_0x4709f6){const _0x403185=await _0xd4831d[_0x4616a9(0xd4)](_0x4709f6);_0x403185&&typeof _0x403185[_0x4616a9(0xf6)]===_0x4616a9(0x81)&&(Math[_0x4616a9(0xb2)](_0x403185['val']-ECO_TEMP)>0.5&&(_0xd4831d[_0x4616a9(0x115)][_0x4616a9(0xb1)](_0x4616a9(0xe2)+_0x444458+_0x4616a9(0xe7)+_0x403185[_0x4616a9(0xf6)]+'¬∞C\x20(nicht\x20'+ECO_TEMP+_0x4616a9(0xc7)),_0x5c6048[_0x4616a9(0x82)](_0x4ded5c,0x1),_0x48f0b2=!![]));}}}_0x48f0b2&&await _0xd4831d[_0x4616a9(0xfa)](_0x187803,{'val':JSON[_0x4616a9(0x10e)](_0x5c6048),'ack':!![]});}catch(_0x59d42c){}}function a1_0x4c34(){const _0x4bab13=['consultButler','valveMapping','from','1175778JMqTEs','Auto-Erkennung','ist','eventStart','current_heating_setpoint','unshift','set','ankunft','target','(((.+)+)+)+$','split','stringify','SET','toString','trim','normal','entries','calendarSelection','log','join','warn','includes','devices','thermostatMapping','urlaub\x20ende','110WWPqTw','openknx','stellwert','search','number','splice','Unknown','\x20->\x20Schalte\x20','config','[MPC\x20WARNING]\x20Kein\x20Setpoint\x20f√ºr\x20','actual','parse','state','event','setpoint','./ai_agent','length','push','constructor','95808MOtWuP','üìÖ\x20SMART\x20SCHEDULE\x20[','840501Fjijqs','cal_','calendarInstance','dimmer','.1.SET_POINT_TEMPERATURE','reason','Nicht\x20gefunden','analysis.energy.warmupTargets','off','Unbekannt','now','Soll','location','analysis.automation.actionLog','r√ºckkehr','analysis.energy.mpcActiveInterventions','value.valve','mpc_','slice','find','target_temperature','local_temperature','toUpperCase','1803725vgJMCJ','valve','16HqIJGF','.4.VALVE_STATE','ACTUAL','triggerTime','role','room','info','abs',':\x20Aufheizen\x20auf\x20','SET_POINT_TEMPERATURE','Classic','_calName','¬∞C\x20(via\x20','[MPC]\x20','system.mode','unit','filter','\x20->\x20','thermostat','name','analysis.automation.mode','_date','.1.ACTUAL_TEMPERATURE','Fehlt','minutes_safe','Calendar\x20Check\x20Error:\x20','summary','\x27\x20aktiv.\x20Heize\x20auf\x20','¬∞C).\x20Entferne\x20Status.','values','exports','\x20min).','¬∞C\x20(Vorlauf:\x20','indexOf','541110IBaLsj',']:\x20Raum-Trigger\x20\x27','level.valve',':\x20Absenkung\x20auf\x20','1271483ZdoFle','getTime','forEach','getForeignStateAsync','messwert','common','analysis.energy.warmupTimes','hm-rpc','sensor','string','analysis.energy.warmupSources','¬∞C!\x20(Puffer\x20leer).','toLowerCase','temperature','remove','getStateAsync','analysis.automation.confidenceThreshold','üßπ\x20[MPC\x20CLEANUP]\x20','sort','soll','analysis.automation.lastAction','add','\x20ist\x20auf\x20','occupied_heating_setpoint','.1.TEMPERATURE','light','level','default','.1.LEVEL','847uQQdpU','date','.data.table','replace','level.temperature','PERFECT','apply','analysis.energy.schedulePreview','val','setForeignStateAsync','2144872ltETQz','type','setStateAsync','Manuelles\x20Mapping','useCalendar','\x20auf\x20','üìÖ\x20SMART\x20SCHEDULE\x20(Phase):\x20\x27Globaler\x20Start\x27\x20erkannt.\x20Heize\x20Haus\x20auf\x20(Vorlauf:\x20','getForeignObjectAsync'];a1_0x4c34=function(){return _0x4bab13;};return a1_0x4c34();}async function applyEnergySavings(_0x38a306,_0x2e1a5d){const _0x127cb2=a1_0x7aa3ad;await cleanupGhostInterventions(_0x38a306);if(!_0x2e1a5d||_0x2e1a5d[_0x127cb2(0x8d)]===0x0)return;const _0x4f667f=_0x38a306[_0x127cb2(0x85)]['devices']||[],_0x5eb586=Date[_0x127cb2(0x9c)]();for(const _0xc5fe10 of _0x2e1a5d){const _0x3c038d=_0xc5fe10[_0x127cb2(0xb0)],_0x18e072=_0xc5fe10[_0x127cb2(0xc3)],_0x18ab4a=_0xc5fe10[_0x127cb2(0x10b)]||0x15,_0x46871d=_0x4f667f[_0x127cb2(0xa5)](_0xc0b6ea=>normalize(_0xc0b6ea['location'])===normalize(_0x3c038d)&&(_0xc0b6ea[_0x127cb2(0xf9)]===_0x127cb2(0xde)||_0xc0b6ea[_0x127cb2(0xf9)]===_0x127cb2(0xbd)));if(!_0x46871d)continue;const _0x27564d=await findRelatedId(_0x38a306,_0x46871d['id'],_0x127cb2(0x8b));if(_0x27564d){if(lastActions[_0x127cb2(0xa3)+_0x3c038d]&&_0x5eb586-lastActions[_0x127cb2(0xa3)+_0x3c038d]<0x1e*0x3c*0x3e8)continue;const _0x26a0dc=await _0x38a306['getForeignStateAsync'](_0x27564d);if(_0x26a0dc&&typeof _0x26a0dc[_0x127cb2(0xf6)]===_0x127cb2(0x81)){const _0x38f67e=_0x26a0dc[_0x127cb2(0xf6)];_0x38f67e!==ECO_TEMP&&await manageMpcIntervention(_0x38a306,_0x3c038d,'remove');if(_0x18e072>0x1e)_0x38f67e>ECO_TEMP+0.5&&(_0x38a306[_0x127cb2(0x115)]['info']('üçÉ\x20[MPC\x20ACTION]\x20Senke\x20'+_0x3c038d+_0x127cb2(0xfd)+ECO_TEMP+'¬∞C!\x20(Puffer:\x20'+_0x18e072+'\x20min)'),await _0x38a306[_0x127cb2(0xf7)](_0x27564d,ECO_TEMP),await manageMpcIntervention(_0x38a306,_0x3c038d,_0x127cb2(0xe6)),lastActions['mpc_'+_0x3c038d]=_0x5eb586,await logAutomationAction(_0x38a306,_0x127cb2(0xb8)+_0x3c038d+_0x127cb2(0xd0)+ECO_TEMP+'¬∞C'));else _0x18e072<=0xf&&(_0x38f67e<_0x18ab4a&&(_0x38a306[_0x127cb2(0x115)][_0x127cb2(0xb1)]('üî•\x20[MPC\x20ACTION]\x20Heize\x20'+_0x3c038d+'\x20wieder\x20auf\x20'+_0x18ab4a+_0x127cb2(0xdc)),await _0x38a306['setForeignStateAsync'](_0x27564d,_0x18ab4a),await manageMpcIntervention(_0x38a306,_0x3c038d,_0x127cb2(0xdf)),lastActions['mpc_'+_0x3c038d]=_0x5eb586,await logAutomationAction(_0x38a306,_0x127cb2(0xb8)+_0x3c038d+_0x127cb2(0xb3)+_0x18ab4a+'¬∞C')));}}else _0x38a306[_0x127cb2(0x115)][_0x127cb2(0x117)](_0x127cb2(0x86)+_0x3c038d+'\x20gefunden!');}}module[a1_0x7aa3ad(0xc9)]={'handlePrediction':handlePrediction,'applyEnergySavings':applyEnergySavings,'scanThermostats':scanThermostats,'checkCalendarTriggers':checkCalendarTriggers,'updateSchedulePreview':updateSchedulePreview};