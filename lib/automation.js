const a1_0x369fd1=a1_0x195a;(function(_0x9ab43,_0x53370a){const _0x316fe8=a1_0x195a,_0x5d2ba1=_0x9ab43();while(!![]){try{const _0x16559=-parseInt(_0x316fe8(0x10a))/0x1*(-parseInt(_0x316fe8(0x191))/0x2)+-parseInt(_0x316fe8(0x116))/0x3*(parseInt(_0x316fe8(0x192))/0x4)+-parseInt(_0x316fe8(0x18b))/0x5+parseInt(_0x316fe8(0x13e))/0x6+-parseInt(_0x316fe8(0x1a6))/0x7*(parseInt(_0x316fe8(0x18c))/0x8)+parseInt(_0x316fe8(0x16d))/0x9*(parseInt(_0x316fe8(0x171))/0xa)+-parseInt(_0x316fe8(0x15b))/0xb;if(_0x16559===_0x53370a)break;else _0x5d2ba1['push'](_0x5d2ba1['shift']());}catch(_0x31e375){_0x5d2ba1['push'](_0x5d2ba1['shift']());}}}(a1_0x2d09,0x58d08));const a1_0x32ff4d=(function(){let _0x2bf0ef=!![];return function(_0x480600,_0x1ed6cf){const _0x2dfa31=_0x2bf0ef?function(){const _0x20b47c=a1_0x195a;if(_0x1ed6cf){const _0x1379f9=_0x1ed6cf[_0x20b47c(0x1a9)](_0x480600,arguments);return _0x1ed6cf=null,_0x1379f9;}}:function(){};return _0x2bf0ef=![],_0x2dfa31;};}()),a1_0x1680d2=a1_0x32ff4d(this,function(){const _0x52b5c2=a1_0x195a;return a1_0x1680d2[_0x52b5c2(0x128)]()[_0x52b5c2(0x1a8)]('(((.+)+)+)+$')[_0x52b5c2(0x128)]()[_0x52b5c2(0x13a)](a1_0x1680d2)[_0x52b5c2(0x1a8)](_0x52b5c2(0x136));});a1_0x1680d2();'use strict';const aiAgent=require(a1_0x369fd1(0x169)),COOLDOWN_MS=0x3c*0x3e8,CAL_COOLDOWN_MS=0x5a*0x3c*0x3e8,RESCUE_LOCK_MS=0x78*0x3c*0x3e8,ECO_TEMP=0x11,lastActions={};function a1_0x2d09(){const _0x15e148=['.1.LEVEL','\x20gefunden!','analysis.energy.schedulePreview','¬∞C\x20<\x20','active','unit','getForeignObjectsAsync','setForeignStateAsync','type','config','number','off','toString','consultButler','.1.TEMPERATURE','valve','¬∞C).\x20Sparmodus\x20beendet!','exports','.4.SET_TEMPERATURE',':\x20Puffer\x20leer\x20->\x20Heizen\x20auf\x20','temperature','¬∞C\x20(Vorlauf:\x20','SET','value.valve','date','default','(((.+)+)+)+$','split','analysis.energy.mpcActiveInterventions','sensor','constructor','getForeignObjectAsync','Pr√§diktion:\x20','ankunft','553638BaAOxd','find','filter','.1.ACTUAL_TEMPERATURE','values','summary','cal_','ACTUAL_TEMPERATURE','add','val','state','[WATCHDOG]\x20','getTime','SET_POINT_TEMPERATURE','Unbekannt','¬∞C\x20(nicht\x20','approved','room','.1.SET_POINT_TEMPERATURE','string','target','position','TRAIN_RL_PENALTY','info','ist','switch','now','analysis.automation.actionLog','\x20min)','1777446bhUhXm','analysis.energy.warmupTargets','üìÖ\x20SMART\x20SCHEDULE\x20[','calendarSelection','toUpperCase','localeCompare','eventStart','common','üìÖ\x20SMART\x20SCHEDULE\x20(Phase):\x20\x27Globaler\x20Start\x27\x20erkannt.\x20Heize\x20Haus\x20auf\x20(Vorlauf:\x20','manual','message','analysis.energy.warmupSources','setpoint','stringify','./ai_agent','entries','getStateAsync','length','4547943BECuFt','hm-rpc','sendToPythonWrapper','\x20ist\x20zu\x20kalt,\x20ABER\x20Fenster\x20offen/L√ºftung\x20erkannt.\x20Heize\x20NICHT,\x20entferne\x20nur\x20Status.','10cGGRJP','name','.data.table','parse','\x20min).','getForeignStateAsync','üìÖ\x20[MPC\x20INFO]\x20','minutes_safe','warn','[MPC\x20WARNING]\x20Kein\x20Setpoint\x20f√ºr\x20','location','open','analysis.energy.ventilationAlerts','messwert','\x27\x20hat\x20kein\x20Ger√§t\x20mehr.\x20L√∂sche\x20Eintrag.','splice','_date',']:\x20Raum-Trigger\x20\x27','normal','valveMapping','isArray','¬∞C!\x20(Puffer\x20leer).','analysis.automation.confidenceThreshold','analysis.automation.mode','.4.VALVE_STATE','thermostat','393215CQeGhc','367624ZaxOfs','\x20durch\x20Kalender\x20ge√§ndert.\x20Keine\x20RL-Strafe.','devices','sort','remove','737762thmUZP','541124lNjslw','rescue_','stellwert','log','urlaub\x20ende','reason','target_temperature','\x27\x20aktiv.\x20Heize\x20auf\x20',':\x20Absenkung\x20auf\x20','üö®\x20[MPC\x20WATCHDOG]\x20','pi_heating_demand','Auto-Erkennung','toLowerCase','contact','local_temperature','system.mode','PERFECT','setStateAsync','soll','event','14xnUZMo','\x20->\x20Schalte\x20','search','apply','Manuelles\x20Mapping','Nicht\x20gefunden','current_heating_setpoint','thermostatMapping','üßπ\x20[MPC\x20CLEANUP]\x20','Unknown','score','calendarInstance','[MPC]\x20','replace','useCalendar','level','¬∞C).\x20Entferne\x20Status.','includes','set','Classic','occupied_heating_setpoint','level.temperature','\x20erreicht\x20Limit\x20(','\x20ist\x20auf\x20','\x20wieder\x20auf\x20','1xvuGUB','triggerTime','¬∞C!\x20(Puffer:\x20','analysis.energy.warmupTimes','mpc_','actual','openknx','write','forEach','\x20auf\x20','too_cold','abs','6KoDcyv','temp','push','slice','Calendar\x20Check\x20Error:\x20','_calName'];a1_0x2d09=function(){return _0x15e148;};return a1_0x2d09();}function normalize(_0x34bb01){const _0x201feb=a1_0x369fd1;if(!_0x34bb01)return'';return _0x34bb01[_0x201feb(0x19e)]()[_0x201feb(0xfe)](/\s+/g,'')['trim']();}async function logAutomationAction(_0x374223,_0x353607){const _0x24c8a2=a1_0x369fd1;await _0x374223[_0x24c8a2(0x1a3)]('analysis.automation.lastAction',{'val':_0x353607,'ack':!![]});try{const _0x5e3e99=_0x24c8a2(0x159),_0x413055=await _0x374223[_0x24c8a2(0x16b)](_0x5e3e99);let _0x1f6d20=[];if(_0x413055&&_0x413055[_0x24c8a2(0x147)])try{_0x1f6d20=JSON[_0x24c8a2(0x174)](_0x413055[_0x24c8a2(0x147)]);}catch(_0xca060a){}_0x1f6d20['unshift']({'ts':Date[_0x24c8a2(0x158)](),'msg':_0x353607});if(_0x1f6d20['length']>0x32)_0x1f6d20=_0x1f6d20[_0x24c8a2(0x119)](0x0,0x32);await _0x374223[_0x24c8a2(0x1a3)](_0x5e3e99,{'val':JSON[_0x24c8a2(0x168)](_0x1f6d20),'ack':!![]});}catch(_0x1f9b32){}}async function handlePrediction(_0x4a303e,_0x3f533a,_0x747ff){const _0x3d89f1=a1_0x369fd1;if(!_0x3f533a||_0x3f533a===_0x3d89f1(0x1af))return;let _0x7490d7=_0x3d89f1(0x127),_0x1fb195=0.6;try{const _0x12449f=await _0x4a303e[_0x3d89f1(0x16b)](_0x3d89f1(0x188));if(_0x12449f&&_0x12449f[_0x3d89f1(0x147)])_0x7490d7=_0x12449f[_0x3d89f1(0x147)];const _0x5e17d8=await _0x4a303e[_0x3d89f1(0x16b)](_0x3d89f1(0x187));if(_0x5e17d8&&_0x5e17d8[_0x3d89f1(0x147)])_0x1fb195=_0x5e17d8[_0x3d89f1(0x147)];}catch(_0x9e986c){}if(_0x7490d7===_0x3d89f1(0x127)||_0x747ff<_0x1fb195)return;const _0x1bc491=Date[_0x3d89f1(0x158)]();if(lastActions[_0x3f533a]&&_0x1bc491-lastActions[_0x3f533a]<COOLDOWN_MS)return;const _0xdc5025=_0x4a303e[_0x3d89f1(0x125)]['devices']||[],_0x5d8160=normalize(_0x3f533a),_0xd5d05b=_0xdc5025[_0x3d89f1(0x13f)](_0x1f2cdd=>normalize(_0x1f2cdd[_0x3d89f1(0x17b)])===_0x5d8160&&(_0x1f2cdd['type']==='light'||_0x1f2cdd[_0x3d89f1(0x124)]==='dimmer'||_0x1f2cdd[_0x3d89f1(0x124)]===_0x3d89f1(0x157)));if(!_0xd5d05b)return;const _0x5bbcb9=await aiAgent[_0x3d89f1(0x129)](_0x4a303e,_0x3f533a,_0xd5d05b['name'],_0x747ff);if(!_0x5bbcb9[_0x3d89f1(0x14e)])return;const _0x4717b0=_0x3d89f1(0x13c)+_0x3f533a+_0x3d89f1(0x1a7)+_0xd5d05b[_0x3d89f1(0x172)]+'\x20('+_0x5bbcb9[_0x3d89f1(0x197)]+')';await logAutomationAction(_0x4a303e,'['+_0x7490d7[_0x3d89f1(0x15f)]()+']\x20'+_0x4717b0);if(_0x7490d7===_0x3d89f1(0x120)){const _0x3a4a53=await _0x4a303e[_0x3d89f1(0x176)](_0xd5d05b['id']);(!_0x3a4a53||!_0x3a4a53['val']&&_0x3a4a53['val']!==!![])&&await _0x4a303e[_0x3d89f1(0x123)](_0xd5d05b['id'],!![]),lastActions[_0x3f533a]=_0x1bc491;}}async function findRelatedId(_0x1d0708,_0xce1850,_0x4fbc62='setpoint'){const _0x4a301c=a1_0x369fd1;if(_0x4fbc62===_0x4a301c(0x167)&&_0x1d0708[_0x4a301c(0x125)][_0x4a301c(0x1ad)]){let _0x5d17c4=_0x1d0708[_0x4a301c(0x125)][_0x4a301c(0x1ad)];if(typeof _0x5d17c4===_0x4a301c(0x151))try{_0x5d17c4=JSON['parse'](_0x5d17c4);}catch(_0x4f4808){}if(_0x5d17c4&&_0x5d17c4[_0xce1850])return _0x5d17c4[_0xce1850];}if(_0x4fbc62===_0x4a301c(0x12b)&&_0x1d0708[_0x4a301c(0x125)][_0x4a301c(0x184)]){let _0x494cf8=_0x1d0708[_0x4a301c(0x125)][_0x4a301c(0x184)];if(typeof _0x494cf8===_0x4a301c(0x151))try{_0x494cf8=JSON['parse'](_0x494cf8);}catch(_0xcc4537){}if(_0x494cf8&&_0x494cf8[_0xce1850])return _0x494cf8[_0xce1850];}let _0x52ca86=[];if(_0x4fbc62===_0x4a301c(0x167))_0x52ca86=[{'s':_0x4a301c(0x141),'t':_0x4a301c(0x150)},{'s':_0x4a301c(0x12a),'t':_0x4a301c(0x150)},{'s':_0x4a301c(0x12a),'t':_0x4a301c(0x12e)},{'s':_0x4a301c(0x145),'t':_0x4a301c(0x14b)},{'s':_0x4a301c(0x1a0),'t':_0x4a301c(0x105)},{'s':_0x4a301c(0x1a0),'t':_0x4a301c(0x1ac)},{'s':_0x4a301c(0x130),'t':_0x4a301c(0x198)},{'s':'ACTUAL','t':_0x4a301c(0x132)},{'s':'Ist','t':'Soll'},{'s':_0x4a301c(0x130),'t':_0x4a301c(0x167)}];else _0x4fbc62===_0x4a301c(0x12b)&&(_0x52ca86=[{'s':_0x4a301c(0x141),'t':'.1.LEVEL'},{'s':'.1.TEMPERATURE','t':_0x4a301c(0x11c)},{'s':'.1.TEMPERATURE','t':_0x4a301c(0x189)},{'s':_0x4a301c(0x1a0),'t':_0x4a301c(0x19c)},{'s':'temperature','t':'valve_position'},{'s':_0x4a301c(0x130),'t':_0x4a301c(0x100)}]);for(const _0x1afbd6 of _0x52ca86){if(_0xce1850['includes'](_0x1afbd6['s'])){const _0x17e4df=_0xce1850[_0x4a301c(0xfe)](_0x1afbd6['s'],_0x1afbd6['t']),_0x3e1d09=await _0x1d0708[_0x4a301c(0x13b)](_0x17e4df);if(_0x3e1d09)return _0x17e4df;}}try{const _0x4480c7=_0xce1850[_0x4a301c(0x137)]('.');if(_0x4480c7[_0x4a301c(0x16c)]>0x2){const _0x13c2b4=_0x4480c7['slice'](0x0,-0x1)['join']('.'),_0x2b95ff=await _0x1d0708[_0x4a301c(0x122)](_0x13c2b4+'.*'),_0x44318a=[],_0x46c86d=_0xce1850[_0x4a301c(0x137)](/[._]+/)[_0x4a301c(0x140)](_0x183fb3=>![_0x4a301c(0x110),'0',_0x4a301c(0x16e),_0x4a301c(0x156),'wert',_0x4a301c(0x130),_0x4a301c(0x10f),'sensor',_0x4a301c(0x17e),_0x4a301c(0x148)][_0x4a301c(0x102)](_0x183fb3[_0x4a301c(0x19e)]()));for(const [_0x221040,_0x410217]of Object[_0x4a301c(0x16a)](_0x2b95ff)){if(_0x221040===_0xce1850)continue;if(_0x410217&&_0x410217[_0x4a301c(0x162)]){const _0x52e6ba=_0x221040['toLowerCase'](),_0x1ca6de=(_0x410217[_0x4a301c(0x162)]['role']||'')[_0x4a301c(0x19e)](),_0x26efad=(_0x410217[_0x4a301c(0x162)][_0x4a301c(0x121)]||'')[_0x4a301c(0x19e)]();let _0x11d482=![];if(_0x4fbc62==='setpoint'&&_0x410217[_0x4a301c(0x162)][_0x4a301c(0x111)]===!![])_0x11d482=_0x52e6ba[_0x4a301c(0x102)](_0x4a301c(0x103))||_0x52e6ba['includes'](_0x4a301c(0x1a4))||_0x52e6ba[_0x4a301c(0x102)](_0x4a301c(0x152))||_0x1ca6de[_0x4a301c(0x102)](_0x4a301c(0x106))||_0x1ca6de['includes']('thermostat.setpoint');else _0x4fbc62==='valve'&&(_0x11d482=_0x52e6ba[_0x4a301c(0x102)](_0x4a301c(0x100))||_0x52e6ba[_0x4a301c(0x102)](_0x4a301c(0x12b))||_0x52e6ba[_0x4a301c(0x102)](_0x4a301c(0x194))||_0x52e6ba[_0x4a301c(0x102)](_0x4a301c(0x153))||_0x1ca6de[_0x4a301c(0x102)]('level.valve')||_0x1ca6de['includes'](_0x4a301c(0x133))||_0x26efad[_0x4a301c(0x102)]('%'));if(_0x11d482){const _0x67afe9=_0x221040[_0x4a301c(0x137)](/[._]+/)['map'](_0x4e8c40=>_0x4e8c40[_0x4a301c(0x19e)]());let _0x420b77=0x0;_0x46c86d[_0x4a301c(0x112)](_0x289198=>{const _0x117aff=_0x4a301c;if(_0x67afe9[_0x117aff(0x102)](_0x289198[_0x117aff(0x19e)]()))_0x420b77++;}),_0x44318a[_0x4a301c(0x118)]({'id':_0x221040,'score':_0x420b77});}}}if(_0x44318a[_0x4a301c(0x16c)]>0x0){_0x44318a[_0x4a301c(0x18f)]((_0x2d50cf,_0x5c5cc3)=>_0x5c5cc3[_0x4a301c(0x1b0)]-_0x2d50cf[_0x4a301c(0x1b0)]);if(_0x44318a[0x0][_0x4a301c(0x1b0)]>0x0)return _0x44318a[0x0]['id'];}}}catch(_0x70d7bc){}return null;}async function scanThermostats(_0x45b55a){const _0x4c68e2=a1_0x369fd1,_0x3be57f=_0x45b55a['config'][_0x4c68e2(0x18e)]||[],_0xf1c386=[],_0x19ee0c=_0x3be57f[_0x4c68e2(0x140)](_0x861874=>_0x861874['id']&&_0x861874['id'][_0x4c68e2(0x102)](_0x4c68e2(0x130))||_0x861874[_0x4c68e2(0x124)]&&[_0x4c68e2(0x130),_0x4c68e2(0x18a),_0x4c68e2(0x139)][_0x4c68e2(0x102)](_0x861874[_0x4c68e2(0x124)])||_0x861874[_0x4c68e2(0x172)]&&_0x861874['name'][_0x4c68e2(0x19e)]()[_0x4c68e2(0x102)](_0x4c68e2(0x117)));for(const _0x50beaf of _0x19ee0c){const _0x584c38=await findRelatedId(_0x45b55a,_0x50beaf['id'],'setpoint'),_0x3e623b=await findRelatedId(_0x45b55a,_0x50beaf['id'],_0x4c68e2(0x12b));let _0x68cce4=_0x4c68e2(0x1ab),_0x18dc7f=![],_0x31f411=_0x45b55a[_0x4c68e2(0x125)][_0x4c68e2(0x1ad)]||{};if(typeof _0x31f411===_0x4c68e2(0x151))try{_0x31f411=JSON[_0x4c68e2(0x174)](_0x31f411);}catch(_0x2a1676){}let _0x2f3fc3=_0x45b55a['config'][_0x4c68e2(0x184)]||{};if(typeof _0x2f3fc3===_0x4c68e2(0x151))try{_0x2f3fc3=JSON[_0x4c68e2(0x174)](_0x2f3fc3);}catch(_0x200777){}if(_0x31f411[_0x50beaf['id']]&&_0x31f411[_0x50beaf['id']]===_0x584c38||_0x2f3fc3[_0x50beaf['id']]&&_0x2f3fc3[_0x50beaf['id']]===_0x3e623b)_0x68cce4=_0x4c68e2(0x1aa),_0x18dc7f=!![];else(_0x584c38||_0x3e623b)&&(_0x68cce4=_0x4c68e2(0x19d));_0xf1c386[_0x4c68e2(0x118)]({'room':_0x50beaf['location']||_0x4c68e2(0x14c),'sensorId':_0x50beaf['id'],'setpointId':_0x584c38||'-','valveId':_0x3e623b||'-','source':_0x68cce4,'isManual':_0x18dc7f,'status':_0x584c38&&_0x3e623b?_0x4c68e2(0x1a2):_0x584c38?'OK':'Fehlt'});}return _0xf1c386[_0x4c68e2(0x18f)]((_0x359612,_0x5e6fbf)=>_0x359612[_0x4c68e2(0x14f)][_0x4c68e2(0x160)](_0x5e6fbf['room']));}async function updateSchedulePreview(_0x1b7b95){const _0x2e175d=a1_0x369fd1;if(!_0x1b7b95[_0x2e175d(0x125)][_0x2e175d(0xff)]||!_0x1b7b95[_0x2e175d(0x125)][_0x2e175d(0x1b1)])return;let _0x4af768={};try{const _0xa7cb38=await _0x1b7b95[_0x2e175d(0x16b)](_0x2e175d(0x10d));if(_0xa7cb38&&_0xa7cb38[_0x2e175d(0x147)])_0x4af768=JSON[_0x2e175d(0x174)](_0xa7cb38['val']);}catch(_0x882a77){}const _0x27edff=[],_0x2e576b=Date[_0x2e175d(0x158)](),_0x483d67=0x30*0x3c*0x3c*0x3e8;try{const _0xbf4a68=await _0x1b7b95[_0x2e175d(0x176)](_0x1b7b95['config']['calendarInstance']+_0x2e175d(0x173));if(!_0xbf4a68||!_0xbf4a68[_0x2e175d(0x147)])return;const _0x20b279=JSON[_0x2e175d(0x174)](_0xbf4a68[_0x2e175d(0x147)]),_0x1d6f8b=_0x1b7b95[_0x2e175d(0x125)][_0x2e175d(0x15e)]||[],_0x2aedb8=_0x1b7b95[_0x2e175d(0x125)][_0x2e175d(0x18e)]||[],_0x485ac7=new Set();_0x2aedb8[_0x2e175d(0x112)](_0x347d5b=>{const _0x2e21ba=_0x2e175d;if(_0x347d5b[_0x2e21ba(0x17b)])_0x485ac7['add'](_0x347d5b[_0x2e21ba(0x17b)]);});for(const _0x35f61a of _0x20b279){if(_0x35f61a['_calName']&&_0x1d6f8b[_0x2e175d(0x16c)]>0x0&&!_0x1d6f8b[_0x2e175d(0x102)](_0x35f61a[_0x2e175d(0x11b)]))continue;const _0x584ab2=_0x35f61a[_0x2e175d(0x181)]||_0x35f61a[_0x2e175d(0x161)]||_0x35f61a['date'];if(!_0x584ab2)continue;const _0x537cbc=new Date(_0x584ab2),_0x5156f6=_0x537cbc['getTime']();if(isNaN(_0x5156f6))continue;if(_0x5156f6<_0x2e576b)continue;if(_0x5156f6>_0x2e576b+_0x483d67)continue;const _0xca1a28=(_0x35f61a[_0x2e175d(0x1a5)]||_0x35f61a['summary']||'')[_0x2e175d(0x19e)]();let _0x27b1e1=![],_0x44e28e=[],_0x1cd075=_0x35f61a[_0x2e175d(0x1a5)]||_0x35f61a[_0x2e175d(0x143)]||_0x2e175d(0x14c);if(_0xca1a28['includes'](_0x2e175d(0x196))||_0xca1a28['includes']('r√ºckkehr')||_0xca1a28[_0x2e175d(0x102)]('ankunft'))_0x27b1e1=!![],_0x44e28e=Array['from'](_0x485ac7);else for(const _0x9173e4 of _0x485ac7){if(_0xca1a28[_0x2e175d(0x102)](_0x9173e4[_0x2e175d(0x19e)]()))_0x44e28e[_0x2e175d(0x118)](_0x9173e4);}_0x44e28e['length']>0x0&&_0x44e28e['forEach'](_0x5d018f=>{const _0x5c07cc=_0x2e175d;let _0x12c584=0x3c;if(_0x27b1e1){let _0xf902ee=0x0;Object[_0x5c07cc(0x142)](_0x4af768)['forEach'](_0x505467=>{if(_0x505467>_0xf902ee)_0xf902ee=_0x505467;}),_0x12c584=_0xf902ee>0x0?_0xf902ee:0x78;}else _0x12c584=_0x4af768[_0x5d018f]||0x3c;const _0x4d4387=new Date(_0x5156f6-_0x12c584*0xea60);_0x27edff[_0x5c07cc(0x118)]({'eventTime':_0x5156f6,'triggerTime':_0x4d4387[_0x5c07cc(0x14a)](),'room':_0x5d018f,'minutes':_0x12c584,'reason':_0x1cd075,'isGlobal':_0x27b1e1});});}}catch(_0x3648c4){}_0x27edff[_0x2e175d(0x18f)]((_0x39393b,_0x385388)=>_0x39393b[_0x2e175d(0x10b)]-_0x385388[_0x2e175d(0x10b)]);const _0xef8fe4=_0x27edff['slice'](0x0,0x5);await _0x1b7b95[_0x2e175d(0x1a3)](_0x2e175d(0x11e),{'val':JSON[_0x2e175d(0x168)](_0xef8fe4),'ack':!![]});}async function checkCalendarTriggers(_0x4448f3){const _0x161b20=a1_0x369fd1;if(!_0x4448f3[_0x161b20(0x125)]['useCalendar']||!_0x4448f3[_0x161b20(0x125)][_0x161b20(0x1b1)])return;await updateSchedulePreview(_0x4448f3);let _0x4bb6db={},_0x54b601={};try{const _0x492aad=await _0x4448f3[_0x161b20(0x16b)](_0x161b20(0x10d));if(_0x492aad&&_0x492aad['val'])_0x4bb6db=JSON[_0x161b20(0x174)](_0x492aad['val']);const _0x4b9cf9=await _0x4448f3[_0x161b20(0x16b)](_0x161b20(0x166));if(_0x4b9cf9&&_0x4b9cf9[_0x161b20(0x147)])_0x54b601=JSON[_0x161b20(0x174)](_0x4b9cf9['val']);}catch(_0xa95f02){}let _0x433eab={'default':0x15};try{const _0x32f0a8=await _0x4448f3['getStateAsync'](_0x161b20(0x15c));if(_0x32f0a8&&_0x32f0a8[_0x161b20(0x147)])_0x433eab=JSON['parse'](_0x32f0a8[_0x161b20(0x147)]);}catch(_0x242e7e){}try{const _0x4c8c4e=await _0x4448f3[_0x161b20(0x176)](_0x4448f3[_0x161b20(0x125)][_0x161b20(0x1b1)]+_0x161b20(0x173));if(!_0x4c8c4e||!_0x4c8c4e[_0x161b20(0x147)])return;const _0x4a62dd=JSON['parse'](_0x4c8c4e[_0x161b20(0x147)]),_0x5e21c1=Date[_0x161b20(0x158)](),_0x169a70=_0x4448f3[_0x161b20(0x125)][_0x161b20(0x18e)]||[],_0x1ddf8b=_0x4448f3[_0x161b20(0x125)][_0x161b20(0x15e)]||[];for(const _0x42e4d1 of _0x4a62dd){if(_0x42e4d1[_0x161b20(0x11b)]&&_0x1ddf8b[_0x161b20(0x16c)]>0x0&&!_0x1ddf8b[_0x161b20(0x102)](_0x42e4d1[_0x161b20(0x11b)]))continue;const _0x389c79=_0x42e4d1[_0x161b20(0x181)]||_0x42e4d1['eventStart']||_0x42e4d1[_0x161b20(0x134)];if(!_0x389c79)continue;const _0xfbb0f9=new Date(_0x389c79);if(isNaN(_0xfbb0f9[_0x161b20(0x14a)]()))continue;const _0x4ba175=(_0x42e4d1[_0x161b20(0x1a5)]||_0x42e4d1[_0x161b20(0x143)]||'')[_0x161b20(0x19e)]();if(_0x4ba175['includes'](_0x161b20(0x196))||_0x4ba175[_0x161b20(0x102)]('r√ºckkehr')||_0x4ba175[_0x161b20(0x102)](_0x161b20(0x13d))){let _0x531add=0x0;Object['values'](_0x4bb6db)[_0x161b20(0x112)](_0xf2aad6=>{if(_0xf2aad6>_0x531add)_0x531add=_0xf2aad6;});if(_0x531add===0x0)_0x531add=0x78;const _0x3a99db=_0xfbb0f9[_0x161b20(0x14a)]()-_0x531add*0xea60;_0x5e21c1>=_0x3a99db&&_0x5e21c1<_0xfbb0f9[_0x161b20(0x14a)]()&&(_0x4448f3['currentSystemMode']!==_0x161b20(0x183)&&(_0x4448f3[_0x161b20(0x195)][_0x161b20(0x155)](_0x161b20(0x163)+_0x531add+_0x161b20(0x175)),await _0x4448f3[_0x161b20(0x1a3)](_0x161b20(0x1a1),{'val':_0x161b20(0x183),'ack':![]})));}for(const _0x27f8ba of _0x169a70){if(_0x27f8ba[_0x161b20(0x17b)]){const _0x58f4c8=_0x27f8ba[_0x161b20(0x17b)][_0x161b20(0x19e)]();if(_0x4ba175[_0x161b20(0x102)](_0x58f4c8)){const _0x520024=_0x4bb6db[_0x27f8ba[_0x161b20(0x17b)]]||0x3c,_0x332861=_0x54b601[_0x27f8ba[_0x161b20(0x17b)]]||_0x161b20(0x104),_0x2dccff=_0xfbb0f9[_0x161b20(0x14a)]()-_0x520024*0xea60;if(_0x5e21c1>=_0x2dccff&&_0x5e21c1<_0xfbb0f9[_0x161b20(0x14a)]()){const _0x6db945=lastActions[_0x161b20(0x144)+_0x27f8ba[_0x161b20(0x17b)]];if(_0x6db945&&_0x5e21c1-_0x6db945<CAL_COOLDOWN_MS)continue;const _0x1e4f6c=await findRelatedId(_0x4448f3,_0x27f8ba['id'],_0x161b20(0x167));if(_0x1e4f6c){let _0x5e5e33=_0x433eab[_0x27f8ba[_0x161b20(0x17b)]];if(_0x5e5e33===undefined)_0x5e5e33=_0x433eab['default'];if(_0x5e5e33===undefined)_0x5e5e33=0x15;const _0x2e7ac8=await _0x4448f3[_0x161b20(0x176)](_0x1e4f6c);_0x2e7ac8&&typeof _0x2e7ac8['val']===_0x161b20(0x126)&&_0x2e7ac8[_0x161b20(0x147)]<_0x5e5e33-0.5&&(_0x4448f3[_0x161b20(0x195)][_0x161b20(0x155)](_0x161b20(0x15d)+_0x332861+_0x161b20(0x182)+_0x27f8ba[_0x161b20(0x17b)]+_0x161b20(0x199)+_0x5e5e33+_0x161b20(0x131)+_0x520024+'\x20min).'),await _0x4448f3[_0x161b20(0x123)](_0x1e4f6c,_0x5e5e33),await logAutomationAction(_0x4448f3,'[CAL]\x20'+_0x27f8ba[_0x161b20(0x17b)]+'\x20->\x20'+_0x5e5e33+'¬∞C\x20(via\x20'+_0x332861+')'),lastActions[_0x161b20(0x144)+_0x27f8ba[_0x161b20(0x17b)]]=_0x5e21c1);}}}}}}}catch(_0x1010d1){_0x4448f3[_0x161b20(0x195)]['warn'](_0x161b20(0x11a)+_0x1010d1[_0x161b20(0x165)]);}}function a1_0x195a(_0x4237cc,_0x5bacda){const _0x132f51=a1_0x2d09();return a1_0x195a=function(_0x1680d2,_0x32ff4d){_0x1680d2=_0x1680d2-0xfd;let _0x2d09a7=_0x132f51[_0x1680d2];return _0x2d09a7;},a1_0x195a(_0x4237cc,_0x5bacda);}async function manageMpcIntervention(_0x4d612d,_0x120aec,_0x4f738e){const _0x2cf8b7=a1_0x369fd1;try{const _0x45c9fb=_0x2cf8b7(0x138),_0x273a2a=await _0x4d612d[_0x2cf8b7(0x16b)](_0x45c9fb);let _0x4a07b3=[];if(_0x273a2a&&_0x273a2a[_0x2cf8b7(0x147)])try{_0x4a07b3=JSON[_0x2cf8b7(0x174)](_0x273a2a[_0x2cf8b7(0x147)]);}catch(_0x54552b){}const _0x334552=_0x4a07b3['indexOf'](_0x120aec);if(_0x4f738e===_0x2cf8b7(0x146))_0x334552===-0x1&&(_0x4a07b3[_0x2cf8b7(0x118)](_0x120aec),await _0x4d612d[_0x2cf8b7(0x1a3)](_0x45c9fb,{'val':JSON['stringify'](_0x4a07b3),'ack':!![]}));else _0x4f738e==='remove'&&(_0x334552!==-0x1&&(_0x4a07b3['splice'](_0x334552,0x1),await _0x4d612d[_0x2cf8b7(0x1a3)](_0x45c9fb,{'val':JSON[_0x2cf8b7(0x168)](_0x4a07b3),'ack':!![]})));}catch(_0x3df77f){}}async function cleanupGhostInterventions(_0x1f5151){const _0x5b2867=a1_0x369fd1;try{const _0x494798=_0x5b2867(0x138),_0x57c268=await _0x1f5151[_0x5b2867(0x16b)](_0x494798);if(!_0x57c268||!_0x57c268[_0x5b2867(0x147)])return;const _0x2bf681=JSON['parse'](_0x57c268[_0x5b2867(0x147)]);if(!Array[_0x5b2867(0x185)](_0x2bf681)||_0x2bf681['length']===0x0)return;let _0x44574a={'default':0x15};try{const _0x2dbb5c=await _0x1f5151[_0x5b2867(0x16b)](_0x5b2867(0x15c));if(_0x2dbb5c&&_0x2dbb5c['val'])_0x44574a=JSON[_0x5b2867(0x174)](_0x2dbb5c[_0x5b2867(0x147)]);}catch(_0x2b5839){}let _0x1aa61a=[];try{const _0x5bc9fe=await _0x1f5151[_0x5b2867(0x16b)](_0x5b2867(0x17d));if(_0x5bc9fe&&_0x5bc9fe['val'])_0x1aa61a=JSON[_0x5b2867(0x174)](_0x5bc9fe[_0x5b2867(0x147)]);}catch(_0x3c5b8a){}const _0x66a850=_0x1f5151[_0x5b2867(0x125)][_0x5b2867(0x18e)]||[];let _0x447de3=![];for(let _0x64ec82=_0x2bf681['length']-0x1;_0x64ec82>=0x0;_0x64ec82--){const _0x25d425=_0x2bf681[_0x64ec82],_0x3adbbf=_0x66a850[_0x5b2867(0x13f)](_0x4f235b=>normalize(_0x4f235b[_0x5b2867(0x17b)])===normalize(_0x25d425)&&(_0x4f235b[_0x5b2867(0x124)]===_0x5b2867(0x130)||_0x4f235b[_0x5b2867(0x124)]===_0x5b2867(0x18a)));if(!_0x3adbbf){_0x1f5151[_0x5b2867(0x195)]['warn']('üßπ\x20[MPC\x20CLEANUP]\x20Raum\x20\x27'+_0x25d425+_0x5b2867(0x17f)),_0x2bf681[_0x5b2867(0x180)](_0x64ec82,0x1),_0x447de3=!![];continue;}if(_0x3adbbf){const _0x4e3c7f=await findRelatedId(_0x1f5151,_0x3adbbf['id'],'setpoint'),_0x3c98f2=await _0x1f5151['getForeignStateAsync'](_0x3adbbf['id']);if(_0x4e3c7f){const _0x566132=await _0x1f5151[_0x5b2867(0x176)](_0x4e3c7f);if(_0x566132&&typeof _0x566132[_0x5b2867(0x147)]===_0x5b2867(0x126)){let _0x2eab8d=![],_0x19cfd4='';Math[_0x5b2867(0x115)](_0x566132[_0x5b2867(0x147)]-ECO_TEMP)>0.5&&(_0x2eab8d=!![],_0x19cfd4=_0x5b2867(0x164));if(!_0x2eab8d&&_0x3c98f2&&typeof _0x3c98f2[_0x5b2867(0x147)]===_0x5b2867(0x126)){const _0x5d1cca=_0x44574a[_0x25d425]||_0x44574a[_0x5b2867(0x135)]||0x15;_0x3c98f2[_0x5b2867(0x147)]<_0x5d1cca+0.2&&(_0x2eab8d=!![],_0x19cfd4='too_cold');}if(_0x2eab8d){if(_0x19cfd4===_0x5b2867(0x164)){_0x1f5151[_0x5b2867(0x195)]['info'](_0x5b2867(0x1ae)+_0x25d425+_0x5b2867(0x108)+_0x566132['val']+_0x5b2867(0x14d)+ECO_TEMP+_0x5b2867(0x101));const _0xc3502d=lastActions[_0x5b2867(0x144)+_0x25d425],_0x6081e8=_0xc3502d&&Date['now']()-_0xc3502d<0x2*0x3c*0x3e8;if(!_0x6081e8&&_0x566132[_0x5b2867(0x147)]>ECO_TEMP+0.5)_0x1f5151[_0x5b2867(0x16f)]&&(_0x1f5151['log'][_0x5b2867(0x155)]('üéì\x20[RL-FEEDBACK]\x20Lerne\x20aus\x20Fehler:\x20'+_0x25d425+'\x20wurde\x20manuell\x20erh√∂ht.'),_0x1f5151[_0x5b2867(0x16f)](_0x5b2867(0x154),{'room':_0x25d425}));else _0x6081e8&&_0x1f5151[_0x5b2867(0x195)][_0x5b2867(0x155)](_0x5b2867(0x177)+_0x25d425+_0x5b2867(0x18d));}else{if(_0x19cfd4===_0x5b2867(0x114)){let _0x2574bb=![];if(_0x1aa61a[_0x5b2867(0x13f)](_0x2c7cb7=>_0x2c7cb7[_0x5b2867(0x14f)]===_0x25d425))_0x2574bb=!![];const _0x167d0e=_0x66a850['filter'](_0x354845=>normalize(_0x354845[_0x5b2867(0x17b)])===normalize(_0x25d425)&&(_0x354845[_0x5b2867(0x124)]==='window'||_0x354845[_0x5b2867(0x124)]===_0x5b2867(0x139)||_0x354845[_0x5b2867(0x124)]===_0x5b2867(0x19f)));for(const _0x45ae24 of _0x167d0e){try{const _0x49e2d1=await _0x1f5151[_0x5b2867(0x176)](_0x45ae24['id']);if(_0x49e2d1&&(_0x49e2d1['val']===!![]||_0x49e2d1[_0x5b2867(0x147)]===0x1||String(_0x49e2d1[_0x5b2867(0x147)])[_0x5b2867(0x19e)]()===_0x5b2867(0x17c)))_0x2574bb=!![];}catch(_0x1172dc){}}if(_0x2574bb)_0x1f5151[_0x5b2867(0x195)][_0x5b2867(0x155)]('üå¨Ô∏è\x20[MPC\x20WATCHDOG]\x20'+_0x25d425+_0x5b2867(0x170));else{const _0xc28002=_0x44574a[_0x25d425]||_0x44574a[_0x5b2867(0x135)]||0x15;_0x1f5151[_0x5b2867(0x195)][_0x5b2867(0x155)](_0x5b2867(0x19b)+_0x25d425+_0x5b2867(0x107)+_0x3c98f2[_0x5b2867(0x147)]+_0x5b2867(0x11f)+(_0xc28002+0.2)+_0x5b2867(0x12c)),await _0x1f5151['setForeignStateAsync'](_0x4e3c7f,_0xc28002),await logAutomationAction(_0x1f5151,_0x5b2867(0x149)+_0x25d425+_0x5b2867(0x12f)+_0xc28002+'¬∞C'),lastActions['rescue_'+_0x25d425]=Date[_0x5b2867(0x158)]();}}}_0x2bf681[_0x5b2867(0x180)](_0x64ec82,0x1),_0x447de3=!![];}}}}}_0x447de3&&await _0x1f5151[_0x5b2867(0x1a3)](_0x494798,{'val':JSON[_0x5b2867(0x168)](_0x2bf681),'ack':!![]});}catch(_0x91c9d3){}}async function applyEnergySavings(_0x51e796,_0x30c89f){const _0x50901d=a1_0x369fd1;await cleanupGhostInterventions(_0x51e796);if(!_0x30c89f||_0x30c89f[_0x50901d(0x16c)]===0x0)return;const _0xa3f5eb=_0x51e796[_0x50901d(0x125)]['devices']||[],_0x52285f=Date[_0x50901d(0x158)]();for(const _0x9cbdde of _0x30c89f){const _0x1b76e=_0x9cbdde[_0x50901d(0x14f)],_0x1c446f=_0x9cbdde[_0x50901d(0x178)],_0x474373=_0x9cbdde[_0x50901d(0x152)]||0x15;if(lastActions[_0x50901d(0x193)+_0x1b76e]&&_0x52285f-lastActions['rescue_'+_0x1b76e]<RESCUE_LOCK_MS)continue;const _0x3d13f8=_0xa3f5eb[_0x50901d(0x13f)](_0x429414=>normalize(_0x429414[_0x50901d(0x17b)])===normalize(_0x1b76e)&&(_0x429414[_0x50901d(0x124)]===_0x50901d(0x130)||_0x429414[_0x50901d(0x124)]===_0x50901d(0x18a)));if(!_0x3d13f8)continue;const _0x7716df=await findRelatedId(_0x51e796,_0x3d13f8['id'],_0x50901d(0x167));if(_0x7716df){if(lastActions[_0x50901d(0x10e)+_0x1b76e]&&_0x52285f-lastActions['mpc_'+_0x1b76e]<0x1e*0x3c*0x3e8)continue;const _0x30cdee=await _0x51e796[_0x50901d(0x176)](_0x7716df);if(_0x30cdee&&typeof _0x30cdee[_0x50901d(0x147)]===_0x50901d(0x126)){const _0x1d532d=_0x30cdee[_0x50901d(0x147)];_0x1d532d!==ECO_TEMP&&await manageMpcIntervention(_0x51e796,_0x1b76e,_0x50901d(0x190));if(_0x1c446f>0x1e)_0x1d532d>ECO_TEMP+0.5&&(_0x51e796['log'][_0x50901d(0x155)]('üçÉ\x20[MPC\x20ACTION]\x20Senke\x20'+_0x1b76e+_0x50901d(0x113)+ECO_TEMP+_0x50901d(0x10c)+_0x1c446f+_0x50901d(0x15a)),await _0x51e796[_0x50901d(0x123)](_0x7716df,ECO_TEMP),await manageMpcIntervention(_0x51e796,_0x1b76e,_0x50901d(0x146)),lastActions[_0x50901d(0x10e)+_0x1b76e]=_0x52285f,await logAutomationAction(_0x51e796,_0x50901d(0xfd)+_0x1b76e+_0x50901d(0x19a)+ECO_TEMP+'¬∞C'));else _0x1c446f<=0xf&&(_0x1d532d<_0x474373&&(_0x51e796[_0x50901d(0x195)][_0x50901d(0x155)]('üî•\x20[MPC\x20ACTION]\x20Heize\x20'+_0x1b76e+_0x50901d(0x109)+_0x474373+_0x50901d(0x186)),await _0x51e796['setForeignStateAsync'](_0x7716df,_0x474373),await manageMpcIntervention(_0x51e796,_0x1b76e,_0x50901d(0x190)),lastActions[_0x50901d(0x10e)+_0x1b76e]=_0x52285f,await logAutomationAction(_0x51e796,'[MPC]\x20'+_0x1b76e+':\x20Aufheizen\x20auf\x20'+_0x474373+'¬∞C')));}}else _0x51e796['log'][_0x50901d(0x179)](_0x50901d(0x17a)+_0x1b76e+_0x50901d(0x11d));}}module[a1_0x369fd1(0x12d)]={'handlePrediction':handlePrediction,'applyEnergySavings':applyEnergySavings,'scanThermostats':scanThermostats,'checkCalendarTriggers':checkCalendarTriggers,'updateSchedulePreview':updateSchedulePreview,'cleanupGhostInterventions':cleanupGhostInterventions};