const a1_0x15ffd8=a1_0x4d3e;(function(_0x1cc4ee,_0x474b67){const _0x1cecb0=a1_0x4d3e,_0x5954a4=_0x1cc4ee();while(!![]){try{const _0x36724c=-parseInt(_0x1cecb0(0x193))/0x1*(-parseInt(_0x1cecb0(0x167))/0x2)+-parseInt(_0x1cecb0(0x175))/0x3+parseInt(_0x1cecb0(0x1db))/0x4+parseInt(_0x1cecb0(0x1f6))/0x5+parseInt(_0x1cecb0(0x186))/0x6+parseInt(_0x1cecb0(0x1b3))/0x7*(-parseInt(_0x1cecb0(0x166))/0x8)+parseInt(_0x1cecb0(0x184))/0x9;if(_0x36724c===_0x474b67)break;else _0x5954a4['push'](_0x5954a4['shift']());}catch(_0x33dd0b){_0x5954a4['push'](_0x5954a4['shift']());}}}(a1_0x65f8,0xe234f));const a1_0x2f6fc9=(function(){let _0xdf448a=!![];return function(_0x29dc93,_0x3a74db){const _0x3f07fd=_0xdf448a?function(){const _0x2ad3c8=a1_0x4d3e;if(_0x3a74db){const _0x16b702=_0x3a74db[_0x2ad3c8(0x1c1)](_0x29dc93,arguments);return _0x3a74db=null,_0x16b702;}}:function(){};return _0xdf448a=![],_0x3f07fd;};}()),a1_0xb89812=a1_0x2f6fc9(this,function(){const _0x289d27=a1_0x4d3e;return a1_0xb89812[_0x289d27(0x1d7)]()[_0x289d27(0x178)](_0x289d27(0x197))['toString']()['constructor'](a1_0xb89812)[_0x289d27(0x178)]('(((.+)+)+)+$');});a1_0xb89812();'use strict';const aiAgent=require(a1_0x15ffd8(0x183)),COOLDOWN_MS=0x3c*0x3e8,CAL_COOLDOWN_MS=0x5a*0x3c*0x3e8,ECO_TEMP=0x11,lastActions={};function normalize(_0x195d74){const _0x49e72f=a1_0x15ffd8;if(!_0x195d74)return'';return _0x195d74['toLowerCase']()[_0x49e72f(0x1f5)](/\s+/g,'')[_0x49e72f(0x1cd)]();}async function logAutomationAction(_0x2575d7,_0x554e91){const _0x392a1b=a1_0x15ffd8;await _0x2575d7[_0x392a1b(0x1d4)]('analysis.automation.lastAction',{'val':_0x554e91,'ack':!![]});try{const _0x44297c=_0x392a1b(0x18e),_0x3ea7fa=await _0x2575d7[_0x392a1b(0x1da)](_0x44297c);let _0x293dc4=[];if(_0x3ea7fa&&_0x3ea7fa[_0x392a1b(0x174)])try{_0x293dc4=JSON[_0x392a1b(0x17f)](_0x3ea7fa[_0x392a1b(0x174)]);}catch(_0x51d90b){}_0x293dc4[_0x392a1b(0x1e9)]({'ts':Date['now'](),'msg':_0x554e91});if(_0x293dc4[_0x392a1b(0x1af)]>0x32)_0x293dc4=_0x293dc4[_0x392a1b(0x1d6)](0x0,0x32);await _0x2575d7[_0x392a1b(0x1d4)](_0x44297c,{'val':JSON[_0x392a1b(0x1dc)](_0x293dc4),'ack':!![]});}catch(_0x497d5e){}}async function handlePrediction(_0x963712,_0x202cac,_0x2c57d9){const _0x1f02d6=a1_0x15ffd8;if(!_0x202cac||_0x202cac===_0x1f02d6(0x1bd))return;let _0x2ac207=_0x1f02d6(0x1f1),_0x37989c=0.6;try{const _0x219f7a=await _0x963712[_0x1f02d6(0x1da)](_0x1f02d6(0x1e1));if(_0x219f7a&&_0x219f7a['val'])_0x2ac207=_0x219f7a['val'];const _0x3e6987=await _0x963712[_0x1f02d6(0x1da)](_0x1f02d6(0x1eb));if(_0x3e6987&&_0x3e6987[_0x1f02d6(0x174)])_0x37989c=_0x3e6987[_0x1f02d6(0x174)];}catch(_0x34e7ae){}if(_0x2ac207===_0x1f02d6(0x1f1)||_0x2c57d9<_0x37989c)return;const _0x27a33d=Date[_0x1f02d6(0x16f)]();if(lastActions[_0x202cac]&&_0x27a33d-lastActions[_0x202cac]<COOLDOWN_MS)return;const _0x2d9157=_0x963712[_0x1f02d6(0x1a9)][_0x1f02d6(0x17d)]||[],_0x47fb5c=normalize(_0x202cac),_0x1cda44=_0x2d9157[_0x1f02d6(0x163)](_0x27620a=>normalize(_0x27620a['location'])===_0x47fb5c&&(_0x27620a[_0x1f02d6(0x1ec)]===_0x1f02d6(0x1ba)||_0x27620a['type']===_0x1f02d6(0x1cb)||_0x27620a[_0x1f02d6(0x1ec)]==='switch'));if(!_0x1cda44)return;const _0x589f8a=await aiAgent[_0x1f02d6(0x1c7)](_0x963712,_0x202cac,_0x1cda44[_0x1f02d6(0x1c4)],_0x2c57d9);if(!_0x589f8a['approved'])return;const _0x5b3f2b='PrÃ¤diktion:\x20'+_0x202cac+_0x1f02d6(0x1d9)+_0x1cda44['name']+'\x20('+_0x589f8a['reason']+')';await logAutomationAction(_0x963712,'['+_0x2ac207['toUpperCase']()+']\x20'+_0x5b3f2b);if(_0x2ac207==='active'){const _0x4118f5=await _0x963712[_0x1f02d6(0x1f0)](_0x1cda44['id']);(!_0x4118f5||!_0x4118f5[_0x1f02d6(0x174)]&&_0x4118f5['val']!==!![])&&await _0x963712[_0x1f02d6(0x17c)](_0x1cda44['id'],!![]),lastActions[_0x202cac]=_0x27a33d;}}function a1_0x65f8(){const _0x55c981=['temperature','replace','5908130AfGpzo','ðŸƒ\x20[MPC\x20ACTION]\x20Senke\x20','rÃ¼ckkehr','analysis.energy.warmupTimes','Manuelles\x20Mapping','SET','find','ðŸ“…\x20SMART\x20SCHEDULE\x20(Phase):\x20\x27Globaler\x20Start\x27\x20erkannt.\x20Heize\x20Haus\x20auf\x20(Vorlauf:\x20','ACTUAL_TEMPERATURE','3134752nbaQdC','143862hfCxrI','level','warn','from','getTime','Â°C).\x20Entferne\x20Status.','sensor','Nicht\x20gefunden','now','analysis.energy.schedulePreview','set','indexOf','Fehlt','val','715479RDQQTu','includes','message','search','urlaub\x20ende','current_heating_setpoint','ðŸ“…\x20SMART\x20SCHEDULE\x20[','setForeignStateAsync','devices','ACTUAL','parse','thermostatMapping','splice','ankunft','./ai_agent','4048452OafCdM','stellwert','1171764cqHDPc','remove','toLowerCase','pi_heating_demand','Auto-Erkennung','\x20min)',':\x20Aufheizen\x20auf\x20','analysis.energy.mpcActiveInterventions','analysis.automation.actionLog','Unbekannt','messwert','temp','system.mode','7GwAusE','soll','\x20auf\x20','Soll','(((.+)+)+)+$','log','Â°C!\x20(Puffer\x20leer).','minutes_safe','_calName','thermostat.setpoint','useCalendar',']:\x20Raum-Trigger\x20\x27','score','analysis.energy.warmupSources','target','PERFECT','number','[CAL]\x20','Â°C\x20(via\x20','isArray','write','ðŸ”¥\x20[MPC\x20ACTION]\x20Heize\x20','config','.data.table','sort','level.temperature','location','\x20ist\x20auf\x20','length','valve','entries','setpoint','28dJWUCk','string','room','getForeignObjectAsync','.1.ACTUAL_TEMPERATURE','state','calendarInstance','light','target_temperature','level.valve','Unknown','values','date','actual','apply','forEach','\x27\x20aktiv.\x20Heize\x20auf\x20','name','localeCompare','Â°C\x20(Vorlauf:\x20','consultButler','thermostat','split','triggerTime','dimmer','unit','trim','calendarSelection','info','event','push','SET_POINT_TEMPERATURE','.1.TEMPERATURE','setStateAsync','analysis.energy.warmupTargets','slice','toString','filter','\x20->\x20Schalte\x20','getStateAsync','1608588LvVRRi','stringify','add','valve_position','eventStart','_date','analysis.automation.mode','.1.SET_POINT_TEMPERATURE','\x20gefunden!','summary','\x20wieder\x20auf\x20','valveMapping','[MPC]\x20','[MPC\x20WARNING]\x20Kein\x20Setpoint\x20fÃ¼r\x20','unshift','\x20min).','analysis.automation.confidenceThreshold','type','Ist','.4.SET_TEMPERATURE','mpc_','getForeignStateAsync','off','common','hm-rpc'];a1_0x65f8=function(){return _0x55c981;};return a1_0x65f8();}async function findRelatedId(_0x1af3e9,_0x221bf7,_0x14589c=a1_0x15ffd8(0x1b2)){const _0x3f18b3=a1_0x15ffd8;if(_0x14589c===_0x3f18b3(0x1b2)&&_0x1af3e9[_0x3f18b3(0x1a9)][_0x3f18b3(0x180)]){let _0x3147fb=_0x1af3e9[_0x3f18b3(0x1a9)][_0x3f18b3(0x180)];if(typeof _0x3147fb===_0x3f18b3(0x1b4))try{_0x3147fb=JSON[_0x3f18b3(0x17f)](_0x3147fb);}catch(_0x58458e){}if(_0x3147fb&&_0x3147fb[_0x221bf7])return _0x3147fb[_0x221bf7];}if(_0x14589c===_0x3f18b3(0x1b0)&&_0x1af3e9[_0x3f18b3(0x1a9)][_0x3f18b3(0x1e6)]){let _0x20c2cc=_0x1af3e9[_0x3f18b3(0x1a9)][_0x3f18b3(0x1e6)];if(typeof _0x20c2cc==='string')try{_0x20c2cc=JSON[_0x3f18b3(0x17f)](_0x20c2cc);}catch(_0x18c776){}if(_0x20c2cc&&_0x20c2cc[_0x221bf7])return _0x20c2cc[_0x221bf7];}let _0x106e94=[];if(_0x14589c===_0x3f18b3(0x1b2))_0x106e94=[{'s':_0x3f18b3(0x1b7),'t':'.1.SET_POINT_TEMPERATURE'},{'s':_0x3f18b3(0x1d3),'t':_0x3f18b3(0x1e2)},{'s':_0x3f18b3(0x1d3),'t':_0x3f18b3(0x1ee)},{'s':_0x3f18b3(0x165),'t':_0x3f18b3(0x1d2)},{'s':'local_temperature','t':'occupied_heating_setpoint'},{'s':'local_temperature','t':_0x3f18b3(0x17a)},{'s':_0x3f18b3(0x1f4),'t':_0x3f18b3(0x1bb)},{'s':_0x3f18b3(0x17e),'t':_0x3f18b3(0x1fb)},{'s':_0x3f18b3(0x1ed),'t':_0x3f18b3(0x196)},{'s':_0x3f18b3(0x1f4),'t':_0x3f18b3(0x1b2)}];else _0x14589c===_0x3f18b3(0x1b0)&&(_0x106e94=[{'s':'.1.ACTUAL_TEMPERATURE','t':'.1.LEVEL'},{'s':_0x3f18b3(0x1d3),'t':'.1.LEVEL'},{'s':'.1.TEMPERATURE','t':'.4.VALVE_STATE'},{'s':'local_temperature','t':_0x3f18b3(0x189)},{'s':_0x3f18b3(0x1f4),'t':_0x3f18b3(0x1de)},{'s':'temperature','t':_0x3f18b3(0x168)}]);for(const _0x5de801 of _0x106e94){if(_0x221bf7[_0x3f18b3(0x176)](_0x5de801['s'])){const _0x3731ea=_0x221bf7[_0x3f18b3(0x1f5)](_0x5de801['s'],_0x5de801['t']),_0x35dd0d=await _0x1af3e9[_0x3f18b3(0x1b6)](_0x3731ea);if(_0x35dd0d)return _0x3731ea;}}try{const _0x4111ae=_0x221bf7['split']('.');if(_0x4111ae['length']>0x2){const _0x2be682=_0x4111ae['slice'](0x0,-0x1)['join']('.'),_0xa6e9a7=await _0x1af3e9['getForeignObjectsAsync'](_0x2be682+'.*'),_0x234b91=[],_0xda555d=_0x221bf7[_0x3f18b3(0x1c9)](/[._]+/)[_0x3f18b3(0x1d8)](_0x251031=>!['openknx','0',_0x3f18b3(0x1f3),'ist','wert',_0x3f18b3(0x1f4),_0x3f18b3(0x1c0),_0x3f18b3(0x16d),_0x3f18b3(0x190),_0x3f18b3(0x1b8)][_0x3f18b3(0x176)](_0x251031['toLowerCase']()));for(const [_0x3430fd,_0x347e43]of Object[_0x3f18b3(0x1b1)](_0xa6e9a7)){if(_0x3430fd===_0x221bf7)continue;if(_0x347e43&&_0x347e43[_0x3f18b3(0x1f2)]){const _0x5afad9=_0x3430fd[_0x3f18b3(0x188)](),_0x27db4b=(_0x347e43['common']['role']||'')['toLowerCase'](),_0xbd8969=(_0x347e43[_0x3f18b3(0x1f2)][_0x3f18b3(0x1cc)]||'')[_0x3f18b3(0x188)]();let _0x1718f8=![];if(_0x14589c===_0x3f18b3(0x1b2)&&_0x347e43[_0x3f18b3(0x1f2)][_0x3f18b3(0x1a7)]===!![])_0x1718f8=_0x5afad9[_0x3f18b3(0x176)](_0x3f18b3(0x171))||_0x5afad9['includes'](_0x3f18b3(0x194))||_0x5afad9[_0x3f18b3(0x176)](_0x3f18b3(0x1a1))||_0x27db4b[_0x3f18b3(0x176)](_0x3f18b3(0x1ac))||_0x27db4b[_0x3f18b3(0x176)](_0x3f18b3(0x19c));else _0x14589c===_0x3f18b3(0x1b0)&&(_0x1718f8=_0x5afad9[_0x3f18b3(0x176)](_0x3f18b3(0x168))||_0x5afad9[_0x3f18b3(0x176)](_0x3f18b3(0x1b0))||_0x5afad9[_0x3f18b3(0x176)](_0x3f18b3(0x185))||_0x5afad9[_0x3f18b3(0x176)]('position')||_0x27db4b[_0x3f18b3(0x176)](_0x3f18b3(0x1bc))||_0x27db4b['includes']('value.valve')||_0xbd8969[_0x3f18b3(0x176)]('%'));if(_0x1718f8){const _0x8f96ad=_0x3430fd[_0x3f18b3(0x1c9)](/[._]+/)['map'](_0x23bc50=>_0x23bc50[_0x3f18b3(0x188)]());let _0x468bbc=0x0;_0xda555d[_0x3f18b3(0x1c2)](_0x95097e=>{const _0xea4e2c=_0x3f18b3;if(_0x8f96ad[_0xea4e2c(0x176)](_0x95097e[_0xea4e2c(0x188)]()))_0x468bbc++;}),_0x234b91[_0x3f18b3(0x1d1)]({'id':_0x3430fd,'score':_0x468bbc});}}}if(_0x234b91[_0x3f18b3(0x1af)]>0x0){_0x234b91[_0x3f18b3(0x1ab)]((_0x541170,_0x29417d)=>_0x29417d['score']-_0x541170['score']);if(_0x234b91[0x0][_0x3f18b3(0x19f)]>0x0)return _0x234b91[0x0]['id'];}}}catch(_0x686bbf){}return null;}async function scanThermostats(_0x2885ee){const _0x2f0396=a1_0x15ffd8,_0x2529fe=_0x2885ee[_0x2f0396(0x1a9)][_0x2f0396(0x17d)]||[],_0x774ed4=[],_0x15089e=_0x2529fe[_0x2f0396(0x1d8)](_0x52663a=>_0x52663a['id']&&_0x52663a['id']['includes'](_0x2f0396(0x1f4))||_0x52663a['type']&&['temperature',_0x2f0396(0x1c8),_0x2f0396(0x16d)]['includes'](_0x52663a[_0x2f0396(0x1ec)])||_0x52663a[_0x2f0396(0x1c4)]&&_0x52663a['name'][_0x2f0396(0x188)]()[_0x2f0396(0x176)](_0x2f0396(0x191)));for(const _0x28ab46 of _0x15089e){const _0x471178=await findRelatedId(_0x2885ee,_0x28ab46['id'],_0x2f0396(0x1b2)),_0x44379e=await findRelatedId(_0x2885ee,_0x28ab46['id'],_0x2f0396(0x1b0));let _0x1106b2=_0x2f0396(0x16e),_0x502870=![],_0x25da7f=_0x2885ee[_0x2f0396(0x1a9)][_0x2f0396(0x180)]||{};if(typeof _0x25da7f==='string')try{_0x25da7f=JSON[_0x2f0396(0x17f)](_0x25da7f);}catch(_0x5af6ce){}let _0x31e9dd=_0x2885ee[_0x2f0396(0x1a9)]['valveMapping']||{};if(typeof _0x31e9dd===_0x2f0396(0x1b4))try{_0x31e9dd=JSON[_0x2f0396(0x17f)](_0x31e9dd);}catch(_0x47e865){}if(_0x25da7f[_0x28ab46['id']]&&_0x25da7f[_0x28ab46['id']]===_0x471178||_0x31e9dd[_0x28ab46['id']]&&_0x31e9dd[_0x28ab46['id']]===_0x44379e)_0x1106b2=_0x2f0396(0x1fa),_0x502870=!![];else(_0x471178||_0x44379e)&&(_0x1106b2=_0x2f0396(0x18a));_0x774ed4[_0x2f0396(0x1d1)]({'room':_0x28ab46[_0x2f0396(0x1ad)]||_0x2f0396(0x18f),'sensorId':_0x28ab46['id'],'setpointId':_0x471178||'-','valveId':_0x44379e||'-','source':_0x1106b2,'isManual':_0x502870,'status':_0x471178&&_0x44379e?_0x2f0396(0x1a2):_0x471178?'OK':_0x2f0396(0x173)});}return _0x774ed4[_0x2f0396(0x1ab)]((_0x19843d,_0x4a49e7)=>_0x19843d[_0x2f0396(0x1b5)][_0x2f0396(0x1c5)](_0x4a49e7[_0x2f0396(0x1b5)]));}async function updateSchedulePreview(_0x2dfdea){const _0x25b416=a1_0x15ffd8;if(!_0x2dfdea[_0x25b416(0x1a9)][_0x25b416(0x19d)]||!_0x2dfdea[_0x25b416(0x1a9)]['calendarInstance'])return;let _0x3e9dc8={};try{const _0xf123a5=await _0x2dfdea[_0x25b416(0x1da)](_0x25b416(0x1f9));if(_0xf123a5&&_0xf123a5['val'])_0x3e9dc8=JSON[_0x25b416(0x17f)](_0xf123a5[_0x25b416(0x174)]);}catch(_0x9c89c8){}const _0x2b2432=[],_0x50080d=Date[_0x25b416(0x16f)](),_0xd00b=0x30*0x3c*0x3c*0x3e8;try{const _0x506661=await _0x2dfdea[_0x25b416(0x1f0)](_0x2dfdea[_0x25b416(0x1a9)]['calendarInstance']+_0x25b416(0x1aa));if(!_0x506661||!_0x506661['val'])return;const _0x338d77=JSON[_0x25b416(0x17f)](_0x506661[_0x25b416(0x174)]),_0x2ab816=_0x2dfdea[_0x25b416(0x1a9)][_0x25b416(0x1ce)]||[],_0x134044=_0x2dfdea['config'][_0x25b416(0x17d)]||[],_0xf0faec=new Set();_0x134044[_0x25b416(0x1c2)](_0x1e9855=>{const _0x277168=_0x25b416;if(_0x1e9855[_0x277168(0x1ad)])_0xf0faec[_0x277168(0x1dd)](_0x1e9855[_0x277168(0x1ad)]);});for(const _0x459cdb of _0x338d77){if(_0x459cdb[_0x25b416(0x19b)]&&_0x2ab816[_0x25b416(0x1af)]>0x0&&!_0x2ab816['includes'](_0x459cdb[_0x25b416(0x19b)]))continue;const _0x519286=_0x459cdb[_0x25b416(0x1e0)]||_0x459cdb[_0x25b416(0x1df)]||_0x459cdb[_0x25b416(0x1bf)];if(!_0x519286)continue;const _0x3df8e8=new Date(_0x519286),_0x569983=_0x3df8e8[_0x25b416(0x16b)]();if(isNaN(_0x569983))continue;if(_0x569983<_0x50080d)continue;if(_0x569983>_0x50080d+_0xd00b)continue;const _0x172e53=(_0x459cdb[_0x25b416(0x1d0)]||_0x459cdb['summary']||'')['toLowerCase']();let _0x5e7189=![],_0x4687b5=[],_0x4f5c53=_0x459cdb['event']||_0x459cdb[_0x25b416(0x1e4)]||_0x25b416(0x18f);if(_0x172e53[_0x25b416(0x176)](_0x25b416(0x179))||_0x172e53['includes'](_0x25b416(0x1f8))||_0x172e53[_0x25b416(0x176)](_0x25b416(0x182)))_0x5e7189=!![],_0x4687b5=Array[_0x25b416(0x16a)](_0xf0faec);else for(const _0x48f11e of _0xf0faec){if(_0x172e53['includes'](_0x48f11e[_0x25b416(0x188)]()))_0x4687b5[_0x25b416(0x1d1)](_0x48f11e);}_0x4687b5[_0x25b416(0x1af)]>0x0&&_0x4687b5[_0x25b416(0x1c2)](_0x68f592=>{const _0x2538f5=_0x25b416;let _0x37fa34=0x3c;if(_0x5e7189){let _0x1f35f7=0x0;Object[_0x2538f5(0x1be)](_0x3e9dc8)[_0x2538f5(0x1c2)](_0x40c93d=>{if(_0x40c93d>_0x1f35f7)_0x1f35f7=_0x40c93d;}),_0x37fa34=_0x1f35f7>0x0?_0x1f35f7:0x78;}else _0x37fa34=_0x3e9dc8[_0x68f592]||0x3c;const _0x43b4d4=new Date(_0x569983-_0x37fa34*0xea60);_0x2b2432[_0x2538f5(0x1d1)]({'eventTime':_0x569983,'triggerTime':_0x43b4d4[_0x2538f5(0x16b)](),'room':_0x68f592,'minutes':_0x37fa34,'reason':_0x4f5c53,'isGlobal':_0x5e7189});});}}catch(_0x2447ed){}_0x2b2432[_0x25b416(0x1ab)]((_0x3a11ef,_0x29c6a3)=>_0x3a11ef['triggerTime']-_0x29c6a3[_0x25b416(0x1ca)]);const _0x5f5622=_0x2b2432[_0x25b416(0x1d6)](0x0,0x5);await _0x2dfdea[_0x25b416(0x1d4)](_0x25b416(0x170),{'val':JSON[_0x25b416(0x1dc)](_0x5f5622),'ack':!![]});}async function checkCalendarTriggers(_0x4f7e56){const _0x1bb6ad=a1_0x15ffd8;if(!_0x4f7e56[_0x1bb6ad(0x1a9)][_0x1bb6ad(0x19d)]||!_0x4f7e56[_0x1bb6ad(0x1a9)][_0x1bb6ad(0x1b9)])return;await updateSchedulePreview(_0x4f7e56);let _0x512229={},_0x428372={};try{const _0x357c3f=await _0x4f7e56[_0x1bb6ad(0x1da)]('analysis.energy.warmupTimes');if(_0x357c3f&&_0x357c3f[_0x1bb6ad(0x174)])_0x512229=JSON[_0x1bb6ad(0x17f)](_0x357c3f[_0x1bb6ad(0x174)]);const _0x3089ec=await _0x4f7e56['getStateAsync'](_0x1bb6ad(0x1a0));if(_0x3089ec&&_0x3089ec[_0x1bb6ad(0x174)])_0x428372=JSON[_0x1bb6ad(0x17f)](_0x3089ec[_0x1bb6ad(0x174)]);}catch(_0x5923f0){}let _0x212ec3={'default':0x15};try{const _0x2bc361=await _0x4f7e56[_0x1bb6ad(0x1da)](_0x1bb6ad(0x1d5));if(_0x2bc361&&_0x2bc361[_0x1bb6ad(0x174)])_0x212ec3=JSON[_0x1bb6ad(0x17f)](_0x2bc361[_0x1bb6ad(0x174)]);}catch(_0x1a488a){}try{const _0x131863=await _0x4f7e56[_0x1bb6ad(0x1f0)](_0x4f7e56[_0x1bb6ad(0x1a9)][_0x1bb6ad(0x1b9)]+_0x1bb6ad(0x1aa));if(!_0x131863||!_0x131863[_0x1bb6ad(0x174)])return;const _0x387a38=JSON[_0x1bb6ad(0x17f)](_0x131863[_0x1bb6ad(0x174)]),_0x318939=Date['now'](),_0x537b12=_0x4f7e56[_0x1bb6ad(0x1a9)][_0x1bb6ad(0x17d)]||[],_0x4b134a=_0x4f7e56[_0x1bb6ad(0x1a9)][_0x1bb6ad(0x1ce)]||[];for(const _0x1db9cc of _0x387a38){if(_0x1db9cc['_calName']&&_0x4b134a['length']>0x0&&!_0x4b134a[_0x1bb6ad(0x176)](_0x1db9cc['_calName']))continue;const _0x3216a3=_0x1db9cc[_0x1bb6ad(0x1e0)]||_0x1db9cc['eventStart']||_0x1db9cc['date'];if(!_0x3216a3)continue;const _0xe47567=new Date(_0x3216a3);if(isNaN(_0xe47567['getTime']()))continue;const _0x4f2234=(_0x1db9cc[_0x1bb6ad(0x1d0)]||_0x1db9cc['summary']||'')[_0x1bb6ad(0x188)]();if(_0x4f2234['includes'](_0x1bb6ad(0x179))||_0x4f2234[_0x1bb6ad(0x176)](_0x1bb6ad(0x1f8))||_0x4f2234[_0x1bb6ad(0x176)]('ankunft')){let _0x148f3b=0x0;Object[_0x1bb6ad(0x1be)](_0x512229)[_0x1bb6ad(0x1c2)](_0x439156=>{if(_0x439156>_0x148f3b)_0x148f3b=_0x439156;});if(_0x148f3b===0x0)_0x148f3b=0x78;const _0xc40fdf=_0xe47567[_0x1bb6ad(0x16b)]()-_0x148f3b*0xea60;_0x318939>=_0xc40fdf&&_0x318939<_0xe47567[_0x1bb6ad(0x16b)]()&&(_0x4f7e56['currentSystemMode']!=='normal'&&(_0x4f7e56[_0x1bb6ad(0x198)][_0x1bb6ad(0x1cf)](_0x1bb6ad(0x164)+_0x148f3b+'\x20min).'),await _0x4f7e56['setStateAsync'](_0x1bb6ad(0x192),{'val':'normal','ack':![]})));}for(const _0x139a13 of _0x537b12){if(_0x139a13['location']){const _0x120d45=_0x139a13['location'][_0x1bb6ad(0x188)]();if(_0x4f2234['includes'](_0x120d45)){const _0x283bab=_0x512229[_0x139a13[_0x1bb6ad(0x1ad)]]||0x3c,_0x52c320=_0x428372[_0x139a13[_0x1bb6ad(0x1ad)]]||'Classic',_0xc74687=_0xe47567[_0x1bb6ad(0x16b)]()-_0x283bab*0xea60;if(_0x318939>=_0xc74687&&_0x318939<_0xe47567[_0x1bb6ad(0x16b)]()){const _0x18feb5=lastActions['cal_'+_0x139a13[_0x1bb6ad(0x1ad)]];if(_0x18feb5&&_0x318939-_0x18feb5<CAL_COOLDOWN_MS)continue;const _0x1f2f25=await findRelatedId(_0x4f7e56,_0x139a13['id'],_0x1bb6ad(0x1b2));if(_0x1f2f25){let _0x2ee2c0=_0x212ec3[_0x139a13[_0x1bb6ad(0x1ad)]];if(_0x2ee2c0===undefined)_0x2ee2c0=_0x212ec3['default'];if(_0x2ee2c0===undefined)_0x2ee2c0=0x15;const _0x289d56=await _0x4f7e56[_0x1bb6ad(0x1f0)](_0x1f2f25);_0x289d56&&typeof _0x289d56[_0x1bb6ad(0x174)]===_0x1bb6ad(0x1a3)&&_0x289d56['val']<_0x2ee2c0-0.5&&(_0x4f7e56[_0x1bb6ad(0x198)][_0x1bb6ad(0x1cf)](_0x1bb6ad(0x17b)+_0x52c320+_0x1bb6ad(0x19e)+_0x139a13[_0x1bb6ad(0x1ad)]+_0x1bb6ad(0x1c3)+_0x2ee2c0+_0x1bb6ad(0x1c6)+_0x283bab+_0x1bb6ad(0x1ea)),await _0x4f7e56[_0x1bb6ad(0x17c)](_0x1f2f25,_0x2ee2c0),await logAutomationAction(_0x4f7e56,_0x1bb6ad(0x1a4)+_0x139a13[_0x1bb6ad(0x1ad)]+'\x20->\x20'+_0x2ee2c0+_0x1bb6ad(0x1a5)+_0x52c320+')'),lastActions['cal_'+_0x139a13['location']]=_0x318939);}}}}}}}catch(_0x432197){_0x4f7e56[_0x1bb6ad(0x198)][_0x1bb6ad(0x169)]('Calendar\x20Check\x20Error:\x20'+_0x432197[_0x1bb6ad(0x177)]);}}async function manageMpcIntervention(_0x51700c,_0x489b05,_0x50d247){const _0x1952f2=a1_0x15ffd8;try{const _0x916e42=_0x1952f2(0x18d),_0x21e0e9=await _0x51700c[_0x1952f2(0x1da)](_0x916e42);let _0xe02ddd=[];if(_0x21e0e9&&_0x21e0e9[_0x1952f2(0x174)])try{_0xe02ddd=JSON[_0x1952f2(0x17f)](_0x21e0e9[_0x1952f2(0x174)]);}catch(_0x244da5){}const _0x486b7c=_0xe02ddd[_0x1952f2(0x172)](_0x489b05);if(_0x50d247==='add')_0x486b7c===-0x1&&(_0xe02ddd['push'](_0x489b05),await _0x51700c[_0x1952f2(0x1d4)](_0x916e42,{'val':JSON[_0x1952f2(0x1dc)](_0xe02ddd),'ack':!![]}));else _0x50d247===_0x1952f2(0x187)&&(_0x486b7c!==-0x1&&(_0xe02ddd[_0x1952f2(0x181)](_0x486b7c,0x1),await _0x51700c[_0x1952f2(0x1d4)](_0x916e42,{'val':JSON[_0x1952f2(0x1dc)](_0xe02ddd),'ack':!![]})));}catch(_0x285057){}}async function cleanupGhostInterventions(_0x23f67b){const _0x5bfc5b=a1_0x15ffd8;try{const _0x2b8025='analysis.energy.mpcActiveInterventions',_0x578868=await _0x23f67b['getStateAsync'](_0x2b8025);if(!_0x578868||!_0x578868['val'])return;const _0x36181c=JSON[_0x5bfc5b(0x17f)](_0x578868[_0x5bfc5b(0x174)]);if(!Array[_0x5bfc5b(0x1a6)](_0x36181c)||_0x36181c[_0x5bfc5b(0x1af)]===0x0)return;const _0x174011=_0x23f67b[_0x5bfc5b(0x1a9)][_0x5bfc5b(0x17d)]||[];let _0x39eb5f=![];for(let _0x40aec1=_0x36181c[_0x5bfc5b(0x1af)]-0x1;_0x40aec1>=0x0;_0x40aec1--){const _0x5d1b3c=_0x36181c[_0x40aec1],_0x4399f6=_0x174011[_0x5bfc5b(0x163)](_0x304cd8=>normalize(_0x304cd8[_0x5bfc5b(0x1ad)])===normalize(_0x5d1b3c)&&(_0x304cd8[_0x5bfc5b(0x1ec)]==='temperature'||_0x304cd8[_0x5bfc5b(0x1ec)]===_0x5bfc5b(0x1c8)));if(_0x4399f6){const _0xe4beb4=await findRelatedId(_0x23f67b,_0x4399f6['id'],_0x5bfc5b(0x1b2));if(_0xe4beb4){const _0x57a0e5=await _0x23f67b[_0x5bfc5b(0x1f0)](_0xe4beb4);_0x57a0e5&&typeof _0x57a0e5[_0x5bfc5b(0x174)]===_0x5bfc5b(0x1a3)&&(Math['abs'](_0x57a0e5['val']-ECO_TEMP)>0.5&&(_0x23f67b[_0x5bfc5b(0x198)]['info']('ðŸ§¹\x20[MPC\x20CLEANUP]\x20'+_0x5d1b3c+_0x5bfc5b(0x1ae)+_0x57a0e5['val']+'Â°C\x20(nicht\x20'+ECO_TEMP+_0x5bfc5b(0x16c)),_0x36181c[_0x5bfc5b(0x181)](_0x40aec1,0x1),_0x39eb5f=!![]));}}}_0x39eb5f&&await _0x23f67b['setStateAsync'](_0x2b8025,{'val':JSON[_0x5bfc5b(0x1dc)](_0x36181c),'ack':!![]});}catch(_0x355cb3){}}async function applyEnergySavings(_0x57b762,_0x491ac6){const _0x501727=a1_0x15ffd8;await cleanupGhostInterventions(_0x57b762);if(!_0x491ac6||_0x491ac6['length']===0x0)return;const _0x29ed27=_0x57b762[_0x501727(0x1a9)][_0x501727(0x17d)]||[],_0x166d8d=Date[_0x501727(0x16f)]();for(const _0x36d8d7 of _0x491ac6){const _0xe7c29d=_0x36d8d7[_0x501727(0x1b5)],_0xef84ab=_0x36d8d7[_0x501727(0x19a)],_0x3d878a=_0x36d8d7[_0x501727(0x1a1)]||0x15,_0x340a6f=_0x29ed27[_0x501727(0x163)](_0x204784=>normalize(_0x204784[_0x501727(0x1ad)])===normalize(_0xe7c29d)&&(_0x204784[_0x501727(0x1ec)]==='temperature'||_0x204784[_0x501727(0x1ec)]===_0x501727(0x1c8)));if(!_0x340a6f)continue;const _0x5ca989=await findRelatedId(_0x57b762,_0x340a6f['id'],_0x501727(0x1b2));if(_0x5ca989){if(lastActions[_0x501727(0x1ef)+_0xe7c29d]&&_0x166d8d-lastActions['mpc_'+_0xe7c29d]<0x1e*0x3c*0x3e8)continue;const _0x304fcc=await _0x57b762['getForeignStateAsync'](_0x5ca989);if(_0x304fcc&&typeof _0x304fcc[_0x501727(0x174)]===_0x501727(0x1a3)){const _0x30d94f=_0x304fcc[_0x501727(0x174)];_0x30d94f!==ECO_TEMP&&await manageMpcIntervention(_0x57b762,_0xe7c29d,_0x501727(0x187));if(_0xef84ab>0x1e)_0x30d94f>ECO_TEMP+0.5&&(_0x57b762[_0x501727(0x198)]['info'](_0x501727(0x1f7)+_0xe7c29d+_0x501727(0x195)+ECO_TEMP+'Â°C!\x20(Puffer:\x20'+_0xef84ab+_0x501727(0x18b)),await _0x57b762['setForeignStateAsync'](_0x5ca989,ECO_TEMP),await manageMpcIntervention(_0x57b762,_0xe7c29d,_0x501727(0x1dd)),lastActions[_0x501727(0x1ef)+_0xe7c29d]=_0x166d8d,await logAutomationAction(_0x57b762,'[MPC]\x20'+_0xe7c29d+':\x20Absenkung\x20auf\x20'+ECO_TEMP+'Â°C'));else _0xef84ab<=0xf&&(_0x30d94f<_0x3d878a&&(_0x57b762[_0x501727(0x198)][_0x501727(0x1cf)](_0x501727(0x1a8)+_0xe7c29d+_0x501727(0x1e5)+_0x3d878a+_0x501727(0x199)),await _0x57b762[_0x501727(0x17c)](_0x5ca989,_0x3d878a),await manageMpcIntervention(_0x57b762,_0xe7c29d,_0x501727(0x187)),lastActions['mpc_'+_0xe7c29d]=_0x166d8d,await logAutomationAction(_0x57b762,_0x501727(0x1e7)+_0xe7c29d+_0x501727(0x18c)+_0x3d878a+'Â°C')));}}else _0x57b762['log']['warn'](_0x501727(0x1e8)+_0xe7c29d+_0x501727(0x1e3));}}function a1_0x4d3e(_0x3149df,_0x10d880){const _0x5c9eee=a1_0x65f8();return a1_0x4d3e=function(_0xb89812,_0x2f6fc9){_0xb89812=_0xb89812-0x163;let _0x65f8c5=_0x5c9eee[_0xb89812];return _0x65f8c5;},a1_0x4d3e(_0x3149df,_0x10d880);}module['exports']={'handlePrediction':handlePrediction,'applyEnergySavings':applyEnergySavings,'scanThermostats':scanThermostats,'checkCalendarTriggers':checkCalendarTriggers,'updateSchedulePreview':updateSchedulePreview};