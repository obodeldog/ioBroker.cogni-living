const a1_0x52276c=a1_0xba44;(function(_0x1ee3b9,_0x9cecf1){const _0x468ef8=a1_0xba44,_0x3ee6da=_0x1ee3b9();while(!![]){try{const _0x5ed1d2=-parseInt(_0x468ef8(0x160))/0x1*(-parseInt(_0x468ef8(0x1a6))/0x2)+-parseInt(_0x468ef8(0x1d5))/0x3*(-parseInt(_0x468ef8(0x1d3))/0x4)+-parseInt(_0x468ef8(0x1c6))/0x5+parseInt(_0x468ef8(0x1d1))/0x6*(-parseInt(_0x468ef8(0x18e))/0x7)+-parseInt(_0x468ef8(0x14b))/0x8*(-parseInt(_0x468ef8(0x14f))/0x9)+parseInt(_0x468ef8(0x19f))/0xa*(-parseInt(_0x468ef8(0x1e2))/0xb)+parseInt(_0x468ef8(0x14a))/0xc*(-parseInt(_0x468ef8(0x1fa))/0xd);if(_0x5ed1d2===_0x9cecf1)break;else _0x3ee6da['push'](_0x3ee6da['shift']());}catch(_0x4da661){_0x3ee6da['push'](_0x3ee6da['shift']());}}}(a1_0x3e3d,0xc1ca0));const a1_0x572510=(function(){let _0x5654ad=!![];return function(_0x72d5e2,_0x50d192){const _0x5726c0=_0x5654ad?function(){const _0x339ed0=a1_0xba44;if(_0x50d192){const _0x274c6a=_0x50d192[_0x339ed0(0x145)](_0x72d5e2,arguments);return _0x50d192=null,_0x274c6a;}}:function(){};return _0x5654ad=![],_0x5726c0;};}()),a1_0xc2bded=a1_0x572510(this,function(){const _0x23397c=a1_0xba44;return a1_0xc2bded[_0x23397c(0x1f3)]()[_0x23397c(0x150)](_0x23397c(0x148))[_0x23397c(0x1f3)]()[_0x23397c(0x1bc)](a1_0xc2bded)[_0x23397c(0x150)](_0x23397c(0x148));});a1_0xc2bded();'use strict';const aiAgent=require(a1_0x52276c(0x155)),COOLDOWN_MS=0x3c*0x3e8,CAL_COOLDOWN_MS=0x5a*0x3c*0x3e8,RESCUE_LOCK_MS=0x78*0x3c*0x3e8,ECO_TEMP=0x11,PENALTY_TTL=0x3*0x18*0x3c*0x3c*0x3e8,lastActions={};function normalize(_0x2fcaa7){const _0x162c27=a1_0x52276c;if(!_0x2fcaa7)return'';return _0x2fcaa7[_0x162c27(0x173)]()[_0x162c27(0x151)](/\s+/g,'')[_0x162c27(0x177)]();}function a1_0xba44(_0x9695fa,_0x2b9afa){const _0x2a5480=a1_0x3e3d();return a1_0xba44=function(_0xc2bded,_0x572510){_0xc2bded=_0xc2bded-0x13b;let _0x3e3dc5=_0x2a5480[_0xc2bded];return _0x3e3dc5;},a1_0xba44(_0x9695fa,_0x2b9afa);}function getWarmupRobust(_0x12a481,_0x560fb1){const _0x2bd2a8=a1_0x52276c;if(!_0x12a481||!_0x560fb1)return 0x3c;if(_0x12a481[_0x560fb1]!==undefined)return _0x12a481[_0x560fb1];const _0x2f9844=_0x560fb1['toLowerCase']()[_0x2bd2a8(0x151)](/Ã¤/g,'ae')[_0x2bd2a8(0x151)](/Ã¶/g,'oe')[_0x2bd2a8(0x151)](/Ã¼/g,'ue')[_0x2bd2a8(0x151)](/ÃŸ/g,'ss')[_0x2bd2a8(0x151)](/\s+/g,'_')['replace'](/[^a-z0-9_]/g,'');if(_0x12a481[_0x2f9844]!==undefined)return _0x12a481[_0x2f9844];return 0x3c;}async function logAutomationAction(_0x41eafb,_0x551260){const _0xdbf0cd=a1_0x52276c;await _0x41eafb[_0xdbf0cd(0x1c0)](_0xdbf0cd(0x1cd),{'val':_0x551260,'ack':!![]});try{const _0x5eb63b=_0xdbf0cd(0x1a3),_0x430262=await _0x41eafb[_0xdbf0cd(0x19d)](_0x5eb63b);let _0x18bafb=[];if(_0x430262&&_0x430262['val'])try{_0x18bafb=JSON[_0xdbf0cd(0x199)](_0x430262['val']);}catch(_0x39d6ed){}_0x18bafb[_0xdbf0cd(0x1db)]({'ts':Date[_0xdbf0cd(0x171)](),'msg':_0x551260});if(_0x18bafb[_0xdbf0cd(0x1c1)]>0x32)_0x18bafb=_0x18bafb[_0xdbf0cd(0x1a9)](0x0,0x32);await _0x41eafb[_0xdbf0cd(0x1c0)](_0x5eb63b,{'val':JSON[_0xdbf0cd(0x142)](_0x18bafb),'ack':!![]});}catch(_0x2dc8fd){}}async function handlePrediction(_0x414312,_0xe32faf,_0x3f5ab8){const _0x4c8cd9=a1_0x52276c;if(!_0xe32faf||_0xe32faf==='Unknown')return;let _0x20c1b9=_0x4c8cd9(0x1d6),_0xb97930=0.6;try{const _0x9f2d8f=await _0x414312[_0x4c8cd9(0x19d)]('analysis.automation.mode');if(_0x9f2d8f&&_0x9f2d8f[_0x4c8cd9(0x167)])_0x20c1b9=_0x9f2d8f[_0x4c8cd9(0x167)];const _0x81ccd2=await _0x414312[_0x4c8cd9(0x19d)]('analysis.automation.confidenceThreshold');if(_0x81ccd2&&_0x81ccd2[_0x4c8cd9(0x167)])_0xb97930=_0x81ccd2[_0x4c8cd9(0x167)];}catch(_0x1fab79){}if(_0x20c1b9===_0x4c8cd9(0x1d6)||_0x3f5ab8<_0xb97930)return;const _0x29b090=Date['now']();if(lastActions[_0xe32faf]&&_0x29b090-lastActions[_0xe32faf]<COOLDOWN_MS)return;const _0x20ec06=_0x414312[_0x4c8cd9(0x1ec)][_0x4c8cd9(0x17c)]||[],_0x5253cf=normalize(_0xe32faf),_0x55c16f=_0x20ec06[_0x4c8cd9(0x15b)](_0x400fc6=>normalize(_0x400fc6[_0x4c8cd9(0x1e7)])===_0x5253cf&&(_0x400fc6[_0x4c8cd9(0x162)]===_0x4c8cd9(0x19a)||_0x400fc6[_0x4c8cd9(0x162)]==='dimmer'||_0x400fc6['type']===_0x4c8cd9(0x156)));if(!_0x55c16f)return;const _0x3406dc=await aiAgent['consultButler'](_0x414312,_0xe32faf,_0x55c16f['name'],_0x3f5ab8);if(!_0x3406dc[_0x4c8cd9(0x175)])return;const _0x5762d8=_0x4c8cd9(0x1be)+_0xe32faf+_0x4c8cd9(0x1f5)+_0x55c16f[_0x4c8cd9(0x16a)]+'\x20('+_0x3406dc[_0x4c8cd9(0x146)]+')';await logAutomationAction(_0x414312,'['+_0x20c1b9['toUpperCase']()+']\x20'+_0x5762d8);if(_0x20c1b9===_0x4c8cd9(0x1fb)){const _0x396def=await _0x414312['getForeignStateAsync'](_0x55c16f['id']);(!_0x396def||!_0x396def[_0x4c8cd9(0x167)]&&_0x396def[_0x4c8cd9(0x167)]!==!![])&&await _0x414312[_0x4c8cd9(0x17e)](_0x55c16f['id'],!![]),lastActions[_0xe32faf]=_0x29b090;}}async function findRelatedId(_0x2befb9,_0x2e7bc4,_0x15a607=a1_0x52276c(0x1ee)){const _0x3c53a6=a1_0x52276c;if(_0x15a607===_0x3c53a6(0x1ee)&&_0x2befb9[_0x3c53a6(0x1ec)][_0x3c53a6(0x13f)]){let _0x4e4620=_0x2befb9['config']['thermostatMapping'];if(typeof _0x4e4620==='string')try{_0x4e4620=JSON['parse'](_0x4e4620);}catch(_0x4434dc){}if(_0x4e4620&&_0x4e4620[_0x2e7bc4])return _0x4e4620[_0x2e7bc4];}if(_0x15a607==='valve'&&_0x2befb9[_0x3c53a6(0x1ec)]['valveMapping']){let _0x4e324a=_0x2befb9['config']['valveMapping'];if(typeof _0x4e324a===_0x3c53a6(0x1c2))try{_0x4e324a=JSON['parse'](_0x4e324a);}catch(_0x20ad71){}if(_0x4e324a&&_0x4e324a[_0x2e7bc4])return _0x4e324a[_0x2e7bc4];}let _0x32d40e=[];if(_0x15a607===_0x3c53a6(0x1ee))_0x32d40e=[{'s':_0x3c53a6(0x1d0),'t':_0x3c53a6(0x1a4)},{'s':_0x3c53a6(0x1ce),'t':'.1.SET_POINT_TEMPERATURE'},{'s':_0x3c53a6(0x1ce),'t':_0x3c53a6(0x1f0)},{'s':_0x3c53a6(0x144),'t':_0x3c53a6(0x1ca)},{'s':'local_temperature','t':'occupied_heating_setpoint'},{'s':'local_temperature','t':_0x3c53a6(0x16d)},{'s':'temperature','t':'target_temperature'},{'s':_0x3c53a6(0x14d),'t':_0x3c53a6(0x1f7)},{'s':_0x3c53a6(0x172),'t':'Soll'},{'s':'temperature','t':_0x3c53a6(0x1ee)}];else _0x15a607==='valve'&&(_0x32d40e=[{'s':_0x3c53a6(0x1d0),'t':_0x3c53a6(0x1a5)},{'s':_0x3c53a6(0x1ce),'t':_0x3c53a6(0x1a5)},{'s':'.1.TEMPERATURE','t':'.4.VALVE_STATE'},{'s':_0x3c53a6(0x1f4),'t':_0x3c53a6(0x16c)},{'s':_0x3c53a6(0x13d),'t':'valve_position'},{'s':_0x3c53a6(0x13d),'t':_0x3c53a6(0x17b)}]);for(const _0x4c8f0b of _0x32d40e){if(_0x2e7bc4[_0x3c53a6(0x1d7)](_0x4c8f0b['s'])){const _0x2153c5=_0x2e7bc4['replace'](_0x4c8f0b['s'],_0x4c8f0b['t']),_0x4d1163=await _0x2befb9[_0x3c53a6(0x1c7)](_0x2153c5);if(_0x4d1163)return _0x2153c5;}}try{const _0x40fddf=_0x2e7bc4[_0x3c53a6(0x1df)]('.');if(_0x40fddf[_0x3c53a6(0x1c1)]>0x2){const _0x16af6a=_0x40fddf[_0x3c53a6(0x1a9)](0x0,-0x1)[_0x3c53a6(0x1e1)]('.'),_0x5dbca1=await _0x2befb9[_0x3c53a6(0x1b9)](_0x16af6a+'.*'),_0x16aa17=[],_0x402ad8=_0x2e7bc4['split'](/[._]+/)[_0x3c53a6(0x15f)](_0x15f005=>!['openknx','0',_0x3c53a6(0x18d),_0x3c53a6(0x1ea),_0x3c53a6(0x1cc),_0x3c53a6(0x13d),_0x3c53a6(0x195),'sensor',_0x3c53a6(0x1da),_0x3c53a6(0x178)][_0x3c53a6(0x1d7)](_0x15f005[_0x3c53a6(0x173)]()));for(const [_0x3f4bf7,_0x464686]of Object['entries'](_0x5dbca1)){if(_0x3f4bf7===_0x2e7bc4)continue;if(_0x464686&&_0x464686['common']){const _0x470cda=_0x3f4bf7['toLowerCase'](),_0x49dfac=(_0x464686['common']['role']||'')['toLowerCase'](),_0x561df3=(_0x464686[_0x3c53a6(0x1b0)]['unit']||'')[_0x3c53a6(0x173)]();let _0x2b7def=![];if(_0x15a607===_0x3c53a6(0x1ee)&&_0x464686[_0x3c53a6(0x1b0)][_0x3c53a6(0x1b3)]===!![])_0x2b7def=_0x470cda[_0x3c53a6(0x1d7)](_0x3c53a6(0x1bd))||_0x470cda[_0x3c53a6(0x1d7)](_0x3c53a6(0x1e6))||_0x470cda[_0x3c53a6(0x1d7)](_0x3c53a6(0x1dc))||_0x49dfac[_0x3c53a6(0x1d7)](_0x3c53a6(0x15a))||_0x49dfac[_0x3c53a6(0x1d7)](_0x3c53a6(0x1cf));else _0x15a607==='valve'&&(_0x2b7def=_0x470cda[_0x3c53a6(0x1d7)](_0x3c53a6(0x17b))||_0x470cda[_0x3c53a6(0x1d7)]('valve')||_0x470cda[_0x3c53a6(0x1d7)](_0x3c53a6(0x192))||_0x470cda['includes']('position')||_0x49dfac[_0x3c53a6(0x1d7)]('level.valve')||_0x49dfac[_0x3c53a6(0x1d7)](_0x3c53a6(0x184))||_0x561df3['includes']('%'));if(_0x2b7def){const _0x364040=_0x3f4bf7[_0x3c53a6(0x1df)](/[._]+/)['map'](_0x52c240=>_0x52c240[_0x3c53a6(0x173)]());let _0x572d13=0x0;_0x402ad8[_0x3c53a6(0x182)](_0x306ff4=>{const _0xfae04f=_0x3c53a6;if(_0x364040[_0xfae04f(0x1d7)](_0x306ff4[_0xfae04f(0x173)]()))_0x572d13++;}),_0x16aa17[_0x3c53a6(0x1f9)]({'id':_0x3f4bf7,'score':_0x572d13});}}}if(_0x16aa17['length']>0x0){_0x16aa17[_0x3c53a6(0x168)]((_0x166f3b,_0x7134f9)=>_0x7134f9[_0x3c53a6(0x19e)]-_0x166f3b['score']);if(_0x16aa17[0x0][_0x3c53a6(0x19e)]>0x0)return _0x16aa17[0x0]['id'];}}}catch(_0x4b03de){}return null;}async function scanThermostats(_0x480653){const _0x292036=a1_0x52276c,_0x396e52=_0x480653[_0x292036(0x1ec)][_0x292036(0x17c)]||[],_0x3cc523=[],_0x34e2af=_0x396e52[_0x292036(0x15f)](_0x5051e1=>_0x5051e1['id']&&_0x5051e1['id'][_0x292036(0x1d7)]('temperature')||_0x5051e1[_0x292036(0x162)]&&[_0x292036(0x13d),_0x292036(0x17f),'sensor'][_0x292036(0x1d7)](_0x5051e1['type'])||_0x5051e1[_0x292036(0x16a)]&&_0x5051e1[_0x292036(0x16a)]['toLowerCase']()[_0x292036(0x1d7)](_0x292036(0x1d8)));for(const _0x40cdb1 of _0x34e2af){const _0x4bf8f6=await findRelatedId(_0x480653,_0x40cdb1['id'],'setpoint'),_0x402e98=await findRelatedId(_0x480653,_0x40cdb1['id'],_0x292036(0x15c));let _0x4cba1c=_0x292036(0x1b6),_0x549f0a=![],_0x45c8b4=_0x480653[_0x292036(0x1ec)][_0x292036(0x13f)]||{};if(typeof _0x45c8b4==='string')try{_0x45c8b4=JSON['parse'](_0x45c8b4);}catch(_0x2b476b){}let _0x4dad16=_0x480653[_0x292036(0x1ec)]['valveMapping']||{};if(typeof _0x4dad16==='string')try{_0x4dad16=JSON[_0x292036(0x199)](_0x4dad16);}catch(_0xb7943){}if(_0x45c8b4[_0x40cdb1['id']]&&_0x45c8b4[_0x40cdb1['id']]===_0x4bf8f6||_0x4dad16[_0x40cdb1['id']]&&_0x4dad16[_0x40cdb1['id']]===_0x402e98)_0x4cba1c=_0x292036(0x1ab),_0x549f0a=!![];else(_0x4bf8f6||_0x402e98)&&(_0x4cba1c=_0x292036(0x14e));_0x3cc523[_0x292036(0x1f9)]({'room':_0x40cdb1['location']||_0x292036(0x164),'sensorId':_0x40cdb1['id'],'setpointId':_0x4bf8f6||'-','valveId':_0x402e98||'-','source':_0x4cba1c,'isManual':_0x549f0a,'status':_0x4bf8f6&&_0x402e98?_0x292036(0x1ba):_0x4bf8f6?'OK':_0x292036(0x181)});}return _0x3cc523[_0x292036(0x168)]((_0x12b29f,_0x2aa1c3)=>_0x12b29f[_0x292036(0x176)]['localeCompare'](_0x2aa1c3['room']));}async function updateSchedulePreview(_0x41fa11){const _0x3df55d=a1_0x52276c;if(!_0x41fa11[_0x3df55d(0x1ec)][_0x3df55d(0x1e3)]||!_0x41fa11[_0x3df55d(0x1ec)][_0x3df55d(0x18c)])return;let _0x4520ae={};try{const _0x48b413=await _0x41fa11[_0x3df55d(0x19d)](_0x3df55d(0x154));if(_0x48b413&&_0x48b413['val'])_0x4520ae=JSON[_0x3df55d(0x199)](_0x48b413['val']);}catch(_0x2a8d14){}const _0x3ce9d7=[],_0x1c4c52=Date[_0x3df55d(0x171)](),_0x497393=0x30*0x3c*0x3c*0x3e8;try{const _0x26b2a3=await _0x41fa11[_0x3df55d(0x1c8)](_0x41fa11[_0x3df55d(0x1ec)][_0x3df55d(0x18c)]+_0x3df55d(0x13e));if(!_0x26b2a3||!_0x26b2a3[_0x3df55d(0x167)])return;const _0x43b485=JSON[_0x3df55d(0x199)](_0x26b2a3[_0x3df55d(0x167)]),_0x5a8094=_0x41fa11[_0x3df55d(0x1ec)][_0x3df55d(0x1de)]||[],_0x3fa091=_0x41fa11[_0x3df55d(0x1ec)]['devices']||[],_0x2645bb=new Set();_0x3fa091[_0x3df55d(0x182)](_0x3dc085=>{const _0x99a9d0=_0x3df55d;if(_0x3dc085[_0x99a9d0(0x1e7)])_0x2645bb[_0x99a9d0(0x1b7)](_0x3dc085[_0x99a9d0(0x1e7)]);});for(const _0x3f60c7 of _0x43b485){if(_0x3f60c7[_0x3df55d(0x147)]&&_0x5a8094[_0x3df55d(0x1c1)]>0x0&&!_0x5a8094[_0x3df55d(0x1d7)](_0x3f60c7['_calName']))continue;const _0x3fa4e2=_0x3f60c7[_0x3df55d(0x1e0)]||_0x3f60c7['eventStart']||_0x3f60c7[_0x3df55d(0x187)];if(!_0x3fa4e2)continue;const _0x129605=new Date(_0x3fa4e2),_0x342b2f=_0x129605[_0x3df55d(0x1ac)]();if(isNaN(_0x342b2f))continue;if(_0x342b2f<_0x1c4c52)continue;if(_0x342b2f>_0x1c4c52+_0x497393)continue;const _0x5c4a1b=(_0x3f60c7['event']||_0x3f60c7[_0x3df55d(0x1ad)]||'')[_0x3df55d(0x173)]();let _0x492fdb=![],_0x4ede46=[],_0x356f17=_0x3f60c7['event']||_0x3f60c7[_0x3df55d(0x1ad)]||_0x3df55d(0x164);if(_0x5c4a1b[_0x3df55d(0x1d7)](_0x3df55d(0x159))||_0x5c4a1b[_0x3df55d(0x1d7)](_0x3df55d(0x149))||_0x5c4a1b[_0x3df55d(0x1d7)](_0x3df55d(0x16e)))_0x492fdb=!![],_0x4ede46=Array[_0x3df55d(0x140)](_0x2645bb);else for(const _0x2e3752 of _0x2645bb){if(_0x5c4a1b['includes'](_0x2e3752[_0x3df55d(0x173)]()))_0x4ede46[_0x3df55d(0x1f9)](_0x2e3752);}_0x4ede46[_0x3df55d(0x1c1)]>0x0&&_0x4ede46[_0x3df55d(0x182)](_0x428314=>{const _0x282734=_0x3df55d;let _0x2d8326=0x3c;if(_0x492fdb){let _0x47c7d7=0x0;Object['values'](_0x4520ae)[_0x282734(0x182)](_0x28f169=>{if(_0x28f169>_0x47c7d7)_0x47c7d7=_0x28f169;}),_0x2d8326=_0x47c7d7>0x0?_0x47c7d7:0x78;}else _0x2d8326=getWarmupRobust(_0x4520ae,_0x428314);const _0x5c1d6c=new Date(_0x342b2f-_0x2d8326*0xea60);_0x3ce9d7[_0x282734(0x1f9)]({'eventTime':_0x342b2f,'triggerTime':_0x5c1d6c['getTime'](),'room':_0x428314,'minutes':_0x2d8326,'reason':_0x356f17,'isGlobal':_0x492fdb});});}}catch(_0x3868d0){}_0x3ce9d7['sort']((_0x1dc678,_0x30675b)=>_0x1dc678[_0x3df55d(0x1bb)]-_0x30675b[_0x3df55d(0x1bb)]);const _0xe03459=_0x3ce9d7[_0x3df55d(0x1a9)](0x0,0x1e);await _0x41fa11['setStateAsync'](_0x3df55d(0x1a7),{'val':JSON[_0x3df55d(0x142)](_0xe03459),'ack':!![]});}async function monitorEnforcements(_0x4f9348){const _0x4bb490=a1_0x52276c;try{const _0x319e7b='analysis.energy.activeEnforcements',_0x5ade9a=await _0x4f9348[_0x4bb490(0x19d)](_0x319e7b);if(!_0x5ade9a||!_0x5ade9a[_0x4bb490(0x167)])return;let _0x5ef71d=[];try{_0x5ef71d=JSON[_0x4bb490(0x199)](_0x5ade9a['val']);}catch(_0xe295c9){return;}if(!Array['isArray'](_0x5ef71d)||_0x5ef71d[_0x4bb490(0x1c1)]===0x0)return;const _0xd5881a=Date[_0x4bb490(0x171)](),_0x4fe967=_0x4f9348[_0x4bb490(0x1ec)][_0x4bb490(0x17c)]||[];let _0x5eefb8=![];for(let _0x55e919=_0x5ef71d['length']-0x1;_0x55e919>=0x0;_0x55e919--){const _0x5d723f=_0x5ef71d[_0x55e919];if(_0xd5881a>=_0x5d723f[_0x4bb490(0x1c4)]){_0x4f9348[_0x4bb490(0x1b2)][_0x4bb490(0x16f)](_0x4bb490(0x1e9)+_0x5d723f['room']+_0x4bb490(0x13c)),_0x5ef71d['splice'](_0x55e919,0x1),_0x5eefb8=!![];continue;}const _0x4993df=_0x4fe967[_0x4bb490(0x15b)](_0x1de3a1=>normalize(_0x1de3a1[_0x4bb490(0x1e7)])===normalize(_0x5d723f[_0x4bb490(0x176)])&&(_0x1de3a1[_0x4bb490(0x162)]===_0x4bb490(0x13d)||_0x1de3a1['type']==='thermostat'));if(_0x4993df){const _0x311a04=await findRelatedId(_0x4f9348,_0x4993df['id'],_0x4bb490(0x1ee));if(_0x311a04){const _0x241406=await _0x4f9348[_0x4bb490(0x1c8)](_0x311a04);_0x241406&&typeof _0x241406[_0x4bb490(0x167)]===_0x4bb490(0x194)&&(_0x241406[_0x4bb490(0x167)]<0xf&&(_0x4f9348[_0x4bb490(0x1b2)][_0x4bb490(0x1a2)]('ðŸš¨\x20[ENFORCEMENT]\x20Hardware-Profil\x20hat\x20'+_0x5d723f['room']+_0x4bb490(0x16b)+_0x241406[_0x4bb490(0x167)]+_0x4bb490(0x196)+_0x5d723f[_0x4bb490(0x1dc)]+'Â°C.'),await _0x4f9348[_0x4bb490(0x17e)](_0x311a04,_0x5d723f[_0x4bb490(0x1dc)]),await logAutomationAction(_0x4f9348,_0x4bb490(0x1ef)+_0x5d723f[_0x4bb490(0x176)]+':\x20'+_0x241406[_0x4bb490(0x167)]+_0x4bb490(0x1a1)+_0x5d723f[_0x4bb490(0x1dc)]+_0x4bb490(0x1dd))));}}}_0x5eefb8&&await _0x4f9348[_0x4bb490(0x1c0)](_0x319e7b,{'val':JSON[_0x4bb490(0x142)](_0x5ef71d),'ack':!![]});}catch(_0x194603){_0x4f9348['log'][_0x4bb490(0x19c)](_0x4bb490(0x18b)+_0x194603[_0x4bb490(0x1c5)]);}}async function checkCalendarTriggers(_0x32cb02){const _0x58641a=a1_0x52276c;if(!_0x32cb02['config'][_0x58641a(0x1e3)]||!_0x32cb02[_0x58641a(0x1ec)][_0x58641a(0x18c)])return;await updateSchedulePreview(_0x32cb02);let _0x36d575={},_0x1ff76a={};try{const _0x103c0b=await _0x32cb02[_0x58641a(0x19d)](_0x58641a(0x154));if(_0x103c0b&&_0x103c0b[_0x58641a(0x167)])_0x36d575=JSON['parse'](_0x103c0b[_0x58641a(0x167)]);const _0xacd12a=await _0x32cb02[_0x58641a(0x19d)]('analysis.energy.warmupSources');if(_0xacd12a&&_0xacd12a[_0x58641a(0x167)])_0x1ff76a=JSON[_0x58641a(0x199)](_0xacd12a['val']);}catch(_0x15acf1){}let _0x2a22da={'default':0x15};try{const _0x32220e=await _0x32cb02[_0x58641a(0x19d)](_0x58641a(0x1d4));if(_0x32220e&&_0x32220e[_0x58641a(0x167)])_0x2a22da=JSON[_0x58641a(0x199)](_0x32220e[_0x58641a(0x167)]);}catch(_0x58b8db){}let _0x29deb4=[];try{const _0x95cbc7=await _0x32cb02[_0x58641a(0x19d)](_0x58641a(0x15e));if(_0x95cbc7&&_0x95cbc7[_0x58641a(0x167)])_0x29deb4=JSON[_0x58641a(0x199)](_0x95cbc7[_0x58641a(0x167)]);}catch(_0x1f1587){}try{const _0x39d542=await _0x32cb02[_0x58641a(0x1c8)](_0x32cb02[_0x58641a(0x1ec)][_0x58641a(0x18c)]+_0x58641a(0x13e));if(!_0x39d542||!_0x39d542[_0x58641a(0x167)])return;const _0x145ece=JSON[_0x58641a(0x199)](_0x39d542[_0x58641a(0x167)]),_0x268037=Date[_0x58641a(0x171)](),_0x4b9e0e=_0x32cb02['config'][_0x58641a(0x17c)]||[],_0x2c6dcb=_0x32cb02[_0x58641a(0x1ec)]['calendarSelection']||[];let _0x433cbb=![];for(const _0x4faf34 of _0x145ece){if(_0x4faf34[_0x58641a(0x147)]&&_0x2c6dcb['length']>0x0&&!_0x2c6dcb[_0x58641a(0x1d7)](_0x4faf34[_0x58641a(0x147)]))continue;const _0x2c4cde=_0x4faf34[_0x58641a(0x1e0)]||_0x4faf34['eventStart']||_0x4faf34[_0x58641a(0x187)];if(!_0x2c4cde)continue;const _0x112444=new Date(_0x2c4cde);if(isNaN(_0x112444[_0x58641a(0x1ac)]()))continue;const _0x17980c=(_0x4faf34[_0x58641a(0x18a)]||_0x4faf34[_0x58641a(0x1ad)]||'')[_0x58641a(0x173)]();if(_0x17980c[_0x58641a(0x1d7)]('urlaub\x20ende')||_0x17980c[_0x58641a(0x1d7)]('rÃ¼ckkehr')||_0x17980c[_0x58641a(0x1d7)]('ankunft')){let _0x5363a8=0x0;Object[_0x58641a(0x163)](_0x36d575)[_0x58641a(0x182)](_0x311b4e=>{if(_0x311b4e>_0x5363a8)_0x5363a8=_0x311b4e;});if(_0x5363a8===0x0)_0x5363a8=0x78;const _0x33fcc6=_0x112444['getTime']()-_0x5363a8*0xea60;_0x268037>=_0x33fcc6&&_0x268037<_0x112444['getTime']()&&(_0x32cb02[_0x58641a(0x1f2)]!==_0x58641a(0x1b8)&&(_0x32cb02['log'][_0x58641a(0x16f)](_0x58641a(0x17a)+_0x5363a8+_0x58641a(0x165)),await _0x32cb02[_0x58641a(0x1c0)]('system.mode',{'val':'normal','ack':![]})));}for(const _0x35dcf1 of _0x4b9e0e){if(_0x35dcf1['location']){const _0x5ca11e=_0x35dcf1[_0x58641a(0x1e7)]['toLowerCase'](),_0x50346c=(_0x35dcf1[_0x58641a(0x16a)]||'')[_0x58641a(0x173)]();let _0x256919=_0x17980c[_0x58641a(0x1d7)](_0x5ca11e);!_0x256919&&_0x50346c[_0x58641a(0x1c1)]>0x3&&_0x17980c['includes'](_0x50346c)&&(_0x256919=!![]);if(_0x256919){const _0x227ee1=getWarmupRobust(_0x36d575,_0x35dcf1[_0x58641a(0x1e7)]),_0x2f8e7d=_0x1ff76a[_0x35dcf1[_0x58641a(0x1e7)]]||'Classic',_0x2e5e78=_0x112444[_0x58641a(0x1ac)]()-_0x227ee1*0xea60;if(_0x268037>=_0x2e5e78&&_0x268037<_0x112444['getTime']()){const _0x40d0d4=lastActions[_0x58641a(0x158)+_0x35dcf1[_0x58641a(0x1e7)]];if(_0x40d0d4&&_0x268037-_0x40d0d4<CAL_COOLDOWN_MS)continue;const _0x283001=await findRelatedId(_0x32cb02,_0x35dcf1['id'],_0x58641a(0x1ee));if(_0x283001){let _0x8a8ce4=_0x2a22da[_0x35dcf1[_0x58641a(0x1e7)]];if(_0x8a8ce4===undefined)_0x8a8ce4=_0x2a22da[_0x58641a(0x157)];if(_0x8a8ce4===undefined)_0x8a8ce4=0x15;const _0xe6ff87=await _0x32cb02[_0x58641a(0x1c8)](_0x283001);if(_0xe6ff87&&typeof _0xe6ff87['val']===_0x58641a(0x194)&&_0xe6ff87[_0x58641a(0x167)]<_0x8a8ce4-0.5){_0x32cb02[_0x58641a(0x1b2)]['info'](_0x58641a(0x169)+_0x2f8e7d+']:\x20Raum-Trigger\x20\x27'+_0x35dcf1[_0x58641a(0x1e7)]+'\x27\x20(Match:\x20'+_0x17980c+')\x20aktiv.\x20Heize\x20auf\x20'+_0x8a8ce4+_0x58641a(0x174)+_0x227ee1+_0x58641a(0x165)),await _0x32cb02[_0x58641a(0x17e)](_0x283001,_0x8a8ce4),await logAutomationAction(_0x32cb02,_0x58641a(0x1e8)+_0x35dcf1[_0x58641a(0x1e7)]+'\x20->\x20'+_0x8a8ce4+_0x58641a(0x1ed)+_0x2f8e7d+')'),lastActions['cal_'+_0x35dcf1[_0x58641a(0x1e7)]]=_0x268037;const _0x163dae=_0x29deb4['findIndex'](_0x3d1033=>_0x3d1033[_0x58641a(0x176)]===_0x35dcf1[_0x58641a(0x1e7)]);if(_0x163dae!==-0x1)_0x29deb4[_0x58641a(0x161)](_0x163dae,0x1);_0x29deb4[_0x58641a(0x1f9)]({'room':_0x35dcf1[_0x58641a(0x1e7)],'target':_0x8a8ce4,'until':_0x112444[_0x58641a(0x1ac)]()}),_0x433cbb=!![];}}}}}}}_0x433cbb&&await _0x32cb02[_0x58641a(0x1c0)](_0x58641a(0x15e),{'val':JSON['stringify'](_0x29deb4),'ack':!![]});}catch(_0x1a1cd3){_0x32cb02[_0x58641a(0x1b2)][_0x58641a(0x1a2)](_0x58641a(0x1e5)+_0x1a1cd3['message']);}}async function manageMpcIntervention(_0x19aea0,_0x4ef76a,_0x201015){const _0x4906eb=a1_0x52276c;try{const _0x1768dc=_0x4906eb(0x197),_0x5e5209=await _0x19aea0[_0x4906eb(0x19d)](_0x1768dc);let _0x1c8b6c=[];if(_0x5e5209&&_0x5e5209['val'])try{_0x1c8b6c=JSON[_0x4906eb(0x199)](_0x5e5209[_0x4906eb(0x167)]);}catch(_0x58115d){}const _0x2f52dc=_0x1c8b6c[_0x4906eb(0x1d2)](_0x4ef76a);if(_0x201015===_0x4906eb(0x1b7))_0x2f52dc===-0x1&&(_0x1c8b6c[_0x4906eb(0x1f9)](_0x4ef76a),await _0x19aea0['setStateAsync'](_0x1768dc,{'val':JSON[_0x4906eb(0x142)](_0x1c8b6c),'ack':!![]}));else _0x201015==='remove'&&(_0x2f52dc!==-0x1&&(_0x1c8b6c[_0x4906eb(0x161)](_0x2f52dc,0x1),await _0x19aea0[_0x4906eb(0x1c0)](_0x1768dc,{'val':JSON[_0x4906eb(0x142)](_0x1c8b6c),'ack':!![]})));}catch(_0x548517){}}async function cleanupGhostInterventions(_0x46c1a8){const _0x240f0a=a1_0x52276c;try{const _0x2507a0=_0x240f0a(0x197),_0x4f73e2=await _0x46c1a8[_0x240f0a(0x19d)](_0x2507a0);if(!_0x4f73e2||!_0x4f73e2[_0x240f0a(0x167)])return;const _0x115253=JSON['parse'](_0x4f73e2[_0x240f0a(0x167)]);if(!Array[_0x240f0a(0x191)](_0x115253)||_0x115253[_0x240f0a(0x1c1)]===0x0)return;let _0x1cf147={'default':0x15};try{const _0x4de6e5=await _0x46c1a8[_0x240f0a(0x19d)]('analysis.energy.warmupTargets');if(_0x4de6e5&&_0x4de6e5[_0x240f0a(0x167)])_0x1cf147=JSON[_0x240f0a(0x199)](_0x4de6e5[_0x240f0a(0x167)]);}catch(_0x49290b){}let _0x1bb8fc=[];try{const _0x54498e=await _0x46c1a8[_0x240f0a(0x19d)](_0x240f0a(0x13b));if(_0x54498e&&_0x54498e[_0x240f0a(0x167)])_0x1bb8fc=JSON[_0x240f0a(0x199)](_0x54498e[_0x240f0a(0x167)]);}catch(_0x4b8c0f){}let _0x2b1759={},_0x3f3d12=![];try{const _0x2c62cb=await _0x46c1a8[_0x240f0a(0x19d)](_0x240f0a(0x183));if(_0x2c62cb&&_0x2c62cb[_0x240f0a(0x167)])_0x2b1759=JSON[_0x240f0a(0x199)](_0x2c62cb['val']);}catch(_0x4ed9ca){}if(_0x2b1759[_0x240f0a(0x1b1)]){const _0x4725cf=Date[_0x240f0a(0x171)]();for(const [_0x215bba,_0x43bd53]of Object[_0x240f0a(0x1c3)](_0x2b1759[_0x240f0a(0x1b1)])){_0x4725cf-_0x43bd53>PENALTY_TTL&&(delete _0x2b1759[_0x215bba],delete _0x2b1759[_0x240f0a(0x1b1)][_0x215bba],_0x3f3d12=!![],_0x46c1a8[_0x240f0a(0x1b2)][_0x240f0a(0x16f)](_0x240f0a(0x14c)+_0x215bba+'\x27\x20nach\x203\x20Tagen\x20abgelaufen.\x20System\x20darf\x20wieder\x20sparen.'));}}const _0x389f91=_0x46c1a8['config'][_0x240f0a(0x17c)]||[];let _0x406cf4=![];for(let _0x8b82bb=_0x115253[_0x240f0a(0x1c1)]-0x1;_0x8b82bb>=0x0;_0x8b82bb--){const _0x88e8b9=_0x115253[_0x8b82bb],_0x6c1696=_0x389f91[_0x240f0a(0x15b)](_0x4aaa89=>normalize(_0x4aaa89[_0x240f0a(0x1e7)])===normalize(_0x88e8b9)&&(_0x4aaa89[_0x240f0a(0x162)]===_0x240f0a(0x13d)||_0x4aaa89[_0x240f0a(0x162)]===_0x240f0a(0x17f)));if(!_0x6c1696){_0x46c1a8[_0x240f0a(0x1b2)][_0x240f0a(0x1a2)](_0x240f0a(0x1bf)+_0x88e8b9+_0x240f0a(0x15d)),_0x115253[_0x240f0a(0x161)](_0x8b82bb,0x1),_0x406cf4=!![];continue;}if(_0x6c1696){const _0x45409d=await findRelatedId(_0x46c1a8,_0x6c1696['id'],_0x240f0a(0x1ee)),_0x411829=await _0x46c1a8[_0x240f0a(0x1c8)](_0x6c1696['id']);if(_0x45409d){const _0x16fa6f=await _0x46c1a8[_0x240f0a(0x1c8)](_0x45409d);if(_0x16fa6f&&typeof _0x16fa6f[_0x240f0a(0x167)]===_0x240f0a(0x194)){let _0xb9db0c=![],_0x20b1d8='';Math['abs'](_0x16fa6f[_0x240f0a(0x167)]-ECO_TEMP)>0.5&&(_0xb9db0c=!![],_0x20b1d8=_0x240f0a(0x1b5));if(!_0xb9db0c&&_0x411829&&typeof _0x411829[_0x240f0a(0x167)]==='number'){const _0x5dfb39=_0x1cf147[_0x88e8b9]||_0x1cf147[_0x240f0a(0x157)]||0x15;_0x411829[_0x240f0a(0x167)]<_0x5dfb39+0.2&&(_0xb9db0c=!![],_0x20b1d8='too_cold');}if(_0xb9db0c){if(_0x20b1d8==='manual'){_0x46c1a8[_0x240f0a(0x1b2)][_0x240f0a(0x16f)](_0x240f0a(0x1b4)+_0x88e8b9+_0x240f0a(0x170)+_0x16fa6f[_0x240f0a(0x167)]+'Â°C\x20(nicht\x20'+ECO_TEMP+'Â°C).\x20Entferne\x20Status.');const _0x144a71=lastActions[_0x240f0a(0x158)+_0x88e8b9],_0x4a0987=_0x144a71&&Date[_0x240f0a(0x171)]()-_0x144a71<0x2*0x3c*0x3e8;if(!_0x4a0987&&_0x16fa6f[_0x240f0a(0x167)]>ECO_TEMP+0.5){_0x46c1a8[_0x240f0a(0x198)]&&(_0x46c1a8[_0x240f0a(0x1b2)][_0x240f0a(0x16f)](_0x240f0a(0x189)+_0x88e8b9+'\x20wurde\x20manuell\x20erhÃ¶ht.'),_0x46c1a8[_0x240f0a(0x198)](_0x240f0a(0x188),{'room':_0x88e8b9}));const _0x3a57c6=_0x88e8b9+'_'+new Date()['getHours']();if(!_0x2b1759[_0x3a57c6]){_0x2b1759[_0x3a57c6]=0x1;if(!_0x2b1759[_0x240f0a(0x1b1)])_0x2b1759[_0x240f0a(0x1b1)]={};_0x2b1759[_0x240f0a(0x1b1)][_0x3a57c6]=Date[_0x240f0a(0x171)](),_0x3f3d12=!![];}}else _0x4a0987&&_0x46c1a8[_0x240f0a(0x1b2)][_0x240f0a(0x16f)](_0x240f0a(0x190)+_0x88e8b9+_0x240f0a(0x1f6));}else{if(_0x20b1d8==='too_cold'){let _0x120c77=![];if(_0x1bb8fc[_0x240f0a(0x15b)](_0x4714b0=>_0x4714b0[_0x240f0a(0x176)]===_0x88e8b9))_0x120c77=!![];const _0x47a209=_0x389f91[_0x240f0a(0x15f)](_0x570e80=>normalize(_0x570e80['location'])===normalize(_0x88e8b9)&&(_0x570e80[_0x240f0a(0x162)]===_0x240f0a(0x1a0)||_0x570e80[_0x240f0a(0x162)]===_0x240f0a(0x186)||_0x570e80[_0x240f0a(0x162)]===_0x240f0a(0x180)));for(const _0x12649f of _0x47a209){try{const _0x31855a=await _0x46c1a8['getForeignStateAsync'](_0x12649f['id']);if(_0x31855a&&(_0x31855a['val']===!![]||_0x31855a[_0x240f0a(0x167)]===0x1||String(_0x31855a[_0x240f0a(0x167)])[_0x240f0a(0x173)]()===_0x240f0a(0x1af)))_0x120c77=!![];}catch(_0x2faae5){}}if(_0x120c77)_0x46c1a8[_0x240f0a(0x1b2)][_0x240f0a(0x16f)](_0x240f0a(0x18f)+_0x88e8b9+_0x240f0a(0x141));else{const _0x570caf=_0x1cf147[_0x88e8b9]||_0x1cf147['default']||0x15;_0x46c1a8['log'][_0x240f0a(0x16f)]('ðŸš¨\x20[MPC\x20WATCHDOG]\x20'+_0x88e8b9+'\x20erreicht\x20Limit\x20('+_0x411829[_0x240f0a(0x167)]+_0x240f0a(0x1c9)+(_0x570caf+0.2)+'Â°C).\x20Sparmodus\x20beendet!'),await _0x46c1a8[_0x240f0a(0x17e)](_0x45409d,_0x570caf),await logAutomationAction(_0x46c1a8,_0x240f0a(0x193)+_0x88e8b9+_0x240f0a(0x143)+_0x570caf+'Â°C'),lastActions[_0x240f0a(0x1cb)+_0x88e8b9]=Date['now']();}}}_0x115253[_0x240f0a(0x161)](_0x8b82bb,0x1),_0x406cf4=!![];}}}}}_0x406cf4&&await _0x46c1a8[_0x240f0a(0x1c0)](_0x2507a0,{'val':JSON[_0x240f0a(0x142)](_0x115253),'ack':!![]}),_0x3f3d12&&await _0x46c1a8[_0x240f0a(0x1c0)](_0x240f0a(0x183),{'val':JSON[_0x240f0a(0x142)](_0x2b1759),'ack':!![]});}catch(_0xc674bb){}}function a1_0x3e3d(){const _0x2f1c25=['messwert','unshift','target','Â°C\x20(Kalender-Schutz)','calendarSelection','split','_date','join','42097NlDsXg','useCalendar','\x20wieder\x20auf\x20','Calendar\x20Check\x20Error:\x20','soll','location','[CAL]\x20','ðŸ“…\x20[ENFORCEMENT]\x20Kalender-Event\x20in\x20','ist','exports','config','Â°C\x20(via\x20','setpoint','[FORCE]\x20','.4.SET_TEMPERATURE','[MPC\x20WARNING]\x20Kein\x20Setpoint\x20fÃ¼r\x20','currentSystemMode','toString','local_temperature','\x20->\x20Schalte\x20','\x20durch\x20Kalender\x20geÃ¤ndert.\x20Keine\x20RL-Strafe.','SET','[MPC]\x20','push','13FLGFTx','active','analysis.energy.ventilationAlerts','\x20gestartet/vorbei.\x20Gebe\x20Raum\x20frei.','temperature','.data.table','thermostatMapping','from','\x20ist\x20zu\x20kalt,\x20ABER\x20Fenster\x20offen/LÃ¼ftung\x20erkannt.\x20Heize\x20NICHT,\x20entferne\x20nur\x20Status.','stringify',':\x20Puffer\x20leer\x20->\x20Heizen\x20auf\x20','ACTUAL_TEMPERATURE','apply','reason','_calName','(((.+)+)+)+$','rÃ¼ckkehr','5882376YWvVIf','6136gdHdMj','ðŸ›¡ï¸\x20[PENALTY\x20EXPIRED]\x20Lern-Schutz\x20fÃ¼r\x20\x27','ACTUAL','Auto-Erkennung','8307LqAHuN','search','replace','ðŸƒ\x20[MPC\x20ACTION]\x20Senke\x20','\x20gefunden!','analysis.energy.warmupTimes','./ai_agent','switch','default','cal_','urlaub\x20ende','level.temperature','find','valve','\x27\x20hat\x20kein\x20GerÃ¤t\x20mehr.\x20LÃ¶sche\x20Eintrag.','analysis.energy.activeEnforcements','filter','313244FraGFw','splice','type','values','Unbekannt','\x20min).','ðŸ”¥\x20[MPC\x20ACTION]\x20Heize\x20','val','sort','ðŸ“…\x20SMART\x20SCHEDULE\x20[','name','\x20auf\x20','pi_heating_demand','current_heating_setpoint','ankunft','info','\x20ist\x20auf\x20','now','Ist','toLowerCase','Â°C\x20(Vorlauf:\x20','approved','room','trim','state','remove','ðŸ“…\x20SMART\x20SCHEDULE\x20(Phase):\x20\x27Globaler\x20Start\x27\x20erkannt.\x20Heize\x20Haus\x20auf\x20(Vorlauf:\x20','level','devices',':\x20Absenkung\x20auf\x20','setForeignStateAsync','thermostat','contact','Fehlt','forEach','analysis.energy.rlPenalties','value.valve','mpc_','sensor','date','TRAIN_RL_PENALTY','ðŸŽ“\x20[RL-FEEDBACK]\x20Lerne\x20aus\x20Fehler:\x20','event','Enforcement\x20Monitor\x20Error:\x20','calendarInstance','hm-rpc','168mBcOmN','ðŸŒ¬ï¸\x20[MPC\x20WATCHDOG]\x20','ðŸ“…\x20[MPC\x20INFO]\x20','isArray','stellwert','[WATCHDOG]\x20','number','actual','Â°C\x20abgesenkt!\x20Zwinge\x20zurÃ¼ck\x20auf\x20','analysis.energy.mpcActiveInterventions','sendToPythonWrapper','parse','light',':\x20Aufheizen\x20auf\x20','error','getStateAsync','score','430WcdUqK','window','Â°C\x20->\x20','warn','analysis.automation.actionLog','.1.SET_POINT_TEMPERATURE','.1.LEVEL','10ZVKxXx','analysis.energy.schedulePreview','minutes_safe','slice','\x20min)','Manuelles\x20Mapping','getTime','summary','Â°C!\x20(Puffer:\x20','open','common','_meta','log','write','ðŸ§¹\x20[MPC\x20CLEANUP]\x20','manual','Nicht\x20gefunden','add','normal','getForeignObjectsAsync','PERFECT','triggerTime','constructor','set','PrÃ¤diktion:\x20','ðŸ§¹\x20[MPC\x20CLEANUP]\x20Raum\x20\x27','setStateAsync','length','string','entries','until','message','6464515cAUQfl','getForeignObjectAsync','getForeignStateAsync','Â°C\x20<\x20','SET_POINT_TEMPERATURE','rescue_','wert','analysis.automation.lastAction','.1.TEMPERATURE','thermostat.setpoint','.1.ACTUAL_TEMPERATURE','41646bZmNKx','indexOf','20sbCkQm','analysis.energy.warmupTargets','380307kdvAXG','off','includes','temp','Â°C!\x20(Puffer\x20leer).'];a1_0x3e3d=function(){return _0x2f1c25;};return a1_0x3e3d();}async function applyEnergySavings(_0x58f218,_0x5a20ab){const _0x47bbe7=a1_0x52276c;await cleanupGhostInterventions(_0x58f218);if(!_0x5a20ab||_0x5a20ab[_0x47bbe7(0x1c1)]===0x0)return;const _0xf05ca6=_0x58f218[_0x47bbe7(0x1ec)][_0x47bbe7(0x17c)]||[],_0x2525bc=Date[_0x47bbe7(0x171)]();for(const _0x4cd2ba of _0x5a20ab){const _0x43a745=_0x4cd2ba[_0x47bbe7(0x176)],_0x2e5294=_0x4cd2ba[_0x47bbe7(0x1a8)],_0x85daf3=_0x4cd2ba['target']||0x15;if(lastActions[_0x47bbe7(0x1cb)+_0x43a745]&&_0x2525bc-lastActions[_0x47bbe7(0x1cb)+_0x43a745]<RESCUE_LOCK_MS)continue;const _0xb9060f=_0xf05ca6['find'](_0x220c29=>normalize(_0x220c29[_0x47bbe7(0x1e7)])===normalize(_0x43a745)&&(_0x220c29[_0x47bbe7(0x162)]===_0x47bbe7(0x13d)||_0x220c29[_0x47bbe7(0x162)]===_0x47bbe7(0x17f)));if(!_0xb9060f)continue;const _0x1669ad=await findRelatedId(_0x58f218,_0xb9060f['id'],'setpoint');if(_0x1669ad){if(lastActions[_0x47bbe7(0x185)+_0x43a745]&&_0x2525bc-lastActions[_0x47bbe7(0x185)+_0x43a745]<0x1e*0x3c*0x3e8)continue;const _0x483396=await _0x58f218[_0x47bbe7(0x1c8)](_0x1669ad);if(_0x483396&&typeof _0x483396[_0x47bbe7(0x167)]===_0x47bbe7(0x194)){const _0x548820=_0x483396['val'];_0x548820!==ECO_TEMP&&await manageMpcIntervention(_0x58f218,_0x43a745,'remove');if(_0x2e5294>0x1e)_0x548820>ECO_TEMP+0.5&&(_0x58f218['log']['info'](_0x47bbe7(0x152)+_0x43a745+_0x47bbe7(0x16b)+ECO_TEMP+_0x47bbe7(0x1ae)+_0x2e5294+_0x47bbe7(0x1aa)),await _0x58f218['setForeignStateAsync'](_0x1669ad,ECO_TEMP),await manageMpcIntervention(_0x58f218,_0x43a745,_0x47bbe7(0x1b7)),lastActions[_0x47bbe7(0x185)+_0x43a745]=_0x2525bc,await logAutomationAction(_0x58f218,'[MPC]\x20'+_0x43a745+_0x47bbe7(0x17d)+ECO_TEMP+'Â°C'));else _0x2e5294<=0xf&&(_0x548820<_0x85daf3&&(_0x58f218['log'][_0x47bbe7(0x16f)](_0x47bbe7(0x166)+_0x43a745+_0x47bbe7(0x1e4)+_0x85daf3+_0x47bbe7(0x1d9)),await _0x58f218[_0x47bbe7(0x17e)](_0x1669ad,_0x85daf3),await manageMpcIntervention(_0x58f218,_0x43a745,_0x47bbe7(0x179)),lastActions['mpc_'+_0x43a745]=_0x2525bc,await logAutomationAction(_0x58f218,_0x47bbe7(0x1f8)+_0x43a745+_0x47bbe7(0x19b)+_0x85daf3+'Â°C')));}}else _0x58f218[_0x47bbe7(0x1b2)][_0x47bbe7(0x1a2)](_0x47bbe7(0x1f1)+_0x43a745+_0x47bbe7(0x153));}}module[a1_0x52276c(0x1eb)]={'handlePrediction':handlePrediction,'applyEnergySavings':applyEnergySavings,'scanThermostats':scanThermostats,'checkCalendarTriggers':checkCalendarTriggers,'monitorEnforcements':monitorEnforcements,'updateSchedulePreview':updateSchedulePreview,'cleanupGhostInterventions':cleanupGhostInterventions};