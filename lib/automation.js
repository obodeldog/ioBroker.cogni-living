const a1_0x54d10e=a1_0x375e;(function(_0x148618,_0x49a743){const _0x364e97=a1_0x375e,_0x4d5440=_0x148618();while(!![]){try{const _0x166a66=parseInt(_0x364e97(0xe4))/0x1+parseInt(_0x364e97(0x156))/0x2+-parseInt(_0x364e97(0x138))/0x3*(parseInt(_0x364e97(0x124))/0x4)+-parseInt(_0x364e97(0x143))/0x5+parseInt(_0x364e97(0x18a))/0x6*(-parseInt(_0x364e97(0x11d))/0x7)+parseInt(_0x364e97(0x130))/0x8*(-parseInt(_0x364e97(0xe5))/0x9)+parseInt(_0x364e97(0x16d))/0xa;if(_0x166a66===_0x49a743)break;else _0x4d5440['push'](_0x4d5440['shift']());}catch(_0x13cf86){_0x4d5440['push'](_0x4d5440['shift']());}}}(a1_0x3104,0xdb369));const a1_0x4dfe83=(function(){let _0x55021c=!![];return function(_0x225447,_0x4e3165){const _0xc54c92=_0x55021c?function(){const _0xaf1fe8=a1_0x375e;if(_0x4e3165){const _0x23ee43=_0x4e3165[_0xaf1fe8(0x17c)](_0x225447,arguments);return _0x4e3165=null,_0x23ee43;}}:function(){};return _0x55021c=![],_0xc54c92;};}()),a1_0x2c5787=a1_0x4dfe83(this,function(){const _0x164ecb=a1_0x375e;return a1_0x2c5787[_0x164ecb(0x10e)]()[_0x164ecb(0x186)](_0x164ecb(0xed))[_0x164ecb(0x10e)]()[_0x164ecb(0x17f)](a1_0x2c5787)[_0x164ecb(0x186)](_0x164ecb(0xed));});a1_0x2c5787();'use strict';const aiAgent=require(a1_0x54d10e(0x191)),COOLDOWN_MS=0x3c*0x3e8,CAL_COOLDOWN_MS=0x5a*0x3c*0x3e8,RESCUE_LOCK_MS=0x78*0x3c*0x3e8,ECO_TEMP=0x11,lastActions={};function normalize(_0xd3742d){const _0x3e31f9=a1_0x54d10e;if(!_0xd3742d)return'';return _0xd3742d[_0x3e31f9(0xf8)]()['replace'](/\s+/g,'')[_0x3e31f9(0x188)]();}async function logAutomationAction(_0x531162,_0x67ca4f){const _0x95abc6=a1_0x54d10e;await _0x531162[_0x95abc6(0x149)]('analysis.automation.lastAction',{'val':_0x67ca4f,'ack':!![]});try{const _0x1ac0f6=_0x95abc6(0xf5),_0x4b6546=await _0x531162[_0x95abc6(0x171)](_0x1ac0f6);let _0x16985d=[];if(_0x4b6546&&_0x4b6546[_0x95abc6(0x106)])try{_0x16985d=JSON[_0x95abc6(0xe6)](_0x4b6546[_0x95abc6(0x106)]);}catch(_0x249ab6){}_0x16985d['unshift']({'ts':Date[_0x95abc6(0x18b)](),'msg':_0x67ca4f});if(_0x16985d['length']>0x32)_0x16985d=_0x16985d[_0x95abc6(0x136)](0x0,0x32);await _0x531162[_0x95abc6(0x149)](_0x1ac0f6,{'val':JSON[_0x95abc6(0x185)](_0x16985d),'ack':!![]});}catch(_0x3ff59f){}}async function handlePrediction(_0x51d4e3,_0x4ac73f,_0x292aa2){const _0xff6f2e=a1_0x54d10e;if(!_0x4ac73f||_0x4ac73f===_0xff6f2e(0xfd))return;let _0x1051b8=_0xff6f2e(0xfc),_0x288465=0.6;try{const _0x2fad64=await _0x51d4e3[_0xff6f2e(0x171)]('analysis.automation.mode');if(_0x2fad64&&_0x2fad64[_0xff6f2e(0x106)])_0x1051b8=_0x2fad64['val'];const _0x4a0e05=await _0x51d4e3['getStateAsync'](_0xff6f2e(0xf4));if(_0x4a0e05&&_0x4a0e05['val'])_0x288465=_0x4a0e05[_0xff6f2e(0x106)];}catch(_0x35a0b8){}if(_0x1051b8===_0xff6f2e(0xfc)||_0x292aa2<_0x288465)return;const _0x51985a=Date[_0xff6f2e(0x18b)]();if(lastActions[_0x4ac73f]&&_0x51985a-lastActions[_0x4ac73f]<COOLDOWN_MS)return;const _0x466ab5=_0x51d4e3[_0xff6f2e(0x18c)][_0xff6f2e(0x11e)]||[],_0x2e7daa=normalize(_0x4ac73f),_0xfdaae5=_0x466ab5[_0xff6f2e(0x17b)](_0x3bdbec=>normalize(_0x3bdbec[_0xff6f2e(0x125)])===_0x2e7daa&&(_0x3bdbec[_0xff6f2e(0x11a)]===_0xff6f2e(0x112)||_0x3bdbec[_0xff6f2e(0x11a)]==='dimmer'||_0x3bdbec['type']==='switch'));if(!_0xfdaae5)return;const _0x1e3376=await aiAgent[_0xff6f2e(0x107)](_0x51d4e3,_0x4ac73f,_0xfdaae5['name'],_0x292aa2);if(!_0x1e3376[_0xff6f2e(0x18d)])return;const _0x43d142=_0xff6f2e(0x137)+_0x4ac73f+_0xff6f2e(0xff)+_0xfdaae5[_0xff6f2e(0x165)]+'\x20('+_0x1e3376[_0xff6f2e(0x145)]+')';await logAutomationAction(_0x51d4e3,'['+_0x1051b8[_0xff6f2e(0x166)]()+']\x20'+_0x43d142);if(_0x1051b8===_0xff6f2e(0x183)){const _0x5a1422=await _0x51d4e3[_0xff6f2e(0xf0)](_0xfdaae5['id']);(!_0x5a1422||!_0x5a1422[_0xff6f2e(0x106)]&&_0x5a1422['val']!==!![])&&await _0x51d4e3[_0xff6f2e(0x141)](_0xfdaae5['id'],!![]),lastActions[_0x4ac73f]=_0x51985a;}}async function findRelatedId(_0x246ea4,_0x5d0064,_0xf9a9d=a1_0x54d10e(0x140)){const _0x365d68=a1_0x54d10e;if(_0xf9a9d==='setpoint'&&_0x246ea4[_0x365d68(0x18c)][_0x365d68(0x163)]){let _0x4e55b5=_0x246ea4['config'][_0x365d68(0x163)];if(typeof _0x4e55b5===_0x365d68(0x175))try{_0x4e55b5=JSON[_0x365d68(0xe6)](_0x4e55b5);}catch(_0x3adb06){}if(_0x4e55b5&&_0x4e55b5[_0x5d0064])return _0x4e55b5[_0x5d0064];}if(_0xf9a9d===_0x365d68(0x181)&&_0x246ea4['config'][_0x365d68(0x190)]){let _0x1ab37c=_0x246ea4[_0x365d68(0x18c)][_0x365d68(0x190)];if(typeof _0x1ab37c===_0x365d68(0x175))try{_0x1ab37c=JSON['parse'](_0x1ab37c);}catch(_0x2d434e){}if(_0x1ab37c&&_0x1ab37c[_0x5d0064])return _0x1ab37c[_0x5d0064];}let _0x2ed4e1=[];if(_0xf9a9d===_0x365d68(0x140))_0x2ed4e1=[{'s':_0x365d68(0x108),'t':'.1.SET_POINT_TEMPERATURE'},{'s':'.1.TEMPERATURE','t':_0x365d68(0x133)},{'s':_0x365d68(0x158),'t':'.4.SET_TEMPERATURE'},{'s':'ACTUAL_TEMPERATURE','t':_0x365d68(0x174)},{'s':_0x365d68(0x10a),'t':'occupied_heating_setpoint'},{'s':'local_temperature','t':_0x365d68(0x13e)},{'s':_0x365d68(0x17d),'t':_0x365d68(0xef)},{'s':_0x365d68(0x135),'t':_0x365d68(0x160)},{'s':_0x365d68(0x104),'t':_0x365d68(0x12a)},{'s':_0x365d68(0x17d),'t':_0x365d68(0x140)}];else _0xf9a9d===_0x365d68(0x181)&&(_0x2ed4e1=[{'s':'.1.ACTUAL_TEMPERATURE','t':_0x365d68(0x15e)},{'s':_0x365d68(0x158),'t':'.1.LEVEL'},{'s':_0x365d68(0x158),'t':_0x365d68(0x18e)},{'s':_0x365d68(0x10a),'t':_0x365d68(0x161)},{'s':_0x365d68(0x17d),'t':_0x365d68(0x14e)},{'s':_0x365d68(0x17d),'t':_0x365d68(0x139)}]);for(const _0x15e7f0 of _0x2ed4e1){if(_0x5d0064['includes'](_0x15e7f0['s'])){const _0x42f6c8=_0x5d0064[_0x365d68(0x176)](_0x15e7f0['s'],_0x15e7f0['t']),_0xbeec9e=await _0x246ea4[_0x365d68(0x118)](_0x42f6c8);if(_0xbeec9e)return _0x42f6c8;}}try{const _0x3979cb=_0x5d0064[_0x365d68(0x134)]('.');if(_0x3979cb['length']>0x2){const _0x5f2af2=_0x3979cb[_0x365d68(0x136)](0x0,-0x1)['join']('.'),_0x383f84=await _0x246ea4['getForeignObjectsAsync'](_0x5f2af2+'.*'),_0x3fab06=[],_0x33079b=_0x5d0064[_0x365d68(0x134)](/[._]+/)[_0x365d68(0x12b)](_0x39d198=>![_0x365d68(0xe8),'0',_0x365d68(0x151),'ist',_0x365d68(0x132),_0x365d68(0x17d),_0x365d68(0x110),'sensor',_0x365d68(0x11f),_0x365d68(0x173)][_0x365d68(0x12e)](_0x39d198['toLowerCase']()));for(const [_0x2f7d34,_0x52810b]of Object[_0x365d68(0x18f)](_0x383f84)){if(_0x2f7d34===_0x5d0064)continue;if(_0x52810b&&_0x52810b[_0x365d68(0x11b)]){const _0x4bbf51=_0x2f7d34[_0x365d68(0xf8)](),_0x43b64b=(_0x52810b[_0x365d68(0x11b)][_0x365d68(0x153)]||'')[_0x365d68(0xf8)](),_0xd80008=(_0x52810b[_0x365d68(0x11b)][_0x365d68(0x148)]||'')['toLowerCase']();let _0x200865=![];if(_0xf9a9d===_0x365d68(0x140)&&_0x52810b['common']['write']===!![])_0x200865=_0x4bbf51[_0x365d68(0x12e)](_0x365d68(0x167))||_0x4bbf51[_0x365d68(0x12e)]('soll')||_0x4bbf51[_0x365d68(0x12e)](_0x365d68(0x113))||_0x43b64b[_0x365d68(0x12e)]('level.temperature')||_0x43b64b[_0x365d68(0x12e)]('thermostat.setpoint');else _0xf9a9d===_0x365d68(0x181)&&(_0x200865=_0x4bbf51[_0x365d68(0x12e)](_0x365d68(0x139))||_0x4bbf51['includes'](_0x365d68(0x181))||_0x4bbf51['includes'](_0x365d68(0xea))||_0x4bbf51[_0x365d68(0x12e)](_0x365d68(0x12c))||_0x43b64b[_0x365d68(0x12e)](_0x365d68(0x109))||_0x43b64b[_0x365d68(0x12e)]('value.valve')||_0xd80008[_0x365d68(0x12e)]('%'));if(_0x200865){const _0x53c49a=_0x2f7d34[_0x365d68(0x134)](/[._]+/)[_0x365d68(0x121)](_0x382f5d=>_0x382f5d[_0x365d68(0xf8)]());let _0x2a7841=0x0;_0x33079b[_0x365d68(0x101)](_0x42128d=>{const _0x1ad029=_0x365d68;if(_0x53c49a[_0x1ad029(0x12e)](_0x42128d[_0x1ad029(0xf8)]()))_0x2a7841++;}),_0x3fab06[_0x365d68(0x15c)]({'id':_0x2f7d34,'score':_0x2a7841});}}}if(_0x3fab06['length']>0x0){_0x3fab06[_0x365d68(0x15f)]((_0x3315a7,_0x2fd644)=>_0x2fd644['score']-_0x3315a7[_0x365d68(0x155)]);if(_0x3fab06[0x0][_0x365d68(0x155)]>0x0)return _0x3fab06[0x0]['id'];}}}catch(_0x20d2f7){}return null;}async function scanThermostats(_0x48c2d3){const _0x17c558=a1_0x54d10e,_0x295b64=_0x48c2d3[_0x17c558(0x18c)][_0x17c558(0x11e)]||[],_0x27f68d=[],_0x102775=_0x295b64[_0x17c558(0x12b)](_0x4e2402=>_0x4e2402['id']&&_0x4e2402['id'][_0x17c558(0x12e)](_0x17c558(0x17d))||_0x4e2402[_0x17c558(0x11a)]&&[_0x17c558(0x17d),_0x17c558(0xeb),_0x17c558(0x150)][_0x17c558(0x12e)](_0x4e2402[_0x17c558(0x11a)])||_0x4e2402[_0x17c558(0x165)]&&_0x4e2402['name'][_0x17c558(0xf8)]()[_0x17c558(0x12e)](_0x17c558(0x103)));for(const _0xf6e737 of _0x102775){const _0x186f34=await findRelatedId(_0x48c2d3,_0xf6e737['id'],_0x17c558(0x140)),_0x1a2c24=await findRelatedId(_0x48c2d3,_0xf6e737['id'],_0x17c558(0x181));let _0x537f34='Nicht\x20gefunden',_0x163000=![],_0x22d9f4=_0x48c2d3[_0x17c558(0x18c)][_0x17c558(0x163)]||{};if(typeof _0x22d9f4===_0x17c558(0x175))try{_0x22d9f4=JSON[_0x17c558(0xe6)](_0x22d9f4);}catch(_0x1c3c36){}let _0x5116a2=_0x48c2d3[_0x17c558(0x18c)][_0x17c558(0x190)]||{};if(typeof _0x5116a2===_0x17c558(0x175))try{_0x5116a2=JSON[_0x17c558(0xe6)](_0x5116a2);}catch(_0x2644f4){}if(_0x22d9f4[_0xf6e737['id']]&&_0x22d9f4[_0xf6e737['id']]===_0x186f34||_0x5116a2[_0xf6e737['id']]&&_0x5116a2[_0xf6e737['id']]===_0x1a2c24)_0x537f34=_0x17c558(0xfa),_0x163000=!![];else(_0x186f34||_0x1a2c24)&&(_0x537f34=_0x17c558(0xe7));_0x27f68d[_0x17c558(0x15c)]({'room':_0xf6e737[_0x17c558(0x125)]||_0x17c558(0x16f),'sensorId':_0xf6e737['id'],'setpointId':_0x186f34||'-','valveId':_0x1a2c24||'-','source':_0x537f34,'isManual':_0x163000,'status':_0x186f34&&_0x1a2c24?'PERFECT':_0x186f34?'OK':_0x17c558(0x154)});}return _0x27f68d[_0x17c558(0x15f)]((_0x943977,_0x49683c)=>_0x943977[_0x17c558(0x177)]['localeCompare'](_0x49683c[_0x17c558(0x177)]));}async function updateSchedulePreview(_0xb0a7ab){const _0x5e3319=a1_0x54d10e;if(!_0xb0a7ab['config'][_0x5e3319(0x16a)]||!_0xb0a7ab[_0x5e3319(0x18c)]['calendarInstance'])return;let _0x58b97a={};try{const _0x26c8d9=await _0xb0a7ab['getStateAsync'](_0x5e3319(0x168));if(_0x26c8d9&&_0x26c8d9[_0x5e3319(0x106)])_0x58b97a=JSON[_0x5e3319(0xe6)](_0x26c8d9[_0x5e3319(0x106)]);}catch(_0xa7ceb7){}const _0x3189bf=[],_0x452d17=Date['now'](),_0x509a2b=0x30*0x3c*0x3c*0x3e8;try{const _0xfa447f=await _0xb0a7ab[_0x5e3319(0xf0)](_0xb0a7ab[_0x5e3319(0x18c)][_0x5e3319(0x123)]+_0x5e3319(0x187));if(!_0xfa447f||!_0xfa447f['val'])return;const _0x51b2f9=JSON[_0x5e3319(0xe6)](_0xfa447f['val']),_0x1532d0=_0xb0a7ab[_0x5e3319(0x18c)][_0x5e3319(0x126)]||[],_0x431be4=_0xb0a7ab[_0x5e3319(0x18c)][_0x5e3319(0x11e)]||[],_0x1da9c9=new Set();_0x431be4[_0x5e3319(0x101)](_0x407ec7=>{const _0x412962=_0x5e3319;if(_0x407ec7['location'])_0x1da9c9[_0x412962(0xf6)](_0x407ec7['location']);});for(const _0x53e0f8 of _0x51b2f9){if(_0x53e0f8['_calName']&&_0x1532d0['length']>0x0&&!_0x1532d0[_0x5e3319(0x12e)](_0x53e0f8[_0x5e3319(0x13d)]))continue;const _0x16d79a=_0x53e0f8[_0x5e3319(0x178)]||_0x53e0f8[_0x5e3319(0x129)]||_0x53e0f8['date'];if(!_0x16d79a)continue;const _0xbfc587=new Date(_0x16d79a),_0x51d7da=_0xbfc587['getTime']();if(isNaN(_0x51d7da))continue;if(_0x51d7da<_0x452d17)continue;if(_0x51d7da>_0x452d17+_0x509a2b)continue;const _0x596f8a=(_0x53e0f8[_0x5e3319(0xfe)]||_0x53e0f8[_0x5e3319(0xf1)]||'')[_0x5e3319(0xf8)]();let _0x34de84=![],_0x2ed980=[],_0xe5a606=_0x53e0f8[_0x5e3319(0xfe)]||_0x53e0f8['summary']||'Unbekannt';if(_0x596f8a[_0x5e3319(0x12e)](_0x5e3319(0x14c))||_0x596f8a[_0x5e3319(0x12e)](_0x5e3319(0x169))||_0x596f8a['includes'](_0x5e3319(0x146)))_0x34de84=!![],_0x2ed980=Array[_0x5e3319(0x170)](_0x1da9c9);else for(const _0x3d3921 of _0x1da9c9){if(_0x596f8a[_0x5e3319(0x12e)](_0x3d3921[_0x5e3319(0xf8)]()))_0x2ed980[_0x5e3319(0x15c)](_0x3d3921);}_0x2ed980['length']>0x0&&_0x2ed980[_0x5e3319(0x101)](_0x57a343=>{const _0x27ecd7=_0x5e3319;let _0x46106a=0x3c;if(_0x34de84){let _0x7dea90=0x0;Object[_0x27ecd7(0x13b)](_0x58b97a)[_0x27ecd7(0x101)](_0x4e8f48=>{if(_0x4e8f48>_0x7dea90)_0x7dea90=_0x4e8f48;}),_0x46106a=_0x7dea90>0x0?_0x7dea90:0x78;}else _0x46106a=_0x58b97a[_0x57a343]||0x3c;const _0x3de2c7=new Date(_0x51d7da-_0x46106a*0xea60);_0x3189bf[_0x27ecd7(0x15c)]({'eventTime':_0x51d7da,'triggerTime':_0x3de2c7['getTime'](),'room':_0x57a343,'minutes':_0x46106a,'reason':_0xe5a606,'isGlobal':_0x34de84});});}}catch(_0x37a44f){}_0x3189bf[_0x5e3319(0x15f)]((_0x213915,_0x3947ac)=>_0x213915[_0x5e3319(0xf3)]-_0x3947ac[_0x5e3319(0xf3)]);const _0xb90143=_0x3189bf[_0x5e3319(0x136)](0x0,0x5);await _0xb0a7ab[_0x5e3319(0x149)]('analysis.energy.schedulePreview',{'val':JSON[_0x5e3319(0x185)](_0xb90143),'ack':!![]});}async function checkCalendarTriggers(_0x8036e1){const _0x3bff53=a1_0x54d10e;if(!_0x8036e1[_0x3bff53(0x18c)][_0x3bff53(0x16a)]||!_0x8036e1[_0x3bff53(0x18c)][_0x3bff53(0x123)])return;await updateSchedulePreview(_0x8036e1);let _0x3a9f15={},_0x5ee191={};try{const _0x4d9a7c=await _0x8036e1[_0x3bff53(0x171)](_0x3bff53(0x168));if(_0x4d9a7c&&_0x4d9a7c[_0x3bff53(0x106)])_0x3a9f15=JSON[_0x3bff53(0xe6)](_0x4d9a7c[_0x3bff53(0x106)]);const _0x48ad77=await _0x8036e1[_0x3bff53(0x171)]('analysis.energy.warmupSources');if(_0x48ad77&&_0x48ad77[_0x3bff53(0x106)])_0x5ee191=JSON['parse'](_0x48ad77[_0x3bff53(0x106)]);}catch(_0x104acf){}let _0x2f2f0e={'default':0x15};try{const _0x2d8f12=await _0x8036e1[_0x3bff53(0x171)](_0x3bff53(0xf2));if(_0x2d8f12&&_0x2d8f12['val'])_0x2f2f0e=JSON['parse'](_0x2d8f12['val']);}catch(_0x1d0bfe){}try{const _0x364e7f=await _0x8036e1[_0x3bff53(0xf0)](_0x8036e1['config'][_0x3bff53(0x123)]+_0x3bff53(0x187));if(!_0x364e7f||!_0x364e7f[_0x3bff53(0x106)])return;const _0x50e4e3=JSON['parse'](_0x364e7f[_0x3bff53(0x106)]),_0x4318be=Date[_0x3bff53(0x18b)](),_0x185f5d=_0x8036e1[_0x3bff53(0x18c)][_0x3bff53(0x11e)]||[],_0x260b1e=_0x8036e1['config'][_0x3bff53(0x126)]||[];for(const _0x13b517 of _0x50e4e3){if(_0x13b517['_calName']&&_0x260b1e[_0x3bff53(0x182)]>0x0&&!_0x260b1e['includes'](_0x13b517[_0x3bff53(0x13d)]))continue;const _0x442d99=_0x13b517['_date']||_0x13b517[_0x3bff53(0x129)]||_0x13b517['date'];if(!_0x442d99)continue;const _0xfaaf89=new Date(_0x442d99);if(isNaN(_0xfaaf89[_0x3bff53(0x117)]()))continue;const _0x49fb65=(_0x13b517['event']||_0x13b517[_0x3bff53(0xf1)]||'')[_0x3bff53(0xf8)]();if(_0x49fb65[_0x3bff53(0x12e)](_0x3bff53(0x14c))||_0x49fb65[_0x3bff53(0x12e)](_0x3bff53(0x169))||_0x49fb65['includes'](_0x3bff53(0x146))){let _0x116668=0x0;Object[_0x3bff53(0x13b)](_0x3a9f15)[_0x3bff53(0x101)](_0x52a76d=>{if(_0x52a76d>_0x116668)_0x116668=_0x52a76d;});if(_0x116668===0x0)_0x116668=0x78;const _0x31a5e0=_0xfaaf89[_0x3bff53(0x117)]()-_0x116668*0xea60;_0x4318be>=_0x31a5e0&&_0x4318be<_0xfaaf89[_0x3bff53(0x117)]()&&(_0x8036e1[_0x3bff53(0x13c)]!=='normal'&&(_0x8036e1['log']['info'](_0x3bff53(0xee)+_0x116668+_0x3bff53(0x147)),await _0x8036e1['setStateAsync'](_0x3bff53(0xf9),{'val':_0x3bff53(0xec),'ack':![]})));}for(const _0x204bcd of _0x185f5d){if(_0x204bcd[_0x3bff53(0x125)]){const _0x281038=_0x204bcd[_0x3bff53(0x125)][_0x3bff53(0xf8)]();if(_0x49fb65[_0x3bff53(0x12e)](_0x281038)){const _0x288eb7=_0x3a9f15[_0x204bcd['location']]||0x3c,_0x1f3e15=_0x5ee191[_0x204bcd[_0x3bff53(0x125)]]||_0x3bff53(0x15b),_0x4cb5db=_0xfaaf89['getTime']()-_0x288eb7*0xea60;if(_0x4318be>=_0x4cb5db&&_0x4318be<_0xfaaf89[_0x3bff53(0x117)]()){const _0x4c3272=lastActions[_0x3bff53(0x142)+_0x204bcd[_0x3bff53(0x125)]];if(_0x4c3272&&_0x4318be-_0x4c3272<CAL_COOLDOWN_MS)continue;const _0x4117e5=await findRelatedId(_0x8036e1,_0x204bcd['id'],'setpoint');if(_0x4117e5){let _0x2ed813=_0x2f2f0e[_0x204bcd['location']];if(_0x2ed813===undefined)_0x2ed813=_0x2f2f0e[_0x3bff53(0x131)];if(_0x2ed813===undefined)_0x2ed813=0x15;const _0x38bfd0=await _0x8036e1[_0x3bff53(0xf0)](_0x4117e5);_0x38bfd0&&typeof _0x38bfd0[_0x3bff53(0x106)]===_0x3bff53(0x14a)&&_0x38bfd0[_0x3bff53(0x106)]<_0x2ed813-0.5&&(_0x8036e1[_0x3bff53(0x120)][_0x3bff53(0x179)]('ðŸ“…\x20SMART\x20SCHEDULE\x20['+_0x1f3e15+']:\x20Raum-Trigger\x20\x27'+_0x204bcd['location']+_0x3bff53(0x10f)+_0x2ed813+'Â°C\x20(Vorlauf:\x20'+_0x288eb7+'\x20min).'),await _0x8036e1[_0x3bff53(0x141)](_0x4117e5,_0x2ed813),await logAutomationAction(_0x8036e1,'[CAL]\x20'+_0x204bcd[_0x3bff53(0x125)]+_0x3bff53(0x172)+_0x2ed813+_0x3bff53(0xe9)+_0x1f3e15+')'),lastActions['cal_'+_0x204bcd[_0x3bff53(0x125)]]=_0x4318be);}}}}}}}catch(_0x3a03d8){_0x8036e1[_0x3bff53(0x120)]['warn']('Calendar\x20Check\x20Error:\x20'+_0x3a03d8['message']);}}function a1_0x3104(){const _0x2ac91a=['contact','reason','ankunft','\x20min).','unit','setStateAsync','number','ðŸ”¥\x20[MPC\x20ACTION]\x20Heize\x20','urlaub\x20ende','Â°C).\x20Entferne\x20Status.','valve_position','analysis.energy.mpcActiveInterventions','sensor','hm-rpc','too_cold','role','Fehlt','score','2066644iMHYiE','ðŸ§¹\x20[MPC\x20CLEANUP]\x20','.1.TEMPERATURE','open','warn','Classic','push',':\x20Absenkung\x20auf\x20','.1.LEVEL','sort','SET','pi_heating_demand','minutes_safe','thermostatMapping','manual','name','toUpperCase','set','analysis.energy.warmupTimes','rÃ¼ckkehr','useCalendar','splice','indexOf','19707920tgHqJq','ðŸƒ\x20[MPC\x20ACTION]\x20Senke\x20','Unbekannt','from','getStateAsync','\x20->\x20','state','SET_POINT_TEMPERATURE','string','replace','room','_date','info','Â°C!\x20(Puffer:\x20','find','apply','temperature','ðŸŒ¬ï¸\x20[MPC\x20WATCHDOG]\x20','constructor','\x20wurde\x20manuell\x20erhÃ¶ht.','valve','length','active','Â°C\x20(nicht\x20','stringify','search','.data.table','trim',':\x20Aufheizen\x20auf\x20','794838gaTdrX','now','config','approved','.4.VALVE_STATE','entries','valveMapping','./ai_agent','ðŸ§¹\x20[MPC\x20CLEANUP]\x20Raum\x20\x27','[MPC\x20WARNING]\x20Kein\x20Setpoint\x20fÃ¼r\x20','TRAIN_RL_PENALTY','ðŸš¨\x20[MPC\x20WATCHDOG]\x20','1169368OoeXrj','571266ksUwqS','parse','Auto-Erkennung','openknx','Â°C\x20(via\x20','stellwert','thermostat','normal','(((.+)+)+)+$','ðŸ“…\x20SMART\x20SCHEDULE\x20(Phase):\x20\x27Globaler\x20Start\x27\x20erkannt.\x20Heize\x20Haus\x20auf\x20(Vorlauf:\x20','target_temperature','getForeignStateAsync','summary','analysis.energy.warmupTargets','triggerTime','analysis.automation.confidenceThreshold','analysis.automation.actionLog','add','ðŸŽ“\x20[RL-FEEDBACK]\x20Lerne\x20aus\x20Fehler:\x20','toLowerCase','system.mode','Manuelles\x20Mapping','\x20min)','off','Unknown','event','\x20->\x20Schalte\x20','Â°C\x20<\x20','forEach','rescue_','temp','Ist','[MPC]\x20','val','consultButler','.1.ACTUAL_TEMPERATURE','level.valve','local_temperature','\x20durch\x20Kalender\x20geÃ¤ndert.\x20Keine\x20RL-Strafe.','\x20gefunden!','[WATCHDOG]\x20','toString','\x27\x20aktiv.\x20Heize\x20auf\x20','actual','Â°C!\x20(Puffer\x20leer).','light','target','abs','\x20ist\x20auf\x20',':\x20Puffer\x20leer\x20->\x20Heizen\x20auf\x20','getTime','getForeignObjectAsync','remove','type','common','\x20erreicht\x20Limit\x20(','63aFRBJT','devices','messwert','log','map','mpc_','calendarInstance','16ZjeQyz','location','calendarSelection','exports','isArray','eventStart','Soll','filter','position','window','includes','sendToPythonWrapper','144WzMPLR','default','wert','.1.SET_POINT_TEMPERATURE','split','ACTUAL','slice','PrÃ¤diktion:\x20','46242acqrtO','level','ðŸ“…\x20[MPC\x20INFO]\x20','values','currentSystemMode','_calName','current_heating_setpoint','analysis.energy.ventilationAlerts','setpoint','setForeignStateAsync','cal_','4395700YLHKRS'];a1_0x3104=function(){return _0x2ac91a;};return a1_0x3104();}async function manageMpcIntervention(_0x547334,_0x39436d,_0x5ba45a){const _0x108769=a1_0x54d10e;try{const _0x5a51f4=_0x108769(0x14f),_0x1f2996=await _0x547334['getStateAsync'](_0x5a51f4);let _0x377f53=[];if(_0x1f2996&&_0x1f2996[_0x108769(0x106)])try{_0x377f53=JSON[_0x108769(0xe6)](_0x1f2996[_0x108769(0x106)]);}catch(_0x452a93){}const _0x15ed26=_0x377f53[_0x108769(0x16c)](_0x39436d);if(_0x5ba45a===_0x108769(0xf6))_0x15ed26===-0x1&&(_0x377f53[_0x108769(0x15c)](_0x39436d),await _0x547334[_0x108769(0x149)](_0x5a51f4,{'val':JSON[_0x108769(0x185)](_0x377f53),'ack':!![]}));else _0x5ba45a==='remove'&&(_0x15ed26!==-0x1&&(_0x377f53[_0x108769(0x16b)](_0x15ed26,0x1),await _0x547334[_0x108769(0x149)](_0x5a51f4,{'val':JSON['stringify'](_0x377f53),'ack':!![]})));}catch(_0x43b9c6){}}async function cleanupGhostInterventions(_0x2aec23){const _0x13ac5c=a1_0x54d10e;try{const _0x30b117=_0x13ac5c(0x14f),_0x819c47=await _0x2aec23[_0x13ac5c(0x171)](_0x30b117);if(!_0x819c47||!_0x819c47['val'])return;const _0x5d60b1=JSON[_0x13ac5c(0xe6)](_0x819c47['val']);if(!Array[_0x13ac5c(0x128)](_0x5d60b1)||_0x5d60b1[_0x13ac5c(0x182)]===0x0)return;let _0x58ec07={'default':0x15};try{const _0x54d680=await _0x2aec23[_0x13ac5c(0x171)](_0x13ac5c(0xf2));if(_0x54d680&&_0x54d680['val'])_0x58ec07=JSON[_0x13ac5c(0xe6)](_0x54d680[_0x13ac5c(0x106)]);}catch(_0x2a07ca){}let _0x81c12e=[];try{const _0x560384=await _0x2aec23[_0x13ac5c(0x171)](_0x13ac5c(0x13f));if(_0x560384&&_0x560384[_0x13ac5c(0x106)])_0x81c12e=JSON[_0x13ac5c(0xe6)](_0x560384['val']);}catch(_0x5b18ef){}const _0x408897=_0x2aec23[_0x13ac5c(0x18c)][_0x13ac5c(0x11e)]||[];let _0x29f821=![];for(let _0x86919a=_0x5d60b1[_0x13ac5c(0x182)]-0x1;_0x86919a>=0x0;_0x86919a--){const _0x55579e=_0x5d60b1[_0x86919a],_0x4d3fd3=_0x408897[_0x13ac5c(0x17b)](_0x433e03=>normalize(_0x433e03[_0x13ac5c(0x125)])===normalize(_0x55579e)&&(_0x433e03[_0x13ac5c(0x11a)]===_0x13ac5c(0x17d)||_0x433e03[_0x13ac5c(0x11a)]===_0x13ac5c(0xeb)));if(!_0x4d3fd3){_0x2aec23[_0x13ac5c(0x120)][_0x13ac5c(0x15a)](_0x13ac5c(0x192)+_0x55579e+'\x27\x20hat\x20kein\x20GerÃ¤t\x20mehr.\x20LÃ¶sche\x20Eintrag.'),_0x5d60b1[_0x13ac5c(0x16b)](_0x86919a,0x1),_0x29f821=!![];continue;}if(_0x4d3fd3){const _0x35c11d=await findRelatedId(_0x2aec23,_0x4d3fd3['id'],'setpoint'),_0x5121e6=await _0x2aec23['getForeignStateAsync'](_0x4d3fd3['id']);if(_0x35c11d){const _0x3ab35b=await _0x2aec23['getForeignStateAsync'](_0x35c11d);if(_0x3ab35b&&typeof _0x3ab35b[_0x13ac5c(0x106)]===_0x13ac5c(0x14a)){let _0x19c440=![],_0x3e6dc3='';Math[_0x13ac5c(0x114)](_0x3ab35b[_0x13ac5c(0x106)]-ECO_TEMP)>0.5&&(_0x19c440=!![],_0x3e6dc3=_0x13ac5c(0x164));if(!_0x19c440&&_0x5121e6&&typeof _0x5121e6['val']==='number'){const _0x393fbc=_0x58ec07[_0x55579e]||_0x58ec07[_0x13ac5c(0x131)]||0x15;_0x5121e6[_0x13ac5c(0x106)]<_0x393fbc+0.2&&(_0x19c440=!![],_0x3e6dc3=_0x13ac5c(0x152));}if(_0x19c440){if(_0x3e6dc3==='manual'){_0x2aec23[_0x13ac5c(0x120)][_0x13ac5c(0x179)](_0x13ac5c(0x157)+_0x55579e+_0x13ac5c(0x115)+_0x3ab35b['val']+_0x13ac5c(0x184)+ECO_TEMP+_0x13ac5c(0x14d));const _0x3608c4=lastActions[_0x13ac5c(0x142)+_0x55579e],_0x16c834=_0x3608c4&&Date['now']()-_0x3608c4<0x2*0x3c*0x3e8;if(!_0x16c834&&_0x3ab35b[_0x13ac5c(0x106)]>ECO_TEMP+0.5)_0x2aec23[_0x13ac5c(0x12f)]&&(_0x2aec23[_0x13ac5c(0x120)][_0x13ac5c(0x179)](_0x13ac5c(0xf7)+_0x55579e+_0x13ac5c(0x180)),_0x2aec23['sendToPythonWrapper'](_0x13ac5c(0x194),{'room':_0x55579e}));else _0x16c834&&_0x2aec23[_0x13ac5c(0x120)][_0x13ac5c(0x179)](_0x13ac5c(0x13a)+_0x55579e+_0x13ac5c(0x10b));}else{if(_0x3e6dc3==='too_cold'){let _0xa6de30=![];if(_0x81c12e[_0x13ac5c(0x17b)](_0x3a619a=>_0x3a619a[_0x13ac5c(0x177)]===_0x55579e))_0xa6de30=!![];const _0x51d3e1=_0x408897[_0x13ac5c(0x12b)](_0x17bcbb=>normalize(_0x17bcbb[_0x13ac5c(0x125)])===normalize(_0x55579e)&&(_0x17bcbb[_0x13ac5c(0x11a)]===_0x13ac5c(0x12d)||_0x17bcbb['type']==='sensor'||_0x17bcbb[_0x13ac5c(0x11a)]===_0x13ac5c(0x144)));for(const _0x5a2665 of _0x51d3e1){try{const _0x3dd3d8=await _0x2aec23[_0x13ac5c(0xf0)](_0x5a2665['id']);if(_0x3dd3d8&&(_0x3dd3d8[_0x13ac5c(0x106)]===!![]||_0x3dd3d8[_0x13ac5c(0x106)]===0x1||String(_0x3dd3d8[_0x13ac5c(0x106)])[_0x13ac5c(0xf8)]()===_0x13ac5c(0x159)))_0xa6de30=!![];}catch(_0x20aa72){}}if(_0xa6de30)_0x2aec23['log'][_0x13ac5c(0x179)](_0x13ac5c(0x17e)+_0x55579e+'\x20ist\x20zu\x20kalt,\x20ABER\x20Fenster\x20offen/LÃ¼ftung\x20erkannt.\x20Heize\x20NICHT,\x20entferne\x20nur\x20Status.');else{const _0xc17af4=_0x58ec07[_0x55579e]||_0x58ec07[_0x13ac5c(0x131)]||0x15;_0x2aec23[_0x13ac5c(0x120)]['info'](_0x13ac5c(0x195)+_0x55579e+_0x13ac5c(0x11c)+_0x5121e6[_0x13ac5c(0x106)]+_0x13ac5c(0x100)+(_0xc17af4+0.2)+'Â°C).\x20Sparmodus\x20beendet!'),await _0x2aec23[_0x13ac5c(0x141)](_0x35c11d,_0xc17af4),await logAutomationAction(_0x2aec23,_0x13ac5c(0x10d)+_0x55579e+_0x13ac5c(0x116)+_0xc17af4+'Â°C'),lastActions[_0x13ac5c(0x102)+_0x55579e]=Date[_0x13ac5c(0x18b)]();}}}_0x5d60b1[_0x13ac5c(0x16b)](_0x86919a,0x1),_0x29f821=!![];}}}}}_0x29f821&&await _0x2aec23[_0x13ac5c(0x149)](_0x30b117,{'val':JSON['stringify'](_0x5d60b1),'ack':!![]});}catch(_0x504e8c){}}function a1_0x375e(_0x3d9663,_0x2fb89a){const _0x214c59=a1_0x3104();return a1_0x375e=function(_0x2c5787,_0x4dfe83){_0x2c5787=_0x2c5787-0xe4;let _0x31040d=_0x214c59[_0x2c5787];return _0x31040d;},a1_0x375e(_0x3d9663,_0x2fb89a);}async function applyEnergySavings(_0x941030,_0x1b97e3){const _0x3f66e7=a1_0x54d10e;await cleanupGhostInterventions(_0x941030);if(!_0x1b97e3||_0x1b97e3[_0x3f66e7(0x182)]===0x0)return;const _0xdc4da9=_0x941030[_0x3f66e7(0x18c)][_0x3f66e7(0x11e)]||[],_0x51675e=Date[_0x3f66e7(0x18b)]();for(const _0x51eabb of _0x1b97e3){const _0x314542=_0x51eabb['room'],_0xd34c6d=_0x51eabb[_0x3f66e7(0x162)],_0x49e48a=_0x51eabb['target']||0x15;if(lastActions[_0x3f66e7(0x102)+_0x314542]&&_0x51675e-lastActions[_0x3f66e7(0x102)+_0x314542]<RESCUE_LOCK_MS)continue;const _0x357f0c=_0xdc4da9[_0x3f66e7(0x17b)](_0x2afd1c=>normalize(_0x2afd1c[_0x3f66e7(0x125)])===normalize(_0x314542)&&(_0x2afd1c[_0x3f66e7(0x11a)]===_0x3f66e7(0x17d)||_0x2afd1c[_0x3f66e7(0x11a)]===_0x3f66e7(0xeb)));if(!_0x357f0c)continue;const _0x4ef3f4=await findRelatedId(_0x941030,_0x357f0c['id'],_0x3f66e7(0x140));if(_0x4ef3f4){if(lastActions[_0x3f66e7(0x122)+_0x314542]&&_0x51675e-lastActions['mpc_'+_0x314542]<0x1e*0x3c*0x3e8)continue;const _0xc8c2da=await _0x941030[_0x3f66e7(0xf0)](_0x4ef3f4);if(_0xc8c2da&&typeof _0xc8c2da[_0x3f66e7(0x106)]===_0x3f66e7(0x14a)){const _0x2974cd=_0xc8c2da[_0x3f66e7(0x106)];_0x2974cd!==ECO_TEMP&&await manageMpcIntervention(_0x941030,_0x314542,'remove');if(_0xd34c6d>0x1e)_0x2974cd>ECO_TEMP+0.5&&(_0x941030['log'][_0x3f66e7(0x179)](_0x3f66e7(0x16e)+_0x314542+'\x20auf\x20'+ECO_TEMP+_0x3f66e7(0x17a)+_0xd34c6d+_0x3f66e7(0xfb)),await _0x941030[_0x3f66e7(0x141)](_0x4ef3f4,ECO_TEMP),await manageMpcIntervention(_0x941030,_0x314542,_0x3f66e7(0xf6)),lastActions[_0x3f66e7(0x122)+_0x314542]=_0x51675e,await logAutomationAction(_0x941030,_0x3f66e7(0x105)+_0x314542+_0x3f66e7(0x15d)+ECO_TEMP+'Â°C'));else _0xd34c6d<=0xf&&(_0x2974cd<_0x49e48a&&(_0x941030[_0x3f66e7(0x120)][_0x3f66e7(0x179)](_0x3f66e7(0x14b)+_0x314542+'\x20wieder\x20auf\x20'+_0x49e48a+_0x3f66e7(0x111)),await _0x941030[_0x3f66e7(0x141)](_0x4ef3f4,_0x49e48a),await manageMpcIntervention(_0x941030,_0x314542,_0x3f66e7(0x119)),lastActions[_0x3f66e7(0x122)+_0x314542]=_0x51675e,await logAutomationAction(_0x941030,_0x3f66e7(0x105)+_0x314542+_0x3f66e7(0x189)+_0x49e48a+'Â°C')));}}else _0x941030[_0x3f66e7(0x120)][_0x3f66e7(0x15a)](_0x3f66e7(0x193)+_0x314542+_0x3f66e7(0x10c));}}module[a1_0x54d10e(0x127)]={'handlePrediction':handlePrediction,'applyEnergySavings':applyEnergySavings,'scanThermostats':scanThermostats,'checkCalendarTriggers':checkCalendarTriggers,'updateSchedulePreview':updateSchedulePreview,'cleanupGhostInterventions':cleanupGhostInterventions};