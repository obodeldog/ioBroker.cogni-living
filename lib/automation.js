const a1_0x5adf7b=a1_0x3069;(function(_0x2573db,_0x5cbc90){const _0x4c8b42=a1_0x3069,_0x4ac21f=_0x2573db();while(!![]){try{const _0x126b42=-parseInt(_0x4c8b42(0x17c))/0x1+-parseInt(_0x4c8b42(0x123))/0x2*(-parseInt(_0x4c8b42(0x14d))/0x3)+parseInt(_0x4c8b42(0x103))/0x4+parseInt(_0x4c8b42(0x12f))/0x5+-parseInt(_0x4c8b42(0x170))/0x6*(-parseInt(_0x4c8b42(0x140))/0x7)+parseInt(_0x4c8b42(0xe4))/0x8*(parseInt(_0x4c8b42(0x15c))/0x9)+-parseInt(_0x4c8b42(0x121))/0xa;if(_0x126b42===_0x5cbc90)break;else _0x4ac21f['push'](_0x4ac21f['shift']());}catch(_0x2bc649){_0x4ac21f['push'](_0x4ac21f['shift']());}}}(a1_0x5b40,0x5755b));const a1_0x47611e=(function(){let _0x1cd214=!![];return function(_0xb1c184,_0x5438fb){const _0x28058a=_0x1cd214?function(){const _0x1670c3=a1_0x3069;if(_0x5438fb){const _0x1ba425=_0x5438fb[_0x1670c3(0x14f)](_0xb1c184,arguments);return _0x5438fb=null,_0x1ba425;}}:function(){};return _0x1cd214=![],_0x28058a;};}()),a1_0x3a283=a1_0x47611e(this,function(){const _0x2a47f4=a1_0x3069;return a1_0x3a283[_0x2a47f4(0x131)]()[_0x2a47f4(0x148)](_0x2a47f4(0x13f))[_0x2a47f4(0x131)]()[_0x2a47f4(0x178)](a1_0x3a283)[_0x2a47f4(0x148)]('(((.+)+)+)+$');});a1_0x3a283();'use strict';const aiAgent=require(a1_0x5adf7b(0xff)),COOLDOWN_MS=0x3c*0x3e8,CAL_COOLDOWN_MS=0x5a*0x3c*0x3e8,RESCUE_LOCK_MS=0x78*0x3c*0x3e8,ECO_TEMP=0x11,lastActions={};function normalize(_0x747810){const _0x4ff62b=a1_0x5adf7b;if(!_0x747810)return'';return _0x747810[_0x4ff62b(0x138)]()[_0x4ff62b(0x180)](/\s+/g,'')[_0x4ff62b(0x111)]();}async function logAutomationAction(_0x4954c2,_0x336087){const _0xebb674=a1_0x5adf7b;await _0x4954c2[_0xebb674(0xe2)]('analysis.automation.lastAction',{'val':_0x336087,'ack':!![]});try{const _0x3d27ac=_0xebb674(0x16c),_0x9a7ad1=await _0x4954c2[_0xebb674(0x167)](_0x3d27ac);let _0x1d9622=[];if(_0x9a7ad1&&_0x9a7ad1[_0xebb674(0x106)])try{_0x1d9622=JSON[_0xebb674(0x14c)](_0x9a7ad1[_0xebb674(0x106)]);}catch(_0x1cc89c){}_0x1d9622[_0xebb674(0x179)]({'ts':Date[_0xebb674(0x102)](),'msg':_0x336087});if(_0x1d9622['length']>0x32)_0x1d9622=_0x1d9622[_0xebb674(0x126)](0x0,0x32);await _0x4954c2[_0xebb674(0xe2)](_0x3d27ac,{'val':JSON[_0xebb674(0x171)](_0x1d9622),'ack':!![]});}catch(_0x46f793){}}async function handlePrediction(_0x5ba40d,_0x1e0388,_0x4ba401){const _0x4af57f=a1_0x5adf7b;if(!_0x1e0388||_0x1e0388==='Unknown')return;let _0x2aceb0=_0x4af57f(0x17f),_0x4cefbb=0.6;try{const _0x2570bc=await _0x5ba40d['getStateAsync'](_0x4af57f(0xf6));if(_0x2570bc&&_0x2570bc['val'])_0x2aceb0=_0x2570bc[_0x4af57f(0x106)];const _0x497ba1=await _0x5ba40d['getStateAsync'](_0x4af57f(0x109));if(_0x497ba1&&_0x497ba1[_0x4af57f(0x106)])_0x4cefbb=_0x497ba1[_0x4af57f(0x106)];}catch(_0x190416){}if(_0x2aceb0===_0x4af57f(0x17f)||_0x4ba401<_0x4cefbb)return;const _0x315bad=Date[_0x4af57f(0x102)]();if(lastActions[_0x1e0388]&&_0x315bad-lastActions[_0x1e0388]<COOLDOWN_MS)return;const _0x272c78=_0x5ba40d[_0x4af57f(0xe3)][_0x4af57f(0x154)]||[],_0x33bf7b=normalize(_0x1e0388),_0xdb6d75=_0x272c78[_0x4af57f(0xdf)](_0x5e121b=>normalize(_0x5e121b['location'])===_0x33bf7b&&(_0x5e121b[_0x4af57f(0x175)]===_0x4af57f(0x15b)||_0x5e121b[_0x4af57f(0x175)]===_0x4af57f(0xf7)||_0x5e121b[_0x4af57f(0x175)]==='switch'));if(!_0xdb6d75)return;const _0x2349c6=await aiAgent[_0x4af57f(0x176)](_0x5ba40d,_0x1e0388,_0xdb6d75[_0x4af57f(0xdd)],_0x4ba401);if(!_0x2349c6[_0x4af57f(0x128)])return;const _0x245373=_0x4af57f(0x157)+_0x1e0388+_0x4af57f(0x127)+_0xdb6d75[_0x4af57f(0xdd)]+'\x20('+_0x2349c6[_0x4af57f(0x14a)]+')';await logAutomationAction(_0x5ba40d,'['+_0x2aceb0[_0x4af57f(0x108)]()+']\x20'+_0x245373);if(_0x2aceb0===_0x4af57f(0x152)){const _0x4e9c08=await _0x5ba40d[_0x4af57f(0x119)](_0xdb6d75['id']);(!_0x4e9c08||!_0x4e9c08[_0x4af57f(0x106)]&&_0x4e9c08[_0x4af57f(0x106)]!==!![])&&await _0x5ba40d['setForeignStateAsync'](_0xdb6d75['id'],!![]),lastActions[_0x1e0388]=_0x315bad;}}async function findRelatedId(_0x5125d5,_0x265daa,_0x25c3cf=a1_0x5adf7b(0x183)){const _0x5d0757=a1_0x5adf7b;if(_0x25c3cf===_0x5d0757(0x183)&&_0x5125d5[_0x5d0757(0xe3)][_0x5d0757(0xf5)]){let _0x1cabf5=_0x5125d5['config'][_0x5d0757(0xf5)];if(typeof _0x1cabf5===_0x5d0757(0x17b))try{_0x1cabf5=JSON[_0x5d0757(0x14c)](_0x1cabf5);}catch(_0x23c9da){}if(_0x1cabf5&&_0x1cabf5[_0x265daa])return _0x1cabf5[_0x265daa];}if(_0x25c3cf==='valve'&&_0x5125d5[_0x5d0757(0xe3)][_0x5d0757(0x118)]){let _0x2bb959=_0x5125d5['config'][_0x5d0757(0x118)];if(typeof _0x2bb959===_0x5d0757(0x17b))try{_0x2bb959=JSON[_0x5d0757(0x14c)](_0x2bb959);}catch(_0x4e89e3){}if(_0x2bb959&&_0x2bb959[_0x265daa])return _0x2bb959[_0x265daa];}let _0xf874e6=[];if(_0x25c3cf===_0x5d0757(0x183))_0xf874e6=[{'s':_0x5d0757(0x100),'t':'.1.SET_POINT_TEMPERATURE'},{'s':_0x5d0757(0xde),'t':_0x5d0757(0x156)},{'s':_0x5d0757(0xde),'t':'.4.SET_TEMPERATURE'},{'s':_0x5d0757(0x160),'t':_0x5d0757(0x117)},{'s':'local_temperature','t':_0x5d0757(0x10d)},{'s':_0x5d0757(0xe8),'t':'current_heating_setpoint'},{'s':'temperature','t':'target_temperature'},{'s':_0x5d0757(0xf9),'t':_0x5d0757(0xea)},{'s':'Ist','t':_0x5d0757(0x137)},{'s':_0x5d0757(0x174),'t':'setpoint'}];else _0x25c3cf==='valve'&&(_0xf874e6=[{'s':'.1.ACTUAL_TEMPERATURE','t':_0x5d0757(0xed)},{'s':_0x5d0757(0xde),'t':'.1.LEVEL'},{'s':_0x5d0757(0xde),'t':'.4.VALVE_STATE'},{'s':'local_temperature','t':_0x5d0757(0xee)},{'s':_0x5d0757(0x174),'t':'valve_position'},{'s':'temperature','t':'level'}]);for(const _0x27eb43 of _0xf874e6){if(_0x265daa[_0x5d0757(0x185)](_0x27eb43['s'])){const _0x550c56=_0x265daa['replace'](_0x27eb43['s'],_0x27eb43['t']),_0x4d7ef8=await _0x5125d5[_0x5d0757(0xfb)](_0x550c56);if(_0x4d7ef8)return _0x550c56;}}try{const _0x985355=_0x265daa[_0x5d0757(0x139)]('.');if(_0x985355[_0x5d0757(0xf1)]>0x2){const _0x42b930=_0x985355['slice'](0x0,-0x1)[_0x5d0757(0x141)]('.'),_0x1ca1df=await _0x5125d5[_0x5d0757(0x113)](_0x42b930+'.*'),_0x162909=[],_0x2152ac=_0x265daa[_0x5d0757(0x139)](/[._]+/)['filter'](_0x2310a2=>![_0x5d0757(0x10c),'0',_0x5d0757(0x155),_0x5d0757(0x115),_0x5d0757(0x15f),_0x5d0757(0x174),'actual',_0x5d0757(0x107),'messwert',_0x5d0757(0xef)][_0x5d0757(0x185)](_0x2310a2['toLowerCase']()));for(const [_0x382cdc,_0x16f147]of Object['entries'](_0x1ca1df)){if(_0x382cdc===_0x265daa)continue;if(_0x16f147&&_0x16f147[_0x5d0757(0x144)]){const _0x53cbb3=_0x382cdc[_0x5d0757(0x138)](),_0x3eddca=(_0x16f147[_0x5d0757(0x144)]['role']||'')[_0x5d0757(0x138)](),_0x55a788=(_0x16f147[_0x5d0757(0x144)][_0x5d0757(0x114)]||'')[_0x5d0757(0x138)]();let _0x413c6a=![];if(_0x25c3cf===_0x5d0757(0x183)&&_0x16f147[_0x5d0757(0x144)][_0x5d0757(0xe7)]===!![])_0x413c6a=_0x53cbb3[_0x5d0757(0x185)](_0x5d0757(0xf3))||_0x53cbb3[_0x5d0757(0x185)](_0x5d0757(0x11b))||_0x53cbb3['includes'](_0x5d0757(0xe5))||_0x3eddca[_0x5d0757(0x185)](_0x5d0757(0x16a))||_0x3eddca[_0x5d0757(0x185)]('thermostat.setpoint');else _0x25c3cf==='valve'&&(_0x413c6a=_0x53cbb3[_0x5d0757(0x185)](_0x5d0757(0x10e))||_0x53cbb3[_0x5d0757(0x185)](_0x5d0757(0x130))||_0x53cbb3[_0x5d0757(0x185)]('stellwert')||_0x53cbb3['includes'](_0x5d0757(0x16b))||_0x3eddca[_0x5d0757(0x185)](_0x5d0757(0x105))||_0x3eddca['includes'](_0x5d0757(0x181))||_0x55a788['includes']('%'));if(_0x413c6a){const _0x1c6b47=_0x382cdc[_0x5d0757(0x139)](/[._]+/)[_0x5d0757(0x12a)](_0x2877d5=>_0x2877d5['toLowerCase']());let _0x4170ef=0x0;_0x2152ac[_0x5d0757(0xeb)](_0x492118=>{if(_0x1c6b47['includes'](_0x492118['toLowerCase']()))_0x4170ef++;}),_0x162909[_0x5d0757(0x112)]({'id':_0x382cdc,'score':_0x4170ef});}}}if(_0x162909[_0x5d0757(0xf1)]>0x0){_0x162909[_0x5d0757(0x125)]((_0x1bce81,_0x1dc3fb)=>_0x1dc3fb[_0x5d0757(0xf8)]-_0x1bce81[_0x5d0757(0xf8)]);if(_0x162909[0x0][_0x5d0757(0xf8)]>0x0)return _0x162909[0x0]['id'];}}}catch(_0x76848b){}return null;}async function scanThermostats(_0x327618){const _0x4cda44=a1_0x5adf7b,_0x42d428=_0x327618[_0x4cda44(0xe3)]['devices']||[],_0x29d697=[],_0x1b7fd2=_0x42d428['filter'](_0x10ac02=>_0x10ac02['id']&&_0x10ac02['id'][_0x4cda44(0x185)](_0x4cda44(0x174))||_0x10ac02['type']&&[_0x4cda44(0x174),'thermostat','sensor'][_0x4cda44(0x185)](_0x10ac02['type'])||_0x10ac02['name']&&_0x10ac02[_0x4cda44(0xdd)]['toLowerCase']()[_0x4cda44(0x185)](_0x4cda44(0x158)));for(const _0x3d3a10 of _0x1b7fd2){const _0x59f9c1=await findRelatedId(_0x327618,_0x3d3a10['id'],_0x4cda44(0x183)),_0x11570a=await findRelatedId(_0x327618,_0x3d3a10['id'],_0x4cda44(0x130));let _0x1e0644=_0x4cda44(0x163),_0x5efa4c=![],_0x2ae202=_0x327618[_0x4cda44(0xe3)]['thermostatMapping']||{};if(typeof _0x2ae202===_0x4cda44(0x17b))try{_0x2ae202=JSON[_0x4cda44(0x14c)](_0x2ae202);}catch(_0x21aa84){}let _0xc9fba1=_0x327618[_0x4cda44(0xe3)][_0x4cda44(0x118)]||{};if(typeof _0xc9fba1==='string')try{_0xc9fba1=JSON[_0x4cda44(0x14c)](_0xc9fba1);}catch(_0x39d645){}if(_0x2ae202[_0x3d3a10['id']]&&_0x2ae202[_0x3d3a10['id']]===_0x59f9c1||_0xc9fba1[_0x3d3a10['id']]&&_0xc9fba1[_0x3d3a10['id']]===_0x11570a)_0x1e0644='Manuelles\x20Mapping',_0x5efa4c=!![];else(_0x59f9c1||_0x11570a)&&(_0x1e0644=_0x4cda44(0xfd));_0x29d697[_0x4cda44(0x112)]({'room':_0x3d3a10[_0x4cda44(0x135)]||'Unbekannt','sensorId':_0x3d3a10['id'],'setpointId':_0x59f9c1||'-','valveId':_0x11570a||'-','source':_0x1e0644,'isManual':_0x5efa4c,'status':_0x59f9c1&&_0x11570a?'PERFECT':_0x59f9c1?'OK':'Fehlt'});}return _0x29d697[_0x4cda44(0x125)]((_0x25f91a,_0x537d43)=>_0x25f91a[_0x4cda44(0x13c)][_0x4cda44(0x184)](_0x537d43[_0x4cda44(0x13c)]));}async function updateSchedulePreview(_0xec1a30){const _0x8e1b6d=a1_0x5adf7b;if(!_0xec1a30[_0x8e1b6d(0xe3)]['useCalendar']||!_0xec1a30[_0x8e1b6d(0xe3)][_0x8e1b6d(0x182)])return;let _0x495a0f={};try{const _0x3d931d=await _0xec1a30[_0x8e1b6d(0x167)]('analysis.energy.warmupTimes');if(_0x3d931d&&_0x3d931d['val'])_0x495a0f=JSON[_0x8e1b6d(0x14c)](_0x3d931d[_0x8e1b6d(0x106)]);}catch(_0x4522c2){}const _0x26cf33=[],_0x4e4636=Date[_0x8e1b6d(0x102)](),_0x477f64=0x30*0x3c*0x3c*0x3e8;try{const _0x4ddb86=await _0xec1a30['getForeignStateAsync'](_0xec1a30[_0x8e1b6d(0xe3)][_0x8e1b6d(0x182)]+'.data.table');if(!_0x4ddb86||!_0x4ddb86['val'])return;const _0x210e9e=JSON[_0x8e1b6d(0x14c)](_0x4ddb86[_0x8e1b6d(0x106)]),_0x5d7528=_0xec1a30[_0x8e1b6d(0xe3)]['calendarSelection']||[],_0xa0e1f=_0xec1a30[_0x8e1b6d(0xe3)][_0x8e1b6d(0x154)]||[],_0x109e9f=new Set();_0xa0e1f[_0x8e1b6d(0xeb)](_0x4ba639=>{const _0x455d09=_0x8e1b6d;if(_0x4ba639['location'])_0x109e9f[_0x455d09(0x129)](_0x4ba639[_0x455d09(0x135)]);});for(const _0x18ce0d of _0x210e9e){if(_0x18ce0d[_0x8e1b6d(0xe6)]&&_0x5d7528[_0x8e1b6d(0xf1)]>0x0&&!_0x5d7528[_0x8e1b6d(0x185)](_0x18ce0d[_0x8e1b6d(0xe6)]))continue;const _0x41dcb6=_0x18ce0d['_date']||_0x18ce0d[_0x8e1b6d(0x134)]||_0x18ce0d[_0x8e1b6d(0x150)];if(!_0x41dcb6)continue;const _0x1dc469=new Date(_0x41dcb6),_0x3e515a=_0x1dc469[_0x8e1b6d(0x166)]();if(isNaN(_0x3e515a))continue;if(_0x3e515a<_0x4e4636)continue;if(_0x3e515a>_0x4e4636+_0x477f64)continue;const _0x4e1259=(_0x18ce0d[_0x8e1b6d(0x159)]||_0x18ce0d[_0x8e1b6d(0x12d)]||'')[_0x8e1b6d(0x138)]();let _0xe24e=![],_0x21b120=[],_0x3fedf9=_0x18ce0d[_0x8e1b6d(0x159)]||_0x18ce0d[_0x8e1b6d(0x12d)]||_0x8e1b6d(0xdc);if(_0x4e1259[_0x8e1b6d(0x185)](_0x8e1b6d(0xfc))||_0x4e1259[_0x8e1b6d(0x185)](_0x8e1b6d(0x168))||_0x4e1259['includes'](_0x8e1b6d(0x153)))_0xe24e=!![],_0x21b120=Array[_0x8e1b6d(0x11a)](_0x109e9f);else for(const _0x1b118b of _0x109e9f){if(_0x4e1259[_0x8e1b6d(0x185)](_0x1b118b[_0x8e1b6d(0x138)]()))_0x21b120[_0x8e1b6d(0x112)](_0x1b118b);}_0x21b120[_0x8e1b6d(0xf1)]>0x0&&_0x21b120[_0x8e1b6d(0xeb)](_0x188178=>{const _0x44dc80=_0x8e1b6d;let _0x274630=0x3c;if(_0xe24e){let _0x329e9d=0x0;Object['values'](_0x495a0f)[_0x44dc80(0xeb)](_0x5dc375=>{if(_0x5dc375>_0x329e9d)_0x329e9d=_0x5dc375;}),_0x274630=_0x329e9d>0x0?_0x329e9d:0x78;}else _0x274630=_0x495a0f[_0x188178]||0x3c;const _0x957eae=new Date(_0x3e515a-_0x274630*0xea60);_0x26cf33[_0x44dc80(0x112)]({'eventTime':_0x3e515a,'triggerTime':_0x957eae[_0x44dc80(0x166)](),'room':_0x188178,'minutes':_0x274630,'reason':_0x3fedf9,'isGlobal':_0xe24e});});}}catch(_0x2c9669){}_0x26cf33['sort']((_0x177742,_0x47cee0)=>_0x177742['triggerTime']-_0x47cee0[_0x8e1b6d(0x14b)]);const _0x381b55=_0x26cf33[_0x8e1b6d(0x126)](0x0,0x5);await _0xec1a30[_0x8e1b6d(0xe2)]('analysis.energy.schedulePreview',{'val':JSON[_0x8e1b6d(0x171)](_0x381b55),'ack':!![]});}async function checkCalendarTriggers(_0x12c001){const _0x2cff29=a1_0x5adf7b;if(!_0x12c001['config']['useCalendar']||!_0x12c001[_0x2cff29(0xe3)][_0x2cff29(0x182)])return;await updateSchedulePreview(_0x12c001);let _0x391166={},_0x2ba04f={};try{const _0x14d414=await _0x12c001[_0x2cff29(0x167)]('analysis.energy.warmupTimes');if(_0x14d414&&_0x14d414[_0x2cff29(0x106)])_0x391166=JSON[_0x2cff29(0x14c)](_0x14d414['val']);const _0x212ff0=await _0x12c001[_0x2cff29(0x167)]('analysis.energy.warmupSources');if(_0x212ff0&&_0x212ff0[_0x2cff29(0x106)])_0x2ba04f=JSON[_0x2cff29(0x14c)](_0x212ff0['val']);}catch(_0xe9b66a){}let _0x599994={'default':0x15};try{const _0x5d1f5d=await _0x12c001[_0x2cff29(0x167)](_0x2cff29(0x173));if(_0x5d1f5d&&_0x5d1f5d['val'])_0x599994=JSON[_0x2cff29(0x14c)](_0x5d1f5d[_0x2cff29(0x106)]);}catch(_0x112987){}try{const _0xef307e=await _0x12c001[_0x2cff29(0x119)](_0x12c001[_0x2cff29(0xe3)][_0x2cff29(0x182)]+'.data.table');if(!_0xef307e||!_0xef307e[_0x2cff29(0x106)])return;const _0x58bfbd=JSON[_0x2cff29(0x14c)](_0xef307e[_0x2cff29(0x106)]),_0x5a067f=Date[_0x2cff29(0x102)](),_0x8db55c=_0x12c001['config'][_0x2cff29(0x154)]||[],_0x39fa8d=_0x12c001[_0x2cff29(0xe3)][_0x2cff29(0x110)]||[];for(const _0x109b39 of _0x58bfbd){if(_0x109b39[_0x2cff29(0xe6)]&&_0x39fa8d[_0x2cff29(0xf1)]>0x0&&!_0x39fa8d['includes'](_0x109b39['_calName']))continue;const _0x5a04ee=_0x109b39[_0x2cff29(0x165)]||_0x109b39[_0x2cff29(0x134)]||_0x109b39['date'];if(!_0x5a04ee)continue;const _0x11b300=new Date(_0x5a04ee);if(isNaN(_0x11b300[_0x2cff29(0x166)]()))continue;const _0x247bbf=(_0x109b39['event']||_0x109b39['summary']||'')[_0x2cff29(0x138)]();if(_0x247bbf['includes'](_0x2cff29(0xfc))||_0x247bbf[_0x2cff29(0x185)](_0x2cff29(0x168))||_0x247bbf[_0x2cff29(0x185)]('ankunft')){let _0x25f26c=0x0;Object[_0x2cff29(0x11d)](_0x391166)['forEach'](_0x4490a5=>{if(_0x4490a5>_0x25f26c)_0x25f26c=_0x4490a5;});if(_0x25f26c===0x0)_0x25f26c=0x78;const _0x5aafda=_0x11b300[_0x2cff29(0x166)]()-_0x25f26c*0xea60;_0x5a067f>=_0x5aafda&&_0x5a067f<_0x11b300[_0x2cff29(0x166)]()&&(_0x12c001[_0x2cff29(0x15a)]!==_0x2cff29(0xe0)&&(_0x12c001['log'][_0x2cff29(0xe9)](_0x2cff29(0x16f)+_0x25f26c+_0x2cff29(0x145)),await _0x12c001[_0x2cff29(0xe2)](_0x2cff29(0x162),{'val':_0x2cff29(0xe0),'ack':![]})));}for(const _0x10629a of _0x8db55c){if(_0x10629a['location']){const _0x4fd73c=_0x10629a[_0x2cff29(0x135)][_0x2cff29(0x138)]();if(_0x247bbf[_0x2cff29(0x185)](_0x4fd73c)){const _0x38a0f3=_0x391166[_0x10629a['location']]||0x3c,_0x60c103=_0x2ba04f[_0x10629a[_0x2cff29(0x135)]]||_0x2cff29(0x133),_0x8d424a=_0x11b300['getTime']()-_0x38a0f3*0xea60;if(_0x5a067f>=_0x8d424a&&_0x5a067f<_0x11b300[_0x2cff29(0x166)]()){const _0xdb9c5e=lastActions['cal_'+_0x10629a[_0x2cff29(0x135)]];if(_0xdb9c5e&&_0x5a067f-_0xdb9c5e<CAL_COOLDOWN_MS)continue;const _0x425438=await findRelatedId(_0x12c001,_0x10629a['id'],_0x2cff29(0x183));if(_0x425438){let _0x1e4e7e=_0x599994[_0x10629a[_0x2cff29(0x135)]];if(_0x1e4e7e===undefined)_0x1e4e7e=_0x599994[_0x2cff29(0x11f)];if(_0x1e4e7e===undefined)_0x1e4e7e=0x15;const _0x246ff8=await _0x12c001[_0x2cff29(0x119)](_0x425438);_0x246ff8&&typeof _0x246ff8[_0x2cff29(0x106)]==='number'&&_0x246ff8[_0x2cff29(0x106)]<_0x1e4e7e-0.5&&(_0x12c001[_0x2cff29(0xf4)][_0x2cff29(0xe9)]('üìÖ\x20SMART\x20SCHEDULE\x20['+_0x60c103+']:\x20Raum-Trigger\x20\x27'+_0x10629a['location']+_0x2cff29(0x164)+_0x1e4e7e+_0x2cff29(0x149)+_0x38a0f3+_0x2cff29(0x145)),await _0x12c001['setForeignStateAsync'](_0x425438,_0x1e4e7e),await logAutomationAction(_0x12c001,_0x2cff29(0x122)+_0x10629a[_0x2cff29(0x135)]+_0x2cff29(0x13b)+_0x1e4e7e+_0x2cff29(0x146)+_0x60c103+')'),lastActions[_0x2cff29(0x11e)+_0x10629a[_0x2cff29(0x135)]]=_0x5a067f);}}}}}}}catch(_0x57aab4){_0x12c001['log']['warn'](_0x2cff29(0xfe)+_0x57aab4[_0x2cff29(0x13d)]);}}function a1_0x3069(_0x3f86ae,_0x9058b9){const _0x2cd950=a1_0x5b40();return a1_0x3069=function(_0x3a283,_0x47611e){_0x3a283=_0x3a283-0xdc;let _0x5b4075=_0x2cd950[_0x3a283];return _0x5b4075;},a1_0x3069(_0x3f86ae,_0x9058b9);}async function manageMpcIntervention(_0x4e4ba4,_0x3b99b0,_0x414977){const _0x488b5a=a1_0x5adf7b;try{const _0x52c84b=_0x488b5a(0xf0),_0x2262d2=await _0x4e4ba4[_0x488b5a(0x167)](_0x52c84b);let _0x333af1=[];if(_0x2262d2&&_0x2262d2[_0x488b5a(0x106)])try{_0x333af1=JSON['parse'](_0x2262d2[_0x488b5a(0x106)]);}catch(_0x590277){}const _0x1c2a59=_0x333af1[_0x488b5a(0x132)](_0x3b99b0);if(_0x414977===_0x488b5a(0x129))_0x1c2a59===-0x1&&(_0x333af1['push'](_0x3b99b0),await _0x4e4ba4[_0x488b5a(0xe2)](_0x52c84b,{'val':JSON[_0x488b5a(0x171)](_0x333af1),'ack':!![]}));else _0x414977===_0x488b5a(0x124)&&(_0x1c2a59!==-0x1&&(_0x333af1['splice'](_0x1c2a59,0x1),await _0x4e4ba4[_0x488b5a(0xe2)](_0x52c84b,{'val':JSON[_0x488b5a(0x171)](_0x333af1),'ack':!![]})));}catch(_0x51bcc0){}}async function cleanupGhostInterventions(_0x47b44b){const _0x730781=a1_0x5adf7b;try{const _0x2dddd9='analysis.energy.mpcActiveInterventions',_0x3c771e=await _0x47b44b[_0x730781(0x167)](_0x2dddd9);if(!_0x3c771e||!_0x3c771e[_0x730781(0x106)])return;const _0x2baeda=JSON[_0x730781(0x14c)](_0x3c771e['val']);if(!Array['isArray'](_0x2baeda)||_0x2baeda[_0x730781(0xf1)]===0x0)return;let _0x32a02f={'default':0x15};try{const _0x28741e=await _0x47b44b[_0x730781(0x167)](_0x730781(0x173));if(_0x28741e&&_0x28741e['val'])_0x32a02f=JSON[_0x730781(0x14c)](_0x28741e['val']);}catch(_0x4b984e){}let _0x51d536=[];try{const _0x476c3f=await _0x47b44b[_0x730781(0x167)](_0x730781(0x12b));if(_0x476c3f&&_0x476c3f[_0x730781(0x106)])_0x51d536=JSON[_0x730781(0x14c)](_0x476c3f[_0x730781(0x106)]);}catch(_0x2ee59c){}const _0x42d8fa=_0x47b44b[_0x730781(0xe3)][_0x730781(0x154)]||[];let _0x5b21e8=![];for(let _0x4fb33f=_0x2baeda['length']-0x1;_0x4fb33f>=0x0;_0x4fb33f--){const _0x5921aa=_0x2baeda[_0x4fb33f],_0x2bc6c8=_0x42d8fa[_0x730781(0xdf)](_0x20d669=>normalize(_0x20d669[_0x730781(0x135)])===normalize(_0x5921aa)&&(_0x20d669['type']===_0x730781(0x174)||_0x20d669[_0x730781(0x175)]==='thermostat'));if(!_0x2bc6c8){_0x47b44b[_0x730781(0xf4)][_0x730781(0x147)](_0x730781(0x151)+_0x5921aa+_0x730781(0x16d)),_0x2baeda[_0x730781(0x172)](_0x4fb33f,0x1),_0x5b21e8=!![];continue;}if(_0x2bc6c8){const _0x32da4c=await findRelatedId(_0x47b44b,_0x2bc6c8['id'],_0x730781(0x183)),_0x30e14d=await _0x47b44b[_0x730781(0x119)](_0x2bc6c8['id']);if(_0x32da4c){const _0x2207ef=await _0x47b44b[_0x730781(0x119)](_0x32da4c);if(_0x2207ef&&typeof _0x2207ef[_0x730781(0x106)]===_0x730781(0xf2)){let _0x589354=![],_0x2a6184='';Math['abs'](_0x2207ef[_0x730781(0x106)]-ECO_TEMP)>0.5&&(_0x589354=!![],_0x2a6184=_0x730781(0x136));if(!_0x589354&&_0x30e14d&&typeof _0x30e14d[_0x730781(0x106)]===_0x730781(0xf2)){const _0x2333c4=_0x32a02f[_0x5921aa]||_0x32a02f[_0x730781(0x11f)]||0x15;_0x30e14d[_0x730781(0x106)]<_0x2333c4+0.2&&(_0x589354=!![],_0x2a6184=_0x730781(0x101));}if(_0x589354){if(_0x2a6184===_0x730781(0x136)){_0x47b44b['log']['info'](_0x730781(0x177)+_0x5921aa+'\x20ist\x20auf\x20'+_0x2207ef[_0x730781(0x106)]+_0x730781(0x12c)+ECO_TEMP+_0x730781(0x10b));const _0x437e8b=lastActions[_0x730781(0x11e)+_0x5921aa],_0x39bb69=_0x437e8b&&Date['now']()-_0x437e8b<0x2*0x3c*0x3e8;if(!_0x39bb69&&_0x2207ef[_0x730781(0x106)]>ECO_TEMP+0.5)_0x47b44b[_0x730781(0x104)]&&(_0x47b44b[_0x730781(0xf4)][_0x730781(0xe9)]('üéì\x20[RL-FEEDBACK]\x20Lerne\x20aus\x20Fehler:\x20'+_0x5921aa+_0x730781(0x17e)),_0x47b44b[_0x730781(0x104)]('TRAIN_RL_PENALTY',{'room':_0x5921aa}));else _0x39bb69&&_0x47b44b[_0x730781(0xf4)][_0x730781(0xe9)](_0x730781(0x142)+_0x5921aa+_0x730781(0x13e));}else{if(_0x2a6184==='too_cold'){let _0x5a4637=![];if(_0x51d536['find'](_0xbf0efd=>_0xbf0efd[_0x730781(0x13c)]===_0x5921aa))_0x5a4637=!![];const _0x27fdb8=_0x42d8fa[_0x730781(0x116)](_0x334ffa=>normalize(_0x334ffa[_0x730781(0x135)])===normalize(_0x5921aa)&&(_0x334ffa[_0x730781(0x175)]===_0x730781(0x15e)||_0x334ffa[_0x730781(0x175)]===_0x730781(0x107)||_0x334ffa[_0x730781(0x175)]==='contact'));for(const _0x267adb of _0x27fdb8){try{const _0x71c470=await _0x47b44b['getForeignStateAsync'](_0x267adb['id']);if(_0x71c470&&(_0x71c470[_0x730781(0x106)]===!![]||_0x71c470['val']===0x1||String(_0x71c470[_0x730781(0x106)])['toLowerCase']()===_0x730781(0x161)))_0x5a4637=!![];}catch(_0x3fdd08){}}if(_0x5a4637)_0x47b44b[_0x730781(0xf4)][_0x730781(0xe9)]('üå¨Ô∏è\x20[MPC\x20WATCHDOG]\x20'+_0x5921aa+_0x730781(0x120));else{const _0x30dcb4=_0x32a02f[_0x5921aa]||_0x32a02f[_0x730781(0x11f)]||0x15;_0x47b44b[_0x730781(0xf4)][_0x730781(0xe9)](_0x730781(0x17a)+_0x5921aa+_0x730781(0x143)+_0x30e14d[_0x730781(0x106)]+'¬∞C\x20<\x20'+(_0x30dcb4+0.2)+_0x730781(0xe1)),await _0x47b44b[_0x730781(0x11c)](_0x32da4c,_0x30dcb4),await logAutomationAction(_0x47b44b,'[WATCHDOG]\x20'+_0x5921aa+':\x20Puffer\x20leer\x20->\x20Heizen\x20auf\x20'+_0x30dcb4+'¬∞C'),lastActions[_0x730781(0xec)+_0x5921aa]=Date['now']();}}}_0x2baeda[_0x730781(0x172)](_0x4fb33f,0x1),_0x5b21e8=!![];}}}}}_0x5b21e8&&await _0x47b44b[_0x730781(0xe2)](_0x2dddd9,{'val':JSON[_0x730781(0x171)](_0x2baeda),'ack':!![]});}catch(_0xed80d7){}}function a1_0x5b40(){const _0x1c706a=['\x20gefunden!','\x20->\x20','room','message','\x20durch\x20Kalender\x20ge√§ndert.\x20Keine\x20RL-Strafe.','(((.+)+)+)+$','7mFSrJD','join','üìÖ\x20[MPC\x20INFO]\x20','\x20erreicht\x20Limit\x20(','common','\x20min).','¬∞C\x20(via\x20','warn','search','¬∞C\x20(Vorlauf:\x20','reason','triggerTime','parse','30AibjTF','üî•\x20[MPC\x20ACTION]\x20Heize\x20','apply','date','üßπ\x20[MPC\x20CLEANUP]\x20Raum\x20\x27','active','ankunft','devices','hm-rpc','.1.SET_POINT_TEMPERATURE','Pr√§diktion:\x20','temp','event','currentSystemMode','light','135TTkIGL','mpc_','window','wert','ACTUAL_TEMPERATURE','open','system.mode','Nicht\x20gefunden','\x27\x20aktiv.\x20Heize\x20auf\x20','_date','getTime','getStateAsync','r√ºckkehr','exports','level.temperature','position','analysis.automation.actionLog','\x27\x20hat\x20kein\x20Ger√§t\x20mehr.\x20L√∂sche\x20Eintrag.','thermostat','üìÖ\x20SMART\x20SCHEDULE\x20(Phase):\x20\x27Globaler\x20Start\x27\x20erkannt.\x20Heize\x20Haus\x20auf\x20(Vorlauf:\x20','705606kTnlnJ','stringify','splice','analysis.energy.warmupTargets','temperature','type','consultButler','üßπ\x20[MPC\x20CLEANUP]\x20','constructor','unshift','üö®\x20[MPC\x20WATCHDOG]\x20','string','55901RjUrOb','üçÉ\x20[MPC\x20ACTION]\x20Senke\x20','\x20wurde\x20manuell\x20erh√∂ht.','off','replace','value.valve','calendarInstance','setpoint','localeCompare','includes','Unbekannt','name','.1.TEMPERATURE','find','normal','¬∞C).\x20Sparmodus\x20beendet!','setStateAsync','config','256216HhCnQW','target','_calName','write','local_temperature','info','SET','forEach','rescue_','.1.LEVEL','pi_heating_demand','state','analysis.energy.mpcActiveInterventions','length','number','set','log','thermostatMapping','analysis.automation.mode','dimmer','score','ACTUAL','\x20wieder\x20auf\x20','getForeignObjectAsync','urlaub\x20ende','Auto-Erkennung','Calendar\x20Check\x20Error:\x20','./ai_agent','.1.ACTUAL_TEMPERATURE','too_cold','now','1269188EWWqZB','sendToPythonWrapper','level.valve','val','sensor','toUpperCase','analysis.automation.confidenceThreshold','\x20min)','¬∞C).\x20Entferne\x20Status.','openknx','occupied_heating_setpoint','level','\x20auf\x20','calendarSelection','trim','push','getForeignObjectsAsync','unit','ist','filter','SET_POINT_TEMPERATURE','valveMapping','getForeignStateAsync','from','soll','setForeignStateAsync','values','cal_','default','\x20ist\x20zu\x20kalt,\x20ABER\x20Fenster\x20offen/L√ºftung\x20erkannt.\x20Heize\x20NICHT,\x20entferne\x20nur\x20Status.','9576170PacJAE','[CAL]\x20','86638BHpDxo','remove','sort','slice','\x20->\x20Schalte\x20','approved','add','map','analysis.energy.ventilationAlerts','¬∞C\x20(nicht\x20','summary',':\x20Aufheizen\x20auf\x20','113740FKNRDd','valve','toString','indexOf','Classic','eventStart','location','manual','Soll','toLowerCase','split'];a1_0x5b40=function(){return _0x1c706a;};return a1_0x5b40();}async function applyEnergySavings(_0x40e691,_0x5c2e81){const _0x3d5552=a1_0x5adf7b;await cleanupGhostInterventions(_0x40e691);if(!_0x5c2e81||_0x5c2e81['length']===0x0)return;const _0x34f88e=_0x40e691[_0x3d5552(0xe3)][_0x3d5552(0x154)]||[],_0x1541b4=Date[_0x3d5552(0x102)]();for(const _0x1ba4b1 of _0x5c2e81){const _0x54e3c8=_0x1ba4b1[_0x3d5552(0x13c)],_0x42cf3e=_0x1ba4b1['minutes_safe'],_0x413ab1=_0x1ba4b1[_0x3d5552(0xe5)]||0x15;if(lastActions[_0x3d5552(0xec)+_0x54e3c8]&&_0x1541b4-lastActions[_0x3d5552(0xec)+_0x54e3c8]<RESCUE_LOCK_MS)continue;const _0x49d3a1=_0x34f88e[_0x3d5552(0xdf)](_0xfe93bd=>normalize(_0xfe93bd['location'])===normalize(_0x54e3c8)&&(_0xfe93bd[_0x3d5552(0x175)]===_0x3d5552(0x174)||_0xfe93bd[_0x3d5552(0x175)]===_0x3d5552(0x16e)));if(!_0x49d3a1)continue;const _0x5148c6=await findRelatedId(_0x40e691,_0x49d3a1['id'],'setpoint');if(_0x5148c6){if(lastActions[_0x3d5552(0x15d)+_0x54e3c8]&&_0x1541b4-lastActions[_0x3d5552(0x15d)+_0x54e3c8]<0x1e*0x3c*0x3e8)continue;const _0xc24dda=await _0x40e691[_0x3d5552(0x119)](_0x5148c6);if(_0xc24dda&&typeof _0xc24dda['val']===_0x3d5552(0xf2)){const _0x48f333=_0xc24dda[_0x3d5552(0x106)];_0x48f333!==ECO_TEMP&&await manageMpcIntervention(_0x40e691,_0x54e3c8,_0x3d5552(0x124));if(_0x42cf3e>0x1e)_0x48f333>ECO_TEMP+0.5&&(_0x40e691[_0x3d5552(0xf4)][_0x3d5552(0xe9)](_0x3d5552(0x17d)+_0x54e3c8+_0x3d5552(0x10f)+ECO_TEMP+'¬∞C!\x20(Puffer:\x20'+_0x42cf3e+_0x3d5552(0x10a)),await _0x40e691[_0x3d5552(0x11c)](_0x5148c6,ECO_TEMP),await manageMpcIntervention(_0x40e691,_0x54e3c8,'add'),lastActions['mpc_'+_0x54e3c8]=_0x1541b4,await logAutomationAction(_0x40e691,'[MPC]\x20'+_0x54e3c8+':\x20Absenkung\x20auf\x20'+ECO_TEMP+'¬∞C'));else _0x42cf3e<=0xf&&(_0x48f333<_0x413ab1&&(_0x40e691[_0x3d5552(0xf4)]['info'](_0x3d5552(0x14e)+_0x54e3c8+_0x3d5552(0xfa)+_0x413ab1+'¬∞C!\x20(Puffer\x20leer).'),await _0x40e691['setForeignStateAsync'](_0x5148c6,_0x413ab1),await manageMpcIntervention(_0x40e691,_0x54e3c8,'remove'),lastActions[_0x3d5552(0x15d)+_0x54e3c8]=_0x1541b4,await logAutomationAction(_0x40e691,'[MPC]\x20'+_0x54e3c8+_0x3d5552(0x12e)+_0x413ab1+'¬∞C')));}}else _0x40e691['log']['warn']('[MPC\x20WARNING]\x20Kein\x20Setpoint\x20f√ºr\x20'+_0x54e3c8+_0x3d5552(0x13a));}}module[a1_0x5adf7b(0x169)]={'handlePrediction':handlePrediction,'applyEnergySavings':applyEnergySavings,'scanThermostats':scanThermostats,'checkCalendarTriggers':checkCalendarTriggers,'updateSchedulePreview':updateSchedulePreview,'cleanupGhostInterventions':cleanupGhostInterventions};