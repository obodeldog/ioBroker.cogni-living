const a1_0x47b81f=a1_0x1934;function a1_0x1934(_0x173127,_0x3289a1){const _0x27f33f=a1_0x14e7();return a1_0x1934=function(_0x1d17eb,_0x7bfae1){_0x1d17eb=_0x1d17eb-0xcc;let _0x14e7bf=_0x27f33f[_0x1d17eb];return _0x14e7bf;},a1_0x1934(_0x173127,_0x3289a1);}(function(_0x4a59a3,_0x43e5ab){const _0x58364d=a1_0x1934,_0x26d41c=_0x4a59a3();while(!![]){try{const _0x44a3e8=parseInt(_0x58364d(0x145))/0x1+parseInt(_0x58364d(0xd4))/0x2+parseInt(_0x58364d(0xda))/0x3+-parseInt(_0x58364d(0x121))/0x4*(-parseInt(_0x58364d(0x11e))/0x5)+-parseInt(_0x58364d(0xe8))/0x6*(-parseInt(_0x58364d(0xcc))/0x7)+parseInt(_0x58364d(0x14a))/0x8+parseInt(_0x58364d(0x141))/0x9*(-parseInt(_0x58364d(0xd7))/0xa);if(_0x44a3e8===_0x43e5ab)break;else _0x26d41c['push'](_0x26d41c['shift']());}catch(_0x1bd91f){_0x26d41c['push'](_0x26d41c['shift']());}}}(a1_0x14e7,0xf1670));const a1_0x7bfae1=(function(){let _0x47402f=!![];return function(_0x2053bf,_0x50c024){const _0x5756bb=_0x47402f?function(){const _0x1281a4=a1_0x1934;if(_0x50c024){const _0x4316db=_0x50c024[_0x1281a4(0xd9)](_0x2053bf,arguments);return _0x50c024=null,_0x4316db;}}:function(){};return _0x47402f=![],_0x5756bb;};}()),a1_0x1d17eb=a1_0x7bfae1(this,function(){const _0x21409d=a1_0x1934;return a1_0x1d17eb[_0x21409d(0x12c)]()['search'](_0x21409d(0xd2))[_0x21409d(0x12c)]()['constructor'](a1_0x1d17eb)[_0x21409d(0x138)](_0x21409d(0xd2));});function a1_0x14e7(){const _0x4e3226=['urlaub\x20ende','join','\x27\x20erkannt\x20(','soll','wert','valveMapping','setStateAsync','analysis.automation.lastAction','mpc_','.1.ACTUAL_TEMPERATURE','870680RXWByR','Soll',')\x20auf\x20','28UXMkuU','\x20->\x2021¬∞C','ankunft','length','ist','level','ACTUAL','room','setForeignStateAsync','./ai_agent','messwert','toString','_calName','Manuelles\x20Mapping','devices','value.valve','hm-rpc','setpoint','\x20min).','getStateAsync','push','forEach','.1.LEVEL','search','toLowerCase','config','analysis.automation.confidenceThreshold','minutes_safe','switch','level.temperature','calendarSelection','.4.VALVE_STATE','140445CsAdXu','temp','system.mode','target_temperature','949401RXWCPg','location','write','score','Pr√§diktion:\x20','6129472OPRNTB','type','38297YESTee','getForeignObjectAsync','info','split','find','event','(((.+)+)+)+$','local_temperature','3112482dJGvZe','Unbekannt','thermostatMapping','2690MQYBQD','valve_position','apply','1053234LSvklb','getTime','position','üîç\x20Device-Search\x20failed\x20for\x20predicted\x20room\x20\x27','set','.4.SET_TEMPERATURE','Auto-Erkennung','entries','string','occupied_heating_setpoint','actual','values','thermostat.setpoint','dimmer','378NbdStC','[MPC]\x20',').\x20Heize\x20ganzes\x20Haus\x20auf\x20(Vorlauf:\x20','off','\x20->\x20Schalte\x20','getForeignStateAsync','parse','state','name','number','warn','level.valve','\x20min)','target','¬∞C\x20(Coasting\x20m√∂glich:\x20','Calendar\x20Check\x20Error:\x20','PERFECT','Ist','.1.SET_POINT_TEMPERATURE','role','.data.table','sort','pi_heating_demand','ACTUAL_TEMPERATURE','temperature','valve','calendarInstance','useCalendar','includes','replace','consultButler','Fehlt','üçÉ\x20MPC\x20Autonomy:\x20Senke\x20','common','trim','val','debug','.1.TEMPERATURE','toUpperCase','log','analysis.energy.warmupTimes','message','reason','approved'];a1_0x14e7=function(){return _0x4e3226;};return a1_0x14e7();}a1_0x1d17eb();'use strict';const aiAgent=require(a1_0x47b81f(0x12a)),COOLDOWN_MS=0x3c*0x3e8,lastActions={};function normalize(_0x2b6194){const _0x244c07=a1_0x47b81f;if(!_0x2b6194)return'';return _0x2b6194[_0x244c07(0x139)]()[_0x244c07(0x105)](/\s+/g,'')[_0x244c07(0x10a)]();}async function handlePrediction(_0x58f742,_0x543a66,_0x52d793){const _0x41ffe4=a1_0x47b81f;if(!_0x543a66||_0x543a66==='Unknown')return;let _0x26d20d=_0x41ffe4(0xeb),_0x478d09=0.6;try{const _0xd49f3=await _0x58f742[_0x41ffe4(0x134)]('analysis.automation.mode');if(_0xd49f3&&_0xd49f3['val'])_0x26d20d=_0xd49f3[_0x41ffe4(0x10b)];const _0x68b992=await _0x58f742[_0x41ffe4(0x134)](_0x41ffe4(0x13b));if(_0x68b992&&_0x68b992['val'])_0x478d09=_0x68b992['val'];}catch(_0x45eb0d){}if(_0x26d20d===_0x41ffe4(0xeb)||_0x52d793<_0x478d09)return;const _0x5d7903=Date['now']();if(lastActions[_0x543a66]&&_0x5d7903-lastActions[_0x543a66]<COOLDOWN_MS)return;const _0x34ed6a=_0x58f742[_0x41ffe4(0x13a)][_0x41ffe4(0x12f)]||[],_0x6bc5bd=normalize(_0x543a66),_0x368860=_0x34ed6a[_0x41ffe4(0xd0)](_0x5d52f7=>normalize(_0x5d52f7[_0x41ffe4(0x146)])===_0x6bc5bd&&(_0x5d52f7['type']==='light'||_0x5d52f7[_0x41ffe4(0x14b)]===_0x41ffe4(0xe7)||_0x5d52f7[_0x41ffe4(0x14b)]===_0x41ffe4(0x13d)));if(!_0x368860){_0x58f742[_0x41ffe4(0x10f)][_0x41ffe4(0x10c)](_0x41ffe4(0xdd)+_0x543a66+'\x27.');return;}const _0x3a872a=await aiAgent[_0x41ffe4(0x106)](_0x58f742,_0x543a66,_0x368860['name'],_0x52d793);if(!_0x3a872a[_0x41ffe4(0x113)])return;const _0xad5a71=_0x41ffe4(0x149)+_0x543a66+_0x41ffe4(0xec)+_0x368860['name']+'\x20('+_0x3a872a[_0x41ffe4(0x112)]+')';await _0x58f742[_0x41ffe4(0x11a)](_0x41ffe4(0x11b),{'val':'['+_0x26d20d[_0x41ffe4(0x10e)]()+']\x20'+_0xad5a71,'ack':!![]});if(_0x26d20d==='active'){const _0x3778b6=await _0x58f742[_0x41ffe4(0xed)](_0x368860['id']);(!_0x3778b6||!_0x3778b6[_0x41ffe4(0x10b)]&&_0x3778b6[_0x41ffe4(0x10b)]!==!![])&&await _0x58f742[_0x41ffe4(0x129)](_0x368860['id'],!![]),lastActions[_0x543a66]=_0x5d7903;}}async function findRelatedId(_0x214626,_0x52b2fa,_0x1c56fe='setpoint'){const _0x28f3da=a1_0x47b81f;if(_0x1c56fe===_0x28f3da(0x132)&&_0x214626['config'][_0x28f3da(0xd6)]){let _0xe19629=_0x214626[_0x28f3da(0x13a)][_0x28f3da(0xd6)];if(typeof _0xe19629==='string')try{_0xe19629=JSON[_0x28f3da(0xee)](_0xe19629);}catch(_0x4bfc9f){}if(_0xe19629&&_0xe19629[_0x52b2fa])return _0xe19629[_0x52b2fa];}if(_0x1c56fe===_0x28f3da(0x101)&&_0x214626[_0x28f3da(0x13a)][_0x28f3da(0x119)]){let _0x39c9e1=_0x214626[_0x28f3da(0x13a)][_0x28f3da(0x119)];if(typeof _0x39c9e1===_0x28f3da(0xe2))try{_0x39c9e1=JSON[_0x28f3da(0xee)](_0x39c9e1);}catch(_0x4ad8fb){}if(_0x39c9e1&&_0x39c9e1[_0x52b2fa])return _0x39c9e1[_0x52b2fa];}let _0x24d1bd=[];if(_0x1c56fe===_0x28f3da(0x132))_0x24d1bd=[{'s':_0x28f3da(0x11d),'t':_0x28f3da(0xfa)},{'s':'.1.TEMPERATURE','t':_0x28f3da(0xfa)},{'s':_0x28f3da(0x10d),'t':_0x28f3da(0xdf)},{'s':_0x28f3da(0xff),'t':'SET_POINT_TEMPERATURE'},{'s':'local_temperature','t':_0x28f3da(0xe3)},{'s':_0x28f3da(0xd3),'t':'current_heating_setpoint'},{'s':'temperature','t':_0x28f3da(0x144)},{'s':_0x28f3da(0x127),'t':'SET'},{'s':_0x28f3da(0xf9),'t':_0x28f3da(0x11f)},{'s':'temperature','t':'setpoint'}];else _0x1c56fe==='valve'&&(_0x24d1bd=[{'s':_0x28f3da(0x11d),'t':'.1.LEVEL'},{'s':'.1.TEMPERATURE','t':_0x28f3da(0x137)},{'s':_0x28f3da(0x10d),'t':_0x28f3da(0x140)},{'s':'local_temperature','t':_0x28f3da(0xfe)},{'s':_0x28f3da(0x100),'t':_0x28f3da(0xd8)},{'s':_0x28f3da(0x100),'t':_0x28f3da(0x126)}]);for(const _0x1a4164 of _0x24d1bd){if(_0x52b2fa[_0x28f3da(0x104)](_0x1a4164['s'])){const _0xc849f9=_0x52b2fa[_0x28f3da(0x105)](_0x1a4164['s'],_0x1a4164['t']),_0x457a2f=await _0x214626[_0x28f3da(0xcd)](_0xc849f9);if(_0x457a2f)return _0xc849f9;}}try{const _0x228621=_0x52b2fa[_0x28f3da(0xcf)]('.');if(_0x228621['length']>0x2){const _0xa9e02=_0x228621['slice'](0x0,-0x1)[_0x28f3da(0x115)]('.'),_0x5a0c46=await _0x214626['getForeignObjectsAsync'](_0xa9e02+'.*'),_0x1f6a59=[],_0x542d0c=_0x52b2fa[_0x28f3da(0xcf)](/[._]+/)['filter'](_0x10b85f=>!['openknx','0',_0x28f3da(0x131),_0x28f3da(0x125),_0x28f3da(0x118),_0x28f3da(0x100),_0x28f3da(0xe4),'sensor',_0x28f3da(0x12b),_0x28f3da(0xef)]['includes'](_0x10b85f[_0x28f3da(0x139)]()));for(const [_0x5a46dc,_0x37d186]of Object[_0x28f3da(0xe1)](_0x5a0c46)){if(_0x5a46dc===_0x52b2fa)continue;if(_0x37d186&&_0x37d186[_0x28f3da(0x109)]){const _0x959880=_0x5a46dc[_0x28f3da(0x139)](),_0x5d72e6=(_0x37d186[_0x28f3da(0x109)][_0x28f3da(0xfb)]||'')[_0x28f3da(0x139)](),_0x59ecdb=(_0x37d186[_0x28f3da(0x109)]['unit']||'')[_0x28f3da(0x139)]();let _0x2ef3e1=![];if(_0x1c56fe===_0x28f3da(0x132)&&_0x37d186[_0x28f3da(0x109)][_0x28f3da(0x147)]===!![])_0x2ef3e1=_0x959880[_0x28f3da(0x104)](_0x28f3da(0xde))||_0x959880[_0x28f3da(0x104)](_0x28f3da(0x117))||_0x959880['includes'](_0x28f3da(0xf5))||_0x5d72e6['includes'](_0x28f3da(0x13e))||_0x5d72e6[_0x28f3da(0x104)](_0x28f3da(0xe6));else _0x1c56fe===_0x28f3da(0x101)&&(_0x2ef3e1=_0x959880[_0x28f3da(0x104)](_0x28f3da(0x126))||_0x959880[_0x28f3da(0x104)](_0x28f3da(0x101))||_0x959880[_0x28f3da(0x104)]('stellwert')||_0x959880[_0x28f3da(0x104)](_0x28f3da(0xdc))||_0x5d72e6[_0x28f3da(0x104)](_0x28f3da(0xf3))||_0x5d72e6[_0x28f3da(0x104)](_0x28f3da(0x130))||_0x59ecdb[_0x28f3da(0x104)]('%'));if(_0x2ef3e1){const _0x1439a6=_0x5a46dc[_0x28f3da(0xcf)](/[._]+/)['map'](_0x1d7921=>_0x1d7921['toLowerCase']());let _0x4f9e00=0x0;_0x542d0c[_0x28f3da(0x136)](_0x1b9232=>{const _0xf3deb=_0x28f3da;if(_0x1439a6[_0xf3deb(0x104)](_0x1b9232[_0xf3deb(0x139)]()))_0x4f9e00++;}),_0x1f6a59[_0x28f3da(0x135)]({'id':_0x5a46dc,'score':_0x4f9e00});}}}if(_0x1f6a59[_0x28f3da(0x124)]>0x0){_0x1f6a59['sort']((_0xe7539,_0x387b96)=>_0x387b96[_0x28f3da(0x148)]-_0xe7539[_0x28f3da(0x148)]);if(_0x1f6a59[0x0][_0x28f3da(0x148)]>0x0)return _0x1f6a59[0x0]['id'];}}}catch(_0x315c01){}return null;}async function scanThermostats(_0x29dd1b){const _0x476de6=a1_0x47b81f,_0x4e4163=_0x29dd1b[_0x476de6(0x13a)]['devices']||[],_0x94627d=[],_0x2b9a47=_0x4e4163['filter'](_0x940e3b=>_0x940e3b['id']&&_0x940e3b['id'][_0x476de6(0x104)](_0x476de6(0x100))||_0x940e3b[_0x476de6(0x14b)]&&[_0x476de6(0x100),'thermostat','sensor']['includes'](_0x940e3b[_0x476de6(0x14b)])||_0x940e3b[_0x476de6(0xf0)]&&_0x940e3b[_0x476de6(0xf0)][_0x476de6(0x139)]()['includes'](_0x476de6(0x142)));for(const _0x4abbfc of _0x2b9a47){const _0x5530c3=await findRelatedId(_0x29dd1b,_0x4abbfc['id'],'setpoint'),_0x5d42e3=await findRelatedId(_0x29dd1b,_0x4abbfc['id'],_0x476de6(0x101));let _0x2a5f93='Nicht\x20gefunden',_0x32f82a=![],_0x547066=_0x29dd1b['config'][_0x476de6(0xd6)]||{};if(typeof _0x547066===_0x476de6(0xe2))try{_0x547066=JSON[_0x476de6(0xee)](_0x547066);}catch(_0x65ca3c){}let _0x15e34e=_0x29dd1b[_0x476de6(0x13a)][_0x476de6(0x119)]||{};if(typeof _0x15e34e==='string')try{_0x15e34e=JSON[_0x476de6(0xee)](_0x15e34e);}catch(_0x18faf3){}if(_0x547066[_0x4abbfc['id']]&&_0x547066[_0x4abbfc['id']]===_0x5530c3||_0x15e34e[_0x4abbfc['id']]&&_0x15e34e[_0x4abbfc['id']]===_0x5d42e3)_0x2a5f93=_0x476de6(0x12e),_0x32f82a=!![];else(_0x5530c3||_0x5d42e3)&&(_0x2a5f93=_0x476de6(0xe0));_0x94627d[_0x476de6(0x135)]({'room':_0x4abbfc[_0x476de6(0x146)]||_0x476de6(0xd5),'sensorId':_0x4abbfc['id'],'setpointId':_0x5530c3||'-','valveId':_0x5d42e3||'-','source':_0x2a5f93,'isManual':_0x32f82a,'status':_0x5530c3&&_0x5d42e3?_0x476de6(0xf8):_0x5530c3?'OK':_0x476de6(0x107)});}return _0x94627d[_0x476de6(0xfd)]((_0x3a5d86,_0x1205a3)=>_0x3a5d86[_0x476de6(0x128)]['localeCompare'](_0x1205a3[_0x476de6(0x128)]));}async function checkCalendarTriggers(_0x2dfee9){const _0x181c22=a1_0x47b81f;if(!_0x2dfee9['config'][_0x181c22(0x103)]||!_0x2dfee9[_0x181c22(0x13a)][_0x181c22(0x102)])return;let _0x48d6c0={};try{const _0xf0eead=await _0x2dfee9[_0x181c22(0x134)](_0x181c22(0x110));if(_0xf0eead&&_0xf0eead[_0x181c22(0x10b)])_0x48d6c0=JSON[_0x181c22(0xee)](_0xf0eead[_0x181c22(0x10b)]);}catch(_0x465b0c){}try{const _0x12fbb3=await _0x2dfee9[_0x181c22(0xed)](_0x2dfee9[_0x181c22(0x13a)]['calendarInstance']+_0x181c22(0xfc));if(!_0x12fbb3||!_0x12fbb3[_0x181c22(0x10b)])return;const _0x5f0902=JSON[_0x181c22(0xee)](_0x12fbb3[_0x181c22(0x10b)]),_0x54978d=new Date(),_0xc5214f=_0x2dfee9[_0x181c22(0x13a)]['devices']||[],_0x1e7933=_0x2dfee9[_0x181c22(0x13a)][_0x181c22(0x13f)]||[];for(const _0x20c563 of _0x5f0902){if(_0x20c563[_0x181c22(0x12d)]&&_0x1e7933['length']>0x0&&!_0x1e7933['includes'](_0x20c563[_0x181c22(0x12d)]))continue;const _0x3804aa=new Date(_0x20c563['eventStart']),_0x5e0ca7=(_0x20c563[_0x181c22(0xd1)]||_0x20c563['summary']||'')['toLowerCase']();if(_0x5e0ca7['includes'](_0x181c22(0x114))||_0x5e0ca7[_0x181c22(0x104)]('r√ºckkehr')||_0x5e0ca7['includes'](_0x181c22(0x123))){let _0x1954b8=0x0;Object[_0x181c22(0xe5)](_0x48d6c0)['forEach'](_0x4cec43=>{if(_0x4cec43>_0x1954b8)_0x1954b8=_0x4cec43;});if(_0x1954b8===0x0)_0x1954b8=0x78;const _0x366784=new Date(_0x3804aa['getTime']()-_0x1954b8*0xea60),_0x1b9ab8=_0x54978d[_0x181c22(0xdb)]()-_0x366784[_0x181c22(0xdb)]();_0x1b9ab8>=0x0&&_0x1b9ab8<0xf*0xea60&&(_0x2dfee9[_0x181c22(0x10f)]['info']('üìÖ\x20SMART\x20SCHEDULE:\x20\x27Globaler\x20Start\x27\x20erkannt\x20('+_0x20c563['event']+_0x181c22(0xea)+_0x1954b8+_0x181c22(0x133)),await _0x2dfee9[_0x181c22(0x11a)](_0x181c22(0x143),{'val':'normal','ack':![]}));}for(const _0x478d98 of _0xc5214f){if(_0x478d98[_0x181c22(0x146)]){const _0x177adf=_0x478d98[_0x181c22(0x146)]['toLowerCase']();if(_0x5e0ca7[_0x181c22(0x104)](_0x177adf)){const _0x51f5f3=_0x48d6c0[_0x478d98[_0x181c22(0x146)]]||0x3c,_0xe04582=new Date(_0x3804aa[_0x181c22(0xdb)]()-_0x51f5f3*0xea60),_0xf905e=_0x54978d['getTime']()-_0xe04582['getTime']();if(_0xf905e>=0x0&&_0xf905e<0xf*0xea60){const _0x1507b0=await findRelatedId(_0x2dfee9,_0x478d98['id'],'setpoint');_0x1507b0&&(_0x2dfee9[_0x181c22(0x10f)][_0x181c22(0xce)]('üìÖ\x20SMART\x20SCHEDULE:\x20Raum-Trigger\x20\x27'+_0x478d98[_0x181c22(0x146)]+_0x181c22(0x116)+_0x20c563['event']+').\x20Heize\x20auf\x2021¬∞C\x20(Vorlauf:\x20'+_0x51f5f3+_0x181c22(0x133)),await _0x2dfee9['setForeignStateAsync'](_0x1507b0,0x15),await _0x2dfee9[_0x181c22(0x11a)](_0x181c22(0x11b),{'val':'[CAL]\x20'+_0x478d98['location']+_0x181c22(0x122),'ack':!![]}));}}}}}}catch(_0x1cb714){_0x2dfee9['log'][_0x181c22(0xf2)](_0x181c22(0xf7)+_0x1cb714[_0x181c22(0x111)]);}}async function applyEnergySavings(_0xd212ee,_0x3533c6){const _0x1fc4c9=a1_0x47b81f,_0x2d0a6e=_0xd212ee[_0x1fc4c9(0x13a)][_0x1fc4c9(0x12f)]||[];for(const _0x58f34c of _0x3533c6){const _0x159e15=_0x58f34c[_0x1fc4c9(0x128)],_0x25efda=_0x58f34c[_0x1fc4c9(0x13c)],_0xa4e7bd=Date['now']();if(lastActions[_0x1fc4c9(0x11c)+_0x159e15]&&_0xa4e7bd-lastActions[_0x1fc4c9(0x11c)+_0x159e15]<0x1e*0x3c*0x3e8)continue;const _0x16d930=_0x2d0a6e[_0x1fc4c9(0xd0)](_0x7f5fae=>normalize(_0x7f5fae[_0x1fc4c9(0x146)])===normalize(_0x159e15));if(!_0x16d930)continue;const _0x30a1e9=await findRelatedId(_0xd212ee,_0x16d930['id'],_0x1fc4c9(0x132));if(_0x30a1e9){const _0x12151d=await _0xd212ee[_0x1fc4c9(0xed)](_0x30a1e9);if(_0x12151d&&typeof _0x12151d['val']===_0x1fc4c9(0xf1)){const _0x2fc315=_0x12151d[_0x1fc4c9(0x10b)];if(_0x25efda>0x1e&&_0x2fc315>0x11){const _0x897966=_0x2fc315-0x1;_0xd212ee[_0x1fc4c9(0x10f)][_0x1fc4c9(0xce)](_0x1fc4c9(0x108)+_0x159e15+'\x20('+_0x30a1e9+_0x1fc4c9(0x120)+_0x897966+_0x1fc4c9(0xf6)+_0x25efda+_0x1fc4c9(0xf4)),await _0xd212ee[_0x1fc4c9(0x129)](_0x30a1e9,_0x897966),lastActions['mpc_'+_0x159e15]=_0xa4e7bd,await _0xd212ee['setStateAsync'](_0x1fc4c9(0x11b),{'val':_0x1fc4c9(0xe9)+_0x159e15+':\x20-1¬∞C\x20(Sparpotenzial\x20genutzt)','ack':!![]});}}}}}module['exports']={'handlePrediction':handlePrediction,'applyEnergySavings':applyEnergySavings,'scanThermostats':scanThermostats,'checkCalendarTriggers':checkCalendarTriggers};