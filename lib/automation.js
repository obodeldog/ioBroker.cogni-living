function a1_0x5690(){const _0x21e68f=['forEach','ankunft','setStateAsync','remove','\x20min).','val','entries','Manuelles\x20Mapping','number','currentSystemMode','analysis.automation.lastAction','cal_','\x20ist\x20zu\x20kalt,\x20ABER\x20Fenster\x20offen/L√ºftung\x20erkannt.\x20Heize\x20NICHT,\x20entferne\x20nur\x20Status.','mpc_','.data.table','getTime','location','local_temperature','üéì\x20[RL-FEEDBACK]\x20Lerne\x20aus\x20Fehler:\x20','light','ist','valveMapping','soll','constructor','includes','target','date','level','write','45stSmHQ','SET','length','1waWxMW','target_temperature','thermostat','1839520jSHMtW','10736289DTFFZt','analysis.energy.mpcActiveInterventions','Unbekannt','system.mode','./ai_agent','window','split','üßπ\x20[MPC\x20CLEANUP]\x20Raum\x20\x27',']:\x20Raum-Trigger\x20\x27','Auto-Erkennung','stringify','state','\x20->\x20','(((.+)+)+)+$','Fehlt','off','rescue_','Ist','304224oYFEDe','type','config','contact','323262BqVrLx','valve','dimmer','sensor','üçÉ\x20[MPC\x20ACTION]\x20Senke\x20','set','.1.LEVEL','info','.1.SET_POINT_TEMPERATURE','üìÖ\x20SMART\x20SCHEDULE\x20[','eventStart','apply','.1.TEMPERATURE','setpoint','consultButler','openknx','\x20erreicht\x20Limit\x20(','search','toUpperCase','valve_position','analysis.energy.warmupSources','[WATCHDOG]\x20','level.valve','üìÖ\x20[MPC\x20INFO]\x20','¬∞C).\x20Entferne\x20Status.','analysis.energy.warmupTimes','1134758AMDywL','event','¬∞C\x20(Vorlauf:\x20','slice','1488445sPCZXC','push','pi_heating_demand','TRAIN_RL_PENALTY','wert','common','toString','summary','minutes_safe','thermostatMapping','log','analysis.automation.confidenceThreshold','exports','getForeignStateAsync','default','reason','unit','.4.VALVE_STATE','devices','normal','replace','parse','\x20ist\x20auf\x20','analysis.automation.actionLog','ACTUAL_TEMPERATURE','r√ºckkehr','now','\x20min)','trim','sort','add','Unknown','current_heating_setpoint','\x20gefunden!','filter','¬∞C\x20<\x20','approved','1678736owaBQD','hm-rpc','role','indexOf','_calName','thermostat.setpoint','Pr√§diktion:\x20','getForeignObjectAsync','[CAL]\x20','Nicht\x20gefunden','string','room','warn','\x20auf\x20','toLowerCase','abs','SET_POINT_TEMPERATURE','occupied_heating_setpoint','switch','calendarInstance','\x27\x20aktiv.\x20Heize\x20auf\x20','find','temperature','splice','sendToPythonWrapper','active',':\x20Puffer\x20leer\x20->\x20Heizen\x20auf\x20','getStateAsync','urlaub\x20ende','name','[MPC\x20WARNING]\x20Kein\x20Setpoint\x20f√ºr\x20','\x20wieder\x20auf\x20','too_cold','map','actual','getForeignObjectsAsync','join',':\x20Aufheizen\x20auf\x20','\x20durch\x20Kalender\x20ge√§ndert.\x20Keine\x20RL-Strafe.','open',':\x20Absenkung\x20auf\x20','.1.ACTUAL_TEMPERATURE','üö®\x20[MPC\x20WATCHDOG]\x20','¬∞C\x20(nicht\x20','manual','stellwert','_date','setForeignStateAsync','level.temperature','values','.4.SET_TEMPERATURE','¬∞C\x20(via\x20','unshift','calendarSelection','\x20wurde\x20manuell\x20erh√∂ht.','isArray','useCalendar'];a1_0x5690=function(){return _0x21e68f;};return a1_0x5690();}const a1_0x197df7=a1_0x57b6;(function(_0x451bf2,_0xc9de6e){const _0x3d8e02=a1_0x57b6,_0xd422aa=_0x451bf2();while(!![]){try{const _0x4fdaca=-parseInt(_0x3d8e02(0x222))/0x1*(parseInt(_0x3d8e02(0x256))/0x2)+parseInt(_0x3d8e02(0x238))/0x3+-parseInt(_0x3d8e02(0x1c9))/0x4+parseInt(_0x3d8e02(0x21f))/0x5*(parseInt(_0x3d8e02(0x23c))/0x6)+-parseInt(_0x3d8e02(0x25a))/0x7+-parseInt(_0x3d8e02(0x225))/0x8+parseInt(_0x3d8e02(0x226))/0x9;if(_0x4fdaca===_0xc9de6e)break;else _0xd422aa['push'](_0xd422aa['shift']());}catch(_0x30ed3f){_0xd422aa['push'](_0xd422aa['shift']());}}}(a1_0x5690,0x55590));const a1_0x5d7792=(function(){let _0x1b7013=!![];return function(_0x266490,_0x1444a0){const _0x25ac1a=_0x1b7013?function(){const _0x2c6e16=a1_0x57b6;if(_0x1444a0){const _0xd407bc=_0x1444a0[_0x2c6e16(0x247)](_0x266490,arguments);return _0x1444a0=null,_0xd407bc;}}:function(){};return _0x1b7013=![],_0x25ac1a;};}()),a1_0x28a4c3=a1_0x5d7792(this,function(){const _0x4ed226=a1_0x57b6;return a1_0x28a4c3[_0x4ed226(0x260)]()[_0x4ed226(0x24d)](_0x4ed226(0x233))[_0x4ed226(0x260)]()[_0x4ed226(0x219)](a1_0x28a4c3)[_0x4ed226(0x24d)](_0x4ed226(0x233));});function a1_0x57b6(_0x9e1ff7,_0x57e751){const _0x5cd210=a1_0x5690();return a1_0x57b6=function(_0x28a4c3,_0x5d7792){_0x28a4c3=_0x28a4c3-0x1bf;let _0x5690a0=_0x5cd210[_0x28a4c3];return _0x5690a0;},a1_0x57b6(_0x9e1ff7,_0x57e751);}a1_0x28a4c3();'use strict';const aiAgent=require(a1_0x197df7(0x22a)),COOLDOWN_MS=0x3c*0x3e8,CAL_COOLDOWN_MS=0x5a*0x3c*0x3e8,RESCUE_LOCK_MS=0x78*0x3c*0x3e8,ECO_TEMP=0x11,lastActions={};function normalize(_0x114c7b){const _0x651306=a1_0x197df7;if(!_0x114c7b)return'';return _0x114c7b['toLowerCase']()[_0x651306(0x26e)](/\s+/g,'')[_0x651306(0x1c0)]();}async function logAutomationAction(_0x407557,_0x4945d0){const _0x46aa28=a1_0x197df7;await _0x407557[_0x46aa28(0x204)](_0x46aa28(0x20c),{'val':_0x4945d0,'ack':!![]});try{const _0x369144=_0x46aa28(0x271),_0x2d361b=await _0x407557[_0x46aa28(0x1e4)](_0x369144);let _0x47c3e3=[];if(_0x2d361b&&_0x2d361b[_0x46aa28(0x207)])try{_0x47c3e3=JSON['parse'](_0x2d361b['val']);}catch(_0x15c62e){}_0x47c3e3[_0x46aa28(0x1fd)]({'ts':Date[_0x46aa28(0x274)](),'msg':_0x4945d0});if(_0x47c3e3[_0x46aa28(0x221)]>0x32)_0x47c3e3=_0x47c3e3[_0x46aa28(0x259)](0x0,0x32);await _0x407557[_0x46aa28(0x204)](_0x369144,{'val':JSON[_0x46aa28(0x230)](_0x47c3e3),'ack':!![]});}catch(_0x560d39){}}async function handlePrediction(_0x1baade,_0x467566,_0x4719b3){const _0x10f264=a1_0x197df7;if(!_0x467566||_0x467566===_0x10f264(0x1c3))return;let _0x4c31ec='off',_0x3d6a9d=0.6;try{const _0x263cab=await _0x1baade['getStateAsync']('analysis.automation.mode');if(_0x263cab&&_0x263cab[_0x10f264(0x207)])_0x4c31ec=_0x263cab[_0x10f264(0x207)];const _0x2114d2=await _0x1baade['getStateAsync'](_0x10f264(0x265));if(_0x2114d2&&_0x2114d2[_0x10f264(0x207)])_0x3d6a9d=_0x2114d2[_0x10f264(0x207)];}catch(_0x59f762){}if(_0x4c31ec===_0x10f264(0x235)||_0x4719b3<_0x3d6a9d)return;const _0x4f01a9=Date['now']();if(lastActions[_0x467566]&&_0x4f01a9-lastActions[_0x467566]<COOLDOWN_MS)return;const _0x3d7d6c=_0x1baade['config'][_0x10f264(0x26c)]||[],_0x291284=normalize(_0x467566),_0x2029b4=_0x3d7d6c['find'](_0x2dc7f5=>normalize(_0x2dc7f5[_0x10f264(0x212)])===_0x291284&&(_0x2dc7f5['type']===_0x10f264(0x215)||_0x2dc7f5[_0x10f264(0x239)]===_0x10f264(0x23e)||_0x2dc7f5[_0x10f264(0x239)]===_0x10f264(0x1db)));if(!_0x2029b4)return;const _0x28e620=await aiAgent[_0x10f264(0x24a)](_0x1baade,_0x467566,_0x2029b4['name'],_0x4719b3);if(!_0x28e620[_0x10f264(0x1c8)])return;const _0xd0e99b=_0x10f264(0x1cf)+_0x467566+'\x20->\x20Schalte\x20'+_0x2029b4[_0x10f264(0x1e6)]+'\x20('+_0x28e620[_0x10f264(0x269)]+')';await logAutomationAction(_0x1baade,'['+_0x4c31ec[_0x10f264(0x24e)]()+']\x20'+_0xd0e99b);if(_0x4c31ec===_0x10f264(0x1e2)){const _0xfe3516=await _0x1baade[_0x10f264(0x267)](_0x2029b4['id']);(!_0xfe3516||!_0xfe3516[_0x10f264(0x207)]&&_0xfe3516[_0x10f264(0x207)]!==!![])&&await _0x1baade['setForeignStateAsync'](_0x2029b4['id'],!![]),lastActions[_0x467566]=_0x4f01a9;}}async function findRelatedId(_0x29543c,_0x131f71,_0x330dbc=a1_0x197df7(0x249)){const _0x4a38cc=a1_0x197df7;if(_0x330dbc===_0x4a38cc(0x249)&&_0x29543c[_0x4a38cc(0x23a)][_0x4a38cc(0x263)]){let _0xbda558=_0x29543c[_0x4a38cc(0x23a)][_0x4a38cc(0x263)];if(typeof _0xbda558===_0x4a38cc(0x1d3))try{_0xbda558=JSON['parse'](_0xbda558);}catch(_0x4690e3){}if(_0xbda558&&_0xbda558[_0x131f71])return _0xbda558[_0x131f71];}if(_0x330dbc===_0x4a38cc(0x23d)&&_0x29543c['config'][_0x4a38cc(0x217)]){let _0x56469d=_0x29543c['config']['valveMapping'];if(typeof _0x56469d===_0x4a38cc(0x1d3))try{_0x56469d=JSON[_0x4a38cc(0x26f)](_0x56469d);}catch(_0x280419){}if(_0x56469d&&_0x56469d[_0x131f71])return _0x56469d[_0x131f71];}let _0xcbeeee=[];if(_0x330dbc===_0x4a38cc(0x249))_0xcbeeee=[{'s':_0x4a38cc(0x1f2),'t':_0x4a38cc(0x244)},{'s':'.1.TEMPERATURE','t':_0x4a38cc(0x244)},{'s':_0x4a38cc(0x248),'t':_0x4a38cc(0x1fb)},{'s':_0x4a38cc(0x272),'t':_0x4a38cc(0x1d9)},{'s':_0x4a38cc(0x213),'t':_0x4a38cc(0x1da)},{'s':_0x4a38cc(0x213),'t':_0x4a38cc(0x1c4)},{'s':_0x4a38cc(0x1df),'t':_0x4a38cc(0x223)},{'s':'ACTUAL','t':_0x4a38cc(0x220)},{'s':_0x4a38cc(0x237),'t':'Soll'},{'s':_0x4a38cc(0x1df),'t':_0x4a38cc(0x249)}];else _0x330dbc==='valve'&&(_0xcbeeee=[{'s':_0x4a38cc(0x1f2),'t':_0x4a38cc(0x242)},{'s':_0x4a38cc(0x248),'t':_0x4a38cc(0x242)},{'s':'.1.TEMPERATURE','t':_0x4a38cc(0x26b)},{'s':_0x4a38cc(0x213),'t':_0x4a38cc(0x25c)},{'s':_0x4a38cc(0x1df),'t':_0x4a38cc(0x24f)},{'s':_0x4a38cc(0x1df),'t':_0x4a38cc(0x21d)}]);for(const _0x1be36c of _0xcbeeee){if(_0x131f71[_0x4a38cc(0x21a)](_0x1be36c['s'])){const _0x2551e9=_0x131f71['replace'](_0x1be36c['s'],_0x1be36c['t']),_0x4abdbf=await _0x29543c[_0x4a38cc(0x1d0)](_0x2551e9);if(_0x4abdbf)return _0x2551e9;}}try{const _0x5754b6=_0x131f71[_0x4a38cc(0x22c)]('.');if(_0x5754b6[_0x4a38cc(0x221)]>0x2){const _0x44e85e=_0x5754b6[_0x4a38cc(0x259)](0x0,-0x1)[_0x4a38cc(0x1ed)]('.'),_0x5295e5=await _0x29543c[_0x4a38cc(0x1ec)](_0x44e85e+'.*'),_0x2df7ae=[],_0x1ce3ae=_0x131f71[_0x4a38cc(0x22c)](/[._]+/)[_0x4a38cc(0x1c6)](_0x1c4d3b=>![_0x4a38cc(0x24b),'0',_0x4a38cc(0x1ca),_0x4a38cc(0x216),_0x4a38cc(0x25e),_0x4a38cc(0x1df),_0x4a38cc(0x1eb),'sensor','messwert',_0x4a38cc(0x231)][_0x4a38cc(0x21a)](_0x1c4d3b[_0x4a38cc(0x1d7)]()));for(const [_0x22f210,_0x1a6fd1]of Object[_0x4a38cc(0x208)](_0x5295e5)){if(_0x22f210===_0x131f71)continue;if(_0x1a6fd1&&_0x1a6fd1[_0x4a38cc(0x25f)]){const _0x1fcdd6=_0x22f210[_0x4a38cc(0x1d7)](),_0x27d57b=(_0x1a6fd1[_0x4a38cc(0x25f)][_0x4a38cc(0x1cb)]||'')['toLowerCase'](),_0x4de034=(_0x1a6fd1[_0x4a38cc(0x25f)][_0x4a38cc(0x26a)]||'')[_0x4a38cc(0x1d7)]();let _0x9c9aed=![];if(_0x330dbc===_0x4a38cc(0x249)&&_0x1a6fd1[_0x4a38cc(0x25f)][_0x4a38cc(0x21e)]===!![])_0x9c9aed=_0x1fcdd6[_0x4a38cc(0x21a)](_0x4a38cc(0x241))||_0x1fcdd6[_0x4a38cc(0x21a)](_0x4a38cc(0x218))||_0x1fcdd6[_0x4a38cc(0x21a)]('target')||_0x27d57b[_0x4a38cc(0x21a)](_0x4a38cc(0x1f9))||_0x27d57b[_0x4a38cc(0x21a)](_0x4a38cc(0x1ce));else _0x330dbc===_0x4a38cc(0x23d)&&(_0x9c9aed=_0x1fcdd6[_0x4a38cc(0x21a)](_0x4a38cc(0x21d))||_0x1fcdd6['includes']('valve')||_0x1fcdd6[_0x4a38cc(0x21a)](_0x4a38cc(0x1f6))||_0x1fcdd6['includes']('position')||_0x27d57b[_0x4a38cc(0x21a)](_0x4a38cc(0x252))||_0x27d57b[_0x4a38cc(0x21a)]('value.valve')||_0x4de034[_0x4a38cc(0x21a)]('%'));if(_0x9c9aed){const _0xfede67=_0x22f210[_0x4a38cc(0x22c)](/[._]+/)[_0x4a38cc(0x1ea)](_0x22388f=>_0x22388f['toLowerCase']());let _0x202f94=0x0;_0x1ce3ae[_0x4a38cc(0x202)](_0x2cb866=>{const _0x33c115=_0x4a38cc;if(_0xfede67['includes'](_0x2cb866[_0x33c115(0x1d7)]()))_0x202f94++;}),_0x2df7ae[_0x4a38cc(0x25b)]({'id':_0x22f210,'score':_0x202f94});}}}if(_0x2df7ae[_0x4a38cc(0x221)]>0x0){_0x2df7ae['sort']((_0xd26860,_0xf6e277)=>_0xf6e277['score']-_0xd26860['score']);if(_0x2df7ae[0x0]['score']>0x0)return _0x2df7ae[0x0]['id'];}}}catch(_0x2ca733){}return null;}async function scanThermostats(_0x4a9075){const _0x36fa70=a1_0x197df7,_0x3836a1=_0x4a9075[_0x36fa70(0x23a)][_0x36fa70(0x26c)]||[],_0x1a8eca=[],_0x140436=_0x3836a1[_0x36fa70(0x1c6)](_0x4ec2d5=>_0x4ec2d5['id']&&_0x4ec2d5['id']['includes'](_0x36fa70(0x1df))||_0x4ec2d5[_0x36fa70(0x239)]&&[_0x36fa70(0x1df),_0x36fa70(0x224),_0x36fa70(0x23f)][_0x36fa70(0x21a)](_0x4ec2d5[_0x36fa70(0x239)])||_0x4ec2d5['name']&&_0x4ec2d5[_0x36fa70(0x1e6)][_0x36fa70(0x1d7)]()[_0x36fa70(0x21a)]('temp'));for(const _0x42e01f of _0x140436){const _0xf10461=await findRelatedId(_0x4a9075,_0x42e01f['id'],_0x36fa70(0x249)),_0x17774f=await findRelatedId(_0x4a9075,_0x42e01f['id'],_0x36fa70(0x23d));let _0x4b7f39=_0x36fa70(0x1d2),_0xc1db2a=![],_0x596a21=_0x4a9075[_0x36fa70(0x23a)][_0x36fa70(0x263)]||{};if(typeof _0x596a21===_0x36fa70(0x1d3))try{_0x596a21=JSON[_0x36fa70(0x26f)](_0x596a21);}catch(_0x3f5b22){}let _0xdcf932=_0x4a9075[_0x36fa70(0x23a)][_0x36fa70(0x217)]||{};if(typeof _0xdcf932==='string')try{_0xdcf932=JSON[_0x36fa70(0x26f)](_0xdcf932);}catch(_0x17777a){}if(_0x596a21[_0x42e01f['id']]&&_0x596a21[_0x42e01f['id']]===_0xf10461||_0xdcf932[_0x42e01f['id']]&&_0xdcf932[_0x42e01f['id']]===_0x17774f)_0x4b7f39=_0x36fa70(0x209),_0xc1db2a=!![];else(_0xf10461||_0x17774f)&&(_0x4b7f39=_0x36fa70(0x22f));_0x1a8eca[_0x36fa70(0x25b)]({'room':_0x42e01f['location']||_0x36fa70(0x228),'sensorId':_0x42e01f['id'],'setpointId':_0xf10461||'-','valveId':_0x17774f||'-','source':_0x4b7f39,'isManual':_0xc1db2a,'status':_0xf10461&&_0x17774f?'PERFECT':_0xf10461?'OK':_0x36fa70(0x234)});}return _0x1a8eca[_0x36fa70(0x1c1)]((_0x329bcf,_0x578a9b)=>_0x329bcf[_0x36fa70(0x1d4)]['localeCompare'](_0x578a9b[_0x36fa70(0x1d4)]));}async function updateSchedulePreview(_0x2aa73c){const _0x5bea86=a1_0x197df7;if(!_0x2aa73c[_0x5bea86(0x23a)]['useCalendar']||!_0x2aa73c[_0x5bea86(0x23a)][_0x5bea86(0x1dc)])return;let _0x4f6831={};try{const _0xda1a3f=await _0x2aa73c[_0x5bea86(0x1e4)]('analysis.energy.warmupTimes');if(_0xda1a3f&&_0xda1a3f[_0x5bea86(0x207)])_0x4f6831=JSON[_0x5bea86(0x26f)](_0xda1a3f['val']);}catch(_0x306d7b){}const _0x30a367=[],_0x1eb095=Date['now'](),_0x42e2cc=0x30*0x3c*0x3c*0x3e8;try{const _0x26bb2e=await _0x2aa73c[_0x5bea86(0x267)](_0x2aa73c[_0x5bea86(0x23a)]['calendarInstance']+_0x5bea86(0x210));if(!_0x26bb2e||!_0x26bb2e[_0x5bea86(0x207)])return;const _0x3a01a8=JSON[_0x5bea86(0x26f)](_0x26bb2e[_0x5bea86(0x207)]),_0x6b6f11=_0x2aa73c[_0x5bea86(0x23a)]['calendarSelection']||[],_0x2887bf=_0x2aa73c[_0x5bea86(0x23a)][_0x5bea86(0x26c)]||[],_0x37aa99=new Set();_0x2887bf[_0x5bea86(0x202)](_0x42995d=>{const _0x4ecda0=_0x5bea86;if(_0x42995d['location'])_0x37aa99[_0x4ecda0(0x1c2)](_0x42995d['location']);});for(const _0x2a454c of _0x3a01a8){if(_0x2a454c[_0x5bea86(0x1cd)]&&_0x6b6f11[_0x5bea86(0x221)]>0x0&&!_0x6b6f11[_0x5bea86(0x21a)](_0x2a454c[_0x5bea86(0x1cd)]))continue;const _0x578246=_0x2a454c['_date']||_0x2a454c[_0x5bea86(0x246)]||_0x2a454c[_0x5bea86(0x21c)];if(!_0x578246)continue;const _0x1295fe=new Date(_0x578246),_0x4ee003=_0x1295fe[_0x5bea86(0x211)]();if(isNaN(_0x4ee003))continue;if(_0x4ee003<_0x1eb095)continue;if(_0x4ee003>_0x1eb095+_0x42e2cc)continue;const _0x491fdd=(_0x2a454c[_0x5bea86(0x257)]||_0x2a454c['summary']||'')[_0x5bea86(0x1d7)]();let _0x4a84e4=![],_0x1378ff=[],_0x210040=_0x2a454c[_0x5bea86(0x257)]||_0x2a454c[_0x5bea86(0x261)]||_0x5bea86(0x228);if(_0x491fdd[_0x5bea86(0x21a)](_0x5bea86(0x1e5))||_0x491fdd['includes'](_0x5bea86(0x273))||_0x491fdd[_0x5bea86(0x21a)]('ankunft'))_0x4a84e4=!![],_0x1378ff=Array['from'](_0x37aa99);else for(const _0x1b6e8a of _0x37aa99){if(_0x491fdd[_0x5bea86(0x21a)](_0x1b6e8a[_0x5bea86(0x1d7)]()))_0x1378ff[_0x5bea86(0x25b)](_0x1b6e8a);}_0x1378ff[_0x5bea86(0x221)]>0x0&&_0x1378ff[_0x5bea86(0x202)](_0x41234c=>{const _0x4d1d94=_0x5bea86;let _0x227a8b=0x3c;if(_0x4a84e4){let _0x18b177=0x0;Object[_0x4d1d94(0x1fa)](_0x4f6831)[_0x4d1d94(0x202)](_0xa68987=>{if(_0xa68987>_0x18b177)_0x18b177=_0xa68987;}),_0x227a8b=_0x18b177>0x0?_0x18b177:0x78;}else _0x227a8b=_0x4f6831[_0x41234c]||0x3c;const _0x35c5d4=new Date(_0x4ee003-_0x227a8b*0xea60);_0x30a367[_0x4d1d94(0x25b)]({'eventTime':_0x4ee003,'triggerTime':_0x35c5d4['getTime'](),'room':_0x41234c,'minutes':_0x227a8b,'reason':_0x210040,'isGlobal':_0x4a84e4});});}}catch(_0x1d939f){}_0x30a367['sort']((_0x5009d3,_0x4a1010)=>_0x5009d3['triggerTime']-_0x4a1010['triggerTime']);const _0x4de06a=_0x30a367[_0x5bea86(0x259)](0x0,0x5);await _0x2aa73c[_0x5bea86(0x204)]('analysis.energy.schedulePreview',{'val':JSON[_0x5bea86(0x230)](_0x4de06a),'ack':!![]});}async function checkCalendarTriggers(_0x387b95){const _0x580b8f=a1_0x197df7;if(!_0x387b95['config'][_0x580b8f(0x201)]||!_0x387b95[_0x580b8f(0x23a)][_0x580b8f(0x1dc)])return;await updateSchedulePreview(_0x387b95);let _0x244d30={},_0x3808d6={};try{const _0x5d3a13=await _0x387b95[_0x580b8f(0x1e4)](_0x580b8f(0x255));if(_0x5d3a13&&_0x5d3a13[_0x580b8f(0x207)])_0x244d30=JSON[_0x580b8f(0x26f)](_0x5d3a13[_0x580b8f(0x207)]);const _0x932565=await _0x387b95[_0x580b8f(0x1e4)](_0x580b8f(0x250));if(_0x932565&&_0x932565[_0x580b8f(0x207)])_0x3808d6=JSON[_0x580b8f(0x26f)](_0x932565[_0x580b8f(0x207)]);}catch(_0x2e0f36){}let _0x4efb26={'default':0x15};try{const _0x4bf3ec=await _0x387b95[_0x580b8f(0x1e4)]('analysis.energy.warmupTargets');if(_0x4bf3ec&&_0x4bf3ec[_0x580b8f(0x207)])_0x4efb26=JSON[_0x580b8f(0x26f)](_0x4bf3ec['val']);}catch(_0x3b18d6){}try{const _0x589752=await _0x387b95['getForeignStateAsync'](_0x387b95[_0x580b8f(0x23a)]['calendarInstance']+_0x580b8f(0x210));if(!_0x589752||!_0x589752[_0x580b8f(0x207)])return;const _0x1de994=JSON[_0x580b8f(0x26f)](_0x589752['val']),_0xda91c2=Date[_0x580b8f(0x274)](),_0x4467e9=_0x387b95[_0x580b8f(0x23a)][_0x580b8f(0x26c)]||[],_0x4b4a6a=_0x387b95['config'][_0x580b8f(0x1fe)]||[];for(const _0xf373a7 of _0x1de994){if(_0xf373a7[_0x580b8f(0x1cd)]&&_0x4b4a6a[_0x580b8f(0x221)]>0x0&&!_0x4b4a6a['includes'](_0xf373a7['_calName']))continue;const _0x4f134b=_0xf373a7[_0x580b8f(0x1f7)]||_0xf373a7[_0x580b8f(0x246)]||_0xf373a7[_0x580b8f(0x21c)];if(!_0x4f134b)continue;const _0x4e8693=new Date(_0x4f134b);if(isNaN(_0x4e8693[_0x580b8f(0x211)]()))continue;const _0x302a65=(_0xf373a7[_0x580b8f(0x257)]||_0xf373a7['summary']||'')[_0x580b8f(0x1d7)]();if(_0x302a65[_0x580b8f(0x21a)]('urlaub\x20ende')||_0x302a65['includes'](_0x580b8f(0x273))||_0x302a65[_0x580b8f(0x21a)](_0x580b8f(0x203))){let _0x1a3625=0x0;Object[_0x580b8f(0x1fa)](_0x244d30)[_0x580b8f(0x202)](_0x498a9d=>{if(_0x498a9d>_0x1a3625)_0x1a3625=_0x498a9d;});if(_0x1a3625===0x0)_0x1a3625=0x78;const _0x1e2d83=_0x4e8693['getTime']()-_0x1a3625*0xea60;_0xda91c2>=_0x1e2d83&&_0xda91c2<_0x4e8693[_0x580b8f(0x211)]()&&(_0x387b95[_0x580b8f(0x20b)]!==_0x580b8f(0x26d)&&(_0x387b95[_0x580b8f(0x264)][_0x580b8f(0x243)]('üìÖ\x20SMART\x20SCHEDULE\x20(Phase):\x20\x27Globaler\x20Start\x27\x20erkannt.\x20Heize\x20Haus\x20auf\x20(Vorlauf:\x20'+_0x1a3625+_0x580b8f(0x206)),await _0x387b95[_0x580b8f(0x204)](_0x580b8f(0x229),{'val':_0x580b8f(0x26d),'ack':![]})));}for(const _0x1d72ad of _0x4467e9){if(_0x1d72ad['location']){const _0x25a076=_0x1d72ad[_0x580b8f(0x212)][_0x580b8f(0x1d7)]();if(_0x302a65[_0x580b8f(0x21a)](_0x25a076)){const _0x4881ea=_0x244d30[_0x1d72ad[_0x580b8f(0x212)]]||0x3c,_0x17931c=_0x3808d6[_0x1d72ad[_0x580b8f(0x212)]]||'Classic',_0x6beec5=_0x4e8693[_0x580b8f(0x211)]()-_0x4881ea*0xea60;if(_0xda91c2>=_0x6beec5&&_0xda91c2<_0x4e8693[_0x580b8f(0x211)]()){const _0xca8917=lastActions[_0x580b8f(0x20d)+_0x1d72ad[_0x580b8f(0x212)]];if(_0xca8917&&_0xda91c2-_0xca8917<CAL_COOLDOWN_MS)continue;const _0x185022=await findRelatedId(_0x387b95,_0x1d72ad['id'],_0x580b8f(0x249));if(_0x185022){let _0x2b6661=_0x4efb26[_0x1d72ad[_0x580b8f(0x212)]];if(_0x2b6661===undefined)_0x2b6661=_0x4efb26[_0x580b8f(0x268)];if(_0x2b6661===undefined)_0x2b6661=0x15;const _0x1c4956=await _0x387b95[_0x580b8f(0x267)](_0x185022);_0x1c4956&&typeof _0x1c4956[_0x580b8f(0x207)]===_0x580b8f(0x20a)&&_0x1c4956[_0x580b8f(0x207)]<_0x2b6661-0.5&&(_0x387b95['log'][_0x580b8f(0x243)](_0x580b8f(0x245)+_0x17931c+_0x580b8f(0x22e)+_0x1d72ad['location']+_0x580b8f(0x1dd)+_0x2b6661+_0x580b8f(0x258)+_0x4881ea+_0x580b8f(0x206)),await _0x387b95[_0x580b8f(0x1f8)](_0x185022,_0x2b6661),await logAutomationAction(_0x387b95,_0x580b8f(0x1d1)+_0x1d72ad[_0x580b8f(0x212)]+_0x580b8f(0x232)+_0x2b6661+_0x580b8f(0x1fc)+_0x17931c+')'),lastActions[_0x580b8f(0x20d)+_0x1d72ad[_0x580b8f(0x212)]]=_0xda91c2);}}}}}}}catch(_0x27e5d4){_0x387b95['log'][_0x580b8f(0x1d5)]('Calendar\x20Check\x20Error:\x20'+_0x27e5d4['message']);}}async function manageMpcIntervention(_0x3ec463,_0xbe7842,_0x31f599){const _0x15033b=a1_0x197df7;try{const _0x1c6c62=_0x15033b(0x227),_0x4b4909=await _0x3ec463[_0x15033b(0x1e4)](_0x1c6c62);let _0xaed8e7=[];if(_0x4b4909&&_0x4b4909['val'])try{_0xaed8e7=JSON['parse'](_0x4b4909[_0x15033b(0x207)]);}catch(_0x23395e){}const _0x4f2893=_0xaed8e7[_0x15033b(0x1cc)](_0xbe7842);if(_0x31f599==='add')_0x4f2893===-0x1&&(_0xaed8e7[_0x15033b(0x25b)](_0xbe7842),await _0x3ec463[_0x15033b(0x204)](_0x1c6c62,{'val':JSON[_0x15033b(0x230)](_0xaed8e7),'ack':!![]}));else _0x31f599===_0x15033b(0x205)&&(_0x4f2893!==-0x1&&(_0xaed8e7[_0x15033b(0x1e0)](_0x4f2893,0x1),await _0x3ec463[_0x15033b(0x204)](_0x1c6c62,{'val':JSON[_0x15033b(0x230)](_0xaed8e7),'ack':!![]})));}catch(_0x39f623){}}async function cleanupGhostInterventions(_0x29e60b){const _0x5bd313=a1_0x197df7;try{const _0x53ae71='analysis.energy.mpcActiveInterventions',_0x100c69=await _0x29e60b[_0x5bd313(0x1e4)](_0x53ae71);if(!_0x100c69||!_0x100c69[_0x5bd313(0x207)])return;const _0xe92993=JSON[_0x5bd313(0x26f)](_0x100c69[_0x5bd313(0x207)]);if(!Array[_0x5bd313(0x200)](_0xe92993)||_0xe92993['length']===0x0)return;let _0x4e29d8={'default':0x15};try{const _0x1b3014=await _0x29e60b['getStateAsync']('analysis.energy.warmupTargets');if(_0x1b3014&&_0x1b3014['val'])_0x4e29d8=JSON[_0x5bd313(0x26f)](_0x1b3014[_0x5bd313(0x207)]);}catch(_0xcc42a){}let _0x4dd7cb=[];try{const _0x48de68=await _0x29e60b[_0x5bd313(0x1e4)]('analysis.energy.ventilationAlerts');if(_0x48de68&&_0x48de68[_0x5bd313(0x207)])_0x4dd7cb=JSON[_0x5bd313(0x26f)](_0x48de68[_0x5bd313(0x207)]);}catch(_0x16754f){}const _0x3964e5=_0x29e60b[_0x5bd313(0x23a)]['devices']||[];let _0x2e346d=![];for(let _0x5b3180=_0xe92993[_0x5bd313(0x221)]-0x1;_0x5b3180>=0x0;_0x5b3180--){const _0x16ec0c=_0xe92993[_0x5b3180],_0x1fa3cf=_0x3964e5[_0x5bd313(0x1de)](_0x1668df=>normalize(_0x1668df[_0x5bd313(0x212)])===normalize(_0x16ec0c)&&(_0x1668df[_0x5bd313(0x239)]===_0x5bd313(0x1df)||_0x1668df[_0x5bd313(0x239)]==='thermostat'));if(!_0x1fa3cf){_0x29e60b['log'][_0x5bd313(0x1d5)](_0x5bd313(0x22d)+_0x16ec0c+'\x27\x20hat\x20kein\x20Ger√§t\x20mehr.\x20L√∂sche\x20Eintrag.'),_0xe92993[_0x5bd313(0x1e0)](_0x5b3180,0x1),_0x2e346d=!![];continue;}if(_0x1fa3cf){const _0x75caac=await findRelatedId(_0x29e60b,_0x1fa3cf['id'],_0x5bd313(0x249)),_0x15d798=await _0x29e60b[_0x5bd313(0x267)](_0x1fa3cf['id']);if(_0x75caac){const _0x3d26a8=await _0x29e60b[_0x5bd313(0x267)](_0x75caac);if(_0x3d26a8&&typeof _0x3d26a8[_0x5bd313(0x207)]===_0x5bd313(0x20a)){let _0xd7429d=![],_0x26e2f6='';Math[_0x5bd313(0x1d8)](_0x3d26a8[_0x5bd313(0x207)]-ECO_TEMP)>0.5&&(_0xd7429d=!![],_0x26e2f6=_0x5bd313(0x1f5));if(!_0xd7429d&&_0x15d798&&typeof _0x15d798[_0x5bd313(0x207)]===_0x5bd313(0x20a)){const _0x13b566=_0x4e29d8[_0x16ec0c]||_0x4e29d8['default']||0x15;_0x15d798[_0x5bd313(0x207)]<_0x13b566+0.2&&(_0xd7429d=!![],_0x26e2f6='too_cold');}if(_0xd7429d){if(_0x26e2f6===_0x5bd313(0x1f5)){_0x29e60b[_0x5bd313(0x264)][_0x5bd313(0x243)]('üßπ\x20[MPC\x20CLEANUP]\x20'+_0x16ec0c+_0x5bd313(0x270)+_0x3d26a8[_0x5bd313(0x207)]+_0x5bd313(0x1f4)+ECO_TEMP+_0x5bd313(0x254));const _0x42085a=lastActions[_0x5bd313(0x20d)+_0x16ec0c],_0x4fa2a9=_0x42085a&&Date[_0x5bd313(0x274)]()-_0x42085a<0x2*0x3c*0x3e8;if(!_0x4fa2a9&&_0x3d26a8[_0x5bd313(0x207)]>ECO_TEMP+0.5)_0x29e60b[_0x5bd313(0x1e1)]&&(_0x29e60b[_0x5bd313(0x264)][_0x5bd313(0x243)](_0x5bd313(0x214)+_0x16ec0c+_0x5bd313(0x1ff)),_0x29e60b[_0x5bd313(0x1e1)](_0x5bd313(0x25d),{'room':_0x16ec0c}));else _0x4fa2a9&&_0x29e60b['log']['info'](_0x5bd313(0x253)+_0x16ec0c+_0x5bd313(0x1ef));}else{if(_0x26e2f6===_0x5bd313(0x1e9)){let _0x396fd7=![];if(_0x4dd7cb[_0x5bd313(0x1de)](_0x56ad02=>_0x56ad02[_0x5bd313(0x1d4)]===_0x16ec0c))_0x396fd7=!![];const _0x79a77e=_0x3964e5['filter'](_0x5126a8=>normalize(_0x5126a8[_0x5bd313(0x212)])===normalize(_0x16ec0c)&&(_0x5126a8['type']===_0x5bd313(0x22b)||_0x5126a8['type']===_0x5bd313(0x23f)||_0x5126a8['type']===_0x5bd313(0x23b)));for(const _0x828d2f of _0x79a77e){try{const _0x50c3d9=await _0x29e60b['getForeignStateAsync'](_0x828d2f['id']);if(_0x50c3d9&&(_0x50c3d9['val']===!![]||_0x50c3d9[_0x5bd313(0x207)]===0x1||String(_0x50c3d9[_0x5bd313(0x207)])['toLowerCase']()===_0x5bd313(0x1f0)))_0x396fd7=!![];}catch(_0x59001e){}}if(_0x396fd7)_0x29e60b[_0x5bd313(0x264)][_0x5bd313(0x243)]('üå¨Ô∏è\x20[MPC\x20WATCHDOG]\x20'+_0x16ec0c+_0x5bd313(0x20e));else{const _0x5d1290=_0x4e29d8[_0x16ec0c]||_0x4e29d8['default']||0x15;_0x29e60b[_0x5bd313(0x264)]['info'](_0x5bd313(0x1f3)+_0x16ec0c+_0x5bd313(0x24c)+_0x15d798['val']+_0x5bd313(0x1c7)+(_0x5d1290+0.2)+'¬∞C).\x20Sparmodus\x20beendet!'),await _0x29e60b[_0x5bd313(0x1f8)](_0x75caac,_0x5d1290),await logAutomationAction(_0x29e60b,_0x5bd313(0x251)+_0x16ec0c+_0x5bd313(0x1e3)+_0x5d1290+'¬∞C'),lastActions[_0x5bd313(0x236)+_0x16ec0c]=Date[_0x5bd313(0x274)]();}}}_0xe92993[_0x5bd313(0x1e0)](_0x5b3180,0x1),_0x2e346d=!![];}}}}}_0x2e346d&&await _0x29e60b[_0x5bd313(0x204)](_0x53ae71,{'val':JSON['stringify'](_0xe92993),'ack':!![]});}catch(_0x5e7c3e){}}async function applyEnergySavings(_0x286ff4,_0x956665){const _0x193044=a1_0x197df7;await cleanupGhostInterventions(_0x286ff4);if(!_0x956665||_0x956665[_0x193044(0x221)]===0x0)return;const _0x2f8bba=_0x286ff4[_0x193044(0x23a)][_0x193044(0x26c)]||[],_0x499997=Date[_0x193044(0x274)]();for(const _0x44bad7 of _0x956665){const _0x4102eb=_0x44bad7[_0x193044(0x1d4)],_0x52d6de=_0x44bad7[_0x193044(0x262)],_0x495ae1=_0x44bad7[_0x193044(0x21b)]||0x15;if(lastActions[_0x193044(0x236)+_0x4102eb]&&_0x499997-lastActions['rescue_'+_0x4102eb]<RESCUE_LOCK_MS)continue;const _0x2559f0=_0x2f8bba[_0x193044(0x1de)](_0x2527ca=>normalize(_0x2527ca[_0x193044(0x212)])===normalize(_0x4102eb)&&(_0x2527ca[_0x193044(0x239)]===_0x193044(0x1df)||_0x2527ca['type']===_0x193044(0x224)));if(!_0x2559f0)continue;const _0x58f5bf=await findRelatedId(_0x286ff4,_0x2559f0['id'],'setpoint');if(_0x58f5bf){if(lastActions[_0x193044(0x20f)+_0x4102eb]&&_0x499997-lastActions[_0x193044(0x20f)+_0x4102eb]<0x1e*0x3c*0x3e8)continue;const _0x3338cf=await _0x286ff4[_0x193044(0x267)](_0x58f5bf);if(_0x3338cf&&typeof _0x3338cf[_0x193044(0x207)]===_0x193044(0x20a)){const _0x4d171c=_0x3338cf[_0x193044(0x207)];_0x4d171c!==ECO_TEMP&&await manageMpcIntervention(_0x286ff4,_0x4102eb,_0x193044(0x205));if(_0x52d6de>0x1e)_0x4d171c>ECO_TEMP+0.5&&(_0x286ff4['log'][_0x193044(0x243)](_0x193044(0x240)+_0x4102eb+_0x193044(0x1d6)+ECO_TEMP+'¬∞C!\x20(Puffer:\x20'+_0x52d6de+_0x193044(0x1bf)),await _0x286ff4[_0x193044(0x1f8)](_0x58f5bf,ECO_TEMP),await manageMpcIntervention(_0x286ff4,_0x4102eb,_0x193044(0x1c2)),lastActions[_0x193044(0x20f)+_0x4102eb]=_0x499997,await logAutomationAction(_0x286ff4,'[MPC]\x20'+_0x4102eb+_0x193044(0x1f1)+ECO_TEMP+'¬∞C'));else _0x52d6de<=0xf&&(_0x4d171c<_0x495ae1&&(_0x286ff4[_0x193044(0x264)]['info']('üî•\x20[MPC\x20ACTION]\x20Heize\x20'+_0x4102eb+_0x193044(0x1e8)+_0x495ae1+'¬∞C!\x20(Puffer\x20leer).'),await _0x286ff4[_0x193044(0x1f8)](_0x58f5bf,_0x495ae1),await manageMpcIntervention(_0x286ff4,_0x4102eb,_0x193044(0x205)),lastActions[_0x193044(0x20f)+_0x4102eb]=_0x499997,await logAutomationAction(_0x286ff4,'[MPC]\x20'+_0x4102eb+_0x193044(0x1ee)+_0x495ae1+'¬∞C')));}}else _0x286ff4[_0x193044(0x264)][_0x193044(0x1d5)](_0x193044(0x1e7)+_0x4102eb+_0x193044(0x1c5));}}module[a1_0x197df7(0x266)]={'handlePrediction':handlePrediction,'applyEnergySavings':applyEnergySavings,'scanThermostats':scanThermostats,'checkCalendarTriggers':checkCalendarTriggers,'updateSchedulePreview':updateSchedulePreview,'cleanupGhostInterventions':cleanupGhostInterventions};