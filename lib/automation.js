function a1_0x3571(){const _0xfa96ae=['analysis.energy.warmupTimes','toString','SET','message','33AyafOm','analysis.energy.warmupSources','from','actual','wert','remove','13660236trQwQm','type','triggerTime','target_temperature','_calName','\x20min).','join','location','parse','local_temperature','.1.SET_POINT_TEMPERATURE','devices','setStateAsync','\x20auf\x20','warn','\x20ist\x20zu\x20kalt,\x20ABER\x20Fenster\x20offen/L√ºftung\x20erkannt.\x20Heize\x20NICHT,\x20entferne\x20nur\x20Status.','length','occupied_heating_setpoint','apply','4719252LMwBln','analysis.automation.actionLog','\x27\x20aktiv.\x20Heize\x20auf\x20','val','getForeignObjectAsync','level','consultButler','üö®\x20[MPC\x20WATCHDOG]\x20','\x20wieder\x20auf\x20','¬∞C\x20(Vorlauf:\x20','3069190MgQlEm','currentSystemMode','open','common','off','Soll','üå¨Ô∏è\x20[MPC\x20WATCHDOG]\x20',':\x20Puffer\x20leer\x20->\x20Heizen\x20auf\x20','\x20->\x20','level.temperature','_date','rescue_','25548QJCkVG',']:\x20Raum-Trigger\x20\x27','normal','eventStart','contact','TRAIN_RL_PENALTY','[WATCHDOG]\x20','üî•\x20[MPC\x20ACTION]\x20Heize\x20','\x20wurde\x20manuell\x20erh√∂ht.','valveMapping','urlaub\x20ende','analysis.energy.mpcActiveInterventions','\x20erreicht\x20Limit\x20(','¬∞C).\x20Entferne\x20Status.','.4.VALVE_STATE','ist','useCalendar','thermostat.setpoint','thermostatMapping','string','r√ºckkehr','PERFECT','Fehlt','state','analysis.energy.ventilationAlerts','indexOf','getTime','info','sort','\x20ist\x20auf\x20','filter','\x27\x20hat\x20kein\x20Ger√§t\x20mehr.\x20L√∂sche\x20Eintrag.','system.mode','sendToPythonWrapper','getForeignStateAsync','\x20gefunden!','thermostat','unit','slice','\x20durch\x20Kalender\x20ge√§ndert.\x20Keine\x20RL-Strafe.','üçÉ\x20[MPC\x20ACTION]\x20Senke\x20','calendarSelection','approved','calendarInstance','stringify','Manuelles\x20Mapping','(((.+)+)+)+$','1983651SxjPBi','map','6072DuuSyk','toUpperCase','toLowerCase','./ai_agent','hm-rpc','find','ankunft','Classic','Pr√§diktion:\x20','üìÖ\x20SMART\x20SCHEDULE\x20(Phase):\x20\x27Globaler\x20Start\x27\x20erkannt.\x20Heize\x20Haus\x20auf\x20(Vorlauf:\x20','add','sensor','getStateAsync','name','2030896SuGKyY','stellwert','üìÖ\x20SMART\x20SCHEDULE\x20[','üìÖ\x20[MPC\x20INFO]\x20','localeCompare','¬∞C\x20(nicht\x20','Auto-Erkennung','5IaZgpz','constructor','setpoint','push','trim','[CAL]\x20','current_heating_setpoint','pi_heating_demand','config','summary','event','analysis.automation.mode','[MPC]\x20','Calendar\x20Check\x20Error:\x20','setForeignStateAsync','getForeignObjectsAsync','forEach','default','messwert','.1.TEMPERATURE','¬∞C\x20<\x20','üéì\x20[RL-FEEDBACK]\x20Lerne\x20aus\x20Fehler:\x20','Ist','üßπ\x20[MPC\x20CLEANUP]\x20','.data.table','analysis.automation.confidenceThreshold','write','analysis.energy.warmupTargets','too_cold','now','includes','.1.ACTUAL_TEMPERATURE','1917GqlmWs','reason','position','valve','values','score','Unknown','36aOjfaa','target','120rIcCYD','cal_','unshift','room','¬∞C!\x20(Puffer\x20leer).','date','window','temperature','39MzotXG','mpc_','¬∞C!\x20(Puffer:\x20','light','splice','\x20min)','.4.SET_TEMPERATURE','isArray','number','exports','üßπ\x20[MPC\x20CLEANUP]\x20Raum\x20\x27','replace','Unbekannt','split','log','analysis.energy.schedulePreview','ACTUAL_TEMPERATURE','manual','.1.LEVEL','search','[MPC\x20WARNING]\x20Kein\x20Setpoint\x20f√ºr\x20','analysis.automation.lastAction'];a1_0x3571=function(){return _0xfa96ae;};return a1_0x3571();}const a1_0x415903=a1_0x1ea1;(function(_0x3c7cf7,_0x5691e7){const _0x40c501=a1_0x1ea1,_0x48de45=_0x3c7cf7();while(!![]){try{const _0x52af68=-parseInt(_0x40c501(0x8b))/0x1*(parseInt(_0x40c501(0xdc))/0x2)+parseInt(_0x40c501(0x10b))/0x3+parseInt(_0x40c501(0xc6))/0x4*(parseInt(_0x40c501(0x122))/0x5)+-parseInt(_0x40c501(0x89))/0x6*(parseInt(_0x40c501(0x11b))/0x7)+-parseInt(_0x40c501(0x10d))/0x8*(parseInt(_0x40c501(0x82))/0x9)+-parseInt(_0x40c501(0xd0))/0xa*(parseInt(_0x40c501(0xad))/0xb)+-parseInt(_0x40c501(0xb3))/0xc*(-parseInt(_0x40c501(0x93))/0xd);if(_0x52af68===_0x5691e7)break;else _0x48de45['push'](_0x48de45['shift']());}catch(_0x5b6279){_0x48de45['push'](_0x48de45['shift']());}}}(a1_0x3571,0xdbbb1));const a1_0x50ad4e=(function(){let _0x497fe6=!![];return function(_0x79ce3e,_0x12878d){const _0x95a822=_0x497fe6?function(){const _0x379569=a1_0x1ea1;if(_0x12878d){const _0x4d30d0=_0x12878d[_0x379569(0xc5)](_0x79ce3e,arguments);return _0x12878d=null,_0x4d30d0;}}:function(){};return _0x497fe6=![],_0x95a822;};}()),a1_0x5bba8a=a1_0x50ad4e(this,function(){const _0x574bb2=a1_0x1ea1;return a1_0x5bba8a[_0x574bb2(0xaa)]()[_0x574bb2(0xa6)](_0x574bb2(0x10a))['toString']()[_0x574bb2(0x123)](a1_0x5bba8a)[_0x574bb2(0xa6)](_0x574bb2(0x10a));});a1_0x5bba8a();function a1_0x1ea1(_0x357a63,_0x51639b){const _0x3949b0=a1_0x3571();return a1_0x1ea1=function(_0x5bba8a,_0x50ad4e){_0x5bba8a=_0x5bba8a-0x72;let _0x3571ea=_0x3949b0[_0x5bba8a];return _0x3571ea;},a1_0x1ea1(_0x357a63,_0x51639b);}'use strict';const aiAgent=require(a1_0x415903(0x110)),COOLDOWN_MS=0x3c*0x3e8,CAL_COOLDOWN_MS=0x5a*0x3c*0x3e8,RESCUE_LOCK_MS=0x78*0x3c*0x3e8,ECO_TEMP=0x11,lastActions={};function normalize(_0x587460){const _0x1460c5=a1_0x415903;if(!_0x587460)return'';return _0x587460[_0x1460c5(0x10f)]()[_0x1460c5(0x9e)](/\s+/g,'')[_0x1460c5(0x126)]();}async function logAutomationAction(_0x3d0677,_0x909bb8){const _0x15da48=a1_0x415903;await _0x3d0677[_0x15da48(0xbf)](_0x15da48(0xa8),{'val':_0x909bb8,'ack':!![]});try{const _0x26ccca=_0x15da48(0xc7),_0x2e9c02=await _0x3d0677[_0x15da48(0x119)](_0x26ccca);let _0x3f7d90=[];if(_0x2e9c02&&_0x2e9c02['val'])try{_0x3f7d90=JSON[_0x15da48(0xbb)](_0x2e9c02[_0x15da48(0xc9)]);}catch(_0x4c2556){}_0x3f7d90[_0x15da48(0x8d)]({'ts':Date[_0x15da48(0x7f)](),'msg':_0x909bb8});if(_0x3f7d90[_0x15da48(0xc3)]>0x32)_0x3f7d90=_0x3f7d90[_0x15da48(0x102)](0x0,0x32);await _0x3d0677[_0x15da48(0xbf)](_0x26ccca,{'val':JSON['stringify'](_0x3f7d90),'ack':!![]});}catch(_0x4bbff5){}}async function handlePrediction(_0x36418d,_0x4f07a7,_0x8bad06){const _0x2e9dd4=a1_0x415903;if(!_0x4f07a7||_0x4f07a7===_0x2e9dd4(0x88))return;let _0x4bae53='off',_0x1ec96f=0.6;try{const _0x1d4e1d=await _0x36418d[_0x2e9dd4(0x119)](_0x2e9dd4(0x12d));if(_0x1d4e1d&&_0x1d4e1d[_0x2e9dd4(0xc9)])_0x4bae53=_0x1d4e1d['val'];const _0x18dd66=await _0x36418d[_0x2e9dd4(0x119)](_0x2e9dd4(0x7b));if(_0x18dd66&&_0x18dd66[_0x2e9dd4(0xc9)])_0x1ec96f=_0x18dd66['val'];}catch(_0x31db69){}if(_0x4bae53===_0x2e9dd4(0xd4)||_0x8bad06<_0x1ec96f)return;const _0x147bf2=Date[_0x2e9dd4(0x7f)]();if(lastActions[_0x4f07a7]&&_0x147bf2-lastActions[_0x4f07a7]<COOLDOWN_MS)return;const _0x40c264=_0x36418d[_0x2e9dd4(0x12a)]['devices']||[],_0x369ef9=normalize(_0x4f07a7),_0x4fb744=_0x40c264[_0x2e9dd4(0x112)](_0x28a922=>normalize(_0x28a922[_0x2e9dd4(0xba)])===_0x369ef9&&(_0x28a922[_0x2e9dd4(0xb4)]===_0x2e9dd4(0x96)||_0x28a922[_0x2e9dd4(0xb4)]==='dimmer'||_0x28a922['type']==='switch'));if(!_0x4fb744)return;const _0x2086df=await aiAgent[_0x2e9dd4(0xcc)](_0x36418d,_0x4f07a7,_0x4fb744[_0x2e9dd4(0x11a)],_0x8bad06);if(!_0x2086df[_0x2e9dd4(0x106)])return;const _0x1da243=_0x2e9dd4(0x115)+_0x4f07a7+'\x20->\x20Schalte\x20'+_0x4fb744['name']+'\x20('+_0x2086df[_0x2e9dd4(0x83)]+')';await logAutomationAction(_0x36418d,'['+_0x4bae53[_0x2e9dd4(0x10e)]()+']\x20'+_0x1da243);if(_0x4bae53==='active'){const _0x1283d8=await _0x36418d['getForeignStateAsync'](_0x4fb744['id']);(!_0x1283d8||!_0x1283d8[_0x2e9dd4(0xc9)]&&_0x1283d8[_0x2e9dd4(0xc9)]!==!![])&&await _0x36418d[_0x2e9dd4(0x130)](_0x4fb744['id'],!![]),lastActions[_0x4f07a7]=_0x147bf2;}}async function findRelatedId(_0x5c3daa,_0x31670b,_0x1fbc60='setpoint'){const _0x965eac=a1_0x415903;if(_0x1fbc60===_0x965eac(0x124)&&_0x5c3daa[_0x965eac(0x12a)][_0x965eac(0xee)]){let _0x3fa488=_0x5c3daa['config'][_0x965eac(0xee)];if(typeof _0x3fa488===_0x965eac(0xef))try{_0x3fa488=JSON[_0x965eac(0xbb)](_0x3fa488);}catch(_0x923ca2){}if(_0x3fa488&&_0x3fa488[_0x31670b])return _0x3fa488[_0x31670b];}if(_0x1fbc60===_0x965eac(0x85)&&_0x5c3daa[_0x965eac(0x12a)][_0x965eac(0xe5)]){let _0x66d66e=_0x5c3daa[_0x965eac(0x12a)][_0x965eac(0xe5)];if(typeof _0x66d66e==='string')try{_0x66d66e=JSON[_0x965eac(0xbb)](_0x66d66e);}catch(_0x20c8eb){}if(_0x66d66e&&_0x66d66e[_0x31670b])return _0x66d66e[_0x31670b];}let _0x51487d=[];if(_0x1fbc60===_0x965eac(0x124))_0x51487d=[{'s':_0x965eac(0x81),'t':_0x965eac(0xbd)},{'s':_0x965eac(0x75),'t':'.1.SET_POINT_TEMPERATURE'},{'s':_0x965eac(0x75),'t':_0x965eac(0x99)},{'s':_0x965eac(0xa3),'t':'SET_POINT_TEMPERATURE'},{'s':_0x965eac(0xbc),'t':_0x965eac(0xc4)},{'s':_0x965eac(0xbc),'t':_0x965eac(0x128)},{'s':_0x965eac(0x92),'t':_0x965eac(0xb6)},{'s':'ACTUAL','t':_0x965eac(0xab)},{'s':_0x965eac(0x78),'t':_0x965eac(0xd5)},{'s':_0x965eac(0x92),'t':'setpoint'}];else _0x1fbc60===_0x965eac(0x85)&&(_0x51487d=[{'s':_0x965eac(0x81),'t':_0x965eac(0xa5)},{'s':_0x965eac(0x75),'t':_0x965eac(0xa5)},{'s':_0x965eac(0x75),'t':_0x965eac(0xea)},{'s':_0x965eac(0xbc),'t':_0x965eac(0x129)},{'s':_0x965eac(0x92),'t':'valve_position'},{'s':_0x965eac(0x92),'t':'level'}]);for(const _0xa965d5 of _0x51487d){if(_0x31670b['includes'](_0xa965d5['s'])){const _0x56d92a=_0x31670b['replace'](_0xa965d5['s'],_0xa965d5['t']),_0x5e83f6=await _0x5c3daa[_0x965eac(0xca)](_0x56d92a);if(_0x5e83f6)return _0x56d92a;}}try{const _0x3f88a3=_0x31670b[_0x965eac(0xa0)]('.');if(_0x3f88a3[_0x965eac(0xc3)]>0x2){const _0x1bdf6e=_0x3f88a3['slice'](0x0,-0x1)[_0x965eac(0xb9)]('.'),_0x27ecba=await _0x5c3daa[_0x965eac(0x131)](_0x1bdf6e+'.*'),_0x1fd28a=[],_0xfc69a=_0x31670b[_0x965eac(0xa0)](/[._]+/)[_0x965eac(0xfa)](_0x4e2955=>!['openknx','0',_0x965eac(0x111),_0x965eac(0xeb),_0x965eac(0xb1),_0x965eac(0x92),_0x965eac(0xb0),'sensor',_0x965eac(0x74),_0x965eac(0xf3)][_0x965eac(0x80)](_0x4e2955['toLowerCase']()));for(const [_0x28b4cb,_0x352b2f]of Object['entries'](_0x27ecba)){if(_0x28b4cb===_0x31670b)continue;if(_0x352b2f&&_0x352b2f['common']){const _0x43a378=_0x28b4cb[_0x965eac(0x10f)](),_0x2285d9=(_0x352b2f[_0x965eac(0xd3)]['role']||'')[_0x965eac(0x10f)](),_0xc9c520=(_0x352b2f[_0x965eac(0xd3)][_0x965eac(0x101)]||'')[_0x965eac(0x10f)]();let _0x1f3198=![];if(_0x1fbc60===_0x965eac(0x124)&&_0x352b2f['common'][_0x965eac(0x7c)]===!![])_0x1f3198=_0x43a378[_0x965eac(0x80)]('set')||_0x43a378[_0x965eac(0x80)]('soll')||_0x43a378[_0x965eac(0x80)](_0x965eac(0x8a))||_0x2285d9[_0x965eac(0x80)](_0x965eac(0xd9))||_0x2285d9[_0x965eac(0x80)](_0x965eac(0xed));else _0x1fbc60===_0x965eac(0x85)&&(_0x1f3198=_0x43a378['includes'](_0x965eac(0xcb))||_0x43a378[_0x965eac(0x80)](_0x965eac(0x85))||_0x43a378['includes'](_0x965eac(0x11c))||_0x43a378['includes'](_0x965eac(0x84))||_0x2285d9[_0x965eac(0x80)]('level.valve')||_0x2285d9['includes']('value.valve')||_0xc9c520[_0x965eac(0x80)]('%'));if(_0x1f3198){const _0x238cee=_0x28b4cb[_0x965eac(0xa0)](/[._]+/)[_0x965eac(0x10c)](_0x543869=>_0x543869[_0x965eac(0x10f)]());let _0x121afa=0x0;_0xfc69a[_0x965eac(0x72)](_0x5b44bb=>{const _0x39111d=_0x965eac;if(_0x238cee[_0x39111d(0x80)](_0x5b44bb[_0x39111d(0x10f)]()))_0x121afa++;}),_0x1fd28a[_0x965eac(0x125)]({'id':_0x28b4cb,'score':_0x121afa});}}}if(_0x1fd28a['length']>0x0){_0x1fd28a[_0x965eac(0xf8)]((_0x4dfa25,_0x3c9a77)=>_0x3c9a77['score']-_0x4dfa25[_0x965eac(0x87)]);if(_0x1fd28a[0x0][_0x965eac(0x87)]>0x0)return _0x1fd28a[0x0]['id'];}}}catch(_0x4e708c){}return null;}async function scanThermostats(_0x543d1d){const _0x51800f=a1_0x415903,_0x272b08=_0x543d1d[_0x51800f(0x12a)][_0x51800f(0xbe)]||[],_0x1079e4=[],_0x51e9bb=_0x272b08['filter'](_0x54abd4=>_0x54abd4['id']&&_0x54abd4['id'][_0x51800f(0x80)](_0x51800f(0x92))||_0x54abd4['type']&&['temperature','thermostat',_0x51800f(0x118)][_0x51800f(0x80)](_0x54abd4[_0x51800f(0xb4)])||_0x54abd4[_0x51800f(0x11a)]&&_0x54abd4[_0x51800f(0x11a)][_0x51800f(0x10f)]()['includes']('temp'));for(const _0x72fa1d of _0x51e9bb){const _0x420580=await findRelatedId(_0x543d1d,_0x72fa1d['id'],_0x51800f(0x124)),_0x59480a=await findRelatedId(_0x543d1d,_0x72fa1d['id'],_0x51800f(0x85));let _0x2ae383='Nicht\x20gefunden',_0x953e36=![],_0xa8b23e=_0x543d1d['config'][_0x51800f(0xee)]||{};if(typeof _0xa8b23e===_0x51800f(0xef))try{_0xa8b23e=JSON[_0x51800f(0xbb)](_0xa8b23e);}catch(_0x955ea6){}let _0x5aac9c=_0x543d1d[_0x51800f(0x12a)][_0x51800f(0xe5)]||{};if(typeof _0x5aac9c==='string')try{_0x5aac9c=JSON[_0x51800f(0xbb)](_0x5aac9c);}catch(_0x50efa0){}if(_0xa8b23e[_0x72fa1d['id']]&&_0xa8b23e[_0x72fa1d['id']]===_0x420580||_0x5aac9c[_0x72fa1d['id']]&&_0x5aac9c[_0x72fa1d['id']]===_0x59480a)_0x2ae383=_0x51800f(0x109),_0x953e36=!![];else(_0x420580||_0x59480a)&&(_0x2ae383=_0x51800f(0x121));_0x1079e4['push']({'room':_0x72fa1d['location']||_0x51800f(0x9f),'sensorId':_0x72fa1d['id'],'setpointId':_0x420580||'-','valveId':_0x59480a||'-','source':_0x2ae383,'isManual':_0x953e36,'status':_0x420580&&_0x59480a?_0x51800f(0xf1):_0x420580?'OK':_0x51800f(0xf2)});}return _0x1079e4[_0x51800f(0xf8)]((_0x202e7d,_0x3fee45)=>_0x202e7d[_0x51800f(0x8e)][_0x51800f(0x11f)](_0x3fee45['room']));}async function updateSchedulePreview(_0xe07ca4){const _0x3e9535=a1_0x415903;if(!_0xe07ca4['config'][_0x3e9535(0xec)]||!_0xe07ca4[_0x3e9535(0x12a)][_0x3e9535(0x107)])return;let _0x25d348={};try{const _0x56a818=await _0xe07ca4[_0x3e9535(0x119)](_0x3e9535(0xa9));if(_0x56a818&&_0x56a818[_0x3e9535(0xc9)])_0x25d348=JSON[_0x3e9535(0xbb)](_0x56a818[_0x3e9535(0xc9)]);}catch(_0x2da15a){}const _0x1b9f01=[],_0x49b287=Date[_0x3e9535(0x7f)](),_0x45b1e7=0x30*0x3c*0x3c*0x3e8;try{const _0x402fc4=await _0xe07ca4[_0x3e9535(0xfe)](_0xe07ca4[_0x3e9535(0x12a)][_0x3e9535(0x107)]+'.data.table');if(!_0x402fc4||!_0x402fc4['val'])return;const _0x186755=JSON[_0x3e9535(0xbb)](_0x402fc4[_0x3e9535(0xc9)]),_0x58d6c0=_0xe07ca4[_0x3e9535(0x12a)][_0x3e9535(0x105)]||[],_0x12aaef=_0xe07ca4[_0x3e9535(0x12a)]['devices']||[],_0x37705d=new Set();_0x12aaef[_0x3e9535(0x72)](_0x3032ad=>{const _0x38edcd=_0x3e9535;if(_0x3032ad[_0x38edcd(0xba)])_0x37705d[_0x38edcd(0x117)](_0x3032ad[_0x38edcd(0xba)]);});for(const _0x356e1e of _0x186755){if(_0x356e1e[_0x3e9535(0xb7)]&&_0x58d6c0[_0x3e9535(0xc3)]>0x0&&!_0x58d6c0[_0x3e9535(0x80)](_0x356e1e[_0x3e9535(0xb7)]))continue;const _0x44e151=_0x356e1e[_0x3e9535(0xda)]||_0x356e1e[_0x3e9535(0xdf)]||_0x356e1e[_0x3e9535(0x90)];if(!_0x44e151)continue;const _0x34ad3b=new Date(_0x44e151),_0x414be5=_0x34ad3b[_0x3e9535(0xf6)]();if(isNaN(_0x414be5))continue;if(_0x414be5<_0x49b287)continue;if(_0x414be5>_0x49b287+_0x45b1e7)continue;const _0x54acff=(_0x356e1e[_0x3e9535(0x12c)]||_0x356e1e[_0x3e9535(0x12b)]||'')[_0x3e9535(0x10f)]();let _0x4bf1cb=![],_0x3b9b77=[],_0x1902cd=_0x356e1e[_0x3e9535(0x12c)]||_0x356e1e[_0x3e9535(0x12b)]||_0x3e9535(0x9f);if(_0x54acff[_0x3e9535(0x80)]('urlaub\x20ende')||_0x54acff[_0x3e9535(0x80)]('r√ºckkehr')||_0x54acff[_0x3e9535(0x80)](_0x3e9535(0x113)))_0x4bf1cb=!![],_0x3b9b77=Array[_0x3e9535(0xaf)](_0x37705d);else for(const _0xf849d9 of _0x37705d){if(_0x54acff[_0x3e9535(0x80)](_0xf849d9['toLowerCase']()))_0x3b9b77['push'](_0xf849d9);}_0x3b9b77[_0x3e9535(0xc3)]>0x0&&_0x3b9b77[_0x3e9535(0x72)](_0x5add36=>{const _0x523620=_0x3e9535;let _0x1cddc9=0x3c;if(_0x4bf1cb){let _0x494c25=0x0;Object[_0x523620(0x86)](_0x25d348)[_0x523620(0x72)](_0x4c1951=>{if(_0x4c1951>_0x494c25)_0x494c25=_0x4c1951;}),_0x1cddc9=_0x494c25>0x0?_0x494c25:0x78;}else _0x1cddc9=_0x25d348[_0x5add36]||0x3c;const _0x3d1972=new Date(_0x414be5-_0x1cddc9*0xea60);_0x1b9f01[_0x523620(0x125)]({'eventTime':_0x414be5,'triggerTime':_0x3d1972[_0x523620(0xf6)](),'room':_0x5add36,'minutes':_0x1cddc9,'reason':_0x1902cd,'isGlobal':_0x4bf1cb});});}}catch(_0x5cc7e4){}_0x1b9f01[_0x3e9535(0xf8)]((_0x9d0b68,_0x328f79)=>_0x9d0b68[_0x3e9535(0xb5)]-_0x328f79[_0x3e9535(0xb5)]);const _0x39a148=_0x1b9f01[_0x3e9535(0x102)](0x0,0x5);await _0xe07ca4[_0x3e9535(0xbf)](_0x3e9535(0xa2),{'val':JSON[_0x3e9535(0x108)](_0x39a148),'ack':!![]});}async function checkCalendarTriggers(_0x29c685){const _0x227af8=a1_0x415903;if(!_0x29c685[_0x227af8(0x12a)]['useCalendar']||!_0x29c685[_0x227af8(0x12a)][_0x227af8(0x107)])return;await updateSchedulePreview(_0x29c685);let _0x454bb9={},_0x141b05={};try{const _0x41e3b1=await _0x29c685[_0x227af8(0x119)]('analysis.energy.warmupTimes');if(_0x41e3b1&&_0x41e3b1[_0x227af8(0xc9)])_0x454bb9=JSON[_0x227af8(0xbb)](_0x41e3b1[_0x227af8(0xc9)]);const _0x50e392=await _0x29c685[_0x227af8(0x119)](_0x227af8(0xae));if(_0x50e392&&_0x50e392['val'])_0x141b05=JSON[_0x227af8(0xbb)](_0x50e392[_0x227af8(0xc9)]);}catch(_0x529540){}let _0x1b5ac2={'default':0x15};try{const _0x55612d=await _0x29c685[_0x227af8(0x119)](_0x227af8(0x7d));if(_0x55612d&&_0x55612d[_0x227af8(0xc9)])_0x1b5ac2=JSON[_0x227af8(0xbb)](_0x55612d[_0x227af8(0xc9)]);}catch(_0x12fe8e){}try{const _0xde626e=await _0x29c685['getForeignStateAsync'](_0x29c685[_0x227af8(0x12a)][_0x227af8(0x107)]+_0x227af8(0x7a));if(!_0xde626e||!_0xde626e[_0x227af8(0xc9)])return;const _0x5b006c=JSON['parse'](_0xde626e['val']),_0x3792ec=Date[_0x227af8(0x7f)](),_0x4027bd=_0x29c685[_0x227af8(0x12a)][_0x227af8(0xbe)]||[],_0x424beb=_0x29c685[_0x227af8(0x12a)][_0x227af8(0x105)]||[];for(const _0xed1b15 of _0x5b006c){if(_0xed1b15[_0x227af8(0xb7)]&&_0x424beb[_0x227af8(0xc3)]>0x0&&!_0x424beb[_0x227af8(0x80)](_0xed1b15[_0x227af8(0xb7)]))continue;const _0x4bd4b5=_0xed1b15[_0x227af8(0xda)]||_0xed1b15[_0x227af8(0xdf)]||_0xed1b15[_0x227af8(0x90)];if(!_0x4bd4b5)continue;const _0x4d2646=new Date(_0x4bd4b5);if(isNaN(_0x4d2646[_0x227af8(0xf6)]()))continue;const _0x38bd44=(_0xed1b15[_0x227af8(0x12c)]||_0xed1b15[_0x227af8(0x12b)]||'')['toLowerCase']();if(_0x38bd44[_0x227af8(0x80)](_0x227af8(0xe6))||_0x38bd44[_0x227af8(0x80)](_0x227af8(0xf0))||_0x38bd44[_0x227af8(0x80)](_0x227af8(0x113))){let _0x184aa6=0x0;Object[_0x227af8(0x86)](_0x454bb9)[_0x227af8(0x72)](_0x1f4f51=>{if(_0x1f4f51>_0x184aa6)_0x184aa6=_0x1f4f51;});if(_0x184aa6===0x0)_0x184aa6=0x78;const _0x352e49=_0x4d2646[_0x227af8(0xf6)]()-_0x184aa6*0xea60;_0x3792ec>=_0x352e49&&_0x3792ec<_0x4d2646[_0x227af8(0xf6)]()&&(_0x29c685[_0x227af8(0xd1)]!==_0x227af8(0xde)&&(_0x29c685[_0x227af8(0xa1)][_0x227af8(0xf7)](_0x227af8(0x116)+_0x184aa6+_0x227af8(0xb8)),await _0x29c685[_0x227af8(0xbf)](_0x227af8(0xfc),{'val':_0x227af8(0xde),'ack':![]})));}for(const _0x4875bb of _0x4027bd){if(_0x4875bb[_0x227af8(0xba)]){const _0xd734b4=_0x4875bb[_0x227af8(0xba)][_0x227af8(0x10f)]();if(_0x38bd44[_0x227af8(0x80)](_0xd734b4)){const _0x4ed5b7=_0x454bb9[_0x4875bb[_0x227af8(0xba)]]||0x3c,_0x2ca649=_0x141b05[_0x4875bb[_0x227af8(0xba)]]||_0x227af8(0x114),_0x2c5b85=_0x4d2646[_0x227af8(0xf6)]()-_0x4ed5b7*0xea60;if(_0x3792ec>=_0x2c5b85&&_0x3792ec<_0x4d2646[_0x227af8(0xf6)]()){const _0x2646bb=lastActions[_0x227af8(0x8c)+_0x4875bb['location']];if(_0x2646bb&&_0x3792ec-_0x2646bb<CAL_COOLDOWN_MS)continue;const _0x40d7b7=await findRelatedId(_0x29c685,_0x4875bb['id'],_0x227af8(0x124));if(_0x40d7b7){let _0x5a447b=_0x1b5ac2[_0x4875bb[_0x227af8(0xba)]];if(_0x5a447b===undefined)_0x5a447b=_0x1b5ac2[_0x227af8(0x73)];if(_0x5a447b===undefined)_0x5a447b=0x15;const _0xb20814=await _0x29c685[_0x227af8(0xfe)](_0x40d7b7);_0xb20814&&typeof _0xb20814['val']===_0x227af8(0x9b)&&_0xb20814[_0x227af8(0xc9)]<_0x5a447b-0.5&&(_0x29c685[_0x227af8(0xa1)][_0x227af8(0xf7)](_0x227af8(0x11d)+_0x2ca649+_0x227af8(0xdd)+_0x4875bb['location']+_0x227af8(0xc8)+_0x5a447b+_0x227af8(0xcf)+_0x4ed5b7+_0x227af8(0xb8)),await _0x29c685[_0x227af8(0x130)](_0x40d7b7,_0x5a447b),await logAutomationAction(_0x29c685,_0x227af8(0x127)+_0x4875bb[_0x227af8(0xba)]+_0x227af8(0xd8)+_0x5a447b+'¬∞C\x20(via\x20'+_0x2ca649+')'),lastActions[_0x227af8(0x8c)+_0x4875bb[_0x227af8(0xba)]]=_0x3792ec);}}}}}}}catch(_0x3eda5f){_0x29c685[_0x227af8(0xa1)]['warn'](_0x227af8(0x12f)+_0x3eda5f[_0x227af8(0xac)]);}}async function manageMpcIntervention(_0x539bad,_0x4ddafa,_0x4c4292){const _0x3fb31a=a1_0x415903;try{const _0xf8166=_0x3fb31a(0xe7),_0x17cd40=await _0x539bad[_0x3fb31a(0x119)](_0xf8166);let _0x2f1eb3=[];if(_0x17cd40&&_0x17cd40[_0x3fb31a(0xc9)])try{_0x2f1eb3=JSON[_0x3fb31a(0xbb)](_0x17cd40[_0x3fb31a(0xc9)]);}catch(_0x23cffd){}const _0xf8c282=_0x2f1eb3[_0x3fb31a(0xf5)](_0x4ddafa);if(_0x4c4292===_0x3fb31a(0x117))_0xf8c282===-0x1&&(_0x2f1eb3[_0x3fb31a(0x125)](_0x4ddafa),await _0x539bad[_0x3fb31a(0xbf)](_0xf8166,{'val':JSON[_0x3fb31a(0x108)](_0x2f1eb3),'ack':!![]}));else _0x4c4292==='remove'&&(_0xf8c282!==-0x1&&(_0x2f1eb3[_0x3fb31a(0x97)](_0xf8c282,0x1),await _0x539bad[_0x3fb31a(0xbf)](_0xf8166,{'val':JSON[_0x3fb31a(0x108)](_0x2f1eb3),'ack':!![]})));}catch(_0x36485e){}}async function cleanupGhostInterventions(_0x4b7dcd){const _0x21836f=a1_0x415903;try{const _0x44528b='analysis.energy.mpcActiveInterventions',_0x2332af=await _0x4b7dcd[_0x21836f(0x119)](_0x44528b);if(!_0x2332af||!_0x2332af[_0x21836f(0xc9)])return;const _0x2ee7f2=JSON[_0x21836f(0xbb)](_0x2332af[_0x21836f(0xc9)]);if(!Array[_0x21836f(0x9a)](_0x2ee7f2)||_0x2ee7f2[_0x21836f(0xc3)]===0x0)return;let _0x28cd66={'default':0x15};try{const _0x59fe7c=await _0x4b7dcd[_0x21836f(0x119)](_0x21836f(0x7d));if(_0x59fe7c&&_0x59fe7c[_0x21836f(0xc9)])_0x28cd66=JSON[_0x21836f(0xbb)](_0x59fe7c[_0x21836f(0xc9)]);}catch(_0x1ba685){}let _0x48eccf=[];try{const _0x5af7b3=await _0x4b7dcd[_0x21836f(0x119)](_0x21836f(0xf4));if(_0x5af7b3&&_0x5af7b3[_0x21836f(0xc9)])_0x48eccf=JSON[_0x21836f(0xbb)](_0x5af7b3[_0x21836f(0xc9)]);}catch(_0x1efccc){}const _0x108695=_0x4b7dcd['config']['devices']||[];let _0x1835fa=![];for(let _0x220f9e=_0x2ee7f2[_0x21836f(0xc3)]-0x1;_0x220f9e>=0x0;_0x220f9e--){const _0x124548=_0x2ee7f2[_0x220f9e],_0x52cee1=_0x108695['find'](_0x15b106=>normalize(_0x15b106[_0x21836f(0xba)])===normalize(_0x124548)&&(_0x15b106[_0x21836f(0xb4)]===_0x21836f(0x92)||_0x15b106[_0x21836f(0xb4)]===_0x21836f(0x100)));if(!_0x52cee1){_0x4b7dcd[_0x21836f(0xa1)][_0x21836f(0xc1)](_0x21836f(0x9d)+_0x124548+_0x21836f(0xfb)),_0x2ee7f2[_0x21836f(0x97)](_0x220f9e,0x1),_0x1835fa=!![];continue;}if(_0x52cee1){const _0x1b59c9=await findRelatedId(_0x4b7dcd,_0x52cee1['id'],_0x21836f(0x124)),_0x2f3511=await _0x4b7dcd[_0x21836f(0xfe)](_0x52cee1['id']);if(_0x1b59c9){const _0x2f6a38=await _0x4b7dcd[_0x21836f(0xfe)](_0x1b59c9);if(_0x2f6a38&&typeof _0x2f6a38[_0x21836f(0xc9)]===_0x21836f(0x9b)){let _0x576070=![],_0x50137e='';Math['abs'](_0x2f6a38[_0x21836f(0xc9)]-ECO_TEMP)>0.5&&(_0x576070=!![],_0x50137e='manual');if(!_0x576070&&_0x2f3511&&typeof _0x2f3511[_0x21836f(0xc9)]===_0x21836f(0x9b)){const _0x16324f=_0x28cd66[_0x124548]||_0x28cd66['default']||0x15;_0x2f3511[_0x21836f(0xc9)]<_0x16324f+0.2&&(_0x576070=!![],_0x50137e=_0x21836f(0x7e));}if(_0x576070){if(_0x50137e===_0x21836f(0xa4)){_0x4b7dcd['log']['info'](_0x21836f(0x79)+_0x124548+_0x21836f(0xf9)+_0x2f6a38[_0x21836f(0xc9)]+_0x21836f(0x120)+ECO_TEMP+_0x21836f(0xe9));const _0x34d7b6=lastActions[_0x21836f(0x8c)+_0x124548],_0x4793f0=_0x34d7b6&&Date[_0x21836f(0x7f)]()-_0x34d7b6<0x2*0x3c*0x3e8;if(!_0x4793f0&&_0x2f6a38[_0x21836f(0xc9)]>ECO_TEMP+0.5)_0x4b7dcd[_0x21836f(0xfd)]&&(_0x4b7dcd['log'][_0x21836f(0xf7)](_0x21836f(0x77)+_0x124548+_0x21836f(0xe4)),_0x4b7dcd[_0x21836f(0xfd)](_0x21836f(0xe1),{'room':_0x124548}));else _0x4793f0&&_0x4b7dcd[_0x21836f(0xa1)][_0x21836f(0xf7)](_0x21836f(0x11e)+_0x124548+_0x21836f(0x103));}else{if(_0x50137e===_0x21836f(0x7e)){let _0x433ec8=![];if(_0x48eccf[_0x21836f(0x112)](_0x3ce900=>_0x3ce900[_0x21836f(0x8e)]===_0x124548))_0x433ec8=!![];const _0x8d15dd=_0x108695[_0x21836f(0xfa)](_0x4b77f7=>normalize(_0x4b77f7[_0x21836f(0xba)])===normalize(_0x124548)&&(_0x4b77f7[_0x21836f(0xb4)]===_0x21836f(0x91)||_0x4b77f7['type']===_0x21836f(0x118)||_0x4b77f7[_0x21836f(0xb4)]===_0x21836f(0xe0)));for(const _0x149f46 of _0x8d15dd){try{const _0x17d397=await _0x4b7dcd['getForeignStateAsync'](_0x149f46['id']);if(_0x17d397&&(_0x17d397[_0x21836f(0xc9)]===!![]||_0x17d397[_0x21836f(0xc9)]===0x1||String(_0x17d397[_0x21836f(0xc9)])[_0x21836f(0x10f)]()===_0x21836f(0xd2)))_0x433ec8=!![];}catch(_0x3ebd1d){}}if(_0x433ec8)_0x4b7dcd[_0x21836f(0xa1)]['info'](_0x21836f(0xd6)+_0x124548+_0x21836f(0xc2));else{const _0x52df2a=_0x28cd66[_0x124548]||_0x28cd66['default']||0x15;_0x4b7dcd['log'][_0x21836f(0xf7)](_0x21836f(0xcd)+_0x124548+_0x21836f(0xe8)+_0x2f3511[_0x21836f(0xc9)]+_0x21836f(0x76)+(_0x52df2a+0.2)+'¬∞C).\x20Sparmodus\x20beendet!'),await _0x4b7dcd[_0x21836f(0x130)](_0x1b59c9,_0x52df2a),await logAutomationAction(_0x4b7dcd,_0x21836f(0xe2)+_0x124548+_0x21836f(0xd7)+_0x52df2a+'¬∞C'),lastActions[_0x21836f(0xdb)+_0x124548]=Date[_0x21836f(0x7f)]();}}}_0x2ee7f2[_0x21836f(0x97)](_0x220f9e,0x1),_0x1835fa=!![];}}}}}_0x1835fa&&await _0x4b7dcd['setStateAsync'](_0x44528b,{'val':JSON[_0x21836f(0x108)](_0x2ee7f2),'ack':!![]});}catch(_0x5b31b6){}}async function applyEnergySavings(_0x19fd0e,_0x9ecc62){const _0x1290c1=a1_0x415903;await cleanupGhostInterventions(_0x19fd0e);if(!_0x9ecc62||_0x9ecc62[_0x1290c1(0xc3)]===0x0)return;const _0x382e6c=_0x19fd0e[_0x1290c1(0x12a)][_0x1290c1(0xbe)]||[],_0x4570f8=Date['now']();for(const _0x59c554 of _0x9ecc62){const _0x5418c0=_0x59c554[_0x1290c1(0x8e)],_0x41bf6f=_0x59c554['minutes_safe'],_0x51ebb3=_0x59c554[_0x1290c1(0x8a)]||0x15;if(lastActions[_0x1290c1(0xdb)+_0x5418c0]&&_0x4570f8-lastActions['rescue_'+_0x5418c0]<RESCUE_LOCK_MS)continue;const _0x945647=_0x382e6c[_0x1290c1(0x112)](_0xb5c167=>normalize(_0xb5c167[_0x1290c1(0xba)])===normalize(_0x5418c0)&&(_0xb5c167[_0x1290c1(0xb4)]==='temperature'||_0xb5c167[_0x1290c1(0xb4)]===_0x1290c1(0x100)));if(!_0x945647)continue;const _0x5df1b8=await findRelatedId(_0x19fd0e,_0x945647['id'],'setpoint');if(_0x5df1b8){if(lastActions[_0x1290c1(0x94)+_0x5418c0]&&_0x4570f8-lastActions[_0x1290c1(0x94)+_0x5418c0]<0x1e*0x3c*0x3e8)continue;const _0x339a05=await _0x19fd0e[_0x1290c1(0xfe)](_0x5df1b8);if(_0x339a05&&typeof _0x339a05[_0x1290c1(0xc9)]===_0x1290c1(0x9b)){const _0x406a52=_0x339a05[_0x1290c1(0xc9)];_0x406a52!==ECO_TEMP&&await manageMpcIntervention(_0x19fd0e,_0x5418c0,_0x1290c1(0xb2));if(_0x41bf6f>0x1e)_0x406a52>ECO_TEMP+0.5&&(_0x19fd0e[_0x1290c1(0xa1)][_0x1290c1(0xf7)](_0x1290c1(0x104)+_0x5418c0+_0x1290c1(0xc0)+ECO_TEMP+_0x1290c1(0x95)+_0x41bf6f+_0x1290c1(0x98)),await _0x19fd0e[_0x1290c1(0x130)](_0x5df1b8,ECO_TEMP),await manageMpcIntervention(_0x19fd0e,_0x5418c0,_0x1290c1(0x117)),lastActions['mpc_'+_0x5418c0]=_0x4570f8,await logAutomationAction(_0x19fd0e,_0x1290c1(0x12e)+_0x5418c0+':\x20Absenkung\x20auf\x20'+ECO_TEMP+'¬∞C'));else _0x41bf6f<=0xf&&(_0x406a52<_0x51ebb3&&(_0x19fd0e['log'][_0x1290c1(0xf7)](_0x1290c1(0xe3)+_0x5418c0+_0x1290c1(0xce)+_0x51ebb3+_0x1290c1(0x8f)),await _0x19fd0e['setForeignStateAsync'](_0x5df1b8,_0x51ebb3),await manageMpcIntervention(_0x19fd0e,_0x5418c0,'remove'),lastActions['mpc_'+_0x5418c0]=_0x4570f8,await logAutomationAction(_0x19fd0e,'[MPC]\x20'+_0x5418c0+':\x20Aufheizen\x20auf\x20'+_0x51ebb3+'¬∞C')));}}else _0x19fd0e[_0x1290c1(0xa1)]['warn'](_0x1290c1(0xa7)+_0x5418c0+_0x1290c1(0xff));}}module[a1_0x415903(0x9c)]={'handlePrediction':handlePrediction,'applyEnergySavings':applyEnergySavings,'scanThermostats':scanThermostats,'checkCalendarTriggers':checkCalendarTriggers,'updateSchedulePreview':updateSchedulePreview,'cleanupGhostInterventions':cleanupGhostInterventions};