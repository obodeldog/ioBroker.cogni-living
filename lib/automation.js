const a1_0x1b8ff8=a1_0xb6c4;(function(_0x5c6996,_0x34368c){const _0xc3603e=a1_0xb6c4,_0x13c74b=_0x5c6996();while(!![]){try{const _0x31ea21=parseInt(_0xc3603e(0x151))/0x1+-parseInt(_0xc3603e(0x118))/0x2+-parseInt(_0xc3603e(0x1a5))/0x3+-parseInt(_0xc3603e(0x142))/0x4+-parseInt(_0xc3603e(0x121))/0x5*(parseInt(_0xc3603e(0x180))/0x6)+-parseInt(_0xc3603e(0x183))/0x7+parseInt(_0xc3603e(0x129))/0x8;if(_0x31ea21===_0x34368c)break;else _0x13c74b['push'](_0x13c74b['shift']());}catch(_0x584d35){_0x13c74b['push'](_0x13c74b['shift']());}}}(a1_0x58a4,0x9e4ed));const a1_0x3d210d=(function(){let _0x56e8e4=!![];return function(_0x92ac5,_0x2beb39){const _0x190404=_0x56e8e4?function(){if(_0x2beb39){const _0x8858a3=_0x2beb39['apply'](_0x92ac5,arguments);return _0x2beb39=null,_0x8858a3;}}:function(){};return _0x56e8e4=![],_0x190404;};}()),a1_0x2cbd73=a1_0x3d210d(this,function(){const _0x4ba012=a1_0xb6c4;return a1_0x2cbd73['toString']()[_0x4ba012(0x165)](_0x4ba012(0x1c2))['toString']()[_0x4ba012(0x16b)](a1_0x2cbd73)[_0x4ba012(0x165)](_0x4ba012(0x1c2));});function a1_0x58a4(){const _0x2faabf=['currentSystemMode','.1.LEVEL','[MPC]\x20','\x20min).','window','eventStart','analysis.energy.warmupTimes','analysis.energy.schedulePreview','üå¨Ô∏è\x20[MPC\x20WATCHDOG]\x20',']:\x20Raum-Trigger\x20\x27','analysis.automation.lastAction','¬∞C\x20<\x20','messwert','865856tNTpiX','manual','getTime','hm-rpc','thermostatMapping','_calName','TRAIN_RL_PENALTY','stringify','toLowerCase','setpoint','includes',':\x20Absenkung\x20auf\x20','devices','temp','from','getForeignObjectAsync',':\x20Aufheizen\x20auf\x20','Nicht\x20gefunden','reason','Pr√§diktion:\x20','search','\x27\x20aktiv.\x20Heize\x20auf\x20','\x27\x20hat\x20kein\x20Ger√§t\x20mehr.\x20L√∂sche\x20Eintrag.','map','analysis.energy.ventilationAlerts','location','constructor','splice','minutes_safe','Unbekannt','üö®\x20[MPC\x20WATCHDOG]\x20','sort','\x20->\x20','summary','temperature','SET_POINT_TEMPERATURE','Unknown','active','config','too_cold','.1.ACTUAL_TEMPERATURE','isArray','remove','open','mpc_','üî•\x20[MPC\x20ACTION]\x20Heize\x20','add','12NsxjRI','setForeignStateAsync','r√ºckkehr','2350908yyyexL','actual','level.temperature','\x20min)','¬∞C!\x20(Puffer\x20leer).','\x20wurde\x20manuell\x20erh√∂ht.','indexOf','position','analysis.energy.warmupTargets','push','string','\x20gefunden!','calendarInstance','off','valveMapping','val','normal','stellwert','valve_position','ankunft','üéì\x20[RL-FEEDBACK]\x20Lerne\x20aus\x20Fehler:\x20','¬∞C\x20(nicht\x20','local_temperature','\x20durch\x20Kalender\x20ge√§ndert.\x20Keine\x20RL-Strafe.','cal_','analysis.automation.mode','consultButler','getForeignStateAsync','unit','room','parse','score','analysis.energy.mpcActiveInterventions','¬∞C).\x20Entferne\x20Status.','999492eCAqyF','urlaub\x20ende','write','analysis.energy.warmupSources','analysis.automation.actionLog','\x20->\x20Schalte\x20','.1.TEMPERATURE','_date','join','replace','switch','\x20auf\x20','warn','occupied_heating_setpoint','¬∞C\x20(Vorlauf:\x20','forEach',':\x20Puffer\x20leer\x20->\x20Heizen\x20auf\x20','thermostat','exports','set','analysis.automation.confidenceThreshold','level.valve','values','üßπ\x20[MPC\x20CLEANUP]\x20','ist','triggerTime','target','¬∞C!\x20(Puffer:\x20','PERFECT','(((.+)+)+)+$','date','type','unshift','log','.data.table','rescue_','info','filter','getStateAsync','default','dimmer','openknx','now','current_heating_setpoint','19854nDPQke','toUpperCase','number','slice','localeCompare','\x20ist\x20auf\x20','sendToPythonWrapper','sensor','trim','3177110nOLCdU','common','event','üìÖ\x20SMART\x20SCHEDULE\x20(Phase):\x20\x27Globaler\x20Start\x27\x20erkannt.\x20Heize\x20Haus\x20auf\x20(Vorlauf:\x20','contact','setStateAsync','Auto-Erkennung','[MPC\x20WARNING]\x20Kein\x20Setpoint\x20f√ºr\x20','14691712PYmiSO','¬∞C\x20(via\x20','üìÖ\x20SMART\x20SCHEDULE\x20[','soll','.4.SET_TEMPERATURE','üìÖ\x20[MPC\x20INFO]\x20','useCalendar','thermostat.setpoint','length','level','split','Ist','üßπ\x20[MPC\x20CLEANUP]\x20Raum\x20\x27','pi_heating_demand','Soll','¬∞C).\x20Sparmodus\x20beendet!','wert','state','ACTUAL','[CAL]\x20','light','abs','find','valve','.1.SET_POINT_TEMPERATURE','416448uUkgXj','ACTUAL_TEMPERATURE'];a1_0x58a4=function(){return _0x2faabf;};return a1_0x58a4();}a1_0x2cbd73();'use strict';function a1_0xb6c4(_0x822e7d,_0x1d3203){const _0xea5228=a1_0x58a4();return a1_0xb6c4=function(_0x2cbd73,_0x3d210d){_0x2cbd73=_0x2cbd73-0x118;let _0x58a45a=_0xea5228[_0x2cbd73];return _0x58a45a;},a1_0xb6c4(_0x822e7d,_0x1d3203);}const aiAgent=require('./ai_agent'),COOLDOWN_MS=0x3c*0x3e8,CAL_COOLDOWN_MS=0x5a*0x3c*0x3e8,RESCUE_LOCK_MS=0x78*0x3c*0x3e8,ECO_TEMP=0x11,lastActions={};function normalize(_0x5eed98){const _0x54f21=a1_0xb6c4;if(!_0x5eed98)return'';return _0x5eed98[_0x54f21(0x159)]()[_0x54f21(0x1ae)](/\s+/g,'')[_0x54f21(0x120)]();}async function logAutomationAction(_0x288f6e,_0x47be3e){const _0x47f282=a1_0xb6c4;await _0x288f6e[_0x47f282(0x126)](_0x47f282(0x14e),{'val':_0x47be3e,'ack':!![]});try{const _0x41660c=_0x47f282(0x1a9),_0x1e502e=await _0x288f6e[_0x47f282(0x1cb)](_0x41660c);let _0xd2eb15=[];if(_0x1e502e&&_0x1e502e[_0x47f282(0x192)])try{_0xd2eb15=JSON[_0x47f282(0x1a1)](_0x1e502e[_0x47f282(0x192)]);}catch(_0x206ecc){}_0xd2eb15[_0x47f282(0x1c5)]({'ts':Date['now'](),'msg':_0x47be3e});if(_0xd2eb15[_0x47f282(0x131)]>0x32)_0xd2eb15=_0xd2eb15[_0x47f282(0x11b)](0x0,0x32);await _0x288f6e[_0x47f282(0x126)](_0x41660c,{'val':JSON['stringify'](_0xd2eb15),'ack':!![]});}catch(_0x25b1cd){}}async function handlePrediction(_0x41c959,_0x58741a,_0x1c25e9){const _0x14661f=a1_0xb6c4;if(!_0x58741a||_0x58741a===_0x14661f(0x175))return;let _0x5ed575='off',_0x21caba=0.6;try{const _0xcc081a=await _0x41c959[_0x14661f(0x1cb)](_0x14661f(0x19c));if(_0xcc081a&&_0xcc081a[_0x14661f(0x192)])_0x5ed575=_0xcc081a['val'];const _0x251cec=await _0x41c959[_0x14661f(0x1cb)](_0x14661f(0x1b9));if(_0x251cec&&_0x251cec[_0x14661f(0x192)])_0x21caba=_0x251cec[_0x14661f(0x192)];}catch(_0xbadbee){}if(_0x5ed575===_0x14661f(0x190)||_0x1c25e9<_0x21caba)return;const _0x1b768c=Date[_0x14661f(0x1cf)]();if(lastActions[_0x58741a]&&_0x1b768c-lastActions[_0x58741a]<COOLDOWN_MS)return;const _0x5269ed=_0x41c959['config'][_0x14661f(0x15d)]||[],_0x2e30ec=normalize(_0x58741a),_0x457f1b=_0x5269ed[_0x14661f(0x13f)](_0x26da01=>normalize(_0x26da01[_0x14661f(0x16a)])===_0x2e30ec&&(_0x26da01['type']===_0x14661f(0x13d)||_0x26da01[_0x14661f(0x1c4)]===_0x14661f(0x1cd)||_0x26da01[_0x14661f(0x1c4)]===_0x14661f(0x1af)));if(!_0x457f1b)return;const _0x33ccec=await aiAgent[_0x14661f(0x19d)](_0x41c959,_0x58741a,_0x457f1b['name'],_0x1c25e9);if(!_0x33ccec['approved'])return;const _0x13ae55=_0x14661f(0x164)+_0x58741a+_0x14661f(0x1aa)+_0x457f1b['name']+'\x20('+_0x33ccec[_0x14661f(0x163)]+')';await logAutomationAction(_0x41c959,'['+_0x5ed575[_0x14661f(0x119)]()+']\x20'+_0x13ae55);if(_0x5ed575===_0x14661f(0x176)){const _0x2fcfc5=await _0x41c959[_0x14661f(0x19e)](_0x457f1b['id']);(!_0x2fcfc5||!_0x2fcfc5[_0x14661f(0x192)]&&_0x2fcfc5['val']!==!![])&&await _0x41c959[_0x14661f(0x181)](_0x457f1b['id'],!![]),lastActions[_0x58741a]=_0x1b768c;}}async function findRelatedId(_0x2e86f6,_0xe7f5c6,_0x4e1bb0=a1_0x1b8ff8(0x15a)){const _0x4c0884=a1_0x1b8ff8;if(_0x4e1bb0===_0x4c0884(0x15a)&&_0x2e86f6[_0x4c0884(0x177)][_0x4c0884(0x155)]){let _0x171864=_0x2e86f6[_0x4c0884(0x177)][_0x4c0884(0x155)];if(typeof _0x171864===_0x4c0884(0x18d))try{_0x171864=JSON[_0x4c0884(0x1a1)](_0x171864);}catch(_0x4a1af3){}if(_0x171864&&_0x171864[_0xe7f5c6])return _0x171864[_0xe7f5c6];}if(_0x4e1bb0===_0x4c0884(0x140)&&_0x2e86f6['config']['valveMapping']){let _0x23fb58=_0x2e86f6[_0x4c0884(0x177)][_0x4c0884(0x191)];if(typeof _0x23fb58==='string')try{_0x23fb58=JSON[_0x4c0884(0x1a1)](_0x23fb58);}catch(_0x505131){}if(_0x23fb58&&_0x23fb58[_0xe7f5c6])return _0x23fb58[_0xe7f5c6];}let _0x272b48=[];if(_0x4e1bb0===_0x4c0884(0x15a))_0x272b48=[{'s':_0x4c0884(0x179),'t':_0x4c0884(0x141)},{'s':_0x4c0884(0x1ab),'t':_0x4c0884(0x141)},{'s':_0x4c0884(0x1ab),'t':_0x4c0884(0x12d)},{'s':_0x4c0884(0x143),'t':_0x4c0884(0x174)},{'s':_0x4c0884(0x199),'t':_0x4c0884(0x1b2)},{'s':_0x4c0884(0x199),'t':_0x4c0884(0x1d0)},{'s':_0x4c0884(0x173),'t':'target_temperature'},{'s':_0x4c0884(0x13b),'t':'SET'},{'s':_0x4c0884(0x134),'t':_0x4c0884(0x137)},{'s':_0x4c0884(0x173),'t':'setpoint'}];else _0x4e1bb0===_0x4c0884(0x140)&&(_0x272b48=[{'s':'.1.ACTUAL_TEMPERATURE','t':_0x4c0884(0x145)},{'s':_0x4c0884(0x1ab),'t':'.1.LEVEL'},{'s':_0x4c0884(0x1ab),'t':'.4.VALVE_STATE'},{'s':'local_temperature','t':_0x4c0884(0x136)},{'s':'temperature','t':_0x4c0884(0x195)},{'s':_0x4c0884(0x173),'t':_0x4c0884(0x132)}]);for(const _0x2907ef of _0x272b48){if(_0xe7f5c6[_0x4c0884(0x15b)](_0x2907ef['s'])){const _0x595477=_0xe7f5c6['replace'](_0x2907ef['s'],_0x2907ef['t']),_0x1c08ed=await _0x2e86f6[_0x4c0884(0x160)](_0x595477);if(_0x1c08ed)return _0x595477;}}try{const _0x26dad4=_0xe7f5c6[_0x4c0884(0x133)]('.');if(_0x26dad4[_0x4c0884(0x131)]>0x2){const _0x1cd29a=_0x26dad4['slice'](0x0,-0x1)[_0x4c0884(0x1ad)]('.'),_0x145f4a=await _0x2e86f6['getForeignObjectsAsync'](_0x1cd29a+'.*'),_0x2aa92a=[],_0x1bfbb4=_0xe7f5c6[_0x4c0884(0x133)](/[._]+/)['filter'](_0x1c9ab7=>![_0x4c0884(0x1ce),'0',_0x4c0884(0x154),_0x4c0884(0x1bd),_0x4c0884(0x139),_0x4c0884(0x173),_0x4c0884(0x184),'sensor',_0x4c0884(0x150),_0x4c0884(0x13a)][_0x4c0884(0x15b)](_0x1c9ab7[_0x4c0884(0x159)]()));for(const [_0x5e06d4,_0x3f03ec]of Object['entries'](_0x145f4a)){if(_0x5e06d4===_0xe7f5c6)continue;if(_0x3f03ec&&_0x3f03ec[_0x4c0884(0x122)]){const _0x2c6015=_0x5e06d4[_0x4c0884(0x159)](),_0x56d982=(_0x3f03ec[_0x4c0884(0x122)]['role']||'')[_0x4c0884(0x159)](),_0x4a818e=(_0x3f03ec[_0x4c0884(0x122)][_0x4c0884(0x19f)]||'')['toLowerCase']();let _0x38460d=![];if(_0x4e1bb0===_0x4c0884(0x15a)&&_0x3f03ec['common'][_0x4c0884(0x1a7)]===!![])_0x38460d=_0x2c6015[_0x4c0884(0x15b)](_0x4c0884(0x1b8))||_0x2c6015[_0x4c0884(0x15b)](_0x4c0884(0x12c))||_0x2c6015['includes'](_0x4c0884(0x1bf))||_0x56d982[_0x4c0884(0x15b)](_0x4c0884(0x185))||_0x56d982[_0x4c0884(0x15b)](_0x4c0884(0x130));else _0x4e1bb0==='valve'&&(_0x38460d=_0x2c6015[_0x4c0884(0x15b)](_0x4c0884(0x132))||_0x2c6015[_0x4c0884(0x15b)](_0x4c0884(0x140))||_0x2c6015[_0x4c0884(0x15b)](_0x4c0884(0x194))||_0x2c6015[_0x4c0884(0x15b)](_0x4c0884(0x18a))||_0x56d982[_0x4c0884(0x15b)](_0x4c0884(0x1ba))||_0x56d982['includes']('value.valve')||_0x4a818e[_0x4c0884(0x15b)]('%'));if(_0x38460d){const _0x1dd313=_0x5e06d4[_0x4c0884(0x133)](/[._]+/)[_0x4c0884(0x168)](_0x2df5bf=>_0x2df5bf[_0x4c0884(0x159)]());let _0x1eef4e=0x0;_0x1bfbb4['forEach'](_0x4080b9=>{if(_0x1dd313['includes'](_0x4080b9['toLowerCase']()))_0x1eef4e++;}),_0x2aa92a['push']({'id':_0x5e06d4,'score':_0x1eef4e});}}}if(_0x2aa92a[_0x4c0884(0x131)]>0x0){_0x2aa92a['sort']((_0x243d8a,_0x1a1f93)=>_0x1a1f93[_0x4c0884(0x1a2)]-_0x243d8a['score']);if(_0x2aa92a[0x0]['score']>0x0)return _0x2aa92a[0x0]['id'];}}}catch(_0x5152e2){}return null;}async function scanThermostats(_0x3dd962){const _0x8dc228=a1_0x1b8ff8,_0x3b2607=_0x3dd962[_0x8dc228(0x177)]['devices']||[],_0x4691a8=[],_0x457f4d=_0x3b2607[_0x8dc228(0x1ca)](_0x533efd=>_0x533efd['id']&&_0x533efd['id'][_0x8dc228(0x15b)](_0x8dc228(0x173))||_0x533efd[_0x8dc228(0x1c4)]&&['temperature',_0x8dc228(0x1b6),_0x8dc228(0x11f)][_0x8dc228(0x15b)](_0x533efd['type'])||_0x533efd['name']&&_0x533efd['name'][_0x8dc228(0x159)]()['includes'](_0x8dc228(0x15e)));for(const _0x2b46fc of _0x457f4d){const _0x3b4917=await findRelatedId(_0x3dd962,_0x2b46fc['id'],'setpoint'),_0x42806b=await findRelatedId(_0x3dd962,_0x2b46fc['id'],_0x8dc228(0x140));let _0xb0596f=_0x8dc228(0x162),_0x1d7f9c=![],_0x320fda=_0x3dd962[_0x8dc228(0x177)]['thermostatMapping']||{};if(typeof _0x320fda===_0x8dc228(0x18d))try{_0x320fda=JSON[_0x8dc228(0x1a1)](_0x320fda);}catch(_0x70fe31){}let _0x585fdc=_0x3dd962[_0x8dc228(0x177)][_0x8dc228(0x191)]||{};if(typeof _0x585fdc===_0x8dc228(0x18d))try{_0x585fdc=JSON[_0x8dc228(0x1a1)](_0x585fdc);}catch(_0x15960f){}if(_0x320fda[_0x2b46fc['id']]&&_0x320fda[_0x2b46fc['id']]===_0x3b4917||_0x585fdc[_0x2b46fc['id']]&&_0x585fdc[_0x2b46fc['id']]===_0x42806b)_0xb0596f='Manuelles\x20Mapping',_0x1d7f9c=!![];else(_0x3b4917||_0x42806b)&&(_0xb0596f=_0x8dc228(0x127));_0x4691a8['push']({'room':_0x2b46fc[_0x8dc228(0x16a)]||_0x8dc228(0x16e),'sensorId':_0x2b46fc['id'],'setpointId':_0x3b4917||'-','valveId':_0x42806b||'-','source':_0xb0596f,'isManual':_0x1d7f9c,'status':_0x3b4917&&_0x42806b?_0x8dc228(0x1c1):_0x3b4917?'OK':'Fehlt'});}return _0x4691a8['sort']((_0x4b07d0,_0x1701d1)=>_0x4b07d0[_0x8dc228(0x1a0)][_0x8dc228(0x11c)](_0x1701d1[_0x8dc228(0x1a0)]));}async function updateSchedulePreview(_0x12c45b){const _0x4909d4=a1_0x1b8ff8;if(!_0x12c45b['config'][_0x4909d4(0x12f)]||!_0x12c45b[_0x4909d4(0x177)][_0x4909d4(0x18f)])return;let _0x1f0614={};try{const _0x4d200e=await _0x12c45b[_0x4909d4(0x1cb)](_0x4909d4(0x14a));if(_0x4d200e&&_0x4d200e[_0x4909d4(0x192)])_0x1f0614=JSON['parse'](_0x4d200e['val']);}catch(_0x232955){}const _0x5ab9db=[],_0x5e59d7=Date[_0x4909d4(0x1cf)](),_0x32ea02=0x30*0x3c*0x3c*0x3e8;try{const _0x1fb2c5=await _0x12c45b['getForeignStateAsync'](_0x12c45b[_0x4909d4(0x177)][_0x4909d4(0x18f)]+_0x4909d4(0x1c7));if(!_0x1fb2c5||!_0x1fb2c5[_0x4909d4(0x192)])return;const _0x1b46c4=JSON[_0x4909d4(0x1a1)](_0x1fb2c5['val']),_0x379bcf=_0x12c45b[_0x4909d4(0x177)]['calendarSelection']||[],_0xc87569=_0x12c45b[_0x4909d4(0x177)][_0x4909d4(0x15d)]||[],_0x59c86c=new Set();_0xc87569[_0x4909d4(0x1b4)](_0x4ec0ce=>{const _0x3c03c2=_0x4909d4;if(_0x4ec0ce[_0x3c03c2(0x16a)])_0x59c86c[_0x3c03c2(0x17f)](_0x4ec0ce[_0x3c03c2(0x16a)]);});for(const _0x1c91f0 of _0x1b46c4){if(_0x1c91f0[_0x4909d4(0x156)]&&_0x379bcf[_0x4909d4(0x131)]>0x0&&!_0x379bcf['includes'](_0x1c91f0['_calName']))continue;const _0x3c4b84=_0x1c91f0[_0x4909d4(0x1ac)]||_0x1c91f0[_0x4909d4(0x149)]||_0x1c91f0[_0x4909d4(0x1c3)];if(!_0x3c4b84)continue;const _0x2f06e1=new Date(_0x3c4b84),_0x234865=_0x2f06e1['getTime']();if(isNaN(_0x234865))continue;if(_0x234865<_0x5e59d7)continue;if(_0x234865>_0x5e59d7+_0x32ea02)continue;const _0x23401e=(_0x1c91f0['event']||_0x1c91f0[_0x4909d4(0x172)]||'')[_0x4909d4(0x159)]();let _0x49007c=![],_0x279d77=[],_0x2562f9=_0x1c91f0['event']||_0x1c91f0[_0x4909d4(0x172)]||'Unbekannt';if(_0x23401e['includes'](_0x4909d4(0x1a6))||_0x23401e[_0x4909d4(0x15b)](_0x4909d4(0x182))||_0x23401e[_0x4909d4(0x15b)](_0x4909d4(0x196)))_0x49007c=!![],_0x279d77=Array[_0x4909d4(0x15f)](_0x59c86c);else for(const _0x587672 of _0x59c86c){if(_0x23401e['includes'](_0x587672[_0x4909d4(0x159)]()))_0x279d77[_0x4909d4(0x18c)](_0x587672);}_0x279d77[_0x4909d4(0x131)]>0x0&&_0x279d77[_0x4909d4(0x1b4)](_0xb4ca95=>{const _0x2ab4f3=_0x4909d4;let _0x5ec5e4=0x3c;if(_0x49007c){let _0x52da13=0x0;Object[_0x2ab4f3(0x1bb)](_0x1f0614)[_0x2ab4f3(0x1b4)](_0x1cefa5=>{if(_0x1cefa5>_0x52da13)_0x52da13=_0x1cefa5;}),_0x5ec5e4=_0x52da13>0x0?_0x52da13:0x78;}else _0x5ec5e4=_0x1f0614[_0xb4ca95]||0x3c;const _0x3235a4=new Date(_0x234865-_0x5ec5e4*0xea60);_0x5ab9db[_0x2ab4f3(0x18c)]({'eventTime':_0x234865,'triggerTime':_0x3235a4[_0x2ab4f3(0x153)](),'room':_0xb4ca95,'minutes':_0x5ec5e4,'reason':_0x2562f9,'isGlobal':_0x49007c});});}}catch(_0x3a8567){}_0x5ab9db[_0x4909d4(0x170)]((_0x4c28d4,_0x45023c)=>_0x4c28d4[_0x4909d4(0x1be)]-_0x45023c[_0x4909d4(0x1be)]);const _0x21ca96=_0x5ab9db[_0x4909d4(0x11b)](0x0,0x5);await _0x12c45b['setStateAsync'](_0x4909d4(0x14b),{'val':JSON[_0x4909d4(0x158)](_0x21ca96),'ack':!![]});}async function checkCalendarTriggers(_0x8f29){const _0x2b420e=a1_0x1b8ff8;if(!_0x8f29[_0x2b420e(0x177)][_0x2b420e(0x12f)]||!_0x8f29['config'][_0x2b420e(0x18f)])return;await updateSchedulePreview(_0x8f29);let _0x46d10d={},_0x3f9a1e={};try{const _0x406fc4=await _0x8f29[_0x2b420e(0x1cb)](_0x2b420e(0x14a));if(_0x406fc4&&_0x406fc4[_0x2b420e(0x192)])_0x46d10d=JSON['parse'](_0x406fc4[_0x2b420e(0x192)]);const _0x48133c=await _0x8f29[_0x2b420e(0x1cb)](_0x2b420e(0x1a8));if(_0x48133c&&_0x48133c[_0x2b420e(0x192)])_0x3f9a1e=JSON[_0x2b420e(0x1a1)](_0x48133c[_0x2b420e(0x192)]);}catch(_0x1d8929){}let _0x31621e={'default':0x15};try{const _0x913444=await _0x8f29['getStateAsync']('analysis.energy.warmupTargets');if(_0x913444&&_0x913444[_0x2b420e(0x192)])_0x31621e=JSON[_0x2b420e(0x1a1)](_0x913444[_0x2b420e(0x192)]);}catch(_0x3da38b){}try{const _0x2c73ff=await _0x8f29[_0x2b420e(0x19e)](_0x8f29['config']['calendarInstance']+'.data.table');if(!_0x2c73ff||!_0x2c73ff['val'])return;const _0x3e6249=JSON[_0x2b420e(0x1a1)](_0x2c73ff[_0x2b420e(0x192)]),_0x2a24c5=Date[_0x2b420e(0x1cf)](),_0x558e6f=_0x8f29[_0x2b420e(0x177)][_0x2b420e(0x15d)]||[],_0xb11fdf=_0x8f29['config']['calendarSelection']||[];for(const _0x592f39 of _0x3e6249){if(_0x592f39[_0x2b420e(0x156)]&&_0xb11fdf[_0x2b420e(0x131)]>0x0&&!_0xb11fdf[_0x2b420e(0x15b)](_0x592f39[_0x2b420e(0x156)]))continue;const _0x35f3a4=_0x592f39[_0x2b420e(0x1ac)]||_0x592f39[_0x2b420e(0x149)]||_0x592f39['date'];if(!_0x35f3a4)continue;const _0x534b73=new Date(_0x35f3a4);if(isNaN(_0x534b73[_0x2b420e(0x153)]()))continue;const _0x1a1195=(_0x592f39[_0x2b420e(0x123)]||_0x592f39[_0x2b420e(0x172)]||'')[_0x2b420e(0x159)]();if(_0x1a1195[_0x2b420e(0x15b)](_0x2b420e(0x1a6))||_0x1a1195[_0x2b420e(0x15b)](_0x2b420e(0x182))||_0x1a1195[_0x2b420e(0x15b)]('ankunft')){let _0x4c5737=0x0;Object[_0x2b420e(0x1bb)](_0x46d10d)[_0x2b420e(0x1b4)](_0x1252b3=>{if(_0x1252b3>_0x4c5737)_0x4c5737=_0x1252b3;});if(_0x4c5737===0x0)_0x4c5737=0x78;const _0x103a74=_0x534b73['getTime']()-_0x4c5737*0xea60;_0x2a24c5>=_0x103a74&&_0x2a24c5<_0x534b73[_0x2b420e(0x153)]()&&(_0x8f29[_0x2b420e(0x144)]!==_0x2b420e(0x193)&&(_0x8f29[_0x2b420e(0x1c6)][_0x2b420e(0x1c9)](_0x2b420e(0x124)+_0x4c5737+_0x2b420e(0x147)),await _0x8f29[_0x2b420e(0x126)]('system.mode',{'val':'normal','ack':![]})));}for(const _0x46e0d6 of _0x558e6f){if(_0x46e0d6[_0x2b420e(0x16a)]){const _0x593049=_0x46e0d6[_0x2b420e(0x16a)][_0x2b420e(0x159)]();if(_0x1a1195[_0x2b420e(0x15b)](_0x593049)){const _0x4b3363=_0x46d10d[_0x46e0d6['location']]||0x3c,_0x1a727c=_0x3f9a1e[_0x46e0d6[_0x2b420e(0x16a)]]||'Classic',_0x54576f=_0x534b73[_0x2b420e(0x153)]()-_0x4b3363*0xea60;if(_0x2a24c5>=_0x54576f&&_0x2a24c5<_0x534b73['getTime']()){const _0xc90bf7=lastActions[_0x2b420e(0x19b)+_0x46e0d6['location']];if(_0xc90bf7&&_0x2a24c5-_0xc90bf7<CAL_COOLDOWN_MS)continue;const _0x5a83a9=await findRelatedId(_0x8f29,_0x46e0d6['id'],'setpoint');if(_0x5a83a9){let _0x355200=_0x31621e[_0x46e0d6[_0x2b420e(0x16a)]];if(_0x355200===undefined)_0x355200=_0x31621e[_0x2b420e(0x1cc)];if(_0x355200===undefined)_0x355200=0x15;const _0x3d8ff0=await _0x8f29[_0x2b420e(0x19e)](_0x5a83a9);_0x3d8ff0&&typeof _0x3d8ff0[_0x2b420e(0x192)]===_0x2b420e(0x11a)&&_0x3d8ff0[_0x2b420e(0x192)]<_0x355200-0.5&&(_0x8f29[_0x2b420e(0x1c6)][_0x2b420e(0x1c9)](_0x2b420e(0x12b)+_0x1a727c+_0x2b420e(0x14d)+_0x46e0d6[_0x2b420e(0x16a)]+_0x2b420e(0x166)+_0x355200+_0x2b420e(0x1b3)+_0x4b3363+'\x20min).'),await _0x8f29[_0x2b420e(0x181)](_0x5a83a9,_0x355200),await logAutomationAction(_0x8f29,_0x2b420e(0x13c)+_0x46e0d6[_0x2b420e(0x16a)]+_0x2b420e(0x171)+_0x355200+_0x2b420e(0x12a)+_0x1a727c+')'),lastActions[_0x2b420e(0x19b)+_0x46e0d6[_0x2b420e(0x16a)]]=_0x2a24c5);}}}}}}}catch(_0x2bf1e6){_0x8f29[_0x2b420e(0x1c6)][_0x2b420e(0x1b1)]('Calendar\x20Check\x20Error:\x20'+_0x2bf1e6['message']);}}async function manageMpcIntervention(_0x54b511,_0x18dea3,_0x5c129c){const _0x5318d4=a1_0x1b8ff8;try{const _0x2786e0=_0x5318d4(0x1a3),_0x1bcf5e=await _0x54b511[_0x5318d4(0x1cb)](_0x2786e0);let _0x5cacca=[];if(_0x1bcf5e&&_0x1bcf5e[_0x5318d4(0x192)])try{_0x5cacca=JSON[_0x5318d4(0x1a1)](_0x1bcf5e[_0x5318d4(0x192)]);}catch(_0x3e798a){}const _0xc84864=_0x5cacca[_0x5318d4(0x189)](_0x18dea3);if(_0x5c129c===_0x5318d4(0x17f))_0xc84864===-0x1&&(_0x5cacca[_0x5318d4(0x18c)](_0x18dea3),await _0x54b511[_0x5318d4(0x126)](_0x2786e0,{'val':JSON[_0x5318d4(0x158)](_0x5cacca),'ack':!![]}));else _0x5c129c===_0x5318d4(0x17b)&&(_0xc84864!==-0x1&&(_0x5cacca[_0x5318d4(0x16c)](_0xc84864,0x1),await _0x54b511[_0x5318d4(0x126)](_0x2786e0,{'val':JSON['stringify'](_0x5cacca),'ack':!![]})));}catch(_0x1bf737){}}async function cleanupGhostInterventions(_0x4085b3){const _0x1e773d=a1_0x1b8ff8;try{const _0x1cbb01=_0x1e773d(0x1a3),_0x36e2a6=await _0x4085b3[_0x1e773d(0x1cb)](_0x1cbb01);if(!_0x36e2a6||!_0x36e2a6[_0x1e773d(0x192)])return;const _0x1dbd37=JSON[_0x1e773d(0x1a1)](_0x36e2a6[_0x1e773d(0x192)]);if(!Array[_0x1e773d(0x17a)](_0x1dbd37)||_0x1dbd37[_0x1e773d(0x131)]===0x0)return;let _0x598f5d={'default':0x15};try{const _0x40dd29=await _0x4085b3[_0x1e773d(0x1cb)](_0x1e773d(0x18b));if(_0x40dd29&&_0x40dd29[_0x1e773d(0x192)])_0x598f5d=JSON[_0x1e773d(0x1a1)](_0x40dd29[_0x1e773d(0x192)]);}catch(_0x450e52){}let _0x4032ad=[];try{const _0x48b4c4=await _0x4085b3[_0x1e773d(0x1cb)](_0x1e773d(0x169));if(_0x48b4c4&&_0x48b4c4[_0x1e773d(0x192)])_0x4032ad=JSON[_0x1e773d(0x1a1)](_0x48b4c4[_0x1e773d(0x192)]);}catch(_0x44464a){}const _0x3ce8cf=_0x4085b3[_0x1e773d(0x177)]['devices']||[];let _0x8086e=![];for(let _0x50366f=_0x1dbd37[_0x1e773d(0x131)]-0x1;_0x50366f>=0x0;_0x50366f--){const _0x21e725=_0x1dbd37[_0x50366f],_0x134a13=_0x3ce8cf['find'](_0x328e43=>normalize(_0x328e43['location'])===normalize(_0x21e725)&&(_0x328e43[_0x1e773d(0x1c4)]===_0x1e773d(0x173)||_0x328e43['type']===_0x1e773d(0x1b6)));if(!_0x134a13){_0x4085b3['log'][_0x1e773d(0x1b1)](_0x1e773d(0x135)+_0x21e725+_0x1e773d(0x167)),_0x1dbd37[_0x1e773d(0x16c)](_0x50366f,0x1),_0x8086e=!![];continue;}if(_0x134a13){const _0xf5c092=await findRelatedId(_0x4085b3,_0x134a13['id'],'setpoint'),_0x124139=await _0x4085b3[_0x1e773d(0x19e)](_0x134a13['id']);if(_0xf5c092){const _0x58b831=await _0x4085b3['getForeignStateAsync'](_0xf5c092);if(_0x58b831&&typeof _0x58b831[_0x1e773d(0x192)]==='number'){let _0x53e472=![],_0x174b17='';Math[_0x1e773d(0x13e)](_0x58b831['val']-ECO_TEMP)>0.5&&(_0x53e472=!![],_0x174b17=_0x1e773d(0x152));if(!_0x53e472&&_0x124139&&typeof _0x124139[_0x1e773d(0x192)]===_0x1e773d(0x11a)){const _0x5de12d=_0x598f5d[_0x21e725]||_0x598f5d['default']||0x15;_0x124139[_0x1e773d(0x192)]<_0x5de12d+0.2&&(_0x53e472=!![],_0x174b17=_0x1e773d(0x178));}if(_0x53e472){if(_0x174b17===_0x1e773d(0x152)){_0x4085b3['log']['info'](_0x1e773d(0x1bc)+_0x21e725+_0x1e773d(0x11d)+_0x58b831[_0x1e773d(0x192)]+_0x1e773d(0x198)+ECO_TEMP+_0x1e773d(0x1a4));const _0x1af305=lastActions['cal_'+_0x21e725],_0x3c86e3=_0x1af305&&Date[_0x1e773d(0x1cf)]()-_0x1af305<0x2*0x3c*0x3e8;if(!_0x3c86e3&&_0x58b831[_0x1e773d(0x192)]>ECO_TEMP+0.5)_0x4085b3[_0x1e773d(0x11e)]&&(_0x4085b3['log'][_0x1e773d(0x1c9)](_0x1e773d(0x197)+_0x21e725+_0x1e773d(0x188)),_0x4085b3[_0x1e773d(0x11e)](_0x1e773d(0x157),{'room':_0x21e725}));else _0x3c86e3&&_0x4085b3[_0x1e773d(0x1c6)][_0x1e773d(0x1c9)](_0x1e773d(0x12e)+_0x21e725+_0x1e773d(0x19a));}else{if(_0x174b17===_0x1e773d(0x178)){let _0x2df05b=![];if(_0x4032ad[_0x1e773d(0x13f)](_0x431bdd=>_0x431bdd[_0x1e773d(0x1a0)]===_0x21e725))_0x2df05b=!![];const _0x4f1d98=_0x3ce8cf[_0x1e773d(0x1ca)](_0x5036e6=>normalize(_0x5036e6[_0x1e773d(0x16a)])===normalize(_0x21e725)&&(_0x5036e6[_0x1e773d(0x1c4)]===_0x1e773d(0x148)||_0x5036e6['type']==='sensor'||_0x5036e6[_0x1e773d(0x1c4)]===_0x1e773d(0x125)));for(const _0x4af427 of _0x4f1d98){try{const _0x500557=await _0x4085b3[_0x1e773d(0x19e)](_0x4af427['id']);if(_0x500557&&(_0x500557[_0x1e773d(0x192)]===!![]||_0x500557['val']===0x1||String(_0x500557[_0x1e773d(0x192)])[_0x1e773d(0x159)]()===_0x1e773d(0x17c)))_0x2df05b=!![];}catch(_0x581cd1){}}if(_0x2df05b)_0x4085b3[_0x1e773d(0x1c6)][_0x1e773d(0x1c9)](_0x1e773d(0x14c)+_0x21e725+'\x20ist\x20zu\x20kalt,\x20ABER\x20Fenster\x20offen/L√ºftung\x20erkannt.\x20Heize\x20NICHT,\x20entferne\x20nur\x20Status.');else{const _0x47e4ed=_0x598f5d[_0x21e725]||_0x598f5d[_0x1e773d(0x1cc)]||0x15;_0x4085b3[_0x1e773d(0x1c6)][_0x1e773d(0x1c9)](_0x1e773d(0x16f)+_0x21e725+'\x20erreicht\x20Limit\x20('+_0x124139[_0x1e773d(0x192)]+_0x1e773d(0x14f)+(_0x47e4ed+0.2)+_0x1e773d(0x138)),await _0x4085b3[_0x1e773d(0x181)](_0xf5c092,_0x47e4ed),await logAutomationAction(_0x4085b3,'[WATCHDOG]\x20'+_0x21e725+_0x1e773d(0x1b5)+_0x47e4ed+'¬∞C'),lastActions[_0x1e773d(0x1c8)+_0x21e725]=Date[_0x1e773d(0x1cf)]();}}}_0x1dbd37['splice'](_0x50366f,0x1),_0x8086e=!![];}}}}}_0x8086e&&await _0x4085b3[_0x1e773d(0x126)](_0x1cbb01,{'val':JSON['stringify'](_0x1dbd37),'ack':!![]});}catch(_0x5ed7de){}}async function applyEnergySavings(_0x263638,_0x4f90e9){const _0x86e90d=a1_0x1b8ff8;await cleanupGhostInterventions(_0x263638);if(!_0x4f90e9||_0x4f90e9[_0x86e90d(0x131)]===0x0)return;const _0x4d624a=_0x263638[_0x86e90d(0x177)][_0x86e90d(0x15d)]||[],_0x5653ff=Date['now']();for(const _0x18b299 of _0x4f90e9){const _0x1fa7de=_0x18b299[_0x86e90d(0x1a0)],_0x1e3b91=_0x18b299[_0x86e90d(0x16d)],_0xf86192=_0x18b299['target']||0x15;if(lastActions['rescue_'+_0x1fa7de]&&_0x5653ff-lastActions['rescue_'+_0x1fa7de]<RESCUE_LOCK_MS)continue;const _0x2116d2=_0x4d624a[_0x86e90d(0x13f)](_0xde258a=>normalize(_0xde258a[_0x86e90d(0x16a)])===normalize(_0x1fa7de)&&(_0xde258a['type']===_0x86e90d(0x173)||_0xde258a[_0x86e90d(0x1c4)]===_0x86e90d(0x1b6)));if(!_0x2116d2)continue;const _0x131886=await findRelatedId(_0x263638,_0x2116d2['id'],'setpoint');if(_0x131886){if(lastActions['mpc_'+_0x1fa7de]&&_0x5653ff-lastActions[_0x86e90d(0x17d)+_0x1fa7de]<0x1e*0x3c*0x3e8)continue;const _0x372ee3=await _0x263638[_0x86e90d(0x19e)](_0x131886);if(_0x372ee3&&typeof _0x372ee3[_0x86e90d(0x192)]===_0x86e90d(0x11a)){const _0x503923=_0x372ee3[_0x86e90d(0x192)];_0x503923!==ECO_TEMP&&await manageMpcIntervention(_0x263638,_0x1fa7de,_0x86e90d(0x17b));if(_0x1e3b91>0x1e)_0x503923>ECO_TEMP+0.5&&(_0x263638[_0x86e90d(0x1c6)][_0x86e90d(0x1c9)]('üçÉ\x20[MPC\x20ACTION]\x20Senke\x20'+_0x1fa7de+_0x86e90d(0x1b0)+ECO_TEMP+_0x86e90d(0x1c0)+_0x1e3b91+_0x86e90d(0x186)),await _0x263638[_0x86e90d(0x181)](_0x131886,ECO_TEMP),await manageMpcIntervention(_0x263638,_0x1fa7de,_0x86e90d(0x17f)),lastActions[_0x86e90d(0x17d)+_0x1fa7de]=_0x5653ff,await logAutomationAction(_0x263638,_0x86e90d(0x146)+_0x1fa7de+_0x86e90d(0x15c)+ECO_TEMP+'¬∞C'));else _0x1e3b91<=0xf&&(_0x503923<_0xf86192&&(_0x263638[_0x86e90d(0x1c6)]['info'](_0x86e90d(0x17e)+_0x1fa7de+'\x20wieder\x20auf\x20'+_0xf86192+_0x86e90d(0x187)),await _0x263638[_0x86e90d(0x181)](_0x131886,_0xf86192),await manageMpcIntervention(_0x263638,_0x1fa7de,_0x86e90d(0x17b)),lastActions[_0x86e90d(0x17d)+_0x1fa7de]=_0x5653ff,await logAutomationAction(_0x263638,'[MPC]\x20'+_0x1fa7de+_0x86e90d(0x161)+_0xf86192+'¬∞C')));}}else _0x263638[_0x86e90d(0x1c6)][_0x86e90d(0x1b1)](_0x86e90d(0x128)+_0x1fa7de+_0x86e90d(0x18e));}}module[a1_0x1b8ff8(0x1b7)]={'handlePrediction':handlePrediction,'applyEnergySavings':applyEnergySavings,'scanThermostats':scanThermostats,'checkCalendarTriggers':checkCalendarTriggers,'updateSchedulePreview':updateSchedulePreview,'cleanupGhostInterventions':cleanupGhostInterventions};