const a1_0x43366d=a1_0x2100;(function(_0x1e3bd7,_0x2f8748){const _0x48d2bf=a1_0x2100,_0x5c691a=_0x1e3bd7();while(!![]){try{const _0x8848b4=-parseInt(_0x48d2bf(0x1b7))/0x1*(-parseInt(_0x48d2bf(0x1e1))/0x2)+-parseInt(_0x48d2bf(0x243))/0x3+-parseInt(_0x48d2bf(0x24f))/0x4+-parseInt(_0x48d2bf(0x225))/0x5*(-parseInt(_0x48d2bf(0x234))/0x6)+parseInt(_0x48d2bf(0x1bd))/0x7+parseInt(_0x48d2bf(0x207))/0x8*(parseInt(_0x48d2bf(0x1c1))/0x9)+-parseInt(_0x48d2bf(0x1f5))/0xa;if(_0x8848b4===_0x2f8748)break;else _0x5c691a['push'](_0x5c691a['shift']());}catch(_0x4c066a){_0x5c691a['push'](_0x5c691a['shift']());}}}(a1_0x4d8b,0x8996e));const a1_0x1de0c9=(function(){let _0x8a981c=!![];return function(_0x402069,_0xef28b9){const _0x3bc651=_0x8a981c?function(){const _0x34cbdc=a1_0x2100;if(_0xef28b9){const _0x2c3c78=_0xef28b9[_0x34cbdc(0x208)](_0x402069,arguments);return _0xef28b9=null,_0x2c3c78;}}:function(){};return _0x8a981c=![],_0x3bc651;};}()),a1_0x5eca81=a1_0x1de0c9(this,function(){const _0x569578=a1_0x2100;return a1_0x5eca81[_0x569578(0x20d)]()['search']('(((.+)+)+)+$')[_0x569578(0x20d)]()[_0x569578(0x1a7)](a1_0x5eca81)[_0x569578(0x218)](_0x569578(0x1db));});function a1_0x4d8b(){const _0x254efc=['triggerTime','date','\x20auf\x20','off','default','location','Calendar\x20Check\x20Error:\x20','filter','Â°C\x20(nicht\x20','(((.+)+)+)+$','string','getForeignStateAsync','splice','abs','calendarInstance','134IRdaxc','occupied_heating_setpoint','open','setStateAsync','info','thermostat.setpoint','\x20erreicht\x20Limit\x20(','stringify','consultButler','thermostatMapping','local_temperature','analysis.energy.schedulePreview','stellwert','ðŸŽ“\x20[RL-FEEDBACK]\x20Lerne\x20aus\x20Fehler:\x20','event','\x20min)','map','state','Â°C!\x20(Puffer\x20leer).','TRAIN_RL_PENALTY','17352360pCwWFD','set','value.valve','parse','score','Â°C).\x20Entferne\x20Status.','[MPC]\x20','level','eventStart','./ai_agent','SET_POINT_TEMPERATURE','SET','analysis.automation.confidenceThreshold','.4.SET_TEMPERATURE','summary','sendToPythonWrapper','.4.VALVE_STATE','ðŸŒ¬ï¸\x20[MPC\x20WATCHDOG]\x20','16424WgXFyW','apply','setpoint','values','ðŸ§¹\x20[MPC\x20CLEANUP]\x20Raum\x20\x27','calendarSelection','toString','forEach','.1.SET_POINT_TEMPERATURE','unit','devices','setForeignStateAsync','openknx','sort','number','analysis.energy.warmupTimes','target','search','common','warn','ðŸ“…\x20SMART\x20SCHEDULE\x20[','\x20ist\x20zu\x20kalt,\x20ABER\x20Fenster\x20offen/LÃ¼ftung\x20erkannt.\x20Heize\x20NICHT,\x20entferne\x20nur\x20Status.','_calName','PERFECT','light','current_heating_setpoint','val','rÃ¼ckkehr','role','Manuelles\x20Mapping','335LLMXZC','ðŸ“…\x20SMART\x20SCHEDULE\x20(Phase):\x20\x27Globaler\x20Start\x27\x20erkannt.\x20Heize\x20Haus\x20auf\x20(Vorlauf:\x20','active','[MPC\x20WARNING]\x20Kein\x20Setpoint\x20fÃ¼r\x20','remove','urlaub\x20ende','.1.ACTUAL_TEMPERATURE','getTime','wert','log','ðŸ§¹\x20[MPC\x20CLEANUP]\x20','Ist','Unknown','temperature','split','49374HqSVfU','.1.TEMPERATURE','mpc_','ACTUAL','system.mode','contact','\x20gefunden!','ðŸš¨\x20[MPC\x20WATCHDOG]\x20','push','Unbekannt','name','length','Nicht\x20gefunden','cal_','level.temperature','820560aJrVve','valveMapping','\x20durch\x20Kalender\x20geÃ¤ndert.\x20Keine\x20RL-Strafe.','Â°C\x20(Vorlauf:\x20','window','too_cold','pi_heating_demand','\x27\x20hat\x20kein\x20GerÃ¤t\x20mehr.\x20LÃ¶sche\x20Eintrag.','ðŸƒ\x20[MPC\x20ACTION]\x20Senke\x20','ðŸ“…\x20[MPC\x20INFO]\x20',']:\x20Raum-Trigger\x20\x27','toUpperCase','4485676dMeMkt','manual','analysis.automation.mode','now','\x27\x20aktiv.\x20Heize\x20auf\x20','config','analysis.energy.mpcActiveInterventions','Fehlt','[WATCHDOG]\x20','constructor','replace','room','toLowerCase','getStateAsync',':\x20Puffer\x20leer\x20->\x20Heizen\x20auf\x20','ACTUAL_TEMPERATURE','.data.table','write','soll',':\x20Absenkung\x20auf\x20','find','.1.LEVEL','join','from','_date','16541GWDznB','rescue_','ðŸ”¥\x20[MPC\x20ACTION]\x20Heize\x20','slice','[CAL]\x20','thermostat','6881105hfDtFb','includes','type','messwert','4608YvdGJK','add','\x20ist\x20auf\x20','normal','Â°C).\x20Sparmodus\x20beendet!','sensor','valve','hm-rpc','dimmer','getForeignObjectAsync','ankunft','unshift','position','analysis.energy.ventilationAlerts','useCalendar','approved','analysis.energy.warmupSources'];a1_0x4d8b=function(){return _0x254efc;};return a1_0x4d8b();}a1_0x5eca81();'use strict';function a1_0x2100(_0x4543d6,_0x4f3c70){const _0x47601d=a1_0x4d8b();return a1_0x2100=function(_0x5eca81,_0x1de0c9){_0x5eca81=_0x5eca81-0x1a4;let _0x4d8be3=_0x47601d[_0x5eca81];return _0x4d8be3;},a1_0x2100(_0x4543d6,_0x4f3c70);}const aiAgent=require(a1_0x43366d(0x1fe)),COOLDOWN_MS=0x3c*0x3e8,CAL_COOLDOWN_MS=0x5a*0x3c*0x3e8,RESCUE_LOCK_MS=0x78*0x3c*0x3e8,ECO_TEMP=0x11,lastActions={};function normalize(_0x4d3438){const _0x3953c9=a1_0x43366d;if(!_0x4d3438)return'';return _0x4d3438[_0x3953c9(0x1aa)]()[_0x3953c9(0x1a8)](/\s+/g,'')['trim']();}async function logAutomationAction(_0x5c7e11,_0x11989b){const _0x58319b=a1_0x43366d;await _0x5c7e11[_0x58319b(0x1e4)]('analysis.automation.lastAction',{'val':_0x11989b,'ack':!![]});try{const _0xc6c7d1='analysis.automation.actionLog',_0x5c54da=await _0x5c7e11[_0x58319b(0x1ab)](_0xc6c7d1);let _0x201ba6=[];if(_0x5c54da&&_0x5c54da[_0x58319b(0x221)])try{_0x201ba6=JSON['parse'](_0x5c54da[_0x58319b(0x221)]);}catch(_0x29f993){}_0x201ba6[_0x58319b(0x1cc)]({'ts':Date[_0x58319b(0x252)](),'msg':_0x11989b});if(_0x201ba6['length']>0x32)_0x201ba6=_0x201ba6[_0x58319b(0x1ba)](0x0,0x32);await _0x5c7e11[_0x58319b(0x1e4)](_0xc6c7d1,{'val':JSON[_0x58319b(0x1e8)](_0x201ba6),'ack':!![]});}catch(_0x1b6d38){}}async function handlePrediction(_0x45d606,_0x31ba29,_0x1cecff){const _0x3472a8=a1_0x43366d;if(!_0x31ba29||_0x31ba29===_0x3472a8(0x231))return;let _0x2c5d69='off',_0x5c8e68=0.6;try{const _0x302996=await _0x45d606[_0x3472a8(0x1ab)](_0x3472a8(0x251));if(_0x302996&&_0x302996[_0x3472a8(0x221)])_0x2c5d69=_0x302996[_0x3472a8(0x221)];const _0x438514=await _0x45d606[_0x3472a8(0x1ab)](_0x3472a8(0x201));if(_0x438514&&_0x438514[_0x3472a8(0x221)])_0x5c8e68=_0x438514[_0x3472a8(0x221)];}catch(_0x43cab2){}if(_0x2c5d69===_0x3472a8(0x1d5)||_0x1cecff<_0x5c8e68)return;const _0x3f6176=Date[_0x3472a8(0x252)]();if(lastActions[_0x31ba29]&&_0x3f6176-lastActions[_0x31ba29]<COOLDOWN_MS)return;const _0x395188=_0x45d606['config'][_0x3472a8(0x211)]||[],_0x12710b=normalize(_0x31ba29),_0x2315bf=_0x395188[_0x3472a8(0x1b2)](_0x4b7c33=>normalize(_0x4b7c33[_0x3472a8(0x1d7)])===_0x12710b&&(_0x4b7c33['type']===_0x3472a8(0x21f)||_0x4b7c33[_0x3472a8(0x1bf)]===_0x3472a8(0x1c9)||_0x4b7c33[_0x3472a8(0x1bf)]==='switch'));if(!_0x2315bf)return;const _0x1e5ba2=await aiAgent[_0x3472a8(0x1e9)](_0x45d606,_0x31ba29,_0x2315bf[_0x3472a8(0x23e)],_0x1cecff);if(!_0x1e5ba2[_0x3472a8(0x1d0)])return;const _0x1932dc='PrÃ¤diktion:\x20'+_0x31ba29+'\x20->\x20Schalte\x20'+_0x2315bf[_0x3472a8(0x23e)]+'\x20('+_0x1e5ba2['reason']+')';await logAutomationAction(_0x45d606,'['+_0x2c5d69[_0x3472a8(0x24e)]()+']\x20'+_0x1932dc);if(_0x2c5d69===_0x3472a8(0x227)){const _0x17bcb6=await _0x45d606['getForeignStateAsync'](_0x2315bf['id']);(!_0x17bcb6||!_0x17bcb6[_0x3472a8(0x221)]&&_0x17bcb6[_0x3472a8(0x221)]!==!![])&&await _0x45d606['setForeignStateAsync'](_0x2315bf['id'],!![]),lastActions[_0x31ba29]=_0x3f6176;}}async function findRelatedId(_0x1514e1,_0x3efb86,_0x3d79d4='setpoint'){const _0x15aa40=a1_0x43366d;if(_0x3d79d4===_0x15aa40(0x209)&&_0x1514e1[_0x15aa40(0x254)][_0x15aa40(0x1ea)]){let _0x1da4c2=_0x1514e1[_0x15aa40(0x254)][_0x15aa40(0x1ea)];if(typeof _0x1da4c2===_0x15aa40(0x1dc))try{_0x1da4c2=JSON['parse'](_0x1da4c2);}catch(_0x4d87eb){}if(_0x1da4c2&&_0x1da4c2[_0x3efb86])return _0x1da4c2[_0x3efb86];}if(_0x3d79d4===_0x15aa40(0x1c7)&&_0x1514e1[_0x15aa40(0x254)][_0x15aa40(0x244)]){let _0x308134=_0x1514e1[_0x15aa40(0x254)]['valveMapping'];if(typeof _0x308134===_0x15aa40(0x1dc))try{_0x308134=JSON[_0x15aa40(0x1f8)](_0x308134);}catch(_0x12660c){}if(_0x308134&&_0x308134[_0x3efb86])return _0x308134[_0x3efb86];}let _0xd1530b=[];if(_0x3d79d4===_0x15aa40(0x209))_0xd1530b=[{'s':'.1.ACTUAL_TEMPERATURE','t':'.1.SET_POINT_TEMPERATURE'},{'s':_0x15aa40(0x235),'t':_0x15aa40(0x20f)},{'s':'.1.TEMPERATURE','t':_0x15aa40(0x202)},{'s':_0x15aa40(0x1ad),'t':_0x15aa40(0x1ff)},{'s':_0x15aa40(0x1eb),'t':_0x15aa40(0x1e2)},{'s':_0x15aa40(0x1eb),'t':_0x15aa40(0x220)},{'s':_0x15aa40(0x232),'t':'target_temperature'},{'s':_0x15aa40(0x237),'t':_0x15aa40(0x200)},{'s':_0x15aa40(0x230),'t':'Soll'},{'s':_0x15aa40(0x232),'t':_0x15aa40(0x209)}];else _0x3d79d4===_0x15aa40(0x1c7)&&(_0xd1530b=[{'s':_0x15aa40(0x22b),'t':_0x15aa40(0x1b3)},{'s':_0x15aa40(0x235),'t':_0x15aa40(0x1b3)},{'s':_0x15aa40(0x235),'t':_0x15aa40(0x205)},{'s':_0x15aa40(0x1eb),'t':_0x15aa40(0x249)},{'s':_0x15aa40(0x232),'t':'valve_position'},{'s':'temperature','t':_0x15aa40(0x1fc)}]);for(const _0x5a5fc6 of _0xd1530b){if(_0x3efb86[_0x15aa40(0x1be)](_0x5a5fc6['s'])){const _0x478e0b=_0x3efb86[_0x15aa40(0x1a8)](_0x5a5fc6['s'],_0x5a5fc6['t']),_0x27a385=await _0x1514e1[_0x15aa40(0x1ca)](_0x478e0b);if(_0x27a385)return _0x478e0b;}}try{const _0x7c8926=_0x3efb86[_0x15aa40(0x233)]('.');if(_0x7c8926[_0x15aa40(0x23f)]>0x2){const _0x36c04f=_0x7c8926['slice'](0x0,-0x1)[_0x15aa40(0x1b4)]('.'),_0x398145=await _0x1514e1['getForeignObjectsAsync'](_0x36c04f+'.*'),_0x32e583=[],_0x4c3270=_0x3efb86[_0x15aa40(0x233)](/[._]+/)[_0x15aa40(0x1d9)](_0x51cb30=>![_0x15aa40(0x213),'0',_0x15aa40(0x1c8),'ist',_0x15aa40(0x22d),_0x15aa40(0x232),'actual',_0x15aa40(0x1c6),_0x15aa40(0x1c0),_0x15aa40(0x1f2)][_0x15aa40(0x1be)](_0x51cb30[_0x15aa40(0x1aa)]()));for(const [_0x4d5633,_0x27d7ae]of Object['entries'](_0x398145)){if(_0x4d5633===_0x3efb86)continue;if(_0x27d7ae&&_0x27d7ae[_0x15aa40(0x219)]){const _0x3d1ce0=_0x4d5633[_0x15aa40(0x1aa)](),_0x4b5653=(_0x27d7ae['common'][_0x15aa40(0x223)]||'')[_0x15aa40(0x1aa)](),_0x930ab3=(_0x27d7ae[_0x15aa40(0x219)][_0x15aa40(0x210)]||'')[_0x15aa40(0x1aa)]();let _0x39a859=![];if(_0x3d79d4==='setpoint'&&_0x27d7ae[_0x15aa40(0x219)][_0x15aa40(0x1af)]===!![])_0x39a859=_0x3d1ce0[_0x15aa40(0x1be)](_0x15aa40(0x1f6))||_0x3d1ce0[_0x15aa40(0x1be)](_0x15aa40(0x1b0))||_0x3d1ce0[_0x15aa40(0x1be)](_0x15aa40(0x217))||_0x4b5653[_0x15aa40(0x1be)](_0x15aa40(0x242))||_0x4b5653[_0x15aa40(0x1be)](_0x15aa40(0x1e6));else _0x3d79d4===_0x15aa40(0x1c7)&&(_0x39a859=_0x3d1ce0[_0x15aa40(0x1be)](_0x15aa40(0x1fc))||_0x3d1ce0[_0x15aa40(0x1be)]('valve')||_0x3d1ce0[_0x15aa40(0x1be)](_0x15aa40(0x1ed))||_0x3d1ce0[_0x15aa40(0x1be)](_0x15aa40(0x1cd))||_0x4b5653[_0x15aa40(0x1be)]('level.valve')||_0x4b5653[_0x15aa40(0x1be)](_0x15aa40(0x1f7))||_0x930ab3[_0x15aa40(0x1be)]('%'));if(_0x39a859){const _0x56e073=_0x4d5633[_0x15aa40(0x233)](/[._]+/)[_0x15aa40(0x1f1)](_0x1d70b3=>_0x1d70b3['toLowerCase']());let _0x1cd4e0=0x0;_0x4c3270[_0x15aa40(0x20e)](_0x2b09f9=>{const _0x4aefed=_0x15aa40;if(_0x56e073[_0x4aefed(0x1be)](_0x2b09f9[_0x4aefed(0x1aa)]()))_0x1cd4e0++;}),_0x32e583[_0x15aa40(0x23c)]({'id':_0x4d5633,'score':_0x1cd4e0});}}}if(_0x32e583[_0x15aa40(0x23f)]>0x0){_0x32e583['sort']((_0x19f857,_0x944dff)=>_0x944dff[_0x15aa40(0x1f9)]-_0x19f857['score']);if(_0x32e583[0x0][_0x15aa40(0x1f9)]>0x0)return _0x32e583[0x0]['id'];}}}catch(_0x3aa1ac){}return null;}async function scanThermostats(_0x321d4d){const _0x5df73c=a1_0x43366d,_0x639f2=_0x321d4d[_0x5df73c(0x254)]['devices']||[],_0x1f6b32=[],_0x50a570=_0x639f2[_0x5df73c(0x1d9)](_0x4645e1=>_0x4645e1['id']&&_0x4645e1['id'][_0x5df73c(0x1be)](_0x5df73c(0x232))||_0x4645e1[_0x5df73c(0x1bf)]&&[_0x5df73c(0x232),_0x5df73c(0x1bc),_0x5df73c(0x1c6)]['includes'](_0x4645e1[_0x5df73c(0x1bf)])||_0x4645e1[_0x5df73c(0x23e)]&&_0x4645e1['name'][_0x5df73c(0x1aa)]()[_0x5df73c(0x1be)]('temp'));for(const _0x5edf31 of _0x50a570){const _0x3f6bc1=await findRelatedId(_0x321d4d,_0x5edf31['id'],_0x5df73c(0x209)),_0x20f1e6=await findRelatedId(_0x321d4d,_0x5edf31['id'],_0x5df73c(0x1c7));let _0x4449e4=_0x5df73c(0x240),_0x3e75a9=![],_0x54c669=_0x321d4d[_0x5df73c(0x254)][_0x5df73c(0x1ea)]||{};if(typeof _0x54c669===_0x5df73c(0x1dc))try{_0x54c669=JSON[_0x5df73c(0x1f8)](_0x54c669);}catch(_0x1cfec9){}let _0x56e5e0=_0x321d4d[_0x5df73c(0x254)]['valveMapping']||{};if(typeof _0x56e5e0===_0x5df73c(0x1dc))try{_0x56e5e0=JSON[_0x5df73c(0x1f8)](_0x56e5e0);}catch(_0xb81839){}if(_0x54c669[_0x5edf31['id']]&&_0x54c669[_0x5edf31['id']]===_0x3f6bc1||_0x56e5e0[_0x5edf31['id']]&&_0x56e5e0[_0x5edf31['id']]===_0x20f1e6)_0x4449e4=_0x5df73c(0x224),_0x3e75a9=!![];else(_0x3f6bc1||_0x20f1e6)&&(_0x4449e4='Auto-Erkennung');_0x1f6b32[_0x5df73c(0x23c)]({'room':_0x5edf31['location']||'Unbekannt','sensorId':_0x5edf31['id'],'setpointId':_0x3f6bc1||'-','valveId':_0x20f1e6||'-','source':_0x4449e4,'isManual':_0x3e75a9,'status':_0x3f6bc1&&_0x20f1e6?_0x5df73c(0x21e):_0x3f6bc1?'OK':_0x5df73c(0x1a5)});}return _0x1f6b32[_0x5df73c(0x214)]((_0x205d42,_0x45dd66)=>_0x205d42[_0x5df73c(0x1a9)]['localeCompare'](_0x45dd66[_0x5df73c(0x1a9)]));}async function updateSchedulePreview(_0x130e85){const _0x4ca13c=a1_0x43366d;if(!_0x130e85['config']['useCalendar']||!_0x130e85[_0x4ca13c(0x254)]['calendarInstance'])return;let _0x197dcd={};try{const _0x2018c0=await _0x130e85[_0x4ca13c(0x1ab)]('analysis.energy.warmupTimes');if(_0x2018c0&&_0x2018c0[_0x4ca13c(0x221)])_0x197dcd=JSON['parse'](_0x2018c0['val']);}catch(_0x50cfc3){}const _0x46ac80=[],_0x42a52e=Date[_0x4ca13c(0x252)](),_0x13a6ae=0x30*0x3c*0x3c*0x3e8;try{const _0xcc61d7=await _0x130e85[_0x4ca13c(0x1dd)](_0x130e85['config'][_0x4ca13c(0x1e0)]+_0x4ca13c(0x1ae));if(!_0xcc61d7||!_0xcc61d7[_0x4ca13c(0x221)])return;const _0x13c4f3=JSON[_0x4ca13c(0x1f8)](_0xcc61d7[_0x4ca13c(0x221)]),_0x32c701=_0x130e85['config'][_0x4ca13c(0x20c)]||[],_0x4abaf9=_0x130e85[_0x4ca13c(0x254)][_0x4ca13c(0x211)]||[],_0x3ee3ba=new Set();_0x4abaf9['forEach'](_0x3cf860=>{const _0x1f14d4=_0x4ca13c;if(_0x3cf860[_0x1f14d4(0x1d7)])_0x3ee3ba['add'](_0x3cf860[_0x1f14d4(0x1d7)]);});for(const _0x2f7bde of _0x13c4f3){if(_0x2f7bde[_0x4ca13c(0x21d)]&&_0x32c701[_0x4ca13c(0x23f)]>0x0&&!_0x32c701[_0x4ca13c(0x1be)](_0x2f7bde[_0x4ca13c(0x21d)]))continue;const _0x4d134d=_0x2f7bde[_0x4ca13c(0x1b6)]||_0x2f7bde[_0x4ca13c(0x1fd)]||_0x2f7bde['date'];if(!_0x4d134d)continue;const _0x50a166=new Date(_0x4d134d),_0x358156=_0x50a166[_0x4ca13c(0x22c)]();if(isNaN(_0x358156))continue;if(_0x358156<_0x42a52e)continue;if(_0x358156>_0x42a52e+_0x13a6ae)continue;const _0x38fdbc=(_0x2f7bde['event']||_0x2f7bde[_0x4ca13c(0x203)]||'')[_0x4ca13c(0x1aa)]();let _0x32949c=![],_0x4473ee=[],_0x2391ce=_0x2f7bde[_0x4ca13c(0x1ef)]||_0x2f7bde[_0x4ca13c(0x203)]||_0x4ca13c(0x23d);if(_0x38fdbc['includes'](_0x4ca13c(0x22a))||_0x38fdbc['includes'](_0x4ca13c(0x222))||_0x38fdbc['includes'](_0x4ca13c(0x1cb)))_0x32949c=!![],_0x4473ee=Array[_0x4ca13c(0x1b5)](_0x3ee3ba);else for(const _0x330b29 of _0x3ee3ba){if(_0x38fdbc[_0x4ca13c(0x1be)](_0x330b29['toLowerCase']()))_0x4473ee[_0x4ca13c(0x23c)](_0x330b29);}_0x4473ee[_0x4ca13c(0x23f)]>0x0&&_0x4473ee[_0x4ca13c(0x20e)](_0x4b7449=>{const _0x18e76e=_0x4ca13c;let _0x21f9b6=0x3c;if(_0x32949c){let _0x39961f=0x0;Object['values'](_0x197dcd)[_0x18e76e(0x20e)](_0xc44b40=>{if(_0xc44b40>_0x39961f)_0x39961f=_0xc44b40;}),_0x21f9b6=_0x39961f>0x0?_0x39961f:0x78;}else _0x21f9b6=_0x197dcd[_0x4b7449]||0x3c;const _0x389330=new Date(_0x358156-_0x21f9b6*0xea60);_0x46ac80[_0x18e76e(0x23c)]({'eventTime':_0x358156,'triggerTime':_0x389330[_0x18e76e(0x22c)](),'room':_0x4b7449,'minutes':_0x21f9b6,'reason':_0x2391ce,'isGlobal':_0x32949c});});}}catch(_0x13299c){}_0x46ac80[_0x4ca13c(0x214)]((_0x250fb2,_0x154094)=>_0x250fb2[_0x4ca13c(0x1d2)]-_0x154094[_0x4ca13c(0x1d2)]);const _0x1a68a7=_0x46ac80[_0x4ca13c(0x1ba)](0x0,0x5);await _0x130e85[_0x4ca13c(0x1e4)](_0x4ca13c(0x1ec),{'val':JSON['stringify'](_0x1a68a7),'ack':!![]});}async function checkCalendarTriggers(_0x59288a){const _0x31a8f1=a1_0x43366d;if(!_0x59288a[_0x31a8f1(0x254)][_0x31a8f1(0x1cf)]||!_0x59288a[_0x31a8f1(0x254)]['calendarInstance'])return;await updateSchedulePreview(_0x59288a);let _0x56b18a={},_0x16afbe={};try{const _0x1e617a=await _0x59288a[_0x31a8f1(0x1ab)](_0x31a8f1(0x216));if(_0x1e617a&&_0x1e617a['val'])_0x56b18a=JSON[_0x31a8f1(0x1f8)](_0x1e617a[_0x31a8f1(0x221)]);const _0x26bb2e=await _0x59288a['getStateAsync'](_0x31a8f1(0x1d1));if(_0x26bb2e&&_0x26bb2e['val'])_0x16afbe=JSON[_0x31a8f1(0x1f8)](_0x26bb2e[_0x31a8f1(0x221)]);}catch(_0x1f75f5){}let _0x32b492={'default':0x15};try{const _0x18d409=await _0x59288a[_0x31a8f1(0x1ab)]('analysis.energy.warmupTargets');if(_0x18d409&&_0x18d409[_0x31a8f1(0x221)])_0x32b492=JSON['parse'](_0x18d409[_0x31a8f1(0x221)]);}catch(_0x4f44c8){}try{const _0x574184=await _0x59288a[_0x31a8f1(0x1dd)](_0x59288a[_0x31a8f1(0x254)][_0x31a8f1(0x1e0)]+'.data.table');if(!_0x574184||!_0x574184['val'])return;const _0x250eab=JSON[_0x31a8f1(0x1f8)](_0x574184[_0x31a8f1(0x221)]),_0x1dc716=Date[_0x31a8f1(0x252)](),_0xe4d933=_0x59288a[_0x31a8f1(0x254)][_0x31a8f1(0x211)]||[],_0x5b64fa=_0x59288a[_0x31a8f1(0x254)][_0x31a8f1(0x20c)]||[];for(const _0x329cc9 of _0x250eab){if(_0x329cc9[_0x31a8f1(0x21d)]&&_0x5b64fa[_0x31a8f1(0x23f)]>0x0&&!_0x5b64fa['includes'](_0x329cc9[_0x31a8f1(0x21d)]))continue;const _0x372842=_0x329cc9[_0x31a8f1(0x1b6)]||_0x329cc9[_0x31a8f1(0x1fd)]||_0x329cc9[_0x31a8f1(0x1d3)];if(!_0x372842)continue;const _0x416b11=new Date(_0x372842);if(isNaN(_0x416b11[_0x31a8f1(0x22c)]()))continue;const _0x3a5639=(_0x329cc9[_0x31a8f1(0x1ef)]||_0x329cc9[_0x31a8f1(0x203)]||'')[_0x31a8f1(0x1aa)]();if(_0x3a5639[_0x31a8f1(0x1be)](_0x31a8f1(0x22a))||_0x3a5639[_0x31a8f1(0x1be)](_0x31a8f1(0x222))||_0x3a5639[_0x31a8f1(0x1be)](_0x31a8f1(0x1cb))){let _0x1e4459=0x0;Object[_0x31a8f1(0x20a)](_0x56b18a)[_0x31a8f1(0x20e)](_0x223526=>{if(_0x223526>_0x1e4459)_0x1e4459=_0x223526;});if(_0x1e4459===0x0)_0x1e4459=0x78;const _0x5023df=_0x416b11[_0x31a8f1(0x22c)]()-_0x1e4459*0xea60;_0x1dc716>=_0x5023df&&_0x1dc716<_0x416b11[_0x31a8f1(0x22c)]()&&(_0x59288a['currentSystemMode']!==_0x31a8f1(0x1c4)&&(_0x59288a[_0x31a8f1(0x22e)][_0x31a8f1(0x1e5)](_0x31a8f1(0x226)+_0x1e4459+'\x20min).'),await _0x59288a[_0x31a8f1(0x1e4)](_0x31a8f1(0x238),{'val':_0x31a8f1(0x1c4),'ack':![]})));}for(const _0x843c88 of _0xe4d933){if(_0x843c88[_0x31a8f1(0x1d7)]){const _0x41beed=_0x843c88[_0x31a8f1(0x1d7)]['toLowerCase']();if(_0x3a5639[_0x31a8f1(0x1be)](_0x41beed)){const _0x1ab867=_0x56b18a[_0x843c88[_0x31a8f1(0x1d7)]]||0x3c,_0x76dca7=_0x16afbe[_0x843c88['location']]||'Classic',_0x1ea1e8=_0x416b11[_0x31a8f1(0x22c)]()-_0x1ab867*0xea60;if(_0x1dc716>=_0x1ea1e8&&_0x1dc716<_0x416b11[_0x31a8f1(0x22c)]()){const _0x4ad6f8=lastActions[_0x31a8f1(0x241)+_0x843c88[_0x31a8f1(0x1d7)]];if(_0x4ad6f8&&_0x1dc716-_0x4ad6f8<CAL_COOLDOWN_MS)continue;const _0x5e0d5d=await findRelatedId(_0x59288a,_0x843c88['id'],'setpoint');if(_0x5e0d5d){let _0x559556=_0x32b492[_0x843c88[_0x31a8f1(0x1d7)]];if(_0x559556===undefined)_0x559556=_0x32b492[_0x31a8f1(0x1d6)];if(_0x559556===undefined)_0x559556=0x15;const _0x55cf21=await _0x59288a[_0x31a8f1(0x1dd)](_0x5e0d5d);_0x55cf21&&typeof _0x55cf21[_0x31a8f1(0x221)]===_0x31a8f1(0x215)&&_0x55cf21[_0x31a8f1(0x221)]<_0x559556-0.5&&(_0x59288a[_0x31a8f1(0x22e)]['info'](_0x31a8f1(0x21b)+_0x76dca7+_0x31a8f1(0x24d)+_0x843c88[_0x31a8f1(0x1d7)]+_0x31a8f1(0x253)+_0x559556+_0x31a8f1(0x246)+_0x1ab867+'\x20min).'),await _0x59288a[_0x31a8f1(0x212)](_0x5e0d5d,_0x559556),await logAutomationAction(_0x59288a,_0x31a8f1(0x1bb)+_0x843c88[_0x31a8f1(0x1d7)]+'\x20->\x20'+_0x559556+'Â°C\x20(via\x20'+_0x76dca7+')'),lastActions[_0x31a8f1(0x241)+_0x843c88['location']]=_0x1dc716);}}}}}}}catch(_0x206adf){_0x59288a[_0x31a8f1(0x22e)][_0x31a8f1(0x21a)](_0x31a8f1(0x1d8)+_0x206adf['message']);}}async function manageMpcIntervention(_0x1d45aa,_0x45c1c0,_0x1bbc8a){const _0x5c7005=a1_0x43366d;try{const _0x1c7b25=_0x5c7005(0x1a4),_0x3d8295=await _0x1d45aa['getStateAsync'](_0x1c7b25);let _0x5541b1=[];if(_0x3d8295&&_0x3d8295[_0x5c7005(0x221)])try{_0x5541b1=JSON['parse'](_0x3d8295[_0x5c7005(0x221)]);}catch(_0xc535da){}const _0x5057a8=_0x5541b1['indexOf'](_0x45c1c0);if(_0x1bbc8a===_0x5c7005(0x1c2))_0x5057a8===-0x1&&(_0x5541b1[_0x5c7005(0x23c)](_0x45c1c0),await _0x1d45aa[_0x5c7005(0x1e4)](_0x1c7b25,{'val':JSON[_0x5c7005(0x1e8)](_0x5541b1),'ack':!![]}));else _0x1bbc8a==='remove'&&(_0x5057a8!==-0x1&&(_0x5541b1[_0x5c7005(0x1de)](_0x5057a8,0x1),await _0x1d45aa[_0x5c7005(0x1e4)](_0x1c7b25,{'val':JSON[_0x5c7005(0x1e8)](_0x5541b1),'ack':!![]})));}catch(_0x7eb09b){}}async function cleanupGhostInterventions(_0x24454a){const _0x2ecbce=a1_0x43366d;try{const _0x53f5a0=_0x2ecbce(0x1a4),_0x750ee4=await _0x24454a[_0x2ecbce(0x1ab)](_0x53f5a0);if(!_0x750ee4||!_0x750ee4[_0x2ecbce(0x221)])return;const _0x2c4b1f=JSON[_0x2ecbce(0x1f8)](_0x750ee4[_0x2ecbce(0x221)]);if(!Array['isArray'](_0x2c4b1f)||_0x2c4b1f[_0x2ecbce(0x23f)]===0x0)return;let _0x28435f={'default':0x15};try{const _0x58d974=await _0x24454a[_0x2ecbce(0x1ab)]('analysis.energy.warmupTargets');if(_0x58d974&&_0x58d974[_0x2ecbce(0x221)])_0x28435f=JSON['parse'](_0x58d974[_0x2ecbce(0x221)]);}catch(_0x4381c8){}let _0x2948e6=[];try{const _0x4c0e01=await _0x24454a[_0x2ecbce(0x1ab)](_0x2ecbce(0x1ce));if(_0x4c0e01&&_0x4c0e01[_0x2ecbce(0x221)])_0x2948e6=JSON[_0x2ecbce(0x1f8)](_0x4c0e01[_0x2ecbce(0x221)]);}catch(_0x5b663d){}const _0x426b68=_0x24454a[_0x2ecbce(0x254)][_0x2ecbce(0x211)]||[];let _0x58f316=![];for(let _0x125a39=_0x2c4b1f['length']-0x1;_0x125a39>=0x0;_0x125a39--){const _0x3c8acd=_0x2c4b1f[_0x125a39],_0x5ed2e4=_0x426b68[_0x2ecbce(0x1b2)](_0x5d92f9=>normalize(_0x5d92f9[_0x2ecbce(0x1d7)])===normalize(_0x3c8acd)&&(_0x5d92f9[_0x2ecbce(0x1bf)]===_0x2ecbce(0x232)||_0x5d92f9[_0x2ecbce(0x1bf)]===_0x2ecbce(0x1bc)));if(!_0x5ed2e4){_0x24454a[_0x2ecbce(0x22e)][_0x2ecbce(0x21a)](_0x2ecbce(0x20b)+_0x3c8acd+_0x2ecbce(0x24a)),_0x2c4b1f[_0x2ecbce(0x1de)](_0x125a39,0x1),_0x58f316=!![];continue;}if(_0x5ed2e4){const _0x1da9a0=await findRelatedId(_0x24454a,_0x5ed2e4['id'],_0x2ecbce(0x209)),_0x19ecd2=await _0x24454a[_0x2ecbce(0x1dd)](_0x5ed2e4['id']);if(_0x1da9a0){const _0x580f4d=await _0x24454a[_0x2ecbce(0x1dd)](_0x1da9a0);if(_0x580f4d&&typeof _0x580f4d[_0x2ecbce(0x221)]===_0x2ecbce(0x215)){let _0x5b96f9=![],_0x160f9a='';Math[_0x2ecbce(0x1df)](_0x580f4d[_0x2ecbce(0x221)]-ECO_TEMP)>0.5&&(_0x5b96f9=!![],_0x160f9a=_0x2ecbce(0x250));if(!_0x5b96f9&&_0x19ecd2&&typeof _0x19ecd2['val']==='number'){const _0x17aa36=_0x28435f[_0x3c8acd]||_0x28435f[_0x2ecbce(0x1d6)]||0x15;_0x19ecd2[_0x2ecbce(0x221)]<_0x17aa36+0.2&&(_0x5b96f9=!![],_0x160f9a=_0x2ecbce(0x248));}if(_0x5b96f9){if(_0x160f9a===_0x2ecbce(0x250)){_0x24454a['log'][_0x2ecbce(0x1e5)](_0x2ecbce(0x22f)+_0x3c8acd+_0x2ecbce(0x1c3)+_0x580f4d[_0x2ecbce(0x221)]+_0x2ecbce(0x1da)+ECO_TEMP+_0x2ecbce(0x1fa));const _0x22bfc9=lastActions[_0x2ecbce(0x241)+_0x3c8acd],_0x151fc1=_0x22bfc9&&Date['now']()-_0x22bfc9<0x2*0x3c*0x3e8;if(!_0x151fc1&&_0x580f4d[_0x2ecbce(0x221)]>ECO_TEMP+0.5)_0x24454a[_0x2ecbce(0x204)]&&(_0x24454a[_0x2ecbce(0x22e)][_0x2ecbce(0x1e5)](_0x2ecbce(0x1ee)+_0x3c8acd+'\x20wurde\x20manuell\x20erhÃ¶ht.'),_0x24454a['sendToPythonWrapper'](_0x2ecbce(0x1f4),{'room':_0x3c8acd}));else _0x151fc1&&_0x24454a[_0x2ecbce(0x22e)][_0x2ecbce(0x1e5)](_0x2ecbce(0x24c)+_0x3c8acd+_0x2ecbce(0x245));}else{if(_0x160f9a==='too_cold'){let _0x470716=![];if(_0x2948e6['find'](_0x54ca25=>_0x54ca25[_0x2ecbce(0x1a9)]===_0x3c8acd))_0x470716=!![];const _0x458ff0=_0x426b68['filter'](_0xe8b09a=>normalize(_0xe8b09a[_0x2ecbce(0x1d7)])===normalize(_0x3c8acd)&&(_0xe8b09a[_0x2ecbce(0x1bf)]===_0x2ecbce(0x247)||_0xe8b09a['type']===_0x2ecbce(0x1c6)||_0xe8b09a['type']===_0x2ecbce(0x239)));for(const _0x4fd588 of _0x458ff0){try{const _0xa133ad=await _0x24454a[_0x2ecbce(0x1dd)](_0x4fd588['id']);if(_0xa133ad&&(_0xa133ad['val']===!![]||_0xa133ad[_0x2ecbce(0x221)]===0x1||String(_0xa133ad['val'])['toLowerCase']()===_0x2ecbce(0x1e3)))_0x470716=!![];}catch(_0x8219b4){}}if(_0x470716)_0x24454a['log'][_0x2ecbce(0x1e5)](_0x2ecbce(0x206)+_0x3c8acd+_0x2ecbce(0x21c));else{const _0x27a4f2=_0x28435f[_0x3c8acd]||_0x28435f[_0x2ecbce(0x1d6)]||0x15;_0x24454a['log'][_0x2ecbce(0x1e5)](_0x2ecbce(0x23b)+_0x3c8acd+_0x2ecbce(0x1e7)+_0x19ecd2[_0x2ecbce(0x221)]+'Â°C\x20<\x20'+(_0x27a4f2+0.2)+_0x2ecbce(0x1c5)),await _0x24454a[_0x2ecbce(0x212)](_0x1da9a0,_0x27a4f2),await logAutomationAction(_0x24454a,_0x2ecbce(0x1a6)+_0x3c8acd+_0x2ecbce(0x1ac)+_0x27a4f2+'Â°C'),lastActions[_0x2ecbce(0x1b8)+_0x3c8acd]=Date[_0x2ecbce(0x252)]();}}}_0x2c4b1f[_0x2ecbce(0x1de)](_0x125a39,0x1),_0x58f316=!![];}}}}}_0x58f316&&await _0x24454a[_0x2ecbce(0x1e4)](_0x53f5a0,{'val':JSON[_0x2ecbce(0x1e8)](_0x2c4b1f),'ack':!![]});}catch(_0x204baf){}}async function applyEnergySavings(_0x1a03e8,_0x317fb8){const _0x2836b2=a1_0x43366d;await cleanupGhostInterventions(_0x1a03e8);if(!_0x317fb8||_0x317fb8[_0x2836b2(0x23f)]===0x0)return;const _0x371e00=_0x1a03e8[_0x2836b2(0x254)][_0x2836b2(0x211)]||[],_0x23c771=Date[_0x2836b2(0x252)]();for(const _0x367d37 of _0x317fb8){const _0x4df06d=_0x367d37['room'],_0x58d564=_0x367d37['minutes_safe'],_0x257ff7=_0x367d37[_0x2836b2(0x217)]||0x15;if(lastActions[_0x2836b2(0x1b8)+_0x4df06d]&&_0x23c771-lastActions[_0x2836b2(0x1b8)+_0x4df06d]<RESCUE_LOCK_MS)continue;const _0x2166cd=_0x371e00['find'](_0x39ee7c=>normalize(_0x39ee7c['location'])===normalize(_0x4df06d)&&(_0x39ee7c['type']==='temperature'||_0x39ee7c['type']==='thermostat'));if(!_0x2166cd)continue;const _0x39e549=await findRelatedId(_0x1a03e8,_0x2166cd['id'],_0x2836b2(0x209));if(_0x39e549){if(lastActions[_0x2836b2(0x236)+_0x4df06d]&&_0x23c771-lastActions[_0x2836b2(0x236)+_0x4df06d]<0x1e*0x3c*0x3e8)continue;const _0x2e4a3a=await _0x1a03e8['getForeignStateAsync'](_0x39e549);if(_0x2e4a3a&&typeof _0x2e4a3a[_0x2836b2(0x221)]==='number'){const _0x1cac3a=_0x2e4a3a['val'];_0x1cac3a!==ECO_TEMP&&await manageMpcIntervention(_0x1a03e8,_0x4df06d,_0x2836b2(0x229));if(_0x58d564>0x1e)_0x1cac3a>ECO_TEMP+0.5&&(_0x1a03e8[_0x2836b2(0x22e)][_0x2836b2(0x1e5)](_0x2836b2(0x24b)+_0x4df06d+_0x2836b2(0x1d4)+ECO_TEMP+'Â°C!\x20(Puffer:\x20'+_0x58d564+_0x2836b2(0x1f0)),await _0x1a03e8[_0x2836b2(0x212)](_0x39e549,ECO_TEMP),await manageMpcIntervention(_0x1a03e8,_0x4df06d,_0x2836b2(0x1c2)),lastActions[_0x2836b2(0x236)+_0x4df06d]=_0x23c771,await logAutomationAction(_0x1a03e8,_0x2836b2(0x1fb)+_0x4df06d+_0x2836b2(0x1b1)+ECO_TEMP+'Â°C'));else _0x58d564<=0xf&&(_0x1cac3a<_0x257ff7&&(_0x1a03e8[_0x2836b2(0x22e)][_0x2836b2(0x1e5)](_0x2836b2(0x1b9)+_0x4df06d+'\x20wieder\x20auf\x20'+_0x257ff7+_0x2836b2(0x1f3)),await _0x1a03e8['setForeignStateAsync'](_0x39e549,_0x257ff7),await manageMpcIntervention(_0x1a03e8,_0x4df06d,_0x2836b2(0x229)),lastActions[_0x2836b2(0x236)+_0x4df06d]=_0x23c771,await logAutomationAction(_0x1a03e8,_0x2836b2(0x1fb)+_0x4df06d+':\x20Aufheizen\x20auf\x20'+_0x257ff7+'Â°C')));}}else _0x1a03e8[_0x2836b2(0x22e)][_0x2836b2(0x21a)](_0x2836b2(0x228)+_0x4df06d+_0x2836b2(0x23a));}}module['exports']={'handlePrediction':handlePrediction,'applyEnergySavings':applyEnergySavings,'scanThermostats':scanThermostats,'checkCalendarTriggers':checkCalendarTriggers,'updateSchedulePreview':updateSchedulePreview,'cleanupGhostInterventions':cleanupGhostInterventions};