const a1_0x164030=a1_0x1623;(function(_0x1db93e,_0x18cf7f){const _0x7c0728=a1_0x1623,_0x9ee39a=_0x1db93e();while(!![]){try{const _0x43b9e9=parseInt(_0x7c0728(0x1ec))/0x1+-parseInt(_0x7c0728(0x21b))/0x2+parseInt(_0x7c0728(0x1e8))/0x3+-parseInt(_0x7c0728(0x19b))/0x4*(-parseInt(_0x7c0728(0x197))/0x5)+-parseInt(_0x7c0728(0x1ca))/0x6*(-parseInt(_0x7c0728(0x20d))/0x7)+parseInt(_0x7c0728(0x201))/0x8+-parseInt(_0x7c0728(0x1df))/0x9*(parseInt(_0x7c0728(0x209))/0xa);if(_0x43b9e9===_0x18cf7f)break;else _0x9ee39a['push'](_0x9ee39a['shift']());}catch(_0x4ca204){_0x9ee39a['push'](_0x9ee39a['shift']());}}}(a1_0x1734,0xd0755));const a1_0x3c4089=(function(){let _0x1553d9=!![];return function(_0x314682,_0x236aca){const _0x2c60cc=_0x1553d9?function(){const _0x3d97df=a1_0x1623;if(_0x236aca){const _0x3bf868=_0x236aca[_0x3d97df(0x1c3)](_0x314682,arguments);return _0x236aca=null,_0x3bf868;}}:function(){};return _0x1553d9=![],_0x2c60cc;};}()),a1_0x494e24=a1_0x3c4089(this,function(){const _0x5c9fb3=a1_0x1623;return a1_0x494e24[_0x5c9fb3(0x1ba)]()['search'](_0x5c9fb3(0x217))[_0x5c9fb3(0x1ba)]()[_0x5c9fb3(0x1f2)](a1_0x494e24)[_0x5c9fb3(0x19f)](_0x5c9fb3(0x217));});a1_0x494e24();'use strict';const aiAgent=require(a1_0x164030(0x235)),COOLDOWN_MS=0x3c*0x3e8,CAL_COOLDOWN_MS=0x5a*0x3c*0x3e8,RESCUE_LOCK_MS=0x78*0x3c*0x3e8,ECO_TEMP=0x11,lastActions={};function normalize(_0x443ce1){const _0x2f9e8f=a1_0x164030;if(!_0x443ce1)return'';return _0x443ce1[_0x2f9e8f(0x22a)]()['replace'](/\s+/g,'')['trim']();}async function logAutomationAction(_0x3dca68,_0x4f5867){const _0x47ed3b=a1_0x164030;await _0x3dca68[_0x47ed3b(0x1a0)](_0x47ed3b(0x1a7),{'val':_0x4f5867,'ack':!![]});try{const _0x552f8e='analysis.automation.actionLog',_0x43752b=await _0x3dca68[_0x47ed3b(0x198)](_0x552f8e);let _0x3cc673=[];if(_0x43752b&&_0x43752b['val'])try{_0x3cc673=JSON[_0x47ed3b(0x1be)](_0x43752b[_0x47ed3b(0x1fa)]);}catch(_0x17ccac){}_0x3cc673['unshift']({'ts':Date[_0x47ed3b(0x1bd)](),'msg':_0x4f5867});if(_0x3cc673[_0x47ed3b(0x206)]>0x32)_0x3cc673=_0x3cc673['slice'](0x0,0x32);await _0x3dca68[_0x47ed3b(0x1a0)](_0x552f8e,{'val':JSON['stringify'](_0x3cc673),'ack':!![]});}catch(_0x42baa3){}}async function handlePrediction(_0x5a5407,_0x16cb60,_0x459909){const _0x224f35=a1_0x164030;if(!_0x16cb60||_0x16cb60===_0x224f35(0x1e0))return;let _0x330528='off',_0x42f48b=0.6;try{const _0x35b2b5=await _0x5a5407['getStateAsync'](_0x224f35(0x22f));if(_0x35b2b5&&_0x35b2b5[_0x224f35(0x1fa)])_0x330528=_0x35b2b5['val'];const _0x4ba48b=await _0x5a5407[_0x224f35(0x198)](_0x224f35(0x1fd));if(_0x4ba48b&&_0x4ba48b[_0x224f35(0x1fa)])_0x42f48b=_0x4ba48b[_0x224f35(0x1fa)];}catch(_0x5b45e4){}if(_0x330528===_0x224f35(0x213)||_0x459909<_0x42f48b)return;const _0x5764ef=Date[_0x224f35(0x1bd)]();if(lastActions[_0x16cb60]&&_0x5764ef-lastActions[_0x16cb60]<COOLDOWN_MS)return;const _0x3930b5=_0x5a5407[_0x224f35(0x222)]['devices']||[],_0x2d3a81=normalize(_0x16cb60),_0x4873f1=_0x3930b5[_0x224f35(0x1ce)](_0xe13202=>normalize(_0xe13202[_0x224f35(0x200)])===_0x2d3a81&&(_0xe13202[_0x224f35(0x1d1)]===_0x224f35(0x1ae)||_0xe13202['type']===_0x224f35(0x20e)||_0xe13202[_0x224f35(0x1d1)]===_0x224f35(0x211)));if(!_0x4873f1)return;const _0x3f2843=await aiAgent['consultButler'](_0x5a5407,_0x16cb60,_0x4873f1['name'],_0x459909);if(!_0x3f2843[_0x224f35(0x1d2)])return;const _0x2abc68=_0x224f35(0x219)+_0x16cb60+_0x224f35(0x230)+_0x4873f1[_0x224f35(0x204)]+'\x20('+_0x3f2843[_0x224f35(0x1c7)]+')';await logAutomationAction(_0x5a5407,'['+_0x330528[_0x224f35(0x20f)]()+']\x20'+_0x2abc68);if(_0x330528===_0x224f35(0x238)){const _0x40df9f=await _0x5a5407[_0x224f35(0x1a8)](_0x4873f1['id']);(!_0x40df9f||!_0x40df9f['val']&&_0x40df9f[_0x224f35(0x1fa)]!==!![])&&await _0x5a5407[_0x224f35(0x1a1)](_0x4873f1['id'],!![]),lastActions[_0x16cb60]=_0x5764ef;}}async function findRelatedId(_0x3ea076,_0x2b2dfd,_0x3658b4=a1_0x164030(0x1b5)){const _0x508a38=a1_0x164030;if(_0x3658b4===_0x508a38(0x1b5)&&_0x3ea076[_0x508a38(0x222)][_0x508a38(0x207)]){let _0x57b299=_0x3ea076[_0x508a38(0x222)][_0x508a38(0x207)];if(typeof _0x57b299===_0x508a38(0x1c1))try{_0x57b299=JSON[_0x508a38(0x1be)](_0x57b299);}catch(_0x537650){}if(_0x57b299&&_0x57b299[_0x2b2dfd])return _0x57b299[_0x2b2dfd];}if(_0x3658b4===_0x508a38(0x1ab)&&_0x3ea076[_0x508a38(0x222)][_0x508a38(0x233)]){let _0x5ac880=_0x3ea076[_0x508a38(0x222)][_0x508a38(0x233)];if(typeof _0x5ac880==='string')try{_0x5ac880=JSON[_0x508a38(0x1be)](_0x5ac880);}catch(_0x9f6eb2){}if(_0x5ac880&&_0x5ac880[_0x2b2dfd])return _0x5ac880[_0x2b2dfd];}let _0x5db587=[];if(_0x3658b4===_0x508a38(0x1b5))_0x5db587=[{'s':_0x508a38(0x1f7),'t':_0x508a38(0x1b7)},{'s':_0x508a38(0x1e2),'t':_0x508a38(0x1b7)},{'s':_0x508a38(0x1e2),'t':'.4.SET_TEMPERATURE'},{'s':_0x508a38(0x221),'t':_0x508a38(0x1fe)},{'s':_0x508a38(0x1b0),'t':_0x508a38(0x1cb)},{'s':_0x508a38(0x1b0),'t':_0x508a38(0x1b6)},{'s':_0x508a38(0x232),'t':_0x508a38(0x1d5)},{'s':'ACTUAL','t':'SET'},{'s':_0x508a38(0x23c),'t':_0x508a38(0x1c6)},{'s':_0x508a38(0x232),'t':'setpoint'}];else _0x3658b4===_0x508a38(0x1ab)&&(_0x5db587=[{'s':_0x508a38(0x1f7),'t':_0x508a38(0x1ee)},{'s':_0x508a38(0x1e2),'t':'.1.LEVEL'},{'s':_0x508a38(0x1e2),'t':_0x508a38(0x1a3)},{'s':'local_temperature','t':_0x508a38(0x1d9)},{'s':_0x508a38(0x232),'t':_0x508a38(0x225)},{'s':_0x508a38(0x232),'t':_0x508a38(0x1fc)}]);for(const _0x122dcd of _0x5db587){if(_0x2b2dfd[_0x508a38(0x1ac)](_0x122dcd['s'])){const _0x1ce959=_0x2b2dfd[_0x508a38(0x22d)](_0x122dcd['s'],_0x122dcd['t']),_0x2fcc9c=await _0x3ea076[_0x508a38(0x223)](_0x1ce959);if(_0x2fcc9c)return _0x1ce959;}}try{const _0x363373=_0x2b2dfd[_0x508a38(0x237)]('.');if(_0x363373[_0x508a38(0x206)]>0x2){const _0x584fac=_0x363373[_0x508a38(0x1d8)](0x0,-0x1)[_0x508a38(0x23e)]('.'),_0x270067=await _0x3ea076['getForeignObjectsAsync'](_0x584fac+'.*'),_0x47d64c=[],_0x5788c2=_0x2b2dfd[_0x508a38(0x237)](/[._]+/)[_0x508a38(0x1cd)](_0x52a25e=>![_0x508a38(0x1f3),'0',_0x508a38(0x21e),'ist',_0x508a38(0x20a),'temperature',_0x508a38(0x19e),_0x508a38(0x1c5),_0x508a38(0x1e4),_0x508a38(0x1c4)][_0x508a38(0x1ac)](_0x52a25e[_0x508a38(0x22a)]()));for(const [_0x4da730,_0xb47b76]of Object['entries'](_0x270067)){if(_0x4da730===_0x2b2dfd)continue;if(_0xb47b76&&_0xb47b76[_0x508a38(0x19d)]){const _0x1438d7=_0x4da730[_0x508a38(0x22a)](),_0x494beb=(_0xb47b76[_0x508a38(0x19d)]['role']||'')[_0x508a38(0x22a)](),_0x16f783=(_0xb47b76[_0x508a38(0x19d)]['unit']||'')['toLowerCase']();let _0x2ce3c6=![];if(_0x3658b4==='setpoint'&&_0xb47b76[_0x508a38(0x19d)]['write']===!![])_0x2ce3c6=_0x1438d7[_0x508a38(0x1ac)](_0x508a38(0x1db))||_0x1438d7[_0x508a38(0x1ac)](_0x508a38(0x196))||_0x1438d7[_0x508a38(0x1ac)](_0x508a38(0x1c9))||_0x494beb[_0x508a38(0x1ac)]('level.temperature')||_0x494beb['includes'](_0x508a38(0x224));else _0x3658b4===_0x508a38(0x1ab)&&(_0x2ce3c6=_0x1438d7[_0x508a38(0x1ac)](_0x508a38(0x1fc))||_0x1438d7[_0x508a38(0x1ac)](_0x508a38(0x1ab))||_0x1438d7[_0x508a38(0x1ac)](_0x508a38(0x23b))||_0x1438d7['includes']('position')||_0x494beb[_0x508a38(0x1ac)]('level.valve')||_0x494beb[_0x508a38(0x1ac)](_0x508a38(0x1b8))||_0x16f783[_0x508a38(0x1ac)]('%'));if(_0x2ce3c6){const _0x541e5f=_0x4da730[_0x508a38(0x237)](/[._]+/)[_0x508a38(0x1bb)](_0x9ebade=>_0x9ebade[_0x508a38(0x22a)]());let _0x713ad2=0x0;_0x5788c2['forEach'](_0x3c9851=>{const _0x15dc7d=_0x508a38;if(_0x541e5f[_0x15dc7d(0x1ac)](_0x3c9851[_0x15dc7d(0x22a)]()))_0x713ad2++;}),_0x47d64c[_0x508a38(0x1e6)]({'id':_0x4da730,'score':_0x713ad2});}}}if(_0x47d64c[_0x508a38(0x206)]>0x0){_0x47d64c['sort']((_0x5f4438,_0x530d59)=>_0x530d59[_0x508a38(0x23d)]-_0x5f4438[_0x508a38(0x23d)]);if(_0x47d64c[0x0]['score']>0x0)return _0x47d64c[0x0]['id'];}}}catch(_0x27e272){}return null;}async function scanThermostats(_0x2a15b2){const _0x1d108b=a1_0x164030,_0x2ae403=_0x2a15b2[_0x1d108b(0x222)][_0x1d108b(0x240)]||[],_0x51d568=[],_0x35b96b=_0x2ae403[_0x1d108b(0x1cd)](_0x3a24ea=>_0x3a24ea['id']&&_0x3a24ea['id'][_0x1d108b(0x1ac)]('temperature')||_0x3a24ea['type']&&[_0x1d108b(0x232),_0x1d108b(0x1d6),_0x1d108b(0x1c5)]['includes'](_0x3a24ea[_0x1d108b(0x1d1)])||_0x3a24ea[_0x1d108b(0x204)]&&_0x3a24ea['name'][_0x1d108b(0x22a)]()[_0x1d108b(0x1ac)]('temp'));for(const _0x246b5e of _0x35b96b){const _0x239cb1=await findRelatedId(_0x2a15b2,_0x246b5e['id'],_0x1d108b(0x1b5)),_0x37e092=await findRelatedId(_0x2a15b2,_0x246b5e['id'],_0x1d108b(0x1ab));let _0x29fc1d=_0x1d108b(0x1e7),_0x8e9ce2=![],_0x3e6fe2=_0x2a15b2[_0x1d108b(0x222)]['thermostatMapping']||{};if(typeof _0x3e6fe2===_0x1d108b(0x1c1))try{_0x3e6fe2=JSON[_0x1d108b(0x1be)](_0x3e6fe2);}catch(_0x1b4e58){}let _0x3195c1=_0x2a15b2[_0x1d108b(0x222)][_0x1d108b(0x233)]||{};if(typeof _0x3195c1===_0x1d108b(0x1c1))try{_0x3195c1=JSON[_0x1d108b(0x1be)](_0x3195c1);}catch(_0x32fa71){}if(_0x3e6fe2[_0x246b5e['id']]&&_0x3e6fe2[_0x246b5e['id']]===_0x239cb1||_0x3195c1[_0x246b5e['id']]&&_0x3195c1[_0x246b5e['id']]===_0x37e092)_0x29fc1d='Manuelles\x20Mapping',_0x8e9ce2=!![];else(_0x239cb1||_0x37e092)&&(_0x29fc1d=_0x1d108b(0x226));_0x51d568['push']({'room':_0x246b5e[_0x1d108b(0x200)]||_0x1d108b(0x214),'sensorId':_0x246b5e['id'],'setpointId':_0x239cb1||'-','valveId':_0x37e092||'-','source':_0x29fc1d,'isManual':_0x8e9ce2,'status':_0x239cb1&&_0x37e092?_0x1d108b(0x1af):_0x239cb1?'OK':'Fehlt'});}return _0x51d568[_0x1d108b(0x1ff)]((_0x2c4d73,_0xda784)=>_0x2c4d73[_0x1d108b(0x1f5)]['localeCompare'](_0xda784[_0x1d108b(0x1f5)]));}async function updateSchedulePreview(_0x4bcc7d){const _0x1c3d0d=a1_0x164030;if(!_0x4bcc7d[_0x1c3d0d(0x222)][_0x1c3d0d(0x227)]||!_0x4bcc7d[_0x1c3d0d(0x222)][_0x1c3d0d(0x1f4)])return;let _0x2c4d51={};try{const _0x61c4e5=await _0x4bcc7d[_0x1c3d0d(0x198)]('analysis.energy.warmupTimes');if(_0x61c4e5&&_0x61c4e5[_0x1c3d0d(0x1fa)])_0x2c4d51=JSON[_0x1c3d0d(0x1be)](_0x61c4e5[_0x1c3d0d(0x1fa)]);}catch(_0x13a822){}const _0x1cf960=[],_0x124eee=Date['now'](),_0x4b1589=0x30*0x3c*0x3c*0x3e8;try{const _0x3083a4=await _0x4bcc7d['getForeignStateAsync'](_0x4bcc7d['config'][_0x1c3d0d(0x1f4)]+_0x1c3d0d(0x20c));if(!_0x3083a4||!_0x3083a4[_0x1c3d0d(0x1fa)])return;const _0x4faaa4=JSON[_0x1c3d0d(0x1be)](_0x3083a4[_0x1c3d0d(0x1fa)]),_0x5dd475=_0x4bcc7d[_0x1c3d0d(0x222)][_0x1c3d0d(0x203)]||[],_0xe8d1f7=_0x4bcc7d[_0x1c3d0d(0x222)][_0x1c3d0d(0x240)]||[],_0x105c57=new Set();_0xe8d1f7[_0x1c3d0d(0x1f0)](_0x5af6db=>{const _0x5b0c01=_0x1c3d0d;if(_0x5af6db['location'])_0x105c57[_0x5b0c01(0x1e3)](_0x5af6db[_0x5b0c01(0x200)]);});for(const _0x43883e of _0x4faaa4){if(_0x43883e['_calName']&&_0x5dd475[_0x1c3d0d(0x206)]>0x0&&!_0x5dd475[_0x1c3d0d(0x1ac)](_0x43883e[_0x1c3d0d(0x1d7)]))continue;const _0x126021=_0x43883e[_0x1c3d0d(0x212)]||_0x43883e[_0x1c3d0d(0x23a)]||_0x43883e[_0x1c3d0d(0x228)];if(!_0x126021)continue;const _0x219408=new Date(_0x126021),_0x49813c=_0x219408[_0x1c3d0d(0x1d3)]();if(isNaN(_0x49813c))continue;if(_0x49813c<_0x124eee)continue;if(_0x49813c>_0x124eee+_0x4b1589)continue;const _0x477e95=(_0x43883e[_0x1c3d0d(0x19a)]||_0x43883e[_0x1c3d0d(0x1eb)]||'')[_0x1c3d0d(0x22a)]();let _0x2838f3=![],_0x1a81c1=[],_0x14c694=_0x43883e[_0x1c3d0d(0x19a)]||_0x43883e[_0x1c3d0d(0x1eb)]||'Unbekannt';if(_0x477e95['includes'](_0x1c3d0d(0x1a4))||_0x477e95[_0x1c3d0d(0x1ac)]('rÃ¼ckkehr')||_0x477e95[_0x1c3d0d(0x1ac)]('ankunft'))_0x2838f3=!![],_0x1a81c1=Array[_0x1c3d0d(0x208)](_0x105c57);else for(const _0x31020f of _0x105c57){if(_0x477e95[_0x1c3d0d(0x1ac)](_0x31020f[_0x1c3d0d(0x22a)]()))_0x1a81c1[_0x1c3d0d(0x1e6)](_0x31020f);}_0x1a81c1[_0x1c3d0d(0x206)]>0x0&&_0x1a81c1[_0x1c3d0d(0x1f0)](_0x6e077c=>{const _0x37db45=_0x1c3d0d;let _0x2f533a=0x3c;if(_0x2838f3){let _0x5f3bc8=0x0;Object[_0x37db45(0x229)](_0x2c4d51)['forEach'](_0x536966=>{if(_0x536966>_0x5f3bc8)_0x5f3bc8=_0x536966;}),_0x2f533a=_0x5f3bc8>0x0?_0x5f3bc8:0x78;}else _0x2f533a=_0x2c4d51[_0x6e077c]||0x3c;const _0x17fcb4=new Date(_0x49813c-_0x2f533a*0xea60);_0x1cf960['push']({'eventTime':_0x49813c,'triggerTime':_0x17fcb4[_0x37db45(0x1d3)](),'room':_0x6e077c,'minutes':_0x2f533a,'reason':_0x14c694,'isGlobal':_0x2838f3});});}}catch(_0x2db2cc){}_0x1cf960[_0x1c3d0d(0x1ff)]((_0x71005b,_0x21fe69)=>_0x71005b[_0x1c3d0d(0x1bc)]-_0x21fe69[_0x1c3d0d(0x1bc)]);const _0x4286f0=_0x1cf960['slice'](0x0,0x5);await _0x4bcc7d[_0x1c3d0d(0x1a0)]('analysis.energy.schedulePreview',{'val':JSON[_0x1c3d0d(0x1a2)](_0x4286f0),'ack':!![]});}async function checkCalendarTriggers(_0x32af1e){const _0x4f1c1f=a1_0x164030;if(!_0x32af1e[_0x4f1c1f(0x222)][_0x4f1c1f(0x227)]||!_0x32af1e[_0x4f1c1f(0x222)][_0x4f1c1f(0x1f4)])return;await updateSchedulePreview(_0x32af1e);let _0x73f3c0={},_0x4e90ea={};try{const _0x48ee04=await _0x32af1e['getStateAsync'](_0x4f1c1f(0x1e1));if(_0x48ee04&&_0x48ee04[_0x4f1c1f(0x1fa)])_0x73f3c0=JSON[_0x4f1c1f(0x1be)](_0x48ee04['val']);const _0x59f397=await _0x32af1e[_0x4f1c1f(0x198)](_0x4f1c1f(0x1fb));if(_0x59f397&&_0x59f397[_0x4f1c1f(0x1fa)])_0x4e90ea=JSON[_0x4f1c1f(0x1be)](_0x59f397[_0x4f1c1f(0x1fa)]);}catch(_0x2d1094){}let _0x4e721d={'default':0x15};try{const _0x46e834=await _0x32af1e[_0x4f1c1f(0x198)](_0x4f1c1f(0x1b9));if(_0x46e834&&_0x46e834[_0x4f1c1f(0x1fa)])_0x4e721d=JSON['parse'](_0x46e834[_0x4f1c1f(0x1fa)]);}catch(_0x1f43fa){}try{const _0x3d600e=await _0x32af1e[_0x4f1c1f(0x1a8)](_0x32af1e['config'][_0x4f1c1f(0x1f4)]+_0x4f1c1f(0x20c));if(!_0x3d600e||!_0x3d600e[_0x4f1c1f(0x1fa)])return;const _0x51ec8a=JSON[_0x4f1c1f(0x1be)](_0x3d600e[_0x4f1c1f(0x1fa)]),_0x255466=Date[_0x4f1c1f(0x1bd)](),_0x4f472e=_0x32af1e[_0x4f1c1f(0x222)][_0x4f1c1f(0x240)]||[],_0x4a2854=_0x32af1e[_0x4f1c1f(0x222)][_0x4f1c1f(0x203)]||[];for(const _0x164c13 of _0x51ec8a){if(_0x164c13[_0x4f1c1f(0x1d7)]&&_0x4a2854[_0x4f1c1f(0x206)]>0x0&&!_0x4a2854[_0x4f1c1f(0x1ac)](_0x164c13[_0x4f1c1f(0x1d7)]))continue;const _0x94aa8e=_0x164c13[_0x4f1c1f(0x212)]||_0x164c13[_0x4f1c1f(0x23a)]||_0x164c13[_0x4f1c1f(0x228)];if(!_0x94aa8e)continue;const _0x5e007c=new Date(_0x94aa8e);if(isNaN(_0x5e007c[_0x4f1c1f(0x1d3)]()))continue;const _0x136f83=(_0x164c13['event']||_0x164c13[_0x4f1c1f(0x1eb)]||'')[_0x4f1c1f(0x22a)]();if(_0x136f83[_0x4f1c1f(0x1ac)](_0x4f1c1f(0x1a4))||_0x136f83[_0x4f1c1f(0x1ac)](_0x4f1c1f(0x1ef))||_0x136f83['includes']('ankunft')){let _0x4e26ea=0x0;Object[_0x4f1c1f(0x229)](_0x73f3c0)[_0x4f1c1f(0x1f0)](_0x4123b6=>{if(_0x4123b6>_0x4e26ea)_0x4e26ea=_0x4123b6;});if(_0x4e26ea===0x0)_0x4e26ea=0x78;const _0x273c40=_0x5e007c[_0x4f1c1f(0x1d3)]()-_0x4e26ea*0xea60;_0x255466>=_0x273c40&&_0x255466<_0x5e007c[_0x4f1c1f(0x1d3)]()&&(_0x32af1e[_0x4f1c1f(0x1b1)]!=='normal'&&(_0x32af1e[_0x4f1c1f(0x22b)]['info'](_0x4f1c1f(0x234)+_0x4e26ea+'\x20min).'),await _0x32af1e[_0x4f1c1f(0x1a0)](_0x4f1c1f(0x199),{'val':_0x4f1c1f(0x1ad),'ack':![]})));}for(const _0x1883df of _0x4f472e){if(_0x1883df['location']){const _0x34948c=_0x1883df[_0x4f1c1f(0x200)][_0x4f1c1f(0x22a)]();if(_0x136f83['includes'](_0x34948c)){const _0x3d9c77=_0x73f3c0[_0x1883df['location']]||0x3c,_0x3da5f4=_0x4e90ea[_0x1883df[_0x4f1c1f(0x200)]]||'Classic',_0x51fc5d=_0x5e007c['getTime']()-_0x3d9c77*0xea60;if(_0x255466>=_0x51fc5d&&_0x255466<_0x5e007c[_0x4f1c1f(0x1d3)]()){const _0x1bd461=lastActions[_0x4f1c1f(0x1c0)+_0x1883df[_0x4f1c1f(0x200)]];if(_0x1bd461&&_0x255466-_0x1bd461<CAL_COOLDOWN_MS)continue;const _0x1519b3=await findRelatedId(_0x32af1e,_0x1883df['id'],'setpoint');if(_0x1519b3){let _0x5035d5=_0x4e721d[_0x1883df[_0x4f1c1f(0x200)]];if(_0x5035d5===undefined)_0x5035d5=_0x4e721d['default'];if(_0x5035d5===undefined)_0x5035d5=0x15;const _0x5507a0=await _0x32af1e['getForeignStateAsync'](_0x1519b3);_0x5507a0&&typeof _0x5507a0[_0x4f1c1f(0x1fa)]===_0x4f1c1f(0x195)&&_0x5507a0[_0x4f1c1f(0x1fa)]<_0x5035d5-0.5&&(_0x32af1e[_0x4f1c1f(0x22b)][_0x4f1c1f(0x231)](_0x4f1c1f(0x1a9)+_0x3da5f4+']:\x20Raum-Trigger\x20\x27'+_0x1883df[_0x4f1c1f(0x200)]+_0x4f1c1f(0x1dd)+_0x5035d5+_0x4f1c1f(0x1b2)+_0x3d9c77+_0x4f1c1f(0x236)),await _0x32af1e['setForeignStateAsync'](_0x1519b3,_0x5035d5),await logAutomationAction(_0x32af1e,'[CAL]\x20'+_0x1883df['location']+_0x4f1c1f(0x1a5)+_0x5035d5+_0x4f1c1f(0x19c)+_0x3da5f4+')'),lastActions[_0x4f1c1f(0x1c0)+_0x1883df[_0x4f1c1f(0x200)]]=_0x255466);}}}}}}}catch(_0x513229){_0x32af1e[_0x4f1c1f(0x22b)][_0x4f1c1f(0x1f9)](_0x4f1c1f(0x1aa)+_0x513229[_0x4f1c1f(0x20b)]);}}async function manageMpcIntervention(_0x25a61f,_0x480dd9,_0x5e43b1){const _0x49e467=a1_0x164030;try{const _0x5e1a6b=_0x49e467(0x22e),_0x1d603d=await _0x25a61f[_0x49e467(0x198)](_0x5e1a6b);let _0x1155bd=[];if(_0x1d603d&&_0x1d603d[_0x49e467(0x1fa)])try{_0x1155bd=JSON[_0x49e467(0x1be)](_0x1d603d[_0x49e467(0x1fa)]);}catch(_0x1cf99e){}const _0x4b5f4b=_0x1155bd[_0x49e467(0x1cc)](_0x480dd9);if(_0x5e43b1===_0x49e467(0x1e3))_0x4b5f4b===-0x1&&(_0x1155bd[_0x49e467(0x1e6)](_0x480dd9),await _0x25a61f[_0x49e467(0x1a0)](_0x5e1a6b,{'val':JSON[_0x49e467(0x1a2)](_0x1155bd),'ack':!![]}));else _0x5e43b1===_0x49e467(0x1d0)&&(_0x4b5f4b!==-0x1&&(_0x1155bd[_0x49e467(0x21d)](_0x4b5f4b,0x1),await _0x25a61f[_0x49e467(0x1a0)](_0x5e1a6b,{'val':JSON[_0x49e467(0x1a2)](_0x1155bd),'ack':!![]})));}catch(_0x3c9b16){}}function a1_0x1734(){const _0x11767c=['switch','_date','off','Unbekannt','ðŸŽ“\x20[RL-FEEDBACK]\x20Lerne\x20aus\x20Fehler:\x20','ðŸŒ¬ï¸\x20[MPC\x20WATCHDOG]\x20','(((.+)+)+)+$','\x20wieder\x20auf\x20','PrÃ¤diktion:\x20','ðŸš¨\x20[MPC\x20WATCHDOG]\x20','3032418mayIuE','window','splice','hm-rpc','Â°C!\x20(Puffer:\x20','\x20wurde\x20manuell\x20erhÃ¶ht.','ACTUAL_TEMPERATURE','config','getForeignObjectAsync','thermostat.setpoint','valve_position','Auto-Erkennung','useCalendar','date','values','toLowerCase','log','ðŸƒ\x20[MPC\x20ACTION]\x20Senke\x20','replace','analysis.energy.mpcActiveInterventions','analysis.automation.mode','\x20->\x20Schalte\x20','info','temperature','valveMapping','ðŸ“…\x20SMART\x20SCHEDULE\x20(Phase):\x20\x27Globaler\x20Start\x27\x20erkannt.\x20Heize\x20Haus\x20auf\x20(Vorlauf:\x20','./ai_agent','\x20min).','split','active','manual','eventStart','stellwert','Ist','score','join','isArray','devices','[MPC\x20WARNING]\x20Kein\x20Setpoint\x20fÃ¼r\x20','number','soll','230HIYWbH','getStateAsync','system.mode','event','47840RRahAy','Â°C\x20(via\x20','common','actual','search','setStateAsync','setForeignStateAsync','stringify','.4.VALVE_STATE','urlaub\x20ende','\x20->\x20','\x20durch\x20Kalender\x20geÃ¤ndert.\x20Keine\x20RL-Strafe.','analysis.automation.lastAction','getForeignStateAsync','ðŸ“…\x20SMART\x20SCHEDULE\x20[','Calendar\x20Check\x20Error:\x20','valve','includes','normal','light','PERFECT','local_temperature','currentSystemMode','Â°C\x20(Vorlauf:\x20','minutes_safe','mpc_','setpoint','current_heating_setpoint','.1.SET_POINT_TEMPERATURE','value.valve','analysis.energy.warmupTargets','toString','map','triggerTime','now','parse','\x20erreicht\x20Limit\x20(','cal_','string','[MPC]\x20','apply','state','sensor','Soll','reason',':\x20Aufheizen\x20auf\x20','target','6lQhuto','occupied_heating_setpoint','indexOf','filter','find','Â°C\x20(nicht\x20','remove','type','approved','getTime','exports','target_temperature','thermostat','_calName','slice','pi_heating_demand','\x20gefunden!','set','too_cold','\x27\x20aktiv.\x20Heize\x20auf\x20','rescue_','9NpojPK','Unknown','analysis.energy.warmupTimes','.1.TEMPERATURE','add','messwert','\x27\x20hat\x20kein\x20GerÃ¤t\x20mehr.\x20LÃ¶sche\x20Eintrag.','push','Nicht\x20gefunden','4469490hElSGm','open','ðŸ“…\x20[MPC\x20INFO]\x20','summary','171154FCvRTQ','ðŸ§¹\x20[MPC\x20CLEANUP]\x20','.1.LEVEL','rÃ¼ckkehr','forEach','TRAIN_RL_PENALTY','constructor','openknx','calendarInstance','room','analysis.energy.ventilationAlerts','.1.ACTUAL_TEMPERATURE','default','warn','val','analysis.energy.warmupSources','level','analysis.automation.confidenceThreshold','SET_POINT_TEMPERATURE','sort','location','7646184fSrWCS','ðŸ”¥\x20[MPC\x20ACTION]\x20Heize\x20','calendarSelection','name',':\x20Absenkung\x20auf\x20','length','thermostatMapping','from','18115190vZvsNI','wert','message','.data.table','7102592RtHmCw','dimmer','toUpperCase','\x20min)'];a1_0x1734=function(){return _0x11767c;};return a1_0x1734();}async function cleanupGhostInterventions(_0x2d4182){const _0x4db980=a1_0x164030;try{const _0x3413a9='analysis.energy.mpcActiveInterventions',_0x9d77e7=await _0x2d4182[_0x4db980(0x198)](_0x3413a9);if(!_0x9d77e7||!_0x9d77e7['val'])return;const _0x4b2d07=JSON[_0x4db980(0x1be)](_0x9d77e7[_0x4db980(0x1fa)]);if(!Array[_0x4db980(0x23f)](_0x4b2d07)||_0x4b2d07[_0x4db980(0x206)]===0x0)return;let _0x32b198={'default':0x15};try{const _0x145874=await _0x2d4182['getStateAsync'](_0x4db980(0x1b9));if(_0x145874&&_0x145874[_0x4db980(0x1fa)])_0x32b198=JSON['parse'](_0x145874[_0x4db980(0x1fa)]);}catch(_0x136030){}let _0x189927=[];try{const _0x5e2279=await _0x2d4182[_0x4db980(0x198)](_0x4db980(0x1f6));if(_0x5e2279&&_0x5e2279[_0x4db980(0x1fa)])_0x189927=JSON[_0x4db980(0x1be)](_0x5e2279[_0x4db980(0x1fa)]);}catch(_0x4a2bd1){}const _0x5d3a25=_0x2d4182[_0x4db980(0x222)]['devices']||[];let _0x3fe467=![];for(let _0x36e4b9=_0x4b2d07[_0x4db980(0x206)]-0x1;_0x36e4b9>=0x0;_0x36e4b9--){const _0x4dd2b0=_0x4b2d07[_0x36e4b9],_0x252897=_0x5d3a25['find'](_0x470aea=>normalize(_0x470aea[_0x4db980(0x200)])===normalize(_0x4dd2b0)&&(_0x470aea['type']===_0x4db980(0x232)||_0x470aea[_0x4db980(0x1d1)]===_0x4db980(0x1d6)));if(!_0x252897){_0x2d4182[_0x4db980(0x22b)][_0x4db980(0x1f9)]('ðŸ§¹\x20[MPC\x20CLEANUP]\x20Raum\x20\x27'+_0x4dd2b0+_0x4db980(0x1e5)),_0x4b2d07['splice'](_0x36e4b9,0x1),_0x3fe467=!![];continue;}if(_0x252897){const _0x364587=await findRelatedId(_0x2d4182,_0x252897['id'],'setpoint'),_0x431518=await _0x2d4182[_0x4db980(0x1a8)](_0x252897['id']);if(_0x364587){const _0x294dad=await _0x2d4182[_0x4db980(0x1a8)](_0x364587);if(_0x294dad&&typeof _0x294dad[_0x4db980(0x1fa)]===_0x4db980(0x195)){let _0x30355a=![],_0x373348='';Math['abs'](_0x294dad['val']-ECO_TEMP)>0.5&&(_0x30355a=!![],_0x373348=_0x4db980(0x239));if(!_0x30355a&&_0x431518&&typeof _0x431518[_0x4db980(0x1fa)]===_0x4db980(0x195)){const _0x44ccf7=_0x32b198[_0x4dd2b0]||_0x32b198['default']||0x15;_0x431518['val']<_0x44ccf7+0.2&&(_0x30355a=!![],_0x373348=_0x4db980(0x1dc));}if(_0x30355a){if(_0x373348===_0x4db980(0x239)){_0x2d4182[_0x4db980(0x22b)][_0x4db980(0x231)](_0x4db980(0x1ed)+_0x4dd2b0+'\x20ist\x20auf\x20'+_0x294dad[_0x4db980(0x1fa)]+_0x4db980(0x1cf)+ECO_TEMP+'Â°C).\x20Entferne\x20Status.');const _0x53f36d=lastActions['cal_'+_0x4dd2b0],_0x3a0298=_0x53f36d&&Date[_0x4db980(0x1bd)]()-_0x53f36d<0x2*0x3c*0x3e8;if(!_0x3a0298&&_0x294dad[_0x4db980(0x1fa)]>ECO_TEMP+0.5)_0x2d4182['sendToPythonWrapper']&&(_0x2d4182['log'][_0x4db980(0x231)](_0x4db980(0x215)+_0x4dd2b0+_0x4db980(0x220)),_0x2d4182['sendToPythonWrapper'](_0x4db980(0x1f1),{'room':_0x4dd2b0}));else _0x3a0298&&_0x2d4182[_0x4db980(0x22b)][_0x4db980(0x231)](_0x4db980(0x1ea)+_0x4dd2b0+_0x4db980(0x1a6));}else{if(_0x373348==='too_cold'){let _0x48e8c5=![];if(_0x189927[_0x4db980(0x1ce)](_0x4251d5=>_0x4251d5[_0x4db980(0x1f5)]===_0x4dd2b0))_0x48e8c5=!![];const _0x3f5b5f=_0x5d3a25[_0x4db980(0x1cd)](_0x298a2f=>normalize(_0x298a2f['location'])===normalize(_0x4dd2b0)&&(_0x298a2f['type']===_0x4db980(0x21c)||_0x298a2f[_0x4db980(0x1d1)]===_0x4db980(0x1c5)||_0x298a2f['type']==='contact'));for(const _0x323bbd of _0x3f5b5f){try{const _0x9344fe=await _0x2d4182[_0x4db980(0x1a8)](_0x323bbd['id']);if(_0x9344fe&&(_0x9344fe[_0x4db980(0x1fa)]===!![]||_0x9344fe['val']===0x1||String(_0x9344fe[_0x4db980(0x1fa)])[_0x4db980(0x22a)]()===_0x4db980(0x1e9)))_0x48e8c5=!![];}catch(_0x5a57cb){}}if(_0x48e8c5)_0x2d4182['log']['info'](_0x4db980(0x216)+_0x4dd2b0+'\x20ist\x20zu\x20kalt,\x20ABER\x20Fenster\x20offen/LÃ¼ftung\x20erkannt.\x20Heize\x20NICHT,\x20entferne\x20nur\x20Status.');else{const _0x78f3da=_0x32b198[_0x4dd2b0]||_0x32b198[_0x4db980(0x1f8)]||0x15;_0x2d4182[_0x4db980(0x22b)][_0x4db980(0x231)](_0x4db980(0x21a)+_0x4dd2b0+_0x4db980(0x1bf)+_0x431518['val']+'Â°C\x20<\x20'+(_0x78f3da+0.2)+'Â°C).\x20Sparmodus\x20beendet!'),await _0x2d4182['setForeignStateAsync'](_0x364587,_0x78f3da),await logAutomationAction(_0x2d4182,'[WATCHDOG]\x20'+_0x4dd2b0+':\x20Puffer\x20leer\x20->\x20Heizen\x20auf\x20'+_0x78f3da+'Â°C'),lastActions[_0x4db980(0x1de)+_0x4dd2b0]=Date['now']();}}}_0x4b2d07[_0x4db980(0x21d)](_0x36e4b9,0x1),_0x3fe467=!![];}}}}}_0x3fe467&&await _0x2d4182[_0x4db980(0x1a0)](_0x3413a9,{'val':JSON['stringify'](_0x4b2d07),'ack':!![]});}catch(_0x1f9885){}}function a1_0x1623(_0x2450ea,_0x3937fb){const _0x435cf0=a1_0x1734();return a1_0x1623=function(_0x494e24,_0x3c4089){_0x494e24=_0x494e24-0x195;let _0x17347b=_0x435cf0[_0x494e24];return _0x17347b;},a1_0x1623(_0x2450ea,_0x3937fb);}async function applyEnergySavings(_0x5e7dc0,_0x52cf65){const _0x3c3da7=a1_0x164030;await cleanupGhostInterventions(_0x5e7dc0);if(!_0x52cf65||_0x52cf65['length']===0x0)return;const _0x4006a2=_0x5e7dc0['config'][_0x3c3da7(0x240)]||[],_0x35f307=Date['now']();for(const _0x242b79 of _0x52cf65){const _0x408f7b=_0x242b79['room'],_0x3b8732=_0x242b79[_0x3c3da7(0x1b3)],_0x2bb140=_0x242b79[_0x3c3da7(0x1c9)]||0x15;if(lastActions['rescue_'+_0x408f7b]&&_0x35f307-lastActions['rescue_'+_0x408f7b]<RESCUE_LOCK_MS)continue;const _0x2acf16=_0x4006a2[_0x3c3da7(0x1ce)](_0x52178e=>normalize(_0x52178e[_0x3c3da7(0x200)])===normalize(_0x408f7b)&&(_0x52178e[_0x3c3da7(0x1d1)]===_0x3c3da7(0x232)||_0x52178e[_0x3c3da7(0x1d1)]===_0x3c3da7(0x1d6)));if(!_0x2acf16)continue;const _0x4ce918=await findRelatedId(_0x5e7dc0,_0x2acf16['id'],'setpoint');if(_0x4ce918){if(lastActions[_0x3c3da7(0x1b4)+_0x408f7b]&&_0x35f307-lastActions[_0x3c3da7(0x1b4)+_0x408f7b]<0x1e*0x3c*0x3e8)continue;const _0x2e65fc=await _0x5e7dc0['getForeignStateAsync'](_0x4ce918);if(_0x2e65fc&&typeof _0x2e65fc[_0x3c3da7(0x1fa)]==='number'){const _0x15b7d5=_0x2e65fc[_0x3c3da7(0x1fa)];_0x15b7d5!==ECO_TEMP&&await manageMpcIntervention(_0x5e7dc0,_0x408f7b,_0x3c3da7(0x1d0));if(_0x3b8732>0x1e)_0x15b7d5>ECO_TEMP+0.5&&(_0x5e7dc0[_0x3c3da7(0x22b)][_0x3c3da7(0x231)](_0x3c3da7(0x22c)+_0x408f7b+'\x20auf\x20'+ECO_TEMP+_0x3c3da7(0x21f)+_0x3b8732+_0x3c3da7(0x210)),await _0x5e7dc0['setForeignStateAsync'](_0x4ce918,ECO_TEMP),await manageMpcIntervention(_0x5e7dc0,_0x408f7b,_0x3c3da7(0x1e3)),lastActions[_0x3c3da7(0x1b4)+_0x408f7b]=_0x35f307,await logAutomationAction(_0x5e7dc0,_0x3c3da7(0x1c2)+_0x408f7b+_0x3c3da7(0x205)+ECO_TEMP+'Â°C'));else _0x3b8732<=0xf&&(_0x15b7d5<_0x2bb140&&(_0x5e7dc0[_0x3c3da7(0x22b)]['info'](_0x3c3da7(0x202)+_0x408f7b+_0x3c3da7(0x218)+_0x2bb140+'Â°C!\x20(Puffer\x20leer).'),await _0x5e7dc0[_0x3c3da7(0x1a1)](_0x4ce918,_0x2bb140),await manageMpcIntervention(_0x5e7dc0,_0x408f7b,_0x3c3da7(0x1d0)),lastActions['mpc_'+_0x408f7b]=_0x35f307,await logAutomationAction(_0x5e7dc0,_0x3c3da7(0x1c2)+_0x408f7b+_0x3c3da7(0x1c8)+_0x2bb140+'Â°C')));}}else _0x5e7dc0[_0x3c3da7(0x22b)][_0x3c3da7(0x1f9)](_0x3c3da7(0x241)+_0x408f7b+_0x3c3da7(0x1da));}}module[a1_0x164030(0x1d4)]={'handlePrediction':handlePrediction,'applyEnergySavings':applyEnergySavings,'scanThermostats':scanThermostats,'checkCalendarTriggers':checkCalendarTriggers,'updateSchedulePreview':updateSchedulePreview,'cleanupGhostInterventions':cleanupGhostInterventions};