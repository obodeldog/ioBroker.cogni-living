const a1_0x3bfdb1=a1_0x2fa3;(function(_0x48f1f6,_0x26da66){const _0x17c4e7=a1_0x2fa3,_0x762a25=_0x48f1f6();while(!![]){try{const _0x2219f3=-parseInt(_0x17c4e7(0x13a))/0x1+parseInt(_0x17c4e7(0x145))/0x2*(-parseInt(_0x17c4e7(0x132))/0x3)+-parseInt(_0x17c4e7(0x16f))/0x4*(-parseInt(_0x17c4e7(0x11f))/0x5)+parseInt(_0x17c4e7(0x13e))/0x6*(-parseInt(_0x17c4e7(0xf6))/0x7)+parseInt(_0x17c4e7(0x12c))/0x8*(-parseInt(_0x17c4e7(0x135))/0x9)+parseInt(_0x17c4e7(0xfb))/0xa+parseInt(_0x17c4e7(0x151))/0xb;if(_0x2219f3===_0x26da66)break;else _0x762a25['push'](_0x762a25['shift']());}catch(_0x14eb21){_0x762a25['push'](_0x762a25['shift']());}}}(a1_0x1e54,0x1ddd7));const a1_0x5aaeec=(function(){let _0x27044f=!![];return function(_0x135460,_0x298aac){const _0x1083fb=_0x27044f?function(){const _0x3d1b3a=a1_0x2fa3;if(_0x298aac){const _0x5894d3=_0x298aac[_0x3d1b3a(0x120)](_0x135460,arguments);return _0x298aac=null,_0x5894d3;}}:function(){};return _0x27044f=![],_0x1083fb;};}()),a1_0x3a6984=a1_0x5aaeec(this,function(){const _0x396976=a1_0x2fa3;return a1_0x3a6984['toString']()['search']('(((.+)+)+)+$')[_0x396976(0x15d)]()[_0x396976(0x16b)](a1_0x3a6984)[_0x396976(0x164)](_0x396976(0x16a));});a1_0x3a6984();'use strict';function a1_0x2fa3(_0x5d46c7,_0x9acb1c){const _0x33d90f=a1_0x1e54();return a1_0x2fa3=function(_0x3a6984,_0x5aaeec){_0x3a6984=_0x3a6984-0xf5;let _0x1e546f=_0x33d90f[_0x3a6984];return _0x1e546f;},a1_0x2fa3(_0x5d46c7,_0x9acb1c);}const aiAgent=require(a1_0x3bfdb1(0x10f)),COOLDOWN_MS=0x3c*0x3e8,lastActions={};function normalize(_0x2877a2){const _0x57f396=a1_0x3bfdb1;if(!_0x2877a2)return'';return _0x2877a2[_0x57f396(0x147)]()[_0x57f396(0x141)](/\s+/g,'')[_0x57f396(0x114)]();}async function handlePrediction(_0x28dfb2,_0x3cb012,_0x38d9d3){const _0x48a9c7=a1_0x3bfdb1;if(!_0x3cb012||_0x3cb012===_0x48a9c7(0x16c))return;let _0x3f808e=_0x48a9c7(0x176),_0x30dabf=0.6;try{const _0x52c701=await _0x28dfb2[_0x48a9c7(0x177)]('analysis.automation.mode');if(_0x52c701&&_0x52c701[_0x48a9c7(0xff)])_0x3f808e=_0x52c701[_0x48a9c7(0xff)];const _0x592d32=await _0x28dfb2[_0x48a9c7(0x177)](_0x48a9c7(0x15c));if(_0x592d32&&_0x592d32[_0x48a9c7(0xff)])_0x30dabf=_0x592d32['val'];}catch(_0x57c88c){}if(_0x3f808e===_0x48a9c7(0x176)||_0x38d9d3<_0x30dabf)return;const _0x4082b1=Date[_0x48a9c7(0x152)]();if(lastActions[_0x3cb012]&&_0x4082b1-lastActions[_0x3cb012]<COOLDOWN_MS)return;const _0x16d368=_0x28dfb2[_0x48a9c7(0x15a)][_0x48a9c7(0x15e)]||[],_0x12c690=normalize(_0x3cb012),_0x573042=_0x16d368[_0x48a9c7(0x126)](_0x5e49b7=>normalize(_0x5e49b7['location'])===_0x12c690&&(_0x5e49b7[_0x48a9c7(0x12d)]===_0x48a9c7(0x102)||_0x5e49b7[_0x48a9c7(0x12d)]==='dimmer'||_0x5e49b7[_0x48a9c7(0x12d)]==='switch'));if(!_0x573042){_0x28dfb2['log'][_0x48a9c7(0x129)](_0x48a9c7(0x139)+_0x3cb012+'\x27.');return;}const _0x1dcc87=await aiAgent[_0x48a9c7(0x128)](_0x28dfb2,_0x3cb012,_0x573042[_0x48a9c7(0x10e)],_0x38d9d3);if(!_0x1dcc87[_0x48a9c7(0x10b)])return;const _0x10b8c8=_0x48a9c7(0x142)+_0x3cb012+_0x48a9c7(0x13c)+_0x573042['name']+'\x20('+_0x1dcc87[_0x48a9c7(0x123)]+')';await _0x28dfb2[_0x48a9c7(0x13b)](_0x48a9c7(0x130),{'val':'['+_0x3f808e[_0x48a9c7(0x165)]()+']\x20'+_0x10b8c8,'ack':!![]});if(_0x3f808e===_0x48a9c7(0x153)){const _0x16d1dd=await _0x28dfb2[_0x48a9c7(0x117)](_0x573042['id']);(!_0x16d1dd||!_0x16d1dd[_0x48a9c7(0xff)]&&_0x16d1dd[_0x48a9c7(0xff)]!==!![])&&await _0x28dfb2[_0x48a9c7(0x133)](_0x573042['id'],!![]),lastActions[_0x3cb012]=_0x4082b1;}}async function findRelatedId(_0x4e6f84,_0x1af52c,_0x458ca9=a1_0x3bfdb1(0x178)){const _0x4be64b=a1_0x3bfdb1;if(_0x458ca9===_0x4be64b(0x178)&&_0x4e6f84[_0x4be64b(0x15a)]['thermostatMapping']){let _0x647178=_0x4e6f84[_0x4be64b(0x15a)][_0x4be64b(0x169)];if(typeof _0x647178===_0x4be64b(0x116))try{_0x647178=JSON[_0x4be64b(0x100)](_0x647178);}catch(_0x1b8865){}if(_0x647178&&_0x647178[_0x1af52c])return _0x647178[_0x1af52c];}if(_0x458ca9===_0x4be64b(0x11d)&&_0x4e6f84[_0x4be64b(0x15a)][_0x4be64b(0x110)]){let _0x521331=_0x4e6f84['config']['valveMapping'];if(typeof _0x521331===_0x4be64b(0x116))try{_0x521331=JSON[_0x4be64b(0x100)](_0x521331);}catch(_0x56b5ed){}if(_0x521331&&_0x521331[_0x1af52c])return _0x521331[_0x1af52c];}let _0x9e97f2=[];if(_0x458ca9===_0x4be64b(0x178))_0x9e97f2=[{'s':_0x4be64b(0x163),'t':_0x4be64b(0x108)},{'s':_0x4be64b(0x156),'t':_0x4be64b(0x108)},{'s':_0x4be64b(0x156),'t':'.4.SET_TEMPERATURE'},{'s':_0x4be64b(0x160),'t':_0x4be64b(0x11c)},{'s':_0x4be64b(0x105),'t':'occupied_heating_setpoint'},{'s':_0x4be64b(0x105),'t':'current_heating_setpoint'},{'s':'temperature','t':_0x4be64b(0x121)},{'s':_0x4be64b(0x14d),'t':'SET'},{'s':'Ist','t':_0x4be64b(0x12a)},{'s':_0x4be64b(0x124),'t':_0x4be64b(0x178)}];else _0x458ca9==='valve'&&(_0x9e97f2=[{'s':'.1.ACTUAL_TEMPERATURE','t':_0x4be64b(0x11a)},{'s':_0x4be64b(0x156),'t':_0x4be64b(0x11a)},{'s':'.1.TEMPERATURE','t':_0x4be64b(0x16e)},{'s':_0x4be64b(0x105),'t':_0x4be64b(0x12b)},{'s':_0x4be64b(0x124),'t':_0x4be64b(0x14a)},{'s':_0x4be64b(0x124),'t':_0x4be64b(0x14b)}]);for(const _0x4302a3 of _0x9e97f2){if(_0x1af52c['includes'](_0x4302a3['s'])){const _0x2d6b71=_0x1af52c[_0x4be64b(0x141)](_0x4302a3['s'],_0x4302a3['t']),_0x22b0db=await _0x4e6f84[_0x4be64b(0x148)](_0x2d6b71);if(_0x22b0db)return _0x2d6b71;}}try{const _0x2775f9=_0x1af52c[_0x4be64b(0x15b)]('.');if(_0x2775f9[_0x4be64b(0x115)]>0x2){const _0x198538=_0x2775f9[_0x4be64b(0x13d)](0x0,-0x1)[_0x4be64b(0x144)]('.'),_0x1b0e01=await _0x4e6f84[_0x4be64b(0x118)](_0x198538+'.*'),_0x128a14=[],_0x147983=_0x1af52c[_0x4be64b(0x15b)](/[._]+/)[_0x4be64b(0x10a)](_0x4b3675=>![_0x4be64b(0x158),'0','hm-rpc',_0x4be64b(0x167),_0x4be64b(0x137),_0x4be64b(0x124),_0x4be64b(0x149),_0x4be64b(0x131),_0x4be64b(0x103),'state'][_0x4be64b(0x12f)](_0x4b3675['toLowerCase']()));for(const [_0xfbbe8b,_0x246024]of Object[_0x4be64b(0x154)](_0x1b0e01)){if(_0xfbbe8b===_0x1af52c)continue;if(_0x246024&&_0x246024[_0x4be64b(0x15f)]){const _0x46bc68=_0xfbbe8b['toLowerCase'](),_0x6eee83=(_0x246024[_0x4be64b(0x15f)][_0x4be64b(0x122)]||'')[_0x4be64b(0x147)](),_0x189fca=(_0x246024['common']['unit']||'')['toLowerCase']();let _0x4f3d45=![];if(_0x458ca9===_0x4be64b(0x178)&&_0x246024[_0x4be64b(0x15f)]['write']===!![])_0x4f3d45=_0x46bc68['includes'](_0x4be64b(0x119))||_0x46bc68['includes'](_0x4be64b(0x109))||_0x46bc68['includes']('target')||_0x6eee83['includes'](_0x4be64b(0x13f))||_0x6eee83[_0x4be64b(0x12f)](_0x4be64b(0x134));else _0x458ca9===_0x4be64b(0x11d)&&(_0x4f3d45=_0x46bc68[_0x4be64b(0x12f)](_0x4be64b(0x14b))||_0x46bc68[_0x4be64b(0x12f)](_0x4be64b(0x11d))||_0x46bc68[_0x4be64b(0x12f)](_0x4be64b(0x174))||_0x46bc68[_0x4be64b(0x12f)](_0x4be64b(0xfa))||_0x6eee83['includes'](_0x4be64b(0x14f))||_0x6eee83[_0x4be64b(0x12f)](_0x4be64b(0x112))||_0x189fca[_0x4be64b(0x12f)]('%'));if(_0x4f3d45){const _0x596280=_0xfbbe8b[_0x4be64b(0x15b)](/[._]+/)[_0x4be64b(0x104)](_0x54373c=>_0x54373c[_0x4be64b(0x147)]());let _0x62bf26=0x0;_0x147983[_0x4be64b(0xf8)](_0x3aa768=>{const _0x52991d=_0x4be64b;if(_0x596280[_0x52991d(0x12f)](_0x3aa768[_0x52991d(0x147)]()))_0x62bf26++;}),_0x128a14['push']({'id':_0xfbbe8b,'score':_0x62bf26});}}}if(_0x128a14[_0x4be64b(0x115)]>0x0){_0x128a14[_0x4be64b(0x172)]((_0x1d6e4e,_0x5ccfe4)=>_0x5ccfe4['score']-_0x1d6e4e['score']);if(_0x128a14[0x0][_0x4be64b(0x125)]>0x0)return _0x128a14[0x0]['id'];}}}catch(_0x4a8d7a){}return null;}function a1_0x1e54(){const _0xd03894=['parse','[MPC]\x20','light','messwert','map','local_temperature','calendarSelection','localeCompare','.1.SET_POINT_TEMPERATURE','soll','filter','approved','analysis.energy.warmupTimes','Manuelles\x20Mapping','name','./ai_agent','valveMapping','warn','value.valve','event','trim','length','string','getForeignStateAsync','getForeignObjectsAsync','set','.1.LEVEL','location','SET_POINT_TEMPERATURE','valve','minutes_safe','285HzBans','apply','target_temperature','role','reason','temperature','score','find','number','consultButler','debug','Soll','pi_heating_demand','56ShLEfP','type','useCalendar','includes','analysis.automation.lastAction','sensor','6qNilvv','setForeignStateAsync','thermostat.setpoint','274437WfpEGw','\x27\x20erkannt\x20(','wert','temp','ðŸ”\x20Device-Search\x20failed\x20for\x20predicted\x20room\x20\x27','124671wrSBDB','setStateAsync','\x20->\x20Schalte\x20','slice','204708dXhxqT','level.temperature','ðŸ“…\x20SMART\x20SCHEDULE:\x20\x27Globaler\x20Start\x27\x20erkannt\x20(','replace','PrÃ¤diktion:\x20','Nicht\x20gefunden','join','133266SUrxxD','mpc_','toLowerCase','getForeignObjectAsync','actual','valve_position','level','_calName','ACTUAL',').\x20Heize\x20auf\x2021Â°C\x20(Vorlauf:\x20','level.valve','log','4627458aNeBCU','now','active','entries','Fehlt','.1.TEMPERATURE','normal','openknx','ðŸƒ\x20MPC\x20Autonomy:\x20Senke\x20','config','split','analysis.automation.confidenceThreshold','toString','devices','common','ACTUAL_TEMPERATURE','eventStart','\x20min)','.1.ACTUAL_TEMPERATURE','search','toUpperCase','rÃ¼ckkehr','ist','calendarInstance','thermostatMapping','(((.+)+)+)+$','constructor','Unknown','push','.4.VALVE_STATE','11068nyPZkl','thermostat','ðŸ“…\x20SMART\x20SCHEDULE:\x20Raum-Trigger\x20\x27','sort','Calendar\x20Check\x20Error:\x20','stellwert','[CAL]\x20','off','getStateAsync','setpoint','info','ankunft','35ElDinI','PERFECT','forEach','room','position','1859080TiFupX','.data.table','\x20min).','getTime','val'];a1_0x1e54=function(){return _0xd03894;};return a1_0x1e54();}async function scanThermostats(_0x200ce0){const _0x22d1b9=a1_0x3bfdb1,_0x3400e3=_0x200ce0[_0x22d1b9(0x15a)][_0x22d1b9(0x15e)]||[],_0x53ab23=[],_0x3c1cb9=_0x3400e3[_0x22d1b9(0x10a)](_0x18731c=>_0x18731c['id']&&_0x18731c['id'][_0x22d1b9(0x12f)](_0x22d1b9(0x124))||_0x18731c['type']&&['temperature',_0x22d1b9(0x170),_0x22d1b9(0x131)]['includes'](_0x18731c[_0x22d1b9(0x12d)])||_0x18731c[_0x22d1b9(0x10e)]&&_0x18731c[_0x22d1b9(0x10e)][_0x22d1b9(0x147)]()[_0x22d1b9(0x12f)](_0x22d1b9(0x138)));for(const _0x9b7741 of _0x3c1cb9){const _0x4fc8bc=await findRelatedId(_0x200ce0,_0x9b7741['id'],_0x22d1b9(0x178)),_0x5e1809=await findRelatedId(_0x200ce0,_0x9b7741['id'],_0x22d1b9(0x11d));let _0x45d220=_0x22d1b9(0x143),_0x4adeb3=![],_0x340b06=_0x200ce0['config'][_0x22d1b9(0x169)]||{};if(typeof _0x340b06===_0x22d1b9(0x116))try{_0x340b06=JSON[_0x22d1b9(0x100)](_0x340b06);}catch(_0x3cfcd0){}let _0x44bb9b=_0x200ce0[_0x22d1b9(0x15a)][_0x22d1b9(0x110)]||{};if(typeof _0x44bb9b===_0x22d1b9(0x116))try{_0x44bb9b=JSON[_0x22d1b9(0x100)](_0x44bb9b);}catch(_0x3fb954){}if(_0x340b06[_0x9b7741['id']]&&_0x340b06[_0x9b7741['id']]===_0x4fc8bc||_0x44bb9b[_0x9b7741['id']]&&_0x44bb9b[_0x9b7741['id']]===_0x5e1809)_0x45d220=_0x22d1b9(0x10d),_0x4adeb3=!![];else(_0x4fc8bc||_0x5e1809)&&(_0x45d220='Auto-Erkennung');_0x53ab23[_0x22d1b9(0x16d)]({'room':_0x9b7741[_0x22d1b9(0x11b)]||'Unbekannt','sensorId':_0x9b7741['id'],'setpointId':_0x4fc8bc||'-','valveId':_0x5e1809||'-','source':_0x45d220,'isManual':_0x4adeb3,'status':_0x4fc8bc&&_0x5e1809?_0x22d1b9(0xf7):_0x4fc8bc?'OK':_0x22d1b9(0x155)});}return _0x53ab23[_0x22d1b9(0x172)]((_0x23bc16,_0x896b08)=>_0x23bc16[_0x22d1b9(0xf9)][_0x22d1b9(0x107)](_0x896b08['room']));}async function checkCalendarTriggers(_0x2d1aca){const _0x48b58b=a1_0x3bfdb1;if(!_0x2d1aca[_0x48b58b(0x15a)][_0x48b58b(0x12e)]||!_0x2d1aca[_0x48b58b(0x15a)]['calendarInstance'])return;let _0x1b8cea={};try{const _0x406403=await _0x2d1aca[_0x48b58b(0x177)](_0x48b58b(0x10c));if(_0x406403&&_0x406403[_0x48b58b(0xff)])_0x1b8cea=JSON[_0x48b58b(0x100)](_0x406403[_0x48b58b(0xff)]);}catch(_0x31bbd4){}try{const _0x227797=await _0x2d1aca['getForeignStateAsync'](_0x2d1aca[_0x48b58b(0x15a)][_0x48b58b(0x168)]+_0x48b58b(0xfc));if(!_0x227797||!_0x227797[_0x48b58b(0xff)])return;const _0x1e37f1=JSON[_0x48b58b(0x100)](_0x227797['val']),_0x52bcba=new Date(),_0x161b6e=_0x2d1aca[_0x48b58b(0x15a)]['devices']||[],_0x2f01e1=_0x2d1aca[_0x48b58b(0x15a)][_0x48b58b(0x106)]||[];for(const _0x15f299 of _0x1e37f1){if(_0x15f299[_0x48b58b(0x14c)]&&_0x2f01e1[_0x48b58b(0x115)]>0x0&&!_0x2f01e1[_0x48b58b(0x12f)](_0x15f299[_0x48b58b(0x14c)]))continue;const _0x25c597=new Date(_0x15f299[_0x48b58b(0x161)]),_0x4edce3=(_0x15f299[_0x48b58b(0x113)]||_0x15f299['summary']||'')['toLowerCase']();if(_0x4edce3['includes']('urlaub\x20ende')||_0x4edce3[_0x48b58b(0x12f)](_0x48b58b(0x166))||_0x4edce3[_0x48b58b(0x12f)](_0x48b58b(0xf5))){let _0x3fe372=0x0;Object['values'](_0x1b8cea)['forEach'](_0x481724=>{if(_0x481724>_0x3fe372)_0x3fe372=_0x481724;});if(_0x3fe372===0x0)_0x3fe372=0x78;const _0x22577b=new Date(_0x25c597[_0x48b58b(0xfe)]()-_0x3fe372*0xea60),_0x4a2d7d=_0x52bcba[_0x48b58b(0xfe)]()-_0x22577b[_0x48b58b(0xfe)]();_0x4a2d7d>=0x0&&_0x4a2d7d<0xf*0xea60&&(_0x2d1aca[_0x48b58b(0x150)][_0x48b58b(0x179)](_0x48b58b(0x140)+_0x15f299[_0x48b58b(0x113)]+').\x20Heize\x20ganzes\x20Haus\x20auf\x20(Vorlauf:\x20'+_0x3fe372+'\x20min).'),await _0x2d1aca[_0x48b58b(0x13b)]('system.mode',{'val':_0x48b58b(0x157),'ack':![]}));}for(const _0x58ccf5 of _0x161b6e){if(_0x58ccf5['location']){const _0x4cd991=_0x58ccf5[_0x48b58b(0x11b)]['toLowerCase']();if(_0x4edce3[_0x48b58b(0x12f)](_0x4cd991)){const _0x4dbc4d=_0x1b8cea[_0x58ccf5[_0x48b58b(0x11b)]]||0x3c,_0x2d2dfc=new Date(_0x25c597[_0x48b58b(0xfe)]()-_0x4dbc4d*0xea60),_0xfc5c9a=_0x52bcba[_0x48b58b(0xfe)]()-_0x2d2dfc[_0x48b58b(0xfe)]();if(_0xfc5c9a>=0x0&&_0xfc5c9a<0xf*0xea60){const _0x8cd076=await findRelatedId(_0x2d1aca,_0x58ccf5['id'],_0x48b58b(0x178));_0x8cd076&&(_0x2d1aca['log'][_0x48b58b(0x179)](_0x48b58b(0x171)+_0x58ccf5['location']+_0x48b58b(0x136)+_0x15f299['event']+_0x48b58b(0x14e)+_0x4dbc4d+_0x48b58b(0xfd)),await _0x2d1aca[_0x48b58b(0x133)](_0x8cd076,0x15),await _0x2d1aca[_0x48b58b(0x13b)](_0x48b58b(0x130),{'val':_0x48b58b(0x175)+_0x58ccf5[_0x48b58b(0x11b)]+'\x20->\x2021Â°C','ack':!![]}));}}}}}}catch(_0x398603){_0x2d1aca[_0x48b58b(0x150)][_0x48b58b(0x111)](_0x48b58b(0x173)+_0x398603['message']);}}async function applyEnergySavings(_0x41b9db,_0x480732){const _0x3ff740=a1_0x3bfdb1,_0x656cbc=_0x41b9db[_0x3ff740(0x15a)]['devices']||[];for(const _0xc208ad of _0x480732){const _0x46cf13=_0xc208ad['room'],_0x555577=_0xc208ad[_0x3ff740(0x11e)],_0x1cbfb1=Date['now']();if(lastActions[_0x3ff740(0x146)+_0x46cf13]&&_0x1cbfb1-lastActions[_0x3ff740(0x146)+_0x46cf13]<0x1e*0x3c*0x3e8)continue;const _0x5bbb5e=_0x656cbc[_0x3ff740(0x126)](_0x468f29=>normalize(_0x468f29[_0x3ff740(0x11b)])===normalize(_0x46cf13));if(!_0x5bbb5e)continue;const _0x39b62f=await findRelatedId(_0x41b9db,_0x5bbb5e['id'],'setpoint');if(_0x39b62f){const _0x5633af=await _0x41b9db[_0x3ff740(0x117)](_0x39b62f);if(_0x5633af&&typeof _0x5633af[_0x3ff740(0xff)]===_0x3ff740(0x127)){const _0x30452a=_0x5633af['val'];if(_0x555577>0x1e&&_0x30452a>0x11){const _0x3220c1=_0x30452a-0x1;_0x41b9db[_0x3ff740(0x150)][_0x3ff740(0x179)](_0x3ff740(0x159)+_0x46cf13+'\x20('+_0x39b62f+')\x20auf\x20'+_0x3220c1+'Â°C\x20(Coasting\x20mÃ¶glich:\x20'+_0x555577+_0x3ff740(0x162)),await _0x41b9db['setForeignStateAsync'](_0x39b62f,_0x3220c1),lastActions[_0x3ff740(0x146)+_0x46cf13]=_0x1cbfb1,await _0x41b9db[_0x3ff740(0x13b)](_0x3ff740(0x130),{'val':_0x3ff740(0x101)+_0x46cf13+':\x20-1Â°C\x20(Sparpotenzial\x20genutzt)','ack':!![]});}}}}}module['exports']={'handlePrediction':handlePrediction,'applyEnergySavings':applyEnergySavings,'scanThermostats':scanThermostats,'checkCalendarTriggers':checkCalendarTriggers};