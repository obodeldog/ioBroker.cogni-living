const a1_0x246ac3=a1_0x4d52;(function(_0x43f241,_0x4c5d83){const _0x43ff47=a1_0x4d52,_0x256b2a=_0x43f241();while(!![]){try{const _0x13eda4=-parseInt(_0x43ff47(0x1f4))/0x1+parseInt(_0x43ff47(0x24b))/0x2+parseInt(_0x43ff47(0x25d))/0x3*(parseInt(_0x43ff47(0x256))/0x4)+-parseInt(_0x43ff47(0x259))/0x5+parseInt(_0x43ff47(0x1f6))/0x6+-parseInt(_0x43ff47(0x1f3))/0x7*(parseInt(_0x43ff47(0x226))/0x8)+parseInt(_0x43ff47(0x254))/0x9*(parseInt(_0x43ff47(0x202))/0xa);if(_0x13eda4===_0x4c5d83)break;else _0x256b2a['push'](_0x256b2a['shift']());}catch(_0x2808fa){_0x256b2a['push'](_0x256b2a['shift']());}}}(a1_0x35ce,0x4b5da));const a1_0x331399=(function(){let _0x3e877d=!![];return function(_0x547778,_0x14bfaf){const _0x673581=_0x3e877d?function(){const _0x5d3907=a1_0x4d52;if(_0x14bfaf){const _0x541b03=_0x14bfaf[_0x5d3907(0x25a)](_0x547778,arguments);return _0x14bfaf=null,_0x541b03;}}:function(){};return _0x3e877d=![],_0x673581;};}()),a1_0x1e964a=a1_0x331399(this,function(){const _0x581e86=a1_0x4d52;return a1_0x1e964a[_0x581e86(0x1f8)]()[_0x581e86(0x261)](_0x581e86(0x252))['toString']()['constructor'](a1_0x1e964a)[_0x581e86(0x261)](_0x581e86(0x252));});a1_0x1e964a();function a1_0x4d52(_0x375bc2,_0x132490){const _0x502244=a1_0x35ce();return a1_0x4d52=function(_0x1e964a,_0x331399){_0x1e964a=_0x1e964a-0x1ef;let _0x35ce1f=_0x502244[_0x1e964a];return _0x35ce1f;},a1_0x4d52(_0x375bc2,_0x132490);}function a1_0x35ce(){const _0x227b3b=['length','stellwert','light','analysis.automation.mode','devices','900778FTicoH','thermostatMapping','now','Unbekannt','push','getForeignStateAsync','analysis.energy.warmupTimes','(((.+)+)+)+$','setpoint','9279umRtIB','level.temperature','28PcXEON','role','.1.TEMPERATURE','2704340NdgIvr','apply','Manuelles\x20Mapping','event','179373EdENZi','split','write',')\x20auf\x20','search','ankunft','messwert','calendarInstance','Unknown','getForeignObjectAsync','üìÖ\x20SMART\x20SCHEDULE:\x20Raum-Trigger\x20\x27','find','ACTUAL','summary','SET_POINT_TEMPERATURE','Fehlt',':\x20-1¬∞C\x20(Sparpotenzial\x20genutzt)','forEach','name','values','üìÖ\x20SMART\x20SCHEDULE:\x20\x27Globaler\x20Start\x27\x20erkannt\x20(','sensor','toLowerCase','info','type','exports','message','7mAlieh','62724UxsMZR','reason','509172HVojYV','[CAL]\x20','toString','trim','valveMapping','join','wert','setStateAsync','sort','normal','.1.LEVEL','local_temperature','430vYVhbo','number','temperature','log','Auto-Erkennung','room','entries','PERFECT','getTime','config','Soll','thermostat.setpoint','off','ACTUAL_TEMPERATURE','mpc_','filter','state','target','SET','location','includes','system.mode','./ai_agent','switch','Pr√§diktion:\x20','val','toUpperCase','getStateAsync','map','useCalendar','approved','slice','value.valve','analysis.automation.lastAction','current_heating_setpoint','[MPC]\x20','686648koRHiP','active','localeCompare','r√ºckkehr','score','position','level.valve','replace','parse','\x20min).','dimmer','Calendar\x20Check\x20Error:\x20','common','valve','_calName','minutes_safe','.1.SET_POINT_TEMPERATURE','target_temperature','level','set','string','urlaub\x20ende','consultButler','.4.VALVE_STATE','Nicht\x20gefunden','setForeignStateAsync','eventStart','openknx','pi_heating_demand','.data.table','soll','debug'];a1_0x35ce=function(){return _0x227b3b;};return a1_0x35ce();}'use strict';const aiAgent=require(a1_0x246ac3(0x218)),COOLDOWN_MS=0x3c*0x3e8,lastActions={};function normalize(_0x3aad76){const _0x25b7b3=a1_0x246ac3;if(!_0x3aad76)return'';return _0x3aad76[_0x25b7b3(0x273)]()[_0x25b7b3(0x22d)](/\s+/g,'')[_0x25b7b3(0x1f9)]();}async function handlePrediction(_0x5c8067,_0xd76d7c,_0xad73a8){const _0xa6f59f=a1_0x246ac3;if(!_0xd76d7c||_0xd76d7c===_0xa6f59f(0x265))return;let _0x1ada10=_0xa6f59f(0x20e),_0x4699d9=0.6;try{const _0x13f7bf=await _0x5c8067['getStateAsync'](_0xa6f59f(0x249));if(_0x13f7bf&&_0x13f7bf[_0xa6f59f(0x21b)])_0x1ada10=_0x13f7bf[_0xa6f59f(0x21b)];const _0x348378=await _0x5c8067[_0xa6f59f(0x21d)]('analysis.automation.confidenceThreshold');if(_0x348378&&_0x348378[_0xa6f59f(0x21b)])_0x4699d9=_0x348378[_0xa6f59f(0x21b)];}catch(_0x1cc4db){}if(_0x1ada10==='off'||_0xad73a8<_0x4699d9)return;const _0x570d2e=Date['now']();if(lastActions[_0xd76d7c]&&_0x570d2e-lastActions[_0xd76d7c]<COOLDOWN_MS)return;const _0x55925c=_0x5c8067['config'][_0xa6f59f(0x24a)]||[],_0x154b40=normalize(_0xd76d7c),_0x1b7a36=_0x55925c[_0xa6f59f(0x268)](_0xf75ead=>normalize(_0xf75ead[_0xa6f59f(0x215)])===_0x154b40&&(_0xf75ead[_0xa6f59f(0x1f0)]===_0xa6f59f(0x248)||_0xf75ead[_0xa6f59f(0x1f0)]===_0xa6f59f(0x230)||_0xf75ead[_0xa6f59f(0x1f0)]===_0xa6f59f(0x219)));if(!_0x1b7a36){_0x5c8067[_0xa6f59f(0x205)][_0xa6f59f(0x245)]('üîç\x20Device-Search\x20failed\x20for\x20predicted\x20room\x20\x27'+_0xd76d7c+'\x27.');return;}const _0x7edcdb=await aiAgent[_0xa6f59f(0x23c)](_0x5c8067,_0xd76d7c,_0x1b7a36[_0xa6f59f(0x26f)],_0xad73a8);if(!_0x7edcdb[_0xa6f59f(0x220)])return;const _0x273048=_0xa6f59f(0x21a)+_0xd76d7c+'\x20->\x20Schalte\x20'+_0x1b7a36['name']+'\x20('+_0x7edcdb[_0xa6f59f(0x1f5)]+')';await _0x5c8067[_0xa6f59f(0x1fd)](_0xa6f59f(0x223),{'val':'['+_0x1ada10[_0xa6f59f(0x21c)]()+']\x20'+_0x273048,'ack':!![]});if(_0x1ada10===_0xa6f59f(0x227)){const _0x39470c=await _0x5c8067['getForeignStateAsync'](_0x1b7a36['id']);(!_0x39470c||!_0x39470c[_0xa6f59f(0x21b)]&&_0x39470c['val']!==!![])&&await _0x5c8067[_0xa6f59f(0x23f)](_0x1b7a36['id'],!![]),lastActions[_0xd76d7c]=_0x570d2e;}}async function findRelatedId(_0x35c350,_0xbee718,_0x109766=a1_0x246ac3(0x253)){const _0x4a9b66=a1_0x246ac3;if(_0x109766==='setpoint'&&_0x35c350['config'][_0x4a9b66(0x24c)]){let _0x4e1264=_0x35c350[_0x4a9b66(0x20b)][_0x4a9b66(0x24c)];if(typeof _0x4e1264===_0x4a9b66(0x23a))try{_0x4e1264=JSON[_0x4a9b66(0x22e)](_0x4e1264);}catch(_0x3a7407){}if(_0x4e1264&&_0x4e1264[_0xbee718])return _0x4e1264[_0xbee718];}if(_0x109766===_0x4a9b66(0x233)&&_0x35c350[_0x4a9b66(0x20b)][_0x4a9b66(0x1fa)]){let _0x243308=_0x35c350[_0x4a9b66(0x20b)]['valveMapping'];if(typeof _0x243308===_0x4a9b66(0x23a))try{_0x243308=JSON['parse'](_0x243308);}catch(_0xa787c3){}if(_0x243308&&_0x243308[_0xbee718])return _0x243308[_0xbee718];}let _0x32b576=[];if(_0x109766===_0x4a9b66(0x253))_0x32b576=[{'s':'.1.ACTUAL_TEMPERATURE','t':_0x4a9b66(0x236)},{'s':_0x4a9b66(0x258),'t':_0x4a9b66(0x236)},{'s':'.1.TEMPERATURE','t':'.4.SET_TEMPERATURE'},{'s':_0x4a9b66(0x20f),'t':_0x4a9b66(0x26b)},{'s':_0x4a9b66(0x201),'t':'occupied_heating_setpoint'},{'s':_0x4a9b66(0x201),'t':_0x4a9b66(0x224)},{'s':_0x4a9b66(0x204),'t':_0x4a9b66(0x237)},{'s':_0x4a9b66(0x269),'t':_0x4a9b66(0x214)},{'s':'Ist','t':_0x4a9b66(0x20c)},{'s':_0x4a9b66(0x204),'t':_0x4a9b66(0x253)}];else _0x109766===_0x4a9b66(0x233)&&(_0x32b576=[{'s':'.1.ACTUAL_TEMPERATURE','t':_0x4a9b66(0x200)},{'s':'.1.TEMPERATURE','t':'.1.LEVEL'},{'s':_0x4a9b66(0x258),'t':_0x4a9b66(0x23d)},{'s':_0x4a9b66(0x201),'t':_0x4a9b66(0x242)},{'s':_0x4a9b66(0x204),'t':'valve_position'},{'s':_0x4a9b66(0x204),'t':'level'}]);for(const _0xda2b95 of _0x32b576){if(_0xbee718[_0x4a9b66(0x216)](_0xda2b95['s'])){const _0x5318db=_0xbee718[_0x4a9b66(0x22d)](_0xda2b95['s'],_0xda2b95['t']),_0x3a35be=await _0x35c350[_0x4a9b66(0x266)](_0x5318db);if(_0x3a35be)return _0x5318db;}}try{const _0x14e452=_0xbee718[_0x4a9b66(0x25e)]('.');if(_0x14e452[_0x4a9b66(0x246)]>0x2){const _0x5baf27=_0x14e452[_0x4a9b66(0x221)](0x0,-0x1)[_0x4a9b66(0x1fb)]('.'),_0x5c364f=await _0x35c350['getForeignObjectsAsync'](_0x5baf27+'.*'),_0x28aa61=[],_0x16efe3=_0xbee718['split'](/[._]+/)[_0x4a9b66(0x211)](_0x765375=>![_0x4a9b66(0x241),'0','hm-rpc','ist',_0x4a9b66(0x1fc),'temperature','actual','sensor',_0x4a9b66(0x263),_0x4a9b66(0x212)]['includes'](_0x765375[_0x4a9b66(0x273)]()));for(const [_0x34258,_0xea01d8]of Object[_0x4a9b66(0x208)](_0x5c364f)){if(_0x34258===_0xbee718)continue;if(_0xea01d8&&_0xea01d8['common']){const _0x3dadc7=_0x34258[_0x4a9b66(0x273)](),_0x44d5ab=(_0xea01d8[_0x4a9b66(0x232)][_0x4a9b66(0x257)]||'')[_0x4a9b66(0x273)](),_0x51a1cf=(_0xea01d8[_0x4a9b66(0x232)]['unit']||'')[_0x4a9b66(0x273)]();let _0x28eb1a=![];if(_0x109766==='setpoint'&&_0xea01d8[_0x4a9b66(0x232)][_0x4a9b66(0x25f)]===!![])_0x28eb1a=_0x3dadc7['includes'](_0x4a9b66(0x239))||_0x3dadc7[_0x4a9b66(0x216)](_0x4a9b66(0x244))||_0x3dadc7[_0x4a9b66(0x216)](_0x4a9b66(0x213))||_0x44d5ab['includes'](_0x4a9b66(0x255))||_0x44d5ab[_0x4a9b66(0x216)](_0x4a9b66(0x20d));else _0x109766===_0x4a9b66(0x233)&&(_0x28eb1a=_0x3dadc7['includes'](_0x4a9b66(0x238))||_0x3dadc7[_0x4a9b66(0x216)](_0x4a9b66(0x233))||_0x3dadc7[_0x4a9b66(0x216)](_0x4a9b66(0x247))||_0x3dadc7[_0x4a9b66(0x216)](_0x4a9b66(0x22b))||_0x44d5ab[_0x4a9b66(0x216)](_0x4a9b66(0x22c))||_0x44d5ab[_0x4a9b66(0x216)](_0x4a9b66(0x222))||_0x51a1cf[_0x4a9b66(0x216)]('%'));if(_0x28eb1a){const _0x134319=_0x34258['split'](/[._]+/)[_0x4a9b66(0x21e)](_0x55e705=>_0x55e705['toLowerCase']());let _0x55f5a7=0x0;_0x16efe3[_0x4a9b66(0x26e)](_0x251917=>{const _0x20b49e=_0x4a9b66;if(_0x134319[_0x20b49e(0x216)](_0x251917[_0x20b49e(0x273)]()))_0x55f5a7++;}),_0x28aa61[_0x4a9b66(0x24f)]({'id':_0x34258,'score':_0x55f5a7});}}}if(_0x28aa61[_0x4a9b66(0x246)]>0x0){_0x28aa61['sort']((_0x3279cd,_0x33057b)=>_0x33057b[_0x4a9b66(0x22a)]-_0x3279cd[_0x4a9b66(0x22a)]);if(_0x28aa61[0x0][_0x4a9b66(0x22a)]>0x0)return _0x28aa61[0x0]['id'];}}}catch(_0x29d041){}return null;}async function scanThermostats(_0x5edd0f){const _0x4c04c1=a1_0x246ac3,_0x118c22=_0x5edd0f[_0x4c04c1(0x20b)][_0x4c04c1(0x24a)]||[],_0x3fee4d=[],_0x3c6fdb=_0x118c22[_0x4c04c1(0x211)](_0x55f45c=>_0x55f45c['id']&&_0x55f45c['id']['includes'](_0x4c04c1(0x204))||_0x55f45c[_0x4c04c1(0x1f0)]&&['temperature','thermostat',_0x4c04c1(0x272)][_0x4c04c1(0x216)](_0x55f45c['type'])||_0x55f45c[_0x4c04c1(0x26f)]&&_0x55f45c[_0x4c04c1(0x26f)][_0x4c04c1(0x273)]()['includes']('temp'));for(const _0x1cd59c of _0x3c6fdb){const _0x40ca97=await findRelatedId(_0x5edd0f,_0x1cd59c['id'],_0x4c04c1(0x253)),_0x3a5a1c=await findRelatedId(_0x5edd0f,_0x1cd59c['id'],_0x4c04c1(0x233));let _0x14688a=_0x4c04c1(0x23e),_0xa3bdf2=![],_0x31c024=_0x5edd0f[_0x4c04c1(0x20b)][_0x4c04c1(0x24c)]||{};if(typeof _0x31c024==='string')try{_0x31c024=JSON[_0x4c04c1(0x22e)](_0x31c024);}catch(_0x593d0f){}let _0x40d989=_0x5edd0f['config']['valveMapping']||{};if(typeof _0x40d989==='string')try{_0x40d989=JSON[_0x4c04c1(0x22e)](_0x40d989);}catch(_0x34890a){}if(_0x31c024[_0x1cd59c['id']]&&_0x31c024[_0x1cd59c['id']]===_0x40ca97||_0x40d989[_0x1cd59c['id']]&&_0x40d989[_0x1cd59c['id']]===_0x3a5a1c)_0x14688a=_0x4c04c1(0x25b),_0xa3bdf2=!![];else(_0x40ca97||_0x3a5a1c)&&(_0x14688a=_0x4c04c1(0x206));_0x3fee4d[_0x4c04c1(0x24f)]({'room':_0x1cd59c[_0x4c04c1(0x215)]||_0x4c04c1(0x24e),'sensorId':_0x1cd59c['id'],'setpointId':_0x40ca97||'-','valveId':_0x3a5a1c||'-','source':_0x14688a,'isManual':_0xa3bdf2,'status':_0x40ca97&&_0x3a5a1c?_0x4c04c1(0x209):_0x40ca97?'OK':_0x4c04c1(0x26c)});}return _0x3fee4d[_0x4c04c1(0x1fe)]((_0x1a7aa6,_0x16cc16)=>_0x1a7aa6[_0x4c04c1(0x207)][_0x4c04c1(0x228)](_0x16cc16[_0x4c04c1(0x207)]));}async function checkCalendarTriggers(_0x3a48cb){const _0x4a21ab=a1_0x246ac3;if(!_0x3a48cb[_0x4a21ab(0x20b)][_0x4a21ab(0x21f)]||!_0x3a48cb[_0x4a21ab(0x20b)][_0x4a21ab(0x264)])return;let _0x3bbe61={};try{const _0x104b43=await _0x3a48cb[_0x4a21ab(0x21d)](_0x4a21ab(0x251));if(_0x104b43&&_0x104b43[_0x4a21ab(0x21b)])_0x3bbe61=JSON[_0x4a21ab(0x22e)](_0x104b43[_0x4a21ab(0x21b)]);}catch(_0x3a0eae){}try{const _0x57a2d6=await _0x3a48cb[_0x4a21ab(0x250)](_0x3a48cb[_0x4a21ab(0x20b)][_0x4a21ab(0x264)]+_0x4a21ab(0x243));if(!_0x57a2d6||!_0x57a2d6['val'])return;const _0x2a93a6=JSON[_0x4a21ab(0x22e)](_0x57a2d6[_0x4a21ab(0x21b)]),_0x18ece4=new Date(),_0x39ea28=_0x3a48cb[_0x4a21ab(0x20b)][_0x4a21ab(0x24a)]||[],_0x4f3659=_0x3a48cb[_0x4a21ab(0x20b)]['calendarSelection']||[];for(const _0x524a06 of _0x2a93a6){if(_0x524a06[_0x4a21ab(0x234)]&&_0x4f3659[_0x4a21ab(0x246)]>0x0&&!_0x4f3659[_0x4a21ab(0x216)](_0x524a06[_0x4a21ab(0x234)]))continue;const _0x20f7ae=new Date(_0x524a06[_0x4a21ab(0x240)]),_0x445973=(_0x524a06[_0x4a21ab(0x25c)]||_0x524a06[_0x4a21ab(0x26a)]||'')[_0x4a21ab(0x273)]();if(_0x445973[_0x4a21ab(0x216)](_0x4a21ab(0x23b))||_0x445973[_0x4a21ab(0x216)](_0x4a21ab(0x229))||_0x445973[_0x4a21ab(0x216)](_0x4a21ab(0x262))){let _0x8c13da=0x0;Object[_0x4a21ab(0x270)](_0x3bbe61)[_0x4a21ab(0x26e)](_0x5bd5c8=>{if(_0x5bd5c8>_0x8c13da)_0x8c13da=_0x5bd5c8;});if(_0x8c13da===0x0)_0x8c13da=0x78;const _0x4bf97d=new Date(_0x20f7ae['getTime']()-_0x8c13da*0xea60),_0x277229=_0x18ece4[_0x4a21ab(0x20a)]()-_0x4bf97d[_0x4a21ab(0x20a)]();_0x277229>=0x0&&_0x277229<0xf*0xea60&&(_0x3a48cb[_0x4a21ab(0x205)]['info'](_0x4a21ab(0x271)+_0x524a06[_0x4a21ab(0x25c)]+').\x20Heize\x20ganzes\x20Haus\x20auf\x20(Vorlauf:\x20'+_0x8c13da+_0x4a21ab(0x22f)),await _0x3a48cb['setStateAsync'](_0x4a21ab(0x217),{'val':_0x4a21ab(0x1ff),'ack':![]}));}for(const _0x1af2ba of _0x39ea28){if(_0x1af2ba[_0x4a21ab(0x215)]){const _0x1e04a1=_0x1af2ba[_0x4a21ab(0x215)][_0x4a21ab(0x273)]();if(_0x445973[_0x4a21ab(0x216)](_0x1e04a1)){const _0x56e3a7=_0x3bbe61[_0x1af2ba['location']]||0x3c,_0x10bd60=new Date(_0x20f7ae['getTime']()-_0x56e3a7*0xea60),_0x370569=_0x18ece4[_0x4a21ab(0x20a)]()-_0x10bd60[_0x4a21ab(0x20a)]();if(_0x370569>=0x0&&_0x370569<0xf*0xea60){const _0x378c1e=await findRelatedId(_0x3a48cb,_0x1af2ba['id'],_0x4a21ab(0x253));_0x378c1e&&(_0x3a48cb[_0x4a21ab(0x205)][_0x4a21ab(0x1ef)](_0x4a21ab(0x267)+_0x1af2ba[_0x4a21ab(0x215)]+'\x27\x20erkannt\x20('+_0x524a06['event']+').\x20Heize\x20auf\x2021¬∞C\x20(Vorlauf:\x20'+_0x56e3a7+_0x4a21ab(0x22f)),await _0x3a48cb[_0x4a21ab(0x23f)](_0x378c1e,0x15),await _0x3a48cb['setStateAsync']('analysis.automation.lastAction',{'val':_0x4a21ab(0x1f7)+_0x1af2ba[_0x4a21ab(0x215)]+'\x20->\x2021¬∞C','ack':!![]}));}}}}}}catch(_0x385725){_0x3a48cb[_0x4a21ab(0x205)]['warn'](_0x4a21ab(0x231)+_0x385725[_0x4a21ab(0x1f2)]);}}async function applyEnergySavings(_0x450f9a,_0x5653f4){const _0x2cace3=a1_0x246ac3,_0x1edead=_0x450f9a[_0x2cace3(0x20b)][_0x2cace3(0x24a)]||[];for(const _0x1aaf5e of _0x5653f4){const _0x379c2a=_0x1aaf5e[_0x2cace3(0x207)],_0x4b9fea=_0x1aaf5e[_0x2cace3(0x235)],_0x38212d=Date[_0x2cace3(0x24d)]();if(lastActions[_0x2cace3(0x210)+_0x379c2a]&&_0x38212d-lastActions[_0x2cace3(0x210)+_0x379c2a]<0x1e*0x3c*0x3e8)continue;const _0x5786b2=_0x1edead[_0x2cace3(0x268)](_0x1d21d7=>normalize(_0x1d21d7[_0x2cace3(0x215)])===normalize(_0x379c2a));if(!_0x5786b2)continue;const _0x29877c=await findRelatedId(_0x450f9a,_0x5786b2['id'],'setpoint');if(_0x29877c){const _0x15dc12=await _0x450f9a[_0x2cace3(0x250)](_0x29877c);if(_0x15dc12&&typeof _0x15dc12[_0x2cace3(0x21b)]===_0x2cace3(0x203)){const _0x2ea999=_0x15dc12[_0x2cace3(0x21b)];if(_0x4b9fea>0x1e&&_0x2ea999>0x11){const _0x1aa166=_0x2ea999-0x1;_0x450f9a['log'][_0x2cace3(0x1ef)]('üçÉ\x20MPC\x20Autonomy:\x20Senke\x20'+_0x379c2a+'\x20('+_0x29877c+_0x2cace3(0x260)+_0x1aa166+'¬∞C\x20(Coasting\x20m√∂glich:\x20'+_0x4b9fea+'\x20min)'),await _0x450f9a[_0x2cace3(0x23f)](_0x29877c,_0x1aa166),lastActions[_0x2cace3(0x210)+_0x379c2a]=_0x38212d,await _0x450f9a[_0x2cace3(0x1fd)](_0x2cace3(0x223),{'val':_0x2cace3(0x225)+_0x379c2a+_0x2cace3(0x26d),'ack':!![]});}}}}}module[a1_0x246ac3(0x1f1)]={'handlePrediction':handlePrediction,'applyEnergySavings':applyEnergySavings,'scanThermostats':scanThermostats,'checkCalendarTriggers':checkCalendarTriggers};