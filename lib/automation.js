const a1_0x92365a=a1_0x3d33;(function(_0x2e207f,_0x376d05){const _0x554748=a1_0x3d33,_0x275697=_0x2e207f();while(!![]){try{const _0x23223f=parseInt(_0x554748(0x140))/0x1*(parseInt(_0x554748(0x136))/0x2)+-parseInt(_0x554748(0xe5))/0x3*(parseInt(_0x554748(0xcd))/0x4)+-parseInt(_0x554748(0x15f))/0x5+parseInt(_0x554748(0x10f))/0x6+parseInt(_0x554748(0x11d))/0x7+parseInt(_0x554748(0x12f))/0x8+parseInt(_0x554748(0xf1))/0x9;if(_0x23223f===_0x376d05)break;else _0x275697['push'](_0x275697['shift']());}catch(_0x2b0b8b){_0x275697['push'](_0x275697['shift']());}}}(a1_0x11eb,0x953aa));const a1_0x441b13=(function(){let _0x3865a9=!![];return function(_0x352fd6,_0x3454c3){const _0x24041f=_0x3865a9?function(){const _0x194a1b=a1_0x3d33;if(_0x3454c3){const _0x2cc221=_0x3454c3[_0x194a1b(0x105)](_0x352fd6,arguments);return _0x3454c3=null,_0x2cc221;}}:function(){};return _0x3865a9=![],_0x24041f;};}()),a1_0x4115f8=a1_0x441b13(this,function(){const _0x144b36=a1_0x3d33;return a1_0x4115f8[_0x144b36(0x15d)]()[_0x144b36(0x165)](_0x144b36(0x147))['toString']()[_0x144b36(0x164)](a1_0x4115f8)[_0x144b36(0x165)](_0x144b36(0x147));});a1_0x4115f8();'use strict';const aiAgent=require(a1_0x92365a(0xbf)),COOLDOWN_MS=0x3c*0x3e8,CAL_COOLDOWN_MS=0x5a*0x3c*0x3e8,RESCUE_LOCK_MS=0x78*0x3c*0x3e8,ECO_TEMP=0x11,lastActions={};function normalize(_0x3bb2c){const _0x2d87d1=a1_0x92365a;if(!_0x3bb2c)return'';return _0x3bb2c[_0x2d87d1(0x13d)]()[_0x2d87d1(0x117)](/\s+/g,'')[_0x2d87d1(0x15a)]();}async function logAutomationAction(_0x18e19e,_0x567d16){const _0x1ac9b0=a1_0x92365a;await _0x18e19e[_0x1ac9b0(0x101)](_0x1ac9b0(0xd3),{'val':_0x567d16,'ack':!![]});try{const _0x37ad03='analysis.automation.actionLog',_0x50e4c0=await _0x18e19e[_0x1ac9b0(0x115)](_0x37ad03);let _0x5fb3ab=[];if(_0x50e4c0&&_0x50e4c0[_0x1ac9b0(0xb4)])try{_0x5fb3ab=JSON[_0x1ac9b0(0xe8)](_0x50e4c0[_0x1ac9b0(0xb4)]);}catch(_0x41e176){}_0x5fb3ab[_0x1ac9b0(0xc9)]({'ts':Date[_0x1ac9b0(0x12d)](),'msg':_0x567d16});if(_0x5fb3ab[_0x1ac9b0(0x14c)]>0x32)_0x5fb3ab=_0x5fb3ab[_0x1ac9b0(0xe0)](0x0,0x32);await _0x18e19e[_0x1ac9b0(0x101)](_0x37ad03,{'val':JSON['stringify'](_0x5fb3ab),'ack':!![]});}catch(_0x390c6c){}}async function handlePrediction(_0x5ee145,_0x2bfd4c,_0x1012ce){const _0x406736=a1_0x92365a;if(!_0x2bfd4c||_0x2bfd4c===_0x406736(0xc6))return;let _0x372524='off',_0x49b582=0.6;try{const _0x4356f3=await _0x5ee145[_0x406736(0x115)](_0x406736(0x16a));if(_0x4356f3&&_0x4356f3[_0x406736(0xb4)])_0x372524=_0x4356f3[_0x406736(0xb4)];const _0x54171a=await _0x5ee145[_0x406736(0x115)](_0x406736(0xd0));if(_0x54171a&&_0x54171a[_0x406736(0xb4)])_0x49b582=_0x54171a['val'];}catch(_0x50ef07){}if(_0x372524===_0x406736(0x13c)||_0x1012ce<_0x49b582)return;const _0x571e42=Date[_0x406736(0x12d)]();if(lastActions[_0x2bfd4c]&&_0x571e42-lastActions[_0x2bfd4c]<COOLDOWN_MS)return;const _0x5a4392=_0x5ee145[_0x406736(0x158)]['devices']||[],_0x16aa00=normalize(_0x2bfd4c),_0x3d5b5f=_0x5a4392[_0x406736(0x11b)](_0x14af32=>normalize(_0x14af32[_0x406736(0x166)])===_0x16aa00&&(_0x14af32[_0x406736(0x127)]===_0x406736(0xbe)||_0x14af32[_0x406736(0x127)]===_0x406736(0x10b)||_0x14af32[_0x406736(0x127)]===_0x406736(0xec)));if(!_0x3d5b5f)return;const _0x5e73fb=await aiAgent[_0x406736(0x124)](_0x5ee145,_0x2bfd4c,_0x3d5b5f[_0x406736(0x104)],_0x1012ce);if(!_0x5e73fb[_0x406736(0x163)])return;const _0x48df61=_0x406736(0x14a)+_0x2bfd4c+_0x406736(0x145)+_0x3d5b5f[_0x406736(0x104)]+'\x20('+_0x5e73fb[_0x406736(0x141)]+')';await logAutomationAction(_0x5ee145,'['+_0x372524['toUpperCase']()+']\x20'+_0x48df61);if(_0x372524==='active'){const _0x57d8b3=await _0x5ee145['getForeignStateAsync'](_0x3d5b5f['id']);(!_0x57d8b3||!_0x57d8b3['val']&&_0x57d8b3['val']!==!![])&&await _0x5ee145[_0x406736(0xf2)](_0x3d5b5f['id'],!![]),lastActions[_0x2bfd4c]=_0x571e42;}}async function findRelatedId(_0x1b4787,_0x1f4f50,_0x97b928=a1_0x92365a(0x126)){const _0x57c1ce=a1_0x92365a;if(_0x97b928===_0x57c1ce(0x126)&&_0x1b4787['config']['thermostatMapping']){let _0x5af49c=_0x1b4787[_0x57c1ce(0x158)]['thermostatMapping'];if(typeof _0x5af49c==='string')try{_0x5af49c=JSON['parse'](_0x5af49c);}catch(_0x123f64){}if(_0x5af49c&&_0x5af49c[_0x1f4f50])return _0x5af49c[_0x1f4f50];}if(_0x97b928==='valve'&&_0x1b4787[_0x57c1ce(0x158)][_0x57c1ce(0x14f)]){let _0xf669ec=_0x1b4787[_0x57c1ce(0x158)][_0x57c1ce(0x14f)];if(typeof _0xf669ec===_0x57c1ce(0xdd))try{_0xf669ec=JSON[_0x57c1ce(0xe8)](_0xf669ec);}catch(_0x2d82e3){}if(_0xf669ec&&_0xf669ec[_0x1f4f50])return _0xf669ec[_0x1f4f50];}let _0x1ea007=[];if(_0x97b928===_0x57c1ce(0x126))_0x1ea007=[{'s':'.1.ACTUAL_TEMPERATURE','t':'.1.SET_POINT_TEMPERATURE'},{'s':_0x57c1ce(0x107),'t':'.1.SET_POINT_TEMPERATURE'},{'s':'.1.TEMPERATURE','t':_0x57c1ce(0x129)},{'s':'ACTUAL_TEMPERATURE','t':_0x57c1ce(0xf3)},{'s':_0x57c1ce(0x132),'t':_0x57c1ce(0xc2)},{'s':_0x57c1ce(0x132),'t':_0x57c1ce(0xf7)},{'s':_0x57c1ce(0x143),'t':_0x57c1ce(0x119)},{'s':_0x57c1ce(0x13e),'t':_0x57c1ce(0xe4)},{'s':_0x57c1ce(0xfe),'t':_0x57c1ce(0xd2)},{'s':_0x57c1ce(0x143),'t':_0x57c1ce(0x126)}];else _0x97b928===_0x57c1ce(0x146)&&(_0x1ea007=[{'s':_0x57c1ce(0x14b),'t':'.1.LEVEL'},{'s':'.1.TEMPERATURE','t':_0x57c1ce(0x116)},{'s':_0x57c1ce(0x107),'t':'.4.VALVE_STATE'},{'s':'local_temperature','t':_0x57c1ce(0xe2)},{'s':'temperature','t':_0x57c1ce(0xc1)},{'s':_0x57c1ce(0x143),'t':_0x57c1ce(0x108)}]);for(const _0x244169 of _0x1ea007){if(_0x1f4f50[_0x57c1ce(0x118)](_0x244169['s'])){const _0x4df89f=_0x1f4f50[_0x57c1ce(0x117)](_0x244169['s'],_0x244169['t']),_0x562073=await _0x1b4787[_0x57c1ce(0x168)](_0x4df89f);if(_0x562073)return _0x4df89f;}}try{const _0x4d67cf=_0x1f4f50[_0x57c1ce(0x144)]('.');if(_0x4d67cf['length']>0x2){const _0x34b620=_0x4d67cf[_0x57c1ce(0xe0)](0x0,-0x1)[_0x57c1ce(0xdb)]('.'),_0x509690=await _0x1b4787[_0x57c1ce(0xe9)](_0x34b620+'.*'),_0x207e07=[],_0x55b944=_0x1f4f50[_0x57c1ce(0x144)](/[._]+/)['filter'](_0x1ad905=>![_0x57c1ce(0x154),'0','hm-rpc',_0x57c1ce(0xc7),_0x57c1ce(0xeb),_0x57c1ce(0x143),'actual',_0x57c1ce(0xda),_0x57c1ce(0x106),_0x57c1ce(0xe6)]['includes'](_0x1ad905[_0x57c1ce(0x13d)]()));for(const [_0x9aea49,_0x2ee032]of Object[_0x57c1ce(0x102)](_0x509690)){if(_0x9aea49===_0x1f4f50)continue;if(_0x2ee032&&_0x2ee032[_0x57c1ce(0xcb)]){const _0xd2602f=_0x9aea49['toLowerCase'](),_0x3afbfb=(_0x2ee032['common'][_0x57c1ce(0xd4)]||'')[_0x57c1ce(0x13d)](),_0xd00f19=(_0x2ee032[_0x57c1ce(0xcb)][_0x57c1ce(0xd8)]||'')[_0x57c1ce(0x13d)]();let _0x1e40d6=![];if(_0x97b928===_0x57c1ce(0x126)&&_0x2ee032[_0x57c1ce(0xcb)][_0x57c1ce(0xba)]===!![])_0x1e40d6=_0xd2602f[_0x57c1ce(0x118)]('set')||_0xd2602f['includes']('soll')||_0xd2602f[_0x57c1ce(0x118)](_0x57c1ce(0x103))||_0x3afbfb['includes']('level.temperature')||_0x3afbfb[_0x57c1ce(0x118)](_0x57c1ce(0xcf));else _0x97b928===_0x57c1ce(0x146)&&(_0x1e40d6=_0xd2602f[_0x57c1ce(0x118)]('level')||_0xd2602f[_0x57c1ce(0x118)]('valve')||_0xd2602f[_0x57c1ce(0x118)](_0x57c1ce(0x161))||_0xd2602f[_0x57c1ce(0x118)](_0x57c1ce(0x12a))||_0x3afbfb['includes'](_0x57c1ce(0xb1))||_0x3afbfb[_0x57c1ce(0x118)]('value.valve')||_0xd00f19[_0x57c1ce(0x118)]('%'));if(_0x1e40d6){const _0x4a87ad=_0x9aea49['split'](/[._]+/)['map'](_0x3ab340=>_0x3ab340[_0x57c1ce(0x13d)]());let _0x487769=0x0;_0x55b944[_0x57c1ce(0x157)](_0x6dabac=>{const _0x35a9ea=_0x57c1ce;if(_0x4a87ad[_0x35a9ea(0x118)](_0x6dabac[_0x35a9ea(0x13d)]()))_0x487769++;}),_0x207e07[_0x57c1ce(0x13f)]({'id':_0x9aea49,'score':_0x487769});}}}if(_0x207e07[_0x57c1ce(0x14c)]>0x0){_0x207e07['sort']((_0x6b70ce,_0x4b55c8)=>_0x4b55c8[_0x57c1ce(0x130)]-_0x6b70ce[_0x57c1ce(0x130)]);if(_0x207e07[0x0][_0x57c1ce(0x130)]>0x0)return _0x207e07[0x0]['id'];}}}catch(_0x157a0b){}return null;}async function scanThermostats(_0x179865){const _0x509286=a1_0x92365a,_0xa405c9=_0x179865[_0x509286(0x158)][_0x509286(0xea)]||[],_0x2689d0=[],_0x373983=_0xa405c9['filter'](_0x28c29d=>_0x28c29d['id']&&_0x28c29d['id']['includes'](_0x509286(0x143))||_0x28c29d[_0x509286(0x127)]&&[_0x509286(0x143),_0x509286(0x131),_0x509286(0xda)][_0x509286(0x118)](_0x28c29d[_0x509286(0x127)])||_0x28c29d[_0x509286(0x104)]&&_0x28c29d['name']['toLowerCase']()[_0x509286(0x118)](_0x509286(0xd5)));for(const _0x124a88 of _0x373983){const _0x48c7d3=await findRelatedId(_0x179865,_0x124a88['id'],_0x509286(0x126)),_0x1d3de8=await findRelatedId(_0x179865,_0x124a88['id'],_0x509286(0x146));let _0x268c9d='Nicht\x20gefunden',_0x3f9244=![],_0x244747=_0x179865[_0x509286(0x158)]['thermostatMapping']||{};if(typeof _0x244747===_0x509286(0xdd))try{_0x244747=JSON['parse'](_0x244747);}catch(_0x380e8b){}let _0x12c0f0=_0x179865[_0x509286(0x158)][_0x509286(0x14f)]||{};if(typeof _0x12c0f0==='string')try{_0x12c0f0=JSON['parse'](_0x12c0f0);}catch(_0x30a6a6){}if(_0x244747[_0x124a88['id']]&&_0x244747[_0x124a88['id']]===_0x48c7d3||_0x12c0f0[_0x124a88['id']]&&_0x12c0f0[_0x124a88['id']]===_0x1d3de8)_0x268c9d=_0x509286(0x16b),_0x3f9244=!![];else(_0x48c7d3||_0x1d3de8)&&(_0x268c9d=_0x509286(0xb3));_0x2689d0[_0x509286(0x13f)]({'room':_0x124a88[_0x509286(0x166)]||_0x509286(0xc4),'sensorId':_0x124a88['id'],'setpointId':_0x48c7d3||'-','valveId':_0x1d3de8||'-','source':_0x268c9d,'isManual':_0x3f9244,'status':_0x48c7d3&&_0x1d3de8?_0x509286(0x133):_0x48c7d3?'OK':_0x509286(0x11c)});}return _0x2689d0[_0x509286(0x156)]((_0x45985c,_0x10aa2d)=>_0x45985c[_0x509286(0x109)]['localeCompare'](_0x10aa2d[_0x509286(0x109)]));}async function updateSchedulePreview(_0x2adb8a){const _0x2c924a=a1_0x92365a;if(!_0x2adb8a['config'][_0x2c924a(0x152)]||!_0x2adb8a[_0x2c924a(0x158)][_0x2c924a(0xdf)])return;let _0x20e3da={};try{const _0x316de3=await _0x2adb8a['getStateAsync']('analysis.energy.warmupTimes');if(_0x316de3&&_0x316de3[_0x2c924a(0xb4)])_0x20e3da=JSON[_0x2c924a(0xe8)](_0x316de3[_0x2c924a(0xb4)]);}catch(_0x478e81){}const _0x24bd2f=[],_0x3f6902=Date[_0x2c924a(0x12d)](),_0x454843=0x30*0x3c*0x3c*0x3e8;try{const _0x7befbd=await _0x2adb8a[_0x2c924a(0x162)](_0x2adb8a[_0x2c924a(0x158)]['calendarInstance']+_0x2c924a(0x12e));if(!_0x7befbd||!_0x7befbd[_0x2c924a(0xb4)])return;const _0x535cdf=JSON[_0x2c924a(0xe8)](_0x7befbd[_0x2c924a(0xb4)]),_0x37d28e=_0x2adb8a[_0x2c924a(0x158)][_0x2c924a(0x14d)]||[],_0x5da4b5=_0x2adb8a[_0x2c924a(0x158)]['devices']||[],_0xa30a15=new Set();_0x5da4b5[_0x2c924a(0x157)](_0x5cb2f3=>{const _0x2b8730=_0x2c924a;if(_0x5cb2f3[_0x2b8730(0x166)])_0xa30a15[_0x2b8730(0x120)](_0x5cb2f3[_0x2b8730(0x166)]);});for(const _0x3dea58 of _0x535cdf){if(_0x3dea58[_0x2c924a(0x10e)]&&_0x37d28e['length']>0x0&&!_0x37d28e['includes'](_0x3dea58['_calName']))continue;const _0x48182f=_0x3dea58[_0x2c924a(0xb5)]||_0x3dea58[_0x2c924a(0x139)]||_0x3dea58[_0x2c924a(0x11a)];if(!_0x48182f)continue;const _0x4a6401=new Date(_0x48182f),_0x1ebabd=_0x4a6401[_0x2c924a(0xb9)]();if(isNaN(_0x1ebabd))continue;if(_0x1ebabd<_0x3f6902)continue;if(_0x1ebabd>_0x3f6902+_0x454843)continue;const _0xcb8a41=(_0x3dea58[_0x2c924a(0x11f)]||_0x3dea58['summary']||'')[_0x2c924a(0x13d)]();let _0x37b294=![],_0x2c53ce=[],_0x3120b2=_0x3dea58['event']||_0x3dea58[_0x2c924a(0xf6)]||_0x2c924a(0xc4);if(_0xcb8a41[_0x2c924a(0x118)](_0x2c924a(0x13b))||_0xcb8a41[_0x2c924a(0x118)](_0x2c924a(0xd6))||_0xcb8a41[_0x2c924a(0x118)](_0x2c924a(0xe7)))_0x37b294=!![],_0x2c53ce=Array['from'](_0xa30a15);else for(const _0x188024 of _0xa30a15){if(_0xcb8a41[_0x2c924a(0x118)](_0x188024['toLowerCase']()))_0x2c53ce[_0x2c924a(0x13f)](_0x188024);}_0x2c53ce[_0x2c924a(0x14c)]>0x0&&_0x2c53ce[_0x2c924a(0x157)](_0x627676=>{const _0x5c2cbc=_0x2c924a;let _0x2d3711=0x3c;if(_0x37b294){let _0x13b9fd=0x0;Object[_0x5c2cbc(0x15b)](_0x20e3da)[_0x5c2cbc(0x157)](_0x42dd5c=>{if(_0x42dd5c>_0x13b9fd)_0x13b9fd=_0x42dd5c;}),_0x2d3711=_0x13b9fd>0x0?_0x13b9fd:0x78;}else _0x2d3711=_0x20e3da[_0x627676]||0x3c;const _0x1610c1=new Date(_0x1ebabd-_0x2d3711*0xea60);_0x24bd2f[_0x5c2cbc(0x13f)]({'eventTime':_0x1ebabd,'triggerTime':_0x1610c1[_0x5c2cbc(0xb9)](),'room':_0x627676,'minutes':_0x2d3711,'reason':_0x3120b2,'isGlobal':_0x37b294});});}}catch(_0x546f8c){}_0x24bd2f['sort']((_0xed7f29,_0x2882ea)=>_0xed7f29['triggerTime']-_0x2882ea[_0x2c924a(0x111)]);const _0x4da6f0=_0x24bd2f[_0x2c924a(0xe0)](0x0,0x5);await _0x2adb8a['setStateAsync'](_0x2c924a(0xf9),{'val':JSON[_0x2c924a(0xd7)](_0x4da6f0),'ack':!![]});}async function monitorEnforcements(_0x6b121a){const _0x9cefef=a1_0x92365a;try{const _0x52aa19=_0x9cefef(0x113),_0x2bd00c=await _0x6b121a['getStateAsync'](_0x52aa19);if(!_0x2bd00c||!_0x2bd00c[_0x9cefef(0xb4)])return;let _0x13dc04=[];try{_0x13dc04=JSON[_0x9cefef(0xe8)](_0x2bd00c['val']);}catch(_0x1b98a5){return;}if(!Array[_0x9cefef(0x100)](_0x13dc04)||_0x13dc04['length']===0x0)return;const _0x24f04f=Date[_0x9cefef(0x12d)](),_0x2e4d3d=_0x6b121a[_0x9cefef(0x158)]['devices']||[];let _0x348a88=![];for(let _0x212d0e=_0x13dc04[_0x9cefef(0x14c)]-0x1;_0x212d0e>=0x0;_0x212d0e--){const _0x1f6c8=_0x13dc04[_0x212d0e];if(_0x24f04f>=_0x1f6c8[_0x9cefef(0x123)]){_0x6b121a[_0x9cefef(0xbd)]['info']('ðŸ“…\x20[ENFORCEMENT]\x20Kalender-Event\x20in\x20'+_0x1f6c8['room']+_0x9cefef(0xb7)),_0x13dc04['splice'](_0x212d0e,0x1),_0x348a88=!![];continue;}const _0x3a868f=_0x2e4d3d[_0x9cefef(0x11b)](_0x42f478=>normalize(_0x42f478[_0x9cefef(0x166)])===normalize(_0x1f6c8['room'])&&(_0x42f478['type']===_0x9cefef(0x143)||_0x42f478[_0x9cefef(0x127)]===_0x9cefef(0x131)));if(_0x3a868f){const _0x34726d=await findRelatedId(_0x6b121a,_0x3a868f['id'],_0x9cefef(0x126));if(_0x34726d){const _0x3ffa17=await _0x6b121a[_0x9cefef(0x162)](_0x34726d);_0x3ffa17&&typeof _0x3ffa17[_0x9cefef(0xb4)]===_0x9cefef(0x137)&&(_0x3ffa17[_0x9cefef(0xb4)]<0xf&&(_0x6b121a[_0x9cefef(0xbd)][_0x9cefef(0xc0)]('ðŸš¨\x20[ENFORCEMENT]\x20Hardware-Profil\x20hat\x20'+_0x1f6c8[_0x9cefef(0x109)]+_0x9cefef(0xee)+_0x3ffa17[_0x9cefef(0xb4)]+_0x9cefef(0xfa)+_0x1f6c8[_0x9cefef(0x103)]+_0x9cefef(0xcc)),await _0x6b121a[_0x9cefef(0xf2)](_0x34726d,_0x1f6c8[_0x9cefef(0x103)]),await logAutomationAction(_0x6b121a,_0x9cefef(0xf0)+_0x1f6c8['room']+':\x20'+_0x3ffa17['val']+_0x9cefef(0xe1)+_0x1f6c8[_0x9cefef(0x103)]+'Â°C\x20(Kalender-Schutz)')));}}}_0x348a88&&await _0x6b121a[_0x9cefef(0x101)](_0x52aa19,{'val':JSON[_0x9cefef(0xd7)](_0x13dc04),'ack':!![]});}catch(_0x27617a){_0x6b121a[_0x9cefef(0xbd)][_0x9cefef(0x125)]('Enforcement\x20Monitor\x20Error:\x20'+_0x27617a[_0x9cefef(0xc8)]);}}async function checkCalendarTriggers(_0x1acf88){const _0x3350bb=a1_0x92365a;if(!_0x1acf88[_0x3350bb(0x158)][_0x3350bb(0x152)]||!_0x1acf88[_0x3350bb(0x158)][_0x3350bb(0xdf)])return;await updateSchedulePreview(_0x1acf88);let _0x20dc73={},_0x4e2465={};try{const _0x2b4e29=await _0x1acf88['getStateAsync'](_0x3350bb(0xdc));if(_0x2b4e29&&_0x2b4e29[_0x3350bb(0xb4)])_0x20dc73=JSON[_0x3350bb(0xe8)](_0x2b4e29[_0x3350bb(0xb4)]);const _0x268771=await _0x1acf88[_0x3350bb(0x115)](_0x3350bb(0xfb));if(_0x268771&&_0x268771[_0x3350bb(0xb4)])_0x4e2465=JSON[_0x3350bb(0xe8)](_0x268771[_0x3350bb(0xb4)]);}catch(_0x52e5e7){}let _0x56186d={'default':0x15};try{const _0x392321=await _0x1acf88['getStateAsync'](_0x3350bb(0xef));if(_0x392321&&_0x392321[_0x3350bb(0xb4)])_0x56186d=JSON['parse'](_0x392321['val']);}catch(_0x29437c){}let _0xb2f502=[];try{const _0x27d980=await _0x1acf88[_0x3350bb(0x115)]('analysis.energy.activeEnforcements');if(_0x27d980&&_0x27d980['val'])_0xb2f502=JSON[_0x3350bb(0xe8)](_0x27d980['val']);}catch(_0xce566f){}try{const _0x327a18=await _0x1acf88[_0x3350bb(0x162)](_0x1acf88[_0x3350bb(0x158)][_0x3350bb(0xdf)]+_0x3350bb(0x12e));if(!_0x327a18||!_0x327a18[_0x3350bb(0xb4)])return;const _0xe2b1d9=JSON[_0x3350bb(0xe8)](_0x327a18[_0x3350bb(0xb4)]),_0x1c1700=Date[_0x3350bb(0x12d)](),_0x326cf8=_0x1acf88[_0x3350bb(0x158)][_0x3350bb(0xea)]||[],_0x5ae1fd=_0x1acf88[_0x3350bb(0x158)][_0x3350bb(0x14d)]||[];let _0x35e665=![];for(const _0x21b77f of _0xe2b1d9){if(_0x21b77f['_calName']&&_0x5ae1fd[_0x3350bb(0x14c)]>0x0&&!_0x5ae1fd[_0x3350bb(0x118)](_0x21b77f[_0x3350bb(0x10e)]))continue;const _0x3dbf91=_0x21b77f[_0x3350bb(0xb5)]||_0x21b77f[_0x3350bb(0x139)]||_0x21b77f[_0x3350bb(0x11a)];if(!_0x3dbf91)continue;const _0x3f5ea2=new Date(_0x3dbf91);if(isNaN(_0x3f5ea2['getTime']()))continue;const _0x20380b=(_0x21b77f[_0x3350bb(0x11f)]||_0x21b77f[_0x3350bb(0xf6)]||'')[_0x3350bb(0x13d)]();if(_0x20380b['includes'](_0x3350bb(0x13b))||_0x20380b['includes'](_0x3350bb(0xd6))||_0x20380b['includes']('ankunft')){let _0x2a7fbe=0x0;Object[_0x3350bb(0x15b)](_0x20dc73)[_0x3350bb(0x157)](_0x311fcd=>{if(_0x311fcd>_0x2a7fbe)_0x2a7fbe=_0x311fcd;});if(_0x2a7fbe===0x0)_0x2a7fbe=0x78;const _0x584566=_0x3f5ea2[_0x3350bb(0xb9)]()-_0x2a7fbe*0xea60;_0x1c1700>=_0x584566&&_0x1c1700<_0x3f5ea2[_0x3350bb(0xb9)]()&&(_0x1acf88['currentSystemMode']!==_0x3350bb(0x167)&&(_0x1acf88['log'][_0x3350bb(0xca)](_0x3350bb(0xbc)+_0x2a7fbe+_0x3350bb(0x121)),await _0x1acf88[_0x3350bb(0x101)](_0x3350bb(0xed),{'val':_0x3350bb(0x167),'ack':![]})));}for(const _0x268c31 of _0x326cf8){if(_0x268c31[_0x3350bb(0x166)]){const _0xd6862a=_0x268c31[_0x3350bb(0x166)][_0x3350bb(0x13d)](),_0xbf4257=(_0x268c31[_0x3350bb(0x104)]||'')[_0x3350bb(0x13d)]();let _0x2b02d1=_0x20380b[_0x3350bb(0x118)](_0xd6862a);!_0x2b02d1&&_0xbf4257[_0x3350bb(0x14c)]>0x3&&_0x20380b[_0x3350bb(0x118)](_0xbf4257)&&(_0x2b02d1=!![]);if(_0x2b02d1){const _0x55b1c9=_0x20dc73[_0x268c31[_0x3350bb(0x166)]]||0x3c,_0x43661f=_0x4e2465[_0x268c31[_0x3350bb(0x166)]]||_0x3350bb(0xb2),_0x161414=_0x3f5ea2[_0x3350bb(0xb9)]()-_0x55b1c9*0xea60;if(_0x1c1700>=_0x161414&&_0x1c1700<_0x3f5ea2[_0x3350bb(0xb9)]()){const _0x12d00c=lastActions[_0x3350bb(0x169)+_0x268c31[_0x3350bb(0x166)]];if(_0x12d00c&&_0x1c1700-_0x12d00c<CAL_COOLDOWN_MS)continue;const _0xb84a25=await findRelatedId(_0x1acf88,_0x268c31['id'],_0x3350bb(0x126));if(_0xb84a25){let _0x5cda34=_0x56186d[_0x268c31[_0x3350bb(0x166)]];if(_0x5cda34===undefined)_0x5cda34=_0x56186d[_0x3350bb(0x153)];if(_0x5cda34===undefined)_0x5cda34=0x15;const _0x11fb1a=await _0x1acf88['getForeignStateAsync'](_0xb84a25);if(_0x11fb1a&&typeof _0x11fb1a[_0x3350bb(0xb4)]===_0x3350bb(0x137)&&_0x11fb1a[_0x3350bb(0xb4)]<_0x5cda34-0.5){_0x1acf88[_0x3350bb(0xbd)][_0x3350bb(0xca)]('ðŸ“…\x20SMART\x20SCHEDULE\x20['+_0x43661f+']:\x20Raum-Trigger\x20\x27'+_0x268c31[_0x3350bb(0x166)]+_0x3350bb(0x114)+_0x20380b+_0x3350bb(0xc5)+_0x5cda34+_0x3350bb(0x155)+_0x55b1c9+'\x20min).'),await _0x1acf88['setForeignStateAsync'](_0xb84a25,_0x5cda34),await logAutomationAction(_0x1acf88,_0x3350bb(0x142)+_0x268c31['location']+_0x3350bb(0x10a)+_0x5cda34+_0x3350bb(0xfd)+_0x43661f+')'),lastActions[_0x3350bb(0x169)+_0x268c31['location']]=_0x1c1700;const _0x750308=_0xb2f502[_0x3350bb(0x10c)](_0x4ec8f6=>_0x4ec8f6[_0x3350bb(0x109)]===_0x268c31['location']);if(_0x750308!==-0x1)_0xb2f502[_0x3350bb(0x134)](_0x750308,0x1);_0xb2f502[_0x3350bb(0x13f)]({'room':_0x268c31[_0x3350bb(0x166)],'target':_0x5cda34,'until':_0x3f5ea2[_0x3350bb(0xb9)]()}),_0x35e665=!![];}}}}}}}_0x35e665&&await _0x1acf88[_0x3350bb(0x101)](_0x3350bb(0x113),{'val':JSON['stringify'](_0xb2f502),'ack':!![]});}catch(_0x3bb714){_0x1acf88['log'][_0x3350bb(0xc0)]('Calendar\x20Check\x20Error:\x20'+_0x3bb714[_0x3350bb(0xc8)]);}}function a1_0x3d33(_0x7f22e,_0x49899d){const _0x51ccc0=a1_0x11eb();return a1_0x3d33=function(_0x4115f8,_0x441b13){_0x4115f8=_0x4115f8-0xb1;let _0x11ebaa=_0x51ccc0[_0x4115f8];return _0x11ebaa;},a1_0x3d33(_0x7f22e,_0x49899d);}function a1_0x11eb(){const _0xfaa7eb=['Â°C\x20abgesenkt!\x20Zwinge\x20zurÃ¼ck\x20auf\x20','analysis.energy.warmupSources','Â°C!\x20(Puffer\x20leer).','Â°C\x20(via\x20','Ist','\x20durch\x20Kalender\x20geÃ¤ndert.\x20Keine\x20RL-Strafe.','isArray','setStateAsync','entries','target','name','apply','messwert','.1.TEMPERATURE','level','room','\x20->\x20','dimmer','findIndex','ðŸ§¹\x20[MPC\x20CLEANUP]\x20Raum\x20\x27','_calName','2607234bzzsJK',':\x20Aufheizen\x20auf\x20','triggerTime','rescue_','analysis.energy.activeEnforcements','\x27\x20(Match:\x20','getStateAsync','.1.LEVEL','replace','includes','target_temperature','date','find','Fehlt','7084525qHAXxe','Â°C!\x20(Puffer:\x20','event','add','\x20min).','[WATCHDOG]\x20','until','consultButler','error','setpoint','type','\x20wurde\x20manuell\x20erhÃ¶ht.','.4.SET_TEMPERATURE','position','filter','manual','now','.data.table','4699936pDJOnq','score','thermostat','local_temperature','PERFECT','splice','contact','4LQTYKG','number','open','eventStart','ðŸƒ\x20[MPC\x20ACTION]\x20Senke\x20','urlaub\x20ende','off','toLowerCase','ACTUAL','push','415115pnfBFr','reason','[CAL]\x20','temperature','split','\x20->\x20Schalte\x20','valve','(((.+)+)+)+$','Â°C\x20(nicht\x20','ðŸ“…\x20[MPC\x20INFO]\x20','PrÃ¤diktion:\x20','.1.ACTUAL_TEMPERATURE','length','calendarSelection','[MPC]\x20','valveMapping','Â°C\x20<\x20','too_cold','useCalendar','default','openknx','Â°C\x20(Vorlauf:\x20','sort','forEach','config','remove','trim','values','analysis.energy.mpcActiveInterventions','toString','minutes_safe','5960375UMoQZN','[MPC\x20WARNING]\x20Kein\x20Setpoint\x20fÃ¼r\x20','stellwert','getForeignStateAsync','approved','constructor','search','location','normal','getForeignObjectAsync','cal_','analysis.automation.mode','Manuelles\x20Mapping','level.valve','Classic','Auto-Erkennung','val','_date','ðŸŒ¬ï¸\x20[MPC\x20WATCHDOG]\x20','\x20gestartet/vorbei.\x20Gebe\x20Raum\x20frei.','ðŸ§¹\x20[MPC\x20CLEANUP]\x20','getTime','write','exports','ðŸ“…\x20SMART\x20SCHEDULE\x20(Phase):\x20\x27Globaler\x20Start\x27\x20erkannt.\x20Heize\x20Haus\x20auf\x20(Vorlauf:\x20','log','light','./ai_agent','warn','valve_position','occupied_heating_setpoint','Â°C).\x20Entferne\x20Status.','Unbekannt',')\x20aktiv.\x20Heize\x20auf\x20','Unknown','ist','message','unshift','info','common','Â°C.','3848KCoiyR','ðŸŽ“\x20[RL-FEEDBACK]\x20Lerne\x20aus\x20Fehler:\x20','thermostat.setpoint','analysis.automation.confidenceThreshold','TRAIN_RL_PENALTY','Soll','analysis.automation.lastAction','role','temp','rÃ¼ckkehr','stringify','unit','\x20gefunden!','sensor','join','analysis.energy.warmupTimes','string','mpc_','calendarInstance','slice','Â°C\x20->\x20','pi_heating_demand','ðŸ”¥\x20[MPC\x20ACTION]\x20Heize\x20','SET','3354ljYpvm','state','ankunft','parse','getForeignObjectsAsync','devices','wert','switch','system.mode','\x20auf\x20','analysis.energy.warmupTargets','[FORCE]\x20','130473kDSLLd','setForeignStateAsync','SET_POINT_TEMPERATURE','\x27\x20hat\x20kein\x20GerÃ¤t\x20mehr.\x20LÃ¶sche\x20Eintrag.',':\x20Puffer\x20leer\x20->\x20Heizen\x20auf\x20','summary','current_heating_setpoint','window','analysis.energy.schedulePreview'];a1_0x11eb=function(){return _0xfaa7eb;};return a1_0x11eb();}async function manageMpcIntervention(_0x4cca8c,_0x552f66,_0x56bb38){const _0x3ac7a4=a1_0x92365a;try{const _0x22bfe5='analysis.energy.mpcActiveInterventions',_0x198028=await _0x4cca8c[_0x3ac7a4(0x115)](_0x22bfe5);let _0x3d61be=[];if(_0x198028&&_0x198028[_0x3ac7a4(0xb4)])try{_0x3d61be=JSON[_0x3ac7a4(0xe8)](_0x198028['val']);}catch(_0x19c495){}const _0x3af8db=_0x3d61be['indexOf'](_0x552f66);if(_0x56bb38===_0x3ac7a4(0x120))_0x3af8db===-0x1&&(_0x3d61be[_0x3ac7a4(0x13f)](_0x552f66),await _0x4cca8c[_0x3ac7a4(0x101)](_0x22bfe5,{'val':JSON[_0x3ac7a4(0xd7)](_0x3d61be),'ack':!![]}));else _0x56bb38==='remove'&&(_0x3af8db!==-0x1&&(_0x3d61be['splice'](_0x3af8db,0x1),await _0x4cca8c[_0x3ac7a4(0x101)](_0x22bfe5,{'val':JSON[_0x3ac7a4(0xd7)](_0x3d61be),'ack':!![]})));}catch(_0x499ca6){}}async function cleanupGhostInterventions(_0x2899dc){const _0x3ceabf=a1_0x92365a;try{const _0x47258a=_0x3ceabf(0x15c),_0x1feccc=await _0x2899dc[_0x3ceabf(0x115)](_0x47258a);if(!_0x1feccc||!_0x1feccc[_0x3ceabf(0xb4)])return;const _0x47f5c5=JSON['parse'](_0x1feccc[_0x3ceabf(0xb4)]);if(!Array['isArray'](_0x47f5c5)||_0x47f5c5[_0x3ceabf(0x14c)]===0x0)return;let _0x291fe9={'default':0x15};try{const _0x52e0b9=await _0x2899dc[_0x3ceabf(0x115)](_0x3ceabf(0xef));if(_0x52e0b9&&_0x52e0b9['val'])_0x291fe9=JSON[_0x3ceabf(0xe8)](_0x52e0b9[_0x3ceabf(0xb4)]);}catch(_0x2c68b0){}let _0x1d52c3=[];try{const _0x49032f=await _0x2899dc[_0x3ceabf(0x115)]('analysis.energy.ventilationAlerts');if(_0x49032f&&_0x49032f[_0x3ceabf(0xb4)])_0x1d52c3=JSON[_0x3ceabf(0xe8)](_0x49032f['val']);}catch(_0x6740bf){}const _0x543f62=_0x2899dc[_0x3ceabf(0x158)][_0x3ceabf(0xea)]||[];let _0x53536c=![];for(let _0x4102aa=_0x47f5c5['length']-0x1;_0x4102aa>=0x0;_0x4102aa--){const _0x31d9b5=_0x47f5c5[_0x4102aa],_0x5b20e0=_0x543f62[_0x3ceabf(0x11b)](_0x8fac83=>normalize(_0x8fac83[_0x3ceabf(0x166)])===normalize(_0x31d9b5)&&(_0x8fac83[_0x3ceabf(0x127)]===_0x3ceabf(0x143)||_0x8fac83['type']===_0x3ceabf(0x131)));if(!_0x5b20e0){_0x2899dc['log'][_0x3ceabf(0xc0)](_0x3ceabf(0x10d)+_0x31d9b5+_0x3ceabf(0xf4)),_0x47f5c5[_0x3ceabf(0x134)](_0x4102aa,0x1),_0x53536c=!![];continue;}if(_0x5b20e0){const _0x5c8b9b=await findRelatedId(_0x2899dc,_0x5b20e0['id'],_0x3ceabf(0x126)),_0x47d262=await _0x2899dc[_0x3ceabf(0x162)](_0x5b20e0['id']);if(_0x5c8b9b){const _0x5da49e=await _0x2899dc[_0x3ceabf(0x162)](_0x5c8b9b);if(_0x5da49e&&typeof _0x5da49e['val']===_0x3ceabf(0x137)){let _0x334252=![],_0x3937d0='';Math['abs'](_0x5da49e[_0x3ceabf(0xb4)]-ECO_TEMP)>0.5&&(_0x334252=!![],_0x3937d0=_0x3ceabf(0x12c));if(!_0x334252&&_0x47d262&&typeof _0x47d262[_0x3ceabf(0xb4)]==='number'){const _0x521700=_0x291fe9[_0x31d9b5]||_0x291fe9['default']||0x15;_0x47d262[_0x3ceabf(0xb4)]<_0x521700+0.2&&(_0x334252=!![],_0x3937d0=_0x3ceabf(0x151));}if(_0x334252){if(_0x3937d0===_0x3ceabf(0x12c)){_0x2899dc['log'][_0x3ceabf(0xca)](_0x3ceabf(0xb8)+_0x31d9b5+'\x20ist\x20auf\x20'+_0x5da49e['val']+_0x3ceabf(0x148)+ECO_TEMP+_0x3ceabf(0xc3));const _0x946fbb=lastActions[_0x3ceabf(0x169)+_0x31d9b5],_0x80bafd=_0x946fbb&&Date[_0x3ceabf(0x12d)]()-_0x946fbb<0x2*0x3c*0x3e8;if(!_0x80bafd&&_0x5da49e[_0x3ceabf(0xb4)]>ECO_TEMP+0.5)_0x2899dc['sendToPythonWrapper']&&(_0x2899dc[_0x3ceabf(0xbd)][_0x3ceabf(0xca)](_0x3ceabf(0xce)+_0x31d9b5+_0x3ceabf(0x128)),_0x2899dc['sendToPythonWrapper'](_0x3ceabf(0xd1),{'room':_0x31d9b5}));else _0x80bafd&&_0x2899dc['log']['info'](_0x3ceabf(0x149)+_0x31d9b5+_0x3ceabf(0xff));}else{if(_0x3937d0===_0x3ceabf(0x151)){let _0x13c666=![];if(_0x1d52c3[_0x3ceabf(0x11b)](_0x3d8a5f=>_0x3d8a5f[_0x3ceabf(0x109)]===_0x31d9b5))_0x13c666=!![];const _0x12ea72=_0x543f62[_0x3ceabf(0x12b)](_0xa4b6ef=>normalize(_0xa4b6ef[_0x3ceabf(0x166)])===normalize(_0x31d9b5)&&(_0xa4b6ef[_0x3ceabf(0x127)]===_0x3ceabf(0xf8)||_0xa4b6ef[_0x3ceabf(0x127)]===_0x3ceabf(0xda)||_0xa4b6ef['type']===_0x3ceabf(0x135)));for(const _0x52b5ae of _0x12ea72){try{const _0x402a52=await _0x2899dc[_0x3ceabf(0x162)](_0x52b5ae['id']);if(_0x402a52&&(_0x402a52[_0x3ceabf(0xb4)]===!![]||_0x402a52[_0x3ceabf(0xb4)]===0x1||String(_0x402a52['val'])[_0x3ceabf(0x13d)]()===_0x3ceabf(0x138)))_0x13c666=!![];}catch(_0x3e5fa9){}}if(_0x13c666)_0x2899dc['log']['info'](_0x3ceabf(0xb6)+_0x31d9b5+'\x20ist\x20zu\x20kalt,\x20ABER\x20Fenster\x20offen/LÃ¼ftung\x20erkannt.\x20Heize\x20NICHT,\x20entferne\x20nur\x20Status.');else{const _0x331de8=_0x291fe9[_0x31d9b5]||_0x291fe9[_0x3ceabf(0x153)]||0x15;_0x2899dc[_0x3ceabf(0xbd)][_0x3ceabf(0xca)]('ðŸš¨\x20[MPC\x20WATCHDOG]\x20'+_0x31d9b5+'\x20erreicht\x20Limit\x20('+_0x47d262[_0x3ceabf(0xb4)]+_0x3ceabf(0x150)+(_0x331de8+0.2)+'Â°C).\x20Sparmodus\x20beendet!'),await _0x2899dc[_0x3ceabf(0xf2)](_0x5c8b9b,_0x331de8),await logAutomationAction(_0x2899dc,_0x3ceabf(0x122)+_0x31d9b5+_0x3ceabf(0xf5)+_0x331de8+'Â°C'),lastActions[_0x3ceabf(0x112)+_0x31d9b5]=Date[_0x3ceabf(0x12d)]();}}}_0x47f5c5[_0x3ceabf(0x134)](_0x4102aa,0x1),_0x53536c=!![];}}}}}_0x53536c&&await _0x2899dc[_0x3ceabf(0x101)](_0x47258a,{'val':JSON[_0x3ceabf(0xd7)](_0x47f5c5),'ack':!![]});}catch(_0xf32c68){}}async function applyEnergySavings(_0x322d6c,_0x273e28){const _0x2832bb=a1_0x92365a;await cleanupGhostInterventions(_0x322d6c);if(!_0x273e28||_0x273e28[_0x2832bb(0x14c)]===0x0)return;const _0x2f0ac3=_0x322d6c[_0x2832bb(0x158)][_0x2832bb(0xea)]||[],_0x44af19=Date[_0x2832bb(0x12d)]();for(const _0x2b55f4 of _0x273e28){const _0x163181=_0x2b55f4[_0x2832bb(0x109)],_0x5ec250=_0x2b55f4[_0x2832bb(0x15e)],_0x29d51c=_0x2b55f4['target']||0x15;if(lastActions[_0x2832bb(0x112)+_0x163181]&&_0x44af19-lastActions[_0x2832bb(0x112)+_0x163181]<RESCUE_LOCK_MS)continue;const _0x3194e2=_0x2f0ac3[_0x2832bb(0x11b)](_0x303d18=>normalize(_0x303d18[_0x2832bb(0x166)])===normalize(_0x163181)&&(_0x303d18['type']===_0x2832bb(0x143)||_0x303d18[_0x2832bb(0x127)]===_0x2832bb(0x131)));if(!_0x3194e2)continue;const _0x41da69=await findRelatedId(_0x322d6c,_0x3194e2['id'],'setpoint');if(_0x41da69){if(lastActions['mpc_'+_0x163181]&&_0x44af19-lastActions[_0x2832bb(0xde)+_0x163181]<0x1e*0x3c*0x3e8)continue;const _0x1eed95=await _0x322d6c[_0x2832bb(0x162)](_0x41da69);if(_0x1eed95&&typeof _0x1eed95[_0x2832bb(0xb4)]===_0x2832bb(0x137)){const _0x40d126=_0x1eed95['val'];_0x40d126!==ECO_TEMP&&await manageMpcIntervention(_0x322d6c,_0x163181,_0x2832bb(0x159));if(_0x5ec250>0x1e)_0x40d126>ECO_TEMP+0.5&&(_0x322d6c['log'][_0x2832bb(0xca)](_0x2832bb(0x13a)+_0x163181+_0x2832bb(0xee)+ECO_TEMP+_0x2832bb(0x11e)+_0x5ec250+'\x20min)'),await _0x322d6c[_0x2832bb(0xf2)](_0x41da69,ECO_TEMP),await manageMpcIntervention(_0x322d6c,_0x163181,'add'),lastActions[_0x2832bb(0xde)+_0x163181]=_0x44af19,await logAutomationAction(_0x322d6c,_0x2832bb(0x14e)+_0x163181+':\x20Absenkung\x20auf\x20'+ECO_TEMP+'Â°C'));else _0x5ec250<=0xf&&(_0x40d126<_0x29d51c&&(_0x322d6c[_0x2832bb(0xbd)][_0x2832bb(0xca)](_0x2832bb(0xe3)+_0x163181+'\x20wieder\x20auf\x20'+_0x29d51c+_0x2832bb(0xfc)),await _0x322d6c[_0x2832bb(0xf2)](_0x41da69,_0x29d51c),await manageMpcIntervention(_0x322d6c,_0x163181,_0x2832bb(0x159)),lastActions['mpc_'+_0x163181]=_0x44af19,await logAutomationAction(_0x322d6c,_0x2832bb(0x14e)+_0x163181+_0x2832bb(0x110)+_0x29d51c+'Â°C')));}}else _0x322d6c['log'][_0x2832bb(0xc0)](_0x2832bb(0x160)+_0x163181+_0x2832bb(0xd9));}}module[a1_0x92365a(0xbb)]={'handlePrediction':handlePrediction,'applyEnergySavings':applyEnergySavings,'scanThermostats':scanThermostats,'checkCalendarTriggers':checkCalendarTriggers,'monitorEnforcements':monitorEnforcements,'updateSchedulePreview':updateSchedulePreview,'cleanupGhostInterventions':cleanupGhostInterventions};