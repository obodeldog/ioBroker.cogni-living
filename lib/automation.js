const a1_0x385f01=a1_0x2dba;(function(_0x9f5449,_0x9362a8){const _0x6c9ab5=a1_0x2dba,_0x1b564c=_0x9f5449();while(!![]){try{const _0x5e2e22=-parseInt(_0x6c9ab5(0xfd))/0x1+-parseInt(_0x6c9ab5(0x11d))/0x2*(parseInt(_0x6c9ab5(0x187))/0x3)+-parseInt(_0x6c9ab5(0x13a))/0x4+parseInt(_0x6c9ab5(0x114))/0x5+parseInt(_0x6c9ab5(0x160))/0x6+parseInt(_0x6c9ab5(0x16b))/0x7+parseInt(_0x6c9ab5(0x102))/0x8;if(_0x5e2e22===_0x9362a8)break;else _0x1b564c['push'](_0x1b564c['shift']());}catch(_0x2960ab){_0x1b564c['push'](_0x1b564c['shift']());}}}(a1_0x576c,0xde950));const a1_0x105948=(function(){let _0x43a038=!![];return function(_0x152e11,_0x2c6929){const _0x1150b4=_0x43a038?function(){if(_0x2c6929){const _0x2061d5=_0x2c6929['apply'](_0x152e11,arguments);return _0x2c6929=null,_0x2061d5;}}:function(){};return _0x43a038=![],_0x1150b4;};}()),a1_0x1649c0=a1_0x105948(this,function(){const _0x205fd5=a1_0x2dba;return a1_0x1649c0[_0x205fd5(0x185)]()[_0x205fd5(0x146)](_0x205fd5(0x16d))['toString']()[_0x205fd5(0x18b)](a1_0x1649c0)['search'](_0x205fd5(0x16d));});a1_0x1649c0();'use strict';const aiAgent=require(a1_0x385f01(0x179)),COOLDOWN_MS=0x3c*0x3e8,CAL_COOLDOWN_MS=0x5a*0x3c*0x3e8,ECO_TEMP=0x11,lastActions={};function a1_0x576c(){const _0x351bbd=['currentSystemMode','5292740pGHwDc','off','\x27\x20aktiv.\x20Heize\x20auf\x20','exports',']:\x20Raum-Trigger\x20\x27','.1.ACTUAL_TEMPERATURE','PERFECT','occupied_heating_setpoint','Unknown','stringify','number','[MPC\x20WARNING]\x20Kein\x20Setpoint\x20f√ºr\x20','search','üî•\x20[MPC\x20ACTION]\x20Heize\x20','¬∞C\x20(via\x20','event','add','getTime','¬∞C!\x20(Puffer\x20leer).','trim','messwert','approved','default','level','ACTUAL','consultButler','local_temperature','current_heating_setpoint','role','analysis.energy.mpcActiveInterventions','score','analysis.automation.lastAction','getStateAsync','Ist','Unbekannt','Calendar\x20Check\x20Error:\x20','thermostatMapping','Soll','1535376oVSamz','mpc_','parse','calendarInstance','slice','temperature','\x20wieder\x20auf\x20','¬∞C!\x20(Puffer:\x20','normal','getForeignStateAsync','openknx','11903395GAfgmG','.1.SET_POINT_TEMPERATURE','(((.+)+)+)+$','SET_POINT_TEMPERATURE','level.valve','getForeignObjectAsync','ist',':\x20Absenkung\x20auf\x20','split','name','triggerTime','valveMapping','toLowerCase','analysis.energy.warmupTargets','./ai_agent','target_temperature','analysis.energy.warmupTimes','eventStart','log','.1.LEVEL','length','ACTUAL_TEMPERATURE','value.valve','_date','light','summary','toString','setStateAsync','567606kEqCHx','useCalendar','unit','state','constructor','.1.TEMPERATURE','Nicht\x20gefunden','setpoint','forEach','remove','Classic','[MPC]\x20','cal_','1330706HYDKOy','type','now','active','.4.SET_TEMPERATURE','21277712NUeXJK','date','thermostat','¬∞C\x20(Vorlauf:\x20','position','find','devices','minutes_safe','_calName','filter','thermostat.setpoint','Pr√§diktion:\x20','.data.table','calendarSelection','Fehlt','valve','getForeignObjectsAsync','push','423520plQRyF','urlaub\x20ende','[CAL]\x20','analysis.energy.schedulePreview','Manuelles\x20Mapping','unshift','room','analysis.automation.actionLog','analysis.automation.confidenceThreshold','12mlGWHd','\x20->\x20Schalte\x20','level.temperature','r√ºckkehr','wert','common','includes','replace','\x20->\x20','string','join','target','üìÖ\x20SMART\x20SCHEDULE\x20[','warn','config','info','üìÖ\x20SMART\x20SCHEDULE\x20(Phase):\x20\x27Globaler\x20Start\x27\x20erkannt.\x20Heize\x20Haus\x20auf\x20(Vorlauf:\x20','\x20min).','location','sort','analysis.energy.warmupSources','actual','write','dimmer','SET',':\x20Aufheizen\x20auf\x20','setForeignStateAsync','val'];a1_0x576c=function(){return _0x351bbd;};return a1_0x576c();}function normalize(_0x2394c0){const _0x16db2a=a1_0x385f01;if(!_0x2394c0)return'';return _0x2394c0[_0x16db2a(0x177)]()[_0x16db2a(0x124)](/\s+/g,'')[_0x16db2a(0x14d)]();}async function logAutomationAction(_0x53b71a,_0x88d78c){const _0x97cf51=a1_0x385f01;await _0x53b71a[_0x97cf51(0x186)](_0x97cf51(0x159),{'val':_0x88d78c,'ack':!![]});try{const _0x1ce384=_0x97cf51(0x11b),_0x3603bf=await _0x53b71a[_0x97cf51(0x15a)](_0x1ce384);let _0x18d57d=[];if(_0x3603bf&&_0x3603bf['val'])try{_0x18d57d=JSON[_0x97cf51(0x162)](_0x3603bf[_0x97cf51(0x138)]);}catch(_0x3c52f5){}_0x18d57d[_0x97cf51(0x119)]({'ts':Date[_0x97cf51(0xff)](),'msg':_0x88d78c});if(_0x18d57d[_0x97cf51(0x17f)]>0x32)_0x18d57d=_0x18d57d[_0x97cf51(0x164)](0x0,0x32);await _0x53b71a[_0x97cf51(0x186)](_0x1ce384,{'val':JSON[_0x97cf51(0x143)](_0x18d57d),'ack':!![]});}catch(_0x1616ba){}}async function handlePrediction(_0xf70bc2,_0x39ecd6,_0x2959b3){const _0x3783b2=a1_0x385f01;if(!_0x39ecd6||_0x39ecd6===_0x3783b2(0x142))return;let _0x29028c=_0x3783b2(0x13b),_0x737b=0.6;try{const _0xb7ef40=await _0xf70bc2[_0x3783b2(0x15a)]('analysis.automation.mode');if(_0xb7ef40&&_0xb7ef40[_0x3783b2(0x138)])_0x29028c=_0xb7ef40[_0x3783b2(0x138)];const _0x3e0841=await _0xf70bc2[_0x3783b2(0x15a)](_0x3783b2(0x11c));if(_0x3e0841&&_0x3e0841[_0x3783b2(0x138)])_0x737b=_0x3e0841[_0x3783b2(0x138)];}catch(_0x356e8f){}if(_0x29028c===_0x3783b2(0x13b)||_0x2959b3<_0x737b)return;const _0x21c9b1=Date[_0x3783b2(0xff)]();if(lastActions[_0x39ecd6]&&_0x21c9b1-lastActions[_0x39ecd6]<COOLDOWN_MS)return;const _0x41d595=_0xf70bc2[_0x3783b2(0x12b)][_0x3783b2(0x108)]||[],_0x14d11a=normalize(_0x39ecd6),_0x356e3a=_0x41d595[_0x3783b2(0x107)](_0x1bc7ee=>normalize(_0x1bc7ee['location'])===_0x14d11a&&(_0x1bc7ee[_0x3783b2(0xfe)]===_0x3783b2(0x183)||_0x1bc7ee[_0x3783b2(0xfe)]===_0x3783b2(0x134)||_0x1bc7ee[_0x3783b2(0xfe)]==='switch'));if(!_0x356e3a)return;const _0x139e14=await aiAgent[_0x3783b2(0x153)](_0xf70bc2,_0x39ecd6,_0x356e3a[_0x3783b2(0x174)],_0x2959b3);if(!_0x139e14[_0x3783b2(0x14f)])return;const _0x3338ae=_0x3783b2(0x10d)+_0x39ecd6+_0x3783b2(0x11e)+_0x356e3a['name']+'\x20('+_0x139e14['reason']+')';await logAutomationAction(_0xf70bc2,'['+_0x29028c['toUpperCase']()+']\x20'+_0x3338ae);if(_0x29028c===_0x3783b2(0x100)){const _0x16ee76=await _0xf70bc2[_0x3783b2(0x169)](_0x356e3a['id']);(!_0x16ee76||!_0x16ee76[_0x3783b2(0x138)]&&_0x16ee76[_0x3783b2(0x138)]!==!![])&&await _0xf70bc2['setForeignStateAsync'](_0x356e3a['id'],!![]),lastActions[_0x39ecd6]=_0x21c9b1;}}async function findRelatedId(_0x401998,_0x2bd103,_0x3a2790='setpoint'){const _0x1a0bb3=a1_0x385f01;if(_0x3a2790==='setpoint'&&_0x401998[_0x1a0bb3(0x12b)]['thermostatMapping']){let _0x13e778=_0x401998[_0x1a0bb3(0x12b)][_0x1a0bb3(0x15e)];if(typeof _0x13e778===_0x1a0bb3(0x126))try{_0x13e778=JSON[_0x1a0bb3(0x162)](_0x13e778);}catch(_0x5545e7){}if(_0x13e778&&_0x13e778[_0x2bd103])return _0x13e778[_0x2bd103];}if(_0x3a2790==='valve'&&_0x401998[_0x1a0bb3(0x12b)][_0x1a0bb3(0x176)]){let _0x10a18f=_0x401998[_0x1a0bb3(0x12b)]['valveMapping'];if(typeof _0x10a18f===_0x1a0bb3(0x126))try{_0x10a18f=JSON['parse'](_0x10a18f);}catch(_0xb5608e){}if(_0x10a18f&&_0x10a18f[_0x2bd103])return _0x10a18f[_0x2bd103];}let _0x2259db=[];if(_0x3a2790===_0x1a0bb3(0x18e))_0x2259db=[{'s':_0x1a0bb3(0x13f),'t':_0x1a0bb3(0x16c)},{'s':_0x1a0bb3(0x18c),'t':'.1.SET_POINT_TEMPERATURE'},{'s':_0x1a0bb3(0x18c),'t':_0x1a0bb3(0x101)},{'s':_0x1a0bb3(0x180),'t':_0x1a0bb3(0x16e)},{'s':'local_temperature','t':_0x1a0bb3(0x141)},{'s':_0x1a0bb3(0x154),'t':_0x1a0bb3(0x155)},{'s':'temperature','t':_0x1a0bb3(0x17a)},{'s':_0x1a0bb3(0x152),'t':_0x1a0bb3(0x135)},{'s':_0x1a0bb3(0x15b),'t':_0x1a0bb3(0x15f)},{'s':_0x1a0bb3(0x165),'t':_0x1a0bb3(0x18e)}];else _0x3a2790===_0x1a0bb3(0x111)&&(_0x2259db=[{'s':'.1.ACTUAL_TEMPERATURE','t':_0x1a0bb3(0x17e)},{'s':_0x1a0bb3(0x18c),'t':_0x1a0bb3(0x17e)},{'s':_0x1a0bb3(0x18c),'t':'.4.VALVE_STATE'},{'s':_0x1a0bb3(0x154),'t':'pi_heating_demand'},{'s':'temperature','t':'valve_position'},{'s':_0x1a0bb3(0x165),'t':'level'}]);for(const _0xbbca69 of _0x2259db){if(_0x2bd103[_0x1a0bb3(0x123)](_0xbbca69['s'])){const _0x1998aa=_0x2bd103[_0x1a0bb3(0x124)](_0xbbca69['s'],_0xbbca69['t']),_0x5c93f5=await _0x401998[_0x1a0bb3(0x170)](_0x1998aa);if(_0x5c93f5)return _0x1998aa;}}try{const _0x58aee0=_0x2bd103[_0x1a0bb3(0x173)]('.');if(_0x58aee0[_0x1a0bb3(0x17f)]>0x2){const _0xd79cc4=_0x58aee0[_0x1a0bb3(0x164)](0x0,-0x1)[_0x1a0bb3(0x127)]('.'),_0x1d8e47=await _0x401998[_0x1a0bb3(0x112)](_0xd79cc4+'.*'),_0x59dec8=[],_0x24834f=_0x2bd103[_0x1a0bb3(0x173)](/[._]+/)['filter'](_0x3bcff7=>![_0x1a0bb3(0x16a),'0','hm-rpc',_0x1a0bb3(0x171),_0x1a0bb3(0x121),'temperature',_0x1a0bb3(0x132),'sensor',_0x1a0bb3(0x14e),_0x1a0bb3(0x18a)][_0x1a0bb3(0x123)](_0x3bcff7['toLowerCase']()));for(const [_0x25ef03,_0x33b78c]of Object['entries'](_0x1d8e47)){if(_0x25ef03===_0x2bd103)continue;if(_0x33b78c&&_0x33b78c[_0x1a0bb3(0x122)]){const _0x1c6712=_0x25ef03[_0x1a0bb3(0x177)](),_0x5929b9=(_0x33b78c[_0x1a0bb3(0x122)][_0x1a0bb3(0x156)]||'')[_0x1a0bb3(0x177)](),_0x2648a=(_0x33b78c['common'][_0x1a0bb3(0x189)]||'')['toLowerCase']();let _0x27d70a=![];if(_0x3a2790===_0x1a0bb3(0x18e)&&_0x33b78c[_0x1a0bb3(0x122)][_0x1a0bb3(0x133)]===!![])_0x27d70a=_0x1c6712['includes']('set')||_0x1c6712[_0x1a0bb3(0x123)]('soll')||_0x1c6712[_0x1a0bb3(0x123)](_0x1a0bb3(0x128))||_0x5929b9[_0x1a0bb3(0x123)](_0x1a0bb3(0x11f))||_0x5929b9[_0x1a0bb3(0x123)](_0x1a0bb3(0x10c));else _0x3a2790===_0x1a0bb3(0x111)&&(_0x27d70a=_0x1c6712[_0x1a0bb3(0x123)](_0x1a0bb3(0x151))||_0x1c6712[_0x1a0bb3(0x123)](_0x1a0bb3(0x111))||_0x1c6712[_0x1a0bb3(0x123)]('stellwert')||_0x1c6712['includes'](_0x1a0bb3(0x106))||_0x5929b9['includes'](_0x1a0bb3(0x16f))||_0x5929b9[_0x1a0bb3(0x123)](_0x1a0bb3(0x181))||_0x2648a[_0x1a0bb3(0x123)]('%'));if(_0x27d70a){const _0x3f137a=_0x25ef03[_0x1a0bb3(0x173)](/[._]+/)['map'](_0x126d56=>_0x126d56['toLowerCase']());let _0x323b35=0x0;_0x24834f[_0x1a0bb3(0xf8)](_0x33e305=>{const _0x57b91a=_0x1a0bb3;if(_0x3f137a[_0x57b91a(0x123)](_0x33e305[_0x57b91a(0x177)]()))_0x323b35++;}),_0x59dec8[_0x1a0bb3(0x113)]({'id':_0x25ef03,'score':_0x323b35});}}}if(_0x59dec8[_0x1a0bb3(0x17f)]>0x0){_0x59dec8[_0x1a0bb3(0x130)]((_0x4a87fd,_0x4a9448)=>_0x4a9448[_0x1a0bb3(0x158)]-_0x4a87fd[_0x1a0bb3(0x158)]);if(_0x59dec8[0x0][_0x1a0bb3(0x158)]>0x0)return _0x59dec8[0x0]['id'];}}}catch(_0xaa3411){}return null;}async function scanThermostats(_0x2f444b){const _0x5f5184=a1_0x385f01,_0x3acc9f=_0x2f444b[_0x5f5184(0x12b)]['devices']||[],_0x4ddbf6=[],_0x1ed32c=_0x3acc9f[_0x5f5184(0x10b)](_0x26e07c=>_0x26e07c['id']&&_0x26e07c['id'][_0x5f5184(0x123)]('temperature')||_0x26e07c[_0x5f5184(0xfe)]&&[_0x5f5184(0x165),_0x5f5184(0x104),'sensor']['includes'](_0x26e07c['type'])||_0x26e07c['name']&&_0x26e07c[_0x5f5184(0x174)]['toLowerCase']()[_0x5f5184(0x123)]('temp'));for(const _0x45857c of _0x1ed32c){const _0x1a88c8=await findRelatedId(_0x2f444b,_0x45857c['id'],_0x5f5184(0x18e)),_0x41fb77=await findRelatedId(_0x2f444b,_0x45857c['id'],_0x5f5184(0x111));let _0x3d9f64=_0x5f5184(0x18d),_0x21f6b7=![],_0x3fb0ee=_0x2f444b[_0x5f5184(0x12b)][_0x5f5184(0x15e)]||{};if(typeof _0x3fb0ee==='string')try{_0x3fb0ee=JSON[_0x5f5184(0x162)](_0x3fb0ee);}catch(_0x1c301a){}let _0x50ddb0=_0x2f444b['config'][_0x5f5184(0x176)]||{};if(typeof _0x50ddb0===_0x5f5184(0x126))try{_0x50ddb0=JSON[_0x5f5184(0x162)](_0x50ddb0);}catch(_0x4b1201){}if(_0x3fb0ee[_0x45857c['id']]&&_0x3fb0ee[_0x45857c['id']]===_0x1a88c8||_0x50ddb0[_0x45857c['id']]&&_0x50ddb0[_0x45857c['id']]===_0x41fb77)_0x3d9f64=_0x5f5184(0x118),_0x21f6b7=!![];else(_0x1a88c8||_0x41fb77)&&(_0x3d9f64='Auto-Erkennung');_0x4ddbf6[_0x5f5184(0x113)]({'room':_0x45857c[_0x5f5184(0x12f)]||_0x5f5184(0x15c),'sensorId':_0x45857c['id'],'setpointId':_0x1a88c8||'-','valveId':_0x41fb77||'-','source':_0x3d9f64,'isManual':_0x21f6b7,'status':_0x1a88c8&&_0x41fb77?_0x5f5184(0x140):_0x1a88c8?'OK':_0x5f5184(0x110)});}return _0x4ddbf6['sort']((_0x5349e5,_0x56f165)=>_0x5349e5[_0x5f5184(0x11a)]['localeCompare'](_0x56f165['room']));}async function updateSchedulePreview(_0x6a5b7c){const _0x27442d=a1_0x385f01;if(!_0x6a5b7c[_0x27442d(0x12b)][_0x27442d(0x188)]||!_0x6a5b7c['config'][_0x27442d(0x163)])return;let _0x5cc391={};try{const _0x49072c=await _0x6a5b7c['getStateAsync'](_0x27442d(0x17b));if(_0x49072c&&_0x49072c[_0x27442d(0x138)])_0x5cc391=JSON[_0x27442d(0x162)](_0x49072c[_0x27442d(0x138)]);}catch(_0x2c83c3){}const _0x3e9594=[],_0x2285f0=Date[_0x27442d(0xff)](),_0x5b15e5=0x30*0x3c*0x3c*0x3e8;try{const _0x57f2bd=await _0x6a5b7c[_0x27442d(0x169)](_0x6a5b7c[_0x27442d(0x12b)][_0x27442d(0x163)]+_0x27442d(0x10e));if(!_0x57f2bd||!_0x57f2bd[_0x27442d(0x138)])return;const _0x585668=JSON[_0x27442d(0x162)](_0x57f2bd[_0x27442d(0x138)]),_0x7794d8=_0x6a5b7c[_0x27442d(0x12b)]['calendarSelection']||[],_0x25d39b=_0x6a5b7c[_0x27442d(0x12b)][_0x27442d(0x108)]||[],_0x1d678d=new Set();_0x25d39b[_0x27442d(0xf8)](_0x10ac6e=>{const _0x1bc0d2=_0x27442d;if(_0x10ac6e['location'])_0x1d678d['add'](_0x10ac6e[_0x1bc0d2(0x12f)]);});for(const _0x126496 of _0x585668){if(_0x126496['_calName']&&_0x7794d8[_0x27442d(0x17f)]>0x0&&!_0x7794d8[_0x27442d(0x123)](_0x126496[_0x27442d(0x10a)]))continue;const _0x2cafe3=_0x126496[_0x27442d(0x182)]||_0x126496[_0x27442d(0x17c)]||_0x126496[_0x27442d(0x103)];if(!_0x2cafe3)continue;const _0x21127a=new Date(_0x2cafe3),_0x25481c=_0x21127a['getTime']();if(isNaN(_0x25481c))continue;if(_0x25481c<_0x2285f0)continue;if(_0x25481c>_0x2285f0+_0x5b15e5)continue;const _0x20cb6d=(_0x126496[_0x27442d(0x149)]||_0x126496['summary']||'')[_0x27442d(0x177)]();let _0x58de=![],_0x5127a7=[],_0x293727=_0x126496['event']||_0x126496['summary']||'Unbekannt';if(_0x20cb6d[_0x27442d(0x123)](_0x27442d(0x115))||_0x20cb6d['includes'](_0x27442d(0x120))||_0x20cb6d[_0x27442d(0x123)]('ankunft'))_0x58de=!![],_0x5127a7=Array['from'](_0x1d678d);else for(const _0x1cc31f of _0x1d678d){if(_0x20cb6d[_0x27442d(0x123)](_0x1cc31f[_0x27442d(0x177)]()))_0x5127a7['push'](_0x1cc31f);}_0x5127a7[_0x27442d(0x17f)]>0x0&&_0x5127a7[_0x27442d(0xf8)](_0x2c4c0d=>{const _0x24179c=_0x27442d;let _0x37baf7=0x3c;if(_0x58de){let _0x3f0f2a=0x0;Object['values'](_0x5cc391)[_0x24179c(0xf8)](_0x8f07e7=>{if(_0x8f07e7>_0x3f0f2a)_0x3f0f2a=_0x8f07e7;}),_0x37baf7=_0x3f0f2a>0x0?_0x3f0f2a:0x78;}else _0x37baf7=_0x5cc391[_0x2c4c0d]||0x3c;const _0x3d4287=new Date(_0x25481c-_0x37baf7*0xea60);_0x3e9594[_0x24179c(0x113)]({'eventTime':_0x25481c,'triggerTime':_0x3d4287['getTime'](),'room':_0x2c4c0d,'minutes':_0x37baf7,'reason':_0x293727,'isGlobal':_0x58de});});}}catch(_0x545c76){}_0x3e9594[_0x27442d(0x130)]((_0x35642f,_0x4a0812)=>_0x35642f[_0x27442d(0x175)]-_0x4a0812[_0x27442d(0x175)]);const _0x42c36e=_0x3e9594[_0x27442d(0x164)](0x0,0x5);await _0x6a5b7c[_0x27442d(0x186)](_0x27442d(0x117),{'val':JSON[_0x27442d(0x143)](_0x42c36e),'ack':!![]});}async function checkCalendarTriggers(_0x1e29af){const _0x36d9f8=a1_0x385f01;if(!_0x1e29af['config'][_0x36d9f8(0x188)]||!_0x1e29af[_0x36d9f8(0x12b)][_0x36d9f8(0x163)])return;await updateSchedulePreview(_0x1e29af);let _0x25012c={},_0x2c5901={};try{const _0x547ed5=await _0x1e29af['getStateAsync'](_0x36d9f8(0x17b));if(_0x547ed5&&_0x547ed5[_0x36d9f8(0x138)])_0x25012c=JSON['parse'](_0x547ed5[_0x36d9f8(0x138)]);const _0x59783b=await _0x1e29af[_0x36d9f8(0x15a)](_0x36d9f8(0x131));if(_0x59783b&&_0x59783b[_0x36d9f8(0x138)])_0x2c5901=JSON[_0x36d9f8(0x162)](_0x59783b[_0x36d9f8(0x138)]);}catch(_0x2e2492){}let _0x46e927={'default':0x15};try{const _0x54c429=await _0x1e29af['getStateAsync'](_0x36d9f8(0x178));if(_0x54c429&&_0x54c429[_0x36d9f8(0x138)])_0x46e927=JSON[_0x36d9f8(0x162)](_0x54c429['val']);}catch(_0x21d7c8){}try{const _0x21372b=await _0x1e29af[_0x36d9f8(0x169)](_0x1e29af[_0x36d9f8(0x12b)][_0x36d9f8(0x163)]+'.data.table');if(!_0x21372b||!_0x21372b['val'])return;const _0x30fe68=JSON[_0x36d9f8(0x162)](_0x21372b[_0x36d9f8(0x138)]),_0x5a27be=Date[_0x36d9f8(0xff)](),_0x4c6d9f=_0x1e29af[_0x36d9f8(0x12b)][_0x36d9f8(0x108)]||[],_0x263628=_0x1e29af[_0x36d9f8(0x12b)][_0x36d9f8(0x10f)]||[];for(const _0x50c182 of _0x30fe68){if(_0x50c182[_0x36d9f8(0x10a)]&&_0x263628[_0x36d9f8(0x17f)]>0x0&&!_0x263628['includes'](_0x50c182[_0x36d9f8(0x10a)]))continue;const _0x422bb5=_0x50c182[_0x36d9f8(0x182)]||_0x50c182[_0x36d9f8(0x17c)]||_0x50c182[_0x36d9f8(0x103)];if(!_0x422bb5)continue;const _0x493754=new Date(_0x422bb5);if(isNaN(_0x493754['getTime']()))continue;const _0x124c03=(_0x50c182[_0x36d9f8(0x149)]||_0x50c182[_0x36d9f8(0x184)]||'')[_0x36d9f8(0x177)]();if(_0x124c03[_0x36d9f8(0x123)]('urlaub\x20ende')||_0x124c03[_0x36d9f8(0x123)](_0x36d9f8(0x120))||_0x124c03[_0x36d9f8(0x123)]('ankunft')){let _0x229d34=0x0;Object['values'](_0x25012c)[_0x36d9f8(0xf8)](_0xfe6721=>{if(_0xfe6721>_0x229d34)_0x229d34=_0xfe6721;});if(_0x229d34===0x0)_0x229d34=0x78;const _0x28f484=_0x493754['getTime']()-_0x229d34*0xea60;_0x5a27be>=_0x28f484&&_0x5a27be<_0x493754[_0x36d9f8(0x14b)]()&&(_0x1e29af[_0x36d9f8(0x139)]!==_0x36d9f8(0x168)&&(_0x1e29af[_0x36d9f8(0x17d)]['info'](_0x36d9f8(0x12d)+_0x229d34+_0x36d9f8(0x12e)),await _0x1e29af[_0x36d9f8(0x186)]('system.mode',{'val':_0x36d9f8(0x168),'ack':![]})));}for(const _0x2445eb of _0x4c6d9f){if(_0x2445eb[_0x36d9f8(0x12f)]){const _0x52f965=_0x2445eb[_0x36d9f8(0x12f)][_0x36d9f8(0x177)]();if(_0x124c03[_0x36d9f8(0x123)](_0x52f965)){const _0x44a889=_0x25012c[_0x2445eb[_0x36d9f8(0x12f)]]||0x3c,_0x57a040=_0x2c5901[_0x2445eb[_0x36d9f8(0x12f)]]||_0x36d9f8(0xfa),_0x5b8243=_0x493754[_0x36d9f8(0x14b)]()-_0x44a889*0xea60;if(_0x5a27be>=_0x5b8243&&_0x5a27be<_0x493754[_0x36d9f8(0x14b)]()){const _0x4a1295=lastActions['cal_'+_0x2445eb[_0x36d9f8(0x12f)]];if(_0x4a1295&&_0x5a27be-_0x4a1295<CAL_COOLDOWN_MS)continue;const _0x3f426f=await findRelatedId(_0x1e29af,_0x2445eb['id'],'setpoint');if(_0x3f426f){let _0x311aa2=_0x46e927[_0x2445eb['location']];if(_0x311aa2===undefined)_0x311aa2=_0x46e927[_0x36d9f8(0x150)];if(_0x311aa2===undefined)_0x311aa2=0x15;const _0x1a8078=await _0x1e29af['getForeignStateAsync'](_0x3f426f);_0x1a8078&&typeof _0x1a8078[_0x36d9f8(0x138)]===_0x36d9f8(0x144)&&_0x1a8078['val']<_0x311aa2-0.5&&(_0x1e29af[_0x36d9f8(0x17d)][_0x36d9f8(0x12c)](_0x36d9f8(0x129)+_0x57a040+_0x36d9f8(0x13e)+_0x2445eb[_0x36d9f8(0x12f)]+_0x36d9f8(0x13c)+_0x311aa2+_0x36d9f8(0x105)+_0x44a889+_0x36d9f8(0x12e)),await _0x1e29af[_0x36d9f8(0x137)](_0x3f426f,_0x311aa2),await logAutomationAction(_0x1e29af,_0x36d9f8(0x116)+_0x2445eb[_0x36d9f8(0x12f)]+_0x36d9f8(0x125)+_0x311aa2+_0x36d9f8(0x148)+_0x57a040+')'),lastActions[_0x36d9f8(0xfc)+_0x2445eb[_0x36d9f8(0x12f)]]=_0x5a27be);}}}}}}}catch(_0x2d3152){_0x1e29af[_0x36d9f8(0x17d)][_0x36d9f8(0x12a)](_0x36d9f8(0x15d)+_0x2d3152['message']);}}async function manageMpcIntervention(_0x233328,_0x5b256b,_0x2a68e7){const _0x29800c=a1_0x385f01;try{const _0x4a1803=_0x29800c(0x157),_0x4620fb=await _0x233328['getStateAsync'](_0x4a1803);let _0x409407=[];if(_0x4620fb&&_0x4620fb[_0x29800c(0x138)])try{_0x409407=JSON['parse'](_0x4620fb['val']);}catch(_0x2b2ea8){}const _0x17baa1=_0x409407['indexOf'](_0x5b256b);if(_0x2a68e7==='add')_0x17baa1===-0x1&&(_0x409407['push'](_0x5b256b),await _0x233328[_0x29800c(0x186)](_0x4a1803,{'val':JSON[_0x29800c(0x143)](_0x409407),'ack':!![]}));else _0x2a68e7===_0x29800c(0xf9)&&(_0x17baa1!==-0x1&&(_0x409407['splice'](_0x17baa1,0x1),await _0x233328['setStateAsync'](_0x4a1803,{'val':JSON[_0x29800c(0x143)](_0x409407),'ack':!![]})));}catch(_0x355000){}}function a1_0x2dba(_0x42ce20,_0x316f91){const _0x16ed06=a1_0x576c();return a1_0x2dba=function(_0x1649c0,_0x105948){_0x1649c0=_0x1649c0-0xf8;let _0x576c7a=_0x16ed06[_0x1649c0];return _0x576c7a;},a1_0x2dba(_0x42ce20,_0x316f91);}async function applyEnergySavings(_0xc6e77d,_0x1304ad){const _0x382854=a1_0x385f01;if(!_0x1304ad||_0x1304ad[_0x382854(0x17f)]===0x0)return;const _0x8ab57f=_0xc6e77d[_0x382854(0x12b)]['devices']||[],_0x35b509=Date[_0x382854(0xff)]();for(const _0x4bf9f5 of _0x1304ad){const _0x12d408=_0x4bf9f5[_0x382854(0x11a)],_0xc6c21e=_0x4bf9f5[_0x382854(0x109)],_0x4926e2=_0x4bf9f5[_0x382854(0x128)]||0x15,_0x181d87=_0x8ab57f['find'](_0x50862f=>normalize(_0x50862f[_0x382854(0x12f)])===normalize(_0x12d408)&&(_0x50862f[_0x382854(0xfe)]===_0x382854(0x165)||_0x50862f[_0x382854(0xfe)]===_0x382854(0x104)));if(!_0x181d87)continue;const _0x293d3a=await findRelatedId(_0xc6e77d,_0x181d87['id'],_0x382854(0x18e));if(_0x293d3a){if(lastActions[_0x382854(0x161)+_0x12d408]&&_0x35b509-lastActions[_0x382854(0x161)+_0x12d408]<0x1e*0x3c*0x3e8)continue;const _0xfaa5f6=await _0xc6e77d[_0x382854(0x169)](_0x293d3a);if(_0xfaa5f6&&typeof _0xfaa5f6[_0x382854(0x138)]==='number'){const _0x4c3385=_0xfaa5f6[_0x382854(0x138)];_0x4c3385!==ECO_TEMP&&await manageMpcIntervention(_0xc6e77d,_0x12d408,_0x382854(0xf9));if(_0xc6c21e>0x1e)_0x4c3385>ECO_TEMP+0.5&&(_0xc6e77d['log'][_0x382854(0x12c)]('üçÉ\x20[MPC\x20ACTION]\x20Senke\x20'+_0x12d408+'\x20auf\x20'+ECO_TEMP+_0x382854(0x167)+_0xc6c21e+'\x20min)'),await _0xc6e77d[_0x382854(0x137)](_0x293d3a,ECO_TEMP),await manageMpcIntervention(_0xc6e77d,_0x12d408,_0x382854(0x14a)),lastActions[_0x382854(0x161)+_0x12d408]=_0x35b509,await logAutomationAction(_0xc6e77d,_0x382854(0xfb)+_0x12d408+_0x382854(0x172)+ECO_TEMP+'¬∞C'));else _0xc6c21e<=0xf&&(_0x4c3385<_0x4926e2&&(_0xc6e77d[_0x382854(0x17d)][_0x382854(0x12c)](_0x382854(0x147)+_0x12d408+_0x382854(0x166)+_0x4926e2+_0x382854(0x14c)),await _0xc6e77d[_0x382854(0x137)](_0x293d3a,_0x4926e2),await manageMpcIntervention(_0xc6e77d,_0x12d408,_0x382854(0xf9)),lastActions[_0x382854(0x161)+_0x12d408]=_0x35b509,await logAutomationAction(_0xc6e77d,'[MPC]\x20'+_0x12d408+_0x382854(0x136)+_0x4926e2+'¬∞C')));}}else _0xc6e77d[_0x382854(0x17d)][_0x382854(0x12a)](_0x382854(0x145)+_0x12d408+'\x20gefunden!');}}module[a1_0x385f01(0x13d)]={'handlePrediction':handlePrediction,'applyEnergySavings':applyEnergySavings,'scanThermostats':scanThermostats,'checkCalendarTriggers':checkCalendarTriggers,'updateSchedulePreview':updateSchedulePreview};