function a1_0x2a89(){const _0x3b793d=['setStateAsync','now','temperature','current_heating_setpoint','consultButler','entries','SET_POINT_TEMPERATURE','constructor','(((.+)+)+)+$','getForeignObjectAsync','Manuelles\x20Mapping','Ist','getForeignStateAsync','5411nihUei','length','Soll','analysis.automation.confidenceThreshold','setForeignStateAsync','42yoDSvH','thermostat','room','thermostatMapping','727425vBXGus','Nicht\x20gefunden','426782Dolloa','setpoint','devices','11oOkXRT','mpc_','.1.ACTUAL_TEMPERATURE','üîç\x20Device-Search\x20failed\x20for\x20predicted\x20room\x20\x27','debug','ACTUAL','.4.SET_TEMPERATURE','switch','find','apply','Unbekannt','temp','location','parse','occupied_heating_setpoint',')\x20auf\x20','string','off','\x20min)','val','1bBPadp','getForeignObjectsAsync','1031790DxCedt','216536IoRpDV','common','trim','local_temperature',':\x20-1¬∞C\x20(Sparpotenzial\x20genutzt)','916wudjhE','Auto-Erkennung','name','./ai_agent','1997820nIGkDs','Unknown','63sFyMUs','exports','toLowerCase','info','getStateAsync','analysis.automation.mode','active','slice','type','sort','replace','2316YMcMVG','toString','.1.SET_POINT_TEMPERATURE','join','Pr√§diktion:\x20','set','includes','config','search'];a1_0x2a89=function(){return _0x3b793d;};return a1_0x2a89();}const a1_0x5e07e1=a1_0x165a;(function(_0x3f8b87,_0x2d820b){const _0x4d75c2=a1_0x165a,_0x598f7b=_0x3f8b87();while(!![]){try{const _0x3ecac9=-parseInt(_0x4d75c2(0x76))/0x1*(-parseInt(_0x4d75c2(0xb0))/0x2)+parseInt(_0x4d75c2(0x8f))/0x3*(parseInt(_0x4d75c2(0x7e))/0x4)+-parseInt(_0x4d75c2(0xae))/0x5+-parseInt(_0x4d75c2(0xaa))/0x6*(parseInt(_0x4d75c2(0xa5))/0x7)+-parseInt(_0x4d75c2(0x79))/0x8*(parseInt(_0x4d75c2(0x84))/0x9)+-parseInt(_0x4d75c2(0x78))/0xa*(parseInt(_0x4d75c2(0xb3))/0xb)+parseInt(_0x4d75c2(0x82))/0xc;if(_0x3ecac9===_0x2d820b)break;else _0x598f7b['push'](_0x598f7b['shift']());}catch(_0x3c9a92){_0x598f7b['push'](_0x598f7b['shift']());}}}(a1_0x2a89,0x1b9e0));const a1_0x50081a=(function(){let _0x4d0d37=!![];return function(_0xf175c8,_0x5087c){const _0x27db12=_0x4d0d37?function(){const _0x3ca54e=a1_0x165a;if(_0x5087c){const _0x140174=_0x5087c[_0x3ca54e(0xbc)](_0xf175c8,arguments);return _0x5087c=null,_0x140174;}}:function(){};return _0x4d0d37=![],_0x27db12;};}()),a1_0x255254=a1_0x50081a(this,function(){const _0x2bf0b5=a1_0x165a;return a1_0x255254[_0x2bf0b5(0x90)]()[_0x2bf0b5(0x97)](_0x2bf0b5(0xa0))['toString']()[_0x2bf0b5(0x9f)](a1_0x255254)[_0x2bf0b5(0x97)](_0x2bf0b5(0xa0));});a1_0x255254();'use strict';const aiAgent=require(a1_0x5e07e1(0x81)),COOLDOWN_MS=0x3c*0x3e8,lastActions={};function normalize(_0x212bf8){const _0x30dcba=a1_0x5e07e1;if(!_0x212bf8)return'';return _0x212bf8[_0x30dcba(0x86)]()[_0x30dcba(0x8e)](/\s+/g,'')[_0x30dcba(0x7b)]();}async function handlePrediction(_0x1ce662,_0x19e7e3,_0xa95ae6){const _0x196c46=a1_0x5e07e1;if(!_0x19e7e3||_0x19e7e3===_0x196c46(0x83))return;let _0x3c3cc5=_0x196c46(0x73),_0x192a8e=0.6;try{const _0x11a1f2=await _0x1ce662['getStateAsync'](_0x196c46(0x89));if(_0x11a1f2&&_0x11a1f2[_0x196c46(0x75)])_0x3c3cc5=_0x11a1f2[_0x196c46(0x75)];const _0x347a76=await _0x1ce662[_0x196c46(0x88)](_0x196c46(0xa8));if(_0x347a76&&_0x347a76[_0x196c46(0x75)])_0x192a8e=_0x347a76[_0x196c46(0x75)];}catch(_0x59e3d9){}if(_0x3c3cc5==='off'||_0xa95ae6<_0x192a8e)return;const _0xdf99cb=Date[_0x196c46(0x99)]();if(lastActions[_0x19e7e3]&&_0xdf99cb-lastActions[_0x19e7e3]<COOLDOWN_MS)return;const _0x1513c1=_0x1ce662[_0x196c46(0x96)]['devices']||[],_0x5b247c=normalize(_0x19e7e3),_0x42b665=_0x1513c1[_0x196c46(0xbb)](_0xef832f=>normalize(_0xef832f[_0x196c46(0xbf)])===_0x5b247c&&(_0xef832f['type']==='light'||_0xef832f[_0x196c46(0x8c)]==='dimmer'||_0xef832f[_0x196c46(0x8c)]===_0x196c46(0xba)));if(!_0x42b665){_0x1ce662['log'][_0x196c46(0xb7)](_0x196c46(0xb6)+_0x19e7e3+'\x27.');return;}const _0x42e742=await aiAgent[_0x196c46(0x9c)](_0x1ce662,_0x19e7e3,_0x42b665[_0x196c46(0x80)],_0xa95ae6);if(!_0x42e742['approved'])return;const _0x35b604=_0x196c46(0x93)+_0x19e7e3+'\x20->\x20Schalte\x20'+_0x42b665[_0x196c46(0x80)]+'\x20('+_0x42e742['reason']+')';await _0x1ce662[_0x196c46(0x98)]('analysis.automation.lastAction',{'val':'['+_0x3c3cc5['toUpperCase']()+']\x20'+_0x35b604,'ack':!![]});if(_0x3c3cc5===_0x196c46(0x8a)){const _0x38e523=await _0x1ce662['getForeignStateAsync'](_0x42b665['id']);(!_0x38e523||!_0x38e523['val']&&_0x38e523[_0x196c46(0x75)]!==!![])&&await _0x1ce662[_0x196c46(0xa9)](_0x42b665['id'],!![]),lastActions[_0x19e7e3]=_0xdf99cb;}}async function findSetpointId(_0x14b621,_0xd79370){const _0x590390=a1_0x5e07e1;if(_0x14b621['config'][_0x590390(0xad)]){let _0x1cee8e=_0x14b621['config']['thermostatMapping'];if(typeof _0x1cee8e==='string')try{_0x1cee8e=JSON[_0x590390(0x6f)](_0x1cee8e);}catch(_0x5eb184){_0x1cee8e={};}if(_0x1cee8e&&_0x1cee8e[_0xd79370])return _0x1cee8e[_0xd79370];}const _0x4dbe1d=[{'s':_0x590390(0xb5),'t':_0x590390(0x91)},{'s':'.1.TEMPERATURE','t':_0x590390(0xb9)},{'s':'ACTUAL_TEMPERATURE','t':_0x590390(0x9e)},{'s':_0x590390(0x7c),'t':_0x590390(0x70)},{'s':_0x590390(0x7c),'t':_0x590390(0x9b)},{'s':'temperature','t':'target_temperature'},{'s':_0x590390(0xb8),'t':'SET'},{'s':_0x590390(0xa3),'t':_0x590390(0xa7)},{'s':_0x590390(0x9a),'t':_0x590390(0xb1)}];for(const _0x4c56ea of _0x4dbe1d){if(_0xd79370[_0x590390(0x95)](_0x4c56ea['s'])){const _0x3e4a13=_0xd79370[_0x590390(0x8e)](_0x4c56ea['s'],_0x4c56ea['t']),_0x425576=await _0x14b621[_0x590390(0xa1)](_0x3e4a13);if(_0x425576)return _0x3e4a13;}}try{const _0x49fa86=_0xd79370['split']('.');if(_0x49fa86[_0x590390(0xa6)]>0x2){const _0x5c256e=_0x49fa86[_0x590390(0x8b)](0x0,-0x1)[_0x590390(0x92)]('.'),_0x248c0c=await _0x14b621[_0x590390(0x77)](_0x5c256e+'.*');for(const [_0xbd7f43,_0x3fbcfb]of Object[_0x590390(0x9d)](_0x248c0c)){if(_0xbd7f43===_0xd79370)continue;if(_0x3fbcfb&&_0x3fbcfb[_0x590390(0x7a)]&&_0x3fbcfb['common']['write']===!![]){const _0xc29ba4=_0xbd7f43[_0x590390(0x86)](),_0x5dff55=(_0x3fbcfb[_0x590390(0x7a)]['role']||'')['toLowerCase']();if(_0xc29ba4[_0x590390(0x95)](_0x590390(0x94))||_0xc29ba4['includes']('soll')||_0xc29ba4['includes']('target')||_0x5dff55[_0x590390(0x95)]('level.temperature')||_0x5dff55[_0x590390(0x95)](_0x590390(0xab)))return _0xbd7f43;}}}}catch(_0x1716ac){}return null;}async function scanThermostats(_0x139571){const _0xf2eedd=a1_0x5e07e1,_0x20805a=_0x139571['config'][_0xf2eedd(0xb2)]||[],_0x4b0aa7=[],_0x3bc3d6=_0x20805a['filter'](_0x491ec5=>_0x491ec5['id']&&_0x491ec5['id'][_0xf2eedd(0x95)](_0xf2eedd(0x9a))||_0x491ec5[_0xf2eedd(0x8c)]&&[_0xf2eedd(0x9a),_0xf2eedd(0xab),'sensor']['includes'](_0x491ec5[_0xf2eedd(0x8c)])||_0x491ec5[_0xf2eedd(0x80)]&&_0x491ec5['name'][_0xf2eedd(0x86)]()[_0xf2eedd(0x95)](_0xf2eedd(0xbe)));for(const _0x4871e6 of _0x3bc3d6){const _0x105364=await findSetpointId(_0x139571,_0x4871e6['id']);let _0x527e63=_0xf2eedd(0xaf),_0x29903a=![],_0x3c19fd=_0x139571[_0xf2eedd(0x96)][_0xf2eedd(0xad)]||{};if(typeof _0x3c19fd===_0xf2eedd(0x72))try{_0x3c19fd=JSON[_0xf2eedd(0x6f)](_0x3c19fd);}catch(_0x5d7cc7){}if(_0x3c19fd[_0x4871e6['id']]&&_0x3c19fd[_0x4871e6['id']]===_0x105364)_0x527e63=_0xf2eedd(0xa2),_0x29903a=!![];else _0x105364&&(_0x527e63=_0xf2eedd(0x7f));_0x4b0aa7['push']({'room':_0x4871e6[_0xf2eedd(0xbf)]||_0xf2eedd(0xbd),'sensorId':_0x4871e6['id'],'setpointId':_0x105364||'-','source':_0x527e63,'isManual':_0x29903a,'status':_0x105364?'OK':'Fehlt'});}return _0x4b0aa7[_0xf2eedd(0x8d)]((_0x31e96e,_0xc1a505)=>_0x31e96e[_0xf2eedd(0xac)]['localeCompare'](_0xc1a505[_0xf2eedd(0xac)]));}async function applyEnergySavings(_0x1cc42d,_0x45f513){const _0x27c293=a1_0x5e07e1,_0x2298d8=_0x1cc42d[_0x27c293(0x96)][_0x27c293(0xb2)]||[];for(const _0x1cef25 of _0x45f513){const _0x22eb95=_0x1cef25[_0x27c293(0xac)],_0x3ac49c=_0x1cef25['minutes_safe'],_0x5a0ab1=Date[_0x27c293(0x99)]();if(lastActions[_0x27c293(0xb4)+_0x22eb95]&&_0x5a0ab1-lastActions[_0x27c293(0xb4)+_0x22eb95]<0x1e*0x3c*0x3e8)continue;const _0x103310=_0x2298d8[_0x27c293(0xbb)](_0x5aede6=>normalize(_0x5aede6[_0x27c293(0xbf)])===normalize(_0x22eb95));if(!_0x103310)continue;const _0x5c47d6=await findSetpointId(_0x1cc42d,_0x103310['id']);if(_0x5c47d6){const _0x33f97a=await _0x1cc42d[_0x27c293(0xa4)](_0x5c47d6);if(_0x33f97a&&typeof _0x33f97a[_0x27c293(0x75)]==='number'){const _0x539504=_0x33f97a[_0x27c293(0x75)];if(_0x3ac49c>0x1e&&_0x539504>0x11){const _0x30aaba=_0x539504-0x1;_0x1cc42d['log'][_0x27c293(0x87)]('üçÉ\x20MPC\x20Autonomy:\x20Senke\x20'+_0x22eb95+'\x20('+_0x5c47d6+_0x27c293(0x71)+_0x30aaba+'¬∞C\x20(Coasting\x20m√∂glich:\x20'+_0x3ac49c+_0x27c293(0x74)),await _0x1cc42d[_0x27c293(0xa9)](_0x5c47d6,_0x30aaba),lastActions[_0x27c293(0xb4)+_0x22eb95]=_0x5a0ab1,await _0x1cc42d[_0x27c293(0x98)]('analysis.automation.lastAction',{'val':'[MPC]\x20'+_0x22eb95+_0x27c293(0x7d),'ack':!![]});}}}}}function a1_0x165a(_0x36c4b9,_0x1b3791){const _0x1115d8=a1_0x2a89();return a1_0x165a=function(_0x255254,_0x50081a){_0x255254=_0x255254-0x6f;let _0x2a89b7=_0x1115d8[_0x255254];return _0x2a89b7;},a1_0x165a(_0x36c4b9,_0x1b3791);}module[a1_0x5e07e1(0x85)]={'handlePrediction':handlePrediction,'applyEnergySavings':applyEnergySavings,'scanThermostats':scanThermostats};