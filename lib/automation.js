const a1_0x4e9e5b=a1_0x33c6;(function(_0xf98106,_0x28ef53){const _0x794fad=a1_0x33c6,_0x309eca=_0xf98106();while(!![]){try{const _0x52e9a7=parseInt(_0x794fad(0x1ff))/0x1*(parseInt(_0x794fad(0x206))/0x2)+parseInt(_0x794fad(0x218))/0x3*(-parseInt(_0x794fad(0x1d4))/0x4)+-parseInt(_0x794fad(0x229))/0x5*(-parseInt(_0x794fad(0x19d))/0x6)+-parseInt(_0x794fad(0x21b))/0x7*(parseInt(_0x794fad(0x19c))/0x8)+-parseInt(_0x794fad(0x237))/0x9+parseInt(_0x794fad(0x1cb))/0xa*(parseInt(_0x794fad(0x203))/0xb)+-parseInt(_0x794fad(0x1a6))/0xc*(-parseInt(_0x794fad(0x235))/0xd);if(_0x52e9a7===_0x28ef53)break;else _0x309eca['push'](_0x309eca['shift']());}catch(_0x28c64d){_0x309eca['push'](_0x309eca['shift']());}}}(a1_0x4509,0x7c787));const a1_0x295df3=(function(){let _0x5ae2d0=!![];return function(_0x3c3d71,_0x15baf3){const _0x5acc32=_0x5ae2d0?function(){if(_0x15baf3){const _0x344037=_0x15baf3['apply'](_0x3c3d71,arguments);return _0x15baf3=null,_0x344037;}}:function(){};return _0x5ae2d0=![],_0x5acc32;};}()),a1_0x1eb81e=a1_0x295df3(this,function(){const _0x12b512=a1_0x33c6;return a1_0x1eb81e[_0x12b512(0x1fd)]()[_0x12b512(0x18a)](_0x12b512(0x1f8))[_0x12b512(0x1fd)]()[_0x12b512(0x21a)](a1_0x1eb81e)[_0x12b512(0x18a)]('(((.+)+)+)+$');});a1_0x1eb81e();'use strict';function a1_0x33c6(_0x3e61d9,_0x5bbc55){const _0x94204=a1_0x4509();return a1_0x33c6=function(_0x1eb81e,_0x295df3){_0x1eb81e=_0x1eb81e-0x181;let _0x4509c8=_0x94204[_0x1eb81e];return _0x4509c8;},a1_0x33c6(_0x3e61d9,_0x5bbc55);}const aiAgent=require('./ai_agent'),COOLDOWN_MS=0x3c*0x3e8,CAL_COOLDOWN_MS=0x5a*0x3c*0x3e8,RESCUE_LOCK_MS=0x78*0x3c*0x3e8,ECO_TEMP=0x11,lastActions={};function normalize(_0xca5607){const _0x50ef99=a1_0x33c6;if(!_0xca5607)return'';return _0xca5607[_0x50ef99(0x23a)]()[_0x50ef99(0x1bb)](/\s+/g,'')[_0x50ef99(0x1b9)]();}async function logAutomationAction(_0x3c45ee,_0xe2bde9){const _0x244d1e=a1_0x33c6;await _0x3c45ee[_0x244d1e(0x1eb)](_0x244d1e(0x1db),{'val':_0xe2bde9,'ack':!![]});try{const _0x431890=_0x244d1e(0x1b5),_0x3966cd=await _0x3c45ee[_0x244d1e(0x197)](_0x431890);let _0x11e193=[];if(_0x3966cd&&_0x3966cd[_0x244d1e(0x193)])try{_0x11e193=JSON[_0x244d1e(0x201)](_0x3966cd[_0x244d1e(0x193)]);}catch(_0x5982fa){}_0x11e193[_0x244d1e(0x194)]({'ts':Date[_0x244d1e(0x214)](),'msg':_0xe2bde9});if(_0x11e193[_0x244d1e(0x1d7)]>0x32)_0x11e193=_0x11e193[_0x244d1e(0x191)](0x0,0x32);await _0x3c45ee[_0x244d1e(0x1eb)](_0x431890,{'val':JSON[_0x244d1e(0x1c3)](_0x11e193),'ack':!![]});}catch(_0x384433){}}async function handlePrediction(_0x313569,_0x1e84b6,_0x462ee1){const _0x4c7b66=a1_0x33c6;if(!_0x1e84b6||_0x1e84b6===_0x4c7b66(0x1a8))return;let _0x2301a4='off',_0x3fb1d6=0.6;try{const _0xe504e7=await _0x313569[_0x4c7b66(0x197)](_0x4c7b66(0x1da));if(_0xe504e7&&_0xe504e7[_0x4c7b66(0x193)])_0x2301a4=_0xe504e7[_0x4c7b66(0x193)];const _0xee2a55=await _0x313569[_0x4c7b66(0x197)](_0x4c7b66(0x1c6));if(_0xee2a55&&_0xee2a55[_0x4c7b66(0x193)])_0x3fb1d6=_0xee2a55['val'];}catch(_0x49ba39){}if(_0x2301a4===_0x4c7b66(0x182)||_0x462ee1<_0x3fb1d6)return;const _0x3f502e=Date[_0x4c7b66(0x214)]();if(lastActions[_0x1e84b6]&&_0x3f502e-lastActions[_0x1e84b6]<COOLDOWN_MS)return;const _0x5a37f4=_0x313569[_0x4c7b66(0x1a9)]['devices']||[],_0x5316bc=normalize(_0x1e84b6),_0x1bfcdb=_0x5a37f4[_0x4c7b66(0x1aa)](_0x54ac23=>normalize(_0x54ac23[_0x4c7b66(0x21c)])===_0x5316bc&&(_0x54ac23[_0x4c7b66(0x1e9)]===_0x4c7b66(0x23d)||_0x54ac23[_0x4c7b66(0x1e9)]===_0x4c7b66(0x1b2)||_0x54ac23[_0x4c7b66(0x1e9)]===_0x4c7b66(0x202)));if(!_0x1bfcdb)return;const _0x4e142c=await aiAgent[_0x4c7b66(0x199)](_0x313569,_0x1e84b6,_0x1bfcdb[_0x4c7b66(0x1ca)],_0x462ee1);if(!_0x4e142c['approved'])return;const _0x3f9c54='Pr√§diktion:\x20'+_0x1e84b6+'\x20->\x20Schalte\x20'+_0x1bfcdb[_0x4c7b66(0x1ca)]+'\x20('+_0x4e142c[_0x4c7b66(0x1e7)]+')';await logAutomationAction(_0x313569,'['+_0x2301a4[_0x4c7b66(0x1d8)]()+']\x20'+_0x3f9c54);if(_0x2301a4==='active'){const _0x5c590e=await _0x313569['getForeignStateAsync'](_0x1bfcdb['id']);(!_0x5c590e||!_0x5c590e['val']&&_0x5c590e[_0x4c7b66(0x193)]!==!![])&&await _0x313569[_0x4c7b66(0x1cc)](_0x1bfcdb['id'],!![]),lastActions[_0x1e84b6]=_0x3f502e;}}async function findRelatedId(_0x738500,_0x43efc3,_0x593d4b='setpoint'){const _0xf2ed5d=a1_0x33c6;if(_0x593d4b==='setpoint'&&_0x738500[_0xf2ed5d(0x1a9)][_0xf2ed5d(0x1f4)]){let _0x51e8a4=_0x738500[_0xf2ed5d(0x1a9)][_0xf2ed5d(0x1f4)];if(typeof _0x51e8a4===_0xf2ed5d(0x211))try{_0x51e8a4=JSON[_0xf2ed5d(0x201)](_0x51e8a4);}catch(_0x202b6d){}if(_0x51e8a4&&_0x51e8a4[_0x43efc3])return _0x51e8a4[_0x43efc3];}if(_0x593d4b===_0xf2ed5d(0x22f)&&_0x738500[_0xf2ed5d(0x1a9)]['valveMapping']){let _0xf70453=_0x738500[_0xf2ed5d(0x1a9)][_0xf2ed5d(0x1e3)];if(typeof _0xf70453===_0xf2ed5d(0x211))try{_0xf70453=JSON[_0xf2ed5d(0x201)](_0xf70453);}catch(_0xaa22a6){}if(_0xf70453&&_0xf70453[_0x43efc3])return _0xf70453[_0x43efc3];}let _0x57902b=[];if(_0x593d4b===_0xf2ed5d(0x1c1))_0x57902b=[{'s':_0xf2ed5d(0x1f7),'t':_0xf2ed5d(0x21f)},{'s':'.1.TEMPERATURE','t':'.1.SET_POINT_TEMPERATURE'},{'s':_0xf2ed5d(0x1dc),'t':_0xf2ed5d(0x204)},{'s':_0xf2ed5d(0x198),'t':_0xf2ed5d(0x1de)},{'s':_0xf2ed5d(0x1e1),'t':_0xf2ed5d(0x195)},{'s':_0xf2ed5d(0x1e1),'t':_0xf2ed5d(0x221)},{'s':'temperature','t':'target_temperature'},{'s':_0xf2ed5d(0x19e),'t':'SET'},{'s':_0xf2ed5d(0x1fa),'t':_0xf2ed5d(0x1a5)},{'s':'temperature','t':_0xf2ed5d(0x1c1)}];else _0x593d4b===_0xf2ed5d(0x22f)&&(_0x57902b=[{'s':_0xf2ed5d(0x1f7),'t':_0xf2ed5d(0x1f6)},{'s':_0xf2ed5d(0x1dc),'t':_0xf2ed5d(0x1f6)},{'s':_0xf2ed5d(0x1dc),'t':_0xf2ed5d(0x1c4)},{'s':_0xf2ed5d(0x1e1),'t':'pi_heating_demand'},{'s':_0xf2ed5d(0x18b),'t':'valve_position'},{'s':_0xf2ed5d(0x18b),'t':'level'}]);for(const _0x239025 of _0x57902b){if(_0x43efc3[_0xf2ed5d(0x1ce)](_0x239025['s'])){const _0x52236e=_0x43efc3['replace'](_0x239025['s'],_0x239025['t']),_0x595144=await _0x738500[_0xf2ed5d(0x1fe)](_0x52236e);if(_0x595144)return _0x52236e;}}try{const _0x5ba0b1=_0x43efc3['split']('.');if(_0x5ba0b1[_0xf2ed5d(0x1d7)]>0x2){const _0x3f738c=_0x5ba0b1[_0xf2ed5d(0x191)](0x0,-0x1)[_0xf2ed5d(0x1d0)]('.'),_0x5bd1a5=await _0x738500[_0xf2ed5d(0x192)](_0x3f738c+'.*'),_0x2af8af=[],_0x5c0556=_0x43efc3[_0xf2ed5d(0x220)](/[._]+/)[_0xf2ed5d(0x209)](_0xf13b98=>!['openknx','0',_0xf2ed5d(0x233),_0xf2ed5d(0x20c),_0xf2ed5d(0x189),_0xf2ed5d(0x18b),_0xf2ed5d(0x1ed),'sensor',_0xf2ed5d(0x216),_0xf2ed5d(0x186)][_0xf2ed5d(0x1ce)](_0xf13b98['toLowerCase']()));for(const [_0x5c74ab,_0x597a2e]of Object[_0xf2ed5d(0x1f5)](_0x5bd1a5)){if(_0x5c74ab===_0x43efc3)continue;if(_0x597a2e&&_0x597a2e[_0xf2ed5d(0x1d9)]){const _0x5d95d6=_0x5c74ab[_0xf2ed5d(0x23a)](),_0x12ec40=(_0x597a2e[_0xf2ed5d(0x1d9)]['role']||'')[_0xf2ed5d(0x23a)](),_0x214383=(_0x597a2e['common']['unit']||'')['toLowerCase']();let _0x47f8b0=![];if(_0x593d4b===_0xf2ed5d(0x1c1)&&_0x597a2e[_0xf2ed5d(0x1d9)][_0xf2ed5d(0x1ec)]===!![])_0x47f8b0=_0x5d95d6[_0xf2ed5d(0x1ce)](_0xf2ed5d(0x1c2))||_0x5d95d6[_0xf2ed5d(0x1ce)]('soll')||_0x5d95d6[_0xf2ed5d(0x1ce)]('target')||_0x12ec40[_0xf2ed5d(0x1ce)](_0xf2ed5d(0x21d))||_0x12ec40[_0xf2ed5d(0x1ce)](_0xf2ed5d(0x1a2));else _0x593d4b===_0xf2ed5d(0x22f)&&(_0x47f8b0=_0x5d95d6[_0xf2ed5d(0x1ce)](_0xf2ed5d(0x184))||_0x5d95d6[_0xf2ed5d(0x1ce)](_0xf2ed5d(0x22f))||_0x5d95d6[_0xf2ed5d(0x1ce)](_0xf2ed5d(0x217))||_0x5d95d6[_0xf2ed5d(0x1ce)](_0xf2ed5d(0x1d6))||_0x12ec40[_0xf2ed5d(0x1ce)](_0xf2ed5d(0x1fc))||_0x12ec40[_0xf2ed5d(0x1ce)](_0xf2ed5d(0x1c8))||_0x214383[_0xf2ed5d(0x1ce)]('%'));if(_0x47f8b0){const _0x182c42=_0x5c74ab[_0xf2ed5d(0x220)](/[._]+/)[_0xf2ed5d(0x234)](_0x73b653=>_0x73b653[_0xf2ed5d(0x23a)]());let _0x4aaefd=0x0;_0x5c0556[_0xf2ed5d(0x1b1)](_0x27bc6d=>{const _0x2c7fe8=_0xf2ed5d;if(_0x182c42[_0x2c7fe8(0x1ce)](_0x27bc6d[_0x2c7fe8(0x23a)]()))_0x4aaefd++;}),_0x2af8af[_0xf2ed5d(0x1d1)]({'id':_0x5c74ab,'score':_0x4aaefd});}}}if(_0x2af8af[_0xf2ed5d(0x1d7)]>0x0){_0x2af8af[_0xf2ed5d(0x1ee)]((_0x3d9597,_0x34d01f)=>_0x34d01f['score']-_0x3d9597[_0xf2ed5d(0x1e2)]);if(_0x2af8af[0x0][_0xf2ed5d(0x1e2)]>0x0)return _0x2af8af[0x0]['id'];}}}catch(_0x1b847f){}return null;}async function scanThermostats(_0x2fc4b5){const _0x5e361b=a1_0x33c6,_0x92b8de=_0x2fc4b5['config']['devices']||[],_0x4c36bd=[],_0x4b93e4=_0x92b8de[_0x5e361b(0x209)](_0x51ba7f=>_0x51ba7f['id']&&_0x51ba7f['id'][_0x5e361b(0x1ce)](_0x5e361b(0x18b))||_0x51ba7f[_0x5e361b(0x1e9)]&&[_0x5e361b(0x18b),_0x5e361b(0x1d2),'sensor'][_0x5e361b(0x1ce)](_0x51ba7f[_0x5e361b(0x1e9)])||_0x51ba7f['name']&&_0x51ba7f['name'][_0x5e361b(0x23a)]()[_0x5e361b(0x1ce)](_0x5e361b(0x1b8)));for(const _0x371ee3 of _0x4b93e4){const _0x498f81=await findRelatedId(_0x2fc4b5,_0x371ee3['id'],_0x5e361b(0x1c1)),_0x103f9a=await findRelatedId(_0x2fc4b5,_0x371ee3['id'],_0x5e361b(0x22f));let _0x245eae=_0x5e361b(0x188),_0x4f1ec7=![],_0x380c58=_0x2fc4b5['config'][_0x5e361b(0x1f4)]||{};if(typeof _0x380c58===_0x5e361b(0x211))try{_0x380c58=JSON[_0x5e361b(0x201)](_0x380c58);}catch(_0x28fc31){}let _0x15daa4=_0x2fc4b5[_0x5e361b(0x1a9)]['valveMapping']||{};if(typeof _0x15daa4===_0x5e361b(0x211))try{_0x15daa4=JSON[_0x5e361b(0x201)](_0x15daa4);}catch(_0x594aca){}if(_0x380c58[_0x371ee3['id']]&&_0x380c58[_0x371ee3['id']]===_0x498f81||_0x15daa4[_0x371ee3['id']]&&_0x15daa4[_0x371ee3['id']]===_0x103f9a)_0x245eae=_0x5e361b(0x213),_0x4f1ec7=!![];else(_0x498f81||_0x103f9a)&&(_0x245eae=_0x5e361b(0x20a));_0x4c36bd[_0x5e361b(0x1d1)]({'room':_0x371ee3[_0x5e361b(0x21c)]||_0x5e361b(0x21e),'sensorId':_0x371ee3['id'],'setpointId':_0x498f81||'-','valveId':_0x103f9a||'-','source':_0x245eae,'isManual':_0x4f1ec7,'status':_0x498f81&&_0x103f9a?_0x5e361b(0x23b):_0x498f81?'OK':_0x5e361b(0x1e8)});}return _0x4c36bd[_0x5e361b(0x1ee)]((_0x19216f,_0x2ace98)=>_0x19216f['room'][_0x5e361b(0x18f)](_0x2ace98[_0x5e361b(0x1ef)]));}async function updateSchedulePreview(_0x2cacdd){const _0x228be9=a1_0x33c6;if(!_0x2cacdd[_0x228be9(0x1a9)][_0x228be9(0x20d)]||!_0x2cacdd[_0x228be9(0x1a9)][_0x228be9(0x1bf)])return;let _0x460350={};try{const _0x55a6a1=await _0x2cacdd['getStateAsync']('analysis.energy.warmupTimes');if(_0x55a6a1&&_0x55a6a1['val'])_0x460350=JSON[_0x228be9(0x201)](_0x55a6a1[_0x228be9(0x193)]);}catch(_0x1c4ba2){}const _0x14a6e8=[],_0x42ec85=Date[_0x228be9(0x214)](),_0x9b3afb=0x30*0x3c*0x3c*0x3e8;try{const _0x2343e6=await _0x2cacdd['getForeignStateAsync'](_0x2cacdd[_0x228be9(0x1a9)][_0x228be9(0x1bf)]+_0x228be9(0x1ac));if(!_0x2343e6||!_0x2343e6[_0x228be9(0x193)])return;const _0x1da0e1=JSON['parse'](_0x2343e6[_0x228be9(0x193)]),_0x299511=_0x2cacdd[_0x228be9(0x1a9)]['calendarSelection']||[],_0x3916f8=_0x2cacdd[_0x228be9(0x1a9)][_0x228be9(0x212)]||[],_0x46196f=new Set();_0x3916f8['forEach'](_0x1711ff=>{const _0x423947=_0x228be9;if(_0x1711ff[_0x423947(0x21c)])_0x46196f[_0x423947(0x18c)](_0x1711ff[_0x423947(0x21c)]);});for(const _0x301ab0 of _0x1da0e1){if(_0x301ab0['_calName']&&_0x299511['length']>0x0&&!_0x299511[_0x228be9(0x1ce)](_0x301ab0[_0x228be9(0x181)]))continue;const _0x51cb56=_0x301ab0[_0x228be9(0x223)]||_0x301ab0[_0x228be9(0x1f3)]||_0x301ab0[_0x228be9(0x1f0)];if(!_0x51cb56)continue;const _0x503f09=new Date(_0x51cb56),_0x377e67=_0x503f09['getTime']();if(isNaN(_0x377e67))continue;if(_0x377e67<_0x42ec85)continue;if(_0x377e67>_0x42ec85+_0x9b3afb)continue;const _0x1672cf=(_0x301ab0['event']||_0x301ab0['summary']||'')[_0x228be9(0x23a)]();let _0x4ea727=![],_0x62de85=[],_0x360bdf=_0x301ab0[_0x228be9(0x187)]||_0x301ab0['summary']||_0x228be9(0x21e);if(_0x1672cf[_0x228be9(0x1ce)](_0x228be9(0x23c))||_0x1672cf[_0x228be9(0x1ce)](_0x228be9(0x1a1))||_0x1672cf[_0x228be9(0x1ce)](_0x228be9(0x219)))_0x4ea727=!![],_0x62de85=Array[_0x228be9(0x18d)](_0x46196f);else for(const _0x273a0d of _0x46196f){if(_0x1672cf[_0x228be9(0x1ce)](_0x273a0d[_0x228be9(0x23a)]()))_0x62de85[_0x228be9(0x1d1)](_0x273a0d);}_0x62de85[_0x228be9(0x1d7)]>0x0&&_0x62de85[_0x228be9(0x1b1)](_0x174cbb=>{const _0x375f17=_0x228be9;let _0x4872b4=0x3c;if(_0x4ea727){let _0x1df972=0x0;Object[_0x375f17(0x22b)](_0x460350)['forEach'](_0xc65ec6=>{if(_0xc65ec6>_0x1df972)_0x1df972=_0xc65ec6;}),_0x4872b4=_0x1df972>0x0?_0x1df972:0x78;}else _0x4872b4=_0x460350[_0x174cbb]||0x3c;const _0x3ea47e=new Date(_0x377e67-_0x4872b4*0xea60);_0x14a6e8[_0x375f17(0x1d1)]({'eventTime':_0x377e67,'triggerTime':_0x3ea47e[_0x375f17(0x238)](),'room':_0x174cbb,'minutes':_0x4872b4,'reason':_0x360bdf,'isGlobal':_0x4ea727});});}}catch(_0x385734){}_0x14a6e8[_0x228be9(0x1ee)]((_0x2878c1,_0x4840bb)=>_0x2878c1[_0x228be9(0x228)]-_0x4840bb[_0x228be9(0x228)]);const _0x2473fb=_0x14a6e8[_0x228be9(0x191)](0x0,0x5);await _0x2cacdd[_0x228be9(0x1eb)](_0x228be9(0x19f),{'val':JSON[_0x228be9(0x1c3)](_0x2473fb),'ack':!![]});}async function checkCalendarTriggers(_0x2375a9){const _0x5611db=a1_0x33c6;if(!_0x2375a9[_0x5611db(0x1a9)][_0x5611db(0x20d)]||!_0x2375a9[_0x5611db(0x1a9)][_0x5611db(0x1bf)])return;await updateSchedulePreview(_0x2375a9);let _0x41e386={},_0x53dbbf={};try{const _0xea8dee=await _0x2375a9[_0x5611db(0x197)](_0x5611db(0x236));if(_0xea8dee&&_0xea8dee[_0x5611db(0x193)])_0x41e386=JSON[_0x5611db(0x201)](_0xea8dee[_0x5611db(0x193)]);const _0x428c3f=await _0x2375a9['getStateAsync'](_0x5611db(0x1af));if(_0x428c3f&&_0x428c3f['val'])_0x53dbbf=JSON[_0x5611db(0x201)](_0x428c3f[_0x5611db(0x193)]);}catch(_0x4f3716){}let _0x286fdd={'default':0x15};try{const _0xfe48c6=await _0x2375a9[_0x5611db(0x197)](_0x5611db(0x208));if(_0xfe48c6&&_0xfe48c6[_0x5611db(0x193)])_0x286fdd=JSON[_0x5611db(0x201)](_0xfe48c6[_0x5611db(0x193)]);}catch(_0x281406){}try{const _0x5a3d76=await _0x2375a9['getForeignStateAsync'](_0x2375a9[_0x5611db(0x1a9)]['calendarInstance']+_0x5611db(0x1ac));if(!_0x5a3d76||!_0x5a3d76[_0x5611db(0x193)])return;const _0x4eb4ea=JSON[_0x5611db(0x201)](_0x5a3d76['val']),_0x806d29=Date[_0x5611db(0x214)](),_0x2038f4=_0x2375a9[_0x5611db(0x1a9)][_0x5611db(0x212)]||[],_0x147f6f=_0x2375a9['config'][_0x5611db(0x215)]||[];for(const _0x55af96 of _0x4eb4ea){if(_0x55af96[_0x5611db(0x181)]&&_0x147f6f[_0x5611db(0x1d7)]>0x0&&!_0x147f6f[_0x5611db(0x1ce)](_0x55af96[_0x5611db(0x181)]))continue;const _0x3df26c=_0x55af96['_date']||_0x55af96['eventStart']||_0x55af96[_0x5611db(0x1f0)];if(!_0x3df26c)continue;const _0x11daf4=new Date(_0x3df26c);if(isNaN(_0x11daf4[_0x5611db(0x238)]()))continue;const _0x8c7e7e=(_0x55af96['event']||_0x55af96[_0x5611db(0x20f)]||'')[_0x5611db(0x23a)]();if(_0x8c7e7e[_0x5611db(0x1ce)](_0x5611db(0x23c))||_0x8c7e7e[_0x5611db(0x1ce)](_0x5611db(0x1a1))||_0x8c7e7e[_0x5611db(0x1ce)](_0x5611db(0x219))){let _0x115bd3=0x0;Object[_0x5611db(0x22b)](_0x41e386)[_0x5611db(0x1b1)](_0x3fe11e=>{if(_0x3fe11e>_0x115bd3)_0x115bd3=_0x3fe11e;});if(_0x115bd3===0x0)_0x115bd3=0x78;const _0x568f94=_0x11daf4[_0x5611db(0x238)]()-_0x115bd3*0xea60;_0x806d29>=_0x568f94&&_0x806d29<_0x11daf4[_0x5611db(0x238)]()&&(_0x2375a9[_0x5611db(0x20b)]!==_0x5611db(0x18e)&&(_0x2375a9[_0x5611db(0x1e6)]['info'](_0x5611db(0x1e4)+_0x115bd3+_0x5611db(0x1ad)),await _0x2375a9[_0x5611db(0x1eb)](_0x5611db(0x1d3),{'val':_0x5611db(0x18e),'ack':![]})));}for(const _0x1adac2 of _0x2038f4){if(_0x1adac2[_0x5611db(0x21c)]){const _0x5283b3=_0x1adac2[_0x5611db(0x21c)]['toLowerCase']();if(_0x8c7e7e[_0x5611db(0x1ce)](_0x5283b3)){const _0x17523d=_0x41e386[_0x1adac2[_0x5611db(0x21c)]]||0x3c,_0x420b60=_0x53dbbf[_0x1adac2['location']]||_0x5611db(0x22c),_0x5ddca4=_0x11daf4[_0x5611db(0x238)]()-_0x17523d*0xea60;if(_0x806d29>=_0x5ddca4&&_0x806d29<_0x11daf4[_0x5611db(0x238)]()){const _0x2ea8b5=lastActions['cal_'+_0x1adac2[_0x5611db(0x21c)]];if(_0x2ea8b5&&_0x806d29-_0x2ea8b5<CAL_COOLDOWN_MS)continue;const _0x2b38b1=await findRelatedId(_0x2375a9,_0x1adac2['id'],_0x5611db(0x1c1));if(_0x2b38b1){let _0x182354=_0x286fdd[_0x1adac2['location']];if(_0x182354===undefined)_0x182354=_0x286fdd[_0x5611db(0x1d5)];if(_0x182354===undefined)_0x182354=0x15;const _0x815eb8=await _0x2375a9[_0x5611db(0x1e5)](_0x2b38b1);_0x815eb8&&typeof _0x815eb8[_0x5611db(0x193)]===_0x5611db(0x1bd)&&_0x815eb8[_0x5611db(0x193)]<_0x182354-0.5&&(_0x2375a9['log'][_0x5611db(0x20e)](_0x5611db(0x190)+_0x420b60+_0x5611db(0x1f9)+_0x1adac2[_0x5611db(0x21c)]+'\x27\x20aktiv.\x20Heize\x20auf\x20'+_0x182354+'¬∞C\x20(Vorlauf:\x20'+_0x17523d+'\x20min).'),await _0x2375a9[_0x5611db(0x1cc)](_0x2b38b1,_0x182354),await logAutomationAction(_0x2375a9,_0x5611db(0x224)+_0x1adac2['location']+_0x5611db(0x210)+_0x182354+_0x5611db(0x196)+_0x420b60+')'),lastActions['cal_'+_0x1adac2[_0x5611db(0x21c)]]=_0x806d29);}}}}}}}catch(_0x13fa7b){_0x2375a9[_0x5611db(0x1e6)]['warn'](_0x5611db(0x1cd)+_0x13fa7b[_0x5611db(0x1b0)]);}}async function manageMpcIntervention(_0x33e5a9,_0x3134e3,_0x53da87){const _0x374df3=a1_0x33c6;try{const _0x15d1bf=_0x374df3(0x1be),_0x11fbc5=await _0x33e5a9[_0x374df3(0x197)](_0x15d1bf);let _0x53cdc1=[];if(_0x11fbc5&&_0x11fbc5[_0x374df3(0x193)])try{_0x53cdc1=JSON[_0x374df3(0x201)](_0x11fbc5['val']);}catch(_0x169f98){}const _0x384a81=_0x53cdc1[_0x374df3(0x226)](_0x3134e3);if(_0x53da87==='add')_0x384a81===-0x1&&(_0x53cdc1[_0x374df3(0x1d1)](_0x3134e3),await _0x33e5a9[_0x374df3(0x1eb)](_0x15d1bf,{'val':JSON[_0x374df3(0x1c3)](_0x53cdc1),'ack':!![]}));else _0x53da87===_0x374df3(0x200)&&(_0x384a81!==-0x1&&(_0x53cdc1['splice'](_0x384a81,0x1),await _0x33e5a9[_0x374df3(0x1eb)](_0x15d1bf,{'val':JSON[_0x374df3(0x1c3)](_0x53cdc1),'ack':!![]})));}catch(_0x11cb32){}}async function cleanupGhostInterventions(_0x49a038){const _0x2b1fba=a1_0x33c6;try{const _0x124e40=_0x2b1fba(0x1be),_0x453e83=await _0x49a038[_0x2b1fba(0x197)](_0x124e40);if(!_0x453e83||!_0x453e83[_0x2b1fba(0x193)])return;const _0x411537=JSON['parse'](_0x453e83[_0x2b1fba(0x193)]);if(!Array[_0x2b1fba(0x183)](_0x411537)||_0x411537['length']===0x0)return;let _0x376f01={'default':0x15};try{const _0x537dda=await _0x49a038[_0x2b1fba(0x197)](_0x2b1fba(0x208));if(_0x537dda&&_0x537dda[_0x2b1fba(0x193)])_0x376f01=JSON[_0x2b1fba(0x201)](_0x537dda[_0x2b1fba(0x193)]);}catch(_0x45026c){}let _0x472d0e=[];try{const _0x8d60c4=await _0x49a038[_0x2b1fba(0x197)](_0x2b1fba(0x185));if(_0x8d60c4&&_0x8d60c4[_0x2b1fba(0x193)])_0x472d0e=JSON['parse'](_0x8d60c4['val']);}catch(_0x404d30){}const _0x2946d7=_0x49a038[_0x2b1fba(0x1a9)][_0x2b1fba(0x212)]||[];let _0x2274d8=![];for(let _0x170b85=_0x411537[_0x2b1fba(0x1d7)]-0x1;_0x170b85>=0x0;_0x170b85--){const _0x5074ec=_0x411537[_0x170b85],_0x418542=_0x2946d7[_0x2b1fba(0x1aa)](_0x379355=>normalize(_0x379355['location'])===normalize(_0x5074ec)&&(_0x379355[_0x2b1fba(0x1e9)]===_0x2b1fba(0x18b)||_0x379355[_0x2b1fba(0x1e9)]===_0x2b1fba(0x1d2)));if(!_0x418542){_0x49a038[_0x2b1fba(0x1e6)][_0x2b1fba(0x22d)](_0x2b1fba(0x1c5)+_0x5074ec+_0x2b1fba(0x1a4)),_0x411537[_0x2b1fba(0x1e0)](_0x170b85,0x1),_0x2274d8=!![];continue;}if(_0x418542){const _0x45f4fd=await findRelatedId(_0x49a038,_0x418542['id'],_0x2b1fba(0x1c1)),_0x4e7a99=await _0x49a038['getForeignStateAsync'](_0x418542['id']);if(_0x45f4fd){const _0x3dcd3b=await _0x49a038[_0x2b1fba(0x1e5)](_0x45f4fd);if(_0x3dcd3b&&typeof _0x3dcd3b[_0x2b1fba(0x193)]===_0x2b1fba(0x1bd)){let _0x149d8a=![],_0x3b1580='';Math[_0x2b1fba(0x22e)](_0x3dcd3b[_0x2b1fba(0x193)]-ECO_TEMP)>0.5&&(_0x149d8a=!![],_0x3b1580=_0x2b1fba(0x1a0));if(!_0x149d8a&&_0x4e7a99&&typeof _0x4e7a99[_0x2b1fba(0x193)]==='number'){const _0x3df2e6=_0x376f01[_0x5074ec]||_0x376f01[_0x2b1fba(0x1d5)]||0x15;_0x4e7a99['val']<_0x3df2e6+0.2&&(_0x149d8a=!![],_0x3b1580=_0x2b1fba(0x222));}if(_0x149d8a){if(_0x3b1580===_0x2b1fba(0x1a0)){_0x49a038[_0x2b1fba(0x1e6)]['info']('üßπ\x20[MPC\x20CLEANUP]\x20'+_0x5074ec+_0x2b1fba(0x1b6)+_0x3dcd3b['val']+_0x2b1fba(0x1ea)+ECO_TEMP+_0x2b1fba(0x19a));const _0xc5d403=lastActions['cal_'+_0x5074ec],_0x29214d=_0xc5d403&&Date[_0x2b1fba(0x214)]()-_0xc5d403<0x2*0x3c*0x3e8;if(!_0x29214d&&_0x3dcd3b[_0x2b1fba(0x193)]>ECO_TEMP+0.5)_0x49a038['sendToPythonWrapper']&&(_0x49a038['log'][_0x2b1fba(0x20e)]('üéì\x20[RL-FEEDBACK]\x20Lerne\x20aus\x20Fehler:\x20'+_0x5074ec+_0x2b1fba(0x225)),_0x49a038[_0x2b1fba(0x1ba)](_0x2b1fba(0x1f1),{'room':_0x5074ec}));else _0x29214d&&_0x49a038[_0x2b1fba(0x1e6)][_0x2b1fba(0x20e)](_0x2b1fba(0x1ab)+_0x5074ec+_0x2b1fba(0x1c7));}else{if(_0x3b1580==='too_cold'){let _0x1e6dd9=![];if(_0x472d0e[_0x2b1fba(0x1aa)](_0x60315e=>_0x60315e[_0x2b1fba(0x1ef)]===_0x5074ec))_0x1e6dd9=!![];const _0x416160=_0x2946d7[_0x2b1fba(0x209)](_0xa12acf=>normalize(_0xa12acf['location'])===normalize(_0x5074ec)&&(_0xa12acf['type']===_0x2b1fba(0x1bc)||_0xa12acf['type']===_0x2b1fba(0x1c9)||_0xa12acf[_0x2b1fba(0x1e9)]===_0x2b1fba(0x207)));for(const _0x543796 of _0x416160){try{const _0x5e11e9=await _0x49a038['getForeignStateAsync'](_0x543796['id']);if(_0x5e11e9&&(_0x5e11e9[_0x2b1fba(0x193)]===!![]||_0x5e11e9[_0x2b1fba(0x193)]===0x1||String(_0x5e11e9[_0x2b1fba(0x193)])[_0x2b1fba(0x23a)]()==='open'))_0x1e6dd9=!![];}catch(_0x57993a){}}if(_0x1e6dd9)_0x49a038['log'][_0x2b1fba(0x20e)](_0x2b1fba(0x1ae)+_0x5074ec+_0x2b1fba(0x1df));else{const _0x26cdf0=_0x376f01[_0x5074ec]||_0x376f01['default']||0x15;_0x49a038[_0x2b1fba(0x1e6)][_0x2b1fba(0x20e)](_0x2b1fba(0x1b3)+_0x5074ec+'\x20erreicht\x20Limit\x20('+_0x4e7a99[_0x2b1fba(0x193)]+'¬∞C\x20<\x20'+(_0x26cdf0+0.2)+_0x2b1fba(0x1fb)),await _0x49a038['setForeignStateAsync'](_0x45f4fd,_0x26cdf0),await logAutomationAction(_0x49a038,_0x2b1fba(0x1dd)+_0x5074ec+_0x2b1fba(0x1a7)+_0x26cdf0+'¬∞C'),lastActions[_0x2b1fba(0x1f2)+_0x5074ec]=Date['now']();}}}_0x411537[_0x2b1fba(0x1e0)](_0x170b85,0x1),_0x2274d8=!![];}}}}}_0x2274d8&&await _0x49a038[_0x2b1fba(0x1eb)](_0x124e40,{'val':JSON[_0x2b1fba(0x1c3)](_0x411537),'ack':!![]});}catch(_0x5a7255){}}async function applyEnergySavings(_0x3c7707,_0x25cc4e){const _0x2caa38=a1_0x33c6;await cleanupGhostInterventions(_0x3c7707);if(!_0x25cc4e||_0x25cc4e[_0x2caa38(0x1d7)]===0x0)return;const _0x1e1c23=_0x3c7707[_0x2caa38(0x1a9)][_0x2caa38(0x212)]||[],_0x5a5c0d=Date['now']();for(const _0x19581c of _0x25cc4e){const _0xedc83=_0x19581c[_0x2caa38(0x1ef)],_0x48a96f=_0x19581c[_0x2caa38(0x1b7)],_0x1b5252=_0x19581c[_0x2caa38(0x1b4)]||0x15;if(lastActions[_0x2caa38(0x1f2)+_0xedc83]&&_0x5a5c0d-lastActions[_0x2caa38(0x1f2)+_0xedc83]<RESCUE_LOCK_MS)continue;const _0x3275cf=_0x1e1c23[_0x2caa38(0x1aa)](_0x440833=>normalize(_0x440833[_0x2caa38(0x21c)])===normalize(_0xedc83)&&(_0x440833['type']==='temperature'||_0x440833[_0x2caa38(0x1e9)]===_0x2caa38(0x1d2)));if(!_0x3275cf)continue;const _0x33b137=await findRelatedId(_0x3c7707,_0x3275cf['id'],_0x2caa38(0x1c1));if(_0x33b137){if(lastActions[_0x2caa38(0x231)+_0xedc83]&&_0x5a5c0d-lastActions[_0x2caa38(0x231)+_0xedc83]<0x1e*0x3c*0x3e8)continue;const _0x35a421=await _0x3c7707['getForeignStateAsync'](_0x33b137);if(_0x35a421&&typeof _0x35a421[_0x2caa38(0x193)]==='number'){const _0x3bfa1a=_0x35a421[_0x2caa38(0x193)];_0x3bfa1a!==ECO_TEMP&&await manageMpcIntervention(_0x3c7707,_0xedc83,'remove');if(_0x48a96f>0x1e)_0x3bfa1a>ECO_TEMP+0.5&&(_0x3c7707[_0x2caa38(0x1e6)]['info'](_0x2caa38(0x22a)+_0xedc83+_0x2caa38(0x232)+ECO_TEMP+_0x2caa38(0x230)+_0x48a96f+_0x2caa38(0x205)),await _0x3c7707['setForeignStateAsync'](_0x33b137,ECO_TEMP),await manageMpcIntervention(_0x3c7707,_0xedc83,_0x2caa38(0x18c)),lastActions[_0x2caa38(0x231)+_0xedc83]=_0x5a5c0d,await logAutomationAction(_0x3c7707,_0x2caa38(0x239)+_0xedc83+':\x20Absenkung\x20auf\x20'+ECO_TEMP+'¬∞C'));else _0x48a96f<=0xf&&(_0x3bfa1a<_0x1b5252&&(_0x3c7707['log']['info'](_0x2caa38(0x1c0)+_0xedc83+'\x20wieder\x20auf\x20'+_0x1b5252+_0x2caa38(0x1a3)),await _0x3c7707[_0x2caa38(0x1cc)](_0x33b137,_0x1b5252),await manageMpcIntervention(_0x3c7707,_0xedc83,_0x2caa38(0x200)),lastActions['mpc_'+_0xedc83]=_0x5a5c0d,await logAutomationAction(_0x3c7707,'[MPC]\x20'+_0xedc83+':\x20Aufheizen\x20auf\x20'+_0x1b5252+'¬∞C')));}}else _0x3c7707[_0x2caa38(0x1e6)][_0x2caa38(0x22d)](_0x2caa38(0x227)+_0xedc83+_0x2caa38(0x19b));}}module[a1_0x4e9e5b(0x1cf)]={'handlePrediction':handlePrediction,'applyEnergySavings':applyEnergySavings,'scanThermostats':scanThermostats,'checkCalendarTriggers':checkCalendarTriggers,'updateSchedulePreview':updateSchedulePreview,'cleanupGhostInterventions':cleanupGhostInterventions};function a1_0x4509(){const _0x590fa7=['valve','¬∞C!\x20(Puffer:\x20','mpc_','\x20auf\x20','hm-rpc','map','46267RxvQHt','analysis.energy.warmupTimes','3458925XhtkIN','getTime','[MPC]\x20','toLowerCase','PERFECT','urlaub\x20ende','light','_calName','off','isArray','level','analysis.energy.ventilationAlerts','state','event','Nicht\x20gefunden','wert','search','temperature','add','from','normal','localeCompare','üìÖ\x20SMART\x20SCHEDULE\x20[','slice','getForeignObjectsAsync','val','unshift','occupied_heating_setpoint','¬∞C\x20(via\x20','getStateAsync','ACTUAL_TEMPERATURE','consultButler','¬∞C).\x20Entferne\x20Status.','\x20gefunden!','88gTXxiz','36LjXNli','ACTUAL','analysis.energy.schedulePreview','manual','r√ºckkehr','thermostat.setpoint','¬∞C!\x20(Puffer\x20leer).','\x27\x20hat\x20kein\x20Ger√§t\x20mehr.\x20L√∂sche\x20Eintrag.','Soll','1452CpSfAa',':\x20Puffer\x20leer\x20->\x20Heizen\x20auf\x20','Unknown','config','find','üìÖ\x20[MPC\x20INFO]\x20','.data.table','\x20min).','üå¨Ô∏è\x20[MPC\x20WATCHDOG]\x20','analysis.energy.warmupSources','message','forEach','dimmer','üö®\x20[MPC\x20WATCHDOG]\x20','target','analysis.automation.actionLog','\x20ist\x20auf\x20','minutes_safe','temp','trim','sendToPythonWrapper','replace','window','number','analysis.energy.mpcActiveInterventions','calendarInstance','üî•\x20[MPC\x20ACTION]\x20Heize\x20','setpoint','set','stringify','.4.VALVE_STATE','üßπ\x20[MPC\x20CLEANUP]\x20Raum\x20\x27','analysis.automation.confidenceThreshold','\x20durch\x20Kalender\x20ge√§ndert.\x20Keine\x20RL-Strafe.','value.valve','sensor','name','1837820WkKBJF','setForeignStateAsync','Calendar\x20Check\x20Error:\x20','includes','exports','join','push','thermostat','system.mode','197308cxzWeU','default','position','length','toUpperCase','common','analysis.automation.mode','analysis.automation.lastAction','.1.TEMPERATURE','[WATCHDOG]\x20','SET_POINT_TEMPERATURE','\x20ist\x20zu\x20kalt,\x20ABER\x20Fenster\x20offen/L√ºftung\x20erkannt.\x20Heize\x20NICHT,\x20entferne\x20nur\x20Status.','splice','local_temperature','score','valveMapping','üìÖ\x20SMART\x20SCHEDULE\x20(Phase):\x20\x27Globaler\x20Start\x27\x20erkannt.\x20Heize\x20Haus\x20auf\x20(Vorlauf:\x20','getForeignStateAsync','log','reason','Fehlt','type','¬∞C\x20(nicht\x20','setStateAsync','write','actual','sort','room','date','TRAIN_RL_PENALTY','rescue_','eventStart','thermostatMapping','entries','.1.LEVEL','.1.ACTUAL_TEMPERATURE','(((.+)+)+)+$',']:\x20Raum-Trigger\x20\x27','Ist','¬∞C).\x20Sparmodus\x20beendet!','level.valve','toString','getForeignObjectAsync','109eIWbNJ','remove','parse','switch','11aEyomx','.4.SET_TEMPERATURE','\x20min)','12370MGdAIc','contact','analysis.energy.warmupTargets','filter','Auto-Erkennung','currentSystemMode','ist','useCalendar','info','summary','\x20->\x20','string','devices','Manuelles\x20Mapping','now','calendarSelection','messwert','stellwert','3xzyEzO','ankunft','constructor','284207AGGpXj','location','level.temperature','Unbekannt','.1.SET_POINT_TEMPERATURE','split','current_heating_setpoint','too_cold','_date','[CAL]\x20','\x20wurde\x20manuell\x20erh√∂ht.','indexOf','[MPC\x20WARNING]\x20Kein\x20Setpoint\x20f√ºr\x20','triggerTime','84590oaHFmZ','üçÉ\x20[MPC\x20ACTION]\x20Senke\x20','values','Classic','warn','abs'];a1_0x4509=function(){return _0x590fa7;};return a1_0x4509();}