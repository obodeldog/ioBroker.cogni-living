const a1_0x5efca7=a1_0x2e60;(function(_0x5194e8,_0x43249a){const _0x5ddc10=a1_0x2e60,_0x431554=_0x5194e8();while(!![]){try{const _0x10d8f4=-parseInt(_0x5ddc10(0x15d))/0x1+parseInt(_0x5ddc10(0x111))/0x2+parseInt(_0x5ddc10(0x13e))/0x3+parseInt(_0x5ddc10(0xf8))/0x4+parseInt(_0x5ddc10(0x164))/0x5*(parseInt(_0x5ddc10(0x124))/0x6)+parseInt(_0x5ddc10(0x139))/0x7*(-parseInt(_0x5ddc10(0x112))/0x8)+parseInt(_0x5ddc10(0x13f))/0x9;if(_0x10d8f4===_0x43249a)break;else _0x431554['push'](_0x431554['shift']());}catch(_0x54c428){_0x431554['push'](_0x431554['shift']());}}}(a1_0x3fcb,0x79948));const a1_0x1dd5f9=(function(){let _0x57b4f0=!![];return function(_0x3ffc96,_0x218ec7){const _0x2974a0=_0x57b4f0?function(){const _0x1963e2=a1_0x2e60;if(_0x218ec7){const _0x56333b=_0x218ec7[_0x1963e2(0x10f)](_0x3ffc96,arguments);return _0x218ec7=null,_0x56333b;}}:function(){};return _0x57b4f0=![],_0x2974a0;};}()),a1_0x338927=a1_0x1dd5f9(this,function(){const _0x2cb7fd=a1_0x2e60;return a1_0x338927[_0x2cb7fd(0x10a)]()[_0x2cb7fd(0x163)](_0x2cb7fd(0x15f))[_0x2cb7fd(0x10a)]()[_0x2cb7fd(0x122)](a1_0x338927)['search']('(((.+)+)+)+$');});a1_0x338927();'use strict';const aiAgent=require(a1_0x5efca7(0x153)),COOLDOWN_MS=0x3c*0x3e8,lastActions={};function normalize(_0x2d11c5){const _0xafcf3f=a1_0x5efca7;if(!_0x2d11c5)return'';return _0x2d11c5[_0xafcf3f(0x13d)]()['replace'](/\s+/g,'')[_0xafcf3f(0x12c)]();}async function handlePrediction(_0x219f84,_0x194045,_0x23941c){const _0x393741=a1_0x5efca7;if(!_0x194045||_0x194045==='Unknown')return;let _0x50b0d2='off',_0x30f13f=0.6;try{const _0xfb8798=await _0x219f84[_0x393741(0x143)](_0x393741(0xf7));if(_0xfb8798&&_0xfb8798['val'])_0x50b0d2=_0xfb8798['val'];const _0x203875=await _0x219f84[_0x393741(0x143)](_0x393741(0x117));if(_0x203875&&_0x203875[_0x393741(0x141)])_0x30f13f=_0x203875[_0x393741(0x141)];}catch(_0x4c10a9){}if(_0x50b0d2===_0x393741(0x104)||_0x23941c<_0x30f13f)return;const _0x7d8053=Date[_0x393741(0x13a)]();if(lastActions[_0x194045]&&_0x7d8053-lastActions[_0x194045]<COOLDOWN_MS)return;const _0x82ac8b=_0x219f84[_0x393741(0xf4)][_0x393741(0x14c)]||[],_0x2185e7=normalize(_0x194045),_0x353ba1=_0x82ac8b[_0x393741(0xff)](_0x5753b5=>normalize(_0x5753b5[_0x393741(0xe5)])===_0x2185e7&&(_0x5753b5['type']===_0x393741(0x114)||_0x5753b5[_0x393741(0x10b)]===_0x393741(0xeb)||_0x5753b5[_0x393741(0x10b)]===_0x393741(0x14b)));if(!_0x353ba1){_0x219f84[_0x393741(0x107)][_0x393741(0x11d)](_0x393741(0x138)+_0x194045+'\x27.');return;}const _0x147e3e=await aiAgent[_0x393741(0xf3)](_0x219f84,_0x194045,_0x353ba1[_0x393741(0xf6)],_0x23941c);if(!_0x147e3e[_0x393741(0x14d)])return;const _0x40680a=_0x393741(0xf1)+_0x194045+_0x393741(0x131)+_0x353ba1['name']+'\x20('+_0x147e3e[_0x393741(0x150)]+')';await _0x219f84[_0x393741(0x154)]('analysis.automation.lastAction',{'val':'['+_0x50b0d2['toUpperCase']()+']\x20'+_0x40680a,'ack':!![]});if(_0x50b0d2==='active'){const _0x48e803=await _0x219f84[_0x393741(0xfc)](_0x353ba1['id']);(!_0x48e803||!_0x48e803[_0x393741(0x141)]&&_0x48e803[_0x393741(0x141)]!==!![])&&await _0x219f84['setForeignStateAsync'](_0x353ba1['id'],!![]),lastActions[_0x194045]=_0x7d8053;}}function a1_0x2e60(_0x322aff,_0x53db08){const _0x57b8f6=a1_0x3fcb();return a1_0x2e60=function(_0x338927,_0x1dd5f9){_0x338927=_0x338927-0xe1;let _0x3fcb76=_0x57b8f6[_0x338927];return _0x3fcb76;},a1_0x2e60(_0x322aff,_0x53db08);}async function findRelatedId(_0x535b35,_0x19181a,_0x564cc5=a1_0x5efca7(0x142)){const _0x37d74b=a1_0x5efca7;if(_0x564cc5==='setpoint'&&_0x535b35['config'][_0x37d74b(0xe9)]){let _0x3dddaf=_0x535b35[_0x37d74b(0xf4)][_0x37d74b(0xe9)];if(typeof _0x3dddaf===_0x37d74b(0x149))try{_0x3dddaf=JSON['parse'](_0x3dddaf);}catch(_0x498e49){}if(_0x3dddaf&&_0x3dddaf[_0x19181a])return _0x3dddaf[_0x19181a];}if(_0x564cc5===_0x37d74b(0x15a)&&_0x535b35[_0x37d74b(0xf4)][_0x37d74b(0x12a)]){let _0x9b1fc4=_0x535b35[_0x37d74b(0xf4)]['valveMapping'];if(typeof _0x9b1fc4==='string')try{_0x9b1fc4=JSON[_0x37d74b(0xf0)](_0x9b1fc4);}catch(_0x221365){}if(_0x9b1fc4&&_0x9b1fc4[_0x19181a])return _0x9b1fc4[_0x19181a];}let _0x45c3c2=[];if(_0x564cc5===_0x37d74b(0x142))_0x45c3c2=[{'s':_0x37d74b(0xe7),'t':'.1.SET_POINT_TEMPERATURE'},{'s':_0x37d74b(0x12f),'t':_0x37d74b(0xe4)},{'s':'.1.TEMPERATURE','t':_0x37d74b(0x140)},{'s':'ACTUAL_TEMPERATURE','t':'SET_POINT_TEMPERATURE'},{'s':_0x37d74b(0xe3),'t':_0x37d74b(0xfb)},{'s':_0x37d74b(0xe3),'t':_0x37d74b(0x103)},{'s':_0x37d74b(0x134),'t':_0x37d74b(0x14e)},{'s':_0x37d74b(0x127),'t':_0x37d74b(0x12e)},{'s':_0x37d74b(0x144),'t':_0x37d74b(0x123)},{'s':_0x37d74b(0x134),'t':_0x37d74b(0x142)}];else _0x564cc5===_0x37d74b(0x15a)&&(_0x45c3c2=[{'s':_0x37d74b(0xe7),'t':_0x37d74b(0x121)},{'s':'.1.TEMPERATURE','t':_0x37d74b(0x121)},{'s':_0x37d74b(0x12f),'t':_0x37d74b(0x15e)},{'s':'local_temperature','t':'pi_heating_demand'},{'s':'temperature','t':_0x37d74b(0x128)},{'s':_0x37d74b(0x134),'t':'level'}]);for(const _0x531df1 of _0x45c3c2){if(_0x19181a[_0x37d74b(0x162)](_0x531df1['s'])){const _0x10bf0c=_0x19181a[_0x37d74b(0x11b)](_0x531df1['s'],_0x531df1['t']),_0x5c2734=await _0x535b35[_0x37d74b(0x115)](_0x10bf0c);if(_0x5c2734)return _0x10bf0c;}}try{const _0x281f26=_0x19181a['split']('.');if(_0x281f26['length']>0x2){const _0x2fa214=_0x281f26[_0x37d74b(0x12b)](0x0,-0x1)[_0x37d74b(0x100)]('.'),_0x1f8f55=await _0x535b35[_0x37d74b(0x13b)](_0x2fa214+'.*'),_0xd50834=[],_0x5bc7bf=_0x19181a[_0x37d74b(0xfd)](/[._]+/)[_0x37d74b(0x129)](_0x4eef06=>![_0x37d74b(0x137),'0',_0x37d74b(0x102),'ist',_0x37d74b(0xfa),_0x37d74b(0x134),'actual',_0x37d74b(0x125),_0x37d74b(0x155),'state'][_0x37d74b(0x162)](_0x4eef06[_0x37d74b(0x13d)]()));for(const [_0x56cac2,_0x458bb3]of Object[_0x37d74b(0x151)](_0x1f8f55)){if(_0x56cac2===_0x19181a)continue;if(_0x458bb3&&_0x458bb3[_0x37d74b(0x136)]){const _0x5893c9=_0x56cac2['toLowerCase'](),_0xb1ab35=(_0x458bb3[_0x37d74b(0x136)][_0x37d74b(0x108)]||'')[_0x37d74b(0x13d)](),_0x428485=(_0x458bb3[_0x37d74b(0x136)][_0x37d74b(0x10e)]||'')['toLowerCase']();let _0x27b68e=![];if(_0x564cc5===_0x37d74b(0x142)&&_0x458bb3['common'][_0x37d74b(0x10c)]===!![])_0x27b68e=_0x5893c9[_0x37d74b(0x162)]('set')||_0x5893c9[_0x37d74b(0x162)](_0x37d74b(0x146))||_0x5893c9['includes'](_0x37d74b(0x116))||_0xb1ab35[_0x37d74b(0x162)](_0x37d74b(0x15c))||_0xb1ab35[_0x37d74b(0x162)](_0x37d74b(0x14f));else _0x564cc5===_0x37d74b(0x15a)&&(_0x27b68e=_0x5893c9[_0x37d74b(0x162)](_0x37d74b(0x11c))||_0x5893c9[_0x37d74b(0x162)](_0x37d74b(0x15a))||_0x5893c9[_0x37d74b(0x162)]('stellwert')||_0x5893c9[_0x37d74b(0x162)](_0x37d74b(0xf5))||_0xb1ab35[_0x37d74b(0x162)](_0x37d74b(0xea))||_0xb1ab35[_0x37d74b(0x162)](_0x37d74b(0x157))||_0x428485[_0x37d74b(0x162)]('%'));if(_0x27b68e){const _0x2c225b=_0x56cac2['split'](/[._]+/)[_0x37d74b(0x148)](_0x67f768=>_0x67f768[_0x37d74b(0x13d)]());let _0x13e50f=0x0;_0x5bc7bf[_0x37d74b(0xef)](_0xd8061f=>{const _0x82195b=_0x37d74b;if(_0x2c225b[_0x82195b(0x162)](_0xd8061f[_0x82195b(0x13d)]()))_0x13e50f++;}),_0xd50834[_0x37d74b(0xe1)]({'id':_0x56cac2,'score':_0x13e50f});}}}if(_0xd50834['length']>0x0){_0xd50834[_0x37d74b(0x156)]((_0x545d38,_0x5b3c83)=>_0x5b3c83[_0x37d74b(0x133)]-_0x545d38[_0x37d74b(0x133)]);if(_0xd50834[0x0][_0x37d74b(0x133)]>0x0)return _0xd50834[0x0]['id'];}}}catch(_0xe223f){}return null;}async function scanThermostats(_0x1c51d7){const _0x1bbdeb=a1_0x5efca7,_0x2e2f95=_0x1c51d7[_0x1bbdeb(0xf4)][_0x1bbdeb(0x14c)]||[],_0x567cee=[],_0x27f6fc=_0x2e2f95[_0x1bbdeb(0x129)](_0x4fb165=>_0x4fb165['id']&&_0x4fb165['id']['includes'](_0x1bbdeb(0x134))||_0x4fb165[_0x1bbdeb(0x10b)]&&[_0x1bbdeb(0x134),_0x1bbdeb(0x14a),_0x1bbdeb(0x125)][_0x1bbdeb(0x162)](_0x4fb165[_0x1bbdeb(0x10b)])||_0x4fb165[_0x1bbdeb(0xf6)]&&_0x4fb165[_0x1bbdeb(0xf6)][_0x1bbdeb(0x13d)]()['includes']('temp'));for(const _0x17f66d of _0x27f6fc){const _0x301f29=await findRelatedId(_0x1c51d7,_0x17f66d['id'],_0x1bbdeb(0x142)),_0x383ddd=await findRelatedId(_0x1c51d7,_0x17f66d['id'],_0x1bbdeb(0x15a));let _0xe43f4b=_0x1bbdeb(0x12d),_0x50c25a=![],_0x5a8fd4=_0x1c51d7[_0x1bbdeb(0xf4)][_0x1bbdeb(0xe9)]||{};if(typeof _0x5a8fd4===_0x1bbdeb(0x149))try{_0x5a8fd4=JSON['parse'](_0x5a8fd4);}catch(_0x1a2377){}let _0x11a45e=_0x1c51d7['config']['valveMapping']||{};if(typeof _0x11a45e===_0x1bbdeb(0x149))try{_0x11a45e=JSON[_0x1bbdeb(0xf0)](_0x11a45e);}catch(_0x35ef7b){}if(_0x5a8fd4[_0x17f66d['id']]&&_0x5a8fd4[_0x17f66d['id']]===_0x301f29||_0x11a45e[_0x17f66d['id']]&&_0x11a45e[_0x17f66d['id']]===_0x383ddd)_0xe43f4b=_0x1bbdeb(0x120),_0x50c25a=!![];else(_0x301f29||_0x383ddd)&&(_0xe43f4b='Auto-Erkennung');_0x567cee[_0x1bbdeb(0xe1)]({'room':_0x17f66d[_0x1bbdeb(0xe5)]||_0x1bbdeb(0x15b),'sensorId':_0x17f66d['id'],'setpointId':_0x301f29||'-','valveId':_0x383ddd||'-','source':_0xe43f4b,'isManual':_0x50c25a,'status':_0x301f29&&_0x383ddd?_0x1bbdeb(0xe8):_0x301f29?'OK':_0x1bbdeb(0xf2)});}return _0x567cee[_0x1bbdeb(0x156)]((_0x4ded1e,_0x72c6fe)=>_0x4ded1e[_0x1bbdeb(0x152)]['localeCompare'](_0x72c6fe[_0x1bbdeb(0x152)]));}async function checkCalendarTriggers(_0x7fb298){const _0x1015ab=a1_0x5efca7;if(!_0x7fb298[_0x1015ab(0xf4)][_0x1015ab(0x10d)]||!_0x7fb298[_0x1015ab(0xf4)][_0x1015ab(0x145)])return;let _0x5697b3={};try{const _0x5ca35f=await _0x7fb298[_0x1015ab(0x143)]('analysis.energy.warmupTimes');if(_0x5ca35f&&_0x5ca35f[_0x1015ab(0x141)])_0x5697b3=JSON[_0x1015ab(0xf0)](_0x5ca35f[_0x1015ab(0x141)]);}catch(_0x5e9667){}try{const _0x1a6148=await _0x7fb298['getForeignStateAsync'](_0x7fb298[_0x1015ab(0xf4)][_0x1015ab(0x145)]+_0x1015ab(0x11f));if(!_0x1a6148||!_0x1a6148[_0x1015ab(0x141)])return;const _0x52a661=JSON[_0x1015ab(0xf0)](_0x1a6148['val']),_0x388f73=new Date(),_0x1c9924=_0x7fb298['config'][_0x1015ab(0x14c)]||[],_0x3fc7a7=_0x7fb298['config'][_0x1015ab(0x161)]||[];for(const _0x291701 of _0x52a661){if(_0x291701[_0x1015ab(0x130)]&&_0x3fc7a7['length']>0x0&&!_0x3fc7a7[_0x1015ab(0x162)](_0x291701[_0x1015ab(0x130)]))continue;const _0x5249be=new Date(_0x291701['eventStart']),_0x58958a=(_0x291701['event']||_0x291701[_0x1015ab(0xe6)]||'')['toLowerCase']();if(_0x58958a[_0x1015ab(0x162)](_0x1015ab(0x119))||_0x58958a[_0x1015ab(0x162)]('r√ºckkehr')||_0x58958a[_0x1015ab(0x162)](_0x1015ab(0x11a))){let _0x539094=0x0;Object[_0x1015ab(0x101)](_0x5697b3)['forEach'](_0x1c02b2=>{if(_0x1c02b2>_0x539094)_0x539094=_0x1c02b2;});if(_0x539094===0x0)_0x539094=0x78;const _0x5e82bf=new Date(_0x5249be[_0x1015ab(0x126)]()-_0x539094*0xea60),_0xb27a38=_0x388f73[_0x1015ab(0x126)]()-_0x5e82bf[_0x1015ab(0x126)]();_0xb27a38>=0x0&&_0xb27a38<0xf*0xea60&&(_0x7fb298[_0x1015ab(0x107)][_0x1015ab(0x113)]('üìÖ\x20SMART\x20SCHEDULE:\x20\x27Globaler\x20Start\x27\x20erkannt\x20('+_0x291701[_0x1015ab(0x11e)]+_0x1015ab(0x106)+_0x539094+_0x1015ab(0x158)),await _0x7fb298[_0x1015ab(0x154)](_0x1015ab(0xf9),{'val':_0x1015ab(0x135),'ack':![]}));}for(const _0x4bd7cf of _0x1c9924){if(_0x4bd7cf['location']){const _0x3fc85e=_0x4bd7cf[_0x1015ab(0xe5)]['toLowerCase']();if(_0x58958a[_0x1015ab(0x162)](_0x3fc85e)){const _0x4671fb=_0x5697b3[_0x4bd7cf[_0x1015ab(0xe5)]]||0x3c,_0x1f6eb9=new Date(_0x5249be[_0x1015ab(0x126)]()-_0x4671fb*0xea60),_0x3655de=_0x388f73[_0x1015ab(0x126)]()-_0x1f6eb9['getTime']();if(_0x3655de>=0x0&&_0x3655de<0xf*0xea60){const _0x3839fb=await findRelatedId(_0x7fb298,_0x4bd7cf['id'],_0x1015ab(0x142));_0x3839fb&&(_0x7fb298[_0x1015ab(0x107)][_0x1015ab(0x113)]('üìÖ\x20SMART\x20SCHEDULE:\x20Raum-Trigger\x20\x27'+_0x4bd7cf['location']+_0x1015ab(0x110)+_0x291701[_0x1015ab(0x11e)]+_0x1015ab(0x147)+_0x4671fb+_0x1015ab(0x158)),await _0x7fb298[_0x1015ab(0xe2)](_0x3839fb,0x15),await _0x7fb298[_0x1015ab(0x154)](_0x1015ab(0x105),{'val':'[CAL]\x20'+_0x4bd7cf[_0x1015ab(0xe5)]+'\x20->\x2021¬∞C','ack':!![]}));}}}}}}catch(_0x1d1382){_0x7fb298['log'][_0x1015ab(0x118)](_0x1015ab(0xed)+_0x1d1382[_0x1015ab(0xfe)]);}}async function applyEnergySavings(_0x4f722f,_0x57978b){const _0xead634=a1_0x5efca7,_0x1a03bb=_0x4f722f[_0xead634(0xf4)][_0xead634(0x14c)]||[];for(const _0x406c5d of _0x57978b){const _0x169e19=_0x406c5d[_0xead634(0x152)],_0x45735d=_0x406c5d[_0xead634(0x13c)],_0x3c8757=Date[_0xead634(0x13a)]();if(lastActions[_0xead634(0x132)+_0x169e19]&&_0x3c8757-lastActions['mpc_'+_0x169e19]<0x1e*0x3c*0x3e8)continue;const _0x1f4192=_0x1a03bb[_0xead634(0xff)](_0x1cea0c=>normalize(_0x1cea0c[_0xead634(0xe5)])===normalize(_0x169e19));if(!_0x1f4192)continue;const _0x40b379=await findRelatedId(_0x4f722f,_0x1f4192['id'],_0xead634(0x142));if(_0x40b379){const _0x360106=await _0x4f722f[_0xead634(0xfc)](_0x40b379);if(_0x360106&&typeof _0x360106[_0xead634(0x141)]===_0xead634(0xee)){const _0x565718=_0x360106['val'];if(_0x45735d>0x1e&&_0x565718>0x11){const _0x20ed06=_0x565718-0x1;_0x4f722f[_0xead634(0x107)][_0xead634(0x113)](_0xead634(0xec)+_0x169e19+'\x20('+_0x40b379+')\x20auf\x20'+_0x20ed06+_0xead634(0x159)+_0x45735d+'\x20min)'),await _0x4f722f[_0xead634(0xe2)](_0x40b379,_0x20ed06),lastActions[_0xead634(0x132)+_0x169e19]=_0x3c8757,await _0x4f722f[_0xead634(0x154)](_0xead634(0x105),{'val':_0xead634(0x109)+_0x169e19+':\x20-1¬∞C\x20(Sparpotenzial\x20genutzt)','ack':!![]});}}}}}function a1_0x3fcb(){const _0x2d6d53=['542040qUCUAj','3255120OBovJJ','.4.SET_TEMPERATURE','val','setpoint','getStateAsync','Ist','calendarInstance','soll',').\x20Heize\x20auf\x2021¬∞C\x20(Vorlauf:\x20','map','string','thermostat','switch','devices','approved','target_temperature','thermostat.setpoint','reason','entries','room','./ai_agent','setStateAsync','messwert','sort','value.valve','\x20min).','¬∞C\x20(Coasting\x20m√∂glich:\x20','valve','Unbekannt','level.temperature','459788FFQKVL','.4.VALVE_STATE','(((.+)+)+)+$','exports','calendarSelection','includes','search','701795GQwzWx','push','setForeignStateAsync','local_temperature','.1.SET_POINT_TEMPERATURE','location','summary','.1.ACTUAL_TEMPERATURE','PERFECT','thermostatMapping','level.valve','dimmer','üçÉ\x20MPC\x20Autonomy:\x20Senke\x20','Calendar\x20Check\x20Error:\x20','number','forEach','parse','Pr√§diktion:\x20','Fehlt','consultButler','config','position','name','analysis.automation.mode','256980HcqtGn','system.mode','wert','occupied_heating_setpoint','getForeignStateAsync','split','message','find','join','values','hm-rpc','current_heating_setpoint','off','analysis.automation.lastAction',').\x20Heize\x20ganzes\x20Haus\x20auf\x20(Vorlauf:\x20','log','role','[MPC]\x20','toString','type','write','useCalendar','unit','apply','\x27\x20erkannt\x20(','1266198fXaIAQ','296mRcLie','info','light','getForeignObjectAsync','target','analysis.automation.confidenceThreshold','warn','urlaub\x20ende','ankunft','replace','level','debug','event','.data.table','Manuelles\x20Mapping','.1.LEVEL','constructor','Soll','30SKDmrO','sensor','getTime','ACTUAL','valve_position','filter','valveMapping','slice','trim','Nicht\x20gefunden','SET','.1.TEMPERATURE','_calName','\x20->\x20Schalte\x20','mpc_','score','temperature','normal','common','openknx','üîç\x20Device-Search\x20failed\x20for\x20predicted\x20room\x20\x27','186109hexmVG','now','getForeignObjectsAsync','minutes_safe','toLowerCase'];a1_0x3fcb=function(){return _0x2d6d53;};return a1_0x3fcb();}module[a1_0x5efca7(0x160)]={'handlePrediction':handlePrediction,'applyEnergySavings':applyEnergySavings,'scanThermostats':scanThermostats,'checkCalendarTriggers':checkCalendarTriggers};