const a1_0x1fdd3c=a1_0x3232;(function(_0x42991f,_0x512599){const _0x334ecc=a1_0x3232,_0x11d831=_0x42991f();while(!![]){try{const _0x5301d0=parseInt(_0x334ecc(0x19c))/0x1*(parseInt(_0x334ecc(0x14a))/0x2)+parseInt(_0x334ecc(0x143))/0x3+-parseInt(_0x334ecc(0x176))/0x4*(-parseInt(_0x334ecc(0x180))/0x5)+-parseInt(_0x334ecc(0x113))/0x6+-parseInt(_0x334ecc(0x12e))/0x7+-parseInt(_0x334ecc(0x1ae))/0x8*(parseInt(_0x334ecc(0x185))/0x9)+parseInt(_0x334ecc(0x15c))/0xa*(parseInt(_0x334ecc(0x166))/0xb);if(_0x5301d0===_0x512599)break;else _0x11d831['push'](_0x11d831['shift']());}catch(_0x447677){_0x11d831['push'](_0x11d831['shift']());}}}(a1_0x2be1,0x6c34a));function a1_0x3232(_0x27531c,_0x391835){const _0x33ab36=a1_0x2be1();return a1_0x3232=function(_0x16a7d4,_0x254d67){_0x16a7d4=_0x16a7d4-0xfc;let _0x2be1e2=_0x33ab36[_0x16a7d4];return _0x2be1e2;},a1_0x3232(_0x27531c,_0x391835);}const a1_0x254d67=(function(){let _0x2993de=!![];return function(_0x2c3231,_0x2a35bd){const _0x438ac9=_0x2993de?function(){const _0x42fa32=a1_0x3232;if(_0x2a35bd){const _0x2ac3e6=_0x2a35bd[_0x42fa32(0x190)](_0x2c3231,arguments);return _0x2a35bd=null,_0x2ac3e6;}}:function(){};return _0x2993de=![],_0x438ac9;};}()),a1_0x16a7d4=a1_0x254d67(this,function(){const _0x75c910=a1_0x3232;return a1_0x16a7d4[_0x75c910(0x163)]()[_0x75c910(0xfc)](_0x75c910(0x168))[_0x75c910(0x163)]()[_0x75c910(0x142)](a1_0x16a7d4)[_0x75c910(0xfc)](_0x75c910(0x168));});a1_0x16a7d4();'use strict';const aiAgent=require(a1_0x1fdd3c(0x10b)),COOLDOWN_MS=0x3c*0x3e8,CAL_COOLDOWN_MS=0x5a*0x3c*0x3e8,RESCUE_LOCK_MS=0x78*0x3c*0x3e8,ECO_TEMP=0x11,lastActions={};function normalize(_0x34d16f){const _0x407758=a1_0x1fdd3c;if(!_0x34d16f)return'';return _0x34d16f[_0x407758(0xfd)]()['replace'](/\s+/g,'')[_0x407758(0x178)]();}async function logAutomationAction(_0x3dc2dc,_0x4e55f4){const _0x2065c0=a1_0x1fdd3c;await _0x3dc2dc[_0x2065c0(0x170)](_0x2065c0(0x132),{'val':_0x4e55f4,'ack':!![]});try{const _0x5a9cc2=_0x2065c0(0x127),_0x255bf3=await _0x3dc2dc[_0x2065c0(0x173)](_0x5a9cc2);let _0x124ae7=[];if(_0x255bf3&&_0x255bf3['val'])try{_0x124ae7=JSON[_0x2065c0(0x153)](_0x255bf3[_0x2065c0(0x1a4)]);}catch(_0x5aa996){}_0x124ae7[_0x2065c0(0x16d)]({'ts':Date[_0x2065c0(0x1ad)](),'msg':_0x4e55f4});if(_0x124ae7[_0x2065c0(0x126)]>0x32)_0x124ae7=_0x124ae7[_0x2065c0(0x103)](0x0,0x32);await _0x3dc2dc[_0x2065c0(0x170)](_0x5a9cc2,{'val':JSON[_0x2065c0(0x129)](_0x124ae7),'ack':!![]});}catch(_0x142b88){}}async function handlePrediction(_0x51708f,_0x5f1997,_0xe16667){const _0x346d5c=a1_0x1fdd3c;if(!_0x5f1997||_0x5f1997===_0x346d5c(0x15a))return;let _0x5bfacc=_0x346d5c(0x1a7),_0x5570a4=0.6;try{const _0x2c15a0=await _0x51708f[_0x346d5c(0x173)]('analysis.automation.mode');if(_0x2c15a0&&_0x2c15a0[_0x346d5c(0x1a4)])_0x5bfacc=_0x2c15a0[_0x346d5c(0x1a4)];const _0x46bd60=await _0x51708f[_0x346d5c(0x173)]('analysis.automation.confidenceThreshold');if(_0x46bd60&&_0x46bd60[_0x346d5c(0x1a4)])_0x5570a4=_0x46bd60['val'];}catch(_0x55e32e){}if(_0x5bfacc==='off'||_0xe16667<_0x5570a4)return;const _0x84d88d=Date[_0x346d5c(0x1ad)]();if(lastActions[_0x5f1997]&&_0x84d88d-lastActions[_0x5f1997]<COOLDOWN_MS)return;const _0x3be419=_0x51708f[_0x346d5c(0x182)]['devices']||[],_0x275ff2=normalize(_0x5f1997),_0x3941ed=_0x3be419[_0x346d5c(0x101)](_0x16afd4=>normalize(_0x16afd4['location'])===_0x275ff2&&(_0x16afd4['type']===_0x346d5c(0x108)||_0x16afd4['type']===_0x346d5c(0x169)||_0x16afd4[_0x346d5c(0x139)]==='switch'));if(!_0x3941ed)return;const _0x221ffb=await aiAgent[_0x346d5c(0x181)](_0x51708f,_0x5f1997,_0x3941ed[_0x346d5c(0x16b)],_0xe16667);if(!_0x221ffb[_0x346d5c(0x102)])return;const _0x2adae4=_0x346d5c(0x175)+_0x5f1997+_0x346d5c(0x174)+_0x3941ed[_0x346d5c(0x16b)]+'\x20('+_0x221ffb[_0x346d5c(0x140)]+')';await logAutomationAction(_0x51708f,'['+_0x5bfacc['toUpperCase']()+']\x20'+_0x2adae4);if(_0x5bfacc==='active'){const _0x329c25=await _0x51708f['getForeignStateAsync'](_0x3941ed['id']);(!_0x329c25||!_0x329c25[_0x346d5c(0x1a4)]&&_0x329c25['val']!==!![])&&await _0x51708f[_0x346d5c(0x18b)](_0x3941ed['id'],!![]),lastActions[_0x5f1997]=_0x84d88d;}}async function findRelatedId(_0x70e9a,_0x5620b1,_0x2a1552='setpoint'){const _0x186351=a1_0x1fdd3c;if(_0x2a1552==='setpoint'&&_0x70e9a[_0x186351(0x182)][_0x186351(0x12d)]){let _0x435174=_0x70e9a[_0x186351(0x182)]['thermostatMapping'];if(typeof _0x435174==='string')try{_0x435174=JSON['parse'](_0x435174);}catch(_0x2acc69){}if(_0x435174&&_0x435174[_0x5620b1])return _0x435174[_0x5620b1];}if(_0x2a1552===_0x186351(0x1b0)&&_0x70e9a[_0x186351(0x182)][_0x186351(0x104)]){let _0x3a04c6=_0x70e9a[_0x186351(0x182)][_0x186351(0x104)];if(typeof _0x3a04c6===_0x186351(0x12c))try{_0x3a04c6=JSON[_0x186351(0x153)](_0x3a04c6);}catch(_0x4dae04){}if(_0x3a04c6&&_0x3a04c6[_0x5620b1])return _0x3a04c6[_0x5620b1];}let _0x56e92b=[];if(_0x2a1552===_0x186351(0x1a3))_0x56e92b=[{'s':_0x186351(0x138),'t':_0x186351(0x1a8)},{'s':'.1.TEMPERATURE','t':_0x186351(0x1a8)},{'s':'.1.TEMPERATURE','t':_0x186351(0x17c)},{'s':_0x186351(0xff),'t':_0x186351(0x13e)},{'s':_0x186351(0x11e),'t':_0x186351(0x16e)},{'s':_0x186351(0x11e),'t':_0x186351(0x1aa)},{'s':_0x186351(0x164),'t':_0x186351(0x19f)},{'s':_0x186351(0x188),'t':_0x186351(0x119)},{'s':_0x186351(0x195),'t':_0x186351(0x123)},{'s':_0x186351(0x164),'t':_0x186351(0x1a3)}];else _0x2a1552===_0x186351(0x1b0)&&(_0x56e92b=[{'s':'.1.ACTUAL_TEMPERATURE','t':_0x186351(0x111)},{'s':'.1.TEMPERATURE','t':'.1.LEVEL'},{'s':'.1.TEMPERATURE','t':_0x186351(0x15b)},{'s':_0x186351(0x11e),'t':_0x186351(0x112)},{'s':'temperature','t':'valve_position'},{'s':'temperature','t':'level'}]);for(const _0x380e76 of _0x56e92b){if(_0x5620b1[_0x186351(0x17b)](_0x380e76['s'])){const _0x4aeefa=_0x5620b1['replace'](_0x380e76['s'],_0x380e76['t']),_0x1a3720=await _0x70e9a[_0x186351(0x118)](_0x4aeefa);if(_0x1a3720)return _0x4aeefa;}}try{const _0x8d2ba0=_0x5620b1['split']('.');if(_0x8d2ba0[_0x186351(0x126)]>0x2){const _0x778561=_0x8d2ba0[_0x186351(0x103)](0x0,-0x1)[_0x186351(0x14f)]('.'),_0x2e92ce=await _0x70e9a[_0x186351(0x148)](_0x778561+'.*'),_0x1645a1=[],_0x4babf1=_0x5620b1['split'](/[._]+/)[_0x186351(0x196)](_0xb6a9e1=>![_0x186351(0x171),'0','hm-rpc',_0x186351(0x1a9),'wert',_0x186351(0x164),'actual',_0x186351(0x10d),_0x186351(0x1a0),'state'][_0x186351(0x17b)](_0xb6a9e1[_0x186351(0xfd)]()));for(const [_0x3ad91d,_0x54764a]of Object[_0x186351(0x131)](_0x2e92ce)){if(_0x3ad91d===_0x5620b1)continue;if(_0x54764a&&_0x54764a[_0x186351(0x1ab)]){const _0x16c0dd=_0x3ad91d[_0x186351(0xfd)](),_0x41b0bc=(_0x54764a[_0x186351(0x1ab)][_0x186351(0x18a)]||'')['toLowerCase'](),_0x20f880=(_0x54764a[_0x186351(0x1ab)]['unit']||'')[_0x186351(0xfd)]();let _0x99342c=![];if(_0x2a1552===_0x186351(0x1a3)&&_0x54764a[_0x186351(0x1ab)][_0x186351(0x1a1)]===!![])_0x99342c=_0x16c0dd['includes'](_0x186351(0x117))||_0x16c0dd['includes']('soll')||_0x16c0dd[_0x186351(0x17b)](_0x186351(0x11c))||_0x41b0bc[_0x186351(0x17b)]('level.temperature')||_0x41b0bc[_0x186351(0x17b)](_0x186351(0x199));else _0x2a1552===_0x186351(0x1b0)&&(_0x99342c=_0x16c0dd['includes'](_0x186351(0x155))||_0x16c0dd[_0x186351(0x17b)]('valve')||_0x16c0dd[_0x186351(0x17b)]('stellwert')||_0x16c0dd[_0x186351(0x17b)](_0x186351(0x122))||_0x41b0bc[_0x186351(0x17b)](_0x186351(0x1a5))||_0x41b0bc[_0x186351(0x17b)]('value.valve')||_0x20f880[_0x186351(0x17b)]('%'));if(_0x99342c){const _0x4913d5=_0x3ad91d[_0x186351(0x19a)](/[._]+/)['map'](_0x2f8c16=>_0x2f8c16['toLowerCase']());let _0x404971=0x0;_0x4babf1[_0x186351(0x16f)](_0x5855ef=>{const _0x27b55e=_0x186351;if(_0x4913d5[_0x27b55e(0x17b)](_0x5855ef[_0x27b55e(0xfd)]()))_0x404971++;}),_0x1645a1[_0x186351(0x159)]({'id':_0x3ad91d,'score':_0x404971});}}}if(_0x1645a1[_0x186351(0x126)]>0x0){_0x1645a1[_0x186351(0x165)]((_0x630d71,_0x21fdb0)=>_0x21fdb0[_0x186351(0x13d)]-_0x630d71[_0x186351(0x13d)]);if(_0x1645a1[0x0][_0x186351(0x13d)]>0x0)return _0x1645a1[0x0]['id'];}}}catch(_0x15719a){}return null;}async function scanThermostats(_0x42f53e){const _0x5d0680=a1_0x1fdd3c,_0x53ea80=_0x42f53e['config'][_0x5d0680(0x18e)]||[],_0x5d0315=[],_0x43ccb1=_0x53ea80[_0x5d0680(0x196)](_0x574cf7=>_0x574cf7['id']&&_0x574cf7['id'][_0x5d0680(0x17b)](_0x5d0680(0x164))||_0x574cf7[_0x5d0680(0x139)]&&['temperature',_0x5d0680(0x14c),_0x5d0680(0x10d)][_0x5d0680(0x17b)](_0x574cf7[_0x5d0680(0x139)])||_0x574cf7[_0x5d0680(0x16b)]&&_0x574cf7['name'][_0x5d0680(0xfd)]()[_0x5d0680(0x17b)](_0x5d0680(0x18d)));for(const _0x2f4b26 of _0x43ccb1){const _0x4b0d8a=await findRelatedId(_0x42f53e,_0x2f4b26['id'],_0x5d0680(0x1a3)),_0x357abe=await findRelatedId(_0x42f53e,_0x2f4b26['id'],_0x5d0680(0x1b0));let _0x41bcdd=_0x5d0680(0x13c),_0x55a83e=![],_0x32dbcf=_0x42f53e[_0x5d0680(0x182)][_0x5d0680(0x12d)]||{};if(typeof _0x32dbcf===_0x5d0680(0x12c))try{_0x32dbcf=JSON['parse'](_0x32dbcf);}catch(_0x48b0ba){}let _0xb0c0f0=_0x42f53e[_0x5d0680(0x182)][_0x5d0680(0x104)]||{};if(typeof _0xb0c0f0==='string')try{_0xb0c0f0=JSON['parse'](_0xb0c0f0);}catch(_0x54e231){}if(_0x32dbcf[_0x2f4b26['id']]&&_0x32dbcf[_0x2f4b26['id']]===_0x4b0d8a||_0xb0c0f0[_0x2f4b26['id']]&&_0xb0c0f0[_0x2f4b26['id']]===_0x357abe)_0x41bcdd=_0x5d0680(0x194),_0x55a83e=!![];else(_0x4b0d8a||_0x357abe)&&(_0x41bcdd=_0x5d0680(0x134));_0x5d0315[_0x5d0680(0x159)]({'room':_0x2f4b26[_0x5d0680(0x10e)]||'Unbekannt','sensorId':_0x2f4b26['id'],'setpointId':_0x4b0d8a||'-','valveId':_0x357abe||'-','source':_0x41bcdd,'isManual':_0x55a83e,'status':_0x4b0d8a&&_0x357abe?_0x5d0680(0x183):_0x4b0d8a?'OK':'Fehlt'});}return _0x5d0315[_0x5d0680(0x165)]((_0x4ed4fd,_0x1bae49)=>_0x4ed4fd[_0x5d0680(0x156)][_0x5d0680(0x128)](_0x1bae49[_0x5d0680(0x156)]));}async function updateSchedulePreview(_0x5f2b3d){const _0x38a844=a1_0x1fdd3c;if(!_0x5f2b3d[_0x38a844(0x182)][_0x38a844(0x11a)]||!_0x5f2b3d[_0x38a844(0x182)][_0x38a844(0x137)])return;let _0x11efb4={};try{const _0x48fa8a=await _0x5f2b3d[_0x38a844(0x173)](_0x38a844(0x19e));if(_0x48fa8a&&_0x48fa8a[_0x38a844(0x1a4)])_0x11efb4=JSON['parse'](_0x48fa8a[_0x38a844(0x1a4)]);}catch(_0x340969){}const _0x426d34=[],_0x3e6e65=Date[_0x38a844(0x1ad)](),_0x10bd7a=0x30*0x3c*0x3c*0x3e8;try{const _0x55d4c8=await _0x5f2b3d['getForeignStateAsync'](_0x5f2b3d[_0x38a844(0x182)][_0x38a844(0x137)]+_0x38a844(0x179));if(!_0x55d4c8||!_0x55d4c8['val'])return;const _0x49f959=JSON[_0x38a844(0x153)](_0x55d4c8[_0x38a844(0x1a4)]),_0x3e2e5a=_0x5f2b3d[_0x38a844(0x182)]['calendarSelection']||[],_0x4d02ad=_0x5f2b3d[_0x38a844(0x182)][_0x38a844(0x18e)]||[],_0x49af6a=new Set();_0x4d02ad[_0x38a844(0x16f)](_0x5a255e=>{const _0x45ed97=_0x38a844;if(_0x5a255e[_0x45ed97(0x10e)])_0x49af6a[_0x45ed97(0x16a)](_0x5a255e['location']);});for(const _0x24d528 of _0x49f959){if(_0x24d528[_0x38a844(0x1a6)]&&_0x3e2e5a['length']>0x0&&!_0x3e2e5a['includes'](_0x24d528[_0x38a844(0x1a6)]))continue;const _0x3fea01=_0x24d528[_0x38a844(0x12b)]||_0x24d528[_0x38a844(0x189)]||_0x24d528[_0x38a844(0x187)];if(!_0x3fea01)continue;const _0x1cfb60=new Date(_0x3fea01),_0x421b85=_0x1cfb60['getTime']();if(isNaN(_0x421b85))continue;if(_0x421b85<_0x3e6e65)continue;if(_0x421b85>_0x3e6e65+_0x10bd7a)continue;const _0x4056c9=(_0x24d528[_0x38a844(0x114)]||_0x24d528[_0x38a844(0x12f)]||'')[_0x38a844(0xfd)]();let _0x3e3e8f=![],_0x51f6cd=[],_0x986270=_0x24d528[_0x38a844(0x114)]||_0x24d528['summary']||_0x38a844(0x136);if(_0x4056c9['includes'](_0x38a844(0x146))||_0x4056c9['includes'](_0x38a844(0x14d))||_0x4056c9[_0x38a844(0x17b)](_0x38a844(0x14e)))_0x3e3e8f=!![],_0x51f6cd=Array[_0x38a844(0x150)](_0x49af6a);else for(const _0x180639 of _0x49af6a){if(_0x4056c9[_0x38a844(0x17b)](_0x180639['toLowerCase']()))_0x51f6cd[_0x38a844(0x159)](_0x180639);}_0x51f6cd[_0x38a844(0x126)]>0x0&&_0x51f6cd[_0x38a844(0x16f)](_0x344957=>{const _0x16875d=_0x38a844;let _0x535c1d=0x3c;if(_0x3e3e8f){let _0x103081=0x0;Object['values'](_0x11efb4)[_0x16875d(0x16f)](_0x2dd359=>{if(_0x2dd359>_0x103081)_0x103081=_0x2dd359;}),_0x535c1d=_0x103081>0x0?_0x103081:0x78;}else _0x535c1d=_0x11efb4[_0x344957]||0x3c;const _0x26c1b2=new Date(_0x421b85-_0x535c1d*0xea60);_0x426d34['push']({'eventTime':_0x421b85,'triggerTime':_0x26c1b2['getTime'](),'room':_0x344957,'minutes':_0x535c1d,'reason':_0x986270,'isGlobal':_0x3e3e8f});});}}catch(_0x157c65){}_0x426d34[_0x38a844(0x165)]((_0x7d2703,_0x342f1e)=>_0x7d2703[_0x38a844(0x167)]-_0x342f1e[_0x38a844(0x167)]);const _0x576fee=_0x426d34['slice'](0x0,0x5);await _0x5f2b3d[_0x38a844(0x170)](_0x38a844(0x124),{'val':JSON[_0x38a844(0x129)](_0x576fee),'ack':!![]});}async function checkCalendarTriggers(_0x415232){const _0x41caf9=a1_0x1fdd3c;if(!_0x415232[_0x41caf9(0x182)]['useCalendar']||!_0x415232[_0x41caf9(0x182)][_0x41caf9(0x137)])return;await updateSchedulePreview(_0x415232);let _0x529b17={},_0x16a949={};try{const _0x30accb=await _0x415232[_0x41caf9(0x173)](_0x41caf9(0x19e));if(_0x30accb&&_0x30accb[_0x41caf9(0x1a4)])_0x529b17=JSON[_0x41caf9(0x153)](_0x30accb[_0x41caf9(0x1a4)]);const _0x894820=await _0x415232[_0x41caf9(0x173)]('analysis.energy.warmupSources');if(_0x894820&&_0x894820[_0x41caf9(0x1a4)])_0x16a949=JSON[_0x41caf9(0x153)](_0x894820[_0x41caf9(0x1a4)]);}catch(_0x1d9249){}let _0x253221={'default':0x15};try{const _0x14169f=await _0x415232[_0x41caf9(0x173)](_0x41caf9(0x105));if(_0x14169f&&_0x14169f[_0x41caf9(0x1a4)])_0x253221=JSON[_0x41caf9(0x153)](_0x14169f[_0x41caf9(0x1a4)]);}catch(_0x538f28){}try{const _0x5becee=await _0x415232[_0x41caf9(0x18c)](_0x415232[_0x41caf9(0x182)][_0x41caf9(0x137)]+'.data.table');if(!_0x5becee||!_0x5becee[_0x41caf9(0x1a4)])return;const _0x25b63a=JSON[_0x41caf9(0x153)](_0x5becee[_0x41caf9(0x1a4)]),_0x408aad=Date[_0x41caf9(0x1ad)](),_0x22f7f7=_0x415232[_0x41caf9(0x182)][_0x41caf9(0x18e)]||[],_0x3c82ab=_0x415232[_0x41caf9(0x182)][_0x41caf9(0x11d)]||[];for(const _0x8a2302 of _0x25b63a){if(_0x8a2302['_calName']&&_0x3c82ab['length']>0x0&&!_0x3c82ab[_0x41caf9(0x17b)](_0x8a2302[_0x41caf9(0x1a6)]))continue;const _0x4f2737=_0x8a2302['_date']||_0x8a2302[_0x41caf9(0x189)]||_0x8a2302[_0x41caf9(0x187)];if(!_0x4f2737)continue;const _0x509d83=new Date(_0x4f2737);if(isNaN(_0x509d83[_0x41caf9(0x17f)]()))continue;const _0x23f607=(_0x8a2302[_0x41caf9(0x114)]||_0x8a2302[_0x41caf9(0x12f)]||'')['toLowerCase']();if(_0x23f607[_0x41caf9(0x17b)](_0x41caf9(0x146))||_0x23f607['includes'](_0x41caf9(0x14d))||_0x23f607[_0x41caf9(0x17b)](_0x41caf9(0x14e))){let _0x2f7342=0x0;Object[_0x41caf9(0x10a)](_0x529b17)['forEach'](_0x3ad7cb=>{if(_0x3ad7cb>_0x2f7342)_0x2f7342=_0x3ad7cb;});if(_0x2f7342===0x0)_0x2f7342=0x78;const _0x46d74f=_0x509d83[_0x41caf9(0x17f)]()-_0x2f7342*0xea60;_0x408aad>=_0x46d74f&&_0x408aad<_0x509d83[_0x41caf9(0x17f)]()&&(_0x415232[_0x41caf9(0x186)]!==_0x41caf9(0x157)&&(_0x415232['log'][_0x41caf9(0x141)]('ðŸ“…\x20SMART\x20SCHEDULE\x20(Phase):\x20\x27Globaler\x20Start\x27\x20erkannt.\x20Heize\x20Haus\x20auf\x20(Vorlauf:\x20'+_0x2f7342+_0x41caf9(0x172)),await _0x415232[_0x41caf9(0x170)]('system.mode',{'val':_0x41caf9(0x157),'ack':![]})));}for(const _0x4c0dac of _0x22f7f7){if(_0x4c0dac['location']){const _0x13676a=_0x4c0dac[_0x41caf9(0x10e)][_0x41caf9(0xfd)]();if(_0x23f607[_0x41caf9(0x17b)](_0x13676a)){const _0x86c032=_0x529b17[_0x4c0dac[_0x41caf9(0x10e)]]||0x3c,_0x53b532=_0x16a949[_0x4c0dac[_0x41caf9(0x10e)]]||_0x41caf9(0x198),_0x119b81=_0x509d83[_0x41caf9(0x17f)]()-_0x86c032*0xea60;if(_0x408aad>=_0x119b81&&_0x408aad<_0x509d83[_0x41caf9(0x17f)]()){const _0x146c9a=lastActions[_0x41caf9(0x16c)+_0x4c0dac[_0x41caf9(0x10e)]];if(_0x146c9a&&_0x408aad-_0x146c9a<CAL_COOLDOWN_MS)continue;const _0x5aa2be=await findRelatedId(_0x415232,_0x4c0dac['id'],_0x41caf9(0x1a3));if(_0x5aa2be){let _0x1c9819=_0x253221[_0x4c0dac['location']];if(_0x1c9819===undefined)_0x1c9819=_0x253221[_0x41caf9(0x17a)];if(_0x1c9819===undefined)_0x1c9819=0x15;const _0x50017b=await _0x415232[_0x41caf9(0x18c)](_0x5aa2be);_0x50017b&&typeof _0x50017b['val']==='number'&&_0x50017b[_0x41caf9(0x1a4)]<_0x1c9819-0.5&&(_0x415232[_0x41caf9(0x15d)]['info']('ðŸ“…\x20SMART\x20SCHEDULE\x20['+_0x53b532+_0x41caf9(0x13a)+_0x4c0dac[_0x41caf9(0x10e)]+_0x41caf9(0x133)+_0x1c9819+'Â°C\x20(Vorlauf:\x20'+_0x86c032+_0x41caf9(0x172)),await _0x415232[_0x41caf9(0x18b)](_0x5aa2be,_0x1c9819),await logAutomationAction(_0x415232,_0x41caf9(0x162)+_0x4c0dac['location']+_0x41caf9(0x110)+_0x1c9819+_0x41caf9(0x107)+_0x53b532+')'),lastActions[_0x41caf9(0x16c)+_0x4c0dac[_0x41caf9(0x10e)]]=_0x408aad);}}}}}}}catch(_0x5e0000){_0x415232['log'][_0x41caf9(0x161)](_0x41caf9(0x13f)+_0x5e0000[_0x41caf9(0x10c)]);}}function a1_0x2be1(){const _0x56ccda=['Unbekannt','calendarInstance','.1.ACTUAL_TEMPERATURE','type',']:\x20Raum-Trigger\x20\x27','splice','Nicht\x20gefunden','score','SET_POINT_TEMPERATURE','Calendar\x20Check\x20Error:\x20','reason','info','constructor','308784MznxSr','ðŸ”¥\x20[MPC\x20ACTION]\x20Heize\x20','ðŸŽ“\x20[RL-FEEDBACK]\x20Lerne\x20aus\x20Fehler:\x20','urlaub\x20ende',':\x20Puffer\x20leer\x20->\x20Heizen\x20auf\x20','getForeignObjectsAsync','minutes_safe','966182ZJKRJO','window','thermostat','rÃ¼ckkehr','ankunft','join','from','TRAIN_RL_PENALTY','[MPC\x20WARNING]\x20Kein\x20Setpoint\x20fÃ¼r\x20','parse','remove','level','room','normal','number','push','Unknown','.4.VALVE_STATE','10XQkKtK','log','Â°C!\x20(Puffer\x20leer).','\x20gefunden!','\x20auf\x20','warn','[CAL]\x20','toString','temperature','sort','9891453QYtBVC','triggerTime','(((.+)+)+)+$','dimmer','add','name','cal_','unshift','occupied_heating_setpoint','forEach','setStateAsync','openknx','\x20min).','getStateAsync','\x20->\x20Schalte\x20','PrÃ¤diktion:\x20','18640hjofvI',':\x20Aufheizen\x20auf\x20','trim','.data.table','default','includes','.4.SET_TEMPERATURE','ðŸƒ\x20[MPC\x20ACTION]\x20Senke\x20','ðŸš¨\x20[MPC\x20WATCHDOG]\x20','getTime','790gfrAFk','consultButler','config','PERFECT','manual','4086EkBlWE','currentSystemMode','date','ACTUAL','eventStart','role','setForeignStateAsync','getForeignStateAsync','temp','devices','[MPC]\x20','apply','Â°C).\x20Entferne\x20Status.','analysis.energy.ventilationAlerts','analysis.energy.mpcActiveInterventions','Manuelles\x20Mapping','Ist','filter','ðŸ§¹\x20[MPC\x20CLEANUP]\x20Raum\x20\x27','Classic','thermostat.setpoint','split','mpc_','1YKzmeU','\x20ist\x20zu\x20kalt,\x20ABER\x20Fenster\x20offen/LÃ¼ftung\x20erkannt.\x20Heize\x20NICHT,\x20entferne\x20nur\x20Status.','analysis.energy.warmupTimes','target_temperature','messwert','write','\x20ist\x20auf\x20','setpoint','val','level.valve','_calName','off','.1.SET_POINT_TEMPERATURE','ist','current_heating_setpoint','common','ðŸŒ¬ï¸\x20[MPC\x20WATCHDOG]\x20','now','13888RXKjue','Â°C).\x20Sparmodus\x20beendet!','valve','search','toLowerCase','\x20min)','ACTUAL_TEMPERATURE','indexOf','find','approved','slice','valveMapping','analysis.energy.warmupTargets','open','Â°C\x20(via\x20','light','\x20erreicht\x20Limit\x20(','values','./ai_agent','message','sensor','location','\x20durch\x20Kalender\x20geÃ¤ndert.\x20Keine\x20RL-Strafe.','\x20->\x20','.1.LEVEL','pi_heating_demand','2540964czewQW','event','exports','ðŸ§¹\x20[MPC\x20CLEANUP]\x20','set','getForeignObjectAsync','SET','useCalendar','sendToPythonWrapper','target','calendarSelection','local_temperature','\x20wieder\x20auf\x20','Â°C\x20<\x20','rescue_','position','Soll','analysis.energy.schedulePreview','too_cold','length','analysis.automation.actionLog','localeCompare','stringify','\x20wurde\x20manuell\x20erhÃ¶ht.','_date','string','thermostatMapping','3966718YQKmqM','summary',':\x20Absenkung\x20auf\x20','entries','analysis.automation.lastAction','\x27\x20aktiv.\x20Heize\x20auf\x20','Auto-Erkennung','ðŸ“…\x20[MPC\x20INFO]\x20'];a1_0x2be1=function(){return _0x56ccda;};return a1_0x2be1();}async function manageMpcIntervention(_0x4b9d74,_0x20e272,_0x589d18){const _0x387221=a1_0x1fdd3c;try{const _0xdc8b3f=_0x387221(0x193),_0x351d7e=await _0x4b9d74[_0x387221(0x173)](_0xdc8b3f);let _0x151717=[];if(_0x351d7e&&_0x351d7e[_0x387221(0x1a4)])try{_0x151717=JSON[_0x387221(0x153)](_0x351d7e[_0x387221(0x1a4)]);}catch(_0x49dc7d){}const _0x4b3d14=_0x151717[_0x387221(0x100)](_0x20e272);if(_0x589d18===_0x387221(0x16a))_0x4b3d14===-0x1&&(_0x151717[_0x387221(0x159)](_0x20e272),await _0x4b9d74[_0x387221(0x170)](_0xdc8b3f,{'val':JSON[_0x387221(0x129)](_0x151717),'ack':!![]}));else _0x589d18===_0x387221(0x154)&&(_0x4b3d14!==-0x1&&(_0x151717[_0x387221(0x13b)](_0x4b3d14,0x1),await _0x4b9d74[_0x387221(0x170)](_0xdc8b3f,{'val':JSON['stringify'](_0x151717),'ack':!![]})));}catch(_0x2bec4c){}}async function cleanupGhostInterventions(_0x4cce6f){const _0x161b53=a1_0x1fdd3c;try{const _0x1430e9=_0x161b53(0x193),_0x5c0387=await _0x4cce6f[_0x161b53(0x173)](_0x1430e9);if(!_0x5c0387||!_0x5c0387[_0x161b53(0x1a4)])return;const _0x43aaf9=JSON[_0x161b53(0x153)](_0x5c0387[_0x161b53(0x1a4)]);if(!Array['isArray'](_0x43aaf9)||_0x43aaf9[_0x161b53(0x126)]===0x0)return;let _0x4930d8={'default':0x15};try{const _0x100b0b=await _0x4cce6f[_0x161b53(0x173)](_0x161b53(0x105));if(_0x100b0b&&_0x100b0b[_0x161b53(0x1a4)])_0x4930d8=JSON[_0x161b53(0x153)](_0x100b0b[_0x161b53(0x1a4)]);}catch(_0x3e371c){}let _0x480535=[];try{const _0x10f163=await _0x4cce6f['getStateAsync'](_0x161b53(0x192));if(_0x10f163&&_0x10f163[_0x161b53(0x1a4)])_0x480535=JSON[_0x161b53(0x153)](_0x10f163[_0x161b53(0x1a4)]);}catch(_0x5edb14){}const _0x5bf79b=_0x4cce6f[_0x161b53(0x182)][_0x161b53(0x18e)]||[];let _0x42155b=![];for(let _0x14d232=_0x43aaf9[_0x161b53(0x126)]-0x1;_0x14d232>=0x0;_0x14d232--){const _0x4c3ca6=_0x43aaf9[_0x14d232],_0xd49c20=_0x5bf79b[_0x161b53(0x101)](_0x579554=>normalize(_0x579554[_0x161b53(0x10e)])===normalize(_0x4c3ca6)&&(_0x579554[_0x161b53(0x139)]===_0x161b53(0x164)||_0x579554[_0x161b53(0x139)]===_0x161b53(0x14c)));if(!_0xd49c20){_0x4cce6f[_0x161b53(0x15d)][_0x161b53(0x161)](_0x161b53(0x197)+_0x4c3ca6+'\x27\x20hat\x20kein\x20GerÃ¤t\x20mehr.\x20LÃ¶sche\x20Eintrag.'),_0x43aaf9['splice'](_0x14d232,0x1),_0x42155b=!![];continue;}if(_0xd49c20){const _0x27c114=await findRelatedId(_0x4cce6f,_0xd49c20['id'],_0x161b53(0x1a3)),_0x494de3=await _0x4cce6f['getForeignStateAsync'](_0xd49c20['id']);if(_0x27c114){const _0xbfe14c=await _0x4cce6f[_0x161b53(0x18c)](_0x27c114);if(_0xbfe14c&&typeof _0xbfe14c[_0x161b53(0x1a4)]==='number'){let _0x221dca=![],_0x5d98c8='';Math['abs'](_0xbfe14c[_0x161b53(0x1a4)]-ECO_TEMP)>0.5&&(_0x221dca=!![],_0x5d98c8=_0x161b53(0x184));if(!_0x221dca&&_0x494de3&&typeof _0x494de3['val']==='number'){const _0x34c7ef=_0x4930d8[_0x4c3ca6]||_0x4930d8[_0x161b53(0x17a)]||0x15;_0x494de3[_0x161b53(0x1a4)]<_0x34c7ef+0.2&&(_0x221dca=!![],_0x5d98c8=_0x161b53(0x125));}if(_0x221dca){if(_0x5d98c8===_0x161b53(0x184)){_0x4cce6f[_0x161b53(0x15d)][_0x161b53(0x141)](_0x161b53(0x116)+_0x4c3ca6+_0x161b53(0x1a2)+_0xbfe14c[_0x161b53(0x1a4)]+'Â°C\x20(nicht\x20'+ECO_TEMP+_0x161b53(0x191));const _0x58bd03=lastActions[_0x161b53(0x16c)+_0x4c3ca6],_0x52922b=_0x58bd03&&Date['now']()-_0x58bd03<0x2*0x3c*0x3e8;if(!_0x52922b&&_0xbfe14c[_0x161b53(0x1a4)]>ECO_TEMP+0.5)_0x4cce6f[_0x161b53(0x11b)]&&(_0x4cce6f[_0x161b53(0x15d)][_0x161b53(0x141)](_0x161b53(0x145)+_0x4c3ca6+_0x161b53(0x12a)),_0x4cce6f['sendToPythonWrapper'](_0x161b53(0x151),{'room':_0x4c3ca6}));else _0x52922b&&_0x4cce6f[_0x161b53(0x15d)][_0x161b53(0x141)](_0x161b53(0x135)+_0x4c3ca6+_0x161b53(0x10f));}else{if(_0x5d98c8===_0x161b53(0x125)){let _0x1c24e5=![];if(_0x480535[_0x161b53(0x101)](_0x25a957=>_0x25a957[_0x161b53(0x156)]===_0x4c3ca6))_0x1c24e5=!![];const _0x1a7965=_0x5bf79b[_0x161b53(0x196)](_0x56f19a=>normalize(_0x56f19a[_0x161b53(0x10e)])===normalize(_0x4c3ca6)&&(_0x56f19a[_0x161b53(0x139)]===_0x161b53(0x14b)||_0x56f19a[_0x161b53(0x139)]===_0x161b53(0x10d)||_0x56f19a[_0x161b53(0x139)]==='contact'));for(const _0x165e01 of _0x1a7965){try{const _0x24058b=await _0x4cce6f[_0x161b53(0x18c)](_0x165e01['id']);if(_0x24058b&&(_0x24058b[_0x161b53(0x1a4)]===!![]||_0x24058b[_0x161b53(0x1a4)]===0x1||String(_0x24058b['val'])[_0x161b53(0xfd)]()===_0x161b53(0x106)))_0x1c24e5=!![];}catch(_0x2a1ed8){}}if(_0x1c24e5)_0x4cce6f[_0x161b53(0x15d)][_0x161b53(0x141)](_0x161b53(0x1ac)+_0x4c3ca6+_0x161b53(0x19d));else{const _0x5d96f2=_0x4930d8[_0x4c3ca6]||_0x4930d8[_0x161b53(0x17a)]||0x15;_0x4cce6f[_0x161b53(0x15d)]['info'](_0x161b53(0x17e)+_0x4c3ca6+_0x161b53(0x109)+_0x494de3[_0x161b53(0x1a4)]+_0x161b53(0x120)+(_0x5d96f2+0.2)+_0x161b53(0x1af)),await _0x4cce6f['setForeignStateAsync'](_0x27c114,_0x5d96f2),await logAutomationAction(_0x4cce6f,'[WATCHDOG]\x20'+_0x4c3ca6+_0x161b53(0x147)+_0x5d96f2+'Â°C'),lastActions[_0x161b53(0x121)+_0x4c3ca6]=Date[_0x161b53(0x1ad)]();}}}_0x43aaf9[_0x161b53(0x13b)](_0x14d232,0x1),_0x42155b=!![];}}}}}_0x42155b&&await _0x4cce6f['setStateAsync'](_0x1430e9,{'val':JSON[_0x161b53(0x129)](_0x43aaf9),'ack':!![]});}catch(_0x8220a6){}}async function applyEnergySavings(_0x5ef6b5,_0x2cbd5e){const _0x5681ad=a1_0x1fdd3c;await cleanupGhostInterventions(_0x5ef6b5);if(!_0x2cbd5e||_0x2cbd5e[_0x5681ad(0x126)]===0x0)return;const _0x1710f6=_0x5ef6b5['config'][_0x5681ad(0x18e)]||[],_0xf1ec6=Date[_0x5681ad(0x1ad)]();for(const _0x21ec7a of _0x2cbd5e){const _0x1c099f=_0x21ec7a['room'],_0x4ed5f6=_0x21ec7a[_0x5681ad(0x149)],_0x230d3f=_0x21ec7a[_0x5681ad(0x11c)]||0x15;if(lastActions['rescue_'+_0x1c099f]&&_0xf1ec6-lastActions[_0x5681ad(0x121)+_0x1c099f]<RESCUE_LOCK_MS)continue;const _0x372dc0=_0x1710f6['find'](_0x1b55dd=>normalize(_0x1b55dd[_0x5681ad(0x10e)])===normalize(_0x1c099f)&&(_0x1b55dd['type']===_0x5681ad(0x164)||_0x1b55dd['type']===_0x5681ad(0x14c)));if(!_0x372dc0)continue;const _0x36d5a8=await findRelatedId(_0x5ef6b5,_0x372dc0['id'],_0x5681ad(0x1a3));if(_0x36d5a8){if(lastActions[_0x5681ad(0x19b)+_0x1c099f]&&_0xf1ec6-lastActions[_0x5681ad(0x19b)+_0x1c099f]<0x1e*0x3c*0x3e8)continue;const _0x4a2cbf=await _0x5ef6b5[_0x5681ad(0x18c)](_0x36d5a8);if(_0x4a2cbf&&typeof _0x4a2cbf[_0x5681ad(0x1a4)]===_0x5681ad(0x158)){const _0x554df3=_0x4a2cbf[_0x5681ad(0x1a4)];_0x554df3!==ECO_TEMP&&await manageMpcIntervention(_0x5ef6b5,_0x1c099f,_0x5681ad(0x154));if(_0x4ed5f6>0x1e)_0x554df3>ECO_TEMP+0.5&&(_0x5ef6b5[_0x5681ad(0x15d)][_0x5681ad(0x141)](_0x5681ad(0x17d)+_0x1c099f+_0x5681ad(0x160)+ECO_TEMP+'Â°C!\x20(Puffer:\x20'+_0x4ed5f6+_0x5681ad(0xfe)),await _0x5ef6b5[_0x5681ad(0x18b)](_0x36d5a8,ECO_TEMP),await manageMpcIntervention(_0x5ef6b5,_0x1c099f,_0x5681ad(0x16a)),lastActions[_0x5681ad(0x19b)+_0x1c099f]=_0xf1ec6,await logAutomationAction(_0x5ef6b5,_0x5681ad(0x18f)+_0x1c099f+_0x5681ad(0x130)+ECO_TEMP+'Â°C'));else _0x4ed5f6<=0xf&&(_0x554df3<_0x230d3f&&(_0x5ef6b5[_0x5681ad(0x15d)]['info'](_0x5681ad(0x144)+_0x1c099f+_0x5681ad(0x11f)+_0x230d3f+_0x5681ad(0x15e)),await _0x5ef6b5[_0x5681ad(0x18b)](_0x36d5a8,_0x230d3f),await manageMpcIntervention(_0x5ef6b5,_0x1c099f,_0x5681ad(0x154)),lastActions[_0x5681ad(0x19b)+_0x1c099f]=_0xf1ec6,await logAutomationAction(_0x5ef6b5,_0x5681ad(0x18f)+_0x1c099f+_0x5681ad(0x177)+_0x230d3f+'Â°C')));}}else _0x5ef6b5[_0x5681ad(0x15d)]['warn'](_0x5681ad(0x152)+_0x1c099f+_0x5681ad(0x15f));}}module[a1_0x1fdd3c(0x115)]={'handlePrediction':handlePrediction,'applyEnergySavings':applyEnergySavings,'scanThermostats':scanThermostats,'checkCalendarTriggers':checkCalendarTriggers,'updateSchedulePreview':updateSchedulePreview,'cleanupGhostInterventions':cleanupGhostInterventions};