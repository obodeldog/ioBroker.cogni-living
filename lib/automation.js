const a1_0x4cdc6d=a1_0x9781;function a1_0x9781(_0x33662f,_0x3f46d5){const _0x1640fa=a1_0x77c3();return a1_0x9781=function(_0x9ba2c7,_0x38fe45){_0x9ba2c7=_0x9ba2c7-0xf3;let _0x77c35c=_0x1640fa[_0x9ba2c7];return _0x77c35c;},a1_0x9781(_0x33662f,_0x3f46d5);}(function(_0x2a4023,_0x525ac4){const _0xd39f2b=a1_0x9781,_0x598f86=_0x2a4023();while(!![]){try{const _0x2692cc=-parseInt(_0xd39f2b(0x100))/0x1*(parseInt(_0xd39f2b(0x133))/0x2)+parseInt(_0xd39f2b(0x10c))/0x3*(-parseInt(_0xd39f2b(0x124))/0x4)+-parseInt(_0xd39f2b(0x10a))/0x5+-parseInt(_0xd39f2b(0x10b))/0x6*(parseInt(_0xd39f2b(0xf9))/0x7)+-parseInt(_0xd39f2b(0x12d))/0x8+parseInt(_0xd39f2b(0x121))/0x9+parseInt(_0xd39f2b(0x129))/0xa;if(_0x2692cc===_0x525ac4)break;else _0x598f86['push'](_0x598f86['shift']());}catch(_0xe3b87f){_0x598f86['push'](_0x598f86['shift']());}}}(a1_0x77c3,0xed1cd));const a1_0x38fe45=(function(){let _0x37c945=!![];return function(_0x5190c8,_0x5c738c){const _0x225211=_0x37c945?function(){const _0x20d753=a1_0x9781;if(_0x5c738c){const _0x6eaac9=_0x5c738c[_0x20d753(0x13e)](_0x5190c8,arguments);return _0x5c738c=null,_0x6eaac9;}}:function(){};return _0x37c945=![],_0x225211;};}()),a1_0x9ba2c7=a1_0x38fe45(this,function(){const _0x5ed6fd=a1_0x9781;return a1_0x9ba2c7[_0x5ed6fd(0x13f)]()[_0x5ed6fd(0x147)](_0x5ed6fd(0xf4))[_0x5ed6fd(0x13f)]()['constructor'](a1_0x9ba2c7)['search'](_0x5ed6fd(0xf4));});a1_0x9ba2c7();'use strict';const aiAgent=require(a1_0x4cdc6d(0x12b)),COOLDOWN_MS=0x3c*0x3e8,lastActions={};function normalize(_0xc3a62b){const _0x4aa5ed=a1_0x4cdc6d;if(!_0xc3a62b)return'';return _0xc3a62b['toLowerCase']()[_0x4aa5ed(0x12f)](/\s+/g,'')['trim']();}async function handlePrediction(_0x219596,_0x373ac8,_0x1fa0d6){const _0x3616eb=a1_0x4cdc6d;if(!_0x373ac8||_0x373ac8==='Unknown')return;let _0x405aed=_0x3616eb(0x10d),_0x7199b0=0.6;try{const _0xa363b7=await _0x219596[_0x3616eb(0x141)](_0x3616eb(0x128));if(_0xa363b7&&_0xa363b7[_0x3616eb(0x140)])_0x405aed=_0xa363b7[_0x3616eb(0x140)];const _0x2d60d0=await _0x219596[_0x3616eb(0x141)](_0x3616eb(0x107));if(_0x2d60d0&&_0x2d60d0[_0x3616eb(0x140)])_0x7199b0=_0x2d60d0[_0x3616eb(0x140)];}catch(_0x40b6cd){}if(_0x405aed===_0x3616eb(0x10d)||_0x1fa0d6<_0x7199b0)return;const _0x2b8c9a=Date[_0x3616eb(0x119)]();if(lastActions[_0x373ac8]&&_0x2b8c9a-lastActions[_0x373ac8]<COOLDOWN_MS)return;const _0x3d452c=_0x219596[_0x3616eb(0x120)]['devices']||[],_0x9ebf58=normalize(_0x373ac8),_0x85e5ee=_0x3d452c['find'](_0x564027=>normalize(_0x564027[_0x3616eb(0x134)])===_0x9ebf58&&(_0x564027['type']===_0x3616eb(0x13b)||_0x564027[_0x3616eb(0x146)]===_0x3616eb(0x123)||_0x564027[_0x3616eb(0x146)]==='switch'));if(!_0x85e5ee){_0x219596['log'][_0x3616eb(0x109)](_0x3616eb(0x112)+_0x373ac8+'\x27.');return;}const _0x41335b=await aiAgent[_0x3616eb(0x145)](_0x219596,_0x373ac8,_0x85e5ee[_0x3616eb(0x12e)],_0x1fa0d6);if(!_0x41335b[_0x3616eb(0x138)])return;const _0x17cd4a=_0x3616eb(0x126)+_0x373ac8+'\x20->\x20Schalte\x20'+_0x85e5ee['name']+'\x20('+_0x41335b[_0x3616eb(0x11a)]+')';await _0x219596[_0x3616eb(0xfa)]('analysis.automation.lastAction',{'val':'['+_0x405aed[_0x3616eb(0x139)]()+']\x20'+_0x17cd4a,'ack':!![]});if(_0x405aed==='active'){const _0x36612a=await _0x219596[_0x3616eb(0x122)](_0x85e5ee['id']);(!_0x36612a||!_0x36612a['val']&&_0x36612a[_0x3616eb(0x140)]!==!![])&&await _0x219596[_0x3616eb(0xfc)](_0x85e5ee['id'],!![]),lastActions[_0x373ac8]=_0x2b8c9a;}}async function findSetpointId(_0x2f7472,_0x1f2c8b){const _0x146a17=a1_0x4cdc6d;if(_0x2f7472['config'][_0x146a17(0xfe)]){let _0x3b499b=_0x2f7472[_0x146a17(0x120)][_0x146a17(0xfe)];if(typeof _0x3b499b===_0x146a17(0x11c))try{_0x3b499b=JSON['parse'](_0x3b499b);}catch(_0xf8e96d){_0x3b499b={};}if(_0x3b499b&&_0x3b499b[_0x1f2c8b])return _0x3b499b[_0x1f2c8b];}const _0x3aae65=[{'s':'.1.ACTUAL_TEMPERATURE','t':'.1.SET_POINT_TEMPERATURE'},{'s':'.1.TEMPERATURE','t':_0x146a17(0x148)},{'s':_0x146a17(0xfb),'t':_0x146a17(0x10e)},{'s':_0x146a17(0x11e),'t':_0x146a17(0x103)},{'s':'local_temperature','t':_0x146a17(0x131)},{'s':_0x146a17(0x137),'t':_0x146a17(0x144)},{'s':_0x146a17(0x135),'t':_0x146a17(0x10f)},{'s':'Ist','t':_0x146a17(0xff)},{'s':_0x146a17(0x137),'t':_0x146a17(0x118)}];for(const _0x176374 of _0x3aae65){if(_0x1f2c8b[_0x146a17(0x11f)](_0x176374['s'])){const _0x2ce7ff=_0x1f2c8b[_0x146a17(0x12f)](_0x176374['s'],_0x176374['t']),_0x218085=await _0x2f7472[_0x146a17(0xf5)](_0x2ce7ff);if(_0x218085)return _0x2ce7ff;}}try{const _0x31a5c7=_0x1f2c8b[_0x146a17(0xf7)]('.');if(_0x31a5c7[_0x146a17(0x13c)]>0x2){const _0x19ab19=_0x31a5c7[_0x146a17(0xf3)](0x0,-0x1)[_0x146a17(0x12c)]('.'),_0xcb2f81=await _0x2f7472['getForeignObjectsAsync'](_0x19ab19+'.*');for(const [_0x125f30,_0x180aa9]of Object[_0x146a17(0x11b)](_0xcb2f81)){if(_0x125f30===_0x1f2c8b)continue;if(_0x180aa9&&_0x180aa9['common']&&_0x180aa9[_0x146a17(0x105)][_0x146a17(0x11d)]===!![]){const _0x2bde75=_0x125f30[_0x146a17(0x108)](),_0x385936=(_0x180aa9['common']['role']||'')[_0x146a17(0x108)]();if(_0x2bde75[_0x146a17(0x11f)]('set')||_0x2bde75[_0x146a17(0x11f)]('soll')||_0x2bde75['includes'](_0x146a17(0x114))||_0x385936[_0x146a17(0x11f)](_0x146a17(0x130))||_0x385936[_0x146a17(0x11f)]('thermostat'))return _0x125f30;}}}}catch(_0x5b67bf){}return null;}function a1_0x77c3(){const _0x88ef8=['SET_POINT_TEMPERATURE','SET','sort','[MPC]\x20','ðŸ”\x20Device-Search\x20failed\x20for\x20predicted\x20room\x20\x27',':\x20-1Â°C\x20(Sparpotenzial\x20genutzt)','target','temp','Unbekannt','minutes_safe','setpoint','now','reason','entries','string','write','local_temperature','includes','config','2860506LueFmc','getForeignStateAsync','dimmer','4MfoUYP','Nicht\x20gefunden','PrÃ¤diktion:\x20','sensor','analysis.automation.mode','48489650RlnuvO','log','./ai_agent','join','6737688hUbwFI','name','replace','level.temperature','current_heating_setpoint','thermostat','2otgNhx','location','ACTUAL','ðŸƒ\x20MPC\x20Autonomy:\x20Senke\x20','temperature','approved','toUpperCase','room','light','length','Â°C\x20(Coasting\x20mÃ¶glich:\x20','apply','toString','val','getStateAsync','devices','analysis.automation.lastAction','target_temperature','consultButler','type','search','.4.SET_TEMPERATURE','slice','(((.+)+)+)+$','getForeignObjectAsync','\x20min)','split','filter','7RozQJX','setStateAsync','ACTUAL_TEMPERATURE','setForeignStateAsync','localeCompare','thermostatMapping','Soll','322523eqxezF','parse','number','occupied_heating_setpoint','info','common','Auto-Erkennung','analysis.automation.confidenceThreshold','toLowerCase','debug','3869165LWeSlc','6915912OyoDKd','3313101qOcrwZ','off'];a1_0x77c3=function(){return _0x88ef8;};return a1_0x77c3();}async function scanThermostats(_0x72ab8){const _0x569991=a1_0x4cdc6d,_0x360807=_0x72ab8['config']['devices']||[],_0x5f11ee=[],_0x43c427=_0x360807[_0x569991(0xf8)](_0x2aed88=>_0x2aed88['id']&&_0x2aed88['id'][_0x569991(0x11f)](_0x569991(0x137))||_0x2aed88['type']&&[_0x569991(0x137),_0x569991(0x132),_0x569991(0x127)][_0x569991(0x11f)](_0x2aed88[_0x569991(0x146)])||_0x2aed88[_0x569991(0x12e)]&&_0x2aed88['name']['toLowerCase']()[_0x569991(0x11f)](_0x569991(0x115)));for(const _0x2b1a1b of _0x43c427){const _0x43781b=await findSetpointId(_0x72ab8,_0x2b1a1b['id']);let _0x2a780f=_0x569991(0x125),_0x48c546=![],_0x2ef2a7=_0x72ab8['config'][_0x569991(0xfe)]||{};if(typeof _0x2ef2a7===_0x569991(0x11c))try{_0x2ef2a7=JSON[_0x569991(0x101)](_0x2ef2a7);}catch(_0x39c6c3){}if(_0x2ef2a7[_0x2b1a1b['id']]&&_0x2ef2a7[_0x2b1a1b['id']]===_0x43781b)_0x2a780f='Manuelles\x20Mapping',_0x48c546=!![];else _0x43781b&&(_0x2a780f=_0x569991(0x106));_0x5f11ee['push']({'room':_0x2b1a1b['location']||_0x569991(0x116),'sensorId':_0x2b1a1b['id'],'setpointId':_0x43781b||'-','source':_0x2a780f,'isManual':_0x48c546,'status':_0x43781b?'OK':'Fehlt'});}return _0x5f11ee[_0x569991(0x110)]((_0x24fb98,_0xcd8015)=>_0x24fb98[_0x569991(0x13a)][_0x569991(0xfd)](_0xcd8015[_0x569991(0x13a)]));}async function applyEnergySavings(_0x43a428,_0x1c4ec1){const _0xce8ad9=a1_0x4cdc6d,_0x51386f=_0x43a428[_0xce8ad9(0x120)][_0xce8ad9(0x142)]||[];for(const _0x53bbe3 of _0x1c4ec1){const _0xf90305=_0x53bbe3[_0xce8ad9(0x13a)],_0x2d162e=_0x53bbe3[_0xce8ad9(0x117)],_0x4f7057=Date['now']();if(lastActions['mpc_'+_0xf90305]&&_0x4f7057-lastActions['mpc_'+_0xf90305]<0x1e*0x3c*0x3e8)continue;const _0x70dc3e=_0x51386f['find'](_0x14bb62=>normalize(_0x14bb62[_0xce8ad9(0x134)])===normalize(_0xf90305));if(!_0x70dc3e)continue;const _0x22168a=await findSetpointId(_0x43a428,_0x70dc3e['id']);if(_0x22168a){const _0x592d65=await _0x43a428[_0xce8ad9(0x122)](_0x22168a);if(_0x592d65&&typeof _0x592d65['val']===_0xce8ad9(0x102)){const _0x573397=_0x592d65['val'];if(_0x2d162e>0x1e&&_0x573397>0x11){const _0x271bfa=_0x573397-0x1;_0x43a428[_0xce8ad9(0x12a)][_0xce8ad9(0x104)](_0xce8ad9(0x136)+_0xf90305+'\x20('+_0x22168a+')\x20auf\x20'+_0x271bfa+_0xce8ad9(0x13d)+_0x2d162e+_0xce8ad9(0xf6)),await _0x43a428[_0xce8ad9(0xfc)](_0x22168a,_0x271bfa),lastActions['mpc_'+_0xf90305]=_0x4f7057,await _0x43a428[_0xce8ad9(0xfa)](_0xce8ad9(0x143),{'val':_0xce8ad9(0x111)+_0xf90305+_0xce8ad9(0x113),'ack':!![]});}}}}}module['exports']={'handlePrediction':handlePrediction,'applyEnergySavings':applyEnergySavings,'scanThermostats':scanThermostats};