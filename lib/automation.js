const a1_0x41aeb6=a1_0x5016;(function(_0x250f50,_0x3c3738){const _0x4743c4=a1_0x5016,_0x54c5ee=_0x250f50();while(!![]){try{const _0x37e907=parseInt(_0x4743c4(0x11c))/0x1+-parseInt(_0x4743c4(0xda))/0x2*(-parseInt(_0x4743c4(0xa1))/0x3)+-parseInt(_0x4743c4(0x122))/0x4*(parseInt(_0x4743c4(0x118))/0x5)+-parseInt(_0x4743c4(0x121))/0x6*(-parseInt(_0x4743c4(0xf7))/0x7)+parseInt(_0x4743c4(0xfd))/0x8*(-parseInt(_0x4743c4(0xf2))/0x9)+-parseInt(_0x4743c4(0xc8))/0xa*(-parseInt(_0x4743c4(0x129))/0xb)+-parseInt(_0x4743c4(0xd1))/0xc;if(_0x37e907===_0x3c3738)break;else _0x54c5ee['push'](_0x54c5ee['shift']());}catch(_0x417692){_0x54c5ee['push'](_0x54c5ee['shift']());}}}(a1_0x4a36,0xc9c50));const a1_0x487a88=(function(){let _0x4a2e45=!![];return function(_0x3ba9fd,_0x354c4f){const _0x360868=_0x4a2e45?function(){if(_0x354c4f){const _0x134b95=_0x354c4f['apply'](_0x3ba9fd,arguments);return _0x354c4f=null,_0x134b95;}}:function(){};return _0x4a2e45=![],_0x360868;};}()),a1_0x17076f=a1_0x487a88(this,function(){const _0x5ea64a=a1_0x5016;return a1_0x17076f['toString']()['search'](_0x5ea64a(0x13f))[_0x5ea64a(0x138)]()[_0x5ea64a(0xa8)](a1_0x17076f)[_0x5ea64a(0x13a)](_0x5ea64a(0x13f));});a1_0x17076f();'use strict';function a1_0x4a36(){const _0xd87436=['3tNyjnO','target_temperature','approved','rÃ¼ckkehr','date','entries','active','constructor','\x20->\x20','minutes_safe','analysis.energy.warmupTimes','message','getForeignObjectAsync','level','val','analysis.automation.actionLog','info','type','position','value.valve','valve_position','temp','urlaub\x20ende','.1.TEMPERATURE','\x27\x20aktiv\x20(','Â°C!\x20(Puffer\x20leer).\x20->\x20ID:\x20','common','stringify','event','Manuelles\x20Mapping','messwert','_calName','\x20min)\x20->\x20ID:\x20','.1.ACTUAL_TEMPERATURE','\x20gefunden!\x20Bitte\x20\x27System\x27\x20Tab\x20prÃ¼fen.','sort','replace','actual','target','10CCEXEJ','light','setForeignStateAsync','warn','unit','occupied_heating_setpoint','eventStart','config','split','25560744BWgbHP','now','_date','thermostat','.data.table','.4.SET_TEMPERATURE','.1.LEVEL','setStateAsync','analysis.automation.lastAction','2578266mynJvs','Unbekannt','useCalendar','./ai_agent','Unknown','Â°C,\x20Puffer:\x20','SET_POINT_TEMPERATURE','analysis.energy.mpcActiveInterventions','openknx','stellwert','ðŸƒ\x20[MPC\x20ACTION]\x20Senke\x20','exports','off','length','name','Auto-Erkennung','push','number','valveMapping','getForeignStateAsync','.4.VALVE_STATE','Ist','find','Fehlt','1737BgpTxW','write','getStateAsync','wert','filter','11473PUHZGb','[CAL]\x20','normal',':\x20Absenkung\x20auf\x20','\x20min).','valve','7864CnuwMY','summary','analysis.energy.warmupTargets','default','pi_heating_demand','ankunft','PrÃ¤diktion:\x20','consultButler','sensor','current_heating_setpoint','thermostatMapping','soll',').\x20Heize\x20auf\x20','\x20auf\x20','ACTUAL_TEMPERATURE','forEach','cal_','calendarInstance','getForeignObjectsAsync','remove','temperature','dimmer','PERFECT','devices','join','ðŸ“…\x20SMART\x20SCHEDULE\x20(Catch-Up):\x20Raum-Trigger\x20\x27','location','44465ZzgsRN','[MPC\x20WARNING]\x20Kein\x20Setpoint\x20(Soll-Temp)\x20fÃ¼r\x20','ðŸ”¥\x20[MPC\x20ACTION]\x20Heize\x20','mpc_','1017864cxKGAN','.1.SET_POINT_TEMPERATURE','string','add','Soll','732qVWMNC','292JhQhsX','\x20->\x20Schalte\x20','triggerTime','local_temperature','includes','trim','setpoint','14173093oDmmRn','level.temperature','getTime','ACTUAL','set','slice','parse','[MPC]\x20','switch','toLowerCase','values','Nicht\x20gefunden','indexOf','role','analysis.energy.schedulePreview','toString','calendarSelection','search','system.mode','currentSystemMode','room','score','(((.+)+)+)+$','toUpperCase','log','SET',').\x20Heize\x20ganzes\x20Haus\x20auf\x20(Vorlauf:\x20','\x20wieder\x20auf\x20','Â°C!\x20(Aktuell:\x20','unshift'];a1_0x4a36=function(){return _0xd87436;};return a1_0x4a36();}const aiAgent=require(a1_0x41aeb6(0xdd)),COOLDOWN_MS=0x3c*0x3e8,CAL_COOLDOWN_MS=0x5a*0x3c*0x3e8,ECO_TEMP=0x11,lastActions={};function normalize(_0x148d21){const _0x905de6=a1_0x41aeb6;if(!_0x148d21)return'';return _0x148d21[_0x905de6(0x132)]()[_0x905de6(0xc5)](/\s+/g,'')[_0x905de6(0x127)]();}async function logAutomationAction(_0x340440,_0x25cf4e){const _0x3380f3=a1_0x41aeb6;await _0x340440[_0x3380f3(0xd8)](_0x3380f3(0xd9),{'val':_0x25cf4e,'ack':!![]});try{const _0xc663cb=_0x3380f3(0xb0),_0x2c4310=await _0x340440[_0x3380f3(0xf4)](_0xc663cb);let _0x426aa0=[];if(_0x2c4310&&_0x2c4310['val'])try{_0x426aa0=JSON['parse'](_0x2c4310[_0x3380f3(0xaf)]);}catch(_0x5ad3b5){}_0x426aa0[_0x3380f3(0xa0)]({'ts':Date['now'](),'msg':_0x25cf4e}),_0x426aa0[_0x3380f3(0xe7)]>0x32&&(_0x426aa0=_0x426aa0[_0x3380f3(0x12e)](0x0,0x32)),await _0x340440['setStateAsync'](_0xc663cb,{'val':JSON[_0x3380f3(0xbc)](_0x426aa0),'ack':!![]});}catch(_0x1dd2a3){}}async function handlePrediction(_0x358374,_0x379d11,_0x184974){const _0x2ef743=a1_0x41aeb6;if(!_0x379d11||_0x379d11===_0x2ef743(0xde))return;let _0x1800e4=_0x2ef743(0xe6),_0xcd6e6b=0.6;try{const _0x41e527=await _0x358374[_0x2ef743(0xf4)]('analysis.automation.mode');if(_0x41e527&&_0x41e527[_0x2ef743(0xaf)])_0x1800e4=_0x41e527[_0x2ef743(0xaf)];const _0x53f71d=await _0x358374[_0x2ef743(0xf4)]('analysis.automation.confidenceThreshold');if(_0x53f71d&&_0x53f71d[_0x2ef743(0xaf)])_0xcd6e6b=_0x53f71d[_0x2ef743(0xaf)];}catch(_0x11b6b2){}if(_0x1800e4===_0x2ef743(0xe6)||_0x184974<_0xcd6e6b)return;const _0x142ffd=Date['now']();if(lastActions[_0x379d11]&&_0x142ffd-lastActions[_0x379d11]<COOLDOWN_MS)return;const _0x24ebde=_0x358374['config'][_0x2ef743(0x114)]||[],_0x50bd67=normalize(_0x379d11),_0x295620=_0x24ebde[_0x2ef743(0xf0)](_0x229e08=>normalize(_0x229e08[_0x2ef743(0x117)])===_0x50bd67&&(_0x229e08['type']===_0x2ef743(0xc9)||_0x229e08[_0x2ef743(0xb2)]===_0x2ef743(0x112)||_0x229e08[_0x2ef743(0xb2)]===_0x2ef743(0x131)));if(!_0x295620)return;const _0x101764=await aiAgent[_0x2ef743(0x104)](_0x358374,_0x379d11,_0x295620[_0x2ef743(0xe8)],_0x184974);if(!_0x101764[_0x2ef743(0xa3)])return;const _0x176374=_0x2ef743(0x103)+_0x379d11+_0x2ef743(0x123)+_0x295620[_0x2ef743(0xe8)]+'\x20('+_0x101764['reason']+')';await logAutomationAction(_0x358374,'['+_0x1800e4[_0x2ef743(0x140)]()+']\x20'+_0x176374);if(_0x1800e4===_0x2ef743(0xa7)){const _0x541f68=await _0x358374[_0x2ef743(0xed)](_0x295620['id']);(!_0x541f68||!_0x541f68[_0x2ef743(0xaf)]&&_0x541f68[_0x2ef743(0xaf)]!==!![])&&await _0x358374[_0x2ef743(0xca)](_0x295620['id'],!![]),lastActions[_0x379d11]=_0x142ffd;}}async function findRelatedId(_0x173a2f,_0x55bdd9,_0xc23bb9='setpoint'){const _0x5e2cce=a1_0x41aeb6;if(_0xc23bb9===_0x5e2cce(0x128)&&_0x173a2f['config'][_0x5e2cce(0x107)]){let _0x42a1a8=_0x173a2f[_0x5e2cce(0xcf)][_0x5e2cce(0x107)];if(typeof _0x42a1a8===_0x5e2cce(0x11e))try{_0x42a1a8=JSON[_0x5e2cce(0x12f)](_0x42a1a8);}catch(_0x12f4b3){}if(_0x42a1a8&&_0x42a1a8[_0x55bdd9])return _0x42a1a8[_0x55bdd9];}if(_0xc23bb9==='valve'&&_0x173a2f[_0x5e2cce(0xcf)][_0x5e2cce(0xec)]){let _0xa515a=_0x173a2f[_0x5e2cce(0xcf)][_0x5e2cce(0xec)];if(typeof _0xa515a===_0x5e2cce(0x11e))try{_0xa515a=JSON[_0x5e2cce(0x12f)](_0xa515a);}catch(_0x3747c4){}if(_0xa515a&&_0xa515a[_0x55bdd9])return _0xa515a[_0x55bdd9];}let _0xfbd07e=[];if(_0xc23bb9===_0x5e2cce(0x128))_0xfbd07e=[{'s':_0x5e2cce(0xc2),'t':_0x5e2cce(0x11d)},{'s':_0x5e2cce(0xb8),'t':'.1.SET_POINT_TEMPERATURE'},{'s':'.1.TEMPERATURE','t':_0x5e2cce(0xd6)},{'s':_0x5e2cce(0x10b),'t':_0x5e2cce(0xe0)},{'s':'local_temperature','t':_0x5e2cce(0xcd)},{'s':'local_temperature','t':_0x5e2cce(0x106)},{'s':_0x5e2cce(0x111),'t':_0x5e2cce(0xa2)},{'s':_0x5e2cce(0x12c),'t':_0x5e2cce(0x9c)},{'s':_0x5e2cce(0xef),'t':_0x5e2cce(0x120)},{'s':_0x5e2cce(0x111),'t':_0x5e2cce(0x128)}];else _0xc23bb9===_0x5e2cce(0xfc)&&(_0xfbd07e=[{'s':'.1.ACTUAL_TEMPERATURE','t':'.1.LEVEL'},{'s':'.1.TEMPERATURE','t':_0x5e2cce(0xd7)},{'s':_0x5e2cce(0xb8),'t':_0x5e2cce(0xee)},{'s':_0x5e2cce(0x125),'t':_0x5e2cce(0x101)},{'s':'temperature','t':_0x5e2cce(0xb5)},{'s':'temperature','t':_0x5e2cce(0xae)}]);for(const _0x5ed835 of _0xfbd07e){if(_0x55bdd9[_0x5e2cce(0x126)](_0x5ed835['s'])){const _0x1e2e45=_0x55bdd9['replace'](_0x5ed835['s'],_0x5ed835['t']),_0x26f17d=await _0x173a2f[_0x5e2cce(0xad)](_0x1e2e45);if(_0x26f17d)return _0x1e2e45;}}try{const _0x5b432f=_0x55bdd9[_0x5e2cce(0xd0)]('.');if(_0x5b432f[_0x5e2cce(0xe7)]>0x2){const _0x403708=_0x5b432f[_0x5e2cce(0x12e)](0x0,-0x1)[_0x5e2cce(0x115)]('.'),_0x2402ae=await _0x173a2f[_0x5e2cce(0x10f)](_0x403708+'.*'),_0x3b523d=[],_0x1d71d2=_0x55bdd9[_0x5e2cce(0xd0)](/[._]+/)[_0x5e2cce(0xf6)](_0x24fe63=>![_0x5e2cce(0xe2),'0','hm-rpc','ist',_0x5e2cce(0xf5),'temperature',_0x5e2cce(0xc6),'sensor',_0x5e2cce(0xbf),'state'][_0x5e2cce(0x126)](_0x24fe63[_0x5e2cce(0x132)]()));for(const [_0x383454,_0x4bbebe]of Object[_0x5e2cce(0xa6)](_0x2402ae)){if(_0x383454===_0x55bdd9)continue;if(_0x4bbebe&&_0x4bbebe[_0x5e2cce(0xbb)]){const _0x298fb6=_0x383454[_0x5e2cce(0x132)](),_0x34141f=(_0x4bbebe[_0x5e2cce(0xbb)][_0x5e2cce(0x136)]||'')[_0x5e2cce(0x132)](),_0x2a8db5=(_0x4bbebe[_0x5e2cce(0xbb)][_0x5e2cce(0xcc)]||'')['toLowerCase']();let _0x33ea95=![];if(_0xc23bb9===_0x5e2cce(0x128)&&_0x4bbebe[_0x5e2cce(0xbb)][_0x5e2cce(0xf3)]===!![])_0x33ea95=_0x298fb6[_0x5e2cce(0x126)](_0x5e2cce(0x12d))||_0x298fb6[_0x5e2cce(0x126)](_0x5e2cce(0x108))||_0x298fb6[_0x5e2cce(0x126)](_0x5e2cce(0xc7))||_0x34141f[_0x5e2cce(0x126)](_0x5e2cce(0x12a))||_0x34141f[_0x5e2cce(0x126)]('thermostat.setpoint');else _0xc23bb9===_0x5e2cce(0xfc)&&(_0x33ea95=_0x298fb6[_0x5e2cce(0x126)](_0x5e2cce(0xae))||_0x298fb6[_0x5e2cce(0x126)]('valve')||_0x298fb6[_0x5e2cce(0x126)](_0x5e2cce(0xe3))||_0x298fb6[_0x5e2cce(0x126)](_0x5e2cce(0xb3))||_0x34141f[_0x5e2cce(0x126)]('level.valve')||_0x34141f[_0x5e2cce(0x126)](_0x5e2cce(0xb4))||_0x2a8db5[_0x5e2cce(0x126)]('%'));if(_0x33ea95){const _0x391a96=_0x383454['split'](/[._]+/)['map'](_0x4b0273=>_0x4b0273[_0x5e2cce(0x132)]());let _0x1b6630=0x0;_0x1d71d2[_0x5e2cce(0x10c)](_0x39daf4=>{const _0x4a5c16=_0x5e2cce;if(_0x391a96[_0x4a5c16(0x126)](_0x39daf4[_0x4a5c16(0x132)]()))_0x1b6630++;}),_0x3b523d['push']({'id':_0x383454,'score':_0x1b6630});}}}if(_0x3b523d['length']>0x0){_0x3b523d[_0x5e2cce(0xc4)]((_0x422aba,_0x5ad884)=>_0x5ad884[_0x5e2cce(0x13e)]-_0x422aba[_0x5e2cce(0x13e)]);if(_0x3b523d[0x0][_0x5e2cce(0x13e)]>0x0)return _0x3b523d[0x0]['id'];}}}catch(_0xd217c3){}return null;}async function scanThermostats(_0x33ca56){const _0x264053=a1_0x41aeb6,_0x226e22=_0x33ca56[_0x264053(0xcf)][_0x264053(0x114)]||[],_0x5acc9c=[],_0x3467be=_0x226e22[_0x264053(0xf6)](_0x2889af=>_0x2889af['id']&&_0x2889af['id']['includes'](_0x264053(0x111))||_0x2889af[_0x264053(0xb2)]&&[_0x264053(0x111),_0x264053(0xd4),_0x264053(0x105)][_0x264053(0x126)](_0x2889af['type'])||_0x2889af[_0x264053(0xe8)]&&_0x2889af[_0x264053(0xe8)][_0x264053(0x132)]()[_0x264053(0x126)](_0x264053(0xb6)));for(const _0x3ef309 of _0x3467be){const _0x13e514=await findRelatedId(_0x33ca56,_0x3ef309['id'],'setpoint'),_0x149bfa=await findRelatedId(_0x33ca56,_0x3ef309['id'],'valve');let _0xdb7e2c=_0x264053(0x134),_0x2e644f=![],_0x4390cf=_0x33ca56[_0x264053(0xcf)]['thermostatMapping']||{};if(typeof _0x4390cf==='string')try{_0x4390cf=JSON[_0x264053(0x12f)](_0x4390cf);}catch(_0x3144a7){}let _0x2ad85f=_0x33ca56[_0x264053(0xcf)]['valveMapping']||{};if(typeof _0x2ad85f===_0x264053(0x11e))try{_0x2ad85f=JSON['parse'](_0x2ad85f);}catch(_0x3c718f){}if(_0x4390cf[_0x3ef309['id']]&&_0x4390cf[_0x3ef309['id']]===_0x13e514||_0x2ad85f[_0x3ef309['id']]&&_0x2ad85f[_0x3ef309['id']]===_0x149bfa)_0xdb7e2c=_0x264053(0xbe),_0x2e644f=!![];else(_0x13e514||_0x149bfa)&&(_0xdb7e2c=_0x264053(0xe9));_0x5acc9c['push']({'room':_0x3ef309['location']||_0x264053(0xdb),'sensorId':_0x3ef309['id'],'setpointId':_0x13e514||'-','valveId':_0x149bfa||'-','source':_0xdb7e2c,'isManual':_0x2e644f,'status':_0x13e514&&_0x149bfa?_0x264053(0x113):_0x13e514?'OK':_0x264053(0xf1)});}return _0x5acc9c[_0x264053(0xc4)]((_0x37e278,_0x25a051)=>_0x37e278[_0x264053(0x13d)]['localeCompare'](_0x25a051[_0x264053(0x13d)]));}function a1_0x5016(_0x2185b8,_0x2251f4){const _0x537c61=a1_0x4a36();return a1_0x5016=function(_0x17076f,_0x487a88){_0x17076f=_0x17076f-0x9c;let _0x4a36f2=_0x537c61[_0x17076f];return _0x4a36f2;},a1_0x5016(_0x2185b8,_0x2251f4);}async function updateSchedulePreview(_0x35351a){const _0x325953=a1_0x41aeb6;if(!_0x35351a[_0x325953(0xcf)][_0x325953(0xdc)]||!_0x35351a[_0x325953(0xcf)][_0x325953(0x10e)])return;let _0x5226c4={};try{const _0x1b5e76=await _0x35351a[_0x325953(0xf4)](_0x325953(0xab));if(_0x1b5e76&&_0x1b5e76['val'])_0x5226c4=JSON[_0x325953(0x12f)](_0x1b5e76[_0x325953(0xaf)]);}catch(_0x313009){}const _0x284c44=[],_0x461509=Date[_0x325953(0xd2)](),_0x19fb99=0x30*0x3c*0x3c*0x3e8;try{const _0x5a8319=await _0x35351a[_0x325953(0xed)](_0x35351a[_0x325953(0xcf)][_0x325953(0x10e)]+_0x325953(0xd5));if(!_0x5a8319||!_0x5a8319[_0x325953(0xaf)])return;const _0x1f0c71=JSON[_0x325953(0x12f)](_0x5a8319[_0x325953(0xaf)]),_0x131ee3=_0x35351a[_0x325953(0xcf)][_0x325953(0x139)]||[],_0x3437c0=_0x35351a[_0x325953(0xcf)][_0x325953(0x114)]||[],_0x1a831e=new Set();_0x3437c0['forEach'](_0xfbb30b=>{const _0x233f40=_0x325953;if(_0xfbb30b['location'])_0x1a831e['add'](_0xfbb30b[_0x233f40(0x117)]);});for(const _0x1598e1 of _0x1f0c71){if(_0x1598e1[_0x325953(0xc0)]&&_0x131ee3['length']>0x0&&!_0x131ee3['includes'](_0x1598e1[_0x325953(0xc0)]))continue;const _0x432dc2=_0x1598e1[_0x325953(0xd3)]||_0x1598e1[_0x325953(0xce)]||_0x1598e1[_0x325953(0xa5)];if(!_0x432dc2)continue;const _0x376c8e=new Date(_0x432dc2),_0x36c510=_0x376c8e[_0x325953(0x12b)]();if(isNaN(_0x36c510))continue;if(_0x36c510<_0x461509)continue;if(_0x36c510>_0x461509+_0x19fb99)continue;const _0x3e45f0=(_0x1598e1[_0x325953(0xbd)]||_0x1598e1['summary']||'')[_0x325953(0x132)]();let _0x2046e2=![],_0x786404=[],_0x2045d7=_0x1598e1['event']||_0x1598e1[_0x325953(0xfe)]||'Unbekannt';if(_0x3e45f0[_0x325953(0x126)](_0x325953(0xb7))||_0x3e45f0[_0x325953(0x126)]('rÃ¼ckkehr')||_0x3e45f0['includes'](_0x325953(0x102)))_0x2046e2=!![],_0x786404=Array['from'](_0x1a831e);else for(const _0x4b6b15 of _0x1a831e){_0x3e45f0[_0x325953(0x126)](_0x4b6b15['toLowerCase']())&&_0x786404['push'](_0x4b6b15);}_0x786404[_0x325953(0xe7)]>0x0&&_0x786404[_0x325953(0x10c)](_0x14c0d3=>{const _0x5ee24c=_0x325953;let _0x58095e=0x3c;if(_0x2046e2){let _0x566db9=0x0;Object['values'](_0x5226c4)[_0x5ee24c(0x10c)](_0x24ccb2=>{if(_0x24ccb2>_0x566db9)_0x566db9=_0x24ccb2;}),_0x58095e=_0x566db9>0x0?_0x566db9:0x78;}else _0x58095e=_0x5226c4[_0x14c0d3]||0x3c;const _0x4a0ae0=new Date(_0x36c510-_0x58095e*0xea60);_0x284c44[_0x5ee24c(0xea)]({'eventTime':_0x36c510,'triggerTime':_0x4a0ae0[_0x5ee24c(0x12b)](),'room':_0x14c0d3,'minutes':_0x58095e,'reason':_0x2045d7,'isGlobal':_0x2046e2});});}}catch(_0x4df9e3){}_0x284c44[_0x325953(0xc4)]((_0x5ad92e,_0x4ff09b)=>_0x5ad92e[_0x325953(0x124)]-_0x4ff09b['triggerTime']);const _0x57caf1=_0x284c44[_0x325953(0x12e)](0x0,0x5);await _0x35351a[_0x325953(0xd8)](_0x325953(0x137),{'val':JSON[_0x325953(0xbc)](_0x57caf1),'ack':!![]});}async function checkCalendarTriggers(_0x59b4dc){const _0x5c3272=a1_0x41aeb6;if(!_0x59b4dc[_0x5c3272(0xcf)][_0x5c3272(0xdc)]||!_0x59b4dc[_0x5c3272(0xcf)][_0x5c3272(0x10e)])return;await updateSchedulePreview(_0x59b4dc);let _0x4457c7={};try{const _0x4a3ed8=await _0x59b4dc['getStateAsync'](_0x5c3272(0xab));if(_0x4a3ed8&&_0x4a3ed8[_0x5c3272(0xaf)])_0x4457c7=JSON['parse'](_0x4a3ed8[_0x5c3272(0xaf)]);}catch(_0xc8efe0){}let _0x3518ee={'default':0x15};try{const _0x1e131b=await _0x59b4dc[_0x5c3272(0xf4)](_0x5c3272(0xff));if(_0x1e131b&&_0x1e131b[_0x5c3272(0xaf)])_0x3518ee=JSON[_0x5c3272(0x12f)](_0x1e131b[_0x5c3272(0xaf)]);}catch(_0x1b3140){}try{const _0x294965=await _0x59b4dc[_0x5c3272(0xed)](_0x59b4dc['config'][_0x5c3272(0x10e)]+_0x5c3272(0xd5));if(!_0x294965||!_0x294965[_0x5c3272(0xaf)])return;const _0x4eb375=JSON[_0x5c3272(0x12f)](_0x294965[_0x5c3272(0xaf)]),_0x141e4a=Date[_0x5c3272(0xd2)](),_0x1a1c87=_0x59b4dc[_0x5c3272(0xcf)][_0x5c3272(0x114)]||[],_0x14c95a=_0x59b4dc['config'][_0x5c3272(0x139)]||[];for(const _0xa2f57e of _0x4eb375){if(_0xa2f57e['_calName']&&_0x14c95a[_0x5c3272(0xe7)]>0x0&&!_0x14c95a[_0x5c3272(0x126)](_0xa2f57e[_0x5c3272(0xc0)]))continue;const _0x1f2b99=_0xa2f57e[_0x5c3272(0xd3)]||_0xa2f57e[_0x5c3272(0xce)]||_0xa2f57e[_0x5c3272(0xa5)];if(!_0x1f2b99)continue;const _0x5028f3=new Date(_0x1f2b99);if(isNaN(_0x5028f3['getTime']()))continue;const _0x4d4ba6=(_0xa2f57e[_0x5c3272(0xbd)]||_0xa2f57e[_0x5c3272(0xfe)]||'')[_0x5c3272(0x132)]();if(_0x4d4ba6[_0x5c3272(0x126)](_0x5c3272(0xb7))||_0x4d4ba6[_0x5c3272(0x126)](_0x5c3272(0xa4))||_0x4d4ba6[_0x5c3272(0x126)](_0x5c3272(0x102))){let _0x55bd60=0x0;Object[_0x5c3272(0x133)](_0x4457c7)[_0x5c3272(0x10c)](_0x24382e=>{if(_0x24382e>_0x55bd60)_0x55bd60=_0x24382e;});if(_0x55bd60===0x0)_0x55bd60=0x78;const _0x4bd3b2=_0x5028f3['getTime']()-_0x55bd60*0xea60;_0x141e4a>=_0x4bd3b2&&_0x141e4a<_0x5028f3[_0x5c3272(0x12b)]()&&(_0x59b4dc[_0x5c3272(0x13c)]!==_0x5c3272(0xf9)&&(_0x59b4dc['log'][_0x5c3272(0xb1)]('ðŸ“…\x20SMART\x20SCHEDULE\x20(Phase):\x20\x27Globaler\x20Start\x27\x20erkannt\x20('+_0xa2f57e[_0x5c3272(0xbd)]+_0x5c3272(0x9d)+_0x55bd60+_0x5c3272(0xfb)),await _0x59b4dc[_0x5c3272(0xd8)](_0x5c3272(0x13b),{'val':_0x5c3272(0xf9),'ack':![]})));}for(const _0x582cd5 of _0x1a1c87){if(_0x582cd5[_0x5c3272(0x117)]){const _0x11c122=_0x582cd5['location']['toLowerCase']();if(_0x4d4ba6[_0x5c3272(0x126)](_0x11c122)){const _0x3d0164=_0x4457c7[_0x582cd5['location']]||0x3c,_0x526c6a=_0x5028f3[_0x5c3272(0x12b)]()-_0x3d0164*0xea60;if(_0x141e4a>=_0x526c6a&&_0x141e4a<_0x5028f3[_0x5c3272(0x12b)]()){const _0x53953b=lastActions[_0x5c3272(0x10d)+_0x582cd5[_0x5c3272(0x117)]];if(_0x53953b&&_0x141e4a-_0x53953b<CAL_COOLDOWN_MS)continue;const _0x4ad781=await findRelatedId(_0x59b4dc,_0x582cd5['id'],_0x5c3272(0x128));if(_0x4ad781){let _0x3fe6e4=_0x3518ee[_0x582cd5[_0x5c3272(0x117)]];if(_0x3fe6e4===undefined)_0x3fe6e4=_0x3518ee[_0x5c3272(0x100)];if(_0x3fe6e4===undefined)_0x3fe6e4=0x15;const _0x2bdd71=await _0x59b4dc[_0x5c3272(0xed)](_0x4ad781);_0x2bdd71&&typeof _0x2bdd71[_0x5c3272(0xaf)]===_0x5c3272(0xeb)&&_0x2bdd71[_0x5c3272(0xaf)]<_0x3fe6e4-0.5&&(_0x59b4dc[_0x5c3272(0x141)][_0x5c3272(0xb1)](_0x5c3272(0x116)+_0x582cd5['location']+_0x5c3272(0xb9)+_0xa2f57e[_0x5c3272(0xbd)]+_0x5c3272(0x109)+_0x3fe6e4+'Â°C\x20(Vorlauf:\x20'+_0x3d0164+_0x5c3272(0xfb)),await _0x59b4dc[_0x5c3272(0xca)](_0x4ad781,_0x3fe6e4),await logAutomationAction(_0x59b4dc,_0x5c3272(0xf8)+_0x582cd5[_0x5c3272(0x117)]+_0x5c3272(0xa9)+_0x3fe6e4+'Â°C'),lastActions[_0x5c3272(0x10d)+_0x582cd5[_0x5c3272(0x117)]]=_0x141e4a);}}}}}}}catch(_0x23fdc6){_0x59b4dc[_0x5c3272(0x141)][_0x5c3272(0xcb)]('Calendar\x20Check\x20Error:\x20'+_0x23fdc6[_0x5c3272(0xac)]);}}async function manageMpcIntervention(_0x372a13,_0x4f8d23,_0x3ee453){const _0x3d1e07=a1_0x41aeb6;try{const _0x22cc40=_0x3d1e07(0xe1),_0x4e8340=await _0x372a13[_0x3d1e07(0xf4)](_0x22cc40);let _0x41d110=[];if(_0x4e8340&&_0x4e8340[_0x3d1e07(0xaf)])try{_0x41d110=JSON[_0x3d1e07(0x12f)](_0x4e8340[_0x3d1e07(0xaf)]);}catch(_0x20fe44){}const _0x4175cf=_0x41d110[_0x3d1e07(0x135)](_0x4f8d23);if(_0x3ee453==='add')_0x4175cf===-0x1&&(_0x41d110[_0x3d1e07(0xea)](_0x4f8d23),await _0x372a13[_0x3d1e07(0xd8)](_0x22cc40,{'val':JSON[_0x3d1e07(0xbc)](_0x41d110),'ack':!![]}));else _0x3ee453==='remove'&&(_0x4175cf!==-0x1&&(_0x41d110['splice'](_0x4175cf,0x1),await _0x372a13[_0x3d1e07(0xd8)](_0x22cc40,{'val':JSON['stringify'](_0x41d110),'ack':!![]})));}catch(_0x2440a4){}}async function applyEnergySavings(_0x2c161e,_0x10dc6c){const _0x56d40f=a1_0x41aeb6;if(!_0x10dc6c||_0x10dc6c['length']===0x0)return;const _0x25016b=_0x2c161e[_0x56d40f(0xcf)][_0x56d40f(0x114)]||[],_0xe286=Date['now']();for(const _0x2c5163 of _0x10dc6c){const _0x1a4eeb=_0x2c5163['room'],_0x208f87=_0x2c5163[_0x56d40f(0xaa)],_0x2b8a56=_0x2c5163[_0x56d40f(0xc7)]||0x15,_0x5c4471=_0x25016b[_0x56d40f(0xf0)](_0x1fc98b=>normalize(_0x1fc98b['location'])===normalize(_0x1a4eeb)&&(_0x1fc98b[_0x56d40f(0xb2)]===_0x56d40f(0x111)||_0x1fc98b[_0x56d40f(0xb2)]===_0x56d40f(0xd4)));if(!_0x5c4471)continue;const _0x726536=await findRelatedId(_0x2c161e,_0x5c4471['id'],_0x56d40f(0x128));if(_0x726536){if(lastActions[_0x56d40f(0x11b)+_0x1a4eeb]&&_0xe286-lastActions[_0x56d40f(0x11b)+_0x1a4eeb]<0x1e*0x3c*0x3e8)continue;const _0x210d74=await _0x2c161e['getForeignStateAsync'](_0x726536);if(_0x210d74&&typeof _0x210d74['val']==='number'){const _0x2c5847=_0x210d74[_0x56d40f(0xaf)];_0x2c5847!==ECO_TEMP&&await manageMpcIntervention(_0x2c161e,_0x1a4eeb,_0x56d40f(0x110));if(_0x208f87>0x1e)_0x2c5847>ECO_TEMP+0.5&&(_0x2c161e['log']['info'](_0x56d40f(0xe4)+_0x1a4eeb+_0x56d40f(0x10a)+ECO_TEMP+_0x56d40f(0x9f)+_0x2c5847+_0x56d40f(0xdf)+_0x208f87+_0x56d40f(0xc1)+_0x726536),await _0x2c161e[_0x56d40f(0xca)](_0x726536,ECO_TEMP),await manageMpcIntervention(_0x2c161e,_0x1a4eeb,_0x56d40f(0x11f)),lastActions[_0x56d40f(0x11b)+_0x1a4eeb]=_0xe286,await logAutomationAction(_0x2c161e,'[MPC]\x20'+_0x1a4eeb+_0x56d40f(0xfa)+ECO_TEMP+'Â°C'));else _0x208f87<=0xf&&(_0x2c5847<_0x2b8a56&&(_0x2c161e['log']['info'](_0x56d40f(0x11a)+_0x1a4eeb+_0x56d40f(0x9e)+_0x2b8a56+_0x56d40f(0xba)+_0x726536),await _0x2c161e[_0x56d40f(0xca)](_0x726536,_0x2b8a56),await manageMpcIntervention(_0x2c161e,_0x1a4eeb,_0x56d40f(0x110)),lastActions['mpc_'+_0x1a4eeb]=_0xe286,await logAutomationAction(_0x2c161e,_0x56d40f(0x130)+_0x1a4eeb+':\x20Aufheizen\x20auf\x20'+_0x2b8a56+'Â°C')));}}else _0x2c161e[_0x56d40f(0x141)][_0x56d40f(0xcb)](_0x56d40f(0x119)+_0x1a4eeb+_0x56d40f(0xc3));}}module[a1_0x41aeb6(0xe5)]={'handlePrediction':handlePrediction,'applyEnergySavings':applyEnergySavings,'scanThermostats':scanThermostats,'checkCalendarTriggers':checkCalendarTriggers,'updateSchedulePreview':updateSchedulePreview};