const a1_0x25dced=a1_0x296c;(function(_0x49f3b8,_0x533eec){const _0x390a39=a1_0x296c,_0x428804=_0x49f3b8();while(!![]){try{const _0x51df86=-parseInt(_0x390a39(0x74))/0x1*(-parseInt(_0x390a39(0xf7))/0x2)+-parseInt(_0x390a39(0xd6))/0x3*(-parseInt(_0x390a39(0xe5))/0x4)+-parseInt(_0x390a39(0x75))/0x5+parseInt(_0x390a39(0xc0))/0x6*(parseInt(_0x390a39(0x8c))/0x7)+-parseInt(_0x390a39(0xa0))/0x8*(parseInt(_0x390a39(0x89))/0x9)+parseInt(_0x390a39(0xf0))/0xa+-parseInt(_0x390a39(0x6f))/0xb*(parseInt(_0x390a39(0x99))/0xc);if(_0x51df86===_0x533eec)break;else _0x428804['push'](_0x428804['shift']());}catch(_0x1e4125){_0x428804['push'](_0x428804['shift']());}}}(a1_0x4be2,0xed8b7));const a1_0x291df4=(function(){let _0x3cff7d=!![];return function(_0xa1d3da,_0xfca09c){const _0x54ebb6=_0x3cff7d?function(){const _0xeedcc5=a1_0x296c;if(_0xfca09c){const _0x5cb7ea=_0xfca09c[_0xeedcc5(0x7a)](_0xa1d3da,arguments);return _0xfca09c=null,_0x5cb7ea;}}:function(){};return _0x3cff7d=![],_0x54ebb6;};}()),a1_0x560ba3=a1_0x291df4(this,function(){const _0x17bb62=a1_0x296c;return a1_0x560ba3[_0x17bb62(0xe1)]()[_0x17bb62(0x88)](_0x17bb62(0x102))[_0x17bb62(0xe1)]()[_0x17bb62(0xc5)](a1_0x560ba3)[_0x17bb62(0x88)](_0x17bb62(0x102));});a1_0x560ba3();'use strict';const aiAgent=require('./ai_agent'),COOLDOWN_MS=0x3c*0x3e8,CAL_COOLDOWN_MS=0x5a*0x3c*0x3e8,ECO_TEMP=0x11,lastActions={};function a1_0x296c(_0x566709,_0x2dad30){const _0x976ad0=a1_0x4be2();return a1_0x296c=function(_0x560ba3,_0x291df4){_0x560ba3=_0x560ba3-0x68;let _0x4be2ab=_0x976ad0[_0x560ba3];return _0x4be2ab;},a1_0x296c(_0x566709,_0x2dad30);}function normalize(_0x5f5f1){const _0x253bf9=a1_0x296c;if(!_0x5f5f1)return'';return _0x5f5f1[_0x253bf9(0x8f)]()[_0x253bf9(0xbe)](/\s+/g,'')[_0x253bf9(0xaa)]();}async function handlePrediction(_0x50a8e3,_0x3c8f8b,_0x4ebfd7){const _0x5aaa89=a1_0x296c;if(!_0x3c8f8b||_0x3c8f8b===_0x5aaa89(0x91))return;let _0x14fbbe='off',_0x368a80=0.6;try{const _0x1d2e59=await _0x50a8e3[_0x5aaa89(0x85)](_0x5aaa89(0xcf));if(_0x1d2e59&&_0x1d2e59['val'])_0x14fbbe=_0x1d2e59[_0x5aaa89(0x80)];const _0x10bbc3=await _0x50a8e3[_0x5aaa89(0x85)](_0x5aaa89(0x79));if(_0x10bbc3&&_0x10bbc3[_0x5aaa89(0x80)])_0x368a80=_0x10bbc3[_0x5aaa89(0x80)];}catch(_0x135356){}if(_0x14fbbe===_0x5aaa89(0x8d)||_0x4ebfd7<_0x368a80)return;const _0x5a6a6a=Date[_0x5aaa89(0xb1)]();if(lastActions[_0x3c8f8b]&&_0x5a6a6a-lastActions[_0x3c8f8b]<COOLDOWN_MS)return;const _0xd9e8f0=_0x50a8e3[_0x5aaa89(0xa4)][_0x5aaa89(0xbf)]||[],_0x5f1d02=normalize(_0x3c8f8b),_0x13246b=_0xd9e8f0[_0x5aaa89(0x8a)](_0x43ee02=>normalize(_0x43ee02[_0x5aaa89(0xbd)])===_0x5f1d02&&(_0x43ee02[_0x5aaa89(0x9b)]===_0x5aaa89(0x7f)||_0x43ee02['type']===_0x5aaa89(0xbb)||_0x43ee02[_0x5aaa89(0x9b)]===_0x5aaa89(0xd3)));if(!_0x13246b)return;const _0x7ec8de=await aiAgent[_0x5aaa89(0x77)](_0x50a8e3,_0x3c8f8b,_0x13246b[_0x5aaa89(0xd5)],_0x4ebfd7);if(!_0x7ec8de[_0x5aaa89(0xca)])return;const _0x30dffb=_0x5aaa89(0x72)+_0x3c8f8b+'\x20->\x20Schalte\x20'+_0x13246b[_0x5aaa89(0xd5)]+'\x20('+_0x7ec8de['reason']+')';await _0x50a8e3['setStateAsync']('analysis.automation.lastAction',{'val':'['+_0x14fbbe['toUpperCase']()+']\x20'+_0x30dffb,'ack':!![]});if(_0x14fbbe==='active'){const _0x3829c0=await _0x50a8e3[_0x5aaa89(0xd7)](_0x13246b['id']);(!_0x3829c0||!_0x3829c0['val']&&_0x3829c0['val']!==!![])&&await _0x50a8e3[_0x5aaa89(0xfb)](_0x13246b['id'],!![]),lastActions[_0x3c8f8b]=_0x5a6a6a;}}async function findRelatedId(_0x23042a,_0x3573aa,_0x56c79e=a1_0x25dced(0x6a)){const _0x103cea=a1_0x25dced;if(_0x56c79e===_0x103cea(0x6a)&&_0x23042a[_0x103cea(0xa4)][_0x103cea(0xfc)]){let _0xb481c9=_0x23042a[_0x103cea(0xa4)][_0x103cea(0xfc)];if(typeof _0xb481c9==='string')try{_0xb481c9=JSON[_0x103cea(0xed)](_0xb481c9);}catch(_0x234c72){}if(_0xb481c9&&_0xb481c9[_0x3573aa])return _0xb481c9[_0x3573aa];}if(_0x56c79e===_0x103cea(0x6b)&&_0x23042a['config']['valveMapping']){let _0x3f70af=_0x23042a[_0x103cea(0xa4)][_0x103cea(0xf6)];if(typeof _0x3f70af===_0x103cea(0xda))try{_0x3f70af=JSON[_0x103cea(0xed)](_0x3f70af);}catch(_0x3beb73){}if(_0x3f70af&&_0x3f70af[_0x3573aa])return _0x3f70af[_0x3573aa];}let _0x4d1e2c=[];if(_0x56c79e===_0x103cea(0x6a))_0x4d1e2c=[{'s':_0x103cea(0xec),'t':_0x103cea(0xac)},{'s':'.1.TEMPERATURE','t':_0x103cea(0xac)},{'s':'.1.TEMPERATURE','t':'.4.SET_TEMPERATURE'},{'s':_0x103cea(0xd9),'t':_0x103cea(0x9f)},{'s':'local_temperature','t':_0x103cea(0x87)},{'s':_0x103cea(0xef),'t':_0x103cea(0x7b)},{'s':'temperature','t':'target_temperature'},{'s':'ACTUAL','t':_0x103cea(0x95)},{'s':_0x103cea(0xdb),'t':_0x103cea(0x9a)},{'s':_0x103cea(0x82),'t':_0x103cea(0x6a)}];else _0x56c79e==='valve'&&(_0x4d1e2c=[{'s':_0x103cea(0xec),'t':_0x103cea(0xc2)},{'s':_0x103cea(0xae),'t':_0x103cea(0xc2)},{'s':'.1.TEMPERATURE','t':_0x103cea(0x92)},{'s':_0x103cea(0xef),'t':_0x103cea(0xa6)},{'s':_0x103cea(0x82),'t':'valve_position'},{'s':_0x103cea(0x82),'t':'level'}]);for(const _0x4434d9 of _0x4d1e2c){if(_0x3573aa[_0x103cea(0xbc)](_0x4434d9['s'])){const _0x54e63b=_0x3573aa[_0x103cea(0xbe)](_0x4434d9['s'],_0x4434d9['t']),_0x1fc311=await _0x23042a[_0x103cea(0xcd)](_0x54e63b);if(_0x1fc311)return _0x54e63b;}}try{const _0x2708c0=_0x3573aa[_0x103cea(0xe9)]('.');if(_0x2708c0[_0x103cea(0xa2)]>0x2){const _0x5a0223=_0x2708c0[_0x103cea(0xba)](0x0,-0x1)['join']('.'),_0x1ffa5a=await _0x23042a[_0x103cea(0x96)](_0x5a0223+'.*'),_0x4a0e52=[],_0x84b470=_0x3573aa[_0x103cea(0xe9)](/[._]+/)[_0x103cea(0xfe)](_0x140031=>![_0x103cea(0xb9),'0',_0x103cea(0xe3),_0x103cea(0xaf),_0x103cea(0xa8),'temperature',_0x103cea(0xee),'sensor',_0x103cea(0x94),_0x103cea(0xf4)][_0x103cea(0xbc)](_0x140031[_0x103cea(0x8f)]()));for(const [_0x223fbf,_0x283689]of Object[_0x103cea(0xe8)](_0x1ffa5a)){if(_0x223fbf===_0x3573aa)continue;if(_0x283689&&_0x283689[_0x103cea(0x6d)]){const _0x5c2a2=_0x223fbf[_0x103cea(0x8f)](),_0x4acfa9=(_0x283689['common'][_0x103cea(0xf9)]||'')[_0x103cea(0x8f)](),_0x1ef769=(_0x283689[_0x103cea(0x6d)][_0x103cea(0xb2)]||'')['toLowerCase']();let _0x439904=![];if(_0x56c79e===_0x103cea(0x6a)&&_0x283689[_0x103cea(0x6d)][_0x103cea(0xfd)]===!![])_0x439904=_0x5c2a2[_0x103cea(0xbc)](_0x103cea(0x86))||_0x5c2a2[_0x103cea(0xbc)](_0x103cea(0x69))||_0x5c2a2[_0x103cea(0xbc)](_0x103cea(0xd2))||_0x4acfa9[_0x103cea(0xbc)](_0x103cea(0x70))||_0x4acfa9[_0x103cea(0xbc)](_0x103cea(0x83));else _0x56c79e==='valve'&&(_0x439904=_0x5c2a2['includes'](_0x103cea(0x8e))||_0x5c2a2['includes'](_0x103cea(0x6b))||_0x5c2a2[_0x103cea(0xbc)](_0x103cea(0xb4))||_0x5c2a2[_0x103cea(0xbc)](_0x103cea(0xce))||_0x4acfa9[_0x103cea(0xbc)]('level.valve')||_0x4acfa9['includes']('value.valve')||_0x1ef769['includes']('%'));if(_0x439904){const _0x4c7646=_0x223fbf[_0x103cea(0xe9)](/[._]+/)[_0x103cea(0xde)](_0x1077b0=>_0x1077b0[_0x103cea(0x8f)]());let _0x123a29=0x0;_0x84b470[_0x103cea(0xc6)](_0xab2b19=>{if(_0x4c7646['includes'](_0xab2b19['toLowerCase']()))_0x123a29++;}),_0x4a0e52[_0x103cea(0xb3)]({'id':_0x223fbf,'score':_0x123a29});}}}if(_0x4a0e52['length']>0x0){_0x4a0e52[_0x103cea(0x9c)]((_0x2f0841,_0x1b094c)=>_0x1b094c[_0x103cea(0xff)]-_0x2f0841['score']);if(_0x4a0e52[0x0][_0x103cea(0xff)]>0x0)return _0x4a0e52[0x0]['id'];}}}catch(_0x28a5c0){}return null;}async function scanThermostats(_0x5d4e08){const _0x1ff019=a1_0x25dced,_0x320f74=_0x5d4e08[_0x1ff019(0xa4)][_0x1ff019(0xbf)]||[],_0x3cf491=[],_0x4fb49a=_0x320f74[_0x1ff019(0xfe)](_0x46bf48=>_0x46bf48['id']&&_0x46bf48['id'][_0x1ff019(0xbc)](_0x1ff019(0x82))||_0x46bf48[_0x1ff019(0x9b)]&&[_0x1ff019(0x82),_0x1ff019(0x93),_0x1ff019(0x76)][_0x1ff019(0xbc)](_0x46bf48['type'])||_0x46bf48[_0x1ff019(0xd5)]&&_0x46bf48['name'][_0x1ff019(0x8f)]()[_0x1ff019(0xbc)](_0x1ff019(0x68)));for(const _0x538b7e of _0x4fb49a){const _0x4a5b63=await findRelatedId(_0x5d4e08,_0x538b7e['id'],_0x1ff019(0x6a)),_0x168270=await findRelatedId(_0x5d4e08,_0x538b7e['id'],_0x1ff019(0x6b));let _0x334a88=_0x1ff019(0xb5),_0x474b4c=![],_0x3ee826=_0x5d4e08[_0x1ff019(0xa4)]['thermostatMapping']||{};if(typeof _0x3ee826===_0x1ff019(0xda))try{_0x3ee826=JSON[_0x1ff019(0xed)](_0x3ee826);}catch(_0x5e499a){}let _0x2ec2f2=_0x5d4e08['config'][_0x1ff019(0xf6)]||{};if(typeof _0x2ec2f2==='string')try{_0x2ec2f2=JSON[_0x1ff019(0xed)](_0x2ec2f2);}catch(_0x291fba){}if(_0x3ee826[_0x538b7e['id']]&&_0x3ee826[_0x538b7e['id']]===_0x4a5b63||_0x2ec2f2[_0x538b7e['id']]&&_0x2ec2f2[_0x538b7e['id']]===_0x168270)_0x334a88='Manuelles\x20Mapping',_0x474b4c=!![];else(_0x4a5b63||_0x168270)&&(_0x334a88=_0x1ff019(0xdd));_0x3cf491['push']({'room':_0x538b7e[_0x1ff019(0xbd)]||_0x1ff019(0x90),'sensorId':_0x538b7e['id'],'setpointId':_0x4a5b63||'-','valveId':_0x168270||'-','source':_0x334a88,'isManual':_0x474b4c,'status':_0x4a5b63&&_0x168270?_0x1ff019(0xeb):_0x4a5b63?'OK':_0x1ff019(0x7c)});}return _0x3cf491['sort']((_0x349414,_0x1f5d81)=>_0x349414[_0x1ff019(0xcc)][_0x1ff019(0xab)](_0x1f5d81[_0x1ff019(0xcc)]));}async function updateSchedulePreview(_0x545ef9){const _0x307383=a1_0x25dced;if(!_0x545ef9[_0x307383(0xa4)][_0x307383(0xd1)]||!_0x545ef9[_0x307383(0xa4)][_0x307383(0x98)])return;let _0x2bc79d={};try{const _0x4ebfda=await _0x545ef9[_0x307383(0x85)]('analysis.energy.warmupTimes');if(_0x4ebfda&&_0x4ebfda[_0x307383(0x80)])_0x2bc79d=JSON['parse'](_0x4ebfda[_0x307383(0x80)]);}catch(_0x501fc8){}const _0x14b29c=[],_0xb92fe1=Date[_0x307383(0xb1)](),_0x482262=0x30*0x3c*0x3c*0x3e8;try{const _0x23db90=await _0x545ef9[_0x307383(0xd7)](_0x545ef9['config'][_0x307383(0x98)]+_0x307383(0xc1));if(!_0x23db90||!_0x23db90[_0x307383(0x80)])return;const _0x4aef40=JSON[_0x307383(0xed)](_0x23db90[_0x307383(0x80)]),_0x3061ac=_0x545ef9[_0x307383(0xa4)][_0x307383(0xdc)]||[],_0x1be641=_0x545ef9['config'][_0x307383(0xbf)]||[],_0x4792a3=new Set();_0x1be641[_0x307383(0xc6)](_0x56789d=>{const _0x5c9285=_0x307383;if(_0x56789d['location'])_0x4792a3[_0x5c9285(0xb7)](_0x56789d[_0x5c9285(0xbd)]);});for(const _0x2ee75f of _0x4aef40){if(_0x2ee75f[_0x307383(0x101)]&&_0x3061ac[_0x307383(0xa2)]>0x0&&!_0x3061ac[_0x307383(0xbc)](_0x2ee75f['_calName']))continue;const _0x472ad5=_0x2ee75f[_0x307383(0xa7)]||_0x2ee75f[_0x307383(0x73)]||_0x2ee75f['date'];if(!_0x472ad5)continue;const _0x335f45=new Date(_0x472ad5),_0x487e62=_0x335f45[_0x307383(0xa5)]();if(isNaN(_0x487e62))continue;if(_0x487e62<_0xb92fe1)continue;if(_0x487e62>_0xb92fe1+_0x482262)continue;const _0x48d151=(_0x2ee75f[_0x307383(0xc7)]||_0x2ee75f[_0x307383(0xb8)]||'')[_0x307383(0x8f)]();let _0x5231e2=![],_0x373462=[],_0x2a6d27=_0x2ee75f[_0x307383(0xc7)]||_0x2ee75f[_0x307383(0xb8)]||_0x307383(0x90);if(_0x48d151['includes']('urlaub\x20ende')||_0x48d151['includes'](_0x307383(0xb6))||_0x48d151[_0x307383(0xbc)](_0x307383(0x7d)))_0x5231e2=!![],_0x373462=Array['from'](_0x4792a3);else for(const _0x151ae2 of _0x4792a3){_0x48d151[_0x307383(0xbc)](_0x151ae2[_0x307383(0x8f)]())&&_0x373462[_0x307383(0xb3)](_0x151ae2);}_0x373462[_0x307383(0xa2)]>0x0&&_0x373462[_0x307383(0xc6)](_0x4834e3=>{const _0x30d264=_0x307383;let _0xa1193d=0x3c;if(_0x5231e2){let _0xf516eb=0x0;Object['values'](_0x2bc79d)[_0x30d264(0xc6)](_0x536dc2=>{if(_0x536dc2>_0xf516eb)_0xf516eb=_0x536dc2;}),_0xa1193d=_0xf516eb>0x0?_0xf516eb:0x78;}else _0xa1193d=_0x2bc79d[_0x4834e3]||0x3c;const _0x30eaa9=new Date(_0x487e62-_0xa1193d*0xea60);_0x14b29c[_0x30d264(0xb3)]({'eventTime':_0x487e62,'triggerTime':_0x30eaa9[_0x30d264(0xa5)](),'room':_0x4834e3,'minutes':_0xa1193d,'reason':_0x2a6d27,'isGlobal':_0x5231e2});});}}catch(_0x5ea61f){}_0x14b29c[_0x307383(0x9c)]((_0x543d2f,_0x21b2d8)=>_0x543d2f[_0x307383(0xd4)]-_0x21b2d8[_0x307383(0xd4)]);const _0x2ec666=_0x14b29c['slice'](0x0,0x5);await _0x545ef9[_0x307383(0xe2)](_0x307383(0x71),{'val':JSON[_0x307383(0xf8)](_0x2ec666),'ack':!![]});}async function checkCalendarTriggers(_0x2daa2b){const _0x5a7683=a1_0x25dced;if(!_0x2daa2b[_0x5a7683(0xa4)][_0x5a7683(0xd1)]||!_0x2daa2b[_0x5a7683(0xa4)][_0x5a7683(0x98)])return;await updateSchedulePreview(_0x2daa2b);let _0x5d2fde={};try{const _0x9df54a=await _0x2daa2b[_0x5a7683(0x85)](_0x5a7683(0xad));if(_0x9df54a&&_0x9df54a[_0x5a7683(0x80)])_0x5d2fde=JSON['parse'](_0x9df54a[_0x5a7683(0x80)]);}catch(_0x35e63f){}let _0x158a39={'default':0x15};try{const _0xfe453d=await _0x2daa2b[_0x5a7683(0x85)]('analysis.energy.warmupTargets');if(_0xfe453d&&_0xfe453d[_0x5a7683(0x80)])_0x158a39=JSON['parse'](_0xfe453d[_0x5a7683(0x80)]);}catch(_0x5268ff){}try{const _0x2f393b=await _0x2daa2b[_0x5a7683(0xd7)](_0x2daa2b[_0x5a7683(0xa4)]['calendarInstance']+_0x5a7683(0xc1));if(!_0x2f393b||!_0x2f393b['val'])return;const _0x194c96=JSON['parse'](_0x2f393b[_0x5a7683(0x80)]),_0x156920=Date[_0x5a7683(0xb1)](),_0xea041a=_0x2daa2b[_0x5a7683(0xa4)]['devices']||[],_0x2491d7=_0x2daa2b['config']['calendarSelection']||[];for(const _0x468c1b of _0x194c96){if(_0x468c1b['_calName']&&_0x2491d7[_0x5a7683(0xa2)]>0x0&&!_0x2491d7['includes'](_0x468c1b['_calName']))continue;const _0x6b13d2=_0x468c1b['_date']||_0x468c1b['eventStart']||_0x468c1b['date'];if(!_0x6b13d2)continue;const _0x34c4d7=new Date(_0x6b13d2);if(isNaN(_0x34c4d7['getTime']()))continue;const _0x1da858=(_0x468c1b[_0x5a7683(0xc7)]||_0x468c1b['summary']||'')[_0x5a7683(0x8f)]();if(_0x1da858[_0x5a7683(0xbc)](_0x5a7683(0xc8))||_0x1da858[_0x5a7683(0xbc)](_0x5a7683(0xb6))||_0x1da858[_0x5a7683(0xbc)]('ankunft')){let _0x11578c=0x0;Object[_0x5a7683(0x6c)](_0x5d2fde)[_0x5a7683(0xc6)](_0x1930b2=>{if(_0x1930b2>_0x11578c)_0x11578c=_0x1930b2;});if(_0x11578c===0x0)_0x11578c=0x78;const _0x4b6e3c=_0x34c4d7['getTime']()-_0x11578c*0xea60;_0x156920>=_0x4b6e3c&&_0x156920<_0x34c4d7[_0x5a7683(0xa5)]()&&(_0x2daa2b['currentSystemMode']!==_0x5a7683(0xdf)&&(_0x2daa2b[_0x5a7683(0xc3)][_0x5a7683(0x100)](_0x5a7683(0xb0)+_0x468c1b[_0x5a7683(0xc7)]+_0x5a7683(0xc9)+_0x11578c+_0x5a7683(0xa1)),await _0x2daa2b[_0x5a7683(0xe2)](_0x5a7683(0x7e),{'val':'normal','ack':![]})));}for(const _0x5a73d3 of _0xea041a){if(_0x5a73d3[_0x5a7683(0xbd)]){const _0x1df039=_0x5a73d3[_0x5a7683(0xbd)]['toLowerCase']();if(_0x1da858[_0x5a7683(0xbc)](_0x1df039)){const _0x4abc91=_0x5d2fde[_0x5a73d3[_0x5a7683(0xbd)]]||0x3c,_0x345eb6=_0x34c4d7['getTime']()-_0x4abc91*0xea60;if(_0x156920>=_0x345eb6&&_0x156920<_0x34c4d7[_0x5a7683(0xa5)]()){const _0x3af426=lastActions['cal_'+_0x5a73d3['location']];if(_0x3af426&&_0x156920-_0x3af426<CAL_COOLDOWN_MS)continue;const _0x41602a=await findRelatedId(_0x2daa2b,_0x5a73d3['id'],_0x5a7683(0x6a));if(_0x41602a){let _0xc2c9cd=_0x158a39[_0x5a73d3['location']];if(_0xc2c9cd===undefined)_0xc2c9cd=_0x158a39[_0x5a7683(0xa9)];if(_0xc2c9cd===undefined)_0xc2c9cd=0x15;const _0x57b69d=await _0x2daa2b[_0x5a7683(0xd7)](_0x41602a);_0x57b69d&&typeof _0x57b69d[_0x5a7683(0x80)]===_0x5a7683(0xfa)&&_0x57b69d[_0x5a7683(0x80)]<_0xc2c9cd-0.5&&(_0x2daa2b[_0x5a7683(0xc3)][_0x5a7683(0x100)](_0x5a7683(0xf5)+_0x5a73d3[_0x5a7683(0xbd)]+'\x27\x20aktiv\x20('+_0x468c1b[_0x5a7683(0xc7)]+_0x5a7683(0xc4)+_0xc2c9cd+'Â°C\x20(Vorlauf:\x20'+_0x4abc91+_0x5a7683(0xa1)),await _0x2daa2b[_0x5a7683(0xfb)](_0x41602a,_0xc2c9cd),await _0x2daa2b[_0x5a7683(0xe2)]('analysis.automation.lastAction',{'val':'[CAL]\x20'+_0x5a73d3[_0x5a7683(0xbd)]+_0x5a7683(0xa3)+_0xc2c9cd+'Â°C','ack':!![]}),lastActions['cal_'+_0x5a73d3[_0x5a7683(0xbd)]]=_0x156920);}}}}}}}catch(_0x4368f5){_0x2daa2b[_0x5a7683(0xc3)]['warn'](_0x5a7683(0xe4)+_0x4368f5[_0x5a7683(0xd8)]);}}async function manageMpcIntervention(_0x535ec5,_0x52fbfb,_0x3f6095){const _0x59564a=a1_0x25dced;try{const _0x10b49f=_0x59564a(0xf3),_0x123478=await _0x535ec5[_0x59564a(0x85)](_0x10b49f);let _0x5ac362=[];if(_0x123478&&_0x123478[_0x59564a(0x80)])try{_0x5ac362=JSON[_0x59564a(0xed)](_0x123478[_0x59564a(0x80)]);}catch(_0x27c8a7){}const _0x2c8ea5=_0x5ac362[_0x59564a(0x97)](_0x52fbfb);if(_0x3f6095===_0x59564a(0xb7))_0x2c8ea5===-0x1&&(_0x5ac362[_0x59564a(0xb3)](_0x52fbfb),await _0x535ec5[_0x59564a(0xe2)](_0x10b49f,{'val':JSON[_0x59564a(0xf8)](_0x5ac362),'ack':!![]}));else _0x3f6095==='remove'&&(_0x2c8ea5!==-0x1&&(_0x5ac362[_0x59564a(0xf1)](_0x2c8ea5,0x1),await _0x535ec5[_0x59564a(0xe2)](_0x10b49f,{'val':JSON['stringify'](_0x5ac362),'ack':!![]})));}catch(_0x1eb97b){}}async function applyEnergySavings(_0x303b96,_0x543449){const _0xe1fd63=a1_0x25dced;if(!_0x543449||_0x543449[_0xe1fd63(0xa2)]===0x0)return;const _0x53a830=_0x303b96[_0xe1fd63(0xa4)]['devices']||[],_0x158d55=Date[_0xe1fd63(0xb1)]();for(const _0x4bf224 of _0x543449){const _0x4642d0=_0x4bf224[_0xe1fd63(0xcc)],_0x5146e8=_0x4bf224['minutes_safe'],_0x1a8508=_0x4bf224[_0xe1fd63(0xd2)]||0x15,_0x1d9dec=_0x53a830[_0xe1fd63(0x8a)](_0x1b1009=>normalize(_0x1b1009[_0xe1fd63(0xbd)])===normalize(_0x4642d0)&&(_0x1b1009['type']===_0xe1fd63(0x82)||_0x1b1009[_0xe1fd63(0x9b)]===_0xe1fd63(0x93)));if(!_0x1d9dec)continue;const _0x18ea19=await findRelatedId(_0x303b96,_0x1d9dec['id'],_0xe1fd63(0x6a));if(_0x18ea19){if(lastActions['mpc_'+_0x4642d0]&&_0x158d55-lastActions[_0xe1fd63(0xe0)+_0x4642d0]<0x1e*0x3c*0x3e8)continue;const _0x3c4819=await _0x303b96[_0xe1fd63(0xd7)](_0x18ea19);if(_0x3c4819&&typeof _0x3c4819[_0xe1fd63(0x80)]===_0xe1fd63(0xfa)){const _0x297ed6=_0x3c4819[_0xe1fd63(0x80)];_0x297ed6!==ECO_TEMP&&await manageMpcIntervention(_0x303b96,_0x4642d0,'remove');if(_0x5146e8>0x1e)_0x297ed6>ECO_TEMP+0.5&&(_0x303b96[_0xe1fd63(0xc3)]['info'](_0xe1fd63(0x84)+_0x4642d0+'\x20auf\x20'+ECO_TEMP+_0xe1fd63(0x103)+_0x297ed6+_0xe1fd63(0xe7)+_0x5146e8+_0xe1fd63(0xf2)+_0x18ea19),await _0x303b96[_0xe1fd63(0xfb)](_0x18ea19,ECO_TEMP),await manageMpcIntervention(_0x303b96,_0x4642d0,'add'),lastActions[_0xe1fd63(0xe0)+_0x4642d0]=_0x158d55,await _0x303b96[_0xe1fd63(0xe2)](_0xe1fd63(0x9e),{'val':_0xe1fd63(0xea)+_0x4642d0+':\x20Absenkung\x20auf\x20'+ECO_TEMP+'Â°C','ack':!![]}));else _0x5146e8<=0xf&&(_0x297ed6<_0x1a8508&&(_0x303b96[_0xe1fd63(0xc3)][_0xe1fd63(0x100)](_0xe1fd63(0xe6)+_0x4642d0+_0xe1fd63(0x9d)+_0x1a8508+_0xe1fd63(0x78)+_0x18ea19),await _0x303b96['setForeignStateAsync'](_0x18ea19,_0x1a8508),await manageMpcIntervention(_0x303b96,_0x4642d0,_0xe1fd63(0xd0)),lastActions['mpc_'+_0x4642d0]=_0x158d55,await _0x303b96['setStateAsync'](_0xe1fd63(0x9e),{'val':_0xe1fd63(0xea)+_0x4642d0+_0xe1fd63(0x6e)+_0x1a8508+'Â°C','ack':!![]})));}}else _0x303b96[_0xe1fd63(0xc3)][_0xe1fd63(0x8b)](_0xe1fd63(0x81)+_0x4642d0+'\x20gefunden!\x20Bitte\x20\x27System\x27\x20Tab\x20prÃ¼fen.');}}module[a1_0x25dced(0xcb)]={'handlePrediction':handlePrediction,'applyEnergySavings':applyEnergySavings,'scanThermostats':scanThermostats,'checkCalendarTriggers':checkCalendarTriggers,'updateSchedulePreview':updateSchedulePreview};function a1_0x4be2(){const _0x3edc4c=['constructor','forEach','event','urlaub\x20ende',').\x20Heize\x20ganzes\x20Haus\x20auf\x20(Vorlauf:\x20','approved','exports','room','getForeignObjectAsync','position','analysis.automation.mode','remove','useCalendar','target','switch','triggerTime','name','123129yqUcUm','getForeignStateAsync','message','ACTUAL_TEMPERATURE','string','Ist','calendarSelection','Auto-Erkennung','map','normal','mpc_','toString','setStateAsync','hm-rpc','Calendar\x20Check\x20Error:\x20','48wiqdmC','ðŸ”¥\x20[MPC\x20ACTION]\x20Heize\x20','Â°C,\x20Puffer:\x20','entries','split','[MPC]\x20','PERFECT','.1.ACTUAL_TEMPERATURE','parse','actual','local_temperature','6113690LVUikD','splice','\x20min)\x20->\x20ID:\x20','analysis.energy.mpcActiveInterventions','state','ðŸ“…\x20SMART\x20SCHEDULE\x20(Catch-Up):\x20Raum-Trigger\x20\x27','valveMapping','3804442gnuwrw','stringify','role','number','setForeignStateAsync','thermostatMapping','write','filter','score','info','_calName','(((.+)+)+)+$','Â°C!\x20(Aktuell:\x20','temp','soll','setpoint','valve','values','common',':\x20Aufheizen\x20auf\x20','4367schVSM','level.temperature','analysis.energy.schedulePreview','PrÃ¤diktion:\x20','eventStart','1ynnMfG','1423135nsFiyH','sensor','consultButler','Â°C!\x20(Puffer\x20leer).\x20->\x20ID:\x20','analysis.automation.confidenceThreshold','apply','current_heating_setpoint','Fehlt','ankunft','system.mode','light','val','[MPC\x20WARNING]\x20Kein\x20Setpoint\x20(Soll-Temp)\x20fÃ¼r\x20','temperature','thermostat.setpoint','ðŸƒ\x20[MPC\x20ACTION]\x20Senke\x20','getStateAsync','set','occupied_heating_setpoint','search','36YiIAbY','find','warn','12508244DxcXEV','off','level','toLowerCase','Unbekannt','Unknown','.4.VALVE_STATE','thermostat','messwert','SET','getForeignObjectsAsync','indexOf','calendarInstance','73152zEAsbJ','Soll','type','sort','\x20wieder\x20auf\x20','analysis.automation.lastAction','SET_POINT_TEMPERATURE','2230552haGlzH','\x20min).','length','\x20->\x20','config','getTime','pi_heating_demand','_date','wert','default','trim','localeCompare','.1.SET_POINT_TEMPERATURE','analysis.energy.warmupTimes','.1.TEMPERATURE','ist','ðŸ“…\x20SMART\x20SCHEDULE\x20(Phase):\x20\x27Globaler\x20Start\x27\x20erkannt\x20(','now','unit','push','stellwert','Nicht\x20gefunden','rÃ¼ckkehr','add','summary','openknx','slice','dimmer','includes','location','replace','devices','6nKXQnx','.data.table','.1.LEVEL','log',').\x20Heize\x20auf\x20'];a1_0x4be2=function(){return _0x3edc4c;};return a1_0x4be2();}