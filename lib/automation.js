const a1_0x44b10d=a1_0x1778;(function(_0x4fba87,_0x4c82fb){const _0x230e67=a1_0x1778,_0x1d18e1=_0x4fba87();while(!![]){try{const _0x20a3df=parseInt(_0x230e67(0x12c))/0x1*(-parseInt(_0x230e67(0x126))/0x2)+-parseInt(_0x230e67(0x149))/0x3*(-parseInt(_0x230e67(0x15a))/0x4)+parseInt(_0x230e67(0x148))/0x5*(-parseInt(_0x230e67(0x17a))/0x6)+parseInt(_0x230e67(0x125))/0x7+-parseInt(_0x230e67(0x12e))/0x8+parseInt(_0x230e67(0x175))/0x9*(-parseInt(_0x230e67(0x152))/0xa)+parseInt(_0x230e67(0x139))/0xb;if(_0x20a3df===_0x4c82fb)break;else _0x1d18e1['push'](_0x1d18e1['shift']());}catch(_0x188279){_0x1d18e1['push'](_0x1d18e1['shift']());}}}(a1_0x553b,0xcb6c8));const a1_0x4af7c6=(function(){let _0x1d24ca=!![];return function(_0x1dfce1,_0x4031e4){const _0xeb20d3=_0x1d24ca?function(){const _0x1f3f56=a1_0x1778;if(_0x4031e4){const _0x24c871=_0x4031e4[_0x1f3f56(0x168)](_0x1dfce1,arguments);return _0x4031e4=null,_0x24c871;}}:function(){};return _0x1d24ca=![],_0xeb20d3;};}()),a1_0x693b04=a1_0x4af7c6(this,function(){const _0xd25d32=a1_0x1778;return a1_0x693b04['toString']()['search'](_0xd25d32(0x160))['toString']()[_0xd25d32(0x15d)](a1_0x693b04)[_0xd25d32(0x159)](_0xd25d32(0x160));});a1_0x693b04();'use strict';const aiAgent=require(a1_0x44b10d(0x11f)),COOLDOWN_MS=0x3c*0x3e8,lastActions={};function normalize(_0x3cb1ff){const _0xbb1b0e=a1_0x44b10d;if(!_0x3cb1ff)return'';return _0x3cb1ff[_0xbb1b0e(0x114)]()[_0xbb1b0e(0x15e)](/\s+/g,'')['trim']();}async function handlePrediction(_0x3a01e7,_0x4e6a92,_0x532196){const _0x4503ed=a1_0x44b10d;if(!_0x4e6a92||_0x4e6a92===_0x4503ed(0x178))return;let _0x29a52d=_0x4503ed(0x129),_0xe74619=0.6;try{const _0x3aea19=await _0x3a01e7[_0x4503ed(0x144)](_0x4503ed(0x171));if(_0x3aea19&&_0x3aea19[_0x4503ed(0x16a)])_0x29a52d=_0x3aea19[_0x4503ed(0x16a)];const _0x3c4c83=await _0x3a01e7[_0x4503ed(0x144)]('analysis.automation.confidenceThreshold');if(_0x3c4c83&&_0x3c4c83[_0x4503ed(0x16a)])_0xe74619=_0x3c4c83[_0x4503ed(0x16a)];}catch(_0x398a2c){}if(_0x29a52d===_0x4503ed(0x129)||_0x532196<_0xe74619)return;const _0x3b3369=Date[_0x4503ed(0x153)]();if(lastActions[_0x4e6a92]&&_0x3b3369-lastActions[_0x4e6a92]<COOLDOWN_MS)return;const _0x541e62=_0x3a01e7[_0x4503ed(0x165)][_0x4503ed(0x110)]||[],_0x12dddf=normalize(_0x4e6a92),_0x1a82cf=_0x541e62[_0x4503ed(0x151)](_0x31dfc5=>normalize(_0x31dfc5['location'])===_0x12dddf&&(_0x31dfc5[_0x4503ed(0x131)]===_0x4503ed(0x16c)||_0x31dfc5['type']===_0x4503ed(0x166)||_0x31dfc5[_0x4503ed(0x131)]===_0x4503ed(0x136)));if(!_0x1a82cf){_0x3a01e7['log'][_0x4503ed(0x123)](_0x4503ed(0x11b)+_0x4e6a92+'\x27.');return;}const _0x52b999=await aiAgent[_0x4503ed(0x173)](_0x3a01e7,_0x4e6a92,_0x1a82cf[_0x4503ed(0x154)],_0x532196);if(!_0x52b999[_0x4503ed(0x11a)])return;const _0x169ba2=_0x4503ed(0x147)+_0x4e6a92+_0x4503ed(0x161)+_0x1a82cf['name']+'\x20('+_0x52b999['reason']+')';await _0x3a01e7[_0x4503ed(0x13c)](_0x4503ed(0x116),{'val':'['+_0x29a52d[_0x4503ed(0x130)]()+']\x20'+_0x169ba2,'ack':!![]});if(_0x29a52d===_0x4503ed(0x11c)){const _0xee6800=await _0x3a01e7['getForeignStateAsync'](_0x1a82cf['id']);(!_0xee6800||!_0xee6800[_0x4503ed(0x16a)]&&_0xee6800[_0x4503ed(0x16a)]!==!![])&&await _0x3a01e7[_0x4503ed(0x14d)](_0x1a82cf['id'],!![]),lastActions[_0x4e6a92]=_0x3b3369;}}async function findSetpointId(_0x1024f9,_0x396112){const _0x52a4dd=a1_0x44b10d;if(_0x1024f9['config'][_0x52a4dd(0x167)]){let _0x9e4596=_0x1024f9[_0x52a4dd(0x165)][_0x52a4dd(0x167)];if(typeof _0x9e4596===_0x52a4dd(0x15b))try{_0x9e4596=JSON['parse'](_0x9e4596);}catch(_0x2d125a){_0x9e4596={};}if(_0x9e4596&&_0x9e4596[_0x396112])return _0x9e4596[_0x396112];}const _0x2babd3=[{'s':_0x52a4dd(0x13f),'t':_0x52a4dd(0x128)},{'s':_0x52a4dd(0x14f),'t':_0x52a4dd(0x170)},{'s':_0x52a4dd(0x13d),'t':_0x52a4dd(0x12a)},{'s':_0x52a4dd(0x119),'t':'occupied_heating_setpoint'},{'s':_0x52a4dd(0x119),'t':_0x52a4dd(0x169)},{'s':'temperature','t':_0x52a4dd(0x157)},{'s':_0x52a4dd(0x14a),'t':_0x52a4dd(0x164)},{'s':_0x52a4dd(0x13a),'t':_0x52a4dd(0x12b)},{'s':_0x52a4dd(0x16b),'t':_0x52a4dd(0x118)}];for(const _0x12aac3 of _0x2babd3){if(_0x396112[_0x52a4dd(0x138)](_0x12aac3['s'])){const _0x58f561=_0x396112[_0x52a4dd(0x15e)](_0x12aac3['s'],_0x12aac3['t']),_0x4872d4=await _0x1024f9['getForeignObjectAsync'](_0x58f561);if(_0x4872d4)return _0x58f561;}}try{const _0x467ede=_0x396112[_0x52a4dd(0x121)]('.');if(_0x467ede['length']>0x2){const _0x5d7500=_0x467ede[_0x52a4dd(0x155)](0x0,-0x1)[_0x52a4dd(0x174)]('.'),_0x30d73b=await _0x1024f9['getForeignObjectsAsync'](_0x5d7500+'.*'),_0x23ffdf=[],_0x5811ad=_0x396112[_0x52a4dd(0x121)](/[._]+/)['filter'](_0x2c3248=>!['openknx','0',_0x52a4dd(0x16e),'ist',_0x52a4dd(0x172),_0x52a4dd(0x16b),_0x52a4dd(0x14b),_0x52a4dd(0x12f),_0x52a4dd(0x15f),_0x52a4dd(0x120)][_0x52a4dd(0x138)](_0x2c3248[_0x52a4dd(0x114)]()));for(const [_0x41966d,_0x36fc06]of Object['entries'](_0x30d73b)){if(_0x41966d===_0x396112)continue;if(_0x36fc06&&_0x36fc06[_0x52a4dd(0x141)]&&_0x36fc06[_0x52a4dd(0x141)][_0x52a4dd(0x13b)]===!![]){const _0xc8de6=_0x41966d['toLowerCase'](),_0x225def=(_0x36fc06[_0x52a4dd(0x141)][_0x52a4dd(0x124)]||'')[_0x52a4dd(0x114)](),_0x2499b5=_0xc8de6['includes']('set')||_0xc8de6[_0x52a4dd(0x138)](_0x52a4dd(0x112))||_0xc8de6[_0x52a4dd(0x138)](_0x52a4dd(0x117))||_0x225def[_0x52a4dd(0x138)](_0x52a4dd(0x143))||_0x225def[_0x52a4dd(0x138)](_0x52a4dd(0x132));if(_0x2499b5){const _0x1fd1d2=_0x41966d[_0x52a4dd(0x121)](/[._]+/)[_0x52a4dd(0x16d)](_0x5d4c03=>_0x5d4c03[_0x52a4dd(0x114)]());let _0x287fc9=0x0;_0x5811ad[_0x52a4dd(0x135)](_0x259942=>{const _0x5ac4da=_0x52a4dd;if(_0x1fd1d2['includes'](_0x259942[_0x5ac4da(0x114)]()))_0x287fc9++;}),_0x23ffdf[_0x52a4dd(0x177)]({'id':_0x41966d,'score':_0x287fc9});}}}if(_0x23ffdf[_0x52a4dd(0x163)]>0x0){_0x23ffdf[_0x52a4dd(0x115)]((_0x50f67f,_0x4e870d)=>_0x4e870d['score']-_0x50f67f[_0x52a4dd(0x145)]);const _0x5c4ba3=_0x23ffdf[0x0];if(_0x5c4ba3['score']>0x0)return _0x5c4ba3['id'];}}}catch(_0x11db26){_0x1024f9['log']['warn'](_0x52a4dd(0x158)+_0x11db26[_0x52a4dd(0x127)]);}return null;}function a1_0x1778(_0x26e8df,_0x150ab5){const _0x1a1cc5=a1_0x553b();return a1_0x1778=function(_0x693b04,_0x4af7c6){_0x693b04=_0x693b04-0x110;let _0x553b54=_0x1a1cc5[_0x693b04];return _0x553b54;},a1_0x1778(_0x26e8df,_0x150ab5);}async function scanThermostats(_0x4ba0cd){const _0x1f36ee=a1_0x44b10d,_0x2c0a32=_0x4ba0cd[_0x1f36ee(0x165)][_0x1f36ee(0x110)]||[],_0x20cd0e=[],_0x2af929=_0x2c0a32[_0x1f36ee(0x146)](_0x301731=>_0x301731['id']&&_0x301731['id'][_0x1f36ee(0x138)](_0x1f36ee(0x16b))||_0x301731[_0x1f36ee(0x131)]&&['temperature',_0x1f36ee(0x142),_0x1f36ee(0x12f)][_0x1f36ee(0x138)](_0x301731[_0x1f36ee(0x131)])||_0x301731['name']&&_0x301731[_0x1f36ee(0x154)][_0x1f36ee(0x114)]()[_0x1f36ee(0x138)](_0x1f36ee(0x11e)));for(const _0x54a5df of _0x2af929){const _0x1ce98c=await findSetpointId(_0x4ba0cd,_0x54a5df['id']);let _0x40ac32=_0x1f36ee(0x176),_0x3e93c0=![],_0x12a7d4=_0x4ba0cd['config'][_0x1f36ee(0x167)]||{};if(typeof _0x12a7d4===_0x1f36ee(0x15b))try{_0x12a7d4=JSON[_0x1f36ee(0x16f)](_0x12a7d4);}catch(_0x20ecef){}if(_0x12a7d4[_0x54a5df['id']]&&_0x12a7d4[_0x54a5df['id']]===_0x1ce98c)_0x40ac32=_0x1f36ee(0x14c),_0x3e93c0=!![];else _0x1ce98c&&(_0x40ac32=_0x1f36ee(0x133));_0x20cd0e['push']({'room':_0x54a5df['location']||_0x1f36ee(0x179),'sensorId':_0x54a5df['id'],'setpointId':_0x1ce98c||'-','source':_0x40ac32,'isManual':_0x3e93c0,'status':_0x1ce98c?'OK':_0x1f36ee(0x12d)});}return _0x20cd0e[_0x1f36ee(0x115)]((_0x20441a,_0x4af9b0)=>_0x20441a[_0x1f36ee(0x134)][_0x1f36ee(0x11d)](_0x4af9b0[_0x1f36ee(0x134)]));}function a1_0x553b(){const _0x2f2c4d=['active','localeCompare','temp','./ai_agent','state','split','mpc_','debug','role','3127516gMcdFn','12UWRfOf','message','.1.SET_POINT_TEMPERATURE','off','SET_POINT_TEMPERATURE','Soll','38883yNmbSW','Fehlt','10549832lwwaWA','sensor','toUpperCase','type','thermostat.setpoint','Auto-Erkennung','room','forEach','switch','location','includes','27714786eJVhCB','Ist','write','setStateAsync','ACTUAL_TEMPERATURE','exports','.1.ACTUAL_TEMPERATURE','number','common','thermostat','level.temperature','getStateAsync','score','filter','Pr√§diktion:\x20','37330kDDgbl','22317PXYqaT','ACTUAL','actual','Manuelles\x20Mapping','setForeignStateAsync','getForeignStateAsync','.1.TEMPERATURE','info','find','4092910aLUQrj','now','name','slice','log','target_temperature','Error\x20in\x20sibling\x20search:\x20','search','8DnWlCR','string','minutes_safe','constructor','replace','messwert','(((.+)+)+)+$','\x20->\x20Schalte\x20',':\x20-1¬∞C\x20(Sparpotenzial\x20genutzt)','length','SET','config','dimmer','thermostatMapping','apply','current_heating_setpoint','val','temperature','light','map','hm-rpc','parse','.4.SET_TEMPERATURE','analysis.automation.mode','wert','consultButler','join','9tWIyIV','Nicht\x20gefunden','push','Unknown','Unbekannt','150WqdGDp','devices','¬∞C\x20(Coasting\x20m√∂glich:\x20','soll','\x20min)','toLowerCase','sort','analysis.automation.lastAction','target','setpoint','local_temperature','approved','üîç\x20Device-Search\x20failed\x20for\x20predicted\x20room\x20\x27'];a1_0x553b=function(){return _0x2f2c4d;};return a1_0x553b();}async function applyEnergySavings(_0x4fd3e2,_0x5a7398){const _0x109185=a1_0x44b10d,_0x15c961=_0x4fd3e2['config'][_0x109185(0x110)]||[];for(const _0x31ddd4 of _0x5a7398){const _0x3e2ee1=_0x31ddd4[_0x109185(0x134)],_0x114d67=_0x31ddd4[_0x109185(0x15c)],_0x419163=Date['now']();if(lastActions[_0x109185(0x122)+_0x3e2ee1]&&_0x419163-lastActions[_0x109185(0x122)+_0x3e2ee1]<0x1e*0x3c*0x3e8)continue;const _0x12ad48=_0x15c961['find'](_0x48dd4e=>normalize(_0x48dd4e[_0x109185(0x137)])===normalize(_0x3e2ee1));if(!_0x12ad48)continue;const _0x154a00=await findSetpointId(_0x4fd3e2,_0x12ad48['id']);if(_0x154a00){const _0x37781e=await _0x4fd3e2[_0x109185(0x14e)](_0x154a00);if(_0x37781e&&typeof _0x37781e[_0x109185(0x16a)]===_0x109185(0x140)){const _0x1be79e=_0x37781e[_0x109185(0x16a)];if(_0x114d67>0x1e&&_0x1be79e>0x11){const _0x3a2af6=_0x1be79e-0x1;_0x4fd3e2[_0x109185(0x156)][_0x109185(0x150)]('üçÉ\x20MPC\x20Autonomy:\x20Senke\x20'+_0x3e2ee1+'\x20('+_0x154a00+')\x20auf\x20'+_0x3a2af6+_0x109185(0x111)+_0x114d67+_0x109185(0x113)),await _0x4fd3e2['setForeignStateAsync'](_0x154a00,_0x3a2af6),lastActions[_0x109185(0x122)+_0x3e2ee1]=_0x419163,await _0x4fd3e2[_0x109185(0x13c)](_0x109185(0x116),{'val':'[MPC]\x20'+_0x3e2ee1+_0x109185(0x162),'ack':!![]});}}}}}module[a1_0x44b10d(0x13e)]={'handlePrediction':handlePrediction,'applyEnergySavings':applyEnergySavings,'scanThermostats':scanThermostats};