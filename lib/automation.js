const a1_0x25671a=a1_0x42b9;(function(_0x5de5b9,_0x369b84){const _0x28965b=a1_0x42b9,_0x4b3a39=_0x5de5b9();while(!![]){try{const _0x267da0=parseInt(_0x28965b(0x169))/0x1*(parseInt(_0x28965b(0x16f))/0x2)+parseInt(_0x28965b(0x116))/0x3*(parseInt(_0x28965b(0x17e))/0x4)+-parseInt(_0x28965b(0x194))/0x5*(parseInt(_0x28965b(0x148))/0x6)+-parseInt(_0x28965b(0x154))/0x7+parseInt(_0x28965b(0x1a6))/0x8*(-parseInt(_0x28965b(0x125))/0x9)+-parseInt(_0x28965b(0x171))/0xa*(parseInt(_0x28965b(0x185))/0xb)+parseInt(_0x28965b(0x111))/0xc*(parseInt(_0x28965b(0x18d))/0xd);if(_0x267da0===_0x369b84)break;else _0x4b3a39['push'](_0x4b3a39['shift']());}catch(_0x2babd8){_0x4b3a39['push'](_0x4b3a39['shift']());}}}(a1_0x1f5d,0xbd90b));function a1_0x1f5d(){const _0x55f9ed=['map','467508YZAxRJ','getForeignObjectsAsync','\x20->\x20','role','hm-rpc','search','level','getForeignStateAsync','type','.1.ACTUAL_TEMPERATURE','PrÃ¤diktion:\x20','find','3436216lsGfff','ankunft','event','isArray','ðŸƒ\x20[MPC\x20ACTION]\x20Senke\x20','value.valve','position','add','ðŸ”¥\x20[MPC\x20ACTION]\x20Heize\x20','SET_POINT_TEMPERATURE','Soll','Unknown','valve_position','\x27\x20aktiv.\x20Heize\x20auf\x20','getTime','parse','\x20min).','setStateAsync','reason','Classic','off','33013iJqxgs','length','\x20->\x20Schalte\x20','level.valve',':\x20Aufheizen\x20auf\x20','.4.VALVE_STATE','14OIAxQq','Manuelles\x20Mapping','4520sAtAFE','[MPC\x20WARNING]\x20Kein\x20Setpoint\x20fÃ¼r\x20','valve','analysis.automation.mode','stringify','info','./ai_agent','level.temperature','triggerTime','calendarSelection','analysis.automation.lastAction','name','warn','4rUxpXB','minutes_safe','analysis.energy.mpcActiveInterventions','.4.SET_TEMPERATURE','join','Â°C\x20(via\x20','apply','15037poSvPE','unit','[MPC]\x20','Auto-Erkennung','.1.TEMPERATURE','analysis.energy.schedulePreview','score','urlaub\x20ende','94523fGbsin','temp','occupied_heating_setpoint','(((.+)+)+)+$','analysis.automation.confidenceThreshold','Nicht\x20gefunden','system.mode','95fLLWFO','set','string','target','target_temperature','getStateAsync','log','light','toString','sensor','indexOf','actual','Â°C).\x20Entferne\x20Status.','analysis.energy.warmupSources','ðŸ“…\x20SMART\x20SCHEDULE\x20[','wert','[CAL]\x20','thermostatMapping','1512tDiiYu','state','sort','number','forEach','\x20wieder\x20auf\x20','filter','replace','SET','setForeignStateAsync','constructor',':\x20Absenkung\x20auf\x20','devices','Ist','pi_heating_demand','_calName','ist','.1.LEVEL','\x20min)','setpoint','4596xWPyIn','toLowerCase','common','from','.1.SET_POINT_TEMPERATURE','3079794KPojUf','_date','ðŸ§¹\x20[MPC\x20CLEANUP]\x20','summary','approved','message','valveMapping','cal_','config','messwert','Calendar\x20Check\x20Error:\x20','exports','active','splice','slice','32229riYELc','split','Â°C!\x20(Puffer:\x20','calendarInstance','eventStart','analysis.automation.actionLog','\x20ist\x20auf\x20','trim','push','thermostat.setpoint','includes','default','room','rÃ¼ckkehr','temperature','val','now','ACTUAL','ðŸ“…\x20SMART\x20SCHEDULE\x20(Phase):\x20\x27Globaler\x20Start\x27\x20erkannt.\x20Heize\x20Haus\x20auf\x20(Vorlauf:\x20','Unbekannt','mpc_','abs','unshift','useCalendar','date','toUpperCase','location','normal','thermostat','write','.data.table','remove','analysis.energy.warmupTargets','Â°C!\x20(Puffer\x20leer).'];a1_0x1f5d=function(){return _0x55f9ed;};return a1_0x1f5d();}const a1_0x5ca4f1=(function(){let _0x400663=!![];return function(_0x3d5edb,_0x534c38){const _0x3a01b3=_0x400663?function(){const _0x5b0a70=a1_0x42b9;if(_0x534c38){const _0x14fa29=_0x534c38[_0x5b0a70(0x184)](_0x3d5edb,arguments);return _0x534c38=null,_0x14fa29;}}:function(){};return _0x400663=![],_0x3a01b3;};}()),a1_0x1efd07=a1_0x5ca4f1(this,function(){const _0x5d4a4e=a1_0x42b9;return a1_0x1efd07[_0x5d4a4e(0x19c)]()[_0x5d4a4e(0x14d)](_0x5d4a4e(0x190))[_0x5d4a4e(0x19c)]()[_0x5d4a4e(0x1b0)](a1_0x1efd07)[_0x5d4a4e(0x14d)](_0x5d4a4e(0x190));});a1_0x1efd07();'use strict';const aiAgent=require(a1_0x25671a(0x177)),COOLDOWN_MS=0x3c*0x3e8,CAL_COOLDOWN_MS=0x5a*0x3c*0x3e8,ECO_TEMP=0x11,lastActions={};function normalize(_0x18b13e){const _0x573444=a1_0x25671a;if(!_0x18b13e)return'';return _0x18b13e['toLowerCase']()[_0x573444(0x1ad)](/\s+/g,'')[_0x573444(0x12c)]();}async function logAutomationAction(_0x3580a4,_0x27b758){const _0x503015=a1_0x25671a;await _0x3580a4[_0x503015(0x165)](_0x503015(0x17b),{'val':_0x27b758,'ack':!![]});try{const _0x55631e=_0x503015(0x12a),_0x14c3d0=await _0x3580a4[_0x503015(0x199)](_0x55631e);let _0x3b60b1=[];if(_0x14c3d0&&_0x14c3d0[_0x503015(0x134)])try{_0x3b60b1=JSON[_0x503015(0x163)](_0x14c3d0[_0x503015(0x134)]);}catch(_0xb0432f){}_0x3b60b1[_0x503015(0x13b)]({'ts':Date['now'](),'msg':_0x27b758});if(_0x3b60b1['length']>0x32)_0x3b60b1=_0x3b60b1[_0x503015(0x124)](0x0,0x32);await _0x3580a4[_0x503015(0x165)](_0x55631e,{'val':JSON[_0x503015(0x175)](_0x3b60b1),'ack':!![]});}catch(_0x1af1fc){}}async function handlePrediction(_0x505243,_0x5e23f9,_0x3bd16a){const _0x5ca24c=a1_0x25671a;if(!_0x5e23f9||_0x5e23f9===_0x5ca24c(0x15f))return;let _0x4fc855=_0x5ca24c(0x168),_0xca1925=0.6;try{const _0x235ff5=await _0x505243['getStateAsync'](_0x5ca24c(0x174));if(_0x235ff5&&_0x235ff5['val'])_0x4fc855=_0x235ff5[_0x5ca24c(0x134)];const _0x5ddcb8=await _0x505243[_0x5ca24c(0x199)](_0x5ca24c(0x191));if(_0x5ddcb8&&_0x5ddcb8[_0x5ca24c(0x134)])_0xca1925=_0x5ddcb8[_0x5ca24c(0x134)];}catch(_0x2e3f73){}if(_0x4fc855===_0x5ca24c(0x168)||_0x3bd16a<_0xca1925)return;const _0x4d8965=Date[_0x5ca24c(0x135)]();if(lastActions[_0x5e23f9]&&_0x4d8965-lastActions[_0x5e23f9]<COOLDOWN_MS)return;const _0x2b08b6=_0x505243[_0x5ca24c(0x11e)][_0x5ca24c(0x1b2)]||[],_0xdcfebd=normalize(_0x5e23f9),_0x7a47e2=_0x2b08b6[_0x5ca24c(0x153)](_0x4c728e=>normalize(_0x4c728e[_0x5ca24c(0x13f)])===_0xdcfebd&&(_0x4c728e[_0x5ca24c(0x150)]===_0x5ca24c(0x19b)||_0x4c728e[_0x5ca24c(0x150)]==='dimmer'||_0x4c728e['type']==='switch'));if(!_0x7a47e2)return;const _0x10281d=await aiAgent['consultButler'](_0x505243,_0x5e23f9,_0x7a47e2[_0x5ca24c(0x17c)],_0x3bd16a);if(!_0x10281d[_0x5ca24c(0x11a)])return;const _0x196e16=_0x5ca24c(0x152)+_0x5e23f9+_0x5ca24c(0x16b)+_0x7a47e2[_0x5ca24c(0x17c)]+'\x20('+_0x10281d[_0x5ca24c(0x166)]+')';await logAutomationAction(_0x505243,'['+_0x4fc855[_0x5ca24c(0x13e)]()+']\x20'+_0x196e16);if(_0x4fc855===_0x5ca24c(0x122)){const _0x7a3f38=await _0x505243['getForeignStateAsync'](_0x7a47e2['id']);(!_0x7a3f38||!_0x7a3f38[_0x5ca24c(0x134)]&&_0x7a3f38['val']!==!![])&&await _0x505243[_0x5ca24c(0x1af)](_0x7a47e2['id'],!![]),lastActions[_0x5e23f9]=_0x4d8965;}}async function findRelatedId(_0x258845,_0x34cc99,_0x38e951=a1_0x25671a(0x110)){const _0xf8f28c=a1_0x25671a;if(_0x38e951===_0xf8f28c(0x110)&&_0x258845[_0xf8f28c(0x11e)][_0xf8f28c(0x1a5)]){let _0x2191e8=_0x258845[_0xf8f28c(0x11e)]['thermostatMapping'];if(typeof _0x2191e8===_0xf8f28c(0x196))try{_0x2191e8=JSON['parse'](_0x2191e8);}catch(_0x474fd8){}if(_0x2191e8&&_0x2191e8[_0x34cc99])return _0x2191e8[_0x34cc99];}if(_0x38e951===_0xf8f28c(0x173)&&_0x258845[_0xf8f28c(0x11e)][_0xf8f28c(0x11c)]){let _0x2039ee=_0x258845[_0xf8f28c(0x11e)][_0xf8f28c(0x11c)];if(typeof _0x2039ee===_0xf8f28c(0x196))try{_0x2039ee=JSON[_0xf8f28c(0x163)](_0x2039ee);}catch(_0xb1d82){}if(_0x2039ee&&_0x2039ee[_0x34cc99])return _0x2039ee[_0x34cc99];}let _0x350024=[];if(_0x38e951==='setpoint')_0x350024=[{'s':'.1.ACTUAL_TEMPERATURE','t':'.1.SET_POINT_TEMPERATURE'},{'s':_0xf8f28c(0x189),'t':_0xf8f28c(0x115)},{'s':_0xf8f28c(0x189),'t':_0xf8f28c(0x181)},{'s':'ACTUAL_TEMPERATURE','t':_0xf8f28c(0x15d)},{'s':'local_temperature','t':_0xf8f28c(0x18f)},{'s':'local_temperature','t':'current_heating_setpoint'},{'s':_0xf8f28c(0x133),'t':_0xf8f28c(0x198)},{'s':_0xf8f28c(0x136),'t':_0xf8f28c(0x1ae)},{'s':_0xf8f28c(0x1b3),'t':_0xf8f28c(0x15e)},{'s':_0xf8f28c(0x133),'t':'setpoint'}];else _0x38e951==='valve'&&(_0x350024=[{'s':_0xf8f28c(0x151),'t':_0xf8f28c(0x1b7)},{'s':_0xf8f28c(0x189),'t':_0xf8f28c(0x1b7)},{'s':'.1.TEMPERATURE','t':_0xf8f28c(0x16e)},{'s':'local_temperature','t':_0xf8f28c(0x1b4)},{'s':'temperature','t':_0xf8f28c(0x160)},{'s':_0xf8f28c(0x133),'t':_0xf8f28c(0x14e)}]);for(const _0x32c20a of _0x350024){if(_0x34cc99[_0xf8f28c(0x12f)](_0x32c20a['s'])){const _0x13c977=_0x34cc99['replace'](_0x32c20a['s'],_0x32c20a['t']),_0x273ae5=await _0x258845['getForeignObjectAsync'](_0x13c977);if(_0x273ae5)return _0x13c977;}}try{const _0x2a0bf8=_0x34cc99[_0xf8f28c(0x126)]('.');if(_0x2a0bf8[_0xf8f28c(0x16a)]>0x2){const _0x1d45e8=_0x2a0bf8[_0xf8f28c(0x124)](0x0,-0x1)[_0xf8f28c(0x182)]('.'),_0x65ebdd=await _0x258845[_0xf8f28c(0x149)](_0x1d45e8+'.*'),_0x396535=[],_0x3a3cbe=_0x34cc99[_0xf8f28c(0x126)](/[._]+/)[_0xf8f28c(0x1ac)](_0x57e937=>!['openknx','0',_0xf8f28c(0x14c),_0xf8f28c(0x1b6),_0xf8f28c(0x1a3),'temperature',_0xf8f28c(0x19f),_0xf8f28c(0x19d),_0xf8f28c(0x11f),_0xf8f28c(0x1a7)]['includes'](_0x57e937[_0xf8f28c(0x112)]()));for(const [_0xecfd0f,_0x4d51ce]of Object['entries'](_0x65ebdd)){if(_0xecfd0f===_0x34cc99)continue;if(_0x4d51ce&&_0x4d51ce[_0xf8f28c(0x113)]){const _0x191884=_0xecfd0f[_0xf8f28c(0x112)](),_0x3c88ad=(_0x4d51ce[_0xf8f28c(0x113)][_0xf8f28c(0x14b)]||'')[_0xf8f28c(0x112)](),_0x5dae1d=(_0x4d51ce[_0xf8f28c(0x113)][_0xf8f28c(0x186)]||'')[_0xf8f28c(0x112)]();let _0x58f9f9=![];if(_0x38e951===_0xf8f28c(0x110)&&_0x4d51ce['common'][_0xf8f28c(0x142)]===!![])_0x58f9f9=_0x191884[_0xf8f28c(0x12f)](_0xf8f28c(0x195))||_0x191884[_0xf8f28c(0x12f)]('soll')||_0x191884[_0xf8f28c(0x12f)](_0xf8f28c(0x197))||_0x3c88ad[_0xf8f28c(0x12f)](_0xf8f28c(0x178))||_0x3c88ad[_0xf8f28c(0x12f)](_0xf8f28c(0x12e));else _0x38e951==='valve'&&(_0x58f9f9=_0x191884[_0xf8f28c(0x12f)](_0xf8f28c(0x14e))||_0x191884[_0xf8f28c(0x12f)](_0xf8f28c(0x173))||_0x191884[_0xf8f28c(0x12f)]('stellwert')||_0x191884[_0xf8f28c(0x12f)](_0xf8f28c(0x15a))||_0x3c88ad[_0xf8f28c(0x12f)](_0xf8f28c(0x16c))||_0x3c88ad[_0xf8f28c(0x12f)](_0xf8f28c(0x159))||_0x5dae1d[_0xf8f28c(0x12f)]('%'));if(_0x58f9f9){const _0x49b32c=_0xecfd0f['split'](/[._]+/)[_0xf8f28c(0x147)](_0xfe5e53=>_0xfe5e53[_0xf8f28c(0x112)]());let _0xa089c3=0x0;_0x3a3cbe[_0xf8f28c(0x1aa)](_0x44cdb1=>{const _0x10184=_0xf8f28c;if(_0x49b32c['includes'](_0x44cdb1[_0x10184(0x112)]()))_0xa089c3++;}),_0x396535['push']({'id':_0xecfd0f,'score':_0xa089c3});}}}if(_0x396535[_0xf8f28c(0x16a)]>0x0){_0x396535[_0xf8f28c(0x1a8)]((_0x4dabdd,_0x12cc4d)=>_0x12cc4d['score']-_0x4dabdd[_0xf8f28c(0x18b)]);if(_0x396535[0x0]['score']>0x0)return _0x396535[0x0]['id'];}}}catch(_0x10ac7b){}return null;}async function scanThermostats(_0x26df2e){const _0x328cbd=a1_0x25671a,_0x56eec3=_0x26df2e[_0x328cbd(0x11e)][_0x328cbd(0x1b2)]||[],_0x4e78c1=[],_0x359f0d=_0x56eec3['filter'](_0x599caa=>_0x599caa['id']&&_0x599caa['id'][_0x328cbd(0x12f)]('temperature')||_0x599caa[_0x328cbd(0x150)]&&[_0x328cbd(0x133),_0x328cbd(0x141),_0x328cbd(0x19d)][_0x328cbd(0x12f)](_0x599caa[_0x328cbd(0x150)])||_0x599caa['name']&&_0x599caa['name'][_0x328cbd(0x112)]()[_0x328cbd(0x12f)](_0x328cbd(0x18e)));for(const _0x228e11 of _0x359f0d){const _0x5c79c3=await findRelatedId(_0x26df2e,_0x228e11['id'],_0x328cbd(0x110)),_0x4e48b9=await findRelatedId(_0x26df2e,_0x228e11['id'],_0x328cbd(0x173));let _0x27df5b=_0x328cbd(0x192),_0x2fa97b=![],_0x3fa2d1=_0x26df2e[_0x328cbd(0x11e)]['thermostatMapping']||{};if(typeof _0x3fa2d1===_0x328cbd(0x196))try{_0x3fa2d1=JSON[_0x328cbd(0x163)](_0x3fa2d1);}catch(_0x2c016d){}let _0x5035c4=_0x26df2e['config'][_0x328cbd(0x11c)]||{};if(typeof _0x5035c4===_0x328cbd(0x196))try{_0x5035c4=JSON['parse'](_0x5035c4);}catch(_0x66cc72){}if(_0x3fa2d1[_0x228e11['id']]&&_0x3fa2d1[_0x228e11['id']]===_0x5c79c3||_0x5035c4[_0x228e11['id']]&&_0x5035c4[_0x228e11['id']]===_0x4e48b9)_0x27df5b=_0x328cbd(0x170),_0x2fa97b=!![];else(_0x5c79c3||_0x4e48b9)&&(_0x27df5b=_0x328cbd(0x188));_0x4e78c1[_0x328cbd(0x12d)]({'room':_0x228e11[_0x328cbd(0x13f)]||_0x328cbd(0x138),'sensorId':_0x228e11['id'],'setpointId':_0x5c79c3||'-','valveId':_0x4e48b9||'-','source':_0x27df5b,'isManual':_0x2fa97b,'status':_0x5c79c3&&_0x4e48b9?'PERFECT':_0x5c79c3?'OK':'Fehlt'});}return _0x4e78c1['sort']((_0x49f258,_0x36e3ee)=>_0x49f258[_0x328cbd(0x131)]['localeCompare'](_0x36e3ee[_0x328cbd(0x131)]));}function a1_0x42b9(_0x1d85c8,_0x4ad7bf){const _0x28ed34=a1_0x1f5d();return a1_0x42b9=function(_0x1efd07,_0x5ca4f1){_0x1efd07=_0x1efd07-0x110;let _0x1f5dd8=_0x28ed34[_0x1efd07];return _0x1f5dd8;},a1_0x42b9(_0x1d85c8,_0x4ad7bf);}async function updateSchedulePreview(_0x47cde2){const _0x5bfffb=a1_0x25671a;if(!_0x47cde2[_0x5bfffb(0x11e)][_0x5bfffb(0x13c)]||!_0x47cde2[_0x5bfffb(0x11e)]['calendarInstance'])return;let _0x4a5602={};try{const _0x11c723=await _0x47cde2[_0x5bfffb(0x199)]('analysis.energy.warmupTimes');if(_0x11c723&&_0x11c723[_0x5bfffb(0x134)])_0x4a5602=JSON['parse'](_0x11c723[_0x5bfffb(0x134)]);}catch(_0x2479e7){}const _0x5ac46e=[],_0x299382=Date['now'](),_0x461a17=0x30*0x3c*0x3c*0x3e8;try{const _0x186a99=await _0x47cde2[_0x5bfffb(0x14f)](_0x47cde2[_0x5bfffb(0x11e)]['calendarInstance']+_0x5bfffb(0x143));if(!_0x186a99||!_0x186a99[_0x5bfffb(0x134)])return;const _0x5ceec1=JSON['parse'](_0x186a99[_0x5bfffb(0x134)]),_0x4cc051=_0x47cde2[_0x5bfffb(0x11e)][_0x5bfffb(0x17a)]||[],_0x36bd94=_0x47cde2[_0x5bfffb(0x11e)][_0x5bfffb(0x1b2)]||[],_0xdc06c3=new Set();_0x36bd94['forEach'](_0x17433d=>{if(_0x17433d['location'])_0xdc06c3['add'](_0x17433d['location']);});for(const _0x10d1a7 of _0x5ceec1){if(_0x10d1a7[_0x5bfffb(0x1b5)]&&_0x4cc051[_0x5bfffb(0x16a)]>0x0&&!_0x4cc051[_0x5bfffb(0x12f)](_0x10d1a7[_0x5bfffb(0x1b5)]))continue;const _0x2fa16e=_0x10d1a7[_0x5bfffb(0x117)]||_0x10d1a7[_0x5bfffb(0x129)]||_0x10d1a7[_0x5bfffb(0x13d)];if(!_0x2fa16e)continue;const _0xff237=new Date(_0x2fa16e),_0x5e3ed1=_0xff237[_0x5bfffb(0x162)]();if(isNaN(_0x5e3ed1))continue;if(_0x5e3ed1<_0x299382)continue;if(_0x5e3ed1>_0x299382+_0x461a17)continue;const _0x1111f5=(_0x10d1a7[_0x5bfffb(0x156)]||_0x10d1a7[_0x5bfffb(0x119)]||'')[_0x5bfffb(0x112)]();let _0x244119=![],_0x2de48e=[],_0x287bae=_0x10d1a7['event']||_0x10d1a7[_0x5bfffb(0x119)]||_0x5bfffb(0x138);if(_0x1111f5[_0x5bfffb(0x12f)](_0x5bfffb(0x18c))||_0x1111f5[_0x5bfffb(0x12f)](_0x5bfffb(0x132))||_0x1111f5['includes'](_0x5bfffb(0x155)))_0x244119=!![],_0x2de48e=Array[_0x5bfffb(0x114)](_0xdc06c3);else for(const _0x33f905 of _0xdc06c3){if(_0x1111f5[_0x5bfffb(0x12f)](_0x33f905['toLowerCase']()))_0x2de48e[_0x5bfffb(0x12d)](_0x33f905);}_0x2de48e[_0x5bfffb(0x16a)]>0x0&&_0x2de48e[_0x5bfffb(0x1aa)](_0x1625ff=>{const _0x5cd719=_0x5bfffb;let _0x4b4f51=0x3c;if(_0x244119){let _0x37a067=0x0;Object['values'](_0x4a5602)[_0x5cd719(0x1aa)](_0x23466a=>{if(_0x23466a>_0x37a067)_0x37a067=_0x23466a;}),_0x4b4f51=_0x37a067>0x0?_0x37a067:0x78;}else _0x4b4f51=_0x4a5602[_0x1625ff]||0x3c;const _0x4e7255=new Date(_0x5e3ed1-_0x4b4f51*0xea60);_0x5ac46e['push']({'eventTime':_0x5e3ed1,'triggerTime':_0x4e7255['getTime'](),'room':_0x1625ff,'minutes':_0x4b4f51,'reason':_0x287bae,'isGlobal':_0x244119});});}}catch(_0x847ca9){}_0x5ac46e['sort']((_0x3786ad,_0x2a10af)=>_0x3786ad[_0x5bfffb(0x179)]-_0x2a10af[_0x5bfffb(0x179)]);const _0x4fd536=_0x5ac46e[_0x5bfffb(0x124)](0x0,0x5);await _0x47cde2[_0x5bfffb(0x165)](_0x5bfffb(0x18a),{'val':JSON[_0x5bfffb(0x175)](_0x4fd536),'ack':!![]});}async function checkCalendarTriggers(_0x1829e5){const _0x36bad3=a1_0x25671a;if(!_0x1829e5[_0x36bad3(0x11e)]['useCalendar']||!_0x1829e5[_0x36bad3(0x11e)][_0x36bad3(0x128)])return;await updateSchedulePreview(_0x1829e5);let _0xb2d827={},_0x44aa96={};try{const _0x19ce33=await _0x1829e5[_0x36bad3(0x199)]('analysis.energy.warmupTimes');if(_0x19ce33&&_0x19ce33[_0x36bad3(0x134)])_0xb2d827=JSON[_0x36bad3(0x163)](_0x19ce33['val']);const _0x45ed3f=await _0x1829e5[_0x36bad3(0x199)](_0x36bad3(0x1a1));if(_0x45ed3f&&_0x45ed3f['val'])_0x44aa96=JSON[_0x36bad3(0x163)](_0x45ed3f['val']);}catch(_0x9e8883){}let _0x492b43={'default':0x15};try{const _0x588f47=await _0x1829e5[_0x36bad3(0x199)](_0x36bad3(0x145));if(_0x588f47&&_0x588f47[_0x36bad3(0x134)])_0x492b43=JSON['parse'](_0x588f47[_0x36bad3(0x134)]);}catch(_0x5addb3){}try{const _0x97b45c=await _0x1829e5[_0x36bad3(0x14f)](_0x1829e5[_0x36bad3(0x11e)][_0x36bad3(0x128)]+'.data.table');if(!_0x97b45c||!_0x97b45c[_0x36bad3(0x134)])return;const _0x5a105b=JSON[_0x36bad3(0x163)](_0x97b45c['val']),_0xbf7473=Date[_0x36bad3(0x135)](),_0x45bde3=_0x1829e5[_0x36bad3(0x11e)][_0x36bad3(0x1b2)]||[],_0x286fa4=_0x1829e5[_0x36bad3(0x11e)][_0x36bad3(0x17a)]||[];for(const _0x29e9a2 of _0x5a105b){if(_0x29e9a2[_0x36bad3(0x1b5)]&&_0x286fa4[_0x36bad3(0x16a)]>0x0&&!_0x286fa4['includes'](_0x29e9a2[_0x36bad3(0x1b5)]))continue;const _0x2b98dc=_0x29e9a2[_0x36bad3(0x117)]||_0x29e9a2[_0x36bad3(0x129)]||_0x29e9a2['date'];if(!_0x2b98dc)continue;const _0x457e28=new Date(_0x2b98dc);if(isNaN(_0x457e28[_0x36bad3(0x162)]()))continue;const _0x528a97=(_0x29e9a2['event']||_0x29e9a2['summary']||'')[_0x36bad3(0x112)]();if(_0x528a97[_0x36bad3(0x12f)](_0x36bad3(0x18c))||_0x528a97[_0x36bad3(0x12f)](_0x36bad3(0x132))||_0x528a97[_0x36bad3(0x12f)](_0x36bad3(0x155))){let _0x5461b6=0x0;Object['values'](_0xb2d827)[_0x36bad3(0x1aa)](_0x228bd7=>{if(_0x228bd7>_0x5461b6)_0x5461b6=_0x228bd7;});if(_0x5461b6===0x0)_0x5461b6=0x78;const _0x4ad58f=_0x457e28[_0x36bad3(0x162)]()-_0x5461b6*0xea60;_0xbf7473>=_0x4ad58f&&_0xbf7473<_0x457e28[_0x36bad3(0x162)]()&&(_0x1829e5['currentSystemMode']!=='normal'&&(_0x1829e5[_0x36bad3(0x19a)][_0x36bad3(0x176)](_0x36bad3(0x137)+_0x5461b6+_0x36bad3(0x164)),await _0x1829e5[_0x36bad3(0x165)](_0x36bad3(0x193),{'val':_0x36bad3(0x140),'ack':![]})));}for(const _0x53cef1 of _0x45bde3){if(_0x53cef1[_0x36bad3(0x13f)]){const _0x3d988f=_0x53cef1[_0x36bad3(0x13f)][_0x36bad3(0x112)]();if(_0x528a97[_0x36bad3(0x12f)](_0x3d988f)){const _0x16415a=_0xb2d827[_0x53cef1[_0x36bad3(0x13f)]]||0x3c,_0x3548a3=_0x44aa96[_0x53cef1[_0x36bad3(0x13f)]]||_0x36bad3(0x167),_0xf6f3dd=_0x457e28['getTime']()-_0x16415a*0xea60;if(_0xbf7473>=_0xf6f3dd&&_0xbf7473<_0x457e28[_0x36bad3(0x162)]()){const _0x1e2185=lastActions[_0x36bad3(0x11d)+_0x53cef1[_0x36bad3(0x13f)]];if(_0x1e2185&&_0xbf7473-_0x1e2185<CAL_COOLDOWN_MS)continue;const _0x54fa52=await findRelatedId(_0x1829e5,_0x53cef1['id'],_0x36bad3(0x110));if(_0x54fa52){let _0x4500bb=_0x492b43[_0x53cef1[_0x36bad3(0x13f)]];if(_0x4500bb===undefined)_0x4500bb=_0x492b43[_0x36bad3(0x130)];if(_0x4500bb===undefined)_0x4500bb=0x15;const _0x331ba5=await _0x1829e5['getForeignStateAsync'](_0x54fa52);_0x331ba5&&typeof _0x331ba5[_0x36bad3(0x134)]==='number'&&_0x331ba5[_0x36bad3(0x134)]<_0x4500bb-0.5&&(_0x1829e5['log']['info'](_0x36bad3(0x1a2)+_0x3548a3+']:\x20Raum-Trigger\x20\x27'+_0x53cef1[_0x36bad3(0x13f)]+_0x36bad3(0x161)+_0x4500bb+'Â°C\x20(Vorlauf:\x20'+_0x16415a+'\x20min).'),await _0x1829e5[_0x36bad3(0x1af)](_0x54fa52,_0x4500bb),await logAutomationAction(_0x1829e5,_0x36bad3(0x1a4)+_0x53cef1[_0x36bad3(0x13f)]+_0x36bad3(0x14a)+_0x4500bb+_0x36bad3(0x183)+_0x3548a3+')'),lastActions[_0x36bad3(0x11d)+_0x53cef1['location']]=_0xbf7473);}}}}}}}catch(_0x44a7cc){_0x1829e5[_0x36bad3(0x19a)][_0x36bad3(0x17d)](_0x36bad3(0x120)+_0x44a7cc[_0x36bad3(0x11b)]);}}async function manageMpcIntervention(_0x52a818,_0x4573c1,_0x88806b){const _0x137a3e=a1_0x25671a;try{const _0x1bf261=_0x137a3e(0x180),_0x23867f=await _0x52a818[_0x137a3e(0x199)](_0x1bf261);let _0x24c843=[];if(_0x23867f&&_0x23867f[_0x137a3e(0x134)])try{_0x24c843=JSON['parse'](_0x23867f[_0x137a3e(0x134)]);}catch(_0x54f976){}const _0x40553f=_0x24c843[_0x137a3e(0x19e)](_0x4573c1);if(_0x88806b===_0x137a3e(0x15b))_0x40553f===-0x1&&(_0x24c843[_0x137a3e(0x12d)](_0x4573c1),await _0x52a818[_0x137a3e(0x165)](_0x1bf261,{'val':JSON[_0x137a3e(0x175)](_0x24c843),'ack':!![]}));else _0x88806b==='remove'&&(_0x40553f!==-0x1&&(_0x24c843[_0x137a3e(0x123)](_0x40553f,0x1),await _0x52a818[_0x137a3e(0x165)](_0x1bf261,{'val':JSON[_0x137a3e(0x175)](_0x24c843),'ack':!![]})));}catch(_0x2c5813){}}async function cleanupGhostInterventions(_0x51fbb4){const _0x2e5e6f=a1_0x25671a;try{const _0x31fc5e=_0x2e5e6f(0x180),_0x39d891=await _0x51fbb4[_0x2e5e6f(0x199)](_0x31fc5e);if(!_0x39d891||!_0x39d891[_0x2e5e6f(0x134)])return;const _0x464b86=JSON['parse'](_0x39d891[_0x2e5e6f(0x134)]);if(!Array[_0x2e5e6f(0x157)](_0x464b86)||_0x464b86[_0x2e5e6f(0x16a)]===0x0)return;const _0x1556ef=_0x51fbb4['config']['devices']||[];let _0x2fbab8=![];for(let _0x5a88af=_0x464b86[_0x2e5e6f(0x16a)]-0x1;_0x5a88af>=0x0;_0x5a88af--){const _0x2de41e=_0x464b86[_0x5a88af],_0x208218=_0x1556ef[_0x2e5e6f(0x153)](_0x2603c2=>normalize(_0x2603c2[_0x2e5e6f(0x13f)])===normalize(_0x2de41e)&&(_0x2603c2[_0x2e5e6f(0x150)]===_0x2e5e6f(0x133)||_0x2603c2[_0x2e5e6f(0x150)]==='thermostat'));if(_0x208218){const _0x362b63=await findRelatedId(_0x51fbb4,_0x208218['id'],'setpoint');if(_0x362b63){const _0x474f87=await _0x51fbb4[_0x2e5e6f(0x14f)](_0x362b63);_0x474f87&&typeof _0x474f87[_0x2e5e6f(0x134)]===_0x2e5e6f(0x1a9)&&(Math[_0x2e5e6f(0x13a)](_0x474f87['val']-ECO_TEMP)>0.5&&(_0x51fbb4[_0x2e5e6f(0x19a)][_0x2e5e6f(0x176)](_0x2e5e6f(0x118)+_0x2de41e+_0x2e5e6f(0x12b)+_0x474f87['val']+'Â°C\x20(nicht\x20'+ECO_TEMP+_0x2e5e6f(0x1a0)),_0x464b86['splice'](_0x5a88af,0x1),_0x2fbab8=!![]));}}}_0x2fbab8&&await _0x51fbb4[_0x2e5e6f(0x165)](_0x31fc5e,{'val':JSON[_0x2e5e6f(0x175)](_0x464b86),'ack':!![]});}catch(_0x44e7e9){}}async function applyEnergySavings(_0x4de0b4,_0x2ce4dc){const _0x26d584=a1_0x25671a;await cleanupGhostInterventions(_0x4de0b4);if(!_0x2ce4dc||_0x2ce4dc[_0x26d584(0x16a)]===0x0)return;const _0x4fabfa=_0x4de0b4[_0x26d584(0x11e)][_0x26d584(0x1b2)]||[],_0x49d404=Date[_0x26d584(0x135)]();for(const _0x512b34 of _0x2ce4dc){const _0x1d25d0=_0x512b34[_0x26d584(0x131)],_0x35ee8c=_0x512b34[_0x26d584(0x17f)],_0x453572=_0x512b34[_0x26d584(0x197)]||0x15,_0x53f373=_0x4fabfa[_0x26d584(0x153)](_0x4725d8=>normalize(_0x4725d8['location'])===normalize(_0x1d25d0)&&(_0x4725d8[_0x26d584(0x150)]===_0x26d584(0x133)||_0x4725d8[_0x26d584(0x150)]==='thermostat'));if(!_0x53f373)continue;const _0x231131=await findRelatedId(_0x4de0b4,_0x53f373['id'],_0x26d584(0x110));if(_0x231131){if(lastActions[_0x26d584(0x139)+_0x1d25d0]&&_0x49d404-lastActions['mpc_'+_0x1d25d0]<0x1e*0x3c*0x3e8)continue;const _0x546e93=await _0x4de0b4['getForeignStateAsync'](_0x231131);if(_0x546e93&&typeof _0x546e93['val']==='number'){const _0x28fede=_0x546e93[_0x26d584(0x134)];_0x28fede!==ECO_TEMP&&await manageMpcIntervention(_0x4de0b4,_0x1d25d0,_0x26d584(0x144));if(_0x35ee8c>0x1e)_0x28fede>ECO_TEMP+0.5&&(_0x4de0b4[_0x26d584(0x19a)]['info'](_0x26d584(0x158)+_0x1d25d0+'\x20auf\x20'+ECO_TEMP+_0x26d584(0x127)+_0x35ee8c+_0x26d584(0x1b8)),await _0x4de0b4[_0x26d584(0x1af)](_0x231131,ECO_TEMP),await manageMpcIntervention(_0x4de0b4,_0x1d25d0,'add'),lastActions[_0x26d584(0x139)+_0x1d25d0]=_0x49d404,await logAutomationAction(_0x4de0b4,_0x26d584(0x187)+_0x1d25d0+_0x26d584(0x1b1)+ECO_TEMP+'Â°C'));else _0x35ee8c<=0xf&&(_0x28fede<_0x453572&&(_0x4de0b4[_0x26d584(0x19a)]['info'](_0x26d584(0x15c)+_0x1d25d0+_0x26d584(0x1ab)+_0x453572+_0x26d584(0x146)),await _0x4de0b4['setForeignStateAsync'](_0x231131,_0x453572),await manageMpcIntervention(_0x4de0b4,_0x1d25d0,'remove'),lastActions['mpc_'+_0x1d25d0]=_0x49d404,await logAutomationAction(_0x4de0b4,'[MPC]\x20'+_0x1d25d0+_0x26d584(0x16d)+_0x453572+'Â°C')));}}else _0x4de0b4[_0x26d584(0x19a)]['warn'](_0x26d584(0x172)+_0x1d25d0+'\x20gefunden!');}}module[a1_0x25671a(0x121)]={'handlePrediction':handlePrediction,'applyEnergySavings':applyEnergySavings,'scanThermostats':scanThermostats,'checkCalendarTriggers':checkCalendarTriggers,'updateSchedulePreview':updateSchedulePreview};