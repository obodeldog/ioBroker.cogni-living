function a1_0x2359(){const _0xfd7dd=['getTime','temperature','includes','dimmer','target','Auto-Erkennung','setpoint','urlaub\x20ende','mpc_','reason','374230ROvhjO','localeCompare','sensor','SET_POINT_TEMPERATURE','config','analysis.automation.confidenceThreshold','216qGVKKn','analysis.automation.lastAction','getForeignObjectsAsync','ðŸ“…\x20SMART\x20SCHEDULE:\x20Raum-Trigger\x20\x27','862119ZgDmiz',')\x20auf\x20','.1.ACTUAL_TEMPERATURE','calendarSelection','valve','off','event','setForeignStateAsync','light','8LShVQw','PERFECT','thermostatMapping','ðŸ“…\x20SMART\x20SCHEDULE:\x20\x27Globaler\x20Start\x27\x20erkannt\x20(','sort','string','setStateAsync',').\x20Heize\x20auf\x2021Â°C\x20(Vorlauf:\x20','Ist','152306XQxXxm','forEach','Unknown','Manuelles\x20Mapping','actual','Calendar\x20Check\x20Error:\x20','ðŸƒ\x20MPC\x20Autonomy:\x20Senke\x20','.1.SET_POINT_TEMPERATURE','value.valve','PrÃ¤diktion:\x20','toString','role','temp','hm-rpc','19eNLsyJ','switch','find','now','Soll','current_heating_setpoint','.data.table','level.temperature','getStateAsync','write','analysis.automation.mode','905814Tuxwch','toLowerCase','calendarInstance','common','eventStart','pi_heating_demand','ACTUAL_TEMPERATURE','name','wert','\x20min).','_calName','filter','thermostat.setpoint','unit','valveMapping',').\x20Heize\x20ganzes\x20Haus\x20auf\x20(Vorlauf:\x20','Nicht\x20gefunden','devices','active','trim','[CAL]\x20','local_temperature','number',':\x20-1Â°C\x20(Sparpotenzial\x20genutzt)','replace','.1.LEVEL','info','./ai_agent','openknx','Fehlt','log','minutes_safe','analysis.energy.warmupTimes','[MPC]\x20','room','\x27\x20erkannt\x20(','score','location','toUpperCase','exports','3455908rmEIGA','val','valve_position','type','getForeignStateAsync','SET','warn','4618810fhIhYD','summary','2217685TYxqeZ','stellwert','useCalendar','\x20->\x2021Â°C','.1.TEMPERATURE','state','apply','(((.+)+)+)+$','length','position','constructor','getForeignObjectAsync','split','parse','search','message','push','level','set','\x20->\x20Schalte\x20','Unbekannt','system.mode','occupied_heating_setpoint'];a1_0x2359=function(){return _0xfd7dd;};return a1_0x2359();}function a1_0xabbc(_0x37abbd,_0x5a79a2){const _0x37543d=a1_0x2359();return a1_0xabbc=function(_0xf0a746,_0x5644a4){_0xf0a746=_0xf0a746-0x1f0;let _0x235992=_0x37543d[_0xf0a746];return _0x235992;},a1_0xabbc(_0x37abbd,_0x5a79a2);}const a1_0x2f5128=a1_0xabbc;(function(_0x24193c,_0x4ae616){const _0x487595=a1_0xabbc,_0x46d37d=_0x24193c();while(!![]){try{const _0x15caef=-parseInt(_0x487595(0x267))/0x1*(-parseInt(_0x487595(0x259))/0x2)+parseInt(_0x487595(0x247))/0x3+-parseInt(_0x487595(0x213))/0x4+parseInt(_0x487595(0x21c))/0x5+-parseInt(_0x487595(0x272))/0x6+-parseInt(_0x487595(0x21a))/0x7*(-parseInt(_0x487595(0x250))/0x8)+-parseInt(_0x487595(0x243))/0x9*(parseInt(_0x487595(0x23d))/0xa);if(_0x15caef===_0x4ae616)break;else _0x46d37d['push'](_0x46d37d['shift']());}catch(_0x1392c1){_0x46d37d['push'](_0x46d37d['shift']());}}}(a1_0x2359,0xe1b85));const a1_0x5644a4=(function(){let _0x50952e=!![];return function(_0x23003f,_0x4b6212){const _0x4357f4=_0x50952e?function(){const _0x55fe54=a1_0xabbc;if(_0x4b6212){const _0x50c41a=_0x4b6212[_0x55fe54(0x222)](_0x23003f,arguments);return _0x4b6212=null,_0x50c41a;}}:function(){};return _0x50952e=![],_0x4357f4;};}()),a1_0xf0a746=a1_0x5644a4(this,function(){const _0x2c97e7=a1_0xabbc;return a1_0xf0a746[_0x2c97e7(0x263)]()[_0x2c97e7(0x22a)](_0x2c97e7(0x223))['toString']()[_0x2c97e7(0x226)](a1_0xf0a746)[_0x2c97e7(0x22a)](_0x2c97e7(0x223));});a1_0xf0a746();'use strict';const aiAgent=require(a1_0x2f5128(0x206)),COOLDOWN_MS=0x3c*0x3e8,lastActions={};function normalize(_0xe98691){const _0x3e45e9=a1_0x2f5128;if(!_0xe98691)return'';return _0xe98691[_0x3e45e9(0x273)]()['replace'](/\s+/g,'')[_0x3e45e9(0x1fe)]();}async function handlePrediction(_0x1f8965,_0x31d01a,_0x3145fa){const _0x47f453=a1_0x2f5128;if(!_0x31d01a||_0x31d01a===_0x47f453(0x25b))return;let _0x4d599f=_0x47f453(0x24c),_0x9323cd=0.6;try{const _0x14cb30=await _0x1f8965['getStateAsync'](_0x47f453(0x271));if(_0x14cb30&&_0x14cb30[_0x47f453(0x214)])_0x4d599f=_0x14cb30['val'];const _0x2f875c=await _0x1f8965[_0x47f453(0x26f)](_0x47f453(0x242));if(_0x2f875c&&_0x2f875c[_0x47f453(0x214)])_0x9323cd=_0x2f875c[_0x47f453(0x214)];}catch(_0x5c0b16){}if(_0x4d599f===_0x47f453(0x24c)||_0x3145fa<_0x9323cd)return;const _0x5e6333=Date[_0x47f453(0x26a)]();if(lastActions[_0x31d01a]&&_0x5e6333-lastActions[_0x31d01a]<COOLDOWN_MS)return;const _0x16cf2a=_0x1f8965[_0x47f453(0x241)]['devices']||[],_0x2dfd96=normalize(_0x31d01a),_0x6168d8=_0x16cf2a[_0x47f453(0x269)](_0x14e532=>normalize(_0x14e532[_0x47f453(0x210)])===_0x2dfd96&&(_0x14e532[_0x47f453(0x216)]===_0x47f453(0x24f)||_0x14e532[_0x47f453(0x216)]===_0x47f453(0x236)||_0x14e532[_0x47f453(0x216)]===_0x47f453(0x268)));if(!_0x6168d8){_0x1f8965[_0x47f453(0x209)]['debug']('ðŸ”\x20Device-Search\x20failed\x20for\x20predicted\x20room\x20\x27'+_0x31d01a+'\x27.');return;}const _0x1eb937=await aiAgent['consultButler'](_0x1f8965,_0x31d01a,_0x6168d8[_0x47f453(0x1f2)],_0x3145fa);if(!_0x1eb937['approved'])return;const _0x24ee50=_0x47f453(0x262)+_0x31d01a+_0x47f453(0x22f)+_0x6168d8[_0x47f453(0x1f2)]+'\x20('+_0x1eb937[_0x47f453(0x23c)]+')';await _0x1f8965[_0x47f453(0x256)](_0x47f453(0x244),{'val':'['+_0x4d599f[_0x47f453(0x211)]()+']\x20'+_0x24ee50,'ack':!![]});if(_0x4d599f===_0x47f453(0x1fd)){const _0x11418d=await _0x1f8965[_0x47f453(0x217)](_0x6168d8['id']);(!_0x11418d||!_0x11418d[_0x47f453(0x214)]&&_0x11418d[_0x47f453(0x214)]!==!![])&&await _0x1f8965['setForeignStateAsync'](_0x6168d8['id'],!![]),lastActions[_0x31d01a]=_0x5e6333;}}async function findRelatedId(_0x4cb393,_0xbb41fb,_0x16986a=a1_0x2f5128(0x239)){const _0x26dbbb=a1_0x2f5128;if(_0x16986a==='setpoint'&&_0x4cb393[_0x26dbbb(0x241)]['thermostatMapping']){let _0x1b5815=_0x4cb393[_0x26dbbb(0x241)][_0x26dbbb(0x252)];if(typeof _0x1b5815==='string')try{_0x1b5815=JSON[_0x26dbbb(0x229)](_0x1b5815);}catch(_0x120fbd){}if(_0x1b5815&&_0x1b5815[_0xbb41fb])return _0x1b5815[_0xbb41fb];}if(_0x16986a===_0x26dbbb(0x24b)&&_0x4cb393[_0x26dbbb(0x241)][_0x26dbbb(0x1f9)]){let _0x37fe78=_0x4cb393[_0x26dbbb(0x241)][_0x26dbbb(0x1f9)];if(typeof _0x37fe78===_0x26dbbb(0x255))try{_0x37fe78=JSON[_0x26dbbb(0x229)](_0x37fe78);}catch(_0x3371d8){}if(_0x37fe78&&_0x37fe78[_0xbb41fb])return _0x37fe78[_0xbb41fb];}let _0xf740f7=[];if(_0x16986a===_0x26dbbb(0x239))_0xf740f7=[{'s':_0x26dbbb(0x249),'t':_0x26dbbb(0x260)},{'s':_0x26dbbb(0x220),'t':_0x26dbbb(0x260)},{'s':_0x26dbbb(0x220),'t':'.4.SET_TEMPERATURE'},{'s':_0x26dbbb(0x1f1),'t':_0x26dbbb(0x240)},{'s':'local_temperature','t':_0x26dbbb(0x232)},{'s':'local_temperature','t':_0x26dbbb(0x26c)},{'s':_0x26dbbb(0x234),'t':'target_temperature'},{'s':'ACTUAL','t':_0x26dbbb(0x218)},{'s':_0x26dbbb(0x258),'t':_0x26dbbb(0x26b)},{'s':'temperature','t':_0x26dbbb(0x239)}];else _0x16986a===_0x26dbbb(0x24b)&&(_0xf740f7=[{'s':_0x26dbbb(0x249),'t':'.1.LEVEL'},{'s':_0x26dbbb(0x220),'t':_0x26dbbb(0x204)},{'s':_0x26dbbb(0x220),'t':'.4.VALVE_STATE'},{'s':_0x26dbbb(0x200),'t':_0x26dbbb(0x1f0)},{'s':_0x26dbbb(0x234),'t':_0x26dbbb(0x215)},{'s':_0x26dbbb(0x234),'t':_0x26dbbb(0x22d)}]);for(const _0x2cf984 of _0xf740f7){if(_0xbb41fb[_0x26dbbb(0x235)](_0x2cf984['s'])){const _0x40702d=_0xbb41fb[_0x26dbbb(0x203)](_0x2cf984['s'],_0x2cf984['t']),_0xb8ee84=await _0x4cb393[_0x26dbbb(0x227)](_0x40702d);if(_0xb8ee84)return _0x40702d;}}try{const _0x2724f4=_0xbb41fb[_0x26dbbb(0x228)]('.');if(_0x2724f4[_0x26dbbb(0x224)]>0x2){const _0x1c7bd8=_0x2724f4['slice'](0x0,-0x1)['join']('.'),_0x2f9c2d=await _0x4cb393[_0x26dbbb(0x245)](_0x1c7bd8+'.*'),_0x3dc6de=[],_0x4de8fa=_0xbb41fb['split'](/[._]+/)[_0x26dbbb(0x1f6)](_0x2a818d=>![_0x26dbbb(0x207),'0',_0x26dbbb(0x266),'ist',_0x26dbbb(0x1f3),_0x26dbbb(0x234),_0x26dbbb(0x25d),_0x26dbbb(0x23f),'messwert',_0x26dbbb(0x221)]['includes'](_0x2a818d[_0x26dbbb(0x273)]()));for(const [_0x312bd3,_0x3dff15]of Object['entries'](_0x2f9c2d)){if(_0x312bd3===_0xbb41fb)continue;if(_0x3dff15&&_0x3dff15[_0x26dbbb(0x275)]){const _0x4f362d=_0x312bd3[_0x26dbbb(0x273)](),_0x5cdce6=(_0x3dff15[_0x26dbbb(0x275)][_0x26dbbb(0x264)]||'')[_0x26dbbb(0x273)](),_0x5ef674=(_0x3dff15[_0x26dbbb(0x275)][_0x26dbbb(0x1f8)]||'')[_0x26dbbb(0x273)]();let _0x482716=![];if(_0x16986a===_0x26dbbb(0x239)&&_0x3dff15[_0x26dbbb(0x275)][_0x26dbbb(0x270)]===!![])_0x482716=_0x4f362d[_0x26dbbb(0x235)](_0x26dbbb(0x22e))||_0x4f362d['includes']('soll')||_0x4f362d[_0x26dbbb(0x235)](_0x26dbbb(0x237))||_0x5cdce6[_0x26dbbb(0x235)](_0x26dbbb(0x26e))||_0x5cdce6['includes'](_0x26dbbb(0x1f7));else _0x16986a===_0x26dbbb(0x24b)&&(_0x482716=_0x4f362d[_0x26dbbb(0x235)](_0x26dbbb(0x22d))||_0x4f362d[_0x26dbbb(0x235)](_0x26dbbb(0x24b))||_0x4f362d[_0x26dbbb(0x235)](_0x26dbbb(0x21d))||_0x4f362d['includes'](_0x26dbbb(0x225))||_0x5cdce6[_0x26dbbb(0x235)]('level.valve')||_0x5cdce6[_0x26dbbb(0x235)](_0x26dbbb(0x261))||_0x5ef674[_0x26dbbb(0x235)]('%'));if(_0x482716){const _0x58fef4=_0x312bd3[_0x26dbbb(0x228)](/[._]+/)['map'](_0x441046=>_0x441046[_0x26dbbb(0x273)]());let _0x1ac1f0=0x0;_0x4de8fa[_0x26dbbb(0x25a)](_0x1d0914=>{const _0x44d4db=_0x26dbbb;if(_0x58fef4[_0x44d4db(0x235)](_0x1d0914['toLowerCase']()))_0x1ac1f0++;}),_0x3dc6de[_0x26dbbb(0x22c)]({'id':_0x312bd3,'score':_0x1ac1f0});}}}if(_0x3dc6de[_0x26dbbb(0x224)]>0x0){_0x3dc6de[_0x26dbbb(0x254)]((_0x1ca649,_0xbcafa3)=>_0xbcafa3[_0x26dbbb(0x20f)]-_0x1ca649[_0x26dbbb(0x20f)]);if(_0x3dc6de[0x0]['score']>0x0)return _0x3dc6de[0x0]['id'];}}}catch(_0x4781c0){}return null;}async function scanThermostats(_0xf9bfbb){const _0x49970e=a1_0x2f5128,_0xdc1712=_0xf9bfbb[_0x49970e(0x241)][_0x49970e(0x1fc)]||[],_0x4809b5=[],_0x3e839a=_0xdc1712[_0x49970e(0x1f6)](_0x3b92b0=>_0x3b92b0['id']&&_0x3b92b0['id']['includes'](_0x49970e(0x234))||_0x3b92b0[_0x49970e(0x216)]&&[_0x49970e(0x234),'thermostat','sensor']['includes'](_0x3b92b0[_0x49970e(0x216)])||_0x3b92b0[_0x49970e(0x1f2)]&&_0x3b92b0[_0x49970e(0x1f2)][_0x49970e(0x273)]()[_0x49970e(0x235)](_0x49970e(0x265)));for(const _0x4994e1 of _0x3e839a){const _0x2aea75=await findRelatedId(_0xf9bfbb,_0x4994e1['id'],_0x49970e(0x239)),_0x1de53b=await findRelatedId(_0xf9bfbb,_0x4994e1['id'],_0x49970e(0x24b));let _0x17404d=_0x49970e(0x1fb),_0x3d0262=![],_0x2de520=_0xf9bfbb['config'][_0x49970e(0x252)]||{};if(typeof _0x2de520===_0x49970e(0x255))try{_0x2de520=JSON[_0x49970e(0x229)](_0x2de520);}catch(_0x599af9){}let _0x53feb2=_0xf9bfbb[_0x49970e(0x241)][_0x49970e(0x1f9)]||{};if(typeof _0x53feb2===_0x49970e(0x255))try{_0x53feb2=JSON['parse'](_0x53feb2);}catch(_0x400f9c){}if(_0x2de520[_0x4994e1['id']]&&_0x2de520[_0x4994e1['id']]===_0x2aea75||_0x53feb2[_0x4994e1['id']]&&_0x53feb2[_0x4994e1['id']]===_0x1de53b)_0x17404d=_0x49970e(0x25c),_0x3d0262=!![];else(_0x2aea75||_0x1de53b)&&(_0x17404d=_0x49970e(0x238));_0x4809b5['push']({'room':_0x4994e1[_0x49970e(0x210)]||_0x49970e(0x230),'sensorId':_0x4994e1['id'],'setpointId':_0x2aea75||'-','valveId':_0x1de53b||'-','source':_0x17404d,'isManual':_0x3d0262,'status':_0x2aea75&&_0x1de53b?_0x49970e(0x251):_0x2aea75?'OK':_0x49970e(0x208)});}return _0x4809b5['sort']((_0x15f567,_0x2b96a4)=>_0x15f567['room'][_0x49970e(0x23e)](_0x2b96a4[_0x49970e(0x20d)]));}async function checkCalendarTriggers(_0x10d28c){const _0x35f1ad=a1_0x2f5128;if(!_0x10d28c[_0x35f1ad(0x241)][_0x35f1ad(0x21e)]||!_0x10d28c['config'][_0x35f1ad(0x274)])return;let _0x14f6ac={};try{const _0x379585=await _0x10d28c[_0x35f1ad(0x26f)](_0x35f1ad(0x20b));if(_0x379585&&_0x379585[_0x35f1ad(0x214)])_0x14f6ac=JSON[_0x35f1ad(0x229)](_0x379585[_0x35f1ad(0x214)]);}catch(_0x5e668e){}try{const _0x238235=await _0x10d28c[_0x35f1ad(0x217)](_0x10d28c[_0x35f1ad(0x241)][_0x35f1ad(0x274)]+_0x35f1ad(0x26d));if(!_0x238235||!_0x238235['val'])return;const _0x54e71f=JSON[_0x35f1ad(0x229)](_0x238235[_0x35f1ad(0x214)]),_0x67b4cd=new Date(),_0x37370c=_0x10d28c[_0x35f1ad(0x241)][_0x35f1ad(0x1fc)]||[],_0x575a57=_0x10d28c['config'][_0x35f1ad(0x24a)]||[];for(const _0x25ef19 of _0x54e71f){if(_0x25ef19[_0x35f1ad(0x1f5)]&&_0x575a57[_0x35f1ad(0x224)]>0x0&&!_0x575a57['includes'](_0x25ef19['_calName']))continue;const _0x5b46c9=new Date(_0x25ef19[_0x35f1ad(0x276)]),_0x18026a=(_0x25ef19[_0x35f1ad(0x24d)]||_0x25ef19[_0x35f1ad(0x21b)]||'')['toLowerCase']();if(_0x18026a[_0x35f1ad(0x235)](_0x35f1ad(0x23a))||_0x18026a[_0x35f1ad(0x235)]('rÃ¼ckkehr')||_0x18026a[_0x35f1ad(0x235)]('ankunft')){let _0x2fa8e0=0x0;Object['values'](_0x14f6ac)[_0x35f1ad(0x25a)](_0x536b65=>{if(_0x536b65>_0x2fa8e0)_0x2fa8e0=_0x536b65;});if(_0x2fa8e0===0x0)_0x2fa8e0=0x78;const _0x194ca3=new Date(_0x5b46c9[_0x35f1ad(0x233)]()-_0x2fa8e0*0xea60),_0x59ee05=_0x67b4cd[_0x35f1ad(0x233)]()-_0x194ca3[_0x35f1ad(0x233)]();_0x59ee05>=0x0&&_0x59ee05<0xf*0xea60&&(_0x10d28c['log']['info'](_0x35f1ad(0x253)+_0x25ef19[_0x35f1ad(0x24d)]+_0x35f1ad(0x1fa)+_0x2fa8e0+_0x35f1ad(0x1f4)),await _0x10d28c[_0x35f1ad(0x256)](_0x35f1ad(0x231),{'val':'normal','ack':![]}));}for(const _0x51b8f6 of _0x37370c){if(_0x51b8f6[_0x35f1ad(0x210)]){const _0xe0944e=_0x51b8f6[_0x35f1ad(0x210)][_0x35f1ad(0x273)]();if(_0x18026a[_0x35f1ad(0x235)](_0xe0944e)){const _0x54e807=_0x14f6ac[_0x51b8f6[_0x35f1ad(0x210)]]||0x3c,_0x50ddbd=new Date(_0x5b46c9['getTime']()-_0x54e807*0xea60),_0x125cab=_0x67b4cd[_0x35f1ad(0x233)]()-_0x50ddbd[_0x35f1ad(0x233)]();if(_0x125cab>=0x0&&_0x125cab<0xf*0xea60){const _0x3a1de9=await findRelatedId(_0x10d28c,_0x51b8f6['id'],_0x35f1ad(0x239));_0x3a1de9&&(_0x10d28c[_0x35f1ad(0x209)][_0x35f1ad(0x205)](_0x35f1ad(0x246)+_0x51b8f6[_0x35f1ad(0x210)]+_0x35f1ad(0x20e)+_0x25ef19[_0x35f1ad(0x24d)]+_0x35f1ad(0x257)+_0x54e807+'\x20min).'),await _0x10d28c[_0x35f1ad(0x24e)](_0x3a1de9,0x15),await _0x10d28c['setStateAsync'](_0x35f1ad(0x244),{'val':_0x35f1ad(0x1ff)+_0x51b8f6[_0x35f1ad(0x210)]+_0x35f1ad(0x21f),'ack':!![]}));}}}}}}catch(_0x742fa7){_0x10d28c[_0x35f1ad(0x209)][_0x35f1ad(0x219)](_0x35f1ad(0x25e)+_0x742fa7[_0x35f1ad(0x22b)]);}}async function applyEnergySavings(_0x31a9c9,_0x56a256){const _0xb074eb=a1_0x2f5128,_0x125453=_0x31a9c9[_0xb074eb(0x241)][_0xb074eb(0x1fc)]||[];for(const _0x3de1a9 of _0x56a256){const _0x36b4c5=_0x3de1a9[_0xb074eb(0x20d)],_0x5061a1=_0x3de1a9[_0xb074eb(0x20a)],_0x255c9f=Date[_0xb074eb(0x26a)]();if(lastActions[_0xb074eb(0x23b)+_0x36b4c5]&&_0x255c9f-lastActions[_0xb074eb(0x23b)+_0x36b4c5]<0x1e*0x3c*0x3e8)continue;const _0x5835c4=_0x125453[_0xb074eb(0x269)](_0x208ce1=>normalize(_0x208ce1[_0xb074eb(0x210)])===normalize(_0x36b4c5));if(!_0x5835c4)continue;const _0x1c31cb=await findRelatedId(_0x31a9c9,_0x5835c4['id'],_0xb074eb(0x239));if(_0x1c31cb){const _0x3f21fa=await _0x31a9c9[_0xb074eb(0x217)](_0x1c31cb);if(_0x3f21fa&&typeof _0x3f21fa[_0xb074eb(0x214)]===_0xb074eb(0x201)){const _0x1e3b0c=_0x3f21fa['val'];if(_0x5061a1>0x1e&&_0x1e3b0c>0x11){const _0x27b9b0=_0x1e3b0c-0x1;_0x31a9c9['log'][_0xb074eb(0x205)](_0xb074eb(0x25f)+_0x36b4c5+'\x20('+_0x1c31cb+_0xb074eb(0x248)+_0x27b9b0+'Â°C\x20(Coasting\x20mÃ¶glich:\x20'+_0x5061a1+'\x20min)'),await _0x31a9c9[_0xb074eb(0x24e)](_0x1c31cb,_0x27b9b0),lastActions[_0xb074eb(0x23b)+_0x36b4c5]=_0x255c9f,await _0x31a9c9['setStateAsync'](_0xb074eb(0x244),{'val':_0xb074eb(0x20c)+_0x36b4c5+_0xb074eb(0x202),'ack':!![]});}}}}}module[a1_0x2f5128(0x212)]={'handlePrediction':handlePrediction,'applyEnergySavings':applyEnergySavings,'scanThermostats':scanThermostats,'checkCalendarTriggers':checkCalendarTriggers};