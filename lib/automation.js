const a1_0x47137f=a1_0x3fb6;(function(_0x479d09,_0xe8120c){const _0x4656c7=a1_0x3fb6,_0x1cf36d=_0x479d09();while(!![]){try{const _0x265ad5=parseInt(_0x4656c7(0x215))/0x1+-parseInt(_0x4656c7(0x1c8))/0x2*(parseInt(_0x4656c7(0x21b))/0x3)+parseInt(_0x4656c7(0x249))/0x4+parseInt(_0x4656c7(0x21c))/0x5*(parseInt(_0x4656c7(0x21d))/0x6)+parseInt(_0x4656c7(0x247))/0x7+-parseInt(_0x4656c7(0x235))/0x8*(-parseInt(_0x4656c7(0x23d))/0x9)+-parseInt(_0x4656c7(0x217))/0xa;if(_0x265ad5===_0xe8120c)break;else _0x1cf36d['push'](_0x1cf36d['shift']());}catch(_0x5f3396){_0x1cf36d['push'](_0x1cf36d['shift']());}}}(a1_0x5a71,0x76ae9));const a1_0x1fb2c4=(function(){let _0x2bfe65=!![];return function(_0x2d4961,_0x23ad51){const _0x13c367=_0x2bfe65?function(){if(_0x23ad51){const _0x23d569=_0x23ad51['apply'](_0x2d4961,arguments);return _0x23ad51=null,_0x23d569;}}:function(){};return _0x2bfe65=![],_0x13c367;};}()),a1_0x5f04bc=a1_0x1fb2c4(this,function(){const _0x2f5bd2=a1_0x3fb6;return a1_0x5f04bc[_0x2f5bd2(0x1d4)]()[_0x2f5bd2(0x1f2)](_0x2f5bd2(0x1fd))[_0x2f5bd2(0x1d4)]()[_0x2f5bd2(0x1d3)](a1_0x5f04bc)['search'](_0x2f5bd2(0x1fd));});a1_0x5f04bc();'use strict';const aiAgent=require(a1_0x47137f(0x1e1)),COOLDOWN_MS=0x3c*0x3e8,CAL_COOLDOWN_MS=0x5a*0x3c*0x3e8,ECO_TEMP=0x11,lastActions={};function a1_0x5a71(){const _0x172213=['.1.SET_POINT_TEMPERATURE','üìÖ\x20SMART\x20SCHEDULE\x20[','toUpperCase','ist','Unknown','switch','location','Unbekannt','isArray','summary','sort','Soll','replace','light','eventStart','score','ACTUAL','_date','write','trim','thermostat','setStateAsync','2606744zMXgCx','normal','thermostatMapping','valve','currentSystemMode','manual',']:\x20Raum-Trigger\x20\x27','exports','9wNxShv','event','values','info','üìÖ\x20SMART\x20SCHEDULE\x20(Phase):\x20\x27Globaler\x20Start\x27\x20erkannt.\x20Heize\x20Haus\x20auf\x20(Vorlauf:\x20','add','target_temperature',':\x20Aufheizen\x20auf\x20','push','default','1972558RKISYO','state','1991528xNZORO','valve_position','map','\x20->\x20Schalte\x20','.4.VALVE_STATE','Nicht\x20gefunden','position','active','getForeignObjectsAsync','\x20wurde\x20manuell\x20erh√∂ht.','config','level','cal_','Auto-Erkennung','\x20wieder\x20auf\x20','setForeignStateAsync','getStateAsync','Ist','length','analysis.energy.warmupTargets','entries','getForeignObjectAsync','off','TRAIN_RL_PENALTY','find','\x20ist\x20auf\x20','.1.LEVEL','value.valve','toLowerCase','name','[WATCHDOG]\x20','dimmer','ankunft','üéì\x20[RL-FEEDBACK]\x20Lerne\x20aus\x20Fehler:\x20','temperature','Classic','minutes_safe','current_heating_setpoint','üö®\x20[MPC\x20WATCHDOG]\x20','¬∞C!\x20(Puffer\x20leer).','string','triggerTime','6FRXzdV','actual',':\x20Puffer\x20leer\x20->\x20Heizen\x20auf\x20','warn','val','stringify','local_temperature','split','too_cold','[MPC\x20WARNING]\x20Kein\x20Setpoint\x20f√ºr\x20','analysis.energy.warmupSources','constructor','toString','slice','common','urlaub\x20ende','join','mpc_','target','\x20min).','\x20min)','sendToPythonWrapper','log','forEach','üßπ\x20[MPC\x20CLEANUP]\x20','./ai_agent','Fehlt','calendarInstance','\x20->\x20','ACTUAL_TEMPERATURE','¬∞C\x20(Vorlauf:\x20','devices','getForeignStateAsync','\x27\x20aktiv.\x20Heize\x20auf\x20','valveMapping','analysis.energy.schedulePreview','soll','level.valve','date','_calName','SET_POINT_TEMPERATURE','getTime','search','.1.ACTUAL_TEMPERATURE','type','¬∞C\x20(via\x20','analysis.energy.warmupTimes','parse','.1.TEMPERATURE','analysis.automation.actionLog','stellwert','unit','room','(((.+)+)+)+$','consultButler','now','.data.table','number','abs','setpoint','[CAL]\x20','unshift','calendarSelection','\x20erreicht\x20Limit\x20(','includes','wert','thermostat.setpoint','role','r√ºckkehr','approved','Manuelles\x20Mapping','Calendar\x20Check\x20Error:\x20','remove','analysis.automation.lastAction','temp','splice','hm-rpc','297356pYAzqH','Pr√§diktion:\x20','6146940jlsniD','üî•\x20[MPC\x20ACTION]\x20Heize\x20','system.mode','reason','303882grqMpY','10rGTLTa','5466cybOJD','sensor'];a1_0x5a71=function(){return _0x172213;};return a1_0x5a71();}function normalize(_0xa840b){const _0x2443b6=a1_0x47137f;if(!_0xa840b)return'';return _0xa840b[_0x2443b6(0x265)]()[_0x2443b6(0x22b)](/\s+/g,'')[_0x2443b6(0x232)]();}async function logAutomationAction(_0x5d6b6b,_0x5c5ae1){const _0x2a687d=a1_0x47137f;await _0x5d6b6b['setStateAsync'](_0x2a687d(0x211),{'val':_0x5c5ae1,'ack':!![]});try{const _0x120dd8=_0x2a687d(0x1f9),_0x378117=await _0x5d6b6b[_0x2a687d(0x259)](_0x120dd8);let _0x491f7=[];if(_0x378117&&_0x378117[_0x2a687d(0x1cc)])try{_0x491f7=JSON[_0x2a687d(0x1f7)](_0x378117['val']);}catch(_0x543f12){}_0x491f7[_0x2a687d(0x205)]({'ts':Date[_0x2a687d(0x1ff)](),'msg':_0x5c5ae1});if(_0x491f7[_0x2a687d(0x25b)]>0x32)_0x491f7=_0x491f7[_0x2a687d(0x1d5)](0x0,0x32);await _0x5d6b6b[_0x2a687d(0x234)](_0x120dd8,{'val':JSON['stringify'](_0x491f7),'ack':!![]});}catch(_0x571512){}}async function handlePrediction(_0x47bc48,_0x15331c,_0xf56f60){const _0x1d7f19=a1_0x47137f;if(!_0x15331c||_0x15331c===_0x1d7f19(0x223))return;let _0x2f9ede='off',_0x5b885d=0.6;try{const _0x50b443=await _0x47bc48['getStateAsync']('analysis.automation.mode');if(_0x50b443&&_0x50b443['val'])_0x2f9ede=_0x50b443[_0x1d7f19(0x1cc)];const _0x47f7f3=await _0x47bc48['getStateAsync']('analysis.automation.confidenceThreshold');if(_0x47f7f3&&_0x47f7f3[_0x1d7f19(0x1cc)])_0x5b885d=_0x47f7f3[_0x1d7f19(0x1cc)];}catch(_0x303464){}if(_0x2f9ede===_0x1d7f19(0x25f)||_0xf56f60<_0x5b885d)return;const _0xbeb25a=Date['now']();if(lastActions[_0x15331c]&&_0xbeb25a-lastActions[_0x15331c]<COOLDOWN_MS)return;const _0x4dab6c=_0x47bc48[_0x1d7f19(0x253)]['devices']||[],_0x489b4e=normalize(_0x15331c),_0x20fd42=_0x4dab6c['find'](_0x437bf5=>normalize(_0x437bf5[_0x1d7f19(0x225)])===_0x489b4e&&(_0x437bf5[_0x1d7f19(0x1f4)]===_0x1d7f19(0x22c)||_0x437bf5[_0x1d7f19(0x1f4)]===_0x1d7f19(0x1bd)||_0x437bf5[_0x1d7f19(0x1f4)]===_0x1d7f19(0x224)));if(!_0x20fd42)return;const _0x441be3=await aiAgent[_0x1d7f19(0x1fe)](_0x47bc48,_0x15331c,_0x20fd42['name'],_0xf56f60);if(!_0x441be3[_0x1d7f19(0x20d)])return;const _0x1dcc9b=_0x1d7f19(0x216)+_0x15331c+_0x1d7f19(0x24c)+_0x20fd42[_0x1d7f19(0x266)]+'\x20('+_0x441be3[_0x1d7f19(0x21a)]+')';await logAutomationAction(_0x47bc48,'['+_0x2f9ede[_0x1d7f19(0x221)]()+']\x20'+_0x1dcc9b);if(_0x2f9ede===_0x1d7f19(0x250)){const _0x42546f=await _0x47bc48[_0x1d7f19(0x1e8)](_0x20fd42['id']);(!_0x42546f||!_0x42546f[_0x1d7f19(0x1cc)]&&_0x42546f[_0x1d7f19(0x1cc)]!==!![])&&await _0x47bc48[_0x1d7f19(0x258)](_0x20fd42['id'],!![]),lastActions[_0x15331c]=_0xbeb25a;}}async function findRelatedId(_0x28e194,_0x2757ef,_0x10a0af='setpoint'){const _0x39be35=a1_0x47137f;if(_0x10a0af==='setpoint'&&_0x28e194[_0x39be35(0x253)][_0x39be35(0x237)]){let _0x26300a=_0x28e194[_0x39be35(0x253)][_0x39be35(0x237)];if(typeof _0x26300a===_0x39be35(0x1c6))try{_0x26300a=JSON[_0x39be35(0x1f7)](_0x26300a);}catch(_0x14e8ea){}if(_0x26300a&&_0x26300a[_0x2757ef])return _0x26300a[_0x2757ef];}if(_0x10a0af==='valve'&&_0x28e194[_0x39be35(0x253)]['valveMapping']){let _0x41f053=_0x28e194[_0x39be35(0x253)]['valveMapping'];if(typeof _0x41f053===_0x39be35(0x1c6))try{_0x41f053=JSON[_0x39be35(0x1f7)](_0x41f053);}catch(_0x52885f){}if(_0x41f053&&_0x41f053[_0x2757ef])return _0x41f053[_0x2757ef];}let _0x4677dd=[];if(_0x10a0af==='setpoint')_0x4677dd=[{'s':_0x39be35(0x1f3),'t':_0x39be35(0x21f)},{'s':_0x39be35(0x1f8),'t':_0x39be35(0x21f)},{'s':'.1.TEMPERATURE','t':'.4.SET_TEMPERATURE'},{'s':_0x39be35(0x1e5),'t':_0x39be35(0x1f0)},{'s':_0x39be35(0x1ce),'t':'occupied_heating_setpoint'},{'s':_0x39be35(0x1ce),'t':_0x39be35(0x1c3)},{'s':_0x39be35(0x1c0),'t':_0x39be35(0x243)},{'s':_0x39be35(0x22f),'t':'SET'},{'s':_0x39be35(0x25a),'t':_0x39be35(0x22a)},{'s':_0x39be35(0x1c0),'t':'setpoint'}];else _0x10a0af===_0x39be35(0x238)&&(_0x4677dd=[{'s':'.1.ACTUAL_TEMPERATURE','t':_0x39be35(0x263)},{'s':_0x39be35(0x1f8),'t':_0x39be35(0x263)},{'s':_0x39be35(0x1f8),'t':_0x39be35(0x24d)},{'s':_0x39be35(0x1ce),'t':'pi_heating_demand'},{'s':'temperature','t':_0x39be35(0x24a)},{'s':_0x39be35(0x1c0),'t':_0x39be35(0x254)}]);for(const _0x515719 of _0x4677dd){if(_0x2757ef[_0x39be35(0x208)](_0x515719['s'])){const _0x1712ba=_0x2757ef['replace'](_0x515719['s'],_0x515719['t']),_0x2bb6af=await _0x28e194[_0x39be35(0x25e)](_0x1712ba);if(_0x2bb6af)return _0x1712ba;}}try{const _0x16254f=_0x2757ef[_0x39be35(0x1cf)]('.');if(_0x16254f[_0x39be35(0x25b)]>0x2){const _0x511507=_0x16254f[_0x39be35(0x1d5)](0x0,-0x1)[_0x39be35(0x1d8)]('.'),_0x3f6e5e=await _0x28e194[_0x39be35(0x251)](_0x511507+'.*'),_0x299143=[],_0x4bba04=_0x2757ef['split'](/[._]+/)['filter'](_0x39302b=>!['openknx','0',_0x39be35(0x214),_0x39be35(0x222),_0x39be35(0x209),'temperature',_0x39be35(0x1c9),_0x39be35(0x21e),'messwert',_0x39be35(0x248)][_0x39be35(0x208)](_0x39302b[_0x39be35(0x265)]()));for(const [_0x476157,_0x568db7]of Object[_0x39be35(0x25d)](_0x3f6e5e)){if(_0x476157===_0x2757ef)continue;if(_0x568db7&&_0x568db7[_0x39be35(0x1d6)]){const _0xc42a81=_0x476157[_0x39be35(0x265)](),_0x47e378=(_0x568db7[_0x39be35(0x1d6)][_0x39be35(0x20b)]||'')[_0x39be35(0x265)](),_0x49c9bd=(_0x568db7[_0x39be35(0x1d6)][_0x39be35(0x1fb)]||'')['toLowerCase']();let _0x3f2539=![];if(_0x10a0af===_0x39be35(0x203)&&_0x568db7[_0x39be35(0x1d6)][_0x39be35(0x231)]===!![])_0x3f2539=_0xc42a81['includes']('set')||_0xc42a81[_0x39be35(0x208)](_0x39be35(0x1ec))||_0xc42a81[_0x39be35(0x208)]('target')||_0x47e378[_0x39be35(0x208)]('level.temperature')||_0x47e378['includes'](_0x39be35(0x20a));else _0x10a0af==='valve'&&(_0x3f2539=_0xc42a81[_0x39be35(0x208)](_0x39be35(0x254))||_0xc42a81['includes'](_0x39be35(0x238))||_0xc42a81[_0x39be35(0x208)](_0x39be35(0x1fa))||_0xc42a81[_0x39be35(0x208)](_0x39be35(0x24f))||_0x47e378['includes'](_0x39be35(0x1ed))||_0x47e378[_0x39be35(0x208)](_0x39be35(0x264))||_0x49c9bd[_0x39be35(0x208)]('%'));if(_0x3f2539){const _0x3bc583=_0x476157['split'](/[._]+/)[_0x39be35(0x24b)](_0x482fef=>_0x482fef['toLowerCase']());let _0x4c3449=0x0;_0x4bba04[_0x39be35(0x1df)](_0x3130fa=>{const _0x407db8=_0x39be35;if(_0x3bc583[_0x407db8(0x208)](_0x3130fa[_0x407db8(0x265)]()))_0x4c3449++;}),_0x299143[_0x39be35(0x245)]({'id':_0x476157,'score':_0x4c3449});}}}if(_0x299143[_0x39be35(0x25b)]>0x0){_0x299143['sort']((_0xcc0ba9,_0x5d0db3)=>_0x5d0db3[_0x39be35(0x22e)]-_0xcc0ba9['score']);if(_0x299143[0x0][_0x39be35(0x22e)]>0x0)return _0x299143[0x0]['id'];}}}catch(_0x50e646){}return null;}async function scanThermostats(_0x20f917){const _0x45ff05=a1_0x47137f,_0x4f1d2e=_0x20f917[_0x45ff05(0x253)][_0x45ff05(0x1e7)]||[],_0x45169b=[],_0x2e00e9=_0x4f1d2e['filter'](_0x533109=>_0x533109['id']&&_0x533109['id'][_0x45ff05(0x208)]('temperature')||_0x533109[_0x45ff05(0x1f4)]&&[_0x45ff05(0x1c0),_0x45ff05(0x233),_0x45ff05(0x21e)][_0x45ff05(0x208)](_0x533109['type'])||_0x533109[_0x45ff05(0x266)]&&_0x533109['name'][_0x45ff05(0x265)]()[_0x45ff05(0x208)](_0x45ff05(0x212)));for(const _0x2a076e of _0x2e00e9){const _0x341094=await findRelatedId(_0x20f917,_0x2a076e['id'],_0x45ff05(0x203)),_0x588ba6=await findRelatedId(_0x20f917,_0x2a076e['id'],_0x45ff05(0x238));let _0x5d2fe8=_0x45ff05(0x24e),_0x2f6956=![],_0x2f760f=_0x20f917[_0x45ff05(0x253)][_0x45ff05(0x237)]||{};if(typeof _0x2f760f===_0x45ff05(0x1c6))try{_0x2f760f=JSON['parse'](_0x2f760f);}catch(_0x1cb3e2){}let _0x436da1=_0x20f917['config'][_0x45ff05(0x1ea)]||{};if(typeof _0x436da1===_0x45ff05(0x1c6))try{_0x436da1=JSON[_0x45ff05(0x1f7)](_0x436da1);}catch(_0xeeff8a){}if(_0x2f760f[_0x2a076e['id']]&&_0x2f760f[_0x2a076e['id']]===_0x341094||_0x436da1[_0x2a076e['id']]&&_0x436da1[_0x2a076e['id']]===_0x588ba6)_0x5d2fe8=_0x45ff05(0x20e),_0x2f6956=!![];else(_0x341094||_0x588ba6)&&(_0x5d2fe8=_0x45ff05(0x256));_0x45169b[_0x45ff05(0x245)]({'room':_0x2a076e[_0x45ff05(0x225)]||_0x45ff05(0x226),'sensorId':_0x2a076e['id'],'setpointId':_0x341094||'-','valveId':_0x588ba6||'-','source':_0x5d2fe8,'isManual':_0x2f6956,'status':_0x341094&&_0x588ba6?'PERFECT':_0x341094?'OK':_0x45ff05(0x1e2)});}return _0x45169b[_0x45ff05(0x229)]((_0x4cc46c,_0x411bf9)=>_0x4cc46c[_0x45ff05(0x1fc)]['localeCompare'](_0x411bf9[_0x45ff05(0x1fc)]));}async function updateSchedulePreview(_0x44d6d4){const _0x45caf5=a1_0x47137f;if(!_0x44d6d4['config']['useCalendar']||!_0x44d6d4[_0x45caf5(0x253)][_0x45caf5(0x1e3)])return;let _0x4aa802={};try{const _0x20620a=await _0x44d6d4[_0x45caf5(0x259)](_0x45caf5(0x1f6));if(_0x20620a&&_0x20620a['val'])_0x4aa802=JSON[_0x45caf5(0x1f7)](_0x20620a[_0x45caf5(0x1cc)]);}catch(_0x43b3e4){}const _0x25ae33=[],_0x2f53e5=Date[_0x45caf5(0x1ff)](),_0x1726e7=0x30*0x3c*0x3c*0x3e8;try{const _0x531eec=await _0x44d6d4[_0x45caf5(0x1e8)](_0x44d6d4[_0x45caf5(0x253)][_0x45caf5(0x1e3)]+'.data.table');if(!_0x531eec||!_0x531eec[_0x45caf5(0x1cc)])return;const _0x369e30=JSON[_0x45caf5(0x1f7)](_0x531eec['val']),_0x156938=_0x44d6d4[_0x45caf5(0x253)][_0x45caf5(0x206)]||[],_0x2811f1=_0x44d6d4['config'][_0x45caf5(0x1e7)]||[],_0x375763=new Set();_0x2811f1[_0x45caf5(0x1df)](_0x368831=>{const _0x56ccb0=_0x45caf5;if(_0x368831[_0x56ccb0(0x225)])_0x375763[_0x56ccb0(0x242)](_0x368831['location']);});for(const _0x4992e7 of _0x369e30){if(_0x4992e7[_0x45caf5(0x1ef)]&&_0x156938[_0x45caf5(0x25b)]>0x0&&!_0x156938[_0x45caf5(0x208)](_0x4992e7['_calName']))continue;const _0x2c3dbe=_0x4992e7[_0x45caf5(0x230)]||_0x4992e7['eventStart']||_0x4992e7[_0x45caf5(0x1ee)];if(!_0x2c3dbe)continue;const _0x185344=new Date(_0x2c3dbe),_0x2d1775=_0x185344[_0x45caf5(0x1f1)]();if(isNaN(_0x2d1775))continue;if(_0x2d1775<_0x2f53e5)continue;if(_0x2d1775>_0x2f53e5+_0x1726e7)continue;const _0x313eb3=(_0x4992e7[_0x45caf5(0x23e)]||_0x4992e7[_0x45caf5(0x228)]||'')[_0x45caf5(0x265)]();let _0x4db544=![],_0x49a899=[],_0x3f8e4f=_0x4992e7[_0x45caf5(0x23e)]||_0x4992e7[_0x45caf5(0x228)]||'Unbekannt';if(_0x313eb3[_0x45caf5(0x208)](_0x45caf5(0x1d7))||_0x313eb3['includes'](_0x45caf5(0x20c))||_0x313eb3['includes'](_0x45caf5(0x1be)))_0x4db544=!![],_0x49a899=Array['from'](_0x375763);else for(const _0x5c7636 of _0x375763){if(_0x313eb3['includes'](_0x5c7636['toLowerCase']()))_0x49a899[_0x45caf5(0x245)](_0x5c7636);}_0x49a899[_0x45caf5(0x25b)]>0x0&&_0x49a899['forEach'](_0x50170d=>{const _0x31da07=_0x45caf5;let _0x5e25fc=0x3c;if(_0x4db544){let _0x2c5dc4=0x0;Object[_0x31da07(0x23f)](_0x4aa802)[_0x31da07(0x1df)](_0x4f4311=>{if(_0x4f4311>_0x2c5dc4)_0x2c5dc4=_0x4f4311;}),_0x5e25fc=_0x2c5dc4>0x0?_0x2c5dc4:0x78;}else _0x5e25fc=_0x4aa802[_0x50170d]||0x3c;const _0x115b84=new Date(_0x2d1775-_0x5e25fc*0xea60);_0x25ae33[_0x31da07(0x245)]({'eventTime':_0x2d1775,'triggerTime':_0x115b84[_0x31da07(0x1f1)](),'room':_0x50170d,'minutes':_0x5e25fc,'reason':_0x3f8e4f,'isGlobal':_0x4db544});});}}catch(_0x3c6459){}_0x25ae33[_0x45caf5(0x229)]((_0x2c7377,_0x39873e)=>_0x2c7377[_0x45caf5(0x1c7)]-_0x39873e[_0x45caf5(0x1c7)]);const _0x2d1eec=_0x25ae33['slice'](0x0,0x5);await _0x44d6d4[_0x45caf5(0x234)](_0x45caf5(0x1eb),{'val':JSON[_0x45caf5(0x1cd)](_0x2d1eec),'ack':!![]});}function a1_0x3fb6(_0x9d008f,_0x3477e9){const _0x37393b=a1_0x5a71();return a1_0x3fb6=function(_0x5f04bc,_0x1fb2c4){_0x5f04bc=_0x5f04bc-0x1bc;let _0x5a71fb=_0x37393b[_0x5f04bc];return _0x5a71fb;},a1_0x3fb6(_0x9d008f,_0x3477e9);}async function checkCalendarTriggers(_0x78e1cc){const _0x3598d5=a1_0x47137f;if(!_0x78e1cc[_0x3598d5(0x253)]['useCalendar']||!_0x78e1cc['config'][_0x3598d5(0x1e3)])return;await updateSchedulePreview(_0x78e1cc);let _0x97499c={},_0x3b1eca={};try{const _0x29cf88=await _0x78e1cc['getStateAsync']('analysis.energy.warmupTimes');if(_0x29cf88&&_0x29cf88[_0x3598d5(0x1cc)])_0x97499c=JSON[_0x3598d5(0x1f7)](_0x29cf88[_0x3598d5(0x1cc)]);const _0x2ea6aa=await _0x78e1cc[_0x3598d5(0x259)](_0x3598d5(0x1d2));if(_0x2ea6aa&&_0x2ea6aa[_0x3598d5(0x1cc)])_0x3b1eca=JSON[_0x3598d5(0x1f7)](_0x2ea6aa['val']);}catch(_0x166618){}let _0x511b35={'default':0x15};try{const _0x46b757=await _0x78e1cc[_0x3598d5(0x259)](_0x3598d5(0x25c));if(_0x46b757&&_0x46b757['val'])_0x511b35=JSON['parse'](_0x46b757['val']);}catch(_0x46b88f){}try{const _0x29f0df=await _0x78e1cc[_0x3598d5(0x1e8)](_0x78e1cc[_0x3598d5(0x253)]['calendarInstance']+_0x3598d5(0x200));if(!_0x29f0df||!_0x29f0df['val'])return;const _0x433533=JSON[_0x3598d5(0x1f7)](_0x29f0df[_0x3598d5(0x1cc)]),_0xb9d928=Date['now'](),_0x5e9a1a=_0x78e1cc[_0x3598d5(0x253)][_0x3598d5(0x1e7)]||[],_0x1b46d6=_0x78e1cc[_0x3598d5(0x253)][_0x3598d5(0x206)]||[];for(const _0x40a9c9 of _0x433533){if(_0x40a9c9[_0x3598d5(0x1ef)]&&_0x1b46d6['length']>0x0&&!_0x1b46d6[_0x3598d5(0x208)](_0x40a9c9[_0x3598d5(0x1ef)]))continue;const _0x36dcd1=_0x40a9c9[_0x3598d5(0x230)]||_0x40a9c9[_0x3598d5(0x22d)]||_0x40a9c9['date'];if(!_0x36dcd1)continue;const _0x31c501=new Date(_0x36dcd1);if(isNaN(_0x31c501[_0x3598d5(0x1f1)]()))continue;const _0x3da9f2=(_0x40a9c9[_0x3598d5(0x23e)]||_0x40a9c9[_0x3598d5(0x228)]||'')[_0x3598d5(0x265)]();if(_0x3da9f2[_0x3598d5(0x208)]('urlaub\x20ende')||_0x3da9f2[_0x3598d5(0x208)](_0x3598d5(0x20c))||_0x3da9f2['includes'](_0x3598d5(0x1be))){let _0x5e7eba=0x0;Object[_0x3598d5(0x23f)](_0x97499c)['forEach'](_0x5e1e36=>{if(_0x5e1e36>_0x5e7eba)_0x5e7eba=_0x5e1e36;});if(_0x5e7eba===0x0)_0x5e7eba=0x78;const _0x27b8c3=_0x31c501['getTime']()-_0x5e7eba*0xea60;_0xb9d928>=_0x27b8c3&&_0xb9d928<_0x31c501['getTime']()&&(_0x78e1cc[_0x3598d5(0x239)]!==_0x3598d5(0x236)&&(_0x78e1cc[_0x3598d5(0x1de)][_0x3598d5(0x240)](_0x3598d5(0x241)+_0x5e7eba+_0x3598d5(0x1db)),await _0x78e1cc[_0x3598d5(0x234)](_0x3598d5(0x219),{'val':'normal','ack':![]})));}for(const _0x500e2d of _0x5e9a1a){if(_0x500e2d[_0x3598d5(0x225)]){const _0x55d7b4=_0x500e2d['location'][_0x3598d5(0x265)]();if(_0x3da9f2['includes'](_0x55d7b4)){const _0x560339=_0x97499c[_0x500e2d['location']]||0x3c,_0x547532=_0x3b1eca[_0x500e2d['location']]||_0x3598d5(0x1c1),_0x54a468=_0x31c501['getTime']()-_0x560339*0xea60;if(_0xb9d928>=_0x54a468&&_0xb9d928<_0x31c501[_0x3598d5(0x1f1)]()){const _0x36b571=lastActions[_0x3598d5(0x255)+_0x500e2d[_0x3598d5(0x225)]];if(_0x36b571&&_0xb9d928-_0x36b571<CAL_COOLDOWN_MS)continue;const _0x5ac6c6=await findRelatedId(_0x78e1cc,_0x500e2d['id'],_0x3598d5(0x203));if(_0x5ac6c6){let _0xa9dc83=_0x511b35[_0x500e2d['location']];if(_0xa9dc83===undefined)_0xa9dc83=_0x511b35[_0x3598d5(0x246)];if(_0xa9dc83===undefined)_0xa9dc83=0x15;const _0x109723=await _0x78e1cc['getForeignStateAsync'](_0x5ac6c6);_0x109723&&typeof _0x109723[_0x3598d5(0x1cc)]===_0x3598d5(0x201)&&_0x109723[_0x3598d5(0x1cc)]<_0xa9dc83-0.5&&(_0x78e1cc['log']['info'](_0x3598d5(0x220)+_0x547532+_0x3598d5(0x23b)+_0x500e2d[_0x3598d5(0x225)]+_0x3598d5(0x1e9)+_0xa9dc83+_0x3598d5(0x1e6)+_0x560339+_0x3598d5(0x1db)),await _0x78e1cc[_0x3598d5(0x258)](_0x5ac6c6,_0xa9dc83),await logAutomationAction(_0x78e1cc,_0x3598d5(0x204)+_0x500e2d[_0x3598d5(0x225)]+_0x3598d5(0x1e4)+_0xa9dc83+_0x3598d5(0x1f5)+_0x547532+')'),lastActions[_0x3598d5(0x255)+_0x500e2d[_0x3598d5(0x225)]]=_0xb9d928);}}}}}}}catch(_0x117151){_0x78e1cc[_0x3598d5(0x1de)][_0x3598d5(0x1cb)](_0x3598d5(0x20f)+_0x117151['message']);}}async function manageMpcIntervention(_0x5e35b4,_0x48cca9,_0x5ece45){const _0x22c38c=a1_0x47137f;try{const _0x3ebc73='analysis.energy.mpcActiveInterventions',_0xbb298=await _0x5e35b4['getStateAsync'](_0x3ebc73);let _0x414ee5=[];if(_0xbb298&&_0xbb298[_0x22c38c(0x1cc)])try{_0x414ee5=JSON[_0x22c38c(0x1f7)](_0xbb298['val']);}catch(_0x4a031d){}const _0x3c3a85=_0x414ee5['indexOf'](_0x48cca9);if(_0x5ece45===_0x22c38c(0x242))_0x3c3a85===-0x1&&(_0x414ee5['push'](_0x48cca9),await _0x5e35b4[_0x22c38c(0x234)](_0x3ebc73,{'val':JSON[_0x22c38c(0x1cd)](_0x414ee5),'ack':!![]}));else _0x5ece45===_0x22c38c(0x210)&&(_0x3c3a85!==-0x1&&(_0x414ee5[_0x22c38c(0x213)](_0x3c3a85,0x1),await _0x5e35b4[_0x22c38c(0x234)](_0x3ebc73,{'val':JSON[_0x22c38c(0x1cd)](_0x414ee5),'ack':!![]})));}catch(_0x2cc046){}}async function cleanupGhostInterventions(_0x37d70d){const _0x31bdcd=a1_0x47137f;try{const _0x2b6713='analysis.energy.mpcActiveInterventions',_0x3a85d5=await _0x37d70d[_0x31bdcd(0x259)](_0x2b6713);if(!_0x3a85d5||!_0x3a85d5[_0x31bdcd(0x1cc)])return;const _0x52f2a6=JSON[_0x31bdcd(0x1f7)](_0x3a85d5[_0x31bdcd(0x1cc)]);if(!Array[_0x31bdcd(0x227)](_0x52f2a6)||_0x52f2a6[_0x31bdcd(0x25b)]===0x0)return;let _0x430957={'default':0x15};try{const _0x532982=await _0x37d70d['getStateAsync'](_0x31bdcd(0x25c));if(_0x532982&&_0x532982[_0x31bdcd(0x1cc)])_0x430957=JSON[_0x31bdcd(0x1f7)](_0x532982['val']);}catch(_0x551f5d){}const _0x55c8a1=_0x37d70d[_0x31bdcd(0x253)]['devices']||[];let _0x2518d3=![];for(let _0x583728=_0x52f2a6[_0x31bdcd(0x25b)]-0x1;_0x583728>=0x0;_0x583728--){const _0x5436cd=_0x52f2a6[_0x583728],_0x34b788=_0x55c8a1['find'](_0x215159=>normalize(_0x215159[_0x31bdcd(0x225)])===normalize(_0x5436cd)&&(_0x215159[_0x31bdcd(0x1f4)]===_0x31bdcd(0x1c0)||_0x215159[_0x31bdcd(0x1f4)]===_0x31bdcd(0x233)));if(_0x34b788){const _0x4dbc5b=await findRelatedId(_0x37d70d,_0x34b788['id'],_0x31bdcd(0x203)),_0x3068b9=await _0x37d70d['getForeignStateAsync'](_0x34b788['id']);if(_0x4dbc5b){const _0x29bee1=await _0x37d70d[_0x31bdcd(0x1e8)](_0x4dbc5b);if(_0x29bee1&&typeof _0x29bee1[_0x31bdcd(0x1cc)]===_0x31bdcd(0x201)){let _0x5ec97a=![],_0x367ca1='';Math[_0x31bdcd(0x202)](_0x29bee1[_0x31bdcd(0x1cc)]-ECO_TEMP)>0.5&&(_0x5ec97a=!![],_0x367ca1=_0x31bdcd(0x23a));if(!_0x5ec97a&&_0x3068b9&&typeof _0x3068b9[_0x31bdcd(0x1cc)]==='number'){const _0x39b28f=_0x430957[_0x5436cd]||_0x430957[_0x31bdcd(0x246)]||0x15;_0x3068b9['val']<_0x39b28f+0.2&&(_0x5ec97a=!![],_0x367ca1=_0x31bdcd(0x1d0));}if(_0x5ec97a){if(_0x367ca1===_0x31bdcd(0x23a))_0x37d70d[_0x31bdcd(0x1de)]['info'](_0x31bdcd(0x1e0)+_0x5436cd+_0x31bdcd(0x262)+_0x29bee1[_0x31bdcd(0x1cc)]+'¬∞C\x20(nicht\x20'+ECO_TEMP+'¬∞C).\x20Entferne\x20Status.'),_0x29bee1[_0x31bdcd(0x1cc)]>ECO_TEMP+0.5&&(_0x37d70d[_0x31bdcd(0x1dd)]&&(_0x37d70d[_0x31bdcd(0x1de)][_0x31bdcd(0x240)](_0x31bdcd(0x1bf)+_0x5436cd+_0x31bdcd(0x252)),_0x37d70d[_0x31bdcd(0x1dd)](_0x31bdcd(0x260),{'room':_0x5436cd})));else{if(_0x367ca1==='too_cold'){const _0x50aaac=_0x430957[_0x5436cd]||_0x430957[_0x31bdcd(0x246)]||0x15;_0x37d70d[_0x31bdcd(0x1de)]['info'](_0x31bdcd(0x1c4)+_0x5436cd+_0x31bdcd(0x207)+_0x3068b9[_0x31bdcd(0x1cc)]+'¬∞C\x20<\x20'+(_0x50aaac+0.2)+'¬∞C).\x20Sparmodus\x20beendet!'),await _0x37d70d[_0x31bdcd(0x258)](_0x4dbc5b,_0x50aaac),await logAutomationAction(_0x37d70d,_0x31bdcd(0x1bc)+_0x5436cd+_0x31bdcd(0x1ca)+_0x50aaac+'¬∞C');}}_0x52f2a6[_0x31bdcd(0x213)](_0x583728,0x1),_0x2518d3=!![];}}}}}_0x2518d3&&await _0x37d70d[_0x31bdcd(0x234)](_0x2b6713,{'val':JSON[_0x31bdcd(0x1cd)](_0x52f2a6),'ack':!![]});}catch(_0x51fd1c){}}async function applyEnergySavings(_0x4ab56d,_0x26f763){const _0x5aa12d=a1_0x47137f;await cleanupGhostInterventions(_0x4ab56d);if(!_0x26f763||_0x26f763[_0x5aa12d(0x25b)]===0x0)return;const _0x36c875=_0x4ab56d['config'][_0x5aa12d(0x1e7)]||[],_0x5bee83=Date['now']();for(const _0x3928e6 of _0x26f763){const _0xada7b5=_0x3928e6[_0x5aa12d(0x1fc)],_0x217fed=_0x3928e6[_0x5aa12d(0x1c2)],_0x28f18c=_0x3928e6[_0x5aa12d(0x1da)]||0x15,_0x27410e=_0x36c875[_0x5aa12d(0x261)](_0x4c14ba=>normalize(_0x4c14ba[_0x5aa12d(0x225)])===normalize(_0xada7b5)&&(_0x4c14ba[_0x5aa12d(0x1f4)]==='temperature'||_0x4c14ba['type']==='thermostat'));if(!_0x27410e)continue;const _0x148615=await findRelatedId(_0x4ab56d,_0x27410e['id'],_0x5aa12d(0x203));if(_0x148615){if(lastActions[_0x5aa12d(0x1d9)+_0xada7b5]&&_0x5bee83-lastActions[_0x5aa12d(0x1d9)+_0xada7b5]<0x1e*0x3c*0x3e8)continue;const _0x510e05=await _0x4ab56d[_0x5aa12d(0x1e8)](_0x148615);if(_0x510e05&&typeof _0x510e05['val']===_0x5aa12d(0x201)){const _0x493383=_0x510e05[_0x5aa12d(0x1cc)];_0x493383!==ECO_TEMP&&await manageMpcIntervention(_0x4ab56d,_0xada7b5,'remove');if(_0x217fed>0x1e)_0x493383>ECO_TEMP+0.5&&(_0x4ab56d[_0x5aa12d(0x1de)][_0x5aa12d(0x240)]('üçÉ\x20[MPC\x20ACTION]\x20Senke\x20'+_0xada7b5+'\x20auf\x20'+ECO_TEMP+'¬∞C!\x20(Puffer:\x20'+_0x217fed+_0x5aa12d(0x1dc)),await _0x4ab56d['setForeignStateAsync'](_0x148615,ECO_TEMP),await manageMpcIntervention(_0x4ab56d,_0xada7b5,_0x5aa12d(0x242)),lastActions[_0x5aa12d(0x1d9)+_0xada7b5]=_0x5bee83,await logAutomationAction(_0x4ab56d,'[MPC]\x20'+_0xada7b5+':\x20Absenkung\x20auf\x20'+ECO_TEMP+'¬∞C'));else _0x217fed<=0xf&&(_0x493383<_0x28f18c&&(_0x4ab56d['log'][_0x5aa12d(0x240)](_0x5aa12d(0x218)+_0xada7b5+_0x5aa12d(0x257)+_0x28f18c+_0x5aa12d(0x1c5)),await _0x4ab56d[_0x5aa12d(0x258)](_0x148615,_0x28f18c),await manageMpcIntervention(_0x4ab56d,_0xada7b5,'remove'),lastActions[_0x5aa12d(0x1d9)+_0xada7b5]=_0x5bee83,await logAutomationAction(_0x4ab56d,'[MPC]\x20'+_0xada7b5+_0x5aa12d(0x244)+_0x28f18c+'¬∞C')));}}else _0x4ab56d[_0x5aa12d(0x1de)]['warn'](_0x5aa12d(0x1d1)+_0xada7b5+'\x20gefunden!');}}module[a1_0x47137f(0x23c)]={'handlePrediction':handlePrediction,'applyEnergySavings':applyEnergySavings,'scanThermostats':scanThermostats,'checkCalendarTriggers':checkCalendarTriggers,'updateSchedulePreview':updateSchedulePreview,'cleanupGhostInterventions':cleanupGhostInterventions};