const a1_0x3b4beb=a1_0x229c;(function(_0x136fc0,_0x44a72c){const _0x2f8f7b=a1_0x229c,_0x179435=_0x136fc0();while(!![]){try{const _0x5ef458=-parseInt(_0x2f8f7b(0x195))/0x1*(-parseInt(_0x2f8f7b(0x169))/0x2)+parseInt(_0x2f8f7b(0x17c))/0x3*(-parseInt(_0x2f8f7b(0x1c6))/0x4)+-parseInt(_0x2f8f7b(0x1a0))/0x5*(parseInt(_0x2f8f7b(0x179))/0x6)+-parseInt(_0x2f8f7b(0x1dc))/0x7*(-parseInt(_0x2f8f7b(0x16a))/0x8)+-parseInt(_0x2f8f7b(0x186))/0x9*(parseInt(_0x2f8f7b(0x196))/0xa)+parseInt(_0x2f8f7b(0x1a5))/0xb*(-parseInt(_0x2f8f7b(0x193))/0xc)+parseInt(_0x2f8f7b(0x15d))/0xd;if(_0x5ef458===_0x44a72c)break;else _0x179435['push'](_0x179435['shift']());}catch(_0x384003){_0x179435['push'](_0x179435['shift']());}}}(a1_0x369f,0xd0eb0));const a1_0x43838d=(function(){let _0x554e9d=!![];return function(_0x134258,_0x5a4532){const _0x4aae8b=_0x554e9d?function(){const _0x2b245d=a1_0x229c;if(_0x5a4532){const _0x540023=_0x5a4532[_0x2b245d(0x1d8)](_0x134258,arguments);return _0x5a4532=null,_0x540023;}}:function(){};return _0x554e9d=![],_0x4aae8b;};}()),a1_0x2a40aa=a1_0x43838d(this,function(){const _0x1b89e2=a1_0x229c;return a1_0x2a40aa['toString']()[_0x1b89e2(0x17f)](_0x1b89e2(0x1c7))[_0x1b89e2(0x1b4)]()[_0x1b89e2(0x182)](a1_0x2a40aa)['search']('(((.+)+)+)+$');});a1_0x2a40aa();'use strict';function a1_0x229c(_0x507612,_0x285ac6){const _0xd9dba=a1_0x369f();return a1_0x229c=function(_0x2a40aa,_0x43838d){_0x2a40aa=_0x2a40aa-0x152;let _0x369fa7=_0xd9dba[_0x2a40aa];return _0x369fa7;},a1_0x229c(_0x507612,_0x285ac6);}const aiAgent=require(a1_0x3b4beb(0x199)),COOLDOWN_MS=0x3c*0x3e8,ECO_TEMP=0x11,lastActions={};function normalize(_0x53f684){const _0x38af07=a1_0x3b4beb;if(!_0x53f684)return'';return _0x53f684[_0x38af07(0x1a6)]()[_0x38af07(0x1b9)](/\s+/g,'')['trim']();}async function handlePrediction(_0x1bdf46,_0x1fcfc4,_0x5a794e){const _0x2e94e1=a1_0x3b4beb;if(!_0x1fcfc4||_0x1fcfc4===_0x2e94e1(0x170))return;let _0x11646e=_0x2e94e1(0x1a7),_0x46163c=0.6;try{const _0x1ed98b=await _0x1bdf46['getStateAsync']('analysis.automation.mode');if(_0x1ed98b&&_0x1ed98b[_0x2e94e1(0x1cc)])_0x11646e=_0x1ed98b['val'];const _0x5eba8c=await _0x1bdf46['getStateAsync']('analysis.automation.confidenceThreshold');if(_0x5eba8c&&_0x5eba8c['val'])_0x46163c=_0x5eba8c[_0x2e94e1(0x1cc)];}catch(_0x197de8){}if(_0x11646e===_0x2e94e1(0x1a7)||_0x5a794e<_0x46163c)return;const _0x1debad=Date[_0x2e94e1(0x154)]();if(lastActions[_0x1fcfc4]&&_0x1debad-lastActions[_0x1fcfc4]<COOLDOWN_MS)return;const _0x3635d4=_0x1bdf46[_0x2e94e1(0x156)]['devices']||[],_0x4f4de0=normalize(_0x1fcfc4),_0x508b76=_0x3635d4['find'](_0x1dc8f0=>normalize(_0x1dc8f0[_0x2e94e1(0x18c)])===_0x4f4de0&&(_0x1dc8f0[_0x2e94e1(0x1df)]===_0x2e94e1(0x1b1)||_0x1dc8f0[_0x2e94e1(0x1df)]===_0x2e94e1(0x197)||_0x1dc8f0['type']===_0x2e94e1(0x1b0)));if(!_0x508b76){_0x1bdf46[_0x2e94e1(0x181)]['debug']('ðŸ”\x20Device-Search\x20failed\x20for\x20predicted\x20room\x20\x27'+_0x1fcfc4+'\x27.');return;}const _0x21d8bb=await aiAgent[_0x2e94e1(0x172)](_0x1bdf46,_0x1fcfc4,_0x508b76['name'],_0x5a794e);if(!_0x21d8bb[_0x2e94e1(0x178)])return;const _0x566868=_0x2e94e1(0x166)+_0x1fcfc4+'\x20->\x20Schalte\x20'+_0x508b76['name']+'\x20('+_0x21d8bb[_0x2e94e1(0x162)]+')';await _0x1bdf46['setStateAsync'](_0x2e94e1(0x194),{'val':'['+_0x11646e['toUpperCase']()+']\x20'+_0x566868,'ack':!![]});if(_0x11646e==='active'){const _0x3e9136=await _0x1bdf46[_0x2e94e1(0x1b5)](_0x508b76['id']);(!_0x3e9136||!_0x3e9136[_0x2e94e1(0x1cc)]&&_0x3e9136[_0x2e94e1(0x1cc)]!==!![])&&await _0x1bdf46[_0x2e94e1(0x1c0)](_0x508b76['id'],!![]),lastActions[_0x1fcfc4]=_0x1debad;}}async function findRelatedId(_0x599cf5,_0x1d828c,_0x4bc810='setpoint'){const _0x14a5cd=a1_0x3b4beb;if(_0x4bc810===_0x14a5cd(0x1a3)&&_0x599cf5[_0x14a5cd(0x156)][_0x14a5cd(0x1ba)]){let _0x28ea1d=_0x599cf5['config']['thermostatMapping'];if(typeof _0x28ea1d===_0x14a5cd(0x1d9))try{_0x28ea1d=JSON['parse'](_0x28ea1d);}catch(_0x2ccdd7){}if(_0x28ea1d&&_0x28ea1d[_0x1d828c])return _0x28ea1d[_0x1d828c];}if(_0x4bc810===_0x14a5cd(0x157)&&_0x599cf5[_0x14a5cd(0x156)][_0x14a5cd(0x160)]){let _0x2eaacd=_0x599cf5[_0x14a5cd(0x156)][_0x14a5cd(0x160)];if(typeof _0x2eaacd==='string')try{_0x2eaacd=JSON[_0x14a5cd(0x1d0)](_0x2eaacd);}catch(_0x409d86){}if(_0x2eaacd&&_0x2eaacd[_0x1d828c])return _0x2eaacd[_0x1d828c];}let _0x315b4c=[];if(_0x4bc810===_0x14a5cd(0x1a3))_0x315b4c=[{'s':_0x14a5cd(0x1bf),'t':_0x14a5cd(0x165)},{'s':_0x14a5cd(0x164),'t':'.1.SET_POINT_TEMPERATURE'},{'s':_0x14a5cd(0x164),'t':_0x14a5cd(0x18b)},{'s':'ACTUAL_TEMPERATURE','t':_0x14a5cd(0x1cd)},{'s':'local_temperature','t':_0x14a5cd(0x19c)},{'s':_0x14a5cd(0x153),'t':_0x14a5cd(0x1af)},{'s':_0x14a5cd(0x1c5),'t':_0x14a5cd(0x1a2)},{'s':_0x14a5cd(0x1dd),'t':_0x14a5cd(0x1d6)},{'s':'Ist','t':_0x14a5cd(0x1d2)},{'s':_0x14a5cd(0x1c5),'t':'setpoint'}];else _0x4bc810===_0x14a5cd(0x157)&&(_0x315b4c=[{'s':_0x14a5cd(0x1bf),'t':_0x14a5cd(0x155)},{'s':'.1.TEMPERATURE','t':'.1.LEVEL'},{'s':_0x14a5cd(0x164),'t':_0x14a5cd(0x17a)},{'s':_0x14a5cd(0x153),'t':_0x14a5cd(0x175)},{'s':_0x14a5cd(0x1c5),'t':_0x14a5cd(0x19e)},{'s':_0x14a5cd(0x1c5),'t':'level'}]);for(const _0x384dd0 of _0x315b4c){if(_0x1d828c['includes'](_0x384dd0['s'])){const _0x3c4f35=_0x1d828c[_0x14a5cd(0x1b9)](_0x384dd0['s'],_0x384dd0['t']),_0x44cd14=await _0x599cf5[_0x14a5cd(0x1e6)](_0x3c4f35);if(_0x44cd14)return _0x3c4f35;}}try{const _0x1efbdc=_0x1d828c[_0x14a5cd(0x18f)]('.');if(_0x1efbdc[_0x14a5cd(0x17b)]>0x2){const _0x5a4bd5=_0x1efbdc[_0x14a5cd(0x1b8)](0x0,-0x1)[_0x14a5cd(0x1c1)]('.'),_0x429b6f=await _0x599cf5['getForeignObjectsAsync'](_0x5a4bd5+'.*'),_0x4e9b06=[],_0x196e47=_0x1d828c[_0x14a5cd(0x18f)](/[._]+/)['filter'](_0x47d74a=>![_0x14a5cd(0x190),'0',_0x14a5cd(0x158),'ist',_0x14a5cd(0x1ad),'temperature',_0x14a5cd(0x1ab),_0x14a5cd(0x1cf),_0x14a5cd(0x171),_0x14a5cd(0x15a)]['includes'](_0x47d74a['toLowerCase']()));for(const [_0x13e90c,_0x5bdcf2]of Object[_0x14a5cd(0x19b)](_0x429b6f)){if(_0x13e90c===_0x1d828c)continue;if(_0x5bdcf2&&_0x5bdcf2[_0x14a5cd(0x1bb)]){const _0x580cfd=_0x13e90c[_0x14a5cd(0x1a6)](),_0x13de50=(_0x5bdcf2[_0x14a5cd(0x1bb)][_0x14a5cd(0x1c3)]||'')[_0x14a5cd(0x1a6)](),_0x8e0cc3=(_0x5bdcf2[_0x14a5cd(0x1bb)][_0x14a5cd(0x184)]||'')[_0x14a5cd(0x1a6)]();let _0x40e72a=![];if(_0x4bc810===_0x14a5cd(0x1a3)&&_0x5bdcf2['common'][_0x14a5cd(0x1b7)]===!![])_0x40e72a=_0x580cfd['includes'](_0x14a5cd(0x1a8))||_0x580cfd[_0x14a5cd(0x1e3)](_0x14a5cd(0x1cb))||_0x580cfd[_0x14a5cd(0x1e3)]('target')||_0x13de50[_0x14a5cd(0x1e3)]('level.temperature')||_0x13de50[_0x14a5cd(0x1e3)](_0x14a5cd(0x180));else _0x4bc810===_0x14a5cd(0x157)&&(_0x40e72a=_0x580cfd[_0x14a5cd(0x1e3)](_0x14a5cd(0x1db))||_0x580cfd['includes'](_0x14a5cd(0x157))||_0x580cfd[_0x14a5cd(0x1e3)](_0x14a5cd(0x16e))||_0x580cfd['includes'](_0x14a5cd(0x16c))||_0x13de50[_0x14a5cd(0x1e3)](_0x14a5cd(0x1a4))||_0x13de50[_0x14a5cd(0x1e3)](_0x14a5cd(0x1d7))||_0x8e0cc3[_0x14a5cd(0x1e3)]('%'));if(_0x40e72a){const _0xbed131=_0x13e90c[_0x14a5cd(0x18f)](/[._]+/)['map'](_0x173905=>_0x173905['toLowerCase']());let _0x255ed7=0x0;_0x196e47[_0x14a5cd(0x174)](_0x34852c=>{if(_0xbed131['includes'](_0x34852c['toLowerCase']()))_0x255ed7++;}),_0x4e9b06[_0x14a5cd(0x1e1)]({'id':_0x13e90c,'score':_0x255ed7});}}}if(_0x4e9b06['length']>0x0){_0x4e9b06['sort']((_0x51ed00,_0x5b740a)=>_0x5b740a['score']-_0x51ed00['score']);if(_0x4e9b06[0x0][_0x14a5cd(0x1c9)]>0x0)return _0x4e9b06[0x0]['id'];}}}catch(_0x518e96){}return null;}async function scanThermostats(_0x3b1d5e){const _0x48b4f6=a1_0x3b4beb,_0x4ede93=_0x3b1d5e[_0x48b4f6(0x156)][_0x48b4f6(0x161)]||[],_0x1fa771=[],_0x5205cd=_0x4ede93[_0x48b4f6(0x192)](_0x12dde9=>_0x12dde9['id']&&_0x12dde9['id']['includes'](_0x48b4f6(0x1c5))||_0x12dde9[_0x48b4f6(0x1df)]&&[_0x48b4f6(0x1c5),_0x48b4f6(0x1a1),_0x48b4f6(0x1cf)][_0x48b4f6(0x1e3)](_0x12dde9[_0x48b4f6(0x1df)])||_0x12dde9[_0x48b4f6(0x1d3)]&&_0x12dde9[_0x48b4f6(0x1d3)][_0x48b4f6(0x1a6)]()['includes']('temp'));for(const _0xb348b7 of _0x5205cd){const _0x34eb4c=await findRelatedId(_0x3b1d5e,_0xb348b7['id'],_0x48b4f6(0x1a3)),_0x3d1c7e=await findRelatedId(_0x3b1d5e,_0xb348b7['id'],_0x48b4f6(0x157));let _0x1359d2='Nicht\x20gefunden',_0x4451fc=![],_0x587d74=_0x3b1d5e[_0x48b4f6(0x156)][_0x48b4f6(0x1ba)]||{};if(typeof _0x587d74===_0x48b4f6(0x1d9))try{_0x587d74=JSON[_0x48b4f6(0x1d0)](_0x587d74);}catch(_0x3b7f5a){}let _0x29687e=_0x3b1d5e[_0x48b4f6(0x156)][_0x48b4f6(0x160)]||{};if(typeof _0x29687e===_0x48b4f6(0x1d9))try{_0x29687e=JSON[_0x48b4f6(0x1d0)](_0x29687e);}catch(_0x2fe3e6){}if(_0x587d74[_0xb348b7['id']]&&_0x587d74[_0xb348b7['id']]===_0x34eb4c||_0x29687e[_0xb348b7['id']]&&_0x29687e[_0xb348b7['id']]===_0x3d1c7e)_0x1359d2=_0x48b4f6(0x1d1),_0x4451fc=!![];else(_0x34eb4c||_0x3d1c7e)&&(_0x1359d2=_0x48b4f6(0x1e5));_0x1fa771[_0x48b4f6(0x1e1)]({'room':_0xb348b7['location']||'Unbekannt','sensorId':_0xb348b7['id'],'setpointId':_0x34eb4c||'-','valveId':_0x3d1c7e||'-','source':_0x1359d2,'isManual':_0x4451fc,'status':_0x34eb4c&&_0x3d1c7e?_0x48b4f6(0x16f):_0x34eb4c?'OK':_0x48b4f6(0x15e)});}return _0x1fa771['sort']((_0x53f288,_0x5a8ed5)=>_0x53f288[_0x48b4f6(0x17d)]['localeCompare'](_0x5a8ed5[_0x48b4f6(0x17d)]));}async function updateSchedulePreview(_0x20d98b){const _0x3745a2=a1_0x3b4beb;if(!_0x20d98b[_0x3745a2(0x156)][_0x3745a2(0x1bc)]||!_0x20d98b[_0x3745a2(0x156)]['calendarInstance'])return;let _0x2d7ab6={};try{const _0x5892fa=await _0x20d98b['getStateAsync'](_0x3745a2(0x1b2));if(_0x5892fa&&_0x5892fa['val'])_0x2d7ab6=JSON[_0x3745a2(0x1d0)](_0x5892fa[_0x3745a2(0x1cc)]);}catch(_0x2170ce){}const _0x45bd01=[],_0x4bc4d5=Date[_0x3745a2(0x154)](),_0x4c40a7=0x30*0x3c*0x3c*0x3e8;try{const _0x715fbe=await _0x20d98b[_0x3745a2(0x1b5)](_0x20d98b['config'][_0x3745a2(0x173)]+_0x3745a2(0x18d));if(!_0x715fbe||!_0x715fbe[_0x3745a2(0x1cc)])return;const _0x3a6e1b=JSON[_0x3745a2(0x1d0)](_0x715fbe[_0x3745a2(0x1cc)]),_0x2b51d6=_0x20d98b['config'][_0x3745a2(0x1ca)]||[],_0x1df751=_0x20d98b[_0x3745a2(0x156)][_0x3745a2(0x161)]||[],_0x4f8710=new Set();_0x1df751[_0x3745a2(0x174)](_0x13ccd2=>{const _0x4164bd=_0x3745a2;if(_0x13ccd2[_0x4164bd(0x18c)])_0x4f8710[_0x4164bd(0x16b)](_0x13ccd2['location']);});for(const _0x21a880 of _0x3a6e1b){if(_0x21a880['_calName']&&_0x2b51d6['length']>0x0&&!_0x2b51d6[_0x3745a2(0x1e3)](_0x21a880['_calName']))continue;const _0x53a23b=_0x21a880[_0x3745a2(0x1c8)]||_0x21a880['eventStart']||_0x21a880[_0x3745a2(0x1ce)];if(!_0x53a23b)continue;const _0x1412bd=new Date(_0x53a23b),_0x329cec=_0x1412bd[_0x3745a2(0x159)]();if(isNaN(_0x329cec))continue;if(_0x329cec<_0x4bc4d5)continue;if(_0x329cec>_0x4bc4d5+_0x4c40a7)continue;const _0x1146e1=(_0x21a880[_0x3745a2(0x168)]||_0x21a880[_0x3745a2(0x188)]||'')['toLowerCase']();let _0x3b5d3f=![],_0x814968=[],_0x4ef3a1=_0x21a880['event']||_0x21a880[_0x3745a2(0x188)]||_0x3745a2(0x15c);if(_0x1146e1[_0x3745a2(0x1e3)]('urlaub\x20ende')||_0x1146e1['includes']('rÃ¼ckkehr')||_0x1146e1['includes'](_0x3745a2(0x16d)))_0x3b5d3f=!![],_0x814968=Array[_0x3745a2(0x15b)](_0x4f8710);else for(const _0x190e58 of _0x4f8710){_0x1146e1[_0x3745a2(0x1e3)](_0x190e58[_0x3745a2(0x1a6)]())&&_0x814968['push'](_0x190e58);}_0x814968['length']>0x0&&_0x814968[_0x3745a2(0x174)](_0x2afef4=>{const _0x42ac48=_0x3745a2;let _0x9a4385=0x3c;if(_0x3b5d3f){let _0xecd404=0x0;Object[_0x42ac48(0x1e0)](_0x2d7ab6)[_0x42ac48(0x174)](_0x3d4e9b=>{if(_0x3d4e9b>_0xecd404)_0xecd404=_0x3d4e9b;}),_0x9a4385=_0xecd404>0x0?_0xecd404:0x78;}else _0x9a4385=_0x2d7ab6[_0x2afef4]||0x3c;const _0x1930e2=new Date(_0x329cec-_0x9a4385*0xea60);_0x45bd01[_0x42ac48(0x1e1)]({'eventTime':_0x329cec,'triggerTime':_0x1930e2[_0x42ac48(0x159)](),'room':_0x2afef4,'minutes':_0x9a4385,'reason':_0x4ef3a1,'isGlobal':_0x3b5d3f});});}}catch(_0x15ee97){_0x20d98b[_0x3745a2(0x181)][_0x3745a2(0x1ac)]('Schedule\x20Preview\x20Error:\x20'+_0x15ee97['message']);}_0x45bd01[_0x3745a2(0x18a)]((_0x26d4cb,_0x6af2d2)=>_0x26d4cb[_0x3745a2(0x1b6)]-_0x6af2d2['triggerTime']);const _0x3ec4b8=_0x45bd01['slice'](0x0,0x5);await _0x20d98b[_0x3745a2(0x15f)](_0x3745a2(0x1da),{'val':JSON[_0x3745a2(0x163)](_0x3ec4b8),'ack':!![]});}function a1_0x369f(){const _0xc4d190=['local_temperature','now','.1.LEVEL','config','valve','hm-rpc','getTime','state','from','Unbekannt','23017384WELrxF','Fehlt','setStateAsync','valveMapping','devices','reason','stringify','.1.TEMPERATURE','.1.SET_POINT_TEMPERATURE','PrÃ¤diktion:\x20','[MPC]\x20','event','2068zkLcrN','106120YIFJOn','add','position','ankunft','stellwert','PERFECT','Unknown','messwert','consultButler','calendarInstance','forEach','pi_heating_demand','_calName','number','approved','1758DfsOOI','.4.VALVE_STATE','length','996ZVutoU','room','ðŸ”¥\x20[MPC\x20ACTION]\x20Heize\x20','search','thermostat.setpoint','log','constructor','\x20min).','unit','\x27\x20erkannt\x20(','2084625SdFFDs','Â°C,\x20Puffer:\x20','summary','info','sort','.4.SET_TEMPERATURE','location','.data.table',':\x20Absenkung\x20auf\x20','split','openknx','Â°C!\x20(Aktuell:\x20','filter','60aFdMLq','analysis.automation.lastAction','1077EYuRYb','40pLGJTF','dimmer',':\x20Aufheizen\x20auf\x20','./ai_agent','\x20wieder\x20auf\x20','entries','occupied_heating_setpoint','[MPC\x20WARNING]\x20Kein\x20Setpoint\x20(Soll-Temp)\x20fÃ¼r\x20','valve_position','getStateAsync','2915BhjUGJ','thermostat','target_temperature','setpoint','level.valve','1962158cDVuye','toLowerCase','off','set','ðŸƒ\x20[MPC\x20ACTION]\x20Senke\x20','rÃ¼ckkehr','actual','warn','wert','urlaub\x20ende','current_heating_setpoint','switch','light','analysis.energy.warmupTimes','Â°C!\x20(Puffer\x20leer).\x20->\x20ID:\x20','toString','getForeignStateAsync','triggerTime','write','slice','replace','thermostatMapping','common','useCalendar','eventStart','\x20->\x2021Â°C','.1.ACTUAL_TEMPERATURE','setForeignStateAsync','join',').\x20Heize\x20ganzes\x20Haus\x20auf\x20(Vorlauf:\x20','role','target','temperature','4788ZLZkVS','(((.+)+)+)+$','_date','score','calendarSelection','soll','val','SET_POINT_TEMPERATURE','date','sensor','parse','Manuelles\x20Mapping','Soll','name','Calendar\x20Check\x20Error:\x20','\x20gefunden!\x20Bitte\x20\x27System\x27\x20Tab\x20prÃ¼fen.','SET','value.valve','apply','string','analysis.energy.schedulePreview','level','189QxVZYB','ACTUAL','system.mode','type','values','push','\x20auf\x20','includes','ðŸ“…\x20SMART\x20SCHEDULE:\x20Raum-Trigger\x20\x27','Auto-Erkennung','getForeignObjectAsync','mpc_'];a1_0x369f=function(){return _0xc4d190;};return a1_0x369f();}async function checkCalendarTriggers(_0x426311){const _0x2f54c9=a1_0x3b4beb;if(!_0x426311['config'][_0x2f54c9(0x1bc)]||!_0x426311[_0x2f54c9(0x156)][_0x2f54c9(0x173)])return;await updateSchedulePreview(_0x426311);let _0x328742={};try{const _0x125952=await _0x426311[_0x2f54c9(0x19f)](_0x2f54c9(0x1b2));if(_0x125952&&_0x125952['val'])_0x328742=JSON[_0x2f54c9(0x1d0)](_0x125952[_0x2f54c9(0x1cc)]);}catch(_0x284080){}try{const _0x5ee93f=await _0x426311[_0x2f54c9(0x1b5)](_0x426311['config'][_0x2f54c9(0x173)]+'.data.table');if(!_0x5ee93f||!_0x5ee93f[_0x2f54c9(0x1cc)])return;const _0x240a67=JSON[_0x2f54c9(0x1d0)](_0x5ee93f['val']),_0x8afb07=new Date(),_0xde90a0=_0x426311[_0x2f54c9(0x156)]['devices']||[],_0x140582=_0x426311[_0x2f54c9(0x156)]['calendarSelection']||[];for(const _0x5dfaca of _0x240a67){if(_0x5dfaca['_calName']&&_0x140582[_0x2f54c9(0x17b)]>0x0&&!_0x140582[_0x2f54c9(0x1e3)](_0x5dfaca[_0x2f54c9(0x176)]))continue;const _0x372a0b=_0x5dfaca['_date']||_0x5dfaca[_0x2f54c9(0x1bd)]||_0x5dfaca[_0x2f54c9(0x1ce)];if(!_0x372a0b)continue;const _0x2215ec=new Date(_0x372a0b);if(isNaN(_0x2215ec[_0x2f54c9(0x159)]()))continue;const _0x5fed33=(_0x5dfaca['event']||_0x5dfaca[_0x2f54c9(0x188)]||'')['toLowerCase']();if(_0x5fed33[_0x2f54c9(0x1e3)](_0x2f54c9(0x1ae))||_0x5fed33['includes'](_0x2f54c9(0x1aa))||_0x5fed33[_0x2f54c9(0x1e3)]('ankunft')){let _0x2376ee=0x0;Object[_0x2f54c9(0x1e0)](_0x328742)[_0x2f54c9(0x174)](_0x2a87a3=>{if(_0x2a87a3>_0x2376ee)_0x2376ee=_0x2a87a3;});if(_0x2376ee===0x0)_0x2376ee=0x78;const _0x525f07=new Date(_0x2215ec[_0x2f54c9(0x159)]()-_0x2376ee*0xea60),_0x304d29=_0x8afb07[_0x2f54c9(0x159)]()-_0x525f07[_0x2f54c9(0x159)]();_0x304d29>=0x0&&_0x304d29<0xf*0xea60&&(_0x426311[_0x2f54c9(0x181)][_0x2f54c9(0x189)]('ðŸ“…\x20SMART\x20SCHEDULE:\x20\x27Globaler\x20Start\x27\x20erkannt\x20('+_0x5dfaca['event']+_0x2f54c9(0x1c2)+_0x2376ee+_0x2f54c9(0x183)),await _0x426311[_0x2f54c9(0x15f)](_0x2f54c9(0x1de),{'val':'normal','ack':![]}));}for(const _0xaf6006 of _0xde90a0){if(_0xaf6006[_0x2f54c9(0x18c)]){const _0x13ad88=_0xaf6006[_0x2f54c9(0x18c)][_0x2f54c9(0x1a6)]();if(_0x5fed33[_0x2f54c9(0x1e3)](_0x13ad88)){const _0x45ad34=_0x328742[_0xaf6006[_0x2f54c9(0x18c)]]||0x3c,_0x266ae7=new Date(_0x2215ec[_0x2f54c9(0x159)]()-_0x45ad34*0xea60),_0x1deda3=_0x8afb07[_0x2f54c9(0x159)]()-_0x266ae7[_0x2f54c9(0x159)]();if(_0x1deda3>=0x0&&_0x1deda3<0xf*0xea60){const _0x39aa0f=await findRelatedId(_0x426311,_0xaf6006['id'],'setpoint');_0x39aa0f&&(_0x426311[_0x2f54c9(0x181)][_0x2f54c9(0x189)](_0x2f54c9(0x1e4)+_0xaf6006[_0x2f54c9(0x18c)]+_0x2f54c9(0x185)+_0x5dfaca[_0x2f54c9(0x168)]+').\x20Heize\x20auf\x2021Â°C\x20(Vorlauf:\x20'+_0x45ad34+_0x2f54c9(0x183)),await _0x426311[_0x2f54c9(0x1c0)](_0x39aa0f,0x15),await _0x426311[_0x2f54c9(0x15f)](_0x2f54c9(0x194),{'val':'[CAL]\x20'+_0xaf6006[_0x2f54c9(0x18c)]+_0x2f54c9(0x1be),'ack':!![]}));}}}}}}catch(_0x1bc999){_0x426311['log'][_0x2f54c9(0x1ac)](_0x2f54c9(0x1d4)+_0x1bc999['message']);}}async function applyEnergySavings(_0x3de4a8,_0x155fcf){const _0x12dd0c=a1_0x3b4beb;if(!_0x155fcf||_0x155fcf[_0x12dd0c(0x17b)]===0x0)return;const _0x19ae90=_0x3de4a8[_0x12dd0c(0x156)][_0x12dd0c(0x161)]||[],_0xcbba72=Date['now']();for(const _0x4040d0 of _0x155fcf){const _0x41ee30=_0x4040d0['room'],_0x3ce1d5=_0x4040d0['minutes_safe'],_0x5b5227=_0x4040d0[_0x12dd0c(0x1c4)]||0x15,_0x39c558=_0x19ae90['find'](_0x599af0=>normalize(_0x599af0[_0x12dd0c(0x18c)])===normalize(_0x41ee30)&&(_0x599af0['type']===_0x12dd0c(0x1c5)||_0x599af0['type']===_0x12dd0c(0x1a1)));if(!_0x39c558)continue;const _0x2a85f3=await findRelatedId(_0x3de4a8,_0x39c558['id'],'setpoint');if(_0x2a85f3){if(lastActions[_0x12dd0c(0x152)+_0x41ee30]&&_0xcbba72-lastActions[_0x12dd0c(0x152)+_0x41ee30]<0x1e*0x3c*0x3e8)continue;const _0x20de03=await _0x3de4a8['getForeignStateAsync'](_0x2a85f3);if(_0x20de03&&typeof _0x20de03['val']===_0x12dd0c(0x177)){const _0x56b723=_0x20de03[_0x12dd0c(0x1cc)];if(_0x3ce1d5>0x1e)_0x56b723>ECO_TEMP+0.5&&(_0x3de4a8['log']['info'](_0x12dd0c(0x1a9)+_0x41ee30+_0x12dd0c(0x1e2)+ECO_TEMP+_0x12dd0c(0x191)+_0x56b723+_0x12dd0c(0x187)+_0x3ce1d5+'\x20min)\x20->\x20ID:\x20'+_0x2a85f3),await _0x3de4a8['setForeignStateAsync'](_0x2a85f3,ECO_TEMP),lastActions['mpc_'+_0x41ee30]=_0xcbba72,await _0x3de4a8[_0x12dd0c(0x15f)](_0x12dd0c(0x194),{'val':_0x12dd0c(0x167)+_0x41ee30+_0x12dd0c(0x18e)+ECO_TEMP+'Â°C','ack':!![]}));else _0x3ce1d5<=0xf&&(_0x56b723<_0x5b5227&&(_0x3de4a8['log'][_0x12dd0c(0x189)](_0x12dd0c(0x17e)+_0x41ee30+_0x12dd0c(0x19a)+_0x5b5227+_0x12dd0c(0x1b3)+_0x2a85f3),await _0x3de4a8['setForeignStateAsync'](_0x2a85f3,_0x5b5227),lastActions['mpc_'+_0x41ee30]=_0xcbba72,await _0x3de4a8[_0x12dd0c(0x15f)](_0x12dd0c(0x194),{'val':'[MPC]\x20'+_0x41ee30+_0x12dd0c(0x198)+_0x5b5227+'Â°C','ack':!![]})));}}else _0x3de4a8[_0x12dd0c(0x181)]['warn'](_0x12dd0c(0x19d)+_0x41ee30+_0x12dd0c(0x1d5));}}module['exports']={'handlePrediction':handlePrediction,'applyEnergySavings':applyEnergySavings,'scanThermostats':scanThermostats,'checkCalendarTriggers':checkCalendarTriggers,'updateSchedulePreview':updateSchedulePreview};