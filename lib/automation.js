const a1_0x261527=a1_0x525b;(function(_0x240c36,_0x54d3aa){const _0x588412=a1_0x525b,_0x3e48c6=_0x240c36();while(!![]){try{const _0x2d8412=parseInt(_0x588412(0x1fb))/0x1*(-parseInt(_0x588412(0x216))/0x2)+-parseInt(_0x588412(0x1ed))/0x3*(-parseInt(_0x588412(0x268))/0x4)+-parseInt(_0x588412(0x256))/0x5*(parseInt(_0x588412(0x254))/0x6)+-parseInt(_0x588412(0x21b))/0x7*(parseInt(_0x588412(0x23b))/0x8)+-parseInt(_0x588412(0x1ec))/0x9+parseInt(_0x588412(0x1f1))/0xa+-parseInt(_0x588412(0x200))/0xb*(-parseInt(_0x588412(0x20a))/0xc);if(_0x2d8412===_0x54d3aa)break;else _0x3e48c6['push'](_0x3e48c6['shift']());}catch(_0xb28515){_0x3e48c6['push'](_0x3e48c6['shift']());}}}(a1_0xa7f4,0xbaeac));const a1_0x735c5b=(function(){let _0xf9b20=!![];return function(_0x9ec3ef,_0x276c45){const _0x1346df=_0xf9b20?function(){const _0xf80c5d=a1_0x525b;if(_0x276c45){const _0x201935=_0x276c45[_0xf80c5d(0x265)](_0x9ec3ef,arguments);return _0x276c45=null,_0x201935;}}:function(){};return _0xf9b20=![],_0x1346df;};}()),a1_0xd137c8=a1_0x735c5b(this,function(){const _0x4a6ada=a1_0x525b;return a1_0xd137c8[_0x4a6ada(0x206)]()['search'](_0x4a6ada(0x1ee))[_0x4a6ada(0x206)]()[_0x4a6ada(0x1ef)](a1_0xd137c8)['search'](_0x4a6ada(0x1ee));});function a1_0xa7f4(){const _0x7f8117=['push','113567WvowLq','set','level.valve','pi_heating_demand','parse','935xutbpl','message','replace','messwert','number','getTime','toString','find','light','Soll','182892Hqwbuu','.1.LEVEL','valve_position','values','includes','temp','config','getStateAsync','Ist','entries','.1.ACTUAL_TEMPERATURE',')\x20auf\x20','2lnqspg','[MPC]\x20',').\x20Heize\x20ganzes\x20Haus\x20auf\x20(Vorlauf:\x20','common','¬∞C\x20(Coasting\x20m√∂glich:\x20','3598EXdEoS','openknx','.4.VALVE_STATE','getForeignObjectAsync','level','Manuelles\x20Mapping','.1.SET_POINT_TEMPERATURE','info','Pr√§diktion:\x20','üîç\x20Device-Search\x20failed\x20for\x20predicted\x20room\x20\x27','localeCompare','event','analysis.automation.mode','Calendar\x20Check\x20Error:\x20','\x27\x20erkannt\x20(','\x20->\x2021¬∞C','actual','consultButler','local_temperature','string','wert','valve','now','trim','soll','slice','role','valveMapping','target','\x20min)','./ai_agent','room','1552NOCmnh','position','join','Nicht\x20gefunden','.1.TEMPERATURE','val','Auto-Erkennung','occupied_heating_setpoint','setpoint','sensor','state','hm-rpc','\x20->\x20Schalte\x20','setForeignStateAsync','calendarSelection','level.temperature','ankunft','sort','thermostatMapping','reason','temperature','r√ºckkehr','SET',':\x20-1¬∞C\x20(Sparpotenzial\x20genutzt)','.4.SET_TEMPERATURE','1213224anqcoL','forEach','35xJydxb','exports','score','toUpperCase','name','urlaub\x20ende','map','active','analysis.automation.lastAction','\x20min).','type','üìÖ\x20SMART\x20SCHEDULE:\x20\x27Globaler\x20Start\x27\x20erkannt\x20(','eventStart','warn','ACTUAL','apply','write','summary','4ZPwVJs','off','mpc_','switch','thermostat.setpoint','thermostat','toLowerCase','getForeignStateAsync','devices','dimmer','location','ist','split','minutes_safe','8039574sITDDz','2916909Nhafdf','(((.+)+)+)+$','constructor','PERFECT','10198210RHZEfU','setStateAsync','ACTUAL_TEMPERATURE','filter','length','system.mode','log','üçÉ\x20MPC\x20Autonomy:\x20Senke\x20','analysis.automation.confidenceThreshold'];a1_0xa7f4=function(){return _0x7f8117;};return a1_0xa7f4();}a1_0xd137c8();function a1_0x525b(_0x3d8fce,_0x192ef0){const _0x5393a7=a1_0xa7f4();return a1_0x525b=function(_0xd137c8,_0x735c5b){_0xd137c8=_0xd137c8-0x1e1;let _0xa7f47d=_0x5393a7[_0xd137c8];return _0xa7f47d;},a1_0x525b(_0x3d8fce,_0x192ef0);}'use strict';const aiAgent=require(a1_0x261527(0x239)),COOLDOWN_MS=0x3c*0x3e8,lastActions={};function normalize(_0x482c60){const _0x39c385=a1_0x261527;if(!_0x482c60)return'';return _0x482c60[_0x39c385(0x1e4)]()[_0x39c385(0x202)](/\s+/g,'')[_0x39c385(0x232)]();}async function handlePrediction(_0x7f7bd6,_0x238517,_0x2a9e01){const _0x2c24d7=a1_0x261527;if(!_0x238517||_0x238517==='Unknown')return;let _0x124f73=_0x2c24d7(0x269),_0x5310b4=0.6;try{const _0x33db98=await _0x7f7bd6[_0x2c24d7(0x211)](_0x2c24d7(0x227));if(_0x33db98&&_0x33db98['val'])_0x124f73=_0x33db98[_0x2c24d7(0x240)];const _0x242df6=await _0x7f7bd6[_0x2c24d7(0x211)](_0x2c24d7(0x1f9));if(_0x242df6&&_0x242df6[_0x2c24d7(0x240)])_0x5310b4=_0x242df6[_0x2c24d7(0x240)];}catch(_0x59de25){}if(_0x124f73===_0x2c24d7(0x269)||_0x2a9e01<_0x5310b4)return;const _0x555f0a=Date[_0x2c24d7(0x231)]();if(lastActions[_0x238517]&&_0x555f0a-lastActions[_0x238517]<COOLDOWN_MS)return;const _0x46a6d8=_0x7f7bd6[_0x2c24d7(0x210)][_0x2c24d7(0x1e6)]||[],_0x363fc6=normalize(_0x238517),_0x318e77=_0x46a6d8['find'](_0x2f5a52=>normalize(_0x2f5a52['location'])===_0x363fc6&&(_0x2f5a52['type']===_0x2c24d7(0x208)||_0x2f5a52[_0x2c24d7(0x260)]===_0x2c24d7(0x1e7)||_0x2f5a52[_0x2c24d7(0x260)]===_0x2c24d7(0x1e1)));if(!_0x318e77){_0x7f7bd6[_0x2c24d7(0x1f7)]['debug'](_0x2c24d7(0x224)+_0x238517+'\x27.');return;}const _0x4f90d6=await aiAgent[_0x2c24d7(0x22c)](_0x7f7bd6,_0x238517,_0x318e77[_0x2c24d7(0x25a)],_0x2a9e01);if(!_0x4f90d6['approved'])return;const _0x193bb0=_0x2c24d7(0x223)+_0x238517+_0x2c24d7(0x247)+_0x318e77[_0x2c24d7(0x25a)]+'\x20('+_0x4f90d6[_0x2c24d7(0x24e)]+')';await _0x7f7bd6[_0x2c24d7(0x1f2)](_0x2c24d7(0x25e),{'val':'['+_0x124f73[_0x2c24d7(0x259)]()+']\x20'+_0x193bb0,'ack':!![]});if(_0x124f73===_0x2c24d7(0x25d)){const _0x216606=await _0x7f7bd6[_0x2c24d7(0x1e5)](_0x318e77['id']);(!_0x216606||!_0x216606[_0x2c24d7(0x240)]&&_0x216606['val']!==!![])&&await _0x7f7bd6[_0x2c24d7(0x248)](_0x318e77['id'],!![]),lastActions[_0x238517]=_0x555f0a;}}async function findRelatedId(_0x2fedc5,_0x152d45,_0x35c147=a1_0x261527(0x243)){const _0x114990=a1_0x261527;if(_0x35c147===_0x114990(0x243)&&_0x2fedc5[_0x114990(0x210)][_0x114990(0x24d)]){let _0x2d4a7d=_0x2fedc5[_0x114990(0x210)][_0x114990(0x24d)];if(typeof _0x2d4a7d===_0x114990(0x22e))try{_0x2d4a7d=JSON[_0x114990(0x1ff)](_0x2d4a7d);}catch(_0x4b9403){}if(_0x2d4a7d&&_0x2d4a7d[_0x152d45])return _0x2d4a7d[_0x152d45];}if(_0x35c147==='valve'&&_0x2fedc5['config'][_0x114990(0x236)]){let _0x22324f=_0x2fedc5[_0x114990(0x210)][_0x114990(0x236)];if(typeof _0x22324f===_0x114990(0x22e))try{_0x22324f=JSON['parse'](_0x22324f);}catch(_0x2c02aa){}if(_0x22324f&&_0x22324f[_0x152d45])return _0x22324f[_0x152d45];}let _0x30bebd=[];if(_0x35c147==='setpoint')_0x30bebd=[{'s':_0x114990(0x214),'t':_0x114990(0x221)},{'s':_0x114990(0x23f),'t':_0x114990(0x221)},{'s':_0x114990(0x23f),'t':_0x114990(0x253)},{'s':_0x114990(0x1f3),'t':'SET_POINT_TEMPERATURE'},{'s':_0x114990(0x22d),'t':_0x114990(0x242)},{'s':_0x114990(0x22d),'t':'current_heating_setpoint'},{'s':_0x114990(0x24f),'t':'target_temperature'},{'s':_0x114990(0x264),'t':_0x114990(0x251)},{'s':_0x114990(0x212),'t':_0x114990(0x209)},{'s':_0x114990(0x24f),'t':_0x114990(0x243)}];else _0x35c147==='valve'&&(_0x30bebd=[{'s':'.1.ACTUAL_TEMPERATURE','t':_0x114990(0x20b)},{'s':_0x114990(0x23f),'t':'.1.LEVEL'},{'s':_0x114990(0x23f),'t':_0x114990(0x21d)},{'s':_0x114990(0x22d),'t':_0x114990(0x1fe)},{'s':'temperature','t':_0x114990(0x20c)},{'s':_0x114990(0x24f),'t':_0x114990(0x21f)}]);for(const _0xca1592 of _0x30bebd){if(_0x152d45[_0x114990(0x20e)](_0xca1592['s'])){const _0x4b5fac=_0x152d45['replace'](_0xca1592['s'],_0xca1592['t']),_0x34428a=await _0x2fedc5[_0x114990(0x21e)](_0x4b5fac);if(_0x34428a)return _0x4b5fac;}}try{const _0x41a8b6=_0x152d45['split']('.');if(_0x41a8b6[_0x114990(0x1f5)]>0x2){const _0x454712=_0x41a8b6[_0x114990(0x234)](0x0,-0x1)[_0x114990(0x23d)]('.'),_0x5abff8=await _0x2fedc5['getForeignObjectsAsync'](_0x454712+'.*'),_0x4f0dc8=[],_0x2676a8=_0x152d45[_0x114990(0x1ea)](/[._]+/)['filter'](_0x2174a7=>![_0x114990(0x21c),'0',_0x114990(0x246),_0x114990(0x1e9),_0x114990(0x22f),_0x114990(0x24f),_0x114990(0x22b),_0x114990(0x244),_0x114990(0x203),_0x114990(0x245)][_0x114990(0x20e)](_0x2174a7[_0x114990(0x1e4)]()));for(const [_0x3944a6,_0x1afb7e]of Object[_0x114990(0x213)](_0x5abff8)){if(_0x3944a6===_0x152d45)continue;if(_0x1afb7e&&_0x1afb7e['common']){const _0x7ce221=_0x3944a6[_0x114990(0x1e4)](),_0x4fd8f5=(_0x1afb7e[_0x114990(0x219)][_0x114990(0x235)]||'')[_0x114990(0x1e4)](),_0x330d8e=(_0x1afb7e[_0x114990(0x219)]['unit']||'')[_0x114990(0x1e4)]();let _0x1a5981=![];if(_0x35c147===_0x114990(0x243)&&_0x1afb7e[_0x114990(0x219)][_0x114990(0x266)]===!![])_0x1a5981=_0x7ce221['includes'](_0x114990(0x1fc))||_0x7ce221[_0x114990(0x20e)](_0x114990(0x233))||_0x7ce221[_0x114990(0x20e)](_0x114990(0x237))||_0x4fd8f5[_0x114990(0x20e)](_0x114990(0x24a))||_0x4fd8f5[_0x114990(0x20e)](_0x114990(0x1e2));else _0x35c147===_0x114990(0x230)&&(_0x1a5981=_0x7ce221['includes']('level')||_0x7ce221[_0x114990(0x20e)](_0x114990(0x230))||_0x7ce221[_0x114990(0x20e)]('stellwert')||_0x7ce221[_0x114990(0x20e)](_0x114990(0x23c))||_0x4fd8f5[_0x114990(0x20e)](_0x114990(0x1fd))||_0x4fd8f5[_0x114990(0x20e)]('value.valve')||_0x330d8e[_0x114990(0x20e)]('%'));if(_0x1a5981){const _0xcabae8=_0x3944a6[_0x114990(0x1ea)](/[._]+/)[_0x114990(0x25c)](_0x35e322=>_0x35e322[_0x114990(0x1e4)]());let _0x123b77=0x0;_0x2676a8[_0x114990(0x255)](_0x1c2f87=>{const _0x5394e0=_0x114990;if(_0xcabae8[_0x5394e0(0x20e)](_0x1c2f87[_0x5394e0(0x1e4)]()))_0x123b77++;}),_0x4f0dc8[_0x114990(0x1fa)]({'id':_0x3944a6,'score':_0x123b77});}}}if(_0x4f0dc8[_0x114990(0x1f5)]>0x0){_0x4f0dc8[_0x114990(0x24c)]((_0x28a357,_0x17f1dc)=>_0x17f1dc[_0x114990(0x258)]-_0x28a357[_0x114990(0x258)]);if(_0x4f0dc8[0x0][_0x114990(0x258)]>0x0)return _0x4f0dc8[0x0]['id'];}}}catch(_0x46bd48){}return null;}async function scanThermostats(_0x164a7e){const _0x14bd8e=a1_0x261527,_0x5012b8=_0x164a7e[_0x14bd8e(0x210)][_0x14bd8e(0x1e6)]||[],_0x4a7b57=[],_0x231f18=_0x5012b8[_0x14bd8e(0x1f4)](_0x19e462=>_0x19e462['id']&&_0x19e462['id']['includes'](_0x14bd8e(0x24f))||_0x19e462[_0x14bd8e(0x260)]&&[_0x14bd8e(0x24f),_0x14bd8e(0x1e3),'sensor']['includes'](_0x19e462['type'])||_0x19e462[_0x14bd8e(0x25a)]&&_0x19e462['name'][_0x14bd8e(0x1e4)]()['includes'](_0x14bd8e(0x20f)));for(const _0x18e02e of _0x231f18){const _0x476b57=await findRelatedId(_0x164a7e,_0x18e02e['id'],_0x14bd8e(0x243)),_0x51e582=await findRelatedId(_0x164a7e,_0x18e02e['id'],_0x14bd8e(0x230));let _0x456ac6=_0x14bd8e(0x23e),_0xe50aac=![],_0x584dfc=_0x164a7e[_0x14bd8e(0x210)][_0x14bd8e(0x24d)]||{};if(typeof _0x584dfc===_0x14bd8e(0x22e))try{_0x584dfc=JSON[_0x14bd8e(0x1ff)](_0x584dfc);}catch(_0x53fd65){}let _0x59cdaa=_0x164a7e[_0x14bd8e(0x210)][_0x14bd8e(0x236)]||{};if(typeof _0x59cdaa==='string')try{_0x59cdaa=JSON[_0x14bd8e(0x1ff)](_0x59cdaa);}catch(_0xfde603){}if(_0x584dfc[_0x18e02e['id']]&&_0x584dfc[_0x18e02e['id']]===_0x476b57||_0x59cdaa[_0x18e02e['id']]&&_0x59cdaa[_0x18e02e['id']]===_0x51e582)_0x456ac6=_0x14bd8e(0x220),_0xe50aac=!![];else(_0x476b57||_0x51e582)&&(_0x456ac6=_0x14bd8e(0x241));_0x4a7b57[_0x14bd8e(0x1fa)]({'room':_0x18e02e[_0x14bd8e(0x1e8)]||'Unbekannt','sensorId':_0x18e02e['id'],'setpointId':_0x476b57||'-','valveId':_0x51e582||'-','source':_0x456ac6,'isManual':_0xe50aac,'status':_0x476b57&&_0x51e582?_0x14bd8e(0x1f0):_0x476b57?'OK':'Fehlt'});}return _0x4a7b57[_0x14bd8e(0x24c)]((_0x4f92dc,_0x21f2b7)=>_0x4f92dc['room'][_0x14bd8e(0x225)](_0x21f2b7[_0x14bd8e(0x23a)]));}async function checkCalendarTriggers(_0x1dd38f){const _0x518343=a1_0x261527;if(!_0x1dd38f[_0x518343(0x210)]['useCalendar']||!_0x1dd38f['config']['calendarInstance'])return;let _0x134e2d={};try{const _0x486a0d=await _0x1dd38f[_0x518343(0x211)]('analysis.energy.warmupTimes');if(_0x486a0d&&_0x486a0d[_0x518343(0x240)])_0x134e2d=JSON['parse'](_0x486a0d['val']);}catch(_0x1f8dea){}try{const _0x2d9e09=await _0x1dd38f[_0x518343(0x1e5)](_0x1dd38f[_0x518343(0x210)]['calendarInstance']+'.data.table');if(!_0x2d9e09||!_0x2d9e09[_0x518343(0x240)])return;const _0x92a101=JSON[_0x518343(0x1ff)](_0x2d9e09[_0x518343(0x240)]),_0x4f9ae1=new Date(),_0x2528ee=_0x1dd38f['config'][_0x518343(0x1e6)]||[],_0x5219b7=_0x1dd38f[_0x518343(0x210)][_0x518343(0x249)]||[];for(const _0x4147e9 of _0x92a101){if(_0x4147e9['_calName']&&_0x5219b7[_0x518343(0x1f5)]>0x0&&!_0x5219b7[_0x518343(0x20e)](_0x4147e9['_calName']))continue;const _0x42871b=new Date(_0x4147e9[_0x518343(0x262)]),_0x5ee86c=(_0x4147e9[_0x518343(0x226)]||_0x4147e9[_0x518343(0x267)]||'')[_0x518343(0x1e4)]();if(_0x5ee86c['includes'](_0x518343(0x25b))||_0x5ee86c['includes'](_0x518343(0x250))||_0x5ee86c[_0x518343(0x20e)](_0x518343(0x24b))){let _0x554e68=0x0;Object[_0x518343(0x20d)](_0x134e2d)[_0x518343(0x255)](_0x27d70a=>{if(_0x27d70a>_0x554e68)_0x554e68=_0x27d70a;});if(_0x554e68===0x0)_0x554e68=0x78;const _0x503fb4=new Date(_0x42871b[_0x518343(0x205)]()-_0x554e68*0xea60),_0x60e0a7=_0x4f9ae1[_0x518343(0x205)]()-_0x503fb4['getTime']();_0x60e0a7>=0x0&&_0x60e0a7<0xf*0xea60&&(_0x1dd38f[_0x518343(0x1f7)][_0x518343(0x222)](_0x518343(0x261)+_0x4147e9[_0x518343(0x226)]+_0x518343(0x218)+_0x554e68+_0x518343(0x25f)),await _0x1dd38f[_0x518343(0x1f2)](_0x518343(0x1f6),{'val':'normal','ack':![]}));}for(const _0x19b02c of _0x2528ee){if(_0x19b02c[_0x518343(0x1e8)]){const _0xec17dc=_0x19b02c[_0x518343(0x1e8)]['toLowerCase']();if(_0x5ee86c[_0x518343(0x20e)](_0xec17dc)){const _0x43a6e5=_0x134e2d[_0x19b02c[_0x518343(0x1e8)]]||0x3c,_0x4ba3c1=new Date(_0x42871b[_0x518343(0x205)]()-_0x43a6e5*0xea60),_0x3da49d=_0x4f9ae1[_0x518343(0x205)]()-_0x4ba3c1[_0x518343(0x205)]();if(_0x3da49d>=0x0&&_0x3da49d<0xf*0xea60){const _0x10a892=await findRelatedId(_0x1dd38f,_0x19b02c['id'],'setpoint');_0x10a892&&(_0x1dd38f[_0x518343(0x1f7)][_0x518343(0x222)]('üìÖ\x20SMART\x20SCHEDULE:\x20Raum-Trigger\x20\x27'+_0x19b02c[_0x518343(0x1e8)]+_0x518343(0x229)+_0x4147e9[_0x518343(0x226)]+').\x20Heize\x20auf\x2021¬∞C\x20(Vorlauf:\x20'+_0x43a6e5+_0x518343(0x25f)),await _0x1dd38f[_0x518343(0x248)](_0x10a892,0x15),await _0x1dd38f[_0x518343(0x1f2)](_0x518343(0x25e),{'val':'[CAL]\x20'+_0x19b02c['location']+_0x518343(0x22a),'ack':!![]}));}}}}}}catch(_0x5021ad){_0x1dd38f[_0x518343(0x1f7)][_0x518343(0x263)](_0x518343(0x228)+_0x5021ad[_0x518343(0x201)]);}}async function applyEnergySavings(_0x37a593,_0x258642){const _0x5edc09=a1_0x261527,_0x49f90b=_0x37a593['config'][_0x5edc09(0x1e6)]||[];for(const _0x35237e of _0x258642){const _0x5db408=_0x35237e[_0x5edc09(0x23a)],_0x356d4f=_0x35237e[_0x5edc09(0x1eb)],_0x3dd993=Date[_0x5edc09(0x231)]();if(lastActions[_0x5edc09(0x26a)+_0x5db408]&&_0x3dd993-lastActions[_0x5edc09(0x26a)+_0x5db408]<0x1e*0x3c*0x3e8)continue;const _0x5b2fd8=_0x49f90b[_0x5edc09(0x207)](_0x38a760=>normalize(_0x38a760[_0x5edc09(0x1e8)])===normalize(_0x5db408));if(!_0x5b2fd8)continue;const _0x2a9c82=await findRelatedId(_0x37a593,_0x5b2fd8['id'],_0x5edc09(0x243));if(_0x2a9c82){const _0x4401c2=await _0x37a593[_0x5edc09(0x1e5)](_0x2a9c82);if(_0x4401c2&&typeof _0x4401c2[_0x5edc09(0x240)]===_0x5edc09(0x204)){const _0x310348=_0x4401c2[_0x5edc09(0x240)];if(_0x356d4f>0x1e&&_0x310348>0x11){const _0x42384f=_0x310348-0x1;_0x37a593['log'][_0x5edc09(0x222)](_0x5edc09(0x1f8)+_0x5db408+'\x20('+_0x2a9c82+_0x5edc09(0x215)+_0x42384f+_0x5edc09(0x21a)+_0x356d4f+_0x5edc09(0x238)),await _0x37a593[_0x5edc09(0x248)](_0x2a9c82,_0x42384f),lastActions[_0x5edc09(0x26a)+_0x5db408]=_0x3dd993,await _0x37a593['setStateAsync'](_0x5edc09(0x25e),{'val':_0x5edc09(0x217)+_0x5db408+_0x5edc09(0x252),'ack':!![]});}}}}}module[a1_0x261527(0x257)]={'handlePrediction':handlePrediction,'applyEnergySavings':applyEnergySavings,'scanThermostats':scanThermostats,'checkCalendarTriggers':checkCalendarTriggers};