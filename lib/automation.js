function a1_0x2f02(_0x45ae28,_0x404060){const _0x155e8b=a1_0x1480();return a1_0x2f02=function(_0x30468c,_0x267d87){_0x30468c=_0x30468c-0x1ed;let _0x1480e2=_0x155e8b[_0x30468c];return _0x1480e2;},a1_0x2f02(_0x45ae28,_0x404060);}const a1_0x8f01a=a1_0x2f02;(function(_0x2da7e8,_0x8673fc){const _0x20ed88=a1_0x2f02,_0xb88aa3=_0x2da7e8();while(!![]){try{const _0x19c1df=parseInt(_0x20ed88(0x299))/0x1+-parseInt(_0x20ed88(0x295))/0x2+parseInt(_0x20ed88(0x276))/0x3+parseInt(_0x20ed88(0x21f))/0x4*(-parseInt(_0x20ed88(0x291))/0x5)+-parseInt(_0x20ed88(0x212))/0x6+parseInt(_0x20ed88(0x1f3))/0x7*(parseInt(_0x20ed88(0x253))/0x8)+-parseInt(_0x20ed88(0x240))/0x9*(parseInt(_0x20ed88(0x28a))/0xa);if(_0x19c1df===_0x8673fc)break;else _0xb88aa3['push'](_0xb88aa3['shift']());}catch(_0x54f22e){_0xb88aa3['push'](_0xb88aa3['shift']());}}}(a1_0x1480,0x60c81));function a1_0x1480(){const _0x235de9=['ACTUAL','analysis.energy.warmupTimes','Soll','urlaub\x20ende','ðŸ“…\x20[ENFORCEMENT]\x20Kalender-Event\x20in\x20','8vboBjf','slice','setForeignStateAsync','setStateAsync','split','normal','target_temperature','system.mode','_date','stellwert','entries','occupied_heating_setpoint','value.valve','string','Â°C).\x20Sparmodus\x20beendet!','\x20min).','thermostat.setpoint','unit','useCalendar','Â°C\x20(nicht\x20','target','forEach','\x20->\x20','analysis.energy.warmupSources','localeCompare','common','event','hm-rpc','\x20auf\x20','role','messwert','reason','SET','dimmer','.1.LEVEL','1317153NjNadG','minutes_safe','getForeignObjectsAsync','.data.table','window','default','setpoint','log','location','error','valve_position','sensor','analysis.energy.mpcActiveInterventions','filter','now','.1.SET_POINT_TEMPERATURE','Â°C\x20(Vorlauf:\x20','getTime','message','summary','60FcLFVF','ðŸš¨\x20[MPC\x20WATCHDOG]\x20','contact','analysis.energy.warmupTargets','Classic','TRAIN_RL_PENALTY','triggerTime','1153415IlJdIO','level','calendarInstance','rÃ¼ckkehr','1172820weDyiD','\x20ist\x20auf\x20','info','stringify','301069qehXgc','[MPC]\x20','[FORCE]\x20','analysis.automation.confidenceThreshold','openknx','(((.+)+)+)+$','\x20wurde\x20manuell\x20erhÃ¶ht.','sort','toUpperCase','config','values',':\x20Aufheizen\x20auf\x20','add','too_cold','\x27\x20(Match:\x20','date','analysis.energy.schedulePreview','Â°C\x20<\x20','valveMapping','abs','splice','type','pi_heating_demand','3915303VlpJsB','push','constructor','Â°C\x20->\x20','PERFECT',']:\x20Raum-Trigger\x20\x27','open','temperature','PrÃ¤diktion:\x20','room','indexOf','val','score','\x20erreicht\x20Limit\x20(','name','apply','Â°C!\x20(Puffer:\x20','ist','position','ðŸ§¹\x20[MPC\x20CLEANUP]\x20Raum\x20\x27','cal_',')\x20aktiv.\x20Heize\x20auf\x20','light','getForeignStateAsync','analysis.automation.mode','\x20wieder\x20auf\x20','active','\x20durch\x20Kalender\x20geÃ¤ndert.\x20Keine\x20RL-Strafe.','write','.1.ACTUAL_TEMPERATURE','toLowerCase','322206wgxVPc','./ai_agent','Unknown','thermostatMapping','\x20ist\x20zu\x20kalt,\x20ABER\x20Fenster\x20offen/LÃ¼ftung\x20erkannt.\x20Heize\x20NICHT,\x20entferne\x20nur\x20Status.','state','soll','.4.VALVE_STATE','ðŸŒ¬ï¸\x20[MPC\x20WATCHDOG]\x20','warn','ðŸ§¹\x20[MPC\x20CLEANUP]\x20','Â°C\x20(Kalender-Schutz)','devices','4zOxROl','local_temperature','wert','eventStart','\x20->\x20Schalte\x20','consultButler','trim','analysis.energy.activeEnforcements','length','\x20gefunden!','replace','isArray','Ist','[CAL]\x20','find','\x20gestartet/vorbei.\x20Gebe\x20Raum\x20frei.','mpc_','ðŸƒ\x20[MPC\x20ACTION]\x20Senke\x20','ðŸŽ“\x20[RL-FEEDBACK]\x20Lerne\x20aus\x20Fehler:\x20','rescue_','actual','getStateAsync','off','toString','.1.TEMPERATURE','thermostat','parse','current_heating_setpoint','unshift','level.valve','Manuelles\x20Mapping','currentSystemMode','sendToPythonWrapper','48357AnKqTQ','SET_POINT_TEMPERATURE','number','ACTUAL_TEMPERATURE','findIndex','manual','_calName','valve','includes','remove','Unbekannt','[MPC\x20WARNING]\x20Kein\x20Setpoint\x20fÃ¼r\x20','calendarSelection','approved'];a1_0x1480=function(){return _0x235de9;};return a1_0x1480();}const a1_0x267d87=(function(){let _0x4a6c5f=!![];return function(_0x537e93,_0x439ea5){const _0x30980a=_0x4a6c5f?function(){const _0x48a058=a1_0x2f02;if(_0x439ea5){const _0xe3699d=_0x439ea5[_0x48a058(0x202)](_0x537e93,arguments);return _0x439ea5=null,_0xe3699d;}}:function(){};return _0x4a6c5f=![],_0x30980a;};}()),a1_0x30468c=a1_0x267d87(this,function(){const _0x57e89d=a1_0x2f02;return a1_0x30468c['toString']()['search']('(((.+)+)+)+$')[_0x57e89d(0x236)]()[_0x57e89d(0x1f5)](a1_0x30468c)['search'](_0x57e89d(0x29e));});a1_0x30468c();'use strict';const aiAgent=require(a1_0x8f01a(0x213)),COOLDOWN_MS=0x3c*0x3e8,CAL_COOLDOWN_MS=0x5a*0x3c*0x3e8,RESCUE_LOCK_MS=0x78*0x3c*0x3e8,ECO_TEMP=0x11,lastActions={};function normalize(_0x2f6dc6){const _0x2b627f=a1_0x8f01a;if(!_0x2f6dc6)return'';return _0x2f6dc6['toLowerCase']()[_0x2b627f(0x229)](/\s+/g,'')[_0x2b627f(0x225)]();}async function logAutomationAction(_0xa9d48,_0x562793){const _0x193bbb=a1_0x8f01a;await _0xa9d48[_0x193bbb(0x256)]('analysis.automation.lastAction',{'val':_0x562793,'ack':!![]});try{const _0x424284='analysis.automation.actionLog',_0x524d6b=await _0xa9d48[_0x193bbb(0x234)](_0x424284);let _0x2efdba=[];if(_0x524d6b&&_0x524d6b['val'])try{_0x2efdba=JSON['parse'](_0x524d6b[_0x193bbb(0x1fe)]);}catch(_0x523d34){}_0x2efdba[_0x193bbb(0x23b)]({'ts':Date[_0x193bbb(0x284)](),'msg':_0x562793});if(_0x2efdba[_0x193bbb(0x227)]>0x32)_0x2efdba=_0x2efdba[_0x193bbb(0x254)](0x0,0x32);await _0xa9d48[_0x193bbb(0x256)](_0x424284,{'val':JSON[_0x193bbb(0x298)](_0x2efdba),'ack':!![]});}catch(_0x21a79b){}}async function handlePrediction(_0x5abb79,_0x1c2bdf,_0x1edc0c){const _0x5933a6=a1_0x8f01a;if(!_0x1c2bdf||_0x1c2bdf===_0x5933a6(0x214))return;let _0x960d89=_0x5933a6(0x235),_0x26ee27=0.6;try{const _0x5ba264=await _0x5abb79[_0x5933a6(0x234)](_0x5933a6(0x20b));if(_0x5ba264&&_0x5ba264[_0x5933a6(0x1fe)])_0x960d89=_0x5ba264[_0x5933a6(0x1fe)];const _0x4d2591=await _0x5abb79[_0x5933a6(0x234)](_0x5933a6(0x29c));if(_0x4d2591&&_0x4d2591[_0x5933a6(0x1fe)])_0x26ee27=_0x4d2591[_0x5933a6(0x1fe)];}catch(_0x2dd553){}if(_0x960d89==='off'||_0x1edc0c<_0x26ee27)return;const _0x362aad=Date['now']();if(lastActions[_0x1c2bdf]&&_0x362aad-lastActions[_0x1c2bdf]<COOLDOWN_MS)return;const _0x3fd650=_0x5abb79[_0x5933a6(0x2a2)][_0x5933a6(0x21e)]||[],_0x50f7dc=normalize(_0x1c2bdf),_0x3e34e5=_0x3fd650['find'](_0x1b549e=>normalize(_0x1b549e[_0x5933a6(0x27e)])===_0x50f7dc&&(_0x1b549e[_0x5933a6(0x1f1)]===_0x5933a6(0x209)||_0x1b549e[_0x5933a6(0x1f1)]===_0x5933a6(0x274)||_0x1b549e[_0x5933a6(0x1f1)]==='switch'));if(!_0x3e34e5)return;const _0x45cfe6=await aiAgent[_0x5933a6(0x224)](_0x5abb79,_0x1c2bdf,_0x3e34e5[_0x5933a6(0x201)],_0x1edc0c);if(!_0x45cfe6[_0x5933a6(0x24d)])return;const _0x25d9ea=_0x5933a6(0x1fb)+_0x1c2bdf+_0x5933a6(0x223)+_0x3e34e5[_0x5933a6(0x201)]+'\x20('+_0x45cfe6[_0x5933a6(0x272)]+')';await logAutomationAction(_0x5abb79,'['+_0x960d89[_0x5933a6(0x2a1)]()+']\x20'+_0x25d9ea);if(_0x960d89===_0x5933a6(0x20d)){const _0x45f986=await _0x5abb79['getForeignStateAsync'](_0x3e34e5['id']);(!_0x45f986||!_0x45f986[_0x5933a6(0x1fe)]&&_0x45f986[_0x5933a6(0x1fe)]!==!![])&&await _0x5abb79[_0x5933a6(0x255)](_0x3e34e5['id'],!![]),lastActions[_0x1c2bdf]=_0x362aad;}}async function findRelatedId(_0x3076f8,_0x4d1dd4,_0x2d2d06='setpoint'){const _0x13d100=a1_0x8f01a;if(_0x2d2d06===_0x13d100(0x27c)&&_0x3076f8[_0x13d100(0x2a2)][_0x13d100(0x215)]){let _0x288d58=_0x3076f8[_0x13d100(0x2a2)][_0x13d100(0x215)];if(typeof _0x288d58===_0x13d100(0x260))try{_0x288d58=JSON[_0x13d100(0x239)](_0x288d58);}catch(_0x4832da){}if(_0x288d58&&_0x288d58[_0x4d1dd4])return _0x288d58[_0x4d1dd4];}if(_0x2d2d06===_0x13d100(0x247)&&_0x3076f8[_0x13d100(0x2a2)][_0x13d100(0x1ee)]){let _0x1db9a0=_0x3076f8['config'][_0x13d100(0x1ee)];if(typeof _0x1db9a0===_0x13d100(0x260))try{_0x1db9a0=JSON[_0x13d100(0x239)](_0x1db9a0);}catch(_0x4a5026){}if(_0x1db9a0&&_0x1db9a0[_0x4d1dd4])return _0x1db9a0[_0x4d1dd4];}let _0x33aabf=[];if(_0x2d2d06==='setpoint')_0x33aabf=[{'s':_0x13d100(0x210),'t':_0x13d100(0x285)},{'s':_0x13d100(0x237),'t':_0x13d100(0x285)},{'s':_0x13d100(0x237),'t':'.4.SET_TEMPERATURE'},{'s':_0x13d100(0x243),'t':_0x13d100(0x241)},{'s':_0x13d100(0x220),'t':_0x13d100(0x25e)},{'s':_0x13d100(0x220),'t':_0x13d100(0x23a)},{'s':_0x13d100(0x1fa),'t':_0x13d100(0x259)},{'s':_0x13d100(0x24e),'t':_0x13d100(0x273)},{'s':_0x13d100(0x22b),'t':_0x13d100(0x250)},{'s':_0x13d100(0x1fa),'t':_0x13d100(0x27c)}];else _0x2d2d06===_0x13d100(0x247)&&(_0x33aabf=[{'s':_0x13d100(0x210),'t':'.1.LEVEL'},{'s':_0x13d100(0x237),'t':_0x13d100(0x275)},{'s':_0x13d100(0x237),'t':_0x13d100(0x219)},{'s':_0x13d100(0x220),'t':_0x13d100(0x1f2)},{'s':_0x13d100(0x1fa),'t':_0x13d100(0x280)},{'s':_0x13d100(0x1fa),'t':_0x13d100(0x292)}]);for(const _0x58b281 of _0x33aabf){if(_0x4d1dd4[_0x13d100(0x248)](_0x58b281['s'])){const _0x5194e7=_0x4d1dd4['replace'](_0x58b281['s'],_0x58b281['t']),_0x1a010e=await _0x3076f8['getForeignObjectAsync'](_0x5194e7);if(_0x1a010e)return _0x5194e7;}}try{const _0xbb6046=_0x4d1dd4[_0x13d100(0x257)]('.');if(_0xbb6046['length']>0x2){const _0x563e37=_0xbb6046[_0x13d100(0x254)](0x0,-0x1)['join']('.'),_0x49e25d=await _0x3076f8[_0x13d100(0x278)](_0x563e37+'.*'),_0x55abcf=[],_0xc1d625=_0x4d1dd4[_0x13d100(0x257)](/[._]+/)[_0x13d100(0x283)](_0x485378=>![_0x13d100(0x29d),'0',_0x13d100(0x26e),_0x13d100(0x204),_0x13d100(0x221),_0x13d100(0x1fa),_0x13d100(0x233),'sensor',_0x13d100(0x271),_0x13d100(0x217)][_0x13d100(0x248)](_0x485378[_0x13d100(0x211)]()));for(const [_0x46d0b3,_0x1930cc]of Object[_0x13d100(0x25d)](_0x49e25d)){if(_0x46d0b3===_0x4d1dd4)continue;if(_0x1930cc&&_0x1930cc[_0x13d100(0x26c)]){const _0x4005da=_0x46d0b3[_0x13d100(0x211)](),_0x3c7868=(_0x1930cc[_0x13d100(0x26c)][_0x13d100(0x270)]||'')[_0x13d100(0x211)](),_0xa7f82b=(_0x1930cc[_0x13d100(0x26c)][_0x13d100(0x264)]||'')[_0x13d100(0x211)]();let _0x39cf5a=![];if(_0x2d2d06===_0x13d100(0x27c)&&_0x1930cc[_0x13d100(0x26c)][_0x13d100(0x20f)]===!![])_0x39cf5a=_0x4005da['includes']('set')||_0x4005da['includes'](_0x13d100(0x218))||_0x4005da[_0x13d100(0x248)]('target')||_0x3c7868[_0x13d100(0x248)]('level.temperature')||_0x3c7868[_0x13d100(0x248)](_0x13d100(0x263));else _0x2d2d06===_0x13d100(0x247)&&(_0x39cf5a=_0x4005da[_0x13d100(0x248)]('level')||_0x4005da[_0x13d100(0x248)](_0x13d100(0x247))||_0x4005da['includes'](_0x13d100(0x25c))||_0x4005da['includes'](_0x13d100(0x205))||_0x3c7868[_0x13d100(0x248)](_0x13d100(0x23c))||_0x3c7868[_0x13d100(0x248)](_0x13d100(0x25f))||_0xa7f82b[_0x13d100(0x248)]('%'));if(_0x39cf5a){const _0x30bbd7=_0x46d0b3[_0x13d100(0x257)](/[._]+/)['map'](_0x28f9f2=>_0x28f9f2['toLowerCase']());let _0x54d5dc=0x0;_0xc1d625[_0x13d100(0x268)](_0x6f5061=>{const _0x2f6695=_0x13d100;if(_0x30bbd7[_0x2f6695(0x248)](_0x6f5061[_0x2f6695(0x211)]()))_0x54d5dc++;}),_0x55abcf[_0x13d100(0x1f4)]({'id':_0x46d0b3,'score':_0x54d5dc});}}}if(_0x55abcf[_0x13d100(0x227)]>0x0){_0x55abcf[_0x13d100(0x2a0)]((_0x14db4d,_0x486899)=>_0x486899['score']-_0x14db4d[_0x13d100(0x1ff)]);if(_0x55abcf[0x0][_0x13d100(0x1ff)]>0x0)return _0x55abcf[0x0]['id'];}}}catch(_0x3f3185){}return null;}async function scanThermostats(_0x5e9cdd){const _0x4af4a9=a1_0x8f01a,_0x599eac=_0x5e9cdd[_0x4af4a9(0x2a2)][_0x4af4a9(0x21e)]||[],_0x2af8ee=[],_0x9d4b15=_0x599eac['filter'](_0x55295e=>_0x55295e['id']&&_0x55295e['id']['includes'](_0x4af4a9(0x1fa))||_0x55295e[_0x4af4a9(0x1f1)]&&['temperature',_0x4af4a9(0x238),_0x4af4a9(0x281)]['includes'](_0x55295e[_0x4af4a9(0x1f1)])||_0x55295e['name']&&_0x55295e['name'][_0x4af4a9(0x211)]()[_0x4af4a9(0x248)]('temp'));for(const _0x393d0f of _0x9d4b15){const _0x13bd52=await findRelatedId(_0x5e9cdd,_0x393d0f['id'],'setpoint'),_0x4467ca=await findRelatedId(_0x5e9cdd,_0x393d0f['id'],_0x4af4a9(0x247));let _0x4a7d72='Nicht\x20gefunden',_0x5936af=![],_0x1e3d6=_0x5e9cdd[_0x4af4a9(0x2a2)][_0x4af4a9(0x215)]||{};if(typeof _0x1e3d6===_0x4af4a9(0x260))try{_0x1e3d6=JSON['parse'](_0x1e3d6);}catch(_0x5d4d34){}let _0x1d4e21=_0x5e9cdd[_0x4af4a9(0x2a2)][_0x4af4a9(0x1ee)]||{};if(typeof _0x1d4e21==='string')try{_0x1d4e21=JSON[_0x4af4a9(0x239)](_0x1d4e21);}catch(_0x43815c){}if(_0x1e3d6[_0x393d0f['id']]&&_0x1e3d6[_0x393d0f['id']]===_0x13bd52||_0x1d4e21[_0x393d0f['id']]&&_0x1d4e21[_0x393d0f['id']]===_0x4467ca)_0x4a7d72=_0x4af4a9(0x23d),_0x5936af=!![];else(_0x13bd52||_0x4467ca)&&(_0x4a7d72='Auto-Erkennung');_0x2af8ee['push']({'room':_0x393d0f['location']||_0x4af4a9(0x24a),'sensorId':_0x393d0f['id'],'setpointId':_0x13bd52||'-','valveId':_0x4467ca||'-','source':_0x4a7d72,'isManual':_0x5936af,'status':_0x13bd52&&_0x4467ca?_0x4af4a9(0x1f7):_0x13bd52?'OK':'Fehlt'});}return _0x2af8ee[_0x4af4a9(0x2a0)]((_0x53e7ed,_0x279bf9)=>_0x53e7ed[_0x4af4a9(0x1fc)][_0x4af4a9(0x26b)](_0x279bf9[_0x4af4a9(0x1fc)]));}async function updateSchedulePreview(_0x3fcf25){const _0x1c16e7=a1_0x8f01a;if(!_0x3fcf25[_0x1c16e7(0x2a2)][_0x1c16e7(0x265)]||!_0x3fcf25[_0x1c16e7(0x2a2)][_0x1c16e7(0x293)])return;let _0x598f17={};try{const _0x134dbc=await _0x3fcf25['getStateAsync'](_0x1c16e7(0x24f));if(_0x134dbc&&_0x134dbc[_0x1c16e7(0x1fe)])_0x598f17=JSON[_0x1c16e7(0x239)](_0x134dbc[_0x1c16e7(0x1fe)]);}catch(_0x5c5010){}const _0x5a89c3=[],_0x19752c=Date['now'](),_0x1dca8b=0x30*0x3c*0x3c*0x3e8;try{const _0xda3fc6=await _0x3fcf25[_0x1c16e7(0x20a)](_0x3fcf25[_0x1c16e7(0x2a2)][_0x1c16e7(0x293)]+_0x1c16e7(0x279));if(!_0xda3fc6||!_0xda3fc6[_0x1c16e7(0x1fe)])return;const _0x441d0e=JSON['parse'](_0xda3fc6[_0x1c16e7(0x1fe)]),_0xd62b5=_0x3fcf25[_0x1c16e7(0x2a2)][_0x1c16e7(0x24c)]||[],_0x1e9386=_0x3fcf25['config']['devices']||[],_0x442b1c=new Set();_0x1e9386[_0x1c16e7(0x268)](_0x109637=>{const _0x13ab74=_0x1c16e7;if(_0x109637[_0x13ab74(0x27e)])_0x442b1c[_0x13ab74(0x2a5)](_0x109637[_0x13ab74(0x27e)]);});for(const _0x4b540d of _0x441d0e){if(_0x4b540d['_calName']&&_0xd62b5[_0x1c16e7(0x227)]>0x0&&!_0xd62b5[_0x1c16e7(0x248)](_0x4b540d[_0x1c16e7(0x246)]))continue;const _0x32b68e=_0x4b540d[_0x1c16e7(0x25b)]||_0x4b540d[_0x1c16e7(0x222)]||_0x4b540d['date'];if(!_0x32b68e)continue;const _0x3bcd88=new Date(_0x32b68e),_0x3daa81=_0x3bcd88['getTime']();if(isNaN(_0x3daa81))continue;if(_0x3daa81<_0x19752c)continue;if(_0x3daa81>_0x19752c+_0x1dca8b)continue;const _0x49c475=(_0x4b540d[_0x1c16e7(0x26d)]||_0x4b540d[_0x1c16e7(0x289)]||'')[_0x1c16e7(0x211)]();let _0x1b866c=![],_0x5ce9ca=[],_0xa183cf=_0x4b540d['event']||_0x4b540d[_0x1c16e7(0x289)]||'Unbekannt';if(_0x49c475[_0x1c16e7(0x248)](_0x1c16e7(0x251))||_0x49c475[_0x1c16e7(0x248)](_0x1c16e7(0x294))||_0x49c475[_0x1c16e7(0x248)]('ankunft'))_0x1b866c=!![],_0x5ce9ca=Array['from'](_0x442b1c);else for(const _0x463920 of _0x442b1c){if(_0x49c475[_0x1c16e7(0x248)](_0x463920[_0x1c16e7(0x211)]()))_0x5ce9ca[_0x1c16e7(0x1f4)](_0x463920);}_0x5ce9ca[_0x1c16e7(0x227)]>0x0&&_0x5ce9ca[_0x1c16e7(0x268)](_0x24aa49=>{const _0x5b7f48=_0x1c16e7;let _0x448b95=0x3c;if(_0x1b866c){let _0x232f30=0x0;Object[_0x5b7f48(0x2a3)](_0x598f17)[_0x5b7f48(0x268)](_0x35d5cb=>{if(_0x35d5cb>_0x232f30)_0x232f30=_0x35d5cb;}),_0x448b95=_0x232f30>0x0?_0x232f30:0x78;}else _0x448b95=_0x598f17[_0x24aa49]||0x3c;const _0x46465d=new Date(_0x3daa81-_0x448b95*0xea60);_0x5a89c3[_0x5b7f48(0x1f4)]({'eventTime':_0x3daa81,'triggerTime':_0x46465d[_0x5b7f48(0x287)](),'room':_0x24aa49,'minutes':_0x448b95,'reason':_0xa183cf,'isGlobal':_0x1b866c});});}}catch(_0x5b01d9){}_0x5a89c3['sort']((_0x906fa2,_0x1593ff)=>_0x906fa2[_0x1c16e7(0x290)]-_0x1593ff[_0x1c16e7(0x290)]);const _0x5d5ff8=_0x5a89c3[_0x1c16e7(0x254)](0x0,0x5);await _0x3fcf25['setStateAsync'](_0x1c16e7(0x2a9),{'val':JSON[_0x1c16e7(0x298)](_0x5d5ff8),'ack':!![]});}async function monitorEnforcements(_0x4f2ac4){const _0x489efe=a1_0x8f01a;try{const _0x2c12d3=_0x489efe(0x226),_0x5cc240=await _0x4f2ac4[_0x489efe(0x234)](_0x2c12d3);if(!_0x5cc240||!_0x5cc240[_0x489efe(0x1fe)])return;let _0x4fdd5c=[];try{_0x4fdd5c=JSON[_0x489efe(0x239)](_0x5cc240['val']);}catch(_0x397e26){return;}if(!Array[_0x489efe(0x22a)](_0x4fdd5c)||_0x4fdd5c[_0x489efe(0x227)]===0x0)return;const _0x2d903f=Date[_0x489efe(0x284)](),_0xe395f5=_0x4f2ac4['config'][_0x489efe(0x21e)]||[];let _0x52befe=![];for(let _0x21d065=_0x4fdd5c[_0x489efe(0x227)]-0x1;_0x21d065>=0x0;_0x21d065--){const _0x231022=_0x4fdd5c[_0x21d065];if(_0x2d903f>=_0x231022['until']){_0x4f2ac4[_0x489efe(0x27d)][_0x489efe(0x297)](_0x489efe(0x252)+_0x231022[_0x489efe(0x1fc)]+_0x489efe(0x22e)),_0x4fdd5c[_0x489efe(0x1f0)](_0x21d065,0x1),_0x52befe=!![];continue;}const _0x492bb9=_0xe395f5[_0x489efe(0x22d)](_0x57f0f2=>normalize(_0x57f0f2[_0x489efe(0x27e)])===normalize(_0x231022[_0x489efe(0x1fc)])&&(_0x57f0f2[_0x489efe(0x1f1)]===_0x489efe(0x1fa)||_0x57f0f2[_0x489efe(0x1f1)]===_0x489efe(0x238)));if(_0x492bb9){const _0x26655e=await findRelatedId(_0x4f2ac4,_0x492bb9['id'],_0x489efe(0x27c));if(_0x26655e){const _0x40964e=await _0x4f2ac4[_0x489efe(0x20a)](_0x26655e);_0x40964e&&typeof _0x40964e[_0x489efe(0x1fe)]===_0x489efe(0x242)&&(_0x40964e[_0x489efe(0x1fe)]<0xf&&(_0x4f2ac4[_0x489efe(0x27d)][_0x489efe(0x21b)]('ðŸš¨\x20[ENFORCEMENT]\x20Hardware-Profil\x20hat\x20'+_0x231022[_0x489efe(0x1fc)]+_0x489efe(0x26f)+_0x40964e[_0x489efe(0x1fe)]+'Â°C\x20abgesenkt!\x20Zwinge\x20zurÃ¼ck\x20auf\x20'+_0x231022[_0x489efe(0x267)]+'Â°C.'),await _0x4f2ac4[_0x489efe(0x255)](_0x26655e,_0x231022['target']),await logAutomationAction(_0x4f2ac4,_0x489efe(0x29b)+_0x231022[_0x489efe(0x1fc)]+':\x20'+_0x40964e[_0x489efe(0x1fe)]+_0x489efe(0x1f6)+_0x231022['target']+_0x489efe(0x21d))));}}}_0x52befe&&await _0x4f2ac4[_0x489efe(0x256)](_0x2c12d3,{'val':JSON[_0x489efe(0x298)](_0x4fdd5c),'ack':!![]});}catch(_0x3723ed){_0x4f2ac4[_0x489efe(0x27d)][_0x489efe(0x27f)]('Enforcement\x20Monitor\x20Error:\x20'+_0x3723ed[_0x489efe(0x288)]);}}async function checkCalendarTriggers(_0x1bdb1a){const _0x177c47=a1_0x8f01a;if(!_0x1bdb1a['config'][_0x177c47(0x265)]||!_0x1bdb1a['config'][_0x177c47(0x293)])return;await updateSchedulePreview(_0x1bdb1a);let _0x482ee0={},_0x5c60b1={};try{const _0x3b4658=await _0x1bdb1a[_0x177c47(0x234)](_0x177c47(0x24f));if(_0x3b4658&&_0x3b4658['val'])_0x482ee0=JSON['parse'](_0x3b4658[_0x177c47(0x1fe)]);const _0xde6341=await _0x1bdb1a[_0x177c47(0x234)](_0x177c47(0x26a));if(_0xde6341&&_0xde6341[_0x177c47(0x1fe)])_0x5c60b1=JSON[_0x177c47(0x239)](_0xde6341['val']);}catch(_0x5766c1){}let _0x34e1cd={'default':0x15};try{const _0x3f2155=await _0x1bdb1a['getStateAsync'](_0x177c47(0x28d));if(_0x3f2155&&_0x3f2155[_0x177c47(0x1fe)])_0x34e1cd=JSON[_0x177c47(0x239)](_0x3f2155[_0x177c47(0x1fe)]);}catch(_0x9ce405){}let _0x461bd0=[];try{const _0x416c7d=await _0x1bdb1a[_0x177c47(0x234)](_0x177c47(0x226));if(_0x416c7d&&_0x416c7d['val'])_0x461bd0=JSON[_0x177c47(0x239)](_0x416c7d['val']);}catch(_0x57b846){}try{const _0x4621bd=await _0x1bdb1a['getForeignStateAsync'](_0x1bdb1a['config'][_0x177c47(0x293)]+_0x177c47(0x279));if(!_0x4621bd||!_0x4621bd[_0x177c47(0x1fe)])return;const _0x50875c=JSON['parse'](_0x4621bd['val']),_0x12acb3=Date[_0x177c47(0x284)](),_0x5941f6=_0x1bdb1a[_0x177c47(0x2a2)]['devices']||[],_0x25f469=_0x1bdb1a[_0x177c47(0x2a2)]['calendarSelection']||[];let _0x557761=![];for(const _0x4d467f of _0x50875c){if(_0x4d467f[_0x177c47(0x246)]&&_0x25f469[_0x177c47(0x227)]>0x0&&!_0x25f469['includes'](_0x4d467f[_0x177c47(0x246)]))continue;const _0x10118c=_0x4d467f[_0x177c47(0x25b)]||_0x4d467f['eventStart']||_0x4d467f[_0x177c47(0x2a8)];if(!_0x10118c)continue;const _0x1be327=new Date(_0x10118c);if(isNaN(_0x1be327[_0x177c47(0x287)]()))continue;const _0x49cffa=(_0x4d467f[_0x177c47(0x26d)]||_0x4d467f[_0x177c47(0x289)]||'')['toLowerCase']();if(_0x49cffa[_0x177c47(0x248)]('urlaub\x20ende')||_0x49cffa[_0x177c47(0x248)]('rÃ¼ckkehr')||_0x49cffa[_0x177c47(0x248)]('ankunft')){let _0x10e34f=0x0;Object['values'](_0x482ee0)[_0x177c47(0x268)](_0x526089=>{if(_0x526089>_0x10e34f)_0x10e34f=_0x526089;});if(_0x10e34f===0x0)_0x10e34f=0x78;const _0x1b3d08=_0x1be327[_0x177c47(0x287)]()-_0x10e34f*0xea60;_0x12acb3>=_0x1b3d08&&_0x12acb3<_0x1be327[_0x177c47(0x287)]()&&(_0x1bdb1a[_0x177c47(0x23e)]!==_0x177c47(0x258)&&(_0x1bdb1a[_0x177c47(0x27d)][_0x177c47(0x297)]('ðŸ“…\x20SMART\x20SCHEDULE\x20(Phase):\x20\x27Globaler\x20Start\x27\x20erkannt.\x20Heize\x20Haus\x20auf\x20(Vorlauf:\x20'+_0x10e34f+_0x177c47(0x262)),await _0x1bdb1a[_0x177c47(0x256)](_0x177c47(0x25a),{'val':_0x177c47(0x258),'ack':![]})));}for(const _0x401d13 of _0x5941f6){if(_0x401d13[_0x177c47(0x27e)]){const _0x12d85d=_0x401d13[_0x177c47(0x27e)][_0x177c47(0x211)](),_0x31e139=(_0x401d13[_0x177c47(0x201)]||'')[_0x177c47(0x211)]();let _0x132247=_0x49cffa[_0x177c47(0x248)](_0x12d85d);!_0x132247&&_0x31e139[_0x177c47(0x227)]>0x3&&_0x49cffa[_0x177c47(0x248)](_0x31e139)&&(_0x132247=!![]);if(_0x132247){const _0x4be9c4=_0x482ee0[_0x401d13[_0x177c47(0x27e)]]||0x3c,_0x53d701=_0x5c60b1[_0x401d13[_0x177c47(0x27e)]]||_0x177c47(0x28e),_0x231b27=_0x1be327[_0x177c47(0x287)]()-_0x4be9c4*0xea60;if(_0x12acb3>=_0x231b27&&_0x12acb3<_0x1be327[_0x177c47(0x287)]()){const _0x17d3fe=lastActions[_0x177c47(0x207)+_0x401d13['location']];if(_0x17d3fe&&_0x12acb3-_0x17d3fe<CAL_COOLDOWN_MS)continue;const _0x583ce6=await findRelatedId(_0x1bdb1a,_0x401d13['id'],'setpoint');if(_0x583ce6){let _0x1018d6=_0x34e1cd[_0x401d13[_0x177c47(0x27e)]];if(_0x1018d6===undefined)_0x1018d6=_0x34e1cd[_0x177c47(0x27b)];if(_0x1018d6===undefined)_0x1018d6=0x15;const _0x3e048e=await _0x1bdb1a[_0x177c47(0x20a)](_0x583ce6);if(_0x3e048e&&typeof _0x3e048e['val']===_0x177c47(0x242)&&_0x3e048e['val']<_0x1018d6-0.5){_0x1bdb1a[_0x177c47(0x27d)]['info']('ðŸ“…\x20SMART\x20SCHEDULE\x20['+_0x53d701+_0x177c47(0x1f8)+_0x401d13[_0x177c47(0x27e)]+_0x177c47(0x2a7)+_0x49cffa+_0x177c47(0x208)+_0x1018d6+_0x177c47(0x286)+_0x4be9c4+_0x177c47(0x262)),await _0x1bdb1a[_0x177c47(0x255)](_0x583ce6,_0x1018d6),await logAutomationAction(_0x1bdb1a,_0x177c47(0x22c)+_0x401d13[_0x177c47(0x27e)]+_0x177c47(0x269)+_0x1018d6+'Â°C\x20(via\x20'+_0x53d701+')'),lastActions[_0x177c47(0x207)+_0x401d13[_0x177c47(0x27e)]]=_0x12acb3;const _0x108b1e=_0x461bd0[_0x177c47(0x244)](_0x33aeeb=>_0x33aeeb[_0x177c47(0x1fc)]===_0x401d13[_0x177c47(0x27e)]);if(_0x108b1e!==-0x1)_0x461bd0[_0x177c47(0x1f0)](_0x108b1e,0x1);_0x461bd0[_0x177c47(0x1f4)]({'room':_0x401d13[_0x177c47(0x27e)],'target':_0x1018d6,'until':_0x1be327[_0x177c47(0x287)]()}),_0x557761=!![];}}}}}}}_0x557761&&await _0x1bdb1a[_0x177c47(0x256)](_0x177c47(0x226),{'val':JSON[_0x177c47(0x298)](_0x461bd0),'ack':!![]});}catch(_0x4434ef){_0x1bdb1a[_0x177c47(0x27d)]['warn']('Calendar\x20Check\x20Error:\x20'+_0x4434ef[_0x177c47(0x288)]);}}async function manageMpcIntervention(_0x15deec,_0x352de6,_0x2aad36){const _0x424f3e=a1_0x8f01a;try{const _0x32cc6a=_0x424f3e(0x282),_0x191db1=await _0x15deec[_0x424f3e(0x234)](_0x32cc6a);let _0x23c1ef=[];if(_0x191db1&&_0x191db1[_0x424f3e(0x1fe)])try{_0x23c1ef=JSON['parse'](_0x191db1[_0x424f3e(0x1fe)]);}catch(_0x34d840){}const _0x1df6a8=_0x23c1ef[_0x424f3e(0x1fd)](_0x352de6);if(_0x2aad36===_0x424f3e(0x2a5))_0x1df6a8===-0x1&&(_0x23c1ef['push'](_0x352de6),await _0x15deec[_0x424f3e(0x256)](_0x32cc6a,{'val':JSON['stringify'](_0x23c1ef),'ack':!![]}));else _0x2aad36===_0x424f3e(0x249)&&(_0x1df6a8!==-0x1&&(_0x23c1ef[_0x424f3e(0x1f0)](_0x1df6a8,0x1),await _0x15deec[_0x424f3e(0x256)](_0x32cc6a,{'val':JSON[_0x424f3e(0x298)](_0x23c1ef),'ack':!![]})));}catch(_0x4af0ff){}}async function cleanupGhostInterventions(_0x58078d){const _0x2a143a=a1_0x8f01a;try{const _0x5ac6d2=_0x2a143a(0x282),_0x194c84=await _0x58078d['getStateAsync'](_0x5ac6d2);if(!_0x194c84||!_0x194c84[_0x2a143a(0x1fe)])return;const _0xb43d15=JSON[_0x2a143a(0x239)](_0x194c84[_0x2a143a(0x1fe)]);if(!Array[_0x2a143a(0x22a)](_0xb43d15)||_0xb43d15['length']===0x0)return;let _0x5a67e2={'default':0x15};try{const _0xf7fa90=await _0x58078d['getStateAsync'](_0x2a143a(0x28d));if(_0xf7fa90&&_0xf7fa90[_0x2a143a(0x1fe)])_0x5a67e2=JSON[_0x2a143a(0x239)](_0xf7fa90[_0x2a143a(0x1fe)]);}catch(_0x210ce5){}let _0x972b32=[];try{const _0x5dcef0=await _0x58078d[_0x2a143a(0x234)]('analysis.energy.ventilationAlerts');if(_0x5dcef0&&_0x5dcef0[_0x2a143a(0x1fe)])_0x972b32=JSON[_0x2a143a(0x239)](_0x5dcef0[_0x2a143a(0x1fe)]);}catch(_0x315b25){}const _0x458b20=_0x58078d[_0x2a143a(0x2a2)]['devices']||[];let _0x2d30d1=![];for(let _0x1910cc=_0xb43d15[_0x2a143a(0x227)]-0x1;_0x1910cc>=0x0;_0x1910cc--){const _0x38882e=_0xb43d15[_0x1910cc],_0x41bfe3=_0x458b20[_0x2a143a(0x22d)](_0x3b6561=>normalize(_0x3b6561[_0x2a143a(0x27e)])===normalize(_0x38882e)&&(_0x3b6561['type']===_0x2a143a(0x1fa)||_0x3b6561[_0x2a143a(0x1f1)]===_0x2a143a(0x238)));if(!_0x41bfe3){_0x58078d[_0x2a143a(0x27d)][_0x2a143a(0x21b)](_0x2a143a(0x206)+_0x38882e+'\x27\x20hat\x20kein\x20GerÃ¤t\x20mehr.\x20LÃ¶sche\x20Eintrag.'),_0xb43d15[_0x2a143a(0x1f0)](_0x1910cc,0x1),_0x2d30d1=!![];continue;}if(_0x41bfe3){const _0x597a84=await findRelatedId(_0x58078d,_0x41bfe3['id'],'setpoint'),_0x16f3dd=await _0x58078d[_0x2a143a(0x20a)](_0x41bfe3['id']);if(_0x597a84){const _0x35df0e=await _0x58078d[_0x2a143a(0x20a)](_0x597a84);if(_0x35df0e&&typeof _0x35df0e['val']===_0x2a143a(0x242)){let _0x98702f=![],_0x21363f='';Math[_0x2a143a(0x1ef)](_0x35df0e['val']-ECO_TEMP)>0.5&&(_0x98702f=!![],_0x21363f=_0x2a143a(0x245));if(!_0x98702f&&_0x16f3dd&&typeof _0x16f3dd[_0x2a143a(0x1fe)]==='number'){const _0xaff573=_0x5a67e2[_0x38882e]||_0x5a67e2['default']||0x15;_0x16f3dd[_0x2a143a(0x1fe)]<_0xaff573+0.2&&(_0x98702f=!![],_0x21363f=_0x2a143a(0x2a6));}if(_0x98702f){if(_0x21363f==='manual'){_0x58078d[_0x2a143a(0x27d)][_0x2a143a(0x297)](_0x2a143a(0x21c)+_0x38882e+_0x2a143a(0x296)+_0x35df0e[_0x2a143a(0x1fe)]+_0x2a143a(0x266)+ECO_TEMP+'Â°C).\x20Entferne\x20Status.');const _0x21e2fc=lastActions['cal_'+_0x38882e],_0x49f36a=_0x21e2fc&&Date[_0x2a143a(0x284)]()-_0x21e2fc<0x2*0x3c*0x3e8;if(!_0x49f36a&&_0x35df0e[_0x2a143a(0x1fe)]>ECO_TEMP+0.5)_0x58078d[_0x2a143a(0x23f)]&&(_0x58078d[_0x2a143a(0x27d)]['info'](_0x2a143a(0x231)+_0x38882e+_0x2a143a(0x29f)),_0x58078d['sendToPythonWrapper'](_0x2a143a(0x28f),{'room':_0x38882e}));else _0x49f36a&&_0x58078d[_0x2a143a(0x27d)][_0x2a143a(0x297)]('ðŸ“…\x20[MPC\x20INFO]\x20'+_0x38882e+_0x2a143a(0x20e));}else{if(_0x21363f===_0x2a143a(0x2a6)){let _0x39e5a6=![];if(_0x972b32[_0x2a143a(0x22d)](_0x42d30e=>_0x42d30e[_0x2a143a(0x1fc)]===_0x38882e))_0x39e5a6=!![];const _0x243e9c=_0x458b20[_0x2a143a(0x283)](_0x31c0d2=>normalize(_0x31c0d2[_0x2a143a(0x27e)])===normalize(_0x38882e)&&(_0x31c0d2[_0x2a143a(0x1f1)]===_0x2a143a(0x27a)||_0x31c0d2['type']==='sensor'||_0x31c0d2[_0x2a143a(0x1f1)]===_0x2a143a(0x28c)));for(const _0x5678d5 of _0x243e9c){try{const _0x2dc454=await _0x58078d[_0x2a143a(0x20a)](_0x5678d5['id']);if(_0x2dc454&&(_0x2dc454[_0x2a143a(0x1fe)]===!![]||_0x2dc454[_0x2a143a(0x1fe)]===0x1||String(_0x2dc454[_0x2a143a(0x1fe)])[_0x2a143a(0x211)]()===_0x2a143a(0x1f9)))_0x39e5a6=!![];}catch(_0x1d3f82){}}if(_0x39e5a6)_0x58078d[_0x2a143a(0x27d)]['info'](_0x2a143a(0x21a)+_0x38882e+_0x2a143a(0x216));else{const _0x3b6b02=_0x5a67e2[_0x38882e]||_0x5a67e2[_0x2a143a(0x27b)]||0x15;_0x58078d[_0x2a143a(0x27d)][_0x2a143a(0x297)](_0x2a143a(0x28b)+_0x38882e+_0x2a143a(0x200)+_0x16f3dd[_0x2a143a(0x1fe)]+_0x2a143a(0x1ed)+(_0x3b6b02+0.2)+_0x2a143a(0x261)),await _0x58078d[_0x2a143a(0x255)](_0x597a84,_0x3b6b02),await logAutomationAction(_0x58078d,'[WATCHDOG]\x20'+_0x38882e+':\x20Puffer\x20leer\x20->\x20Heizen\x20auf\x20'+_0x3b6b02+'Â°C'),lastActions['rescue_'+_0x38882e]=Date[_0x2a143a(0x284)]();}}}_0xb43d15[_0x2a143a(0x1f0)](_0x1910cc,0x1),_0x2d30d1=!![];}}}}}_0x2d30d1&&await _0x58078d[_0x2a143a(0x256)](_0x5ac6d2,{'val':JSON['stringify'](_0xb43d15),'ack':!![]});}catch(_0x5aa0d9){}}async function applyEnergySavings(_0x1cc869,_0x42d1eb){const _0xc6ccf1=a1_0x8f01a;await cleanupGhostInterventions(_0x1cc869);if(!_0x42d1eb||_0x42d1eb[_0xc6ccf1(0x227)]===0x0)return;const _0x41e8b9=_0x1cc869['config'][_0xc6ccf1(0x21e)]||[],_0x360870=Date[_0xc6ccf1(0x284)]();for(const _0x1b0c61 of _0x42d1eb){const _0x518901=_0x1b0c61[_0xc6ccf1(0x1fc)],_0x4e4f37=_0x1b0c61[_0xc6ccf1(0x277)],_0x26a81a=_0x1b0c61[_0xc6ccf1(0x267)]||0x15;if(lastActions[_0xc6ccf1(0x232)+_0x518901]&&_0x360870-lastActions['rescue_'+_0x518901]<RESCUE_LOCK_MS)continue;const _0x543461=_0x41e8b9[_0xc6ccf1(0x22d)](_0x563df5=>normalize(_0x563df5['location'])===normalize(_0x518901)&&(_0x563df5[_0xc6ccf1(0x1f1)]===_0xc6ccf1(0x1fa)||_0x563df5[_0xc6ccf1(0x1f1)]===_0xc6ccf1(0x238)));if(!_0x543461)continue;const _0x372661=await findRelatedId(_0x1cc869,_0x543461['id'],_0xc6ccf1(0x27c));if(_0x372661){if(lastActions[_0xc6ccf1(0x22f)+_0x518901]&&_0x360870-lastActions[_0xc6ccf1(0x22f)+_0x518901]<0x1e*0x3c*0x3e8)continue;const _0x12eafe=await _0x1cc869[_0xc6ccf1(0x20a)](_0x372661);if(_0x12eafe&&typeof _0x12eafe[_0xc6ccf1(0x1fe)]==='number'){const _0x22328a=_0x12eafe[_0xc6ccf1(0x1fe)];_0x22328a!==ECO_TEMP&&await manageMpcIntervention(_0x1cc869,_0x518901,'remove');if(_0x4e4f37>0x1e)_0x22328a>ECO_TEMP+0.5&&(_0x1cc869[_0xc6ccf1(0x27d)][_0xc6ccf1(0x297)](_0xc6ccf1(0x230)+_0x518901+_0xc6ccf1(0x26f)+ECO_TEMP+_0xc6ccf1(0x203)+_0x4e4f37+'\x20min)'),await _0x1cc869[_0xc6ccf1(0x255)](_0x372661,ECO_TEMP),await manageMpcIntervention(_0x1cc869,_0x518901,'add'),lastActions[_0xc6ccf1(0x22f)+_0x518901]=_0x360870,await logAutomationAction(_0x1cc869,_0xc6ccf1(0x29a)+_0x518901+':\x20Absenkung\x20auf\x20'+ECO_TEMP+'Â°C'));else _0x4e4f37<=0xf&&(_0x22328a<_0x26a81a&&(_0x1cc869[_0xc6ccf1(0x27d)][_0xc6ccf1(0x297)]('ðŸ”¥\x20[MPC\x20ACTION]\x20Heize\x20'+_0x518901+_0xc6ccf1(0x20c)+_0x26a81a+'Â°C!\x20(Puffer\x20leer).'),await _0x1cc869['setForeignStateAsync'](_0x372661,_0x26a81a),await manageMpcIntervention(_0x1cc869,_0x518901,_0xc6ccf1(0x249)),lastActions[_0xc6ccf1(0x22f)+_0x518901]=_0x360870,await logAutomationAction(_0x1cc869,_0xc6ccf1(0x29a)+_0x518901+_0xc6ccf1(0x2a4)+_0x26a81a+'Â°C')));}}else _0x1cc869[_0xc6ccf1(0x27d)]['warn'](_0xc6ccf1(0x24b)+_0x518901+_0xc6ccf1(0x228));}}module['exports']={'handlePrediction':handlePrediction,'applyEnergySavings':applyEnergySavings,'scanThermostats':scanThermostats,'checkCalendarTriggers':checkCalendarTriggers,'monitorEnforcements':monitorEnforcements,'updateSchedulePreview':updateSchedulePreview,'cleanupGhostInterventions':cleanupGhostInterventions};