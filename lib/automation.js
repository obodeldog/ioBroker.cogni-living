const a1_0x314819=a1_0x4b23;(function(_0x44a947,_0x76a889){const _0x591702=a1_0x4b23,_0x230c42=_0x44a947();while(!![]){try{const _0x5cd4bd=parseInt(_0x591702(0x160))/0x1*(-parseInt(_0x591702(0x124))/0x2)+parseInt(_0x591702(0x170))/0x3+-parseInt(_0x591702(0x107))/0x4+-parseInt(_0x591702(0x149))/0x5*(parseInt(_0x591702(0x17e))/0x6)+parseInt(_0x591702(0x11b))/0x7+parseInt(_0x591702(0x12f))/0x8+-parseInt(_0x591702(0x11d))/0x9*(-parseInt(_0x591702(0x152))/0xa);if(_0x5cd4bd===_0x76a889)break;else _0x230c42['push'](_0x230c42['shift']());}catch(_0x15f153){_0x230c42['push'](_0x230c42['shift']());}}}(a1_0xafdd,0x7777b));const a1_0xc4dfae=(function(){let _0x1b7173=!![];return function(_0x5eccc1,_0x2ac2b3){const _0x3b1ab6=_0x1b7173?function(){const _0x415098=a1_0x4b23;if(_0x2ac2b3){const _0x49297d=_0x2ac2b3[_0x415098(0x177)](_0x5eccc1,arguments);return _0x2ac2b3=null,_0x49297d;}}:function(){};return _0x1b7173=![],_0x3b1ab6;};}()),a1_0x1edacc=a1_0xc4dfae(this,function(){const _0x3d4ba0=a1_0x4b23;return a1_0x1edacc['toString']()[_0x3d4ba0(0x142)]('(((.+)+)+)+$')[_0x3d4ba0(0xfe)]()['constructor'](a1_0x1edacc)['search']('(((.+)+)+)+$');});a1_0x1edacc();function a1_0x4b23(_0x5499e4,_0x11ffe2){const _0x12902d=a1_0xafdd();return a1_0x4b23=function(_0x1edacc,_0xc4dfae){_0x1edacc=_0x1edacc-0xfd;let _0xafdd56=_0x12902d[_0x1edacc];return _0xafdd56;},a1_0x4b23(_0x5499e4,_0x11ffe2);}'use strict';const aiAgent=require(a1_0x314819(0x14d)),COOLDOWN_MS=0x3c*0x3e8,CAL_COOLDOWN_MS=0x5a*0x3c*0x3e8,ECO_TEMP=0x11,lastActions={};function normalize(_0x35aa20){const _0x5834b3=a1_0x314819;if(!_0x35aa20)return'';return _0x35aa20[_0x5834b3(0x168)]()[_0x5834b3(0x137)](/\s+/g,'')[_0x5834b3(0x169)]();}async function logAutomationAction(_0x4e6f4d,_0x1ac21a){const _0x3c05cf=a1_0x314819;await _0x4e6f4d[_0x3c05cf(0x13e)](_0x3c05cf(0x131),{'val':_0x1ac21a,'ack':!![]});try{const _0x3d95e6='analysis.automation.actionLog',_0x121712=await _0x4e6f4d[_0x3c05cf(0x108)](_0x3d95e6);let _0xca7c80=[];if(_0x121712&&_0x121712[_0x3c05cf(0x14a)])try{_0xca7c80=JSON[_0x3c05cf(0x15a)](_0x121712[_0x3c05cf(0x14a)]);}catch(_0x1f7e7a){}_0xca7c80[_0x3c05cf(0x128)]({'ts':Date[_0x3c05cf(0x150)](),'msg':_0x1ac21a});if(_0xca7c80[_0x3c05cf(0x100)]>0x32)_0xca7c80=_0xca7c80[_0x3c05cf(0x16b)](0x0,0x32);await _0x4e6f4d[_0x3c05cf(0x13e)](_0x3d95e6,{'val':JSON['stringify'](_0xca7c80),'ack':!![]});}catch(_0x2db9d1){}}function a1_0xafdd(){const _0xf02860=['level','analysis.energy.schedulePreview','15hknxGb','val','cal_','exports','./ai_agent','setpoint','log','now','.data.table','10900uWVSez','includes','map','splice','ðŸ”¥\x20[MPC\x20ACTION]\x20Heize\x20','\x27\x20aktiv.\x20Heize\x20auf\x20','temp','Auto-Erkennung','parse','thermostatMapping','Manuelles\x20Mapping','wert','level.valve','useCalendar','26luCiJa','ðŸƒ\x20[MPC\x20ACTION]\x20Senke\x20','Calendar\x20Check\x20Error:\x20','mpc_','urlaub\x20ende','value.valve','\x20->\x20','analysis.energy.warmupSources','toLowerCase','trim','.1.TEMPERATURE','slice','thermostat','string','Classic','\x20->\x20Schalte\x20','2698701eqodgU','_date','stringify','level.temperature','forEach','getForeignObjectAsync','Soll','apply','messwert','split','push','.1.SET_POINT_TEMPERATURE','Nicht\x20gefunden','remove','908706tfXoCU','switch','filter','toUpperCase','setForeignStateAsync','Â°C\x20(Vorlauf:\x20','openknx','.1.LEVEL','warn','Fehlt','temperature','target','room','rÃ¼ckkehr','PERFECT','getTime','triggerTime','current_heating_setpoint','off','ðŸ“…\x20SMART\x20SCHEDULE\x20(Phase):\x20\x27Globaler\x20Start\x27\x20erkannt.\x20Heize\x20Haus\x20auf\x20(Vorlauf:\x20','[MPC]\x20','valveMapping','Â°C!\x20(Puffer:\x20','values','.1.ACTUAL_TEMPERATURE','score','set','consultButler','soll','Unknown','toString','SET','length','\x20min).','eventStart','localeCompare','ist','system.mode','calendarInstance','1903100kdmaNU','getStateAsync','find','ACTUAL','pi_heating_demand','sensor','indexOf','config','ACTUAL_TEMPERATURE','.4.VALVE_STATE','getForeignObjectsAsync','analysis.energy.mpcActiveInterventions','join','event','calendarSelection','minutes_safe','Â°C\x20(via\x20','Ist','local_temperature','PrÃ¤diktion:\x20','1314999vBtUfB','stellwert','6318aBNBRo','add','message','date','\x20min)','\x20gefunden!','summary','59494WvJhgl','write','Unbekannt','common','unshift','analysis.energy.warmupTimes','getForeignStateAsync','valve','.4.SET_TEMPERATURE','type','name','2722280yrqsUt','devices','analysis.automation.lastAction','[MPC\x20WARNING]\x20Kein\x20Setpoint\x20fÃ¼r\x20','normal','currentSystemMode','number','entries','replace','analysis.automation.confidenceThreshold','Â°C!\x20(Puffer\x20leer).','info','sort','location','_calName','setStateAsync','\x20wieder\x20auf\x20','state','actual','search','hm-rpc','reason','ðŸ“…\x20SMART\x20SCHEDULE\x20[','default'];a1_0xafdd=function(){return _0xf02860;};return a1_0xafdd();}async function handlePrediction(_0x2caa6d,_0x3f3162,_0x134438){const _0x53e9b9=a1_0x314819;if(!_0x3f3162||_0x3f3162===_0x53e9b9(0xfd))return;let _0x32659b=_0x53e9b9(0x190),_0x39fefd=0.6;try{const _0x36cfbd=await _0x2caa6d[_0x53e9b9(0x108)]('analysis.automation.mode');if(_0x36cfbd&&_0x36cfbd[_0x53e9b9(0x14a)])_0x32659b=_0x36cfbd[_0x53e9b9(0x14a)];const _0x320053=await _0x2caa6d[_0x53e9b9(0x108)](_0x53e9b9(0x138));if(_0x320053&&_0x320053[_0x53e9b9(0x14a)])_0x39fefd=_0x320053[_0x53e9b9(0x14a)];}catch(_0x52623b){}if(_0x32659b===_0x53e9b9(0x190)||_0x134438<_0x39fefd)return;const _0x3e0996=Date[_0x53e9b9(0x150)]();if(lastActions[_0x3f3162]&&_0x3e0996-lastActions[_0x3f3162]<COOLDOWN_MS)return;const _0x4ab407=_0x2caa6d['config'][_0x53e9b9(0x130)]||[],_0x5a5c39=normalize(_0x3f3162),_0x22b780=_0x4ab407['find'](_0x245b41=>normalize(_0x245b41[_0x53e9b9(0x13c)])===_0x5a5c39&&(_0x245b41[_0x53e9b9(0x12d)]==='light'||_0x245b41[_0x53e9b9(0x12d)]==='dimmer'||_0x245b41[_0x53e9b9(0x12d)]===_0x53e9b9(0x17f)));if(!_0x22b780)return;const _0x1a3105=await aiAgent[_0x53e9b9(0x199)](_0x2caa6d,_0x3f3162,_0x22b780['name'],_0x134438);if(!_0x1a3105['approved'])return;const _0x3b7633=_0x53e9b9(0x11a)+_0x3f3162+_0x53e9b9(0x16f)+_0x22b780[_0x53e9b9(0x12e)]+'\x20('+_0x1a3105[_0x53e9b9(0x144)]+')';await logAutomationAction(_0x2caa6d,'['+_0x32659b[_0x53e9b9(0x181)]()+']\x20'+_0x3b7633);if(_0x32659b==='active'){const _0x43b084=await _0x2caa6d['getForeignStateAsync'](_0x22b780['id']);(!_0x43b084||!_0x43b084[_0x53e9b9(0x14a)]&&_0x43b084[_0x53e9b9(0x14a)]!==!![])&&await _0x2caa6d['setForeignStateAsync'](_0x22b780['id'],!![]),lastActions[_0x3f3162]=_0x3e0996;}}async function findRelatedId(_0x146337,_0x2f57b7,_0x1b80ec=a1_0x314819(0x14e)){const _0x284252=a1_0x314819;if(_0x1b80ec===_0x284252(0x14e)&&_0x146337[_0x284252(0x10e)]['thermostatMapping']){let _0x44a669=_0x146337[_0x284252(0x10e)]['thermostatMapping'];if(typeof _0x44a669===_0x284252(0x16d))try{_0x44a669=JSON[_0x284252(0x15a)](_0x44a669);}catch(_0x153250){}if(_0x44a669&&_0x44a669[_0x2f57b7])return _0x44a669[_0x2f57b7];}if(_0x1b80ec===_0x284252(0x12b)&&_0x146337[_0x284252(0x10e)]['valveMapping']){let _0x3490d7=_0x146337[_0x284252(0x10e)]['valveMapping'];if(typeof _0x3490d7===_0x284252(0x16d))try{_0x3490d7=JSON[_0x284252(0x15a)](_0x3490d7);}catch(_0x26b78c){}if(_0x3490d7&&_0x3490d7[_0x2f57b7])return _0x3490d7[_0x2f57b7];}let _0x96f81d=[];if(_0x1b80ec===_0x284252(0x14e))_0x96f81d=[{'s':_0x284252(0x196),'t':_0x284252(0x17b)},{'s':_0x284252(0x16a),'t':_0x284252(0x17b)},{'s':'.1.TEMPERATURE','t':_0x284252(0x12c)},{'s':_0x284252(0x10f),'t':'SET_POINT_TEMPERATURE'},{'s':'local_temperature','t':'occupied_heating_setpoint'},{'s':'local_temperature','t':_0x284252(0x18f)},{'s':_0x284252(0x188),'t':'target_temperature'},{'s':_0x284252(0x10a),'t':_0x284252(0xff)},{'s':_0x284252(0x118),'t':_0x284252(0x176)},{'s':_0x284252(0x188),'t':_0x284252(0x14e)}];else _0x1b80ec===_0x284252(0x12b)&&(_0x96f81d=[{'s':_0x284252(0x196),'t':'.1.LEVEL'},{'s':'.1.TEMPERATURE','t':_0x284252(0x185)},{'s':'.1.TEMPERATURE','t':_0x284252(0x110)},{'s':_0x284252(0x119),'t':_0x284252(0x10b)},{'s':_0x284252(0x188),'t':'valve_position'},{'s':_0x284252(0x188),'t':'level'}]);for(const _0x131cd7 of _0x96f81d){if(_0x2f57b7[_0x284252(0x153)](_0x131cd7['s'])){const _0x43a25f=_0x2f57b7['replace'](_0x131cd7['s'],_0x131cd7['t']),_0x3fc987=await _0x146337[_0x284252(0x175)](_0x43a25f);if(_0x3fc987)return _0x43a25f;}}try{const _0x3e7f6d=_0x2f57b7[_0x284252(0x179)]('.');if(_0x3e7f6d[_0x284252(0x100)]>0x2){const _0x50c988=_0x3e7f6d[_0x284252(0x16b)](0x0,-0x1)[_0x284252(0x113)]('.'),_0x3fb79f=await _0x146337[_0x284252(0x111)](_0x50c988+'.*'),_0x2d2054=[],_0x33c153=_0x2f57b7[_0x284252(0x179)](/[._]+/)[_0x284252(0x180)](_0x4d2be5=>![_0x284252(0x184),'0',_0x284252(0x143),_0x284252(0x104),_0x284252(0x15d),_0x284252(0x188),_0x284252(0x141),'sensor',_0x284252(0x178),_0x284252(0x140)][_0x284252(0x153)](_0x4d2be5['toLowerCase']()));for(const [_0xa3e182,_0x37896a]of Object[_0x284252(0x136)](_0x3fb79f)){if(_0xa3e182===_0x2f57b7)continue;if(_0x37896a&&_0x37896a['common']){const _0x5049f4=_0xa3e182['toLowerCase'](),_0x9dac75=(_0x37896a[_0x284252(0x127)]['role']||'')['toLowerCase'](),_0x8a7ab2=(_0x37896a[_0x284252(0x127)]['unit']||'')[_0x284252(0x168)]();let _0x351c95=![];if(_0x1b80ec===_0x284252(0x14e)&&_0x37896a[_0x284252(0x127)][_0x284252(0x125)]===!![])_0x351c95=_0x5049f4[_0x284252(0x153)](_0x284252(0x198))||_0x5049f4[_0x284252(0x153)](_0x284252(0x19a))||_0x5049f4[_0x284252(0x153)](_0x284252(0x189))||_0x9dac75[_0x284252(0x153)](_0x284252(0x173))||_0x9dac75['includes']('thermostat.setpoint');else _0x1b80ec==='valve'&&(_0x351c95=_0x5049f4[_0x284252(0x153)](_0x284252(0x147))||_0x5049f4[_0x284252(0x153)]('valve')||_0x5049f4[_0x284252(0x153)](_0x284252(0x11c))||_0x5049f4['includes']('position')||_0x9dac75[_0x284252(0x153)](_0x284252(0x15e))||_0x9dac75[_0x284252(0x153)](_0x284252(0x165))||_0x8a7ab2[_0x284252(0x153)]('%'));if(_0x351c95){const _0x265f95=_0xa3e182['split'](/[._]+/)[_0x284252(0x154)](_0x3f22c0=>_0x3f22c0['toLowerCase']());let _0x3a9d10=0x0;_0x33c153[_0x284252(0x174)](_0x595bcf=>{const _0x11da05=_0x284252;if(_0x265f95['includes'](_0x595bcf[_0x11da05(0x168)]()))_0x3a9d10++;}),_0x2d2054[_0x284252(0x17a)]({'id':_0xa3e182,'score':_0x3a9d10});}}}if(_0x2d2054[_0x284252(0x100)]>0x0){_0x2d2054[_0x284252(0x13b)]((_0x74b4f2,_0x21d55c)=>_0x21d55c[_0x284252(0x197)]-_0x74b4f2[_0x284252(0x197)]);if(_0x2d2054[0x0][_0x284252(0x197)]>0x0)return _0x2d2054[0x0]['id'];}}}catch(_0x1fbab1){}return null;}async function scanThermostats(_0x464f23){const _0x355313=a1_0x314819,_0x378a7e=_0x464f23[_0x355313(0x10e)][_0x355313(0x130)]||[],_0x5a9e52=[],_0x50d5c2=_0x378a7e['filter'](_0x1ab127=>_0x1ab127['id']&&_0x1ab127['id'][_0x355313(0x153)](_0x355313(0x188))||_0x1ab127[_0x355313(0x12d)]&&['temperature',_0x355313(0x16c),_0x355313(0x10c)]['includes'](_0x1ab127[_0x355313(0x12d)])||_0x1ab127[_0x355313(0x12e)]&&_0x1ab127[_0x355313(0x12e)][_0x355313(0x168)]()[_0x355313(0x153)](_0x355313(0x158)));for(const _0x525198 of _0x50d5c2){const _0x23064c=await findRelatedId(_0x464f23,_0x525198['id'],_0x355313(0x14e)),_0x1a168a=await findRelatedId(_0x464f23,_0x525198['id'],_0x355313(0x12b));let _0x44c29f=_0x355313(0x17c),_0x1790f0=![],_0x2b0cbb=_0x464f23[_0x355313(0x10e)][_0x355313(0x15b)]||{};if(typeof _0x2b0cbb==='string')try{_0x2b0cbb=JSON[_0x355313(0x15a)](_0x2b0cbb);}catch(_0x57f48f){}let _0x895949=_0x464f23[_0x355313(0x10e)][_0x355313(0x193)]||{};if(typeof _0x895949===_0x355313(0x16d))try{_0x895949=JSON['parse'](_0x895949);}catch(_0x9c455f){}if(_0x2b0cbb[_0x525198['id']]&&_0x2b0cbb[_0x525198['id']]===_0x23064c||_0x895949[_0x525198['id']]&&_0x895949[_0x525198['id']]===_0x1a168a)_0x44c29f=_0x355313(0x15c),_0x1790f0=!![];else(_0x23064c||_0x1a168a)&&(_0x44c29f=_0x355313(0x159));_0x5a9e52['push']({'room':_0x525198[_0x355313(0x13c)]||_0x355313(0x126),'sensorId':_0x525198['id'],'setpointId':_0x23064c||'-','valveId':_0x1a168a||'-','source':_0x44c29f,'isManual':_0x1790f0,'status':_0x23064c&&_0x1a168a?_0x355313(0x18c):_0x23064c?'OK':_0x355313(0x187)});}return _0x5a9e52[_0x355313(0x13b)]((_0x42ea66,_0x5adb59)=>_0x42ea66[_0x355313(0x18a)][_0x355313(0x103)](_0x5adb59['room']));}async function updateSchedulePreview(_0x38e9c9){const _0x101226=a1_0x314819;if(!_0x38e9c9[_0x101226(0x10e)][_0x101226(0x15f)]||!_0x38e9c9[_0x101226(0x10e)][_0x101226(0x106)])return;let _0x3b3158={};try{const _0x5a9047=await _0x38e9c9[_0x101226(0x108)]('analysis.energy.warmupTimes');if(_0x5a9047&&_0x5a9047['val'])_0x3b3158=JSON[_0x101226(0x15a)](_0x5a9047[_0x101226(0x14a)]);}catch(_0x5b1eee){}const _0x504006=[],_0x4a52c9=Date['now'](),_0x35c03c=0x30*0x3c*0x3c*0x3e8;try{const _0x547104=await _0x38e9c9[_0x101226(0x12a)](_0x38e9c9[_0x101226(0x10e)][_0x101226(0x106)]+_0x101226(0x151));if(!_0x547104||!_0x547104[_0x101226(0x14a)])return;const _0x14baa3=JSON[_0x101226(0x15a)](_0x547104[_0x101226(0x14a)]),_0x4d1327=_0x38e9c9[_0x101226(0x10e)][_0x101226(0x115)]||[],_0x3a964b=_0x38e9c9[_0x101226(0x10e)][_0x101226(0x130)]||[],_0x4f6ece=new Set();_0x3a964b[_0x101226(0x174)](_0x253142=>{const _0x3ec011=_0x101226;if(_0x253142[_0x3ec011(0x13c)])_0x4f6ece[_0x3ec011(0x11e)](_0x253142[_0x3ec011(0x13c)]);});for(const _0x54ec8d of _0x14baa3){if(_0x54ec8d['_calName']&&_0x4d1327[_0x101226(0x100)]>0x0&&!_0x4d1327['includes'](_0x54ec8d['_calName']))continue;const _0x9af81b=_0x54ec8d[_0x101226(0x171)]||_0x54ec8d[_0x101226(0x102)]||_0x54ec8d[_0x101226(0x120)];if(!_0x9af81b)continue;const _0x1ecbcc=new Date(_0x9af81b),_0x86d0a2=_0x1ecbcc[_0x101226(0x18d)]();if(isNaN(_0x86d0a2))continue;if(_0x86d0a2<_0x4a52c9)continue;if(_0x86d0a2>_0x4a52c9+_0x35c03c)continue;const _0x1ff5fe=(_0x54ec8d[_0x101226(0x114)]||_0x54ec8d['summary']||'')[_0x101226(0x168)]();let _0x5adc4d=![],_0xdb5c5=[],_0x4a4e2a=_0x54ec8d['event']||_0x54ec8d[_0x101226(0x123)]||_0x101226(0x126);if(_0x1ff5fe[_0x101226(0x153)](_0x101226(0x164))||_0x1ff5fe[_0x101226(0x153)]('rÃ¼ckkehr')||_0x1ff5fe['includes']('ankunft'))_0x5adc4d=!![],_0xdb5c5=Array['from'](_0x4f6ece);else for(const _0x1f7a27 of _0x4f6ece){if(_0x1ff5fe[_0x101226(0x153)](_0x1f7a27[_0x101226(0x168)]()))_0xdb5c5[_0x101226(0x17a)](_0x1f7a27);}_0xdb5c5[_0x101226(0x100)]>0x0&&_0xdb5c5[_0x101226(0x174)](_0x2e5a37=>{const _0x3850bd=_0x101226;let _0x775160=0x3c;if(_0x5adc4d){let _0xd381d9=0x0;Object[_0x3850bd(0x195)](_0x3b3158)[_0x3850bd(0x174)](_0x1a86db=>{if(_0x1a86db>_0xd381d9)_0xd381d9=_0x1a86db;}),_0x775160=_0xd381d9>0x0?_0xd381d9:0x78;}else _0x775160=_0x3b3158[_0x2e5a37]||0x3c;const _0x1fc915=new Date(_0x86d0a2-_0x775160*0xea60);_0x504006['push']({'eventTime':_0x86d0a2,'triggerTime':_0x1fc915['getTime'](),'room':_0x2e5a37,'minutes':_0x775160,'reason':_0x4a4e2a,'isGlobal':_0x5adc4d});});}}catch(_0x33b807){}_0x504006[_0x101226(0x13b)]((_0xb33559,_0x40e615)=>_0xb33559[_0x101226(0x18e)]-_0x40e615[_0x101226(0x18e)]);const _0x46a0a7=_0x504006['slice'](0x0,0x5);await _0x38e9c9[_0x101226(0x13e)](_0x101226(0x148),{'val':JSON['stringify'](_0x46a0a7),'ack':!![]});}async function checkCalendarTriggers(_0x3290aa){const _0x806b51=a1_0x314819;if(!_0x3290aa[_0x806b51(0x10e)][_0x806b51(0x15f)]||!_0x3290aa['config'][_0x806b51(0x106)])return;await updateSchedulePreview(_0x3290aa);let _0xb22de9={},_0xcf0caf={};try{const _0x43edda=await _0x3290aa[_0x806b51(0x108)](_0x806b51(0x129));if(_0x43edda&&_0x43edda[_0x806b51(0x14a)])_0xb22de9=JSON[_0x806b51(0x15a)](_0x43edda[_0x806b51(0x14a)]);const _0x41dac5=await _0x3290aa[_0x806b51(0x108)](_0x806b51(0x167));if(_0x41dac5&&_0x41dac5[_0x806b51(0x14a)])_0xcf0caf=JSON['parse'](_0x41dac5[_0x806b51(0x14a)]);}catch(_0x52a84a){}let _0x7a12cf={'default':0x15};try{const _0x4d84f6=await _0x3290aa[_0x806b51(0x108)]('analysis.energy.warmupTargets');if(_0x4d84f6&&_0x4d84f6[_0x806b51(0x14a)])_0x7a12cf=JSON['parse'](_0x4d84f6[_0x806b51(0x14a)]);}catch(_0x5ab706){}try{const _0x12463d=await _0x3290aa[_0x806b51(0x12a)](_0x3290aa[_0x806b51(0x10e)][_0x806b51(0x106)]+_0x806b51(0x151));if(!_0x12463d||!_0x12463d[_0x806b51(0x14a)])return;const _0x59469a=JSON['parse'](_0x12463d[_0x806b51(0x14a)]),_0xc3d994=Date[_0x806b51(0x150)](),_0x23cdd8=_0x3290aa[_0x806b51(0x10e)][_0x806b51(0x130)]||[],_0x583e9d=_0x3290aa['config'][_0x806b51(0x115)]||[];for(const _0xb91d1d of _0x59469a){if(_0xb91d1d['_calName']&&_0x583e9d['length']>0x0&&!_0x583e9d[_0x806b51(0x153)](_0xb91d1d[_0x806b51(0x13d)]))continue;const _0x48ef88=_0xb91d1d[_0x806b51(0x171)]||_0xb91d1d[_0x806b51(0x102)]||_0xb91d1d[_0x806b51(0x120)];if(!_0x48ef88)continue;const _0x2a097d=new Date(_0x48ef88);if(isNaN(_0x2a097d[_0x806b51(0x18d)]()))continue;const _0x2a4c69=(_0xb91d1d[_0x806b51(0x114)]||_0xb91d1d['summary']||'')[_0x806b51(0x168)]();if(_0x2a4c69['includes']('urlaub\x20ende')||_0x2a4c69[_0x806b51(0x153)](_0x806b51(0x18b))||_0x2a4c69['includes']('ankunft')){let _0x4bf44a=0x0;Object[_0x806b51(0x195)](_0xb22de9)[_0x806b51(0x174)](_0x1c1376=>{if(_0x1c1376>_0x4bf44a)_0x4bf44a=_0x1c1376;});if(_0x4bf44a===0x0)_0x4bf44a=0x78;const _0x2e2132=_0x2a097d[_0x806b51(0x18d)]()-_0x4bf44a*0xea60;_0xc3d994>=_0x2e2132&&_0xc3d994<_0x2a097d['getTime']()&&(_0x3290aa[_0x806b51(0x134)]!==_0x806b51(0x133)&&(_0x3290aa['log'][_0x806b51(0x13a)](_0x806b51(0x191)+_0x4bf44a+_0x806b51(0x101)),await _0x3290aa[_0x806b51(0x13e)](_0x806b51(0x105),{'val':_0x806b51(0x133),'ack':![]})));}for(const _0x7a27ab of _0x23cdd8){if(_0x7a27ab['location']){const _0x11cd73=_0x7a27ab['location'][_0x806b51(0x168)]();if(_0x2a4c69[_0x806b51(0x153)](_0x11cd73)){const _0x3c973e=_0xb22de9[_0x7a27ab['location']]||0x3c,_0x5a3b30=_0xcf0caf[_0x7a27ab['location']]||_0x806b51(0x16e),_0x38454e=_0x2a097d[_0x806b51(0x18d)]()-_0x3c973e*0xea60;if(_0xc3d994>=_0x38454e&&_0xc3d994<_0x2a097d[_0x806b51(0x18d)]()){const _0x39d86d=lastActions['cal_'+_0x7a27ab[_0x806b51(0x13c)]];if(_0x39d86d&&_0xc3d994-_0x39d86d<CAL_COOLDOWN_MS)continue;const _0x558596=await findRelatedId(_0x3290aa,_0x7a27ab['id'],_0x806b51(0x14e));if(_0x558596){let _0x503098=_0x7a12cf[_0x7a27ab[_0x806b51(0x13c)]];if(_0x503098===undefined)_0x503098=_0x7a12cf[_0x806b51(0x146)];if(_0x503098===undefined)_0x503098=0x15;const _0x578236=await _0x3290aa['getForeignStateAsync'](_0x558596);_0x578236&&typeof _0x578236[_0x806b51(0x14a)]===_0x806b51(0x135)&&_0x578236[_0x806b51(0x14a)]<_0x503098-0.5&&(_0x3290aa[_0x806b51(0x14f)]['info'](_0x806b51(0x145)+_0x5a3b30+']:\x20Raum-Trigger\x20\x27'+_0x7a27ab['location']+_0x806b51(0x157)+_0x503098+_0x806b51(0x183)+_0x3c973e+_0x806b51(0x101)),await _0x3290aa[_0x806b51(0x182)](_0x558596,_0x503098),await logAutomationAction(_0x3290aa,'[CAL]\x20'+_0x7a27ab[_0x806b51(0x13c)]+_0x806b51(0x166)+_0x503098+_0x806b51(0x117)+_0x5a3b30+')'),lastActions[_0x806b51(0x14b)+_0x7a27ab[_0x806b51(0x13c)]]=_0xc3d994);}}}}}}}catch(_0x2a354e){_0x3290aa[_0x806b51(0x14f)][_0x806b51(0x186)](_0x806b51(0x162)+_0x2a354e[_0x806b51(0x11f)]);}}async function manageMpcIntervention(_0x1c3be8,_0x29ee9a,_0x4058af){const _0xed84a3=a1_0x314819;try{const _0x5d3eaf=_0xed84a3(0x112),_0x53dcf6=await _0x1c3be8[_0xed84a3(0x108)](_0x5d3eaf);let _0x106a3c=[];if(_0x53dcf6&&_0x53dcf6[_0xed84a3(0x14a)])try{_0x106a3c=JSON[_0xed84a3(0x15a)](_0x53dcf6[_0xed84a3(0x14a)]);}catch(_0x103222){}const _0x29c8a8=_0x106a3c[_0xed84a3(0x10d)](_0x29ee9a);if(_0x4058af==='add')_0x29c8a8===-0x1&&(_0x106a3c['push'](_0x29ee9a),await _0x1c3be8['setStateAsync'](_0x5d3eaf,{'val':JSON['stringify'](_0x106a3c),'ack':!![]}));else _0x4058af==='remove'&&(_0x29c8a8!==-0x1&&(_0x106a3c[_0xed84a3(0x155)](_0x29c8a8,0x1),await _0x1c3be8['setStateAsync'](_0x5d3eaf,{'val':JSON[_0xed84a3(0x172)](_0x106a3c),'ack':!![]})));}catch(_0x2be3a6){}}async function applyEnergySavings(_0x5555fb,_0x905db5){const _0x1afc7b=a1_0x314819;if(!_0x905db5||_0x905db5[_0x1afc7b(0x100)]===0x0)return;const _0x20427f=_0x5555fb[_0x1afc7b(0x10e)][_0x1afc7b(0x130)]||[],_0xbc062=Date[_0x1afc7b(0x150)]();for(const _0x99d890 of _0x905db5){const _0x3eac10=_0x99d890[_0x1afc7b(0x18a)],_0x55eb12=_0x99d890[_0x1afc7b(0x116)],_0x561b18=_0x99d890['target']||0x15,_0x2502ba=_0x20427f[_0x1afc7b(0x109)](_0x41606e=>normalize(_0x41606e['location'])===normalize(_0x3eac10)&&(_0x41606e['type']===_0x1afc7b(0x188)||_0x41606e[_0x1afc7b(0x12d)]===_0x1afc7b(0x16c)));if(!_0x2502ba)continue;const _0x31ebed=await findRelatedId(_0x5555fb,_0x2502ba['id'],_0x1afc7b(0x14e));if(_0x31ebed){if(lastActions[_0x1afc7b(0x163)+_0x3eac10]&&_0xbc062-lastActions[_0x1afc7b(0x163)+_0x3eac10]<0x1e*0x3c*0x3e8)continue;const _0x56545c=await _0x5555fb[_0x1afc7b(0x12a)](_0x31ebed);if(_0x56545c&&typeof _0x56545c[_0x1afc7b(0x14a)]===_0x1afc7b(0x135)){const _0x47b384=_0x56545c['val'];_0x47b384!==ECO_TEMP&&await manageMpcIntervention(_0x5555fb,_0x3eac10,_0x1afc7b(0x17d));if(_0x55eb12>0x1e)_0x47b384>ECO_TEMP+0.5&&(_0x5555fb[_0x1afc7b(0x14f)][_0x1afc7b(0x13a)](_0x1afc7b(0x161)+_0x3eac10+'\x20auf\x20'+ECO_TEMP+_0x1afc7b(0x194)+_0x55eb12+_0x1afc7b(0x121)),await _0x5555fb[_0x1afc7b(0x182)](_0x31ebed,ECO_TEMP),await manageMpcIntervention(_0x5555fb,_0x3eac10,'add'),lastActions['mpc_'+_0x3eac10]=_0xbc062,await logAutomationAction(_0x5555fb,_0x1afc7b(0x192)+_0x3eac10+':\x20Absenkung\x20auf\x20'+ECO_TEMP+'Â°C'));else _0x55eb12<=0xf&&(_0x47b384<_0x561b18&&(_0x5555fb[_0x1afc7b(0x14f)][_0x1afc7b(0x13a)](_0x1afc7b(0x156)+_0x3eac10+_0x1afc7b(0x13f)+_0x561b18+_0x1afc7b(0x139)),await _0x5555fb['setForeignStateAsync'](_0x31ebed,_0x561b18),await manageMpcIntervention(_0x5555fb,_0x3eac10,_0x1afc7b(0x17d)),lastActions[_0x1afc7b(0x163)+_0x3eac10]=_0xbc062,await logAutomationAction(_0x5555fb,'[MPC]\x20'+_0x3eac10+':\x20Aufheizen\x20auf\x20'+_0x561b18+'Â°C')));}}else _0x5555fb[_0x1afc7b(0x14f)][_0x1afc7b(0x186)](_0x1afc7b(0x132)+_0x3eac10+_0x1afc7b(0x122));}}module[a1_0x314819(0x14c)]={'handlePrediction':handlePrediction,'applyEnergySavings':applyEnergySavings,'scanThermostats':scanThermostats,'checkCalendarTriggers':checkCalendarTriggers,'updateSchedulePreview':updateSchedulePreview};