function a1_0x4e8a(_0x291b10,_0x47bc56){const _0x5f3cff=a1_0x3cb6();return a1_0x4e8a=function(_0x214026,_0x385594){_0x214026=_0x214026-0xde;let _0x3cb625=_0x5f3cff[_0x214026];return _0x3cb625;},a1_0x4e8a(_0x291b10,_0x47bc56);}const a1_0x1707d7=a1_0x4e8a;(function(_0x410fcf,_0x4772c1){const _0xc8f482=a1_0x4e8a,_0x345351=_0x410fcf();while(!![]){try{const _0x518fba=-parseInt(_0xc8f482(0x117))/0x1*(parseInt(_0xc8f482(0x12d))/0x2)+-parseInt(_0xc8f482(0xe6))/0x3*(-parseInt(_0xc8f482(0x118))/0x4)+parseInt(_0xc8f482(0xeb))/0x5*(-parseInt(_0xc8f482(0x13a))/0x6)+parseInt(_0xc8f482(0x148))/0x7+-parseInt(_0xc8f482(0xf2))/0x8+parseInt(_0xc8f482(0xf0))/0x9*(parseInt(_0xc8f482(0x112))/0xa)+parseInt(_0xc8f482(0xe3))/0xb;if(_0x518fba===_0x4772c1)break;else _0x345351['push'](_0x345351['shift']());}catch(_0x5dd03b){_0x345351['push'](_0x345351['shift']());}}}(a1_0x3cb6,0x4cd0c));const a1_0x385594=(function(){let _0xfcdb4=!![];return function(_0x1c1099,_0x5b93ee){const _0x4d7767=_0xfcdb4?function(){const _0x54a132=a1_0x4e8a;if(_0x5b93ee){const _0x438ff9=_0x5b93ee[_0x54a132(0xdf)](_0x1c1099,arguments);return _0x5b93ee=null,_0x438ff9;}}:function(){};return _0xfcdb4=![],_0x4d7767;};}()),a1_0x214026=a1_0x385594(this,function(){const _0x5502d7=a1_0x4e8a;return a1_0x214026[_0x5502d7(0x13e)]()[_0x5502d7(0xe0)](_0x5502d7(0x16a))[_0x5502d7(0x13e)]()[_0x5502d7(0x166)](a1_0x214026)[_0x5502d7(0xe0)](_0x5502d7(0x16a));});a1_0x214026();'use strict';const aiAgent=require(a1_0x1707d7(0x11a)),COOLDOWN_MS=0x3c*0x3e8,ECO_TEMP=0x11,lastActions={};function a1_0x3cb6(){const _0x7e4590=['mpc_','\x27\x20erkannt\x20(','off','Unbekannt','wert','.1.ACTUAL_TEMPERATURE','.1.SET_POINT_TEMPERATURE','filter','.1.LEVEL','pi_heating_demand','ACTUAL','thermostat','config','room','ðŸ“…\x20SMART\x20SCHEDULE:\x20Raum-Trigger\x20\x27','Ist','.4.SET_TEMPERATURE','parse','Â°C!\x20(Aktuell:\x20','getForeignStateAsync','Soll','[MPC]\x20','analysis.energy.warmupTimes','constructor','.1.TEMPERATURE','slice','[MPC\x20WARNING]\x20Kein\x20Setpoint\x20(Soll-Temp)\x20fÃ¼r\x20','(((.+)+)+)+$','Â°C!\x20(Puffer\x20leer).\x20->\x20ID:\x20','rÃ¼ckkehr','log','.4.VALVE_STATE','debug','ðŸƒ\x20[MPC\x20ACTION]\x20Senke\x20','apply','search',':\x20Absenkung\x20auf\x20','analysis.energy.schedulePreview','1438305LNyznP',').\x20Heize\x20ganzes\x20Haus\x20auf\x20(Vorlauf:\x20','localeCompare','48CheioJ','eventStart','openknx','\x20gefunden!\x20Bitte\x20\x27System\x27\x20Tab\x20prÃ¼fen.','join','1980455MYqOwa','add','local_temperature','actual','role','43443Anmgww','analysis.automation.mode','1328896SoyMRm','thermostat.setpoint','now','target_temperature','sort','length','Schedule\x20Preview\x20Error:\x20','PERFECT','split','info','Â°C,\x20Puffer:\x20','light','soll','stellwert','state','urlaub\x20ende','devices','position','\x20min)\x20->\x20ID:\x20','setStateAsync','getStateAsync','setForeignStateAsync','calendarInstance','\x20auf\x20','type','includes','\x20->\x2021Â°C','ðŸ”\x20Device-Search\x20failed\x20for\x20predicted\x20room\x20\x27','ist','from','dimmer','summary','180eJcqtG','setpoint','values','entries','level','67807aauppI','102832tmRqtK','exports','./ai_agent','write','trim','useCalendar','SET_POINT_TEMPERATURE','\x20->\x20Schalte\x20','triggerTime','thermostatMapping','normal','current_heating_setpoint','valveMapping','SET','\x20wieder\x20auf\x20','temp','event','getTime',').\x20Heize\x20auf\x2021Â°C\x20(Vorlauf:\x20','calendarSelection','ankunft','2gCiqMq','Manuelles\x20Mapping','.data.table','Calendar\x20Check\x20Error:\x20','ðŸ”¥\x20[MPC\x20ACTION]\x20Heize\x20','_calName','messwert','string','set','sensor','common','ACTUAL_TEMPERATURE','push','6QDlSBf','toLowerCase','warn','val','toString','valve',':\x20Aufheizen\x20auf\x20','switch','find','location','replace','value.valve','unit','temperature','2209739wNyIuh','getForeignObjectsAsync','Fehlt','score','forEach','name','analysis.automation.lastAction'];a1_0x3cb6=function(){return _0x7e4590;};return a1_0x3cb6();}function normalize(_0x5d23f5){const _0x1d6594=a1_0x1707d7;if(!_0x5d23f5)return'';return _0x5d23f5['toLowerCase']()[_0x1d6594(0x144)](/\s+/g,'')[_0x1d6594(0x11c)]();}async function handlePrediction(_0x495956,_0x397fe2,_0x5ada9c){const _0x9f768d=a1_0x1707d7;if(!_0x397fe2||_0x397fe2==='Unknown')return;let _0x4a1014=_0x9f768d(0x151),_0xe26aff=0.6;try{const _0x31db6d=await _0x495956[_0x9f768d(0x106)](_0x9f768d(0xf1));if(_0x31db6d&&_0x31db6d[_0x9f768d(0x13d)])_0x4a1014=_0x31db6d[_0x9f768d(0x13d)];const _0x4c2ade=await _0x495956[_0x9f768d(0x106)]('analysis.automation.confidenceThreshold');if(_0x4c2ade&&_0x4c2ade[_0x9f768d(0x13d)])_0xe26aff=_0x4c2ade[_0x9f768d(0x13d)];}catch(_0x2f082b){}if(_0x4a1014===_0x9f768d(0x151)||_0x5ada9c<_0xe26aff)return;const _0x13ac07=Date[_0x9f768d(0xf4)]();if(lastActions[_0x397fe2]&&_0x13ac07-lastActions[_0x397fe2]<COOLDOWN_MS)return;const _0x1cc52d=_0x495956[_0x9f768d(0x15b)]['devices']||[],_0x388c77=normalize(_0x397fe2),_0x41fc0c=_0x1cc52d['find'](_0x352978=>normalize(_0x352978[_0x9f768d(0x143)])===_0x388c77&&(_0x352978[_0x9f768d(0x10a)]===_0x9f768d(0xfd)||_0x352978[_0x9f768d(0x10a)]===_0x9f768d(0x110)||_0x352978['type']===_0x9f768d(0x141)));if(!_0x41fc0c){_0x495956[_0x9f768d(0x16d)][_0x9f768d(0x16f)](_0x9f768d(0x10d)+_0x397fe2+'\x27.');return;}const _0x236d52=await aiAgent['consultButler'](_0x495956,_0x397fe2,_0x41fc0c[_0x9f768d(0x14d)],_0x5ada9c);if(!_0x236d52['approved'])return;const _0x1f09f6='PrÃ¤diktion:\x20'+_0x397fe2+_0x9f768d(0x11f)+_0x41fc0c['name']+'\x20('+_0x236d52['reason']+')';await _0x495956[_0x9f768d(0x105)](_0x9f768d(0x14e),{'val':'['+_0x4a1014['toUpperCase']()+']\x20'+_0x1f09f6,'ack':!![]});if(_0x4a1014==='active'){const _0x3507c9=await _0x495956[_0x9f768d(0x162)](_0x41fc0c['id']);(!_0x3507c9||!_0x3507c9[_0x9f768d(0x13d)]&&_0x3507c9[_0x9f768d(0x13d)]!==!![])&&await _0x495956[_0x9f768d(0x107)](_0x41fc0c['id'],!![]),lastActions[_0x397fe2]=_0x13ac07;}}async function findRelatedId(_0x1fd6d2,_0x29b9d2,_0x14487c=a1_0x1707d7(0x113)){const _0x5a30a4=a1_0x1707d7;if(_0x14487c===_0x5a30a4(0x113)&&_0x1fd6d2['config'][_0x5a30a4(0x121)]){let _0x4a5aac=_0x1fd6d2['config'][_0x5a30a4(0x121)];if(typeof _0x4a5aac===_0x5a30a4(0x134))try{_0x4a5aac=JSON[_0x5a30a4(0x160)](_0x4a5aac);}catch(_0x530ba6){}if(_0x4a5aac&&_0x4a5aac[_0x29b9d2])return _0x4a5aac[_0x29b9d2];}if(_0x14487c==='valve'&&_0x1fd6d2[_0x5a30a4(0x15b)]['valveMapping']){let _0x43b597=_0x1fd6d2['config'][_0x5a30a4(0x124)];if(typeof _0x43b597==='string')try{_0x43b597=JSON[_0x5a30a4(0x160)](_0x43b597);}catch(_0x650723){}if(_0x43b597&&_0x43b597[_0x29b9d2])return _0x43b597[_0x29b9d2];}let _0x7a96ad=[];if(_0x14487c===_0x5a30a4(0x113))_0x7a96ad=[{'s':_0x5a30a4(0x154),'t':_0x5a30a4(0x155)},{'s':_0x5a30a4(0x167),'t':_0x5a30a4(0x155)},{'s':_0x5a30a4(0x167),'t':_0x5a30a4(0x15f)},{'s':_0x5a30a4(0x138),'t':_0x5a30a4(0x11e)},{'s':_0x5a30a4(0xed),'t':'occupied_heating_setpoint'},{'s':_0x5a30a4(0xed),'t':_0x5a30a4(0x123)},{'s':_0x5a30a4(0x147),'t':_0x5a30a4(0xf5)},{'s':_0x5a30a4(0x159),'t':_0x5a30a4(0x125)},{'s':_0x5a30a4(0x15e),'t':_0x5a30a4(0x163)},{'s':_0x5a30a4(0x147),'t':_0x5a30a4(0x113)}];else _0x14487c===_0x5a30a4(0x13f)&&(_0x7a96ad=[{'s':_0x5a30a4(0x154),'t':_0x5a30a4(0x157)},{'s':_0x5a30a4(0x167),'t':_0x5a30a4(0x157)},{'s':'.1.TEMPERATURE','t':_0x5a30a4(0x16e)},{'s':_0x5a30a4(0xed),'t':_0x5a30a4(0x158)},{'s':_0x5a30a4(0x147),'t':'valve_position'},{'s':_0x5a30a4(0x147),'t':_0x5a30a4(0x116)}]);for(const _0x3a1f51 of _0x7a96ad){if(_0x29b9d2[_0x5a30a4(0x10b)](_0x3a1f51['s'])){const _0x263ab2=_0x29b9d2[_0x5a30a4(0x144)](_0x3a1f51['s'],_0x3a1f51['t']),_0x2bf4ec=await _0x1fd6d2['getForeignObjectAsync'](_0x263ab2);if(_0x2bf4ec)return _0x263ab2;}}try{const _0x2bcb4f=_0x29b9d2[_0x5a30a4(0xfa)]('.');if(_0x2bcb4f['length']>0x2){const _0xefe10b=_0x2bcb4f[_0x5a30a4(0x168)](0x0,-0x1)[_0x5a30a4(0xea)]('.'),_0x3d078e=await _0x1fd6d2[_0x5a30a4(0x149)](_0xefe10b+'.*'),_0x27e5e9=[],_0x3a4f49=_0x29b9d2[_0x5a30a4(0xfa)](/[._]+/)[_0x5a30a4(0x156)](_0x232249=>![_0x5a30a4(0xe8),'0','hm-rpc',_0x5a30a4(0x10e),_0x5a30a4(0x153),_0x5a30a4(0x147),_0x5a30a4(0xee),_0x5a30a4(0x136),_0x5a30a4(0x133),_0x5a30a4(0x100)][_0x5a30a4(0x10b)](_0x232249[_0x5a30a4(0x13b)]()));for(const [_0x22f9cf,_0x170688]of Object[_0x5a30a4(0x115)](_0x3d078e)){if(_0x22f9cf===_0x29b9d2)continue;if(_0x170688&&_0x170688[_0x5a30a4(0x137)]){const _0x41fd70=_0x22f9cf[_0x5a30a4(0x13b)](),_0x20f9c5=(_0x170688['common'][_0x5a30a4(0xef)]||'')['toLowerCase'](),_0x5d5bb5=(_0x170688[_0x5a30a4(0x137)][_0x5a30a4(0x146)]||'')[_0x5a30a4(0x13b)]();let _0x42bf48=![];if(_0x14487c===_0x5a30a4(0x113)&&_0x170688['common'][_0x5a30a4(0x11b)]===!![])_0x42bf48=_0x41fd70[_0x5a30a4(0x10b)](_0x5a30a4(0x135))||_0x41fd70['includes'](_0x5a30a4(0xfe))||_0x41fd70[_0x5a30a4(0x10b)]('target')||_0x20f9c5['includes']('level.temperature')||_0x20f9c5[_0x5a30a4(0x10b)](_0x5a30a4(0xf3));else _0x14487c===_0x5a30a4(0x13f)&&(_0x42bf48=_0x41fd70[_0x5a30a4(0x10b)](_0x5a30a4(0x116))||_0x41fd70['includes'](_0x5a30a4(0x13f))||_0x41fd70['includes'](_0x5a30a4(0xff))||_0x41fd70[_0x5a30a4(0x10b)](_0x5a30a4(0x103))||_0x20f9c5[_0x5a30a4(0x10b)]('level.valve')||_0x20f9c5[_0x5a30a4(0x10b)](_0x5a30a4(0x145))||_0x5d5bb5[_0x5a30a4(0x10b)]('%'));if(_0x42bf48){const _0x4dc306=_0x22f9cf[_0x5a30a4(0xfa)](/[._]+/)['map'](_0xadbe88=>_0xadbe88[_0x5a30a4(0x13b)]());let _0x4311bf=0x0;_0x3a4f49[_0x5a30a4(0x14c)](_0x15f82c=>{const _0x10a7ca=_0x5a30a4;if(_0x4dc306[_0x10a7ca(0x10b)](_0x15f82c[_0x10a7ca(0x13b)]()))_0x4311bf++;}),_0x27e5e9['push']({'id':_0x22f9cf,'score':_0x4311bf});}}}if(_0x27e5e9[_0x5a30a4(0xf7)]>0x0){_0x27e5e9[_0x5a30a4(0xf6)]((_0x2abbea,_0x29e398)=>_0x29e398[_0x5a30a4(0x14b)]-_0x2abbea[_0x5a30a4(0x14b)]);if(_0x27e5e9[0x0]['score']>0x0)return _0x27e5e9[0x0]['id'];}}}catch(_0x267192){}return null;}async function scanThermostats(_0x5d1501){const _0x5b22fd=a1_0x1707d7,_0x39d390=_0x5d1501['config']['devices']||[],_0x36be98=[],_0x79e173=_0x39d390[_0x5b22fd(0x156)](_0x493a70=>_0x493a70['id']&&_0x493a70['id'][_0x5b22fd(0x10b)]('temperature')||_0x493a70['type']&&['temperature',_0x5b22fd(0x15a),_0x5b22fd(0x136)]['includes'](_0x493a70[_0x5b22fd(0x10a)])||_0x493a70[_0x5b22fd(0x14d)]&&_0x493a70['name'][_0x5b22fd(0x13b)]()[_0x5b22fd(0x10b)](_0x5b22fd(0x127)));for(const _0x3020a0 of _0x79e173){const _0xce367e=await findRelatedId(_0x5d1501,_0x3020a0['id'],_0x5b22fd(0x113)),_0x1dfb00=await findRelatedId(_0x5d1501,_0x3020a0['id'],'valve');let _0x381edf='Nicht\x20gefunden',_0x5e95ad=![],_0x1f7b34=_0x5d1501['config'][_0x5b22fd(0x121)]||{};if(typeof _0x1f7b34===_0x5b22fd(0x134))try{_0x1f7b34=JSON[_0x5b22fd(0x160)](_0x1f7b34);}catch(_0x1e17d2){}let _0x536643=_0x5d1501['config']['valveMapping']||{};if(typeof _0x536643==='string')try{_0x536643=JSON[_0x5b22fd(0x160)](_0x536643);}catch(_0x4b3c34){}if(_0x1f7b34[_0x3020a0['id']]&&_0x1f7b34[_0x3020a0['id']]===_0xce367e||_0x536643[_0x3020a0['id']]&&_0x536643[_0x3020a0['id']]===_0x1dfb00)_0x381edf=_0x5b22fd(0x12e),_0x5e95ad=!![];else(_0xce367e||_0x1dfb00)&&(_0x381edf='Auto-Erkennung');_0x36be98[_0x5b22fd(0x139)]({'room':_0x3020a0['location']||_0x5b22fd(0x152),'sensorId':_0x3020a0['id'],'setpointId':_0xce367e||'-','valveId':_0x1dfb00||'-','source':_0x381edf,'isManual':_0x5e95ad,'status':_0xce367e&&_0x1dfb00?_0x5b22fd(0xf9):_0xce367e?'OK':_0x5b22fd(0x14a)});}return _0x36be98[_0x5b22fd(0xf6)]((_0x2a23b4,_0xce2187)=>_0x2a23b4[_0x5b22fd(0x15c)][_0x5b22fd(0xe5)](_0xce2187[_0x5b22fd(0x15c)]));}async function updateSchedulePreview(_0x3e92ab){const _0x536854=a1_0x1707d7;if(!_0x3e92ab[_0x536854(0x15b)][_0x536854(0x11d)]||!_0x3e92ab[_0x536854(0x15b)][_0x536854(0x108)])return;let _0x373825={};try{const _0x2a4784=await _0x3e92ab[_0x536854(0x106)]('analysis.energy.warmupTimes');if(_0x2a4784&&_0x2a4784[_0x536854(0x13d)])_0x373825=JSON[_0x536854(0x160)](_0x2a4784[_0x536854(0x13d)]);}catch(_0x317ff6){}const _0x36a9ce=[],_0xbc8545=Date[_0x536854(0xf4)](),_0x4d1563=0x30*0x3c*0x3c*0x3e8;try{const _0x523cbe=await _0x3e92ab[_0x536854(0x162)](_0x3e92ab[_0x536854(0x15b)]['calendarInstance']+_0x536854(0x12f));if(!_0x523cbe||!_0x523cbe[_0x536854(0x13d)])return;const _0x4aef5e=JSON[_0x536854(0x160)](_0x523cbe[_0x536854(0x13d)]),_0x19f432=_0x3e92ab[_0x536854(0x15b)][_0x536854(0x12b)]||[],_0xe97cd=_0x3e92ab['config'][_0x536854(0x102)]||[],_0x3e81ea=new Set();_0xe97cd[_0x536854(0x14c)](_0x16182f=>{const _0x421dc7=_0x536854;if(_0x16182f[_0x421dc7(0x143)])_0x3e81ea[_0x421dc7(0xec)](_0x16182f[_0x421dc7(0x143)]);});for(const _0x456886 of _0x4aef5e){if(_0x456886[_0x536854(0x132)]&&_0x19f432['length']>0x0&&!_0x19f432[_0x536854(0x10b)](_0x456886[_0x536854(0x132)]))continue;const _0x106eb5=new Date(_0x456886[_0x536854(0xe7)]),_0x1ab3cd=_0x106eb5[_0x536854(0x129)]();if(_0x1ab3cd<_0xbc8545)continue;if(_0x1ab3cd>_0xbc8545+_0x4d1563)continue;const _0x475193=(_0x456886['event']||_0x456886[_0x536854(0x111)]||'')[_0x536854(0x13b)]();let _0x5c7e01=![],_0x3e8118=[],_0x405a33=_0x456886[_0x536854(0x128)]||_0x456886[_0x536854(0x111)]||_0x536854(0x152);if(_0x475193['includes']('urlaub\x20ende')||_0x475193['includes']('rÃ¼ckkehr')||_0x475193[_0x536854(0x10b)](_0x536854(0x12c)))_0x5c7e01=!![],_0x3e8118=Array[_0x536854(0x10f)](_0x3e81ea);else for(const _0x2ce0ee of _0x3e81ea){_0x475193[_0x536854(0x10b)](_0x2ce0ee[_0x536854(0x13b)]())&&_0x3e8118[_0x536854(0x139)](_0x2ce0ee);}_0x3e8118['length']>0x0&&_0x3e8118[_0x536854(0x14c)](_0x220ae8=>{const _0x3edb29=_0x536854;let _0x4afcf6=0x3c;if(_0x5c7e01){let _0x129195=0x0;Object[_0x3edb29(0x114)](_0x373825)[_0x3edb29(0x14c)](_0x212cd7=>{if(_0x212cd7>_0x129195)_0x129195=_0x212cd7;}),_0x4afcf6=_0x129195>0x0?_0x129195:0x78;}else _0x4afcf6=_0x373825[_0x220ae8]||0x3c;const _0x157ab5=new Date(_0x1ab3cd-_0x4afcf6*0xea60);_0x36a9ce[_0x3edb29(0x139)]({'eventTime':_0x1ab3cd,'triggerTime':_0x157ab5[_0x3edb29(0x129)](),'room':_0x220ae8,'minutes':_0x4afcf6,'reason':_0x405a33,'isGlobal':_0x5c7e01});});}}catch(_0x3d8347){_0x3e92ab['log'][_0x536854(0x13c)](_0x536854(0xf8)+_0x3d8347['message']);}_0x36a9ce[_0x536854(0xf6)]((_0x448b1b,_0x2a096f)=>_0x448b1b[_0x536854(0x120)]-_0x2a096f[_0x536854(0x120)]);const _0x205938=_0x36a9ce[_0x536854(0x168)](0x0,0x5);await _0x3e92ab['setStateAsync'](_0x536854(0xe2),{'val':JSON['stringify'](_0x205938),'ack':!![]});}async function checkCalendarTriggers(_0x4f2768){const _0x3c0421=a1_0x1707d7;if(!_0x4f2768[_0x3c0421(0x15b)][_0x3c0421(0x11d)]||!_0x4f2768['config'][_0x3c0421(0x108)])return;await updateSchedulePreview(_0x4f2768);let _0x355bed={};try{const _0x23c448=await _0x4f2768[_0x3c0421(0x106)](_0x3c0421(0x165));if(_0x23c448&&_0x23c448[_0x3c0421(0x13d)])_0x355bed=JSON['parse'](_0x23c448['val']);}catch(_0x4f4803){}try{const _0x32c70e=await _0x4f2768[_0x3c0421(0x162)](_0x4f2768['config'][_0x3c0421(0x108)]+'.data.table');if(!_0x32c70e||!_0x32c70e['val'])return;const _0x43e4f7=JSON['parse'](_0x32c70e[_0x3c0421(0x13d)]),_0x3bcf66=new Date(),_0x11810a=_0x4f2768['config'][_0x3c0421(0x102)]||[],_0x23e8b2=_0x4f2768[_0x3c0421(0x15b)][_0x3c0421(0x12b)]||[];for(const _0x45ce80 of _0x43e4f7){if(_0x45ce80[_0x3c0421(0x132)]&&_0x23e8b2[_0x3c0421(0xf7)]>0x0&&!_0x23e8b2[_0x3c0421(0x10b)](_0x45ce80['_calName']))continue;const _0x2929e0=new Date(_0x45ce80[_0x3c0421(0xe7)]),_0x2f2b1b=(_0x45ce80[_0x3c0421(0x128)]||_0x45ce80['summary']||'')[_0x3c0421(0x13b)]();if(_0x2f2b1b[_0x3c0421(0x10b)](_0x3c0421(0x101))||_0x2f2b1b[_0x3c0421(0x10b)](_0x3c0421(0x16c))||_0x2f2b1b[_0x3c0421(0x10b)](_0x3c0421(0x12c))){let _0x479077=0x0;Object[_0x3c0421(0x114)](_0x355bed)[_0x3c0421(0x14c)](_0x4b491f=>{if(_0x4b491f>_0x479077)_0x479077=_0x4b491f;});if(_0x479077===0x0)_0x479077=0x78;const _0xb8a9f6=new Date(_0x2929e0[_0x3c0421(0x129)]()-_0x479077*0xea60),_0x595b0a=_0x3bcf66[_0x3c0421(0x129)]()-_0xb8a9f6[_0x3c0421(0x129)]();_0x595b0a>=0x0&&_0x595b0a<0xf*0xea60&&(_0x4f2768['log'][_0x3c0421(0xfb)]('ðŸ“…\x20SMART\x20SCHEDULE:\x20\x27Globaler\x20Start\x27\x20erkannt\x20('+_0x45ce80[_0x3c0421(0x128)]+_0x3c0421(0xe4)+_0x479077+'\x20min).'),await _0x4f2768[_0x3c0421(0x105)]('system.mode',{'val':_0x3c0421(0x122),'ack':![]}));}for(const _0x2e9c98 of _0x11810a){if(_0x2e9c98[_0x3c0421(0x143)]){const _0x4722d2=_0x2e9c98[_0x3c0421(0x143)]['toLowerCase']();if(_0x2f2b1b['includes'](_0x4722d2)){const _0x16e2fc=_0x355bed[_0x2e9c98['location']]||0x3c,_0x870963=new Date(_0x2929e0[_0x3c0421(0x129)]()-_0x16e2fc*0xea60),_0x17a9eb=_0x3bcf66[_0x3c0421(0x129)]()-_0x870963[_0x3c0421(0x129)]();if(_0x17a9eb>=0x0&&_0x17a9eb<0xf*0xea60){const _0x5209a3=await findRelatedId(_0x4f2768,_0x2e9c98['id'],'setpoint');_0x5209a3&&(_0x4f2768['log']['info'](_0x3c0421(0x15d)+_0x2e9c98['location']+_0x3c0421(0x150)+_0x45ce80[_0x3c0421(0x128)]+_0x3c0421(0x12a)+_0x16e2fc+'\x20min).'),await _0x4f2768[_0x3c0421(0x107)](_0x5209a3,0x15),await _0x4f2768['setStateAsync'](_0x3c0421(0x14e),{'val':'[CAL]\x20'+_0x2e9c98[_0x3c0421(0x143)]+_0x3c0421(0x10c),'ack':!![]}));}}}}}}catch(_0x3b2230){_0x4f2768['log'][_0x3c0421(0x13c)](_0x3c0421(0x130)+_0x3b2230['message']);}}async function applyEnergySavings(_0x2a78ff,_0x192182){const _0x2a5173=a1_0x1707d7;if(!_0x192182||_0x192182[_0x2a5173(0xf7)]===0x0)return;const _0x556eca=_0x2a78ff[_0x2a5173(0x15b)][_0x2a5173(0x102)]||[],_0x580bae=Date['now']();for(const _0x3513fe of _0x192182){const _0x33576f=_0x3513fe[_0x2a5173(0x15c)],_0x2e01ca=_0x3513fe['minutes_safe'],_0x311713=_0x3513fe['target']||0x15,_0x1a410b=_0x556eca[_0x2a5173(0x142)](_0x5af0c9=>normalize(_0x5af0c9[_0x2a5173(0x143)])===normalize(_0x33576f)&&(_0x5af0c9['type']==='temperature'||_0x5af0c9[_0x2a5173(0x10a)]===_0x2a5173(0x15a)));if(!_0x1a410b)continue;const _0x19dbe7=await findRelatedId(_0x2a78ff,_0x1a410b['id'],_0x2a5173(0x113));if(_0x19dbe7){if(lastActions[_0x2a5173(0x14f)+_0x33576f]&&_0x580bae-lastActions['mpc_'+_0x33576f]<0x1e*0x3c*0x3e8)continue;const _0x1a0157=await _0x2a78ff[_0x2a5173(0x162)](_0x19dbe7);if(_0x1a0157&&typeof _0x1a0157[_0x2a5173(0x13d)]==='number'){const _0x4b4847=_0x1a0157['val'];if(_0x2e01ca>0x1e)_0x4b4847>ECO_TEMP+0.5&&(_0x2a78ff['log'][_0x2a5173(0xfb)](_0x2a5173(0xde)+_0x33576f+_0x2a5173(0x109)+ECO_TEMP+_0x2a5173(0x161)+_0x4b4847+_0x2a5173(0xfc)+_0x2e01ca+_0x2a5173(0x104)+_0x19dbe7),await _0x2a78ff['setForeignStateAsync'](_0x19dbe7,ECO_TEMP),lastActions['mpc_'+_0x33576f]=_0x580bae,await _0x2a78ff[_0x2a5173(0x105)](_0x2a5173(0x14e),{'val':_0x2a5173(0x164)+_0x33576f+_0x2a5173(0xe1)+ECO_TEMP+'Â°C','ack':!![]}));else _0x2e01ca<=0xf&&(_0x4b4847<_0x311713&&(_0x2a78ff[_0x2a5173(0x16d)][_0x2a5173(0xfb)](_0x2a5173(0x131)+_0x33576f+_0x2a5173(0x126)+_0x311713+_0x2a5173(0x16b)+_0x19dbe7),await _0x2a78ff['setForeignStateAsync'](_0x19dbe7,_0x311713),lastActions[_0x2a5173(0x14f)+_0x33576f]=_0x580bae,await _0x2a78ff[_0x2a5173(0x105)](_0x2a5173(0x14e),{'val':'[MPC]\x20'+_0x33576f+_0x2a5173(0x140)+_0x311713+'Â°C','ack':!![]})));}}else _0x2a78ff['log'][_0x2a5173(0x13c)](_0x2a5173(0x169)+_0x33576f+_0x2a5173(0xe9));}}module[a1_0x1707d7(0x119)]={'handlePrediction':handlePrediction,'applyEnergySavings':applyEnergySavings,'scanThermostats':scanThermostats,'checkCalendarTriggers':checkCalendarTriggers,'updateSchedulePreview':updateSchedulePreview};