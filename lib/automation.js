const a1_0x44cdc3=a1_0xcf46;(function(_0xa32714,_0x3915d9){const _0xae620c=a1_0xcf46,_0x6626a6=_0xa32714();while(!![]){try{const _0x1d288c=parseInt(_0xae620c(0x119))/0x1+-parseInt(_0xae620c(0x104))/0x2*(parseInt(_0xae620c(0xfe))/0x3)+parseInt(_0xae620c(0xac))/0x4+-parseInt(_0xae620c(0xcd))/0x5*(parseInt(_0xae620c(0xbc))/0x6)+-parseInt(_0xae620c(0x107))/0x7*(parseInt(_0xae620c(0x145))/0x8)+parseInt(_0xae620c(0x113))/0x9+parseInt(_0xae620c(0x101))/0xa*(parseInt(_0xae620c(0xf6))/0xb);if(_0x1d288c===_0x3915d9)break;else _0x6626a6['push'](_0x6626a6['shift']());}catch(_0xd3d2f6){_0x6626a6['push'](_0x6626a6['shift']());}}}(a1_0x54c6,0x57371));const a1_0x291684=(function(){let _0x53b6df=!![];return function(_0x56c00d,_0x4cd11f){const _0x1b81e6=_0x53b6df?function(){const _0x59e34b=a1_0xcf46;if(_0x4cd11f){const _0x3a07c2=_0x4cd11f[_0x59e34b(0x13b)](_0x56c00d,arguments);return _0x4cd11f=null,_0x3a07c2;}}:function(){};return _0x53b6df=![],_0x1b81e6;};}()),a1_0x17501a=a1_0x291684(this,function(){const _0x53490f=a1_0xcf46;return a1_0x17501a[_0x53490f(0x140)]()[_0x53490f(0xd2)](_0x53490f(0xd3))[_0x53490f(0x140)]()[_0x53490f(0xa5)](a1_0x17501a)[_0x53490f(0xd2)](_0x53490f(0xd3));});a1_0x17501a();'use strict';const aiAgent=require('./ai_agent'),COOLDOWN_MS=0x3c*0x3e8,CAL_COOLDOWN_MS=0x5a*0x3c*0x3e8,RESCUE_LOCK_MS=0x78*0x3c*0x3e8,ECO_TEMP=0x11,lastActions={};function normalize(_0x47f84b){const _0x45cafa=a1_0xcf46;if(!_0x47f84b)return'';return _0x47f84b['toLowerCase']()['replace'](/\s+/g,'')[_0x45cafa(0x100)]();}async function logAutomationAction(_0x127af9,_0x543c6b){const _0x57c8e6=a1_0xcf46;await _0x127af9[_0x57c8e6(0x11b)](_0x57c8e6(0xee),{'val':_0x543c6b,'ack':!![]});try{const _0x19c5b8=_0x57c8e6(0x123),_0x37b4c5=await _0x127af9[_0x57c8e6(0xf9)](_0x19c5b8);let _0x157268=[];if(_0x37b4c5&&_0x37b4c5['val'])try{_0x157268=JSON[_0x57c8e6(0x148)](_0x37b4c5['val']);}catch(_0x2642d3){}_0x157268[_0x57c8e6(0x10b)]({'ts':Date[_0x57c8e6(0x13e)](),'msg':_0x543c6b});if(_0x157268['length']>0x32)_0x157268=_0x157268[_0x57c8e6(0x9e)](0x0,0x32);await _0x127af9[_0x57c8e6(0x11b)](_0x19c5b8,{'val':JSON[_0x57c8e6(0x114)](_0x157268),'ack':!![]});}catch(_0x4be3fc){}}async function handlePrediction(_0x1694b7,_0x390641,_0x416115){const _0x50c07b=a1_0xcf46;if(!_0x390641||_0x390641==='Unknown')return;let _0x5e0cc2=_0x50c07b(0x14a),_0x698ef=0.6;try{const _0x286618=await _0x1694b7[_0x50c07b(0xf9)](_0x50c07b(0xc5));if(_0x286618&&_0x286618[_0x50c07b(0xb9)])_0x5e0cc2=_0x286618[_0x50c07b(0xb9)];const _0x45d397=await _0x1694b7[_0x50c07b(0xf9)](_0x50c07b(0x147));if(_0x45d397&&_0x45d397[_0x50c07b(0xb9)])_0x698ef=_0x45d397['val'];}catch(_0xea4f25){}if(_0x5e0cc2===_0x50c07b(0x14a)||_0x416115<_0x698ef)return;const _0x5bd240=Date[_0x50c07b(0x13e)]();if(lastActions[_0x390641]&&_0x5bd240-lastActions[_0x390641]<COOLDOWN_MS)return;const _0x4960b6=_0x1694b7[_0x50c07b(0xe7)][_0x50c07b(0xf3)]||[],_0x4d0b40=normalize(_0x390641),_0x1f8f08=_0x4960b6['find'](_0x1be7e2=>normalize(_0x1be7e2[_0x50c07b(0xb7)])===_0x4d0b40&&(_0x1be7e2['type']===_0x50c07b(0xf8)||_0x1be7e2[_0x50c07b(0x13c)]==='dimmer'||_0x1be7e2[_0x50c07b(0x13c)]===_0x50c07b(0xf7)));if(!_0x1f8f08)return;const _0x2438a9=await aiAgent['consultButler'](_0x1694b7,_0x390641,_0x1f8f08[_0x50c07b(0x11e)],_0x416115);if(!_0x2438a9['approved'])return;const _0xe15bf4=_0x50c07b(0x108)+_0x390641+_0x50c07b(0x118)+_0x1f8f08['name']+'\x20('+_0x2438a9['reason']+')';await logAutomationAction(_0x1694b7,'['+_0x5e0cc2[_0x50c07b(0x120)]()+']\x20'+_0xe15bf4);if(_0x5e0cc2===_0x50c07b(0xbf)){const _0x22855a=await _0x1694b7[_0x50c07b(0xe6)](_0x1f8f08['id']);(!_0x22855a||!_0x22855a[_0x50c07b(0xb9)]&&_0x22855a[_0x50c07b(0xb9)]!==!![])&&await _0x1694b7[_0x50c07b(0x10e)](_0x1f8f08['id'],!![]),lastActions[_0x390641]=_0x5bd240;}}function a1_0x54c6(){const _0x45981d=['cal_','name','analysis.energy.schedulePreview','toUpperCase','level.temperature','actual','analysis.automation.actionLog','ðŸƒ\x20[MPC\x20ACTION]\x20Senke\x20','default',':\x20Aufheizen\x20auf\x20','\x20->\x20','current_heating_setpoint','\x20ist\x20zu\x20kalt,\x20ABER\x20Fenster\x20offen/LÃ¼ftung\x20erkannt.\x20Heize\x20NICHT,\x20entferne\x20nur\x20Status.','push','calendarInstance','getForeignObjectAsync','contact','map','analysis.energy.warmupTimes','sensor','Ist','add','set','Calendar\x20Check\x20Error:\x20','thermostat.setpoint','isArray','splice','wert','[MPC\x20WARNING]\x20Kein\x20Setpoint\x20fÃ¼r\x20','find','apply','type','Classic','now','message','toString','\x27\x20aktiv.\x20Heize\x20auf\x20','messwert','occupied_heating_setpoint','Â°C).\x20Sparmodus\x20beendet!','40wxsOeJ','level','analysis.automation.confidenceThreshold','parse','room','off','[WATCHDOG]\x20','score','info','useCalendar','value.valve','Â°C\x20(via\x20','Â°C\x20<\x20','slice','_calName','localeCompare','includes','Unbekannt','ðŸŽ“\x20[RL-FEEDBACK]\x20Lerne\x20aus\x20Fehler:\x20','values','constructor','entries','\x20wurde\x20manuell\x20erhÃ¶ht.','length','rÃ¼ckkehr','minutes_safe','_date','81720VaxtUC','TRAIN_RL_PENALTY','ðŸŒ¬ï¸\x20[MPC\x20WATCHDOG]\x20','target','exports','event','ðŸ§¹\x20[MPC\x20CLEANUP]\x20Raum\x20\x27','indexOf','normal','ist','ðŸš¨\x20[MPC\x20WATCHDOG]\x20','location','position','val','common',']:\x20Raum-Trigger\x20\x27','6ZRPeZS','summary','analysis.energy.warmupTargets','active','pi_heating_demand','ðŸ§¹\x20[MPC\x20CLEANUP]\x20','temperature','system.mode','\x20auf\x20','analysis.automation.mode','hm-rpc','.1.LEVEL','thermostat','toLowerCase','number','warn','Auto-Erkennung','1523215hslCTK','remove','write','date','valve','search','(((.+)+)+)+$','\x20ist\x20auf\x20','Â°C\x20(Vorlauf:\x20','\x20durch\x20Kalender\x20geÃ¤ndert.\x20Keine\x20RL-Strafe.','abs','triggerTime','Soll','.1.SET_POINT_TEMPERATURE','sort','urlaub\x20ende','from','Manuelles\x20Mapping','soll','ankunft','analysis.energy.mpcActiveInterventions','Â°C).\x20Entferne\x20Status.','.1.TEMPERATURE','thermostatMapping','setpoint','getForeignStateAsync','config','too_cold','state','manual','unit',':\x20Puffer\x20leer\x20->\x20Heizen\x20auf\x20','openknx','analysis.automation.lastAction','Nicht\x20gefunden','calendarSelection','target_temperature','sendToPythonWrapper','devices','forEach','mpc_','11HuVjcB','switch','light','getStateAsync','local_temperature','filter','PERFECT','[CAL]\x20','6BgjsrE','\x20min).','trim','3971390XxFXFv','Fehlt','.data.table','185846HnlXUp','replace','role','256151TnfZHY','PrÃ¤diktion:\x20','ðŸ”¥\x20[MPC\x20ACTION]\x20Heize\x20','valveMapping','unshift','level.valve','[MPC]\x20','setForeignStateAsync','ðŸ“…\x20SMART\x20SCHEDULE\x20[','ACTUAL_TEMPERATURE','rescue_','getTime','4740822oRTxvY','stringify','string','log','.4.SET_TEMPERATURE','\x20->\x20Schalte\x20','86360jatBhW','window','setStateAsync','split'];a1_0x54c6=function(){return _0x45981d;};return a1_0x54c6();}function a1_0xcf46(_0x421e7e,_0x99d611){const _0x556905=a1_0x54c6();return a1_0xcf46=function(_0x17501a,_0x291684){_0x17501a=_0x17501a-0x9a;let _0x54c6ba=_0x556905[_0x17501a];return _0x54c6ba;},a1_0xcf46(_0x421e7e,_0x99d611);}async function findRelatedId(_0x3640fc,_0xcbf833,_0x2bfbf3=a1_0x44cdc3(0xe5)){const _0x9eef6c=a1_0x44cdc3;if(_0x2bfbf3==='setpoint'&&_0x3640fc[_0x9eef6c(0xe7)][_0x9eef6c(0xe4)]){let _0x5e9d9d=_0x3640fc[_0x9eef6c(0xe7)][_0x9eef6c(0xe4)];if(typeof _0x5e9d9d==='string')try{_0x5e9d9d=JSON['parse'](_0x5e9d9d);}catch(_0x169148){}if(_0x5e9d9d&&_0x5e9d9d[_0xcbf833])return _0x5e9d9d[_0xcbf833];}if(_0x2bfbf3==='valve'&&_0x3640fc[_0x9eef6c(0xe7)][_0x9eef6c(0x10a)]){let _0x47cec0=_0x3640fc['config'][_0x9eef6c(0x10a)];if(typeof _0x47cec0==='string')try{_0x47cec0=JSON[_0x9eef6c(0x148)](_0x47cec0);}catch(_0x108a93){}if(_0x47cec0&&_0x47cec0[_0xcbf833])return _0x47cec0[_0xcbf833];}let _0x140268=[];if(_0x2bfbf3===_0x9eef6c(0xe5))_0x140268=[{'s':'.1.ACTUAL_TEMPERATURE','t':_0x9eef6c(0xda)},{'s':'.1.TEMPERATURE','t':_0x9eef6c(0xda)},{'s':_0x9eef6c(0xe3),'t':_0x9eef6c(0x117)},{'s':_0x9eef6c(0x110),'t':'SET_POINT_TEMPERATURE'},{'s':_0x9eef6c(0xfa),'t':_0x9eef6c(0x143)},{'s':_0x9eef6c(0xfa),'t':_0x9eef6c(0x128)},{'s':_0x9eef6c(0xc2),'t':_0x9eef6c(0xf1)},{'s':'ACTUAL','t':'SET'},{'s':_0x9eef6c(0x131),'t':_0x9eef6c(0xd9)},{'s':_0x9eef6c(0xc2),'t':_0x9eef6c(0xe5)}];else _0x2bfbf3===_0x9eef6c(0xd1)&&(_0x140268=[{'s':'.1.ACTUAL_TEMPERATURE','t':_0x9eef6c(0xc7)},{'s':_0x9eef6c(0xe3),'t':_0x9eef6c(0xc7)},{'s':_0x9eef6c(0xe3),'t':'.4.VALVE_STATE'},{'s':_0x9eef6c(0xfa),'t':_0x9eef6c(0xc0)},{'s':_0x9eef6c(0xc2),'t':'valve_position'},{'s':_0x9eef6c(0xc2),'t':_0x9eef6c(0x146)}]);for(const _0x336331 of _0x140268){if(_0xcbf833['includes'](_0x336331['s'])){const _0x4aa035=_0xcbf833[_0x9eef6c(0x105)](_0x336331['s'],_0x336331['t']),_0x203372=await _0x3640fc[_0x9eef6c(0x12c)](_0x4aa035);if(_0x203372)return _0x4aa035;}}try{const _0x2e2746=_0xcbf833[_0x9eef6c(0x11c)]('.');if(_0x2e2746[_0x9eef6c(0xa8)]>0x2){const _0x44e56e=_0x2e2746['slice'](0x0,-0x1)['join']('.'),_0x18b770=await _0x3640fc['getForeignObjectsAsync'](_0x44e56e+'.*'),_0x2a9cb8=[],_0xe80282=_0xcbf833[_0x9eef6c(0x11c)](/[._]+/)[_0x9eef6c(0xfb)](_0xdb2582=>![_0x9eef6c(0xed),'0',_0x9eef6c(0xc6),_0x9eef6c(0xb5),_0x9eef6c(0x138),_0x9eef6c(0xc2),_0x9eef6c(0x122),_0x9eef6c(0x130),_0x9eef6c(0x142),_0x9eef6c(0xe9)][_0x9eef6c(0xa1)](_0xdb2582['toLowerCase']()));for(const [_0x16abde,_0x883555]of Object[_0x9eef6c(0xa6)](_0x18b770)){if(_0x16abde===_0xcbf833)continue;if(_0x883555&&_0x883555[_0x9eef6c(0xba)]){const _0x185797=_0x16abde[_0x9eef6c(0xc9)](),_0x19b94f=(_0x883555[_0x9eef6c(0xba)][_0x9eef6c(0x106)]||'')[_0x9eef6c(0xc9)](),_0x4d99e0=(_0x883555[_0x9eef6c(0xba)][_0x9eef6c(0xeb)]||'')[_0x9eef6c(0xc9)]();let _0x8ae4f3=![];if(_0x2bfbf3===_0x9eef6c(0xe5)&&_0x883555[_0x9eef6c(0xba)][_0x9eef6c(0xcf)]===!![])_0x8ae4f3=_0x185797['includes'](_0x9eef6c(0x133))||_0x185797[_0x9eef6c(0xa1)](_0x9eef6c(0xdf))||_0x185797[_0x9eef6c(0xa1)](_0x9eef6c(0xaf))||_0x19b94f['includes'](_0x9eef6c(0x121))||_0x19b94f['includes'](_0x9eef6c(0x135));else _0x2bfbf3===_0x9eef6c(0xd1)&&(_0x8ae4f3=_0x185797['includes']('level')||_0x185797[_0x9eef6c(0xa1)](_0x9eef6c(0xd1))||_0x185797[_0x9eef6c(0xa1)]('stellwert')||_0x185797[_0x9eef6c(0xa1)](_0x9eef6c(0xb8))||_0x19b94f['includes'](_0x9eef6c(0x10c))||_0x19b94f['includes'](_0x9eef6c(0x9b))||_0x4d99e0[_0x9eef6c(0xa1)]('%'));if(_0x8ae4f3){const _0x3c851b=_0x16abde[_0x9eef6c(0x11c)](/[._]+/)[_0x9eef6c(0x12e)](_0x3b6379=>_0x3b6379[_0x9eef6c(0xc9)]());let _0x396a6d=0x0;_0xe80282[_0x9eef6c(0xf4)](_0xa6091d=>{const _0x1fc6df=_0x9eef6c;if(_0x3c851b[_0x1fc6df(0xa1)](_0xa6091d[_0x1fc6df(0xc9)]()))_0x396a6d++;}),_0x2a9cb8[_0x9eef6c(0x12a)]({'id':_0x16abde,'score':_0x396a6d});}}}if(_0x2a9cb8['length']>0x0){_0x2a9cb8['sort']((_0x540888,_0x2d8698)=>_0x2d8698[_0x9eef6c(0x14c)]-_0x540888[_0x9eef6c(0x14c)]);if(_0x2a9cb8[0x0]['score']>0x0)return _0x2a9cb8[0x0]['id'];}}}catch(_0x2eb296){}return null;}async function scanThermostats(_0x2c03f0){const _0x38fe4d=a1_0x44cdc3,_0x1243f5=_0x2c03f0['config'][_0x38fe4d(0xf3)]||[],_0x38e7ce=[],_0x40de51=_0x1243f5['filter'](_0x572fbc=>_0x572fbc['id']&&_0x572fbc['id'][_0x38fe4d(0xa1)](_0x38fe4d(0xc2))||_0x572fbc[_0x38fe4d(0x13c)]&&[_0x38fe4d(0xc2),'thermostat','sensor'][_0x38fe4d(0xa1)](_0x572fbc[_0x38fe4d(0x13c)])||_0x572fbc['name']&&_0x572fbc[_0x38fe4d(0x11e)][_0x38fe4d(0xc9)]()[_0x38fe4d(0xa1)]('temp'));for(const _0x5d868b of _0x40de51){const _0x4c8441=await findRelatedId(_0x2c03f0,_0x5d868b['id'],_0x38fe4d(0xe5)),_0x3bc66b=await findRelatedId(_0x2c03f0,_0x5d868b['id'],'valve');let _0x4a50bf=_0x38fe4d(0xef),_0x27a71b=![],_0x268d12=_0x2c03f0[_0x38fe4d(0xe7)][_0x38fe4d(0xe4)]||{};if(typeof _0x268d12===_0x38fe4d(0x115))try{_0x268d12=JSON[_0x38fe4d(0x148)](_0x268d12);}catch(_0x24347b){}let _0x20e302=_0x2c03f0[_0x38fe4d(0xe7)][_0x38fe4d(0x10a)]||{};if(typeof _0x20e302===_0x38fe4d(0x115))try{_0x20e302=JSON[_0x38fe4d(0x148)](_0x20e302);}catch(_0x35e71f){}if(_0x268d12[_0x5d868b['id']]&&_0x268d12[_0x5d868b['id']]===_0x4c8441||_0x20e302[_0x5d868b['id']]&&_0x20e302[_0x5d868b['id']]===_0x3bc66b)_0x4a50bf=_0x38fe4d(0xde),_0x27a71b=!![];else(_0x4c8441||_0x3bc66b)&&(_0x4a50bf=_0x38fe4d(0xcc));_0x38e7ce['push']({'room':_0x5d868b[_0x38fe4d(0xb7)]||_0x38fe4d(0xa2),'sensorId':_0x5d868b['id'],'setpointId':_0x4c8441||'-','valveId':_0x3bc66b||'-','source':_0x4a50bf,'isManual':_0x27a71b,'status':_0x4c8441&&_0x3bc66b?_0x38fe4d(0xfc):_0x4c8441?'OK':_0x38fe4d(0x102)});}return _0x38e7ce[_0x38fe4d(0xdb)]((_0x568a36,_0x5cc609)=>_0x568a36['room'][_0x38fe4d(0xa0)](_0x5cc609[_0x38fe4d(0x149)]));}async function updateSchedulePreview(_0x19fe20){const _0x16f548=a1_0x44cdc3;if(!_0x19fe20[_0x16f548(0xe7)]['useCalendar']||!_0x19fe20[_0x16f548(0xe7)][_0x16f548(0x12b)])return;let _0x541044={};try{const _0x37db02=await _0x19fe20[_0x16f548(0xf9)]('analysis.energy.warmupTimes');if(_0x37db02&&_0x37db02['val'])_0x541044=JSON[_0x16f548(0x148)](_0x37db02['val']);}catch(_0x319ccc){}const _0x216410=[],_0x37aa6c=Date['now'](),_0x5cc362=0x30*0x3c*0x3c*0x3e8;try{const _0x16bb76=await _0x19fe20['getForeignStateAsync'](_0x19fe20[_0x16f548(0xe7)][_0x16f548(0x12b)]+_0x16f548(0x103));if(!_0x16bb76||!_0x16bb76[_0x16f548(0xb9)])return;const _0x265357=JSON[_0x16f548(0x148)](_0x16bb76[_0x16f548(0xb9)]),_0x1b95af=_0x19fe20[_0x16f548(0xe7)][_0x16f548(0xf0)]||[],_0x42d080=_0x19fe20['config'][_0x16f548(0xf3)]||[],_0x41efb5=new Set();_0x42d080['forEach'](_0x2ce198=>{const _0x48e5e9=_0x16f548;if(_0x2ce198[_0x48e5e9(0xb7)])_0x41efb5[_0x48e5e9(0x132)](_0x2ce198[_0x48e5e9(0xb7)]);});for(const _0x4bf48f of _0x265357){if(_0x4bf48f[_0x16f548(0x9f)]&&_0x1b95af[_0x16f548(0xa8)]>0x0&&!_0x1b95af[_0x16f548(0xa1)](_0x4bf48f['_calName']))continue;const _0x3da469=_0x4bf48f['_date']||_0x4bf48f['eventStart']||_0x4bf48f['date'];if(!_0x3da469)continue;const _0x5641f7=new Date(_0x3da469),_0x39a578=_0x5641f7[_0x16f548(0x112)]();if(isNaN(_0x39a578))continue;if(_0x39a578<_0x37aa6c)continue;if(_0x39a578>_0x37aa6c+_0x5cc362)continue;const _0x24a708=(_0x4bf48f[_0x16f548(0xb1)]||_0x4bf48f[_0x16f548(0xbd)]||'')[_0x16f548(0xc9)]();let _0x289466=![],_0x32b4de=[],_0x41aa75=_0x4bf48f['event']||_0x4bf48f['summary']||_0x16f548(0xa2);if(_0x24a708[_0x16f548(0xa1)](_0x16f548(0xdc))||_0x24a708[_0x16f548(0xa1)](_0x16f548(0xa9))||_0x24a708[_0x16f548(0xa1)](_0x16f548(0xe0)))_0x289466=!![],_0x32b4de=Array[_0x16f548(0xdd)](_0x41efb5);else for(const _0x23fbbe of _0x41efb5){if(_0x24a708[_0x16f548(0xa1)](_0x23fbbe[_0x16f548(0xc9)]()))_0x32b4de[_0x16f548(0x12a)](_0x23fbbe);}_0x32b4de['length']>0x0&&_0x32b4de[_0x16f548(0xf4)](_0x23a825=>{const _0x2999ff=_0x16f548;let _0x3884d6=0x3c;if(_0x289466){let _0x3e4d3a=0x0;Object[_0x2999ff(0xa4)](_0x541044)['forEach'](_0x4dcbf9=>{if(_0x4dcbf9>_0x3e4d3a)_0x3e4d3a=_0x4dcbf9;}),_0x3884d6=_0x3e4d3a>0x0?_0x3e4d3a:0x78;}else _0x3884d6=_0x541044[_0x23a825]||0x3c;const _0x5d1604=new Date(_0x39a578-_0x3884d6*0xea60);_0x216410[_0x2999ff(0x12a)]({'eventTime':_0x39a578,'triggerTime':_0x5d1604[_0x2999ff(0x112)](),'room':_0x23a825,'minutes':_0x3884d6,'reason':_0x41aa75,'isGlobal':_0x289466});});}}catch(_0x42060b){}_0x216410[_0x16f548(0xdb)]((_0x26b75a,_0x2902f8)=>_0x26b75a[_0x16f548(0xd8)]-_0x2902f8[_0x16f548(0xd8)]);const _0x17d993=_0x216410[_0x16f548(0x9e)](0x0,0x5);await _0x19fe20[_0x16f548(0x11b)](_0x16f548(0x11f),{'val':JSON[_0x16f548(0x114)](_0x17d993),'ack':!![]});}async function checkCalendarTriggers(_0x1c6797){const _0x8440e4=a1_0x44cdc3;if(!_0x1c6797['config'][_0x8440e4(0x9a)]||!_0x1c6797[_0x8440e4(0xe7)][_0x8440e4(0x12b)])return;await updateSchedulePreview(_0x1c6797);let _0x2281f2={},_0x8038a2={};try{const _0x17ff9e=await _0x1c6797[_0x8440e4(0xf9)](_0x8440e4(0x12f));if(_0x17ff9e&&_0x17ff9e['val'])_0x2281f2=JSON[_0x8440e4(0x148)](_0x17ff9e['val']);const _0x374d22=await _0x1c6797['getStateAsync']('analysis.energy.warmupSources');if(_0x374d22&&_0x374d22[_0x8440e4(0xb9)])_0x8038a2=JSON[_0x8440e4(0x148)](_0x374d22[_0x8440e4(0xb9)]);}catch(_0x1a17ff){}let _0x3c1ce2={'default':0x15};try{const _0x40d75e=await _0x1c6797[_0x8440e4(0xf9)](_0x8440e4(0xbe));if(_0x40d75e&&_0x40d75e[_0x8440e4(0xb9)])_0x3c1ce2=JSON[_0x8440e4(0x148)](_0x40d75e[_0x8440e4(0xb9)]);}catch(_0x5a157a){}try{const _0x3b9651=await _0x1c6797[_0x8440e4(0xe6)](_0x1c6797['config']['calendarInstance']+_0x8440e4(0x103));if(!_0x3b9651||!_0x3b9651[_0x8440e4(0xb9)])return;const _0x1798c4=JSON['parse'](_0x3b9651[_0x8440e4(0xb9)]),_0x4354f3=Date[_0x8440e4(0x13e)](),_0x4d1478=_0x1c6797[_0x8440e4(0xe7)][_0x8440e4(0xf3)]||[],_0x2bb2d3=_0x1c6797[_0x8440e4(0xe7)][_0x8440e4(0xf0)]||[];for(const _0x24ec3a of _0x1798c4){if(_0x24ec3a[_0x8440e4(0x9f)]&&_0x2bb2d3[_0x8440e4(0xa8)]>0x0&&!_0x2bb2d3['includes'](_0x24ec3a[_0x8440e4(0x9f)]))continue;const _0x25c115=_0x24ec3a[_0x8440e4(0xab)]||_0x24ec3a['eventStart']||_0x24ec3a[_0x8440e4(0xd0)];if(!_0x25c115)continue;const _0x187138=new Date(_0x25c115);if(isNaN(_0x187138['getTime']()))continue;const _0x24ce47=(_0x24ec3a[_0x8440e4(0xb1)]||_0x24ec3a[_0x8440e4(0xbd)]||'')[_0x8440e4(0xc9)]();if(_0x24ce47[_0x8440e4(0xa1)](_0x8440e4(0xdc))||_0x24ce47[_0x8440e4(0xa1)](_0x8440e4(0xa9))||_0x24ce47['includes'](_0x8440e4(0xe0))){let _0x486c5b=0x0;Object['values'](_0x2281f2)[_0x8440e4(0xf4)](_0x47e89d=>{if(_0x47e89d>_0x486c5b)_0x486c5b=_0x47e89d;});if(_0x486c5b===0x0)_0x486c5b=0x78;const _0x345196=_0x187138['getTime']()-_0x486c5b*0xea60;_0x4354f3>=_0x345196&&_0x4354f3<_0x187138[_0x8440e4(0x112)]()&&(_0x1c6797['currentSystemMode']!==_0x8440e4(0xb4)&&(_0x1c6797[_0x8440e4(0x116)][_0x8440e4(0x14d)]('ðŸ“…\x20SMART\x20SCHEDULE\x20(Phase):\x20\x27Globaler\x20Start\x27\x20erkannt.\x20Heize\x20Haus\x20auf\x20(Vorlauf:\x20'+_0x486c5b+_0x8440e4(0xff)),await _0x1c6797[_0x8440e4(0x11b)](_0x8440e4(0xc3),{'val':_0x8440e4(0xb4),'ack':![]})));}for(const _0x29dde2 of _0x4d1478){if(_0x29dde2['location']){const _0x39c067=_0x29dde2['location'][_0x8440e4(0xc9)]();if(_0x24ce47[_0x8440e4(0xa1)](_0x39c067)){const _0x116a7b=_0x2281f2[_0x29dde2[_0x8440e4(0xb7)]]||0x3c,_0x19e15c=_0x8038a2[_0x29dde2['location']]||_0x8440e4(0x13d),_0x5a4736=_0x187138['getTime']()-_0x116a7b*0xea60;if(_0x4354f3>=_0x5a4736&&_0x4354f3<_0x187138[_0x8440e4(0x112)]()){const _0x5446db=lastActions[_0x8440e4(0x11d)+_0x29dde2[_0x8440e4(0xb7)]];if(_0x5446db&&_0x4354f3-_0x5446db<CAL_COOLDOWN_MS)continue;const _0x54a545=await findRelatedId(_0x1c6797,_0x29dde2['id'],'setpoint');if(_0x54a545){let _0x44192c=_0x3c1ce2[_0x29dde2[_0x8440e4(0xb7)]];if(_0x44192c===undefined)_0x44192c=_0x3c1ce2[_0x8440e4(0x125)];if(_0x44192c===undefined)_0x44192c=0x15;const _0x3b1a32=await _0x1c6797[_0x8440e4(0xe6)](_0x54a545);_0x3b1a32&&typeof _0x3b1a32[_0x8440e4(0xb9)]===_0x8440e4(0xca)&&_0x3b1a32['val']<_0x44192c-0.5&&(_0x1c6797[_0x8440e4(0x116)][_0x8440e4(0x14d)](_0x8440e4(0x10f)+_0x19e15c+_0x8440e4(0xbb)+_0x29dde2[_0x8440e4(0xb7)]+_0x8440e4(0x141)+_0x44192c+_0x8440e4(0xd5)+_0x116a7b+_0x8440e4(0xff)),await _0x1c6797[_0x8440e4(0x10e)](_0x54a545,_0x44192c),await logAutomationAction(_0x1c6797,_0x8440e4(0xfd)+_0x29dde2[_0x8440e4(0xb7)]+_0x8440e4(0x127)+_0x44192c+_0x8440e4(0x9c)+_0x19e15c+')'),lastActions['cal_'+_0x29dde2[_0x8440e4(0xb7)]]=_0x4354f3);}}}}}}}catch(_0x2ef542){_0x1c6797['log']['warn'](_0x8440e4(0x134)+_0x2ef542[_0x8440e4(0x13f)]);}}async function manageMpcIntervention(_0x2eb828,_0x51e12a,_0xf849e6){const _0x414926=a1_0x44cdc3;try{const _0x312539=_0x414926(0xe1),_0x438aed=await _0x2eb828[_0x414926(0xf9)](_0x312539);let _0x5bade9=[];if(_0x438aed&&_0x438aed[_0x414926(0xb9)])try{_0x5bade9=JSON['parse'](_0x438aed[_0x414926(0xb9)]);}catch(_0x474398){}const _0x642e67=_0x5bade9[_0x414926(0xb3)](_0x51e12a);if(_0xf849e6===_0x414926(0x132))_0x642e67===-0x1&&(_0x5bade9[_0x414926(0x12a)](_0x51e12a),await _0x2eb828['setStateAsync'](_0x312539,{'val':JSON[_0x414926(0x114)](_0x5bade9),'ack':!![]}));else _0xf849e6===_0x414926(0xce)&&(_0x642e67!==-0x1&&(_0x5bade9[_0x414926(0x137)](_0x642e67,0x1),await _0x2eb828['setStateAsync'](_0x312539,{'val':JSON[_0x414926(0x114)](_0x5bade9),'ack':!![]})));}catch(_0x204e67){}}async function cleanupGhostInterventions(_0x50a60d){const _0x4e81e5=a1_0x44cdc3;try{const _0x299696=_0x4e81e5(0xe1),_0x5b2fcd=await _0x50a60d[_0x4e81e5(0xf9)](_0x299696);if(!_0x5b2fcd||!_0x5b2fcd[_0x4e81e5(0xb9)])return;const _0x15b04c=JSON[_0x4e81e5(0x148)](_0x5b2fcd[_0x4e81e5(0xb9)]);if(!Array[_0x4e81e5(0x136)](_0x15b04c)||_0x15b04c['length']===0x0)return;let _0x4ce1d3={'default':0x15};try{const _0x2cf074=await _0x50a60d['getStateAsync']('analysis.energy.warmupTargets');if(_0x2cf074&&_0x2cf074[_0x4e81e5(0xb9)])_0x4ce1d3=JSON['parse'](_0x2cf074[_0x4e81e5(0xb9)]);}catch(_0x6ab012){}let _0xd37ac1=[];try{const _0x469acf=await _0x50a60d[_0x4e81e5(0xf9)]('analysis.energy.ventilationAlerts');if(_0x469acf&&_0x469acf[_0x4e81e5(0xb9)])_0xd37ac1=JSON[_0x4e81e5(0x148)](_0x469acf[_0x4e81e5(0xb9)]);}catch(_0x540f7f){}const _0x2f4170=_0x50a60d[_0x4e81e5(0xe7)]['devices']||[];let _0x58babc=![];for(let _0x388408=_0x15b04c['length']-0x1;_0x388408>=0x0;_0x388408--){const _0x2e051f=_0x15b04c[_0x388408],_0x2f695f=_0x2f4170[_0x4e81e5(0x13a)](_0x593d18=>normalize(_0x593d18['location'])===normalize(_0x2e051f)&&(_0x593d18['type']==='temperature'||_0x593d18[_0x4e81e5(0x13c)]===_0x4e81e5(0xc8)));if(!_0x2f695f){_0x50a60d[_0x4e81e5(0x116)][_0x4e81e5(0xcb)](_0x4e81e5(0xb2)+_0x2e051f+'\x27\x20hat\x20kein\x20GerÃ¤t\x20mehr.\x20LÃ¶sche\x20Eintrag.'),_0x15b04c['splice'](_0x388408,0x1),_0x58babc=!![];continue;}if(_0x2f695f){const _0x26179a=await findRelatedId(_0x50a60d,_0x2f695f['id'],_0x4e81e5(0xe5)),_0x28e629=await _0x50a60d[_0x4e81e5(0xe6)](_0x2f695f['id']);if(_0x26179a){const _0x499fb0=await _0x50a60d[_0x4e81e5(0xe6)](_0x26179a);if(_0x499fb0&&typeof _0x499fb0[_0x4e81e5(0xb9)]===_0x4e81e5(0xca)){let _0x31711f=![],_0x851368='';Math[_0x4e81e5(0xd7)](_0x499fb0[_0x4e81e5(0xb9)]-ECO_TEMP)>0.5&&(_0x31711f=!![],_0x851368=_0x4e81e5(0xea));if(!_0x31711f&&_0x28e629&&typeof _0x28e629[_0x4e81e5(0xb9)]===_0x4e81e5(0xca)){const _0x2730a0=_0x4ce1d3[_0x2e051f]||_0x4ce1d3[_0x4e81e5(0x125)]||0x15;_0x28e629[_0x4e81e5(0xb9)]<_0x2730a0+0.2&&(_0x31711f=!![],_0x851368=_0x4e81e5(0xe8));}if(_0x31711f){if(_0x851368===_0x4e81e5(0xea)){_0x50a60d[_0x4e81e5(0x116)][_0x4e81e5(0x14d)](_0x4e81e5(0xc1)+_0x2e051f+_0x4e81e5(0xd4)+_0x499fb0[_0x4e81e5(0xb9)]+'Â°C\x20(nicht\x20'+ECO_TEMP+_0x4e81e5(0xe2));const _0x5e953f=lastActions[_0x4e81e5(0x11d)+_0x2e051f],_0x24ce44=_0x5e953f&&Date[_0x4e81e5(0x13e)]()-_0x5e953f<0x2*0x3c*0x3e8;if(!_0x24ce44&&_0x499fb0[_0x4e81e5(0xb9)]>ECO_TEMP+0.5)_0x50a60d[_0x4e81e5(0xf2)]&&(_0x50a60d[_0x4e81e5(0x116)][_0x4e81e5(0x14d)](_0x4e81e5(0xa3)+_0x2e051f+_0x4e81e5(0xa7)),_0x50a60d['sendToPythonWrapper'](_0x4e81e5(0xad),{'room':_0x2e051f}));else _0x24ce44&&_0x50a60d[_0x4e81e5(0x116)]['info']('ðŸ“…\x20[MPC\x20INFO]\x20'+_0x2e051f+_0x4e81e5(0xd6));}else{if(_0x851368===_0x4e81e5(0xe8)){let _0x1d6282=![];if(_0xd37ac1[_0x4e81e5(0x13a)](_0x15ef14=>_0x15ef14[_0x4e81e5(0x149)]===_0x2e051f))_0x1d6282=!![];const _0x51949b=_0x2f4170[_0x4e81e5(0xfb)](_0x510982=>normalize(_0x510982[_0x4e81e5(0xb7)])===normalize(_0x2e051f)&&(_0x510982['type']===_0x4e81e5(0x11a)||_0x510982[_0x4e81e5(0x13c)]==='sensor'||_0x510982[_0x4e81e5(0x13c)]===_0x4e81e5(0x12d)));for(const _0x491b59 of _0x51949b){try{const _0x3bf61e=await _0x50a60d[_0x4e81e5(0xe6)](_0x491b59['id']);if(_0x3bf61e&&(_0x3bf61e[_0x4e81e5(0xb9)]===!![]||_0x3bf61e[_0x4e81e5(0xb9)]===0x1||String(_0x3bf61e[_0x4e81e5(0xb9)])['toLowerCase']()==='open'))_0x1d6282=!![];}catch(_0x4750e1){}}if(_0x1d6282)_0x50a60d['log'][_0x4e81e5(0x14d)](_0x4e81e5(0xae)+_0x2e051f+_0x4e81e5(0x129));else{const _0x273fef=_0x4ce1d3[_0x2e051f]||_0x4ce1d3['default']||0x15;_0x50a60d[_0x4e81e5(0x116)][_0x4e81e5(0x14d)](_0x4e81e5(0xb6)+_0x2e051f+'\x20erreicht\x20Limit\x20('+_0x28e629[_0x4e81e5(0xb9)]+_0x4e81e5(0x9d)+(_0x273fef+0.2)+_0x4e81e5(0x144)),await _0x50a60d['setForeignStateAsync'](_0x26179a,_0x273fef),await logAutomationAction(_0x50a60d,_0x4e81e5(0x14b)+_0x2e051f+_0x4e81e5(0xec)+_0x273fef+'Â°C'),lastActions[_0x4e81e5(0x111)+_0x2e051f]=Date[_0x4e81e5(0x13e)]();}}}_0x15b04c[_0x4e81e5(0x137)](_0x388408,0x1),_0x58babc=!![];}}}}}_0x58babc&&await _0x50a60d[_0x4e81e5(0x11b)](_0x299696,{'val':JSON[_0x4e81e5(0x114)](_0x15b04c),'ack':!![]});}catch(_0x15fc96){}}async function applyEnergySavings(_0x2d35f2,_0x2fe046){const _0x2c9bd5=a1_0x44cdc3;await cleanupGhostInterventions(_0x2d35f2);if(!_0x2fe046||_0x2fe046[_0x2c9bd5(0xa8)]===0x0)return;const _0x2f6a0f=_0x2d35f2[_0x2c9bd5(0xe7)]['devices']||[],_0x39b590=Date[_0x2c9bd5(0x13e)]();for(const _0x55d644 of _0x2fe046){const _0x4647b3=_0x55d644[_0x2c9bd5(0x149)],_0x54424f=_0x55d644[_0x2c9bd5(0xaa)],_0x53cb87=_0x55d644[_0x2c9bd5(0xaf)]||0x15;if(lastActions[_0x2c9bd5(0x111)+_0x4647b3]&&_0x39b590-lastActions['rescue_'+_0x4647b3]<RESCUE_LOCK_MS)continue;const _0x953362=_0x2f6a0f[_0x2c9bd5(0x13a)](_0x4da560=>normalize(_0x4da560[_0x2c9bd5(0xb7)])===normalize(_0x4647b3)&&(_0x4da560[_0x2c9bd5(0x13c)]===_0x2c9bd5(0xc2)||_0x4da560[_0x2c9bd5(0x13c)]==='thermostat'));if(!_0x953362)continue;const _0x477a43=await findRelatedId(_0x2d35f2,_0x953362['id'],_0x2c9bd5(0xe5));if(_0x477a43){if(lastActions['mpc_'+_0x4647b3]&&_0x39b590-lastActions[_0x2c9bd5(0xf5)+_0x4647b3]<0x1e*0x3c*0x3e8)continue;const _0x3b7577=await _0x2d35f2['getForeignStateAsync'](_0x477a43);if(_0x3b7577&&typeof _0x3b7577[_0x2c9bd5(0xb9)]===_0x2c9bd5(0xca)){const _0x591afc=_0x3b7577[_0x2c9bd5(0xb9)];_0x591afc!==ECO_TEMP&&await manageMpcIntervention(_0x2d35f2,_0x4647b3,'remove');if(_0x54424f>0x1e)_0x591afc>ECO_TEMP+0.5&&(_0x2d35f2[_0x2c9bd5(0x116)][_0x2c9bd5(0x14d)](_0x2c9bd5(0x124)+_0x4647b3+_0x2c9bd5(0xc4)+ECO_TEMP+'Â°C!\x20(Puffer:\x20'+_0x54424f+'\x20min)'),await _0x2d35f2['setForeignStateAsync'](_0x477a43,ECO_TEMP),await manageMpcIntervention(_0x2d35f2,_0x4647b3,'add'),lastActions['mpc_'+_0x4647b3]=_0x39b590,await logAutomationAction(_0x2d35f2,_0x2c9bd5(0x10d)+_0x4647b3+':\x20Absenkung\x20auf\x20'+ECO_TEMP+'Â°C'));else _0x54424f<=0xf&&(_0x591afc<_0x53cb87&&(_0x2d35f2[_0x2c9bd5(0x116)][_0x2c9bd5(0x14d)](_0x2c9bd5(0x109)+_0x4647b3+'\x20wieder\x20auf\x20'+_0x53cb87+'Â°C!\x20(Puffer\x20leer).'),await _0x2d35f2[_0x2c9bd5(0x10e)](_0x477a43,_0x53cb87),await manageMpcIntervention(_0x2d35f2,_0x4647b3,'remove'),lastActions[_0x2c9bd5(0xf5)+_0x4647b3]=_0x39b590,await logAutomationAction(_0x2d35f2,'[MPC]\x20'+_0x4647b3+_0x2c9bd5(0x126)+_0x53cb87+'Â°C')));}}else _0x2d35f2[_0x2c9bd5(0x116)][_0x2c9bd5(0xcb)](_0x2c9bd5(0x139)+_0x4647b3+'\x20gefunden!');}}module[a1_0x44cdc3(0xb0)]={'handlePrediction':handlePrediction,'applyEnergySavings':applyEnergySavings,'scanThermostats':scanThermostats,'checkCalendarTriggers':checkCalendarTriggers,'updateSchedulePreview':updateSchedulePreview,'cleanupGhostInterventions':cleanupGhostInterventions};