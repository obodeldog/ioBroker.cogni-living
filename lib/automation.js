function a1_0x4192(_0x541531,_0x50c3bc){const _0x2e145c=a1_0x37a2();return a1_0x4192=function(_0x1fdf8b,_0x34561b){_0x1fdf8b=_0x1fdf8b-0xee;let _0x37a2c3=_0x2e145c[_0x1fdf8b];return _0x37a2c3;},a1_0x4192(_0x541531,_0x50c3bc);}const a1_0x29be8b=a1_0x4192;(function(_0x42fe7e,_0x386350){const _0x20e5e7=a1_0x4192,_0x1a9d7e=_0x42fe7e();while(!![]){try{const _0x21ed3b=-parseInt(_0x20e5e7(0x199))/0x1+-parseInt(_0x20e5e7(0x174))/0x2*(parseInt(_0x20e5e7(0x125))/0x3)+parseInt(_0x20e5e7(0x18e))/0x4+-parseInt(_0x20e5e7(0x14e))/0x5*(-parseInt(_0x20e5e7(0xf7))/0x6)+parseInt(_0x20e5e7(0xf6))/0x7+parseInt(_0x20e5e7(0x109))/0x8+parseInt(_0x20e5e7(0x186))/0x9*(-parseInt(_0x20e5e7(0x151))/0xa);if(_0x21ed3b===_0x386350)break;else _0x1a9d7e['push'](_0x1a9d7e['shift']());}catch(_0x3ccda0){_0x1a9d7e['push'](_0x1a9d7e['shift']());}}}(a1_0x37a2,0xf340b));const a1_0x34561b=(function(){let _0x55971=!![];return function(_0x5e7b31,_0x1a5746){const _0x57c130=_0x55971?function(){const _0x540173=a1_0x4192;if(_0x1a5746){const _0xce5812=_0x1a5746[_0x540173(0x192)](_0x5e7b31,arguments);return _0x1a5746=null,_0xce5812;}}:function(){};return _0x55971=![],_0x57c130;};}()),a1_0x1fdf8b=a1_0x34561b(this,function(){const _0x40192c=a1_0x4192;return a1_0x1fdf8b[_0x40192c(0x112)]()['search'](_0x40192c(0x191))[_0x40192c(0x112)]()[_0x40192c(0x105)](a1_0x1fdf8b)[_0x40192c(0x163)](_0x40192c(0x191));});a1_0x1fdf8b();'use strict';const aiAgent=require(a1_0x29be8b(0x119)),COOLDOWN_MS=0x3c*0x3e8,CAL_COOLDOWN_MS=0x5a*0x3c*0x3e8,RESCUE_LOCK_MS=0x78*0x3c*0x3e8,ECO_TEMP=0x11,lastActions={};function normalize(_0x17c84d){const _0x547e46=a1_0x29be8b;if(!_0x17c84d)return'';return _0x17c84d[_0x547e46(0x136)]()[_0x547e46(0x1a0)](/\s+/g,'')[_0x547e46(0x16e)]();}async function logAutomationAction(_0x302c39,_0x4aaa78){const _0x81ff7b=a1_0x29be8b;await _0x302c39[_0x81ff7b(0x14a)]('analysis.automation.lastAction',{'val':_0x4aaa78,'ack':!![]});try{const _0x4655b9=_0x81ff7b(0x184),_0x2cf69e=await _0x302c39[_0x81ff7b(0x187)](_0x4655b9);let _0x2111be=[];if(_0x2cf69e&&_0x2cf69e[_0x81ff7b(0xee)])try{_0x2111be=JSON[_0x81ff7b(0x19a)](_0x2cf69e[_0x81ff7b(0xee)]);}catch(_0x3be348){}_0x2111be[_0x81ff7b(0x15d)]({'ts':Date[_0x81ff7b(0x185)](),'msg':_0x4aaa78});if(_0x2111be[_0x81ff7b(0x17e)]>0x32)_0x2111be=_0x2111be[_0x81ff7b(0x148)](0x0,0x32);await _0x302c39[_0x81ff7b(0x14a)](_0x4655b9,{'val':JSON[_0x81ff7b(0x18f)](_0x2111be),'ack':!![]});}catch(_0x52f99e){}}async function handlePrediction(_0x821e83,_0x539853,_0x6ffa8e){const _0x379744=a1_0x29be8b;if(!_0x539853||_0x539853==='Unknown')return;let _0x424509=_0x379744(0x160),_0x9ef654=0.6;try{const _0x3e2640=await _0x821e83[_0x379744(0x187)](_0x379744(0x15e));if(_0x3e2640&&_0x3e2640['val'])_0x424509=_0x3e2640['val'];const _0x5e9bfe=await _0x821e83[_0x379744(0x187)](_0x379744(0x144));if(_0x5e9bfe&&_0x5e9bfe['val'])_0x9ef654=_0x5e9bfe[_0x379744(0xee)];}catch(_0x41865c){}if(_0x424509==='off'||_0x6ffa8e<_0x9ef654)return;const _0x217d56=Date[_0x379744(0x185)]();if(lastActions[_0x539853]&&_0x217d56-lastActions[_0x539853]<COOLDOWN_MS)return;const _0x3c2925=_0x821e83['config'][_0x379744(0x12a)]||[],_0x51e6d5=normalize(_0x539853),_0xe92c4d=_0x3c2925[_0x379744(0x12c)](_0x283f22=>normalize(_0x283f22[_0x379744(0x124)])===_0x51e6d5&&(_0x283f22['type']==='light'||_0x283f22[_0x379744(0x152)]==='dimmer'||_0x283f22[_0x379744(0x152)]===_0x379744(0x196)));if(!_0xe92c4d)return;const _0x5215ff=await aiAgent['consultButler'](_0x821e83,_0x539853,_0xe92c4d['name'],_0x6ffa8e);if(!_0x5215ff[_0x379744(0x123)])return;const _0x35ef56=_0x379744(0x16b)+_0x539853+'\x20->\x20Schalte\x20'+_0xe92c4d[_0x379744(0x108)]+'\x20('+_0x5215ff[_0x379744(0x19e)]+')';await logAutomationAction(_0x821e83,'['+_0x424509[_0x379744(0x190)]()+']\x20'+_0x35ef56);if(_0x424509==='active'){const _0xf19bdf=await _0x821e83['getForeignStateAsync'](_0xe92c4d['id']);(!_0xf19bdf||!_0xf19bdf[_0x379744(0xee)]&&_0xf19bdf[_0x379744(0xee)]!==!![])&&await _0x821e83[_0x379744(0x153)](_0xe92c4d['id'],!![]),lastActions[_0x539853]=_0x217d56;}}async function findRelatedId(_0x12a9ad,_0x49c1c8,_0x4161a9='setpoint'){const _0x120b7e=a1_0x29be8b;if(_0x4161a9==='setpoint'&&_0x12a9ad[_0x120b7e(0x178)][_0x120b7e(0x154)]){let _0x36a2ee=_0x12a9ad[_0x120b7e(0x178)][_0x120b7e(0x154)];if(typeof _0x36a2ee===_0x120b7e(0x16d))try{_0x36a2ee=JSON[_0x120b7e(0x19a)](_0x36a2ee);}catch(_0x23cf00){}if(_0x36a2ee&&_0x36a2ee[_0x49c1c8])return _0x36a2ee[_0x49c1c8];}if(_0x4161a9==='valve'&&_0x12a9ad[_0x120b7e(0x178)][_0x120b7e(0x149)]){let _0x44d35f=_0x12a9ad['config'][_0x120b7e(0x149)];if(typeof _0x44d35f===_0x120b7e(0x16d))try{_0x44d35f=JSON[_0x120b7e(0x19a)](_0x44d35f);}catch(_0x3dc7ff){}if(_0x44d35f&&_0x44d35f[_0x49c1c8])return _0x44d35f[_0x49c1c8];}let _0x17050f=[];if(_0x4161a9===_0x120b7e(0x118))_0x17050f=[{'s':'.1.ACTUAL_TEMPERATURE','t':_0x120b7e(0x130)},{'s':'.1.TEMPERATURE','t':_0x120b7e(0x130)},{'s':'.1.TEMPERATURE','t':_0x120b7e(0x177)},{'s':'ACTUAL_TEMPERATURE','t':_0x120b7e(0x146)},{'s':_0x120b7e(0x183),'t':'occupied_heating_setpoint'},{'s':_0x120b7e(0x183),'t':_0x120b7e(0x188)},{'s':_0x120b7e(0x150),'t':'target_temperature'},{'s':_0x120b7e(0x122),'t':'SET'},{'s':_0x120b7e(0xfe),'t':_0x120b7e(0x111)},{'s':_0x120b7e(0x150),'t':_0x120b7e(0x118)}];else _0x4161a9===_0x120b7e(0x15a)&&(_0x17050f=[{'s':'.1.ACTUAL_TEMPERATURE','t':_0x120b7e(0xfd)},{'s':_0x120b7e(0x179),'t':_0x120b7e(0xfd)},{'s':_0x120b7e(0x179),'t':_0x120b7e(0x15f)},{'s':_0x120b7e(0x183),'t':_0x120b7e(0xf1)},{'s':_0x120b7e(0x150),'t':_0x120b7e(0x19d)},{'s':_0x120b7e(0x150),'t':_0x120b7e(0x133)}]);for(const _0x448c51 of _0x17050f){if(_0x49c1c8[_0x120b7e(0x10b)](_0x448c51['s'])){const _0x2ce2f4=_0x49c1c8[_0x120b7e(0x1a0)](_0x448c51['s'],_0x448c51['t']),_0x12fee7=await _0x12a9ad[_0x120b7e(0x176)](_0x2ce2f4);if(_0x12fee7)return _0x2ce2f4;}}try{const _0x1a1112=_0x49c1c8[_0x120b7e(0x10d)]('.');if(_0x1a1112[_0x120b7e(0x17e)]>0x2){const _0x4883a2=_0x1a1112[_0x120b7e(0x148)](0x0,-0x1)[_0x120b7e(0xff)]('.'),_0x1926d7=await _0x12a9ad[_0x120b7e(0x10e)](_0x4883a2+'.*'),_0x9004f9=[],_0x2a4f6c=_0x49c1c8[_0x120b7e(0x10d)](/[._]+/)[_0x120b7e(0x194)](_0x204b88=>![_0x120b7e(0x161),'0','hm-rpc','ist',_0x120b7e(0x170),_0x120b7e(0x150),_0x120b7e(0x115),_0x120b7e(0x12b),_0x120b7e(0x11f),_0x120b7e(0x13a)]['includes'](_0x204b88[_0x120b7e(0x136)]()));for(const [_0x2e2a3b,_0x9c7b4d]of Object[_0x120b7e(0x134)](_0x1926d7)){if(_0x2e2a3b===_0x49c1c8)continue;if(_0x9c7b4d&&_0x9c7b4d[_0x120b7e(0x169)]){const _0x27799a=_0x2e2a3b[_0x120b7e(0x136)](),_0x2dc359=(_0x9c7b4d[_0x120b7e(0x169)][_0x120b7e(0x11a)]||'')[_0x120b7e(0x136)](),_0x35a236=(_0x9c7b4d[_0x120b7e(0x169)][_0x120b7e(0x162)]||'')[_0x120b7e(0x136)]();let _0x540242=![];if(_0x4161a9===_0x120b7e(0x118)&&_0x9c7b4d[_0x120b7e(0x169)][_0x120b7e(0x141)]===!![])_0x540242=_0x27799a['includes'](_0x120b7e(0x102))||_0x27799a['includes'](_0x120b7e(0x17f))||_0x27799a[_0x120b7e(0x10b)](_0x120b7e(0x138))||_0x2dc359[_0x120b7e(0x10b)](_0x120b7e(0x12f))||_0x2dc359[_0x120b7e(0x10b)]('thermostat.setpoint');else _0x4161a9===_0x120b7e(0x15a)&&(_0x540242=_0x27799a[_0x120b7e(0x10b)](_0x120b7e(0x133))||_0x27799a[_0x120b7e(0x10b)]('valve')||_0x27799a[_0x120b7e(0x10b)](_0x120b7e(0xf8))||_0x27799a[_0x120b7e(0x10b)](_0x120b7e(0x155))||_0x2dc359[_0x120b7e(0x10b)](_0x120b7e(0x18b))||_0x2dc359[_0x120b7e(0x10b)](_0x120b7e(0x15c))||_0x35a236[_0x120b7e(0x10b)]('%'));if(_0x540242){const _0x5629d4=_0x2e2a3b['split'](/[._]+/)['map'](_0x54e233=>_0x54e233['toLowerCase']());let _0x5f2e04=0x0;_0x2a4f6c[_0x120b7e(0x193)](_0x18f769=>{const _0x3d1810=_0x120b7e;if(_0x5629d4[_0x3d1810(0x10b)](_0x18f769[_0x3d1810(0x136)]()))_0x5f2e04++;}),_0x9004f9[_0x120b7e(0x106)]({'id':_0x2e2a3b,'score':_0x5f2e04});}}}if(_0x9004f9[_0x120b7e(0x17e)]>0x0){_0x9004f9[_0x120b7e(0xf4)]((_0x2d4311,_0x398dc0)=>_0x398dc0[_0x120b7e(0x13b)]-_0x2d4311[_0x120b7e(0x13b)]);if(_0x9004f9[0x0][_0x120b7e(0x13b)]>0x0)return _0x9004f9[0x0]['id'];}}}catch(_0x1e2345){}return null;}async function scanThermostats(_0x497d21){const _0x55ec01=a1_0x29be8b,_0x4b1380=_0x497d21[_0x55ec01(0x178)][_0x55ec01(0x12a)]||[],_0x503dc7=[],_0x62ac29=_0x4b1380[_0x55ec01(0x194)](_0x3bfccf=>_0x3bfccf['id']&&_0x3bfccf['id']['includes'](_0x55ec01(0x150))||_0x3bfccf['type']&&['temperature',_0x55ec01(0x156),'sensor'][_0x55ec01(0x10b)](_0x3bfccf[_0x55ec01(0x152)])||_0x3bfccf[_0x55ec01(0x108)]&&_0x3bfccf[_0x55ec01(0x108)][_0x55ec01(0x136)]()['includes']('temp'));for(const _0x56f079 of _0x62ac29){const _0x4bfc73=await findRelatedId(_0x497d21,_0x56f079['id'],_0x55ec01(0x118)),_0x59cb7e=await findRelatedId(_0x497d21,_0x56f079['id'],_0x55ec01(0x15a));let _0xd4a7ec=_0x55ec01(0x158),_0x31406f=![],_0x365145=_0x497d21[_0x55ec01(0x178)][_0x55ec01(0x154)]||{};if(typeof _0x365145===_0x55ec01(0x16d))try{_0x365145=JSON[_0x55ec01(0x19a)](_0x365145);}catch(_0x22863c){}let _0x3a201b=_0x497d21[_0x55ec01(0x178)][_0x55ec01(0x149)]||{};if(typeof _0x3a201b===_0x55ec01(0x16d))try{_0x3a201b=JSON['parse'](_0x3a201b);}catch(_0x59075){}if(_0x365145[_0x56f079['id']]&&_0x365145[_0x56f079['id']]===_0x4bfc73||_0x3a201b[_0x56f079['id']]&&_0x3a201b[_0x56f079['id']]===_0x59cb7e)_0xd4a7ec='Manuelles\x20Mapping',_0x31406f=!![];else(_0x4bfc73||_0x59cb7e)&&(_0xd4a7ec=_0x55ec01(0x164));_0x503dc7[_0x55ec01(0x106)]({'room':_0x56f079[_0x55ec01(0x124)]||_0x55ec01(0x142),'sensorId':_0x56f079['id'],'setpointId':_0x4bfc73||'-','valveId':_0x59cb7e||'-','source':_0xd4a7ec,'isManual':_0x31406f,'status':_0x4bfc73&&_0x59cb7e?_0x55ec01(0x182):_0x4bfc73?'OK':_0x55ec01(0x101)});}return _0x503dc7['sort']((_0x5ece0a,_0x4da01b)=>_0x5ece0a[_0x55ec01(0x189)][_0x55ec01(0x135)](_0x4da01b[_0x55ec01(0x189)]));}async function updateSchedulePreview(_0x45855c){const _0x103196=a1_0x29be8b;if(!_0x45855c[_0x103196(0x178)][_0x103196(0x17c)]||!_0x45855c['config'][_0x103196(0x129)])return;let _0x221c1c={};try{const _0x428dda=await _0x45855c[_0x103196(0x187)](_0x103196(0x14c));if(_0x428dda&&_0x428dda[_0x103196(0xee)])_0x221c1c=JSON[_0x103196(0x19a)](_0x428dda[_0x103196(0xee)]);}catch(_0x36dc9f){}const _0x1b014f=[],_0x5b3ab0=Date[_0x103196(0x185)](),_0x477518=0x30*0x3c*0x3c*0x3e8;try{const _0x5f528f=await _0x45855c['getForeignStateAsync'](_0x45855c[_0x103196(0x178)]['calendarInstance']+_0x103196(0x17d));if(!_0x5f528f||!_0x5f528f[_0x103196(0xee)])return;const _0x587430=JSON['parse'](_0x5f528f[_0x103196(0xee)]),_0x489492=_0x45855c['config'][_0x103196(0x17b)]||[],_0x1f74fe=_0x45855c[_0x103196(0x178)][_0x103196(0x12a)]||[],_0xe67813=new Set();_0x1f74fe['forEach'](_0x17fd18=>{const _0xd6b3cc=_0x103196;if(_0x17fd18[_0xd6b3cc(0x124)])_0xe67813['add'](_0x17fd18[_0xd6b3cc(0x124)]);});for(const _0x1594ef of _0x587430){if(_0x1594ef[_0x103196(0x16f)]&&_0x489492[_0x103196(0x17e)]>0x0&&!_0x489492[_0x103196(0x10b)](_0x1594ef[_0x103196(0x16f)]))continue;const _0x1e82d1=_0x1594ef[_0x103196(0x16c)]||_0x1594ef['eventStart']||_0x1594ef[_0x103196(0x147)];if(!_0x1e82d1)continue;const _0x56b355=new Date(_0x1e82d1),_0x40726e=_0x56b355[_0x103196(0x140)]();if(isNaN(_0x40726e))continue;if(_0x40726e<_0x5b3ab0)continue;if(_0x40726e>_0x5b3ab0+_0x477518)continue;const _0x193121=(_0x1594ef[_0x103196(0x13c)]||_0x1594ef['summary']||'')[_0x103196(0x136)]();let _0x989333=![],_0x502fde=[],_0x140e37=_0x1594ef[_0x103196(0x13c)]||_0x1594ef[_0x103196(0x11d)]||_0x103196(0x142);if(_0x193121[_0x103196(0x10b)](_0x103196(0x198))||_0x193121[_0x103196(0x10b)]('r√ºckkehr')||_0x193121[_0x103196(0x10b)](_0x103196(0x19c)))_0x989333=!![],_0x502fde=Array[_0x103196(0x175)](_0xe67813);else for(const _0x435579 of _0xe67813){if(_0x193121[_0x103196(0x10b)](_0x435579[_0x103196(0x136)]()))_0x502fde[_0x103196(0x106)](_0x435579);}_0x502fde['length']>0x0&&_0x502fde['forEach'](_0x43f7b8=>{const _0x1cc171=_0x103196;let _0x2d8f7a=0x3c;if(_0x989333){let _0x3d0924=0x0;Object[_0x1cc171(0x127)](_0x221c1c)['forEach'](_0x47bb19=>{if(_0x47bb19>_0x3d0924)_0x3d0924=_0x47bb19;}),_0x2d8f7a=_0x3d0924>0x0?_0x3d0924:0x78;}else _0x2d8f7a=_0x221c1c[_0x43f7b8]||0x3c;const _0x189c1a=new Date(_0x40726e-_0x2d8f7a*0xea60);_0x1b014f[_0x1cc171(0x106)]({'eventTime':_0x40726e,'triggerTime':_0x189c1a[_0x1cc171(0x140)](),'room':_0x43f7b8,'minutes':_0x2d8f7a,'reason':_0x140e37,'isGlobal':_0x989333});});}}catch(_0x1099dd){}_0x1b014f[_0x103196(0xf4)]((_0x35e4ab,_0x4ecf1f)=>_0x35e4ab['triggerTime']-_0x4ecf1f[_0x103196(0x145)]);const _0x3c8bcc=_0x1b014f[_0x103196(0x148)](0x0,0x5);await _0x45855c[_0x103196(0x14a)](_0x103196(0x15b),{'val':JSON[_0x103196(0x18f)](_0x3c8bcc),'ack':!![]});}async function checkCalendarTriggers(_0x3933ee){const _0x3b87ea=a1_0x29be8b;if(!_0x3933ee['config'][_0x3b87ea(0x17c)]||!_0x3933ee[_0x3b87ea(0x178)][_0x3b87ea(0x129)])return;await updateSchedulePreview(_0x3933ee);let _0x58a7b6={},_0x514401={};try{const _0x2781f1=await _0x3933ee['getStateAsync'](_0x3b87ea(0x14c));if(_0x2781f1&&_0x2781f1[_0x3b87ea(0xee)])_0x58a7b6=JSON[_0x3b87ea(0x19a)](_0x2781f1[_0x3b87ea(0xee)]);const _0x1cadbe=await _0x3933ee[_0x3b87ea(0x187)]('analysis.energy.warmupSources');if(_0x1cadbe&&_0x1cadbe[_0x3b87ea(0xee)])_0x514401=JSON[_0x3b87ea(0x19a)](_0x1cadbe['val']);}catch(_0x2020f5){}let _0x4c0bdf={'default':0x15};try{const _0x264a3f=await _0x3933ee['getStateAsync'](_0x3b87ea(0x173));if(_0x264a3f&&_0x264a3f[_0x3b87ea(0xee)])_0x4c0bdf=JSON[_0x3b87ea(0x19a)](_0x264a3f[_0x3b87ea(0xee)]);}catch(_0x2c1805){}try{const _0x320ab5=await _0x3933ee['getForeignStateAsync'](_0x3933ee['config']['calendarInstance']+_0x3b87ea(0x17d));if(!_0x320ab5||!_0x320ab5[_0x3b87ea(0xee)])return;const _0x34c759=JSON[_0x3b87ea(0x19a)](_0x320ab5[_0x3b87ea(0xee)]),_0x2e4cd5=Date['now'](),_0xf79518=_0x3933ee[_0x3b87ea(0x178)][_0x3b87ea(0x12a)]||[],_0x20066f=_0x3933ee[_0x3b87ea(0x178)]['calendarSelection']||[];for(const _0x108762 of _0x34c759){if(_0x108762[_0x3b87ea(0x16f)]&&_0x20066f['length']>0x0&&!_0x20066f['includes'](_0x108762[_0x3b87ea(0x16f)]))continue;const _0x467712=_0x108762[_0x3b87ea(0x16c)]||_0x108762[_0x3b87ea(0x12e)]||_0x108762['date'];if(!_0x467712)continue;const _0x3d4945=new Date(_0x467712);if(isNaN(_0x3d4945[_0x3b87ea(0x140)]()))continue;const _0x3fc6ed=(_0x108762[_0x3b87ea(0x13c)]||_0x108762[_0x3b87ea(0x11d)]||'')[_0x3b87ea(0x136)]();if(_0x3fc6ed[_0x3b87ea(0x10b)](_0x3b87ea(0x198))||_0x3fc6ed[_0x3b87ea(0x10b)](_0x3b87ea(0x104))||_0x3fc6ed['includes'](_0x3b87ea(0x19c))){let _0x494ef0=0x0;Object[_0x3b87ea(0x127)](_0x58a7b6)['forEach'](_0x3f13c3=>{if(_0x3f13c3>_0x494ef0)_0x494ef0=_0x3f13c3;});if(_0x494ef0===0x0)_0x494ef0=0x78;const _0x48be13=_0x3d4945['getTime']()-_0x494ef0*0xea60;_0x2e4cd5>=_0x48be13&&_0x2e4cd5<_0x3d4945[_0x3b87ea(0x140)]()&&(_0x3933ee[_0x3b87ea(0x103)]!==_0x3b87ea(0x19f)&&(_0x3933ee['log']['info'](_0x3b87ea(0x10a)+_0x494ef0+_0x3b87ea(0xf9)),await _0x3933ee[_0x3b87ea(0x14a)](_0x3b87ea(0x181),{'val':_0x3b87ea(0x19f),'ack':![]})));}for(const _0x497520 of _0xf79518){if(_0x497520['location']){const _0x775bc8=_0x497520[_0x3b87ea(0x124)][_0x3b87ea(0x136)]();if(_0x3fc6ed[_0x3b87ea(0x10b)](_0x775bc8)){const _0x18c5cc=_0x58a7b6[_0x497520[_0x3b87ea(0x124)]]||0x3c,_0x1c0a31=_0x514401[_0x497520[_0x3b87ea(0x124)]]||_0x3b87ea(0x100),_0x44ed10=_0x3d4945[_0x3b87ea(0x140)]()-_0x18c5cc*0xea60;if(_0x2e4cd5>=_0x44ed10&&_0x2e4cd5<_0x3d4945['getTime']()){const _0x598205=lastActions[_0x3b87ea(0x137)+_0x497520['location']];if(_0x598205&&_0x2e4cd5-_0x598205<CAL_COOLDOWN_MS)continue;const _0x5a3f58=await findRelatedId(_0x3933ee,_0x497520['id'],_0x3b87ea(0x118));if(_0x5a3f58){let _0xd5b7cd=_0x4c0bdf[_0x497520[_0x3b87ea(0x124)]];if(_0xd5b7cd===undefined)_0xd5b7cd=_0x4c0bdf[_0x3b87ea(0x131)];if(_0xd5b7cd===undefined)_0xd5b7cd=0x15;const _0x504fa7=await _0x3933ee[_0x3b87ea(0x171)](_0x5a3f58);_0x504fa7&&typeof _0x504fa7[_0x3b87ea(0xee)]===_0x3b87ea(0xf3)&&_0x504fa7[_0x3b87ea(0xee)]<_0xd5b7cd-0.5&&(_0x3933ee[_0x3b87ea(0x117)][_0x3b87ea(0x10c)](_0x3b87ea(0x19b)+_0x1c0a31+_0x3b87ea(0xf5)+_0x497520[_0x3b87ea(0x124)]+_0x3b87ea(0xfa)+_0xd5b7cd+'¬∞C\x20(Vorlauf:\x20'+_0x18c5cc+_0x3b87ea(0xf9)),await _0x3933ee[_0x3b87ea(0x153)](_0x5a3f58,_0xd5b7cd),await logAutomationAction(_0x3933ee,'[CAL]\x20'+_0x497520['location']+_0x3b87ea(0x113)+_0xd5b7cd+_0x3b87ea(0x139)+_0x1c0a31+')'),lastActions[_0x3b87ea(0x137)+_0x497520[_0x3b87ea(0x124)]]=_0x2e4cd5);}}}}}}}catch(_0x118961){_0x3933ee['log']['warn'](_0x3b87ea(0x172)+_0x118961['message']);}}async function manageMpcIntervention(_0x2c4385,_0x3b790a,_0x52233b){const _0x4af59a=a1_0x29be8b;try{const _0x201aaf=_0x4af59a(0x121),_0x13838d=await _0x2c4385[_0x4af59a(0x187)](_0x201aaf);let _0xc6063d=[];if(_0x13838d&&_0x13838d[_0x4af59a(0xee)])try{_0xc6063d=JSON[_0x4af59a(0x19a)](_0x13838d[_0x4af59a(0xee)]);}catch(_0x701fb6){}const _0x461076=_0xc6063d['indexOf'](_0x3b790a);if(_0x52233b===_0x4af59a(0x107))_0x461076===-0x1&&(_0xc6063d[_0x4af59a(0x106)](_0x3b790a),await _0x2c4385[_0x4af59a(0x14a)](_0x201aaf,{'val':JSON[_0x4af59a(0x18f)](_0xc6063d),'ack':!![]}));else _0x52233b==='remove'&&(_0x461076!==-0x1&&(_0xc6063d[_0x4af59a(0x14b)](_0x461076,0x1),await _0x2c4385[_0x4af59a(0x14a)](_0x201aaf,{'val':JSON[_0x4af59a(0x18f)](_0xc6063d),'ack':!![]})));}catch(_0x4045ae){}}async function cleanupGhostInterventions(_0xc90d63){const _0x1f6540=a1_0x29be8b;try{const _0x46b157=_0x1f6540(0x121),_0x563714=await _0xc90d63[_0x1f6540(0x187)](_0x46b157);if(!_0x563714||!_0x563714[_0x1f6540(0xee)])return;const _0x294af8=JSON[_0x1f6540(0x19a)](_0x563714[_0x1f6540(0xee)]);if(!Array[_0x1f6540(0x16a)](_0x294af8)||_0x294af8[_0x1f6540(0x17e)]===0x0)return;let _0x3aecdc={'default':0x15};try{const _0x3d2f91=await _0xc90d63[_0x1f6540(0x187)](_0x1f6540(0x173));if(_0x3d2f91&&_0x3d2f91['val'])_0x3aecdc=JSON['parse'](_0x3d2f91[_0x1f6540(0xee)]);}catch(_0x585732){}let _0x4038f0=[];try{const _0x1069f6=await _0xc90d63['getStateAsync'](_0x1f6540(0x13d));if(_0x1069f6&&_0x1069f6['val'])_0x4038f0=JSON[_0x1f6540(0x19a)](_0x1069f6['val']);}catch(_0x3c87be){}const _0x358ac5=_0xc90d63['config'][_0x1f6540(0x12a)]||[];let _0x265839=![];for(let _0x2896f4=_0x294af8['length']-0x1;_0x2896f4>=0x0;_0x2896f4--){const _0x44f36f=_0x294af8[_0x2896f4],_0xa2df06=_0x358ac5[_0x1f6540(0x12c)](_0x3974f8=>normalize(_0x3974f8[_0x1f6540(0x124)])===normalize(_0x44f36f)&&(_0x3974f8[_0x1f6540(0x152)]===_0x1f6540(0x150)||_0x3974f8[_0x1f6540(0x152)]==='thermostat'));if(!_0xa2df06){_0xc90d63[_0x1f6540(0x117)]['warn']('üßπ\x20[MPC\x20CLEANUP]\x20Raum\x20\x27'+_0x44f36f+_0x1f6540(0x116)),_0x294af8[_0x1f6540(0x14b)](_0x2896f4,0x1),_0x265839=!![];continue;}if(_0xa2df06){const _0xfa13eb=await findRelatedId(_0xc90d63,_0xa2df06['id'],_0x1f6540(0x118)),_0x446c5d=await _0xc90d63[_0x1f6540(0x171)](_0xa2df06['id']);if(_0xfa13eb){const _0x52a52d=await _0xc90d63[_0x1f6540(0x171)](_0xfa13eb);if(_0x52a52d&&typeof _0x52a52d['val']===_0x1f6540(0xf3)){let _0x59fb59=![],_0x47bd2d='';Math['abs'](_0x52a52d[_0x1f6540(0xee)]-ECO_TEMP)>0.5&&(_0x59fb59=!![],_0x47bd2d=_0x1f6540(0xf0));if(!_0x59fb59&&_0x446c5d&&typeof _0x446c5d[_0x1f6540(0xee)]===_0x1f6540(0xf3)){const _0x40d431=_0x3aecdc[_0x44f36f]||_0x3aecdc[_0x1f6540(0x131)]||0x15;_0x446c5d[_0x1f6540(0xee)]<_0x40d431+0.2&&(_0x59fb59=!![],_0x47bd2d=_0x1f6540(0x197));}if(_0x59fb59){if(_0x47bd2d==='manual'){_0xc90d63['log'][_0x1f6540(0x10c)](_0x1f6540(0x159)+_0x44f36f+_0x1f6540(0x18a)+_0x52a52d[_0x1f6540(0xee)]+'¬∞C\x20(nicht\x20'+ECO_TEMP+_0x1f6540(0x17a));const _0x4ef869=lastActions[_0x1f6540(0x137)+_0x44f36f],_0x4943f9=_0x4ef869&&Date[_0x1f6540(0x185)]()-_0x4ef869<0x2*0x3c*0x3e8;if(!_0x4943f9&&_0x52a52d[_0x1f6540(0xee)]>ECO_TEMP+0.5)_0xc90d63[_0x1f6540(0x167)]&&(_0xc90d63[_0x1f6540(0x117)]['info'](_0x1f6540(0x195)+_0x44f36f+_0x1f6540(0xf2)),_0xc90d63[_0x1f6540(0x167)](_0x1f6540(0x14f),{'room':_0x44f36f}));else _0x4943f9&&_0xc90d63[_0x1f6540(0x117)][_0x1f6540(0x10c)](_0x1f6540(0x166)+_0x44f36f+'\x20durch\x20Kalender\x20ge√§ndert.\x20Keine\x20RL-Strafe.');}else{if(_0x47bd2d===_0x1f6540(0x197)){let _0x56ca9c=![];if(_0x4038f0[_0x1f6540(0x12c)](_0x360d38=>_0x360d38[_0x1f6540(0x189)]===_0x44f36f))_0x56ca9c=!![];const _0x211b4c=_0x358ac5[_0x1f6540(0x194)](_0x3ffe5f=>normalize(_0x3ffe5f[_0x1f6540(0x124)])===normalize(_0x44f36f)&&(_0x3ffe5f[_0x1f6540(0x152)]===_0x1f6540(0x114)||_0x3ffe5f[_0x1f6540(0x152)]===_0x1f6540(0x12b)||_0x3ffe5f[_0x1f6540(0x152)]==='contact'));for(const _0x3a112c of _0x211b4c){try{const _0x180942=await _0xc90d63[_0x1f6540(0x171)](_0x3a112c['id']);if(_0x180942&&(_0x180942['val']===!![]||_0x180942['val']===0x1||String(_0x180942['val'])[_0x1f6540(0x136)]()===_0x1f6540(0x18d)))_0x56ca9c=!![];}catch(_0x47bb2e){}}if(_0x56ca9c)_0xc90d63[_0x1f6540(0x117)][_0x1f6540(0x10c)]('üå¨Ô∏è\x20[MPC\x20WATCHDOG]\x20'+_0x44f36f+_0x1f6540(0x128));else{const _0x1c10f3=_0x3aecdc[_0x44f36f]||_0x3aecdc[_0x1f6540(0x131)]||0x15;_0xc90d63[_0x1f6540(0x117)][_0x1f6540(0x10c)]('üö®\x20[MPC\x20WATCHDOG]\x20'+_0x44f36f+_0x1f6540(0xfc)+_0x446c5d['val']+_0x1f6540(0x11e)+(_0x1c10f3+0.2)+_0x1f6540(0x180)),await _0xc90d63[_0x1f6540(0x153)](_0xfa13eb,_0x1c10f3),await logAutomationAction(_0xc90d63,_0x1f6540(0x157)+_0x44f36f+_0x1f6540(0x18c)+_0x1c10f3+'¬∞C'),lastActions[_0x1f6540(0x11c)+_0x44f36f]=Date['now']();}}}_0x294af8[_0x1f6540(0x14b)](_0x2896f4,0x1),_0x265839=!![];}}}}}_0x265839&&await _0xc90d63[_0x1f6540(0x14a)](_0x46b157,{'val':JSON['stringify'](_0x294af8),'ack':!![]});}catch(_0x4a8603){}}async function applyEnergySavings(_0x208a99,_0x25d88f){const _0x3b1387=a1_0x29be8b;await cleanupGhostInterventions(_0x208a99);if(!_0x25d88f||_0x25d88f['length']===0x0)return;const _0x58cf44=_0x208a99[_0x3b1387(0x178)]['devices']||[],_0x5ae2da=Date['now']();for(const _0x4f461a of _0x25d88f){const _0x2c05bc=_0x4f461a[_0x3b1387(0x189)],_0x12e982=_0x4f461a[_0x3b1387(0x126)],_0x27c74e=_0x4f461a[_0x3b1387(0x138)]||0x15;if(lastActions[_0x3b1387(0x11c)+_0x2c05bc]&&_0x5ae2da-lastActions[_0x3b1387(0x11c)+_0x2c05bc]<RESCUE_LOCK_MS)continue;const _0x8f4480=_0x58cf44['find'](_0x58ea0b=>normalize(_0x58ea0b[_0x3b1387(0x124)])===normalize(_0x2c05bc)&&(_0x58ea0b[_0x3b1387(0x152)]===_0x3b1387(0x150)||_0x58ea0b[_0x3b1387(0x152)]===_0x3b1387(0x156)));if(!_0x8f4480)continue;const _0x48f64f=await findRelatedId(_0x208a99,_0x8f4480['id'],'setpoint');if(_0x48f64f){if(lastActions[_0x3b1387(0x110)+_0x2c05bc]&&_0x5ae2da-lastActions[_0x3b1387(0x110)+_0x2c05bc]<0x1e*0x3c*0x3e8)continue;const _0x45f0f4=await _0x208a99[_0x3b1387(0x171)](_0x48f64f);if(_0x45f0f4&&typeof _0x45f0f4[_0x3b1387(0xee)]==='number'){const _0x5055e8=_0x45f0f4[_0x3b1387(0xee)];_0x5055e8!==ECO_TEMP&&await manageMpcIntervention(_0x208a99,_0x2c05bc,_0x3b1387(0x13e));if(_0x12e982>0x1e)_0x5055e8>ECO_TEMP+0.5&&(_0x208a99['log']['info']('üçÉ\x20[MPC\x20ACTION]\x20Senke\x20'+_0x2c05bc+_0x3b1387(0x12d)+ECO_TEMP+_0x3b1387(0x10f)+_0x12e982+_0x3b1387(0xfb)),await _0x208a99['setForeignStateAsync'](_0x48f64f,ECO_TEMP),await manageMpcIntervention(_0x208a99,_0x2c05bc,_0x3b1387(0x107)),lastActions[_0x3b1387(0x110)+_0x2c05bc]=_0x5ae2da,await logAutomationAction(_0x208a99,_0x3b1387(0x14d)+_0x2c05bc+_0x3b1387(0xef)+ECO_TEMP+'¬∞C'));else _0x12e982<=0xf&&(_0x5055e8<_0x27c74e&&(_0x208a99[_0x3b1387(0x117)][_0x3b1387(0x10c)](_0x3b1387(0x120)+_0x2c05bc+_0x3b1387(0x11b)+_0x27c74e+_0x3b1387(0x13f)),await _0x208a99[_0x3b1387(0x153)](_0x48f64f,_0x27c74e),await manageMpcIntervention(_0x208a99,_0x2c05bc,'remove'),lastActions[_0x3b1387(0x110)+_0x2c05bc]=_0x5ae2da,await logAutomationAction(_0x208a99,'[MPC]\x20'+_0x2c05bc+_0x3b1387(0x143)+_0x27c74e+'¬∞C')));}}else _0x208a99[_0x3b1387(0x117)][_0x3b1387(0x165)]('[MPC\x20WARNING]\x20Kein\x20Setpoint\x20f√ºr\x20'+_0x2c05bc+_0x3b1387(0x132));}}module[a1_0x29be8b(0x168)]={'handlePrediction':handlePrediction,'applyEnergySavings':applyEnergySavings,'scanThermostats':scanThermostats,'checkCalendarTriggers':checkCalendarTriggers,'updateSchedulePreview':updateSchedulePreview,'cleanupGhostInterventions':cleanupGhostInterventions};function a1_0x37a2(){const _0x1654ff=['\x20ist\x20auf\x20','level.valve',':\x20Puffer\x20leer\x20->\x20Heizen\x20auf\x20','open','4559132Rkrnrt','stringify','toUpperCase','(((.+)+)+)+$','apply','forEach','filter','üéì\x20[RL-FEEDBACK]\x20Lerne\x20aus\x20Fehler:\x20','switch','too_cold','urlaub\x20ende','408428kAtreH','parse','üìÖ\x20SMART\x20SCHEDULE\x20[','ankunft','valve_position','reason','normal','replace','val',':\x20Absenkung\x20auf\x20','manual','pi_heating_demand','\x20wurde\x20manuell\x20erh√∂ht.','number','sort',']:\x20Raum-Trigger\x20\x27','5434093ykUsjf','6RPRCRJ','stellwert','\x20min).','\x27\x20aktiv.\x20Heize\x20auf\x20','\x20min)','\x20erreicht\x20Limit\x20(','.1.LEVEL','Ist','join','Classic','Fehlt','set','currentSystemMode','r√ºckkehr','constructor','push','add','name','11502040XVrfFE','üìÖ\x20SMART\x20SCHEDULE\x20(Phase):\x20\x27Globaler\x20Start\x27\x20erkannt.\x20Heize\x20Haus\x20auf\x20(Vorlauf:\x20','includes','info','split','getForeignObjectsAsync','¬∞C!\x20(Puffer:\x20','mpc_','Soll','toString','\x20->\x20','window','actual','\x27\x20hat\x20kein\x20Ger√§t\x20mehr.\x20L√∂sche\x20Eintrag.','log','setpoint','./ai_agent','role','\x20wieder\x20auf\x20','rescue_','summary','¬∞C\x20<\x20','messwert','üî•\x20[MPC\x20ACTION]\x20Heize\x20','analysis.energy.mpcActiveInterventions','ACTUAL','approved','location','811740hHyqwV','minutes_safe','values','\x20ist\x20zu\x20kalt,\x20ABER\x20Fenster\x20offen/L√ºftung\x20erkannt.\x20Heize\x20NICHT,\x20entferne\x20nur\x20Status.','calendarInstance','devices','sensor','find','\x20auf\x20','eventStart','level.temperature','.1.SET_POINT_TEMPERATURE','default','\x20gefunden!','level','entries','localeCompare','toLowerCase','cal_','target','¬∞C\x20(via\x20','state','score','event','analysis.energy.ventilationAlerts','remove','¬∞C!\x20(Puffer\x20leer).','getTime','write','Unbekannt',':\x20Aufheizen\x20auf\x20','analysis.automation.confidenceThreshold','triggerTime','SET_POINT_TEMPERATURE','date','slice','valveMapping','setStateAsync','splice','analysis.energy.warmupTimes','[MPC]\x20','1951855LQHjDp','TRAIN_RL_PENALTY','temperature','30WOGGZn','type','setForeignStateAsync','thermostatMapping','position','thermostat','[WATCHDOG]\x20','Nicht\x20gefunden','üßπ\x20[MPC\x20CLEANUP]\x20','valve','analysis.energy.schedulePreview','value.valve','unshift','analysis.automation.mode','.4.VALVE_STATE','off','openknx','unit','search','Auto-Erkennung','warn','üìÖ\x20[MPC\x20INFO]\x20','sendToPythonWrapper','exports','common','isArray','Pr√§diktion:\x20','_date','string','trim','_calName','wert','getForeignStateAsync','Calendar\x20Check\x20Error:\x20','analysis.energy.warmupTargets','4WrrfIv','from','getForeignObjectAsync','.4.SET_TEMPERATURE','config','.1.TEMPERATURE','¬∞C).\x20Entferne\x20Status.','calendarSelection','useCalendar','.data.table','length','soll','¬∞C).\x20Sparmodus\x20beendet!','system.mode','PERFECT','local_temperature','analysis.automation.actionLog','now','5394771BohYYv','getStateAsync','current_heating_setpoint','room'];a1_0x37a2=function(){return _0x1654ff;};return a1_0x37a2();}