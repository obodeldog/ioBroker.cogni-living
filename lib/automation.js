function a1_0x35f4(){const _0x443740=['switch','minutes_safe','push','search','99458KCIQYR','reason','current_heating_setpoint','openknx','Fehlt','SET_POINT_TEMPERATURE','toString','config','Nicht\x20gefunden','sensor',':\x20-1Â°C\x20(Sparpotenzial\x20genutzt)','devices','occupied_heating_setpoint','11vbtoyb','toLowerCase','mpc_','Ist','val','ðŸƒ\x20MPC\x20Autonomy:\x20Senke\x20','filter','setForeignStateAsync','constructor','parse','wert','light','state','location','Unbekannt','thermostat.setpoint','Error\x20in\x20sibling\x20search:\x20','.1.ACTUAL_TEMPERATURE','log','\x20min)','length','5644072GAZRsD','apply','exports','temp','off','SET','score','local_temperature','Soll','[MPC]\x20','hm-rpc','.1.TEMPERATURE','3627246KBmFnD','localeCompare','sort','find','522438ctHHNS','type','\x20->\x20Schalte\x20','replace','common','getForeignStateAsync','soll','debug','messwert','temperature','includes','info','thermostatMapping','warn','PrÃ¤diktion:\x20','analysis.automation.mode','active','target','(((.+)+)+)+$','analysis.automation.confidenceThreshold','approved','entries','now','.4.SET_TEMPERATURE','split',')\x20auf\x20','2213110rprnCu','message','string','consultButler','room','toUpperCase','getForeignObjectsAsync','level.temperature','name','ACTUAL','analysis.automation.lastAction','dimmer','actual','forEach','getForeignObjectAsync','number','305016wLgWEz','.1.SET_POINT_TEMPERATURE','1996602fiYLmr','map','./ai_agent','ist','setStateAsync','getStateAsync'];a1_0x35f4=function(){return _0x443740;};return a1_0x35f4();}const a1_0x36e2ba=a1_0x13b6;(function(_0x1aa961,_0x552043){const _0x5a3bcb=a1_0x13b6,_0x55e552=_0x1aa961();while(!![]){try{const _0x1d24e6=parseInt(_0x5a3bcb(0x1f4))/0x1*(-parseInt(_0x5a3bcb(0x1e7))/0x2)+parseInt(_0x5a3bcb(0x1dd))/0x3+parseInt(_0x5a3bcb(0x1db))/0x4+parseInt(_0x5a3bcb(0x1cb))/0x5+-parseInt(_0x5a3bcb(0x1b1))/0x6+parseInt(_0x5a3bcb(0x1ad))/0x7+-parseInt(_0x5a3bcb(0x1a1))/0x8;if(_0x1d24e6===_0x552043)break;else _0x55e552['push'](_0x55e552['shift']());}catch(_0x55aac0){_0x55e552['push'](_0x55e552['shift']());}}}(a1_0x35f4,0x589eb));const a1_0x1c8a70=(function(){let _0x2bff86=!![];return function(_0x23a731,_0x1c7e06){const _0x26f536=_0x2bff86?function(){const _0x1a2e31=a1_0x13b6;if(_0x1c7e06){const _0x21cd7e=_0x1c7e06[_0x1a2e31(0x1a2)](_0x23a731,arguments);return _0x1c7e06=null,_0x21cd7e;}}:function(){};return _0x2bff86=![],_0x26f536;};}()),a1_0x5bb04e=a1_0x1c8a70(this,function(){const _0x83f315=a1_0x13b6;return a1_0x5bb04e[_0x83f315(0x1ed)]()[_0x83f315(0x1e6)](_0x83f315(0x1c3))[_0x83f315(0x1ed)]()[_0x83f315(0x194)](a1_0x5bb04e)['search'](_0x83f315(0x1c3));});a1_0x5bb04e();function a1_0x13b6(_0x484da8,_0x1a6320){const _0x5c35e6=a1_0x35f4();return a1_0x13b6=function(_0x5bb04e,_0x1c8a70){_0x5bb04e=_0x5bb04e-0x18e;let _0x35f447=_0x5c35e6[_0x5bb04e];return _0x35f447;},a1_0x13b6(_0x484da8,_0x1a6320);}'use strict';const aiAgent=require(a1_0x36e2ba(0x1df)),COOLDOWN_MS=0x3c*0x3e8,lastActions={};function normalize(_0xbcf44b){const _0x5b4c41=a1_0x36e2ba;if(!_0xbcf44b)return'';return _0xbcf44b[_0x5b4c41(0x1f5)]()[_0x5b4c41(0x1b4)](/\s+/g,'')['trim']();}async function handlePrediction(_0x5bd3d3,_0x49073a,_0x123e37){const _0x566840=a1_0x36e2ba;if(!_0x49073a||_0x49073a==='Unknown')return;let _0x445a60=_0x566840(0x1a5),_0x214998=0.6;try{const _0x21c144=await _0x5bd3d3[_0x566840(0x1e2)](_0x566840(0x1c0));if(_0x21c144&&_0x21c144[_0x566840(0x190)])_0x445a60=_0x21c144[_0x566840(0x190)];const _0x288139=await _0x5bd3d3['getStateAsync'](_0x566840(0x1c4));if(_0x288139&&_0x288139[_0x566840(0x190)])_0x214998=_0x288139[_0x566840(0x190)];}catch(_0x1b5ba){}if(_0x445a60===_0x566840(0x1a5)||_0x123e37<_0x214998)return;const _0x4cdc01=Date[_0x566840(0x1c7)]();if(lastActions[_0x49073a]&&_0x4cdc01-lastActions[_0x49073a]<COOLDOWN_MS)return;const _0x4e3559=_0x5bd3d3[_0x566840(0x1ee)][_0x566840(0x1f2)]||[],_0x400f0d=normalize(_0x49073a),_0x1ba60f=_0x4e3559[_0x566840(0x1b0)](_0x3e0de7=>normalize(_0x3e0de7['location'])===_0x400f0d&&(_0x3e0de7[_0x566840(0x1b2)]===_0x566840(0x197)||_0x3e0de7[_0x566840(0x1b2)]===_0x566840(0x1d6)||_0x3e0de7[_0x566840(0x1b2)]===_0x566840(0x1e3)));if(!_0x1ba60f){_0x5bd3d3[_0x566840(0x19e)][_0x566840(0x1b8)]('ðŸ”\x20Device-Search\x20failed\x20for\x20predicted\x20room\x20\x27'+_0x49073a+'\x27.');return;}const _0x1c0509=await aiAgent[_0x566840(0x1ce)](_0x5bd3d3,_0x49073a,_0x1ba60f[_0x566840(0x1d3)],_0x123e37);if(!_0x1c0509[_0x566840(0x1c5)])return;const _0x231447=_0x566840(0x1bf)+_0x49073a+_0x566840(0x1b3)+_0x1ba60f[_0x566840(0x1d3)]+'\x20('+_0x1c0509[_0x566840(0x1e8)]+')';await _0x5bd3d3[_0x566840(0x1e1)]('analysis.automation.lastAction',{'val':'['+_0x445a60[_0x566840(0x1d0)]()+']\x20'+_0x231447,'ack':!![]});if(_0x445a60===_0x566840(0x1c1)){const _0x1cda47=await _0x5bd3d3[_0x566840(0x1b6)](_0x1ba60f['id']);(!_0x1cda47||!_0x1cda47['val']&&_0x1cda47[_0x566840(0x190)]!==!![])&&await _0x5bd3d3[_0x566840(0x193)](_0x1ba60f['id'],!![]),lastActions[_0x49073a]=_0x4cdc01;}}async function findSetpointId(_0x5b522e,_0x577e4b){const _0x2c94e4=a1_0x36e2ba;if(_0x5b522e[_0x2c94e4(0x1ee)][_0x2c94e4(0x1bd)]){let _0x58b9b0=_0x5b522e[_0x2c94e4(0x1ee)][_0x2c94e4(0x1bd)];if(typeof _0x58b9b0===_0x2c94e4(0x1cd))try{_0x58b9b0=JSON[_0x2c94e4(0x195)](_0x58b9b0);}catch(_0x2a4f35){_0x58b9b0={};}if(_0x58b9b0&&_0x58b9b0[_0x577e4b])return _0x58b9b0[_0x577e4b];}const _0x4c5937=[{'s':_0x2c94e4(0x19d),'t':_0x2c94e4(0x1dc)},{'s':_0x2c94e4(0x1ac),'t':_0x2c94e4(0x1c8)},{'s':'ACTUAL_TEMPERATURE','t':_0x2c94e4(0x1ec)},{'s':_0x2c94e4(0x1a8),'t':_0x2c94e4(0x1f3)},{'s':'local_temperature','t':_0x2c94e4(0x1e9)},{'s':_0x2c94e4(0x1ba),'t':'target_temperature'},{'s':_0x2c94e4(0x1d4),'t':_0x2c94e4(0x1a6)},{'s':_0x2c94e4(0x18f),'t':_0x2c94e4(0x1a9)},{'s':_0x2c94e4(0x1ba),'t':'setpoint'}];for(const _0x26003 of _0x4c5937){if(_0x577e4b[_0x2c94e4(0x1bb)](_0x26003['s'])){const _0xfd4ab2=_0x577e4b[_0x2c94e4(0x1b4)](_0x26003['s'],_0x26003['t']),_0x5281e6=await _0x5b522e[_0x2c94e4(0x1d9)](_0xfd4ab2);if(_0x5281e6)return _0xfd4ab2;}}try{const _0x480c2b=_0x577e4b[_0x2c94e4(0x1c9)]('.');if(_0x480c2b['length']>0x2){const _0x35892e=_0x480c2b['slice'](0x0,-0x1)['join']('.'),_0x18dcae=await _0x5b522e[_0x2c94e4(0x1d1)](_0x35892e+'.*'),_0x126ca6=[],_0x4a2df2=_0x577e4b[_0x2c94e4(0x1c9)](/[._]+/)[_0x2c94e4(0x192)](_0x40923b=>![_0x2c94e4(0x1ea),'0',_0x2c94e4(0x1ab),_0x2c94e4(0x1e0),_0x2c94e4(0x196),_0x2c94e4(0x1ba),_0x2c94e4(0x1d7),_0x2c94e4(0x1f0),_0x2c94e4(0x1b9),_0x2c94e4(0x198)][_0x2c94e4(0x1bb)](_0x40923b['toLowerCase']()));for(const [_0x3b98e8,_0x16480a]of Object[_0x2c94e4(0x1c6)](_0x18dcae)){if(_0x3b98e8===_0x577e4b)continue;if(_0x16480a&&_0x16480a[_0x2c94e4(0x1b5)]&&_0x16480a['common']['write']===!![]){const _0x1ca56a=_0x3b98e8['toLowerCase'](),_0x20f213=(_0x16480a[_0x2c94e4(0x1b5)]['role']||'')[_0x2c94e4(0x1f5)](),_0x741060=_0x1ca56a[_0x2c94e4(0x1bb)]('set')||_0x1ca56a[_0x2c94e4(0x1bb)](_0x2c94e4(0x1b7))||_0x1ca56a[_0x2c94e4(0x1bb)](_0x2c94e4(0x1c2))||_0x20f213[_0x2c94e4(0x1bb)](_0x2c94e4(0x1d2))||_0x20f213['includes'](_0x2c94e4(0x19b));if(_0x741060){const _0x451e21=_0x3b98e8[_0x2c94e4(0x1c9)](/[._]+/)[_0x2c94e4(0x1de)](_0x31d627=>_0x31d627[_0x2c94e4(0x1f5)]());let _0x40d6cf=0x0;_0x4a2df2[_0x2c94e4(0x1d8)](_0x3f0c7c=>{const _0x2b9ea1=_0x2c94e4;if(_0x451e21[_0x2b9ea1(0x1bb)](_0x3f0c7c[_0x2b9ea1(0x1f5)]()))_0x40d6cf++;}),_0x126ca6[_0x2c94e4(0x1e5)]({'id':_0x3b98e8,'score':_0x40d6cf});}}}if(_0x126ca6[_0x2c94e4(0x1a0)]>0x0){_0x126ca6[_0x2c94e4(0x1af)]((_0x30a8c8,_0x359183)=>_0x359183[_0x2c94e4(0x1a7)]-_0x30a8c8['score']);const _0x454b46=_0x126ca6[0x0];if(_0x454b46[_0x2c94e4(0x1a7)]>0x0)return _0x454b46['id'];}}}catch(_0x1405f9){_0x5b522e[_0x2c94e4(0x19e)][_0x2c94e4(0x1be)](_0x2c94e4(0x19c)+_0x1405f9[_0x2c94e4(0x1cc)]);}return null;}async function scanThermostats(_0x323e23){const _0x15aca7=a1_0x36e2ba,_0x53fe14=_0x323e23[_0x15aca7(0x1ee)]['devices']||[],_0x36ed38=[],_0x4cbace=_0x53fe14[_0x15aca7(0x192)](_0x4efc99=>_0x4efc99['id']&&_0x4efc99['id'][_0x15aca7(0x1bb)]('temperature')||_0x4efc99['type']&&[_0x15aca7(0x1ba),'thermostat','sensor']['includes'](_0x4efc99['type'])||_0x4efc99[_0x15aca7(0x1d3)]&&_0x4efc99[_0x15aca7(0x1d3)][_0x15aca7(0x1f5)]()[_0x15aca7(0x1bb)](_0x15aca7(0x1a4)));for(const _0x571864 of _0x4cbace){const _0x1c29c3=await findSetpointId(_0x323e23,_0x571864['id']);let _0x8cf14e=_0x15aca7(0x1ef),_0x1c8ac0=![],_0x2782c6=_0x323e23['config'][_0x15aca7(0x1bd)]||{};if(typeof _0x2782c6===_0x15aca7(0x1cd))try{_0x2782c6=JSON[_0x15aca7(0x195)](_0x2782c6);}catch(_0x215e3c){}if(_0x2782c6[_0x571864['id']]&&_0x2782c6[_0x571864['id']]===_0x1c29c3)_0x8cf14e='Manuelles\x20Mapping',_0x1c8ac0=!![];else _0x1c29c3&&(_0x8cf14e='Auto-Erkennung');_0x36ed38[_0x15aca7(0x1e5)]({'room':_0x571864[_0x15aca7(0x199)]||_0x15aca7(0x19a),'sensorId':_0x571864['id'],'setpointId':_0x1c29c3||'-','source':_0x8cf14e,'isManual':_0x1c8ac0,'status':_0x1c29c3?'OK':_0x15aca7(0x1eb)});}return _0x36ed38[_0x15aca7(0x1af)]((_0x4ab05a,_0x2014e8)=>_0x4ab05a[_0x15aca7(0x1cf)][_0x15aca7(0x1ae)](_0x2014e8['room']));}async function applyEnergySavings(_0x5b4df9,_0x203ce2){const _0x716eee=a1_0x36e2ba,_0x5f50cc=_0x5b4df9[_0x716eee(0x1ee)][_0x716eee(0x1f2)]||[];for(const _0x5470ee of _0x203ce2){const _0x39f93b=_0x5470ee['room'],_0x1ed940=_0x5470ee[_0x716eee(0x1e4)],_0x59bcdb=Date['now']();if(lastActions['mpc_'+_0x39f93b]&&_0x59bcdb-lastActions[_0x716eee(0x18e)+_0x39f93b]<0x1e*0x3c*0x3e8)continue;const _0x34627a=_0x5f50cc[_0x716eee(0x1b0)](_0x547400=>normalize(_0x547400[_0x716eee(0x199)])===normalize(_0x39f93b));if(!_0x34627a)continue;const _0x2edb19=await findSetpointId(_0x5b4df9,_0x34627a['id']);if(_0x2edb19){const _0x11d159=await _0x5b4df9[_0x716eee(0x1b6)](_0x2edb19);if(_0x11d159&&typeof _0x11d159[_0x716eee(0x190)]===_0x716eee(0x1da)){const _0x1480f9=_0x11d159['val'];if(_0x1ed940>0x1e&&_0x1480f9>0x11){const _0x21d0f6=_0x1480f9-0x1;_0x5b4df9[_0x716eee(0x19e)][_0x716eee(0x1bc)](_0x716eee(0x191)+_0x39f93b+'\x20('+_0x2edb19+_0x716eee(0x1ca)+_0x21d0f6+'Â°C\x20(Coasting\x20mÃ¶glich:\x20'+_0x1ed940+_0x716eee(0x19f)),await _0x5b4df9[_0x716eee(0x193)](_0x2edb19,_0x21d0f6),lastActions[_0x716eee(0x18e)+_0x39f93b]=_0x59bcdb,await _0x5b4df9[_0x716eee(0x1e1)](_0x716eee(0x1d5),{'val':_0x716eee(0x1aa)+_0x39f93b+_0x716eee(0x1f1),'ack':!![]});}}}}}module[a1_0x36e2ba(0x1a3)]={'handlePrediction':handlePrediction,'applyEnergySavings':applyEnergySavings,'scanThermostats':scanThermostats};