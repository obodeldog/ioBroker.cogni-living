const a5_0x17e150=a5_0x566e;(function(_0x26bddc,_0x2e1f3a){const _0x3dcad1=a5_0x566e,_0x1affa8=_0x26bddc();while(!![]){try{const _0x575b6b=parseInt(_0x3dcad1(0x84))/0x1*(-parseInt(_0x3dcad1(0xad))/0x2)+-parseInt(_0x3dcad1(0x96))/0x3*(parseInt(_0x3dcad1(0x66))/0x4)+-parseInt(_0x3dcad1(0x65))/0x5*(-parseInt(_0x3dcad1(0x83))/0x6)+-parseInt(_0x3dcad1(0xb4))/0x7*(-parseInt(_0x3dcad1(0xa0))/0x8)+-parseInt(_0x3dcad1(0x81))/0x9+-parseInt(_0x3dcad1(0xa8))/0xa*(parseInt(_0x3dcad1(0x8e))/0xb)+parseInt(_0x3dcad1(0xba))/0xc*(parseInt(_0x3dcad1(0x9d))/0xd);if(_0x575b6b===_0x2e1f3a)break;else _0x1affa8['push'](_0x1affa8['shift']());}catch(_0x545dad){_0x1affa8['push'](_0x1affa8['shift']());}}}(a5_0x1baf,0x97baf));const a5_0x2bbc8b=(function(){let _0x1510ab=!![];return function(_0x4a3f92,_0x7c426f){const _0x405e7e=_0x1510ab?function(){const _0x1197ac=a5_0x566e;if(_0x7c426f){const _0x17cf4b=_0x7c426f[_0x1197ac(0x8d)](_0x4a3f92,arguments);return _0x7c426f=null,_0x17cf4b;}}:function(){};return _0x1510ab=![],_0x405e7e;};}()),a5_0x9d34c6=a5_0x2bbc8b(this,function(){const _0x446ab7=a5_0x566e;return a5_0x9d34c6[_0x446ab7(0x6c)]()[_0x446ab7(0x7c)]('(((.+)+)+)+$')[_0x446ab7(0x6c)]()[_0x446ab7(0x82)](a5_0x9d34c6)[_0x446ab7(0x7c)](_0x446ab7(0xcb));});a5_0x9d34c6();'use strict';const HISTORY_MAX_SIZE=0x32,RAW_LOG_MAX_SIZE=0x9c4,THERMO_LOG_SIZE=0x3e8,SEQUENCE_TIMEOUT_MS=0x5*0x3c*0x3e8,MAX_TRAINING_SET_SIZE=0x1f4,EXIT_TIMER_MINUTES=0xf,EXIT_GRACE_PERIOD_SECONDS=0x1e;let activeSequence=[],sequenceTimer=null;function a5_0x1baf(){const _0x1c9cde=['griff','isGracePeriodActive','apply','11014784jnyeUS','location','.1.TEMPERATURE','pop','.1.ACTUAL_TEMPERATURE','log','level','\x20from\x20','105wdxqjN','from','includes','length','error','round','.1.LEVEL','13gWeVqG','setStateAsync','number','45976MUWnhx','kontakt','LTM.trainingData.sequences','isProVersion','accuweather','STATUS','stringify','normal','10sfYNyK','door','val','präsenz','presence','411212LPOWjo','rawEventLog','contact','sendToPythonWrapper','klima','eventHistory','useWeather','1274ExCOkF','SIMULATE_SIGNAL','.ACTUAL_TEMPERATURE','toISOString','parse','valveMapping','16856364VpKJxX','map','licht','occupancy','tür','sensorLastValues','daswetter','fenster','LTM.rawEventLog','shift','weatherInstance','loc','push','temperature','lock','heizung','LTM.trainingData.thermodynamics','(((.+)+)+)+$','schalter','lastTrackerEventTime','.forecast.current.temp','motion','5qHusDo','102824MYRkaZ','isExit','now','dimmer','logDuplicates','lampe','toString','bewegung','toLowerCase','system.isPresent','events.lastEvent','getForeignStateAsync','switch','config','exitTimer','isPresent','type','splice','.Current.Temperature','.forecast.current.temperature','message','window','search','string','ANALYZE_SEQUENCE','TRACK_EVENT','.NextHours.Location_1.Day_1.current.temp_value','6690492tNpreU','constructor','7358940kkwWJW','2McoxKP','exports','currentSystemMode','exitGraceTimer','some','schloss','outdoorSensorId'];a5_0x1baf=function(){return _0x1c9cde;};return a5_0x1baf();}async function getOutsideTemperatureNumeric(_0x2501c3){const _0x13d5d8=a5_0x566e;if(_0x2501c3[_0x13d5d8(0x73)][_0x13d5d8(0x8a)])try{const _0x5a1de7=await _0x2501c3['getForeignStateAsync'](_0x2501c3['config']['outdoorSensorId']);if(_0x5a1de7&&_0x5a1de7[_0x13d5d8(0xaa)]!==undefined&&_0x5a1de7[_0x13d5d8(0xaa)]!==null)return parseFloat(_0x5a1de7[_0x13d5d8(0xaa)]);}catch(_0x3bffb7){}const _0x39e3d5=_0x2501c3['config'][_0x13d5d8(0xc4)];if(!_0x2501c3[_0x13d5d8(0x73)][_0x13d5d8(0xb3)]||!_0x39e3d5)return null;try{let _0xe4040='';if(_0x39e3d5[_0x13d5d8(0x98)](_0x13d5d8(0xa4)))_0xe4040=_0x39e3d5+_0x13d5d8(0x78);else{if(_0x39e3d5[_0x13d5d8(0x98)](_0x13d5d8(0xc0)))_0xe4040=_0x39e3d5+_0x13d5d8(0x80);else{if(_0x39e3d5['includes']('openweathermap'))_0xe4040=_0x39e3d5+_0x13d5d8(0x79);else{if(_0x39e3d5[_0x13d5d8(0x98)]('weatherunderground'))_0xe4040=_0x39e3d5+_0x13d5d8(0xce);}}}if(_0xe4040){const _0xc1ef5b=await _0x2501c3[_0x13d5d8(0x71)](_0xe4040);if(_0xc1ef5b&&_0xc1ef5b[_0x13d5d8(0xaa)]!==undefined&&_0xc1ef5b[_0x13d5d8(0xaa)]!==null)return parseFloat(_0xc1ef5b[_0x13d5d8(0xaa)]);}}catch(_0x2e9ddc){}return null;}async function recordThermodynamics(_0x491f1e,_0x192be7,_0xcdb007,_0x3e55a8){const _0x16eb8d=a5_0x566e,_0x4b106c=await getOutsideTemperatureNumeric(_0x491f1e);if(_0x4b106c===null)return;let _0x113d95=0x0,_0x361cbb=![];if(_0x491f1e[_0x16eb8d(0x73)][_0x16eb8d(0xb9)])try{let _0x894b5c=_0x491f1e[_0x16eb8d(0x73)][_0x16eb8d(0xb9)];if(typeof _0x894b5c===_0x16eb8d(0x7d))_0x894b5c=JSON['parse'](_0x894b5c);if(_0x894b5c[_0x192be7]){const _0x2e2985=_0x894b5c[_0x192be7],_0x57763e=await _0x491f1e[_0x16eb8d(0x71)](_0x2e2985);if(_0x57763e&&_0x57763e[_0x16eb8d(0xaa)]!==null&&_0x57763e[_0x16eb8d(0xaa)]!==undefined){let _0xc3d9fb=Number(_0x57763e[_0x16eb8d(0xaa)]);if(_0xc3d9fb<=1.05&&!_0x2e2985[_0x16eb8d(0x98)](_0x16eb8d(0xa5))&&!_0x2e2985['includes']('STATE'))_0xc3d9fb=_0xc3d9fb*0x64;_0x113d95=Math['round'](_0xc3d9fb),_0x361cbb=!![];}}}catch(_0x384e37){}if(!_0x361cbb){const _0x14be61=[{'from':_0x16eb8d(0x92),'to':_0x16eb8d(0x9c)},{'from':_0x16eb8d(0x92),'to':'.1.VALVE_STATE'},{'from':_0x16eb8d(0x90),'to':'.4.VALVE_STATE'},{'from':_0x16eb8d(0xb6),'to':'.LEVEL'},{'from':'temperature','to':_0x16eb8d(0x94)},{'from':'Temperature','to':'Valve'}];for(const _0x4f7334 of _0x14be61){if(_0x192be7[_0x16eb8d(0x98)](_0x4f7334[_0x16eb8d(0x97)])){const _0x1cd905=_0x192be7['replace'](_0x4f7334[_0x16eb8d(0x97)],_0x4f7334['to']);try{const _0x383403=await _0x491f1e[_0x16eb8d(0x71)](_0x1cd905);if(_0x383403&&_0x383403[_0x16eb8d(0xaa)]!==null&&_0x383403[_0x16eb8d(0xaa)]!==undefined){let _0x410abb=Number(_0x383403['val']);if(typeof _0x410abb===_0x16eb8d(0x9f)){if(_0x410abb<=1.05&&_0x4f7334['to'][_0x16eb8d(0x98)]('LEVEL'))_0x410abb=_0x410abb*0x64;_0x113d95=Math['round'](_0x410abb),_0x361cbb=!![];break;}}}catch(_0x4603c0){}}}}const _0x20176f=await _0x491f1e['getStateAsync'](_0x16eb8d(0xca));let _0x4109f1=[];if(_0x20176f&&_0x20176f[_0x16eb8d(0xaa)])try{_0x4109f1=JSON[_0x16eb8d(0xb8)](_0x20176f[_0x16eb8d(0xaa)]);}catch(_0x2d7a71){}_0x4109f1[_0x16eb8d(0xc6)]({'ts':Date[_0x16eb8d(0x68)](),'room':_0x3e55a8||'Unknown','t_in':_0xcdb007,'t_out':_0x4b106c,'valve':_0x113d95});if(_0x4109f1[_0x16eb8d(0x99)]>THERMO_LOG_SIZE)_0x4109f1[_0x16eb8d(0xc3)]();await _0x491f1e[_0x16eb8d(0x9e)](_0x16eb8d(0xca),{'val':JSON[_0x16eb8d(0xa6)](_0x4109f1),'ack':!![]});}function a5_0x566e(_0x427827,_0x9d84ea){const _0x4c8f51=a5_0x1baf();return a5_0x566e=function(_0x9d34c6,_0x2bbc8b){_0x9d34c6=_0x9d34c6-0x65;let _0x1baf88=_0x4c8f51[_0x9d34c6];return _0x1baf88;},a5_0x566e(_0x427827,_0x9d84ea);}async function saveCompletedSequence(_0x2dc798){const _0x2fa010=a5_0x566e;try{const _0x197149=await _0x2dc798['getStateAsync']('LTM.trainingData.sequences');let _0x305cde=[];if(_0x197149&&_0x197149[_0x2fa010(0xaa)])try{_0x305cde=JSON[_0x2fa010(0xb8)](_0x197149[_0x2fa010(0xaa)]);}catch(_0x38c84d){}const _0x11552f=activeSequence[0x0]['ts'],_0x203484=activeSequence[_0x2fa010(0xbb)](_0x4e50f6=>({'loc':_0x4e50f6[_0x2fa010(0xc5)],'t_delta':Math[_0x2fa010(0x9b)]((_0x4e50f6['ts']-_0x11552f)/0x3e8)})),_0x206670={'timestamp':new Date(_0x11552f)[_0x2fa010(0xb7)](),'steps':_0x203484,'duration':Math[_0x2fa010(0x9b)]((activeSequence[activeSequence[_0x2fa010(0x99)]-0x1]['ts']-_0x11552f)/0x3e8),'daytime':new Date(_0x11552f)['getHours']()};_0x305cde[_0x2fa010(0xc6)](_0x206670);if(_0x305cde['length']>MAX_TRAINING_SET_SIZE)_0x305cde[_0x2fa010(0xc3)]();await _0x2dc798[_0x2fa010(0x9e)](_0x2fa010(0xa2),{'val':JSON['stringify'](_0x305cde),'ack':!![]}),_0x2dc798[_0x2fa010(0xa3)]&&_0x2dc798[_0x2fa010(0xb0)]&&_0x2dc798[_0x2fa010(0xb0)](_0x2fa010(0x7e),{'sequence':_0x206670});}catch(_0x36ef78){_0x2dc798[_0x2fa010(0x93)][_0x2fa010(0x9a)]('[RECORDER]\x20Error:\x20'+_0x36ef78[_0x2fa010(0x7a)]);}}async function recordSequence(_0x394a56,_0x109c31){const _0x3d52cb=a5_0x566e,_0x4ab610=(_0x109c31[_0x3d52cb(0x76)]||'')[_0x3d52cb(0x6e)](),_0x3b45ef=['motion',_0x3d52cb(0x6d),_0x3d52cb(0xab),_0x3d52cb(0xac),_0x3d52cb(0xbd),'door','tür',_0x3d52cb(0x7b),_0x3d52cb(0xc1),_0x3d52cb(0xaf),_0x3d52cb(0xa1),'light','licht',_0x3d52cb(0x72),_0x3d52cb(0xcc),'dimmer',_0x3d52cb(0x6b)];if(!_0x3b45ef[_0x3d52cb(0x88)](_0x3bd562=>_0x4ab610[_0x3d52cb(0x98)](_0x3bd562)))return;if(!_0x109c31['value'])return;if(sequenceTimer)clearTimeout(sequenceTimer);activeSequence['push']({'loc':_0x109c31[_0x3d52cb(0x8f)]||'Unknown','id':_0x109c31['id'],'ts':Date[_0x3d52cb(0x68)]()}),sequenceTimer=setTimeout(async()=>{const _0x371e73=_0x3d52cb;if(activeSequence[_0x371e73(0x99)]>0x1)await saveCompletedSequence(_0x394a56);activeSequence=[];},SEQUENCE_TIMEOUT_MS);}function startExitTimer(_0x29c300){const _0x2f2348=a5_0x566e;abortExitTimer(_0x29c300),_0x29c300[_0x2f2348(0x8c)]=!![],_0x29c300['exitGraceTimer']=setTimeout(()=>{const _0x42ec6e=_0x2f2348;_0x29c300[_0x42ec6e(0x8c)]=![];},EXIT_GRACE_PERIOD_SECONDS*0x3e8),_0x29c300[_0x2f2348(0x74)]=setTimeout(()=>{const _0xfbfba4=_0x2f2348;setPresence(_0x29c300,![]),_0x29c300[_0xfbfba4(0x74)]=null;},EXIT_TIMER_MINUTES*0x3c*0x3e8);}function abortExitTimer(_0x187051){const _0x12d1c1=a5_0x566e;if(_0x187051[_0x12d1c1(0x74)])clearTimeout(_0x187051[_0x12d1c1(0x74)]);if(_0x187051[_0x12d1c1(0x87)])clearTimeout(_0x187051[_0x12d1c1(0x87)]);_0x187051[_0x12d1c1(0x74)]=null,_0x187051[_0x12d1c1(0x87)]=null,_0x187051[_0x12d1c1(0x8c)]=![];}async function setPresence(_0x24b527,_0xdfcebb){const _0xaeb69f=a5_0x566e;if(_0x24b527['isPresent']===_0xdfcebb)return;_0x24b527[_0xaeb69f(0x75)]=_0xdfcebb,await _0x24b527['setStateAsync'](_0xaeb69f(0x6f),{'val':_0xdfcebb,'ack':!![]});}async function processSensorEvent(_0x1f5de2,_0x2e28d5,_0x14de07,_0x437a20){const _0x3fb696=a5_0x566e;if(!_0x437a20)return null;const _0xdae3e2=_0x14de07[_0x3fb696(0xaa)],_0x107a1d=Date[_0x3fb696(0x68)](),_0x2b796a=_0x1f5de2['sensorLastValues'][_0x2e28d5],_0x16a032=(_0x437a20[_0x3fb696(0x76)]||'')[_0x3fb696(0x6e)](),_0x1fd9ec=_0x16a032[_0x3fb696(0x98)](_0x3fb696(0xc7))||_0x16a032[_0x3fb696(0x98)]('temperatur')||_0x16a032[_0x3fb696(0x98)](_0x3fb696(0xb1))||_0x16a032['includes'](_0x3fb696(0xc9))||_0x16a032['includes']('thermostat');if(_0x1fd9ec&&typeof _0xdae3e2==='number'){if(_0xdae3e2>0x50||_0xdae3e2<-0x32)return _0x1f5de2[_0x3fb696(0x93)]['debug']('[RECORDER]\x20Ignored\x20implausible\x20temperature:\x20'+_0xdae3e2+_0x3fb696(0x95)+_0x2e28d5),null;}_0x1f5de2[_0x3fb696(0xbf)][_0x2e28d5]=_0xdae3e2;if(!_0x437a20[_0x3fb696(0x6a)]&&_0x2b796a!=undefined&&_0x2b796a==_0xdae3e2)return null;_0x1f5de2[_0x3fb696(0xa3)]&&_0x1fd9ec&&recordThermodynamics(_0x1f5de2,_0x2e28d5,_0xdae3e2,_0x437a20[_0x3fb696(0x8f)]);const _0x559148={'timestamp':_0x107a1d,'id':_0x2e28d5,'name':_0x437a20['name'],'type':_0x437a20['type'],'location':_0x437a20[_0x3fb696(0x8f)],'value':_0xdae3e2};_0x1f5de2[_0x3fb696(0xb2)]['unshift'](_0x559148);if(_0x1f5de2['eventHistory'][_0x3fb696(0x99)]>HISTORY_MAX_SIZE)_0x1f5de2[_0x3fb696(0xb2)][_0x3fb696(0x91)]();await _0x1f5de2['setStateAsync'](_0x3fb696(0x70),{'val':JSON[_0x3fb696(0xa6)](_0x559148),'ack':!![]}),await _0x1f5de2[_0x3fb696(0x9e)]('events.history',{'val':JSON['stringify'](_0x1f5de2['eventHistory']),'ack':!![]});if(_0x1f5de2[_0x3fb696(0xa3)]){_0x1f5de2[_0x3fb696(0xae)][_0x3fb696(0xc6)](_0x559148);if(_0x1f5de2[_0x3fb696(0xae)][_0x3fb696(0x99)]>RAW_LOG_MAX_SIZE)_0x1f5de2[_0x3fb696(0xae)][_0x3fb696(0x77)](0x0,_0x1f5de2[_0x3fb696(0xae)][_0x3fb696(0x99)]-RAW_LOG_MAX_SIZE);await _0x1f5de2[_0x3fb696(0x9e)](_0x3fb696(0xc2),{'val':JSON[_0x3fb696(0xa6)](_0x1f5de2[_0x3fb696(0xae)]),'ack':!![]}),recordSequence(_0x1f5de2,_0x559148);}if(_0x437a20[_0x3fb696(0x67)]&&_0xdae3e2===!![]){if(_0x1f5de2['isPresent']&&!_0x1f5de2['isGracePeriodActive'])startExitTimer(_0x1f5de2);else{if(!_0x1f5de2[_0x3fb696(0x75)])setPresence(_0x1f5de2,!![]);}}else{if(_0x437a20[_0x3fb696(0x76)]===_0x3fb696(0xcf)&&_0xdae3e2===!![]){if(_0x1f5de2[_0x3fb696(0x74)])abortExitTimer(_0x1f5de2);if(!_0x1f5de2['isPresent']&&_0x1f5de2[_0x3fb696(0x86)]===_0x3fb696(0xa7))setPresence(_0x1f5de2,!![]);}}if(_0x1f5de2[_0x3fb696(0xa3)]&&_0x1f5de2[_0x3fb696(0xb0)]){_0x437a20['type']===_0x3fb696(0xcf)&&_0xdae3e2===!![]&&_0x437a20[_0x3fb696(0x8f)]&&_0x1f5de2[_0x3fb696(0xb0)](_0x3fb696(0xb5),{'room':_0x437a20[_0x3fb696(0x8f)]});const _0x1f9680=[_0x3fb696(0xa9),_0x3fb696(0xbe),_0x3fb696(0x7b),_0x3fb696(0xc1),_0x3fb696(0x8b),'handle',_0x3fb696(0xc8),_0x3fb696(0x89)][_0x3fb696(0x88)](_0x586272=>_0x16a032['includes'](_0x586272)),_0x47988e=['light',_0x3fb696(0xbc),'switch',_0x3fb696(0xcc),_0x3fb696(0x69),_0x3fb696(0x6b)][_0x3fb696(0x88)](_0xf2b5ee=>_0x16a032[_0x3fb696(0x98)](_0xf2b5ee)),_0x42166d=[_0x3fb696(0xcf),_0x3fb696(0x6d),_0x3fb696(0xab),_0x3fb696(0xac),'occupancy']['some'](_0x25d578=>_0x16a032['includes'](_0x25d578));if(_0x437a20[_0x3fb696(0x8f)]&&(_0x1f9680||_0x47988e||_0x42166d)){const _0x1a7ac0=_0xdae3e2===!![]||typeof _0xdae3e2==='number'&&_0xdae3e2>0x0,_0x18c10e=_0x1f9680&&!_0x1a7ac0&&_0x2b796a!==undefined&&_0x2b796a!=_0xdae3e2;if(_0x1a7ac0||_0x18c10e){const _0x1a8e75=_0x1f5de2[_0x3fb696(0xcd)]||_0x107a1d,_0x19d8ac=(_0x107a1d-_0x1a8e75)/0x3e8;_0x1f5de2[_0x3fb696(0xcd)]=_0x107a1d,_0x1f5de2[_0x3fb696(0xb0)](_0x3fb696(0x7f),{'room':_0x437a20['location'],'dt':_0x19d8ac});}}}return _0x559148;}module[a5_0x17e150(0x85)]={'processSensorEvent':processSensorEvent,'getOutsideTemperatureNumeric':getOutsideTemperatureNumeric,'setPresence':setPresence,'abortExitTimer':abortExitTimer,'startExitTimer':startExitTimer};