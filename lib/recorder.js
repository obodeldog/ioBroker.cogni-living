const a5_0x5a02b4=a5_0x43b1;(function(_0x3eb3b9,_0x5494e){const _0x17d63e=a5_0x43b1,_0x12a89f=_0x3eb3b9();while(!![]){try{const _0x4fc2fc=-parseInt(_0x17d63e(0x18a))/0x1*(parseInt(_0x17d63e(0x1a3))/0x2)+parseInt(_0x17d63e(0x143))/0x3+-parseInt(_0x17d63e(0x19d))/0x4+parseInt(_0x17d63e(0x198))/0x5+-parseInt(_0x17d63e(0x1a0))/0x6+parseInt(_0x17d63e(0x181))/0x7*(parseInt(_0x17d63e(0x142))/0x8)+parseInt(_0x17d63e(0x14a))/0x9;if(_0x4fc2fc===_0x5494e)break;else _0x12a89f['push'](_0x12a89f['shift']());}catch(_0x3e7027){_0x12a89f['push'](_0x12a89f['shift']());}}}(a5_0x5f22,0x508fc));const a5_0x2edda9=(function(){let _0x56ffcd=!![];return function(_0x54ea82,_0x5df56c){const _0x4b9068=_0x56ffcd?function(){if(_0x5df56c){const _0x837e3e=_0x5df56c['apply'](_0x54ea82,arguments);return _0x5df56c=null,_0x837e3e;}}:function(){};return _0x56ffcd=![],_0x4b9068;};}()),a5_0x217132=a5_0x2edda9(this,function(){const _0x5ad745=a5_0x43b1;return a5_0x217132['toString']()[_0x5ad745(0x16a)]('(((.+)+)+)+$')[_0x5ad745(0x151)]()['constructor'](a5_0x217132)['search'](_0x5ad745(0x160));});a5_0x217132();'use strict';const HISTORY_MAX_SIZE=0x32,RAW_LOG_MAX_SIZE=0x9c4,THERMO_LOG_SIZE=0x3e8,SEQUENCE_TIMEOUT_MS=0x5*0x3c*0x3e8,MAX_TRAINING_SET_SIZE=0x1f4,EXIT_TIMER_MINUTES=0xf,EXIT_GRACE_PERIOD_SECONDS=0x1e;let activeSequence=[],sequenceTimer=null;async function getOutsideTemperatureNumeric(_0x1c419c){const _0x468cfb=a5_0x43b1;if(_0x1c419c['config'][_0x468cfb(0x148)])try{const _0xe2e2dc=await _0x1c419c['getForeignStateAsync'](_0x1c419c['config'][_0x468cfb(0x148)]);if(_0xe2e2dc&&_0xe2e2dc[_0x468cfb(0x165)]!==undefined&&_0xe2e2dc[_0x468cfb(0x165)]!==null)return parseFloat(_0xe2e2dc['val']);}catch(_0x59bfb3){}const _0x54b6d3=_0x1c419c[_0x468cfb(0x191)][_0x468cfb(0x187)];if(!_0x1c419c['config']['useWeather']||!_0x54b6d3)return null;try{let _0x1a49bc='';if(_0x54b6d3[_0x468cfb(0x1ab)](_0x468cfb(0x1af)))_0x1a49bc=_0x54b6d3+_0x468cfb(0x162);else{if(_0x54b6d3['includes']('daswetter'))_0x1a49bc=_0x54b6d3+_0x468cfb(0x164);else{if(_0x54b6d3[_0x468cfb(0x1ab)]('openweathermap'))_0x1a49bc=_0x54b6d3+'.forecast.current.temperature';else{if(_0x54b6d3['includes'](_0x468cfb(0x1a6)))_0x1a49bc=_0x54b6d3+_0x468cfb(0x172);}}}if(_0x1a49bc){const _0x479f6b=await _0x1c419c['getForeignStateAsync'](_0x1a49bc);if(_0x479f6b&&_0x479f6b[_0x468cfb(0x165)]!==undefined&&_0x479f6b[_0x468cfb(0x165)]!==null)return parseFloat(_0x479f6b[_0x468cfb(0x165)]);}}catch(_0x3dda98){}return null;}async function recordThermodynamics(_0x4b321a,_0x48dace,_0x28d9a2,_0x391897){const _0x33926=a5_0x43b1,_0x445c96=await getOutsideTemperatureNumeric(_0x4b321a);if(_0x445c96===null)return;let _0x52e6bf=0x0,_0x36d077=![];if(_0x4b321a[_0x33926(0x191)][_0x33926(0x14c)])try{let _0x22b08a=_0x4b321a[_0x33926(0x191)][_0x33926(0x14c)];if(typeof _0x22b08a===_0x33926(0x17a))_0x22b08a=JSON['parse'](_0x22b08a);if(_0x22b08a[_0x48dace]){const _0x22d036=_0x22b08a[_0x48dace],_0x1b090f=await _0x4b321a['getForeignStateAsync'](_0x22d036);if(_0x1b090f&&_0x1b090f['val']!==null&&_0x1b090f['val']!==undefined){let _0x566478=Number(_0x1b090f[_0x33926(0x165)]);if(_0x566478<=1.05&&!_0x22d036[_0x33926(0x1ab)](_0x33926(0x144))&&!_0x22d036[_0x33926(0x1ab)](_0x33926(0x174)))_0x566478=_0x566478*0x64;_0x52e6bf=Math[_0x33926(0x199)](_0x566478),_0x36d077=!![];}}}catch(_0x1bb986){}if(!_0x36d077){const _0xb576ff=[{'from':'.1.ACTUAL_TEMPERATURE','to':_0x33926(0x19f)},{'from':_0x33926(0x173),'to':_0x33926(0x15e)},{'from':_0x33926(0x176),'to':_0x33926(0x17f)},{'from':_0x33926(0x1ae),'to':'.LEVEL'},{'from':'temperature','to':_0x33926(0x166)},{'from':_0x33926(0x18e),'to':_0x33926(0x192)}];for(const _0x4d9749 of _0xb576ff){if(_0x48dace[_0x33926(0x1ab)](_0x4d9749[_0x33926(0x168)])){const _0x1932e6=_0x48dace[_0x33926(0x18c)](_0x4d9749['from'],_0x4d9749['to']);try{const _0x421253=await _0x4b321a[_0x33926(0x18d)](_0x1932e6);if(_0x421253&&_0x421253['val']!==null&&_0x421253[_0x33926(0x165)]!==undefined){let _0x4b16cd=Number(_0x421253[_0x33926(0x165)]);if(typeof _0x4b16cd===_0x33926(0x14d)){if(_0x4b16cd<=1.05&&_0x4d9749['to'][_0x33926(0x1ab)]('LEVEL'))_0x4b16cd=_0x4b16cd*0x64;_0x52e6bf=Math[_0x33926(0x199)](_0x4b16cd),_0x36d077=!![];break;}}}catch(_0xc46e1e){}}}}const _0x448b98=await _0x4b321a[_0x33926(0x158)](_0x33926(0x16f));let _0x1c7349=[];if(_0x448b98&&_0x448b98[_0x33926(0x165)])try{_0x1c7349=JSON[_0x33926(0x1a5)](_0x448b98[_0x33926(0x165)]);}catch(_0x58fc09){}_0x1c7349[_0x33926(0x169)]({'ts':Date[_0x33926(0x149)](),'room':_0x391897||_0x33926(0x14e),'t_in':_0x28d9a2,'t_out':_0x445c96,'valve':_0x52e6bf});if(_0x1c7349[_0x33926(0x16e)]>THERMO_LOG_SIZE)_0x1c7349[_0x33926(0x183)]();await _0x4b321a['setStateAsync'](_0x33926(0x16f),{'val':JSON['stringify'](_0x1c7349),'ack':!![]});}async function saveCompletedSequence(_0x47668d){const _0xec7854=a5_0x43b1;try{const _0x28d37d=await _0x47668d[_0xec7854(0x158)]('LTM.trainingData.sequences');let _0x242c3d=[];if(_0x28d37d&&_0x28d37d['val'])try{_0x242c3d=JSON[_0xec7854(0x1a5)](_0x28d37d[_0xec7854(0x165)]);}catch(_0x4cc175){}const _0x4bc0bb=activeSequence[0x0]['ts'],_0x273278=activeSequence[_0xec7854(0x154)](_0x4fdf12=>({'loc':_0x4fdf12[_0xec7854(0x170)],'t_delta':Math[_0xec7854(0x199)]((_0x4fdf12['ts']-_0x4bc0bb)/0x3e8)})),_0x4a7c1a={'timestamp':new Date(_0x4bc0bb)[_0xec7854(0x16d)](),'steps':_0x273278,'duration':Math[_0xec7854(0x199)]((activeSequence[activeSequence[_0xec7854(0x16e)]-0x1]['ts']-_0x4bc0bb)/0x3e8),'daytime':new Date(_0x4bc0bb)['getHours']()};_0x242c3d[_0xec7854(0x169)](_0x4a7c1a);if(_0x242c3d[_0xec7854(0x16e)]>MAX_TRAINING_SET_SIZE)_0x242c3d['shift']();await _0x47668d[_0xec7854(0x179)](_0xec7854(0x175),{'val':JSON[_0xec7854(0x157)](_0x242c3d),'ack':!![]}),_0x47668d[_0xec7854(0x1a2)]&&_0x47668d[_0xec7854(0x182)]&&_0x47668d[_0xec7854(0x182)](_0xec7854(0x1a8),{'sequence':_0x4a7c1a});}catch(_0x19143f){_0x47668d[_0xec7854(0x163)][_0xec7854(0x190)](_0xec7854(0x16b)+_0x19143f['message']);}}async function recordSequence(_0x4e1bba,_0x99edbb){const _0x58d824=a5_0x43b1,_0x313fa4=(_0x99edbb[_0x58d824(0x15a)]||'')[_0x58d824(0x180)](),_0x298fb4=[_0x58d824(0x150),'bewegung','präsenz',_0x58d824(0x177),_0x58d824(0x186),_0x58d824(0x189),_0x58d824(0x185),_0x58d824(0x17b),_0x58d824(0x15c),'contact',_0x58d824(0x195),_0x58d824(0x184),_0x58d824(0x17e),_0x58d824(0x19b),_0x58d824(0x1a7),_0x58d824(0x171),_0x58d824(0x1a4)];if(!_0x298fb4['some'](_0x14cbf3=>_0x313fa4['includes'](_0x14cbf3)))return;if(!_0x99edbb[_0x58d824(0x155)])return;if(sequenceTimer)clearTimeout(sequenceTimer);activeSequence[_0x58d824(0x169)]({'loc':_0x99edbb[_0x58d824(0x15b)]||_0x58d824(0x14e),'id':_0x99edbb['id'],'ts':Date[_0x58d824(0x149)]()}),sequenceTimer=setTimeout(async()=>{const _0x1bba19=_0x58d824;if(activeSequence[_0x1bba19(0x16e)]>0x1)await saveCompletedSequence(_0x4e1bba);activeSequence=[];},SEQUENCE_TIMEOUT_MS);}function startExitTimer(_0x1be8f5){const _0x19c984=a5_0x43b1;abortExitTimer(_0x1be8f5),_0x1be8f5[_0x19c984(0x16c)]=!![],_0x1be8f5[_0x19c984(0x14b)]=setTimeout(()=>{const _0x3b48aa=_0x19c984;_0x1be8f5[_0x3b48aa(0x16c)]=![];},EXIT_GRACE_PERIOD_SECONDS*0x3e8),_0x1be8f5[_0x19c984(0x17d)]=setTimeout(()=>{const _0x455b6d=_0x19c984;setPresence(_0x1be8f5,![]),_0x1be8f5[_0x455b6d(0x17d)]=null;},EXIT_TIMER_MINUTES*0x3c*0x3e8);}function abortExitTimer(_0x3ee944){const _0x458538=a5_0x43b1;if(_0x3ee944['exitTimer'])clearTimeout(_0x3ee944[_0x458538(0x17d)]);if(_0x3ee944[_0x458538(0x14b)])clearTimeout(_0x3ee944[_0x458538(0x14b)]);_0x3ee944[_0x458538(0x17d)]=null,_0x3ee944['exitGraceTimer']=null,_0x3ee944[_0x458538(0x16c)]=![];}async function setPresence(_0x3a8a76,_0x295f81){const _0x11c7e8=a5_0x43b1;if(_0x3a8a76[_0x11c7e8(0x1a9)]===_0x295f81)return;_0x3a8a76[_0x11c7e8(0x1a9)]=_0x295f81,await _0x3a8a76[_0x11c7e8(0x179)](_0x11c7e8(0x161),{'val':_0x295f81,'ack':!![]});}function a5_0x43b1(_0x5d893c,_0x101d21){const _0x334f52=a5_0x5f22();return a5_0x43b1=function(_0x217132,_0x2edda9){_0x217132=_0x217132-0x142;let _0x5f2224=_0x334f52[_0x217132];return _0x5f2224;},a5_0x43b1(_0x5d893c,_0x101d21);}function a5_0x5f22(){const _0x53c602=['754740kHpheX','round','präsenz','switch','griff','1847156JiRvOP','exports','.1.LEVEL','1824978CiIBig','debug','isProVersion','243026zUdpzz','lampe','parse','weatherunderground','schalter','ANALYZE_SEQUENCE','isPresent','SIMULATE_SIGNAL','includes','temperature','\x20from\x20','.ACTUAL_TEMPERATURE','accuweather','365072dAlAdH','1598166cvptnD','STATUS','rawEventLog','bewegung','getDate','outdoorSensorId','now','3294855rDoIuJ','exitGraceTimer','valveMapping','number','Unknown','lock','motion','toString','getHours','lastTrackerEventTime','map','value','some','stringify','getStateAsync','isExit','type','location','fenster','name','.1.VALVE_STATE','analysis.health.todayVector','(((.+)+)+)+$','system.isPresent','.Current.Temperature','log','.NextHours.Location_1.Day_1.current.temp_value','val','level','unshift','from','push','search','[RECORDER]\x20Error:\x20','isGracePeriodActive','toISOString','length','LTM.trainingData.thermodynamics','loc','dimmer','.forecast.current.temp','.1.ACTUAL_TEMPERATURE','STATE','LTM.trainingData.sequences','.1.TEMPERATURE','presence','eventHistory','setStateAsync','string','window','currentSystemMode','exitTimer','licht','.4.VALVE_STATE','toLowerCase','63uEdabY','sendToPythonWrapper','shift','light','tür','occupancy','weatherInstance','klima','door','3GTJziA','normal','replace','getForeignStateAsync','Temperature','logDuplicates','error','config','Valve','thermostat','handle','kontakt','TRACK_EVENT','sensorLastValues'];a5_0x5f22=function(){return _0x53c602;};return a5_0x5f22();}async function updateHourlyActivity(_0x57e2f1){const _0x52d4eb=a5_0x43b1;let _0x4d3fcb=new Array(0x18)['fill'](0x0),_0x5bdc6b=0x0;try{const _0x13d418=await _0x57e2f1[_0x52d4eb(0x158)]('analysis.health.todayVector');_0x13d418&&_0x13d418[_0x52d4eb(0x165)]&&(_0x4d3fcb=JSON[_0x52d4eb(0x1a5)](_0x13d418[_0x52d4eb(0x165)]),_0x5bdc6b=_0x13d418['ts']);}catch(_0x2fc618){}const _0x3f0728=new Date(_0x5bdc6b),_0x18e410=new Date();_0x3f0728['getDate']()!==_0x18e410[_0x52d4eb(0x147)]()&&(_0x4d3fcb=new Array(0x18)['fill'](0x0));const _0x214999=_0x18e410[_0x52d4eb(0x152)]();if(_0x4d3fcb[_0x214999]===undefined)_0x4d3fcb[_0x214999]=0x0;_0x4d3fcb[_0x214999]++,await _0x57e2f1['setStateAsync'](_0x52d4eb(0x15f),{'val':JSON[_0x52d4eb(0x157)](_0x4d3fcb),'ack':!![]});}async function processSensorEvent(_0x4a61b6,_0x475b3a,_0x474e44,_0xee6154){const _0x217431=a5_0x43b1;if(!_0xee6154)return null;const _0x23bfcf=_0x474e44[_0x217431(0x165)],_0x1c6354=Date[_0x217431(0x149)](),_0x1553f7=_0x4a61b6[_0x217431(0x197)][_0x475b3a],_0x43620f=(_0xee6154[_0x217431(0x15a)]||'')[_0x217431(0x180)](),_0x1382d8=_0x43620f[_0x217431(0x1ab)](_0x217431(0x1ac))||_0x43620f[_0x217431(0x1ab)]('temperatur')||_0x43620f['includes'](_0x217431(0x188))||_0x43620f[_0x217431(0x1ab)]('heizung')||_0x43620f[_0x217431(0x1ab)](_0x217431(0x193));if(_0x1382d8&&typeof _0x23bfcf==='number'){if(_0x23bfcf>0x50||_0x23bfcf<-0x32)return _0x4a61b6[_0x217431(0x163)][_0x217431(0x1a1)]('[RECORDER]\x20Ignored\x20implausible\x20temperature:\x20'+_0x23bfcf+_0x217431(0x1ad)+_0x475b3a),null;}_0x4a61b6[_0x217431(0x197)][_0x475b3a]=_0x23bfcf;if(!_0xee6154[_0x217431(0x18f)]&&_0x1553f7!=undefined&&_0x1553f7==_0x23bfcf)return null;_0x4a61b6[_0x217431(0x1a2)]&&_0x1382d8&&recordThermodynamics(_0x4a61b6,_0x475b3a,_0x23bfcf,_0xee6154[_0x217431(0x15b)]);const _0x950b75={'timestamp':_0x1c6354,'id':_0x475b3a,'name':_0xee6154[_0x217431(0x15d)],'type':_0xee6154[_0x217431(0x15a)],'location':_0xee6154[_0x217431(0x15b)],'value':_0x23bfcf};_0x4a61b6[_0x217431(0x178)][_0x217431(0x167)](_0x950b75);if(_0x4a61b6[_0x217431(0x178)][_0x217431(0x16e)]>HISTORY_MAX_SIZE)_0x4a61b6[_0x217431(0x178)]['pop']();await _0x4a61b6[_0x217431(0x179)]('events.lastEvent',{'val':JSON[_0x217431(0x157)](_0x950b75),'ack':!![]}),await _0x4a61b6[_0x217431(0x179)]('events.history',{'val':JSON['stringify'](_0x4a61b6[_0x217431(0x178)]),'ack':!![]}),await updateHourlyActivity(_0x4a61b6);if(_0x4a61b6[_0x217431(0x1a2)]){_0x4a61b6[_0x217431(0x145)][_0x217431(0x169)](_0x950b75);if(_0x4a61b6['rawEventLog'][_0x217431(0x16e)]>RAW_LOG_MAX_SIZE)_0x4a61b6['rawEventLog']['splice'](0x0,_0x4a61b6[_0x217431(0x145)][_0x217431(0x16e)]-RAW_LOG_MAX_SIZE);await _0x4a61b6['setStateAsync']('LTM.rawEventLog',{'val':JSON[_0x217431(0x157)](_0x4a61b6['rawEventLog']),'ack':!![]}),recordSequence(_0x4a61b6,_0x950b75);}if(_0xee6154[_0x217431(0x159)]&&_0x23bfcf===!![]){if(_0x4a61b6[_0x217431(0x1a9)]&&!_0x4a61b6[_0x217431(0x16c)])startExitTimer(_0x4a61b6);else{if(!_0x4a61b6['isPresent'])setPresence(_0x4a61b6,!![]);}}else{if(_0xee6154[_0x217431(0x15a)]===_0x217431(0x150)&&_0x23bfcf===!![]){if(_0x4a61b6[_0x217431(0x17d)])abortExitTimer(_0x4a61b6);if(!_0x4a61b6['isPresent']&&_0x4a61b6[_0x217431(0x17c)]===_0x217431(0x18b))setPresence(_0x4a61b6,!![]);}}if(_0x4a61b6['isProVersion']&&_0x4a61b6[_0x217431(0x182)]){_0xee6154[_0x217431(0x15a)]==='motion'&&_0x23bfcf===!![]&&_0xee6154['location']&&_0x4a61b6[_0x217431(0x182)](_0x217431(0x1aa),{'room':_0xee6154[_0x217431(0x15b)]});const _0x2e8515=[_0x217431(0x189),_0x217431(0x185),'window',_0x217431(0x15c),_0x217431(0x19c),_0x217431(0x194),_0x217431(0x14f),'schloss'][_0x217431(0x156)](_0x418407=>_0x43620f[_0x217431(0x1ab)](_0x418407)),_0x5cd362=[_0x217431(0x184),_0x217431(0x17e),_0x217431(0x19b),_0x217431(0x1a7),_0x217431(0x171),'lampe'][_0x217431(0x156)](_0x1337f2=>_0x43620f[_0x217431(0x1ab)](_0x1337f2)),_0x3fa132=[_0x217431(0x150),_0x217431(0x146),_0x217431(0x19a),_0x217431(0x177),_0x217431(0x186)][_0x217431(0x156)](_0x56a1de=>_0x43620f['includes'](_0x56a1de));if(_0xee6154[_0x217431(0x15b)]&&(_0x2e8515||_0x5cd362||_0x3fa132)){const _0xdc89a3=_0x23bfcf===!![]||typeof _0x23bfcf===_0x217431(0x14d)&&_0x23bfcf>0x0,_0xb3a95a=_0x2e8515&&!_0xdc89a3&&_0x1553f7!==undefined&&_0x1553f7!=_0x23bfcf;if(_0xdc89a3||_0xb3a95a){const _0xaf5280=_0x4a61b6[_0x217431(0x153)]||_0x1c6354,_0x1e3d7f=(_0x1c6354-_0xaf5280)/0x3e8;_0x4a61b6[_0x217431(0x153)]=_0x1c6354,_0x4a61b6[_0x217431(0x182)](_0x217431(0x196),{'room':_0xee6154[_0x217431(0x15b)],'dt':_0x1e3d7f});}}}return _0x950b75;}module[a5_0x5a02b4(0x19e)]={'processSensorEvent':processSensorEvent,'getOutsideTemperatureNumeric':getOutsideTemperatureNumeric,'setPresence':setPresence,'abortExitTimer':abortExitTimer,'startExitTimer':startExitTimer};