const a5_0x3a051e=a5_0x6286;(function(_0x3236cd,_0x53ebe7){const _0x298db9=a5_0x6286,_0x3b216f=_0x3236cd();while(!![]){try{const _0x384ac9=-parseInt(_0x298db9(0xee))/0x1*(parseInt(_0x298db9(0x111))/0x2)+parseInt(_0x298db9(0xe3))/0x3+parseInt(_0x298db9(0x118))/0x4*(-parseInt(_0x298db9(0xcf))/0x5)+parseInt(_0x298db9(0xce))/0x6+-parseInt(_0x298db9(0xfb))/0x7*(parseInt(_0x298db9(0xde))/0x8)+-parseInt(_0x298db9(0xdb))/0x9*(parseInt(_0x298db9(0xd1))/0xa)+-parseInt(_0x298db9(0xfe))/0xb*(-parseInt(_0x298db9(0x12c))/0xc);if(_0x384ac9===_0x53ebe7)break;else _0x3b216f['push'](_0x3b216f['shift']());}catch(_0x515b8e){_0x3b216f['push'](_0x3b216f['shift']());}}}(a5_0xbf9e,0xa9aa7));const a5_0x38ae03=(function(){let _0xce2065=!![];return function(_0x1661f4,_0x477382){const _0x2bfdfe=_0xce2065?function(){if(_0x477382){const _0x23e603=_0x477382['apply'](_0x1661f4,arguments);return _0x477382=null,_0x23e603;}}:function(){};return _0xce2065=![],_0x2bfdfe;};}()),a5_0xf2e607=a5_0x38ae03(this,function(){const _0x14b06b=a5_0x6286;return a5_0xf2e607[_0x14b06b(0x130)]()['search'](_0x14b06b(0x101))[_0x14b06b(0x130)]()[_0x14b06b(0xcc)](a5_0xf2e607)[_0x14b06b(0x115)](_0x14b06b(0x101));});a5_0xf2e607();'use strict';const HISTORY_MAX_SIZE=0x32,RAW_LOG_MAX_SIZE=0x9c4,THERMO_LOG_SIZE=0x3e8,SEQUENCE_TIMEOUT_MS=0x5*0x3c*0x3e8,MAX_TRAINING_SET_SIZE=0x1f4,EXIT_TIMER_MINUTES=0xf,EXIT_GRACE_PERIOD_SECONDS=0x1e;let activeSequence=[],sequenceTimer=null;async function getOutsideTemperatureNumeric(_0x2c37b){const _0x50e57b=a5_0x6286;if(_0x2c37b[_0x50e57b(0x10d)][_0x50e57b(0xe8)])try{const _0x45425b=await _0x2c37b['getForeignStateAsync'](_0x2c37b[_0x50e57b(0x10d)][_0x50e57b(0xe8)]);if(_0x45425b&&_0x45425b[_0x50e57b(0x11f)]!==undefined&&_0x45425b[_0x50e57b(0x11f)]!==null)return parseFloat(_0x45425b[_0x50e57b(0x11f)]);}catch(_0x2f4187){}const _0x528384=_0x2c37b[_0x50e57b(0x10d)][_0x50e57b(0xd3)];if(!_0x2c37b[_0x50e57b(0x10d)][_0x50e57b(0x103)]||!_0x528384)return null;try{let _0x54904c='';if(_0x528384[_0x50e57b(0x104)](_0x50e57b(0x10a)))_0x54904c=_0x528384+'.Current.Temperature';else{if(_0x528384[_0x50e57b(0x104)](_0x50e57b(0xea)))_0x54904c=_0x528384+_0x50e57b(0xc7);else{if(_0x528384['includes'](_0x50e57b(0xf8)))_0x54904c=_0x528384+_0x50e57b(0xf9);else{if(_0x528384['includes']('weatherunderground'))_0x54904c=_0x528384+_0x50e57b(0xdc);}}}if(_0x54904c){const _0x20d3b0=await _0x2c37b[_0x50e57b(0xca)](_0x54904c);if(_0x20d3b0&&_0x20d3b0['val']!==undefined&&_0x20d3b0[_0x50e57b(0x11f)]!==null)return parseFloat(_0x20d3b0[_0x50e57b(0x11f)]);}}catch(_0x11d572){}return null;}async function recordThermodynamics(_0xf2f687,_0x478d3e,_0x1d5202,_0x3e64f4){const _0x4b6b30=a5_0x6286,_0x3668c3=await getOutsideTemperatureNumeric(_0xf2f687);if(_0x3668c3===null)return;let _0x110214=0x0,_0x3b7855=![];if(_0xf2f687['config'][_0x4b6b30(0xd6)])try{let _0x1a317e=_0xf2f687[_0x4b6b30(0x10d)][_0x4b6b30(0xd6)];if(typeof _0x1a317e===_0x4b6b30(0xd9))_0x1a317e=JSON[_0x4b6b30(0x129)](_0x1a317e);if(_0x1a317e[_0x478d3e]){const _0x3cd402=_0x1a317e[_0x478d3e],_0x5e8f84=await _0xf2f687[_0x4b6b30(0xca)](_0x3cd402);if(_0x5e8f84&&_0x5e8f84[_0x4b6b30(0x11f)]!==null&&_0x5e8f84[_0x4b6b30(0x11f)]!==undefined){let _0x494388=Number(_0x5e8f84[_0x4b6b30(0x11f)]);if(_0x494388<=1.05&&!_0x3cd402[_0x4b6b30(0x104)](_0x4b6b30(0x116))&&!_0x3cd402[_0x4b6b30(0x104)](_0x4b6b30(0x128)))_0x494388=_0x494388*0x64;_0x110214=Math[_0x4b6b30(0x11e)](_0x494388),_0x3b7855=!![];}}}catch(_0x172a4b){}if(!_0x3b7855){const _0x4011d1=[{'from':_0x4b6b30(0x11a),'to':_0x4b6b30(0xcd)},{'from':_0x4b6b30(0x11a),'to':'.1.VALVE_STATE'},{'from':_0x4b6b30(0xe9),'to':_0x4b6b30(0xdf)},{'from':_0x4b6b30(0xff),'to':_0x4b6b30(0x120)},{'from':_0x4b6b30(0x107),'to':_0x4b6b30(0xc8)},{'from':'Temperature','to':'Valve'}];for(const _0x16d7b6 of _0x4011d1){if(_0x478d3e[_0x4b6b30(0x104)](_0x16d7b6[_0x4b6b30(0x108)])){const _0x383e83=_0x478d3e[_0x4b6b30(0xfa)](_0x16d7b6['from'],_0x16d7b6['to']);try{const _0x32030a=await _0xf2f687['getForeignStateAsync'](_0x383e83);if(_0x32030a&&_0x32030a['val']!==null&&_0x32030a[_0x4b6b30(0x11f)]!==undefined){let _0x1e8622=Number(_0x32030a[_0x4b6b30(0x11f)]);if(typeof _0x1e8622===_0x4b6b30(0x12d)){if(_0x1e8622<=1.05&&_0x16d7b6['to'][_0x4b6b30(0x104)](_0x4b6b30(0x12b)))_0x1e8622=_0x1e8622*0x64;_0x110214=Math[_0x4b6b30(0x11e)](_0x1e8622),_0x3b7855=!![];break;}}}catch(_0x2d8efd){}}}}const _0xbb50e9=await _0xf2f687[_0x4b6b30(0xe4)]('LTM.trainingData.thermodynamics');let _0x47dd87=[];if(_0xbb50e9&&_0xbb50e9['val'])try{_0x47dd87=JSON[_0x4b6b30(0x129)](_0xbb50e9[_0x4b6b30(0x11f)]);}catch(_0x2ff6ec){}_0x47dd87[_0x4b6b30(0x11d)]({'ts':Date[_0x4b6b30(0x102)](),'room':_0x3e64f4||'Unknown','t_in':_0x1d5202,'t_out':_0x3668c3,'valve':_0x110214});if(_0x47dd87['length']>THERMO_LOG_SIZE)_0x47dd87[_0x4b6b30(0x133)]();await _0xf2f687[_0x4b6b30(0x12e)](_0x4b6b30(0x110),{'val':JSON['stringify'](_0x47dd87),'ack':!![]});}async function saveCompletedSequence(_0x49685f){const _0x13ba63=a5_0x6286;try{const _0x5a8f40=await _0x49685f['getStateAsync'](_0x13ba63(0xf1));let _0x2653bd=[];if(_0x5a8f40&&_0x5a8f40[_0x13ba63(0x11f)])try{_0x2653bd=JSON[_0x13ba63(0x129)](_0x5a8f40[_0x13ba63(0x11f)]);}catch(_0x383da4){}const _0x30b17f=activeSequence[0x0]['ts'],_0x103a69=activeSequence[_0x13ba63(0xe6)](_0x39034a=>({'loc':_0x39034a[_0x13ba63(0xf2)],'t_delta':Math[_0x13ba63(0x11e)]((_0x39034a['ts']-_0x30b17f)/0x3e8)})),_0x2e8bbc={'timestamp':new Date(_0x30b17f)[_0x13ba63(0x100)](),'steps':_0x103a69,'duration':Math[_0x13ba63(0x11e)]((activeSequence[activeSequence[_0x13ba63(0xda)]-0x1]['ts']-_0x30b17f)/0x3e8),'daytime':new Date(_0x30b17f)[_0x13ba63(0x10f)]()};_0x2653bd[_0x13ba63(0x11d)](_0x2e8bbc);if(_0x2653bd[_0x13ba63(0xda)]>MAX_TRAINING_SET_SIZE)_0x2653bd['shift']();await _0x49685f[_0x13ba63(0x12e)](_0x13ba63(0xf1),{'val':JSON['stringify'](_0x2653bd),'ack':!![]}),_0x49685f[_0x13ba63(0xf4)]&&_0x49685f['sendToPythonWrapper']&&_0x49685f['sendToPythonWrapper']('ANALYZE_SEQUENCE',{'sequence':_0x2e8bbc});}catch(_0x1c311f){_0x49685f['log']['error']('[RECORDER]\x20Error:\x20'+_0x1c311f['message']);}}async function recordSequence(_0x524567,_0x2f78f1){const _0xff21ca=a5_0x6286,_0xf88d67=(_0x2f78f1[_0xff21ca(0xdd)]||'')['toLowerCase'](),_0x450fa8=[_0xff21ca(0xe5),_0xff21ca(0xd4),_0xff21ca(0x122),'presence',_0xff21ca(0x127),_0xff21ca(0x12a),'tür',_0xff21ca(0x126),_0xff21ca(0x11b),_0xff21ca(0xfc),_0xff21ca(0xd7),_0xff21ca(0x113),_0xff21ca(0x12f),_0xff21ca(0xc9),_0xff21ca(0xf7),_0xff21ca(0xd0),_0xff21ca(0xe7)];if(!_0x450fa8['some'](_0x106f0c=>_0xf88d67[_0xff21ca(0x104)](_0x106f0c)))return;if(!_0x2f78f1['value'])return;if(sequenceTimer)clearTimeout(sequenceTimer);activeSequence[_0xff21ca(0x11d)]({'loc':_0x2f78f1[_0xff21ca(0x112)]||'Unknown','id':_0x2f78f1['id'],'ts':Date[_0xff21ca(0x102)]()}),sequenceTimer=setTimeout(async()=>{const _0x2fa2f7=_0xff21ca;if(activeSequence[_0x2fa2f7(0xda)]>0x1)await saveCompletedSequence(_0x524567);activeSequence=[];},SEQUENCE_TIMEOUT_MS);}function a5_0xbf9e(){const _0x13db69=['events.history','präsenz','unshift','lastTrackerEventTime','exitGraceTimer','window','occupancy','STATE','parse','door','LEVEL','29152932JpoNfh','number','setStateAsync','licht','toString','SIMULATE_SIGNAL','debug','shift','.NextHours.Location_1.Day_1.current.temp_value','level','switch','getForeignStateAsync','currentSystemMode','constructor','.1.LEVEL','1244460FQzHLF','565gqyTMr','dimmer','4330uIThEG','some','weatherInstance','bewegung','toLowerCase','valveMapping','kontakt','rawEventLog','string','length','14427jcREey','.forecast.current.temp','type','16REyoXa','.4.VALVE_STATE','name','isPresent','TRACK_EVENT','2983308shlmLB','getStateAsync','motion','map','lampe','outdoorSensorId','.1.TEMPERATURE','daswetter','klima','tür','sendToPythonWrapper','29JctCMp','temperatur','griff','LTM.trainingData.sequences','loc','handle','isProVersion','LTM.rawEventLog','splice','schalter','openweathermap','.forecast.current.temperature','replace','961429iyeyaz','contact','stringify','11lGHRGW','.ACTUAL_TEMPERATURE','toISOString','(((.+)+)+)+$','now','useWeather','includes','lock','exports','temperature','from','eventHistory','accuweather','sensorLastValues','isExit','config','isGracePeriodActive','getHours','LTM.trainingData.thermodynamics','67384VJujEF','location','light','system.isPresent','search','STATUS','exitTimer','35060OvuiUW','thermostat','.1.ACTUAL_TEMPERATURE','fenster','\x20from\x20','push','round','val','.LEVEL'];a5_0xbf9e=function(){return _0x13db69;};return a5_0xbf9e();}function a5_0x6286(_0x5bd0c4,_0x51bf6a){const _0x1fcbc9=a5_0xbf9e();return a5_0x6286=function(_0xf2e607,_0x38ae03){_0xf2e607=_0xf2e607-0xc7;let _0xbf9e=_0x1fcbc9[_0xf2e607];return _0xbf9e;},a5_0x6286(_0x5bd0c4,_0x51bf6a);}function startExitTimer(_0x336e27){const _0x46e3dd=a5_0x6286;abortExitTimer(_0x336e27),_0x336e27[_0x46e3dd(0x10e)]=!![],_0x336e27['exitGraceTimer']=setTimeout(()=>{const _0x98b167=_0x46e3dd;_0x336e27[_0x98b167(0x10e)]=![];},EXIT_GRACE_PERIOD_SECONDS*0x3e8),_0x336e27['exitTimer']=setTimeout(()=>{setPresence(_0x336e27,![]),_0x336e27['exitTimer']=null;},EXIT_TIMER_MINUTES*0x3c*0x3e8);}function abortExitTimer(_0x478adf){const _0x28b84a=a5_0x6286;if(_0x478adf[_0x28b84a(0x117)])clearTimeout(_0x478adf[_0x28b84a(0x117)]);if(_0x478adf['exitGraceTimer'])clearTimeout(_0x478adf[_0x28b84a(0x125)]);_0x478adf[_0x28b84a(0x117)]=null,_0x478adf[_0x28b84a(0x125)]=null,_0x478adf[_0x28b84a(0x10e)]=![];}async function setPresence(_0x17bfff,_0xbb921d){const _0x4b58df=a5_0x6286;if(_0x17bfff[_0x4b58df(0xe1)]===_0xbb921d)return;_0x17bfff[_0x4b58df(0xe1)]=_0xbb921d,await _0x17bfff[_0x4b58df(0x12e)](_0x4b58df(0x114),{'val':_0xbb921d,'ack':!![]});}async function processSensorEvent(_0x248503,_0x685362,_0x5ce783,_0x440129){const _0x4bf21a=a5_0x6286;if(!_0x440129)return null;const _0x2022b4=_0x5ce783[_0x4bf21a(0x11f)],_0x36d335=Date[_0x4bf21a(0x102)](),_0xa5af81=_0x248503[_0x4bf21a(0x10b)][_0x685362],_0x16f1de=(_0x440129[_0x4bf21a(0xdd)]||'')[_0x4bf21a(0xd5)](),_0x463fe1=_0x16f1de[_0x4bf21a(0x104)](_0x4bf21a(0x107))||_0x16f1de[_0x4bf21a(0x104)](_0x4bf21a(0xef))||_0x16f1de['includes'](_0x4bf21a(0xeb))||_0x16f1de[_0x4bf21a(0x104)]('heizung')||_0x16f1de[_0x4bf21a(0x104)](_0x4bf21a(0x119));if(_0x463fe1&&typeof _0x2022b4===_0x4bf21a(0x12d)){if(_0x2022b4>0x50||_0x2022b4<-0x32)return _0x248503['log'][_0x4bf21a(0x132)]('[RECORDER]\x20Ignored\x20implausible\x20temperature:\x20'+_0x2022b4+_0x4bf21a(0x11c)+_0x685362),null;}_0x248503['sensorLastValues'][_0x685362]=_0x2022b4;if(!_0x440129['logDuplicates']&&_0xa5af81!=undefined&&_0xa5af81==_0x2022b4)return null;_0x248503[_0x4bf21a(0xf4)]&&_0x463fe1&&recordThermodynamics(_0x248503,_0x685362,_0x2022b4,_0x440129[_0x4bf21a(0x112)]);const _0x522b22={'timestamp':_0x36d335,'id':_0x685362,'name':_0x440129[_0x4bf21a(0xe0)],'type':_0x440129[_0x4bf21a(0xdd)],'location':_0x440129['location'],'value':_0x2022b4};_0x248503['eventHistory'][_0x4bf21a(0x123)](_0x522b22);if(_0x248503[_0x4bf21a(0x109)][_0x4bf21a(0xda)]>HISTORY_MAX_SIZE)_0x248503['eventHistory']['pop']();await _0x248503['setStateAsync']('events.lastEvent',{'val':JSON[_0x4bf21a(0xfd)](_0x522b22),'ack':!![]}),await _0x248503['setStateAsync'](_0x4bf21a(0x121),{'val':JSON[_0x4bf21a(0xfd)](_0x248503[_0x4bf21a(0x109)]),'ack':!![]});if(_0x248503[_0x4bf21a(0xf4)]){_0x248503['rawEventLog'][_0x4bf21a(0x11d)](_0x522b22);if(_0x248503[_0x4bf21a(0xd8)][_0x4bf21a(0xda)]>RAW_LOG_MAX_SIZE)_0x248503[_0x4bf21a(0xd8)][_0x4bf21a(0xf6)](0x0,_0x248503[_0x4bf21a(0xd8)][_0x4bf21a(0xda)]-RAW_LOG_MAX_SIZE);await _0x248503[_0x4bf21a(0x12e)](_0x4bf21a(0xf5),{'val':JSON[_0x4bf21a(0xfd)](_0x248503['rawEventLog']),'ack':!![]}),recordSequence(_0x248503,_0x522b22);}if(_0x440129[_0x4bf21a(0x10c)]&&_0x2022b4===!![]){if(_0x248503[_0x4bf21a(0xe1)]&&!_0x248503[_0x4bf21a(0x10e)])startExitTimer(_0x248503);else{if(!_0x248503[_0x4bf21a(0xe1)])setPresence(_0x248503,!![]);}}else{if(_0x440129['type']===_0x4bf21a(0xe5)&&_0x2022b4===!![]){if(_0x248503[_0x4bf21a(0x117)])abortExitTimer(_0x248503);if(!_0x248503[_0x4bf21a(0xe1)]&&_0x248503[_0x4bf21a(0xcb)]==='normal')setPresence(_0x248503,!![]);}}if(_0x248503['isProVersion']&&_0x248503[_0x4bf21a(0xed)]){_0x440129['type']===_0x4bf21a(0xe5)&&_0x2022b4===!![]&&_0x440129[_0x4bf21a(0x112)]&&_0x248503[_0x4bf21a(0xed)](_0x4bf21a(0x131),{'room':_0x440129[_0x4bf21a(0x112)]});const _0x51e961=[_0x4bf21a(0x12a),_0x4bf21a(0xec),'window',_0x4bf21a(0x11b),_0x4bf21a(0xf0),_0x4bf21a(0xf3),_0x4bf21a(0x105),'schloss']['some'](_0x1d8994=>_0x16f1de['includes'](_0x1d8994)),_0x97a37b=['light','licht',_0x4bf21a(0xc9),_0x4bf21a(0xf7),_0x4bf21a(0xd0),'lampe'][_0x4bf21a(0xd2)](_0x40fdc1=>_0x16f1de[_0x4bf21a(0x104)](_0x40fdc1)),_0x1209ff=['motion','bewegung',_0x4bf21a(0x122),'presence',_0x4bf21a(0x127)]['some'](_0x3b9dd8=>_0x16f1de[_0x4bf21a(0x104)](_0x3b9dd8));if(_0x440129['location']&&(_0x51e961||_0x97a37b||_0x1209ff)){const _0x2f9cff=_0x2022b4===!![]||typeof _0x2022b4===_0x4bf21a(0x12d)&&_0x2022b4>0x0,_0x238786=_0x51e961&&!_0x2f9cff&&_0xa5af81!==undefined&&_0xa5af81!=_0x2022b4;if(_0x2f9cff||_0x238786){const _0x40ae06=_0x248503[_0x4bf21a(0x124)]||_0x36d335,_0x38b4de=(_0x36d335-_0x40ae06)/0x3e8;_0x248503[_0x4bf21a(0x124)]=_0x36d335,_0x248503[_0x4bf21a(0xed)](_0x4bf21a(0xe2),{'room':_0x440129[_0x4bf21a(0x112)],'dt':_0x38b4de});}}}return _0x522b22;}module[a5_0x3a051e(0x106)]={'processSensorEvent':processSensorEvent,'getOutsideTemperatureNumeric':getOutsideTemperatureNumeric,'setPresence':setPresence,'abortExitTimer':abortExitTimer,'startExitTimer':startExitTimer};