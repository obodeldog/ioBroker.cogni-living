const a5_0xbb2536=a5_0x17cb;(function(_0x5763ca,_0x30fb9e){const _0x3fea0a=a5_0x17cb,_0x5a383b=_0x5763ca();while(!![]){try{const _0x1027ba=parseInt(_0x3fea0a(0x14b))/0x1+parseInt(_0x3fea0a(0x134))/0x2+parseInt(_0x3fea0a(0x151))/0x3+parseInt(_0x3fea0a(0x14f))/0x4*(parseInt(_0x3fea0a(0x122))/0x5)+parseInt(_0x3fea0a(0x12b))/0x6+parseInt(_0x3fea0a(0x13c))/0x7*(-parseInt(_0x3fea0a(0x117))/0x8)+-parseInt(_0x3fea0a(0x13e))/0x9;if(_0x1027ba===_0x30fb9e)break;else _0x5a383b['push'](_0x5a383b['shift']());}catch(_0x1af9ba){_0x5a383b['push'](_0x5a383b['shift']());}}}(a5_0x26ff,0x31964));const a5_0x5d4119=(function(){let _0x497e11=!![];return function(_0x53b0cd,_0x433db6){const _0x228d68=_0x497e11?function(){const _0x31fe2a=a5_0x17cb;if(_0x433db6){const _0xe919b1=_0x433db6[_0x31fe2a(0x143)](_0x53b0cd,arguments);return _0x433db6=null,_0xe919b1;}}:function(){};return _0x497e11=![],_0x228d68;};}()),a5_0x1dc211=a5_0x5d4119(this,function(){const _0x35b3c2=a5_0x17cb;return a5_0x1dc211[_0x35b3c2(0x15d)]()['search'](_0x35b3c2(0x164))[_0x35b3c2(0x15d)]()['constructor'](a5_0x1dc211)[_0x35b3c2(0x15b)](_0x35b3c2(0x164));});a5_0x1dc211();'use strict';function a5_0x26ff(){const _0x29dec2=['toISOString','shift','1477554ALNpEh','LEVEL','log','stringify','tür','name','map','temperature','lampe','90612LpKTUS','.LEVEL','config','[RECORDER]\x20Error:\x20','.1.LEVEL','ANALYZE_SEQUENCE','.ACTUAL_TEMPERATURE','contact','3290xwWkgN','exitGraceTimer','2765268bssmhS','hm-rpc','LTM.trainingData.thermodynamics','setStateAsync','value','apply','round','includes','schalter','.4.VALVE_STATE','presence','from','now','350210iYmQou','sendToPythonWrapper','toLowerCase','openweathermap','9388prbHsE','bewegung','109818mCPNPO','sensorLastValues','präsenz','location','eventHistory','exitTimer','LTM.trainingData.sequences','getForeignStateAsync','push','some','search','currentSystemMode','toString','daswetter','exports','klima','.NextHours.Location_1.Day_1.current.temp_value','.1.ACTUAL_TEMPERATURE','isPresent','(((.+)+)+)+$','motion','rawEventLog','weatherunderground','door','.1.TEMPERATURE','getStateAsync','.Current.Temperature','length','number','.forecast.current.temperature','outdoorSensorId','5936zXOsOX','dimmer','type','parse','normal','LTM.rawEventLog','isGracePeriodActive','kontakt','pop','events.lastEvent','occupancy','385YbYvSQ','val','message','isExit','Unknown','.1.VALVE_STATE','weatherInstance'];a5_0x26ff=function(){return _0x29dec2;};return a5_0x26ff();}const HISTORY_MAX_SIZE=0x32,RAW_LOG_MAX_SIZE=0x9c4,THERMO_LOG_SIZE=0x3e8,SEQUENCE_TIMEOUT_MS=0x5*0x3c*0x3e8,MAX_TRAINING_SET_SIZE=0x1f4,EXIT_TIMER_MINUTES=0xf,EXIT_GRACE_PERIOD_SECONDS=0x1e;function a5_0x17cb(_0x5f36ba,_0x3ef08c){const _0x6f374a=a5_0x26ff();return a5_0x17cb=function(_0x1dc211,_0x5d4119){_0x1dc211=_0x1dc211-0x10c;let _0x26ffab=_0x6f374a[_0x1dc211];return _0x26ffab;},a5_0x17cb(_0x5f36ba,_0x3ef08c);}let activeSequence=[],sequenceTimer=null;async function getOutsideTemperatureNumeric(_0xcb89ba){const _0x154af7=a5_0x17cb;if(_0xcb89ba['config'][_0x154af7(0x116)])try{const _0x23cc5a=await _0xcb89ba[_0x154af7(0x158)](_0xcb89ba['config'][_0x154af7(0x116)]);if(_0x23cc5a&&_0x23cc5a['val']!==undefined&&_0x23cc5a[_0x154af7(0x123)]!==null)return parseFloat(_0x23cc5a[_0x154af7(0x123)]);}catch(_0x3c3f59){}const _0x30e467=_0xcb89ba[_0x154af7(0x136)][_0x154af7(0x128)];if(!_0xcb89ba['config']['useWeather']||!_0x30e467)return null;try{let _0x5ad3dd='';if(_0x30e467['includes']('accuweather'))_0x5ad3dd=_0x30e467+_0x154af7(0x112);else{if(_0x30e467[_0x154af7(0x145)](_0x154af7(0x15e)))_0x5ad3dd=_0x30e467+_0x154af7(0x161);else{if(_0x30e467['includes'](_0x154af7(0x14e)))_0x5ad3dd=_0x30e467+_0x154af7(0x115);else{if(_0x30e467[_0x154af7(0x145)](_0x154af7(0x10e)))_0x5ad3dd=_0x30e467+'.forecast.current.temp';}}}if(_0x5ad3dd){const _0x49c28f=await _0xcb89ba[_0x154af7(0x158)](_0x5ad3dd);if(_0x49c28f&&_0x49c28f[_0x154af7(0x123)]!==undefined&&_0x49c28f['val']!==null)return parseFloat(_0x49c28f['val']);}}catch(_0x4356d1){}return null;}async function recordThermodynamics(_0x1ded3f,_0x5e71db,_0x3e0095,_0x3e310d){const _0x9fac65=a5_0x17cb,_0x3adb3e=await getOutsideTemperatureNumeric(_0x1ded3f);let _0xaeae01=0x0;if(_0x5e71db[_0x9fac65(0x145)](_0x9fac65(0x13f))){const _0x2992ab=[{'from':_0x9fac65(0x162),'to':_0x9fac65(0x138)},{'from':'.1.ACTUAL_TEMPERATURE','to':_0x9fac65(0x127)},{'from':_0x9fac65(0x110),'to':_0x9fac65(0x147)},{'from':_0x9fac65(0x13a),'to':_0x9fac65(0x135)}];for(const _0x28dcc6 of _0x2992ab){if(_0x5e71db[_0x9fac65(0x145)](_0x28dcc6[_0x9fac65(0x149)])){const _0x36121a=_0x5e71db['replace'](_0x28dcc6[_0x9fac65(0x149)],_0x28dcc6['to']);try{const _0x3e6ae1=await _0x1ded3f[_0x9fac65(0x158)](_0x36121a);if(_0x3e6ae1&&_0x3e6ae1[_0x9fac65(0x123)]!==null&&_0x3e6ae1[_0x9fac65(0x123)]!==undefined){let _0x599a42=_0x3e6ae1[_0x9fac65(0x123)];typeof _0x599a42===_0x9fac65(0x114)&&_0x599a42<=1.05&&_0x28dcc6['to'][_0x9fac65(0x145)](_0x9fac65(0x12c))&&(_0x599a42=_0x599a42*0x64);_0xaeae01=Math[_0x9fac65(0x144)](_0x599a42);break;}}catch(_0x36ebe8){}}}}const _0x4124b7=await _0x1ded3f[_0x9fac65(0x111)](_0x9fac65(0x140));let _0x33ebdd=[];if(_0x4124b7&&_0x4124b7[_0x9fac65(0x123)])try{_0x33ebdd=JSON[_0x9fac65(0x11a)](_0x4124b7[_0x9fac65(0x123)]);}catch(_0x3b016c){}_0x33ebdd['push']({'ts':Date['now'](),'room':_0x3e310d||'Unknown','t_in':_0x3e0095,'t_out':_0x3adb3e,'valve':_0xaeae01});if(_0x33ebdd[_0x9fac65(0x113)]>THERMO_LOG_SIZE)_0x33ebdd[_0x9fac65(0x12a)]();await _0x1ded3f[_0x9fac65(0x141)](_0x9fac65(0x140),{'val':JSON[_0x9fac65(0x12e)](_0x33ebdd),'ack':!![]});}async function saveCompletedSequence(_0x2d3c17){const _0x4df7d8=a5_0x17cb;try{const _0xfb556b=await _0x2d3c17['getStateAsync'](_0x4df7d8(0x157));let _0x480697=[];if(_0xfb556b&&_0xfb556b[_0x4df7d8(0x123)])try{_0x480697=JSON[_0x4df7d8(0x11a)](_0xfb556b['val']);}catch(_0x5afe27){}const _0x28e066=activeSequence[0x0]['ts'],_0x37e642=activeSequence[_0x4df7d8(0x131)](_0x265f95=>({'loc':_0x265f95['loc'],'t_delta':Math[_0x4df7d8(0x144)]((_0x265f95['ts']-_0x28e066)/0x3e8)})),_0x387613={'timestamp':new Date(_0x28e066)[_0x4df7d8(0x129)](),'steps':_0x37e642,'duration':Math[_0x4df7d8(0x144)]((activeSequence[activeSequence[_0x4df7d8(0x113)]-0x1]['ts']-_0x28e066)/0x3e8),'daytime':new Date(_0x28e066)['getHours']()};_0x480697[_0x4df7d8(0x159)](_0x387613);if(_0x480697[_0x4df7d8(0x113)]>MAX_TRAINING_SET_SIZE)_0x480697[_0x4df7d8(0x12a)]();await _0x2d3c17['setStateAsync'](_0x4df7d8(0x157),{'val':JSON[_0x4df7d8(0x12e)](_0x480697),'ack':!![]}),_0x2d3c17['isProVersion']&&_0x2d3c17[_0x4df7d8(0x14c)]&&_0x2d3c17[_0x4df7d8(0x14c)](_0x4df7d8(0x139),{'sequence':_0x387613});}catch(_0x39d9b2){_0x2d3c17[_0x4df7d8(0x12d)]['error'](_0x4df7d8(0x137)+_0x39d9b2[_0x4df7d8(0x124)]);}}async function recordSequence(_0x40a636,_0x13a316){const _0x554bc6=a5_0x17cb,_0x189e9e=(_0x13a316['type']||'')[_0x554bc6(0x14d)](),_0x558346=['motion',_0x554bc6(0x150),_0x554bc6(0x153),_0x554bc6(0x148),_0x554bc6(0x121),_0x554bc6(0x10f),_0x554bc6(0x12f),'window','fenster',_0x554bc6(0x13b),_0x554bc6(0x11e),'light','licht','switch',_0x554bc6(0x146),_0x554bc6(0x118),_0x554bc6(0x133)];if(!_0x558346[_0x554bc6(0x15a)](_0x1bc7f6=>_0x189e9e[_0x554bc6(0x145)](_0x1bc7f6)))return;if(!_0x13a316[_0x554bc6(0x142)])return;if(sequenceTimer)clearTimeout(sequenceTimer);activeSequence[_0x554bc6(0x159)]({'loc':_0x13a316['location']||_0x554bc6(0x126),'id':_0x13a316['id'],'ts':Date[_0x554bc6(0x14a)]()}),sequenceTimer=setTimeout(async()=>{const _0x596c93=_0x554bc6;if(activeSequence[_0x596c93(0x113)]>0x1)await saveCompletedSequence(_0x40a636);activeSequence=[];},SEQUENCE_TIMEOUT_MS);}function startExitTimer(_0x1fda99){const _0x42113e=a5_0x17cb;abortExitTimer(_0x1fda99),_0x1fda99[_0x42113e(0x11d)]=!![],_0x1fda99[_0x42113e(0x13d)]=setTimeout(()=>{_0x1fda99['isGracePeriodActive']=![];},EXIT_GRACE_PERIOD_SECONDS*0x3e8),_0x1fda99[_0x42113e(0x156)]=setTimeout(()=>{setPresence(_0x1fda99,![]),_0x1fda99['exitTimer']=null;},EXIT_TIMER_MINUTES*0x3c*0x3e8);}function abortExitTimer(_0xbd419b){const _0x5de257=a5_0x17cb;if(_0xbd419b[_0x5de257(0x156)])clearTimeout(_0xbd419b[_0x5de257(0x156)]);if(_0xbd419b[_0x5de257(0x13d)])clearTimeout(_0xbd419b[_0x5de257(0x13d)]);_0xbd419b[_0x5de257(0x156)]=null,_0xbd419b[_0x5de257(0x13d)]=null,_0xbd419b[_0x5de257(0x11d)]=![];}async function setPresence(_0x409e9f,_0x3d1f8e){const _0x30ce96=a5_0x17cb;if(_0x409e9f[_0x30ce96(0x163)]===_0x3d1f8e)return;_0x409e9f[_0x30ce96(0x163)]=_0x3d1f8e,await _0x409e9f['setStateAsync']('system.isPresent',{'val':_0x3d1f8e,'ack':!![]});}async function processSensorEvent(_0x51e6eb,_0x5f2dee,_0x2a01dc,_0x44ecf6){const _0x44fe7f=a5_0x17cb;if(!_0x44ecf6)return null;const _0x501816=_0x2a01dc[_0x44fe7f(0x123)],_0x340125=Date[_0x44fe7f(0x14a)](),_0x5cd257=_0x51e6eb[_0x44fe7f(0x152)][_0x5f2dee];_0x51e6eb[_0x44fe7f(0x152)][_0x5f2dee]=_0x501816;if(!_0x44ecf6['logDuplicates']&&_0x5cd257!=undefined&&_0x5cd257==_0x501816)return null;const _0x24ef23=(_0x44ecf6[_0x44fe7f(0x119)]||'')[_0x44fe7f(0x14d)](),_0x1b22fd=_0x24ef23['includes'](_0x44fe7f(0x132))||_0x24ef23[_0x44fe7f(0x145)]('temperatur')||_0x24ef23[_0x44fe7f(0x145)](_0x44fe7f(0x160))||_0x24ef23[_0x44fe7f(0x145)]('heizung');_0x51e6eb['isProVersion']&&_0x1b22fd&&recordThermodynamics(_0x51e6eb,_0x5f2dee,_0x501816,_0x44ecf6['location']);const _0x1b4af2={'timestamp':_0x340125,'id':_0x5f2dee,'name':_0x44ecf6[_0x44fe7f(0x130)],'type':_0x44ecf6[_0x44fe7f(0x119)],'location':_0x44ecf6[_0x44fe7f(0x154)],'value':_0x501816};_0x51e6eb[_0x44fe7f(0x155)]['unshift'](_0x1b4af2);if(_0x51e6eb[_0x44fe7f(0x155)]['length']>HISTORY_MAX_SIZE)_0x51e6eb[_0x44fe7f(0x155)][_0x44fe7f(0x11f)]();await _0x51e6eb[_0x44fe7f(0x141)](_0x44fe7f(0x120),{'val':JSON[_0x44fe7f(0x12e)](_0x1b4af2),'ack':!![]}),await _0x51e6eb[_0x44fe7f(0x141)]('events.history',{'val':JSON['stringify'](_0x51e6eb[_0x44fe7f(0x155)]),'ack':!![]});if(_0x51e6eb['isProVersion']){_0x51e6eb[_0x44fe7f(0x10d)]['push'](_0x1b4af2);if(_0x51e6eb[_0x44fe7f(0x10d)][_0x44fe7f(0x113)]>RAW_LOG_MAX_SIZE)_0x51e6eb[_0x44fe7f(0x10d)]['splice'](0x0,_0x51e6eb[_0x44fe7f(0x10d)]['length']-RAW_LOG_MAX_SIZE);await _0x51e6eb[_0x44fe7f(0x141)](_0x44fe7f(0x11c),{'val':JSON[_0x44fe7f(0x12e)](_0x51e6eb[_0x44fe7f(0x10d)]),'ack':!![]}),recordSequence(_0x51e6eb,_0x1b4af2);}if(_0x44ecf6[_0x44fe7f(0x125)]&&_0x501816===!![]){if(_0x51e6eb[_0x44fe7f(0x163)]&&!_0x51e6eb['isGracePeriodActive'])startExitTimer(_0x51e6eb);else{if(!_0x51e6eb[_0x44fe7f(0x163)])setPresence(_0x51e6eb,!![]);}}else{if(_0x44ecf6[_0x44fe7f(0x119)]===_0x44fe7f(0x10c)&&_0x501816===!![]){if(_0x51e6eb[_0x44fe7f(0x156)])abortExitTimer(_0x51e6eb);if(!_0x51e6eb[_0x44fe7f(0x163)]&&_0x51e6eb[_0x44fe7f(0x15c)]===_0x44fe7f(0x11b))setPresence(_0x51e6eb,!![]);}}return _0x51e6eb['isProVersion']&&_0x44ecf6[_0x44fe7f(0x119)]==='motion'&&_0x501816===!![]&&_0x44ecf6[_0x44fe7f(0x154)]&&_0x51e6eb[_0x44fe7f(0x14c)]&&_0x51e6eb[_0x44fe7f(0x14c)]('SIMULATE_SIGNAL',{'room':_0x44ecf6[_0x44fe7f(0x154)]}),_0x1b4af2;}module[a5_0xbb2536(0x15f)]={'processSensorEvent':processSensorEvent,'getOutsideTemperatureNumeric':getOutsideTemperatureNumeric,'setPresence':setPresence,'abortExitTimer':abortExitTimer,'startExitTimer':startExitTimer};