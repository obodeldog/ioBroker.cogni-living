(function(_0x4056d0,_0x3ddb84){const _0x35b9ca=a4_0x3002,_0xa523be=_0x4056d0();while(!![]){try{const _0xf09fec=-parseInt(_0x35b9ca(0x222))/0x1*(-parseInt(_0x35b9ca(0x211))/0x2)+-parseInt(_0x35b9ca(0x1e5))/0x3+-parseInt(_0x35b9ca(0x1f6))/0x4*(parseInt(_0x35b9ca(0x1f3))/0x5)+parseInt(_0x35b9ca(0x1fe))/0x6+parseInt(_0x35b9ca(0x1f9))/0x7*(parseInt(_0x35b9ca(0x1e9))/0x8)+parseInt(_0x35b9ca(0x1fa))/0x9+parseInt(_0x35b9ca(0x1d6))/0xa;if(_0xf09fec===_0x3ddb84)break;else _0xa523be['push'](_0xa523be['shift']());}catch(_0x4940bd){_0xa523be['push'](_0xa523be['shift']());}}}(a4_0x3879,0x691cc));const a4_0x2d4006=(function(){let _0xeb8601=!![];return function(_0xf4195e,_0x43938a){const _0x3181e0=_0xeb8601?function(){const _0x1bff4a=a4_0x3002;if(_0x43938a){const _0xcb05dd=_0x43938a[_0x1bff4a(0x1df)](_0xf4195e,arguments);return _0x43938a=null,_0xcb05dd;}}:function(){};return _0xeb8601=![],_0x3181e0;};}()),a4_0x5be6c4=a4_0x2d4006(this,function(){const _0x5b09c1=a4_0x3002;return a4_0x5be6c4['toString']()[_0x5b09c1(0x1d2)](_0x5b09c1(0x1f4))[_0x5b09c1(0x21b)]()[_0x5b09c1(0x21f)](a4_0x5be6c4)[_0x5b09c1(0x1d2)](_0x5b09c1(0x1f4));});a4_0x5be6c4();'use strict';function a4_0x3879(){const _0x4a11bf=['LTM.rawEventLog','LTM.trainingData.thermodynamics','setStateAsync','klima','toISOString','round','includes','push','isExit','config','switch','loc','weatherunderground','system.isPresent','sendToPythonWrapper','name','868828tzpZCR','useWeather','temperature','unshift','normal','exitGraceTimer','licht','isGracePeriodActive','sensorLastValues','value','toString','presence','rawEventLog','stringify','constructor','splice','logDuplicates','1dLpUgl','window','pop','heizung','LTM.trainingData.sequences','search','contact','val','lampe','5346090hSYvzC','parse','daswetter','now','.Current.Temperature','fenster','motion','ANALYZE_SEQUENCE','currentSystemMode','apply','message','weatherInstance','präsenz','Unknown','getForeignStateAsync','1793010jAfwNg','location','type','[RECORDER]\x20Error:\x20','2428464CKPduc','kontakt','events.history','bewegung','light','occupancy','.forecast.current.temperature','error','eventHistory','length','10jRAErZ','(((.+)+)+)+$','exitTimer','875428uUGSMs','isProVersion','shift','7INJpCz','1002096cmOmuI','isPresent','temperatur','.NextHours.Location_1.Day_1.current.temp_value','491994aWERGp','events.lastEvent','dimmer'];a4_0x3879=function(){return _0x4a11bf;};return a4_0x3879();}const HISTORY_MAX_SIZE=0x32,RAW_LOG_MAX_SIZE=0x9c4,THERMO_LOG_SIZE=0x3e8,SEQUENCE_TIMEOUT_MS=0x5*0x3c*0x3e8,MAX_TRAINING_SET_SIZE=0x1f4,EXIT_TIMER_MINUTES=0xf,EXIT_GRACE_PERIOD_SECONDS=0x1e;let activeSequence=[],sequenceTimer=null;async function getOutsideTemperatureNumeric(_0x5a2477){const _0x201c22=a4_0x3002;if(_0x5a2477['config']['outdoorSensorId'])try{const _0xe85ff3=await _0x5a2477[_0x201c22(0x1e4)](_0x5a2477[_0x201c22(0x20a)]['outdoorSensorId']);if(_0xe85ff3&&_0xe85ff3['val']!==undefined&&_0xe85ff3[_0x201c22(0x1d4)]!==null)return parseFloat(_0xe85ff3[_0x201c22(0x1d4)]);}catch(_0x2863c0){}const _0x57affe=_0x5a2477['config'][_0x201c22(0x1e1)];if(!_0x5a2477[_0x201c22(0x20a)][_0x201c22(0x212)]||!_0x57affe)return null;try{let _0x33b04c='';if(_0x57affe[_0x201c22(0x207)]('accuweather'))_0x33b04c=_0x57affe+_0x201c22(0x1da);else{if(_0x57affe['includes'](_0x201c22(0x1d8)))_0x33b04c=_0x57affe+_0x201c22(0x1fd);else{if(_0x57affe[_0x201c22(0x207)]('openweathermap'))_0x33b04c=_0x57affe+_0x201c22(0x1ef);else{if(_0x57affe[_0x201c22(0x207)](_0x201c22(0x20d)))_0x33b04c=_0x57affe+'.forecast.current.temp';}}}if(_0x33b04c){const _0x1fb196=await _0x5a2477[_0x201c22(0x1e4)](_0x33b04c);if(_0x1fb196&&_0x1fb196[_0x201c22(0x1d4)]!==undefined&&_0x1fb196[_0x201c22(0x1d4)]!==null)return parseFloat(_0x1fb196[_0x201c22(0x1d4)]);}}catch(_0x1a9701){}return null;}async function recordThermodynamics(_0x4cc48b,_0x32555f,_0x2b12f1,_0x4a5eac){const _0x59e49c=a4_0x3002,_0x38981f=await getOutsideTemperatureNumeric(_0x4cc48b),_0x10acae=await _0x4cc48b['getStateAsync']('LTM.trainingData.thermodynamics');let _0x1c6fbb=[];if(_0x10acae&&_0x10acae[_0x59e49c(0x1d4)])try{_0x1c6fbb=JSON[_0x59e49c(0x1d7)](_0x10acae[_0x59e49c(0x1d4)]);}catch(_0x18cc8f){}_0x1c6fbb['push']({'ts':Date['now'](),'room':_0x4a5eac||'Unknown','t_in':_0x2b12f1,'t_out':_0x38981f});if(_0x1c6fbb['length']>THERMO_LOG_SIZE)_0x1c6fbb[_0x59e49c(0x1f8)]();await _0x4cc48b[_0x59e49c(0x203)](_0x59e49c(0x202),{'val':JSON[_0x59e49c(0x21e)](_0x1c6fbb),'ack':!![]});}async function saveCompletedSequence(_0x411b53){const _0x9de30a=a4_0x3002;try{const _0x10fb31=await _0x411b53['getStateAsync'](_0x9de30a(0x226));let _0x45ed1c=[];if(_0x10fb31&&_0x10fb31[_0x9de30a(0x1d4)])try{_0x45ed1c=JSON[_0x9de30a(0x1d7)](_0x10fb31[_0x9de30a(0x1d4)]);}catch(_0x584281){}const _0x5e42e4=activeSequence[0x0]['ts'],_0x2e1e3d=activeSequence['map'](_0x33254b=>({'loc':_0x33254b[_0x9de30a(0x20c)],'t_delta':Math[_0x9de30a(0x206)]((_0x33254b['ts']-_0x5e42e4)/0x3e8)})),_0x10aaf5={'timestamp':new Date(_0x5e42e4)[_0x9de30a(0x205)](),'steps':_0x2e1e3d,'duration':Math['round']((activeSequence[activeSequence[_0x9de30a(0x1f2)]-0x1]['ts']-_0x5e42e4)/0x3e8),'daytime':new Date(_0x5e42e4)['getHours']()};_0x45ed1c[_0x9de30a(0x208)](_0x10aaf5);if(_0x45ed1c[_0x9de30a(0x1f2)]>MAX_TRAINING_SET_SIZE)_0x45ed1c[_0x9de30a(0x1f8)]();await _0x411b53[_0x9de30a(0x203)](_0x9de30a(0x226),{'val':JSON[_0x9de30a(0x21e)](_0x45ed1c),'ack':!![]}),_0x411b53[_0x9de30a(0x1f7)]&&_0x411b53[_0x9de30a(0x20f)]&&_0x411b53[_0x9de30a(0x20f)](_0x9de30a(0x1dd),{'sequence':_0x10aaf5});}catch(_0x5b5917){_0x411b53['log'][_0x9de30a(0x1f0)](_0x9de30a(0x1e8)+_0x5b5917[_0x9de30a(0x1e0)]);}}async function recordSequence(_0x604462,_0x2357ba){const _0xc52517=a4_0x3002,_0x270688=(_0x2357ba[_0xc52517(0x1e7)]||'')['toLowerCase'](),_0x2cd812=['motion',_0xc52517(0x1ec),_0xc52517(0x1e2),_0xc52517(0x21c),_0xc52517(0x1ee),'door','tür',_0xc52517(0x223),_0xc52517(0x1db),_0xc52517(0x1d3),_0xc52517(0x1ea),_0xc52517(0x1ed),_0xc52517(0x217),_0xc52517(0x20b),'schalter',_0xc52517(0x200),_0xc52517(0x1d5)];if(!_0x2cd812['some'](_0x37b1f2=>_0x270688[_0xc52517(0x207)](_0x37b1f2)))return;if(!_0x2357ba[_0xc52517(0x21a)])return;if(sequenceTimer)clearTimeout(sequenceTimer);activeSequence[_0xc52517(0x208)]({'loc':_0x2357ba[_0xc52517(0x1e6)]||_0xc52517(0x1e3),'id':_0x2357ba['id'],'ts':Date[_0xc52517(0x1d9)]()}),sequenceTimer=setTimeout(async()=>{if(activeSequence['length']>0x1)await saveCompletedSequence(_0x604462);activeSequence=[];},SEQUENCE_TIMEOUT_MS);}function startExitTimer(_0x2b5063){const _0x468e8f=a4_0x3002;abortExitTimer(_0x2b5063),_0x2b5063[_0x468e8f(0x218)]=!![],_0x2b5063[_0x468e8f(0x216)]=setTimeout(()=>{const _0x3b7c4e=_0x468e8f;_0x2b5063[_0x3b7c4e(0x218)]=![];},EXIT_GRACE_PERIOD_SECONDS*0x3e8),_0x2b5063['exitTimer']=setTimeout(()=>{const _0x1f3667=_0x468e8f;setPresence(_0x2b5063,![]),_0x2b5063[_0x1f3667(0x1f5)]=null;},EXIT_TIMER_MINUTES*0x3c*0x3e8);}function a4_0x3002(_0x78467c,_0x403fef){const _0x10ad75=a4_0x3879();return a4_0x3002=function(_0x5be6c4,_0x2d4006){_0x5be6c4=_0x5be6c4-0x1d2;let _0x3879c9=_0x10ad75[_0x5be6c4];return _0x3879c9;},a4_0x3002(_0x78467c,_0x403fef);}function abortExitTimer(_0x3a6094){const _0x45813c=a4_0x3002;if(_0x3a6094[_0x45813c(0x1f5)])clearTimeout(_0x3a6094[_0x45813c(0x1f5)]);if(_0x3a6094[_0x45813c(0x216)])clearTimeout(_0x3a6094['exitGraceTimer']);_0x3a6094[_0x45813c(0x1f5)]=null,_0x3a6094[_0x45813c(0x216)]=null,_0x3a6094[_0x45813c(0x218)]=![];}async function setPresence(_0x502a4d,_0x36dd5c){const _0x14de60=a4_0x3002;if(_0x502a4d[_0x14de60(0x1fb)]===_0x36dd5c)return;_0x502a4d[_0x14de60(0x1fb)]=_0x36dd5c,await _0x502a4d[_0x14de60(0x203)](_0x14de60(0x20e),{'val':_0x36dd5c,'ack':!![]});}async function processSensorEvent(_0x33903f,_0x57078d,_0x4b4ab2,_0x3e8b33){const _0x394d36=a4_0x3002;if(!_0x3e8b33)return;const _0x4439c9=_0x4b4ab2[_0x394d36(0x1d4)],_0x509845=Date[_0x394d36(0x1d9)](),_0x15c862=_0x33903f[_0x394d36(0x219)][_0x57078d];_0x33903f[_0x394d36(0x219)][_0x57078d]=_0x4439c9;if(!_0x3e8b33[_0x394d36(0x221)]&&_0x15c862!=undefined&&_0x15c862==_0x4439c9)return;const _0x360376=(_0x3e8b33[_0x394d36(0x1e7)]||'')['toLowerCase'](),_0x3c8052=_0x360376['includes'](_0x394d36(0x213))||_0x360376[_0x394d36(0x207)](_0x394d36(0x1fc))||_0x360376[_0x394d36(0x207)](_0x394d36(0x204))||_0x360376[_0x394d36(0x207)](_0x394d36(0x225));_0x33903f['isProVersion']&&_0x3c8052&&recordThermodynamics(_0x33903f,_0x57078d,_0x4439c9,_0x3e8b33[_0x394d36(0x1e6)]);const _0xff3d09={'timestamp':_0x509845,'id':_0x57078d,'name':_0x3e8b33[_0x394d36(0x210)],'type':_0x3e8b33['type'],'location':_0x3e8b33[_0x394d36(0x1e6)],'value':_0x4439c9};_0x33903f[_0x394d36(0x1f1)][_0x394d36(0x214)](_0xff3d09);if(_0x33903f[_0x394d36(0x1f1)][_0x394d36(0x1f2)]>HISTORY_MAX_SIZE)_0x33903f[_0x394d36(0x1f1)][_0x394d36(0x224)]();await _0x33903f[_0x394d36(0x203)](_0x394d36(0x1ff),{'val':JSON[_0x394d36(0x21e)](_0xff3d09),'ack':!![]}),await _0x33903f[_0x394d36(0x203)](_0x394d36(0x1eb),{'val':JSON[_0x394d36(0x21e)](_0x33903f[_0x394d36(0x1f1)]),'ack':!![]});if(_0x33903f[_0x394d36(0x1f7)]){_0x33903f['rawEventLog'][_0x394d36(0x208)](_0xff3d09);if(_0x33903f[_0x394d36(0x21d)][_0x394d36(0x1f2)]>RAW_LOG_MAX_SIZE)_0x33903f[_0x394d36(0x21d)][_0x394d36(0x220)](0x0,_0x33903f['rawEventLog'][_0x394d36(0x1f2)]-RAW_LOG_MAX_SIZE);await _0x33903f['setStateAsync'](_0x394d36(0x201),{'val':JSON[_0x394d36(0x21e)](_0x33903f[_0x394d36(0x21d)]),'ack':!![]}),recordSequence(_0x33903f,_0xff3d09);}if(_0x3e8b33[_0x394d36(0x209)]&&_0x4439c9===!![]){if(_0x33903f[_0x394d36(0x1fb)]&&!_0x33903f[_0x394d36(0x218)])startExitTimer(_0x33903f);else{if(!_0x33903f[_0x394d36(0x1fb)])setPresence(_0x33903f,!![]);}}else{if(_0x3e8b33[_0x394d36(0x1e7)]===_0x394d36(0x1dc)&&_0x4439c9===!![]){if(_0x33903f['exitTimer'])abortExitTimer(_0x33903f);if(!_0x33903f['isPresent']&&_0x33903f[_0x394d36(0x1de)]===_0x394d36(0x215))setPresence(_0x33903f,!![]);}}_0x33903f['isProVersion']&&_0x3e8b33[_0x394d36(0x1e7)]==='motion'&&_0x4439c9===!![]&&_0x3e8b33[_0x394d36(0x1e6)]&&_0x33903f[_0x394d36(0x20f)]&&_0x33903f['sendToPythonWrapper']('SIMULATE_SIGNAL',{'room':_0x3e8b33[_0x394d36(0x1e6)]});}module['exports']={'processSensorEvent':processSensorEvent,'getOutsideTemperatureNumeric':getOutsideTemperatureNumeric,'setPresence':setPresence,'abortExitTimer':abortExitTimer,'startExitTimer':startExitTimer};