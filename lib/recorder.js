(function(_0x877d28,_0x339b2d){const _0x15d1ca=a5_0x2bff,_0x265f6e=_0x877d28();while(!![]){try{const _0x51d75a=parseInt(_0x15d1ca(0x147))/0x1+-parseInt(_0x15d1ca(0x138))/0x2+-parseInt(_0x15d1ca(0x120))/0x3*(-parseInt(_0x15d1ca(0x121))/0x4)+parseInt(_0x15d1ca(0x167))/0x5*(parseInt(_0x15d1ca(0x172))/0x6)+parseInt(_0x15d1ca(0x14c))/0x7+-parseInt(_0x15d1ca(0x145))/0x8+-parseInt(_0x15d1ca(0x171))/0x9*(parseInt(_0x15d1ca(0x12f))/0xa);if(_0x51d75a===_0x339b2d)break;else _0x265f6e['push'](_0x265f6e['shift']());}catch(_0x2eec72){_0x265f6e['push'](_0x265f6e['shift']());}}}(a5_0x1289,0xadb90));const a5_0x36ae64=(function(){let _0x2c15d7=!![];return function(_0x44a674,_0x55d61a){const _0xed6f3a=_0x2c15d7?function(){if(_0x55d61a){const _0x1acc39=_0x55d61a['apply'](_0x44a674,arguments);return _0x55d61a=null,_0x1acc39;}}:function(){};return _0x2c15d7=![],_0xed6f3a;};}()),a5_0x33e752=a5_0x36ae64(this,function(){const _0x364455=a5_0x2bff;return a5_0x33e752[_0x364455(0x124)]()['search'](_0x364455(0x12b))[_0x364455(0x124)]()[_0x364455(0x14b)](a5_0x33e752)[_0x364455(0x169)](_0x364455(0x12b));});a5_0x33e752();'use strict';const HISTORY_MAX_SIZE=0x32,RAW_LOG_MAX_SIZE=0x9c4,THERMO_LOG_SIZE=0x3e8,SEQUENCE_TIMEOUT_MS=0x5*0x3c*0x3e8,MAX_TRAINING_SET_SIZE=0x1f4,EXIT_TIMER_MINUTES=0xf,EXIT_GRACE_PERIOD_SECONDS=0x1e;let activeSequence=[],sequenceTimer=null;async function getOutsideTemperatureNumeric(_0x2bd150){const _0x12b5b1=a5_0x2bff;if(_0x2bd150[_0x12b5b1(0x15d)][_0x12b5b1(0x13f)])try{const _0x1913af=await _0x2bd150[_0x12b5b1(0x135)](_0x2bd150[_0x12b5b1(0x15d)][_0x12b5b1(0x13f)]);if(_0x1913af&&_0x1913af['val']!==undefined&&_0x1913af[_0x12b5b1(0x144)]!==null)return parseFloat(_0x1913af['val']);}catch(_0x2f3111){}const _0x21ced3=_0x2bd150[_0x12b5b1(0x15d)][_0x12b5b1(0x158)];if(!_0x2bd150['config']['useWeather']||!_0x21ced3)return null;try{let _0x33397c='';if(_0x21ced3['includes'](_0x12b5b1(0x13e)))_0x33397c=_0x21ced3+'.Current.Temperature';else{if(_0x21ced3['includes'](_0x12b5b1(0x12c)))_0x33397c=_0x21ced3+_0x12b5b1(0x16c);else{if(_0x21ced3['includes'](_0x12b5b1(0x146)))_0x33397c=_0x21ced3+_0x12b5b1(0x12e);else{if(_0x21ced3['includes']('weatherunderground'))_0x33397c=_0x21ced3+_0x12b5b1(0x163);}}}if(_0x33397c){const _0x1869ab=await _0x2bd150[_0x12b5b1(0x135)](_0x33397c);if(_0x1869ab&&_0x1869ab['val']!==undefined&&_0x1869ab['val']!==null)return parseFloat(_0x1869ab[_0x12b5b1(0x144)]);}}catch(_0x10b771){}return null;}async function recordThermodynamics(_0x2a1107,_0x3809a2,_0x2d7cf1,_0x9d4add){const _0x2aeb08=a5_0x2bff,_0x3dbd81=await getOutsideTemperatureNumeric(_0x2a1107),_0x3ff021=await _0x2a1107['getStateAsync'](_0x2aeb08(0x164));let _0x2d0f98=[];if(_0x3ff021&&_0x3ff021['val'])try{_0x2d0f98=JSON[_0x2aeb08(0x153)](_0x3ff021[_0x2aeb08(0x144)]);}catch(_0x3679b6){}_0x2d0f98[_0x2aeb08(0x16e)]({'ts':Date[_0x2aeb08(0x132)](),'room':_0x9d4add||_0x2aeb08(0x170),'t_in':_0x2d7cf1,'t_out':_0x3dbd81});if(_0x2d0f98['length']>THERMO_LOG_SIZE)_0x2d0f98[_0x2aeb08(0x155)]();await _0x2a1107[_0x2aeb08(0x123)](_0x2aeb08(0x164),{'val':JSON[_0x2aeb08(0x150)](_0x2d0f98),'ack':!![]});}async function saveCompletedSequence(_0x249e2a){const _0x2db6b8=a5_0x2bff;try{const _0x5ac9ac=await _0x249e2a[_0x2db6b8(0x133)](_0x2db6b8(0x143));let _0x559544=[];if(_0x5ac9ac&&_0x5ac9ac[_0x2db6b8(0x144)])try{_0x559544=JSON[_0x2db6b8(0x153)](_0x5ac9ac['val']);}catch(_0x5f364d){}const _0x29f1c2=activeSequence[0x0]['ts'],_0x191999=activeSequence[_0x2db6b8(0x16b)](_0x56a8fb=>({'loc':_0x56a8fb[_0x2db6b8(0x131)],'t_delta':Math[_0x2db6b8(0x149)]((_0x56a8fb['ts']-_0x29f1c2)/0x3e8)})),_0x55b862={'timestamp':new Date(_0x29f1c2)[_0x2db6b8(0x139)](),'steps':_0x191999,'duration':Math[_0x2db6b8(0x149)]((activeSequence[activeSequence['length']-0x1]['ts']-_0x29f1c2)/0x3e8),'daytime':new Date(_0x29f1c2)[_0x2db6b8(0x173)]()};_0x559544['push'](_0x55b862);if(_0x559544['length']>MAX_TRAINING_SET_SIZE)_0x559544[_0x2db6b8(0x155)]();await _0x249e2a['setStateAsync'](_0x2db6b8(0x143),{'val':JSON[_0x2db6b8(0x150)](_0x559544),'ack':!![]}),_0x249e2a[_0x2db6b8(0x166)]&&_0x249e2a[_0x2db6b8(0x154)]&&_0x249e2a[_0x2db6b8(0x154)](_0x2db6b8(0x141),{'sequence':_0x55b862});}catch(_0x350ead){_0x249e2a['log'][_0x2db6b8(0x14a)](_0x2db6b8(0x122)+_0x350ead[_0x2db6b8(0x140)]);}}async function recordSequence(_0x41b449,_0x24264f){const _0x3de592=a5_0x2bff,_0x10cdd9=(_0x24264f['type']||'')[_0x3de592(0x162)](),_0x4b955a=[_0x3de592(0x157),_0x3de592(0x15c),_0x3de592(0x14e),_0x3de592(0x161),_0x3de592(0x130),'door',_0x3de592(0x137),_0x3de592(0x136),_0x3de592(0x125),_0x3de592(0x12d),_0x3de592(0x152),_0x3de592(0x16d),_0x3de592(0x13d),_0x3de592(0x159),_0x3de592(0x15f),_0x3de592(0x156),_0x3de592(0x165)];if(!_0x4b955a[_0x3de592(0x15a)](_0x1f0a3c=>_0x10cdd9[_0x3de592(0x174)](_0x1f0a3c)))return;if(!_0x24264f['value'])return;if(sequenceTimer)clearTimeout(sequenceTimer);activeSequence[_0x3de592(0x16e)]({'loc':_0x24264f[_0x3de592(0x129)]||_0x3de592(0x170),'id':_0x24264f['id'],'ts':Date[_0x3de592(0x132)]()}),sequenceTimer=setTimeout(async()=>{const _0x136dcf=_0x3de592;if(activeSequence[_0x136dcf(0x142)]>0x1)await saveCompletedSequence(_0x41b449);activeSequence=[];},SEQUENCE_TIMEOUT_MS);}function a5_0x1289(){const _0x4c6cf1=['outdoorSensorId','message','ANALYZE_SEQUENCE','length','LTM.trainingData.sequences','val','7604056gmlDds','openweathermap','792511NxvXYN','splice','round','error','constructor','6666296ekcdqj','name','präsenz','sensorLastValues','stringify','pop','kontakt','parse','sendToPythonWrapper','shift','dimmer','motion','weatherInstance','switch','some','SIMULATE_SIGNAL','bewegung','config','temperatur','schalter','type','presence','toLowerCase','.forecast.current.temp','LTM.trainingData.thermodynamics','lampe','isProVersion','155805kAgVKO','events.history','search','isGracePeriodActive','map','.NextHours.Location_1.Day_1.current.temp_value','light','push','rawEventLog','Unknown','9ANbtxc','66PbnSUu','getHours','includes','events.lastEvent','15XAJwmj','548196zUXwoT','[RECORDER]\x20Error:\x20','setStateAsync','toString','fenster','system.isPresent','eventHistory','exitGraceTimer','location','LTM.rawEventLog','(((.+)+)+)+$','daswetter','contact','.forecast.current.temperature','6142810QiLOxp','occupancy','loc','now','getStateAsync','isPresent','getForeignStateAsync','window','tür','992998ZXCtPS','toISOString','isExit','exitTimer','unshift','licht','accuweather'];a5_0x1289=function(){return _0x4c6cf1;};return a5_0x1289();}function a5_0x2bff(_0xbfcf77,_0x5b71c0){const _0x491797=a5_0x1289();return a5_0x2bff=function(_0x33e752,_0x36ae64){_0x33e752=_0x33e752-0x120;let _0x1289cc=_0x491797[_0x33e752];return _0x1289cc;},a5_0x2bff(_0xbfcf77,_0x5b71c0);}function startExitTimer(_0x341c2b){const _0x5bd77c=a5_0x2bff;abortExitTimer(_0x341c2b),_0x341c2b['isGracePeriodActive']=!![],_0x341c2b[_0x5bd77c(0x128)]=setTimeout(()=>{const _0x4f93fe=_0x5bd77c;_0x341c2b[_0x4f93fe(0x16a)]=![];},EXIT_GRACE_PERIOD_SECONDS*0x3e8),_0x341c2b[_0x5bd77c(0x13b)]=setTimeout(()=>{const _0x2c869c=_0x5bd77c;setPresence(_0x341c2b,![]),_0x341c2b[_0x2c869c(0x13b)]=null;},EXIT_TIMER_MINUTES*0x3c*0x3e8);}function abortExitTimer(_0x2e4c56){const _0x242750=a5_0x2bff;if(_0x2e4c56[_0x242750(0x13b)])clearTimeout(_0x2e4c56[_0x242750(0x13b)]);if(_0x2e4c56[_0x242750(0x128)])clearTimeout(_0x2e4c56[_0x242750(0x128)]);_0x2e4c56[_0x242750(0x13b)]=null,_0x2e4c56['exitGraceTimer']=null,_0x2e4c56['isGracePeriodActive']=![];}async function setPresence(_0x2a16f2,_0x353b7f){const _0x1036f1=a5_0x2bff;if(_0x2a16f2[_0x1036f1(0x134)]===_0x353b7f)return;_0x2a16f2[_0x1036f1(0x134)]=_0x353b7f,await _0x2a16f2[_0x1036f1(0x123)](_0x1036f1(0x126),{'val':_0x353b7f,'ack':!![]});}async function processSensorEvent(_0x2a1a65,_0x5aa520,_0x313314,_0x17d9e5){const _0x1e7121=a5_0x2bff;if(!_0x17d9e5)return null;const _0x94539e=_0x313314['val'],_0x3af0a4=Date['now'](),_0x3e6257=_0x2a1a65['sensorLastValues'][_0x5aa520];_0x2a1a65[_0x1e7121(0x14f)][_0x5aa520]=_0x94539e;if(!_0x17d9e5['logDuplicates']&&_0x3e6257!=undefined&&_0x3e6257==_0x94539e)return null;const _0x5efe55=(_0x17d9e5[_0x1e7121(0x160)]||'')[_0x1e7121(0x162)](),_0x487208=_0x5efe55[_0x1e7121(0x174)]('temperature')||_0x5efe55[_0x1e7121(0x174)](_0x1e7121(0x15e))||_0x5efe55[_0x1e7121(0x174)]('klima')||_0x5efe55[_0x1e7121(0x174)]('heizung');_0x2a1a65[_0x1e7121(0x166)]&&_0x487208&&recordThermodynamics(_0x2a1a65,_0x5aa520,_0x94539e,_0x17d9e5[_0x1e7121(0x129)]);const _0x361cc3={'timestamp':_0x3af0a4,'id':_0x5aa520,'name':_0x17d9e5[_0x1e7121(0x14d)],'type':_0x17d9e5[_0x1e7121(0x160)],'location':_0x17d9e5[_0x1e7121(0x129)],'value':_0x94539e};_0x2a1a65['eventHistory'][_0x1e7121(0x13c)](_0x361cc3);if(_0x2a1a65[_0x1e7121(0x127)][_0x1e7121(0x142)]>HISTORY_MAX_SIZE)_0x2a1a65[_0x1e7121(0x127)][_0x1e7121(0x151)]();await _0x2a1a65['setStateAsync'](_0x1e7121(0x175),{'val':JSON['stringify'](_0x361cc3),'ack':!![]}),await _0x2a1a65['setStateAsync'](_0x1e7121(0x168),{'val':JSON[_0x1e7121(0x150)](_0x2a1a65[_0x1e7121(0x127)]),'ack':!![]});if(_0x2a1a65[_0x1e7121(0x166)]){_0x2a1a65[_0x1e7121(0x16f)][_0x1e7121(0x16e)](_0x361cc3);if(_0x2a1a65['rawEventLog'][_0x1e7121(0x142)]>RAW_LOG_MAX_SIZE)_0x2a1a65[_0x1e7121(0x16f)][_0x1e7121(0x148)](0x0,_0x2a1a65[_0x1e7121(0x16f)][_0x1e7121(0x142)]-RAW_LOG_MAX_SIZE);await _0x2a1a65[_0x1e7121(0x123)](_0x1e7121(0x12a),{'val':JSON[_0x1e7121(0x150)](_0x2a1a65['rawEventLog']),'ack':!![]}),recordSequence(_0x2a1a65,_0x361cc3);}if(_0x17d9e5[_0x1e7121(0x13a)]&&_0x94539e===!![]){if(_0x2a1a65[_0x1e7121(0x134)]&&!_0x2a1a65[_0x1e7121(0x16a)])startExitTimer(_0x2a1a65);else{if(!_0x2a1a65[_0x1e7121(0x134)])setPresence(_0x2a1a65,!![]);}}else{if(_0x17d9e5['type']==='motion'&&_0x94539e===!![]){if(_0x2a1a65[_0x1e7121(0x13b)])abortExitTimer(_0x2a1a65);if(!_0x2a1a65[_0x1e7121(0x134)]&&_0x2a1a65['currentSystemMode']==='normal')setPresence(_0x2a1a65,!![]);}}return _0x2a1a65[_0x1e7121(0x166)]&&_0x17d9e5['type']===_0x1e7121(0x157)&&_0x94539e===!![]&&_0x17d9e5['location']&&_0x2a1a65[_0x1e7121(0x154)]&&_0x2a1a65[_0x1e7121(0x154)](_0x1e7121(0x15b),{'room':_0x17d9e5[_0x1e7121(0x129)]}),_0x361cc3;}module['exports']={'processSensorEvent':processSensorEvent,'getOutsideTemperatureNumeric':getOutsideTemperatureNumeric,'setPresence':setPresence,'abortExitTimer':abortExitTimer,'startExitTimer':startExitTimer};