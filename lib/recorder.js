const a5_0x303edb=a5_0x3feb;(function(_0x2d96f0,_0x4a46de){const _0xb00fd1=a5_0x3feb,_0x2768a1=_0x2d96f0();while(!![]){try{const _0x22e2ed=parseInt(_0xb00fd1(0x208))/0x1+-parseInt(_0xb00fd1(0x1c2))/0x2+parseInt(_0xb00fd1(0x1cb))/0x3*(-parseInt(_0xb00fd1(0x21f))/0x4)+parseInt(_0xb00fd1(0x1bf))/0x5+-parseInt(_0xb00fd1(0x1d3))/0x6*(parseInt(_0xb00fd1(0x1de))/0x7)+-parseInt(_0xb00fd1(0x1ed))/0x8*(parseInt(_0xb00fd1(0x1e5))/0x9)+parseInt(_0xb00fd1(0x224))/0xa*(parseInt(_0xb00fd1(0x1f0))/0xb);if(_0x22e2ed===_0x4a46de)break;else _0x2768a1['push'](_0x2768a1['shift']());}catch(_0x596a8a){_0x2768a1['push'](_0x2768a1['shift']());}}}(a5_0x3145,0x89413));const a5_0x1c4e02=(function(){let _0x2816de=!![];return function(_0x341e0a,_0x4c9cf3){const _0x161b2b=_0x2816de?function(){const _0x32a040=a5_0x3feb;if(_0x4c9cf3){const _0x4c6d91=_0x4c9cf3[_0x32a040(0x1c7)](_0x341e0a,arguments);return _0x4c9cf3=null,_0x4c6d91;}}:function(){};return _0x2816de=![],_0x161b2b;};}()),a5_0xfc6b0e=a5_0x1c4e02(this,function(){const _0x29e68b=a5_0x3feb;return a5_0xfc6b0e[_0x29e68b(0x1d9)]()[_0x29e68b(0x1cc)]('(((.+)+)+)+$')[_0x29e68b(0x1d9)]()['constructor'](a5_0xfc6b0e)['search'](_0x29e68b(0x22b));});a5_0xfc6b0e();'use strict';const HISTORY_MAX_SIZE=0x32,RAW_LOG_MAX_SIZE=0x9c4,THERMO_LOG_SIZE=0x3e8,SEQUENCE_TIMEOUT_MS=0x5*0x3c*0x3e8,MAX_TRAINING_SET_SIZE=0x1f4,EXIT_TIMER_MINUTES=0xf,EXIT_GRACE_PERIOD_SECONDS=0x1e;let activeSequence=[],sequenceTimer=null;async function getOutsideTemperatureNumeric(_0x4b9230){const _0xd4212d=a5_0x3feb;if(_0x4b9230[_0xd4212d(0x229)][_0xd4212d(0x20f)])try{const _0x130fbd=await _0x4b9230['getForeignStateAsync'](_0x4b9230[_0xd4212d(0x229)][_0xd4212d(0x20f)]);if(_0x130fbd&&_0x130fbd[_0xd4212d(0x1d1)]!==undefined&&_0x130fbd[_0xd4212d(0x1d1)]!==null)return parseFloat(_0x130fbd[_0xd4212d(0x1d1)]);}catch(_0x637602){}const _0x17e363=_0x4b9230[_0xd4212d(0x229)][_0xd4212d(0x1ce)];if(!_0x4b9230['config'][_0xd4212d(0x21e)]||!_0x17e363)return null;try{let _0x5a03c8='';if(_0x17e363[_0xd4212d(0x222)](_0xd4212d(0x1fd)))_0x5a03c8=_0x17e363+_0xd4212d(0x1ee);else{if(_0x17e363['includes']('daswetter'))_0x5a03c8=_0x17e363+_0xd4212d(0x214);else{if(_0x17e363[_0xd4212d(0x222)](_0xd4212d(0x1c5)))_0x5a03c8=_0x17e363+'.forecast.current.temperature';else{if(_0x17e363[_0xd4212d(0x222)](_0xd4212d(0x1e6)))_0x5a03c8=_0x17e363+_0xd4212d(0x1d2);}}}if(_0x5a03c8){const _0x1955aa=await _0x4b9230['getForeignStateAsync'](_0x5a03c8);if(_0x1955aa&&_0x1955aa[_0xd4212d(0x1d1)]!==undefined&&_0x1955aa[_0xd4212d(0x1d1)]!==null)return parseFloat(_0x1955aa['val']);}}catch(_0xc18d33){}return null;}async function recordThermodynamics(_0x3b4357,_0x5b0c61,_0x33c29d,_0x281b52){const _0x16cd80=a5_0x3feb,_0x557035=await getOutsideTemperatureNumeric(_0x3b4357);if(_0x557035===null)return;let _0x391db7=0x0,_0x359d06=![];if(_0x3b4357[_0x16cd80(0x229)]['valveMapping'])try{let _0x209da8=_0x3b4357['config'][_0x16cd80(0x1c4)];if(typeof _0x209da8===_0x16cd80(0x226))_0x209da8=JSON[_0x16cd80(0x1e7)](_0x209da8);if(_0x209da8[_0x5b0c61]){const _0x4208c7=_0x209da8[_0x5b0c61],_0x4e2235=await _0x3b4357[_0x16cd80(0x1c1)](_0x4208c7);if(_0x4e2235&&_0x4e2235[_0x16cd80(0x1d1)]!==null&&_0x4e2235[_0x16cd80(0x1d1)]!==undefined){let _0x408938=Number(_0x4e2235[_0x16cd80(0x1d1)]);if(_0x408938<=1.05&&!_0x4208c7[_0x16cd80(0x222)](_0x16cd80(0x1c9))&&!_0x4208c7['includes'](_0x16cd80(0x1f1)))_0x408938=_0x408938*0x64;_0x391db7=Math[_0x16cd80(0x1d6)](_0x408938),_0x359d06=!![];}}}catch(_0x4e1816){}if(!_0x359d06){const _0x4dd3b5=[{'from':'.1.ACTUAL_TEMPERATURE','to':_0x16cd80(0x1fe)},{'from':_0x16cd80(0x1d7),'to':_0x16cd80(0x1c3)},{'from':_0x16cd80(0x220),'to':_0x16cd80(0x1c6)},{'from':'.ACTUAL_TEMPERATURE','to':_0x16cd80(0x1e9)},{'from':'temperature','to':_0x16cd80(0x1cf)},{'from':_0x16cd80(0x1f8),'to':_0x16cd80(0x1fa)}];for(const _0x10cd5a of _0x4dd3b5){if(_0x5b0c61[_0x16cd80(0x222)](_0x10cd5a['from'])){const _0x34c447=_0x5b0c61[_0x16cd80(0x1be)](_0x10cd5a[_0x16cd80(0x1f9)],_0x10cd5a['to']);try{const _0x48b3b6=await _0x3b4357[_0x16cd80(0x1c1)](_0x34c447);if(_0x48b3b6&&_0x48b3b6[_0x16cd80(0x1d1)]!==null&&_0x48b3b6['val']!==undefined){let _0x1580bc=Number(_0x48b3b6[_0x16cd80(0x1d1)]);if(typeof _0x1580bc===_0x16cd80(0x1da)){if(_0x1580bc<=1.05&&_0x10cd5a['to'][_0x16cd80(0x222)]('LEVEL'))_0x1580bc=_0x1580bc*0x64;_0x391db7=Math[_0x16cd80(0x1d6)](_0x1580bc),_0x359d06=!![];break;}}}catch(_0x3a0595){}}}}const _0x325f93=await _0x3b4357[_0x16cd80(0x1e1)](_0x16cd80(0x20a));let _0x216345=[];if(_0x325f93&&_0x325f93[_0x16cd80(0x1d1)])try{_0x216345=JSON[_0x16cd80(0x1e7)](_0x325f93[_0x16cd80(0x1d1)]);}catch(_0x1eba91){}_0x216345[_0x16cd80(0x1fc)]({'ts':Date[_0x16cd80(0x1e3)](),'room':_0x281b52||'Unknown','t_in':_0x33c29d,'t_out':_0x557035,'valve':_0x391db7});if(_0x216345['length']>THERMO_LOG_SIZE)_0x216345[_0x16cd80(0x210)]();await _0x3b4357[_0x16cd80(0x1ca)]('LTM.trainingData.thermodynamics',{'val':JSON[_0x16cd80(0x22a)](_0x216345),'ack':!![]});}function a5_0x3feb(_0x341d06,_0x49e81d){const _0x4c7bed=a5_0x3145();return a5_0x3feb=function(_0xfc6b0e,_0x1c4e02){_0xfc6b0e=_0xfc6b0e-0x1be;let _0x3145ea=_0x4c7bed[_0xfc6b0e];return _0x3145ea;},a5_0x3feb(_0x341d06,_0x49e81d);}async function saveCompletedSequence(_0x1b553c){const _0x5b07a8=a5_0x3feb;try{const _0x5582b8=await _0x1b553c[_0x5b07a8(0x1e1)](_0x5b07a8(0x1fb));let _0x5b4dc1=[];if(_0x5582b8&&_0x5582b8['val'])try{_0x5b4dc1=JSON[_0x5b07a8(0x1e7)](_0x5582b8[_0x5b07a8(0x1d1)]);}catch(_0x286d64){}const _0x2b472b=activeSequence[0x0]['ts'],_0xe3ec7f=activeSequence[_0x5b07a8(0x1f6)](_0xb08142=>({'loc':_0xb08142['loc'],'t_delta':Math[_0x5b07a8(0x1d6)]((_0xb08142['ts']-_0x2b472b)/0x3e8)})),_0xad4fd4={'timestamp':new Date(_0x2b472b)[_0x5b07a8(0x1dd)](),'steps':_0xe3ec7f,'duration':Math[_0x5b07a8(0x1d6)]((activeSequence[activeSequence[_0x5b07a8(0x21d)]-0x1]['ts']-_0x2b472b)/0x3e8),'daytime':new Date(_0x2b472b)[_0x5b07a8(0x22d)]()};_0x5b4dc1[_0x5b07a8(0x1fc)](_0xad4fd4);if(_0x5b4dc1[_0x5b07a8(0x21d)]>MAX_TRAINING_SET_SIZE)_0x5b4dc1[_0x5b07a8(0x210)]();await _0x1b553c[_0x5b07a8(0x1ca)](_0x5b07a8(0x1fb),{'val':JSON[_0x5b07a8(0x22a)](_0x5b4dc1),'ack':!![]}),_0x1b553c['isProVersion']&&_0x1b553c['sendToPythonWrapper']&&_0x1b553c[_0x5b07a8(0x1f5)]('ANALYZE_SEQUENCE',{'sequence':_0xad4fd4});}catch(_0xf3d413){_0x1b553c[_0x5b07a8(0x228)]['error'](_0x5b07a8(0x1f7)+_0xf3d413[_0x5b07a8(0x1eb)]);}}async function recordSequence(_0x3f4573,_0x3bfea2){const _0x34dc90=a5_0x3feb,_0x4e7e26=(_0x3bfea2[_0x34dc90(0x218)]||'')[_0x34dc90(0x21b)](),_0x244a95=[_0x34dc90(0x20d),_0x34dc90(0x219),_0x34dc90(0x1f2),_0x34dc90(0x1f3),_0x34dc90(0x1e4),_0x34dc90(0x213),_0x34dc90(0x1e0),'window',_0x34dc90(0x1ff),_0x34dc90(0x1df),_0x34dc90(0x223),_0x34dc90(0x20e),_0x34dc90(0x1ec),_0x34dc90(0x1d5),_0x34dc90(0x207),_0x34dc90(0x1d4),_0x34dc90(0x211)];if(!_0x244a95[_0x34dc90(0x201)](_0x393bc1=>_0x4e7e26[_0x34dc90(0x222)](_0x393bc1)))return;if(!_0x3bfea2[_0x34dc90(0x221)])return;if(sequenceTimer)clearTimeout(sequenceTimer);activeSequence[_0x34dc90(0x1fc)]({'loc':_0x3bfea2[_0x34dc90(0x20c)]||'Unknown','id':_0x3bfea2['id'],'ts':Date[_0x34dc90(0x1e3)]()}),sequenceTimer=setTimeout(async()=>{const _0x5e7051=_0x34dc90;if(activeSequence[_0x5e7051(0x21d)]>0x1)await saveCompletedSequence(_0x3f4573);activeSequence=[];},SEQUENCE_TIMEOUT_MS);}function startExitTimer(_0xa0006){const _0x1ebdfa=a5_0x3feb;abortExitTimer(_0xa0006),_0xa0006[_0x1ebdfa(0x1f4)]=!![],_0xa0006[_0x1ebdfa(0x1dc)]=setTimeout(()=>{const _0x1da73e=_0x1ebdfa;_0xa0006[_0x1da73e(0x1f4)]=![];},EXIT_GRACE_PERIOD_SECONDS*0x3e8),_0xa0006[_0x1ebdfa(0x227)]=setTimeout(()=>{const _0x5c4685=_0x1ebdfa;setPresence(_0xa0006,![]),_0xa0006[_0x5c4685(0x227)]=null;},EXIT_TIMER_MINUTES*0x3c*0x3e8);}function a5_0x3145(){const _0x2a77a0=['lock','STATUS','setStateAsync','11910TgeMId','search','isProVersion','weatherInstance','level','LTM.rawEventLog','val','.forecast.current.temp','4080NBxsHv','dimmer','switch','round','.1.ACTUAL_TEMPERATURE','sensorLastValues','toString','number','klima','exitGraceTimer','toISOString','10493JOmaWZ','contact','tür','getStateAsync','\x20from\x20','now','occupancy','1635237doZVbK','weatherunderground','parse','pop','.LEVEL','unshift','message','licht','8hOIXJK','.Current.Temperature','TRACK_EVENT','10941513EpITTJ','STATE','präsenz','presence','isGracePeriodActive','sendToPythonWrapper','map','[RECORDER]\x20Error:\x20','Temperature','from','Valve','LTM.trainingData.sequences','push','accuweather','.1.LEVEL','fenster','[RECORDER]\x20Ignored\x20implausible\x20temperature:\x20','some','thermostat','temperature','eventHistory','system.isPresent','name','schalter','739675LqvhSa','exports','LTM.trainingData.thermodynamics','handle','location','motion','light','outdoorSensorId','shift','lampe','isExit','door','.NextHours.Location_1.Day_1.current.temp_value','splice','events.history','isPresent','type','bewegung','window','toLowerCase','temperatur','length','useWeather','692ZjXTMV','.1.TEMPERATURE','value','includes','kontakt','20qTlsKH','SIMULATE_SIGNAL','string','exitTimer','log','config','stringify','(((.+)+)+)+$','rawEventLog','getHours','replace','3583895oDyisA','debug','getForeignStateAsync','1991604yDkdIU','.1.VALVE_STATE','valveMapping','openweathermap','.4.VALVE_STATE','apply'];a5_0x3145=function(){return _0x2a77a0;};return a5_0x3145();}function abortExitTimer(_0x5a8b03){const _0x2f940a=a5_0x3feb;if(_0x5a8b03['exitTimer'])clearTimeout(_0x5a8b03['exitTimer']);if(_0x5a8b03[_0x2f940a(0x1dc)])clearTimeout(_0x5a8b03[_0x2f940a(0x1dc)]);_0x5a8b03['exitTimer']=null,_0x5a8b03[_0x2f940a(0x1dc)]=null,_0x5a8b03[_0x2f940a(0x1f4)]=![];}async function setPresence(_0x5436f5,_0x45e9eb){const _0x62b6f2=a5_0x3feb;if(_0x5436f5[_0x62b6f2(0x217)]===_0x45e9eb)return;_0x5436f5[_0x62b6f2(0x217)]=_0x45e9eb,await _0x5436f5[_0x62b6f2(0x1ca)](_0x62b6f2(0x205),{'val':_0x45e9eb,'ack':!![]});}async function processSensorEvent(_0x10ec32,_0x3862d8,_0x6c09b0,_0xf2e992){const _0x1cea20=a5_0x3feb;if(!_0xf2e992)return null;const _0xcb786e=_0x6c09b0[_0x1cea20(0x1d1)],_0x247280=Date[_0x1cea20(0x1e3)](),_0x905d7a=_0x10ec32[_0x1cea20(0x1d8)][_0x3862d8],_0x5795aa=(_0xf2e992[_0x1cea20(0x218)]||'')[_0x1cea20(0x21b)](),_0x10d57a=_0x5795aa['includes'](_0x1cea20(0x203))||_0x5795aa[_0x1cea20(0x222)](_0x1cea20(0x21c))||_0x5795aa[_0x1cea20(0x222)](_0x1cea20(0x1db))||_0x5795aa[_0x1cea20(0x222)]('heizung')||_0x5795aa[_0x1cea20(0x222)](_0x1cea20(0x202));if(_0x10d57a&&typeof _0xcb786e===_0x1cea20(0x1da)){if(_0xcb786e>0x50||_0xcb786e<-0x32)return _0x10ec32[_0x1cea20(0x228)][_0x1cea20(0x1c0)](_0x1cea20(0x200)+_0xcb786e+_0x1cea20(0x1e2)+_0x3862d8),null;}_0x10ec32['sensorLastValues'][_0x3862d8]=_0xcb786e;if(!_0xf2e992['logDuplicates']&&_0x905d7a!=undefined&&_0x905d7a==_0xcb786e)return null;_0x10ec32[_0x1cea20(0x1cd)]&&_0x10d57a&&recordThermodynamics(_0x10ec32,_0x3862d8,_0xcb786e,_0xf2e992[_0x1cea20(0x20c)]);const _0x49f669={'timestamp':_0x247280,'id':_0x3862d8,'name':_0xf2e992[_0x1cea20(0x206)],'type':_0xf2e992['type'],'location':_0xf2e992['location'],'value':_0xcb786e};_0x10ec32[_0x1cea20(0x204)][_0x1cea20(0x1ea)](_0x49f669);if(_0x10ec32[_0x1cea20(0x204)][_0x1cea20(0x21d)]>HISTORY_MAX_SIZE)_0x10ec32['eventHistory'][_0x1cea20(0x1e8)]();await _0x10ec32[_0x1cea20(0x1ca)]('events.lastEvent',{'val':JSON[_0x1cea20(0x22a)](_0x49f669),'ack':!![]}),await _0x10ec32[_0x1cea20(0x1ca)](_0x1cea20(0x216),{'val':JSON[_0x1cea20(0x22a)](_0x10ec32['eventHistory']),'ack':!![]});if(_0x10ec32[_0x1cea20(0x1cd)]){_0x10ec32[_0x1cea20(0x22c)][_0x1cea20(0x1fc)](_0x49f669);if(_0x10ec32[_0x1cea20(0x22c)][_0x1cea20(0x21d)]>RAW_LOG_MAX_SIZE)_0x10ec32[_0x1cea20(0x22c)][_0x1cea20(0x215)](0x0,_0x10ec32[_0x1cea20(0x22c)]['length']-RAW_LOG_MAX_SIZE);await _0x10ec32['setStateAsync'](_0x1cea20(0x1d0),{'val':JSON[_0x1cea20(0x22a)](_0x10ec32[_0x1cea20(0x22c)]),'ack':!![]}),recordSequence(_0x10ec32,_0x49f669);}if(_0xf2e992[_0x1cea20(0x212)]&&_0xcb786e===!![]){if(_0x10ec32[_0x1cea20(0x217)]&&!_0x10ec32['isGracePeriodActive'])startExitTimer(_0x10ec32);else{if(!_0x10ec32[_0x1cea20(0x217)])setPresence(_0x10ec32,!![]);}}else{if(_0xf2e992[_0x1cea20(0x218)]==='motion'&&_0xcb786e===!![]){if(_0x10ec32[_0x1cea20(0x227)])abortExitTimer(_0x10ec32);if(!_0x10ec32[_0x1cea20(0x217)]&&_0x10ec32['currentSystemMode']==='normal')setPresence(_0x10ec32,!![]);}}if(_0x10ec32[_0x1cea20(0x1cd)]&&_0x10ec32['sendToPythonWrapper']){_0xf2e992[_0x1cea20(0x218)]==='motion'&&_0xcb786e===!![]&&_0xf2e992['location']&&_0x10ec32[_0x1cea20(0x1f5)](_0x1cea20(0x225),{'room':_0xf2e992[_0x1cea20(0x20c)]});const _0x252084=[_0x1cea20(0x213),'tür',_0x1cea20(0x21a),_0x1cea20(0x1ff),'griff',_0x1cea20(0x20b),_0x1cea20(0x1c8),'schloss']['some'](_0x5ba9e5=>_0x5795aa['includes'](_0x5ba9e5)),_0x4eff91=[_0x1cea20(0x20e),'licht',_0x1cea20(0x1d5),_0x1cea20(0x207),_0x1cea20(0x1d4),_0x1cea20(0x211)][_0x1cea20(0x201)](_0x2d603c=>_0x5795aa[_0x1cea20(0x222)](_0x2d603c)),_0x139333=['motion',_0x1cea20(0x219),_0x1cea20(0x1f2),_0x1cea20(0x1f3),'occupancy']['some'](_0x1b8419=>_0x5795aa[_0x1cea20(0x222)](_0x1b8419));if(_0xf2e992[_0x1cea20(0x20c)]&&(_0x252084||_0x4eff91||_0x139333)){const _0x16376b=_0xcb786e===!![]||typeof _0xcb786e==='number'&&_0xcb786e>0x0,_0x5f5dd4=_0x252084&&!_0x16376b&&_0x905d7a!==undefined&&_0x905d7a!=_0xcb786e;if(_0x16376b||_0x5f5dd4){const _0x29cafe=_0x10ec32['lastTrackerEventTime']||_0x247280,_0xd1816b=(_0x247280-_0x29cafe)/0x3e8;_0x10ec32['lastTrackerEventTime']=_0x247280,_0x10ec32['sendToPythonWrapper'](_0x1cea20(0x1ef),{'room':_0xf2e992['location'],'dt':_0xd1816b});}}}return _0x49f669;}module[a5_0x303edb(0x209)]={'processSensorEvent':processSensorEvent,'getOutsideTemperatureNumeric':getOutsideTemperatureNumeric,'setPresence':setPresence,'abortExitTimer':abortExitTimer,'startExitTimer':startExitTimer};