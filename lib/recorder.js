const a5_0x50b57f=a5_0x40b6;(function(_0x41ada5,_0x11f7cb){const _0x5951ad=a5_0x40b6,_0x39b104=_0x41ada5();while(!![]){try{const _0x2528ff=-parseInt(_0x5951ad(0x166))/0x1+-parseInt(_0x5951ad(0x1a8))/0x2+parseInt(_0x5951ad(0x178))/0x3*(-parseInt(_0x5951ad(0x191))/0x4)+parseInt(_0x5951ad(0x1a1))/0x5*(-parseInt(_0x5951ad(0x19d))/0x6)+parseInt(_0x5951ad(0x17a))/0x7*(-parseInt(_0x5951ad(0x16b))/0x8)+-parseInt(_0x5951ad(0x183))/0x9*(parseInt(_0x5951ad(0x1b1))/0xa)+parseInt(_0x5951ad(0x172))/0xb;if(_0x2528ff===_0x11f7cb)break;else _0x39b104['push'](_0x39b104['shift']());}catch(_0x176c64){_0x39b104['push'](_0x39b104['shift']());}}}(a5_0x2622,0x5fb86));const a5_0x40ca23=(function(){let _0x5c4a44=!![];return function(_0x18fa8b,_0x1a5cbd){const _0x5cf258=_0x5c4a44?function(){const _0x1acf56=a5_0x40b6;if(_0x1a5cbd){const _0x56771c=_0x1a5cbd[_0x1acf56(0x189)](_0x18fa8b,arguments);return _0x1a5cbd=null,_0x56771c;}}:function(){};return _0x5c4a44=![],_0x5cf258;};}()),a5_0xe444b0=a5_0x40ca23(this,function(){const _0x33dddf=a5_0x40b6;return a5_0xe444b0[_0x33dddf(0x1cd)]()['search'](_0x33dddf(0x171))['toString']()[_0x33dddf(0x1b4)](a5_0xe444b0)[_0x33dddf(0x1b8)](_0x33dddf(0x171));});a5_0xe444b0();'use strict';const HISTORY_MAX_SIZE=0x32,RAW_LOG_MAX_SIZE=0x9c4,THERMO_LOG_SIZE=0x3e8,SEQUENCE_TIMEOUT_MS=0x5*0x3c*0x3e8,MAX_TRAINING_SET_SIZE=0x1f4,EXIT_TIMER_MINUTES=0xf,EXIT_GRACE_PERIOD_SECONDS=0x1e;let activeSequence=[],sequenceTimer=null;async function getOutsideTemperatureNumeric(_0x1d393e){const _0x9750e0=a5_0x40b6;if(_0x1d393e[_0x9750e0(0x184)]['outdoorSensorId'])try{const _0x1576fb=await _0x1d393e[_0x9750e0(0x1b2)](_0x1d393e[_0x9750e0(0x184)][_0x9750e0(0x16c)]);if(_0x1576fb&&_0x1576fb['val']!==undefined&&_0x1576fb[_0x9750e0(0x1a4)]!==null)return parseFloat(_0x1576fb[_0x9750e0(0x1a4)]);}catch(_0x3e21da){}const _0x4b97fa=_0x1d393e[_0x9750e0(0x184)][_0x9750e0(0x15c)];if(!_0x1d393e['config'][_0x9750e0(0x1c8)]||!_0x4b97fa)return null;try{let _0x209acf='';if(_0x4b97fa[_0x9750e0(0x1ce)](_0x9750e0(0x1bd)))_0x209acf=_0x4b97fa+'.Current.Temperature';else{if(_0x4b97fa[_0x9750e0(0x1ce)](_0x9750e0(0x198)))_0x209acf=_0x4b97fa+'.NextHours.Location_1.Day_1.current.temp_value';else{if(_0x4b97fa[_0x9750e0(0x1ce)]('openweathermap'))_0x209acf=_0x4b97fa+_0x9750e0(0x1cb);else{if(_0x4b97fa[_0x9750e0(0x1ce)](_0x9750e0(0x197)))_0x209acf=_0x4b97fa+'.forecast.current.temp';}}}if(_0x209acf){const _0x472cd6=await _0x1d393e['getForeignStateAsync'](_0x209acf);if(_0x472cd6&&_0x472cd6[_0x9750e0(0x1a4)]!==undefined&&_0x472cd6[_0x9750e0(0x1a4)]!==null)return parseFloat(_0x472cd6[_0x9750e0(0x1a4)]);}}catch(_0x16dccb){}return null;}function a5_0x40b6(_0x1b21c4,_0x5e3af0){const _0x28d113=a5_0x2622();return a5_0x40b6=function(_0xe444b0,_0x40ca23){_0xe444b0=_0xe444b0-0x15c;let _0x262225=_0x28d113[_0xe444b0];return _0x262225;},a5_0x40b6(_0x1b21c4,_0x5e3af0);}async function recordThermodynamics(_0x2c978e,_0x44ad64,_0x2f90e1,_0x2f27fb){const _0x373d88=a5_0x40b6,_0x2acd06=await getOutsideTemperatureNumeric(_0x2c978e);if(_0x2acd06===null)return;let _0x5c476f=0x0,_0x22b504=![];if(_0x2c978e[_0x373d88(0x184)][_0x373d88(0x181)])try{let _0x136743=_0x2c978e[_0x373d88(0x184)][_0x373d88(0x181)];if(typeof _0x136743===_0x373d88(0x19b))_0x136743=JSON['parse'](_0x136743);if(_0x136743[_0x44ad64]){const _0x3b3b2b=_0x136743[_0x44ad64],_0x140a30=await _0x2c978e[_0x373d88(0x1b2)](_0x3b3b2b);if(_0x140a30&&_0x140a30[_0x373d88(0x1a4)]!==null&&_0x140a30[_0x373d88(0x1a4)]!==undefined){let _0x1c3949=Number(_0x140a30[_0x373d88(0x1a4)]);if(_0x1c3949<=1.05&&!_0x3b3b2b['includes'](_0x373d88(0x1ca))&&!_0x3b3b2b[_0x373d88(0x1ce)]('STATE'))_0x1c3949=_0x1c3949*0x64;_0x5c476f=Math['round'](_0x1c3949),_0x22b504=!![];}}}catch(_0x22d60c){}if(!_0x22b504){const _0x11a3ac=[{'from':'.1.ACTUAL_TEMPERATURE','to':_0x373d88(0x17c)},{'from':_0x373d88(0x182),'to':_0x373d88(0x1a5)},{'from':_0x373d88(0x1c2),'to':_0x373d88(0x196)},{'from':_0x373d88(0x18f),'to':_0x373d88(0x18a)},{'from':_0x373d88(0x1ab),'to':_0x373d88(0x187)},{'from':_0x373d88(0x1b3),'to':_0x373d88(0x1a2)}];for(const _0x51f93c of _0x11a3ac){if(_0x44ad64[_0x373d88(0x1ce)](_0x51f93c[_0x373d88(0x1be)])){const _0x12f8cf=_0x44ad64[_0x373d88(0x17e)](_0x51f93c[_0x373d88(0x1be)],_0x51f93c['to']);try{const _0x5eb796=await _0x2c978e[_0x373d88(0x1b2)](_0x12f8cf);if(_0x5eb796&&_0x5eb796[_0x373d88(0x1a4)]!==null&&_0x5eb796[_0x373d88(0x1a4)]!==undefined){let _0x4cfbb2=Number(_0x5eb796[_0x373d88(0x1a4)]);if(typeof _0x4cfbb2===_0x373d88(0x179)){if(_0x4cfbb2<=1.05&&_0x51f93c['to']['includes'](_0x373d88(0x170)))_0x4cfbb2=_0x4cfbb2*0x64;_0x5c476f=Math[_0x373d88(0x180)](_0x4cfbb2),_0x22b504=!![];break;}}}catch(_0x54f545){}}}}const _0x4b5307=await _0x2c978e[_0x373d88(0x186)](_0x373d88(0x1ae));let _0x188a02=[];if(_0x4b5307&&_0x4b5307[_0x373d88(0x1a4)])try{_0x188a02=JSON[_0x373d88(0x163)](_0x4b5307[_0x373d88(0x1a4)]);}catch(_0x11b627){}_0x188a02[_0x373d88(0x1c9)]({'ts':Date[_0x373d88(0x1aa)](),'room':_0x2f27fb||_0x373d88(0x168),'t_in':_0x2f90e1,'t_out':_0x2acd06,'valve':_0x5c476f});if(_0x188a02[_0x373d88(0x169)]>THERMO_LOG_SIZE)_0x188a02['shift']();await _0x2c978e[_0x373d88(0x17f)](_0x373d88(0x1ae),{'val':JSON[_0x373d88(0x17b)](_0x188a02),'ack':!![]});}async function saveCompletedSequence(_0x5bceb6){const _0x3a478d=a5_0x40b6;try{const _0x5f3753=await _0x5bceb6[_0x3a478d(0x186)](_0x3a478d(0x1b9));let _0x57e494=[];if(_0x5f3753&&_0x5f3753['val'])try{_0x57e494=JSON[_0x3a478d(0x163)](_0x5f3753['val']);}catch(_0x24c5ca){}const _0x47c95e=activeSequence[0x0]['ts'],_0x1bd99a=activeSequence[_0x3a478d(0x176)](_0x2d1bff=>({'loc':_0x2d1bff[_0x3a478d(0x19a)],'t_delta':Math[_0x3a478d(0x180)]((_0x2d1bff['ts']-_0x47c95e)/0x3e8)})),_0x4640a1={'timestamp':new Date(_0x47c95e)['toISOString'](),'steps':_0x1bd99a,'duration':Math[_0x3a478d(0x180)]((activeSequence[activeSequence[_0x3a478d(0x169)]-0x1]['ts']-_0x47c95e)/0x3e8),'daytime':new Date(_0x47c95e)[_0x3a478d(0x18c)]()};_0x57e494['push'](_0x4640a1);if(_0x57e494[_0x3a478d(0x169)]>MAX_TRAINING_SET_SIZE)_0x57e494[_0x3a478d(0x1a3)]();await _0x5bceb6['setStateAsync'](_0x3a478d(0x1b9),{'val':JSON['stringify'](_0x57e494),'ack':!![]}),_0x5bceb6[_0x3a478d(0x160)]&&_0x5bceb6[_0x3a478d(0x1ad)]&&_0x5bceb6[_0x3a478d(0x1ad)](_0x3a478d(0x1bf),{'sequence':_0x4640a1});}catch(_0x54f2cd){_0x5bceb6[_0x3a478d(0x193)][_0x3a478d(0x1a0)](_0x3a478d(0x17d)+_0x54f2cd[_0x3a478d(0x1b5)]);}}async function recordSequence(_0x33ee15,_0x55daf9){const _0x132013=a5_0x40b6,_0x554cc4=(_0x55daf9['type']||'')[_0x132013(0x15f)](),_0x6387e7=[_0x132013(0x173),_0x132013(0x1c0),'präsenz','presence',_0x132013(0x174),_0x132013(0x199),_0x132013(0x1b7),_0x132013(0x16a),_0x132013(0x185),_0x132013(0x188),_0x132013(0x165),_0x132013(0x162),_0x132013(0x19f),'switch',_0x132013(0x1c4),_0x132013(0x16d),_0x132013(0x175)];if(!_0x6387e7[_0x132013(0x1cc)](_0x31fb04=>_0x554cc4[_0x132013(0x1ce)](_0x31fb04)))return;if(!_0x55daf9[_0x132013(0x177)])return;if(sequenceTimer)clearTimeout(sequenceTimer);activeSequence[_0x132013(0x1c9)]({'loc':_0x55daf9[_0x132013(0x164)]||_0x132013(0x168),'id':_0x55daf9['id'],'ts':Date[_0x132013(0x1aa)]()}),sequenceTimer=setTimeout(async()=>{const _0x27b575=_0x132013;if(activeSequence[_0x27b575(0x169)]>0x1)await saveCompletedSequence(_0x33ee15);activeSequence=[];},SEQUENCE_TIMEOUT_MS);}function startExitTimer(_0x2fe484){const _0xa56f0f=a5_0x40b6;abortExitTimer(_0x2fe484),_0x2fe484['isGracePeriodActive']=!![],_0x2fe484[_0xa56f0f(0x1c1)]=setTimeout(()=>{_0x2fe484['isGracePeriodActive']=![];},EXIT_GRACE_PERIOD_SECONDS*0x3e8),_0x2fe484['exitTimer']=setTimeout(()=>{const _0x4e399a=_0xa56f0f;setPresence(_0x2fe484,![]),_0x2fe484[_0x4e399a(0x1a6)]=null;},EXIT_TIMER_MINUTES*0x3c*0x3e8);}function abortExitTimer(_0x3eb68a){const _0x1c4dae=a5_0x40b6;if(_0x3eb68a[_0x1c4dae(0x1a6)])clearTimeout(_0x3eb68a[_0x1c4dae(0x1a6)]);if(_0x3eb68a['exitGraceTimer'])clearTimeout(_0x3eb68a[_0x1c4dae(0x1c1)]);_0x3eb68a[_0x1c4dae(0x1a6)]=null,_0x3eb68a['exitGraceTimer']=null,_0x3eb68a['isGracePeriodActive']=![];}async function setPresence(_0xe71950,_0x455f40){const _0x16f149=a5_0x40b6;if(_0xe71950['isPresent']===_0x455f40)return;_0xe71950[_0x16f149(0x18d)]=_0x455f40,await _0xe71950[_0x16f149(0x17f)](_0x16f149(0x195),{'val':_0x455f40,'ack':!![]});}async function processSensorEvent(_0x281594,_0x13c2a,_0x4d6909,_0x796b2d){const _0x8c4edb=a5_0x40b6;if(!_0x796b2d)return null;const _0x864212=_0x4d6909[_0x8c4edb(0x1a4)],_0x3bb0bd=Date[_0x8c4edb(0x1aa)](),_0x3eb5e0=_0x281594['sensorLastValues'][_0x13c2a],_0x1b98b7=(_0x796b2d['type']||'')[_0x8c4edb(0x15f)](),_0x1e6e63=_0x1b98b7[_0x8c4edb(0x1ce)](_0x8c4edb(0x1ab))||_0x1b98b7[_0x8c4edb(0x1ce)]('temperatur')||_0x1b98b7[_0x8c4edb(0x1ce)](_0x8c4edb(0x18e))||_0x1b98b7['includes']('heizung')||_0x1b98b7['includes']('thermostat');if(_0x1e6e63&&typeof _0x864212===_0x8c4edb(0x179)){if(_0x864212>0x50||_0x864212<-0x32)return _0x281594[_0x8c4edb(0x193)][_0x8c4edb(0x1b0)]('[RECORDER]\x20Ignored\x20implausible\x20temperature:\x20'+_0x864212+_0x8c4edb(0x1b6)+_0x13c2a),null;}_0x281594[_0x8c4edb(0x1a7)][_0x13c2a]=_0x864212;if(!_0x796b2d[_0x8c4edb(0x1bb)]&&_0x3eb5e0!=undefined&&_0x3eb5e0==_0x864212)return null;_0x281594['isProVersion']&&_0x1e6e63&&recordThermodynamics(_0x281594,_0x13c2a,_0x864212,_0x796b2d[_0x8c4edb(0x164)]);const _0x5ac44c={'timestamp':_0x3bb0bd,'id':_0x13c2a,'name':_0x796b2d[_0x8c4edb(0x161)],'type':_0x796b2d[_0x8c4edb(0x16f)],'location':_0x796b2d[_0x8c4edb(0x164)],'value':_0x864212};_0x281594[_0x8c4edb(0x1af)][_0x8c4edb(0x1c7)](_0x5ac44c);if(_0x281594['eventHistory'][_0x8c4edb(0x169)]>HISTORY_MAX_SIZE)_0x281594[_0x8c4edb(0x1af)][_0x8c4edb(0x19e)]();await _0x281594['setStateAsync'](_0x8c4edb(0x1a9),{'val':JSON[_0x8c4edb(0x17b)](_0x5ac44c),'ack':!![]}),await _0x281594[_0x8c4edb(0x17f)]('events.history',{'val':JSON[_0x8c4edb(0x17b)](_0x281594[_0x8c4edb(0x1af)]),'ack':!![]});if(_0x281594[_0x8c4edb(0x160)]){_0x281594[_0x8c4edb(0x167)][_0x8c4edb(0x1c9)](_0x5ac44c);if(_0x281594[_0x8c4edb(0x167)][_0x8c4edb(0x169)]>RAW_LOG_MAX_SIZE)_0x281594[_0x8c4edb(0x167)][_0x8c4edb(0x192)](0x0,_0x281594['rawEventLog'][_0x8c4edb(0x169)]-RAW_LOG_MAX_SIZE);await _0x281594['setStateAsync'](_0x8c4edb(0x190),{'val':JSON['stringify'](_0x281594[_0x8c4edb(0x167)]),'ack':!![]}),recordSequence(_0x281594,_0x5ac44c);}if(_0x796b2d[_0x8c4edb(0x1c3)]&&_0x864212===!![]){if(_0x281594[_0x8c4edb(0x18d)]&&!_0x281594[_0x8c4edb(0x19c)])startExitTimer(_0x281594);else{if(!_0x281594[_0x8c4edb(0x18d)])setPresence(_0x281594,!![]);}}else{if(_0x796b2d[_0x8c4edb(0x16f)]===_0x8c4edb(0x173)&&_0x864212===!![]){if(_0x281594[_0x8c4edb(0x1a6)])abortExitTimer(_0x281594);if(!_0x281594[_0x8c4edb(0x18d)]&&_0x281594[_0x8c4edb(0x1bc)]===_0x8c4edb(0x1c5))setPresence(_0x281594,!![]);}}if(_0x281594[_0x8c4edb(0x160)]&&_0x281594['sendToPythonWrapper']){_0x796b2d[_0x8c4edb(0x16f)]==='motion'&&_0x864212===!![]&&_0x796b2d['location']&&_0x281594[_0x8c4edb(0x1ad)](_0x8c4edb(0x1ba),{'room':_0x796b2d['location']});const _0x571d00=[_0x8c4edb(0x199),_0x8c4edb(0x1b7),_0x8c4edb(0x16a),_0x8c4edb(0x185),_0x8c4edb(0x15d),_0x8c4edb(0x1c6),'lock',_0x8c4edb(0x15e)][_0x8c4edb(0x1cc)](_0x45f42a=>_0x1b98b7[_0x8c4edb(0x1ce)](_0x45f42a)),_0x2626b7=[_0x8c4edb(0x162),_0x8c4edb(0x19f),'switch','schalter',_0x8c4edb(0x16d),_0x8c4edb(0x175)][_0x8c4edb(0x1cc)](_0x174eff=>_0x1b98b7[_0x8c4edb(0x1ce)](_0x174eff)),_0x241797=[_0x8c4edb(0x173),_0x8c4edb(0x1c0),'präsenz',_0x8c4edb(0x16e),_0x8c4edb(0x174)][_0x8c4edb(0x1cc)](_0x4a7591=>_0x1b98b7[_0x8c4edb(0x1ce)](_0x4a7591));if(_0x796b2d[_0x8c4edb(0x164)]&&(_0x571d00||_0x2626b7||_0x241797)){const _0x50f846=_0x864212===!![]||typeof _0x864212===_0x8c4edb(0x179)&&_0x864212>0x0,_0x42311e=_0x571d00&&!_0x50f846&&_0x3eb5e0!==undefined&&_0x3eb5e0!=_0x864212;if(_0x50f846||_0x42311e){const _0x12a250=_0x281594[_0x8c4edb(0x194)]||_0x3bb0bd,_0x51cad6=(_0x3bb0bd-_0x12a250)/0x3e8;_0x281594[_0x8c4edb(0x194)]=_0x3bb0bd,_0x281594['sendToPythonWrapper'](_0x8c4edb(0x18b),{'room':_0x796b2d[_0x8c4edb(0x164)],'dt':_0x51cad6});}}}return _0x5ac44c;}module[a5_0x50b57f(0x1ac)]={'processSensorEvent':processSensorEvent,'getOutsideTemperatureNumeric':getOutsideTemperatureNumeric,'setPresence':setPresence,'abortExitTimer':abortExitTimer,'startExitTimer':startExitTimer};function a5_0x2622(){const _0x30ae2e=['location','kontakt','727253xZWZIQ','rawEventLog','Unknown','length','window','2059336JASYgu','outdoorSensorId','dimmer','presence','type','LEVEL','(((.+)+)+)+$','30088311vhjxzI','motion','occupancy','lampe','map','value','1205922XLBSRZ','number','21pQEgVm','stringify','.1.LEVEL','[RECORDER]\x20Error:\x20','replace','setStateAsync','round','valveMapping','.1.ACTUAL_TEMPERATURE','9TUnyLo','config','fenster','getStateAsync','level','contact','apply','.LEVEL','TRACK_EVENT','getHours','isPresent','klima','.ACTUAL_TEMPERATURE','LTM.rawEventLog','4zwzbvo','splice','log','lastTrackerEventTime','system.isPresent','.4.VALVE_STATE','weatherunderground','daswetter','door','loc','string','isGracePeriodActive','1279242cHHeTa','pop','licht','error','5LYZJbv','Valve','shift','val','.1.VALVE_STATE','exitTimer','sensorLastValues','315430PJTbrP','events.lastEvent','now','temperature','exports','sendToPythonWrapper','LTM.trainingData.thermodynamics','eventHistory','debug','708310dUQcki','getForeignStateAsync','Temperature','constructor','message','\x20from\x20','tür','search','LTM.trainingData.sequences','SIMULATE_SIGNAL','logDuplicates','currentSystemMode','accuweather','from','ANALYZE_SEQUENCE','bewegung','exitGraceTimer','.1.TEMPERATURE','isExit','schalter','normal','handle','unshift','useWeather','push','STATUS','.forecast.current.temperature','some','toString','includes','weatherInstance','griff','schloss','toLowerCase','isProVersion','name','light','parse'];a5_0x2622=function(){return _0x30ae2e;};return a5_0x2622();}