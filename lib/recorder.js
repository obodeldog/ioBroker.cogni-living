const a5_0x287a3b=a5_0x4808;(function(_0x410b52,_0x28c96c){const _0x2d4242=a5_0x4808,_0x7b598a=_0x410b52();while(!![]){try{const _0x14fe6e=-parseInt(_0x2d4242(0x1cd))/0x1*(parseInt(_0x2d4242(0x1ca))/0x2)+parseInt(_0x2d4242(0x18d))/0x3*(parseInt(_0x2d4242(0x19e))/0x4)+parseInt(_0x2d4242(0x197))/0x5+parseInt(_0x2d4242(0x1ab))/0x6+parseInt(_0x2d4242(0x1bf))/0x7*(-parseInt(_0x2d4242(0x1a4))/0x8)+-parseInt(_0x2d4242(0x19d))/0x9+-parseInt(_0x2d4242(0x18f))/0xa;if(_0x14fe6e===_0x28c96c)break;else _0x7b598a['push'](_0x7b598a['shift']());}catch(_0x21d930){_0x7b598a['push'](_0x7b598a['shift']());}}}(a5_0xc1bc,0x7815f));const a5_0x221bcc=(function(){let _0x537a14=!![];return function(_0x4304f0,_0x3199df){const _0x3df57f=_0x537a14?function(){const _0x5bb66a=a5_0x4808;if(_0x3199df){const _0x4c7fc4=_0x3199df[_0x5bb66a(0x1a3)](_0x4304f0,arguments);return _0x3199df=null,_0x4c7fc4;}}:function(){};return _0x537a14=![],_0x3df57f;};}()),a5_0x5a76ef=a5_0x221bcc(this,function(){const _0x40e808=a5_0x4808;return a5_0x5a76ef['toString']()['search'](_0x40e808(0x1c0))['toString']()[_0x40e808(0x16d)](a5_0x5a76ef)[_0x40e808(0x16f)]('(((.+)+)+)+$');});a5_0x5a76ef();'use strict';const HISTORY_MAX_SIZE=0x32,RAW_LOG_MAX_SIZE=0x9c4,THERMO_LOG_SIZE=0x3e8,SEQUENCE_TIMEOUT_MS=0x5*0x3c*0x3e8,MAX_TRAINING_SET_SIZE=0x1f4,EXIT_TIMER_MINUTES=0xf,EXIT_GRACE_PERIOD_SECONDS=0x1e;let activeSequence=[],sequenceTimer=null;async function getOutsideTemperatureNumeric(_0x30c052){const _0x2a5e17=a5_0x4808;if(_0x30c052['config']['outdoorSensorId'])try{const _0xda8de3=await _0x30c052[_0x2a5e17(0x1b1)](_0x30c052['config'][_0x2a5e17(0x187)]);if(_0xda8de3&&_0xda8de3['val']!==undefined&&_0xda8de3['val']!==null)return parseFloat(_0xda8de3[_0x2a5e17(0x1d7)]);}catch(_0x5529ee){}const _0x378722=_0x30c052[_0x2a5e17(0x1c8)]['weatherInstance'];if(!_0x30c052[_0x2a5e17(0x1c8)][_0x2a5e17(0x186)]||!_0x378722)return null;try{let _0x4fdb2f='';if(_0x378722[_0x2a5e17(0x173)](_0x2a5e17(0x192)))_0x4fdb2f=_0x378722+'.Current.Temperature';else{if(_0x378722[_0x2a5e17(0x173)](_0x2a5e17(0x1d4)))_0x4fdb2f=_0x378722+_0x2a5e17(0x180);else{if(_0x378722['includes'](_0x2a5e17(0x179)))_0x4fdb2f=_0x378722+_0x2a5e17(0x1b9);else{if(_0x378722[_0x2a5e17(0x173)](_0x2a5e17(0x1cb)))_0x4fdb2f=_0x378722+_0x2a5e17(0x1c3);}}}if(_0x4fdb2f){const _0x288ffa=await _0x30c052[_0x2a5e17(0x1b1)](_0x4fdb2f);if(_0x288ffa&&_0x288ffa['val']!==undefined&&_0x288ffa[_0x2a5e17(0x1d7)]!==null)return parseFloat(_0x288ffa['val']);}}catch(_0x44323e){}return null;}async function recordThermodynamics(_0x16882c,_0x4b5859,_0x1a9aa2,_0x48a80a){const _0x1d77db=a5_0x4808,_0x5e7fad=await getOutsideTemperatureNumeric(_0x16882c);if(_0x5e7fad===null)return;let _0x9f1718=0x0,_0x573781=![];if(_0x16882c[_0x1d77db(0x1c8)][_0x1d77db(0x172)])try{let _0x2e4c97=_0x16882c[_0x1d77db(0x1c8)]['valveMapping'];if(typeof _0x2e4c97===_0x1d77db(0x1c2))_0x2e4c97=JSON[_0x1d77db(0x19b)](_0x2e4c97);if(_0x2e4c97[_0x4b5859]){const _0x324f53=_0x2e4c97[_0x4b5859],_0x3c4ce6=await _0x16882c[_0x1d77db(0x1b1)](_0x324f53);if(_0x3c4ce6&&_0x3c4ce6[_0x1d77db(0x1d7)]!==null&&_0x3c4ce6['val']!==undefined){let _0x52950e=Number(_0x3c4ce6[_0x1d77db(0x1d7)]);if(_0x52950e<=1.05&&!_0x324f53[_0x1d77db(0x173)]('STATUS')&&!_0x324f53[_0x1d77db(0x173)]('STATE'))_0x52950e=_0x52950e*0x64;_0x9f1718=Math[_0x1d77db(0x177)](_0x52950e),_0x573781=!![];}}}catch(_0xe1372c){}if(!_0x573781){const _0x4c95ac=[{'from':_0x1d77db(0x190),'to':_0x1d77db(0x1bc)},{'from':_0x1d77db(0x190),'to':'.1.VALVE_STATE'},{'from':_0x1d77db(0x188),'to':_0x1d77db(0x1aa)},{'from':_0x1d77db(0x1a6),'to':_0x1d77db(0x17f)},{'from':_0x1d77db(0x194),'to':'level'},{'from':'Temperature','to':_0x1d77db(0x193)}];for(const _0x2476fc of _0x4c95ac){if(_0x4b5859[_0x1d77db(0x173)](_0x2476fc['from'])){const _0x5cb0b6=_0x4b5859[_0x1d77db(0x174)](_0x2476fc[_0x1d77db(0x17c)],_0x2476fc['to']);try{const _0x1a783f=await _0x16882c[_0x1d77db(0x1b1)](_0x5cb0b6);if(_0x1a783f&&_0x1a783f[_0x1d77db(0x1d7)]!==null&&_0x1a783f[_0x1d77db(0x1d7)]!==undefined){let _0x22770b=Number(_0x1a783f[_0x1d77db(0x1d7)]);if(typeof _0x22770b===_0x1d77db(0x1c9)){if(_0x22770b<=1.05&&_0x2476fc['to'][_0x1d77db(0x173)]('LEVEL'))_0x22770b=_0x22770b*0x64;_0x9f1718=Math[_0x1d77db(0x177)](_0x22770b),_0x573781=!![];break;}}}catch(_0x3879e1){}}}}const _0x21e220=await _0x16882c[_0x1d77db(0x1c4)](_0x1d77db(0x16e));let _0x432a1f=[];if(_0x21e220&&_0x21e220[_0x1d77db(0x1d7)])try{_0x432a1f=JSON[_0x1d77db(0x19b)](_0x21e220[_0x1d77db(0x1d7)]);}catch(_0x59fa13){}_0x432a1f[_0x1d77db(0x1a0)]({'ts':Date[_0x1d77db(0x1a5)](),'room':_0x48a80a||_0x1d77db(0x1d3),'t_in':_0x1a9aa2,'t_out':_0x5e7fad,'valve':_0x9f1718});if(_0x432a1f[_0x1d77db(0x1b5)]>THERMO_LOG_SIZE)_0x432a1f[_0x1d77db(0x176)]();await _0x16882c[_0x1d77db(0x1d1)](_0x1d77db(0x16e),{'val':JSON[_0x1d77db(0x1b2)](_0x432a1f),'ack':!![]});}function a5_0x4808(_0xea54c5,_0x4b140d){const _0x4c94f5=a5_0xc1bc();return a5_0x4808=function(_0x5a76ef,_0x221bcc){_0x5a76ef=_0x5a76ef-0x16c;let _0xc1bc5e=_0x4c94f5[_0x5a76ef];return _0xc1bc5e;},a5_0x4808(_0xea54c5,_0x4b140d);}function a5_0xc1bc(){const _0x23329d=['from','motion','kontakt','.LEVEL','.NextHours.Location_1.Day_1.current.temp_value','log','lock','tür','system.isPresent','unshift','useWeather','outdoorSensorId','.1.TEMPERATURE','präsenz','window','griff','schalter','9687BDeLmC','[RECORDER]\x20Error:\x20','1843270pqLVpo','.1.ACTUAL_TEMPERATURE','exitGraceTimer','accuweather','Valve','temperature','klima','occupancy','944100PMpfRV','toISOString','licht','isProVersion','parse','[RECORDER]\x20Ignored\x20implausible\x20temperature:\x20','3001239HZyrri','844cyLrag','heizung','push','name','isGracePeriodActive','apply','912pwDfCW','now','.ACTUAL_TEMPERATURE','eventHistory','location','bewegung','.4.VALVE_STATE','4124508BuXugq','lampe','value','some','rawEventLog','exitTimer','getForeignStateAsync','stringify','splice','dimmer','length','getHours','currentSystemMode','error','.forecast.current.temperature','switch','schloss','.1.LEVEL','contact','isPresent','20391KRiudL','(((.+)+)+)+$','sensorLastValues','string','.forecast.current.temp','getStateAsync','map','SIMULATE_SIGNAL','isExit','config','number','2ElhpzT','weatherunderground','TRACK_EVENT','215806rMKlbz','fenster','LTM.trainingData.sequences','presence','setStateAsync','type','Unknown','daswetter','LTM.rawEventLog','lastTrackerEventTime','val','toLowerCase','constructor','LTM.trainingData.thermodynamics','search','loc','sendToPythonWrapper','valveMapping','includes','replace','ANALYZE_SEQUENCE','shift','round','exports','openweathermap','door','thermostat'];a5_0xc1bc=function(){return _0x23329d;};return a5_0xc1bc();}async function saveCompletedSequence(_0x434a5e){const _0x41e0f6=a5_0x4808;try{const _0x4cd0fb=await _0x434a5e[_0x41e0f6(0x1c4)](_0x41e0f6(0x1cf));let _0x4ffe3d=[];if(_0x4cd0fb&&_0x4cd0fb['val'])try{_0x4ffe3d=JSON[_0x41e0f6(0x19b)](_0x4cd0fb[_0x41e0f6(0x1d7)]);}catch(_0x26a7ca){}const _0x121f22=activeSequence[0x0]['ts'],_0x484384=activeSequence[_0x41e0f6(0x1c5)](_0xa59343=>({'loc':_0xa59343[_0x41e0f6(0x170)],'t_delta':Math[_0x41e0f6(0x177)]((_0xa59343['ts']-_0x121f22)/0x3e8)})),_0x8653f0={'timestamp':new Date(_0x121f22)[_0x41e0f6(0x198)](),'steps':_0x484384,'duration':Math['round']((activeSequence[activeSequence[_0x41e0f6(0x1b5)]-0x1]['ts']-_0x121f22)/0x3e8),'daytime':new Date(_0x121f22)[_0x41e0f6(0x1b6)]()};_0x4ffe3d[_0x41e0f6(0x1a0)](_0x8653f0);if(_0x4ffe3d[_0x41e0f6(0x1b5)]>MAX_TRAINING_SET_SIZE)_0x4ffe3d[_0x41e0f6(0x176)]();await _0x434a5e[_0x41e0f6(0x1d1)](_0x41e0f6(0x1cf),{'val':JSON[_0x41e0f6(0x1b2)](_0x4ffe3d),'ack':!![]}),_0x434a5e[_0x41e0f6(0x19a)]&&_0x434a5e['sendToPythonWrapper']&&_0x434a5e['sendToPythonWrapper'](_0x41e0f6(0x175),{'sequence':_0x8653f0});}catch(_0xe4a54e){_0x434a5e[_0x41e0f6(0x181)][_0x41e0f6(0x1b8)](_0x41e0f6(0x18e)+_0xe4a54e['message']);}}async function recordSequence(_0x1f70e5,_0x33d6c7){const _0x110367=a5_0x4808,_0x1a9a1c=(_0x33d6c7[_0x110367(0x1d2)]||'')[_0x110367(0x16c)](),_0x55df0b=[_0x110367(0x17d),_0x110367(0x1a9),'präsenz',_0x110367(0x1d0),_0x110367(0x196),_0x110367(0x17a),_0x110367(0x183),'window',_0x110367(0x1ce),_0x110367(0x1bd),_0x110367(0x17e),'light',_0x110367(0x199),_0x110367(0x1ba),_0x110367(0x18c),_0x110367(0x1b4),_0x110367(0x1ac)];if(!_0x55df0b[_0x110367(0x1ae)](_0x494ce7=>_0x1a9a1c[_0x110367(0x173)](_0x494ce7)))return;if(!_0x33d6c7[_0x110367(0x1ad)])return;if(sequenceTimer)clearTimeout(sequenceTimer);activeSequence[_0x110367(0x1a0)]({'loc':_0x33d6c7[_0x110367(0x1a8)]||_0x110367(0x1d3),'id':_0x33d6c7['id'],'ts':Date[_0x110367(0x1a5)]()}),sequenceTimer=setTimeout(async()=>{const _0x5b18f6=_0x110367;if(activeSequence[_0x5b18f6(0x1b5)]>0x1)await saveCompletedSequence(_0x1f70e5);activeSequence=[];},SEQUENCE_TIMEOUT_MS);}function startExitTimer(_0x579db8){const _0x4e18ac=a5_0x4808;abortExitTimer(_0x579db8),_0x579db8[_0x4e18ac(0x1a2)]=!![],_0x579db8['exitGraceTimer']=setTimeout(()=>{_0x579db8['isGracePeriodActive']=![];},EXIT_GRACE_PERIOD_SECONDS*0x3e8),_0x579db8[_0x4e18ac(0x1b0)]=setTimeout(()=>{const _0x563481=_0x4e18ac;setPresence(_0x579db8,![]),_0x579db8[_0x563481(0x1b0)]=null;},EXIT_TIMER_MINUTES*0x3c*0x3e8);}function abortExitTimer(_0x56d3c7){const _0x5542d6=a5_0x4808;if(_0x56d3c7[_0x5542d6(0x1b0)])clearTimeout(_0x56d3c7[_0x5542d6(0x1b0)]);if(_0x56d3c7[_0x5542d6(0x191)])clearTimeout(_0x56d3c7[_0x5542d6(0x191)]);_0x56d3c7[_0x5542d6(0x1b0)]=null,_0x56d3c7[_0x5542d6(0x191)]=null,_0x56d3c7['isGracePeriodActive']=![];}async function setPresence(_0x147087,_0x19f7f4){const _0x1615f2=a5_0x4808;if(_0x147087[_0x1615f2(0x1be)]===_0x19f7f4)return;_0x147087[_0x1615f2(0x1be)]=_0x19f7f4,await _0x147087[_0x1615f2(0x1d1)](_0x1615f2(0x184),{'val':_0x19f7f4,'ack':!![]});}async function processSensorEvent(_0x6b5935,_0x181a01,_0x43cfaf,_0x2d06f5){const _0x3e622c=a5_0x4808;if(!_0x2d06f5)return null;const _0xbf71c8=_0x43cfaf[_0x3e622c(0x1d7)],_0x231b39=Date[_0x3e622c(0x1a5)](),_0x286114=_0x6b5935[_0x3e622c(0x1c1)][_0x181a01],_0x556a88=(_0x2d06f5[_0x3e622c(0x1d2)]||'')['toLowerCase'](),_0x5925c5=_0x556a88[_0x3e622c(0x173)](_0x3e622c(0x194))||_0x556a88[_0x3e622c(0x173)]('temperatur')||_0x556a88[_0x3e622c(0x173)](_0x3e622c(0x195))||_0x556a88[_0x3e622c(0x173)](_0x3e622c(0x19f))||_0x556a88[_0x3e622c(0x173)](_0x3e622c(0x17b));if(_0x5925c5&&typeof _0xbf71c8===_0x3e622c(0x1c9)){if(_0xbf71c8>0x50||_0xbf71c8<-0x32)return _0x6b5935[_0x3e622c(0x181)]['debug'](_0x3e622c(0x19c)+_0xbf71c8+'\x20from\x20'+_0x181a01),null;}_0x6b5935[_0x3e622c(0x1c1)][_0x181a01]=_0xbf71c8;if(!_0x2d06f5['logDuplicates']&&_0x286114!=undefined&&_0x286114==_0xbf71c8)return null;_0x6b5935[_0x3e622c(0x19a)]&&_0x5925c5&&recordThermodynamics(_0x6b5935,_0x181a01,_0xbf71c8,_0x2d06f5['location']);const _0x1550dd={'timestamp':_0x231b39,'id':_0x181a01,'name':_0x2d06f5[_0x3e622c(0x1a1)],'type':_0x2d06f5[_0x3e622c(0x1d2)],'location':_0x2d06f5[_0x3e622c(0x1a8)],'value':_0xbf71c8};_0x6b5935[_0x3e622c(0x1a7)][_0x3e622c(0x185)](_0x1550dd);if(_0x6b5935[_0x3e622c(0x1a7)][_0x3e622c(0x1b5)]>HISTORY_MAX_SIZE)_0x6b5935[_0x3e622c(0x1a7)]['pop']();await _0x6b5935[_0x3e622c(0x1d1)]('events.lastEvent',{'val':JSON[_0x3e622c(0x1b2)](_0x1550dd),'ack':!![]}),await _0x6b5935[_0x3e622c(0x1d1)]('events.history',{'val':JSON['stringify'](_0x6b5935[_0x3e622c(0x1a7)]),'ack':!![]});if(_0x6b5935[_0x3e622c(0x19a)]){_0x6b5935[_0x3e622c(0x1af)]['push'](_0x1550dd);if(_0x6b5935[_0x3e622c(0x1af)][_0x3e622c(0x1b5)]>RAW_LOG_MAX_SIZE)_0x6b5935[_0x3e622c(0x1af)][_0x3e622c(0x1b3)](0x0,_0x6b5935['rawEventLog'][_0x3e622c(0x1b5)]-RAW_LOG_MAX_SIZE);await _0x6b5935['setStateAsync'](_0x3e622c(0x1d5),{'val':JSON[_0x3e622c(0x1b2)](_0x6b5935[_0x3e622c(0x1af)]),'ack':!![]}),recordSequence(_0x6b5935,_0x1550dd);}if(_0x2d06f5[_0x3e622c(0x1c7)]&&_0xbf71c8===!![]){if(_0x6b5935[_0x3e622c(0x1be)]&&!_0x6b5935[_0x3e622c(0x1a2)])startExitTimer(_0x6b5935);else{if(!_0x6b5935['isPresent'])setPresence(_0x6b5935,!![]);}}else{if(_0x2d06f5[_0x3e622c(0x1d2)]===_0x3e622c(0x17d)&&_0xbf71c8===!![]){if(_0x6b5935['exitTimer'])abortExitTimer(_0x6b5935);if(!_0x6b5935[_0x3e622c(0x1be)]&&_0x6b5935[_0x3e622c(0x1b7)]==='normal')setPresence(_0x6b5935,!![]);}}if(_0x6b5935[_0x3e622c(0x19a)]&&_0x6b5935['sendToPythonWrapper']){_0x2d06f5[_0x3e622c(0x1d2)]===_0x3e622c(0x17d)&&_0xbf71c8===!![]&&_0x2d06f5[_0x3e622c(0x1a8)]&&_0x6b5935[_0x3e622c(0x171)](_0x3e622c(0x1c6),{'room':_0x2d06f5[_0x3e622c(0x1a8)]});const _0x14817b=[_0x3e622c(0x17a),_0x3e622c(0x183),_0x3e622c(0x18a),'fenster',_0x3e622c(0x18b),'handle',_0x3e622c(0x182),_0x3e622c(0x1bb)][_0x3e622c(0x1ae)](_0x5ccbf8=>_0x556a88[_0x3e622c(0x173)](_0x5ccbf8)),_0x30c8c5=['light',_0x3e622c(0x199),'switch','schalter',_0x3e622c(0x1b4),_0x3e622c(0x1ac)][_0x3e622c(0x1ae)](_0x330943=>_0x556a88[_0x3e622c(0x173)](_0x330943)),_0x236012=[_0x3e622c(0x17d),_0x3e622c(0x1a9),_0x3e622c(0x189),_0x3e622c(0x1d0),_0x3e622c(0x196)][_0x3e622c(0x1ae)](_0x296d3d=>_0x556a88['includes'](_0x296d3d));if(_0x2d06f5[_0x3e622c(0x1a8)]&&(_0x14817b||_0x30c8c5||_0x236012)){const _0x4dc66a=_0xbf71c8===!![]||typeof _0xbf71c8===_0x3e622c(0x1c9)&&_0xbf71c8>0x0,_0x27d8ae=_0x14817b&&!_0x4dc66a&&_0x286114!==undefined&&_0x286114!=_0xbf71c8;if(_0x4dc66a||_0x27d8ae){const _0x556798=_0x6b5935['lastTrackerEventTime']||_0x231b39,_0x55ef87=(_0x231b39-_0x556798)/0x3e8;_0x6b5935[_0x3e622c(0x1d6)]=_0x231b39,_0x6b5935[_0x3e622c(0x171)](_0x3e622c(0x1cc),{'room':_0x2d06f5[_0x3e622c(0x1a8)],'dt':_0x55ef87});}}}return _0x1550dd;}module[a5_0x287a3b(0x178)]={'processSensorEvent':processSensorEvent,'getOutsideTemperatureNumeric':getOutsideTemperatureNumeric,'setPresence':setPresence,'abortExitTimer':abortExitTimer,'startExitTimer':startExitTimer};