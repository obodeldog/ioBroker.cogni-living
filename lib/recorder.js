const a5_0x64a113=a5_0x329a;(function(_0x25f289,_0x5b1cac){const _0x243e3f=a5_0x329a,_0x15d49f=_0x25f289();while(!![]){try{const _0x4369c7=-parseInt(_0x243e3f(0x97))/0x1+parseInt(_0x243e3f(0xce))/0x2+-parseInt(_0x243e3f(0xd7))/0x3*(parseInt(_0x243e3f(0xd8))/0x4)+-parseInt(_0x243e3f(0x94))/0x5+parseInt(_0x243e3f(0xd5))/0x6*(parseInt(_0x243e3f(0x9d))/0x7)+-parseInt(_0x243e3f(0x96))/0x8+parseInt(_0x243e3f(0xf0))/0x9*(parseInt(_0x243e3f(0xdf))/0xa);if(_0x4369c7===_0x5b1cac)break;else _0x15d49f['push'](_0x15d49f['shift']());}catch(_0xd812bf){_0x15d49f['push'](_0x15d49f['shift']());}}}(a5_0x24a3,0x9bfc3));const a5_0x5974c4=(function(){let _0x52d99d=!![];return function(_0x3b8dc5,_0x1b1359){const _0x35473a=_0x52d99d?function(){const _0x38d130=a5_0x329a;if(_0x1b1359){const _0x2c35f2=_0x1b1359[_0x38d130(0xd2)](_0x3b8dc5,arguments);return _0x1b1359=null,_0x2c35f2;}}:function(){};return _0x52d99d=![],_0x35473a;};}()),a5_0x9859ff=a5_0x5974c4(this,function(){const _0x59954a=a5_0x329a;return a5_0x9859ff[_0x59954a(0xa1)]()['search']('(((.+)+)+)+$')[_0x59954a(0xa1)]()[_0x59954a(0xbd)](a5_0x9859ff)['search'](_0x59954a(0xf3));});a5_0x9859ff();function a5_0x329a(_0xa18f1c,_0x41fef4){const _0xca2fb0=a5_0x24a3();return a5_0x329a=function(_0x9859ff,_0x5974c4){_0x9859ff=_0x9859ff-0x90;let _0x24a373=_0xca2fb0[_0x9859ff];return _0x24a373;},a5_0x329a(_0xa18f1c,_0x41fef4);}'use strict';const HISTORY_MAX_SIZE=0x32,RAW_LOG_MAX_SIZE=0x9c4,THERMO_LOG_SIZE=0x3e8,SEQUENCE_TIMEOUT_MS=0x5*0x3c*0x3e8,MAX_TRAINING_SET_SIZE=0x1f4,EXIT_TIMER_MINUTES=0xf,EXIT_GRACE_PERIOD_SECONDS=0x1e;let activeSequence=[],sequenceTimer=null;async function getOutsideTemperatureNumeric(_0x1df77f){const _0x2fa8ca=a5_0x329a;if(_0x1df77f[_0x2fa8ca(0xeb)][_0x2fa8ca(0xd6)])try{const _0x5ccd41=await _0x1df77f['getForeignStateAsync'](_0x1df77f['config'][_0x2fa8ca(0xd6)]);if(_0x5ccd41&&_0x5ccd41[_0x2fa8ca(0xb2)]!==undefined&&_0x5ccd41[_0x2fa8ca(0xb2)]!==null)return parseFloat(_0x5ccd41[_0x2fa8ca(0xb2)]);}catch(_0x50178f){}const _0x43a3ba=_0x1df77f[_0x2fa8ca(0xeb)]['weatherInstance'];if(!_0x1df77f[_0x2fa8ca(0xeb)][_0x2fa8ca(0xc0)]||!_0x43a3ba)return null;try{let _0x8d94d8='';if(_0x43a3ba['includes']('accuweather'))_0x8d94d8=_0x43a3ba+_0x2fa8ca(0xaa);else{if(_0x43a3ba[_0x2fa8ca(0x9a)](_0x2fa8ca(0xa8)))_0x8d94d8=_0x43a3ba+'.NextHours.Location_1.Day_1.current.temp_value';else{if(_0x43a3ba[_0x2fa8ca(0x9a)](_0x2fa8ca(0xbc)))_0x8d94d8=_0x43a3ba+'.forecast.current.temperature';else{if(_0x43a3ba['includes']('weatherunderground'))_0x8d94d8=_0x43a3ba+_0x2fa8ca(0xb1);}}}if(_0x8d94d8){const _0x2307b2=await _0x1df77f[_0x2fa8ca(0xb4)](_0x8d94d8);if(_0x2307b2&&_0x2307b2[_0x2fa8ca(0xb2)]!==undefined&&_0x2307b2[_0x2fa8ca(0xb2)]!==null)return parseFloat(_0x2307b2[_0x2fa8ca(0xb2)]);}}catch(_0x18f5ff){}return null;}async function recordThermodynamics(_0x3b7a99,_0x4eba67,_0x4aeb84,_0x3590f8){const _0x2e4ac9=a5_0x329a,_0x25c8d3=await getOutsideTemperatureNumeric(_0x3b7a99);if(_0x25c8d3===null)return;let _0x238267=0x0,_0x49c744=![];if(_0x3b7a99[_0x2e4ac9(0xeb)]['valveMapping'])try{let _0x32f43e=_0x3b7a99[_0x2e4ac9(0xeb)]['valveMapping'];if(typeof _0x32f43e==='string')_0x32f43e=JSON[_0x2e4ac9(0xe4)](_0x32f43e);if(_0x32f43e[_0x4eba67]){const _0x169a53=_0x32f43e[_0x4eba67],_0x5bed9d=await _0x3b7a99['getForeignStateAsync'](_0x169a53);if(_0x5bed9d&&_0x5bed9d[_0x2e4ac9(0xb2)]!==null&&_0x5bed9d['val']!==undefined){let _0x5c61a9=Number(_0x5bed9d['val']);if(_0x5c61a9<=1.05&&!_0x169a53[_0x2e4ac9(0x9a)]('STATUS')&&!_0x169a53[_0x2e4ac9(0x9a)](_0x2e4ac9(0xc5)))_0x5c61a9=_0x5c61a9*0x64;_0x238267=Math[_0x2e4ac9(0x90)](_0x5c61a9),_0x49c744=!![];}}}catch(_0x451754){}if(!_0x49c744){const _0xf6ae01=[{'from':_0x2e4ac9(0xb8),'to':_0x2e4ac9(0xa9)},{'from':_0x2e4ac9(0xb8),'to':'.1.VALVE_STATE'},{'from':_0x2e4ac9(0xc4),'to':_0x2e4ac9(0x92)},{'from':_0x2e4ac9(0xdd),'to':'.LEVEL'},{'from':_0x2e4ac9(0xb0),'to':_0x2e4ac9(0xdc)},{'from':_0x2e4ac9(0x93),'to':'Valve'}];for(const _0x283614 of _0xf6ae01){if(_0x4eba67[_0x2e4ac9(0x9a)](_0x283614[_0x2e4ac9(0xe9)])){const _0x1e1540=_0x4eba67[_0x2e4ac9(0xcc)](_0x283614['from'],_0x283614['to']);try{const _0x5118be=await _0x3b7a99[_0x2e4ac9(0xb4)](_0x1e1540);if(_0x5118be&&_0x5118be[_0x2e4ac9(0xb2)]!==null&&_0x5118be['val']!==undefined){let _0x2feb97=Number(_0x5118be['val']);if(typeof _0x2feb97===_0x2e4ac9(0xef)){if(_0x2feb97<=1.05&&_0x283614['to'][_0x2e4ac9(0x9a)]('LEVEL'))_0x2feb97=_0x2feb97*0x64;_0x238267=Math[_0x2e4ac9(0x90)](_0x2feb97),_0x49c744=!![];break;}}}catch(_0x1c5001){}}}}const _0x22e85d=await _0x3b7a99[_0x2e4ac9(0xd3)](_0x2e4ac9(0xcd));let _0x4f1f8d=[];if(_0x22e85d&&_0x22e85d[_0x2e4ac9(0xb2)])try{_0x4f1f8d=JSON[_0x2e4ac9(0xe4)](_0x22e85d['val']);}catch(_0x28db15){}_0x4f1f8d[_0x2e4ac9(0xec)]({'ts':Date[_0x2e4ac9(0xa0)](),'room':_0x3590f8||_0x2e4ac9(0xb5),'t_in':_0x4aeb84,'t_out':_0x25c8d3,'valve':_0x238267});if(_0x4f1f8d['length']>THERMO_LOG_SIZE)_0x4f1f8d[_0x2e4ac9(0xc8)]();await _0x3b7a99['setStateAsync'](_0x2e4ac9(0xcd),{'val':JSON[_0x2e4ac9(0xe5)](_0x4f1f8d),'ack':!![]});}async function saveCompletedSequence(_0x5b0d3c){const _0xe323be=a5_0x329a;try{const _0x550573=await _0x5b0d3c[_0xe323be(0xd3)](_0xe323be(0xf1));let _0x4a2635=[];if(_0x550573&&_0x550573[_0xe323be(0xb2)])try{_0x4a2635=JSON['parse'](_0x550573['val']);}catch(_0x58d109){}const _0x83a189=activeSequence[0x0]['ts'],_0x3647fb=activeSequence['map'](_0x514494=>({'loc':_0x514494[_0xe323be(0xc1)],'t_delta':Math[_0xe323be(0x90)]((_0x514494['ts']-_0x83a189)/0x3e8)})),_0xc0e7db={'timestamp':new Date(_0x83a189)[_0xe323be(0xc3)](),'steps':_0x3647fb,'duration':Math[_0xe323be(0x90)]((activeSequence[activeSequence[_0xe323be(0xea)]-0x1]['ts']-_0x83a189)/0x3e8),'daytime':new Date(_0x83a189)[_0xe323be(0xe8)]()};_0x4a2635[_0xe323be(0xec)](_0xc0e7db);if(_0x4a2635[_0xe323be(0xea)]>MAX_TRAINING_SET_SIZE)_0x4a2635[_0xe323be(0xc8)]();await _0x5b0d3c['setStateAsync']('LTM.trainingData.sequences',{'val':JSON[_0xe323be(0xe5)](_0x4a2635),'ack':!![]}),_0x5b0d3c['isProVersion']&&_0x5b0d3c[_0xe323be(0xd4)]&&_0x5b0d3c[_0xe323be(0xd4)](_0xe323be(0xba),{'sequence':_0xc0e7db});}catch(_0x4e14c3){_0x5b0d3c[_0xe323be(0xe7)][_0xe323be(0xc2)](_0xe323be(0x91)+_0x4e14c3[_0xe323be(0xe0)]);}}async function recordSequence(_0x250553,_0x141d16){const _0xb9781e=a5_0x329a,_0x54ea2a=(_0x141d16[_0xb9781e(0xaf)]||'')[_0xb9781e(0xd9)](),_0x277917=[_0xb9781e(0xdb),_0xb9781e(0xa5),_0xb9781e(0xbe),_0xb9781e(0xd0),_0xb9781e(0xa6),_0xb9781e(0xe1),_0xb9781e(0xa3),_0xb9781e(0xd1),_0xb9781e(0xb3),'contact',_0xb9781e(0xda),_0xb9781e(0xc9),'licht',_0xb9781e(0x9e),'schalter','dimmer',_0xb9781e(0xf2)];if(!_0x277917[_0xb9781e(0xa7)](_0x387296=>_0x54ea2a[_0xb9781e(0x9a)](_0x387296)))return;if(!_0x141d16[_0xb9781e(0xae)])return;if(sequenceTimer)clearTimeout(sequenceTimer);activeSequence['push']({'loc':_0x141d16[_0xb9781e(0xbf)]||_0xb9781e(0xb5),'id':_0x141d16['id'],'ts':Date['now']()}),sequenceTimer=setTimeout(async()=>{const _0x439373=_0xb9781e;if(activeSequence[_0x439373(0xea)]>0x1)await saveCompletedSequence(_0x250553);activeSequence=[];},SEQUENCE_TIMEOUT_MS);}function startExitTimer(_0x4161c7){const _0xf44fb4=a5_0x329a;abortExitTimer(_0x4161c7),_0x4161c7[_0xf44fb4(0xc6)]=!![],_0x4161c7[_0xf44fb4(0xe2)]=setTimeout(()=>{_0x4161c7['isGracePeriodActive']=![];},EXIT_GRACE_PERIOD_SECONDS*0x3e8),_0x4161c7['exitTimer']=setTimeout(()=>{const _0x1145c2=_0xf44fb4;setPresence(_0x4161c7,![]),_0x4161c7[_0x1145c2(0xad)]=null;},EXIT_TIMER_MINUTES*0x3c*0x3e8);}function abortExitTimer(_0x4b11e6){const _0x33bc37=a5_0x329a;if(_0x4b11e6[_0x33bc37(0xad)])clearTimeout(_0x4b11e6[_0x33bc37(0xad)]);if(_0x4b11e6['exitGraceTimer'])clearTimeout(_0x4b11e6['exitGraceTimer']);_0x4b11e6['exitTimer']=null,_0x4b11e6['exitGraceTimer']=null,_0x4b11e6['isGracePeriodActive']=![];}async function setPresence(_0x4279f4,_0x38ac7e){const _0x5369d8=a5_0x329a;if(_0x4279f4['isPresent']===_0x38ac7e)return;_0x4279f4[_0x5369d8(0xb9)]=_0x38ac7e,await _0x4279f4[_0x5369d8(0xcb)](_0x5369d8(0xb6),{'val':_0x38ac7e,'ack':!![]});}async function processSensorEvent(_0x346e3c,_0x2e1a9b,_0x347200,_0x4605e5){const _0xd8ccb9=a5_0x329a;if(!_0x4605e5)return null;const _0xd3911b=_0x347200['val'],_0x283754=Date[_0xd8ccb9(0xa0)](),_0x15ae1b=_0x346e3c[_0xd8ccb9(0xcf)][_0x2e1a9b],_0x1ad810=(_0x4605e5['type']||'')[_0xd8ccb9(0xd9)](),_0x3affdf=_0x1ad810[_0xd8ccb9(0x9a)](_0xd8ccb9(0xb0))||_0x1ad810['includes'](_0xd8ccb9(0x95))||_0x1ad810[_0xd8ccb9(0x9a)](_0xd8ccb9(0x98))||_0x1ad810[_0xd8ccb9(0x9a)]('heizung')||_0x1ad810[_0xd8ccb9(0x9a)]('thermostat');if(_0x3affdf&&typeof _0xd3911b===_0xd8ccb9(0xef)){if(_0xd3911b>0x50||_0xd3911b<-0x32)return _0x346e3c[_0xd8ccb9(0xe7)][_0xd8ccb9(0x9b)](_0xd8ccb9(0xf4)+_0xd3911b+_0xd8ccb9(0xab)+_0x2e1a9b),null;}_0x346e3c[_0xd8ccb9(0xcf)][_0x2e1a9b]=_0xd3911b;if(!_0x4605e5['logDuplicates']&&_0x15ae1b!=undefined&&_0x15ae1b==_0xd3911b)return null;_0x346e3c['isProVersion']&&_0x3affdf&&recordThermodynamics(_0x346e3c,_0x2e1a9b,_0xd3911b,_0x4605e5[_0xd8ccb9(0xbf)]);const _0xea5296={'timestamp':_0x283754,'id':_0x2e1a9b,'name':_0x4605e5[_0xd8ccb9(0xac)],'type':_0x4605e5[_0xd8ccb9(0xaf)],'location':_0x4605e5[_0xd8ccb9(0xbf)],'value':_0xd3911b};_0x346e3c[_0xd8ccb9(0xde)]['unshift'](_0xea5296);if(_0x346e3c[_0xd8ccb9(0xde)][_0xd8ccb9(0xea)]>HISTORY_MAX_SIZE)_0x346e3c[_0xd8ccb9(0xde)]['pop']();await _0x346e3c['setStateAsync']('events.lastEvent',{'val':JSON[_0xd8ccb9(0xe5)](_0xea5296),'ack':!![]}),await _0x346e3c[_0xd8ccb9(0xcb)]('events.history',{'val':JSON[_0xd8ccb9(0xe5)](_0x346e3c[_0xd8ccb9(0xde)]),'ack':!![]});if(_0x346e3c['isProVersion']){_0x346e3c[_0xd8ccb9(0xed)][_0xd8ccb9(0xec)](_0xea5296);if(_0x346e3c[_0xd8ccb9(0xed)]['length']>RAW_LOG_MAX_SIZE)_0x346e3c[_0xd8ccb9(0xed)][_0xd8ccb9(0xa2)](0x0,_0x346e3c[_0xd8ccb9(0xed)][_0xd8ccb9(0xea)]-RAW_LOG_MAX_SIZE);await _0x346e3c['setStateAsync'](_0xd8ccb9(0xbb),{'val':JSON[_0xd8ccb9(0xe5)](_0x346e3c['rawEventLog']),'ack':!![]}),recordSequence(_0x346e3c,_0xea5296);}if(_0x4605e5[_0xd8ccb9(0xc7)]&&_0xd3911b===!![]){if(_0x346e3c[_0xd8ccb9(0xb9)]&&!_0x346e3c['isGracePeriodActive'])startExitTimer(_0x346e3c);else{if(!_0x346e3c['isPresent'])setPresence(_0x346e3c,!![]);}}else{if(_0x4605e5[_0xd8ccb9(0xaf)]===_0xd8ccb9(0xdb)&&_0xd3911b===!![]){if(_0x346e3c[_0xd8ccb9(0xad)])abortExitTimer(_0x346e3c);if(!_0x346e3c[_0xd8ccb9(0xb9)]&&_0x346e3c[_0xd8ccb9(0xe6)]===_0xd8ccb9(0xee))setPresence(_0x346e3c,!![]);}}if(_0x346e3c[_0xd8ccb9(0x9f)]&&_0x346e3c['sendToPythonWrapper']){_0x4605e5[_0xd8ccb9(0xaf)]===_0xd8ccb9(0xdb)&&_0xd3911b===!![]&&_0x4605e5[_0xd8ccb9(0xbf)]&&_0x346e3c[_0xd8ccb9(0xd4)](_0xd8ccb9(0xe3),{'room':_0x4605e5['location']});const _0x4b0b41=['door',_0xd8ccb9(0xa3),_0xd8ccb9(0xd1),_0xd8ccb9(0xb3),'griff','handle',_0xd8ccb9(0xa4),_0xd8ccb9(0xca)]['some'](_0x5e0f35=>_0x1ad810[_0xd8ccb9(0x9a)](_0x5e0f35)),_0x2d33e9=[_0xd8ccb9(0xc9),'licht',_0xd8ccb9(0x9e),_0xd8ccb9(0x9c),'dimmer',_0xd8ccb9(0xf2)][_0xd8ccb9(0xa7)](_0x21b153=>_0x1ad810['includes'](_0x21b153)),_0x2a4b63=[_0xd8ccb9(0xdb),'bewegung',_0xd8ccb9(0xbe),_0xd8ccb9(0xd0),_0xd8ccb9(0xa6)][_0xd8ccb9(0xa7)](_0x3493a2=>_0x1ad810['includes'](_0x3493a2));if(_0x4605e5[_0xd8ccb9(0xbf)]&&(_0x4b0b41||_0x2d33e9||_0x2a4b63)){const _0x4684f0=_0xd3911b===!![]||typeof _0xd3911b===_0xd8ccb9(0xef)&&_0xd3911b>0x0,_0x46677f=_0x4b0b41&&!_0x4684f0&&_0x15ae1b!==undefined&&_0x15ae1b!=_0xd3911b;if(_0x4684f0||_0x46677f){const _0x563727=_0x346e3c[_0xd8ccb9(0x99)]||_0x283754,_0x5554a1=(_0x283754-_0x563727)/0x3e8;_0x346e3c[_0xd8ccb9(0x99)]=_0x283754,_0x346e3c[_0xd8ccb9(0xd4)]('TRACK_EVENT',{'room':_0x4605e5['location'],'dt':_0x5554a1});}}}return _0xea5296;}function a5_0x24a3(){const _0x386eea=['215088oMdfpr','outdoorSensorId','79026cAsvcm','124tmisqR','toLowerCase','kontakt','motion','level','.ACTUAL_TEMPERATURE','eventHistory','10ZMSjGG','message','door','exitGraceTimer','SIMULATE_SIGNAL','parse','stringify','currentSystemMode','log','getHours','from','length','config','push','rawEventLog','normal','number','4037157vfAtfz','LTM.trainingData.sequences','lampe','(((.+)+)+)+$','[RECORDER]\x20Ignored\x20implausible\x20temperature:\x20','round','[RECORDER]\x20Error:\x20','.4.VALVE_STATE','Temperature','928995MdosGA','temperatur','8291752VcBrCW','139110MpbXun','klima','lastTrackerEventTime','includes','debug','schalter','217NAFPRL','switch','isProVersion','now','toString','splice','tür','lock','bewegung','occupancy','some','daswetter','.1.LEVEL','.Current.Temperature','\x20from\x20','name','exitTimer','value','type','temperature','.forecast.current.temp','val','fenster','getForeignStateAsync','Unknown','system.isPresent','exports','.1.ACTUAL_TEMPERATURE','isPresent','ANALYZE_SEQUENCE','LTM.rawEventLog','openweathermap','constructor','präsenz','location','useWeather','loc','error','toISOString','.1.TEMPERATURE','STATE','isGracePeriodActive','isExit','shift','light','schloss','setStateAsync','replace','LTM.trainingData.thermodynamics','2514068atHNop','sensorLastValues','presence','window','apply','getStateAsync','sendToPythonWrapper'];a5_0x24a3=function(){return _0x386eea;};return a5_0x24a3();}module[a5_0x64a113(0xb7)]={'processSensorEvent':processSensorEvent,'getOutsideTemperatureNumeric':getOutsideTemperatureNumeric,'setPresence':setPresence,'abortExitTimer':abortExitTimer,'startExitTimer':startExitTimer};