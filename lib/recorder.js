(function(_0x2a464c,_0x34f209){const _0xc11b70=a5_0xea28,_0x2eccf5=_0x2a464c();while(!![]){try{const _0x19ead2=parseInt(_0xc11b70(0x202))/0x1+-parseInt(_0xc11b70(0x23b))/0x2*(-parseInt(_0xc11b70(0x224))/0x3)+-parseInt(_0xc11b70(0x23c))/0x4+parseInt(_0xc11b70(0x23e))/0x5+-parseInt(_0xc11b70(0x22e))/0x6+-parseInt(_0xc11b70(0x244))/0x7*(parseInt(_0xc11b70(0x1fe))/0x8)+parseInt(_0xc11b70(0x208))/0x9;if(_0x19ead2===_0x34f209)break;else _0x2eccf5['push'](_0x2eccf5['shift']());}catch(_0x2cde72){_0x2eccf5['push'](_0x2eccf5['shift']());}}}(a5_0x1d0a,0x5659c));const a5_0x409f9f=(function(){let _0x23f61f=!![];return function(_0x482205,_0x4e48c8){const _0x45c45a=_0x23f61f?function(){const _0x2e4c33=a5_0xea28;if(_0x4e48c8){const _0x5b513a=_0x4e48c8[_0x2e4c33(0x23a)](_0x482205,arguments);return _0x4e48c8=null,_0x5b513a;}}:function(){};return _0x23f61f=![],_0x45c45a;};}()),a5_0x65626e=a5_0x409f9f(this,function(){const _0x47c57d=a5_0xea28;return a5_0x65626e[_0x47c57d(0x240)]()['search']('(((.+)+)+)+$')[_0x47c57d(0x240)]()[_0x47c57d(0x211)](a5_0x65626e)[_0x47c57d(0x243)](_0x47c57d(0x209));});a5_0x65626e();'use strict';const HISTORY_MAX_SIZE=0x32,RAW_LOG_MAX_SIZE=0x9c4,THERMO_LOG_SIZE=0x3e8,SEQUENCE_TIMEOUT_MS=0x5*0x3c*0x3e8,MAX_TRAINING_SET_SIZE=0x1f4,EXIT_TIMER_MINUTES=0xf,EXIT_GRACE_PERIOD_SECONDS=0x1e;let activeSequence=[],sequenceTimer=null;async function getOutsideTemperatureNumeric(_0x3145d2){const _0x4c6b71=a5_0xea28;if(_0x3145d2[_0x4c6b71(0x221)][_0x4c6b71(0x1f7)])try{const _0x3bf07d=await _0x3145d2[_0x4c6b71(0x234)](_0x3145d2[_0x4c6b71(0x221)][_0x4c6b71(0x1f7)]);if(_0x3bf07d&&_0x3bf07d['val']!==undefined&&_0x3bf07d['val']!==null)return parseFloat(_0x3bf07d['val']);}catch(_0x6ed8e2){}const _0x242f84=_0x3145d2[_0x4c6b71(0x221)]['weatherInstance'];if(!_0x3145d2[_0x4c6b71(0x221)]['useWeather']||!_0x242f84)return null;try{let _0x255966='';if(_0x242f84[_0x4c6b71(0x22c)](_0x4c6b71(0x223)))_0x255966=_0x242f84+_0x4c6b71(0x232);else{if(_0x242f84[_0x4c6b71(0x22c)](_0x4c6b71(0x1fd)))_0x255966=_0x242f84+'.NextHours.Location_1.Day_1.current.temp_value';else{if(_0x242f84[_0x4c6b71(0x22c)](_0x4c6b71(0x1f6)))_0x255966=_0x242f84+'.forecast.current.temperature';else{if(_0x242f84[_0x4c6b71(0x22c)](_0x4c6b71(0x1f8)))_0x255966=_0x242f84+'.forecast.current.temp';}}}if(_0x255966){const _0x95f08=await _0x3145d2[_0x4c6b71(0x234)](_0x255966);if(_0x95f08&&_0x95f08[_0x4c6b71(0x22f)]!==undefined&&_0x95f08[_0x4c6b71(0x22f)]!==null)return parseFloat(_0x95f08[_0x4c6b71(0x22f)]);}}catch(_0x29832d){}return null;}async function recordThermodynamics(_0x1bd0a3,_0xe3a22d,_0x2c5f04,_0x13eb7d){const _0x1e6c55=a5_0xea28,_0x5ab669=await getOutsideTemperatureNumeric(_0x1bd0a3);let _0x32bc51=0x0;if(_0xe3a22d[_0x1e6c55(0x22c)](_0x1e6c55(0x214))){const _0xff39b7=[{'from':_0x1e6c55(0x210),'to':_0x1e6c55(0x1f9)},{'from':_0x1e6c55(0x210),'to':_0x1e6c55(0x1fa)},{'from':_0x1e6c55(0x1ed),'to':_0x1e6c55(0x1fc)},{'from':'.ACTUAL_TEMPERATURE','to':'.LEVEL'}];for(const _0x4b577f of _0xff39b7){if(_0xe3a22d['includes'](_0x4b577f[_0x1e6c55(0x23f)])){const _0xd2fa1f=_0xe3a22d[_0x1e6c55(0x225)](_0x4b577f[_0x1e6c55(0x23f)],_0x4b577f['to']);try{const _0x20a372=await _0x1bd0a3['getForeignStateAsync'](_0xd2fa1f);if(_0x20a372&&_0x20a372['val']!==null&&_0x20a372[_0x1e6c55(0x22f)]!==undefined){let _0x220d02=_0x20a372[_0x1e6c55(0x22f)];typeof _0x220d02===_0x1e6c55(0x226)&&_0x220d02<=1.05&&_0x4b577f['to'][_0x1e6c55(0x22c)](_0x1e6c55(0x1f0))&&(_0x220d02=_0x220d02*0x64);_0x32bc51=Math[_0x1e6c55(0x21f)](_0x220d02);break;}}catch(_0x599455){}}}}const _0x15e3a7=await _0x1bd0a3[_0x1e6c55(0x220)](_0x1e6c55(0x1ef));let _0x4ed50c=[];if(_0x15e3a7&&_0x15e3a7[_0x1e6c55(0x22f)])try{_0x4ed50c=JSON[_0x1e6c55(0x1fb)](_0x15e3a7['val']);}catch(_0x587807){}_0x4ed50c[_0x1e6c55(0x230)]({'ts':Date[_0x1e6c55(0x238)](),'room':_0x13eb7d||_0x1e6c55(0x20d),'t_in':_0x2c5f04,'t_out':_0x5ab669,'valve':_0x32bc51});if(_0x4ed50c['length']>THERMO_LOG_SIZE)_0x4ed50c[_0x1e6c55(0x233)]();await _0x1bd0a3['setStateAsync']('LTM.trainingData.thermodynamics',{'val':JSON[_0x1e6c55(0x1f1)](_0x4ed50c),'ack':!![]});}async function saveCompletedSequence(_0xd564ee){const _0xd8a473=a5_0xea28;try{const _0x33e81a=await _0xd564ee['getStateAsync'](_0xd8a473(0x1ec));let _0x3982d=[];if(_0x33e81a&&_0x33e81a[_0xd8a473(0x22f)])try{_0x3982d=JSON[_0xd8a473(0x1fb)](_0x33e81a[_0xd8a473(0x22f)]);}catch(_0x19c087){}const _0x49cea7=activeSequence[0x0]['ts'],_0x2736df=activeSequence['map'](_0x2bcff4=>({'loc':_0x2bcff4[_0xd8a473(0x21b)],'t_delta':Math['round']((_0x2bcff4['ts']-_0x49cea7)/0x3e8)})),_0x5acfb9={'timestamp':new Date(_0x49cea7)[_0xd8a473(0x206)](),'steps':_0x2736df,'duration':Math[_0xd8a473(0x21f)]((activeSequence[activeSequence[_0xd8a473(0x201)]-0x1]['ts']-_0x49cea7)/0x3e8),'daytime':new Date(_0x49cea7)['getHours']()};_0x3982d[_0xd8a473(0x230)](_0x5acfb9);if(_0x3982d[_0xd8a473(0x201)]>MAX_TRAINING_SET_SIZE)_0x3982d['shift']();await _0xd564ee[_0xd8a473(0x241)]('LTM.trainingData.sequences',{'val':JSON[_0xd8a473(0x1f1)](_0x3982d),'ack':!![]}),_0xd564ee[_0xd8a473(0x21c)]&&_0xd564ee[_0xd8a473(0x204)]&&_0xd564ee[_0xd8a473(0x204)](_0xd8a473(0x205),{'sequence':_0x5acfb9});}catch(_0x504c56){_0xd564ee[_0xd8a473(0x1ee)]['error'](_0xd8a473(0x242)+_0x504c56[_0xd8a473(0x20f)]);}}async function recordSequence(_0x33b7fa,_0x30d33c){const _0x24cc7c=a5_0xea28,_0x24fc5f=(_0x30d33c['type']||'')[_0x24cc7c(0x200)](),_0x4769be=[_0x24cc7c(0x21a),'bewegung',_0x24cc7c(0x21d),'presence',_0x24cc7c(0x1f3),_0x24cc7c(0x212),_0x24cc7c(0x213),_0x24cc7c(0x235),'fenster','contact',_0x24cc7c(0x22a),_0x24cc7c(0x231),_0x24cc7c(0x20e),_0x24cc7c(0x217),'schalter',_0x24cc7c(0x21e),_0x24cc7c(0x20b)];if(!_0x4769be['some'](_0x4ad5c2=>_0x24fc5f['includes'](_0x4ad5c2)))return;if(!_0x30d33c[_0x24cc7c(0x1f4)])return;if(sequenceTimer)clearTimeout(sequenceTimer);activeSequence[_0x24cc7c(0x230)]({'loc':_0x30d33c[_0x24cc7c(0x22b)]||'Unknown','id':_0x30d33c['id'],'ts':Date[_0x24cc7c(0x238)]()}),sequenceTimer=setTimeout(async()=>{const _0x32a326=_0x24cc7c;if(activeSequence[_0x32a326(0x201)]>0x1)await saveCompletedSequence(_0x33b7fa);activeSequence=[];},SEQUENCE_TIMEOUT_MS);}function a5_0xea28(_0x518ceb,_0x2b7ec2){const _0x431131=a5_0x1d0a();return a5_0xea28=function(_0x65626e,_0x409f9f){_0x65626e=_0x65626e-0x1ec;let _0x1d0a0a=_0x431131[_0x65626e];return _0x1d0a0a;},a5_0xea28(_0x518ceb,_0x2b7ec2);}function startExitTimer(_0x1d5352){const _0xc8c9e2=a5_0xea28;abortExitTimer(_0x1d5352),_0x1d5352[_0xc8c9e2(0x1f2)]=!![],_0x1d5352[_0xc8c9e2(0x207)]=setTimeout(()=>{const _0x10e3da=_0xc8c9e2;_0x1d5352[_0x10e3da(0x1f2)]=![];},EXIT_GRACE_PERIOD_SECONDS*0x3e8),_0x1d5352[_0xc8c9e2(0x1ff)]=setTimeout(()=>{const _0x116ceb=_0xc8c9e2;setPresence(_0x1d5352,![]),_0x1d5352[_0x116ceb(0x1ff)]=null;},EXIT_TIMER_MINUTES*0x3c*0x3e8);}function abortExitTimer(_0x20c202){const _0x30d8ae=a5_0xea28;if(_0x20c202[_0x30d8ae(0x1ff)])clearTimeout(_0x20c202['exitTimer']);if(_0x20c202[_0x30d8ae(0x207)])clearTimeout(_0x20c202[_0x30d8ae(0x207)]);_0x20c202[_0x30d8ae(0x1ff)]=null,_0x20c202[_0x30d8ae(0x207)]=null,_0x20c202['isGracePeriodActive']=![];}async function setPresence(_0x4d5237,_0x248bd8){const _0x231c43=a5_0xea28;if(_0x4d5237[_0x231c43(0x216)]===_0x248bd8)return;_0x4d5237[_0x231c43(0x216)]=_0x248bd8,await _0x4d5237[_0x231c43(0x241)](_0x231c43(0x203),{'val':_0x248bd8,'ack':!![]});}function a5_0x1d0a(){const _0x6e0988=['tür','hm-rpc','isExit','isPresent','switch','klima','events.lastEvent','motion','loc','isProVersion','präsenz','dimmer','round','getStateAsync','config','temperature','accuweather','3PWxdUQ','replace','number','temperatur','heizung','eventHistory','kontakt','location','includes','name','3904890HNlYmO','val','push','light','.Current.Temperature','shift','getForeignStateAsync','window','LTM.rawEventLog','SIMULATE_SIGNAL','now','type','apply','450474qfaXGP','1615644paIncM','unshift','167205ZfhtXk','from','toString','setStateAsync','[RECORDER]\x20Error:\x20','search','12761mXhrhg','LTM.trainingData.sequences','.1.TEMPERATURE','log','LTM.trainingData.thermodynamics','LEVEL','stringify','isGracePeriodActive','occupancy','value','rawEventLog','openweathermap','outdoorSensorId','weatherunderground','.1.LEVEL','.1.VALVE_STATE','parse','.4.VALVE_STATE','daswetter','248wysqpV','exitTimer','toLowerCase','length','39384pBeVoa','system.isPresent','sendToPythonWrapper','ANALYZE_SEQUENCE','toISOString','exitGraceTimer','10501821lMyDZR','(((.+)+)+)+$','currentSystemMode','lampe','sensorLastValues','Unknown','licht','message','.1.ACTUAL_TEMPERATURE','constructor','door'];a5_0x1d0a=function(){return _0x6e0988;};return a5_0x1d0a();}async function processSensorEvent(_0x2e4467,_0x14d2c5,_0x2c8c9e,_0x8b1be){const _0x5e1351=a5_0xea28;if(!_0x8b1be)return null;const _0x567f8a=_0x2c8c9e[_0x5e1351(0x22f)],_0x3aeba7=Date[_0x5e1351(0x238)](),_0x48f98c=_0x2e4467[_0x5e1351(0x20c)][_0x14d2c5];_0x2e4467[_0x5e1351(0x20c)][_0x14d2c5]=_0x567f8a;if(!_0x8b1be['logDuplicates']&&_0x48f98c!=undefined&&_0x48f98c==_0x567f8a)return null;const _0x167b25=(_0x8b1be[_0x5e1351(0x239)]||'')[_0x5e1351(0x200)](),_0x30ecfb=_0x167b25[_0x5e1351(0x22c)](_0x5e1351(0x222))||_0x167b25['includes'](_0x5e1351(0x227))||_0x167b25[_0x5e1351(0x22c)](_0x5e1351(0x218))||_0x167b25['includes'](_0x5e1351(0x228));_0x2e4467[_0x5e1351(0x21c)]&&_0x30ecfb&&recordThermodynamics(_0x2e4467,_0x14d2c5,_0x567f8a,_0x8b1be[_0x5e1351(0x22b)]);const _0x3e1670={'timestamp':_0x3aeba7,'id':_0x14d2c5,'name':_0x8b1be[_0x5e1351(0x22d)],'type':_0x8b1be['type'],'location':_0x8b1be[_0x5e1351(0x22b)],'value':_0x567f8a};_0x2e4467[_0x5e1351(0x229)][_0x5e1351(0x23d)](_0x3e1670);if(_0x2e4467[_0x5e1351(0x229)][_0x5e1351(0x201)]>HISTORY_MAX_SIZE)_0x2e4467['eventHistory']['pop']();await _0x2e4467[_0x5e1351(0x241)](_0x5e1351(0x219),{'val':JSON['stringify'](_0x3e1670),'ack':!![]}),await _0x2e4467[_0x5e1351(0x241)]('events.history',{'val':JSON[_0x5e1351(0x1f1)](_0x2e4467[_0x5e1351(0x229)]),'ack':!![]});if(_0x2e4467[_0x5e1351(0x21c)]){_0x2e4467[_0x5e1351(0x1f5)][_0x5e1351(0x230)](_0x3e1670);if(_0x2e4467['rawEventLog'][_0x5e1351(0x201)]>RAW_LOG_MAX_SIZE)_0x2e4467[_0x5e1351(0x1f5)]['splice'](0x0,_0x2e4467[_0x5e1351(0x1f5)][_0x5e1351(0x201)]-RAW_LOG_MAX_SIZE);await _0x2e4467[_0x5e1351(0x241)](_0x5e1351(0x236),{'val':JSON['stringify'](_0x2e4467[_0x5e1351(0x1f5)]),'ack':!![]}),recordSequence(_0x2e4467,_0x3e1670);}if(_0x8b1be[_0x5e1351(0x215)]&&_0x567f8a===!![]){if(_0x2e4467['isPresent']&&!_0x2e4467['isGracePeriodActive'])startExitTimer(_0x2e4467);else{if(!_0x2e4467['isPresent'])setPresence(_0x2e4467,!![]);}}else{if(_0x8b1be['type']==='motion'&&_0x567f8a===!![]){if(_0x2e4467[_0x5e1351(0x1ff)])abortExitTimer(_0x2e4467);if(!_0x2e4467[_0x5e1351(0x216)]&&_0x2e4467[_0x5e1351(0x20a)]==='normal')setPresence(_0x2e4467,!![]);}}return _0x2e4467[_0x5e1351(0x21c)]&&_0x8b1be['type']==='motion'&&_0x567f8a===!![]&&_0x8b1be['location']&&_0x2e4467['sendToPythonWrapper']&&_0x2e4467['sendToPythonWrapper'](_0x5e1351(0x237),{'room':_0x8b1be[_0x5e1351(0x22b)]}),_0x3e1670;}module['exports']={'processSensorEvent':processSensorEvent,'getOutsideTemperatureNumeric':getOutsideTemperatureNumeric,'setPresence':setPresence,'abortExitTimer':abortExitTimer,'startExitTimer':startExitTimer};