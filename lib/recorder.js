const a5_0x2306bf=a5_0x2abb;(function(_0x3da57f,_0x2e6141){const _0x5a7683=a5_0x2abb,_0x50660f=_0x3da57f();while(!![]){try{const _0x454ee4=parseInt(_0x5a7683(0xdd))/0x1*(-parseInt(_0x5a7683(0x10b))/0x2)+parseInt(_0x5a7683(0x102))/0x3+-parseInt(_0x5a7683(0xe7))/0x4+parseInt(_0x5a7683(0xc1))/0x5*(-parseInt(_0x5a7683(0xf9))/0x6)+-parseInt(_0x5a7683(0xd3))/0x7+-parseInt(_0x5a7683(0xba))/0x8+parseInt(_0x5a7683(0xdb))/0x9;if(_0x454ee4===_0x2e6141)break;else _0x50660f['push'](_0x50660f['shift']());}catch(_0x389759){_0x50660f['push'](_0x50660f['shift']());}}}(a5_0x540f,0xbe942));const a5_0x1c872a=(function(){let _0x1e7ffd=!![];return function(_0x1c87c5,_0x3e2c2f){const _0x5e5dee=_0x1e7ffd?function(){const _0x361467=a5_0x2abb;if(_0x3e2c2f){const _0xb7ba71=_0x3e2c2f[_0x361467(0xf6)](_0x1c87c5,arguments);return _0x3e2c2f=null,_0xb7ba71;}}:function(){};return _0x1e7ffd=![],_0x5e5dee;};}()),a5_0xd12df2=a5_0x1c872a(this,function(){const _0x1bdcaa=a5_0x2abb;return a5_0xd12df2[_0x1bdcaa(0xcc)]()['search'](_0x1bdcaa(0x10c))['toString']()[_0x1bdcaa(0xef)](a5_0xd12df2)[_0x1bdcaa(0xfc)]('(((.+)+)+)+$');});function a5_0x540f(){const _0x2ee4e1=['config','.1.VALVE_STATE','ANALYZE_SEQUENCE','.NextHours.Location_1.Day_1.current.temp_value','fenster','getStateAsync','15354YbWTlW','(((.+)+)+)+$','loc','type','isPresent','LTM.trainingData.sequences','7789728zDDCpP','isGracePeriodActive','LTM.trainingData.thermodynamics','exitTimer','daswetter','pop','LEVEL','120480hixdqh','isProVersion','toLowerCase','temperature','map','location','[RECORDER]\x20Error:\x20','.forecast.current.temp','useWeather','includes','bewegung','toString','presence','parse','length','getForeignStateAsync','stringify','setStateAsync','2799524xOIwVT','light','message','accuweather','from','name','sendToPythonWrapper','weatherInstance','38064969bxMnXu','switch','139BTWyPR','eventHistory','system.isPresent','number','.Current.Temperature','motion','val','events.lastEvent','getHours','unshift','4380664XwfThk','exitGraceTimer','shift','klima','door','openweathermap','push','logDuplicates','constructor','outdoorSensorId','dimmer','heizung','rawEventLog','.ACTUAL_TEMPERATURE','.LEVEL','apply','präsenz','lampe','30KGqikt','Unknown','sensorLastValues','search','.1.ACTUAL_TEMPERATURE','exports','value','now','round','622698Ijinjn','.1.TEMPERATURE','.4.VALVE_STATE'];a5_0x540f=function(){return _0x2ee4e1;};return a5_0x540f();}a5_0xd12df2();'use strict';const HISTORY_MAX_SIZE=0x32,RAW_LOG_MAX_SIZE=0x9c4,THERMO_LOG_SIZE=0x3e8,SEQUENCE_TIMEOUT_MS=0x5*0x3c*0x3e8,MAX_TRAINING_SET_SIZE=0x1f4,EXIT_TIMER_MINUTES=0xf,EXIT_GRACE_PERIOD_SECONDS=0x1e;let activeSequence=[],sequenceTimer=null;async function getOutsideTemperatureNumeric(_0x563952){const _0x21afac=a5_0x2abb;if(_0x563952['config'][_0x21afac(0xf0)])try{const _0x246345=await _0x563952[_0x21afac(0xd0)](_0x563952[_0x21afac(0x105)][_0x21afac(0xf0)]);if(_0x246345&&_0x246345[_0x21afac(0xe3)]!==undefined&&_0x246345[_0x21afac(0xe3)]!==null)return parseFloat(_0x246345['val']);}catch(_0x1bff9c){}const _0x2a5416=_0x563952['config'][_0x21afac(0xda)];if(!_0x563952['config'][_0x21afac(0xc9)]||!_0x2a5416)return null;try{let _0x6f6678='';if(_0x2a5416[_0x21afac(0xca)](_0x21afac(0xd6)))_0x6f6678=_0x2a5416+_0x21afac(0xe1);else{if(_0x2a5416[_0x21afac(0xca)](_0x21afac(0xbe)))_0x6f6678=_0x2a5416+_0x21afac(0x108);else{if(_0x2a5416['includes'](_0x21afac(0xec)))_0x6f6678=_0x2a5416+'.forecast.current.temperature';else{if(_0x2a5416['includes']('weatherunderground'))_0x6f6678=_0x2a5416+_0x21afac(0xc8);}}}if(_0x6f6678){const _0x3d4667=await _0x563952[_0x21afac(0xd0)](_0x6f6678);if(_0x3d4667&&_0x3d4667['val']!==undefined&&_0x3d4667['val']!==null)return parseFloat(_0x3d4667[_0x21afac(0xe3)]);}}catch(_0x148414){}return null;}async function recordThermodynamics(_0x57a3fe,_0x1e6953,_0x583842,_0x3b2677){const _0x3a83eb=a5_0x2abb,_0x293cee=await getOutsideTemperatureNumeric(_0x57a3fe);let _0x1cdc73=0x0;if(_0x1e6953[_0x3a83eb(0xca)]('hm-rpc')){const _0x35629e=[{'from':'.1.ACTUAL_TEMPERATURE','to':'.1.LEVEL'},{'from':_0x3a83eb(0xfd),'to':_0x3a83eb(0x106)},{'from':_0x3a83eb(0x103),'to':_0x3a83eb(0x104)},{'from':_0x3a83eb(0xf4),'to':_0x3a83eb(0xf5)}];for(const _0xeb4c43 of _0x35629e){if(_0x1e6953[_0x3a83eb(0xca)](_0xeb4c43[_0x3a83eb(0xd7)])){const _0x25ff4b=_0x1e6953['replace'](_0xeb4c43[_0x3a83eb(0xd7)],_0xeb4c43['to']);try{const _0x44bf7b=await _0x57a3fe['getForeignStateAsync'](_0x25ff4b);if(_0x44bf7b&&_0x44bf7b['val']!==null&&_0x44bf7b[_0x3a83eb(0xe3)]!==undefined){let _0x2df99f=_0x44bf7b[_0x3a83eb(0xe3)];typeof _0x2df99f===_0x3a83eb(0xe0)&&_0x2df99f<=1.05&&_0xeb4c43['to'][_0x3a83eb(0xca)](_0x3a83eb(0xc0))&&(_0x2df99f=_0x2df99f*0x64);_0x1cdc73=Math[_0x3a83eb(0x101)](_0x2df99f);break;}}catch(_0x262e2e){}}}}const _0xf43e09=await _0x57a3fe[_0x3a83eb(0x10a)](_0x3a83eb(0xbc));let _0x5e3c02=[];if(_0xf43e09&&_0xf43e09['val'])try{_0x5e3c02=JSON[_0x3a83eb(0xce)](_0xf43e09[_0x3a83eb(0xe3)]);}catch(_0x480497){}_0x5e3c02[_0x3a83eb(0xed)]({'ts':Date[_0x3a83eb(0x100)](),'room':_0x3b2677||'Unknown','t_in':_0x583842,'t_out':_0x293cee,'valve':_0x1cdc73});if(_0x5e3c02[_0x3a83eb(0xcf)]>THERMO_LOG_SIZE)_0x5e3c02['shift']();await _0x57a3fe[_0x3a83eb(0xd2)](_0x3a83eb(0xbc),{'val':JSON[_0x3a83eb(0xd1)](_0x5e3c02),'ack':!![]});}async function saveCompletedSequence(_0x1506f7){const _0x427a17=a5_0x2abb;try{const _0x19ad27=await _0x1506f7[_0x427a17(0x10a)](_0x427a17(0xb9));let _0x982205=[];if(_0x19ad27&&_0x19ad27[_0x427a17(0xe3)])try{_0x982205=JSON[_0x427a17(0xce)](_0x19ad27[_0x427a17(0xe3)]);}catch(_0xbf3d4){}const _0x4fb01b=activeSequence[0x0]['ts'],_0x219ce3=activeSequence[_0x427a17(0xc5)](_0x4f63bb=>({'loc':_0x4f63bb[_0x427a17(0xb6)],'t_delta':Math[_0x427a17(0x101)]((_0x4f63bb['ts']-_0x4fb01b)/0x3e8)})),_0x2c148f={'timestamp':new Date(_0x4fb01b)['toISOString'](),'steps':_0x219ce3,'duration':Math[_0x427a17(0x101)]((activeSequence[activeSequence['length']-0x1]['ts']-_0x4fb01b)/0x3e8),'daytime':new Date(_0x4fb01b)[_0x427a17(0xe5)]()};_0x982205[_0x427a17(0xed)](_0x2c148f);if(_0x982205[_0x427a17(0xcf)]>MAX_TRAINING_SET_SIZE)_0x982205[_0x427a17(0xe9)]();await _0x1506f7[_0x427a17(0xd2)](_0x427a17(0xb9),{'val':JSON[_0x427a17(0xd1)](_0x982205),'ack':!![]}),_0x1506f7[_0x427a17(0xc2)]&&_0x1506f7[_0x427a17(0xd9)]&&_0x1506f7[_0x427a17(0xd9)](_0x427a17(0x107),{'sequence':_0x2c148f});}catch(_0x44a879){_0x1506f7['log']['error'](_0x427a17(0xc7)+_0x44a879[_0x427a17(0xd5)]);}}function a5_0x2abb(_0x2e02f9,_0x2c1856){const _0x1781f0=a5_0x540f();return a5_0x2abb=function(_0xd12df2,_0x1c872a){_0xd12df2=_0xd12df2-0xb6;let _0x540f11=_0x1781f0[_0xd12df2];return _0x540f11;},a5_0x2abb(_0x2e02f9,_0x2c1856);}async function recordSequence(_0x3eaceb,_0x3a6094){const _0x549693=a5_0x2abb,_0x36865f=(_0x3a6094[_0x549693(0xb7)]||'')[_0x549693(0xc3)](),_0x5c8f6a=[_0x549693(0xe2),_0x549693(0xcb),_0x549693(0xf7),_0x549693(0xcd),'occupancy',_0x549693(0xeb),'tür','window',_0x549693(0x109),'contact','kontakt',_0x549693(0xd4),'licht',_0x549693(0xdc),'schalter',_0x549693(0xf1),_0x549693(0xf8)];if(!_0x5c8f6a['some'](_0x427fea=>_0x36865f[_0x549693(0xca)](_0x427fea)))return;if(!_0x3a6094[_0x549693(0xff)])return;if(sequenceTimer)clearTimeout(sequenceTimer);activeSequence[_0x549693(0xed)]({'loc':_0x3a6094[_0x549693(0xc6)]||_0x549693(0xfa),'id':_0x3a6094['id'],'ts':Date['now']()}),sequenceTimer=setTimeout(async()=>{const _0x281c4c=_0x549693;if(activeSequence[_0x281c4c(0xcf)]>0x1)await saveCompletedSequence(_0x3eaceb);activeSequence=[];},SEQUENCE_TIMEOUT_MS);}function startExitTimer(_0x186ca2){const _0x5b69e7=a5_0x2abb;abortExitTimer(_0x186ca2),_0x186ca2['isGracePeriodActive']=!![],_0x186ca2[_0x5b69e7(0xe8)]=setTimeout(()=>{const _0x342348=_0x5b69e7;_0x186ca2[_0x342348(0xbb)]=![];},EXIT_GRACE_PERIOD_SECONDS*0x3e8),_0x186ca2[_0x5b69e7(0xbd)]=setTimeout(()=>{const _0x192d14=_0x5b69e7;setPresence(_0x186ca2,![]),_0x186ca2[_0x192d14(0xbd)]=null;},EXIT_TIMER_MINUTES*0x3c*0x3e8);}function abortExitTimer(_0x25511e){const _0xac7772=a5_0x2abb;if(_0x25511e['exitTimer'])clearTimeout(_0x25511e['exitTimer']);if(_0x25511e[_0xac7772(0xe8)])clearTimeout(_0x25511e['exitGraceTimer']);_0x25511e[_0xac7772(0xbd)]=null,_0x25511e[_0xac7772(0xe8)]=null,_0x25511e[_0xac7772(0xbb)]=![];}async function setPresence(_0x926ea7,_0x1fe250){const _0x5c6f13=a5_0x2abb;if(_0x926ea7[_0x5c6f13(0xb8)]===_0x1fe250)return;_0x926ea7[_0x5c6f13(0xb8)]=_0x1fe250,await _0x926ea7[_0x5c6f13(0xd2)](_0x5c6f13(0xdf),{'val':_0x1fe250,'ack':!![]});}async function processSensorEvent(_0x15d720,_0x429de1,_0x2c5704,_0x1531a3){const _0x42e2b5=a5_0x2abb;if(!_0x1531a3)return null;const _0x813a51=_0x2c5704['val'],_0x3808d0=Date[_0x42e2b5(0x100)](),_0x5ad468=_0x15d720[_0x42e2b5(0xfb)][_0x429de1];_0x15d720[_0x42e2b5(0xfb)][_0x429de1]=_0x813a51;if(!_0x1531a3[_0x42e2b5(0xee)]&&_0x5ad468!=undefined&&_0x5ad468==_0x813a51)return null;const _0x54938f=(_0x1531a3[_0x42e2b5(0xb7)]||'')['toLowerCase'](),_0x302e26=_0x54938f[_0x42e2b5(0xca)](_0x42e2b5(0xc4))||_0x54938f[_0x42e2b5(0xca)]('temperatur')||_0x54938f[_0x42e2b5(0xca)](_0x42e2b5(0xea))||_0x54938f[_0x42e2b5(0xca)](_0x42e2b5(0xf2));_0x15d720[_0x42e2b5(0xc2)]&&_0x302e26&&recordThermodynamics(_0x15d720,_0x429de1,_0x813a51,_0x1531a3[_0x42e2b5(0xc6)]);const _0x768c75={'timestamp':_0x3808d0,'id':_0x429de1,'name':_0x1531a3[_0x42e2b5(0xd8)],'type':_0x1531a3[_0x42e2b5(0xb7)],'location':_0x1531a3['location'],'value':_0x813a51};_0x15d720[_0x42e2b5(0xde)][_0x42e2b5(0xe6)](_0x768c75);if(_0x15d720[_0x42e2b5(0xde)][_0x42e2b5(0xcf)]>HISTORY_MAX_SIZE)_0x15d720[_0x42e2b5(0xde)][_0x42e2b5(0xbf)]();await _0x15d720[_0x42e2b5(0xd2)](_0x42e2b5(0xe4),{'val':JSON['stringify'](_0x768c75),'ack':!![]}),await _0x15d720[_0x42e2b5(0xd2)]('events.history',{'val':JSON[_0x42e2b5(0xd1)](_0x15d720[_0x42e2b5(0xde)]),'ack':!![]});if(_0x15d720[_0x42e2b5(0xc2)]){_0x15d720['rawEventLog'][_0x42e2b5(0xed)](_0x768c75);if(_0x15d720['rawEventLog'][_0x42e2b5(0xcf)]>RAW_LOG_MAX_SIZE)_0x15d720[_0x42e2b5(0xf3)]['splice'](0x0,_0x15d720['rawEventLog'][_0x42e2b5(0xcf)]-RAW_LOG_MAX_SIZE);await _0x15d720[_0x42e2b5(0xd2)]('LTM.rawEventLog',{'val':JSON['stringify'](_0x15d720[_0x42e2b5(0xf3)]),'ack':!![]}),recordSequence(_0x15d720,_0x768c75);}if(_0x1531a3['isExit']&&_0x813a51===!![]){if(_0x15d720['isPresent']&&!_0x15d720[_0x42e2b5(0xbb)])startExitTimer(_0x15d720);else{if(!_0x15d720[_0x42e2b5(0xb8)])setPresence(_0x15d720,!![]);}}else{if(_0x1531a3[_0x42e2b5(0xb7)]==='motion'&&_0x813a51===!![]){if(_0x15d720[_0x42e2b5(0xbd)])abortExitTimer(_0x15d720);if(!_0x15d720[_0x42e2b5(0xb8)]&&_0x15d720['currentSystemMode']==='normal')setPresence(_0x15d720,!![]);}}return _0x15d720[_0x42e2b5(0xc2)]&&_0x1531a3[_0x42e2b5(0xb7)]===_0x42e2b5(0xe2)&&_0x813a51===!![]&&_0x1531a3[_0x42e2b5(0xc6)]&&_0x15d720[_0x42e2b5(0xd9)]&&_0x15d720[_0x42e2b5(0xd9)]('SIMULATE_SIGNAL',{'room':_0x1531a3[_0x42e2b5(0xc6)]}),_0x768c75;}module[a5_0x2306bf(0xfe)]={'processSensorEvent':processSensorEvent,'getOutsideTemperatureNumeric':getOutsideTemperatureNumeric,'setPresence':setPresence,'abortExitTimer':abortExitTimer,'startExitTimer':startExitTimer};