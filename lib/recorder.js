function a5_0x3f32(_0x3813d5,_0x7fbdb7){const _0x25dacb=a5_0x13a3();return a5_0x3f32=function(_0x81e95,_0x397283){_0x81e95=_0x81e95-0x123;let _0x13a3bc=_0x25dacb[_0x81e95];return _0x13a3bc;},a5_0x3f32(_0x3813d5,_0x7fbdb7);}const a5_0x1fa6b9=a5_0x3f32;(function(_0x440da7,_0x8fe956){const _0xdbbfce=a5_0x3f32,_0x218d14=_0x440da7();while(!![]){try{const _0x32d284=parseInt(_0xdbbfce(0x181))/0x1+-parseInt(_0xdbbfce(0x15e))/0x2+-parseInt(_0xdbbfce(0x169))/0x3+-parseInt(_0xdbbfce(0x140))/0x4*(-parseInt(_0xdbbfce(0x161))/0x5)+-parseInt(_0xdbbfce(0x17b))/0x6+parseInt(_0xdbbfce(0x14e))/0x7+parseInt(_0xdbbfce(0x14c))/0x8;if(_0x32d284===_0x8fe956)break;else _0x218d14['push'](_0x218d14['shift']());}catch(_0x83c71b){_0x218d14['push'](_0x218d14['shift']());}}}(a5_0x13a3,0xa7f8c));const a5_0x397283=(function(){let _0x365441=!![];return function(_0xa877b4,_0x5f54a2){const _0xd80be1=_0x365441?function(){const _0x5c884b=a5_0x3f32;if(_0x5f54a2){const _0x46ce90=_0x5f54a2[_0x5c884b(0x187)](_0xa877b4,arguments);return _0x5f54a2=null,_0x46ce90;}}:function(){};return _0x365441=![],_0xd80be1;};}()),a5_0x81e95=a5_0x397283(this,function(){const _0x3f2954=a5_0x3f32;return a5_0x81e95[_0x3f2954(0x143)]()[_0x3f2954(0x18a)](_0x3f2954(0x16e))['toString']()['constructor'](a5_0x81e95)[_0x3f2954(0x18a)](_0x3f2954(0x16e));});a5_0x81e95();'use strict';const HISTORY_MAX_SIZE=0x32,RAW_LOG_MAX_SIZE=0x9c4,THERMO_LOG_SIZE=0x3e8,SEQUENCE_TIMEOUT_MS=0x5*0x3c*0x3e8,MAX_TRAINING_SET_SIZE=0x1f4,EXIT_TIMER_MINUTES=0xf,EXIT_GRACE_PERIOD_SECONDS=0x1e;let activeSequence=[],sequenceTimer=null;async function getOutsideTemperatureNumeric(_0x3f30d4){const _0x11c28a=a5_0x3f32;if(_0x3f30d4[_0x11c28a(0x147)]['outdoorSensorId'])try{const _0x127993=await _0x3f30d4[_0x11c28a(0x159)](_0x3f30d4[_0x11c28a(0x147)][_0x11c28a(0x16d)]);if(_0x127993&&_0x127993[_0x11c28a(0x174)]!==undefined&&_0x127993[_0x11c28a(0x174)]!==null)return parseFloat(_0x127993[_0x11c28a(0x174)]);}catch(_0x283660){}const _0x5e6e27=_0x3f30d4[_0x11c28a(0x147)]['weatherInstance'];if(!_0x3f30d4[_0x11c28a(0x147)][_0x11c28a(0x131)]||!_0x5e6e27)return null;try{let _0x308064='';if(_0x5e6e27[_0x11c28a(0x172)](_0x11c28a(0x167)))_0x308064=_0x5e6e27+'.Current.Temperature';else{if(_0x5e6e27[_0x11c28a(0x172)]('daswetter'))_0x308064=_0x5e6e27+_0x11c28a(0x130);else{if(_0x5e6e27[_0x11c28a(0x172)](_0x11c28a(0x14b)))_0x308064=_0x5e6e27+'.forecast.current.temperature';else{if(_0x5e6e27[_0x11c28a(0x172)](_0x11c28a(0x153)))_0x308064=_0x5e6e27+_0x11c28a(0x156);}}}if(_0x308064){const _0x7c11c2=await _0x3f30d4[_0x11c28a(0x159)](_0x308064);if(_0x7c11c2&&_0x7c11c2[_0x11c28a(0x174)]!==undefined&&_0x7c11c2[_0x11c28a(0x174)]!==null)return parseFloat(_0x7c11c2[_0x11c28a(0x174)]);}}catch(_0x432eba){}return null;}async function recordThermodynamics(_0x4701c1,_0x49a072,_0x1a6509,_0x613cfc){const _0x3327b5=a5_0x3f32,_0x2738f4=await getOutsideTemperatureNumeric(_0x4701c1);if(_0x2738f4===null)return;let _0x1c4711=0x0,_0x28cfe4=![];if(_0x4701c1[_0x3327b5(0x147)]['valveMapping'])try{let _0x5afc89=_0x4701c1[_0x3327b5(0x147)][_0x3327b5(0x12a)];if(typeof _0x5afc89==='string')_0x5afc89=JSON[_0x3327b5(0x171)](_0x5afc89);if(_0x5afc89[_0x49a072]){const _0x1917b0=_0x5afc89[_0x49a072],_0x4e0aca=await _0x4701c1[_0x3327b5(0x159)](_0x1917b0);if(_0x4e0aca&&_0x4e0aca[_0x3327b5(0x174)]!==null&&_0x4e0aca['val']!==undefined){let _0x3bd3dc=Number(_0x4e0aca[_0x3327b5(0x174)]);if(_0x3bd3dc<=1.05&&!_0x1917b0[_0x3327b5(0x172)](_0x3327b5(0x179))&&!_0x1917b0[_0x3327b5(0x172)](_0x3327b5(0x175)))_0x3bd3dc=_0x3bd3dc*0x64;_0x1c4711=Math[_0x3327b5(0x127)](_0x3bd3dc),_0x28cfe4=!![];}}}catch(_0x53d84){}if(!_0x28cfe4){const _0x24e73f=[{'from':'.1.ACTUAL_TEMPERATURE','to':_0x3327b5(0x16a)},{'from':_0x3327b5(0x162),'to':_0x3327b5(0x132)},{'from':_0x3327b5(0x16c),'to':_0x3327b5(0x146)},{'from':'.ACTUAL_TEMPERATURE','to':_0x3327b5(0x13f)},{'from':_0x3327b5(0x158),'to':_0x3327b5(0x18b)},{'from':_0x3327b5(0x123),'to':_0x3327b5(0x152)}];for(const _0x48936a of _0x24e73f){if(_0x49a072[_0x3327b5(0x172)](_0x48936a[_0x3327b5(0x15f)])){const _0x227211=_0x49a072['replace'](_0x48936a['from'],_0x48936a['to']);try{const _0x1d049d=await _0x4701c1[_0x3327b5(0x159)](_0x227211);if(_0x1d049d&&_0x1d049d[_0x3327b5(0x174)]!==null&&_0x1d049d[_0x3327b5(0x174)]!==undefined){let _0x402954=Number(_0x1d049d['val']);if(typeof _0x402954===_0x3327b5(0x136)){if(_0x402954<=1.05&&_0x48936a['to'][_0x3327b5(0x172)]('LEVEL'))_0x402954=_0x402954*0x64;_0x1c4711=Math['round'](_0x402954),_0x28cfe4=!![];break;}}}catch(_0x57b8df){}}}}const _0x2610c8=await _0x4701c1[_0x3327b5(0x17a)](_0x3327b5(0x139));let _0x2f169f=[];if(_0x2610c8&&_0x2610c8[_0x3327b5(0x174)])try{_0x2f169f=JSON[_0x3327b5(0x171)](_0x2610c8[_0x3327b5(0x174)]);}catch(_0x574590){}_0x2f169f['push']({'ts':Date[_0x3327b5(0x133)](),'room':_0x613cfc||'Unknown','t_in':_0x1a6509,'t_out':_0x2738f4,'valve':_0x1c4711});if(_0x2f169f[_0x3327b5(0x13d)]>THERMO_LOG_SIZE)_0x2f169f[_0x3327b5(0x168)]();await _0x4701c1[_0x3327b5(0x184)](_0x3327b5(0x139),{'val':JSON[_0x3327b5(0x134)](_0x2f169f),'ack':!![]});}function a5_0x13a3(){const _0x284727=['val','STATE','splice','message','licht','STATUS','getStateAsync','1612230OcxAov','normal','exitGraceTimer','klima','getHours','LTM.trainingData.sequences','935130noOHwb','lock','exports','setStateAsync','rawEventLog','SIMULATE_SIGNAL','apply','door','loc','search','level','Temperature','system.isPresent','type','sendToPythonWrapper','round','name','motion','valveMapping','exitTimer','debug','LTM.rawEventLog','toISOString','isPresent','.NextHours.Location_1.Day_1.current.temp_value','useWeather','.1.VALVE_STATE','now','stringify','some','number','isGracePeriodActive','Unknown','LTM.trainingData.thermodynamics','presence','griff','location','length','lampe','.LEVEL','2880GCXmHz','\x20from\x20','sensorLastValues','toString','schloss','events.history','.4.VALVE_STATE','config','window','ANALYZE_SEQUENCE','light','openweathermap','395456SpuyHy','push','8159816ypNzUk','bewegung','dimmer','value','Valve','weatherunderground','schalter','lastTrackerEventTime','.forecast.current.temp','präsenz','temperature','getForeignStateAsync','pop','occupancy','currentSystemMode','isProVersion','1484536SptZUH','from','toLowerCase','5690pODagr','.1.ACTUAL_TEMPERATURE','log','map','error','tür','accuweather','shift','3811875VtOMhG','.1.LEVEL','switch','.1.TEMPERATURE','outdoorSensorId','(((.+)+)+)+$','isExit','eventHistory','parse','includes','[RECORDER]\x20Ignored\x20implausible\x20temperature:\x20'];a5_0x13a3=function(){return _0x284727;};return a5_0x13a3();}async function saveCompletedSequence(_0x23fce3){const _0x6d276a=a5_0x3f32;try{const _0x18737b=await _0x23fce3['getStateAsync'](_0x6d276a(0x180));let _0x53636e=[];if(_0x18737b&&_0x18737b[_0x6d276a(0x174)])try{_0x53636e=JSON[_0x6d276a(0x171)](_0x18737b[_0x6d276a(0x174)]);}catch(_0x2afc99){}const _0x43a04a=activeSequence[0x0]['ts'],_0x2a3af4=activeSequence[_0x6d276a(0x164)](_0x3ac839=>({'loc':_0x3ac839[_0x6d276a(0x189)],'t_delta':Math['round']((_0x3ac839['ts']-_0x43a04a)/0x3e8)})),_0x1e1b3d={'timestamp':new Date(_0x43a04a)[_0x6d276a(0x12e)](),'steps':_0x2a3af4,'duration':Math[_0x6d276a(0x127)]((activeSequence[activeSequence[_0x6d276a(0x13d)]-0x1]['ts']-_0x43a04a)/0x3e8),'daytime':new Date(_0x43a04a)[_0x6d276a(0x17f)]()};_0x53636e[_0x6d276a(0x14d)](_0x1e1b3d);if(_0x53636e['length']>MAX_TRAINING_SET_SIZE)_0x53636e[_0x6d276a(0x168)]();await _0x23fce3[_0x6d276a(0x184)](_0x6d276a(0x180),{'val':JSON[_0x6d276a(0x134)](_0x53636e),'ack':!![]}),_0x23fce3['isProVersion']&&_0x23fce3[_0x6d276a(0x126)]&&_0x23fce3['sendToPythonWrapper'](_0x6d276a(0x149),{'sequence':_0x1e1b3d});}catch(_0x1e9aa9){_0x23fce3['log'][_0x6d276a(0x165)]('[RECORDER]\x20Error:\x20'+_0x1e9aa9[_0x6d276a(0x177)]);}}async function recordSequence(_0xc3b8cd,_0x52b1f6){const _0x3e47dd=a5_0x3f32,_0x59deae=(_0x52b1f6[_0x3e47dd(0x125)]||'')[_0x3e47dd(0x160)](),_0x2c7871=[_0x3e47dd(0x129),_0x3e47dd(0x14f),_0x3e47dd(0x157),_0x3e47dd(0x13a),'occupancy','door',_0x3e47dd(0x166),_0x3e47dd(0x148),'fenster','contact','kontakt',_0x3e47dd(0x14a),_0x3e47dd(0x178),_0x3e47dd(0x16b),_0x3e47dd(0x154),'dimmer',_0x3e47dd(0x13e)];if(!_0x2c7871[_0x3e47dd(0x135)](_0x4efb1a=>_0x59deae['includes'](_0x4efb1a)))return;if(!_0x52b1f6[_0x3e47dd(0x151)])return;if(sequenceTimer)clearTimeout(sequenceTimer);activeSequence[_0x3e47dd(0x14d)]({'loc':_0x52b1f6['location']||_0x3e47dd(0x138),'id':_0x52b1f6['id'],'ts':Date[_0x3e47dd(0x133)]()}),sequenceTimer=setTimeout(async()=>{const _0x41c96e=_0x3e47dd;if(activeSequence[_0x41c96e(0x13d)]>0x1)await saveCompletedSequence(_0xc3b8cd);activeSequence=[];},SEQUENCE_TIMEOUT_MS);}function startExitTimer(_0xcf74a5){const _0x4ee78e=a5_0x3f32;abortExitTimer(_0xcf74a5),_0xcf74a5[_0x4ee78e(0x137)]=!![],_0xcf74a5[_0x4ee78e(0x17d)]=setTimeout(()=>{const _0x1f0d04=_0x4ee78e;_0xcf74a5[_0x1f0d04(0x137)]=![];},EXIT_GRACE_PERIOD_SECONDS*0x3e8),_0xcf74a5[_0x4ee78e(0x12b)]=setTimeout(()=>{const _0x3c2b85=_0x4ee78e;setPresence(_0xcf74a5,![]),_0xcf74a5[_0x3c2b85(0x12b)]=null;},EXIT_TIMER_MINUTES*0x3c*0x3e8);}function abortExitTimer(_0x5434b3){const _0x22f061=a5_0x3f32;if(_0x5434b3[_0x22f061(0x12b)])clearTimeout(_0x5434b3['exitTimer']);if(_0x5434b3[_0x22f061(0x17d)])clearTimeout(_0x5434b3[_0x22f061(0x17d)]);_0x5434b3[_0x22f061(0x12b)]=null,_0x5434b3['exitGraceTimer']=null,_0x5434b3['isGracePeriodActive']=![];}async function setPresence(_0x2b0a90,_0xaf5077){const _0x5ae138=a5_0x3f32;if(_0x2b0a90[_0x5ae138(0x12f)]===_0xaf5077)return;_0x2b0a90['isPresent']=_0xaf5077,await _0x2b0a90['setStateAsync'](_0x5ae138(0x124),{'val':_0xaf5077,'ack':!![]});}async function processSensorEvent(_0x52806e,_0x11e143,_0x58e1a7,_0x3e166d){const _0x409b90=a5_0x3f32;if(!_0x3e166d)return null;const _0x5c4585=_0x58e1a7['val'],_0x56f98b=Date['now'](),_0x570191=_0x52806e[_0x409b90(0x142)][_0x11e143],_0x91c80a=(_0x3e166d[_0x409b90(0x125)]||'')[_0x409b90(0x160)](),_0x3b261a=_0x91c80a['includes'](_0x409b90(0x158))||_0x91c80a[_0x409b90(0x172)]('temperatur')||_0x91c80a[_0x409b90(0x172)](_0x409b90(0x17e))||_0x91c80a[_0x409b90(0x172)]('heizung')||_0x91c80a[_0x409b90(0x172)]('thermostat');if(_0x3b261a&&typeof _0x5c4585===_0x409b90(0x136)){if(_0x5c4585>0x50||_0x5c4585<-0x32)return _0x52806e[_0x409b90(0x163)][_0x409b90(0x12c)](_0x409b90(0x173)+_0x5c4585+_0x409b90(0x141)+_0x11e143),null;}_0x52806e['sensorLastValues'][_0x11e143]=_0x5c4585;if(!_0x3e166d['logDuplicates']&&_0x570191!=undefined&&_0x570191==_0x5c4585)return null;_0x52806e['isProVersion']&&_0x3b261a&&recordThermodynamics(_0x52806e,_0x11e143,_0x5c4585,_0x3e166d[_0x409b90(0x13c)]);const _0x4c4ba3={'timestamp':_0x56f98b,'id':_0x11e143,'name':_0x3e166d[_0x409b90(0x128)],'type':_0x3e166d['type'],'location':_0x3e166d[_0x409b90(0x13c)],'value':_0x5c4585};_0x52806e[_0x409b90(0x170)]['unshift'](_0x4c4ba3);if(_0x52806e[_0x409b90(0x170)][_0x409b90(0x13d)]>HISTORY_MAX_SIZE)_0x52806e[_0x409b90(0x170)][_0x409b90(0x15a)]();await _0x52806e[_0x409b90(0x184)]('events.lastEvent',{'val':JSON[_0x409b90(0x134)](_0x4c4ba3),'ack':!![]}),await _0x52806e['setStateAsync'](_0x409b90(0x145),{'val':JSON['stringify'](_0x52806e['eventHistory']),'ack':!![]});if(_0x52806e['isProVersion']){_0x52806e['rawEventLog'][_0x409b90(0x14d)](_0x4c4ba3);if(_0x52806e[_0x409b90(0x185)]['length']>RAW_LOG_MAX_SIZE)_0x52806e[_0x409b90(0x185)][_0x409b90(0x176)](0x0,_0x52806e[_0x409b90(0x185)][_0x409b90(0x13d)]-RAW_LOG_MAX_SIZE);await _0x52806e['setStateAsync'](_0x409b90(0x12d),{'val':JSON[_0x409b90(0x134)](_0x52806e[_0x409b90(0x185)]),'ack':!![]}),recordSequence(_0x52806e,_0x4c4ba3);}if(_0x3e166d[_0x409b90(0x16f)]&&_0x5c4585===!![]){if(_0x52806e[_0x409b90(0x12f)]&&!_0x52806e[_0x409b90(0x137)])startExitTimer(_0x52806e);else{if(!_0x52806e[_0x409b90(0x12f)])setPresence(_0x52806e,!![]);}}else{if(_0x3e166d[_0x409b90(0x125)]===_0x409b90(0x129)&&_0x5c4585===!![]){if(_0x52806e[_0x409b90(0x12b)])abortExitTimer(_0x52806e);if(!_0x52806e['isPresent']&&_0x52806e[_0x409b90(0x15c)]===_0x409b90(0x17c))setPresence(_0x52806e,!![]);}}if(_0x52806e[_0x409b90(0x15d)]&&_0x52806e[_0x409b90(0x126)]){_0x3e166d[_0x409b90(0x125)]===_0x409b90(0x129)&&_0x5c4585===!![]&&_0x3e166d[_0x409b90(0x13c)]&&_0x52806e[_0x409b90(0x126)](_0x409b90(0x186),{'room':_0x3e166d[_0x409b90(0x13c)]});const _0x1a6219=[_0x409b90(0x188),_0x409b90(0x166),_0x409b90(0x148),'fenster',_0x409b90(0x13b),'handle',_0x409b90(0x182),_0x409b90(0x144)][_0x409b90(0x135)](_0x10b689=>_0x91c80a['includes'](_0x10b689)),_0x3e0e0d=[_0x409b90(0x14a),_0x409b90(0x178),_0x409b90(0x16b),_0x409b90(0x154),_0x409b90(0x150),_0x409b90(0x13e)]['some'](_0x491c66=>_0x91c80a[_0x409b90(0x172)](_0x491c66)),_0xfc5f28=[_0x409b90(0x129),_0x409b90(0x14f),_0x409b90(0x157),_0x409b90(0x13a),_0x409b90(0x15b)][_0x409b90(0x135)](_0x36ef60=>_0x91c80a[_0x409b90(0x172)](_0x36ef60));if(_0x3e166d[_0x409b90(0x13c)]&&(_0x1a6219||_0x3e0e0d||_0xfc5f28)){const _0x2d591e=_0x5c4585===!![]||typeof _0x5c4585==='number'&&_0x5c4585>0x0,_0x594583=_0x1a6219&&!_0x2d591e&&_0x570191!==undefined&&_0x570191!=_0x5c4585;if(_0x2d591e||_0x594583){const _0x28bb14=_0x52806e[_0x409b90(0x155)]||_0x56f98b,_0x2badc3=(_0x56f98b-_0x28bb14)/0x3e8;_0x52806e[_0x409b90(0x155)]=_0x56f98b,_0x52806e[_0x409b90(0x126)]('TRACK_EVENT',{'room':_0x3e166d[_0x409b90(0x13c)],'dt':_0x2badc3});}}}return _0x4c4ba3;}module[a5_0x1fa6b9(0x183)]={'processSensorEvent':processSensorEvent,'getOutsideTemperatureNumeric':getOutsideTemperatureNumeric,'setPresence':setPresence,'abortExitTimer':abortExitTimer,'startExitTimer':startExitTimer};