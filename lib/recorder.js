(function(_0x101dd9,_0x4ff6a3){const _0x19e89e=a5_0x2cdc,_0x19e62e=_0x101dd9();while(!![]){try{const _0x2b9012=-parseInt(_0x19e89e(0x21c))/0x1*(-parseInt(_0x19e89e(0x1ee))/0x2)+-parseInt(_0x19e89e(0x1f9))/0x3+parseInt(_0x19e89e(0x211))/0x4+parseInt(_0x19e89e(0x1c8))/0x5+-parseInt(_0x19e89e(0x1d1))/0x6+-parseInt(_0x19e89e(0x1cc))/0x7*(-parseInt(_0x19e89e(0x1bf))/0x8)+-parseInt(_0x19e89e(0x1f6))/0x9;if(_0x2b9012===_0x4ff6a3)break;else _0x19e62e['push'](_0x19e62e['shift']());}catch(_0x29827d){_0x19e62e['push'](_0x19e62e['shift']());}}}(a5_0xcc7c,0xe78ce));const a5_0x4a5035=(function(){let _0x4eb49f=!![];return function(_0x2e425f,_0x258c9f){const _0x4eee7d=_0x4eb49f?function(){const _0x53330f=a5_0x2cdc;if(_0x258c9f){const _0x22b18c=_0x258c9f[_0x53330f(0x201)](_0x2e425f,arguments);return _0x258c9f=null,_0x22b18c;}}:function(){};return _0x4eb49f=![],_0x4eee7d;};}()),a5_0xf5fc08=a5_0x4a5035(this,function(){const _0x501a70=a5_0x2cdc;return a5_0xf5fc08[_0x501a70(0x1be)]()[_0x501a70(0x1d3)]('(((.+)+)+)+$')['toString']()[_0x501a70(0x204)](a5_0xf5fc08)[_0x501a70(0x1d3)](_0x501a70(0x1d2));});a5_0xf5fc08();'use strict';const HISTORY_MAX_SIZE=0x32,RAW_LOG_MAX_SIZE=0x9c4,THERMO_LOG_SIZE=0x3e8,SEQUENCE_TIMEOUT_MS=0x5*0x3c*0x3e8,MAX_TRAINING_SET_SIZE=0x1f4,EXIT_TIMER_MINUTES=0xf,EXIT_GRACE_PERIOD_SECONDS=0x1e;let activeSequence=[],sequenceTimer=null;async function getOutsideTemperatureNumeric(_0x5665bf){const _0x4e82f8=a5_0x2cdc;if(_0x5665bf[_0x4e82f8(0x1ca)][_0x4e82f8(0x1f0)])try{const _0x300d43=await _0x5665bf['getForeignStateAsync'](_0x5665bf[_0x4e82f8(0x1ca)][_0x4e82f8(0x1f0)]);if(_0x300d43&&_0x300d43['val']!==undefined&&_0x300d43[_0x4e82f8(0x1e5)]!==null)return parseFloat(_0x300d43[_0x4e82f8(0x1e5)]);}catch(_0x500bec){}const _0x2f1546=_0x5665bf[_0x4e82f8(0x1ca)]['weatherInstance'];if(!_0x5665bf['config']['useWeather']||!_0x2f1546)return null;try{let _0x408a74='';if(_0x2f1546[_0x4e82f8(0x1e0)](_0x4e82f8(0x1cd)))_0x408a74=_0x2f1546+_0x4e82f8(0x1d4);else{if(_0x2f1546[_0x4e82f8(0x1e0)](_0x4e82f8(0x1c1)))_0x408a74=_0x2f1546+_0x4e82f8(0x20c);else{if(_0x2f1546['includes']('openweathermap'))_0x408a74=_0x2f1546+'.forecast.current.temperature';else{if(_0x2f1546[_0x4e82f8(0x1e0)](_0x4e82f8(0x1d0)))_0x408a74=_0x2f1546+_0x4e82f8(0x1fb);}}}if(_0x408a74){const _0x448fe7=await _0x5665bf[_0x4e82f8(0x21b)](_0x408a74);if(_0x448fe7&&_0x448fe7['val']!==undefined&&_0x448fe7[_0x4e82f8(0x1e5)]!==null)return parseFloat(_0x448fe7[_0x4e82f8(0x1e5)]);}}catch(_0x46ffe2){}return null;}async function recordThermodynamics(_0xabdc9f,_0x4f7821,_0x1696a3,_0x2411d7){const _0x522b3e=a5_0x2cdc,_0x57c635=await getOutsideTemperatureNumeric(_0xabdc9f);if(_0x57c635===null)return;let _0x3aadb4=0x0,_0x3aaf9b=![];if(_0xabdc9f[_0x522b3e(0x1ca)][_0x522b3e(0x1ef)])try{let _0x3c57e0=_0xabdc9f[_0x522b3e(0x1ca)][_0x522b3e(0x1ef)];if(typeof _0x3c57e0===_0x522b3e(0x1ff))_0x3c57e0=JSON[_0x522b3e(0x1e3)](_0x3c57e0);if(_0x3c57e0[_0x4f7821]){const _0x5c7f1b=_0x3c57e0[_0x4f7821],_0x10a6d0=await _0xabdc9f[_0x522b3e(0x21b)](_0x5c7f1b);if(_0x10a6d0&&_0x10a6d0['val']!==null&&_0x10a6d0[_0x522b3e(0x1e5)]!==undefined){let _0x50afb2=Number(_0x10a6d0['val']);if(_0x50afb2<=1.05&&!_0x5c7f1b['includes']('STATUS')&&!_0x5c7f1b[_0x522b3e(0x1e0)](_0x522b3e(0x1fe)))_0x50afb2=_0x50afb2*0x64;_0x3aadb4=Math[_0x522b3e(0x219)](_0x50afb2),_0x3aaf9b=!![];}}}catch(_0x37edf9){}if(!_0x3aaf9b){const _0x4ecb51=[{'from':_0x522b3e(0x1dd),'to':'.1.LEVEL'},{'from':'.1.ACTUAL_TEMPERATURE','to':_0x522b3e(0x1c4)},{'from':_0x522b3e(0x220),'to':'.4.VALVE_STATE'},{'from':'.ACTUAL_TEMPERATURE','to':'.LEVEL'},{'from':_0x522b3e(0x1d6),'to':_0x522b3e(0x1c5)},{'from':_0x522b3e(0x205),'to':_0x522b3e(0x1d5)}];for(const _0xf903fa of _0x4ecb51){if(_0x4f7821['includes'](_0xf903fa['from'])){const _0x596aec=_0x4f7821['replace'](_0xf903fa[_0x522b3e(0x21e)],_0xf903fa['to']);try{const _0x1d1126=await _0xabdc9f[_0x522b3e(0x21b)](_0x596aec);if(_0x1d1126&&_0x1d1126['val']!==null&&_0x1d1126[_0x522b3e(0x1e5)]!==undefined){let _0x344b40=Number(_0x1d1126['val']);if(typeof _0x344b40===_0x522b3e(0x216)){if(_0x344b40<=1.05&&_0xf903fa['to'][_0x522b3e(0x1e0)](_0x522b3e(0x21d)))_0x344b40=_0x344b40*0x64;_0x3aadb4=Math[_0x522b3e(0x219)](_0x344b40),_0x3aaf9b=!![];break;}}}catch(_0x5a3efd){}}}}const _0x14c3b2=await _0xabdc9f[_0x522b3e(0x1c9)](_0x522b3e(0x1dc));let _0xeb0d9d=[];if(_0x14c3b2&&_0x14c3b2[_0x522b3e(0x1e5)])try{_0xeb0d9d=JSON[_0x522b3e(0x1e3)](_0x14c3b2[_0x522b3e(0x1e5)]);}catch(_0x4c1984){}_0xeb0d9d[_0x522b3e(0x20e)]({'ts':Date[_0x522b3e(0x1ec)](),'room':_0x2411d7||_0x522b3e(0x1e2),'t_in':_0x1696a3,'t_out':_0x57c635,'valve':_0x3aadb4});if(_0xeb0d9d[_0x522b3e(0x20b)]>THERMO_LOG_SIZE)_0xeb0d9d[_0x522b3e(0x1e1)]();await _0xabdc9f[_0x522b3e(0x1cb)]('LTM.trainingData.thermodynamics',{'val':JSON['stringify'](_0xeb0d9d),'ack':!![]});}async function saveCompletedSequence(_0x105061){const _0x36c649=a5_0x2cdc;try{const _0x5af724=await _0x105061['getStateAsync'](_0x36c649(0x1e8));let _0x31cf70=[];if(_0x5af724&&_0x5af724[_0x36c649(0x1e5)])try{_0x31cf70=JSON[_0x36c649(0x1e3)](_0x5af724[_0x36c649(0x1e5)]);}catch(_0x31cc10){}const _0x1a3f1a=activeSequence[0x0]['ts'],_0x54199d=activeSequence['map'](_0x213467=>({'loc':_0x213467[_0x36c649(0x1f1)],'t_delta':Math[_0x36c649(0x219)]((_0x213467['ts']-_0x1a3f1a)/0x3e8)})),_0x110378={'timestamp':new Date(_0x1a3f1a)['toISOString'](),'steps':_0x54199d,'duration':Math['round']((activeSequence[activeSequence[_0x36c649(0x20b)]-0x1]['ts']-_0x1a3f1a)/0x3e8),'daytime':new Date(_0x1a3f1a)['getHours']()};_0x31cf70[_0x36c649(0x20e)](_0x110378);if(_0x31cf70[_0x36c649(0x20b)]>MAX_TRAINING_SET_SIZE)_0x31cf70[_0x36c649(0x1e1)]();await _0x105061[_0x36c649(0x1cb)](_0x36c649(0x1e8),{'val':JSON[_0x36c649(0x1f7)](_0x31cf70),'ack':!![]}),_0x105061['isProVersion']&&_0x105061[_0x36c649(0x1d7)]&&_0x105061['sendToPythonWrapper'](_0x36c649(0x1e4),{'sequence':_0x110378});}catch(_0x34439a){_0x105061['log']['error'](_0x36c649(0x1c0)+_0x34439a['message']);}}async function recordSequence(_0x461001,_0x4166b1){const _0xa40c2b=a5_0x2cdc,_0x40dbd2=(_0x4166b1[_0xa40c2b(0x206)]||'')[_0xa40c2b(0x212)](),_0x22775a=['motion',_0xa40c2b(0x1eb),_0xa40c2b(0x1e9),_0xa40c2b(0x209),_0xa40c2b(0x210),'door',_0xa40c2b(0x215),'window',_0xa40c2b(0x213),_0xa40c2b(0x1f8),_0xa40c2b(0x1e6),'light',_0xa40c2b(0x20f),_0xa40c2b(0x1da),_0xa40c2b(0x21a),_0xa40c2b(0x1fa),_0xa40c2b(0x1f2)];if(!_0x22775a[_0xa40c2b(0x1fc)](_0x71717c=>_0x40dbd2[_0xa40c2b(0x1e0)](_0x71717c)))return;if(!_0x4166b1[_0xa40c2b(0x217)])return;if(sequenceTimer)clearTimeout(sequenceTimer);activeSequence['push']({'loc':_0x4166b1['location']||'Unknown','id':_0x4166b1['id'],'ts':Date[_0xa40c2b(0x1ec)]()}),sequenceTimer=setTimeout(async()=>{const _0x5dc77a=_0xa40c2b;if(activeSequence[_0x5dc77a(0x20b)]>0x1)await saveCompletedSequence(_0x461001);activeSequence=[];},SEQUENCE_TIMEOUT_MS);}function startExitTimer(_0x2c61e9){const _0x174c90=a5_0x2cdc;abortExitTimer(_0x2c61e9),_0x2c61e9[_0x174c90(0x214)]=!![],_0x2c61e9['exitGraceTimer']=setTimeout(()=>{const _0x5300ca=_0x174c90;_0x2c61e9[_0x5300ca(0x214)]=![];},EXIT_GRACE_PERIOD_SECONDS*0x3e8),_0x2c61e9['exitTimer']=setTimeout(()=>{const _0x25c79d=_0x174c90;setPresence(_0x2c61e9,![]),_0x2c61e9[_0x25c79d(0x1bc)]=null;},EXIT_TIMER_MINUTES*0x3c*0x3e8);}function a5_0x2cdc(_0x3eb004,_0x500a4e){const _0x1b7a75=a5_0xcc7c();return a5_0x2cdc=function(_0xf5fc08,_0x4a5035){_0xf5fc08=_0xf5fc08-0x1bc;let _0xcc7c20=_0x1b7a75[_0xf5fc08];return _0xcc7c20;},a5_0x2cdc(_0x3eb004,_0x500a4e);}function abortExitTimer(_0x386bc6){const _0x513187=a5_0x2cdc;if(_0x386bc6[_0x513187(0x1bc)])clearTimeout(_0x386bc6[_0x513187(0x1bc)]);if(_0x386bc6['exitGraceTimer'])clearTimeout(_0x386bc6[_0x513187(0x203)]);_0x386bc6[_0x513187(0x1bc)]=null,_0x386bc6[_0x513187(0x203)]=null,_0x386bc6[_0x513187(0x214)]=![];}async function setPresence(_0x544817,_0x1f8b38){const _0x33bd03=a5_0x2cdc;if(_0x544817['isPresent']===_0x1f8b38)return;_0x544817[_0x33bd03(0x1e7)]=_0x1f8b38,await _0x544817[_0x33bd03(0x1cb)](_0x33bd03(0x20d),{'val':_0x1f8b38,'ack':!![]});}async function processSensorEvent(_0x4daff7,_0x5b303c,_0x47cb89,_0x49b747){const _0x2adfed=a5_0x2cdc;if(!_0x49b747)return null;const _0x4d8083=_0x47cb89['val'],_0x2fa7f8=Date[_0x2adfed(0x1ec)](),_0x4f9b4f=_0x4daff7['sensorLastValues'][_0x5b303c],_0xc1e583=(_0x49b747[_0x2adfed(0x206)]||'')['toLowerCase'](),_0xe7981c=_0xc1e583[_0x2adfed(0x1e0)](_0x2adfed(0x1d6))||_0xc1e583[_0x2adfed(0x1e0)]('temperatur')||_0xc1e583[_0x2adfed(0x1e0)]('klima')||_0xc1e583[_0x2adfed(0x1e0)](_0x2adfed(0x1f5))||_0xc1e583['includes'](_0x2adfed(0x1c2));if(_0xe7981c&&typeof _0x4d8083===_0x2adfed(0x216)){if(_0x4d8083>0x50||_0x4d8083<-0x32)return _0x4daff7[_0x2adfed(0x208)][_0x2adfed(0x1db)](_0x2adfed(0x202)+_0x4d8083+_0x2adfed(0x1c7)+_0x5b303c),null;}_0x4daff7['sensorLastValues'][_0x5b303c]=_0x4d8083;if(!_0x49b747[_0x2adfed(0x1ea)]&&_0x4f9b4f!=undefined&&_0x4f9b4f==_0x4d8083)return null;_0x4daff7['isProVersion']&&_0xe7981c&&recordThermodynamics(_0x4daff7,_0x5b303c,_0x4d8083,_0x49b747[_0x2adfed(0x1d9)]);const _0x2b00f0={'timestamp':_0x2fa7f8,'id':_0x5b303c,'name':_0x49b747[_0x2adfed(0x207)],'type':_0x49b747[_0x2adfed(0x206)],'location':_0x49b747[_0x2adfed(0x1d9)],'value':_0x4d8083};_0x4daff7['eventHistory']['unshift'](_0x2b00f0);if(_0x4daff7[_0x2adfed(0x200)]['length']>HISTORY_MAX_SIZE)_0x4daff7[_0x2adfed(0x200)][_0x2adfed(0x218)]();await _0x4daff7[_0x2adfed(0x1cb)](_0x2adfed(0x1ed),{'val':JSON[_0x2adfed(0x1f7)](_0x2b00f0),'ack':!![]}),await _0x4daff7[_0x2adfed(0x1cb)]('events.history',{'val':JSON[_0x2adfed(0x1f7)](_0x4daff7['eventHistory']),'ack':!![]});if(_0x4daff7['isProVersion']){_0x4daff7['rawEventLog'][_0x2adfed(0x20e)](_0x2b00f0);if(_0x4daff7[_0x2adfed(0x1c3)][_0x2adfed(0x20b)]>RAW_LOG_MAX_SIZE)_0x4daff7[_0x2adfed(0x1c3)]['splice'](0x0,_0x4daff7['rawEventLog'][_0x2adfed(0x20b)]-RAW_LOG_MAX_SIZE);await _0x4daff7[_0x2adfed(0x1cb)](_0x2adfed(0x1df),{'val':JSON[_0x2adfed(0x1f7)](_0x4daff7[_0x2adfed(0x1c3)]),'ack':!![]}),recordSequence(_0x4daff7,_0x2b00f0);}if(_0x49b747[_0x2adfed(0x1fd)]&&_0x4d8083===!![]){if(_0x4daff7[_0x2adfed(0x1e7)]&&!_0x4daff7['isGracePeriodActive'])startExitTimer(_0x4daff7);else{if(!_0x4daff7[_0x2adfed(0x1e7)])setPresence(_0x4daff7,!![]);}}else{if(_0x49b747['type']===_0x2adfed(0x1ce)&&_0x4d8083===!![]){if(_0x4daff7[_0x2adfed(0x1bc)])abortExitTimer(_0x4daff7);if(!_0x4daff7[_0x2adfed(0x1e7)]&&_0x4daff7['currentSystemMode']===_0x2adfed(0x1cf))setPresence(_0x4daff7,!![]);}}if(_0x4daff7[_0x2adfed(0x21f)]&&_0x4daff7[_0x2adfed(0x1d7)]){_0x49b747[_0x2adfed(0x206)]==='motion'&&_0x4d8083===!![]&&_0x49b747['location']&&_0x4daff7[_0x2adfed(0x1d7)]('SIMULATE_SIGNAL',{'room':_0x49b747['location']});const _0xc08a66=[_0x2adfed(0x1c6),_0x2adfed(0x215),_0x2adfed(0x20a),_0x2adfed(0x213),'griff',_0x2adfed(0x1f3),_0x2adfed(0x1d8),'schloss'][_0x2adfed(0x1fc)](_0x52eb82=>_0xc1e583[_0x2adfed(0x1e0)](_0x52eb82)),_0x111030=[_0x2adfed(0x1f4),_0x2adfed(0x20f),_0x2adfed(0x1da),_0x2adfed(0x21a),'dimmer',_0x2adfed(0x1f2)]['some'](_0x4a648d=>_0xc1e583[_0x2adfed(0x1e0)](_0x4a648d)),_0x1e7677=[_0x2adfed(0x1ce),_0x2adfed(0x1eb),_0x2adfed(0x1e9),_0x2adfed(0x209),'occupancy'][_0x2adfed(0x1fc)](_0x3bcb90=>_0xc1e583[_0x2adfed(0x1e0)](_0x3bcb90));if(_0x49b747[_0x2adfed(0x1d9)]&&(_0xc08a66||_0x111030||_0x1e7677)){const _0x4d4292=_0x4d8083===!![]||typeof _0x4d8083===_0x2adfed(0x216)&&_0x4d8083>0x0,_0x1484ed=_0xc08a66&&!_0x4d4292&&_0x4f9b4f!==undefined&&_0x4f9b4f!=_0x4d8083;if(_0x4d4292||_0x1484ed){const _0x2a73aa=_0x4daff7[_0x2adfed(0x1de)]||_0x2fa7f8,_0x1cb9a2=(_0x2fa7f8-_0x2a73aa)/0x3e8;_0x4daff7[_0x2adfed(0x1de)]=_0x2fa7f8,_0x4daff7[_0x2adfed(0x1d7)](_0x2adfed(0x1bd),{'room':_0x49b747['location'],'dt':_0x1cb9a2});}}}return _0x2b00f0;}module['exports']={'processSensorEvent':processSensorEvent,'getOutsideTemperatureNumeric':getOutsideTemperatureNumeric,'setPresence':setPresence,'abortExitTimer':abortExitTimer,'startExitTimer':startExitTimer};function a5_0xcc7c(){const _0x366580=['sendToPythonWrapper','lock','location','switch','debug','LTM.trainingData.thermodynamics','.1.ACTUAL_TEMPERATURE','lastTrackerEventTime','LTM.rawEventLog','includes','shift','Unknown','parse','ANALYZE_SEQUENCE','val','kontakt','isPresent','LTM.trainingData.sequences','präsenz','logDuplicates','bewegung','now','events.lastEvent','162vHyVfL','valveMapping','outdoorSensorId','loc','lampe','handle','light','heizung','13695147cNpKnz','stringify','contact','4705224neiLLB','dimmer','.forecast.current.temp','some','isExit','STATE','string','eventHistory','apply','[RECORDER]\x20Ignored\x20implausible\x20temperature:\x20','exitGraceTimer','constructor','Temperature','type','name','log','presence','window','length','.NextHours.Location_1.Day_1.current.temp_value','system.isPresent','push','licht','occupancy','4285748kVyubr','toLowerCase','fenster','isGracePeriodActive','tür','number','value','pop','round','schalter','getForeignStateAsync','14184wxjKuT','LEVEL','from','isProVersion','.1.TEMPERATURE','exitTimer','TRACK_EVENT','toString','841728GXXXfn','[RECORDER]\x20Error:\x20','daswetter','thermostat','rawEventLog','.1.VALVE_STATE','level','door','\x20from\x20','4281345TKpple','getStateAsync','config','setStateAsync','77ojqGyu','accuweather','motion','normal','weatherunderground','1172790HhDaxU','(((.+)+)+)+$','search','.Current.Temperature','Valve','temperature'];a5_0xcc7c=function(){return _0x366580;};return a5_0xcc7c();}