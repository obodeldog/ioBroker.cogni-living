(function(_0x574e82,_0x3bce0b){const _0x3781b8=a5_0xb7a1,_0x151aaf=_0x574e82();while(!![]){try{const _0x4444cd=-parseInt(_0x3781b8(0x1de))/0x1*(parseInt(_0x3781b8(0x1a4))/0x2)+-parseInt(_0x3781b8(0x1d8))/0x3*(parseInt(_0x3781b8(0x1c1))/0x4)+parseInt(_0x3781b8(0x1d7))/0x5+-parseInt(_0x3781b8(0x1db))/0x6+-parseInt(_0x3781b8(0x197))/0x7+-parseInt(_0x3781b8(0x19a))/0x8*(parseInt(_0x3781b8(0x1da))/0x9)+parseInt(_0x3781b8(0x1a1))/0xa;if(_0x4444cd===_0x3bce0b)break;else _0x151aaf['push'](_0x151aaf['shift']());}catch(_0x16289a){_0x151aaf['push'](_0x151aaf['shift']());}}}(a5_0x2e80,0x1c1ed));const a5_0x7d18c5=(function(){let _0x38e5ea=!![];return function(_0xfe6d4a,_0x3ee118){const _0x1af913=_0x38e5ea?function(){const _0x273fef=a5_0xb7a1;if(_0x3ee118){const _0x5ce16e=_0x3ee118[_0x273fef(0x1c7)](_0xfe6d4a,arguments);return _0x3ee118=null,_0x5ce16e;}}:function(){};return _0x38e5ea=![],_0x1af913;};}()),a5_0x31c3e8=a5_0x7d18c5(this,function(){const _0x2747ae=a5_0xb7a1;return a5_0x31c3e8[_0x2747ae(0x1b0)]()[_0x2747ae(0x1a6)](_0x2747ae(0x1dc))[_0x2747ae(0x1b0)]()['constructor'](a5_0x31c3e8)[_0x2747ae(0x1a6)](_0x2747ae(0x1dc));});a5_0x31c3e8();'use strict';function a5_0xb7a1(_0x1ff53b,_0x25390c){const _0x404e43=a5_0x2e80();return a5_0xb7a1=function(_0x31c3e8,_0x7d18c5){_0x31c3e8=_0x31c3e8-0x193;let _0x2e809d=_0x404e43[_0x31c3e8];return _0x2e809d;},a5_0xb7a1(_0x1ff53b,_0x25390c);}const HISTORY_MAX_SIZE=0x32,RAW_LOG_MAX_SIZE=0x9c4,THERMO_LOG_SIZE=0x3e8,SEQUENCE_TIMEOUT_MS=0x5*0x3c*0x3e8,MAX_TRAINING_SET_SIZE=0x1f4,EXIT_TIMER_MINUTES=0xf,EXIT_GRACE_PERIOD_SECONDS=0x1e;let activeSequence=[],sequenceTimer=null;async function getOutsideTemperatureNumeric(_0x46bc0a){const _0x51face=a5_0xb7a1;if(_0x46bc0a[_0x51face(0x1bb)]['outdoorSensorId'])try{const _0x2325ef=await _0x46bc0a[_0x51face(0x1a9)](_0x46bc0a['config']['outdoorSensorId']);if(_0x2325ef&&_0x2325ef[_0x51face(0x1b1)]!==undefined&&_0x2325ef[_0x51face(0x1b1)]!==null)return parseFloat(_0x2325ef[_0x51face(0x1b1)]);}catch(_0x51e9dc){}const _0x1f03d0=_0x46bc0a[_0x51face(0x1bb)][_0x51face(0x1e0)];if(!_0x46bc0a[_0x51face(0x1bb)]['useWeather']||!_0x1f03d0)return null;try{let _0x4ea0d6='';if(_0x1f03d0[_0x51face(0x1b2)](_0x51face(0x1dd)))_0x4ea0d6=_0x1f03d0+_0x51face(0x1d9);else{if(_0x1f03d0[_0x51face(0x1b2)](_0x51face(0x1bd)))_0x4ea0d6=_0x1f03d0+_0x51face(0x1b4);else{if(_0x1f03d0[_0x51face(0x1b2)](_0x51face(0x1b6)))_0x4ea0d6=_0x1f03d0+_0x51face(0x1b3);else{if(_0x1f03d0[_0x51face(0x1b2)]('weatherunderground'))_0x4ea0d6=_0x1f03d0+'.forecast.current.temp';}}}if(_0x4ea0d6){const _0x18e7ea=await _0x46bc0a[_0x51face(0x1a9)](_0x4ea0d6);if(_0x18e7ea&&_0x18e7ea[_0x51face(0x1b1)]!==undefined&&_0x18e7ea[_0x51face(0x1b1)]!==null)return parseFloat(_0x18e7ea[_0x51face(0x1b1)]);}}catch(_0x4cd529){}return null;}async function recordThermodynamics(_0x1cc668,_0xf7b5dd,_0x1769e4,_0xd46236){const _0x551898=a5_0xb7a1,_0x4a298f=await getOutsideTemperatureNumeric(_0x1cc668),_0x17d641=await _0x1cc668['getStateAsync'](_0x551898(0x1bc));let _0x5e0307=[];if(_0x17d641&&_0x17d641['val'])try{_0x5e0307=JSON['parse'](_0x17d641[_0x551898(0x1b1)]);}catch(_0x31009a){}_0x5e0307[_0x551898(0x1c0)]({'ts':Date[_0x551898(0x1c8)](),'room':_0xd46236||_0x551898(0x1d2),'t_in':_0x1769e4,'t_out':_0x4a298f});if(_0x5e0307[_0x551898(0x1ba)]>THERMO_LOG_SIZE)_0x5e0307[_0x551898(0x1d1)]();await _0x1cc668[_0x551898(0x1cd)]('LTM.trainingData.thermodynamics',{'val':JSON[_0x551898(0x1a8)](_0x5e0307),'ack':!![]});}function a5_0x2e80(){const _0x5affc2=['bewegung','klima','sensorLastValues','kontakt','type','apply','now','events.history','lampe','exitTimer','value','setStateAsync','isProVersion','contact','LTM.rawEventLog','shift','Unknown','toLowerCase','currentSystemMode','heizung','round','446310uiYfDj','313932BjYFnv','.Current.Temperature','10269cVfJRP','49572LDwfQs','(((.+)+)+)+$','accuweather','1137anZPYI','error','weatherInstance','unshift','map','getStateAsync','window','62167pvzBZs','ANALYZE_SEQUENCE','[RECORDER]\x20Error:\x20','888QJddph','LTM.trainingData.sequences','licht','isPresent','eventHistory','log','parse','4403990JDumWR','presence','SIMULATE_SIGNAL','108NiVmaf','isGracePeriodActive','search','exitGraceTimer','stringify','getForeignStateAsync','sendToPythonWrapper','door','occupancy','pop','light','switch','toString','val','includes','.forecast.current.temperature','.NextHours.Location_1.Day_1.current.temp_value','system.isPresent','openweathermap','getHours','motion','location','length','config','LTM.trainingData.thermodynamics','daswetter','rawEventLog','message','push','8lJLtxt'];a5_0x2e80=function(){return _0x5affc2;};return a5_0x2e80();}async function saveCompletedSequence(_0x5a0fe8){const _0x34bd25=a5_0xb7a1;try{const _0x36fbf7=await _0x5a0fe8[_0x34bd25(0x195)](_0x34bd25(0x19b));let _0x2ed9bb=[];if(_0x36fbf7&&_0x36fbf7[_0x34bd25(0x1b1)])try{_0x2ed9bb=JSON[_0x34bd25(0x1a0)](_0x36fbf7[_0x34bd25(0x1b1)]);}catch(_0x2319a5){}const _0x3e34bc=activeSequence[0x0]['ts'],_0x3de5ab=activeSequence[_0x34bd25(0x194)](_0x45f5df=>({'loc':_0x45f5df['loc'],'t_delta':Math[_0x34bd25(0x1d6)]((_0x45f5df['ts']-_0x3e34bc)/0x3e8)})),_0x3dd8be={'timestamp':new Date(_0x3e34bc)['toISOString'](),'steps':_0x3de5ab,'duration':Math[_0x34bd25(0x1d6)]((activeSequence[activeSequence['length']-0x1]['ts']-_0x3e34bc)/0x3e8),'daytime':new Date(_0x3e34bc)[_0x34bd25(0x1b7)]()};_0x2ed9bb[_0x34bd25(0x1c0)](_0x3dd8be);if(_0x2ed9bb['length']>MAX_TRAINING_SET_SIZE)_0x2ed9bb['shift']();await _0x5a0fe8['setStateAsync']('LTM.trainingData.sequences',{'val':JSON[_0x34bd25(0x1a8)](_0x2ed9bb),'ack':!![]}),_0x5a0fe8[_0x34bd25(0x1ce)]&&_0x5a0fe8[_0x34bd25(0x1aa)]&&_0x5a0fe8[_0x34bd25(0x1aa)](_0x34bd25(0x198),{'sequence':_0x3dd8be});}catch(_0x1bb2da){_0x5a0fe8[_0x34bd25(0x19f)][_0x34bd25(0x1df)](_0x34bd25(0x199)+_0x1bb2da[_0x34bd25(0x1bf)]);}}async function recordSequence(_0x48f9ff,_0x5b2cfb){const _0x569cce=a5_0xb7a1,_0x13dbb8=(_0x5b2cfb[_0x569cce(0x1c6)]||'')['toLowerCase'](),_0x3e23f0=['motion',_0x569cce(0x1c2),'präsenz',_0x569cce(0x1a2),_0x569cce(0x1ac),_0x569cce(0x1ab),'tür',_0x569cce(0x196),'fenster',_0x569cce(0x1cf),_0x569cce(0x1c5),_0x569cce(0x1ae),_0x569cce(0x19c),_0x569cce(0x1af),'schalter','dimmer',_0x569cce(0x1ca)];if(!_0x3e23f0['some'](_0x558a4e=>_0x13dbb8[_0x569cce(0x1b2)](_0x558a4e)))return;if(!_0x5b2cfb[_0x569cce(0x1cc)])return;if(sequenceTimer)clearTimeout(sequenceTimer);activeSequence[_0x569cce(0x1c0)]({'loc':_0x5b2cfb[_0x569cce(0x1b9)]||_0x569cce(0x1d2),'id':_0x5b2cfb['id'],'ts':Date['now']()}),sequenceTimer=setTimeout(async()=>{const _0x55c73b=_0x569cce;if(activeSequence[_0x55c73b(0x1ba)]>0x1)await saveCompletedSequence(_0x48f9ff);activeSequence=[];},SEQUENCE_TIMEOUT_MS);}function startExitTimer(_0xc9caf6){const _0x5c59cd=a5_0xb7a1;abortExitTimer(_0xc9caf6),_0xc9caf6[_0x5c59cd(0x1a5)]=!![],_0xc9caf6[_0x5c59cd(0x1a7)]=setTimeout(()=>{const _0x5c68a9=_0x5c59cd;_0xc9caf6[_0x5c68a9(0x1a5)]=![];},EXIT_GRACE_PERIOD_SECONDS*0x3e8),_0xc9caf6[_0x5c59cd(0x1cb)]=setTimeout(()=>{setPresence(_0xc9caf6,![]),_0xc9caf6['exitTimer']=null;},EXIT_TIMER_MINUTES*0x3c*0x3e8);}function abortExitTimer(_0x3a02b3){const _0xe8086c=a5_0xb7a1;if(_0x3a02b3[_0xe8086c(0x1cb)])clearTimeout(_0x3a02b3['exitTimer']);if(_0x3a02b3[_0xe8086c(0x1a7)])clearTimeout(_0x3a02b3[_0xe8086c(0x1a7)]);_0x3a02b3['exitTimer']=null,_0x3a02b3['exitGraceTimer']=null,_0x3a02b3[_0xe8086c(0x1a5)]=![];}async function setPresence(_0xcb13f9,_0x5bb6cf){const _0x2e4d9d=a5_0xb7a1;if(_0xcb13f9[_0x2e4d9d(0x19d)]===_0x5bb6cf)return;_0xcb13f9[_0x2e4d9d(0x19d)]=_0x5bb6cf,await _0xcb13f9[_0x2e4d9d(0x1cd)](_0x2e4d9d(0x1b5),{'val':_0x5bb6cf,'ack':!![]});}async function processSensorEvent(_0x120f21,_0x3b4834,_0x153663,_0x5b6521){const _0x344e16=a5_0xb7a1;if(!_0x5b6521)return null;const _0x4d4fed=_0x153663['val'],_0x3d2b3b=Date[_0x344e16(0x1c8)](),_0x11174a=_0x120f21[_0x344e16(0x1c4)][_0x3b4834];_0x120f21['sensorLastValues'][_0x3b4834]=_0x4d4fed;if(!_0x5b6521['logDuplicates']&&_0x11174a!=undefined&&_0x11174a==_0x4d4fed)return null;const _0x58a501=(_0x5b6521[_0x344e16(0x1c6)]||'')[_0x344e16(0x1d3)](),_0x1bc74f=_0x58a501['includes']('temperature')||_0x58a501[_0x344e16(0x1b2)]('temperatur')||_0x58a501['includes'](_0x344e16(0x1c3))||_0x58a501['includes'](_0x344e16(0x1d5));_0x120f21['isProVersion']&&_0x1bc74f&&recordThermodynamics(_0x120f21,_0x3b4834,_0x4d4fed,_0x5b6521[_0x344e16(0x1b9)]);const _0x2e7bcb={'timestamp':_0x3d2b3b,'id':_0x3b4834,'name':_0x5b6521['name'],'type':_0x5b6521[_0x344e16(0x1c6)],'location':_0x5b6521['location'],'value':_0x4d4fed};_0x120f21[_0x344e16(0x19e)][_0x344e16(0x193)](_0x2e7bcb);if(_0x120f21[_0x344e16(0x19e)][_0x344e16(0x1ba)]>HISTORY_MAX_SIZE)_0x120f21[_0x344e16(0x19e)][_0x344e16(0x1ad)]();await _0x120f21[_0x344e16(0x1cd)]('events.lastEvent',{'val':JSON[_0x344e16(0x1a8)](_0x2e7bcb),'ack':!![]}),await _0x120f21['setStateAsync'](_0x344e16(0x1c9),{'val':JSON['stringify'](_0x120f21[_0x344e16(0x19e)]),'ack':!![]});if(_0x120f21[_0x344e16(0x1ce)]){_0x120f21[_0x344e16(0x1be)][_0x344e16(0x1c0)](_0x2e7bcb);if(_0x120f21[_0x344e16(0x1be)]['length']>RAW_LOG_MAX_SIZE)_0x120f21[_0x344e16(0x1be)]['splice'](0x0,_0x120f21[_0x344e16(0x1be)][_0x344e16(0x1ba)]-RAW_LOG_MAX_SIZE);await _0x120f21[_0x344e16(0x1cd)](_0x344e16(0x1d0),{'val':JSON[_0x344e16(0x1a8)](_0x120f21[_0x344e16(0x1be)]),'ack':!![]}),recordSequence(_0x120f21,_0x2e7bcb);}if(_0x5b6521['isExit']&&_0x4d4fed===!![]){if(_0x120f21['isPresent']&&!_0x120f21[_0x344e16(0x1a5)])startExitTimer(_0x120f21);else{if(!_0x120f21[_0x344e16(0x19d)])setPresence(_0x120f21,!![]);}}else{if(_0x5b6521['type']===_0x344e16(0x1b8)&&_0x4d4fed===!![]){if(_0x120f21[_0x344e16(0x1cb)])abortExitTimer(_0x120f21);if(!_0x120f21[_0x344e16(0x19d)]&&_0x120f21[_0x344e16(0x1d4)]==='normal')setPresence(_0x120f21,!![]);}}return _0x120f21['isProVersion']&&_0x5b6521[_0x344e16(0x1c6)]===_0x344e16(0x1b8)&&_0x4d4fed===!![]&&_0x5b6521[_0x344e16(0x1b9)]&&_0x120f21[_0x344e16(0x1aa)]&&_0x120f21[_0x344e16(0x1aa)](_0x344e16(0x1a3),{'room':_0x5b6521['location']}),_0x2e7bcb;}module['exports']={'processSensorEvent':processSensorEvent,'getOutsideTemperatureNumeric':getOutsideTemperatureNumeric,'setPresence':setPresence,'abortExitTimer':abortExitTimer,'startExitTimer':startExitTimer};