const a5_0x284c58=a5_0x9494;(function(_0x30ccb6,_0x3a523d){const _0x3392f2=a5_0x9494,_0x48b67d=_0x30ccb6();while(!![]){try{const _0x54ada0=-parseInt(_0x3392f2(0xe1))/0x1+-parseInt(_0x3392f2(0x125))/0x2*(parseInt(_0x3392f2(0x10c))/0x3)+parseInt(_0x3392f2(0x14b))/0x4+parseInt(_0x3392f2(0x112))/0x5+-parseInt(_0x3392f2(0xdf))/0x6+parseInt(_0x3392f2(0x109))/0x7*(parseInt(_0x3392f2(0x12b))/0x8)+-parseInt(_0x3392f2(0x141))/0x9*(-parseInt(_0x3392f2(0xfb))/0xa);if(_0x54ada0===_0x3a523d)break;else _0x48b67d['push'](_0x48b67d['shift']());}catch(_0x4b704e){_0x48b67d['push'](_0x48b67d['shift']());}}}(a5_0x1f73,0xa514b));const a5_0x527c1e=(function(){let _0x25a26a=!![];return function(_0x5c414a,_0xec2794){const _0xc1d966=_0x25a26a?function(){const _0x2376a2=a5_0x9494;if(_0xec2794){const _0x559211=_0xec2794[_0x2376a2(0xf6)](_0x5c414a,arguments);return _0xec2794=null,_0x559211;}}:function(){};return _0x25a26a=![],_0xc1d966;};}()),a5_0x3a1985=a5_0x527c1e(this,function(){const _0x12832c=a5_0x9494;return a5_0x3a1985[_0x12832c(0x12d)]()['search'](_0x12832c(0x123))[_0x12832c(0x12d)]()[_0x12832c(0x108)](a5_0x3a1985)[_0x12832c(0x133)](_0x12832c(0x123));});a5_0x3a1985();'use strict';const HISTORY_MAX_SIZE=0x32,RAW_LOG_MAX_SIZE=0x9c4,THERMO_LOG_SIZE=0x3e8,SEQUENCE_TIMEOUT_MS=0x5*0x3c*0x3e8,MAX_TRAINING_SET_SIZE=0x1f4,EXIT_TIMER_MINUTES=0xf,EXIT_GRACE_PERIOD_SECONDS=0x1e;let activeSequence=[],sequenceTimer=null;async function getOutsideTemperatureNumeric(_0x11d3f7){const _0x1f117c=a5_0x9494;if(_0x11d3f7[_0x1f117c(0x142)][_0x1f117c(0x113)])try{const _0x583351=await _0x11d3f7[_0x1f117c(0x147)](_0x11d3f7[_0x1f117c(0x142)][_0x1f117c(0x113)]);if(_0x583351&&_0x583351[_0x1f117c(0x12f)]!==undefined&&_0x583351[_0x1f117c(0x12f)]!==null)return parseFloat(_0x583351[_0x1f117c(0x12f)]);}catch(_0x261504){}const _0xce9dc3=_0x11d3f7[_0x1f117c(0x142)][_0x1f117c(0x100)];if(!_0x11d3f7[_0x1f117c(0x142)]['useWeather']||!_0xce9dc3)return null;try{let _0x3e7408='';if(_0xce9dc3[_0x1f117c(0x10a)]('accuweather'))_0x3e7408=_0xce9dc3+'.Current.Temperature';else{if(_0xce9dc3[_0x1f117c(0x10a)](_0x1f117c(0x13f)))_0x3e7408=_0xce9dc3+_0x1f117c(0x140);else{if(_0xce9dc3[_0x1f117c(0x10a)]('openweathermap'))_0x3e7408=_0xce9dc3+_0x1f117c(0xee);else{if(_0xce9dc3[_0x1f117c(0x10a)](_0x1f117c(0xe7)))_0x3e7408=_0xce9dc3+_0x1f117c(0x134);}}}if(_0x3e7408){const _0x5df66f=await _0x11d3f7['getForeignStateAsync'](_0x3e7408);if(_0x5df66f&&_0x5df66f['val']!==undefined&&_0x5df66f[_0x1f117c(0x12f)]!==null)return parseFloat(_0x5df66f['val']);}}catch(_0x23e1d7){}return null;}function a5_0x9494(_0x24f5a6,_0x47633e){const _0x52cdc1=a5_0x1f73();return a5_0x9494=function(_0x3a1985,_0x527c1e){_0x3a1985=_0x3a1985-0xde;let _0x1f73e0=_0x52cdc1[_0x3a1985];return _0x1f73e0;},a5_0x9494(_0x24f5a6,_0x47633e);}async function recordThermodynamics(_0x3f32a7,_0x6bd6e7,_0x98d0a6,_0x32c6ae){const _0x19afd=a5_0x9494,_0x1cf7cc=await getOutsideTemperatureNumeric(_0x3f32a7);if(_0x1cf7cc===null)return;let _0x3bd866=0x0,_0x3e6477=![];if(_0x3f32a7['config'][_0x19afd(0x13e)])try{let _0x44eee9=_0x3f32a7[_0x19afd(0x142)][_0x19afd(0x13e)];if(typeof _0x44eee9==='string')_0x44eee9=JSON[_0x19afd(0x149)](_0x44eee9);if(_0x44eee9[_0x6bd6e7]){const _0x5a7702=_0x44eee9[_0x6bd6e7],_0x991f6d=await _0x3f32a7['getForeignStateAsync'](_0x5a7702);if(_0x991f6d&&_0x991f6d[_0x19afd(0x12f)]!==null&&_0x991f6d[_0x19afd(0x12f)]!==undefined){let _0x56673c=Number(_0x991f6d[_0x19afd(0x12f)]);if(_0x56673c<=1.05&&!_0x5a7702['includes']('STATUS')&&!_0x5a7702[_0x19afd(0x10a)](_0x19afd(0x13c)))_0x56673c=_0x56673c*0x64;_0x3bd866=Math[_0x19afd(0x11b)](_0x56673c),_0x3e6477=!![];}}}catch(_0x46c465){}if(!_0x3e6477){const _0x27b3a6=[{'from':_0x19afd(0x11d),'to':_0x19afd(0x126)},{'from':_0x19afd(0x11d),'to':_0x19afd(0x122)},{'from':_0x19afd(0x130),'to':_0x19afd(0x101)},{'from':_0x19afd(0x103),'to':_0x19afd(0xeb)},{'from':_0x19afd(0xe9),'to':_0x19afd(0x10b)},{'from':'Temperature','to':_0x19afd(0x114)}];for(const _0x424dcf of _0x27b3a6){if(_0x6bd6e7['includes'](_0x424dcf[_0x19afd(0xfd)])){const _0x3f419c=_0x6bd6e7[_0x19afd(0x143)](_0x424dcf[_0x19afd(0xfd)],_0x424dcf['to']);try{const _0x1aa81b=await _0x3f32a7[_0x19afd(0x147)](_0x3f419c);if(_0x1aa81b&&_0x1aa81b[_0x19afd(0x12f)]!==null&&_0x1aa81b[_0x19afd(0x12f)]!==undefined){let _0x6a96d5=Number(_0x1aa81b['val']);if(typeof _0x6a96d5===_0x19afd(0xe3)){if(_0x6a96d5<=1.05&&_0x424dcf['to'][_0x19afd(0x10a)]('LEVEL'))_0x6a96d5=_0x6a96d5*0x64;_0x3bd866=Math[_0x19afd(0x11b)](_0x6a96d5),_0x3e6477=!![];break;}}}catch(_0x9f5c5a){}}}}const _0x6999f7=await _0x3f32a7[_0x19afd(0x10f)]('LTM.trainingData.thermodynamics');let _0x733971=[];if(_0x6999f7&&_0x6999f7['val'])try{_0x733971=JSON[_0x19afd(0x149)](_0x6999f7[_0x19afd(0x12f)]);}catch(_0x4cd3e6){}_0x733971[_0x19afd(0xe8)]({'ts':Date[_0x19afd(0x120)](),'room':_0x32c6ae||_0x19afd(0xf8),'t_in':_0x98d0a6,'t_out':_0x1cf7cc,'valve':_0x3bd866});if(_0x733971[_0x19afd(0x10e)]>THERMO_LOG_SIZE)_0x733971[_0x19afd(0x13d)]();await _0x3f32a7[_0x19afd(0x131)](_0x19afd(0x148),{'val':JSON[_0x19afd(0x127)](_0x733971),'ack':!![]});}async function saveCompletedSequence(_0x5c50ab){const _0x2aca57=a5_0x9494;try{const _0x36a3a0=await _0x5c50ab[_0x2aca57(0x10f)](_0x2aca57(0x129));let _0x443dd9=[];if(_0x36a3a0&&_0x36a3a0[_0x2aca57(0x12f)])try{_0x443dd9=JSON[_0x2aca57(0x149)](_0x36a3a0['val']);}catch(_0x382f1a){}const _0x2d5908=activeSequence[0x0]['ts'],_0x5533da=activeSequence['map'](_0x578b12=>({'loc':_0x578b12[_0x2aca57(0xff)],'t_delta':Math['round']((_0x578b12['ts']-_0x2d5908)/0x3e8)})),_0x41c855={'timestamp':new Date(_0x2d5908)[_0x2aca57(0xfc)](),'steps':_0x5533da,'duration':Math['round']((activeSequence[activeSequence[_0x2aca57(0x10e)]-0x1]['ts']-_0x2d5908)/0x3e8),'daytime':new Date(_0x2d5908)['getHours']()};_0x443dd9['push'](_0x41c855);if(_0x443dd9[_0x2aca57(0x10e)]>MAX_TRAINING_SET_SIZE)_0x443dd9[_0x2aca57(0x13d)]();await _0x5c50ab[_0x2aca57(0x131)](_0x2aca57(0x129),{'val':JSON['stringify'](_0x443dd9),'ack':!![]}),_0x5c50ab['isProVersion']&&_0x5c50ab[_0x2aca57(0x107)]&&_0x5c50ab[_0x2aca57(0x107)](_0x2aca57(0xf4),{'sequence':_0x41c855});}catch(_0x2731a2){_0x5c50ab['log'][_0x2aca57(0x117)](_0x2aca57(0x12e)+_0x2731a2['message']);}}function a5_0x1f73(){const _0x280bb1=['.forecast.current.temp','exitTimer','tür','analysis.health.todayVector','präsenz','schalter','TRACK_EVENT','type','STATE','shift','valveMapping','daswetter','.NextHours.Location_1.Day_1.current.temp_value','747UFUQfw','config','replace','splice','events.history','location','getForeignStateAsync','LTM.trainingData.thermodynamics','parse','door','3173240HuteEw','heizung','getHours','isGracePeriodActive','1043976CcmOOE','motion','1229431nubbJH','isProVersion','number','value','toLowerCase','switch','weatherunderground','push','temperature','system.isPresent','.LEVEL','logDuplicates','log','.forecast.current.temperature','fill','bewegung','schloss','lastTrackerEventTime','griff','ANALYZE_SEQUENCE','licht','apply','some','Unknown','[RECORDER]\x20Ignored\x20implausible\x20temperature:\x20','light','173210SvMZCK','toISOString','from','exports','loc','weatherInstance','.4.VALVE_STATE','getDate','.ACTUAL_TEMPERATURE','events.lastEvent','debug','handle','sendToPythonWrapper','constructor','42kHgUKm','includes','level','3730395tAHEte','isExit','length','getStateAsync','fenster','window','909040XVvCua','outdoorSensorId','Valve','lock','exitGraceTimer','error','name','kontakt','rawEventLog','round','sensorLastValues','.1.ACTUAL_TEMPERATURE','normal','isPresent','now','unshift','.1.VALVE_STATE','(((.+)+)+)+$','klima','2TMdkiw','.1.LEVEL','stringify','eventHistory','LTM.trainingData.sequences','dimmer','1213736xGxHih','temperatur','toString','[RECORDER]\x20Error:\x20','val','.1.TEMPERATURE','setStateAsync','LTM.rawEventLog','search'];a5_0x1f73=function(){return _0x280bb1;};return a5_0x1f73();}async function recordSequence(_0x5a1e8,_0x2e196c){const _0x3ae923=a5_0x9494,_0x4b1c24=(_0x2e196c['type']||'')[_0x3ae923(0xe5)](),_0x2685e6=[_0x3ae923(0xe0),_0x3ae923(0xf0),_0x3ae923(0x138),'presence','occupancy',_0x3ae923(0x14a),_0x3ae923(0x136),_0x3ae923(0x111),_0x3ae923(0x110),'contact',_0x3ae923(0x119),'light','licht',_0x3ae923(0xe6),_0x3ae923(0x139),_0x3ae923(0x12a),'lampe'];if(!_0x2685e6[_0x3ae923(0xf7)](_0x2c3d80=>_0x4b1c24['includes'](_0x2c3d80)))return;if(!_0x2e196c[_0x3ae923(0xe4)])return;if(sequenceTimer)clearTimeout(sequenceTimer);activeSequence[_0x3ae923(0xe8)]({'loc':_0x2e196c[_0x3ae923(0x146)]||_0x3ae923(0xf8),'id':_0x2e196c['id'],'ts':Date[_0x3ae923(0x120)]()}),sequenceTimer=setTimeout(async()=>{const _0x464581=_0x3ae923;if(activeSequence[_0x464581(0x10e)]>0x1)await saveCompletedSequence(_0x5a1e8);activeSequence=[];},SEQUENCE_TIMEOUT_MS);}function startExitTimer(_0x109458){const _0x20a66f=a5_0x9494;abortExitTimer(_0x109458),_0x109458[_0x20a66f(0xde)]=!![],_0x109458[_0x20a66f(0x116)]=setTimeout(()=>{const _0x39f18c=_0x20a66f;_0x109458[_0x39f18c(0xde)]=![];},EXIT_GRACE_PERIOD_SECONDS*0x3e8),_0x109458[_0x20a66f(0x135)]=setTimeout(()=>{setPresence(_0x109458,![]),_0x109458['exitTimer']=null;},EXIT_TIMER_MINUTES*0x3c*0x3e8);}function abortExitTimer(_0x587d21){const _0x7934fa=a5_0x9494;if(_0x587d21['exitTimer'])clearTimeout(_0x587d21['exitTimer']);if(_0x587d21[_0x7934fa(0x116)])clearTimeout(_0x587d21['exitGraceTimer']);_0x587d21[_0x7934fa(0x135)]=null,_0x587d21['exitGraceTimer']=null,_0x587d21[_0x7934fa(0xde)]=![];}async function setPresence(_0x30171f,_0x1333f9){const _0x2a4773=a5_0x9494;if(_0x30171f[_0x2a4773(0x11f)]===_0x1333f9)return;_0x30171f[_0x2a4773(0x11f)]=_0x1333f9,await _0x30171f[_0x2a4773(0x131)](_0x2a4773(0xea),{'val':_0x1333f9,'ack':!![]});}async function updateHourlyActivity(_0x8c5625){const _0x13cbbd=a5_0x9494;let _0x18bd2c=new Array(0x18)[_0x13cbbd(0xef)](0x0),_0x575ded=0x0;try{const _0x5ea74a=await _0x8c5625[_0x13cbbd(0x10f)](_0x13cbbd(0x137));_0x5ea74a&&_0x5ea74a[_0x13cbbd(0x12f)]&&(_0x18bd2c=JSON[_0x13cbbd(0x149)](_0x5ea74a['val']),_0x575ded=_0x5ea74a['ts']);}catch(_0x18e7ea){}const _0x51d6d9=new Date(_0x575ded),_0x4fb531=new Date();_0x51d6d9[_0x13cbbd(0x102)]()!==_0x4fb531[_0x13cbbd(0x102)]()&&(_0x18bd2c=new Array(0x18)[_0x13cbbd(0xef)](0x0));const _0x261e60=_0x4fb531[_0x13cbbd(0x14d)]();if(_0x18bd2c[_0x261e60]===undefined)_0x18bd2c[_0x261e60]=0x0;_0x18bd2c[_0x261e60]++,await _0x8c5625[_0x13cbbd(0x131)](_0x13cbbd(0x137),{'val':JSON['stringify'](_0x18bd2c),'ack':!![]});}async function processSensorEvent(_0x272f88,_0x1c3fcc,_0x29051e,_0x4be221){const _0x3a5c29=a5_0x9494;if(!_0x4be221)return null;const _0x25d59c=_0x29051e[_0x3a5c29(0x12f)],_0x3e96eb=Date[_0x3a5c29(0x120)](),_0x11eee2=_0x272f88[_0x3a5c29(0x11c)][_0x1c3fcc],_0x514878=(_0x4be221['type']||'')[_0x3a5c29(0xe5)](),_0x274ac0=_0x514878[_0x3a5c29(0x10a)](_0x3a5c29(0xe9))||_0x514878['includes'](_0x3a5c29(0x12c))||_0x514878[_0x3a5c29(0x10a)](_0x3a5c29(0x124))||_0x514878[_0x3a5c29(0x10a)](_0x3a5c29(0x14c))||_0x514878[_0x3a5c29(0x10a)]('thermostat');if(_0x274ac0&&typeof _0x25d59c===_0x3a5c29(0xe3)){if(_0x25d59c>0x50||_0x25d59c<-0x32)return _0x272f88[_0x3a5c29(0xed)][_0x3a5c29(0x105)](_0x3a5c29(0xf9)+_0x25d59c+'\x20from\x20'+_0x1c3fcc),null;}_0x272f88[_0x3a5c29(0x11c)][_0x1c3fcc]=_0x25d59c;if(!_0x4be221[_0x3a5c29(0xec)]&&_0x11eee2!=undefined&&_0x11eee2==_0x25d59c)return null;_0x272f88[_0x3a5c29(0xe2)]&&_0x274ac0&&recordThermodynamics(_0x272f88,_0x1c3fcc,_0x25d59c,_0x4be221[_0x3a5c29(0x146)]);const _0x26eee2={'timestamp':_0x3e96eb,'id':_0x1c3fcc,'name':_0x4be221[_0x3a5c29(0x118)],'type':_0x4be221[_0x3a5c29(0x13b)],'location':_0x4be221[_0x3a5c29(0x146)],'value':_0x25d59c};_0x272f88[_0x3a5c29(0x128)][_0x3a5c29(0x121)](_0x26eee2);if(_0x272f88[_0x3a5c29(0x128)]['length']>HISTORY_MAX_SIZE)_0x272f88['eventHistory']['pop']();await _0x272f88[_0x3a5c29(0x131)](_0x3a5c29(0x104),{'val':JSON[_0x3a5c29(0x127)](_0x26eee2),'ack':!![]}),await _0x272f88[_0x3a5c29(0x131)](_0x3a5c29(0x145),{'val':JSON[_0x3a5c29(0x127)](_0x272f88[_0x3a5c29(0x128)]),'ack':!![]}),await updateHourlyActivity(_0x272f88);if(_0x272f88[_0x3a5c29(0xe2)]){_0x272f88[_0x3a5c29(0x11a)][_0x3a5c29(0xe8)](_0x26eee2);if(_0x272f88[_0x3a5c29(0x11a)][_0x3a5c29(0x10e)]>RAW_LOG_MAX_SIZE)_0x272f88['rawEventLog'][_0x3a5c29(0x144)](0x0,_0x272f88[_0x3a5c29(0x11a)][_0x3a5c29(0x10e)]-RAW_LOG_MAX_SIZE);await _0x272f88['setStateAsync'](_0x3a5c29(0x132),{'val':JSON[_0x3a5c29(0x127)](_0x272f88[_0x3a5c29(0x11a)]),'ack':!![]}),recordSequence(_0x272f88,_0x26eee2);}if(_0x4be221[_0x3a5c29(0x10d)]&&_0x25d59c===!![]){if(_0x272f88['isPresent']&&!_0x272f88['isGracePeriodActive'])startExitTimer(_0x272f88);else{if(!_0x272f88[_0x3a5c29(0x11f)])setPresence(_0x272f88,!![]);}}else{if(_0x4be221['type']===_0x3a5c29(0xe0)&&_0x25d59c===!![]){if(_0x272f88[_0x3a5c29(0x135)])abortExitTimer(_0x272f88);if(!_0x272f88['isPresent']&&_0x272f88['currentSystemMode']===_0x3a5c29(0x11e))setPresence(_0x272f88,!![]);}}if(_0x272f88[_0x3a5c29(0xe2)]&&_0x272f88['sendToPythonWrapper']){_0x4be221[_0x3a5c29(0x13b)]===_0x3a5c29(0xe0)&&_0x25d59c===!![]&&_0x4be221[_0x3a5c29(0x146)]&&_0x272f88[_0x3a5c29(0x107)]('SIMULATE_SIGNAL',{'room':_0x4be221['location']});const _0x3bc153=['door',_0x3a5c29(0x136),_0x3a5c29(0x111),'fenster',_0x3a5c29(0xf3),_0x3a5c29(0x106),_0x3a5c29(0x115),_0x3a5c29(0xf1)][_0x3a5c29(0xf7)](_0x213b40=>_0x514878[_0x3a5c29(0x10a)](_0x213b40)),_0x407573=[_0x3a5c29(0xfa),_0x3a5c29(0xf5),_0x3a5c29(0xe6),'schalter',_0x3a5c29(0x12a),'lampe'][_0x3a5c29(0xf7)](_0x4259b5=>_0x514878[_0x3a5c29(0x10a)](_0x4259b5)),_0x4f62a3=[_0x3a5c29(0xe0),_0x3a5c29(0xf0),'präsenz','presence','occupancy']['some'](_0x5ddd19=>_0x514878['includes'](_0x5ddd19));if(_0x4be221[_0x3a5c29(0x146)]&&(_0x3bc153||_0x407573||_0x4f62a3)){const _0x263b61=_0x25d59c===!![]||typeof _0x25d59c===_0x3a5c29(0xe3)&&_0x25d59c>0x0,_0x34cf54=_0x3bc153&&!_0x263b61&&_0x11eee2!==undefined&&_0x11eee2!=_0x25d59c;if(_0x263b61||_0x34cf54){const _0x1bbdc7=_0x272f88[_0x3a5c29(0xf2)]||_0x3e96eb,_0x58d41f=(_0x3e96eb-_0x1bbdc7)/0x3e8;_0x272f88[_0x3a5c29(0xf2)]=_0x3e96eb,_0x272f88[_0x3a5c29(0x107)](_0x3a5c29(0x13a),{'room':_0x4be221[_0x3a5c29(0x146)],'dt':_0x58d41f});}}}return _0x26eee2;}module[a5_0x284c58(0xfe)]={'processSensorEvent':processSensorEvent,'getOutsideTemperatureNumeric':getOutsideTemperatureNumeric,'setPresence':setPresence,'abortExitTimer':abortExitTimer,'startExitTimer':startExitTimer};