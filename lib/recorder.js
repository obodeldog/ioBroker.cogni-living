const a5_0x4f93ad=a5_0x2e46;(function(_0x57b605,_0x24f1a3){const _0x45a6d1=a5_0x2e46,_0x44ff07=_0x57b605();while(!![]){try{const _0x1aaf35=-parseInt(_0x45a6d1(0x107))/0x1*(-parseInt(_0x45a6d1(0x11e))/0x2)+-parseInt(_0x45a6d1(0x131))/0x3+parseInt(_0x45a6d1(0xf6))/0x4*(-parseInt(_0x45a6d1(0xfb))/0x5)+-parseInt(_0x45a6d1(0x11c))/0x6+parseInt(_0x45a6d1(0xe2))/0x7*(parseInt(_0x45a6d1(0x10f))/0x8)+parseInt(_0x45a6d1(0xe7))/0x9+parseInt(_0x45a6d1(0x11f))/0xa;if(_0x1aaf35===_0x24f1a3)break;else _0x44ff07['push'](_0x44ff07['shift']());}catch(_0x240779){_0x44ff07['push'](_0x44ff07['shift']());}}}(a5_0x1233,0xebc7d));const a5_0x348b16=(function(){let _0x3b8517=!![];return function(_0x513091,_0x13cdcc){const _0x4b9239=_0x3b8517?function(){const _0x2b25ed=a5_0x2e46;if(_0x13cdcc){const _0x4e8b0b=_0x13cdcc[_0x2b25ed(0x135)](_0x513091,arguments);return _0x13cdcc=null,_0x4e8b0b;}}:function(){};return _0x3b8517=![],_0x4b9239;};}()),a5_0x505714=a5_0x348b16(this,function(){const _0x47d11b=a5_0x2e46;return a5_0x505714['toString']()['search'](_0x47d11b(0x128))[_0x47d11b(0x119)]()[_0x47d11b(0x130)](a5_0x505714)[_0x47d11b(0x114)](_0x47d11b(0x128));});a5_0x505714();'use strict';const HISTORY_MAX_SIZE=0x32,RAW_LOG_MAX_SIZE=0x9c4,THERMO_LOG_SIZE=0x3e8,SEQUENCE_TIMEOUT_MS=0x5*0x3c*0x3e8,MAX_TRAINING_SET_SIZE=0x1f4,EXIT_TIMER_MINUTES=0xf,EXIT_GRACE_PERIOD_SECONDS=0x1e;let activeSequence=[],sequenceTimer=null;async function getOutsideTemperatureNumeric(_0xfe6ef8){const _0x3c1c5e=a5_0x2e46;if(_0xfe6ef8[_0x3c1c5e(0xe8)][_0x3c1c5e(0x10a)])try{const _0x3273cb=await _0xfe6ef8['getForeignStateAsync'](_0xfe6ef8[_0x3c1c5e(0xe8)]['outdoorSensorId']);if(_0x3273cb&&_0x3273cb[_0x3c1c5e(0xe3)]!==undefined&&_0x3273cb[_0x3c1c5e(0xe3)]!==null)return parseFloat(_0x3273cb[_0x3c1c5e(0xe3)]);}catch(_0x336cfc){}const _0x3ae35d=_0xfe6ef8[_0x3c1c5e(0xe8)][_0x3c1c5e(0xde)];if(!_0xfe6ef8[_0x3c1c5e(0xe8)]['useWeather']||!_0x3ae35d)return null;try{let _0x4495ec='';if(_0x3ae35d[_0x3c1c5e(0x12c)](_0x3c1c5e(0xe4)))_0x4495ec=_0x3ae35d+_0x3c1c5e(0x134);else{if(_0x3ae35d['includes'](_0x3c1c5e(0x122)))_0x4495ec=_0x3ae35d+_0x3c1c5e(0x10b);else{if(_0x3ae35d[_0x3c1c5e(0x12c)]('openweathermap'))_0x4495ec=_0x3ae35d+'.forecast.current.temperature';else{if(_0x3ae35d[_0x3c1c5e(0x12c)]('weatherunderground'))_0x4495ec=_0x3ae35d+_0x3c1c5e(0xd9);}}}if(_0x4495ec){const _0x5bef30=await _0xfe6ef8['getForeignStateAsync'](_0x4495ec);if(_0x5bef30&&_0x5bef30['val']!==undefined&&_0x5bef30[_0x3c1c5e(0xe3)]!==null)return parseFloat(_0x5bef30[_0x3c1c5e(0xe3)]);}}catch(_0x1740f6){}return null;}async function recordThermodynamics(_0x546c82,_0x5008fc,_0x5771fa,_0x59f390){const _0x3ca27a=a5_0x2e46,_0x59e465=await getOutsideTemperatureNumeric(_0x546c82);if(_0x59e465===null)return;let _0x3af796=0x0,_0x1a77f2=![];if(_0x546c82[_0x3ca27a(0xe8)][_0x3ca27a(0x106)])try{let _0x3d1be5=_0x546c82[_0x3ca27a(0xe8)][_0x3ca27a(0x106)];if(typeof _0x3d1be5==='string')_0x3d1be5=JSON[_0x3ca27a(0xf4)](_0x3d1be5);if(_0x3d1be5[_0x5008fc]){const _0x383858=_0x3d1be5[_0x5008fc],_0x59bac4=await _0x546c82['getForeignStateAsync'](_0x383858);if(_0x59bac4&&_0x59bac4[_0x3ca27a(0xe3)]!==null&&_0x59bac4[_0x3ca27a(0xe3)]!==undefined){let _0x582db7=Number(_0x59bac4[_0x3ca27a(0xe3)]);if(_0x582db7<=1.05&&!_0x383858['includes'](_0x3ca27a(0x129))&&!_0x383858[_0x3ca27a(0x12c)]('STATE'))_0x582db7=_0x582db7*0x64;_0x3af796=Math[_0x3ca27a(0xe5)](_0x582db7),_0x1a77f2=!![];}}}catch(_0x8a72ee){}if(!_0x1a77f2){const _0x57e4cf=[{'from':_0x3ca27a(0x12f),'to':'.1.LEVEL'},{'from':_0x3ca27a(0x12f),'to':'.1.VALVE_STATE'},{'from':_0x3ca27a(0x126),'to':'.4.VALVE_STATE'},{'from':'.ACTUAL_TEMPERATURE','to':'.LEVEL'},{'from':_0x3ca27a(0xd7),'to':_0x3ca27a(0x124)},{'from':'Temperature','to':_0x3ca27a(0x127)}];for(const _0x3c8399 of _0x57e4cf){if(_0x5008fc['includes'](_0x3c8399[_0x3ca27a(0xf3)])){const _0x4bfc48=_0x5008fc[_0x3ca27a(0xdb)](_0x3c8399[_0x3ca27a(0xf3)],_0x3c8399['to']);try{const _0x32768b=await _0x546c82[_0x3ca27a(0xf9)](_0x4bfc48);if(_0x32768b&&_0x32768b[_0x3ca27a(0xe3)]!==null&&_0x32768b['val']!==undefined){let _0x14311d=Number(_0x32768b[_0x3ca27a(0xe3)]);if(typeof _0x14311d===_0x3ca27a(0xf5)){if(_0x14311d<=1.05&&_0x3c8399['to'][_0x3ca27a(0x12c)](_0x3ca27a(0x116)))_0x14311d=_0x14311d*0x64;_0x3af796=Math[_0x3ca27a(0xe5)](_0x14311d),_0x1a77f2=!![];break;}}}catch(_0x30faf9){}}}}const _0x275947=await _0x546c82[_0x3ca27a(0xfa)](_0x3ca27a(0x137));let _0x2f4f3b=[];if(_0x275947&&_0x275947['val'])try{_0x2f4f3b=JSON[_0x3ca27a(0xf4)](_0x275947[_0x3ca27a(0xe3)]);}catch(_0x2698ce){}_0x2f4f3b['push']({'ts':Date[_0x3ca27a(0xe9)](),'room':_0x59f390||_0x3ca27a(0x132),'t_in':_0x5771fa,'t_out':_0x59e465,'valve':_0x3af796});if(_0x2f4f3b[_0x3ca27a(0xeb)]>THERMO_LOG_SIZE)_0x2f4f3b['shift']();await _0x546c82[_0x3ca27a(0xf8)](_0x3ca27a(0x137),{'val':JSON[_0x3ca27a(0x10d)](_0x2f4f3b),'ack':!![]});}async function saveCompletedSequence(_0x33595e){const _0x13dd14=a5_0x2e46;try{const _0x5ef907=await _0x33595e['getStateAsync'](_0x13dd14(0x113));let _0xb380b0=[];if(_0x5ef907&&_0x5ef907[_0x13dd14(0xe3)])try{_0xb380b0=JSON[_0x13dd14(0xf4)](_0x5ef907[_0x13dd14(0xe3)]);}catch(_0x30478b){}const _0x2a5fdb=activeSequence[0x0]['ts'],_0x5ec62c=activeSequence[_0x13dd14(0xdc)](_0x357c72=>({'loc':_0x357c72['loc'],'t_delta':Math[_0x13dd14(0xe5)]((_0x357c72['ts']-_0x2a5fdb)/0x3e8)})),_0x35297b={'timestamp':new Date(_0x2a5fdb)[_0x13dd14(0x101)](),'steps':_0x5ec62c,'duration':Math['round']((activeSequence[activeSequence['length']-0x1]['ts']-_0x2a5fdb)/0x3e8),'daytime':new Date(_0x2a5fdb)[_0x13dd14(0xec)]()};_0xb380b0[_0x13dd14(0xf2)](_0x35297b);if(_0xb380b0['length']>MAX_TRAINING_SET_SIZE)_0xb380b0['shift']();await _0x33595e[_0x13dd14(0xf8)]('LTM.trainingData.sequences',{'val':JSON[_0x13dd14(0x10d)](_0xb380b0),'ack':!![]}),_0x33595e['isProVersion']&&_0x33595e[_0x13dd14(0x133)]&&_0x33595e[_0x13dd14(0x133)]('ANALYZE_SEQUENCE',{'sequence':_0x35297b});}catch(_0x58674d){_0x33595e['log'][_0x13dd14(0xef)]('[RECORDER]\x20Error:\x20'+_0x58674d[_0x13dd14(0xd6)]);}}async function recordSequence(_0x1e1c86,_0x390ad2){const _0x543a77=a5_0x2e46,_0x37c7b4=(_0x390ad2[_0x543a77(0x136)]||'')[_0x543a77(0xf7)](),_0x517d43=[_0x543a77(0xda),'bewegung',_0x543a77(0xea),'presence',_0x543a77(0x105),'door',_0x543a77(0x10c),_0x543a77(0xd8),_0x543a77(0x115),'contact','kontakt',_0x543a77(0xf0),_0x543a77(0xe1),'switch',_0x543a77(0xfd),'dimmer',_0x543a77(0xee)];if(!_0x517d43['some'](_0x5cc374=>_0x37c7b4[_0x543a77(0x12c)](_0x5cc374)))return;if(!_0x390ad2[_0x543a77(0x117)])return;if(sequenceTimer)clearTimeout(sequenceTimer);activeSequence['push']({'loc':_0x390ad2[_0x543a77(0x118)]||'Unknown','id':_0x390ad2['id'],'ts':Date[_0x543a77(0xe9)]()}),sequenceTimer=setTimeout(async()=>{const _0x9b54e0=_0x543a77;if(activeSequence[_0x9b54e0(0xeb)]>0x1)await saveCompletedSequence(_0x1e1c86);activeSequence=[];},SEQUENCE_TIMEOUT_MS);}function startExitTimer(_0x56e632){const _0x5cc349=a5_0x2e46;abortExitTimer(_0x56e632),_0x56e632[_0x5cc349(0xff)]=!![],_0x56e632[_0x5cc349(0x104)]=setTimeout(()=>{const _0x3eab61=_0x5cc349;_0x56e632[_0x3eab61(0xff)]=![];},EXIT_GRACE_PERIOD_SECONDS*0x3e8),_0x56e632['exitTimer']=setTimeout(()=>{setPresence(_0x56e632,![]),_0x56e632['exitTimer']=null;},EXIT_TIMER_MINUTES*0x3c*0x3e8);}function abortExitTimer(_0xb91ab3){const _0x2d1744=a5_0x2e46;if(_0xb91ab3[_0x2d1744(0x123)])clearTimeout(_0xb91ab3[_0x2d1744(0x123)]);if(_0xb91ab3[_0x2d1744(0x104)])clearTimeout(_0xb91ab3[_0x2d1744(0x104)]);_0xb91ab3['exitTimer']=null,_0xb91ab3[_0x2d1744(0x104)]=null,_0xb91ab3[_0x2d1744(0xff)]=![];}async function setPresence(_0x2db98f,_0x237910){const _0xd99df7=a5_0x2e46;if(_0x2db98f[_0xd99df7(0x12b)]===_0x237910)return;_0x2db98f[_0xd99df7(0x12b)]=_0x237910,await _0x2db98f[_0xd99df7(0xf8)](_0xd99df7(0x11a),{'val':_0x237910,'ack':!![]});}function a5_0x2e46(_0x57d063,_0x1ef1e6){const _0x232cff=a5_0x1233();return a5_0x2e46=function(_0x505714,_0x348b16){_0x505714=_0x505714-0xd6;let _0x123365=_0x232cff[_0x505714];return _0x123365;},a5_0x2e46(_0x57d063,_0x1ef1e6);}async function processSensorEvent(_0x5dfaa1,_0x2ecdec,_0x3752f9,_0x589095){const _0xe19dcc=a5_0x2e46;if(!_0x589095)return null;const _0x2ecf14=_0x3752f9['val'],_0x206626=Date[_0xe19dcc(0xe9)](),_0x1151eb=_0x5dfaa1['sensorLastValues'][_0x2ecdec],_0xa094d8=(_0x589095[_0xe19dcc(0x136)]||'')[_0xe19dcc(0xf7)](),_0x3b890d=_0xa094d8[_0xe19dcc(0x12c)](_0xe19dcc(0xd7))||_0xa094d8['includes'](_0xe19dcc(0xfe))||_0xa094d8[_0xe19dcc(0x12c)](_0xe19dcc(0x12e))||_0xa094d8['includes'](_0xe19dcc(0x10e))||_0xa094d8[_0xe19dcc(0x12c)](_0xe19dcc(0x110));if(_0x3b890d&&typeof _0x2ecf14===_0xe19dcc(0xf5)){if(_0x2ecf14>0x50||_0x2ecf14<-0x32)return _0x5dfaa1['log']['debug']('[RECORDER]\x20Ignored\x20implausible\x20temperature:\x20'+_0x2ecf14+_0xe19dcc(0x12d)+_0x2ecdec),null;}_0x5dfaa1[_0xe19dcc(0x103)][_0x2ecdec]=_0x2ecf14;if(!_0x589095[_0xe19dcc(0xe6)]&&_0x1151eb!=undefined&&_0x1151eb==_0x2ecf14)return null;_0x5dfaa1[_0xe19dcc(0x11d)]&&_0x3b890d&&recordThermodynamics(_0x5dfaa1,_0x2ecdec,_0x2ecf14,_0x589095[_0xe19dcc(0x118)]);const _0x99854a={'timestamp':_0x206626,'id':_0x2ecdec,'name':_0x589095['name'],'type':_0x589095[_0xe19dcc(0x136)],'location':_0x589095[_0xe19dcc(0x118)],'value':_0x2ecf14};_0x5dfaa1[_0xe19dcc(0x112)]['unshift'](_0x99854a);if(_0x5dfaa1[_0xe19dcc(0x112)][_0xe19dcc(0xeb)]>HISTORY_MAX_SIZE)_0x5dfaa1['eventHistory'][_0xe19dcc(0x121)]();await _0x5dfaa1[_0xe19dcc(0xf8)](_0xe19dcc(0x100),{'val':JSON[_0xe19dcc(0x10d)](_0x99854a),'ack':!![]}),await _0x5dfaa1[_0xe19dcc(0xf8)](_0xe19dcc(0x11b),{'val':JSON[_0xe19dcc(0x10d)](_0x5dfaa1[_0xe19dcc(0x112)]),'ack':!![]});if(_0x5dfaa1[_0xe19dcc(0x11d)]){_0x5dfaa1[_0xe19dcc(0xe0)][_0xe19dcc(0xf2)](_0x99854a);if(_0x5dfaa1[_0xe19dcc(0xe0)][_0xe19dcc(0xeb)]>RAW_LOG_MAX_SIZE)_0x5dfaa1[_0xe19dcc(0xe0)][_0xe19dcc(0xf1)](0x0,_0x5dfaa1['rawEventLog'][_0xe19dcc(0xeb)]-RAW_LOG_MAX_SIZE);await _0x5dfaa1[_0xe19dcc(0xf8)]('LTM.rawEventLog',{'val':JSON[_0xe19dcc(0x10d)](_0x5dfaa1['rawEventLog']),'ack':!![]}),recordSequence(_0x5dfaa1,_0x99854a);}if(_0x589095[_0xe19dcc(0x102)]&&_0x2ecf14===!![]){if(_0x5dfaa1[_0xe19dcc(0x12b)]&&!_0x5dfaa1[_0xe19dcc(0xff)])startExitTimer(_0x5dfaa1);else{if(!_0x5dfaa1[_0xe19dcc(0x12b)])setPresence(_0x5dfaa1,!![]);}}else{if(_0x589095[_0xe19dcc(0x136)]===_0xe19dcc(0xda)&&_0x2ecf14===!![]){if(_0x5dfaa1[_0xe19dcc(0x123)])abortExitTimer(_0x5dfaa1);if(!_0x5dfaa1['isPresent']&&_0x5dfaa1['currentSystemMode']===_0xe19dcc(0xdd))setPresence(_0x5dfaa1,!![]);}}if(_0x5dfaa1[_0xe19dcc(0x11d)]&&_0x5dfaa1[_0xe19dcc(0x133)]){_0x589095[_0xe19dcc(0x136)]===_0xe19dcc(0xda)&&_0x2ecf14===!![]&&_0x589095[_0xe19dcc(0x118)]&&_0x5dfaa1[_0xe19dcc(0x133)]('SIMULATE_SIGNAL',{'room':_0x589095[_0xe19dcc(0x118)]});const _0xa0d110=['door',_0xe19dcc(0x10c),_0xe19dcc(0xd8),_0xe19dcc(0x115),'griff','handle','lock',_0xe19dcc(0xed)]['some'](_0x22f21a=>_0xa094d8[_0xe19dcc(0x12c)](_0x22f21a)),_0xaca12e=['light',_0xe19dcc(0xe1),_0xe19dcc(0xfc),_0xe19dcc(0xfd),_0xe19dcc(0x120),'lampe'][_0xe19dcc(0x111)](_0x53c97f=>_0xa094d8[_0xe19dcc(0x12c)](_0x53c97f)),_0x7331b6=[_0xe19dcc(0xda),_0xe19dcc(0x108),_0xe19dcc(0xea),_0xe19dcc(0x109),'occupancy']['some'](_0x10636e=>_0xa094d8[_0xe19dcc(0x12c)](_0x10636e));if(_0x589095['location']&&(_0xa0d110||_0xaca12e||_0x7331b6)){const _0x48a9c0=_0x2ecf14===!![]||typeof _0x2ecf14===_0xe19dcc(0xf5)&&_0x2ecf14>0x0,_0x3cf92b=_0xa0d110&&!_0x48a9c0&&_0x1151eb!==undefined&&_0x1151eb!=_0x2ecf14;if(_0x48a9c0||_0x3cf92b){const _0x1d3902=_0x5dfaa1['lastTrackerEventTime']||_0x206626,_0x3cf9ef=(_0x206626-_0x1d3902)/0x3e8;_0x5dfaa1[_0xe19dcc(0x125)]=_0x206626,_0x5dfaa1['sendToPythonWrapper'](_0xe19dcc(0xdf),{'room':_0x589095[_0xe19dcc(0x118)],'dt':_0x3cf9ef});}}}return _0x99854a;}module[a5_0x4f93ad(0x12a)]={'processSensorEvent':processSensorEvent,'getOutsideTemperatureNumeric':getOutsideTemperatureNumeric,'setPresence':setPresence,'abortExitTimer':abortExitTimer,'startExitTimer':startExitTimer};function a5_0x1233(){const _0x3da22b=['includes','\x20from\x20','klima','.1.ACTUAL_TEMPERATURE','constructor','4045341BMGFIR','Unknown','sendToPythonWrapper','.Current.Temperature','apply','type','LTM.trainingData.thermodynamics','message','temperature','window','.forecast.current.temp','motion','replace','map','normal','weatherInstance','TRACK_EVENT','rawEventLog','licht','173782UIDgIj','val','accuweather','round','logDuplicates','5060259gWqgFq','config','now','präsenz','length','getHours','schloss','lampe','error','light','splice','push','from','parse','number','128308vlGcWK','toLowerCase','setStateAsync','getForeignStateAsync','getStateAsync','120rKCoAb','switch','schalter','temperatur','isGracePeriodActive','events.lastEvent','toISOString','isExit','sensorLastValues','exitGraceTimer','occupancy','valveMapping','426186JfcgDR','bewegung','presence','outdoorSensorId','.NextHours.Location_1.Day_1.current.temp_value','tür','stringify','heizung','96HfYGKR','thermostat','some','eventHistory','LTM.trainingData.sequences','search','fenster','LEVEL','value','location','toString','system.isPresent','events.history','1346478khbROl','isProVersion','4vhTOAT','15959300OzsAxC','dimmer','pop','daswetter','exitTimer','level','lastTrackerEventTime','.1.TEMPERATURE','Valve','(((.+)+)+)+$','STATUS','exports','isPresent'];a5_0x1233=function(){return _0x3da22b;};return a5_0x1233();}