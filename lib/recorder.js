(function(_0x29b7e5,_0x52a98e){const _0x31f93d=a5_0x27e6,_0x5a7ce6=_0x29b7e5();while(!![]){try{const _0x35df6c=parseInt(_0x31f93d(0x1fe))/0x1+-parseInt(_0x31f93d(0x1f6))/0x2+parseInt(_0x31f93d(0x24e))/0x3*(parseInt(_0x31f93d(0x21e))/0x4)+-parseInt(_0x31f93d(0x211))/0x5+-parseInt(_0x31f93d(0x240))/0x6*(parseInt(_0x31f93d(0x1ea))/0x7)+-parseInt(_0x31f93d(0x206))/0x8+parseInt(_0x31f93d(0x23b))/0x9;if(_0x35df6c===_0x52a98e)break;else _0x5a7ce6['push'](_0x5a7ce6['shift']());}catch(_0x139e90){_0x5a7ce6['push'](_0x5a7ce6['shift']());}}}(a5_0x1275,0xc6f06));const a5_0x2c5d03=(function(){let _0x22a9b1=!![];return function(_0x284c78,_0x46565e){const _0x1b0286=_0x22a9b1?function(){const _0x5072dd=a5_0x27e6;if(_0x46565e){const _0x77ce1=_0x46565e[_0x5072dd(0x21d)](_0x284c78,arguments);return _0x46565e=null,_0x77ce1;}}:function(){};return _0x22a9b1=![],_0x1b0286;};}()),a5_0x471994=a5_0x2c5d03(this,function(){const _0xa6c6fe=a5_0x27e6;return a5_0x471994[_0xa6c6fe(0x24b)]()[_0xa6c6fe(0x237)](_0xa6c6fe(0x23f))[_0xa6c6fe(0x24b)]()[_0xa6c6fe(0x1ff)](a5_0x471994)[_0xa6c6fe(0x237)]('(((.+)+)+)+$');});a5_0x471994();'use strict';const HISTORY_MAX_SIZE=0x32,RAW_LOG_MAX_SIZE=0x9c4,THERMO_LOG_SIZE=0x3e8,SEQUENCE_TIMEOUT_MS=0x5*0x3c*0x3e8,MAX_TRAINING_SET_SIZE=0x1f4,EXIT_TIMER_MINUTES=0xf,EXIT_GRACE_PERIOD_SECONDS=0x1e;let activeSequence=[],sequenceTimer=null;function a5_0x27e6(_0x12e44d,_0x52931f){const _0xa3ae7c=a5_0x1275();return a5_0x27e6=function(_0x471994,_0x2c5d03){_0x471994=_0x471994-0x1e6;let _0x12751b=_0xa3ae7c[_0x471994];return _0x12751b;},a5_0x27e6(_0x12e44d,_0x52931f);}async function getOutsideTemperatureNumeric(_0x3685a4){const _0x3c173f=a5_0x27e6;if(_0x3685a4[_0x3c173f(0x1f7)]['outdoorSensorId'])try{const _0x345e21=await _0x3685a4['getForeignStateAsync'](_0x3685a4[_0x3c173f(0x1f7)][_0x3c173f(0x20a)]);if(_0x345e21&&_0x345e21[_0x3c173f(0x239)]!==undefined&&_0x345e21[_0x3c173f(0x239)]!==null)return parseFloat(_0x345e21['val']);}catch(_0x5cc18f){}const _0x5853bf=_0x3685a4[_0x3c173f(0x1f7)]['weatherInstance'];if(!_0x3685a4['config']['useWeather']||!_0x5853bf)return null;try{let _0x150b35='';if(_0x5853bf['includes'](_0x3c173f(0x1e6)))_0x150b35=_0x5853bf+_0x3c173f(0x245);else{if(_0x5853bf[_0x3c173f(0x244)]('daswetter'))_0x150b35=_0x5853bf+_0x3c173f(0x1ec);else{if(_0x5853bf['includes'](_0x3c173f(0x210)))_0x150b35=_0x5853bf+_0x3c173f(0x242);else{if(_0x5853bf[_0x3c173f(0x244)](_0x3c173f(0x1fb)))_0x150b35=_0x5853bf+_0x3c173f(0x23c);}}}if(_0x150b35){const _0x280dc3=await _0x3685a4['getForeignStateAsync'](_0x150b35);if(_0x280dc3&&_0x280dc3['val']!==undefined&&_0x280dc3[_0x3c173f(0x239)]!==null)return parseFloat(_0x280dc3['val']);}}catch(_0x153cc0){}return null;}async function recordThermodynamics(_0x10c5d8,_0x2c7cc1,_0x395c28,_0x312104){const _0x42c1c0=a5_0x27e6,_0x1c0aab=await getOutsideTemperatureNumeric(_0x10c5d8);if(_0x1c0aab===null)return;let _0x12ef99=0x0,_0x1b4070=![];if(_0x10c5d8[_0x42c1c0(0x1f7)][_0x42c1c0(0x1fc)])try{let _0x1a309e=_0x10c5d8[_0x42c1c0(0x1f7)][_0x42c1c0(0x1fc)];if(typeof _0x1a309e===_0x42c1c0(0x21b))_0x1a309e=JSON[_0x42c1c0(0x24a)](_0x1a309e);if(_0x1a309e[_0x2c7cc1]){const _0x40f04f=_0x1a309e[_0x2c7cc1],_0x5aff28=await _0x10c5d8['getForeignStateAsync'](_0x40f04f);if(_0x5aff28&&_0x5aff28[_0x42c1c0(0x239)]!==null&&_0x5aff28['val']!==undefined){let _0xc9184=Number(_0x5aff28[_0x42c1c0(0x239)]);if(_0xc9184<=1.05&&!_0x40f04f[_0x42c1c0(0x244)](_0x42c1c0(0x236))&&!_0x40f04f[_0x42c1c0(0x244)]('STATE'))_0xc9184=_0xc9184*0x64;_0x12ef99=Math[_0x42c1c0(0x22b)](_0xc9184),_0x1b4070=!![];}}}catch(_0x25ad11){}if(!_0x1b4070){const _0x38f2c9=[{'from':_0x42c1c0(0x213),'to':_0x42c1c0(0x24c)},{'from':_0x42c1c0(0x213),'to':_0x42c1c0(0x1f4)},{'from':_0x42c1c0(0x1f5),'to':'.4.VALVE_STATE'},{'from':'.ACTUAL_TEMPERATURE','to':_0x42c1c0(0x216)},{'from':'temperature','to':_0x42c1c0(0x215)},{'from':_0x42c1c0(0x233),'to':_0x42c1c0(0x20b)}];for(const _0xe04d08 of _0x38f2c9){if(_0x2c7cc1[_0x42c1c0(0x244)](_0xe04d08[_0x42c1c0(0x208)])){const _0x4f1caf=_0x2c7cc1[_0x42c1c0(0x202)](_0xe04d08[_0x42c1c0(0x208)],_0xe04d08['to']);try{const _0x58c493=await _0x10c5d8[_0x42c1c0(0x24f)](_0x4f1caf);if(_0x58c493&&_0x58c493['val']!==null&&_0x58c493[_0x42c1c0(0x239)]!==undefined){let _0x5b3840=Number(_0x58c493[_0x42c1c0(0x239)]);if(typeof _0x5b3840==='number'){if(_0x5b3840<=1.05&&_0xe04d08['to'][_0x42c1c0(0x244)]('LEVEL'))_0x5b3840=_0x5b3840*0x64;_0x12ef99=Math[_0x42c1c0(0x22b)](_0x5b3840),_0x1b4070=!![];break;}}}catch(_0x2e286a){}}}}const _0x3aceef=await _0x10c5d8['getStateAsync'](_0x42c1c0(0x224));let _0x29ad44=[];if(_0x3aceef&&_0x3aceef[_0x42c1c0(0x239)])try{_0x29ad44=JSON[_0x42c1c0(0x24a)](_0x3aceef[_0x42c1c0(0x239)]);}catch(_0x3420b2){}_0x29ad44[_0x42c1c0(0x241)]({'ts':Date[_0x42c1c0(0x1f9)](),'room':_0x312104||_0x42c1c0(0x250),'t_in':_0x395c28,'t_out':_0x1c0aab,'valve':_0x12ef99});if(_0x29ad44[_0x42c1c0(0x214)]>THERMO_LOG_SIZE)_0x29ad44[_0x42c1c0(0x228)]();await _0x10c5d8[_0x42c1c0(0x22c)](_0x42c1c0(0x224),{'val':JSON[_0x42c1c0(0x22d)](_0x29ad44),'ack':!![]});}function a5_0x1275(){const _0x14cf23=['2342340hIGTxe','schloss','.1.ACTUAL_TEMPERATURE','length','level','.LEVEL','error','TRACK_EVENT','schalter','temperatur','string','unshift','apply','488zVMRdB','lampe','presence','lock','thermostat','door','LTM.trainingData.thermodynamics','LTM.trainingData.sequences','pop','exitTimer','shift','number','isPresent','round','setStateAsync','stringify','exitGraceTimer','contact','fenster','toISOString','klima','Temperature','switch','kontakt','STATUS','search','location','val','events.history','24867099PViqCz','.forecast.current.temp','isProVersion','temperature','(((.+)+)+)+$','6PlHqwJ','push','.forecast.current.temperature','message','includes','.Current.Temperature','isGracePeriodActive','occupancy','tür','eventHistory','parse','toString','.1.LEVEL','[RECORDER]\x20Error:\x20','18312pHAMFy','getForeignStateAsync','Unknown','dimmer','isExit','[RECORDER]\x20Ignored\x20implausible\x20temperature:\x20','accuweather','window','lastTrackerEventTime','rawEventLog','8157044ZTBbMi','currentSystemMode','.NextHours.Location_1.Day_1.current.temp_value','splice','value','logDuplicates','handle','licht','heizung','type','.1.VALVE_STATE','.1.TEMPERATURE','2262198dfxiwR','config','loc','now','präsenz','weatherunderground','valveMapping','sensorLastValues','512142VgcnCw','constructor','toLowerCase','bewegung','replace','sendToPythonWrapper','some','map','3521024HSOqvN','normal','from','SIMULATE_SIGNAL','outdoorSensorId','Valve','name','log','motion','events.lastEvent','openweathermap'];a5_0x1275=function(){return _0x14cf23;};return a5_0x1275();}async function saveCompletedSequence(_0x26d3be){const _0x432cdd=a5_0x27e6;try{const _0x5e3fc7=await _0x26d3be['getStateAsync']('LTM.trainingData.sequences');let _0x3ce204=[];if(_0x5e3fc7&&_0x5e3fc7[_0x432cdd(0x239)])try{_0x3ce204=JSON['parse'](_0x5e3fc7[_0x432cdd(0x239)]);}catch(_0x63a33b){}const _0x25c845=activeSequence[0x0]['ts'],_0x4e268d=activeSequence[_0x432cdd(0x205)](_0x39d466=>({'loc':_0x39d466[_0x432cdd(0x1f8)],'t_delta':Math[_0x432cdd(0x22b)]((_0x39d466['ts']-_0x25c845)/0x3e8)})),_0x4d0f6f={'timestamp':new Date(_0x25c845)[_0x432cdd(0x231)](),'steps':_0x4e268d,'duration':Math[_0x432cdd(0x22b)]((activeSequence[activeSequence[_0x432cdd(0x214)]-0x1]['ts']-_0x25c845)/0x3e8),'daytime':new Date(_0x25c845)['getHours']()};_0x3ce204[_0x432cdd(0x241)](_0x4d0f6f);if(_0x3ce204[_0x432cdd(0x214)]>MAX_TRAINING_SET_SIZE)_0x3ce204[_0x432cdd(0x228)]();await _0x26d3be[_0x432cdd(0x22c)](_0x432cdd(0x225),{'val':JSON['stringify'](_0x3ce204),'ack':!![]}),_0x26d3be[_0x432cdd(0x23d)]&&_0x26d3be[_0x432cdd(0x203)]&&_0x26d3be['sendToPythonWrapper']('ANALYZE_SEQUENCE',{'sequence':_0x4d0f6f});}catch(_0x16d115){_0x26d3be[_0x432cdd(0x20d)][_0x432cdd(0x217)](_0x432cdd(0x24d)+_0x16d115[_0x432cdd(0x243)]);}}async function recordSequence(_0x4ce5f1,_0x366854){const _0x33ba31=a5_0x27e6,_0x1d7fd6=(_0x366854[_0x33ba31(0x1f3)]||'')[_0x33ba31(0x200)](),_0xec8a1d=['motion',_0x33ba31(0x201),_0x33ba31(0x1fa),_0x33ba31(0x220),_0x33ba31(0x247),_0x33ba31(0x223),_0x33ba31(0x248),_0x33ba31(0x1e7),_0x33ba31(0x230),_0x33ba31(0x22f),_0x33ba31(0x235),'light','licht',_0x33ba31(0x234),_0x33ba31(0x219),_0x33ba31(0x251),_0x33ba31(0x21f)];if(!_0xec8a1d[_0x33ba31(0x204)](_0x59e79b=>_0x1d7fd6['includes'](_0x59e79b)))return;if(!_0x366854[_0x33ba31(0x1ee)])return;if(sequenceTimer)clearTimeout(sequenceTimer);activeSequence[_0x33ba31(0x241)]({'loc':_0x366854[_0x33ba31(0x238)]||'Unknown','id':_0x366854['id'],'ts':Date[_0x33ba31(0x1f9)]()}),sequenceTimer=setTimeout(async()=>{const _0x52d996=_0x33ba31;if(activeSequence[_0x52d996(0x214)]>0x1)await saveCompletedSequence(_0x4ce5f1);activeSequence=[];},SEQUENCE_TIMEOUT_MS);}function startExitTimer(_0x54368e){const _0xda9038=a5_0x27e6;abortExitTimer(_0x54368e),_0x54368e[_0xda9038(0x246)]=!![],_0x54368e['exitGraceTimer']=setTimeout(()=>{const _0x5ad941=_0xda9038;_0x54368e[_0x5ad941(0x246)]=![];},EXIT_GRACE_PERIOD_SECONDS*0x3e8),_0x54368e['exitTimer']=setTimeout(()=>{const _0x4f1d61=_0xda9038;setPresence(_0x54368e,![]),_0x54368e[_0x4f1d61(0x227)]=null;},EXIT_TIMER_MINUTES*0x3c*0x3e8);}function abortExitTimer(_0x4022b4){const _0x4e851a=a5_0x27e6;if(_0x4022b4[_0x4e851a(0x227)])clearTimeout(_0x4022b4['exitTimer']);if(_0x4022b4[_0x4e851a(0x22e)])clearTimeout(_0x4022b4['exitGraceTimer']);_0x4022b4[_0x4e851a(0x227)]=null,_0x4022b4[_0x4e851a(0x22e)]=null,_0x4022b4[_0x4e851a(0x246)]=![];}async function setPresence(_0x60dd6,_0xc4d6c2){const _0x1125b5=a5_0x27e6;if(_0x60dd6[_0x1125b5(0x22a)]===_0xc4d6c2)return;_0x60dd6['isPresent']=_0xc4d6c2,await _0x60dd6['setStateAsync']('system.isPresent',{'val':_0xc4d6c2,'ack':!![]});}async function processSensorEvent(_0x381df1,_0x142c38,_0x4fd02b,_0x98d4bc){const _0x53dec9=a5_0x27e6;if(!_0x98d4bc)return null;const _0x1270a6=_0x4fd02b['val'],_0x23d889=Date[_0x53dec9(0x1f9)](),_0x16f854=_0x381df1[_0x53dec9(0x1fd)][_0x142c38],_0x204170=(_0x98d4bc[_0x53dec9(0x1f3)]||'')[_0x53dec9(0x200)](),_0x10604c=_0x204170['includes'](_0x53dec9(0x23e))||_0x204170[_0x53dec9(0x244)](_0x53dec9(0x21a))||_0x204170[_0x53dec9(0x244)](_0x53dec9(0x232))||_0x204170[_0x53dec9(0x244)](_0x53dec9(0x1f2))||_0x204170[_0x53dec9(0x244)](_0x53dec9(0x222));if(_0x10604c&&typeof _0x1270a6===_0x53dec9(0x229)){if(_0x1270a6>0x50||_0x1270a6<-0x32)return _0x381df1['log']['debug'](_0x53dec9(0x253)+_0x1270a6+'\x20from\x20'+_0x142c38),null;}_0x381df1['sensorLastValues'][_0x142c38]=_0x1270a6;if(!_0x98d4bc[_0x53dec9(0x1ef)]&&_0x16f854!=undefined&&_0x16f854==_0x1270a6)return null;_0x381df1[_0x53dec9(0x23d)]&&_0x10604c&&recordThermodynamics(_0x381df1,_0x142c38,_0x1270a6,_0x98d4bc['location']);const _0x176134={'timestamp':_0x23d889,'id':_0x142c38,'name':_0x98d4bc[_0x53dec9(0x20c)],'type':_0x98d4bc[_0x53dec9(0x1f3)],'location':_0x98d4bc[_0x53dec9(0x238)],'value':_0x1270a6};_0x381df1[_0x53dec9(0x249)][_0x53dec9(0x21c)](_0x176134);if(_0x381df1['eventHistory'][_0x53dec9(0x214)]>HISTORY_MAX_SIZE)_0x381df1[_0x53dec9(0x249)][_0x53dec9(0x226)]();await _0x381df1[_0x53dec9(0x22c)](_0x53dec9(0x20f),{'val':JSON[_0x53dec9(0x22d)](_0x176134),'ack':!![]}),await _0x381df1['setStateAsync'](_0x53dec9(0x23a),{'val':JSON[_0x53dec9(0x22d)](_0x381df1[_0x53dec9(0x249)]),'ack':!![]});if(_0x381df1[_0x53dec9(0x23d)]){_0x381df1['rawEventLog'][_0x53dec9(0x241)](_0x176134);if(_0x381df1['rawEventLog'][_0x53dec9(0x214)]>RAW_LOG_MAX_SIZE)_0x381df1[_0x53dec9(0x1e9)][_0x53dec9(0x1ed)](0x0,_0x381df1[_0x53dec9(0x1e9)][_0x53dec9(0x214)]-RAW_LOG_MAX_SIZE);await _0x381df1[_0x53dec9(0x22c)]('LTM.rawEventLog',{'val':JSON[_0x53dec9(0x22d)](_0x381df1['rawEventLog']),'ack':!![]}),recordSequence(_0x381df1,_0x176134);}if(_0x98d4bc[_0x53dec9(0x252)]&&_0x1270a6===!![]){if(_0x381df1[_0x53dec9(0x22a)]&&!_0x381df1[_0x53dec9(0x246)])startExitTimer(_0x381df1);else{if(!_0x381df1[_0x53dec9(0x22a)])setPresence(_0x381df1,!![]);}}else{if(_0x98d4bc[_0x53dec9(0x1f3)]===_0x53dec9(0x20e)&&_0x1270a6===!![]){if(_0x381df1['exitTimer'])abortExitTimer(_0x381df1);if(!_0x381df1[_0x53dec9(0x22a)]&&_0x381df1[_0x53dec9(0x1eb)]===_0x53dec9(0x207))setPresence(_0x381df1,!![]);}}if(_0x381df1[_0x53dec9(0x23d)]&&_0x381df1[_0x53dec9(0x203)]){_0x98d4bc[_0x53dec9(0x1f3)]===_0x53dec9(0x20e)&&_0x1270a6===!![]&&_0x98d4bc[_0x53dec9(0x238)]&&_0x381df1[_0x53dec9(0x203)](_0x53dec9(0x209),{'room':_0x98d4bc['location']});const _0x3bc12b=[_0x53dec9(0x223),_0x53dec9(0x248),_0x53dec9(0x1e7),'fenster','griff',_0x53dec9(0x1f0),_0x53dec9(0x221),_0x53dec9(0x212)][_0x53dec9(0x204)](_0x268444=>_0x204170[_0x53dec9(0x244)](_0x268444)),_0x57aa40=['light',_0x53dec9(0x1f1),_0x53dec9(0x234),_0x53dec9(0x219),'dimmer',_0x53dec9(0x21f)]['some'](_0x325fc9=>_0x204170[_0x53dec9(0x244)](_0x325fc9)),_0x2ac30c=[_0x53dec9(0x20e),_0x53dec9(0x201),'präsenz',_0x53dec9(0x220),_0x53dec9(0x247)][_0x53dec9(0x204)](_0x76fa38=>_0x204170[_0x53dec9(0x244)](_0x76fa38));if(_0x98d4bc[_0x53dec9(0x238)]&&(_0x3bc12b||_0x57aa40||_0x2ac30c)){const _0x405a25=_0x1270a6===!![]||typeof _0x1270a6===_0x53dec9(0x229)&&_0x1270a6>0x0,_0x79f4cd=_0x3bc12b&&!_0x405a25&&_0x16f854!==undefined&&_0x16f854!=_0x1270a6;if(_0x405a25||_0x79f4cd){const _0x478596=_0x381df1[_0x53dec9(0x1e8)]||_0x23d889,_0x2a3c36=(_0x23d889-_0x478596)/0x3e8;_0x381df1[_0x53dec9(0x1e8)]=_0x23d889,_0x381df1[_0x53dec9(0x203)](_0x53dec9(0x218),{'room':_0x98d4bc[_0x53dec9(0x238)],'dt':_0x2a3c36});}}}return _0x176134;}module['exports']={'processSensorEvent':processSensorEvent,'getOutsideTemperatureNumeric':getOutsideTemperatureNumeric,'setPresence':setPresence,'abortExitTimer':abortExitTimer,'startExitTimer':startExitTimer};