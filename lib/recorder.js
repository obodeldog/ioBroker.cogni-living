const a4_0x25f384=a4_0x3d14;(function(_0x1f042f,_0x4d7592){const _0xf72072=a4_0x3d14,_0x29a255=_0x1f042f();while(!![]){try{const _0x155410=parseInt(_0xf72072(0x108))/0x1*(-parseInt(_0xf72072(0x12d))/0x2)+parseInt(_0xf72072(0x12b))/0x3+-parseInt(_0xf72072(0x127))/0x4+parseInt(_0xf72072(0x134))/0x5+-parseInt(_0xf72072(0xef))/0x6+-parseInt(_0xf72072(0x120))/0x7*(parseInt(_0xf72072(0x11f))/0x8)+parseInt(_0xf72072(0xf6))/0x9;if(_0x155410===_0x4d7592)break;else _0x29a255['push'](_0x29a255['shift']());}catch(_0x1c61d0){_0x29a255['push'](_0x29a255['shift']());}}}(a4_0x314b,0xeda68));const a4_0x1d70f9=(function(){let _0x2e0882=!![];return function(_0x12e9c9,_0x35bccf){const _0xf12ce5=_0x2e0882?function(){if(_0x35bccf){const _0x59a61b=_0x35bccf['apply'](_0x12e9c9,arguments);return _0x35bccf=null,_0x59a61b;}}:function(){};return _0x2e0882=![],_0xf12ce5;};}()),a4_0x691ea5=a4_0x1d70f9(this,function(){const _0x47e235=a4_0x3d14;return a4_0x691ea5[_0x47e235(0xff)]()['search'](_0x47e235(0x13b))[_0x47e235(0xff)]()[_0x47e235(0x115)](a4_0x691ea5)[_0x47e235(0x114)](_0x47e235(0x13b));});a4_0x691ea5();function a4_0x314b(){const _0x21f297=['normal','getHours','(((.+)+)+)+$','setStateAsync','bewegung','LTM.trainingData.sequences','isProVersion','.Current.Temperature','dimmer','exports','7112340xnIZog','light','lampe','shift','eventHistory','Unknown','LTM.rawEventLog','36451026HOSvlG','events.history','temperature','exitTimer','LTM.trainingData.thermodynamics','window','weatherInstance','licht','präsenz','toString','now','weatherunderground','splice','getStateAsync','loc','log','unshift','type','1399NnmucK','exitGraceTimer','.forecast.current.temp','push','includes','door','value','outdoorSensorId','parse','sendToPythonWrapper','getForeignStateAsync','system.isPresent','search','constructor','heizung','[RECORDER]\x20Error:\x20','events.lastEvent','ANALYZE_SEQUENCE','toLowerCase','klima','motion','useWeather','currentSystemMode','136DBQNVZ','440398eaAkmH','temperatur','isPresent','message','isGracePeriodActive','some','.forecast.current.temperature','4246004kmPRoz','presence','rawEventLog','config','2450181NyfLrk','toISOString','2164DFxKua','pop','val','tür','location','error','stringify','4683610GanhaE','round','length','isExit','sensorLastValues'];a4_0x314b=function(){return _0x21f297;};return a4_0x314b();}'use strict';const HISTORY_MAX_SIZE=0x32,RAW_LOG_MAX_SIZE=0x9c4,THERMO_LOG_SIZE=0x3e8,SEQUENCE_TIMEOUT_MS=0x5*0x3c*0x3e8,MAX_TRAINING_SET_SIZE=0x1f4,EXIT_TIMER_MINUTES=0xf,EXIT_GRACE_PERIOD_SECONDS=0x1e;let activeSequence=[],sequenceTimer=null;async function getOutsideTemperatureNumeric(_0x44b7b6){const _0x5f0909=a4_0x3d14;if(_0x44b7b6['config'][_0x5f0909(0x10f)])try{const _0x475d7c=await _0x44b7b6['getForeignStateAsync'](_0x44b7b6[_0x5f0909(0x12a)]['outdoorSensorId']);if(_0x475d7c&&_0x475d7c[_0x5f0909(0x12f)]!==undefined&&_0x475d7c[_0x5f0909(0x12f)]!==null)return parseFloat(_0x475d7c[_0x5f0909(0x12f)]);}catch(_0x166f85){}const _0x28bd0a=_0x44b7b6[_0x5f0909(0x12a)][_0x5f0909(0xfc)];if(!_0x44b7b6[_0x5f0909(0x12a)][_0x5f0909(0x11d)]||!_0x28bd0a)return null;try{let _0x358b96='';if(_0x28bd0a[_0x5f0909(0x10c)]('accuweather'))_0x358b96=_0x28bd0a+_0x5f0909(0x140);else{if(_0x28bd0a[_0x5f0909(0x10c)]('daswetter'))_0x358b96=_0x28bd0a+'.NextHours.Location_1.Day_1.current.temp_value';else{if(_0x28bd0a[_0x5f0909(0x10c)]('openweathermap'))_0x358b96=_0x28bd0a+_0x5f0909(0x126);else{if(_0x28bd0a[_0x5f0909(0x10c)](_0x5f0909(0x101)))_0x358b96=_0x28bd0a+_0x5f0909(0x10a);}}}if(_0x358b96){const _0x2a0427=await _0x44b7b6[_0x5f0909(0x112)](_0x358b96);if(_0x2a0427&&_0x2a0427['val']!==undefined&&_0x2a0427[_0x5f0909(0x12f)]!==null)return parseFloat(_0x2a0427[_0x5f0909(0x12f)]);}}catch(_0x1a5a65){}return null;}async function recordThermodynamics(_0x18fb0c,_0x5e867,_0x1ffe93,_0x48db71){const _0x407033=a4_0x3d14,_0x3a1287=await getOutsideTemperatureNumeric(_0x18fb0c),_0x3acb06=await _0x18fb0c[_0x407033(0x103)](_0x407033(0xfa));let _0x5b8817=[];if(_0x3acb06&&_0x3acb06['val'])try{_0x5b8817=JSON[_0x407033(0x110)](_0x3acb06['val']);}catch(_0xb8bc7a){}_0x5b8817[_0x407033(0x10b)]({'ts':Date['now'](),'room':_0x48db71||_0x407033(0xf4),'t_in':_0x1ffe93,'t_out':_0x3a1287});if(_0x5b8817[_0x407033(0x136)]>THERMO_LOG_SIZE)_0x5b8817[_0x407033(0xf2)]();await _0x18fb0c[_0x407033(0x13c)]('LTM.trainingData.thermodynamics',{'val':JSON[_0x407033(0x133)](_0x5b8817),'ack':!![]});}async function saveCompletedSequence(_0x563132){const _0x2fa0b7=a4_0x3d14;try{const _0x45c00f=await _0x563132['getStateAsync'](_0x2fa0b7(0x13e));let _0x33a721=[];if(_0x45c00f&&_0x45c00f[_0x2fa0b7(0x12f)])try{_0x33a721=JSON['parse'](_0x45c00f[_0x2fa0b7(0x12f)]);}catch(_0xab19a1){}const _0x4cafb9=activeSequence[0x0]['ts'],_0x18f9c1=activeSequence['map'](_0x132203=>({'loc':_0x132203[_0x2fa0b7(0x104)],'t_delta':Math['round']((_0x132203['ts']-_0x4cafb9)/0x3e8)})),_0xfa6dda={'timestamp':new Date(_0x4cafb9)[_0x2fa0b7(0x12c)](),'steps':_0x18f9c1,'duration':Math[_0x2fa0b7(0x135)]((activeSequence[activeSequence[_0x2fa0b7(0x136)]-0x1]['ts']-_0x4cafb9)/0x3e8),'daytime':new Date(_0x4cafb9)[_0x2fa0b7(0x13a)]()};_0x33a721['push'](_0xfa6dda);if(_0x33a721[_0x2fa0b7(0x136)]>MAX_TRAINING_SET_SIZE)_0x33a721[_0x2fa0b7(0xf2)]();await _0x563132['setStateAsync'](_0x2fa0b7(0x13e),{'val':JSON[_0x2fa0b7(0x133)](_0x33a721),'ack':!![]}),_0x563132[_0x2fa0b7(0x13f)]&&_0x563132[_0x2fa0b7(0x111)]&&_0x563132[_0x2fa0b7(0x111)](_0x2fa0b7(0x119),{'sequence':_0xfa6dda});}catch(_0xe8d9ca){_0x563132[_0x2fa0b7(0x105)][_0x2fa0b7(0x132)](_0x2fa0b7(0x117)+_0xe8d9ca[_0x2fa0b7(0x123)]);}}async function recordSequence(_0x2dcb3e,_0x6c5448){const _0x4db29b=a4_0x3d14,_0x3c2d6e=(_0x6c5448[_0x4db29b(0x107)]||'')[_0x4db29b(0x11a)](),_0x50135c=['motion',_0x4db29b(0x13d),_0x4db29b(0xfe),_0x4db29b(0x128),'occupancy',_0x4db29b(0x10d),_0x4db29b(0x130),_0x4db29b(0xfb),'fenster','contact','kontakt',_0x4db29b(0xf0),_0x4db29b(0xfd),'switch','schalter',_0x4db29b(0x141),_0x4db29b(0xf1)];if(!_0x50135c[_0x4db29b(0x125)](_0x43112c=>_0x3c2d6e[_0x4db29b(0x10c)](_0x43112c)))return;if(!_0x6c5448[_0x4db29b(0x10e)])return;if(sequenceTimer)clearTimeout(sequenceTimer);activeSequence[_0x4db29b(0x10b)]({'loc':_0x6c5448['location']||_0x4db29b(0xf4),'id':_0x6c5448['id'],'ts':Date[_0x4db29b(0x100)]()}),sequenceTimer=setTimeout(async()=>{const _0x5ed844=_0x4db29b;if(activeSequence[_0x5ed844(0x136)]>0x1)await saveCompletedSequence(_0x2dcb3e);activeSequence=[];},SEQUENCE_TIMEOUT_MS);}function a4_0x3d14(_0xf3b806,_0x17b851){const _0x37042f=a4_0x314b();return a4_0x3d14=function(_0x691ea5,_0x1d70f9){_0x691ea5=_0x691ea5-0xef;let _0x314b42=_0x37042f[_0x691ea5];return _0x314b42;},a4_0x3d14(_0xf3b806,_0x17b851);}function startExitTimer(_0x387fed){const _0x4ebd48=a4_0x3d14;abortExitTimer(_0x387fed),_0x387fed[_0x4ebd48(0x124)]=!![],_0x387fed['exitGraceTimer']=setTimeout(()=>{const _0x5365b3=_0x4ebd48;_0x387fed[_0x5365b3(0x124)]=![];},EXIT_GRACE_PERIOD_SECONDS*0x3e8),_0x387fed[_0x4ebd48(0xf9)]=setTimeout(()=>{setPresence(_0x387fed,![]),_0x387fed['exitTimer']=null;},EXIT_TIMER_MINUTES*0x3c*0x3e8);}function abortExitTimer(_0x136038){const _0x2cd7f6=a4_0x3d14;if(_0x136038[_0x2cd7f6(0xf9)])clearTimeout(_0x136038['exitTimer']);if(_0x136038[_0x2cd7f6(0x109)])clearTimeout(_0x136038[_0x2cd7f6(0x109)]);_0x136038[_0x2cd7f6(0xf9)]=null,_0x136038['exitGraceTimer']=null,_0x136038[_0x2cd7f6(0x124)]=![];}async function setPresence(_0x2358e0,_0x18dd8c){const _0xc05575=a4_0x3d14;if(_0x2358e0[_0xc05575(0x122)]===_0x18dd8c)return;_0x2358e0[_0xc05575(0x122)]=_0x18dd8c,await _0x2358e0[_0xc05575(0x13c)](_0xc05575(0x113),{'val':_0x18dd8c,'ack':!![]});}async function processSensorEvent(_0x457236,_0x4984ab,_0x53537f,_0xd35e7d){const _0x1e4705=a4_0x3d14;if(!_0xd35e7d)return;const _0x34aa02=_0x53537f[_0x1e4705(0x12f)],_0x4409fc=Date[_0x1e4705(0x100)](),_0x20b64d=_0x457236[_0x1e4705(0x138)][_0x4984ab];_0x457236[_0x1e4705(0x138)][_0x4984ab]=_0x34aa02;if(!_0xd35e7d['logDuplicates']&&_0x20b64d!=undefined&&_0x20b64d==_0x34aa02)return;const _0x6694e1=(_0xd35e7d[_0x1e4705(0x107)]||'')[_0x1e4705(0x11a)](),_0x5d1205=_0x6694e1[_0x1e4705(0x10c)](_0x1e4705(0xf8))||_0x6694e1[_0x1e4705(0x10c)](_0x1e4705(0x121))||_0x6694e1[_0x1e4705(0x10c)](_0x1e4705(0x11b))||_0x6694e1[_0x1e4705(0x10c)](_0x1e4705(0x116));_0x457236[_0x1e4705(0x13f)]&&_0x5d1205&&recordThermodynamics(_0x457236,_0x4984ab,_0x34aa02,_0xd35e7d[_0x1e4705(0x131)]);const _0x5c5d95={'timestamp':_0x4409fc,'id':_0x4984ab,'name':_0xd35e7d['name'],'type':_0xd35e7d[_0x1e4705(0x107)],'location':_0xd35e7d[_0x1e4705(0x131)],'value':_0x34aa02};_0x457236[_0x1e4705(0xf3)][_0x1e4705(0x106)](_0x5c5d95);if(_0x457236[_0x1e4705(0xf3)]['length']>HISTORY_MAX_SIZE)_0x457236['eventHistory'][_0x1e4705(0x12e)]();await _0x457236[_0x1e4705(0x13c)](_0x1e4705(0x118),{'val':JSON['stringify'](_0x5c5d95),'ack':!![]}),await _0x457236[_0x1e4705(0x13c)](_0x1e4705(0xf7),{'val':JSON['stringify'](_0x457236[_0x1e4705(0xf3)]),'ack':!![]});if(_0x457236[_0x1e4705(0x13f)]){_0x457236[_0x1e4705(0x129)][_0x1e4705(0x10b)](_0x5c5d95);if(_0x457236[_0x1e4705(0x129)]['length']>RAW_LOG_MAX_SIZE)_0x457236['rawEventLog'][_0x1e4705(0x102)](0x0,_0x457236['rawEventLog'][_0x1e4705(0x136)]-RAW_LOG_MAX_SIZE);await _0x457236[_0x1e4705(0x13c)](_0x1e4705(0xf5),{'val':JSON[_0x1e4705(0x133)](_0x457236[_0x1e4705(0x129)]),'ack':!![]}),recordSequence(_0x457236,_0x5c5d95);}if(_0xd35e7d[_0x1e4705(0x137)]&&_0x34aa02===!![]){if(_0x457236[_0x1e4705(0x122)]&&!_0x457236[_0x1e4705(0x124)])startExitTimer(_0x457236);else{if(!_0x457236[_0x1e4705(0x122)])setPresence(_0x457236,!![]);}}else{if(_0xd35e7d['type']===_0x1e4705(0x11c)&&_0x34aa02===!![]){if(_0x457236[_0x1e4705(0xf9)])abortExitTimer(_0x457236);if(!_0x457236[_0x1e4705(0x122)]&&_0x457236[_0x1e4705(0x11e)]===_0x1e4705(0x139))setPresence(_0x457236,!![]);}}_0x457236['isProVersion']&&_0xd35e7d['type']===_0x1e4705(0x11c)&&_0x34aa02===!![]&&_0xd35e7d[_0x1e4705(0x131)]&&_0x457236[_0x1e4705(0x111)]&&_0x457236[_0x1e4705(0x111)]('SIMULATE_SIGNAL',{'room':_0xd35e7d[_0x1e4705(0x131)]});}module[a4_0x25f384(0x142)]={'processSensorEvent':processSensorEvent,'getOutsideTemperatureNumeric':getOutsideTemperatureNumeric,'setPresence':setPresence,'abortExitTimer':abortExitTimer,'startExitTimer':startExitTimer};