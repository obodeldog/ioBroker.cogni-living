const a5_0x26a0cf=a5_0x4c4e;(function(_0x2035b8,_0x41d99e){const _0x11905d=a5_0x4c4e,_0x3adf2f=_0x2035b8();while(!![]){try{const _0x4d9b11=-parseInt(_0x11905d(0x1cb))/0x1*(-parseInt(_0x11905d(0x165))/0x2)+parseInt(_0x11905d(0x199))/0x3+-parseInt(_0x11905d(0x1c3))/0x4+-parseInt(_0x11905d(0x187))/0x5+-parseInt(_0x11905d(0x164))/0x6+parseInt(_0x11905d(0x177))/0x7*(-parseInt(_0x11905d(0x170))/0x8)+-parseInt(_0x11905d(0x1c5))/0x9*(-parseInt(_0x11905d(0x1bf))/0xa);if(_0x4d9b11===_0x41d99e)break;else _0x3adf2f['push'](_0x3adf2f['shift']());}catch(_0x51859d){_0x3adf2f['push'](_0x3adf2f['shift']());}}}(a5_0x28da,0x36f95));const a5_0x214efe=(function(){let _0x94a1a8=!![];return function(_0x43fe64,_0x4f579f){const _0x148d1e=_0x94a1a8?function(){const _0x76304a=a5_0x4c4e;if(_0x4f579f){const _0x2b2637=_0x4f579f[_0x76304a(0x198)](_0x43fe64,arguments);return _0x4f579f=null,_0x2b2637;}}:function(){};return _0x94a1a8=![],_0x148d1e;};}()),a5_0xfc38c8=a5_0x214efe(this,function(){const _0x551b91=a5_0x4c4e;return a5_0xfc38c8[_0x551b91(0x168)]()[_0x551b91(0x16b)]('(((.+)+)+)+$')[_0x551b91(0x168)]()[_0x551b91(0x186)](a5_0xfc38c8)['search']('(((.+)+)+)+$');});a5_0xfc38c8();'use strict';const HISTORY_MAX_SIZE=0x32,RAW_LOG_MAX_SIZE=0x9c4,THERMO_LOG_SIZE=0x3e8,SEQUENCE_TIMEOUT_MS=0x5*0x3c*0x3e8,MAX_TRAINING_SET_SIZE=0x1f4,EXIT_TIMER_MINUTES=0xf,EXIT_GRACE_PERIOD_SECONDS=0x1e;let activeSequence=[],sequenceTimer=null;async function getOutsideTemperatureNumeric(_0x12d1a0){const _0x344afc=a5_0x4c4e;if(_0x12d1a0[_0x344afc(0x19f)]['outdoorSensorId'])try{const _0x101f75=await _0x12d1a0[_0x344afc(0x1af)](_0x12d1a0[_0x344afc(0x19f)][_0x344afc(0x1ab)]);if(_0x101f75&&_0x101f75['val']!==undefined&&_0x101f75[_0x344afc(0x1b2)]!==null)return parseFloat(_0x101f75['val']);}catch(_0x412707){}const _0x185407=_0x12d1a0['config']['weatherInstance'];if(!_0x12d1a0['config'][_0x344afc(0x1a1)]||!_0x185407)return null;try{let _0x2f0f79='';if(_0x185407['includes'](_0x344afc(0x1b0)))_0x2f0f79=_0x185407+_0x344afc(0x17f);else{if(_0x185407[_0x344afc(0x174)](_0x344afc(0x1b8)))_0x2f0f79=_0x185407+_0x344afc(0x17b);else{if(_0x185407[_0x344afc(0x174)]('openweathermap'))_0x2f0f79=_0x185407+_0x344afc(0x192);else{if(_0x185407['includes'](_0x344afc(0x16e)))_0x2f0f79=_0x185407+'.forecast.current.temp';}}}if(_0x2f0f79){const _0x2741b8=await _0x12d1a0[_0x344afc(0x1af)](_0x2f0f79);if(_0x2741b8&&_0x2741b8['val']!==undefined&&_0x2741b8[_0x344afc(0x1b2)]!==null)return parseFloat(_0x2741b8[_0x344afc(0x1b2)]);}}catch(_0x8f2566){}return null;}async function recordThermodynamics(_0xd03dfb,_0x23175b,_0x4758df,_0x5e09b2){const _0xcfcdb0=a5_0x4c4e,_0x47ef8f=await getOutsideTemperatureNumeric(_0xd03dfb);if(_0x47ef8f===null)return;let _0x4e287c=0x0,_0x26dc38=![];if(_0xd03dfb['config'][_0xcfcdb0(0x175)])try{let _0x4d5a87=_0xd03dfb[_0xcfcdb0(0x19f)][_0xcfcdb0(0x175)];if(typeof _0x4d5a87===_0xcfcdb0(0x1a2))_0x4d5a87=JSON['parse'](_0x4d5a87);if(_0x4d5a87[_0x23175b]){const _0x3bf07f=_0x4d5a87[_0x23175b],_0x8b7a5c=await _0xd03dfb[_0xcfcdb0(0x1af)](_0x3bf07f);if(_0x8b7a5c&&_0x8b7a5c[_0xcfcdb0(0x1b2)]!==null&&_0x8b7a5c[_0xcfcdb0(0x1b2)]!==undefined){let _0xf80f48=Number(_0x8b7a5c[_0xcfcdb0(0x1b2)]);if(_0xf80f48<=1.05&&!_0x3bf07f['includes']('STATUS')&&!_0x3bf07f['includes'](_0xcfcdb0(0x193)))_0xf80f48=_0xf80f48*0x64;_0x4e287c=Math['round'](_0xf80f48),_0x26dc38=!![];}}}catch(_0x502cd){}if(!_0x26dc38){const _0x504e42=[{'from':_0xcfcdb0(0x178),'to':_0xcfcdb0(0x1a4)},{'from':_0xcfcdb0(0x178),'to':_0xcfcdb0(0x19d)},{'from':_0xcfcdb0(0x1bd),'to':'.4.VALVE_STATE'},{'from':_0xcfcdb0(0x16f),'to':_0xcfcdb0(0x19b)},{'from':'temperature','to':_0xcfcdb0(0x173)},{'from':_0xcfcdb0(0x15e),'to':_0xcfcdb0(0x179)}];for(const _0x4f74ea of _0x504e42){if(_0x23175b[_0xcfcdb0(0x174)](_0x4f74ea[_0xcfcdb0(0x1b6)])){const _0xc58e1=_0x23175b['replace'](_0x4f74ea['from'],_0x4f74ea['to']);try{const _0x4b3699=await _0xd03dfb['getForeignStateAsync'](_0xc58e1);if(_0x4b3699&&_0x4b3699[_0xcfcdb0(0x1b2)]!==null&&_0x4b3699[_0xcfcdb0(0x1b2)]!==undefined){let _0x4b0e82=Number(_0x4b3699['val']);if(typeof _0x4b0e82===_0xcfcdb0(0x19e)){if(_0x4b0e82<=1.05&&_0x4f74ea['to'][_0xcfcdb0(0x174)](_0xcfcdb0(0x183)))_0x4b0e82=_0x4b0e82*0x64;_0x4e287c=Math[_0xcfcdb0(0x16a)](_0x4b0e82),_0x26dc38=!![];break;}}}catch(_0x4e83be){}}}}const _0x4dd361=await _0xd03dfb[_0xcfcdb0(0x182)](_0xcfcdb0(0x18d));let _0x46e560=[];if(_0x4dd361&&_0x4dd361[_0xcfcdb0(0x1b2)])try{_0x46e560=JSON[_0xcfcdb0(0x163)](_0x4dd361[_0xcfcdb0(0x1b2)]);}catch(_0x423a1b){}_0x46e560['push']({'ts':Date['now'](),'room':_0x5e09b2||_0xcfcdb0(0x167),'t_in':_0x4758df,'t_out':_0x47ef8f,'valve':_0x4e287c});if(_0x46e560[_0xcfcdb0(0x197)]>THERMO_LOG_SIZE)_0x46e560[_0xcfcdb0(0x1a5)]();await _0xd03dfb[_0xcfcdb0(0x172)](_0xcfcdb0(0x18d),{'val':JSON[_0xcfcdb0(0x17c)](_0x46e560),'ack':!![]});}async function saveCompletedSequence(_0x1807a9){const _0x4e78ed=a5_0x4c4e;try{const _0x82c78c=await _0x1807a9[_0x4e78ed(0x182)](_0x4e78ed(0x1a9));let _0x53f42e=[];if(_0x82c78c&&_0x82c78c[_0x4e78ed(0x1b2)])try{_0x53f42e=JSON['parse'](_0x82c78c[_0x4e78ed(0x1b2)]);}catch(_0x37e22b){}const _0x50fe58=activeSequence[0x0]['ts'],_0x5e3977=activeSequence[_0x4e78ed(0x1ae)](_0x31fd7a=>({'loc':_0x31fd7a[_0x4e78ed(0x1c8)],'t_delta':Math[_0x4e78ed(0x16a)]((_0x31fd7a['ts']-_0x50fe58)/0x3e8)})),_0x39d07d={'timestamp':new Date(_0x50fe58)[_0x4e78ed(0x1b5)](),'steps':_0x5e3977,'duration':Math[_0x4e78ed(0x16a)]((activeSequence[activeSequence['length']-0x1]['ts']-_0x50fe58)/0x3e8),'daytime':new Date(_0x50fe58)[_0x4e78ed(0x176)]()};_0x53f42e[_0x4e78ed(0x1ca)](_0x39d07d);if(_0x53f42e[_0x4e78ed(0x197)]>MAX_TRAINING_SET_SIZE)_0x53f42e[_0x4e78ed(0x1a5)]();await _0x1807a9[_0x4e78ed(0x172)]('LTM.trainingData.sequences',{'val':JSON[_0x4e78ed(0x17c)](_0x53f42e),'ack':!![]}),_0x1807a9['isProVersion']&&_0x1807a9[_0x4e78ed(0x18b)]&&_0x1807a9['sendToPythonWrapper']('ANALYZE_SEQUENCE',{'sequence':_0x39d07d});}catch(_0x47e904){_0x1807a9[_0x4e78ed(0x1b9)][_0x4e78ed(0x1c6)](_0x4e78ed(0x196)+_0x47e904[_0x4e78ed(0x19a)]);}}async function recordSequence(_0x2f8dbe,_0x459b8f){const _0x1356e1=a5_0x4c4e,_0x3c9e35=(_0x459b8f['type']||'')[_0x1356e1(0x1c0)](),_0x4bc716=[_0x1356e1(0x171),_0x1356e1(0x169),_0x1356e1(0x184),'presence',_0x1356e1(0x16d),_0x1356e1(0x17a),_0x1356e1(0x18f),'window',_0x1356e1(0x160),_0x1356e1(0x1b3),_0x1356e1(0x16c),_0x1356e1(0x1bb),_0x1356e1(0x191),_0x1356e1(0x1a3),_0x1356e1(0x18e),_0x1356e1(0x17e),_0x1356e1(0x18a)];if(!_0x4bc716[_0x1356e1(0x1be)](_0x389c83=>_0x3c9e35[_0x1356e1(0x174)](_0x389c83)))return;if(!_0x459b8f[_0x1356e1(0x1ad)])return;if(sequenceTimer)clearTimeout(sequenceTimer);activeSequence[_0x1356e1(0x1ca)]({'loc':_0x459b8f[_0x1356e1(0x189)]||_0x1356e1(0x167),'id':_0x459b8f['id'],'ts':Date['now']()}),sequenceTimer=setTimeout(async()=>{if(activeSequence['length']>0x1)await saveCompletedSequence(_0x2f8dbe);activeSequence=[];},SEQUENCE_TIMEOUT_MS);}function a5_0x4c4e(_0x1962a4,_0x3ff7c6){const _0x15cf87=a5_0x28da();return a5_0x4c4e=function(_0xfc38c8,_0x214efe){_0xfc38c8=_0xfc38c8-0x15e;let _0x28da90=_0x15cf87[_0xfc38c8];return _0x28da90;},a5_0x4c4e(_0x1962a4,_0x3ff7c6);}function startExitTimer(_0xac5e22){const _0x4752f9=a5_0x4c4e;abortExitTimer(_0xac5e22),_0xac5e22[_0x4752f9(0x18c)]=!![],_0xac5e22[_0x4752f9(0x162)]=setTimeout(()=>{const _0x265337=_0x4752f9;_0xac5e22[_0x265337(0x18c)]=![];},EXIT_GRACE_PERIOD_SECONDS*0x3e8),_0xac5e22[_0x4752f9(0x190)]=setTimeout(()=>{const _0x191c48=_0x4752f9;setPresence(_0xac5e22,![]),_0xac5e22[_0x191c48(0x190)]=null;},EXIT_TIMER_MINUTES*0x3c*0x3e8);}function abortExitTimer(_0x488bae){const _0x4bb1b7=a5_0x4c4e;if(_0x488bae['exitTimer'])clearTimeout(_0x488bae['exitTimer']);if(_0x488bae['exitGraceTimer'])clearTimeout(_0x488bae[_0x4bb1b7(0x162)]);_0x488bae['exitTimer']=null,_0x488bae[_0x4bb1b7(0x162)]=null,_0x488bae[_0x4bb1b7(0x18c)]=![];}async function setPresence(_0x427de7,_0x1c0bee){const _0x568f38=a5_0x4c4e;if(_0x427de7[_0x568f38(0x1a0)]===_0x1c0bee)return;_0x427de7[_0x568f38(0x1a0)]=_0x1c0bee,await _0x427de7[_0x568f38(0x172)]('system.isPresent',{'val':_0x1c0bee,'ack':!![]});}async function processSensorEvent(_0xea7233,_0x46d226,_0x272aab,_0x58ca80){const _0x2947d5=a5_0x4c4e;if(!_0x58ca80)return null;const _0x57ff23=_0x272aab[_0x2947d5(0x1b2)],_0x3e9273=Date[_0x2947d5(0x19c)](),_0x2efb83=_0xea7233['sensorLastValues'][_0x46d226],_0x4eeba4=(_0x58ca80['type']||'')[_0x2947d5(0x1c0)](),_0x2674e2=_0x4eeba4[_0x2947d5(0x174)](_0x2947d5(0x1ba))||_0x4eeba4['includes'](_0x2947d5(0x1b1))||_0x4eeba4['includes'](_0x2947d5(0x181))||_0x4eeba4[_0x2947d5(0x174)](_0x2947d5(0x1c2))||_0x4eeba4[_0x2947d5(0x174)](_0x2947d5(0x1c4));if(_0x2674e2&&typeof _0x57ff23===_0x2947d5(0x19e)){if(_0x57ff23>0x50||_0x57ff23<-0x32)return _0xea7233[_0x2947d5(0x1b9)]['debug']('[RECORDER]\x20Ignored\x20implausible\x20temperature:\x20'+_0x57ff23+_0x2947d5(0x188)+_0x46d226),null;}_0xea7233[_0x2947d5(0x180)][_0x46d226]=_0x57ff23;if(!_0x58ca80[_0x2947d5(0x1a7)]&&_0x2efb83!=undefined&&_0x2efb83==_0x57ff23)return null;_0xea7233[_0x2947d5(0x161)]&&_0x2674e2&&recordThermodynamics(_0xea7233,_0x46d226,_0x57ff23,_0x58ca80[_0x2947d5(0x189)]);const _0x3399f2={'timestamp':_0x3e9273,'id':_0x46d226,'name':_0x58ca80[_0x2947d5(0x1b4)],'type':_0x58ca80[_0x2947d5(0x1aa)],'location':_0x58ca80['location'],'value':_0x57ff23};_0xea7233[_0x2947d5(0x1bc)][_0x2947d5(0x17d)](_0x3399f2);if(_0xea7233[_0x2947d5(0x1bc)][_0x2947d5(0x197)]>HISTORY_MAX_SIZE)_0xea7233[_0x2947d5(0x1bc)][_0x2947d5(0x1a6)]();await _0xea7233[_0x2947d5(0x172)](_0x2947d5(0x166),{'val':JSON['stringify'](_0x3399f2),'ack':!![]}),await _0xea7233[_0x2947d5(0x172)]('events.history',{'val':JSON['stringify'](_0xea7233[_0x2947d5(0x1bc)]),'ack':!![]});if(_0xea7233['isProVersion']){_0xea7233[_0x2947d5(0x15f)]['push'](_0x3399f2);if(_0xea7233[_0x2947d5(0x15f)][_0x2947d5(0x197)]>RAW_LOG_MAX_SIZE)_0xea7233[_0x2947d5(0x15f)][_0x2947d5(0x1c7)](0x0,_0xea7233[_0x2947d5(0x15f)][_0x2947d5(0x197)]-RAW_LOG_MAX_SIZE);await _0xea7233[_0x2947d5(0x172)](_0x2947d5(0x185),{'val':JSON[_0x2947d5(0x17c)](_0xea7233[_0x2947d5(0x15f)]),'ack':!![]}),recordSequence(_0xea7233,_0x3399f2);}if(_0x58ca80['isExit']&&_0x57ff23===!![]){if(_0xea7233['isPresent']&&!_0xea7233['isGracePeriodActive'])startExitTimer(_0xea7233);else{if(!_0xea7233[_0x2947d5(0x1a0)])setPresence(_0xea7233,!![]);}}else{if(_0x58ca80['type']==='motion'&&_0x57ff23===!![]){if(_0xea7233[_0x2947d5(0x190)])abortExitTimer(_0xea7233);if(!_0xea7233[_0x2947d5(0x1a0)]&&_0xea7233['currentSystemMode']==='normal')setPresence(_0xea7233,!![]);}}if(_0xea7233[_0x2947d5(0x161)]&&_0xea7233[_0x2947d5(0x18b)]){_0x58ca80[_0x2947d5(0x1aa)]==='motion'&&_0x57ff23===!![]&&_0x58ca80[_0x2947d5(0x189)]&&_0xea7233[_0x2947d5(0x18b)]('SIMULATE_SIGNAL',{'room':_0x58ca80['location']});const _0x3d58d9=[_0x2947d5(0x17a),_0x2947d5(0x18f),'window',_0x2947d5(0x160),_0x2947d5(0x195),_0x2947d5(0x1c9),_0x2947d5(0x1a8),_0x2947d5(0x1ac)][_0x2947d5(0x1be)](_0x31f8a8=>_0x4eeba4[_0x2947d5(0x174)](_0x31f8a8)),_0xc3f762=['light',_0x2947d5(0x191),_0x2947d5(0x1a3),'schalter',_0x2947d5(0x17e),_0x2947d5(0x18a)][_0x2947d5(0x1be)](_0x4dcb41=>_0x4eeba4['includes'](_0x4dcb41)),_0x599761=['motion',_0x2947d5(0x169),_0x2947d5(0x184),_0x2947d5(0x1b7),_0x2947d5(0x16d)][_0x2947d5(0x1be)](_0x9fa2f=>_0x4eeba4[_0x2947d5(0x174)](_0x9fa2f));if(_0x58ca80[_0x2947d5(0x189)]&&(_0x3d58d9||_0xc3f762||_0x599761)){const _0x4eba95=_0x57ff23===!![]||typeof _0x57ff23===_0x2947d5(0x19e)&&_0x57ff23>0x0,_0x22007f=_0x3d58d9&&!_0x4eba95&&_0x2efb83!==undefined&&_0x2efb83!=_0x57ff23;if(_0x4eba95||_0x22007f){const _0x245251=_0xea7233[_0x2947d5(0x194)]||_0x3e9273,_0xee3a2=(_0x3e9273-_0x245251)/0x3e8;_0xea7233['lastTrackerEventTime']=_0x3e9273,_0xea7233[_0x2947d5(0x18b)]('TRACK_EVENT',{'room':_0x58ca80[_0x2947d5(0x189)],'dt':_0xee3a2});}}}return _0x3399f2;}module[a5_0x26a0cf(0x1c1)]={'processSensorEvent':processSensorEvent,'getOutsideTemperatureNumeric':getOutsideTemperatureNumeric,'setPresence':setPresence,'abortExitTimer':abortExitTimer,'startExitTimer':startExitTimer};function a5_0x28da(){const _0xb40d1d=['length','apply','1026159OgWWWV','message','.LEVEL','now','.1.VALVE_STATE','number','config','isPresent','useWeather','string','switch','.1.LEVEL','shift','pop','logDuplicates','lock','LTM.trainingData.sequences','type','outdoorSensorId','schloss','value','map','getForeignStateAsync','accuweather','temperatur','val','contact','name','toISOString','from','presence','daswetter','log','temperature','light','eventHistory','.1.TEMPERATURE','some','170280RjhLcW','toLowerCase','exports','heizung','326740sfFrqL','thermostat','108kGiKPq','error','splice','loc','handle','push','33297aVBzHV','Temperature','rawEventLog','fenster','isProVersion','exitGraceTimer','parse','1876620mgFMlW','24RzPwsz','events.lastEvent','Unknown','toString','bewegung','round','search','kontakt','occupancy','weatherunderground','.ACTUAL_TEMPERATURE','8YXSGtI','motion','setStateAsync','level','includes','valveMapping','getHours','1313683xNcDZY','.1.ACTUAL_TEMPERATURE','Valve','door','.NextHours.Location_1.Day_1.current.temp_value','stringify','unshift','dimmer','.Current.Temperature','sensorLastValues','klima','getStateAsync','LEVEL','präsenz','LTM.rawEventLog','constructor','693280jABusW','\x20from\x20','location','lampe','sendToPythonWrapper','isGracePeriodActive','LTM.trainingData.thermodynamics','schalter','tür','exitTimer','licht','.forecast.current.temperature','STATE','lastTrackerEventTime','griff','[RECORDER]\x20Error:\x20'];a5_0x28da=function(){return _0xb40d1d;};return a5_0x28da();}