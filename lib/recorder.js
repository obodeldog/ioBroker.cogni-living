const a5_0x1af5ac=a5_0x331a;(function(_0x3fe645,_0x543dbe){const _0x375fae=a5_0x331a,_0x519340=_0x3fe645();while(!![]){try{const _0x178cf9=-parseInt(_0x375fae(0x197))/0x1+parseInt(_0x375fae(0x188))/0x2+parseInt(_0x375fae(0x198))/0x3+parseInt(_0x375fae(0x18c))/0x4+-parseInt(_0x375fae(0x1b5))/0x5+-parseInt(_0x375fae(0x1d3))/0x6+-parseInt(_0x375fae(0x1c8))/0x7*(-parseInt(_0x375fae(0x1c7))/0x8);if(_0x178cf9===_0x543dbe)break;else _0x519340['push'](_0x519340['shift']());}catch(_0x389b75){_0x519340['push'](_0x519340['shift']());}}}(a5_0x2e84,0x85944));const a5_0x432a06=(function(){let _0x18e4ca=!![];return function(_0x1bc729,_0x5e3e56){const _0x169727=_0x18e4ca?function(){const _0x30be98=a5_0x331a;if(_0x5e3e56){const _0x2a0689=_0x5e3e56[_0x30be98(0x1ca)](_0x1bc729,arguments);return _0x5e3e56=null,_0x2a0689;}}:function(){};return _0x18e4ca=![],_0x169727;};}()),a5_0x6ef4a6=a5_0x432a06(this,function(){const _0xa0c2a0=a5_0x331a;return a5_0x6ef4a6[_0xa0c2a0(0x1c6)]()['search']('(((.+)+)+)+$')['toString']()[_0xa0c2a0(0x1bc)](a5_0x6ef4a6)['search'](_0xa0c2a0(0x1d8));});a5_0x6ef4a6();'use strict';const HISTORY_MAX_SIZE=0x32,RAW_LOG_MAX_SIZE=0x9c4,THERMO_LOG_SIZE=0x3e8,SEQUENCE_TIMEOUT_MS=0x5*0x3c*0x3e8,MAX_TRAINING_SET_SIZE=0x1f4,EXIT_TIMER_MINUTES=0xf,EXIT_GRACE_PERIOD_SECONDS=0x1e;let activeSequence=[],sequenceTimer=null;async function getOutsideTemperatureNumeric(_0x52387d){const _0x3677fe=a5_0x331a;if(_0x52387d['config'][_0x3677fe(0x1cf)])try{const _0x1aa781=await _0x52387d[_0x3677fe(0x1eb)](_0x52387d[_0x3677fe(0x1ab)]['outdoorSensorId']);if(_0x1aa781&&_0x1aa781[_0x3677fe(0x1d2)]!==undefined&&_0x1aa781[_0x3677fe(0x1d2)]!==null)return parseFloat(_0x1aa781[_0x3677fe(0x1d2)]);}catch(_0x17a7ec){}const _0x27a0d5=_0x52387d[_0x3677fe(0x1ab)]['weatherInstance'];if(!_0x52387d[_0x3677fe(0x1ab)][_0x3677fe(0x1ad)]||!_0x27a0d5)return null;try{let _0xbd1f8d='';if(_0x27a0d5[_0x3677fe(0x19b)](_0x3677fe(0x1db)))_0xbd1f8d=_0x27a0d5+_0x3677fe(0x1c9);else{if(_0x27a0d5['includes'](_0x3677fe(0x1d9)))_0xbd1f8d=_0x27a0d5+_0x3677fe(0x18b);else{if(_0x27a0d5['includes'](_0x3677fe(0x1b0)))_0xbd1f8d=_0x27a0d5+_0x3677fe(0x1b1);else{if(_0x27a0d5['includes'](_0x3677fe(0x1e5)))_0xbd1f8d=_0x27a0d5+_0x3677fe(0x1ee);}}}if(_0xbd1f8d){const _0x79d3c6=await _0x52387d[_0x3677fe(0x1eb)](_0xbd1f8d);if(_0x79d3c6&&_0x79d3c6[_0x3677fe(0x1d2)]!==undefined&&_0x79d3c6[_0x3677fe(0x1d2)]!==null)return parseFloat(_0x79d3c6[_0x3677fe(0x1d2)]);}}catch(_0x557461){}return null;}function a5_0x331a(_0x55e432,_0x145068){const _0x5bc511=a5_0x2e84();return a5_0x331a=function(_0x6ef4a6,_0x432a06){_0x6ef4a6=_0x6ef4a6-0x188;let _0x2e845b=_0x5bc511[_0x6ef4a6];return _0x2e845b;},a5_0x331a(_0x55e432,_0x145068);}async function recordThermodynamics(_0x3168f5,_0x1ff846,_0x1a0d02,_0x558865){const _0xfe92b=a5_0x331a,_0xf3e57e=await getOutsideTemperatureNumeric(_0x3168f5);if(_0xf3e57e===null)return;let _0x44c381=0x0,_0x3a3359=![];if(_0x3168f5[_0xfe92b(0x1ab)][_0xfe92b(0x1bf)])try{let _0x710d28=_0x3168f5[_0xfe92b(0x1ab)][_0xfe92b(0x1bf)];if(typeof _0x710d28===_0xfe92b(0x18d))_0x710d28=JSON[_0xfe92b(0x1c1)](_0x710d28);if(_0x710d28[_0x1ff846]){const _0x237b88=_0x710d28[_0x1ff846],_0x441a11=await _0x3168f5[_0xfe92b(0x1eb)](_0x237b88);if(_0x441a11&&_0x441a11[_0xfe92b(0x1d2)]!==null&&_0x441a11[_0xfe92b(0x1d2)]!==undefined){let _0x5d019c=Number(_0x441a11['val']);if(_0x5d019c<=1.05&&!_0x237b88[_0xfe92b(0x19b)](_0xfe92b(0x1b8))&&!_0x237b88[_0xfe92b(0x19b)](_0xfe92b(0x1e7)))_0x5d019c=_0x5d019c*0x64;_0x44c381=Math[_0xfe92b(0x1bb)](_0x5d019c),_0x3a3359=!![];}}}catch(_0x2056d1){}if(!_0x3a3359){const _0x1e7212=[{'from':'.1.ACTUAL_TEMPERATURE','to':_0xfe92b(0x1e9)},{'from':_0xfe92b(0x1b7),'to':'.1.VALVE_STATE'},{'from':'.1.TEMPERATURE','to':_0xfe92b(0x1cd)},{'from':'.ACTUAL_TEMPERATURE','to':'.LEVEL'},{'from':_0xfe92b(0x1ce),'to':_0xfe92b(0x1cb)},{'from':_0xfe92b(0x1be),'to':_0xfe92b(0x1e8)}];for(const _0x27a031 of _0x1e7212){if(_0x1ff846['includes'](_0x27a031[_0xfe92b(0x18f)])){const _0x121d47=_0x1ff846[_0xfe92b(0x1e3)](_0x27a031[_0xfe92b(0x18f)],_0x27a031['to']);try{const _0x21a867=await _0x3168f5[_0xfe92b(0x1eb)](_0x121d47);if(_0x21a867&&_0x21a867[_0xfe92b(0x1d2)]!==null&&_0x21a867['val']!==undefined){let _0x1f8aab=Number(_0x21a867[_0xfe92b(0x1d2)]);if(typeof _0x1f8aab===_0xfe92b(0x1d0)){if(_0x1f8aab<=1.05&&_0x27a031['to'][_0xfe92b(0x19b)]('LEVEL'))_0x1f8aab=_0x1f8aab*0x64;_0x44c381=Math[_0xfe92b(0x1bb)](_0x1f8aab),_0x3a3359=!![];break;}}}catch(_0xa25b9f){}}}}const _0x39ad8b=await _0x3168f5[_0xfe92b(0x192)]('LTM.trainingData.thermodynamics');let _0x11cd39=[];if(_0x39ad8b&&_0x39ad8b[_0xfe92b(0x1d2)])try{_0x11cd39=JSON[_0xfe92b(0x1c1)](_0x39ad8b[_0xfe92b(0x1d2)]);}catch(_0x28bf26){}_0x11cd39['push']({'ts':Date['now'](),'room':_0x558865||_0xfe92b(0x1d6),'t_in':_0x1a0d02,'t_out':_0xf3e57e,'valve':_0x44c381});if(_0x11cd39[_0xfe92b(0x1b4)]>THERMO_LOG_SIZE)_0x11cd39[_0xfe92b(0x189)]();await _0x3168f5[_0xfe92b(0x1a6)](_0xfe92b(0x1d4),{'val':JSON[_0xfe92b(0x1e0)](_0x11cd39),'ack':!![]});}async function saveCompletedSequence(_0xe1e3f3){const _0x1da70b=a5_0x331a;try{const _0x3ffbc7=await _0xe1e3f3[_0x1da70b(0x192)](_0x1da70b(0x1cc));let _0x57526a=[];if(_0x3ffbc7&&_0x3ffbc7[_0x1da70b(0x1d2)])try{_0x57526a=JSON[_0x1da70b(0x1c1)](_0x3ffbc7[_0x1da70b(0x1d2)]);}catch(_0xa921ac){}const _0x43092c=activeSequence[0x0]['ts'],_0x2812fe=activeSequence[_0x1da70b(0x1ae)](_0x387457=>({'loc':_0x387457[_0x1da70b(0x1a2)],'t_delta':Math['round']((_0x387457['ts']-_0x43092c)/0x3e8)})),_0x57aeea={'timestamp':new Date(_0x43092c)['toISOString'](),'steps':_0x2812fe,'duration':Math['round']((activeSequence[activeSequence[_0x1da70b(0x1b4)]-0x1]['ts']-_0x43092c)/0x3e8),'daytime':new Date(_0x43092c)['getHours']()};_0x57526a[_0x1da70b(0x1af)](_0x57aeea);if(_0x57526a[_0x1da70b(0x1b4)]>MAX_TRAINING_SET_SIZE)_0x57526a[_0x1da70b(0x189)]();await _0xe1e3f3[_0x1da70b(0x1a6)](_0x1da70b(0x1cc),{'val':JSON[_0x1da70b(0x1e0)](_0x57526a),'ack':!![]}),_0xe1e3f3[_0x1da70b(0x1f2)]&&_0xe1e3f3[_0x1da70b(0x1dc)]&&_0xe1e3f3[_0x1da70b(0x1dc)](_0x1da70b(0x1e4),{'sequence':_0x57aeea});}catch(_0x1fb459){_0xe1e3f3['log'][_0x1da70b(0x1da)](_0x1da70b(0x1f1)+_0x1fb459[_0x1da70b(0x191)]);}}function a5_0x2e84(){const _0x121af1=['apply','level','LTM.trainingData.sequences','.4.VALVE_STATE','temperature','outdoorSensorId','number','tür','val','3746046sHIzfO','LTM.trainingData.thermodynamics','contact','Unknown','events.lastEvent','(((.+)+)+)+$','daswetter','error','accuweather','sendToPythonWrapper','light','location','griff','stringify','rawEventLog','heizung','replace','ANALYZE_SEQUENCE','weatherunderground','lampe','STATE','Valve','.1.LEVEL','system.isPresent','getForeignStateAsync','pop','value','.forecast.current.temp','exitGraceTimer','fenster','[RECORDER]\x20Error:\x20','isProVersion','1343568MYJWQu','shift','now','.NextHours.Location_1.Day_1.current.temp_value','2236312fADwnu','string','TRACK_EVENT','from','splice','message','getStateAsync','LTM.rawEventLog','motion','lastTrackerEventTime','schalter','1040875StzLxE','2699025pIvByU','toLowerCase','temperatur','includes','window','occupancy','thermostat','log','debug','präsenz','loc','switch','bewegung','name','setStateAsync','door','eventHistory','exports','some','config','isPresent','useWeather','map','push','openweathermap','.forecast.current.temperature','currentSystemMode','presence','length','4371810MyqBhu','dimmer','.1.ACTUAL_TEMPERATURE','STATUS','licht','exitTimer','round','constructor','handle','Temperature','valveMapping','isGracePeriodActive','parse','normal','kontakt','type','schloss','toString','8OVRHNn','6693267ZykWCe','.Current.Temperature'];a5_0x2e84=function(){return _0x121af1;};return a5_0x2e84();}async function recordSequence(_0x29e08f,_0x356173){const _0x4e7845=a5_0x331a,_0x4cacc5=(_0x356173[_0x4e7845(0x1c4)]||'')[_0x4e7845(0x199)](),_0xe591cd=[_0x4e7845(0x194),_0x4e7845(0x1a4),_0x4e7845(0x1a1),_0x4e7845(0x1b3),_0x4e7845(0x19d),_0x4e7845(0x1a7),_0x4e7845(0x1d1),_0x4e7845(0x19c),_0x4e7845(0x1f0),_0x4e7845(0x1d5),_0x4e7845(0x1c3),'light',_0x4e7845(0x1b9),_0x4e7845(0x1a3),_0x4e7845(0x196),_0x4e7845(0x1b6),_0x4e7845(0x1e6)];if(!_0xe591cd[_0x4e7845(0x1aa)](_0x456bb5=>_0x4cacc5[_0x4e7845(0x19b)](_0x456bb5)))return;if(!_0x356173[_0x4e7845(0x1ed)])return;if(sequenceTimer)clearTimeout(sequenceTimer);activeSequence['push']({'loc':_0x356173['location']||_0x4e7845(0x1d6),'id':_0x356173['id'],'ts':Date[_0x4e7845(0x18a)]()}),sequenceTimer=setTimeout(async()=>{if(activeSequence['length']>0x1)await saveCompletedSequence(_0x29e08f);activeSequence=[];},SEQUENCE_TIMEOUT_MS);}function startExitTimer(_0x46392f){const _0x2d4650=a5_0x331a;abortExitTimer(_0x46392f),_0x46392f['isGracePeriodActive']=!![],_0x46392f[_0x2d4650(0x1ef)]=setTimeout(()=>{_0x46392f['isGracePeriodActive']=![];},EXIT_GRACE_PERIOD_SECONDS*0x3e8),_0x46392f[_0x2d4650(0x1ba)]=setTimeout(()=>{const _0x27c292=_0x2d4650;setPresence(_0x46392f,![]),_0x46392f[_0x27c292(0x1ba)]=null;},EXIT_TIMER_MINUTES*0x3c*0x3e8);}function abortExitTimer(_0xec0de4){const _0x198090=a5_0x331a;if(_0xec0de4[_0x198090(0x1ba)])clearTimeout(_0xec0de4[_0x198090(0x1ba)]);if(_0xec0de4['exitGraceTimer'])clearTimeout(_0xec0de4['exitGraceTimer']);_0xec0de4[_0x198090(0x1ba)]=null,_0xec0de4['exitGraceTimer']=null,_0xec0de4['isGracePeriodActive']=![];}async function setPresence(_0x3fb780,_0x416415){const _0x39f0e0=a5_0x331a;if(_0x3fb780['isPresent']===_0x416415)return;_0x3fb780[_0x39f0e0(0x1ac)]=_0x416415,await _0x3fb780[_0x39f0e0(0x1a6)](_0x39f0e0(0x1ea),{'val':_0x416415,'ack':!![]});}async function processSensorEvent(_0x5bb06e,_0x38d0bf,_0x4dd3ce,_0x1018c9){const _0x40cfed=a5_0x331a;if(!_0x1018c9)return null;const _0x173509=_0x4dd3ce[_0x40cfed(0x1d2)],_0x184a08=Date[_0x40cfed(0x18a)](),_0x20406f=_0x5bb06e['sensorLastValues'][_0x38d0bf],_0x1eb5a3=(_0x1018c9[_0x40cfed(0x1c4)]||'')['toLowerCase'](),_0x35db44=_0x1eb5a3[_0x40cfed(0x19b)](_0x40cfed(0x1ce))||_0x1eb5a3[_0x40cfed(0x19b)](_0x40cfed(0x19a))||_0x1eb5a3[_0x40cfed(0x19b)]('klima')||_0x1eb5a3[_0x40cfed(0x19b)](_0x40cfed(0x1e2))||_0x1eb5a3[_0x40cfed(0x19b)](_0x40cfed(0x19e));if(_0x35db44&&typeof _0x173509===_0x40cfed(0x1d0)){if(_0x173509>0x50||_0x173509<-0x32)return _0x5bb06e[_0x40cfed(0x19f)][_0x40cfed(0x1a0)]('[RECORDER]\x20Ignored\x20implausible\x20temperature:\x20'+_0x173509+'\x20from\x20'+_0x38d0bf),null;}_0x5bb06e['sensorLastValues'][_0x38d0bf]=_0x173509;if(!_0x1018c9['logDuplicates']&&_0x20406f!=undefined&&_0x20406f==_0x173509)return null;_0x5bb06e[_0x40cfed(0x1f2)]&&_0x35db44&&recordThermodynamics(_0x5bb06e,_0x38d0bf,_0x173509,_0x1018c9[_0x40cfed(0x1de)]);const _0x3785c9={'timestamp':_0x184a08,'id':_0x38d0bf,'name':_0x1018c9[_0x40cfed(0x1a5)],'type':_0x1018c9['type'],'location':_0x1018c9[_0x40cfed(0x1de)],'value':_0x173509};_0x5bb06e['eventHistory']['unshift'](_0x3785c9);if(_0x5bb06e['eventHistory']['length']>HISTORY_MAX_SIZE)_0x5bb06e[_0x40cfed(0x1a8)][_0x40cfed(0x1ec)]();await _0x5bb06e['setStateAsync'](_0x40cfed(0x1d7),{'val':JSON['stringify'](_0x3785c9),'ack':!![]}),await _0x5bb06e['setStateAsync']('events.history',{'val':JSON['stringify'](_0x5bb06e[_0x40cfed(0x1a8)]),'ack':!![]});if(_0x5bb06e[_0x40cfed(0x1f2)]){_0x5bb06e[_0x40cfed(0x1e1)][_0x40cfed(0x1af)](_0x3785c9);if(_0x5bb06e[_0x40cfed(0x1e1)]['length']>RAW_LOG_MAX_SIZE)_0x5bb06e['rawEventLog'][_0x40cfed(0x190)](0x0,_0x5bb06e['rawEventLog'][_0x40cfed(0x1b4)]-RAW_LOG_MAX_SIZE);await _0x5bb06e[_0x40cfed(0x1a6)](_0x40cfed(0x193),{'val':JSON[_0x40cfed(0x1e0)](_0x5bb06e[_0x40cfed(0x1e1)]),'ack':!![]}),recordSequence(_0x5bb06e,_0x3785c9);}if(_0x1018c9['isExit']&&_0x173509===!![]){if(_0x5bb06e[_0x40cfed(0x1ac)]&&!_0x5bb06e[_0x40cfed(0x1c0)])startExitTimer(_0x5bb06e);else{if(!_0x5bb06e[_0x40cfed(0x1ac)])setPresence(_0x5bb06e,!![]);}}else{if(_0x1018c9[_0x40cfed(0x1c4)]===_0x40cfed(0x194)&&_0x173509===!![]){if(_0x5bb06e[_0x40cfed(0x1ba)])abortExitTimer(_0x5bb06e);if(!_0x5bb06e['isPresent']&&_0x5bb06e[_0x40cfed(0x1b2)]===_0x40cfed(0x1c2))setPresence(_0x5bb06e,!![]);}}if(_0x5bb06e[_0x40cfed(0x1f2)]&&_0x5bb06e[_0x40cfed(0x1dc)]){_0x1018c9[_0x40cfed(0x1c4)]===_0x40cfed(0x194)&&_0x173509===!![]&&_0x1018c9['location']&&_0x5bb06e['sendToPythonWrapper']('SIMULATE_SIGNAL',{'room':_0x1018c9[_0x40cfed(0x1de)]});const _0x5d519c=[_0x40cfed(0x1a7),_0x40cfed(0x1d1),_0x40cfed(0x19c),_0x40cfed(0x1f0),_0x40cfed(0x1df),_0x40cfed(0x1bd),'lock',_0x40cfed(0x1c5)][_0x40cfed(0x1aa)](_0x4d2dc4=>_0x1eb5a3[_0x40cfed(0x19b)](_0x4d2dc4)),_0x26f6f3=[_0x40cfed(0x1dd),_0x40cfed(0x1b9),'switch',_0x40cfed(0x196),_0x40cfed(0x1b6),_0x40cfed(0x1e6)][_0x40cfed(0x1aa)](_0x16311c=>_0x1eb5a3['includes'](_0x16311c)),_0x3e44d7=[_0x40cfed(0x194),'bewegung',_0x40cfed(0x1a1),_0x40cfed(0x1b3),_0x40cfed(0x19d)][_0x40cfed(0x1aa)](_0x41ae7c=>_0x1eb5a3[_0x40cfed(0x19b)](_0x41ae7c));if(_0x1018c9['location']&&(_0x5d519c||_0x26f6f3||_0x3e44d7)){const _0x31a351=_0x173509===!![]||typeof _0x173509===_0x40cfed(0x1d0)&&_0x173509>0x0,_0x18eb22=_0x5d519c&&!_0x31a351&&_0x20406f!==undefined&&_0x20406f!=_0x173509;if(_0x31a351||_0x18eb22){const _0x148ab4=_0x5bb06e[_0x40cfed(0x195)]||_0x184a08,_0x53d9a4=(_0x184a08-_0x148ab4)/0x3e8;_0x5bb06e[_0x40cfed(0x195)]=_0x184a08,_0x5bb06e[_0x40cfed(0x1dc)](_0x40cfed(0x18e),{'room':_0x1018c9['location'],'dt':_0x53d9a4});}}}return _0x3785c9;}module[a5_0x1af5ac(0x1a9)]={'processSensorEvent':processSensorEvent,'getOutsideTemperatureNumeric':getOutsideTemperatureNumeric,'setPresence':setPresence,'abortExitTimer':abortExitTimer,'startExitTimer':startExitTimer};