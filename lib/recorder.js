const a5_0x7e6efd=a5_0x38eb;(function(_0x349964,_0x4f1fff){const _0x4a639d=a5_0x38eb,_0xb19bc3=_0x349964();while(!![]){try{const _0x15c9bd=parseInt(_0x4a639d(0x111))/0x1+parseInt(_0x4a639d(0xec))/0x2+-parseInt(_0x4a639d(0xe9))/0x3+parseInt(_0x4a639d(0x14c))/0x4*(-parseInt(_0x4a639d(0x107))/0x5)+-parseInt(_0x4a639d(0x14d))/0x6*(-parseInt(_0x4a639d(0x13b))/0x7)+-parseInt(_0x4a639d(0x139))/0x8+parseInt(_0x4a639d(0xf8))/0x9;if(_0x15c9bd===_0x4f1fff)break;else _0xb19bc3['push'](_0xb19bc3['shift']());}catch(_0x1cfc27){_0xb19bc3['push'](_0xb19bc3['shift']());}}}(a5_0xe89d,0x239a3));const a5_0x1d4b0e=(function(){let _0x3f3697=!![];return function(_0x5113e0,_0x120847){const _0x760829=_0x3f3697?function(){const _0x365b11=a5_0x38eb;if(_0x120847){const _0x24a8b9=_0x120847[_0x365b11(0x133)](_0x5113e0,arguments);return _0x120847=null,_0x24a8b9;}}:function(){};return _0x3f3697=![],_0x760829;};}()),a5_0x5080b3=a5_0x1d4b0e(this,function(){const _0x30427a=a5_0x38eb;return a5_0x5080b3['toString']()[_0x30427a(0x12f)](_0x30427a(0x10f))[_0x30427a(0x109)]()['constructor'](a5_0x5080b3)[_0x30427a(0x12f)](_0x30427a(0x10f));});a5_0x5080b3();'use strict';const HISTORY_MAX_SIZE=0x32,RAW_LOG_MAX_SIZE=0x9c4,THERMO_LOG_SIZE=0x3e8,SEQUENCE_TIMEOUT_MS=0x5*0x3c*0x3e8,MAX_TRAINING_SET_SIZE=0x1f4,EXIT_TIMER_MINUTES=0xf,EXIT_GRACE_PERIOD_SECONDS=0x1e;let activeSequence=[],sequenceTimer=null;async function getOutsideTemperatureNumeric(_0x2bd9c3){const _0x258982=a5_0x38eb;if(_0x2bd9c3[_0x258982(0x104)][_0x258982(0x10a)])try{const _0x5657f5=await _0x2bd9c3[_0x258982(0x134)](_0x2bd9c3['config'][_0x258982(0x10a)]);if(_0x5657f5&&_0x5657f5[_0x258982(0xe8)]!==undefined&&_0x5657f5[_0x258982(0xe8)]!==null)return parseFloat(_0x5657f5[_0x258982(0xe8)]);}catch(_0xe51db8){}const _0x1727d3=_0x2bd9c3['config']['weatherInstance'];if(!_0x2bd9c3[_0x258982(0x104)][_0x258982(0x113)]||!_0x1727d3)return null;try{let _0x4b3d8a='';if(_0x1727d3[_0x258982(0xef)](_0x258982(0x11f)))_0x4b3d8a=_0x1727d3+'.Current.Temperature';else{if(_0x1727d3[_0x258982(0xef)](_0x258982(0x146)))_0x4b3d8a=_0x1727d3+_0x258982(0x11b);else{if(_0x1727d3[_0x258982(0xef)]('openweathermap'))_0x4b3d8a=_0x1727d3+_0x258982(0x10d);else{if(_0x1727d3[_0x258982(0xef)](_0x258982(0x138)))_0x4b3d8a=_0x1727d3+_0x258982(0x136);}}}if(_0x4b3d8a){const _0x36d0f6=await _0x2bd9c3[_0x258982(0x134)](_0x4b3d8a);if(_0x36d0f6&&_0x36d0f6[_0x258982(0xe8)]!==undefined&&_0x36d0f6['val']!==null)return parseFloat(_0x36d0f6['val']);}}catch(_0x210af7){}return null;}async function recordThermodynamics(_0x5c4876,_0x1e11d3,_0x5c8946,_0x134d5e){const _0x6e832b=a5_0x38eb,_0x4645a=await getOutsideTemperatureNumeric(_0x5c4876);if(_0x4645a===null)return;let _0xa36fd7=0x0,_0x378f2e=![];if(_0x5c4876['config']['valveMapping'])try{let _0x202a35=_0x5c4876[_0x6e832b(0x104)][_0x6e832b(0x137)];if(typeof _0x202a35===_0x6e832b(0x108))_0x202a35=JSON['parse'](_0x202a35);if(_0x202a35[_0x1e11d3]){const _0x47f195=_0x202a35[_0x1e11d3],_0x4efb9e=await _0x5c4876[_0x6e832b(0x134)](_0x47f195);if(_0x4efb9e&&_0x4efb9e[_0x6e832b(0xe8)]!==null&&_0x4efb9e[_0x6e832b(0xe8)]!==undefined){let _0x37baee=Number(_0x4efb9e[_0x6e832b(0xe8)]);if(_0x37baee<=1.05&&!_0x47f195['includes'](_0x6e832b(0xe5))&&!_0x47f195[_0x6e832b(0xef)](_0x6e832b(0x119)))_0x37baee=_0x37baee*0x64;_0xa36fd7=Math[_0x6e832b(0x131)](_0x37baee),_0x378f2e=!![];}}}catch(_0x3ce6d0){}if(!_0x378f2e){const _0x3eac00=[{'from':_0x6e832b(0xe1),'to':'.1.LEVEL'},{'from':'.1.ACTUAL_TEMPERATURE','to':_0x6e832b(0x12b)},{'from':_0x6e832b(0xf6),'to':'.4.VALVE_STATE'},{'from':_0x6e832b(0xf1),'to':_0x6e832b(0x130)},{'from':_0x6e832b(0x102),'to':_0x6e832b(0x114)},{'from':_0x6e832b(0x142),'to':_0x6e832b(0xf2)}];for(const _0x5925bb of _0x3eac00){if(_0x1e11d3[_0x6e832b(0xef)](_0x5925bb[_0x6e832b(0x13e)])){const _0x390b15=_0x1e11d3['replace'](_0x5925bb['from'],_0x5925bb['to']);try{const _0xed5f2c=await _0x5c4876['getForeignStateAsync'](_0x390b15);if(_0xed5f2c&&_0xed5f2c[_0x6e832b(0xe8)]!==null&&_0xed5f2c[_0x6e832b(0xe8)]!==undefined){let _0x3bc8ff=Number(_0xed5f2c[_0x6e832b(0xe8)]);if(typeof _0x3bc8ff===_0x6e832b(0x118)){if(_0x3bc8ff<=1.05&&_0x5925bb['to'][_0x6e832b(0xef)](_0x6e832b(0x13f)))_0x3bc8ff=_0x3bc8ff*0x64;_0xa36fd7=Math[_0x6e832b(0x131)](_0x3bc8ff),_0x378f2e=!![];break;}}}catch(_0x57fa54){}}}}const _0x37a59a=await _0x5c4876[_0x6e832b(0xff)]('LTM.trainingData.thermodynamics');let _0x45e6bb=[];if(_0x37a59a&&_0x37a59a[_0x6e832b(0xe8)])try{_0x45e6bb=JSON[_0x6e832b(0x126)](_0x37a59a[_0x6e832b(0xe8)]);}catch(_0x1d1718){}_0x45e6bb[_0x6e832b(0xfb)]({'ts':Date[_0x6e832b(0xeb)](),'room':_0x134d5e||_0x6e832b(0x12d),'t_in':_0x5c8946,'t_out':_0x4645a,'valve':_0xa36fd7});if(_0x45e6bb[_0x6e832b(0x140)]>THERMO_LOG_SIZE)_0x45e6bb[_0x6e832b(0x132)]();await _0x5c4876[_0x6e832b(0x110)](_0x6e832b(0x127),{'val':JSON[_0x6e832b(0x12c)](_0x45e6bb),'ack':!![]});}async function saveCompletedSequence(_0x3b0763){const _0x4aa322=a5_0x38eb;try{const _0x585094=await _0x3b0763[_0x4aa322(0xff)](_0x4aa322(0x115));let _0x1b3a4e=[];if(_0x585094&&_0x585094['val'])try{_0x1b3a4e=JSON[_0x4aa322(0x126)](_0x585094['val']);}catch(_0x309ace){}const _0x25b70b=activeSequence[0x0]['ts'],_0x59eba6=activeSequence[_0x4aa322(0xde)](_0x307f6e=>({'loc':_0x307f6e[_0x4aa322(0x12a)],'t_delta':Math[_0x4aa322(0x131)]((_0x307f6e['ts']-_0x25b70b)/0x3e8)})),_0x38e88d={'timestamp':new Date(_0x25b70b)[_0x4aa322(0x106)](),'steps':_0x59eba6,'duration':Math[_0x4aa322(0x131)]((activeSequence[activeSequence['length']-0x1]['ts']-_0x25b70b)/0x3e8),'daytime':new Date(_0x25b70b)[_0x4aa322(0xee)]()};_0x1b3a4e[_0x4aa322(0xfb)](_0x38e88d);if(_0x1b3a4e[_0x4aa322(0x140)]>MAX_TRAINING_SET_SIZE)_0x1b3a4e[_0x4aa322(0x132)]();await _0x3b0763[_0x4aa322(0x110)](_0x4aa322(0x115),{'val':JSON[_0x4aa322(0x12c)](_0x1b3a4e),'ack':!![]}),_0x3b0763[_0x4aa322(0x14b)]&&_0x3b0763[_0x4aa322(0xfe)]&&_0x3b0763[_0x4aa322(0xfe)]('ANALYZE_SEQUENCE',{'sequence':_0x38e88d});}catch(_0x492b72){_0x3b0763['log'][_0x4aa322(0x143)](_0x4aa322(0x13c)+_0x492b72[_0x4aa322(0xfd)]);}}async function recordSequence(_0x133f7e,_0x403f4f){const _0x5a0c06=a5_0x38eb,_0x4d3a10=(_0x403f4f[_0x5a0c06(0x13d)]||'')[_0x5a0c06(0x121)](),_0x7b826f=[_0x5a0c06(0x124),_0x5a0c06(0x10c),'pr채senz','presence','occupancy',_0x5a0c06(0xd9),'t체r','window',_0x5a0c06(0xf9),_0x5a0c06(0xe0),_0x5a0c06(0x103),_0x5a0c06(0xf5),_0x5a0c06(0xe3),_0x5a0c06(0xe4),_0x5a0c06(0x13a),_0x5a0c06(0xdc),_0x5a0c06(0xe2)];if(!_0x7b826f[_0x5a0c06(0x10b)](_0x56207d=>_0x4d3a10[_0x5a0c06(0xef)](_0x56207d)))return;if(!_0x403f4f[_0x5a0c06(0x101)])return;if(sequenceTimer)clearTimeout(sequenceTimer);activeSequence[_0x5a0c06(0xfb)]({'loc':_0x403f4f[_0x5a0c06(0x147)]||_0x5a0c06(0x12d),'id':_0x403f4f['id'],'ts':Date[_0x5a0c06(0xeb)]()}),sequenceTimer=setTimeout(async()=>{if(activeSequence['length']>0x1)await saveCompletedSequence(_0x133f7e);activeSequence=[];},SEQUENCE_TIMEOUT_MS);}function startExitTimer(_0x29cbd0){const _0x5dd3bd=a5_0x38eb;abortExitTimer(_0x29cbd0),_0x29cbd0['isGracePeriodActive']=!![],_0x29cbd0[_0x5dd3bd(0xed)]=setTimeout(()=>{const _0x28fb71=_0x5dd3bd;_0x29cbd0[_0x28fb71(0x129)]=![];},EXIT_GRACE_PERIOD_SECONDS*0x3e8),_0x29cbd0[_0x5dd3bd(0x112)]=setTimeout(()=>{const _0x2ca575=_0x5dd3bd;setPresence(_0x29cbd0,![]),_0x29cbd0[_0x2ca575(0x112)]=null;},EXIT_TIMER_MINUTES*0x3c*0x3e8);}function abortExitTimer(_0x5ad5f1){const _0x4ea0b5=a5_0x38eb;if(_0x5ad5f1['exitTimer'])clearTimeout(_0x5ad5f1[_0x4ea0b5(0x112)]);if(_0x5ad5f1[_0x4ea0b5(0xed)])clearTimeout(_0x5ad5f1[_0x4ea0b5(0xed)]);_0x5ad5f1[_0x4ea0b5(0x112)]=null,_0x5ad5f1['exitGraceTimer']=null,_0x5ad5f1[_0x4ea0b5(0x129)]=![];}async function setPresence(_0x57cc35,_0x2ae3a2){const _0x2eba76=a5_0x38eb;if(_0x57cc35[_0x2eba76(0xe7)]===_0x2ae3a2)return;_0x57cc35['isPresent']=_0x2ae3a2,await _0x57cc35[_0x2eba76(0x110)]('system.isPresent',{'val':_0x2ae3a2,'ack':!![]});}async function updateHourlyActivity(_0x4c4404){const _0x264c46=a5_0x38eb;let _0xfb51cd=new Array(0x18)[_0x264c46(0x10e)](0x0),_0x51b1e9=0x0;try{const _0x14e374=await _0x4c4404[_0x264c46(0xff)]('analysis.health.todayVector');_0x14e374&&_0x14e374[_0x264c46(0xe8)]&&(_0xfb51cd=JSON['parse'](_0x14e374[_0x264c46(0xe8)]),_0x51b1e9=_0x14e374['ts']);}catch(_0x361e7e){}const _0x2a6cb1=new Date(_0x51b1e9),_0x2eb93e=new Date();_0x2a6cb1['getDate']()!==_0x2eb93e[_0x264c46(0x128)]()&&(_0xfb51cd=new Array(0x18)[_0x264c46(0x10e)](0x0));const _0x4a346f=_0x2eb93e[_0x264c46(0xee)]();if(_0xfb51cd[_0x4a346f]===undefined)_0xfb51cd[_0x4a346f]=0x0;_0xfb51cd[_0x4a346f]++,await _0x4c4404[_0x264c46(0x110)](_0x264c46(0xf3),{'val':JSON[_0x264c46(0x12c)](_0xfb51cd),'ack':!![]});}function a5_0x38eb(_0x137f8f,_0x5c8e10){const _0x404be6=a5_0xe89d();return a5_0x38eb=function(_0x5080b3,_0x1d4b0e){_0x5080b3=_0x5080b3-0xd9;let _0xe89dda=_0x404be6[_0x5080b3];return _0xe89dda;},a5_0x38eb(_0x137f8f,_0x5c8e10);}function a5_0xe89d(){const _0x1066e7=['exports','dimmer','temperatur','map','SIMULATE_SIGNAL','contact','.1.ACTUAL_TEMPERATURE','lampe','licht','switch','STATUS','unshift','isPresent','val','860559CuLPOX','log','now','404798fpYmUp','exitGraceTimer','getHours','includes','LTM.rawEventLog','.ACTUAL_TEMPERATURE','Valve','analysis.health.todayVector','heizung','light','.1.TEMPERATURE','eventHistory','1343808WqAKUQ','fenster','normal','push','name','message','sendToPythonWrapper','getStateAsync','window','value','temperature','kontakt','config','schloss','toISOString','48385lWEVXO','string','toString','outdoorSensorId','some','bewegung','.forecast.current.temperature','fill','(((.+)+)+)+$','setStateAsync','262992eBDmHd','exitTimer','useWeather','level','LTM.trainingData.sequences','[RECORDER]\x20Ignored\x20implausible\x20temperature:\x20','sensorLastValues','number','STATE','TRACK_EVENT','.NextHours.Location_1.Day_1.current.temp_value','events.lastEvent','rawEventLog','events.history','accuweather','handle','toLowerCase','thermostat','griff','motion','splice','parse','LTM.trainingData.thermodynamics','getDate','isGracePeriodActive','loc','.1.VALVE_STATE','stringify','Unknown','klima','search','.LEVEL','round','shift','apply','getForeignStateAsync','\x20from\x20','.forecast.current.temp','valveMapping','weatherunderground','2235464vKAOWh','schalter','7aCjDQU','[RECORDER]\x20Error:\x20','type','from','LEVEL','length','pr채senz','Temperature','error','t체r','presence','daswetter','location','debug','lastTrackerEventTime','currentSystemMode','isProVersion','36UgTfre','1107018KFhZwT','door','occupancy'];a5_0xe89d=function(){return _0x1066e7;};return a5_0xe89d();}async function processSensorEvent(_0x4b68a5,_0x298ce7,_0x564366,_0x1b36d7){const _0x517c3c=a5_0x38eb;if(!_0x1b36d7)return null;const _0x122408=_0x564366['val'],_0xf8d532=Date['now'](),_0x13ca56=_0x4b68a5['sensorLastValues'][_0x298ce7],_0x57a97e=(_0x1b36d7['type']||'')[_0x517c3c(0x121)](),_0x2b0168=_0x57a97e[_0x517c3c(0xef)](_0x517c3c(0x102))||_0x57a97e[_0x517c3c(0xef)](_0x517c3c(0xdd))||_0x57a97e[_0x517c3c(0xef)](_0x517c3c(0x12e))||_0x57a97e['includes'](_0x517c3c(0xf4))||_0x57a97e[_0x517c3c(0xef)](_0x517c3c(0x122));if(_0x2b0168&&typeof _0x122408===_0x517c3c(0x118)){if(_0x122408>0x50||_0x122408<-0x32)return _0x4b68a5[_0x517c3c(0xea)][_0x517c3c(0x148)](_0x517c3c(0x116)+_0x122408+_0x517c3c(0x135)+_0x298ce7),null;}_0x4b68a5[_0x517c3c(0x117)][_0x298ce7]=_0x122408;if(!_0x1b36d7['logDuplicates']&&_0x13ca56!=undefined&&_0x13ca56==_0x122408)return null;_0x4b68a5[_0x517c3c(0x14b)]&&_0x2b0168&&recordThermodynamics(_0x4b68a5,_0x298ce7,_0x122408,_0x1b36d7[_0x517c3c(0x147)]);const _0xf48405={'timestamp':_0xf8d532,'id':_0x298ce7,'name':_0x1b36d7[_0x517c3c(0xfc)],'type':_0x1b36d7['type'],'location':_0x1b36d7[_0x517c3c(0x147)],'value':_0x122408};_0x4b68a5['eventHistory'][_0x517c3c(0xe6)](_0xf48405);if(_0x4b68a5['eventHistory'][_0x517c3c(0x140)]>HISTORY_MAX_SIZE)_0x4b68a5['eventHistory']['pop']();await _0x4b68a5[_0x517c3c(0x110)](_0x517c3c(0x11c),{'val':JSON[_0x517c3c(0x12c)](_0xf48405),'ack':!![]}),await _0x4b68a5[_0x517c3c(0x110)](_0x517c3c(0x11e),{'val':JSON[_0x517c3c(0x12c)](_0x4b68a5[_0x517c3c(0xf7)]),'ack':!![]}),await updateHourlyActivity(_0x4b68a5);if(_0x4b68a5['isProVersion']){_0x4b68a5[_0x517c3c(0x11d)][_0x517c3c(0xfb)](_0xf48405);if(_0x4b68a5['rawEventLog'][_0x517c3c(0x140)]>RAW_LOG_MAX_SIZE)_0x4b68a5[_0x517c3c(0x11d)][_0x517c3c(0x125)](0x0,_0x4b68a5[_0x517c3c(0x11d)]['length']-RAW_LOG_MAX_SIZE);await _0x4b68a5[_0x517c3c(0x110)](_0x517c3c(0xf0),{'val':JSON[_0x517c3c(0x12c)](_0x4b68a5[_0x517c3c(0x11d)]),'ack':!![]}),recordSequence(_0x4b68a5,_0xf48405);}if(_0x1b36d7['isExit']&&_0x122408===!![]){if(_0x4b68a5[_0x517c3c(0xe7)]&&!_0x4b68a5[_0x517c3c(0x129)])startExitTimer(_0x4b68a5);else{if(!_0x4b68a5[_0x517c3c(0xe7)])setPresence(_0x4b68a5,!![]);}}else{if(_0x1b36d7['type']===_0x517c3c(0x124)&&_0x122408===!![]){if(_0x4b68a5[_0x517c3c(0x112)])abortExitTimer(_0x4b68a5);if(!_0x4b68a5[_0x517c3c(0xe7)]&&_0x4b68a5[_0x517c3c(0x14a)]===_0x517c3c(0xfa))setPresence(_0x4b68a5,!![]);}}if(_0x4b68a5[_0x517c3c(0x14b)]&&_0x4b68a5['sendToPythonWrapper']){_0x1b36d7[_0x517c3c(0x13d)]===_0x517c3c(0x124)&&_0x122408===!![]&&_0x1b36d7[_0x517c3c(0x147)]&&_0x4b68a5[_0x517c3c(0xfe)](_0x517c3c(0xdf),{'room':_0x1b36d7['location']});const _0x244b7e=['door',_0x517c3c(0x144),_0x517c3c(0x100),'fenster',_0x517c3c(0x123),_0x517c3c(0x120),'lock',_0x517c3c(0x105)][_0x517c3c(0x10b)](_0x505642=>_0x57a97e[_0x517c3c(0xef)](_0x505642)),_0x2888a1=[_0x517c3c(0xf5),_0x517c3c(0xe3),_0x517c3c(0xe4),_0x517c3c(0x13a),'dimmer',_0x517c3c(0xe2)]['some'](_0x45c214=>_0x57a97e[_0x517c3c(0xef)](_0x45c214)),_0x196c28=[_0x517c3c(0x124),_0x517c3c(0x10c),_0x517c3c(0x141),_0x517c3c(0x145),_0x517c3c(0xda)][_0x517c3c(0x10b)](_0x30684e=>_0x57a97e['includes'](_0x30684e));if(_0x1b36d7[_0x517c3c(0x147)]&&(_0x244b7e||_0x2888a1||_0x196c28)){const _0x5d076d=_0x122408===!![]||typeof _0x122408==='number'&&_0x122408>0x0,_0x321daa=_0x244b7e&&!_0x5d076d&&_0x13ca56!==undefined&&_0x13ca56!=_0x122408;if(_0x5d076d||_0x321daa){const _0x308e07=_0x4b68a5[_0x517c3c(0x149)]||_0xf8d532,_0x1d70be=(_0xf8d532-_0x308e07)/0x3e8;_0x4b68a5[_0x517c3c(0x149)]=_0xf8d532,_0x4b68a5[_0x517c3c(0xfe)](_0x517c3c(0x11a),{'room':_0x1b36d7['location'],'dt':_0x1d70be});}}}return _0xf48405;}module[a5_0x7e6efd(0xdb)]={'processSensorEvent':processSensorEvent,'getOutsideTemperatureNumeric':getOutsideTemperatureNumeric,'setPresence':setPresence,'abortExitTimer':abortExitTimer,'startExitTimer':startExitTimer};