const a5_0x16d7a8=a5_0x3be8;(function(_0x47f442,_0x2c2d48){const _0x19951b=a5_0x3be8,_0x34d255=_0x47f442();while(!![]){try{const _0x21d9f5=parseInt(_0x19951b(0x236))/0x1*(-parseInt(_0x19951b(0x237))/0x2)+parseInt(_0x19951b(0x212))/0x3+parseInt(_0x19951b(0x210))/0x4+-parseInt(_0x19951b(0x251))/0x5+-parseInt(_0x19951b(0x249))/0x6*(parseInt(_0x19951b(0x21f))/0x7)+parseInt(_0x19951b(0x215))/0x8*(parseInt(_0x19951b(0x232))/0x9)+-parseInt(_0x19951b(0x22d))/0xa*(-parseInt(_0x19951b(0x244))/0xb);if(_0x21d9f5===_0x2c2d48)break;else _0x34d255['push'](_0x34d255['shift']());}catch(_0x1b9d80){_0x34d255['push'](_0x34d255['shift']());}}}(a5_0x400e,0xdfe56));const a5_0x5604fa=(function(){let _0x1c2c3e=!![];return function(_0x23e080,_0x44a92b){const _0x189e61=_0x1c2c3e?function(){const _0x4958f0=a5_0x3be8;if(_0x44a92b){const _0x1ef586=_0x44a92b[_0x4958f0(0x25c)](_0x23e080,arguments);return _0x44a92b=null,_0x1ef586;}}:function(){};return _0x1c2c3e=![],_0x189e61;};}()),a5_0x1a4aa4=a5_0x5604fa(this,function(){const _0x41424e=a5_0x3be8;return a5_0x1a4aa4[_0x41424e(0x200)]()[_0x41424e(0x242)](_0x41424e(0x209))[_0x41424e(0x200)]()[_0x41424e(0x255)](a5_0x1a4aa4)[_0x41424e(0x242)](_0x41424e(0x209));});a5_0x1a4aa4();'use strict';const HISTORY_MAX_SIZE=0x32,RAW_LOG_MAX_SIZE=0x9c4,THERMO_LOG_SIZE=0x3e8,SEQUENCE_TIMEOUT_MS=0x5*0x3c*0x3e8,MAX_TRAINING_SET_SIZE=0x1f4,EXIT_TIMER_MINUTES=0xf,EXIT_GRACE_PERIOD_SECONDS=0x1e;let activeSequence=[],sequenceTimer=null;function a5_0x400e(){const _0x4cb06b=['isPresent','LEVEL','46971bxFgib','string','isGracePeriodActive','temperatur','17jEydQv','94466bOOlVW','tür','config','error','parse','temperature','exitTimer','[RECORDER]\x20Error:\x20','now','val','logDuplicates','search','location','11evOmjU','LTM.rawEventLog','isProVersion','eventHistory','some','9557904CNCcKw','setStateAsync','.1.LEVEL','[RECORDER]\x20Ignored\x20implausible\x20temperature:\x20','sendToPythonWrapper','pop','from','window','7244720JNDeKD','isExit','includes','fenster','constructor','useWeather','daswetter','thermostat','motion','.forecast.current.temperature','.1.VALVE_STATE','apply','sensorLastValues','type','lampe','kontakt','rawEventLog','dimmer','round','shift','occupancy','name','präsenz','presence','log','heizung','normal','klima','toISOString','push','toString','system.isPresent','Valve','toLowerCase','splice','TRACK_EVENT','number','level','length','(((.+)+)+)+$','schalter','lock','lastTrackerEventTime','schloss','.1.TEMPERATURE','message','187344DniGPY','contact','1551345dRNfPs','licht','.LEVEL','48Bkiote','getStateAsync','LTM.trainingData.sequences','map','Unknown','exports','.forecast.current.temp','.1.ACTUAL_TEMPERATURE','getForeignStateAsync','door','7roEHsX','light','.4.VALVE_STATE','openweathermap','weatherInstance','loc','handle','\x20from\x20','exitGraceTimer','stringify','events.lastEvent','LTM.trainingData.thermodynamics','bewegung','outdoorSensorId','41667020EStaLK','STATUS','replace'];a5_0x400e=function(){return _0x4cb06b;};return a5_0x400e();}async function getOutsideTemperatureNumeric(_0x2bb61b){const _0x17dd6b=a5_0x3be8;if(_0x2bb61b[_0x17dd6b(0x239)]['outdoorSensorId'])try{const _0x22e381=await _0x2bb61b['getForeignStateAsync'](_0x2bb61b[_0x17dd6b(0x239)][_0x17dd6b(0x22c)]);if(_0x22e381&&_0x22e381[_0x17dd6b(0x240)]!==undefined&&_0x22e381[_0x17dd6b(0x240)]!==null)return parseFloat(_0x22e381['val']);}catch(_0x3a0da2){}const _0x36562a=_0x2bb61b[_0x17dd6b(0x239)][_0x17dd6b(0x223)];if(!_0x2bb61b[_0x17dd6b(0x239)][_0x17dd6b(0x256)]||!_0x36562a)return null;try{let _0x43b5b9='';if(_0x36562a['includes']('accuweather'))_0x43b5b9=_0x36562a+'.Current.Temperature';else{if(_0x36562a[_0x17dd6b(0x253)](_0x17dd6b(0x257)))_0x43b5b9=_0x36562a+'.NextHours.Location_1.Day_1.current.temp_value';else{if(_0x36562a[_0x17dd6b(0x253)](_0x17dd6b(0x222)))_0x43b5b9=_0x36562a+_0x17dd6b(0x25a);else{if(_0x36562a[_0x17dd6b(0x253)]('weatherunderground'))_0x43b5b9=_0x36562a+_0x17dd6b(0x21b);}}}if(_0x43b5b9){const _0x4fa5f1=await _0x2bb61b[_0x17dd6b(0x21d)](_0x43b5b9);if(_0x4fa5f1&&_0x4fa5f1[_0x17dd6b(0x240)]!==undefined&&_0x4fa5f1[_0x17dd6b(0x240)]!==null)return parseFloat(_0x4fa5f1[_0x17dd6b(0x240)]);}}catch(_0xa1114){}return null;}async function recordThermodynamics(_0x167c28,_0x238285,_0x55d3cf,_0x1aa908){const _0x19821a=a5_0x3be8,_0x2b39db=await getOutsideTemperatureNumeric(_0x167c28);if(_0x2b39db===null)return;let _0x5f00c9=0x0,_0x283720=![];if(_0x167c28[_0x19821a(0x239)]['valveMapping'])try{let _0x1610cf=_0x167c28[_0x19821a(0x239)]['valveMapping'];if(typeof _0x1610cf===_0x19821a(0x233))_0x1610cf=JSON[_0x19821a(0x23b)](_0x1610cf);if(_0x1610cf[_0x238285]){const _0x35d8dc=_0x1610cf[_0x238285],_0x8f2c01=await _0x167c28[_0x19821a(0x21d)](_0x35d8dc);if(_0x8f2c01&&_0x8f2c01[_0x19821a(0x240)]!==null&&_0x8f2c01['val']!==undefined){let _0x121bbb=Number(_0x8f2c01['val']);if(_0x121bbb<=1.05&&!_0x35d8dc['includes'](_0x19821a(0x22e))&&!_0x35d8dc['includes']('STATE'))_0x121bbb=_0x121bbb*0x64;_0x5f00c9=Math[_0x19821a(0x1f4)](_0x121bbb),_0x283720=!![];}}}catch(_0x1b415f){}if(!_0x283720){const _0x5b32aa=[{'from':_0x19821a(0x21c),'to':_0x19821a(0x24b)},{'from':_0x19821a(0x21c),'to':_0x19821a(0x25b)},{'from':_0x19821a(0x20e),'to':_0x19821a(0x221)},{'from':'.ACTUAL_TEMPERATURE','to':_0x19821a(0x214)},{'from':_0x19821a(0x23c),'to':_0x19821a(0x207)},{'from':'Temperature','to':_0x19821a(0x202)}];for(const _0x1e30b1 of _0x5b32aa){if(_0x238285['includes'](_0x1e30b1[_0x19821a(0x24f)])){const _0xfe84b9=_0x238285[_0x19821a(0x22f)](_0x1e30b1[_0x19821a(0x24f)],_0x1e30b1['to']);try{const _0x2e53d3=await _0x167c28[_0x19821a(0x21d)](_0xfe84b9);if(_0x2e53d3&&_0x2e53d3['val']!==null&&_0x2e53d3[_0x19821a(0x240)]!==undefined){let _0x5b30ca=Number(_0x2e53d3[_0x19821a(0x240)]);if(typeof _0x5b30ca===_0x19821a(0x206)){if(_0x5b30ca<=1.05&&_0x1e30b1['to'][_0x19821a(0x253)](_0x19821a(0x231)))_0x5b30ca=_0x5b30ca*0x64;_0x5f00c9=Math[_0x19821a(0x1f4)](_0x5b30ca),_0x283720=!![];break;}}}catch(_0x4cd545){}}}}const _0x3a12ec=await _0x167c28['getStateAsync'](_0x19821a(0x22a));let _0x76834e=[];if(_0x3a12ec&&_0x3a12ec['val'])try{_0x76834e=JSON[_0x19821a(0x23b)](_0x3a12ec[_0x19821a(0x240)]);}catch(_0x1b1595){}_0x76834e['push']({'ts':Date[_0x19821a(0x23f)](),'room':_0x1aa908||_0x19821a(0x219),'t_in':_0x55d3cf,'t_out':_0x2b39db,'valve':_0x5f00c9});if(_0x76834e[_0x19821a(0x208)]>THERMO_LOG_SIZE)_0x76834e[_0x19821a(0x1f5)]();await _0x167c28[_0x19821a(0x24a)]('LTM.trainingData.thermodynamics',{'val':JSON[_0x19821a(0x228)](_0x76834e),'ack':!![]});}async function saveCompletedSequence(_0x5246ce){const _0x168059=a5_0x3be8;try{const _0x39e580=await _0x5246ce[_0x168059(0x216)](_0x168059(0x217));let _0x203f5c=[];if(_0x39e580&&_0x39e580[_0x168059(0x240)])try{_0x203f5c=JSON[_0x168059(0x23b)](_0x39e580['val']);}catch(_0x35e51f){}const _0x17fec0=activeSequence[0x0]['ts'],_0x44d5c6=activeSequence[_0x168059(0x218)](_0x4e3b79=>({'loc':_0x4e3b79[_0x168059(0x224)],'t_delta':Math['round']((_0x4e3b79['ts']-_0x17fec0)/0x3e8)})),_0x3ce235={'timestamp':new Date(_0x17fec0)[_0x168059(0x1fe)](),'steps':_0x44d5c6,'duration':Math['round']((activeSequence[activeSequence[_0x168059(0x208)]-0x1]['ts']-_0x17fec0)/0x3e8),'daytime':new Date(_0x17fec0)['getHours']()};_0x203f5c[_0x168059(0x1ff)](_0x3ce235);if(_0x203f5c[_0x168059(0x208)]>MAX_TRAINING_SET_SIZE)_0x203f5c[_0x168059(0x1f5)]();await _0x5246ce[_0x168059(0x24a)](_0x168059(0x217),{'val':JSON[_0x168059(0x228)](_0x203f5c),'ack':!![]}),_0x5246ce[_0x168059(0x246)]&&_0x5246ce['sendToPythonWrapper']&&_0x5246ce['sendToPythonWrapper']('ANALYZE_SEQUENCE',{'sequence':_0x3ce235});}catch(_0x5d07bb){_0x5246ce[_0x168059(0x1fa)][_0x168059(0x23a)](_0x168059(0x23e)+_0x5d07bb[_0x168059(0x20f)]);}}async function recordSequence(_0x2f2755,_0x1f9aef){const _0x4f2628=a5_0x3be8,_0x4c1fe8=(_0x1f9aef[_0x4f2628(0x25e)]||'')[_0x4f2628(0x203)](),_0x561b6c=[_0x4f2628(0x259),_0x4f2628(0x22b),_0x4f2628(0x1f8),'presence',_0x4f2628(0x1f6),_0x4f2628(0x21e),_0x4f2628(0x238),_0x4f2628(0x250),_0x4f2628(0x254),_0x4f2628(0x211),_0x4f2628(0x260),_0x4f2628(0x220),_0x4f2628(0x213),'switch','schalter',_0x4f2628(0x1f3),_0x4f2628(0x25f)];if(!_0x561b6c[_0x4f2628(0x248)](_0x5171c3=>_0x4c1fe8['includes'](_0x5171c3)))return;if(!_0x1f9aef['value'])return;if(sequenceTimer)clearTimeout(sequenceTimer);activeSequence[_0x4f2628(0x1ff)]({'loc':_0x1f9aef[_0x4f2628(0x243)]||_0x4f2628(0x219),'id':_0x1f9aef['id'],'ts':Date['now']()}),sequenceTimer=setTimeout(async()=>{if(activeSequence['length']>0x1)await saveCompletedSequence(_0x2f2755);activeSequence=[];},SEQUENCE_TIMEOUT_MS);}function a5_0x3be8(_0x1093bf,_0x34448e){const _0x3a2f2e=a5_0x400e();return a5_0x3be8=function(_0x1a4aa4,_0x5604fa){_0x1a4aa4=_0x1a4aa4-0x1f2;let _0x400ea7=_0x3a2f2e[_0x1a4aa4];return _0x400ea7;},a5_0x3be8(_0x1093bf,_0x34448e);}function startExitTimer(_0x255fab){const _0x1d92c6=a5_0x3be8;abortExitTimer(_0x255fab),_0x255fab[_0x1d92c6(0x234)]=!![],_0x255fab[_0x1d92c6(0x227)]=setTimeout(()=>{const _0x14678d=_0x1d92c6;_0x255fab[_0x14678d(0x234)]=![];},EXIT_GRACE_PERIOD_SECONDS*0x3e8),_0x255fab['exitTimer']=setTimeout(()=>{const _0x6d2a2e=_0x1d92c6;setPresence(_0x255fab,![]),_0x255fab[_0x6d2a2e(0x23d)]=null;},EXIT_TIMER_MINUTES*0x3c*0x3e8);}function abortExitTimer(_0x280449){const _0x3abed6=a5_0x3be8;if(_0x280449[_0x3abed6(0x23d)])clearTimeout(_0x280449[_0x3abed6(0x23d)]);if(_0x280449[_0x3abed6(0x227)])clearTimeout(_0x280449[_0x3abed6(0x227)]);_0x280449['exitTimer']=null,_0x280449[_0x3abed6(0x227)]=null,_0x280449[_0x3abed6(0x234)]=![];}async function setPresence(_0x1219db,_0x1acd78){const _0xc73dc=a5_0x3be8;if(_0x1219db['isPresent']===_0x1acd78)return;_0x1219db[_0xc73dc(0x230)]=_0x1acd78,await _0x1219db[_0xc73dc(0x24a)](_0xc73dc(0x201),{'val':_0x1acd78,'ack':!![]});}async function processSensorEvent(_0x5434ee,_0x4ffa25,_0x101ac2,_0x326d1f){const _0x1d481f=a5_0x3be8;if(!_0x326d1f)return null;const _0x5a37b6=_0x101ac2[_0x1d481f(0x240)],_0x1d39fd=Date[_0x1d481f(0x23f)](),_0x244f81=_0x5434ee[_0x1d481f(0x25d)][_0x4ffa25],_0x1a087b=(_0x326d1f[_0x1d481f(0x25e)]||'')[_0x1d481f(0x203)](),_0x186524=_0x1a087b[_0x1d481f(0x253)](_0x1d481f(0x23c))||_0x1a087b[_0x1d481f(0x253)](_0x1d481f(0x235))||_0x1a087b['includes'](_0x1d481f(0x1fd))||_0x1a087b[_0x1d481f(0x253)](_0x1d481f(0x1fb))||_0x1a087b[_0x1d481f(0x253)](_0x1d481f(0x258));if(_0x186524&&typeof _0x5a37b6===_0x1d481f(0x206)){if(_0x5a37b6>0x50||_0x5a37b6<-0x32)return _0x5434ee[_0x1d481f(0x1fa)]['debug'](_0x1d481f(0x24c)+_0x5a37b6+_0x1d481f(0x226)+_0x4ffa25),null;}_0x5434ee['sensorLastValues'][_0x4ffa25]=_0x5a37b6;if(!_0x326d1f[_0x1d481f(0x241)]&&_0x244f81!=undefined&&_0x244f81==_0x5a37b6)return null;_0x5434ee['isProVersion']&&_0x186524&&recordThermodynamics(_0x5434ee,_0x4ffa25,_0x5a37b6,_0x326d1f[_0x1d481f(0x243)]);const _0x3c1e31={'timestamp':_0x1d39fd,'id':_0x4ffa25,'name':_0x326d1f[_0x1d481f(0x1f7)],'type':_0x326d1f[_0x1d481f(0x25e)],'location':_0x326d1f[_0x1d481f(0x243)],'value':_0x5a37b6};_0x5434ee[_0x1d481f(0x247)]['unshift'](_0x3c1e31);if(_0x5434ee[_0x1d481f(0x247)][_0x1d481f(0x208)]>HISTORY_MAX_SIZE)_0x5434ee[_0x1d481f(0x247)][_0x1d481f(0x24e)]();await _0x5434ee[_0x1d481f(0x24a)](_0x1d481f(0x229),{'val':JSON[_0x1d481f(0x228)](_0x3c1e31),'ack':!![]}),await _0x5434ee[_0x1d481f(0x24a)]('events.history',{'val':JSON['stringify'](_0x5434ee[_0x1d481f(0x247)]),'ack':!![]});if(_0x5434ee[_0x1d481f(0x246)]){_0x5434ee[_0x1d481f(0x1f2)][_0x1d481f(0x1ff)](_0x3c1e31);if(_0x5434ee['rawEventLog']['length']>RAW_LOG_MAX_SIZE)_0x5434ee[_0x1d481f(0x1f2)][_0x1d481f(0x204)](0x0,_0x5434ee['rawEventLog'][_0x1d481f(0x208)]-RAW_LOG_MAX_SIZE);await _0x5434ee['setStateAsync'](_0x1d481f(0x245),{'val':JSON[_0x1d481f(0x228)](_0x5434ee[_0x1d481f(0x1f2)]),'ack':!![]}),recordSequence(_0x5434ee,_0x3c1e31);}if(_0x326d1f[_0x1d481f(0x252)]&&_0x5a37b6===!![]){if(_0x5434ee['isPresent']&&!_0x5434ee[_0x1d481f(0x234)])startExitTimer(_0x5434ee);else{if(!_0x5434ee[_0x1d481f(0x230)])setPresence(_0x5434ee,!![]);}}else{if(_0x326d1f['type']===_0x1d481f(0x259)&&_0x5a37b6===!![]){if(_0x5434ee[_0x1d481f(0x23d)])abortExitTimer(_0x5434ee);if(!_0x5434ee[_0x1d481f(0x230)]&&_0x5434ee['currentSystemMode']===_0x1d481f(0x1fc))setPresence(_0x5434ee,!![]);}}if(_0x5434ee[_0x1d481f(0x246)]&&_0x5434ee[_0x1d481f(0x24d)]){_0x326d1f[_0x1d481f(0x25e)]==='motion'&&_0x5a37b6===!![]&&_0x326d1f[_0x1d481f(0x243)]&&_0x5434ee[_0x1d481f(0x24d)]('SIMULATE_SIGNAL',{'room':_0x326d1f[_0x1d481f(0x243)]});const _0x3d31ee=[_0x1d481f(0x21e),_0x1d481f(0x238),_0x1d481f(0x250),_0x1d481f(0x254),'griff',_0x1d481f(0x225),_0x1d481f(0x20b),_0x1d481f(0x20d)]['some'](_0x209be9=>_0x1a087b['includes'](_0x209be9)),_0x3ccccc=[_0x1d481f(0x220),_0x1d481f(0x213),'switch',_0x1d481f(0x20a),_0x1d481f(0x1f3),_0x1d481f(0x25f)][_0x1d481f(0x248)](_0x256dfb=>_0x1a087b['includes'](_0x256dfb)),_0x4c275e=['motion','bewegung','präsenz',_0x1d481f(0x1f9),_0x1d481f(0x1f6)][_0x1d481f(0x248)](_0x273cc6=>_0x1a087b['includes'](_0x273cc6));if(_0x326d1f[_0x1d481f(0x243)]&&(_0x3d31ee||_0x3ccccc||_0x4c275e)){const _0x5da610=_0x5a37b6===!![]||typeof _0x5a37b6===_0x1d481f(0x206)&&_0x5a37b6>0x0,_0x169881=_0x3d31ee&&!_0x5da610&&_0x244f81!==undefined&&_0x244f81!=_0x5a37b6;if(_0x5da610||_0x169881){const _0x39c453=_0x5434ee[_0x1d481f(0x20c)]||_0x1d39fd,_0x9ef5dd=(_0x1d39fd-_0x39c453)/0x3e8;_0x5434ee[_0x1d481f(0x20c)]=_0x1d39fd,_0x5434ee[_0x1d481f(0x24d)](_0x1d481f(0x205),{'room':_0x326d1f[_0x1d481f(0x243)],'dt':_0x9ef5dd});}}}return _0x3c1e31;}module[a5_0x16d7a8(0x21a)]={'processSensorEvent':processSensorEvent,'getOutsideTemperatureNumeric':getOutsideTemperatureNumeric,'setPresence':setPresence,'abortExitTimer':abortExitTimer,'startExitTimer':startExitTimer};