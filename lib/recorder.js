function a5_0x2b1c(){const _0x1c5947=['useWeather','.LEVEL','[RECORDER]\x20Error:\x20','string','ANALYZE_SEQUENCE','Valve','from','loc','location','16AcnXSv','getHours','normal','isProVersion','exitGraceTimer','fill','schloss','thermostat','bewegung','splice','exports','(((.+)+)+)+$','handle','val','TRACK_EVENT','occupancy','.1.ACTUAL_TEMPERATURE','fenster','parse','LTM.rawEventLog','lock','klima','includes','contact','dimmer','outdoorSensorId','toISOString','Unknown','name','some','shift','isGracePeriodActive','sensorLastValues','round','light','events.history','.1.LEVEL','switch','.forecast.current.temp','rawEventLog','720640NLsubj','message','presence','constructor','motion','893450WQOZPV','number','valveMapping','isPresent','stringify','.ACTUAL_TEMPERATURE','door','map','exitTimer','388397eQBpTa','LTM.trainingData.sequences','.forecast.current.temperature','1483769OWRueb','events.lastEvent','STATE','[RECORDER]\x20Ignored\x20implausible\x20temperature:\x20','replace','LEVEL','accuweather','LTM.trainingData.thermodynamics','\x20from\x20','setStateAsync','log','weatherunderground','lastTrackerEventTime','currentSystemMode','length','logDuplicates','2147760JtMbyR','3222Crzpet','pop','licht','isExit','griff','window','openweathermap','.NextHours.Location_1.Day_1.current.temp_value','34062bQwtFQ','debug','toLowerCase','lampe','29300COWchj','config','getForeignStateAsync','eventHistory','analysis.health.todayVector','SIMULATE_SIGNAL','schalter','sendToPythonWrapper','now','präsenz','STATUS','type','.1.TEMPERATURE','76xPIvLB','error','.Current.Temperature','temperature','getDate','value','getStateAsync','heizung','kontakt','tür'];a5_0x2b1c=function(){return _0x1c5947;};return a5_0x2b1c();}const a5_0x380dff=a5_0xe4a8;(function(_0x2bbf8b,_0x44829c){const _0x53dd97=a5_0xe4a8,_0x53563c=_0x2bbf8b();while(!![]){try{const _0x111384=-parseInt(_0x53dd97(0x8c))/0x1+parseInt(_0x53dd97(0x83))/0x2+parseInt(_0x53dd97(0xa8))/0x3*(-parseInt(_0x53dd97(0xb9))/0x4)+parseInt(_0x53dd97(0x7e))/0x5+-parseInt(_0x53dd97(0x9f))/0x6+parseInt(_0x53dd97(0x8f))/0x7*(-parseInt(_0x53dd97(0xcc))/0x8)+parseInt(_0x53dd97(0xa0))/0x9*(parseInt(_0x53dd97(0xac))/0xa);if(_0x111384===_0x44829c)break;else _0x53563c['push'](_0x53563c['shift']());}catch(_0x3d479a){_0x53563c['push'](_0x53563c['shift']());}}}(a5_0x2b1c,0x3df50));const a5_0x5f9ce2=(function(){let _0x37a1ea=!![];return function(_0x321edc,_0x4b4697){const _0x253d59=_0x37a1ea?function(){if(_0x4b4697){const _0x2bd3a2=_0x4b4697['apply'](_0x321edc,arguments);return _0x4b4697=null,_0x2bd3a2;}}:function(){};return _0x37a1ea=![],_0x253d59;};}()),a5_0x2e9ebb=a5_0x5f9ce2(this,function(){const _0x558e87=a5_0xe4a8;return a5_0x2e9ebb['toString']()['search'](_0x558e87(0xd7))['toString']()[_0x558e87(0x81)](a5_0x2e9ebb)['search']('(((.+)+)+)+$');});a5_0x2e9ebb();'use strict';const HISTORY_MAX_SIZE=0x32,RAW_LOG_MAX_SIZE=0x9c4,THERMO_LOG_SIZE=0x3e8,SEQUENCE_TIMEOUT_MS=0x5*0x3c*0x3e8,MAX_TRAINING_SET_SIZE=0x1f4,EXIT_TIMER_MINUTES=0xf,EXIT_GRACE_PERIOD_SECONDS=0x1e;let activeSequence=[],sequenceTimer=null;async function getOutsideTemperatureNumeric(_0xbcda74){const _0x5e2571=a5_0xe4a8;if(_0xbcda74['config'][_0x5e2571(0xe5)])try{const _0x20abba=await _0xbcda74[_0x5e2571(0xae)](_0xbcda74[_0x5e2571(0xad)]['outdoorSensorId']);if(_0x20abba&&_0x20abba[_0x5e2571(0xd9)]!==undefined&&_0x20abba['val']!==null)return parseFloat(_0x20abba['val']);}catch(_0x5b4b9a){}const _0x372161=_0xbcda74[_0x5e2571(0xad)]['weatherInstance'];if(!_0xbcda74[_0x5e2571(0xad)][_0x5e2571(0xc3)]||!_0x372161)return null;try{let _0x3bfe1a='';if(_0x372161[_0x5e2571(0xe2)](_0x5e2571(0x95)))_0x3bfe1a=_0x372161+_0x5e2571(0xbb);else{if(_0x372161[_0x5e2571(0xe2)]('daswetter'))_0x3bfe1a=_0x372161+_0x5e2571(0xa7);else{if(_0x372161['includes'](_0x5e2571(0xa6)))_0x3bfe1a=_0x372161+_0x5e2571(0x8e);else{if(_0x372161['includes'](_0x5e2571(0x9a)))_0x3bfe1a=_0x372161+_0x5e2571(0x7c);}}}if(_0x3bfe1a){const _0x11910a=await _0xbcda74[_0x5e2571(0xae)](_0x3bfe1a);if(_0x11910a&&_0x11910a[_0x5e2571(0xd9)]!==undefined&&_0x11910a[_0x5e2571(0xd9)]!==null)return parseFloat(_0x11910a[_0x5e2571(0xd9)]);}}catch(_0x679e){}return null;}async function recordThermodynamics(_0x28179a,_0x26694d,_0x2bd205,_0x2536a1){const _0x489be7=a5_0xe4a8,_0x12a2a6=await getOutsideTemperatureNumeric(_0x28179a);if(_0x12a2a6===null)return;let _0xf9491e=0x0,_0x3b71c6=![];if(_0x28179a[_0x489be7(0xad)][_0x489be7(0x85)])try{let _0x264ae5=_0x28179a[_0x489be7(0xad)][_0x489be7(0x85)];if(typeof _0x264ae5===_0x489be7(0xc6))_0x264ae5=JSON['parse'](_0x264ae5);if(_0x264ae5[_0x26694d]){const _0x31cdc1=_0x264ae5[_0x26694d],_0x355ebe=await _0x28179a[_0x489be7(0xae)](_0x31cdc1);if(_0x355ebe&&_0x355ebe[_0x489be7(0xd9)]!==null&&_0x355ebe[_0x489be7(0xd9)]!==undefined){let _0x3bdff7=Number(_0x355ebe[_0x489be7(0xd9)]);if(_0x3bdff7<=1.05&&!_0x31cdc1[_0x489be7(0xe2)](_0x489be7(0xb6))&&!_0x31cdc1[_0x489be7(0xe2)](_0x489be7(0x91)))_0x3bdff7=_0x3bdff7*0x64;_0xf9491e=Math[_0x489be7(0xed)](_0x3bdff7),_0x3b71c6=!![];}}}catch(_0x1bd21b){}if(!_0x3b71c6){const _0x32b96f=[{'from':'.1.ACTUAL_TEMPERATURE','to':_0x489be7(0xf0)},{'from':_0x489be7(0xdc),'to':'.1.VALVE_STATE'},{'from':_0x489be7(0xb8),'to':'.4.VALVE_STATE'},{'from':_0x489be7(0x88),'to':_0x489be7(0xc4)},{'from':_0x489be7(0xbc),'to':'level'},{'from':'Temperature','to':_0x489be7(0xc8)}];for(const _0x2d1dc7 of _0x32b96f){if(_0x26694d[_0x489be7(0xe2)](_0x2d1dc7[_0x489be7(0xc9)])){const _0x1ff570=_0x26694d[_0x489be7(0x93)](_0x2d1dc7[_0x489be7(0xc9)],_0x2d1dc7['to']);try{const _0x5e7721=await _0x28179a[_0x489be7(0xae)](_0x1ff570);if(_0x5e7721&&_0x5e7721['val']!==null&&_0x5e7721['val']!==undefined){let _0x403eab=Number(_0x5e7721['val']);if(typeof _0x403eab==='number'){if(_0x403eab<=1.05&&_0x2d1dc7['to']['includes'](_0x489be7(0x94)))_0x403eab=_0x403eab*0x64;_0xf9491e=Math['round'](_0x403eab),_0x3b71c6=!![];break;}}}catch(_0x20a059){}}}}const _0x3d4209=await _0x28179a['getStateAsync']('LTM.trainingData.thermodynamics');let _0x155239=[];if(_0x3d4209&&_0x3d4209[_0x489be7(0xd9)])try{_0x155239=JSON['parse'](_0x3d4209[_0x489be7(0xd9)]);}catch(_0x15bdde){}_0x155239['push']({'ts':Date[_0x489be7(0xb4)](),'room':_0x2536a1||_0x489be7(0xe7),'t_in':_0x2bd205,'t_out':_0x12a2a6,'valve':_0xf9491e});if(_0x155239['length']>THERMO_LOG_SIZE)_0x155239[_0x489be7(0xea)]();await _0x28179a[_0x489be7(0x98)](_0x489be7(0x96),{'val':JSON[_0x489be7(0x87)](_0x155239),'ack':!![]});}async function saveCompletedSequence(_0x587970){const _0x4bdf45=a5_0xe4a8;try{const _0x5805fa=await _0x587970[_0x4bdf45(0xbf)](_0x4bdf45(0x8d));let _0x396f0f=[];if(_0x5805fa&&_0x5805fa[_0x4bdf45(0xd9)])try{_0x396f0f=JSON[_0x4bdf45(0xde)](_0x5805fa[_0x4bdf45(0xd9)]);}catch(_0x383fab){}const _0x139679=activeSequence[0x0]['ts'],_0x2bc7bf=activeSequence[_0x4bdf45(0x8a)](_0x253505=>({'loc':_0x253505[_0x4bdf45(0xca)],'t_delta':Math[_0x4bdf45(0xed)]((_0x253505['ts']-_0x139679)/0x3e8)})),_0x35fa35={'timestamp':new Date(_0x139679)[_0x4bdf45(0xe6)](),'steps':_0x2bc7bf,'duration':Math[_0x4bdf45(0xed)]((activeSequence[activeSequence[_0x4bdf45(0x9d)]-0x1]['ts']-_0x139679)/0x3e8),'daytime':new Date(_0x139679)[_0x4bdf45(0xcd)]()};_0x396f0f['push'](_0x35fa35);if(_0x396f0f[_0x4bdf45(0x9d)]>MAX_TRAINING_SET_SIZE)_0x396f0f[_0x4bdf45(0xea)]();await _0x587970[_0x4bdf45(0x98)]('LTM.trainingData.sequences',{'val':JSON[_0x4bdf45(0x87)](_0x396f0f),'ack':!![]}),_0x587970[_0x4bdf45(0xcf)]&&_0x587970[_0x4bdf45(0xb3)]&&_0x587970[_0x4bdf45(0xb3)](_0x4bdf45(0xc7),{'sequence':_0x35fa35});}catch(_0x431638){_0x587970[_0x4bdf45(0x99)][_0x4bdf45(0xba)](_0x4bdf45(0xc5)+_0x431638[_0x4bdf45(0x7f)]);}}async function recordSequence(_0x229898,_0x23c061){const _0x589d7a=a5_0xe4a8,_0x472d56=(_0x23c061[_0x589d7a(0xb7)]||'')[_0x589d7a(0xaa)](),_0xaa70b2=[_0x589d7a(0x82),_0x589d7a(0xd4),_0x589d7a(0xb5),_0x589d7a(0x80),_0x589d7a(0xdb),_0x589d7a(0x89),_0x589d7a(0xc2),_0x589d7a(0xa5),_0x589d7a(0xdd),_0x589d7a(0xe3),_0x589d7a(0xc1),'light',_0x589d7a(0xa2),_0x589d7a(0x7b),_0x589d7a(0xb2),_0x589d7a(0xe4),_0x589d7a(0xab)];if(!_0xaa70b2[_0x589d7a(0xe9)](_0x1b1882=>_0x472d56['includes'](_0x1b1882)))return;if(!_0x23c061[_0x589d7a(0xbe)])return;if(sequenceTimer)clearTimeout(sequenceTimer);activeSequence['push']({'loc':_0x23c061[_0x589d7a(0xcb)]||'Unknown','id':_0x23c061['id'],'ts':Date[_0x589d7a(0xb4)]()}),sequenceTimer=setTimeout(async()=>{const _0x37e889=_0x589d7a;if(activeSequence[_0x37e889(0x9d)]>0x1)await saveCompletedSequence(_0x229898);activeSequence=[];},SEQUENCE_TIMEOUT_MS);}function startExitTimer(_0x5498c6){const _0x861898=a5_0xe4a8;abortExitTimer(_0x5498c6),_0x5498c6[_0x861898(0xeb)]=!![],_0x5498c6['exitGraceTimer']=setTimeout(()=>{_0x5498c6['isGracePeriodActive']=![];},EXIT_GRACE_PERIOD_SECONDS*0x3e8),_0x5498c6[_0x861898(0x8b)]=setTimeout(()=>{const _0x352986=_0x861898;setPresence(_0x5498c6,![]),_0x5498c6[_0x352986(0x8b)]=null;},EXIT_TIMER_MINUTES*0x3c*0x3e8);}function abortExitTimer(_0x6c76b0){const _0x44f925=a5_0xe4a8;if(_0x6c76b0[_0x44f925(0x8b)])clearTimeout(_0x6c76b0[_0x44f925(0x8b)]);if(_0x6c76b0['exitGraceTimer'])clearTimeout(_0x6c76b0[_0x44f925(0xd0)]);_0x6c76b0[_0x44f925(0x8b)]=null,_0x6c76b0[_0x44f925(0xd0)]=null,_0x6c76b0[_0x44f925(0xeb)]=![];}async function setPresence(_0x12851e,_0x3c8332){const _0x16a9b5=a5_0xe4a8;if(_0x12851e[_0x16a9b5(0x86)]===_0x3c8332)return;_0x12851e['isPresent']=_0x3c8332,await _0x12851e[_0x16a9b5(0x98)]('system.isPresent',{'val':_0x3c8332,'ack':!![]});}function a5_0xe4a8(_0x44159f,_0xfddf28){const _0x4499f9=a5_0x2b1c();return a5_0xe4a8=function(_0x2e9ebb,_0x5f9ce2){_0x2e9ebb=_0x2e9ebb-0x7b;let _0x2b1c1e=_0x4499f9[_0x2e9ebb];return _0x2b1c1e;},a5_0xe4a8(_0x44159f,_0xfddf28);}async function updateHourlyActivity(_0x4935a){const _0x5840c8=a5_0xe4a8;let _0x2a824b=new Array(0x18)[_0x5840c8(0xd1)](0x0),_0x4722b1=0x0;try{const _0x252372=await _0x4935a['getStateAsync'](_0x5840c8(0xb0));_0x252372&&_0x252372['val']&&(_0x2a824b=JSON[_0x5840c8(0xde)](_0x252372[_0x5840c8(0xd9)]),_0x4722b1=_0x252372['ts']);}catch(_0x7a40fc){}const _0x541d2f=new Date(_0x4722b1),_0x1ab0e2=new Date();_0x541d2f[_0x5840c8(0xbd)]()!==_0x1ab0e2['getDate']()&&(_0x2a824b=new Array(0x18)[_0x5840c8(0xd1)](0x0));const _0x2c8cda=_0x1ab0e2[_0x5840c8(0xcd)]();if(_0x2a824b[_0x2c8cda]===undefined)_0x2a824b[_0x2c8cda]=0x0;_0x2a824b[_0x2c8cda]++,await _0x4935a[_0x5840c8(0x98)](_0x5840c8(0xb0),{'val':JSON['stringify'](_0x2a824b),'ack':!![]});}async function processSensorEvent(_0x3724e1,_0x2e36c7,_0x10946b,_0x1ead97){const _0x55cefb=a5_0xe4a8;if(!_0x1ead97)return null;const _0x1c7726=_0x10946b[_0x55cefb(0xd9)],_0x3b6c8f=Date[_0x55cefb(0xb4)](),_0x40e041=_0x3724e1[_0x55cefb(0xec)][_0x2e36c7],_0x58f752=(_0x1ead97[_0x55cefb(0xb7)]||'')[_0x55cefb(0xaa)](),_0x406120=_0x58f752[_0x55cefb(0xe2)](_0x55cefb(0xbc))||_0x58f752['includes']('temperatur')||_0x58f752[_0x55cefb(0xe2)](_0x55cefb(0xe1))||_0x58f752[_0x55cefb(0xe2)](_0x55cefb(0xc0))||_0x58f752[_0x55cefb(0xe2)](_0x55cefb(0xd3));if(_0x406120&&typeof _0x1c7726==='number'){if(_0x1c7726>0x50||_0x1c7726<-0x32)return _0x3724e1[_0x55cefb(0x99)][_0x55cefb(0xa9)](_0x55cefb(0x92)+_0x1c7726+_0x55cefb(0x97)+_0x2e36c7),null;}_0x3724e1[_0x55cefb(0xec)][_0x2e36c7]=_0x1c7726;if(!_0x1ead97[_0x55cefb(0x9e)]&&_0x40e041!=undefined&&_0x40e041==_0x1c7726)return null;_0x3724e1[_0x55cefb(0xcf)]&&_0x406120&&recordThermodynamics(_0x3724e1,_0x2e36c7,_0x1c7726,_0x1ead97[_0x55cefb(0xcb)]);const _0x524b38={'timestamp':_0x3b6c8f,'id':_0x2e36c7,'name':_0x1ead97[_0x55cefb(0xe8)],'type':_0x1ead97[_0x55cefb(0xb7)],'location':_0x1ead97[_0x55cefb(0xcb)],'value':_0x1c7726};_0x3724e1[_0x55cefb(0xaf)]['unshift'](_0x524b38);if(_0x3724e1[_0x55cefb(0xaf)][_0x55cefb(0x9d)]>HISTORY_MAX_SIZE)_0x3724e1['eventHistory'][_0x55cefb(0xa1)]();await _0x3724e1['setStateAsync'](_0x55cefb(0x90),{'val':JSON[_0x55cefb(0x87)](_0x524b38),'ack':!![]}),await _0x3724e1[_0x55cefb(0x98)](_0x55cefb(0xef),{'val':JSON[_0x55cefb(0x87)](_0x3724e1[_0x55cefb(0xaf)]),'ack':!![]}),await updateHourlyActivity(_0x3724e1);if(_0x3724e1['isProVersion']){_0x3724e1[_0x55cefb(0x7d)]['push'](_0x524b38);if(_0x3724e1[_0x55cefb(0x7d)][_0x55cefb(0x9d)]>RAW_LOG_MAX_SIZE)_0x3724e1[_0x55cefb(0x7d)][_0x55cefb(0xd5)](0x0,_0x3724e1[_0x55cefb(0x7d)][_0x55cefb(0x9d)]-RAW_LOG_MAX_SIZE);await _0x3724e1[_0x55cefb(0x98)](_0x55cefb(0xdf),{'val':JSON[_0x55cefb(0x87)](_0x3724e1['rawEventLog']),'ack':!![]}),recordSequence(_0x3724e1,_0x524b38);}if(_0x1ead97[_0x55cefb(0xa3)]&&_0x1c7726===!![]){if(_0x3724e1[_0x55cefb(0x86)]&&!_0x3724e1[_0x55cefb(0xeb)])startExitTimer(_0x3724e1);else{if(!_0x3724e1[_0x55cefb(0x86)])setPresence(_0x3724e1,!![]);}}else{if(_0x1ead97['type']===_0x55cefb(0x82)&&_0x1c7726===!![]){if(_0x3724e1[_0x55cefb(0x8b)])abortExitTimer(_0x3724e1);if(!_0x3724e1[_0x55cefb(0x86)]&&_0x3724e1[_0x55cefb(0x9c)]===_0x55cefb(0xce))setPresence(_0x3724e1,!![]);}}if(_0x3724e1[_0x55cefb(0xcf)]&&_0x3724e1[_0x55cefb(0xb3)]){_0x1ead97[_0x55cefb(0xb7)]===_0x55cefb(0x82)&&_0x1c7726===!![]&&_0x1ead97['location']&&_0x3724e1[_0x55cefb(0xb3)](_0x55cefb(0xb1),{'room':_0x1ead97[_0x55cefb(0xcb)]});const _0x2ffb3f=[_0x55cefb(0x89),'tür',_0x55cefb(0xa5),_0x55cefb(0xdd),_0x55cefb(0xa4),_0x55cefb(0xd8),_0x55cefb(0xe0),_0x55cefb(0xd2)]['some'](_0x376aec=>_0x58f752[_0x55cefb(0xe2)](_0x376aec)),_0x3e6423=[_0x55cefb(0xee),'licht',_0x55cefb(0x7b),_0x55cefb(0xb2),_0x55cefb(0xe4),'lampe']['some'](_0x2c2b4c=>_0x58f752[_0x55cefb(0xe2)](_0x2c2b4c)),_0x53d1f3=[_0x55cefb(0x82),_0x55cefb(0xd4),_0x55cefb(0xb5),_0x55cefb(0x80),_0x55cefb(0xdb)][_0x55cefb(0xe9)](_0x4c15cc=>_0x58f752['includes'](_0x4c15cc));if(_0x1ead97[_0x55cefb(0xcb)]&&(_0x2ffb3f||_0x3e6423||_0x53d1f3)){const _0x2627a0=_0x1c7726===!![]||typeof _0x1c7726===_0x55cefb(0x84)&&_0x1c7726>0x0,_0x3b7e9c=_0x2ffb3f&&!_0x2627a0&&_0x40e041!==undefined&&_0x40e041!=_0x1c7726;if(_0x2627a0||_0x3b7e9c){const _0x24ed79=_0x3724e1[_0x55cefb(0x9b)]||_0x3b6c8f,_0x168e36=(_0x3b6c8f-_0x24ed79)/0x3e8;_0x3724e1[_0x55cefb(0x9b)]=_0x3b6c8f,_0x3724e1['sendToPythonWrapper'](_0x55cefb(0xda),{'room':_0x1ead97[_0x55cefb(0xcb)],'dt':_0x168e36});}}}return _0x524b38;}module[a5_0x380dff(0xd6)]={'processSensorEvent':processSensorEvent,'getOutsideTemperatureNumeric':getOutsideTemperatureNumeric,'setPresence':setPresence,'abortExitTimer':abortExitTimer,'startExitTimer':startExitTimer};