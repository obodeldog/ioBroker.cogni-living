const a5_0xb5184e=a5_0x5434;function a5_0x5434(_0x14f71c,_0x2043cb){const _0x4aad6e=a5_0x5da0();return a5_0x5434=function(_0x1f501a,_0x599ce6){_0x1f501a=_0x1f501a-0x129;let _0x5da01e=_0x4aad6e[_0x1f501a];return _0x5da01e;},a5_0x5434(_0x14f71c,_0x2043cb);}(function(_0x45807c,_0x138023){const _0x7afdaa=a5_0x5434,_0x29e231=_0x45807c();while(!![]){try{const _0x4925b7=-parseInt(_0x7afdaa(0x19d))/0x1+parseInt(_0x7afdaa(0x189))/0x2+-parseInt(_0x7afdaa(0x165))/0x3+parseInt(_0x7afdaa(0x194))/0x4+parseInt(_0x7afdaa(0x132))/0x5*(parseInt(_0x7afdaa(0x196))/0x6)+parseInt(_0x7afdaa(0x192))/0x7*(parseInt(_0x7afdaa(0x19b))/0x8)+-parseInt(_0x7afdaa(0x155))/0x9*(parseInt(_0x7afdaa(0x136))/0xa);if(_0x4925b7===_0x138023)break;else _0x29e231['push'](_0x29e231['shift']());}catch(_0x3d2323){_0x29e231['push'](_0x29e231['shift']());}}}(a5_0x5da0,0x2e42f));const a5_0x599ce6=(function(){let _0x1589d4=!![];return function(_0xd8ece4,_0x10618e){const _0x13cbc5=_0x1589d4?function(){const _0x110bae=a5_0x5434;if(_0x10618e){const _0x31ea9c=_0x10618e[_0x110bae(0x16b)](_0xd8ece4,arguments);return _0x10618e=null,_0x31ea9c;}}:function(){};return _0x1589d4=![],_0x13cbc5;};}()),a5_0x1f501a=a5_0x599ce6(this,function(){const _0x15c070=a5_0x5434;return a5_0x1f501a['toString']()['search'](_0x15c070(0x195))[_0x15c070(0x173)]()[_0x15c070(0x162)](a5_0x1f501a)['search'](_0x15c070(0x195));});a5_0x1f501a();'use strict';const HISTORY_MAX_SIZE=0x32,RAW_LOG_MAX_SIZE=0x9c4,THERMO_LOG_SIZE=0x3e8,SEQUENCE_TIMEOUT_MS=0x5*0x3c*0x3e8,MAX_TRAINING_SET_SIZE=0x1f4,EXIT_TIMER_MINUTES=0xf,EXIT_GRACE_PERIOD_SECONDS=0x1e;let activeSequence=[],sequenceTimer=null;async function getOutsideTemperatureNumeric(_0x2c89a1){const _0x464267=a5_0x5434;if(_0x2c89a1[_0x464267(0x12f)][_0x464267(0x188)])try{const _0xfee4a0=await _0x2c89a1[_0x464267(0x17d)](_0x2c89a1['config'][_0x464267(0x188)]);if(_0xfee4a0&&_0xfee4a0['val']!==undefined&&_0xfee4a0['val']!==null)return parseFloat(_0xfee4a0['val']);}catch(_0xba0990){}const _0x491bac=_0x2c89a1[_0x464267(0x12f)][_0x464267(0x170)];if(!_0x2c89a1[_0x464267(0x12f)][_0x464267(0x19e)]||!_0x491bac)return null;try{let _0x2fb2fc='';if(_0x491bac['includes'](_0x464267(0x151)))_0x2fb2fc=_0x491bac+'.Current.Temperature';else{if(_0x491bac[_0x464267(0x15d)]('daswetter'))_0x2fb2fc=_0x491bac+'.NextHours.Location_1.Day_1.current.temp_value';else{if(_0x491bac[_0x464267(0x15d)](_0x464267(0x12d)))_0x2fb2fc=_0x491bac+_0x464267(0x15e);else{if(_0x491bac[_0x464267(0x15d)](_0x464267(0x171)))_0x2fb2fc=_0x491bac+_0x464267(0x166);}}}if(_0x2fb2fc){const _0x531e0b=await _0x2c89a1[_0x464267(0x17d)](_0x2fb2fc);if(_0x531e0b&&_0x531e0b[_0x464267(0x12e)]!==undefined&&_0x531e0b[_0x464267(0x12e)]!==null)return parseFloat(_0x531e0b[_0x464267(0x12e)]);}}catch(_0x465bd6){}return null;}async function recordThermodynamics(_0x38e5fd,_0x1e9199,_0x81d1a4,_0x36973c){const _0x5658fb=a5_0x5434,_0x36dee8=await getOutsideTemperatureNumeric(_0x38e5fd);if(_0x36dee8===null)return;let _0x204f7b=0x0,_0x298728=![];if(_0x38e5fd[_0x5658fb(0x12f)][_0x5658fb(0x168)])try{let _0x15c17f=_0x38e5fd[_0x5658fb(0x12f)]['valveMapping'];if(typeof _0x15c17f===_0x5658fb(0x18d))_0x15c17f=JSON[_0x5658fb(0x14f)](_0x15c17f);if(_0x15c17f[_0x1e9199]){const _0x22d1f3=_0x15c17f[_0x1e9199],_0x4b049d=await _0x38e5fd[_0x5658fb(0x17d)](_0x22d1f3);if(_0x4b049d&&_0x4b049d[_0x5658fb(0x12e)]!==null&&_0x4b049d[_0x5658fb(0x12e)]!==undefined){let _0x2b743e=Number(_0x4b049d['val']);if(_0x2b743e<=1.05&&!_0x22d1f3[_0x5658fb(0x15d)](_0x5658fb(0x145))&&!_0x22d1f3[_0x5658fb(0x15d)]('STATE'))_0x2b743e=_0x2b743e*0x64;_0x204f7b=Math[_0x5658fb(0x131)](_0x2b743e),_0x298728=!![];}}}catch(_0x14b87c){}if(!_0x298728){const _0x1dc3fd=[{'from':'.1.ACTUAL_TEMPERATURE','to':_0x5658fb(0x16a)},{'from':_0x5658fb(0x159),'to':_0x5658fb(0x197)},{'from':_0x5658fb(0x16d),'to':_0x5658fb(0x17e)},{'from':_0x5658fb(0x167),'to':_0x5658fb(0x180)},{'from':_0x5658fb(0x13b),'to':_0x5658fb(0x144)},{'from':_0x5658fb(0x15c),'to':_0x5658fb(0x183)}];for(const _0x6321b4 of _0x1dc3fd){if(_0x1e9199[_0x5658fb(0x15d)](_0x6321b4[_0x5658fb(0x15a)])){const _0x391984=_0x1e9199[_0x5658fb(0x179)](_0x6321b4['from'],_0x6321b4['to']);try{const _0x4c91a5=await _0x38e5fd[_0x5658fb(0x17d)](_0x391984);if(_0x4c91a5&&_0x4c91a5[_0x5658fb(0x12e)]!==null&&_0x4c91a5[_0x5658fb(0x12e)]!==undefined){let _0x584637=Number(_0x4c91a5[_0x5658fb(0x12e)]);if(typeof _0x584637===_0x5658fb(0x169)){if(_0x584637<=1.05&&_0x6321b4['to'][_0x5658fb(0x15d)](_0x5658fb(0x18a)))_0x584637=_0x584637*0x64;_0x204f7b=Math[_0x5658fb(0x131)](_0x584637),_0x298728=!![];break;}}}catch(_0x1236f7){}}}}const _0x1dbd3e=await _0x38e5fd['getStateAsync']('LTM.trainingData.thermodynamics');let _0x450cb5=[];if(_0x1dbd3e&&_0x1dbd3e['val'])try{_0x450cb5=JSON['parse'](_0x1dbd3e[_0x5658fb(0x12e)]);}catch(_0x5d9942){}_0x450cb5[_0x5658fb(0x156)]({'ts':Date[_0x5658fb(0x17c)](),'room':_0x36973c||_0x5658fb(0x177),'t_in':_0x81d1a4,'t_out':_0x36dee8,'valve':_0x204f7b});if(_0x450cb5[_0x5658fb(0x138)]>THERMO_LOG_SIZE)_0x450cb5[_0x5658fb(0x13a)]();await _0x38e5fd[_0x5658fb(0x154)](_0x5658fb(0x140),{'val':JSON['stringify'](_0x450cb5),'ack':!![]});}async function saveCompletedSequence(_0xd89617){const _0x44ef1a=a5_0x5434;try{const _0x5d3004=await _0xd89617[_0x44ef1a(0x18c)](_0x44ef1a(0x190));let _0x1a3433=[];if(_0x5d3004&&_0x5d3004[_0x44ef1a(0x12e)])try{_0x1a3433=JSON[_0x44ef1a(0x14f)](_0x5d3004[_0x44ef1a(0x12e)]);}catch(_0x1a9d73){}const _0x3a2a67=activeSequence[0x0]['ts'],_0x356969=activeSequence['map'](_0x168376=>({'loc':_0x168376[_0x44ef1a(0x182)],'t_delta':Math[_0x44ef1a(0x131)]((_0x168376['ts']-_0x3a2a67)/0x3e8)})),_0x3def2e={'timestamp':new Date(_0x3a2a67)[_0x44ef1a(0x157)](),'steps':_0x356969,'duration':Math[_0x44ef1a(0x131)]((activeSequence[activeSequence[_0x44ef1a(0x138)]-0x1]['ts']-_0x3a2a67)/0x3e8),'daytime':new Date(_0x3a2a67)[_0x44ef1a(0x199)]()};_0x1a3433[_0x44ef1a(0x156)](_0x3def2e);if(_0x1a3433[_0x44ef1a(0x138)]>MAX_TRAINING_SET_SIZE)_0x1a3433[_0x44ef1a(0x13a)]();await _0xd89617[_0x44ef1a(0x154)](_0x44ef1a(0x190),{'val':JSON['stringify'](_0x1a3433),'ack':!![]}),_0xd89617[_0x44ef1a(0x17b)]&&_0xd89617[_0x44ef1a(0x12b)]&&_0xd89617['sendToPythonWrapper'](_0x44ef1a(0x13e),{'sequence':_0x3def2e});}catch(_0x58c690){_0xd89617[_0x44ef1a(0x158)][_0x44ef1a(0x147)](_0x44ef1a(0x148)+_0x58c690[_0x44ef1a(0x181)]);}}async function recordSequence(_0x4d656b,_0x5d42e5){const _0x22af97=a5_0x5434,_0x403319=(_0x5d42e5[_0x22af97(0x129)]||'')[_0x22af97(0x17f)](),_0x22db11=[_0x22af97(0x16c),_0x22af97(0x1a0),_0x22af97(0x14a),'presence',_0x22af97(0x135),'door',_0x22af97(0x142),'window',_0x22af97(0x176),_0x22af97(0x172),_0x22af97(0x133),_0x22af97(0x15b),'licht','switch',_0x22af97(0x19f),_0x22af97(0x18e),'lampe'];if(!_0x22db11[_0x22af97(0x16e)](_0x150dc2=>_0x403319[_0x22af97(0x15d)](_0x150dc2)))return;if(!_0x5d42e5[_0x22af97(0x184)])return;if(sequenceTimer)clearTimeout(sequenceTimer);activeSequence[_0x22af97(0x156)]({'loc':_0x5d42e5['location']||_0x22af97(0x177),'id':_0x5d42e5['id'],'ts':Date[_0x22af97(0x17c)]()}),sequenceTimer=setTimeout(async()=>{const _0xfd5803=_0x22af97;if(activeSequence[_0xfd5803(0x138)]>0x1)await saveCompletedSequence(_0x4d656b);activeSequence=[];},SEQUENCE_TIMEOUT_MS);}function startExitTimer(_0x421757){const _0x5534d3=a5_0x5434;abortExitTimer(_0x421757),_0x421757['isGracePeriodActive']=!![],_0x421757[_0x5534d3(0x130)]=setTimeout(()=>{_0x421757['isGracePeriodActive']=![];},EXIT_GRACE_PERIOD_SECONDS*0x3e8),_0x421757[_0x5534d3(0x18f)]=setTimeout(()=>{setPresence(_0x421757,![]),_0x421757['exitTimer']=null;},EXIT_TIMER_MINUTES*0x3c*0x3e8);}function abortExitTimer(_0x3d4230){const _0x2a85e6=a5_0x5434;if(_0x3d4230[_0x2a85e6(0x18f)])clearTimeout(_0x3d4230['exitTimer']);if(_0x3d4230['exitGraceTimer'])clearTimeout(_0x3d4230[_0x2a85e6(0x130)]);_0x3d4230[_0x2a85e6(0x18f)]=null,_0x3d4230[_0x2a85e6(0x130)]=null,_0x3d4230[_0x2a85e6(0x15f)]=![];}async function setPresence(_0x156bd4,_0x142cac){const _0x2170e9=a5_0x5434;if(_0x156bd4[_0x2170e9(0x175)]===_0x142cac)return;_0x156bd4['isPresent']=_0x142cac,await _0x156bd4[_0x2170e9(0x154)]('system.isPresent',{'val':_0x142cac,'ack':!![]});}function isRelevantActivity(_0x126659,_0x1aa665){const _0x1a26b3=a5_0x5434;if(!_0x126659)return![];const _0x3e0e71=_0x126659[_0x1a26b3(0x17f)](),_0xa77bbc=_0x1aa665===!![]||_0x1aa665===0x1||_0x1aa665==='on'||_0x1aa665===_0x1a26b3(0x19c);if(!_0xa77bbc)return![];const _0x42096a=[_0x1a26b3(0x16c),_0x1a26b3(0x1a0),_0x1a26b3(0x14a),_0x1a26b3(0x14c),_0x1a26b3(0x135)][_0x1a26b3(0x16e)](_0x1457ef=>_0x3e0e71[_0x1a26b3(0x15d)](_0x1457ef)),_0x1c0519=[_0x1a26b3(0x193),_0x1a26b3(0x142),_0x1a26b3(0x143),_0x1a26b3(0x176),_0x1a26b3(0x13d),_0x1a26b3(0x161),_0x1a26b3(0x141),_0x1a26b3(0x163),'contact','kontakt'][_0x1a26b3(0x16e)](_0x7fdca8=>_0x3e0e71[_0x1a26b3(0x15d)](_0x7fdca8)),_0x163531=['light',_0x1a26b3(0x12c),_0x1a26b3(0x139),_0x1a26b3(0x19f),'dimmer',_0x1a26b3(0x146)]['some'](_0x270794=>_0x3e0e71[_0x1a26b3(0x15d)](_0x270794));return _0x42096a||_0x1c0519||_0x163531;}async function updateHourlyActivity(_0x28a53a,_0x571dd4){const _0x1e8a3f=a5_0x5434;if(!isRelevantActivity(_0x571dd4[_0x1e8a3f(0x129)],_0x571dd4[_0x1e8a3f(0x184)]))return;let _0x1f4233=new Array(0x18)[_0x1e8a3f(0x18b)](0x0),_0x50b1ff=0x0;try{const _0x319de7=await _0x28a53a['getStateAsync']('analysis.health.todayVector');_0x319de7&&_0x319de7[_0x1e8a3f(0x12e)]&&(_0x1f4233=JSON['parse'](_0x319de7[_0x1e8a3f(0x12e)]),_0x50b1ff=_0x319de7['ts']);}catch(_0x52d6f4){}const _0x18245c=new Date(_0x50b1ff),_0x18b698=new Date();_0x18245c[_0x1e8a3f(0x13c)]()!==_0x18b698[_0x1e8a3f(0x13c)]()&&(_0x1f4233=new Array(0x18)[_0x1e8a3f(0x18b)](0x0));const _0x1f125d=_0x18b698[_0x1e8a3f(0x199)]();if(_0x1f4233[_0x1f125d]===undefined)_0x1f4233[_0x1f125d]=0x0;_0x1f4233[_0x1f125d]++,await _0x28a53a[_0x1e8a3f(0x154)]('analysis.health.todayVector',{'val':JSON[_0x1e8a3f(0x12a)](_0x1f4233),'ack':!![]});}function a5_0x5da0(){const _0x5c100f=['SIMULATE_SIGNAL','setStateAsync','1396692PzTWRZ','push','toISOString','log','.1.ACTUAL_TEMPERATURE','from','light','Temperature','includes','.forecast.current.temperature','isGracePeriodActive','location','handle','constructor','schloss','sensorLastValues','161028sdkqZe','.forecast.current.temp','.ACTUAL_TEMPERATURE','valveMapping','number','.1.LEVEL','apply','motion','.1.TEMPERATURE','some','currentSystemMode','weatherInstance','weatherunderground','contact','toString','name','isPresent','fenster','Unknown','lastTrackerEventTime','replace','isExit','isProVersion','now','getForeignStateAsync','.4.VALVE_STATE','toLowerCase','.LEVEL','message','loc','Valve','value','events.history','\x20from\x20','LTM.rawEventLog','outdoorSensorId','303364jzYHLJ','LEVEL','fill','getStateAsync','string','dimmer','exitTimer','LTM.trainingData.sequences','events.lastEvent','14266FIXsmv','door','400524ovwmni','(((.+)+)+)+$','6GWwVNh','.1.VALVE_STATE','logDuplicates','getHours','eventHistory','1312YqmPjn','true','163139rqWiWI','useWeather','schalter','bewegung','type','stringify','sendToPythonWrapper','licht','openweathermap','val','config','exitGraceTimer','round','653165ytsHxq','kontakt','pop','occupancy','20HCkyab','temperatur','length','switch','shift','temperature','getDate','griff','ANALYZE_SEQUENCE','klima','LTM.trainingData.thermodynamics','lock','tür','window','level','STATUS','lampe','error','[RECORDER]\x20Error:\x20','rawEventLog','präsenz','TRACK_EVENT','presence','exports','heizung','parse','unshift','accuweather','debug'];a5_0x5da0=function(){return _0x5c100f;};return a5_0x5da0();}async function processSensorEvent(_0x357035,_0x2328e2,_0x4647b8,_0x4b5d09){const _0x5ec385=a5_0x5434;if(!_0x4b5d09)return null;const _0xcb848b=_0x4647b8[_0x5ec385(0x12e)],_0x228deb=Date['now'](),_0x59b857=_0x357035[_0x5ec385(0x164)][_0x2328e2],_0x36daf1=(_0x4b5d09[_0x5ec385(0x129)]||'')['toLowerCase'](),_0x433c79=_0x36daf1[_0x5ec385(0x15d)](_0x5ec385(0x13b))||_0x36daf1[_0x5ec385(0x15d)](_0x5ec385(0x137))||_0x36daf1[_0x5ec385(0x15d)](_0x5ec385(0x13f))||_0x36daf1['includes'](_0x5ec385(0x14e))||_0x36daf1[_0x5ec385(0x15d)]('thermostat');if(_0x433c79&&typeof _0xcb848b===_0x5ec385(0x169)){if(_0xcb848b>0x50||_0xcb848b<-0x32)return _0x357035[_0x5ec385(0x158)][_0x5ec385(0x152)]('[RECORDER]\x20Ignored\x20implausible\x20temperature:\x20'+_0xcb848b+_0x5ec385(0x186)+_0x2328e2),null;}_0x357035[_0x5ec385(0x164)][_0x2328e2]=_0xcb848b;if(!_0x4b5d09[_0x5ec385(0x198)]&&_0x59b857!=undefined&&_0x59b857==_0xcb848b)return null;_0x357035['isProVersion']&&_0x433c79&&recordThermodynamics(_0x357035,_0x2328e2,_0xcb848b,_0x4b5d09[_0x5ec385(0x160)]);const _0x2346af={'timestamp':_0x228deb,'id':_0x2328e2,'name':_0x4b5d09[_0x5ec385(0x174)],'type':_0x4b5d09[_0x5ec385(0x129)],'location':_0x4b5d09[_0x5ec385(0x160)],'value':_0xcb848b};_0x357035[_0x5ec385(0x19a)][_0x5ec385(0x150)](_0x2346af);if(_0x357035[_0x5ec385(0x19a)]['length']>HISTORY_MAX_SIZE)_0x357035['eventHistory'][_0x5ec385(0x134)]();await _0x357035[_0x5ec385(0x154)](_0x5ec385(0x191),{'val':JSON[_0x5ec385(0x12a)](_0x2346af),'ack':!![]}),await _0x357035[_0x5ec385(0x154)](_0x5ec385(0x185),{'val':JSON[_0x5ec385(0x12a)](_0x357035['eventHistory']),'ack':!![]}),await updateHourlyActivity(_0x357035,_0x2346af);if(_0x357035[_0x5ec385(0x17b)]){_0x357035['rawEventLog'][_0x5ec385(0x156)](_0x2346af);if(_0x357035[_0x5ec385(0x149)][_0x5ec385(0x138)]>RAW_LOG_MAX_SIZE)_0x357035[_0x5ec385(0x149)]['splice'](0x0,_0x357035[_0x5ec385(0x149)][_0x5ec385(0x138)]-RAW_LOG_MAX_SIZE);await _0x357035['setStateAsync'](_0x5ec385(0x187),{'val':JSON['stringify'](_0x357035[_0x5ec385(0x149)]),'ack':!![]}),recordSequence(_0x357035,_0x2346af);}if(_0x4b5d09[_0x5ec385(0x17a)]&&_0xcb848b===!![]){if(_0x357035[_0x5ec385(0x175)]&&!_0x357035[_0x5ec385(0x15f)])startExitTimer(_0x357035);else{if(!_0x357035[_0x5ec385(0x175)])setPresence(_0x357035,!![]);}}else{if(_0x4b5d09[_0x5ec385(0x129)]==='motion'&&_0xcb848b===!![]){if(_0x357035['exitTimer'])abortExitTimer(_0x357035);if(!_0x357035[_0x5ec385(0x175)]&&_0x357035[_0x5ec385(0x16f)]==='normal')setPresence(_0x357035,!![]);}}if(_0x357035[_0x5ec385(0x17b)]&&_0x357035[_0x5ec385(0x12b)]){_0x4b5d09[_0x5ec385(0x129)]===_0x5ec385(0x16c)&&_0xcb848b===!![]&&_0x4b5d09[_0x5ec385(0x160)]&&_0x357035[_0x5ec385(0x12b)](_0x5ec385(0x153),{'room':_0x4b5d09[_0x5ec385(0x160)]});const _0x4e6d85=['door',_0x5ec385(0x142),'window',_0x5ec385(0x176),_0x5ec385(0x13d),_0x5ec385(0x161),_0x5ec385(0x141),'schloss']['some'](_0x16cbca=>_0x36daf1[_0x5ec385(0x15d)](_0x16cbca)),_0x16c2ff=[_0x5ec385(0x15b),_0x5ec385(0x12c),_0x5ec385(0x139),_0x5ec385(0x19f),_0x5ec385(0x18e),_0x5ec385(0x146)]['some'](_0x238577=>_0x36daf1[_0x5ec385(0x15d)](_0x238577)),_0x3d40f2=['motion',_0x5ec385(0x1a0),_0x5ec385(0x14a),_0x5ec385(0x14c),_0x5ec385(0x135)][_0x5ec385(0x16e)](_0x15b414=>_0x36daf1['includes'](_0x15b414));if(_0x4b5d09[_0x5ec385(0x160)]&&(_0x4e6d85||_0x16c2ff||_0x3d40f2)){const _0x11ab6b=_0xcb848b===!![]||typeof _0xcb848b===_0x5ec385(0x169)&&_0xcb848b>0x0,_0x37fef0=_0x4e6d85&&!_0x11ab6b&&_0x59b857!==undefined&&_0x59b857!=_0xcb848b;if(_0x11ab6b||_0x37fef0){const _0x5c3088=_0x357035['lastTrackerEventTime']||_0x228deb,_0xcd72a3=(_0x228deb-_0x5c3088)/0x3e8;_0x357035[_0x5ec385(0x178)]=_0x228deb,_0x357035[_0x5ec385(0x12b)](_0x5ec385(0x14b),{'room':_0x4b5d09[_0x5ec385(0x160)],'dt':_0xcd72a3});}}}return _0x2346af;}module[a5_0xb5184e(0x14d)]={'processSensorEvent':processSensorEvent,'getOutsideTemperatureNumeric':getOutsideTemperatureNumeric,'setPresence':setPresence,'abortExitTimer':abortExitTimer,'startExitTimer':startExitTimer,'isRelevantActivity':isRelevantActivity};