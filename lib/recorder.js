const a5_0x2561c8=a5_0x55f6;(function(_0x209bb4,_0x170817){const _0x12d488=a5_0x55f6,_0xfb4efa=_0x209bb4();while(!![]){try{const _0x500607=-parseInt(_0x12d488(0xa2))/0x1+-parseInt(_0x12d488(0xdc))/0x2+-parseInt(_0x12d488(0xb5))/0x3+parseInt(_0x12d488(0xb1))/0x4+-parseInt(_0x12d488(0xc4))/0x5*(parseInt(_0x12d488(0xc2))/0x6)+parseInt(_0x12d488(0x99))/0x7+parseInt(_0x12d488(0xb4))/0x8*(parseInt(_0x12d488(0xcd))/0x9);if(_0x500607===_0x170817)break;else _0xfb4efa['push'](_0xfb4efa['shift']());}catch(_0x275f79){_0xfb4efa['push'](_0xfb4efa['shift']());}}}(a5_0x1664,0x4dc5e));const a5_0xef7302=(function(){let _0x305f67=!![];return function(_0x4c4d86,_0x44f0eb){const _0x3bfcbc=_0x305f67?function(){const _0x1983e0=a5_0x55f6;if(_0x44f0eb){const _0x3f75bb=_0x44f0eb[_0x1983e0(0xa5)](_0x4c4d86,arguments);return _0x44f0eb=null,_0x3f75bb;}}:function(){};return _0x305f67=![],_0x3bfcbc;};}()),a5_0x233e33=a5_0xef7302(this,function(){const _0x14c703=a5_0x55f6;return a5_0x233e33[_0x14c703(0xae)]()['search'](_0x14c703(0xc0))[_0x14c703(0xae)]()['constructor'](a5_0x233e33)[_0x14c703(0x9e)](_0x14c703(0xc0));});a5_0x233e33();'use strict';function a5_0x55f6(_0x1647d3,_0x56110b){const _0x5d4c50=a5_0x1664();return a5_0x55f6=function(_0x233e33,_0xef7302){_0x233e33=_0x233e33-0x89;let _0x166437=_0x5d4c50[_0x233e33];return _0x166437;},a5_0x55f6(_0x1647d3,_0x56110b);}function a5_0x1664(){const _0x10a5a9=['dimmer','val','apply','map','licht','isExit','round','system.isPresent','isProVersion','bewegung','isPresent','toString','logDuplicates','openweathermap','2286004nkiWJQ','fenster','weatherInstance','3632Qrcwel','862821vmuLYA','getStateAsync','[RECORDER]\x20Error:\x20','events.lastEvent','LTM.trainingData.sequences','events.history','toLowerCase','message','type','präsenz','schalter','(((.+)+)+)+$','error','8628nvMTCr','length','2055PFfoBt','lampe','.Current.Temperature','toISOString','now','occupancy','weatherunderground','door','getForeignStateAsync','14841LLyJNi','unshift','setStateAsync','SIMULATE_SIGNAL','temperatur','location','pop','exitGraceTimer','ANALYZE_SEQUENCE','Unknown','rawEventLog','name','switch','config','sendToPythonWrapper','141310XmaRkF','exports','isGracePeriodActive','exitTimer','window','getHours','normal','parse','LTM.rawEventLog','stringify','eventHistory','useWeather','.forecast.current.temp','includes','push','currentSystemMode','light','1732759KyXqtX','klima','LTM.trainingData.thermodynamics','.NextHours.Location_1.Day_1.current.temp_value','motion','search','daswetter','splice','presence','299846JYQXGH'];a5_0x1664=function(){return _0x10a5a9;};return a5_0x1664();}const HISTORY_MAX_SIZE=0x32,RAW_LOG_MAX_SIZE=0x9c4,THERMO_LOG_SIZE=0x3e8,SEQUENCE_TIMEOUT_MS=0x5*0x3c*0x3e8,MAX_TRAINING_SET_SIZE=0x1f4,EXIT_TIMER_MINUTES=0xf,EXIT_GRACE_PERIOD_SECONDS=0x1e;let activeSequence=[],sequenceTimer=null;async function getOutsideTemperatureNumeric(_0x2fe851){const _0x5844d4=a5_0x55f6;if(_0x2fe851[_0x5844d4(0xda)]['outdoorSensorId'])try{const _0x115b29=await _0x2fe851['getForeignStateAsync'](_0x2fe851[_0x5844d4(0xda)]['outdoorSensorId']);if(_0x115b29&&_0x115b29[_0x5844d4(0xa4)]!==undefined&&_0x115b29['val']!==null)return parseFloat(_0x115b29[_0x5844d4(0xa4)]);}catch(_0x2039a2){}const _0x3133d1=_0x2fe851[_0x5844d4(0xda)][_0x5844d4(0xb3)];if(!_0x2fe851[_0x5844d4(0xda)][_0x5844d4(0x93)]||!_0x3133d1)return null;try{let _0x45a6bc='';if(_0x3133d1['includes']('accuweather'))_0x45a6bc=_0x3133d1+_0x5844d4(0xc6);else{if(_0x3133d1[_0x5844d4(0x95)](_0x5844d4(0x9f)))_0x45a6bc=_0x3133d1+_0x5844d4(0x9c);else{if(_0x3133d1['includes'](_0x5844d4(0xb0)))_0x45a6bc=_0x3133d1+'.forecast.current.temperature';else{if(_0x3133d1[_0x5844d4(0x95)](_0x5844d4(0xca)))_0x45a6bc=_0x3133d1+_0x5844d4(0x94);}}}if(_0x45a6bc){const _0x5658d2=await _0x2fe851[_0x5844d4(0xcc)](_0x45a6bc);if(_0x5658d2&&_0x5658d2[_0x5844d4(0xa4)]!==undefined&&_0x5658d2[_0x5844d4(0xa4)]!==null)return parseFloat(_0x5658d2['val']);}}catch(_0x33c910){}return null;}async function recordThermodynamics(_0x4fb218,_0x6e6edd,_0x52a671,_0x4cacc5){const _0x1b12b7=a5_0x55f6,_0x1a8ff5=await getOutsideTemperatureNumeric(_0x4fb218),_0x494337=await _0x4fb218[_0x1b12b7(0xb6)](_0x1b12b7(0x9b));let _0xc16274=[];if(_0x494337&&_0x494337[_0x1b12b7(0xa4)])try{_0xc16274=JSON[_0x1b12b7(0x8f)](_0x494337[_0x1b12b7(0xa4)]);}catch(_0x98efbb){}_0xc16274[_0x1b12b7(0x96)]({'ts':Date[_0x1b12b7(0xc8)](),'room':_0x4cacc5||_0x1b12b7(0xd6),'t_in':_0x52a671,'t_out':_0x1a8ff5});if(_0xc16274[_0x1b12b7(0xc3)]>THERMO_LOG_SIZE)_0xc16274['shift']();await _0x4fb218[_0x1b12b7(0xcf)](_0x1b12b7(0x9b),{'val':JSON[_0x1b12b7(0x91)](_0xc16274),'ack':!![]});}async function saveCompletedSequence(_0x2e9f0d){const _0x3d2e10=a5_0x55f6;try{const _0x63a93e=await _0x2e9f0d[_0x3d2e10(0xb6)](_0x3d2e10(0xb9));let _0x424e40=[];if(_0x63a93e&&_0x63a93e[_0x3d2e10(0xa4)])try{_0x424e40=JSON[_0x3d2e10(0x8f)](_0x63a93e['val']);}catch(_0x992abf){}const _0x144108=activeSequence[0x0]['ts'],_0x4a4adf=activeSequence[_0x3d2e10(0xa6)](_0x39c955=>({'loc':_0x39c955['loc'],'t_delta':Math[_0x3d2e10(0xa9)]((_0x39c955['ts']-_0x144108)/0x3e8)})),_0x2221c7={'timestamp':new Date(_0x144108)[_0x3d2e10(0xc7)](),'steps':_0x4a4adf,'duration':Math[_0x3d2e10(0xa9)]((activeSequence[activeSequence['length']-0x1]['ts']-_0x144108)/0x3e8),'daytime':new Date(_0x144108)[_0x3d2e10(0x8d)]()};_0x424e40[_0x3d2e10(0x96)](_0x2221c7);if(_0x424e40[_0x3d2e10(0xc3)]>MAX_TRAINING_SET_SIZE)_0x424e40['shift']();await _0x2e9f0d[_0x3d2e10(0xcf)](_0x3d2e10(0xb9),{'val':JSON[_0x3d2e10(0x91)](_0x424e40),'ack':!![]}),_0x2e9f0d[_0x3d2e10(0xab)]&&_0x2e9f0d[_0x3d2e10(0xdb)]&&_0x2e9f0d[_0x3d2e10(0xdb)](_0x3d2e10(0xd5),{'sequence':_0x2221c7});}catch(_0x1c6529){_0x2e9f0d['log'][_0x3d2e10(0xc1)](_0x3d2e10(0xb7)+_0x1c6529[_0x3d2e10(0xbc)]);}}async function recordSequence(_0x25c77a,_0x14fb30){const _0x1b534e=a5_0x55f6,_0x2fafef=(_0x14fb30[_0x1b534e(0xbd)]||'')[_0x1b534e(0xbb)](),_0x1d8d71=[_0x1b534e(0x9d),_0x1b534e(0xac),_0x1b534e(0xbe),_0x1b534e(0xa1),_0x1b534e(0xc9),_0x1b534e(0xcb),'tür',_0x1b534e(0x8c),_0x1b534e(0xb2),'contact','kontakt',_0x1b534e(0x98),_0x1b534e(0xa7),_0x1b534e(0xd9),_0x1b534e(0xbf),_0x1b534e(0xa3),_0x1b534e(0xc5)];if(!_0x1d8d71['some'](_0x569737=>_0x2fafef[_0x1b534e(0x95)](_0x569737)))return;if(!_0x14fb30['value'])return;if(sequenceTimer)clearTimeout(sequenceTimer);activeSequence[_0x1b534e(0x96)]({'loc':_0x14fb30[_0x1b534e(0xd2)]||_0x1b534e(0xd6),'id':_0x14fb30['id'],'ts':Date[_0x1b534e(0xc8)]()}),sequenceTimer=setTimeout(async()=>{const _0x5da1a9=_0x1b534e;if(activeSequence[_0x5da1a9(0xc3)]>0x1)await saveCompletedSequence(_0x25c77a);activeSequence=[];},SEQUENCE_TIMEOUT_MS);}function startExitTimer(_0x208513){const _0x4f166e=a5_0x55f6;abortExitTimer(_0x208513),_0x208513[_0x4f166e(0x8a)]=!![],_0x208513[_0x4f166e(0xd4)]=setTimeout(()=>{_0x208513['isGracePeriodActive']=![];},EXIT_GRACE_PERIOD_SECONDS*0x3e8),_0x208513[_0x4f166e(0x8b)]=setTimeout(()=>{const _0x1df9de=_0x4f166e;setPresence(_0x208513,![]),_0x208513[_0x1df9de(0x8b)]=null;},EXIT_TIMER_MINUTES*0x3c*0x3e8);}function abortExitTimer(_0x164f06){const _0x1e8afc=a5_0x55f6;if(_0x164f06['exitTimer'])clearTimeout(_0x164f06[_0x1e8afc(0x8b)]);if(_0x164f06[_0x1e8afc(0xd4)])clearTimeout(_0x164f06[_0x1e8afc(0xd4)]);_0x164f06[_0x1e8afc(0x8b)]=null,_0x164f06[_0x1e8afc(0xd4)]=null,_0x164f06[_0x1e8afc(0x8a)]=![];}async function setPresence(_0x159fdd,_0x5e14a5){const _0x135386=a5_0x55f6;if(_0x159fdd[_0x135386(0xad)]===_0x5e14a5)return;_0x159fdd[_0x135386(0xad)]=_0x5e14a5,await _0x159fdd['setStateAsync'](_0x135386(0xaa),{'val':_0x5e14a5,'ack':!![]});}async function processSensorEvent(_0x43acd0,_0x38ddb7,_0x29875c,_0x338d8c){const _0xff72f5=a5_0x55f6;if(!_0x338d8c)return null;const _0x28eaee=_0x29875c['val'],_0x112225=Date[_0xff72f5(0xc8)](),_0x55fa54=_0x43acd0['sensorLastValues'][_0x38ddb7];_0x43acd0['sensorLastValues'][_0x38ddb7]=_0x28eaee;if(!_0x338d8c[_0xff72f5(0xaf)]&&_0x55fa54!=undefined&&_0x55fa54==_0x28eaee)return null;const _0x45d2fc=(_0x338d8c[_0xff72f5(0xbd)]||'')['toLowerCase'](),_0x11439c=_0x45d2fc[_0xff72f5(0x95)]('temperature')||_0x45d2fc[_0xff72f5(0x95)](_0xff72f5(0xd1))||_0x45d2fc[_0xff72f5(0x95)](_0xff72f5(0x9a))||_0x45d2fc[_0xff72f5(0x95)]('heizung');_0x43acd0[_0xff72f5(0xab)]&&_0x11439c&&recordThermodynamics(_0x43acd0,_0x38ddb7,_0x28eaee,_0x338d8c[_0xff72f5(0xd2)]);const _0x1859a7={'timestamp':_0x112225,'id':_0x38ddb7,'name':_0x338d8c[_0xff72f5(0xd8)],'type':_0x338d8c['type'],'location':_0x338d8c['location'],'value':_0x28eaee};_0x43acd0[_0xff72f5(0x92)][_0xff72f5(0xce)](_0x1859a7);if(_0x43acd0[_0xff72f5(0x92)][_0xff72f5(0xc3)]>HISTORY_MAX_SIZE)_0x43acd0['eventHistory'][_0xff72f5(0xd3)]();await _0x43acd0[_0xff72f5(0xcf)](_0xff72f5(0xb8),{'val':JSON['stringify'](_0x1859a7),'ack':!![]}),await _0x43acd0[_0xff72f5(0xcf)](_0xff72f5(0xba),{'val':JSON[_0xff72f5(0x91)](_0x43acd0[_0xff72f5(0x92)]),'ack':!![]});if(_0x43acd0[_0xff72f5(0xab)]){_0x43acd0['rawEventLog'][_0xff72f5(0x96)](_0x1859a7);if(_0x43acd0[_0xff72f5(0xd7)][_0xff72f5(0xc3)]>RAW_LOG_MAX_SIZE)_0x43acd0[_0xff72f5(0xd7)][_0xff72f5(0xa0)](0x0,_0x43acd0['rawEventLog'][_0xff72f5(0xc3)]-RAW_LOG_MAX_SIZE);await _0x43acd0[_0xff72f5(0xcf)](_0xff72f5(0x90),{'val':JSON['stringify'](_0x43acd0[_0xff72f5(0xd7)]),'ack':!![]}),recordSequence(_0x43acd0,_0x1859a7);}if(_0x338d8c[_0xff72f5(0xa8)]&&_0x28eaee===!![]){if(_0x43acd0[_0xff72f5(0xad)]&&!_0x43acd0['isGracePeriodActive'])startExitTimer(_0x43acd0);else{if(!_0x43acd0[_0xff72f5(0xad)])setPresence(_0x43acd0,!![]);}}else{if(_0x338d8c[_0xff72f5(0xbd)]==='motion'&&_0x28eaee===!![]){if(_0x43acd0[_0xff72f5(0x8b)])abortExitTimer(_0x43acd0);if(!_0x43acd0[_0xff72f5(0xad)]&&_0x43acd0[_0xff72f5(0x97)]===_0xff72f5(0x8e))setPresence(_0x43acd0,!![]);}}return _0x43acd0[_0xff72f5(0xab)]&&_0x338d8c['type']===_0xff72f5(0x9d)&&_0x28eaee===!![]&&_0x338d8c[_0xff72f5(0xd2)]&&_0x43acd0[_0xff72f5(0xdb)]&&_0x43acd0[_0xff72f5(0xdb)](_0xff72f5(0xd0),{'room':_0x338d8c[_0xff72f5(0xd2)]}),_0x1859a7;}module[a5_0x2561c8(0x89)]={'processSensorEvent':processSensorEvent,'getOutsideTemperatureNumeric':getOutsideTemperatureNumeric,'setPresence':setPresence,'abortExitTimer':abortExitTimer,'startExitTimer':startExitTimer};