const a5_0x4f90b0=a5_0x597c;(function(_0x541c9d,_0x2ac1ca){const _0x231a85=a5_0x597c,_0x1e2956=_0x541c9d();while(!![]){try{const _0xf1f7f3=-parseInt(_0x231a85(0x115))/0x1+parseInt(_0x231a85(0x137))/0x2*(-parseInt(_0x231a85(0x127))/0x3)+-parseInt(_0x231a85(0x15d))/0x4*(-parseInt(_0x231a85(0x11b))/0x5)+-parseInt(_0x231a85(0x108))/0x6*(parseInt(_0x231a85(0x11e))/0x7)+-parseInt(_0x231a85(0x157))/0x8+-parseInt(_0x231a85(0x101))/0x9*(parseInt(_0x231a85(0x116))/0xa)+parseInt(_0x231a85(0x144))/0xb;if(_0xf1f7f3===_0x2ac1ca)break;else _0x1e2956['push'](_0x1e2956['shift']());}catch(_0x30cde0){_0x1e2956['push'](_0x1e2956['shift']());}}}(a5_0x2dbe,0xad5a3));const a5_0x231a6c=(function(){let _0x394c3a=!![];return function(_0x49a3f1,_0x5c4070){const _0x49f700=_0x394c3a?function(){const _0x4bf2b9=a5_0x597c;if(_0x5c4070){const _0x3185da=_0x5c4070[_0x4bf2b9(0x10e)](_0x49a3f1,arguments);return _0x5c4070=null,_0x3185da;}}:function(){};return _0x394c3a=![],_0x49f700;};}()),a5_0x480ff3=a5_0x231a6c(this,function(){const _0x34d571=a5_0x597c;return a5_0x480ff3[_0x34d571(0x123)]()[_0x34d571(0x10a)](_0x34d571(0x16e))[_0x34d571(0x123)]()[_0x34d571(0x143)](a5_0x480ff3)[_0x34d571(0x10a)](_0x34d571(0x16e));});function a5_0x2dbe(){const _0x4c088f=['4880AgnumU','tür','rawEventLog','log','[RECORDER]\x20Ignored\x20implausible\x20temperature:\x20','5trMovE','unshift','lastTrackerEventTime','176071SXOFvr','occupancy','isProVersion','TRACK_EVENT','sensorLastValues','toString','exitTimer','toLowerCase','logDuplicates','483810DfzqNA','getHours','level','openweathermap','number','schloss','light','motion','Valve','LTM.trainingData.thermodynamics','STATUS','isExit','exports','type','exitGraceTimer','config','2xSSkGl','isPresent','schalter','push','parse','fenster','some','location','LTM.rawEventLog','sendToPythonWrapper','getForeignStateAsync','outdoorSensorId','constructor','24764894tOctMN','includes','Temperature','temperatur','.LEVEL','loc','replace','value','griff','presence','.1.LEVEL','klima','getStateAsync','präsenz','thermostat','temperature','accuweather','daswetter','lock','8594736LcmkVc','Unknown','shift','\x20from\x20','kontakt','toISOString','3229208bnahli','isGracePeriodActive','lampe','weatherunderground','.1.VALVE_STATE','from','.ACTUAL_TEMPERATURE','events.lastEvent','pop','.forecast.current.temp','.1.ACTUAL_TEMPERATURE','STATE','length','useWeather','stringify','valveMapping','.1.TEMPERATURE','(((.+)+)+)+$','window','2871PGvXhr','val','dimmer','handle','.forecast.current.temperature','LEVEL','now','180ejuFzq','switch','search','licht','round','.NextHours.Location_1.Day_1.current.temp_value','apply','.4.VALVE_STATE','string','error','eventHistory','door','setStateAsync','202731JfoETb'];a5_0x2dbe=function(){return _0x4c088f;};return a5_0x2dbe();}a5_0x480ff3();'use strict';const HISTORY_MAX_SIZE=0x32,RAW_LOG_MAX_SIZE=0x9c4,THERMO_LOG_SIZE=0x3e8,SEQUENCE_TIMEOUT_MS=0x5*0x3c*0x3e8,MAX_TRAINING_SET_SIZE=0x1f4,EXIT_TIMER_MINUTES=0xf,EXIT_GRACE_PERIOD_SECONDS=0x1e;let activeSequence=[],sequenceTimer=null;function a5_0x597c(_0x4f6a66,_0x456c68){const _0x476a4f=a5_0x2dbe();return a5_0x597c=function(_0x480ff3,_0x231a6c){_0x480ff3=_0x480ff3-0x101;let _0x2dbe51=_0x476a4f[_0x480ff3];return _0x2dbe51;},a5_0x597c(_0x4f6a66,_0x456c68);}async function getOutsideTemperatureNumeric(_0x16f859){const _0x4ff303=a5_0x597c;if(_0x16f859[_0x4ff303(0x136)]['outdoorSensorId'])try{const _0x1023e3=await _0x16f859['getForeignStateAsync'](_0x16f859[_0x4ff303(0x136)][_0x4ff303(0x142)]);if(_0x1023e3&&_0x1023e3[_0x4ff303(0x102)]!==undefined&&_0x1023e3[_0x4ff303(0x102)]!==null)return parseFloat(_0x1023e3[_0x4ff303(0x102)]);}catch(_0xe2042a){}const _0x18ebb9=_0x16f859[_0x4ff303(0x136)]['weatherInstance'];if(!_0x16f859[_0x4ff303(0x136)][_0x4ff303(0x16a)]||!_0x18ebb9)return null;try{let _0x3ff3f3='';if(_0x18ebb9[_0x4ff303(0x145)](_0x4ff303(0x154)))_0x3ff3f3=_0x18ebb9+'.Current.Temperature';else{if(_0x18ebb9[_0x4ff303(0x145)](_0x4ff303(0x155)))_0x3ff3f3=_0x18ebb9+_0x4ff303(0x10d);else{if(_0x18ebb9[_0x4ff303(0x145)](_0x4ff303(0x12a)))_0x3ff3f3=_0x18ebb9+_0x4ff303(0x105);else{if(_0x18ebb9[_0x4ff303(0x145)](_0x4ff303(0x160)))_0x3ff3f3=_0x18ebb9+_0x4ff303(0x166);}}}if(_0x3ff3f3){const _0x3b3dd8=await _0x16f859[_0x4ff303(0x141)](_0x3ff3f3);if(_0x3b3dd8&&_0x3b3dd8['val']!==undefined&&_0x3b3dd8[_0x4ff303(0x102)]!==null)return parseFloat(_0x3b3dd8['val']);}}catch(_0x4de9ef){}return null;}async function recordThermodynamics(_0x1fdc31,_0x6b09cd,_0xd44a96,_0x45065b){const _0x1e715e=a5_0x597c,_0x21ed5a=await getOutsideTemperatureNumeric(_0x1fdc31);if(_0x21ed5a===null)return;let _0x1d76f4=0x0,_0x504027=![];if(_0x1fdc31[_0x1e715e(0x136)][_0x1e715e(0x16c)])try{let _0x5f4345=_0x1fdc31['config'][_0x1e715e(0x16c)];if(typeof _0x5f4345===_0x1e715e(0x110))_0x5f4345=JSON[_0x1e715e(0x13b)](_0x5f4345);if(_0x5f4345[_0x6b09cd]){const _0x4c59de=_0x5f4345[_0x6b09cd],_0x39133b=await _0x1fdc31[_0x1e715e(0x141)](_0x4c59de);if(_0x39133b&&_0x39133b['val']!==null&&_0x39133b[_0x1e715e(0x102)]!==undefined){let _0x1de418=Number(_0x39133b[_0x1e715e(0x102)]);if(_0x1de418<=1.05&&!_0x4c59de[_0x1e715e(0x145)](_0x1e715e(0x131))&&!_0x4c59de['includes'](_0x1e715e(0x168)))_0x1de418=_0x1de418*0x64;_0x1d76f4=Math['round'](_0x1de418),_0x504027=!![];}}}catch(_0x302d32){}if(!_0x504027){const _0x468ca3=[{'from':_0x1e715e(0x167),'to':_0x1e715e(0x14e)},{'from':_0x1e715e(0x167),'to':_0x1e715e(0x161)},{'from':_0x1e715e(0x16d),'to':_0x1e715e(0x10f)},{'from':_0x1e715e(0x163),'to':_0x1e715e(0x148)},{'from':_0x1e715e(0x153),'to':_0x1e715e(0x129)},{'from':_0x1e715e(0x146),'to':_0x1e715e(0x12f)}];for(const _0x12a23d of _0x468ca3){if(_0x6b09cd[_0x1e715e(0x145)](_0x12a23d[_0x1e715e(0x162)])){const _0x4b7f79=_0x6b09cd[_0x1e715e(0x14a)](_0x12a23d[_0x1e715e(0x162)],_0x12a23d['to']);try{const _0x2516cd=await _0x1fdc31[_0x1e715e(0x141)](_0x4b7f79);if(_0x2516cd&&_0x2516cd[_0x1e715e(0x102)]!==null&&_0x2516cd[_0x1e715e(0x102)]!==undefined){let _0x5020e2=Number(_0x2516cd[_0x1e715e(0x102)]);if(typeof _0x5020e2===_0x1e715e(0x12b)){if(_0x5020e2<=1.05&&_0x12a23d['to'][_0x1e715e(0x145)](_0x1e715e(0x106)))_0x5020e2=_0x5020e2*0x64;_0x1d76f4=Math[_0x1e715e(0x10c)](_0x5020e2),_0x504027=!![];break;}}}catch(_0x110896){}}}}const _0xb397ca=await _0x1fdc31[_0x1e715e(0x150)](_0x1e715e(0x130));let _0x4a7bea=[];if(_0xb397ca&&_0xb397ca[_0x1e715e(0x102)])try{_0x4a7bea=JSON[_0x1e715e(0x13b)](_0xb397ca[_0x1e715e(0x102)]);}catch(_0x5a5099){}_0x4a7bea[_0x1e715e(0x13a)]({'ts':Date[_0x1e715e(0x107)](),'room':_0x45065b||_0x1e715e(0x158),'t_in':_0xd44a96,'t_out':_0x21ed5a,'valve':_0x1d76f4});if(_0x4a7bea[_0x1e715e(0x169)]>THERMO_LOG_SIZE)_0x4a7bea[_0x1e715e(0x159)]();await _0x1fdc31['setStateAsync']('LTM.trainingData.thermodynamics',{'val':JSON[_0x1e715e(0x16b)](_0x4a7bea),'ack':!![]});}async function saveCompletedSequence(_0x9b63c8){const _0x50326d=a5_0x597c;try{const _0x351538=await _0x9b63c8[_0x50326d(0x150)]('LTM.trainingData.sequences');let _0x139720=[];if(_0x351538&&_0x351538[_0x50326d(0x102)])try{_0x139720=JSON['parse'](_0x351538['val']);}catch(_0xad427e){}const _0x2cdaba=activeSequence[0x0]['ts'],_0x32e346=activeSequence['map'](_0x400c42=>({'loc':_0x400c42[_0x50326d(0x149)],'t_delta':Math['round']((_0x400c42['ts']-_0x2cdaba)/0x3e8)})),_0x3d1ba4={'timestamp':new Date(_0x2cdaba)[_0x50326d(0x15c)](),'steps':_0x32e346,'duration':Math[_0x50326d(0x10c)]((activeSequence[activeSequence['length']-0x1]['ts']-_0x2cdaba)/0x3e8),'daytime':new Date(_0x2cdaba)[_0x50326d(0x128)]()};_0x139720[_0x50326d(0x13a)](_0x3d1ba4);if(_0x139720[_0x50326d(0x169)]>MAX_TRAINING_SET_SIZE)_0x139720['shift']();await _0x9b63c8[_0x50326d(0x114)]('LTM.trainingData.sequences',{'val':JSON[_0x50326d(0x16b)](_0x139720),'ack':!![]}),_0x9b63c8[_0x50326d(0x120)]&&_0x9b63c8['sendToPythonWrapper']&&_0x9b63c8[_0x50326d(0x140)]('ANALYZE_SEQUENCE',{'sequence':_0x3d1ba4});}catch(_0x25d500){_0x9b63c8[_0x50326d(0x119)][_0x50326d(0x111)]('[RECORDER]\x20Error:\x20'+_0x25d500['message']);}}async function recordSequence(_0x5a4d13,_0x858ed7){const _0x374063=a5_0x597c,_0x55d23d=(_0x858ed7['type']||'')[_0x374063(0x125)](),_0x45158f=[_0x374063(0x12e),'bewegung',_0x374063(0x151),'presence',_0x374063(0x11f),_0x374063(0x113),_0x374063(0x117),_0x374063(0x16f),_0x374063(0x13c),'contact',_0x374063(0x15b),_0x374063(0x12d),_0x374063(0x10b),'switch',_0x374063(0x139),_0x374063(0x103),_0x374063(0x15f)];if(!_0x45158f[_0x374063(0x13d)](_0x473937=>_0x55d23d[_0x374063(0x145)](_0x473937)))return;if(!_0x858ed7[_0x374063(0x14b)])return;if(sequenceTimer)clearTimeout(sequenceTimer);activeSequence['push']({'loc':_0x858ed7[_0x374063(0x13e)]||_0x374063(0x158),'id':_0x858ed7['id'],'ts':Date['now']()}),sequenceTimer=setTimeout(async()=>{const _0x3febe9=_0x374063;if(activeSequence[_0x3febe9(0x169)]>0x1)await saveCompletedSequence(_0x5a4d13);activeSequence=[];},SEQUENCE_TIMEOUT_MS);}function startExitTimer(_0x5a8bf3){const _0x107883=a5_0x597c;abortExitTimer(_0x5a8bf3),_0x5a8bf3['isGracePeriodActive']=!![],_0x5a8bf3[_0x107883(0x135)]=setTimeout(()=>{_0x5a8bf3['isGracePeriodActive']=![];},EXIT_GRACE_PERIOD_SECONDS*0x3e8),_0x5a8bf3[_0x107883(0x124)]=setTimeout(()=>{const _0xb5e74=_0x107883;setPresence(_0x5a8bf3,![]),_0x5a8bf3[_0xb5e74(0x124)]=null;},EXIT_TIMER_MINUTES*0x3c*0x3e8);}function abortExitTimer(_0x3b2873){const _0x47733e=a5_0x597c;if(_0x3b2873[_0x47733e(0x124)])clearTimeout(_0x3b2873[_0x47733e(0x124)]);if(_0x3b2873[_0x47733e(0x135)])clearTimeout(_0x3b2873['exitGraceTimer']);_0x3b2873['exitTimer']=null,_0x3b2873['exitGraceTimer']=null,_0x3b2873[_0x47733e(0x15e)]=![];}async function setPresence(_0x19fd90,_0x1707c7){const _0x459153=a5_0x597c;if(_0x19fd90[_0x459153(0x138)]===_0x1707c7)return;_0x19fd90[_0x459153(0x138)]=_0x1707c7,await _0x19fd90[_0x459153(0x114)]('system.isPresent',{'val':_0x1707c7,'ack':!![]});}async function processSensorEvent(_0x3ca071,_0x3b1dc6,_0x1fe09a,_0x1a1d6f){const _0x5ae4b1=a5_0x597c;if(!_0x1a1d6f)return null;const _0x463ff5=_0x1fe09a[_0x5ae4b1(0x102)],_0x13313c=Date[_0x5ae4b1(0x107)](),_0x47f229=_0x3ca071[_0x5ae4b1(0x122)][_0x3b1dc6],_0x87dc6f=(_0x1a1d6f[_0x5ae4b1(0x134)]||'')['toLowerCase'](),_0x272293=_0x87dc6f[_0x5ae4b1(0x145)]('temperature')||_0x87dc6f[_0x5ae4b1(0x145)](_0x5ae4b1(0x147))||_0x87dc6f[_0x5ae4b1(0x145)](_0x5ae4b1(0x14f))||_0x87dc6f['includes']('heizung')||_0x87dc6f[_0x5ae4b1(0x145)](_0x5ae4b1(0x152));if(_0x272293&&typeof _0x463ff5===_0x5ae4b1(0x12b)){if(_0x463ff5>0x50||_0x463ff5<-0x32)return _0x3ca071[_0x5ae4b1(0x119)]['debug'](_0x5ae4b1(0x11a)+_0x463ff5+_0x5ae4b1(0x15a)+_0x3b1dc6),null;}_0x3ca071[_0x5ae4b1(0x122)][_0x3b1dc6]=_0x463ff5;if(!_0x1a1d6f[_0x5ae4b1(0x126)]&&_0x47f229!=undefined&&_0x47f229==_0x463ff5)return null;_0x3ca071[_0x5ae4b1(0x120)]&&_0x272293&&recordThermodynamics(_0x3ca071,_0x3b1dc6,_0x463ff5,_0x1a1d6f[_0x5ae4b1(0x13e)]);const _0x4d70ba={'timestamp':_0x13313c,'id':_0x3b1dc6,'name':_0x1a1d6f['name'],'type':_0x1a1d6f['type'],'location':_0x1a1d6f['location'],'value':_0x463ff5};_0x3ca071[_0x5ae4b1(0x112)][_0x5ae4b1(0x11c)](_0x4d70ba);if(_0x3ca071[_0x5ae4b1(0x112)][_0x5ae4b1(0x169)]>HISTORY_MAX_SIZE)_0x3ca071[_0x5ae4b1(0x112)][_0x5ae4b1(0x165)]();await _0x3ca071[_0x5ae4b1(0x114)](_0x5ae4b1(0x164),{'val':JSON['stringify'](_0x4d70ba),'ack':!![]}),await _0x3ca071[_0x5ae4b1(0x114)]('events.history',{'val':JSON[_0x5ae4b1(0x16b)](_0x3ca071['eventHistory']),'ack':!![]});if(_0x3ca071[_0x5ae4b1(0x120)]){_0x3ca071[_0x5ae4b1(0x118)][_0x5ae4b1(0x13a)](_0x4d70ba);if(_0x3ca071[_0x5ae4b1(0x118)][_0x5ae4b1(0x169)]>RAW_LOG_MAX_SIZE)_0x3ca071[_0x5ae4b1(0x118)]['splice'](0x0,_0x3ca071[_0x5ae4b1(0x118)][_0x5ae4b1(0x169)]-RAW_LOG_MAX_SIZE);await _0x3ca071[_0x5ae4b1(0x114)](_0x5ae4b1(0x13f),{'val':JSON['stringify'](_0x3ca071['rawEventLog']),'ack':!![]}),recordSequence(_0x3ca071,_0x4d70ba);}if(_0x1a1d6f[_0x5ae4b1(0x132)]&&_0x463ff5===!![]){if(_0x3ca071['isPresent']&&!_0x3ca071[_0x5ae4b1(0x15e)])startExitTimer(_0x3ca071);else{if(!_0x3ca071['isPresent'])setPresence(_0x3ca071,!![]);}}else{if(_0x1a1d6f[_0x5ae4b1(0x134)]===_0x5ae4b1(0x12e)&&_0x463ff5===!![]){if(_0x3ca071[_0x5ae4b1(0x124)])abortExitTimer(_0x3ca071);if(!_0x3ca071['isPresent']&&_0x3ca071['currentSystemMode']==='normal')setPresence(_0x3ca071,!![]);}}if(_0x3ca071[_0x5ae4b1(0x120)]&&_0x3ca071[_0x5ae4b1(0x140)]){_0x1a1d6f[_0x5ae4b1(0x134)]===_0x5ae4b1(0x12e)&&_0x463ff5===!![]&&_0x1a1d6f[_0x5ae4b1(0x13e)]&&_0x3ca071[_0x5ae4b1(0x140)]('SIMULATE_SIGNAL',{'room':_0x1a1d6f[_0x5ae4b1(0x13e)]});const _0x33bec8=[_0x5ae4b1(0x113),_0x5ae4b1(0x117),_0x5ae4b1(0x16f),'fenster',_0x5ae4b1(0x14c),_0x5ae4b1(0x104),_0x5ae4b1(0x156),_0x5ae4b1(0x12c)][_0x5ae4b1(0x13d)](_0x54c009=>_0x87dc6f[_0x5ae4b1(0x145)](_0x54c009)),_0x68c406=[_0x5ae4b1(0x12d),_0x5ae4b1(0x10b),_0x5ae4b1(0x109),'schalter',_0x5ae4b1(0x103),_0x5ae4b1(0x15f)][_0x5ae4b1(0x13d)](_0x297b66=>_0x87dc6f[_0x5ae4b1(0x145)](_0x297b66)),_0x7f1625=[_0x5ae4b1(0x12e),'bewegung',_0x5ae4b1(0x151),_0x5ae4b1(0x14d),_0x5ae4b1(0x11f)][_0x5ae4b1(0x13d)](_0x1cad95=>_0x87dc6f[_0x5ae4b1(0x145)](_0x1cad95));if(_0x1a1d6f[_0x5ae4b1(0x13e)]&&(_0x33bec8||_0x68c406||_0x7f1625)){const _0x418b62=_0x463ff5===!![]||typeof _0x463ff5===_0x5ae4b1(0x12b)&&_0x463ff5>0x0,_0x334973=_0x33bec8&&!_0x418b62&&_0x47f229!==undefined&&_0x47f229!=_0x463ff5;if(_0x418b62||_0x334973){const _0x432566=_0x3ca071[_0x5ae4b1(0x11d)]||_0x13313c,_0x44b001=(_0x13313c-_0x432566)/0x3e8;_0x3ca071['lastTrackerEventTime']=_0x13313c,_0x3ca071[_0x5ae4b1(0x140)](_0x5ae4b1(0x121),{'room':_0x1a1d6f[_0x5ae4b1(0x13e)],'dt':_0x44b001});}}}return _0x4d70ba;}module[a5_0x4f90b0(0x133)]={'processSensorEvent':processSensorEvent,'getOutsideTemperatureNumeric':getOutsideTemperatureNumeric,'setPresence':setPresence,'abortExitTimer':abortExitTimer,'startExitTimer':startExitTimer};