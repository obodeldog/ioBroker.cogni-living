const a5_0x5c67c1=a5_0x29f4;(function(_0x39fb57,_0x4e4098){const _0x207356=a5_0x29f4,_0x403396=_0x39fb57();while(!![]){try{const _0x148d90=parseInt(_0x207356(0xaf))/0x1+-parseInt(_0x207356(0x77))/0x2*(parseInt(_0x207356(0x8d))/0x3)+parseInt(_0x207356(0xd1))/0x4+-parseInt(_0x207356(0xc1))/0x5*(parseInt(_0x207356(0x83))/0x6)+parseInt(_0x207356(0x7e))/0x7*(-parseInt(_0x207356(0xd8))/0x8)+parseInt(_0x207356(0x74))/0x9+parseInt(_0x207356(0xbb))/0xa;if(_0x148d90===_0x4e4098)break;else _0x403396['push'](_0x403396['shift']());}catch(_0x99a9c1){_0x403396['push'](_0x403396['shift']());}}}(a5_0x1afd,0xc2684));const a5_0x1182d2=(function(){let _0x366482=!![];return function(_0x233acb,_0x5d6292){const _0x31c2ce=_0x366482?function(){if(_0x5d6292){const _0x92a86f=_0x5d6292['apply'](_0x233acb,arguments);return _0x5d6292=null,_0x92a86f;}}:function(){};return _0x366482=![],_0x31c2ce;};}()),a5_0x270e98=a5_0x1182d2(this,function(){const _0x637d09=a5_0x29f4;return a5_0x270e98['toString']()[_0x637d09(0xcb)](_0x637d09(0x86))[_0x637d09(0x8c)]()[_0x637d09(0x7b)](a5_0x270e98)[_0x637d09(0xcb)]('(((.+)+)+)+$');});a5_0x270e98();'use strict';const HISTORY_MAX_SIZE=0x32,RAW_LOG_MAX_SIZE=0x9c4,THERMO_LOG_SIZE=0x3e8,SEQUENCE_TIMEOUT_MS=0x5*0x3c*0x3e8,MAX_TRAINING_SET_SIZE=0x1f4,EXIT_TIMER_MINUTES=0xf,EXIT_GRACE_PERIOD_SECONDS=0x1e;let activeSequence=[],sequenceTimer=null;async function getOutsideTemperatureNumeric(_0xece4ca){const _0x48c284=a5_0x29f4;if(_0xece4ca[_0x48c284(0xab)][_0x48c284(0x8a)])try{const _0x430fb8=await _0xece4ca[_0x48c284(0xdd)](_0xece4ca[_0x48c284(0xab)][_0x48c284(0x8a)]);if(_0x430fb8&&_0x430fb8['val']!==undefined&&_0x430fb8[_0x48c284(0x85)]!==null)return parseFloat(_0x430fb8['val']);}catch(_0x271dbf){}const _0x4c5751=_0xece4ca['config'][_0x48c284(0xa5)];if(!_0xece4ca[_0x48c284(0xab)]['useWeather']||!_0x4c5751)return null;try{let _0x141d91='';if(_0x4c5751[_0x48c284(0xd4)]('accuweather'))_0x141d91=_0x4c5751+_0x48c284(0x78);else{if(_0x4c5751[_0x48c284(0xd4)](_0x48c284(0x75)))_0x141d91=_0x4c5751+_0x48c284(0xa0);else{if(_0x4c5751['includes']('openweathermap'))_0x141d91=_0x4c5751+_0x48c284(0xaa);else{if(_0x4c5751[_0x48c284(0xd4)](_0x48c284(0xb2)))_0x141d91=_0x4c5751+_0x48c284(0xa6);}}}if(_0x141d91){const _0x23539f=await _0xece4ca[_0x48c284(0xdd)](_0x141d91);if(_0x23539f&&_0x23539f['val']!==undefined&&_0x23539f['val']!==null)return parseFloat(_0x23539f['val']);}}catch(_0xa9de1a){}return null;}function a5_0x1afd(){const _0x862b38=['578952eRkxTL','isExit','griff','\x20from\x20','dimmer','getForeignStateAsync','length','schalter','klima','now','3767787LzenhI','daswetter','isGracePeriodActive','790186jSwKVb','.Current.Temperature','isPresent','value','constructor','replace','getStateAsync','7XQxCLt','sendToPythonWrapper','handle','[RECORDER]\x20Ignored\x20implausible\x20temperature:\x20','from','2699556YiUJCW','[RECORDER]\x20Error:\x20','val','(((.+)+)+)+$','normal','Temperature','shift','outdoorSensorId','lastTrackerEventTime','toString','6tnlsvg','loc','exitTimer','lock','rawEventLog','Valve','fenster','level','.1.VALVE_STATE','temperature','heizung','isProVersion','parse','sensorLastValues','licht','logDuplicates','valveMapping','TRACK_EVENT','lampe','.NextHours.Location_1.Day_1.current.temp_value','number','ANALYZE_SEQUENCE','debug','exports','weatherInstance','.forecast.current.temp','bewegung','push','door','.forecast.current.temperature','config','LTM.trainingData.thermodynamics','window','message','121833SUiIXh','events.lastEvent','stringify','weatherunderground','name','splice','events.history','map','log','setStateAsync','pr채senz','temperatur','13725180XwNujv','exitGraceTimer','occupancy','STATUS','eventHistory','location','10HpHMRU','pop','kontakt','type','round','schloss','motion','currentSystemMode','LTM.trainingData.sequences','string','search','.1.LEVEL','.LEVEL','some','thermostat','switch','2582820WhdyKx','light','contact','includes','t체r','unshift','presence'];a5_0x1afd=function(){return _0x862b38;};return a5_0x1afd();}async function recordThermodynamics(_0x141a98,_0x377cee,_0x329029,_0x34f81f){const _0x4924ad=a5_0x29f4,_0x199352=await getOutsideTemperatureNumeric(_0x141a98);if(_0x199352===null)return;let _0x179395=0x0,_0x588aaf=![];if(_0x141a98[_0x4924ad(0xab)][_0x4924ad(0x9d)])try{let _0x45a525=_0x141a98[_0x4924ad(0xab)][_0x4924ad(0x9d)];if(typeof _0x45a525===_0x4924ad(0xca))_0x45a525=JSON[_0x4924ad(0x99)](_0x45a525);if(_0x45a525[_0x377cee]){const _0x3686b0=_0x45a525[_0x377cee],_0xa48993=await _0x141a98[_0x4924ad(0xdd)](_0x3686b0);if(_0xa48993&&_0xa48993[_0x4924ad(0x85)]!==null&&_0xa48993[_0x4924ad(0x85)]!==undefined){let _0x29187c=Number(_0xa48993[_0x4924ad(0x85)]);if(_0x29187c<=1.05&&!_0x3686b0['includes'](_0x4924ad(0xbe))&&!_0x3686b0[_0x4924ad(0xd4)]('STATE'))_0x29187c=_0x29187c*0x64;_0x179395=Math[_0x4924ad(0xc5)](_0x29187c),_0x588aaf=!![];}}}catch(_0x895495){}if(!_0x588aaf){const _0x3a7eb2=[{'from':'.1.ACTUAL_TEMPERATURE','to':_0x4924ad(0xcc)},{'from':'.1.ACTUAL_TEMPERATURE','to':_0x4924ad(0x95)},{'from':'.1.TEMPERATURE','to':'.4.VALVE_STATE'},{'from':'.ACTUAL_TEMPERATURE','to':_0x4924ad(0xcd)},{'from':_0x4924ad(0x96),'to':_0x4924ad(0x94)},{'from':_0x4924ad(0x88),'to':_0x4924ad(0x92)}];for(const _0x364076 of _0x3a7eb2){if(_0x377cee[_0x4924ad(0xd4)](_0x364076[_0x4924ad(0x82)])){const _0x1c1259=_0x377cee[_0x4924ad(0x7c)](_0x364076[_0x4924ad(0x82)],_0x364076['to']);try{const _0x6c67be=await _0x141a98['getForeignStateAsync'](_0x1c1259);if(_0x6c67be&&_0x6c67be[_0x4924ad(0x85)]!==null&&_0x6c67be[_0x4924ad(0x85)]!==undefined){let _0x1413f8=Number(_0x6c67be[_0x4924ad(0x85)]);if(typeof _0x1413f8===_0x4924ad(0xa1)){if(_0x1413f8<=1.05&&_0x364076['to'][_0x4924ad(0xd4)]('LEVEL'))_0x1413f8=_0x1413f8*0x64;_0x179395=Math[_0x4924ad(0xc5)](_0x1413f8),_0x588aaf=!![];break;}}}catch(_0x3ba614){}}}}const _0x3ddb75=await _0x141a98[_0x4924ad(0x7d)](_0x4924ad(0xac));let _0x55755b=[];if(_0x3ddb75&&_0x3ddb75[_0x4924ad(0x85)])try{_0x55755b=JSON[_0x4924ad(0x99)](_0x3ddb75['val']);}catch(_0x5b3275){}_0x55755b[_0x4924ad(0xa8)]({'ts':Date[_0x4924ad(0x73)](),'room':_0x34f81f||'Unknown','t_in':_0x329029,'t_out':_0x199352,'valve':_0x179395});if(_0x55755b[_0x4924ad(0xde)]>THERMO_LOG_SIZE)_0x55755b[_0x4924ad(0x89)]();await _0x141a98['setStateAsync'](_0x4924ad(0xac),{'val':JSON[_0x4924ad(0xb1)](_0x55755b),'ack':!![]});}async function saveCompletedSequence(_0x759bb6){const _0x284f54=a5_0x29f4;try{const _0x441845=await _0x759bb6[_0x284f54(0x7d)](_0x284f54(0xc9));let _0x4054c0=[];if(_0x441845&&_0x441845['val'])try{_0x4054c0=JSON['parse'](_0x441845[_0x284f54(0x85)]);}catch(_0xc3c1b4){}const _0x4fa8e5=activeSequence[0x0]['ts'],_0x670b3b=activeSequence[_0x284f54(0xb6)](_0x48cbdd=>({'loc':_0x48cbdd[_0x284f54(0x8e)],'t_delta':Math['round']((_0x48cbdd['ts']-_0x4fa8e5)/0x3e8)})),_0x4a69a2={'timestamp':new Date(_0x4fa8e5)['toISOString'](),'steps':_0x670b3b,'duration':Math[_0x284f54(0xc5)]((activeSequence[activeSequence[_0x284f54(0xde)]-0x1]['ts']-_0x4fa8e5)/0x3e8),'daytime':new Date(_0x4fa8e5)['getHours']()};_0x4054c0[_0x284f54(0xa8)](_0x4a69a2);if(_0x4054c0['length']>MAX_TRAINING_SET_SIZE)_0x4054c0['shift']();await _0x759bb6[_0x284f54(0xb8)](_0x284f54(0xc9),{'val':JSON[_0x284f54(0xb1)](_0x4054c0),'ack':!![]}),_0x759bb6[_0x284f54(0x98)]&&_0x759bb6[_0x284f54(0x7f)]&&_0x759bb6[_0x284f54(0x7f)](_0x284f54(0xa2),{'sequence':_0x4a69a2});}catch(_0x1683ca){_0x759bb6['log']['error'](_0x284f54(0x84)+_0x1683ca[_0x284f54(0xae)]);}}function a5_0x29f4(_0x35f1ba,_0x42a9d3){const _0x21637a=a5_0x1afd();return a5_0x29f4=function(_0x270e98,_0x1182d2){_0x270e98=_0x270e98-0x72;let _0x1afd19=_0x21637a[_0x270e98];return _0x1afd19;},a5_0x29f4(_0x35f1ba,_0x42a9d3);}async function recordSequence(_0x1604fc,_0x15401b){const _0xd1b538=a5_0x29f4,_0x93b34a=(_0x15401b[_0xd1b538(0xc4)]||'')['toLowerCase'](),_0xa2391f=[_0xd1b538(0xc7),_0xd1b538(0xa7),_0xd1b538(0xb9),_0xd1b538(0xd7),_0xd1b538(0xbd),_0xd1b538(0xa9),_0xd1b538(0xd5),'window',_0xd1b538(0x93),_0xd1b538(0xd3),_0xd1b538(0xc3),_0xd1b538(0xd2),_0xd1b538(0x9b),_0xd1b538(0xd0),_0xd1b538(0xdf),_0xd1b538(0xdc),_0xd1b538(0x9f)];if(!_0xa2391f['some'](_0x1edd6f=>_0x93b34a[_0xd1b538(0xd4)](_0x1edd6f)))return;if(!_0x15401b[_0xd1b538(0x7a)])return;if(sequenceTimer)clearTimeout(sequenceTimer);activeSequence[_0xd1b538(0xa8)]({'loc':_0x15401b[_0xd1b538(0xc0)]||'Unknown','id':_0x15401b['id'],'ts':Date[_0xd1b538(0x73)]()}),sequenceTimer=setTimeout(async()=>{const _0x841e01=_0xd1b538;if(activeSequence[_0x841e01(0xde)]>0x1)await saveCompletedSequence(_0x1604fc);activeSequence=[];},SEQUENCE_TIMEOUT_MS);}function startExitTimer(_0xcce359){const _0x16677e=a5_0x29f4;abortExitTimer(_0xcce359),_0xcce359[_0x16677e(0x76)]=!![],_0xcce359[_0x16677e(0xbc)]=setTimeout(()=>{const _0x3bae04=_0x16677e;_0xcce359[_0x3bae04(0x76)]=![];},EXIT_GRACE_PERIOD_SECONDS*0x3e8),_0xcce359['exitTimer']=setTimeout(()=>{const _0x5860d6=_0x16677e;setPresence(_0xcce359,![]),_0xcce359[_0x5860d6(0x8f)]=null;},EXIT_TIMER_MINUTES*0x3c*0x3e8);}function abortExitTimer(_0x4ea0f6){const _0x1cf6df=a5_0x29f4;if(_0x4ea0f6[_0x1cf6df(0x8f)])clearTimeout(_0x4ea0f6[_0x1cf6df(0x8f)]);if(_0x4ea0f6[_0x1cf6df(0xbc)])clearTimeout(_0x4ea0f6[_0x1cf6df(0xbc)]);_0x4ea0f6[_0x1cf6df(0x8f)]=null,_0x4ea0f6[_0x1cf6df(0xbc)]=null,_0x4ea0f6[_0x1cf6df(0x76)]=![];}async function setPresence(_0xdaf0f8,_0x314a90){const _0x156b84=a5_0x29f4;if(_0xdaf0f8[_0x156b84(0x79)]===_0x314a90)return;_0xdaf0f8[_0x156b84(0x79)]=_0x314a90,await _0xdaf0f8['setStateAsync']('system.isPresent',{'val':_0x314a90,'ack':!![]});}async function processSensorEvent(_0x4ce005,_0x5ccda6,_0x392f29,_0x3a26f7){const _0x17b70b=a5_0x29f4;if(!_0x3a26f7)return null;const _0x55b9c0=_0x392f29[_0x17b70b(0x85)],_0x371239=Date[_0x17b70b(0x73)](),_0x12c484=_0x4ce005[_0x17b70b(0x9a)][_0x5ccda6],_0x4a08c0=(_0x3a26f7['type']||'')['toLowerCase'](),_0x4479d2=_0x4a08c0[_0x17b70b(0xd4)](_0x17b70b(0x96))||_0x4a08c0[_0x17b70b(0xd4)](_0x17b70b(0xba))||_0x4a08c0[_0x17b70b(0xd4)](_0x17b70b(0x72))||_0x4a08c0['includes'](_0x17b70b(0x97))||_0x4a08c0[_0x17b70b(0xd4)](_0x17b70b(0xcf));if(_0x4479d2&&typeof _0x55b9c0===_0x17b70b(0xa1)){if(_0x55b9c0>0x50||_0x55b9c0<-0x32)return _0x4ce005[_0x17b70b(0xb7)][_0x17b70b(0xa3)](_0x17b70b(0x81)+_0x55b9c0+_0x17b70b(0xdb)+_0x5ccda6),null;}_0x4ce005[_0x17b70b(0x9a)][_0x5ccda6]=_0x55b9c0;if(!_0x3a26f7[_0x17b70b(0x9c)]&&_0x12c484!=undefined&&_0x12c484==_0x55b9c0)return null;_0x4ce005[_0x17b70b(0x98)]&&_0x4479d2&&recordThermodynamics(_0x4ce005,_0x5ccda6,_0x55b9c0,_0x3a26f7[_0x17b70b(0xc0)]);const _0x208f84={'timestamp':_0x371239,'id':_0x5ccda6,'name':_0x3a26f7[_0x17b70b(0xb3)],'type':_0x3a26f7[_0x17b70b(0xc4)],'location':_0x3a26f7[_0x17b70b(0xc0)],'value':_0x55b9c0};_0x4ce005['eventHistory'][_0x17b70b(0xd6)](_0x208f84);if(_0x4ce005['eventHistory']['length']>HISTORY_MAX_SIZE)_0x4ce005[_0x17b70b(0xbf)][_0x17b70b(0xc2)]();await _0x4ce005[_0x17b70b(0xb8)](_0x17b70b(0xb0),{'val':JSON['stringify'](_0x208f84),'ack':!![]}),await _0x4ce005[_0x17b70b(0xb8)](_0x17b70b(0xb5),{'val':JSON[_0x17b70b(0xb1)](_0x4ce005[_0x17b70b(0xbf)]),'ack':!![]});if(_0x4ce005[_0x17b70b(0x98)]){_0x4ce005['rawEventLog'][_0x17b70b(0xa8)](_0x208f84);if(_0x4ce005[_0x17b70b(0x91)][_0x17b70b(0xde)]>RAW_LOG_MAX_SIZE)_0x4ce005[_0x17b70b(0x91)][_0x17b70b(0xb4)](0x0,_0x4ce005[_0x17b70b(0x91)][_0x17b70b(0xde)]-RAW_LOG_MAX_SIZE);await _0x4ce005[_0x17b70b(0xb8)]('LTM.rawEventLog',{'val':JSON['stringify'](_0x4ce005[_0x17b70b(0x91)]),'ack':!![]}),recordSequence(_0x4ce005,_0x208f84);}if(_0x3a26f7[_0x17b70b(0xd9)]&&_0x55b9c0===!![]){if(_0x4ce005[_0x17b70b(0x79)]&&!_0x4ce005['isGracePeriodActive'])startExitTimer(_0x4ce005);else{if(!_0x4ce005[_0x17b70b(0x79)])setPresence(_0x4ce005,!![]);}}else{if(_0x3a26f7['type']==='motion'&&_0x55b9c0===!![]){if(_0x4ce005[_0x17b70b(0x8f)])abortExitTimer(_0x4ce005);if(!_0x4ce005[_0x17b70b(0x79)]&&_0x4ce005[_0x17b70b(0xc8)]===_0x17b70b(0x87))setPresence(_0x4ce005,!![]);}}if(_0x4ce005[_0x17b70b(0x98)]&&_0x4ce005[_0x17b70b(0x7f)]){_0x3a26f7[_0x17b70b(0xc4)]===_0x17b70b(0xc7)&&_0x55b9c0===!![]&&_0x3a26f7[_0x17b70b(0xc0)]&&_0x4ce005[_0x17b70b(0x7f)]('SIMULATE_SIGNAL',{'room':_0x3a26f7[_0x17b70b(0xc0)]});const _0x533224=[_0x17b70b(0xa9),'t체r',_0x17b70b(0xad),_0x17b70b(0x93),_0x17b70b(0xda),_0x17b70b(0x80),_0x17b70b(0x90),_0x17b70b(0xc6)][_0x17b70b(0xce)](_0x447242=>_0x4a08c0[_0x17b70b(0xd4)](_0x447242)),_0x10c477=[_0x17b70b(0xd2),'licht',_0x17b70b(0xd0),'schalter',_0x17b70b(0xdc),_0x17b70b(0x9f)]['some'](_0x56e445=>_0x4a08c0[_0x17b70b(0xd4)](_0x56e445)),_0xb5f019=[_0x17b70b(0xc7),'bewegung','pr채senz',_0x17b70b(0xd7),_0x17b70b(0xbd)]['some'](_0x3e75df=>_0x4a08c0[_0x17b70b(0xd4)](_0x3e75df));if(_0x3a26f7[_0x17b70b(0xc0)]&&(_0x533224||_0x10c477||_0xb5f019)){const _0x5cde3d=_0x55b9c0===!![]||typeof _0x55b9c0===_0x17b70b(0xa1)&&_0x55b9c0>0x0,_0x5845b3=_0x533224&&!_0x5cde3d&&_0x12c484!==undefined&&_0x12c484!=_0x55b9c0;if(_0x5cde3d||_0x5845b3){const _0x2faba5=_0x4ce005[_0x17b70b(0x8b)]||_0x371239,_0x5af824=(_0x371239-_0x2faba5)/0x3e8;_0x4ce005[_0x17b70b(0x8b)]=_0x371239,_0x4ce005[_0x17b70b(0x7f)](_0x17b70b(0x9e),{'room':_0x3a26f7[_0x17b70b(0xc0)],'dt':_0x5af824});}}}return _0x208f84;}module[a5_0x5c67c1(0xa4)]={'processSensorEvent':processSensorEvent,'getOutsideTemperatureNumeric':getOutsideTemperatureNumeric,'setPresence':setPresence,'abortExitTimer':abortExitTimer,'startExitTimer':startExitTimer};