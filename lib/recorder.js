const a5_0x4dbd1c=a5_0x1310;(function(_0x2c8b2f,_0x102d62){const _0x3414d1=a5_0x1310,_0x4c459c=_0x2c8b2f();while(!![]){try{const _0x5839f5=-parseInt(_0x3414d1(0x1e9))/0x1+parseInt(_0x3414d1(0x227))/0x2+-parseInt(_0x3414d1(0x1e7))/0x3+parseInt(_0x3414d1(0x21b))/0x4+-parseInt(_0x3414d1(0x1df))/0x5*(parseInt(_0x3414d1(0x1ea))/0x6)+parseInt(_0x3414d1(0x220))/0x7*(-parseInt(_0x3414d1(0x21f))/0x8)+-parseInt(_0x3414d1(0x1e5))/0x9*(-parseInt(_0x3414d1(0x1f9))/0xa);if(_0x5839f5===_0x102d62)break;else _0x4c459c['push'](_0x4c459c['shift']());}catch(_0x230639){_0x4c459c['push'](_0x4c459c['shift']());}}}(a5_0x29dd,0x85979));function a5_0x1310(_0x548208,_0x26b4ef){const _0x21db7d=a5_0x29dd();return a5_0x1310=function(_0x3ad443,_0xb35089){_0x3ad443=_0x3ad443-0x1d1;let _0x29dd47=_0x21db7d[_0x3ad443];return _0x29dd47;},a5_0x1310(_0x548208,_0x26b4ef);}const a5_0xb35089=(function(){let _0x2f1063=!![];return function(_0x2d7f9d,_0x1424ab){const _0x294da0=_0x2f1063?function(){if(_0x1424ab){const _0x5f2ecc=_0x1424ab['apply'](_0x2d7f9d,arguments);return _0x1424ab=null,_0x5f2ecc;}}:function(){};return _0x2f1063=![],_0x294da0;};}()),a5_0x3ad443=a5_0xb35089(this,function(){const _0x33e6b1=a5_0x1310;return a5_0x3ad443['toString']()[_0x33e6b1(0x221)](_0x33e6b1(0x206))['toString']()[_0x33e6b1(0x21a)](a5_0x3ad443)['search'](_0x33e6b1(0x206));});a5_0x3ad443();'use strict';const HISTORY_MAX_SIZE=0x32,RAW_LOG_MAX_SIZE=0x9c4,THERMO_LOG_SIZE=0x3e8,SEQUENCE_TIMEOUT_MS=0x5*0x3c*0x3e8,MAX_TRAINING_SET_SIZE=0x1f4,EXIT_TIMER_MINUTES=0xf,EXIT_GRACE_PERIOD_SECONDS=0x1e;let activeSequence=[],sequenceTimer=null;async function getOutsideTemperatureNumeric(_0x43a5cf){const _0x4b997c=a5_0x1310;if(_0x43a5cf['config'][_0x4b997c(0x1fc)])try{const _0x345719=await _0x43a5cf[_0x4b997c(0x20a)](_0x43a5cf[_0x4b997c(0x1f8)][_0x4b997c(0x1fc)]);if(_0x345719&&_0x345719[_0x4b997c(0x207)]!==undefined&&_0x345719[_0x4b997c(0x207)]!==null)return parseFloat(_0x345719[_0x4b997c(0x207)]);}catch(_0x68505a){}const _0x59c742=_0x43a5cf[_0x4b997c(0x1f8)]['weatherInstance'];if(!_0x43a5cf[_0x4b997c(0x1f8)][_0x4b997c(0x1e3)]||!_0x59c742)return null;try{let _0x369646='';if(_0x59c742[_0x4b997c(0x1ff)](_0x4b997c(0x1fa)))_0x369646=_0x59c742+_0x4b997c(0x1e0);else{if(_0x59c742[_0x4b997c(0x1ff)](_0x4b997c(0x1d7)))_0x369646=_0x59c742+_0x4b997c(0x228);else{if(_0x59c742[_0x4b997c(0x1ff)](_0x4b997c(0x1f2)))_0x369646=_0x59c742+'.forecast.current.temperature';else{if(_0x59c742[_0x4b997c(0x1ff)](_0x4b997c(0x20c)))_0x369646=_0x59c742+_0x4b997c(0x200);}}}if(_0x369646){const _0x557149=await _0x43a5cf[_0x4b997c(0x20a)](_0x369646);if(_0x557149&&_0x557149['val']!==undefined&&_0x557149[_0x4b997c(0x207)]!==null)return parseFloat(_0x557149[_0x4b997c(0x207)]);}}catch(_0x2ecdb0){}return null;}async function recordThermodynamics(_0x1806d8,_0x2c2071,_0xddade3,_0x30c451){const _0x5b05d1=a5_0x1310,_0x1029ea=await getOutsideTemperatureNumeric(_0x1806d8);let _0x53b784=0x0;if(_0x2c2071[_0x5b05d1(0x1ff)](_0x5b05d1(0x205))){const _0x13e4b0=[{'from':'.1.ACTUAL_TEMPERATURE','to':_0x5b05d1(0x1f6)},{'from':_0x5b05d1(0x208),'to':_0x5b05d1(0x1eb)},{'from':_0x5b05d1(0x1d4),'to':_0x5b05d1(0x1f0)},{'from':'.ACTUAL_TEMPERATURE','to':_0x5b05d1(0x21d)}];for(const _0x48369e of _0x13e4b0){if(_0x2c2071[_0x5b05d1(0x1ff)](_0x48369e[_0x5b05d1(0x217)])){const _0x5b2901=_0x2c2071[_0x5b05d1(0x222)](_0x48369e[_0x5b05d1(0x217)],_0x48369e['to']);try{const _0x1d4d32=await _0x1806d8[_0x5b05d1(0x20a)](_0x5b2901);if(_0x1d4d32&&_0x1d4d32[_0x5b05d1(0x207)]!==null&&_0x1d4d32[_0x5b05d1(0x207)]!==undefined){let _0x3cf072=_0x1d4d32[_0x5b05d1(0x207)];typeof _0x3cf072===_0x5b05d1(0x21e)&&_0x3cf072<=1.05&&_0x48369e['to'][_0x5b05d1(0x1ff)](_0x5b05d1(0x1db))&&(_0x3cf072=_0x3cf072*0x64);_0x53b784=Math[_0x5b05d1(0x1fe)](_0x3cf072);break;}}catch(_0x2cd858){}}}}const _0x5e6f81=await _0x1806d8[_0x5b05d1(0x215)](_0x5b05d1(0x1ed));let _0x58a334=[];if(_0x5e6f81&&_0x5e6f81[_0x5b05d1(0x207)])try{_0x58a334=JSON[_0x5b05d1(0x219)](_0x5e6f81[_0x5b05d1(0x207)]);}catch(_0x50434b){}_0x58a334[_0x5b05d1(0x1f3)]({'ts':Date[_0x5b05d1(0x1d6)](),'room':_0x30c451||_0x5b05d1(0x22d),'t_in':_0xddade3,'t_out':_0x1029ea,'valve':_0x53b784});if(_0x58a334[_0x5b05d1(0x20d)]>THERMO_LOG_SIZE)_0x58a334[_0x5b05d1(0x20b)]();await _0x1806d8[_0x5b05d1(0x211)](_0x5b05d1(0x1ed),{'val':JSON[_0x5b05d1(0x1e1)](_0x58a334),'ack':!![]});}async function saveCompletedSequence(_0x415aa7){const _0x21ab02=a5_0x1310;try{const _0xf1963b=await _0x415aa7[_0x21ab02(0x215)](_0x21ab02(0x224));let _0x2c2412=[];if(_0xf1963b&&_0xf1963b[_0x21ab02(0x207)])try{_0x2c2412=JSON[_0x21ab02(0x219)](_0xf1963b[_0x21ab02(0x207)]);}catch(_0x424b02){}const _0x4e0258=activeSequence[0x0]['ts'],_0x2b1d2f=activeSequence[_0x21ab02(0x204)](_0x26e916=>({'loc':_0x26e916[_0x21ab02(0x203)],'t_delta':Math[_0x21ab02(0x1fe)]((_0x26e916['ts']-_0x4e0258)/0x3e8)})),_0x1248c3={'timestamp':new Date(_0x4e0258)['toISOString'](),'steps':_0x2b1d2f,'duration':Math[_0x21ab02(0x1fe)]((activeSequence[activeSequence[_0x21ab02(0x20d)]-0x1]['ts']-_0x4e0258)/0x3e8),'daytime':new Date(_0x4e0258)['getHours']()};_0x2c2412[_0x21ab02(0x1f3)](_0x1248c3);if(_0x2c2412['length']>MAX_TRAINING_SET_SIZE)_0x2c2412[_0x21ab02(0x20b)]();await _0x415aa7[_0x21ab02(0x211)]('LTM.trainingData.sequences',{'val':JSON[_0x21ab02(0x1e1)](_0x2c2412),'ack':!![]}),_0x415aa7['isProVersion']&&_0x415aa7[_0x21ab02(0x229)]&&_0x415aa7[_0x21ab02(0x229)](_0x21ab02(0x1d5),{'sequence':_0x1248c3});}catch(_0x40e69f){_0x415aa7[_0x21ab02(0x1da)]['error']('[RECORDER]\x20Error:\x20'+_0x40e69f[_0x21ab02(0x1f4)]);}}function a5_0x29dd(){const _0x310df4=['openweathermap','push','message','isProVersion','.1.LEVEL','temperatur','config','1590KsibOm','accuweather','exitGraceTimer','outdoorSensorId','motion','round','includes','.forecast.current.temp','location','schalter','loc','map','hm-rpc','(((.+)+)+)+$','val','.1.ACTUAL_TEMPERATURE','type','getForeignStateAsync','shift','weatherunderground','length','logDuplicates','light','fenster','setStateAsync','rawEventLog','splice','currentSystemMode','getStateAsync','präsenz','from','toLowerCase','parse','constructor','3750616Gltevr','switch','.LEVEL','number','72ezLWRi','114261OElJJD','search','replace','exports','LTM.trainingData.sequences','licht','value','1761532xVejJE','.NextHours.Location_1.Day_1.current.temp_value','sendToPythonWrapper','normal','exitTimer','kontakt','Unknown','unshift','eventHistory','some','isPresent','.1.TEMPERATURE','ANALYZE_SEQUENCE','now','daswetter','dimmer','window','log','LEVEL','sensorLastValues','lampe','name','5PPGRvC','.Current.Temperature','stringify','door','useWeather','temperature','52308VxVJdo','pop','1817766QCutxc','occupancy','915904BTIRua','3159612QUIala','.1.VALVE_STATE','SIMULATE_SIGNAL','LTM.trainingData.thermodynamics','isGracePeriodActive','events.lastEvent','.4.VALVE_STATE','events.history'];a5_0x29dd=function(){return _0x310df4;};return a5_0x29dd();}async function recordSequence(_0x5d3010,_0x57ef54){const _0x3abd2f=a5_0x1310,_0x1e323c=(_0x57ef54[_0x3abd2f(0x209)]||'')[_0x3abd2f(0x218)](),_0x180c6c=[_0x3abd2f(0x1fd),'bewegung',_0x3abd2f(0x216),'presence',_0x3abd2f(0x1e8),_0x3abd2f(0x1e2),'tür',_0x3abd2f(0x1d9),_0x3abd2f(0x210),'contact',_0x3abd2f(0x22c),_0x3abd2f(0x20f),_0x3abd2f(0x225),_0x3abd2f(0x21c),_0x3abd2f(0x202),_0x3abd2f(0x1d8),_0x3abd2f(0x1dd)];if(!_0x180c6c[_0x3abd2f(0x1d2)](_0x591ccd=>_0x1e323c[_0x3abd2f(0x1ff)](_0x591ccd)))return;if(!_0x57ef54[_0x3abd2f(0x226)])return;if(sequenceTimer)clearTimeout(sequenceTimer);activeSequence[_0x3abd2f(0x1f3)]({'loc':_0x57ef54['location']||_0x3abd2f(0x22d),'id':_0x57ef54['id'],'ts':Date[_0x3abd2f(0x1d6)]()}),sequenceTimer=setTimeout(async()=>{const _0x25f3f8=_0x3abd2f;if(activeSequence[_0x25f3f8(0x20d)]>0x1)await saveCompletedSequence(_0x5d3010);activeSequence=[];},SEQUENCE_TIMEOUT_MS);}function startExitTimer(_0x1a1e11){const _0x414a77=a5_0x1310;abortExitTimer(_0x1a1e11),_0x1a1e11[_0x414a77(0x1ee)]=!![],_0x1a1e11['exitGraceTimer']=setTimeout(()=>{const _0xae2da9=_0x414a77;_0x1a1e11[_0xae2da9(0x1ee)]=![];},EXIT_GRACE_PERIOD_SECONDS*0x3e8),_0x1a1e11[_0x414a77(0x22b)]=setTimeout(()=>{const _0x1fad3f=_0x414a77;setPresence(_0x1a1e11,![]),_0x1a1e11[_0x1fad3f(0x22b)]=null;},EXIT_TIMER_MINUTES*0x3c*0x3e8);}function abortExitTimer(_0x89c62a){const _0xebbb4f=a5_0x1310;if(_0x89c62a['exitTimer'])clearTimeout(_0x89c62a['exitTimer']);if(_0x89c62a[_0xebbb4f(0x1fb)])clearTimeout(_0x89c62a[_0xebbb4f(0x1fb)]);_0x89c62a[_0xebbb4f(0x22b)]=null,_0x89c62a[_0xebbb4f(0x1fb)]=null,_0x89c62a['isGracePeriodActive']=![];}async function setPresence(_0x140f65,_0x166004){const _0x1e2a75=a5_0x1310;if(_0x140f65[_0x1e2a75(0x1d3)]===_0x166004)return;_0x140f65[_0x1e2a75(0x1d3)]=_0x166004,await _0x140f65['setStateAsync']('system.isPresent',{'val':_0x166004,'ack':!![]});}async function processSensorEvent(_0x3f4c23,_0x5695e3,_0x312cc0,_0x1ea4b6){const _0x184ae4=a5_0x1310;if(!_0x1ea4b6)return null;const _0x3db74e=_0x312cc0[_0x184ae4(0x207)],_0x350112=Date[_0x184ae4(0x1d6)](),_0x24fa0e=_0x3f4c23['sensorLastValues'][_0x5695e3];_0x3f4c23[_0x184ae4(0x1dc)][_0x5695e3]=_0x3db74e;if(!_0x1ea4b6[_0x184ae4(0x20e)]&&_0x24fa0e!=undefined&&_0x24fa0e==_0x3db74e)return null;const _0x123cf6=(_0x1ea4b6[_0x184ae4(0x209)]||'')[_0x184ae4(0x218)](),_0x428847=_0x123cf6[_0x184ae4(0x1ff)](_0x184ae4(0x1e4))||_0x123cf6['includes'](_0x184ae4(0x1f7))||_0x123cf6[_0x184ae4(0x1ff)]('klima')||_0x123cf6[_0x184ae4(0x1ff)]('heizung');_0x3f4c23[_0x184ae4(0x1f5)]&&_0x428847&&recordThermodynamics(_0x3f4c23,_0x5695e3,_0x3db74e,_0x1ea4b6['location']);const _0x2d5159={'timestamp':_0x350112,'id':_0x5695e3,'name':_0x1ea4b6[_0x184ae4(0x1de)],'type':_0x1ea4b6['type'],'location':_0x1ea4b6['location'],'value':_0x3db74e};_0x3f4c23[_0x184ae4(0x1d1)][_0x184ae4(0x22e)](_0x2d5159);if(_0x3f4c23[_0x184ae4(0x1d1)][_0x184ae4(0x20d)]>HISTORY_MAX_SIZE)_0x3f4c23['eventHistory'][_0x184ae4(0x1e6)]();await _0x3f4c23[_0x184ae4(0x211)](_0x184ae4(0x1ef),{'val':JSON['stringify'](_0x2d5159),'ack':!![]}),await _0x3f4c23[_0x184ae4(0x211)](_0x184ae4(0x1f1),{'val':JSON['stringify'](_0x3f4c23[_0x184ae4(0x1d1)]),'ack':!![]});if(_0x3f4c23[_0x184ae4(0x1f5)]){_0x3f4c23[_0x184ae4(0x212)]['push'](_0x2d5159);if(_0x3f4c23[_0x184ae4(0x212)][_0x184ae4(0x20d)]>RAW_LOG_MAX_SIZE)_0x3f4c23[_0x184ae4(0x212)][_0x184ae4(0x213)](0x0,_0x3f4c23[_0x184ae4(0x212)][_0x184ae4(0x20d)]-RAW_LOG_MAX_SIZE);await _0x3f4c23['setStateAsync']('LTM.rawEventLog',{'val':JSON[_0x184ae4(0x1e1)](_0x3f4c23[_0x184ae4(0x212)]),'ack':!![]}),recordSequence(_0x3f4c23,_0x2d5159);}if(_0x1ea4b6['isExit']&&_0x3db74e===!![]){if(_0x3f4c23['isPresent']&&!_0x3f4c23[_0x184ae4(0x1ee)])startExitTimer(_0x3f4c23);else{if(!_0x3f4c23[_0x184ae4(0x1d3)])setPresence(_0x3f4c23,!![]);}}else{if(_0x1ea4b6['type']===_0x184ae4(0x1fd)&&_0x3db74e===!![]){if(_0x3f4c23[_0x184ae4(0x22b)])abortExitTimer(_0x3f4c23);if(!_0x3f4c23['isPresent']&&_0x3f4c23[_0x184ae4(0x214)]===_0x184ae4(0x22a))setPresence(_0x3f4c23,!![]);}}return _0x3f4c23['isProVersion']&&_0x1ea4b6[_0x184ae4(0x209)]==='motion'&&_0x3db74e===!![]&&_0x1ea4b6[_0x184ae4(0x201)]&&_0x3f4c23[_0x184ae4(0x229)]&&_0x3f4c23[_0x184ae4(0x229)](_0x184ae4(0x1ec),{'room':_0x1ea4b6[_0x184ae4(0x201)]}),_0x2d5159;}module[a5_0x4dbd1c(0x223)]={'processSensorEvent':processSensorEvent,'getOutsideTemperatureNumeric':getOutsideTemperatureNumeric,'setPresence':setPresence,'abortExitTimer':abortExitTimer,'startExitTimer':startExitTimer};