const a5_0x5aabfb=a5_0x4aea;(function(_0x4858fe,_0xadcc46){const _0x6168cc=a5_0x4aea,_0x47eda9=_0x4858fe();while(!![]){try{const _0xf6862d=parseInt(_0x6168cc(0xc2))/0x1*(-parseInt(_0x6168cc(0xfe))/0x2)+parseInt(_0x6168cc(0xb6))/0x3*(-parseInt(_0x6168cc(0xe7))/0x4)+parseInt(_0x6168cc(0xae))/0x5+-parseInt(_0x6168cc(0x105))/0x6*(parseInt(_0x6168cc(0xc1))/0x7)+-parseInt(_0x6168cc(0xef))/0x8+parseInt(_0x6168cc(0xb5))/0x9*(-parseInt(_0x6168cc(0xca))/0xa)+parseInt(_0x6168cc(0xe4))/0xb;if(_0xf6862d===_0xadcc46)break;else _0x47eda9['push'](_0x47eda9['shift']());}catch(_0x20365e){_0x47eda9['push'](_0x47eda9['shift']());}}}(a5_0x4954,0x5e7a4));const a5_0x383e8e=(function(){let _0x5681c6=!![];return function(_0x381ce7,_0x10d289){const _0xba91a9=_0x5681c6?function(){const _0x44c0b0=a5_0x4aea;if(_0x10d289){const _0x4b42fd=_0x10d289[_0x44c0b0(0xb9)](_0x381ce7,arguments);return _0x10d289=null,_0x4b42fd;}}:function(){};return _0x5681c6=![],_0xba91a9;};}()),a5_0x3fd680=a5_0x383e8e(this,function(){const _0x476e5d=a5_0x4aea;return a5_0x3fd680[_0x476e5d(0xd9)]()[_0x476e5d(0xc8)](_0x476e5d(0xf7))[_0x476e5d(0xd9)]()[_0x476e5d(0xc0)](a5_0x3fd680)[_0x476e5d(0xc8)]('(((.+)+)+)+$');});function a5_0x4aea(_0x177914,_0x32287e){const _0x19140d=a5_0x4954();return a5_0x4aea=function(_0x3fd680,_0x383e8e){_0x3fd680=_0x3fd680-0xa1;let _0x495439=_0x19140d[_0x3fd680];return _0x495439;},a5_0x4aea(_0x177914,_0x32287e);}a5_0x3fd680();'use strict';const HISTORY_MAX_SIZE=0x32,RAW_LOG_MAX_SIZE=0x9c4,THERMO_LOG_SIZE=0x3e8,SEQUENCE_TIMEOUT_MS=0x5*0x3c*0x3e8,MAX_TRAINING_SET_SIZE=0x1f4,EXIT_TIMER_MINUTES=0xf,EXIT_GRACE_PERIOD_SECONDS=0x1e;let activeSequence=[],sequenceTimer=null;async function getOutsideTemperatureNumeric(_0x23386d){const _0x59ea15=a5_0x4aea;if(_0x23386d[_0x59ea15(0xdd)][_0x59ea15(0xa3)])try{const _0x4a9e63=await _0x23386d[_0x59ea15(0xd5)](_0x23386d[_0x59ea15(0xdd)][_0x59ea15(0xa3)]);if(_0x4a9e63&&_0x4a9e63['val']!==undefined&&_0x4a9e63[_0x59ea15(0xda)]!==null)return parseFloat(_0x4a9e63[_0x59ea15(0xda)]);}catch(_0x444cb8){}const _0x5da75d=_0x23386d[_0x59ea15(0xdd)]['weatherInstance'];if(!_0x23386d[_0x59ea15(0xdd)][_0x59ea15(0xfa)]||!_0x5da75d)return null;try{let _0x8402dc='';if(_0x5da75d[_0x59ea15(0xbe)](_0x59ea15(0xcb)))_0x8402dc=_0x5da75d+'.Current.Temperature';else{if(_0x5da75d[_0x59ea15(0xbe)](_0x59ea15(0xcc)))_0x8402dc=_0x5da75d+_0x59ea15(0xb0);else{if(_0x5da75d[_0x59ea15(0xbe)]('openweathermap'))_0x8402dc=_0x5da75d+_0x59ea15(0xf9);else{if(_0x5da75d['includes'](_0x59ea15(0xf1)))_0x8402dc=_0x5da75d+'.forecast.current.temp';}}}if(_0x8402dc){const _0x5a037e=await _0x23386d[_0x59ea15(0xd5)](_0x8402dc);if(_0x5a037e&&_0x5a037e[_0x59ea15(0xda)]!==undefined&&_0x5a037e['val']!==null)return parseFloat(_0x5a037e['val']);}}catch(_0x424700){}return null;}async function recordThermodynamics(_0x1c4f73,_0x512545,_0x287131,_0x3cba18){const _0x2f7df6=a5_0x4aea,_0x43e43b=await getOutsideTemperatureNumeric(_0x1c4f73);if(_0x43e43b===null)return;let _0x3d9f16=0x0,_0x4fd5e2=![];if(_0x1c4f73[_0x2f7df6(0xdd)][_0x2f7df6(0xb2)])try{let _0x517519=_0x1c4f73['config'][_0x2f7df6(0xb2)];if(typeof _0x517519===_0x2f7df6(0xbd))_0x517519=JSON[_0x2f7df6(0xb8)](_0x517519);if(_0x517519[_0x512545]){const _0x257b7d=_0x517519[_0x512545],_0x1935fa=await _0x1c4f73['getForeignStateAsync'](_0x257b7d);if(_0x1935fa&&_0x1935fa[_0x2f7df6(0xda)]!==null&&_0x1935fa[_0x2f7df6(0xda)]!==undefined){let _0x2e2e58=Number(_0x1935fa[_0x2f7df6(0xda)]);if(_0x2e2e58<=1.05&&!_0x257b7d['includes'](_0x2f7df6(0xa8))&&!_0x257b7d[_0x2f7df6(0xbe)](_0x2f7df6(0xd1)))_0x2e2e58=_0x2e2e58*0x64;_0x3d9f16=Math[_0x2f7df6(0xb7)](_0x2e2e58),_0x4fd5e2=!![];}}}catch(_0x49b6ce){}if(!_0x4fd5e2){const _0xe8a2c=[{'from':'.1.ACTUAL_TEMPERATURE','to':_0x2f7df6(0xa6)},{'from':'.1.ACTUAL_TEMPERATURE','to':_0x2f7df6(0xe5)},{'from':_0x2f7df6(0xe2),'to':'.4.VALVE_STATE'},{'from':'.ACTUAL_TEMPERATURE','to':'.LEVEL'},{'from':'temperature','to':'level'},{'from':'Temperature','to':'Valve'}];for(const _0x35bc35 of _0xe8a2c){if(_0x512545[_0x2f7df6(0xbe)](_0x35bc35[_0x2f7df6(0xdb)])){const _0x4b3246=_0x512545['replace'](_0x35bc35[_0x2f7df6(0xdb)],_0x35bc35['to']);try{const _0x4e0a4d=await _0x1c4f73[_0x2f7df6(0xd5)](_0x4b3246);if(_0x4e0a4d&&_0x4e0a4d[_0x2f7df6(0xda)]!==null&&_0x4e0a4d[_0x2f7df6(0xda)]!==undefined){let _0x2f7e2b=Number(_0x4e0a4d[_0x2f7df6(0xda)]);if(typeof _0x2f7e2b===_0x2f7df6(0xfb)){if(_0x2f7e2b<=1.05&&_0x35bc35['to'][_0x2f7df6(0xbe)](_0x2f7df6(0xc6)))_0x2f7e2b=_0x2f7e2b*0x64;_0x3d9f16=Math[_0x2f7df6(0xb7)](_0x2f7e2b),_0x4fd5e2=!![];break;}}}catch(_0x105455){}}}}const _0x5719cc=await _0x1c4f73[_0x2f7df6(0xd2)](_0x2f7df6(0xa9));let _0x4154e3=[];if(_0x5719cc&&_0x5719cc[_0x2f7df6(0xda)])try{_0x4154e3=JSON[_0x2f7df6(0xb8)](_0x5719cc[_0x2f7df6(0xda)]);}catch(_0x41c362){}_0x4154e3[_0x2f7df6(0xc3)]({'ts':Date['now'](),'room':_0x3cba18||_0x2f7df6(0x100),'t_in':_0x287131,'t_out':_0x43e43b,'valve':_0x3d9f16});if(_0x4154e3[_0x2f7df6(0xf8)]>THERMO_LOG_SIZE)_0x4154e3[_0x2f7df6(0x104)]();await _0x1c4f73[_0x2f7df6(0x101)](_0x2f7df6(0xa9),{'val':JSON['stringify'](_0x4154e3),'ack':!![]});}async function saveCompletedSequence(_0x4a536e){const _0xcfc197=a5_0x4aea;try{const _0x2acf0f=await _0x4a536e['getStateAsync']('LTM.trainingData.sequences');let _0x3bf4f5=[];if(_0x2acf0f&&_0x2acf0f['val'])try{_0x3bf4f5=JSON[_0xcfc197(0xb8)](_0x2acf0f[_0xcfc197(0xda)]);}catch(_0x6d7f0a){}const _0x3a1de5=activeSequence[0x0]['ts'],_0x4cc9b3=activeSequence[_0xcfc197(0xea)](_0x4e008e=>({'loc':_0x4e008e['loc'],'t_delta':Math[_0xcfc197(0xb7)]((_0x4e008e['ts']-_0x3a1de5)/0x3e8)})),_0x1962eb={'timestamp':new Date(_0x3a1de5)['toISOString'](),'steps':_0x4cc9b3,'duration':Math[_0xcfc197(0xb7)]((activeSequence[activeSequence[_0xcfc197(0xf8)]-0x1]['ts']-_0x3a1de5)/0x3e8),'daytime':new Date(_0x3a1de5)['getHours']()};_0x3bf4f5['push'](_0x1962eb);if(_0x3bf4f5[_0xcfc197(0xf8)]>MAX_TRAINING_SET_SIZE)_0x3bf4f5['shift']();await _0x4a536e[_0xcfc197(0x101)](_0xcfc197(0xce),{'val':JSON[_0xcfc197(0xab)](_0x3bf4f5),'ack':!![]}),_0x4a536e['isProVersion']&&_0x4a536e['sendToPythonWrapper']&&_0x4a536e[_0xcfc197(0xac)](_0xcfc197(0x102),{'sequence':_0x1962eb});}catch(_0xfca8a4){_0x4a536e['log']['error'](_0xcfc197(0xfc)+_0xfca8a4[_0xcfc197(0xee)]);}}async function recordSequence(_0x5a0675,_0xbb5250){const _0x38dec1=a5_0x4aea,_0x4d4804=(_0xbb5250['type']||'')[_0x38dec1(0xaf)](),_0x3f13f5=[_0x38dec1(0xbc),_0x38dec1(0xa2),_0x38dec1(0xe1),_0x38dec1(0xf3),_0x38dec1(0xe0),_0x38dec1(0xad),'tür',_0x38dec1(0xf5),_0x38dec1(0xbb),'contact',_0x38dec1(0xa1),_0x38dec1(0xf2),_0x38dec1(0xc4),_0x38dec1(0xe8),_0x38dec1(0xde),_0x38dec1(0xc7),_0x38dec1(0xff)];if(!_0x3f13f5[_0x38dec1(0xc5)](_0x484984=>_0x4d4804[_0x38dec1(0xbe)](_0x484984)))return;if(!_0xbb5250[_0x38dec1(0xaa)])return;if(sequenceTimer)clearTimeout(sequenceTimer);activeSequence[_0x38dec1(0xc3)]({'loc':_0xbb5250[_0x38dec1(0xd4)]||_0x38dec1(0x100),'id':_0xbb5250['id'],'ts':Date[_0x38dec1(0xd7)]()}),sequenceTimer=setTimeout(async()=>{const _0x3d67f0=_0x38dec1;if(activeSequence[_0x3d67f0(0xf8)]>0x1)await saveCompletedSequence(_0x5a0675);activeSequence=[];},SEQUENCE_TIMEOUT_MS);}function startExitTimer(_0x11af9d){const _0x25ff97=a5_0x4aea;abortExitTimer(_0x11af9d),_0x11af9d['isGracePeriodActive']=!![],_0x11af9d['exitGraceTimer']=setTimeout(()=>{const _0x5b3505=a5_0x4aea;_0x11af9d[_0x5b3505(0xcf)]=![];},EXIT_GRACE_PERIOD_SECONDS*0x3e8),_0x11af9d[_0x25ff97(0xa5)]=setTimeout(()=>{const _0x4599d3=_0x25ff97;setPresence(_0x11af9d,![]),_0x11af9d[_0x4599d3(0xa5)]=null;},EXIT_TIMER_MINUTES*0x3c*0x3e8);}function abortExitTimer(_0x58718c){const _0x207e1f=a5_0x4aea;if(_0x58718c[_0x207e1f(0xa5)])clearTimeout(_0x58718c[_0x207e1f(0xa5)]);if(_0x58718c['exitGraceTimer'])clearTimeout(_0x58718c[_0x207e1f(0xb1)]);_0x58718c[_0x207e1f(0xa5)]=null,_0x58718c[_0x207e1f(0xb1)]=null,_0x58718c['isGracePeriodActive']=![];}async function setPresence(_0x198468,_0x461047){const _0x2edab2=a5_0x4aea;if(_0x198468['isPresent']===_0x461047)return;_0x198468[_0x2edab2(0xba)]=_0x461047,await _0x198468[_0x2edab2(0x101)]('system.isPresent',{'val':_0x461047,'ack':!![]});}async function processSensorEvent(_0x56c35b,_0x539dff,_0x38803c,_0x1b0221){const _0x3e521b=a5_0x4aea;if(!_0x1b0221)return null;const _0x45d9c0=_0x38803c['val'],_0x534d12=Date['now'](),_0x173ac9=_0x56c35b[_0x3e521b(0xe3)][_0x539dff];_0x56c35b[_0x3e521b(0xe3)][_0x539dff]=_0x45d9c0;if(!_0x1b0221['logDuplicates']&&_0x173ac9!=undefined&&_0x173ac9==_0x45d9c0)return null;const _0x568d4d=(_0x1b0221[_0x3e521b(0xf0)]||'')[_0x3e521b(0xaf)](),_0xe71c84=_0x568d4d['includes'](_0x3e521b(0xd6))||_0x568d4d[_0x3e521b(0xbe)](_0x3e521b(0xfd))||_0x568d4d[_0x3e521b(0xbe)](_0x3e521b(0xf4))||_0x568d4d['includes'](_0x3e521b(0xed))||_0x568d4d[_0x3e521b(0xbe)](_0x3e521b(0xb3));_0x56c35b[_0x3e521b(0xdc)]&&_0xe71c84&&recordThermodynamics(_0x56c35b,_0x539dff,_0x45d9c0,_0x1b0221[_0x3e521b(0xd4)]);const _0x37768c={'timestamp':_0x534d12,'id':_0x539dff,'name':_0x1b0221[_0x3e521b(0xb4)],'type':_0x1b0221[_0x3e521b(0xf0)],'location':_0x1b0221[_0x3e521b(0xd4)],'value':_0x45d9c0};_0x56c35b['eventHistory']['unshift'](_0x37768c);if(_0x56c35b['eventHistory']['length']>HISTORY_MAX_SIZE)_0x56c35b[_0x3e521b(0xd8)][_0x3e521b(0xbf)]();await _0x56c35b[_0x3e521b(0x101)](_0x3e521b(0xe6),{'val':JSON[_0x3e521b(0xab)](_0x37768c),'ack':!![]}),await _0x56c35b[_0x3e521b(0x101)](_0x3e521b(0x103),{'val':JSON[_0x3e521b(0xab)](_0x56c35b[_0x3e521b(0xd8)]),'ack':!![]});if(_0x56c35b[_0x3e521b(0xdc)]){_0x56c35b['rawEventLog'][_0x3e521b(0xc3)](_0x37768c);if(_0x56c35b[_0x3e521b(0xf6)][_0x3e521b(0xf8)]>RAW_LOG_MAX_SIZE)_0x56c35b[_0x3e521b(0xf6)][_0x3e521b(0xeb)](0x0,_0x56c35b[_0x3e521b(0xf6)]['length']-RAW_LOG_MAX_SIZE);await _0x56c35b[_0x3e521b(0x101)](_0x3e521b(0xec),{'val':JSON[_0x3e521b(0xab)](_0x56c35b[_0x3e521b(0xf6)]),'ack':!![]}),recordSequence(_0x56c35b,_0x37768c);}if(_0x1b0221['isExit']&&_0x45d9c0===!![]){if(_0x56c35b[_0x3e521b(0xba)]&&!_0x56c35b[_0x3e521b(0xcf)])startExitTimer(_0x56c35b);else{if(!_0x56c35b[_0x3e521b(0xba)])setPresence(_0x56c35b,!![]);}}else{if(_0x1b0221['type']===_0x3e521b(0xbc)&&_0x45d9c0===!![]){if(_0x56c35b[_0x3e521b(0xa5)])abortExitTimer(_0x56c35b);if(!_0x56c35b[_0x3e521b(0xba)]&&_0x56c35b[_0x3e521b(0xcd)]==='normal')setPresence(_0x56c35b,!![]);}}if(_0x56c35b['isProVersion']&&_0x56c35b[_0x3e521b(0xac)]){_0x1b0221[_0x3e521b(0xf0)]===_0x3e521b(0xbc)&&_0x45d9c0===!![]&&_0x1b0221[_0x3e521b(0xd4)]&&_0x56c35b[_0x3e521b(0xac)]('SIMULATE_SIGNAL',{'room':_0x1b0221['location']});const _0x30eca6=[_0x3e521b(0xad),'tür',_0x3e521b(0xf5),_0x3e521b(0xbb),_0x3e521b(0xa7),_0x3e521b(0xa4),_0x3e521b(0xe9),_0x3e521b(0xdf)]['some'](_0x104017=>_0x568d4d[_0x3e521b(0xbe)](_0x104017)),_0x4ac9a6=['light',_0x3e521b(0xc4),_0x3e521b(0xe8),_0x3e521b(0xde),_0x3e521b(0xc7),_0x3e521b(0xff)][_0x3e521b(0xc5)](_0x4a63cc=>_0x568d4d[_0x3e521b(0xbe)](_0x4a63cc)),_0x14cb65=[_0x3e521b(0xbc),_0x3e521b(0xa2),_0x3e521b(0xe1),_0x3e521b(0xf3),_0x3e521b(0xe0)][_0x3e521b(0xc5)](_0xbcebda=>_0x568d4d['includes'](_0xbcebda));if(_0x1b0221[_0x3e521b(0xd4)]&&(_0x30eca6||_0x4ac9a6||_0x14cb65)){const _0x3af134=_0x45d9c0===!![]||typeof _0x45d9c0===_0x3e521b(0xfb)&&_0x45d9c0>0x0,_0x14c8a4=_0x30eca6&&!_0x3af134&&_0x173ac9!==undefined&&_0x173ac9!=_0x45d9c0;if(_0x3af134||_0x14c8a4){const _0x2c264c=_0x56c35b[_0x3e521b(0xc9)]||_0x534d12,_0x4875ac=(_0x534d12-_0x2c264c)/0x3e8;_0x56c35b['lastTrackerEventTime']=_0x534d12,_0x56c35b[_0x3e521b(0xac)](_0x3e521b(0xd3),{'room':_0x1b0221[_0x3e521b(0xd4)],'dt':_0x4875ac});}}}return _0x37768c;}module[a5_0x5aabfb(0xd0)]={'processSensorEvent':processSensorEvent,'getOutsideTemperatureNumeric':getOutsideTemperatureNumeric,'setPresence':setPresence,'abortExitTimer':abortExitTimer,'startExitTimer':startExitTimer};function a5_0x4954(){const _0x5c50d2=['.1.TEMPERATURE','sensorLastValues','23866777ZIQILg','.1.VALVE_STATE','events.lastEvent','89416xGAcTt','switch','lock','map','splice','LTM.rawEventLog','heizung','message','5460824xFWQmO','type','weatherunderground','light','presence','klima','window','rawEventLog','(((.+)+)+)+$','length','.forecast.current.temperature','useWeather','number','[RECORDER]\x20Error:\x20','temperatur','32ejAwcS','lampe','Unknown','setStateAsync','ANALYZE_SEQUENCE','events.history','shift','6hOJFFd','kontakt','bewegung','outdoorSensorId','handle','exitTimer','.1.LEVEL','griff','STATUS','LTM.trainingData.thermodynamics','value','stringify','sendToPythonWrapper','door','951585OTMvsK','toLowerCase','.NextHours.Location_1.Day_1.current.temp_value','exitGraceTimer','valveMapping','thermostat','name','89541IJBFqz','51btbsNP','round','parse','apply','isPresent','fenster','motion','string','includes','pop','constructor','388640XhBHSZ','41617XfEhRL','push','licht','some','LEVEL','dimmer','search','lastTrackerEventTime','190AdgqIf','accuweather','daswetter','currentSystemMode','LTM.trainingData.sequences','isGracePeriodActive','exports','STATE','getStateAsync','TRACK_EVENT','location','getForeignStateAsync','temperature','now','eventHistory','toString','val','from','isProVersion','config','schalter','schloss','occupancy','präsenz'];a5_0x4954=function(){return _0x5c50d2;};return a5_0x4954();}