const a5_0x368e9f=a5_0x2c3b;(function(_0x28c498,_0x188742){const _0x13befd=a5_0x2c3b,_0x245841=_0x28c498();while(!![]){try{const _0xa26af5=-parseInt(_0x13befd(0x14b))/0x1+-parseInt(_0x13befd(0x1bb))/0x2+-parseInt(_0x13befd(0x1aa))/0x3*(-parseInt(_0x13befd(0x176))/0x4)+parseInt(_0x13befd(0x194))/0x5+parseInt(_0x13befd(0x190))/0x6+parseInt(_0x13befd(0x184))/0x7*(parseInt(_0x13befd(0x18a))/0x8)+parseInt(_0x13befd(0x167))/0x9*(-parseInt(_0x13befd(0x197))/0xa);if(_0xa26af5===_0x188742)break;else _0x245841['push'](_0x245841['shift']());}catch(_0x4b614d){_0x245841['push'](_0x245841['shift']());}}}(a5_0x14e8,0xd2215));const a5_0x4d05e2=(function(){let _0x2f4127=!![];return function(_0x29b75e,_0x3a1e1f){const _0x56adec=_0x2f4127?function(){const _0x5606bb=a5_0x2c3b;if(_0x3a1e1f){const _0x40e424=_0x3a1e1f[_0x5606bb(0x1a6)](_0x29b75e,arguments);return _0x3a1e1f=null,_0x40e424;}}:function(){};return _0x2f4127=![],_0x56adec;};}()),a5_0x318195=a5_0x4d05e2(this,function(){const _0x1a64c7=a5_0x2c3b;return a5_0x318195['toString']()[_0x1a64c7(0x1b0)](_0x1a64c7(0x165))[_0x1a64c7(0x159)]()[_0x1a64c7(0x198)](a5_0x318195)[_0x1a64c7(0x1b0)](_0x1a64c7(0x165));});a5_0x318195();'use strict';const HISTORY_MAX_SIZE=0x32,RAW_LOG_MAX_SIZE=0x9c4,THERMO_LOG_SIZE=0x3e8,SEQUENCE_TIMEOUT_MS=0x5*0x3c*0x3e8,MAX_TRAINING_SET_SIZE=0x1f4,EXIT_TIMER_MINUTES=0xf,EXIT_GRACE_PERIOD_SECONDS=0x1e;function a5_0x14e8(){const _0x5bb5df=['length','setStateAsync','light','Valve','lastTrackerEventTime','valveMapping','LTM.rawEventLog','sendToPythonWrapper','toString','stringify','lampe','Unknown','isProVersion','debug','LTM.trainingData.sequences','getStateAsync','fenster','sensorLastValues','handle','getForeignStateAsync','(((.+)+)+)+$','some','1737IXzdjb','licht','door','schloss','temperatur','logDuplicates','.4.VALVE_STATE','occupancy','type','switch','Temperature','presence','val','config','useWeather','12716tSbkzX','now','events.history','normal','splice','message','toLowerCase','pop','LTM.trainingData.thermodynamics','isExit','schalter','outdoorSensorId','bewegung','.1.LEVEL','105ClUTnY','LEVEL','.ACTUAL_TEMPERATURE','isGracePeriodActive','präsenz','tür','200584udxXlg','level','includes','SIMULATE_SIGNAL','openweathermap','isPresent','3471072lAwERp','parse','window','[RECORDER]\x20Ignored\x20implausible\x20temperature:\x20','6726700zOibev','weatherunderground','location','4590guuCMT','constructor','exitTimer','name','getHours','heizung','log','number','eventHistory','map','dimmer','[RECORDER]\x20Error:\x20','motion','string','exitGraceTimer','apply','STATE','replace','lock','357QpFERN','from','temperature','.1.ACTUAL_TEMPERATURE','weatherInstance','\x20from\x20','search','exports','accuweather','klima','.Current.Temperature','kontakt','STATUS','push','value','.forecast.current.temperature','shift','1496160Csupoz','.1.TEMPERATURE','rawEventLog','daswetter','.forecast.current.temp','980888tqlRYi','system.isPresent','ANALYZE_SEQUENCE','round','events.lastEvent','griff'];a5_0x14e8=function(){return _0x5bb5df;};return a5_0x14e8();}let activeSequence=[],sequenceTimer=null;async function getOutsideTemperatureNumeric(_0x31fb72){const _0x5c4b12=a5_0x2c3b;if(_0x31fb72[_0x5c4b12(0x174)][_0x5c4b12(0x181)])try{const _0x352b7d=await _0x31fb72[_0x5c4b12(0x164)](_0x31fb72[_0x5c4b12(0x174)]['outdoorSensorId']);if(_0x352b7d&&_0x352b7d['val']!==undefined&&_0x352b7d[_0x5c4b12(0x173)]!==null)return parseFloat(_0x352b7d[_0x5c4b12(0x173)]);}catch(_0x5377e1){}const _0x32b626=_0x31fb72[_0x5c4b12(0x174)][_0x5c4b12(0x1ae)];if(!_0x31fb72[_0x5c4b12(0x174)][_0x5c4b12(0x175)]||!_0x32b626)return null;try{let _0x3cc44f='';if(_0x32b626[_0x5c4b12(0x18c)](_0x5c4b12(0x1b2)))_0x3cc44f=_0x32b626+_0x5c4b12(0x1b4);else{if(_0x32b626[_0x5c4b12(0x18c)](_0x5c4b12(0x149)))_0x3cc44f=_0x32b626+'.NextHours.Location_1.Day_1.current.temp_value';else{if(_0x32b626[_0x5c4b12(0x18c)](_0x5c4b12(0x18e)))_0x3cc44f=_0x32b626+_0x5c4b12(0x1b9);else{if(_0x32b626[_0x5c4b12(0x18c)](_0x5c4b12(0x195)))_0x3cc44f=_0x32b626+_0x5c4b12(0x14a);}}}if(_0x3cc44f){const _0x360a2a=await _0x31fb72[_0x5c4b12(0x164)](_0x3cc44f);if(_0x360a2a&&_0x360a2a[_0x5c4b12(0x173)]!==undefined&&_0x360a2a[_0x5c4b12(0x173)]!==null)return parseFloat(_0x360a2a[_0x5c4b12(0x173)]);}}catch(_0x5667ba){}return null;}async function recordThermodynamics(_0x3c0090,_0x1efbcb,_0x488eb2,_0x439acc){const _0x7219f=a5_0x2c3b,_0xbf0639=await getOutsideTemperatureNumeric(_0x3c0090);if(_0xbf0639===null)return;let _0x26769d=0x0,_0x92525e=![];if(_0x3c0090[_0x7219f(0x174)][_0x7219f(0x156)])try{let _0x36c06f=_0x3c0090[_0x7219f(0x174)][_0x7219f(0x156)];if(typeof _0x36c06f===_0x7219f(0x1a4))_0x36c06f=JSON[_0x7219f(0x191)](_0x36c06f);if(_0x36c06f[_0x1efbcb]){const _0x2983df=_0x36c06f[_0x1efbcb],_0x5922dd=await _0x3c0090[_0x7219f(0x164)](_0x2983df);if(_0x5922dd&&_0x5922dd[_0x7219f(0x173)]!==null&&_0x5922dd[_0x7219f(0x173)]!==undefined){let _0x257267=Number(_0x5922dd[_0x7219f(0x173)]);if(_0x257267<=1.05&&!_0x2983df['includes'](_0x7219f(0x1b6))&&!_0x2983df['includes'](_0x7219f(0x1a7)))_0x257267=_0x257267*0x64;_0x26769d=Math[_0x7219f(0x14e)](_0x257267),_0x92525e=!![];}}}catch(_0x24f276){}if(!_0x92525e){const _0xa5f34b=[{'from':_0x7219f(0x1ad),'to':_0x7219f(0x183)},{'from':_0x7219f(0x1ad),'to':'.1.VALVE_STATE'},{'from':_0x7219f(0x1bc),'to':_0x7219f(0x16d)},{'from':_0x7219f(0x186),'to':'.LEVEL'},{'from':_0x7219f(0x1ac),'to':_0x7219f(0x18b)},{'from':_0x7219f(0x171),'to':_0x7219f(0x154)}];for(const _0x5bedc8 of _0xa5f34b){if(_0x1efbcb[_0x7219f(0x18c)](_0x5bedc8['from'])){const _0x31a7f7=_0x1efbcb[_0x7219f(0x1a8)](_0x5bedc8[_0x7219f(0x1ab)],_0x5bedc8['to']);try{const _0x104e65=await _0x3c0090[_0x7219f(0x164)](_0x31a7f7);if(_0x104e65&&_0x104e65[_0x7219f(0x173)]!==null&&_0x104e65[_0x7219f(0x173)]!==undefined){let _0x2e402a=Number(_0x104e65[_0x7219f(0x173)]);if(typeof _0x2e402a===_0x7219f(0x19e)){if(_0x2e402a<=1.05&&_0x5bedc8['to'][_0x7219f(0x18c)](_0x7219f(0x185)))_0x2e402a=_0x2e402a*0x64;_0x26769d=Math[_0x7219f(0x14e)](_0x2e402a),_0x92525e=!![];break;}}}catch(_0x407973){}}}}const _0x32459c=await _0x3c0090[_0x7219f(0x160)]('LTM.trainingData.thermodynamics');let _0x223944=[];if(_0x32459c&&_0x32459c['val'])try{_0x223944=JSON[_0x7219f(0x191)](_0x32459c[_0x7219f(0x173)]);}catch(_0x4c43b5){}_0x223944[_0x7219f(0x1b7)]({'ts':Date[_0x7219f(0x177)](),'room':_0x439acc||'Unknown','t_in':_0x488eb2,'t_out':_0xbf0639,'valve':_0x26769d});if(_0x223944[_0x7219f(0x151)]>THERMO_LOG_SIZE)_0x223944[_0x7219f(0x1ba)]();await _0x3c0090[_0x7219f(0x152)](_0x7219f(0x17e),{'val':JSON[_0x7219f(0x15a)](_0x223944),'ack':!![]});}function a5_0x2c3b(_0x26348e,_0x395eac){const _0x33404e=a5_0x14e8();return a5_0x2c3b=function(_0x318195,_0x4d05e2){_0x318195=_0x318195-0x149;let _0x14e892=_0x33404e[_0x318195];return _0x14e892;},a5_0x2c3b(_0x26348e,_0x395eac);}async function saveCompletedSequence(_0x47923b){const _0x5ce260=a5_0x2c3b;try{const _0x57e775=await _0x47923b['getStateAsync']('LTM.trainingData.sequences');let _0xe31f67=[];if(_0x57e775&&_0x57e775[_0x5ce260(0x173)])try{_0xe31f67=JSON[_0x5ce260(0x191)](_0x57e775['val']);}catch(_0x2d5db6){}const _0x4e9f21=activeSequence[0x0]['ts'],_0x2174dc=activeSequence[_0x5ce260(0x1a0)](_0x7e0058=>({'loc':_0x7e0058['loc'],'t_delta':Math[_0x5ce260(0x14e)]((_0x7e0058['ts']-_0x4e9f21)/0x3e8)})),_0x11f0e7={'timestamp':new Date(_0x4e9f21)['toISOString'](),'steps':_0x2174dc,'duration':Math[_0x5ce260(0x14e)]((activeSequence[activeSequence[_0x5ce260(0x151)]-0x1]['ts']-_0x4e9f21)/0x3e8),'daytime':new Date(_0x4e9f21)[_0x5ce260(0x19b)]()};_0xe31f67[_0x5ce260(0x1b7)](_0x11f0e7);if(_0xe31f67[_0x5ce260(0x151)]>MAX_TRAINING_SET_SIZE)_0xe31f67['shift']();await _0x47923b[_0x5ce260(0x152)](_0x5ce260(0x15f),{'val':JSON[_0x5ce260(0x15a)](_0xe31f67),'ack':!![]}),_0x47923b[_0x5ce260(0x15d)]&&_0x47923b[_0x5ce260(0x158)]&&_0x47923b['sendToPythonWrapper'](_0x5ce260(0x14d),{'sequence':_0x11f0e7});}catch(_0x1c817a){_0x47923b[_0x5ce260(0x19d)]['error'](_0x5ce260(0x1a2)+_0x1c817a[_0x5ce260(0x17b)]);}}async function recordSequence(_0x5b0eeb,_0x33f913){const _0x5dfb1d=a5_0x2c3b,_0x40a575=(_0x33f913[_0x5dfb1d(0x16f)]||'')[_0x5dfb1d(0x17c)](),_0x55b646=['motion',_0x5dfb1d(0x182),_0x5dfb1d(0x188),_0x5dfb1d(0x172),_0x5dfb1d(0x16e),'door',_0x5dfb1d(0x189),'window',_0x5dfb1d(0x161),'contact',_0x5dfb1d(0x1b5),_0x5dfb1d(0x153),_0x5dfb1d(0x168),_0x5dfb1d(0x170),_0x5dfb1d(0x180),_0x5dfb1d(0x1a1),_0x5dfb1d(0x15b)];if(!_0x55b646[_0x5dfb1d(0x166)](_0x261dc6=>_0x40a575[_0x5dfb1d(0x18c)](_0x261dc6)))return;if(!_0x33f913[_0x5dfb1d(0x1b8)])return;if(sequenceTimer)clearTimeout(sequenceTimer);activeSequence[_0x5dfb1d(0x1b7)]({'loc':_0x33f913[_0x5dfb1d(0x196)]||_0x5dfb1d(0x15c),'id':_0x33f913['id'],'ts':Date[_0x5dfb1d(0x177)]()}),sequenceTimer=setTimeout(async()=>{const _0xc345e=_0x5dfb1d;if(activeSequence[_0xc345e(0x151)]>0x1)await saveCompletedSequence(_0x5b0eeb);activeSequence=[];},SEQUENCE_TIMEOUT_MS);}function startExitTimer(_0x1e8a79){const _0x3b22cd=a5_0x2c3b;abortExitTimer(_0x1e8a79),_0x1e8a79[_0x3b22cd(0x187)]=!![],_0x1e8a79[_0x3b22cd(0x1a5)]=setTimeout(()=>{const _0x455166=_0x3b22cd;_0x1e8a79[_0x455166(0x187)]=![];},EXIT_GRACE_PERIOD_SECONDS*0x3e8),_0x1e8a79[_0x3b22cd(0x199)]=setTimeout(()=>{const _0x9d3764=_0x3b22cd;setPresence(_0x1e8a79,![]),_0x1e8a79[_0x9d3764(0x199)]=null;},EXIT_TIMER_MINUTES*0x3c*0x3e8);}function abortExitTimer(_0x5700c7){const _0x2c61eb=a5_0x2c3b;if(_0x5700c7['exitTimer'])clearTimeout(_0x5700c7[_0x2c61eb(0x199)]);if(_0x5700c7[_0x2c61eb(0x1a5)])clearTimeout(_0x5700c7[_0x2c61eb(0x1a5)]);_0x5700c7['exitTimer']=null,_0x5700c7['exitGraceTimer']=null,_0x5700c7[_0x2c61eb(0x187)]=![];}async function setPresence(_0x3e6579,_0x3052c8){const _0x346fe4=a5_0x2c3b;if(_0x3e6579[_0x346fe4(0x18f)]===_0x3052c8)return;_0x3e6579[_0x346fe4(0x18f)]=_0x3052c8,await _0x3e6579[_0x346fe4(0x152)](_0x346fe4(0x14c),{'val':_0x3052c8,'ack':!![]});}async function processSensorEvent(_0x58aa33,_0x1897f5,_0x35a099,_0x12d03c){const _0x92448c=a5_0x2c3b;if(!_0x12d03c)return null;const _0x33bb9a=_0x35a099[_0x92448c(0x173)],_0x160a28=Date[_0x92448c(0x177)](),_0x1e1c91=_0x58aa33[_0x92448c(0x162)][_0x1897f5],_0x182981=(_0x12d03c['type']||'')[_0x92448c(0x17c)](),_0x2d7e27=_0x182981[_0x92448c(0x18c)](_0x92448c(0x1ac))||_0x182981[_0x92448c(0x18c)](_0x92448c(0x16b))||_0x182981[_0x92448c(0x18c)](_0x92448c(0x1b3))||_0x182981['includes'](_0x92448c(0x19c))||_0x182981[_0x92448c(0x18c)]('thermostat');if(_0x2d7e27&&typeof _0x33bb9a===_0x92448c(0x19e)){if(_0x33bb9a>0x50||_0x33bb9a<-0x32)return _0x58aa33['log'][_0x92448c(0x15e)](_0x92448c(0x193)+_0x33bb9a+_0x92448c(0x1af)+_0x1897f5),null;}_0x58aa33[_0x92448c(0x162)][_0x1897f5]=_0x33bb9a;if(!_0x12d03c[_0x92448c(0x16c)]&&_0x1e1c91!=undefined&&_0x1e1c91==_0x33bb9a)return null;_0x58aa33['isProVersion']&&_0x2d7e27&&recordThermodynamics(_0x58aa33,_0x1897f5,_0x33bb9a,_0x12d03c[_0x92448c(0x196)]);const _0x4d27ad={'timestamp':_0x160a28,'id':_0x1897f5,'name':_0x12d03c[_0x92448c(0x19a)],'type':_0x12d03c['type'],'location':_0x12d03c[_0x92448c(0x196)],'value':_0x33bb9a};_0x58aa33[_0x92448c(0x19f)]['unshift'](_0x4d27ad);if(_0x58aa33[_0x92448c(0x19f)]['length']>HISTORY_MAX_SIZE)_0x58aa33['eventHistory'][_0x92448c(0x17d)]();await _0x58aa33[_0x92448c(0x152)](_0x92448c(0x14f),{'val':JSON[_0x92448c(0x15a)](_0x4d27ad),'ack':!![]}),await _0x58aa33[_0x92448c(0x152)](_0x92448c(0x178),{'val':JSON[_0x92448c(0x15a)](_0x58aa33[_0x92448c(0x19f)]),'ack':!![]});if(_0x58aa33['isProVersion']){_0x58aa33[_0x92448c(0x1bd)][_0x92448c(0x1b7)](_0x4d27ad);if(_0x58aa33[_0x92448c(0x1bd)]['length']>RAW_LOG_MAX_SIZE)_0x58aa33[_0x92448c(0x1bd)][_0x92448c(0x17a)](0x0,_0x58aa33['rawEventLog'][_0x92448c(0x151)]-RAW_LOG_MAX_SIZE);await _0x58aa33['setStateAsync'](_0x92448c(0x157),{'val':JSON[_0x92448c(0x15a)](_0x58aa33[_0x92448c(0x1bd)]),'ack':!![]}),recordSequence(_0x58aa33,_0x4d27ad);}if(_0x12d03c[_0x92448c(0x17f)]&&_0x33bb9a===!![]){if(_0x58aa33['isPresent']&&!_0x58aa33['isGracePeriodActive'])startExitTimer(_0x58aa33);else{if(!_0x58aa33[_0x92448c(0x18f)])setPresence(_0x58aa33,!![]);}}else{if(_0x12d03c[_0x92448c(0x16f)]===_0x92448c(0x1a3)&&_0x33bb9a===!![]){if(_0x58aa33['exitTimer'])abortExitTimer(_0x58aa33);if(!_0x58aa33[_0x92448c(0x18f)]&&_0x58aa33['currentSystemMode']===_0x92448c(0x179))setPresence(_0x58aa33,!![]);}}if(_0x58aa33[_0x92448c(0x15d)]&&_0x58aa33['sendToPythonWrapper']){_0x12d03c['type']===_0x92448c(0x1a3)&&_0x33bb9a===!![]&&_0x12d03c['location']&&_0x58aa33['sendToPythonWrapper'](_0x92448c(0x18d),{'room':_0x12d03c['location']});const _0x20e604=[_0x92448c(0x169),_0x92448c(0x189),_0x92448c(0x192),_0x92448c(0x161),_0x92448c(0x150),_0x92448c(0x163),_0x92448c(0x1a9),_0x92448c(0x16a)][_0x92448c(0x166)](_0x227add=>_0x182981[_0x92448c(0x18c)](_0x227add)),_0x48dd77=[_0x92448c(0x153),'licht','switch',_0x92448c(0x180),_0x92448c(0x1a1),_0x92448c(0x15b)][_0x92448c(0x166)](_0x64003b=>_0x182981['includes'](_0x64003b)),_0x1c2b1a=[_0x92448c(0x1a3),_0x92448c(0x182),_0x92448c(0x188),_0x92448c(0x172),'occupancy']['some'](_0x484858=>_0x182981['includes'](_0x484858));if(_0x12d03c[_0x92448c(0x196)]&&(_0x20e604||_0x48dd77||_0x1c2b1a)){const _0x149557=_0x33bb9a===!![]||typeof _0x33bb9a===_0x92448c(0x19e)&&_0x33bb9a>0x0,_0x3ae59a=_0x20e604&&!_0x149557&&_0x1e1c91!==undefined&&_0x1e1c91!=_0x33bb9a;if(_0x149557||_0x3ae59a){const _0x5b349e=_0x58aa33[_0x92448c(0x155)]||_0x160a28,_0x5650e2=(_0x160a28-_0x5b349e)/0x3e8;_0x58aa33[_0x92448c(0x155)]=_0x160a28,_0x58aa33['sendToPythonWrapper']('TRACK_EVENT',{'room':_0x12d03c['location'],'dt':_0x5650e2});}}}return _0x4d27ad;}module[a5_0x368e9f(0x1b1)]={'processSensorEvent':processSensorEvent,'getOutsideTemperatureNumeric':getOutsideTemperatureNumeric,'setPresence':setPresence,'abortExitTimer':abortExitTimer,'startExitTimer':startExitTimer};