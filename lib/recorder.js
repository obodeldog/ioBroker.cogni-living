(function(_0xa1957d,_0x427e7e){const _0x45af16=a5_0x47e3,_0x591d0b=_0xa1957d();while(!![]){try{const _0x2c3d59=parseInt(_0x45af16(0x1de))/0x1*(-parseInt(_0x45af16(0x1e2))/0x2)+parseInt(_0x45af16(0x1dd))/0x3*(parseInt(_0x45af16(0x21f))/0x4)+-parseInt(_0x45af16(0x1dc))/0x5*(-parseInt(_0x45af16(0x20b))/0x6)+-parseInt(_0x45af16(0x214))/0x7*(parseInt(_0x45af16(0x20a))/0x8)+-parseInt(_0x45af16(0x1e6))/0x9*(parseInt(_0x45af16(0x1d6))/0xa)+parseInt(_0x45af16(0x225))/0xb*(-parseInt(_0x45af16(0x1fb))/0xc)+-parseInt(_0x45af16(0x21d))/0xd*(-parseInt(_0x45af16(0x1e9))/0xe);if(_0x2c3d59===_0x427e7e)break;else _0x591d0b['push'](_0x591d0b['shift']());}catch(_0x3d34e3){_0x591d0b['push'](_0x591d0b['shift']());}}}(a5_0x3a7c,0xcac59));const a5_0x183a28=(function(){let _0x456ff8=!![];return function(_0x58abc4,_0x15fa4a){const _0x5e597d=_0x456ff8?function(){const _0x271720=a5_0x47e3;if(_0x15fa4a){const _0x2e8b91=_0x15fa4a[_0x271720(0x222)](_0x58abc4,arguments);return _0x15fa4a=null,_0x2e8b91;}}:function(){};return _0x456ff8=![],_0x5e597d;};}()),a5_0x4cbfc3=a5_0x183a28(this,function(){const _0x1b6494=a5_0x47e3;return a5_0x4cbfc3[_0x1b6494(0x22e)]()[_0x1b6494(0x208)](_0x1b6494(0x1ed))[_0x1b6494(0x22e)]()['constructor'](a5_0x4cbfc3)[_0x1b6494(0x208)]('(((.+)+)+)+$');});a5_0x4cbfc3();function a5_0x3a7c(){const _0x578c4d=['SIMULATE_SIGNAL','from','schalter','splice','exitGraceTimer','dimmer','outdoorSensorId','stringify','toString','LTM.trainingData.thermodynamics','loc','fenster','presence','switch','light','weatherInstance','daswetter','message','88960vcXEUD','map','shift','events.history','bewegung','system.isPresent','5jxWraK','3058509vdCycL','1wKUQMb','getHours','exitTimer','licht','3189742hyTBCQ','config','setStateAsync','motion','351EqyMOZ','LTM.trainingData.sequences','currentSystemMode','1834XIwXEl','hm-rpc','LEVEL','door','(((.+)+)+)+$','val','.4.VALVE_STATE','isExit','replace','temperatur','rawEventLog','length','.1.ACTUAL_TEMPERATURE','.1.TEMPERATURE','location','lampe','.1.LEVEL','type','2287332VVsSLV','weatherunderground','eventHistory','ANALYZE_SEQUENCE','isGracePeriodActive','präsenz','LTM.rawEventLog','pop','openweathermap','isPresent','sensorLastValues','toLowerCase','temperature','search','.ACTUAL_TEMPERATURE','2856cTdXTy','6501246NngxVk','heizung','name','isProVersion','round','.NextHours.Location_1.Day_1.current.temp_value','tür','error','normal','29127pJxeAX','getForeignStateAsync','includes','klima','parse','push','number','.1.VALVE_STATE','sendToPythonWrapper','270582IrCiMH','getStateAsync','4Fmbsog','now','some','apply','events.lastEvent','toISOString','33RiAWlG'];a5_0x3a7c=function(){return _0x578c4d;};return a5_0x3a7c();}'use strict';const HISTORY_MAX_SIZE=0x32,RAW_LOG_MAX_SIZE=0x9c4,THERMO_LOG_SIZE=0x3e8,SEQUENCE_TIMEOUT_MS=0x5*0x3c*0x3e8,MAX_TRAINING_SET_SIZE=0x1f4,EXIT_TIMER_MINUTES=0xf,EXIT_GRACE_PERIOD_SECONDS=0x1e;let activeSequence=[],sequenceTimer=null;async function getOutsideTemperatureNumeric(_0x5c864e){const _0xba3cb7=a5_0x47e3;if(_0x5c864e[_0xba3cb7(0x1e3)]['outdoorSensorId'])try{const _0xb34dff=await _0x5c864e[_0xba3cb7(0x215)](_0x5c864e['config'][_0xba3cb7(0x22c)]);if(_0xb34dff&&_0xb34dff[_0xba3cb7(0x1ee)]!==undefined&&_0xb34dff[_0xba3cb7(0x1ee)]!==null)return parseFloat(_0xb34dff[_0xba3cb7(0x1ee)]);}catch(_0x13847a){}const _0x15435b=_0x5c864e[_0xba3cb7(0x1e3)][_0xba3cb7(0x235)];if(!_0x5c864e[_0xba3cb7(0x1e3)]['useWeather']||!_0x15435b)return null;try{let _0x4c7885='';if(_0x15435b[_0xba3cb7(0x216)]('accuweather'))_0x4c7885=_0x15435b+'.Current.Temperature';else{if(_0x15435b[_0xba3cb7(0x216)](_0xba3cb7(0x1d4)))_0x4c7885=_0x15435b+_0xba3cb7(0x210);else{if(_0x15435b['includes'](_0xba3cb7(0x203)))_0x4c7885=_0x15435b+'.forecast.current.temperature';else{if(_0x15435b[_0xba3cb7(0x216)](_0xba3cb7(0x1fc)))_0x4c7885=_0x15435b+'.forecast.current.temp';}}}if(_0x4c7885){const _0x1c136b=await _0x5c864e[_0xba3cb7(0x215)](_0x4c7885);if(_0x1c136b&&_0x1c136b[_0xba3cb7(0x1ee)]!==undefined&&_0x1c136b[_0xba3cb7(0x1ee)]!==null)return parseFloat(_0x1c136b[_0xba3cb7(0x1ee)]);}}catch(_0x5b6998){}return null;}async function recordThermodynamics(_0x18ccd7,_0x25b245,_0x4d2a33,_0x5cfdaf){const _0x3c12f8=a5_0x47e3,_0x475319=await getOutsideTemperatureNumeric(_0x18ccd7);let _0x803416=0x0;if(_0x25b245[_0x3c12f8(0x216)](_0x3c12f8(0x1ea))){const _0x21b200=[{'from':_0x3c12f8(0x1f5),'to':_0x3c12f8(0x1f9)},{'from':_0x3c12f8(0x1f5),'to':_0x3c12f8(0x21b)},{'from':_0x3c12f8(0x1f6),'to':_0x3c12f8(0x1ef)},{'from':_0x3c12f8(0x209),'to':'.LEVEL'}];for(const _0xe44b2f of _0x21b200){if(_0x25b245[_0x3c12f8(0x216)](_0xe44b2f[_0x3c12f8(0x227)])){const _0x5a60bc=_0x25b245[_0x3c12f8(0x1f1)](_0xe44b2f[_0x3c12f8(0x227)],_0xe44b2f['to']);try{const _0x1921f1=await _0x18ccd7[_0x3c12f8(0x215)](_0x5a60bc);if(_0x1921f1&&_0x1921f1[_0x3c12f8(0x1ee)]!==null&&_0x1921f1[_0x3c12f8(0x1ee)]!==undefined){let _0x8e88a0=_0x1921f1[_0x3c12f8(0x1ee)];typeof _0x8e88a0===_0x3c12f8(0x21a)&&_0x8e88a0<=1.05&&_0xe44b2f['to'][_0x3c12f8(0x216)](_0x3c12f8(0x1eb))&&(_0x8e88a0=_0x8e88a0*0x64);_0x803416=Math[_0x3c12f8(0x20f)](_0x8e88a0);break;}}catch(_0x522c8a){}}}}const _0x2ef26a=await _0x18ccd7[_0x3c12f8(0x21e)](_0x3c12f8(0x22f));let _0x3ce7d4=[];if(_0x2ef26a&&_0x2ef26a[_0x3c12f8(0x1ee)])try{_0x3ce7d4=JSON[_0x3c12f8(0x218)](_0x2ef26a[_0x3c12f8(0x1ee)]);}catch(_0x166aa9){}_0x3ce7d4['push']({'ts':Date[_0x3c12f8(0x220)](),'room':_0x5cfdaf||'Unknown','t_in':_0x4d2a33,'t_out':_0x475319,'valve':_0x803416});if(_0x3ce7d4['length']>THERMO_LOG_SIZE)_0x3ce7d4[_0x3c12f8(0x1d8)]();await _0x18ccd7[_0x3c12f8(0x1e4)](_0x3c12f8(0x22f),{'val':JSON[_0x3c12f8(0x22d)](_0x3ce7d4),'ack':!![]});}async function saveCompletedSequence(_0x4d4a12){const _0x21da51=a5_0x47e3;try{const _0x22ccf2=await _0x4d4a12['getStateAsync'](_0x21da51(0x1e7));let _0x2a5b5f=[];if(_0x22ccf2&&_0x22ccf2['val'])try{_0x2a5b5f=JSON['parse'](_0x22ccf2[_0x21da51(0x1ee)]);}catch(_0x593595){}const _0x4dce12=activeSequence[0x0]['ts'],_0x5af36b=activeSequence[_0x21da51(0x1d7)](_0xf4c25f=>({'loc':_0xf4c25f[_0x21da51(0x230)],'t_delta':Math[_0x21da51(0x20f)]((_0xf4c25f['ts']-_0x4dce12)/0x3e8)})),_0x579194={'timestamp':new Date(_0x4dce12)[_0x21da51(0x224)](),'steps':_0x5af36b,'duration':Math[_0x21da51(0x20f)]((activeSequence[activeSequence[_0x21da51(0x1f4)]-0x1]['ts']-_0x4dce12)/0x3e8),'daytime':new Date(_0x4dce12)[_0x21da51(0x1df)]()};_0x2a5b5f[_0x21da51(0x219)](_0x579194);if(_0x2a5b5f['length']>MAX_TRAINING_SET_SIZE)_0x2a5b5f[_0x21da51(0x1d8)]();await _0x4d4a12[_0x21da51(0x1e4)](_0x21da51(0x1e7),{'val':JSON[_0x21da51(0x22d)](_0x2a5b5f),'ack':!![]}),_0x4d4a12[_0x21da51(0x20e)]&&_0x4d4a12['sendToPythonWrapper']&&_0x4d4a12[_0x21da51(0x21c)](_0x21da51(0x1fe),{'sequence':_0x579194});}catch(_0x12508e){_0x4d4a12['log'][_0x21da51(0x212)]('[RECORDER]\x20Error:\x20'+_0x12508e[_0x21da51(0x1d5)]);}}async function recordSequence(_0x333602,_0x4c797e){const _0x1987b8=a5_0x47e3,_0xb1d5c6=(_0x4c797e[_0x1987b8(0x1fa)]||'')[_0x1987b8(0x206)](),_0x10ed50=[_0x1987b8(0x1e5),_0x1987b8(0x1da),_0x1987b8(0x200),_0x1987b8(0x232),'occupancy',_0x1987b8(0x1ec),_0x1987b8(0x211),'window',_0x1987b8(0x231),'contact','kontakt',_0x1987b8(0x234),_0x1987b8(0x1e1),_0x1987b8(0x233),_0x1987b8(0x228),_0x1987b8(0x22b),_0x1987b8(0x1f8)];if(!_0x10ed50[_0x1987b8(0x221)](_0x1876af=>_0xb1d5c6[_0x1987b8(0x216)](_0x1876af)))return;if(!_0x4c797e['value'])return;if(sequenceTimer)clearTimeout(sequenceTimer);activeSequence[_0x1987b8(0x219)]({'loc':_0x4c797e['location']||'Unknown','id':_0x4c797e['id'],'ts':Date[_0x1987b8(0x220)]()}),sequenceTimer=setTimeout(async()=>{if(activeSequence['length']>0x1)await saveCompletedSequence(_0x333602);activeSequence=[];},SEQUENCE_TIMEOUT_MS);}function startExitTimer(_0x18baaf){const _0x10ce3e=a5_0x47e3;abortExitTimer(_0x18baaf),_0x18baaf[_0x10ce3e(0x1ff)]=!![],_0x18baaf[_0x10ce3e(0x22a)]=setTimeout(()=>{const _0x3f06f0=_0x10ce3e;_0x18baaf[_0x3f06f0(0x1ff)]=![];},EXIT_GRACE_PERIOD_SECONDS*0x3e8),_0x18baaf['exitTimer']=setTimeout(()=>{const _0x13937f=_0x10ce3e;setPresence(_0x18baaf,![]),_0x18baaf[_0x13937f(0x1e0)]=null;},EXIT_TIMER_MINUTES*0x3c*0x3e8);}function abortExitTimer(_0x3de1ba){const _0x5bd94b=a5_0x47e3;if(_0x3de1ba['exitTimer'])clearTimeout(_0x3de1ba[_0x5bd94b(0x1e0)]);if(_0x3de1ba[_0x5bd94b(0x22a)])clearTimeout(_0x3de1ba['exitGraceTimer']);_0x3de1ba[_0x5bd94b(0x1e0)]=null,_0x3de1ba[_0x5bd94b(0x22a)]=null,_0x3de1ba[_0x5bd94b(0x1ff)]=![];}async function setPresence(_0x149988,_0x23faa9){const _0x19452c=a5_0x47e3;if(_0x149988['isPresent']===_0x23faa9)return;_0x149988[_0x19452c(0x204)]=_0x23faa9,await _0x149988[_0x19452c(0x1e4)](_0x19452c(0x1db),{'val':_0x23faa9,'ack':!![]});}async function processSensorEvent(_0x293fce,_0x2cdbb7,_0x2d0c08,_0x30b36c){const _0x506e0c=a5_0x47e3;if(!_0x30b36c)return null;const _0x583b0d=_0x2d0c08[_0x506e0c(0x1ee)],_0x43661a=Date['now'](),_0x47ab41=_0x293fce['sensorLastValues'][_0x2cdbb7];_0x293fce[_0x506e0c(0x205)][_0x2cdbb7]=_0x583b0d;if(!_0x30b36c['logDuplicates']&&_0x47ab41!=undefined&&_0x47ab41==_0x583b0d)return null;const _0x4b9a77=(_0x30b36c[_0x506e0c(0x1fa)]||'')[_0x506e0c(0x206)](),_0x473bd1=_0x4b9a77['includes'](_0x506e0c(0x207))||_0x4b9a77['includes'](_0x506e0c(0x1f2))||_0x4b9a77[_0x506e0c(0x216)](_0x506e0c(0x217))||_0x4b9a77[_0x506e0c(0x216)](_0x506e0c(0x20c));_0x293fce[_0x506e0c(0x20e)]&&_0x473bd1&&recordThermodynamics(_0x293fce,_0x2cdbb7,_0x583b0d,_0x30b36c[_0x506e0c(0x1f7)]);const _0x299e0c={'timestamp':_0x43661a,'id':_0x2cdbb7,'name':_0x30b36c[_0x506e0c(0x20d)],'type':_0x30b36c[_0x506e0c(0x1fa)],'location':_0x30b36c[_0x506e0c(0x1f7)],'value':_0x583b0d};_0x293fce[_0x506e0c(0x1fd)]['unshift'](_0x299e0c);if(_0x293fce[_0x506e0c(0x1fd)][_0x506e0c(0x1f4)]>HISTORY_MAX_SIZE)_0x293fce[_0x506e0c(0x1fd)][_0x506e0c(0x202)]();await _0x293fce[_0x506e0c(0x1e4)](_0x506e0c(0x223),{'val':JSON['stringify'](_0x299e0c),'ack':!![]}),await _0x293fce[_0x506e0c(0x1e4)](_0x506e0c(0x1d9),{'val':JSON[_0x506e0c(0x22d)](_0x293fce[_0x506e0c(0x1fd)]),'ack':!![]});if(_0x293fce[_0x506e0c(0x20e)]){_0x293fce[_0x506e0c(0x1f3)][_0x506e0c(0x219)](_0x299e0c);if(_0x293fce['rawEventLog'][_0x506e0c(0x1f4)]>RAW_LOG_MAX_SIZE)_0x293fce[_0x506e0c(0x1f3)][_0x506e0c(0x229)](0x0,_0x293fce[_0x506e0c(0x1f3)][_0x506e0c(0x1f4)]-RAW_LOG_MAX_SIZE);await _0x293fce[_0x506e0c(0x1e4)](_0x506e0c(0x201),{'val':JSON[_0x506e0c(0x22d)](_0x293fce[_0x506e0c(0x1f3)]),'ack':!![]}),recordSequence(_0x293fce,_0x299e0c);}if(_0x30b36c[_0x506e0c(0x1f0)]&&_0x583b0d===!![]){if(_0x293fce[_0x506e0c(0x204)]&&!_0x293fce[_0x506e0c(0x1ff)])startExitTimer(_0x293fce);else{if(!_0x293fce['isPresent'])setPresence(_0x293fce,!![]);}}else{if(_0x30b36c[_0x506e0c(0x1fa)]===_0x506e0c(0x1e5)&&_0x583b0d===!![]){if(_0x293fce[_0x506e0c(0x1e0)])abortExitTimer(_0x293fce);if(!_0x293fce[_0x506e0c(0x204)]&&_0x293fce[_0x506e0c(0x1e8)]===_0x506e0c(0x213))setPresence(_0x293fce,!![]);}}return _0x293fce[_0x506e0c(0x20e)]&&_0x30b36c[_0x506e0c(0x1fa)]==='motion'&&_0x583b0d===!![]&&_0x30b36c[_0x506e0c(0x1f7)]&&_0x293fce[_0x506e0c(0x21c)]&&_0x293fce[_0x506e0c(0x21c)](_0x506e0c(0x226),{'room':_0x30b36c[_0x506e0c(0x1f7)]}),_0x299e0c;}function a5_0x47e3(_0x5600bc,_0x44362e){const _0x317756=a5_0x3a7c();return a5_0x47e3=function(_0x4cbfc3,_0x183a28){_0x4cbfc3=_0x4cbfc3-0x1d4;let _0x3a7c1f=_0x317756[_0x4cbfc3];return _0x3a7c1f;},a5_0x47e3(_0x5600bc,_0x44362e);}module['exports']={'processSensorEvent':processSensorEvent,'getOutsideTemperatureNumeric':getOutsideTemperatureNumeric,'setPresence':setPresence,'abortExitTimer':abortExitTimer,'startExitTimer':startExitTimer};