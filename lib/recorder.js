const a5_0x46e2d9=a5_0x501e;(function(_0xf8a51b,_0x2ec5ab){const _0x391230=a5_0x501e,_0x2527f0=_0xf8a51b();while(!![]){try{const _0x48625b=-parseInt(_0x391230(0xf9))/0x1*(-parseInt(_0x391230(0x142))/0x2)+parseInt(_0x391230(0x12b))/0x3+parseInt(_0x391230(0x148))/0x4+parseInt(_0x391230(0x117))/0x5+-parseInt(_0x391230(0x122))/0x6+parseInt(_0x391230(0xf3))/0x7*(parseInt(_0x391230(0xf7))/0x8)+parseInt(_0x391230(0x11e))/0x9*(-parseInt(_0x391230(0x136))/0xa);if(_0x48625b===_0x2ec5ab)break;else _0x2527f0['push'](_0x2527f0['shift']());}catch(_0x26be3f){_0x2527f0['push'](_0x2527f0['shift']());}}}(a5_0x2c08,0xe614b));const a5_0x2f4f3e=(function(){let _0x1576c7=!![];return function(_0x3a7af5,_0x35604c){const _0x579f19=_0x1576c7?function(){if(_0x35604c){const _0x41c8ae=_0x35604c['apply'](_0x3a7af5,arguments);return _0x35604c=null,_0x41c8ae;}}:function(){};return _0x1576c7=![],_0x579f19;};}()),a5_0x41b8a0=a5_0x2f4f3e(this,function(){const _0x2caf81=a5_0x501e;return a5_0x41b8a0[_0x2caf81(0xfe)]()[_0x2caf81(0x10e)]('(((.+)+)+)+$')['toString']()[_0x2caf81(0x106)](a5_0x41b8a0)[_0x2caf81(0x10e)](_0x2caf81(0xfc));});a5_0x41b8a0();function a5_0x501e(_0x3db77d,_0x2faba1){const _0x24b5da=a5_0x2c08();return a5_0x501e=function(_0x41b8a0,_0x2f4f3e){_0x41b8a0=_0x41b8a0-0xf3;let _0x2c08c6=_0x24b5da[_0x41b8a0];return _0x2c08c6;},a5_0x501e(_0x3db77d,_0x2faba1);}'use strict';const HISTORY_MAX_SIZE=0x32,RAW_LOG_MAX_SIZE=0x9c4,THERMO_LOG_SIZE=0x3e8,SEQUENCE_TIMEOUT_MS=0x5*0x3c*0x3e8,MAX_TRAINING_SET_SIZE=0x1f4,EXIT_TIMER_MINUTES=0xf,EXIT_GRACE_PERIOD_SECONDS=0x1e;let activeSequence=[],sequenceTimer=null;async function getOutsideTemperatureNumeric(_0x20f6ff){const _0x41efc1=a5_0x501e;if(_0x20f6ff[_0x41efc1(0x111)]['outdoorSensorId'])try{const _0x247fb8=await _0x20f6ff[_0x41efc1(0x105)](_0x20f6ff[_0x41efc1(0x111)][_0x41efc1(0x164)]);if(_0x247fb8&&_0x247fb8['val']!==undefined&&_0x247fb8[_0x41efc1(0x126)]!==null)return parseFloat(_0x247fb8['val']);}catch(_0xcf83f1){}const _0x362a23=_0x20f6ff[_0x41efc1(0x111)][_0x41efc1(0x155)];if(!_0x20f6ff[_0x41efc1(0x111)][_0x41efc1(0x140)]||!_0x362a23)return null;try{let _0x56245e='';if(_0x362a23[_0x41efc1(0x104)](_0x41efc1(0x143)))_0x56245e=_0x362a23+_0x41efc1(0x13d);else{if(_0x362a23[_0x41efc1(0x104)](_0x41efc1(0x158)))_0x56245e=_0x362a23+'.NextHours.Location_1.Day_1.current.temp_value';else{if(_0x362a23[_0x41efc1(0x104)](_0x41efc1(0xff)))_0x56245e=_0x362a23+_0x41efc1(0x144);else{if(_0x362a23[_0x41efc1(0x104)](_0x41efc1(0x101)))_0x56245e=_0x362a23+_0x41efc1(0x115);}}}if(_0x56245e){const _0xb4f15a=await _0x20f6ff[_0x41efc1(0x105)](_0x56245e);if(_0xb4f15a&&_0xb4f15a['val']!==undefined&&_0xb4f15a[_0x41efc1(0x126)]!==null)return parseFloat(_0xb4f15a[_0x41efc1(0x126)]);}}catch(_0x1837cf){}return null;}async function recordThermodynamics(_0x5aa972,_0x4d85ad,_0x36b4bb,_0x176c59){const _0x3f80d3=a5_0x501e,_0x579c8f=await getOutsideTemperatureNumeric(_0x5aa972);if(_0x579c8f===null)return;let _0x50c01d=0x0,_0x12e77f=![];if(_0x5aa972['config']['valveMapping'])try{let _0x5c2b88=_0x5aa972['config'][_0x3f80d3(0x13e)];if(typeof _0x5c2b88===_0x3f80d3(0x15f))_0x5c2b88=JSON[_0x3f80d3(0xfd)](_0x5c2b88);if(_0x5c2b88[_0x4d85ad]){const _0x487e32=_0x5c2b88[_0x4d85ad],_0x23e355=await _0x5aa972[_0x3f80d3(0x105)](_0x487e32);if(_0x23e355&&_0x23e355[_0x3f80d3(0x126)]!==null&&_0x23e355['val']!==undefined){let _0x42e07a=Number(_0x23e355['val']);if(_0x42e07a<=1.05&&!_0x487e32[_0x3f80d3(0x104)](_0x3f80d3(0x100))&&!_0x487e32[_0x3f80d3(0x104)](_0x3f80d3(0x11d)))_0x42e07a=_0x42e07a*0x64;_0x50c01d=Math[_0x3f80d3(0x13a)](_0x42e07a),_0x12e77f=!![];}}}catch(_0x539589){}if(!_0x12e77f){const _0x3b40aa=[{'from':'.1.ACTUAL_TEMPERATURE','to':'.1.LEVEL'},{'from':_0x3f80d3(0xfb),'to':_0x3f80d3(0x161)},{'from':_0x3f80d3(0x137),'to':_0x3f80d3(0x125)},{'from':_0x3f80d3(0x11c),'to':'.LEVEL'},{'from':_0x3f80d3(0x10c),'to':_0x3f80d3(0x152)},{'from':'Temperature','to':_0x3f80d3(0x121)}];for(const _0xcdb146 of _0x3b40aa){if(_0x4d85ad[_0x3f80d3(0x104)](_0xcdb146[_0x3f80d3(0x15a)])){const _0x2aaf29=_0x4d85ad['replace'](_0xcdb146[_0x3f80d3(0x15a)],_0xcdb146['to']);try{const _0xc95eff=await _0x5aa972[_0x3f80d3(0x105)](_0x2aaf29);if(_0xc95eff&&_0xc95eff[_0x3f80d3(0x126)]!==null&&_0xc95eff[_0x3f80d3(0x126)]!==undefined){let _0xdc72c2=Number(_0xc95eff[_0x3f80d3(0x126)]);if(typeof _0xdc72c2===_0x3f80d3(0x163)){if(_0xdc72c2<=1.05&&_0xcdb146['to'][_0x3f80d3(0x104)](_0x3f80d3(0x146)))_0xdc72c2=_0xdc72c2*0x64;_0x50c01d=Math['round'](_0xdc72c2),_0x12e77f=!![];break;}}}catch(_0x3f8873){}}}}const _0x53fe28=await _0x5aa972[_0x3f80d3(0x151)](_0x3f80d3(0x133));let _0x564814=[];if(_0x53fe28&&_0x53fe28[_0x3f80d3(0x126)])try{_0x564814=JSON['parse'](_0x53fe28[_0x3f80d3(0x126)]);}catch(_0x4ae127){}_0x564814['push']({'ts':Date[_0x3f80d3(0x113)](),'room':_0x176c59||_0x3f80d3(0x114),'t_in':_0x36b4bb,'t_out':_0x579c8f,'valve':_0x50c01d});if(_0x564814[_0x3f80d3(0x11a)]>THERMO_LOG_SIZE)_0x564814[_0x3f80d3(0x15c)]();await _0x5aa972[_0x3f80d3(0x153)](_0x3f80d3(0x133),{'val':JSON['stringify'](_0x564814),'ack':!![]});}async function saveCompletedSequence(_0xb690d1){const _0xca2128=a5_0x501e;try{const _0x45389f=await _0xb690d1[_0xca2128(0x151)](_0xca2128(0x107));let _0x3aa7a0=[];if(_0x45389f&&_0x45389f[_0xca2128(0x126)])try{_0x3aa7a0=JSON[_0xca2128(0xfd)](_0x45389f[_0xca2128(0x126)]);}catch(_0x172d36){}const _0x193fe0=activeSequence[0x0]['ts'],_0x1204ea=activeSequence[_0xca2128(0x149)](_0x48e177=>({'loc':_0x48e177[_0xca2128(0x141)],'t_delta':Math['round']((_0x48e177['ts']-_0x193fe0)/0x3e8)})),_0x17ae3c={'timestamp':new Date(_0x193fe0)[_0xca2128(0x12d)](),'steps':_0x1204ea,'duration':Math[_0xca2128(0x13a)]((activeSequence[activeSequence[_0xca2128(0x11a)]-0x1]['ts']-_0x193fe0)/0x3e8),'daytime':new Date(_0x193fe0)['getHours']()};_0x3aa7a0[_0xca2128(0x127)](_0x17ae3c);if(_0x3aa7a0[_0xca2128(0x11a)]>MAX_TRAINING_SET_SIZE)_0x3aa7a0[_0xca2128(0x15c)]();await _0xb690d1[_0xca2128(0x153)](_0xca2128(0x107),{'val':JSON['stringify'](_0x3aa7a0),'ack':!![]}),_0xb690d1['isProVersion']&&_0xb690d1[_0xca2128(0x12f)]&&_0xb690d1['sendToPythonWrapper'](_0xca2128(0x13c),{'sequence':_0x17ae3c});}catch(_0xceb81b){_0xb690d1[_0xca2128(0x14b)][_0xca2128(0xf4)](_0xca2128(0x10b)+_0xceb81b[_0xca2128(0x110)]);}}function a5_0x2c08(){const _0x2a9a71=['eventHistory','from','TRACK_EVENT','shift','door','exitGraceTimer','string','heizung','.1.VALVE_STATE','some','number','outdoorSensorId','7ShutkE','error','LTM.rawEventLog','kontakt','11097704kVzUdy','motion','230189xQfoRC','thermostat','.1.ACTUAL_TEMPERATURE','(((.+)+)+)+$','parse','toString','openweathermap','STATUS','weatherunderground','temperatur','normal','includes','getForeignStateAsync','constructor','LTM.trainingData.sequences','type','light','präsenz','[RECORDER]\x20Error:\x20','temperature','fenster','search','name','message','config','griff','now','Unknown','.forecast.current.temp','klima','895840qlyaAH','dimmer','lastTrackerEventTime','length','rawEventLog','.ACTUAL_TEMPERATURE','STATE','473049TaYvNC','schloss','isProVersion','Valve','7524234dDhECU','tür','isPresent','.4.VALVE_STATE','val','push','\x20from\x20','events.lastEvent','exitTimer','3184125lYSEZZ','exports','toISOString','unshift','sendToPythonWrapper','contact','SIMULATE_SIGNAL','window','LTM.trainingData.thermodynamics','location','splice','510nSKltm','.1.TEMPERATURE','system.isPresent','sensorLastValues','round','presence','ANALYZE_SEQUENCE','.Current.Temperature','valveMapping','bewegung','useWeather','loc','4cwaHLO','accuweather','.forecast.current.temperature','isExit','LEVEL','schalter','7155708WUzYFj','map','value','log','switch','pop','lampe','stringify','isGracePeriodActive','getStateAsync','level','setStateAsync','toLowerCase','weatherInstance','currentSystemMode','occupancy','daswetter'];a5_0x2c08=function(){return _0x2a9a71;};return a5_0x2c08();}async function recordSequence(_0x346724,_0x393825){const _0x54cd44=a5_0x501e,_0x533510=(_0x393825['type']||'')[_0x54cd44(0x154)](),_0x25cbba=['motion',_0x54cd44(0x13f),_0x54cd44(0x10a),_0x54cd44(0x13b),_0x54cd44(0x157),_0x54cd44(0x15d),_0x54cd44(0x123),_0x54cd44(0x132),_0x54cd44(0x10d),_0x54cd44(0x130),_0x54cd44(0xf6),'light','licht',_0x54cd44(0x14c),_0x54cd44(0x147),_0x54cd44(0x118),_0x54cd44(0x14e)];if(!_0x25cbba[_0x54cd44(0x162)](_0x32de97=>_0x533510[_0x54cd44(0x104)](_0x32de97)))return;if(!_0x393825[_0x54cd44(0x14a)])return;if(sequenceTimer)clearTimeout(sequenceTimer);activeSequence[_0x54cd44(0x127)]({'loc':_0x393825['location']||'Unknown','id':_0x393825['id'],'ts':Date[_0x54cd44(0x113)]()}),sequenceTimer=setTimeout(async()=>{const _0x427c8f=_0x54cd44;if(activeSequence[_0x427c8f(0x11a)]>0x1)await saveCompletedSequence(_0x346724);activeSequence=[];},SEQUENCE_TIMEOUT_MS);}function startExitTimer(_0x4ca0d8){const _0x4daa61=a5_0x501e;abortExitTimer(_0x4ca0d8),_0x4ca0d8[_0x4daa61(0x150)]=!![],_0x4ca0d8[_0x4daa61(0x15e)]=setTimeout(()=>{const _0xa596e8=_0x4daa61;_0x4ca0d8[_0xa596e8(0x150)]=![];},EXIT_GRACE_PERIOD_SECONDS*0x3e8),_0x4ca0d8[_0x4daa61(0x12a)]=setTimeout(()=>{const _0x42eade=_0x4daa61;setPresence(_0x4ca0d8,![]),_0x4ca0d8[_0x42eade(0x12a)]=null;},EXIT_TIMER_MINUTES*0x3c*0x3e8);}function abortExitTimer(_0x394676){const _0x3b4dbb=a5_0x501e;if(_0x394676['exitTimer'])clearTimeout(_0x394676['exitTimer']);if(_0x394676[_0x3b4dbb(0x15e)])clearTimeout(_0x394676[_0x3b4dbb(0x15e)]);_0x394676[_0x3b4dbb(0x12a)]=null,_0x394676['exitGraceTimer']=null,_0x394676[_0x3b4dbb(0x150)]=![];}async function setPresence(_0x4055b2,_0x447bf9){const _0xd6f979=a5_0x501e;if(_0x4055b2[_0xd6f979(0x124)]===_0x447bf9)return;_0x4055b2[_0xd6f979(0x124)]=_0x447bf9,await _0x4055b2['setStateAsync'](_0xd6f979(0x138),{'val':_0x447bf9,'ack':!![]});}async function processSensorEvent(_0x13c694,_0x808615,_0x598588,_0x46b681){const _0x202740=a5_0x501e;if(!_0x46b681)return null;const _0x21b6a2=_0x598588[_0x202740(0x126)],_0x9a7aad=Date[_0x202740(0x113)](),_0x3549c1=_0x13c694[_0x202740(0x139)][_0x808615],_0x2e94cc=(_0x46b681[_0x202740(0x108)]||'')[_0x202740(0x154)](),_0x85edca=_0x2e94cc[_0x202740(0x104)](_0x202740(0x10c))||_0x2e94cc[_0x202740(0x104)](_0x202740(0x102))||_0x2e94cc[_0x202740(0x104)](_0x202740(0x116))||_0x2e94cc[_0x202740(0x104)](_0x202740(0x160))||_0x2e94cc[_0x202740(0x104)](_0x202740(0xfa));if(_0x85edca&&typeof _0x21b6a2===_0x202740(0x163)){if(_0x21b6a2>0x50||_0x21b6a2<-0x32)return _0x13c694[_0x202740(0x14b)]['debug']('[RECORDER]\x20Ignored\x20implausible\x20temperature:\x20'+_0x21b6a2+_0x202740(0x128)+_0x808615),null;}_0x13c694[_0x202740(0x139)][_0x808615]=_0x21b6a2;if(!_0x46b681['logDuplicates']&&_0x3549c1!=undefined&&_0x3549c1==_0x21b6a2)return null;_0x13c694[_0x202740(0x120)]&&_0x85edca&&recordThermodynamics(_0x13c694,_0x808615,_0x21b6a2,_0x46b681[_0x202740(0x134)]);const _0x3d266d={'timestamp':_0x9a7aad,'id':_0x808615,'name':_0x46b681[_0x202740(0x10f)],'type':_0x46b681[_0x202740(0x108)],'location':_0x46b681['location'],'value':_0x21b6a2};_0x13c694[_0x202740(0x159)][_0x202740(0x12e)](_0x3d266d);if(_0x13c694[_0x202740(0x159)][_0x202740(0x11a)]>HISTORY_MAX_SIZE)_0x13c694[_0x202740(0x159)][_0x202740(0x14d)]();await _0x13c694[_0x202740(0x153)](_0x202740(0x129),{'val':JSON[_0x202740(0x14f)](_0x3d266d),'ack':!![]}),await _0x13c694[_0x202740(0x153)]('events.history',{'val':JSON[_0x202740(0x14f)](_0x13c694['eventHistory']),'ack':!![]});if(_0x13c694[_0x202740(0x120)]){_0x13c694['rawEventLog'][_0x202740(0x127)](_0x3d266d);if(_0x13c694[_0x202740(0x11b)][_0x202740(0x11a)]>RAW_LOG_MAX_SIZE)_0x13c694[_0x202740(0x11b)][_0x202740(0x135)](0x0,_0x13c694['rawEventLog'][_0x202740(0x11a)]-RAW_LOG_MAX_SIZE);await _0x13c694[_0x202740(0x153)](_0x202740(0xf5),{'val':JSON[_0x202740(0x14f)](_0x13c694[_0x202740(0x11b)]),'ack':!![]}),recordSequence(_0x13c694,_0x3d266d);}if(_0x46b681[_0x202740(0x145)]&&_0x21b6a2===!![]){if(_0x13c694['isPresent']&&!_0x13c694['isGracePeriodActive'])startExitTimer(_0x13c694);else{if(!_0x13c694['isPresent'])setPresence(_0x13c694,!![]);}}else{if(_0x46b681['type']===_0x202740(0xf8)&&_0x21b6a2===!![]){if(_0x13c694[_0x202740(0x12a)])abortExitTimer(_0x13c694);if(!_0x13c694['isPresent']&&_0x13c694[_0x202740(0x156)]===_0x202740(0x103))setPresence(_0x13c694,!![]);}}if(_0x13c694['isProVersion']&&_0x13c694[_0x202740(0x12f)]){_0x46b681['type']===_0x202740(0xf8)&&_0x21b6a2===!![]&&_0x46b681[_0x202740(0x134)]&&_0x13c694[_0x202740(0x12f)](_0x202740(0x131),{'room':_0x46b681[_0x202740(0x134)]});const _0x9773b0=['door',_0x202740(0x123),_0x202740(0x132),_0x202740(0x10d),_0x202740(0x112),'handle','lock',_0x202740(0x11f)][_0x202740(0x162)](_0x7d2ca9=>_0x2e94cc[_0x202740(0x104)](_0x7d2ca9)),_0x1e6288=[_0x202740(0x109),'licht','switch','schalter',_0x202740(0x118),_0x202740(0x14e)]['some'](_0x7b6c05=>_0x2e94cc[_0x202740(0x104)](_0x7b6c05)),_0x2e10ee=[_0x202740(0xf8),_0x202740(0x13f),_0x202740(0x10a),'presence',_0x202740(0x157)][_0x202740(0x162)](_0x2ea23b=>_0x2e94cc[_0x202740(0x104)](_0x2ea23b));if(_0x46b681['location']&&(_0x9773b0||_0x1e6288||_0x2e10ee)){const _0x3a8371=_0x21b6a2===!![]||typeof _0x21b6a2==='number'&&_0x21b6a2>0x0,_0x38076b=_0x9773b0&&!_0x3a8371&&_0x3549c1!==undefined&&_0x3549c1!=_0x21b6a2;if(_0x3a8371||_0x38076b){const _0xb7a149=_0x13c694[_0x202740(0x119)]||_0x9a7aad,_0x10091a=(_0x9a7aad-_0xb7a149)/0x3e8;_0x13c694[_0x202740(0x119)]=_0x9a7aad,_0x13c694[_0x202740(0x12f)](_0x202740(0x15b),{'room':_0x46b681['location'],'dt':_0x10091a});}}}return _0x3d266d;}module[a5_0x46e2d9(0x12c)]={'processSensorEvent':processSensorEvent,'getOutsideTemperatureNumeric':getOutsideTemperatureNumeric,'setPresence':setPresence,'abortExitTimer':abortExitTimer,'startExitTimer':startExitTimer};