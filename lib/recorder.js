const a5_0x3c0c38=a5_0x81ba;function a5_0x1f0e(){const _0x5da2a6=['schalter','contact','push','type','isProVersion','presence','error','daswetter','config','from','.1.TEMPERATURE','motion','outdoorSensorId','TRACK_EVENT','isPresent','.LEVEL','accuweather','präsenz','.1.LEVEL','461046DJDuvY','dimmer','window','includes','parse','handle','7016247fwKcDd','constructor','currentSystemMode','now','sensorLastValues','licht','level','length','stringify','log','eventHistory','241611cUuhos','getForeignStateAsync','[RECORDER]\x20Error:\x20','\x20from\x20','.1.ACTUAL_TEMPERATURE','13nTEifg','round','.1.VALVE_STATE','LEVEL','lastTrackerEventTime','name','temperatur','LTM.trainingData.sequences','getStateAsync','5RNDfHF','Unknown','openweathermap','6820490XgQrrH','LTM.rawEventLog','.forecast.current.temperature','loc','temperature','switch','exitTimer','shift','25536132uaqgjG','getHours','6pOWhTN','apply','val','rawEventLog','SIMULATE_SIGNAL','sendToPythonWrapper','isExit','ANALYZE_SEQUENCE','occupancy','Valve','number','door','system.isPresent','lock','tür','1381036SccdWc','.NextHours.Location_1.Day_1.current.temp_value','schloss','LTM.trainingData.thermodynamics','unshift','toLowerCase','bewegung','isGracePeriodActive','exitGraceTimer','8157393wBrnwm','Temperature','setStateAsync','2INgAwQ','.forecast.current.temp','STATE','string','11cKvRUJ','valveMapping','exports','location','thermostat','some','heizung','events.history','lampe','fenster','toString','(((.+)+)+)+$','debug','STATUS','.ACTUAL_TEMPERATURE','message','8hMDQqH','[RECORDER]\x20Ignored\x20implausible\x20temperature:\x20'];a5_0x1f0e=function(){return _0x5da2a6;};return a5_0x1f0e();}(function(_0x245449,_0x1fdcaf){const _0x4c6021=a5_0x81ba,_0x8f9ba9=_0x245449();while(!![]){try{const _0x91f7ba=parseInt(_0x4c6021(0x1b2))/0x1+-parseInt(_0x4c6021(0x1f9))/0x2*(-parseInt(_0x4c6021(0x1c3))/0x3)+parseInt(_0x4c6021(0x1ed))/0x4*(-parseInt(_0x4c6021(0x1d1))/0x5)+-parseInt(_0x4c6021(0x1de))/0x6*(-parseInt(_0x4c6021(0x1b8))/0x7)+parseInt(_0x4c6021(0x20d))/0x8*(parseInt(_0x4c6021(0x1f6))/0x9)+parseInt(_0x4c6021(0x1d4))/0xa*(parseInt(_0x4c6021(0x1fd))/0xb)+-parseInt(_0x4c6021(0x1dc))/0xc*(parseInt(_0x4c6021(0x1c8))/0xd);if(_0x91f7ba===_0x1fdcaf)break;else _0x8f9ba9['push'](_0x8f9ba9['shift']());}catch(_0x572e25){_0x8f9ba9['push'](_0x8f9ba9['shift']());}}}(a5_0x1f0e,0xa0e74));const a5_0x5ce06e=(function(){let _0x4167b2=!![];return function(_0x376b6b,_0x523ffb){const _0x3c4e2e=_0x4167b2?function(){const _0x14f0c4=a5_0x81ba;if(_0x523ffb){const _0x45df89=_0x523ffb[_0x14f0c4(0x1df)](_0x376b6b,arguments);return _0x523ffb=null,_0x45df89;}}:function(){};return _0x4167b2=![],_0x3c4e2e;};}()),a5_0x4f2431=a5_0x5ce06e(this,function(){const _0x40ebf6=a5_0x81ba;return a5_0x4f2431[_0x40ebf6(0x207)]()['search'](_0x40ebf6(0x208))['toString']()[_0x40ebf6(0x1b9)](a5_0x4f2431)['search'](_0x40ebf6(0x208));});a5_0x4f2431();'use strict';const HISTORY_MAX_SIZE=0x32,RAW_LOG_MAX_SIZE=0x9c4,THERMO_LOG_SIZE=0x3e8,SEQUENCE_TIMEOUT_MS=0x5*0x3c*0x3e8,MAX_TRAINING_SET_SIZE=0x1f4,EXIT_TIMER_MINUTES=0xf,EXIT_GRACE_PERIOD_SECONDS=0x1e;let activeSequence=[],sequenceTimer=null;async function getOutsideTemperatureNumeric(_0x3c9d0c){const _0x22f54c=a5_0x81ba;if(_0x3c9d0c[_0x22f54c(0x217)][_0x22f54c(0x21b)])try{const _0x52368f=await _0x3c9d0c[_0x22f54c(0x1c4)](_0x3c9d0c['config'][_0x22f54c(0x21b)]);if(_0x52368f&&_0x52368f['val']!==undefined&&_0x52368f[_0x22f54c(0x1e0)]!==null)return parseFloat(_0x52368f[_0x22f54c(0x1e0)]);}catch(_0xbcb9d6){}const _0x2e5a73=_0x3c9d0c[_0x22f54c(0x217)]['weatherInstance'];if(!_0x3c9d0c[_0x22f54c(0x217)]['useWeather']||!_0x2e5a73)return null;try{let _0x1d5105='';if(_0x2e5a73[_0x22f54c(0x1b5)](_0x22f54c(0x1af)))_0x1d5105=_0x2e5a73+'.Current.Temperature';else{if(_0x2e5a73['includes'](_0x22f54c(0x216)))_0x1d5105=_0x2e5a73+_0x22f54c(0x1ee);else{if(_0x2e5a73[_0x22f54c(0x1b5)](_0x22f54c(0x1d3)))_0x1d5105=_0x2e5a73+_0x22f54c(0x1d6);else{if(_0x2e5a73[_0x22f54c(0x1b5)]('weatherunderground'))_0x1d5105=_0x2e5a73+_0x22f54c(0x1fa);}}}if(_0x1d5105){const _0x5bd2b3=await _0x3c9d0c['getForeignStateAsync'](_0x1d5105);if(_0x5bd2b3&&_0x5bd2b3[_0x22f54c(0x1e0)]!==undefined&&_0x5bd2b3[_0x22f54c(0x1e0)]!==null)return parseFloat(_0x5bd2b3['val']);}}catch(_0x23f087){}return null;}async function recordThermodynamics(_0x565f67,_0x7401fd,_0x39ebe5,_0x3059b8){const _0x1d3c69=a5_0x81ba,_0x5d2527=await getOutsideTemperatureNumeric(_0x565f67);if(_0x5d2527===null)return;let _0x2030a4=0x0,_0x42e2c7=![];if(_0x565f67[_0x1d3c69(0x217)][_0x1d3c69(0x1fe)])try{let _0x5dfe8a=_0x565f67['config'][_0x1d3c69(0x1fe)];if(typeof _0x5dfe8a===_0x1d3c69(0x1fc))_0x5dfe8a=JSON[_0x1d3c69(0x1b6)](_0x5dfe8a);if(_0x5dfe8a[_0x7401fd]){const _0x3babbe=_0x5dfe8a[_0x7401fd],_0x28b2c7=await _0x565f67[_0x1d3c69(0x1c4)](_0x3babbe);if(_0x28b2c7&&_0x28b2c7[_0x1d3c69(0x1e0)]!==null&&_0x28b2c7[_0x1d3c69(0x1e0)]!==undefined){let _0x35f3fe=Number(_0x28b2c7['val']);if(_0x35f3fe<=1.05&&!_0x3babbe[_0x1d3c69(0x1b5)](_0x1d3c69(0x20a))&&!_0x3babbe[_0x1d3c69(0x1b5)](_0x1d3c69(0x1fb)))_0x35f3fe=_0x35f3fe*0x64;_0x2030a4=Math[_0x1d3c69(0x1c9)](_0x35f3fe),_0x42e2c7=!![];}}}catch(_0x44776f){}if(!_0x42e2c7){const _0x3f4549=[{'from':_0x1d3c69(0x1c7),'to':_0x1d3c69(0x1b1)},{'from':_0x1d3c69(0x1c7),'to':_0x1d3c69(0x1ca)},{'from':_0x1d3c69(0x219),'to':'.4.VALVE_STATE'},{'from':_0x1d3c69(0x20b),'to':_0x1d3c69(0x21e)},{'from':'temperature','to':_0x1d3c69(0x1be)},{'from':_0x1d3c69(0x1f7),'to':_0x1d3c69(0x1e7)}];for(const _0x2670be of _0x3f4549){if(_0x7401fd[_0x1d3c69(0x1b5)](_0x2670be[_0x1d3c69(0x218)])){const _0x9b2c4f=_0x7401fd['replace'](_0x2670be['from'],_0x2670be['to']);try{const _0x43144b=await _0x565f67['getForeignStateAsync'](_0x9b2c4f);if(_0x43144b&&_0x43144b[_0x1d3c69(0x1e0)]!==null&&_0x43144b['val']!==undefined){let _0x299a75=Number(_0x43144b[_0x1d3c69(0x1e0)]);if(typeof _0x299a75===_0x1d3c69(0x1e8)){if(_0x299a75<=1.05&&_0x2670be['to']['includes'](_0x1d3c69(0x1cb)))_0x299a75=_0x299a75*0x64;_0x2030a4=Math[_0x1d3c69(0x1c9)](_0x299a75),_0x42e2c7=!![];break;}}}catch(_0x26e492){}}}}const _0x26dc12=await _0x565f67['getStateAsync'](_0x1d3c69(0x1f0));let _0x468cab=[];if(_0x26dc12&&_0x26dc12[_0x1d3c69(0x1e0)])try{_0x468cab=JSON[_0x1d3c69(0x1b6)](_0x26dc12[_0x1d3c69(0x1e0)]);}catch(_0x2fa736){}_0x468cab[_0x1d3c69(0x211)]({'ts':Date[_0x1d3c69(0x1bb)](),'room':_0x3059b8||_0x1d3c69(0x1d2),'t_in':_0x39ebe5,'t_out':_0x5d2527,'valve':_0x2030a4});if(_0x468cab['length']>THERMO_LOG_SIZE)_0x468cab[_0x1d3c69(0x1db)]();await _0x565f67[_0x1d3c69(0x1f8)](_0x1d3c69(0x1f0),{'val':JSON[_0x1d3c69(0x1c0)](_0x468cab),'ack':!![]});}async function saveCompletedSequence(_0x147c86){const _0xb909f3=a5_0x81ba;try{const _0xbaf525=await _0x147c86[_0xb909f3(0x1d0)](_0xb909f3(0x1cf));let _0x8d4a8=[];if(_0xbaf525&&_0xbaf525['val'])try{_0x8d4a8=JSON[_0xb909f3(0x1b6)](_0xbaf525[_0xb909f3(0x1e0)]);}catch(_0x23ede0){}const _0x140fb8=activeSequence[0x0]['ts'],_0x2b37b5=activeSequence['map'](_0x5eba44=>({'loc':_0x5eba44[_0xb909f3(0x1d7)],'t_delta':Math[_0xb909f3(0x1c9)]((_0x5eba44['ts']-_0x140fb8)/0x3e8)})),_0x2e3677={'timestamp':new Date(_0x140fb8)['toISOString'](),'steps':_0x2b37b5,'duration':Math[_0xb909f3(0x1c9)]((activeSequence[activeSequence[_0xb909f3(0x1bf)]-0x1]['ts']-_0x140fb8)/0x3e8),'daytime':new Date(_0x140fb8)[_0xb909f3(0x1dd)]()};_0x8d4a8[_0xb909f3(0x211)](_0x2e3677);if(_0x8d4a8[_0xb909f3(0x1bf)]>MAX_TRAINING_SET_SIZE)_0x8d4a8[_0xb909f3(0x1db)]();await _0x147c86[_0xb909f3(0x1f8)](_0xb909f3(0x1cf),{'val':JSON[_0xb909f3(0x1c0)](_0x8d4a8),'ack':!![]}),_0x147c86[_0xb909f3(0x213)]&&_0x147c86[_0xb909f3(0x1e3)]&&_0x147c86[_0xb909f3(0x1e3)](_0xb909f3(0x1e5),{'sequence':_0x2e3677});}catch(_0x3c507c){_0x147c86[_0xb909f3(0x1c1)][_0xb909f3(0x215)](_0xb909f3(0x1c5)+_0x3c507c[_0xb909f3(0x20c)]);}}async function recordSequence(_0x40a56b,_0x36f9b3){const _0x4323db=a5_0x81ba,_0x45f56a=(_0x36f9b3['type']||'')['toLowerCase'](),_0x425eb4=[_0x4323db(0x21a),_0x4323db(0x1f3),'präsenz',_0x4323db(0x214),_0x4323db(0x1e6),'door',_0x4323db(0x1ec),'window','fenster',_0x4323db(0x210),'kontakt','light',_0x4323db(0x1bd),_0x4323db(0x1d9),_0x4323db(0x20f),_0x4323db(0x1b3),_0x4323db(0x205)];if(!_0x425eb4[_0x4323db(0x202)](_0x4cd5be=>_0x45f56a[_0x4323db(0x1b5)](_0x4cd5be)))return;if(!_0x36f9b3['value'])return;if(sequenceTimer)clearTimeout(sequenceTimer);activeSequence[_0x4323db(0x211)]({'loc':_0x36f9b3[_0x4323db(0x200)]||_0x4323db(0x1d2),'id':_0x36f9b3['id'],'ts':Date[_0x4323db(0x1bb)]()}),sequenceTimer=setTimeout(async()=>{const _0x208b94=_0x4323db;if(activeSequence[_0x208b94(0x1bf)]>0x1)await saveCompletedSequence(_0x40a56b);activeSequence=[];},SEQUENCE_TIMEOUT_MS);}function a5_0x81ba(_0xddf86,_0x120dba){const _0x12af6a=a5_0x1f0e();return a5_0x81ba=function(_0x4f2431,_0x5ce06e){_0x4f2431=_0x4f2431-0x1af;let _0x1f0efb=_0x12af6a[_0x4f2431];return _0x1f0efb;},a5_0x81ba(_0xddf86,_0x120dba);}function startExitTimer(_0x1060b1){const _0x3005e2=a5_0x81ba;abortExitTimer(_0x1060b1),_0x1060b1[_0x3005e2(0x1f4)]=!![],_0x1060b1[_0x3005e2(0x1f5)]=setTimeout(()=>{_0x1060b1['isGracePeriodActive']=![];},EXIT_GRACE_PERIOD_SECONDS*0x3e8),_0x1060b1[_0x3005e2(0x1da)]=setTimeout(()=>{const _0x3f14a3=_0x3005e2;setPresence(_0x1060b1,![]),_0x1060b1[_0x3f14a3(0x1da)]=null;},EXIT_TIMER_MINUTES*0x3c*0x3e8);}function abortExitTimer(_0x1e5fb4){const _0x567b56=a5_0x81ba;if(_0x1e5fb4[_0x567b56(0x1da)])clearTimeout(_0x1e5fb4['exitTimer']);if(_0x1e5fb4['exitGraceTimer'])clearTimeout(_0x1e5fb4[_0x567b56(0x1f5)]);_0x1e5fb4[_0x567b56(0x1da)]=null,_0x1e5fb4[_0x567b56(0x1f5)]=null,_0x1e5fb4[_0x567b56(0x1f4)]=![];}async function setPresence(_0xdba61a,_0x513435){const _0x9a7b8d=a5_0x81ba;if(_0xdba61a[_0x9a7b8d(0x21d)]===_0x513435)return;_0xdba61a[_0x9a7b8d(0x21d)]=_0x513435,await _0xdba61a[_0x9a7b8d(0x1f8)](_0x9a7b8d(0x1ea),{'val':_0x513435,'ack':!![]});}async function processSensorEvent(_0x45ee34,_0x44ff75,_0x51054c,_0x41b3de){const _0x2767f7=a5_0x81ba;if(!_0x41b3de)return null;const _0x48bd90=_0x51054c[_0x2767f7(0x1e0)],_0x1a4224=Date[_0x2767f7(0x1bb)](),_0x391995=_0x45ee34['sensorLastValues'][_0x44ff75],_0x5b3e48=(_0x41b3de['type']||'')[_0x2767f7(0x1f2)](),_0x3afaae=_0x5b3e48[_0x2767f7(0x1b5)](_0x2767f7(0x1d8))||_0x5b3e48[_0x2767f7(0x1b5)](_0x2767f7(0x1ce))||_0x5b3e48['includes']('klima')||_0x5b3e48[_0x2767f7(0x1b5)](_0x2767f7(0x203))||_0x5b3e48['includes'](_0x2767f7(0x201));if(_0x3afaae&&typeof _0x48bd90===_0x2767f7(0x1e8)){if(_0x48bd90>0x50||_0x48bd90<-0x32)return _0x45ee34[_0x2767f7(0x1c1)][_0x2767f7(0x209)](_0x2767f7(0x20e)+_0x48bd90+_0x2767f7(0x1c6)+_0x44ff75),null;}_0x45ee34[_0x2767f7(0x1bc)][_0x44ff75]=_0x48bd90;if(!_0x41b3de['logDuplicates']&&_0x391995!=undefined&&_0x391995==_0x48bd90)return null;_0x45ee34[_0x2767f7(0x213)]&&_0x3afaae&&recordThermodynamics(_0x45ee34,_0x44ff75,_0x48bd90,_0x41b3de[_0x2767f7(0x200)]);const _0x431c7c={'timestamp':_0x1a4224,'id':_0x44ff75,'name':_0x41b3de[_0x2767f7(0x1cd)],'type':_0x41b3de[_0x2767f7(0x212)],'location':_0x41b3de[_0x2767f7(0x200)],'value':_0x48bd90};_0x45ee34[_0x2767f7(0x1c2)][_0x2767f7(0x1f1)](_0x431c7c);if(_0x45ee34[_0x2767f7(0x1c2)][_0x2767f7(0x1bf)]>HISTORY_MAX_SIZE)_0x45ee34[_0x2767f7(0x1c2)]['pop']();await _0x45ee34[_0x2767f7(0x1f8)]('events.lastEvent',{'val':JSON[_0x2767f7(0x1c0)](_0x431c7c),'ack':!![]}),await _0x45ee34[_0x2767f7(0x1f8)](_0x2767f7(0x204),{'val':JSON['stringify'](_0x45ee34[_0x2767f7(0x1c2)]),'ack':!![]});if(_0x45ee34[_0x2767f7(0x213)]){_0x45ee34[_0x2767f7(0x1e1)]['push'](_0x431c7c);if(_0x45ee34[_0x2767f7(0x1e1)][_0x2767f7(0x1bf)]>RAW_LOG_MAX_SIZE)_0x45ee34[_0x2767f7(0x1e1)]['splice'](0x0,_0x45ee34[_0x2767f7(0x1e1)][_0x2767f7(0x1bf)]-RAW_LOG_MAX_SIZE);await _0x45ee34[_0x2767f7(0x1f8)](_0x2767f7(0x1d5),{'val':JSON[_0x2767f7(0x1c0)](_0x45ee34[_0x2767f7(0x1e1)]),'ack':!![]}),recordSequence(_0x45ee34,_0x431c7c);}if(_0x41b3de[_0x2767f7(0x1e4)]&&_0x48bd90===!![]){if(_0x45ee34[_0x2767f7(0x21d)]&&!_0x45ee34['isGracePeriodActive'])startExitTimer(_0x45ee34);else{if(!_0x45ee34['isPresent'])setPresence(_0x45ee34,!![]);}}else{if(_0x41b3de['type']===_0x2767f7(0x21a)&&_0x48bd90===!![]){if(_0x45ee34[_0x2767f7(0x1da)])abortExitTimer(_0x45ee34);if(!_0x45ee34['isPresent']&&_0x45ee34[_0x2767f7(0x1ba)]==='normal')setPresence(_0x45ee34,!![]);}}if(_0x45ee34[_0x2767f7(0x213)]&&_0x45ee34[_0x2767f7(0x1e3)]){_0x41b3de[_0x2767f7(0x212)]===_0x2767f7(0x21a)&&_0x48bd90===!![]&&_0x41b3de[_0x2767f7(0x200)]&&_0x45ee34['sendToPythonWrapper'](_0x2767f7(0x1e2),{'room':_0x41b3de[_0x2767f7(0x200)]});const _0x224050=[_0x2767f7(0x1e9),_0x2767f7(0x1ec),_0x2767f7(0x1b4),_0x2767f7(0x206),'griff',_0x2767f7(0x1b7),_0x2767f7(0x1eb),_0x2767f7(0x1ef)][_0x2767f7(0x202)](_0x5f2ec4=>_0x5b3e48[_0x2767f7(0x1b5)](_0x5f2ec4)),_0x29bef5=['light','licht',_0x2767f7(0x1d9),_0x2767f7(0x20f),'dimmer',_0x2767f7(0x205)][_0x2767f7(0x202)](_0x38ffed=>_0x5b3e48[_0x2767f7(0x1b5)](_0x38ffed)),_0xa2b920=[_0x2767f7(0x21a),_0x2767f7(0x1f3),_0x2767f7(0x1b0),_0x2767f7(0x214),'occupancy'][_0x2767f7(0x202)](_0x267028=>_0x5b3e48[_0x2767f7(0x1b5)](_0x267028));if(_0x41b3de[_0x2767f7(0x200)]&&(_0x224050||_0x29bef5||_0xa2b920)){const _0x27fdc8=_0x48bd90===!![]||typeof _0x48bd90===_0x2767f7(0x1e8)&&_0x48bd90>0x0,_0x1ba371=_0x224050&&!_0x27fdc8&&_0x391995!==undefined&&_0x391995!=_0x48bd90;if(_0x27fdc8||_0x1ba371){const _0x52e9ff=_0x45ee34['lastTrackerEventTime']||_0x1a4224,_0x363ec0=(_0x1a4224-_0x52e9ff)/0x3e8;_0x45ee34[_0x2767f7(0x1cc)]=_0x1a4224,_0x45ee34['sendToPythonWrapper'](_0x2767f7(0x21c),{'room':_0x41b3de[_0x2767f7(0x200)],'dt':_0x363ec0});}}}return _0x431c7c;}module[a5_0x3c0c38(0x1ff)]={'processSensorEvent':processSensorEvent,'getOutsideTemperatureNumeric':getOutsideTemperatureNumeric,'setPresence':setPresence,'abortExitTimer':abortExitTimer,'startExitTimer':startExitTimer};