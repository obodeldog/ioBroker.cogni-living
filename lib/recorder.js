(function(_0x55839e,_0x43bd15){const _0x52ac8e=a5_0x469d,_0x19c757=_0x55839e();while(!![]){try{const _0x5044f4=-parseInt(_0x52ac8e(0x1b2))/0x1*(-parseInt(_0x52ac8e(0x1a6))/0x2)+parseInt(_0x52ac8e(0x178))/0x3+-parseInt(_0x52ac8e(0x1a1))/0x4*(-parseInt(_0x52ac8e(0x196))/0x5)+parseInt(_0x52ac8e(0x1b9))/0x6+-parseInt(_0x52ac8e(0x194))/0x7*(-parseInt(_0x52ac8e(0x16f))/0x8)+parseInt(_0x52ac8e(0x1b4))/0x9*(parseInt(_0x52ac8e(0x1aa))/0xa)+-parseInt(_0x52ac8e(0x184))/0xb;if(_0x5044f4===_0x43bd15)break;else _0x19c757['push'](_0x19c757['shift']());}catch(_0x4cdf1f){_0x19c757['push'](_0x19c757['shift']());}}}(a5_0x4535,0xb5819));const a5_0x640428=(function(){let _0x27e25c=!![];return function(_0x55e9d2,_0x6a0955){const _0x379fbc=_0x27e25c?function(){const _0x3b141d=a5_0x469d;if(_0x6a0955){const _0x4766c7=_0x6a0955[_0x3b141d(0x183)](_0x55e9d2,arguments);return _0x6a0955=null,_0x4766c7;}}:function(){};return _0x27e25c=![],_0x379fbc;};}()),a5_0x208d9c=a5_0x640428(this,function(){const _0x3a4a90=a5_0x469d;return a5_0x208d9c[_0x3a4a90(0x1ac)]()['search'](_0x3a4a90(0x1b7))['toString']()[_0x3a4a90(0x1af)](a5_0x208d9c)[_0x3a4a90(0x17a)](_0x3a4a90(0x1b7));});a5_0x208d9c();'use strict';const HISTORY_MAX_SIZE=0x32,RAW_LOG_MAX_SIZE=0x9c4,THERMO_LOG_SIZE=0x3e8,SEQUENCE_TIMEOUT_MS=0x5*0x3c*0x3e8,MAX_TRAINING_SET_SIZE=0x1f4,EXIT_TIMER_MINUTES=0xf,EXIT_GRACE_PERIOD_SECONDS=0x1e;let activeSequence=[],sequenceTimer=null;async function getOutsideTemperatureNumeric(_0x5b0d12){const _0x140f75=a5_0x469d;if(_0x5b0d12['config'][_0x140f75(0x17e)])try{const _0x19719f=await _0x5b0d12[_0x140f75(0x1b0)](_0x5b0d12['config'][_0x140f75(0x17e)]);if(_0x19719f&&_0x19719f[_0x140f75(0x19c)]!==undefined&&_0x19719f[_0x140f75(0x19c)]!==null)return parseFloat(_0x19719f[_0x140f75(0x19c)]);}catch(_0x5c5d67){}const _0x1e6549=_0x5b0d12[_0x140f75(0x188)][_0x140f75(0x174)];if(!_0x5b0d12[_0x140f75(0x188)]['useWeather']||!_0x1e6549)return null;try{let _0x51f0d6='';if(_0x1e6549['includes'](_0x140f75(0x18b)))_0x51f0d6=_0x1e6549+_0x140f75(0x1a7);else{if(_0x1e6549[_0x140f75(0x19a)](_0x140f75(0x197)))_0x51f0d6=_0x1e6549+'.NextHours.Location_1.Day_1.current.temp_value';else{if(_0x1e6549[_0x140f75(0x19a)]('openweathermap'))_0x51f0d6=_0x1e6549+'.forecast.current.temperature';else{if(_0x1e6549['includes'](_0x140f75(0x192)))_0x51f0d6=_0x1e6549+_0x140f75(0x171);}}}if(_0x51f0d6){const _0x27c0b9=await _0x5b0d12[_0x140f75(0x1b0)](_0x51f0d6);if(_0x27c0b9&&_0x27c0b9[_0x140f75(0x19c)]!==undefined&&_0x27c0b9[_0x140f75(0x19c)]!==null)return parseFloat(_0x27c0b9['val']);}}catch(_0x32c021){}return null;}function a5_0x4535(){const _0x3276d0=['LTM.trainingData.thermodynamics','type','82070eufodI','occupancy','toString','tür','setStateAsync','constructor','getForeignStateAsync','round','2hbuvPl','now','369yIbGAb','kontakt','temperature','(((.+)+)+)+$','map','6279702yqlwqU','getHours','splice','LTM.rawEventLog','events.lastEvent','pop','toISOString','window','length','some','value','light','rawEventLog','240824FDFZqT','sensorLastValues','.forecast.current.temp','toLowerCase','push','weatherInstance','dimmer','temperatur','ANALYZE_SEQUENCE','619179KuaILb','isExit','search','getStateAsync','isGracePeriodActive','isPresent','outdoorSensorId','motion','system.isPresent','message','lampe','apply','40071900rfoIVC','heizung','sendToPythonWrapper','stringify','config','shift','unshift','accuweather','log','exitGraceTimer','Unknown','klima','eventHistory','[RECORDER]\x20Error:\x20','weatherunderground','switch','301nqPwRA','currentSystemMode','25yYjBvc','daswetter','door','parse','includes','events.history','val','location','presence','isProVersion','schalter','189788mEVDvz','exitTimer','licht','LTM.trainingData.sequences','normal','1265188bFTAoi','.Current.Temperature'];a5_0x4535=function(){return _0x3276d0;};return a5_0x4535();}async function recordThermodynamics(_0x1144bf,_0x551998,_0x38a4fe,_0x3666a3){const _0x350fb8=a5_0x469d,_0xa6d999=await getOutsideTemperatureNumeric(_0x1144bf),_0x53ab3b=await _0x1144bf[_0x350fb8(0x17b)]('LTM.trainingData.thermodynamics');let _0x58889b=[];if(_0x53ab3b&&_0x53ab3b[_0x350fb8(0x19c)])try{_0x58889b=JSON[_0x350fb8(0x199)](_0x53ab3b[_0x350fb8(0x19c)]);}catch(_0x41ebf6){}_0x58889b['push']({'ts':Date['now'](),'room':_0x3666a3||_0x350fb8(0x18e),'t_in':_0x38a4fe,'t_out':_0xa6d999});if(_0x58889b['length']>THERMO_LOG_SIZE)_0x58889b[_0x350fb8(0x189)]();await _0x1144bf['setStateAsync'](_0x350fb8(0x1a8),{'val':JSON[_0x350fb8(0x187)](_0x58889b),'ack':!![]});}async function saveCompletedSequence(_0x22cb6c){const _0x319466=a5_0x469d;try{const _0x87ba7c=await _0x22cb6c[_0x319466(0x17b)](_0x319466(0x1a4));let _0x4e79e1=[];if(_0x87ba7c&&_0x87ba7c[_0x319466(0x19c)])try{_0x4e79e1=JSON[_0x319466(0x199)](_0x87ba7c[_0x319466(0x19c)]);}catch(_0x1128c3){}const _0x361d47=activeSequence[0x0]['ts'],_0x5a2efc=activeSequence[_0x319466(0x1b8)](_0x1188db=>({'loc':_0x1188db['loc'],'t_delta':Math[_0x319466(0x1b1)]((_0x1188db['ts']-_0x361d47)/0x3e8)})),_0x5694a7={'timestamp':new Date(_0x361d47)[_0x319466(0x168)](),'steps':_0x5a2efc,'duration':Math[_0x319466(0x1b1)]((activeSequence[activeSequence[_0x319466(0x16a)]-0x1]['ts']-_0x361d47)/0x3e8),'daytime':new Date(_0x361d47)[_0x319466(0x1ba)]()};_0x4e79e1[_0x319466(0x173)](_0x5694a7);if(_0x4e79e1[_0x319466(0x16a)]>MAX_TRAINING_SET_SIZE)_0x4e79e1[_0x319466(0x189)]();await _0x22cb6c[_0x319466(0x1ae)](_0x319466(0x1a4),{'val':JSON[_0x319466(0x187)](_0x4e79e1),'ack':!![]}),_0x22cb6c[_0x319466(0x19f)]&&_0x22cb6c[_0x319466(0x186)]&&_0x22cb6c['sendToPythonWrapper'](_0x319466(0x177),{'sequence':_0x5694a7});}catch(_0x3d4347){_0x22cb6c[_0x319466(0x18c)]['error'](_0x319466(0x191)+_0x3d4347[_0x319466(0x181)]);}}async function recordSequence(_0x517bb5,_0x31b5a9){const _0x2841fd=a5_0x469d,_0x3a2b07=(_0x31b5a9[_0x2841fd(0x1a9)]||'')[_0x2841fd(0x172)](),_0x458e99=[_0x2841fd(0x17f),'bewegung','präsenz',_0x2841fd(0x19e),_0x2841fd(0x1ab),_0x2841fd(0x198),_0x2841fd(0x1ad),_0x2841fd(0x169),'fenster','contact',_0x2841fd(0x1b5),_0x2841fd(0x16d),_0x2841fd(0x1a3),_0x2841fd(0x193),_0x2841fd(0x1a0),_0x2841fd(0x175),_0x2841fd(0x182)];if(!_0x458e99[_0x2841fd(0x16b)](_0x43743f=>_0x3a2b07[_0x2841fd(0x19a)](_0x43743f)))return;if(!_0x31b5a9[_0x2841fd(0x16c)])return;if(sequenceTimer)clearTimeout(sequenceTimer);activeSequence[_0x2841fd(0x173)]({'loc':_0x31b5a9[_0x2841fd(0x19d)]||_0x2841fd(0x18e),'id':_0x31b5a9['id'],'ts':Date[_0x2841fd(0x1b3)]()}),sequenceTimer=setTimeout(async()=>{const _0x22530d=_0x2841fd;if(activeSequence[_0x22530d(0x16a)]>0x1)await saveCompletedSequence(_0x517bb5);activeSequence=[];},SEQUENCE_TIMEOUT_MS);}function startExitTimer(_0x3deb2f){const _0x45fc57=a5_0x469d;abortExitTimer(_0x3deb2f),_0x3deb2f[_0x45fc57(0x17c)]=!![],_0x3deb2f[_0x45fc57(0x18d)]=setTimeout(()=>{_0x3deb2f['isGracePeriodActive']=![];},EXIT_GRACE_PERIOD_SECONDS*0x3e8),_0x3deb2f[_0x45fc57(0x1a2)]=setTimeout(()=>{const _0x291245=_0x45fc57;setPresence(_0x3deb2f,![]),_0x3deb2f[_0x291245(0x1a2)]=null;},EXIT_TIMER_MINUTES*0x3c*0x3e8);}function a5_0x469d(_0x788a89,_0x1ad245){const _0x1dd20c=a5_0x4535();return a5_0x469d=function(_0x208d9c,_0x640428){_0x208d9c=_0x208d9c-0x164;let _0x4535de=_0x1dd20c[_0x208d9c];return _0x4535de;},a5_0x469d(_0x788a89,_0x1ad245);}function abortExitTimer(_0xa38be9){const _0x112729=a5_0x469d;if(_0xa38be9[_0x112729(0x1a2)])clearTimeout(_0xa38be9['exitTimer']);if(_0xa38be9[_0x112729(0x18d)])clearTimeout(_0xa38be9['exitGraceTimer']);_0xa38be9[_0x112729(0x1a2)]=null,_0xa38be9['exitGraceTimer']=null,_0xa38be9[_0x112729(0x17c)]=![];}async function setPresence(_0x5cd03f,_0x2670f2){const _0x191dfe=a5_0x469d;if(_0x5cd03f[_0x191dfe(0x17d)]===_0x2670f2)return;_0x5cd03f['isPresent']=_0x2670f2,await _0x5cd03f[_0x191dfe(0x1ae)](_0x191dfe(0x180),{'val':_0x2670f2,'ack':!![]});}async function processSensorEvent(_0x10d818,_0x40a088,_0x8d65c7,_0x30da89){const _0x573f38=a5_0x469d;if(!_0x30da89)return null;const _0x10a919=_0x8d65c7['val'],_0x1b231e=Date[_0x573f38(0x1b3)](),_0x4b809d=_0x10d818[_0x573f38(0x170)][_0x40a088];_0x10d818[_0x573f38(0x170)][_0x40a088]=_0x10a919;if(!_0x30da89['logDuplicates']&&_0x4b809d!=undefined&&_0x4b809d==_0x10a919)return null;const _0x364f8a=(_0x30da89['type']||'')[_0x573f38(0x172)](),_0x32b820=_0x364f8a[_0x573f38(0x19a)](_0x573f38(0x1b6))||_0x364f8a['includes'](_0x573f38(0x176))||_0x364f8a[_0x573f38(0x19a)](_0x573f38(0x18f))||_0x364f8a['includes'](_0x573f38(0x185));_0x10d818['isProVersion']&&_0x32b820&&recordThermodynamics(_0x10d818,_0x40a088,_0x10a919,_0x30da89[_0x573f38(0x19d)]);const _0xb4cfe={'timestamp':_0x1b231e,'id':_0x40a088,'name':_0x30da89['name'],'type':_0x30da89[_0x573f38(0x1a9)],'location':_0x30da89[_0x573f38(0x19d)],'value':_0x10a919};_0x10d818[_0x573f38(0x190)][_0x573f38(0x18a)](_0xb4cfe);if(_0x10d818[_0x573f38(0x190)][_0x573f38(0x16a)]>HISTORY_MAX_SIZE)_0x10d818[_0x573f38(0x190)][_0x573f38(0x167)]();await _0x10d818[_0x573f38(0x1ae)](_0x573f38(0x166),{'val':JSON[_0x573f38(0x187)](_0xb4cfe),'ack':!![]}),await _0x10d818['setStateAsync'](_0x573f38(0x19b),{'val':JSON[_0x573f38(0x187)](_0x10d818[_0x573f38(0x190)]),'ack':!![]});if(_0x10d818['isProVersion']){_0x10d818[_0x573f38(0x16e)]['push'](_0xb4cfe);if(_0x10d818[_0x573f38(0x16e)]['length']>RAW_LOG_MAX_SIZE)_0x10d818['rawEventLog'][_0x573f38(0x164)](0x0,_0x10d818[_0x573f38(0x16e)][_0x573f38(0x16a)]-RAW_LOG_MAX_SIZE);await _0x10d818[_0x573f38(0x1ae)](_0x573f38(0x165),{'val':JSON[_0x573f38(0x187)](_0x10d818['rawEventLog']),'ack':!![]}),recordSequence(_0x10d818,_0xb4cfe);}if(_0x30da89[_0x573f38(0x179)]&&_0x10a919===!![]){if(_0x10d818[_0x573f38(0x17d)]&&!_0x10d818[_0x573f38(0x17c)])startExitTimer(_0x10d818);else{if(!_0x10d818['isPresent'])setPresence(_0x10d818,!![]);}}else{if(_0x30da89['type']===_0x573f38(0x17f)&&_0x10a919===!![]){if(_0x10d818[_0x573f38(0x1a2)])abortExitTimer(_0x10d818);if(!_0x10d818[_0x573f38(0x17d)]&&_0x10d818[_0x573f38(0x195)]===_0x573f38(0x1a5))setPresence(_0x10d818,!![]);}}return _0x10d818[_0x573f38(0x19f)]&&_0x30da89[_0x573f38(0x1a9)]===_0x573f38(0x17f)&&_0x10a919===!![]&&_0x30da89[_0x573f38(0x19d)]&&_0x10d818[_0x573f38(0x186)]&&_0x10d818[_0x573f38(0x186)]('SIMULATE_SIGNAL',{'room':_0x30da89[_0x573f38(0x19d)]}),_0xb4cfe;}module['exports']={'processSensorEvent':processSensorEvent,'getOutsideTemperatureNumeric':getOutsideTemperatureNumeric,'setPresence':setPresence,'abortExitTimer':abortExitTimer,'startExitTimer':startExitTimer};