function a5_0x3524(_0x3be02a,_0x2c34f0){const _0x33f693=a5_0x4978();return a5_0x3524=function(_0x4b9085,_0x4f879d){_0x4b9085=_0x4b9085-0xcc;let _0x497886=_0x33f693[_0x4b9085];return _0x497886;},a5_0x3524(_0x3be02a,_0x2c34f0);}(function(_0x3df377,_0xa7562a){const _0x277c6f=a5_0x3524,_0x563c38=_0x3df377();while(!![]){try{const _0x4ea21e=parseInt(_0x277c6f(0x10e))/0x1+parseInt(_0x277c6f(0xf5))/0x2*(-parseInt(_0x277c6f(0xf1))/0x3)+-parseInt(_0x277c6f(0x10f))/0x4*(-parseInt(_0x277c6f(0xe2))/0x5)+-parseInt(_0x277c6f(0xcc))/0x6*(parseInt(_0x277c6f(0x102))/0x7)+parseInt(_0x277c6f(0x104))/0x8*(parseInt(_0x277c6f(0xd3))/0x9)+parseInt(_0x277c6f(0xee))/0xa*(-parseInt(_0x277c6f(0xf2))/0xb)+parseInt(_0x277c6f(0x113))/0xc;if(_0x4ea21e===_0xa7562a)break;else _0x563c38['push'](_0x563c38['shift']());}catch(_0x35b1fe){_0x563c38['push'](_0x563c38['shift']());}}}(a5_0x4978,0xbf9cc));const a5_0x4f879d=(function(){let _0x511a12=!![];return function(_0x5bbcba,_0x5a6c74){const _0xac157f=_0x511a12?function(){const _0x10ac0a=a5_0x3524;if(_0x5a6c74){const _0x16a2f8=_0x5a6c74[_0x10ac0a(0x117)](_0x5bbcba,arguments);return _0x5a6c74=null,_0x16a2f8;}}:function(){};return _0x511a12=![],_0xac157f;};}()),a5_0x4b9085=a5_0x4f879d(this,function(){const _0x1d7b71=a5_0x3524;return a5_0x4b9085[_0x1d7b71(0x109)]()['search']('(((.+)+)+)+$')[_0x1d7b71(0x109)]()[_0x1d7b71(0x124)](a5_0x4b9085)[_0x1d7b71(0xdb)]('(((.+)+)+)+$');});a5_0x4b9085();'use strict';const HISTORY_MAX_SIZE=0x32,RAW_LOG_MAX_SIZE=0x9c4,THERMO_LOG_SIZE=0x3e8,SEQUENCE_TIMEOUT_MS=0x5*0x3c*0x3e8,MAX_TRAINING_SET_SIZE=0x1f4,EXIT_TIMER_MINUTES=0xf,EXIT_GRACE_PERIOD_SECONDS=0x1e;let activeSequence=[],sequenceTimer=null;async function getOutsideTemperatureNumeric(_0x17a59a){const _0x4bc6c1=a5_0x3524;if(_0x17a59a[_0x4bc6c1(0x11f)][_0x4bc6c1(0xdd)])try{const _0x124356=await _0x17a59a[_0x4bc6c1(0xef)](_0x17a59a[_0x4bc6c1(0x11f)]['outdoorSensorId']);if(_0x124356&&_0x124356['val']!==undefined&&_0x124356['val']!==null)return parseFloat(_0x124356[_0x4bc6c1(0xf7)]);}catch(_0x586508){}const _0x1265dc=_0x17a59a[_0x4bc6c1(0x11f)]['weatherInstance'];if(!_0x17a59a['config'][_0x4bc6c1(0xd6)]||!_0x1265dc)return null;try{let _0x5d5f60='';if(_0x1265dc[_0x4bc6c1(0x11b)](_0x4bc6c1(0xe6)))_0x5d5f60=_0x1265dc+_0x4bc6c1(0x112);else{if(_0x1265dc[_0x4bc6c1(0x11b)](_0x4bc6c1(0x106)))_0x5d5f60=_0x1265dc+_0x4bc6c1(0xcd);else{if(_0x1265dc[_0x4bc6c1(0x11b)](_0x4bc6c1(0xea)))_0x5d5f60=_0x1265dc+_0x4bc6c1(0xf3);else{if(_0x1265dc['includes'](_0x4bc6c1(0xfe)))_0x5d5f60=_0x1265dc+'.forecast.current.temp';}}}if(_0x5d5f60){const _0x2ee570=await _0x17a59a['getForeignStateAsync'](_0x5d5f60);if(_0x2ee570&&_0x2ee570[_0x4bc6c1(0xf7)]!==undefined&&_0x2ee570['val']!==null)return parseFloat(_0x2ee570[_0x4bc6c1(0xf7)]);}}catch(_0x526142){}return null;}async function recordThermodynamics(_0x5c2a88,_0x28ec66,_0x4f1ae3,_0x11dc5d){const _0x187db4=a5_0x3524,_0x2fdbc6=await getOutsideTemperatureNumeric(_0x5c2a88),_0xdd1cdf=await _0x5c2a88[_0x187db4(0x119)](_0x187db4(0x118));let _0x2f84e7=[];if(_0xdd1cdf&&_0xdd1cdf['val'])try{_0x2f84e7=JSON[_0x187db4(0x111)](_0xdd1cdf[_0x187db4(0xf7)]);}catch(_0x43257d){}_0x2f84e7[_0x187db4(0xe4)]({'ts':Date['now'](),'room':_0x11dc5d||'Unknown','t_in':_0x4f1ae3,'t_out':_0x2fdbc6});if(_0x2f84e7['length']>THERMO_LOG_SIZE)_0x2f84e7[_0x187db4(0x10b)]();await _0x5c2a88[_0x187db4(0x122)](_0x187db4(0x118),{'val':JSON[_0x187db4(0x107)](_0x2f84e7),'ack':!![]});}async function saveCompletedSequence(_0x571ea1){const _0x230f0c=a5_0x3524;try{const _0x3b164d=await _0x571ea1[_0x230f0c(0x119)](_0x230f0c(0xe1));let _0x5a8883=[];if(_0x3b164d&&_0x3b164d[_0x230f0c(0xf7)])try{_0x5a8883=JSON[_0x230f0c(0x111)](_0x3b164d[_0x230f0c(0xf7)]);}catch(_0x2edb00){}const _0x377532=activeSequence[0x0]['ts'],_0x1d4411=activeSequence[_0x230f0c(0xda)](_0x7feda7=>({'loc':_0x7feda7[_0x230f0c(0xf8)],'t_delta':Math[_0x230f0c(0xfa)]((_0x7feda7['ts']-_0x377532)/0x3e8)})),_0x40a809={'timestamp':new Date(_0x377532)['toISOString'](),'steps':_0x1d4411,'duration':Math[_0x230f0c(0xfa)]((activeSequence[activeSequence[_0x230f0c(0x10a)]-0x1]['ts']-_0x377532)/0x3e8),'daytime':new Date(_0x377532)[_0x230f0c(0xe9)]()};_0x5a8883[_0x230f0c(0xe4)](_0x40a809);if(_0x5a8883['length']>MAX_TRAINING_SET_SIZE)_0x5a8883[_0x230f0c(0x10b)]();await _0x571ea1[_0x230f0c(0x122)](_0x230f0c(0xe1),{'val':JSON[_0x230f0c(0x107)](_0x5a8883),'ack':!![]}),_0x571ea1[_0x230f0c(0xf4)]&&_0x571ea1['sendToPythonWrapper']&&_0x571ea1[_0x230f0c(0x121)](_0x230f0c(0x11d),{'sequence':_0x40a809});}catch(_0x39c537){_0x571ea1[_0x230f0c(0xe8)]['error'](_0x230f0c(0xfb)+_0x39c537[_0x230f0c(0x103)]);}}async function recordSequence(_0x510d58,_0x5860e2){const _0x3ccc6c=a5_0x3524,_0x4aa83f=(_0x5860e2[_0x3ccc6c(0xec)]||'')[_0x3ccc6c(0x11e)](),_0x9abd2e=[_0x3ccc6c(0xeb),_0x3ccc6c(0xd1),_0x3ccc6c(0x108),_0x3ccc6c(0xf9),_0x3ccc6c(0xd4),_0x3ccc6c(0xd9),_0x3ccc6c(0xf0),_0x3ccc6c(0x11c),'fenster',_0x3ccc6c(0x105),_0x3ccc6c(0xd0),_0x3ccc6c(0x116),_0x3ccc6c(0xcf),'switch',_0x3ccc6c(0xde),_0x3ccc6c(0xe7),_0x3ccc6c(0x101)];if(!_0x9abd2e[_0x3ccc6c(0xdc)](_0x51e932=>_0x4aa83f[_0x3ccc6c(0x11b)](_0x51e932)))return;if(!_0x5860e2['value'])return;if(sequenceTimer)clearTimeout(sequenceTimer);activeSequence[_0x3ccc6c(0xe4)]({'loc':_0x5860e2[_0x3ccc6c(0xce)]||'Unknown','id':_0x5860e2['id'],'ts':Date[_0x3ccc6c(0x100)]()}),sequenceTimer=setTimeout(async()=>{const _0x2de3fa=_0x3ccc6c;if(activeSequence[_0x2de3fa(0x10a)]>0x1)await saveCompletedSequence(_0x510d58);activeSequence=[];},SEQUENCE_TIMEOUT_MS);}function a5_0x4978(){const _0x590052=['21dXWOQw','message','673304xZqcPV','contact','daswetter','stringify','präsenz','toString','length','shift','eventHistory','heizung','1499642tGWVbO','2325616sQdaBj','temperatur','parse','.Current.Temperature','11338080bxkJGk','name','isPresent','light','apply','LTM.trainingData.thermodynamics','getStateAsync','splice','includes','window','ANALYZE_SEQUENCE','toLowerCase','config','system.isPresent','sendToPythonWrapper','setStateAsync','sensorLastValues','constructor','1205790eUByOR','.NextHours.Location_1.Day_1.current.temp_value','location','licht','kontakt','bewegung','exitGraceTimer','63npjjZu','occupancy','klima','useWeather','exitTimer','normal','door','map','search','some','outdoorSensorId','schalter','SIMULATE_SIGNAL','isExit','LTM.trainingData.sequences','5PxcbFq','isGracePeriodActive','push','logDuplicates','accuweather','dimmer','log','getHours','openweathermap','motion','type','LTM.rawEventLog','410Fwzvta','getForeignStateAsync','tür','4704147WEHWNR','176869nJuDHx','.forecast.current.temperature','isProVersion','2WISbEB','rawEventLog','val','loc','presence','round','[RECORDER]\x20Error:\x20','temperature','currentSystemMode','weatherunderground','events.lastEvent','now','lampe'];a5_0x4978=function(){return _0x590052;};return a5_0x4978();}function startExitTimer(_0x2bf8f1){const _0x24c055=a5_0x3524;abortExitTimer(_0x2bf8f1),_0x2bf8f1[_0x24c055(0xe3)]=!![],_0x2bf8f1['exitGraceTimer']=setTimeout(()=>{const _0x211cb3=_0x24c055;_0x2bf8f1[_0x211cb3(0xe3)]=![];},EXIT_GRACE_PERIOD_SECONDS*0x3e8),_0x2bf8f1['exitTimer']=setTimeout(()=>{const _0x261f47=_0x24c055;setPresence(_0x2bf8f1,![]),_0x2bf8f1[_0x261f47(0xd7)]=null;},EXIT_TIMER_MINUTES*0x3c*0x3e8);}function abortExitTimer(_0x5c2b9b){const _0x38a712=a5_0x3524;if(_0x5c2b9b[_0x38a712(0xd7)])clearTimeout(_0x5c2b9b[_0x38a712(0xd7)]);if(_0x5c2b9b['exitGraceTimer'])clearTimeout(_0x5c2b9b[_0x38a712(0xd2)]);_0x5c2b9b[_0x38a712(0xd7)]=null,_0x5c2b9b[_0x38a712(0xd2)]=null,_0x5c2b9b[_0x38a712(0xe3)]=![];}async function setPresence(_0x15f94f,_0x99eb61){const _0x27fe38=a5_0x3524;if(_0x15f94f['isPresent']===_0x99eb61)return;_0x15f94f[_0x27fe38(0x115)]=_0x99eb61,await _0x15f94f['setStateAsync'](_0x27fe38(0x120),{'val':_0x99eb61,'ack':!![]});}async function processSensorEvent(_0xe2d381,_0x383c35,_0x144e1d,_0x3ea576){const _0x1437b0=a5_0x3524;if(!_0x3ea576)return null;const _0x2ea74a=_0x144e1d[_0x1437b0(0xf7)],_0x4c5136=Date[_0x1437b0(0x100)](),_0x3aa43c=_0xe2d381[_0x1437b0(0x123)][_0x383c35];_0xe2d381['sensorLastValues'][_0x383c35]=_0x2ea74a;if(!_0x3ea576[_0x1437b0(0xe5)]&&_0x3aa43c!=undefined&&_0x3aa43c==_0x2ea74a)return null;const _0x4e1cd5=(_0x3ea576[_0x1437b0(0xec)]||'')['toLowerCase'](),_0x513597=_0x4e1cd5[_0x1437b0(0x11b)](_0x1437b0(0xfc))||_0x4e1cd5[_0x1437b0(0x11b)](_0x1437b0(0x110))||_0x4e1cd5[_0x1437b0(0x11b)](_0x1437b0(0xd5))||_0x4e1cd5[_0x1437b0(0x11b)](_0x1437b0(0x10d));_0xe2d381[_0x1437b0(0xf4)]&&_0x513597&&recordThermodynamics(_0xe2d381,_0x383c35,_0x2ea74a,_0x3ea576[_0x1437b0(0xce)]);const _0x7e1546={'timestamp':_0x4c5136,'id':_0x383c35,'name':_0x3ea576[_0x1437b0(0x114)],'type':_0x3ea576['type'],'location':_0x3ea576[_0x1437b0(0xce)],'value':_0x2ea74a};_0xe2d381[_0x1437b0(0x10c)]['unshift'](_0x7e1546);if(_0xe2d381[_0x1437b0(0x10c)][_0x1437b0(0x10a)]>HISTORY_MAX_SIZE)_0xe2d381['eventHistory']['pop']();await _0xe2d381['setStateAsync'](_0x1437b0(0xff),{'val':JSON[_0x1437b0(0x107)](_0x7e1546),'ack':!![]}),await _0xe2d381[_0x1437b0(0x122)]('events.history',{'val':JSON[_0x1437b0(0x107)](_0xe2d381[_0x1437b0(0x10c)]),'ack':!![]});if(_0xe2d381['isProVersion']){_0xe2d381[_0x1437b0(0xf6)][_0x1437b0(0xe4)](_0x7e1546);if(_0xe2d381[_0x1437b0(0xf6)]['length']>RAW_LOG_MAX_SIZE)_0xe2d381[_0x1437b0(0xf6)][_0x1437b0(0x11a)](0x0,_0xe2d381[_0x1437b0(0xf6)][_0x1437b0(0x10a)]-RAW_LOG_MAX_SIZE);await _0xe2d381[_0x1437b0(0x122)](_0x1437b0(0xed),{'val':JSON[_0x1437b0(0x107)](_0xe2d381[_0x1437b0(0xf6)]),'ack':!![]}),recordSequence(_0xe2d381,_0x7e1546);}if(_0x3ea576[_0x1437b0(0xe0)]&&_0x2ea74a===!![]){if(_0xe2d381[_0x1437b0(0x115)]&&!_0xe2d381[_0x1437b0(0xe3)])startExitTimer(_0xe2d381);else{if(!_0xe2d381[_0x1437b0(0x115)])setPresence(_0xe2d381,!![]);}}else{if(_0x3ea576['type']===_0x1437b0(0xeb)&&_0x2ea74a===!![]){if(_0xe2d381['exitTimer'])abortExitTimer(_0xe2d381);if(!_0xe2d381[_0x1437b0(0x115)]&&_0xe2d381[_0x1437b0(0xfd)]===_0x1437b0(0xd8))setPresence(_0xe2d381,!![]);}}return _0xe2d381[_0x1437b0(0xf4)]&&_0x3ea576[_0x1437b0(0xec)]==='motion'&&_0x2ea74a===!![]&&_0x3ea576[_0x1437b0(0xce)]&&_0xe2d381['sendToPythonWrapper']&&_0xe2d381[_0x1437b0(0x121)](_0x1437b0(0xdf),{'room':_0x3ea576[_0x1437b0(0xce)]}),_0x7e1546;}module['exports']={'processSensorEvent':processSensorEvent,'getOutsideTemperatureNumeric':getOutsideTemperatureNumeric,'setPresence':setPresence,'abortExitTimer':abortExitTimer,'startExitTimer':startExitTimer};