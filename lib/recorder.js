const a5_0x27482e=a5_0x2bb2;(function(_0x48e4eb,_0x5327e9){const _0x4acef2=a5_0x2bb2,_0x86e420=_0x48e4eb();while(!![]){try{const _0x57b09c=parseInt(_0x4acef2(0x10a))/0x1+-parseInt(_0x4acef2(0x116))/0x2*(-parseInt(_0x4acef2(0x15a))/0x3)+parseInt(_0x4acef2(0x104))/0x4+parseInt(_0x4acef2(0x128))/0x5*(-parseInt(_0x4acef2(0x129))/0x6)+parseInt(_0x4acef2(0x154))/0x7*(parseInt(_0x4acef2(0x13a))/0x8)+parseInt(_0x4acef2(0x16d))/0x9+-parseInt(_0x4acef2(0x14d))/0xa*(parseInt(_0x4acef2(0x13b))/0xb);if(_0x57b09c===_0x5327e9)break;else _0x86e420['push'](_0x86e420['shift']());}catch(_0x16b56e){_0x86e420['push'](_0x86e420['shift']());}}}(a5_0x1474,0xdd0ae));const a5_0x33c961=(function(){let _0x16ff45=!![];return function(_0x83efa5,_0x477c31){const _0x4dbc5c=_0x16ff45?function(){const _0x374699=a5_0x2bb2;if(_0x477c31){const _0x22fa66=_0x477c31[_0x374699(0x11f)](_0x83efa5,arguments);return _0x477c31=null,_0x22fa66;}}:function(){};return _0x16ff45=![],_0x4dbc5c;};}()),a5_0x38d571=a5_0x33c961(this,function(){const _0x5d4930=a5_0x2bb2;return a5_0x38d571[_0x5d4930(0x159)]()[_0x5d4930(0x15c)](_0x5d4930(0x101))[_0x5d4930(0x159)]()[_0x5d4930(0x13f)](a5_0x38d571)[_0x5d4930(0x15c)](_0x5d4930(0x101));});a5_0x38d571();'use strict';const HISTORY_MAX_SIZE=0x32,RAW_LOG_MAX_SIZE=0x9c4,THERMO_LOG_SIZE=0x3e8,SEQUENCE_TIMEOUT_MS=0x5*0x3c*0x3e8,MAX_TRAINING_SET_SIZE=0x1f4,EXIT_TIMER_MINUTES=0xf,EXIT_GRACE_PERIOD_SECONDS=0x1e;let activeSequence=[],sequenceTimer=null;function a5_0x2bb2(_0x636320,_0x26b296){const _0x979cfe=a5_0x1474();return a5_0x2bb2=function(_0x38d571,_0x33c961){_0x38d571=_0x38d571-0x101;let _0x14749d=_0x979cfe[_0x38d571];return _0x14749d;},a5_0x2bb2(_0x636320,_0x26b296);}async function getOutsideTemperatureNumeric(_0x5e826a){const _0x43fdab=a5_0x2bb2;if(_0x5e826a[_0x43fdab(0x126)][_0x43fdab(0x108)])try{const _0x485568=await _0x5e826a['getForeignStateAsync'](_0x5e826a[_0x43fdab(0x126)]['outdoorSensorId']);if(_0x485568&&_0x485568[_0x43fdab(0x149)]!==undefined&&_0x485568[_0x43fdab(0x149)]!==null)return parseFloat(_0x485568['val']);}catch(_0x1f0527){}const _0xe0b21e=_0x5e826a['config'][_0x43fdab(0x12a)];if(!_0x5e826a['config']['useWeather']||!_0xe0b21e)return null;try{let _0xae3d93='';if(_0xe0b21e['includes']('accuweather'))_0xae3d93=_0xe0b21e+_0x43fdab(0x118);else{if(_0xe0b21e[_0x43fdab(0x114)](_0x43fdab(0x132)))_0xae3d93=_0xe0b21e+_0x43fdab(0x144);else{if(_0xe0b21e[_0x43fdab(0x114)]('openweathermap'))_0xae3d93=_0xe0b21e+'.forecast.current.temperature';else{if(_0xe0b21e[_0x43fdab(0x114)](_0x43fdab(0x110)))_0xae3d93=_0xe0b21e+_0x43fdab(0x105);}}}if(_0xae3d93){const _0x2c2df4=await _0x5e826a[_0x43fdab(0x11d)](_0xae3d93);if(_0x2c2df4&&_0x2c2df4[_0x43fdab(0x149)]!==undefined&&_0x2c2df4['val']!==null)return parseFloat(_0x2c2df4[_0x43fdab(0x149)]);}}catch(_0x5d827c){}return null;}async function recordThermodynamics(_0xa13d4,_0x58f3ea,_0x3e7ff2,_0x3c1226){const _0x314aeb=a5_0x2bb2,_0x2f60b3=await getOutsideTemperatureNumeric(_0xa13d4);if(_0x2f60b3===null)return;let _0x275498=0x0,_0x331863=![];if(_0xa13d4[_0x314aeb(0x126)][_0x314aeb(0x12f)])try{let _0x1954a0=_0xa13d4['config'][_0x314aeb(0x12f)];if(typeof _0x1954a0===_0x314aeb(0x109))_0x1954a0=JSON[_0x314aeb(0x15e)](_0x1954a0);if(_0x1954a0[_0x58f3ea]){const _0x5a6dfd=_0x1954a0[_0x58f3ea],_0x332f53=await _0xa13d4[_0x314aeb(0x11d)](_0x5a6dfd);if(_0x332f53&&_0x332f53['val']!==null&&_0x332f53[_0x314aeb(0x149)]!==undefined){let _0x2268e5=Number(_0x332f53[_0x314aeb(0x149)]);if(_0x2268e5<=1.05&&!_0x5a6dfd['includes'](_0x314aeb(0x145))&&!_0x5a6dfd[_0x314aeb(0x114)](_0x314aeb(0x102)))_0x2268e5=_0x2268e5*0x64;_0x275498=Math[_0x314aeb(0x113)](_0x2268e5),_0x331863=!![];}}}catch(_0x2ea4af){}if(!_0x331863){const _0x695f28=[{'from':_0x314aeb(0x120),'to':_0x314aeb(0x12d)},{'from':_0x314aeb(0x120),'to':_0x314aeb(0x16e)},{'from':_0x314aeb(0x12e),'to':'.4.VALVE_STATE'},{'from':_0x314aeb(0x131),'to':'.LEVEL'},{'from':_0x314aeb(0x16c),'to':_0x314aeb(0x15b)},{'from':_0x314aeb(0x136),'to':'Valve'}];for(const _0x37fc3 of _0x695f28){if(_0x58f3ea['includes'](_0x37fc3[_0x314aeb(0x10f)])){const _0x44bc71=_0x58f3ea[_0x314aeb(0x10d)](_0x37fc3[_0x314aeb(0x10f)],_0x37fc3['to']);try{const _0x1650fb=await _0xa13d4['getForeignStateAsync'](_0x44bc71);if(_0x1650fb&&_0x1650fb['val']!==null&&_0x1650fb['val']!==undefined){let _0x4c89f9=Number(_0x1650fb[_0x314aeb(0x149)]);if(typeof _0x4c89f9===_0x314aeb(0x16a)){if(_0x4c89f9<=1.05&&_0x37fc3['to']['includes'](_0x314aeb(0x155)))_0x4c89f9=_0x4c89f9*0x64;_0x275498=Math[_0x314aeb(0x113)](_0x4c89f9),_0x331863=!![];break;}}}catch(_0xd63eb0){}}}}const _0x43332f=await _0xa13d4[_0x314aeb(0x158)](_0x314aeb(0x12c));let _0x16332f=[];if(_0x43332f&&_0x43332f[_0x314aeb(0x149)])try{_0x16332f=JSON[_0x314aeb(0x15e)](_0x43332f[_0x314aeb(0x149)]);}catch(_0x196af5){}_0x16332f[_0x314aeb(0x11a)]({'ts':Date[_0x314aeb(0x151)](),'room':_0x3c1226||'Unknown','t_in':_0x3e7ff2,'t_out':_0x2f60b3,'valve':_0x275498});if(_0x16332f[_0x314aeb(0x11c)]>THERMO_LOG_SIZE)_0x16332f[_0x314aeb(0x10e)]();await _0xa13d4[_0x314aeb(0x140)](_0x314aeb(0x12c),{'val':JSON[_0x314aeb(0x167)](_0x16332f),'ack':!![]});}async function saveCompletedSequence(_0x4a7904){const _0x5398b1=a5_0x2bb2;try{const _0x55a4d5=await _0x4a7904[_0x5398b1(0x158)](_0x5398b1(0x164));let _0x50385f=[];if(_0x55a4d5&&_0x55a4d5[_0x5398b1(0x149)])try{_0x50385f=JSON[_0x5398b1(0x15e)](_0x55a4d5[_0x5398b1(0x149)]);}catch(_0x12a733){}const _0x38f005=activeSequence[0x0]['ts'],_0x3274bf=activeSequence[_0x5398b1(0x161)](_0x3a3d4a=>({'loc':_0x3a3d4a[_0x5398b1(0x122)],'t_delta':Math[_0x5398b1(0x113)]((_0x3a3d4a['ts']-_0x38f005)/0x3e8)})),_0x5171c8={'timestamp':new Date(_0x38f005)[_0x5398b1(0x15d)](),'steps':_0x3274bf,'duration':Math['round']((activeSequence[activeSequence['length']-0x1]['ts']-_0x38f005)/0x3e8),'daytime':new Date(_0x38f005)[_0x5398b1(0x10c)]()};_0x50385f['push'](_0x5171c8);if(_0x50385f[_0x5398b1(0x11c)]>MAX_TRAINING_SET_SIZE)_0x50385f[_0x5398b1(0x10e)]();await _0x4a7904[_0x5398b1(0x140)](_0x5398b1(0x164),{'val':JSON[_0x5398b1(0x167)](_0x50385f),'ack':!![]}),_0x4a7904[_0x5398b1(0x124)]&&_0x4a7904[_0x5398b1(0x135)]&&_0x4a7904['sendToPythonWrapper'](_0x5398b1(0x157),{'sequence':_0x5171c8});}catch(_0x541b14){_0x4a7904[_0x5398b1(0x153)]['error'](_0x5398b1(0x162)+_0x541b14[_0x5398b1(0x133)]);}}async function recordSequence(_0x55f5ba,_0x566d4c){const _0x27c29a=a5_0x2bb2,_0x51ffce=(_0x566d4c['type']||'')['toLowerCase'](),_0x4a0ec6=[_0x27c29a(0x127),_0x27c29a(0x103),_0x27c29a(0x165),_0x27c29a(0x143),'occupancy',_0x27c29a(0x147),_0x27c29a(0x13c),_0x27c29a(0x137),_0x27c29a(0x11e),_0x27c29a(0x10b),'kontakt',_0x27c29a(0x125),'licht',_0x27c29a(0x14b),'schalter',_0x27c29a(0x141),_0x27c29a(0x146)];if(!_0x4a0ec6[_0x27c29a(0x12b)](_0x4e3d52=>_0x51ffce['includes'](_0x4e3d52)))return;if(!_0x566d4c['value'])return;if(sequenceTimer)clearTimeout(sequenceTimer);activeSequence[_0x27c29a(0x11a)]({'loc':_0x566d4c['location']||'Unknown','id':_0x566d4c['id'],'ts':Date[_0x27c29a(0x151)]()}),sequenceTimer=setTimeout(async()=>{const _0x4caf60=_0x27c29a;if(activeSequence[_0x4caf60(0x11c)]>0x1)await saveCompletedSequence(_0x55f5ba);activeSequence=[];},SEQUENCE_TIMEOUT_MS);}function startExitTimer(_0x3b96d5){const _0x5c0b72=a5_0x2bb2;abortExitTimer(_0x3b96d5),_0x3b96d5[_0x5c0b72(0x14a)]=!![],_0x3b96d5['exitGraceTimer']=setTimeout(()=>{_0x3b96d5['isGracePeriodActive']=![];},EXIT_GRACE_PERIOD_SECONDS*0x3e8),_0x3b96d5[_0x5c0b72(0x11b)]=setTimeout(()=>{setPresence(_0x3b96d5,![]),_0x3b96d5['exitTimer']=null;},EXIT_TIMER_MINUTES*0x3c*0x3e8);}function abortExitTimer(_0x216401){const _0x40f778=a5_0x2bb2;if(_0x216401[_0x40f778(0x11b)])clearTimeout(_0x216401[_0x40f778(0x11b)]);if(_0x216401[_0x40f778(0x106)])clearTimeout(_0x216401['exitGraceTimer']);_0x216401[_0x40f778(0x11b)]=null,_0x216401[_0x40f778(0x106)]=null,_0x216401[_0x40f778(0x14a)]=![];}function a5_0x1474(){const _0x3b4d19=['search','toISOString','parse','name','currentSystemMode','map','[RECORDER]\x20Error:\x20','TRACK_EVENT','LTM.trainingData.sequences','präsenz','temperatur','stringify','handle','type','number','griff','temperature','5855994zmSUkp','.1.VALVE_STATE','sensorLastValues','(((.+)+)+)+$','STATE','bewegung','7098428PypPZS','.forecast.current.temp','exitGraceTimer','toLowerCase','outdoorSensorId','string','1623401wPNCcN','contact','getHours','replace','shift','from','weatherunderground','isExit','[RECORDER]\x20Ignored\x20implausible\x20temperature:\x20','round','includes','pop','5614JAEKIU','debug','.Current.Temperature','lastTrackerEventTime','push','exitTimer','length','getForeignStateAsync','fenster','apply','.1.ACTUAL_TEMPERATURE','klima','loc','events.lastEvent','isProVersion','light','config','motion','45xccmew','232140JbZOuW','weatherInstance','some','LTM.trainingData.thermodynamics','.1.LEVEL','.1.TEMPERATURE','valveMapping','location','.ACTUAL_TEMPERATURE','daswetter','message','normal','sendToPythonWrapper','Temperature','window','exports','isPresent','326184gunUqj','2047375ivlmQk','tür','unshift','splice','constructor','setStateAsync','dimmer','rawEventLog','presence','.NextHours.Location_1.Day_1.current.temp_value','STATUS','lampe','door','eventHistory','val','isGracePeriodActive','switch','LTM.rawEventLog','240DTxrUT','SIMULATE_SIGNAL','schloss','heizung','now','thermostat','log','35iaKpSt','LEVEL','system.isPresent','ANALYZE_SEQUENCE','getStateAsync','toString','1569ABxDvD','level'];a5_0x1474=function(){return _0x3b4d19;};return a5_0x1474();}async function setPresence(_0x3ac36f,_0x5ca0e5){const _0x24ba03=a5_0x2bb2;if(_0x3ac36f[_0x24ba03(0x139)]===_0x5ca0e5)return;_0x3ac36f[_0x24ba03(0x139)]=_0x5ca0e5,await _0x3ac36f[_0x24ba03(0x140)](_0x24ba03(0x156),{'val':_0x5ca0e5,'ack':!![]});}async function processSensorEvent(_0x357ce5,_0x1432e0,_0x5d9b54,_0x41df68){const _0x209406=a5_0x2bb2;if(!_0x41df68)return null;const _0x443b26=_0x5d9b54['val'],_0x4e15bd=Date[_0x209406(0x151)](),_0x5de584=_0x357ce5['sensorLastValues'][_0x1432e0],_0x3930cb=(_0x41df68['type']||'')[_0x209406(0x107)](),_0x2150f6=_0x3930cb[_0x209406(0x114)](_0x209406(0x16c))||_0x3930cb[_0x209406(0x114)](_0x209406(0x166))||_0x3930cb[_0x209406(0x114)](_0x209406(0x121))||_0x3930cb['includes'](_0x209406(0x150))||_0x3930cb[_0x209406(0x114)](_0x209406(0x152));if(_0x2150f6&&typeof _0x443b26===_0x209406(0x16a)){if(_0x443b26>0x50||_0x443b26<-0x32)return _0x357ce5['log'][_0x209406(0x117)](_0x209406(0x112)+_0x443b26+'\x20from\x20'+_0x1432e0),null;}_0x357ce5[_0x209406(0x16f)][_0x1432e0]=_0x443b26;if(!_0x41df68['logDuplicates']&&_0x5de584!=undefined&&_0x5de584==_0x443b26)return null;_0x357ce5[_0x209406(0x124)]&&_0x2150f6&&recordThermodynamics(_0x357ce5,_0x1432e0,_0x443b26,_0x41df68[_0x209406(0x130)]);const _0x376453={'timestamp':_0x4e15bd,'id':_0x1432e0,'name':_0x41df68[_0x209406(0x15f)],'type':_0x41df68[_0x209406(0x169)],'location':_0x41df68[_0x209406(0x130)],'value':_0x443b26};_0x357ce5['eventHistory'][_0x209406(0x13d)](_0x376453);if(_0x357ce5[_0x209406(0x148)][_0x209406(0x11c)]>HISTORY_MAX_SIZE)_0x357ce5[_0x209406(0x148)][_0x209406(0x115)]();await _0x357ce5[_0x209406(0x140)](_0x209406(0x123),{'val':JSON[_0x209406(0x167)](_0x376453),'ack':!![]}),await _0x357ce5[_0x209406(0x140)]('events.history',{'val':JSON[_0x209406(0x167)](_0x357ce5[_0x209406(0x148)]),'ack':!![]});if(_0x357ce5['isProVersion']){_0x357ce5[_0x209406(0x142)][_0x209406(0x11a)](_0x376453);if(_0x357ce5[_0x209406(0x142)]['length']>RAW_LOG_MAX_SIZE)_0x357ce5[_0x209406(0x142)][_0x209406(0x13e)](0x0,_0x357ce5[_0x209406(0x142)][_0x209406(0x11c)]-RAW_LOG_MAX_SIZE);await _0x357ce5[_0x209406(0x140)](_0x209406(0x14c),{'val':JSON['stringify'](_0x357ce5[_0x209406(0x142)]),'ack':!![]}),recordSequence(_0x357ce5,_0x376453);}if(_0x41df68[_0x209406(0x111)]&&_0x443b26===!![]){if(_0x357ce5['isPresent']&&!_0x357ce5['isGracePeriodActive'])startExitTimer(_0x357ce5);else{if(!_0x357ce5[_0x209406(0x139)])setPresence(_0x357ce5,!![]);}}else{if(_0x41df68[_0x209406(0x169)]===_0x209406(0x127)&&_0x443b26===!![]){if(_0x357ce5[_0x209406(0x11b)])abortExitTimer(_0x357ce5);if(!_0x357ce5['isPresent']&&_0x357ce5[_0x209406(0x160)]===_0x209406(0x134))setPresence(_0x357ce5,!![]);}}if(_0x357ce5[_0x209406(0x124)]&&_0x357ce5[_0x209406(0x135)]){_0x41df68[_0x209406(0x169)]===_0x209406(0x127)&&_0x443b26===!![]&&_0x41df68[_0x209406(0x130)]&&_0x357ce5['sendToPythonWrapper'](_0x209406(0x14e),{'room':_0x41df68[_0x209406(0x130)]});const _0x45a699=[_0x209406(0x147),_0x209406(0x13c),_0x209406(0x137),_0x209406(0x11e),_0x209406(0x16b),_0x209406(0x168),'lock',_0x209406(0x14f)]['some'](_0x14f2e2=>_0x3930cb[_0x209406(0x114)](_0x14f2e2)),_0x552002=[_0x209406(0x125),'licht','switch','schalter',_0x209406(0x141),'lampe'][_0x209406(0x12b)](_0x275e98=>_0x3930cb['includes'](_0x275e98)),_0x22cee6=[_0x209406(0x127),'bewegung',_0x209406(0x165),_0x209406(0x143),'occupancy'][_0x209406(0x12b)](_0x3a98f2=>_0x3930cb[_0x209406(0x114)](_0x3a98f2));if(_0x41df68[_0x209406(0x130)]&&(_0x45a699||_0x552002||_0x22cee6)){const _0x47bf90=_0x443b26===!![]||typeof _0x443b26===_0x209406(0x16a)&&_0x443b26>0x0,_0x138e8f=_0x45a699&&!_0x47bf90&&_0x5de584!==undefined&&_0x5de584!=_0x443b26;if(_0x47bf90||_0x138e8f){const _0x1bbffd=_0x357ce5['lastTrackerEventTime']||_0x4e15bd,_0xb13b9a=(_0x4e15bd-_0x1bbffd)/0x3e8;_0x357ce5[_0x209406(0x119)]=_0x4e15bd,_0x357ce5[_0x209406(0x135)](_0x209406(0x163),{'room':_0x41df68['location'],'dt':_0xb13b9a});}}}return _0x376453;}module[a5_0x27482e(0x138)]={'processSensorEvent':processSensorEvent,'getOutsideTemperatureNumeric':getOutsideTemperatureNumeric,'setPresence':setPresence,'abortExitTimer':abortExitTimer,'startExitTimer':startExitTimer};