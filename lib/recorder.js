function a5_0x5ed1(_0x4500d2,_0xb0ec4c){const _0xc045d6=a5_0x16d3();return a5_0x5ed1=function(_0x7c35da,_0x29d41a){_0x7c35da=_0x7c35da-0x13a;let _0x16d3fd=_0xc045d6[_0x7c35da];return _0x16d3fd;},a5_0x5ed1(_0x4500d2,_0xb0ec4c);}(function(_0x4de908,_0x54cbbe){const _0x3bf400=a5_0x5ed1,_0x5ac293=_0x4de908();while(!![]){try{const _0x6b408a=-parseInt(_0x3bf400(0x199))/0x1+parseInt(_0x3bf400(0x17b))/0x2*(-parseInt(_0x3bf400(0x159))/0x3)+-parseInt(_0x3bf400(0x147))/0x4*(-parseInt(_0x3bf400(0x145))/0x5)+parseInt(_0x3bf400(0x143))/0x6*(parseInt(_0x3bf400(0x13c))/0x7)+-parseInt(_0x3bf400(0x183))/0x8+parseInt(_0x3bf400(0x17a))/0x9*(-parseInt(_0x3bf400(0x15a))/0xa)+parseInt(_0x3bf400(0x185))/0xb;if(_0x6b408a===_0x54cbbe)break;else _0x5ac293['push'](_0x5ac293['shift']());}catch(_0x2ccd53){_0x5ac293['push'](_0x5ac293['shift']());}}}(a5_0x16d3,0x229f3));const a5_0x29d41a=(function(){let _0x571e70=!![];return function(_0x53b5ca,_0x313fa5){const _0x3c085b=_0x571e70?function(){const _0x5b80dc=a5_0x5ed1;if(_0x313fa5){const _0x12791b=_0x313fa5[_0x5b80dc(0x187)](_0x53b5ca,arguments);return _0x313fa5=null,_0x12791b;}}:function(){};return _0x571e70=![],_0x3c085b;};}()),a5_0x7c35da=a5_0x29d41a(this,function(){const _0x13465e=a5_0x5ed1;return a5_0x7c35da['toString']()['search'](_0x13465e(0x158))[_0x13465e(0x164)]()[_0x13465e(0x172)](a5_0x7c35da)[_0x13465e(0x18e)](_0x13465e(0x158));});a5_0x7c35da();'use strict';const HISTORY_MAX_SIZE=0x32,RAW_LOG_MAX_SIZE=0x9c4,THERMO_LOG_SIZE=0x3e8,SEQUENCE_TIMEOUT_MS=0x5*0x3c*0x3e8,MAX_TRAINING_SET_SIZE=0x1f4,EXIT_TIMER_MINUTES=0xf,EXIT_GRACE_PERIOD_SECONDS=0x1e;let activeSequence=[],sequenceTimer=null;async function getOutsideTemperatureNumeric(_0x599760){const _0xf84b0b=a5_0x5ed1;if(_0x599760[_0xf84b0b(0x178)][_0xf84b0b(0x14a)])try{const _0x3ee4dd=await _0x599760[_0xf84b0b(0x17d)](_0x599760[_0xf84b0b(0x178)][_0xf84b0b(0x14a)]);if(_0x3ee4dd&&_0x3ee4dd[_0xf84b0b(0x15e)]!==undefined&&_0x3ee4dd['val']!==null)return parseFloat(_0x3ee4dd[_0xf84b0b(0x15e)]);}catch(_0x3344c8){}const _0x1b20e9=_0x599760[_0xf84b0b(0x178)][_0xf84b0b(0x140)];if(!_0x599760[_0xf84b0b(0x178)][_0xf84b0b(0x17f)]||!_0x1b20e9)return null;try{let _0x219b53='';if(_0x1b20e9['includes'](_0xf84b0b(0x18b)))_0x219b53=_0x1b20e9+_0xf84b0b(0x189);else{if(_0x1b20e9[_0xf84b0b(0x154)](_0xf84b0b(0x144)))_0x219b53=_0x1b20e9+'.NextHours.Location_1.Day_1.current.temp_value';else{if(_0x1b20e9[_0xf84b0b(0x154)]('openweathermap'))_0x219b53=_0x1b20e9+_0xf84b0b(0x13b);else{if(_0x1b20e9[_0xf84b0b(0x154)](_0xf84b0b(0x18a)))_0x219b53=_0x1b20e9+'.forecast.current.temp';}}}if(_0x219b53){const _0x140d06=await _0x599760[_0xf84b0b(0x17d)](_0x219b53);if(_0x140d06&&_0x140d06[_0xf84b0b(0x15e)]!==undefined&&_0x140d06[_0xf84b0b(0x15e)]!==null)return parseFloat(_0x140d06['val']);}}catch(_0x479d01){}return null;}async function recordThermodynamics(_0x4a3119,_0x503d66,_0x341537,_0x243cf3){const _0x15a39f=a5_0x5ed1,_0x3c941d=await getOutsideTemperatureNumeric(_0x4a3119);if(_0x3c941d===null)return;let _0x5c3c6f=0x0,_0x1cc730=![];if(_0x4a3119[_0x15a39f(0x178)]['valveMapping'])try{let _0x569fb1=_0x4a3119[_0x15a39f(0x178)][_0x15a39f(0x163)];if(typeof _0x569fb1===_0x15a39f(0x165))_0x569fb1=JSON[_0x15a39f(0x19b)](_0x569fb1);if(_0x569fb1[_0x503d66]){const _0x18efa3=_0x569fb1[_0x503d66],_0x3692e6=await _0x4a3119[_0x15a39f(0x17d)](_0x18efa3);if(_0x3692e6&&_0x3692e6[_0x15a39f(0x15e)]!==null&&_0x3692e6[_0x15a39f(0x15e)]!==undefined){let _0x55076c=Number(_0x3692e6[_0x15a39f(0x15e)]);if(_0x55076c<=1.05&&!_0x18efa3[_0x15a39f(0x154)](_0x15a39f(0x171))&&!_0x18efa3['includes'](_0x15a39f(0x13a)))_0x55076c=_0x55076c*0x64;_0x5c3c6f=Math[_0x15a39f(0x155)](_0x55076c),_0x1cc730=!![];}}}catch(_0x48fa44){}if(!_0x1cc730){const _0x357405=[{'from':_0x15a39f(0x167),'to':_0x15a39f(0x180)},{'from':_0x15a39f(0x167),'to':'.1.VALVE_STATE'},{'from':_0x15a39f(0x16c),'to':_0x15a39f(0x197)},{'from':_0x15a39f(0x191),'to':_0x15a39f(0x16f)},{'from':'temperature','to':'level'},{'from':_0x15a39f(0x14e),'to':_0x15a39f(0x188)}];for(const _0x51b81b of _0x357405){if(_0x503d66[_0x15a39f(0x154)](_0x51b81b[_0x15a39f(0x160)])){const _0x4aa58f=_0x503d66[_0x15a39f(0x184)](_0x51b81b['from'],_0x51b81b['to']);try{const _0x444ac4=await _0x4a3119['getForeignStateAsync'](_0x4aa58f);if(_0x444ac4&&_0x444ac4[_0x15a39f(0x15e)]!==null&&_0x444ac4[_0x15a39f(0x15e)]!==undefined){let _0x32e07b=Number(_0x444ac4[_0x15a39f(0x15e)]);if(typeof _0x32e07b==='number'){if(_0x32e07b<=1.05&&_0x51b81b['to'][_0x15a39f(0x154)]('LEVEL'))_0x32e07b=_0x32e07b*0x64;_0x5c3c6f=Math[_0x15a39f(0x155)](_0x32e07b),_0x1cc730=!![];break;}}}catch(_0x5844f9){}}}}const _0x424512=await _0x4a3119[_0x15a39f(0x14c)](_0x15a39f(0x150));let _0x93268d=[];if(_0x424512&&_0x424512[_0x15a39f(0x15e)])try{_0x93268d=JSON['parse'](_0x424512['val']);}catch(_0x1eeb6a){}_0x93268d[_0x15a39f(0x190)]({'ts':Date[_0x15a39f(0x156)](),'room':_0x243cf3||_0x15a39f(0x16d),'t_in':_0x341537,'t_out':_0x3c941d,'valve':_0x5c3c6f});if(_0x93268d[_0x15a39f(0x13e)]>THERMO_LOG_SIZE)_0x93268d[_0x15a39f(0x151)]();await _0x4a3119[_0x15a39f(0x181)](_0x15a39f(0x150),{'val':JSON['stringify'](_0x93268d),'ack':!![]});}async function saveCompletedSequence(_0x4098cb){const _0x46ae80=a5_0x5ed1;try{const _0x1f6189=await _0x4098cb[_0x46ae80(0x14c)](_0x46ae80(0x196));let _0x2d7d7e=[];if(_0x1f6189&&_0x1f6189[_0x46ae80(0x15e)])try{_0x2d7d7e=JSON[_0x46ae80(0x19b)](_0x1f6189[_0x46ae80(0x15e)]);}catch(_0x3105a1){}const _0x8914aa=activeSequence[0x0]['ts'],_0x20a62f=activeSequence[_0x46ae80(0x168)](_0x526d64=>({'loc':_0x526d64[_0x46ae80(0x15d)],'t_delta':Math['round']((_0x526d64['ts']-_0x8914aa)/0x3e8)})),_0x51bc1f={'timestamp':new Date(_0x8914aa)['toISOString'](),'steps':_0x20a62f,'duration':Math[_0x46ae80(0x155)]((activeSequence[activeSequence['length']-0x1]['ts']-_0x8914aa)/0x3e8),'daytime':new Date(_0x8914aa)[_0x46ae80(0x17e)]()};_0x2d7d7e[_0x46ae80(0x190)](_0x51bc1f);if(_0x2d7d7e[_0x46ae80(0x13e)]>MAX_TRAINING_SET_SIZE)_0x2d7d7e[_0x46ae80(0x151)]();await _0x4098cb[_0x46ae80(0x181)]('LTM.trainingData.sequences',{'val':JSON[_0x46ae80(0x17c)](_0x2d7d7e),'ack':!![]}),_0x4098cb[_0x46ae80(0x157)]&&_0x4098cb[_0x46ae80(0x173)]&&_0x4098cb['sendToPythonWrapper'](_0x46ae80(0x186),{'sequence':_0x51bc1f});}catch(_0x3290cd){_0x4098cb[_0x46ae80(0x161)][_0x46ae80(0x169)](_0x46ae80(0x14f)+_0x3290cd[_0x46ae80(0x177)]);}}async function recordSequence(_0x197716,_0x50e479){const _0x27d93e=a5_0x5ed1,_0x2c6cab=(_0x50e479['type']||'')['toLowerCase'](),_0x20a3da=[_0x27d93e(0x16e),_0x27d93e(0x195),_0x27d93e(0x175),'presence','occupancy','door',_0x27d93e(0x13f),_0x27d93e(0x174),_0x27d93e(0x179),_0x27d93e(0x142),'kontakt','light',_0x27d93e(0x15f),_0x27d93e(0x193),_0x27d93e(0x13d),_0x27d93e(0x194),'lampe'];if(!_0x20a3da[_0x27d93e(0x182)](_0x3d9b9e=>_0x2c6cab[_0x27d93e(0x154)](_0x3d9b9e)))return;if(!_0x50e479[_0x27d93e(0x198)])return;if(sequenceTimer)clearTimeout(sequenceTimer);activeSequence[_0x27d93e(0x190)]({'loc':_0x50e479[_0x27d93e(0x19a)]||_0x27d93e(0x16d),'id':_0x50e479['id'],'ts':Date['now']()}),sequenceTimer=setTimeout(async()=>{const _0x548c1a=_0x27d93e;if(activeSequence[_0x548c1a(0x13e)]>0x1)await saveCompletedSequence(_0x197716);activeSequence=[];},SEQUENCE_TIMEOUT_MS);}function startExitTimer(_0x47ef8e){const _0x1d8700=a5_0x5ed1;abortExitTimer(_0x47ef8e),_0x47ef8e[_0x1d8700(0x15b)]=!![],_0x47ef8e[_0x1d8700(0x16a)]=setTimeout(()=>{_0x47ef8e['isGracePeriodActive']=![];},EXIT_GRACE_PERIOD_SECONDS*0x3e8),_0x47ef8e[_0x1d8700(0x18c)]=setTimeout(()=>{const _0x509792=_0x1d8700;setPresence(_0x47ef8e,![]),_0x47ef8e[_0x509792(0x18c)]=null;},EXIT_TIMER_MINUTES*0x3c*0x3e8);}function abortExitTimer(_0xf0acf1){const _0x2d3d41=a5_0x5ed1;if(_0xf0acf1[_0x2d3d41(0x18c)])clearTimeout(_0xf0acf1[_0x2d3d41(0x18c)]);if(_0xf0acf1['exitGraceTimer'])clearTimeout(_0xf0acf1[_0x2d3d41(0x16a)]);_0xf0acf1[_0x2d3d41(0x18c)]=null,_0xf0acf1[_0x2d3d41(0x16a)]=null,_0xf0acf1[_0x2d3d41(0x15b)]=![];}async function setPresence(_0x20b274,_0x5a8160){const _0x4087d2=a5_0x5ed1;if(_0x20b274['isPresent']===_0x5a8160)return;_0x20b274[_0x4087d2(0x18f)]=_0x5a8160,await _0x20b274['setStateAsync'](_0x4087d2(0x149),{'val':_0x5a8160,'ack':!![]});}async function processSensorEvent(_0x40eee3,_0x26563c,_0x56cfe6,_0x485e39){const _0xb38390=a5_0x5ed1;if(!_0x485e39)return null;const _0x44c9b5=_0x56cfe6[_0xb38390(0x15e)],_0x254660=Date[_0xb38390(0x156)](),_0x56d90f=_0x40eee3[_0xb38390(0x18d)][_0x26563c];_0x40eee3[_0xb38390(0x18d)][_0x26563c]=_0x44c9b5;if(!_0x485e39['logDuplicates']&&_0x56d90f!=undefined&&_0x56d90f==_0x44c9b5)return null;const _0x325103=(_0x485e39[_0xb38390(0x148)]||'')[_0xb38390(0x153)](),_0x261412=_0x325103['includes'](_0xb38390(0x152))||_0x325103[_0xb38390(0x154)](_0xb38390(0x166))||_0x325103[_0xb38390(0x154)](_0xb38390(0x15c))||_0x325103[_0xb38390(0x154)]('heizung')||_0x325103[_0xb38390(0x154)]('thermostat');_0x40eee3[_0xb38390(0x157)]&&_0x261412&&recordThermodynamics(_0x40eee3,_0x26563c,_0x44c9b5,_0x485e39[_0xb38390(0x19a)]);const _0x5b0e99={'timestamp':_0x254660,'id':_0x26563c,'name':_0x485e39['name'],'type':_0x485e39['type'],'location':_0x485e39['location'],'value':_0x44c9b5};_0x40eee3[_0xb38390(0x170)][_0xb38390(0x14b)](_0x5b0e99);if(_0x40eee3['eventHistory'][_0xb38390(0x13e)]>HISTORY_MAX_SIZE)_0x40eee3[_0xb38390(0x170)][_0xb38390(0x16b)]();await _0x40eee3[_0xb38390(0x181)]('events.lastEvent',{'val':JSON[_0xb38390(0x17c)](_0x5b0e99),'ack':!![]}),await _0x40eee3[_0xb38390(0x181)]('events.history',{'val':JSON['stringify'](_0x40eee3[_0xb38390(0x170)]),'ack':!![]});if(_0x40eee3[_0xb38390(0x157)]){_0x40eee3[_0xb38390(0x141)][_0xb38390(0x190)](_0x5b0e99);if(_0x40eee3[_0xb38390(0x141)]['length']>RAW_LOG_MAX_SIZE)_0x40eee3[_0xb38390(0x141)]['splice'](0x0,_0x40eee3[_0xb38390(0x141)][_0xb38390(0x13e)]-RAW_LOG_MAX_SIZE);await _0x40eee3['setStateAsync'](_0xb38390(0x146),{'val':JSON[_0xb38390(0x17c)](_0x40eee3[_0xb38390(0x141)]),'ack':!![]}),recordSequence(_0x40eee3,_0x5b0e99);}if(_0x485e39[_0xb38390(0x176)]&&_0x44c9b5===!![]){if(_0x40eee3[_0xb38390(0x18f)]&&!_0x40eee3[_0xb38390(0x15b)])startExitTimer(_0x40eee3);else{if(!_0x40eee3[_0xb38390(0x18f)])setPresence(_0x40eee3,!![]);}}else{if(_0x485e39['type']==='motion'&&_0x44c9b5===!![]){if(_0x40eee3[_0xb38390(0x18c)])abortExitTimer(_0x40eee3);if(!_0x40eee3['isPresent']&&_0x40eee3[_0xb38390(0x162)]===_0xb38390(0x192))setPresence(_0x40eee3,!![]);}}return _0x40eee3[_0xb38390(0x157)]&&_0x485e39[_0xb38390(0x148)]===_0xb38390(0x16e)&&_0x44c9b5===!![]&&_0x485e39[_0xb38390(0x19a)]&&_0x40eee3[_0xb38390(0x173)]&&_0x40eee3[_0xb38390(0x173)](_0xb38390(0x14d),{'room':_0x485e39[_0xb38390(0x19a)]}),_0x5b0e99;}function a5_0x16d3(){const _0x14a00c=['outdoorSensorId','unshift','getStateAsync','SIMULATE_SIGNAL','Temperature','[RECORDER]\x20Error:\x20','LTM.trainingData.thermodynamics','shift','temperature','toLowerCase','includes','round','now','isProVersion','(((.+)+)+)+$','72kqAxER','460060GhJuVM','isGracePeriodActive','klima','loc','val','licht','from','log','currentSystemMode','valveMapping','toString','string','temperatur','.1.ACTUAL_TEMPERATURE','map','error','exitGraceTimer','pop','.1.TEMPERATURE','Unknown','motion','.LEVEL','eventHistory','STATUS','constructor','sendToPythonWrapper','window','präsenz','isExit','message','config','fenster','27AIbxWP','3176xzjdTH','stringify','getForeignStateAsync','getHours','useWeather','.1.LEVEL','setStateAsync','some','625272HivuXf','replace','2980516MnSYHj','ANALYZE_SEQUENCE','apply','Valve','.Current.Temperature','weatherunderground','accuweather','exitTimer','sensorLastValues','search','isPresent','push','.ACTUAL_TEMPERATURE','normal','switch','dimmer','bewegung','LTM.trainingData.sequences','.4.VALVE_STATE','value','76284MvIfAh','location','parse','STATE','.forecast.current.temperature','217Atqhpd','schalter','length','tür','weatherInstance','rawEventLog','contact','9462zfcIna','daswetter','765UokSZL','LTM.rawEventLog','3988XwJiiB','type','system.isPresent'];a5_0x16d3=function(){return _0x14a00c;};return a5_0x16d3();}module['exports']={'processSensorEvent':processSensorEvent,'getOutsideTemperatureNumeric':getOutsideTemperatureNumeric,'setPresence':setPresence,'abortExitTimer':abortExitTimer,'startExitTimer':startExitTimer};