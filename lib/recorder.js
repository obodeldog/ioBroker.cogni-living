const a5_0x1dee2f=a5_0x342b;(function(_0x12f45a,_0x6c442a){const _0x1ba6dc=a5_0x342b,_0x283335=_0x12f45a();while(!![]){try{const _0x4f7d1e=-parseInt(_0x1ba6dc(0xf8))/0x1*(-parseInt(_0x1ba6dc(0xc2))/0x2)+parseInt(_0x1ba6dc(0xfb))/0x3+parseInt(_0x1ba6dc(0xa8))/0x4+parseInt(_0x1ba6dc(0xf9))/0x5+parseInt(_0x1ba6dc(0xc5))/0x6+-parseInt(_0x1ba6dc(0xf2))/0x7+-parseInt(_0x1ba6dc(0xfd))/0x8*(parseInt(_0x1ba6dc(0xb2))/0x9);if(_0x4f7d1e===_0x6c442a)break;else _0x283335['push'](_0x283335['shift']());}catch(_0x2df040){_0x283335['push'](_0x283335['shift']());}}}(a5_0x13af,0x71205));const a5_0x574c01=(function(){let _0x4db7f9=!![];return function(_0x2a4e96,_0x394df8){const _0x274c26=_0x4db7f9?function(){const _0x57a6ba=a5_0x342b;if(_0x394df8){const _0x18da67=_0x394df8[_0x57a6ba(0xd5)](_0x2a4e96,arguments);return _0x394df8=null,_0x18da67;}}:function(){};return _0x4db7f9=![],_0x274c26;};}()),a5_0x6a3fc4=a5_0x574c01(this,function(){const _0xf5ae1f=a5_0x342b;return a5_0x6a3fc4[_0xf5ae1f(0xe7)]()[_0xf5ae1f(0xeb)](_0xf5ae1f(0xb1))[_0xf5ae1f(0xe7)]()[_0xf5ae1f(0xff)](a5_0x6a3fc4)['search'](_0xf5ae1f(0xb1));});function a5_0x342b(_0x132152,_0x48c3eb){const _0x299398=a5_0x13af();return a5_0x342b=function(_0x6a3fc4,_0x574c01){_0x6a3fc4=_0x6a3fc4-0x92;let _0x13af10=_0x299398[_0x6a3fc4];return _0x13af10;},a5_0x342b(_0x132152,_0x48c3eb);}a5_0x6a3fc4();'use strict';const HISTORY_MAX_SIZE=0x32,RAW_LOG_MAX_SIZE=0x9c4,THERMO_LOG_SIZE=0x3e8,SEQUENCE_TIMEOUT_MS=0x5*0x3c*0x3e8,MAX_TRAINING_SET_SIZE=0x1f4,EXIT_TIMER_MINUTES=0xf,EXIT_GRACE_PERIOD_SECONDS=0x1e;let activeSequence=[],sequenceTimer=null;async function getOutsideTemperatureNumeric(_0x3fe2c5){const _0x1c43a5=a5_0x342b;if(_0x3fe2c5[_0x1c43a5(0xc7)][_0x1c43a5(0xfc)])try{const _0x234116=await _0x3fe2c5[_0x1c43a5(0xbf)](_0x3fe2c5[_0x1c43a5(0xc7)]['outdoorSensorId']);if(_0x234116&&_0x234116[_0x1c43a5(0xe1)]!==undefined&&_0x234116['val']!==null)return parseFloat(_0x234116[_0x1c43a5(0xe1)]);}catch(_0x34f3a1){}const _0x6d77e7=_0x3fe2c5[_0x1c43a5(0xc7)][_0x1c43a5(0xee)];if(!_0x3fe2c5[_0x1c43a5(0xc7)][_0x1c43a5(0x9f)]||!_0x6d77e7)return null;try{let _0x1589e1='';if(_0x6d77e7[_0x1c43a5(0x92)]('accuweather'))_0x1589e1=_0x6d77e7+_0x1c43a5(0xe3);else{if(_0x6d77e7[_0x1c43a5(0x92)]('daswetter'))_0x1589e1=_0x6d77e7+_0x1c43a5(0xac);else{if(_0x6d77e7[_0x1c43a5(0x92)](_0x1c43a5(0xcd)))_0x1589e1=_0x6d77e7+'.forecast.current.temperature';else{if(_0x6d77e7[_0x1c43a5(0x92)](_0x1c43a5(0xa5)))_0x1589e1=_0x6d77e7+_0x1c43a5(0xa6);}}}if(_0x1589e1){const _0x1774bf=await _0x3fe2c5['getForeignStateAsync'](_0x1589e1);if(_0x1774bf&&_0x1774bf[_0x1c43a5(0xe1)]!==undefined&&_0x1774bf[_0x1c43a5(0xe1)]!==null)return parseFloat(_0x1774bf[_0x1c43a5(0xe1)]);}}catch(_0x17af7c){}return null;}async function recordThermodynamics(_0x16b451,_0x84a4f5,_0x28a974,_0x3e07d5){const _0x1d1250=a5_0x342b,_0x2050d1=await getOutsideTemperatureNumeric(_0x16b451);if(_0x2050d1===null)return;let _0x1a0250=0x0,_0x229262=![];if(_0x16b451[_0x1d1250(0xc7)]['valveMapping'])try{let _0xcfe6bb=_0x16b451[_0x1d1250(0xc7)]['valveMapping'];if(typeof _0xcfe6bb===_0x1d1250(0xa4))_0xcfe6bb=JSON[_0x1d1250(0xe6)](_0xcfe6bb);if(_0xcfe6bb[_0x84a4f5]){const _0x1388b8=_0xcfe6bb[_0x84a4f5],_0x93e36e=await _0x16b451['getForeignStateAsync'](_0x1388b8);if(_0x93e36e&&_0x93e36e[_0x1d1250(0xe1)]!==null&&_0x93e36e[_0x1d1250(0xe1)]!==undefined){let _0xaf1085=Number(_0x93e36e[_0x1d1250(0xe1)]);if(_0xaf1085<=1.05&&!_0x1388b8[_0x1d1250(0x92)](_0x1d1250(0xda))&&!_0x1388b8[_0x1d1250(0x92)](_0x1d1250(0xe2)))_0xaf1085=_0xaf1085*0x64;_0x1a0250=Math['round'](_0xaf1085),_0x229262=!![];}}}catch(_0x1ff4b0){}if(!_0x229262){const _0x407659=[{'from':_0x1d1250(0xe9),'to':'.1.LEVEL'},{'from':_0x1d1250(0xe9),'to':'.1.VALVE_STATE'},{'from':_0x1d1250(0xe4),'to':_0x1d1250(0xa2)},{'from':_0x1d1250(0x99),'to':'.LEVEL'},{'from':_0x1d1250(0xf3),'to':'level'},{'from':_0x1d1250(0x100),'to':_0x1d1250(0x94)}];for(const _0xf11ba4 of _0x407659){if(_0x84a4f5[_0x1d1250(0x92)](_0xf11ba4[_0x1d1250(0xc4)])){const _0x47c9fb=_0x84a4f5[_0x1d1250(0xd8)](_0xf11ba4['from'],_0xf11ba4['to']);try{const _0x381f1b=await _0x16b451['getForeignStateAsync'](_0x47c9fb);if(_0x381f1b&&_0x381f1b[_0x1d1250(0xe1)]!==null&&_0x381f1b['val']!==undefined){let _0x2b9751=Number(_0x381f1b[_0x1d1250(0xe1)]);if(typeof _0x2b9751===_0x1d1250(0xb9)){if(_0x2b9751<=1.05&&_0xf11ba4['to'][_0x1d1250(0x92)]('LEVEL'))_0x2b9751=_0x2b9751*0x64;_0x1a0250=Math[_0x1d1250(0xec)](_0x2b9751),_0x229262=!![];break;}}}catch(_0x7efd11){}}}}const _0x340b1c=await _0x16b451['getStateAsync']('LTM.trainingData.thermodynamics');let _0x4d6fbd=[];if(_0x340b1c&&_0x340b1c[_0x1d1250(0xe1)])try{_0x4d6fbd=JSON[_0x1d1250(0xe6)](_0x340b1c[_0x1d1250(0xe1)]);}catch(_0x2041d9){}_0x4d6fbd[_0x1d1250(0xcc)]({'ts':Date['now'](),'room':_0x3e07d5||'Unknown','t_in':_0x28a974,'t_out':_0x2050d1,'valve':_0x1a0250});if(_0x4d6fbd[_0x1d1250(0xcf)]>THERMO_LOG_SIZE)_0x4d6fbd['shift']();await _0x16b451[_0x1d1250(0xea)](_0x1d1250(0x9e),{'val':JSON['stringify'](_0x4d6fbd),'ack':!![]});}async function saveCompletedSequence(_0x572993){const _0x1f1364=a5_0x342b;try{const _0x53d5a7=await _0x572993[_0x1f1364(0xb8)]('LTM.trainingData.sequences');let _0x548921=[];if(_0x53d5a7&&_0x53d5a7['val'])try{_0x548921=JSON[_0x1f1364(0xe6)](_0x53d5a7[_0x1f1364(0xe1)]);}catch(_0x2a9e44){}const _0x14b6bb=activeSequence[0x0]['ts'],_0x3c5300=activeSequence[_0x1f1364(0xc9)](_0x3fb650=>({'loc':_0x3fb650[_0x1f1364(0xdb)],'t_delta':Math[_0x1f1364(0xec)]((_0x3fb650['ts']-_0x14b6bb)/0x3e8)})),_0x7a887={'timestamp':new Date(_0x14b6bb)[_0x1f1364(0xf4)](),'steps':_0x3c5300,'duration':Math[_0x1f1364(0xec)]((activeSequence[activeSequence['length']-0x1]['ts']-_0x14b6bb)/0x3e8),'daytime':new Date(_0x14b6bb)[_0x1f1364(0x9a)]()};_0x548921[_0x1f1364(0xcc)](_0x7a887);if(_0x548921[_0x1f1364(0xcf)]>MAX_TRAINING_SET_SIZE)_0x548921[_0x1f1364(0xc6)]();await _0x572993[_0x1f1364(0xea)](_0x1f1364(0xe8),{'val':JSON[_0x1f1364(0xf0)](_0x548921),'ack':!![]}),_0x572993[_0x1f1364(0xc8)]&&_0x572993[_0x1f1364(0xc0)]&&_0x572993['sendToPythonWrapper'](_0x1f1364(0xd3),{'sequence':_0x7a887});}catch(_0xfb6a16){_0x572993[_0x1f1364(0xa7)][_0x1f1364(0xb6)](_0x1f1364(0xc1)+_0xfb6a16[_0x1f1364(0xb4)]);}}async function recordSequence(_0x4edff0,_0x432bc1){const _0x80d3b1=a5_0x342b,_0x563d60=(_0x432bc1[_0x80d3b1(0xb5)]||'')[_0x80d3b1(0xb3)](),_0x553820=[_0x80d3b1(0xd9),_0x80d3b1(0xb7),'präsenz',_0x80d3b1(0xcb),_0x80d3b1(0xd4),_0x80d3b1(0x96),_0x80d3b1(0xef),_0x80d3b1(0xdc),_0x80d3b1(0x9b),_0x80d3b1(0x97),_0x80d3b1(0xdf),'light',_0x80d3b1(0x98),_0x80d3b1(0xca),_0x80d3b1(0xaf),_0x80d3b1(0xbc),_0x80d3b1(0xfe)];if(!_0x553820[_0x80d3b1(0xa3)](_0xb139f1=>_0x563d60[_0x80d3b1(0x92)](_0xb139f1)))return;if(!_0x432bc1[_0x80d3b1(0x95)])return;if(sequenceTimer)clearTimeout(sequenceTimer);activeSequence['push']({'loc':_0x432bc1[_0x80d3b1(0xed)]||_0x80d3b1(0xd1),'id':_0x432bc1['id'],'ts':Date[_0x80d3b1(0xbe)]()}),sequenceTimer=setTimeout(async()=>{const _0x4df0f0=_0x80d3b1;if(activeSequence[_0x4df0f0(0xcf)]>0x1)await saveCompletedSequence(_0x4edff0);activeSequence=[];},SEQUENCE_TIMEOUT_MS);}function startExitTimer(_0x372f7e){const _0x5c7e1d=a5_0x342b;abortExitTimer(_0x372f7e),_0x372f7e[_0x5c7e1d(0x102)]=!![],_0x372f7e[_0x5c7e1d(0xaa)]=setTimeout(()=>{_0x372f7e['isGracePeriodActive']=![];},EXIT_GRACE_PERIOD_SECONDS*0x3e8),_0x372f7e[_0x5c7e1d(0xba)]=setTimeout(()=>{const _0x4a4241=_0x5c7e1d;setPresence(_0x372f7e,![]),_0x372f7e[_0x4a4241(0xba)]=null;},EXIT_TIMER_MINUTES*0x3c*0x3e8);}function abortExitTimer(_0x2e61f7){const _0x1521db=a5_0x342b;if(_0x2e61f7[_0x1521db(0xba)])clearTimeout(_0x2e61f7[_0x1521db(0xba)]);if(_0x2e61f7['exitGraceTimer'])clearTimeout(_0x2e61f7[_0x1521db(0xaa)]);_0x2e61f7[_0x1521db(0xba)]=null,_0x2e61f7[_0x1521db(0xaa)]=null,_0x2e61f7[_0x1521db(0x102)]=![];}function a5_0x13af(){const _0x4f343a=['exitGraceTimer','LTM.rawEventLog','.NextHours.Location_1.Day_1.current.temp_value','\x20from\x20','splice','schalter','klima','(((.+)+)+)+$','18EXMeDN','toLowerCase','message','type','error','bewegung','getStateAsync','number','exitTimer','isPresent','dimmer','name','now','getForeignStateAsync','sendToPythonWrapper','[RECORDER]\x20Error:\x20','2SRPNPF','analysis.health.todayVector','from','3692568fHIOgD','shift','config','isProVersion','map','switch','presence','push','openweathermap','sensorLastValues','length','currentSystemMode','Unknown','events.lastEvent','ANALYZE_SEQUENCE','occupancy','apply','isExit','[RECORDER]\x20Ignored\x20implausible\x20temperature:\x20','replace','motion','STATUS','loc','window','light','präsenz','kontakt','exports','val','STATE','.Current.Temperature','.1.TEMPERATURE','system.isPresent','parse','toString','LTM.trainingData.sequences','.1.ACTUAL_TEMPERATURE','setStateAsync','search','round','location','weatherInstance','tür','stringify','SIMULATE_SIGNAL','3214890utPSEw','temperature','toISOString','getDate','pop','unshift','367410CFnMKE','3785375rdjCgO','debug','617676JDxxdi','outdoorSensorId','5451272ZUiTvX','lampe','constructor','Temperature','griff','isGracePeriodActive','TRACK_EVENT','includes','eventHistory','Valve','value','door','contact','licht','.ACTUAL_TEMPERATURE','getHours','fenster','logDuplicates','lastTrackerEventTime','LTM.trainingData.thermodynamics','useWeather','rawEventLog','handle','.4.VALVE_STATE','some','string','weatherunderground','.forecast.current.temp','log','1358592fHdAzF','fill'];a5_0x13af=function(){return _0x4f343a;};return a5_0x13af();}async function setPresence(_0x1a7c15,_0x52a9b9){const _0x42ff69=a5_0x342b;if(_0x1a7c15[_0x42ff69(0xbb)]===_0x52a9b9)return;_0x1a7c15[_0x42ff69(0xbb)]=_0x52a9b9,await _0x1a7c15['setStateAsync'](_0x42ff69(0xe5),{'val':_0x52a9b9,'ack':!![]});}async function updateHourlyActivity(_0x446674){const _0x39c7be=a5_0x342b;let _0x41308a=new Array(0x18)['fill'](0x0),_0x3a9ced=0x0;try{const _0x183977=await _0x446674[_0x39c7be(0xb8)](_0x39c7be(0xc3));_0x183977&&_0x183977[_0x39c7be(0xe1)]&&(_0x41308a=JSON[_0x39c7be(0xe6)](_0x183977[_0x39c7be(0xe1)]),_0x3a9ced=_0x183977['ts']);}catch(_0x3505ca){}const _0x2bab93=new Date(_0x3a9ced),_0x5bc8c7=new Date();_0x2bab93[_0x39c7be(0xf5)]()!==_0x5bc8c7[_0x39c7be(0xf5)]()&&(_0x41308a=new Array(0x18)[_0x39c7be(0xa9)](0x0));const _0x53bc58=_0x5bc8c7[_0x39c7be(0x9a)]();if(_0x41308a[_0x53bc58]===undefined)_0x41308a[_0x53bc58]=0x0;_0x41308a[_0x53bc58]++,await _0x446674['setStateAsync'](_0x39c7be(0xc3),{'val':JSON['stringify'](_0x41308a),'ack':!![]});}async function processSensorEvent(_0x1528c4,_0x50463f,_0x2ef848,_0x4e3ae6){const _0x1bd314=a5_0x342b;if(!_0x4e3ae6)return null;const _0x1a65ec=_0x2ef848[_0x1bd314(0xe1)],_0x1bd222=Date[_0x1bd314(0xbe)](),_0x56721d=_0x1528c4[_0x1bd314(0xce)][_0x50463f],_0x467ed1=(_0x4e3ae6[_0x1bd314(0xb5)]||'')[_0x1bd314(0xb3)](),_0x4d85f0=_0x467ed1[_0x1bd314(0x92)](_0x1bd314(0xf3))||_0x467ed1[_0x1bd314(0x92)]('temperatur')||_0x467ed1[_0x1bd314(0x92)](_0x1bd314(0xb0))||_0x467ed1[_0x1bd314(0x92)]('heizung')||_0x467ed1[_0x1bd314(0x92)]('thermostat');if(_0x4d85f0&&typeof _0x1a65ec===_0x1bd314(0xb9)){if(_0x1a65ec>0x50||_0x1a65ec<-0x32)return _0x1528c4['log'][_0x1bd314(0xfa)](_0x1bd314(0xd7)+_0x1a65ec+_0x1bd314(0xad)+_0x50463f),null;}_0x1528c4[_0x1bd314(0xce)][_0x50463f]=_0x1a65ec;if(!_0x4e3ae6[_0x1bd314(0x9c)]&&_0x56721d!=undefined&&_0x56721d==_0x1a65ec)return null;_0x1528c4[_0x1bd314(0xc8)]&&_0x4d85f0&&recordThermodynamics(_0x1528c4,_0x50463f,_0x1a65ec,_0x4e3ae6[_0x1bd314(0xed)]);const _0x22f855={'timestamp':_0x1bd222,'id':_0x50463f,'name':_0x4e3ae6[_0x1bd314(0xbd)],'type':_0x4e3ae6[_0x1bd314(0xb5)],'location':_0x4e3ae6['location'],'value':_0x1a65ec};_0x1528c4[_0x1bd314(0x93)][_0x1bd314(0xf7)](_0x22f855);if(_0x1528c4[_0x1bd314(0x93)][_0x1bd314(0xcf)]>HISTORY_MAX_SIZE)_0x1528c4[_0x1bd314(0x93)][_0x1bd314(0xf6)]();await _0x1528c4[_0x1bd314(0xea)](_0x1bd314(0xd2),{'val':JSON[_0x1bd314(0xf0)](_0x22f855),'ack':!![]}),await _0x1528c4[_0x1bd314(0xea)]('events.history',{'val':JSON[_0x1bd314(0xf0)](_0x1528c4[_0x1bd314(0x93)]),'ack':!![]}),await updateHourlyActivity(_0x1528c4);if(_0x1528c4[_0x1bd314(0xc8)]){_0x1528c4[_0x1bd314(0xa0)]['push'](_0x22f855);if(_0x1528c4['rawEventLog'][_0x1bd314(0xcf)]>RAW_LOG_MAX_SIZE)_0x1528c4[_0x1bd314(0xa0)][_0x1bd314(0xae)](0x0,_0x1528c4['rawEventLog'][_0x1bd314(0xcf)]-RAW_LOG_MAX_SIZE);await _0x1528c4[_0x1bd314(0xea)](_0x1bd314(0xab),{'val':JSON[_0x1bd314(0xf0)](_0x1528c4[_0x1bd314(0xa0)]),'ack':!![]}),recordSequence(_0x1528c4,_0x22f855);}if(_0x4e3ae6[_0x1bd314(0xd6)]&&_0x1a65ec===!![]){if(_0x1528c4['isPresent']&&!_0x1528c4[_0x1bd314(0x102)])startExitTimer(_0x1528c4);else{if(!_0x1528c4[_0x1bd314(0xbb)])setPresence(_0x1528c4,!![]);}}else{if(_0x4e3ae6['type']===_0x1bd314(0xd9)&&_0x1a65ec===!![]){if(_0x1528c4[_0x1bd314(0xba)])abortExitTimer(_0x1528c4);if(!_0x1528c4['isPresent']&&_0x1528c4[_0x1bd314(0xd0)]==='normal')setPresence(_0x1528c4,!![]);}}if(_0x1528c4['isProVersion']&&_0x1528c4[_0x1bd314(0xc0)]){_0x4e3ae6[_0x1bd314(0xb5)]==='motion'&&_0x1a65ec===!![]&&_0x4e3ae6[_0x1bd314(0xed)]&&_0x1528c4[_0x1bd314(0xc0)](_0x1bd314(0xf1),{'room':_0x4e3ae6[_0x1bd314(0xed)]});const _0x383d0f=[_0x1bd314(0x96),_0x1bd314(0xef),_0x1bd314(0xdc),'fenster',_0x1bd314(0x101),_0x1bd314(0xa1),'lock','schloss'][_0x1bd314(0xa3)](_0x7a7df=>_0x467ed1[_0x1bd314(0x92)](_0x7a7df)),_0x1bd9d4=[_0x1bd314(0xdd),'licht',_0x1bd314(0xca),'schalter',_0x1bd314(0xbc),_0x1bd314(0xfe)]['some'](_0x501578=>_0x467ed1[_0x1bd314(0x92)](_0x501578)),_0x4b736=[_0x1bd314(0xd9),_0x1bd314(0xb7),_0x1bd314(0xde),_0x1bd314(0xcb),_0x1bd314(0xd4)][_0x1bd314(0xa3)](_0x60b97e=>_0x467ed1[_0x1bd314(0x92)](_0x60b97e));if(_0x4e3ae6[_0x1bd314(0xed)]&&(_0x383d0f||_0x1bd9d4||_0x4b736)){const _0x49171a=_0x1a65ec===!![]||typeof _0x1a65ec===_0x1bd314(0xb9)&&_0x1a65ec>0x0,_0xe3a22b=_0x383d0f&&!_0x49171a&&_0x56721d!==undefined&&_0x56721d!=_0x1a65ec;if(_0x49171a||_0xe3a22b){const _0x42436f=_0x1528c4['lastTrackerEventTime']||_0x1bd222,_0x2d46cb=(_0x1bd222-_0x42436f)/0x3e8;_0x1528c4[_0x1bd314(0x9d)]=_0x1bd222,_0x1528c4[_0x1bd314(0xc0)](_0x1bd314(0x103),{'room':_0x4e3ae6['location'],'dt':_0x2d46cb});}}}return _0x22f855;}module[a5_0x1dee2f(0xe0)]={'processSensorEvent':processSensorEvent,'getOutsideTemperatureNumeric':getOutsideTemperatureNumeric,'setPresence':setPresence,'abortExitTimer':abortExitTimer,'startExitTimer':startExitTimer};