const a5_0x515702=a5_0x1f81;(function(_0x1701f6,_0x23be84){const _0x43e3e3=a5_0x1f81,_0x94c442=_0x1701f6();while(!![]){try{const _0x42fd3c=-parseInt(_0x43e3e3(0x13d))/0x1*(-parseInt(_0x43e3e3(0x148))/0x2)+parseInt(_0x43e3e3(0x156))/0x3+-parseInt(_0x43e3e3(0x13c))/0x4*(-parseInt(_0x43e3e3(0x130))/0x5)+parseInt(_0x43e3e3(0x123))/0x6*(parseInt(_0x43e3e3(0x12d))/0x7)+parseInt(_0x43e3e3(0x125))/0x8*(-parseInt(_0x43e3e3(0x179))/0x9)+-parseInt(_0x43e3e3(0x124))/0xa*(-parseInt(_0x43e3e3(0x13b))/0xb)+-parseInt(_0x43e3e3(0x143))/0xc*(parseInt(_0x43e3e3(0x166))/0xd);if(_0x42fd3c===_0x23be84)break;else _0x94c442['push'](_0x94c442['shift']());}catch(_0xe6985f){_0x94c442['push'](_0x94c442['shift']());}}}(a5_0x3acd,0x92501));function a5_0x1f81(_0x78e0b2,_0x19e341){const _0x6b326c=a5_0x3acd();return a5_0x1f81=function(_0x36d869,_0x523f52){_0x36d869=_0x36d869-0x11f;let _0x3acd5a=_0x6b326c[_0x36d869];return _0x3acd5a;},a5_0x1f81(_0x78e0b2,_0x19e341);}const a5_0x523f52=(function(){let _0x4be258=!![];return function(_0x7d06e4,_0x549ff4){const _0x2c12f1=_0x4be258?function(){const _0x3c8474=a5_0x1f81;if(_0x549ff4){const _0x1450d8=_0x549ff4[_0x3c8474(0x161)](_0x7d06e4,arguments);return _0x549ff4=null,_0x1450d8;}}:function(){};return _0x4be258=![],_0x2c12f1;};}()),a5_0x36d869=a5_0x523f52(this,function(){const _0x3b526c=a5_0x1f81;return a5_0x36d869['toString']()[_0x3b526c(0x13f)](_0x3b526c(0x16e))['toString']()['constructor'](a5_0x36d869)[_0x3b526c(0x13f)](_0x3b526c(0x16e));});a5_0x36d869();'use strict';const HISTORY_MAX_SIZE=0x32,RAW_LOG_MAX_SIZE=0x9c4,THERMO_LOG_SIZE=0x3e8,SEQUENCE_TIMEOUT_MS=0x5*0x3c*0x3e8,MAX_TRAINING_SET_SIZE=0x1f4,EXIT_TIMER_MINUTES=0xf,EXIT_GRACE_PERIOD_SECONDS=0x1e;let activeSequence=[],sequenceTimer=null;async function getOutsideTemperatureNumeric(_0x2f0df2){const _0x33d42d=a5_0x1f81;if(_0x2f0df2['config'][_0x33d42d(0x151)])try{const _0x2986e2=await _0x2f0df2['getForeignStateAsync'](_0x2f0df2[_0x33d42d(0x163)][_0x33d42d(0x151)]);if(_0x2986e2&&_0x2986e2['val']!==undefined&&_0x2986e2[_0x33d42d(0x136)]!==null)return parseFloat(_0x2986e2['val']);}catch(_0x9e0e01){}const _0x26ce4f=_0x2f0df2['config'][_0x33d42d(0x126)];if(!_0x2f0df2['config'][_0x33d42d(0x11f)]||!_0x26ce4f)return null;try{let _0x45ab2a='';if(_0x26ce4f[_0x33d42d(0x144)]('accuweather'))_0x45ab2a=_0x26ce4f+_0x33d42d(0x129);else{if(_0x26ce4f[_0x33d42d(0x144)](_0x33d42d(0x158)))_0x45ab2a=_0x26ce4f+_0x33d42d(0x16d);else{if(_0x26ce4f['includes'](_0x33d42d(0x174)))_0x45ab2a=_0x26ce4f+'.forecast.current.temperature';else{if(_0x26ce4f[_0x33d42d(0x144)](_0x33d42d(0x15a)))_0x45ab2a=_0x26ce4f+_0x33d42d(0x120);}}}if(_0x45ab2a){const _0x41a87f=await _0x2f0df2[_0x33d42d(0x160)](_0x45ab2a);if(_0x41a87f&&_0x41a87f[_0x33d42d(0x136)]!==undefined&&_0x41a87f[_0x33d42d(0x136)]!==null)return parseFloat(_0x41a87f[_0x33d42d(0x136)]);}}catch(_0x30699e){}return null;}async function recordThermodynamics(_0x284094,_0x5715a1,_0x956665,_0x16d1af){const _0x3c9035=a5_0x1f81,_0x38be52=await getOutsideTemperatureNumeric(_0x284094);if(_0x38be52===null)return;let _0xb15994=0x0,_0x2288e4=![];if(_0x284094['config'][_0x3c9035(0x13a)])try{let _0x29fabd=_0x284094[_0x3c9035(0x163)]['valveMapping'];if(typeof _0x29fabd===_0x3c9035(0x170))_0x29fabd=JSON['parse'](_0x29fabd);if(_0x29fabd[_0x5715a1]){const _0x33b326=_0x29fabd[_0x5715a1],_0x2ea47a=await _0x284094['getForeignStateAsync'](_0x33b326);if(_0x2ea47a&&_0x2ea47a[_0x3c9035(0x136)]!==null&&_0x2ea47a[_0x3c9035(0x136)]!==undefined){let _0x155ec9=Number(_0x2ea47a['val']);if(_0x155ec9<=1.05&&!_0x33b326[_0x3c9035(0x144)](_0x3c9035(0x138))&&!_0x33b326[_0x3c9035(0x144)](_0x3c9035(0x133)))_0x155ec9=_0x155ec9*0x64;_0xb15994=Math['round'](_0x155ec9),_0x2288e4=!![];}}}catch(_0x2a18c4){}if(!_0x2288e4){const _0x146b89=[{'from':_0x3c9035(0x135),'to':'.1.LEVEL'},{'from':_0x3c9035(0x135),'to':'.1.VALVE_STATE'},{'from':'.1.TEMPERATURE','to':_0x3c9035(0x167)},{'from':'.ACTUAL_TEMPERATURE','to':_0x3c9035(0x152)},{'from':_0x3c9035(0x162),'to':'level'},{'from':_0x3c9035(0x172),'to':_0x3c9035(0x147)}];for(const _0xaec858 of _0x146b89){if(_0x5715a1['includes'](_0xaec858['from'])){const _0xe6ba32=_0x5715a1['replace'](_0xaec858['from'],_0xaec858['to']);try{const _0x593810=await _0x284094[_0x3c9035(0x160)](_0xe6ba32);if(_0x593810&&_0x593810[_0x3c9035(0x136)]!==null&&_0x593810['val']!==undefined){let _0x5aeaa=Number(_0x593810[_0x3c9035(0x136)]);if(typeof _0x5aeaa===_0x3c9035(0x171)){if(_0x5aeaa<=1.05&&_0xaec858['to']['includes']('LEVEL'))_0x5aeaa=_0x5aeaa*0x64;_0xb15994=Math['round'](_0x5aeaa),_0x2288e4=!![];break;}}}catch(_0x1eec50){}}}}const _0x3c9b15=await _0x284094[_0x3c9035(0x157)]('LTM.trainingData.thermodynamics');let _0x496c16=[];if(_0x3c9b15&&_0x3c9b15[_0x3c9035(0x136)])try{_0x496c16=JSON[_0x3c9035(0x14c)](_0x3c9b15[_0x3c9035(0x136)]);}catch(_0x4236dd){}_0x496c16[_0x3c9035(0x12a)]({'ts':Date[_0x3c9035(0x14a)](),'room':_0x16d1af||_0x3c9035(0x134),'t_in':_0x956665,'t_out':_0x38be52,'valve':_0xb15994});if(_0x496c16['length']>THERMO_LOG_SIZE)_0x496c16[_0x3c9035(0x150)]();await _0x284094[_0x3c9035(0x137)](_0x3c9035(0x175),{'val':JSON[_0x3c9035(0x122)](_0x496c16),'ack':!![]});}async function saveCompletedSequence(_0x3f0374){const _0x14130a=a5_0x1f81;try{const _0x494439=await _0x3f0374[_0x14130a(0x157)](_0x14130a(0x16b));let _0x3371ab=[];if(_0x494439&&_0x494439[_0x14130a(0x136)])try{_0x3371ab=JSON['parse'](_0x494439['val']);}catch(_0x3993f6){}const _0x6b160f=activeSequence[0x0]['ts'],_0x5725b2=activeSequence['map'](_0xe8cc44=>({'loc':_0xe8cc44[_0x14130a(0x16f)],'t_delta':Math[_0x14130a(0x146)]((_0xe8cc44['ts']-_0x6b160f)/0x3e8)})),_0x26b713={'timestamp':new Date(_0x6b160f)[_0x14130a(0x139)](),'steps':_0x5725b2,'duration':Math[_0x14130a(0x146)]((activeSequence[activeSequence[_0x14130a(0x159)]-0x1]['ts']-_0x6b160f)/0x3e8),'daytime':new Date(_0x6b160f)[_0x14130a(0x154)]()};_0x3371ab[_0x14130a(0x12a)](_0x26b713);if(_0x3371ab['length']>MAX_TRAINING_SET_SIZE)_0x3371ab[_0x14130a(0x150)]();await _0x3f0374[_0x14130a(0x137)]('LTM.trainingData.sequences',{'val':JSON[_0x14130a(0x122)](_0x3371ab),'ack':!![]}),_0x3f0374[_0x14130a(0x178)]&&_0x3f0374[_0x14130a(0x13e)]&&_0x3f0374['sendToPythonWrapper'](_0x14130a(0x164),{'sequence':_0x26b713});}catch(_0x54ed98){_0x3f0374[_0x14130a(0x14b)]['error'](_0x14130a(0x12f)+_0x54ed98[_0x14130a(0x155)]);}}async function recordSequence(_0x1305f2,_0x58bd6d){const _0x1020f4=a5_0x1f81,_0x3afde4=(_0x58bd6d[_0x1020f4(0x140)]||'')[_0x1020f4(0x12c)](),_0x29a1fd=[_0x1020f4(0x16a),_0x1020f4(0x149),'präsenz',_0x1020f4(0x141),_0x1020f4(0x14d),_0x1020f4(0x15e),_0x1020f4(0x14e),_0x1020f4(0x153),_0x1020f4(0x142),_0x1020f4(0x121),'kontakt','light','licht',_0x1020f4(0x131),'schalter','dimmer',_0x1020f4(0x16c)];if(!_0x29a1fd[_0x1020f4(0x145)](_0x4eaed1=>_0x3afde4['includes'](_0x4eaed1)))return;if(!_0x58bd6d['value'])return;if(sequenceTimer)clearTimeout(sequenceTimer);activeSequence[_0x1020f4(0x12a)]({'loc':_0x58bd6d[_0x1020f4(0x17a)]||_0x1020f4(0x134),'id':_0x58bd6d['id'],'ts':Date['now']()}),sequenceTimer=setTimeout(async()=>{const _0x1649f0=_0x1020f4;if(activeSequence[_0x1649f0(0x159)]>0x1)await saveCompletedSequence(_0x1305f2);activeSequence=[];},SEQUENCE_TIMEOUT_MS);}function startExitTimer(_0x405647){const _0x1714c9=a5_0x1f81;abortExitTimer(_0x405647),_0x405647[_0x1714c9(0x132)]=!![],_0x405647['exitGraceTimer']=setTimeout(()=>{const _0x16dda3=_0x1714c9;_0x405647[_0x16dda3(0x132)]=![];},EXIT_GRACE_PERIOD_SECONDS*0x3e8),_0x405647[_0x1714c9(0x12b)]=setTimeout(()=>{setPresence(_0x405647,![]),_0x405647['exitTimer']=null;},EXIT_TIMER_MINUTES*0x3c*0x3e8);}function a5_0x3acd(){const _0x23c2eb=['isProVersion','1078263YwOxVv','location','useWeather','.forecast.current.temp','contact','stringify','12588whsvUM','123280zvlbZT','8VNkqeV','weatherInstance','thermostat','events.history','.Current.Temperature','push','exitTimer','toLowerCase','1834gBTGrw','SIMULATE_SIGNAL','[RECORDER]\x20Error:\x20','5LInHsF','switch','isGracePeriodActive','STATE','Unknown','.1.ACTUAL_TEMPERATURE','val','setStateAsync','STATUS','toISOString','valveMapping','341VbiAbT','1896236Qcrhke','19YRFvlI','sendToPythonWrapper','search','type','presence','fenster','3329988GcHfzF','includes','some','round','Valve','53784oOgITP','bewegung','now','log','parse','occupancy','tür','klima','shift','outdoorSensorId','.LEVEL','window','getHours','message','2234238BOfLIT','getStateAsync','daswetter','length','weatherunderground','isPresent','exports','exitGraceTimer','door','sensorLastValues','getForeignStateAsync','apply','temperature','config','ANALYZE_SEQUENCE','unshift','91kJPZqk','.4.VALVE_STATE','rawEventLog','isExit','motion','LTM.trainingData.sequences','lampe','.NextHours.Location_1.Day_1.current.temp_value','(((.+)+)+)+$','loc','string','number','Temperature','currentSystemMode','openweathermap','LTM.trainingData.thermodynamics','LTM.rawEventLog','eventHistory'];a5_0x3acd=function(){return _0x23c2eb;};return a5_0x3acd();}function abortExitTimer(_0x11572a){const _0x59a077=a5_0x1f81;if(_0x11572a[_0x59a077(0x12b)])clearTimeout(_0x11572a[_0x59a077(0x12b)]);if(_0x11572a[_0x59a077(0x15d)])clearTimeout(_0x11572a[_0x59a077(0x15d)]);_0x11572a['exitTimer']=null,_0x11572a['exitGraceTimer']=null,_0x11572a[_0x59a077(0x132)]=![];}async function setPresence(_0x307c33,_0x3e87f5){const _0x173561=a5_0x1f81;if(_0x307c33[_0x173561(0x15b)]===_0x3e87f5)return;_0x307c33[_0x173561(0x15b)]=_0x3e87f5,await _0x307c33[_0x173561(0x137)]('system.isPresent',{'val':_0x3e87f5,'ack':!![]});}async function processSensorEvent(_0x4b1bf4,_0x1a2e92,_0x27a8c9,_0x2d64c3){const _0x1fd085=a5_0x1f81;if(!_0x2d64c3)return null;const _0x55eb32=_0x27a8c9[_0x1fd085(0x136)],_0x363a4a=Date[_0x1fd085(0x14a)](),_0x16bb6c=_0x4b1bf4[_0x1fd085(0x15f)][_0x1a2e92];_0x4b1bf4[_0x1fd085(0x15f)][_0x1a2e92]=_0x55eb32;if(!_0x2d64c3['logDuplicates']&&_0x16bb6c!=undefined&&_0x16bb6c==_0x55eb32)return null;const _0x1c85f8=(_0x2d64c3[_0x1fd085(0x140)]||'')[_0x1fd085(0x12c)](),_0x5e5ce8=_0x1c85f8[_0x1fd085(0x144)](_0x1fd085(0x162))||_0x1c85f8[_0x1fd085(0x144)]('temperatur')||_0x1c85f8[_0x1fd085(0x144)](_0x1fd085(0x14f))||_0x1c85f8[_0x1fd085(0x144)]('heizung')||_0x1c85f8[_0x1fd085(0x144)](_0x1fd085(0x127));_0x4b1bf4[_0x1fd085(0x178)]&&_0x5e5ce8&&recordThermodynamics(_0x4b1bf4,_0x1a2e92,_0x55eb32,_0x2d64c3[_0x1fd085(0x17a)]);const _0x1928c1={'timestamp':_0x363a4a,'id':_0x1a2e92,'name':_0x2d64c3['name'],'type':_0x2d64c3['type'],'location':_0x2d64c3[_0x1fd085(0x17a)],'value':_0x55eb32};_0x4b1bf4['eventHistory'][_0x1fd085(0x165)](_0x1928c1);if(_0x4b1bf4[_0x1fd085(0x177)][_0x1fd085(0x159)]>HISTORY_MAX_SIZE)_0x4b1bf4[_0x1fd085(0x177)]['pop']();await _0x4b1bf4[_0x1fd085(0x137)]('events.lastEvent',{'val':JSON['stringify'](_0x1928c1),'ack':!![]}),await _0x4b1bf4[_0x1fd085(0x137)](_0x1fd085(0x128),{'val':JSON[_0x1fd085(0x122)](_0x4b1bf4['eventHistory']),'ack':!![]});if(_0x4b1bf4[_0x1fd085(0x178)]){_0x4b1bf4['rawEventLog'][_0x1fd085(0x12a)](_0x1928c1);if(_0x4b1bf4[_0x1fd085(0x168)][_0x1fd085(0x159)]>RAW_LOG_MAX_SIZE)_0x4b1bf4[_0x1fd085(0x168)]['splice'](0x0,_0x4b1bf4[_0x1fd085(0x168)][_0x1fd085(0x159)]-RAW_LOG_MAX_SIZE);await _0x4b1bf4['setStateAsync'](_0x1fd085(0x176),{'val':JSON[_0x1fd085(0x122)](_0x4b1bf4[_0x1fd085(0x168)]),'ack':!![]}),recordSequence(_0x4b1bf4,_0x1928c1);}if(_0x2d64c3[_0x1fd085(0x169)]&&_0x55eb32===!![]){if(_0x4b1bf4[_0x1fd085(0x15b)]&&!_0x4b1bf4['isGracePeriodActive'])startExitTimer(_0x4b1bf4);else{if(!_0x4b1bf4[_0x1fd085(0x15b)])setPresence(_0x4b1bf4,!![]);}}else{if(_0x2d64c3[_0x1fd085(0x140)]===_0x1fd085(0x16a)&&_0x55eb32===!![]){if(_0x4b1bf4[_0x1fd085(0x12b)])abortExitTimer(_0x4b1bf4);if(!_0x4b1bf4[_0x1fd085(0x15b)]&&_0x4b1bf4[_0x1fd085(0x173)]==='normal')setPresence(_0x4b1bf4,!![]);}}return _0x4b1bf4[_0x1fd085(0x178)]&&_0x2d64c3[_0x1fd085(0x140)]===_0x1fd085(0x16a)&&_0x55eb32===!![]&&_0x2d64c3[_0x1fd085(0x17a)]&&_0x4b1bf4[_0x1fd085(0x13e)]&&_0x4b1bf4[_0x1fd085(0x13e)](_0x1fd085(0x12e),{'room':_0x2d64c3['location']}),_0x1928c1;}module[a5_0x515702(0x15c)]={'processSensorEvent':processSensorEvent,'getOutsideTemperatureNumeric':getOutsideTemperatureNumeric,'setPresence':setPresence,'abortExitTimer':abortExitTimer,'startExitTimer':startExitTimer};