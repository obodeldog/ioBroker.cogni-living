(function(_0x41e5a4,_0x18b15f){const _0x407afc=a5_0x33e0,_0x101665=_0x41e5a4();while(!![]){try{const _0x592b8d=parseInt(_0x407afc(0x12b))/0x1*(-parseInt(_0x407afc(0x12e))/0x2)+-parseInt(_0x407afc(0x16a))/0x3*(-parseInt(_0x407afc(0x13a))/0x4)+parseInt(_0x407afc(0x179))/0x5+-parseInt(_0x407afc(0x168))/0x6*(parseInt(_0x407afc(0x162))/0x7)+parseInt(_0x407afc(0x152))/0x8*(parseInt(_0x407afc(0x167))/0x9)+parseInt(_0x407afc(0x186))/0xa+-parseInt(_0x407afc(0x14e))/0xb;if(_0x592b8d===_0x18b15f)break;else _0x101665['push'](_0x101665['shift']());}catch(_0xef1243){_0x101665['push'](_0x101665['shift']());}}}(a5_0x4e22,0x3d319));const a5_0x4530ba=(function(){let _0x38e99e=!![];return function(_0x562047,_0x39cc8e){const _0x193886=_0x38e99e?function(){const _0x1f0596=a5_0x33e0;if(_0x39cc8e){const _0x368184=_0x39cc8e[_0x1f0596(0x15a)](_0x562047,arguments);return _0x39cc8e=null,_0x368184;}}:function(){};return _0x38e99e=![],_0x193886;};}()),a5_0x461fd6=a5_0x4530ba(this,function(){const _0x1b0b13=a5_0x33e0;return a5_0x461fd6[_0x1b0b13(0x17b)]()['search'](_0x1b0b13(0x173))[_0x1b0b13(0x17b)]()[_0x1b0b13(0x15c)](a5_0x461fd6)[_0x1b0b13(0x12d)]('(((.+)+)+)+$');});a5_0x461fd6();'use strict';const HISTORY_MAX_SIZE=0x32,RAW_LOG_MAX_SIZE=0x9c4,THERMO_LOG_SIZE=0x3e8,SEQUENCE_TIMEOUT_MS=0x5*0x3c*0x3e8,MAX_TRAINING_SET_SIZE=0x1f4,EXIT_TIMER_MINUTES=0xf,EXIT_GRACE_PERIOD_SECONDS=0x1e;let activeSequence=[],sequenceTimer=null;async function getOutsideTemperatureNumeric(_0x312843){const _0x25625f=a5_0x33e0;if(_0x312843['config']['outdoorSensorId'])try{const _0x27a2ed=await _0x312843[_0x25625f(0x153)](_0x312843[_0x25625f(0x191)][_0x25625f(0x150)]);if(_0x27a2ed&&_0x27a2ed[_0x25625f(0x139)]!==undefined&&_0x27a2ed['val']!==null)return parseFloat(_0x27a2ed[_0x25625f(0x139)]);}catch(_0x18390b){}const _0x1a4f89=_0x312843[_0x25625f(0x191)]['weatherInstance'];if(!_0x312843['config'][_0x25625f(0x15e)]||!_0x1a4f89)return null;try{let _0x41980f='';if(_0x1a4f89[_0x25625f(0x15f)](_0x25625f(0x14d)))_0x41980f=_0x1a4f89+_0x25625f(0x16c);else{if(_0x1a4f89['includes'](_0x25625f(0x17a)))_0x41980f=_0x1a4f89+_0x25625f(0x135);else{if(_0x1a4f89[_0x25625f(0x15f)]('openweathermap'))_0x41980f=_0x1a4f89+_0x25625f(0x146);else{if(_0x1a4f89[_0x25625f(0x15f)](_0x25625f(0x157)))_0x41980f=_0x1a4f89+_0x25625f(0x172);}}}if(_0x41980f){const _0x2d5785=await _0x312843['getForeignStateAsync'](_0x41980f);if(_0x2d5785&&_0x2d5785['val']!==undefined&&_0x2d5785[_0x25625f(0x139)]!==null)return parseFloat(_0x2d5785[_0x25625f(0x139)]);}}catch(_0x27e5d7){}return null;}async function recordThermodynamics(_0x19467d,_0x58029c,_0x21db06,_0x5bb01f){const _0x2c209d=a5_0x33e0,_0x1e2b17=await getOutsideTemperatureNumeric(_0x19467d);if(_0x1e2b17===null)return;let _0x3fd74e=0x0,_0x4ea5a1=![];if(_0x19467d[_0x2c209d(0x191)][_0x2c209d(0x148)])try{let _0x46b8d1=_0x19467d[_0x2c209d(0x191)][_0x2c209d(0x148)];if(typeof _0x46b8d1===_0x2c209d(0x159))_0x46b8d1=JSON[_0x2c209d(0x184)](_0x46b8d1);if(_0x46b8d1[_0x58029c]){const _0x9420af=_0x46b8d1[_0x58029c],_0x41d336=await _0x19467d[_0x2c209d(0x153)](_0x9420af);if(_0x41d336&&_0x41d336[_0x2c209d(0x139)]!==null&&_0x41d336['val']!==undefined){let _0x268d77=Number(_0x41d336[_0x2c209d(0x139)]);if(_0x268d77<=1.05&&!_0x9420af[_0x2c209d(0x15f)](_0x2c209d(0x13b))&&!_0x9420af['includes'](_0x2c209d(0x12c)))_0x268d77=_0x268d77*0x64;_0x3fd74e=Math[_0x2c209d(0x193)](_0x268d77),_0x4ea5a1=!![];}}}catch(_0x164f2b){}if(!_0x4ea5a1){const _0x2e9744=[{'from':'.1.ACTUAL_TEMPERATURE','to':_0x2c209d(0x141)},{'from':_0x2c209d(0x128),'to':_0x2c209d(0x180)},{'from':'.1.TEMPERATURE','to':_0x2c209d(0x13e)},{'from':_0x2c209d(0x151),'to':_0x2c209d(0x19b)},{'from':_0x2c209d(0x138),'to':_0x2c209d(0x185)},{'from':_0x2c209d(0x147),'to':_0x2c209d(0x13d)}];for(const _0x14c62c of _0x2e9744){if(_0x58029c[_0x2c209d(0x15f)](_0x14c62c[_0x2c209d(0x155)])){const _0x5069fd=_0x58029c['replace'](_0x14c62c[_0x2c209d(0x155)],_0x14c62c['to']);try{const _0x46c1da=await _0x19467d[_0x2c209d(0x153)](_0x5069fd);if(_0x46c1da&&_0x46c1da['val']!==null&&_0x46c1da[_0x2c209d(0x139)]!==undefined){let _0x1d8a20=Number(_0x46c1da[_0x2c209d(0x139)]);if(typeof _0x1d8a20==='number'){if(_0x1d8a20<=1.05&&_0x14c62c['to']['includes'](_0x2c209d(0x18a)))_0x1d8a20=_0x1d8a20*0x64;_0x3fd74e=Math[_0x2c209d(0x193)](_0x1d8a20),_0x4ea5a1=!![];break;}}}catch(_0x5558e1){}}}}const _0x56a906=await _0x19467d[_0x2c209d(0x170)](_0x2c209d(0x14b));let _0x2110b2=[];if(_0x56a906&&_0x56a906[_0x2c209d(0x139)])try{_0x2110b2=JSON[_0x2c209d(0x184)](_0x56a906['val']);}catch(_0x5394fc){}_0x2110b2['push']({'ts':Date[_0x2c209d(0x188)](),'room':_0x5bb01f||_0x2c209d(0x160),'t_in':_0x21db06,'t_out':_0x1e2b17,'valve':_0x3fd74e});if(_0x2110b2['length']>THERMO_LOG_SIZE)_0x2110b2[_0x2c209d(0x183)]();await _0x19467d[_0x2c209d(0x195)]('LTM.trainingData.thermodynamics',{'val':JSON[_0x2c209d(0x174)](_0x2110b2),'ack':!![]});}async function saveCompletedSequence(_0x478bfb){const _0x522761=a5_0x33e0;try{const _0x137608=await _0x478bfb['getStateAsync'](_0x522761(0x182));let _0x1ac6e1=[];if(_0x137608&&_0x137608[_0x522761(0x139)])try{_0x1ac6e1=JSON[_0x522761(0x184)](_0x137608[_0x522761(0x139)]);}catch(_0x1b6d91){}const _0x31940c=activeSequence[0x0]['ts'],_0x5918e6=activeSequence['map'](_0x41af65=>({'loc':_0x41af65['loc'],'t_delta':Math[_0x522761(0x193)]((_0x41af65['ts']-_0x31940c)/0x3e8)})),_0x26267d={'timestamp':new Date(_0x31940c)['toISOString'](),'steps':_0x5918e6,'duration':Math[_0x522761(0x193)]((activeSequence[activeSequence[_0x522761(0x18e)]-0x1]['ts']-_0x31940c)/0x3e8),'daytime':new Date(_0x31940c)[_0x522761(0x12a)]()};_0x1ac6e1['push'](_0x26267d);if(_0x1ac6e1['length']>MAX_TRAINING_SET_SIZE)_0x1ac6e1[_0x522761(0x183)]();await _0x478bfb[_0x522761(0x195)]('LTM.trainingData.sequences',{'val':JSON[_0x522761(0x174)](_0x1ac6e1),'ack':!![]}),_0x478bfb['isProVersion']&&_0x478bfb[_0x522761(0x142)]&&_0x478bfb['sendToPythonWrapper'](_0x522761(0x16b),{'sequence':_0x26267d});}catch(_0x2b436e){_0x478bfb['log'][_0x522761(0x199)](_0x522761(0x143)+_0x2b436e[_0x522761(0x14a)]);}}async function recordSequence(_0x25e99e,_0x1db797){const _0x5862f3=a5_0x33e0,_0x456cab=(_0x1db797['type']||'')[_0x5862f3(0x14f)](),_0xf25168=[_0x5862f3(0x130),'bewegung','präsenz',_0x5862f3(0x145),'occupancy',_0x5862f3(0x171),_0x5862f3(0x197),_0x5862f3(0x19a),_0x5862f3(0x165),'contact',_0x5862f3(0x16e),_0x5862f3(0x15d),_0x5862f3(0x144),_0x5862f3(0x18c),_0x5862f3(0x164),'dimmer',_0x5862f3(0x134)];if(!_0xf25168[_0x5862f3(0x13c)](_0x137497=>_0x456cab[_0x5862f3(0x15f)](_0x137497)))return;if(!_0x1db797[_0x5862f3(0x16f)])return;if(sequenceTimer)clearTimeout(sequenceTimer);activeSequence[_0x5862f3(0x192)]({'loc':_0x1db797['location']||_0x5862f3(0x160),'id':_0x1db797['id'],'ts':Date[_0x5862f3(0x188)]()}),sequenceTimer=setTimeout(async()=>{const _0x380bd1=_0x5862f3;if(activeSequence[_0x380bd1(0x18e)]>0x1)await saveCompletedSequence(_0x25e99e);activeSequence=[];},SEQUENCE_TIMEOUT_MS);}function startExitTimer(_0x594296){const _0x172b33=a5_0x33e0;abortExitTimer(_0x594296),_0x594296[_0x172b33(0x18d)]=!![],_0x594296['exitGraceTimer']=setTimeout(()=>{const _0x597a97=_0x172b33;_0x594296[_0x597a97(0x18d)]=![];},EXIT_GRACE_PERIOD_SECONDS*0x3e8),_0x594296[_0x172b33(0x169)]=setTimeout(()=>{setPresence(_0x594296,![]),_0x594296['exitTimer']=null;},EXIT_TIMER_MINUTES*0x3c*0x3e8);}function abortExitTimer(_0x4f847c){const _0x1596b2=a5_0x33e0;if(_0x4f847c[_0x1596b2(0x169)])clearTimeout(_0x4f847c[_0x1596b2(0x169)]);if(_0x4f847c['exitGraceTimer'])clearTimeout(_0x4f847c['exitGraceTimer']);_0x4f847c[_0x1596b2(0x169)]=null,_0x4f847c[_0x1596b2(0x175)]=null,_0x4f847c[_0x1596b2(0x18d)]=![];}async function setPresence(_0xa90c4b,_0x305c6e){const _0x16e4fc=a5_0x33e0;if(_0xa90c4b['isPresent']===_0x305c6e)return;_0xa90c4b[_0x16e4fc(0x15b)]=_0x305c6e,await _0xa90c4b[_0x16e4fc(0x195)](_0x16e4fc(0x140),{'val':_0x305c6e,'ack':!![]});}function isRelevantActivity(_0x19c7e5,_0x3ac226){const _0x93e057=a5_0x33e0;if(!_0x19c7e5)return![];const _0x23f442=_0x19c7e5[_0x93e057(0x14f)](),_0x2cc30f=_0x3ac226===!![]||_0x3ac226===0x1||_0x3ac226==='on'||_0x3ac226===_0x93e057(0x196);if(!_0x2cc30f)return![];const _0x4a6739=[_0x93e057(0x130),_0x93e057(0x189),'präsenz',_0x93e057(0x145),_0x93e057(0x131)]['some'](_0x683ebc=>_0x23f442[_0x93e057(0x15f)](_0x683ebc)),_0x205853=[_0x93e057(0x171),_0x93e057(0x197),_0x93e057(0x19a),_0x93e057(0x165),_0x93e057(0x17c),'handle',_0x93e057(0x18f),'schloss',_0x93e057(0x177),_0x93e057(0x16e)][_0x93e057(0x13c)](_0x1cd105=>_0x23f442['includes'](_0x1cd105)),_0x35c628=[_0x93e057(0x15d),_0x93e057(0x144),_0x93e057(0x18c),'schalter',_0x93e057(0x13f),_0x93e057(0x134)][_0x93e057(0x13c)](_0x3a9320=>_0x23f442['includes'](_0x3a9320));return _0x4a6739||_0x205853||_0x35c628;}async function updateHourlyActivity(_0x100ee7,_0x50066e){const _0x340689=a5_0x33e0;if(!isRelevantActivity(_0x50066e[_0x340689(0x154)],_0x50066e[_0x340689(0x16f)]))return;let _0x381f8a=new Array(0x18)['fill'](0x0),_0x5a2305=0x0;try{const _0x4f049b=await _0x100ee7['getStateAsync'](_0x340689(0x190));_0x4f049b&&_0x4f049b['val']&&(_0x381f8a=JSON[_0x340689(0x184)](_0x4f049b[_0x340689(0x139)]),_0x5a2305=_0x4f049b['ts']);}catch(_0x48d440){}const _0x199c6b=new Date(_0x5a2305),_0x5f1afd=new Date();_0x199c6b[_0x340689(0x161)]()!==_0x5f1afd[_0x340689(0x161)]()&&(_0x381f8a=new Array(0x18)[_0x340689(0x17f)](0x0));const _0x3240e9=_0x5f1afd['getHours']();if(_0x381f8a[_0x3240e9]===undefined)_0x381f8a[_0x3240e9]=0x0;_0x381f8a[_0x3240e9]++,await _0x100ee7[_0x340689(0x195)](_0x340689(0x190),{'val':JSON['stringify'](_0x381f8a),'ack':!![]});}function a5_0x33e0(_0x35937c,_0xa60094){const _0xe45c22=a5_0x4e22();return a5_0x33e0=function(_0x461fd6,_0x4530ba){_0x461fd6=_0x461fd6-0x128;let _0x4e22a0=_0xe45c22[_0x461fd6];return _0x4e22a0;},a5_0x33e0(_0x35937c,_0xa60094);}async function processSensorEvent(_0x3eb3d7,_0xefee50,_0x117b4a,_0x1704ac){const _0x13cc07=a5_0x33e0;if(!_0x1704ac)return null;const _0xaad419=_0x117b4a['val'],_0x29c272=Date[_0x13cc07(0x188)](),_0x67a9b4=_0x3eb3d7[_0x13cc07(0x178)][_0xefee50],_0x1b5691=(_0x1704ac[_0x13cc07(0x154)]||'')[_0x13cc07(0x14f)](),_0x267d0c=_0x1b5691['includes'](_0x13cc07(0x138))||_0x1b5691[_0x13cc07(0x15f)]('temperatur')||_0x1b5691[_0x13cc07(0x15f)](_0x13cc07(0x149))||_0x1b5691[_0x13cc07(0x15f)](_0x13cc07(0x176))||_0x1b5691[_0x13cc07(0x15f)](_0x13cc07(0x129));if(_0x267d0c&&typeof _0xaad419==='number'){if(_0xaad419>0x50||_0xaad419<-0x32)return _0x3eb3d7['log']['debug']('[RECORDER]\x20Ignored\x20implausible\x20temperature:\x20'+_0xaad419+_0x13cc07(0x156)+_0xefee50),null;}_0x3eb3d7[_0x13cc07(0x178)][_0xefee50]=_0xaad419;if(!_0x1704ac['logDuplicates']&&_0x67a9b4!=undefined&&_0x67a9b4==_0xaad419)return null;_0x3eb3d7[_0x13cc07(0x181)]&&_0x267d0c&&recordThermodynamics(_0x3eb3d7,_0xefee50,_0xaad419,_0x1704ac['location']);const _0x99b545={'timestamp':_0x29c272,'id':_0xefee50,'name':_0x1704ac[_0x13cc07(0x158)],'type':_0x1704ac[_0x13cc07(0x154)],'location':_0x1704ac[_0x13cc07(0x16d)],'value':_0xaad419};_0x3eb3d7[_0x13cc07(0x137)][_0x13cc07(0x194)](_0x99b545);if(_0x3eb3d7['eventHistory'][_0x13cc07(0x18e)]>HISTORY_MAX_SIZE)_0x3eb3d7['eventHistory'][_0x13cc07(0x17d)]();await _0x3eb3d7[_0x13cc07(0x195)]('events.lastEvent',{'val':JSON[_0x13cc07(0x174)](_0x99b545),'ack':!![]}),await _0x3eb3d7[_0x13cc07(0x195)](_0x13cc07(0x12f),{'val':JSON['stringify'](_0x3eb3d7['eventHistory']),'ack':!![]}),await updateHourlyActivity(_0x3eb3d7,_0x99b545);if(_0x3eb3d7[_0x13cc07(0x181)]){_0x3eb3d7[_0x13cc07(0x166)][_0x13cc07(0x192)](_0x99b545);if(_0x3eb3d7[_0x13cc07(0x166)][_0x13cc07(0x18e)]>RAW_LOG_MAX_SIZE)_0x3eb3d7[_0x13cc07(0x166)][_0x13cc07(0x187)](0x0,_0x3eb3d7['rawEventLog'][_0x13cc07(0x18e)]-RAW_LOG_MAX_SIZE);await _0x3eb3d7['setStateAsync'](_0x13cc07(0x198),{'val':JSON['stringify'](_0x3eb3d7[_0x13cc07(0x166)]),'ack':!![]}),recordSequence(_0x3eb3d7,_0x99b545);}if(_0x1704ac['isExit']&&_0xaad419===!![]){if(_0x3eb3d7[_0x13cc07(0x15b)]&&!_0x3eb3d7[_0x13cc07(0x18d)])startExitTimer(_0x3eb3d7);else{if(!_0x3eb3d7['isPresent'])setPresence(_0x3eb3d7,!![]);}}else{if(_0x1704ac[_0x13cc07(0x154)]===_0x13cc07(0x130)&&_0xaad419===!![]){if(_0x3eb3d7[_0x13cc07(0x169)])abortExitTimer(_0x3eb3d7);if(!_0x3eb3d7[_0x13cc07(0x15b)]&&_0x3eb3d7[_0x13cc07(0x163)]==='normal')setPresence(_0x3eb3d7,!![]);}}if(_0x3eb3d7[_0x13cc07(0x181)]&&_0x3eb3d7[_0x13cc07(0x142)]){_0x1704ac[_0x13cc07(0x154)]==='motion'&&_0xaad419===!![]&&_0x1704ac[_0x13cc07(0x16d)]&&_0x3eb3d7['sendToPythonWrapper'](_0x13cc07(0x17e),{'room':_0x1704ac[_0x13cc07(0x16d)]});const _0x7ea7d1=['door','tür',_0x13cc07(0x19a),_0x13cc07(0x165),_0x13cc07(0x17c),'handle',_0x13cc07(0x18f),_0x13cc07(0x136)]['some'](_0x107e12=>_0x1b5691[_0x13cc07(0x15f)](_0x107e12)),_0x211bb8=['light','licht',_0x13cc07(0x18c),_0x13cc07(0x164),_0x13cc07(0x13f),_0x13cc07(0x134)]['some'](_0x1e79ed=>_0x1b5691[_0x13cc07(0x15f)](_0x1e79ed)),_0x1846db=['motion',_0x13cc07(0x189),_0x13cc07(0x14c),_0x13cc07(0x145),_0x13cc07(0x131)][_0x13cc07(0x13c)](_0x4575ba=>_0x1b5691[_0x13cc07(0x15f)](_0x4575ba));if(_0x1704ac[_0x13cc07(0x16d)]&&(_0x7ea7d1||_0x211bb8||_0x1846db)){const _0x133000=_0xaad419===!![]||typeof _0xaad419===_0x13cc07(0x133)&&_0xaad419>0x0,_0x2d1e15=_0x7ea7d1&&!_0x133000&&_0x67a9b4!==undefined&&_0x67a9b4!=_0xaad419;if(_0x133000||_0x2d1e15){const _0x26956d=_0x3eb3d7[_0x13cc07(0x18b)]||_0x29c272,_0x14411f=(_0x29c272-_0x26956d)/0x3e8;_0x3eb3d7[_0x13cc07(0x18b)]=_0x29c272,_0x3eb3d7[_0x13cc07(0x142)](_0x13cc07(0x132),{'room':_0x1704ac[_0x13cc07(0x16d)],'dt':_0x14411f});}}}return _0x99b545;}function a5_0x4e22(){const _0x10bdf3=['thermostat','getHours','2153qYwwkO','STATE','search','46FyrSMS','events.history','motion','occupancy','TRACK_EVENT','number','lampe','.NextHours.Location_1.Day_1.current.temp_value','schloss','eventHistory','temperature','val','1270364pXftli','STATUS','some','Valve','.4.VALVE_STATE','dimmer','system.isPresent','.1.LEVEL','sendToPythonWrapper','[RECORDER]\x20Error:\x20','licht','presence','.forecast.current.temperature','Temperature','valveMapping','klima','message','LTM.trainingData.thermodynamics','präsenz','accuweather','12285361vBjeEM','toLowerCase','outdoorSensorId','.ACTUAL_TEMPERATURE','1132704KwLsJD','getForeignStateAsync','type','from','\x20from\x20','weatherunderground','name','string','apply','isPresent','constructor','light','useWeather','includes','Unknown','getDate','231fLnyXQ','currentSystemMode','schalter','fenster','rawEventLog','27iDYUio','1644CRFZzn','exitTimer','3ILWjBB','ANALYZE_SEQUENCE','.Current.Temperature','location','kontakt','value','getStateAsync','door','.forecast.current.temp','(((.+)+)+)+$','stringify','exitGraceTimer','heizung','contact','sensorLastValues','1285920bMRzxK','daswetter','toString','griff','pop','SIMULATE_SIGNAL','fill','.1.VALVE_STATE','isProVersion','LTM.trainingData.sequences','shift','parse','level','4265220ILeoMi','splice','now','bewegung','LEVEL','lastTrackerEventTime','switch','isGracePeriodActive','length','lock','analysis.health.todayVector','config','push','round','unshift','setStateAsync','true','tür','LTM.rawEventLog','error','window','.LEVEL','.1.ACTUAL_TEMPERATURE'];a5_0x4e22=function(){return _0x10bdf3;};return a5_0x4e22();}module['exports']={'processSensorEvent':processSensorEvent,'getOutsideTemperatureNumeric':getOutsideTemperatureNumeric,'setPresence':setPresence,'abortExitTimer':abortExitTimer,'startExitTimer':startExitTimer,'isRelevantActivity':isRelevantActivity};