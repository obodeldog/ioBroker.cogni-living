function a5_0x4785(){const _0x455104=['system.isPresent','12WCgPAM','\x20from\x20','search','SIMULATE_SIGNAL','Unknown','includes','location','.forecast.current.temperature','lastTrackerEventTime','currentSystemMode','sendToPythonWrapper','weatherunderground','bewegung','.1.TEMPERATURE','Valve','LTM.trainingData.sequences','pop','map','value','presence','8439624UxgUQs','parse','.Current.Temperature','lock','useWeather','temperatur','unshift','fenster','level','window','heizung','Temperature','type','.NextHours.Location_1.Day_1.current.temp_value','error','occupancy','number','thermostat','message','switch','stringify','analysis.health.todayVector','1244236EmMjPc','round','fill','replace','2720229bZoSRA','events.lastEvent','events.history','.1.ACTUAL_TEMPERATURE','isProVersion','schalter','push','STATUS','door','toLowerCase','shift','8446893WeTYbr','.forecast.current.temp','.4.VALVE_STATE','880990VbTqHb','string','exitTimer','kontakt','.ACTUAL_TEMPERATURE','accuweather','getDate','some','schloss','LTM.rawEventLog','rawEventLog','.1.VALVE_STATE','val','config','exitGraceTimer','normal','TRACK_EVENT','getHours','ANALYZE_SEQUENCE','isExit','now','867041iFUaJm','setStateAsync','from','handle','griff','lampe','contact','t체r','loc','valveMapping','getStateAsync','.LEVEL','length','sensorLastValues','motion','1002354fiUDHC','STATE','openweathermap','isPresent','light','isGracePeriodActive','daswetter','eventHistory','dimmer','licht','exports','toString','apply','pr채senz','LTM.trainingData.thermodynamics','getForeignStateAsync'];a5_0x4785=function(){return _0x455104;};return a5_0x4785();}const a5_0x4770db=a5_0x58e2;(function(_0x33930b,_0x3a45ec){const _0xf6599=a5_0x58e2,_0x289f23=_0x33930b();while(!![]){try{const _0xf3b227=-parseInt(_0xf6599(0xc3))/0x1+parseInt(_0xf6599(0xd2))/0x2+parseInt(_0xf6599(0xa0))/0x3+parseInt(_0xf6599(0x9c))/0x4+-parseInt(_0xf6599(0xae))/0x5*(parseInt(_0xf6599(0xe3))/0x6)+parseInt(_0xf6599(0xab))/0x7+-parseInt(_0xf6599(0x86))/0x8;if(_0xf3b227===_0x3a45ec)break;else _0x289f23['push'](_0x289f23['shift']());}catch(_0x2fa069){_0x289f23['push'](_0x289f23['shift']());}}}(a5_0x4785,0x9f018));const a5_0x595225=(function(){let _0x3ae540=!![];return function(_0x3334d4,_0x571d6){const _0x2c6a58=_0x3ae540?function(){const _0x43d33d=a5_0x58e2;if(_0x571d6){const _0x43e3b9=_0x571d6[_0x43d33d(0xde)](_0x3334d4,arguments);return _0x571d6=null,_0x43e3b9;}}:function(){};return _0x3ae540=![],_0x2c6a58;};}()),a5_0x41f901=a5_0x595225(this,function(){const _0x1e2018=a5_0x58e2;return a5_0x41f901[_0x1e2018(0xdd)]()[_0x1e2018(0xe5)]('(((.+)+)+)+$')[_0x1e2018(0xdd)]()['constructor'](a5_0x41f901)[_0x1e2018(0xe5)]('(((.+)+)+)+$');});a5_0x41f901();function a5_0x58e2(_0x99e090,_0x5267ba){const _0x5e88f3=a5_0x4785();return a5_0x58e2=function(_0x41f901,_0x595225){_0x41f901=_0x41f901-0x77;let _0x47850b=_0x5e88f3[_0x41f901];return _0x47850b;},a5_0x58e2(_0x99e090,_0x5267ba);}'use strict';const HISTORY_MAX_SIZE=0x32,RAW_LOG_MAX_SIZE=0x9c4,THERMO_LOG_SIZE=0x3e8,SEQUENCE_TIMEOUT_MS=0x5*0x3c*0x3e8,MAX_TRAINING_SET_SIZE=0x1f4,EXIT_TIMER_MINUTES=0xf,EXIT_GRACE_PERIOD_SECONDS=0x1e;let activeSequence=[],sequenceTimer=null;async function getOutsideTemperatureNumeric(_0x32bc59){const _0x741a8f=a5_0x58e2;if(_0x32bc59['config']['outdoorSensorId'])try{const _0x10de8c=await _0x32bc59[_0x741a8f(0xe1)](_0x32bc59[_0x741a8f(0xbb)]['outdoorSensorId']);if(_0x10de8c&&_0x10de8c[_0x741a8f(0xba)]!==undefined&&_0x10de8c['val']!==null)return parseFloat(_0x10de8c[_0x741a8f(0xba)]);}catch(_0x2eb62a){}const _0x3ecd9d=_0x32bc59[_0x741a8f(0xbb)]['weatherInstance'];if(!_0x32bc59[_0x741a8f(0xbb)][_0x741a8f(0x8a)]||!_0x3ecd9d)return null;try{let _0x1f8f54='';if(_0x3ecd9d[_0x741a8f(0x77)](_0x741a8f(0xb3)))_0x1f8f54=_0x3ecd9d+_0x741a8f(0x88);else{if(_0x3ecd9d[_0x741a8f(0x77)](_0x741a8f(0xd8)))_0x1f8f54=_0x3ecd9d+_0x741a8f(0x93);else{if(_0x3ecd9d[_0x741a8f(0x77)](_0x741a8f(0xd4)))_0x1f8f54=_0x3ecd9d+_0x741a8f(0x79);else{if(_0x3ecd9d['includes'](_0x741a8f(0x7d)))_0x1f8f54=_0x3ecd9d+_0x741a8f(0xac);}}}if(_0x1f8f54){const _0x36f9fa=await _0x32bc59[_0x741a8f(0xe1)](_0x1f8f54);if(_0x36f9fa&&_0x36f9fa[_0x741a8f(0xba)]!==undefined&&_0x36f9fa['val']!==null)return parseFloat(_0x36f9fa[_0x741a8f(0xba)]);}}catch(_0x5437a3){}return null;}async function recordThermodynamics(_0x3671f2,_0x5ccc74,_0x5c63e8,_0x52ade9){const _0x59f761=a5_0x58e2,_0x4324e5=await getOutsideTemperatureNumeric(_0x3671f2);if(_0x4324e5===null)return;let _0x135e8c=0x0,_0x36a9a2=![];if(_0x3671f2[_0x59f761(0xbb)][_0x59f761(0xcc)])try{let _0x4e74f2=_0x3671f2[_0x59f761(0xbb)][_0x59f761(0xcc)];if(typeof _0x4e74f2===_0x59f761(0xaf))_0x4e74f2=JSON['parse'](_0x4e74f2);if(_0x4e74f2[_0x5ccc74]){const _0x4b27be=_0x4e74f2[_0x5ccc74],_0x322195=await _0x3671f2['getForeignStateAsync'](_0x4b27be);if(_0x322195&&_0x322195[_0x59f761(0xba)]!==null&&_0x322195[_0x59f761(0xba)]!==undefined){let _0x79ec7a=Number(_0x322195[_0x59f761(0xba)]);if(_0x79ec7a<=1.05&&!_0x4b27be[_0x59f761(0x77)](_0x59f761(0xa7))&&!_0x4b27be[_0x59f761(0x77)](_0x59f761(0xd3)))_0x79ec7a=_0x79ec7a*0x64;_0x135e8c=Math[_0x59f761(0x9d)](_0x79ec7a),_0x36a9a2=!![];}}}catch(_0xb385ea){}if(!_0x36a9a2){const _0x47c875=[{'from':_0x59f761(0xa3),'to':'.1.LEVEL'},{'from':'.1.ACTUAL_TEMPERATURE','to':_0x59f761(0xb9)},{'from':_0x59f761(0x7f),'to':_0x59f761(0xad)},{'from':_0x59f761(0xb2),'to':_0x59f761(0xce)},{'from':'temperature','to':_0x59f761(0x8e)},{'from':_0x59f761(0x91),'to':_0x59f761(0x80)}];for(const _0x3c582c of _0x47c875){if(_0x5ccc74['includes'](_0x3c582c[_0x59f761(0xc5)])){const _0x467665=_0x5ccc74[_0x59f761(0x9f)](_0x3c582c[_0x59f761(0xc5)],_0x3c582c['to']);try{const _0x1b2d89=await _0x3671f2[_0x59f761(0xe1)](_0x467665);if(_0x1b2d89&&_0x1b2d89['val']!==null&&_0x1b2d89[_0x59f761(0xba)]!==undefined){let _0xe3f430=Number(_0x1b2d89[_0x59f761(0xba)]);if(typeof _0xe3f430===_0x59f761(0x96)){if(_0xe3f430<=1.05&&_0x3c582c['to']['includes']('LEVEL'))_0xe3f430=_0xe3f430*0x64;_0x135e8c=Math[_0x59f761(0x9d)](_0xe3f430),_0x36a9a2=!![];break;}}}catch(_0x5cda83){}}}}const _0x5f1d3e=await _0x3671f2[_0x59f761(0xcd)]('LTM.trainingData.thermodynamics');let _0x362be7=[];if(_0x5f1d3e&&_0x5f1d3e[_0x59f761(0xba)])try{_0x362be7=JSON[_0x59f761(0x87)](_0x5f1d3e[_0x59f761(0xba)]);}catch(_0x518061){}_0x362be7[_0x59f761(0xa6)]({'ts':Date[_0x59f761(0xc2)](),'room':_0x52ade9||'Unknown','t_in':_0x5c63e8,'t_out':_0x4324e5,'valve':_0x135e8c});if(_0x362be7[_0x59f761(0xcf)]>THERMO_LOG_SIZE)_0x362be7[_0x59f761(0xaa)]();await _0x3671f2[_0x59f761(0xc4)](_0x59f761(0xe0),{'val':JSON[_0x59f761(0x9a)](_0x362be7),'ack':!![]});}async function saveCompletedSequence(_0x1342b0){const _0x201e73=a5_0x58e2;try{const _0xef7576=await _0x1342b0[_0x201e73(0xcd)](_0x201e73(0x81));let _0x447757=[];if(_0xef7576&&_0xef7576['val'])try{_0x447757=JSON[_0x201e73(0x87)](_0xef7576[_0x201e73(0xba)]);}catch(_0x5b4d2b){}const _0x35b158=activeSequence[0x0]['ts'],_0x380a7d=activeSequence[_0x201e73(0x83)](_0x176589=>({'loc':_0x176589[_0x201e73(0xcb)],'t_delta':Math[_0x201e73(0x9d)]((_0x176589['ts']-_0x35b158)/0x3e8)})),_0x21ab42={'timestamp':new Date(_0x35b158)['toISOString'](),'steps':_0x380a7d,'duration':Math[_0x201e73(0x9d)]((activeSequence[activeSequence[_0x201e73(0xcf)]-0x1]['ts']-_0x35b158)/0x3e8),'daytime':new Date(_0x35b158)[_0x201e73(0xbf)]()};_0x447757[_0x201e73(0xa6)](_0x21ab42);if(_0x447757[_0x201e73(0xcf)]>MAX_TRAINING_SET_SIZE)_0x447757['shift']();await _0x1342b0[_0x201e73(0xc4)]('LTM.trainingData.sequences',{'val':JSON[_0x201e73(0x9a)](_0x447757),'ack':!![]}),_0x1342b0[_0x201e73(0xa4)]&&_0x1342b0[_0x201e73(0x7c)]&&_0x1342b0[_0x201e73(0x7c)](_0x201e73(0xc0),{'sequence':_0x21ab42});}catch(_0x2066d1){_0x1342b0['log'][_0x201e73(0x94)]('[RECORDER]\x20Error:\x20'+_0x2066d1[_0x201e73(0x98)]);}}async function recordSequence(_0x5b10cf,_0x58ae87){const _0xbbc77a=a5_0x58e2,_0x1b4e7a=(_0x58ae87['type']||'')[_0xbbc77a(0xa9)](),_0x45303a=[_0xbbc77a(0xd1),_0xbbc77a(0x7e),_0xbbc77a(0xdf),_0xbbc77a(0x85),_0xbbc77a(0x95),'door',_0xbbc77a(0xca),_0xbbc77a(0x8f),_0xbbc77a(0x8d),_0xbbc77a(0xc9),'kontakt','light',_0xbbc77a(0xdb),_0xbbc77a(0x99),_0xbbc77a(0xa5),_0xbbc77a(0xda),_0xbbc77a(0xc8)];if(!_0x45303a['some'](_0x4c7b1e=>_0x1b4e7a[_0xbbc77a(0x77)](_0x4c7b1e)))return;if(!_0x58ae87[_0xbbc77a(0x84)])return;if(sequenceTimer)clearTimeout(sequenceTimer);activeSequence[_0xbbc77a(0xa6)]({'loc':_0x58ae87['location']||_0xbbc77a(0xe7),'id':_0x58ae87['id'],'ts':Date[_0xbbc77a(0xc2)]()}),sequenceTimer=setTimeout(async()=>{const _0x333777=_0xbbc77a;if(activeSequence[_0x333777(0xcf)]>0x1)await saveCompletedSequence(_0x5b10cf);activeSequence=[];},SEQUENCE_TIMEOUT_MS);}function startExitTimer(_0x2d9900){const _0x163d71=a5_0x58e2;abortExitTimer(_0x2d9900),_0x2d9900[_0x163d71(0xd7)]=!![],_0x2d9900[_0x163d71(0xbc)]=setTimeout(()=>{const _0x1eb0cf=_0x163d71;_0x2d9900[_0x1eb0cf(0xd7)]=![];},EXIT_GRACE_PERIOD_SECONDS*0x3e8),_0x2d9900[_0x163d71(0xb0)]=setTimeout(()=>{const _0x23a939=_0x163d71;setPresence(_0x2d9900,![]),_0x2d9900[_0x23a939(0xb0)]=null;},EXIT_TIMER_MINUTES*0x3c*0x3e8);}function abortExitTimer(_0x620c6c){const _0x10d09e=a5_0x58e2;if(_0x620c6c[_0x10d09e(0xb0)])clearTimeout(_0x620c6c[_0x10d09e(0xb0)]);if(_0x620c6c[_0x10d09e(0xbc)])clearTimeout(_0x620c6c[_0x10d09e(0xbc)]);_0x620c6c[_0x10d09e(0xb0)]=null,_0x620c6c['exitGraceTimer']=null,_0x620c6c[_0x10d09e(0xd7)]=![];}async function setPresence(_0x1bc4ca,_0x53f4b3){const _0x628d49=a5_0x58e2;if(_0x1bc4ca['isPresent']===_0x53f4b3)return;_0x1bc4ca['isPresent']=_0x53f4b3,await _0x1bc4ca[_0x628d49(0xc4)](_0x628d49(0xe2),{'val':_0x53f4b3,'ack':!![]});}function isRelevantActivity(_0x26ba73,_0x1fb01e){const _0x5152f3=a5_0x58e2;if(!_0x26ba73)return![];const _0x39815d=_0x26ba73['toLowerCase'](),_0x350883=_0x1fb01e===!![]||_0x1fb01e===0x1||_0x1fb01e==='on'||_0x1fb01e==='true';if(!_0x350883)return![];const _0xefa29=['motion','bewegung',_0x5152f3(0xdf),_0x5152f3(0x85),'occupancy']['some'](_0x1e2d89=>_0x39815d[_0x5152f3(0x77)](_0x1e2d89)),_0x1e5c90=[_0x5152f3(0xa8),_0x5152f3(0xca),_0x5152f3(0x8f),_0x5152f3(0x8d),_0x5152f3(0xc7),_0x5152f3(0xc6),_0x5152f3(0x89),_0x5152f3(0xb6),_0x5152f3(0xc9),_0x5152f3(0xb1)][_0x5152f3(0xb5)](_0x3472b2=>_0x39815d['includes'](_0x3472b2)),_0x4cce5b=[_0x5152f3(0xd6),_0x5152f3(0xdb),_0x5152f3(0x99),_0x5152f3(0xa5),_0x5152f3(0xda),_0x5152f3(0xc8)][_0x5152f3(0xb5)](_0x236f3a=>_0x39815d[_0x5152f3(0x77)](_0x236f3a));return _0xefa29||_0x1e5c90||_0x4cce5b;}async function updateHourlyActivity(_0xd1cfdd,_0x2f139b){const _0x47c5e4=a5_0x58e2;if(!isRelevantActivity(_0x2f139b[_0x47c5e4(0x92)],_0x2f139b[_0x47c5e4(0x84)]))return;let _0x554a3d=new Array(0x18)[_0x47c5e4(0x9e)](0x0),_0x236a2e=0x0;try{const _0x534d6a=await _0xd1cfdd[_0x47c5e4(0xcd)](_0x47c5e4(0x9b));_0x534d6a&&_0x534d6a[_0x47c5e4(0xba)]&&(_0x554a3d=JSON['parse'](_0x534d6a[_0x47c5e4(0xba)]),_0x236a2e=_0x534d6a['ts']);}catch(_0x531c31){}const _0x4c7bdd=new Date(_0x236a2e),_0x519ffd=new Date();_0x4c7bdd[_0x47c5e4(0xb4)]()!==_0x519ffd[_0x47c5e4(0xb4)]()&&(_0x554a3d=new Array(0x18)[_0x47c5e4(0x9e)](0x0));const _0x43193a=_0x519ffd['getHours']();if(_0x554a3d[_0x43193a]===undefined)_0x554a3d[_0x43193a]=0x0;_0x554a3d[_0x43193a]++,await _0xd1cfdd[_0x47c5e4(0xc4)]('analysis.health.todayVector',{'val':JSON[_0x47c5e4(0x9a)](_0x554a3d),'ack':!![]});}async function processSensorEvent(_0x5eb2ec,_0x261b8d,_0xcb8378,_0x2e4962){const _0x1446a2=a5_0x58e2;if(!_0x2e4962)return null;const _0x5a3042=_0xcb8378[_0x1446a2(0xba)],_0x9d73ad=Date[_0x1446a2(0xc2)](),_0x7a819c=_0x5eb2ec['sensorLastValues'][_0x261b8d],_0x25ed4e=(_0x2e4962[_0x1446a2(0x92)]||'')['toLowerCase'](),_0x45b2a1=_0x25ed4e['includes']('temperature')||_0x25ed4e[_0x1446a2(0x77)](_0x1446a2(0x8b))||_0x25ed4e[_0x1446a2(0x77)]('klima')||_0x25ed4e[_0x1446a2(0x77)](_0x1446a2(0x90))||_0x25ed4e['includes'](_0x1446a2(0x97));if(_0x45b2a1&&typeof _0x5a3042==='number'){if(_0x5a3042>0x50||_0x5a3042<-0x32)return _0x5eb2ec['log']['debug']('[RECORDER]\x20Ignored\x20implausible\x20temperature:\x20'+_0x5a3042+_0x1446a2(0xe4)+_0x261b8d),null;}_0x5eb2ec[_0x1446a2(0xd0)][_0x261b8d]=_0x5a3042;if(!_0x2e4962['logDuplicates']&&_0x7a819c!=undefined&&_0x7a819c==_0x5a3042)return null;_0x5eb2ec[_0x1446a2(0xa4)]&&_0x45b2a1&&recordThermodynamics(_0x5eb2ec,_0x261b8d,_0x5a3042,_0x2e4962[_0x1446a2(0x78)]);const _0x315da5={'timestamp':_0x9d73ad,'id':_0x261b8d,'name':_0x2e4962['name'],'type':_0x2e4962[_0x1446a2(0x92)],'location':_0x2e4962[_0x1446a2(0x78)],'value':_0x5a3042};_0x5eb2ec[_0x1446a2(0xd9)][_0x1446a2(0x8c)](_0x315da5);if(_0x5eb2ec['eventHistory'][_0x1446a2(0xcf)]>HISTORY_MAX_SIZE)_0x5eb2ec[_0x1446a2(0xd9)][_0x1446a2(0x82)]();await _0x5eb2ec['setStateAsync'](_0x1446a2(0xa1),{'val':JSON[_0x1446a2(0x9a)](_0x315da5),'ack':!![]}),await _0x5eb2ec[_0x1446a2(0xc4)](_0x1446a2(0xa2),{'val':JSON[_0x1446a2(0x9a)](_0x5eb2ec[_0x1446a2(0xd9)]),'ack':!![]}),await updateHourlyActivity(_0x5eb2ec,_0x315da5);if(_0x5eb2ec[_0x1446a2(0xa4)]){_0x5eb2ec[_0x1446a2(0xb8)][_0x1446a2(0xa6)](_0x315da5);if(_0x5eb2ec[_0x1446a2(0xb8)][_0x1446a2(0xcf)]>RAW_LOG_MAX_SIZE)_0x5eb2ec[_0x1446a2(0xb8)]['splice'](0x0,_0x5eb2ec[_0x1446a2(0xb8)][_0x1446a2(0xcf)]-RAW_LOG_MAX_SIZE);await _0x5eb2ec[_0x1446a2(0xc4)](_0x1446a2(0xb7),{'val':JSON[_0x1446a2(0x9a)](_0x5eb2ec[_0x1446a2(0xb8)]),'ack':!![]}),recordSequence(_0x5eb2ec,_0x315da5);}if(_0x2e4962[_0x1446a2(0xc1)]&&_0x5a3042===!![]){if(_0x5eb2ec[_0x1446a2(0xd5)]&&!_0x5eb2ec['isGracePeriodActive'])startExitTimer(_0x5eb2ec);else{if(!_0x5eb2ec[_0x1446a2(0xd5)])setPresence(_0x5eb2ec,!![]);}}else{if(_0x2e4962[_0x1446a2(0x92)]===_0x1446a2(0xd1)&&_0x5a3042===!![]){if(_0x5eb2ec[_0x1446a2(0xb0)])abortExitTimer(_0x5eb2ec);if(!_0x5eb2ec[_0x1446a2(0xd5)]&&_0x5eb2ec[_0x1446a2(0x7b)]===_0x1446a2(0xbd))setPresence(_0x5eb2ec,!![]);}}if(_0x5eb2ec['isProVersion']&&_0x5eb2ec[_0x1446a2(0x7c)]){_0x2e4962[_0x1446a2(0x92)]===_0x1446a2(0xd1)&&_0x5a3042===!![]&&_0x2e4962[_0x1446a2(0x78)]&&_0x5eb2ec[_0x1446a2(0x7c)](_0x1446a2(0xe6),{'room':_0x2e4962[_0x1446a2(0x78)]});const _0x3d2096=['door','t체r',_0x1446a2(0x8f),_0x1446a2(0x8d),_0x1446a2(0xc7),_0x1446a2(0xc6),_0x1446a2(0x89),_0x1446a2(0xb6)]['some'](_0x2bb117=>_0x25ed4e[_0x1446a2(0x77)](_0x2bb117)),_0x1c32fb=['light',_0x1446a2(0xdb),'switch',_0x1446a2(0xa5),'dimmer',_0x1446a2(0xc8)]['some'](_0x5c5a53=>_0x25ed4e[_0x1446a2(0x77)](_0x5c5a53)),_0x2dd9f3=[_0x1446a2(0xd1),_0x1446a2(0x7e),'pr채senz',_0x1446a2(0x85),_0x1446a2(0x95)][_0x1446a2(0xb5)](_0x51872=>_0x25ed4e[_0x1446a2(0x77)](_0x51872));if(_0x2e4962[_0x1446a2(0x78)]&&(_0x3d2096||_0x1c32fb||_0x2dd9f3)){const _0xc9760=_0x5a3042===!![]||typeof _0x5a3042===_0x1446a2(0x96)&&_0x5a3042>0x0,_0x4ac8e3=_0x3d2096&&!_0xc9760&&_0x7a819c!==undefined&&_0x7a819c!=_0x5a3042;if(_0xc9760||_0x4ac8e3){const _0x162075=_0x5eb2ec[_0x1446a2(0x7a)]||_0x9d73ad,_0x176661=(_0x9d73ad-_0x162075)/0x3e8;_0x5eb2ec[_0x1446a2(0x7a)]=_0x9d73ad,_0x5eb2ec[_0x1446a2(0x7c)](_0x1446a2(0xbe),{'room':_0x2e4962[_0x1446a2(0x78)],'dt':_0x176661});}}}return _0x315da5;}module[a5_0x4770db(0xdc)]={'processSensorEvent':processSensorEvent,'getOutsideTemperatureNumeric':getOutsideTemperatureNumeric,'setPresence':setPresence,'abortExitTimer':abortExitTimer,'startExitTimer':startExitTimer,'isRelevantActivity':isRelevantActivity};