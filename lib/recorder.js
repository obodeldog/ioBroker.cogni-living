const a5_0x23bf6b=a5_0x1ac0;(function(_0xe27457,_0x2e2965){const _0x1a546b=a5_0x1ac0,_0x9a08fd=_0xe27457();while(!![]){try{const _0x36d6ec=-parseInt(_0x1a546b(0x145))/0x1+-parseInt(_0x1a546b(0x171))/0x2*(parseInt(_0x1a546b(0x184))/0x3)+parseInt(_0x1a546b(0x191))/0x4*(parseInt(_0x1a546b(0x13a))/0x5)+parseInt(_0x1a546b(0x154))/0x6*(parseInt(_0x1a546b(0x19e))/0x7)+parseInt(_0x1a546b(0x15c))/0x8+-parseInt(_0x1a546b(0x139))/0x9*(-parseInt(_0x1a546b(0x174))/0xa)+-parseInt(_0x1a546b(0x14c))/0xb;if(_0x36d6ec===_0x2e2965)break;else _0x9a08fd['push'](_0x9a08fd['shift']());}catch(_0x54ceba){_0x9a08fd['push'](_0x9a08fd['shift']());}}}(a5_0x3146,0x47074));const a5_0x93e3c=(function(){let _0x2067cd=!![];return function(_0x26126c,_0x4768d8){const _0x4f0cdf=_0x2067cd?function(){const _0x40eb18=a5_0x1ac0;if(_0x4768d8){const _0x162125=_0x4768d8[_0x40eb18(0x14d)](_0x26126c,arguments);return _0x4768d8=null,_0x162125;}}:function(){};return _0x2067cd=![],_0x4f0cdf;};}()),a5_0x10d174=a5_0x93e3c(this,function(){const _0x53d19f=a5_0x1ac0;return a5_0x10d174[_0x53d19f(0x138)]()[_0x53d19f(0x14f)](_0x53d19f(0x19c))[_0x53d19f(0x138)]()[_0x53d19f(0x18b)](a5_0x10d174)[_0x53d19f(0x14f)](_0x53d19f(0x19c));});a5_0x10d174();'use strict';const HISTORY_MAX_SIZE=0x32,RAW_LOG_MAX_SIZE=0x9c4,THERMO_LOG_SIZE=0x3e8,SEQUENCE_TIMEOUT_MS=0x5*0x3c*0x3e8,MAX_TRAINING_SET_SIZE=0x1f4,EXIT_TIMER_MINUTES=0xf,EXIT_GRACE_PERIOD_SECONDS=0x1e;let activeSequence=[],sequenceTimer=null;async function getOutsideTemperatureNumeric(_0x387f87){const _0x283972=a5_0x1ac0;if(_0x387f87['config']['outdoorSensorId'])try{const _0x46785c=await _0x387f87[_0x283972(0x181)](_0x387f87[_0x283972(0x16b)][_0x283972(0x180)]);if(_0x46785c&&_0x46785c[_0x283972(0x17b)]!==undefined&&_0x46785c[_0x283972(0x17b)]!==null)return parseFloat(_0x46785c['val']);}catch(_0x544af1){}const _0x4cc47a=_0x387f87[_0x283972(0x16b)][_0x283972(0x159)];if(!_0x387f87[_0x283972(0x16b)][_0x283972(0x13e)]||!_0x4cc47a)return null;try{let _0x21b596='';if(_0x4cc47a[_0x283972(0x183)](_0x283972(0x12d)))_0x21b596=_0x4cc47a+_0x283972(0x18f);else{if(_0x4cc47a[_0x283972(0x183)](_0x283972(0x185)))_0x21b596=_0x4cc47a+'.NextHours.Location_1.Day_1.current.temp_value';else{if(_0x4cc47a[_0x283972(0x183)](_0x283972(0x15d)))_0x21b596=_0x4cc47a+_0x283972(0x17e);else{if(_0x4cc47a['includes'](_0x283972(0x16d)))_0x21b596=_0x4cc47a+_0x283972(0x16c);}}}if(_0x21b596){const _0x2b4610=await _0x387f87[_0x283972(0x181)](_0x21b596);if(_0x2b4610&&_0x2b4610['val']!==undefined&&_0x2b4610[_0x283972(0x17b)]!==null)return parseFloat(_0x2b4610['val']);}}catch(_0x1884b4){}return null;}async function recordThermodynamics(_0x3c92e5,_0x28c002,_0x3d5414,_0x52f0fb){const _0x3b69a1=a5_0x1ac0,_0x1bc4ca=await getOutsideTemperatureNumeric(_0x3c92e5);if(_0x1bc4ca===null)return;let _0xf190ed=0x0,_0x21d2c1=![];if(_0x3c92e5[_0x3b69a1(0x16b)][_0x3b69a1(0x16f)])try{let _0xc2e104=_0x3c92e5[_0x3b69a1(0x16b)][_0x3b69a1(0x16f)];if(typeof _0xc2e104===_0x3b69a1(0x13b))_0xc2e104=JSON[_0x3b69a1(0x134)](_0xc2e104);if(_0xc2e104[_0x28c002]){const _0x4b8401=_0xc2e104[_0x28c002],_0x109d45=await _0x3c92e5['getForeignStateAsync'](_0x4b8401);if(_0x109d45&&_0x109d45[_0x3b69a1(0x17b)]!==null&&_0x109d45[_0x3b69a1(0x17b)]!==undefined){let _0x3d6269=Number(_0x109d45[_0x3b69a1(0x17b)]);if(_0x3d6269<=1.05&&!_0x4b8401['includes'](_0x3b69a1(0x147))&&!_0x4b8401['includes']('STATE'))_0x3d6269=_0x3d6269*0x64;_0xf190ed=Math['round'](_0x3d6269),_0x21d2c1=!![];}}}catch(_0x4cd6eb){}if(!_0x21d2c1){const _0x41f906=[{'from':'.1.ACTUAL_TEMPERATURE','to':_0x3b69a1(0x144)},{'from':_0x3b69a1(0x199),'to':_0x3b69a1(0x15f)},{'from':_0x3b69a1(0x15e),'to':_0x3b69a1(0x14e)},{'from':'.ACTUAL_TEMPERATURE','to':_0x3b69a1(0x12e)},{'from':_0x3b69a1(0x170),'to':_0x3b69a1(0x17f)},{'from':_0x3b69a1(0x12a),'to':_0x3b69a1(0x195)}];for(const _0x1a1b9c of _0x41f906){if(_0x28c002[_0x3b69a1(0x183)](_0x1a1b9c['from'])){const _0x1d8a6f=_0x28c002[_0x3b69a1(0x130)](_0x1a1b9c[_0x3b69a1(0x162)],_0x1a1b9c['to']);try{const _0x128245=await _0x3c92e5[_0x3b69a1(0x181)](_0x1d8a6f);if(_0x128245&&_0x128245[_0x3b69a1(0x17b)]!==null&&_0x128245[_0x3b69a1(0x17b)]!==undefined){let _0x2c023f=Number(_0x128245['val']);if(typeof _0x2c023f===_0x3b69a1(0x172)){if(_0x2c023f<=1.05&&_0x1a1b9c['to']['includes'](_0x3b69a1(0x187)))_0x2c023f=_0x2c023f*0x64;_0xf190ed=Math[_0x3b69a1(0x169)](_0x2c023f),_0x21d2c1=!![];break;}}}catch(_0x197d6e){}}}}const _0x381cba=await _0x3c92e5[_0x3b69a1(0x12f)](_0x3b69a1(0x196));let _0x1c0eed=[];if(_0x381cba&&_0x381cba[_0x3b69a1(0x17b)])try{_0x1c0eed=JSON['parse'](_0x381cba[_0x3b69a1(0x17b)]);}catch(_0x16102c){}_0x1c0eed[_0x3b69a1(0x133)]({'ts':Date[_0x3b69a1(0x14a)](),'room':_0x52f0fb||'Unknown','t_in':_0x3d5414,'t_out':_0x1bc4ca,'valve':_0xf190ed});if(_0x1c0eed[_0x3b69a1(0x140)]>THERMO_LOG_SIZE)_0x1c0eed[_0x3b69a1(0x152)]();await _0x3c92e5[_0x3b69a1(0x13c)](_0x3b69a1(0x196),{'val':JSON[_0x3b69a1(0x153)](_0x1c0eed),'ack':!![]});}async function saveCompletedSequence(_0x1a7d33){const _0x1a10a7=a5_0x1ac0;try{const _0x42a620=await _0x1a7d33[_0x1a10a7(0x12f)](_0x1a10a7(0x13f));let _0x3b2d1d=[];if(_0x42a620&&_0x42a620[_0x1a10a7(0x17b)])try{_0x3b2d1d=JSON['parse'](_0x42a620['val']);}catch(_0x44be34){}const _0x4ca982=activeSequence[0x0]['ts'],_0x3481b4=activeSequence[_0x1a10a7(0x177)](_0x3aab3b=>({'loc':_0x3aab3b[_0x1a10a7(0x155)],'t_delta':Math[_0x1a10a7(0x169)]((_0x3aab3b['ts']-_0x4ca982)/0x3e8)})),_0x4892e5={'timestamp':new Date(_0x4ca982)[_0x1a10a7(0x190)](),'steps':_0x3481b4,'duration':Math['round']((activeSequence[activeSequence['length']-0x1]['ts']-_0x4ca982)/0x3e8),'daytime':new Date(_0x4ca982)[_0x1a10a7(0x164)]()};_0x3b2d1d[_0x1a10a7(0x133)](_0x4892e5);if(_0x3b2d1d[_0x1a10a7(0x140)]>MAX_TRAINING_SET_SIZE)_0x3b2d1d['shift']();await _0x1a7d33['setStateAsync'](_0x1a10a7(0x13f),{'val':JSON[_0x1a10a7(0x153)](_0x3b2d1d),'ack':!![]}),_0x1a7d33[_0x1a10a7(0x168)]&&_0x1a7d33[_0x1a10a7(0x148)]&&_0x1a7d33[_0x1a10a7(0x148)](_0x1a10a7(0x156),{'sequence':_0x4892e5});}catch(_0xf00031){_0x1a7d33[_0x1a10a7(0x132)][_0x1a10a7(0x13d)](_0x1a10a7(0x188)+_0xf00031[_0x1a10a7(0x157)]);}}async function recordSequence(_0x2d8247,_0x1fd0ab){const _0x46cfbf=a5_0x1ac0,_0x3ea492=(_0x1fd0ab[_0x46cfbf(0x160)]||'')[_0x46cfbf(0x197)](),_0x16f20e=[_0x46cfbf(0x135),_0x46cfbf(0x131),_0x46cfbf(0x16a),_0x46cfbf(0x19b),_0x46cfbf(0x149),_0x46cfbf(0x17c),'tür',_0x46cfbf(0x16e),'fenster',_0x46cfbf(0x161),_0x46cfbf(0x126),_0x46cfbf(0x189),_0x46cfbf(0x163),_0x46cfbf(0x18e),_0x46cfbf(0x179),_0x46cfbf(0x18d),'lampe'];if(!_0x16f20e[_0x46cfbf(0x193)](_0x24374a=>_0x3ea492[_0x46cfbf(0x183)](_0x24374a)))return;if(!_0x1fd0ab[_0x46cfbf(0x166)])return;if(sequenceTimer)clearTimeout(sequenceTimer);activeSequence[_0x46cfbf(0x133)]({'loc':_0x1fd0ab[_0x46cfbf(0x136)]||_0x46cfbf(0x128),'id':_0x1fd0ab['id'],'ts':Date[_0x46cfbf(0x14a)]()}),sequenceTimer=setTimeout(async()=>{if(activeSequence['length']>0x1)await saveCompletedSequence(_0x2d8247);activeSequence=[];},SEQUENCE_TIMEOUT_MS);}function startExitTimer(_0x3a9453){const _0x5be1dd=a5_0x1ac0;abortExitTimer(_0x3a9453),_0x3a9453['isGracePeriodActive']=!![],_0x3a9453[_0x5be1dd(0x17d)]=setTimeout(()=>{const _0x2bca01=_0x5be1dd;_0x3a9453[_0x2bca01(0x186)]=![];},EXIT_GRACE_PERIOD_SECONDS*0x3e8),_0x3a9453['exitTimer']=setTimeout(()=>{const _0x3a0309=_0x5be1dd;setPresence(_0x3a9453,![]),_0x3a9453[_0x3a0309(0x15a)]=null;},EXIT_TIMER_MINUTES*0x3c*0x3e8);}function a5_0x1ac0(_0x419199,_0x464c71){const _0x2a038f=a5_0x3146();return a5_0x1ac0=function(_0x10d174,_0x93e3c){_0x10d174=_0x10d174-0x126;let _0x314632=_0x2a038f[_0x10d174];return _0x314632;},a5_0x1ac0(_0x419199,_0x464c71);}function abortExitTimer(_0x2ceb93){const _0x183c98=a5_0x1ac0;if(_0x2ceb93[_0x183c98(0x15a)])clearTimeout(_0x2ceb93[_0x183c98(0x15a)]);if(_0x2ceb93[_0x183c98(0x17d)])clearTimeout(_0x2ceb93[_0x183c98(0x17d)]);_0x2ceb93[_0x183c98(0x15a)]=null,_0x2ceb93[_0x183c98(0x17d)]=null,_0x2ceb93['isGracePeriodActive']=![];}async function setPresence(_0x4141bb,_0x36afbd){const _0x559481=a5_0x1ac0;if(_0x4141bb[_0x559481(0x12c)]===_0x36afbd)return;_0x4141bb[_0x559481(0x12c)]=_0x36afbd,await _0x4141bb['setStateAsync'](_0x559481(0x14b),{'val':_0x36afbd,'ack':!![]});}async function updateHourlyActivity(_0x2177ca){const _0x6451fa=a5_0x1ac0;let _0x399edf=new Array(0x18)[_0x6451fa(0x151)](0x0),_0x1e6b02=0x0;try{const _0x1cc3ac=await _0x2177ca['getStateAsync'](_0x6451fa(0x146));_0x1cc3ac&&_0x1cc3ac[_0x6451fa(0x17b)]&&(_0x399edf=JSON['parse'](_0x1cc3ac[_0x6451fa(0x17b)]),_0x1e6b02=_0x1cc3ac['ts']);}catch(_0x685855){}const _0x5b11a2=new Date(_0x1e6b02),_0x336c92=new Date();_0x5b11a2[_0x6451fa(0x18c)]()!==_0x336c92[_0x6451fa(0x18c)]()&&(_0x399edf=new Array(0x18)[_0x6451fa(0x151)](0x0));const _0xf935d9=_0x336c92[_0x6451fa(0x164)]();if(_0x399edf[_0xf935d9]===undefined)_0x399edf[_0xf935d9]=0x0;_0x399edf[_0xf935d9]++,await _0x2177ca[_0x6451fa(0x13c)](_0x6451fa(0x146),{'val':JSON[_0x6451fa(0x153)](_0x399edf),'ack':!![]});}async function processSensorEvent(_0x1e6df1,_0x20bb44,_0x41bd92,_0xb43e0f){const _0x45dcaf=a5_0x1ac0;if(!_0xb43e0f)return null;const _0x332ee9=_0x41bd92[_0x45dcaf(0x17b)],_0x5b7606=Date[_0x45dcaf(0x14a)](),_0x19ad3f=_0x1e6df1[_0x45dcaf(0x175)][_0x20bb44],_0x16a165=(_0xb43e0f[_0x45dcaf(0x160)]||'')[_0x45dcaf(0x197)](),_0x400166=_0x16a165[_0x45dcaf(0x183)](_0x45dcaf(0x170))||_0x16a165[_0x45dcaf(0x183)]('temperatur')||_0x16a165[_0x45dcaf(0x183)](_0x45dcaf(0x19d))||_0x16a165[_0x45dcaf(0x183)]('heizung')||_0x16a165[_0x45dcaf(0x183)](_0x45dcaf(0x158));if(_0x400166&&typeof _0x332ee9===_0x45dcaf(0x172)){if(_0x332ee9>0x50||_0x332ee9<-0x32)return _0x1e6df1[_0x45dcaf(0x132)][_0x45dcaf(0x12b)](_0x45dcaf(0x173)+_0x332ee9+_0x45dcaf(0x182)+_0x20bb44),null;}_0x1e6df1[_0x45dcaf(0x175)][_0x20bb44]=_0x332ee9;if(!_0xb43e0f[_0x45dcaf(0x143)]&&_0x19ad3f!=undefined&&_0x19ad3f==_0x332ee9)return null;_0x1e6df1['isProVersion']&&_0x400166&&recordThermodynamics(_0x1e6df1,_0x20bb44,_0x332ee9,_0xb43e0f['location']);const _0x3fc2ae={'timestamp':_0x5b7606,'id':_0x20bb44,'name':_0xb43e0f[_0x45dcaf(0x137)],'type':_0xb43e0f[_0x45dcaf(0x160)],'location':_0xb43e0f[_0x45dcaf(0x136)],'value':_0x332ee9};_0x1e6df1[_0x45dcaf(0x18a)]['unshift'](_0x3fc2ae);if(_0x1e6df1[_0x45dcaf(0x18a)][_0x45dcaf(0x140)]>HISTORY_MAX_SIZE)_0x1e6df1[_0x45dcaf(0x18a)]['pop']();await _0x1e6df1[_0x45dcaf(0x13c)]('events.lastEvent',{'val':JSON['stringify'](_0x3fc2ae),'ack':!![]}),await _0x1e6df1[_0x45dcaf(0x13c)]('events.history',{'val':JSON[_0x45dcaf(0x153)](_0x1e6df1[_0x45dcaf(0x18a)]),'ack':!![]}),await updateHourlyActivity(_0x1e6df1);if(_0x1e6df1['isProVersion']){_0x1e6df1[_0x45dcaf(0x176)]['push'](_0x3fc2ae);if(_0x1e6df1[_0x45dcaf(0x176)][_0x45dcaf(0x140)]>RAW_LOG_MAX_SIZE)_0x1e6df1[_0x45dcaf(0x176)][_0x45dcaf(0x129)](0x0,_0x1e6df1[_0x45dcaf(0x176)][_0x45dcaf(0x140)]-RAW_LOG_MAX_SIZE);await _0x1e6df1[_0x45dcaf(0x13c)](_0x45dcaf(0x167),{'val':JSON['stringify'](_0x1e6df1['rawEventLog']),'ack':!![]}),recordSequence(_0x1e6df1,_0x3fc2ae);}if(_0xb43e0f[_0x45dcaf(0x192)]&&_0x332ee9===!![]){if(_0x1e6df1[_0x45dcaf(0x12c)]&&!_0x1e6df1[_0x45dcaf(0x186)])startExitTimer(_0x1e6df1);else{if(!_0x1e6df1[_0x45dcaf(0x12c)])setPresence(_0x1e6df1,!![]);}}else{if(_0xb43e0f[_0x45dcaf(0x160)]===_0x45dcaf(0x135)&&_0x332ee9===!![]){if(_0x1e6df1[_0x45dcaf(0x15a)])abortExitTimer(_0x1e6df1);if(!_0x1e6df1['isPresent']&&_0x1e6df1['currentSystemMode']===_0x45dcaf(0x194))setPresence(_0x1e6df1,!![]);}}if(_0x1e6df1['isProVersion']&&_0x1e6df1[_0x45dcaf(0x148)]){_0xb43e0f[_0x45dcaf(0x160)]===_0x45dcaf(0x135)&&_0x332ee9===!![]&&_0xb43e0f[_0x45dcaf(0x136)]&&_0x1e6df1[_0x45dcaf(0x148)](_0x45dcaf(0x15b),{'room':_0xb43e0f[_0x45dcaf(0x136)]});const _0x51bb7a=['door',_0x45dcaf(0x165),_0x45dcaf(0x16e),_0x45dcaf(0x141),_0x45dcaf(0x127),_0x45dcaf(0x150),_0x45dcaf(0x178),'schloss'][_0x45dcaf(0x193)](_0x4305eb=>_0x16a165['includes'](_0x4305eb)),_0xe566e6=['light','licht',_0x45dcaf(0x18e),_0x45dcaf(0x179),_0x45dcaf(0x18d),_0x45dcaf(0x198)][_0x45dcaf(0x193)](_0x4dacb4=>_0x16a165[_0x45dcaf(0x183)](_0x4dacb4)),_0x556a2b=[_0x45dcaf(0x135),_0x45dcaf(0x131),_0x45dcaf(0x16a),_0x45dcaf(0x19b),_0x45dcaf(0x149)][_0x45dcaf(0x193)](_0x55aaba=>_0x16a165[_0x45dcaf(0x183)](_0x55aaba));if(_0xb43e0f['location']&&(_0x51bb7a||_0xe566e6||_0x556a2b)){const _0x351835=_0x332ee9===!![]||typeof _0x332ee9===_0x45dcaf(0x172)&&_0x332ee9>0x0,_0x5ad965=_0x51bb7a&&!_0x351835&&_0x19ad3f!==undefined&&_0x19ad3f!=_0x332ee9;if(_0x351835||_0x5ad965){const _0x42a785=_0x1e6df1['lastTrackerEventTime']||_0x5b7606,_0x3eabb4=(_0x5b7606-_0x42a785)/0x3e8;_0x1e6df1[_0x45dcaf(0x19a)]=_0x5b7606,_0x1e6df1[_0x45dcaf(0x148)](_0x45dcaf(0x142),{'room':_0xb43e0f[_0x45dcaf(0x136)],'dt':_0x3eabb4});}}}return _0x3fc2ae;}module[a5_0x23bf6b(0x17a)]={'processSensorEvent':processSensorEvent,'getOutsideTemperatureNumeric':getOutsideTemperatureNumeric,'setPresence':setPresence,'abortExitTimer':abortExitTimer,'startExitTimer':startExitTimer};function a5_0x3146(){const _0x3e91a8=['43604HldjVW','isExit','some','normal','Valve','LTM.trainingData.thermodynamics','toLowerCase','lampe','.1.ACTUAL_TEMPERATURE','lastTrackerEventTime','presence','(((.+)+)+)+$','klima','3031714uvzAUc','kontakt','griff','Unknown','splice','Temperature','debug','isPresent','accuweather','.LEVEL','getStateAsync','replace','bewegung','log','push','parse','motion','location','name','toString','53154PGblea','155YyeeJH','string','setStateAsync','error','useWeather','LTM.trainingData.sequences','length','fenster','TRACK_EVENT','logDuplicates','.1.LEVEL','510424eokLKG','analysis.health.todayVector','STATUS','sendToPythonWrapper','occupancy','now','system.isPresent','7852493UVTLJG','apply','.4.VALVE_STATE','search','handle','fill','shift','stringify','6NicRfW','loc','ANALYZE_SEQUENCE','message','thermostat','weatherInstance','exitTimer','SIMULATE_SIGNAL','4400304VeNZXu','openweathermap','.1.TEMPERATURE','.1.VALVE_STATE','type','contact','from','licht','getHours','tür','value','LTM.rawEventLog','isProVersion','round','präsenz','config','.forecast.current.temp','weatherunderground','window','valveMapping','temperature','237740kyRyhe','number','[RECORDER]\x20Ignored\x20implausible\x20temperature:\x20','530PYVLRF','sensorLastValues','rawEventLog','map','lock','schalter','exports','val','door','exitGraceTimer','.forecast.current.temperature','level','outdoorSensorId','getForeignStateAsync','\x20from\x20','includes','3KDTLvN','daswetter','isGracePeriodActive','LEVEL','[RECORDER]\x20Error:\x20','light','eventHistory','constructor','getDate','dimmer','switch','.Current.Temperature','toISOString'];a5_0x3146=function(){return _0x3e91a8;};return a5_0x3146();}