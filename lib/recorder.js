function a5_0x5d71(){const _0x12759a=['pop','splice','parse','window','LTM.rawEventLog','events.history','length','LTM.trainingData.sequences','events.lastEvent','stringify','fenster','heizung','openweathermap','getForeignStateAsync','accuweather','rawEventLog','daswetter','9ZlyHlo','2926745tAyGTE','isProVersion','useWeather','getStateAsync','apply','loc','normal','error','licht','unshift','switch','message','sendToPythonWrapper','shift','eventHistory','kontakt','schalter','1569805gjzctD','sensorLastValues','6Wspxrs','präsenz','lampe','map','LTM.trainingData.thermodynamics','ANALYZE_SEQUENCE','includes','value','currentSystemMode','door','6997290HrgGYR','now','6873736qGpIdQ','.forecast.current.temperature','.forecast.current.temp','weatherInstance','bewegung','type','round','SIMULATE_SIGNAL','toString','toLowerCase','val','temperature','motion','21193904qqqOtS','presence','klima','isPresent','.NextHours.Location_1.Day_1.current.temp_value','name','486378iDfPED','setStateAsync','search','dimmer','isGracePeriodActive','Unknown','push','exitTimer','exitGraceTimer','location','config','outdoorSensorId','log','(((.+)+)+)+$','10148222CUPnmD'];a5_0x5d71=function(){return _0x12759a;};return a5_0x5d71();}(function(_0x1ab333,_0x5b6473){const _0x222f41=a5_0x1d01,_0x540135=_0x1ab333();while(!![]){try{const _0x71b780=-parseInt(_0x222f41(0x193))/0x1+-parseInt(_0x222f41(0x195))/0x2*(parseInt(_0x222f41(0x1b4))/0x3)+-parseInt(_0x222f41(0x1a1))/0x4+-parseInt(_0x222f41(0x1d5))/0x5+parseInt(_0x222f41(0x19f))/0x6+parseInt(_0x222f41(0x1c2))/0x7+parseInt(_0x222f41(0x1ae))/0x8*(parseInt(_0x222f41(0x1d4))/0x9);if(_0x71b780===_0x5b6473)break;else _0x540135['push'](_0x540135['shift']());}catch(_0x3bd46e){_0x540135['push'](_0x540135['shift']());}}}(a5_0x5d71,0xdd011));const a5_0x17d5dc=(function(){let _0x5d37c8=!![];return function(_0x38c0ed,_0x137983){const _0x70177a=_0x5d37c8?function(){const _0x307989=a5_0x1d01;if(_0x137983){const _0x4d7735=_0x137983[_0x307989(0x1d9)](_0x38c0ed,arguments);return _0x137983=null,_0x4d7735;}}:function(){};return _0x5d37c8=![],_0x70177a;};}()),a5_0x10603d=a5_0x17d5dc(this,function(){const _0x63694a=a5_0x1d01;return a5_0x10603d[_0x63694a(0x1a9)]()[_0x63694a(0x1b6)](_0x63694a(0x1c1))[_0x63694a(0x1a9)]()['constructor'](a5_0x10603d)[_0x63694a(0x1b6)](_0x63694a(0x1c1));});a5_0x10603d();function a5_0x1d01(_0xd82184,_0x3e0808){const _0x44900e=a5_0x5d71();return a5_0x1d01=function(_0x10603d,_0x17d5dc){_0x10603d=_0x10603d-0x192;let _0x5d7127=_0x44900e[_0x10603d];return _0x5d7127;},a5_0x1d01(_0xd82184,_0x3e0808);}'use strict';const HISTORY_MAX_SIZE=0x32,RAW_LOG_MAX_SIZE=0x9c4,THERMO_LOG_SIZE=0x3e8,SEQUENCE_TIMEOUT_MS=0x5*0x3c*0x3e8,MAX_TRAINING_SET_SIZE=0x1f4,EXIT_TIMER_MINUTES=0xf,EXIT_GRACE_PERIOD_SECONDS=0x1e;let activeSequence=[],sequenceTimer=null;async function getOutsideTemperatureNumeric(_0x1232a2){const _0x270e95=a5_0x1d01;if(_0x1232a2['config'][_0x270e95(0x1bf)])try{const _0x1c0145=await _0x1232a2[_0x270e95(0x1d0)](_0x1232a2[_0x270e95(0x1be)][_0x270e95(0x1bf)]);if(_0x1c0145&&_0x1c0145[_0x270e95(0x1ab)]!==undefined&&_0x1c0145[_0x270e95(0x1ab)]!==null)return parseFloat(_0x1c0145[_0x270e95(0x1ab)]);}catch(_0x1ce0fc){}const _0x1173bc=_0x1232a2[_0x270e95(0x1be)][_0x270e95(0x1a4)];if(!_0x1232a2[_0x270e95(0x1be)][_0x270e95(0x1d7)]||!_0x1173bc)return null;try{let _0x51ad65='';if(_0x1173bc[_0x270e95(0x19b)](_0x270e95(0x1d1)))_0x51ad65=_0x1173bc+'.Current.Temperature';else{if(_0x1173bc[_0x270e95(0x19b)](_0x270e95(0x1d3)))_0x51ad65=_0x1173bc+_0x270e95(0x1b2);else{if(_0x1173bc[_0x270e95(0x19b)](_0x270e95(0x1cf)))_0x51ad65=_0x1173bc+_0x270e95(0x1a2);else{if(_0x1173bc[_0x270e95(0x19b)]('weatherunderground'))_0x51ad65=_0x1173bc+_0x270e95(0x1a3);}}}if(_0x51ad65){const _0x2194bc=await _0x1232a2[_0x270e95(0x1d0)](_0x51ad65);if(_0x2194bc&&_0x2194bc['val']!==undefined&&_0x2194bc[_0x270e95(0x1ab)]!==null)return parseFloat(_0x2194bc[_0x270e95(0x1ab)]);}}catch(_0x4b5d11){}return null;}async function recordThermodynamics(_0x13be64,_0x1278ef,_0x43afaf,_0x25c460){const _0x3ddd45=a5_0x1d01,_0x455d1a=await getOutsideTemperatureNumeric(_0x13be64),_0x2a8f50=await _0x13be64[_0x3ddd45(0x1d8)](_0x3ddd45(0x199));let _0x400b4c=[];if(_0x2a8f50&&_0x2a8f50[_0x3ddd45(0x1ab)])try{_0x400b4c=JSON[_0x3ddd45(0x1c5)](_0x2a8f50[_0x3ddd45(0x1ab)]);}catch(_0x13e57c){}_0x400b4c['push']({'ts':Date[_0x3ddd45(0x1a0)](),'room':_0x25c460||'Unknown','t_in':_0x43afaf,'t_out':_0x455d1a});if(_0x400b4c['length']>THERMO_LOG_SIZE)_0x400b4c[_0x3ddd45(0x1e2)]();await _0x13be64[_0x3ddd45(0x1b5)]('LTM.trainingData.thermodynamics',{'val':JSON[_0x3ddd45(0x1cc)](_0x400b4c),'ack':!![]});}async function saveCompletedSequence(_0x5e02f3){const _0x163cb3=a5_0x1d01;try{const _0xb2ff05=await _0x5e02f3[_0x163cb3(0x1d8)](_0x163cb3(0x1ca));let _0x304c91=[];if(_0xb2ff05&&_0xb2ff05[_0x163cb3(0x1ab)])try{_0x304c91=JSON[_0x163cb3(0x1c5)](_0xb2ff05[_0x163cb3(0x1ab)]);}catch(_0x47b706){}const _0x1adf2c=activeSequence[0x0]['ts'],_0x94c9b1=activeSequence[_0x163cb3(0x198)](_0x6bb0d1=>({'loc':_0x6bb0d1[_0x163cb3(0x1da)],'t_delta':Math[_0x163cb3(0x1a7)]((_0x6bb0d1['ts']-_0x1adf2c)/0x3e8)})),_0x7d674e={'timestamp':new Date(_0x1adf2c)['toISOString'](),'steps':_0x94c9b1,'duration':Math['round']((activeSequence[activeSequence[_0x163cb3(0x1c9)]-0x1]['ts']-_0x1adf2c)/0x3e8),'daytime':new Date(_0x1adf2c)['getHours']()};_0x304c91[_0x163cb3(0x1ba)](_0x7d674e);if(_0x304c91['length']>MAX_TRAINING_SET_SIZE)_0x304c91[_0x163cb3(0x1e2)]();await _0x5e02f3['setStateAsync'](_0x163cb3(0x1ca),{'val':JSON[_0x163cb3(0x1cc)](_0x304c91),'ack':!![]}),_0x5e02f3[_0x163cb3(0x1d6)]&&_0x5e02f3[_0x163cb3(0x1e1)]&&_0x5e02f3[_0x163cb3(0x1e1)](_0x163cb3(0x19a),{'sequence':_0x7d674e});}catch(_0x5afe39){_0x5e02f3[_0x163cb3(0x1c0)][_0x163cb3(0x1dc)]('[RECORDER]\x20Error:\x20'+_0x5afe39[_0x163cb3(0x1e0)]);}}async function recordSequence(_0x1ea136,_0xf41ab9){const _0x337d44=a5_0x1d01,_0x466729=(_0xf41ab9[_0x337d44(0x1a6)]||'')[_0x337d44(0x1aa)](),_0x31fe43=[_0x337d44(0x1ad),_0x337d44(0x1a5),_0x337d44(0x196),_0x337d44(0x1af),'occupancy',_0x337d44(0x19e),'tür',_0x337d44(0x1c6),_0x337d44(0x1cd),'contact',_0x337d44(0x1e4),'light',_0x337d44(0x1dd),_0x337d44(0x1df),_0x337d44(0x192),_0x337d44(0x1b7),_0x337d44(0x197)];if(!_0x31fe43['some'](_0x2dda4f=>_0x466729['includes'](_0x2dda4f)))return;if(!_0xf41ab9[_0x337d44(0x19c)])return;if(sequenceTimer)clearTimeout(sequenceTimer);activeSequence[_0x337d44(0x1ba)]({'loc':_0xf41ab9['location']||_0x337d44(0x1b9),'id':_0xf41ab9['id'],'ts':Date[_0x337d44(0x1a0)]()}),sequenceTimer=setTimeout(async()=>{if(activeSequence['length']>0x1)await saveCompletedSequence(_0x1ea136);activeSequence=[];},SEQUENCE_TIMEOUT_MS);}function startExitTimer(_0x2ce6d6){const _0x2246c9=a5_0x1d01;abortExitTimer(_0x2ce6d6),_0x2ce6d6[_0x2246c9(0x1b8)]=!![],_0x2ce6d6[_0x2246c9(0x1bc)]=setTimeout(()=>{const _0x5e81ac=_0x2246c9;_0x2ce6d6[_0x5e81ac(0x1b8)]=![];},EXIT_GRACE_PERIOD_SECONDS*0x3e8),_0x2ce6d6[_0x2246c9(0x1bb)]=setTimeout(()=>{setPresence(_0x2ce6d6,![]),_0x2ce6d6['exitTimer']=null;},EXIT_TIMER_MINUTES*0x3c*0x3e8);}function abortExitTimer(_0x410151){const _0x44b3a0=a5_0x1d01;if(_0x410151[_0x44b3a0(0x1bb)])clearTimeout(_0x410151['exitTimer']);if(_0x410151[_0x44b3a0(0x1bc)])clearTimeout(_0x410151[_0x44b3a0(0x1bc)]);_0x410151['exitTimer']=null,_0x410151[_0x44b3a0(0x1bc)]=null,_0x410151[_0x44b3a0(0x1b8)]=![];}async function setPresence(_0x131959,_0x2e8f40){const _0x42363a=a5_0x1d01;if(_0x131959[_0x42363a(0x1b1)]===_0x2e8f40)return;_0x131959[_0x42363a(0x1b1)]=_0x2e8f40,await _0x131959[_0x42363a(0x1b5)]('system.isPresent',{'val':_0x2e8f40,'ack':!![]});}async function processSensorEvent(_0x415ffc,_0x279344,_0x36832a,_0x230147){const _0x359cb6=a5_0x1d01;if(!_0x230147)return null;const _0xb739bb=_0x36832a[_0x359cb6(0x1ab)],_0x58f7b4=Date['now'](),_0x5bc21f=_0x415ffc[_0x359cb6(0x194)][_0x279344];_0x415ffc[_0x359cb6(0x194)][_0x279344]=_0xb739bb;if(!_0x230147['logDuplicates']&&_0x5bc21f!=undefined&&_0x5bc21f==_0xb739bb)return null;const _0x2c7019=(_0x230147['type']||'')[_0x359cb6(0x1aa)](),_0x4d8d59=_0x2c7019['includes'](_0x359cb6(0x1ac))||_0x2c7019['includes']('temperatur')||_0x2c7019['includes'](_0x359cb6(0x1b0))||_0x2c7019[_0x359cb6(0x19b)](_0x359cb6(0x1ce));_0x415ffc[_0x359cb6(0x1d6)]&&_0x4d8d59&&recordThermodynamics(_0x415ffc,_0x279344,_0xb739bb,_0x230147[_0x359cb6(0x1bd)]);const _0x1c3b23={'timestamp':_0x58f7b4,'id':_0x279344,'name':_0x230147[_0x359cb6(0x1b3)],'type':_0x230147['type'],'location':_0x230147[_0x359cb6(0x1bd)],'value':_0xb739bb};_0x415ffc[_0x359cb6(0x1e3)][_0x359cb6(0x1de)](_0x1c3b23);if(_0x415ffc[_0x359cb6(0x1e3)][_0x359cb6(0x1c9)]>HISTORY_MAX_SIZE)_0x415ffc['eventHistory'][_0x359cb6(0x1c3)]();await _0x415ffc[_0x359cb6(0x1b5)](_0x359cb6(0x1cb),{'val':JSON[_0x359cb6(0x1cc)](_0x1c3b23),'ack':!![]}),await _0x415ffc[_0x359cb6(0x1b5)](_0x359cb6(0x1c8),{'val':JSON[_0x359cb6(0x1cc)](_0x415ffc[_0x359cb6(0x1e3)]),'ack':!![]});if(_0x415ffc[_0x359cb6(0x1d6)]){_0x415ffc[_0x359cb6(0x1d2)][_0x359cb6(0x1ba)](_0x1c3b23);if(_0x415ffc[_0x359cb6(0x1d2)][_0x359cb6(0x1c9)]>RAW_LOG_MAX_SIZE)_0x415ffc[_0x359cb6(0x1d2)][_0x359cb6(0x1c4)](0x0,_0x415ffc[_0x359cb6(0x1d2)][_0x359cb6(0x1c9)]-RAW_LOG_MAX_SIZE);await _0x415ffc[_0x359cb6(0x1b5)](_0x359cb6(0x1c7),{'val':JSON['stringify'](_0x415ffc['rawEventLog']),'ack':!![]}),recordSequence(_0x415ffc,_0x1c3b23);}if(_0x230147['isExit']&&_0xb739bb===!![]){if(_0x415ffc[_0x359cb6(0x1b1)]&&!_0x415ffc[_0x359cb6(0x1b8)])startExitTimer(_0x415ffc);else{if(!_0x415ffc[_0x359cb6(0x1b1)])setPresence(_0x415ffc,!![]);}}else{if(_0x230147[_0x359cb6(0x1a6)]===_0x359cb6(0x1ad)&&_0xb739bb===!![]){if(_0x415ffc[_0x359cb6(0x1bb)])abortExitTimer(_0x415ffc);if(!_0x415ffc[_0x359cb6(0x1b1)]&&_0x415ffc[_0x359cb6(0x19d)]===_0x359cb6(0x1db))setPresence(_0x415ffc,!![]);}}return _0x415ffc['isProVersion']&&_0x230147[_0x359cb6(0x1a6)]===_0x359cb6(0x1ad)&&_0xb739bb===!![]&&_0x230147['location']&&_0x415ffc['sendToPythonWrapper']&&_0x415ffc[_0x359cb6(0x1e1)](_0x359cb6(0x1a8),{'room':_0x230147['location']}),_0x1c3b23;}module['exports']={'processSensorEvent':processSensorEvent,'getOutsideTemperatureNumeric':getOutsideTemperatureNumeric,'setPresence':setPresence,'abortExitTimer':abortExitTimer,'startExitTimer':startExitTimer};