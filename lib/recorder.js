function a5_0x4f55(_0x4af019,_0x2f2a63){const _0x4713c9=a5_0x170e();return a5_0x4f55=function(_0x38539d,_0x3111a0){_0x38539d=_0x38539d-0x1cf;let _0x170ee2=_0x4713c9[_0x38539d];return _0x170ee2;},a5_0x4f55(_0x4af019,_0x2f2a63);}const a5_0x149375=a5_0x4f55;(function(_0x384e1b,_0x41b06d){const _0x202bff=a5_0x4f55,_0x2b8e9a=_0x384e1b();while(!![]){try{const _0x58a5a9=parseInt(_0x202bff(0x21f))/0x1+-parseInt(_0x202bff(0x22d))/0x2+-parseInt(_0x202bff(0x21e))/0x3*(parseInt(_0x202bff(0x1d3))/0x4)+-parseInt(_0x202bff(0x204))/0x5+parseInt(_0x202bff(0x207))/0x6*(-parseInt(_0x202bff(0x222))/0x7)+parseInt(_0x202bff(0x1d5))/0x8+-parseInt(_0x202bff(0x1f4))/0x9*(-parseInt(_0x202bff(0x1d6))/0xa);if(_0x58a5a9===_0x41b06d)break;else _0x2b8e9a['push'](_0x2b8e9a['shift']());}catch(_0x12d6a4){_0x2b8e9a['push'](_0x2b8e9a['shift']());}}}(a5_0x170e,0xc3ebd));const a5_0x3111a0=(function(){let _0x1b4a6c=!![];return function(_0x55d95b,_0x2145f0){const _0x5917d6=_0x1b4a6c?function(){if(_0x2145f0){const _0x2f5cde=_0x2145f0['apply'](_0x55d95b,arguments);return _0x2145f0=null,_0x2f5cde;}}:function(){};return _0x1b4a6c=![],_0x5917d6;};}()),a5_0x38539d=a5_0x3111a0(this,function(){const _0x1c56ab=a5_0x4f55;return a5_0x38539d['toString']()[_0x1c56ab(0x224)](_0x1c56ab(0x237))[_0x1c56ab(0x20f)]()[_0x1c56ab(0x1e3)](a5_0x38539d)['search'](_0x1c56ab(0x237));});a5_0x38539d();'use strict';const HISTORY_MAX_SIZE=0x32,RAW_LOG_MAX_SIZE=0x9c4,THERMO_LOG_SIZE=0x3e8,SEQUENCE_TIMEOUT_MS=0x5*0x3c*0x3e8,MAX_TRAINING_SET_SIZE=0x1f4,EXIT_TIMER_MINUTES=0xf,EXIT_GRACE_PERIOD_SECONDS=0x1e;let activeSequence=[],sequenceTimer=null;async function getOutsideTemperatureNumeric(_0x36f668){const _0x9638d0=a5_0x4f55;if(_0x36f668[_0x9638d0(0x1d4)][_0x9638d0(0x1df)])try{const _0x267750=await _0x36f668[_0x9638d0(0x1e6)](_0x36f668[_0x9638d0(0x1d4)][_0x9638d0(0x1df)]);if(_0x267750&&_0x267750['val']!==undefined&&_0x267750[_0x9638d0(0x1f6)]!==null)return parseFloat(_0x267750['val']);}catch(_0x28ea6b){}const _0x14e9f7=_0x36f668['config'][_0x9638d0(0x223)];if(!_0x36f668[_0x9638d0(0x1d4)]['useWeather']||!_0x14e9f7)return null;try{let _0x53960d='';if(_0x14e9f7[_0x9638d0(0x1fd)]('accuweather'))_0x53960d=_0x14e9f7+_0x9638d0(0x231);else{if(_0x14e9f7[_0x9638d0(0x1fd)](_0x9638d0(0x1f5)))_0x53960d=_0x14e9f7+_0x9638d0(0x230);else{if(_0x14e9f7[_0x9638d0(0x1fd)]('openweathermap'))_0x53960d=_0x14e9f7+_0x9638d0(0x1cf);else{if(_0x14e9f7[_0x9638d0(0x1fd)](_0x9638d0(0x22b)))_0x53960d=_0x14e9f7+_0x9638d0(0x221);}}}if(_0x53960d){const _0x46182c=await _0x36f668['getForeignStateAsync'](_0x53960d);if(_0x46182c&&_0x46182c[_0x9638d0(0x1f6)]!==undefined&&_0x46182c['val']!==null)return parseFloat(_0x46182c[_0x9638d0(0x1f6)]);}}catch(_0x344d11){}return null;}async function recordThermodynamics(_0x24c05e,_0x280a09,_0x5e4c74,_0xd0d676){const _0x3be16b=a5_0x4f55,_0xeaea3d=await getOutsideTemperatureNumeric(_0x24c05e);if(_0xeaea3d===null)return;let _0x50307e=0x0,_0x5b9771=![];if(_0x24c05e[_0x3be16b(0x1d4)][_0x3be16b(0x1fa)])try{let _0x220fe8=_0x24c05e[_0x3be16b(0x1d4)]['valveMapping'];if(typeof _0x220fe8===_0x3be16b(0x203))_0x220fe8=JSON[_0x3be16b(0x1d9)](_0x220fe8);if(_0x220fe8[_0x280a09]){const _0x295146=_0x220fe8[_0x280a09],_0xeba0b2=await _0x24c05e[_0x3be16b(0x1e6)](_0x295146);if(_0xeba0b2&&_0xeba0b2[_0x3be16b(0x1f6)]!==null&&_0xeba0b2[_0x3be16b(0x1f6)]!==undefined){let _0x581568=Number(_0xeba0b2[_0x3be16b(0x1f6)]);if(_0x581568<=1.05&&!_0x295146['includes']('STATUS')&&!_0x295146['includes'](_0x3be16b(0x22c)))_0x581568=_0x581568*0x64;_0x50307e=Math[_0x3be16b(0x1d2)](_0x581568),_0x5b9771=!![];}}}catch(_0x112c9a){}if(!_0x5b9771){const _0x4debfb=[{'from':'.1.ACTUAL_TEMPERATURE','to':'.1.LEVEL'},{'from':'.1.ACTUAL_TEMPERATURE','to':_0x3be16b(0x1dd)},{'from':'.1.TEMPERATURE','to':_0x3be16b(0x201)},{'from':'.ACTUAL_TEMPERATURE','to':_0x3be16b(0x1fb)},{'from':_0x3be16b(0x235),'to':_0x3be16b(0x200)},{'from':_0x3be16b(0x20b),'to':_0x3be16b(0x218)}];for(const _0x568756 of _0x4debfb){if(_0x280a09[_0x3be16b(0x1fd)](_0x568756[_0x3be16b(0x220)])){const _0x407ada=_0x280a09[_0x3be16b(0x21b)](_0x568756[_0x3be16b(0x220)],_0x568756['to']);try{const _0x63b288=await _0x24c05e[_0x3be16b(0x1e6)](_0x407ada);if(_0x63b288&&_0x63b288[_0x3be16b(0x1f6)]!==null&&_0x63b288[_0x3be16b(0x1f6)]!==undefined){let _0x353790=Number(_0x63b288[_0x3be16b(0x1f6)]);if(typeof _0x353790===_0x3be16b(0x206)){if(_0x353790<=1.05&&_0x568756['to']['includes'](_0x3be16b(0x1e9)))_0x353790=_0x353790*0x64;_0x50307e=Math[_0x3be16b(0x1d2)](_0x353790),_0x5b9771=!![];break;}}}catch(_0x4b2f97){}}}}const _0x302c0f=await _0x24c05e[_0x3be16b(0x202)](_0x3be16b(0x226));let _0x5d22ce=[];if(_0x302c0f&&_0x302c0f[_0x3be16b(0x1f6)])try{_0x5d22ce=JSON[_0x3be16b(0x1d9)](_0x302c0f[_0x3be16b(0x1f6)]);}catch(_0x84203f){}_0x5d22ce[_0x3be16b(0x238)]({'ts':Date[_0x3be16b(0x219)](),'room':_0xd0d676||_0x3be16b(0x227),'t_in':_0x5e4c74,'t_out':_0xeaea3d,'valve':_0x50307e});if(_0x5d22ce[_0x3be16b(0x1ea)]>THERMO_LOG_SIZE)_0x5d22ce[_0x3be16b(0x1f7)]();await _0x24c05e['setStateAsync'](_0x3be16b(0x226),{'val':JSON[_0x3be16b(0x233)](_0x5d22ce),'ack':!![]});}async function saveCompletedSequence(_0x19c80e){const _0x31cc77=a5_0x4f55;try{const _0x1f4e59=await _0x19c80e[_0x31cc77(0x202)](_0x31cc77(0x1f8));let _0x30a8d9=[];if(_0x1f4e59&&_0x1f4e59[_0x31cc77(0x1f6)])try{_0x30a8d9=JSON[_0x31cc77(0x1d9)](_0x1f4e59['val']);}catch(_0x1b677a){}const _0x1c0d1f=activeSequence[0x0]['ts'],_0x1cbdde=activeSequence[_0x31cc77(0x1eb)](_0x45f537=>({'loc':_0x45f537[_0x31cc77(0x210)],'t_delta':Math[_0x31cc77(0x1d2)]((_0x45f537['ts']-_0x1c0d1f)/0x3e8)})),_0x48c374={'timestamp':new Date(_0x1c0d1f)[_0x31cc77(0x1f2)](),'steps':_0x1cbdde,'duration':Math['round']((activeSequence[activeSequence[_0x31cc77(0x1ea)]-0x1]['ts']-_0x1c0d1f)/0x3e8),'daytime':new Date(_0x1c0d1f)['getHours']()};_0x30a8d9[_0x31cc77(0x238)](_0x48c374);if(_0x30a8d9['length']>MAX_TRAINING_SET_SIZE)_0x30a8d9[_0x31cc77(0x1f7)]();await _0x19c80e[_0x31cc77(0x1fc)](_0x31cc77(0x1f8),{'val':JSON[_0x31cc77(0x233)](_0x30a8d9),'ack':!![]}),_0x19c80e[_0x31cc77(0x211)]&&_0x19c80e[_0x31cc77(0x1f0)]&&_0x19c80e[_0x31cc77(0x1f0)]('ANALYZE_SEQUENCE',{'sequence':_0x48c374});}catch(_0x3640e0){_0x19c80e['log'][_0x31cc77(0x1f3)]('[RECORDER]\x20Error:\x20'+_0x3640e0[_0x31cc77(0x20c)]);}}async function recordSequence(_0x39c0c2,_0x1482b4){const _0x433f99=a5_0x4f55,_0x104463=(_0x1482b4[_0x433f99(0x22a)]||'')[_0x433f99(0x22e)](),_0x2e66a5=[_0x433f99(0x236),_0x433f99(0x1e1),'präsenz',_0x433f99(0x1d8),'occupancy',_0x433f99(0x234),_0x433f99(0x212),'window',_0x433f99(0x217),_0x433f99(0x1dc),'kontakt',_0x433f99(0x205),_0x433f99(0x21a),_0x433f99(0x232),_0x433f99(0x1ed),_0x433f99(0x1ef),_0x433f99(0x208)];if(!_0x2e66a5[_0x433f99(0x228)](_0x10e9c8=>_0x104463[_0x433f99(0x1fd)](_0x10e9c8)))return;if(!_0x1482b4[_0x433f99(0x1f1)])return;if(sequenceTimer)clearTimeout(sequenceTimer);activeSequence[_0x433f99(0x238)]({'loc':_0x1482b4[_0x433f99(0x1e7)]||_0x433f99(0x227),'id':_0x1482b4['id'],'ts':Date[_0x433f99(0x219)]()}),sequenceTimer=setTimeout(async()=>{const _0x21171d=_0x433f99;if(activeSequence[_0x21171d(0x1ea)]>0x1)await saveCompletedSequence(_0x39c0c2);activeSequence=[];},SEQUENCE_TIMEOUT_MS);}function startExitTimer(_0x2d6f12){const _0x4e0e08=a5_0x4f55;abortExitTimer(_0x2d6f12),_0x2d6f12['isGracePeriodActive']=!![],_0x2d6f12['exitGraceTimer']=setTimeout(()=>{const _0x34228e=a5_0x4f55;_0x2d6f12[_0x34228e(0x1e8)]=![];},EXIT_GRACE_PERIOD_SECONDS*0x3e8),_0x2d6f12[_0x4e0e08(0x20a)]=setTimeout(()=>{const _0x4b2db0=_0x4e0e08;setPresence(_0x2d6f12,![]),_0x2d6f12[_0x4b2db0(0x20a)]=null;},EXIT_TIMER_MINUTES*0x3c*0x3e8);}function abortExitTimer(_0x37b521){const _0x16977e=a5_0x4f55;if(_0x37b521['exitTimer'])clearTimeout(_0x37b521[_0x16977e(0x20a)]);if(_0x37b521[_0x16977e(0x1e0)])clearTimeout(_0x37b521[_0x16977e(0x1e0)]);_0x37b521['exitTimer']=null,_0x37b521['exitGraceTimer']=null,_0x37b521['isGracePeriodActive']=![];}async function setPresence(_0x4e713a,_0x3cab0b){const _0x393c36=a5_0x4f55;if(_0x4e713a[_0x393c36(0x1de)]===_0x3cab0b)return;_0x4e713a['isPresent']=_0x3cab0b,await _0x4e713a['setStateAsync'](_0x393c36(0x20d),{'val':_0x3cab0b,'ack':!![]});}function a5_0x170e(){const _0x225001=['getStateAsync','string','678175iLsUvz','light','number','1356CSUFTP','lampe','events.lastEvent','exitTimer','Temperature','message','system.isPresent','window','toString','loc','isProVersion','tür','isExit','lastTrackerEventTime','debug','rawEventLog','fenster','Valve','now','licht','replace','präsenz','TRACK_EVENT','18BcZzNB','1294807LgJBQX','from','.forecast.current.temp','42938CvByya','weatherInstance','search','temperatur','LTM.trainingData.thermodynamics','Unknown','some','handle','type','weatherunderground','STATE','1253658SPLbmq','toLowerCase','lock','.NextHours.Location_1.Day_1.current.temp_value','.Current.Temperature','switch','stringify','door','temperature','motion','(((.+)+)+)+$','push','.forecast.current.temperature','exports','griff','round','119144Jzynie','config','9924368SiwAsC','5946040GHRWXL','sensorLastValues','presence','parse','logDuplicates','fill','contact','.1.VALVE_STATE','isPresent','outdoorSensorId','exitGraceTimer','bewegung','analysis.health.todayVector','constructor','eventHistory','LTM.rawEventLog','getForeignStateAsync','location','isGracePeriodActive','LEVEL','length','map','log','schalter','currentSystemMode','dimmer','sendToPythonWrapper','value','toISOString','error','9JxqmOd','daswetter','val','shift','LTM.trainingData.sequences','klima','valveMapping','.LEVEL','setStateAsync','includes','thermostat','getHours','level','.4.VALVE_STATE'];a5_0x170e=function(){return _0x225001;};return a5_0x170e();}async function updateHourlyActivity(_0x3195f0){const _0x237ef6=a5_0x4f55;let _0x4a59f0=new Array(0x18)['fill'](0x0),_0x57684a=0x0;try{const _0x105dde=await _0x3195f0[_0x237ef6(0x202)](_0x237ef6(0x1e2));_0x105dde&&_0x105dde[_0x237ef6(0x1f6)]&&(_0x4a59f0=JSON['parse'](_0x105dde[_0x237ef6(0x1f6)]),_0x57684a=_0x105dde['ts']);}catch(_0x43f283){}const _0x5d11b4=new Date(_0x57684a),_0x3496d0=new Date();_0x5d11b4['getDate']()!==_0x3496d0['getDate']()&&(_0x4a59f0=new Array(0x18)[_0x237ef6(0x1db)](0x0));const _0x488811=_0x3496d0[_0x237ef6(0x1ff)]();if(_0x4a59f0[_0x488811]===undefined)_0x4a59f0[_0x488811]=0x0;_0x4a59f0[_0x488811]++,await _0x3195f0['setStateAsync'](_0x237ef6(0x1e2),{'val':JSON[_0x237ef6(0x233)](_0x4a59f0),'ack':!![]});}async function processSensorEvent(_0x44483b,_0x47af5e,_0x29db0e,_0x4e0159){const _0x50b699=a5_0x4f55;if(!_0x4e0159)return null;const _0x506864=_0x29db0e[_0x50b699(0x1f6)],_0x56bb1f=Date['now'](),_0x2fd2a8=_0x44483b[_0x50b699(0x1d7)][_0x47af5e],_0x53be87=(_0x4e0159['type']||'')[_0x50b699(0x22e)](),_0x860589=_0x53be87['includes']('temperature')||_0x53be87[_0x50b699(0x1fd)](_0x50b699(0x225))||_0x53be87[_0x50b699(0x1fd)](_0x50b699(0x1f9))||_0x53be87[_0x50b699(0x1fd)]('heizung')||_0x53be87[_0x50b699(0x1fd)](_0x50b699(0x1fe));if(_0x860589&&typeof _0x506864===_0x50b699(0x206)){if(_0x506864>0x50||_0x506864<-0x32)return _0x44483b[_0x50b699(0x1ec)][_0x50b699(0x215)]('[RECORDER]\x20Ignored\x20implausible\x20temperature:\x20'+_0x506864+'\x20from\x20'+_0x47af5e),null;}_0x44483b['sensorLastValues'][_0x47af5e]=_0x506864;if(!_0x4e0159[_0x50b699(0x1da)]&&_0x2fd2a8!=undefined&&_0x2fd2a8==_0x506864)return null;_0x44483b[_0x50b699(0x211)]&&_0x860589&&recordThermodynamics(_0x44483b,_0x47af5e,_0x506864,_0x4e0159[_0x50b699(0x1e7)]);const _0x46350c={'timestamp':_0x56bb1f,'id':_0x47af5e,'name':_0x4e0159['name'],'type':_0x4e0159['type'],'location':_0x4e0159[_0x50b699(0x1e7)],'value':_0x506864};_0x44483b[_0x50b699(0x1e4)]['unshift'](_0x46350c);if(_0x44483b['eventHistory'][_0x50b699(0x1ea)]>HISTORY_MAX_SIZE)_0x44483b[_0x50b699(0x1e4)]['pop']();await _0x44483b[_0x50b699(0x1fc)](_0x50b699(0x209),{'val':JSON[_0x50b699(0x233)](_0x46350c),'ack':!![]}),await _0x44483b['setStateAsync']('events.history',{'val':JSON[_0x50b699(0x233)](_0x44483b[_0x50b699(0x1e4)]),'ack':!![]}),await updateHourlyActivity(_0x44483b);if(_0x44483b[_0x50b699(0x211)]){_0x44483b[_0x50b699(0x216)][_0x50b699(0x238)](_0x46350c);if(_0x44483b['rawEventLog']['length']>RAW_LOG_MAX_SIZE)_0x44483b['rawEventLog']['splice'](0x0,_0x44483b[_0x50b699(0x216)][_0x50b699(0x1ea)]-RAW_LOG_MAX_SIZE);await _0x44483b['setStateAsync'](_0x50b699(0x1e5),{'val':JSON[_0x50b699(0x233)](_0x44483b['rawEventLog']),'ack':!![]}),recordSequence(_0x44483b,_0x46350c);}if(_0x4e0159[_0x50b699(0x213)]&&_0x506864===!![]){if(_0x44483b['isPresent']&&!_0x44483b['isGracePeriodActive'])startExitTimer(_0x44483b);else{if(!_0x44483b['isPresent'])setPresence(_0x44483b,!![]);}}else{if(_0x4e0159[_0x50b699(0x22a)]===_0x50b699(0x236)&&_0x506864===!![]){if(_0x44483b[_0x50b699(0x20a)])abortExitTimer(_0x44483b);if(!_0x44483b[_0x50b699(0x1de)]&&_0x44483b[_0x50b699(0x1ee)]==='normal')setPresence(_0x44483b,!![]);}}if(_0x44483b[_0x50b699(0x211)]&&_0x44483b[_0x50b699(0x1f0)]){_0x4e0159[_0x50b699(0x22a)]==='motion'&&_0x506864===!![]&&_0x4e0159['location']&&_0x44483b[_0x50b699(0x1f0)]('SIMULATE_SIGNAL',{'room':_0x4e0159['location']});const _0x2ef862=[_0x50b699(0x234),_0x50b699(0x212),_0x50b699(0x20e),_0x50b699(0x217),_0x50b699(0x1d1),_0x50b699(0x229),_0x50b699(0x22f),'schloss'][_0x50b699(0x228)](_0x1ef292=>_0x53be87['includes'](_0x1ef292)),_0x3db6d6=['light',_0x50b699(0x21a),_0x50b699(0x232),'schalter','dimmer',_0x50b699(0x208)][_0x50b699(0x228)](_0x40c5b7=>_0x53be87[_0x50b699(0x1fd)](_0x40c5b7)),_0x2904c4=['motion',_0x50b699(0x1e1),_0x50b699(0x21c),'presence','occupancy'][_0x50b699(0x228)](_0x30a279=>_0x53be87[_0x50b699(0x1fd)](_0x30a279));if(_0x4e0159[_0x50b699(0x1e7)]&&(_0x2ef862||_0x3db6d6||_0x2904c4)){const _0x168080=_0x506864===!![]||typeof _0x506864==='number'&&_0x506864>0x0,_0x1a7bec=_0x2ef862&&!_0x168080&&_0x2fd2a8!==undefined&&_0x2fd2a8!=_0x506864;if(_0x168080||_0x1a7bec){const _0x5ead45=_0x44483b[_0x50b699(0x214)]||_0x56bb1f,_0x6fb858=(_0x56bb1f-_0x5ead45)/0x3e8;_0x44483b[_0x50b699(0x214)]=_0x56bb1f,_0x44483b[_0x50b699(0x1f0)](_0x50b699(0x21d),{'room':_0x4e0159[_0x50b699(0x1e7)],'dt':_0x6fb858});}}}return _0x46350c;}module[a5_0x149375(0x1d0)]={'processSensorEvent':processSensorEvent,'getOutsideTemperatureNumeric':getOutsideTemperatureNumeric,'setPresence':setPresence,'abortExitTimer':abortExitTimer,'startExitTimer':startExitTimer};