const a5_0x594d8b=a5_0x812e;(function(_0x1b19e1,_0x4e0309){const _0x45b31f=a5_0x812e,_0x29c093=_0x1b19e1();while(!![]){try{const _0x9f5ad3=parseInt(_0x45b31f(0x10c))/0x1*(parseInt(_0x45b31f(0xe7))/0x2)+parseInt(_0x45b31f(0xec))/0x3+-parseInt(_0x45b31f(0xfe))/0x4*(parseInt(_0x45b31f(0xef))/0x5)+parseInt(_0x45b31f(0x109))/0x6*(parseInt(_0x45b31f(0xd8))/0x7)+parseInt(_0x45b31f(0xc8))/0x8*(-parseInt(_0x45b31f(0xf1))/0x9)+parseInt(_0x45b31f(0xd6))/0xa*(-parseInt(_0x45b31f(0xed))/0xb)+-parseInt(_0x45b31f(0xc1))/0xc*(-parseInt(_0x45b31f(0xfc))/0xd);if(_0x9f5ad3===_0x4e0309)break;else _0x29c093['push'](_0x29c093['shift']());}catch(_0x4c30ac){_0x29c093['push'](_0x29c093['shift']());}}}(a5_0x31ed,0x35c3f));const a5_0x75dc5d=(function(){let _0x4cf83b=!![];return function(_0x4aa627,_0x43f637){const _0x590f1b=_0x4cf83b?function(){if(_0x43f637){const _0x40f2b6=_0x43f637['apply'](_0x4aa627,arguments);return _0x43f637=null,_0x40f2b6;}}:function(){};return _0x4cf83b=![],_0x590f1b;};}()),a5_0x9bba45=a5_0x75dc5d(this,function(){const _0x5c795e=a5_0x812e;return a5_0x9bba45[_0x5c795e(0x112)]()[_0x5c795e(0x102)](_0x5c795e(0xf3))[_0x5c795e(0x112)]()[_0x5c795e(0xcc)](a5_0x9bba45)['search'](_0x5c795e(0xf3));});a5_0x9bba45();'use strict';const HISTORY_MAX_SIZE=0x32,RAW_LOG_MAX_SIZE=0x9c4,THERMO_LOG_SIZE=0x3e8,SEQUENCE_TIMEOUT_MS=0x5*0x3c*0x3e8,MAX_TRAINING_SET_SIZE=0x1f4,EXIT_TIMER_MINUTES=0xf,EXIT_GRACE_PERIOD_SECONDS=0x1e;let activeSequence=[],sequenceTimer=null;function a5_0x31ed(){const _0x5b1d72=['message','klima','logDuplicates','13VbiewT','toISOString','118492iqvTTh','push','toLowerCase','[RECORDER]\x20Error:\x20','search','LTM.rawEventLog','some','splice','LTM.trainingData.thermodynamics','loc','getStateAsync','1566822KTvkii','licht','isPresent','41OeUxYr','schalter','map','.Current.Temperature','tür','eventHistory','toString','occupancy','exitGraceTimer','unshift','5291256ZDoent','currentSystemMode','heizung','weatherunderground','events.history','isGracePeriodActive','val','8pMZvOr','parse','ANALYZE_SEQUENCE','exports','constructor','name','exitTimer','pop','location','switch','lampe','sensorLastValues','stringify','outdoorSensorId','504050ruBTip','weatherInstance','7soZBla','shift','light','fenster','sendToPythonWrapper','getHours','events.lastEvent','config','length','getForeignStateAsync','SIMULATE_SIGNAL','Unknown','temperature','motion','daswetter','6666CoMuJc','.forecast.current.temperature','round','window','type','5682PqKdUF','55LJFfUQ','error','50mSdlVb','log','649296WAFDGs','setStateAsync','(((.+)+)+)+$','isProVersion','now','includes','rawEventLog','LTM.trainingData.sequences'];a5_0x31ed=function(){return _0x5b1d72;};return a5_0x31ed();}async function getOutsideTemperatureNumeric(_0x4348ee){const _0x724550=a5_0x812e;if(_0x4348ee[_0x724550(0xdf)][_0x724550(0xd5)])try{const _0x55350f=await _0x4348ee[_0x724550(0xe1)](_0x4348ee[_0x724550(0xdf)]['outdoorSensorId']);if(_0x55350f&&_0x55350f[_0x724550(0xc7)]!==undefined&&_0x55350f['val']!==null)return parseFloat(_0x55350f[_0x724550(0xc7)]);}catch(_0x15bb1e){}const _0x10bcdd=_0x4348ee[_0x724550(0xdf)][_0x724550(0xd7)];if(!_0x4348ee['config']['useWeather']||!_0x10bcdd)return null;try{let _0xb2bda3='';if(_0x10bcdd[_0x724550(0xf6)]('accuweather'))_0xb2bda3=_0x10bcdd+_0x724550(0x10f);else{if(_0x10bcdd[_0x724550(0xf6)](_0x724550(0xe6)))_0xb2bda3=_0x10bcdd+'.NextHours.Location_1.Day_1.current.temp_value';else{if(_0x10bcdd['includes']('openweathermap'))_0xb2bda3=_0x10bcdd+_0x724550(0xe8);else{if(_0x10bcdd[_0x724550(0xf6)](_0x724550(0xc4)))_0xb2bda3=_0x10bcdd+'.forecast.current.temp';}}}if(_0xb2bda3){const _0x338d34=await _0x4348ee[_0x724550(0xe1)](_0xb2bda3);if(_0x338d34&&_0x338d34['val']!==undefined&&_0x338d34[_0x724550(0xc7)]!==null)return parseFloat(_0x338d34[_0x724550(0xc7)]);}}catch(_0x72bdda){}return null;}async function recordThermodynamics(_0x2e6761,_0x31a3a3,_0x193a19,_0x3c46bb){const _0x56d9f2=a5_0x812e,_0x556fc4=await getOutsideTemperatureNumeric(_0x2e6761),_0x5a77c4=await _0x2e6761[_0x56d9f2(0x108)](_0x56d9f2(0x106));let _0x4c3a61=[];if(_0x5a77c4&&_0x5a77c4['val'])try{_0x4c3a61=JSON[_0x56d9f2(0xc9)](_0x5a77c4[_0x56d9f2(0xc7)]);}catch(_0x53bc95){}_0x4c3a61['push']({'ts':Date[_0x56d9f2(0xf5)](),'room':_0x3c46bb||_0x56d9f2(0xe3),'t_in':_0x193a19,'t_out':_0x556fc4});if(_0x4c3a61[_0x56d9f2(0xe0)]>THERMO_LOG_SIZE)_0x4c3a61[_0x56d9f2(0xd9)]();await _0x2e6761['setStateAsync']('LTM.trainingData.thermodynamics',{'val':JSON[_0x56d9f2(0xd4)](_0x4c3a61),'ack':!![]});}async function saveCompletedSequence(_0x1ea9a8){const _0xd4d8d8=a5_0x812e;try{const _0x1bc98=await _0x1ea9a8['getStateAsync'](_0xd4d8d8(0xf8));let _0x3200ed=[];if(_0x1bc98&&_0x1bc98[_0xd4d8d8(0xc7)])try{_0x3200ed=JSON[_0xd4d8d8(0xc9)](_0x1bc98[_0xd4d8d8(0xc7)]);}catch(_0x3633e1){}const _0x3b6192=activeSequence[0x0]['ts'],_0xddeaf4=activeSequence[_0xd4d8d8(0x10e)](_0x4cd9d7=>({'loc':_0x4cd9d7[_0xd4d8d8(0x107)],'t_delta':Math['round']((_0x4cd9d7['ts']-_0x3b6192)/0x3e8)})),_0x3dca1a={'timestamp':new Date(_0x3b6192)[_0xd4d8d8(0xfd)](),'steps':_0xddeaf4,'duration':Math[_0xd4d8d8(0xe9)]((activeSequence[activeSequence[_0xd4d8d8(0xe0)]-0x1]['ts']-_0x3b6192)/0x3e8),'daytime':new Date(_0x3b6192)[_0xd4d8d8(0xdd)]()};_0x3200ed['push'](_0x3dca1a);if(_0x3200ed[_0xd4d8d8(0xe0)]>MAX_TRAINING_SET_SIZE)_0x3200ed[_0xd4d8d8(0xd9)]();await _0x1ea9a8[_0xd4d8d8(0xf2)]('LTM.trainingData.sequences',{'val':JSON['stringify'](_0x3200ed),'ack':!![]}),_0x1ea9a8[_0xd4d8d8(0xf4)]&&_0x1ea9a8['sendToPythonWrapper']&&_0x1ea9a8[_0xd4d8d8(0xdc)](_0xd4d8d8(0xca),{'sequence':_0x3dca1a});}catch(_0x1a093c){_0x1ea9a8[_0xd4d8d8(0xf0)][_0xd4d8d8(0xee)](_0xd4d8d8(0x101)+_0x1a093c[_0xd4d8d8(0xf9)]);}}async function recordSequence(_0x1806db,_0x1afe99){const _0x3ef239=a5_0x812e,_0x10139a=(_0x1afe99[_0x3ef239(0xeb)]||'')[_0x3ef239(0x100)](),_0x4d6dad=[_0x3ef239(0xe5),'bewegung','präsenz','presence',_0x3ef239(0x113),'door',_0x3ef239(0x110),_0x3ef239(0xea),_0x3ef239(0xdb),'contact','kontakt',_0x3ef239(0xda),_0x3ef239(0x10a),_0x3ef239(0xd1),_0x3ef239(0x10d),'dimmer',_0x3ef239(0xd2)];if(!_0x4d6dad[_0x3ef239(0x104)](_0x1ad559=>_0x10139a[_0x3ef239(0xf6)](_0x1ad559)))return;if(!_0x1afe99['value'])return;if(sequenceTimer)clearTimeout(sequenceTimer);activeSequence[_0x3ef239(0xff)]({'loc':_0x1afe99['location']||'Unknown','id':_0x1afe99['id'],'ts':Date[_0x3ef239(0xf5)]()}),sequenceTimer=setTimeout(async()=>{if(activeSequence['length']>0x1)await saveCompletedSequence(_0x1806db);activeSequence=[];},SEQUENCE_TIMEOUT_MS);}function startExitTimer(_0x1e08e9){const _0x417018=a5_0x812e;abortExitTimer(_0x1e08e9),_0x1e08e9[_0x417018(0xc6)]=!![],_0x1e08e9[_0x417018(0x114)]=setTimeout(()=>{_0x1e08e9['isGracePeriodActive']=![];},EXIT_GRACE_PERIOD_SECONDS*0x3e8),_0x1e08e9[_0x417018(0xce)]=setTimeout(()=>{const _0x36110b=_0x417018;setPresence(_0x1e08e9,![]),_0x1e08e9[_0x36110b(0xce)]=null;},EXIT_TIMER_MINUTES*0x3c*0x3e8);}function abortExitTimer(_0x1f4627){const _0x2fa615=a5_0x812e;if(_0x1f4627[_0x2fa615(0xce)])clearTimeout(_0x1f4627[_0x2fa615(0xce)]);if(_0x1f4627[_0x2fa615(0x114)])clearTimeout(_0x1f4627[_0x2fa615(0x114)]);_0x1f4627[_0x2fa615(0xce)]=null,_0x1f4627[_0x2fa615(0x114)]=null,_0x1f4627[_0x2fa615(0xc6)]=![];}async function setPresence(_0x574281,_0x502d72){const _0x38a893=a5_0x812e;if(_0x574281['isPresent']===_0x502d72)return;_0x574281[_0x38a893(0x10b)]=_0x502d72,await _0x574281[_0x38a893(0xf2)]('system.isPresent',{'val':_0x502d72,'ack':!![]});}async function processSensorEvent(_0x1c80e0,_0x4db2b4,_0x3542c0,_0x3ad30f){const _0x306e87=a5_0x812e;if(!_0x3ad30f)return null;const _0x518a56=_0x3542c0[_0x306e87(0xc7)],_0x4c4261=Date[_0x306e87(0xf5)](),_0x2b91cd=_0x1c80e0['sensorLastValues'][_0x4db2b4];_0x1c80e0[_0x306e87(0xd3)][_0x4db2b4]=_0x518a56;if(!_0x3ad30f[_0x306e87(0xfb)]&&_0x2b91cd!=undefined&&_0x2b91cd==_0x518a56)return null;const _0x569dc6=(_0x3ad30f[_0x306e87(0xeb)]||'')['toLowerCase'](),_0x1a25a5=_0x569dc6[_0x306e87(0xf6)](_0x306e87(0xe4))||_0x569dc6[_0x306e87(0xf6)]('temperatur')||_0x569dc6['includes'](_0x306e87(0xfa))||_0x569dc6[_0x306e87(0xf6)](_0x306e87(0xc3));_0x1c80e0[_0x306e87(0xf4)]&&_0x1a25a5&&recordThermodynamics(_0x1c80e0,_0x4db2b4,_0x518a56,_0x3ad30f[_0x306e87(0xd0)]);const _0x23d0d6={'timestamp':_0x4c4261,'id':_0x4db2b4,'name':_0x3ad30f[_0x306e87(0xcd)],'type':_0x3ad30f['type'],'location':_0x3ad30f[_0x306e87(0xd0)],'value':_0x518a56};_0x1c80e0[_0x306e87(0x111)][_0x306e87(0x115)](_0x23d0d6);if(_0x1c80e0[_0x306e87(0x111)][_0x306e87(0xe0)]>HISTORY_MAX_SIZE)_0x1c80e0[_0x306e87(0x111)][_0x306e87(0xcf)]();await _0x1c80e0['setStateAsync'](_0x306e87(0xde),{'val':JSON[_0x306e87(0xd4)](_0x23d0d6),'ack':!![]}),await _0x1c80e0[_0x306e87(0xf2)](_0x306e87(0xc5),{'val':JSON['stringify'](_0x1c80e0[_0x306e87(0x111)]),'ack':!![]});if(_0x1c80e0[_0x306e87(0xf4)]){_0x1c80e0['rawEventLog'][_0x306e87(0xff)](_0x23d0d6);if(_0x1c80e0[_0x306e87(0xf7)][_0x306e87(0xe0)]>RAW_LOG_MAX_SIZE)_0x1c80e0[_0x306e87(0xf7)][_0x306e87(0x105)](0x0,_0x1c80e0[_0x306e87(0xf7)][_0x306e87(0xe0)]-RAW_LOG_MAX_SIZE);await _0x1c80e0[_0x306e87(0xf2)](_0x306e87(0x103),{'val':JSON['stringify'](_0x1c80e0[_0x306e87(0xf7)]),'ack':!![]}),recordSequence(_0x1c80e0,_0x23d0d6);}if(_0x3ad30f['isExit']&&_0x518a56===!![]){if(_0x1c80e0['isPresent']&&!_0x1c80e0[_0x306e87(0xc6)])startExitTimer(_0x1c80e0);else{if(!_0x1c80e0[_0x306e87(0x10b)])setPresence(_0x1c80e0,!![]);}}else{if(_0x3ad30f[_0x306e87(0xeb)]===_0x306e87(0xe5)&&_0x518a56===!![]){if(_0x1c80e0['exitTimer'])abortExitTimer(_0x1c80e0);if(!_0x1c80e0['isPresent']&&_0x1c80e0[_0x306e87(0xc2)]==='normal')setPresence(_0x1c80e0,!![]);}}return _0x1c80e0[_0x306e87(0xf4)]&&_0x3ad30f[_0x306e87(0xeb)]===_0x306e87(0xe5)&&_0x518a56===!![]&&_0x3ad30f[_0x306e87(0xd0)]&&_0x1c80e0[_0x306e87(0xdc)]&&_0x1c80e0[_0x306e87(0xdc)](_0x306e87(0xe2),{'room':_0x3ad30f['location']}),_0x23d0d6;}function a5_0x812e(_0x392b26,_0x34ff16){const _0xd51ec6=a5_0x31ed();return a5_0x812e=function(_0x9bba45,_0x75dc5d){_0x9bba45=_0x9bba45-0xc1;let _0x31ed00=_0xd51ec6[_0x9bba45];return _0x31ed00;},a5_0x812e(_0x392b26,_0x34ff16);}module[a5_0x594d8b(0xcb)]={'processSensorEvent':processSensorEvent,'getOutsideTemperatureNumeric':getOutsideTemperatureNumeric,'setPresence':setPresence,'abortExitTimer':abortExitTimer,'startExitTimer':startExitTimer};