function a5_0x44f4(_0x372a25,_0x31ba31){const _0x3751f1=a5_0x1af5();return a5_0x44f4=function(_0x138d24,_0x4cf1dd){_0x138d24=_0x138d24-0xda;let _0x1af5f1=_0x3751f1[_0x138d24];return _0x1af5f1;},a5_0x44f4(_0x372a25,_0x31ba31);}const a5_0x5020fb=a5_0x44f4;(function(_0xf9c731,_0x3c4c23){const _0x37aae6=a5_0x44f4,_0x1afc1a=_0xf9c731();while(!![]){try{const _0x4e23fa=parseInt(_0x37aae6(0xe6))/0x1+parseInt(_0x37aae6(0x107))/0x2+parseInt(_0x37aae6(0x137))/0x3*(-parseInt(_0x37aae6(0xe0))/0x4)+-parseInt(_0x37aae6(0x10b))/0x5*(-parseInt(_0x37aae6(0x11c))/0x6)+-parseInt(_0x37aae6(0x12a))/0x7+-parseInt(_0x37aae6(0xdd))/0x8+-parseInt(_0x37aae6(0xe3))/0x9*(parseInt(_0x37aae6(0x117))/0xa);if(_0x4e23fa===_0x3c4c23)break;else _0x1afc1a['push'](_0x1afc1a['shift']());}catch(_0x10f2ae){_0x1afc1a['push'](_0x1afc1a['shift']());}}}(a5_0x1af5,0xa5579));const a5_0x4cf1dd=(function(){let _0x5dd33a=!![];return function(_0x424d3,_0x4e12bb){const _0x528717=_0x5dd33a?function(){const _0x1d13c8=a5_0x44f4;if(_0x4e12bb){const _0xcd344e=_0x4e12bb[_0x1d13c8(0x142)](_0x424d3,arguments);return _0x4e12bb=null,_0xcd344e;}}:function(){};return _0x5dd33a=![],_0x528717;};}()),a5_0x138d24=a5_0x4cf1dd(this,function(){const _0x43ac6b=a5_0x44f4;return a5_0x138d24[_0x43ac6b(0xf3)]()[_0x43ac6b(0x13e)](_0x43ac6b(0x112))['toString']()[_0x43ac6b(0xfe)](a5_0x138d24)[_0x43ac6b(0x13e)](_0x43ac6b(0x112));});a5_0x138d24();'use strict';const HISTORY_MAX_SIZE=0x32,RAW_LOG_MAX_SIZE=0x9c4,THERMO_LOG_SIZE=0x3e8,SEQUENCE_TIMEOUT_MS=0x5*0x3c*0x3e8,MAX_TRAINING_SET_SIZE=0x1f4,EXIT_TIMER_MINUTES=0xf,EXIT_GRACE_PERIOD_SECONDS=0x1e;let activeSequence=[],sequenceTimer=null;async function getOutsideTemperatureNumeric(_0x4270a3){const _0x60a254=a5_0x44f4;if(_0x4270a3[_0x60a254(0x126)][_0x60a254(0x11b)])try{const _0x169706=await _0x4270a3[_0x60a254(0x10c)](_0x4270a3[_0x60a254(0x126)][_0x60a254(0x11b)]);if(_0x169706&&_0x169706[_0x60a254(0xfb)]!==undefined&&_0x169706[_0x60a254(0xfb)]!==null)return parseFloat(_0x169706[_0x60a254(0xfb)]);}catch(_0x4284ea){}const _0x22cd8e=_0x4270a3[_0x60a254(0x126)][_0x60a254(0x10a)];if(!_0x4270a3[_0x60a254(0x126)][_0x60a254(0xdc)]||!_0x22cd8e)return null;try{let _0x1736ec='';if(_0x22cd8e['includes']('accuweather'))_0x1736ec=_0x22cd8e+_0x60a254(0x12e);else{if(_0x22cd8e[_0x60a254(0x11a)]('daswetter'))_0x1736ec=_0x22cd8e+_0x60a254(0x102);else{if(_0x22cd8e[_0x60a254(0x11a)](_0x60a254(0x122)))_0x1736ec=_0x22cd8e+_0x60a254(0xf1);else{if(_0x22cd8e['includes']('weatherunderground'))_0x1736ec=_0x22cd8e+'.forecast.current.temp';}}}if(_0x1736ec){const _0x20433f=await _0x4270a3['getForeignStateAsync'](_0x1736ec);if(_0x20433f&&_0x20433f[_0x60a254(0xfb)]!==undefined&&_0x20433f['val']!==null)return parseFloat(_0x20433f[_0x60a254(0xfb)]);}}catch(_0x4a6bf8){}return null;}async function recordThermodynamics(_0x136114,_0x79120b,_0x5db847,_0x110cfa){const _0x8decaa=a5_0x44f4,_0x269188=await getOutsideTemperatureNumeric(_0x136114);if(_0x269188===null)return;let _0x5c6d28=0x0,_0x5b2792=![];if(_0x136114['config'][_0x8decaa(0x110)])try{let _0x3927bc=_0x136114[_0x8decaa(0x126)]['valveMapping'];if(typeof _0x3927bc===_0x8decaa(0xe4))_0x3927bc=JSON[_0x8decaa(0x124)](_0x3927bc);if(_0x3927bc[_0x79120b]){const _0x475474=_0x3927bc[_0x79120b],_0x1a97f3=await _0x136114[_0x8decaa(0x10c)](_0x475474);if(_0x1a97f3&&_0x1a97f3['val']!==null&&_0x1a97f3[_0x8decaa(0xfb)]!==undefined){let _0x4e8e29=Number(_0x1a97f3['val']);if(_0x4e8e29<=1.05&&!_0x475474['includes']('STATUS')&&!_0x475474['includes'](_0x8decaa(0x13c)))_0x4e8e29=_0x4e8e29*0x64;_0x5c6d28=Math['round'](_0x4e8e29),_0x5b2792=!![];}}}catch(_0x2a6208){}if(!_0x5b2792){const _0x694b90=[{'from':_0x8decaa(0x10d),'to':_0x8decaa(0x140)},{'from':_0x8decaa(0x10d),'to':'.1.VALVE_STATE'},{'from':_0x8decaa(0x144),'to':'.4.VALVE_STATE'},{'from':_0x8decaa(0xf0),'to':_0x8decaa(0x12f)},{'from':_0x8decaa(0xfc),'to':'level'},{'from':_0x8decaa(0xe8),'to':'Valve'}];for(const _0x127195 of _0x694b90){if(_0x79120b[_0x8decaa(0x11a)](_0x127195['from'])){const _0x5e08e0=_0x79120b[_0x8decaa(0x11f)](_0x127195[_0x8decaa(0x119)],_0x127195['to']);try{const _0x1f812a=await _0x136114['getForeignStateAsync'](_0x5e08e0);if(_0x1f812a&&_0x1f812a[_0x8decaa(0xfb)]!==null&&_0x1f812a[_0x8decaa(0xfb)]!==undefined){let _0x16fdce=Number(_0x1f812a[_0x8decaa(0xfb)]);if(typeof _0x16fdce===_0x8decaa(0xec)){if(_0x16fdce<=1.05&&_0x127195['to'][_0x8decaa(0x11a)](_0x8decaa(0xee)))_0x16fdce=_0x16fdce*0x64;_0x5c6d28=Math['round'](_0x16fdce),_0x5b2792=!![];break;}}}catch(_0x54e046){}}}}const _0xc342f4=await _0x136114[_0x8decaa(0x106)]('LTM.trainingData.thermodynamics');let _0x180208=[];if(_0xc342f4&&_0xc342f4[_0x8decaa(0xfb)])try{_0x180208=JSON[_0x8decaa(0x124)](_0xc342f4['val']);}catch(_0x4087fa){}_0x180208['push']({'ts':Date[_0x8decaa(0x145)](),'room':_0x110cfa||'Unknown','t_in':_0x5db847,'t_out':_0x269188,'valve':_0x5c6d28});if(_0x180208['length']>THERMO_LOG_SIZE)_0x180208[_0x8decaa(0x136)]();await _0x136114['setStateAsync']('LTM.trainingData.thermodynamics',{'val':JSON[_0x8decaa(0xeb)](_0x180208),'ack':!![]});}async function saveCompletedSequence(_0x2334fc){const _0x502fd8=a5_0x44f4;try{const _0x1917cc=await _0x2334fc['getStateAsync'](_0x502fd8(0x131));let _0x1c7735=[];if(_0x1917cc&&_0x1917cc[_0x502fd8(0xfb)])try{_0x1c7735=JSON[_0x502fd8(0x124)](_0x1917cc[_0x502fd8(0xfb)]);}catch(_0xe09b2){}const _0x235fdc=activeSequence[0x0]['ts'],_0x4eccc3=activeSequence['map'](_0x34bd7d=>({'loc':_0x34bd7d[_0x502fd8(0xe9)],'t_delta':Math[_0x502fd8(0x103)]((_0x34bd7d['ts']-_0x235fdc)/0x3e8)})),_0x3d96ca={'timestamp':new Date(_0x235fdc)[_0x502fd8(0xf7)](),'steps':_0x4eccc3,'duration':Math[_0x502fd8(0x103)]((activeSequence[activeSequence['length']-0x1]['ts']-_0x235fdc)/0x3e8),'daytime':new Date(_0x235fdc)[_0x502fd8(0x134)]()};_0x1c7735[_0x502fd8(0x108)](_0x3d96ca);if(_0x1c7735[_0x502fd8(0x109)]>MAX_TRAINING_SET_SIZE)_0x1c7735['shift']();await _0x2334fc[_0x502fd8(0xfa)](_0x502fd8(0x131),{'val':JSON[_0x502fd8(0xeb)](_0x1c7735),'ack':!![]}),_0x2334fc[_0x502fd8(0x139)]&&_0x2334fc[_0x502fd8(0xff)]&&_0x2334fc[_0x502fd8(0xff)](_0x502fd8(0xef),{'sequence':_0x3d96ca});}catch(_0x1e3e9e){_0x2334fc[_0x502fd8(0xf4)][_0x502fd8(0xe7)](_0x502fd8(0x133)+_0x1e3e9e[_0x502fd8(0x12b)]);}}async function recordSequence(_0xb5446c,_0x567f03){const _0x3f2ce4=a5_0x44f4,_0x52b9d7=(_0x567f03['type']||'')[_0x3f2ce4(0x104)](),_0x4e7f5c=[_0x3f2ce4(0xe5),_0x3f2ce4(0x114),'präsenz','presence',_0x3f2ce4(0x105),'door',_0x3f2ce4(0xf8),'window',_0x3f2ce4(0xf9),'contact',_0x3f2ce4(0x123),_0x3f2ce4(0x115),_0x3f2ce4(0x125),_0x3f2ce4(0x12c),'schalter',_0x3f2ce4(0x120),_0x3f2ce4(0x129)];if(!_0x4e7f5c[_0x3f2ce4(0x111)](_0x3f7f9=>_0x52b9d7['includes'](_0x3f7f9)))return;if(!_0x567f03[_0x3f2ce4(0x141)])return;if(sequenceTimer)clearTimeout(sequenceTimer);activeSequence[_0x3f2ce4(0x108)]({'loc':_0x567f03[_0x3f2ce4(0x100)]||_0x3f2ce4(0xe2),'id':_0x567f03['id'],'ts':Date['now']()}),sequenceTimer=setTimeout(async()=>{const _0x140e95=_0x3f2ce4;if(activeSequence[_0x140e95(0x109)]>0x1)await saveCompletedSequence(_0xb5446c);activeSequence=[];},SEQUENCE_TIMEOUT_MS);}function startExitTimer(_0x1397ab){const _0x4f62b2=a5_0x44f4;abortExitTimer(_0x1397ab),_0x1397ab[_0x4f62b2(0x128)]=!![],_0x1397ab[_0x4f62b2(0x13d)]=setTimeout(()=>{_0x1397ab['isGracePeriodActive']=![];},EXIT_GRACE_PERIOD_SECONDS*0x3e8),_0x1397ab['exitTimer']=setTimeout(()=>{setPresence(_0x1397ab,![]),_0x1397ab['exitTimer']=null;},EXIT_TIMER_MINUTES*0x3c*0x3e8);}function abortExitTimer(_0x19a6a5){const _0x2a3b56=a5_0x44f4;if(_0x19a6a5[_0x2a3b56(0xea)])clearTimeout(_0x19a6a5[_0x2a3b56(0xea)]);if(_0x19a6a5[_0x2a3b56(0x13d)])clearTimeout(_0x19a6a5['exitGraceTimer']);_0x19a6a5[_0x2a3b56(0xea)]=null,_0x19a6a5[_0x2a3b56(0x13d)]=null,_0x19a6a5[_0x2a3b56(0x128)]=![];}async function setPresence(_0x37a118,_0x5b81ed){const _0x390129=a5_0x44f4;if(_0x37a118[_0x390129(0x116)]===_0x5b81ed)return;_0x37a118['isPresent']=_0x5b81ed,await _0x37a118[_0x390129(0xfa)]('system.isPresent',{'val':_0x5b81ed,'ack':!![]});}function a5_0x1af5(){const _0x3da2da=['schloss','Unknown','108bHWGac','string','motion','596697bFGNwt','error','Temperature','loc','exitTimer','stringify','number','lastTrackerEventTime','LEVEL','ANALYZE_SEQUENCE','.ACTUAL_TEMPERATURE','.forecast.current.temperature','lock','toString','log','griff','temperatur','toISOString','tür','fenster','setStateAsync','val','temperature','[RECORDER]\x20Ignored\x20implausible\x20temperature:\x20','constructor','sendToPythonWrapper','location','heizung','.NextHours.Location_1.Day_1.current.temp_value','round','toLowerCase','occupancy','getStateAsync','1770396bDqHks','push','length','weatherInstance','360355HfkoET','getForeignStateAsync','.1.ACTUAL_TEMPERATURE','normal','events.lastEvent','valveMapping','some','(((.+)+)+)+$','rawEventLog','bewegung','light','isPresent','800390QJztBY','unshift','from','includes','outdoorSensorId','102HpENJh','name','eventHistory','replace','dimmer','schalter','openweathermap','kontakt','parse','licht','config','SIMULATE_SIGNAL','isGracePeriodActive','lampe','5053937VTymAn','message','switch','isExit','.Current.Temperature','.LEVEL','exports','LTM.trainingData.sequences','presence','[RECORDER]\x20Error:\x20','getHours','klima','shift','13563vIwRzK','type','isProVersion','debug','splice','STATE','exitGraceTimer','search','TRACK_EVENT','.1.LEVEL','value','apply','logDuplicates','.1.TEMPERATURE','now','window','\x20from\x20','useWeather','1223992TlkQvL','door','präsenz','172iLHHpM'];a5_0x1af5=function(){return _0x3da2da;};return a5_0x1af5();}async function processSensorEvent(_0x3f2dca,_0x2ed0fc,_0x147701,_0x28c245){const _0x550982=a5_0x44f4;if(!_0x28c245)return null;const _0x15f1a8=_0x147701[_0x550982(0xfb)],_0x4b854e=Date[_0x550982(0x145)](),_0xc58d89=_0x3f2dca['sensorLastValues'][_0x2ed0fc],_0x47bf46=(_0x28c245[_0x550982(0x138)]||'')[_0x550982(0x104)](),_0x333491=_0x47bf46[_0x550982(0x11a)](_0x550982(0xfc))||_0x47bf46[_0x550982(0x11a)](_0x550982(0xf6))||_0x47bf46['includes'](_0x550982(0x135))||_0x47bf46[_0x550982(0x11a)](_0x550982(0x101))||_0x47bf46[_0x550982(0x11a)]('thermostat');if(_0x333491&&typeof _0x15f1a8==='number'){if(_0x15f1a8>0x50||_0x15f1a8<-0x32)return _0x3f2dca[_0x550982(0xf4)][_0x550982(0x13a)](_0x550982(0xfd)+_0x15f1a8+_0x550982(0xdb)+_0x2ed0fc),null;}_0x3f2dca['sensorLastValues'][_0x2ed0fc]=_0x15f1a8;if(!_0x28c245[_0x550982(0x143)]&&_0xc58d89!=undefined&&_0xc58d89==_0x15f1a8)return null;_0x3f2dca[_0x550982(0x139)]&&_0x333491&&recordThermodynamics(_0x3f2dca,_0x2ed0fc,_0x15f1a8,_0x28c245[_0x550982(0x100)]);const _0xddc1a5={'timestamp':_0x4b854e,'id':_0x2ed0fc,'name':_0x28c245[_0x550982(0x11d)],'type':_0x28c245[_0x550982(0x138)],'location':_0x28c245[_0x550982(0x100)],'value':_0x15f1a8};_0x3f2dca[_0x550982(0x11e)][_0x550982(0x118)](_0xddc1a5);if(_0x3f2dca[_0x550982(0x11e)][_0x550982(0x109)]>HISTORY_MAX_SIZE)_0x3f2dca['eventHistory']['pop']();await _0x3f2dca[_0x550982(0xfa)](_0x550982(0x10f),{'val':JSON[_0x550982(0xeb)](_0xddc1a5),'ack':!![]}),await _0x3f2dca[_0x550982(0xfa)]('events.history',{'val':JSON['stringify'](_0x3f2dca[_0x550982(0x11e)]),'ack':!![]});if(_0x3f2dca[_0x550982(0x139)]){_0x3f2dca[_0x550982(0x113)]['push'](_0xddc1a5);if(_0x3f2dca['rawEventLog'][_0x550982(0x109)]>RAW_LOG_MAX_SIZE)_0x3f2dca[_0x550982(0x113)][_0x550982(0x13b)](0x0,_0x3f2dca[_0x550982(0x113)][_0x550982(0x109)]-RAW_LOG_MAX_SIZE);await _0x3f2dca[_0x550982(0xfa)]('LTM.rawEventLog',{'val':JSON['stringify'](_0x3f2dca[_0x550982(0x113)]),'ack':!![]}),recordSequence(_0x3f2dca,_0xddc1a5);}if(_0x28c245[_0x550982(0x12d)]&&_0x15f1a8===!![]){if(_0x3f2dca[_0x550982(0x116)]&&!_0x3f2dca[_0x550982(0x128)])startExitTimer(_0x3f2dca);else{if(!_0x3f2dca[_0x550982(0x116)])setPresence(_0x3f2dca,!![]);}}else{if(_0x28c245[_0x550982(0x138)]===_0x550982(0xe5)&&_0x15f1a8===!![]){if(_0x3f2dca[_0x550982(0xea)])abortExitTimer(_0x3f2dca);if(!_0x3f2dca[_0x550982(0x116)]&&_0x3f2dca['currentSystemMode']===_0x550982(0x10e))setPresence(_0x3f2dca,!![]);}}if(_0x3f2dca[_0x550982(0x139)]&&_0x3f2dca['sendToPythonWrapper']){_0x28c245[_0x550982(0x138)]===_0x550982(0xe5)&&_0x15f1a8===!![]&&_0x28c245[_0x550982(0x100)]&&_0x3f2dca[_0x550982(0xff)](_0x550982(0x127),{'room':_0x28c245['location']});const _0x3e5140=[_0x550982(0xde),_0x550982(0xf8),_0x550982(0xda),_0x550982(0xf9),_0x550982(0xf5),'handle',_0x550982(0xf2),_0x550982(0xe1)][_0x550982(0x111)](_0xaa1f7f=>_0x47bf46[_0x550982(0x11a)](_0xaa1f7f)),_0x1cf580=[_0x550982(0x115),_0x550982(0x125),'switch',_0x550982(0x121),'dimmer',_0x550982(0x129)][_0x550982(0x111)](_0x4267e2=>_0x47bf46[_0x550982(0x11a)](_0x4267e2)),_0x4d5d22=[_0x550982(0xe5),_0x550982(0x114),_0x550982(0xdf),_0x550982(0x132),_0x550982(0x105)]['some'](_0x181a52=>_0x47bf46['includes'](_0x181a52));if(_0x28c245[_0x550982(0x100)]&&(_0x3e5140||_0x1cf580||_0x4d5d22)){const _0x50bc57=_0x15f1a8===!![]||typeof _0x15f1a8===_0x550982(0xec)&&_0x15f1a8>0x0,_0x13b5eb=_0x3e5140&&!_0x50bc57&&_0xc58d89!==undefined&&_0xc58d89!=_0x15f1a8;if(_0x50bc57||_0x13b5eb){const _0x48cd13=_0x3f2dca[_0x550982(0xed)]||_0x4b854e,_0x1b6a11=(_0x4b854e-_0x48cd13)/0x3e8;_0x3f2dca[_0x550982(0xed)]=_0x4b854e,_0x3f2dca[_0x550982(0xff)](_0x550982(0x13f),{'room':_0x28c245[_0x550982(0x100)],'dt':_0x1b6a11});}}}return _0xddc1a5;}module[a5_0x5020fb(0x130)]={'processSensorEvent':processSensorEvent,'getOutsideTemperatureNumeric':getOutsideTemperatureNumeric,'setPresence':setPresence,'abortExitTimer':abortExitTimer,'startExitTimer':startExitTimer};