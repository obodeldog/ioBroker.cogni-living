const a5_0x3a61c8=a5_0x3138;(function(_0x378b4c,_0x1ca8bc){const _0xd6d140=a5_0x3138,_0x303d54=_0x378b4c();while(!![]){try{const _0x400506=parseInt(_0xd6d140(0x19a))/0x1+-parseInt(_0xd6d140(0x187))/0x2*(parseInt(_0xd6d140(0x19b))/0x3)+parseInt(_0xd6d140(0x18c))/0x4+-parseInt(_0xd6d140(0x179))/0x5+-parseInt(_0xd6d140(0x17a))/0x6*(-parseInt(_0xd6d140(0x180))/0x7)+-parseInt(_0xd6d140(0x181))/0x8+parseInt(_0xd6d140(0x197))/0x9;if(_0x400506===_0x1ca8bc)break;else _0x303d54['push'](_0x303d54['shift']());}catch(_0x9b9a5c){_0x303d54['push'](_0x303d54['shift']());}}}(a5_0x56ef,0x9230d));const a5_0x4f3e99=(function(){let _0x1c0b14=!![];return function(_0x86aae3,_0xd07c35){const _0x45112a=_0x1c0b14?function(){const _0x2b5743=a5_0x3138;if(_0xd07c35){const _0xcd5042=_0xd07c35[_0x2b5743(0x15f)](_0x86aae3,arguments);return _0xd07c35=null,_0xcd5042;}}:function(){};return _0x1c0b14=![],_0x45112a;};}()),a5_0x70a162=a5_0x4f3e99(this,function(){const _0x2dd2d3=a5_0x3138;return a5_0x70a162[_0x2dd2d3(0x194)]()[_0x2dd2d3(0x192)](_0x2dd2d3(0x190))['toString']()[_0x2dd2d3(0x1aa)](a5_0x70a162)[_0x2dd2d3(0x192)](_0x2dd2d3(0x190));});function a5_0x3138(_0x3eb15e,_0x21d9c5){const _0x4276f1=a5_0x56ef();return a5_0x3138=function(_0x70a162,_0x4f3e99){_0x70a162=_0x70a162-0x15d;let _0x56ef67=_0x4276f1[_0x70a162];return _0x56ef67;},a5_0x3138(_0x3eb15e,_0x21d9c5);}a5_0x70a162();'use strict';const HISTORY_MAX_SIZE=0x32,RAW_LOG_MAX_SIZE=0x9c4,THERMO_LOG_SIZE=0x3e8,SEQUENCE_TIMEOUT_MS=0x5*0x3c*0x3e8,MAX_TRAINING_SET_SIZE=0x1f4,EXIT_TIMER_MINUTES=0xf,EXIT_GRACE_PERIOD_SECONDS=0x1e;let activeSequence=[],sequenceTimer=null;async function getOutsideTemperatureNumeric(_0x214487){const _0x4d2d0a=a5_0x3138;if(_0x214487['config'][_0x4d2d0a(0x1a6)])try{const _0x26cabc=await _0x214487[_0x4d2d0a(0x1a9)](_0x214487[_0x4d2d0a(0x1b9)][_0x4d2d0a(0x1a6)]);if(_0x26cabc&&_0x26cabc[_0x4d2d0a(0x1a0)]!==undefined&&_0x26cabc[_0x4d2d0a(0x1a0)]!==null)return parseFloat(_0x26cabc[_0x4d2d0a(0x1a0)]);}catch(_0x17011b){}const _0x558910=_0x214487['config'][_0x4d2d0a(0x1b3)];if(!_0x214487[_0x4d2d0a(0x1b9)][_0x4d2d0a(0x1c5)]||!_0x558910)return null;try{let _0x5138bb='';if(_0x558910['includes']('accuweather'))_0x5138bb=_0x558910+_0x4d2d0a(0x1c0);else{if(_0x558910[_0x4d2d0a(0x166)]('daswetter'))_0x5138bb=_0x558910+_0x4d2d0a(0x1c4);else{if(_0x558910[_0x4d2d0a(0x166)]('openweathermap'))_0x5138bb=_0x558910+_0x4d2d0a(0x1b8);else{if(_0x558910[_0x4d2d0a(0x166)]('weatherunderground'))_0x5138bb=_0x558910+'.forecast.current.temp';}}}if(_0x5138bb){const _0x44fc37=await _0x214487[_0x4d2d0a(0x1a9)](_0x5138bb);if(_0x44fc37&&_0x44fc37[_0x4d2d0a(0x1a0)]!==undefined&&_0x44fc37[_0x4d2d0a(0x1a0)]!==null)return parseFloat(_0x44fc37[_0x4d2d0a(0x1a0)]);}}catch(_0x34d634){}return null;}async function recordThermodynamics(_0x31be1c,_0x335083,_0x358d49,_0x55c821){const _0x9a499d=a5_0x3138,_0x4815db=await getOutsideTemperatureNumeric(_0x31be1c);if(_0x4815db===null)return;let _0x566d79=0x0,_0x5ebb3d=![];if(_0x31be1c[_0x9a499d(0x1b9)][_0x9a499d(0x186)])try{let _0x2c8b3b=_0x31be1c[_0x9a499d(0x1b9)][_0x9a499d(0x186)];if(typeof _0x2c8b3b===_0x9a499d(0x1ad))_0x2c8b3b=JSON[_0x9a499d(0x164)](_0x2c8b3b);if(_0x2c8b3b[_0x335083]){const _0x56750b=_0x2c8b3b[_0x335083],_0x2d37df=await _0x31be1c[_0x9a499d(0x1a9)](_0x56750b);if(_0x2d37df&&_0x2d37df[_0x9a499d(0x1a0)]!==null&&_0x2d37df[_0x9a499d(0x1a0)]!==undefined){let _0x5391f5=Number(_0x2d37df[_0x9a499d(0x1a0)]);if(_0x5391f5<=1.05&&!_0x56750b[_0x9a499d(0x166)](_0x9a499d(0x1b4))&&!_0x56750b[_0x9a499d(0x166)](_0x9a499d(0x183)))_0x5391f5=_0x5391f5*0x64;_0x566d79=Math['round'](_0x5391f5),_0x5ebb3d=!![];}}}catch(_0x3e770b){}if(!_0x5ebb3d){const _0x2b0ced=[{'from':_0x9a499d(0x199),'to':_0x9a499d(0x17e)},{'from':_0x9a499d(0x199),'to':_0x9a499d(0x18f)},{'from':_0x9a499d(0x177),'to':'.4.VALVE_STATE'},{'from':_0x9a499d(0x1b0),'to':_0x9a499d(0x15e)},{'from':_0x9a499d(0x174),'to':_0x9a499d(0x19f)},{'from':_0x9a499d(0x173),'to':_0x9a499d(0x17d)}];for(const _0x10a9e5 of _0x2b0ced){if(_0x335083[_0x9a499d(0x166)](_0x10a9e5['from'])){const _0x2c8fd1=_0x335083[_0x9a499d(0x1c3)](_0x10a9e5['from'],_0x10a9e5['to']);try{const _0x528e68=await _0x31be1c[_0x9a499d(0x1a9)](_0x2c8fd1);if(_0x528e68&&_0x528e68[_0x9a499d(0x1a0)]!==null&&_0x528e68[_0x9a499d(0x1a0)]!==undefined){let _0x4110d1=Number(_0x528e68[_0x9a499d(0x1a0)]);if(typeof _0x4110d1===_0x9a499d(0x19c)){if(_0x4110d1<=1.05&&_0x10a9e5['to']['includes']('LEVEL'))_0x4110d1=_0x4110d1*0x64;_0x566d79=Math[_0x9a499d(0x1bd)](_0x4110d1),_0x5ebb3d=!![];break;}}}catch(_0x1ce6a2){}}}}const _0x40dc45=await _0x31be1c[_0x9a499d(0x19e)](_0x9a499d(0x175));let _0xb7a791=[];if(_0x40dc45&&_0x40dc45[_0x9a499d(0x1a0)])try{_0xb7a791=JSON[_0x9a499d(0x164)](_0x40dc45[_0x9a499d(0x1a0)]);}catch(_0x4d1d0a){}_0xb7a791[_0x9a499d(0x1bf)]({'ts':Date[_0x9a499d(0x16b)](),'room':_0x55c821||_0x9a499d(0x1a1),'t_in':_0x358d49,'t_out':_0x4815db,'valve':_0x566d79});if(_0xb7a791[_0x9a499d(0x196)]>THERMO_LOG_SIZE)_0xb7a791['shift']();await _0x31be1c[_0x9a499d(0x163)](_0x9a499d(0x175),{'val':JSON[_0x9a499d(0x191)](_0xb7a791),'ack':!![]});}async function saveCompletedSequence(_0x15e7b7){const _0x3bbe4b=a5_0x3138;try{const _0x5825cd=await _0x15e7b7[_0x3bbe4b(0x19e)](_0x3bbe4b(0x172));let _0x54bafd=[];if(_0x5825cd&&_0x5825cd[_0x3bbe4b(0x1a0)])try{_0x54bafd=JSON[_0x3bbe4b(0x164)](_0x5825cd[_0x3bbe4b(0x1a0)]);}catch(_0x4e2635){}const _0x4ae7b7=activeSequence[0x0]['ts'],_0xe8cb78=activeSequence[_0x3bbe4b(0x1c8)](_0xcfaee7=>({'loc':_0xcfaee7[_0x3bbe4b(0x185)],'t_delta':Math['round']((_0xcfaee7['ts']-_0x4ae7b7)/0x3e8)})),_0x151214={'timestamp':new Date(_0x4ae7b7)['toISOString'](),'steps':_0xe8cb78,'duration':Math[_0x3bbe4b(0x1bd)]((activeSequence[activeSequence[_0x3bbe4b(0x196)]-0x1]['ts']-_0x4ae7b7)/0x3e8),'daytime':new Date(_0x4ae7b7)[_0x3bbe4b(0x17b)]()};_0x54bafd[_0x3bbe4b(0x1bf)](_0x151214);if(_0x54bafd['length']>MAX_TRAINING_SET_SIZE)_0x54bafd[_0x3bbe4b(0x16e)]();await _0x15e7b7[_0x3bbe4b(0x163)](_0x3bbe4b(0x172),{'val':JSON[_0x3bbe4b(0x191)](_0x54bafd),'ack':!![]}),_0x15e7b7['isProVersion']&&_0x15e7b7[_0x3bbe4b(0x189)]&&_0x15e7b7[_0x3bbe4b(0x189)](_0x3bbe4b(0x178),{'sequence':_0x151214});}catch(_0x227367){_0x15e7b7[_0x3bbe4b(0x1a7)]['error'](_0x3bbe4b(0x1c7)+_0x227367['message']);}}async function recordSequence(_0x53a7a9,_0x4813aa){const _0x5c4194=a5_0x3138,_0x4e43a8=(_0x4813aa['type']||'')['toLowerCase'](),_0xfd7d30=[_0x5c4194(0x195),_0x5c4194(0x160),'pr채senz','presence',_0x5c4194(0x1a4),_0x5c4194(0x1ac),_0x5c4194(0x15d),'window',_0x5c4194(0x161),'contact',_0x5c4194(0x1c6),_0x5c4194(0x1bb),_0x5c4194(0x17f),_0x5c4194(0x18d),_0x5c4194(0x182),'dimmer',_0x5c4194(0x165)];if(!_0xfd7d30[_0x5c4194(0x1c1)](_0x21541e=>_0x4e43a8[_0x5c4194(0x166)](_0x21541e)))return;if(!_0x4813aa[_0x5c4194(0x16f)])return;if(sequenceTimer)clearTimeout(sequenceTimer);activeSequence[_0x5c4194(0x1bf)]({'loc':_0x4813aa[_0x5c4194(0x1b6)]||_0x5c4194(0x1a1),'id':_0x4813aa['id'],'ts':Date[_0x5c4194(0x16b)]()}),sequenceTimer=setTimeout(async()=>{if(activeSequence['length']>0x1)await saveCompletedSequence(_0x53a7a9);activeSequence=[];},SEQUENCE_TIMEOUT_MS);}function startExitTimer(_0x24a010){const _0x5afacb=a5_0x3138;abortExitTimer(_0x24a010),_0x24a010[_0x5afacb(0x19d)]=!![],_0x24a010[_0x5afacb(0x18a)]=setTimeout(()=>{const _0x57088f=_0x5afacb;_0x24a010[_0x57088f(0x19d)]=![];},EXIT_GRACE_PERIOD_SECONDS*0x3e8),_0x24a010[_0x5afacb(0x184)]=setTimeout(()=>{setPresence(_0x24a010,![]),_0x24a010['exitTimer']=null;},EXIT_TIMER_MINUTES*0x3c*0x3e8);}function a5_0x56ef(){const _0x30a601=['dimmer','setStateAsync','parse','lampe','includes','exports','eventHistory','griff','[RECORDER]\x20Ignored\x20implausible\x20temperature\x20value:\x20','now','debug','system.isPresent','shift','value','temperatur','schloss','LTM.trainingData.sequences','Temperature','temperature','LTM.trainingData.thermodynamics','째C\x20from\x20','.1.TEMPERATURE','ANALYZE_SEQUENCE','2029050ATHUSp','54MzEMbj','getHours','toLowerCase','Valve','.1.LEVEL','licht','263543JBukmN','185696vQGDmq','schalter','STATE','exitTimer','loc','valveMapping','237012fgWoSG','events.history','sendToPythonWrapper','exitGraceTimer','window','1574708oQNZlB','switch','splice','.1.VALVE_STATE','(((.+)+)+)+$','stringify','search','isExit','toString','motion','length','5497497dbbBCK','isProVersion','.1.ACTUAL_TEMPERATURE','514010rcnJRi','21bqIsDu','number','isGracePeriodActive','getStateAsync','level','val','Unknown','presence','heizung','occupancy','type','outdoorSensorId','log','handle','getForeignStateAsync','constructor','normal','door','string','isPresent','TRACK_EVENT','.ACTUAL_TEMPERATURE','events.lastEvent','pr채senz','weatherInstance','STATUS','name','location','sensorLastValues','.forecast.current.temperature','config','LTM.rawEventLog','light','rawEventLog','round','SIMULATE_SIGNAL','push','.Current.Temperature','some','thermostat','replace','.NextHours.Location_1.Day_1.current.temp_value','useWeather','kontakt','[RECORDER]\x20Error:\x20','map','t체r','.LEVEL','apply','bewegung','fenster'];a5_0x56ef=function(){return _0x30a601;};return a5_0x56ef();}function abortExitTimer(_0x2eedf5){const _0x483f39=a5_0x3138;if(_0x2eedf5[_0x483f39(0x184)])clearTimeout(_0x2eedf5['exitTimer']);if(_0x2eedf5['exitGraceTimer'])clearTimeout(_0x2eedf5[_0x483f39(0x18a)]);_0x2eedf5['exitTimer']=null,_0x2eedf5[_0x483f39(0x18a)]=null,_0x2eedf5[_0x483f39(0x19d)]=![];}async function setPresence(_0x1de33e,_0x43f880){const _0x562f7c=a5_0x3138;if(_0x1de33e[_0x562f7c(0x1ae)]===_0x43f880)return;_0x1de33e[_0x562f7c(0x1ae)]=_0x43f880,await _0x1de33e[_0x562f7c(0x163)](_0x562f7c(0x16d),{'val':_0x43f880,'ack':!![]});}async function processSensorEvent(_0x38dd4d,_0x4513cd,_0x50a36c,_0x18232e){const _0x1d2345=a5_0x3138;if(!_0x18232e)return null;const _0x1c88f4=_0x50a36c[_0x1d2345(0x1a0)],_0x3314ca=Date[_0x1d2345(0x16b)](),_0x5968cb=_0x38dd4d[_0x1d2345(0x1b7)][_0x4513cd];_0x38dd4d[_0x1d2345(0x1b7)][_0x4513cd]=_0x1c88f4;if(!_0x18232e['logDuplicates']&&_0x5968cb!=undefined&&_0x5968cb==_0x1c88f4)return null;const _0x1ff22=(_0x18232e[_0x1d2345(0x1a5)]||'')[_0x1d2345(0x17c)](),_0x4bfed4=_0x1ff22[_0x1d2345(0x166)](_0x1d2345(0x174))||_0x1ff22[_0x1d2345(0x166)](_0x1d2345(0x170))||_0x1ff22['includes']('klima')||_0x1ff22['includes'](_0x1d2345(0x1a3))||_0x1ff22['includes'](_0x1d2345(0x1c2));if(_0x4bfed4&&typeof _0x1c88f4===_0x1d2345(0x19c)){if(_0x1c88f4>0x50||_0x1c88f4<-0x32)return _0x38dd4d[_0x1d2345(0x1a7)][_0x1d2345(0x16c)](_0x1d2345(0x16a)+_0x1c88f4+_0x1d2345(0x176)+_0x4513cd),null;}_0x38dd4d[_0x1d2345(0x198)]&&_0x4bfed4&&recordThermodynamics(_0x38dd4d,_0x4513cd,_0x1c88f4,_0x18232e['location']);const _0x44ae5f={'timestamp':_0x3314ca,'id':_0x4513cd,'name':_0x18232e[_0x1d2345(0x1b5)],'type':_0x18232e[_0x1d2345(0x1a5)],'location':_0x18232e[_0x1d2345(0x1b6)],'value':_0x1c88f4};_0x38dd4d[_0x1d2345(0x168)]['unshift'](_0x44ae5f);if(_0x38dd4d[_0x1d2345(0x168)][_0x1d2345(0x196)]>HISTORY_MAX_SIZE)_0x38dd4d['eventHistory']['pop']();await _0x38dd4d[_0x1d2345(0x163)](_0x1d2345(0x1b1),{'val':JSON[_0x1d2345(0x191)](_0x44ae5f),'ack':!![]}),await _0x38dd4d[_0x1d2345(0x163)](_0x1d2345(0x188),{'val':JSON[_0x1d2345(0x191)](_0x38dd4d[_0x1d2345(0x168)]),'ack':!![]});if(_0x38dd4d[_0x1d2345(0x198)]){_0x38dd4d[_0x1d2345(0x1bc)][_0x1d2345(0x1bf)](_0x44ae5f);if(_0x38dd4d[_0x1d2345(0x1bc)]['length']>RAW_LOG_MAX_SIZE)_0x38dd4d['rawEventLog'][_0x1d2345(0x18e)](0x0,_0x38dd4d[_0x1d2345(0x1bc)][_0x1d2345(0x196)]-RAW_LOG_MAX_SIZE);await _0x38dd4d[_0x1d2345(0x163)](_0x1d2345(0x1ba),{'val':JSON[_0x1d2345(0x191)](_0x38dd4d[_0x1d2345(0x1bc)]),'ack':!![]}),recordSequence(_0x38dd4d,_0x44ae5f);}if(_0x18232e[_0x1d2345(0x193)]&&_0x1c88f4===!![]){if(_0x38dd4d['isPresent']&&!_0x38dd4d['isGracePeriodActive'])startExitTimer(_0x38dd4d);else{if(!_0x38dd4d['isPresent'])setPresence(_0x38dd4d,!![]);}}else{if(_0x18232e['type']==='motion'&&_0x1c88f4===!![]){if(_0x38dd4d[_0x1d2345(0x184)])abortExitTimer(_0x38dd4d);if(!_0x38dd4d[_0x1d2345(0x1ae)]&&_0x38dd4d['currentSystemMode']===_0x1d2345(0x1ab))setPresence(_0x38dd4d,!![]);}}if(_0x38dd4d[_0x1d2345(0x198)]&&_0x38dd4d['sendToPythonWrapper']){_0x18232e[_0x1d2345(0x1a5)]===_0x1d2345(0x195)&&_0x1c88f4===!![]&&_0x18232e[_0x1d2345(0x1b6)]&&_0x38dd4d['sendToPythonWrapper'](_0x1d2345(0x1be),{'room':_0x18232e[_0x1d2345(0x1b6)]});const _0x417c27=[_0x1d2345(0x1ac),_0x1d2345(0x15d),_0x1d2345(0x18b),_0x1d2345(0x161),_0x1d2345(0x169),_0x1d2345(0x1a8),'lock',_0x1d2345(0x171)]['some'](_0x475763=>_0x1ff22['includes'](_0x475763)),_0x315df0=[_0x1d2345(0x1bb),'licht',_0x1d2345(0x18d),_0x1d2345(0x182),_0x1d2345(0x162),'lampe']['some'](_0x3f7f77=>_0x1ff22[_0x1d2345(0x166)](_0x3f7f77)),_0x346430=['motion',_0x1d2345(0x160),_0x1d2345(0x1b2),_0x1d2345(0x1a2),_0x1d2345(0x1a4)][_0x1d2345(0x1c1)](_0x11d03d=>_0x1ff22[_0x1d2345(0x166)](_0x11d03d));if(_0x18232e[_0x1d2345(0x1b6)]&&(_0x417c27||_0x315df0||_0x346430)){const _0x417410=_0x1c88f4===!![]||typeof _0x1c88f4===_0x1d2345(0x19c)&&_0x1c88f4>0x0,_0x2a7384=_0x417c27&&!_0x417410&&_0x5968cb!==undefined&&_0x5968cb!=_0x1c88f4;if(_0x417410||_0x2a7384){const _0x35272f=_0x38dd4d['lastTrackerEventTime']||_0x3314ca,_0x5dd677=(_0x3314ca-_0x35272f)/0x3e8;_0x38dd4d['lastTrackerEventTime']=_0x3314ca,_0x38dd4d[_0x1d2345(0x189)](_0x1d2345(0x1af),{'room':_0x18232e[_0x1d2345(0x1b6)],'dt':_0x5dd677});}}}return _0x44ae5f;}module[a5_0x3a61c8(0x167)]={'processSensorEvent':processSensorEvent,'getOutsideTemperatureNumeric':getOutsideTemperatureNumeric,'setPresence':setPresence,'abortExitTimer':abortExitTimer,'startExitTimer':startExitTimer};