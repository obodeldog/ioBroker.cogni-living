const a4_0x370450=a4_0x115b;(function(_0x7e8de3,_0x282715){const _0x402748=a4_0x115b,_0x3dab28=_0x7e8de3();while(!![]){try{const _0x4eff2a=-parseInt(_0x402748(0x1d0))/0x1+-parseInt(_0x402748(0x1e9))/0x2+parseInt(_0x402748(0x1ac))/0x3+-parseInt(_0x402748(0x1c1))/0x4+parseInt(_0x402748(0x1cf))/0x5+-parseInt(_0x402748(0x1c3))/0x6+parseInt(_0x402748(0x1cd))/0x7;if(_0x4eff2a===_0x282715)break;else _0x3dab28['push'](_0x3dab28['shift']());}catch(_0x3960f3){_0x3dab28['push'](_0x3dab28['shift']());}}}(a4_0x1e84,0x98880));const a4_0x1c8ed0=(function(){let _0x2f7f80=!![];return function(_0x4d9cbc,_0x2ad0d1){const _0x101878=_0x2f7f80?function(){const _0x5cbea4=a4_0x115b;if(_0x2ad0d1){const _0x5d5e89=_0x2ad0d1[_0x5cbea4(0x1ce)](_0x4d9cbc,arguments);return _0x2ad0d1=null,_0x5d5e89;}}:function(){};return _0x2f7f80=![],_0x101878;};}()),a4_0x1e5adc=a4_0x1c8ed0(this,function(){const _0x116f3b=a4_0x115b;return a4_0x1e5adc[_0x116f3b(0x1d7)]()['search'](_0x116f3b(0x1e3))['toString']()[_0x116f3b(0x1b0)](a4_0x1e5adc)[_0x116f3b(0x1d6)](_0x116f3b(0x1e3));});a4_0x1e5adc();'use strict';function a4_0x1e84(){const _0x332f17=['Unknown','SIMULATE_SIGNAL','stringify','search','toString','.forecast.current.temperature','exitTimer','setStateAsync','motion','.NextHours.Location_1.Day_1.current.temp_value','sensorLastValues','kontakt','parse','log','includes','val','(((.+)+)+)+$','openweathermap','exports','präsenz','isExit','length','995260xjUrLo','window','rawEventLog','daswetter','logDuplicates','pop','now','events.history','toLowerCase','temperatur','weatherInstance','config','fenster','unshift','isProVersion','location','system.isPresent','getHours','useWeather','message','exitGraceTimer','outdoorSensorId','getStateAsync','name','sendToPythonWrapper','506973QvsRxY','ANALYZE_SEQUENCE','LTM.rawEventLog','LTM.trainingData.sequences','constructor','occupancy','klima','round','isGracePeriodActive','heizung','schalter','lampe','type','dimmer','[RECORDER]\x20Error:\x20','isPresent','presence','push','getForeignStateAsync','contact','splice','2846348HEQmgu','door','2045682JTbzso','bewegung','temperature','licht','LTM.trainingData.thermodynamics','error','value','map','some','normal','14147336JxnSux','apply','1227980pporPh','260703ZEXEsU','eventHistory','shift'];a4_0x1e84=function(){return _0x332f17;};return a4_0x1e84();}const HISTORY_MAX_SIZE=0x32,RAW_LOG_MAX_SIZE=0x9c4,THERMO_LOG_SIZE=0x3e8,SEQUENCE_TIMEOUT_MS=0x5*0x3c*0x3e8,MAX_TRAINING_SET_SIZE=0x1f4,EXIT_TIMER_MINUTES=0xf,EXIT_GRACE_PERIOD_SECONDS=0x1e;let activeSequence=[],sequenceTimer=null;async function getOutsideTemperatureNumeric(_0x34a32b){const _0x4de8db=a4_0x115b;if(_0x34a32b[_0x4de8db(0x19e)][_0x4de8db(0x1a8)])try{const _0x286f83=await _0x34a32b[_0x4de8db(0x1be)](_0x34a32b[_0x4de8db(0x19e)][_0x4de8db(0x1a8)]);if(_0x286f83&&_0x286f83[_0x4de8db(0x1e2)]!==undefined&&_0x286f83[_0x4de8db(0x1e2)]!==null)return parseFloat(_0x286f83['val']);}catch(_0x42a79d){}const _0x317f91=_0x34a32b['config'][_0x4de8db(0x1f3)];if(!_0x34a32b[_0x4de8db(0x19e)][_0x4de8db(0x1a5)]||!_0x317f91)return null;try{let _0x583966='';if(_0x317f91[_0x4de8db(0x1e1)]('accuweather'))_0x583966=_0x317f91+'.Current.Temperature';else{if(_0x317f91[_0x4de8db(0x1e1)](_0x4de8db(0x1ec)))_0x583966=_0x317f91+_0x4de8db(0x1dc);else{if(_0x317f91[_0x4de8db(0x1e1)](_0x4de8db(0x1e4)))_0x583966=_0x317f91+_0x4de8db(0x1d8);else{if(_0x317f91[_0x4de8db(0x1e1)]('weatherunderground'))_0x583966=_0x317f91+'.forecast.current.temp';}}}if(_0x583966){const _0x1c23f7=await _0x34a32b[_0x4de8db(0x1be)](_0x583966);if(_0x1c23f7&&_0x1c23f7[_0x4de8db(0x1e2)]!==undefined&&_0x1c23f7['val']!==null)return parseFloat(_0x1c23f7[_0x4de8db(0x1e2)]);}}catch(_0x32198b){}return null;}async function recordThermodynamics(_0x53724b,_0x5af217,_0x3190c3,_0x3c681c){const _0x15c6cd=a4_0x115b,_0x13dcbf=await getOutsideTemperatureNumeric(_0x53724b),_0x1ac5c7=await _0x53724b['getStateAsync'](_0x15c6cd(0x1c7));let _0xf03f06=[];if(_0x1ac5c7&&_0x1ac5c7[_0x15c6cd(0x1e2)])try{_0xf03f06=JSON[_0x15c6cd(0x1df)](_0x1ac5c7[_0x15c6cd(0x1e2)]);}catch(_0x3587b3){}_0xf03f06['push']({'ts':Date[_0x15c6cd(0x1ef)](),'room':_0x3c681c||_0x15c6cd(0x1d3),'t_in':_0x3190c3,'t_out':_0x13dcbf});if(_0xf03f06[_0x15c6cd(0x1e8)]>THERMO_LOG_SIZE)_0xf03f06[_0x15c6cd(0x1d2)]();await _0x53724b[_0x15c6cd(0x1da)]('LTM.trainingData.thermodynamics',{'val':JSON[_0x15c6cd(0x1d5)](_0xf03f06),'ack':!![]});}async function saveCompletedSequence(_0x28f85a){const _0xc865ba=a4_0x115b;try{const _0x27f702=await _0x28f85a[_0xc865ba(0x1a9)](_0xc865ba(0x1af));let _0x21c839=[];if(_0x27f702&&_0x27f702['val'])try{_0x21c839=JSON[_0xc865ba(0x1df)](_0x27f702[_0xc865ba(0x1e2)]);}catch(_0x207faf){}const _0x16564b=activeSequence[0x0]['ts'],_0x5f2f46=activeSequence[_0xc865ba(0x1ca)](_0x19d3c7=>({'loc':_0x19d3c7['loc'],'t_delta':Math['round']((_0x19d3c7['ts']-_0x16564b)/0x3e8)})),_0x3bdb71={'timestamp':new Date(_0x16564b)['toISOString'](),'steps':_0x5f2f46,'duration':Math[_0xc865ba(0x1b3)]((activeSequence[activeSequence[_0xc865ba(0x1e8)]-0x1]['ts']-_0x16564b)/0x3e8),'daytime':new Date(_0x16564b)[_0xc865ba(0x1a4)]()};_0x21c839['push'](_0x3bdb71);if(_0x21c839[_0xc865ba(0x1e8)]>MAX_TRAINING_SET_SIZE)_0x21c839[_0xc865ba(0x1d2)]();await _0x28f85a[_0xc865ba(0x1da)]('LTM.trainingData.sequences',{'val':JSON[_0xc865ba(0x1d5)](_0x21c839),'ack':!![]}),_0x28f85a[_0xc865ba(0x1a1)]&&_0x28f85a[_0xc865ba(0x1ab)]&&_0x28f85a[_0xc865ba(0x1ab)](_0xc865ba(0x1ad),{'sequence':_0x3bdb71});}catch(_0xc83b26){_0x28f85a[_0xc865ba(0x1e0)][_0xc865ba(0x1c8)](_0xc865ba(0x1ba)+_0xc83b26[_0xc865ba(0x1a6)]);}}async function recordSequence(_0x86dc6e,_0x3ac395){const _0x3fb517=a4_0x115b,_0x178ccf=(_0x3ac395[_0x3fb517(0x1b8)]||'')[_0x3fb517(0x1f1)](),_0x491e2d=[_0x3fb517(0x1db),_0x3fb517(0x1c4),_0x3fb517(0x1e6),_0x3fb517(0x1bc),_0x3fb517(0x1b1),_0x3fb517(0x1c2),'tür',_0x3fb517(0x1ea),_0x3fb517(0x19f),_0x3fb517(0x1bf),_0x3fb517(0x1de),'light',_0x3fb517(0x1c6),'switch',_0x3fb517(0x1b6),_0x3fb517(0x1b9),_0x3fb517(0x1b7)];if(!_0x491e2d[_0x3fb517(0x1cb)](_0x7943a7=>_0x178ccf[_0x3fb517(0x1e1)](_0x7943a7)))return;if(!_0x3ac395[_0x3fb517(0x1c9)])return;if(sequenceTimer)clearTimeout(sequenceTimer);activeSequence[_0x3fb517(0x1bd)]({'loc':_0x3ac395[_0x3fb517(0x1a2)]||_0x3fb517(0x1d3),'id':_0x3ac395['id'],'ts':Date[_0x3fb517(0x1ef)]()}),sequenceTimer=setTimeout(async()=>{const _0x459ad5=_0x3fb517;if(activeSequence[_0x459ad5(0x1e8)]>0x1)await saveCompletedSequence(_0x86dc6e);activeSequence=[];},SEQUENCE_TIMEOUT_MS);}function a4_0x115b(_0x2177a5,_0x46edf3){const _0x32b14e=a4_0x1e84();return a4_0x115b=function(_0x1e5adc,_0x1c8ed0){_0x1e5adc=_0x1e5adc-0x19e;let _0x1e84db=_0x32b14e[_0x1e5adc];return _0x1e84db;},a4_0x115b(_0x2177a5,_0x46edf3);}function startExitTimer(_0x223181){const _0x23383a=a4_0x115b;abortExitTimer(_0x223181),_0x223181[_0x23383a(0x1b4)]=!![],_0x223181[_0x23383a(0x1a7)]=setTimeout(()=>{const _0x24738b=_0x23383a;_0x223181[_0x24738b(0x1b4)]=![];},EXIT_GRACE_PERIOD_SECONDS*0x3e8),_0x223181[_0x23383a(0x1d9)]=setTimeout(()=>{const _0xa1b61b=_0x23383a;setPresence(_0x223181,![]),_0x223181[_0xa1b61b(0x1d9)]=null;},EXIT_TIMER_MINUTES*0x3c*0x3e8);}function abortExitTimer(_0x33d0b5){const _0x5648aa=a4_0x115b;if(_0x33d0b5[_0x5648aa(0x1d9)])clearTimeout(_0x33d0b5[_0x5648aa(0x1d9)]);if(_0x33d0b5[_0x5648aa(0x1a7)])clearTimeout(_0x33d0b5[_0x5648aa(0x1a7)]);_0x33d0b5[_0x5648aa(0x1d9)]=null,_0x33d0b5[_0x5648aa(0x1a7)]=null,_0x33d0b5[_0x5648aa(0x1b4)]=![];}async function setPresence(_0x57da6e,_0x421e5e){const _0x496011=a4_0x115b;if(_0x57da6e[_0x496011(0x1bb)]===_0x421e5e)return;_0x57da6e[_0x496011(0x1bb)]=_0x421e5e,await _0x57da6e['setStateAsync'](_0x496011(0x1a3),{'val':_0x421e5e,'ack':!![]});}async function processSensorEvent(_0x465ee9,_0x388d64,_0x527f44,_0x9e355f){const _0x30179c=a4_0x115b;if(!_0x9e355f)return;const _0x15614d=_0x527f44['val'],_0x46dc49=Date[_0x30179c(0x1ef)](),_0x1cfecf=_0x465ee9[_0x30179c(0x1dd)][_0x388d64];_0x465ee9[_0x30179c(0x1dd)][_0x388d64]=_0x15614d;if(!_0x9e355f[_0x30179c(0x1ed)]&&_0x1cfecf!=undefined&&_0x1cfecf==_0x15614d)return;const _0x497791=(_0x9e355f['type']||'')['toLowerCase'](),_0x2b6d68=_0x497791[_0x30179c(0x1e1)](_0x30179c(0x1c5))||_0x497791['includes'](_0x30179c(0x1f2))||_0x497791[_0x30179c(0x1e1)](_0x30179c(0x1b2))||_0x497791[_0x30179c(0x1e1)](_0x30179c(0x1b5));_0x465ee9[_0x30179c(0x1a1)]&&_0x2b6d68&&recordThermodynamics(_0x465ee9,_0x388d64,_0x15614d,_0x9e355f[_0x30179c(0x1a2)]);const _0x83d7e7={'timestamp':_0x46dc49,'id':_0x388d64,'name':_0x9e355f[_0x30179c(0x1aa)],'type':_0x9e355f[_0x30179c(0x1b8)],'location':_0x9e355f[_0x30179c(0x1a2)],'value':_0x15614d};_0x465ee9[_0x30179c(0x1d1)][_0x30179c(0x1a0)](_0x83d7e7);if(_0x465ee9[_0x30179c(0x1d1)][_0x30179c(0x1e8)]>HISTORY_MAX_SIZE)_0x465ee9[_0x30179c(0x1d1)][_0x30179c(0x1ee)]();await _0x465ee9['setStateAsync']('events.lastEvent',{'val':JSON[_0x30179c(0x1d5)](_0x83d7e7),'ack':!![]}),await _0x465ee9[_0x30179c(0x1da)](_0x30179c(0x1f0),{'val':JSON[_0x30179c(0x1d5)](_0x465ee9['eventHistory']),'ack':!![]});if(_0x465ee9[_0x30179c(0x1a1)]){_0x465ee9['rawEventLog'][_0x30179c(0x1bd)](_0x83d7e7);if(_0x465ee9[_0x30179c(0x1eb)][_0x30179c(0x1e8)]>RAW_LOG_MAX_SIZE)_0x465ee9[_0x30179c(0x1eb)][_0x30179c(0x1c0)](0x0,_0x465ee9['rawEventLog'][_0x30179c(0x1e8)]-RAW_LOG_MAX_SIZE);await _0x465ee9[_0x30179c(0x1da)](_0x30179c(0x1ae),{'val':JSON[_0x30179c(0x1d5)](_0x465ee9[_0x30179c(0x1eb)]),'ack':!![]}),recordSequence(_0x465ee9,_0x83d7e7);}if(_0x9e355f[_0x30179c(0x1e7)]&&_0x15614d===!![]){if(_0x465ee9[_0x30179c(0x1bb)]&&!_0x465ee9['isGracePeriodActive'])startExitTimer(_0x465ee9);else{if(!_0x465ee9[_0x30179c(0x1bb)])setPresence(_0x465ee9,!![]);}}else{if(_0x9e355f[_0x30179c(0x1b8)]===_0x30179c(0x1db)&&_0x15614d===!![]){if(_0x465ee9['exitTimer'])abortExitTimer(_0x465ee9);if(!_0x465ee9[_0x30179c(0x1bb)]&&_0x465ee9['currentSystemMode']===_0x30179c(0x1cc))setPresence(_0x465ee9,!![]);}}_0x465ee9[_0x30179c(0x1a1)]&&_0x9e355f[_0x30179c(0x1b8)]===_0x30179c(0x1db)&&_0x15614d===!![]&&_0x9e355f['location']&&_0x465ee9[_0x30179c(0x1ab)]&&_0x465ee9['sendToPythonWrapper'](_0x30179c(0x1d4),{'room':_0x9e355f['location']});}module[a4_0x370450(0x1e5)]={'processSensorEvent':processSensorEvent,'getOutsideTemperatureNumeric':getOutsideTemperatureNumeric,'setPresence':setPresence,'abortExitTimer':abortExitTimer,'startExitTimer':startExitTimer};