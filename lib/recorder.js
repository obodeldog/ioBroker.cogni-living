const a5_0x2297d3=a5_0x2606;(function(_0x263df2,_0x1aab2b){const _0x7caf4e=a5_0x2606,_0x570b4c=_0x263df2();while(!![]){try{const _0x46ef31=parseInt(_0x7caf4e(0x1b8))/0x1+parseInt(_0x7caf4e(0x1d8))/0x2+parseInt(_0x7caf4e(0x189))/0x3*(-parseInt(_0x7caf4e(0x1ba))/0x4)+parseInt(_0x7caf4e(0x18a))/0x5*(parseInt(_0x7caf4e(0x1b7))/0x6)+-parseInt(_0x7caf4e(0x1a9))/0x7*(parseInt(_0x7caf4e(0x1a1))/0x8)+parseInt(_0x7caf4e(0x1de))/0x9*(parseInt(_0x7caf4e(0x1aa))/0xa)+-parseInt(_0x7caf4e(0x1dc))/0xb;if(_0x46ef31===_0x1aab2b)break;else _0x570b4c['push'](_0x570b4c['shift']());}catch(_0xcfe8ab){_0x570b4c['push'](_0x570b4c['shift']());}}}(a5_0x1e59,0xd3106));const a5_0x117960=(function(){let _0x35af70=!![];return function(_0x87d3be,_0x2de02f){const _0x3eca6e=_0x35af70?function(){const _0x111980=a5_0x2606;if(_0x2de02f){const _0x1fabe6=_0x2de02f[_0x111980(0x176)](_0x87d3be,arguments);return _0x2de02f=null,_0x1fabe6;}}:function(){};return _0x35af70=![],_0x3eca6e;};}()),a5_0x5ecfbb=a5_0x117960(this,function(){const _0x2d3b2b=a5_0x2606;return a5_0x5ecfbb[_0x2d3b2b(0x1d2)]()[_0x2d3b2b(0x182)](_0x2d3b2b(0x1b6))[_0x2d3b2b(0x1d2)]()[_0x2d3b2b(0x19a)](a5_0x5ecfbb)[_0x2d3b2b(0x182)](_0x2d3b2b(0x1b6));});function a5_0x1e59(){const _0x24818e=['log','val','tür','.forecast.current.temp','push','.1.ACTUAL_TEMPERATURE','toString','isPresent','getHours','now','lastTrackerEventTime','lock','1236638JChlIA','SIMULATE_SIGNAL','TRACK_EVENT','.1.TEMPERATURE','10272878eXHJmq','rawEventLog','27SfqZpN','thermostat','name','schloss','shift','fenster','round','apply','bewegung','accuweather','useWeather','exitGraceTimer','stringify','length','light','präsenz','temperature','motion','config','search','string','dimmer','type','switch','handle','.ACTUAL_TEMPERATURE','1759272wzmHxt','10EZJwcr','LTM.trainingData.thermodynamics','unshift','valveMapping','toLowerCase','STATE','contact','replace','presence','griff','klima','.LEVEL','parse','Unknown','ANALYZE_SEQUENCE','location','constructor','getForeignStateAsync','normal','sendToPythonWrapper','[RECORDER]\x20Ignored\x20implausible\x20temperature:\x20','currentSystemMode','sensorLastValues','208CcrsSm','level','loc','.1.VALVE_STATE','some','setStateAsync','from','isProVersion','453705AJmmQX','2564030KsGmGX','pop','schalter','LTM.trainingData.sequences','.4.VALVE_STATE','eventHistory','number','events.lastEvent','lampe','LEVEL','occupancy','message','(((.+)+)+)+$','5053884VkFWho','1584298IREAqH','toISOString','8wKAdcN','isExit','Valve','exports','splice','debug','isGracePeriodActive','Temperature','.NextHours.Location_1.Day_1.current.temp_value','.1.LEVEL','logDuplicates','.Current.Temperature','includes','licht','window','getStateAsync','door','exitTimer'];a5_0x1e59=function(){return _0x24818e;};return a5_0x1e59();}a5_0x5ecfbb();'use strict';const HISTORY_MAX_SIZE=0x32,RAW_LOG_MAX_SIZE=0x9c4,THERMO_LOG_SIZE=0x3e8,SEQUENCE_TIMEOUT_MS=0x5*0x3c*0x3e8,MAX_TRAINING_SET_SIZE=0x1f4,EXIT_TIMER_MINUTES=0xf,EXIT_GRACE_PERIOD_SECONDS=0x1e;let activeSequence=[],sequenceTimer=null;async function getOutsideTemperatureNumeric(_0x2527ca){const _0x5163dc=a5_0x2606;if(_0x2527ca[_0x5163dc(0x181)]['outdoorSensorId'])try{const _0x962b71=await _0x2527ca[_0x5163dc(0x19b)](_0x2527ca[_0x5163dc(0x181)]['outdoorSensorId']);if(_0x962b71&&_0x962b71['val']!==undefined&&_0x962b71[_0x5163dc(0x1cd)]!==null)return parseFloat(_0x962b71[_0x5163dc(0x1cd)]);}catch(_0x3ae95c){}const _0x155861=_0x2527ca[_0x5163dc(0x181)]['weatherInstance'];if(!_0x2527ca[_0x5163dc(0x181)][_0x5163dc(0x179)]||!_0x155861)return null;try{let _0x3d6780='';if(_0x155861[_0x5163dc(0x1c6)](_0x5163dc(0x178)))_0x3d6780=_0x155861+_0x5163dc(0x1c5);else{if(_0x155861['includes']('daswetter'))_0x3d6780=_0x155861+_0x5163dc(0x1c2);else{if(_0x155861[_0x5163dc(0x1c6)]('openweathermap'))_0x3d6780=_0x155861+'.forecast.current.temperature';else{if(_0x155861['includes']('weatherunderground'))_0x3d6780=_0x155861+_0x5163dc(0x1cf);}}}if(_0x3d6780){const _0x271b79=await _0x2527ca[_0x5163dc(0x19b)](_0x3d6780);if(_0x271b79&&_0x271b79['val']!==undefined&&_0x271b79[_0x5163dc(0x1cd)]!==null)return parseFloat(_0x271b79[_0x5163dc(0x1cd)]);}}catch(_0x2e870e){}return null;}async function recordThermodynamics(_0x43ff1e,_0x5518a4,_0x461ba1,_0x4adb58){const _0x6759d8=a5_0x2606,_0x4e67c3=await getOutsideTemperatureNumeric(_0x43ff1e);if(_0x4e67c3===null)return;let _0x43f3c9=0x0,_0xa6c2fa=![];if(_0x43ff1e['config'][_0x6759d8(0x18d)])try{let _0x46a751=_0x43ff1e[_0x6759d8(0x181)][_0x6759d8(0x18d)];if(typeof _0x46a751===_0x6759d8(0x183))_0x46a751=JSON[_0x6759d8(0x196)](_0x46a751);if(_0x46a751[_0x5518a4]){const _0x439873=_0x46a751[_0x5518a4],_0x318ddc=await _0x43ff1e[_0x6759d8(0x19b)](_0x439873);if(_0x318ddc&&_0x318ddc['val']!==null&&_0x318ddc[_0x6759d8(0x1cd)]!==undefined){let _0x36906f=Number(_0x318ddc['val']);if(_0x36906f<=1.05&&!_0x439873[_0x6759d8(0x1c6)]('STATUS')&&!_0x439873[_0x6759d8(0x1c6)](_0x6759d8(0x18f)))_0x36906f=_0x36906f*0x64;_0x43f3c9=Math[_0x6759d8(0x175)](_0x36906f),_0xa6c2fa=!![];}}}catch(_0x1ec5c9){}if(!_0xa6c2fa){const _0x297b4d=[{'from':_0x6759d8(0x1d1),'to':_0x6759d8(0x1c3)},{'from':'.1.ACTUAL_TEMPERATURE','to':_0x6759d8(0x1a4)},{'from':_0x6759d8(0x1db),'to':_0x6759d8(0x1ae)},{'from':_0x6759d8(0x188),'to':_0x6759d8(0x195)},{'from':_0x6759d8(0x17f),'to':_0x6759d8(0x1a2)},{'from':_0x6759d8(0x1c1),'to':_0x6759d8(0x1bc)}];for(const _0x10a991 of _0x297b4d){if(_0x5518a4[_0x6759d8(0x1c6)](_0x10a991[_0x6759d8(0x1a7)])){const _0x2219c1=_0x5518a4[_0x6759d8(0x191)](_0x10a991[_0x6759d8(0x1a7)],_0x10a991['to']);try{const _0xd5e780=await _0x43ff1e['getForeignStateAsync'](_0x2219c1);if(_0xd5e780&&_0xd5e780[_0x6759d8(0x1cd)]!==null&&_0xd5e780['val']!==undefined){let _0x415b5d=Number(_0xd5e780[_0x6759d8(0x1cd)]);if(typeof _0x415b5d===_0x6759d8(0x1b0)){if(_0x415b5d<=1.05&&_0x10a991['to'][_0x6759d8(0x1c6)](_0x6759d8(0x1b3)))_0x415b5d=_0x415b5d*0x64;_0x43f3c9=Math[_0x6759d8(0x175)](_0x415b5d),_0xa6c2fa=!![];break;}}}catch(_0xb7b698){}}}}const _0x28973e=await _0x43ff1e[_0x6759d8(0x1c9)](_0x6759d8(0x18b));let _0x83f461=[];if(_0x28973e&&_0x28973e[_0x6759d8(0x1cd)])try{_0x83f461=JSON[_0x6759d8(0x196)](_0x28973e['val']);}catch(_0x287c37){}_0x83f461[_0x6759d8(0x1d0)]({'ts':Date[_0x6759d8(0x1d5)](),'room':_0x4adb58||_0x6759d8(0x197),'t_in':_0x461ba1,'t_out':_0x4e67c3,'valve':_0x43f3c9});if(_0x83f461[_0x6759d8(0x17c)]>THERMO_LOG_SIZE)_0x83f461[_0x6759d8(0x1e2)]();await _0x43ff1e[_0x6759d8(0x1a6)](_0x6759d8(0x18b),{'val':JSON[_0x6759d8(0x17b)](_0x83f461),'ack':!![]});}async function saveCompletedSequence(_0x46d349){const _0x2c5aa9=a5_0x2606;try{const _0x46f302=await _0x46d349['getStateAsync']('LTM.trainingData.sequences');let _0x160ab5=[];if(_0x46f302&&_0x46f302[_0x2c5aa9(0x1cd)])try{_0x160ab5=JSON[_0x2c5aa9(0x196)](_0x46f302[_0x2c5aa9(0x1cd)]);}catch(_0x3fd138){}const _0x3acab7=activeSequence[0x0]['ts'],_0x2a9124=activeSequence['map'](_0x4d29fe=>({'loc':_0x4d29fe[_0x2c5aa9(0x1a3)],'t_delta':Math['round']((_0x4d29fe['ts']-_0x3acab7)/0x3e8)})),_0x4d76f5={'timestamp':new Date(_0x3acab7)[_0x2c5aa9(0x1b9)](),'steps':_0x2a9124,'duration':Math['round']((activeSequence[activeSequence['length']-0x1]['ts']-_0x3acab7)/0x3e8),'daytime':new Date(_0x3acab7)[_0x2c5aa9(0x1d4)]()};_0x160ab5[_0x2c5aa9(0x1d0)](_0x4d76f5);if(_0x160ab5[_0x2c5aa9(0x17c)]>MAX_TRAINING_SET_SIZE)_0x160ab5['shift']();await _0x46d349[_0x2c5aa9(0x1a6)](_0x2c5aa9(0x1ad),{'val':JSON[_0x2c5aa9(0x17b)](_0x160ab5),'ack':!![]}),_0x46d349[_0x2c5aa9(0x1a8)]&&_0x46d349[_0x2c5aa9(0x19d)]&&_0x46d349[_0x2c5aa9(0x19d)](_0x2c5aa9(0x198),{'sequence':_0x4d76f5});}catch(_0x1ac12e){_0x46d349[_0x2c5aa9(0x1cc)]['error']('[RECORDER]\x20Error:\x20'+_0x1ac12e[_0x2c5aa9(0x1b5)]);}}async function recordSequence(_0x42eb99,_0x5e0cb2){const _0x166cd1=a5_0x2606,_0x3a8aa4=(_0x5e0cb2[_0x166cd1(0x185)]||'')['toLowerCase'](),_0x3c51d4=[_0x166cd1(0x180),_0x166cd1(0x177),_0x166cd1(0x17e),'presence',_0x166cd1(0x1b4),_0x166cd1(0x1ca),_0x166cd1(0x1ce),_0x166cd1(0x1c8),_0x166cd1(0x174),_0x166cd1(0x190),'kontakt','light',_0x166cd1(0x1c7),'switch','schalter',_0x166cd1(0x184),'lampe'];if(!_0x3c51d4['some'](_0x38afbd=>_0x3a8aa4[_0x166cd1(0x1c6)](_0x38afbd)))return;if(!_0x5e0cb2['value'])return;if(sequenceTimer)clearTimeout(sequenceTimer);activeSequence[_0x166cd1(0x1d0)]({'loc':_0x5e0cb2[_0x166cd1(0x199)]||_0x166cd1(0x197),'id':_0x5e0cb2['id'],'ts':Date[_0x166cd1(0x1d5)]()}),sequenceTimer=setTimeout(async()=>{const _0x5b7af1=_0x166cd1;if(activeSequence[_0x5b7af1(0x17c)]>0x1)await saveCompletedSequence(_0x42eb99);activeSequence=[];},SEQUENCE_TIMEOUT_MS);}function startExitTimer(_0x3646f0){const _0x11bc31=a5_0x2606;abortExitTimer(_0x3646f0),_0x3646f0[_0x11bc31(0x1c0)]=!![],_0x3646f0['exitGraceTimer']=setTimeout(()=>{const _0x45a0cf=_0x11bc31;_0x3646f0[_0x45a0cf(0x1c0)]=![];},EXIT_GRACE_PERIOD_SECONDS*0x3e8),_0x3646f0['exitTimer']=setTimeout(()=>{const _0x407938=_0x11bc31;setPresence(_0x3646f0,![]),_0x3646f0[_0x407938(0x1cb)]=null;},EXIT_TIMER_MINUTES*0x3c*0x3e8);}function a5_0x2606(_0x39abb5,_0x4767cd){const _0x376eb6=a5_0x1e59();return a5_0x2606=function(_0x5ecfbb,_0x117960){_0x5ecfbb=_0x5ecfbb-0x174;let _0x1e599e=_0x376eb6[_0x5ecfbb];return _0x1e599e;},a5_0x2606(_0x39abb5,_0x4767cd);}function abortExitTimer(_0x243776){const _0x133edb=a5_0x2606;if(_0x243776[_0x133edb(0x1cb)])clearTimeout(_0x243776[_0x133edb(0x1cb)]);if(_0x243776['exitGraceTimer'])clearTimeout(_0x243776['exitGraceTimer']);_0x243776[_0x133edb(0x1cb)]=null,_0x243776[_0x133edb(0x17a)]=null,_0x243776['isGracePeriodActive']=![];}async function setPresence(_0xa4453b,_0x247ae4){const _0x4319cb=a5_0x2606;if(_0xa4453b[_0x4319cb(0x1d3)]===_0x247ae4)return;_0xa4453b[_0x4319cb(0x1d3)]=_0x247ae4,await _0xa4453b['setStateAsync']('system.isPresent',{'val':_0x247ae4,'ack':!![]});}async function processSensorEvent(_0x13d542,_0x51d25a,_0x531f72,_0x4df063){const _0x1c0dbf=a5_0x2606;if(!_0x4df063)return null;const _0x5f1c36=_0x531f72[_0x1c0dbf(0x1cd)],_0x3bcc40=Date[_0x1c0dbf(0x1d5)](),_0x2077dc=_0x13d542[_0x1c0dbf(0x1a0)][_0x51d25a],_0x4b376f=(_0x4df063[_0x1c0dbf(0x185)]||'')[_0x1c0dbf(0x18e)](),_0x5bd3d5=_0x4b376f[_0x1c0dbf(0x1c6)](_0x1c0dbf(0x17f))||_0x4b376f[_0x1c0dbf(0x1c6)]('temperatur')||_0x4b376f[_0x1c0dbf(0x1c6)](_0x1c0dbf(0x194))||_0x4b376f[_0x1c0dbf(0x1c6)]('heizung')||_0x4b376f[_0x1c0dbf(0x1c6)](_0x1c0dbf(0x1df));if(_0x5bd3d5&&typeof _0x5f1c36===_0x1c0dbf(0x1b0)){if(_0x5f1c36>0x50||_0x5f1c36<-0x32)return _0x13d542['log'][_0x1c0dbf(0x1bf)](_0x1c0dbf(0x19e)+_0x5f1c36+'\x20from\x20'+_0x51d25a),null;}_0x13d542[_0x1c0dbf(0x1a0)][_0x51d25a]=_0x5f1c36;if(!_0x4df063[_0x1c0dbf(0x1c4)]&&_0x2077dc!=undefined&&_0x2077dc==_0x5f1c36)return null;_0x13d542['isProVersion']&&_0x5bd3d5&&recordThermodynamics(_0x13d542,_0x51d25a,_0x5f1c36,_0x4df063[_0x1c0dbf(0x199)]);const _0x2b2b5a={'timestamp':_0x3bcc40,'id':_0x51d25a,'name':_0x4df063[_0x1c0dbf(0x1e0)],'type':_0x4df063[_0x1c0dbf(0x185)],'location':_0x4df063[_0x1c0dbf(0x199)],'value':_0x5f1c36};_0x13d542[_0x1c0dbf(0x1af)][_0x1c0dbf(0x18c)](_0x2b2b5a);if(_0x13d542[_0x1c0dbf(0x1af)][_0x1c0dbf(0x17c)]>HISTORY_MAX_SIZE)_0x13d542['eventHistory'][_0x1c0dbf(0x1ab)]();await _0x13d542[_0x1c0dbf(0x1a6)](_0x1c0dbf(0x1b1),{'val':JSON[_0x1c0dbf(0x17b)](_0x2b2b5a),'ack':!![]}),await _0x13d542[_0x1c0dbf(0x1a6)]('events.history',{'val':JSON['stringify'](_0x13d542[_0x1c0dbf(0x1af)]),'ack':!![]});if(_0x13d542['isProVersion']){_0x13d542[_0x1c0dbf(0x1dd)][_0x1c0dbf(0x1d0)](_0x2b2b5a);if(_0x13d542[_0x1c0dbf(0x1dd)][_0x1c0dbf(0x17c)]>RAW_LOG_MAX_SIZE)_0x13d542[_0x1c0dbf(0x1dd)][_0x1c0dbf(0x1be)](0x0,_0x13d542[_0x1c0dbf(0x1dd)][_0x1c0dbf(0x17c)]-RAW_LOG_MAX_SIZE);await _0x13d542[_0x1c0dbf(0x1a6)]('LTM.rawEventLog',{'val':JSON[_0x1c0dbf(0x17b)](_0x13d542['rawEventLog']),'ack':!![]}),recordSequence(_0x13d542,_0x2b2b5a);}if(_0x4df063[_0x1c0dbf(0x1bb)]&&_0x5f1c36===!![]){if(_0x13d542[_0x1c0dbf(0x1d3)]&&!_0x13d542[_0x1c0dbf(0x1c0)])startExitTimer(_0x13d542);else{if(!_0x13d542['isPresent'])setPresence(_0x13d542,!![]);}}else{if(_0x4df063[_0x1c0dbf(0x185)]===_0x1c0dbf(0x180)&&_0x5f1c36===!![]){if(_0x13d542['exitTimer'])abortExitTimer(_0x13d542);if(!_0x13d542[_0x1c0dbf(0x1d3)]&&_0x13d542[_0x1c0dbf(0x19f)]===_0x1c0dbf(0x19c))setPresence(_0x13d542,!![]);}}if(_0x13d542[_0x1c0dbf(0x1a8)]&&_0x13d542[_0x1c0dbf(0x19d)]){_0x4df063[_0x1c0dbf(0x185)]===_0x1c0dbf(0x180)&&_0x5f1c36===!![]&&_0x4df063[_0x1c0dbf(0x199)]&&_0x13d542[_0x1c0dbf(0x19d)](_0x1c0dbf(0x1d9),{'room':_0x4df063[_0x1c0dbf(0x199)]});const _0x2be764=[_0x1c0dbf(0x1ca),_0x1c0dbf(0x1ce),_0x1c0dbf(0x1c8),_0x1c0dbf(0x174),_0x1c0dbf(0x193),_0x1c0dbf(0x187),_0x1c0dbf(0x1d7),_0x1c0dbf(0x1e1)][_0x1c0dbf(0x1a5)](_0x42c5ba=>_0x4b376f[_0x1c0dbf(0x1c6)](_0x42c5ba)),_0x4d2375=[_0x1c0dbf(0x17d),_0x1c0dbf(0x1c7),_0x1c0dbf(0x186),_0x1c0dbf(0x1ac),'dimmer',_0x1c0dbf(0x1b2)][_0x1c0dbf(0x1a5)](_0x2e5d15=>_0x4b376f[_0x1c0dbf(0x1c6)](_0x2e5d15)),_0x1ab372=[_0x1c0dbf(0x180),'bewegung','präsenz',_0x1c0dbf(0x192),_0x1c0dbf(0x1b4)][_0x1c0dbf(0x1a5)](_0x546f14=>_0x4b376f['includes'](_0x546f14));if(_0x4df063[_0x1c0dbf(0x199)]&&(_0x2be764||_0x4d2375||_0x1ab372)){const _0x14e4df=_0x5f1c36===!![]||typeof _0x5f1c36===_0x1c0dbf(0x1b0)&&_0x5f1c36>0x0,_0x57b8a8=_0x2be764&&!_0x14e4df&&_0x2077dc!==undefined&&_0x2077dc!=_0x5f1c36;if(_0x14e4df||_0x57b8a8){const _0x400857=_0x13d542[_0x1c0dbf(0x1d6)]||_0x3bcc40,_0x5c9baf=(_0x3bcc40-_0x400857)/0x3e8;_0x13d542['lastTrackerEventTime']=_0x3bcc40,_0x13d542['sendToPythonWrapper'](_0x1c0dbf(0x1da),{'room':_0x4df063[_0x1c0dbf(0x199)],'dt':_0x5c9baf});}}}return _0x2b2b5a;}module[a5_0x2297d3(0x1bd)]={'processSensorEvent':processSensorEvent,'getOutsideTemperatureNumeric':getOutsideTemperatureNumeric,'setPresence':setPresence,'abortExitTimer':abortExitTimer,'startExitTimer':startExitTimer};