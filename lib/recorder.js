const a5_0x11cfc1=a5_0x11ee;(function(_0x491bff,_0x5f217b){const _0x6d6bde=a5_0x11ee,_0x542e5f=_0x491bff();while(!![]){try{const _0xed03b=-parseInt(_0x6d6bde(0x120))/0x1*(parseInt(_0x6d6bde(0x12f))/0x2)+-parseInt(_0x6d6bde(0x16a))/0x3*(-parseInt(_0x6d6bde(0x161))/0x4)+parseInt(_0x6d6bde(0x14c))/0x5+parseInt(_0x6d6bde(0x11d))/0x6*(parseInt(_0x6d6bde(0x110))/0x7)+-parseInt(_0x6d6bde(0x106))/0x8+parseInt(_0x6d6bde(0x15a))/0x9*(parseInt(_0x6d6bde(0x147))/0xa)+-parseInt(_0x6d6bde(0x15c))/0xb;if(_0xed03b===_0x5f217b)break;else _0x542e5f['push'](_0x542e5f['shift']());}catch(_0x19e992){_0x542e5f['push'](_0x542e5f['shift']());}}}(a5_0x5c69,0x34de7));const a5_0x51a507=(function(){let _0x383f94=!![];return function(_0x5c8a1c,_0x17773b){const _0x1f23e4=_0x383f94?function(){const _0x23abcc=a5_0x11ee;if(_0x17773b){const _0x237342=_0x17773b[_0x23abcc(0x14d)](_0x5c8a1c,arguments);return _0x17773b=null,_0x237342;}}:function(){};return _0x383f94=![],_0x1f23e4;};}()),a5_0x538366=a5_0x51a507(this,function(){const _0xaacfc7=a5_0x11ee;return a5_0x538366['toString']()[_0xaacfc7(0x111)](_0xaacfc7(0x116))['toString']()[_0xaacfc7(0x11b)](a5_0x538366)[_0xaacfc7(0x111)](_0xaacfc7(0x116));});function a5_0x11ee(_0x261104,_0x40236a){const _0x2b2ea6=a5_0x5c69();return a5_0x11ee=function(_0x538366,_0x51a507){_0x538366=_0x538366-0x102;let _0x5c6955=_0x2b2ea6[_0x538366];return _0x5c6955;},a5_0x11ee(_0x261104,_0x40236a);}a5_0x538366();'use strict';const HISTORY_MAX_SIZE=0x32,RAW_LOG_MAX_SIZE=0x9c4,THERMO_LOG_SIZE=0x3e8,SEQUENCE_TIMEOUT_MS=0x5*0x3c*0x3e8,MAX_TRAINING_SET_SIZE=0x1f4,EXIT_TIMER_MINUTES=0xf,EXIT_GRACE_PERIOD_SECONDS=0x1e;let activeSequence=[],sequenceTimer=null;async function getOutsideTemperatureNumeric(_0x6a47d2){const _0x482b96=a5_0x11ee;if(_0x6a47d2[_0x482b96(0x11c)]['outdoorSensorId'])try{const _0xbdae99=await _0x6a47d2[_0x482b96(0x153)](_0x6a47d2[_0x482b96(0x11c)][_0x482b96(0x131)]);if(_0xbdae99&&_0xbdae99[_0x482b96(0x168)]!==undefined&&_0xbdae99[_0x482b96(0x168)]!==null)return parseFloat(_0xbdae99[_0x482b96(0x168)]);}catch(_0x1abb2f){}const _0x4b1517=_0x6a47d2[_0x482b96(0x11c)]['weatherInstance'];if(!_0x6a47d2[_0x482b96(0x11c)][_0x482b96(0x152)]||!_0x4b1517)return null;try{let _0x54ae61='';if(_0x4b1517[_0x482b96(0x118)](_0x482b96(0x150)))_0x54ae61=_0x4b1517+_0x482b96(0x130);else{if(_0x4b1517[_0x482b96(0x118)]('daswetter'))_0x54ae61=_0x4b1517+_0x482b96(0x102);else{if(_0x4b1517['includes'](_0x482b96(0x12c)))_0x54ae61=_0x4b1517+_0x482b96(0x14e);else{if(_0x4b1517[_0x482b96(0x118)](_0x482b96(0x16b)))_0x54ae61=_0x4b1517+'.forecast.current.temp';}}}if(_0x54ae61){const _0x2fa022=await _0x6a47d2[_0x482b96(0x153)](_0x54ae61);if(_0x2fa022&&_0x2fa022[_0x482b96(0x168)]!==undefined&&_0x2fa022[_0x482b96(0x168)]!==null)return parseFloat(_0x2fa022[_0x482b96(0x168)]);}}catch(_0x404e02){}return null;}async function recordThermodynamics(_0x566138,_0x275c6f,_0x2fbc51,_0x59b6e3){const _0x2886b1=a5_0x11ee,_0x124f3b=await getOutsideTemperatureNumeric(_0x566138);if(_0x124f3b===null)return;let _0x395961=0x0,_0x31ca68=![];if(_0x566138[_0x2886b1(0x11c)]['valveMapping'])try{let _0x481c57=_0x566138[_0x2886b1(0x11c)][_0x2886b1(0x158)];if(typeof _0x481c57===_0x2886b1(0x155))_0x481c57=JSON['parse'](_0x481c57);if(_0x481c57[_0x275c6f]){const _0x5ee711=_0x481c57[_0x275c6f],_0x5db91d=await _0x566138[_0x2886b1(0x153)](_0x5ee711);if(_0x5db91d&&_0x5db91d[_0x2886b1(0x168)]!==null&&_0x5db91d[_0x2886b1(0x168)]!==undefined){let _0x123416=Number(_0x5db91d['val']);if(_0x123416<=1.05&&!_0x5ee711[_0x2886b1(0x118)](_0x2886b1(0x15e))&&!_0x5ee711[_0x2886b1(0x118)]('STATE'))_0x123416=_0x123416*0x64;_0x395961=Math[_0x2886b1(0x104)](_0x123416),_0x31ca68=!![];}}}catch(_0x594d95){}if(!_0x31ca68){const _0x5bf0ed=[{'from':_0x2886b1(0x137),'to':'.1.LEVEL'},{'from':_0x2886b1(0x137),'to':'.1.VALVE_STATE'},{'from':_0x2886b1(0x166),'to':_0x2886b1(0x140)},{'from':'.ACTUAL_TEMPERATURE','to':_0x2886b1(0x146)},{'from':_0x2886b1(0x163),'to':'level'},{'from':_0x2886b1(0x138),'to':_0x2886b1(0x143)}];for(const _0x2d8d8d of _0x5bf0ed){if(_0x275c6f[_0x2886b1(0x118)](_0x2d8d8d[_0x2886b1(0x10b)])){const _0x37f77f=_0x275c6f['replace'](_0x2d8d8d[_0x2886b1(0x10b)],_0x2d8d8d['to']);try{const _0x234b81=await _0x566138[_0x2886b1(0x153)](_0x37f77f);if(_0x234b81&&_0x234b81[_0x2886b1(0x168)]!==null&&_0x234b81[_0x2886b1(0x168)]!==undefined){let _0xd931e6=Number(_0x234b81[_0x2886b1(0x168)]);if(typeof _0xd931e6===_0x2886b1(0x141)){if(_0xd931e6<=1.05&&_0x2d8d8d['to'][_0x2886b1(0x118)](_0x2886b1(0x12e)))_0xd931e6=_0xd931e6*0x64;_0x395961=Math[_0x2886b1(0x104)](_0xd931e6),_0x31ca68=!![];break;}}}catch(_0x65238c){}}}}const _0x50d33f=await _0x566138['getStateAsync'](_0x2886b1(0x13e));let _0x1b7eb0=[];if(_0x50d33f&&_0x50d33f[_0x2886b1(0x168)])try{_0x1b7eb0=JSON['parse'](_0x50d33f[_0x2886b1(0x168)]);}catch(_0x3acaba){}_0x1b7eb0[_0x2886b1(0x124)]({'ts':Date['now'](),'room':_0x59b6e3||_0x2886b1(0x13a),'t_in':_0x2fbc51,'t_out':_0x124f3b,'valve':_0x395961});if(_0x1b7eb0['length']>THERMO_LOG_SIZE)_0x1b7eb0['shift']();await _0x566138[_0x2886b1(0x10d)]('LTM.trainingData.thermodynamics',{'val':JSON[_0x2886b1(0x10f)](_0x1b7eb0),'ack':!![]});}async function saveCompletedSequence(_0x5774d4){const _0x317d33=a5_0x11ee;try{const _0x232784=await _0x5774d4[_0x317d33(0x127)](_0x317d33(0x144));let _0x2180cb=[];if(_0x232784&&_0x232784['val'])try{_0x2180cb=JSON[_0x317d33(0x122)](_0x232784['val']);}catch(_0x2c6442){}const _0x4c719d=activeSequence[0x0]['ts'],_0x2b7a78=activeSequence[_0x317d33(0x129)](_0x5a4a68=>({'loc':_0x5a4a68[_0x317d33(0x119)],'t_delta':Math[_0x317d33(0x104)]((_0x5a4a68['ts']-_0x4c719d)/0x3e8)})),_0x454c79={'timestamp':new Date(_0x4c719d)[_0x317d33(0x139)](),'steps':_0x2b7a78,'duration':Math['round']((activeSequence[activeSequence['length']-0x1]['ts']-_0x4c719d)/0x3e8),'daytime':new Date(_0x4c719d)['getHours']()};_0x2180cb['push'](_0x454c79);if(_0x2180cb[_0x317d33(0x12b)]>MAX_TRAINING_SET_SIZE)_0x2180cb[_0x317d33(0x14a)]();await _0x5774d4[_0x317d33(0x10d)](_0x317d33(0x144),{'val':JSON[_0x317d33(0x10f)](_0x2180cb),'ack':!![]}),_0x5774d4[_0x317d33(0x109)]&&_0x5774d4[_0x317d33(0x164)]&&_0x5774d4[_0x317d33(0x164)]('ANALYZE_SEQUENCE',{'sequence':_0x454c79});}catch(_0x51e87f){_0x5774d4[_0x317d33(0x13f)][_0x317d33(0x12d)](_0x317d33(0x142)+_0x51e87f['message']);}}function a5_0x5c69(){const _0x151a10=['accuweather','location','useWeather','getForeignStateAsync','dimmer','string','fenster','now','valveMapping','events.history','168678gQfdwo','lastTrackerEventTime','3832730ZuRfFz','some','STATUS','name','heizung','518996jyMZJf','window','temperature','sendToPythonWrapper','toLowerCase','.1.TEMPERATURE','value','val','LTM.rawEventLog','3idAlHB','weatherunderground','.NextHours.Location_1.Day_1.current.temp_value','TRACK_EVENT','round','switch','1214392bZHwwz','isExit','klima','isProVersion','isPresent','from','thermostat','setStateAsync','präsenz','stringify','105QNZFVS','search','lampe','rawEventLog','events.lastEvent','presence','(((.+)+)+)+$','motion','includes','loc','isGracePeriodActive','constructor','config','131478YbXixZ','exitTimer','eventHistory','1QHxAeq','SIMULATE_SIGNAL','parse','sensorLastValues','push','handle','type','getStateAsync','currentSystemMode','map','light','length','openweathermap','error','LEVEL','379042RCovwb','.Current.Temperature','outdoorSensorId','pop','exports','kontakt','contact','logDuplicates','.1.ACTUAL_TEMPERATURE','Temperature','toISOString','Unknown','exitGraceTimer','tür','griff','LTM.trainingData.thermodynamics','log','.4.VALVE_STATE','number','[RECORDER]\x20Error:\x20','Valve','LTM.trainingData.sequences','temperatur','.LEVEL','150kJjHPj','bewegung','licht','shift','lock','833635fGyuSc','apply','.forecast.current.temperature','schalter'];a5_0x5c69=function(){return _0x151a10;};return a5_0x5c69();}async function recordSequence(_0x252e0e,_0x356485){const _0x352664=a5_0x11ee,_0x14bd6e=(_0x356485[_0x352664(0x126)]||'')[_0x352664(0x165)](),_0x210a36=[_0x352664(0x117),'bewegung',_0x352664(0x10e),_0x352664(0x115),'occupancy','door',_0x352664(0x13c),_0x352664(0x162),_0x352664(0x156),_0x352664(0x135),_0x352664(0x134),_0x352664(0x12a),_0x352664(0x149),_0x352664(0x105),_0x352664(0x14f),'dimmer',_0x352664(0x112)];if(!_0x210a36['some'](_0xb55db2=>_0x14bd6e[_0x352664(0x118)](_0xb55db2)))return;if(!_0x356485[_0x352664(0x167)])return;if(sequenceTimer)clearTimeout(sequenceTimer);activeSequence[_0x352664(0x124)]({'loc':_0x356485[_0x352664(0x151)]||_0x352664(0x13a),'id':_0x356485['id'],'ts':Date[_0x352664(0x157)]()}),sequenceTimer=setTimeout(async()=>{const _0x268075=_0x352664;if(activeSequence[_0x268075(0x12b)]>0x1)await saveCompletedSequence(_0x252e0e);activeSequence=[];},SEQUENCE_TIMEOUT_MS);}function startExitTimer(_0x34b271){const _0x49a4ac=a5_0x11ee;abortExitTimer(_0x34b271),_0x34b271[_0x49a4ac(0x11a)]=!![],_0x34b271[_0x49a4ac(0x13b)]=setTimeout(()=>{const _0x5ae43b=_0x49a4ac;_0x34b271[_0x5ae43b(0x11a)]=![];},EXIT_GRACE_PERIOD_SECONDS*0x3e8),_0x34b271[_0x49a4ac(0x11e)]=setTimeout(()=>{const _0x34379e=_0x49a4ac;setPresence(_0x34b271,![]),_0x34b271[_0x34379e(0x11e)]=null;},EXIT_TIMER_MINUTES*0x3c*0x3e8);}function abortExitTimer(_0x60587b){const _0x19890d=a5_0x11ee;if(_0x60587b[_0x19890d(0x11e)])clearTimeout(_0x60587b['exitTimer']);if(_0x60587b[_0x19890d(0x13b)])clearTimeout(_0x60587b['exitGraceTimer']);_0x60587b[_0x19890d(0x11e)]=null,_0x60587b[_0x19890d(0x13b)]=null,_0x60587b[_0x19890d(0x11a)]=![];}async function setPresence(_0x49a5b5,_0x2edd00){const _0x538756=a5_0x11ee;if(_0x49a5b5[_0x538756(0x10a)]===_0x2edd00)return;_0x49a5b5[_0x538756(0x10a)]=_0x2edd00,await _0x49a5b5[_0x538756(0x10d)]('system.isPresent',{'val':_0x2edd00,'ack':!![]});}async function processSensorEvent(_0x3a6f58,_0xdf5c16,_0x2658f7,_0x4c4663){const _0x4eb318=a5_0x11ee;if(!_0x4c4663)return null;const _0x4986ad=_0x2658f7[_0x4eb318(0x168)],_0x4fcded=Date[_0x4eb318(0x157)](),_0x32d4f6=_0x3a6f58[_0x4eb318(0x123)][_0xdf5c16];_0x3a6f58[_0x4eb318(0x123)][_0xdf5c16]=_0x4986ad;if(!_0x4c4663[_0x4eb318(0x136)]&&_0x32d4f6!=undefined&&_0x32d4f6==_0x4986ad)return null;const _0x5a19a1=(_0x4c4663[_0x4eb318(0x126)]||'')[_0x4eb318(0x165)](),_0x5659cc=_0x5a19a1[_0x4eb318(0x118)]('temperature')||_0x5a19a1[_0x4eb318(0x118)](_0x4eb318(0x145))||_0x5a19a1[_0x4eb318(0x118)](_0x4eb318(0x108))||_0x5a19a1[_0x4eb318(0x118)](_0x4eb318(0x160))||_0x5a19a1['includes'](_0x4eb318(0x10c));_0x3a6f58[_0x4eb318(0x109)]&&_0x5659cc&&recordThermodynamics(_0x3a6f58,_0xdf5c16,_0x4986ad,_0x4c4663[_0x4eb318(0x151)]);const _0x4b7610={'timestamp':_0x4fcded,'id':_0xdf5c16,'name':_0x4c4663[_0x4eb318(0x15f)],'type':_0x4c4663[_0x4eb318(0x126)],'location':_0x4c4663[_0x4eb318(0x151)],'value':_0x4986ad};_0x3a6f58[_0x4eb318(0x11f)]['unshift'](_0x4b7610);if(_0x3a6f58[_0x4eb318(0x11f)][_0x4eb318(0x12b)]>HISTORY_MAX_SIZE)_0x3a6f58[_0x4eb318(0x11f)][_0x4eb318(0x132)]();await _0x3a6f58[_0x4eb318(0x10d)](_0x4eb318(0x114),{'val':JSON[_0x4eb318(0x10f)](_0x4b7610),'ack':!![]}),await _0x3a6f58[_0x4eb318(0x10d)](_0x4eb318(0x159),{'val':JSON[_0x4eb318(0x10f)](_0x3a6f58[_0x4eb318(0x11f)]),'ack':!![]});if(_0x3a6f58[_0x4eb318(0x109)]){_0x3a6f58['rawEventLog'][_0x4eb318(0x124)](_0x4b7610);if(_0x3a6f58[_0x4eb318(0x113)][_0x4eb318(0x12b)]>RAW_LOG_MAX_SIZE)_0x3a6f58[_0x4eb318(0x113)]['splice'](0x0,_0x3a6f58[_0x4eb318(0x113)][_0x4eb318(0x12b)]-RAW_LOG_MAX_SIZE);await _0x3a6f58[_0x4eb318(0x10d)](_0x4eb318(0x169),{'val':JSON[_0x4eb318(0x10f)](_0x3a6f58[_0x4eb318(0x113)]),'ack':!![]}),recordSequence(_0x3a6f58,_0x4b7610);}if(_0x4c4663[_0x4eb318(0x107)]&&_0x4986ad===!![]){if(_0x3a6f58[_0x4eb318(0x10a)]&&!_0x3a6f58['isGracePeriodActive'])startExitTimer(_0x3a6f58);else{if(!_0x3a6f58[_0x4eb318(0x10a)])setPresence(_0x3a6f58,!![]);}}else{if(_0x4c4663[_0x4eb318(0x126)]===_0x4eb318(0x117)&&_0x4986ad===!![]){if(_0x3a6f58['exitTimer'])abortExitTimer(_0x3a6f58);if(!_0x3a6f58['isPresent']&&_0x3a6f58[_0x4eb318(0x128)]==='normal')setPresence(_0x3a6f58,!![]);}}if(_0x3a6f58['isProVersion']&&_0x3a6f58[_0x4eb318(0x164)]){_0x4c4663[_0x4eb318(0x126)]===_0x4eb318(0x117)&&_0x4986ad===!![]&&_0x4c4663['location']&&_0x3a6f58[_0x4eb318(0x164)](_0x4eb318(0x121),{'room':_0x4c4663[_0x4eb318(0x151)]});const _0x396a2c=['door',_0x4eb318(0x13c),_0x4eb318(0x162),'fenster',_0x4eb318(0x13d),_0x4eb318(0x125),_0x4eb318(0x14b),'schloss'][_0x4eb318(0x15d)](_0x1dcc10=>_0x5a19a1[_0x4eb318(0x118)](_0x1dcc10)),_0x2679a6=[_0x4eb318(0x12a),_0x4eb318(0x149),'switch','schalter',_0x4eb318(0x154),'lampe'][_0x4eb318(0x15d)](_0x270421=>_0x5a19a1[_0x4eb318(0x118)](_0x270421)),_0x3a70ad=[_0x4eb318(0x117),_0x4eb318(0x148),_0x4eb318(0x10e),_0x4eb318(0x115),'occupancy'][_0x4eb318(0x15d)](_0x4477ad=>_0x5a19a1[_0x4eb318(0x118)](_0x4477ad));if(_0x4c4663['location']&&(_0x396a2c||_0x2679a6||_0x3a70ad)){const _0x1bccec=_0x4986ad===!![]||typeof _0x4986ad===_0x4eb318(0x141)&&_0x4986ad>0x0,_0x57bea9=_0x396a2c&&!_0x1bccec&&_0x32d4f6!==undefined&&_0x32d4f6!=_0x4986ad;if(_0x1bccec||_0x57bea9){const _0xfa76f0=_0x3a6f58['lastTrackerEventTime']||_0x4fcded,_0x3b2d13=(_0x4fcded-_0xfa76f0)/0x3e8;_0x3a6f58[_0x4eb318(0x15b)]=_0x4fcded,_0x3a6f58[_0x4eb318(0x164)](_0x4eb318(0x103),{'room':_0x4c4663[_0x4eb318(0x151)],'dt':_0x3b2d13});}}}return _0x4b7610;}module[a5_0x11cfc1(0x133)]={'processSensorEvent':processSensorEvent,'getOutsideTemperatureNumeric':getOutsideTemperatureNumeric,'setPresence':setPresence,'abortExitTimer':abortExitTimer,'startExitTimer':startExitTimer};