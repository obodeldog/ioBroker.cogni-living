(function(_0x171d7b,_0x164f2e){const _0x2fa48e=a5_0x702d,_0x36811e=_0x171d7b();while(!![]){try{const _0x2e408e=parseInt(_0x2fa48e(0xef))/0x1*(parseInt(_0x2fa48e(0xf0))/0x2)+parseInt(_0x2fa48e(0x121))/0x3*(parseInt(_0x2fa48e(0xda))/0x4)+parseInt(_0x2fa48e(0x129))/0x5+parseInt(_0x2fa48e(0x10a))/0x6*(-parseInt(_0x2fa48e(0xd2))/0x7)+-parseInt(_0x2fa48e(0xd5))/0x8*(parseInt(_0x2fa48e(0xc8))/0x9)+parseInt(_0x2fa48e(0x122))/0xa*(-parseInt(_0x2fa48e(0xd3))/0xb)+parseInt(_0x2fa48e(0x128))/0xc;if(_0x2e408e===_0x164f2e)break;else _0x36811e['push'](_0x36811e['shift']());}catch(_0x3a41b3){_0x36811e['push'](_0x36811e['shift']());}}}(a5_0x356b,0x53799));const a5_0x1bcf47=(function(){let _0x1a69aa=!![];return function(_0x48860f,_0xbf5021){const _0x1b41fc=_0x1a69aa?function(){if(_0xbf5021){const _0x176790=_0xbf5021['apply'](_0x48860f,arguments);return _0xbf5021=null,_0x176790;}}:function(){};return _0x1a69aa=![],_0x1b41fc;};}()),a5_0x1726e2=a5_0x1bcf47(this,function(){const _0x48713f=a5_0x702d;return a5_0x1726e2[_0x48713f(0xdf)]()[_0x48713f(0xd4)](_0x48713f(0xf3))[_0x48713f(0xdf)]()[_0x48713f(0xcf)](a5_0x1726e2)[_0x48713f(0xd4)]('(((.+)+)+)+$');});function a5_0x356b(){const _0x31ebda=['(((.+)+)+)+$','system.isPresent','from','rawEventLog','outdoorSensorId','sendToPythonWrapper','isExit','light','lastTrackerEventTime','message','.forecast.current.temperature','window','currentSystemMode','dimmer','motion','normal','useWeather','licht','heizung','thermostat','tür','TRACK_EVENT','loc','6BgeQbM','shift','setStateAsync','.NextHours.Location_1.Day_1.current.temp_value','number','exitTimer','log','.4.VALVE_STATE','replace','ANALYZE_SEQUENCE','isGracePeriodActive','lampe','Unknown','accuweather','round','presence','isProVersion','toISOString','präsenz','bewegung','door','occupancy','debug','12801DZqRTK','280qyVCgY','temperatur','getHours','temperature','lock','valveMapping','6016920udfhbk','85760QYeOXH','string','exitGraceTimer','getStateAsync','.1.TEMPERATURE','.1.ACTUAL_TEMPERATURE','config','LTM.rawEventLog','location','LEVEL','events.history','9ogFIZM','map','level','weatherInstance','schloss','openweathermap','type','constructor','isPresent','Temperature','1871422XLLYvt','186142DIGSuE','search','2491128qSWaVR','parse','val','name','switch','452GmHDTT','schalter','STATE','\x20from\x20','push','toString','Valve','eventHistory','includes','LTM.trainingData.sequences','kontakt','weatherunderground','now','handle','fenster','.forecast.current.temp','length','getForeignStateAsync','stringify','some','toLowerCase','29jgabah','27154MoyWrT','logDuplicates','pop'];a5_0x356b=function(){return _0x31ebda;};return a5_0x356b();}a5_0x1726e2();'use strict';function a5_0x702d(_0x45af02,_0x7884b0){const _0x4a831d=a5_0x356b();return a5_0x702d=function(_0x1726e2,_0x1bcf47){_0x1726e2=_0x1726e2-0xbf;let _0x356b9a=_0x4a831d[_0x1726e2];return _0x356b9a;},a5_0x702d(_0x45af02,_0x7884b0);}const HISTORY_MAX_SIZE=0x32,RAW_LOG_MAX_SIZE=0x9c4,THERMO_LOG_SIZE=0x3e8,SEQUENCE_TIMEOUT_MS=0x5*0x3c*0x3e8,MAX_TRAINING_SET_SIZE=0x1f4,EXIT_TIMER_MINUTES=0xf,EXIT_GRACE_PERIOD_SECONDS=0x1e;let activeSequence=[],sequenceTimer=null;async function getOutsideTemperatureNumeric(_0x1a6e13){const _0x5b4112=a5_0x702d;if(_0x1a6e13[_0x5b4112(0xc3)][_0x5b4112(0xf7)])try{const _0x3978a2=await _0x1a6e13[_0x5b4112(0xeb)](_0x1a6e13[_0x5b4112(0xc3)][_0x5b4112(0xf7)]);if(_0x3978a2&&_0x3978a2['val']!==undefined&&_0x3978a2[_0x5b4112(0xd7)]!==null)return parseFloat(_0x3978a2[_0x5b4112(0xd7)]);}catch(_0x5c228e){}const _0x10c3b1=_0x1a6e13[_0x5b4112(0xc3)][_0x5b4112(0xcb)];if(!_0x1a6e13[_0x5b4112(0xc3)][_0x5b4112(0x103)]||!_0x10c3b1)return null;try{let _0x133dc1='';if(_0x10c3b1[_0x5b4112(0xe2)](_0x5b4112(0x117)))_0x133dc1=_0x10c3b1+'.Current.Temperature';else{if(_0x10c3b1[_0x5b4112(0xe2)]('daswetter'))_0x133dc1=_0x10c3b1+_0x5b4112(0x10d);else{if(_0x10c3b1[_0x5b4112(0xe2)](_0x5b4112(0xcd)))_0x133dc1=_0x10c3b1+_0x5b4112(0xfd);else{if(_0x10c3b1['includes'](_0x5b4112(0xe5)))_0x133dc1=_0x10c3b1+_0x5b4112(0xe9);}}}if(_0x133dc1){const _0x48a4fc=await _0x1a6e13[_0x5b4112(0xeb)](_0x133dc1);if(_0x48a4fc&&_0x48a4fc[_0x5b4112(0xd7)]!==undefined&&_0x48a4fc[_0x5b4112(0xd7)]!==null)return parseFloat(_0x48a4fc[_0x5b4112(0xd7)]);}}catch(_0x4196ee){}return null;}async function recordThermodynamics(_0x79e9ae,_0x13f49d,_0x5b8d7f,_0x5ec911){const _0x4209e5=a5_0x702d,_0x4c9334=await getOutsideTemperatureNumeric(_0x79e9ae);if(_0x4c9334===null)return;let _0x560dd2=0x0,_0x3ab6c6=![];if(_0x79e9ae[_0x4209e5(0xc3)][_0x4209e5(0x127)])try{let _0x2a78c6=_0x79e9ae[_0x4209e5(0xc3)][_0x4209e5(0x127)];if(typeof _0x2a78c6===_0x4209e5(0x12a))_0x2a78c6=JSON[_0x4209e5(0xd6)](_0x2a78c6);if(_0x2a78c6[_0x13f49d]){const _0x4fb269=_0x2a78c6[_0x13f49d],_0x1a4c02=await _0x79e9ae[_0x4209e5(0xeb)](_0x4fb269);if(_0x1a4c02&&_0x1a4c02[_0x4209e5(0xd7)]!==null&&_0x1a4c02[_0x4209e5(0xd7)]!==undefined){let _0x4de82c=Number(_0x1a4c02[_0x4209e5(0xd7)]);if(_0x4de82c<=1.05&&!_0x4fb269[_0x4209e5(0xe2)]('STATUS')&&!_0x4fb269[_0x4209e5(0xe2)](_0x4209e5(0xdc)))_0x4de82c=_0x4de82c*0x64;_0x560dd2=Math[_0x4209e5(0x118)](_0x4de82c),_0x3ab6c6=!![];}}}catch(_0x3127fa){}if(!_0x3ab6c6){const _0x1e4f42=[{'from':_0x4209e5(0xc2),'to':'.1.LEVEL'},{'from':'.1.ACTUAL_TEMPERATURE','to':'.1.VALVE_STATE'},{'from':_0x4209e5(0xc1),'to':_0x4209e5(0x111)},{'from':'.ACTUAL_TEMPERATURE','to':'.LEVEL'},{'from':'temperature','to':_0x4209e5(0xca)},{'from':_0x4209e5(0xd1),'to':_0x4209e5(0xe0)}];for(const _0x1b481d of _0x1e4f42){if(_0x13f49d[_0x4209e5(0xe2)](_0x1b481d[_0x4209e5(0xf5)])){const _0x1d09f5=_0x13f49d[_0x4209e5(0x112)](_0x1b481d['from'],_0x1b481d['to']);try{const _0x21b2e1=await _0x79e9ae['getForeignStateAsync'](_0x1d09f5);if(_0x21b2e1&&_0x21b2e1['val']!==null&&_0x21b2e1[_0x4209e5(0xd7)]!==undefined){let _0x8f1a6f=Number(_0x21b2e1['val']);if(typeof _0x8f1a6f===_0x4209e5(0x10e)){if(_0x8f1a6f<=1.05&&_0x1b481d['to']['includes'](_0x4209e5(0xc6)))_0x8f1a6f=_0x8f1a6f*0x64;_0x560dd2=Math['round'](_0x8f1a6f),_0x3ab6c6=!![];break;}}}catch(_0x4aa940){}}}}const _0x5bba27=await _0x79e9ae[_0x4209e5(0xc0)]('LTM.trainingData.thermodynamics');let _0x188ae1=[];if(_0x5bba27&&_0x5bba27[_0x4209e5(0xd7)])try{_0x188ae1=JSON[_0x4209e5(0xd6)](_0x5bba27[_0x4209e5(0xd7)]);}catch(_0x26a9de){}_0x188ae1[_0x4209e5(0xde)]({'ts':Date[_0x4209e5(0xe6)](),'room':_0x5ec911||_0x4209e5(0x116),'t_in':_0x5b8d7f,'t_out':_0x4c9334,'valve':_0x560dd2});if(_0x188ae1[_0x4209e5(0xea)]>THERMO_LOG_SIZE)_0x188ae1[_0x4209e5(0x10b)]();await _0x79e9ae[_0x4209e5(0x10c)]('LTM.trainingData.thermodynamics',{'val':JSON[_0x4209e5(0xec)](_0x188ae1),'ack':!![]});}async function saveCompletedSequence(_0x35656d){const _0x37c158=a5_0x702d;try{const _0x2a1661=await _0x35656d['getStateAsync'](_0x37c158(0xe3));let _0x15b6e7=[];if(_0x2a1661&&_0x2a1661['val'])try{_0x15b6e7=JSON['parse'](_0x2a1661[_0x37c158(0xd7)]);}catch(_0x6de432){}const _0x3764b5=activeSequence[0x0]['ts'],_0x1d2e60=activeSequence[_0x37c158(0xc9)](_0xaf7e1b=>({'loc':_0xaf7e1b[_0x37c158(0x109)],'t_delta':Math['round']((_0xaf7e1b['ts']-_0x3764b5)/0x3e8)})),_0x18ac9c={'timestamp':new Date(_0x3764b5)[_0x37c158(0x11b)](),'steps':_0x1d2e60,'duration':Math[_0x37c158(0x118)]((activeSequence[activeSequence[_0x37c158(0xea)]-0x1]['ts']-_0x3764b5)/0x3e8),'daytime':new Date(_0x3764b5)[_0x37c158(0x124)]()};_0x15b6e7['push'](_0x18ac9c);if(_0x15b6e7['length']>MAX_TRAINING_SET_SIZE)_0x15b6e7[_0x37c158(0x10b)]();await _0x35656d[_0x37c158(0x10c)]('LTM.trainingData.sequences',{'val':JSON[_0x37c158(0xec)](_0x15b6e7),'ack':!![]}),_0x35656d['isProVersion']&&_0x35656d[_0x37c158(0xf8)]&&_0x35656d['sendToPythonWrapper'](_0x37c158(0x113),{'sequence':_0x18ac9c});}catch(_0x5b4723){_0x35656d[_0x37c158(0x110)]['error']('[RECORDER]\x20Error:\x20'+_0x5b4723[_0x37c158(0xfc)]);}}async function recordSequence(_0xe7d9b3,_0x1ed87f){const _0x6330f6=a5_0x702d,_0x11f247=(_0x1ed87f[_0x6330f6(0xce)]||'')[_0x6330f6(0xee)](),_0x54acdf=['motion','bewegung',_0x6330f6(0x11c),_0x6330f6(0x119),_0x6330f6(0x11f),_0x6330f6(0x11e),_0x6330f6(0x107),_0x6330f6(0xfe),'fenster','contact',_0x6330f6(0xe4),_0x6330f6(0xfa),_0x6330f6(0x104),'switch',_0x6330f6(0xdb),_0x6330f6(0x100),_0x6330f6(0x115)];if(!_0x54acdf[_0x6330f6(0xed)](_0x386a84=>_0x11f247[_0x6330f6(0xe2)](_0x386a84)))return;if(!_0x1ed87f['value'])return;if(sequenceTimer)clearTimeout(sequenceTimer);activeSequence['push']({'loc':_0x1ed87f[_0x6330f6(0xc5)]||_0x6330f6(0x116),'id':_0x1ed87f['id'],'ts':Date[_0x6330f6(0xe6)]()}),sequenceTimer=setTimeout(async()=>{const _0x3c3521=_0x6330f6;if(activeSequence[_0x3c3521(0xea)]>0x1)await saveCompletedSequence(_0xe7d9b3);activeSequence=[];},SEQUENCE_TIMEOUT_MS);}function startExitTimer(_0x2bb59d){const _0x45f832=a5_0x702d;abortExitTimer(_0x2bb59d),_0x2bb59d[_0x45f832(0x114)]=!![],_0x2bb59d['exitGraceTimer']=setTimeout(()=>{const _0x48fb45=_0x45f832;_0x2bb59d[_0x48fb45(0x114)]=![];},EXIT_GRACE_PERIOD_SECONDS*0x3e8),_0x2bb59d[_0x45f832(0x10f)]=setTimeout(()=>{setPresence(_0x2bb59d,![]),_0x2bb59d['exitTimer']=null;},EXIT_TIMER_MINUTES*0x3c*0x3e8);}function abortExitTimer(_0x37dc0b){const _0x52966c=a5_0x702d;if(_0x37dc0b['exitTimer'])clearTimeout(_0x37dc0b[_0x52966c(0x10f)]);if(_0x37dc0b[_0x52966c(0xbf)])clearTimeout(_0x37dc0b[_0x52966c(0xbf)]);_0x37dc0b[_0x52966c(0x10f)]=null,_0x37dc0b['exitGraceTimer']=null,_0x37dc0b['isGracePeriodActive']=![];}async function setPresence(_0x2c909f,_0x121579){const _0x46b70f=a5_0x702d;if(_0x2c909f[_0x46b70f(0xd0)]===_0x121579)return;_0x2c909f[_0x46b70f(0xd0)]=_0x121579,await _0x2c909f[_0x46b70f(0x10c)](_0x46b70f(0xf4),{'val':_0x121579,'ack':!![]});}async function processSensorEvent(_0x17eecf,_0x1e4fca,_0x1b40b9,_0x31017f){const _0x3b779c=a5_0x702d;if(!_0x31017f)return null;const _0x49fbd2=_0x1b40b9[_0x3b779c(0xd7)],_0x3e863c=Date[_0x3b779c(0xe6)](),_0xb0d774=_0x17eecf['sensorLastValues'][_0x1e4fca],_0x2a5768=(_0x31017f[_0x3b779c(0xce)]||'')[_0x3b779c(0xee)](),_0x2927f5=_0x2a5768[_0x3b779c(0xe2)](_0x3b779c(0x125))||_0x2a5768[_0x3b779c(0xe2)](_0x3b779c(0x123))||_0x2a5768['includes']('klima')||_0x2a5768[_0x3b779c(0xe2)](_0x3b779c(0x105))||_0x2a5768[_0x3b779c(0xe2)](_0x3b779c(0x106));if(_0x2927f5&&typeof _0x49fbd2===_0x3b779c(0x10e)){if(_0x49fbd2>0x50||_0x49fbd2<-0x32)return _0x17eecf[_0x3b779c(0x110)][_0x3b779c(0x120)]('[RECORDER]\x20Ignored\x20implausible\x20temperature:\x20'+_0x49fbd2+_0x3b779c(0xdd)+_0x1e4fca),null;}_0x17eecf['sensorLastValues'][_0x1e4fca]=_0x49fbd2;if(!_0x31017f[_0x3b779c(0xf1)]&&_0xb0d774!=undefined&&_0xb0d774==_0x49fbd2)return null;_0x17eecf[_0x3b779c(0x11a)]&&_0x2927f5&&recordThermodynamics(_0x17eecf,_0x1e4fca,_0x49fbd2,_0x31017f[_0x3b779c(0xc5)]);const _0x589a5f={'timestamp':_0x3e863c,'id':_0x1e4fca,'name':_0x31017f[_0x3b779c(0xd8)],'type':_0x31017f[_0x3b779c(0xce)],'location':_0x31017f[_0x3b779c(0xc5)],'value':_0x49fbd2};_0x17eecf[_0x3b779c(0xe1)]['unshift'](_0x589a5f);if(_0x17eecf['eventHistory'][_0x3b779c(0xea)]>HISTORY_MAX_SIZE)_0x17eecf[_0x3b779c(0xe1)][_0x3b779c(0xf2)]();await _0x17eecf[_0x3b779c(0x10c)]('events.lastEvent',{'val':JSON[_0x3b779c(0xec)](_0x589a5f),'ack':!![]}),await _0x17eecf['setStateAsync'](_0x3b779c(0xc7),{'val':JSON['stringify'](_0x17eecf['eventHistory']),'ack':!![]});if(_0x17eecf['isProVersion']){_0x17eecf[_0x3b779c(0xf6)]['push'](_0x589a5f);if(_0x17eecf[_0x3b779c(0xf6)][_0x3b779c(0xea)]>RAW_LOG_MAX_SIZE)_0x17eecf[_0x3b779c(0xf6)]['splice'](0x0,_0x17eecf[_0x3b779c(0xf6)]['length']-RAW_LOG_MAX_SIZE);await _0x17eecf['setStateAsync'](_0x3b779c(0xc4),{'val':JSON[_0x3b779c(0xec)](_0x17eecf[_0x3b779c(0xf6)]),'ack':!![]}),recordSequence(_0x17eecf,_0x589a5f);}if(_0x31017f[_0x3b779c(0xf9)]&&_0x49fbd2===!![]){if(_0x17eecf[_0x3b779c(0xd0)]&&!_0x17eecf[_0x3b779c(0x114)])startExitTimer(_0x17eecf);else{if(!_0x17eecf[_0x3b779c(0xd0)])setPresence(_0x17eecf,!![]);}}else{if(_0x31017f[_0x3b779c(0xce)]==='motion'&&_0x49fbd2===!![]){if(_0x17eecf[_0x3b779c(0x10f)])abortExitTimer(_0x17eecf);if(!_0x17eecf[_0x3b779c(0xd0)]&&_0x17eecf[_0x3b779c(0xff)]===_0x3b779c(0x102))setPresence(_0x17eecf,!![]);}}if(_0x17eecf['isProVersion']&&_0x17eecf['sendToPythonWrapper']){_0x31017f[_0x3b779c(0xce)]===_0x3b779c(0x101)&&_0x49fbd2===!![]&&_0x31017f[_0x3b779c(0xc5)]&&_0x17eecf['sendToPythonWrapper']('SIMULATE_SIGNAL',{'room':_0x31017f[_0x3b779c(0xc5)]});const _0x201b25=[_0x3b779c(0x11e),'tür','window',_0x3b779c(0xe8),'griff',_0x3b779c(0xe7),_0x3b779c(0x126),_0x3b779c(0xcc)][_0x3b779c(0xed)](_0x5b33f6=>_0x2a5768['includes'](_0x5b33f6)),_0x245b53=[_0x3b779c(0xfa),_0x3b779c(0x104),_0x3b779c(0xd9),'schalter',_0x3b779c(0x100),_0x3b779c(0x115)][_0x3b779c(0xed)](_0x396ed3=>_0x2a5768['includes'](_0x396ed3)),_0x27ac81=[_0x3b779c(0x101),_0x3b779c(0x11d),_0x3b779c(0x11c),_0x3b779c(0x119),_0x3b779c(0x11f)]['some'](_0x3d6d06=>_0x2a5768['includes'](_0x3d6d06));if(_0x31017f[_0x3b779c(0xc5)]&&(_0x201b25||_0x245b53||_0x27ac81)){const _0x262e6d=_0x49fbd2===!![]||typeof _0x49fbd2===_0x3b779c(0x10e)&&_0x49fbd2>0x0,_0x83f736=_0x201b25&&!_0x262e6d&&_0xb0d774!==undefined&&_0xb0d774!=_0x49fbd2;if(_0x262e6d||_0x83f736){const _0x150694=_0x17eecf[_0x3b779c(0xfb)]||_0x3e863c,_0x590e3f=(_0x3e863c-_0x150694)/0x3e8;_0x17eecf[_0x3b779c(0xfb)]=_0x3e863c,_0x17eecf[_0x3b779c(0xf8)](_0x3b779c(0x108),{'room':_0x31017f[_0x3b779c(0xc5)],'dt':_0x590e3f});}}}return _0x589a5f;}module['exports']={'processSensorEvent':processSensorEvent,'getOutsideTemperatureNumeric':getOutsideTemperatureNumeric,'setPresence':setPresence,'abortExitTimer':abortExitTimer,'startExitTimer':startExitTimer};