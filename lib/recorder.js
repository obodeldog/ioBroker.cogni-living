const a5_0x19da09=a5_0x5f1b;(function(_0x42a048,_0xa233be){const _0x10e699=a5_0x5f1b,_0x41b6e8=_0x42a048();while(!![]){try{const _0x596e3f=parseInt(_0x10e699(0xe4))/0x1+-parseInt(_0x10e699(0xca))/0x2+parseInt(_0x10e699(0xf6))/0x3+parseInt(_0x10e699(0xe9))/0x4+parseInt(_0x10e699(0xf5))/0x5*(parseInt(_0x10e699(0x8d))/0x6)+parseInt(_0x10e699(0xd1))/0x7+-parseInt(_0x10e699(0xcb))/0x8*(parseInt(_0x10e699(0x9e))/0x9);if(_0x596e3f===_0xa233be)break;else _0x41b6e8['push'](_0x41b6e8['shift']());}catch(_0x433118){_0x41b6e8['push'](_0x41b6e8['shift']());}}}(a5_0xdb23,0xbce70));const a5_0x2d0f8d=(function(){let _0x329da5=!![];return function(_0x511c59,_0x3cbfe6){const _0x3d61e9=_0x329da5?function(){const _0x45773b=a5_0x5f1b;if(_0x3cbfe6){const _0x42f10f=_0x3cbfe6[_0x45773b(0xda)](_0x511c59,arguments);return _0x3cbfe6=null,_0x42f10f;}}:function(){};return _0x329da5=![],_0x3d61e9;};}()),a5_0xaa0437=a5_0x2d0f8d(this,function(){const _0x1dc906=a5_0x5f1b;return a5_0xaa0437[_0x1dc906(0xc2)]()['search'](_0x1dc906(0xe2))[_0x1dc906(0xc2)]()[_0x1dc906(0x89)](a5_0xaa0437)[_0x1dc906(0x8f)](_0x1dc906(0xe2));});function a5_0x5f1b(_0x17585e,_0x52cee9){const _0xc3af4d=a5_0xdb23();return a5_0x5f1b=function(_0xaa0437,_0x2d0f8d){_0xaa0437=_0xaa0437-0x81;let _0xdb2358=_0xc3af4d[_0xaa0437];return _0xdb2358;},a5_0x5f1b(_0x17585e,_0x52cee9);}a5_0xaa0437();'use strict';const HISTORY_MAX_SIZE=0x32,RAW_LOG_MAX_SIZE=0x9c4,THERMO_LOG_SIZE=0x3e8,SEQUENCE_TIMEOUT_MS=0x5*0x3c*0x3e8,MAX_TRAINING_SET_SIZE=0x1f4,EXIT_TIMER_MINUTES=0xf,EXIT_GRACE_PERIOD_SECONDS=0x1e;let activeSequence=[],sequenceTimer=null,dailyActivityLog=new Array(0x18)[a5_0x19da09(0xe8)](0x0),lastLogDay=new Date()[a5_0x19da09(0xa7)]();async function getOutsideTemperatureNumeric(_0x26282f){const _0x16e0cc=a5_0x19da09;if(_0x26282f[_0x16e0cc(0x92)][_0x16e0cc(0xb0)])try{const _0xa5ccea=await _0x26282f[_0x16e0cc(0x81)](_0x26282f[_0x16e0cc(0x92)][_0x16e0cc(0xb0)]);if(_0xa5ccea&&_0xa5ccea[_0x16e0cc(0xc0)]!==undefined&&_0xa5ccea['val']!==null)return parseFloat(_0xa5ccea[_0x16e0cc(0xc0)]);}catch(_0x396683){}const _0x38f93a=_0x26282f[_0x16e0cc(0x92)][_0x16e0cc(0xef)];if(!_0x26282f['config'][_0x16e0cc(0xa0)]||!_0x38f93a)return null;try{let _0x56ae58='';if(_0x38f93a[_0x16e0cc(0xe0)]('accuweather'))_0x56ae58=_0x38f93a+_0x16e0cc(0x9b);else{if(_0x38f93a[_0x16e0cc(0xe0)](_0x16e0cc(0xea)))_0x56ae58=_0x38f93a+_0x16e0cc(0xf7);else{if(_0x38f93a[_0x16e0cc(0xe0)](_0x16e0cc(0xd2)))_0x56ae58=_0x38f93a+_0x16e0cc(0x91);else{if(_0x38f93a[_0x16e0cc(0xe0)](_0x16e0cc(0x95)))_0x56ae58=_0x38f93a+_0x16e0cc(0xaa);}}}if(_0x56ae58){const _0x5b12ef=await _0x26282f[_0x16e0cc(0x81)](_0x56ae58);if(_0x5b12ef&&_0x5b12ef[_0x16e0cc(0xc0)]!==undefined&&_0x5b12ef['val']!==null)return parseFloat(_0x5b12ef['val']);}}catch(_0x3ad34c){}return null;}async function recordThermodynamics(_0x1bb012,_0x545fc9,_0x4dde53,_0x410e5f){const _0x514837=a5_0x19da09,_0x570f00=await getOutsideTemperatureNumeric(_0x1bb012);if(_0x570f00===null)return;let _0x4c34fe=0x0,_0x1b59d8=![];if(_0x1bb012['config'][_0x514837(0xc6)])try{let _0x3bc416=_0x1bb012[_0x514837(0x92)][_0x514837(0xc6)];if(typeof _0x3bc416===_0x514837(0x99))_0x3bc416=JSON[_0x514837(0x9a)](_0x3bc416);if(_0x3bc416[_0x545fc9]){const _0x5609ab=_0x3bc416[_0x545fc9],_0x368e6f=await _0x1bb012[_0x514837(0x81)](_0x5609ab);if(_0x368e6f&&_0x368e6f[_0x514837(0xc0)]!==null&&_0x368e6f[_0x514837(0xc0)]!==undefined){let _0x246ef6=Number(_0x368e6f[_0x514837(0xc0)]);if(_0x246ef6<=1.05&&!_0x5609ab[_0x514837(0xe0)]('STATUS')&&!_0x5609ab['includes'](_0x514837(0x8a)))_0x246ef6=_0x246ef6*0x64;_0x4c34fe=Math[_0x514837(0xd5)](_0x246ef6),_0x1b59d8=!![];}}}catch(_0x46cff6){}if(!_0x1b59d8){const _0x139683=[{'from':_0x514837(0x88),'to':_0x514837(0xc4)},{'from':_0x514837(0x88),'to':_0x514837(0xb4)},{'from':_0x514837(0x8c),'to':_0x514837(0xc3)},{'from':_0x514837(0xb3),'to':_0x514837(0xac)},{'from':_0x514837(0xab),'to':'level'},{'from':_0x514837(0xe7),'to':_0x514837(0xa9)}];for(const _0x281608 of _0x139683){if(_0x545fc9['includes'](_0x281608[_0x514837(0xee)])){const _0x3a45ce=_0x545fc9[_0x514837(0xd9)](_0x281608[_0x514837(0xee)],_0x281608['to']);try{const _0x388c20=await _0x1bb012[_0x514837(0x81)](_0x3a45ce);if(_0x388c20&&_0x388c20[_0x514837(0xc0)]!==null&&_0x388c20[_0x514837(0xc0)]!==undefined){let _0x2c1615=Number(_0x388c20[_0x514837(0xc0)]);if(typeof _0x2c1615===_0x514837(0xfa)){if(_0x2c1615<=1.05&&_0x281608['to'][_0x514837(0xe0)](_0x514837(0x96)))_0x2c1615=_0x2c1615*0x64;_0x4c34fe=Math[_0x514837(0xd5)](_0x2c1615),_0x1b59d8=!![];break;}}}catch(_0x5e67c3){}}}}const _0x495b2c=await _0x1bb012[_0x514837(0x85)](_0x514837(0xbe));let _0x591f93=[];if(_0x495b2c&&_0x495b2c[_0x514837(0xc0)])try{_0x591f93=JSON[_0x514837(0x9a)](_0x495b2c['val']);}catch(_0x5e6129){}_0x591f93[_0x514837(0xa3)]({'ts':Date[_0x514837(0xc8)](),'room':_0x410e5f||_0x514837(0x82),'t_in':_0x4dde53,'t_out':_0x570f00,'valve':_0x4c34fe});if(_0x591f93[_0x514837(0xf9)]>THERMO_LOG_SIZE)_0x591f93['shift']();await _0x1bb012[_0x514837(0xdd)](_0x514837(0xbe),{'val':JSON[_0x514837(0xcc)](_0x591f93),'ack':!![]});}async function saveCompletedSequence(_0x5a1b3e){const _0x524bdd=a5_0x19da09;try{const _0x538f6=await _0x5a1b3e[_0x524bdd(0x85)](_0x524bdd(0xf4));let _0x5625f3=[];if(_0x538f6&&_0x538f6[_0x524bdd(0xc0)])try{_0x5625f3=JSON['parse'](_0x538f6['val']);}catch(_0xa2d780){}const _0x1e8290=activeSequence[0x0]['ts'],_0x5264ea=activeSequence['map'](_0x2461a7=>({'loc':_0x2461a7[_0x524bdd(0xdf)],'t_delta':Math[_0x524bdd(0xd5)]((_0x2461a7['ts']-_0x1e8290)/0x3e8)})),_0xf9a340={'timestamp':new Date(_0x1e8290)[_0x524bdd(0xcf)](),'steps':_0x5264ea,'duration':Math['round']((activeSequence[activeSequence[_0x524bdd(0xf9)]-0x1]['ts']-_0x1e8290)/0x3e8),'daytime':new Date(_0x1e8290)[_0x524bdd(0xdc)]()};_0x5625f3[_0x524bdd(0xa3)](_0xf9a340);if(_0x5625f3['length']>MAX_TRAINING_SET_SIZE)_0x5625f3[_0x524bdd(0xe6)]();await _0x5a1b3e[_0x524bdd(0xdd)](_0x524bdd(0xf4),{'val':JSON['stringify'](_0x5625f3),'ack':!![]}),_0x5a1b3e[_0x524bdd(0xec)]&&_0x5a1b3e[_0x524bdd(0xdb)]&&_0x5a1b3e['sendToPythonWrapper'](_0x524bdd(0x94),{'sequence':_0xf9a340});}catch(_0x227198){_0x5a1b3e['log'][_0x524bdd(0x8e)](_0x524bdd(0xeb)+_0x227198[_0x524bdd(0xd0)]);}}function a5_0xdb23(){const _0x114115=['openweathermap','griff','heizung','round','normal','unshift','temperatur','replace','apply','sendToPythonWrapper','getHours','setStateAsync','isExit','loc','includes','switch','(((.+)+)+)+$','schloss','230868Psqgzx','präsenz','shift','Temperature','fill','2385544ZEbJSW','daswetter','[RECORDER]\x20Error:\x20','isProVersion','toLowerCase','from','weatherInstance','kontakt','bewegung','contact','lastTrackerEventTime','LTM.trainingData.sequences','35gNlxyj','2298423oELrsw','.NextHours.Location_1.Day_1.current.temp_value','exports','length','number','getForeignStateAsync','Unknown','presence','debug','getStateAsync','analysis.health.todayVector','door','.1.ACTUAL_TEMPERATURE','constructor','STATE','handle','.1.TEMPERATURE','22254caXXbi','error','search','lampe','.forecast.current.temperature','config','schalter','ANALYZE_SEQUENCE','weatherunderground','LEVEL','licht','occupancy','string','parse','.Current.Temperature','isPresent','klima','207KZUIBV','pop','useWeather','rawEventLog','thermostat','push','fenster','some','LTM.rawEventLog','getDate','dimmer','Valve','.forecast.current.temp','temperature','.LEVEL','name','exitGraceTimer','events.history','outdoorSensorId','TRACK_EVENT','\x20from\x20','.ACTUAL_TEMPERATURE','.1.VALVE_STATE','light','location','events.lastEvent','tür','[RECORDER]\x20Ignored\x20implausible\x20temperature:\x20','eventHistory','lock','motion','currentSystemMode','LTM.trainingData.thermodynamics','exitTimer','val','logDuplicates','toString','.4.VALVE_STATE','.1.LEVEL','window','valveMapping','sensorLastValues','now','isGracePeriodActive','2874764ziTzWX','139064rQhWLJ','stringify','type','log','toISOString','message','6941039SUEznz'];a5_0xdb23=function(){return _0x114115;};return a5_0xdb23();}async function recordSequence(_0x4b48e2,_0x119800){const _0x5339c9=a5_0x19da09,_0x36310b=(_0x119800[_0x5339c9(0xcd)]||'')[_0x5339c9(0xed)](),_0x1388d4=[_0x5339c9(0xbc),_0x5339c9(0xf1),_0x5339c9(0xe5),_0x5339c9(0x83),_0x5339c9(0x98),'door',_0x5339c9(0xb8),'window',_0x5339c9(0xa4),_0x5339c9(0xf2),_0x5339c9(0xf0),_0x5339c9(0xb5),_0x5339c9(0x97),_0x5339c9(0xe1),_0x5339c9(0x93),_0x5339c9(0xa8),'lampe'];if(!_0x1388d4[_0x5339c9(0xa5)](_0x375089=>_0x36310b['includes'](_0x375089)))return;if(!_0x119800['value'])return;if(sequenceTimer)clearTimeout(sequenceTimer);activeSequence[_0x5339c9(0xa3)]({'loc':_0x119800['location']||_0x5339c9(0x82),'id':_0x119800['id'],'ts':Date[_0x5339c9(0xc8)]()}),sequenceTimer=setTimeout(async()=>{const _0x309bbe=_0x5339c9;if(activeSequence[_0x309bbe(0xf9)]>0x1)await saveCompletedSequence(_0x4b48e2);activeSequence=[];},SEQUENCE_TIMEOUT_MS);}function startExitTimer(_0x471e55){const _0x31b92e=a5_0x19da09;abortExitTimer(_0x471e55),_0x471e55['isGracePeriodActive']=!![],_0x471e55[_0x31b92e(0xae)]=setTimeout(()=>{_0x471e55['isGracePeriodActive']=![];},EXIT_GRACE_PERIOD_SECONDS*0x3e8),_0x471e55['exitTimer']=setTimeout(()=>{const _0x4d20dc=_0x31b92e;setPresence(_0x471e55,![]),_0x471e55[_0x4d20dc(0xbf)]=null;},EXIT_TIMER_MINUTES*0x3c*0x3e8);}function abortExitTimer(_0x4c0bb6){const _0x4bad7b=a5_0x19da09;if(_0x4c0bb6[_0x4bad7b(0xbf)])clearTimeout(_0x4c0bb6[_0x4bad7b(0xbf)]);if(_0x4c0bb6['exitGraceTimer'])clearTimeout(_0x4c0bb6[_0x4bad7b(0xae)]);_0x4c0bb6['exitTimer']=null,_0x4c0bb6[_0x4bad7b(0xae)]=null,_0x4c0bb6[_0x4bad7b(0xc9)]=![];}async function setPresence(_0x4dab7e,_0x2421cf){const _0x25f58e=a5_0x19da09;if(_0x4dab7e[_0x25f58e(0x9c)]===_0x2421cf)return;_0x4dab7e[_0x25f58e(0x9c)]=_0x2421cf,await _0x4dab7e['setStateAsync']('system.isPresent',{'val':_0x2421cf,'ack':!![]});}async function updateHourlyActivity(_0x1be07f){const _0x596a5f=a5_0x19da09,_0x16c753=new Date()['getDate']();_0x16c753!==lastLogDay&&(dailyActivityLog=new Array(0x18)[_0x596a5f(0xe8)](0x0),lastLogDay=_0x16c753);const _0x427019=new Date()[_0x596a5f(0xdc)]();if(dailyActivityLog[_0x427019]===undefined)dailyActivityLog[_0x427019]=0x0;dailyActivityLog[_0x427019]++,await _0x1be07f['setStateAsync'](_0x596a5f(0x86),{'val':JSON[_0x596a5f(0xcc)](dailyActivityLog),'ack':!![]});}async function processSensorEvent(_0x4087f5,_0x1a828a,_0x234bad,_0x38e598){const _0x320e9f=a5_0x19da09;if(!_0x38e598)return null;const _0x91abc6=_0x234bad[_0x320e9f(0xc0)],_0x378107=Date[_0x320e9f(0xc8)](),_0x5a1c4b=_0x4087f5[_0x320e9f(0xc7)][_0x1a828a],_0x5339e5=(_0x38e598[_0x320e9f(0xcd)]||'')[_0x320e9f(0xed)](),_0x12a788=_0x5339e5['includes']('temperature')||_0x5339e5[_0x320e9f(0xe0)](_0x320e9f(0xd8))||_0x5339e5[_0x320e9f(0xe0)](_0x320e9f(0x9d))||_0x5339e5[_0x320e9f(0xe0)](_0x320e9f(0xd4))||_0x5339e5['includes'](_0x320e9f(0xa2));if(_0x12a788&&typeof _0x91abc6===_0x320e9f(0xfa)){if(_0x91abc6>0x50||_0x91abc6<-0x32)return _0x4087f5[_0x320e9f(0xce)][_0x320e9f(0x84)](_0x320e9f(0xb9)+_0x91abc6+_0x320e9f(0xb2)+_0x1a828a),null;}_0x4087f5[_0x320e9f(0xc7)][_0x1a828a]=_0x91abc6;if(!_0x38e598[_0x320e9f(0xc1)]&&_0x5a1c4b!=undefined&&_0x5a1c4b==_0x91abc6)return null;_0x4087f5['isProVersion']&&_0x12a788&&recordThermodynamics(_0x4087f5,_0x1a828a,_0x91abc6,_0x38e598['location']);const _0x11bd5c={'timestamp':_0x378107,'id':_0x1a828a,'name':_0x38e598[_0x320e9f(0xad)],'type':_0x38e598[_0x320e9f(0xcd)],'location':_0x38e598[_0x320e9f(0xb6)],'value':_0x91abc6};_0x4087f5['eventHistory'][_0x320e9f(0xd7)](_0x11bd5c);if(_0x4087f5[_0x320e9f(0xba)]['length']>HISTORY_MAX_SIZE)_0x4087f5[_0x320e9f(0xba)][_0x320e9f(0x9f)]();await _0x4087f5[_0x320e9f(0xdd)](_0x320e9f(0xb7),{'val':JSON['stringify'](_0x11bd5c),'ack':!![]}),await _0x4087f5[_0x320e9f(0xdd)](_0x320e9f(0xaf),{'val':JSON[_0x320e9f(0xcc)](_0x4087f5[_0x320e9f(0xba)]),'ack':!![]}),await updateHourlyActivity(_0x4087f5);if(_0x4087f5['isProVersion']){_0x4087f5['rawEventLog'][_0x320e9f(0xa3)](_0x11bd5c);if(_0x4087f5[_0x320e9f(0xa1)][_0x320e9f(0xf9)]>RAW_LOG_MAX_SIZE)_0x4087f5[_0x320e9f(0xa1)]['splice'](0x0,_0x4087f5['rawEventLog'][_0x320e9f(0xf9)]-RAW_LOG_MAX_SIZE);await _0x4087f5['setStateAsync'](_0x320e9f(0xa6),{'val':JSON[_0x320e9f(0xcc)](_0x4087f5[_0x320e9f(0xa1)]),'ack':!![]}),recordSequence(_0x4087f5,_0x11bd5c);}if(_0x38e598[_0x320e9f(0xde)]&&_0x91abc6===!![]){if(_0x4087f5[_0x320e9f(0x9c)]&&!_0x4087f5[_0x320e9f(0xc9)])startExitTimer(_0x4087f5);else{if(!_0x4087f5[_0x320e9f(0x9c)])setPresence(_0x4087f5,!![]);}}else{if(_0x38e598['type']===_0x320e9f(0xbc)&&_0x91abc6===!![]){if(_0x4087f5[_0x320e9f(0xbf)])abortExitTimer(_0x4087f5);if(!_0x4087f5[_0x320e9f(0x9c)]&&_0x4087f5[_0x320e9f(0xbd)]===_0x320e9f(0xd6))setPresence(_0x4087f5,!![]);}}if(_0x4087f5[_0x320e9f(0xec)]&&_0x4087f5[_0x320e9f(0xdb)]){_0x38e598['type']===_0x320e9f(0xbc)&&_0x91abc6===!![]&&_0x38e598['location']&&_0x4087f5[_0x320e9f(0xdb)]('SIMULATE_SIGNAL',{'room':_0x38e598[_0x320e9f(0xb6)]});const _0x1f7747=[_0x320e9f(0x87),'tür',_0x320e9f(0xc5),'fenster',_0x320e9f(0xd3),_0x320e9f(0x8b),_0x320e9f(0xbb),_0x320e9f(0xe3)][_0x320e9f(0xa5)](_0x4c0704=>_0x5339e5[_0x320e9f(0xe0)](_0x4c0704)),_0x46f798=[_0x320e9f(0xb5),'licht','switch','schalter','dimmer',_0x320e9f(0x90)][_0x320e9f(0xa5)](_0x52c1d8=>_0x5339e5[_0x320e9f(0xe0)](_0x52c1d8)),_0x2f3cd7=[_0x320e9f(0xbc),_0x320e9f(0xf1),_0x320e9f(0xe5),_0x320e9f(0x83),'occupancy'][_0x320e9f(0xa5)](_0x501a41=>_0x5339e5['includes'](_0x501a41));if(_0x38e598[_0x320e9f(0xb6)]&&(_0x1f7747||_0x46f798||_0x2f3cd7)){const _0x271529=_0x91abc6===!![]||typeof _0x91abc6===_0x320e9f(0xfa)&&_0x91abc6>0x0,_0x2d7684=_0x1f7747&&!_0x271529&&_0x5a1c4b!==undefined&&_0x5a1c4b!=_0x91abc6;if(_0x271529||_0x2d7684){const _0x854ba5=_0x4087f5[_0x320e9f(0xf3)]||_0x378107,_0x51b6a7=(_0x378107-_0x854ba5)/0x3e8;_0x4087f5['lastTrackerEventTime']=_0x378107,_0x4087f5[_0x320e9f(0xdb)](_0x320e9f(0xb1),{'room':_0x38e598[_0x320e9f(0xb6)],'dt':_0x51b6a7});}}}return _0x11bd5c;}module[a5_0x19da09(0xf8)]={'processSensorEvent':processSensorEvent,'getOutsideTemperatureNumeric':getOutsideTemperatureNumeric,'setPresence':setPresence,'abortExitTimer':abortExitTimer,'startExitTimer':startExitTimer};