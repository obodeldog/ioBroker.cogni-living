(function(_0x55774e,_0x4865f6){const _0x36d5c2=a5_0x1685,_0x1fc445=_0x55774e();while(!![]){try{const _0x2f9921=parseInt(_0x36d5c2(0xdc))/0x1+parseInt(_0x36d5c2(0x9e))/0x2+parseInt(_0x36d5c2(0x84))/0x3+-parseInt(_0x36d5c2(0xd7))/0x4+parseInt(_0x36d5c2(0xd0))/0x5*(parseInt(_0x36d5c2(0x87))/0x6)+parseInt(_0x36d5c2(0xdb))/0x7*(parseInt(_0x36d5c2(0xaf))/0x8)+-parseInt(_0x36d5c2(0xce))/0x9*(parseInt(_0x36d5c2(0xba))/0xa);if(_0x2f9921===_0x4865f6)break;else _0x1fc445['push'](_0x1fc445['shift']());}catch(_0x2a38cc){_0x1fc445['push'](_0x1fc445['shift']());}}}(a5_0x38d1,0x691e0));function a5_0x38d1(){const _0x58a7d4=['präsenz','log','lastTrackerEventTime','switch','message','heizung','temperature','presence','sendToPythonWrapper','weatherunderground','daswetter','1472283lmuRHi','setStateAsync','dimmer','150vKTxox','getHours','isProVersion','map','LTM.trainingData.thermodynamics','length','lampe','.1.VALVE_STATE','.4.VALVE_STATE','string','openweathermap','val','(((.+)+)+)+$','unshift','valveMapping','eventHistory','weatherInstance','contact','LTM.rawEventLog','getForeignStateAsync','Unknown','normal','value','544434dmZdvS','getStateAsync','sensorLastValues','number','includes','push','isGracePeriodActive','thermostat','apply','toLowerCase','constructor','tür','STATE','accuweather','now','exitGraceTimer','useWeather','20008JvBcTu','some','[RECORDER]\x20Error:\x20','isPresent','motion','klima','toString','round','rawEventLog','replace','occupancy','3254740YMbTKj','location','bewegung','name','stringify','search','parse','type','.1.LEVEL','.LEVEL','system.isPresent','exitTimer','shift','currentSystemMode','isExit','outdoorSensorId','LTM.trainingData.sequences','griff','\x20from\x20','STATUS','36SIqkOL','schalter','135535IdMbhF','TRACK_EVENT','licht','window','Valve','events.history','config','2435776pentIL','.NextHours.Location_1.Day_1.current.temp_value','from','.1.ACTUAL_TEMPERATURE','553dUKJfC','703168hjjaeY','[RECORDER]\x20Ignored\x20implausible\x20temperature:\x20','temperatur','door','logDuplicates','.forecast.current.temperature','lock','fenster','Temperature'];a5_0x38d1=function(){return _0x58a7d4;};return a5_0x38d1();}const a5_0x344ac8=(function(){let _0x14a9bb=!![];return function(_0x241bb7,_0x25ff2b){const _0x14d93f=_0x14a9bb?function(){const _0x2f9180=a5_0x1685;if(_0x25ff2b){const _0x28d120=_0x25ff2b[_0x2f9180(0xa6)](_0x241bb7,arguments);return _0x25ff2b=null,_0x28d120;}}:function(){};return _0x14a9bb=![],_0x14d93f;};}()),a5_0x13484f=a5_0x344ac8(this,function(){const _0x49403d=a5_0x1685;return a5_0x13484f[_0x49403d(0xb5)]()[_0x49403d(0xbf)](_0x49403d(0x93))[_0x49403d(0xb5)]()[_0x49403d(0xa8)](a5_0x13484f)['search'](_0x49403d(0x93));});a5_0x13484f();'use strict';const HISTORY_MAX_SIZE=0x32,RAW_LOG_MAX_SIZE=0x9c4,THERMO_LOG_SIZE=0x3e8,SEQUENCE_TIMEOUT_MS=0x5*0x3c*0x3e8,MAX_TRAINING_SET_SIZE=0x1f4,EXIT_TIMER_MINUTES=0xf,EXIT_GRACE_PERIOD_SECONDS=0x1e;let activeSequence=[],sequenceTimer=null;function a5_0x1685(_0x277484,_0x2a3f18){const _0x15bd98=a5_0x38d1();return a5_0x1685=function(_0x13484f,_0x344ac8){_0x13484f=_0x13484f-0x80;let _0x38d19f=_0x15bd98[_0x13484f];return _0x38d19f;},a5_0x1685(_0x277484,_0x2a3f18);}async function getOutsideTemperatureNumeric(_0x3dffc0){const _0x666090=a5_0x1685;if(_0x3dffc0[_0x666090(0xd6)][_0x666090(0xc9)])try{const _0xb65152=await _0x3dffc0[_0x666090(0x9a)](_0x3dffc0[_0x666090(0xd6)][_0x666090(0xc9)]);if(_0xb65152&&_0xb65152[_0x666090(0x92)]!==undefined&&_0xb65152[_0x666090(0x92)]!==null)return parseFloat(_0xb65152[_0x666090(0x92)]);}catch(_0x4a683a){}const _0x2446b6=_0x3dffc0[_0x666090(0xd6)][_0x666090(0x97)];if(!_0x3dffc0[_0x666090(0xd6)][_0x666090(0xae)]||!_0x2446b6)return null;try{let _0xa61247='';if(_0x2446b6['includes'](_0x666090(0xab)))_0xa61247=_0x2446b6+'.Current.Temperature';else{if(_0x2446b6['includes'](_0x666090(0x83)))_0xa61247=_0x2446b6+_0x666090(0xd8);else{if(_0x2446b6[_0x666090(0xa2)](_0x666090(0x91)))_0xa61247=_0x2446b6+_0x666090(0xe1);else{if(_0x2446b6['includes'](_0x666090(0x82)))_0xa61247=_0x2446b6+'.forecast.current.temp';}}}if(_0xa61247){const _0x4a67aa=await _0x3dffc0[_0x666090(0x9a)](_0xa61247);if(_0x4a67aa&&_0x4a67aa[_0x666090(0x92)]!==undefined&&_0x4a67aa[_0x666090(0x92)]!==null)return parseFloat(_0x4a67aa[_0x666090(0x92)]);}}catch(_0x49c479){}return null;}async function recordThermodynamics(_0x2bcbfc,_0x7292a3,_0x12de31,_0x33db83){const _0x2a7f16=a5_0x1685,_0x2ac0ed=await getOutsideTemperatureNumeric(_0x2bcbfc);if(_0x2ac0ed===null)return;let _0x226bf0=0x0,_0x1c9e67=![];if(_0x2bcbfc['config']['valveMapping'])try{let _0x25a926=_0x2bcbfc[_0x2a7f16(0xd6)][_0x2a7f16(0x95)];if(typeof _0x25a926===_0x2a7f16(0x90))_0x25a926=JSON[_0x2a7f16(0xc0)](_0x25a926);if(_0x25a926[_0x7292a3]){const _0x44b520=_0x25a926[_0x7292a3],_0x803ff1=await _0x2bcbfc['getForeignStateAsync'](_0x44b520);if(_0x803ff1&&_0x803ff1[_0x2a7f16(0x92)]!==null&&_0x803ff1[_0x2a7f16(0x92)]!==undefined){let _0x5a9b64=Number(_0x803ff1[_0x2a7f16(0x92)]);if(_0x5a9b64<=1.05&&!_0x44b520[_0x2a7f16(0xa2)](_0x2a7f16(0xcd))&&!_0x44b520[_0x2a7f16(0xa2)](_0x2a7f16(0xaa)))_0x5a9b64=_0x5a9b64*0x64;_0x226bf0=Math['round'](_0x5a9b64),_0x1c9e67=!![];}}}catch(_0xdf19f6){}if(!_0x1c9e67){const _0x3df7b9=[{'from':'.1.ACTUAL_TEMPERATURE','to':_0x2a7f16(0xc2)},{'from':_0x2a7f16(0xda),'to':_0x2a7f16(0x8e)},{'from':'.1.TEMPERATURE','to':_0x2a7f16(0x8f)},{'from':'.ACTUAL_TEMPERATURE','to':_0x2a7f16(0xc3)},{'from':_0x2a7f16(0xeb),'to':'level'},{'from':_0x2a7f16(0xe4),'to':_0x2a7f16(0xd4)}];for(const _0x45e264 of _0x3df7b9){if(_0x7292a3[_0x2a7f16(0xa2)](_0x45e264[_0x2a7f16(0xd9)])){const _0x4c4f5=_0x7292a3[_0x2a7f16(0xb8)](_0x45e264[_0x2a7f16(0xd9)],_0x45e264['to']);try{const _0x1d94bf=await _0x2bcbfc['getForeignStateAsync'](_0x4c4f5);if(_0x1d94bf&&_0x1d94bf[_0x2a7f16(0x92)]!==null&&_0x1d94bf['val']!==undefined){let _0x1d581d=Number(_0x1d94bf[_0x2a7f16(0x92)]);if(typeof _0x1d581d===_0x2a7f16(0xa1)){if(_0x1d581d<=1.05&&_0x45e264['to'][_0x2a7f16(0xa2)]('LEVEL'))_0x1d581d=_0x1d581d*0x64;_0x226bf0=Math[_0x2a7f16(0xb6)](_0x1d581d),_0x1c9e67=!![];break;}}}catch(_0xa4c351){}}}}const _0x12b499=await _0x2bcbfc[_0x2a7f16(0x9f)](_0x2a7f16(0x8b));let _0x2e41f3=[];if(_0x12b499&&_0x12b499[_0x2a7f16(0x92)])try{_0x2e41f3=JSON['parse'](_0x12b499[_0x2a7f16(0x92)]);}catch(_0x4bd285){}_0x2e41f3[_0x2a7f16(0xa3)]({'ts':Date['now'](),'room':_0x33db83||_0x2a7f16(0x9b),'t_in':_0x12de31,'t_out':_0x2ac0ed,'valve':_0x226bf0});if(_0x2e41f3[_0x2a7f16(0x8c)]>THERMO_LOG_SIZE)_0x2e41f3[_0x2a7f16(0xc6)]();await _0x2bcbfc['setStateAsync']('LTM.trainingData.thermodynamics',{'val':JSON[_0x2a7f16(0xbe)](_0x2e41f3),'ack':!![]});}async function saveCompletedSequence(_0x38153e){const _0x59bf1c=a5_0x1685;try{const _0x429ec7=await _0x38153e[_0x59bf1c(0x9f)](_0x59bf1c(0xca));let _0x30c512=[];if(_0x429ec7&&_0x429ec7['val'])try{_0x30c512=JSON[_0x59bf1c(0xc0)](_0x429ec7[_0x59bf1c(0x92)]);}catch(_0x40c328){}const _0x5a7ee3=activeSequence[0x0]['ts'],_0x10befc=activeSequence[_0x59bf1c(0x8a)](_0x2f665f=>({'loc':_0x2f665f['loc'],'t_delta':Math['round']((_0x2f665f['ts']-_0x5a7ee3)/0x3e8)})),_0x11eedc={'timestamp':new Date(_0x5a7ee3)['toISOString'](),'steps':_0x10befc,'duration':Math[_0x59bf1c(0xb6)]((activeSequence[activeSequence[_0x59bf1c(0x8c)]-0x1]['ts']-_0x5a7ee3)/0x3e8),'daytime':new Date(_0x5a7ee3)[_0x59bf1c(0x88)]()};_0x30c512[_0x59bf1c(0xa3)](_0x11eedc);if(_0x30c512['length']>MAX_TRAINING_SET_SIZE)_0x30c512['shift']();await _0x38153e[_0x59bf1c(0x85)](_0x59bf1c(0xca),{'val':JSON[_0x59bf1c(0xbe)](_0x30c512),'ack':!![]}),_0x38153e[_0x59bf1c(0x89)]&&_0x38153e['sendToPythonWrapper']&&_0x38153e[_0x59bf1c(0x81)]('ANALYZE_SEQUENCE',{'sequence':_0x11eedc});}catch(_0x2fde6e){_0x38153e['log']['error'](_0x59bf1c(0xb1)+_0x2fde6e[_0x59bf1c(0xe9)]);}}async function recordSequence(_0xd887b3,_0xa83244){const _0x2694e4=a5_0x1685,_0x3100e0=(_0xa83244['type']||'')[_0x2694e4(0xa7)](),_0x2fda88=[_0x2694e4(0xb3),'bewegung',_0x2694e4(0xe5),'presence',_0x2694e4(0xb9),_0x2694e4(0xdf),_0x2694e4(0xa9),'window',_0x2694e4(0xe3),_0x2694e4(0x98),'kontakt','light',_0x2694e4(0xd2),_0x2694e4(0xe8),_0x2694e4(0xcf),_0x2694e4(0x86),_0x2694e4(0x8d)];if(!_0x2fda88[_0x2694e4(0xb0)](_0x477d27=>_0x3100e0[_0x2694e4(0xa2)](_0x477d27)))return;if(!_0xa83244[_0x2694e4(0x9d)])return;if(sequenceTimer)clearTimeout(sequenceTimer);activeSequence[_0x2694e4(0xa3)]({'loc':_0xa83244[_0x2694e4(0xbb)]||_0x2694e4(0x9b),'id':_0xa83244['id'],'ts':Date[_0x2694e4(0xac)]()}),sequenceTimer=setTimeout(async()=>{const _0xd13498=_0x2694e4;if(activeSequence[_0xd13498(0x8c)]>0x1)await saveCompletedSequence(_0xd887b3);activeSequence=[];},SEQUENCE_TIMEOUT_MS);}function startExitTimer(_0x3761b7){const _0x4f29f5=a5_0x1685;abortExitTimer(_0x3761b7),_0x3761b7[_0x4f29f5(0xa4)]=!![],_0x3761b7[_0x4f29f5(0xad)]=setTimeout(()=>{const _0x5257c2=_0x4f29f5;_0x3761b7[_0x5257c2(0xa4)]=![];},EXIT_GRACE_PERIOD_SECONDS*0x3e8),_0x3761b7['exitTimer']=setTimeout(()=>{setPresence(_0x3761b7,![]),_0x3761b7['exitTimer']=null;},EXIT_TIMER_MINUTES*0x3c*0x3e8);}function abortExitTimer(_0x18d8e2){const _0x193cb1=a5_0x1685;if(_0x18d8e2[_0x193cb1(0xc5)])clearTimeout(_0x18d8e2[_0x193cb1(0xc5)]);if(_0x18d8e2[_0x193cb1(0xad)])clearTimeout(_0x18d8e2[_0x193cb1(0xad)]);_0x18d8e2['exitTimer']=null,_0x18d8e2['exitGraceTimer']=null,_0x18d8e2[_0x193cb1(0xa4)]=![];}async function setPresence(_0x287cb7,_0xabbc0b){const _0x2efcf1=a5_0x1685;if(_0x287cb7[_0x2efcf1(0xb2)]===_0xabbc0b)return;_0x287cb7[_0x2efcf1(0xb2)]=_0xabbc0b,await _0x287cb7[_0x2efcf1(0x85)](_0x2efcf1(0xc4),{'val':_0xabbc0b,'ack':!![]});}async function processSensorEvent(_0x136e38,_0x5bd4b4,_0x317098,_0x4e4898){const _0x1eec74=a5_0x1685;if(!_0x4e4898)return null;const _0x5e5e9c=_0x317098[_0x1eec74(0x92)],_0x554857=Date[_0x1eec74(0xac)](),_0x11451d=_0x136e38[_0x1eec74(0xa0)][_0x5bd4b4],_0x11869b=(_0x4e4898[_0x1eec74(0xc1)]||'')[_0x1eec74(0xa7)](),_0x365503=_0x11869b[_0x1eec74(0xa2)](_0x1eec74(0xeb))||_0x11869b[_0x1eec74(0xa2)](_0x1eec74(0xde))||_0x11869b[_0x1eec74(0xa2)](_0x1eec74(0xb4))||_0x11869b[_0x1eec74(0xa2)](_0x1eec74(0xea))||_0x11869b[_0x1eec74(0xa2)](_0x1eec74(0xa5));if(_0x365503&&typeof _0x5e5e9c===_0x1eec74(0xa1)){if(_0x5e5e9c>0x50||_0x5e5e9c<-0x32)return _0x136e38[_0x1eec74(0xe6)]['debug'](_0x1eec74(0xdd)+_0x5e5e9c+_0x1eec74(0xcc)+_0x5bd4b4),null;}_0x136e38[_0x1eec74(0xa0)][_0x5bd4b4]=_0x5e5e9c;if(!_0x4e4898[_0x1eec74(0xe0)]&&_0x11451d!=undefined&&_0x11451d==_0x5e5e9c)return null;_0x136e38[_0x1eec74(0x89)]&&_0x365503&&recordThermodynamics(_0x136e38,_0x5bd4b4,_0x5e5e9c,_0x4e4898[_0x1eec74(0xbb)]);const _0x1a288b={'timestamp':_0x554857,'id':_0x5bd4b4,'name':_0x4e4898[_0x1eec74(0xbd)],'type':_0x4e4898[_0x1eec74(0xc1)],'location':_0x4e4898['location'],'value':_0x5e5e9c};_0x136e38[_0x1eec74(0x96)][_0x1eec74(0x94)](_0x1a288b);if(_0x136e38['eventHistory']['length']>HISTORY_MAX_SIZE)_0x136e38[_0x1eec74(0x96)]['pop']();await _0x136e38[_0x1eec74(0x85)]('events.lastEvent',{'val':JSON['stringify'](_0x1a288b),'ack':!![]}),await _0x136e38[_0x1eec74(0x85)](_0x1eec74(0xd5),{'val':JSON[_0x1eec74(0xbe)](_0x136e38[_0x1eec74(0x96)]),'ack':!![]});if(_0x136e38[_0x1eec74(0x89)]){_0x136e38['rawEventLog'][_0x1eec74(0xa3)](_0x1a288b);if(_0x136e38[_0x1eec74(0xb7)][_0x1eec74(0x8c)]>RAW_LOG_MAX_SIZE)_0x136e38[_0x1eec74(0xb7)]['splice'](0x0,_0x136e38[_0x1eec74(0xb7)][_0x1eec74(0x8c)]-RAW_LOG_MAX_SIZE);await _0x136e38['setStateAsync'](_0x1eec74(0x99),{'val':JSON[_0x1eec74(0xbe)](_0x136e38['rawEventLog']),'ack':!![]}),recordSequence(_0x136e38,_0x1a288b);}if(_0x4e4898[_0x1eec74(0xc8)]&&_0x5e5e9c===!![]){if(_0x136e38[_0x1eec74(0xb2)]&&!_0x136e38[_0x1eec74(0xa4)])startExitTimer(_0x136e38);else{if(!_0x136e38['isPresent'])setPresence(_0x136e38,!![]);}}else{if(_0x4e4898['type']===_0x1eec74(0xb3)&&_0x5e5e9c===!![]){if(_0x136e38[_0x1eec74(0xc5)])abortExitTimer(_0x136e38);if(!_0x136e38[_0x1eec74(0xb2)]&&_0x136e38[_0x1eec74(0xc7)]===_0x1eec74(0x9c))setPresence(_0x136e38,!![]);}}if(_0x136e38[_0x1eec74(0x89)]&&_0x136e38['sendToPythonWrapper']){_0x4e4898['type']===_0x1eec74(0xb3)&&_0x5e5e9c===!![]&&_0x4e4898[_0x1eec74(0xbb)]&&_0x136e38['sendToPythonWrapper']('SIMULATE_SIGNAL',{'room':_0x4e4898[_0x1eec74(0xbb)]});const _0x2ae030=[_0x1eec74(0xdf),_0x1eec74(0xa9),_0x1eec74(0xd3),'fenster',_0x1eec74(0xcb),'handle',_0x1eec74(0xe2),'schloss'][_0x1eec74(0xb0)](_0x460fde=>_0x11869b[_0x1eec74(0xa2)](_0x460fde)),_0x30af20=['light',_0x1eec74(0xd2),'switch',_0x1eec74(0xcf),_0x1eec74(0x86),_0x1eec74(0x8d)][_0x1eec74(0xb0)](_0x2e188e=>_0x11869b['includes'](_0x2e188e)),_0x1f8f71=[_0x1eec74(0xb3),_0x1eec74(0xbc),_0x1eec74(0xe5),_0x1eec74(0x80),_0x1eec74(0xb9)]['some'](_0x534e86=>_0x11869b[_0x1eec74(0xa2)](_0x534e86));if(_0x4e4898[_0x1eec74(0xbb)]&&(_0x2ae030||_0x30af20||_0x1f8f71)){const _0x6a4068=_0x5e5e9c===!![]||typeof _0x5e5e9c===_0x1eec74(0xa1)&&_0x5e5e9c>0x0,_0x5d7d80=_0x2ae030&&!_0x6a4068&&_0x11451d!==undefined&&_0x11451d!=_0x5e5e9c;if(_0x6a4068||_0x5d7d80){const _0x3a624d=_0x136e38[_0x1eec74(0xe7)]||_0x554857,_0x42a232=(_0x554857-_0x3a624d)/0x3e8;_0x136e38[_0x1eec74(0xe7)]=_0x554857,_0x136e38[_0x1eec74(0x81)](_0x1eec74(0xd1),{'room':_0x4e4898['location'],'dt':_0x42a232});}}}return _0x1a288b;}module['exports']={'processSensorEvent':processSensorEvent,'getOutsideTemperatureNumeric':getOutsideTemperatureNumeric,'setPresence':setPresence,'abortExitTimer':abortExitTimer,'startExitTimer':startExitTimer};