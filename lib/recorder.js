const a5_0x289903=a5_0xa06d;(function(_0x1b8e17,_0x5d4ba1){const _0x2ebc21=a5_0xa06d,_0x3cf681=_0x1b8e17();while(!![]){try{const _0xeb6122=parseInt(_0x2ebc21(0x161))/0x1+-parseInt(_0x2ebc21(0x169))/0x2+parseInt(_0x2ebc21(0x151))/0x3+-parseInt(_0x2ebc21(0x16e))/0x4*(-parseInt(_0x2ebc21(0x153))/0x5)+parseInt(_0x2ebc21(0x13f))/0x6+parseInt(_0x2ebc21(0x159))/0x7*(-parseInt(_0x2ebc21(0x143))/0x8)+-parseInt(_0x2ebc21(0x16d))/0x9;if(_0xeb6122===_0x5d4ba1)break;else _0x3cf681['push'](_0x3cf681['shift']());}catch(_0x575e08){_0x3cf681['push'](_0x3cf681['shift']());}}}(a5_0x441b,0x88ae8));const a5_0x5b42b4=(function(){let _0x41ea5f=!![];return function(_0x5ab6ba,_0x100a22){const _0x4097d6=_0x41ea5f?function(){if(_0x100a22){const _0xae65db=_0x100a22['apply'](_0x5ab6ba,arguments);return _0x100a22=null,_0xae65db;}}:function(){};return _0x41ea5f=![],_0x4097d6;};}()),a5_0x1f6880=a5_0x5b42b4(this,function(){const _0x1449e5=a5_0xa06d;return a5_0x1f6880[_0x1449e5(0x124)]()[_0x1449e5(0x128)](_0x1449e5(0x13c))[_0x1449e5(0x124)]()[_0x1449e5(0x119)](a5_0x1f6880)[_0x1449e5(0x128)](_0x1449e5(0x13c));});a5_0x1f6880();'use strict';function a5_0xa06d(_0x3f364c,_0x3afaa6){const _0x3c347e=a5_0x441b();return a5_0xa06d=function(_0x1f6880,_0x5b42b4){_0x1f6880=_0x1f6880-0x113;let _0x441b08=_0x3c347e[_0x1f6880];return _0x441b08;},a5_0xa06d(_0x3f364c,_0x3afaa6);}const HISTORY_MAX_SIZE=0x32,RAW_LOG_MAX_SIZE=0x9c4,THERMO_LOG_SIZE=0x3e8,SEQUENCE_TIMEOUT_MS=0x5*0x3c*0x3e8,MAX_TRAINING_SET_SIZE=0x1f4,EXIT_TIMER_MINUTES=0xf,EXIT_GRACE_PERIOD_SECONDS=0x1e;let activeSequence=[],sequenceTimer=null;async function getOutsideTemperatureNumeric(_0x979689){const _0xc67c6d=a5_0xa06d;if(_0x979689[_0xc67c6d(0x179)][_0xc67c6d(0x15d)])try{const _0x209909=await _0x979689['getForeignStateAsync'](_0x979689[_0xc67c6d(0x179)]['outdoorSensorId']);if(_0x209909&&_0x209909[_0xc67c6d(0x139)]!==undefined&&_0x209909[_0xc67c6d(0x139)]!==null)return parseFloat(_0x209909[_0xc67c6d(0x139)]);}catch(_0x49ac7d){}const _0x34c405=_0x979689['config'][_0xc67c6d(0x173)];if(!_0x979689[_0xc67c6d(0x179)]['useWeather']||!_0x34c405)return null;try{let _0x1d47a3='';if(_0x34c405['includes'](_0xc67c6d(0x114)))_0x1d47a3=_0x34c405+_0xc67c6d(0x16b);else{if(_0x34c405[_0xc67c6d(0x12e)](_0xc67c6d(0x136)))_0x1d47a3=_0x34c405+_0xc67c6d(0x116);else{if(_0x34c405[_0xc67c6d(0x12e)](_0xc67c6d(0x174)))_0x1d47a3=_0x34c405+'.forecast.current.temperature';else{if(_0x34c405[_0xc67c6d(0x12e)](_0xc67c6d(0x150)))_0x1d47a3=_0x34c405+'.forecast.current.temp';}}}if(_0x1d47a3){const _0x3b67cd=await _0x979689[_0xc67c6d(0x17a)](_0x1d47a3);if(_0x3b67cd&&_0x3b67cd[_0xc67c6d(0x139)]!==undefined&&_0x3b67cd[_0xc67c6d(0x139)]!==null)return parseFloat(_0x3b67cd[_0xc67c6d(0x139)]);}}catch(_0xf8d681){}return null;}async function recordThermodynamics(_0x37a2d7,_0x26b631,_0xd4141b,_0x18050c){const _0x210d6a=a5_0xa06d,_0x56a344=await getOutsideTemperatureNumeric(_0x37a2d7);if(_0x56a344===null)return;let _0x3fb394=0x0,_0x5719f6=![];if(_0x37a2d7[_0x210d6a(0x179)]['valveMapping'])try{let _0xec2d08=_0x37a2d7['config'][_0x210d6a(0x14e)];if(typeof _0xec2d08===_0x210d6a(0x13b))_0xec2d08=JSON[_0x210d6a(0x165)](_0xec2d08);if(_0xec2d08[_0x26b631]){const _0x5c4d7d=_0xec2d08[_0x26b631],_0x1e0f18=await _0x37a2d7[_0x210d6a(0x17a)](_0x5c4d7d);if(_0x1e0f18&&_0x1e0f18[_0x210d6a(0x139)]!==null&&_0x1e0f18[_0x210d6a(0x139)]!==undefined){let _0x15c821=Number(_0x1e0f18[_0x210d6a(0x139)]);if(_0x15c821<=1.05&&!_0x5c4d7d[_0x210d6a(0x12e)]('STATUS')&&!_0x5c4d7d[_0x210d6a(0x12e)](_0x210d6a(0x12b)))_0x15c821=_0x15c821*0x64;_0x3fb394=Math[_0x210d6a(0x11e)](_0x15c821),_0x5719f6=!![];}}}catch(_0x3b9eee){}if(!_0x5719f6){const _0x36a43e=[{'from':_0x210d6a(0x121),'to':_0x210d6a(0x164)},{'from':_0x210d6a(0x121),'to':_0x210d6a(0x13a)},{'from':'.1.TEMPERATURE','to':_0x210d6a(0x118)},{'from':'.ACTUAL_TEMPERATURE','to':'.LEVEL'},{'from':_0x210d6a(0x133),'to':'level'},{'from':_0x210d6a(0x154),'to':_0x210d6a(0x16c)}];for(const _0x82fa05 of _0x36a43e){if(_0x26b631[_0x210d6a(0x12e)](_0x82fa05[_0x210d6a(0x115)])){const _0xa76b5=_0x26b631[_0x210d6a(0x142)](_0x82fa05[_0x210d6a(0x115)],_0x82fa05['to']);try{const _0x1f2952=await _0x37a2d7[_0x210d6a(0x17a)](_0xa76b5);if(_0x1f2952&&_0x1f2952[_0x210d6a(0x139)]!==null&&_0x1f2952['val']!==undefined){let _0x5c3943=Number(_0x1f2952[_0x210d6a(0x139)]);if(typeof _0x5c3943==='number'){if(_0x5c3943<=1.05&&_0x82fa05['to'][_0x210d6a(0x12e)](_0x210d6a(0x17b)))_0x5c3943=_0x5c3943*0x64;_0x3fb394=Math['round'](_0x5c3943),_0x5719f6=!![];break;}}}catch(_0x4808f2){}}}}const _0x29cece=await _0x37a2d7[_0x210d6a(0x135)](_0x210d6a(0x178));let _0x156ba9=[];if(_0x29cece&&_0x29cece['val'])try{_0x156ba9=JSON[_0x210d6a(0x165)](_0x29cece[_0x210d6a(0x139)]);}catch(_0x1e15b2){}_0x156ba9[_0x210d6a(0x127)]({'ts':Date[_0x210d6a(0x145)](),'room':_0x18050c||_0x210d6a(0x146),'t_in':_0xd4141b,'t_out':_0x56a344,'valve':_0x3fb394});if(_0x156ba9[_0x210d6a(0x15f)]>THERMO_LOG_SIZE)_0x156ba9['shift']();await _0x37a2d7[_0x210d6a(0x171)](_0x210d6a(0x178),{'val':JSON['stringify'](_0x156ba9),'ack':!![]});}async function saveCompletedSequence(_0x15150b){const _0x33feb5=a5_0xa06d;try{const _0x58c167=await _0x15150b[_0x33feb5(0x135)](_0x33feb5(0x152));let _0x3e8993=[];if(_0x58c167&&_0x58c167[_0x33feb5(0x139)])try{_0x3e8993=JSON[_0x33feb5(0x165)](_0x58c167[_0x33feb5(0x139)]);}catch(_0x5e0d62){}const _0xa3d9d4=activeSequence[0x0]['ts'],_0x4bb39d=activeSequence[_0x33feb5(0x11d)](_0x4da934=>({'loc':_0x4da934[_0x33feb5(0x14b)],'t_delta':Math[_0x33feb5(0x11e)]((_0x4da934['ts']-_0xa3d9d4)/0x3e8)})),_0x261f10={'timestamp':new Date(_0xa3d9d4)[_0x33feb5(0x126)](),'steps':_0x4bb39d,'duration':Math[_0x33feb5(0x11e)]((activeSequence[activeSequence[_0x33feb5(0x15f)]-0x1]['ts']-_0xa3d9d4)/0x3e8),'daytime':new Date(_0xa3d9d4)['getHours']()};_0x3e8993[_0x33feb5(0x127)](_0x261f10);if(_0x3e8993[_0x33feb5(0x15f)]>MAX_TRAINING_SET_SIZE)_0x3e8993[_0x33feb5(0x12c)]();await _0x15150b[_0x33feb5(0x171)](_0x33feb5(0x152),{'val':JSON[_0x33feb5(0x177)](_0x3e8993),'ack':!![]}),_0x15150b[_0x33feb5(0x15e)]&&_0x15150b[_0x33feb5(0x16a)]&&_0x15150b[_0x33feb5(0x16a)](_0x33feb5(0x130),{'sequence':_0x261f10});}catch(_0x4bea11){_0x15150b[_0x33feb5(0x11c)][_0x33feb5(0x11f)]('[RECORDER]\x20Error:\x20'+_0x4bea11[_0x33feb5(0x156)]);}}function a5_0x441b(){const _0x49bc55=['length','exports','1102929pGDNMr','light','debug','.1.LEVEL','parse','some','dimmer','eventHistory','184052bAqJhx','sendToPythonWrapper','.Current.Temperature','Valve','13648833GzOfRq','32QUXubH','currentSystemMode','door','setStateAsync','sensorLastValues','weatherInstance','openweathermap','thermostat','type','stringify','LTM.trainingData.thermodynamics','config','getForeignStateAsync','LEVEL','lampe','isGracePeriodActive','exitTimer','accuweather','from','.NextHours.Location_1.Day_1.current.temp_value','klima','.4.VALVE_STATE','constructor','splice','contact','log','map','round','error','griff','.1.ACTUAL_TEMPERATURE','name','LTM.rawEventLog','toString','motion','toISOString','push','search','SIMULATE_SIGNAL','kontakt','STATE','shift','isPresent','includes','switch','ANALYZE_SEQUENCE','rawEventLog','schalter','temperature','bewegung','getStateAsync','daswetter','occupancy','value','val','.1.VALVE_STATE','string','(((.+)+)+)+$','lastTrackerEventTime','pr채senz','2875698LDXClq','system.isPresent','exitGraceTimer','replace','600DhysTZ','\x20from\x20','now','Unknown','t체r','heizung','temperatur','number','loc','licht','toLowerCase','valveMapping','normal','weatherunderground','2993760Adkuin','LTM.trainingData.sequences','193565KpLGog','Temperature','[RECORDER]\x20Ignored\x20implausible\x20temperature:\x20','message','events.history','window','67333deifKb','unshift','presence','location','outdoorSensorId','isProVersion'];a5_0x441b=function(){return _0x49bc55;};return a5_0x441b();}async function recordSequence(_0x3da34e,_0x1b7038){const _0x284f95=a5_0xa06d,_0x3d8f89=(_0x1b7038[_0x284f95(0x176)]||'')[_0x284f95(0x14d)](),_0x3f5306=['motion',_0x284f95(0x134),_0x284f95(0x13e),_0x284f95(0x15b),'occupancy',_0x284f95(0x170),'t체r',_0x284f95(0x158),'fenster',_0x284f95(0x11b),_0x284f95(0x12a),_0x284f95(0x162),'licht',_0x284f95(0x12f),_0x284f95(0x132),_0x284f95(0x167),'lampe'];if(!_0x3f5306[_0x284f95(0x166)](_0x3e7c96=>_0x3d8f89[_0x284f95(0x12e)](_0x3e7c96)))return;if(!_0x1b7038[_0x284f95(0x138)])return;if(sequenceTimer)clearTimeout(sequenceTimer);activeSequence[_0x284f95(0x127)]({'loc':_0x1b7038[_0x284f95(0x15c)]||_0x284f95(0x146),'id':_0x1b7038['id'],'ts':Date['now']()}),sequenceTimer=setTimeout(async()=>{if(activeSequence['length']>0x1)await saveCompletedSequence(_0x3da34e);activeSequence=[];},SEQUENCE_TIMEOUT_MS);}function startExitTimer(_0x36eb8e){const _0x82ff7d=a5_0xa06d;abortExitTimer(_0x36eb8e),_0x36eb8e[_0x82ff7d(0x17d)]=!![],_0x36eb8e['exitGraceTimer']=setTimeout(()=>{const _0x49f436=_0x82ff7d;_0x36eb8e[_0x49f436(0x17d)]=![];},EXIT_GRACE_PERIOD_SECONDS*0x3e8),_0x36eb8e['exitTimer']=setTimeout(()=>{const _0x1fe591=_0x82ff7d;setPresence(_0x36eb8e,![]),_0x36eb8e[_0x1fe591(0x113)]=null;},EXIT_TIMER_MINUTES*0x3c*0x3e8);}function abortExitTimer(_0x2dc248){const _0x76a315=a5_0xa06d;if(_0x2dc248[_0x76a315(0x113)])clearTimeout(_0x2dc248[_0x76a315(0x113)]);if(_0x2dc248['exitGraceTimer'])clearTimeout(_0x2dc248[_0x76a315(0x141)]);_0x2dc248[_0x76a315(0x113)]=null,_0x2dc248['exitGraceTimer']=null,_0x2dc248['isGracePeriodActive']=![];}async function setPresence(_0x3964fc,_0x577c47){const _0x3637a8=a5_0xa06d;if(_0x3964fc[_0x3637a8(0x12d)]===_0x577c47)return;_0x3964fc[_0x3637a8(0x12d)]=_0x577c47,await _0x3964fc['setStateAsync'](_0x3637a8(0x140),{'val':_0x577c47,'ack':!![]});}async function processSensorEvent(_0x4abc34,_0x418510,_0x59e8d9,_0x1396c3){const _0x4d2643=a5_0xa06d;if(!_0x1396c3)return null;const _0x2c8a6e=_0x59e8d9[_0x4d2643(0x139)],_0x179ba7=Date[_0x4d2643(0x145)](),_0x2fcf3a=_0x4abc34[_0x4d2643(0x172)][_0x418510],_0x208b3c=(_0x1396c3['type']||'')['toLowerCase'](),_0x474de5=_0x208b3c['includes'](_0x4d2643(0x133))||_0x208b3c['includes'](_0x4d2643(0x149))||_0x208b3c['includes'](_0x4d2643(0x117))||_0x208b3c[_0x4d2643(0x12e)](_0x4d2643(0x148))||_0x208b3c[_0x4d2643(0x12e)](_0x4d2643(0x175));if(_0x474de5&&typeof _0x2c8a6e===_0x4d2643(0x14a)){if(_0x2c8a6e>0x50||_0x2c8a6e<-0x32)return _0x4abc34[_0x4d2643(0x11c)][_0x4d2643(0x163)](_0x4d2643(0x155)+_0x2c8a6e+_0x4d2643(0x144)+_0x418510),null;}_0x4abc34[_0x4d2643(0x172)][_0x418510]=_0x2c8a6e;if(!_0x1396c3['logDuplicates']&&_0x2fcf3a!=undefined&&_0x2fcf3a==_0x2c8a6e)return null;_0x4abc34[_0x4d2643(0x15e)]&&_0x474de5&&recordThermodynamics(_0x4abc34,_0x418510,_0x2c8a6e,_0x1396c3[_0x4d2643(0x15c)]);const _0x1b6a59={'timestamp':_0x179ba7,'id':_0x418510,'name':_0x1396c3[_0x4d2643(0x122)],'type':_0x1396c3[_0x4d2643(0x176)],'location':_0x1396c3['location'],'value':_0x2c8a6e};_0x4abc34[_0x4d2643(0x168)][_0x4d2643(0x15a)](_0x1b6a59);if(_0x4abc34[_0x4d2643(0x168)]['length']>HISTORY_MAX_SIZE)_0x4abc34[_0x4d2643(0x168)]['pop']();await _0x4abc34[_0x4d2643(0x171)]('events.lastEvent',{'val':JSON['stringify'](_0x1b6a59),'ack':!![]}),await _0x4abc34[_0x4d2643(0x171)](_0x4d2643(0x157),{'val':JSON[_0x4d2643(0x177)](_0x4abc34[_0x4d2643(0x168)]),'ack':!![]});if(_0x4abc34[_0x4d2643(0x15e)]){_0x4abc34['rawEventLog'][_0x4d2643(0x127)](_0x1b6a59);if(_0x4abc34[_0x4d2643(0x131)][_0x4d2643(0x15f)]>RAW_LOG_MAX_SIZE)_0x4abc34[_0x4d2643(0x131)][_0x4d2643(0x11a)](0x0,_0x4abc34[_0x4d2643(0x131)][_0x4d2643(0x15f)]-RAW_LOG_MAX_SIZE);await _0x4abc34[_0x4d2643(0x171)](_0x4d2643(0x123),{'val':JSON[_0x4d2643(0x177)](_0x4abc34[_0x4d2643(0x131)]),'ack':!![]}),recordSequence(_0x4abc34,_0x1b6a59);}if(_0x1396c3['isExit']&&_0x2c8a6e===!![]){if(_0x4abc34[_0x4d2643(0x12d)]&&!_0x4abc34[_0x4d2643(0x17d)])startExitTimer(_0x4abc34);else{if(!_0x4abc34[_0x4d2643(0x12d)])setPresence(_0x4abc34,!![]);}}else{if(_0x1396c3[_0x4d2643(0x176)]===_0x4d2643(0x125)&&_0x2c8a6e===!![]){if(_0x4abc34['exitTimer'])abortExitTimer(_0x4abc34);if(!_0x4abc34[_0x4d2643(0x12d)]&&_0x4abc34[_0x4d2643(0x16f)]===_0x4d2643(0x14f))setPresence(_0x4abc34,!![]);}}if(_0x4abc34[_0x4d2643(0x15e)]&&_0x4abc34[_0x4d2643(0x16a)]){_0x1396c3[_0x4d2643(0x176)]===_0x4d2643(0x125)&&_0x2c8a6e===!![]&&_0x1396c3[_0x4d2643(0x15c)]&&_0x4abc34[_0x4d2643(0x16a)](_0x4d2643(0x129),{'room':_0x1396c3[_0x4d2643(0x15c)]});const _0xa1b0d3=['door',_0x4d2643(0x147),_0x4d2643(0x158),'fenster',_0x4d2643(0x120),'handle','lock','schloss'][_0x4d2643(0x166)](_0x3ce046=>_0x208b3c[_0x4d2643(0x12e)](_0x3ce046)),_0x3fc9a0=['light',_0x4d2643(0x14c),'switch',_0x4d2643(0x132),'dimmer',_0x4d2643(0x17c)][_0x4d2643(0x166)](_0x38b66f=>_0x208b3c[_0x4d2643(0x12e)](_0x38b66f)),_0x331cf3=['motion',_0x4d2643(0x134),'pr채senz',_0x4d2643(0x15b),_0x4d2643(0x137)][_0x4d2643(0x166)](_0x330886=>_0x208b3c[_0x4d2643(0x12e)](_0x330886));if(_0x1396c3[_0x4d2643(0x15c)]&&(_0xa1b0d3||_0x3fc9a0||_0x331cf3)){const _0x3ca4f0=_0x2c8a6e===!![]||typeof _0x2c8a6e==='number'&&_0x2c8a6e>0x0,_0x1a94e5=_0xa1b0d3&&!_0x3ca4f0&&_0x2fcf3a!==undefined&&_0x2fcf3a!=_0x2c8a6e;if(_0x3ca4f0||_0x1a94e5){const _0x45e75f=_0x4abc34['lastTrackerEventTime']||_0x179ba7,_0x15bc7c=(_0x179ba7-_0x45e75f)/0x3e8;_0x4abc34[_0x4d2643(0x13d)]=_0x179ba7,_0x4abc34[_0x4d2643(0x16a)]('TRACK_EVENT',{'room':_0x1396c3[_0x4d2643(0x15c)],'dt':_0x15bc7c});}}}return _0x1b6a59;}module[a5_0x289903(0x160)]={'processSensorEvent':processSensorEvent,'getOutsideTemperatureNumeric':getOutsideTemperatureNumeric,'setPresence':setPresence,'abortExitTimer':abortExitTimer,'startExitTimer':startExitTimer};