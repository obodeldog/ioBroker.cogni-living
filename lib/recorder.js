(function(_0x5a8296,_0x436183){const _0x399948=a5_0x30db,_0x30e3f1=_0x5a8296();while(!![]){try{const _0x37d92f=parseInt(_0x399948(0xab))/0x1+-parseInt(_0x399948(0x10b))/0x2+-parseInt(_0x399948(0xd8))/0x3+-parseInt(_0x399948(0xf7))/0x4*(parseInt(_0x399948(0x118))/0x5)+-parseInt(_0x399948(0xda))/0x6*(parseInt(_0x399948(0x104))/0x7)+parseInt(_0x399948(0xf6))/0x8+-parseInt(_0x399948(0xef))/0x9*(-parseInt(_0x399948(0xbc))/0xa);if(_0x37d92f===_0x436183)break;else _0x30e3f1['push'](_0x30e3f1['shift']());}catch(_0xf317c1){_0x30e3f1['push'](_0x30e3f1['shift']());}}}(a5_0xa55b,0x3c175));const a5_0xfbef8b=(function(){let _0x386a18=!![];return function(_0xc89b5a,_0x2053b2){const _0x24b4b6=_0x386a18?function(){const _0x52b80c=a5_0x30db;if(_0x2053b2){const _0xf6f2bf=_0x2053b2[_0x52b80c(0xc4)](_0xc89b5a,arguments);return _0x2053b2=null,_0xf6f2bf;}}:function(){};return _0x386a18=![],_0x24b4b6;};}()),a5_0x726099=a5_0xfbef8b(this,function(){const _0x27f222=a5_0x30db;return a5_0x726099[_0x27f222(0xdb)]()[_0x27f222(0xf1)](_0x27f222(0x112))[_0x27f222(0xdb)]()[_0x27f222(0x110)](a5_0x726099)[_0x27f222(0xf1)]('(((.+)+)+)+$');});a5_0x726099();'use strict';function a5_0xa55b(){const _0x5e98f6=['STATE','type','map','bewegung','message','door','value','.NextHours.Location_1.Day_1.current.temp_value','[RECORDER]\x20Ignored\x20implausible\x20temperature:\x20','normal','splice','motion','5059134QezDcY','licht','search','toISOString','string','isPresent','now','1685720aWDvCS','28SFpxiZ','level','fenster','kontakt','pop','from','dimmer','Valve','toLowerCase','error','replace','sensorLastValues','system.isPresent','14zPocvf','\x20from\x20','contact','präsenz','temperatur','temperature','getHours','636694XQeNQk','getStateAsync','location','.1.LEVEL','Temperature','constructor','unshift','(((.+)+)+)+$','lastTrackerEventTime','stringify','.LEVEL','.1.ACTUAL_TEMPERATURE','TRACK_EVENT','342420NQJtSv','STATUS','currentSystemMode','thermostat','.ACTUAL_TEMPERATURE','428105xAvhZa','parse','presence','switch','.Current.Temperature','daswetter','eventHistory','includes','.4.VALVE_STATE','config','some','events.history','LTM.rawEventLog','useWeather','name','shift','Unknown','10QLDOKU','schalter','handle','openweathermap','val','exitTimer','.forecast.current.temperature','exitGraceTimer','apply','events.lastEvent','occupancy','getForeignStateAsync','weatherunderground','LTM.trainingData.sequences','number','isExit','light','debug','LEVEL','window','sendToPythonWrapper','logDuplicates','valveMapping','accuweather','isProVersion','LTM.trainingData.thermodynamics','rawEventLog','setStateAsync','462048MGbQXy','push','9186HiYgxd','toString','isGracePeriodActive','.forecast.current.temp','loc','length','ANALYZE_SEQUENCE','round','log'];a5_0xa55b=function(){return _0x5e98f6;};return a5_0xa55b();}const HISTORY_MAX_SIZE=0x32,RAW_LOG_MAX_SIZE=0x9c4,THERMO_LOG_SIZE=0x3e8,SEQUENCE_TIMEOUT_MS=0x5*0x3c*0x3e8,MAX_TRAINING_SET_SIZE=0x1f4,EXIT_TIMER_MINUTES=0xf,EXIT_GRACE_PERIOD_SECONDS=0x1e;let activeSequence=[],sequenceTimer=null;async function getOutsideTemperatureNumeric(_0x5ad7cf){const _0xb4965f=a5_0x30db;if(_0x5ad7cf[_0xb4965f(0xb4)]['outdoorSensorId'])try{const _0x5198a3=await _0x5ad7cf[_0xb4965f(0xc7)](_0x5ad7cf['config']['outdoorSensorId']);if(_0x5198a3&&_0x5198a3['val']!==undefined&&_0x5198a3[_0xb4965f(0xc0)]!==null)return parseFloat(_0x5198a3[_0xb4965f(0xc0)]);}catch(_0x176fe2){}const _0x58816d=_0x5ad7cf[_0xb4965f(0xb4)]['weatherInstance'];if(!_0x5ad7cf[_0xb4965f(0xb4)][_0xb4965f(0xb8)]||!_0x58816d)return null;try{let _0x4bb1be='';if(_0x58816d[_0xb4965f(0xb2)](_0xb4965f(0xd3)))_0x4bb1be=_0x58816d+_0xb4965f(0xaf);else{if(_0x58816d[_0xb4965f(0xb2)](_0xb4965f(0xb0)))_0x4bb1be=_0x58816d+_0xb4965f(0xea);else{if(_0x58816d['includes'](_0xb4965f(0xbf)))_0x4bb1be=_0x58816d+_0xb4965f(0xc2);else{if(_0x58816d['includes'](_0xb4965f(0xc8)))_0x4bb1be=_0x58816d+_0xb4965f(0xdd);}}}if(_0x4bb1be){const _0x37fbf1=await _0x5ad7cf[_0xb4965f(0xc7)](_0x4bb1be);if(_0x37fbf1&&_0x37fbf1['val']!==undefined&&_0x37fbf1[_0xb4965f(0xc0)]!==null)return parseFloat(_0x37fbf1['val']);}}catch(_0x3c0b76){}return null;}async function recordThermodynamics(_0x53b747,_0x2e6dd2,_0x5324ec,_0x108b66){const _0x515008=a5_0x30db,_0x503f8c=await getOutsideTemperatureNumeric(_0x53b747);if(_0x503f8c===null)return;let _0x37bcd3=0x0,_0x4f715f=![];if(_0x53b747[_0x515008(0xb4)]['valveMapping'])try{let _0x19b47a=_0x53b747['config'][_0x515008(0xd2)];if(typeof _0x19b47a===_0x515008(0xf3))_0x19b47a=JSON[_0x515008(0xac)](_0x19b47a);if(_0x19b47a[_0x2e6dd2]){const _0x2d47ee=_0x19b47a[_0x2e6dd2],_0x2b98f6=await _0x53b747['getForeignStateAsync'](_0x2d47ee);if(_0x2b98f6&&_0x2b98f6[_0x515008(0xc0)]!==null&&_0x2b98f6[_0x515008(0xc0)]!==undefined){let _0x28b525=Number(_0x2b98f6['val']);if(_0x28b525<=1.05&&!_0x2d47ee[_0x515008(0xb2)](_0x515008(0x119))&&!_0x2d47ee[_0x515008(0xb2)](_0x515008(0xe3)))_0x28b525=_0x28b525*0x64;_0x37bcd3=Math[_0x515008(0xe1)](_0x28b525),_0x4f715f=!![];}}}catch(_0x46b6f0){}if(!_0x4f715f){const _0x2c04df=[{'from':'.1.ACTUAL_TEMPERATURE','to':_0x515008(0x10e)},{'from':_0x515008(0x116),'to':'.1.VALVE_STATE'},{'from':'.1.TEMPERATURE','to':_0x515008(0xb3)},{'from':_0x515008(0x11c),'to':_0x515008(0x115)},{'from':_0x515008(0x109),'to':_0x515008(0xf8)},{'from':_0x515008(0x10f),'to':_0x515008(0xfe)}];for(const _0x5ea5dc of _0x2c04df){if(_0x2e6dd2[_0x515008(0xb2)](_0x5ea5dc[_0x515008(0xfc)])){const _0x35eadf=_0x2e6dd2[_0x515008(0x101)](_0x5ea5dc['from'],_0x5ea5dc['to']);try{const _0x492b37=await _0x53b747[_0x515008(0xc7)](_0x35eadf);if(_0x492b37&&_0x492b37[_0x515008(0xc0)]!==null&&_0x492b37['val']!==undefined){let _0x3990a5=Number(_0x492b37[_0x515008(0xc0)]);if(typeof _0x3990a5===_0x515008(0xca)){if(_0x3990a5<=1.05&&_0x5ea5dc['to'][_0x515008(0xb2)](_0x515008(0xce)))_0x3990a5=_0x3990a5*0x64;_0x37bcd3=Math['round'](_0x3990a5),_0x4f715f=!![];break;}}}catch(_0x51e619){}}}}const _0x279793=await _0x53b747[_0x515008(0x10c)](_0x515008(0xd5));let _0xa77792=[];if(_0x279793&&_0x279793[_0x515008(0xc0)])try{_0xa77792=JSON[_0x515008(0xac)](_0x279793[_0x515008(0xc0)]);}catch(_0x548322){}_0xa77792[_0x515008(0xd9)]({'ts':Date[_0x515008(0xf5)](),'room':_0x108b66||_0x515008(0xbb),'t_in':_0x5324ec,'t_out':_0x503f8c,'valve':_0x37bcd3});if(_0xa77792['length']>THERMO_LOG_SIZE)_0xa77792[_0x515008(0xba)]();await _0x53b747[_0x515008(0xd7)](_0x515008(0xd5),{'val':JSON[_0x515008(0x114)](_0xa77792),'ack':!![]});}async function saveCompletedSequence(_0x5d8539){const _0x1acfca=a5_0x30db;try{const _0x25b6a1=await _0x5d8539[_0x1acfca(0x10c)](_0x1acfca(0xc9));let _0x4bbeb2=[];if(_0x25b6a1&&_0x25b6a1[_0x1acfca(0xc0)])try{_0x4bbeb2=JSON['parse'](_0x25b6a1[_0x1acfca(0xc0)]);}catch(_0x439050){}const _0x4845e0=activeSequence[0x0]['ts'],_0x5756ad=activeSequence[_0x1acfca(0xe5)](_0x1ef64a=>({'loc':_0x1ef64a[_0x1acfca(0xde)],'t_delta':Math[_0x1acfca(0xe1)]((_0x1ef64a['ts']-_0x4845e0)/0x3e8)})),_0x4bfc83={'timestamp':new Date(_0x4845e0)[_0x1acfca(0xf2)](),'steps':_0x5756ad,'duration':Math['round']((activeSequence[activeSequence[_0x1acfca(0xdf)]-0x1]['ts']-_0x4845e0)/0x3e8),'daytime':new Date(_0x4845e0)[_0x1acfca(0x10a)]()};_0x4bbeb2[_0x1acfca(0xd9)](_0x4bfc83);if(_0x4bbeb2[_0x1acfca(0xdf)]>MAX_TRAINING_SET_SIZE)_0x4bbeb2[_0x1acfca(0xba)]();await _0x5d8539['setStateAsync'](_0x1acfca(0xc9),{'val':JSON['stringify'](_0x4bbeb2),'ack':!![]}),_0x5d8539[_0x1acfca(0xd4)]&&_0x5d8539[_0x1acfca(0xd0)]&&_0x5d8539[_0x1acfca(0xd0)](_0x1acfca(0xe0),{'sequence':_0x4bfc83});}catch(_0x5ae399){_0x5d8539[_0x1acfca(0xe2)][_0x1acfca(0x100)]('[RECORDER]\x20Error:\x20'+_0x5ae399[_0x1acfca(0xe7)]);}}async function recordSequence(_0x29c342,_0x55e658){const _0x304269=a5_0x30db,_0x553e69=(_0x55e658['type']||'')[_0x304269(0xff)](),_0x4ff2ac=['motion',_0x304269(0xe6),_0x304269(0x107),'presence',_0x304269(0xc6),_0x304269(0xe8),'tür',_0x304269(0xcf),_0x304269(0xf9),_0x304269(0x106),_0x304269(0xfa),_0x304269(0xcc),_0x304269(0xf0),_0x304269(0xae),_0x304269(0xbd),'dimmer','lampe'];if(!_0x4ff2ac['some'](_0x27927e=>_0x553e69[_0x304269(0xb2)](_0x27927e)))return;if(!_0x55e658[_0x304269(0xe9)])return;if(sequenceTimer)clearTimeout(sequenceTimer);activeSequence[_0x304269(0xd9)]({'loc':_0x55e658[_0x304269(0x10d)]||_0x304269(0xbb),'id':_0x55e658['id'],'ts':Date[_0x304269(0xf5)]()}),sequenceTimer=setTimeout(async()=>{const _0x317780=_0x304269;if(activeSequence[_0x317780(0xdf)]>0x1)await saveCompletedSequence(_0x29c342);activeSequence=[];},SEQUENCE_TIMEOUT_MS);}function a5_0x30db(_0x1570cb,_0x3eb602){const _0x4f4541=a5_0xa55b();return a5_0x30db=function(_0x726099,_0xfbef8b){_0x726099=_0x726099-0xab;let _0xa55b58=_0x4f4541[_0x726099];return _0xa55b58;},a5_0x30db(_0x1570cb,_0x3eb602);}function startExitTimer(_0x18bb04){const _0x3b93bf=a5_0x30db;abortExitTimer(_0x18bb04),_0x18bb04[_0x3b93bf(0xdc)]=!![],_0x18bb04[_0x3b93bf(0xc3)]=setTimeout(()=>{_0x18bb04['isGracePeriodActive']=![];},EXIT_GRACE_PERIOD_SECONDS*0x3e8),_0x18bb04[_0x3b93bf(0xc1)]=setTimeout(()=>{const _0x3a8179=_0x3b93bf;setPresence(_0x18bb04,![]),_0x18bb04[_0x3a8179(0xc1)]=null;},EXIT_TIMER_MINUTES*0x3c*0x3e8);}function abortExitTimer(_0x5f1f71){const _0x58bac8=a5_0x30db;if(_0x5f1f71['exitTimer'])clearTimeout(_0x5f1f71[_0x58bac8(0xc1)]);if(_0x5f1f71['exitGraceTimer'])clearTimeout(_0x5f1f71[_0x58bac8(0xc3)]);_0x5f1f71[_0x58bac8(0xc1)]=null,_0x5f1f71['exitGraceTimer']=null,_0x5f1f71[_0x58bac8(0xdc)]=![];}async function setPresence(_0xf74e36,_0x53984c){const _0x495a8e=a5_0x30db;if(_0xf74e36[_0x495a8e(0xf4)]===_0x53984c)return;_0xf74e36[_0x495a8e(0xf4)]=_0x53984c,await _0xf74e36[_0x495a8e(0xd7)](_0x495a8e(0x103),{'val':_0x53984c,'ack':!![]});}async function processSensorEvent(_0x50cf1b,_0x51e9c5,_0x34d35d,_0x3c2ab8){const _0x289184=a5_0x30db;if(!_0x3c2ab8)return null;const _0x144b41=_0x34d35d[_0x289184(0xc0)],_0x44a435=Date[_0x289184(0xf5)](),_0x1c5df6=_0x50cf1b[_0x289184(0x102)][_0x51e9c5],_0x42826c=(_0x3c2ab8[_0x289184(0xe4)]||'')[_0x289184(0xff)](),_0x331b82=_0x42826c[_0x289184(0xb2)](_0x289184(0x109))||_0x42826c[_0x289184(0xb2)](_0x289184(0x108))||_0x42826c[_0x289184(0xb2)]('klima')||_0x42826c[_0x289184(0xb2)]('heizung')||_0x42826c[_0x289184(0xb2)](_0x289184(0x11b));if(_0x331b82&&typeof _0x144b41===_0x289184(0xca)){if(_0x144b41>0x50||_0x144b41<-0x32)return _0x50cf1b[_0x289184(0xe2)][_0x289184(0xcd)](_0x289184(0xeb)+_0x144b41+_0x289184(0x105)+_0x51e9c5),null;}_0x50cf1b['sensorLastValues'][_0x51e9c5]=_0x144b41;if(!_0x3c2ab8[_0x289184(0xd1)]&&_0x1c5df6!=undefined&&_0x1c5df6==_0x144b41)return null;_0x50cf1b[_0x289184(0xd4)]&&_0x331b82&&recordThermodynamics(_0x50cf1b,_0x51e9c5,_0x144b41,_0x3c2ab8[_0x289184(0x10d)]);const _0x145de1={'timestamp':_0x44a435,'id':_0x51e9c5,'name':_0x3c2ab8[_0x289184(0xb9)],'type':_0x3c2ab8[_0x289184(0xe4)],'location':_0x3c2ab8[_0x289184(0x10d)],'value':_0x144b41};_0x50cf1b[_0x289184(0xb1)][_0x289184(0x111)](_0x145de1);if(_0x50cf1b[_0x289184(0xb1)][_0x289184(0xdf)]>HISTORY_MAX_SIZE)_0x50cf1b['eventHistory'][_0x289184(0xfb)]();await _0x50cf1b[_0x289184(0xd7)](_0x289184(0xc5),{'val':JSON[_0x289184(0x114)](_0x145de1),'ack':!![]}),await _0x50cf1b['setStateAsync'](_0x289184(0xb6),{'val':JSON[_0x289184(0x114)](_0x50cf1b[_0x289184(0xb1)]),'ack':!![]});if(_0x50cf1b[_0x289184(0xd4)]){_0x50cf1b[_0x289184(0xd6)]['push'](_0x145de1);if(_0x50cf1b[_0x289184(0xd6)][_0x289184(0xdf)]>RAW_LOG_MAX_SIZE)_0x50cf1b['rawEventLog'][_0x289184(0xed)](0x0,_0x50cf1b[_0x289184(0xd6)][_0x289184(0xdf)]-RAW_LOG_MAX_SIZE);await _0x50cf1b['setStateAsync'](_0x289184(0xb7),{'val':JSON['stringify'](_0x50cf1b[_0x289184(0xd6)]),'ack':!![]}),recordSequence(_0x50cf1b,_0x145de1);}if(_0x3c2ab8[_0x289184(0xcb)]&&_0x144b41===!![]){if(_0x50cf1b[_0x289184(0xf4)]&&!_0x50cf1b[_0x289184(0xdc)])startExitTimer(_0x50cf1b);else{if(!_0x50cf1b[_0x289184(0xf4)])setPresence(_0x50cf1b,!![]);}}else{if(_0x3c2ab8[_0x289184(0xe4)]===_0x289184(0xee)&&_0x144b41===!![]){if(_0x50cf1b[_0x289184(0xc1)])abortExitTimer(_0x50cf1b);if(!_0x50cf1b[_0x289184(0xf4)]&&_0x50cf1b[_0x289184(0x11a)]===_0x289184(0xec))setPresence(_0x50cf1b,!![]);}}if(_0x50cf1b[_0x289184(0xd4)]&&_0x50cf1b[_0x289184(0xd0)]){_0x3c2ab8[_0x289184(0xe4)]===_0x289184(0xee)&&_0x144b41===!![]&&_0x3c2ab8[_0x289184(0x10d)]&&_0x50cf1b[_0x289184(0xd0)]('SIMULATE_SIGNAL',{'room':_0x3c2ab8[_0x289184(0x10d)]});const _0x483ef6=['door','tür','window',_0x289184(0xf9),'griff',_0x289184(0xbe),'lock','schloss'][_0x289184(0xb5)](_0x5cbab2=>_0x42826c[_0x289184(0xb2)](_0x5cbab2)),_0x525c72=['light',_0x289184(0xf0),_0x289184(0xae),'schalter',_0x289184(0xfd),'lampe'][_0x289184(0xb5)](_0x124d35=>_0x42826c[_0x289184(0xb2)](_0x124d35)),_0x452209=[_0x289184(0xee),'bewegung',_0x289184(0x107),_0x289184(0xad),_0x289184(0xc6)][_0x289184(0xb5)](_0x2d07ec=>_0x42826c['includes'](_0x2d07ec));if(_0x3c2ab8[_0x289184(0x10d)]&&(_0x483ef6||_0x525c72||_0x452209)){const _0x1cbc3f=_0x144b41===!![]||typeof _0x144b41===_0x289184(0xca)&&_0x144b41>0x0,_0x196041=_0x483ef6&&!_0x1cbc3f&&_0x1c5df6!==undefined&&_0x1c5df6!=_0x144b41;if(_0x1cbc3f||_0x196041){const _0x5cbca5=_0x50cf1b['lastTrackerEventTime']||_0x44a435,_0x359d3c=(_0x44a435-_0x5cbca5)/0x3e8;_0x50cf1b[_0x289184(0x113)]=_0x44a435,_0x50cf1b[_0x289184(0xd0)](_0x289184(0x117),{'room':_0x3c2ab8[_0x289184(0x10d)],'dt':_0x359d3c});}}}return _0x145de1;}module['exports']={'processSensorEvent':processSensorEvent,'getOutsideTemperatureNumeric':getOutsideTemperatureNumeric,'setPresence':setPresence,'abortExitTimer':abortExitTimer,'startExitTimer':startExitTimer};