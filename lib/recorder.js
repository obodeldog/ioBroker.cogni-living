const a5_0x202f3a=a5_0xb68b;(function(_0x3e3f3e,_0x2a16f3){const _0x3ffd4a=a5_0xb68b,_0x485f0f=_0x3e3f3e();while(!![]){try{const _0x32479a=-parseInt(_0x3ffd4a(0x17a))/0x1*(-parseInt(_0x3ffd4a(0x135))/0x2)+parseInt(_0x3ffd4a(0x143))/0x3+-parseInt(_0x3ffd4a(0x15c))/0x4*(-parseInt(_0x3ffd4a(0x12f))/0x5)+parseInt(_0x3ffd4a(0x17b))/0x6*(parseInt(_0x3ffd4a(0x170))/0x7)+-parseInt(_0x3ffd4a(0x136))/0x8*(parseInt(_0x3ffd4a(0x133))/0x9)+parseInt(_0x3ffd4a(0x117))/0xa*(parseInt(_0x3ffd4a(0x15e))/0xb)+-parseInt(_0x3ffd4a(0x119))/0xc*(parseInt(_0x3ffd4a(0x167))/0xd);if(_0x32479a===_0x2a16f3)break;else _0x485f0f['push'](_0x485f0f['shift']());}catch(_0x40528d){_0x485f0f['push'](_0x485f0f['shift']());}}}(a5_0x5057,0x58010));const a5_0x30f6ff=(function(){let _0x48bc86=!![];return function(_0x4d1ab4,_0x42086d){const _0x57cb96=_0x48bc86?function(){if(_0x42086d){const _0x2ce378=_0x42086d['apply'](_0x4d1ab4,arguments);return _0x42086d=null,_0x2ce378;}}:function(){};return _0x48bc86=![],_0x57cb96;};}()),a5_0x31fb3e=a5_0x30f6ff(this,function(){const _0x1f0a42=a5_0xb68b;return a5_0x31fb3e[_0x1f0a42(0x14d)]()['search'](_0x1f0a42(0x139))['toString']()[_0x1f0a42(0x16e)](a5_0x31fb3e)[_0x1f0a42(0x172)](_0x1f0a42(0x139));});a5_0x31fb3e();'use strict';const HISTORY_MAX_SIZE=0x32,RAW_LOG_MAX_SIZE=0x9c4,THERMO_LOG_SIZE=0x3e8,SEQUENCE_TIMEOUT_MS=0x5*0x3c*0x3e8,MAX_TRAINING_SET_SIZE=0x1f4,EXIT_TIMER_MINUTES=0xf,EXIT_GRACE_PERIOD_SECONDS=0x1e;let activeSequence=[],sequenceTimer=null;async function getOutsideTemperatureNumeric(_0x536b9c){const _0x581e47=a5_0xb68b;if(_0x536b9c['config'][_0x581e47(0x11a)])try{const _0x3e83ab=await _0x536b9c[_0x581e47(0x12d)](_0x536b9c[_0x581e47(0x174)][_0x581e47(0x11a)]);if(_0x3e83ab&&_0x3e83ab[_0x581e47(0x110)]!==undefined&&_0x3e83ab[_0x581e47(0x110)]!==null)return parseFloat(_0x3e83ab[_0x581e47(0x110)]);}catch(_0x229966){}const _0x20b07d=_0x536b9c[_0x581e47(0x174)]['weatherInstance'];if(!_0x536b9c[_0x581e47(0x174)][_0x581e47(0x14f)]||!_0x20b07d)return null;try{let _0x2de0ea='';if(_0x20b07d[_0x581e47(0x13b)](_0x581e47(0x10e)))_0x2de0ea=_0x20b07d+_0x581e47(0x13d);else{if(_0x20b07d[_0x581e47(0x13b)](_0x581e47(0x152)))_0x2de0ea=_0x20b07d+_0x581e47(0x162);else{if(_0x20b07d[_0x581e47(0x13b)](_0x581e47(0x17d)))_0x2de0ea=_0x20b07d+_0x581e47(0x111);else{if(_0x20b07d[_0x581e47(0x13b)]('weatherunderground'))_0x2de0ea=_0x20b07d+'.forecast.current.temp';}}}if(_0x2de0ea){const _0x5a20c5=await _0x536b9c[_0x581e47(0x12d)](_0x2de0ea);if(_0x5a20c5&&_0x5a20c5['val']!==undefined&&_0x5a20c5[_0x581e47(0x110)]!==null)return parseFloat(_0x5a20c5['val']);}}catch(_0x5f46d9){}return null;}async function recordThermodynamics(_0x323c35,_0x817cc5,_0x1f965c,_0x47b1cf){const _0x24ec31=a5_0xb68b,_0x369305=await getOutsideTemperatureNumeric(_0x323c35);if(_0x369305===null)return;let _0x10e947=0x0,_0x24c426=![];if(_0x323c35[_0x24ec31(0x174)]['valveMapping'])try{let _0x43ab9f=_0x323c35[_0x24ec31(0x174)][_0x24ec31(0x14e)];if(typeof _0x43ab9f===_0x24ec31(0x115))_0x43ab9f=JSON[_0x24ec31(0x10f)](_0x43ab9f);if(_0x43ab9f[_0x817cc5]){const _0x2a0282=_0x43ab9f[_0x817cc5],_0x46c086=await _0x323c35[_0x24ec31(0x12d)](_0x2a0282);if(_0x46c086&&_0x46c086['val']!==null&&_0x46c086[_0x24ec31(0x110)]!==undefined){let _0x2737a8=Number(_0x46c086[_0x24ec31(0x110)]);if(_0x2737a8<=1.05&&!_0x2a0282[_0x24ec31(0x13b)]('STATUS')&&!_0x2a0282[_0x24ec31(0x13b)](_0x24ec31(0x141)))_0x2737a8=_0x2737a8*0x64;_0x10e947=Math[_0x24ec31(0x140)](_0x2737a8),_0x24c426=!![];}}}catch(_0x22a9d7){}if(!_0x24c426){const _0x2570ab=[{'from':_0x24ec31(0x15f),'to':_0x24ec31(0x11e)},{'from':'.1.ACTUAL_TEMPERATURE','to':_0x24ec31(0x11b)},{'from':_0x24ec31(0x132),'to':'.4.VALVE_STATE'},{'from':'.ACTUAL_TEMPERATURE','to':_0x24ec31(0x17e)},{'from':_0x24ec31(0x126),'to':'level'},{'from':_0x24ec31(0x118),'to':_0x24ec31(0x179)}];for(const _0x48bb71 of _0x2570ab){if(_0x817cc5['includes'](_0x48bb71[_0x24ec31(0x16d)])){const _0x2d36a7=_0x817cc5[_0x24ec31(0x112)](_0x48bb71['from'],_0x48bb71['to']);try{const _0x4c6f2d=await _0x323c35[_0x24ec31(0x12d)](_0x2d36a7);if(_0x4c6f2d&&_0x4c6f2d['val']!==null&&_0x4c6f2d[_0x24ec31(0x110)]!==undefined){let _0x5ea2bd=Number(_0x4c6f2d[_0x24ec31(0x110)]);if(typeof _0x5ea2bd===_0x24ec31(0x15d)){if(_0x5ea2bd<=1.05&&_0x48bb71['to'][_0x24ec31(0x13b)](_0x24ec31(0x16b)))_0x5ea2bd=_0x5ea2bd*0x64;_0x10e947=Math[_0x24ec31(0x140)](_0x5ea2bd),_0x24c426=!![];break;}}}catch(_0x319823){}}}}const _0x152649=await _0x323c35[_0x24ec31(0x163)](_0x24ec31(0x14c));let _0x57e044=[];if(_0x152649&&_0x152649[_0x24ec31(0x110)])try{_0x57e044=JSON[_0x24ec31(0x10f)](_0x152649['val']);}catch(_0x339ae3){}_0x57e044[_0x24ec31(0x151)]({'ts':Date[_0x24ec31(0x164)](),'room':_0x47b1cf||_0x24ec31(0x13f),'t_in':_0x1f965c,'t_out':_0x369305,'valve':_0x10e947});if(_0x57e044[_0x24ec31(0x168)]>THERMO_LOG_SIZE)_0x57e044[_0x24ec31(0x114)]();await _0x323c35[_0x24ec31(0x155)](_0x24ec31(0x14c),{'val':JSON[_0x24ec31(0x177)](_0x57e044),'ack':!![]});}async function saveCompletedSequence(_0x20ec7b){const _0x36aeb0=a5_0xb68b;try{const _0x112f96=await _0x20ec7b[_0x36aeb0(0x163)](_0x36aeb0(0x16a));let _0x3c050b=[];if(_0x112f96&&_0x112f96['val'])try{_0x3c050b=JSON[_0x36aeb0(0x10f)](_0x112f96[_0x36aeb0(0x110)]);}catch(_0x3bfd74){}const _0x261baa=activeSequence[0x0]['ts'],_0xafbffe=activeSequence['map'](_0x320dfc=>({'loc':_0x320dfc[_0x36aeb0(0x156)],'t_delta':Math[_0x36aeb0(0x140)]((_0x320dfc['ts']-_0x261baa)/0x3e8)})),_0x3cca30={'timestamp':new Date(_0x261baa)[_0x36aeb0(0x13a)](),'steps':_0xafbffe,'duration':Math[_0x36aeb0(0x140)]((activeSequence[activeSequence[_0x36aeb0(0x168)]-0x1]['ts']-_0x261baa)/0x3e8),'daytime':new Date(_0x261baa)[_0x36aeb0(0x178)]()};_0x3c050b[_0x36aeb0(0x151)](_0x3cca30);if(_0x3c050b[_0x36aeb0(0x168)]>MAX_TRAINING_SET_SIZE)_0x3c050b[_0x36aeb0(0x114)]();await _0x20ec7b[_0x36aeb0(0x155)]('LTM.trainingData.sequences',{'val':JSON[_0x36aeb0(0x177)](_0x3c050b),'ack':!![]}),_0x20ec7b[_0x36aeb0(0x146)]&&_0x20ec7b['sendToPythonWrapper']&&_0x20ec7b[_0x36aeb0(0x12b)]('ANALYZE_SEQUENCE',{'sequence':_0x3cca30});}catch(_0x17a671){_0x20ec7b[_0x36aeb0(0x12e)][_0x36aeb0(0x128)](_0x36aeb0(0x158)+_0x17a671[_0x36aeb0(0x165)]);}}async function recordSequence(_0x4886a6,_0x593708){const _0xe42986=a5_0xb68b,_0x331bf6=(_0x593708[_0xe42986(0x171)]||'')['toLowerCase'](),_0x292e25=[_0xe42986(0x11f),_0xe42986(0x134),_0xe42986(0x15a),_0xe42986(0x157),_0xe42986(0x11d),_0xe42986(0x129),_0xe42986(0x150),_0xe42986(0x138),_0xe42986(0x127),_0xe42986(0x145),_0xe42986(0x175),_0xe42986(0x10c),_0xe42986(0x10d),_0xe42986(0x148),_0xe42986(0x142),_0xe42986(0x161),_0xe42986(0x173)];if(!_0x292e25['some'](_0x26dc17=>_0x331bf6[_0xe42986(0x13b)](_0x26dc17)))return;if(!_0x593708[_0xe42986(0x130)])return;if(sequenceTimer)clearTimeout(sequenceTimer);activeSequence['push']({'loc':_0x593708['location']||_0xe42986(0x13f),'id':_0x593708['id'],'ts':Date[_0xe42986(0x164)]()}),sequenceTimer=setTimeout(async()=>{const _0x16d0c7=_0xe42986;if(activeSequence[_0x16d0c7(0x168)]>0x1)await saveCompletedSequence(_0x4886a6);activeSequence=[];},SEQUENCE_TIMEOUT_MS);}function startExitTimer(_0x35549c){const _0x1f0325=a5_0xb68b;abortExitTimer(_0x35549c),_0x35549c[_0x1f0325(0x14a)]=!![],_0x35549c['exitGraceTimer']=setTimeout(()=>{const _0x77504d=_0x1f0325;_0x35549c[_0x77504d(0x14a)]=![];},EXIT_GRACE_PERIOD_SECONDS*0x3e8),_0x35549c[_0x1f0325(0x11c)]=setTimeout(()=>{setPresence(_0x35549c,![]),_0x35549c['exitTimer']=null;},EXIT_TIMER_MINUTES*0x3c*0x3e8);}function abortExitTimer(_0x27d738){const _0x2d8953=a5_0xb68b;if(_0x27d738[_0x2d8953(0x11c)])clearTimeout(_0x27d738[_0x2d8953(0x11c)]);if(_0x27d738[_0x2d8953(0x15b)])clearTimeout(_0x27d738[_0x2d8953(0x15b)]);_0x27d738[_0x2d8953(0x11c)]=null,_0x27d738[_0x2d8953(0x15b)]=null,_0x27d738['isGracePeriodActive']=![];}function a5_0xb68b(_0xf40e8f,_0x30058d){const _0x3301ee=a5_0x5057();return a5_0xb68b=function(_0x31fb3e,_0x30f6ff){_0x31fb3e=_0x31fb3e-0x10c;let _0x50571a=_0x3301ee[_0x31fb3e];return _0x50571a;},a5_0xb68b(_0xf40e8f,_0x30058d);}async function setPresence(_0xbdc7bf,_0x14ec00){const _0x456938=a5_0xb68b;if(_0xbdc7bf[_0x456938(0x120)]===_0x14ec00)return;_0xbdc7bf[_0x456938(0x120)]=_0x14ec00,await _0xbdc7bf[_0x456938(0x155)](_0x456938(0x14b),{'val':_0x14ec00,'ack':!![]});}async function processSensorEvent(_0x1634f4,_0x329079,_0x1c21f3,_0x572a7d){const _0x5acca3=a5_0xb68b;if(!_0x572a7d)return null;const _0x44d7cc=_0x1c21f3['val'],_0x575cc9=Date[_0x5acca3(0x164)](),_0x2ae32e=_0x1634f4[_0x5acca3(0x17c)][_0x329079],_0x486ce6=(_0x572a7d[_0x5acca3(0x171)]||'')[_0x5acca3(0x137)](),_0x31159d=_0x486ce6[_0x5acca3(0x13b)](_0x5acca3(0x126))||_0x486ce6[_0x5acca3(0x13b)](_0x5acca3(0x122))||_0x486ce6['includes'](_0x5acca3(0x169))||_0x486ce6['includes']('heizung')||_0x486ce6[_0x5acca3(0x13b)](_0x5acca3(0x160));if(_0x31159d&&typeof _0x44d7cc===_0x5acca3(0x15d)){if(_0x44d7cc>0x50||_0x44d7cc<-0x32)return _0x1634f4[_0x5acca3(0x12e)][_0x5acca3(0x12c)]('[RECORDER]\x20Ignored\x20implausible\x20temperature:\x20'+_0x44d7cc+'\x20from\x20'+_0x329079),null;}_0x1634f4['sensorLastValues'][_0x329079]=_0x44d7cc;if(!_0x572a7d[_0x5acca3(0x159)]&&_0x2ae32e!=undefined&&_0x2ae32e==_0x44d7cc)return null;_0x1634f4['isProVersion']&&_0x31159d&&recordThermodynamics(_0x1634f4,_0x329079,_0x44d7cc,_0x572a7d[_0x5acca3(0x124)]);const _0x5d4895={'timestamp':_0x575cc9,'id':_0x329079,'name':_0x572a7d[_0x5acca3(0x125)],'type':_0x572a7d['type'],'location':_0x572a7d[_0x5acca3(0x124)],'value':_0x44d7cc};_0x1634f4[_0x5acca3(0x12a)][_0x5acca3(0x153)](_0x5d4895);if(_0x1634f4[_0x5acca3(0x12a)][_0x5acca3(0x168)]>HISTORY_MAX_SIZE)_0x1634f4['eventHistory'][_0x5acca3(0x176)]();await _0x1634f4[_0x5acca3(0x155)](_0x5acca3(0x116),{'val':JSON[_0x5acca3(0x177)](_0x5d4895),'ack':!![]}),await _0x1634f4[_0x5acca3(0x155)](_0x5acca3(0x13e),{'val':JSON[_0x5acca3(0x177)](_0x1634f4[_0x5acca3(0x12a)]),'ack':!![]});if(_0x1634f4[_0x5acca3(0x146)]){_0x1634f4['rawEventLog']['push'](_0x5d4895);if(_0x1634f4[_0x5acca3(0x149)][_0x5acca3(0x168)]>RAW_LOG_MAX_SIZE)_0x1634f4['rawEventLog']['splice'](0x0,_0x1634f4[_0x5acca3(0x149)]['length']-RAW_LOG_MAX_SIZE);await _0x1634f4[_0x5acca3(0x155)]('LTM.rawEventLog',{'val':JSON[_0x5acca3(0x177)](_0x1634f4[_0x5acca3(0x149)]),'ack':!![]}),recordSequence(_0x1634f4,_0x5d4895);}if(_0x572a7d[_0x5acca3(0x13c)]&&_0x44d7cc===!![]){if(_0x1634f4[_0x5acca3(0x120)]&&!_0x1634f4['isGracePeriodActive'])startExitTimer(_0x1634f4);else{if(!_0x1634f4[_0x5acca3(0x120)])setPresence(_0x1634f4,!![]);}}else{if(_0x572a7d[_0x5acca3(0x171)]===_0x5acca3(0x11f)&&_0x44d7cc===!![]){if(_0x1634f4['exitTimer'])abortExitTimer(_0x1634f4);if(!_0x1634f4['isPresent']&&_0x1634f4[_0x5acca3(0x154)]==='normal')setPresence(_0x1634f4,!![]);}}if(_0x1634f4[_0x5acca3(0x146)]&&_0x1634f4[_0x5acca3(0x12b)]){_0x572a7d[_0x5acca3(0x171)]==='motion'&&_0x44d7cc===!![]&&_0x572a7d['location']&&_0x1634f4[_0x5acca3(0x12b)](_0x5acca3(0x16f),{'room':_0x572a7d[_0x5acca3(0x124)]});const _0x311c41=['door',_0x5acca3(0x150),_0x5acca3(0x138),'fenster',_0x5acca3(0x121),_0x5acca3(0x131),_0x5acca3(0x113),_0x5acca3(0x16c)]['some'](_0x33d116=>_0x486ce6[_0x5acca3(0x13b)](_0x33d116)),_0x3d5fe0=['light',_0x5acca3(0x10d),_0x5acca3(0x148),_0x5acca3(0x142),_0x5acca3(0x161),'lampe'][_0x5acca3(0x123)](_0x17eb5b=>_0x486ce6[_0x5acca3(0x13b)](_0x17eb5b)),_0x53fd28=['motion',_0x5acca3(0x134),_0x5acca3(0x15a),_0x5acca3(0x157),_0x5acca3(0x11d)][_0x5acca3(0x123)](_0x49e60c=>_0x486ce6['includes'](_0x49e60c));if(_0x572a7d[_0x5acca3(0x124)]&&(_0x311c41||_0x3d5fe0||_0x53fd28)){const _0x5a95f3=_0x44d7cc===!![]||typeof _0x44d7cc===_0x5acca3(0x15d)&&_0x44d7cc>0x0,_0x4a4734=_0x311c41&&!_0x5a95f3&&_0x2ae32e!==undefined&&_0x2ae32e!=_0x44d7cc;if(_0x5a95f3||_0x4a4734){const _0x3bb807=_0x1634f4['lastTrackerEventTime']||_0x575cc9,_0x7ff82f=(_0x575cc9-_0x3bb807)/0x3e8;_0x1634f4[_0x5acca3(0x144)]=_0x575cc9,_0x1634f4[_0x5acca3(0x12b)](_0x5acca3(0x147),{'room':_0x572a7d[_0x5acca3(0x124)],'dt':_0x7ff82f});}}}return _0x5d4895;}module[a5_0x202f3a(0x166)]={'processSensorEvent':processSensorEvent,'getOutsideTemperatureNumeric':getOutsideTemperatureNumeric,'setPresence':setPresence,'abortExitTimer':abortExitTimer,'startExitTimer':startExitTimer};function a5_0x5057(){const _0x3e0456=['occupancy','.1.LEVEL','motion','isPresent','griff','temperatur','some','location','name','temperature','fenster','error','door','eventHistory','sendToPythonWrapper','debug','getForeignStateAsync','log','10QOCxiF','value','handle','.1.TEMPERATURE','5391BBeQYk','bewegung','7302nSiIuv','9032LSDxvQ','toLowerCase','window','(((.+)+)+)+$','toISOString','includes','isExit','.Current.Temperature','events.history','Unknown','round','STATE','schalter','6921BYudKA','lastTrackerEventTime','contact','isProVersion','TRACK_EVENT','switch','rawEventLog','isGracePeriodActive','system.isPresent','LTM.trainingData.thermodynamics','toString','valveMapping','useWeather','tür','push','daswetter','unshift','currentSystemMode','setStateAsync','loc','presence','[RECORDER]\x20Error:\x20','logDuplicates','präsenz','exitGraceTimer','1349352FojXUV','number','854271gSuyog','.1.ACTUAL_TEMPERATURE','thermostat','dimmer','.NextHours.Location_1.Day_1.current.temp_value','getStateAsync','now','message','exports','111618okzdne','length','klima','LTM.trainingData.sequences','LEVEL','schloss','from','constructor','SIMULATE_SIGNAL','224uRPnPB','type','search','lampe','config','kontakt','pop','stringify','getHours','Valve','157QduNFl','70986yLYtpV','sensorLastValues','openweathermap','.LEVEL','light','licht','accuweather','parse','val','.forecast.current.temperature','replace','lock','shift','string','events.lastEvent','10psucft','Temperature','936JIALaD','outdoorSensorId','.1.VALVE_STATE','exitTimer'];a5_0x5057=function(){return _0x3e0456;};return a5_0x5057();}