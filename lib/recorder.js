const a5_0x314044=a5_0xfdd6;(function(_0x12fad9,_0x245f76){const _0x4d55cd=a5_0xfdd6,_0x12d361=_0x12fad9();while(!![]){try{const _0xf6ece=parseInt(_0x4d55cd(0x15b))/0x1+-parseInt(_0x4d55cd(0x190))/0x2*(parseInt(_0x4d55cd(0x15d))/0x3)+-parseInt(_0x4d55cd(0x181))/0x4*(parseInt(_0x4d55cd(0x13a))/0x5)+-parseInt(_0x4d55cd(0x16a))/0x6*(-parseInt(_0x4d55cd(0x193))/0x7)+parseInt(_0x4d55cd(0x14f))/0x8+parseInt(_0x4d55cd(0x18b))/0x9*(parseInt(_0x4d55cd(0x152))/0xa)+parseInt(_0x4d55cd(0x175))/0xb*(-parseInt(_0x4d55cd(0x15f))/0xc);if(_0xf6ece===_0x245f76)break;else _0x12d361['push'](_0x12d361['shift']());}catch(_0x490752){_0x12d361['push'](_0x12d361['shift']());}}}(a5_0x397c,0x322a0));const a5_0x12d623=(function(){let _0x29f130=!![];return function(_0xaf1ebe,_0x23ae2e){const _0x1cdfb8=_0x29f130?function(){const _0x270c3a=a5_0xfdd6;if(_0x23ae2e){const _0x39086e=_0x23ae2e[_0x270c3a(0x120)](_0xaf1ebe,arguments);return _0x23ae2e=null,_0x39086e;}}:function(){};return _0x29f130=![],_0x1cdfb8;};}()),a5_0x463565=a5_0x12d623(this,function(){const _0x5a6d09=a5_0xfdd6;return a5_0x463565['toString']()[_0x5a6d09(0x144)](_0x5a6d09(0x195))[_0x5a6d09(0x160)]()[_0x5a6d09(0x16b)](a5_0x463565)[_0x5a6d09(0x144)](_0x5a6d09(0x195));});function a5_0xfdd6(_0x46f9ed,_0x187a8f){const _0x3e9044=a5_0x397c();return a5_0xfdd6=function(_0x463565,_0x12d623){_0x463565=_0x463565-0x11e;let _0x397c10=_0x3e9044[_0x463565];return _0x397c10;},a5_0xfdd6(_0x46f9ed,_0x187a8f);}a5_0x463565();'use strict';const HISTORY_MAX_SIZE=0x32,RAW_LOG_MAX_SIZE=0x9c4,THERMO_LOG_SIZE=0x3e8,SEQUENCE_TIMEOUT_MS=0x5*0x3c*0x3e8,MAX_TRAINING_SET_SIZE=0x1f4,EXIT_TIMER_MINUTES=0xf,EXIT_GRACE_PERIOD_SECONDS=0x1e;let activeSequence=[],sequenceTimer=null;async function getOutsideTemperatureNumeric(_0x3435de){const _0xad4a34=a5_0xfdd6;if(_0x3435de[_0xad4a34(0x18a)][_0xad4a34(0x191)])try{const _0x39bfb5=await _0x3435de[_0xad4a34(0x159)](_0x3435de['config'][_0xad4a34(0x191)]);if(_0x39bfb5&&_0x39bfb5['val']!==undefined&&_0x39bfb5[_0xad4a34(0x184)]!==null)return parseFloat(_0x39bfb5[_0xad4a34(0x184)]);}catch(_0x10578a){}const _0x1de465=_0x3435de[_0xad4a34(0x18a)][_0xad4a34(0x123)];if(!_0x3435de[_0xad4a34(0x18a)][_0xad4a34(0x146)]||!_0x1de465)return null;try{let _0x42f82c='';if(_0x1de465['includes'](_0xad4a34(0x17b)))_0x42f82c=_0x1de465+_0xad4a34(0x186);else{if(_0x1de465[_0xad4a34(0x173)](_0xad4a34(0x177)))_0x42f82c=_0x1de465+'.NextHours.Location_1.Day_1.current.temp_value';else{if(_0x1de465[_0xad4a34(0x173)](_0xad4a34(0x15a)))_0x42f82c=_0x1de465+_0xad4a34(0x15e);else{if(_0x1de465[_0xad4a34(0x173)](_0xad4a34(0x171)))_0x42f82c=_0x1de465+_0xad4a34(0x165);}}}if(_0x42f82c){const _0x116d35=await _0x3435de['getForeignStateAsync'](_0x42f82c);if(_0x116d35&&_0x116d35['val']!==undefined&&_0x116d35[_0xad4a34(0x184)]!==null)return parseFloat(_0x116d35['val']);}}catch(_0x192166){}return null;}async function recordThermodynamics(_0x333218,_0x3b882c,_0x359b80,_0x4b3834){const _0xfb2504=a5_0xfdd6,_0x2a08c2=await getOutsideTemperatureNumeric(_0x333218);if(_0x2a08c2===null)return;let _0x55b155=0x0,_0x3e2abc=![];if(_0x333218[_0xfb2504(0x18a)][_0xfb2504(0x172)])try{let _0x299af4=_0x333218[_0xfb2504(0x18a)]['valveMapping'];if(typeof _0x299af4===_0xfb2504(0x194))_0x299af4=JSON[_0xfb2504(0x17a)](_0x299af4);if(_0x299af4[_0x3b882c]){const _0x36fbe3=_0x299af4[_0x3b882c],_0x3566e6=await _0x333218[_0xfb2504(0x159)](_0x36fbe3);if(_0x3566e6&&_0x3566e6[_0xfb2504(0x184)]!==null&&_0x3566e6[_0xfb2504(0x184)]!==undefined){let _0x1fa4ec=Number(_0x3566e6[_0xfb2504(0x184)]);if(_0x1fa4ec<=1.05&&!_0x36fbe3[_0xfb2504(0x173)]('STATUS')&&!_0x36fbe3[_0xfb2504(0x173)](_0xfb2504(0x121)))_0x1fa4ec=_0x1fa4ec*0x64;_0x55b155=Math[_0xfb2504(0x126)](_0x1fa4ec),_0x3e2abc=!![];}}}catch(_0x315151){}if(!_0x3e2abc){const _0x44dd57=[{'from':_0xfb2504(0x183),'to':'.1.LEVEL'},{'from':'.1.ACTUAL_TEMPERATURE','to':_0xfb2504(0x137)},{'from':_0xfb2504(0x16d),'to':_0xfb2504(0x135)},{'from':_0xfb2504(0x148),'to':_0xfb2504(0x131)},{'from':_0xfb2504(0x151),'to':'level'},{'from':'Temperature','to':_0xfb2504(0x17e)}];for(const _0x539f11 of _0x44dd57){if(_0x3b882c[_0xfb2504(0x173)](_0x539f11[_0xfb2504(0x18c)])){const _0xf57425=_0x3b882c[_0xfb2504(0x174)](_0x539f11[_0xfb2504(0x18c)],_0x539f11['to']);try{const _0x5e272d=await _0x333218[_0xfb2504(0x159)](_0xf57425);if(_0x5e272d&&_0x5e272d[_0xfb2504(0x184)]!==null&&_0x5e272d[_0xfb2504(0x184)]!==undefined){let _0x1aeaad=Number(_0x5e272d['val']);if(typeof _0x1aeaad==='number'){if(_0x1aeaad<=1.05&&_0x539f11['to'][_0xfb2504(0x173)]('LEVEL'))_0x1aeaad=_0x1aeaad*0x64;_0x55b155=Math['round'](_0x1aeaad),_0x3e2abc=!![];break;}}}catch(_0x422824){}}}}const _0x5c41dd=await _0x333218[_0xfb2504(0x142)](_0xfb2504(0x133));let _0x3f1528=[];if(_0x5c41dd&&_0x5c41dd[_0xfb2504(0x184)])try{_0x3f1528=JSON[_0xfb2504(0x17a)](_0x5c41dd[_0xfb2504(0x184)]);}catch(_0x26233a){}_0x3f1528['push']({'ts':Date['now'](),'room':_0x4b3834||_0xfb2504(0x185),'t_in':_0x359b80,'t_out':_0x2a08c2,'valve':_0x55b155});if(_0x3f1528[_0xfb2504(0x12d)]>THERMO_LOG_SIZE)_0x3f1528[_0xfb2504(0x166)]();await _0x333218[_0xfb2504(0x150)](_0xfb2504(0x133),{'val':JSON[_0xfb2504(0x176)](_0x3f1528),'ack':!![]});}async function saveCompletedSequence(_0x2a348b){const _0x45a0b7=a5_0xfdd6;try{const _0x52a639=await _0x2a348b[_0x45a0b7(0x142)](_0x45a0b7(0x139));let _0x145cfa=[];if(_0x52a639&&_0x52a639[_0x45a0b7(0x184)])try{_0x145cfa=JSON['parse'](_0x52a639[_0x45a0b7(0x184)]);}catch(_0x5e7c60){}const _0x5458d6=activeSequence[0x0]['ts'],_0x3a4dec=activeSequence[_0x45a0b7(0x157)](_0x26c4a8=>({'loc':_0x26c4a8[_0x45a0b7(0x17d)],'t_delta':Math[_0x45a0b7(0x126)]((_0x26c4a8['ts']-_0x5458d6)/0x3e8)})),_0x53faef={'timestamp':new Date(_0x5458d6)[_0x45a0b7(0x16e)](),'steps':_0x3a4dec,'duration':Math[_0x45a0b7(0x126)]((activeSequence[activeSequence['length']-0x1]['ts']-_0x5458d6)/0x3e8),'daytime':new Date(_0x5458d6)[_0x45a0b7(0x153)]()};_0x145cfa['push'](_0x53faef);if(_0x145cfa[_0x45a0b7(0x12d)]>MAX_TRAINING_SET_SIZE)_0x145cfa['shift']();await _0x2a348b[_0x45a0b7(0x150)](_0x45a0b7(0x139),{'val':JSON[_0x45a0b7(0x176)](_0x145cfa),'ack':!![]}),_0x2a348b[_0x45a0b7(0x122)]&&_0x2a348b[_0x45a0b7(0x163)]&&_0x2a348b[_0x45a0b7(0x163)](_0x45a0b7(0x18f),{'sequence':_0x53faef});}catch(_0x646cc1){_0x2a348b['log'][_0x45a0b7(0x14e)]('[RECORDER]\x20Error:\x20'+_0x646cc1[_0x45a0b7(0x162)]);}}function a5_0x397c(){const _0x4223d0=['loc','Valve','motion','thermostat','134944moCRZr','location','.1.ACTUAL_TEMPERATURE','val','Unknown','.Current.Temperature','exports','heizung','klima','config','117iafiUX','from','system.isPresent','schalter','ANALYZE_SEQUENCE','532frlZrM','outdoorSensorId','presence','161qgoHss','string','(((.+)+)+)+$','push','lock','apply','STATE','isProVersion','weatherInstance','bewegung','fenster','round','temperatur','switch','log','some','splice','toLowerCase','length','unshift','logDuplicates','name','.LEVEL','contact','LTM.trainingData.thermodynamics','lastTrackerEventTime','.4.VALVE_STATE','isGracePeriodActive','.1.VALVE_STATE','light','LTM.trainingData.sequences','50NadLNJ','TRACK_EVENT','sensorLastValues','schloss','griff','rawEventLog','tür','normal','getStateAsync','exitGraceTimer','search','type','useWeather','isPresent','.ACTUAL_TEMPERATURE','occupancy','präsenz','isExit','pop','now','error','3020024oodpmE','setStateAsync','temperature','258120Irhzkw','getHours','exitTimer','handle','currentSystemMode','map','LTM.rawEventLog','getForeignStateAsync','openweathermap','331276nBHznb','number','354jBZWxj','.forecast.current.temperature','624rjxLax','toString','events.history','message','sendToPythonWrapper','licht','.forecast.current.temp','shift','value','lampe','dimmer','53994hoYniN','constructor','SIMULATE_SIGNAL','.1.TEMPERATURE','toISOString','window','\x20from\x20','weatherunderground','valveMapping','includes','replace','143231aFFfMV','stringify','daswetter','door','events.lastEvent','parse','accuweather','eventHistory'];a5_0x397c=function(){return _0x4223d0;};return a5_0x397c();}async function recordSequence(_0x234046,_0x211f29){const _0x4024b6=a5_0xfdd6,_0x150f02=(_0x211f29[_0x4024b6(0x145)]||'')[_0x4024b6(0x12c)](),_0x7b37ed=[_0x4024b6(0x17f),'bewegung','präsenz',_0x4024b6(0x192),'occupancy','door',_0x4024b6(0x140),_0x4024b6(0x16f),_0x4024b6(0x125),_0x4024b6(0x132),'kontakt',_0x4024b6(0x138),_0x4024b6(0x164),_0x4024b6(0x128),_0x4024b6(0x18e),_0x4024b6(0x169),_0x4024b6(0x168)];if(!_0x7b37ed[_0x4024b6(0x12a)](_0x189d6d=>_0x150f02['includes'](_0x189d6d)))return;if(!_0x211f29[_0x4024b6(0x167)])return;if(sequenceTimer)clearTimeout(sequenceTimer);activeSequence[_0x4024b6(0x11e)]({'loc':_0x211f29[_0x4024b6(0x182)]||'Unknown','id':_0x211f29['id'],'ts':Date[_0x4024b6(0x14d)]()}),sequenceTimer=setTimeout(async()=>{const _0x29df86=_0x4024b6;if(activeSequence[_0x29df86(0x12d)]>0x1)await saveCompletedSequence(_0x234046);activeSequence=[];},SEQUENCE_TIMEOUT_MS);}function startExitTimer(_0x5e4e08){const _0x17aaa0=a5_0xfdd6;abortExitTimer(_0x5e4e08),_0x5e4e08[_0x17aaa0(0x136)]=!![],_0x5e4e08['exitGraceTimer']=setTimeout(()=>{const _0x2da0d2=_0x17aaa0;_0x5e4e08[_0x2da0d2(0x136)]=![];},EXIT_GRACE_PERIOD_SECONDS*0x3e8),_0x5e4e08[_0x17aaa0(0x154)]=setTimeout(()=>{setPresence(_0x5e4e08,![]),_0x5e4e08['exitTimer']=null;},EXIT_TIMER_MINUTES*0x3c*0x3e8);}function abortExitTimer(_0x20806e){const _0x139ec9=a5_0xfdd6;if(_0x20806e[_0x139ec9(0x154)])clearTimeout(_0x20806e[_0x139ec9(0x154)]);if(_0x20806e[_0x139ec9(0x143)])clearTimeout(_0x20806e['exitGraceTimer']);_0x20806e[_0x139ec9(0x154)]=null,_0x20806e[_0x139ec9(0x143)]=null,_0x20806e[_0x139ec9(0x136)]=![];}async function setPresence(_0x67c1f2,_0x5995d6){const _0x26c8ae=a5_0xfdd6;if(_0x67c1f2[_0x26c8ae(0x147)]===_0x5995d6)return;_0x67c1f2[_0x26c8ae(0x147)]=_0x5995d6,await _0x67c1f2['setStateAsync'](_0x26c8ae(0x18d),{'val':_0x5995d6,'ack':!![]});}async function processSensorEvent(_0x4331da,_0x3e7e2d,_0x554c8d,_0x544e64){const _0x3e991f=a5_0xfdd6;if(!_0x544e64)return null;const _0x31d813=_0x554c8d[_0x3e991f(0x184)],_0x31d357=Date[_0x3e991f(0x14d)](),_0x574212=_0x4331da['sensorLastValues'][_0x3e7e2d],_0x2679d0=(_0x544e64['type']||'')[_0x3e991f(0x12c)](),_0x1f2fcd=_0x2679d0[_0x3e991f(0x173)](_0x3e991f(0x151))||_0x2679d0['includes'](_0x3e991f(0x127))||_0x2679d0[_0x3e991f(0x173)](_0x3e991f(0x189))||_0x2679d0[_0x3e991f(0x173)](_0x3e991f(0x188))||_0x2679d0[_0x3e991f(0x173)](_0x3e991f(0x180));if(_0x1f2fcd&&typeof _0x31d813===_0x3e991f(0x15c)){if(_0x31d813>0x50||_0x31d813<-0x32)return _0x4331da[_0x3e991f(0x129)]['debug']('[RECORDER]\x20Ignored\x20implausible\x20temperature:\x20'+_0x31d813+_0x3e991f(0x170)+_0x3e7e2d),null;}_0x4331da[_0x3e991f(0x13c)][_0x3e7e2d]=_0x31d813;if(!_0x544e64[_0x3e991f(0x12f)]&&_0x574212!=undefined&&_0x574212==_0x31d813)return null;_0x4331da[_0x3e991f(0x122)]&&_0x1f2fcd&&recordThermodynamics(_0x4331da,_0x3e7e2d,_0x31d813,_0x544e64[_0x3e991f(0x182)]);const _0x2bf4dd={'timestamp':_0x31d357,'id':_0x3e7e2d,'name':_0x544e64[_0x3e991f(0x130)],'type':_0x544e64[_0x3e991f(0x145)],'location':_0x544e64[_0x3e991f(0x182)],'value':_0x31d813};_0x4331da[_0x3e991f(0x17c)][_0x3e991f(0x12e)](_0x2bf4dd);if(_0x4331da[_0x3e991f(0x17c)]['length']>HISTORY_MAX_SIZE)_0x4331da[_0x3e991f(0x17c)][_0x3e991f(0x14c)]();await _0x4331da[_0x3e991f(0x150)](_0x3e991f(0x179),{'val':JSON[_0x3e991f(0x176)](_0x2bf4dd),'ack':!![]}),await _0x4331da[_0x3e991f(0x150)](_0x3e991f(0x161),{'val':JSON['stringify'](_0x4331da['eventHistory']),'ack':!![]});if(_0x4331da[_0x3e991f(0x122)]){_0x4331da[_0x3e991f(0x13f)][_0x3e991f(0x11e)](_0x2bf4dd);if(_0x4331da['rawEventLog'][_0x3e991f(0x12d)]>RAW_LOG_MAX_SIZE)_0x4331da[_0x3e991f(0x13f)][_0x3e991f(0x12b)](0x0,_0x4331da[_0x3e991f(0x13f)][_0x3e991f(0x12d)]-RAW_LOG_MAX_SIZE);await _0x4331da['setStateAsync'](_0x3e991f(0x158),{'val':JSON['stringify'](_0x4331da[_0x3e991f(0x13f)]),'ack':!![]}),recordSequence(_0x4331da,_0x2bf4dd);}if(_0x544e64[_0x3e991f(0x14b)]&&_0x31d813===!![]){if(_0x4331da[_0x3e991f(0x147)]&&!_0x4331da[_0x3e991f(0x136)])startExitTimer(_0x4331da);else{if(!_0x4331da[_0x3e991f(0x147)])setPresence(_0x4331da,!![]);}}else{if(_0x544e64[_0x3e991f(0x145)]===_0x3e991f(0x17f)&&_0x31d813===!![]){if(_0x4331da[_0x3e991f(0x154)])abortExitTimer(_0x4331da);if(!_0x4331da[_0x3e991f(0x147)]&&_0x4331da[_0x3e991f(0x156)]===_0x3e991f(0x141))setPresence(_0x4331da,!![]);}}if(_0x4331da[_0x3e991f(0x122)]&&_0x4331da[_0x3e991f(0x163)]){_0x544e64[_0x3e991f(0x145)]===_0x3e991f(0x17f)&&_0x31d813===!![]&&_0x544e64[_0x3e991f(0x182)]&&_0x4331da[_0x3e991f(0x163)](_0x3e991f(0x16c),{'room':_0x544e64['location']});const _0x8248da=[_0x3e991f(0x178),_0x3e991f(0x140),_0x3e991f(0x16f),_0x3e991f(0x125),_0x3e991f(0x13e),_0x3e991f(0x155),_0x3e991f(0x11f),_0x3e991f(0x13d)][_0x3e991f(0x12a)](_0x3e65fa=>_0x2679d0['includes'](_0x3e65fa)),_0x36a303=['light',_0x3e991f(0x164),_0x3e991f(0x128),_0x3e991f(0x18e),_0x3e991f(0x169),_0x3e991f(0x168)]['some'](_0x87d06a=>_0x2679d0[_0x3e991f(0x173)](_0x87d06a)),_0x589895=['motion',_0x3e991f(0x124),_0x3e991f(0x14a),_0x3e991f(0x192),_0x3e991f(0x149)][_0x3e991f(0x12a)](_0x2fb77e=>_0x2679d0[_0x3e991f(0x173)](_0x2fb77e));if(_0x544e64[_0x3e991f(0x182)]&&(_0x8248da||_0x36a303||_0x589895)){const _0x1934b6=_0x31d813===!![]||typeof _0x31d813==='number'&&_0x31d813>0x0,_0x3021ed=_0x8248da&&!_0x1934b6&&_0x574212!==undefined&&_0x574212!=_0x31d813;if(_0x1934b6||_0x3021ed){const _0x4e2307=_0x4331da[_0x3e991f(0x134)]||_0x31d357,_0x2f796d=(_0x31d357-_0x4e2307)/0x3e8;_0x4331da[_0x3e991f(0x134)]=_0x31d357,_0x4331da[_0x3e991f(0x163)](_0x3e991f(0x13b),{'room':_0x544e64[_0x3e991f(0x182)],'dt':_0x2f796d});}}}return _0x2bf4dd;}module[a5_0x314044(0x187)]={'processSensorEvent':processSensorEvent,'getOutsideTemperatureNumeric':getOutsideTemperatureNumeric,'setPresence':setPresence,'abortExitTimer':abortExitTimer,'startExitTimer':startExitTimer};