const a5_0x477433=a5_0x16ac;(function(_0x373689,_0x52641d){const _0x2b4bd8=a5_0x16ac,_0x277b34=_0x373689();while(!![]){try{const _0x35d3f4=parseInt(_0x2b4bd8(0x17c))/0x1+parseInt(_0x2b4bd8(0x1a3))/0x2*(-parseInt(_0x2b4bd8(0x1ae))/0x3)+-parseInt(_0x2b4bd8(0x1a1))/0x4+parseInt(_0x2b4bd8(0x195))/0x5+parseInt(_0x2b4bd8(0x179))/0x6+parseInt(_0x2b4bd8(0x168))/0x7+parseInt(_0x2b4bd8(0x19c))/0x8*(-parseInt(_0x2b4bd8(0x167))/0x9);if(_0x35d3f4===_0x52641d)break;else _0x277b34['push'](_0x277b34['shift']());}catch(_0x46e881){_0x277b34['push'](_0x277b34['shift']());}}}(a5_0x25a2,0xeb379));const a5_0x13ab6d=(function(){let _0x2195f4=!![];return function(_0x3b883d,_0x4a8af6){const _0x5b508d=_0x2195f4?function(){const _0x2ae690=a5_0x16ac;if(_0x4a8af6){const _0x427909=_0x4a8af6[_0x2ae690(0x198)](_0x3b883d,arguments);return _0x4a8af6=null,_0x427909;}}:function(){};return _0x2195f4=![],_0x5b508d;};}()),a5_0x55823c=a5_0x13ab6d(this,function(){const _0x389c45=a5_0x16ac;return a5_0x55823c[_0x389c45(0x1ba)]()[_0x389c45(0x178)](_0x389c45(0x1c2))['toString']()[_0x389c45(0x1a2)](a5_0x55823c)[_0x389c45(0x178)]('(((.+)+)+)+$');});a5_0x55823c();'use strict';const HISTORY_MAX_SIZE=0x32,RAW_LOG_MAX_SIZE=0x9c4,THERMO_LOG_SIZE=0x3e8,SEQUENCE_TIMEOUT_MS=0x5*0x3c*0x3e8,MAX_TRAINING_SET_SIZE=0x1f4,EXIT_TIMER_MINUTES=0xf,EXIT_GRACE_PERIOD_SECONDS=0x1e;let activeSequence=[],sequenceTimer=null;async function getOutsideTemperatureNumeric(_0x5b682a){const _0x46a49c=a5_0x16ac;if(_0x5b682a[_0x46a49c(0x16b)]['outdoorSensorId'])try{const _0x2a44ed=await _0x5b682a[_0x46a49c(0x17a)](_0x5b682a['config'][_0x46a49c(0x1b7)]);if(_0x2a44ed&&_0x2a44ed[_0x46a49c(0x169)]!==undefined&&_0x2a44ed[_0x46a49c(0x169)]!==null)return parseFloat(_0x2a44ed['val']);}catch(_0x36a0ad){}const _0x2a967b=_0x5b682a[_0x46a49c(0x16b)][_0x46a49c(0x1bb)];if(!_0x5b682a[_0x46a49c(0x16b)]['useWeather']||!_0x2a967b)return null;try{let _0x2af26f='';if(_0x2a967b[_0x46a49c(0x1c4)](_0x46a49c(0x1bf)))_0x2af26f=_0x2a967b+_0x46a49c(0x188);else{if(_0x2a967b[_0x46a49c(0x1c4)](_0x46a49c(0x171)))_0x2af26f=_0x2a967b+_0x46a49c(0x18c);else{if(_0x2a967b[_0x46a49c(0x1c4)]('openweathermap'))_0x2af26f=_0x2a967b+_0x46a49c(0x19a);else{if(_0x2a967b[_0x46a49c(0x1c4)](_0x46a49c(0x1bc)))_0x2af26f=_0x2a967b+_0x46a49c(0x1af);}}}if(_0x2af26f){const _0x4fc73d=await _0x5b682a[_0x46a49c(0x17a)](_0x2af26f);if(_0x4fc73d&&_0x4fc73d[_0x46a49c(0x169)]!==undefined&&_0x4fc73d[_0x46a49c(0x169)]!==null)return parseFloat(_0x4fc73d[_0x46a49c(0x169)]);}}catch(_0x3131af){}return null;}function a5_0x16ac(_0x2e9ebb,_0x39a4d1){const _0x2687ed=a5_0x25a2();return a5_0x16ac=function(_0x55823c,_0x13ab6d){_0x55823c=_0x55823c-0x165;let _0x25a20e=_0x2687ed[_0x55823c];return _0x25a20e;},a5_0x16ac(_0x2e9ebb,_0x39a4d1);}async function recordThermodynamics(_0x333f48,_0x54b3f1,_0xe0f487,_0x28fe70){const _0x5e2897=a5_0x16ac,_0x2ca3d1=await getOutsideTemperatureNumeric(_0x333f48);let _0x4e25b7=0x0;if(_0x54b3f1[_0x5e2897(0x1c4)](_0x5e2897(0x1ac))){const _0x5e33d8=[{'from':_0x5e2897(0x196),'to':_0x5e2897(0x174)},{'from':_0x5e2897(0x196),'to':'.1.VALVE_STATE'},{'from':'.1.TEMPERATURE','to':_0x5e2897(0x1b4)},{'from':_0x5e2897(0x1b1),'to':_0x5e2897(0x177)}];for(const _0x2fe40 of _0x5e33d8){if(_0x54b3f1[_0x5e2897(0x1c4)](_0x2fe40[_0x5e2897(0x1a5)])){const _0xaec4ee=_0x54b3f1[_0x5e2897(0x166)](_0x2fe40['from'],_0x2fe40['to']);try{const _0x94d853=await _0x333f48[_0x5e2897(0x17a)](_0xaec4ee);if(_0x94d853&&_0x94d853[_0x5e2897(0x169)]!==null&&_0x94d853[_0x5e2897(0x169)]!==undefined){let _0x5ba436=_0x94d853[_0x5e2897(0x169)];typeof _0x5ba436==='number'&&_0x5ba436<=1.05&&_0x2fe40['to'][_0x5e2897(0x1c4)](_0x5e2897(0x193))&&(_0x5ba436=_0x5ba436*0x64);_0x4e25b7=Math[_0x5e2897(0x16d)](_0x5ba436);break;}}catch(_0x32ec1a){}}}}const _0x40ec37=await _0x333f48[_0x5e2897(0x1b8)]('LTM.trainingData.thermodynamics');let _0x55c8e2=[];if(_0x40ec37&&_0x40ec37['val'])try{_0x55c8e2=JSON['parse'](_0x40ec37[_0x5e2897(0x169)]);}catch(_0x3d92f4){}_0x55c8e2[_0x5e2897(0x19d)]({'ts':Date[_0x5e2897(0x190)](),'room':_0x28fe70||'Unknown','t_in':_0xe0f487,'t_out':_0x2ca3d1,'valve':_0x4e25b7});if(_0x55c8e2['length']>THERMO_LOG_SIZE)_0x55c8e2[_0x5e2897(0x175)]();await _0x333f48[_0x5e2897(0x197)](_0x5e2897(0x187),{'val':JSON[_0x5e2897(0x180)](_0x55c8e2),'ack':!![]});}async function saveCompletedSequence(_0x5eba72){const _0x4452d3=a5_0x16ac;try{const _0x313614=await _0x5eba72[_0x4452d3(0x1b8)](_0x4452d3(0x172));let _0x40ae80=[];if(_0x313614&&_0x313614[_0x4452d3(0x169)])try{_0x40ae80=JSON['parse'](_0x313614[_0x4452d3(0x169)]);}catch(_0x2d43c9){}const _0x525268=activeSequence[0x0]['ts'],_0x31c212=activeSequence[_0x4452d3(0x1b2)](_0x1c2f72=>({'loc':_0x1c2f72[_0x4452d3(0x1b0)],'t_delta':Math[_0x4452d3(0x16d)]((_0x1c2f72['ts']-_0x525268)/0x3e8)})),_0x35e109={'timestamp':new Date(_0x525268)[_0x4452d3(0x1c1)](),'steps':_0x31c212,'duration':Math[_0x4452d3(0x16d)]((activeSequence[activeSequence[_0x4452d3(0x19b)]-0x1]['ts']-_0x525268)/0x3e8),'daytime':new Date(_0x525268)[_0x4452d3(0x16c)]()};_0x40ae80[_0x4452d3(0x19d)](_0x35e109);if(_0x40ae80[_0x4452d3(0x19b)]>MAX_TRAINING_SET_SIZE)_0x40ae80['shift']();await _0x5eba72['setStateAsync'](_0x4452d3(0x172),{'val':JSON[_0x4452d3(0x180)](_0x40ae80),'ack':!![]}),_0x5eba72[_0x4452d3(0x1a6)]&&_0x5eba72[_0x4452d3(0x185)]&&_0x5eba72['sendToPythonWrapper'](_0x4452d3(0x199),{'sequence':_0x35e109});}catch(_0x4dd24e){_0x5eba72[_0x4452d3(0x1b5)][_0x4452d3(0x1b6)](_0x4452d3(0x18d)+_0x4dd24e[_0x4452d3(0x1a0)]);}}async function recordSequence(_0x4efa3c,_0x25a400){const _0x3e9917=a5_0x16ac,_0x5ed618=(_0x25a400[_0x3e9917(0x194)]||'')[_0x3e9917(0x18a)](),_0x3b0573=[_0x3e9917(0x16a),_0x3e9917(0x1b9),'präsenz',_0x3e9917(0x1bd),_0x3e9917(0x17e),'door',_0x3e9917(0x182),'window','fenster','contact',_0x3e9917(0x19e),_0x3e9917(0x16f),'licht',_0x3e9917(0x184),_0x3e9917(0x17d),_0x3e9917(0x186),_0x3e9917(0x1be)];if(!_0x3b0573[_0x3e9917(0x17f)](_0x206f99=>_0x5ed618[_0x3e9917(0x1c4)](_0x206f99)))return;if(!_0x25a400[_0x3e9917(0x1ad)])return;if(sequenceTimer)clearTimeout(sequenceTimer);activeSequence[_0x3e9917(0x19d)]({'loc':_0x25a400['location']||_0x3e9917(0x1c5),'id':_0x25a400['id'],'ts':Date['now']()}),sequenceTimer=setTimeout(async()=>{const _0x257e92=_0x3e9917;if(activeSequence[_0x257e92(0x19b)]>0x1)await saveCompletedSequence(_0x4efa3c);activeSequence=[];},SEQUENCE_TIMEOUT_MS);}function startExitTimer(_0x4c5dd1){const _0x1baaf3=a5_0x16ac;abortExitTimer(_0x4c5dd1),_0x4c5dd1[_0x1baaf3(0x191)]=!![],_0x4c5dd1[_0x1baaf3(0x19f)]=setTimeout(()=>{const _0x42e40c=_0x1baaf3;_0x4c5dd1[_0x42e40c(0x191)]=![];},EXIT_GRACE_PERIOD_SECONDS*0x3e8),_0x4c5dd1[_0x1baaf3(0x192)]=setTimeout(()=>{const _0x4c63=_0x1baaf3;setPresence(_0x4c5dd1,![]),_0x4c5dd1[_0x4c63(0x192)]=null;},EXIT_TIMER_MINUTES*0x3c*0x3e8);}function abortExitTimer(_0x437975){const _0x29a192=a5_0x16ac;if(_0x437975['exitTimer'])clearTimeout(_0x437975[_0x29a192(0x192)]);if(_0x437975[_0x29a192(0x19f)])clearTimeout(_0x437975[_0x29a192(0x19f)]);_0x437975['exitTimer']=null,_0x437975['exitGraceTimer']=null,_0x437975[_0x29a192(0x191)]=![];}async function setPresence(_0x51a2ba,_0x559dda){const _0x5f330b=a5_0x16ac;if(_0x51a2ba[_0x5f330b(0x170)]===_0x559dda)return;_0x51a2ba['isPresent']=_0x559dda,await _0x51a2ba[_0x5f330b(0x197)](_0x5f330b(0x181),{'val':_0x559dda,'ack':!![]});}function a5_0x25a2(){const _0x17a55a=['dimmer','LTM.trainingData.thermodynamics','.Current.Temperature','sensorLastValues','toLowerCase','rawEventLog','.NextHours.Location_1.Day_1.current.temp_value','[RECORDER]\x20Error:\x20','location','unshift','now','isGracePeriodActive','exitTimer','LEVEL','type','8023760TVTMUJ','.1.ACTUAL_TEMPERATURE','setStateAsync','apply','ANALYZE_SEQUENCE','.forecast.current.temperature','length','1144jSVTlo','push','kontakt','exitGraceTimer','message','5800280gsGlPw','constructor','3126zukvhB','heizung','from','isProVersion','events.lastEvent','temperature','normal','splice','exports','hm-rpc','value','1836yAjMcI','.forecast.current.temp','loc','.ACTUAL_TEMPERATURE','map','klima','.4.VALVE_STATE','log','error','outdoorSensorId','getStateAsync','bewegung','toString','weatherInstance','weatherunderground','presence','lampe','accuweather','currentSystemMode','toISOString','(((.+)+)+)+$','LTM.rawEventLog','includes','Unknown','eventHistory','replace','84924eaVKxf','11847087iywHHG','val','motion','config','getHours','round','logDuplicates','light','isPresent','daswetter','LTM.trainingData.sequences','pop','.1.LEVEL','shift','SIMULATE_SIGNAL','.LEVEL','search','7723626ROChNC','getForeignStateAsync','isExit','134959RmetsF','schalter','occupancy','some','stringify','system.isPresent','tür','events.history','switch','sendToPythonWrapper'];a5_0x25a2=function(){return _0x17a55a;};return a5_0x25a2();}async function processSensorEvent(_0x293d4c,_0x1a8d32,_0x27818e,_0x405e77){const _0x354185=a5_0x16ac;if(!_0x405e77)return null;const _0x19b112=_0x27818e[_0x354185(0x169)],_0x1aa42d=Date[_0x354185(0x190)](),_0x479028=_0x293d4c[_0x354185(0x189)][_0x1a8d32];_0x293d4c[_0x354185(0x189)][_0x1a8d32]=_0x19b112;if(!_0x405e77[_0x354185(0x16e)]&&_0x479028!=undefined&&_0x479028==_0x19b112)return null;const _0x3c60d4=(_0x405e77[_0x354185(0x194)]||'')[_0x354185(0x18a)](),_0x3c1ddb=_0x3c60d4['includes'](_0x354185(0x1a8))||_0x3c60d4[_0x354185(0x1c4)]('temperatur')||_0x3c60d4[_0x354185(0x1c4)](_0x354185(0x1b3))||_0x3c60d4['includes'](_0x354185(0x1a4));_0x293d4c[_0x354185(0x1a6)]&&_0x3c1ddb&&recordThermodynamics(_0x293d4c,_0x1a8d32,_0x19b112,_0x405e77['location']);const _0x1c3e0c={'timestamp':_0x1aa42d,'id':_0x1a8d32,'name':_0x405e77['name'],'type':_0x405e77['type'],'location':_0x405e77['location'],'value':_0x19b112};_0x293d4c['eventHistory'][_0x354185(0x18f)](_0x1c3e0c);if(_0x293d4c[_0x354185(0x165)][_0x354185(0x19b)]>HISTORY_MAX_SIZE)_0x293d4c['eventHistory'][_0x354185(0x173)]();await _0x293d4c[_0x354185(0x197)](_0x354185(0x1a7),{'val':JSON[_0x354185(0x180)](_0x1c3e0c),'ack':!![]}),await _0x293d4c['setStateAsync'](_0x354185(0x183),{'val':JSON[_0x354185(0x180)](_0x293d4c[_0x354185(0x165)]),'ack':!![]});if(_0x293d4c['isProVersion']){_0x293d4c[_0x354185(0x18b)]['push'](_0x1c3e0c);if(_0x293d4c[_0x354185(0x18b)][_0x354185(0x19b)]>RAW_LOG_MAX_SIZE)_0x293d4c[_0x354185(0x18b)][_0x354185(0x1aa)](0x0,_0x293d4c[_0x354185(0x18b)][_0x354185(0x19b)]-RAW_LOG_MAX_SIZE);await _0x293d4c[_0x354185(0x197)](_0x354185(0x1c3),{'val':JSON[_0x354185(0x180)](_0x293d4c[_0x354185(0x18b)]),'ack':!![]}),recordSequence(_0x293d4c,_0x1c3e0c);}if(_0x405e77[_0x354185(0x17b)]&&_0x19b112===!![]){if(_0x293d4c['isPresent']&&!_0x293d4c[_0x354185(0x191)])startExitTimer(_0x293d4c);else{if(!_0x293d4c[_0x354185(0x170)])setPresence(_0x293d4c,!![]);}}else{if(_0x405e77[_0x354185(0x194)]===_0x354185(0x16a)&&_0x19b112===!![]){if(_0x293d4c[_0x354185(0x192)])abortExitTimer(_0x293d4c);if(!_0x293d4c[_0x354185(0x170)]&&_0x293d4c[_0x354185(0x1c0)]===_0x354185(0x1a9))setPresence(_0x293d4c,!![]);}}return _0x293d4c[_0x354185(0x1a6)]&&_0x405e77[_0x354185(0x194)]==='motion'&&_0x19b112===!![]&&_0x405e77[_0x354185(0x18e)]&&_0x293d4c['sendToPythonWrapper']&&_0x293d4c['sendToPythonWrapper'](_0x354185(0x176),{'room':_0x405e77[_0x354185(0x18e)]}),_0x1c3e0c;}module[a5_0x477433(0x1ab)]={'processSensorEvent':processSensorEvent,'getOutsideTemperatureNumeric':getOutsideTemperatureNumeric,'setPresence':setPresence,'abortExitTimer':abortExitTimer,'startExitTimer':startExitTimer};