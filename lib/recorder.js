const a4_0x3a80ee=a4_0x3d6b;(function(_0x1679af,_0x5ee8bb){const _0x519676=a4_0x3d6b,_0x831aeb=_0x1679af();while(!![]){try{const _0x1ac5fa=-parseInt(_0x519676(0x10f))/0x1*(parseInt(_0x519676(0xfe))/0x2)+parseInt(_0x519676(0x116))/0x3+-parseInt(_0x519676(0xde))/0x4+parseInt(_0x519676(0x112))/0x5*(-parseInt(_0x519676(0x11d))/0x6)+parseInt(_0x519676(0x104))/0x7+-parseInt(_0x519676(0xe0))/0x8+parseInt(_0x519676(0x11b))/0x9;if(_0x1ac5fa===_0x5ee8bb)break;else _0x831aeb['push'](_0x831aeb['shift']());}catch(_0x1a40da){_0x831aeb['push'](_0x831aeb['shift']());}}}(a4_0x527c,0xb1259));function a4_0x3d6b(_0x5de123,_0x30ddcb){const _0x2f50b2=a4_0x527c();return a4_0x3d6b=function(_0x3099b9,_0x2b9a8a){_0x3099b9=_0x3099b9-0xd8;let _0x527c0d=_0x2f50b2[_0x3099b9];return _0x527c0d;},a4_0x3d6b(_0x5de123,_0x30ddcb);}const a4_0x2b9a8a=(function(){let _0x1a8359=!![];return function(_0x4cdee1,_0x317854){const _0x46ccd7=_0x1a8359?function(){const _0x51789c=a4_0x3d6b;if(_0x317854){const _0x57eab0=_0x317854[_0x51789c(0x113)](_0x4cdee1,arguments);return _0x317854=null,_0x57eab0;}}:function(){};return _0x1a8359=![],_0x46ccd7;};}()),a4_0x3099b9=a4_0x2b9a8a(this,function(){const _0x204bd4=a4_0x3d6b;return a4_0x3099b9['toString']()[_0x204bd4(0xf9)]('(((.+)+)+)+$')['toString']()[_0x204bd4(0x121)](a4_0x3099b9)[_0x204bd4(0xf9)](_0x204bd4(0xd9));});a4_0x3099b9();'use strict';const HISTORY_MAX_SIZE=0x32,RAW_LOG_MAX_SIZE=0x9c4,THERMO_LOG_SIZE=0x3e8,SEQUENCE_TIMEOUT_MS=0x5*0x3c*0x3e8,MAX_TRAINING_SET_SIZE=0x1f4,EXIT_TIMER_MINUTES=0xf,EXIT_GRACE_PERIOD_SECONDS=0x1e;let activeSequence=[],sequenceTimer=null;async function getOutsideTemperatureNumeric(_0x249c01){const _0x50cf92=a4_0x3d6b;if(_0x249c01['config'][_0x50cf92(0x11e)])try{const _0x51bbd6=await _0x249c01[_0x50cf92(0xf4)](_0x249c01[_0x50cf92(0xe9)][_0x50cf92(0x11e)]);if(_0x51bbd6&&_0x51bbd6[_0x50cf92(0xed)]!==undefined&&_0x51bbd6[_0x50cf92(0xed)]!==null)return parseFloat(_0x51bbd6[_0x50cf92(0xed)]);}catch(_0x264297){}const _0x5ef8d3=_0x249c01[_0x50cf92(0xe9)][_0x50cf92(0x111)];if(!_0x249c01[_0x50cf92(0xe9)][_0x50cf92(0x106)]||!_0x5ef8d3)return null;try{let _0x560159='';if(_0x5ef8d3[_0x50cf92(0xe2)]('accuweather'))_0x560159=_0x5ef8d3+'.Current.Temperature';else{if(_0x5ef8d3['includes']('daswetter'))_0x560159=_0x5ef8d3+_0x50cf92(0x100);else{if(_0x5ef8d3[_0x50cf92(0xe2)](_0x50cf92(0x110)))_0x560159=_0x5ef8d3+_0x50cf92(0xee);else{if(_0x5ef8d3[_0x50cf92(0xe2)](_0x50cf92(0xe6)))_0x560159=_0x5ef8d3+_0x50cf92(0xec);}}}if(_0x560159){const _0x510b5b=await _0x249c01['getForeignStateAsync'](_0x560159);if(_0x510b5b&&_0x510b5b['val']!==undefined&&_0x510b5b[_0x50cf92(0xed)]!==null)return parseFloat(_0x510b5b['val']);}}catch(_0x2c1c5f){}return null;}async function recordThermodynamics(_0x32b794,_0x1217e6,_0x1599ad,_0x27cdf4){const _0x43b0f0=a4_0x3d6b,_0x170233=await getOutsideTemperatureNumeric(_0x32b794),_0x5c2d96=await _0x32b794[_0x43b0f0(0xea)]('LTM.trainingData.thermodynamics');let _0x5cc50a=[];if(_0x5c2d96&&_0x5c2d96[_0x43b0f0(0xed)])try{_0x5cc50a=JSON[_0x43b0f0(0xdc)](_0x5c2d96[_0x43b0f0(0xed)]);}catch(_0x2baa03){}_0x5cc50a[_0x43b0f0(0x101)]({'ts':Date[_0x43b0f0(0x10a)](),'room':_0x27cdf4||_0x43b0f0(0xe8),'t_in':_0x1599ad,'t_out':_0x170233});if(_0x5cc50a[_0x43b0f0(0x124)]>THERMO_LOG_SIZE)_0x5cc50a['shift']();await _0x32b794['setStateAsync'](_0x43b0f0(0xf6),{'val':JSON[_0x43b0f0(0xfd)](_0x5cc50a),'ack':!![]});}async function saveCompletedSequence(_0x3d54f8){const _0x5e9d86=a4_0x3d6b;try{const _0x49bcda=await _0x3d54f8[_0x5e9d86(0xea)](_0x5e9d86(0xf7));let _0x574bc5=[];if(_0x49bcda&&_0x49bcda[_0x5e9d86(0xed)])try{_0x574bc5=JSON[_0x5e9d86(0xdc)](_0x49bcda[_0x5e9d86(0xed)]);}catch(_0x2a7a96){}const _0x5d1f0a=activeSequence[0x0]['ts'],_0xfdcff8=activeSequence['map'](_0x2bfe74=>({'loc':_0x2bfe74[_0x5e9d86(0x103)],'t_delta':Math[_0x5e9d86(0x118)]((_0x2bfe74['ts']-_0x5d1f0a)/0x3e8)})),_0x5ca1a8={'timestamp':new Date(_0x5d1f0a)[_0x5e9d86(0x10e)](),'steps':_0xfdcff8,'duration':Math[_0x5e9d86(0x118)]((activeSequence[activeSequence[_0x5e9d86(0x124)]-0x1]['ts']-_0x5d1f0a)/0x3e8),'daytime':new Date(_0x5d1f0a)[_0x5e9d86(0xf3)]()};_0x574bc5['push'](_0x5ca1a8);if(_0x574bc5[_0x5e9d86(0x124)]>MAX_TRAINING_SET_SIZE)_0x574bc5[_0x5e9d86(0x11a)]();await _0x3d54f8[_0x5e9d86(0xf2)]('LTM.trainingData.sequences',{'val':JSON[_0x5e9d86(0xfd)](_0x574bc5),'ack':!![]}),_0x3d54f8['isProVersion']&&_0x3d54f8[_0x5e9d86(0xe1)]&&_0x3d54f8[_0x5e9d86(0xe1)](_0x5e9d86(0x105),{'sequence':_0x5ca1a8});}catch(_0x38e1ef){_0x3d54f8['log'][_0x5e9d86(0x108)](_0x5e9d86(0xdf)+_0x38e1ef[_0x5e9d86(0x117)]);}}async function recordSequence(_0x30c640,_0x228a12){const _0x4eebae=a4_0x3d6b,_0x515e63=(_0x228a12[_0x4eebae(0x120)]||'')[_0x4eebae(0x128)](),_0xd1bf2a=['motion',_0x4eebae(0xfb),_0x4eebae(0x125),_0x4eebae(0xfa),'occupancy',_0x4eebae(0x10c),_0x4eebae(0x114),_0x4eebae(0x123),_0x4eebae(0xf5),_0x4eebae(0xe3),'kontakt',_0x4eebae(0x10b),'licht','switch',_0x4eebae(0xd8),'dimmer',_0x4eebae(0xfc)];if(!_0xd1bf2a[_0x4eebae(0xe5)](_0x360322=>_0x515e63[_0x4eebae(0xe2)](_0x360322)))return;if(!_0x228a12['value'])return;if(sequenceTimer)clearTimeout(sequenceTimer);activeSequence['push']({'loc':_0x228a12[_0x4eebae(0xef)]||_0x4eebae(0xe8),'id':_0x228a12['id'],'ts':Date['now']()}),sequenceTimer=setTimeout(async()=>{if(activeSequence['length']>0x1)await saveCompletedSequence(_0x30c640);activeSequence=[];},SEQUENCE_TIMEOUT_MS);}function startExitTimer(_0x3d400b){const _0x5bace8=a4_0x3d6b;abortExitTimer(_0x3d400b),_0x3d400b[_0x5bace8(0x10d)]=!![],_0x3d400b[_0x5bace8(0xf8)]=setTimeout(()=>{const _0xd7cb35=_0x5bace8;_0x3d400b[_0xd7cb35(0x10d)]=![];},EXIT_GRACE_PERIOD_SECONDS*0x3e8),_0x3d400b[_0x5bace8(0x107)]=setTimeout(()=>{const _0x93a022=_0x5bace8;setPresence(_0x3d400b,![]),_0x3d400b[_0x93a022(0x107)]=null;},EXIT_TIMER_MINUTES*0x3c*0x3e8);}function abortExitTimer(_0x599a4a){const _0x30160f=a4_0x3d6b;if(_0x599a4a[_0x30160f(0x107)])clearTimeout(_0x599a4a['exitTimer']);if(_0x599a4a['exitGraceTimer'])clearTimeout(_0x599a4a['exitGraceTimer']);_0x599a4a[_0x30160f(0x107)]=null,_0x599a4a[_0x30160f(0xf8)]=null,_0x599a4a[_0x30160f(0x10d)]=![];}async function setPresence(_0x17e971,_0x22d392){const _0x5aa043=a4_0x3d6b;if(_0x17e971[_0x5aa043(0x11c)]===_0x22d392)return;_0x17e971[_0x5aa043(0x11c)]=_0x22d392,await _0x17e971[_0x5aa043(0xf2)](_0x5aa043(0xdb),{'val':_0x22d392,'ack':!![]});}function a4_0x527c(){const _0x222dac=['115vdViaf','apply','tür','sensorLastValues','460887rSgvLj','message','round','currentSystemMode','shift','16269093YoMzVF','isPresent','96966GUEVlm','outdoorSensorId','exports','type','constructor','rawEventLog','window','length','präsenz','splice','temperatur','toLowerCase','schalter','(((.+)+)+)+$','motion','system.isPresent','parse','name','369504Ffbsze','[RECORDER]\x20Error:\x20','7118760pVDWsM','sendToPythonWrapper','includes','contact','isExit','some','weatherunderground','SIMULATE_SIGNAL','Unknown','config','getStateAsync','events.history','.forecast.current.temp','val','.forecast.current.temperature','location','eventHistory','temperature','setStateAsync','getHours','getForeignStateAsync','fenster','LTM.trainingData.thermodynamics','LTM.trainingData.sequences','exitGraceTimer','search','presence','bewegung','lampe','stringify','2Ctzdfn','unshift','.NextHours.Location_1.Day_1.current.temp_value','push','isProVersion','loc','4777584cXirGo','ANALYZE_SEQUENCE','useWeather','exitTimer','error','klima','now','light','door','isGracePeriodActive','toISOString','564301xvRGAL','openweathermap','weatherInstance'];a4_0x527c=function(){return _0x222dac;};return a4_0x527c();}async function processSensorEvent(_0x2d696a,_0x2dcfc5,_0x1d931e,_0x471c2e){const _0x3d9b0a=a4_0x3d6b;if(!_0x471c2e)return;const _0x20d058=_0x1d931e[_0x3d9b0a(0xed)],_0x4a91df=Date[_0x3d9b0a(0x10a)](),_0x3c29ac=_0x2d696a[_0x3d9b0a(0x115)][_0x2dcfc5];_0x2d696a[_0x3d9b0a(0x115)][_0x2dcfc5]=_0x20d058;if(!_0x471c2e['logDuplicates']&&_0x3c29ac!=undefined&&_0x3c29ac==_0x20d058)return;const _0x1f20a5=(_0x471c2e[_0x3d9b0a(0x120)]||'')[_0x3d9b0a(0x128)](),_0x3f1235=_0x1f20a5['includes'](_0x3d9b0a(0xf1))||_0x1f20a5[_0x3d9b0a(0xe2)](_0x3d9b0a(0x127))||_0x1f20a5[_0x3d9b0a(0xe2)](_0x3d9b0a(0x109))||_0x1f20a5['includes']('heizung');_0x2d696a[_0x3d9b0a(0x102)]&&_0x3f1235&&recordThermodynamics(_0x2d696a,_0x2dcfc5,_0x20d058,_0x471c2e[_0x3d9b0a(0xef)]);const _0x4c3b30={'timestamp':_0x4a91df,'id':_0x2dcfc5,'name':_0x471c2e[_0x3d9b0a(0xdd)],'type':_0x471c2e['type'],'location':_0x471c2e[_0x3d9b0a(0xef)],'value':_0x20d058};_0x2d696a[_0x3d9b0a(0xf0)][_0x3d9b0a(0xff)](_0x4c3b30);if(_0x2d696a[_0x3d9b0a(0xf0)][_0x3d9b0a(0x124)]>HISTORY_MAX_SIZE)_0x2d696a[_0x3d9b0a(0xf0)]['pop']();await _0x2d696a[_0x3d9b0a(0xf2)]('events.lastEvent',{'val':JSON['stringify'](_0x4c3b30),'ack':!![]}),await _0x2d696a[_0x3d9b0a(0xf2)](_0x3d9b0a(0xeb),{'val':JSON[_0x3d9b0a(0xfd)](_0x2d696a[_0x3d9b0a(0xf0)]),'ack':!![]});if(_0x2d696a[_0x3d9b0a(0x102)]){_0x2d696a[_0x3d9b0a(0x122)]['push'](_0x4c3b30);if(_0x2d696a[_0x3d9b0a(0x122)][_0x3d9b0a(0x124)]>RAW_LOG_MAX_SIZE)_0x2d696a[_0x3d9b0a(0x122)][_0x3d9b0a(0x126)](0x0,_0x2d696a[_0x3d9b0a(0x122)]['length']-RAW_LOG_MAX_SIZE);await _0x2d696a[_0x3d9b0a(0xf2)]('LTM.rawEventLog',{'val':JSON['stringify'](_0x2d696a[_0x3d9b0a(0x122)]),'ack':!![]}),recordSequence(_0x2d696a,_0x4c3b30);}if(_0x471c2e[_0x3d9b0a(0xe4)]&&_0x20d058===!![]){if(_0x2d696a['isPresent']&&!_0x2d696a[_0x3d9b0a(0x10d)])startExitTimer(_0x2d696a);else{if(!_0x2d696a[_0x3d9b0a(0x11c)])setPresence(_0x2d696a,!![]);}}else{if(_0x471c2e[_0x3d9b0a(0x120)]===_0x3d9b0a(0xda)&&_0x20d058===!![]){if(_0x2d696a[_0x3d9b0a(0x107)])abortExitTimer(_0x2d696a);if(!_0x2d696a['isPresent']&&_0x2d696a[_0x3d9b0a(0x119)]==='normal')setPresence(_0x2d696a,!![]);}}_0x2d696a[_0x3d9b0a(0x102)]&&_0x471c2e[_0x3d9b0a(0x120)]==='motion'&&_0x20d058===!![]&&_0x471c2e[_0x3d9b0a(0xef)]&&_0x2d696a[_0x3d9b0a(0xe1)]&&_0x2d696a[_0x3d9b0a(0xe1)](_0x3d9b0a(0xe7),{'room':_0x471c2e['location']});}module[a4_0x3a80ee(0x11f)]={'processSensorEvent':processSensorEvent,'getOutsideTemperatureNumeric':getOutsideTemperatureNumeric,'setPresence':setPresence,'abortExitTimer':abortExitTimer,'startExitTimer':startExitTimer};