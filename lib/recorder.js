(function(_0x3d0a3f,_0x378c6a){const _0x79d568=a5_0x2def,_0x417391=_0x3d0a3f();while(!![]){try{const _0x195124=-parseInt(_0x79d568(0x14c))/0x1*(parseInt(_0x79d568(0x11e))/0x2)+-parseInt(_0x79d568(0x176))/0x3+parseInt(_0x79d568(0x147))/0x4+-parseInt(_0x79d568(0x127))/0x5+parseInt(_0x79d568(0x121))/0x6*(parseInt(_0x79d568(0x149))/0x7)+parseInt(_0x79d568(0x123))/0x8+-parseInt(_0x79d568(0x143))/0x9;if(_0x195124===_0x378c6a)break;else _0x417391['push'](_0x417391['shift']());}catch(_0x2ed575){_0x417391['push'](_0x417391['shift']());}}}(a5_0x5286,0xa5e42));const a5_0x51cb9c=(function(){let _0x58911e=!![];return function(_0x4586fc,_0x5ac68b){const _0x4a67f3=_0x58911e?function(){const _0x509ff5=a5_0x2def;if(_0x5ac68b){const _0x12b561=_0x5ac68b[_0x509ff5(0x117)](_0x4586fc,arguments);return _0x5ac68b=null,_0x12b561;}}:function(){};return _0x58911e=![],_0x4a67f3;};}()),a5_0x319d2d=a5_0x51cb9c(this,function(){const _0x4833da=a5_0x2def;return a5_0x319d2d[_0x4833da(0x153)]()['search'](_0x4833da(0x13f))[_0x4833da(0x153)]()['constructor'](a5_0x319d2d)[_0x4833da(0x14f)](_0x4833da(0x13f));});a5_0x319d2d();'use strict';const HISTORY_MAX_SIZE=0x32,RAW_LOG_MAX_SIZE=0x9c4,THERMO_LOG_SIZE=0x3e8,SEQUENCE_TIMEOUT_MS=0x5*0x3c*0x3e8,MAX_TRAINING_SET_SIZE=0x1f4,EXIT_TIMER_MINUTES=0xf,EXIT_GRACE_PERIOD_SECONDS=0x1e;function a5_0x5286(){const _0xa3e79c=['.ACTUAL_TEMPERATURE','4477496FWkZXa','temperature','28kqaOfr','exitTimer','level','678GWjSKD','lastTrackerEventTime','weatherunderground','search','weatherInstance','STATUS','push','toString','log','message','occupancy','rawEventLog','.NextHours.Location_1.Day_1.current.temp_value','val','präsenz','length','includes','dimmer','exitGraceTimer','.Current.Temperature','Unknown','bewegung','location','switch','sendToPythonWrapper','licht','motion','type','valveMapping','klima','LTM.trainingData.sequences','isPresent','isGracePeriodActive','splice','openweathermap','kontakt','currentSystemMode','fenster','from','lock','replace','now','2734251qxXgrI','number','config','.1.TEMPERATURE','toLowerCase','string','eventHistory','.LEVEL','contact','apply','light','round','toISOString','events.history','map','.1.VALVE_STATE','2leXPSo','system.isPresent','some','1590012UCpNlb','lampe','6541544TLltCU','loc','handle','events.lastEvent','5431535qBzKOw','tür','setStateAsync','isProVersion','LEVEL','value','isExit','.forecast.current.temp','getStateAsync','daswetter','.1.ACTUAL_TEMPERATURE','STATE','griff','LTM.rawEventLog','outdoorSensorId','logDuplicates','LTM.trainingData.thermodynamics','door','error','stringify','.4.VALVE_STATE','schalter','presence','.forecast.current.temperature','(((.+)+)+)+$','parse','getForeignStateAsync','[RECORDER]\x20Error:\x20','2872647baTpEM','shift','sensorLastValues'];a5_0x5286=function(){return _0xa3e79c;};return a5_0x5286();}let activeSequence=[],sequenceTimer=null;async function getOutsideTemperatureNumeric(_0x2e2cb7){const _0x3db155=a5_0x2def;if(_0x2e2cb7[_0x3db155(0x110)][_0x3db155(0x135)])try{const _0x186add=await _0x2e2cb7['getForeignStateAsync'](_0x2e2cb7['config']['outdoorSensorId']);if(_0x186add&&_0x186add[_0x3db155(0x159)]!==undefined&&_0x186add[_0x3db155(0x159)]!==null)return parseFloat(_0x186add[_0x3db155(0x159)]);}catch(_0x4e2de3){}const _0x1ab01a=_0x2e2cb7[_0x3db155(0x110)][_0x3db155(0x150)];if(!_0x2e2cb7[_0x3db155(0x110)]['useWeather']||!_0x1ab01a)return null;try{let _0x56fc99='';if(_0x1ab01a[_0x3db155(0x15c)]('accuweather'))_0x56fc99=_0x1ab01a+_0x3db155(0x15f);else{if(_0x1ab01a['includes'](_0x3db155(0x130)))_0x56fc99=_0x1ab01a+_0x3db155(0x158);else{if(_0x1ab01a[_0x3db155(0x15c)](_0x3db155(0x16e)))_0x56fc99=_0x1ab01a+_0x3db155(0x13e);else{if(_0x1ab01a[_0x3db155(0x15c)](_0x3db155(0x14e)))_0x56fc99=_0x1ab01a+_0x3db155(0x12e);}}}if(_0x56fc99){const _0x378719=await _0x2e2cb7[_0x3db155(0x141)](_0x56fc99);if(_0x378719&&_0x378719[_0x3db155(0x159)]!==undefined&&_0x378719[_0x3db155(0x159)]!==null)return parseFloat(_0x378719[_0x3db155(0x159)]);}}catch(_0x38a95b){}return null;}async function recordThermodynamics(_0x591e08,_0x1e6069,_0x295c45,_0x1002e7){const _0x560e1d=a5_0x2def,_0x329216=await getOutsideTemperatureNumeric(_0x591e08);if(_0x329216===null)return;let _0x1addf1=0x0,_0x21c9cc=![];if(_0x591e08[_0x560e1d(0x110)][_0x560e1d(0x168)])try{let _0x27a790=_0x591e08['config']['valveMapping'];if(typeof _0x27a790===_0x560e1d(0x113))_0x27a790=JSON['parse'](_0x27a790);if(_0x27a790[_0x1e6069]){const _0x112c7f=_0x27a790[_0x1e6069],_0x487ca8=await _0x591e08[_0x560e1d(0x141)](_0x112c7f);if(_0x487ca8&&_0x487ca8['val']!==null&&_0x487ca8[_0x560e1d(0x159)]!==undefined){let _0x258adc=Number(_0x487ca8[_0x560e1d(0x159)]);if(_0x258adc<=1.05&&!_0x112c7f[_0x560e1d(0x15c)](_0x560e1d(0x151))&&!_0x112c7f[_0x560e1d(0x15c)](_0x560e1d(0x132)))_0x258adc=_0x258adc*0x64;_0x1addf1=Math[_0x560e1d(0x119)](_0x258adc),_0x21c9cc=!![];}}}catch(_0x226375){}if(!_0x21c9cc){const _0xd050fb=[{'from':_0x560e1d(0x131),'to':'.1.LEVEL'},{'from':_0x560e1d(0x131),'to':_0x560e1d(0x11d)},{'from':_0x560e1d(0x111),'to':_0x560e1d(0x13b)},{'from':_0x560e1d(0x146),'to':_0x560e1d(0x115)},{'from':_0x560e1d(0x148),'to':_0x560e1d(0x14b)},{'from':'Temperature','to':'Valve'}];for(const _0x27779e of _0xd050fb){if(_0x1e6069[_0x560e1d(0x15c)](_0x27779e[_0x560e1d(0x172)])){const _0x3ea097=_0x1e6069[_0x560e1d(0x174)](_0x27779e['from'],_0x27779e['to']);try{const _0x1c762c=await _0x591e08[_0x560e1d(0x141)](_0x3ea097);if(_0x1c762c&&_0x1c762c['val']!==null&&_0x1c762c['val']!==undefined){let _0x487760=Number(_0x1c762c[_0x560e1d(0x159)]);if(typeof _0x487760===_0x560e1d(0x10f)){if(_0x487760<=1.05&&_0x27779e['to'][_0x560e1d(0x15c)](_0x560e1d(0x12b)))_0x487760=_0x487760*0x64;_0x1addf1=Math[_0x560e1d(0x119)](_0x487760),_0x21c9cc=!![];break;}}}catch(_0x3e2655){}}}}const _0x140598=await _0x591e08['getStateAsync'](_0x560e1d(0x137));let _0x38c37e=[];if(_0x140598&&_0x140598[_0x560e1d(0x159)])try{_0x38c37e=JSON[_0x560e1d(0x140)](_0x140598[_0x560e1d(0x159)]);}catch(_0x264de7){}_0x38c37e['push']({'ts':Date[_0x560e1d(0x175)](),'room':_0x1002e7||'Unknown','t_in':_0x295c45,'t_out':_0x329216,'valve':_0x1addf1});if(_0x38c37e['length']>THERMO_LOG_SIZE)_0x38c37e['shift']();await _0x591e08[_0x560e1d(0x129)](_0x560e1d(0x137),{'val':JSON[_0x560e1d(0x13a)](_0x38c37e),'ack':!![]});}async function saveCompletedSequence(_0x16f201){const _0x37453f=a5_0x2def;try{const _0x132b90=await _0x16f201[_0x37453f(0x12f)](_0x37453f(0x16a));let _0x53941a=[];if(_0x132b90&&_0x132b90[_0x37453f(0x159)])try{_0x53941a=JSON[_0x37453f(0x140)](_0x132b90[_0x37453f(0x159)]);}catch(_0xe7e6af){}const _0x47b6ad=activeSequence[0x0]['ts'],_0x1fc2df=activeSequence[_0x37453f(0x11c)](_0x303855=>({'loc':_0x303855[_0x37453f(0x124)],'t_delta':Math[_0x37453f(0x119)]((_0x303855['ts']-_0x47b6ad)/0x3e8)})),_0x252a34={'timestamp':new Date(_0x47b6ad)[_0x37453f(0x11a)](),'steps':_0x1fc2df,'duration':Math['round']((activeSequence[activeSequence[_0x37453f(0x15b)]-0x1]['ts']-_0x47b6ad)/0x3e8),'daytime':new Date(_0x47b6ad)['getHours']()};_0x53941a[_0x37453f(0x152)](_0x252a34);if(_0x53941a[_0x37453f(0x15b)]>MAX_TRAINING_SET_SIZE)_0x53941a[_0x37453f(0x144)]();await _0x16f201[_0x37453f(0x129)](_0x37453f(0x16a),{'val':JSON[_0x37453f(0x13a)](_0x53941a),'ack':!![]}),_0x16f201['isProVersion']&&_0x16f201[_0x37453f(0x164)]&&_0x16f201['sendToPythonWrapper']('ANALYZE_SEQUENCE',{'sequence':_0x252a34});}catch(_0x5cbbf6){_0x16f201[_0x37453f(0x154)][_0x37453f(0x139)](_0x37453f(0x142)+_0x5cbbf6[_0x37453f(0x155)]);}}async function recordSequence(_0x5cf514,_0x28af6e){const _0x22206d=a5_0x2def,_0x4e1437=(_0x28af6e[_0x22206d(0x167)]||'')[_0x22206d(0x112)](),_0x13c113=[_0x22206d(0x166),_0x22206d(0x161),_0x22206d(0x15a),_0x22206d(0x13d),_0x22206d(0x156),_0x22206d(0x138),'tür','window',_0x22206d(0x171),_0x22206d(0x116),_0x22206d(0x16f),_0x22206d(0x118),_0x22206d(0x165),_0x22206d(0x163),_0x22206d(0x13c),_0x22206d(0x15d),_0x22206d(0x122)];if(!_0x13c113[_0x22206d(0x120)](_0x7c1754=>_0x4e1437[_0x22206d(0x15c)](_0x7c1754)))return;if(!_0x28af6e[_0x22206d(0x12c)])return;if(sequenceTimer)clearTimeout(sequenceTimer);activeSequence[_0x22206d(0x152)]({'loc':_0x28af6e[_0x22206d(0x162)]||_0x22206d(0x160),'id':_0x28af6e['id'],'ts':Date[_0x22206d(0x175)]()}),sequenceTimer=setTimeout(async()=>{const _0x1e30b7=_0x22206d;if(activeSequence[_0x1e30b7(0x15b)]>0x1)await saveCompletedSequence(_0x5cf514);activeSequence=[];},SEQUENCE_TIMEOUT_MS);}function a5_0x2def(_0xb4ef9e,_0x148d2c){const _0x1dd9c7=a5_0x5286();return a5_0x2def=function(_0x319d2d,_0x51cb9c){_0x319d2d=_0x319d2d-0x10f;let _0x52869a=_0x1dd9c7[_0x319d2d];return _0x52869a;},a5_0x2def(_0xb4ef9e,_0x148d2c);}function startExitTimer(_0x235314){const _0x45e1c8=a5_0x2def;abortExitTimer(_0x235314),_0x235314[_0x45e1c8(0x16c)]=!![],_0x235314[_0x45e1c8(0x15e)]=setTimeout(()=>{const _0x3af3f4=_0x45e1c8;_0x235314[_0x3af3f4(0x16c)]=![];},EXIT_GRACE_PERIOD_SECONDS*0x3e8),_0x235314[_0x45e1c8(0x14a)]=setTimeout(()=>{const _0x337709=_0x45e1c8;setPresence(_0x235314,![]),_0x235314[_0x337709(0x14a)]=null;},EXIT_TIMER_MINUTES*0x3c*0x3e8);}function abortExitTimer(_0x247ce7){const _0x5dfb62=a5_0x2def;if(_0x247ce7[_0x5dfb62(0x14a)])clearTimeout(_0x247ce7[_0x5dfb62(0x14a)]);if(_0x247ce7[_0x5dfb62(0x15e)])clearTimeout(_0x247ce7['exitGraceTimer']);_0x247ce7[_0x5dfb62(0x14a)]=null,_0x247ce7['exitGraceTimer']=null,_0x247ce7[_0x5dfb62(0x16c)]=![];}async function setPresence(_0x41c54d,_0x33f9e3){const _0xbc7505=a5_0x2def;if(_0x41c54d[_0xbc7505(0x16b)]===_0x33f9e3)return;_0x41c54d[_0xbc7505(0x16b)]=_0x33f9e3,await _0x41c54d[_0xbc7505(0x129)](_0xbc7505(0x11f),{'val':_0x33f9e3,'ack':!![]});}async function processSensorEvent(_0x261652,_0x19dcd2,_0x4ac8c3,_0xb062ff){const _0x2c4907=a5_0x2def;if(!_0xb062ff)return null;const _0x38b6bb=_0x4ac8c3[_0x2c4907(0x159)],_0xa258b6=Date['now'](),_0x25dd32=_0x261652[_0x2c4907(0x145)][_0x19dcd2];_0x261652[_0x2c4907(0x145)][_0x19dcd2]=_0x38b6bb;if(!_0xb062ff[_0x2c4907(0x136)]&&_0x25dd32!=undefined&&_0x25dd32==_0x38b6bb)return null;const _0x5b7720=(_0xb062ff['type']||'')[_0x2c4907(0x112)](),_0x5d832c=_0x5b7720[_0x2c4907(0x15c)](_0x2c4907(0x148))||_0x5b7720['includes']('temperatur')||_0x5b7720['includes'](_0x2c4907(0x169))||_0x5b7720[_0x2c4907(0x15c)]('heizung')||_0x5b7720[_0x2c4907(0x15c)]('thermostat');_0x261652[_0x2c4907(0x12a)]&&_0x5d832c&&recordThermodynamics(_0x261652,_0x19dcd2,_0x38b6bb,_0xb062ff['location']);const _0x500778={'timestamp':_0xa258b6,'id':_0x19dcd2,'name':_0xb062ff['name'],'type':_0xb062ff[_0x2c4907(0x167)],'location':_0xb062ff[_0x2c4907(0x162)],'value':_0x38b6bb};_0x261652[_0x2c4907(0x114)]['unshift'](_0x500778);if(_0x261652[_0x2c4907(0x114)][_0x2c4907(0x15b)]>HISTORY_MAX_SIZE)_0x261652[_0x2c4907(0x114)]['pop']();await _0x261652['setStateAsync'](_0x2c4907(0x126),{'val':JSON[_0x2c4907(0x13a)](_0x500778),'ack':!![]}),await _0x261652[_0x2c4907(0x129)](_0x2c4907(0x11b),{'val':JSON[_0x2c4907(0x13a)](_0x261652[_0x2c4907(0x114)]),'ack':!![]});if(_0x261652[_0x2c4907(0x12a)]){_0x261652[_0x2c4907(0x157)]['push'](_0x500778);if(_0x261652[_0x2c4907(0x157)][_0x2c4907(0x15b)]>RAW_LOG_MAX_SIZE)_0x261652[_0x2c4907(0x157)][_0x2c4907(0x16d)](0x0,_0x261652[_0x2c4907(0x157)][_0x2c4907(0x15b)]-RAW_LOG_MAX_SIZE);await _0x261652[_0x2c4907(0x129)](_0x2c4907(0x134),{'val':JSON[_0x2c4907(0x13a)](_0x261652['rawEventLog']),'ack':!![]}),recordSequence(_0x261652,_0x500778);}if(_0xb062ff[_0x2c4907(0x12d)]&&_0x38b6bb===!![]){if(_0x261652['isPresent']&&!_0x261652['isGracePeriodActive'])startExitTimer(_0x261652);else{if(!_0x261652[_0x2c4907(0x16b)])setPresence(_0x261652,!![]);}}else{if(_0xb062ff['type']===_0x2c4907(0x166)&&_0x38b6bb===!![]){if(_0x261652[_0x2c4907(0x14a)])abortExitTimer(_0x261652);if(!_0x261652[_0x2c4907(0x16b)]&&_0x261652[_0x2c4907(0x170)]==='normal')setPresence(_0x261652,!![]);}}if(_0x261652[_0x2c4907(0x12a)]&&_0x261652[_0x2c4907(0x164)]){_0xb062ff[_0x2c4907(0x167)]==='motion'&&_0x38b6bb===!![]&&_0xb062ff[_0x2c4907(0x162)]&&_0x261652['sendToPythonWrapper']('SIMULATE_SIGNAL',{'room':_0xb062ff[_0x2c4907(0x162)]});const _0x2c5d8e=['door',_0x2c4907(0x128),'window',_0x2c4907(0x171),_0x2c4907(0x133),_0x2c4907(0x125),_0x2c4907(0x173),'schloss'][_0x2c4907(0x120)](_0x4d4e54=>_0x5b7720[_0x2c4907(0x15c)](_0x4d4e54)),_0x13a1ef=[_0x2c4907(0x118),_0x2c4907(0x165),_0x2c4907(0x163),_0x2c4907(0x13c),'dimmer','lampe']['some'](_0x3ba3cf=>_0x5b7720[_0x2c4907(0x15c)](_0x3ba3cf)),_0x3b6fc1=[_0x2c4907(0x166),_0x2c4907(0x161),_0x2c4907(0x15a),'presence','occupancy'][_0x2c4907(0x120)](_0x4832fc=>_0x5b7720[_0x2c4907(0x15c)](_0x4832fc));if(_0xb062ff['location']&&(_0x2c5d8e||_0x13a1ef||_0x3b6fc1)){const _0x5bb4ea=_0x38b6bb===!![]||typeof _0x38b6bb===_0x2c4907(0x10f)&&_0x38b6bb>0x0,_0x15164b=_0x2c5d8e&&!_0x5bb4ea&&_0x25dd32!==undefined&&_0x25dd32!=_0x38b6bb;if(_0x5bb4ea||_0x15164b){const _0x162cf5=_0x261652[_0x2c4907(0x14d)]||_0xa258b6,_0x3b4864=(_0xa258b6-_0x162cf5)/0x3e8;_0x261652[_0x2c4907(0x14d)]=_0xa258b6,_0x261652[_0x2c4907(0x164)]('TRACK_EVENT',{'room':_0xb062ff['location'],'dt':_0x3b4864});}}}return _0x500778;}module['exports']={'processSensorEvent':processSensorEvent,'getOutsideTemperatureNumeric':getOutsideTemperatureNumeric,'setPresence':setPresence,'abortExitTimer':abortExitTimer,'startExitTimer':startExitTimer};