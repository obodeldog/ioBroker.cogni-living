(function(_0xc442c3,_0x49d71d){const _0x33fb60=a5_0x5e7c,_0x3d9882=_0xc442c3();while(!![]){try{const _0x328575=-parseInt(_0x33fb60(0x147))/0x1*(parseInt(_0x33fb60(0x131))/0x2)+parseInt(_0x33fb60(0x172))/0x3+parseInt(_0x33fb60(0x173))/0x4+-parseInt(_0x33fb60(0x16c))/0x5+-parseInt(_0x33fb60(0x135))/0x6+parseInt(_0x33fb60(0x13d))/0x7*(-parseInt(_0x33fb60(0x128))/0x8)+parseInt(_0x33fb60(0x150))/0x9;if(_0x328575===_0x49d71d)break;else _0x3d9882['push'](_0x3d9882['shift']());}catch(_0x4b163b){_0x3d9882['push'](_0x3d9882['shift']());}}}(a5_0x5e40,0x9bcfa));const a5_0x5e6817=(function(){let _0x313283=!![];return function(_0x213a2b,_0x405511){const _0x4eab92=_0x313283?function(){if(_0x405511){const _0x55d48f=_0x405511['apply'](_0x213a2b,arguments);return _0x405511=null,_0x55d48f;}}:function(){};return _0x313283=![],_0x4eab92;};}()),a5_0x767c05=a5_0x5e6817(this,function(){const _0xa32325=a5_0x5e7c;return a5_0x767c05['toString']()['search']('(((.+)+)+)+$')[_0xa32325(0x188)]()[_0xa32325(0x155)](a5_0x767c05)['search'](_0xa32325(0x174));});a5_0x767c05();'use strict';const HISTORY_MAX_SIZE=0x32,RAW_LOG_MAX_SIZE=0x9c4,THERMO_LOG_SIZE=0x3e8,SEQUENCE_TIMEOUT_MS=0x5*0x3c*0x3e8,MAX_TRAINING_SET_SIZE=0x1f4,EXIT_TIMER_MINUTES=0xf,EXIT_GRACE_PERIOD_SECONDS=0x1e;let activeSequence=[],sequenceTimer=null;async function getOutsideTemperatureNumeric(_0xf3f5a6){const _0x305c44=a5_0x5e7c;if(_0xf3f5a6['config']['outdoorSensorId'])try{const _0x243a4f=await _0xf3f5a6[_0x305c44(0x126)](_0xf3f5a6[_0x305c44(0x13a)]['outdoorSensorId']);if(_0x243a4f&&_0x243a4f[_0x305c44(0x143)]!==undefined&&_0x243a4f[_0x305c44(0x143)]!==null)return parseFloat(_0x243a4f[_0x305c44(0x143)]);}catch(_0xaa421b){}const _0x828f2c=_0xf3f5a6[_0x305c44(0x13a)]['weatherInstance'];if(!_0xf3f5a6[_0x305c44(0x13a)]['useWeather']||!_0x828f2c)return null;try{let _0x392cf3='';if(_0x828f2c['includes'](_0x305c44(0x17a)))_0x392cf3=_0x828f2c+'.Current.Temperature';else{if(_0x828f2c[_0x305c44(0x140)](_0x305c44(0x153)))_0x392cf3=_0x828f2c+_0x305c44(0x186);else{if(_0x828f2c[_0x305c44(0x140)](_0x305c44(0x149)))_0x392cf3=_0x828f2c+_0x305c44(0x170);else{if(_0x828f2c[_0x305c44(0x140)](_0x305c44(0x18d)))_0x392cf3=_0x828f2c+_0x305c44(0x14e);}}}if(_0x392cf3){const _0x4785f8=await _0xf3f5a6[_0x305c44(0x126)](_0x392cf3);if(_0x4785f8&&_0x4785f8['val']!==undefined&&_0x4785f8[_0x305c44(0x143)]!==null)return parseFloat(_0x4785f8[_0x305c44(0x143)]);}}catch(_0x1b0e18){}return null;}async function recordThermodynamics(_0x40fd11,_0x3695c9,_0x16cbad,_0xaad98b){const _0x1fcfd4=a5_0x5e7c,_0x4ef60b=await getOutsideTemperatureNumeric(_0x40fd11);if(_0x4ef60b===null)return;let _0x10d849=0x0,_0x250a8d=![];if(_0x40fd11[_0x1fcfd4(0x13a)][_0x1fcfd4(0x139)])try{let _0x46c6b0=_0x40fd11['config'][_0x1fcfd4(0x139)];if(typeof _0x46c6b0==='string')_0x46c6b0=JSON[_0x1fcfd4(0x16d)](_0x46c6b0);if(_0x46c6b0[_0x3695c9]){const _0x504a80=_0x46c6b0[_0x3695c9],_0x1df386=await _0x40fd11['getForeignStateAsync'](_0x504a80);if(_0x1df386&&_0x1df386['val']!==null&&_0x1df386[_0x1fcfd4(0x143)]!==undefined){let _0x2f1010=Number(_0x1df386[_0x1fcfd4(0x143)]);if(_0x2f1010<=1.05&&!_0x504a80[_0x1fcfd4(0x140)](_0x1fcfd4(0x141))&&!_0x504a80[_0x1fcfd4(0x140)]('STATE'))_0x2f1010=_0x2f1010*0x64;_0x10d849=Math['round'](_0x2f1010),_0x250a8d=!![];}}}catch(_0x1dbc85){}if(!_0x250a8d){const _0x32907a=[{'from':_0x1fcfd4(0x187),'to':'.1.LEVEL'},{'from':_0x1fcfd4(0x187),'to':_0x1fcfd4(0x157)},{'from':_0x1fcfd4(0x13f),'to':_0x1fcfd4(0x179)},{'from':_0x1fcfd4(0x14c),'to':'.LEVEL'},{'from':_0x1fcfd4(0x15d),'to':_0x1fcfd4(0x175)},{'from':_0x1fcfd4(0x15b),'to':_0x1fcfd4(0x183)}];for(const _0xc87d5c of _0x32907a){if(_0x3695c9['includes'](_0xc87d5c[_0x1fcfd4(0x169)])){const _0x70e2fc=_0x3695c9[_0x1fcfd4(0x159)](_0xc87d5c[_0x1fcfd4(0x169)],_0xc87d5c['to']);try{const _0x531fd3=await _0x40fd11[_0x1fcfd4(0x126)](_0x70e2fc);if(_0x531fd3&&_0x531fd3[_0x1fcfd4(0x143)]!==null&&_0x531fd3[_0x1fcfd4(0x143)]!==undefined){let _0x2d5f1f=Number(_0x531fd3[_0x1fcfd4(0x143)]);if(typeof _0x2d5f1f===_0x1fcfd4(0x17f)){if(_0x2d5f1f<=1.05&&_0xc87d5c['to']['includes'](_0x1fcfd4(0x166)))_0x2d5f1f=_0x2d5f1f*0x64;_0x10d849=Math['round'](_0x2d5f1f),_0x250a8d=!![];break;}}}catch(_0x59e0a8){}}}}const _0x1a6ee7=await _0x40fd11['getStateAsync'](_0x1fcfd4(0x142));let _0x595d6d=[];if(_0x1a6ee7&&_0x1a6ee7[_0x1fcfd4(0x143)])try{_0x595d6d=JSON[_0x1fcfd4(0x16d)](_0x1a6ee7[_0x1fcfd4(0x143)]);}catch(_0x5ed57c){}_0x595d6d[_0x1fcfd4(0x17e)]({'ts':Date[_0x1fcfd4(0x154)](),'room':_0xaad98b||_0x1fcfd4(0x17d),'t_in':_0x16cbad,'t_out':_0x4ef60b,'valve':_0x10d849});if(_0x595d6d[_0x1fcfd4(0x165)]>THERMO_LOG_SIZE)_0x595d6d[_0x1fcfd4(0x132)]();await _0x40fd11[_0x1fcfd4(0x17c)]('LTM.trainingData.thermodynamics',{'val':JSON[_0x1fcfd4(0x158)](_0x595d6d),'ack':!![]});}function a5_0x5e7c(_0x23c57c,_0xbbe52c){const _0x32b94d=a5_0x5e40();return a5_0x5e7c=function(_0x767c05,_0x5e6817){_0x767c05=_0x767c05-0x125;let _0x5e4086=_0x32b94d[_0x767c05];return _0x5e4086;},a5_0x5e7c(_0x23c57c,_0xbbe52c);}async function saveCompletedSequence(_0x559e93){const _0x49f685=a5_0x5e7c;try{const _0x5bb552=await _0x559e93[_0x49f685(0x129)](_0x49f685(0x162));let _0xd995d2=[];if(_0x5bb552&&_0x5bb552[_0x49f685(0x143)])try{_0xd995d2=JSON[_0x49f685(0x16d)](_0x5bb552[_0x49f685(0x143)]);}catch(_0x46daa5){}const _0x28432c=activeSequence[0x0]['ts'],_0x4986fd=activeSequence[_0x49f685(0x144)](_0x3daeef=>({'loc':_0x3daeef[_0x49f685(0x130)],'t_delta':Math[_0x49f685(0x180)]((_0x3daeef['ts']-_0x28432c)/0x3e8)})),_0x9dd51c={'timestamp':new Date(_0x28432c)[_0x49f685(0x164)](),'steps':_0x4986fd,'duration':Math[_0x49f685(0x180)]((activeSequence[activeSequence['length']-0x1]['ts']-_0x28432c)/0x3e8),'daytime':new Date(_0x28432c)['getHours']()};_0xd995d2[_0x49f685(0x17e)](_0x9dd51c);if(_0xd995d2[_0x49f685(0x165)]>MAX_TRAINING_SET_SIZE)_0xd995d2[_0x49f685(0x132)]();await _0x559e93['setStateAsync']('LTM.trainingData.sequences',{'val':JSON['stringify'](_0xd995d2),'ack':!![]}),_0x559e93['isProVersion']&&_0x559e93[_0x49f685(0x18c)]&&_0x559e93[_0x49f685(0x18c)](_0x49f685(0x134),{'sequence':_0x9dd51c});}catch(_0x1b3bc0){_0x559e93['log']['error'](_0x49f685(0x13e)+_0x1b3bc0[_0x49f685(0x16f)]);}}async function recordSequence(_0x1c1a75,_0x54dbd1){const _0x652043=a5_0x5e7c,_0x4db1c6=(_0x54dbd1[_0x652043(0x18b)]||'')['toLowerCase'](),_0x21afad=[_0x652043(0x12f),_0x652043(0x168),_0x652043(0x18e),'presence',_0x652043(0x12e),_0x652043(0x138),'tür',_0x652043(0x181),'fenster','contact',_0x652043(0x184),_0x652043(0x146),_0x652043(0x14d),_0x652043(0x148),_0x652043(0x13c),_0x652043(0x15c),_0x652043(0x16a)];if(!_0x21afad[_0x652043(0x185)](_0x43c160=>_0x4db1c6[_0x652043(0x140)](_0x43c160)))return;if(!_0x54dbd1[_0x652043(0x16e)])return;if(sequenceTimer)clearTimeout(sequenceTimer);activeSequence[_0x652043(0x17e)]({'loc':_0x54dbd1[_0x652043(0x176)]||_0x652043(0x17d),'id':_0x54dbd1['id'],'ts':Date[_0x652043(0x154)]()}),sequenceTimer=setTimeout(async()=>{const _0x99f92a=_0x652043;if(activeSequence[_0x99f92a(0x165)]>0x1)await saveCompletedSequence(_0x1c1a75);activeSequence=[];},SEQUENCE_TIMEOUT_MS);}function a5_0x5e40(){const _0x1a3400=['length','LEVEL','thermostat','bewegung','from','lampe','isPresent','3638090kfXYig','parse','value','message','.forecast.current.temperature','getDate','530337YAszJB','3088180jtsigJ','(((.+)+)+)+$','level','location','name','schloss','.4.VALVE_STATE','accuweather','eventHistory','setStateAsync','Unknown','push','number','round','window','temperatur','Valve','kontakt','some','.NextHours.Location_1.Day_1.current.temp_value','.1.ACTUAL_TEMPERATURE','toString','\x20from\x20','heizung','type','sendToPythonWrapper','weatherunderground','präsenz','events.history','exitTimer','getHours','analysis.health.todayVector','getForeignStateAsync','sensorLastValues','496552StDJmq','getStateAsync','fill','normal','exitGraceTimer','griff','occupancy','motion','loc','10tbbePS','shift','SIMULATE_SIGNAL','ANALYZE_SEQUENCE','4768056tOyVbm','system.isPresent','[RECORDER]\x20Ignored\x20implausible\x20temperature:\x20','door','valveMapping','config','fenster','schalter','49sxILid','[RECORDER]\x20Error:\x20','.1.TEMPERATURE','includes','STATUS','LTM.trainingData.thermodynamics','val','map','handle','light','36496ythvjg','switch','openweathermap','events.lastEvent','currentSystemMode','.ACTUAL_TEMPERATURE','licht','.forecast.current.temp','isProVersion','16457715TDEwFC','klima','toLowerCase','daswetter','now','constructor','rawEventLog','.1.VALVE_STATE','stringify','replace','lock','Temperature','dimmer','temperature','isGracePeriodActive','pop','presence','lastTrackerEventTime','LTM.trainingData.sequences','isExit','toISOString'];a5_0x5e40=function(){return _0x1a3400;};return a5_0x5e40();}function startExitTimer(_0x538f37){const _0x45ff5a=a5_0x5e7c;abortExitTimer(_0x538f37),_0x538f37[_0x45ff5a(0x15e)]=!![],_0x538f37['exitGraceTimer']=setTimeout(()=>{_0x538f37['isGracePeriodActive']=![];},EXIT_GRACE_PERIOD_SECONDS*0x3e8),_0x538f37[_0x45ff5a(0x190)]=setTimeout(()=>{const _0x192798=_0x45ff5a;setPresence(_0x538f37,![]),_0x538f37[_0x192798(0x190)]=null;},EXIT_TIMER_MINUTES*0x3c*0x3e8);}function abortExitTimer(_0x41e4d0){const _0x2974a1=a5_0x5e7c;if(_0x41e4d0[_0x2974a1(0x190)])clearTimeout(_0x41e4d0[_0x2974a1(0x190)]);if(_0x41e4d0[_0x2974a1(0x12c)])clearTimeout(_0x41e4d0[_0x2974a1(0x12c)]);_0x41e4d0[_0x2974a1(0x190)]=null,_0x41e4d0[_0x2974a1(0x12c)]=null,_0x41e4d0[_0x2974a1(0x15e)]=![];}async function setPresence(_0x4b3480,_0xdd063){const _0x223d6e=a5_0x5e7c;if(_0x4b3480['isPresent']===_0xdd063)return;_0x4b3480['isPresent']=_0xdd063,await _0x4b3480[_0x223d6e(0x17c)](_0x223d6e(0x136),{'val':_0xdd063,'ack':!![]});}async function updateHourlyActivity(_0x27d5f2){const _0x13d92d=a5_0x5e7c;let _0x49cfc9=new Array(0x18)[_0x13d92d(0x12a)](0x0),_0x2188e8=0x0;try{const _0x8f2326=await _0x27d5f2['getStateAsync'](_0x13d92d(0x125));_0x8f2326&&_0x8f2326[_0x13d92d(0x143)]&&(_0x49cfc9=JSON[_0x13d92d(0x16d)](_0x8f2326[_0x13d92d(0x143)]),_0x2188e8=_0x8f2326['ts']);}catch(_0x450bed){}const _0x411768=new Date(_0x2188e8),_0x2d4af1=new Date();_0x411768[_0x13d92d(0x171)]()!==_0x2d4af1['getDate']()&&(_0x49cfc9=new Array(0x18)[_0x13d92d(0x12a)](0x0));const _0x3c3221=_0x2d4af1[_0x13d92d(0x191)]();if(_0x49cfc9[_0x3c3221]===undefined)_0x49cfc9[_0x3c3221]=0x0;_0x49cfc9[_0x3c3221]++,await _0x27d5f2[_0x13d92d(0x17c)]('analysis.health.todayVector',{'val':JSON['stringify'](_0x49cfc9),'ack':!![]});}async function processSensorEvent(_0x4525e9,_0x273ce1,_0x19c7ea,_0x57cab2){const _0x1314d0=a5_0x5e7c;if(!_0x57cab2)return null;const _0x3fc3ee=_0x19c7ea[_0x1314d0(0x143)],_0x1e6669=Date[_0x1314d0(0x154)](),_0x366f99=_0x4525e9[_0x1314d0(0x127)][_0x273ce1],_0x815367=(_0x57cab2[_0x1314d0(0x18b)]||'')[_0x1314d0(0x152)](),_0x28fcd2=_0x815367[_0x1314d0(0x140)]('temperature')||_0x815367['includes'](_0x1314d0(0x182))||_0x815367['includes'](_0x1314d0(0x151))||_0x815367[_0x1314d0(0x140)](_0x1314d0(0x18a))||_0x815367[_0x1314d0(0x140)](_0x1314d0(0x167));if(_0x28fcd2&&typeof _0x3fc3ee===_0x1314d0(0x17f)){if(_0x3fc3ee>0x50||_0x3fc3ee<-0x32)return _0x4525e9['log']['debug'](_0x1314d0(0x137)+_0x3fc3ee+_0x1314d0(0x189)+_0x273ce1),null;}_0x4525e9[_0x1314d0(0x127)][_0x273ce1]=_0x3fc3ee;if(!_0x57cab2['logDuplicates']&&_0x366f99!=undefined&&_0x366f99==_0x3fc3ee)return null;_0x4525e9[_0x1314d0(0x14f)]&&_0x28fcd2&&recordThermodynamics(_0x4525e9,_0x273ce1,_0x3fc3ee,_0x57cab2['location']);const _0x5272ea={'timestamp':_0x1e6669,'id':_0x273ce1,'name':_0x57cab2[_0x1314d0(0x177)],'type':_0x57cab2[_0x1314d0(0x18b)],'location':_0x57cab2[_0x1314d0(0x176)],'value':_0x3fc3ee};_0x4525e9['eventHistory']['unshift'](_0x5272ea);if(_0x4525e9[_0x1314d0(0x17b)][_0x1314d0(0x165)]>HISTORY_MAX_SIZE)_0x4525e9[_0x1314d0(0x17b)][_0x1314d0(0x15f)]();await _0x4525e9[_0x1314d0(0x17c)](_0x1314d0(0x14a),{'val':JSON[_0x1314d0(0x158)](_0x5272ea),'ack':!![]}),await _0x4525e9[_0x1314d0(0x17c)](_0x1314d0(0x18f),{'val':JSON[_0x1314d0(0x158)](_0x4525e9[_0x1314d0(0x17b)]),'ack':!![]}),await updateHourlyActivity(_0x4525e9);if(_0x4525e9[_0x1314d0(0x14f)]){_0x4525e9[_0x1314d0(0x156)][_0x1314d0(0x17e)](_0x5272ea);if(_0x4525e9[_0x1314d0(0x156)][_0x1314d0(0x165)]>RAW_LOG_MAX_SIZE)_0x4525e9[_0x1314d0(0x156)]['splice'](0x0,_0x4525e9[_0x1314d0(0x156)][_0x1314d0(0x165)]-RAW_LOG_MAX_SIZE);await _0x4525e9['setStateAsync']('LTM.rawEventLog',{'val':JSON['stringify'](_0x4525e9[_0x1314d0(0x156)]),'ack':!![]}),recordSequence(_0x4525e9,_0x5272ea);}if(_0x57cab2[_0x1314d0(0x163)]&&_0x3fc3ee===!![]){if(_0x4525e9[_0x1314d0(0x16b)]&&!_0x4525e9[_0x1314d0(0x15e)])startExitTimer(_0x4525e9);else{if(!_0x4525e9[_0x1314d0(0x16b)])setPresence(_0x4525e9,!![]);}}else{if(_0x57cab2[_0x1314d0(0x18b)]==='motion'&&_0x3fc3ee===!![]){if(_0x4525e9[_0x1314d0(0x190)])abortExitTimer(_0x4525e9);if(!_0x4525e9[_0x1314d0(0x16b)]&&_0x4525e9[_0x1314d0(0x14b)]===_0x1314d0(0x12b))setPresence(_0x4525e9,!![]);}}if(_0x4525e9[_0x1314d0(0x14f)]&&_0x4525e9[_0x1314d0(0x18c)]){_0x57cab2[_0x1314d0(0x18b)]===_0x1314d0(0x12f)&&_0x3fc3ee===!![]&&_0x57cab2[_0x1314d0(0x176)]&&_0x4525e9[_0x1314d0(0x18c)](_0x1314d0(0x133),{'room':_0x57cab2[_0x1314d0(0x176)]});const _0x2a3653=[_0x1314d0(0x138),'tür',_0x1314d0(0x181),_0x1314d0(0x13b),_0x1314d0(0x12d),_0x1314d0(0x145),_0x1314d0(0x15a),_0x1314d0(0x178)][_0x1314d0(0x185)](_0x590d96=>_0x815367[_0x1314d0(0x140)](_0x590d96)),_0x3ea4b0=['light',_0x1314d0(0x14d),_0x1314d0(0x148),_0x1314d0(0x13c),'dimmer',_0x1314d0(0x16a)]['some'](_0x443816=>_0x815367[_0x1314d0(0x140)](_0x443816)),_0x477647=['motion',_0x1314d0(0x168),_0x1314d0(0x18e),_0x1314d0(0x160),'occupancy'][_0x1314d0(0x185)](_0x3d4e76=>_0x815367[_0x1314d0(0x140)](_0x3d4e76));if(_0x57cab2[_0x1314d0(0x176)]&&(_0x2a3653||_0x3ea4b0||_0x477647)){const _0x412ade=_0x3fc3ee===!![]||typeof _0x3fc3ee===_0x1314d0(0x17f)&&_0x3fc3ee>0x0,_0x34104b=_0x2a3653&&!_0x412ade&&_0x366f99!==undefined&&_0x366f99!=_0x3fc3ee;if(_0x412ade||_0x34104b){const _0x1273cd=_0x4525e9['lastTrackerEventTime']||_0x1e6669,_0x4ecefd=(_0x1e6669-_0x1273cd)/0x3e8;_0x4525e9[_0x1314d0(0x161)]=_0x1e6669,_0x4525e9[_0x1314d0(0x18c)]('TRACK_EVENT',{'room':_0x57cab2[_0x1314d0(0x176)],'dt':_0x4ecefd});}}}return _0x5272ea;}module['exports']={'processSensorEvent':processSensorEvent,'getOutsideTemperatureNumeric':getOutsideTemperatureNumeric,'setPresence':setPresence,'abortExitTimer':abortExitTimer,'startExitTimer':startExitTimer};