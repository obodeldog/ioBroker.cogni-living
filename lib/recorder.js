const a5_0xc5728f=a5_0x2cbf;(function(_0x7a0266,_0x3041c3){const _0xee7e5a=a5_0x2cbf,_0x3dbbc7=_0x7a0266();while(!![]){try{const _0x4e8529=parseInt(_0xee7e5a(0x112))/0x1*(parseInt(_0xee7e5a(0x124))/0x2)+-parseInt(_0xee7e5a(0x11b))/0x3*(parseInt(_0xee7e5a(0x113))/0x4)+parseInt(_0xee7e5a(0x10f))/0x5+parseInt(_0xee7e5a(0x129))/0x6*(parseInt(_0xee7e5a(0x12c))/0x7)+-parseInt(_0xee7e5a(0x14c))/0x8*(-parseInt(_0xee7e5a(0x142))/0x9)+parseInt(_0xee7e5a(0x128))/0xa+-parseInt(_0xee7e5a(0x11c))/0xb;if(_0x4e8529===_0x3041c3)break;else _0x3dbbc7['push'](_0x3dbbc7['shift']());}catch(_0x287b87){_0x3dbbc7['push'](_0x3dbbc7['shift']());}}}(a5_0x2d23,0x2bccd));const a5_0x28bb6f=(function(){let _0x167630=!![];return function(_0x9fcdfa,_0x4bbb23){const _0x36fc21=_0x167630?function(){if(_0x4bbb23){const _0xed4a16=_0x4bbb23['apply'](_0x9fcdfa,arguments);return _0x4bbb23=null,_0xed4a16;}}:function(){};return _0x167630=![],_0x36fc21;};}()),a5_0x2c9c2d=a5_0x28bb6f(this,function(){const _0x16df8d=a5_0x2cbf;return a5_0x2c9c2d['toString']()[_0x16df8d(0x103)]('(((.+)+)+)+$')['toString']()['constructor'](a5_0x2c9c2d)[_0x16df8d(0x103)]('(((.+)+)+)+$');});function a5_0x2cbf(_0x4353d1,_0x17b28a){const _0x35eb40=a5_0x2d23();return a5_0x2cbf=function(_0x2c9c2d,_0x28bb6f){_0x2c9c2d=_0x2c9c2d-0xf9;let _0x2d232c=_0x35eb40[_0x2c9c2d];return _0x2d232c;},a5_0x2cbf(_0x4353d1,_0x17b28a);}a5_0x2c9c2d();'use strict';const HISTORY_MAX_SIZE=0x32,RAW_LOG_MAX_SIZE=0x9c4,THERMO_LOG_SIZE=0x3e8,SEQUENCE_TIMEOUT_MS=0x5*0x3c*0x3e8,MAX_TRAINING_SET_SIZE=0x1f4,EXIT_TIMER_MINUTES=0xf,EXIT_GRACE_PERIOD_SECONDS=0x1e;let activeSequence=[],sequenceTimer=null;async function getOutsideTemperatureNumeric(_0x48af4f){const _0x191432=a5_0x2cbf;if(_0x48af4f[_0x191432(0x108)][_0x191432(0x144)])try{const _0x4ce22a=await _0x48af4f[_0x191432(0x111)](_0x48af4f[_0x191432(0x108)][_0x191432(0x144)]);if(_0x4ce22a&&_0x4ce22a[_0x191432(0x13c)]!==undefined&&_0x4ce22a['val']!==null)return parseFloat(_0x4ce22a[_0x191432(0x13c)]);}catch(_0x400bcf){}const _0x13886b=_0x48af4f[_0x191432(0x108)][_0x191432(0x131)];if(!_0x48af4f[_0x191432(0x108)][_0x191432(0x10d)]||!_0x13886b)return null;try{let _0x21b546='';if(_0x13886b[_0x191432(0x12a)]('accuweather'))_0x21b546=_0x13886b+'.Current.Temperature';else{if(_0x13886b[_0x191432(0x12a)](_0x191432(0x107)))_0x21b546=_0x13886b+'.NextHours.Location_1.Day_1.current.temp_value';else{if(_0x13886b[_0x191432(0x12a)](_0x191432(0x14b)))_0x21b546=_0x13886b+'.forecast.current.temperature';else{if(_0x13886b[_0x191432(0x12a)]('weatherunderground'))_0x21b546=_0x13886b+_0x191432(0x149);}}}if(_0x21b546){const _0x4f5fbf=await _0x48af4f['getForeignStateAsync'](_0x21b546);if(_0x4f5fbf&&_0x4f5fbf[_0x191432(0x13c)]!==undefined&&_0x4f5fbf[_0x191432(0x13c)]!==null)return parseFloat(_0x4f5fbf[_0x191432(0x13c)]);}}catch(_0x1de47c){}return null;}async function recordThermodynamics(_0x55852a,_0x2d9bfc,_0x53a273,_0x33d13e){const _0x329a6e=a5_0x2cbf,_0x11f08e=await getOutsideTemperatureNumeric(_0x55852a);if(_0x11f08e===null)return;let _0x337c65=0x0,_0x5ba12b=![];if(_0x55852a['config'][_0x329a6e(0xfc)])try{let _0x327090=_0x55852a[_0x329a6e(0x108)][_0x329a6e(0xfc)];if(typeof _0x327090===_0x329a6e(0x146))_0x327090=JSON[_0x329a6e(0x10a)](_0x327090);if(_0x327090[_0x2d9bfc]){const _0xfaef2b=_0x327090[_0x2d9bfc],_0x30647a=await _0x55852a['getForeignStateAsync'](_0xfaef2b);if(_0x30647a&&_0x30647a[_0x329a6e(0x13c)]!==null&&_0x30647a[_0x329a6e(0x13c)]!==undefined){let _0x185edc=Number(_0x30647a[_0x329a6e(0x13c)]);if(_0x185edc<=1.05&&!_0xfaef2b[_0x329a6e(0x12a)](_0x329a6e(0x114))&&!_0xfaef2b[_0x329a6e(0x12a)](_0x329a6e(0x134)))_0x185edc=_0x185edc*0x64;_0x337c65=Math[_0x329a6e(0x14e)](_0x185edc),_0x5ba12b=!![];}}}catch(_0x3cb51b){}if(!_0x5ba12b){const _0x2fca85=[{'from':_0x329a6e(0x13b),'to':_0x329a6e(0x132)},{'from':_0x329a6e(0x13b),'to':'.1.VALVE_STATE'},{'from':_0x329a6e(0x160),'to':_0x329a6e(0x104)},{'from':_0x329a6e(0x164),'to':_0x329a6e(0x12f)},{'from':_0x329a6e(0x159),'to':_0x329a6e(0x105)},{'from':_0x329a6e(0x148),'to':'Valve'}];for(const _0x253536 of _0x2fca85){if(_0x2d9bfc['includes'](_0x253536[_0x329a6e(0x100)])){const _0x2dec77=_0x2d9bfc[_0x329a6e(0x11a)](_0x253536[_0x329a6e(0x100)],_0x253536['to']);try{const _0x178501=await _0x55852a[_0x329a6e(0x111)](_0x2dec77);if(_0x178501&&_0x178501['val']!==null&&_0x178501['val']!==undefined){let _0x4a38f4=Number(_0x178501[_0x329a6e(0x13c)]);if(typeof _0x4a38f4==='number'){if(_0x4a38f4<=1.05&&_0x253536['to'][_0x329a6e(0x12a)](_0x329a6e(0xfd)))_0x4a38f4=_0x4a38f4*0x64;_0x337c65=Math[_0x329a6e(0x14e)](_0x4a38f4),_0x5ba12b=!![];break;}}}catch(_0x1453e4){}}}}const _0x139bdc=await _0x55852a[_0x329a6e(0x123)](_0x329a6e(0x101));let _0x5ecea9=[];if(_0x139bdc&&_0x139bdc['val'])try{_0x5ecea9=JSON[_0x329a6e(0x10a)](_0x139bdc[_0x329a6e(0x13c)]);}catch(_0x2e5155){}_0x5ecea9[_0x329a6e(0x106)]({'ts':Date[_0x329a6e(0x11f)](),'room':_0x33d13e||_0x329a6e(0x118),'t_in':_0x53a273,'t_out':_0x11f08e,'valve':_0x337c65});if(_0x5ecea9[_0x329a6e(0x14d)]>THERMO_LOG_SIZE)_0x5ecea9[_0x329a6e(0x161)]();await _0x55852a[_0x329a6e(0x116)](_0x329a6e(0x101),{'val':JSON[_0x329a6e(0x15c)](_0x5ecea9),'ack':!![]});}async function saveCompletedSequence(_0x411988){const _0x2cac6a=a5_0x2cbf;try{const _0x5baa43=await _0x411988['getStateAsync'](_0x2cac6a(0x12e));let _0x5eef15=[];if(_0x5baa43&&_0x5baa43[_0x2cac6a(0x13c)])try{_0x5eef15=JSON[_0x2cac6a(0x10a)](_0x5baa43[_0x2cac6a(0x13c)]);}catch(_0x306b66){}const _0x12e6bc=activeSequence[0x0]['ts'],_0x1a7a54=activeSequence[_0x2cac6a(0xfe)](_0x4f2890=>({'loc':_0x4f2890[_0x2cac6a(0x10c)],'t_delta':Math[_0x2cac6a(0x14e)]((_0x4f2890['ts']-_0x12e6bc)/0x3e8)})),_0x4d5515={'timestamp':new Date(_0x12e6bc)['toISOString'](),'steps':_0x1a7a54,'duration':Math['round']((activeSequence[activeSequence[_0x2cac6a(0x14d)]-0x1]['ts']-_0x12e6bc)/0x3e8),'daytime':new Date(_0x12e6bc)[_0x2cac6a(0x12b)]()};_0x5eef15[_0x2cac6a(0x106)](_0x4d5515);if(_0x5eef15[_0x2cac6a(0x14d)]>MAX_TRAINING_SET_SIZE)_0x5eef15['shift']();await _0x411988[_0x2cac6a(0x116)]('LTM.trainingData.sequences',{'val':JSON[_0x2cac6a(0x15c)](_0x5eef15),'ack':!![]}),_0x411988[_0x2cac6a(0x115)]&&_0x411988[_0x2cac6a(0x117)]&&_0x411988['sendToPythonWrapper'](_0x2cac6a(0x151),{'sequence':_0x4d5515});}catch(_0xa21e87){_0x411988['log'][_0x2cac6a(0x15e)](_0x2cac6a(0x110)+_0xa21e87[_0x2cac6a(0x152)]);}}async function recordSequence(_0xbfe538,_0x16626a){const _0x59e760=a5_0x2cbf,_0x8e0595=(_0x16626a[_0x59e760(0x130)]||'')[_0x59e760(0x136)](),_0x19e2e5=[_0x59e760(0x154),_0x59e760(0x150),_0x59e760(0x143),_0x59e760(0x15a),'occupancy','door','tür',_0x59e760(0x15b),'fenster',_0x59e760(0x14f),_0x59e760(0x119),'light',_0x59e760(0x140),_0x59e760(0x138),'schalter',_0x59e760(0x156),_0x59e760(0x127)];if(!_0x19e2e5[_0x59e760(0x12d)](_0x2d6f9e=>_0x8e0595['includes'](_0x2d6f9e)))return;if(!_0x16626a[_0x59e760(0x11e)])return;if(sequenceTimer)clearTimeout(sequenceTimer);activeSequence['push']({'loc':_0x16626a['location']||_0x59e760(0x118),'id':_0x16626a['id'],'ts':Date[_0x59e760(0x11f)]()}),sequenceTimer=setTimeout(async()=>{const _0xa9affa=_0x59e760;if(activeSequence[_0xa9affa(0x14d)]>0x1)await saveCompletedSequence(_0xbfe538);activeSequence=[];},SEQUENCE_TIMEOUT_MS);}function startExitTimer(_0x649c6d){const _0x130c22=a5_0x2cbf;abortExitTimer(_0x649c6d),_0x649c6d[_0x130c22(0x125)]=!![],_0x649c6d[_0x130c22(0x135)]=setTimeout(()=>{const _0x34dfb7=_0x130c22;_0x649c6d[_0x34dfb7(0x125)]=![];},EXIT_GRACE_PERIOD_SECONDS*0x3e8),_0x649c6d['exitTimer']=setTimeout(()=>{const _0x2444ff=_0x130c22;setPresence(_0x649c6d,![]),_0x649c6d[_0x2444ff(0xff)]=null;},EXIT_TIMER_MINUTES*0x3c*0x3e8);}function abortExitTimer(_0x4545b8){const _0x275d6d=a5_0x2cbf;if(_0x4545b8[_0x275d6d(0xff)])clearTimeout(_0x4545b8[_0x275d6d(0xff)]);if(_0x4545b8[_0x275d6d(0x135)])clearTimeout(_0x4545b8['exitGraceTimer']);_0x4545b8[_0x275d6d(0xff)]=null,_0x4545b8['exitGraceTimer']=null,_0x4545b8[_0x275d6d(0x125)]=![];}async function setPresence(_0x22570d,_0x4b668a){const _0x5681f1=a5_0x2cbf;if(_0x22570d['isPresent']===_0x4b668a)return;_0x22570d[_0x5681f1(0x14a)]=_0x4b668a,await _0x22570d[_0x5681f1(0x116)]('system.isPresent',{'val':_0x4b668a,'ack':!![]});}function a5_0x2d23(){const _0x3f5473=['openweathermap','8lAvJAk','length','round','contact','bewegung','ANALYZE_SEQUENCE','message','occupancy','motion','eventHistory','dimmer','pop','splice','temperature','presence','window','stringify','lastTrackerEventTime','error','logDuplicates','.1.TEMPERATURE','shift','door','currentSystemMode','.ACTUAL_TEMPERATURE','events.lastEvent','schalter','schloss','valveMapping','LEVEL','map','exitTimer','from','LTM.trainingData.thermodynamics','heizung','search','.4.VALVE_STATE','level','push','daswetter','config','location','parse','tür','loc','useWeather','name','1321330gkaYxd','[RECORDER]\x20Error:\x20','getForeignStateAsync','10056QPgZDz','939468BJGDfp','STATUS','isProVersion','setStateAsync','sendToPythonWrapper','Unknown','kontakt','replace','3bjCePt','7475963cegNeG','log','value','now','LTM.rawEventLog','klima','lock','getStateAsync','24PmaMas','isGracePeriodActive','SIMULATE_SIGNAL','lampe','2755860keQfaW','93120sTJeMu','includes','getHours','140gkFdtJ','some','LTM.trainingData.sequences','.LEVEL','type','weatherInstance','.1.LEVEL','handle','STATE','exitGraceTimer','toLowerCase','normal','switch','rawEventLog','[RECORDER]\x20Ignored\x20implausible\x20temperature:\x20','.1.ACTUAL_TEMPERATURE','val','fenster','\x20from\x20','number','licht','exports','1106829JFzOAE','präsenz','outdoorSensorId','thermostat','string','sensorLastValues','Temperature','.forecast.current.temp','isPresent'];a5_0x2d23=function(){return _0x3f5473;};return a5_0x2d23();}async function processSensorEvent(_0x5c4d0d,_0x460374,_0x40c273,_0x169f58){const _0x951c8c=a5_0x2cbf;if(!_0x169f58)return null;const _0x353229=_0x40c273[_0x951c8c(0x13c)],_0x4dd82e=Date[_0x951c8c(0x11f)](),_0x3a56b3=_0x5c4d0d[_0x951c8c(0x147)][_0x460374],_0x57f63e=(_0x169f58[_0x951c8c(0x130)]||'')[_0x951c8c(0x136)](),_0x844531=_0x57f63e[_0x951c8c(0x12a)](_0x951c8c(0x159))||_0x57f63e[_0x951c8c(0x12a)]('temperatur')||_0x57f63e[_0x951c8c(0x12a)](_0x951c8c(0x121))||_0x57f63e[_0x951c8c(0x12a)](_0x951c8c(0x102))||_0x57f63e[_0x951c8c(0x12a)](_0x951c8c(0x145));if(_0x844531&&typeof _0x353229===_0x951c8c(0x13f)){if(_0x353229>0x50||_0x353229<-0x32)return _0x5c4d0d[_0x951c8c(0x11d)]['debug'](_0x951c8c(0x13a)+_0x353229+_0x951c8c(0x13e)+_0x460374),null;}_0x5c4d0d[_0x951c8c(0x147)][_0x460374]=_0x353229;if(!_0x169f58[_0x951c8c(0x15f)]&&_0x3a56b3!=undefined&&_0x3a56b3==_0x353229)return null;_0x5c4d0d['isProVersion']&&_0x844531&&recordThermodynamics(_0x5c4d0d,_0x460374,_0x353229,_0x169f58[_0x951c8c(0x109)]);const _0x447ef4={'timestamp':_0x4dd82e,'id':_0x460374,'name':_0x169f58[_0x951c8c(0x10e)],'type':_0x169f58[_0x951c8c(0x130)],'location':_0x169f58[_0x951c8c(0x109)],'value':_0x353229};_0x5c4d0d[_0x951c8c(0x155)]['unshift'](_0x447ef4);if(_0x5c4d0d[_0x951c8c(0x155)]['length']>HISTORY_MAX_SIZE)_0x5c4d0d[_0x951c8c(0x155)][_0x951c8c(0x157)]();await _0x5c4d0d[_0x951c8c(0x116)](_0x951c8c(0xf9),{'val':JSON[_0x951c8c(0x15c)](_0x447ef4),'ack':!![]}),await _0x5c4d0d[_0x951c8c(0x116)]('events.history',{'val':JSON[_0x951c8c(0x15c)](_0x5c4d0d[_0x951c8c(0x155)]),'ack':!![]});if(_0x5c4d0d[_0x951c8c(0x115)]){_0x5c4d0d['rawEventLog'][_0x951c8c(0x106)](_0x447ef4);if(_0x5c4d0d['rawEventLog']['length']>RAW_LOG_MAX_SIZE)_0x5c4d0d[_0x951c8c(0x139)][_0x951c8c(0x158)](0x0,_0x5c4d0d[_0x951c8c(0x139)]['length']-RAW_LOG_MAX_SIZE);await _0x5c4d0d['setStateAsync'](_0x951c8c(0x120),{'val':JSON[_0x951c8c(0x15c)](_0x5c4d0d['rawEventLog']),'ack':!![]}),recordSequence(_0x5c4d0d,_0x447ef4);}if(_0x169f58['isExit']&&_0x353229===!![]){if(_0x5c4d0d[_0x951c8c(0x14a)]&&!_0x5c4d0d[_0x951c8c(0x125)])startExitTimer(_0x5c4d0d);else{if(!_0x5c4d0d[_0x951c8c(0x14a)])setPresence(_0x5c4d0d,!![]);}}else{if(_0x169f58[_0x951c8c(0x130)]===_0x951c8c(0x154)&&_0x353229===!![]){if(_0x5c4d0d[_0x951c8c(0xff)])abortExitTimer(_0x5c4d0d);if(!_0x5c4d0d[_0x951c8c(0x14a)]&&_0x5c4d0d[_0x951c8c(0x163)]===_0x951c8c(0x137))setPresence(_0x5c4d0d,!![]);}}if(_0x5c4d0d['isProVersion']&&_0x5c4d0d[_0x951c8c(0x117)]){_0x169f58[_0x951c8c(0x130)]==='motion'&&_0x353229===!![]&&_0x169f58[_0x951c8c(0x109)]&&_0x5c4d0d[_0x951c8c(0x117)](_0x951c8c(0x126),{'room':_0x169f58[_0x951c8c(0x109)]});const _0x2a70c0=[_0x951c8c(0x162),_0x951c8c(0x10b),_0x951c8c(0x15b),_0x951c8c(0x13d),'griff',_0x951c8c(0x133),_0x951c8c(0x122),_0x951c8c(0xfb)][_0x951c8c(0x12d)](_0x10e863=>_0x57f63e[_0x951c8c(0x12a)](_0x10e863)),_0x3faf2a=['light','licht',_0x951c8c(0x138),_0x951c8c(0xfa),_0x951c8c(0x156),_0x951c8c(0x127)]['some'](_0x263859=>_0x57f63e[_0x951c8c(0x12a)](_0x263859)),_0x232622=[_0x951c8c(0x154),'bewegung',_0x951c8c(0x143),_0x951c8c(0x15a),_0x951c8c(0x153)][_0x951c8c(0x12d)](_0x330126=>_0x57f63e[_0x951c8c(0x12a)](_0x330126));if(_0x169f58['location']&&(_0x2a70c0||_0x3faf2a||_0x232622)){const _0x4fd5fa=_0x353229===!![]||typeof _0x353229===_0x951c8c(0x13f)&&_0x353229>0x0,_0x1f9ff0=_0x2a70c0&&!_0x4fd5fa&&_0x3a56b3!==undefined&&_0x3a56b3!=_0x353229;if(_0x4fd5fa||_0x1f9ff0){const _0x4865c8=_0x5c4d0d[_0x951c8c(0x15d)]||_0x4dd82e,_0x123005=(_0x4dd82e-_0x4865c8)/0x3e8;_0x5c4d0d[_0x951c8c(0x15d)]=_0x4dd82e,_0x5c4d0d[_0x951c8c(0x117)]('TRACK_EVENT',{'room':_0x169f58[_0x951c8c(0x109)],'dt':_0x123005});}}}return _0x447ef4;}module[a5_0xc5728f(0x141)]={'processSensorEvent':processSensorEvent,'getOutsideTemperatureNumeric':getOutsideTemperatureNumeric,'setPresence':setPresence,'abortExitTimer':abortExitTimer,'startExitTimer':startExitTimer};