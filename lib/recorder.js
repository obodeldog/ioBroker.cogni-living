const a5_0x2a2cb5=a5_0x4141;function a5_0x36f2(){const _0x3e7e0b=['isProVersion','presence','motion','Unknown','round','map','outdoorSensorId','light','events.lastEvent','unshift','occupancy','string','search','.Current.Temperature','lampe','rawEventLog','[RECORDER]\x20Ignored\x20implausible\x20temperature:\x20','388840AYASTp','808019fGtakN','7rMrkEs','[RECORDER]\x20Error:\x20','currentSystemMode','splice','LTM.trainingData.sequences','shift','LEVEL','.forecast.current.temperature','.ACTUAL_TEMPERATURE','accuweather','exports','parse','getForeignStateAsync','14526684EFuUlT','toISOString','fenster','bewegung','switch','debug','now','from','openweathermap','type','number','events.history','.1.VALVE_STATE','stringify','lastTrackerEventTime','8vGIONv','temperatur','some','eventHistory','val','name','sendToPythonWrapper','sensorLastValues','.NextHours.Location_1.Day_1.current.temp_value','length','tür','includes','1445640VHhjEW','987762azGFUA','log','licht','exitTimer','toLowerCase','lock','exitGraceTimer','isExit','setStateAsync','10tOfVrR','Temperature','schalter','Valve','kontakt','4496022adNkwP','level','window','STATE','720030RamiND','dimmer','message','isPresent','push','value','LTM.trainingData.thermodynamics','getStateAsync','.forecast.current.temp','location','thermostat','pop','toString','door','.1.ACTUAL_TEMPERATURE','.1.LEVEL','apply','STATUS','ANALYZE_SEQUENCE','heizung','LTM.rawEventLog','temperature','valveMapping','.1.TEMPERATURE','config','griff','normal','präsenz','isGracePeriodActive'];a5_0x36f2=function(){return _0x3e7e0b;};return a5_0x36f2();}(function(_0x44fb35,_0x10e090){const _0x39c09e=a5_0x4141,_0x503d97=_0x44fb35();while(!![]){try{const _0x29954f=parseInt(_0x39c09e(0x180))/0x1+-parseInt(_0x39c09e(0x13e))/0x2+-parseInt(_0x39c09e(0x13f))/0x3*(parseInt(_0x39c09e(0x132))/0x4)+parseInt(_0x39c09e(0x151))/0x5+-parseInt(_0x39c09e(0x14d))/0x6*(parseInt(_0x39c09e(0x181))/0x7)+parseInt(_0x39c09e(0x17f))/0x8+parseInt(_0x39c09e(0x123))/0x9*(parseInt(_0x39c09e(0x148))/0xa);if(_0x29954f===_0x10e090)break;else _0x503d97['push'](_0x503d97['shift']());}catch(_0x49e9be){_0x503d97['push'](_0x503d97['shift']());}}}(a5_0x36f2,0x762c9));const a5_0x2cfc0=(function(){let _0x1803a3=!![];return function(_0x5d9d06,_0xc8f62e){const _0x566563=_0x1803a3?function(){const _0x2da661=a5_0x4141;if(_0xc8f62e){const _0x8904b4=_0xc8f62e[_0x2da661(0x161)](_0x5d9d06,arguments);return _0xc8f62e=null,_0x8904b4;}}:function(){};return _0x1803a3=![],_0x566563;};}()),a5_0x4b9b34=a5_0x2cfc0(this,function(){const _0x17d749=a5_0x4141;return a5_0x4b9b34[_0x17d749(0x15d)]()['search']('(((.+)+)+)+$')[_0x17d749(0x15d)]()['constructor'](a5_0x4b9b34)[_0x17d749(0x17a)]('(((.+)+)+)+$');});a5_0x4b9b34();'use strict';function a5_0x4141(_0x495f0e,_0x15538a){const _0x24f13f=a5_0x36f2();return a5_0x4141=function(_0x4b9b34,_0x2cfc0){_0x4b9b34=_0x4b9b34-0x11d;let _0x36f2ad=_0x24f13f[_0x4b9b34];return _0x36f2ad;},a5_0x4141(_0x495f0e,_0x15538a);}const HISTORY_MAX_SIZE=0x32,RAW_LOG_MAX_SIZE=0x9c4,THERMO_LOG_SIZE=0x3e8,SEQUENCE_TIMEOUT_MS=0x5*0x3c*0x3e8,MAX_TRAINING_SET_SIZE=0x1f4,EXIT_TIMER_MINUTES=0xf,EXIT_GRACE_PERIOD_SECONDS=0x1e;let activeSequence=[],sequenceTimer=null;async function getOutsideTemperatureNumeric(_0xe32180){const _0x19c712=a5_0x4141;if(_0xe32180[_0x19c712(0x169)][_0x19c712(0x174)])try{const _0x1a5759=await _0xe32180[_0x19c712(0x122)](_0xe32180[_0x19c712(0x169)][_0x19c712(0x174)]);if(_0x1a5759&&_0x1a5759[_0x19c712(0x136)]!==undefined&&_0x1a5759[_0x19c712(0x136)]!==null)return parseFloat(_0x1a5759['val']);}catch(_0x3459af){}const _0x23b3c1=_0xe32180['config']['weatherInstance'];if(!_0xe32180['config']['useWeather']||!_0x23b3c1)return null;try{let _0x139888='';if(_0x23b3c1[_0x19c712(0x13d)](_0x19c712(0x11f)))_0x139888=_0x23b3c1+_0x19c712(0x17b);else{if(_0x23b3c1[_0x19c712(0x13d)]('daswetter'))_0x139888=_0x23b3c1+_0x19c712(0x13a);else{if(_0x23b3c1['includes'](_0x19c712(0x12b)))_0x139888=_0x23b3c1+_0x19c712(0x11d);else{if(_0x23b3c1[_0x19c712(0x13d)]('weatherunderground'))_0x139888=_0x23b3c1+_0x19c712(0x159);}}}if(_0x139888){const _0x30d337=await _0xe32180[_0x19c712(0x122)](_0x139888);if(_0x30d337&&_0x30d337['val']!==undefined&&_0x30d337[_0x19c712(0x136)]!==null)return parseFloat(_0x30d337[_0x19c712(0x136)]);}}catch(_0x1f2201){}return null;}async function recordThermodynamics(_0x3451ba,_0x512777,_0x3afa1a,_0x2c9853){const _0x2e6d2e=a5_0x4141,_0x3efcca=await getOutsideTemperatureNumeric(_0x3451ba);if(_0x3efcca===null)return;let _0x585591=0x0,_0x455ba4=![];if(_0x3451ba[_0x2e6d2e(0x169)][_0x2e6d2e(0x167)])try{let _0x13136b=_0x3451ba[_0x2e6d2e(0x169)]['valveMapping'];if(typeof _0x13136b===_0x2e6d2e(0x179))_0x13136b=JSON[_0x2e6d2e(0x121)](_0x13136b);if(_0x13136b[_0x512777]){const _0x317c67=_0x13136b[_0x512777],_0x33cc71=await _0x3451ba[_0x2e6d2e(0x122)](_0x317c67);if(_0x33cc71&&_0x33cc71['val']!==null&&_0x33cc71[_0x2e6d2e(0x136)]!==undefined){let _0x2b7ece=Number(_0x33cc71[_0x2e6d2e(0x136)]);if(_0x2b7ece<=1.05&&!_0x317c67['includes'](_0x2e6d2e(0x162))&&!_0x317c67[_0x2e6d2e(0x13d)](_0x2e6d2e(0x150)))_0x2b7ece=_0x2b7ece*0x64;_0x585591=Math[_0x2e6d2e(0x172)](_0x2b7ece),_0x455ba4=!![];}}}catch(_0x4058b0){}if(!_0x455ba4){const _0x90c683=[{'from':_0x2e6d2e(0x15f),'to':_0x2e6d2e(0x160)},{'from':'.1.ACTUAL_TEMPERATURE','to':_0x2e6d2e(0x12f)},{'from':_0x2e6d2e(0x168),'to':'.4.VALVE_STATE'},{'from':_0x2e6d2e(0x11e),'to':'.LEVEL'},{'from':_0x2e6d2e(0x166),'to':_0x2e6d2e(0x14e)},{'from':_0x2e6d2e(0x149),'to':_0x2e6d2e(0x14b)}];for(const _0x5384eb of _0x90c683){if(_0x512777['includes'](_0x5384eb[_0x2e6d2e(0x12a)])){const _0x58ab06=_0x512777['replace'](_0x5384eb[_0x2e6d2e(0x12a)],_0x5384eb['to']);try{const _0x1e2807=await _0x3451ba[_0x2e6d2e(0x122)](_0x58ab06);if(_0x1e2807&&_0x1e2807['val']!==null&&_0x1e2807[_0x2e6d2e(0x136)]!==undefined){let _0x3b8864=Number(_0x1e2807[_0x2e6d2e(0x136)]);if(typeof _0x3b8864===_0x2e6d2e(0x12d)){if(_0x3b8864<=1.05&&_0x5384eb['to'][_0x2e6d2e(0x13d)](_0x2e6d2e(0x187)))_0x3b8864=_0x3b8864*0x64;_0x585591=Math['round'](_0x3b8864),_0x455ba4=!![];break;}}}catch(_0x1223ca){}}}}const _0x5d6e19=await _0x3451ba[_0x2e6d2e(0x158)](_0x2e6d2e(0x157));let _0x797db9=[];if(_0x5d6e19&&_0x5d6e19[_0x2e6d2e(0x136)])try{_0x797db9=JSON[_0x2e6d2e(0x121)](_0x5d6e19['val']);}catch(_0xd1a820){}_0x797db9[_0x2e6d2e(0x155)]({'ts':Date[_0x2e6d2e(0x129)](),'room':_0x2c9853||_0x2e6d2e(0x171),'t_in':_0x3afa1a,'t_out':_0x3efcca,'valve':_0x585591});if(_0x797db9['length']>THERMO_LOG_SIZE)_0x797db9['shift']();await _0x3451ba[_0x2e6d2e(0x147)](_0x2e6d2e(0x157),{'val':JSON[_0x2e6d2e(0x130)](_0x797db9),'ack':!![]});}async function saveCompletedSequence(_0x5a93b4){const _0x11c2c5=a5_0x4141;try{const _0x5b29f2=await _0x5a93b4[_0x11c2c5(0x158)](_0x11c2c5(0x185));let _0x2907ef=[];if(_0x5b29f2&&_0x5b29f2['val'])try{_0x2907ef=JSON['parse'](_0x5b29f2[_0x11c2c5(0x136)]);}catch(_0x18a23e){}const _0xd4a55b=activeSequence[0x0]['ts'],_0x2de2ec=activeSequence[_0x11c2c5(0x173)](_0x2e3e7d=>({'loc':_0x2e3e7d['loc'],'t_delta':Math[_0x11c2c5(0x172)]((_0x2e3e7d['ts']-_0xd4a55b)/0x3e8)})),_0x1473ee={'timestamp':new Date(_0xd4a55b)[_0x11c2c5(0x124)](),'steps':_0x2de2ec,'duration':Math[_0x11c2c5(0x172)]((activeSequence[activeSequence[_0x11c2c5(0x13b)]-0x1]['ts']-_0xd4a55b)/0x3e8),'daytime':new Date(_0xd4a55b)['getHours']()};_0x2907ef[_0x11c2c5(0x155)](_0x1473ee);if(_0x2907ef[_0x11c2c5(0x13b)]>MAX_TRAINING_SET_SIZE)_0x2907ef[_0x11c2c5(0x186)]();await _0x5a93b4[_0x11c2c5(0x147)](_0x11c2c5(0x185),{'val':JSON[_0x11c2c5(0x130)](_0x2907ef),'ack':!![]}),_0x5a93b4[_0x11c2c5(0x16e)]&&_0x5a93b4[_0x11c2c5(0x138)]&&_0x5a93b4[_0x11c2c5(0x138)](_0x11c2c5(0x163),{'sequence':_0x1473ee});}catch(_0x5e817f){_0x5a93b4[_0x11c2c5(0x140)]['error'](_0x11c2c5(0x182)+_0x5e817f[_0x11c2c5(0x153)]);}}async function recordSequence(_0x152deb,_0x2499b7){const _0x1e6c2c=a5_0x4141,_0x5be829=(_0x2499b7['type']||'')[_0x1e6c2c(0x143)](),_0x58074c=[_0x1e6c2c(0x170),_0x1e6c2c(0x126),_0x1e6c2c(0x16c),'presence',_0x1e6c2c(0x178),_0x1e6c2c(0x15e),_0x1e6c2c(0x13c),_0x1e6c2c(0x14f),_0x1e6c2c(0x125),'contact',_0x1e6c2c(0x14c),_0x1e6c2c(0x175),_0x1e6c2c(0x141),_0x1e6c2c(0x127),_0x1e6c2c(0x14a),_0x1e6c2c(0x152),_0x1e6c2c(0x17c)];if(!_0x58074c[_0x1e6c2c(0x134)](_0x582f4e=>_0x5be829[_0x1e6c2c(0x13d)](_0x582f4e)))return;if(!_0x2499b7[_0x1e6c2c(0x156)])return;if(sequenceTimer)clearTimeout(sequenceTimer);activeSequence[_0x1e6c2c(0x155)]({'loc':_0x2499b7[_0x1e6c2c(0x15a)]||_0x1e6c2c(0x171),'id':_0x2499b7['id'],'ts':Date[_0x1e6c2c(0x129)]()}),sequenceTimer=setTimeout(async()=>{const _0x3600fd=_0x1e6c2c;if(activeSequence[_0x3600fd(0x13b)]>0x1)await saveCompletedSequence(_0x152deb);activeSequence=[];},SEQUENCE_TIMEOUT_MS);}function startExitTimer(_0x4092f7){const _0x423294=a5_0x4141;abortExitTimer(_0x4092f7),_0x4092f7[_0x423294(0x16d)]=!![],_0x4092f7[_0x423294(0x145)]=setTimeout(()=>{const _0x2e4588=_0x423294;_0x4092f7[_0x2e4588(0x16d)]=![];},EXIT_GRACE_PERIOD_SECONDS*0x3e8),_0x4092f7[_0x423294(0x142)]=setTimeout(()=>{const _0x26104d=_0x423294;setPresence(_0x4092f7,![]),_0x4092f7[_0x26104d(0x142)]=null;},EXIT_TIMER_MINUTES*0x3c*0x3e8);}function abortExitTimer(_0x4b292f){const _0x4cf949=a5_0x4141;if(_0x4b292f[_0x4cf949(0x142)])clearTimeout(_0x4b292f[_0x4cf949(0x142)]);if(_0x4b292f[_0x4cf949(0x145)])clearTimeout(_0x4b292f[_0x4cf949(0x145)]);_0x4b292f[_0x4cf949(0x142)]=null,_0x4b292f[_0x4cf949(0x145)]=null,_0x4b292f[_0x4cf949(0x16d)]=![];}async function setPresence(_0x1d62a9,_0x29cbea){const _0x18814d=a5_0x4141;if(_0x1d62a9[_0x18814d(0x154)]===_0x29cbea)return;_0x1d62a9[_0x18814d(0x154)]=_0x29cbea,await _0x1d62a9[_0x18814d(0x147)]('system.isPresent',{'val':_0x29cbea,'ack':!![]});}async function processSensorEvent(_0x557bbc,_0x1fcec4,_0x4f5633,_0xf5e0c4){const _0x3eeba2=a5_0x4141;if(!_0xf5e0c4)return null;const _0x4c6c0c=_0x4f5633[_0x3eeba2(0x136)],_0x25ee3b=Date['now'](),_0x39ecd9=_0x557bbc[_0x3eeba2(0x139)][_0x1fcec4],_0x100265=(_0xf5e0c4[_0x3eeba2(0x12c)]||'')[_0x3eeba2(0x143)](),_0x28ee7a=_0x100265[_0x3eeba2(0x13d)](_0x3eeba2(0x166))||_0x100265[_0x3eeba2(0x13d)](_0x3eeba2(0x133))||_0x100265[_0x3eeba2(0x13d)]('klima')||_0x100265[_0x3eeba2(0x13d)](_0x3eeba2(0x164))||_0x100265['includes'](_0x3eeba2(0x15b));if(_0x28ee7a&&typeof _0x4c6c0c==='number'){if(_0x4c6c0c>0x50||_0x4c6c0c<-0x32)return _0x557bbc[_0x3eeba2(0x140)][_0x3eeba2(0x128)](_0x3eeba2(0x17e)+_0x4c6c0c+'\x20from\x20'+_0x1fcec4),null;}_0x557bbc['sensorLastValues'][_0x1fcec4]=_0x4c6c0c;if(!_0xf5e0c4['logDuplicates']&&_0x39ecd9!=undefined&&_0x39ecd9==_0x4c6c0c)return null;_0x557bbc[_0x3eeba2(0x16e)]&&_0x28ee7a&&recordThermodynamics(_0x557bbc,_0x1fcec4,_0x4c6c0c,_0xf5e0c4[_0x3eeba2(0x15a)]);const _0x429fe8={'timestamp':_0x25ee3b,'id':_0x1fcec4,'name':_0xf5e0c4[_0x3eeba2(0x137)],'type':_0xf5e0c4[_0x3eeba2(0x12c)],'location':_0xf5e0c4['location'],'value':_0x4c6c0c};_0x557bbc['eventHistory'][_0x3eeba2(0x177)](_0x429fe8);if(_0x557bbc[_0x3eeba2(0x135)][_0x3eeba2(0x13b)]>HISTORY_MAX_SIZE)_0x557bbc['eventHistory'][_0x3eeba2(0x15c)]();await _0x557bbc[_0x3eeba2(0x147)](_0x3eeba2(0x176),{'val':JSON[_0x3eeba2(0x130)](_0x429fe8),'ack':!![]}),await _0x557bbc[_0x3eeba2(0x147)](_0x3eeba2(0x12e),{'val':JSON['stringify'](_0x557bbc[_0x3eeba2(0x135)]),'ack':!![]});if(_0x557bbc[_0x3eeba2(0x16e)]){_0x557bbc[_0x3eeba2(0x17d)][_0x3eeba2(0x155)](_0x429fe8);if(_0x557bbc['rawEventLog'][_0x3eeba2(0x13b)]>RAW_LOG_MAX_SIZE)_0x557bbc['rawEventLog'][_0x3eeba2(0x184)](0x0,_0x557bbc['rawEventLog'][_0x3eeba2(0x13b)]-RAW_LOG_MAX_SIZE);await _0x557bbc[_0x3eeba2(0x147)](_0x3eeba2(0x165),{'val':JSON[_0x3eeba2(0x130)](_0x557bbc[_0x3eeba2(0x17d)]),'ack':!![]}),recordSequence(_0x557bbc,_0x429fe8);}if(_0xf5e0c4[_0x3eeba2(0x146)]&&_0x4c6c0c===!![]){if(_0x557bbc['isPresent']&&!_0x557bbc['isGracePeriodActive'])startExitTimer(_0x557bbc);else{if(!_0x557bbc[_0x3eeba2(0x154)])setPresence(_0x557bbc,!![]);}}else{if(_0xf5e0c4[_0x3eeba2(0x12c)]==='motion'&&_0x4c6c0c===!![]){if(_0x557bbc[_0x3eeba2(0x142)])abortExitTimer(_0x557bbc);if(!_0x557bbc[_0x3eeba2(0x154)]&&_0x557bbc[_0x3eeba2(0x183)]===_0x3eeba2(0x16b))setPresence(_0x557bbc,!![]);}}if(_0x557bbc['isProVersion']&&_0x557bbc[_0x3eeba2(0x138)]){_0xf5e0c4[_0x3eeba2(0x12c)]==='motion'&&_0x4c6c0c===!![]&&_0xf5e0c4['location']&&_0x557bbc[_0x3eeba2(0x138)]('SIMULATE_SIGNAL',{'room':_0xf5e0c4['location']});const _0x5dfa91=['door',_0x3eeba2(0x13c),_0x3eeba2(0x14f),_0x3eeba2(0x125),_0x3eeba2(0x16a),'handle',_0x3eeba2(0x144),'schloss'][_0x3eeba2(0x134)](_0x40dad2=>_0x100265[_0x3eeba2(0x13d)](_0x40dad2)),_0x9ba868=[_0x3eeba2(0x175),_0x3eeba2(0x141),'switch',_0x3eeba2(0x14a),_0x3eeba2(0x152),'lampe']['some'](_0x5ce817=>_0x100265[_0x3eeba2(0x13d)](_0x5ce817)),_0x565e0d=[_0x3eeba2(0x170),_0x3eeba2(0x126),_0x3eeba2(0x16c),_0x3eeba2(0x16f),_0x3eeba2(0x178)]['some'](_0x4430a8=>_0x100265['includes'](_0x4430a8));if(_0xf5e0c4[_0x3eeba2(0x15a)]&&(_0x5dfa91||_0x9ba868||_0x565e0d)){const _0x3bc9fd=_0x4c6c0c===!![]||typeof _0x4c6c0c===_0x3eeba2(0x12d)&&_0x4c6c0c>0x0,_0x39f4b9=_0x5dfa91&&!_0x3bc9fd&&_0x39ecd9!==undefined&&_0x39ecd9!=_0x4c6c0c;if(_0x3bc9fd||_0x39f4b9){const _0xc047d9=_0x557bbc[_0x3eeba2(0x131)]||_0x25ee3b,_0x419988=(_0x25ee3b-_0xc047d9)/0x3e8;_0x557bbc['lastTrackerEventTime']=_0x25ee3b,_0x557bbc[_0x3eeba2(0x138)]('TRACK_EVENT',{'room':_0xf5e0c4[_0x3eeba2(0x15a)],'dt':_0x419988});}}}return _0x429fe8;}module[a5_0x2a2cb5(0x120)]={'processSensorEvent':processSensorEvent,'getOutsideTemperatureNumeric':getOutsideTemperatureNumeric,'setPresence':setPresence,'abortExitTimer':abortExitTimer,'startExitTimer':startExitTimer};