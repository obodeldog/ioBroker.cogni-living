const a5_0x31a38a=a5_0x22ac;(function(_0x48cf9b,_0x3b19fb){const _0x145bc2=a5_0x22ac,_0x41cb74=_0x48cf9b();while(!![]){try{const _0x539a9a=-parseInt(_0x145bc2(0x19d))/0x1+-parseInt(_0x145bc2(0x1af))/0x2+-parseInt(_0x145bc2(0x1ee))/0x3+parseInt(_0x145bc2(0x198))/0x4+parseInt(_0x145bc2(0x1e7))/0x5*(parseInt(_0x145bc2(0x1e5))/0x6)+-parseInt(_0x145bc2(0x19a))/0x7*(parseInt(_0x145bc2(0x1bc))/0x8)+-parseInt(_0x145bc2(0x1eb))/0x9*(-parseInt(_0x145bc2(0x1ce))/0xa);if(_0x539a9a===_0x3b19fb)break;else _0x41cb74['push'](_0x41cb74['shift']());}catch(_0x5bd981){_0x41cb74['push'](_0x41cb74['shift']());}}}(a5_0x57ac,0x76a2b));const a5_0x1358f5=(function(){let _0x295c3f=!![];return function(_0x2ce30c,_0x36aebb){const _0x269da5=_0x295c3f?function(){const _0x2303af=a5_0x22ac;if(_0x36aebb){const _0x2815df=_0x36aebb[_0x2303af(0x19f)](_0x2ce30c,arguments);return _0x36aebb=null,_0x2815df;}}:function(){};return _0x295c3f=![],_0x269da5;};}()),a5_0x296b33=a5_0x1358f5(this,function(){const _0x1b04b9=a5_0x22ac;return a5_0x296b33['toString']()[_0x1b04b9(0x18d)](_0x1b04b9(0x1d0))[_0x1b04b9(0x199)]()['constructor'](a5_0x296b33)[_0x1b04b9(0x18d)](_0x1b04b9(0x1d0));});a5_0x296b33();'use strict';const HISTORY_MAX_SIZE=0x32,RAW_LOG_MAX_SIZE=0x9c4,THERMO_LOG_SIZE=0x3e8,SEQUENCE_TIMEOUT_MS=0x5*0x3c*0x3e8,MAX_TRAINING_SET_SIZE=0x1f4,EXIT_TIMER_MINUTES=0xf,EXIT_GRACE_PERIOD_SECONDS=0x1e;let activeSequence=[],sequenceTimer=null;async function getOutsideTemperatureNumeric(_0x36d5c8){const _0x516c44=a5_0x22ac;if(_0x36d5c8[_0x516c44(0x1d6)][_0x516c44(0x18b)])try{const _0x317921=await _0x36d5c8[_0x516c44(0x1c1)](_0x36d5c8[_0x516c44(0x1d6)]['outdoorSensorId']);if(_0x317921&&_0x317921['val']!==undefined&&_0x317921[_0x516c44(0x1c9)]!==null)return parseFloat(_0x317921['val']);}catch(_0x591b4a){}const _0x387e64=_0x36d5c8['config'][_0x516c44(0x1a2)];if(!_0x36d5c8[_0x516c44(0x1d6)][_0x516c44(0x1dc)]||!_0x387e64)return null;try{let _0x54e20b='';if(_0x387e64['includes'](_0x516c44(0x1b6)))_0x54e20b=_0x387e64+_0x516c44(0x194);else{if(_0x387e64[_0x516c44(0x18a)](_0x516c44(0x1ae)))_0x54e20b=_0x387e64+'.NextHours.Location_1.Day_1.current.temp_value';else{if(_0x387e64['includes'](_0x516c44(0x1ed)))_0x54e20b=_0x387e64+_0x516c44(0x1b8);else{if(_0x387e64[_0x516c44(0x18a)](_0x516c44(0x1b1)))_0x54e20b=_0x387e64+_0x516c44(0x196);}}}if(_0x54e20b){const _0x4386c2=await _0x36d5c8[_0x516c44(0x1c1)](_0x54e20b);if(_0x4386c2&&_0x4386c2[_0x516c44(0x1c9)]!==undefined&&_0x4386c2[_0x516c44(0x1c9)]!==null)return parseFloat(_0x4386c2[_0x516c44(0x1c9)]);}}catch(_0x285845){}return null;}async function recordThermodynamics(_0x5ca419,_0x3c407d,_0x458e2c,_0xac222a){const _0x3dbcde=a5_0x22ac,_0x4d9190=await getOutsideTemperatureNumeric(_0x5ca419);if(_0x4d9190===null)return;let _0x42700b=0x0,_0xc6172a=![];if(_0x5ca419[_0x3dbcde(0x1d6)]['valveMapping'])try{let _0x22922f=_0x5ca419['config'][_0x3dbcde(0x18c)];if(typeof _0x22922f===_0x3dbcde(0x1ca))_0x22922f=JSON[_0x3dbcde(0x189)](_0x22922f);if(_0x22922f[_0x3c407d]){const _0x5a91cc=_0x22922f[_0x3c407d],_0x2eeacd=await _0x5ca419[_0x3dbcde(0x1c1)](_0x5a91cc);if(_0x2eeacd&&_0x2eeacd[_0x3dbcde(0x1c9)]!==null&&_0x2eeacd[_0x3dbcde(0x1c9)]!==undefined){let _0x5ad6d7=Number(_0x2eeacd[_0x3dbcde(0x1c9)]);if(_0x5ad6d7<=1.05&&!_0x5a91cc['includes'](_0x3dbcde(0x1c4))&&!_0x5a91cc['includes'](_0x3dbcde(0x1a9)))_0x5ad6d7=_0x5ad6d7*0x64;_0x42700b=Math['round'](_0x5ad6d7),_0xc6172a=!![];}}}catch(_0x405d4d){}if(!_0xc6172a){const _0x54a584=[{'from':_0x3dbcde(0x1d8),'to':_0x3dbcde(0x1bd)},{'from':_0x3dbcde(0x1d8),'to':_0x3dbcde(0x185)},{'from':_0x3dbcde(0x1cd),'to':_0x3dbcde(0x1da)},{'from':_0x3dbcde(0x1c8),'to':_0x3dbcde(0x1e9)},{'from':_0x3dbcde(0x1c2),'to':_0x3dbcde(0x1b7)},{'from':'Temperature','to':_0x3dbcde(0x1b0)}];for(const _0x499ba9 of _0x54a584){if(_0x3c407d[_0x3dbcde(0x18a)](_0x499ba9['from'])){const _0xa86d32=_0x3c407d[_0x3dbcde(0x1c0)](_0x499ba9[_0x3dbcde(0x1a3)],_0x499ba9['to']);try{const _0x3d32e2=await _0x5ca419['getForeignStateAsync'](_0xa86d32);if(_0x3d32e2&&_0x3d32e2[_0x3dbcde(0x1c9)]!==null&&_0x3d32e2[_0x3dbcde(0x1c9)]!==undefined){let _0xcd1e05=Number(_0x3d32e2['val']);if(typeof _0xcd1e05==='number'){if(_0xcd1e05<=1.05&&_0x499ba9['to'][_0x3dbcde(0x18a)](_0x3dbcde(0x1d4)))_0xcd1e05=_0xcd1e05*0x64;_0x42700b=Math[_0x3dbcde(0x1b4)](_0xcd1e05),_0xc6172a=!![];break;}}}catch(_0x4014ea){}}}}const _0x296c6f=await _0x5ca419['getStateAsync']('LTM.trainingData.thermodynamics');let _0x2cab91=[];if(_0x296c6f&&_0x296c6f['val'])try{_0x2cab91=JSON['parse'](_0x296c6f[_0x3dbcde(0x1c9)]);}catch(_0x11a355){}_0x2cab91[_0x3dbcde(0x182)]({'ts':Date[_0x3dbcde(0x183)](),'room':_0xac222a||_0x3dbcde(0x18f),'t_in':_0x458e2c,'t_out':_0x4d9190,'valve':_0x42700b});if(_0x2cab91[_0x3dbcde(0x195)]>THERMO_LOG_SIZE)_0x2cab91[_0x3dbcde(0x1a8)]();await _0x5ca419[_0x3dbcde(0x1a1)](_0x3dbcde(0x19c),{'val':JSON[_0x3dbcde(0x180)](_0x2cab91),'ack':!![]});}async function saveCompletedSequence(_0xa72525){const _0x3db56c=a5_0x22ac;try{const _0x30f29a=await _0xa72525[_0x3db56c(0x1a5)](_0x3db56c(0x1db));let _0x44032a=[];if(_0x30f29a&&_0x30f29a['val'])try{_0x44032a=JSON[_0x3db56c(0x189)](_0x30f29a[_0x3db56c(0x1c9)]);}catch(_0x388121){}const _0x1f534a=activeSequence[0x0]['ts'],_0x262fdd=activeSequence[_0x3db56c(0x17f)](_0x1cb138=>({'loc':_0x1cb138['loc'],'t_delta':Math[_0x3db56c(0x1b4)]((_0x1cb138['ts']-_0x1f534a)/0x3e8)})),_0x1c3ecd={'timestamp':new Date(_0x1f534a)[_0x3db56c(0x1a4)](),'steps':_0x262fdd,'duration':Math[_0x3db56c(0x1b4)]((activeSequence[activeSequence[_0x3db56c(0x195)]-0x1]['ts']-_0x1f534a)/0x3e8),'daytime':new Date(_0x1f534a)[_0x3db56c(0x1cc)]()};_0x44032a['push'](_0x1c3ecd);if(_0x44032a[_0x3db56c(0x195)]>MAX_TRAINING_SET_SIZE)_0x44032a['shift']();await _0xa72525[_0x3db56c(0x1a1)](_0x3db56c(0x1db),{'val':JSON[_0x3db56c(0x180)](_0x44032a),'ack':!![]}),_0xa72525[_0x3db56c(0x1d5)]&&_0xa72525[_0x3db56c(0x1c6)]&&_0xa72525[_0x3db56c(0x1c6)]('ANALYZE_SEQUENCE',{'sequence':_0x1c3ecd});}catch(_0x6f2587){_0xa72525[_0x3db56c(0x1e1)][_0x3db56c(0x192)]('[RECORDER]\x20Error:\x20'+_0x6f2587[_0x3db56c(0x1ab)]);}}function a5_0x22ac(_0x1c4aff,_0x9f0984){const _0xa128f6=a5_0x57ac();return a5_0x22ac=function(_0x296b33,_0x1358f5){_0x296b33=_0x296b33-0x17f;let _0x57acc2=_0xa128f6[_0x296b33];return _0x57acc2;},a5_0x22ac(_0x1c4aff,_0x9f0984);}async function recordSequence(_0x2214cf,_0x3a1ad6){const _0x38567b=a5_0x22ac,_0x3342b6=(_0x3a1ad6['type']||'')[_0x38567b(0x1be)](),_0x32f8fe=[_0x38567b(0x191),_0x38567b(0x1bf),_0x38567b(0x1b3),_0x38567b(0x1c3),_0x38567b(0x1aa),_0x38567b(0x1e3),_0x38567b(0x1e8),_0x38567b(0x181),_0x38567b(0x1d3),_0x38567b(0x18e),_0x38567b(0x190),'light',_0x38567b(0x1de),_0x38567b(0x1ec),_0x38567b(0x1bb),_0x38567b(0x1b2),_0x38567b(0x1d1)];if(!_0x32f8fe['some'](_0x3f7fb6=>_0x3342b6['includes'](_0x3f7fb6)))return;if(!_0x3a1ad6['value'])return;if(sequenceTimer)clearTimeout(sequenceTimer);activeSequence[_0x38567b(0x182)]({'loc':_0x3a1ad6['location']||_0x38567b(0x18f),'id':_0x3a1ad6['id'],'ts':Date[_0x38567b(0x183)]()}),sequenceTimer=setTimeout(async()=>{const _0x338bd7=_0x38567b;if(activeSequence[_0x338bd7(0x195)]>0x1)await saveCompletedSequence(_0x2214cf);activeSequence=[];},SEQUENCE_TIMEOUT_MS);}function startExitTimer(_0x31ccab){const _0x2f33a7=a5_0x22ac;abortExitTimer(_0x31ccab),_0x31ccab[_0x2f33a7(0x184)]=!![],_0x31ccab[_0x2f33a7(0x1b9)]=setTimeout(()=>{const _0x4b0b79=_0x2f33a7;_0x31ccab[_0x4b0b79(0x184)]=![];},EXIT_GRACE_PERIOD_SECONDS*0x3e8),_0x31ccab['exitTimer']=setTimeout(()=>{const _0x15408b=_0x2f33a7;setPresence(_0x31ccab,![]),_0x31ccab[_0x15408b(0x186)]=null;},EXIT_TIMER_MINUTES*0x3c*0x3e8);}function abortExitTimer(_0x33aa90){const _0x4e73ce=a5_0x22ac;if(_0x33aa90[_0x4e73ce(0x186)])clearTimeout(_0x33aa90[_0x4e73ce(0x186)]);if(_0x33aa90['exitGraceTimer'])clearTimeout(_0x33aa90[_0x4e73ce(0x1b9)]);_0x33aa90[_0x4e73ce(0x186)]=null,_0x33aa90[_0x4e73ce(0x1b9)]=null,_0x33aa90[_0x4e73ce(0x184)]=![];}async function setPresence(_0x4e12e8,_0x5add15){const _0x41e1ba=a5_0x22ac;if(_0x4e12e8[_0x41e1ba(0x1e6)]===_0x5add15)return;_0x4e12e8[_0x41e1ba(0x1e6)]=_0x5add15,await _0x4e12e8[_0x41e1ba(0x1a1)](_0x41e1ba(0x1ac),{'val':_0x5add15,'ack':!![]});}async function processSensorEvent(_0x267bdf,_0x22d88f,_0x28574a,_0x30a3ef){const _0x2be681=a5_0x22ac;if(!_0x30a3ef)return null;const _0x5794e9=_0x28574a['val'],_0x2bef25=Date[_0x2be681(0x183)](),_0x3b6ea3=_0x267bdf[_0x2be681(0x1ea)][_0x22d88f];_0x267bdf[_0x2be681(0x1ea)][_0x22d88f]=_0x5794e9;if(!_0x30a3ef[_0x2be681(0x1e4)]&&_0x3b6ea3!=undefined&&_0x3b6ea3==_0x5794e9)return null;const _0x30a0e9=(_0x30a3ef[_0x2be681(0x1dd)]||'')['toLowerCase'](),_0x1322a1=_0x30a0e9[_0x2be681(0x18a)]('temperature')||_0x30a0e9[_0x2be681(0x18a)](_0x2be681(0x1ad))||_0x30a0e9[_0x2be681(0x18a)]('klima')||_0x30a0e9[_0x2be681(0x18a)](_0x2be681(0x1e2))||_0x30a0e9[_0x2be681(0x18a)]('thermostat');_0x267bdf[_0x2be681(0x1d5)]&&_0x1322a1&&recordThermodynamics(_0x267bdf,_0x22d88f,_0x5794e9,_0x30a3ef[_0x2be681(0x1a0)]);const _0xd45f27={'timestamp':_0x2bef25,'id':_0x22d88f,'name':_0x30a3ef[_0x2be681(0x1cb)],'type':_0x30a3ef[_0x2be681(0x1dd)],'location':_0x30a3ef[_0x2be681(0x1a0)],'value':_0x5794e9};_0x267bdf[_0x2be681(0x197)][_0x2be681(0x193)](_0xd45f27);if(_0x267bdf[_0x2be681(0x197)]['length']>HISTORY_MAX_SIZE)_0x267bdf['eventHistory']['pop']();await _0x267bdf[_0x2be681(0x1a1)](_0x2be681(0x1ba),{'val':JSON[_0x2be681(0x180)](_0xd45f27),'ack':!![]}),await _0x267bdf[_0x2be681(0x1a1)]('events.history',{'val':JSON[_0x2be681(0x180)](_0x267bdf['eventHistory']),'ack':!![]});if(_0x267bdf[_0x2be681(0x1d5)]){_0x267bdf[_0x2be681(0x1e0)][_0x2be681(0x182)](_0xd45f27);if(_0x267bdf[_0x2be681(0x1e0)][_0x2be681(0x195)]>RAW_LOG_MAX_SIZE)_0x267bdf['rawEventLog'][_0x2be681(0x1d9)](0x0,_0x267bdf[_0x2be681(0x1e0)][_0x2be681(0x195)]-RAW_LOG_MAX_SIZE);await _0x267bdf[_0x2be681(0x1a1)](_0x2be681(0x19e),{'val':JSON['stringify'](_0x267bdf[_0x2be681(0x1e0)]),'ack':!![]}),recordSequence(_0x267bdf,_0xd45f27);}if(_0x30a3ef[_0x2be681(0x19b)]&&_0x5794e9===!![]){if(_0x267bdf[_0x2be681(0x1e6)]&&!_0x267bdf[_0x2be681(0x184)])startExitTimer(_0x267bdf);else{if(!_0x267bdf[_0x2be681(0x1e6)])setPresence(_0x267bdf,!![]);}}else{if(_0x30a3ef['type']===_0x2be681(0x191)&&_0x5794e9===!![]){if(_0x267bdf['exitTimer'])abortExitTimer(_0x267bdf);if(!_0x267bdf[_0x2be681(0x1e6)]&&_0x267bdf[_0x2be681(0x1d7)]===_0x2be681(0x187))setPresence(_0x267bdf,!![]);}}if(_0x267bdf['isProVersion']&&_0x267bdf['sendToPythonWrapper']){_0x30a3ef['type']===_0x2be681(0x191)&&_0x5794e9===!![]&&_0x30a3ef[_0x2be681(0x1a0)]&&_0x267bdf[_0x2be681(0x1c6)](_0x2be681(0x188),{'room':_0x30a3ef[_0x2be681(0x1a0)]});const _0x10c256=[_0x2be681(0x1e3),_0x2be681(0x1e8),'window','fenster',_0x2be681(0x1a7),_0x2be681(0x1b5),_0x2be681(0x1d2),_0x2be681(0x1df)][_0x2be681(0x1c5)](_0x230c1a=>_0x30a0e9[_0x2be681(0x18a)](_0x230c1a)),_0x3d028a=['light',_0x2be681(0x1de),'switch',_0x2be681(0x1bb),'dimmer',_0x2be681(0x1d1)][_0x2be681(0x1c5)](_0x19acf1=>_0x30a0e9[_0x2be681(0x18a)](_0x19acf1)),_0x3d69cb=['motion',_0x2be681(0x1bf),_0x2be681(0x1b3),'presence','occupancy']['some'](_0x291920=>_0x30a0e9[_0x2be681(0x18a)](_0x291920));if(_0x30a3ef['location']&&(_0x10c256||_0x3d028a||_0x3d69cb)){const _0x40ad81=_0x5794e9===!![]||typeof _0x5794e9==='number'&&_0x5794e9>0x0,_0x59ec8a=_0x10c256&&!_0x40ad81&&_0x3b6ea3!==undefined&&_0x3b6ea3!=_0x5794e9;if(_0x40ad81||_0x59ec8a){const _0x1597b0=_0x267bdf[_0x2be681(0x1cf)]||_0x2bef25,_0x2f5717=(_0x2bef25-_0x1597b0)/0x3e8;_0x267bdf['lastTrackerEventTime']=_0x2bef25,_0x267bdf[_0x2be681(0x1c6)](_0x2be681(0x1c7),{'room':_0x30a3ef[_0x2be681(0x1a0)],'dt':_0x2f5717});}}}return _0xd45f27;}function a5_0x57ac(){const _0x2cb7ab=['length','.forecast.current.temp','eventHistory','277828OwkIsu','toString','14AtguIr','isExit','LTM.trainingData.thermodynamics','755525PBtDKJ','LTM.rawEventLog','apply','location','setStateAsync','weatherInstance','from','toISOString','getStateAsync','exports','griff','shift','STATE','occupancy','message','system.isPresent','temperatur','daswetter','412928hldZrP','Valve','weatherunderground','dimmer','präsenz','round','handle','accuweather','level','.forecast.current.temperature','exitGraceTimer','events.lastEvent','schalter','3796896XiKtXk','.1.LEVEL','toLowerCase','bewegung','replace','getForeignStateAsync','temperature','presence','STATUS','some','sendToPythonWrapper','TRACK_EVENT','.ACTUAL_TEMPERATURE','val','string','name','getHours','.1.TEMPERATURE','12816230yltvEQ','lastTrackerEventTime','(((.+)+)+)+$','lampe','lock','fenster','LEVEL','isProVersion','config','currentSystemMode','.1.ACTUAL_TEMPERATURE','splice','.4.VALVE_STATE','LTM.trainingData.sequences','useWeather','type','licht','schloss','rawEventLog','log','heizung','door','logDuplicates','108EEutXa','isPresent','197050oZsUQK','tür','.LEVEL','sensorLastValues','18aDAZXF','switch','openweathermap','2834817wKVACr','map','stringify','window','push','now','isGracePeriodActive','.1.VALVE_STATE','exitTimer','normal','SIMULATE_SIGNAL','parse','includes','outdoorSensorId','valveMapping','search','contact','Unknown','kontakt','motion','error','unshift','.Current.Temperature'];a5_0x57ac=function(){return _0x2cb7ab;};return a5_0x57ac();}module[a5_0x31a38a(0x1a6)]={'processSensorEvent':processSensorEvent,'getOutsideTemperatureNumeric':getOutsideTemperatureNumeric,'setPresence':setPresence,'abortExitTimer':abortExitTimer,'startExitTimer':startExitTimer};