(function(_0x2e3f0f,_0x38ab03){const _0x3343f6=a5_0x16a2,_0x290a79=_0x2e3f0f();while(!![]){try{const _0x5f4064=parseInt(_0x3343f6(0x1d7))/0x1*(-parseInt(_0x3343f6(0x1d9))/0x2)+-parseInt(_0x3343f6(0x1ae))/0x3+-parseInt(_0x3343f6(0x17f))/0x4+-parseInt(_0x3343f6(0x1b8))/0x5+parseInt(_0x3343f6(0x1b5))/0x6+parseInt(_0x3343f6(0x1cd))/0x7*(-parseInt(_0x3343f6(0x18a))/0x8)+parseInt(_0x3343f6(0x1bc))/0x9*(parseInt(_0x3343f6(0x1bb))/0xa);if(_0x5f4064===_0x38ab03)break;else _0x290a79['push'](_0x290a79['shift']());}catch(_0x116c1f){_0x290a79['push'](_0x290a79['shift']());}}}(a5_0x55ce,0xed43e));const a5_0x17adf3=(function(){let _0x386c88=!![];return function(_0x5daea9,_0x431406){const _0xbfe567=_0x386c88?function(){const _0x543b0f=a5_0x16a2;if(_0x431406){const _0x3ebb52=_0x431406[_0x543b0f(0x1ad)](_0x5daea9,arguments);return _0x431406=null,_0x3ebb52;}}:function(){};return _0x386c88=![],_0xbfe567;};}()),a5_0x483f98=a5_0x17adf3(this,function(){const _0x13538a=a5_0x16a2;return a5_0x483f98['toString']()['search'](_0x13538a(0x179))[_0x13538a(0x1a4)]()[_0x13538a(0x1ce)](a5_0x483f98)['search'](_0x13538a(0x179));});a5_0x483f98();'use strict';const HISTORY_MAX_SIZE=0x32,RAW_LOG_MAX_SIZE=0x9c4,THERMO_LOG_SIZE=0x3e8,SEQUENCE_TIMEOUT_MS=0x5*0x3c*0x3e8,MAX_TRAINING_SET_SIZE=0x1f4,EXIT_TIMER_MINUTES=0xf,EXIT_GRACE_PERIOD_SECONDS=0x1e;let activeSequence=[],sequenceTimer=null;async function getOutsideTemperatureNumeric(_0x4a707d){const _0x12dbf5=a5_0x16a2;if(_0x4a707d[_0x12dbf5(0x1d8)][_0x12dbf5(0x1a5)])try{const _0x5bffb6=await _0x4a707d[_0x12dbf5(0x185)](_0x4a707d[_0x12dbf5(0x1d8)][_0x12dbf5(0x1a5)]);if(_0x5bffb6&&_0x5bffb6[_0x12dbf5(0x1a8)]!==undefined&&_0x5bffb6[_0x12dbf5(0x1a8)]!==null)return parseFloat(_0x5bffb6[_0x12dbf5(0x1a8)]);}catch(_0x2f9fac){}const _0x3bbfef=_0x4a707d[_0x12dbf5(0x1d8)][_0x12dbf5(0x1ca)];if(!_0x4a707d[_0x12dbf5(0x1d8)][_0x12dbf5(0x1c7)]||!_0x3bbfef)return null;try{let _0x325102='';if(_0x3bbfef[_0x12dbf5(0x19e)](_0x12dbf5(0x1b1)))_0x325102=_0x3bbfef+'.Current.Temperature';else{if(_0x3bbfef[_0x12dbf5(0x19e)](_0x12dbf5(0x1c0)))_0x325102=_0x3bbfef+_0x12dbf5(0x1c3);else{if(_0x3bbfef[_0x12dbf5(0x19e)](_0x12dbf5(0x19a)))_0x325102=_0x3bbfef+'.forecast.current.temperature';else{if(_0x3bbfef['includes']('weatherunderground'))_0x325102=_0x3bbfef+'.forecast.current.temp';}}}if(_0x325102){const _0xd7e1a3=await _0x4a707d[_0x12dbf5(0x185)](_0x325102);if(_0xd7e1a3&&_0xd7e1a3[_0x12dbf5(0x1a8)]!==undefined&&_0xd7e1a3['val']!==null)return parseFloat(_0xd7e1a3['val']);}}catch(_0x2bba81){}return null;}async function recordThermodynamics(_0x450d2e,_0x4b5218,_0x1f5d4e,_0x59513b){const _0xdba341=a5_0x16a2,_0x301150=await getOutsideTemperatureNumeric(_0x450d2e);if(_0x301150===null)return;let _0x48f626=0x0,_0x51b1a1=![];if(_0x450d2e[_0xdba341(0x1d8)][_0xdba341(0x195)])try{let _0x55893c=_0x450d2e['config']['valveMapping'];if(typeof _0x55893c===_0xdba341(0x178))_0x55893c=JSON[_0xdba341(0x174)](_0x55893c);if(_0x55893c[_0x4b5218]){const _0x39e252=_0x55893c[_0x4b5218],_0x3ebd2d=await _0x450d2e['getForeignStateAsync'](_0x39e252);if(_0x3ebd2d&&_0x3ebd2d[_0xdba341(0x1a8)]!==null&&_0x3ebd2d['val']!==undefined){let _0x37e8fe=Number(_0x3ebd2d[_0xdba341(0x1a8)]);if(_0x37e8fe<=1.05&&!_0x39e252['includes']('STATUS')&&!_0x39e252[_0xdba341(0x19e)](_0xdba341(0x18b)))_0x37e8fe=_0x37e8fe*0x64;_0x48f626=Math[_0xdba341(0x1ac)](_0x37e8fe),_0x51b1a1=!![];}}}catch(_0x5c7afe){}if(!_0x51b1a1){const _0x126fd0=[{'from':'.1.ACTUAL_TEMPERATURE','to':_0xdba341(0x1c4)},{'from':'.1.ACTUAL_TEMPERATURE','to':_0xdba341(0x177)},{'from':'.1.TEMPERATURE','to':'.4.VALVE_STATE'},{'from':_0xdba341(0x170),'to':_0xdba341(0x1c9)},{'from':'temperature','to':_0xdba341(0x1b2)},{'from':_0xdba341(0x17e),'to':_0xdba341(0x1ba)}];for(const _0x4ec702 of _0x126fd0){if(_0x4b5218[_0xdba341(0x19e)](_0x4ec702[_0xdba341(0x1d2)])){const _0x2e9b50=_0x4b5218['replace'](_0x4ec702[_0xdba341(0x1d2)],_0x4ec702['to']);try{const _0x1a84aa=await _0x450d2e[_0xdba341(0x185)](_0x2e9b50);if(_0x1a84aa&&_0x1a84aa['val']!==null&&_0x1a84aa['val']!==undefined){let _0x28e993=Number(_0x1a84aa['val']);if(typeof _0x28e993===_0xdba341(0x184)){if(_0x28e993<=1.05&&_0x4ec702['to']['includes'](_0xdba341(0x1c2)))_0x28e993=_0x28e993*0x64;_0x48f626=Math[_0xdba341(0x1ac)](_0x28e993),_0x51b1a1=!![];break;}}}catch(_0x484029){}}}}const _0x1cde89=await _0x450d2e['getStateAsync'](_0xdba341(0x1d0));let _0x3c9d12=[];if(_0x1cde89&&_0x1cde89[_0xdba341(0x1a8)])try{_0x3c9d12=JSON[_0xdba341(0x174)](_0x1cde89[_0xdba341(0x1a8)]);}catch(_0x1c0f3e){}_0x3c9d12[_0xdba341(0x1b0)]({'ts':Date[_0xdba341(0x18f)](),'room':_0x59513b||_0xdba341(0x197),'t_in':_0x1f5d4e,'t_out':_0x301150,'valve':_0x48f626});if(_0x3c9d12['length']>THERMO_LOG_SIZE)_0x3c9d12[_0xdba341(0x191)]();await _0x450d2e[_0xdba341(0x1a0)](_0xdba341(0x1d0),{'val':JSON['stringify'](_0x3c9d12),'ack':!![]});}async function saveCompletedSequence(_0x195b7d){const _0x50157c=a5_0x16a2;try{const _0x521d6d=await _0x195b7d[_0x50157c(0x173)](_0x50157c(0x17c));let _0xab921d=[];if(_0x521d6d&&_0x521d6d[_0x50157c(0x1a8)])try{_0xab921d=JSON['parse'](_0x521d6d[_0x50157c(0x1a8)]);}catch(_0x4d3de1){}const _0xd6e812=activeSequence[0x0]['ts'],_0x1a081a=activeSequence[_0x50157c(0x1a2)](_0x1dd056=>({'loc':_0x1dd056['loc'],'t_delta':Math[_0x50157c(0x1ac)]((_0x1dd056['ts']-_0xd6e812)/0x3e8)})),_0x5bba36={'timestamp':new Date(_0xd6e812)[_0x50157c(0x1b7)](),'steps':_0x1a081a,'duration':Math['round']((activeSequence[activeSequence[_0x50157c(0x1bf)]-0x1]['ts']-_0xd6e812)/0x3e8),'daytime':new Date(_0xd6e812)[_0x50157c(0x19f)]()};_0xab921d[_0x50157c(0x1b0)](_0x5bba36);if(_0xab921d[_0x50157c(0x1bf)]>MAX_TRAINING_SET_SIZE)_0xab921d[_0x50157c(0x191)]();await _0x195b7d[_0x50157c(0x1a0)]('LTM.trainingData.sequences',{'val':JSON[_0x50157c(0x186)](_0xab921d),'ack':!![]}),_0x195b7d['isProVersion']&&_0x195b7d['sendToPythonWrapper']&&_0x195b7d[_0x50157c(0x17a)](_0x50157c(0x18d),{'sequence':_0x5bba36});}catch(_0x2bcff9){_0x195b7d['log']['error'](_0x50157c(0x1a3)+_0x2bcff9[_0x50157c(0x19d)]);}}async function recordSequence(_0x5a7aaf,_0x23fcd5){const _0x37844e=a5_0x16a2,_0x569d84=(_0x23fcd5[_0x37844e(0x1cb)]||'')['toLowerCase'](),_0x202b45=['motion',_0x37844e(0x1ab),_0x37844e(0x1a6),_0x37844e(0x194),_0x37844e(0x1b6),'door',_0x37844e(0x18c),'window',_0x37844e(0x180),'contact','kontakt','light',_0x37844e(0x1bd),_0x37844e(0x188),_0x37844e(0x172),'dimmer',_0x37844e(0x171)];if(!_0x202b45['some'](_0x43004e=>_0x569d84[_0x37844e(0x19e)](_0x43004e)))return;if(!_0x23fcd5[_0x37844e(0x1d4)])return;if(sequenceTimer)clearTimeout(sequenceTimer);activeSequence[_0x37844e(0x1b0)]({'loc':_0x23fcd5[_0x37844e(0x1af)]||'Unknown','id':_0x23fcd5['id'],'ts':Date[_0x37844e(0x18f)]()}),sequenceTimer=setTimeout(async()=>{if(activeSequence['length']>0x1)await saveCompletedSequence(_0x5a7aaf);activeSequence=[];},SEQUENCE_TIMEOUT_MS);}function startExitTimer(_0x513878){const _0x221d9d=a5_0x16a2;abortExitTimer(_0x513878),_0x513878['isGracePeriodActive']=!![],_0x513878[_0x221d9d(0x17d)]=setTimeout(()=>{_0x513878['isGracePeriodActive']=![];},EXIT_GRACE_PERIOD_SECONDS*0x3e8),_0x513878[_0x221d9d(0x1d6)]=setTimeout(()=>{setPresence(_0x513878,![]),_0x513878['exitTimer']=null;},EXIT_TIMER_MINUTES*0x3c*0x3e8);}function abortExitTimer(_0x19d0ec){const _0xe69187=a5_0x16a2;if(_0x19d0ec[_0xe69187(0x1d6)])clearTimeout(_0x19d0ec[_0xe69187(0x1d6)]);if(_0x19d0ec['exitGraceTimer'])clearTimeout(_0x19d0ec[_0xe69187(0x17d)]);_0x19d0ec[_0xe69187(0x1d6)]=null,_0x19d0ec[_0xe69187(0x17d)]=null,_0x19d0ec[_0xe69187(0x193)]=![];}async function setPresence(_0x442ffa,_0x1763f4){const _0x1c6bb4=a5_0x16a2;if(_0x442ffa['isPresent']===_0x1763f4)return;_0x442ffa['isPresent']=_0x1763f4,await _0x442ffa['setStateAsync'](_0x1c6bb4(0x190),{'val':_0x1763f4,'ack':!![]});}function a5_0x16a2(_0x39464b,_0x275d4e){const _0x17435f=a5_0x55ce();return a5_0x16a2=function(_0x483f98,_0x17adf3){_0x483f98=_0x483f98-0x170;let _0x55cedb=_0x17435f[_0x483f98];return _0x55cedb;},a5_0x16a2(_0x39464b,_0x275d4e);}async function updateHourlyActivity(_0x53442b){const _0x15b73e=a5_0x16a2;let _0x1b291f=new Array(0x18)['fill'](0x0),_0x2d3af8=0x0;try{const _0x2da453=await _0x53442b['getStateAsync']('analysis.health.todayVector');_0x2da453&&_0x2da453[_0x15b73e(0x1a8)]&&(_0x1b291f=JSON['parse'](_0x2da453['val']),_0x2d3af8=_0x2da453['ts']);}catch(_0x3ea730){}const _0x1ab869=new Date(_0x2d3af8),_0x254d08=new Date();_0x1ab869[_0x15b73e(0x1b9)]()!==_0x254d08[_0x15b73e(0x1b9)]()&&(_0x1b291f=new Array(0x18)['fill'](0x0));const _0xe44586=_0x254d08[_0x15b73e(0x19f)]();if(_0x1b291f[_0xe44586]===undefined)_0x1b291f[_0xe44586]=0x0;_0x1b291f[_0xe44586]++,await _0x53442b[_0x15b73e(0x1a0)](_0x15b73e(0x175),{'val':JSON[_0x15b73e(0x186)](_0x1b291f),'ack':!![]});}function a5_0x55ce(){const _0x3e0634=['4054434XHQeIa','location','push','accuweather','level','heizung','klima','8776080RJhtfK','occupancy','toISOString','6708575FTehSB','getDate','Valve','13220qfqcbW','33948qEYsGW','licht','window','length','daswetter','currentSystemMode','LEVEL','.NextHours.Location_1.Day_1.current.temp_value','.1.LEVEL','thermostat','isProVersion','useWeather','isPresent','.LEVEL','weatherInstance','type','name','327138RqijGl','constructor','motion','LTM.trainingData.thermodynamics','TRACK_EVENT','from','schloss','value','LTM.rawEventLog','exitTimer','117ckCCgW','config','394XUiVPj','some','\x20from\x20','.ACTUAL_TEMPERATURE','lampe','schalter','getStateAsync','parse','analysis.health.todayVector','eventHistory','.1.VALVE_STATE','string','(((.+)+)+)+$','sendToPythonWrapper','handle','LTM.trainingData.sequences','exitGraceTimer','Temperature','4501976AofOgL','fenster','light','sensorLastValues','temperature','number','getForeignStateAsync','stringify','dimmer','switch','pop','280bgPvMQ','STATE','tür','ANALYZE_SEQUENCE','lastTrackerEventTime','now','system.isPresent','shift','logDuplicates','isGracePeriodActive','presence','valveMapping','rawEventLog','Unknown','log','unshift','openweathermap','events.history','isExit','message','includes','getHours','setStateAsync','[RECORDER]\x20Ignored\x20implausible\x20temperature:\x20','map','[RECORDER]\x20Error:\x20','toString','outdoorSensorId','präsenz','toLowerCase','val','SIMULATE_SIGNAL','debug','bewegung','round','apply'];a5_0x55ce=function(){return _0x3e0634;};return a5_0x55ce();}async function processSensorEvent(_0x375f34,_0x412817,_0x18bfaf,_0x4875a2){const _0x55a78e=a5_0x16a2;if(!_0x4875a2)return null;const _0x421fe9=_0x18bfaf[_0x55a78e(0x1a8)],_0x2b7396=Date[_0x55a78e(0x18f)](),_0x1a6a56=_0x375f34[_0x55a78e(0x182)][_0x412817],_0x3e2a3c=(_0x4875a2[_0x55a78e(0x1cb)]||'')[_0x55a78e(0x1a7)](),_0x546a50=_0x3e2a3c['includes'](_0x55a78e(0x183))||_0x3e2a3c[_0x55a78e(0x19e)]('temperatur')||_0x3e2a3c['includes'](_0x55a78e(0x1b4))||_0x3e2a3c[_0x55a78e(0x19e)](_0x55a78e(0x1b3))||_0x3e2a3c['includes'](_0x55a78e(0x1c5));if(_0x546a50&&typeof _0x421fe9===_0x55a78e(0x184)){if(_0x421fe9>0x50||_0x421fe9<-0x32)return _0x375f34[_0x55a78e(0x198)][_0x55a78e(0x1aa)](_0x55a78e(0x1a1)+_0x421fe9+_0x55a78e(0x1db)+_0x412817),null;}_0x375f34[_0x55a78e(0x182)][_0x412817]=_0x421fe9;if(!_0x4875a2[_0x55a78e(0x192)]&&_0x1a6a56!=undefined&&_0x1a6a56==_0x421fe9)return null;_0x375f34[_0x55a78e(0x1c6)]&&_0x546a50&&recordThermodynamics(_0x375f34,_0x412817,_0x421fe9,_0x4875a2[_0x55a78e(0x1af)]);const _0x8e6be4={'timestamp':_0x2b7396,'id':_0x412817,'name':_0x4875a2[_0x55a78e(0x1cc)],'type':_0x4875a2[_0x55a78e(0x1cb)],'location':_0x4875a2['location'],'value':_0x421fe9};_0x375f34[_0x55a78e(0x176)][_0x55a78e(0x199)](_0x8e6be4);if(_0x375f34[_0x55a78e(0x176)][_0x55a78e(0x1bf)]>HISTORY_MAX_SIZE)_0x375f34[_0x55a78e(0x176)][_0x55a78e(0x189)]();await _0x375f34['setStateAsync']('events.lastEvent',{'val':JSON[_0x55a78e(0x186)](_0x8e6be4),'ack':!![]}),await _0x375f34['setStateAsync'](_0x55a78e(0x19b),{'val':JSON[_0x55a78e(0x186)](_0x375f34['eventHistory']),'ack':!![]}),await updateHourlyActivity(_0x375f34);if(_0x375f34['isProVersion']){_0x375f34[_0x55a78e(0x196)][_0x55a78e(0x1b0)](_0x8e6be4);if(_0x375f34[_0x55a78e(0x196)][_0x55a78e(0x1bf)]>RAW_LOG_MAX_SIZE)_0x375f34['rawEventLog']['splice'](0x0,_0x375f34['rawEventLog'][_0x55a78e(0x1bf)]-RAW_LOG_MAX_SIZE);await _0x375f34['setStateAsync'](_0x55a78e(0x1d5),{'val':JSON['stringify'](_0x375f34[_0x55a78e(0x196)]),'ack':!![]}),recordSequence(_0x375f34,_0x8e6be4);}if(_0x4875a2[_0x55a78e(0x19c)]&&_0x421fe9===!![]){if(_0x375f34[_0x55a78e(0x1c8)]&&!_0x375f34[_0x55a78e(0x193)])startExitTimer(_0x375f34);else{if(!_0x375f34[_0x55a78e(0x1c8)])setPresence(_0x375f34,!![]);}}else{if(_0x4875a2[_0x55a78e(0x1cb)]===_0x55a78e(0x1cf)&&_0x421fe9===!![]){if(_0x375f34['exitTimer'])abortExitTimer(_0x375f34);if(!_0x375f34[_0x55a78e(0x1c8)]&&_0x375f34[_0x55a78e(0x1c1)]==='normal')setPresence(_0x375f34,!![]);}}if(_0x375f34[_0x55a78e(0x1c6)]&&_0x375f34[_0x55a78e(0x17a)]){_0x4875a2[_0x55a78e(0x1cb)]===_0x55a78e(0x1cf)&&_0x421fe9===!![]&&_0x4875a2[_0x55a78e(0x1af)]&&_0x375f34[_0x55a78e(0x17a)](_0x55a78e(0x1a9),{'room':_0x4875a2[_0x55a78e(0x1af)]});const _0x39950c=['door',_0x55a78e(0x18c),_0x55a78e(0x1be),'fenster','griff',_0x55a78e(0x17b),'lock',_0x55a78e(0x1d3)]['some'](_0x3d7c03=>_0x3e2a3c['includes'](_0x3d7c03)),_0x1d6f72=[_0x55a78e(0x181),_0x55a78e(0x1bd),_0x55a78e(0x188),_0x55a78e(0x172),_0x55a78e(0x187),_0x55a78e(0x171)][_0x55a78e(0x1da)](_0x2349d0=>_0x3e2a3c[_0x55a78e(0x19e)](_0x2349d0)),_0x2081ae=[_0x55a78e(0x1cf),_0x55a78e(0x1ab),'präsenz',_0x55a78e(0x194),'occupancy'][_0x55a78e(0x1da)](_0x7ed1eb=>_0x3e2a3c[_0x55a78e(0x19e)](_0x7ed1eb));if(_0x4875a2[_0x55a78e(0x1af)]&&(_0x39950c||_0x1d6f72||_0x2081ae)){const _0x563bdc=_0x421fe9===!![]||typeof _0x421fe9===_0x55a78e(0x184)&&_0x421fe9>0x0,_0x277a14=_0x39950c&&!_0x563bdc&&_0x1a6a56!==undefined&&_0x1a6a56!=_0x421fe9;if(_0x563bdc||_0x277a14){const _0x4eae8b=_0x375f34['lastTrackerEventTime']||_0x2b7396,_0xb9b246=(_0x2b7396-_0x4eae8b)/0x3e8;_0x375f34[_0x55a78e(0x18e)]=_0x2b7396,_0x375f34[_0x55a78e(0x17a)](_0x55a78e(0x1d1),{'room':_0x4875a2[_0x55a78e(0x1af)],'dt':_0xb9b246});}}}return _0x8e6be4;}module['exports']={'processSensorEvent':processSensorEvent,'getOutsideTemperatureNumeric':getOutsideTemperatureNumeric,'setPresence':setPresence,'abortExitTimer':abortExitTimer,'startExitTimer':startExitTimer};