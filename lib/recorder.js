const a5_0x5d82d5=a5_0x3574;(function(_0x48e462,_0xd8476){const _0x32c542=a5_0x3574,_0x4e1dfb=_0x48e462();while(!![]){try{const _0x1ae570=-parseInt(_0x32c542(0x12c))/0x1*(-parseInt(_0x32c542(0x180))/0x2)+-parseInt(_0x32c542(0x18f))/0x3*(parseInt(_0x32c542(0x142))/0x4)+parseInt(_0x32c542(0x16e))/0x5+parseInt(_0x32c542(0x196))/0x6*(-parseInt(_0x32c542(0x146))/0x7)+parseInt(_0x32c542(0x14f))/0x8*(-parseInt(_0x32c542(0x15a))/0x9)+parseInt(_0x32c542(0x127))/0xa+parseInt(_0x32c542(0x191))/0xb*(parseInt(_0x32c542(0x157))/0xc);if(_0x1ae570===_0xd8476)break;else _0x4e1dfb['push'](_0x4e1dfb['shift']());}catch(_0x53de59){_0x4e1dfb['push'](_0x4e1dfb['shift']());}}}(a5_0x217c,0xe4cd4));const a5_0x44b894=(function(){let _0x468c39=!![];return function(_0x753bcd,_0x2c4e17){const _0x27bdd3=_0x468c39?function(){const _0x560a4c=a5_0x3574;if(_0x2c4e17){const _0x160221=_0x2c4e17[_0x560a4c(0x12a)](_0x753bcd,arguments);return _0x2c4e17=null,_0x160221;}}:function(){};return _0x468c39=![],_0x27bdd3;};}()),a5_0x1158a6=a5_0x44b894(this,function(){const _0x26f0bb=a5_0x3574;return a5_0x1158a6[_0x26f0bb(0x181)]()[_0x26f0bb(0x167)]('(((.+)+)+)+$')[_0x26f0bb(0x181)]()['constructor'](a5_0x1158a6)[_0x26f0bb(0x167)](_0x26f0bb(0x158));});a5_0x1158a6();'use strict';const HISTORY_MAX_SIZE=0x32,RAW_LOG_MAX_SIZE=0x9c4,THERMO_LOG_SIZE=0x3e8,SEQUENCE_TIMEOUT_MS=0x5*0x3c*0x3e8,MAX_TRAINING_SET_SIZE=0x1f4,EXIT_TIMER_MINUTES=0xf,EXIT_GRACE_PERIOD_SECONDS=0x1e;let activeSequence=[],sequenceTimer=null;async function getOutsideTemperatureNumeric(_0x530b21){const _0x141048=a5_0x3574;if(_0x530b21[_0x141048(0x15d)][_0x141048(0x13e)])try{const _0x5164b6=await _0x530b21[_0x141048(0x135)](_0x530b21[_0x141048(0x15d)][_0x141048(0x13e)]);if(_0x5164b6&&_0x5164b6['val']!==undefined&&_0x5164b6[_0x141048(0x133)]!==null)return parseFloat(_0x5164b6[_0x141048(0x133)]);}catch(_0x36fa91){}const _0x581a67=_0x530b21[_0x141048(0x15d)][_0x141048(0x172)];if(!_0x530b21[_0x141048(0x15d)][_0x141048(0x164)]||!_0x581a67)return null;try{let _0x5b4793='';if(_0x581a67[_0x141048(0x151)]('accuweather'))_0x5b4793=_0x581a67+_0x141048(0x138);else{if(_0x581a67[_0x141048(0x151)]('daswetter'))_0x5b4793=_0x581a67+_0x141048(0x183);else{if(_0x581a67[_0x141048(0x151)](_0x141048(0x153)))_0x5b4793=_0x581a67+'.forecast.current.temperature';else{if(_0x581a67[_0x141048(0x151)]('weatherunderground'))_0x5b4793=_0x581a67+_0x141048(0x177);}}}if(_0x5b4793){const _0x20378b=await _0x530b21['getForeignStateAsync'](_0x5b4793);if(_0x20378b&&_0x20378b[_0x141048(0x133)]!==undefined&&_0x20378b[_0x141048(0x133)]!==null)return parseFloat(_0x20378b[_0x141048(0x133)]);}}catch(_0x4148fe){}return null;}async function recordThermodynamics(_0x3ec873,_0x2ade8d,_0x41e8a5,_0x38b522){const _0x379e28=a5_0x3574,_0x436e1b=await getOutsideTemperatureNumeric(_0x3ec873);if(_0x436e1b===null)return;let _0x18606b=0x0,_0x41700b=![];if(_0x3ec873[_0x379e28(0x15d)]['valveMapping'])try{let _0x1b7176=_0x3ec873['config'][_0x379e28(0x140)];if(typeof _0x1b7176==='string')_0x1b7176=JSON['parse'](_0x1b7176);if(_0x1b7176[_0x2ade8d]){const _0x12dd51=_0x1b7176[_0x2ade8d],_0x5816f9=await _0x3ec873['getForeignStateAsync'](_0x12dd51);if(_0x5816f9&&_0x5816f9[_0x379e28(0x133)]!==null&&_0x5816f9[_0x379e28(0x133)]!==undefined){let _0x16a8f3=Number(_0x5816f9[_0x379e28(0x133)]);if(_0x16a8f3<=1.05&&!_0x12dd51[_0x379e28(0x151)](_0x379e28(0x13c))&&!_0x12dd51['includes'](_0x379e28(0x134)))_0x16a8f3=_0x16a8f3*0x64;_0x18606b=Math['round'](_0x16a8f3),_0x41700b=!![];}}}catch(_0x155b86){}if(!_0x41700b){const _0xe4f53f=[{'from':_0x379e28(0x187),'to':_0x379e28(0x152)},{'from':'.1.ACTUAL_TEMPERATURE','to':'.1.VALVE_STATE'},{'from':_0x379e28(0x17f),'to':_0x379e28(0x130)},{'from':_0x379e28(0x16b),'to':_0x379e28(0x145)},{'from':_0x379e28(0x170),'to':_0x379e28(0x17b)},{'from':_0x379e28(0x149),'to':_0x379e28(0x18c)}];for(const _0x24d7a8 of _0xe4f53f){if(_0x2ade8d[_0x379e28(0x151)](_0x24d7a8[_0x379e28(0x178)])){const _0xa38b11=_0x2ade8d[_0x379e28(0x144)](_0x24d7a8[_0x379e28(0x178)],_0x24d7a8['to']);try{const _0x34a5a3=await _0x3ec873['getForeignStateAsync'](_0xa38b11);if(_0x34a5a3&&_0x34a5a3['val']!==null&&_0x34a5a3[_0x379e28(0x133)]!==undefined){let _0xcfb0a6=Number(_0x34a5a3[_0x379e28(0x133)]);if(typeof _0xcfb0a6===_0x379e28(0x165)){if(_0xcfb0a6<=1.05&&_0x24d7a8['to'][_0x379e28(0x151)](_0x379e28(0x12f)))_0xcfb0a6=_0xcfb0a6*0x64;_0x18606b=Math[_0x379e28(0x168)](_0xcfb0a6),_0x41700b=!![];break;}}}catch(_0x1c1f2f){}}}}const _0x43cba5=await _0x3ec873[_0x379e28(0x16f)](_0x379e28(0x18b));let _0x45ed15=[];if(_0x43cba5&&_0x43cba5[_0x379e28(0x133)])try{_0x45ed15=JSON[_0x379e28(0x17e)](_0x43cba5[_0x379e28(0x133)]);}catch(_0x676bf3){}_0x45ed15['push']({'ts':Date[_0x379e28(0x16c)](),'room':_0x38b522||_0x379e28(0x15f),'t_in':_0x41e8a5,'t_out':_0x436e1b,'valve':_0x18606b});if(_0x45ed15[_0x379e28(0x188)]>THERMO_LOG_SIZE)_0x45ed15[_0x379e28(0x163)]();await _0x3ec873[_0x379e28(0x192)](_0x379e28(0x18b),{'val':JSON['stringify'](_0x45ed15),'ack':!![]});}function a5_0x3574(_0x1cb4c4,_0x594be7){const _0x19b279=a5_0x217c();return a5_0x3574=function(_0x1158a6,_0x44b894){_0x1158a6=_0x1158a6-0x127;let _0x217cba=_0x19b279[_0x1158a6];return _0x217cba;},a5_0x3574(_0x1cb4c4,_0x594be7);}async function saveCompletedSequence(_0x345237){const _0x223d32=a5_0x3574;try{const _0x3eff25=await _0x345237[_0x223d32(0x16f)](_0x223d32(0x129));let _0x5db583=[];if(_0x3eff25&&_0x3eff25[_0x223d32(0x133)])try{_0x5db583=JSON[_0x223d32(0x17e)](_0x3eff25['val']);}catch(_0x31289d){}const _0x1137f1=activeSequence[0x0]['ts'],_0x32b7c8=activeSequence[_0x223d32(0x176)](_0x367a91=>({'loc':_0x367a91[_0x223d32(0x169)],'t_delta':Math[_0x223d32(0x168)]((_0x367a91['ts']-_0x1137f1)/0x3e8)})),_0x3fdd15={'timestamp':new Date(_0x1137f1)[_0x223d32(0x160)](),'steps':_0x32b7c8,'duration':Math['round']((activeSequence[activeSequence['length']-0x1]['ts']-_0x1137f1)/0x3e8),'daytime':new Date(_0x1137f1)[_0x223d32(0x17d)]()};_0x5db583[_0x223d32(0x13a)](_0x3fdd15);if(_0x5db583[_0x223d32(0x188)]>MAX_TRAINING_SET_SIZE)_0x5db583[_0x223d32(0x163)]();await _0x345237[_0x223d32(0x192)](_0x223d32(0x129),{'val':JSON[_0x223d32(0x13d)](_0x5db583),'ack':!![]}),_0x345237[_0x223d32(0x14e)]&&_0x345237[_0x223d32(0x171)]&&_0x345237[_0x223d32(0x171)](_0x223d32(0x12e),{'sequence':_0x3fdd15});}catch(_0x23ffaf){_0x345237[_0x223d32(0x161)][_0x223d32(0x194)](_0x223d32(0x150)+_0x23ffaf[_0x223d32(0x193)]);}}function a5_0x217c(){const _0x3ad703=['klima','Unknown','toISOString','log','events.lastEvent','shift','useWeather','number','normal','search','round','loc','eventHistory','.ACTUAL_TEMPERATURE','now','temperatur','4011430UVgqaP','getStateAsync','temperature','sendToPythonWrapper','weatherInstance','currentSystemMode','light','griff','map','.forecast.current.temp','from','lastTrackerEventTime','occupancy','level','sensorLastValues','getHours','parse','.1.TEMPERATURE','6782IyGODl','toString','SIMULATE_SIGNAL','.NextHours.Location_1.Day_1.current.temp_value','location','toLowerCase','schalter','.1.ACTUAL_TEMPERATURE','length','type','dimmer','LTM.trainingData.thermodynamics','Valve','switch','LTM.rawEventLog','3iudwJx','fenster','446127xflEei','setStateAsync','message','error','door','6648vFFiur','12340360ThfTyf','window','LTM.trainingData.sequences','apply','exitTimer','265hkAiVV','präsenz','ANALYZE_SEQUENCE','LEVEL','.4.VALVE_STATE','presence','debug','val','STATE','getForeignStateAsync','isPresent','motion','.Current.Temperature','exitGraceTimer','push','isGracePeriodActive','STATUS','stringify','outdoorSensorId','[RECORDER]\x20Ignored\x20implausible\x20temperature:\x20','valveMapping','value','2705108EPPAZH','lock','replace','.LEVEL','11256Uzfhds','tür','TRACK_EVENT','Temperature','licht','bewegung','logDuplicates','some','isProVersion','4105536qdsywh','[RECORDER]\x20Error:\x20','includes','.1.LEVEL','openweathermap','unshift','rawEventLog','handle','288TWUHsT','(((.+)+)+)+$','exports','9EBGlFd','isExit','heizung','config'];a5_0x217c=function(){return _0x3ad703;};return a5_0x217c();}async function recordSequence(_0x363bec,_0x4b7b89){const _0x51c3b2=a5_0x3574,_0x5845ac=(_0x4b7b89[_0x51c3b2(0x189)]||'')[_0x51c3b2(0x185)](),_0x53c1f7=[_0x51c3b2(0x137),_0x51c3b2(0x14b),_0x51c3b2(0x12d),_0x51c3b2(0x131),_0x51c3b2(0x17a),'door',_0x51c3b2(0x147),'window',_0x51c3b2(0x190),'contact','kontakt',_0x51c3b2(0x174),_0x51c3b2(0x14a),_0x51c3b2(0x18d),_0x51c3b2(0x186),_0x51c3b2(0x18a),'lampe'];if(!_0x53c1f7[_0x51c3b2(0x14d)](_0x240e31=>_0x5845ac[_0x51c3b2(0x151)](_0x240e31)))return;if(!_0x4b7b89[_0x51c3b2(0x141)])return;if(sequenceTimer)clearTimeout(sequenceTimer);activeSequence[_0x51c3b2(0x13a)]({'loc':_0x4b7b89['location']||_0x51c3b2(0x15f),'id':_0x4b7b89['id'],'ts':Date['now']()}),sequenceTimer=setTimeout(async()=>{const _0x5e9d08=_0x51c3b2;if(activeSequence[_0x5e9d08(0x188)]>0x1)await saveCompletedSequence(_0x363bec);activeSequence=[];},SEQUENCE_TIMEOUT_MS);}function startExitTimer(_0xd26461){const _0x21173d=a5_0x3574;abortExitTimer(_0xd26461),_0xd26461['isGracePeriodActive']=!![],_0xd26461[_0x21173d(0x139)]=setTimeout(()=>{_0xd26461['isGracePeriodActive']=![];},EXIT_GRACE_PERIOD_SECONDS*0x3e8),_0xd26461[_0x21173d(0x12b)]=setTimeout(()=>{const _0x43317f=_0x21173d;setPresence(_0xd26461,![]),_0xd26461[_0x43317f(0x12b)]=null;},EXIT_TIMER_MINUTES*0x3c*0x3e8);}function abortExitTimer(_0x134074){const _0x1993f4=a5_0x3574;if(_0x134074['exitTimer'])clearTimeout(_0x134074['exitTimer']);if(_0x134074[_0x1993f4(0x139)])clearTimeout(_0x134074[_0x1993f4(0x139)]);_0x134074['exitTimer']=null,_0x134074[_0x1993f4(0x139)]=null,_0x134074[_0x1993f4(0x13b)]=![];}async function setPresence(_0x3cf3ff,_0x53b121){const _0x427781=a5_0x3574;if(_0x3cf3ff[_0x427781(0x136)]===_0x53b121)return;_0x3cf3ff['isPresent']=_0x53b121,await _0x3cf3ff[_0x427781(0x192)]('system.isPresent',{'val':_0x53b121,'ack':!![]});}async function processSensorEvent(_0x320cb2,_0xbb378b,_0x5def97,_0x402921){const _0x4f6072=a5_0x3574;if(!_0x402921)return null;const _0x2d5519=_0x5def97[_0x4f6072(0x133)],_0x1cd665=Date[_0x4f6072(0x16c)](),_0x5a31eb=_0x320cb2[_0x4f6072(0x17c)][_0xbb378b],_0x1783f2=(_0x402921[_0x4f6072(0x189)]||'')[_0x4f6072(0x185)](),_0x50801b=_0x1783f2[_0x4f6072(0x151)](_0x4f6072(0x170))||_0x1783f2['includes'](_0x4f6072(0x16d))||_0x1783f2[_0x4f6072(0x151)](_0x4f6072(0x15e))||_0x1783f2['includes'](_0x4f6072(0x15c))||_0x1783f2[_0x4f6072(0x151)]('thermostat');if(_0x50801b&&typeof _0x2d5519==='number'){if(_0x2d5519>0x50||_0x2d5519<-0x32)return _0x320cb2['log'][_0x4f6072(0x132)](_0x4f6072(0x13f)+_0x2d5519+'\x20from\x20'+_0xbb378b),null;}_0x320cb2[_0x4f6072(0x17c)][_0xbb378b]=_0x2d5519;if(!_0x402921[_0x4f6072(0x14c)]&&_0x5a31eb!=undefined&&_0x5a31eb==_0x2d5519)return null;_0x320cb2[_0x4f6072(0x14e)]&&_0x50801b&&recordThermodynamics(_0x320cb2,_0xbb378b,_0x2d5519,_0x402921['location']);const _0x2efdd6={'timestamp':_0x1cd665,'id':_0xbb378b,'name':_0x402921['name'],'type':_0x402921[_0x4f6072(0x189)],'location':_0x402921[_0x4f6072(0x184)],'value':_0x2d5519};_0x320cb2[_0x4f6072(0x16a)][_0x4f6072(0x154)](_0x2efdd6);if(_0x320cb2[_0x4f6072(0x16a)]['length']>HISTORY_MAX_SIZE)_0x320cb2[_0x4f6072(0x16a)]['pop']();await _0x320cb2[_0x4f6072(0x192)](_0x4f6072(0x162),{'val':JSON[_0x4f6072(0x13d)](_0x2efdd6),'ack':!![]}),await _0x320cb2[_0x4f6072(0x192)]('events.history',{'val':JSON[_0x4f6072(0x13d)](_0x320cb2[_0x4f6072(0x16a)]),'ack':!![]});if(_0x320cb2[_0x4f6072(0x14e)]){_0x320cb2[_0x4f6072(0x155)][_0x4f6072(0x13a)](_0x2efdd6);if(_0x320cb2['rawEventLog']['length']>RAW_LOG_MAX_SIZE)_0x320cb2[_0x4f6072(0x155)]['splice'](0x0,_0x320cb2[_0x4f6072(0x155)][_0x4f6072(0x188)]-RAW_LOG_MAX_SIZE);await _0x320cb2[_0x4f6072(0x192)](_0x4f6072(0x18e),{'val':JSON[_0x4f6072(0x13d)](_0x320cb2[_0x4f6072(0x155)]),'ack':!![]}),recordSequence(_0x320cb2,_0x2efdd6);}if(_0x402921[_0x4f6072(0x15b)]&&_0x2d5519===!![]){if(_0x320cb2[_0x4f6072(0x136)]&&!_0x320cb2[_0x4f6072(0x13b)])startExitTimer(_0x320cb2);else{if(!_0x320cb2[_0x4f6072(0x136)])setPresence(_0x320cb2,!![]);}}else{if(_0x402921['type']===_0x4f6072(0x137)&&_0x2d5519===!![]){if(_0x320cb2[_0x4f6072(0x12b)])abortExitTimer(_0x320cb2);if(!_0x320cb2['isPresent']&&_0x320cb2[_0x4f6072(0x173)]===_0x4f6072(0x166))setPresence(_0x320cb2,!![]);}}if(_0x320cb2['isProVersion']&&_0x320cb2['sendToPythonWrapper']){_0x402921[_0x4f6072(0x189)]===_0x4f6072(0x137)&&_0x2d5519===!![]&&_0x402921[_0x4f6072(0x184)]&&_0x320cb2['sendToPythonWrapper'](_0x4f6072(0x182),{'room':_0x402921[_0x4f6072(0x184)]});const _0xe1000e=[_0x4f6072(0x195),_0x4f6072(0x147),_0x4f6072(0x128),_0x4f6072(0x190),_0x4f6072(0x175),_0x4f6072(0x156),_0x4f6072(0x143),'schloss'][_0x4f6072(0x14d)](_0x110bb5=>_0x1783f2['includes'](_0x110bb5)),_0x39e889=[_0x4f6072(0x174),'licht',_0x4f6072(0x18d),_0x4f6072(0x186),_0x4f6072(0x18a),'lampe']['some'](_0x116598=>_0x1783f2[_0x4f6072(0x151)](_0x116598)),_0x1ee7e4=[_0x4f6072(0x137),'bewegung','präsenz',_0x4f6072(0x131),_0x4f6072(0x17a)]['some'](_0x6c78df=>_0x1783f2[_0x4f6072(0x151)](_0x6c78df));if(_0x402921['location']&&(_0xe1000e||_0x39e889||_0x1ee7e4)){const _0x3ad379=_0x2d5519===!![]||typeof _0x2d5519===_0x4f6072(0x165)&&_0x2d5519>0x0,_0x226fb9=_0xe1000e&&!_0x3ad379&&_0x5a31eb!==undefined&&_0x5a31eb!=_0x2d5519;if(_0x3ad379||_0x226fb9){const _0x5a0aab=_0x320cb2[_0x4f6072(0x179)]||_0x1cd665,_0x3380c1=(_0x1cd665-_0x5a0aab)/0x3e8;_0x320cb2['lastTrackerEventTime']=_0x1cd665,_0x320cb2[_0x4f6072(0x171)](_0x4f6072(0x148),{'room':_0x402921['location'],'dt':_0x3380c1});}}}return _0x2efdd6;}module[a5_0x5d82d5(0x159)]={'processSensorEvent':processSensorEvent,'getOutsideTemperatureNumeric':getOutsideTemperatureNumeric,'setPresence':setPresence,'abortExitTimer':abortExitTimer,'startExitTimer':startExitTimer};