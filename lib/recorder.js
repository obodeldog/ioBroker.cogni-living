const a5_0x342c65=a5_0x1cee;(function(_0xbe8718,_0xd22bea){const _0x22038e=a5_0x1cee,_0x13e108=_0xbe8718();while(!![]){try{const _0x46c9a1=-parseInt(_0x22038e(0x1fd))/0x1*(parseInt(_0x22038e(0x247))/0x2)+parseInt(_0x22038e(0x229))/0x3*(-parseInt(_0x22038e(0x20a))/0x4)+-parseInt(_0x22038e(0x1fb))/0x5+-parseInt(_0x22038e(0x233))/0x6*(-parseInt(_0x22038e(0x1e6))/0x7)+parseInt(_0x22038e(0x20f))/0x8+parseInt(_0x22038e(0x23e))/0x9+parseInt(_0x22038e(0x1f7))/0xa;if(_0x46c9a1===_0xd22bea)break;else _0x13e108['push'](_0x13e108['shift']());}catch(_0x19a764){_0x13e108['push'](_0x13e108['shift']());}}}(a5_0x5a88,0xc0c2c));const a5_0x30dca6=(function(){let _0xa51673=!![];return function(_0x437a98,_0x2b2d45){const _0x50ca9e=_0xa51673?function(){const _0x51d97f=a5_0x1cee;if(_0x2b2d45){const _0x59c5de=_0x2b2d45[_0x51d97f(0x223)](_0x437a98,arguments);return _0x2b2d45=null,_0x59c5de;}}:function(){};return _0xa51673=![],_0x50ca9e;};}()),a5_0x39cf17=a5_0x30dca6(this,function(){const _0x15135b=a5_0x1cee;return a5_0x39cf17[_0x15135b(0x244)]()[_0x15135b(0x245)](_0x15135b(0x22c))['toString']()[_0x15135b(0x242)](a5_0x39cf17)[_0x15135b(0x245)](_0x15135b(0x22c));});a5_0x39cf17();'use strict';const HISTORY_MAX_SIZE=0x32,RAW_LOG_MAX_SIZE=0x9c4,THERMO_LOG_SIZE=0x3e8,SEQUENCE_TIMEOUT_MS=0x5*0x3c*0x3e8,MAX_TRAINING_SET_SIZE=0x1f4,EXIT_TIMER_MINUTES=0xf,EXIT_GRACE_PERIOD_SECONDS=0x1e;let activeSequence=[],sequenceTimer=null;async function getOutsideTemperatureNumeric(_0x449dbe){const _0x326a98=a5_0x1cee;if(_0x449dbe['config']['outdoorSensorId'])try{const _0xec200=await _0x449dbe['getForeignStateAsync'](_0x449dbe['config'][_0x326a98(0x21b)]);if(_0xec200&&_0xec200[_0x326a98(0x210)]!==undefined&&_0xec200[_0x326a98(0x210)]!==null)return parseFloat(_0xec200['val']);}catch(_0x15e4c6){}const _0x296921=_0x449dbe[_0x326a98(0x226)][_0x326a98(0x1ef)];if(!_0x449dbe[_0x326a98(0x226)][_0x326a98(0x220)]||!_0x296921)return null;try{let _0x362cea='';if(_0x296921[_0x326a98(0x23a)](_0x326a98(0x20d)))_0x362cea=_0x296921+_0x326a98(0x234);else{if(_0x296921[_0x326a98(0x23a)]('daswetter'))_0x362cea=_0x296921+_0x326a98(0x200);else{if(_0x296921[_0x326a98(0x23a)]('openweathermap'))_0x362cea=_0x296921+_0x326a98(0x1e9);else{if(_0x296921[_0x326a98(0x23a)](_0x326a98(0x21a)))_0x362cea=_0x296921+'.forecast.current.temp';}}}if(_0x362cea){const _0x1d7e26=await _0x449dbe[_0x326a98(0x249)](_0x362cea);if(_0x1d7e26&&_0x1d7e26['val']!==undefined&&_0x1d7e26[_0x326a98(0x210)]!==null)return parseFloat(_0x1d7e26[_0x326a98(0x210)]);}}catch(_0x75be99){}return null;}function a5_0x1cee(_0x55ea40,_0x1c1143){const _0x40c81b=a5_0x5a88();return a5_0x1cee=function(_0x39cf17,_0x30dca6){_0x39cf17=_0x39cf17-0x1e0;let _0x5a88eb=_0x40c81b[_0x39cf17];return _0x5a88eb;},a5_0x1cee(_0x55ea40,_0x1c1143);}async function recordThermodynamics(_0x34965e,_0xd7c1b5,_0x250559,_0x7c0268){const _0x141a37=a5_0x1cee,_0x1ef8b8=await getOutsideTemperatureNumeric(_0x34965e);if(_0x1ef8b8===null)return;let _0x123826=0x0,_0xcd216=![];if(_0x34965e[_0x141a37(0x226)]['valveMapping'])try{let _0x21254a=_0x34965e[_0x141a37(0x226)][_0x141a37(0x214)];if(typeof _0x21254a===_0x141a37(0x1fc))_0x21254a=JSON[_0x141a37(0x248)](_0x21254a);if(_0x21254a[_0xd7c1b5]){const _0x5c01de=_0x21254a[_0xd7c1b5],_0x1da3a2=await _0x34965e[_0x141a37(0x249)](_0x5c01de);if(_0x1da3a2&&_0x1da3a2['val']!==null&&_0x1da3a2[_0x141a37(0x210)]!==undefined){let _0xe3f238=Number(_0x1da3a2[_0x141a37(0x210)]);if(_0xe3f238<=1.05&&!_0x5c01de['includes'](_0x141a37(0x1ed))&&!_0x5c01de['includes']('STATE'))_0xe3f238=_0xe3f238*0x64;_0x123826=Math[_0x141a37(0x24b)](_0xe3f238),_0xcd216=!![];}}}catch(_0x212c13){}if(!_0xcd216){const _0x1af3b7=[{'from':'.1.ACTUAL_TEMPERATURE','to':_0x141a37(0x204)},{'from':_0x141a37(0x216),'to':'.1.VALVE_STATE'},{'from':_0x141a37(0x1ff),'to':_0x141a37(0x1f1)},{'from':_0x141a37(0x20e),'to':_0x141a37(0x1f4)},{'from':_0x141a37(0x24c),'to':_0x141a37(0x243)},{'from':'Temperature','to':_0x141a37(0x21d)}];for(const _0x586cd4 of _0x1af3b7){if(_0xd7c1b5[_0x141a37(0x23a)](_0x586cd4[_0x141a37(0x21c)])){const _0x239ff7=_0xd7c1b5[_0x141a37(0x20b)](_0x586cd4[_0x141a37(0x21c)],_0x586cd4['to']);try{const _0x81c15b=await _0x34965e[_0x141a37(0x249)](_0x239ff7);if(_0x81c15b&&_0x81c15b[_0x141a37(0x210)]!==null&&_0x81c15b['val']!==undefined){let _0xd1a24e=Number(_0x81c15b['val']);if(typeof _0xd1a24e===_0x141a37(0x1e0)){if(_0xd1a24e<=1.05&&_0x586cd4['to'][_0x141a37(0x23a)](_0x141a37(0x246)))_0xd1a24e=_0xd1a24e*0x64;_0x123826=Math[_0x141a37(0x24b)](_0xd1a24e),_0xcd216=!![];break;}}}catch(_0xeb4ddd){}}}}const _0x29a314=await _0x34965e['getStateAsync'](_0x141a37(0x1e7));let _0x424d8d=[];if(_0x29a314&&_0x29a314[_0x141a37(0x210)])try{_0x424d8d=JSON['parse'](_0x29a314[_0x141a37(0x210)]);}catch(_0x84c613){}_0x424d8d[_0x141a37(0x1e1)]({'ts':Date[_0x141a37(0x1e4)](),'room':_0x7c0268||_0x141a37(0x241),'t_in':_0x250559,'t_out':_0x1ef8b8,'valve':_0x123826});if(_0x424d8d[_0x141a37(0x203)]>THERMO_LOG_SIZE)_0x424d8d[_0x141a37(0x231)]();await _0x34965e[_0x141a37(0x23d)]('LTM.trainingData.thermodynamics',{'val':JSON[_0x141a37(0x1e8)](_0x424d8d),'ack':!![]});}async function saveCompletedSequence(_0x364dbb){const _0x3a2f02=a5_0x1cee;try{const _0x35480a=await _0x364dbb[_0x3a2f02(0x22f)](_0x3a2f02(0x228));let _0x2479be=[];if(_0x35480a&&_0x35480a[_0x3a2f02(0x210)])try{_0x2479be=JSON['parse'](_0x35480a[_0x3a2f02(0x210)]);}catch(_0x4c02de){}const _0x54a846=activeSequence[0x0]['ts'],_0x4defd5=activeSequence[_0x3a2f02(0x208)](_0x432319=>({'loc':_0x432319[_0x3a2f02(0x202)],'t_delta':Math['round']((_0x432319['ts']-_0x54a846)/0x3e8)})),_0x2bec04={'timestamp':new Date(_0x54a846)[_0x3a2f02(0x1f3)](),'steps':_0x4defd5,'duration':Math[_0x3a2f02(0x24b)]((activeSequence[activeSequence['length']-0x1]['ts']-_0x54a846)/0x3e8),'daytime':new Date(_0x54a846)[_0x3a2f02(0x1e3)]()};_0x2479be['push'](_0x2bec04);if(_0x2479be['length']>MAX_TRAINING_SET_SIZE)_0x2479be[_0x3a2f02(0x231)]();await _0x364dbb['setStateAsync']('LTM.trainingData.sequences',{'val':JSON['stringify'](_0x2479be),'ack':!![]}),_0x364dbb[_0x3a2f02(0x213)]&&_0x364dbb['sendToPythonWrapper']&&_0x364dbb['sendToPythonWrapper']('ANALYZE_SEQUENCE',{'sequence':_0x2bec04});}catch(_0x3ead89){_0x364dbb['log']['error'](_0x3a2f02(0x235)+_0x3ead89[_0x3a2f02(0x236)]);}}async function recordSequence(_0x158c31,_0x1d5147){const _0x5f377e=a5_0x1cee,_0x4a8027=(_0x1d5147[_0x5f377e(0x240)]||'')[_0x5f377e(0x215)](),_0x2a8af6=['motion',_0x5f377e(0x237),_0x5f377e(0x221),'presence','occupancy','door',_0x5f377e(0x212),_0x5f377e(0x207),_0x5f377e(0x1f9),_0x5f377e(0x206),_0x5f377e(0x217),_0x5f377e(0x22d),_0x5f377e(0x211),_0x5f377e(0x225),_0x5f377e(0x201),_0x5f377e(0x1f6),_0x5f377e(0x1e5)];if(!_0x2a8af6[_0x5f377e(0x22b)](_0x24c013=>_0x4a8027['includes'](_0x24c013)))return;if(!_0x1d5147['value'])return;if(sequenceTimer)clearTimeout(sequenceTimer);activeSequence[_0x5f377e(0x1e1)]({'loc':_0x1d5147[_0x5f377e(0x1f0)]||_0x5f377e(0x241),'id':_0x1d5147['id'],'ts':Date[_0x5f377e(0x1e4)]()}),sequenceTimer=setTimeout(async()=>{const _0x2c4859=_0x5f377e;if(activeSequence[_0x2c4859(0x203)]>0x1)await saveCompletedSequence(_0x158c31);activeSequence=[];},SEQUENCE_TIMEOUT_MS);}function startExitTimer(_0x46c10e){const _0x3c32c7=a5_0x1cee;abortExitTimer(_0x46c10e),_0x46c10e[_0x3c32c7(0x1ea)]=!![],_0x46c10e[_0x3c32c7(0x1ec)]=setTimeout(()=>{const _0x4324b5=_0x3c32c7;_0x46c10e[_0x4324b5(0x1ea)]=![];},EXIT_GRACE_PERIOD_SECONDS*0x3e8),_0x46c10e[_0x3c32c7(0x218)]=setTimeout(()=>{const _0x1f5a89=_0x3c32c7;setPresence(_0x46c10e,![]),_0x46c10e[_0x1f5a89(0x218)]=null;},EXIT_TIMER_MINUTES*0x3c*0x3e8);}function abortExitTimer(_0x13b241){const _0x6567fe=a5_0x1cee;if(_0x13b241[_0x6567fe(0x218)])clearTimeout(_0x13b241[_0x6567fe(0x218)]);if(_0x13b241['exitGraceTimer'])clearTimeout(_0x13b241['exitGraceTimer']);_0x13b241['exitTimer']=null,_0x13b241[_0x6567fe(0x1ec)]=null,_0x13b241[_0x6567fe(0x1ea)]=![];}async function setPresence(_0x19203d,_0x297e33){const _0x457709=a5_0x1cee;if(_0x19203d[_0x457709(0x1e2)]===_0x297e33)return;_0x19203d[_0x457709(0x1e2)]=_0x297e33,await _0x19203d[_0x457709(0x23d)](_0x457709(0x23b),{'val':_0x297e33,'ack':!![]});}function a5_0x5a88(){const _0x206172=['shift','presence','942xIcduv','.Current.Temperature','[RECORDER]\x20Error:\x20','message','bewegung','rawEventLog','normal','includes','system.isPresent','log','setStateAsync','6133752fLevxX','eventHistory','type','Unknown','constructor','level','toString','search','LEVEL','1112AastBr','parse','getForeignStateAsync','lastTrackerEventTime','round','temperature','number','push','isPresent','getHours','now','lampe','17381ccbKoR','LTM.trainingData.thermodynamics','stringify','.forecast.current.temperature','isGracePeriodActive','events.history','exitGraceTimer','STATUS','sensorLastValues','weatherInstance','location','.4.VALVE_STATE','lock','toISOString','.LEVEL','currentSystemMode','dimmer','11002740wAJbbR','\x20from\x20','fenster','LTM.rawEventLog','1153945DfGYYm','string','383KaQrOn','motion','.1.TEMPERATURE','.NextHours.Location_1.Day_1.current.temp_value','schalter','loc','length','.1.LEVEL','handle','contact','window','map','pop','28VifqPt','replace','exports','accuweather','.ACTUAL_TEMPERATURE','1221432iQGLgh','val','licht','tür','isProVersion','valveMapping','toLowerCase','.1.ACTUAL_TEMPERATURE','kontakt','exitTimer','temperatur','weatherunderground','outdoorSensorId','from','Valve','SIMULATE_SIGNAL','name','useWeather','präsenz','thermostat','apply','sendToPythonWrapper','switch','config','isExit','LTM.trainingData.sequences','467583AgAadN','debug','some','(((.+)+)+)+$','light','griff','getStateAsync','heizung'];a5_0x5a88=function(){return _0x206172;};return a5_0x5a88();}async function processSensorEvent(_0x45a094,_0x381199,_0x4e9e30,_0x1587d2){const _0x40b94f=a5_0x1cee;if(!_0x1587d2)return null;const _0x347595=_0x4e9e30[_0x40b94f(0x210)],_0x5ccfd0=Date['now'](),_0x5afbdb=_0x45a094[_0x40b94f(0x1ee)][_0x381199],_0x137189=(_0x1587d2[_0x40b94f(0x240)]||'')[_0x40b94f(0x215)](),_0x37ef75=_0x137189[_0x40b94f(0x23a)](_0x40b94f(0x24c))||_0x137189[_0x40b94f(0x23a)](_0x40b94f(0x219))||_0x137189[_0x40b94f(0x23a)]('klima')||_0x137189['includes'](_0x40b94f(0x230))||_0x137189['includes'](_0x40b94f(0x222));if(_0x37ef75&&typeof _0x347595===_0x40b94f(0x1e0)){if(_0x347595>0x50||_0x347595<-0x32)return _0x45a094[_0x40b94f(0x23c)][_0x40b94f(0x22a)]('[RECORDER]\x20Ignored\x20implausible\x20temperature:\x20'+_0x347595+_0x40b94f(0x1f8)+_0x381199),null;}_0x45a094[_0x40b94f(0x1ee)][_0x381199]=_0x347595;if(!_0x1587d2['logDuplicates']&&_0x5afbdb!=undefined&&_0x5afbdb==_0x347595)return null;_0x45a094[_0x40b94f(0x213)]&&_0x37ef75&&recordThermodynamics(_0x45a094,_0x381199,_0x347595,_0x1587d2[_0x40b94f(0x1f0)]);const _0x20229d={'timestamp':_0x5ccfd0,'id':_0x381199,'name':_0x1587d2[_0x40b94f(0x21f)],'type':_0x1587d2['type'],'location':_0x1587d2[_0x40b94f(0x1f0)],'value':_0x347595};_0x45a094[_0x40b94f(0x23f)]['unshift'](_0x20229d);if(_0x45a094[_0x40b94f(0x23f)]['length']>HISTORY_MAX_SIZE)_0x45a094['eventHistory'][_0x40b94f(0x209)]();await _0x45a094[_0x40b94f(0x23d)]('events.lastEvent',{'val':JSON[_0x40b94f(0x1e8)](_0x20229d),'ack':!![]}),await _0x45a094['setStateAsync'](_0x40b94f(0x1eb),{'val':JSON[_0x40b94f(0x1e8)](_0x45a094['eventHistory']),'ack':!![]});if(_0x45a094[_0x40b94f(0x213)]){_0x45a094[_0x40b94f(0x238)][_0x40b94f(0x1e1)](_0x20229d);if(_0x45a094[_0x40b94f(0x238)][_0x40b94f(0x203)]>RAW_LOG_MAX_SIZE)_0x45a094[_0x40b94f(0x238)]['splice'](0x0,_0x45a094[_0x40b94f(0x238)][_0x40b94f(0x203)]-RAW_LOG_MAX_SIZE);await _0x45a094[_0x40b94f(0x23d)](_0x40b94f(0x1fa),{'val':JSON[_0x40b94f(0x1e8)](_0x45a094['rawEventLog']),'ack':!![]}),recordSequence(_0x45a094,_0x20229d);}if(_0x1587d2[_0x40b94f(0x227)]&&_0x347595===!![]){if(_0x45a094['isPresent']&&!_0x45a094[_0x40b94f(0x1ea)])startExitTimer(_0x45a094);else{if(!_0x45a094['isPresent'])setPresence(_0x45a094,!![]);}}else{if(_0x1587d2[_0x40b94f(0x240)]==='motion'&&_0x347595===!![]){if(_0x45a094['exitTimer'])abortExitTimer(_0x45a094);if(!_0x45a094[_0x40b94f(0x1e2)]&&_0x45a094[_0x40b94f(0x1f5)]===_0x40b94f(0x239))setPresence(_0x45a094,!![]);}}if(_0x45a094[_0x40b94f(0x213)]&&_0x45a094['sendToPythonWrapper']){_0x1587d2['type']===_0x40b94f(0x1fe)&&_0x347595===!![]&&_0x1587d2[_0x40b94f(0x1f0)]&&_0x45a094['sendToPythonWrapper'](_0x40b94f(0x21e),{'room':_0x1587d2[_0x40b94f(0x1f0)]});const _0x4cbd4a=['door',_0x40b94f(0x212),'window',_0x40b94f(0x1f9),_0x40b94f(0x22e),_0x40b94f(0x205),_0x40b94f(0x1f2),'schloss'][_0x40b94f(0x22b)](_0x2aa6f9=>_0x137189['includes'](_0x2aa6f9)),_0x80e447=[_0x40b94f(0x22d),_0x40b94f(0x211),'switch','schalter','dimmer',_0x40b94f(0x1e5)][_0x40b94f(0x22b)](_0x4893a0=>_0x137189[_0x40b94f(0x23a)](_0x4893a0)),_0x4fb62a=[_0x40b94f(0x1fe),_0x40b94f(0x237),_0x40b94f(0x221),_0x40b94f(0x232),'occupancy'][_0x40b94f(0x22b)](_0x36d94a=>_0x137189[_0x40b94f(0x23a)](_0x36d94a));if(_0x1587d2[_0x40b94f(0x1f0)]&&(_0x4cbd4a||_0x80e447||_0x4fb62a)){const _0x4cb1c3=_0x347595===!![]||typeof _0x347595==='number'&&_0x347595>0x0,_0x57a265=_0x4cbd4a&&!_0x4cb1c3&&_0x5afbdb!==undefined&&_0x5afbdb!=_0x347595;if(_0x4cb1c3||_0x57a265){const _0x29c4f5=_0x45a094[_0x40b94f(0x24a)]||_0x5ccfd0,_0x56e182=(_0x5ccfd0-_0x29c4f5)/0x3e8;_0x45a094[_0x40b94f(0x24a)]=_0x5ccfd0,_0x45a094[_0x40b94f(0x224)]('TRACK_EVENT',{'room':_0x1587d2[_0x40b94f(0x1f0)],'dt':_0x56e182});}}}return _0x20229d;}module[a5_0x342c65(0x20c)]={'processSensorEvent':processSensorEvent,'getOutsideTemperatureNumeric':getOutsideTemperatureNumeric,'setPresence':setPresence,'abortExitTimer':abortExitTimer,'startExitTimer':startExitTimer};