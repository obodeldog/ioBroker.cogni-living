const a5_0x1ae09d=a5_0x1ac3;(function(_0x36b637,_0x3b4875){const _0x205968=a5_0x1ac3,_0x4aab01=_0x36b637();while(!![]){try{const _0x3755a4=parseInt(_0x205968(0x17a))/0x1+parseInt(_0x205968(0x19b))/0x2*(parseInt(_0x205968(0x17e))/0x3)+parseInt(_0x205968(0x15e))/0x4+parseInt(_0x205968(0x192))/0x5+parseInt(_0x205968(0x19d))/0x6+parseInt(_0x205968(0x171))/0x7*(parseInt(_0x205968(0x166))/0x8)+parseInt(_0x205968(0x168))/0x9*(-parseInt(_0x205968(0x194))/0xa);if(_0x3755a4===_0x3b4875)break;else _0x4aab01['push'](_0x4aab01['shift']());}catch(_0x42efbe){_0x4aab01['push'](_0x4aab01['shift']());}}}(a5_0x2028,0xc552a));const a5_0x25859b=(function(){let _0x532ac1=!![];return function(_0x4dab64,_0x10944f){const _0x4cb0d5=_0x532ac1?function(){const _0x4654ee=a5_0x1ac3;if(_0x10944f){const _0x11e774=_0x10944f[_0x4654ee(0x165)](_0x4dab64,arguments);return _0x10944f=null,_0x11e774;}}:function(){};return _0x532ac1=![],_0x4cb0d5;};}()),a5_0x3b7c77=a5_0x25859b(this,function(){const _0x119e22=a5_0x1ac3;return a5_0x3b7c77['toString']()[_0x119e22(0x183)](_0x119e22(0x179))[_0x119e22(0x154)]()[_0x119e22(0x17d)](a5_0x3b7c77)['search']('(((.+)+)+)+$');});a5_0x3b7c77();'use strict';const HISTORY_MAX_SIZE=0x32,RAW_LOG_MAX_SIZE=0x9c4,THERMO_LOG_SIZE=0x3e8,SEQUENCE_TIMEOUT_MS=0x5*0x3c*0x3e8,MAX_TRAINING_SET_SIZE=0x1f4,EXIT_TIMER_MINUTES=0xf,EXIT_GRACE_PERIOD_SECONDS=0x1e;let activeSequence=[],sequenceTimer=null;async function getOutsideTemperatureNumeric(_0x348393){const _0x4a7e43=a5_0x1ac3;if(_0x348393[_0x4a7e43(0x198)]['outdoorSensorId'])try{const _0xae89eb=await _0x348393[_0x4a7e43(0x176)](_0x348393[_0x4a7e43(0x198)][_0x4a7e43(0x18f)]);if(_0xae89eb&&_0xae89eb[_0x4a7e43(0x162)]!==undefined&&_0xae89eb[_0x4a7e43(0x162)]!==null)return parseFloat(_0xae89eb[_0x4a7e43(0x162)]);}catch(_0xc2172c){}const _0x21f1d4=_0x348393[_0x4a7e43(0x198)][_0x4a7e43(0x18a)];if(!_0x348393['config']['useWeather']||!_0x21f1d4)return null;try{let _0x2cb07d='';if(_0x21f1d4[_0x4a7e43(0x190)](_0x4a7e43(0x177)))_0x2cb07d=_0x21f1d4+_0x4a7e43(0x19e);else{if(_0x21f1d4[_0x4a7e43(0x190)](_0x4a7e43(0x14f)))_0x2cb07d=_0x21f1d4+'.NextHours.Location_1.Day_1.current.temp_value';else{if(_0x21f1d4[_0x4a7e43(0x190)]('openweathermap'))_0x2cb07d=_0x21f1d4+_0x4a7e43(0x1a1);else{if(_0x21f1d4[_0x4a7e43(0x190)]('weatherunderground'))_0x2cb07d=_0x21f1d4+'.forecast.current.temp';}}}if(_0x2cb07d){const _0x4121dd=await _0x348393[_0x4a7e43(0x176)](_0x2cb07d);if(_0x4121dd&&_0x4121dd[_0x4a7e43(0x162)]!==undefined&&_0x4121dd[_0x4a7e43(0x162)]!==null)return parseFloat(_0x4121dd['val']);}}catch(_0x4897f8){}return null;}async function recordThermodynamics(_0x37e2bb,_0x56ccab,_0x4fe358,_0x244f01){const _0x485c5a=a5_0x1ac3,_0xd296f4=await getOutsideTemperatureNumeric(_0x37e2bb);let _0x36b1f1=0x0;if(_0x56ccab[_0x485c5a(0x190)]('hm-rpc')){const _0x4743b8=[{'from':_0x485c5a(0x17b),'to':'.1.LEVEL'},{'from':_0x485c5a(0x17b),'to':'.1.VALVE_STATE'},{'from':_0x485c5a(0x160),'to':'.4.VALVE_STATE'},{'from':_0x485c5a(0x15a),'to':_0x485c5a(0x193)}];for(const _0xa16b15 of _0x4743b8){if(_0x56ccab[_0x485c5a(0x190)](_0xa16b15[_0x485c5a(0x199)])){const _0x3ff835=_0x56ccab['replace'](_0xa16b15[_0x485c5a(0x199)],_0xa16b15['to']);try{const _0x3aa9a2=await _0x37e2bb[_0x485c5a(0x176)](_0x3ff835);if(_0x3aa9a2&&_0x3aa9a2['val']!==null&&_0x3aa9a2[_0x485c5a(0x162)]!==undefined){let _0x2e5a0a=_0x3aa9a2[_0x485c5a(0x162)];typeof _0x2e5a0a===_0x485c5a(0x18d)&&_0x2e5a0a<=1.05&&_0xa16b15['to'][_0x485c5a(0x190)]('LEVEL')&&(_0x2e5a0a=_0x2e5a0a*0x64);_0x36b1f1=Math['round'](_0x2e5a0a);break;}}catch(_0x619fac){}}}}const _0x2d2d9f=await _0x37e2bb[_0x485c5a(0x170)](_0x485c5a(0x15b));let _0x4b6ec2=[];if(_0x2d2d9f&&_0x2d2d9f['val'])try{_0x4b6ec2=JSON[_0x485c5a(0x164)](_0x2d2d9f[_0x485c5a(0x162)]);}catch(_0x41c001){}_0x4b6ec2[_0x485c5a(0x158)]({'ts':Date[_0x485c5a(0x19c)](),'room':_0x244f01||'Unknown','t_in':_0x4fe358,'t_out':_0xd296f4,'valve':_0x36b1f1});if(_0x4b6ec2['length']>THERMO_LOG_SIZE)_0x4b6ec2['shift']();await _0x37e2bb['setStateAsync'](_0x485c5a(0x15b),{'val':JSON[_0x485c5a(0x16f)](_0x4b6ec2),'ack':!![]});}async function saveCompletedSequence(_0x28d88){const _0x38d349=a5_0x1ac3;try{const _0x3601ae=await _0x28d88['getStateAsync']('LTM.trainingData.sequences');let _0x48097d=[];if(_0x3601ae&&_0x3601ae[_0x38d349(0x162)])try{_0x48097d=JSON[_0x38d349(0x164)](_0x3601ae[_0x38d349(0x162)]);}catch(_0x1e61d0){}const _0xf60c36=activeSequence[0x0]['ts'],_0x22c0a0=activeSequence[_0x38d349(0x151)](_0x51faad=>({'loc':_0x51faad[_0x38d349(0x197)],'t_delta':Math['round']((_0x51faad['ts']-_0xf60c36)/0x3e8)})),_0x1986b6={'timestamp':new Date(_0xf60c36)[_0x38d349(0x185)](),'steps':_0x22c0a0,'duration':Math[_0x38d349(0x16a)]((activeSequence[activeSequence[_0x38d349(0x161)]-0x1]['ts']-_0xf60c36)/0x3e8),'daytime':new Date(_0xf60c36)[_0x38d349(0x157)]()};_0x48097d[_0x38d349(0x158)](_0x1986b6);if(_0x48097d['length']>MAX_TRAINING_SET_SIZE)_0x48097d[_0x38d349(0x18c)]();await _0x28d88['setStateAsync']('LTM.trainingData.sequences',{'val':JSON[_0x38d349(0x16f)](_0x48097d),'ack':!![]}),_0x28d88[_0x38d349(0x186)]&&_0x28d88['sendToPythonWrapper']&&_0x28d88['sendToPythonWrapper'](_0x38d349(0x15f),{'sequence':_0x1986b6});}catch(_0x345c17){_0x28d88['log']['error'](_0x38d349(0x188)+_0x345c17[_0x38d349(0x153)]);}}async function recordSequence(_0xef4143,_0x3fd2eb){const _0xd329c7=a5_0x1ac3,_0x12ccb1=(_0x3fd2eb['type']||'')['toLowerCase'](),_0x54a113=['motion',_0xd329c7(0x1a0),_0xd329c7(0x15d),_0xd329c7(0x196),_0xd329c7(0x159),_0xd329c7(0x175),_0xd329c7(0x1a2),_0xd329c7(0x163),_0xd329c7(0x169),_0xd329c7(0x180),'kontakt',_0xd329c7(0x182),'licht',_0xd329c7(0x174),'schalter','dimmer',_0xd329c7(0x187)];if(!_0x54a113[_0xd329c7(0x181)](_0xff2c6e=>_0x12ccb1[_0xd329c7(0x190)](_0xff2c6e)))return;if(!_0x3fd2eb[_0xd329c7(0x15c)])return;if(sequenceTimer)clearTimeout(sequenceTimer);activeSequence[_0xd329c7(0x158)]({'loc':_0x3fd2eb[_0xd329c7(0x18b)]||'Unknown','id':_0x3fd2eb['id'],'ts':Date[_0xd329c7(0x19c)]()}),sequenceTimer=setTimeout(async()=>{const _0x1fa5d3=_0xd329c7;if(activeSequence[_0x1fa5d3(0x161)]>0x1)await saveCompletedSequence(_0xef4143);activeSequence=[];},SEQUENCE_TIMEOUT_MS);}function startExitTimer(_0x2c227d){const _0x3a1a66=a5_0x1ac3;abortExitTimer(_0x2c227d),_0x2c227d[_0x3a1a66(0x17f)]=!![],_0x2c227d['exitGraceTimer']=setTimeout(()=>{_0x2c227d['isGracePeriodActive']=![];},EXIT_GRACE_PERIOD_SECONDS*0x3e8),_0x2c227d['exitTimer']=setTimeout(()=>{const _0x388d47=_0x3a1a66;setPresence(_0x2c227d,![]),_0x2c227d[_0x388d47(0x172)]=null;},EXIT_TIMER_MINUTES*0x3c*0x3e8);}function a5_0x1ac3(_0x5e1f60,_0x10817e){const _0x5973c1=a5_0x2028();return a5_0x1ac3=function(_0x3b7c77,_0x25859b){_0x3b7c77=_0x3b7c77-0x14f;let _0x2028af=_0x5973c1[_0x3b7c77];return _0x2028af;},a5_0x1ac3(_0x5e1f60,_0x10817e);}function abortExitTimer(_0x52b401){const _0x3442fb=a5_0x1ac3;if(_0x52b401[_0x3442fb(0x172)])clearTimeout(_0x52b401['exitTimer']);if(_0x52b401[_0x3442fb(0x167)])clearTimeout(_0x52b401['exitGraceTimer']);_0x52b401[_0x3442fb(0x172)]=null,_0x52b401[_0x3442fb(0x167)]=null,_0x52b401[_0x3442fb(0x17f)]=![];}async function setPresence(_0x3d93e0,_0x4076e8){const _0x1dd144=a5_0x1ac3;if(_0x3d93e0['isPresent']===_0x4076e8)return;_0x3d93e0[_0x1dd144(0x16e)]=_0x4076e8,await _0x3d93e0[_0x1dd144(0x16d)]('system.isPresent',{'val':_0x4076e8,'ack':!![]});}async function processSensorEvent(_0x2fae5f,_0x694a9a,_0x418b84,_0x1014d3){const _0x38d2e9=a5_0x1ac3;if(!_0x1014d3)return null;const _0x4ecc44=_0x418b84[_0x38d2e9(0x162)],_0x18622c=Date[_0x38d2e9(0x19c)](),_0xc50ba8=_0x2fae5f[_0x38d2e9(0x19f)][_0x694a9a];_0x2fae5f[_0x38d2e9(0x19f)][_0x694a9a]=_0x4ecc44;if(!_0x1014d3[_0x38d2e9(0x155)]&&_0xc50ba8!=undefined&&_0xc50ba8==_0x4ecc44)return null;const _0x16669e=(_0x1014d3[_0x38d2e9(0x17c)]||'')['toLowerCase'](),_0x75567c=_0x16669e['includes'](_0x38d2e9(0x16c))||_0x16669e[_0x38d2e9(0x190)](_0x38d2e9(0x189))||_0x16669e[_0x38d2e9(0x190)](_0x38d2e9(0x156))||_0x16669e[_0x38d2e9(0x190)]('heizung');_0x2fae5f['isProVersion']&&_0x75567c&&recordThermodynamics(_0x2fae5f,_0x694a9a,_0x4ecc44,_0x1014d3[_0x38d2e9(0x18b)]);const _0x3ab6b0={'timestamp':_0x18622c,'id':_0x694a9a,'name':_0x1014d3[_0x38d2e9(0x173)],'type':_0x1014d3[_0x38d2e9(0x17c)],'location':_0x1014d3[_0x38d2e9(0x18b)],'value':_0x4ecc44};_0x2fae5f[_0x38d2e9(0x1a3)]['unshift'](_0x3ab6b0);if(_0x2fae5f['eventHistory'][_0x38d2e9(0x161)]>HISTORY_MAX_SIZE)_0x2fae5f[_0x38d2e9(0x1a3)]['pop']();await _0x2fae5f['setStateAsync'](_0x38d2e9(0x152),{'val':JSON[_0x38d2e9(0x16f)](_0x3ab6b0),'ack':!![]}),await _0x2fae5f[_0x38d2e9(0x16d)](_0x38d2e9(0x178),{'val':JSON['stringify'](_0x2fae5f['eventHistory']),'ack':!![]});if(_0x2fae5f[_0x38d2e9(0x186)]){_0x2fae5f[_0x38d2e9(0x19a)][_0x38d2e9(0x158)](_0x3ab6b0);if(_0x2fae5f[_0x38d2e9(0x19a)][_0x38d2e9(0x161)]>RAW_LOG_MAX_SIZE)_0x2fae5f[_0x38d2e9(0x19a)]['splice'](0x0,_0x2fae5f[_0x38d2e9(0x19a)][_0x38d2e9(0x161)]-RAW_LOG_MAX_SIZE);await _0x2fae5f['setStateAsync'](_0x38d2e9(0x150),{'val':JSON[_0x38d2e9(0x16f)](_0x2fae5f[_0x38d2e9(0x19a)]),'ack':!![]}),recordSequence(_0x2fae5f,_0x3ab6b0);}if(_0x1014d3['isExit']&&_0x4ecc44===!![]){if(_0x2fae5f[_0x38d2e9(0x16e)]&&!_0x2fae5f['isGracePeriodActive'])startExitTimer(_0x2fae5f);else{if(!_0x2fae5f[_0x38d2e9(0x16e)])setPresence(_0x2fae5f,!![]);}}else{if(_0x1014d3[_0x38d2e9(0x17c)]===_0x38d2e9(0x195)&&_0x4ecc44===!![]){if(_0x2fae5f[_0x38d2e9(0x172)])abortExitTimer(_0x2fae5f);if(!_0x2fae5f[_0x38d2e9(0x16e)]&&_0x2fae5f[_0x38d2e9(0x184)]===_0x38d2e9(0x191))setPresence(_0x2fae5f,!![]);}}return _0x2fae5f['isProVersion']&&_0x1014d3[_0x38d2e9(0x17c)]===_0x38d2e9(0x195)&&_0x4ecc44===!![]&&_0x1014d3[_0x38d2e9(0x18b)]&&_0x2fae5f[_0x38d2e9(0x18e)]&&_0x2fae5f['sendToPythonWrapper']('SIMULATE_SIGNAL',{'room':_0x1014d3['location']}),_0x3ab6b0;}module[a5_0x1ae09d(0x16b)]={'processSensorEvent':processSensorEvent,'getOutsideTemperatureNumeric':getOutsideTemperatureNumeric,'setPresence':setPresence,'abortExitTimer':abortExitTimer,'startExitTimer':startExitTimer};function a5_0x2028(){const _0x5f1d11=['tür','eventHistory','daswetter','LTM.rawEventLog','map','events.lastEvent','message','toString','logDuplicates','klima','getHours','push','occupancy','.ACTUAL_TEMPERATURE','LTM.trainingData.thermodynamics','value','präsenz','1189852mgJcfI','ANALYZE_SEQUENCE','.1.TEMPERATURE','length','val','window','parse','apply','47032ZzeLlx','exitGraceTimer','18YdPcmL','fenster','round','exports','temperature','setStateAsync','isPresent','stringify','getStateAsync','126tXLNiu','exitTimer','name','switch','door','getForeignStateAsync','accuweather','events.history','(((.+)+)+)+$','1018800imAxUa','.1.ACTUAL_TEMPERATURE','type','constructor','327QWjrOK','isGracePeriodActive','contact','some','light','search','currentSystemMode','toISOString','isProVersion','lampe','[RECORDER]\x20Error:\x20','temperatur','weatherInstance','location','shift','number','sendToPythonWrapper','outdoorSensorId','includes','normal','8046510XJVExM','.LEVEL','20872470QNkvDj','motion','presence','loc','config','from','rawEventLog','23602ingeVV','now','3990192tTCZNI','.Current.Temperature','sensorLastValues','bewegung','.forecast.current.temperature'];a5_0x2028=function(){return _0x5f1d11;};return a5_0x2028();}