const a5_0x2bf994=a5_0xc58e;(function(_0x5cb9cd,_0x83dba3){const _0x1802e5=a5_0xc58e,_0x32c6f0=_0x5cb9cd();while(!![]){try{const _0x12cfdb=parseInt(_0x1802e5(0x144))/0x1*(parseInt(_0x1802e5(0x10f))/0x2)+parseInt(_0x1802e5(0x12c))/0x3*(parseInt(_0x1802e5(0x150))/0x4)+parseInt(_0x1802e5(0xfe))/0x5+parseInt(_0x1802e5(0x141))/0x6*(-parseInt(_0x1802e5(0x11c))/0x7)+parseInt(_0x1802e5(0x127))/0x8+-parseInt(_0x1802e5(0x108))/0x9*(-parseInt(_0x1802e5(0x13c))/0xa)+parseInt(_0x1802e5(0x104))/0xb*(-parseInt(_0x1802e5(0x12b))/0xc);if(_0x12cfdb===_0x83dba3)break;else _0x32c6f0['push'](_0x32c6f0['shift']());}catch(_0x4cc558){_0x32c6f0['push'](_0x32c6f0['shift']());}}}(a5_0x2ad4,0xd43c5));const a5_0x4dc711=(function(){let _0x22e2e7=!![];return function(_0x3c1460,_0x1023ac){const _0x5989c8=_0x22e2e7?function(){const _0x1c2685=a5_0xc58e;if(_0x1023ac){const _0x213a5f=_0x1023ac[_0x1c2685(0x149)](_0x3c1460,arguments);return _0x1023ac=null,_0x213a5f;}}:function(){};return _0x22e2e7=![],_0x5989c8;};}()),a5_0x33708d=a5_0x4dc711(this,function(){const _0x3e98f3=a5_0xc58e;return a5_0x33708d['toString']()['search'](_0x3e98f3(0xf9))['toString']()[_0x3e98f3(0x157)](a5_0x33708d)[_0x3e98f3(0x10a)](_0x3e98f3(0xf9));});a5_0x33708d();'use strict';function a5_0xc58e(_0xf11311,_0x51cb62){const _0xc753f8=a5_0x2ad4();return a5_0xc58e=function(_0x33708d,_0x4dc711){_0x33708d=_0x33708d-0xf8;let _0x2ad46a=_0xc753f8[_0x33708d];return _0x2ad46a;},a5_0xc58e(_0xf11311,_0x51cb62);}const HISTORY_MAX_SIZE=0x32,RAW_LOG_MAX_SIZE=0x9c4,THERMO_LOG_SIZE=0x3e8,SEQUENCE_TIMEOUT_MS=0x5*0x3c*0x3e8,MAX_TRAINING_SET_SIZE=0x1f4,EXIT_TIMER_MINUTES=0xf,EXIT_GRACE_PERIOD_SECONDS=0x1e;let activeSequence=[],sequenceTimer=null;async function getOutsideTemperatureNumeric(_0x4ed52f){const _0x3f470e=a5_0xc58e;if(_0x4ed52f[_0x3f470e(0x14b)][_0x3f470e(0x101)])try{const _0x4e7d6f=await _0x4ed52f[_0x3f470e(0x154)](_0x4ed52f[_0x3f470e(0x14b)]['outdoorSensorId']);if(_0x4e7d6f&&_0x4e7d6f['val']!==undefined&&_0x4e7d6f[_0x3f470e(0x14d)]!==null)return parseFloat(_0x4e7d6f['val']);}catch(_0x2e3887){}const _0x40f0ef=_0x4ed52f[_0x3f470e(0x14b)][_0x3f470e(0x114)];if(!_0x4ed52f[_0x3f470e(0x14b)][_0x3f470e(0x131)]||!_0x40f0ef)return null;try{let _0x41d1c6='';if(_0x40f0ef[_0x3f470e(0x148)](_0x3f470e(0xfd)))_0x41d1c6=_0x40f0ef+'.Current.Temperature';else{if(_0x40f0ef[_0x3f470e(0x148)](_0x3f470e(0x11d)))_0x41d1c6=_0x40f0ef+_0x3f470e(0x122);else{if(_0x40f0ef[_0x3f470e(0x148)](_0x3f470e(0x13e)))_0x41d1c6=_0x40f0ef+_0x3f470e(0x128);else{if(_0x40f0ef[_0x3f470e(0x148)](_0x3f470e(0x11a)))_0x41d1c6=_0x40f0ef+_0x3f470e(0x119);}}}if(_0x41d1c6){const _0x56dc46=await _0x4ed52f[_0x3f470e(0x154)](_0x41d1c6);if(_0x56dc46&&_0x56dc46[_0x3f470e(0x14d)]!==undefined&&_0x56dc46['val']!==null)return parseFloat(_0x56dc46[_0x3f470e(0x14d)]);}}catch(_0x4a65bd){}return null;}function a5_0x2ad4(){const _0x1f5192=['weatherunderground','window','63mHHZcG','daswetter','lock','klima','eventHistory','getHours','.NextHours.Location_1.Day_1.current.temp_value','error','dimmer','setStateAsync','LTM.trainingData.thermodynamics','9756680QwuvKC','.forecast.current.temperature','heizung','.4.VALVE_STATE','96GePDyp','21efKlVR','.LEVEL','from','handle','Unknown','useWeather','exports','isExit','sensorLastValues','replace','tür','exitGraceTimer','log','STATE','LEVEL','lastTrackerEventTime','477670dQFIgI','[RECORDER]\x20Error:\x20','openweathermap','.ACTUAL_TEMPERATURE','temperature','926658YDDzwM','normal','length','1tzvmSi','thermostat','valveMapping','shift','includes','apply','präsenz','config','TRACK_EVENT','val','kontakt','push','46348CPgqle','level','sendToPythonWrapper','schloss','getForeignStateAsync','value','LTM.trainingData.sequences','constructor','stringify','isGracePeriodActive','toLowerCase','round','motion','ANALYZE_SEQUENCE','switch','fenster','isPresent','logDuplicates','currentSystemMode','type','some','system.isPresent','pop','rawEventLog','exitTimer','name','griff','.1.LEVEL','(((.+)+)+)+$','.1.VALVE_STATE','string','number','accuweather','3692180wgYjMp','getStateAsync','debug','outdoorSensorId','events.history','STATUS','2279992Nmkrtq','door','map','now','171GlVSkv','light','search','parse','[RECORDER]\x20Ignored\x20implausible\x20temperature:\x20','loc','bewegung','1941554MExusn','isProVersion','lampe','.1.ACTUAL_TEMPERATURE','occupancy','weatherInstance','licht','schalter','location','message','.forecast.current.temp'];a5_0x2ad4=function(){return _0x1f5192;};return a5_0x2ad4();}async function recordThermodynamics(_0x4697fa,_0x5b8ce3,_0x13cc81,_0x4334ed){const _0x537fcc=a5_0xc58e,_0x261bdd=await getOutsideTemperatureNumeric(_0x4697fa);if(_0x261bdd===null)return;let _0x3ec88e=0x0,_0x4a34c4=![];if(_0x4697fa[_0x537fcc(0x14b)][_0x537fcc(0x146)])try{let _0x5ded09=_0x4697fa['config'][_0x537fcc(0x146)];if(typeof _0x5ded09===_0x537fcc(0xfb))_0x5ded09=JSON['parse'](_0x5ded09);if(_0x5ded09[_0x5b8ce3]){const _0x5b4989=_0x5ded09[_0x5b8ce3],_0x3d7aa3=await _0x4697fa[_0x537fcc(0x154)](_0x5b4989);if(_0x3d7aa3&&_0x3d7aa3[_0x537fcc(0x14d)]!==null&&_0x3d7aa3['val']!==undefined){let _0x28fa62=Number(_0x3d7aa3[_0x537fcc(0x14d)]);if(_0x28fa62<=1.05&&!_0x5b4989[_0x537fcc(0x148)](_0x537fcc(0x103))&&!_0x5b4989['includes'](_0x537fcc(0x139)))_0x28fa62=_0x28fa62*0x64;_0x3ec88e=Math['round'](_0x28fa62),_0x4a34c4=!![];}}}catch(_0x48cbfb){}if(!_0x4a34c4){const _0x5e4101=[{'from':_0x537fcc(0x112),'to':_0x537fcc(0xf8)},{'from':_0x537fcc(0x112),'to':_0x537fcc(0xfa)},{'from':'.1.TEMPERATURE','to':_0x537fcc(0x12a)},{'from':_0x537fcc(0x13f),'to':_0x537fcc(0x12d)},{'from':_0x537fcc(0x140),'to':_0x537fcc(0x151)},{'from':'Temperature','to':'Valve'}];for(const _0x6c5bc4 of _0x5e4101){if(_0x5b8ce3[_0x537fcc(0x148)](_0x6c5bc4[_0x537fcc(0x12e)])){const _0x85a8c2=_0x5b8ce3[_0x537fcc(0x135)](_0x6c5bc4[_0x537fcc(0x12e)],_0x6c5bc4['to']);try{const _0x2083a5=await _0x4697fa[_0x537fcc(0x154)](_0x85a8c2);if(_0x2083a5&&_0x2083a5['val']!==null&&_0x2083a5[_0x537fcc(0x14d)]!==undefined){let _0x4af2e7=Number(_0x2083a5['val']);if(typeof _0x4af2e7===_0x537fcc(0xfc)){if(_0x4af2e7<=1.05&&_0x6c5bc4['to'][_0x537fcc(0x148)](_0x537fcc(0x13a)))_0x4af2e7=_0x4af2e7*0x64;_0x3ec88e=Math['round'](_0x4af2e7),_0x4a34c4=!![];break;}}}catch(_0x3a0ed6){}}}}const _0x555d3e=await _0x4697fa[_0x537fcc(0xff)](_0x537fcc(0x126));let _0x2db723=[];if(_0x555d3e&&_0x555d3e['val'])try{_0x2db723=JSON[_0x537fcc(0x10b)](_0x555d3e[_0x537fcc(0x14d)]);}catch(_0x7c1514){}_0x2db723[_0x537fcc(0x14f)]({'ts':Date[_0x537fcc(0x107)](),'room':_0x4334ed||_0x537fcc(0x130),'t_in':_0x13cc81,'t_out':_0x261bdd,'valve':_0x3ec88e});if(_0x2db723[_0x537fcc(0x143)]>THERMO_LOG_SIZE)_0x2db723[_0x537fcc(0x147)]();await _0x4697fa[_0x537fcc(0x125)](_0x537fcc(0x126),{'val':JSON[_0x537fcc(0x158)](_0x2db723),'ack':!![]});}async function saveCompletedSequence(_0x3739bf){const _0x3c666b=a5_0xc58e;try{const _0x1ae29a=await _0x3739bf['getStateAsync']('LTM.trainingData.sequences');let _0x18c707=[];if(_0x1ae29a&&_0x1ae29a['val'])try{_0x18c707=JSON[_0x3c666b(0x10b)](_0x1ae29a[_0x3c666b(0x14d)]);}catch(_0x4e6a71){}const _0x13b7c5=activeSequence[0x0]['ts'],_0x11d6f9=activeSequence[_0x3c666b(0x106)](_0x2c0d16=>({'loc':_0x2c0d16[_0x3c666b(0x10d)],'t_delta':Math[_0x3c666b(0x15b)]((_0x2c0d16['ts']-_0x13b7c5)/0x3e8)})),_0x2a3f1b={'timestamp':new Date(_0x13b7c5)['toISOString'](),'steps':_0x11d6f9,'duration':Math[_0x3c666b(0x15b)]((activeSequence[activeSequence['length']-0x1]['ts']-_0x13b7c5)/0x3e8),'daytime':new Date(_0x13b7c5)[_0x3c666b(0x121)]()};_0x18c707['push'](_0x2a3f1b);if(_0x18c707[_0x3c666b(0x143)]>MAX_TRAINING_SET_SIZE)_0x18c707[_0x3c666b(0x147)]();await _0x3739bf[_0x3c666b(0x125)](_0x3c666b(0x156),{'val':JSON[_0x3c666b(0x158)](_0x18c707),'ack':!![]}),_0x3739bf[_0x3c666b(0x110)]&&_0x3739bf[_0x3c666b(0x152)]&&_0x3739bf['sendToPythonWrapper'](_0x3c666b(0x15d),{'sequence':_0x2a3f1b});}catch(_0x1a3e02){_0x3739bf[_0x3c666b(0x138)][_0x3c666b(0x123)](_0x3c666b(0x13d)+_0x1a3e02[_0x3c666b(0x118)]);}}async function recordSequence(_0x30d7b9,_0x403676){const _0x16ab77=a5_0xc58e,_0x549124=(_0x403676[_0x16ab77(0x163)]||'')[_0x16ab77(0x15a)](),_0x256fed=[_0x16ab77(0x15c),_0x16ab77(0x10e),_0x16ab77(0x14a),'presence',_0x16ab77(0x113),'door',_0x16ab77(0x136),_0x16ab77(0x11b),_0x16ab77(0x15f),'contact',_0x16ab77(0x14e),_0x16ab77(0x109),'licht','switch',_0x16ab77(0x116),_0x16ab77(0x124),_0x16ab77(0x111)];if(!_0x256fed[_0x16ab77(0x164)](_0x27e93c=>_0x549124[_0x16ab77(0x148)](_0x27e93c)))return;if(!_0x403676[_0x16ab77(0x155)])return;if(sequenceTimer)clearTimeout(sequenceTimer);activeSequence[_0x16ab77(0x14f)]({'loc':_0x403676[_0x16ab77(0x117)]||'Unknown','id':_0x403676['id'],'ts':Date[_0x16ab77(0x107)]()}),sequenceTimer=setTimeout(async()=>{const _0x521fa3=_0x16ab77;if(activeSequence[_0x521fa3(0x143)]>0x1)await saveCompletedSequence(_0x30d7b9);activeSequence=[];},SEQUENCE_TIMEOUT_MS);}function startExitTimer(_0x3c7a5d){const _0x526892=a5_0xc58e;abortExitTimer(_0x3c7a5d),_0x3c7a5d[_0x526892(0x159)]=!![],_0x3c7a5d['exitGraceTimer']=setTimeout(()=>{_0x3c7a5d['isGracePeriodActive']=![];},EXIT_GRACE_PERIOD_SECONDS*0x3e8),_0x3c7a5d[_0x526892(0x168)]=setTimeout(()=>{setPresence(_0x3c7a5d,![]),_0x3c7a5d['exitTimer']=null;},EXIT_TIMER_MINUTES*0x3c*0x3e8);}function abortExitTimer(_0x1965be){const _0x4bfe9c=a5_0xc58e;if(_0x1965be[_0x4bfe9c(0x168)])clearTimeout(_0x1965be[_0x4bfe9c(0x168)]);if(_0x1965be[_0x4bfe9c(0x137)])clearTimeout(_0x1965be[_0x4bfe9c(0x137)]);_0x1965be[_0x4bfe9c(0x168)]=null,_0x1965be['exitGraceTimer']=null,_0x1965be[_0x4bfe9c(0x159)]=![];}async function setPresence(_0x54976a,_0x3299a2){const _0x233f89=a5_0xc58e;if(_0x54976a[_0x233f89(0x160)]===_0x3299a2)return;_0x54976a[_0x233f89(0x160)]=_0x3299a2,await _0x54976a[_0x233f89(0x125)](_0x233f89(0x165),{'val':_0x3299a2,'ack':!![]});}async function processSensorEvent(_0x257131,_0x4c763b,_0x524ac5,_0x5d8b59){const _0x170df1=a5_0xc58e;if(!_0x5d8b59)return null;const _0x32e1a1=_0x524ac5[_0x170df1(0x14d)],_0x20dffd=Date[_0x170df1(0x107)](),_0x1df09b=_0x257131['sensorLastValues'][_0x4c763b],_0x579214=(_0x5d8b59['type']||'')[_0x170df1(0x15a)](),_0x1efcfd=_0x579214[_0x170df1(0x148)](_0x170df1(0x140))||_0x579214[_0x170df1(0x148)]('temperatur')||_0x579214[_0x170df1(0x148)](_0x170df1(0x11f))||_0x579214[_0x170df1(0x148)](_0x170df1(0x129))||_0x579214[_0x170df1(0x148)](_0x170df1(0x145));if(_0x1efcfd&&typeof _0x32e1a1===_0x170df1(0xfc)){if(_0x32e1a1>0x50||_0x32e1a1<-0x32)return _0x257131[_0x170df1(0x138)][_0x170df1(0x100)](_0x170df1(0x10c)+_0x32e1a1+'\x20from\x20'+_0x4c763b),null;}_0x257131[_0x170df1(0x134)][_0x4c763b]=_0x32e1a1;if(!_0x5d8b59[_0x170df1(0x161)]&&_0x1df09b!=undefined&&_0x1df09b==_0x32e1a1)return null;_0x257131['isProVersion']&&_0x1efcfd&&recordThermodynamics(_0x257131,_0x4c763b,_0x32e1a1,_0x5d8b59[_0x170df1(0x117)]);const _0x10af5d={'timestamp':_0x20dffd,'id':_0x4c763b,'name':_0x5d8b59[_0x170df1(0x169)],'type':_0x5d8b59['type'],'location':_0x5d8b59[_0x170df1(0x117)],'value':_0x32e1a1};_0x257131[_0x170df1(0x120)]['unshift'](_0x10af5d);if(_0x257131[_0x170df1(0x120)][_0x170df1(0x143)]>HISTORY_MAX_SIZE)_0x257131[_0x170df1(0x120)][_0x170df1(0x166)]();await _0x257131[_0x170df1(0x125)]('events.lastEvent',{'val':JSON[_0x170df1(0x158)](_0x10af5d),'ack':!![]}),await _0x257131[_0x170df1(0x125)](_0x170df1(0x102),{'val':JSON['stringify'](_0x257131['eventHistory']),'ack':!![]});if(_0x257131[_0x170df1(0x110)]){_0x257131[_0x170df1(0x167)][_0x170df1(0x14f)](_0x10af5d);if(_0x257131[_0x170df1(0x167)][_0x170df1(0x143)]>RAW_LOG_MAX_SIZE)_0x257131['rawEventLog']['splice'](0x0,_0x257131[_0x170df1(0x167)][_0x170df1(0x143)]-RAW_LOG_MAX_SIZE);await _0x257131[_0x170df1(0x125)]('LTM.rawEventLog',{'val':JSON[_0x170df1(0x158)](_0x257131[_0x170df1(0x167)]),'ack':!![]}),recordSequence(_0x257131,_0x10af5d);}if(_0x5d8b59[_0x170df1(0x133)]&&_0x32e1a1===!![]){if(_0x257131[_0x170df1(0x160)]&&!_0x257131[_0x170df1(0x159)])startExitTimer(_0x257131);else{if(!_0x257131[_0x170df1(0x160)])setPresence(_0x257131,!![]);}}else{if(_0x5d8b59[_0x170df1(0x163)]===_0x170df1(0x15c)&&_0x32e1a1===!![]){if(_0x257131[_0x170df1(0x168)])abortExitTimer(_0x257131);if(!_0x257131[_0x170df1(0x160)]&&_0x257131[_0x170df1(0x162)]===_0x170df1(0x142))setPresence(_0x257131,!![]);}}if(_0x257131[_0x170df1(0x110)]&&_0x257131[_0x170df1(0x152)]){_0x5d8b59[_0x170df1(0x163)]==='motion'&&_0x32e1a1===!![]&&_0x5d8b59[_0x170df1(0x117)]&&_0x257131[_0x170df1(0x152)]('SIMULATE_SIGNAL',{'room':_0x5d8b59[_0x170df1(0x117)]});const _0x53a964=[_0x170df1(0x105),_0x170df1(0x136),_0x170df1(0x11b),_0x170df1(0x15f),_0x170df1(0x16a),_0x170df1(0x12f),_0x170df1(0x11e),_0x170df1(0x153)]['some'](_0x3825e6=>_0x579214['includes'](_0x3825e6)),_0x410299=[_0x170df1(0x109),_0x170df1(0x115),_0x170df1(0x15e),_0x170df1(0x116),'dimmer',_0x170df1(0x111)][_0x170df1(0x164)](_0x15dddd=>_0x579214[_0x170df1(0x148)](_0x15dddd)),_0x4c8034=[_0x170df1(0x15c),_0x170df1(0x10e),_0x170df1(0x14a),'presence',_0x170df1(0x113)][_0x170df1(0x164)](_0x1864fd=>_0x579214[_0x170df1(0x148)](_0x1864fd));if(_0x5d8b59['location']&&(_0x53a964||_0x410299||_0x4c8034)){const _0x5f42ab=_0x32e1a1===!![]||typeof _0x32e1a1===_0x170df1(0xfc)&&_0x32e1a1>0x0,_0x175a3d=_0x53a964&&!_0x5f42ab&&_0x1df09b!==undefined&&_0x1df09b!=_0x32e1a1;if(_0x5f42ab||_0x175a3d){const _0x1a7023=_0x257131[_0x170df1(0x13b)]||_0x20dffd,_0x5bd5b7=(_0x20dffd-_0x1a7023)/0x3e8;_0x257131[_0x170df1(0x13b)]=_0x20dffd,_0x257131[_0x170df1(0x152)](_0x170df1(0x14c),{'room':_0x5d8b59[_0x170df1(0x117)],'dt':_0x5bd5b7});}}}return _0x10af5d;}module[a5_0x2bf994(0x132)]={'processSensorEvent':processSensorEvent,'getOutsideTemperatureNumeric':getOutsideTemperatureNumeric,'setPresence':setPresence,'abortExitTimer':abortExitTimer,'startExitTimer':startExitTimer};