const a5_0x6b158b=a5_0x2f36;(function(_0x372354,_0x260caf){const _0x362d76=a5_0x2f36,_0xcec69c=_0x372354();while(!![]){try{const _0x576f9e=parseInt(_0x362d76(0x93))/0x1+-parseInt(_0x362d76(0xe8))/0x2+-parseInt(_0x362d76(0x95))/0x3*(-parseInt(_0x362d76(0x92))/0x4)+-parseInt(_0x362d76(0xec))/0x5*(-parseInt(_0x362d76(0x9e))/0x6)+parseInt(_0x362d76(0xb2))/0x7*(parseInt(_0x362d76(0xac))/0x8)+parseInt(_0x362d76(0x98))/0x9+parseInt(_0x362d76(0x88))/0xa;if(_0x576f9e===_0x260caf)break;else _0xcec69c['push'](_0xcec69c['shift']());}catch(_0x3d2a3a){_0xcec69c['push'](_0xcec69c['shift']());}}}(a5_0x528b,0x8e806));const a5_0x19de8a=(function(){let _0x45d0aa=!![];return function(_0x391c8f,_0x3cdad4){const _0x5adf6e=_0x45d0aa?function(){const _0x439171=a5_0x2f36;if(_0x3cdad4){const _0x5ede35=_0x3cdad4[_0x439171(0xa0)](_0x391c8f,arguments);return _0x3cdad4=null,_0x5ede35;}}:function(){};return _0x45d0aa=![],_0x5adf6e;};}()),a5_0x2ad996=a5_0x19de8a(this,function(){const _0x5587ef=a5_0x2f36;return a5_0x2ad996['toString']()[_0x5587ef(0xa6)](_0x5587ef(0x94))['toString']()[_0x5587ef(0xd7)](a5_0x2ad996)[_0x5587ef(0xa6)]('(((.+)+)+)+$');});a5_0x2ad996();function a5_0x528b(){const _0x1921e1=['system.isPresent','location','154265qgLckJ','shift','.LEVEL','temperatur','motion','eventHistory','weatherunderground','schloss','rawEventLog','2311460maUcrf','switch','value','lastTrackerEventTime','handle','schalter','contact','exitGraceTimer','[RECORDER]\x20Error:\x20','map','152tdbezn','220259nqWosW','(((.+)+)+)+$','45381fVhPqW','.4.VALVE_STATE','door','170829TcWAil','isPresent','tür','string','now','Valve','54XpfSwZ','isProVersion','apply','STATE','light','Unknown','\x20from\x20','.1.VALVE_STATE','search','accuweather','outdoorSensorId','STATUS','splice','SIMULATE_SIGNAL','1633016BPMBas','fenster','präsenz','.1.TEMPERATURE','parse','setStateAsync','7tYvNxt','LTM.trainingData.thermodynamics','.forecast.current.temp','events.history','currentSystemMode','.1.ACTUAL_TEMPERATURE','weatherInstance','error','log','number','toLowerCase','LTM.trainingData.sequences','round','val','includes','type','getHours','events.lastEvent','dimmer','sensorLastValues','getForeignStateAsync','sendToPythonWrapper','thermostat','temperature','licht','window','logDuplicates','exitTimer','some','stringify','lock','bewegung','length','klima','exports','.ACTUAL_TEMPERATURE','.forecast.current.temperature','constructor','config','presence','debug','lampe','valveMapping','occupancy','loc','daswetter','openweathermap','pop','kontakt','isExit','[RECORDER]\x20Ignored\x20implausible\x20temperature:\x20','griff','push','toISOString','1886660PNATIe','isGracePeriodActive'];a5_0x528b=function(){return _0x1921e1;};return a5_0x528b();}'use strict';const HISTORY_MAX_SIZE=0x32,RAW_LOG_MAX_SIZE=0x9c4,THERMO_LOG_SIZE=0x3e8,SEQUENCE_TIMEOUT_MS=0x5*0x3c*0x3e8,MAX_TRAINING_SET_SIZE=0x1f4,EXIT_TIMER_MINUTES=0xf,EXIT_GRACE_PERIOD_SECONDS=0x1e;let activeSequence=[],sequenceTimer=null;async function getOutsideTemperatureNumeric(_0xb0df41){const _0x35d8b2=a5_0x2f36;if(_0xb0df41[_0x35d8b2(0xd8)][_0x35d8b2(0xa8)])try{const _0x13709f=await _0xb0df41[_0x35d8b2(0xc6)](_0xb0df41[_0x35d8b2(0xd8)][_0x35d8b2(0xa8)]);if(_0x13709f&&_0x13709f[_0x35d8b2(0xbf)]!==undefined&&_0x13709f[_0x35d8b2(0xbf)]!==null)return parseFloat(_0x13709f[_0x35d8b2(0xbf)]);}catch(_0x37662b){}const _0x323bcc=_0xb0df41['config'][_0x35d8b2(0xb8)];if(!_0xb0df41['config']['useWeather']||!_0x323bcc)return null;try{let _0x448407='';if(_0x323bcc['includes'](_0x35d8b2(0xa7)))_0x448407=_0x323bcc+'.Current.Temperature';else{if(_0x323bcc[_0x35d8b2(0xc0)](_0x35d8b2(0xdf)))_0x448407=_0x323bcc+'.NextHours.Location_1.Day_1.current.temp_value';else{if(_0x323bcc[_0x35d8b2(0xc0)](_0x35d8b2(0xe0)))_0x448407=_0x323bcc+_0x35d8b2(0xd6);else{if(_0x323bcc['includes'](_0x35d8b2(0x85)))_0x448407=_0x323bcc+_0x35d8b2(0xb4);}}}if(_0x448407){const _0x32c39d=await _0xb0df41[_0x35d8b2(0xc6)](_0x448407);if(_0x32c39d&&_0x32c39d[_0x35d8b2(0xbf)]!==undefined&&_0x32c39d[_0x35d8b2(0xbf)]!==null)return parseFloat(_0x32c39d[_0x35d8b2(0xbf)]);}}catch(_0x12653b){}return null;}function a5_0x2f36(_0x4ca64a,_0x3f130e){const _0x5dd3cb=a5_0x528b();return a5_0x2f36=function(_0x2ad996,_0x19de8a){_0x2ad996=_0x2ad996-0x83;let _0x528b91=_0x5dd3cb[_0x2ad996];return _0x528b91;},a5_0x2f36(_0x4ca64a,_0x3f130e);}async function recordThermodynamics(_0x3eae68,_0x542758,_0x39536b,_0x5c4f7b){const _0x47a059=a5_0x2f36,_0x58fdb5=await getOutsideTemperatureNumeric(_0x3eae68);if(_0x58fdb5===null)return;let _0x3eb0b9=0x0,_0x1d8f86=![];if(_0x3eae68[_0x47a059(0xd8)][_0x47a059(0xdc)])try{let _0x5c8202=_0x3eae68[_0x47a059(0xd8)][_0x47a059(0xdc)];if(typeof _0x5c8202===_0x47a059(0x9b))_0x5c8202=JSON[_0x47a059(0xb0)](_0x5c8202);if(_0x5c8202[_0x542758]){const _0x33ad42=_0x5c8202[_0x542758],_0x3929fd=await _0x3eae68[_0x47a059(0xc6)](_0x33ad42);if(_0x3929fd&&_0x3929fd['val']!==null&&_0x3929fd['val']!==undefined){let _0x2203b1=Number(_0x3929fd[_0x47a059(0xbf)]);if(_0x2203b1<=1.05&&!_0x33ad42[_0x47a059(0xc0)](_0x47a059(0xa9))&&!_0x33ad42[_0x47a059(0xc0)](_0x47a059(0xa1)))_0x2203b1=_0x2203b1*0x64;_0x3eb0b9=Math[_0x47a059(0xbe)](_0x2203b1),_0x1d8f86=!![];}}}catch(_0x532347){}if(!_0x1d8f86){const _0x2f5e23=[{'from':_0x47a059(0xb7),'to':'.1.LEVEL'},{'from':_0x47a059(0xb7),'to':_0x47a059(0xa5)},{'from':_0x47a059(0xaf),'to':_0x47a059(0x96)},{'from':_0x47a059(0xd5),'to':_0x47a059(0xee)},{'from':_0x47a059(0xc9),'to':'level'},{'from':'Temperature','to':_0x47a059(0x9d)}];for(const _0x133638 of _0x2f5e23){if(_0x542758[_0x47a059(0xc0)](_0x133638['from'])){const _0x7c6d49=_0x542758['replace'](_0x133638['from'],_0x133638['to']);try{const _0x277ee6=await _0x3eae68[_0x47a059(0xc6)](_0x7c6d49);if(_0x277ee6&&_0x277ee6[_0x47a059(0xbf)]!==null&&_0x277ee6[_0x47a059(0xbf)]!==undefined){let _0x24ff68=Number(_0x277ee6[_0x47a059(0xbf)]);if(typeof _0x24ff68===_0x47a059(0xbb)){if(_0x24ff68<=1.05&&_0x133638['to'][_0x47a059(0xc0)]('LEVEL'))_0x24ff68=_0x24ff68*0x64;_0x3eb0b9=Math[_0x47a059(0xbe)](_0x24ff68),_0x1d8f86=!![];break;}}}catch(_0x9d4962){}}}}const _0x250dbe=await _0x3eae68['getStateAsync'](_0x47a059(0xb3));let _0x4da49a=[];if(_0x250dbe&&_0x250dbe[_0x47a059(0xbf)])try{_0x4da49a=JSON[_0x47a059(0xb0)](_0x250dbe[_0x47a059(0xbf)]);}catch(_0x158c78){}_0x4da49a[_0x47a059(0xe6)]({'ts':Date[_0x47a059(0x9c)](),'room':_0x5c4f7b||'Unknown','t_in':_0x39536b,'t_out':_0x58fdb5,'valve':_0x3eb0b9});if(_0x4da49a[_0x47a059(0xd2)]>THERMO_LOG_SIZE)_0x4da49a[_0x47a059(0xed)]();await _0x3eae68['setStateAsync']('LTM.trainingData.thermodynamics',{'val':JSON[_0x47a059(0xcf)](_0x4da49a),'ack':!![]});}async function saveCompletedSequence(_0x27d7a9){const _0x390eb9=a5_0x2f36;try{const _0x3066cc=await _0x27d7a9['getStateAsync'](_0x390eb9(0xbd));let _0x4fed4a=[];if(_0x3066cc&&_0x3066cc[_0x390eb9(0xbf)])try{_0x4fed4a=JSON[_0x390eb9(0xb0)](_0x3066cc[_0x390eb9(0xbf)]);}catch(_0x452a13){}const _0x1f5f80=activeSequence[0x0]['ts'],_0x6f1732=activeSequence[_0x390eb9(0x91)](_0x491ec3=>({'loc':_0x491ec3[_0x390eb9(0xde)],'t_delta':Math[_0x390eb9(0xbe)]((_0x491ec3['ts']-_0x1f5f80)/0x3e8)})),_0x2b9ce9={'timestamp':new Date(_0x1f5f80)[_0x390eb9(0xe7)](),'steps':_0x6f1732,'duration':Math[_0x390eb9(0xbe)]((activeSequence[activeSequence['length']-0x1]['ts']-_0x1f5f80)/0x3e8),'daytime':new Date(_0x1f5f80)[_0x390eb9(0xc2)]()};_0x4fed4a['push'](_0x2b9ce9);if(_0x4fed4a[_0x390eb9(0xd2)]>MAX_TRAINING_SET_SIZE)_0x4fed4a['shift']();await _0x27d7a9[_0x390eb9(0xb1)](_0x390eb9(0xbd),{'val':JSON[_0x390eb9(0xcf)](_0x4fed4a),'ack':!![]}),_0x27d7a9[_0x390eb9(0x9f)]&&_0x27d7a9[_0x390eb9(0xc7)]&&_0x27d7a9['sendToPythonWrapper']('ANALYZE_SEQUENCE',{'sequence':_0x2b9ce9});}catch(_0x2b8c28){_0x27d7a9['log'][_0x390eb9(0xb9)](_0x390eb9(0x90)+_0x2b8c28['message']);}}async function recordSequence(_0x1446e6,_0x472973){const _0x14f467=a5_0x2f36,_0x8a3c3e=(_0x472973[_0x14f467(0xc1)]||'')['toLowerCase'](),_0x3a98a9=['motion',_0x14f467(0xd1),_0x14f467(0xae),_0x14f467(0xd9),'occupancy',_0x14f467(0x97),_0x14f467(0x9a),_0x14f467(0xcb),_0x14f467(0xad),_0x14f467(0x8e),_0x14f467(0xe2),_0x14f467(0xa2),_0x14f467(0xca),'switch',_0x14f467(0x8d),_0x14f467(0xc4),_0x14f467(0xdb)];if(!_0x3a98a9[_0x14f467(0xce)](_0x1fde15=>_0x8a3c3e[_0x14f467(0xc0)](_0x1fde15)))return;if(!_0x472973[_0x14f467(0x8a)])return;if(sequenceTimer)clearTimeout(sequenceTimer);activeSequence[_0x14f467(0xe6)]({'loc':_0x472973[_0x14f467(0xeb)]||_0x14f467(0xa3),'id':_0x472973['id'],'ts':Date[_0x14f467(0x9c)]()}),sequenceTimer=setTimeout(async()=>{if(activeSequence['length']>0x1)await saveCompletedSequence(_0x1446e6);activeSequence=[];},SEQUENCE_TIMEOUT_MS);}function startExitTimer(_0x1caabd){const _0x2d1f3e=a5_0x2f36;abortExitTimer(_0x1caabd),_0x1caabd[_0x2d1f3e(0xe9)]=!![],_0x1caabd[_0x2d1f3e(0x8f)]=setTimeout(()=>{const _0x4e9f66=_0x2d1f3e;_0x1caabd[_0x4e9f66(0xe9)]=![];},EXIT_GRACE_PERIOD_SECONDS*0x3e8),_0x1caabd[_0x2d1f3e(0xcd)]=setTimeout(()=>{const _0x46cb4a=_0x2d1f3e;setPresence(_0x1caabd,![]),_0x1caabd[_0x46cb4a(0xcd)]=null;},EXIT_TIMER_MINUTES*0x3c*0x3e8);}function abortExitTimer(_0x290c69){const _0xa928ed=a5_0x2f36;if(_0x290c69[_0xa928ed(0xcd)])clearTimeout(_0x290c69['exitTimer']);if(_0x290c69[_0xa928ed(0x8f)])clearTimeout(_0x290c69[_0xa928ed(0x8f)]);_0x290c69[_0xa928ed(0xcd)]=null,_0x290c69[_0xa928ed(0x8f)]=null,_0x290c69[_0xa928ed(0xe9)]=![];}async function setPresence(_0x5ba070,_0x21c454){const _0x57b18b=a5_0x2f36;if(_0x5ba070[_0x57b18b(0x99)]===_0x21c454)return;_0x5ba070[_0x57b18b(0x99)]=_0x21c454,await _0x5ba070[_0x57b18b(0xb1)](_0x57b18b(0xea),{'val':_0x21c454,'ack':!![]});}async function processSensorEvent(_0x5ed49e,_0x26f1ee,_0x16ef40,_0x403d0d){const _0x451d55=a5_0x2f36;if(!_0x403d0d)return null;const _0x2284cd=_0x16ef40['val'],_0x2c734c=Date['now'](),_0x532b49=_0x5ed49e[_0x451d55(0xc5)][_0x26f1ee],_0x256baa=(_0x403d0d['type']||'')[_0x451d55(0xbc)](),_0x29f122=_0x256baa['includes'](_0x451d55(0xc9))||_0x256baa[_0x451d55(0xc0)](_0x451d55(0xef))||_0x256baa[_0x451d55(0xc0)](_0x451d55(0xd3))||_0x256baa[_0x451d55(0xc0)]('heizung')||_0x256baa['includes'](_0x451d55(0xc8));if(_0x29f122&&typeof _0x2284cd===_0x451d55(0xbb)){if(_0x2284cd>0x50||_0x2284cd<-0x32)return _0x5ed49e[_0x451d55(0xba)][_0x451d55(0xda)](_0x451d55(0xe4)+_0x2284cd+_0x451d55(0xa4)+_0x26f1ee),null;}_0x5ed49e['sensorLastValues'][_0x26f1ee]=_0x2284cd;if(!_0x403d0d[_0x451d55(0xcc)]&&_0x532b49!=undefined&&_0x532b49==_0x2284cd)return null;_0x5ed49e[_0x451d55(0x9f)]&&_0x29f122&&recordThermodynamics(_0x5ed49e,_0x26f1ee,_0x2284cd,_0x403d0d[_0x451d55(0xeb)]);const _0x350822={'timestamp':_0x2c734c,'id':_0x26f1ee,'name':_0x403d0d['name'],'type':_0x403d0d[_0x451d55(0xc1)],'location':_0x403d0d[_0x451d55(0xeb)],'value':_0x2284cd};_0x5ed49e[_0x451d55(0x84)]['unshift'](_0x350822);if(_0x5ed49e[_0x451d55(0x84)]['length']>HISTORY_MAX_SIZE)_0x5ed49e[_0x451d55(0x84)][_0x451d55(0xe1)]();await _0x5ed49e[_0x451d55(0xb1)](_0x451d55(0xc3),{'val':JSON[_0x451d55(0xcf)](_0x350822),'ack':!![]}),await _0x5ed49e[_0x451d55(0xb1)](_0x451d55(0xb5),{'val':JSON[_0x451d55(0xcf)](_0x5ed49e[_0x451d55(0x84)]),'ack':!![]});if(_0x5ed49e['isProVersion']){_0x5ed49e[_0x451d55(0x87)][_0x451d55(0xe6)](_0x350822);if(_0x5ed49e['rawEventLog'][_0x451d55(0xd2)]>RAW_LOG_MAX_SIZE)_0x5ed49e['rawEventLog'][_0x451d55(0xaa)](0x0,_0x5ed49e['rawEventLog'][_0x451d55(0xd2)]-RAW_LOG_MAX_SIZE);await _0x5ed49e['setStateAsync']('LTM.rawEventLog',{'val':JSON[_0x451d55(0xcf)](_0x5ed49e['rawEventLog']),'ack':!![]}),recordSequence(_0x5ed49e,_0x350822);}if(_0x403d0d[_0x451d55(0xe3)]&&_0x2284cd===!![]){if(_0x5ed49e[_0x451d55(0x99)]&&!_0x5ed49e[_0x451d55(0xe9)])startExitTimer(_0x5ed49e);else{if(!_0x5ed49e['isPresent'])setPresence(_0x5ed49e,!![]);}}else{if(_0x403d0d['type']==='motion'&&_0x2284cd===!![]){if(_0x5ed49e['exitTimer'])abortExitTimer(_0x5ed49e);if(!_0x5ed49e['isPresent']&&_0x5ed49e[_0x451d55(0xb6)]==='normal')setPresence(_0x5ed49e,!![]);}}if(_0x5ed49e[_0x451d55(0x9f)]&&_0x5ed49e[_0x451d55(0xc7)]){_0x403d0d['type']===_0x451d55(0x83)&&_0x2284cd===!![]&&_0x403d0d[_0x451d55(0xeb)]&&_0x5ed49e[_0x451d55(0xc7)](_0x451d55(0xab),{'room':_0x403d0d[_0x451d55(0xeb)]});const _0x256d02=[_0x451d55(0x97),_0x451d55(0x9a),'window','fenster',_0x451d55(0xe5),_0x451d55(0x8c),_0x451d55(0xd0),_0x451d55(0x86)][_0x451d55(0xce)](_0x1b4dbc=>_0x256baa[_0x451d55(0xc0)](_0x1b4dbc)),_0x22a01b=[_0x451d55(0xa2),'licht',_0x451d55(0x89),_0x451d55(0x8d),_0x451d55(0xc4),_0x451d55(0xdb)]['some'](_0x4a035a=>_0x256baa[_0x451d55(0xc0)](_0x4a035a)),_0x15f431=['motion',_0x451d55(0xd1),_0x451d55(0xae),_0x451d55(0xd9),_0x451d55(0xdd)][_0x451d55(0xce)](_0x4a5ff4=>_0x256baa[_0x451d55(0xc0)](_0x4a5ff4));if(_0x403d0d[_0x451d55(0xeb)]&&(_0x256d02||_0x22a01b||_0x15f431)){const _0x3baa6f=_0x2284cd===!![]||typeof _0x2284cd===_0x451d55(0xbb)&&_0x2284cd>0x0,_0x5d5b46=_0x256d02&&!_0x3baa6f&&_0x532b49!==undefined&&_0x532b49!=_0x2284cd;if(_0x3baa6f||_0x5d5b46){const _0xa53743=_0x5ed49e['lastTrackerEventTime']||_0x2c734c,_0x1af26d=(_0x2c734c-_0xa53743)/0x3e8;_0x5ed49e[_0x451d55(0x8b)]=_0x2c734c,_0x5ed49e[_0x451d55(0xc7)]('TRACK_EVENT',{'room':_0x403d0d[_0x451d55(0xeb)],'dt':_0x1af26d});}}}return _0x350822;}module[a5_0x6b158b(0xd4)]={'processSensorEvent':processSensorEvent,'getOutsideTemperatureNumeric':getOutsideTemperatureNumeric,'setPresence':setPresence,'abortExitTimer':abortExitTimer,'startExitTimer':startExitTimer};