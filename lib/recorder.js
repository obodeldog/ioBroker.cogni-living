const a5_0x502869=a5_0x2503;function a5_0x500a(){const _0x1ca5ff=['motion','klima','normal','accuweather','ANALYZE_SEQUENCE','4tDiKMJ','324396cxrEKK','from','loc','setStateAsync','error','sendToPythonWrapper','sensorLastValues','level','LTM.trainingData.thermodynamics','debug','.forecast.current.temp','thermostat','number','parse','location','push','stringify','lampe','exitGraceTimer','getStateAsync','presence','7hjHPbb','length','some','temperature','.ACTUAL_TEMPERATURE','daswetter','name','exports','includes','getForeignStateAsync','value','valveMapping','158492NTNLmc','fenster','replace','log','occupancy','pr채senz','t체r','.4.VALVE_STATE','10ZSlzaO','handle','exitTimer','.1.ACTUAL_TEMPERATURE','(((.+)+)+)+$','map','now','[RECORDER]\x20Ignored\x20implausible\x20temperature:\x20','2205784xGrbZF','STATE','door','pop','useWeather','4365VwyfYV','config','search','dimmer','splice','.1.LEVEL','currentSystemMode','\x20from\x20','unshift','kontakt','852MeiTit','round','.LEVEL','temperatur','LTM.trainingData.sequences','595385NPcScq','678126pllOYy','shift','rawEventLog','schalter','Temperature','constructor','SIMULATE_SIGNAL','bewegung','toISOString','apply','LTM.rawEventLog','isGracePeriodActive','.forecast.current.temperature','.1.TEMPERATURE','analysis.health.todayVector','openweathermap','isProVersion','schloss','Unknown','fill','contact','weatherunderground','system.isPresent','Valve','lock','TRACK_EVENT','message','val','eventHistory','162441wNwfUo','lastTrackerEventTime','window','55LqqYrX','switch','light','isPresent','outdoorSensorId','type','getHours'];a5_0x500a=function(){return _0x1ca5ff;};return a5_0x500a();}(function(_0x558002,_0x5c4d8){const _0x6d6135=a5_0x2503,_0x6caed=_0x558002();while(!![]){try{const _0x2b37a6=-parseInt(_0x6d6135(0x137))/0x1*(-parseInt(_0x6d6135(0x115))/0x2)+parseInt(_0x6d6135(0x14c))/0x3*(-parseInt(_0x6d6135(0xe3))/0x4)+parseInt(_0x6d6135(0xe8))/0x5+parseInt(_0x6d6135(0xe9))/0x6*(-parseInt(_0x6d6135(0x12b))/0x7)+parseInt(_0x6d6135(0x147))/0x8+-parseInt(_0x6d6135(0x106))/0x9*(-parseInt(_0x6d6135(0x13f))/0xa)+parseInt(_0x6d6135(0x109))/0xb*(-parseInt(_0x6d6135(0x116))/0xc);if(_0x2b37a6===_0x5c4d8)break;else _0x6caed['push'](_0x6caed['shift']());}catch(_0x4053f7){_0x6caed['push'](_0x6caed['shift']());}}}(a5_0x500a,0x29ed4));const a5_0x7f3781=(function(){let _0x3dc769=!![];return function(_0x42bf1b,_0x108c97){const _0x1b9d58=_0x3dc769?function(){const _0x35ac0c=a5_0x2503;if(_0x108c97){const _0x5652c1=_0x108c97[_0x35ac0c(0xf2)](_0x42bf1b,arguments);return _0x108c97=null,_0x5652c1;}}:function(){};return _0x3dc769=![],_0x1b9d58;};}()),a5_0x1a9a46=a5_0x7f3781(this,function(){const _0x67a067=a5_0x2503;return a5_0x1a9a46['toString']()[_0x67a067(0x14e)](_0x67a067(0x143))['toString']()[_0x67a067(0xee)](a5_0x1a9a46)[_0x67a067(0x14e)](_0x67a067(0x143));});a5_0x1a9a46();'use strict';const HISTORY_MAX_SIZE=0x32,RAW_LOG_MAX_SIZE=0x9c4,THERMO_LOG_SIZE=0x3e8,SEQUENCE_TIMEOUT_MS=0x5*0x3c*0x3e8,MAX_TRAINING_SET_SIZE=0x1f4,EXIT_TIMER_MINUTES=0xf,EXIT_GRACE_PERIOD_SECONDS=0x1e;function a5_0x2503(_0x2ef0b9,_0x456e21){const _0x5953b0=a5_0x500a();return a5_0x2503=function(_0x1a9a46,_0x7f3781){_0x1a9a46=_0x1a9a46-0xe3;let _0x500a52=_0x5953b0[_0x1a9a46];return _0x500a52;},a5_0x2503(_0x2ef0b9,_0x456e21);}let activeSequence=[],sequenceTimer=null;async function getOutsideTemperatureNumeric(_0x1ec047){const _0x48981b=a5_0x2503;if(_0x1ec047[_0x48981b(0x14d)][_0x48981b(0x10d)])try{const _0x4d446d=await _0x1ec047['getForeignStateAsync'](_0x1ec047[_0x48981b(0x14d)][_0x48981b(0x10d)]);if(_0x4d446d&&_0x4d446d[_0x48981b(0x104)]!==undefined&&_0x4d446d[_0x48981b(0x104)]!==null)return parseFloat(_0x4d446d['val']);}catch(_0x5ffe5a){}const _0x2592a4=_0x1ec047[_0x48981b(0x14d)]['weatherInstance'];if(!_0x1ec047[_0x48981b(0x14d)][_0x48981b(0x14b)]||!_0x2592a4)return null;try{let _0x19cd75='';if(_0x2592a4['includes'](_0x48981b(0x113)))_0x19cd75=_0x2592a4+'.Current.Temperature';else{if(_0x2592a4['includes'](_0x48981b(0x130)))_0x19cd75=_0x2592a4+'.NextHours.Location_1.Day_1.current.temp_value';else{if(_0x2592a4[_0x48981b(0x133)](_0x48981b(0xf8)))_0x19cd75=_0x2592a4+_0x48981b(0xf5);else{if(_0x2592a4[_0x48981b(0x133)](_0x48981b(0xfe)))_0x19cd75=_0x2592a4+_0x48981b(0x120);}}}if(_0x19cd75){const _0xff660e=await _0x1ec047['getForeignStateAsync'](_0x19cd75);if(_0xff660e&&_0xff660e[_0x48981b(0x104)]!==undefined&&_0xff660e[_0x48981b(0x104)]!==null)return parseFloat(_0xff660e['val']);}}catch(_0x5990c1){}return null;}async function recordThermodynamics(_0x900fda,_0x31a958,_0x4680b0,_0x1db525){const _0x4a6bd9=a5_0x2503,_0xc611de=await getOutsideTemperatureNumeric(_0x900fda);if(_0xc611de===null)return;let _0x394934=0x0,_0x4cd82b=![];if(_0x900fda[_0x4a6bd9(0x14d)]['valveMapping'])try{let _0x1a547a=_0x900fda['config'][_0x4a6bd9(0x136)];if(typeof _0x1a547a==='string')_0x1a547a=JSON['parse'](_0x1a547a);if(_0x1a547a[_0x31a958]){const _0x49b1de=_0x1a547a[_0x31a958],_0x4f9ad6=await _0x900fda[_0x4a6bd9(0x134)](_0x49b1de);if(_0x4f9ad6&&_0x4f9ad6['val']!==null&&_0x4f9ad6[_0x4a6bd9(0x104)]!==undefined){let _0x104a25=Number(_0x4f9ad6[_0x4a6bd9(0x104)]);if(_0x104a25<=1.05&&!_0x49b1de['includes']('STATUS')&&!_0x49b1de[_0x4a6bd9(0x133)](_0x4a6bd9(0x148)))_0x104a25=_0x104a25*0x64;_0x394934=Math[_0x4a6bd9(0xe4)](_0x104a25),_0x4cd82b=!![];}}}catch(_0x3b130b){}if(!_0x4cd82b){const _0x3840df=[{'from':_0x4a6bd9(0x142),'to':_0x4a6bd9(0x151)},{'from':_0x4a6bd9(0x142),'to':'.1.VALVE_STATE'},{'from':_0x4a6bd9(0xf6),'to':_0x4a6bd9(0x13e)},{'from':_0x4a6bd9(0x12f),'to':_0x4a6bd9(0xe5)},{'from':_0x4a6bd9(0x12e),'to':_0x4a6bd9(0x11d)},{'from':_0x4a6bd9(0xed),'to':_0x4a6bd9(0x100)}];for(const _0x383a49 of _0x3840df){if(_0x31a958[_0x4a6bd9(0x133)](_0x383a49[_0x4a6bd9(0x117)])){const _0x2926db=_0x31a958[_0x4a6bd9(0x139)](_0x383a49[_0x4a6bd9(0x117)],_0x383a49['to']);try{const _0x104987=await _0x900fda[_0x4a6bd9(0x134)](_0x2926db);if(_0x104987&&_0x104987[_0x4a6bd9(0x104)]!==null&&_0x104987[_0x4a6bd9(0x104)]!==undefined){let _0x349a17=Number(_0x104987['val']);if(typeof _0x349a17==='number'){if(_0x349a17<=1.05&&_0x383a49['to'][_0x4a6bd9(0x133)]('LEVEL'))_0x349a17=_0x349a17*0x64;_0x394934=Math[_0x4a6bd9(0xe4)](_0x349a17),_0x4cd82b=!![];break;}}}catch(_0x3e605f){}}}}const _0x217a3b=await _0x900fda[_0x4a6bd9(0x129)](_0x4a6bd9(0x11e));let _0x3d26aa=[];if(_0x217a3b&&_0x217a3b['val'])try{_0x3d26aa=JSON['parse'](_0x217a3b['val']);}catch(_0x50c805){}_0x3d26aa[_0x4a6bd9(0x125)]({'ts':Date[_0x4a6bd9(0x145)](),'room':_0x1db525||_0x4a6bd9(0xfb),'t_in':_0x4680b0,'t_out':_0xc611de,'valve':_0x394934});if(_0x3d26aa[_0x4a6bd9(0x12c)]>THERMO_LOG_SIZE)_0x3d26aa[_0x4a6bd9(0xea)]();await _0x900fda[_0x4a6bd9(0x119)](_0x4a6bd9(0x11e),{'val':JSON['stringify'](_0x3d26aa),'ack':!![]});}async function saveCompletedSequence(_0x21bb67){const _0x44debf=a5_0x2503;try{const _0x49b023=await _0x21bb67[_0x44debf(0x129)](_0x44debf(0xe7));let _0x523703=[];if(_0x49b023&&_0x49b023[_0x44debf(0x104)])try{_0x523703=JSON[_0x44debf(0x123)](_0x49b023['val']);}catch(_0x5daabe){}const _0x32f77a=activeSequence[0x0]['ts'],_0x40b2f8=activeSequence[_0x44debf(0x144)](_0x45bd88=>({'loc':_0x45bd88[_0x44debf(0x118)],'t_delta':Math[_0x44debf(0xe4)]((_0x45bd88['ts']-_0x32f77a)/0x3e8)})),_0xbadcf9={'timestamp':new Date(_0x32f77a)[_0x44debf(0xf1)](),'steps':_0x40b2f8,'duration':Math[_0x44debf(0xe4)]((activeSequence[activeSequence['length']-0x1]['ts']-_0x32f77a)/0x3e8),'daytime':new Date(_0x32f77a)['getHours']()};_0x523703[_0x44debf(0x125)](_0xbadcf9);if(_0x523703[_0x44debf(0x12c)]>MAX_TRAINING_SET_SIZE)_0x523703[_0x44debf(0xea)]();await _0x21bb67['setStateAsync']('LTM.trainingData.sequences',{'val':JSON[_0x44debf(0x126)](_0x523703),'ack':!![]}),_0x21bb67[_0x44debf(0xf9)]&&_0x21bb67[_0x44debf(0x11b)]&&_0x21bb67['sendToPythonWrapper'](_0x44debf(0x114),{'sequence':_0xbadcf9});}catch(_0x10af84){_0x21bb67['log'][_0x44debf(0x11a)]('[RECORDER]\x20Error:\x20'+_0x10af84[_0x44debf(0x103)]);}}async function recordSequence(_0x157fbf,_0x3ebfc0){const _0x4b59ea=a5_0x2503,_0x362cea=(_0x3ebfc0['type']||'')['toLowerCase'](),_0x6b704e=[_0x4b59ea(0x110),_0x4b59ea(0xf0),_0x4b59ea(0x13c),_0x4b59ea(0x12a),_0x4b59ea(0x13b),_0x4b59ea(0x149),_0x4b59ea(0x13d),_0x4b59ea(0x108),_0x4b59ea(0x138),_0x4b59ea(0xfd),_0x4b59ea(0x155),'light','licht',_0x4b59ea(0x10a),_0x4b59ea(0xec),_0x4b59ea(0x14f),_0x4b59ea(0x127)];if(!_0x6b704e[_0x4b59ea(0x12d)](_0x42c6c1=>_0x362cea['includes'](_0x42c6c1)))return;if(!_0x3ebfc0[_0x4b59ea(0x135)])return;if(sequenceTimer)clearTimeout(sequenceTimer);activeSequence['push']({'loc':_0x3ebfc0['location']||'Unknown','id':_0x3ebfc0['id'],'ts':Date['now']()}),sequenceTimer=setTimeout(async()=>{if(activeSequence['length']>0x1)await saveCompletedSequence(_0x157fbf);activeSequence=[];},SEQUENCE_TIMEOUT_MS);}function startExitTimer(_0x4004d6){const _0x1311c5=a5_0x2503;abortExitTimer(_0x4004d6),_0x4004d6['isGracePeriodActive']=!![],_0x4004d6[_0x1311c5(0x128)]=setTimeout(()=>{const _0x4e3939=_0x1311c5;_0x4004d6[_0x4e3939(0xf4)]=![];},EXIT_GRACE_PERIOD_SECONDS*0x3e8),_0x4004d6[_0x1311c5(0x141)]=setTimeout(()=>{setPresence(_0x4004d6,![]),_0x4004d6['exitTimer']=null;},EXIT_TIMER_MINUTES*0x3c*0x3e8);}function abortExitTimer(_0x5f3e95){const _0x1176c5=a5_0x2503;if(_0x5f3e95[_0x1176c5(0x141)])clearTimeout(_0x5f3e95['exitTimer']);if(_0x5f3e95[_0x1176c5(0x128)])clearTimeout(_0x5f3e95[_0x1176c5(0x128)]);_0x5f3e95[_0x1176c5(0x141)]=null,_0x5f3e95['exitGraceTimer']=null,_0x5f3e95[_0x1176c5(0xf4)]=![];}async function setPresence(_0x59a476,_0x39d13e){const _0x14e3c1=a5_0x2503;if(_0x59a476[_0x14e3c1(0x10c)]===_0x39d13e)return;_0x59a476[_0x14e3c1(0x10c)]=_0x39d13e,await _0x59a476['setStateAsync'](_0x14e3c1(0xff),{'val':_0x39d13e,'ack':!![]});}async function updateHourlyActivity(_0x47a6d3){const _0x3ffc2b=a5_0x2503;let _0x324f05=new Array(0x18)[_0x3ffc2b(0xfc)](0x0),_0x5e943a=0x0;try{const _0x35c071=await _0x47a6d3[_0x3ffc2b(0x129)](_0x3ffc2b(0xf7));_0x35c071&&_0x35c071[_0x3ffc2b(0x104)]&&(_0x324f05=JSON[_0x3ffc2b(0x123)](_0x35c071[_0x3ffc2b(0x104)]),_0x5e943a=_0x35c071['ts']);}catch(_0x5b9849){}const _0x4ec794=new Date(_0x5e943a),_0x5e7e65=new Date();_0x4ec794['getDate']()!==_0x5e7e65['getDate']()&&(_0x324f05=new Array(0x18)['fill'](0x0));const _0x2c744f=_0x5e7e65[_0x3ffc2b(0x10f)]();if(_0x324f05[_0x2c744f]===undefined)_0x324f05[_0x2c744f]=0x0;_0x324f05[_0x2c744f]++,await _0x47a6d3[_0x3ffc2b(0x119)]('analysis.health.todayVector',{'val':JSON['stringify'](_0x324f05),'ack':!![]});}async function processSensorEvent(_0x160f51,_0x2d6406,_0x2e8747,_0x4678b0){const _0x536ce0=a5_0x2503;if(!_0x4678b0)return null;const _0x2dc600=_0x2e8747[_0x536ce0(0x104)],_0x3e59f8=Date[_0x536ce0(0x145)](),_0x124403=_0x160f51['sensorLastValues'][_0x2d6406],_0x162f53=(_0x4678b0[_0x536ce0(0x10e)]||'')['toLowerCase'](),_0x382e03=_0x162f53[_0x536ce0(0x133)](_0x536ce0(0x12e))||_0x162f53[_0x536ce0(0x133)](_0x536ce0(0xe6))||_0x162f53[_0x536ce0(0x133)](_0x536ce0(0x111))||_0x162f53['includes']('heizung')||_0x162f53['includes'](_0x536ce0(0x121));if(_0x382e03&&typeof _0x2dc600==='number'){if(_0x2dc600>0x50||_0x2dc600<-0x32)return _0x160f51[_0x536ce0(0x13a)][_0x536ce0(0x11f)](_0x536ce0(0x146)+_0x2dc600+_0x536ce0(0x153)+_0x2d6406),null;}_0x160f51[_0x536ce0(0x11c)][_0x2d6406]=_0x2dc600;if(!_0x4678b0['logDuplicates']&&_0x124403!=undefined&&_0x124403==_0x2dc600)return null;_0x160f51[_0x536ce0(0xf9)]&&_0x382e03&&recordThermodynamics(_0x160f51,_0x2d6406,_0x2dc600,_0x4678b0[_0x536ce0(0x124)]);const _0x3f97b4={'timestamp':_0x3e59f8,'id':_0x2d6406,'name':_0x4678b0[_0x536ce0(0x131)],'type':_0x4678b0[_0x536ce0(0x10e)],'location':_0x4678b0[_0x536ce0(0x124)],'value':_0x2dc600};_0x160f51[_0x536ce0(0x105)][_0x536ce0(0x154)](_0x3f97b4);if(_0x160f51['eventHistory'][_0x536ce0(0x12c)]>HISTORY_MAX_SIZE)_0x160f51[_0x536ce0(0x105)][_0x536ce0(0x14a)]();await _0x160f51['setStateAsync']('events.lastEvent',{'val':JSON['stringify'](_0x3f97b4),'ack':!![]}),await _0x160f51[_0x536ce0(0x119)]('events.history',{'val':JSON[_0x536ce0(0x126)](_0x160f51[_0x536ce0(0x105)]),'ack':!![]}),await updateHourlyActivity(_0x160f51);if(_0x160f51[_0x536ce0(0xf9)]){_0x160f51['rawEventLog']['push'](_0x3f97b4);if(_0x160f51[_0x536ce0(0xeb)][_0x536ce0(0x12c)]>RAW_LOG_MAX_SIZE)_0x160f51[_0x536ce0(0xeb)][_0x536ce0(0x150)](0x0,_0x160f51[_0x536ce0(0xeb)]['length']-RAW_LOG_MAX_SIZE);await _0x160f51[_0x536ce0(0x119)](_0x536ce0(0xf3),{'val':JSON[_0x536ce0(0x126)](_0x160f51['rawEventLog']),'ack':!![]}),recordSequence(_0x160f51,_0x3f97b4);}if(_0x4678b0['isExit']&&_0x2dc600===!![]){if(_0x160f51[_0x536ce0(0x10c)]&&!_0x160f51[_0x536ce0(0xf4)])startExitTimer(_0x160f51);else{if(!_0x160f51[_0x536ce0(0x10c)])setPresence(_0x160f51,!![]);}}else{if(_0x4678b0[_0x536ce0(0x10e)]===_0x536ce0(0x110)&&_0x2dc600===!![]){if(_0x160f51[_0x536ce0(0x141)])abortExitTimer(_0x160f51);if(!_0x160f51['isPresent']&&_0x160f51[_0x536ce0(0x152)]===_0x536ce0(0x112))setPresence(_0x160f51,!![]);}}if(_0x160f51[_0x536ce0(0xf9)]&&_0x160f51['sendToPythonWrapper']){_0x4678b0[_0x536ce0(0x10e)]===_0x536ce0(0x110)&&_0x2dc600===!![]&&_0x4678b0['location']&&_0x160f51[_0x536ce0(0x11b)](_0x536ce0(0xef),{'room':_0x4678b0['location']});const _0x35fa27=['door','t체r',_0x536ce0(0x108),_0x536ce0(0x138),'griff',_0x536ce0(0x140),_0x536ce0(0x101),_0x536ce0(0xfa)]['some'](_0x974a2e=>_0x162f53[_0x536ce0(0x133)](_0x974a2e)),_0xf60065=[_0x536ce0(0x10b),'licht',_0x536ce0(0x10a),_0x536ce0(0xec),'dimmer','lampe']['some'](_0x217760=>_0x162f53[_0x536ce0(0x133)](_0x217760)),_0x86b69e=['motion','bewegung','pr채senz',_0x536ce0(0x12a),_0x536ce0(0x13b)][_0x536ce0(0x12d)](_0x1068f5=>_0x162f53[_0x536ce0(0x133)](_0x1068f5));if(_0x4678b0[_0x536ce0(0x124)]&&(_0x35fa27||_0xf60065||_0x86b69e)){const _0x3885f5=_0x2dc600===!![]||typeof _0x2dc600===_0x536ce0(0x122)&&_0x2dc600>0x0,_0x334245=_0x35fa27&&!_0x3885f5&&_0x124403!==undefined&&_0x124403!=_0x2dc600;if(_0x3885f5||_0x334245){const _0x37cfd5=_0x160f51[_0x536ce0(0x107)]||_0x3e59f8,_0x284825=(_0x3e59f8-_0x37cfd5)/0x3e8;_0x160f51[_0x536ce0(0x107)]=_0x3e59f8,_0x160f51[_0x536ce0(0x11b)](_0x536ce0(0x102),{'room':_0x4678b0['location'],'dt':_0x284825});}}}return _0x3f97b4;}module[a5_0x502869(0x132)]={'processSensorEvent':processSensorEvent,'getOutsideTemperatureNumeric':getOutsideTemperatureNumeric,'setPresence':setPresence,'abortExitTimer':abortExitTimer,'startExitTimer':startExitTimer};