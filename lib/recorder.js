const a5_0x4154bc=a5_0x3e1d;(function(_0x28263e,_0x3fa897){const _0x25a6c1=a5_0x3e1d,_0x31a747=_0x28263e();while(!![]){try{const _0x217d40=-parseInt(_0x25a6c1(0xb5))/0x1+parseInt(_0x25a6c1(0xbf))/0x2*(-parseInt(_0x25a6c1(0x7f))/0x3)+-parseInt(_0x25a6c1(0xae))/0x4*(parseInt(_0x25a6c1(0xc1))/0x5)+parseInt(_0x25a6c1(0xb8))/0x6*(parseInt(_0x25a6c1(0xe6))/0x7)+parseInt(_0x25a6c1(0xa4))/0x8+parseInt(_0x25a6c1(0xab))/0x9*(-parseInt(_0x25a6c1(0x98))/0xa)+parseInt(_0x25a6c1(0x84))/0xb;if(_0x217d40===_0x3fa897)break;else _0x31a747['push'](_0x31a747['shift']());}catch(_0x4f00b3){_0x31a747['push'](_0x31a747['shift']());}}}(a5_0x149f,0x85a60));const a5_0x40292a=(function(){let _0x4ebe28=!![];return function(_0x42a190,_0x4fb099){const _0x567ad1=_0x4ebe28?function(){const _0x3980c5=a5_0x3e1d;if(_0x4fb099){const _0x1df0d5=_0x4fb099[_0x3980c5(0xc3)](_0x42a190,arguments);return _0x4fb099=null,_0x1df0d5;}}:function(){};return _0x4ebe28=![],_0x567ad1;};}()),a5_0x3fa429=a5_0x40292a(this,function(){const _0x843059=a5_0x3e1d;return a5_0x3fa429[_0x843059(0xcf)]()['search'](_0x843059(0xe3))['toString']()[_0x843059(0xcd)](a5_0x3fa429)[_0x843059(0xa5)](_0x843059(0xe3));});a5_0x3fa429();'use strict';function a5_0x149f(){const _0x290d0e=['valveMapping','temperature','pop','type','schalter','shift','parse','map','some','setStateAsync','getForeignStateAsync','toLowerCase','loc','sensorLastValues','fenster','switch','(((.+)+)+)+$','getDate','STATE','4486216zuXuBZ','string','name','Unknown','rawEventLog','light','door','lastTrackerEventTime','now','6gAKkMw','.Current.Temperature','events.history','fill','dimmer','15151125KCTOgQ','analysis.health.todayVector','[RECORDER]\x20Ignored\x20implausible\x20temperature:\x20','LTM.trainingData.sequences','.1.ACTUAL_TEMPERATURE','.1.LEVEL','push','isGracePeriodActive','presence','.1.VALVE_STATE','.1.TEMPERATURE','kontakt','location','round','replace','LTM.trainingData.thermodynamics','from','tür','exitTimer','config','383030vstYOk','number','debug','ANALYZE_SEQUENCE','.NextHours.Location_1.Day_1.current.temp_value','isExit','val','eventHistory','length','.LEVEL','window','.forecast.current.temperature','3131464xbYPdD','search','heizung','occupancy','licht','getHours','exports','9xAzpOL','message','motion','647864JSbJhD','SIMULATE_SIGNAL','isProVersion','includes','useWeather','TRACK_EVENT','weatherInstance','580933FUlkwX','splice','log','6mdVOKN','stringify','sendToPythonWrapper','schloss','bewegung','contact','getStateAsync','757138XNuweP','system.isPresent','15HcYOeg','.ACTUAL_TEMPERATURE','apply','LTM.rawEventLog','toISOString','exitGraceTimer','thermostat','präsenz','unshift','currentSystemMode','LEVEL','.forecast.current.temp','constructor','lock','toString','Valve','logDuplicates','isPresent'];a5_0x149f=function(){return _0x290d0e;};return a5_0x149f();}const HISTORY_MAX_SIZE=0x32,RAW_LOG_MAX_SIZE=0x9c4,THERMO_LOG_SIZE=0x3e8,SEQUENCE_TIMEOUT_MS=0x5*0x3c*0x3e8,MAX_TRAINING_SET_SIZE=0x1f4,EXIT_TIMER_MINUTES=0xf,EXIT_GRACE_PERIOD_SECONDS=0x1e;let activeSequence=[],sequenceTimer=null;function a5_0x3e1d(_0x457ff1,_0x307e38){const _0x530bd7=a5_0x149f();return a5_0x3e1d=function(_0x3fa429,_0x40292a){_0x3fa429=_0x3fa429-0x79;let _0x149fb1=_0x530bd7[_0x3fa429];return _0x149fb1;},a5_0x3e1d(_0x457ff1,_0x307e38);}async function getOutsideTemperatureNumeric(_0x27c868){const _0x39a183=a5_0x3e1d;if(_0x27c868[_0x39a183(0x97)]['outdoorSensorId'])try{const _0x1b9cd6=await _0x27c868[_0x39a183(0xdd)](_0x27c868[_0x39a183(0x97)]['outdoorSensorId']);if(_0x1b9cd6&&_0x1b9cd6[_0x39a183(0x9e)]!==undefined&&_0x1b9cd6[_0x39a183(0x9e)]!==null)return parseFloat(_0x1b9cd6[_0x39a183(0x9e)]);}catch(_0x5a03f4){}const _0x370bef=_0x27c868[_0x39a183(0x97)][_0x39a183(0xb4)];if(!_0x27c868[_0x39a183(0x97)][_0x39a183(0xb2)]||!_0x370bef)return null;try{let _0x3c951b='';if(_0x370bef[_0x39a183(0xb1)]('accuweather'))_0x3c951b=_0x370bef+_0x39a183(0x80);else{if(_0x370bef[_0x39a183(0xb1)]('daswetter'))_0x3c951b=_0x370bef+_0x39a183(0x9c);else{if(_0x370bef[_0x39a183(0xb1)]('openweathermap'))_0x3c951b=_0x370bef+_0x39a183(0xa3);else{if(_0x370bef[_0x39a183(0xb1)]('weatherunderground'))_0x3c951b=_0x370bef+_0x39a183(0xcc);}}}if(_0x3c951b){const _0x50dbb4=await _0x27c868[_0x39a183(0xdd)](_0x3c951b);if(_0x50dbb4&&_0x50dbb4[_0x39a183(0x9e)]!==undefined&&_0x50dbb4[_0x39a183(0x9e)]!==null)return parseFloat(_0x50dbb4[_0x39a183(0x9e)]);}}catch(_0x4e6828){}return null;}async function recordThermodynamics(_0x5d9cc3,_0x555793,_0x4ddd09,_0x23b873){const _0xbbeb71=a5_0x3e1d,_0x43b08b=await getOutsideTemperatureNumeric(_0x5d9cc3);if(_0x43b08b===null)return;let _0x557887=0x0,_0x288fe6=![];if(_0x5d9cc3[_0xbbeb71(0x97)][_0xbbeb71(0xd3)])try{let _0x3f55a5=_0x5d9cc3[_0xbbeb71(0x97)][_0xbbeb71(0xd3)];if(typeof _0x3f55a5===_0xbbeb71(0xe7))_0x3f55a5=JSON[_0xbbeb71(0xd9)](_0x3f55a5);if(_0x3f55a5[_0x555793]){const _0x548be6=_0x3f55a5[_0x555793],_0x32a2b4=await _0x5d9cc3[_0xbbeb71(0xdd)](_0x548be6);if(_0x32a2b4&&_0x32a2b4['val']!==null&&_0x32a2b4[_0xbbeb71(0x9e)]!==undefined){let _0x4dde45=Number(_0x32a2b4[_0xbbeb71(0x9e)]);if(_0x4dde45<=1.05&&!_0x548be6[_0xbbeb71(0xb1)]('STATUS')&&!_0x548be6[_0xbbeb71(0xb1)](_0xbbeb71(0xe5)))_0x4dde45=_0x4dde45*0x64;_0x557887=Math['round'](_0x4dde45),_0x288fe6=!![];}}}catch(_0x4a8dbf){}if(!_0x288fe6){const _0x5722bb=[{'from':_0xbbeb71(0x88),'to':_0xbbeb71(0x89)},{'from':_0xbbeb71(0x88),'to':_0xbbeb71(0x8d)},{'from':_0xbbeb71(0x8e),'to':'.4.VALVE_STATE'},{'from':_0xbbeb71(0xc2),'to':_0xbbeb71(0xa1)},{'from':_0xbbeb71(0xd4),'to':'level'},{'from':'Temperature','to':_0xbbeb71(0xd0)}];for(const _0x3de031 of _0x5722bb){if(_0x555793[_0xbbeb71(0xb1)](_0x3de031['from'])){const _0x125366=_0x555793[_0xbbeb71(0x92)](_0x3de031[_0xbbeb71(0x94)],_0x3de031['to']);try{const _0x152363=await _0x5d9cc3[_0xbbeb71(0xdd)](_0x125366);if(_0x152363&&_0x152363[_0xbbeb71(0x9e)]!==null&&_0x152363['val']!==undefined){let _0x255792=Number(_0x152363[_0xbbeb71(0x9e)]);if(typeof _0x255792==='number'){if(_0x255792<=1.05&&_0x3de031['to'][_0xbbeb71(0xb1)](_0xbbeb71(0xcb)))_0x255792=_0x255792*0x64;_0x557887=Math['round'](_0x255792),_0x288fe6=!![];break;}}}catch(_0x141467){}}}}const _0x4aa8c7=await _0x5d9cc3[_0xbbeb71(0xbe)](_0xbbeb71(0x93));let _0x212f64=[];if(_0x4aa8c7&&_0x4aa8c7[_0xbbeb71(0x9e)])try{_0x212f64=JSON[_0xbbeb71(0xd9)](_0x4aa8c7[_0xbbeb71(0x9e)]);}catch(_0x4dc71b){}_0x212f64[_0xbbeb71(0x8a)]({'ts':Date[_0xbbeb71(0x7e)](),'room':_0x23b873||_0xbbeb71(0x79),'t_in':_0x4ddd09,'t_out':_0x43b08b,'valve':_0x557887});if(_0x212f64['length']>THERMO_LOG_SIZE)_0x212f64[_0xbbeb71(0xd8)]();await _0x5d9cc3[_0xbbeb71(0xdc)]('LTM.trainingData.thermodynamics',{'val':JSON[_0xbbeb71(0xb9)](_0x212f64),'ack':!![]});}async function saveCompletedSequence(_0x145676){const _0x83ccdd=a5_0x3e1d;try{const _0x387a09=await _0x145676[_0x83ccdd(0xbe)](_0x83ccdd(0x87));let _0x3adc1b=[];if(_0x387a09&&_0x387a09[_0x83ccdd(0x9e)])try{_0x3adc1b=JSON[_0x83ccdd(0xd9)](_0x387a09[_0x83ccdd(0x9e)]);}catch(_0x5c193b){}const _0x4b318d=activeSequence[0x0]['ts'],_0x3e6d85=activeSequence[_0x83ccdd(0xda)](_0x282043=>({'loc':_0x282043[_0x83ccdd(0xdf)],'t_delta':Math[_0x83ccdd(0x91)]((_0x282043['ts']-_0x4b318d)/0x3e8)})),_0x1781e9={'timestamp':new Date(_0x4b318d)[_0x83ccdd(0xc5)](),'steps':_0x3e6d85,'duration':Math[_0x83ccdd(0x91)]((activeSequence[activeSequence[_0x83ccdd(0xa0)]-0x1]['ts']-_0x4b318d)/0x3e8),'daytime':new Date(_0x4b318d)['getHours']()};_0x3adc1b[_0x83ccdd(0x8a)](_0x1781e9);if(_0x3adc1b['length']>MAX_TRAINING_SET_SIZE)_0x3adc1b[_0x83ccdd(0xd8)]();await _0x145676[_0x83ccdd(0xdc)](_0x83ccdd(0x87),{'val':JSON[_0x83ccdd(0xb9)](_0x3adc1b),'ack':!![]}),_0x145676['isProVersion']&&_0x145676[_0x83ccdd(0xba)]&&_0x145676[_0x83ccdd(0xba)](_0x83ccdd(0x9b),{'sequence':_0x1781e9});}catch(_0xa5d9e9){_0x145676['log']['error']('[RECORDER]\x20Error:\x20'+_0xa5d9e9[_0x83ccdd(0xac)]);}}async function recordSequence(_0x4ce815,_0x1921bd){const _0x2fa5b8=a5_0x3e1d,_0x3cf3bd=(_0x1921bd[_0x2fa5b8(0xd6)]||'')[_0x2fa5b8(0xde)](),_0x281f23=[_0x2fa5b8(0xad),'bewegung',_0x2fa5b8(0xc8),_0x2fa5b8(0x8c),_0x2fa5b8(0xa7),_0x2fa5b8(0x7c),_0x2fa5b8(0x95),_0x2fa5b8(0xa2),_0x2fa5b8(0xe1),_0x2fa5b8(0xbd),_0x2fa5b8(0x8f),'light',_0x2fa5b8(0xa8),_0x2fa5b8(0xe2),'schalter',_0x2fa5b8(0x83),'lampe'];if(!_0x281f23['some'](_0x38bea7=>_0x3cf3bd[_0x2fa5b8(0xb1)](_0x38bea7)))return;if(!_0x1921bd['value'])return;if(sequenceTimer)clearTimeout(sequenceTimer);activeSequence['push']({'loc':_0x1921bd[_0x2fa5b8(0x90)]||_0x2fa5b8(0x79),'id':_0x1921bd['id'],'ts':Date['now']()}),sequenceTimer=setTimeout(async()=>{const _0x50fc45=_0x2fa5b8;if(activeSequence[_0x50fc45(0xa0)]>0x1)await saveCompletedSequence(_0x4ce815);activeSequence=[];},SEQUENCE_TIMEOUT_MS);}function startExitTimer(_0x32c25d){const _0x34c9d7=a5_0x3e1d;abortExitTimer(_0x32c25d),_0x32c25d[_0x34c9d7(0x8b)]=!![],_0x32c25d[_0x34c9d7(0xc6)]=setTimeout(()=>{const _0x92914e=_0x34c9d7;_0x32c25d[_0x92914e(0x8b)]=![];},EXIT_GRACE_PERIOD_SECONDS*0x3e8),_0x32c25d[_0x34c9d7(0x96)]=setTimeout(()=>{const _0x2d0b46=_0x34c9d7;setPresence(_0x32c25d,![]),_0x32c25d[_0x2d0b46(0x96)]=null;},EXIT_TIMER_MINUTES*0x3c*0x3e8);}function abortExitTimer(_0xd222a0){const _0x13ab89=a5_0x3e1d;if(_0xd222a0[_0x13ab89(0x96)])clearTimeout(_0xd222a0[_0x13ab89(0x96)]);if(_0xd222a0[_0x13ab89(0xc6)])clearTimeout(_0xd222a0[_0x13ab89(0xc6)]);_0xd222a0['exitTimer']=null,_0xd222a0[_0x13ab89(0xc6)]=null,_0xd222a0[_0x13ab89(0x8b)]=![];}async function setPresence(_0x3ffa76,_0x501af6){const _0xd80724=a5_0x3e1d;if(_0x3ffa76[_0xd80724(0xd2)]===_0x501af6)return;_0x3ffa76['isPresent']=_0x501af6,await _0x3ffa76[_0xd80724(0xdc)](_0xd80724(0xc0),{'val':_0x501af6,'ack':!![]});}async function updateHourlyActivity(_0x18bd4d){const _0x1da077=a5_0x3e1d;let _0x33c53e=new Array(0x18)[_0x1da077(0x82)](0x0),_0x1560b1=0x0;try{const _0x130a13=await _0x18bd4d[_0x1da077(0xbe)](_0x1da077(0x85));_0x130a13&&_0x130a13[_0x1da077(0x9e)]&&(_0x33c53e=JSON[_0x1da077(0xd9)](_0x130a13['val']),_0x1560b1=_0x130a13['ts']);}catch(_0x4fe855){}const _0xf78bfd=new Date(_0x1560b1),_0x2dbd17=new Date();_0xf78bfd[_0x1da077(0xe4)]()!==_0x2dbd17[_0x1da077(0xe4)]()&&(_0x33c53e=new Array(0x18)[_0x1da077(0x82)](0x0));const _0x35b1e7=_0x2dbd17[_0x1da077(0xa9)]();if(_0x33c53e[_0x35b1e7]===undefined)_0x33c53e[_0x35b1e7]=0x0;_0x33c53e[_0x35b1e7]++,await _0x18bd4d[_0x1da077(0xdc)](_0x1da077(0x85),{'val':JSON[_0x1da077(0xb9)](_0x33c53e),'ack':!![]});}async function processSensorEvent(_0x37fd16,_0x4ac649,_0xd5e035,_0x2edcce){const _0x2d0698=a5_0x3e1d;if(!_0x2edcce)return null;const _0x58e9b3=_0xd5e035[_0x2d0698(0x9e)],_0x38aacc=Date['now'](),_0x3efcc8=_0x37fd16[_0x2d0698(0xe0)][_0x4ac649],_0x31b29c=(_0x2edcce[_0x2d0698(0xd6)]||'')[_0x2d0698(0xde)](),_0x28dcf0=_0x31b29c[_0x2d0698(0xb1)](_0x2d0698(0xd4))||_0x31b29c['includes']('temperatur')||_0x31b29c[_0x2d0698(0xb1)]('klima')||_0x31b29c[_0x2d0698(0xb1)](_0x2d0698(0xa6))||_0x31b29c['includes'](_0x2d0698(0xc7));if(_0x28dcf0&&typeof _0x58e9b3===_0x2d0698(0x99)){if(_0x58e9b3>0x50||_0x58e9b3<-0x32)return _0x37fd16[_0x2d0698(0xb7)][_0x2d0698(0x9a)](_0x2d0698(0x86)+_0x58e9b3+'\x20from\x20'+_0x4ac649),null;}_0x37fd16[_0x2d0698(0xe0)][_0x4ac649]=_0x58e9b3;if(!_0x2edcce[_0x2d0698(0xd1)]&&_0x3efcc8!=undefined&&_0x3efcc8==_0x58e9b3)return null;_0x37fd16['isProVersion']&&_0x28dcf0&&recordThermodynamics(_0x37fd16,_0x4ac649,_0x58e9b3,_0x2edcce['location']);const _0x72bc23={'timestamp':_0x38aacc,'id':_0x4ac649,'name':_0x2edcce[_0x2d0698(0xe8)],'type':_0x2edcce[_0x2d0698(0xd6)],'location':_0x2edcce[_0x2d0698(0x90)],'value':_0x58e9b3};_0x37fd16[_0x2d0698(0x9f)][_0x2d0698(0xc9)](_0x72bc23);if(_0x37fd16['eventHistory']['length']>HISTORY_MAX_SIZE)_0x37fd16[_0x2d0698(0x9f)][_0x2d0698(0xd5)]();await _0x37fd16[_0x2d0698(0xdc)]('events.lastEvent',{'val':JSON['stringify'](_0x72bc23),'ack':!![]}),await _0x37fd16['setStateAsync'](_0x2d0698(0x81),{'val':JSON['stringify'](_0x37fd16['eventHistory']),'ack':!![]}),await updateHourlyActivity(_0x37fd16);if(_0x37fd16[_0x2d0698(0xb0)]){_0x37fd16[_0x2d0698(0x7a)][_0x2d0698(0x8a)](_0x72bc23);if(_0x37fd16[_0x2d0698(0x7a)][_0x2d0698(0xa0)]>RAW_LOG_MAX_SIZE)_0x37fd16[_0x2d0698(0x7a)][_0x2d0698(0xb6)](0x0,_0x37fd16[_0x2d0698(0x7a)][_0x2d0698(0xa0)]-RAW_LOG_MAX_SIZE);await _0x37fd16[_0x2d0698(0xdc)](_0x2d0698(0xc4),{'val':JSON[_0x2d0698(0xb9)](_0x37fd16[_0x2d0698(0x7a)]),'ack':!![]}),recordSequence(_0x37fd16,_0x72bc23);}if(_0x2edcce[_0x2d0698(0x9d)]&&_0x58e9b3===!![]){if(_0x37fd16[_0x2d0698(0xd2)]&&!_0x37fd16['isGracePeriodActive'])startExitTimer(_0x37fd16);else{if(!_0x37fd16[_0x2d0698(0xd2)])setPresence(_0x37fd16,!![]);}}else{if(_0x2edcce[_0x2d0698(0xd6)]===_0x2d0698(0xad)&&_0x58e9b3===!![]){if(_0x37fd16[_0x2d0698(0x96)])abortExitTimer(_0x37fd16);if(!_0x37fd16[_0x2d0698(0xd2)]&&_0x37fd16[_0x2d0698(0xca)]==='normal')setPresence(_0x37fd16,!![]);}}if(_0x37fd16[_0x2d0698(0xb0)]&&_0x37fd16[_0x2d0698(0xba)]){_0x2edcce['type']===_0x2d0698(0xad)&&_0x58e9b3===!![]&&_0x2edcce['location']&&_0x37fd16[_0x2d0698(0xba)](_0x2d0698(0xaf),{'room':_0x2edcce[_0x2d0698(0x90)]});const _0x1cbafe=[_0x2d0698(0x7c),'tür',_0x2d0698(0xa2),'fenster','griff','handle',_0x2d0698(0xce),_0x2d0698(0xbb)][_0x2d0698(0xdb)](_0x366e03=>_0x31b29c[_0x2d0698(0xb1)](_0x366e03)),_0x573124=[_0x2d0698(0x7b),'licht',_0x2d0698(0xe2),_0x2d0698(0xd7),'dimmer','lampe'][_0x2d0698(0xdb)](_0x7ca4fd=>_0x31b29c[_0x2d0698(0xb1)](_0x7ca4fd)),_0x498a1a=[_0x2d0698(0xad),_0x2d0698(0xbc),_0x2d0698(0xc8),'presence',_0x2d0698(0xa7)][_0x2d0698(0xdb)](_0x5c7bbd=>_0x31b29c[_0x2d0698(0xb1)](_0x5c7bbd));if(_0x2edcce[_0x2d0698(0x90)]&&(_0x1cbafe||_0x573124||_0x498a1a)){const _0x40e8c7=_0x58e9b3===!![]||typeof _0x58e9b3==='number'&&_0x58e9b3>0x0,_0x522795=_0x1cbafe&&!_0x40e8c7&&_0x3efcc8!==undefined&&_0x3efcc8!=_0x58e9b3;if(_0x40e8c7||_0x522795){const _0x1a0f97=_0x37fd16[_0x2d0698(0x7d)]||_0x38aacc,_0x41802f=(_0x38aacc-_0x1a0f97)/0x3e8;_0x37fd16[_0x2d0698(0x7d)]=_0x38aacc,_0x37fd16[_0x2d0698(0xba)](_0x2d0698(0xb3),{'room':_0x2edcce[_0x2d0698(0x90)],'dt':_0x41802f});}}}return _0x72bc23;}module[a5_0x4154bc(0xaa)]={'processSensorEvent':processSensorEvent,'getOutsideTemperatureNumeric':getOutsideTemperatureNumeric,'setPresence':setPresence,'abortExitTimer':abortExitTimer,'startExitTimer':startExitTimer};