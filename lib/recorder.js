const a5_0x5bc0a0=a5_0x21d2;(function(_0x364dd9,_0x582b26){const _0x59c126=a5_0x21d2,_0x3d6376=_0x364dd9();while(!![]){try{const _0x516d50=-parseInt(_0x59c126(0x165))/0x1+parseInt(_0x59c126(0x150))/0x2+parseInt(_0x59c126(0x13f))/0x3+-parseInt(_0x59c126(0x138))/0x4+parseInt(_0x59c126(0x133))/0x5*(parseInt(_0x59c126(0x15b))/0x6)+-parseInt(_0x59c126(0x143))/0x7+-parseInt(_0x59c126(0x130))/0x8*(-parseInt(_0x59c126(0x136))/0x9);if(_0x516d50===_0x582b26)break;else _0x3d6376['push'](_0x3d6376['shift']());}catch(_0x5bd84d){_0x3d6376['push'](_0x3d6376['shift']());}}}(a5_0x22dc,0x5fdde));function a5_0x22dc(){const _0x2bf270=['ANALYZE_SEQUENCE','apply','weatherInstance','presence','name','setStateAsync','bewegung','getForeignStateAsync','message','lampe','exitGraceTimer','toString','toISOString','tür','replace','präsenz','includes','Temperature','getHours','eventHistory','log','1160472eYwUlF','pop','openweathermap','1357530AlVCTO','.1.LEVEL','[RECORDER]\x20Error:\x20','9cZYgLK','toLowerCase','708164HJUAmo','val','STATUS','level','switch','search','.4.VALVE_STATE','1233879wtwnLk','length','from','exports','2157799AcuHGf','.1.ACTUAL_TEMPERATURE','(((.+)+)+)+$','system.isPresent','.forecast.current.temperature','getStateAsync','logDuplicates','klima','dimmer','stringify','isPresent','SIMULATE_SIGNAL','isGracePeriodActive','1315846qXvBBr','LTM.trainingData.thermodynamics','motion','outdoorSensorId','splice','accuweather','.ACTUAL_TEMPERATURE','error','fenster','loc','kontakt','6hYENEX','parse','temperature','contact','valveMapping','exitTimer','location','sensorLastValues','now','value','607813pYwHen','Valve','Unknown','occupancy','sendToPythonWrapper','daswetter','light','config','LTM.trainingData.sequences','rawEventLog','push','some','temperatur','window','isProVersion','map','type','shift','events.history','round'];a5_0x22dc=function(){return _0x2bf270;};return a5_0x22dc();}const a5_0x3da428=(function(){let _0x4f46a2=!![];return function(_0x262ecc,_0x19476b){const _0x2adc30=_0x4f46a2?function(){const _0x57acb3=a5_0x21d2;if(_0x19476b){const _0x23e383=_0x19476b[_0x57acb3(0x11c)](_0x262ecc,arguments);return _0x19476b=null,_0x23e383;}}:function(){};return _0x4f46a2=![],_0x2adc30;};}()),a5_0x33f50e=a5_0x3da428(this,function(){const _0x13ba48=a5_0x21d2;return a5_0x33f50e['toString']()['search'](_0x13ba48(0x145))[_0x13ba48(0x126)]()['constructor'](a5_0x33f50e)[_0x13ba48(0x13d)](_0x13ba48(0x145));});function a5_0x21d2(_0x182b31,_0x2e6d92){const _0x255b2c=a5_0x22dc();return a5_0x21d2=function(_0x33f50e,_0x3da428){_0x33f50e=_0x33f50e-0x112;let _0x22dc7a=_0x255b2c[_0x33f50e];return _0x22dc7a;},a5_0x21d2(_0x182b31,_0x2e6d92);}a5_0x33f50e();'use strict';const HISTORY_MAX_SIZE=0x32,RAW_LOG_MAX_SIZE=0x9c4,THERMO_LOG_SIZE=0x3e8,SEQUENCE_TIMEOUT_MS=0x5*0x3c*0x3e8,MAX_TRAINING_SET_SIZE=0x1f4,EXIT_TIMER_MINUTES=0xf,EXIT_GRACE_PERIOD_SECONDS=0x1e;let activeSequence=[],sequenceTimer=null;async function getOutsideTemperatureNumeric(_0x46db5b){const _0x43ed70=a5_0x21d2;if(_0x46db5b['config'][_0x43ed70(0x153)])try{const _0x423719=await _0x46db5b[_0x43ed70(0x122)](_0x46db5b[_0x43ed70(0x16c)][_0x43ed70(0x153)]);if(_0x423719&&_0x423719[_0x43ed70(0x139)]!==undefined&&_0x423719[_0x43ed70(0x139)]!==null)return parseFloat(_0x423719[_0x43ed70(0x139)]);}catch(_0x49d421){}const _0x4f6b3b=_0x46db5b[_0x43ed70(0x16c)][_0x43ed70(0x11d)];if(!_0x46db5b[_0x43ed70(0x16c)]['useWeather']||!_0x4f6b3b)return null;try{let _0x56b682='';if(_0x4f6b3b[_0x43ed70(0x12b)](_0x43ed70(0x155)))_0x56b682=_0x4f6b3b+'.Current.Temperature';else{if(_0x4f6b3b[_0x43ed70(0x12b)](_0x43ed70(0x16a)))_0x56b682=_0x4f6b3b+'.NextHours.Location_1.Day_1.current.temp_value';else{if(_0x4f6b3b['includes'](_0x43ed70(0x132)))_0x56b682=_0x4f6b3b+_0x43ed70(0x147);else{if(_0x4f6b3b['includes']('weatherunderground'))_0x56b682=_0x4f6b3b+'.forecast.current.temp';}}}if(_0x56b682){const _0x31ec00=await _0x46db5b[_0x43ed70(0x122)](_0x56b682);if(_0x31ec00&&_0x31ec00['val']!==undefined&&_0x31ec00['val']!==null)return parseFloat(_0x31ec00[_0x43ed70(0x139)]);}}catch(_0x346a2b){}return null;}async function recordThermodynamics(_0x4eea2f,_0x687326,_0x135d3f,_0x145290){const _0xee9769=a5_0x21d2,_0x2a8d4b=await getOutsideTemperatureNumeric(_0x4eea2f);if(_0x2a8d4b===null)return;let _0x122242=0x0,_0x35f234=![];if(_0x4eea2f[_0xee9769(0x16c)]['valveMapping'])try{let _0x44d13b=_0x4eea2f[_0xee9769(0x16c)][_0xee9769(0x15f)];if(typeof _0x44d13b==='string')_0x44d13b=JSON[_0xee9769(0x15c)](_0x44d13b);if(_0x44d13b[_0x687326]){const _0x565b7d=_0x44d13b[_0x687326],_0x20627=await _0x4eea2f[_0xee9769(0x122)](_0x565b7d);if(_0x20627&&_0x20627['val']!==null&&_0x20627[_0xee9769(0x139)]!==undefined){let _0x4074ae=Number(_0x20627[_0xee9769(0x139)]);if(_0x4074ae<=1.05&&!_0x565b7d[_0xee9769(0x12b)](_0xee9769(0x13a))&&!_0x565b7d['includes']('STATE'))_0x4074ae=_0x4074ae*0x64;_0x122242=Math[_0xee9769(0x11a)](_0x4074ae),_0x35f234=!![];}}}catch(_0x51858a){}if(!_0x35f234){const _0x31419e=[{'from':'.1.ACTUAL_TEMPERATURE','to':_0xee9769(0x134)},{'from':_0xee9769(0x144),'to':'.1.VALVE_STATE'},{'from':'.1.TEMPERATURE','to':_0xee9769(0x13e)},{'from':_0xee9769(0x156),'to':'.LEVEL'},{'from':'temperature','to':_0xee9769(0x13b)},{'from':_0xee9769(0x12c),'to':_0xee9769(0x166)}];for(const _0x4b865e of _0x31419e){if(_0x687326['includes'](_0x4b865e[_0xee9769(0x141)])){const _0x4c020d=_0x687326[_0xee9769(0x129)](_0x4b865e[_0xee9769(0x141)],_0x4b865e['to']);try{const _0x5f507f=await _0x4eea2f[_0xee9769(0x122)](_0x4c020d);if(_0x5f507f&&_0x5f507f['val']!==null&&_0x5f507f[_0xee9769(0x139)]!==undefined){let _0x204104=Number(_0x5f507f[_0xee9769(0x139)]);if(typeof _0x204104==='number'){if(_0x204104<=1.05&&_0x4b865e['to'][_0xee9769(0x12b)]('LEVEL'))_0x204104=_0x204104*0x64;_0x122242=Math[_0xee9769(0x11a)](_0x204104),_0x35f234=!![];break;}}}catch(_0x462423){}}}}const _0x5d2694=await _0x4eea2f[_0xee9769(0x148)](_0xee9769(0x151));let _0x15a612=[];if(_0x5d2694&&_0x5d2694[_0xee9769(0x139)])try{_0x15a612=JSON['parse'](_0x5d2694[_0xee9769(0x139)]);}catch(_0xf258d3){}_0x15a612[_0xee9769(0x16f)]({'ts':Date[_0xee9769(0x163)](),'room':_0x145290||_0xee9769(0x167),'t_in':_0x135d3f,'t_out':_0x2a8d4b,'valve':_0x122242});if(_0x15a612[_0xee9769(0x140)]>THERMO_LOG_SIZE)_0x15a612[_0xee9769(0x118)]();await _0x4eea2f[_0xee9769(0x120)](_0xee9769(0x151),{'val':JSON[_0xee9769(0x14c)](_0x15a612),'ack':!![]});}async function saveCompletedSequence(_0x2f9efc){const _0x2537f5=a5_0x21d2;try{const _0x3222b3=await _0x2f9efc[_0x2537f5(0x148)](_0x2537f5(0x16d));let _0x191420=[];if(_0x3222b3&&_0x3222b3['val'])try{_0x191420=JSON[_0x2537f5(0x15c)](_0x3222b3['val']);}catch(_0x13e94a){}const _0x59ac36=activeSequence[0x0]['ts'],_0x3802a7=activeSequence[_0x2537f5(0x116)](_0x6387ed=>({'loc':_0x6387ed[_0x2537f5(0x159)],'t_delta':Math[_0x2537f5(0x11a)]((_0x6387ed['ts']-_0x59ac36)/0x3e8)})),_0x4760a6={'timestamp':new Date(_0x59ac36)[_0x2537f5(0x127)](),'steps':_0x3802a7,'duration':Math['round']((activeSequence[activeSequence[_0x2537f5(0x140)]-0x1]['ts']-_0x59ac36)/0x3e8),'daytime':new Date(_0x59ac36)[_0x2537f5(0x12d)]()};_0x191420[_0x2537f5(0x16f)](_0x4760a6);if(_0x191420[_0x2537f5(0x140)]>MAX_TRAINING_SET_SIZE)_0x191420[_0x2537f5(0x118)]();await _0x2f9efc[_0x2537f5(0x120)](_0x2537f5(0x16d),{'val':JSON[_0x2537f5(0x14c)](_0x191420),'ack':!![]}),_0x2f9efc[_0x2537f5(0x115)]&&_0x2f9efc['sendToPythonWrapper']&&_0x2f9efc[_0x2537f5(0x169)](_0x2537f5(0x11b),{'sequence':_0x4760a6});}catch(_0x118a3f){_0x2f9efc[_0x2537f5(0x12f)][_0x2537f5(0x157)](_0x2537f5(0x135)+_0x118a3f[_0x2537f5(0x123)]);}}async function recordSequence(_0x37c267,_0x128ba8){const _0x51ac92=a5_0x21d2,_0x226144=(_0x128ba8[_0x51ac92(0x117)]||'')[_0x51ac92(0x137)](),_0x10b9d3=[_0x51ac92(0x152),_0x51ac92(0x121),_0x51ac92(0x12a),_0x51ac92(0x11e),_0x51ac92(0x168),'door',_0x51ac92(0x128),_0x51ac92(0x114),_0x51ac92(0x158),_0x51ac92(0x15e),_0x51ac92(0x15a),_0x51ac92(0x16b),'licht',_0x51ac92(0x13c),'schalter',_0x51ac92(0x14b),_0x51ac92(0x124)];if(!_0x10b9d3[_0x51ac92(0x112)](_0x3cd612=>_0x226144[_0x51ac92(0x12b)](_0x3cd612)))return;if(!_0x128ba8[_0x51ac92(0x164)])return;if(sequenceTimer)clearTimeout(sequenceTimer);activeSequence[_0x51ac92(0x16f)]({'loc':_0x128ba8[_0x51ac92(0x161)]||'Unknown','id':_0x128ba8['id'],'ts':Date[_0x51ac92(0x163)]()}),sequenceTimer=setTimeout(async()=>{if(activeSequence['length']>0x1)await saveCompletedSequence(_0x37c267);activeSequence=[];},SEQUENCE_TIMEOUT_MS);}function startExitTimer(_0x1cd73a){const _0x187187=a5_0x21d2;abortExitTimer(_0x1cd73a),_0x1cd73a['isGracePeriodActive']=!![],_0x1cd73a[_0x187187(0x125)]=setTimeout(()=>{const _0x278a0a=_0x187187;_0x1cd73a[_0x278a0a(0x14f)]=![];},EXIT_GRACE_PERIOD_SECONDS*0x3e8),_0x1cd73a[_0x187187(0x160)]=setTimeout(()=>{const _0x30d03a=_0x187187;setPresence(_0x1cd73a,![]),_0x1cd73a[_0x30d03a(0x160)]=null;},EXIT_TIMER_MINUTES*0x3c*0x3e8);}function abortExitTimer(_0x159de4){const _0x2c12f4=a5_0x21d2;if(_0x159de4['exitTimer'])clearTimeout(_0x159de4[_0x2c12f4(0x160)]);if(_0x159de4[_0x2c12f4(0x125)])clearTimeout(_0x159de4[_0x2c12f4(0x125)]);_0x159de4[_0x2c12f4(0x160)]=null,_0x159de4[_0x2c12f4(0x125)]=null,_0x159de4[_0x2c12f4(0x14f)]=![];}async function setPresence(_0x4dd312,_0x5b2aed){const _0x2308dd=a5_0x21d2;if(_0x4dd312[_0x2308dd(0x14d)]===_0x5b2aed)return;_0x4dd312[_0x2308dd(0x14d)]=_0x5b2aed,await _0x4dd312[_0x2308dd(0x120)](_0x2308dd(0x146),{'val':_0x5b2aed,'ack':!![]});}async function processSensorEvent(_0x6cf050,_0x132874,_0x304d4f,_0xb0e57){const _0x486afa=a5_0x21d2;if(!_0xb0e57)return null;const _0x3ee6ae=_0x304d4f[_0x486afa(0x139)],_0x2723cb=Date[_0x486afa(0x163)](),_0x30d914=_0x6cf050[_0x486afa(0x162)][_0x132874];_0x6cf050[_0x486afa(0x162)][_0x132874]=_0x3ee6ae;if(!_0xb0e57[_0x486afa(0x149)]&&_0x30d914!=undefined&&_0x30d914==_0x3ee6ae)return null;const _0x44127d=(_0xb0e57['type']||'')[_0x486afa(0x137)](),_0x60f7ec=_0x44127d[_0x486afa(0x12b)](_0x486afa(0x15d))||_0x44127d[_0x486afa(0x12b)](_0x486afa(0x113))||_0x44127d['includes'](_0x486afa(0x14a))||_0x44127d[_0x486afa(0x12b)]('heizung')||_0x44127d['includes']('thermostat');_0x6cf050[_0x486afa(0x115)]&&_0x60f7ec&&recordThermodynamics(_0x6cf050,_0x132874,_0x3ee6ae,_0xb0e57['location']);const _0x9f14ab={'timestamp':_0x2723cb,'id':_0x132874,'name':_0xb0e57[_0x486afa(0x11f)],'type':_0xb0e57[_0x486afa(0x117)],'location':_0xb0e57[_0x486afa(0x161)],'value':_0x3ee6ae};_0x6cf050[_0x486afa(0x12e)]['unshift'](_0x9f14ab);if(_0x6cf050[_0x486afa(0x12e)][_0x486afa(0x140)]>HISTORY_MAX_SIZE)_0x6cf050[_0x486afa(0x12e)][_0x486afa(0x131)]();await _0x6cf050[_0x486afa(0x120)]('events.lastEvent',{'val':JSON[_0x486afa(0x14c)](_0x9f14ab),'ack':!![]}),await _0x6cf050['setStateAsync'](_0x486afa(0x119),{'val':JSON[_0x486afa(0x14c)](_0x6cf050[_0x486afa(0x12e)]),'ack':!![]});if(_0x6cf050[_0x486afa(0x115)]){_0x6cf050['rawEventLog'][_0x486afa(0x16f)](_0x9f14ab);if(_0x6cf050[_0x486afa(0x16e)][_0x486afa(0x140)]>RAW_LOG_MAX_SIZE)_0x6cf050[_0x486afa(0x16e)][_0x486afa(0x154)](0x0,_0x6cf050[_0x486afa(0x16e)]['length']-RAW_LOG_MAX_SIZE);await _0x6cf050[_0x486afa(0x120)]('LTM.rawEventLog',{'val':JSON[_0x486afa(0x14c)](_0x6cf050[_0x486afa(0x16e)]),'ack':!![]}),recordSequence(_0x6cf050,_0x9f14ab);}if(_0xb0e57['isExit']&&_0x3ee6ae===!![]){if(_0x6cf050[_0x486afa(0x14d)]&&!_0x6cf050[_0x486afa(0x14f)])startExitTimer(_0x6cf050);else{if(!_0x6cf050[_0x486afa(0x14d)])setPresence(_0x6cf050,!![]);}}else{if(_0xb0e57['type']===_0x486afa(0x152)&&_0x3ee6ae===!![]){if(_0x6cf050['exitTimer'])abortExitTimer(_0x6cf050);if(!_0x6cf050[_0x486afa(0x14d)]&&_0x6cf050['currentSystemMode']==='normal')setPresence(_0x6cf050,!![]);}}return _0x6cf050[_0x486afa(0x115)]&&_0xb0e57['type']===_0x486afa(0x152)&&_0x3ee6ae===!![]&&_0xb0e57['location']&&_0x6cf050[_0x486afa(0x169)]&&_0x6cf050['sendToPythonWrapper'](_0x486afa(0x14e),{'room':_0xb0e57[_0x486afa(0x161)]}),_0x9f14ab;}module[a5_0x5bc0a0(0x142)]={'processSensorEvent':processSensorEvent,'getOutsideTemperatureNumeric':getOutsideTemperatureNumeric,'setPresence':setPresence,'abortExitTimer':abortExitTimer,'startExitTimer':startExitTimer};