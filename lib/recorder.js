(function(_0x4bc31f,_0x17b346){const _0x27d902=a5_0x1f1e,_0x2ebe2f=_0x4bc31f();while(!![]){try{const _0x16046f=parseInt(_0x27d902(0xd9))/0x1+-parseInt(_0x27d902(0x8c))/0x2+parseInt(_0x27d902(0x96))/0x3*(parseInt(_0x27d902(0xc9))/0x4)+-parseInt(_0x27d902(0x8b))/0x5+parseInt(_0x27d902(0xaa))/0x6*(parseInt(_0x27d902(0x6a))/0x7)+parseInt(_0x27d902(0x8e))/0x8+-parseInt(_0x27d902(0xd2))/0x9;if(_0x16046f===_0x17b346)break;else _0x2ebe2f['push'](_0x2ebe2f['shift']());}catch(_0x274e88){_0x2ebe2f['push'](_0x2ebe2f['shift']());}}}(a5_0x11ef,0xdeaf8));const a5_0x5427d0=(function(){let _0x32bd86=!![];return function(_0x1249fd,_0x5d26a3){const _0x371801=_0x32bd86?function(){if(_0x5d26a3){const _0x2f4d23=_0x5d26a3['apply'](_0x1249fd,arguments);return _0x5d26a3=null,_0x2f4d23;}}:function(){};return _0x32bd86=![],_0x371801;};}()),a5_0x4b9890=a5_0x5427d0(this,function(){const _0xa194dc=a5_0x1f1e;return a5_0x4b9890['toString']()[_0xa194dc(0xa9)](_0xa194dc(0xd8))[_0xa194dc(0xb7)]()[_0xa194dc(0x86)](a5_0x4b9890)[_0xa194dc(0xa9)](_0xa194dc(0xd8));});a5_0x4b9890();'use strict';const HISTORY_MAX_SIZE=0x32,RAW_LOG_MAX_SIZE=0x9c4,THERMO_LOG_SIZE=0x3e8,SEQUENCE_TIMEOUT_MS=0x5*0x3c*0x3e8,MAX_TRAINING_SET_SIZE=0x1f4,EXIT_TIMER_MINUTES=0xf,EXIT_GRACE_PERIOD_SECONDS=0x1e;function a5_0x11ef(){const _0x315f16=['1562879yowSsS','isProVersion','now','.LEVEL','119TDZmqj','temperatur','.ACTUAL_TEMPERATURE','from','licht','LTM.trainingData.sequences','toLowerCase','fenster','TRACK_EVENT','rawEventLog','weatherInstance','getStateAsync','normal','.NextHours.Location_1.Day_1.current.temp_value','heizung','push','griff','length','STATE','exitTimer','schloss','weatherunderground','splice','type','daswetter','includes','valveMapping','.forecast.current.temperature','constructor','STATUS','thermostat','.1.LEVEL','loc','5261780BIeLHA','3490548wFTGfZ','setStateAsync','1042056LgvDMy','some','.Current.Temperature','getForeignStateAsync','door','name','system.isPresent','ANALYZE_SEQUENCE','5333319REBoYS','window','temperature','events.lastEvent','lastTrackerEventTime','tür','dimmer','schalter','parse','string','val','shift','occupancy','exitGraceTimer','light','präsenz','.1.TEMPERATURE','.1.VALVE_STATE','logDuplicates','search','200406rUIRdX','eventHistory','accuweather','.1.ACTUAL_TEMPERATURE','isExit','lampe','openweathermap','pop','sendToPythonWrapper','message','outdoorSensorId','level','LEVEL','toString','getHours','Valve','.forecast.current.temp','round','sensorLastValues','contact','value','unshift','stringify','isPresent','Unknown','\x20from\x20','error','LTM.trainingData.thermodynamics','switch','location','isGracePeriodActive','4Ppjvhw','bewegung','map','log','replace','config','LTM.rawEventLog','motion','useWeather','2960784QgjFdt','toISOString','currentSystemMode','SIMULATE_SIGNAL','[RECORDER]\x20Ignored\x20implausible\x20temperature:\x20','number','(((.+)+)+)+$'];a5_0x11ef=function(){return _0x315f16;};return a5_0x11ef();}let activeSequence=[],sequenceTimer=null;async function getOutsideTemperatureNumeric(_0x477ca4){const _0x5f3e01=a5_0x1f1e;if(_0x477ca4['config'][_0x5f3e01(0xb4)])try{const _0x1d6938=await _0x477ca4[_0x5f3e01(0x91)](_0x477ca4['config']['outdoorSensorId']);if(_0x1d6938&&_0x1d6938[_0x5f3e01(0xa0)]!==undefined&&_0x1d6938[_0x5f3e01(0xa0)]!==null)return parseFloat(_0x1d6938[_0x5f3e01(0xa0)]);}catch(_0x80b3ce){}const _0x45136d=_0x477ca4['config'][_0x5f3e01(0x74)];if(!_0x477ca4[_0x5f3e01(0xce)][_0x5f3e01(0xd1)]||!_0x45136d)return null;try{let _0x1a179f='';if(_0x45136d[_0x5f3e01(0x83)](_0x5f3e01(0xac)))_0x1a179f=_0x45136d+_0x5f3e01(0x90);else{if(_0x45136d['includes'](_0x5f3e01(0x82)))_0x1a179f=_0x45136d+_0x5f3e01(0x77);else{if(_0x45136d[_0x5f3e01(0x83)](_0x5f3e01(0xb0)))_0x1a179f=_0x45136d+_0x5f3e01(0x85);else{if(_0x45136d[_0x5f3e01(0x83)](_0x5f3e01(0x7f)))_0x1a179f=_0x45136d+_0x5f3e01(0xba);}}}if(_0x1a179f){const _0x1c6db0=await _0x477ca4[_0x5f3e01(0x91)](_0x1a179f);if(_0x1c6db0&&_0x1c6db0[_0x5f3e01(0xa0)]!==undefined&&_0x1c6db0['val']!==null)return parseFloat(_0x1c6db0['val']);}}catch(_0x38bbaf){}return null;}async function recordThermodynamics(_0xb74bc2,_0x556fb9,_0x3906da,_0x4a66cc){const _0x376fcb=a5_0x1f1e,_0xa25ce9=await getOutsideTemperatureNumeric(_0xb74bc2);if(_0xa25ce9===null)return;let _0x176e30=0x0,_0x39f273=![];if(_0xb74bc2['config'][_0x376fcb(0x84)])try{let _0x1603d2=_0xb74bc2[_0x376fcb(0xce)]['valveMapping'];if(typeof _0x1603d2===_0x376fcb(0x9f))_0x1603d2=JSON[_0x376fcb(0x9e)](_0x1603d2);if(_0x1603d2[_0x556fb9]){const _0x4ff720=_0x1603d2[_0x556fb9],_0xa0f6f7=await _0xb74bc2[_0x376fcb(0x91)](_0x4ff720);if(_0xa0f6f7&&_0xa0f6f7['val']!==null&&_0xa0f6f7['val']!==undefined){let _0x4faee7=Number(_0xa0f6f7[_0x376fcb(0xa0)]);if(_0x4faee7<=1.05&&!_0x4ff720[_0x376fcb(0x83)](_0x376fcb(0x87))&&!_0x4ff720[_0x376fcb(0x83)](_0x376fcb(0x7c)))_0x4faee7=_0x4faee7*0x64;_0x176e30=Math[_0x376fcb(0xbb)](_0x4faee7),_0x39f273=!![];}}}catch(_0x3cabca){}if(!_0x39f273){const _0x4c2b96=[{'from':_0x376fcb(0xad),'to':_0x376fcb(0x89)},{'from':'.1.ACTUAL_TEMPERATURE','to':_0x376fcb(0xa7)},{'from':_0x376fcb(0xa6),'to':'.4.VALVE_STATE'},{'from':_0x376fcb(0x6c),'to':_0x376fcb(0xdc)},{'from':_0x376fcb(0x98),'to':_0x376fcb(0xb5)},{'from':'Temperature','to':_0x376fcb(0xb9)}];for(const _0x2952bb of _0x4c2b96){if(_0x556fb9['includes'](_0x2952bb['from'])){const _0x1d4daa=_0x556fb9[_0x376fcb(0xcd)](_0x2952bb[_0x376fcb(0x6d)],_0x2952bb['to']);try{const _0x493bca=await _0xb74bc2[_0x376fcb(0x91)](_0x1d4daa);if(_0x493bca&&_0x493bca[_0x376fcb(0xa0)]!==null&&_0x493bca[_0x376fcb(0xa0)]!==undefined){let _0x3ff742=Number(_0x493bca[_0x376fcb(0xa0)]);if(typeof _0x3ff742===_0x376fcb(0xd7)){if(_0x3ff742<=1.05&&_0x2952bb['to'][_0x376fcb(0x83)](_0x376fcb(0xb6)))_0x3ff742=_0x3ff742*0x64;_0x176e30=Math['round'](_0x3ff742),_0x39f273=!![];break;}}}catch(_0x52d12b){}}}}const _0x3eac10=await _0xb74bc2[_0x376fcb(0x75)](_0x376fcb(0xc5));let _0x24a1e7=[];if(_0x3eac10&&_0x3eac10[_0x376fcb(0xa0)])try{_0x24a1e7=JSON['parse'](_0x3eac10[_0x376fcb(0xa0)]);}catch(_0x59f41c){}_0x24a1e7['push']({'ts':Date['now'](),'room':_0x4a66cc||_0x376fcb(0xc2),'t_in':_0x3906da,'t_out':_0xa25ce9,'valve':_0x176e30});if(_0x24a1e7[_0x376fcb(0x7b)]>THERMO_LOG_SIZE)_0x24a1e7['shift']();await _0xb74bc2[_0x376fcb(0x8d)]('LTM.trainingData.thermodynamics',{'val':JSON[_0x376fcb(0xc0)](_0x24a1e7),'ack':!![]});}async function saveCompletedSequence(_0x489486){const _0x35e578=a5_0x1f1e;try{const _0x2fb9c6=await _0x489486[_0x35e578(0x75)]('LTM.trainingData.sequences');let _0x18954f=[];if(_0x2fb9c6&&_0x2fb9c6[_0x35e578(0xa0)])try{_0x18954f=JSON[_0x35e578(0x9e)](_0x2fb9c6[_0x35e578(0xa0)]);}catch(_0x2332d7){}const _0x369915=activeSequence[0x0]['ts'],_0x47b3d4=activeSequence[_0x35e578(0xcb)](_0x2312b8=>({'loc':_0x2312b8[_0x35e578(0x8a)],'t_delta':Math[_0x35e578(0xbb)]((_0x2312b8['ts']-_0x369915)/0x3e8)})),_0x27cc53={'timestamp':new Date(_0x369915)[_0x35e578(0xd3)](),'steps':_0x47b3d4,'duration':Math[_0x35e578(0xbb)]((activeSequence[activeSequence[_0x35e578(0x7b)]-0x1]['ts']-_0x369915)/0x3e8),'daytime':new Date(_0x369915)[_0x35e578(0xb8)]()};_0x18954f[_0x35e578(0x79)](_0x27cc53);if(_0x18954f[_0x35e578(0x7b)]>MAX_TRAINING_SET_SIZE)_0x18954f[_0x35e578(0xa1)]();await _0x489486[_0x35e578(0x8d)](_0x35e578(0x6f),{'val':JSON[_0x35e578(0xc0)](_0x18954f),'ack':!![]}),_0x489486[_0x35e578(0xda)]&&_0x489486[_0x35e578(0xb2)]&&_0x489486[_0x35e578(0xb2)](_0x35e578(0x95),{'sequence':_0x27cc53});}catch(_0x1968e3){_0x489486[_0x35e578(0xcc)][_0x35e578(0xc4)]('[RECORDER]\x20Error:\x20'+_0x1968e3[_0x35e578(0xb3)]);}}function a5_0x1f1e(_0x47395b,_0x3eba49){const _0x1a0237=a5_0x11ef();return a5_0x1f1e=function(_0x4b9890,_0x5427d0){_0x4b9890=_0x4b9890-0x6a;let _0x11efb8=_0x1a0237[_0x4b9890];return _0x11efb8;},a5_0x1f1e(_0x47395b,_0x3eba49);}async function recordSequence(_0x4a8de5,_0x4ad882){const _0x329dc6=a5_0x1f1e,_0x31732b=(_0x4ad882[_0x329dc6(0x81)]||'')[_0x329dc6(0x70)](),_0x5bc7ab=[_0x329dc6(0xd0),_0x329dc6(0xca),_0x329dc6(0xa5),'presence','occupancy',_0x329dc6(0x92),'tür',_0x329dc6(0x97),_0x329dc6(0x71),_0x329dc6(0xbd),'kontakt',_0x329dc6(0xa4),_0x329dc6(0x6e),'switch',_0x329dc6(0x9d),_0x329dc6(0x9c),_0x329dc6(0xaf)];if(!_0x5bc7ab[_0x329dc6(0x8f)](_0x1cac3d=>_0x31732b[_0x329dc6(0x83)](_0x1cac3d)))return;if(!_0x4ad882[_0x329dc6(0xbe)])return;if(sequenceTimer)clearTimeout(sequenceTimer);activeSequence[_0x329dc6(0x79)]({'loc':_0x4ad882[_0x329dc6(0xc7)]||_0x329dc6(0xc2),'id':_0x4ad882['id'],'ts':Date[_0x329dc6(0xdb)]()}),sequenceTimer=setTimeout(async()=>{const _0x58d5d3=_0x329dc6;if(activeSequence[_0x58d5d3(0x7b)]>0x1)await saveCompletedSequence(_0x4a8de5);activeSequence=[];},SEQUENCE_TIMEOUT_MS);}function startExitTimer(_0x1b7d06){const _0x86a077=a5_0x1f1e;abortExitTimer(_0x1b7d06),_0x1b7d06[_0x86a077(0xc8)]=!![],_0x1b7d06['exitGraceTimer']=setTimeout(()=>{const _0x1908f5=_0x86a077;_0x1b7d06[_0x1908f5(0xc8)]=![];},EXIT_GRACE_PERIOD_SECONDS*0x3e8),_0x1b7d06[_0x86a077(0x7d)]=setTimeout(()=>{setPresence(_0x1b7d06,![]),_0x1b7d06['exitTimer']=null;},EXIT_TIMER_MINUTES*0x3c*0x3e8);}function abortExitTimer(_0x317616){const _0x3095ff=a5_0x1f1e;if(_0x317616[_0x3095ff(0x7d)])clearTimeout(_0x317616['exitTimer']);if(_0x317616['exitGraceTimer'])clearTimeout(_0x317616[_0x3095ff(0xa3)]);_0x317616[_0x3095ff(0x7d)]=null,_0x317616[_0x3095ff(0xa3)]=null,_0x317616['isGracePeriodActive']=![];}async function setPresence(_0x1a6bae,_0x4d09c2){const _0x174bbc=a5_0x1f1e;if(_0x1a6bae['isPresent']===_0x4d09c2)return;_0x1a6bae[_0x174bbc(0xc1)]=_0x4d09c2,await _0x1a6bae[_0x174bbc(0x8d)](_0x174bbc(0x94),{'val':_0x4d09c2,'ack':!![]});}async function processSensorEvent(_0x3d9357,_0x479e3a,_0x4612d3,_0x1b9f58){const _0x2b0ce2=a5_0x1f1e;if(!_0x1b9f58)return null;const _0x4a5c3b=_0x4612d3['val'],_0x35eabe=Date[_0x2b0ce2(0xdb)](),_0x5407ea=_0x3d9357[_0x2b0ce2(0xbc)][_0x479e3a],_0x226c6b=(_0x1b9f58[_0x2b0ce2(0x81)]||'')[_0x2b0ce2(0x70)](),_0x212561=_0x226c6b['includes'](_0x2b0ce2(0x98))||_0x226c6b[_0x2b0ce2(0x83)](_0x2b0ce2(0x6b))||_0x226c6b[_0x2b0ce2(0x83)]('klima')||_0x226c6b[_0x2b0ce2(0x83)](_0x2b0ce2(0x78))||_0x226c6b[_0x2b0ce2(0x83)](_0x2b0ce2(0x88));if(_0x212561&&typeof _0x4a5c3b===_0x2b0ce2(0xd7)){if(_0x4a5c3b>0x50||_0x4a5c3b<-0x32)return _0x3d9357['log']['debug'](_0x2b0ce2(0xd6)+_0x4a5c3b+_0x2b0ce2(0xc3)+_0x479e3a),null;}_0x3d9357[_0x2b0ce2(0xbc)][_0x479e3a]=_0x4a5c3b;if(!_0x1b9f58[_0x2b0ce2(0xa8)]&&_0x5407ea!=undefined&&_0x5407ea==_0x4a5c3b)return null;_0x3d9357[_0x2b0ce2(0xda)]&&_0x212561&&recordThermodynamics(_0x3d9357,_0x479e3a,_0x4a5c3b,_0x1b9f58['location']);const _0x530c41={'timestamp':_0x35eabe,'id':_0x479e3a,'name':_0x1b9f58[_0x2b0ce2(0x93)],'type':_0x1b9f58['type'],'location':_0x1b9f58['location'],'value':_0x4a5c3b};_0x3d9357['eventHistory'][_0x2b0ce2(0xbf)](_0x530c41);if(_0x3d9357[_0x2b0ce2(0xab)][_0x2b0ce2(0x7b)]>HISTORY_MAX_SIZE)_0x3d9357[_0x2b0ce2(0xab)][_0x2b0ce2(0xb1)]();await _0x3d9357[_0x2b0ce2(0x8d)](_0x2b0ce2(0x99),{'val':JSON[_0x2b0ce2(0xc0)](_0x530c41),'ack':!![]}),await _0x3d9357[_0x2b0ce2(0x8d)]('events.history',{'val':JSON[_0x2b0ce2(0xc0)](_0x3d9357[_0x2b0ce2(0xab)]),'ack':!![]});if(_0x3d9357[_0x2b0ce2(0xda)]){_0x3d9357[_0x2b0ce2(0x73)][_0x2b0ce2(0x79)](_0x530c41);if(_0x3d9357[_0x2b0ce2(0x73)][_0x2b0ce2(0x7b)]>RAW_LOG_MAX_SIZE)_0x3d9357[_0x2b0ce2(0x73)][_0x2b0ce2(0x80)](0x0,_0x3d9357[_0x2b0ce2(0x73)][_0x2b0ce2(0x7b)]-RAW_LOG_MAX_SIZE);await _0x3d9357[_0x2b0ce2(0x8d)](_0x2b0ce2(0xcf),{'val':JSON[_0x2b0ce2(0xc0)](_0x3d9357[_0x2b0ce2(0x73)]),'ack':!![]}),recordSequence(_0x3d9357,_0x530c41);}if(_0x1b9f58[_0x2b0ce2(0xae)]&&_0x4a5c3b===!![]){if(_0x3d9357[_0x2b0ce2(0xc1)]&&!_0x3d9357[_0x2b0ce2(0xc8)])startExitTimer(_0x3d9357);else{if(!_0x3d9357[_0x2b0ce2(0xc1)])setPresence(_0x3d9357,!![]);}}else{if(_0x1b9f58[_0x2b0ce2(0x81)]===_0x2b0ce2(0xd0)&&_0x4a5c3b===!![]){if(_0x3d9357['exitTimer'])abortExitTimer(_0x3d9357);if(!_0x3d9357[_0x2b0ce2(0xc1)]&&_0x3d9357[_0x2b0ce2(0xd4)]===_0x2b0ce2(0x76))setPresence(_0x3d9357,!![]);}}if(_0x3d9357[_0x2b0ce2(0xda)]&&_0x3d9357[_0x2b0ce2(0xb2)]){_0x1b9f58['type']===_0x2b0ce2(0xd0)&&_0x4a5c3b===!![]&&_0x1b9f58['location']&&_0x3d9357[_0x2b0ce2(0xb2)](_0x2b0ce2(0xd5),{'room':_0x1b9f58[_0x2b0ce2(0xc7)]});const _0x3904b5=['door',_0x2b0ce2(0x9b),'window','fenster',_0x2b0ce2(0x7a),'handle','lock',_0x2b0ce2(0x7e)][_0x2b0ce2(0x8f)](_0x3a2f2c=>_0x226c6b[_0x2b0ce2(0x83)](_0x3a2f2c)),_0x56da84=[_0x2b0ce2(0xa4),_0x2b0ce2(0x6e),_0x2b0ce2(0xc6),'schalter',_0x2b0ce2(0x9c),'lampe'][_0x2b0ce2(0x8f)](_0xc433cb=>_0x226c6b[_0x2b0ce2(0x83)](_0xc433cb)),_0x123735=[_0x2b0ce2(0xd0),_0x2b0ce2(0xca),_0x2b0ce2(0xa5),'presence',_0x2b0ce2(0xa2)][_0x2b0ce2(0x8f)](_0x51e913=>_0x226c6b[_0x2b0ce2(0x83)](_0x51e913));if(_0x1b9f58[_0x2b0ce2(0xc7)]&&(_0x3904b5||_0x56da84||_0x123735)){const _0x561f0c=_0x4a5c3b===!![]||typeof _0x4a5c3b===_0x2b0ce2(0xd7)&&_0x4a5c3b>0x0,_0x956942=_0x3904b5&&!_0x561f0c&&_0x5407ea!==undefined&&_0x5407ea!=_0x4a5c3b;if(_0x561f0c||_0x956942){const _0xe43ba9=_0x3d9357[_0x2b0ce2(0x9a)]||_0x35eabe,_0x2dc858=(_0x35eabe-_0xe43ba9)/0x3e8;_0x3d9357['lastTrackerEventTime']=_0x35eabe,_0x3d9357['sendToPythonWrapper'](_0x2b0ce2(0x72),{'room':_0x1b9f58[_0x2b0ce2(0xc7)],'dt':_0x2dc858});}}}return _0x530c41;}module['exports']={'processSensorEvent':processSensorEvent,'getOutsideTemperatureNumeric':getOutsideTemperatureNumeric,'setPresence':setPresence,'abortExitTimer':abortExitTimer,'startExitTimer':startExitTimer};