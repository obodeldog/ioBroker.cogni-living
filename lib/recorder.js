const a5_0x572e2e=a5_0x4f63;(function(_0x154513,_0x4ab629){const _0xbaeedb=a5_0x4f63,_0x5efb51=_0x154513();while(!![]){try{const _0x2f42eb=-parseInt(_0xbaeedb(0x78))/0x1+parseInt(_0xbaeedb(0xa4))/0x2*(parseInt(_0xbaeedb(0x89))/0x3)+parseInt(_0xbaeedb(0x7c))/0x4*(parseInt(_0xbaeedb(0xb8))/0x5)+parseInt(_0xbaeedb(0xb0))/0x6*(parseInt(_0xbaeedb(0x98))/0x7)+parseInt(_0xbaeedb(0xa2))/0x8+-parseInt(_0xbaeedb(0x80))/0x9+-parseInt(_0xbaeedb(0xa0))/0xa;if(_0x2f42eb===_0x4ab629)break;else _0x5efb51['push'](_0x5efb51['shift']());}catch(_0x370261){_0x5efb51['push'](_0x5efb51['shift']());}}}(a5_0x7e6a,0xb6618));const a5_0x5ac317=(function(){let _0x32a3c2=!![];return function(_0x351e68,_0x5f5796){const _0x3719a9=_0x32a3c2?function(){const _0x33d439=a5_0x4f63;if(_0x5f5796){const _0x43cef0=_0x5f5796[_0x33d439(0xbc)](_0x351e68,arguments);return _0x5f5796=null,_0x43cef0;}}:function(){};return _0x32a3c2=![],_0x3719a9;};}()),a5_0x5b779f=a5_0x5ac317(this,function(){const _0x3afc2e=a5_0x4f63;return a5_0x5b779f[_0x3afc2e(0xa6)]()['search'](_0x3afc2e(0x8a))['toString']()['constructor'](a5_0x5b779f)['search'](_0x3afc2e(0x8a));});a5_0x5b779f();'use strict';const HISTORY_MAX_SIZE=0x32,RAW_LOG_MAX_SIZE=0x9c4,THERMO_LOG_SIZE=0x3e8,SEQUENCE_TIMEOUT_MS=0x5*0x3c*0x3e8,MAX_TRAINING_SET_SIZE=0x1f4,EXIT_TIMER_MINUTES=0xf,EXIT_GRACE_PERIOD_SECONDS=0x1e;let activeSequence=[],sequenceTimer=null;async function getOutsideTemperatureNumeric(_0x17984e){const _0x3e56b1=a5_0x4f63;if(_0x17984e[_0x3e56b1(0x97)]['outdoorSensorId'])try{const _0x5370d5=await _0x17984e['getForeignStateAsync'](_0x17984e[_0x3e56b1(0x97)][_0x3e56b1(0x8f)]);if(_0x5370d5&&_0x5370d5[_0x3e56b1(0x95)]!==undefined&&_0x5370d5[_0x3e56b1(0x95)]!==null)return parseFloat(_0x5370d5[_0x3e56b1(0x95)]);}catch(_0xd93a97){}const _0x2032b3=_0x17984e[_0x3e56b1(0x97)][_0x3e56b1(0xbd)];if(!_0x17984e['config'][_0x3e56b1(0x9d)]||!_0x2032b3)return null;try{let _0x554e33='';if(_0x2032b3['includes'](_0x3e56b1(0xab)))_0x554e33=_0x2032b3+_0x3e56b1(0x72);else{if(_0x2032b3[_0x3e56b1(0x88)](_0x3e56b1(0xac)))_0x554e33=_0x2032b3+_0x3e56b1(0x90);else{if(_0x2032b3[_0x3e56b1(0x88)](_0x3e56b1(0xaa)))_0x554e33=_0x2032b3+_0x3e56b1(0x92);else{if(_0x2032b3['includes']('weatherunderground'))_0x554e33=_0x2032b3+_0x3e56b1(0xbe);}}}if(_0x554e33){const _0x3573a6=await _0x17984e[_0x3e56b1(0x79)](_0x554e33);if(_0x3573a6&&_0x3573a6[_0x3e56b1(0x95)]!==undefined&&_0x3573a6['val']!==null)return parseFloat(_0x3573a6[_0x3e56b1(0x95)]);}}catch(_0x39ff22){}return null;}async function recordThermodynamics(_0x34518,_0x3cd4bc,_0x1ef467,_0x4b04e9){const _0x1ef96e=a5_0x4f63,_0x312507=await getOutsideTemperatureNumeric(_0x34518),_0x3b0228=await _0x34518['getStateAsync'](_0x1ef96e(0xc6));let _0x30fbfa=[];if(_0x3b0228&&_0x3b0228['val'])try{_0x30fbfa=JSON['parse'](_0x3b0228[_0x1ef96e(0x95)]);}catch(_0x5c33b8){}_0x30fbfa['push']({'ts':Date[_0x1ef96e(0xc1)](),'room':_0x4b04e9||_0x1ef96e(0xb2),'t_in':_0x1ef467,'t_out':_0x312507});if(_0x30fbfa[_0x1ef96e(0xc5)]>THERMO_LOG_SIZE)_0x30fbfa['shift']();await _0x34518[_0x1ef96e(0x9c)](_0x1ef96e(0xc6),{'val':JSON[_0x1ef96e(0xa5)](_0x30fbfa),'ack':!![]});}async function saveCompletedSequence(_0xf61fab){const _0x1d8310=a5_0x4f63;try{const _0x351956=await _0xf61fab[_0x1d8310(0x82)](_0x1d8310(0xc4));let _0x43d06b=[];if(_0x351956&&_0x351956[_0x1d8310(0x95)])try{_0x43d06b=JSON['parse'](_0x351956[_0x1d8310(0x95)]);}catch(_0x4ec1d8){}const _0x220df5=activeSequence[0x0]['ts'],_0x3dfbed=activeSequence[_0x1d8310(0x8b)](_0x18ac39=>({'loc':_0x18ac39[_0x1d8310(0x7d)],'t_delta':Math[_0x1d8310(0xb9)]((_0x18ac39['ts']-_0x220df5)/0x3e8)})),_0x19ffe7={'timestamp':new Date(_0x220df5)[_0x1d8310(0x77)](),'steps':_0x3dfbed,'duration':Math[_0x1d8310(0xb9)]((activeSequence[activeSequence[_0x1d8310(0xc5)]-0x1]['ts']-_0x220df5)/0x3e8),'daytime':new Date(_0x220df5)[_0x1d8310(0x7a)]()};_0x43d06b[_0x1d8310(0x99)](_0x19ffe7);if(_0x43d06b[_0x1d8310(0xc5)]>MAX_TRAINING_SET_SIZE)_0x43d06b[_0x1d8310(0x93)]();await _0xf61fab[_0x1d8310(0x9c)]('LTM.trainingData.sequences',{'val':JSON[_0x1d8310(0xa5)](_0x43d06b),'ack':!![]}),_0xf61fab['isProVersion']&&_0xf61fab[_0x1d8310(0x83)]&&_0xf61fab[_0x1d8310(0x83)](_0x1d8310(0xa8),{'sequence':_0x19ffe7});}catch(_0x518069){_0xf61fab[_0x1d8310(0x9f)][_0x1d8310(0x9a)](_0x1d8310(0xb3)+_0x518069[_0x1d8310(0xc2)]);}}async function recordSequence(_0x22e80b,_0x8744e){const _0x201625=a5_0x4f63,_0x4c7cda=(_0x8744e[_0x201625(0x96)]||'')['toLowerCase'](),_0x416aaf=['motion','bewegung',_0x201625(0xae),'presence',_0x201625(0xb4),_0x201625(0x7b),'tür','window',_0x201625(0x91),_0x201625(0xb7),'kontakt','light','licht',_0x201625(0xa3),'schalter',_0x201625(0x9b),_0x201625(0xaf)];if(!_0x416aaf['some'](_0x49a087=>_0x4c7cda[_0x201625(0x88)](_0x49a087)))return;if(!_0x8744e[_0x201625(0x8c)])return;if(sequenceTimer)clearTimeout(sequenceTimer);activeSequence[_0x201625(0x99)]({'loc':_0x8744e[_0x201625(0x81)]||'Unknown','id':_0x8744e['id'],'ts':Date[_0x201625(0xc1)]()}),sequenceTimer=setTimeout(async()=>{const _0x5e0ed7=_0x201625;if(activeSequence[_0x5e0ed7(0xc5)]>0x1)await saveCompletedSequence(_0x22e80b);activeSequence=[];},SEQUENCE_TIMEOUT_MS);}function startExitTimer(_0x333708){const _0x430f96=a5_0x4f63;abortExitTimer(_0x333708),_0x333708['isGracePeriodActive']=!![],_0x333708['exitGraceTimer']=setTimeout(()=>{_0x333708['isGracePeriodActive']=![];},EXIT_GRACE_PERIOD_SECONDS*0x3e8),_0x333708[_0x430f96(0xbb)]=setTimeout(()=>{const _0x1fb307=_0x430f96;setPresence(_0x333708,![]),_0x333708[_0x1fb307(0xbb)]=null;},EXIT_TIMER_MINUTES*0x3c*0x3e8);}function abortExitTimer(_0x2f7606){const _0x2c03fc=a5_0x4f63;if(_0x2f7606[_0x2c03fc(0xbb)])clearTimeout(_0x2f7606[_0x2c03fc(0xbb)]);if(_0x2f7606['exitGraceTimer'])clearTimeout(_0x2f7606[_0x2c03fc(0x7f)]);_0x2f7606['exitTimer']=null,_0x2f7606[_0x2c03fc(0x7f)]=null,_0x2f7606[_0x2c03fc(0xa9)]=![];}async function setPresence(_0x2576bf,_0x373bbb){const _0x21b93d=a5_0x4f63;if(_0x2576bf[_0x21b93d(0xa1)]===_0x373bbb)return;_0x2576bf[_0x21b93d(0xa1)]=_0x373bbb,await _0x2576bf[_0x21b93d(0x9c)](_0x21b93d(0x8d),{'val':_0x373bbb,'ack':!![]});}async function processSensorEvent(_0x1ace23,_0x768ad0,_0x558d1e,_0x5db6d0){const _0x5990a6=a5_0x4f63;if(!_0x5db6d0)return null;const _0x51e89b=_0x558d1e[_0x5990a6(0x95)],_0x57b695=Date[_0x5990a6(0xc1)](),_0x14d964=_0x1ace23[_0x5990a6(0xbf)][_0x768ad0];_0x1ace23[_0x5990a6(0xbf)][_0x768ad0]=_0x51e89b;if(!_0x5db6d0[_0x5990a6(0x9e)]&&_0x14d964!=undefined&&_0x14d964==_0x51e89b)return null;const _0x3ab267=(_0x5db6d0[_0x5990a6(0x96)]||'')[_0x5990a6(0x8e)](),_0x4fe39b=_0x3ab267['includes'](_0x5990a6(0xb5))||_0x3ab267[_0x5990a6(0x88)](_0x5990a6(0x76))||_0x3ab267[_0x5990a6(0x88)]('klima')||_0x3ab267[_0x5990a6(0x88)](_0x5990a6(0xc3));_0x1ace23['isProVersion']&&_0x4fe39b&&recordThermodynamics(_0x1ace23,_0x768ad0,_0x51e89b,_0x5db6d0[_0x5990a6(0x81)]);const _0x23c7c0={'timestamp':_0x57b695,'id':_0x768ad0,'name':_0x5db6d0[_0x5990a6(0x75)],'type':_0x5db6d0[_0x5990a6(0x96)],'location':_0x5db6d0[_0x5990a6(0x81)],'value':_0x51e89b};_0x1ace23[_0x5990a6(0x84)][_0x5990a6(0xc7)](_0x23c7c0);if(_0x1ace23[_0x5990a6(0x84)]['length']>HISTORY_MAX_SIZE)_0x1ace23[_0x5990a6(0x84)][_0x5990a6(0x74)]();await _0x1ace23[_0x5990a6(0x9c)](_0x5990a6(0xb1),{'val':JSON[_0x5990a6(0xa5)](_0x23c7c0),'ack':!![]}),await _0x1ace23[_0x5990a6(0x9c)](_0x5990a6(0xa7),{'val':JSON[_0x5990a6(0xa5)](_0x1ace23[_0x5990a6(0x84)]),'ack':!![]});if(_0x1ace23[_0x5990a6(0xc0)]){_0x1ace23[_0x5990a6(0x86)][_0x5990a6(0x99)](_0x23c7c0);if(_0x1ace23[_0x5990a6(0x86)]['length']>RAW_LOG_MAX_SIZE)_0x1ace23['rawEventLog'][_0x5990a6(0xba)](0x0,_0x1ace23[_0x5990a6(0x86)][_0x5990a6(0xc5)]-RAW_LOG_MAX_SIZE);await _0x1ace23[_0x5990a6(0x9c)](_0x5990a6(0x7e),{'val':JSON[_0x5990a6(0xa5)](_0x1ace23[_0x5990a6(0x86)]),'ack':!![]}),recordSequence(_0x1ace23,_0x23c7c0);}if(_0x5db6d0[_0x5990a6(0xb6)]&&_0x51e89b===!![]){if(_0x1ace23[_0x5990a6(0xa1)]&&!_0x1ace23[_0x5990a6(0xa9)])startExitTimer(_0x1ace23);else{if(!_0x1ace23[_0x5990a6(0xa1)])setPresence(_0x1ace23,!![]);}}else{if(_0x5db6d0['type']===_0x5990a6(0x87)&&_0x51e89b===!![]){if(_0x1ace23[_0x5990a6(0xbb)])abortExitTimer(_0x1ace23);if(!_0x1ace23['isPresent']&&_0x1ace23[_0x5990a6(0x85)]===_0x5990a6(0x94))setPresence(_0x1ace23,!![]);}}return _0x1ace23[_0x5990a6(0xc0)]&&_0x5db6d0[_0x5990a6(0x96)]==='motion'&&_0x51e89b===!![]&&_0x5db6d0[_0x5990a6(0x81)]&&_0x1ace23['sendToPythonWrapper']&&_0x1ace23[_0x5990a6(0x83)](_0x5990a6(0x73),{'room':_0x5db6d0['location']}),_0x23c7c0;}function a5_0x7e6a(){const _0xd916a0=['setStateAsync','useWeather','logDuplicates','log','8615130MucLvh','isPresent','6278824CIFKjo','switch','15406ukKmkR','stringify','toString','events.history','ANALYZE_SEQUENCE','isGracePeriodActive','openweathermap','accuweather','daswetter','exports','präsenz','lampe','6018zGBzGD','events.lastEvent','Unknown','[RECORDER]\x20Error:\x20','occupancy','temperature','isExit','contact','5034535tZlvvZ','round','splice','exitTimer','apply','weatherInstance','.forecast.current.temp','sensorLastValues','isProVersion','now','message','heizung','LTM.trainingData.sequences','length','LTM.trainingData.thermodynamics','unshift','.Current.Temperature','SIMULATE_SIGNAL','pop','name','temperatur','toISOString','1027023wdOmkH','getForeignStateAsync','getHours','door','4WemqAi','loc','LTM.rawEventLog','exitGraceTimer','5994927nmZFCT','location','getStateAsync','sendToPythonWrapper','eventHistory','currentSystemMode','rawEventLog','motion','includes','390DmxceQ','(((.+)+)+)+$','map','value','system.isPresent','toLowerCase','outdoorSensorId','.NextHours.Location_1.Day_1.current.temp_value','fenster','.forecast.current.temperature','shift','normal','val','type','config','3549EVeVLY','push','error','dimmer'];a5_0x7e6a=function(){return _0xd916a0;};return a5_0x7e6a();}function a5_0x4f63(_0x1b59e8,_0x51c786){const _0x2302a9=a5_0x7e6a();return a5_0x4f63=function(_0x5b779f,_0x5ac317){_0x5b779f=_0x5b779f-0x72;let _0x7e6a42=_0x2302a9[_0x5b779f];return _0x7e6a42;},a5_0x4f63(_0x1b59e8,_0x51c786);}module[a5_0x572e2e(0xad)]={'processSensorEvent':processSensorEvent,'getOutsideTemperatureNumeric':getOutsideTemperatureNumeric,'setPresence':setPresence,'abortExitTimer':abortExitTimer,'startExitTimer':startExitTimer};