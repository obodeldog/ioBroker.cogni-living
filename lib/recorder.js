const a5_0x50dcba=a5_0x553d;(function(_0xada949,_0x188dd9){const _0x49cd1c=a5_0x553d,_0x3615a9=_0xada949();while(!![]){try{const _0x22f840=-parseInt(_0x49cd1c(0x1c0))/0x1+parseInt(_0x49cd1c(0x1c4))/0x2*(-parseInt(_0x49cd1c(0x1cb))/0x3)+parseInt(_0x49cd1c(0x1c3))/0x4*(-parseInt(_0x49cd1c(0x1ac))/0x5)+-parseInt(_0x49cd1c(0x1ae))/0x6+parseInt(_0x49cd1c(0x1b2))/0x7+parseInt(_0x49cd1c(0x1c5))/0x8+parseInt(_0x49cd1c(0x17f))/0x9;if(_0x22f840===_0x188dd9)break;else _0x3615a9['push'](_0x3615a9['shift']());}catch(_0x13c52c){_0x3615a9['push'](_0x3615a9['shift']());}}}(a5_0x5932,0xc5768));const a5_0x4392c4=(function(){let _0x449378=!![];return function(_0x411ec3,_0x13a317){const _0x12a8c0=_0x449378?function(){const _0x212d78=a5_0x553d;if(_0x13a317){const _0x1112b9=_0x13a317[_0x212d78(0x1b1)](_0x411ec3,arguments);return _0x13a317=null,_0x1112b9;}}:function(){};return _0x449378=![],_0x12a8c0;};}()),a5_0x3c6944=a5_0x4392c4(this,function(){const _0x21dfe6=a5_0x553d;return a5_0x3c6944[_0x21dfe6(0x18c)]()[_0x21dfe6(0x18a)](_0x21dfe6(0x19e))[_0x21dfe6(0x18c)]()['constructor'](a5_0x3c6944)['search'](_0x21dfe6(0x19e));});a5_0x3c6944();'use strict';const HISTORY_MAX_SIZE=0x32,RAW_LOG_MAX_SIZE=0x9c4,THERMO_LOG_SIZE=0x3e8,SEQUENCE_TIMEOUT_MS=0x5*0x3c*0x3e8,MAX_TRAINING_SET_SIZE=0x1f4,EXIT_TIMER_MINUTES=0xf,EXIT_GRACE_PERIOD_SECONDS=0x1e;let activeSequence=[],sequenceTimer=null;async function getOutsideTemperatureNumeric(_0x3f8695){const _0x8732cd=a5_0x553d;if(_0x3f8695[_0x8732cd(0x1a9)][_0x8732cd(0x1a7)])try{const _0x34244a=await _0x3f8695[_0x8732cd(0x19d)](_0x3f8695[_0x8732cd(0x1a9)][_0x8732cd(0x1a7)]);if(_0x34244a&&_0x34244a['val']!==undefined&&_0x34244a[_0x8732cd(0x190)]!==null)return parseFloat(_0x34244a[_0x8732cd(0x190)]);}catch(_0x4e5527){}const _0x6b2c3d=_0x3f8695['config']['weatherInstance'];if(!_0x3f8695[_0x8732cd(0x1a9)][_0x8732cd(0x1cd)]||!_0x6b2c3d)return null;try{let _0x5abdfe='';if(_0x6b2c3d[_0x8732cd(0x187)](_0x8732cd(0x1b8)))_0x5abdfe=_0x6b2c3d+_0x8732cd(0x1ad);else{if(_0x6b2c3d[_0x8732cd(0x187)](_0x8732cd(0x1bb)))_0x5abdfe=_0x6b2c3d+_0x8732cd(0x185);else{if(_0x6b2c3d[_0x8732cd(0x187)]('openweathermap'))_0x5abdfe=_0x6b2c3d+'.forecast.current.temperature';else{if(_0x6b2c3d[_0x8732cd(0x187)](_0x8732cd(0x1a2)))_0x5abdfe=_0x6b2c3d+'.forecast.current.temp';}}}if(_0x5abdfe){const _0x493f3d=await _0x3f8695[_0x8732cd(0x19d)](_0x5abdfe);if(_0x493f3d&&_0x493f3d[_0x8732cd(0x190)]!==undefined&&_0x493f3d[_0x8732cd(0x190)]!==null)return parseFloat(_0x493f3d[_0x8732cd(0x190)]);}}catch(_0x195bc2){}return null;}async function recordThermodynamics(_0x34660f,_0x2a6b32,_0x11e1da,_0x3774e2){const _0x29cea7=a5_0x553d,_0x16e198=await getOutsideTemperatureNumeric(_0x34660f),_0x4c4eb0=await _0x34660f[_0x29cea7(0x1bd)](_0x29cea7(0x1af));let _0x25f853=[];if(_0x4c4eb0&&_0x4c4eb0[_0x29cea7(0x190)])try{_0x25f853=JSON['parse'](_0x4c4eb0[_0x29cea7(0x190)]);}catch(_0x5f3a99){}_0x25f853[_0x29cea7(0x183)]({'ts':Date[_0x29cea7(0x18e)](),'room':_0x3774e2||_0x29cea7(0x1cc),'t_in':_0x11e1da,'t_out':_0x16e198});if(_0x25f853[_0x29cea7(0x19a)]>THERMO_LOG_SIZE)_0x25f853[_0x29cea7(0x17d)]();await _0x34660f[_0x29cea7(0x184)](_0x29cea7(0x1af),{'val':JSON[_0x29cea7(0x195)](_0x25f853),'ack':!![]});}function a5_0x553d(_0x401da8,_0x5b6a1d){const _0x7050f9=a5_0x5932();return a5_0x553d=function(_0x3c6944,_0x4392c4){_0x3c6944=_0x3c6944-0x17d;let _0x5932d9=_0x7050f9[_0x3c6944];return _0x5932d9;},a5_0x553d(_0x401da8,_0x5b6a1d);}async function saveCompletedSequence(_0x5b1137){const _0x784a8a=a5_0x553d;try{const _0x4788c9=await _0x5b1137[_0x784a8a(0x1bd)](_0x784a8a(0x1d1));let _0x3d7248=[];if(_0x4788c9&&_0x4788c9['val'])try{_0x3d7248=JSON[_0x784a8a(0x1a8)](_0x4788c9['val']);}catch(_0x204056){}const _0x25cf9d=activeSequence[0x0]['ts'],_0x23701c=activeSequence[_0x784a8a(0x1a3)](_0x280f3e=>({'loc':_0x280f3e[_0x784a8a(0x1cf)],'t_delta':Math['round']((_0x280f3e['ts']-_0x25cf9d)/0x3e8)})),_0x1bb242={'timestamp':new Date(_0x25cf9d)[_0x784a8a(0x198)](),'steps':_0x23701c,'duration':Math[_0x784a8a(0x1a4)]((activeSequence[activeSequence['length']-0x1]['ts']-_0x25cf9d)/0x3e8),'daytime':new Date(_0x25cf9d)[_0x784a8a(0x18f)]()};_0x3d7248[_0x784a8a(0x183)](_0x1bb242);if(_0x3d7248[_0x784a8a(0x19a)]>MAX_TRAINING_SET_SIZE)_0x3d7248[_0x784a8a(0x17d)]();await _0x5b1137[_0x784a8a(0x184)](_0x784a8a(0x1d1),{'val':JSON['stringify'](_0x3d7248),'ack':!![]}),_0x5b1137[_0x784a8a(0x1a0)]&&_0x5b1137[_0x784a8a(0x1a1)]&&_0x5b1137[_0x784a8a(0x1a1)]('ANALYZE_SEQUENCE',{'sequence':_0x1bb242});}catch(_0x2d7bf0){_0x5b1137[_0x784a8a(0x199)][_0x784a8a(0x1a6)](_0x784a8a(0x181)+_0x2d7bf0[_0x784a8a(0x1c9)]);}}function a5_0x5932(){const _0x443c67=['temperature','eventHistory','message','licht','1483035CtqBRd','Unknown','useWeather','dimmer','loc','some','LTM.trainingData.sequences','shift','exitTimer','18017298vREHmk','system.isPresent','[RECORDER]\x20Error:\x20','sensorLastValues','push','setStateAsync','.NextHours.Location_1.Day_1.current.temp_value','LTM.rawEventLog','includes','window','präsenz','search','occupancy','toString','door','now','getHours','val','isPresent','schalter','kontakt','pop','stringify','temperatur','exitGraceTimer','toISOString','log','length','normal','switch','getForeignStateAsync','(((.+)+)+)+$','presence','isProVersion','sendToPythonWrapper','weatherunderground','map','round','isGracePeriodActive','error','outdoorSensorId','parse','config','location','events.history','185aTfEtv','.Current.Temperature','5703360ILcSSI','LTM.trainingData.thermodynamics','SIMULATE_SIGNAL','apply','10763046QjzxCs','light','contact','klima','exports','rawEventLog','accuweather','bewegung','logDuplicates','daswetter','events.lastEvent','getStateAsync','motion','toLowerCase','824201ecHuOz','tür','isExit','70636wqEBzT','4kpzZyd','5489136DwEeXf','type'];a5_0x5932=function(){return _0x443c67;};return a5_0x5932();}async function recordSequence(_0xa9a115,_0xc4088d){const _0x22d485=a5_0x553d,_0x435c58=(_0xc4088d['type']||'')[_0x22d485(0x1bf)](),_0x197b84=[_0x22d485(0x1be),_0x22d485(0x1b9),_0x22d485(0x189),_0x22d485(0x19f),_0x22d485(0x18b),_0x22d485(0x18d),_0x22d485(0x1c1),_0x22d485(0x188),'fenster',_0x22d485(0x1b4),_0x22d485(0x193),_0x22d485(0x1b3),_0x22d485(0x1ca),_0x22d485(0x19c),_0x22d485(0x192),_0x22d485(0x1ce),'lampe'];if(!_0x197b84[_0x22d485(0x1d0)](_0x174701=>_0x435c58[_0x22d485(0x187)](_0x174701)))return;if(!_0xc4088d['value'])return;if(sequenceTimer)clearTimeout(sequenceTimer);activeSequence[_0x22d485(0x183)]({'loc':_0xc4088d['location']||_0x22d485(0x1cc),'id':_0xc4088d['id'],'ts':Date[_0x22d485(0x18e)]()}),sequenceTimer=setTimeout(async()=>{const _0x129241=_0x22d485;if(activeSequence[_0x129241(0x19a)]>0x1)await saveCompletedSequence(_0xa9a115);activeSequence=[];},SEQUENCE_TIMEOUT_MS);}function startExitTimer(_0x262a99){const _0x1f39a2=a5_0x553d;abortExitTimer(_0x262a99),_0x262a99[_0x1f39a2(0x1a5)]=!![],_0x262a99[_0x1f39a2(0x197)]=setTimeout(()=>{const _0x21ffc0=_0x1f39a2;_0x262a99[_0x21ffc0(0x1a5)]=![];},EXIT_GRACE_PERIOD_SECONDS*0x3e8),_0x262a99[_0x1f39a2(0x17e)]=setTimeout(()=>{const _0x23027e=_0x1f39a2;setPresence(_0x262a99,![]),_0x262a99[_0x23027e(0x17e)]=null;},EXIT_TIMER_MINUTES*0x3c*0x3e8);}function abortExitTimer(_0x19911c){const _0x1e70d5=a5_0x553d;if(_0x19911c['exitTimer'])clearTimeout(_0x19911c[_0x1e70d5(0x17e)]);if(_0x19911c[_0x1e70d5(0x197)])clearTimeout(_0x19911c[_0x1e70d5(0x197)]);_0x19911c[_0x1e70d5(0x17e)]=null,_0x19911c['exitGraceTimer']=null,_0x19911c[_0x1e70d5(0x1a5)]=![];}async function setPresence(_0x1dde53,_0x47fd3f){const _0x40af6a=a5_0x553d;if(_0x1dde53[_0x40af6a(0x191)]===_0x47fd3f)return;_0x1dde53[_0x40af6a(0x191)]=_0x47fd3f,await _0x1dde53[_0x40af6a(0x184)](_0x40af6a(0x180),{'val':_0x47fd3f,'ack':!![]});}async function processSensorEvent(_0x3ab702,_0x5d66b7,_0x218462,_0xd1e167){const _0x2f474c=a5_0x553d;if(!_0xd1e167)return null;const _0x65be7f=_0x218462[_0x2f474c(0x190)],_0x5a5432=Date[_0x2f474c(0x18e)](),_0x16cf08=_0x3ab702[_0x2f474c(0x182)][_0x5d66b7];_0x3ab702[_0x2f474c(0x182)][_0x5d66b7]=_0x65be7f;if(!_0xd1e167[_0x2f474c(0x1ba)]&&_0x16cf08!=undefined&&_0x16cf08==_0x65be7f)return null;const _0x38e032=(_0xd1e167[_0x2f474c(0x1c6)]||'')[_0x2f474c(0x1bf)](),_0x4ef756=_0x38e032[_0x2f474c(0x187)](_0x2f474c(0x1c7))||_0x38e032[_0x2f474c(0x187)](_0x2f474c(0x196))||_0x38e032['includes'](_0x2f474c(0x1b5))||_0x38e032[_0x2f474c(0x187)]('heizung');_0x3ab702[_0x2f474c(0x1a0)]&&_0x4ef756&&recordThermodynamics(_0x3ab702,_0x5d66b7,_0x65be7f,_0xd1e167[_0x2f474c(0x1aa)]);const _0x3e2abc={'timestamp':_0x5a5432,'id':_0x5d66b7,'name':_0xd1e167['name'],'type':_0xd1e167['type'],'location':_0xd1e167[_0x2f474c(0x1aa)],'value':_0x65be7f};_0x3ab702[_0x2f474c(0x1c8)]['unshift'](_0x3e2abc);if(_0x3ab702[_0x2f474c(0x1c8)][_0x2f474c(0x19a)]>HISTORY_MAX_SIZE)_0x3ab702[_0x2f474c(0x1c8)][_0x2f474c(0x194)]();await _0x3ab702[_0x2f474c(0x184)](_0x2f474c(0x1bc),{'val':JSON['stringify'](_0x3e2abc),'ack':!![]}),await _0x3ab702[_0x2f474c(0x184)](_0x2f474c(0x1ab),{'val':JSON[_0x2f474c(0x195)](_0x3ab702[_0x2f474c(0x1c8)]),'ack':!![]});if(_0x3ab702[_0x2f474c(0x1a0)]){_0x3ab702[_0x2f474c(0x1b7)][_0x2f474c(0x183)](_0x3e2abc);if(_0x3ab702[_0x2f474c(0x1b7)][_0x2f474c(0x19a)]>RAW_LOG_MAX_SIZE)_0x3ab702[_0x2f474c(0x1b7)]['splice'](0x0,_0x3ab702['rawEventLog'][_0x2f474c(0x19a)]-RAW_LOG_MAX_SIZE);await _0x3ab702[_0x2f474c(0x184)](_0x2f474c(0x186),{'val':JSON[_0x2f474c(0x195)](_0x3ab702[_0x2f474c(0x1b7)]),'ack':!![]}),recordSequence(_0x3ab702,_0x3e2abc);}if(_0xd1e167[_0x2f474c(0x1c2)]&&_0x65be7f===!![]){if(_0x3ab702['isPresent']&&!_0x3ab702[_0x2f474c(0x1a5)])startExitTimer(_0x3ab702);else{if(!_0x3ab702['isPresent'])setPresence(_0x3ab702,!![]);}}else{if(_0xd1e167[_0x2f474c(0x1c6)]===_0x2f474c(0x1be)&&_0x65be7f===!![]){if(_0x3ab702[_0x2f474c(0x17e)])abortExitTimer(_0x3ab702);if(!_0x3ab702[_0x2f474c(0x191)]&&_0x3ab702['currentSystemMode']===_0x2f474c(0x19b))setPresence(_0x3ab702,!![]);}}return _0x3ab702['isProVersion']&&_0xd1e167[_0x2f474c(0x1c6)]===_0x2f474c(0x1be)&&_0x65be7f===!![]&&_0xd1e167[_0x2f474c(0x1aa)]&&_0x3ab702[_0x2f474c(0x1a1)]&&_0x3ab702[_0x2f474c(0x1a1)](_0x2f474c(0x1b0),{'room':_0xd1e167[_0x2f474c(0x1aa)]}),_0x3e2abc;}module[a5_0x50dcba(0x1b6)]={'processSensorEvent':processSensorEvent,'getOutsideTemperatureNumeric':getOutsideTemperatureNumeric,'setPresence':setPresence,'abortExitTimer':abortExitTimer,'startExitTimer':startExitTimer};