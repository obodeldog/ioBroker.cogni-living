const a5_0x405aba=a5_0x35d8;(function(_0x489e70,_0x756a09){const _0x53628d=a5_0x35d8,_0x36c378=_0x489e70();while(!![]){try{const _0x54541a=-parseInt(_0x53628d(0x231))/0x1+parseInt(_0x53628d(0x1f4))/0x2+parseInt(_0x53628d(0x23e))/0x3+-parseInt(_0x53628d(0x23c))/0x4*(-parseInt(_0x53628d(0x23a))/0x5)+parseInt(_0x53628d(0x216))/0x6*(parseInt(_0x53628d(0x204))/0x7)+parseInt(_0x53628d(0x226))/0x8+parseInt(_0x53628d(0x23d))/0x9*(-parseInt(_0x53628d(0x223))/0xa);if(_0x54541a===_0x756a09)break;else _0x36c378['push'](_0x36c378['shift']());}catch(_0x563808){_0x36c378['push'](_0x36c378['shift']());}}}(a5_0x2088,0xcb6eb));const a5_0x2ba8bf=(function(){let _0x928daa=!![];return function(_0x457d18,_0x4888bf){const _0x3f4913=_0x928daa?function(){const _0x54f844=a5_0x35d8;if(_0x4888bf){const _0x424bfc=_0x4888bf[_0x54f844(0x21a)](_0x457d18,arguments);return _0x4888bf=null,_0x424bfc;}}:function(){};return _0x928daa=![],_0x3f4913;};}()),a5_0x226d26=a5_0x2ba8bf(this,function(){const _0x3bf490=a5_0x35d8;return a5_0x226d26[_0x3bf490(0x1df)]()['search'](_0x3bf490(0x1fa))[_0x3bf490(0x1df)]()[_0x3bf490(0x20c)](a5_0x226d26)[_0x3bf490(0x217)](_0x3bf490(0x1fa));});a5_0x226d26();'use strict';const HISTORY_MAX_SIZE=0x32,RAW_LOG_MAX_SIZE=0x9c4,THERMO_LOG_SIZE=0x3e8,SEQUENCE_TIMEOUT_MS=0x5*0x3c*0x3e8,MAX_TRAINING_SET_SIZE=0x1f4,EXIT_TIMER_MINUTES=0xf,EXIT_GRACE_PERIOD_SECONDS=0x1e;let activeSequence=[],sequenceTimer=null;function a5_0x35d8(_0x5b0d76,_0x2e2c66){const _0x3d8a6c=a5_0x2088();return a5_0x35d8=function(_0x226d26,_0x2ba8bf){_0x226d26=_0x226d26-0x1d2;let _0x208820=_0x3d8a6c[_0x226d26];return _0x208820;},a5_0x35d8(_0x5b0d76,_0x2e2c66);}async function getOutsideTemperatureNumeric(_0x2dd284){const _0x3fb1c0=a5_0x35d8;if(_0x2dd284['config'][_0x3fb1c0(0x235)])try{const _0x109574=await _0x2dd284['getForeignStateAsync'](_0x2dd284[_0x3fb1c0(0x1e4)][_0x3fb1c0(0x235)]);if(_0x109574&&_0x109574[_0x3fb1c0(0x201)]!==undefined&&_0x109574[_0x3fb1c0(0x201)]!==null)return parseFloat(_0x109574['val']);}catch(_0x5361ef){}const _0x3005aa=_0x2dd284['config'][_0x3fb1c0(0x1e6)];if(!_0x2dd284[_0x3fb1c0(0x1e4)]['useWeather']||!_0x3005aa)return null;try{let _0xc9ea93='';if(_0x3005aa[_0x3fb1c0(0x240)](_0x3fb1c0(0x238)))_0xc9ea93=_0x3005aa+'.Current.Temperature';else{if(_0x3005aa['includes'](_0x3fb1c0(0x22b)))_0xc9ea93=_0x3005aa+'.NextHours.Location_1.Day_1.current.temp_value';else{if(_0x3005aa[_0x3fb1c0(0x240)](_0x3fb1c0(0x1e5)))_0xc9ea93=_0x3005aa+_0x3fb1c0(0x1fe);else{if(_0x3005aa[_0x3fb1c0(0x240)](_0x3fb1c0(0x214)))_0xc9ea93=_0x3005aa+_0x3fb1c0(0x1db);}}}if(_0xc9ea93){const _0x6ab299=await _0x2dd284['getForeignStateAsync'](_0xc9ea93);if(_0x6ab299&&_0x6ab299[_0x3fb1c0(0x201)]!==undefined&&_0x6ab299[_0x3fb1c0(0x201)]!==null)return parseFloat(_0x6ab299['val']);}}catch(_0x327942){}return null;}async function recordThermodynamics(_0x59639a,_0xd0e7c2,_0xc0f3e5,_0x1c093d){const _0x5a95a8=a5_0x35d8,_0x27a5f7=await getOutsideTemperatureNumeric(_0x59639a);if(_0x27a5f7===null)return;let _0xd813f=0x0,_0x3219ec=![];if(_0x59639a[_0x5a95a8(0x1e4)][_0x5a95a8(0x22c)])try{let _0x11d12e=_0x59639a[_0x5a95a8(0x1e4)][_0x5a95a8(0x22c)];if(typeof _0x11d12e==='string')_0x11d12e=JSON[_0x5a95a8(0x22f)](_0x11d12e);if(_0x11d12e[_0xd0e7c2]){const _0x2047f6=_0x11d12e[_0xd0e7c2],_0x552d41=await _0x59639a[_0x5a95a8(0x1f7)](_0x2047f6);if(_0x552d41&&_0x552d41[_0x5a95a8(0x201)]!==null&&_0x552d41['val']!==undefined){let _0x2c0c0f=Number(_0x552d41[_0x5a95a8(0x201)]);if(_0x2c0c0f<=1.05&&!_0x2047f6['includes'](_0x5a95a8(0x21e))&&!_0x2047f6[_0x5a95a8(0x240)](_0x5a95a8(0x1e9)))_0x2c0c0f=_0x2c0c0f*0x64;_0xd813f=Math[_0x5a95a8(0x1ef)](_0x2c0c0f),_0x3219ec=!![];}}}catch(_0x4bc924){}if(!_0x3219ec){const _0x5977f7=[{'from':_0x5a95a8(0x211),'to':_0x5a95a8(0x209)},{'from':_0x5a95a8(0x211),'to':_0x5a95a8(0x1f0)},{'from':_0x5a95a8(0x1f3),'to':'.4.VALVE_STATE'},{'from':_0x5a95a8(0x22d),'to':_0x5a95a8(0x243)},{'from':'temperature','to':_0x5a95a8(0x1d6)},{'from':_0x5a95a8(0x1f6),'to':_0x5a95a8(0x22a)}];for(const _0x4d8306 of _0x5977f7){if(_0xd0e7c2[_0x5a95a8(0x240)](_0x4d8306[_0x5a95a8(0x1d9)])){const _0xfb04ab=_0xd0e7c2[_0x5a95a8(0x1ed)](_0x4d8306[_0x5a95a8(0x1d9)],_0x4d8306['to']);try{const _0x317485=await _0x59639a['getForeignStateAsync'](_0xfb04ab);if(_0x317485&&_0x317485['val']!==null&&_0x317485[_0x5a95a8(0x201)]!==undefined){let _0x10f750=Number(_0x317485['val']);if(typeof _0x10f750==='number'){if(_0x10f750<=1.05&&_0x4d8306['to'][_0x5a95a8(0x240)](_0x5a95a8(0x1f2)))_0x10f750=_0x10f750*0x64;_0xd813f=Math[_0x5a95a8(0x1ef)](_0x10f750),_0x3219ec=!![];break;}}}catch(_0xb20627){}}}}const _0x30696b=await _0x59639a['getStateAsync'](_0x5a95a8(0x1f8));let _0x1df3a2=[];if(_0x30696b&&_0x30696b[_0x5a95a8(0x201)])try{_0x1df3a2=JSON[_0x5a95a8(0x22f)](_0x30696b['val']);}catch(_0x3d05a9){}_0x1df3a2[_0x5a95a8(0x1fb)]({'ts':Date[_0x5a95a8(0x1ff)](),'room':_0x1c093d||_0x5a95a8(0x205),'t_in':_0xc0f3e5,'t_out':_0x27a5f7,'valve':_0xd813f});if(_0x1df3a2[_0x5a95a8(0x221)]>THERMO_LOG_SIZE)_0x1df3a2[_0x5a95a8(0x225)]();await _0x59639a[_0x5a95a8(0x233)](_0x5a95a8(0x1f8),{'val':JSON[_0x5a95a8(0x232)](_0x1df3a2),'ack':!![]});}async function saveCompletedSequence(_0x2ec200){const _0x47bd0c=a5_0x35d8;try{const _0x33c739=await _0x2ec200[_0x47bd0c(0x1f5)]('LTM.trainingData.sequences');let _0x45f475=[];if(_0x33c739&&_0x33c739[_0x47bd0c(0x201)])try{_0x45f475=JSON['parse'](_0x33c739[_0x47bd0c(0x201)]);}catch(_0x3cb4cc){}const _0x4196c8=activeSequence[0x0]['ts'],_0x27ea2d=activeSequence['map'](_0x3ba00f=>({'loc':_0x3ba00f[_0x47bd0c(0x21d)],'t_delta':Math[_0x47bd0c(0x1ef)]((_0x3ba00f['ts']-_0x4196c8)/0x3e8)})),_0x2428a7={'timestamp':new Date(_0x4196c8)['toISOString'](),'steps':_0x27ea2d,'duration':Math[_0x47bd0c(0x1ef)]((activeSequence[activeSequence[_0x47bd0c(0x221)]-0x1]['ts']-_0x4196c8)/0x3e8),'daytime':new Date(_0x4196c8)[_0x47bd0c(0x1e8)]()};_0x45f475['push'](_0x2428a7);if(_0x45f475[_0x47bd0c(0x221)]>MAX_TRAINING_SET_SIZE)_0x45f475[_0x47bd0c(0x225)]();await _0x2ec200[_0x47bd0c(0x233)](_0x47bd0c(0x242),{'val':JSON[_0x47bd0c(0x232)](_0x45f475),'ack':!![]}),_0x2ec200['isProVersion']&&_0x2ec200[_0x47bd0c(0x1f9)]&&_0x2ec200[_0x47bd0c(0x1f9)]('ANALYZE_SEQUENCE',{'sequence':_0x2428a7});}catch(_0x38a085){_0x2ec200[_0x47bd0c(0x23f)][_0x47bd0c(0x20a)](_0x47bd0c(0x1de)+_0x38a085[_0x47bd0c(0x202)]);}}async function recordSequence(_0x3bee3e,_0x39c473){const _0x351df4=a5_0x35d8,_0x2202af=(_0x39c473[_0x351df4(0x1d3)]||'')[_0x351df4(0x237)](),_0x76a811=[_0x351df4(0x228),_0x351df4(0x1f1),_0x351df4(0x1fc),'presence','occupancy',_0x351df4(0x1ee),_0x351df4(0x22e),_0x351df4(0x224),_0x351df4(0x1ea),_0x351df4(0x236),_0x351df4(0x1e1),_0x351df4(0x227),_0x351df4(0x229),_0x351df4(0x208),_0x351df4(0x1d7),_0x351df4(0x1fd),_0x351df4(0x219)];if(!_0x76a811[_0x351df4(0x21b)](_0xa0e7bb=>_0x2202af[_0x351df4(0x240)](_0xa0e7bb)))return;if(!_0x39c473['value'])return;if(sequenceTimer)clearTimeout(sequenceTimer);activeSequence[_0x351df4(0x1fb)]({'loc':_0x39c473[_0x351df4(0x1eb)]||_0x351df4(0x205),'id':_0x39c473['id'],'ts':Date[_0x351df4(0x1ff)]()}),sequenceTimer=setTimeout(async()=>{const _0x124a07=_0x351df4;if(activeSequence[_0x124a07(0x221)]>0x1)await saveCompletedSequence(_0x3bee3e);activeSequence=[];},SEQUENCE_TIMEOUT_MS);}function startExitTimer(_0x1b03ce){const _0x4127d0=a5_0x35d8;abortExitTimer(_0x1b03ce),_0x1b03ce[_0x4127d0(0x1d5)]=!![],_0x1b03ce[_0x4127d0(0x1ec)]=setTimeout(()=>{const _0x409b01=_0x4127d0;_0x1b03ce[_0x409b01(0x1d5)]=![];},EXIT_GRACE_PERIOD_SECONDS*0x3e8),_0x1b03ce[_0x4127d0(0x20d)]=setTimeout(()=>{const _0x4e8072=_0x4127d0;setPresence(_0x1b03ce,![]),_0x1b03ce[_0x4e8072(0x20d)]=null;},EXIT_TIMER_MINUTES*0x3c*0x3e8);}function abortExitTimer(_0x393e6b){const _0x617859=a5_0x35d8;if(_0x393e6b[_0x617859(0x20d)])clearTimeout(_0x393e6b[_0x617859(0x20d)]);if(_0x393e6b[_0x617859(0x1ec)])clearTimeout(_0x393e6b['exitGraceTimer']);_0x393e6b[_0x617859(0x20d)]=null,_0x393e6b[_0x617859(0x1ec)]=null,_0x393e6b['isGracePeriodActive']=![];}function a5_0x2088(){const _0x1e4b4d=['currentSystemMode','23155aVGLcW','[RECORDER]\x20Ignored\x20implausible\x20temperature:\x20','916DoQuwU','9HsyXdV','3745539eXAJeL','log','includes','name','LTM.trainingData.sequences','.LEVEL','LTM.rawEventLog','type','eventHistory','isGracePeriodActive','level','schalter','splice','from','temperature','.forecast.current.temp','TRACK_EVENT','sensorLastValues','[RECORDER]\x20Error:\x20','toString','debug','kontakt','lastTrackerEventTime','events.history','config','openweathermap','weatherInstance','analysis.health.todayVector','getHours','STATE','fenster','location','exitGraceTimer','replace','door','round','.1.VALVE_STATE','bewegung','LEVEL','.1.TEMPERATURE','2321136FUfyPX','getStateAsync','Temperature','getForeignStateAsync','LTM.trainingData.thermodynamics','sendToPythonWrapper','(((.+)+)+)+$','push','präsenz','dimmer','.forecast.current.temperature','now','temperatur','val','message','\x20from\x20','42ceTAey','Unknown','rawEventLog','isPresent','switch','.1.LEVEL','error','griff','constructor','exitTimer','getDate','fill','number','.1.ACTUAL_TEMPERATURE','SIMULATE_SIGNAL','klima','weatherunderground','isProVersion','95406XRaaOb','search','exports','lampe','apply','some','schloss','loc','STATUS','thermostat','normal','length','logDuplicates','27787430XOfddX','window','shift','10784216gxScip','light','motion','licht','Valve','daswetter','valveMapping','.ACTUAL_TEMPERATURE','tür','parse','isExit','1301011SWCYdE','stringify','setStateAsync','lock','outdoorSensorId','contact','toLowerCase','accuweather'];a5_0x2088=function(){return _0x1e4b4d;};return a5_0x2088();}async function setPresence(_0x10f85c,_0x1978c7){const _0x975144=a5_0x35d8;if(_0x10f85c[_0x975144(0x207)]===_0x1978c7)return;_0x10f85c[_0x975144(0x207)]=_0x1978c7,await _0x10f85c[_0x975144(0x233)]('system.isPresent',{'val':_0x1978c7,'ack':!![]});}async function updateHourlyActivity(_0x1fe55e){const _0x55577c=a5_0x35d8;let _0x98051d=new Array(0x18)[_0x55577c(0x20f)](0x0),_0x34b360=0x0;try{const _0x1e6d54=await _0x1fe55e[_0x55577c(0x1f5)](_0x55577c(0x1e7));_0x1e6d54&&_0x1e6d54[_0x55577c(0x201)]&&(_0x98051d=JSON['parse'](_0x1e6d54['val']),_0x34b360=_0x1e6d54['ts']);}catch(_0xddfb55){}const _0x529792=new Date(_0x34b360),_0x3b9ab5=new Date();_0x529792[_0x55577c(0x20e)]()!==_0x3b9ab5[_0x55577c(0x20e)]()&&(_0x98051d=new Array(0x18)[_0x55577c(0x20f)](0x0));const _0x570e99=_0x3b9ab5[_0x55577c(0x1e8)]();if(_0x98051d[_0x570e99]===undefined)_0x98051d[_0x570e99]=0x0;_0x98051d[_0x570e99]++,await _0x1fe55e[_0x55577c(0x233)](_0x55577c(0x1e7),{'val':JSON[_0x55577c(0x232)](_0x98051d),'ack':!![]});}async function processSensorEvent(_0x21b922,_0x5f2a18,_0x1eea4a,_0x2eb940){const _0x38d0dd=a5_0x35d8;if(!_0x2eb940)return null;const _0x1090c8=_0x1eea4a[_0x38d0dd(0x201)],_0x39eaba=Date[_0x38d0dd(0x1ff)](),_0x56d31e=_0x21b922[_0x38d0dd(0x1dd)][_0x5f2a18],_0xc715db=(_0x2eb940[_0x38d0dd(0x1d3)]||'')[_0x38d0dd(0x237)](),_0xa5ceca=_0xc715db[_0x38d0dd(0x240)](_0x38d0dd(0x1da))||_0xc715db[_0x38d0dd(0x240)](_0x38d0dd(0x200))||_0xc715db[_0x38d0dd(0x240)](_0x38d0dd(0x213))||_0xc715db['includes']('heizung')||_0xc715db[_0x38d0dd(0x240)](_0x38d0dd(0x21f));if(_0xa5ceca&&typeof _0x1090c8===_0x38d0dd(0x210)){if(_0x1090c8>0x50||_0x1090c8<-0x32)return _0x21b922[_0x38d0dd(0x23f)][_0x38d0dd(0x1e0)](_0x38d0dd(0x23b)+_0x1090c8+_0x38d0dd(0x203)+_0x5f2a18),null;}_0x21b922['sensorLastValues'][_0x5f2a18]=_0x1090c8;if(!_0x2eb940[_0x38d0dd(0x222)]&&_0x56d31e!=undefined&&_0x56d31e==_0x1090c8)return null;_0x21b922[_0x38d0dd(0x215)]&&_0xa5ceca&&recordThermodynamics(_0x21b922,_0x5f2a18,_0x1090c8,_0x2eb940[_0x38d0dd(0x1eb)]);const _0x30d320={'timestamp':_0x39eaba,'id':_0x5f2a18,'name':_0x2eb940[_0x38d0dd(0x241)],'type':_0x2eb940[_0x38d0dd(0x1d3)],'location':_0x2eb940[_0x38d0dd(0x1eb)],'value':_0x1090c8};_0x21b922[_0x38d0dd(0x1d4)]['unshift'](_0x30d320);if(_0x21b922['eventHistory'][_0x38d0dd(0x221)]>HISTORY_MAX_SIZE)_0x21b922[_0x38d0dd(0x1d4)]['pop']();await _0x21b922[_0x38d0dd(0x233)]('events.lastEvent',{'val':JSON[_0x38d0dd(0x232)](_0x30d320),'ack':!![]}),await _0x21b922[_0x38d0dd(0x233)](_0x38d0dd(0x1e3),{'val':JSON['stringify'](_0x21b922[_0x38d0dd(0x1d4)]),'ack':!![]}),await updateHourlyActivity(_0x21b922);if(_0x21b922[_0x38d0dd(0x215)]){_0x21b922[_0x38d0dd(0x206)][_0x38d0dd(0x1fb)](_0x30d320);if(_0x21b922[_0x38d0dd(0x206)][_0x38d0dd(0x221)]>RAW_LOG_MAX_SIZE)_0x21b922['rawEventLog'][_0x38d0dd(0x1d8)](0x0,_0x21b922[_0x38d0dd(0x206)][_0x38d0dd(0x221)]-RAW_LOG_MAX_SIZE);await _0x21b922[_0x38d0dd(0x233)](_0x38d0dd(0x1d2),{'val':JSON['stringify'](_0x21b922[_0x38d0dd(0x206)]),'ack':!![]}),recordSequence(_0x21b922,_0x30d320);}if(_0x2eb940[_0x38d0dd(0x230)]&&_0x1090c8===!![]){if(_0x21b922['isPresent']&&!_0x21b922['isGracePeriodActive'])startExitTimer(_0x21b922);else{if(!_0x21b922[_0x38d0dd(0x207)])setPresence(_0x21b922,!![]);}}else{if(_0x2eb940[_0x38d0dd(0x1d3)]===_0x38d0dd(0x228)&&_0x1090c8===!![]){if(_0x21b922['exitTimer'])abortExitTimer(_0x21b922);if(!_0x21b922[_0x38d0dd(0x207)]&&_0x21b922[_0x38d0dd(0x239)]===_0x38d0dd(0x220))setPresence(_0x21b922,!![]);}}if(_0x21b922[_0x38d0dd(0x215)]&&_0x21b922['sendToPythonWrapper']){_0x2eb940['type']===_0x38d0dd(0x228)&&_0x1090c8===!![]&&_0x2eb940[_0x38d0dd(0x1eb)]&&_0x21b922['sendToPythonWrapper'](_0x38d0dd(0x212),{'room':_0x2eb940[_0x38d0dd(0x1eb)]});const _0x4b470a=[_0x38d0dd(0x1ee),_0x38d0dd(0x22e),_0x38d0dd(0x224),_0x38d0dd(0x1ea),_0x38d0dd(0x20b),'handle',_0x38d0dd(0x234),_0x38d0dd(0x21c)][_0x38d0dd(0x21b)](_0x45bd71=>_0xc715db[_0x38d0dd(0x240)](_0x45bd71)),_0x5acb66=[_0x38d0dd(0x227),_0x38d0dd(0x229),_0x38d0dd(0x208),_0x38d0dd(0x1d7),_0x38d0dd(0x1fd),_0x38d0dd(0x219)][_0x38d0dd(0x21b)](_0x4744c1=>_0xc715db[_0x38d0dd(0x240)](_0x4744c1)),_0x3a94ac=['motion',_0x38d0dd(0x1f1),_0x38d0dd(0x1fc),'presence','occupancy'][_0x38d0dd(0x21b)](_0x5553c0=>_0xc715db['includes'](_0x5553c0));if(_0x2eb940[_0x38d0dd(0x1eb)]&&(_0x4b470a||_0x5acb66||_0x3a94ac)){const _0x2e1774=_0x1090c8===!![]||typeof _0x1090c8===_0x38d0dd(0x210)&&_0x1090c8>0x0,_0x57df6e=_0x4b470a&&!_0x2e1774&&_0x56d31e!==undefined&&_0x56d31e!=_0x1090c8;if(_0x2e1774||_0x57df6e){const _0x1956e2=_0x21b922['lastTrackerEventTime']||_0x39eaba,_0x15702c=(_0x39eaba-_0x1956e2)/0x3e8;_0x21b922[_0x38d0dd(0x1e2)]=_0x39eaba,_0x21b922['sendToPythonWrapper'](_0x38d0dd(0x1dc),{'room':_0x2eb940[_0x38d0dd(0x1eb)],'dt':_0x15702c});}}}return _0x30d320;}module[a5_0x405aba(0x218)]={'processSensorEvent':processSensorEvent,'getOutsideTemperatureNumeric':getOutsideTemperatureNumeric,'setPresence':setPresence,'abortExitTimer':abortExitTimer,'startExitTimer':startExitTimer};