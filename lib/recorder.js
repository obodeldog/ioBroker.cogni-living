const a5_0x251bd3=a5_0x3b62;(function(_0x52d34f,_0x36d08e){const _0x7047a3=a5_0x3b62,_0x4e5af7=_0x52d34f();while(!![]){try{const _0x51eb17=parseInt(_0x7047a3(0x15c))/0x1+parseInt(_0x7047a3(0x168))/0x2*(parseInt(_0x7047a3(0x112))/0x3)+parseInt(_0x7047a3(0x16a))/0x4+-parseInt(_0x7047a3(0x171))/0x5*(-parseInt(_0x7047a3(0x170))/0x6)+parseInt(_0x7047a3(0x12e))/0x7*(parseInt(_0x7047a3(0x146))/0x8)+-parseInt(_0x7047a3(0x163))/0x9*(parseInt(_0x7047a3(0x169))/0xa)+-parseInt(_0x7047a3(0x13f))/0xb;if(_0x51eb17===_0x36d08e)break;else _0x4e5af7['push'](_0x4e5af7['shift']());}catch(_0x4d81f8){_0x4e5af7['push'](_0x4e5af7['shift']());}}}(a5_0x4a8a,0xe8cdb));function a5_0x4a8a(){const _0x56cb5a=['parse','map','sendToPythonWrapper','daswetter','val','length','light','accuweather','isProVersion','schloss','search','isExit','config','1199478vupzyt','handle','level','window','push','fenster','bewegung','Temperature','switch','getHours','Valve','STATUS','contact','presence','now','exports','LTM.trainingData.thermodynamics','shift','value','.1.ACTUAL_TEMPERATURE','getStateAsync','toLowerCase','[RECORDER]\x20Ignored\x20implausible\x20temperature:\x20','STATE','temperature','weatherunderground','splice','replace','212443LRiTCL','temperatur','klima','stringify','isPresent','some','.forecast.current.temp','toString','pop','apply','dimmer','thermostat','.LEVEL','valveMapping','rawEventLog','from','schalter','13204268iWrbiw','motion','sensorLastValues','currentSystemMode','[RECORDER]\x20Error:\x20','(((.+)+)+)+$','unshift','176Fsztki','isGracePeriodActive','tür','outdoorSensorId','includes','events.lastEvent','log','logDuplicates','round','number','.1.LEVEL','loc','location','setStateAsync','.Current.Temperature','ANALYZE_SEQUENCE','SIMULATE_SIGNAL','präsenz','.forecast.current.temperature','.1.VALVE_STATE','LTM.trainingData.sequences','exitGraceTimer','866191kPMDIJ','exitTimer','getForeignStateAsync','.NextHours.Location_1.Day_1.current.temp_value','lastTrackerEventTime','constructor','message','8493912pzEOiQ','licht','\x20from\x20','occupancy','Unknown','2fClOxY','10PXsend','4349744ISbhyS','LEVEL','debug','normal','.4.VALVE_STATE','eventHistory','492jPJQAL','4670aSQJCd','type','error','system.isPresent'];a5_0x4a8a=function(){return _0x56cb5a;};return a5_0x4a8a();}const a5_0x59a912=(function(){let _0xb7335b=!![];return function(_0x4884ab,_0xc1eba8){const _0x5b816a=_0xb7335b?function(){const _0x4a6dc3=a5_0x3b62;if(_0xc1eba8){const _0x3924f8=_0xc1eba8[_0x4a6dc3(0x137)](_0x4884ab,arguments);return _0xc1eba8=null,_0x3924f8;}}:function(){};return _0xb7335b=![],_0x5b816a;};}()),a5_0x1d6f33=a5_0x59a912(this,function(){const _0x2e6c0b=a5_0x3b62;return a5_0x1d6f33[_0x2e6c0b(0x135)]()[_0x2e6c0b(0x10f)](_0x2e6c0b(0x144))[_0x2e6c0b(0x135)]()[_0x2e6c0b(0x161)](a5_0x1d6f33)['search'](_0x2e6c0b(0x144));});a5_0x1d6f33();'use strict';function a5_0x3b62(_0x5b488e,_0x97f261){const _0x2a3d1e=a5_0x4a8a();return a5_0x3b62=function(_0x1d6f33,_0x59a912){_0x1d6f33=_0x1d6f33-0x103;let _0x4a8acc=_0x2a3d1e[_0x1d6f33];return _0x4a8acc;},a5_0x3b62(_0x5b488e,_0x97f261);}const HISTORY_MAX_SIZE=0x32,RAW_LOG_MAX_SIZE=0x9c4,THERMO_LOG_SIZE=0x3e8,SEQUENCE_TIMEOUT_MS=0x5*0x3c*0x3e8,MAX_TRAINING_SET_SIZE=0x1f4,EXIT_TIMER_MINUTES=0xf,EXIT_GRACE_PERIOD_SECONDS=0x1e;let activeSequence=[],sequenceTimer=null;async function getOutsideTemperatureNumeric(_0x1133cc){const _0x358e58=a5_0x3b62;if(_0x1133cc[_0x358e58(0x111)][_0x358e58(0x149)])try{const _0x2fd928=await _0x1133cc[_0x358e58(0x15e)](_0x1133cc[_0x358e58(0x111)][_0x358e58(0x149)]);if(_0x2fd928&&_0x2fd928[_0x358e58(0x109)]!==undefined&&_0x2fd928[_0x358e58(0x109)]!==null)return parseFloat(_0x2fd928[_0x358e58(0x109)]);}catch(_0x192b42){}const _0x18e8a6=_0x1133cc[_0x358e58(0x111)]['weatherInstance'];if(!_0x1133cc[_0x358e58(0x111)]['useWeather']||!_0x18e8a6)return null;try{let _0x4b6525='';if(_0x18e8a6[_0x358e58(0x14a)](_0x358e58(0x10c)))_0x4b6525=_0x18e8a6+_0x358e58(0x154);else{if(_0x18e8a6['includes'](_0x358e58(0x108)))_0x4b6525=_0x18e8a6+_0x358e58(0x15f);else{if(_0x18e8a6[_0x358e58(0x14a)]('openweathermap'))_0x4b6525=_0x18e8a6+_0x358e58(0x158);else{if(_0x18e8a6['includes'](_0x358e58(0x12b)))_0x4b6525=_0x18e8a6+_0x358e58(0x134);}}}if(_0x4b6525){const _0x183d1b=await _0x1133cc[_0x358e58(0x15e)](_0x4b6525);if(_0x183d1b&&_0x183d1b[_0x358e58(0x109)]!==undefined&&_0x183d1b[_0x358e58(0x109)]!==null)return parseFloat(_0x183d1b['val']);}}catch(_0x545e6a){}return null;}async function recordThermodynamics(_0x39b41e,_0x46fb32,_0x1c7804,_0x37fcb5){const _0x851624=a5_0x3b62,_0x42bd9c=await getOutsideTemperatureNumeric(_0x39b41e);if(_0x42bd9c===null)return;let _0x2835cc=0x0,_0x49056a=![];if(_0x39b41e[_0x851624(0x111)][_0x851624(0x13b)])try{let _0x5ef68c=_0x39b41e[_0x851624(0x111)]['valveMapping'];if(typeof _0x5ef68c==='string')_0x5ef68c=JSON[_0x851624(0x105)](_0x5ef68c);if(_0x5ef68c[_0x46fb32]){const _0x4a4105=_0x5ef68c[_0x46fb32],_0x16cc94=await _0x39b41e[_0x851624(0x15e)](_0x4a4105);if(_0x16cc94&&_0x16cc94['val']!==null&&_0x16cc94[_0x851624(0x109)]!==undefined){let _0x254c9d=Number(_0x16cc94[_0x851624(0x109)]);if(_0x254c9d<=1.05&&!_0x4a4105[_0x851624(0x14a)](_0x851624(0x11d))&&!_0x4a4105[_0x851624(0x14a)](_0x851624(0x129)))_0x254c9d=_0x254c9d*0x64;_0x2835cc=Math[_0x851624(0x14e)](_0x254c9d),_0x49056a=!![];}}}catch(_0x149b02){}if(!_0x49056a){const _0xaf2c65=[{'from':_0x851624(0x125),'to':_0x851624(0x150)},{'from':_0x851624(0x125),'to':_0x851624(0x159)},{'from':'.1.TEMPERATURE','to':_0x851624(0x16e)},{'from':'.ACTUAL_TEMPERATURE','to':_0x851624(0x13a)},{'from':_0x851624(0x12a),'to':_0x851624(0x114)},{'from':_0x851624(0x119),'to':_0x851624(0x11c)}];for(const _0x4b0d42 of _0xaf2c65){if(_0x46fb32['includes'](_0x4b0d42[_0x851624(0x13d)])){const _0x293acf=_0x46fb32[_0x851624(0x12d)](_0x4b0d42[_0x851624(0x13d)],_0x4b0d42['to']);try{const _0x1b7df5=await _0x39b41e[_0x851624(0x15e)](_0x293acf);if(_0x1b7df5&&_0x1b7df5[_0x851624(0x109)]!==null&&_0x1b7df5[_0x851624(0x109)]!==undefined){let _0x287413=Number(_0x1b7df5[_0x851624(0x109)]);if(typeof _0x287413==='number'){if(_0x287413<=1.05&&_0x4b0d42['to']['includes'](_0x851624(0x16b)))_0x287413=_0x287413*0x64;_0x2835cc=Math['round'](_0x287413),_0x49056a=!![];break;}}}catch(_0x108feb){}}}}const _0x32ad17=await _0x39b41e['getStateAsync'](_0x851624(0x122));let _0x527566=[];if(_0x32ad17&&_0x32ad17[_0x851624(0x109)])try{_0x527566=JSON[_0x851624(0x105)](_0x32ad17[_0x851624(0x109)]);}catch(_0x584144){}_0x527566[_0x851624(0x116)]({'ts':Date['now'](),'room':_0x37fcb5||_0x851624(0x167),'t_in':_0x1c7804,'t_out':_0x42bd9c,'valve':_0x2835cc});if(_0x527566[_0x851624(0x10a)]>THERMO_LOG_SIZE)_0x527566[_0x851624(0x123)]();await _0x39b41e[_0x851624(0x153)]('LTM.trainingData.thermodynamics',{'val':JSON['stringify'](_0x527566),'ack':!![]});}async function saveCompletedSequence(_0xa9023a){const _0x380811=a5_0x3b62;try{const _0x3e4a5a=await _0xa9023a[_0x380811(0x126)](_0x380811(0x15a));let _0x13002a=[];if(_0x3e4a5a&&_0x3e4a5a[_0x380811(0x109)])try{_0x13002a=JSON[_0x380811(0x105)](_0x3e4a5a[_0x380811(0x109)]);}catch(_0x4b6367){}const _0x1b44bc=activeSequence[0x0]['ts'],_0x266272=activeSequence[_0x380811(0x106)](_0x1648ab=>({'loc':_0x1648ab[_0x380811(0x151)],'t_delta':Math[_0x380811(0x14e)]((_0x1648ab['ts']-_0x1b44bc)/0x3e8)})),_0x11e114={'timestamp':new Date(_0x1b44bc)['toISOString'](),'steps':_0x266272,'duration':Math[_0x380811(0x14e)]((activeSequence[activeSequence[_0x380811(0x10a)]-0x1]['ts']-_0x1b44bc)/0x3e8),'daytime':new Date(_0x1b44bc)[_0x380811(0x11b)]()};_0x13002a['push'](_0x11e114);if(_0x13002a['length']>MAX_TRAINING_SET_SIZE)_0x13002a[_0x380811(0x123)]();await _0xa9023a[_0x380811(0x153)](_0x380811(0x15a),{'val':JSON[_0x380811(0x131)](_0x13002a),'ack':!![]}),_0xa9023a[_0x380811(0x10d)]&&_0xa9023a[_0x380811(0x107)]&&_0xa9023a[_0x380811(0x107)](_0x380811(0x155),{'sequence':_0x11e114});}catch(_0x26a497){_0xa9023a[_0x380811(0x14c)][_0x380811(0x103)](_0x380811(0x143)+_0x26a497[_0x380811(0x162)]);}}async function recordSequence(_0x149a00,_0x121cfb){const _0x161dd7=a5_0x3b62,_0x3733e4=(_0x121cfb[_0x161dd7(0x172)]||'')[_0x161dd7(0x127)](),_0xb77287=[_0x161dd7(0x140),_0x161dd7(0x118),_0x161dd7(0x157),_0x161dd7(0x11f),_0x161dd7(0x166),'door',_0x161dd7(0x148),'window','fenster',_0x161dd7(0x11e),'kontakt',_0x161dd7(0x10b),_0x161dd7(0x164),_0x161dd7(0x11a),'schalter','dimmer','lampe'];if(!_0xb77287[_0x161dd7(0x133)](_0x132be7=>_0x3733e4[_0x161dd7(0x14a)](_0x132be7)))return;if(!_0x121cfb[_0x161dd7(0x124)])return;if(sequenceTimer)clearTimeout(sequenceTimer);activeSequence[_0x161dd7(0x116)]({'loc':_0x121cfb[_0x161dd7(0x152)]||_0x161dd7(0x167),'id':_0x121cfb['id'],'ts':Date[_0x161dd7(0x120)]()}),sequenceTimer=setTimeout(async()=>{if(activeSequence['length']>0x1)await saveCompletedSequence(_0x149a00);activeSequence=[];},SEQUENCE_TIMEOUT_MS);}function startExitTimer(_0x586048){const _0x5215cd=a5_0x3b62;abortExitTimer(_0x586048),_0x586048[_0x5215cd(0x147)]=!![],_0x586048[_0x5215cd(0x15b)]=setTimeout(()=>{const _0x46cda6=_0x5215cd;_0x586048[_0x46cda6(0x147)]=![];},EXIT_GRACE_PERIOD_SECONDS*0x3e8),_0x586048[_0x5215cd(0x15d)]=setTimeout(()=>{const _0x5b454c=_0x5215cd;setPresence(_0x586048,![]),_0x586048[_0x5b454c(0x15d)]=null;},EXIT_TIMER_MINUTES*0x3c*0x3e8);}function abortExitTimer(_0xf4ff12){const _0x4373ff=a5_0x3b62;if(_0xf4ff12[_0x4373ff(0x15d)])clearTimeout(_0xf4ff12['exitTimer']);if(_0xf4ff12['exitGraceTimer'])clearTimeout(_0xf4ff12[_0x4373ff(0x15b)]);_0xf4ff12[_0x4373ff(0x15d)]=null,_0xf4ff12[_0x4373ff(0x15b)]=null,_0xf4ff12['isGracePeriodActive']=![];}async function setPresence(_0x4063be,_0x2660de){const _0x2e9d7b=a5_0x3b62;if(_0x4063be['isPresent']===_0x2660de)return;_0x4063be[_0x2e9d7b(0x132)]=_0x2660de,await _0x4063be[_0x2e9d7b(0x153)](_0x2e9d7b(0x104),{'val':_0x2660de,'ack':!![]});}async function processSensorEvent(_0x3ad62d,_0x3e204a,_0x1fa09f,_0x9dacde){const _0x1c652a=a5_0x3b62;if(!_0x9dacde)return null;const _0x49d0c0=_0x1fa09f[_0x1c652a(0x109)],_0x5e7dcd=Date['now'](),_0x29c5a3=_0x3ad62d[_0x1c652a(0x141)][_0x3e204a],_0xee1c3a=(_0x9dacde[_0x1c652a(0x172)]||'')[_0x1c652a(0x127)](),_0x4be758=_0xee1c3a[_0x1c652a(0x14a)](_0x1c652a(0x12a))||_0xee1c3a['includes'](_0x1c652a(0x12f))||_0xee1c3a[_0x1c652a(0x14a)](_0x1c652a(0x130))||_0xee1c3a['includes']('heizung')||_0xee1c3a[_0x1c652a(0x14a)](_0x1c652a(0x139));if(_0x4be758&&typeof _0x49d0c0===_0x1c652a(0x14f)){if(_0x49d0c0>0x50||_0x49d0c0<-0x32)return _0x3ad62d[_0x1c652a(0x14c)][_0x1c652a(0x16c)](_0x1c652a(0x128)+_0x49d0c0+_0x1c652a(0x165)+_0x3e204a),null;}_0x3ad62d[_0x1c652a(0x141)][_0x3e204a]=_0x49d0c0;if(!_0x9dacde[_0x1c652a(0x14d)]&&_0x29c5a3!=undefined&&_0x29c5a3==_0x49d0c0)return null;_0x3ad62d[_0x1c652a(0x10d)]&&_0x4be758&&recordThermodynamics(_0x3ad62d,_0x3e204a,_0x49d0c0,_0x9dacde[_0x1c652a(0x152)]);const _0x447009={'timestamp':_0x5e7dcd,'id':_0x3e204a,'name':_0x9dacde['name'],'type':_0x9dacde[_0x1c652a(0x172)],'location':_0x9dacde[_0x1c652a(0x152)],'value':_0x49d0c0};_0x3ad62d[_0x1c652a(0x16f)][_0x1c652a(0x145)](_0x447009);if(_0x3ad62d['eventHistory']['length']>HISTORY_MAX_SIZE)_0x3ad62d[_0x1c652a(0x16f)][_0x1c652a(0x136)]();await _0x3ad62d[_0x1c652a(0x153)](_0x1c652a(0x14b),{'val':JSON[_0x1c652a(0x131)](_0x447009),'ack':!![]}),await _0x3ad62d[_0x1c652a(0x153)]('events.history',{'val':JSON[_0x1c652a(0x131)](_0x3ad62d[_0x1c652a(0x16f)]),'ack':!![]});if(_0x3ad62d['isProVersion']){_0x3ad62d[_0x1c652a(0x13c)]['push'](_0x447009);if(_0x3ad62d[_0x1c652a(0x13c)][_0x1c652a(0x10a)]>RAW_LOG_MAX_SIZE)_0x3ad62d[_0x1c652a(0x13c)][_0x1c652a(0x12c)](0x0,_0x3ad62d[_0x1c652a(0x13c)]['length']-RAW_LOG_MAX_SIZE);await _0x3ad62d[_0x1c652a(0x153)]('LTM.rawEventLog',{'val':JSON[_0x1c652a(0x131)](_0x3ad62d[_0x1c652a(0x13c)]),'ack':!![]}),recordSequence(_0x3ad62d,_0x447009);}if(_0x9dacde[_0x1c652a(0x110)]&&_0x49d0c0===!![]){if(_0x3ad62d[_0x1c652a(0x132)]&&!_0x3ad62d[_0x1c652a(0x147)])startExitTimer(_0x3ad62d);else{if(!_0x3ad62d[_0x1c652a(0x132)])setPresence(_0x3ad62d,!![]);}}else{if(_0x9dacde[_0x1c652a(0x172)]==='motion'&&_0x49d0c0===!![]){if(_0x3ad62d[_0x1c652a(0x15d)])abortExitTimer(_0x3ad62d);if(!_0x3ad62d[_0x1c652a(0x132)]&&_0x3ad62d[_0x1c652a(0x142)]===_0x1c652a(0x16d))setPresence(_0x3ad62d,!![]);}}if(_0x3ad62d[_0x1c652a(0x10d)]&&_0x3ad62d['sendToPythonWrapper']){_0x9dacde[_0x1c652a(0x172)]===_0x1c652a(0x140)&&_0x49d0c0===!![]&&_0x9dacde[_0x1c652a(0x152)]&&_0x3ad62d[_0x1c652a(0x107)](_0x1c652a(0x156),{'room':_0x9dacde[_0x1c652a(0x152)]});const _0x5aa688=['door',_0x1c652a(0x148),_0x1c652a(0x115),_0x1c652a(0x117),'griff',_0x1c652a(0x113),'lock',_0x1c652a(0x10e)][_0x1c652a(0x133)](_0x489808=>_0xee1c3a[_0x1c652a(0x14a)](_0x489808)),_0x201a0f=[_0x1c652a(0x10b),_0x1c652a(0x164),_0x1c652a(0x11a),_0x1c652a(0x13e),_0x1c652a(0x138),'lampe'][_0x1c652a(0x133)](_0x1be4c0=>_0xee1c3a[_0x1c652a(0x14a)](_0x1be4c0)),_0xb692c8=['motion','bewegung',_0x1c652a(0x157),_0x1c652a(0x11f),_0x1c652a(0x166)][_0x1c652a(0x133)](_0x1ffbb3=>_0xee1c3a[_0x1c652a(0x14a)](_0x1ffbb3));if(_0x9dacde['location']&&(_0x5aa688||_0x201a0f||_0xb692c8)){const _0xcd807c=_0x49d0c0===!![]||typeof _0x49d0c0===_0x1c652a(0x14f)&&_0x49d0c0>0x0,_0xdd573c=_0x5aa688&&!_0xcd807c&&_0x29c5a3!==undefined&&_0x29c5a3!=_0x49d0c0;if(_0xcd807c||_0xdd573c){const _0x3a9955=_0x3ad62d[_0x1c652a(0x160)]||_0x5e7dcd,_0x43b3d5=(_0x5e7dcd-_0x3a9955)/0x3e8;_0x3ad62d['lastTrackerEventTime']=_0x5e7dcd,_0x3ad62d[_0x1c652a(0x107)]('TRACK_EVENT',{'room':_0x9dacde[_0x1c652a(0x152)],'dt':_0x43b3d5});}}}return _0x447009;}module[a5_0x251bd3(0x121)]={'processSensorEvent':processSensorEvent,'getOutsideTemperatureNumeric':getOutsideTemperatureNumeric,'setPresence':setPresence,'abortExitTimer':abortExitTimer,'startExitTimer':startExitTimer};