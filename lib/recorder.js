const a5_0x123c37=a5_0x88a8;(function(_0x4b94fe,_0x3d2a6f){const _0x10f294=a5_0x88a8,_0x179f1f=_0x4b94fe();while(!![]){try{const _0x30efa2=parseInt(_0x10f294(0x155))/0x1*(parseInt(_0x10f294(0x177))/0x2)+parseInt(_0x10f294(0x126))/0x3*(-parseInt(_0x10f294(0x146))/0x4)+-parseInt(_0x10f294(0x123))/0x5*(parseInt(_0x10f294(0x160))/0x6)+-parseInt(_0x10f294(0x147))/0x7*(parseInt(_0x10f294(0x175))/0x8)+parseInt(_0x10f294(0x14e))/0x9+-parseInt(_0x10f294(0x158))/0xa+-parseInt(_0x10f294(0x119))/0xb*(-parseInt(_0x10f294(0x15e))/0xc);if(_0x30efa2===_0x3d2a6f)break;else _0x179f1f['push'](_0x179f1f['shift']());}catch(_0x2422ce){_0x179f1f['push'](_0x179f1f['shift']());}}}(a5_0x1109,0xd26b8));const a5_0x5e33e3=(function(){let _0x42c461=!![];return function(_0x522fcd,_0x5848d0){const _0x3bfa31=_0x42c461?function(){const _0x3d9223=a5_0x88a8;if(_0x5848d0){const _0x1590c4=_0x5848d0[_0x3d9223(0x128)](_0x522fcd,arguments);return _0x5848d0=null,_0x1590c4;}}:function(){};return _0x42c461=![],_0x3bfa31;};}()),a5_0x4b9360=a5_0x5e33e3(this,function(){const _0x130cd9=a5_0x88a8;return a5_0x4b9360[_0x130cd9(0x179)]()[_0x130cd9(0x135)](_0x130cd9(0x138))['toString']()[_0x130cd9(0x142)](a5_0x4b9360)[_0x130cd9(0x135)](_0x130cd9(0x138));});a5_0x4b9360();'use strict';const HISTORY_MAX_SIZE=0x32,RAW_LOG_MAX_SIZE=0x9c4,THERMO_LOG_SIZE=0x3e8,SEQUENCE_TIMEOUT_MS=0x5*0x3c*0x3e8,MAX_TRAINING_SET_SIZE=0x1f4,EXIT_TIMER_MINUTES=0xf,EXIT_GRACE_PERIOD_SECONDS=0x1e;let activeSequence=[],sequenceTimer=null;function a5_0x1109(){const _0xc7290f=['1KNVjOv','eventHistory','präsenz','14059130LpOQJM','some','valveMapping','weatherInstance','replace','isExit','10427148vMJIKe','.1.LEVEL','2039118HukHlM','parse','exports','STATE','temperature','handle','currentSystemMode','isPresent','motion','.NextHours.Location_1.Day_1.current.temp_value','presence','push','licht','Unknown','level','openweathermap','isGracePeriodActive','light','getHours','schloss','bewegung','2512vguhaQ','.ACTUAL_TEMPERATURE','521454zkHlrx','LTM.rawEventLog','toString','outdoorSensorId','splice','round','kontakt','events.history','setStateAsync','logDuplicates','[RECORDER]\x20Error:\x20','heizung','.1.VALVE_STATE','value','.LEVEL','window','SIMULATE_SIGNAL','55fPzbGu','stringify','tür','contact','length','map','message','lastTrackerEventTime','\x20from\x20','getForeignStateAsync','10OjPsSp','dimmer','sensorLastValues','729072sDQheh','weatherunderground','apply','daswetter','LTM.trainingData.thermodynamics','system.isPresent','rawEventLog','switch','occupancy','loc','door','toLowerCase','sendToPythonWrapper','Valve','unshift','search','exitGraceTimer','shift','(((.+)+)+)+$','getStateAsync','klima','from','.forecast.current.temperature','fenster','schalter','error','string','type','constructor','location','log','lampe','8odnnXj','34468wtoXIp','griff','ANALYZE_SEQUENCE','isProVersion','toISOString','config','includes','3368799GxVUig','Temperature','exitTimer','STATUS','val','.1.ACTUAL_TEMPERATURE','name'];a5_0x1109=function(){return _0xc7290f;};return a5_0x1109();}async function getOutsideTemperatureNumeric(_0x3ad04f){const _0x33ff2d=a5_0x88a8;if(_0x3ad04f['config'][_0x33ff2d(0x17a)])try{const _0x2534ef=await _0x3ad04f['getForeignStateAsync'](_0x3ad04f['config'][_0x33ff2d(0x17a)]);if(_0x2534ef&&_0x2534ef['val']!==undefined&&_0x2534ef[_0x33ff2d(0x152)]!==null)return parseFloat(_0x2534ef[_0x33ff2d(0x152)]);}catch(_0x590fdc){}const _0x4daeb0=_0x3ad04f[_0x33ff2d(0x14c)][_0x33ff2d(0x15b)];if(!_0x3ad04f['config']['useWeather']||!_0x4daeb0)return null;try{let _0x430dee='';if(_0x4daeb0[_0x33ff2d(0x14d)]('accuweather'))_0x430dee=_0x4daeb0+'.Current.Temperature';else{if(_0x4daeb0[_0x33ff2d(0x14d)](_0x33ff2d(0x129)))_0x430dee=_0x4daeb0+_0x33ff2d(0x169);else{if(_0x4daeb0[_0x33ff2d(0x14d)](_0x33ff2d(0x16f)))_0x430dee=_0x4daeb0+_0x33ff2d(0x13c);else{if(_0x4daeb0[_0x33ff2d(0x14d)](_0x33ff2d(0x127)))_0x430dee=_0x4daeb0+'.forecast.current.temp';}}}if(_0x430dee){const _0x531039=await _0x3ad04f[_0x33ff2d(0x122)](_0x430dee);if(_0x531039&&_0x531039['val']!==undefined&&_0x531039[_0x33ff2d(0x152)]!==null)return parseFloat(_0x531039[_0x33ff2d(0x152)]);}}catch(_0x45854c){}return null;}async function recordThermodynamics(_0x4f9a0b,_0x424f31,_0x57e953,_0xc5269d){const _0x189cc6=a5_0x88a8,_0x24128e=await getOutsideTemperatureNumeric(_0x4f9a0b);if(_0x24128e===null)return;let _0x32bde2=0x0,_0x4aab62=![];if(_0x4f9a0b[_0x189cc6(0x14c)][_0x189cc6(0x15a)])try{let _0x32ba13=_0x4f9a0b['config'][_0x189cc6(0x15a)];if(typeof _0x32ba13===_0x189cc6(0x140))_0x32ba13=JSON[_0x189cc6(0x161)](_0x32ba13);if(_0x32ba13[_0x424f31]){const _0xeb07d7=_0x32ba13[_0x424f31],_0x2132d8=await _0x4f9a0b[_0x189cc6(0x122)](_0xeb07d7);if(_0x2132d8&&_0x2132d8[_0x189cc6(0x152)]!==null&&_0x2132d8['val']!==undefined){let _0x360215=Number(_0x2132d8[_0x189cc6(0x152)]);if(_0x360215<=1.05&&!_0xeb07d7[_0x189cc6(0x14d)](_0x189cc6(0x151))&&!_0xeb07d7['includes'](_0x189cc6(0x163)))_0x360215=_0x360215*0x64;_0x32bde2=Math['round'](_0x360215),_0x4aab62=!![];}}}catch(_0x34e992){}if(!_0x4aab62){const _0x22930a=[{'from':_0x189cc6(0x153),'to':_0x189cc6(0x15f)},{'from':_0x189cc6(0x153),'to':_0x189cc6(0x114)},{'from':'.1.TEMPERATURE','to':'.4.VALVE_STATE'},{'from':_0x189cc6(0x176),'to':_0x189cc6(0x116)},{'from':_0x189cc6(0x164),'to':_0x189cc6(0x16e)},{'from':_0x189cc6(0x14f),'to':_0x189cc6(0x133)}];for(const _0x3fec0a of _0x22930a){if(_0x424f31[_0x189cc6(0x14d)](_0x3fec0a['from'])){const _0x4eac48=_0x424f31[_0x189cc6(0x15c)](_0x3fec0a[_0x189cc6(0x13b)],_0x3fec0a['to']);try{const _0x361d55=await _0x4f9a0b[_0x189cc6(0x122)](_0x4eac48);if(_0x361d55&&_0x361d55['val']!==null&&_0x361d55[_0x189cc6(0x152)]!==undefined){let _0x31609a=Number(_0x361d55[_0x189cc6(0x152)]);if(typeof _0x31609a==='number'){if(_0x31609a<=1.05&&_0x3fec0a['to'][_0x189cc6(0x14d)]('LEVEL'))_0x31609a=_0x31609a*0x64;_0x32bde2=Math['round'](_0x31609a),_0x4aab62=!![];break;}}}catch(_0x214144){}}}}const _0x15d75a=await _0x4f9a0b[_0x189cc6(0x139)](_0x189cc6(0x12a));let _0x58f394=[];if(_0x15d75a&&_0x15d75a['val'])try{_0x58f394=JSON[_0x189cc6(0x161)](_0x15d75a['val']);}catch(_0x2bc45e){}_0x58f394[_0x189cc6(0x16b)]({'ts':Date['now'](),'room':_0xc5269d||_0x189cc6(0x16d),'t_in':_0x57e953,'t_out':_0x24128e,'valve':_0x32bde2});if(_0x58f394[_0x189cc6(0x11d)]>THERMO_LOG_SIZE)_0x58f394['shift']();await _0x4f9a0b[_0x189cc6(0x17f)](_0x189cc6(0x12a),{'val':JSON[_0x189cc6(0x11a)](_0x58f394),'ack':!![]});}async function saveCompletedSequence(_0x1e4200){const _0x50ed9a=a5_0x88a8;try{const _0x519115=await _0x1e4200['getStateAsync']('LTM.trainingData.sequences');let _0x1541a1=[];if(_0x519115&&_0x519115[_0x50ed9a(0x152)])try{_0x1541a1=JSON['parse'](_0x519115[_0x50ed9a(0x152)]);}catch(_0x6ad63b){}const _0x546480=activeSequence[0x0]['ts'],_0x569111=activeSequence[_0x50ed9a(0x11e)](_0x3d8151=>({'loc':_0x3d8151[_0x50ed9a(0x12f)],'t_delta':Math[_0x50ed9a(0x17c)]((_0x3d8151['ts']-_0x546480)/0x3e8)})),_0x4a0a7d={'timestamp':new Date(_0x546480)[_0x50ed9a(0x14b)](),'steps':_0x569111,'duration':Math['round']((activeSequence[activeSequence[_0x50ed9a(0x11d)]-0x1]['ts']-_0x546480)/0x3e8),'daytime':new Date(_0x546480)[_0x50ed9a(0x172)]()};_0x1541a1[_0x50ed9a(0x16b)](_0x4a0a7d);if(_0x1541a1[_0x50ed9a(0x11d)]>MAX_TRAINING_SET_SIZE)_0x1541a1[_0x50ed9a(0x137)]();await _0x1e4200[_0x50ed9a(0x17f)]('LTM.trainingData.sequences',{'val':JSON['stringify'](_0x1541a1),'ack':!![]}),_0x1e4200[_0x50ed9a(0x14a)]&&_0x1e4200['sendToPythonWrapper']&&_0x1e4200[_0x50ed9a(0x132)](_0x50ed9a(0x149),{'sequence':_0x4a0a7d});}catch(_0x287be4){_0x1e4200[_0x50ed9a(0x144)][_0x50ed9a(0x13f)](_0x50ed9a(0x181)+_0x287be4[_0x50ed9a(0x11f)]);}}async function recordSequence(_0x373c82,_0x596116){const _0x201fd2=a5_0x88a8,_0x276d92=(_0x596116['type']||'')[_0x201fd2(0x131)](),_0x24b69b=[_0x201fd2(0x168),_0x201fd2(0x174),_0x201fd2(0x157),_0x201fd2(0x16a),_0x201fd2(0x12e),_0x201fd2(0x130),_0x201fd2(0x11b),_0x201fd2(0x117),_0x201fd2(0x13d),_0x201fd2(0x11c),_0x201fd2(0x17d),_0x201fd2(0x171),_0x201fd2(0x16c),_0x201fd2(0x12d),_0x201fd2(0x13e),_0x201fd2(0x124),_0x201fd2(0x145)];if(!_0x24b69b[_0x201fd2(0x159)](_0x621ca7=>_0x276d92[_0x201fd2(0x14d)](_0x621ca7)))return;if(!_0x596116[_0x201fd2(0x115)])return;if(sequenceTimer)clearTimeout(sequenceTimer);activeSequence[_0x201fd2(0x16b)]({'loc':_0x596116[_0x201fd2(0x143)]||_0x201fd2(0x16d),'id':_0x596116['id'],'ts':Date['now']()}),sequenceTimer=setTimeout(async()=>{if(activeSequence['length']>0x1)await saveCompletedSequence(_0x373c82);activeSequence=[];},SEQUENCE_TIMEOUT_MS);}function startExitTimer(_0x4f9e8c){const _0x27598b=a5_0x88a8;abortExitTimer(_0x4f9e8c),_0x4f9e8c[_0x27598b(0x170)]=!![],_0x4f9e8c['exitGraceTimer']=setTimeout(()=>{const _0x2d8321=_0x27598b;_0x4f9e8c[_0x2d8321(0x170)]=![];},EXIT_GRACE_PERIOD_SECONDS*0x3e8),_0x4f9e8c[_0x27598b(0x150)]=setTimeout(()=>{const _0x1bbff9=_0x27598b;setPresence(_0x4f9e8c,![]),_0x4f9e8c[_0x1bbff9(0x150)]=null;},EXIT_TIMER_MINUTES*0x3c*0x3e8);}function abortExitTimer(_0xeea473){const _0xb02e80=a5_0x88a8;if(_0xeea473[_0xb02e80(0x150)])clearTimeout(_0xeea473[_0xb02e80(0x150)]);if(_0xeea473[_0xb02e80(0x136)])clearTimeout(_0xeea473[_0xb02e80(0x136)]);_0xeea473[_0xb02e80(0x150)]=null,_0xeea473[_0xb02e80(0x136)]=null,_0xeea473['isGracePeriodActive']=![];}async function setPresence(_0x293685,_0x11e6fd){const _0xb7746b=a5_0x88a8;if(_0x293685['isPresent']===_0x11e6fd)return;_0x293685['isPresent']=_0x11e6fd,await _0x293685['setStateAsync'](_0xb7746b(0x12b),{'val':_0x11e6fd,'ack':!![]});}function a5_0x88a8(_0x4030f4,_0x194a42){const _0x10edc2=a5_0x1109();return a5_0x88a8=function(_0x4b9360,_0x5e33e3){_0x4b9360=_0x4b9360-0x114;let _0x11094c=_0x10edc2[_0x4b9360];return _0x11094c;},a5_0x88a8(_0x4030f4,_0x194a42);}async function processSensorEvent(_0x4df0e3,_0x5e964d,_0x44f0c1,_0x3b8419){const _0x2a7400=a5_0x88a8;if(!_0x3b8419)return null;const _0x4dea39=_0x44f0c1['val'],_0x489f45=Date['now'](),_0x1c0d02=_0x4df0e3[_0x2a7400(0x125)][_0x5e964d],_0x59dd3c=(_0x3b8419[_0x2a7400(0x141)]||'')['toLowerCase'](),_0x5add5d=_0x59dd3c[_0x2a7400(0x14d)](_0x2a7400(0x164))||_0x59dd3c[_0x2a7400(0x14d)]('temperatur')||_0x59dd3c['includes'](_0x2a7400(0x13a))||_0x59dd3c['includes'](_0x2a7400(0x182))||_0x59dd3c[_0x2a7400(0x14d)]('thermostat');if(_0x5add5d&&typeof _0x4dea39==='number'){if(_0x4dea39>0x50||_0x4dea39<-0x32)return _0x4df0e3[_0x2a7400(0x144)]['debug']('[RECORDER]\x20Ignored\x20implausible\x20temperature:\x20'+_0x4dea39+_0x2a7400(0x121)+_0x5e964d),null;}_0x4df0e3[_0x2a7400(0x125)][_0x5e964d]=_0x4dea39;if(!_0x3b8419[_0x2a7400(0x180)]&&_0x1c0d02!=undefined&&_0x1c0d02==_0x4dea39)return null;_0x4df0e3[_0x2a7400(0x14a)]&&_0x5add5d&&recordThermodynamics(_0x4df0e3,_0x5e964d,_0x4dea39,_0x3b8419[_0x2a7400(0x143)]);const _0x5e40b7={'timestamp':_0x489f45,'id':_0x5e964d,'name':_0x3b8419[_0x2a7400(0x154)],'type':_0x3b8419[_0x2a7400(0x141)],'location':_0x3b8419[_0x2a7400(0x143)],'value':_0x4dea39};_0x4df0e3[_0x2a7400(0x156)][_0x2a7400(0x134)](_0x5e40b7);if(_0x4df0e3['eventHistory'][_0x2a7400(0x11d)]>HISTORY_MAX_SIZE)_0x4df0e3[_0x2a7400(0x156)]['pop']();await _0x4df0e3[_0x2a7400(0x17f)]('events.lastEvent',{'val':JSON[_0x2a7400(0x11a)](_0x5e40b7),'ack':!![]}),await _0x4df0e3['setStateAsync'](_0x2a7400(0x17e),{'val':JSON[_0x2a7400(0x11a)](_0x4df0e3[_0x2a7400(0x156)]),'ack':!![]});if(_0x4df0e3['isProVersion']){_0x4df0e3['rawEventLog'][_0x2a7400(0x16b)](_0x5e40b7);if(_0x4df0e3['rawEventLog']['length']>RAW_LOG_MAX_SIZE)_0x4df0e3[_0x2a7400(0x12c)][_0x2a7400(0x17b)](0x0,_0x4df0e3['rawEventLog'][_0x2a7400(0x11d)]-RAW_LOG_MAX_SIZE);await _0x4df0e3[_0x2a7400(0x17f)](_0x2a7400(0x178),{'val':JSON['stringify'](_0x4df0e3[_0x2a7400(0x12c)]),'ack':!![]}),recordSequence(_0x4df0e3,_0x5e40b7);}if(_0x3b8419[_0x2a7400(0x15d)]&&_0x4dea39===!![]){if(_0x4df0e3[_0x2a7400(0x167)]&&!_0x4df0e3[_0x2a7400(0x170)])startExitTimer(_0x4df0e3);else{if(!_0x4df0e3[_0x2a7400(0x167)])setPresence(_0x4df0e3,!![]);}}else{if(_0x3b8419[_0x2a7400(0x141)]==='motion'&&_0x4dea39===!![]){if(_0x4df0e3[_0x2a7400(0x150)])abortExitTimer(_0x4df0e3);if(!_0x4df0e3[_0x2a7400(0x167)]&&_0x4df0e3[_0x2a7400(0x166)]==='normal')setPresence(_0x4df0e3,!![]);}}if(_0x4df0e3[_0x2a7400(0x14a)]&&_0x4df0e3[_0x2a7400(0x132)]){_0x3b8419['type']===_0x2a7400(0x168)&&_0x4dea39===!![]&&_0x3b8419[_0x2a7400(0x143)]&&_0x4df0e3[_0x2a7400(0x132)](_0x2a7400(0x118),{'room':_0x3b8419['location']});const _0x30d9b8=[_0x2a7400(0x130),'tür',_0x2a7400(0x117),_0x2a7400(0x13d),_0x2a7400(0x148),_0x2a7400(0x165),'lock',_0x2a7400(0x173)][_0x2a7400(0x159)](_0x1bdc6a=>_0x59dd3c['includes'](_0x1bdc6a)),_0x5d3523=['light','licht',_0x2a7400(0x12d),_0x2a7400(0x13e),'dimmer',_0x2a7400(0x145)]['some'](_0x50f161=>_0x59dd3c['includes'](_0x50f161)),_0x1c96f5=[_0x2a7400(0x168),_0x2a7400(0x174),_0x2a7400(0x157),_0x2a7400(0x16a),'occupancy'][_0x2a7400(0x159)](_0xbadf76=>_0x59dd3c[_0x2a7400(0x14d)](_0xbadf76));if(_0x3b8419[_0x2a7400(0x143)]&&(_0x30d9b8||_0x5d3523||_0x1c96f5)){const _0x3d29e0=_0x4dea39===!![]||typeof _0x4dea39==='number'&&_0x4dea39>0x0,_0x4cf79b=_0x30d9b8&&!_0x3d29e0&&_0x1c0d02!==undefined&&_0x1c0d02!=_0x4dea39;if(_0x3d29e0||_0x4cf79b){const _0x28153e=_0x4df0e3[_0x2a7400(0x120)]||_0x489f45,_0x337327=(_0x489f45-_0x28153e)/0x3e8;_0x4df0e3['lastTrackerEventTime']=_0x489f45,_0x4df0e3[_0x2a7400(0x132)]('TRACK_EVENT',{'room':_0x3b8419['location'],'dt':_0x337327});}}}return _0x5e40b7;}module[a5_0x123c37(0x162)]={'processSensorEvent':processSensorEvent,'getOutsideTemperatureNumeric':getOutsideTemperatureNumeric,'setPresence':setPresence,'abortExitTimer':abortExitTimer,'startExitTimer':startExitTimer};