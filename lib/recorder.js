const a5_0x5c33d7=a5_0x56f0;(function(_0xa8977c,_0x56d0ad){const _0x2653aa=a5_0x56f0,_0xcb78b3=_0xa8977c();while(!![]){try{const _0x3c94d8=-parseInt(_0x2653aa(0x186))/0x1*(parseInt(_0x2653aa(0x17d))/0x2)+parseInt(_0x2653aa(0x196))/0x3*(-parseInt(_0x2653aa(0x1c4))/0x4)+-parseInt(_0x2653aa(0x1ab))/0x5*(parseInt(_0x2653aa(0x184))/0x6)+parseInt(_0x2653aa(0x19c))/0x7*(parseInt(_0x2653aa(0x1d0))/0x8)+-parseInt(_0x2653aa(0x1ac))/0x9+parseInt(_0x2653aa(0x1a7))/0xa+parseInt(_0x2653aa(0x1a2))/0xb;if(_0x3c94d8===_0x56d0ad)break;else _0xcb78b3['push'](_0xcb78b3['shift']());}catch(_0x52ee92){_0xcb78b3['push'](_0xcb78b3['shift']());}}}(a5_0x4be3,0x263b1));const a5_0x32a074=(function(){let _0x244e85=!![];return function(_0xc3dc99,_0x4c183c){const _0x57bb1a=_0x244e85?function(){if(_0x4c183c){const _0x319d2a=_0x4c183c['apply'](_0xc3dc99,arguments);return _0x4c183c=null,_0x319d2a;}}:function(){};return _0x244e85=![],_0x57bb1a;};}()),a5_0xdd241f=a5_0x32a074(this,function(){const _0xbd306c=a5_0x56f0;return a5_0xdd241f[_0xbd306c(0x17b)]()[_0xbd306c(0x17c)](_0xbd306c(0x199))['toString']()[_0xbd306c(0x193)](a5_0xdd241f)[_0xbd306c(0x17c)](_0xbd306c(0x199));});a5_0xdd241f();'use strict';const HISTORY_MAX_SIZE=0x32,RAW_LOG_MAX_SIZE=0x9c4,THERMO_LOG_SIZE=0x3e8,SEQUENCE_TIMEOUT_MS=0x5*0x3c*0x3e8,MAX_TRAINING_SET_SIZE=0x1f4,EXIT_TIMER_MINUTES=0xf,EXIT_GRACE_PERIOD_SECONDS=0x1e;function a5_0x4be3(){const _0x2796d4=['licht','events.lastEvent','klima','now','[RECORDER]\x20Error:\x20','SIMULATE_SIGNAL','unshift','LTM.rawEventLog','.forecast.current.temp','type','useWeather','exports','constructor','eventHistory','setStateAsync','3TNKaaA','stringify','kontakt','(((.+)+)+)+$','includes','log','49119zSMDun','.Current.Temperature','.forecast.current.temperature','LTM.trainingData.thermodynamics','Unknown','currentSystemMode','7510756RZNjGF','schalter','name','LTM.trainingData.sequences','error','1340900XBPmDz','rawEventLog','.NextHours.Location_1.Day_1.current.temp_value','tür','336000hEMDSv','1508058TcxcMI','isExit','window','shift','getStateAsync','events.history','val','switch','daswetter','normal','isPresent','length','toISOString','lampe','ANALYZE_SEQUENCE','splice','sendToPythonWrapper','outdoorSensorId','exitTimer','temperatur','weatherInstance','exitGraceTimer','round','temperature','848644KQlNkj','push','getHours','value','config','logDuplicates','location','isGracePeriodActive','light','motion','fenster','heizung','104TsAiFj','isProVersion','parse','toString','search','6166TQczHE','präsenz','getForeignStateAsync','door','map','sensorLastValues','system.isPresent','12mSTIId','toLowerCase','77xLofGm'];a5_0x4be3=function(){return _0x2796d4;};return a5_0x4be3();}let activeSequence=[],sequenceTimer=null;function a5_0x56f0(_0x2b1722,_0xeadc96){const _0xbcd2b1=a5_0x4be3();return a5_0x56f0=function(_0xdd241f,_0x32a074){_0xdd241f=_0xdd241f-0x17b;let _0x4be349=_0xbcd2b1[_0xdd241f];return _0x4be349;},a5_0x56f0(_0x2b1722,_0xeadc96);}async function getOutsideTemperatureNumeric(_0x35484f){const _0xd4fb7b=a5_0x56f0;if(_0x35484f[_0xd4fb7b(0x1c8)]['outdoorSensorId'])try{const _0xe0db12=await _0x35484f[_0xd4fb7b(0x17f)](_0x35484f['config'][_0xd4fb7b(0x1bd)]);if(_0xe0db12&&_0xe0db12[_0xd4fb7b(0x1b2)]!==undefined&&_0xe0db12[_0xd4fb7b(0x1b2)]!==null)return parseFloat(_0xe0db12[_0xd4fb7b(0x1b2)]);}catch(_0x1b9353){}const _0x320ebe=_0x35484f[_0xd4fb7b(0x1c8)][_0xd4fb7b(0x1c0)];if(!_0x35484f[_0xd4fb7b(0x1c8)][_0xd4fb7b(0x191)]||!_0x320ebe)return null;try{let _0x38133f='';if(_0x320ebe[_0xd4fb7b(0x19a)]('accuweather'))_0x38133f=_0x320ebe+_0xd4fb7b(0x19d);else{if(_0x320ebe[_0xd4fb7b(0x19a)](_0xd4fb7b(0x1b4)))_0x38133f=_0x320ebe+_0xd4fb7b(0x1a9);else{if(_0x320ebe[_0xd4fb7b(0x19a)]('openweathermap'))_0x38133f=_0x320ebe+_0xd4fb7b(0x19e);else{if(_0x320ebe[_0xd4fb7b(0x19a)]('weatherunderground'))_0x38133f=_0x320ebe+_0xd4fb7b(0x18f);}}}if(_0x38133f){const _0x57a543=await _0x35484f[_0xd4fb7b(0x17f)](_0x38133f);if(_0x57a543&&_0x57a543['val']!==undefined&&_0x57a543[_0xd4fb7b(0x1b2)]!==null)return parseFloat(_0x57a543['val']);}}catch(_0x264495){}return null;}async function recordThermodynamics(_0x4c8276,_0x2984f9,_0x2e7bdd,_0x36a011){const _0x1cad7f=a5_0x56f0,_0x5b38bf=await getOutsideTemperatureNumeric(_0x4c8276),_0xedb716=await _0x4c8276[_0x1cad7f(0x1b0)](_0x1cad7f(0x19f));let _0x5117d5=[];if(_0xedb716&&_0xedb716[_0x1cad7f(0x1b2)])try{_0x5117d5=JSON[_0x1cad7f(0x1d2)](_0xedb716[_0x1cad7f(0x1b2)]);}catch(_0xf7fda5){}_0x5117d5[_0x1cad7f(0x1c5)]({'ts':Date['now'](),'room':_0x36a011||_0x1cad7f(0x1a0),'t_in':_0x2e7bdd,'t_out':_0x5b38bf});if(_0x5117d5[_0x1cad7f(0x1b7)]>THERMO_LOG_SIZE)_0x5117d5[_0x1cad7f(0x1af)]();await _0x4c8276[_0x1cad7f(0x195)](_0x1cad7f(0x19f),{'val':JSON[_0x1cad7f(0x197)](_0x5117d5),'ack':!![]});}async function saveCompletedSequence(_0x585966){const _0x5327ff=a5_0x56f0;try{const _0x3bff20=await _0x585966[_0x5327ff(0x1b0)](_0x5327ff(0x1a5));let _0x1c2cf0=[];if(_0x3bff20&&_0x3bff20[_0x5327ff(0x1b2)])try{_0x1c2cf0=JSON['parse'](_0x3bff20[_0x5327ff(0x1b2)]);}catch(_0x339725){}const _0x255a3f=activeSequence[0x0]['ts'],_0x735a4f=activeSequence[_0x5327ff(0x181)](_0x3ea49f=>({'loc':_0x3ea49f['loc'],'t_delta':Math[_0x5327ff(0x1c2)]((_0x3ea49f['ts']-_0x255a3f)/0x3e8)})),_0x174825={'timestamp':new Date(_0x255a3f)[_0x5327ff(0x1b8)](),'steps':_0x735a4f,'duration':Math['round']((activeSequence[activeSequence[_0x5327ff(0x1b7)]-0x1]['ts']-_0x255a3f)/0x3e8),'daytime':new Date(_0x255a3f)[_0x5327ff(0x1c6)]()};_0x1c2cf0[_0x5327ff(0x1c5)](_0x174825);if(_0x1c2cf0['length']>MAX_TRAINING_SET_SIZE)_0x1c2cf0[_0x5327ff(0x1af)]();await _0x585966['setStateAsync'](_0x5327ff(0x1a5),{'val':JSON[_0x5327ff(0x197)](_0x1c2cf0),'ack':!![]}),_0x585966[_0x5327ff(0x1d1)]&&_0x585966[_0x5327ff(0x1bc)]&&_0x585966[_0x5327ff(0x1bc)](_0x5327ff(0x1ba),{'sequence':_0x174825});}catch(_0x3b2f21){_0x585966[_0x5327ff(0x19b)][_0x5327ff(0x1a6)](_0x5327ff(0x18b)+_0x3b2f21['message']);}}async function recordSequence(_0x13c601,_0x5766ea){const _0x137897=a5_0x56f0,_0x17d835=(_0x5766ea[_0x137897(0x190)]||'')[_0x137897(0x185)](),_0xcd5b04=['motion','bewegung',_0x137897(0x17e),'presence','occupancy',_0x137897(0x180),_0x137897(0x1aa),_0x137897(0x1ae),_0x137897(0x1ce),'contact',_0x137897(0x198),_0x137897(0x1cc),_0x137897(0x187),_0x137897(0x1b3),_0x137897(0x1a3),'dimmer',_0x137897(0x1b9)];if(!_0xcd5b04['some'](_0x3a9b87=>_0x17d835['includes'](_0x3a9b87)))return;if(!_0x5766ea[_0x137897(0x1c7)])return;if(sequenceTimer)clearTimeout(sequenceTimer);activeSequence[_0x137897(0x1c5)]({'loc':_0x5766ea[_0x137897(0x1ca)]||_0x137897(0x1a0),'id':_0x5766ea['id'],'ts':Date[_0x137897(0x18a)]()}),sequenceTimer=setTimeout(async()=>{if(activeSequence['length']>0x1)await saveCompletedSequence(_0x13c601);activeSequence=[];},SEQUENCE_TIMEOUT_MS);}function startExitTimer(_0xff4c63){const _0xfc77f5=a5_0x56f0;abortExitTimer(_0xff4c63),_0xff4c63[_0xfc77f5(0x1cb)]=!![],_0xff4c63[_0xfc77f5(0x1c1)]=setTimeout(()=>{const _0x5c987e=_0xfc77f5;_0xff4c63[_0x5c987e(0x1cb)]=![];},EXIT_GRACE_PERIOD_SECONDS*0x3e8),_0xff4c63['exitTimer']=setTimeout(()=>{setPresence(_0xff4c63,![]),_0xff4c63['exitTimer']=null;},EXIT_TIMER_MINUTES*0x3c*0x3e8);}function abortExitTimer(_0x3621a6){const _0x3356cb=a5_0x56f0;if(_0x3621a6[_0x3356cb(0x1be)])clearTimeout(_0x3621a6[_0x3356cb(0x1be)]);if(_0x3621a6[_0x3356cb(0x1c1)])clearTimeout(_0x3621a6[_0x3356cb(0x1c1)]);_0x3621a6[_0x3356cb(0x1be)]=null,_0x3621a6[_0x3356cb(0x1c1)]=null,_0x3621a6[_0x3356cb(0x1cb)]=![];}async function setPresence(_0x304752,_0x5db9a4){const _0x515245=a5_0x56f0;if(_0x304752[_0x515245(0x1b6)]===_0x5db9a4)return;_0x304752[_0x515245(0x1b6)]=_0x5db9a4,await _0x304752['setStateAsync'](_0x515245(0x183),{'val':_0x5db9a4,'ack':!![]});}async function processSensorEvent(_0x54e24c,_0x2d00b0,_0x549467,_0x512cd8){const _0x435454=a5_0x56f0;if(!_0x512cd8)return null;const _0x73c737=_0x549467['val'],_0x272306=Date['now'](),_0x518bd8=_0x54e24c[_0x435454(0x182)][_0x2d00b0];_0x54e24c[_0x435454(0x182)][_0x2d00b0]=_0x73c737;if(!_0x512cd8[_0x435454(0x1c9)]&&_0x518bd8!=undefined&&_0x518bd8==_0x73c737)return null;const _0x2a87f4=(_0x512cd8[_0x435454(0x190)]||'')[_0x435454(0x185)](),_0xa5cb01=_0x2a87f4[_0x435454(0x19a)](_0x435454(0x1c3))||_0x2a87f4[_0x435454(0x19a)](_0x435454(0x1bf))||_0x2a87f4[_0x435454(0x19a)](_0x435454(0x189))||_0x2a87f4[_0x435454(0x19a)](_0x435454(0x1cf));_0x54e24c[_0x435454(0x1d1)]&&_0xa5cb01&&recordThermodynamics(_0x54e24c,_0x2d00b0,_0x73c737,_0x512cd8[_0x435454(0x1ca)]);const _0x756760={'timestamp':_0x272306,'id':_0x2d00b0,'name':_0x512cd8[_0x435454(0x1a4)],'type':_0x512cd8['type'],'location':_0x512cd8[_0x435454(0x1ca)],'value':_0x73c737};_0x54e24c[_0x435454(0x194)][_0x435454(0x18d)](_0x756760);if(_0x54e24c['eventHistory'][_0x435454(0x1b7)]>HISTORY_MAX_SIZE)_0x54e24c[_0x435454(0x194)]['pop']();await _0x54e24c[_0x435454(0x195)](_0x435454(0x188),{'val':JSON[_0x435454(0x197)](_0x756760),'ack':!![]}),await _0x54e24c[_0x435454(0x195)](_0x435454(0x1b1),{'val':JSON[_0x435454(0x197)](_0x54e24c['eventHistory']),'ack':!![]});if(_0x54e24c[_0x435454(0x1d1)]){_0x54e24c['rawEventLog'][_0x435454(0x1c5)](_0x756760);if(_0x54e24c['rawEventLog'][_0x435454(0x1b7)]>RAW_LOG_MAX_SIZE)_0x54e24c['rawEventLog'][_0x435454(0x1bb)](0x0,_0x54e24c[_0x435454(0x1a8)][_0x435454(0x1b7)]-RAW_LOG_MAX_SIZE);await _0x54e24c[_0x435454(0x195)](_0x435454(0x18e),{'val':JSON['stringify'](_0x54e24c['rawEventLog']),'ack':!![]}),recordSequence(_0x54e24c,_0x756760);}if(_0x512cd8[_0x435454(0x1ad)]&&_0x73c737===!![]){if(_0x54e24c['isPresent']&&!_0x54e24c[_0x435454(0x1cb)])startExitTimer(_0x54e24c);else{if(!_0x54e24c[_0x435454(0x1b6)])setPresence(_0x54e24c,!![]);}}else{if(_0x512cd8[_0x435454(0x190)]===_0x435454(0x1cd)&&_0x73c737===!![]){if(_0x54e24c[_0x435454(0x1be)])abortExitTimer(_0x54e24c);if(!_0x54e24c[_0x435454(0x1b6)]&&_0x54e24c[_0x435454(0x1a1)]===_0x435454(0x1b5))setPresence(_0x54e24c,!![]);}}return _0x54e24c['isProVersion']&&_0x512cd8['type']===_0x435454(0x1cd)&&_0x73c737===!![]&&_0x512cd8[_0x435454(0x1ca)]&&_0x54e24c[_0x435454(0x1bc)]&&_0x54e24c[_0x435454(0x1bc)](_0x435454(0x18c),{'room':_0x512cd8[_0x435454(0x1ca)]}),_0x756760;}module[a5_0x5c33d7(0x192)]={'processSensorEvent':processSensorEvent,'getOutsideTemperatureNumeric':getOutsideTemperatureNumeric,'setPresence':setPresence,'abortExitTimer':abortExitTimer,'startExitTimer':startExitTimer};