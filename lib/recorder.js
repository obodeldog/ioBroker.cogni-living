const a5_0x2714d5=a5_0xa684;(function(_0x5c102b,_0xbc163e){const _0x2712b8=a5_0xa684,_0x1aa425=_0x5c102b();while(!![]){try{const _0x55af9e=parseInt(_0x2712b8(0x242))/0x1*(parseInt(_0x2712b8(0x1fa))/0x2)+parseInt(_0x2712b8(0x1db))/0x3*(-parseInt(_0x2712b8(0x1e4))/0x4)+parseInt(_0x2712b8(0x230))/0x5+parseInt(_0x2712b8(0x207))/0x6*(parseInt(_0x2712b8(0x216))/0x7)+-parseInt(_0x2712b8(0x228))/0x8+parseInt(_0x2712b8(0x1f0))/0x9*(-parseInt(_0x2712b8(0x20a))/0xa)+-parseInt(_0x2712b8(0x1eb))/0xb*(parseInt(_0x2712b8(0x1ea))/0xc);if(_0x55af9e===_0xbc163e)break;else _0x1aa425['push'](_0x1aa425['shift']());}catch(_0x3bcb21){_0x1aa425['push'](_0x1aa425['shift']());}}}(a5_0x328d,0x25fb7));const a5_0x1e65e5=(function(){let _0x5bacc5=!![];return function(_0x258f1a,_0x445ecd){const _0x2cb7e0=_0x5bacc5?function(){const _0xf68a34=a5_0xa684;if(_0x445ecd){const _0x411990=_0x445ecd[_0xf68a34(0x21f)](_0x258f1a,arguments);return _0x445ecd=null,_0x411990;}}:function(){};return _0x5bacc5=![],_0x2cb7e0;};}()),a5_0x415222=a5_0x1e65e5(this,function(){const _0x375377=a5_0xa684;return a5_0x415222[_0x375377(0x1f9)]()[_0x375377(0x22e)](_0x375377(0x236))[_0x375377(0x1f9)]()[_0x375377(0x231)](a5_0x415222)[_0x375377(0x22e)](_0x375377(0x236));});a5_0x415222();function a5_0xa684(_0x22b2a5,_0x29e6b1){const _0x7a30af=a5_0x328d();return a5_0xa684=function(_0x415222,_0x1e65e5){_0x415222=_0x415222-0x1db;let _0x328d69=_0x7a30af[_0x415222];return _0x328d69;},a5_0xa684(_0x22b2a5,_0x29e6b1);}'use strict';const HISTORY_MAX_SIZE=0x32,RAW_LOG_MAX_SIZE=0x9c4,THERMO_LOG_SIZE=0x3e8,SEQUENCE_TIMEOUT_MS=0x5*0x3c*0x3e8,MAX_TRAINING_SET_SIZE=0x1f4,EXIT_TIMER_MINUTES=0xf,EXIT_GRACE_PERIOD_SECONDS=0x1e;let activeSequence=[],sequenceTimer=null;async function getOutsideTemperatureNumeric(_0x53688b){const _0x35f559=a5_0xa684;if(_0x53688b[_0x35f559(0x1de)][_0x35f559(0x1e7)])try{const _0x11b5d2=await _0x53688b[_0x35f559(0x20e)](_0x53688b['config']['outdoorSensorId']);if(_0x11b5d2&&_0x11b5d2[_0x35f559(0x203)]!==undefined&&_0x11b5d2[_0x35f559(0x203)]!==null)return parseFloat(_0x11b5d2[_0x35f559(0x203)]);}catch(_0xd4e6b9){}const _0x29f5f7=_0x53688b['config'][_0x35f559(0x1dc)];if(!_0x53688b[_0x35f559(0x1de)]['useWeather']||!_0x29f5f7)return null;try{let _0x1aac40='';if(_0x29f5f7[_0x35f559(0x215)](_0x35f559(0x1fc)))_0x1aac40=_0x29f5f7+'.Current.Temperature';else{if(_0x29f5f7[_0x35f559(0x215)](_0x35f559(0x1f1)))_0x1aac40=_0x29f5f7+_0x35f559(0x225);else{if(_0x29f5f7['includes']('openweathermap'))_0x1aac40=_0x29f5f7+_0x35f559(0x22d);else{if(_0x29f5f7[_0x35f559(0x215)]('weatherunderground'))_0x1aac40=_0x29f5f7+_0x35f559(0x1ee);}}}if(_0x1aac40){const _0x3f261b=await _0x53688b['getForeignStateAsync'](_0x1aac40);if(_0x3f261b&&_0x3f261b[_0x35f559(0x203)]!==undefined&&_0x3f261b[_0x35f559(0x203)]!==null)return parseFloat(_0x3f261b['val']);}}catch(_0x46d6a5){}return null;}async function recordThermodynamics(_0x98f282,_0x109088,_0x33ade6,_0x5697a3){const _0x56be96=a5_0xa684,_0x3227cd=await getOutsideTemperatureNumeric(_0x98f282);if(_0x3227cd===null)return;let _0x77c73c=0x0,_0x47cf77=![];if(_0x98f282[_0x56be96(0x1de)][_0x56be96(0x238)])try{let _0x175906=_0x98f282[_0x56be96(0x1de)][_0x56be96(0x238)];if(typeof _0x175906===_0x56be96(0x1e2))_0x175906=JSON[_0x56be96(0x1fb)](_0x175906);if(_0x175906[_0x109088]){const _0x37334f=_0x175906[_0x109088],_0x5d1726=await _0x98f282[_0x56be96(0x20e)](_0x37334f);if(_0x5d1726&&_0x5d1726[_0x56be96(0x203)]!==null&&_0x5d1726[_0x56be96(0x203)]!==undefined){let _0x1d57b7=Number(_0x5d1726['val']);if(_0x1d57b7<=1.05&&!_0x37334f[_0x56be96(0x215)](_0x56be96(0x237))&&!_0x37334f['includes'](_0x56be96(0x23b)))_0x1d57b7=_0x1d57b7*0x64;_0x77c73c=Math[_0x56be96(0x23f)](_0x1d57b7),_0x47cf77=!![];}}}catch(_0x584423){}if(!_0x47cf77){const _0x3cd1a5=[{'from':_0x56be96(0x1f5),'to':_0x56be96(0x1f2)},{'from':_0x56be96(0x1f5),'to':_0x56be96(0x223)},{'from':_0x56be96(0x226),'to':_0x56be96(0x233)},{'from':_0x56be96(0x235),'to':_0x56be96(0x1fd)},{'from':_0x56be96(0x1f3),'to':_0x56be96(0x234)},{'from':_0x56be96(0x217),'to':_0x56be96(0x1e9)}];for(const _0x4f2178 of _0x3cd1a5){if(_0x109088[_0x56be96(0x215)](_0x4f2178[_0x56be96(0x205)])){const _0x253045=_0x109088[_0x56be96(0x22a)](_0x4f2178['from'],_0x4f2178['to']);try{const _0x20f593=await _0x98f282['getForeignStateAsync'](_0x253045);if(_0x20f593&&_0x20f593[_0x56be96(0x203)]!==null&&_0x20f593[_0x56be96(0x203)]!==undefined){let _0x2aacf1=Number(_0x20f593[_0x56be96(0x203)]);if(typeof _0x2aacf1===_0x56be96(0x1ff)){if(_0x2aacf1<=1.05&&_0x4f2178['to'][_0x56be96(0x215)]('LEVEL'))_0x2aacf1=_0x2aacf1*0x64;_0x77c73c=Math[_0x56be96(0x23f)](_0x2aacf1),_0x47cf77=!![];break;}}}catch(_0x2c5b1a){}}}}const _0x422ee1=await _0x98f282[_0x56be96(0x227)]('LTM.trainingData.thermodynamics');let _0x35ddd5=[];if(_0x422ee1&&_0x422ee1[_0x56be96(0x203)])try{_0x35ddd5=JSON[_0x56be96(0x1fb)](_0x422ee1[_0x56be96(0x203)]);}catch(_0xbc8883){}_0x35ddd5[_0x56be96(0x1ec)]({'ts':Date[_0x56be96(0x212)](),'room':_0x5697a3||'Unknown','t_in':_0x33ade6,'t_out':_0x3227cd,'valve':_0x77c73c});if(_0x35ddd5[_0x56be96(0x241)]>THERMO_LOG_SIZE)_0x35ddd5[_0x56be96(0x23e)]();await _0x98f282[_0x56be96(0x1f8)](_0x56be96(0x1dd),{'val':JSON[_0x56be96(0x1df)](_0x35ddd5),'ack':!![]});}async function saveCompletedSequence(_0x15b74c){const _0x3118c5=a5_0xa684;try{const _0x54de7f=await _0x15b74c[_0x3118c5(0x227)](_0x3118c5(0x23a));let _0x3cdb0d=[];if(_0x54de7f&&_0x54de7f[_0x3118c5(0x203)])try{_0x3cdb0d=JSON[_0x3118c5(0x1fb)](_0x54de7f[_0x3118c5(0x203)]);}catch(_0xdcf838){}const _0x49753b=activeSequence[0x0]['ts'],_0x4b91b3=activeSequence['map'](_0x578d18=>({'loc':_0x578d18[_0x3118c5(0x211)],'t_delta':Math[_0x3118c5(0x23f)]((_0x578d18['ts']-_0x49753b)/0x3e8)})),_0x31e698={'timestamp':new Date(_0x49753b)[_0x3118c5(0x1e1)](),'steps':_0x4b91b3,'duration':Math[_0x3118c5(0x23f)]((activeSequence[activeSequence[_0x3118c5(0x241)]-0x1]['ts']-_0x49753b)/0x3e8),'daytime':new Date(_0x49753b)[_0x3118c5(0x1e3)]()};_0x3cdb0d[_0x3118c5(0x1ec)](_0x31e698);if(_0x3cdb0d['length']>MAX_TRAINING_SET_SIZE)_0x3cdb0d[_0x3118c5(0x23e)]();await _0x15b74c[_0x3118c5(0x1f8)](_0x3118c5(0x23a),{'val':JSON[_0x3118c5(0x1df)](_0x3cdb0d),'ack':!![]}),_0x15b74c[_0x3118c5(0x220)]&&_0x15b74c[_0x3118c5(0x218)]&&_0x15b74c[_0x3118c5(0x218)](_0x3118c5(0x20d),{'sequence':_0x31e698});}catch(_0xa4d174){_0x15b74c[_0x3118c5(0x21e)][_0x3118c5(0x1ef)](_0x3118c5(0x201)+_0xa4d174['message']);}}async function recordSequence(_0x2e99b3,_0x51deed){const _0x33ff91=a5_0xa684,_0x4c6945=(_0x51deed['type']||'')['toLowerCase'](),_0x6afaef=['motion','bewegung','präsenz','presence','occupancy',_0x33ff91(0x232),_0x33ff91(0x1e6),_0x33ff91(0x1f4),_0x33ff91(0x213),'contact',_0x33ff91(0x23d),_0x33ff91(0x21c),_0x33ff91(0x200),_0x33ff91(0x229),_0x33ff91(0x206),_0x33ff91(0x20b),_0x33ff91(0x214)];if(!_0x6afaef['some'](_0x49f2e8=>_0x4c6945[_0x33ff91(0x215)](_0x49f2e8)))return;if(!_0x51deed[_0x33ff91(0x224)])return;if(sequenceTimer)clearTimeout(sequenceTimer);activeSequence[_0x33ff91(0x1ec)]({'loc':_0x51deed[_0x33ff91(0x210)]||_0x33ff91(0x20f),'id':_0x51deed['id'],'ts':Date[_0x33ff91(0x212)]()}),sequenceTimer=setTimeout(async()=>{if(activeSequence['length']>0x1)await saveCompletedSequence(_0x2e99b3);activeSequence=[];},SEQUENCE_TIMEOUT_MS);}function startExitTimer(_0x4fca83){const _0x514c05=a5_0xa684;abortExitTimer(_0x4fca83),_0x4fca83[_0x514c05(0x1e5)]=!![],_0x4fca83[_0x514c05(0x209)]=setTimeout(()=>{const _0x3d29fc=_0x514c05;_0x4fca83[_0x3d29fc(0x1e5)]=![];},EXIT_GRACE_PERIOD_SECONDS*0x3e8),_0x4fca83[_0x514c05(0x1fe)]=setTimeout(()=>{const _0xcdc51=_0x514c05;setPresence(_0x4fca83,![]),_0x4fca83[_0xcdc51(0x1fe)]=null;},EXIT_TIMER_MINUTES*0x3c*0x3e8);}function abortExitTimer(_0x1346ac){const _0x2c41a0=a5_0xa684;if(_0x1346ac[_0x2c41a0(0x1fe)])clearTimeout(_0x1346ac[_0x2c41a0(0x1fe)]);if(_0x1346ac['exitGraceTimer'])clearTimeout(_0x1346ac[_0x2c41a0(0x209)]);_0x1346ac['exitTimer']=null,_0x1346ac['exitGraceTimer']=null,_0x1346ac[_0x2c41a0(0x1e5)]=![];}async function setPresence(_0xe7f39c,_0x68bc08){const _0x353853=a5_0xa684;if(_0xe7f39c[_0x353853(0x208)]===_0x68bc08)return;_0xe7f39c[_0x353853(0x208)]=_0x68bc08,await _0xe7f39c[_0x353853(0x1f8)]('system.isPresent',{'val':_0x68bc08,'ack':!![]});}async function processSensorEvent(_0x64bbc0,_0x49b1c8,_0x22ef64,_0x1aef98){const _0x470b32=a5_0xa684;if(!_0x1aef98)return null;const _0x211e1a=_0x22ef64[_0x470b32(0x203)],_0x4e2cef=Date[_0x470b32(0x212)](),_0x20c825=_0x64bbc0[_0x470b32(0x1ed)][_0x49b1c8];_0x64bbc0[_0x470b32(0x1ed)][_0x49b1c8]=_0x211e1a;if(!_0x1aef98['logDuplicates']&&_0x20c825!=undefined&&_0x20c825==_0x211e1a)return null;const _0x2dfe95=(_0x1aef98[_0x470b32(0x23c)]||'')[_0x470b32(0x1f7)](),_0x24295d=_0x2dfe95[_0x470b32(0x215)](_0x470b32(0x1f3))||_0x2dfe95['includes'](_0x470b32(0x1f6))||_0x2dfe95[_0x470b32(0x215)](_0x470b32(0x219))||_0x2dfe95[_0x470b32(0x215)](_0x470b32(0x239))||_0x2dfe95[_0x470b32(0x215)]('thermostat');_0x64bbc0[_0x470b32(0x220)]&&_0x24295d&&recordThermodynamics(_0x64bbc0,_0x49b1c8,_0x211e1a,_0x1aef98[_0x470b32(0x210)]);const _0x6e5f00={'timestamp':_0x4e2cef,'id':_0x49b1c8,'name':_0x1aef98[_0x470b32(0x22b)],'type':_0x1aef98[_0x470b32(0x23c)],'location':_0x1aef98[_0x470b32(0x210)],'value':_0x211e1a};_0x64bbc0[_0x470b32(0x22c)][_0x470b32(0x21a)](_0x6e5f00);if(_0x64bbc0[_0x470b32(0x22c)][_0x470b32(0x241)]>HISTORY_MAX_SIZE)_0x64bbc0[_0x470b32(0x22c)][_0x470b32(0x222)]();await _0x64bbc0[_0x470b32(0x1f8)](_0x470b32(0x221),{'val':JSON[_0x470b32(0x1df)](_0x6e5f00),'ack':!![]}),await _0x64bbc0[_0x470b32(0x1f8)](_0x470b32(0x204),{'val':JSON[_0x470b32(0x1df)](_0x64bbc0[_0x470b32(0x22c)]),'ack':!![]});if(_0x64bbc0[_0x470b32(0x220)]){_0x64bbc0[_0x470b32(0x1e0)][_0x470b32(0x1ec)](_0x6e5f00);if(_0x64bbc0['rawEventLog']['length']>RAW_LOG_MAX_SIZE)_0x64bbc0[_0x470b32(0x1e0)][_0x470b32(0x1e8)](0x0,_0x64bbc0[_0x470b32(0x1e0)][_0x470b32(0x241)]-RAW_LOG_MAX_SIZE);await _0x64bbc0[_0x470b32(0x1f8)](_0x470b32(0x21b),{'val':JSON[_0x470b32(0x1df)](_0x64bbc0[_0x470b32(0x1e0)]),'ack':!![]}),recordSequence(_0x64bbc0,_0x6e5f00);}if(_0x1aef98['isExit']&&_0x211e1a===!![]){if(_0x64bbc0[_0x470b32(0x208)]&&!_0x64bbc0[_0x470b32(0x1e5)])startExitTimer(_0x64bbc0);else{if(!_0x64bbc0[_0x470b32(0x208)])setPresence(_0x64bbc0,!![]);}}else{if(_0x1aef98[_0x470b32(0x23c)]===_0x470b32(0x202)&&_0x211e1a===!![]){if(_0x64bbc0[_0x470b32(0x1fe)])abortExitTimer(_0x64bbc0);if(!_0x64bbc0[_0x470b32(0x208)]&&_0x64bbc0[_0x470b32(0x22f)]===_0x470b32(0x240))setPresence(_0x64bbc0,!![]);}}return _0x64bbc0[_0x470b32(0x220)]&&_0x1aef98[_0x470b32(0x23c)]===_0x470b32(0x202)&&_0x211e1a===!![]&&_0x1aef98['location']&&_0x64bbc0['sendToPythonWrapper']&&_0x64bbc0[_0x470b32(0x218)](_0x470b32(0x21d),{'room':_0x1aef98[_0x470b32(0x210)]}),_0x6e5f00;}module[a5_0x2714d5(0x20c)]={'processSensorEvent':processSensorEvent,'getOutsideTemperatureNumeric':getOutsideTemperatureNumeric,'setPresence':setPresence,'abortExitTimer':abortExitTimer,'startExitTimer':startExitTimer};function a5_0x328d(){const _0x2e921c=['isProVersion','events.lastEvent','pop','.1.VALVE_STATE','value','.NextHours.Location_1.Day_1.current.temp_value','.1.TEMPERATURE','getStateAsync','62792uzEUIO','switch','replace','name','eventHistory','.forecast.current.temperature','search','currentSystemMode','1063555oHsEew','constructor','door','.4.VALVE_STATE','level','.ACTUAL_TEMPERATURE','(((.+)+)+)+$','STATUS','valveMapping','heizung','LTM.trainingData.sequences','STATE','type','kontakt','shift','round','normal','length','35141qemvkC','68400qhkMaF','weatherInstance','LTM.trainingData.thermodynamics','config','stringify','rawEventLog','toISOString','string','getHours','8vWLwOG','isGracePeriodActive','tür','outdoorSensorId','splice','Valve','1062492jycwkp','22kIcAEQ','push','sensorLastValues','.forecast.current.temp','error','9315tZiryC','daswetter','.1.LEVEL','temperature','window','.1.ACTUAL_TEMPERATURE','temperatur','toLowerCase','setStateAsync','toString','10UgUrPo','parse','accuweather','.LEVEL','exitTimer','number','licht','[RECORDER]\x20Error:\x20','motion','val','events.history','from','schalter','180omkQxs','isPresent','exitGraceTimer','260RXsFzy','dimmer','exports','ANALYZE_SEQUENCE','getForeignStateAsync','Unknown','location','loc','now','fenster','lampe','includes','5740JBfgYl','Temperature','sendToPythonWrapper','klima','unshift','LTM.rawEventLog','light','SIMULATE_SIGNAL','log','apply'];a5_0x328d=function(){return _0x2e921c;};return a5_0x328d();}