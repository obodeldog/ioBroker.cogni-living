const a5_0x4ca930=a5_0x3f9f;(function(_0x18b33e,_0xc8a06f){const _0x2dd213=a5_0x3f9f,_0xb83d87=_0x18b33e();while(!![]){try{const _0xfd66e9=-parseInt(_0x2dd213(0x1ec))/0x1*(parseInt(_0x2dd213(0x1c4))/0x2)+-parseInt(_0x2dd213(0x1ac))/0x3*(-parseInt(_0x2dd213(0x19c))/0x4)+-parseInt(_0x2dd213(0x1ae))/0x5*(-parseInt(_0x2dd213(0x1a6))/0x6)+parseInt(_0x2dd213(0x1c0))/0x7+parseInt(_0x2dd213(0x1a0))/0x8+parseInt(_0x2dd213(0x1a4))/0x9+-parseInt(_0x2dd213(0x1ad))/0xa*(parseInt(_0x2dd213(0x1c3))/0xb);if(_0xfd66e9===_0xc8a06f)break;else _0xb83d87['push'](_0xb83d87['shift']());}catch(_0x277cbc){_0xb83d87['push'](_0xb83d87['shift']());}}}(a5_0x4aaa,0x39df9));function a5_0x3f9f(_0xbf3724,_0x4b5baf){const _0x135e89=a5_0x4aaa();return a5_0x3f9f=function(_0x16e65d,_0x2a34cf){_0x16e65d=_0x16e65d-0x19c;let _0x4aaa86=_0x135e89[_0x16e65d];return _0x4aaa86;},a5_0x3f9f(_0xbf3724,_0x4b5baf);}const a5_0x2a34cf=(function(){let _0x1bc8af=!![];return function(_0x4287f0,_0x4a1958){const _0x5244ad=_0x1bc8af?function(){const _0x56c5b2=a5_0x3f9f;if(_0x4a1958){const _0x1769a1=_0x4a1958[_0x56c5b2(0x1b2)](_0x4287f0,arguments);return _0x4a1958=null,_0x1769a1;}}:function(){};return _0x1bc8af=![],_0x5244ad;};}()),a5_0x16e65d=a5_0x2a34cf(this,function(){const _0x25100b=a5_0x3f9f;return a5_0x16e65d[_0x25100b(0x1ef)]()[_0x25100b(0x1e4)](_0x25100b(0x19e))[_0x25100b(0x1ef)]()[_0x25100b(0x1ab)](a5_0x16e65d)[_0x25100b(0x1e4)](_0x25100b(0x19e));});a5_0x16e65d();'use strict';const HISTORY_MAX_SIZE=0x32,RAW_LOG_MAX_SIZE=0x9c4,THERMO_LOG_SIZE=0x3e8,SEQUENCE_TIMEOUT_MS=0x5*0x3c*0x3e8,MAX_TRAINING_SET_SIZE=0x1f4,EXIT_TIMER_MINUTES=0xf,EXIT_GRACE_PERIOD_SECONDS=0x1e;function a5_0x4aaa(){const _0x4e5bc7=['SIMULATE_SIGNAL','parse','pop','apply','normal','openweathermap','val','config','light','window','präsenz','LTM.trainingData.thermodynamics','shift','isPresent','heizung','exitTimer','isExit','3071047oZFolV','motion','events.history','1937463DzkpyM','160znGaqS','klima','sensorLastValues','exports','round','stringify','.forecast.current.temp','now','getStateAsync','LTM.trainingData.sequences','sendToPythonWrapper','.NextHours.Location_1.Day_1.current.temp_value','location','push','useWeather','ANALYZE_SEQUENCE','name','message','bewegung','Unknown','accuweather','splice','eventHistory','kontakt','setStateAsync','temperature','rawEventLog','error','outdoorSensorId','occupancy','exitGraceTimer','includes','search','getForeignStateAsync','logDuplicates','.Current.Temperature','schalter','dimmer','toLowerCase','daswetter','902sWgEVY','fenster','type','toString','1245232JmNEqG','currentSystemMode','(((.+)+)+)+$','switch','17464ORhFkH','temperatur','isProVersion','unshift','3409200NYhuHd','.forecast.current.temperature','12puwTxq','[RECORDER]\x20Error:\x20','isGracePeriodActive','toISOString','length','constructor','3yREqWF','50BockjV','147155ZXmaRX'];a5_0x4aaa=function(){return _0x4e5bc7;};return a5_0x4aaa();}let activeSequence=[],sequenceTimer=null;async function getOutsideTemperatureNumeric(_0x5eb238){const _0x3aef1b=a5_0x3f9f;if(_0x5eb238['config'][_0x3aef1b(0x1e0)])try{const _0x1f936f=await _0x5eb238[_0x3aef1b(0x1e5)](_0x5eb238[_0x3aef1b(0x1b6)][_0x3aef1b(0x1e0)]);if(_0x1f936f&&_0x1f936f['val']!==undefined&&_0x1f936f[_0x3aef1b(0x1b5)]!==null)return parseFloat(_0x1f936f[_0x3aef1b(0x1b5)]);}catch(_0x5c6578){}const _0x2f2831=_0x5eb238[_0x3aef1b(0x1b6)]['weatherInstance'];if(!_0x5eb238[_0x3aef1b(0x1b6)][_0x3aef1b(0x1d2)]||!_0x2f2831)return null;try{let _0x5aa3a6='';if(_0x2f2831[_0x3aef1b(0x1e3)](_0x3aef1b(0x1d8)))_0x5aa3a6=_0x2f2831+_0x3aef1b(0x1e7);else{if(_0x2f2831['includes'](_0x3aef1b(0x1eb)))_0x5aa3a6=_0x2f2831+_0x3aef1b(0x1cf);else{if(_0x2f2831[_0x3aef1b(0x1e3)](_0x3aef1b(0x1b4)))_0x5aa3a6=_0x2f2831+_0x3aef1b(0x1a5);else{if(_0x2f2831[_0x3aef1b(0x1e3)]('weatherunderground'))_0x5aa3a6=_0x2f2831+_0x3aef1b(0x1ca);}}}if(_0x5aa3a6){const _0x256129=await _0x5eb238['getForeignStateAsync'](_0x5aa3a6);if(_0x256129&&_0x256129[_0x3aef1b(0x1b5)]!==undefined&&_0x256129[_0x3aef1b(0x1b5)]!==null)return parseFloat(_0x256129[_0x3aef1b(0x1b5)]);}}catch(_0x45f6f8){}return null;}async function recordThermodynamics(_0x41afe9,_0x148bef,_0x37f880,_0x13cf20){const _0x347611=a5_0x3f9f,_0x3040eb=await getOutsideTemperatureNumeric(_0x41afe9),_0x565a45=await _0x41afe9['getStateAsync']('LTM.trainingData.thermodynamics');let _0x5722a9=[];if(_0x565a45&&_0x565a45[_0x347611(0x1b5)])try{_0x5722a9=JSON[_0x347611(0x1b0)](_0x565a45[_0x347611(0x1b5)]);}catch(_0x1ca401){}_0x5722a9[_0x347611(0x1d1)]({'ts':Date[_0x347611(0x1cb)](),'room':_0x13cf20||_0x347611(0x1d7),'t_in':_0x37f880,'t_out':_0x3040eb});if(_0x5722a9[_0x347611(0x1aa)]>THERMO_LOG_SIZE)_0x5722a9[_0x347611(0x1bb)]();await _0x41afe9['setStateAsync'](_0x347611(0x1ba),{'val':JSON[_0x347611(0x1c9)](_0x5722a9),'ack':!![]});}async function saveCompletedSequence(_0x41963e){const _0x3234ad=a5_0x3f9f;try{const _0x4866fb=await _0x41963e[_0x3234ad(0x1cc)](_0x3234ad(0x1cd));let _0x211546=[];if(_0x4866fb&&_0x4866fb[_0x3234ad(0x1b5)])try{_0x211546=JSON[_0x3234ad(0x1b0)](_0x4866fb[_0x3234ad(0x1b5)]);}catch(_0x478ef4){}const _0x11622b=activeSequence[0x0]['ts'],_0x288167=activeSequence['map'](_0x56a97e=>({'loc':_0x56a97e['loc'],'t_delta':Math[_0x3234ad(0x1c8)]((_0x56a97e['ts']-_0x11622b)/0x3e8)})),_0x45ca7c={'timestamp':new Date(_0x11622b)[_0x3234ad(0x1a9)](),'steps':_0x288167,'duration':Math[_0x3234ad(0x1c8)]((activeSequence[activeSequence[_0x3234ad(0x1aa)]-0x1]['ts']-_0x11622b)/0x3e8),'daytime':new Date(_0x11622b)['getHours']()};_0x211546[_0x3234ad(0x1d1)](_0x45ca7c);if(_0x211546[_0x3234ad(0x1aa)]>MAX_TRAINING_SET_SIZE)_0x211546[_0x3234ad(0x1bb)]();await _0x41963e[_0x3234ad(0x1dc)](_0x3234ad(0x1cd),{'val':JSON[_0x3234ad(0x1c9)](_0x211546),'ack':!![]}),_0x41963e[_0x3234ad(0x1a2)]&&_0x41963e[_0x3234ad(0x1ce)]&&_0x41963e['sendToPythonWrapper'](_0x3234ad(0x1d3),{'sequence':_0x45ca7c});}catch(_0x4d770f){_0x41963e['log'][_0x3234ad(0x1df)](_0x3234ad(0x1a7)+_0x4d770f[_0x3234ad(0x1d5)]);}}async function recordSequence(_0x2f0d3a,_0x4aed1b){const _0x8c1ba3=a5_0x3f9f,_0x2cd85a=(_0x4aed1b[_0x8c1ba3(0x1ee)]||'')[_0x8c1ba3(0x1ea)](),_0x2b2a55=['motion',_0x8c1ba3(0x1d6),_0x8c1ba3(0x1b9),'presence',_0x8c1ba3(0x1e1),'door','tür',_0x8c1ba3(0x1b8),_0x8c1ba3(0x1ed),'contact',_0x8c1ba3(0x1db),_0x8c1ba3(0x1b7),'licht',_0x8c1ba3(0x19f),_0x8c1ba3(0x1e8),_0x8c1ba3(0x1e9),'lampe'];if(!_0x2b2a55['some'](_0x209623=>_0x2cd85a[_0x8c1ba3(0x1e3)](_0x209623)))return;if(!_0x4aed1b['value'])return;if(sequenceTimer)clearTimeout(sequenceTimer);activeSequence['push']({'loc':_0x4aed1b[_0x8c1ba3(0x1d0)]||_0x8c1ba3(0x1d7),'id':_0x4aed1b['id'],'ts':Date[_0x8c1ba3(0x1cb)]()}),sequenceTimer=setTimeout(async()=>{const _0xc1315=_0x8c1ba3;if(activeSequence[_0xc1315(0x1aa)]>0x1)await saveCompletedSequence(_0x2f0d3a);activeSequence=[];},SEQUENCE_TIMEOUT_MS);}function startExitTimer(_0x487c3e){const _0x4a3afe=a5_0x3f9f;abortExitTimer(_0x487c3e),_0x487c3e[_0x4a3afe(0x1a8)]=!![],_0x487c3e['exitGraceTimer']=setTimeout(()=>{const _0x1d0a9e=_0x4a3afe;_0x487c3e[_0x1d0a9e(0x1a8)]=![];},EXIT_GRACE_PERIOD_SECONDS*0x3e8),_0x487c3e[_0x4a3afe(0x1be)]=setTimeout(()=>{const _0x3df5b8=_0x4a3afe;setPresence(_0x487c3e,![]),_0x487c3e[_0x3df5b8(0x1be)]=null;},EXIT_TIMER_MINUTES*0x3c*0x3e8);}function abortExitTimer(_0x519e5c){const _0x1df009=a5_0x3f9f;if(_0x519e5c[_0x1df009(0x1be)])clearTimeout(_0x519e5c[_0x1df009(0x1be)]);if(_0x519e5c[_0x1df009(0x1e2)])clearTimeout(_0x519e5c['exitGraceTimer']);_0x519e5c[_0x1df009(0x1be)]=null,_0x519e5c[_0x1df009(0x1e2)]=null,_0x519e5c[_0x1df009(0x1a8)]=![];}async function setPresence(_0x254215,_0xb9fe55){const _0x4f7292=a5_0x3f9f;if(_0x254215[_0x4f7292(0x1bc)]===_0xb9fe55)return;_0x254215[_0x4f7292(0x1bc)]=_0xb9fe55,await _0x254215['setStateAsync']('system.isPresent',{'val':_0xb9fe55,'ack':!![]});}async function processSensorEvent(_0x359b8f,_0x395244,_0x45a6f2,_0x4bccce){const _0x406870=a5_0x3f9f;if(!_0x4bccce)return null;const _0x1649aa=_0x45a6f2[_0x406870(0x1b5)],_0x487e34=Date[_0x406870(0x1cb)](),_0x2b5299=_0x359b8f[_0x406870(0x1c6)][_0x395244];_0x359b8f[_0x406870(0x1c6)][_0x395244]=_0x1649aa;if(!_0x4bccce[_0x406870(0x1e6)]&&_0x2b5299!=undefined&&_0x2b5299==_0x1649aa)return null;const _0x32087a=(_0x4bccce[_0x406870(0x1ee)]||'')[_0x406870(0x1ea)](),_0x31d7de=_0x32087a[_0x406870(0x1e3)](_0x406870(0x1dd))||_0x32087a[_0x406870(0x1e3)](_0x406870(0x1a1))||_0x32087a[_0x406870(0x1e3)](_0x406870(0x1c5))||_0x32087a[_0x406870(0x1e3)](_0x406870(0x1bd));_0x359b8f[_0x406870(0x1a2)]&&_0x31d7de&&recordThermodynamics(_0x359b8f,_0x395244,_0x1649aa,_0x4bccce[_0x406870(0x1d0)]);const _0x1f1fb0={'timestamp':_0x487e34,'id':_0x395244,'name':_0x4bccce[_0x406870(0x1d4)],'type':_0x4bccce[_0x406870(0x1ee)],'location':_0x4bccce[_0x406870(0x1d0)],'value':_0x1649aa};_0x359b8f[_0x406870(0x1da)][_0x406870(0x1a3)](_0x1f1fb0);if(_0x359b8f[_0x406870(0x1da)][_0x406870(0x1aa)]>HISTORY_MAX_SIZE)_0x359b8f[_0x406870(0x1da)][_0x406870(0x1b1)]();await _0x359b8f[_0x406870(0x1dc)]('events.lastEvent',{'val':JSON[_0x406870(0x1c9)](_0x1f1fb0),'ack':!![]}),await _0x359b8f[_0x406870(0x1dc)](_0x406870(0x1c2),{'val':JSON[_0x406870(0x1c9)](_0x359b8f[_0x406870(0x1da)]),'ack':!![]});if(_0x359b8f['isProVersion']){_0x359b8f[_0x406870(0x1de)][_0x406870(0x1d1)](_0x1f1fb0);if(_0x359b8f[_0x406870(0x1de)]['length']>RAW_LOG_MAX_SIZE)_0x359b8f[_0x406870(0x1de)][_0x406870(0x1d9)](0x0,_0x359b8f[_0x406870(0x1de)]['length']-RAW_LOG_MAX_SIZE);await _0x359b8f[_0x406870(0x1dc)]('LTM.rawEventLog',{'val':JSON[_0x406870(0x1c9)](_0x359b8f['rawEventLog']),'ack':!![]}),recordSequence(_0x359b8f,_0x1f1fb0);}if(_0x4bccce[_0x406870(0x1bf)]&&_0x1649aa===!![]){if(_0x359b8f[_0x406870(0x1bc)]&&!_0x359b8f[_0x406870(0x1a8)])startExitTimer(_0x359b8f);else{if(!_0x359b8f[_0x406870(0x1bc)])setPresence(_0x359b8f,!![]);}}else{if(_0x4bccce[_0x406870(0x1ee)]===_0x406870(0x1c1)&&_0x1649aa===!![]){if(_0x359b8f['exitTimer'])abortExitTimer(_0x359b8f);if(!_0x359b8f[_0x406870(0x1bc)]&&_0x359b8f[_0x406870(0x19d)]===_0x406870(0x1b3))setPresence(_0x359b8f,!![]);}}return _0x359b8f[_0x406870(0x1a2)]&&_0x4bccce[_0x406870(0x1ee)]===_0x406870(0x1c1)&&_0x1649aa===!![]&&_0x4bccce['location']&&_0x359b8f[_0x406870(0x1ce)]&&_0x359b8f[_0x406870(0x1ce)](_0x406870(0x1af),{'room':_0x4bccce[_0x406870(0x1d0)]}),_0x1f1fb0;}module[a5_0x4ca930(0x1c7)]={'processSensorEvent':processSensorEvent,'getOutsideTemperatureNumeric':getOutsideTemperatureNumeric,'setPresence':setPresence,'abortExitTimer':abortExitTimer,'startExitTimer':startExitTimer};