const a5_0x536f86=a5_0x5c9f;(function(_0x1eb718,_0x284aa1){const _0x164593=a5_0x5c9f,_0x4c5df0=_0x1eb718();while(!![]){try{const _0x22ca44=parseInt(_0x164593(0x117))/0x1+-parseInt(_0x164593(0x12c))/0x2*(-parseInt(_0x164593(0x146))/0x3)+-parseInt(_0x164593(0xe6))/0x4+parseInt(_0x164593(0x143))/0x5*(parseInt(_0x164593(0xef))/0x6)+-parseInt(_0x164593(0x10b))/0x7+-parseInt(_0x164593(0x131))/0x8*(parseInt(_0x164593(0x11d))/0x9)+-parseInt(_0x164593(0xe8))/0xa*(-parseInt(_0x164593(0x11e))/0xb);if(_0x22ca44===_0x284aa1)break;else _0x4c5df0['push'](_0x4c5df0['shift']());}catch(_0x507b95){_0x4c5df0['push'](_0x4c5df0['shift']());}}}(a5_0x4552,0x9740c));const a5_0x477f54=(function(){let _0x507921=!![];return function(_0xfe8e81,_0x187485){const _0x1f4b3e=_0x507921?function(){const _0x3eb409=a5_0x5c9f;if(_0x187485){const _0x1624b7=_0x187485[_0x3eb409(0x118)](_0xfe8e81,arguments);return _0x187485=null,_0x1624b7;}}:function(){};return _0x507921=![],_0x1f4b3e;};}()),a5_0x5c61e2=a5_0x477f54(this,function(){const _0x1c6b9e=a5_0x5c9f;return a5_0x5c61e2[_0x1c6b9e(0x127)]()[_0x1c6b9e(0x137)](_0x1c6b9e(0x154))['toString']()[_0x1c6b9e(0x122)](a5_0x5c61e2)[_0x1c6b9e(0x137)](_0x1c6b9e(0x154));});a5_0x5c61e2();function a5_0x5c9f(_0x311709,_0x48f56a){const _0xa5fa46=a5_0x4552();return a5_0x5c9f=function(_0x5c61e2,_0x477f54){_0x5c61e2=_0x5c61e2-0xe6;let _0x4552c3=_0xa5fa46[_0x5c61e2];return _0x4552c3;},a5_0x5c9f(_0x311709,_0x48f56a);}'use strict';const HISTORY_MAX_SIZE=0x32,RAW_LOG_MAX_SIZE=0x9c4,THERMO_LOG_SIZE=0x3e8,SEQUENCE_TIMEOUT_MS=0x5*0x3c*0x3e8,MAX_TRAINING_SET_SIZE=0x1f4,EXIT_TIMER_MINUTES=0xf,EXIT_GRACE_PERIOD_SECONDS=0x1e;let activeSequence=[],sequenceTimer=null;async function getOutsideTemperatureNumeric(_0xff7708){const _0x2f1eb2=a5_0x5c9f;if(_0xff7708[_0x2f1eb2(0x102)][_0x2f1eb2(0xf3)])try{const _0xea643e=await _0xff7708['getForeignStateAsync'](_0xff7708[_0x2f1eb2(0x102)][_0x2f1eb2(0xf3)]);if(_0xea643e&&_0xea643e[_0x2f1eb2(0x14c)]!==undefined&&_0xea643e[_0x2f1eb2(0x14c)]!==null)return parseFloat(_0xea643e[_0x2f1eb2(0x14c)]);}catch(_0x481db4){}const _0x26e330=_0xff7708[_0x2f1eb2(0x102)]['weatherInstance'];if(!_0xff7708['config'][_0x2f1eb2(0xeb)]||!_0x26e330)return null;try{let _0x3f7cb3='';if(_0x26e330[_0x2f1eb2(0x12d)](_0x2f1eb2(0x151)))_0x3f7cb3=_0x26e330+_0x2f1eb2(0xf7);else{if(_0x26e330[_0x2f1eb2(0x12d)](_0x2f1eb2(0x13a)))_0x3f7cb3=_0x26e330+_0x2f1eb2(0xfd);else{if(_0x26e330[_0x2f1eb2(0x12d)](_0x2f1eb2(0xec)))_0x3f7cb3=_0x26e330+_0x2f1eb2(0x129);else{if(_0x26e330[_0x2f1eb2(0x12d)](_0x2f1eb2(0x14f)))_0x3f7cb3=_0x26e330+_0x2f1eb2(0x152);}}}if(_0x3f7cb3){const _0x490460=await _0xff7708['getForeignStateAsync'](_0x3f7cb3);if(_0x490460&&_0x490460[_0x2f1eb2(0x14c)]!==undefined&&_0x490460[_0x2f1eb2(0x14c)]!==null)return parseFloat(_0x490460[_0x2f1eb2(0x14c)]);}}catch(_0x2ac848){}return null;}async function recordThermodynamics(_0x35cd22,_0x27d5d7,_0x1cfb59,_0x42372e){const _0x2d060c=a5_0x5c9f,_0x24a463=await getOutsideTemperatureNumeric(_0x35cd22);if(_0x24a463===null)return;let _0x36d3b6=0x0,_0x74504b=![];if(_0x35cd22[_0x2d060c(0x102)][_0x2d060c(0x10e)])try{let _0x333383=_0x35cd22[_0x2d060c(0x102)][_0x2d060c(0x10e)];if(typeof _0x333383===_0x2d060c(0x13c))_0x333383=JSON['parse'](_0x333383);if(_0x333383[_0x27d5d7]){const _0x48336f=_0x333383[_0x27d5d7],_0x286f7b=await _0x35cd22[_0x2d060c(0x110)](_0x48336f);if(_0x286f7b&&_0x286f7b[_0x2d060c(0x14c)]!==null&&_0x286f7b[_0x2d060c(0x14c)]!==undefined){let _0x10dcd7=Number(_0x286f7b['val']);if(_0x10dcd7<=1.05&&!_0x48336f[_0x2d060c(0x12d)]('STATUS')&&!_0x48336f[_0x2d060c(0x12d)](_0x2d060c(0x147)))_0x10dcd7=_0x10dcd7*0x64;_0x36d3b6=Math[_0x2d060c(0xf2)](_0x10dcd7),_0x74504b=!![];}}}catch(_0x5eb658){}if(!_0x74504b){const _0x4b65c2=[{'from':_0x2d060c(0x128),'to':_0x2d060c(0x101)},{'from':_0x2d060c(0x128),'to':_0x2d060c(0x148)},{'from':_0x2d060c(0x113),'to':'.4.VALVE_STATE'},{'from':_0x2d060c(0x139),'to':_0x2d060c(0x130)},{'from':_0x2d060c(0x13f),'to':_0x2d060c(0x132)},{'from':_0x2d060c(0x13d),'to':_0x2d060c(0xf1)}];for(const _0x148f75 of _0x4b65c2){if(_0x27d5d7[_0x2d060c(0x12d)](_0x148f75[_0x2d060c(0x12f)])){const _0x27e53f=_0x27d5d7[_0x2d060c(0xfe)](_0x148f75['from'],_0x148f75['to']);try{const _0x1dffac=await _0x35cd22['getForeignStateAsync'](_0x27e53f);if(_0x1dffac&&_0x1dffac['val']!==null&&_0x1dffac[_0x2d060c(0x14c)]!==undefined){let _0x5881b7=Number(_0x1dffac[_0x2d060c(0x14c)]);if(typeof _0x5881b7===_0x2d060c(0x149)){if(_0x5881b7<=1.05&&_0x148f75['to'][_0x2d060c(0x12d)](_0x2d060c(0x140)))_0x5881b7=_0x5881b7*0x64;_0x36d3b6=Math[_0x2d060c(0xf2)](_0x5881b7),_0x74504b=!![];break;}}}catch(_0x2affc5){}}}}const _0x10b8a0=await _0x35cd22[_0x2d060c(0x119)](_0x2d060c(0x141));let _0x346e15=[];if(_0x10b8a0&&_0x10b8a0[_0x2d060c(0x14c)])try{_0x346e15=JSON[_0x2d060c(0x115)](_0x10b8a0[_0x2d060c(0x14c)]);}catch(_0x4539bc){}_0x346e15[_0x2d060c(0x142)]({'ts':Date[_0x2d060c(0x10a)](),'room':_0x42372e||'Unknown','t_in':_0x1cfb59,'t_out':_0x24a463,'valve':_0x36d3b6});if(_0x346e15[_0x2d060c(0x155)]>THERMO_LOG_SIZE)_0x346e15[_0x2d060c(0x10c)]();await _0x35cd22[_0x2d060c(0x14b)](_0x2d060c(0x141),{'val':JSON[_0x2d060c(0xfc)](_0x346e15),'ack':!![]});}async function saveCompletedSequence(_0x1aeccc){const _0x1745ec=a5_0x5c9f;try{const _0x3696cf=await _0x1aeccc[_0x1745ec(0x119)](_0x1745ec(0xed));let _0x11fbcb=[];if(_0x3696cf&&_0x3696cf['val'])try{_0x11fbcb=JSON['parse'](_0x3696cf['val']);}catch(_0x1a3354){}const _0x13b2fd=activeSequence[0x0]['ts'],_0x1c4338=activeSequence['map'](_0x15815e=>({'loc':_0x15815e[_0x1745ec(0x126)],'t_delta':Math['round']((_0x15815e['ts']-_0x13b2fd)/0x3e8)})),_0x2d462a={'timestamp':new Date(_0x13b2fd)['toISOString'](),'steps':_0x1c4338,'duration':Math['round']((activeSequence[activeSequence['length']-0x1]['ts']-_0x13b2fd)/0x3e8),'daytime':new Date(_0x13b2fd)[_0x1745ec(0x138)]()};_0x11fbcb[_0x1745ec(0x142)](_0x2d462a);if(_0x11fbcb[_0x1745ec(0x155)]>MAX_TRAINING_SET_SIZE)_0x11fbcb[_0x1745ec(0x10c)]();await _0x1aeccc[_0x1745ec(0x14b)](_0x1745ec(0xed),{'val':JSON[_0x1745ec(0xfc)](_0x11fbcb),'ack':!![]}),_0x1aeccc[_0x1745ec(0x116)]&&_0x1aeccc[_0x1745ec(0x107)]&&_0x1aeccc['sendToPythonWrapper']('ANALYZE_SEQUENCE',{'sequence':_0x2d462a});}catch(_0x49eaea){_0x1aeccc['log'][_0x1745ec(0x12a)](_0x1745ec(0xfa)+_0x49eaea[_0x1745ec(0x13e)]);}}async function recordSequence(_0x3767ca,_0x12fb94){const _0x52f729=a5_0x5c9f,_0x59a2e2=(_0x12fb94[_0x52f729(0x104)]||'')[_0x52f729(0x135)](),_0x4430d7=[_0x52f729(0x136),'bewegung','pr채senz','presence','occupancy','door',_0x52f729(0x156),'window','fenster',_0x52f729(0x125),_0x52f729(0x105),'light',_0x52f729(0x153),_0x52f729(0x10d),_0x52f729(0x13b),_0x52f729(0x112),_0x52f729(0x133)];if(!_0x4430d7[_0x52f729(0x145)](_0x19ffca=>_0x59a2e2[_0x52f729(0x12d)](_0x19ffca)))return;if(!_0x12fb94[_0x52f729(0x106)])return;if(sequenceTimer)clearTimeout(sequenceTimer);activeSequence[_0x52f729(0x142)]({'loc':_0x12fb94['location']||_0x52f729(0x11a),'id':_0x12fb94['id'],'ts':Date[_0x52f729(0x10a)]()}),sequenceTimer=setTimeout(async()=>{const _0x4a2fb2=_0x52f729;if(activeSequence[_0x4a2fb2(0x155)]>0x1)await saveCompletedSequence(_0x3767ca);activeSequence=[];},SEQUENCE_TIMEOUT_MS);}function startExitTimer(_0x3bf9ed){const _0x3c65d8=a5_0x5c9f;abortExitTimer(_0x3bf9ed),_0x3bf9ed['isGracePeriodActive']=!![],_0x3bf9ed[_0x3c65d8(0x12b)]=setTimeout(()=>{const _0x28a843=_0x3c65d8;_0x3bf9ed[_0x28a843(0x100)]=![];},EXIT_GRACE_PERIOD_SECONDS*0x3e8),_0x3bf9ed['exitTimer']=setTimeout(()=>{const _0x3b3c98=_0x3c65d8;setPresence(_0x3bf9ed,![]),_0x3bf9ed[_0x3b3c98(0xf5)]=null;},EXIT_TIMER_MINUTES*0x3c*0x3e8);}function a5_0x4552(){const _0x2cdfc9=['schalter','string','Temperature','message','temperature','LEVEL','LTM.trainingData.thermodynamics','push','895vrOWmB','exports','some','786ZiUpNh','STATE','.1.VALVE_STATE','number','heizung','setStateAsync','val','isPresent','handle','weatherunderground','window','accuweather','.forecast.current.temp','licht','(((.+)+)+)+$','length','t체r','2933804tBeCwL','location','10298310EYkTsh','debug','system.isPresent','useWeather','openweathermap','LTM.trainingData.sequences','eventHistory','10110IXIwcQ','light','Valve','round','outdoorSensorId','temperatur','exitTimer','klima','.Current.Temperature','griff','bewegung','[RECORDER]\x20Error:\x20','SIMULATE_SIGNAL','stringify','.NextHours.Location_1.Day_1.current.temp_value','replace','isExit','isGracePeriodActive','.1.LEVEL','config','presence','type','kontakt','value','sendToPythonWrapper','pop','log','now','2533181pWAztV','shift','switch','valveMapping','door','getForeignStateAsync','unshift','dimmer','.1.TEMPERATURE','events.history','parse','isProVersion','1086652AYhdGs','apply','getStateAsync','Unknown','events.lastEvent','sensorLastValues','18PTWIhp','11Jtiulz','[RECORDER]\x20Ignored\x20implausible\x20temperature:\x20','occupancy','rawEventLog','constructor','lastTrackerEventTime','\x20from\x20','contact','loc','toString','.1.ACTUAL_TEMPERATURE','.forecast.current.temperature','error','exitGraceTimer','3532NTecaQ','includes','lock','from','.LEVEL','4663696rUQSsL','level','lampe','normal','toLowerCase','motion','search','getHours','.ACTUAL_TEMPERATURE','daswetter'];a5_0x4552=function(){return _0x2cdfc9;};return a5_0x4552();}function abortExitTimer(_0x1dd3d3){const _0x18aa06=a5_0x5c9f;if(_0x1dd3d3[_0x18aa06(0xf5)])clearTimeout(_0x1dd3d3[_0x18aa06(0xf5)]);if(_0x1dd3d3['exitGraceTimer'])clearTimeout(_0x1dd3d3['exitGraceTimer']);_0x1dd3d3['exitTimer']=null,_0x1dd3d3[_0x18aa06(0x12b)]=null,_0x1dd3d3[_0x18aa06(0x100)]=![];}async function setPresence(_0x2ce4a2,_0x128fdd){const _0xe95d9c=a5_0x5c9f;if(_0x2ce4a2[_0xe95d9c(0x14d)]===_0x128fdd)return;_0x2ce4a2[_0xe95d9c(0x14d)]=_0x128fdd,await _0x2ce4a2['setStateAsync'](_0xe95d9c(0xea),{'val':_0x128fdd,'ack':!![]});}async function processSensorEvent(_0x14dc98,_0xeec3e2,_0x107226,_0x19f210){const _0x5ec898=a5_0x5c9f;if(!_0x19f210)return null;const _0x13d453=_0x107226['val'],_0x467cbe=Date['now'](),_0x4ffc4e=_0x14dc98['sensorLastValues'][_0xeec3e2],_0x3ac614=(_0x19f210['type']||'')['toLowerCase'](),_0x1254a4=_0x3ac614[_0x5ec898(0x12d)](_0x5ec898(0x13f))||_0x3ac614[_0x5ec898(0x12d)](_0x5ec898(0xf4))||_0x3ac614[_0x5ec898(0x12d)](_0x5ec898(0xf6))||_0x3ac614['includes'](_0x5ec898(0x14a))||_0x3ac614[_0x5ec898(0x12d)]('thermostat');if(_0x1254a4&&typeof _0x13d453==='number'){if(_0x13d453>0x50||_0x13d453<-0x32)return _0x14dc98[_0x5ec898(0x109)][_0x5ec898(0xe9)](_0x5ec898(0x11f)+_0x13d453+_0x5ec898(0x124)+_0xeec3e2),null;}_0x14dc98[_0x5ec898(0x11c)][_0xeec3e2]=_0x13d453;if(!_0x19f210['logDuplicates']&&_0x4ffc4e!=undefined&&_0x4ffc4e==_0x13d453)return null;_0x14dc98[_0x5ec898(0x116)]&&_0x1254a4&&recordThermodynamics(_0x14dc98,_0xeec3e2,_0x13d453,_0x19f210[_0x5ec898(0xe7)]);const _0xb7b7c3={'timestamp':_0x467cbe,'id':_0xeec3e2,'name':_0x19f210['name'],'type':_0x19f210[_0x5ec898(0x104)],'location':_0x19f210[_0x5ec898(0xe7)],'value':_0x13d453};_0x14dc98[_0x5ec898(0xee)][_0x5ec898(0x111)](_0xb7b7c3);if(_0x14dc98[_0x5ec898(0xee)]['length']>HISTORY_MAX_SIZE)_0x14dc98[_0x5ec898(0xee)][_0x5ec898(0x108)]();await _0x14dc98[_0x5ec898(0x14b)](_0x5ec898(0x11b),{'val':JSON[_0x5ec898(0xfc)](_0xb7b7c3),'ack':!![]}),await _0x14dc98[_0x5ec898(0x14b)](_0x5ec898(0x114),{'val':JSON[_0x5ec898(0xfc)](_0x14dc98['eventHistory']),'ack':!![]});if(_0x14dc98['isProVersion']){_0x14dc98[_0x5ec898(0x121)][_0x5ec898(0x142)](_0xb7b7c3);if(_0x14dc98[_0x5ec898(0x121)][_0x5ec898(0x155)]>RAW_LOG_MAX_SIZE)_0x14dc98[_0x5ec898(0x121)]['splice'](0x0,_0x14dc98['rawEventLog'][_0x5ec898(0x155)]-RAW_LOG_MAX_SIZE);await _0x14dc98[_0x5ec898(0x14b)]('LTM.rawEventLog',{'val':JSON[_0x5ec898(0xfc)](_0x14dc98[_0x5ec898(0x121)]),'ack':!![]}),recordSequence(_0x14dc98,_0xb7b7c3);}if(_0x19f210[_0x5ec898(0xff)]&&_0x13d453===!![]){if(_0x14dc98['isPresent']&&!_0x14dc98[_0x5ec898(0x100)])startExitTimer(_0x14dc98);else{if(!_0x14dc98[_0x5ec898(0x14d)])setPresence(_0x14dc98,!![]);}}else{if(_0x19f210[_0x5ec898(0x104)]===_0x5ec898(0x136)&&_0x13d453===!![]){if(_0x14dc98['exitTimer'])abortExitTimer(_0x14dc98);if(!_0x14dc98[_0x5ec898(0x14d)]&&_0x14dc98['currentSystemMode']===_0x5ec898(0x134))setPresence(_0x14dc98,!![]);}}if(_0x14dc98[_0x5ec898(0x116)]&&_0x14dc98['sendToPythonWrapper']){_0x19f210['type']===_0x5ec898(0x136)&&_0x13d453===!![]&&_0x19f210[_0x5ec898(0xe7)]&&_0x14dc98[_0x5ec898(0x107)](_0x5ec898(0xfb),{'room':_0x19f210[_0x5ec898(0xe7)]});const _0x4d7fc7=[_0x5ec898(0x10f),'t체r',_0x5ec898(0x150),'fenster',_0x5ec898(0xf8),_0x5ec898(0x14e),_0x5ec898(0x12e),'schloss'][_0x5ec898(0x145)](_0x5a750e=>_0x3ac614[_0x5ec898(0x12d)](_0x5a750e)),_0x2405e5=[_0x5ec898(0xf0),_0x5ec898(0x153),_0x5ec898(0x10d),_0x5ec898(0x13b),_0x5ec898(0x112),_0x5ec898(0x133)][_0x5ec898(0x145)](_0x47dd35=>_0x3ac614[_0x5ec898(0x12d)](_0x47dd35)),_0x1fc0ba=[_0x5ec898(0x136),_0x5ec898(0xf9),'pr채senz',_0x5ec898(0x103),_0x5ec898(0x120)][_0x5ec898(0x145)](_0x41422e=>_0x3ac614['includes'](_0x41422e));if(_0x19f210[_0x5ec898(0xe7)]&&(_0x4d7fc7||_0x2405e5||_0x1fc0ba)){const _0x3dae92=_0x13d453===!![]||typeof _0x13d453===_0x5ec898(0x149)&&_0x13d453>0x0,_0x23885c=_0x4d7fc7&&!_0x3dae92&&_0x4ffc4e!==undefined&&_0x4ffc4e!=_0x13d453;if(_0x3dae92||_0x23885c){const _0x31fe0d=_0x14dc98[_0x5ec898(0x123)]||_0x467cbe,_0x50ea55=(_0x467cbe-_0x31fe0d)/0x3e8;_0x14dc98[_0x5ec898(0x123)]=_0x467cbe,_0x14dc98[_0x5ec898(0x107)]('TRACK_EVENT',{'room':_0x19f210[_0x5ec898(0xe7)],'dt':_0x50ea55});}}}return _0xb7b7c3;}module[a5_0x536f86(0x144)]={'processSensorEvent':processSensorEvent,'getOutsideTemperatureNumeric':getOutsideTemperatureNumeric,'setPresence':setPresence,'abortExitTimer':abortExitTimer,'startExitTimer':startExitTimer};