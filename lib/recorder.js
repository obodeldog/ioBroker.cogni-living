const a5_0x2b41a4=a5_0x487c;(function(_0x5cacf0,_0x32662d){const _0x60b753=a5_0x487c,_0x5e689c=_0x5cacf0();while(!![]){try{const _0x508201=-parseInt(_0x60b753(0x1e6))/0x1*(-parseInt(_0x60b753(0x1ec))/0x2)+parseInt(_0x60b753(0x206))/0x3+-parseInt(_0x60b753(0x219))/0x4*(-parseInt(_0x60b753(0x1e7))/0x5)+-parseInt(_0x60b753(0x1eb))/0x6*(-parseInt(_0x60b753(0x1fa))/0x7)+-parseInt(_0x60b753(0x1f0))/0x8*(parseInt(_0x60b753(0x21e))/0x9)+parseInt(_0x60b753(0x208))/0xa*(parseInt(_0x60b753(0x1d0))/0xb)+parseInt(_0x60b753(0x1d5))/0xc*(-parseInt(_0x60b753(0x1e8))/0xd);if(_0x508201===_0x32662d)break;else _0x5e689c['push'](_0x5e689c['shift']());}catch(_0x5450e1){_0x5e689c['push'](_0x5e689c['shift']());}}}(a5_0x2213,0xb9db9));const a5_0x305984=(function(){let _0xdabb09=!![];return function(_0x1d78c4,_0x188b85){const _0x28c795=_0xdabb09?function(){const _0xe09201=a5_0x487c;if(_0x188b85){const _0x2fe1f2=_0x188b85[_0xe09201(0x1c8)](_0x1d78c4,arguments);return _0x188b85=null,_0x2fe1f2;}}:function(){};return _0xdabb09=![],_0x28c795;};}()),a5_0x3ba569=a5_0x305984(this,function(){const _0x51c4df=a5_0x487c;return a5_0x3ba569[_0x51c4df(0x1fd)]()['search']('(((.+)+)+)+$')[_0x51c4df(0x1fd)]()[_0x51c4df(0x1de)](a5_0x3ba569)[_0x51c4df(0x237)]('(((.+)+)+)+$');});function a5_0x487c(_0xaeced1,_0x111e4f){const _0x4cd50c=a5_0x2213();return a5_0x487c=function(_0x3ba569,_0x305984){_0x3ba569=_0x3ba569-0x1c8;let _0x2213be=_0x4cd50c[_0x3ba569];return _0x2213be;},a5_0x487c(_0xaeced1,_0x111e4f);}a5_0x3ba569();function a5_0x2213(){const _0x25e6b7=['splice','Unknown','rawEventLog','griff','round','553BXLITv','.1.ACTUAL_TEMPERATURE','isExit','toString','.Current.Temperature','temperature','log','klima','getForeignStateAsync','stringify','.1.VALVE_STATE','string','780825MwZiLw','weatherunderground','10VlRxPJ','Valve','.1.LEVEL','präsenz','tür','setStateAsync','isPresent','licht','TRACK_EVENT','map','valveMapping','val','lampe','outdoorSensorId','.forecast.current.temperature','bewegung','level','36FTEKdc','dimmer','LTM.trainingData.sequences','includes','door','72UBACWr','isProVersion','eventHistory','normal','type','getStateAsync','exports','handle','SIMULATE_SIGNAL','motion','from','useWeather','occupancy','kontakt','[RECORDER]\x20Ignored\x20implausible\x20temperature:\x20','window','LEVEL','switch','getHours','light','shift','.1.TEMPERATURE','fenster','presence','.LEVEL','search','location','isGracePeriodActive','apply','heizung','contact','sendToPythonWrapper','toLowerCase','LTM.trainingData.thermodynamics','Temperature','sensorLastValues','14203981JTrVWQ','thermostat','number','.NextHours.Location_1.Day_1.current.temp_value','temperatur','24mVNbAd','daswetter','push','events.history','\x20from\x20','exitGraceTimer','value','length','LTM.rawEventLog','constructor','toISOString','schalter','config','lock','some','.4.VALVE_STATE','accuweather','19QzRBiw','4165grUWcg','16341884WeTGHu','replace','parse','51582uqjCbA','140242SuaIry','name','exitTimer','[RECORDER]\x20Error:\x20','295096qhxPWj','.forecast.current.temp','STATUS','now','lastTrackerEventTime'];a5_0x2213=function(){return _0x25e6b7;};return a5_0x2213();}'use strict';const HISTORY_MAX_SIZE=0x32,RAW_LOG_MAX_SIZE=0x9c4,THERMO_LOG_SIZE=0x3e8,SEQUENCE_TIMEOUT_MS=0x5*0x3c*0x3e8,MAX_TRAINING_SET_SIZE=0x1f4,EXIT_TIMER_MINUTES=0xf,EXIT_GRACE_PERIOD_SECONDS=0x1e;let activeSequence=[],sequenceTimer=null;async function getOutsideTemperatureNumeric(_0xb31779){const _0x18d366=a5_0x487c;if(_0xb31779[_0x18d366(0x1e1)]['outdoorSensorId'])try{const _0xabd099=await _0xb31779[_0x18d366(0x202)](_0xb31779[_0x18d366(0x1e1)][_0x18d366(0x215)]);if(_0xabd099&&_0xabd099[_0x18d366(0x213)]!==undefined&&_0xabd099[_0x18d366(0x213)]!==null)return parseFloat(_0xabd099['val']);}catch(_0x4c2f27){}const _0x50688d=_0xb31779[_0x18d366(0x1e1)]['weatherInstance'];if(!_0xb31779[_0x18d366(0x1e1)][_0x18d366(0x229)]||!_0x50688d)return null;try{let _0x448849='';if(_0x50688d['includes'](_0x18d366(0x1e5)))_0x448849=_0x50688d+_0x18d366(0x1fe);else{if(_0x50688d[_0x18d366(0x21c)](_0x18d366(0x1d6)))_0x448849=_0x50688d+_0x18d366(0x1d3);else{if(_0x50688d['includes']('openweathermap'))_0x448849=_0x50688d+_0x18d366(0x216);else{if(_0x50688d[_0x18d366(0x21c)](_0x18d366(0x207)))_0x448849=_0x50688d+_0x18d366(0x1f1);}}}if(_0x448849){const _0x153cef=await _0xb31779[_0x18d366(0x202)](_0x448849);if(_0x153cef&&_0x153cef[_0x18d366(0x213)]!==undefined&&_0x153cef[_0x18d366(0x213)]!==null)return parseFloat(_0x153cef['val']);}}catch(_0x1772d4){}return null;}async function recordThermodynamics(_0x2d00cf,_0x21c568,_0x4213a0,_0x2127cc){const _0x1e65ca=a5_0x487c,_0x596a8b=await getOutsideTemperatureNumeric(_0x2d00cf);if(_0x596a8b===null)return;let _0x25b298=0x0,_0x19f254=![];if(_0x2d00cf[_0x1e65ca(0x1e1)][_0x1e65ca(0x212)])try{let _0x47f9f4=_0x2d00cf['config'][_0x1e65ca(0x212)];if(typeof _0x47f9f4===_0x1e65ca(0x205))_0x47f9f4=JSON[_0x1e65ca(0x1ea)](_0x47f9f4);if(_0x47f9f4[_0x21c568]){const _0x3bc968=_0x47f9f4[_0x21c568],_0x37ed34=await _0x2d00cf[_0x1e65ca(0x202)](_0x3bc968);if(_0x37ed34&&_0x37ed34[_0x1e65ca(0x213)]!==null&&_0x37ed34[_0x1e65ca(0x213)]!==undefined){let _0xacdc29=Number(_0x37ed34[_0x1e65ca(0x213)]);if(_0xacdc29<=1.05&&!_0x3bc968[_0x1e65ca(0x21c)](_0x1e65ca(0x1f2))&&!_0x3bc968[_0x1e65ca(0x21c)]('STATE'))_0xacdc29=_0xacdc29*0x64;_0x25b298=Math[_0x1e65ca(0x1f9)](_0xacdc29),_0x19f254=!![];}}}catch(_0x3837a9){}if(!_0x19f254){const _0xe10545=[{'from':_0x1e65ca(0x1fb),'to':_0x1e65ca(0x20a)},{'from':_0x1e65ca(0x1fb),'to':_0x1e65ca(0x204)},{'from':_0x1e65ca(0x233),'to':_0x1e65ca(0x1e4)},{'from':'.ACTUAL_TEMPERATURE','to':_0x1e65ca(0x236)},{'from':_0x1e65ca(0x1ff),'to':_0x1e65ca(0x218)},{'from':_0x1e65ca(0x1ce),'to':_0x1e65ca(0x209)}];for(const _0x6ed1d4 of _0xe10545){if(_0x21c568[_0x1e65ca(0x21c)](_0x6ed1d4[_0x1e65ca(0x228)])){const _0x366590=_0x21c568[_0x1e65ca(0x1e9)](_0x6ed1d4[_0x1e65ca(0x228)],_0x6ed1d4['to']);try{const _0x41d72d=await _0x2d00cf[_0x1e65ca(0x202)](_0x366590);if(_0x41d72d&&_0x41d72d[_0x1e65ca(0x213)]!==null&&_0x41d72d['val']!==undefined){let _0x1f7389=Number(_0x41d72d[_0x1e65ca(0x213)]);if(typeof _0x1f7389===_0x1e65ca(0x1d2)){if(_0x1f7389<=1.05&&_0x6ed1d4['to'][_0x1e65ca(0x21c)](_0x1e65ca(0x22e)))_0x1f7389=_0x1f7389*0x64;_0x25b298=Math[_0x1e65ca(0x1f9)](_0x1f7389),_0x19f254=!![];break;}}}catch(_0x1b9746){}}}}const _0x49f07f=await _0x2d00cf[_0x1e65ca(0x223)](_0x1e65ca(0x1cd));let _0x439564=[];if(_0x49f07f&&_0x49f07f['val'])try{_0x439564=JSON[_0x1e65ca(0x1ea)](_0x49f07f['val']);}catch(_0x46de1c){}_0x439564[_0x1e65ca(0x1d7)]({'ts':Date[_0x1e65ca(0x1f3)](),'room':_0x2127cc||_0x1e65ca(0x1f6),'t_in':_0x4213a0,'t_out':_0x596a8b,'valve':_0x25b298});if(_0x439564[_0x1e65ca(0x1dc)]>THERMO_LOG_SIZE)_0x439564[_0x1e65ca(0x232)]();await _0x2d00cf[_0x1e65ca(0x20d)](_0x1e65ca(0x1cd),{'val':JSON[_0x1e65ca(0x203)](_0x439564),'ack':!![]});}async function saveCompletedSequence(_0x51b6c1){const _0x2a899a=a5_0x487c;try{const _0xfec3df=await _0x51b6c1[_0x2a899a(0x223)]('LTM.trainingData.sequences');let _0x317ca3=[];if(_0xfec3df&&_0xfec3df[_0x2a899a(0x213)])try{_0x317ca3=JSON['parse'](_0xfec3df[_0x2a899a(0x213)]);}catch(_0x309299){}const _0x283e65=activeSequence[0x0]['ts'],_0x23c228=activeSequence[_0x2a899a(0x211)](_0x2b948e=>({'loc':_0x2b948e['loc'],'t_delta':Math['round']((_0x2b948e['ts']-_0x283e65)/0x3e8)})),_0x274014={'timestamp':new Date(_0x283e65)[_0x2a899a(0x1df)](),'steps':_0x23c228,'duration':Math[_0x2a899a(0x1f9)]((activeSequence[activeSequence[_0x2a899a(0x1dc)]-0x1]['ts']-_0x283e65)/0x3e8),'daytime':new Date(_0x283e65)[_0x2a899a(0x230)]()};_0x317ca3[_0x2a899a(0x1d7)](_0x274014);if(_0x317ca3['length']>MAX_TRAINING_SET_SIZE)_0x317ca3[_0x2a899a(0x232)]();await _0x51b6c1[_0x2a899a(0x20d)](_0x2a899a(0x21b),{'val':JSON['stringify'](_0x317ca3),'ack':!![]}),_0x51b6c1[_0x2a899a(0x21f)]&&_0x51b6c1[_0x2a899a(0x1cb)]&&_0x51b6c1[_0x2a899a(0x1cb)]('ANALYZE_SEQUENCE',{'sequence':_0x274014});}catch(_0x40cfc8){_0x51b6c1['log']['error'](_0x2a899a(0x1ef)+_0x40cfc8['message']);}}async function recordSequence(_0x469de9,_0x112b8e){const _0x6db911=a5_0x487c,_0x5b65ed=(_0x112b8e['type']||'')[_0x6db911(0x1cc)](),_0x45a908=[_0x6db911(0x227),_0x6db911(0x217),_0x6db911(0x20b),'presence',_0x6db911(0x22a),'door','tür',_0x6db911(0x22d),_0x6db911(0x234),_0x6db911(0x1ca),_0x6db911(0x22b),_0x6db911(0x231),_0x6db911(0x20f),'switch',_0x6db911(0x1e0),_0x6db911(0x21a),'lampe'];if(!_0x45a908['some'](_0x13fad9=>_0x5b65ed[_0x6db911(0x21c)](_0x13fad9)))return;if(!_0x112b8e[_0x6db911(0x1db)])return;if(sequenceTimer)clearTimeout(sequenceTimer);activeSequence[_0x6db911(0x1d7)]({'loc':_0x112b8e[_0x6db911(0x238)]||_0x6db911(0x1f6),'id':_0x112b8e['id'],'ts':Date[_0x6db911(0x1f3)]()}),sequenceTimer=setTimeout(async()=>{if(activeSequence['length']>0x1)await saveCompletedSequence(_0x469de9);activeSequence=[];},SEQUENCE_TIMEOUT_MS);}function startExitTimer(_0x5f5bd7){const _0x262299=a5_0x487c;abortExitTimer(_0x5f5bd7),_0x5f5bd7[_0x262299(0x239)]=!![],_0x5f5bd7['exitGraceTimer']=setTimeout(()=>{const _0x2600a2=_0x262299;_0x5f5bd7[_0x2600a2(0x239)]=![];},EXIT_GRACE_PERIOD_SECONDS*0x3e8),_0x5f5bd7[_0x262299(0x1ee)]=setTimeout(()=>{const _0x132865=_0x262299;setPresence(_0x5f5bd7,![]),_0x5f5bd7[_0x132865(0x1ee)]=null;},EXIT_TIMER_MINUTES*0x3c*0x3e8);}function abortExitTimer(_0x4b418a){const _0x3e68d=a5_0x487c;if(_0x4b418a[_0x3e68d(0x1ee)])clearTimeout(_0x4b418a[_0x3e68d(0x1ee)]);if(_0x4b418a[_0x3e68d(0x1da)])clearTimeout(_0x4b418a[_0x3e68d(0x1da)]);_0x4b418a[_0x3e68d(0x1ee)]=null,_0x4b418a[_0x3e68d(0x1da)]=null,_0x4b418a[_0x3e68d(0x239)]=![];}async function setPresence(_0x5505bb,_0x28b0eb){const _0x56061f=a5_0x487c;if(_0x5505bb[_0x56061f(0x20e)]===_0x28b0eb)return;_0x5505bb['isPresent']=_0x28b0eb,await _0x5505bb[_0x56061f(0x20d)]('system.isPresent',{'val':_0x28b0eb,'ack':!![]});}async function processSensorEvent(_0xc852a9,_0xc52218,_0x2f1278,_0x4673dd){const _0x435b15=a5_0x487c;if(!_0x4673dd)return null;const _0x910d58=_0x2f1278[_0x435b15(0x213)],_0x244f01=Date[_0x435b15(0x1f3)](),_0x55511d=_0xc852a9[_0x435b15(0x1cf)][_0xc52218],_0x451a2c=(_0x4673dd[_0x435b15(0x222)]||'')[_0x435b15(0x1cc)](),_0x2b08c9=_0x451a2c['includes'](_0x435b15(0x1ff))||_0x451a2c['includes'](_0x435b15(0x1d4))||_0x451a2c[_0x435b15(0x21c)](_0x435b15(0x201))||_0x451a2c[_0x435b15(0x21c)](_0x435b15(0x1c9))||_0x451a2c[_0x435b15(0x21c)](_0x435b15(0x1d1));if(_0x2b08c9&&typeof _0x910d58===_0x435b15(0x1d2)){if(_0x910d58>0x50||_0x910d58<-0x32)return _0xc852a9[_0x435b15(0x200)]['debug'](_0x435b15(0x22c)+_0x910d58+_0x435b15(0x1d9)+_0xc52218),null;}_0xc852a9[_0x435b15(0x1cf)][_0xc52218]=_0x910d58;if(!_0x4673dd['logDuplicates']&&_0x55511d!=undefined&&_0x55511d==_0x910d58)return null;_0xc852a9[_0x435b15(0x21f)]&&_0x2b08c9&&recordThermodynamics(_0xc852a9,_0xc52218,_0x910d58,_0x4673dd[_0x435b15(0x238)]);const _0x41a2f9={'timestamp':_0x244f01,'id':_0xc52218,'name':_0x4673dd[_0x435b15(0x1ed)],'type':_0x4673dd['type'],'location':_0x4673dd[_0x435b15(0x238)],'value':_0x910d58};_0xc852a9[_0x435b15(0x220)]['unshift'](_0x41a2f9);if(_0xc852a9[_0x435b15(0x220)][_0x435b15(0x1dc)]>HISTORY_MAX_SIZE)_0xc852a9[_0x435b15(0x220)]['pop']();await _0xc852a9[_0x435b15(0x20d)]('events.lastEvent',{'val':JSON['stringify'](_0x41a2f9),'ack':!![]}),await _0xc852a9[_0x435b15(0x20d)](_0x435b15(0x1d8),{'val':JSON[_0x435b15(0x203)](_0xc852a9[_0x435b15(0x220)]),'ack':!![]});if(_0xc852a9['isProVersion']){_0xc852a9[_0x435b15(0x1f7)][_0x435b15(0x1d7)](_0x41a2f9);if(_0xc852a9[_0x435b15(0x1f7)][_0x435b15(0x1dc)]>RAW_LOG_MAX_SIZE)_0xc852a9[_0x435b15(0x1f7)][_0x435b15(0x1f5)](0x0,_0xc852a9[_0x435b15(0x1f7)][_0x435b15(0x1dc)]-RAW_LOG_MAX_SIZE);await _0xc852a9['setStateAsync'](_0x435b15(0x1dd),{'val':JSON['stringify'](_0xc852a9[_0x435b15(0x1f7)]),'ack':!![]}),recordSequence(_0xc852a9,_0x41a2f9);}if(_0x4673dd[_0x435b15(0x1fc)]&&_0x910d58===!![]){if(_0xc852a9[_0x435b15(0x20e)]&&!_0xc852a9[_0x435b15(0x239)])startExitTimer(_0xc852a9);else{if(!_0xc852a9['isPresent'])setPresence(_0xc852a9,!![]);}}else{if(_0x4673dd[_0x435b15(0x222)]===_0x435b15(0x227)&&_0x910d58===!![]){if(_0xc852a9[_0x435b15(0x1ee)])abortExitTimer(_0xc852a9);if(!_0xc852a9[_0x435b15(0x20e)]&&_0xc852a9['currentSystemMode']===_0x435b15(0x221))setPresence(_0xc852a9,!![]);}}if(_0xc852a9['isProVersion']&&_0xc852a9[_0x435b15(0x1cb)]){_0x4673dd[_0x435b15(0x222)]==='motion'&&_0x910d58===!![]&&_0x4673dd[_0x435b15(0x238)]&&_0xc852a9[_0x435b15(0x1cb)](_0x435b15(0x226),{'room':_0x4673dd[_0x435b15(0x238)]});const _0x554266=[_0x435b15(0x21d),_0x435b15(0x20c),_0x435b15(0x22d),_0x435b15(0x234),_0x435b15(0x1f8),_0x435b15(0x225),_0x435b15(0x1e2),'schloss'][_0x435b15(0x1e3)](_0x7ddbdf=>_0x451a2c[_0x435b15(0x21c)](_0x7ddbdf)),_0x55eda8=['light',_0x435b15(0x20f),_0x435b15(0x22f),_0x435b15(0x1e0),_0x435b15(0x21a),_0x435b15(0x214)]['some'](_0x3798eb=>_0x451a2c[_0x435b15(0x21c)](_0x3798eb)),_0x434f71=[_0x435b15(0x227),'bewegung',_0x435b15(0x20b),_0x435b15(0x235),_0x435b15(0x22a)][_0x435b15(0x1e3)](_0x2b7875=>_0x451a2c[_0x435b15(0x21c)](_0x2b7875));if(_0x4673dd[_0x435b15(0x238)]&&(_0x554266||_0x55eda8||_0x434f71)){const _0x1776a2=_0x910d58===!![]||typeof _0x910d58===_0x435b15(0x1d2)&&_0x910d58>0x0,_0x135f04=_0x554266&&!_0x1776a2&&_0x55511d!==undefined&&_0x55511d!=_0x910d58;if(_0x1776a2||_0x135f04){const _0x3606b9=_0xc852a9[_0x435b15(0x1f4)]||_0x244f01,_0x154b4d=(_0x244f01-_0x3606b9)/0x3e8;_0xc852a9[_0x435b15(0x1f4)]=_0x244f01,_0xc852a9['sendToPythonWrapper'](_0x435b15(0x210),{'room':_0x4673dd[_0x435b15(0x238)],'dt':_0x154b4d});}}}return _0x41a2f9;}module[a5_0x2b41a4(0x224)]={'processSensorEvent':processSensorEvent,'getOutsideTemperatureNumeric':getOutsideTemperatureNumeric,'setPresence':setPresence,'abortExitTimer':abortExitTimer,'startExitTimer':startExitTimer};