const a5_0x5e3b44=a5_0x188e;(function(_0xa940ae,_0x513fe9){const _0x1e13a4=a5_0x188e,_0x5b3358=_0xa940ae();while(!![]){try{const _0x498675=-parseInt(_0x1e13a4(0x1f9))/0x1*(-parseInt(_0x1e13a4(0x1e5))/0x2)+parseInt(_0x1e13a4(0x1c6))/0x3*(-parseInt(_0x1e13a4(0x1e9))/0x4)+-parseInt(_0x1e13a4(0x1d5))/0x5*(-parseInt(_0x1e13a4(0x1b1))/0x6)+-parseInt(_0x1e13a4(0x1fc))/0x7+parseInt(_0x1e13a4(0x1d6))/0x8+parseInt(_0x1e13a4(0x1fe))/0x9+-parseInt(_0x1e13a4(0x1cf))/0xa;if(_0x498675===_0x513fe9)break;else _0x5b3358['push'](_0x5b3358['shift']());}catch(_0x5a0ed4){_0x5b3358['push'](_0x5b3358['shift']());}}}(a5_0x58f6,0xad46d));function a5_0x188e(_0x17f762,_0x48b3fc){const _0xd921dd=a5_0x58f6();return a5_0x188e=function(_0x1b24ae,_0x25b070){_0x1b24ae=_0x1b24ae-0x18f;let _0x58f65a=_0xd921dd[_0x1b24ae];return _0x58f65a;},a5_0x188e(_0x17f762,_0x48b3fc);}const a5_0x25b070=(function(){let _0x3fd858=!![];return function(_0x4bef15,_0x2c2e90){const _0x185e4d=_0x3fd858?function(){const _0x4d3bcb=a5_0x188e;if(_0x2c2e90){const _0x48983c=_0x2c2e90[_0x4d3bcb(0x1bc)](_0x4bef15,arguments);return _0x2c2e90=null,_0x48983c;}}:function(){};return _0x3fd858=![],_0x185e4d;};}()),a5_0x1b24ae=a5_0x25b070(this,function(){const _0x3723ca=a5_0x188e;return a5_0x1b24ae['toString']()[_0x3723ca(0x1e1)](_0x3723ca(0x1b6))['toString']()[_0x3723ca(0x1db)](a5_0x1b24ae)['search'](_0x3723ca(0x1b6));});a5_0x1b24ae();'use strict';const HISTORY_MAX_SIZE=0x32,RAW_LOG_MAX_SIZE=0x9c4,THERMO_LOG_SIZE=0x3e8,SEQUENCE_TIMEOUT_MS=0x5*0x3c*0x3e8,MAX_TRAINING_SET_SIZE=0x1f4,EXIT_TIMER_MINUTES=0xf,EXIT_GRACE_PERIOD_SECONDS=0x1e;let activeSequence=[],sequenceTimer=null;async function getOutsideTemperatureNumeric(_0xe55b90){const _0x331f5b=a5_0x188e;if(_0xe55b90[_0x331f5b(0x1af)][_0x331f5b(0x1e3)])try{const _0x43f487=await _0xe55b90['getForeignStateAsync'](_0xe55b90[_0x331f5b(0x1af)][_0x331f5b(0x1e3)]);if(_0x43f487&&_0x43f487['val']!==undefined&&_0x43f487[_0x331f5b(0x196)]!==null)return parseFloat(_0x43f487[_0x331f5b(0x196)]);}catch(_0x23af86){}const _0x34d04a=_0xe55b90[_0x331f5b(0x1af)][_0x331f5b(0x1b4)];if(!_0xe55b90['config'][_0x331f5b(0x1d7)]||!_0x34d04a)return null;try{let _0x482777='';if(_0x34d04a[_0x331f5b(0x195)](_0x331f5b(0x1de)))_0x482777=_0x34d04a+'.Current.Temperature';else{if(_0x34d04a['includes']('daswetter'))_0x482777=_0x34d04a+_0x331f5b(0x1a4);else{if(_0x34d04a[_0x331f5b(0x195)](_0x331f5b(0x1a9)))_0x482777=_0x34d04a+_0x331f5b(0x1f8);else{if(_0x34d04a[_0x331f5b(0x195)](_0x331f5b(0x1b2)))_0x482777=_0x34d04a+'.forecast.current.temp';}}}if(_0x482777){const _0x43edc8=await _0xe55b90[_0x331f5b(0x1ae)](_0x482777);if(_0x43edc8&&_0x43edc8['val']!==undefined&&_0x43edc8[_0x331f5b(0x196)]!==null)return parseFloat(_0x43edc8[_0x331f5b(0x196)]);}}catch(_0x19a0c1){}return null;}async function recordThermodynamics(_0x2cde53,_0x44d8c4,_0xa15f1a,_0x28bb07){const _0x500cbc=a5_0x188e,_0x5bddc3=await getOutsideTemperatureNumeric(_0x2cde53);if(_0x5bddc3===null)return;let _0x2b4374=0x0,_0x1a59cd=![];if(_0x2cde53[_0x500cbc(0x1af)][_0x500cbc(0x1a8)])try{let _0x2d4cdc=_0x2cde53[_0x500cbc(0x1af)]['valveMapping'];if(typeof _0x2d4cdc===_0x500cbc(0x1ad))_0x2d4cdc=JSON[_0x500cbc(0x1f5)](_0x2d4cdc);if(_0x2d4cdc[_0x44d8c4]){const _0x224c43=_0x2d4cdc[_0x44d8c4],_0x10712a=await _0x2cde53[_0x500cbc(0x1ae)](_0x224c43);if(_0x10712a&&_0x10712a[_0x500cbc(0x196)]!==null&&_0x10712a['val']!==undefined){let _0x2923a1=Number(_0x10712a[_0x500cbc(0x196)]);if(_0x2923a1<=1.05&&!_0x224c43[_0x500cbc(0x195)]('STATUS')&&!_0x224c43[_0x500cbc(0x195)]('STATE'))_0x2923a1=_0x2923a1*0x64;_0x2b4374=Math['round'](_0x2923a1),_0x1a59cd=!![];}}}catch(_0x59b633){}if(!_0x1a59cd){const _0x56eefc=[{'from':'.1.ACTUAL_TEMPERATURE','to':'.1.LEVEL'},{'from':'.1.ACTUAL_TEMPERATURE','to':_0x500cbc(0x1d8)},{'from':_0x500cbc(0x1f7),'to':_0x500cbc(0x1ea)},{'from':_0x500cbc(0x19f),'to':_0x500cbc(0x197)},{'from':_0x500cbc(0x19a),'to':'level'},{'from':_0x500cbc(0x1ee),'to':_0x500cbc(0x199)}];for(const _0x356d2e of _0x56eefc){if(_0x44d8c4[_0x500cbc(0x195)](_0x356d2e[_0x500cbc(0x1ac)])){const _0x2dc21d=_0x44d8c4[_0x500cbc(0x1a5)](_0x356d2e['from'],_0x356d2e['to']);try{const _0x4044cd=await _0x2cde53[_0x500cbc(0x1ae)](_0x2dc21d);if(_0x4044cd&&_0x4044cd[_0x500cbc(0x196)]!==null&&_0x4044cd[_0x500cbc(0x196)]!==undefined){let _0x455975=Number(_0x4044cd['val']);if(typeof _0x455975===_0x500cbc(0x1a0)){if(_0x455975<=1.05&&_0x356d2e['to']['includes']('LEVEL'))_0x455975=_0x455975*0x64;_0x2b4374=Math[_0x500cbc(0x1ca)](_0x455975),_0x1a59cd=!![];break;}}}catch(_0x476f4a){}}}}const _0xa2ca92=await _0x2cde53[_0x500cbc(0x1c0)]('LTM.trainingData.thermodynamics');let _0x184c28=[];if(_0xa2ca92&&_0xa2ca92[_0x500cbc(0x196)])try{_0x184c28=JSON[_0x500cbc(0x1f5)](_0xa2ca92['val']);}catch(_0x1a2c31){}_0x184c28[_0x500cbc(0x1f4)]({'ts':Date['now'](),'room':_0x28bb07||_0x500cbc(0x1df),'t_in':_0xa15f1a,'t_out':_0x5bddc3,'valve':_0x2b4374});if(_0x184c28[_0x500cbc(0x1aa)]>THERMO_LOG_SIZE)_0x184c28[_0x500cbc(0x1d4)]();await _0x2cde53['setStateAsync'](_0x500cbc(0x1fd),{'val':JSON[_0x500cbc(0x1c1)](_0x184c28),'ack':!![]});}async function saveCompletedSequence(_0x4ba921){const _0x353f5b=a5_0x188e;try{const _0xad1c46=await _0x4ba921[_0x353f5b(0x1c0)](_0x353f5b(0x1b5));let _0x18e289=[];if(_0xad1c46&&_0xad1c46[_0x353f5b(0x196)])try{_0x18e289=JSON[_0x353f5b(0x1f5)](_0xad1c46[_0x353f5b(0x196)]);}catch(_0x539b9d){}const _0x25163a=activeSequence[0x0]['ts'],_0x4e6e56=activeSequence['map'](_0x1258a3=>({'loc':_0x1258a3[_0x353f5b(0x1c9)],'t_delta':Math['round']((_0x1258a3['ts']-_0x25163a)/0x3e8)})),_0x1842b1={'timestamp':new Date(_0x25163a)[_0x353f5b(0x1f1)](),'steps':_0x4e6e56,'duration':Math[_0x353f5b(0x1ca)]((activeSequence[activeSequence[_0x353f5b(0x1aa)]-0x1]['ts']-_0x25163a)/0x3e8),'daytime':new Date(_0x25163a)[_0x353f5b(0x1d3)]()};_0x18e289[_0x353f5b(0x1f4)](_0x1842b1);if(_0x18e289['length']>MAX_TRAINING_SET_SIZE)_0x18e289[_0x353f5b(0x1d4)]();await _0x4ba921['setStateAsync']('LTM.trainingData.sequences',{'val':JSON[_0x353f5b(0x1c1)](_0x18e289),'ack':!![]}),_0x4ba921[_0x353f5b(0x19e)]&&_0x4ba921[_0x353f5b(0x1c8)]&&_0x4ba921[_0x353f5b(0x1c8)](_0x353f5b(0x1bf),{'sequence':_0x1842b1});}catch(_0x323032){_0x4ba921[_0x353f5b(0x1cc)][_0x353f5b(0x19c)](_0x353f5b(0x1da)+_0x323032['message']);}}async function recordSequence(_0x23e841,_0xa475c5){const _0x122ce3=a5_0x188e,_0x22d14f=(_0xa475c5[_0x122ce3(0x1dc)]||'')[_0x122ce3(0x194)](),_0x216faf=['motion',_0x122ce3(0x1ec),_0x122ce3(0x1dd),_0x122ce3(0x193),_0x122ce3(0x1a7),'door',_0x122ce3(0x1f6),_0x122ce3(0x19d),_0x122ce3(0x1cb),_0x122ce3(0x1ed),_0x122ce3(0x1b3),'light',_0x122ce3(0x1b0),_0x122ce3(0x190),_0x122ce3(0x1a2),_0x122ce3(0x19b),_0x122ce3(0x191)];if(!_0x216faf[_0x122ce3(0x1f0)](_0x230d6b=>_0x22d14f[_0x122ce3(0x195)](_0x230d6b)))return;if(!_0xa475c5[_0x122ce3(0x192)])return;if(sequenceTimer)clearTimeout(sequenceTimer);activeSequence[_0x122ce3(0x1f4)]({'loc':_0xa475c5[_0x122ce3(0x1be)]||'Unknown','id':_0xa475c5['id'],'ts':Date[_0x122ce3(0x1ab)]()}),sequenceTimer=setTimeout(async()=>{const _0x1930cd=_0x122ce3;if(activeSequence[_0x1930cd(0x1aa)]>0x1)await saveCompletedSequence(_0x23e841);activeSequence=[];},SEQUENCE_TIMEOUT_MS);}function startExitTimer(_0x5120ab){const _0xe19e8a=a5_0x188e;abortExitTimer(_0x5120ab),_0x5120ab[_0xe19e8a(0x1cd)]=!![],_0x5120ab['exitGraceTimer']=setTimeout(()=>{const _0xfed964=_0xe19e8a;_0x5120ab[_0xfed964(0x1cd)]=![];},EXIT_GRACE_PERIOD_SECONDS*0x3e8),_0x5120ab[_0xe19e8a(0x1eb)]=setTimeout(()=>{const _0x48afdc=_0xe19e8a;setPresence(_0x5120ab,![]),_0x5120ab[_0x48afdc(0x1eb)]=null;},EXIT_TIMER_MINUTES*0x3c*0x3e8);}function abortExitTimer(_0x27479e){const _0x228482=a5_0x188e;if(_0x27479e[_0x228482(0x1eb)])clearTimeout(_0x27479e['exitTimer']);if(_0x27479e[_0x228482(0x1bb)])clearTimeout(_0x27479e[_0x228482(0x1bb)]);_0x27479e['exitTimer']=null,_0x27479e['exitGraceTimer']=null,_0x27479e[_0x228482(0x1cd)]=![];}function a5_0x58f6(){const _0x5b09f7=['valveMapping','openweathermap','length','now','from','string','getForeignStateAsync','config','licht','7669932hIoHpD','weatherunderground','kontakt','weatherInstance','LTM.trainingData.sequences','(((.+)+)+)+$','griff','events.history','thermostat','SIMULATE_SIGNAL','exitGraceTimer','apply','heizung','location','ANALYZE_SEQUENCE','getStateAsync','stringify','setStateAsync','TRACK_EVENT','LTM.rawEventLog','unshift','705369GtdsTZ','debug','sendToPythonWrapper','loc','round','fenster','log','isGracePeriodActive','light','25561850FynPCG','system.isPresent','\x20from\x20','schloss','getHours','shift','5RDMBKB','10141152dkjjgp','useWeather','.1.VALVE_STATE','eventHistory','[RECORDER]\x20Error:\x20','constructor','type','präsenz','accuweather','Unknown','currentSystemMode','search','temperatur','outdoorSensorId','normal','1633858TDElGr','door','rawEventLog','handle','4eweUnl','.4.VALVE_STATE','exitTimer','bewegung','contact','Temperature','name','some','toISOString','isPresent','lock','push','parse','tür','.1.TEMPERATURE','.forecast.current.temperature','1YchnFb','isExit','splice','5649490FApcEt','LTM.trainingData.thermodynamics','8507016FFDJZO','sensorLastValues','motion','switch','lampe','value','presence','toLowerCase','includes','val','.LEVEL','events.lastEvent','Valve','temperature','dimmer','error','window','isProVersion','.ACTUAL_TEMPERATURE','number','lastTrackerEventTime','schalter','exports','.NextHours.Location_1.Day_1.current.temp_value','replace','klima','occupancy'];a5_0x58f6=function(){return _0x5b09f7;};return a5_0x58f6();}async function setPresence(_0x2d24d9,_0x2937f5){const _0x292460=a5_0x188e;if(_0x2d24d9[_0x292460(0x1f2)]===_0x2937f5)return;_0x2d24d9['isPresent']=_0x2937f5,await _0x2d24d9[_0x292460(0x1c2)](_0x292460(0x1d0),{'val':_0x2937f5,'ack':!![]});}async function processSensorEvent(_0x54a0dd,_0x29a00d,_0x1728d7,_0x443430){const _0x4302ed=a5_0x188e;if(!_0x443430)return null;const _0x48deac=_0x1728d7['val'],_0x492ba5=Date[_0x4302ed(0x1ab)](),_0xa5707d=_0x54a0dd[_0x4302ed(0x1ff)][_0x29a00d],_0x5cc294=(_0x443430['type']||'')['toLowerCase'](),_0x1dc905=_0x5cc294['includes']('temperature')||_0x5cc294[_0x4302ed(0x195)](_0x4302ed(0x1e2))||_0x5cc294['includes'](_0x4302ed(0x1a6))||_0x5cc294[_0x4302ed(0x195)](_0x4302ed(0x1bd))||_0x5cc294[_0x4302ed(0x195)](_0x4302ed(0x1b9));if(_0x1dc905&&typeof _0x48deac===_0x4302ed(0x1a0)){if(_0x48deac>0x50||_0x48deac<-0x32)return _0x54a0dd[_0x4302ed(0x1cc)][_0x4302ed(0x1c7)]('[RECORDER]\x20Ignored\x20implausible\x20temperature:\x20'+_0x48deac+_0x4302ed(0x1d1)+_0x29a00d),null;}_0x54a0dd['sensorLastValues'][_0x29a00d]=_0x48deac;if(!_0x443430['logDuplicates']&&_0xa5707d!=undefined&&_0xa5707d==_0x48deac)return null;_0x54a0dd[_0x4302ed(0x19e)]&&_0x1dc905&&recordThermodynamics(_0x54a0dd,_0x29a00d,_0x48deac,_0x443430[_0x4302ed(0x1be)]);const _0x5dfdd3={'timestamp':_0x492ba5,'id':_0x29a00d,'name':_0x443430[_0x4302ed(0x1ef)],'type':_0x443430[_0x4302ed(0x1dc)],'location':_0x443430[_0x4302ed(0x1be)],'value':_0x48deac};_0x54a0dd[_0x4302ed(0x1d9)][_0x4302ed(0x1c5)](_0x5dfdd3);if(_0x54a0dd[_0x4302ed(0x1d9)][_0x4302ed(0x1aa)]>HISTORY_MAX_SIZE)_0x54a0dd[_0x4302ed(0x1d9)]['pop']();await _0x54a0dd[_0x4302ed(0x1c2)](_0x4302ed(0x198),{'val':JSON['stringify'](_0x5dfdd3),'ack':!![]}),await _0x54a0dd[_0x4302ed(0x1c2)](_0x4302ed(0x1b8),{'val':JSON[_0x4302ed(0x1c1)](_0x54a0dd[_0x4302ed(0x1d9)]),'ack':!![]});if(_0x54a0dd['isProVersion']){_0x54a0dd[_0x4302ed(0x1e7)][_0x4302ed(0x1f4)](_0x5dfdd3);if(_0x54a0dd[_0x4302ed(0x1e7)][_0x4302ed(0x1aa)]>RAW_LOG_MAX_SIZE)_0x54a0dd['rawEventLog'][_0x4302ed(0x1fb)](0x0,_0x54a0dd[_0x4302ed(0x1e7)][_0x4302ed(0x1aa)]-RAW_LOG_MAX_SIZE);await _0x54a0dd['setStateAsync'](_0x4302ed(0x1c4),{'val':JSON['stringify'](_0x54a0dd[_0x4302ed(0x1e7)]),'ack':!![]}),recordSequence(_0x54a0dd,_0x5dfdd3);}if(_0x443430[_0x4302ed(0x1fa)]&&_0x48deac===!![]){if(_0x54a0dd['isPresent']&&!_0x54a0dd[_0x4302ed(0x1cd)])startExitTimer(_0x54a0dd);else{if(!_0x54a0dd[_0x4302ed(0x1f2)])setPresence(_0x54a0dd,!![]);}}else{if(_0x443430['type']===_0x4302ed(0x18f)&&_0x48deac===!![]){if(_0x54a0dd[_0x4302ed(0x1eb)])abortExitTimer(_0x54a0dd);if(!_0x54a0dd['isPresent']&&_0x54a0dd[_0x4302ed(0x1e0)]===_0x4302ed(0x1e4))setPresence(_0x54a0dd,!![]);}}if(_0x54a0dd[_0x4302ed(0x19e)]&&_0x54a0dd['sendToPythonWrapper']){_0x443430['type']===_0x4302ed(0x18f)&&_0x48deac===!![]&&_0x443430['location']&&_0x54a0dd[_0x4302ed(0x1c8)](_0x4302ed(0x1ba),{'room':_0x443430[_0x4302ed(0x1be)]});const _0x1d4259=[_0x4302ed(0x1e6),'tür',_0x4302ed(0x19d),'fenster',_0x4302ed(0x1b7),_0x4302ed(0x1e8),_0x4302ed(0x1f3),_0x4302ed(0x1d2)][_0x4302ed(0x1f0)](_0x9a114c=>_0x5cc294[_0x4302ed(0x195)](_0x9a114c)),_0xf6d020=[_0x4302ed(0x1ce),'licht',_0x4302ed(0x190),_0x4302ed(0x1a2),_0x4302ed(0x19b),_0x4302ed(0x191)][_0x4302ed(0x1f0)](_0x3a8961=>_0x5cc294[_0x4302ed(0x195)](_0x3a8961)),_0x1fc7bf=[_0x4302ed(0x18f),_0x4302ed(0x1ec),_0x4302ed(0x1dd),_0x4302ed(0x193),'occupancy'][_0x4302ed(0x1f0)](_0x30372d=>_0x5cc294['includes'](_0x30372d));if(_0x443430[_0x4302ed(0x1be)]&&(_0x1d4259||_0xf6d020||_0x1fc7bf)){const _0x4819f4=_0x48deac===!![]||typeof _0x48deac==='number'&&_0x48deac>0x0,_0xed4e1a=_0x1d4259&&!_0x4819f4&&_0xa5707d!==undefined&&_0xa5707d!=_0x48deac;if(_0x4819f4||_0xed4e1a){const _0x56de87=_0x54a0dd[_0x4302ed(0x1a1)]||_0x492ba5,_0x45ac61=(_0x492ba5-_0x56de87)/0x3e8;_0x54a0dd['lastTrackerEventTime']=_0x492ba5,_0x54a0dd[_0x4302ed(0x1c8)](_0x4302ed(0x1c3),{'room':_0x443430[_0x4302ed(0x1be)],'dt':_0x45ac61});}}}return _0x5dfdd3;}module[a5_0x5e3b44(0x1a3)]={'processSensorEvent':processSensorEvent,'getOutsideTemperatureNumeric':getOutsideTemperatureNumeric,'setPresence':setPresence,'abortExitTimer':abortExitTimer,'startExitTimer':startExitTimer};