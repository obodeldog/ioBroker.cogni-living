const a5_0x1abd17=a5_0x49b8;(function(_0xdb5717,_0x12f2f9){const _0x342da2=a5_0x49b8,_0x17f2a9=_0xdb5717();while(!![]){try{const _0x49494d=parseInt(_0x342da2(0x214))/0x1*(parseInt(_0x342da2(0x1f3))/0x2)+parseInt(_0x342da2(0x1cc))/0x3*(-parseInt(_0x342da2(0x20b))/0x4)+-parseInt(_0x342da2(0x1ba))/0x5+parseInt(_0x342da2(0x1fb))/0x6+-parseInt(_0x342da2(0x200))/0x7*(parseInt(_0x342da2(0x1e7))/0x8)+parseInt(_0x342da2(0x1d4))/0x9+-parseInt(_0x342da2(0x226))/0xa;if(_0x49494d===_0x12f2f9)break;else _0x17f2a9['push'](_0x17f2a9['shift']());}catch(_0x2e295f){_0x17f2a9['push'](_0x17f2a9['shift']());}}}(a5_0x312a,0x56179));function a5_0x49b8(_0x39c4c4,_0x1358cc){const _0x3708f3=a5_0x312a();return a5_0x49b8=function(_0x564bc8,_0x40a267){_0x564bc8=_0x564bc8-0x1b2;let _0x312a3c=_0x3708f3[_0x564bc8];return _0x312a3c;},a5_0x49b8(_0x39c4c4,_0x1358cc);}const a5_0x40a267=(function(){let _0x247a00=!![];return function(_0x306bed,_0x223c3e){const _0x4de636=_0x247a00?function(){if(_0x223c3e){const _0x58ba8b=_0x223c3e['apply'](_0x306bed,arguments);return _0x223c3e=null,_0x58ba8b;}}:function(){};return _0x247a00=![],_0x4de636;};}()),a5_0x564bc8=a5_0x40a267(this,function(){const _0xa26b1e=a5_0x49b8;return a5_0x564bc8[_0xa26b1e(0x1d1)]()[_0xa26b1e(0x1be)](_0xa26b1e(0x1b3))['toString']()[_0xa26b1e(0x1d7)](a5_0x564bc8)['search']('(((.+)+)+)+$');});function a5_0x312a(){const _0x4086b3=['präsenz','.1.VALVE_STATE','some','location','ANALYZE_SEQUENCE','schalter','stringify','exports','getStateAsync','.1.ACTUAL_TEMPERATURE','isProVersion','136856mVRVgY','logDuplicates','.4.VALVE_STATE','SIMULATE_SIGNAL','LTM.trainingData.sequences','.forecast.current.temp','window','Unknown','events.lastEvent','schloss','level','weatherunderground','18358DvIsrj','.forecast.current.temperature','fill','config','openweathermap','eventHistory','normal','[RECORDER]\x20Ignored\x20implausible\x20temperature:\x20','3827658RNibbK','.1.TEMPERATURE','length','thermostat','log','105LlatsQ','replace','now','string','TRACK_EVENT','toISOString','STATE','useWeather','exitGraceTimer','error','message','1104156DxVWfa','motion','kontakt','round','switch','tür','debug','light','valveMapping','65kpZtAr','sensorLastValues','accuweather','.Current.Temperature','shift','klima','getHours','currentSystemMode','includes','value','weatherInstance','[RECORDER]\x20Error:\x20','.ACTUAL_TEMPERATURE','isPresent','lock','events.history','Valve','sendToPythonWrapper','3958960zJLbIF','loc','val','door','(((.+)+)+)+$','lampe','parse','number','splice','map','getDate','2576165KtCiQU','temperature','dimmer','LTM.trainingData.thermodynamics','search','griff','getForeignStateAsync','occupancy','Temperature','STATUS','LEVEL','isGracePeriodActive','outdoorSensorId','licht','rawEventLog','exitTimer','.NextHours.Location_1.Day_1.current.temp_value','.LEVEL','3NxgdLB','isExit','fenster','toLowerCase','LTM.rawEventLog','toString','pop','daswetter','5056452ugcbEh','from','setStateAsync','constructor','presence','handle','type','push'];a5_0x312a=function(){return _0x4086b3;};return a5_0x312a();}a5_0x564bc8();'use strict';const HISTORY_MAX_SIZE=0x32,RAW_LOG_MAX_SIZE=0x9c4,THERMO_LOG_SIZE=0x3e8,SEQUENCE_TIMEOUT_MS=0x5*0x3c*0x3e8,MAX_TRAINING_SET_SIZE=0x1f4,EXIT_TIMER_MINUTES=0xf,EXIT_GRACE_PERIOD_SECONDS=0x1e;let activeSequence=[],sequenceTimer=null;async function getOutsideTemperatureNumeric(_0x270090){const _0x2f2d81=a5_0x49b8;if(_0x270090['config'][_0x2f2d81(0x1c6)])try{const _0x44ebb7=await _0x270090[_0x2f2d81(0x1c0)](_0x270090[_0x2f2d81(0x1f6)]['outdoorSensorId']);if(_0x44ebb7&&_0x44ebb7[_0x2f2d81(0x228)]!==undefined&&_0x44ebb7[_0x2f2d81(0x228)]!==null)return parseFloat(_0x44ebb7[_0x2f2d81(0x228)]);}catch(_0x5502ae){}const _0x203260=_0x270090[_0x2f2d81(0x1f6)][_0x2f2d81(0x21e)];if(!_0x270090['config'][_0x2f2d81(0x207)]||!_0x203260)return null;try{let _0x331623='';if(_0x203260[_0x2f2d81(0x21c)](_0x2f2d81(0x216)))_0x331623=_0x203260+_0x2f2d81(0x217);else{if(_0x203260[_0x2f2d81(0x21c)](_0x2f2d81(0x1d3)))_0x331623=_0x203260+_0x2f2d81(0x1ca);else{if(_0x203260[_0x2f2d81(0x21c)](_0x2f2d81(0x1f7)))_0x331623=_0x203260+_0x2f2d81(0x1f4);else{if(_0x203260[_0x2f2d81(0x21c)](_0x2f2d81(0x1f2)))_0x331623=_0x203260+_0x2f2d81(0x1ec);}}}if(_0x331623){const _0x243437=await _0x270090[_0x2f2d81(0x1c0)](_0x331623);if(_0x243437&&_0x243437[_0x2f2d81(0x228)]!==undefined&&_0x243437['val']!==null)return parseFloat(_0x243437[_0x2f2d81(0x228)]);}}catch(_0x32f905){}return null;}async function recordThermodynamics(_0x34b1be,_0x39726b,_0x2a5117,_0x3b6471){const _0x56eacc=a5_0x49b8,_0x321f0e=await getOutsideTemperatureNumeric(_0x34b1be);if(_0x321f0e===null)return;let _0x2fcbc6=0x0,_0x584170=![];if(_0x34b1be[_0x56eacc(0x1f6)][_0x56eacc(0x213)])try{let _0xcc94f7=_0x34b1be['config'][_0x56eacc(0x213)];if(typeof _0xcc94f7===_0x56eacc(0x203))_0xcc94f7=JSON[_0x56eacc(0x1b5)](_0xcc94f7);if(_0xcc94f7[_0x39726b]){const _0x1db942=_0xcc94f7[_0x39726b],_0x391563=await _0x34b1be[_0x56eacc(0x1c0)](_0x1db942);if(_0x391563&&_0x391563[_0x56eacc(0x228)]!==null&&_0x391563[_0x56eacc(0x228)]!==undefined){let _0x5527df=Number(_0x391563['val']);if(_0x5527df<=1.05&&!_0x1db942[_0x56eacc(0x21c)](_0x56eacc(0x1c3))&&!_0x1db942[_0x56eacc(0x21c)](_0x56eacc(0x206)))_0x5527df=_0x5527df*0x64;_0x2fcbc6=Math[_0x56eacc(0x20e)](_0x5527df),_0x584170=!![];}}}catch(_0x158d4e){}if(!_0x584170){const _0x35a9d0=[{'from':_0x56eacc(0x1e5),'to':'.1.LEVEL'},{'from':_0x56eacc(0x1e5),'to':_0x56eacc(0x1dd)},{'from':_0x56eacc(0x1fc),'to':_0x56eacc(0x1e9)},{'from':_0x56eacc(0x220),'to':_0x56eacc(0x1cb)},{'from':_0x56eacc(0x1bb),'to':_0x56eacc(0x1f1)},{'from':_0x56eacc(0x1c2),'to':_0x56eacc(0x224)}];for(const _0x2fd5d2 of _0x35a9d0){if(_0x39726b[_0x56eacc(0x21c)](_0x2fd5d2['from'])){const _0x16a831=_0x39726b[_0x56eacc(0x201)](_0x2fd5d2[_0x56eacc(0x1d5)],_0x2fd5d2['to']);try{const _0x909734=await _0x34b1be[_0x56eacc(0x1c0)](_0x16a831);if(_0x909734&&_0x909734[_0x56eacc(0x228)]!==null&&_0x909734[_0x56eacc(0x228)]!==undefined){let _0x559ba0=Number(_0x909734[_0x56eacc(0x228)]);if(typeof _0x559ba0===_0x56eacc(0x1b6)){if(_0x559ba0<=1.05&&_0x2fd5d2['to'][_0x56eacc(0x21c)](_0x56eacc(0x1c4)))_0x559ba0=_0x559ba0*0x64;_0x2fcbc6=Math[_0x56eacc(0x20e)](_0x559ba0),_0x584170=!![];break;}}}catch(_0x5040d8){}}}}const _0x119b7b=await _0x34b1be[_0x56eacc(0x1e4)](_0x56eacc(0x1bd));let _0x1ed4db=[];if(_0x119b7b&&_0x119b7b[_0x56eacc(0x228)])try{_0x1ed4db=JSON['parse'](_0x119b7b['val']);}catch(_0x1fe1fa){}_0x1ed4db[_0x56eacc(0x1db)]({'ts':Date[_0x56eacc(0x202)](),'room':_0x3b6471||'Unknown','t_in':_0x2a5117,'t_out':_0x321f0e,'valve':_0x2fcbc6});if(_0x1ed4db[_0x56eacc(0x1fd)]>THERMO_LOG_SIZE)_0x1ed4db[_0x56eacc(0x218)]();await _0x34b1be[_0x56eacc(0x1d6)](_0x56eacc(0x1bd),{'val':JSON[_0x56eacc(0x1e2)](_0x1ed4db),'ack':!![]});}async function saveCompletedSequence(_0x5427ac){const _0x5b9263=a5_0x49b8;try{const _0x2fe533=await _0x5427ac[_0x5b9263(0x1e4)](_0x5b9263(0x1eb));let _0x5c3721=[];if(_0x2fe533&&_0x2fe533['val'])try{_0x5c3721=JSON[_0x5b9263(0x1b5)](_0x2fe533[_0x5b9263(0x228)]);}catch(_0x43563f){}const _0x3deb54=activeSequence[0x0]['ts'],_0x30a872=activeSequence[_0x5b9263(0x1b8)](_0x513cc3=>({'loc':_0x513cc3[_0x5b9263(0x227)],'t_delta':Math[_0x5b9263(0x20e)]((_0x513cc3['ts']-_0x3deb54)/0x3e8)})),_0x38ed21={'timestamp':new Date(_0x3deb54)[_0x5b9263(0x205)](),'steps':_0x30a872,'duration':Math[_0x5b9263(0x20e)]((activeSequence[activeSequence[_0x5b9263(0x1fd)]-0x1]['ts']-_0x3deb54)/0x3e8),'daytime':new Date(_0x3deb54)[_0x5b9263(0x21a)]()};_0x5c3721['push'](_0x38ed21);if(_0x5c3721[_0x5b9263(0x1fd)]>MAX_TRAINING_SET_SIZE)_0x5c3721[_0x5b9263(0x218)]();await _0x5427ac[_0x5b9263(0x1d6)](_0x5b9263(0x1eb),{'val':JSON[_0x5b9263(0x1e2)](_0x5c3721),'ack':!![]}),_0x5427ac['isProVersion']&&_0x5427ac['sendToPythonWrapper']&&_0x5427ac[_0x5b9263(0x225)](_0x5b9263(0x1e0),{'sequence':_0x38ed21});}catch(_0x3a1e94){_0x5427ac[_0x5b9263(0x1ff)][_0x5b9263(0x209)](_0x5b9263(0x21f)+_0x3a1e94[_0x5b9263(0x20a)]);}}async function recordSequence(_0x39088b,_0x44995a){const _0x2b14fc=a5_0x49b8,_0x286486=(_0x44995a[_0x2b14fc(0x1da)]||'')[_0x2b14fc(0x1cf)](),_0x167ab0=[_0x2b14fc(0x20c),'bewegung',_0x2b14fc(0x1dc),_0x2b14fc(0x1d8),_0x2b14fc(0x1c1),_0x2b14fc(0x1b2),_0x2b14fc(0x210),_0x2b14fc(0x1ed),_0x2b14fc(0x1ce),'contact',_0x2b14fc(0x20d),_0x2b14fc(0x212),_0x2b14fc(0x1c7),_0x2b14fc(0x20f),_0x2b14fc(0x1e1),_0x2b14fc(0x1bc),_0x2b14fc(0x1b4)];if(!_0x167ab0[_0x2b14fc(0x1de)](_0x453795=>_0x286486['includes'](_0x453795)))return;if(!_0x44995a[_0x2b14fc(0x21d)])return;if(sequenceTimer)clearTimeout(sequenceTimer);activeSequence[_0x2b14fc(0x1db)]({'loc':_0x44995a[_0x2b14fc(0x1df)]||_0x2b14fc(0x1ee),'id':_0x44995a['id'],'ts':Date[_0x2b14fc(0x202)]()}),sequenceTimer=setTimeout(async()=>{const _0x359e71=_0x2b14fc;if(activeSequence[_0x359e71(0x1fd)]>0x1)await saveCompletedSequence(_0x39088b);activeSequence=[];},SEQUENCE_TIMEOUT_MS);}function startExitTimer(_0x25d6ed){const _0xe5cd2a=a5_0x49b8;abortExitTimer(_0x25d6ed),_0x25d6ed[_0xe5cd2a(0x1c5)]=!![],_0x25d6ed[_0xe5cd2a(0x208)]=setTimeout(()=>{_0x25d6ed['isGracePeriodActive']=![];},EXIT_GRACE_PERIOD_SECONDS*0x3e8),_0x25d6ed[_0xe5cd2a(0x1c9)]=setTimeout(()=>{const _0xbbbebd=_0xe5cd2a;setPresence(_0x25d6ed,![]),_0x25d6ed[_0xbbbebd(0x1c9)]=null;},EXIT_TIMER_MINUTES*0x3c*0x3e8);}function abortExitTimer(_0x5bfe27){const _0x2cda2e=a5_0x49b8;if(_0x5bfe27['exitTimer'])clearTimeout(_0x5bfe27[_0x2cda2e(0x1c9)]);if(_0x5bfe27[_0x2cda2e(0x208)])clearTimeout(_0x5bfe27[_0x2cda2e(0x208)]);_0x5bfe27['exitTimer']=null,_0x5bfe27[_0x2cda2e(0x208)]=null,_0x5bfe27['isGracePeriodActive']=![];}async function setPresence(_0x3febfa,_0xb5b47d){const _0x325c66=a5_0x49b8;if(_0x3febfa[_0x325c66(0x221)]===_0xb5b47d)return;_0x3febfa[_0x325c66(0x221)]=_0xb5b47d,await _0x3febfa[_0x325c66(0x1d6)]('system.isPresent',{'val':_0xb5b47d,'ack':!![]});}async function updateHourlyActivity(_0x55a23c){const _0x5f18c4=a5_0x49b8;let _0x1f5086=new Array(0x18)[_0x5f18c4(0x1f5)](0x0),_0x310a6f=0x0;try{const _0x20dce7=await _0x55a23c[_0x5f18c4(0x1e4)]('analysis.health.todayVector');_0x20dce7&&_0x20dce7[_0x5f18c4(0x228)]&&(_0x1f5086=JSON[_0x5f18c4(0x1b5)](_0x20dce7['val']),_0x310a6f=_0x20dce7['ts']);}catch(_0x5863fb){}const _0x2e54e0=new Date(_0x310a6f),_0x3e71ec=new Date();_0x2e54e0['getDate']()!==_0x3e71ec[_0x5f18c4(0x1b9)]()&&(_0x1f5086=new Array(0x18)[_0x5f18c4(0x1f5)](0x0));const _0x890851=_0x3e71ec[_0x5f18c4(0x21a)]();if(_0x1f5086[_0x890851]===undefined)_0x1f5086[_0x890851]=0x0;_0x1f5086[_0x890851]++,await _0x55a23c[_0x5f18c4(0x1d6)]('analysis.health.todayVector',{'val':JSON['stringify'](_0x1f5086),'ack':!![]});}async function processSensorEvent(_0x47143f,_0x19c2cc,_0x1b0cb4,_0x3f47ab){const _0xec659e=a5_0x49b8;if(!_0x3f47ab)return null;const _0x678066=_0x1b0cb4[_0xec659e(0x228)],_0x49dbcd=Date['now'](),_0x133828=_0x47143f[_0xec659e(0x215)][_0x19c2cc],_0x47aa25=(_0x3f47ab[_0xec659e(0x1da)]||'')['toLowerCase'](),_0x3731de=_0x47aa25['includes']('temperature')||_0x47aa25[_0xec659e(0x21c)]('temperatur')||_0x47aa25[_0xec659e(0x21c)](_0xec659e(0x219))||_0x47aa25['includes']('heizung')||_0x47aa25['includes'](_0xec659e(0x1fe));if(_0x3731de&&typeof _0x678066===_0xec659e(0x1b6)){if(_0x678066>0x50||_0x678066<-0x32)return _0x47143f[_0xec659e(0x1ff)][_0xec659e(0x211)](_0xec659e(0x1fa)+_0x678066+'\x20from\x20'+_0x19c2cc),null;}_0x47143f[_0xec659e(0x215)][_0x19c2cc]=_0x678066;if(!_0x3f47ab[_0xec659e(0x1e8)]&&_0x133828!=undefined&&_0x133828==_0x678066)return null;_0x47143f['isProVersion']&&_0x3731de&&recordThermodynamics(_0x47143f,_0x19c2cc,_0x678066,_0x3f47ab[_0xec659e(0x1df)]);const _0xf09c9e={'timestamp':_0x49dbcd,'id':_0x19c2cc,'name':_0x3f47ab['name'],'type':_0x3f47ab['type'],'location':_0x3f47ab[_0xec659e(0x1df)],'value':_0x678066};_0x47143f['eventHistory']['unshift'](_0xf09c9e);if(_0x47143f[_0xec659e(0x1f8)][_0xec659e(0x1fd)]>HISTORY_MAX_SIZE)_0x47143f['eventHistory'][_0xec659e(0x1d2)]();await _0x47143f[_0xec659e(0x1d6)](_0xec659e(0x1ef),{'val':JSON[_0xec659e(0x1e2)](_0xf09c9e),'ack':!![]}),await _0x47143f['setStateAsync'](_0xec659e(0x223),{'val':JSON['stringify'](_0x47143f[_0xec659e(0x1f8)]),'ack':!![]}),await updateHourlyActivity(_0x47143f);if(_0x47143f[_0xec659e(0x1e6)]){_0x47143f[_0xec659e(0x1c8)][_0xec659e(0x1db)](_0xf09c9e);if(_0x47143f[_0xec659e(0x1c8)][_0xec659e(0x1fd)]>RAW_LOG_MAX_SIZE)_0x47143f[_0xec659e(0x1c8)][_0xec659e(0x1b7)](0x0,_0x47143f[_0xec659e(0x1c8)]['length']-RAW_LOG_MAX_SIZE);await _0x47143f['setStateAsync'](_0xec659e(0x1d0),{'val':JSON[_0xec659e(0x1e2)](_0x47143f[_0xec659e(0x1c8)]),'ack':!![]}),recordSequence(_0x47143f,_0xf09c9e);}if(_0x3f47ab[_0xec659e(0x1cd)]&&_0x678066===!![]){if(_0x47143f[_0xec659e(0x221)]&&!_0x47143f[_0xec659e(0x1c5)])startExitTimer(_0x47143f);else{if(!_0x47143f[_0xec659e(0x221)])setPresence(_0x47143f,!![]);}}else{if(_0x3f47ab[_0xec659e(0x1da)]===_0xec659e(0x20c)&&_0x678066===!![]){if(_0x47143f['exitTimer'])abortExitTimer(_0x47143f);if(!_0x47143f[_0xec659e(0x221)]&&_0x47143f[_0xec659e(0x21b)]===_0xec659e(0x1f9))setPresence(_0x47143f,!![]);}}if(_0x47143f['isProVersion']&&_0x47143f[_0xec659e(0x225)]){_0x3f47ab[_0xec659e(0x1da)]==='motion'&&_0x678066===!![]&&_0x3f47ab['location']&&_0x47143f['sendToPythonWrapper'](_0xec659e(0x1ea),{'room':_0x3f47ab['location']});const _0x5586fd=[_0xec659e(0x1b2),_0xec659e(0x210),_0xec659e(0x1ed),_0xec659e(0x1ce),_0xec659e(0x1bf),_0xec659e(0x1d9),_0xec659e(0x222),_0xec659e(0x1f0)][_0xec659e(0x1de)](_0x59de24=>_0x47aa25[_0xec659e(0x21c)](_0x59de24)),_0x41f369=[_0xec659e(0x212),'licht',_0xec659e(0x20f),_0xec659e(0x1e1),_0xec659e(0x1bc),_0xec659e(0x1b4)][_0xec659e(0x1de)](_0x1fa8b5=>_0x47aa25['includes'](_0x1fa8b5)),_0x1eceab=['motion','bewegung','präsenz',_0xec659e(0x1d8),'occupancy'][_0xec659e(0x1de)](_0xa6f9c=>_0x47aa25[_0xec659e(0x21c)](_0xa6f9c));if(_0x3f47ab[_0xec659e(0x1df)]&&(_0x5586fd||_0x41f369||_0x1eceab)){const _0x44db82=_0x678066===!![]||typeof _0x678066===_0xec659e(0x1b6)&&_0x678066>0x0,_0x19f738=_0x5586fd&&!_0x44db82&&_0x133828!==undefined&&_0x133828!=_0x678066;if(_0x44db82||_0x19f738){const _0x2dd8d4=_0x47143f['lastTrackerEventTime']||_0x49dbcd,_0x9515e2=(_0x49dbcd-_0x2dd8d4)/0x3e8;_0x47143f['lastTrackerEventTime']=_0x49dbcd,_0x47143f[_0xec659e(0x225)](_0xec659e(0x204),{'room':_0x3f47ab['location'],'dt':_0x9515e2});}}}return _0xf09c9e;}module[a5_0x1abd17(0x1e3)]={'processSensorEvent':processSensorEvent,'getOutsideTemperatureNumeric':getOutsideTemperatureNumeric,'setPresence':setPresence,'abortExitTimer':abortExitTimer,'startExitTimer':startExitTimer};