(function(_0x24064e,_0x56d525){const _0x4faa25=a5_0x34a2,_0x6e93d0=_0x24064e();while(!![]){try{const _0x9a2ec2=-parseInt(_0x4faa25(0x152))/0x1+parseInt(_0x4faa25(0x155))/0x2*(parseInt(_0x4faa25(0x116))/0x3)+parseInt(_0x4faa25(0x15e))/0x4*(-parseInt(_0x4faa25(0x141))/0x5)+parseInt(_0x4faa25(0x12d))/0x6+-parseInt(_0x4faa25(0x140))/0x7+parseInt(_0x4faa25(0x11b))/0x8+-parseInt(_0x4faa25(0x121))/0x9*(parseInt(_0x4faa25(0x11c))/0xa);if(_0x9a2ec2===_0x56d525)break;else _0x6e93d0['push'](_0x6e93d0['shift']());}catch(_0x379e6e){_0x6e93d0['push'](_0x6e93d0['shift']());}}}(a5_0x4784,0x346cd));const a5_0x22eeca=(function(){let _0x1bc7ee=!![];return function(_0xdfa0a2,_0xa107ae){const _0x2e5019=_0x1bc7ee?function(){const _0x33cd37=a5_0x34a2;if(_0xa107ae){const _0x272829=_0xa107ae[_0x33cd37(0x136)](_0xdfa0a2,arguments);return _0xa107ae=null,_0x272829;}}:function(){};return _0x1bc7ee=![],_0x2e5019;};}()),a5_0x345e3b=a5_0x22eeca(this,function(){const _0x336456=a5_0x34a2;return a5_0x345e3b[_0x336456(0x16b)]()['search'](_0x336456(0x13d))[_0x336456(0x16b)]()[_0x336456(0x158)](a5_0x345e3b)[_0x336456(0x115)](_0x336456(0x13d));});function a5_0x4784(){const _0x24af53=['[RECORDER]\x20Error:\x20','LTM.trainingData.thermodynamics','präsenz','exitGraceTimer','.1.ACTUAL_TEMPERATURE','search','1572nuEdFk','error','some','isPresent','.forecast.current.temperature','1529288DRHlEJ','110gGItbI','LTM.trainingData.sequences','loc','kontakt','hm-rpc','174807ojsHkI','.1.TEMPERATURE','getStateAsync','stringify','parse','light','exitTimer','toISOString','useWeather','system.isPresent','from','getHours','1549782gvtymC','now','.Current.Temperature','map','logDuplicates','.forecast.current.temp','weatherInstance','currentSystemMode','type','apply','replace','getForeignStateAsync','unshift','daswetter','motion','isProVersion','(((.+)+)+)+$','switch','rawEventLog','182630qTcBRv','7450cfMuGv','ANALYZE_SEQUENCE','.ACTUAL_TEMPERATURE','.1.VALVE_STATE','weatherunderground','name','tür','window','shift','eventHistory','SIMULATE_SIGNAL','schalter','.LEVEL','klima','length','sensorLastValues','pop','219922qPYiGG','Unknown','push','1450ZTKnWA','isGracePeriodActive','door','constructor','includes','events.history','licht','setStateAsync','round','416rQjDun','outdoorSensorId','location','sendToPythonWrapper','lampe','number','val','fenster','temperature','contact','heizung','log','.NextHours.Location_1.Day_1.current.temp_value','toString','config','value','message'];a5_0x4784=function(){return _0x24af53;};return a5_0x4784();}a5_0x345e3b();'use strict';const HISTORY_MAX_SIZE=0x32,RAW_LOG_MAX_SIZE=0x9c4,THERMO_LOG_SIZE=0x3e8,SEQUENCE_TIMEOUT_MS=0x5*0x3c*0x3e8,MAX_TRAINING_SET_SIZE=0x1f4,EXIT_TIMER_MINUTES=0xf,EXIT_GRACE_PERIOD_SECONDS=0x1e;let activeSequence=[],sequenceTimer=null;async function getOutsideTemperatureNumeric(_0xac3acd){const _0x4e85cf=a5_0x34a2;if(_0xac3acd[_0x4e85cf(0x16c)][_0x4e85cf(0x15f)])try{const _0x75ba01=await _0xac3acd[_0x4e85cf(0x138)](_0xac3acd[_0x4e85cf(0x16c)][_0x4e85cf(0x15f)]);if(_0x75ba01&&_0x75ba01[_0x4e85cf(0x164)]!==undefined&&_0x75ba01[_0x4e85cf(0x164)]!==null)return parseFloat(_0x75ba01[_0x4e85cf(0x164)]);}catch(_0x2a7dbc){}const _0x1c009d=_0xac3acd[_0x4e85cf(0x16c)][_0x4e85cf(0x133)];if(!_0xac3acd[_0x4e85cf(0x16c)][_0x4e85cf(0x129)]||!_0x1c009d)return null;try{let _0x1b6c6f='';if(_0x1c009d['includes']('accuweather'))_0x1b6c6f=_0x1c009d+_0x4e85cf(0x12f);else{if(_0x1c009d[_0x4e85cf(0x159)](_0x4e85cf(0x13a)))_0x1b6c6f=_0x1c009d+_0x4e85cf(0x16a);else{if(_0x1c009d[_0x4e85cf(0x159)]('openweathermap'))_0x1b6c6f=_0x1c009d+_0x4e85cf(0x11a);else{if(_0x1c009d[_0x4e85cf(0x159)](_0x4e85cf(0x145)))_0x1b6c6f=_0x1c009d+_0x4e85cf(0x132);}}}if(_0x1b6c6f){const _0x3f1567=await _0xac3acd[_0x4e85cf(0x138)](_0x1b6c6f);if(_0x3f1567&&_0x3f1567[_0x4e85cf(0x164)]!==undefined&&_0x3f1567['val']!==null)return parseFloat(_0x3f1567[_0x4e85cf(0x164)]);}}catch(_0x8d2a0e){}return null;}async function recordThermodynamics(_0xfaa35,_0x290442,_0x3a98c5,_0x249aa6){const _0x7b6397=a5_0x34a2,_0x4b4aa0=await getOutsideTemperatureNumeric(_0xfaa35);let _0xa19ae9=0x0;if(_0x290442['includes'](_0x7b6397(0x120))){const _0x1cef66=[{'from':_0x7b6397(0x114),'to':'.1.LEVEL'},{'from':'.1.ACTUAL_TEMPERATURE','to':_0x7b6397(0x144)},{'from':_0x7b6397(0x122),'to':'.4.VALVE_STATE'},{'from':_0x7b6397(0x143),'to':_0x7b6397(0x14d)}];for(const _0x39a4a7 of _0x1cef66){if(_0x290442[_0x7b6397(0x159)](_0x39a4a7[_0x7b6397(0x12b)])){const _0x1910c9=_0x290442[_0x7b6397(0x137)](_0x39a4a7['from'],_0x39a4a7['to']);try{const _0x961342=await _0xfaa35[_0x7b6397(0x138)](_0x1910c9);if(_0x961342&&_0x961342[_0x7b6397(0x164)]!==null&&_0x961342[_0x7b6397(0x164)]!==undefined){let _0x517654=_0x961342['val'];typeof _0x517654===_0x7b6397(0x163)&&_0x517654<=1.05&&_0x39a4a7['to'][_0x7b6397(0x159)]('LEVEL')&&(_0x517654=_0x517654*0x64);_0xa19ae9=Math[_0x7b6397(0x15d)](_0x517654);break;}}catch(_0xe77668){}}}}const _0x5574e8=await _0xfaa35[_0x7b6397(0x123)](_0x7b6397(0x170));let _0x2c0029=[];if(_0x5574e8&&_0x5574e8['val'])try{_0x2c0029=JSON[_0x7b6397(0x125)](_0x5574e8[_0x7b6397(0x164)]);}catch(_0x45daef){}_0x2c0029[_0x7b6397(0x154)]({'ts':Date[_0x7b6397(0x12e)](),'room':_0x249aa6||_0x7b6397(0x153),'t_in':_0x3a98c5,'t_out':_0x4b4aa0,'valve':_0xa19ae9});if(_0x2c0029['length']>THERMO_LOG_SIZE)_0x2c0029[_0x7b6397(0x149)]();await _0xfaa35[_0x7b6397(0x15c)]('LTM.trainingData.thermodynamics',{'val':JSON[_0x7b6397(0x124)](_0x2c0029),'ack':!![]});}async function saveCompletedSequence(_0x2c57f2){const _0x12e567=a5_0x34a2;try{const _0x423c01=await _0x2c57f2[_0x12e567(0x123)](_0x12e567(0x11d));let _0x282f45=[];if(_0x423c01&&_0x423c01[_0x12e567(0x164)])try{_0x282f45=JSON[_0x12e567(0x125)](_0x423c01[_0x12e567(0x164)]);}catch(_0x52c5be){}const _0x32ab59=activeSequence[0x0]['ts'],_0x1a11a0=activeSequence[_0x12e567(0x130)](_0x1cd036=>({'loc':_0x1cd036[_0x12e567(0x11e)],'t_delta':Math[_0x12e567(0x15d)]((_0x1cd036['ts']-_0x32ab59)/0x3e8)})),_0x1a2a0b={'timestamp':new Date(_0x32ab59)[_0x12e567(0x128)](),'steps':_0x1a11a0,'duration':Math['round']((activeSequence[activeSequence[_0x12e567(0x14f)]-0x1]['ts']-_0x32ab59)/0x3e8),'daytime':new Date(_0x32ab59)[_0x12e567(0x12c)]()};_0x282f45[_0x12e567(0x154)](_0x1a2a0b);if(_0x282f45['length']>MAX_TRAINING_SET_SIZE)_0x282f45[_0x12e567(0x149)]();await _0x2c57f2[_0x12e567(0x15c)](_0x12e567(0x11d),{'val':JSON[_0x12e567(0x124)](_0x282f45),'ack':!![]}),_0x2c57f2[_0x12e567(0x13c)]&&_0x2c57f2[_0x12e567(0x161)]&&_0x2c57f2[_0x12e567(0x161)](_0x12e567(0x142),{'sequence':_0x1a2a0b});}catch(_0x55a60b){_0x2c57f2[_0x12e567(0x169)][_0x12e567(0x117)](_0x12e567(0x16f)+_0x55a60b[_0x12e567(0x16e)]);}}async function recordSequence(_0xca4823,_0x8b7cbe){const _0x5d3020=a5_0x34a2,_0x45fdbc=(_0x8b7cbe[_0x5d3020(0x135)]||'')['toLowerCase'](),_0x3455ab=[_0x5d3020(0x13b),'bewegung',_0x5d3020(0x171),'presence','occupancy',_0x5d3020(0x157),_0x5d3020(0x147),_0x5d3020(0x148),_0x5d3020(0x165),_0x5d3020(0x167),_0x5d3020(0x11f),_0x5d3020(0x126),_0x5d3020(0x15b),_0x5d3020(0x13e),_0x5d3020(0x14c),'dimmer',_0x5d3020(0x162)];if(!_0x3455ab[_0x5d3020(0x118)](_0x17857b=>_0x45fdbc[_0x5d3020(0x159)](_0x17857b)))return;if(!_0x8b7cbe[_0x5d3020(0x16d)])return;if(sequenceTimer)clearTimeout(sequenceTimer);activeSequence['push']({'loc':_0x8b7cbe[_0x5d3020(0x160)]||_0x5d3020(0x153),'id':_0x8b7cbe['id'],'ts':Date[_0x5d3020(0x12e)]()}),sequenceTimer=setTimeout(async()=>{const _0x25a1c4=_0x5d3020;if(activeSequence[_0x25a1c4(0x14f)]>0x1)await saveCompletedSequence(_0xca4823);activeSequence=[];},SEQUENCE_TIMEOUT_MS);}function startExitTimer(_0x465b77){const _0x16e64c=a5_0x34a2;abortExitTimer(_0x465b77),_0x465b77[_0x16e64c(0x156)]=!![],_0x465b77[_0x16e64c(0x172)]=setTimeout(()=>{const _0x5dbe2e=_0x16e64c;_0x465b77[_0x5dbe2e(0x156)]=![];},EXIT_GRACE_PERIOD_SECONDS*0x3e8),_0x465b77[_0x16e64c(0x127)]=setTimeout(()=>{const _0x6d7f2b=_0x16e64c;setPresence(_0x465b77,![]),_0x465b77[_0x6d7f2b(0x127)]=null;},EXIT_TIMER_MINUTES*0x3c*0x3e8);}function abortExitTimer(_0xd6bbc3){const _0x47ddaa=a5_0x34a2;if(_0xd6bbc3[_0x47ddaa(0x127)])clearTimeout(_0xd6bbc3[_0x47ddaa(0x127)]);if(_0xd6bbc3[_0x47ddaa(0x172)])clearTimeout(_0xd6bbc3[_0x47ddaa(0x172)]);_0xd6bbc3[_0x47ddaa(0x127)]=null,_0xd6bbc3[_0x47ddaa(0x172)]=null,_0xd6bbc3[_0x47ddaa(0x156)]=![];}async function setPresence(_0x224f9d,_0x3b37fe){const _0x24ffbe=a5_0x34a2;if(_0x224f9d[_0x24ffbe(0x119)]===_0x3b37fe)return;_0x224f9d[_0x24ffbe(0x119)]=_0x3b37fe,await _0x224f9d[_0x24ffbe(0x15c)](_0x24ffbe(0x12a),{'val':_0x3b37fe,'ack':!![]});}function a5_0x34a2(_0x41b3a5,_0x3fc4c2){const _0x2c441b=a5_0x4784();return a5_0x34a2=function(_0x345e3b,_0x22eeca){_0x345e3b=_0x345e3b-0x114;let _0x478459=_0x2c441b[_0x345e3b];return _0x478459;},a5_0x34a2(_0x41b3a5,_0x3fc4c2);}async function processSensorEvent(_0x29e949,_0x54636a,_0x342403,_0x2de282){const _0x4d1995=a5_0x34a2;if(!_0x2de282)return null;const _0x617d69=_0x342403[_0x4d1995(0x164)],_0x40855d=Date[_0x4d1995(0x12e)](),_0x1e7a0a=_0x29e949[_0x4d1995(0x150)][_0x54636a];_0x29e949[_0x4d1995(0x150)][_0x54636a]=_0x617d69;if(!_0x2de282[_0x4d1995(0x131)]&&_0x1e7a0a!=undefined&&_0x1e7a0a==_0x617d69)return null;const _0x25c3a0=(_0x2de282['type']||'')['toLowerCase'](),_0x5d7fec=_0x25c3a0[_0x4d1995(0x159)](_0x4d1995(0x166))||_0x25c3a0[_0x4d1995(0x159)]('temperatur')||_0x25c3a0[_0x4d1995(0x159)](_0x4d1995(0x14e))||_0x25c3a0[_0x4d1995(0x159)](_0x4d1995(0x168));_0x29e949['isProVersion']&&_0x5d7fec&&recordThermodynamics(_0x29e949,_0x54636a,_0x617d69,_0x2de282[_0x4d1995(0x160)]);const _0x3bed89={'timestamp':_0x40855d,'id':_0x54636a,'name':_0x2de282[_0x4d1995(0x146)],'type':_0x2de282['type'],'location':_0x2de282[_0x4d1995(0x160)],'value':_0x617d69};_0x29e949[_0x4d1995(0x14a)][_0x4d1995(0x139)](_0x3bed89);if(_0x29e949[_0x4d1995(0x14a)][_0x4d1995(0x14f)]>HISTORY_MAX_SIZE)_0x29e949[_0x4d1995(0x14a)][_0x4d1995(0x151)]();await _0x29e949[_0x4d1995(0x15c)]('events.lastEvent',{'val':JSON[_0x4d1995(0x124)](_0x3bed89),'ack':!![]}),await _0x29e949['setStateAsync'](_0x4d1995(0x15a),{'val':JSON[_0x4d1995(0x124)](_0x29e949[_0x4d1995(0x14a)]),'ack':!![]});if(_0x29e949[_0x4d1995(0x13c)]){_0x29e949[_0x4d1995(0x13f)]['push'](_0x3bed89);if(_0x29e949[_0x4d1995(0x13f)][_0x4d1995(0x14f)]>RAW_LOG_MAX_SIZE)_0x29e949['rawEventLog']['splice'](0x0,_0x29e949['rawEventLog'][_0x4d1995(0x14f)]-RAW_LOG_MAX_SIZE);await _0x29e949['setStateAsync']('LTM.rawEventLog',{'val':JSON[_0x4d1995(0x124)](_0x29e949[_0x4d1995(0x13f)]),'ack':!![]}),recordSequence(_0x29e949,_0x3bed89);}if(_0x2de282['isExit']&&_0x617d69===!![]){if(_0x29e949[_0x4d1995(0x119)]&&!_0x29e949['isGracePeriodActive'])startExitTimer(_0x29e949);else{if(!_0x29e949[_0x4d1995(0x119)])setPresence(_0x29e949,!![]);}}else{if(_0x2de282[_0x4d1995(0x135)]===_0x4d1995(0x13b)&&_0x617d69===!![]){if(_0x29e949[_0x4d1995(0x127)])abortExitTimer(_0x29e949);if(!_0x29e949['isPresent']&&_0x29e949[_0x4d1995(0x134)]==='normal')setPresence(_0x29e949,!![]);}}return _0x29e949[_0x4d1995(0x13c)]&&_0x2de282[_0x4d1995(0x135)]===_0x4d1995(0x13b)&&_0x617d69===!![]&&_0x2de282[_0x4d1995(0x160)]&&_0x29e949[_0x4d1995(0x161)]&&_0x29e949['sendToPythonWrapper'](_0x4d1995(0x14b),{'room':_0x2de282['location']}),_0x3bed89;}module['exports']={'processSensorEvent':processSensorEvent,'getOutsideTemperatureNumeric':getOutsideTemperatureNumeric,'setPresence':setPresence,'abortExitTimer':abortExitTimer,'startExitTimer':startExitTimer};