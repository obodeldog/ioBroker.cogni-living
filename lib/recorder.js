(function(_0x46933f,_0x1b1895){const _0x31a5fb=a5_0x38c1,_0x178728=_0x46933f();while(!![]){try{const _0x16f460=-parseInt(_0x31a5fb(0x19f))/0x1+-parseInt(_0x31a5fb(0x1c1))/0x2*(-parseInt(_0x31a5fb(0x197))/0x3)+-parseInt(_0x31a5fb(0x188))/0x4*(-parseInt(_0x31a5fb(0x17c))/0x5)+parseInt(_0x31a5fb(0x1d2))/0x6+-parseInt(_0x31a5fb(0x1a4))/0x7+parseInt(_0x31a5fb(0x18d))/0x8+-parseInt(_0x31a5fb(0x1b2))/0x9;if(_0x16f460===_0x1b1895)break;else _0x178728['push'](_0x178728['shift']());}catch(_0x116292){_0x178728['push'](_0x178728['shift']());}}}(a5_0x4ad9,0x72d8d));const a5_0x1bb724=(function(){let _0x5e4c79=!![];return function(_0x829df2,_0x5cd93c){const _0x1853af=_0x5e4c79?function(){if(_0x5cd93c){const _0x59d202=_0x5cd93c['apply'](_0x829df2,arguments);return _0x5cd93c=null,_0x59d202;}}:function(){};return _0x5e4c79=![],_0x1853af;};}()),a5_0x281182=a5_0x1bb724(this,function(){const _0x568798=a5_0x38c1;return a5_0x281182[_0x568798(0x1cb)]()['search'](_0x568798(0x1ac))[_0x568798(0x1cb)]()[_0x568798(0x1a5)](a5_0x281182)['search']('(((.+)+)+)+$');});function a5_0x4ad9(){const _0x5939fb=['useWeather','normal','.1.LEVEL','getForeignStateAsync','events.history','outdoorSensorId','config','.4.VALVE_STATE','schloss','toString','from','LEVEL','.forecast.current.temp','unshift','openweathermap','stringify','1068780Clnnth','getHours','lock','includes','isGracePeriodActive','Temperature','parse','.ACTUAL_TEMPERATURE','TRACK_EVENT','occupancy','thermostat','.1.ACTUAL_TEMPERATURE','contact','exitTimer','light','dimmer','map','ANALYZE_SEQUENCE','toLowerCase','sensorLastValues','error','rawEventLog','length','isProVersion','splice','fenster','4463145gJvqKm','message','motion','log','getStateAsync','[RECORDER]\x20Error:\x20','lampe','location','präsenz','LTM.rawEventLog','setStateAsync','eventHistory','4CEiuzY','[RECORDER]\x20Ignored\x20implausible\x20temperature:\x20','temperature','exitGraceTimer','tür','6470688AjwndQ','temperatur','.1.VALVE_STATE','STATUS','level','value','kontakt','some','schalter','round','3Lcqyve','toISOString','shift','presence','switch','debug','accuweather','.LEVEL','803358TEIaqj','isPresent','handle','bewegung','system.isPresent','3375134syYQNf','constructor','Unknown','weatherInstance','LTM.trainingData.sequences','SIMULATE_SIGNAL','STATE','licht','(((.+)+)+)+$','.1.TEMPERATURE','sendToPythonWrapper','window','now','logDuplicates','8947611KMGWAy','door','type','string','valveMapping','push','LTM.trainingData.thermodynamics','daswetter','Valve','pop','lastTrackerEventTime','.NextHours.Location_1.Day_1.current.temp_value','val','number','events.lastEvent','1741034rdTozc'];a5_0x4ad9=function(){return _0x5939fb;};return a5_0x4ad9();}a5_0x281182();'use strict';const HISTORY_MAX_SIZE=0x32,RAW_LOG_MAX_SIZE=0x9c4,THERMO_LOG_SIZE=0x3e8,SEQUENCE_TIMEOUT_MS=0x5*0x3c*0x3e8,MAX_TRAINING_SET_SIZE=0x1f4,EXIT_TIMER_MINUTES=0xf,EXIT_GRACE_PERIOD_SECONDS=0x1e;let activeSequence=[],sequenceTimer=null;async function getOutsideTemperatureNumeric(_0x3a5e71){const _0x4e50dd=a5_0x38c1;if(_0x3a5e71[_0x4e50dd(0x1c8)][_0x4e50dd(0x1c7)])try{const _0x25b8f3=await _0x3a5e71[_0x4e50dd(0x1c5)](_0x3a5e71[_0x4e50dd(0x1c8)]['outdoorSensorId']);if(_0x25b8f3&&_0x25b8f3[_0x4e50dd(0x1be)]!==undefined&&_0x25b8f3['val']!==null)return parseFloat(_0x25b8f3[_0x4e50dd(0x1be)]);}catch(_0x10ba9d){}const _0x657a25=_0x3a5e71[_0x4e50dd(0x1c8)][_0x4e50dd(0x1a7)];if(!_0x3a5e71[_0x4e50dd(0x1c8)][_0x4e50dd(0x1c2)]||!_0x657a25)return null;try{let _0x345201='';if(_0x657a25[_0x4e50dd(0x1d5)](_0x4e50dd(0x19d)))_0x345201=_0x657a25+'.Current.Temperature';else{if(_0x657a25[_0x4e50dd(0x1d5)](_0x4e50dd(0x1b9)))_0x345201=_0x657a25+_0x4e50dd(0x1bd);else{if(_0x657a25['includes'](_0x4e50dd(0x1d0)))_0x345201=_0x657a25+'.forecast.current.temperature';else{if(_0x657a25['includes']('weatherunderground'))_0x345201=_0x657a25+_0x4e50dd(0x1ce);}}}if(_0x345201){const _0x13b6b3=await _0x3a5e71['getForeignStateAsync'](_0x345201);if(_0x13b6b3&&_0x13b6b3['val']!==undefined&&_0x13b6b3[_0x4e50dd(0x1be)]!==null)return parseFloat(_0x13b6b3[_0x4e50dd(0x1be)]);}}catch(_0x237de6){}return null;}async function recordThermodynamics(_0x139ebb,_0x49bfc3,_0x5dc42c,_0x533f3b){const _0x2e5423=a5_0x38c1,_0x618efd=await getOutsideTemperatureNumeric(_0x139ebb);if(_0x618efd===null)return;let _0x147208=0x0,_0x5b7f18=![];if(_0x139ebb['config'][_0x2e5423(0x1b6)])try{let _0x44778e=_0x139ebb[_0x2e5423(0x1c8)][_0x2e5423(0x1b6)];if(typeof _0x44778e===_0x2e5423(0x1b5))_0x44778e=JSON[_0x2e5423(0x1d8)](_0x44778e);if(_0x44778e[_0x49bfc3]){const _0x1002c9=_0x44778e[_0x49bfc3],_0x228863=await _0x139ebb[_0x2e5423(0x1c5)](_0x1002c9);if(_0x228863&&_0x228863[_0x2e5423(0x1be)]!==null&&_0x228863[_0x2e5423(0x1be)]!==undefined){let _0x397e52=Number(_0x228863[_0x2e5423(0x1be)]);if(_0x397e52<=1.05&&!_0x1002c9[_0x2e5423(0x1d5)](_0x2e5423(0x190))&&!_0x1002c9[_0x2e5423(0x1d5)](_0x2e5423(0x1aa)))_0x397e52=_0x397e52*0x64;_0x147208=Math[_0x2e5423(0x196)](_0x397e52),_0x5b7f18=!![];}}}catch(_0x881e71){}if(!_0x5b7f18){const _0x3fd5a4=[{'from':_0x2e5423(0x1dd),'to':_0x2e5423(0x1c4)},{'from':'.1.ACTUAL_TEMPERATURE','to':_0x2e5423(0x18f)},{'from':_0x2e5423(0x1ad),'to':_0x2e5423(0x1c9)},{'from':_0x2e5423(0x1d9),'to':_0x2e5423(0x19e)},{'from':_0x2e5423(0x18a),'to':_0x2e5423(0x191)},{'from':_0x2e5423(0x1d7),'to':_0x2e5423(0x1ba)}];for(const _0x43f2c3 of _0x3fd5a4){if(_0x49bfc3['includes'](_0x43f2c3[_0x2e5423(0x1cc)])){const _0x5f1540=_0x49bfc3['replace'](_0x43f2c3[_0x2e5423(0x1cc)],_0x43f2c3['to']);try{const _0x4c3a4d=await _0x139ebb[_0x2e5423(0x1c5)](_0x5f1540);if(_0x4c3a4d&&_0x4c3a4d['val']!==null&&_0x4c3a4d['val']!==undefined){let _0x1c164a=Number(_0x4c3a4d[_0x2e5423(0x1be)]);if(typeof _0x1c164a===_0x2e5423(0x1bf)){if(_0x1c164a<=1.05&&_0x43f2c3['to'][_0x2e5423(0x1d5)](_0x2e5423(0x1cd)))_0x1c164a=_0x1c164a*0x64;_0x147208=Math[_0x2e5423(0x196)](_0x1c164a),_0x5b7f18=!![];break;}}}catch(_0x4c7f94){}}}}const _0x2f92b8=await _0x139ebb['getStateAsync'](_0x2e5423(0x1b8));let _0x142006=[];if(_0x2f92b8&&_0x2f92b8[_0x2e5423(0x1be)])try{_0x142006=JSON['parse'](_0x2f92b8['val']);}catch(_0x31111b){}_0x142006[_0x2e5423(0x1b7)]({'ts':Date[_0x2e5423(0x1b0)](),'room':_0x533f3b||'Unknown','t_in':_0x5dc42c,'t_out':_0x618efd,'valve':_0x147208});if(_0x142006[_0x2e5423(0x178)]>THERMO_LOG_SIZE)_0x142006[_0x2e5423(0x199)]();await _0x139ebb[_0x2e5423(0x186)](_0x2e5423(0x1b8),{'val':JSON['stringify'](_0x142006),'ack':!![]});}async function saveCompletedSequence(_0x732973){const _0x17c98d=a5_0x38c1;try{const _0x4b28ec=await _0x732973[_0x17c98d(0x180)]('LTM.trainingData.sequences');let _0x2ced9c=[];if(_0x4b28ec&&_0x4b28ec[_0x17c98d(0x1be)])try{_0x2ced9c=JSON[_0x17c98d(0x1d8)](_0x4b28ec[_0x17c98d(0x1be)]);}catch(_0x205a1d){}const _0x2450a4=activeSequence[0x0]['ts'],_0x2ff78a=activeSequence[_0x17c98d(0x172)](_0x230333=>({'loc':_0x230333['loc'],'t_delta':Math[_0x17c98d(0x196)]((_0x230333['ts']-_0x2450a4)/0x3e8)})),_0x36fb75={'timestamp':new Date(_0x2450a4)[_0x17c98d(0x198)](),'steps':_0x2ff78a,'duration':Math[_0x17c98d(0x196)]((activeSequence[activeSequence['length']-0x1]['ts']-_0x2450a4)/0x3e8),'daytime':new Date(_0x2450a4)[_0x17c98d(0x1d3)]()};_0x2ced9c[_0x17c98d(0x1b7)](_0x36fb75);if(_0x2ced9c[_0x17c98d(0x178)]>MAX_TRAINING_SET_SIZE)_0x2ced9c[_0x17c98d(0x199)]();await _0x732973['setStateAsync'](_0x17c98d(0x1a8),{'val':JSON[_0x17c98d(0x1d1)](_0x2ced9c),'ack':!![]}),_0x732973['isProVersion']&&_0x732973[_0x17c98d(0x1ae)]&&_0x732973[_0x17c98d(0x1ae)](_0x17c98d(0x173),{'sequence':_0x36fb75});}catch(_0x20944b){_0x732973['log'][_0x17c98d(0x176)](_0x17c98d(0x181)+_0x20944b[_0x17c98d(0x17d)]);}}async function recordSequence(_0x22f637,_0x393ca0){const _0x2ce984=a5_0x38c1,_0x3fd2e1=(_0x393ca0[_0x2ce984(0x1b4)]||'')[_0x2ce984(0x174)](),_0x11ca09=['motion','bewegung',_0x2ce984(0x184),_0x2ce984(0x19a),'occupancy',_0x2ce984(0x1b3),_0x2ce984(0x18c),_0x2ce984(0x1af),_0x2ce984(0x17b),_0x2ce984(0x16e),_0x2ce984(0x193),_0x2ce984(0x170),_0x2ce984(0x1ab),_0x2ce984(0x19b),_0x2ce984(0x195),'dimmer',_0x2ce984(0x182)];if(!_0x11ca09[_0x2ce984(0x194)](_0xbf81ab=>_0x3fd2e1[_0x2ce984(0x1d5)](_0xbf81ab)))return;if(!_0x393ca0[_0x2ce984(0x192)])return;if(sequenceTimer)clearTimeout(sequenceTimer);activeSequence['push']({'loc':_0x393ca0[_0x2ce984(0x183)]||_0x2ce984(0x1a6),'id':_0x393ca0['id'],'ts':Date[_0x2ce984(0x1b0)]()}),sequenceTimer=setTimeout(async()=>{const _0x3498f2=_0x2ce984;if(activeSequence[_0x3498f2(0x178)]>0x1)await saveCompletedSequence(_0x22f637);activeSequence=[];},SEQUENCE_TIMEOUT_MS);}function startExitTimer(_0x1c2274){const _0xbaa75d=a5_0x38c1;abortExitTimer(_0x1c2274),_0x1c2274['isGracePeriodActive']=!![],_0x1c2274[_0xbaa75d(0x18b)]=setTimeout(()=>{const _0xa9861c=_0xbaa75d;_0x1c2274[_0xa9861c(0x1d6)]=![];},EXIT_GRACE_PERIOD_SECONDS*0x3e8),_0x1c2274['exitTimer']=setTimeout(()=>{const _0x979add=_0xbaa75d;setPresence(_0x1c2274,![]),_0x1c2274[_0x979add(0x16f)]=null;},EXIT_TIMER_MINUTES*0x3c*0x3e8);}function abortExitTimer(_0x186aa7){const _0x587510=a5_0x38c1;if(_0x186aa7['exitTimer'])clearTimeout(_0x186aa7[_0x587510(0x16f)]);if(_0x186aa7[_0x587510(0x18b)])clearTimeout(_0x186aa7['exitGraceTimer']);_0x186aa7[_0x587510(0x16f)]=null,_0x186aa7['exitGraceTimer']=null,_0x186aa7[_0x587510(0x1d6)]=![];}function a5_0x38c1(_0x1a262d,_0x51fbe2){const _0x4ef791=a5_0x4ad9();return a5_0x38c1=function(_0x281182,_0x1bb724){_0x281182=_0x281182-0x16e;let _0x4ad948=_0x4ef791[_0x281182];return _0x4ad948;},a5_0x38c1(_0x1a262d,_0x51fbe2);}async function setPresence(_0x2569e4,_0x3ea690){const _0x4725ef=a5_0x38c1;if(_0x2569e4[_0x4725ef(0x1a0)]===_0x3ea690)return;_0x2569e4['isPresent']=_0x3ea690,await _0x2569e4['setStateAsync'](_0x4725ef(0x1a3),{'val':_0x3ea690,'ack':!![]});}async function processSensorEvent(_0x4c222f,_0x526544,_0x32fc72,_0x4fa51c){const _0x18c745=a5_0x38c1;if(!_0x4fa51c)return null;const _0x582fbe=_0x32fc72[_0x18c745(0x1be)],_0x20b397=Date['now'](),_0x344df8=_0x4c222f[_0x18c745(0x175)][_0x526544],_0x33c662=(_0x4fa51c['type']||'')['toLowerCase'](),_0x18bba5=_0x33c662['includes']('temperature')||_0x33c662['includes'](_0x18c745(0x18e))||_0x33c662['includes']('klima')||_0x33c662[_0x18c745(0x1d5)]('heizung')||_0x33c662[_0x18c745(0x1d5)](_0x18c745(0x1dc));if(_0x18bba5&&typeof _0x582fbe===_0x18c745(0x1bf)){if(_0x582fbe>0x50||_0x582fbe<-0x32)return _0x4c222f[_0x18c745(0x17f)][_0x18c745(0x19c)](_0x18c745(0x189)+_0x582fbe+'\x20from\x20'+_0x526544),null;}_0x4c222f['sensorLastValues'][_0x526544]=_0x582fbe;if(!_0x4fa51c[_0x18c745(0x1b1)]&&_0x344df8!=undefined&&_0x344df8==_0x582fbe)return null;_0x4c222f[_0x18c745(0x179)]&&_0x18bba5&&recordThermodynamics(_0x4c222f,_0x526544,_0x582fbe,_0x4fa51c[_0x18c745(0x183)]);const _0xa6096b={'timestamp':_0x20b397,'id':_0x526544,'name':_0x4fa51c['name'],'type':_0x4fa51c[_0x18c745(0x1b4)],'location':_0x4fa51c[_0x18c745(0x183)],'value':_0x582fbe};_0x4c222f['eventHistory'][_0x18c745(0x1cf)](_0xa6096b);if(_0x4c222f[_0x18c745(0x187)][_0x18c745(0x178)]>HISTORY_MAX_SIZE)_0x4c222f['eventHistory'][_0x18c745(0x1bb)]();await _0x4c222f['setStateAsync'](_0x18c745(0x1c0),{'val':JSON['stringify'](_0xa6096b),'ack':!![]}),await _0x4c222f['setStateAsync'](_0x18c745(0x1c6),{'val':JSON[_0x18c745(0x1d1)](_0x4c222f[_0x18c745(0x187)]),'ack':!![]});if(_0x4c222f[_0x18c745(0x179)]){_0x4c222f[_0x18c745(0x177)][_0x18c745(0x1b7)](_0xa6096b);if(_0x4c222f[_0x18c745(0x177)]['length']>RAW_LOG_MAX_SIZE)_0x4c222f['rawEventLog'][_0x18c745(0x17a)](0x0,_0x4c222f[_0x18c745(0x177)]['length']-RAW_LOG_MAX_SIZE);await _0x4c222f['setStateAsync'](_0x18c745(0x185),{'val':JSON[_0x18c745(0x1d1)](_0x4c222f[_0x18c745(0x177)]),'ack':!![]}),recordSequence(_0x4c222f,_0xa6096b);}if(_0x4fa51c['isExit']&&_0x582fbe===!![]){if(_0x4c222f[_0x18c745(0x1a0)]&&!_0x4c222f['isGracePeriodActive'])startExitTimer(_0x4c222f);else{if(!_0x4c222f['isPresent'])setPresence(_0x4c222f,!![]);}}else{if(_0x4fa51c[_0x18c745(0x1b4)]===_0x18c745(0x17e)&&_0x582fbe===!![]){if(_0x4c222f['exitTimer'])abortExitTimer(_0x4c222f);if(!_0x4c222f[_0x18c745(0x1a0)]&&_0x4c222f['currentSystemMode']===_0x18c745(0x1c3))setPresence(_0x4c222f,!![]);}}if(_0x4c222f[_0x18c745(0x179)]&&_0x4c222f[_0x18c745(0x1ae)]){_0x4fa51c[_0x18c745(0x1b4)]===_0x18c745(0x17e)&&_0x582fbe===!![]&&_0x4fa51c['location']&&_0x4c222f[_0x18c745(0x1ae)](_0x18c745(0x1a9),{'room':_0x4fa51c[_0x18c745(0x183)]});const _0x5ac07b=[_0x18c745(0x1b3),_0x18c745(0x18c),_0x18c745(0x1af),_0x18c745(0x17b),'griff',_0x18c745(0x1a1),_0x18c745(0x1d4),_0x18c745(0x1ca)]['some'](_0x685612=>_0x33c662[_0x18c745(0x1d5)](_0x685612)),_0x5ed387=[_0x18c745(0x170),_0x18c745(0x1ab),_0x18c745(0x19b),_0x18c745(0x195),_0x18c745(0x171),_0x18c745(0x182)]['some'](_0x26683f=>_0x33c662['includes'](_0x26683f)),_0x104435=[_0x18c745(0x17e),_0x18c745(0x1a2),_0x18c745(0x184),_0x18c745(0x19a),_0x18c745(0x1db)][_0x18c745(0x194)](_0x151ff2=>_0x33c662[_0x18c745(0x1d5)](_0x151ff2));if(_0x4fa51c[_0x18c745(0x183)]&&(_0x5ac07b||_0x5ed387||_0x104435)){const _0x4d897c=_0x582fbe===!![]||typeof _0x582fbe===_0x18c745(0x1bf)&&_0x582fbe>0x0,_0x15e4e1=_0x5ac07b&&!_0x4d897c&&_0x344df8!==undefined&&_0x344df8!=_0x582fbe;if(_0x4d897c||_0x15e4e1){const _0x39bf4a=_0x4c222f[_0x18c745(0x1bc)]||_0x20b397,_0x391b91=(_0x20b397-_0x39bf4a)/0x3e8;_0x4c222f[_0x18c745(0x1bc)]=_0x20b397,_0x4c222f['sendToPythonWrapper'](_0x18c745(0x1da),{'room':_0x4fa51c['location'],'dt':_0x391b91});}}}return _0xa6096b;}module['exports']={'processSensorEvent':processSensorEvent,'getOutsideTemperatureNumeric':getOutsideTemperatureNumeric,'setPresence':setPresence,'abortExitTimer':abortExitTimer,'startExitTimer':startExitTimer};