const a5_0x126f53=a5_0x1ec3;(function(_0x31ed32,_0x2470b4){const _0x9454a=a5_0x1ec3,_0x3089c7=_0x31ed32();while(!![]){try{const _0x36e0b4=-parseInt(_0x9454a(0x121))/0x1*(-parseInt(_0x9454a(0xef))/0x2)+parseInt(_0x9454a(0xec))/0x3+parseInt(_0x9454a(0xc0))/0x4+parseInt(_0x9454a(0x105))/0x5+parseInt(_0x9454a(0xd8))/0x6+parseInt(_0x9454a(0x110))/0x7*(-parseInt(_0x9454a(0xca))/0x8)+parseInt(_0x9454a(0xfe))/0x9*(-parseInt(_0x9454a(0xc9))/0xa);if(_0x36e0b4===_0x2470b4)break;else _0x3089c7['push'](_0x3089c7['shift']());}catch(_0x429ee0){_0x3089c7['push'](_0x3089c7['shift']());}}}(a5_0x16af,0x314f3));const a5_0x268cb7=(function(){let _0x4a2a85=!![];return function(_0x29c78a,_0x552452){const _0x3b8ae1=_0x4a2a85?function(){const _0x56f5ba=a5_0x1ec3;if(_0x552452){const _0x3f8402=_0x552452[_0x56f5ba(0xf4)](_0x29c78a,arguments);return _0x552452=null,_0x3f8402;}}:function(){};return _0x4a2a85=![],_0x3b8ae1;};}()),a5_0xf533dc=a5_0x268cb7(this,function(){const _0x55b43a=a5_0x1ec3;return a5_0xf533dc[_0x55b43a(0xd5)]()[_0x55b43a(0x11c)](_0x55b43a(0xd6))[_0x55b43a(0xd5)]()[_0x55b43a(0xfc)](a5_0xf533dc)['search'](_0x55b43a(0xd6));});a5_0xf533dc();'use strict';const HISTORY_MAX_SIZE=0x32,RAW_LOG_MAX_SIZE=0x9c4,THERMO_LOG_SIZE=0x3e8,SEQUENCE_TIMEOUT_MS=0x5*0x3c*0x3e8,MAX_TRAINING_SET_SIZE=0x1f4,EXIT_TIMER_MINUTES=0xf,EXIT_GRACE_PERIOD_SECONDS=0x1e;let activeSequence=[],sequenceTimer=null;async function getOutsideTemperatureNumeric(_0x5b7f6f){const _0x16b8ce=a5_0x1ec3;if(_0x5b7f6f[_0x16b8ce(0xce)]['outdoorSensorId'])try{const _0x22faa9=await _0x5b7f6f[_0x16b8ce(0x103)](_0x5b7f6f[_0x16b8ce(0xce)][_0x16b8ce(0x120)]);if(_0x22faa9&&_0x22faa9['val']!==undefined&&_0x22faa9[_0x16b8ce(0x114)]!==null)return parseFloat(_0x22faa9[_0x16b8ce(0x114)]);}catch(_0x3d7d26){}const _0x84aa94=_0x5b7f6f[_0x16b8ce(0xce)][_0x16b8ce(0xf9)];if(!_0x5b7f6f[_0x16b8ce(0xce)]['useWeather']||!_0x84aa94)return null;try{let _0x2b289e='';if(_0x84aa94[_0x16b8ce(0x109)]('accuweather'))_0x2b289e=_0x84aa94+_0x16b8ce(0x11a);else{if(_0x84aa94['includes'](_0x16b8ce(0x119)))_0x2b289e=_0x84aa94+'.NextHours.Location_1.Day_1.current.temp_value';else{if(_0x84aa94['includes']('openweathermap'))_0x2b289e=_0x84aa94+'.forecast.current.temperature';else{if(_0x84aa94['includes'](_0x16b8ce(0xcd)))_0x2b289e=_0x84aa94+_0x16b8ce(0x123);}}}if(_0x2b289e){const _0x3a9c25=await _0x5b7f6f[_0x16b8ce(0x103)](_0x2b289e);if(_0x3a9c25&&_0x3a9c25[_0x16b8ce(0x114)]!==undefined&&_0x3a9c25[_0x16b8ce(0x114)]!==null)return parseFloat(_0x3a9c25[_0x16b8ce(0x114)]);}}catch(_0x1c9151){}return null;}async function recordThermodynamics(_0x1efeaf,_0x18a2b3,_0x23a38f,_0x2f63b2){const _0x216689=a5_0x1ec3,_0x1f4183=await getOutsideTemperatureNumeric(_0x1efeaf);if(_0x1f4183===null)return;let _0xd547dd=0x0,_0x3fe042=![];if(_0x1efeaf['config']['valveMapping'])try{let _0x14b191=_0x1efeaf[_0x216689(0xce)][_0x216689(0x101)];if(typeof _0x14b191===_0x216689(0xed))_0x14b191=JSON[_0x216689(0xc8)](_0x14b191);if(_0x14b191[_0x18a2b3]){const _0x22f466=_0x14b191[_0x18a2b3],_0x5c5e88=await _0x1efeaf[_0x216689(0x103)](_0x22f466);if(_0x5c5e88&&_0x5c5e88[_0x216689(0x114)]!==null&&_0x5c5e88['val']!==undefined){let _0x5bc3d1=Number(_0x5c5e88['val']);if(_0x5bc3d1<=1.05&&!_0x22f466[_0x216689(0x109)](_0x216689(0x115))&&!_0x22f466[_0x216689(0x109)](_0x216689(0xc2)))_0x5bc3d1=_0x5bc3d1*0x64;_0xd547dd=Math['round'](_0x5bc3d1),_0x3fe042=!![];}}}catch(_0x13abd9){}if(!_0x3fe042){const _0xc1918b=[{'from':_0x216689(0x11e),'to':'.1.LEVEL'},{'from':'.1.ACTUAL_TEMPERATURE','to':'.1.VALVE_STATE'},{'from':'.1.TEMPERATURE','to':_0x216689(0x124)},{'from':'.ACTUAL_TEMPERATURE','to':'.LEVEL'},{'from':_0x216689(0xdf),'to':_0x216689(0xd4)},{'from':'Temperature','to':_0x216689(0x117)}];for(const _0x2b15e9 of _0xc1918b){if(_0x18a2b3[_0x216689(0x109)](_0x2b15e9[_0x216689(0xe4)])){const _0x35b6c9=_0x18a2b3[_0x216689(0x10b)](_0x2b15e9[_0x216689(0xe4)],_0x2b15e9['to']);try{const _0x47c539=await _0x1efeaf[_0x216689(0x103)](_0x35b6c9);if(_0x47c539&&_0x47c539[_0x216689(0x114)]!==null&&_0x47c539[_0x216689(0x114)]!==undefined){let _0x32616f=Number(_0x47c539[_0x216689(0x114)]);if(typeof _0x32616f===_0x216689(0x118)){if(_0x32616f<=1.05&&_0x2b15e9['to'][_0x216689(0x109)]('LEVEL'))_0x32616f=_0x32616f*0x64;_0xd547dd=Math[_0x216689(0xcf)](_0x32616f),_0x3fe042=!![];break;}}}catch(_0x4a5349){}}}}const _0xef6929=await _0x1efeaf['getStateAsync'](_0x216689(0xd9));let _0x4c592d=[];if(_0xef6929&&_0xef6929['val'])try{_0x4c592d=JSON['parse'](_0xef6929['val']);}catch(_0xaa05f1){}_0x4c592d['push']({'ts':Date[_0x216689(0x126)](),'room':_0x2f63b2||'Unknown','t_in':_0x23a38f,'t_out':_0x1f4183,'valve':_0xd547dd});if(_0x4c592d['length']>THERMO_LOG_SIZE)_0x4c592d[_0x216689(0xe3)]();await _0x1efeaf[_0x216689(0xf2)]('LTM.trainingData.thermodynamics',{'val':JSON[_0x216689(0xf7)](_0x4c592d),'ack':!![]});}async function saveCompletedSequence(_0x1d652b){const _0xa955a3=a5_0x1ec3;try{const _0x583132=await _0x1d652b[_0xa955a3(0x11f)](_0xa955a3(0xda));let _0x59bc00=[];if(_0x583132&&_0x583132['val'])try{_0x59bc00=JSON[_0xa955a3(0xc8)](_0x583132['val']);}catch(_0xfdebf6){}const _0x1796d0=activeSequence[0x0]['ts'],_0x50f23f=activeSequence[_0xa955a3(0xfb)](_0x2ba926=>({'loc':_0x2ba926['loc'],'t_delta':Math[_0xa955a3(0xcf)]((_0x2ba926['ts']-_0x1796d0)/0x3e8)})),_0x3a16c8={'timestamp':new Date(_0x1796d0)[_0xa955a3(0xe7)](),'steps':_0x50f23f,'duration':Math[_0xa955a3(0xcf)]((activeSequence[activeSequence['length']-0x1]['ts']-_0x1796d0)/0x3e8),'daytime':new Date(_0x1796d0)[_0xa955a3(0x113)]()};_0x59bc00[_0xa955a3(0xe2)](_0x3a16c8);if(_0x59bc00['length']>MAX_TRAINING_SET_SIZE)_0x59bc00[_0xa955a3(0xe3)]();await _0x1d652b[_0xa955a3(0xf2)](_0xa955a3(0xda),{'val':JSON[_0xa955a3(0xf7)](_0x59bc00),'ack':!![]}),_0x1d652b[_0xa955a3(0x100)]&&_0x1d652b[_0xa955a3(0x10c)]&&_0x1d652b['sendToPythonWrapper'](_0xa955a3(0xff),{'sequence':_0x3a16c8});}catch(_0x2bd02e){_0x1d652b[_0xa955a3(0xd2)][_0xa955a3(0xbe)](_0xa955a3(0x10a)+_0x2bd02e[_0xa955a3(0xd1)]);}}async function recordSequence(_0x2c6d8f,_0x1d399c){const _0x19c532=a5_0x1ec3,_0x1b19e7=(_0x1d399c[_0x19c532(0x10e)]||'')['toLowerCase'](),_0x273664=[_0x19c532(0x106),'bewegung',_0x19c532(0xd3),_0x19c532(0xfa),_0x19c532(0xe9),_0x19c532(0xe1),_0x19c532(0xc6),_0x19c532(0xd7),'fenster',_0x19c532(0xc4),_0x19c532(0xcb),_0x19c532(0x11d),_0x19c532(0x108),_0x19c532(0xc1),'schalter',_0x19c532(0xe0),_0x19c532(0xbf)];if(!_0x273664[_0x19c532(0x111)](_0x2aea91=>_0x1b19e7[_0x19c532(0x109)](_0x2aea91)))return;if(!_0x1d399c['value'])return;if(sequenceTimer)clearTimeout(sequenceTimer);activeSequence[_0x19c532(0xe2)]({'loc':_0x1d399c[_0x19c532(0x107)]||'Unknown','id':_0x1d399c['id'],'ts':Date[_0x19c532(0x126)]()}),sequenceTimer=setTimeout(async()=>{const _0x2daa57=_0x19c532;if(activeSequence[_0x2daa57(0x10f)]>0x1)await saveCompletedSequence(_0x2c6d8f);activeSequence=[];},SEQUENCE_TIMEOUT_MS);}function startExitTimer(_0x4d8208){const _0x551acd=a5_0x1ec3;abortExitTimer(_0x4d8208),_0x4d8208['isGracePeriodActive']=!![],_0x4d8208[_0x551acd(0x112)]=setTimeout(()=>{const _0x2de268=_0x551acd;_0x4d8208[_0x2de268(0x102)]=![];},EXIT_GRACE_PERIOD_SECONDS*0x3e8),_0x4d8208['exitTimer']=setTimeout(()=>{const _0x1113e7=_0x551acd;setPresence(_0x4d8208,![]),_0x4d8208[_0x1113e7(0xf0)]=null;},EXIT_TIMER_MINUTES*0x3c*0x3e8);}function abortExitTimer(_0x287f47){const _0x85943a=a5_0x1ec3;if(_0x287f47[_0x85943a(0xf0)])clearTimeout(_0x287f47[_0x85943a(0xf0)]);if(_0x287f47[_0x85943a(0x112)])clearTimeout(_0x287f47[_0x85943a(0x112)]);_0x287f47[_0x85943a(0xf0)]=null,_0x287f47[_0x85943a(0x112)]=null,_0x287f47[_0x85943a(0x102)]=![];}async function setPresence(_0x35b7fc,_0x5acf28){const _0x417d39=a5_0x1ec3;if(_0x35b7fc[_0x417d39(0xcc)]===_0x5acf28)return;_0x35b7fc[_0x417d39(0xcc)]=_0x5acf28,await _0x35b7fc[_0x417d39(0xf2)](_0x417d39(0xc3),{'val':_0x5acf28,'ack':!![]});}async function processSensorEvent(_0x5d9f96,_0x2db186,_0x5b2fc1,_0x5ca75e){const _0x5b9671=a5_0x1ec3;if(!_0x5ca75e)return null;const _0x1babca=_0x5b2fc1[_0x5b9671(0x114)],_0x5d054b=Date[_0x5b9671(0x126)](),_0x2f8110=_0x5d9f96['sensorLastValues'][_0x2db186],_0x56b99a=(_0x5ca75e['type']||'')[_0x5b9671(0x122)](),_0x1960ab=_0x56b99a['includes'](_0x5b9671(0xdf))||_0x56b99a[_0x5b9671(0x109)](_0x5b9671(0xd0))||_0x56b99a['includes'](_0x5b9671(0xf6))||_0x56b99a[_0x5b9671(0x109)](_0x5b9671(0xf1))||_0x56b99a[_0x5b9671(0x109)]('thermostat');if(_0x1960ab&&typeof _0x1babca==='number'){if(_0x1babca>0x50||_0x1babca<-0x32)return _0x5d9f96['log'][_0x5b9671(0xdd)](_0x5b9671(0xe6)+_0x1babca+_0x5b9671(0xdb)+_0x2db186),null;}_0x5d9f96[_0x5b9671(0xf3)][_0x2db186]=_0x1babca;if(!_0x5ca75e[_0x5b9671(0xe8)]&&_0x2f8110!=undefined&&_0x2f8110==_0x1babca)return null;_0x5d9f96['isProVersion']&&_0x1960ab&&recordThermodynamics(_0x5d9f96,_0x2db186,_0x1babca,_0x5ca75e[_0x5b9671(0x107)]);const _0x478760={'timestamp':_0x5d054b,'id':_0x2db186,'name':_0x5ca75e[_0x5b9671(0xea)],'type':_0x5ca75e[_0x5b9671(0x10e)],'location':_0x5ca75e[_0x5b9671(0x107)],'value':_0x1babca};_0x5d9f96[_0x5b9671(0x116)]['unshift'](_0x478760);if(_0x5d9f96['eventHistory'][_0x5b9671(0x10f)]>HISTORY_MAX_SIZE)_0x5d9f96[_0x5b9671(0x116)]['pop']();await _0x5d9f96[_0x5b9671(0xf2)](_0x5b9671(0x125),{'val':JSON[_0x5b9671(0xf7)](_0x478760),'ack':!![]}),await _0x5d9f96[_0x5b9671(0xf2)](_0x5b9671(0x104),{'val':JSON[_0x5b9671(0xf7)](_0x5d9f96[_0x5b9671(0x116)]),'ack':!![]});if(_0x5d9f96[_0x5b9671(0x100)]){_0x5d9f96[_0x5b9671(0xde)][_0x5b9671(0xe2)](_0x478760);if(_0x5d9f96[_0x5b9671(0xde)][_0x5b9671(0x10f)]>RAW_LOG_MAX_SIZE)_0x5d9f96[_0x5b9671(0xde)]['splice'](0x0,_0x5d9f96['rawEventLog'][_0x5b9671(0x10f)]-RAW_LOG_MAX_SIZE);await _0x5d9f96[_0x5b9671(0xf2)]('LTM.rawEventLog',{'val':JSON['stringify'](_0x5d9f96[_0x5b9671(0xde)]),'ack':!![]}),recordSequence(_0x5d9f96,_0x478760);}if(_0x5ca75e[_0x5b9671(0xe5)]&&_0x1babca===!![]){if(_0x5d9f96['isPresent']&&!_0x5d9f96[_0x5b9671(0x102)])startExitTimer(_0x5d9f96);else{if(!_0x5d9f96[_0x5b9671(0xcc)])setPresence(_0x5d9f96,!![]);}}else{if(_0x5ca75e[_0x5b9671(0x10e)]===_0x5b9671(0x106)&&_0x1babca===!![]){if(_0x5d9f96[_0x5b9671(0xf0)])abortExitTimer(_0x5d9f96);if(!_0x5d9f96[_0x5b9671(0xcc)]&&_0x5d9f96['currentSystemMode']===_0x5b9671(0xee))setPresence(_0x5d9f96,!![]);}}if(_0x5d9f96[_0x5b9671(0x100)]&&_0x5d9f96[_0x5b9671(0x10c)]){_0x5ca75e['type']==='motion'&&_0x1babca===!![]&&_0x5ca75e[_0x5b9671(0x107)]&&_0x5d9f96[_0x5b9671(0x10c)](_0x5b9671(0xf8),{'room':_0x5ca75e[_0x5b9671(0x107)]});const _0xec91ac=[_0x5b9671(0xe1),_0x5b9671(0xc6),_0x5b9671(0xd7),'fenster',_0x5b9671(0xdc),'handle',_0x5b9671(0x11b),_0x5b9671(0xfd)][_0x5b9671(0x111)](_0x885822=>_0x56b99a['includes'](_0x885822)),_0xec5109=['light',_0x5b9671(0x108),_0x5b9671(0xc1),_0x5b9671(0x10d),_0x5b9671(0xe0),_0x5b9671(0xbf)][_0x5b9671(0x111)](_0xa808ec=>_0x56b99a[_0x5b9671(0x109)](_0xa808ec)),_0x4a304d=[_0x5b9671(0x106),_0x5b9671(0xc5),_0x5b9671(0xd3),_0x5b9671(0xfa),_0x5b9671(0xe9)][_0x5b9671(0x111)](_0xfdf6bb=>_0x56b99a[_0x5b9671(0x109)](_0xfdf6bb));if(_0x5ca75e[_0x5b9671(0x107)]&&(_0xec91ac||_0xec5109||_0x4a304d)){const _0x2b0da4=_0x1babca===!![]||typeof _0x1babca===_0x5b9671(0x118)&&_0x1babca>0x0,_0x4fc632=_0xec91ac&&!_0x2b0da4&&_0x2f8110!==undefined&&_0x2f8110!=_0x1babca;if(_0x2b0da4||_0x4fc632){const _0xcc22a8=_0x5d9f96['lastTrackerEventTime']||_0x5d054b,_0x1d45fa=(_0x5d054b-_0xcc22a8)/0x3e8;_0x5d9f96[_0x5b9671(0xeb)]=_0x5d054b,_0x5d9f96[_0x5b9671(0x10c)](_0x5b9671(0xc7),{'room':_0x5ca75e[_0x5b9671(0x107)],'dt':_0x1d45fa});}}}return _0x478760;}module[a5_0x126f53(0xf5)]={'processSensorEvent':processSensorEvent,'getOutsideTemperatureNumeric':getOutsideTemperatureNumeric,'setPresence':setPresence,'abortExitTimer':abortExitTimer,'startExitTimer':startExitTimer};function a5_0x1ec3(_0x4d33c7,_0x9607b5){const _0x219d43=a5_0x16af();return a5_0x1ec3=function(_0xf533dc,_0x268cb7){_0xf533dc=_0xf533dc-0xbe;let _0x16af92=_0x219d43[_0xf533dc];return _0x16af92;},a5_0x1ec3(_0x4d33c7,_0x9607b5);}function a5_0x16af(){const _0x30b66d=['stringify','SIMULATE_SIGNAL','weatherInstance','presence','map','constructor','schloss','2826hYOwoj','ANALYZE_SEQUENCE','isProVersion','valveMapping','isGracePeriodActive','getForeignStateAsync','events.history','207075OjXMAn','motion','location','licht','includes','[RECORDER]\x20Error:\x20','replace','sendToPythonWrapper','schalter','type','length','77CULwsJ','some','exitGraceTimer','getHours','val','STATUS','eventHistory','Valve','number','daswetter','.Current.Temperature','lock','search','light','.1.ACTUAL_TEMPERATURE','getStateAsync','outdoorSensorId','56033fEsNit','toLowerCase','.forecast.current.temp','.4.VALVE_STATE','events.lastEvent','now','error','lampe','236328RZwmLM','switch','STATE','system.isPresent','contact','bewegung','tür','TRACK_EVENT','parse','10660dmzkTN','4024lJplRA','kontakt','isPresent','weatherunderground','config','round','temperatur','message','log','präsenz','level','toString','(((.+)+)+)+$','window','1752810wyMeIB','LTM.trainingData.thermodynamics','LTM.trainingData.sequences','\x20from\x20','griff','debug','rawEventLog','temperature','dimmer','door','push','shift','from','isExit','[RECORDER]\x20Ignored\x20implausible\x20temperature:\x20','toISOString','logDuplicates','occupancy','name','lastTrackerEventTime','280689RitBPb','string','normal','2DgXtdh','exitTimer','heizung','setStateAsync','sensorLastValues','apply','exports','klima'];a5_0x16af=function(){return _0x30b66d;};return a5_0x16af();}