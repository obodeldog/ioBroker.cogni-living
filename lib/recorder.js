const a5_0x21c935=a5_0x2f64;(function(_0x330a16,_0x19215b){const _0x315739=a5_0x2f64,_0x420fc8=_0x330a16();while(!![]){try{const _0x16363a=-parseInt(_0x315739(0x1dd))/0x1+parseInt(_0x315739(0x1f6))/0x2*(parseInt(_0x315739(0x1fe))/0x3)+-parseInt(_0x315739(0x1ef))/0x4*(-parseInt(_0x315739(0x1ed))/0x5)+parseInt(_0x315739(0x1bb))/0x6+-parseInt(_0x315739(0x208))/0x7*(parseInt(_0x315739(0x20a))/0x8)+parseInt(_0x315739(0x1e8))/0x9+-parseInt(_0x315739(0x1eb))/0xa*(parseInt(_0x315739(0x20d))/0xb);if(_0x16363a===_0x19215b)break;else _0x420fc8['push'](_0x420fc8['shift']());}catch(_0x32211e){_0x420fc8['push'](_0x420fc8['shift']());}}}(a5_0x3f21,0x50efb));const a5_0x3d9d19=(function(){let _0x3e2eb7=!![];return function(_0x3fdf06,_0x1237e3){const _0x146eb8=_0x3e2eb7?function(){if(_0x1237e3){const _0x187824=_0x1237e3['apply'](_0x3fdf06,arguments);return _0x1237e3=null,_0x187824;}}:function(){};return _0x3e2eb7=![],_0x146eb8;};}()),a5_0x2b85e8=a5_0x3d9d19(this,function(){const _0x369b0c=a5_0x2f64;return a5_0x2b85e8[_0x369b0c(0x1f9)]()['search']('(((.+)+)+)+$')['toString']()[_0x369b0c(0x1d7)](a5_0x2b85e8)[_0x369b0c(0x1b5)]('(((.+)+)+)+$');});a5_0x2b85e8();'use strict';const HISTORY_MAX_SIZE=0x32,RAW_LOG_MAX_SIZE=0x9c4,THERMO_LOG_SIZE=0x3e8,SEQUENCE_TIMEOUT_MS=0x5*0x3c*0x3e8,MAX_TRAINING_SET_SIZE=0x1f4,EXIT_TIMER_MINUTES=0xf,EXIT_GRACE_PERIOD_SECONDS=0x1e;let activeSequence=[],sequenceTimer=null;async function getOutsideTemperatureNumeric(_0x4bdc47){const _0x29bf76=a5_0x2f64;if(_0x4bdc47[_0x29bf76(0x217)][_0x29bf76(0x1cb)])try{const _0x23de7c=await _0x4bdc47[_0x29bf76(0x1c0)](_0x4bdc47[_0x29bf76(0x217)][_0x29bf76(0x1cb)]);if(_0x23de7c&&_0x23de7c[_0x29bf76(0x203)]!==undefined&&_0x23de7c['val']!==null)return parseFloat(_0x23de7c['val']);}catch(_0x78dddb){}const _0x4a1b68=_0x4bdc47[_0x29bf76(0x217)][_0x29bf76(0x1df)];if(!_0x4bdc47['config'][_0x29bf76(0x1ea)]||!_0x4a1b68)return null;try{let _0x4930e8='';if(_0x4a1b68[_0x29bf76(0x1d5)]('accuweather'))_0x4930e8=_0x4a1b68+_0x29bf76(0x1b4);else{if(_0x4a1b68[_0x29bf76(0x1d5)](_0x29bf76(0x1c5)))_0x4930e8=_0x4a1b68+_0x29bf76(0x1c9);else{if(_0x4a1b68['includes']('openweathermap'))_0x4930e8=_0x4a1b68+_0x29bf76(0x1f8);else{if(_0x4a1b68[_0x29bf76(0x1d5)](_0x29bf76(0x214)))_0x4930e8=_0x4a1b68+'.forecast.current.temp';}}}if(_0x4930e8){const _0x1c7096=await _0x4bdc47[_0x29bf76(0x1c0)](_0x4930e8);if(_0x1c7096&&_0x1c7096[_0x29bf76(0x203)]!==undefined&&_0x1c7096[_0x29bf76(0x203)]!==null)return parseFloat(_0x1c7096['val']);}}catch(_0x4236ab){}return null;}async function recordThermodynamics(_0x384c53,_0x592e5f,_0x341c0a,_0x46d965){const _0x166b29=a5_0x2f64,_0x2d017e=await getOutsideTemperatureNumeric(_0x384c53);if(_0x2d017e===null)return;let _0x130e58=0x0,_0x2b74d3=![];if(_0x384c53['config'][_0x166b29(0x1fb)])try{let _0x4f23ae=_0x384c53[_0x166b29(0x217)][_0x166b29(0x1fb)];if(typeof _0x4f23ae===_0x166b29(0x1e2))_0x4f23ae=JSON['parse'](_0x4f23ae);if(_0x4f23ae[_0x592e5f]){const _0x117887=_0x4f23ae[_0x592e5f],_0x4546bb=await _0x384c53[_0x166b29(0x1c0)](_0x117887);if(_0x4546bb&&_0x4546bb['val']!==null&&_0x4546bb['val']!==undefined){let _0x233c1b=Number(_0x4546bb['val']);if(_0x233c1b<=1.05&&!_0x117887[_0x166b29(0x1d5)](_0x166b29(0x202))&&!_0x117887[_0x166b29(0x1d5)](_0x166b29(0x1f7)))_0x233c1b=_0x233c1b*0x64;_0x130e58=Math[_0x166b29(0x200)](_0x233c1b),_0x2b74d3=!![];}}}catch(_0x531870){}if(!_0x2b74d3){const _0x23e679=[{'from':_0x166b29(0x1c3),'to':'.1.LEVEL'},{'from':_0x166b29(0x1c3),'to':_0x166b29(0x20c)},{'from':_0x166b29(0x1ec),'to':_0x166b29(0x1fc)},{'from':_0x166b29(0x1e0),'to':'.LEVEL'},{'from':_0x166b29(0x1e4),'to':_0x166b29(0x1ca)},{'from':_0x166b29(0x1ff),'to':'Valve'}];for(const _0x20de6f of _0x23e679){if(_0x592e5f[_0x166b29(0x1d5)](_0x20de6f[_0x166b29(0x1ee)])){const _0x46d91b=_0x592e5f[_0x166b29(0x1c1)](_0x20de6f[_0x166b29(0x1ee)],_0x20de6f['to']);try{const _0x226bf5=await _0x384c53[_0x166b29(0x1c0)](_0x46d91b);if(_0x226bf5&&_0x226bf5[_0x166b29(0x203)]!==null&&_0x226bf5['val']!==undefined){let _0xd2145=Number(_0x226bf5[_0x166b29(0x203)]);if(typeof _0xd2145===_0x166b29(0x1d3)){if(_0xd2145<=1.05&&_0x20de6f['to'][_0x166b29(0x1d5)]('LEVEL'))_0xd2145=_0xd2145*0x64;_0x130e58=Math[_0x166b29(0x200)](_0xd2145),_0x2b74d3=!![];break;}}}catch(_0x5ecf11){}}}}const _0x4e05b3=await _0x384c53[_0x166b29(0x1cd)](_0x166b29(0x1f0));let _0x480bcc=[];if(_0x4e05b3&&_0x4e05b3[_0x166b29(0x203)])try{_0x480bcc=JSON['parse'](_0x4e05b3[_0x166b29(0x203)]);}catch(_0x144329){}_0x480bcc[_0x166b29(0x1f3)]({'ts':Date[_0x166b29(0x20b)](),'room':_0x46d965||_0x166b29(0x1ce),'t_in':_0x341c0a,'t_out':_0x2d017e,'valve':_0x130e58});if(_0x480bcc['length']>THERMO_LOG_SIZE)_0x480bcc[_0x166b29(0x1bc)]();await _0x384c53[_0x166b29(0x1e5)](_0x166b29(0x1f0),{'val':JSON[_0x166b29(0x1e9)](_0x480bcc),'ack':!![]});}async function saveCompletedSequence(_0x3fa1b8){const _0x2a7b4d=a5_0x2f64;try{const _0x3391e2=await _0x3fa1b8[_0x2a7b4d(0x1cd)]('LTM.trainingData.sequences');let _0x240a4e=[];if(_0x3391e2&&_0x3391e2[_0x2a7b4d(0x203)])try{_0x240a4e=JSON[_0x2a7b4d(0x216)](_0x3391e2[_0x2a7b4d(0x203)]);}catch(_0x3d122b){}const _0x5bf068=activeSequence[0x0]['ts'],_0x1e4dd6=activeSequence[_0x2a7b4d(0x1bd)](_0x539b12=>({'loc':_0x539b12[_0x2a7b4d(0x1f5)],'t_delta':Math[_0x2a7b4d(0x200)]((_0x539b12['ts']-_0x5bf068)/0x3e8)})),_0x21bae7={'timestamp':new Date(_0x5bf068)['toISOString'](),'steps':_0x1e4dd6,'duration':Math[_0x2a7b4d(0x200)]((activeSequence[activeSequence['length']-0x1]['ts']-_0x5bf068)/0x3e8),'daytime':new Date(_0x5bf068)[_0x2a7b4d(0x1da)]()};_0x240a4e[_0x2a7b4d(0x1f3)](_0x21bae7);if(_0x240a4e['length']>MAX_TRAINING_SET_SIZE)_0x240a4e[_0x2a7b4d(0x1bc)]();await _0x3fa1b8[_0x2a7b4d(0x1e5)]('LTM.trainingData.sequences',{'val':JSON[_0x2a7b4d(0x1e9)](_0x240a4e),'ack':!![]}),_0x3fa1b8[_0x2a7b4d(0x20e)]&&_0x3fa1b8[_0x2a7b4d(0x1be)]&&_0x3fa1b8['sendToPythonWrapper'](_0x2a7b4d(0x1dc),{'sequence':_0x21bae7});}catch(_0x5be135){_0x3fa1b8[_0x2a7b4d(0x1f4)][_0x2a7b4d(0x210)](_0x2a7b4d(0x204)+_0x5be135[_0x2a7b4d(0x1c8)]);}}async function recordSequence(_0x5ae136,_0x25555a){const _0x4dd5c4=a5_0x2f64,_0x2222da=(_0x25555a[_0x4dd5c4(0x1d9)]||'')[_0x4dd5c4(0x1c2)](),_0x166481=[_0x4dd5c4(0x1cc),_0x4dd5c4(0x1e6),'präsenz','presence',_0x4dd5c4(0x1fa),'door',_0x4dd5c4(0x207),_0x4dd5c4(0x209),_0x4dd5c4(0x201),_0x4dd5c4(0x1b9),_0x4dd5c4(0x1d6),_0x4dd5c4(0x1e1),_0x4dd5c4(0x1bf),_0x4dd5c4(0x1d8),_0x4dd5c4(0x1d4),_0x4dd5c4(0x1c7),_0x4dd5c4(0x1ba)];if(!_0x166481['some'](_0x29f03e=>_0x2222da[_0x4dd5c4(0x1d5)](_0x29f03e)))return;if(!_0x25555a['value'])return;if(sequenceTimer)clearTimeout(sequenceTimer);activeSequence['push']({'loc':_0x25555a[_0x4dd5c4(0x211)]||_0x4dd5c4(0x1ce),'id':_0x25555a['id'],'ts':Date[_0x4dd5c4(0x20b)]()}),sequenceTimer=setTimeout(async()=>{if(activeSequence['length']>0x1)await saveCompletedSequence(_0x5ae136);activeSequence=[];},SEQUENCE_TIMEOUT_MS);}function startExitTimer(_0x59c423){const _0x1eb6e8=a5_0x2f64;abortExitTimer(_0x59c423),_0x59c423[_0x1eb6e8(0x1b7)]=!![],_0x59c423[_0x1eb6e8(0x1db)]=setTimeout(()=>{const _0x93610c=_0x1eb6e8;_0x59c423[_0x93610c(0x1b7)]=![];},EXIT_GRACE_PERIOD_SECONDS*0x3e8),_0x59c423[_0x1eb6e8(0x1e3)]=setTimeout(()=>{const _0x597637=_0x1eb6e8;setPresence(_0x59c423,![]),_0x59c423[_0x597637(0x1e3)]=null;},EXIT_TIMER_MINUTES*0x3c*0x3e8);}function abortExitTimer(_0x5306ce){const _0x2e5369=a5_0x2f64;if(_0x5306ce[_0x2e5369(0x1e3)])clearTimeout(_0x5306ce[_0x2e5369(0x1e3)]);if(_0x5306ce[_0x2e5369(0x1db)])clearTimeout(_0x5306ce[_0x2e5369(0x1db)]);_0x5306ce[_0x2e5369(0x1e3)]=null,_0x5306ce[_0x2e5369(0x1db)]=null,_0x5306ce[_0x2e5369(0x1b7)]=![];}async function setPresence(_0x14a6f3,_0x4fb0e5){const _0x2c8cc1=a5_0x2f64;if(_0x14a6f3[_0x2c8cc1(0x1c4)]===_0x4fb0e5)return;_0x14a6f3[_0x2c8cc1(0x1c4)]=_0x4fb0e5,await _0x14a6f3['setStateAsync'](_0x2c8cc1(0x215),{'val':_0x4fb0e5,'ack':!![]});}function a5_0x2f64(_0x56c77a,_0x5bb44a){const _0x4022b0=a5_0x3f21();return a5_0x2f64=function(_0x2b85e8,_0x3d9d19){_0x2b85e8=_0x2b85e8-0x1b4;let _0x3f21de=_0x4022b0[_0x2b85e8];return _0x3f21de;},a5_0x2f64(_0x56c77a,_0x5bb44a);}function a5_0x3f21(){const _0x5b09a1=['constructor','switch','type','getHours','exitGraceTimer','ANALYZE_SEQUENCE','73525xsdera','currentSystemMode','weatherInstance','.ACTUAL_TEMPERATURE','light','string','exitTimer','temperature','setStateAsync','bewegung','name','4803849olGUXy','stringify','useWeather','70yRnVOE','.1.TEMPERATURE','25HnhFEe','from','236312zEFGmQ','LTM.trainingData.thermodynamics','normal','thermostat','push','log','loc','1588PIhqPs','STATE','.forecast.current.temperature','toString','occupancy','valveMapping','.4.VALVE_STATE','events.history','438GrzNdJ','Temperature','round','fenster','STATUS','val','[RECORDER]\x20Error:\x20','LTM.rawEventLog','SIMULATE_SIGNAL','tür','3612189LGFgbG','window','8XvoWkY','now','.1.VALVE_STATE','531289hGCKja','isProVersion','temperatur','error','location','exports','splice','weatherunderground','system.isPresent','parse','config','.Current.Temperature','search','rawEventLog','isGracePeriodActive','logDuplicates','contact','lampe','1884510XMUVWd','shift','map','sendToPythonWrapper','licht','getForeignStateAsync','replace','toLowerCase','.1.ACTUAL_TEMPERATURE','isPresent','daswetter','eventHistory','dimmer','message','.NextHours.Location_1.Day_1.current.temp_value','level','outdoorSensorId','motion','getStateAsync','Unknown','klima','sensorLastValues','unshift','length','number','schalter','includes','kontakt'];a5_0x3f21=function(){return _0x5b09a1;};return a5_0x3f21();}async function processSensorEvent(_0x5be7f3,_0x25f4a0,_0x28439d,_0x46a7c3){const _0x32afd0=a5_0x2f64;if(!_0x46a7c3)return null;const _0x243ae2=_0x28439d['val'],_0x1b4a07=Date[_0x32afd0(0x20b)](),_0x2defb6=_0x5be7f3[_0x32afd0(0x1d0)][_0x25f4a0];_0x5be7f3[_0x32afd0(0x1d0)][_0x25f4a0]=_0x243ae2;if(!_0x46a7c3[_0x32afd0(0x1b8)]&&_0x2defb6!=undefined&&_0x2defb6==_0x243ae2)return null;const _0x38c7da=(_0x46a7c3[_0x32afd0(0x1d9)]||'')['toLowerCase'](),_0x5ed7c0=_0x38c7da[_0x32afd0(0x1d5)](_0x32afd0(0x1e4))||_0x38c7da[_0x32afd0(0x1d5)](_0x32afd0(0x20f))||_0x38c7da['includes'](_0x32afd0(0x1cf))||_0x38c7da['includes']('heizung')||_0x38c7da[_0x32afd0(0x1d5)](_0x32afd0(0x1f2));_0x5be7f3[_0x32afd0(0x20e)]&&_0x5ed7c0&&recordThermodynamics(_0x5be7f3,_0x25f4a0,_0x243ae2,_0x46a7c3['location']);const _0x37b2ce={'timestamp':_0x1b4a07,'id':_0x25f4a0,'name':_0x46a7c3[_0x32afd0(0x1e7)],'type':_0x46a7c3[_0x32afd0(0x1d9)],'location':_0x46a7c3[_0x32afd0(0x211)],'value':_0x243ae2};_0x5be7f3[_0x32afd0(0x1c6)][_0x32afd0(0x1d1)](_0x37b2ce);if(_0x5be7f3['eventHistory']['length']>HISTORY_MAX_SIZE)_0x5be7f3[_0x32afd0(0x1c6)]['pop']();await _0x5be7f3[_0x32afd0(0x1e5)]('events.lastEvent',{'val':JSON[_0x32afd0(0x1e9)](_0x37b2ce),'ack':!![]}),await _0x5be7f3[_0x32afd0(0x1e5)](_0x32afd0(0x1fd),{'val':JSON[_0x32afd0(0x1e9)](_0x5be7f3['eventHistory']),'ack':!![]});if(_0x5be7f3[_0x32afd0(0x20e)]){_0x5be7f3[_0x32afd0(0x1b6)][_0x32afd0(0x1f3)](_0x37b2ce);if(_0x5be7f3['rawEventLog'][_0x32afd0(0x1d2)]>RAW_LOG_MAX_SIZE)_0x5be7f3[_0x32afd0(0x1b6)][_0x32afd0(0x213)](0x0,_0x5be7f3[_0x32afd0(0x1b6)][_0x32afd0(0x1d2)]-RAW_LOG_MAX_SIZE);await _0x5be7f3[_0x32afd0(0x1e5)](_0x32afd0(0x205),{'val':JSON[_0x32afd0(0x1e9)](_0x5be7f3[_0x32afd0(0x1b6)]),'ack':!![]}),recordSequence(_0x5be7f3,_0x37b2ce);}if(_0x46a7c3['isExit']&&_0x243ae2===!![]){if(_0x5be7f3[_0x32afd0(0x1c4)]&&!_0x5be7f3[_0x32afd0(0x1b7)])startExitTimer(_0x5be7f3);else{if(!_0x5be7f3[_0x32afd0(0x1c4)])setPresence(_0x5be7f3,!![]);}}else{if(_0x46a7c3[_0x32afd0(0x1d9)]===_0x32afd0(0x1cc)&&_0x243ae2===!![]){if(_0x5be7f3[_0x32afd0(0x1e3)])abortExitTimer(_0x5be7f3);if(!_0x5be7f3['isPresent']&&_0x5be7f3[_0x32afd0(0x1de)]===_0x32afd0(0x1f1))setPresence(_0x5be7f3,!![]);}}return _0x5be7f3[_0x32afd0(0x20e)]&&_0x46a7c3['type']===_0x32afd0(0x1cc)&&_0x243ae2===!![]&&_0x46a7c3[_0x32afd0(0x211)]&&_0x5be7f3['sendToPythonWrapper']&&_0x5be7f3[_0x32afd0(0x1be)](_0x32afd0(0x206),{'room':_0x46a7c3['location']}),_0x37b2ce;}module[a5_0x21c935(0x212)]={'processSensorEvent':processSensorEvent,'getOutsideTemperatureNumeric':getOutsideTemperatureNumeric,'setPresence':setPresence,'abortExitTimer':abortExitTimer,'startExitTimer':startExitTimer};