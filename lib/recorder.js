const a5_0x13f1db=a5_0x5677;(function(_0x3bc46d,_0x4b4527){const _0x183974=a5_0x5677,_0x4143cb=_0x3bc46d();while(!![]){try{const _0x45de73=-parseInt(_0x183974(0x1c7))/0x1*(parseInt(_0x183974(0x204))/0x2)+parseInt(_0x183974(0x1e5))/0x3+parseInt(_0x183974(0x1d2))/0x4+-parseInt(_0x183974(0x1d1))/0x5+parseInt(_0x183974(0x1f6))/0x6*(-parseInt(_0x183974(0x207))/0x7)+-parseInt(_0x183974(0x1d5))/0x8*(-parseInt(_0x183974(0x1d0))/0x9)+-parseInt(_0x183974(0x1e8))/0xa*(-parseInt(_0x183974(0x1dc))/0xb);if(_0x45de73===_0x4b4527)break;else _0x4143cb['push'](_0x4143cb['shift']());}catch(_0x235e7d){_0x4143cb['push'](_0x4143cb['shift']());}}}(a5_0x1e16,0x1b04b));const a5_0x50b4e8=(function(){let _0xd8baba=!![];return function(_0x517e6a,_0x15fd93){const _0x218ed3=_0xd8baba?function(){const _0x3736f2=a5_0x5677;if(_0x15fd93){const _0x15bd81=_0x15fd93[_0x3736f2(0x1b1)](_0x517e6a,arguments);return _0x15fd93=null,_0x15bd81;}}:function(){};return _0xd8baba=![],_0x218ed3;};}()),a5_0x5f6ae5=a5_0x50b4e8(this,function(){const _0xf372ce=a5_0x5677;return a5_0x5f6ae5[_0xf372ce(0x1da)]()[_0xf372ce(0x1e0)]('(((.+)+)+)+$')[_0xf372ce(0x1da)]()[_0xf372ce(0x206)](a5_0x5f6ae5)[_0xf372ce(0x1e0)]('(((.+)+)+)+$');});a5_0x5f6ae5();'use strict';const HISTORY_MAX_SIZE=0x32,RAW_LOG_MAX_SIZE=0x9c4,THERMO_LOG_SIZE=0x3e8,SEQUENCE_TIMEOUT_MS=0x5*0x3c*0x3e8,MAX_TRAINING_SET_SIZE=0x1f4,EXIT_TIMER_MINUTES=0xf,EXIT_GRACE_PERIOD_SECONDS=0x1e;function a5_0x1e16(){const _0x49c433=['shift','temperatur','level','length','isProVersion','from','stringify','outdoorSensorId','424yBSavf','value','klima','system.isPresent','exitTimer','name','accuweather','round','getStateAsync','390375VPruSG','150725xxYPND','215168iSyPip','getHours','STATE','40vosEhe','tür','location','includes','logDuplicates','toString','loc','857263EJPXRE','kontakt','setStateAsync','contact','search','.forecast.current.temp','isGracePeriodActive','sensorLastValues','motion','36204jHEsIK','dimmer','useWeather','20QzsVPD','some','ANALYZE_SEQUENCE','map','now','fenster','lampe','currentSystemMode','pop','eventHistory','exports','rawEventLog','parse','.1.TEMPERATURE','6fKwxTU','toLowerCase','type','val','replace','sendToPythonWrapper','.4.VALVE_STATE','.forecast.current.temperature','.1.LEVEL','valveMapping','isPresent','heizung','string','präsenz','520hfMBaM','temperature','constructor','1312843xhwxHE','events.lastEvent','light','unshift','Temperature','LTM.trainingData.sequences','push','.Current.Temperature','openweathermap','SIMULATE_SIGNAL','presence','Unknown','apply','config','normal','LTM.rawEventLog','splice','.1.ACTUAL_TEMPERATURE','error','LTM.trainingData.thermodynamics','exitGraceTimer','getForeignStateAsync','licht','Valve','LEVEL','isExit'];a5_0x1e16=function(){return _0x49c433;};return a5_0x1e16();}let activeSequence=[],sequenceTimer=null;async function getOutsideTemperatureNumeric(_0x2bff73){const _0x56f77a=a5_0x5677;if(_0x2bff73['config'][_0x56f77a(0x1c6)])try{const _0x3f7728=await _0x2bff73['getForeignStateAsync'](_0x2bff73[_0x56f77a(0x1b2)]['outdoorSensorId']);if(_0x3f7728&&_0x3f7728[_0x56f77a(0x1f9)]!==undefined&&_0x3f7728[_0x56f77a(0x1f9)]!==null)return parseFloat(_0x3f7728[_0x56f77a(0x1f9)]);}catch(_0x4000a5){}const _0x11bbc2=_0x2bff73['config']['weatherInstance'];if(!_0x2bff73[_0x56f77a(0x1b2)][_0x56f77a(0x1e7)]||!_0x11bbc2)return null;try{let _0x1b3705='';if(_0x11bbc2[_0x56f77a(0x1d8)](_0x56f77a(0x1cd)))_0x1b3705=_0x11bbc2+_0x56f77a(0x1ac);else{if(_0x11bbc2[_0x56f77a(0x1d8)]('daswetter'))_0x1b3705=_0x11bbc2+'.NextHours.Location_1.Day_1.current.temp_value';else{if(_0x11bbc2['includes'](_0x56f77a(0x1ad)))_0x1b3705=_0x11bbc2+_0x56f77a(0x1fd);else{if(_0x11bbc2['includes']('weatherunderground'))_0x1b3705=_0x11bbc2+_0x56f77a(0x1e1);}}}if(_0x1b3705){const _0x3e49e3=await _0x2bff73[_0x56f77a(0x1ba)](_0x1b3705);if(_0x3e49e3&&_0x3e49e3[_0x56f77a(0x1f9)]!==undefined&&_0x3e49e3[_0x56f77a(0x1f9)]!==null)return parseFloat(_0x3e49e3[_0x56f77a(0x1f9)]);}}catch(_0x561307){}return null;}async function recordThermodynamics(_0x53dc99,_0x3f0ad1,_0x11f0ac,_0x4e0353){const _0x1105b1=a5_0x5677,_0x1d5d0b=await getOutsideTemperatureNumeric(_0x53dc99);if(_0x1d5d0b===null)return;let _0xeea353=0x0,_0x1cea7d=![];if(_0x53dc99[_0x1105b1(0x1b2)][_0x1105b1(0x1ff)])try{let _0x8d449=_0x53dc99[_0x1105b1(0x1b2)][_0x1105b1(0x1ff)];if(typeof _0x8d449===_0x1105b1(0x202))_0x8d449=JSON[_0x1105b1(0x1f4)](_0x8d449);if(_0x8d449[_0x3f0ad1]){const _0x377c48=_0x8d449[_0x3f0ad1],_0xd85937=await _0x53dc99[_0x1105b1(0x1ba)](_0x377c48);if(_0xd85937&&_0xd85937['val']!==null&&_0xd85937[_0x1105b1(0x1f9)]!==undefined){let _0x50eed8=Number(_0xd85937[_0x1105b1(0x1f9)]);if(_0x50eed8<=1.05&&!_0x377c48[_0x1105b1(0x1d8)]('STATUS')&&!_0x377c48['includes'](_0x1105b1(0x1d4)))_0x50eed8=_0x50eed8*0x64;_0xeea353=Math[_0x1105b1(0x1ce)](_0x50eed8),_0x1cea7d=!![];}}}catch(_0x114ab8){}if(!_0x1cea7d){const _0x1fdcb4=[{'from':'.1.ACTUAL_TEMPERATURE','to':_0x1105b1(0x1fe)},{'from':_0x1105b1(0x1b6),'to':'.1.VALVE_STATE'},{'from':_0x1105b1(0x1f5),'to':_0x1105b1(0x1fc)},{'from':'.ACTUAL_TEMPERATURE','to':'.LEVEL'},{'from':_0x1105b1(0x205),'to':_0x1105b1(0x1c1)},{'from':_0x1105b1(0x20b),'to':_0x1105b1(0x1bc)}];for(const _0xfeb7c5 of _0x1fdcb4){if(_0x3f0ad1[_0x1105b1(0x1d8)](_0xfeb7c5[_0x1105b1(0x1c4)])){const _0x4d5bc5=_0x3f0ad1[_0x1105b1(0x1fa)](_0xfeb7c5[_0x1105b1(0x1c4)],_0xfeb7c5['to']);try{const _0x1799fc=await _0x53dc99[_0x1105b1(0x1ba)](_0x4d5bc5);if(_0x1799fc&&_0x1799fc[_0x1105b1(0x1f9)]!==null&&_0x1799fc[_0x1105b1(0x1f9)]!==undefined){let _0x4b4366=Number(_0x1799fc['val']);if(typeof _0x4b4366==='number'){if(_0x4b4366<=1.05&&_0xfeb7c5['to'][_0x1105b1(0x1d8)](_0x1105b1(0x1bd)))_0x4b4366=_0x4b4366*0x64;_0xeea353=Math[_0x1105b1(0x1ce)](_0x4b4366),_0x1cea7d=!![];break;}}}catch(_0x277ea1){}}}}const _0x5c95ad=await _0x53dc99[_0x1105b1(0x1cf)]('LTM.trainingData.thermodynamics');let _0x284920=[];if(_0x5c95ad&&_0x5c95ad['val'])try{_0x284920=JSON[_0x1105b1(0x1f4)](_0x5c95ad['val']);}catch(_0x9977a){}_0x284920[_0x1105b1(0x1ab)]({'ts':Date['now'](),'room':_0x4e0353||_0x1105b1(0x1b0),'t_in':_0x11f0ac,'t_out':_0x1d5d0b,'valve':_0xeea353});if(_0x284920[_0x1105b1(0x1c2)]>THERMO_LOG_SIZE)_0x284920['shift']();await _0x53dc99[_0x1105b1(0x1de)](_0x1105b1(0x1b8),{'val':JSON[_0x1105b1(0x1c5)](_0x284920),'ack':!![]});}async function saveCompletedSequence(_0xbd4b06){const _0xcc7907=a5_0x5677;try{const _0x294732=await _0xbd4b06['getStateAsync']('LTM.trainingData.sequences');let _0x2cd798=[];if(_0x294732&&_0x294732[_0xcc7907(0x1f9)])try{_0x2cd798=JSON[_0xcc7907(0x1f4)](_0x294732['val']);}catch(_0x5b1e9b){}const _0x23b0dd=activeSequence[0x0]['ts'],_0x167c2f=activeSequence[_0xcc7907(0x1eb)](_0x17b788=>({'loc':_0x17b788[_0xcc7907(0x1db)],'t_delta':Math[_0xcc7907(0x1ce)]((_0x17b788['ts']-_0x23b0dd)/0x3e8)})),_0x29d774={'timestamp':new Date(_0x23b0dd)['toISOString'](),'steps':_0x167c2f,'duration':Math[_0xcc7907(0x1ce)]((activeSequence[activeSequence[_0xcc7907(0x1c2)]-0x1]['ts']-_0x23b0dd)/0x3e8),'daytime':new Date(_0x23b0dd)[_0xcc7907(0x1d3)]()};_0x2cd798[_0xcc7907(0x1ab)](_0x29d774);if(_0x2cd798[_0xcc7907(0x1c2)]>MAX_TRAINING_SET_SIZE)_0x2cd798[_0xcc7907(0x1bf)]();await _0xbd4b06[_0xcc7907(0x1de)](_0xcc7907(0x20c),{'val':JSON[_0xcc7907(0x1c5)](_0x2cd798),'ack':!![]}),_0xbd4b06[_0xcc7907(0x1c3)]&&_0xbd4b06[_0xcc7907(0x1fb)]&&_0xbd4b06[_0xcc7907(0x1fb)](_0xcc7907(0x1ea),{'sequence':_0x29d774});}catch(_0x5e325e){_0xbd4b06['log'][_0xcc7907(0x1b7)]('[RECORDER]\x20Error:\x20'+_0x5e325e['message']);}}async function recordSequence(_0x1c4a1d,_0x3423f6){const _0x54a3a8=a5_0x5677,_0xf4c460=(_0x3423f6['type']||'')['toLowerCase'](),_0x424ad6=[_0x54a3a8(0x1e4),'bewegung',_0x54a3a8(0x203),_0x54a3a8(0x1af),'occupancy','door',_0x54a3a8(0x1d6),'window',_0x54a3a8(0x1ed),_0x54a3a8(0x1df),_0x54a3a8(0x1dd),_0x54a3a8(0x209),_0x54a3a8(0x1bb),'switch','schalter',_0x54a3a8(0x1e6),_0x54a3a8(0x1ee)];if(!_0x424ad6[_0x54a3a8(0x1e9)](_0x1ad480=>_0xf4c460[_0x54a3a8(0x1d8)](_0x1ad480)))return;if(!_0x3423f6[_0x54a3a8(0x1c8)])return;if(sequenceTimer)clearTimeout(sequenceTimer);activeSequence[_0x54a3a8(0x1ab)]({'loc':_0x3423f6[_0x54a3a8(0x1d7)]||_0x54a3a8(0x1b0),'id':_0x3423f6['id'],'ts':Date[_0x54a3a8(0x1ec)]()}),sequenceTimer=setTimeout(async()=>{if(activeSequence['length']>0x1)await saveCompletedSequence(_0x1c4a1d);activeSequence=[];},SEQUENCE_TIMEOUT_MS);}function a5_0x5677(_0x3e0877,_0xe6e481){const _0x437aa9=a5_0x1e16();return a5_0x5677=function(_0x5f6ae5,_0x50b4e8){_0x5f6ae5=_0x5f6ae5-0x1ab;let _0x1e1667=_0x437aa9[_0x5f6ae5];return _0x1e1667;},a5_0x5677(_0x3e0877,_0xe6e481);}function startExitTimer(_0x396cd3){const _0x55f792=a5_0x5677;abortExitTimer(_0x396cd3),_0x396cd3[_0x55f792(0x1e2)]=!![],_0x396cd3[_0x55f792(0x1b9)]=setTimeout(()=>{const _0x42374c=_0x55f792;_0x396cd3[_0x42374c(0x1e2)]=![];},EXIT_GRACE_PERIOD_SECONDS*0x3e8),_0x396cd3[_0x55f792(0x1cb)]=setTimeout(()=>{const _0x3ef26f=_0x55f792;setPresence(_0x396cd3,![]),_0x396cd3[_0x3ef26f(0x1cb)]=null;},EXIT_TIMER_MINUTES*0x3c*0x3e8);}function abortExitTimer(_0x448842){const _0x59df39=a5_0x5677;if(_0x448842[_0x59df39(0x1cb)])clearTimeout(_0x448842['exitTimer']);if(_0x448842[_0x59df39(0x1b9)])clearTimeout(_0x448842[_0x59df39(0x1b9)]);_0x448842['exitTimer']=null,_0x448842[_0x59df39(0x1b9)]=null,_0x448842[_0x59df39(0x1e2)]=![];}async function setPresence(_0x565a19,_0x4bbb0e){const _0x5aeedc=a5_0x5677;if(_0x565a19['isPresent']===_0x4bbb0e)return;_0x565a19['isPresent']=_0x4bbb0e,await _0x565a19[_0x5aeedc(0x1de)](_0x5aeedc(0x1ca),{'val':_0x4bbb0e,'ack':!![]});}async function processSensorEvent(_0x8b3ee6,_0x2da53f,_0x5757b1,_0x3939a4){const _0x184753=a5_0x5677;if(!_0x3939a4)return null;const _0x295ad5=_0x5757b1[_0x184753(0x1f9)],_0x46b2ef=Date[_0x184753(0x1ec)](),_0x6797f2=_0x8b3ee6['sensorLastValues'][_0x2da53f];_0x8b3ee6[_0x184753(0x1e3)][_0x2da53f]=_0x295ad5;if(!_0x3939a4[_0x184753(0x1d9)]&&_0x6797f2!=undefined&&_0x6797f2==_0x295ad5)return null;const _0xade5ca=(_0x3939a4[_0x184753(0x1f8)]||'')[_0x184753(0x1f7)](),_0x56eea1=_0xade5ca[_0x184753(0x1d8)](_0x184753(0x205))||_0xade5ca['includes'](_0x184753(0x1c0))||_0xade5ca['includes'](_0x184753(0x1c9))||_0xade5ca['includes'](_0x184753(0x201))||_0xade5ca[_0x184753(0x1d8)]('thermostat');_0x8b3ee6[_0x184753(0x1c3)]&&_0x56eea1&&recordThermodynamics(_0x8b3ee6,_0x2da53f,_0x295ad5,_0x3939a4[_0x184753(0x1d7)]);const _0x46ed2c={'timestamp':_0x46b2ef,'id':_0x2da53f,'name':_0x3939a4[_0x184753(0x1cc)],'type':_0x3939a4[_0x184753(0x1f8)],'location':_0x3939a4[_0x184753(0x1d7)],'value':_0x295ad5};_0x8b3ee6[_0x184753(0x1f1)][_0x184753(0x20a)](_0x46ed2c);if(_0x8b3ee6[_0x184753(0x1f1)][_0x184753(0x1c2)]>HISTORY_MAX_SIZE)_0x8b3ee6[_0x184753(0x1f1)][_0x184753(0x1f0)]();await _0x8b3ee6[_0x184753(0x1de)](_0x184753(0x208),{'val':JSON[_0x184753(0x1c5)](_0x46ed2c),'ack':!![]}),await _0x8b3ee6['setStateAsync']('events.history',{'val':JSON['stringify'](_0x8b3ee6['eventHistory']),'ack':!![]});if(_0x8b3ee6[_0x184753(0x1c3)]){_0x8b3ee6['rawEventLog'][_0x184753(0x1ab)](_0x46ed2c);if(_0x8b3ee6[_0x184753(0x1f3)][_0x184753(0x1c2)]>RAW_LOG_MAX_SIZE)_0x8b3ee6[_0x184753(0x1f3)][_0x184753(0x1b5)](0x0,_0x8b3ee6[_0x184753(0x1f3)][_0x184753(0x1c2)]-RAW_LOG_MAX_SIZE);await _0x8b3ee6[_0x184753(0x1de)](_0x184753(0x1b4),{'val':JSON[_0x184753(0x1c5)](_0x8b3ee6[_0x184753(0x1f3)]),'ack':!![]}),recordSequence(_0x8b3ee6,_0x46ed2c);}if(_0x3939a4[_0x184753(0x1be)]&&_0x295ad5===!![]){if(_0x8b3ee6[_0x184753(0x200)]&&!_0x8b3ee6['isGracePeriodActive'])startExitTimer(_0x8b3ee6);else{if(!_0x8b3ee6[_0x184753(0x200)])setPresence(_0x8b3ee6,!![]);}}else{if(_0x3939a4[_0x184753(0x1f8)]===_0x184753(0x1e4)&&_0x295ad5===!![]){if(_0x8b3ee6[_0x184753(0x1cb)])abortExitTimer(_0x8b3ee6);if(!_0x8b3ee6[_0x184753(0x200)]&&_0x8b3ee6[_0x184753(0x1ef)]===_0x184753(0x1b3))setPresence(_0x8b3ee6,!![]);}}return _0x8b3ee6[_0x184753(0x1c3)]&&_0x3939a4[_0x184753(0x1f8)]==='motion'&&_0x295ad5===!![]&&_0x3939a4['location']&&_0x8b3ee6[_0x184753(0x1fb)]&&_0x8b3ee6[_0x184753(0x1fb)](_0x184753(0x1ae),{'room':_0x3939a4[_0x184753(0x1d7)]}),_0x46ed2c;}module[a5_0x13f1db(0x1f2)]={'processSensorEvent':processSensorEvent,'getOutsideTemperatureNumeric':getOutsideTemperatureNumeric,'setPresence':setPresence,'abortExitTimer':abortExitTimer,'startExitTimer':startExitTimer};