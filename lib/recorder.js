const a5_0x3a7cfa=a5_0x23ff;(function(_0x3cdce8,_0x28a2ee){const _0x2d14e5=a5_0x23ff,_0xa1b66a=_0x3cdce8();while(!![]){try{const _0x365418=-parseInt(_0x2d14e5(0x16b))/0x1+parseInt(_0x2d14e5(0x185))/0x2+-parseInt(_0x2d14e5(0x180))/0x3+-parseInt(_0x2d14e5(0x150))/0x4*(-parseInt(_0x2d14e5(0x15d))/0x5)+-parseInt(_0x2d14e5(0x18a))/0x6+-parseInt(_0x2d14e5(0x192))/0x7*(-parseInt(_0x2d14e5(0x16a))/0x8)+parseInt(_0x2d14e5(0x12f))/0x9;if(_0x365418===_0x28a2ee)break;else _0xa1b66a['push'](_0xa1b66a['shift']());}catch(_0x3ad483){_0xa1b66a['push'](_0xa1b66a['shift']());}}}(a5_0x2f6e,0xa2be9));const a5_0x13c246=(function(){let _0x57e5df=!![];return function(_0x418b09,_0x4be8c1){const _0x5c0a24=_0x57e5df?function(){const _0x43063f=a5_0x23ff;if(_0x4be8c1){const _0x2c7a63=_0x4be8c1[_0x43063f(0x124)](_0x418b09,arguments);return _0x4be8c1=null,_0x2c7a63;}}:function(){};return _0x57e5df=![],_0x5c0a24;};}()),a5_0x529df0=a5_0x13c246(this,function(){const _0x28250a=a5_0x23ff;return a5_0x529df0['toString']()[_0x28250a(0x13e)]('(((.+)+)+)+$')['toString']()['constructor'](a5_0x529df0)[_0x28250a(0x13e)](_0x28250a(0x128));});a5_0x529df0();'use strict';const HISTORY_MAX_SIZE=0x32,RAW_LOG_MAX_SIZE=0x9c4,THERMO_LOG_SIZE=0x3e8,SEQUENCE_TIMEOUT_MS=0x5*0x3c*0x3e8,MAX_TRAINING_SET_SIZE=0x1f4,EXIT_TIMER_MINUTES=0xf,EXIT_GRACE_PERIOD_SECONDS=0x1e;let activeSequence=[],sequenceTimer=null;async function getOutsideTemperatureNumeric(_0x153d9f){const _0x3000e0=a5_0x23ff;if(_0x153d9f['config'][_0x3000e0(0x139)])try{const _0x1fb340=await _0x153d9f['getForeignStateAsync'](_0x153d9f[_0x3000e0(0x127)][_0x3000e0(0x139)]);if(_0x1fb340&&_0x1fb340[_0x3000e0(0x176)]!==undefined&&_0x1fb340['val']!==null)return parseFloat(_0x1fb340[_0x3000e0(0x176)]);}catch(_0x5e3bdb){}const _0x5a8bb4=_0x153d9f[_0x3000e0(0x127)][_0x3000e0(0x16c)];if(!_0x153d9f[_0x3000e0(0x127)][_0x3000e0(0x13c)]||!_0x5a8bb4)return null;try{let _0x28d819='';if(_0x5a8bb4[_0x3000e0(0x184)]('accuweather'))_0x28d819=_0x5a8bb4+_0x3000e0(0x123);else{if(_0x5a8bb4[_0x3000e0(0x184)]('daswetter'))_0x28d819=_0x5a8bb4+'.NextHours.Location_1.Day_1.current.temp_value';else{if(_0x5a8bb4[_0x3000e0(0x184)]('openweathermap'))_0x28d819=_0x5a8bb4+_0x3000e0(0x167);else{if(_0x5a8bb4['includes'](_0x3000e0(0x144)))_0x28d819=_0x5a8bb4+_0x3000e0(0x183);}}}if(_0x28d819){const _0xa86b83=await _0x153d9f[_0x3000e0(0x173)](_0x28d819);if(_0xa86b83&&_0xa86b83[_0x3000e0(0x176)]!==undefined&&_0xa86b83['val']!==null)return parseFloat(_0xa86b83[_0x3000e0(0x176)]);}}catch(_0x501ae7){}return null;}function a5_0x2f6e(){const _0x1a4b56=['isGracePeriodActive','2213370IkCvtE','from','Unknown','.forecast.current.temp','includes','787436zDpKcd','STATE','window','.1.TEMPERATURE','pop','6112380NIARLC','TRACK_EVENT','light','location','log','number','klima','map','7xeoEvK','debug','.1.LEVEL','.Current.Temperature','apply','message','.1.ACTUAL_TEMPERATURE','config','(((.+)+)+)+$','toLowerCase','schloss','exports','licht','rawEventLog','sensorLastValues','15888915tlAxox','thermostat','Valve','exitGraceTimer','valveMapping','kontakt','logDuplicates','getHours','bewegung','some','outdoorSensorId','door','analysis.health.todayVector','useWeather','loc','search','isExit','sendToPythonWrapper','präsenz','dimmer','occupancy','weatherunderground','LTM.rawEventLog','setStateAsync','temperatur','STATUS','\x20from\x20','length','isProVersion','fenster','stringify','switch','LTM.trainingData.sequences','4FzXYvJ','.ACTUAL_TEMPERATURE','contact','round','motion','type','lastTrackerEventTime','now','getStateAsync','presence','.LEVEL','isPresent','.1.VALVE_STATE','3611675doVFxF','temperature','tür','.4.VALVE_STATE','LTM.trainingData.thermodynamics','level','exitTimer','[RECORDER]\x20Ignored\x20implausible\x20temperature:\x20','system.isPresent','SIMULATE_SIGNAL','.forecast.current.temperature','lampe','eventHistory','6436808qAiFBr','1262968cqSnnM','weatherInstance','toISOString','griff','push','events.history','shift','fill','getForeignStateAsync','schalter','unshift','val','ANALYZE_SEQUENCE','currentSystemMode','lock','handle','string','parse','splice','error'];a5_0x2f6e=function(){return _0x1a4b56;};return a5_0x2f6e();}async function recordThermodynamics(_0x5ce4ad,_0xd8cbd2,_0x301fd8,_0x34d4a9){const _0x10cfce=a5_0x23ff,_0x452360=await getOutsideTemperatureNumeric(_0x5ce4ad);if(_0x452360===null)return;let _0x16976b=0x0,_0x321b3e=![];if(_0x5ce4ad[_0x10cfce(0x127)][_0x10cfce(0x133)])try{let _0x466a6d=_0x5ce4ad['config']['valveMapping'];if(typeof _0x466a6d===_0x10cfce(0x17b))_0x466a6d=JSON['parse'](_0x466a6d);if(_0x466a6d[_0xd8cbd2]){const _0xa97962=_0x466a6d[_0xd8cbd2],_0x4cc7f2=await _0x5ce4ad[_0x10cfce(0x173)](_0xa97962);if(_0x4cc7f2&&_0x4cc7f2[_0x10cfce(0x176)]!==null&&_0x4cc7f2[_0x10cfce(0x176)]!==undefined){let _0x411629=Number(_0x4cc7f2[_0x10cfce(0x176)]);if(_0x411629<=1.05&&!_0xa97962[_0x10cfce(0x184)](_0x10cfce(0x148))&&!_0xa97962[_0x10cfce(0x184)](_0x10cfce(0x186)))_0x411629=_0x411629*0x64;_0x16976b=Math['round'](_0x411629),_0x321b3e=!![];}}}catch(_0x599bb3){}if(!_0x321b3e){const _0x12ebbc=[{'from':'.1.ACTUAL_TEMPERATURE','to':_0x10cfce(0x122)},{'from':_0x10cfce(0x126),'to':_0x10cfce(0x15c)},{'from':_0x10cfce(0x188),'to':_0x10cfce(0x160)},{'from':_0x10cfce(0x151),'to':_0x10cfce(0x15a)},{'from':_0x10cfce(0x15e),'to':_0x10cfce(0x162)},{'from':'Temperature','to':_0x10cfce(0x131)}];for(const _0x10a17d of _0x12ebbc){if(_0xd8cbd2[_0x10cfce(0x184)](_0x10a17d['from'])){const _0x3bacee=_0xd8cbd2['replace'](_0x10a17d[_0x10cfce(0x181)],_0x10a17d['to']);try{const _0x5dfc1b=await _0x5ce4ad[_0x10cfce(0x173)](_0x3bacee);if(_0x5dfc1b&&_0x5dfc1b[_0x10cfce(0x176)]!==null&&_0x5dfc1b['val']!==undefined){let _0x4eb751=Number(_0x5dfc1b[_0x10cfce(0x176)]);if(typeof _0x4eb751===_0x10cfce(0x18f)){if(_0x4eb751<=1.05&&_0x10a17d['to'][_0x10cfce(0x184)]('LEVEL'))_0x4eb751=_0x4eb751*0x64;_0x16976b=Math[_0x10cfce(0x153)](_0x4eb751),_0x321b3e=!![];break;}}}catch(_0xcede10){}}}}const _0x253cfa=await _0x5ce4ad[_0x10cfce(0x158)](_0x10cfce(0x161));let _0x22a3ee=[];if(_0x253cfa&&_0x253cfa['val'])try{_0x22a3ee=JSON[_0x10cfce(0x17c)](_0x253cfa[_0x10cfce(0x176)]);}catch(_0x472854){}_0x22a3ee[_0x10cfce(0x16f)]({'ts':Date[_0x10cfce(0x157)](),'room':_0x34d4a9||_0x10cfce(0x182),'t_in':_0x301fd8,'t_out':_0x452360,'valve':_0x16976b});if(_0x22a3ee[_0x10cfce(0x14a)]>THERMO_LOG_SIZE)_0x22a3ee[_0x10cfce(0x171)]();await _0x5ce4ad[_0x10cfce(0x146)](_0x10cfce(0x161),{'val':JSON[_0x10cfce(0x14d)](_0x22a3ee),'ack':!![]});}async function saveCompletedSequence(_0x2527c3){const _0x35e502=a5_0x23ff;try{const _0x5a2a46=await _0x2527c3[_0x35e502(0x158)]('LTM.trainingData.sequences');let _0xe4cba8=[];if(_0x5a2a46&&_0x5a2a46[_0x35e502(0x176)])try{_0xe4cba8=JSON['parse'](_0x5a2a46[_0x35e502(0x176)]);}catch(_0xbbe442){}const _0x13840f=activeSequence[0x0]['ts'],_0x365c26=activeSequence[_0x35e502(0x191)](_0x417d65=>({'loc':_0x417d65[_0x35e502(0x13d)],'t_delta':Math[_0x35e502(0x153)]((_0x417d65['ts']-_0x13840f)/0x3e8)})),_0x2d7cd9={'timestamp':new Date(_0x13840f)[_0x35e502(0x16d)](),'steps':_0x365c26,'duration':Math[_0x35e502(0x153)]((activeSequence[activeSequence[_0x35e502(0x14a)]-0x1]['ts']-_0x13840f)/0x3e8),'daytime':new Date(_0x13840f)['getHours']()};_0xe4cba8[_0x35e502(0x16f)](_0x2d7cd9);if(_0xe4cba8[_0x35e502(0x14a)]>MAX_TRAINING_SET_SIZE)_0xe4cba8[_0x35e502(0x171)]();await _0x2527c3[_0x35e502(0x146)](_0x35e502(0x14f),{'val':JSON['stringify'](_0xe4cba8),'ack':!![]}),_0x2527c3[_0x35e502(0x14b)]&&_0x2527c3[_0x35e502(0x140)]&&_0x2527c3[_0x35e502(0x140)](_0x35e502(0x177),{'sequence':_0x2d7cd9});}catch(_0x482e43){_0x2527c3[_0x35e502(0x18e)][_0x35e502(0x17e)]('[RECORDER]\x20Error:\x20'+_0x482e43[_0x35e502(0x125)]);}}async function recordSequence(_0x352a1d,_0x28b975){const _0x2e297e=a5_0x23ff,_0x4e9bb8=(_0x28b975[_0x2e297e(0x155)]||'')[_0x2e297e(0x129)](),_0x5667d3=['motion','bewegung',_0x2e297e(0x141),_0x2e297e(0x159),_0x2e297e(0x143),_0x2e297e(0x13a),_0x2e297e(0x15f),_0x2e297e(0x187),_0x2e297e(0x14c),_0x2e297e(0x152),_0x2e297e(0x134),_0x2e297e(0x18c),_0x2e297e(0x12c),_0x2e297e(0x14e),_0x2e297e(0x174),_0x2e297e(0x142),'lampe'];if(!_0x5667d3[_0x2e297e(0x138)](_0x31e57f=>_0x4e9bb8[_0x2e297e(0x184)](_0x31e57f)))return;if(!_0x28b975['value'])return;if(sequenceTimer)clearTimeout(sequenceTimer);activeSequence['push']({'loc':_0x28b975['location']||_0x2e297e(0x182),'id':_0x28b975['id'],'ts':Date['now']()}),sequenceTimer=setTimeout(async()=>{const _0x44b50e=_0x2e297e;if(activeSequence[_0x44b50e(0x14a)]>0x1)await saveCompletedSequence(_0x352a1d);activeSequence=[];},SEQUENCE_TIMEOUT_MS);}function startExitTimer(_0x343efd){abortExitTimer(_0x343efd),_0x343efd['isGracePeriodActive']=!![],_0x343efd['exitGraceTimer']=setTimeout(()=>{const _0x24a7ac=a5_0x23ff;_0x343efd[_0x24a7ac(0x17f)]=![];},EXIT_GRACE_PERIOD_SECONDS*0x3e8),_0x343efd['exitTimer']=setTimeout(()=>{const _0x7de0a9=a5_0x23ff;setPresence(_0x343efd,![]),_0x343efd[_0x7de0a9(0x163)]=null;},EXIT_TIMER_MINUTES*0x3c*0x3e8);}function a5_0x23ff(_0x50eef5,_0x52efe9){const _0x35e5d2=a5_0x2f6e();return a5_0x23ff=function(_0x529df0,_0x13c246){_0x529df0=_0x529df0-0x122;let _0x2f6e9e=_0x35e5d2[_0x529df0];return _0x2f6e9e;},a5_0x23ff(_0x50eef5,_0x52efe9);}function abortExitTimer(_0x56ac2a){const _0x4aed96=a5_0x23ff;if(_0x56ac2a[_0x4aed96(0x163)])clearTimeout(_0x56ac2a[_0x4aed96(0x163)]);if(_0x56ac2a[_0x4aed96(0x132)])clearTimeout(_0x56ac2a[_0x4aed96(0x132)]);_0x56ac2a[_0x4aed96(0x163)]=null,_0x56ac2a[_0x4aed96(0x132)]=null,_0x56ac2a[_0x4aed96(0x17f)]=![];}async function setPresence(_0x58c8fb,_0x3b07ed){const _0xbb4de9=a5_0x23ff;if(_0x58c8fb['isPresent']===_0x3b07ed)return;_0x58c8fb[_0xbb4de9(0x15b)]=_0x3b07ed,await _0x58c8fb[_0xbb4de9(0x146)](_0xbb4de9(0x165),{'val':_0x3b07ed,'ack':!![]});}async function updateHourlyActivity(_0x20053c){const _0x2c1296=a5_0x23ff;let _0x152ca9=new Array(0x18)['fill'](0x0),_0x134849=0x0;try{const _0x2bf8f4=await _0x20053c[_0x2c1296(0x158)](_0x2c1296(0x13b));_0x2bf8f4&&_0x2bf8f4[_0x2c1296(0x176)]&&(_0x152ca9=JSON[_0x2c1296(0x17c)](_0x2bf8f4[_0x2c1296(0x176)]),_0x134849=_0x2bf8f4['ts']);}catch(_0x5092a6){}const _0x526d6f=new Date(_0x134849),_0x132151=new Date();_0x526d6f['getDate']()!==_0x132151['getDate']()&&(_0x152ca9=new Array(0x18)[_0x2c1296(0x172)](0x0));const _0x370f57=_0x132151[_0x2c1296(0x136)]();if(_0x152ca9[_0x370f57]===undefined)_0x152ca9[_0x370f57]=0x0;_0x152ca9[_0x370f57]++,await _0x20053c[_0x2c1296(0x146)](_0x2c1296(0x13b),{'val':JSON[_0x2c1296(0x14d)](_0x152ca9),'ack':!![]});}async function processSensorEvent(_0xb48602,_0x3d54bb,_0x2b7bfb,_0x2663e0){const _0x45f310=a5_0x23ff;if(!_0x2663e0)return null;const _0x3105ef=_0x2b7bfb[_0x45f310(0x176)],_0x127555=Date[_0x45f310(0x157)](),_0x1d675c=_0xb48602[_0x45f310(0x12e)][_0x3d54bb],_0x3af880=(_0x2663e0[_0x45f310(0x155)]||'')[_0x45f310(0x129)](),_0x16e517=_0x3af880[_0x45f310(0x184)](_0x45f310(0x15e))||_0x3af880[_0x45f310(0x184)](_0x45f310(0x147))||_0x3af880[_0x45f310(0x184)](_0x45f310(0x190))||_0x3af880['includes']('heizung')||_0x3af880[_0x45f310(0x184)](_0x45f310(0x130));if(_0x16e517&&typeof _0x3105ef===_0x45f310(0x18f)){if(_0x3105ef>0x50||_0x3105ef<-0x32)return _0xb48602[_0x45f310(0x18e)][_0x45f310(0x193)](_0x45f310(0x164)+_0x3105ef+_0x45f310(0x149)+_0x3d54bb),null;}_0xb48602['sensorLastValues'][_0x3d54bb]=_0x3105ef;if(!_0x2663e0[_0x45f310(0x135)]&&_0x1d675c!=undefined&&_0x1d675c==_0x3105ef)return null;_0xb48602[_0x45f310(0x14b)]&&_0x16e517&&recordThermodynamics(_0xb48602,_0x3d54bb,_0x3105ef,_0x2663e0[_0x45f310(0x18d)]);const _0x3cef97={'timestamp':_0x127555,'id':_0x3d54bb,'name':_0x2663e0['name'],'type':_0x2663e0[_0x45f310(0x155)],'location':_0x2663e0[_0x45f310(0x18d)],'value':_0x3105ef};_0xb48602[_0x45f310(0x169)][_0x45f310(0x175)](_0x3cef97);if(_0xb48602[_0x45f310(0x169)][_0x45f310(0x14a)]>HISTORY_MAX_SIZE)_0xb48602['eventHistory'][_0x45f310(0x189)]();await _0xb48602['setStateAsync']('events.lastEvent',{'val':JSON[_0x45f310(0x14d)](_0x3cef97),'ack':!![]}),await _0xb48602['setStateAsync'](_0x45f310(0x170),{'val':JSON[_0x45f310(0x14d)](_0xb48602['eventHistory']),'ack':!![]}),await updateHourlyActivity(_0xb48602);if(_0xb48602['isProVersion']){_0xb48602[_0x45f310(0x12d)][_0x45f310(0x16f)](_0x3cef97);if(_0xb48602[_0x45f310(0x12d)][_0x45f310(0x14a)]>RAW_LOG_MAX_SIZE)_0xb48602['rawEventLog'][_0x45f310(0x17d)](0x0,_0xb48602[_0x45f310(0x12d)][_0x45f310(0x14a)]-RAW_LOG_MAX_SIZE);await _0xb48602['setStateAsync'](_0x45f310(0x145),{'val':JSON['stringify'](_0xb48602[_0x45f310(0x12d)]),'ack':!![]}),recordSequence(_0xb48602,_0x3cef97);}if(_0x2663e0[_0x45f310(0x13f)]&&_0x3105ef===!![]){if(_0xb48602['isPresent']&&!_0xb48602[_0x45f310(0x17f)])startExitTimer(_0xb48602);else{if(!_0xb48602['isPresent'])setPresence(_0xb48602,!![]);}}else{if(_0x2663e0[_0x45f310(0x155)]==='motion'&&_0x3105ef===!![]){if(_0xb48602[_0x45f310(0x163)])abortExitTimer(_0xb48602);if(!_0xb48602[_0x45f310(0x15b)]&&_0xb48602[_0x45f310(0x178)]==='normal')setPresence(_0xb48602,!![]);}}if(_0xb48602['isProVersion']&&_0xb48602[_0x45f310(0x140)]){_0x2663e0['type']==='motion'&&_0x3105ef===!![]&&_0x2663e0[_0x45f310(0x18d)]&&_0xb48602[_0x45f310(0x140)](_0x45f310(0x166),{'room':_0x2663e0[_0x45f310(0x18d)]});const _0x55c948=[_0x45f310(0x13a),_0x45f310(0x15f),_0x45f310(0x187),_0x45f310(0x14c),_0x45f310(0x16e),_0x45f310(0x17a),_0x45f310(0x179),_0x45f310(0x12a)][_0x45f310(0x138)](_0x1a604c=>_0x3af880[_0x45f310(0x184)](_0x1a604c)),_0x36214d=[_0x45f310(0x18c),_0x45f310(0x12c),_0x45f310(0x14e),'schalter',_0x45f310(0x142),_0x45f310(0x168)]['some'](_0x22038a=>_0x3af880[_0x45f310(0x184)](_0x22038a)),_0x9d18fc=[_0x45f310(0x154),_0x45f310(0x137),_0x45f310(0x141),'presence','occupancy'][_0x45f310(0x138)](_0x5c1cfb=>_0x3af880[_0x45f310(0x184)](_0x5c1cfb));if(_0x2663e0['location']&&(_0x55c948||_0x36214d||_0x9d18fc)){const _0x2839a0=_0x3105ef===!![]||typeof _0x3105ef===_0x45f310(0x18f)&&_0x3105ef>0x0,_0x94bd24=_0x55c948&&!_0x2839a0&&_0x1d675c!==undefined&&_0x1d675c!=_0x3105ef;if(_0x2839a0||_0x94bd24){const _0x2f80ed=_0xb48602[_0x45f310(0x156)]||_0x127555,_0x569de8=(_0x127555-_0x2f80ed)/0x3e8;_0xb48602['lastTrackerEventTime']=_0x127555,_0xb48602[_0x45f310(0x140)](_0x45f310(0x18b),{'room':_0x2663e0[_0x45f310(0x18d)],'dt':_0x569de8});}}}return _0x3cef97;}module[a5_0x3a7cfa(0x12b)]={'processSensorEvent':processSensorEvent,'getOutsideTemperatureNumeric':getOutsideTemperatureNumeric,'setPresence':setPresence,'abortExitTimer':abortExitTimer,'startExitTimer':startExitTimer};