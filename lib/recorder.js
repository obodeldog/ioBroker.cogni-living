const a5_0x4d81d2=a5_0x4511;(function(_0x255925,_0x393a41){const _0x3f86ce=a5_0x4511,_0x30687a=_0x255925();while(!![]){try{const _0x37e172=parseInt(_0x3f86ce(0x11d))/0x1*(-parseInt(_0x3f86ce(0x113))/0x2)+parseInt(_0x3f86ce(0xe6))/0x3+-parseInt(_0x3f86ce(0x116))/0x4*(parseInt(_0x3f86ce(0x125))/0x5)+parseInt(_0x3f86ce(0xdc))/0x6+parseInt(_0x3f86ce(0x105))/0x7+-parseInt(_0x3f86ce(0x131))/0x8+parseInt(_0x3f86ce(0xf3))/0x9*(parseInt(_0x3f86ce(0x12b))/0xa);if(_0x37e172===_0x393a41)break;else _0x30687a['push'](_0x30687a['shift']());}catch(_0x5ea1f5){_0x30687a['push'](_0x30687a['shift']());}}}(a5_0x21d0,0x1d2bd));const a5_0x2571d1=(function(){let _0x3aaa05=!![];return function(_0x415975,_0x19cd3f){const _0x35b5f4=_0x3aaa05?function(){const _0x457760=a5_0x4511;if(_0x19cd3f){const _0x5c21c0=_0x19cd3f[_0x457760(0x101)](_0x415975,arguments);return _0x19cd3f=null,_0x5c21c0;}}:function(){};return _0x3aaa05=![],_0x35b5f4;};}()),a5_0x535371=a5_0x2571d1(this,function(){const _0x4bfe54=a5_0x4511;return a5_0x535371[_0x4bfe54(0xd6)]()[_0x4bfe54(0x112)](_0x4bfe54(0xf7))['toString']()[_0x4bfe54(0x11a)](a5_0x535371)[_0x4bfe54(0x112)]('(((.+)+)+)+$');});function a5_0x21d0(){const _0x22db20=['STATE','rawEventLog','exitGraceTimer','getHours','143160MLdMnT','loc','daswetter','some','type','exports','schalter','push','from','LTM.rawEventLog','length','map','light','2178mRRhge','getForeignStateAsync','useWeather','contact','(((.+)+)+)+$','.ACTUAL_TEMPERATURE','message','isPresent','toISOString','parse','accuweather','value','string','isProVersion','apply','location','shift','val','141183rrypNP','.LEVEL','openweathermap','unshift','.Current.Temperature','normal','pop','valveMapping','bewegung','events.history','splice','heizung','sensorLastValues','search','270jXxpnW','exitTimer','currentSystemMode','88jsIYDo','outdoorSensorId','events.lastEvent','LTM.trainingData.thermodynamics','constructor','window','sendToPythonWrapper','1706aMKLcy','präsenz','.1.ACTUAL_TEMPERATURE','occupancy','Unknown','STATUS','SIMULATE_SIGNAL','config','30900bwdDwh','lampe','Valve','.forecast.current.temp','temperature','setStateAsync','18570faURRM','.1.TEMPERATURE','weatherInstance','getStateAsync','logDuplicates','eventHistory','1420192WPADBo','motion','tür','licht','number','[RECORDER]\x20Error:\x20','LTM.trainingData.sequences','.NextHours.Location_1.Day_1.current.temp_value','error','round','ANALYZE_SEQUENCE','level','toString','stringify','klima','replace','kontakt','.4.VALVE_STATE','875976dDklVb','isExit','now','.forecast.current.temperature','includes','isGracePeriodActive'];a5_0x21d0=function(){return _0x22db20;};return a5_0x21d0();}a5_0x535371();'use strict';const HISTORY_MAX_SIZE=0x32,RAW_LOG_MAX_SIZE=0x9c4,THERMO_LOG_SIZE=0x3e8,SEQUENCE_TIMEOUT_MS=0x5*0x3c*0x3e8,MAX_TRAINING_SET_SIZE=0x1f4,EXIT_TIMER_MINUTES=0xf,EXIT_GRACE_PERIOD_SECONDS=0x1e;let activeSequence=[],sequenceTimer=null;async function getOutsideTemperatureNumeric(_0x586d5f){const _0x1718f5=a5_0x4511;if(_0x586d5f[_0x1718f5(0x124)]['outdoorSensorId'])try{const _0x3f8c27=await _0x586d5f[_0x1718f5(0xf4)](_0x586d5f['config'][_0x1718f5(0x117)]);if(_0x3f8c27&&_0x3f8c27['val']!==undefined&&_0x3f8c27['val']!==null)return parseFloat(_0x3f8c27[_0x1718f5(0x104)]);}catch(_0x5670e5){}const _0x20a877=_0x586d5f['config'][_0x1718f5(0x12d)];if(!_0x586d5f[_0x1718f5(0x124)][_0x1718f5(0xf5)]||!_0x20a877)return null;try{let _0x606ccb='';if(_0x20a877[_0x1718f5(0xe0)](_0x1718f5(0xfd)))_0x606ccb=_0x20a877+_0x1718f5(0x109);else{if(_0x20a877[_0x1718f5(0xe0)](_0x1718f5(0xe8)))_0x606ccb=_0x20a877+_0x1718f5(0x138);else{if(_0x20a877[_0x1718f5(0xe0)](_0x1718f5(0x107)))_0x606ccb=_0x20a877+_0x1718f5(0xdf);else{if(_0x20a877[_0x1718f5(0xe0)]('weatherunderground'))_0x606ccb=_0x20a877+_0x1718f5(0x128);}}}if(_0x606ccb){const _0x47c8e9=await _0x586d5f[_0x1718f5(0xf4)](_0x606ccb);if(_0x47c8e9&&_0x47c8e9[_0x1718f5(0x104)]!==undefined&&_0x47c8e9[_0x1718f5(0x104)]!==null)return parseFloat(_0x47c8e9[_0x1718f5(0x104)]);}}catch(_0x113ad2){}return null;}async function recordThermodynamics(_0x84b1a2,_0x53dec7,_0x4a414d,_0x27fc34){const _0x34ba5c=a5_0x4511,_0x2537ab=await getOutsideTemperatureNumeric(_0x84b1a2);if(_0x2537ab===null)return;let _0x170e31=0x0,_0x3e8bea=![];if(_0x84b1a2[_0x34ba5c(0x124)][_0x34ba5c(0x10c)])try{let _0x2338f8=_0x84b1a2[_0x34ba5c(0x124)][_0x34ba5c(0x10c)];if(typeof _0x2338f8===_0x34ba5c(0xff))_0x2338f8=JSON[_0x34ba5c(0xfc)](_0x2338f8);if(_0x2338f8[_0x53dec7]){const _0x46e9ec=_0x2338f8[_0x53dec7],_0x579e4e=await _0x84b1a2[_0x34ba5c(0xf4)](_0x46e9ec);if(_0x579e4e&&_0x579e4e[_0x34ba5c(0x104)]!==null&&_0x579e4e[_0x34ba5c(0x104)]!==undefined){let _0x52c424=Number(_0x579e4e[_0x34ba5c(0x104)]);if(_0x52c424<=1.05&&!_0x46e9ec[_0x34ba5c(0xe0)](_0x34ba5c(0x122))&&!_0x46e9ec[_0x34ba5c(0xe0)](_0x34ba5c(0xe2)))_0x52c424=_0x52c424*0x64;_0x170e31=Math[_0x34ba5c(0xd3)](_0x52c424),_0x3e8bea=!![];}}}catch(_0x2a7152){}if(!_0x3e8bea){const _0x34213d=[{'from':_0x34ba5c(0x11f),'to':'.1.LEVEL'},{'from':'.1.ACTUAL_TEMPERATURE','to':'.1.VALVE_STATE'},{'from':_0x34ba5c(0x12c),'to':_0x34ba5c(0xdb)},{'from':_0x34ba5c(0xf8),'to':_0x34ba5c(0x106)},{'from':_0x34ba5c(0x129),'to':_0x34ba5c(0xd5)},{'from':'Temperature','to':_0x34ba5c(0x127)}];for(const _0xdc69 of _0x34213d){if(_0x53dec7[_0x34ba5c(0xe0)](_0xdc69[_0x34ba5c(0xee)])){const _0x1b0113=_0x53dec7[_0x34ba5c(0xd9)](_0xdc69[_0x34ba5c(0xee)],_0xdc69['to']);try{const _0x36d131=await _0x84b1a2[_0x34ba5c(0xf4)](_0x1b0113);if(_0x36d131&&_0x36d131['val']!==null&&_0x36d131[_0x34ba5c(0x104)]!==undefined){let _0x3c7fde=Number(_0x36d131[_0x34ba5c(0x104)]);if(typeof _0x3c7fde===_0x34ba5c(0x135)){if(_0x3c7fde<=1.05&&_0xdc69['to']['includes']('LEVEL'))_0x3c7fde=_0x3c7fde*0x64;_0x170e31=Math[_0x34ba5c(0xd3)](_0x3c7fde),_0x3e8bea=!![];break;}}}catch(_0x45f923){}}}}const _0x553c34=await _0x84b1a2['getStateAsync']('LTM.trainingData.thermodynamics');let _0x5616ed=[];if(_0x553c34&&_0x553c34[_0x34ba5c(0x104)])try{_0x5616ed=JSON['parse'](_0x553c34['val']);}catch(_0x59eb34){}_0x5616ed[_0x34ba5c(0xed)]({'ts':Date[_0x34ba5c(0xde)](),'room':_0x27fc34||'Unknown','t_in':_0x4a414d,'t_out':_0x2537ab,'valve':_0x170e31});if(_0x5616ed['length']>THERMO_LOG_SIZE)_0x5616ed[_0x34ba5c(0x103)]();await _0x84b1a2[_0x34ba5c(0x12a)](_0x34ba5c(0x119),{'val':JSON[_0x34ba5c(0xd7)](_0x5616ed),'ack':!![]});}async function saveCompletedSequence(_0x53b27e){const _0x41f6d7=a5_0x4511;try{const _0x592d42=await _0x53b27e[_0x41f6d7(0x12e)]('LTM.trainingData.sequences');let _0x3c3428=[];if(_0x592d42&&_0x592d42[_0x41f6d7(0x104)])try{_0x3c3428=JSON[_0x41f6d7(0xfc)](_0x592d42[_0x41f6d7(0x104)]);}catch(_0x363328){}const _0x45743e=activeSequence[0x0]['ts'],_0x297b2d=activeSequence[_0x41f6d7(0xf1)](_0x51b727=>({'loc':_0x51b727[_0x41f6d7(0xe7)],'t_delta':Math[_0x41f6d7(0xd3)]((_0x51b727['ts']-_0x45743e)/0x3e8)})),_0xb1cd81={'timestamp':new Date(_0x45743e)[_0x41f6d7(0xfb)](),'steps':_0x297b2d,'duration':Math['round']((activeSequence[activeSequence[_0x41f6d7(0xf0)]-0x1]['ts']-_0x45743e)/0x3e8),'daytime':new Date(_0x45743e)[_0x41f6d7(0xe5)]()};_0x3c3428[_0x41f6d7(0xed)](_0xb1cd81);if(_0x3c3428[_0x41f6d7(0xf0)]>MAX_TRAINING_SET_SIZE)_0x3c3428[_0x41f6d7(0x103)]();await _0x53b27e[_0x41f6d7(0x12a)](_0x41f6d7(0x137),{'val':JSON['stringify'](_0x3c3428),'ack':!![]}),_0x53b27e[_0x41f6d7(0x100)]&&_0x53b27e[_0x41f6d7(0x11c)]&&_0x53b27e[_0x41f6d7(0x11c)](_0x41f6d7(0xd4),{'sequence':_0xb1cd81});}catch(_0x1c4076){_0x53b27e['log'][_0x41f6d7(0xd2)](_0x41f6d7(0x136)+_0x1c4076[_0x41f6d7(0xf9)]);}}async function recordSequence(_0x40ccf1,_0x166499){const _0x5e593f=a5_0x4511,_0x522563=(_0x166499[_0x5e593f(0xea)]||'')['toLowerCase'](),_0x3aa473=['motion',_0x5e593f(0x10d),_0x5e593f(0x11e),'presence',_0x5e593f(0x120),'door',_0x5e593f(0x133),_0x5e593f(0x11b),'fenster',_0x5e593f(0xf6),_0x5e593f(0xda),_0x5e593f(0xf2),_0x5e593f(0x134),'switch',_0x5e593f(0xec),'dimmer',_0x5e593f(0x126)];if(!_0x3aa473[_0x5e593f(0xe9)](_0x4053b1=>_0x522563['includes'](_0x4053b1)))return;if(!_0x166499[_0x5e593f(0xfe)])return;if(sequenceTimer)clearTimeout(sequenceTimer);activeSequence['push']({'loc':_0x166499[_0x5e593f(0x102)]||_0x5e593f(0x121),'id':_0x166499['id'],'ts':Date[_0x5e593f(0xde)]()}),sequenceTimer=setTimeout(async()=>{if(activeSequence['length']>0x1)await saveCompletedSequence(_0x40ccf1);activeSequence=[];},SEQUENCE_TIMEOUT_MS);}function startExitTimer(_0x62f338){const _0x452d03=a5_0x4511;abortExitTimer(_0x62f338),_0x62f338[_0x452d03(0xe1)]=!![],_0x62f338[_0x452d03(0xe4)]=setTimeout(()=>{_0x62f338['isGracePeriodActive']=![];},EXIT_GRACE_PERIOD_SECONDS*0x3e8),_0x62f338[_0x452d03(0x114)]=setTimeout(()=>{setPresence(_0x62f338,![]),_0x62f338['exitTimer']=null;},EXIT_TIMER_MINUTES*0x3c*0x3e8);}function a5_0x4511(_0x545914,_0x5ec2bb){const _0x5a84e0=a5_0x21d0();return a5_0x4511=function(_0x535371,_0x2571d1){_0x535371=_0x535371-0xd2;let _0x21d0bc=_0x5a84e0[_0x535371];return _0x21d0bc;},a5_0x4511(_0x545914,_0x5ec2bb);}function abortExitTimer(_0x23eae8){const _0x15fabd=a5_0x4511;if(_0x23eae8[_0x15fabd(0x114)])clearTimeout(_0x23eae8[_0x15fabd(0x114)]);if(_0x23eae8[_0x15fabd(0xe4)])clearTimeout(_0x23eae8[_0x15fabd(0xe4)]);_0x23eae8[_0x15fabd(0x114)]=null,_0x23eae8[_0x15fabd(0xe4)]=null,_0x23eae8['isGracePeriodActive']=![];}async function setPresence(_0x5c1721,_0x2a71d8){const _0x361738=a5_0x4511;if(_0x5c1721[_0x361738(0xfa)]===_0x2a71d8)return;_0x5c1721[_0x361738(0xfa)]=_0x2a71d8,await _0x5c1721[_0x361738(0x12a)]('system.isPresent',{'val':_0x2a71d8,'ack':!![]});}async function processSensorEvent(_0x23bcb6,_0x42082c,_0x4b3936,_0x27c78b){const _0x364496=a5_0x4511;if(!_0x27c78b)return null;const _0x20324a=_0x4b3936[_0x364496(0x104)],_0x18f176=Date[_0x364496(0xde)](),_0x4aada3=_0x23bcb6[_0x364496(0x111)][_0x42082c];_0x23bcb6[_0x364496(0x111)][_0x42082c]=_0x20324a;if(!_0x27c78b[_0x364496(0x12f)]&&_0x4aada3!=undefined&&_0x4aada3==_0x20324a)return null;const _0x598c15=(_0x27c78b[_0x364496(0xea)]||'')['toLowerCase'](),_0x39380e=_0x598c15[_0x364496(0xe0)]('temperature')||_0x598c15[_0x364496(0xe0)]('temperatur')||_0x598c15[_0x364496(0xe0)](_0x364496(0xd8))||_0x598c15[_0x364496(0xe0)](_0x364496(0x110))||_0x598c15[_0x364496(0xe0)]('thermostat');_0x23bcb6['isProVersion']&&_0x39380e&&recordThermodynamics(_0x23bcb6,_0x42082c,_0x20324a,_0x27c78b[_0x364496(0x102)]);const _0x490862={'timestamp':_0x18f176,'id':_0x42082c,'name':_0x27c78b['name'],'type':_0x27c78b[_0x364496(0xea)],'location':_0x27c78b[_0x364496(0x102)],'value':_0x20324a};_0x23bcb6[_0x364496(0x130)][_0x364496(0x108)](_0x490862);if(_0x23bcb6[_0x364496(0x130)]['length']>HISTORY_MAX_SIZE)_0x23bcb6[_0x364496(0x130)][_0x364496(0x10b)]();await _0x23bcb6['setStateAsync'](_0x364496(0x118),{'val':JSON[_0x364496(0xd7)](_0x490862),'ack':!![]}),await _0x23bcb6[_0x364496(0x12a)](_0x364496(0x10e),{'val':JSON[_0x364496(0xd7)](_0x23bcb6[_0x364496(0x130)]),'ack':!![]});if(_0x23bcb6[_0x364496(0x100)]){_0x23bcb6[_0x364496(0xe3)][_0x364496(0xed)](_0x490862);if(_0x23bcb6[_0x364496(0xe3)][_0x364496(0xf0)]>RAW_LOG_MAX_SIZE)_0x23bcb6[_0x364496(0xe3)][_0x364496(0x10f)](0x0,_0x23bcb6[_0x364496(0xe3)][_0x364496(0xf0)]-RAW_LOG_MAX_SIZE);await _0x23bcb6['setStateAsync'](_0x364496(0xef),{'val':JSON['stringify'](_0x23bcb6[_0x364496(0xe3)]),'ack':!![]}),recordSequence(_0x23bcb6,_0x490862);}if(_0x27c78b[_0x364496(0xdd)]&&_0x20324a===!![]){if(_0x23bcb6[_0x364496(0xfa)]&&!_0x23bcb6['isGracePeriodActive'])startExitTimer(_0x23bcb6);else{if(!_0x23bcb6['isPresent'])setPresence(_0x23bcb6,!![]);}}else{if(_0x27c78b[_0x364496(0xea)]==='motion'&&_0x20324a===!![]){if(_0x23bcb6[_0x364496(0x114)])abortExitTimer(_0x23bcb6);if(!_0x23bcb6[_0x364496(0xfa)]&&_0x23bcb6[_0x364496(0x115)]===_0x364496(0x10a))setPresence(_0x23bcb6,!![]);}}return _0x23bcb6[_0x364496(0x100)]&&_0x27c78b['type']===_0x364496(0x132)&&_0x20324a===!![]&&_0x27c78b['location']&&_0x23bcb6[_0x364496(0x11c)]&&_0x23bcb6[_0x364496(0x11c)](_0x364496(0x123),{'room':_0x27c78b[_0x364496(0x102)]}),_0x490862;}module[a5_0x4d81d2(0xeb)]={'processSensorEvent':processSensorEvent,'getOutsideTemperatureNumeric':getOutsideTemperatureNumeric,'setPresence':setPresence,'abortExitTimer':abortExitTimer,'startExitTimer':startExitTimer};