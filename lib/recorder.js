const a4_0x1d05a6=a4_0x46ae;(function(_0x15f8f1,_0x35abaf){const _0xe9a79a=a4_0x46ae,_0x276ce9=_0x15f8f1();while(!![]){try{const _0x1a2cab=-parseInt(_0xe9a79a(0x16c))/0x1+-parseInt(_0xe9a79a(0x172))/0x2+-parseInt(_0xe9a79a(0x1a2))/0x3+-parseInt(_0xe9a79a(0x16f))/0x4*(-parseInt(_0xe9a79a(0x177))/0x5)+parseInt(_0xe9a79a(0x182))/0x6*(parseInt(_0xe9a79a(0x166))/0x7)+-parseInt(_0xe9a79a(0x18a))/0x8*(-parseInt(_0xe9a79a(0x1a1))/0x9)+parseInt(_0xe9a79a(0x156))/0xa;if(_0x1a2cab===_0x35abaf)break;else _0x276ce9['push'](_0x276ce9['shift']());}catch(_0x2a5950){_0x276ce9['push'](_0x276ce9['shift']());}}}(a4_0x45d2,0x36b51));const a4_0x512e4b=(function(){let _0x1c75e8=!![];return function(_0x5e09e6,_0x1b7019){const _0x3cae24=_0x1c75e8?function(){const _0x550d55=a4_0x46ae;if(_0x1b7019){const _0xb30ed6=_0x1b7019[_0x550d55(0x15a)](_0x5e09e6,arguments);return _0x1b7019=null,_0xb30ed6;}}:function(){};return _0x1c75e8=![],_0x3cae24;};}()),a4_0x512bdd=a4_0x512e4b(this,function(){const _0x1ce770=a4_0x46ae;return a4_0x512bdd['toString']()[_0x1ce770(0x19a)](_0x1ce770(0x154))[_0x1ce770(0x15e)]()['constructor'](a4_0x512bdd)[_0x1ce770(0x19a)](_0x1ce770(0x154));});a4_0x512bdd();function a4_0x46ae(_0x286270,_0x3359b6){const _0x3e15c5=a4_0x45d2();return a4_0x46ae=function(_0x512bdd,_0x512e4b){_0x512bdd=_0x512bdd-0x152;let _0x45d2bd=_0x3e15c5[_0x512bdd];return _0x45d2bd;},a4_0x46ae(_0x286270,_0x3359b6);}'use strict';const HISTORY_MAX_SIZE=0x32,RAW_LOG_MAX_SIZE=0x9c4,THERMO_LOG_SIZE=0x3e8,SEQUENCE_TIMEOUT_MS=0x5*0x3c*0x3e8,MAX_TRAINING_SET_SIZE=0x1f4,EXIT_TIMER_MINUTES=0xf,EXIT_GRACE_PERIOD_SECONDS=0x1e;let activeSequence=[],sequenceTimer=null;async function getOutsideTemperatureNumeric(_0x4dcfde){const _0x3cdcad=a4_0x46ae;if(_0x4dcfde[_0x3cdcad(0x171)][_0x3cdcad(0x19c)])try{const _0x5bd017=await _0x4dcfde['getForeignStateAsync'](_0x4dcfde[_0x3cdcad(0x171)]['outdoorSensorId']);if(_0x5bd017&&_0x5bd017['val']!==undefined&&_0x5bd017[_0x3cdcad(0x170)]!==null)return parseFloat(_0x5bd017[_0x3cdcad(0x170)]);}catch(_0x801895){}const _0x3c3c87=_0x4dcfde['config'][_0x3cdcad(0x15f)];if(!_0x4dcfde['config'][_0x3cdcad(0x1a5)]||!_0x3c3c87)return null;try{let _0x4ab2cf='';if(_0x3c3c87[_0x3cdcad(0x161)](_0x3cdcad(0x173)))_0x4ab2cf=_0x3c3c87+_0x3cdcad(0x162);else{if(_0x3c3c87[_0x3cdcad(0x161)](_0x3cdcad(0x164)))_0x4ab2cf=_0x3c3c87+_0x3cdcad(0x16e);else{if(_0x3c3c87['includes'](_0x3cdcad(0x152)))_0x4ab2cf=_0x3c3c87+_0x3cdcad(0x185);else{if(_0x3c3c87[_0x3cdcad(0x161)](_0x3cdcad(0x1a3)))_0x4ab2cf=_0x3c3c87+_0x3cdcad(0x18e);}}}if(_0x4ab2cf){const _0x3fbd3b=await _0x4dcfde[_0x3cdcad(0x19e)](_0x4ab2cf);if(_0x3fbd3b&&_0x3fbd3b[_0x3cdcad(0x170)]!==undefined&&_0x3fbd3b[_0x3cdcad(0x170)]!==null)return parseFloat(_0x3fbd3b['val']);}}catch(_0x2026f8){}return null;}function a4_0x45d2(){const _0x376722=['apply','sensorLastValues','motion','isPresent','toString','weatherInstance','isGracePeriodActive','includes','.Current.Temperature','toLowerCase','daswetter','normal','7iKqBbo','lampe','round','logDuplicates','length','loc','383877VrYAmh','switch','.NextHours.Location_1.Day_1.current.temp_value','522200ESLgMj','val','config','423242qOdxGz','accuweather','rawEventLog','LTM.trainingData.sequences','name','10xfMVht','window','push','events.history','exitTimer','parse','[RECORDER]\x20Error:\x20','eventHistory','now','isProVersion','presence','522666ykwzwg','system.isPresent','klima','.forecast.current.temperature','map','ANALYZE_SEQUENCE','light','schalter','9184SVObLp','setStateAsync','isExit','contact','.forecast.current.temp','SIMULATE_SIGNAL','exitGraceTimer','type','getHours','LTM.trainingData.thermodynamics','temperatur','door','LTM.rawEventLog','exports','message','shift','search','sendToPythonWrapper','outdoorSensorId','dimmer','getForeignStateAsync','toISOString','stringify','369tgWptW','422895VDdLhJ','weatherunderground','bewegung','useWeather','openweathermap','currentSystemMode','(((.+)+)+)+$','value','5652650lSWjMV','error','location','temperature'];a4_0x45d2=function(){return _0x376722;};return a4_0x45d2();}async function recordThermodynamics(_0x397ee4,_0xafe852,_0xe2b360,_0x1654f6){const _0x51cbc7=a4_0x46ae,_0x5e1ba4=await getOutsideTemperatureNumeric(_0x397ee4),_0x4d9690=await _0x397ee4['getStateAsync'](_0x51cbc7(0x193));let _0x1d4603=[];if(_0x4d9690&&_0x4d9690[_0x51cbc7(0x170)])try{_0x1d4603=JSON['parse'](_0x4d9690[_0x51cbc7(0x170)]);}catch(_0x4fe793){}_0x1d4603[_0x51cbc7(0x179)]({'ts':Date[_0x51cbc7(0x17f)](),'room':_0x1654f6||'Unknown','t_in':_0xe2b360,'t_out':_0x5e1ba4});if(_0x1d4603[_0x51cbc7(0x16a)]>THERMO_LOG_SIZE)_0x1d4603[_0x51cbc7(0x199)]();await _0x397ee4[_0x51cbc7(0x18b)](_0x51cbc7(0x193),{'val':JSON[_0x51cbc7(0x1a0)](_0x1d4603),'ack':!![]});}async function saveCompletedSequence(_0x32b485){const _0x36cb7a=a4_0x46ae;try{const _0x18ebfa=await _0x32b485['getStateAsync'](_0x36cb7a(0x175));let _0x30cead=[];if(_0x18ebfa&&_0x18ebfa[_0x36cb7a(0x170)])try{_0x30cead=JSON[_0x36cb7a(0x17c)](_0x18ebfa['val']);}catch(_0x346ae2){}const _0x1132ca=activeSequence[0x0]['ts'],_0x2f291a=activeSequence[_0x36cb7a(0x186)](_0x448c53=>({'loc':_0x448c53[_0x36cb7a(0x16b)],'t_delta':Math[_0x36cb7a(0x168)]((_0x448c53['ts']-_0x1132ca)/0x3e8)})),_0x537418={'timestamp':new Date(_0x1132ca)[_0x36cb7a(0x19f)](),'steps':_0x2f291a,'duration':Math[_0x36cb7a(0x168)]((activeSequence[activeSequence[_0x36cb7a(0x16a)]-0x1]['ts']-_0x1132ca)/0x3e8),'daytime':new Date(_0x1132ca)[_0x36cb7a(0x192)]()};_0x30cead['push'](_0x537418);if(_0x30cead[_0x36cb7a(0x16a)]>MAX_TRAINING_SET_SIZE)_0x30cead[_0x36cb7a(0x199)]();await _0x32b485[_0x36cb7a(0x18b)](_0x36cb7a(0x175),{'val':JSON[_0x36cb7a(0x1a0)](_0x30cead),'ack':!![]}),_0x32b485['isProVersion']&&_0x32b485[_0x36cb7a(0x19b)]&&_0x32b485[_0x36cb7a(0x19b)](_0x36cb7a(0x187),{'sequence':_0x537418});}catch(_0x3cfdb1){_0x32b485['log'][_0x36cb7a(0x157)](_0x36cb7a(0x17d)+_0x3cfdb1[_0x36cb7a(0x198)]);}}async function recordSequence(_0x312d84,_0x348b53){const _0x33488c=a4_0x46ae,_0x4912af=(_0x348b53['type']||'')[_0x33488c(0x163)](),_0x28021d=['motion',_0x33488c(0x1a4),'präsenz',_0x33488c(0x181),'occupancy',_0x33488c(0x195),'tür',_0x33488c(0x178),'fenster',_0x33488c(0x18d),'kontakt',_0x33488c(0x188),'licht',_0x33488c(0x16d),_0x33488c(0x189),_0x33488c(0x19d),_0x33488c(0x167)];if(!_0x28021d['some'](_0x417604=>_0x4912af[_0x33488c(0x161)](_0x417604)))return;if(!_0x348b53[_0x33488c(0x155)])return;if(sequenceTimer)clearTimeout(sequenceTimer);activeSequence[_0x33488c(0x179)]({'loc':_0x348b53[_0x33488c(0x158)]||'Unknown','id':_0x348b53['id'],'ts':Date[_0x33488c(0x17f)]()}),sequenceTimer=setTimeout(async()=>{const _0x13e55c=_0x33488c;if(activeSequence[_0x13e55c(0x16a)]>0x1)await saveCompletedSequence(_0x312d84);activeSequence=[];},SEQUENCE_TIMEOUT_MS);}function startExitTimer(_0x3bb1c4){const _0x2f2d9e=a4_0x46ae;abortExitTimer(_0x3bb1c4),_0x3bb1c4[_0x2f2d9e(0x160)]=!![],_0x3bb1c4[_0x2f2d9e(0x190)]=setTimeout(()=>{const _0x3b6e80=_0x2f2d9e;_0x3bb1c4[_0x3b6e80(0x160)]=![];},EXIT_GRACE_PERIOD_SECONDS*0x3e8),_0x3bb1c4[_0x2f2d9e(0x17b)]=setTimeout(()=>{const _0x32616f=_0x2f2d9e;setPresence(_0x3bb1c4,![]),_0x3bb1c4[_0x32616f(0x17b)]=null;},EXIT_TIMER_MINUTES*0x3c*0x3e8);}function abortExitTimer(_0x350665){const _0x43d0ed=a4_0x46ae;if(_0x350665['exitTimer'])clearTimeout(_0x350665['exitTimer']);if(_0x350665[_0x43d0ed(0x190)])clearTimeout(_0x350665['exitGraceTimer']);_0x350665[_0x43d0ed(0x17b)]=null,_0x350665[_0x43d0ed(0x190)]=null,_0x350665[_0x43d0ed(0x160)]=![];}async function setPresence(_0x265049,_0x39ae7e){const _0xec8642=a4_0x46ae;if(_0x265049['isPresent']===_0x39ae7e)return;_0x265049['isPresent']=_0x39ae7e,await _0x265049['setStateAsync'](_0xec8642(0x183),{'val':_0x39ae7e,'ack':!![]});}async function processSensorEvent(_0x2d48cf,_0x236000,_0x509b10,_0xa8d431){const _0x5b5014=a4_0x46ae;if(!_0xa8d431)return;const _0x2341b9=_0x509b10[_0x5b5014(0x170)],_0x44958=Date[_0x5b5014(0x17f)](),_0x52fd4f=_0x2d48cf[_0x5b5014(0x15b)][_0x236000];_0x2d48cf['sensorLastValues'][_0x236000]=_0x2341b9;if(!_0xa8d431[_0x5b5014(0x169)]&&_0x52fd4f!=undefined&&_0x52fd4f==_0x2341b9)return;const _0x6ec8d7=(_0xa8d431[_0x5b5014(0x191)]||'')[_0x5b5014(0x163)](),_0x298097=_0x6ec8d7['includes'](_0x5b5014(0x159))||_0x6ec8d7[_0x5b5014(0x161)](_0x5b5014(0x194))||_0x6ec8d7[_0x5b5014(0x161)](_0x5b5014(0x184))||_0x6ec8d7[_0x5b5014(0x161)]('heizung');_0x2d48cf[_0x5b5014(0x180)]&&_0x298097&&recordThermodynamics(_0x2d48cf,_0x236000,_0x2341b9,_0xa8d431[_0x5b5014(0x158)]);const _0x5a8a9d={'timestamp':_0x44958,'id':_0x236000,'name':_0xa8d431[_0x5b5014(0x176)],'type':_0xa8d431['type'],'location':_0xa8d431[_0x5b5014(0x158)],'value':_0x2341b9};_0x2d48cf[_0x5b5014(0x17e)]['unshift'](_0x5a8a9d);if(_0x2d48cf[_0x5b5014(0x17e)]['length']>HISTORY_MAX_SIZE)_0x2d48cf['eventHistory']['pop']();await _0x2d48cf['setStateAsync']('events.lastEvent',{'val':JSON['stringify'](_0x5a8a9d),'ack':!![]}),await _0x2d48cf[_0x5b5014(0x18b)](_0x5b5014(0x17a),{'val':JSON[_0x5b5014(0x1a0)](_0x2d48cf['eventHistory']),'ack':!![]});if(_0x2d48cf['isProVersion']){_0x2d48cf[_0x5b5014(0x174)][_0x5b5014(0x179)](_0x5a8a9d);if(_0x2d48cf[_0x5b5014(0x174)][_0x5b5014(0x16a)]>RAW_LOG_MAX_SIZE)_0x2d48cf['rawEventLog']['splice'](0x0,_0x2d48cf[_0x5b5014(0x174)][_0x5b5014(0x16a)]-RAW_LOG_MAX_SIZE);await _0x2d48cf[_0x5b5014(0x18b)](_0x5b5014(0x196),{'val':JSON[_0x5b5014(0x1a0)](_0x2d48cf['rawEventLog']),'ack':!![]}),recordSequence(_0x2d48cf,_0x5a8a9d);}if(_0xa8d431[_0x5b5014(0x18c)]&&_0x2341b9===!![]){if(_0x2d48cf['isPresent']&&!_0x2d48cf[_0x5b5014(0x160)])startExitTimer(_0x2d48cf);else{if(!_0x2d48cf[_0x5b5014(0x15d)])setPresence(_0x2d48cf,!![]);}}else{if(_0xa8d431[_0x5b5014(0x191)]===_0x5b5014(0x15c)&&_0x2341b9===!![]){if(_0x2d48cf[_0x5b5014(0x17b)])abortExitTimer(_0x2d48cf);if(!_0x2d48cf[_0x5b5014(0x15d)]&&_0x2d48cf[_0x5b5014(0x153)]===_0x5b5014(0x165))setPresence(_0x2d48cf,!![]);}}_0x2d48cf[_0x5b5014(0x180)]&&_0xa8d431['type']===_0x5b5014(0x15c)&&_0x2341b9===!![]&&_0xa8d431[_0x5b5014(0x158)]&&_0x2d48cf[_0x5b5014(0x19b)]&&_0x2d48cf[_0x5b5014(0x19b)](_0x5b5014(0x18f),{'room':_0xa8d431[_0x5b5014(0x158)]});}module[a4_0x1d05a6(0x197)]={'processSensorEvent':processSensorEvent,'getOutsideTemperatureNumeric':getOutsideTemperatureNumeric,'setPresence':setPresence,'abortExitTimer':abortExitTimer,'startExitTimer':startExitTimer};