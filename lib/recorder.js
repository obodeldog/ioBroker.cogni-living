const a4_0x51b12a=a4_0x2ff1;function a4_0x5c29(){const _0x342192=['currentSystemMode','tür','ANALYZE_SEQUENCE','LTM.rawEventLog','2528436YvgxDs','5VJIydW','klima','log','präsenz','318683nTEFni','unshift','exitTimer','stringify','fenster','map','toLowerCase','328XLXxhP','Unknown','isProVersion','temperature','isPresent','lampe','LTM.trainingData.sequences','3323111ykNUDt','temperatur','shift','2OqZEVX','2149916kMhORy','constructor','eventHistory','switch','light','round','openweathermap','pop','getStateAsync','isExit','getHours','isGracePeriodActive','SIMULATE_SIGNAL','(((.+)+)+)+$','sendToPythonWrapper','loc','config','setStateAsync','exports','LTM.trainingData.thermodynamics','motion','licht','logDuplicates','42111gUqiTb','apply','539034XQkGCD','39MHxGCk','includes','3xAtNrm','rawEventLog','getForeignStateAsync','weatherInstance','2045365RPoJdO','val','push','outdoorSensorId','.NextHours.Location_1.Day_1.current.temp_value','useWeather','type','error','events.history','search','now','some','normal','sensorLastValues','exitGraceTimer','location','[RECORDER]\x20Error:\x20','.Current.Temperature','20yuKMNd','length','message','toString','system.isPresent','parse','value','door','bewegung','.forecast.current.temp','.forecast.current.temperature'];a4_0x5c29=function(){return _0x342192;};return a4_0x5c29();}(function(_0x25917e,_0x71f0d9){const _0x4a05ab=a4_0x2ff1,_0x390dd4=_0x25917e();while(!![]){try{const _0x46e9ba=parseInt(_0x4a05ab(0x1fc))/0x1*(-parseInt(_0x4a05ab(0x20d))/0x2)+parseInt(_0x4a05ab(0x1d2))/0x3*(-parseInt(_0x4a05ab(0x20e))/0x4)+parseInt(_0x4a05ab(0x1f8))/0x5*(parseInt(_0x4a05ab(0x1cf))/0x6)+parseInt(_0x4a05ab(0x1d6))/0x7+-parseInt(_0x4a05ab(0x203))/0x8*(parseInt(_0x4a05ab(0x1cd))/0x9)+-parseInt(_0x4a05ab(0x1e8))/0xa*(-parseInt(_0x4a05ab(0x20a))/0xb)+-parseInt(_0x4a05ab(0x1f7))/0xc*(-parseInt(_0x4a05ab(0x1d0))/0xd);if(_0x46e9ba===_0x71f0d9)break;else _0x390dd4['push'](_0x390dd4['shift']());}catch(_0x51ec9b){_0x390dd4['push'](_0x390dd4['shift']());}}}(a4_0x5c29,0x8b3e8));const a4_0x49875a=(function(){let _0x48198f=!![];return function(_0x599c15,_0x436598){const _0x194492=_0x48198f?function(){const _0x4fdf0e=a4_0x2ff1;if(_0x436598){const _0x1016d1=_0x436598[_0x4fdf0e(0x1ce)](_0x599c15,arguments);return _0x436598=null,_0x1016d1;}}:function(){};return _0x48198f=![],_0x194492;};}()),a4_0xfa9c0b=a4_0x49875a(this,function(){const _0x487c98=a4_0x2ff1;return a4_0xfa9c0b[_0x487c98(0x1eb)]()['search'](_0x487c98(0x1c3))['toString']()[_0x487c98(0x20f)](a4_0xfa9c0b)[_0x487c98(0x1df)](_0x487c98(0x1c3));});function a4_0x2ff1(_0x24a081,_0x513eb5){const _0x18edbb=a4_0x5c29();return a4_0x2ff1=function(_0xfa9c0b,_0x49875a){_0xfa9c0b=_0xfa9c0b-0x1bc;let _0x5c29a9=_0x18edbb[_0xfa9c0b];return _0x5c29a9;},a4_0x2ff1(_0x24a081,_0x513eb5);}a4_0xfa9c0b();'use strict';const HISTORY_MAX_SIZE=0x32,RAW_LOG_MAX_SIZE=0x9c4,THERMO_LOG_SIZE=0x3e8,SEQUENCE_TIMEOUT_MS=0x5*0x3c*0x3e8,MAX_TRAINING_SET_SIZE=0x1f4,EXIT_TIMER_MINUTES=0xf,EXIT_GRACE_PERIOD_SECONDS=0x1e;let activeSequence=[],sequenceTimer=null;async function getOutsideTemperatureNumeric(_0x27d865){const _0x17b77e=a4_0x2ff1;if(_0x27d865[_0x17b77e(0x1c6)][_0x17b77e(0x1d9)])try{const _0x39a5cd=await _0x27d865[_0x17b77e(0x1d4)](_0x27d865['config']['outdoorSensorId']);if(_0x39a5cd&&_0x39a5cd['val']!==undefined&&_0x39a5cd[_0x17b77e(0x1d7)]!==null)return parseFloat(_0x39a5cd[_0x17b77e(0x1d7)]);}catch(_0x22c77e){}const _0x1c3984=_0x27d865[_0x17b77e(0x1c6)][_0x17b77e(0x1d5)];if(!_0x27d865[_0x17b77e(0x1c6)][_0x17b77e(0x1db)]||!_0x1c3984)return null;try{let _0xfa6225='';if(_0x1c3984[_0x17b77e(0x1d1)]('accuweather'))_0xfa6225=_0x1c3984+_0x17b77e(0x1e7);else{if(_0x1c3984['includes']('daswetter'))_0xfa6225=_0x1c3984+_0x17b77e(0x1da);else{if(_0x1c3984[_0x17b77e(0x1d1)](_0x17b77e(0x1bc)))_0xfa6225=_0x1c3984+_0x17b77e(0x1f2);else{if(_0x1c3984['includes']('weatherunderground'))_0xfa6225=_0x1c3984+_0x17b77e(0x1f1);}}}if(_0xfa6225){const _0x4767f9=await _0x27d865[_0x17b77e(0x1d4)](_0xfa6225);if(_0x4767f9&&_0x4767f9['val']!==undefined&&_0x4767f9[_0x17b77e(0x1d7)]!==null)return parseFloat(_0x4767f9['val']);}}catch(_0x3b7418){}return null;}async function recordThermodynamics(_0x129536,_0x38e347,_0x1f963d,_0x10d1be){const _0x2e8e7a=a4_0x2ff1,_0x7f6631=await getOutsideTemperatureNumeric(_0x129536),_0x298a9b=await _0x129536[_0x2e8e7a(0x1be)]('LTM.trainingData.thermodynamics');let _0x345ca3=[];if(_0x298a9b&&_0x298a9b[_0x2e8e7a(0x1d7)])try{_0x345ca3=JSON[_0x2e8e7a(0x1ed)](_0x298a9b[_0x2e8e7a(0x1d7)]);}catch(_0x18b647){}_0x345ca3[_0x2e8e7a(0x1d8)]({'ts':Date[_0x2e8e7a(0x1e0)](),'room':_0x10d1be||'Unknown','t_in':_0x1f963d,'t_out':_0x7f6631});if(_0x345ca3['length']>THERMO_LOG_SIZE)_0x345ca3[_0x2e8e7a(0x20c)]();await _0x129536[_0x2e8e7a(0x1c7)](_0x2e8e7a(0x1c9),{'val':JSON['stringify'](_0x345ca3),'ack':!![]});}async function saveCompletedSequence(_0x52c208){const _0x486c8c=a4_0x2ff1;try{const _0x384ede=await _0x52c208[_0x486c8c(0x1be)](_0x486c8c(0x209));let _0x21d6f3=[];if(_0x384ede&&_0x384ede[_0x486c8c(0x1d7)])try{_0x21d6f3=JSON[_0x486c8c(0x1ed)](_0x384ede['val']);}catch(_0x4a4a24){}const _0x318df2=activeSequence[0x0]['ts'],_0x4cc86a=activeSequence[_0x486c8c(0x201)](_0xb0f88=>({'loc':_0xb0f88[_0x486c8c(0x1c5)],'t_delta':Math[_0x486c8c(0x213)]((_0xb0f88['ts']-_0x318df2)/0x3e8)})),_0x375a0d={'timestamp':new Date(_0x318df2)['toISOString'](),'steps':_0x4cc86a,'duration':Math[_0x486c8c(0x213)]((activeSequence[activeSequence[_0x486c8c(0x1e9)]-0x1]['ts']-_0x318df2)/0x3e8),'daytime':new Date(_0x318df2)[_0x486c8c(0x1c0)]()};_0x21d6f3[_0x486c8c(0x1d8)](_0x375a0d);if(_0x21d6f3[_0x486c8c(0x1e9)]>MAX_TRAINING_SET_SIZE)_0x21d6f3[_0x486c8c(0x20c)]();await _0x52c208[_0x486c8c(0x1c7)](_0x486c8c(0x209),{'val':JSON[_0x486c8c(0x1ff)](_0x21d6f3),'ack':!![]}),_0x52c208[_0x486c8c(0x205)]&&_0x52c208[_0x486c8c(0x1c4)]&&_0x52c208[_0x486c8c(0x1c4)](_0x486c8c(0x1f5),{'sequence':_0x375a0d});}catch(_0x4bdc43){_0x52c208[_0x486c8c(0x1fa)][_0x486c8c(0x1dd)](_0x486c8c(0x1e6)+_0x4bdc43[_0x486c8c(0x1ea)]);}}async function recordSequence(_0x17a66e,_0x3e38c5){const _0x1cb8a3=a4_0x2ff1,_0x4dd30d=(_0x3e38c5[_0x1cb8a3(0x1dc)]||'')[_0x1cb8a3(0x202)](),_0x18c48f=[_0x1cb8a3(0x1ca),_0x1cb8a3(0x1f0),_0x1cb8a3(0x1fb),'presence','occupancy',_0x1cb8a3(0x1ef),_0x1cb8a3(0x1f4),'window',_0x1cb8a3(0x200),'contact','kontakt',_0x1cb8a3(0x212),_0x1cb8a3(0x1cb),_0x1cb8a3(0x211),'schalter','dimmer',_0x1cb8a3(0x208)];if(!_0x18c48f[_0x1cb8a3(0x1e1)](_0x3f1118=>_0x4dd30d[_0x1cb8a3(0x1d1)](_0x3f1118)))return;if(!_0x3e38c5[_0x1cb8a3(0x1ee)])return;if(sequenceTimer)clearTimeout(sequenceTimer);activeSequence['push']({'loc':_0x3e38c5[_0x1cb8a3(0x1e5)]||_0x1cb8a3(0x204),'id':_0x3e38c5['id'],'ts':Date[_0x1cb8a3(0x1e0)]()}),sequenceTimer=setTimeout(async()=>{const _0x56b2e0=_0x1cb8a3;if(activeSequence[_0x56b2e0(0x1e9)]>0x1)await saveCompletedSequence(_0x17a66e);activeSequence=[];},SEQUENCE_TIMEOUT_MS);}function startExitTimer(_0x50a6dd){const _0x293949=a4_0x2ff1;abortExitTimer(_0x50a6dd),_0x50a6dd[_0x293949(0x1c1)]=!![],_0x50a6dd[_0x293949(0x1e4)]=setTimeout(()=>{const _0x1a6bf6=_0x293949;_0x50a6dd[_0x1a6bf6(0x1c1)]=![];},EXIT_GRACE_PERIOD_SECONDS*0x3e8),_0x50a6dd[_0x293949(0x1fe)]=setTimeout(()=>{const _0x4cf8ce=_0x293949;setPresence(_0x50a6dd,![]),_0x50a6dd[_0x4cf8ce(0x1fe)]=null;},EXIT_TIMER_MINUTES*0x3c*0x3e8);}function abortExitTimer(_0x21f343){const _0x1fc106=a4_0x2ff1;if(_0x21f343[_0x1fc106(0x1fe)])clearTimeout(_0x21f343[_0x1fc106(0x1fe)]);if(_0x21f343[_0x1fc106(0x1e4)])clearTimeout(_0x21f343[_0x1fc106(0x1e4)]);_0x21f343[_0x1fc106(0x1fe)]=null,_0x21f343[_0x1fc106(0x1e4)]=null,_0x21f343[_0x1fc106(0x1c1)]=![];}async function setPresence(_0x47dbf5,_0x2bfaa3){const _0xa68df1=a4_0x2ff1;if(_0x47dbf5[_0xa68df1(0x207)]===_0x2bfaa3)return;_0x47dbf5[_0xa68df1(0x207)]=_0x2bfaa3,await _0x47dbf5[_0xa68df1(0x1c7)](_0xa68df1(0x1ec),{'val':_0x2bfaa3,'ack':!![]});}async function processSensorEvent(_0x43c33a,_0x267374,_0x447be3,_0xbe84dd){const _0x559964=a4_0x2ff1;if(!_0xbe84dd)return;const _0x207cec=_0x447be3['val'],_0x20fa3f=Date[_0x559964(0x1e0)](),_0x39a53b=_0x43c33a['sensorLastValues'][_0x267374];_0x43c33a[_0x559964(0x1e3)][_0x267374]=_0x207cec;if(!_0xbe84dd[_0x559964(0x1cc)]&&_0x39a53b!=undefined&&_0x39a53b==_0x207cec)return;const _0x1e352a=(_0xbe84dd[_0x559964(0x1dc)]||'')[_0x559964(0x202)](),_0x477789=_0x1e352a[_0x559964(0x1d1)](_0x559964(0x206))||_0x1e352a[_0x559964(0x1d1)](_0x559964(0x20b))||_0x1e352a[_0x559964(0x1d1)](_0x559964(0x1f9))||_0x1e352a[_0x559964(0x1d1)]('heizung');_0x43c33a[_0x559964(0x205)]&&_0x477789&&recordThermodynamics(_0x43c33a,_0x267374,_0x207cec,_0xbe84dd[_0x559964(0x1e5)]);const _0x5447bd={'timestamp':_0x20fa3f,'id':_0x267374,'name':_0xbe84dd['name'],'type':_0xbe84dd[_0x559964(0x1dc)],'location':_0xbe84dd[_0x559964(0x1e5)],'value':_0x207cec};_0x43c33a[_0x559964(0x210)][_0x559964(0x1fd)](_0x5447bd);if(_0x43c33a[_0x559964(0x210)][_0x559964(0x1e9)]>HISTORY_MAX_SIZE)_0x43c33a['eventHistory'][_0x559964(0x1bd)]();await _0x43c33a[_0x559964(0x1c7)]('events.lastEvent',{'val':JSON[_0x559964(0x1ff)](_0x5447bd),'ack':!![]}),await _0x43c33a[_0x559964(0x1c7)](_0x559964(0x1de),{'val':JSON[_0x559964(0x1ff)](_0x43c33a['eventHistory']),'ack':!![]});if(_0x43c33a[_0x559964(0x205)]){_0x43c33a[_0x559964(0x1d3)][_0x559964(0x1d8)](_0x5447bd);if(_0x43c33a['rawEventLog'][_0x559964(0x1e9)]>RAW_LOG_MAX_SIZE)_0x43c33a[_0x559964(0x1d3)]['splice'](0x0,_0x43c33a[_0x559964(0x1d3)][_0x559964(0x1e9)]-RAW_LOG_MAX_SIZE);await _0x43c33a[_0x559964(0x1c7)](_0x559964(0x1f6),{'val':JSON[_0x559964(0x1ff)](_0x43c33a[_0x559964(0x1d3)]),'ack':!![]}),recordSequence(_0x43c33a,_0x5447bd);}if(_0xbe84dd[_0x559964(0x1bf)]&&_0x207cec===!![]){if(_0x43c33a[_0x559964(0x207)]&&!_0x43c33a[_0x559964(0x1c1)])startExitTimer(_0x43c33a);else{if(!_0x43c33a['isPresent'])setPresence(_0x43c33a,!![]);}}else{if(_0xbe84dd[_0x559964(0x1dc)]===_0x559964(0x1ca)&&_0x207cec===!![]){if(_0x43c33a[_0x559964(0x1fe)])abortExitTimer(_0x43c33a);if(!_0x43c33a[_0x559964(0x207)]&&_0x43c33a[_0x559964(0x1f3)]===_0x559964(0x1e2))setPresence(_0x43c33a,!![]);}}_0x43c33a[_0x559964(0x205)]&&_0xbe84dd[_0x559964(0x1dc)]===_0x559964(0x1ca)&&_0x207cec===!![]&&_0xbe84dd['location']&&_0x43c33a['sendToPythonWrapper']&&_0x43c33a['sendToPythonWrapper'](_0x559964(0x1c2),{'room':_0xbe84dd[_0x559964(0x1e5)]});}module[a4_0x51b12a(0x1c8)]={'processSensorEvent':processSensorEvent,'getOutsideTemperatureNumeric':getOutsideTemperatureNumeric,'setPresence':setPresence,'abortExitTimer':abortExitTimer,'startExitTimer':startExitTimer};