const a5_0x5dfe9d=a5_0xe3d1;(function(_0x46adcb,_0x247c5d){const _0x5c7717=a5_0xe3d1,_0x1694bb=_0x46adcb();while(!![]){try{const _0x241528=parseInt(_0x5c7717(0x125))/0x1*(-parseInt(_0x5c7717(0x123))/0x2)+parseInt(_0x5c7717(0x11c))/0x3+parseInt(_0x5c7717(0x109))/0x4*(parseInt(_0x5c7717(0x160))/0x5)+-parseInt(_0x5c7717(0x11e))/0x6*(parseInt(_0x5c7717(0x130))/0x7)+-parseInt(_0x5c7717(0x158))/0x8+-parseInt(_0x5c7717(0x106))/0x9*(parseInt(_0x5c7717(0x155))/0xa)+parseInt(_0x5c7717(0x10b))/0xb;if(_0x241528===_0x247c5d)break;else _0x1694bb['push'](_0x1694bb['shift']());}catch(_0x398f61){_0x1694bb['push'](_0x1694bb['shift']());}}}(a5_0x4847,0xa01e5));const a5_0x3e9dc0=(function(){let _0x427502=!![];return function(_0x440bf6,_0x33aa04){const _0x2fd31b=_0x427502?function(){if(_0x33aa04){const _0x1e6fe8=_0x33aa04['apply'](_0x440bf6,arguments);return _0x33aa04=null,_0x1e6fe8;}}:function(){};return _0x427502=![],_0x2fd31b;};}()),a5_0x1d5eb4=a5_0x3e9dc0(this,function(){const _0x21a61a=a5_0xe3d1;return a5_0x1d5eb4[_0x21a61a(0x10c)]()[_0x21a61a(0x120)](_0x21a61a(0x13a))[_0x21a61a(0x10c)]()[_0x21a61a(0x127)](a5_0x1d5eb4)[_0x21a61a(0x120)](_0x21a61a(0x13a));});a5_0x1d5eb4();'use strict';const HISTORY_MAX_SIZE=0x32,RAW_LOG_MAX_SIZE=0x9c4,THERMO_LOG_SIZE=0x3e8,SEQUENCE_TIMEOUT_MS=0x5*0x3c*0x3e8,MAX_TRAINING_SET_SIZE=0x1f4,EXIT_TIMER_MINUTES=0xf,EXIT_GRACE_PERIOD_SECONDS=0x1e;let activeSequence=[],sequenceTimer=null;async function getOutsideTemperatureNumeric(_0x41e83c){const _0x5efab2=a5_0xe3d1;if(_0x41e83c['config'][_0x5efab2(0x14b)])try{const _0x5a60a8=await _0x41e83c['getForeignStateAsync'](_0x41e83c[_0x5efab2(0x10a)]['outdoorSensorId']);if(_0x5a60a8&&_0x5a60a8['val']!==undefined&&_0x5a60a8[_0x5efab2(0x149)]!==null)return parseFloat(_0x5a60a8[_0x5efab2(0x149)]);}catch(_0x17a89c){}const _0x1f957e=_0x41e83c['config'][_0x5efab2(0xfa)];if(!_0x41e83c[_0x5efab2(0x10a)][_0x5efab2(0x12f)]||!_0x1f957e)return null;try{let _0x293bff='';if(_0x1f957e[_0x5efab2(0x121)](_0x5efab2(0x101)))_0x293bff=_0x1f957e+_0x5efab2(0x15b);else{if(_0x1f957e['includes'](_0x5efab2(0x145)))_0x293bff=_0x1f957e+_0x5efab2(0x108);else{if(_0x1f957e[_0x5efab2(0x121)](_0x5efab2(0x105)))_0x293bff=_0x1f957e+_0x5efab2(0x12b);else{if(_0x1f957e[_0x5efab2(0x121)](_0x5efab2(0x118)))_0x293bff=_0x1f957e+_0x5efab2(0x129);}}}if(_0x293bff){const _0x4d6f7b=await _0x41e83c[_0x5efab2(0xf9)](_0x293bff);if(_0x4d6f7b&&_0x4d6f7b[_0x5efab2(0x149)]!==undefined&&_0x4d6f7b[_0x5efab2(0x149)]!==null)return parseFloat(_0x4d6f7b[_0x5efab2(0x149)]);}}catch(_0x5568c1){}return null;}async function recordThermodynamics(_0x2bd570,_0x53b85f,_0x46a08b,_0x4ea773){const _0x317064=a5_0xe3d1,_0x5f1bf3=await getOutsideTemperatureNumeric(_0x2bd570);if(_0x5f1bf3===null)return;let _0x41ea0c=0x0,_0x3599d3=![];if(_0x2bd570[_0x317064(0x10a)][_0x317064(0xfc)])try{let _0x3472fe=_0x2bd570[_0x317064(0x10a)]['valveMapping'];if(typeof _0x3472fe===_0x317064(0xf8))_0x3472fe=JSON[_0x317064(0x110)](_0x3472fe);if(_0x3472fe[_0x53b85f]){const _0x59d3c1=_0x3472fe[_0x53b85f],_0x480571=await _0x2bd570[_0x317064(0xf9)](_0x59d3c1);if(_0x480571&&_0x480571[_0x317064(0x149)]!==null&&_0x480571[_0x317064(0x149)]!==undefined){let _0x3f804b=Number(_0x480571[_0x317064(0x149)]);if(_0x3f804b<=1.05&&!_0x59d3c1['includes']('STATUS')&&!_0x59d3c1[_0x317064(0x121)](_0x317064(0x12a)))_0x3f804b=_0x3f804b*0x64;_0x41ea0c=Math[_0x317064(0x153)](_0x3f804b),_0x3599d3=!![];}}}catch(_0x334dce){}if(!_0x3599d3){const _0x7b95da=[{'from':_0x317064(0xfe),'to':_0x317064(0x11b)},{'from':_0x317064(0xfe),'to':_0x317064(0x134)},{'from':_0x317064(0x138),'to':_0x317064(0x167)},{'from':_0x317064(0x12e),'to':_0x317064(0x13f)},{'from':'temperature','to':_0x317064(0x131)},{'from':'Temperature','to':_0x317064(0x115)}];for(const _0x51f12d of _0x7b95da){if(_0x53b85f[_0x317064(0x121)](_0x51f12d[_0x317064(0x137)])){const _0x51f9d3=_0x53b85f[_0x317064(0xff)](_0x51f12d[_0x317064(0x137)],_0x51f12d['to']);try{const _0x138f05=await _0x2bd570[_0x317064(0xf9)](_0x51f9d3);if(_0x138f05&&_0x138f05[_0x317064(0x149)]!==null&&_0x138f05['val']!==undefined){let _0xf65802=Number(_0x138f05[_0x317064(0x149)]);if(typeof _0xf65802===_0x317064(0x154)){if(_0xf65802<=1.05&&_0x51f12d['to'][_0x317064(0x121)](_0x317064(0x152)))_0xf65802=_0xf65802*0x64;_0x41ea0c=Math['round'](_0xf65802),_0x3599d3=!![];break;}}}catch(_0x2c6cee){}}}}const _0x22b597=await _0x2bd570[_0x317064(0x15a)]('LTM.trainingData.thermodynamics');let _0x4085c4=[];if(_0x22b597&&_0x22b597[_0x317064(0x149)])try{_0x4085c4=JSON['parse'](_0x22b597['val']);}catch(_0x5b7868){}_0x4085c4[_0x317064(0x163)]({'ts':Date[_0x317064(0xfd)](),'room':_0x4ea773||_0x317064(0x100),'t_in':_0x46a08b,'t_out':_0x5f1bf3,'valve':_0x41ea0c});if(_0x4085c4[_0x317064(0x11f)]>THERMO_LOG_SIZE)_0x4085c4[_0x317064(0x14d)]();await _0x2bd570[_0x317064(0x113)](_0x317064(0x139),{'val':JSON[_0x317064(0x136)](_0x4085c4),'ack':!![]});}async function saveCompletedSequence(_0x459c61){const _0x32854b=a5_0xe3d1;try{const _0x5e9b3a=await _0x459c61['getStateAsync'](_0x32854b(0x104));let _0xa3cd47=[];if(_0x5e9b3a&&_0x5e9b3a[_0x32854b(0x149)])try{_0xa3cd47=JSON['parse'](_0x5e9b3a[_0x32854b(0x149)]);}catch(_0xeda13e){}const _0x534a02=activeSequence[0x0]['ts'],_0xc678e4=activeSequence[_0x32854b(0x14a)](_0x24ad22=>({'loc':_0x24ad22['loc'],'t_delta':Math[_0x32854b(0x153)]((_0x24ad22['ts']-_0x534a02)/0x3e8)})),_0x29eebe={'timestamp':new Date(_0x534a02)[_0x32854b(0x140)](),'steps':_0xc678e4,'duration':Math['round']((activeSequence[activeSequence[_0x32854b(0x11f)]-0x1]['ts']-_0x534a02)/0x3e8),'daytime':new Date(_0x534a02)[_0x32854b(0x103)]()};_0xa3cd47[_0x32854b(0x163)](_0x29eebe);if(_0xa3cd47['length']>MAX_TRAINING_SET_SIZE)_0xa3cd47[_0x32854b(0x14d)]();await _0x459c61[_0x32854b(0x113)](_0x32854b(0x104),{'val':JSON[_0x32854b(0x136)](_0xa3cd47),'ack':!![]}),_0x459c61[_0x32854b(0x12c)]&&_0x459c61['sendToPythonWrapper']&&_0x459c61['sendToPythonWrapper'](_0x32854b(0x165),{'sequence':_0x29eebe});}catch(_0x3014e0){_0x459c61[_0x32854b(0x132)][_0x32854b(0x11a)](_0x32854b(0x107)+_0x3014e0[_0x32854b(0x119)]);}}function a5_0xe3d1(_0x2320b9,_0x323d5d){const _0x381d36=a5_0x4847();return a5_0xe3d1=function(_0x1d5eb4,_0x3e9dc0){_0x1d5eb4=_0x1d5eb4-0xf5;let _0x484796=_0x381d36[_0x1d5eb4];return _0x484796;},a5_0xe3d1(_0x2320b9,_0x323d5d);}async function recordSequence(_0x1dceac,_0x5688d2){const _0x17a4f1=a5_0xe3d1,_0x12f3aa=(_0x5688d2[_0x17a4f1(0x133)]||'')[_0x17a4f1(0x15f)](),_0x340abe=[_0x17a4f1(0xf6),_0x17a4f1(0x13c),_0x17a4f1(0x10f),'presence',_0x17a4f1(0xf7),_0x17a4f1(0x146),_0x17a4f1(0x141),'window',_0x17a4f1(0x116),_0x17a4f1(0x161),_0x17a4f1(0x117),'light','licht','switch',_0x17a4f1(0x159),_0x17a4f1(0x15e),_0x17a4f1(0x13b)];if(!_0x340abe[_0x17a4f1(0x128)](_0x14f883=>_0x12f3aa[_0x17a4f1(0x121)](_0x14f883)))return;if(!_0x5688d2[_0x17a4f1(0x124)])return;if(sequenceTimer)clearTimeout(sequenceTimer);activeSequence['push']({'loc':_0x5688d2[_0x17a4f1(0x114)]||_0x17a4f1(0x100),'id':_0x5688d2['id'],'ts':Date['now']()}),sequenceTimer=setTimeout(async()=>{if(activeSequence['length']>0x1)await saveCompletedSequence(_0x1dceac);activeSequence=[];},SEQUENCE_TIMEOUT_MS);}function startExitTimer(_0x36138f){const _0x48c5c8=a5_0xe3d1;abortExitTimer(_0x36138f),_0x36138f[_0x48c5c8(0x156)]=!![],_0x36138f[_0x48c5c8(0x164)]=setTimeout(()=>{const _0x4f0ffd=_0x48c5c8;_0x36138f[_0x4f0ffd(0x156)]=![];},EXIT_GRACE_PERIOD_SECONDS*0x3e8),_0x36138f['exitTimer']=setTimeout(()=>{const _0x31d815=_0x48c5c8;setPresence(_0x36138f,![]),_0x36138f[_0x31d815(0x144)]=null;},EXIT_TIMER_MINUTES*0x3c*0x3e8);}function abortExitTimer(_0x5d361f){const _0x10f2d1=a5_0xe3d1;if(_0x5d361f[_0x10f2d1(0x144)])clearTimeout(_0x5d361f[_0x10f2d1(0x144)]);if(_0x5d361f['exitGraceTimer'])clearTimeout(_0x5d361f['exitGraceTimer']);_0x5d361f[_0x10f2d1(0x144)]=null,_0x5d361f[_0x10f2d1(0x164)]=null,_0x5d361f['isGracePeriodActive']=![];}async function setPresence(_0x5da804,_0x2f2b97){const _0x5ec348=a5_0xe3d1;if(_0x5da804[_0x5ec348(0x166)]===_0x2f2b97)return;_0x5da804['isPresent']=_0x2f2b97,await _0x5da804[_0x5ec348(0x113)](_0x5ec348(0x143),{'val':_0x2f2b97,'ack':!![]});}function a5_0x4847(){const _0x49a701=['valveMapping','now','.1.ACTUAL_TEMPERATURE','replace','Unknown','accuweather','licht','getHours','LTM.trainingData.sequences','openweathermap','45SZPMZz','[RECORDER]\x20Error:\x20','.NextHours.Location_1.Day_1.current.temp_value','1076umJgrz','config','31453103kZDftS','toString','eventHistory','klima','pr채senz','parse','exports','normal','setStateAsync','location','Valve','fenster','kontakt','weatherunderground','message','error','.1.LEVEL','1662657dRHcfw','logDuplicates','12MjMMmv','length','search','includes','pop','25086VwrHPT','value','5vwflIz','temperatur','constructor','some','.forecast.current.temp','STATE','.forecast.current.temperature','isProVersion','lastTrackerEventTime','.ACTUAL_TEMPERATURE','useWeather','2716098rvAlbF','level','log','type','.1.VALVE_STATE','events.history','stringify','from','.1.TEMPERATURE','LTM.trainingData.thermodynamics','(((.+)+)+)+$','lampe','bewegung','presence','handle','.LEVEL','toISOString','t체r','heizung','system.isPresent','exitTimer','daswetter','door','schloss','sensorLastValues','val','map','outdoorSensorId','temperature','shift','name','thermostat','splice','[RECORDER]\x20Ignored\x20implausible\x20temperature:\x20','LEVEL','round','number','2015190oFtcAE','isGracePeriodActive','isExit','8666400kcolOQ','schalter','getStateAsync','.Current.Temperature','switch','TRACK_EVENT','dimmer','toLowerCase','3195MxOTFB','contact','sendToPythonWrapper','push','exitGraceTimer','ANALYZE_SEQUENCE','isPresent','.4.VALVE_STATE','rawEventLog','motion','occupancy','string','getForeignStateAsync','weatherInstance','unshift'];a5_0x4847=function(){return _0x49a701;};return a5_0x4847();}async function processSensorEvent(_0x2ae92b,_0x4b262b,_0x133df5,_0x190866){const _0x332907=a5_0xe3d1;if(!_0x190866)return null;const _0x552cd0=_0x133df5[_0x332907(0x149)],_0x5aeca0=Date['now'](),_0x5549b0=_0x2ae92b['sensorLastValues'][_0x4b262b],_0x375e26=(_0x190866[_0x332907(0x133)]||'')[_0x332907(0x15f)](),_0x1c1653=_0x375e26[_0x332907(0x121)](_0x332907(0x14c))||_0x375e26[_0x332907(0x121)](_0x332907(0x126))||_0x375e26[_0x332907(0x121)](_0x332907(0x10e))||_0x375e26[_0x332907(0x121)](_0x332907(0x142))||_0x375e26[_0x332907(0x121)](_0x332907(0x14f));if(_0x1c1653&&typeof _0x552cd0==='number'){if(_0x552cd0>0x50||_0x552cd0<-0x32)return _0x2ae92b[_0x332907(0x132)]['debug'](_0x332907(0x151)+_0x552cd0+'\x20from\x20'+_0x4b262b),null;}_0x2ae92b[_0x332907(0x148)][_0x4b262b]=_0x552cd0;if(!_0x190866[_0x332907(0x11d)]&&_0x5549b0!=undefined&&_0x5549b0==_0x552cd0)return null;_0x2ae92b[_0x332907(0x12c)]&&_0x1c1653&&recordThermodynamics(_0x2ae92b,_0x4b262b,_0x552cd0,_0x190866[_0x332907(0x114)]);const _0x14da93={'timestamp':_0x5aeca0,'id':_0x4b262b,'name':_0x190866[_0x332907(0x14e)],'type':_0x190866[_0x332907(0x133)],'location':_0x190866[_0x332907(0x114)],'value':_0x552cd0};_0x2ae92b['eventHistory'][_0x332907(0xfb)](_0x14da93);if(_0x2ae92b[_0x332907(0x10d)]['length']>HISTORY_MAX_SIZE)_0x2ae92b[_0x332907(0x10d)][_0x332907(0x122)]();await _0x2ae92b[_0x332907(0x113)]('events.lastEvent',{'val':JSON['stringify'](_0x14da93),'ack':!![]}),await _0x2ae92b[_0x332907(0x113)](_0x332907(0x135),{'val':JSON[_0x332907(0x136)](_0x2ae92b[_0x332907(0x10d)]),'ack':!![]});if(_0x2ae92b[_0x332907(0x12c)]){_0x2ae92b[_0x332907(0xf5)][_0x332907(0x163)](_0x14da93);if(_0x2ae92b[_0x332907(0xf5)][_0x332907(0x11f)]>RAW_LOG_MAX_SIZE)_0x2ae92b[_0x332907(0xf5)][_0x332907(0x150)](0x0,_0x2ae92b[_0x332907(0xf5)]['length']-RAW_LOG_MAX_SIZE);await _0x2ae92b['setStateAsync']('LTM.rawEventLog',{'val':JSON[_0x332907(0x136)](_0x2ae92b[_0x332907(0xf5)]),'ack':!![]}),recordSequence(_0x2ae92b,_0x14da93);}if(_0x190866[_0x332907(0x157)]&&_0x552cd0===!![]){if(_0x2ae92b[_0x332907(0x166)]&&!_0x2ae92b[_0x332907(0x156)])startExitTimer(_0x2ae92b);else{if(!_0x2ae92b[_0x332907(0x166)])setPresence(_0x2ae92b,!![]);}}else{if(_0x190866['type']===_0x332907(0xf6)&&_0x552cd0===!![]){if(_0x2ae92b[_0x332907(0x144)])abortExitTimer(_0x2ae92b);if(!_0x2ae92b[_0x332907(0x166)]&&_0x2ae92b['currentSystemMode']===_0x332907(0x112))setPresence(_0x2ae92b,!![]);}}if(_0x2ae92b[_0x332907(0x12c)]&&_0x2ae92b[_0x332907(0x162)]){_0x190866['type']==='motion'&&_0x552cd0===!![]&&_0x190866[_0x332907(0x114)]&&_0x2ae92b[_0x332907(0x162)]('SIMULATE_SIGNAL',{'room':_0x190866[_0x332907(0x114)]});const _0x3d425c=[_0x332907(0x146),'t체r','window',_0x332907(0x116),'griff',_0x332907(0x13e),'lock',_0x332907(0x147)][_0x332907(0x128)](_0x23ac96=>_0x375e26[_0x332907(0x121)](_0x23ac96)),_0x405990=['light',_0x332907(0x102),_0x332907(0x15c),_0x332907(0x159),_0x332907(0x15e),'lampe'][_0x332907(0x128)](_0x422510=>_0x375e26[_0x332907(0x121)](_0x422510)),_0x12085f=[_0x332907(0xf6),_0x332907(0x13c),'pr채senz',_0x332907(0x13d),_0x332907(0xf7)][_0x332907(0x128)](_0x2c5348=>_0x375e26[_0x332907(0x121)](_0x2c5348));if(_0x190866[_0x332907(0x114)]&&(_0x3d425c||_0x405990||_0x12085f)){const _0x2904be=_0x552cd0===!![]||typeof _0x552cd0===_0x332907(0x154)&&_0x552cd0>0x0,_0x5e6dfa=_0x3d425c&&!_0x2904be&&_0x5549b0!==undefined&&_0x5549b0!=_0x552cd0;if(_0x2904be||_0x5e6dfa){const _0x399865=_0x2ae92b['lastTrackerEventTime']||_0x5aeca0,_0x5233d8=(_0x5aeca0-_0x399865)/0x3e8;_0x2ae92b[_0x332907(0x12d)]=_0x5aeca0,_0x2ae92b['sendToPythonWrapper'](_0x332907(0x15d),{'room':_0x190866[_0x332907(0x114)],'dt':_0x5233d8});}}}return _0x14da93;}module[a5_0x5dfe9d(0x111)]={'processSensorEvent':processSensorEvent,'getOutsideTemperatureNumeric':getOutsideTemperatureNumeric,'setPresence':setPresence,'abortExitTimer':abortExitTimer,'startExitTimer':startExitTimer};