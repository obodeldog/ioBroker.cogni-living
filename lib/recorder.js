const a5_0x1e4161=a5_0x3815;(function(_0x3f67b4,_0x3d2fcd){const _0x2f9630=a5_0x3815,_0x5f2d80=_0x3f67b4();while(!![]){try{const _0x2f7ae7=-parseInt(_0x2f9630(0x241))/0x1*(-parseInt(_0x2f9630(0x1e1))/0x2)+-parseInt(_0x2f9630(0x1f4))/0x3+-parseInt(_0x2f9630(0x211))/0x4*(-parseInt(_0x2f9630(0x200))/0x5)+parseInt(_0x2f9630(0x217))/0x6+parseInt(_0x2f9630(0x23c))/0x7+-parseInt(_0x2f9630(0x1db))/0x8*(-parseInt(_0x2f9630(0x20a))/0x9)+-parseInt(_0x2f9630(0x1ec))/0xa;if(_0x2f7ae7===_0x3d2fcd)break;else _0x5f2d80['push'](_0x5f2d80['shift']());}catch(_0x5370e5){_0x5f2d80['push'](_0x5f2d80['shift']());}}}(a5_0x8869,0xec0c9));const a5_0x21d3bd=(function(){let _0x233a0e=!![];return function(_0x25ae6b,_0x33fb61){const _0x34ec09=_0x233a0e?function(){const _0x324076=a5_0x3815;if(_0x33fb61){const _0x4bfcd4=_0x33fb61[_0x324076(0x1e0)](_0x25ae6b,arguments);return _0x33fb61=null,_0x4bfcd4;}}:function(){};return _0x233a0e=![],_0x34ec09;};}()),a5_0x4051f4=a5_0x21d3bd(this,function(){const _0x1906ff=a5_0x3815;return a5_0x4051f4[_0x1906ff(0x1ee)]()[_0x1906ff(0x206)]('(((.+)+)+)+$')[_0x1906ff(0x1ee)]()[_0x1906ff(0x204)](a5_0x4051f4)[_0x1906ff(0x206)]('(((.+)+)+)+$');});a5_0x4051f4();'use strict';const HISTORY_MAX_SIZE=0x32,RAW_LOG_MAX_SIZE=0x9c4,THERMO_LOG_SIZE=0x3e8,SEQUENCE_TIMEOUT_MS=0x5*0x3c*0x3e8,MAX_TRAINING_SET_SIZE=0x1f4,EXIT_TIMER_MINUTES=0xf,EXIT_GRACE_PERIOD_SECONDS=0x1e;let activeSequence=[],sequenceTimer=null;async function getOutsideTemperatureNumeric(_0x100d6b){const _0x276e57=a5_0x3815;if(_0x100d6b['config'][_0x276e57(0x1df)])try{const _0x597aaf=await _0x100d6b[_0x276e57(0x21f)](_0x100d6b[_0x276e57(0x1f9)][_0x276e57(0x1df)]);if(_0x597aaf&&_0x597aaf[_0x276e57(0x23e)]!==undefined&&_0x597aaf[_0x276e57(0x23e)]!==null)return parseFloat(_0x597aaf['val']);}catch(_0x467054){}const _0x51f174=_0x100d6b[_0x276e57(0x1f9)][_0x276e57(0x202)];if(!_0x100d6b[_0x276e57(0x1f9)][_0x276e57(0x1e2)]||!_0x51f174)return null;try{let _0x2efec4='';if(_0x51f174[_0x276e57(0x1f5)](_0x276e57(0x242)))_0x2efec4=_0x51f174+_0x276e57(0x1fc);else{if(_0x51f174[_0x276e57(0x1f5)](_0x276e57(0x1d9)))_0x2efec4=_0x51f174+_0x276e57(0x224);else{if(_0x51f174[_0x276e57(0x1f5)](_0x276e57(0x215)))_0x2efec4=_0x51f174+_0x276e57(0x238);else{if(_0x51f174[_0x276e57(0x1f5)](_0x276e57(0x1e3)))_0x2efec4=_0x51f174+_0x276e57(0x20e);}}}if(_0x2efec4){const _0x56fb8f=await _0x100d6b[_0x276e57(0x21f)](_0x2efec4);if(_0x56fb8f&&_0x56fb8f[_0x276e57(0x23e)]!==undefined&&_0x56fb8f[_0x276e57(0x23e)]!==null)return parseFloat(_0x56fb8f[_0x276e57(0x23e)]);}}catch(_0x359136){}return null;}async function recordThermodynamics(_0x3bd554,_0x851780,_0x141423,_0x44ad59){const _0x28682e=a5_0x3815,_0x59d4e7=await getOutsideTemperatureNumeric(_0x3bd554);if(_0x59d4e7===null)return;let _0x528612=0x0,_0x118d40=![];if(_0x3bd554[_0x28682e(0x1f9)]['valveMapping'])try{let _0x4c4602=_0x3bd554['config'][_0x28682e(0x1fb)];if(typeof _0x4c4602==='string')_0x4c4602=JSON[_0x28682e(0x22c)](_0x4c4602);if(_0x4c4602[_0x851780]){const _0x9d0ebe=_0x4c4602[_0x851780],_0x111428=await _0x3bd554[_0x28682e(0x21f)](_0x9d0ebe);if(_0x111428&&_0x111428[_0x28682e(0x23e)]!==null&&_0x111428[_0x28682e(0x23e)]!==undefined){let _0x168180=Number(_0x111428[_0x28682e(0x23e)]);if(_0x168180<=1.05&&!_0x9d0ebe[_0x28682e(0x1f5)](_0x28682e(0x236))&&!_0x9d0ebe[_0x28682e(0x1f5)](_0x28682e(0x1ea)))_0x168180=_0x168180*0x64;_0x528612=Math[_0x28682e(0x20d)](_0x168180),_0x118d40=!![];}}}catch(_0x1a0e2f){}if(!_0x118d40){const _0x9a8e6c=[{'from':_0x28682e(0x20b),'to':_0x28682e(0x20c)},{'from':_0x28682e(0x20b),'to':_0x28682e(0x239)},{'from':_0x28682e(0x1f7),'to':_0x28682e(0x207)},{'from':'.ACTUAL_TEMPERATURE','to':_0x28682e(0x232)},{'from':'temperature','to':_0x28682e(0x1dd)},{'from':_0x28682e(0x1fa),'to':'Valve'}];for(const _0x57ec1e of _0x9a8e6c){if(_0x851780[_0x28682e(0x1f5)](_0x57ec1e[_0x28682e(0x21b)])){const _0x3743dd=_0x851780[_0x28682e(0x212)](_0x57ec1e[_0x28682e(0x21b)],_0x57ec1e['to']);try{const _0x2a8085=await _0x3bd554[_0x28682e(0x21f)](_0x3743dd);if(_0x2a8085&&_0x2a8085[_0x28682e(0x23e)]!==null&&_0x2a8085[_0x28682e(0x23e)]!==undefined){let _0x2bf8c4=Number(_0x2a8085[_0x28682e(0x23e)]);if(typeof _0x2bf8c4===_0x28682e(0x225)){if(_0x2bf8c4<=1.05&&_0x57ec1e['to'][_0x28682e(0x1f5)](_0x28682e(0x21c)))_0x2bf8c4=_0x2bf8c4*0x64;_0x528612=Math[_0x28682e(0x20d)](_0x2bf8c4),_0x118d40=!![];break;}}}catch(_0x3e6838){}}}}const _0x40dd0a=await _0x3bd554[_0x28682e(0x1e8)](_0x28682e(0x1f8));let _0x515644=[];if(_0x40dd0a&&_0x40dd0a[_0x28682e(0x23e)])try{_0x515644=JSON[_0x28682e(0x22c)](_0x40dd0a['val']);}catch(_0x19ff52){}_0x515644['push']({'ts':Date[_0x28682e(0x228)](),'room':_0x44ad59||_0x28682e(0x227),'t_in':_0x141423,'t_out':_0x59d4e7,'valve':_0x528612});if(_0x515644['length']>THERMO_LOG_SIZE)_0x515644[_0x28682e(0x209)]();await _0x3bd554[_0x28682e(0x21a)](_0x28682e(0x1f8),{'val':JSON[_0x28682e(0x220)](_0x515644),'ack':!![]});}async function saveCompletedSequence(_0xc68582){const _0x113d5b=a5_0x3815;try{const _0x4a06e9=await _0xc68582[_0x113d5b(0x1e8)](_0x113d5b(0x1d7));let _0x2dd531=[];if(_0x4a06e9&&_0x4a06e9[_0x113d5b(0x23e)])try{_0x2dd531=JSON[_0x113d5b(0x22c)](_0x4a06e9[_0x113d5b(0x23e)]);}catch(_0x52f9b8){}const _0x3ef4ef=activeSequence[0x0]['ts'],_0x4f5250=activeSequence['map'](_0x2efd81=>({'loc':_0x2efd81['loc'],'t_delta':Math['round']((_0x2efd81['ts']-_0x3ef4ef)/0x3e8)})),_0x34bb06={'timestamp':new Date(_0x3ef4ef)['toISOString'](),'steps':_0x4f5250,'duration':Math[_0x113d5b(0x20d)]((activeSequence[activeSequence[_0x113d5b(0x22f)]-0x1]['ts']-_0x3ef4ef)/0x3e8),'daytime':new Date(_0x3ef4ef)[_0x113d5b(0x22b)]()};_0x2dd531[_0x113d5b(0x1d6)](_0x34bb06);if(_0x2dd531[_0x113d5b(0x22f)]>MAX_TRAINING_SET_SIZE)_0x2dd531[_0x113d5b(0x209)]();await _0xc68582[_0x113d5b(0x21a)](_0x113d5b(0x1d7),{'val':JSON[_0x113d5b(0x220)](_0x2dd531),'ack':!![]}),_0xc68582['isProVersion']&&_0xc68582['sendToPythonWrapper']&&_0xc68582[_0x113d5b(0x223)](_0x113d5b(0x1f3),{'sequence':_0x34bb06});}catch(_0x208983){_0xc68582[_0x113d5b(0x1ef)][_0x113d5b(0x1e5)](_0x113d5b(0x237)+_0x208983['message']);}}async function recordSequence(_0x6d8385,_0x4e2e94){const _0x3f9f63=a5_0x3815,_0x5564bc=(_0x4e2e94[_0x3f9f63(0x1e7)]||'')[_0x3f9f63(0x1f1)](),_0x14b5db=[_0x3f9f63(0x216),_0x3f9f63(0x210),'pr채senz',_0x3f9f63(0x1ed),_0x3f9f63(0x243),_0x3f9f63(0x23d),'t체r','window',_0x3f9f63(0x1da),_0x3f9f63(0x1f0),_0x3f9f63(0x21d),_0x3f9f63(0x1f6),_0x3f9f63(0x203),'switch',_0x3f9f63(0x214),'dimmer','lampe'];if(!_0x14b5db['some'](_0x31717a=>_0x5564bc[_0x3f9f63(0x1f5)](_0x31717a)))return;if(!_0x4e2e94[_0x3f9f63(0x229)])return;if(sequenceTimer)clearTimeout(sequenceTimer);activeSequence[_0x3f9f63(0x1d6)]({'loc':_0x4e2e94['location']||_0x3f9f63(0x227),'id':_0x4e2e94['id'],'ts':Date[_0x3f9f63(0x228)]()}),sequenceTimer=setTimeout(async()=>{const _0x2ee9d1=_0x3f9f63;if(activeSequence[_0x2ee9d1(0x22f)]>0x1)await saveCompletedSequence(_0x6d8385);activeSequence=[];},SEQUENCE_TIMEOUT_MS);}function startExitTimer(_0x559677){const _0xc7a1e0=a5_0x3815;abortExitTimer(_0x559677),_0x559677[_0xc7a1e0(0x219)]=!![],_0x559677[_0xc7a1e0(0x240)]=setTimeout(()=>{_0x559677['isGracePeriodActive']=![];},EXIT_GRACE_PERIOD_SECONDS*0x3e8),_0x559677[_0xc7a1e0(0x23a)]=setTimeout(()=>{const _0x358dd5=_0xc7a1e0;setPresence(_0x559677,![]),_0x559677[_0x358dd5(0x23a)]=null;},EXIT_TIMER_MINUTES*0x3c*0x3e8);}function a5_0x8869(){const _0x4f5d40=['push','LTM.trainingData.sequences','[RECORDER]\x20Ignored\x20implausible\x20temperature:\x20','daswetter','fenster','12799376eZCwWN','exports','level','fill','outdoorSensorId','apply','236244mavcTa','useWeather','weatherunderground','lampe','error','getDate','type','getStateAsync','events.history','STATE','thermostat','25131820ZNFcrR','presence','toString','log','contact','toLowerCase','some','ANALYZE_SEQUENCE','3348564xCpAGZ','includes','light','.1.TEMPERATURE','LTM.trainingData.thermodynamics','config','Temperature','valveMapping','.Current.Temperature','switch','temperatur','logDuplicates','35WOBQtf','window','weatherInstance','licht','constructor','isPresent','search','.4.VALVE_STATE','schloss','shift','9mlNsjO','.1.ACTUAL_TEMPERATURE','.1.LEVEL','round','.forecast.current.temp','normal','bewegung','174648EymGfg','replace','splice','schalter','openweathermap','motion','10733484Pjweuv','currentSystemMode','isGracePeriodActive','setStateAsync','from','LEVEL','kontakt','rawEventLog','getForeignStateAsync','stringify','isExit','isProVersion','sendToPythonWrapper','.NextHours.Location_1.Day_1.current.temp_value','number','sensorLastValues','Unknown','now','value','analysis.health.todayVector','getHours','parse','lastTrackerEventTime','dimmer','length','eventHistory','SIMULATE_SIGNAL','.LEVEL','debug','location','events.lastEvent','STATUS','[RECORDER]\x20Error:\x20','.forecast.current.temperature','.1.VALVE_STATE','exitTimer','handle','524321jCJuNJ','door','val','t체r','exitGraceTimer','7LdKsKp','accuweather','occupancy'];a5_0x8869=function(){return _0x4f5d40;};return a5_0x8869();}function abortExitTimer(_0x5117c3){const _0x76e7b8=a5_0x3815;if(_0x5117c3[_0x76e7b8(0x23a)])clearTimeout(_0x5117c3['exitTimer']);if(_0x5117c3[_0x76e7b8(0x240)])clearTimeout(_0x5117c3[_0x76e7b8(0x240)]);_0x5117c3[_0x76e7b8(0x23a)]=null,_0x5117c3['exitGraceTimer']=null,_0x5117c3[_0x76e7b8(0x219)]=![];}async function setPresence(_0xdc30bb,_0x28e9cd){const _0x1826f6=a5_0x3815;if(_0xdc30bb[_0x1826f6(0x205)]===_0x28e9cd)return;_0xdc30bb['isPresent']=_0x28e9cd,await _0xdc30bb[_0x1826f6(0x21a)]('system.isPresent',{'val':_0x28e9cd,'ack':!![]});}async function updateHourlyActivity(_0x5d9f9c){const _0x4c4f0f=a5_0x3815;let _0x26ccef=new Array(0x18)['fill'](0x0),_0xb86e9e=0x0;try{const _0x16a735=await _0x5d9f9c['getStateAsync'](_0x4c4f0f(0x22a));_0x16a735&&_0x16a735[_0x4c4f0f(0x23e)]&&(_0x26ccef=JSON[_0x4c4f0f(0x22c)](_0x16a735[_0x4c4f0f(0x23e)]),_0xb86e9e=_0x16a735['ts']);}catch(_0x1201fb){}const _0x80c8a0=new Date(_0xb86e9e),_0x4c7594=new Date();_0x80c8a0[_0x4c4f0f(0x1e6)]()!==_0x4c7594[_0x4c4f0f(0x1e6)]()&&(_0x26ccef=new Array(0x18)[_0x4c4f0f(0x1de)](0x0));const _0x1dc3d2=_0x4c7594[_0x4c4f0f(0x22b)]();if(_0x26ccef[_0x1dc3d2]===undefined)_0x26ccef[_0x1dc3d2]=0x0;_0x26ccef[_0x1dc3d2]++,await _0x5d9f9c[_0x4c4f0f(0x21a)](_0x4c4f0f(0x22a),{'val':JSON[_0x4c4f0f(0x220)](_0x26ccef),'ack':!![]});}function a5_0x3815(_0x5758fc,_0x27eaf1){const _0x56cc5b=a5_0x8869();return a5_0x3815=function(_0x4051f4,_0x21d3bd){_0x4051f4=_0x4051f4-0x1d6;let _0x8869b7=_0x56cc5b[_0x4051f4];return _0x8869b7;},a5_0x3815(_0x5758fc,_0x27eaf1);}async function processSensorEvent(_0x82ad8b,_0x40d617,_0x4a2cfa,_0x1ba552){const _0x2a52fc=a5_0x3815;if(!_0x1ba552)return null;const _0x3d9a46=_0x4a2cfa[_0x2a52fc(0x23e)],_0x41499f=Date[_0x2a52fc(0x228)](),_0x72b22b=_0x82ad8b[_0x2a52fc(0x226)][_0x40d617],_0x2b9754=(_0x1ba552[_0x2a52fc(0x1e7)]||'')[_0x2a52fc(0x1f1)](),_0x244c59=_0x2b9754[_0x2a52fc(0x1f5)]('temperature')||_0x2b9754[_0x2a52fc(0x1f5)](_0x2a52fc(0x1fe))||_0x2b9754[_0x2a52fc(0x1f5)]('klima')||_0x2b9754['includes']('heizung')||_0x2b9754['includes'](_0x2a52fc(0x1eb));if(_0x244c59&&typeof _0x3d9a46==='number'){if(_0x3d9a46>0x50||_0x3d9a46<-0x32)return _0x82ad8b[_0x2a52fc(0x1ef)][_0x2a52fc(0x233)](_0x2a52fc(0x1d8)+_0x3d9a46+'\x20from\x20'+_0x40d617),null;}_0x82ad8b['sensorLastValues'][_0x40d617]=_0x3d9a46;if(!_0x1ba552[_0x2a52fc(0x1ff)]&&_0x72b22b!=undefined&&_0x72b22b==_0x3d9a46)return null;_0x82ad8b[_0x2a52fc(0x222)]&&_0x244c59&&recordThermodynamics(_0x82ad8b,_0x40d617,_0x3d9a46,_0x1ba552['location']);const _0x490375={'timestamp':_0x41499f,'id':_0x40d617,'name':_0x1ba552['name'],'type':_0x1ba552[_0x2a52fc(0x1e7)],'location':_0x1ba552[_0x2a52fc(0x234)],'value':_0x3d9a46};_0x82ad8b[_0x2a52fc(0x230)]['unshift'](_0x490375);if(_0x82ad8b[_0x2a52fc(0x230)][_0x2a52fc(0x22f)]>HISTORY_MAX_SIZE)_0x82ad8b['eventHistory']['pop']();await _0x82ad8b['setStateAsync'](_0x2a52fc(0x235),{'val':JSON[_0x2a52fc(0x220)](_0x490375),'ack':!![]}),await _0x82ad8b[_0x2a52fc(0x21a)](_0x2a52fc(0x1e9),{'val':JSON[_0x2a52fc(0x220)](_0x82ad8b[_0x2a52fc(0x230)]),'ack':!![]}),await updateHourlyActivity(_0x82ad8b);if(_0x82ad8b[_0x2a52fc(0x222)]){_0x82ad8b['rawEventLog'][_0x2a52fc(0x1d6)](_0x490375);if(_0x82ad8b[_0x2a52fc(0x21e)][_0x2a52fc(0x22f)]>RAW_LOG_MAX_SIZE)_0x82ad8b[_0x2a52fc(0x21e)][_0x2a52fc(0x213)](0x0,_0x82ad8b[_0x2a52fc(0x21e)][_0x2a52fc(0x22f)]-RAW_LOG_MAX_SIZE);await _0x82ad8b[_0x2a52fc(0x21a)]('LTM.rawEventLog',{'val':JSON['stringify'](_0x82ad8b[_0x2a52fc(0x21e)]),'ack':!![]}),recordSequence(_0x82ad8b,_0x490375);}if(_0x1ba552[_0x2a52fc(0x221)]&&_0x3d9a46===!![]){if(_0x82ad8b['isPresent']&&!_0x82ad8b[_0x2a52fc(0x219)])startExitTimer(_0x82ad8b);else{if(!_0x82ad8b['isPresent'])setPresence(_0x82ad8b,!![]);}}else{if(_0x1ba552['type']===_0x2a52fc(0x216)&&_0x3d9a46===!![]){if(_0x82ad8b[_0x2a52fc(0x23a)])abortExitTimer(_0x82ad8b);if(!_0x82ad8b['isPresent']&&_0x82ad8b[_0x2a52fc(0x218)]===_0x2a52fc(0x20f))setPresence(_0x82ad8b,!![]);}}if(_0x82ad8b[_0x2a52fc(0x222)]&&_0x82ad8b['sendToPythonWrapper']){_0x1ba552[_0x2a52fc(0x1e7)]===_0x2a52fc(0x216)&&_0x3d9a46===!![]&&_0x1ba552[_0x2a52fc(0x234)]&&_0x82ad8b[_0x2a52fc(0x223)](_0x2a52fc(0x231),{'room':_0x1ba552[_0x2a52fc(0x234)]});const _0x3c4837=[_0x2a52fc(0x23d),_0x2a52fc(0x23f),_0x2a52fc(0x201),_0x2a52fc(0x1da),'griff',_0x2a52fc(0x23b),'lock',_0x2a52fc(0x208)][_0x2a52fc(0x1f2)](_0x2e7814=>_0x2b9754[_0x2a52fc(0x1f5)](_0x2e7814)),_0x4360e8=[_0x2a52fc(0x1f6),_0x2a52fc(0x203),_0x2a52fc(0x1fd),_0x2a52fc(0x214),_0x2a52fc(0x22e),_0x2a52fc(0x1e4)]['some'](_0x3fdd83=>_0x2b9754[_0x2a52fc(0x1f5)](_0x3fdd83)),_0x62932a=[_0x2a52fc(0x216),_0x2a52fc(0x210),'pr채senz',_0x2a52fc(0x1ed),_0x2a52fc(0x243)][_0x2a52fc(0x1f2)](_0x40571d=>_0x2b9754[_0x2a52fc(0x1f5)](_0x40571d));if(_0x1ba552[_0x2a52fc(0x234)]&&(_0x3c4837||_0x4360e8||_0x62932a)){const _0x17d68c=_0x3d9a46===!![]||typeof _0x3d9a46===_0x2a52fc(0x225)&&_0x3d9a46>0x0,_0x1e7aa6=_0x3c4837&&!_0x17d68c&&_0x72b22b!==undefined&&_0x72b22b!=_0x3d9a46;if(_0x17d68c||_0x1e7aa6){const _0x3f33e8=_0x82ad8b['lastTrackerEventTime']||_0x41499f,_0x56dfc2=(_0x41499f-_0x3f33e8)/0x3e8;_0x82ad8b[_0x2a52fc(0x22d)]=_0x41499f,_0x82ad8b['sendToPythonWrapper']('TRACK_EVENT',{'room':_0x1ba552['location'],'dt':_0x56dfc2});}}}return _0x490375;}module[a5_0x1e4161(0x1dc)]={'processSensorEvent':processSensorEvent,'getOutsideTemperatureNumeric':getOutsideTemperatureNumeric,'setPresence':setPresence,'abortExitTimer':abortExitTimer,'startExitTimer':startExitTimer};