function a5_0xb5a4(){const _0x368df8=['isGracePeriodActive','5946178zdWITc','.LEVEL','isExit','6hKiPsk','LTM.rawEventLog','klima','LEVEL','shift','light','level','kontakt','presence','lampe','config','string','licht','(((.+)+)+)+$','getHours','temperature','getForeignStateAsync','getStateAsync','Temperature','eventHistory','Valve','currentSystemMode','684120OUprQt','LTM.trainingData.thermodynamics','bewegung','141410XpNkok','toISOString','door','accuweather','error','value','includes','isProVersion','.1.ACTUAL_TEMPERATURE','window','toLowerCase','setStateAsync','753604UcISAm','events.lastEvent','1354635xGbnIV','heizung','.1.TEMPERATURE','some','rawEventLog','round','tür','map','val','now','4872304eAxGlV','exitTimer','sensorLastValues','log','length','name','fenster','type','search','from','valveMapping','toString','weatherInstance','useWeather','exitGraceTimer','.4.VALVE_STATE','lock','weatherunderground','präsenz','loc','schalter','ANALYZE_SEQUENCE','.ACTUAL_TEMPERATURE','motion','exports','outdoorSensorId','.NextHours.Location_1.Day_1.current.temp_value','LTM.trainingData.sequences','5964815sHqAGt','pop','location','logDuplicates','sendToPythonWrapper','STATE','griff','message','lastTrackerEventTime','temperatur','9cAfaHq','stringify','push','thermostat','openweathermap','.1.VALVE_STATE','isPresent','Unknown','parse'];a5_0xb5a4=function(){return _0x368df8;};return a5_0xb5a4();}const a5_0x7a9b5d=a5_0x4ad1;(function(_0x20db7e,_0x1a14c8){const _0x492108=a5_0x4ad1,_0x9751cc=_0x20db7e();while(!![]){try{const _0x2d9539=parseInt(_0x492108(0x1be))/0x1+-parseInt(_0x492108(0x1bb))/0x2+parseInt(_0x492108(0x198))/0x3*(-parseInt(_0x492108(0x166))/0x4)+parseInt(_0x492108(0x18e))/0x5*(parseInt(_0x492108(0x1a5))/0x6)+parseInt(_0x492108(0x1a2))/0x7+-parseInt(_0x492108(0x172))/0x8+parseInt(_0x492108(0x168))/0x9;if(_0x2d9539===_0x1a14c8)break;else _0x9751cc['push'](_0x9751cc['shift']());}catch(_0x24c584){_0x9751cc['push'](_0x9751cc['shift']());}}}(a5_0xb5a4,0xc7b79));const a5_0x3e73e5=(function(){let _0x322e91=!![];return function(_0x38c669,_0x31464c){const _0x14520c=_0x322e91?function(){if(_0x31464c){const _0x19a51b=_0x31464c['apply'](_0x38c669,arguments);return _0x31464c=null,_0x19a51b;}}:function(){};return _0x322e91=![],_0x14520c;};}()),a5_0x54b490=a5_0x3e73e5(this,function(){const _0x581277=a5_0x4ad1;return a5_0x54b490[_0x581277(0x17d)]()[_0x581277(0x17a)](_0x581277(0x1b2))[_0x581277(0x17d)]()['constructor'](a5_0x54b490)[_0x581277(0x17a)](_0x581277(0x1b2));});a5_0x54b490();'use strict';const HISTORY_MAX_SIZE=0x32,RAW_LOG_MAX_SIZE=0x9c4,THERMO_LOG_SIZE=0x3e8,SEQUENCE_TIMEOUT_MS=0x5*0x3c*0x3e8,MAX_TRAINING_SET_SIZE=0x1f4,EXIT_TIMER_MINUTES=0xf,EXIT_GRACE_PERIOD_SECONDS=0x1e;let activeSequence=[],sequenceTimer=null;async function getOutsideTemperatureNumeric(_0xae00a5){const _0x1cbf66=a5_0x4ad1;if(_0xae00a5['config']['outdoorSensorId'])try{const _0x2667f0=await _0xae00a5[_0x1cbf66(0x1b5)](_0xae00a5[_0x1cbf66(0x1af)][_0x1cbf66(0x18b)]);if(_0x2667f0&&_0x2667f0['val']!==undefined&&_0x2667f0[_0x1cbf66(0x170)]!==null)return parseFloat(_0x2667f0['val']);}catch(_0x55033a){}const _0x4b1098=_0xae00a5[_0x1cbf66(0x1af)][_0x1cbf66(0x17e)];if(!_0xae00a5[_0x1cbf66(0x1af)][_0x1cbf66(0x17f)]||!_0x4b1098)return null;try{let _0x559e9b='';if(_0x4b1098['includes'](_0x1cbf66(0x1c1)))_0x559e9b=_0x4b1098+'.Current.Temperature';else{if(_0x4b1098[_0x1cbf66(0x1c4)]('daswetter'))_0x559e9b=_0x4b1098+_0x1cbf66(0x18c);else{if(_0x4b1098['includes'](_0x1cbf66(0x19c)))_0x559e9b=_0x4b1098+'.forecast.current.temperature';else{if(_0x4b1098[_0x1cbf66(0x1c4)](_0x1cbf66(0x183)))_0x559e9b=_0x4b1098+'.forecast.current.temp';}}}if(_0x559e9b){const _0x4074cd=await _0xae00a5[_0x1cbf66(0x1b5)](_0x559e9b);if(_0x4074cd&&_0x4074cd[_0x1cbf66(0x170)]!==undefined&&_0x4074cd[_0x1cbf66(0x170)]!==null)return parseFloat(_0x4074cd['val']);}}catch(_0x591222){}return null;}async function recordThermodynamics(_0x29e083,_0x1cbd33,_0x567516,_0x3cbb42){const _0x150421=a5_0x4ad1,_0x21712f=await getOutsideTemperatureNumeric(_0x29e083);if(_0x21712f===null)return;let _0x1e599a=0x0,_0x4727bc=![];if(_0x29e083[_0x150421(0x1af)][_0x150421(0x17c)])try{let _0x2f1a1=_0x29e083['config'][_0x150421(0x17c)];if(typeof _0x2f1a1===_0x150421(0x1b0))_0x2f1a1=JSON[_0x150421(0x1a0)](_0x2f1a1);if(_0x2f1a1[_0x1cbd33]){const _0x1e5bc5=_0x2f1a1[_0x1cbd33],_0x1db69c=await _0x29e083[_0x150421(0x1b5)](_0x1e5bc5);if(_0x1db69c&&_0x1db69c['val']!==null&&_0x1db69c['val']!==undefined){let _0x4cf7be=Number(_0x1db69c[_0x150421(0x170)]);if(_0x4cf7be<=1.05&&!_0x1e5bc5[_0x150421(0x1c4)]('STATUS')&&!_0x1e5bc5[_0x150421(0x1c4)](_0x150421(0x193)))_0x4cf7be=_0x4cf7be*0x64;_0x1e599a=Math[_0x150421(0x16d)](_0x4cf7be),_0x4727bc=!![];}}}catch(_0x1f0f97){}if(!_0x4727bc){const _0x452775=[{'from':_0x150421(0x1c6),'to':'.1.LEVEL'},{'from':_0x150421(0x1c6),'to':_0x150421(0x19d)},{'from':_0x150421(0x16a),'to':_0x150421(0x181)},{'from':_0x150421(0x188),'to':_0x150421(0x1a3)},{'from':_0x150421(0x1b4),'to':_0x150421(0x1ab)},{'from':_0x150421(0x1b7),'to':_0x150421(0x1b9)}];for(const _0x3ced22 of _0x452775){if(_0x1cbd33[_0x150421(0x1c4)](_0x3ced22[_0x150421(0x17b)])){const _0x398d70=_0x1cbd33['replace'](_0x3ced22[_0x150421(0x17b)],_0x3ced22['to']);try{const _0x35cab1=await _0x29e083[_0x150421(0x1b5)](_0x398d70);if(_0x35cab1&&_0x35cab1[_0x150421(0x170)]!==null&&_0x35cab1[_0x150421(0x170)]!==undefined){let _0x5ef367=Number(_0x35cab1[_0x150421(0x170)]);if(typeof _0x5ef367==='number'){if(_0x5ef367<=1.05&&_0x3ced22['to'][_0x150421(0x1c4)](_0x150421(0x1a8)))_0x5ef367=_0x5ef367*0x64;_0x1e599a=Math['round'](_0x5ef367),_0x4727bc=!![];break;}}}catch(_0x22195){}}}}const _0x4eb34c=await _0x29e083[_0x150421(0x1b6)](_0x150421(0x1bc));let _0x754e10=[];if(_0x4eb34c&&_0x4eb34c[_0x150421(0x170)])try{_0x754e10=JSON['parse'](_0x4eb34c[_0x150421(0x170)]);}catch(_0x1269da){}_0x754e10[_0x150421(0x19a)]({'ts':Date[_0x150421(0x171)](),'room':_0x3cbb42||_0x150421(0x19f),'t_in':_0x567516,'t_out':_0x21712f,'valve':_0x1e599a});if(_0x754e10[_0x150421(0x176)]>THERMO_LOG_SIZE)_0x754e10[_0x150421(0x1a9)]();await _0x29e083['setStateAsync'](_0x150421(0x1bc),{'val':JSON[_0x150421(0x199)](_0x754e10),'ack':!![]});}async function saveCompletedSequence(_0xcb4e7c){const _0xbc69d3=a5_0x4ad1;try{const _0x35dec8=await _0xcb4e7c['getStateAsync'](_0xbc69d3(0x18d));let _0x553277=[];if(_0x35dec8&&_0x35dec8[_0xbc69d3(0x170)])try{_0x553277=JSON['parse'](_0x35dec8['val']);}catch(_0xb18b0b){}const _0xd6d0dd=activeSequence[0x0]['ts'],_0x10bfc3=activeSequence[_0xbc69d3(0x16f)](_0x3fe534=>({'loc':_0x3fe534[_0xbc69d3(0x185)],'t_delta':Math['round']((_0x3fe534['ts']-_0xd6d0dd)/0x3e8)})),_0xd61dbc={'timestamp':new Date(_0xd6d0dd)[_0xbc69d3(0x1bf)](),'steps':_0x10bfc3,'duration':Math[_0xbc69d3(0x16d)]((activeSequence[activeSequence[_0xbc69d3(0x176)]-0x1]['ts']-_0xd6d0dd)/0x3e8),'daytime':new Date(_0xd6d0dd)[_0xbc69d3(0x1b3)]()};_0x553277['push'](_0xd61dbc);if(_0x553277[_0xbc69d3(0x176)]>MAX_TRAINING_SET_SIZE)_0x553277['shift']();await _0xcb4e7c['setStateAsync'](_0xbc69d3(0x18d),{'val':JSON['stringify'](_0x553277),'ack':!![]}),_0xcb4e7c[_0xbc69d3(0x1c5)]&&_0xcb4e7c[_0xbc69d3(0x192)]&&_0xcb4e7c[_0xbc69d3(0x192)](_0xbc69d3(0x187),{'sequence':_0xd61dbc});}catch(_0x37f889){_0xcb4e7c[_0xbc69d3(0x175)][_0xbc69d3(0x1c2)]('[RECORDER]\x20Error:\x20'+_0x37f889[_0xbc69d3(0x195)]);}}async function recordSequence(_0x34d16a,_0xdba6f6){const _0x50df0d=a5_0x4ad1,_0x180dd7=(_0xdba6f6[_0x50df0d(0x179)]||'')['toLowerCase'](),_0xbaceb1=[_0x50df0d(0x189),_0x50df0d(0x1bd),_0x50df0d(0x184),_0x50df0d(0x1ad),'occupancy',_0x50df0d(0x1c0),_0x50df0d(0x16e),_0x50df0d(0x1c7),_0x50df0d(0x178),'contact',_0x50df0d(0x1ac),'light',_0x50df0d(0x1b1),'switch',_0x50df0d(0x186),'dimmer',_0x50df0d(0x1ae)];if(!_0xbaceb1['some'](_0x178a38=>_0x180dd7[_0x50df0d(0x1c4)](_0x178a38)))return;if(!_0xdba6f6[_0x50df0d(0x1c3)])return;if(sequenceTimer)clearTimeout(sequenceTimer);activeSequence['push']({'loc':_0xdba6f6['location']||_0x50df0d(0x19f),'id':_0xdba6f6['id'],'ts':Date[_0x50df0d(0x171)]()}),sequenceTimer=setTimeout(async()=>{if(activeSequence['length']>0x1)await saveCompletedSequence(_0x34d16a);activeSequence=[];},SEQUENCE_TIMEOUT_MS);}function startExitTimer(_0x107b10){abortExitTimer(_0x107b10),_0x107b10['isGracePeriodActive']=!![],_0x107b10['exitGraceTimer']=setTimeout(()=>{const _0x4c5a0c=a5_0x4ad1;_0x107b10[_0x4c5a0c(0x1a1)]=![];},EXIT_GRACE_PERIOD_SECONDS*0x3e8),_0x107b10['exitTimer']=setTimeout(()=>{setPresence(_0x107b10,![]),_0x107b10['exitTimer']=null;},EXIT_TIMER_MINUTES*0x3c*0x3e8);}function abortExitTimer(_0xb23e17){const _0x42efb7=a5_0x4ad1;if(_0xb23e17[_0x42efb7(0x173)])clearTimeout(_0xb23e17['exitTimer']);if(_0xb23e17[_0x42efb7(0x180)])clearTimeout(_0xb23e17[_0x42efb7(0x180)]);_0xb23e17['exitTimer']=null,_0xb23e17[_0x42efb7(0x180)]=null,_0xb23e17[_0x42efb7(0x1a1)]=![];}async function setPresence(_0x1e5e00,_0x2898fa){const _0x6f20a5=a5_0x4ad1;if(_0x1e5e00['isPresent']===_0x2898fa)return;_0x1e5e00[_0x6f20a5(0x19e)]=_0x2898fa,await _0x1e5e00[_0x6f20a5(0x1c9)]('system.isPresent',{'val':_0x2898fa,'ack':!![]});}function a5_0x4ad1(_0x3c1c5c,_0x8b154b){const _0x25b8fd=a5_0xb5a4();return a5_0x4ad1=function(_0x54b490,_0x3e73e5){_0x54b490=_0x54b490-0x166;let _0xb5a4f8=_0x25b8fd[_0x54b490];return _0xb5a4f8;},a5_0x4ad1(_0x3c1c5c,_0x8b154b);}async function processSensorEvent(_0x3fc8be,_0xd6d423,_0x330690,_0x300d73){const _0x5e308d=a5_0x4ad1;if(!_0x300d73)return null;const _0x5e7031=_0x330690[_0x5e308d(0x170)],_0x178230=Date[_0x5e308d(0x171)](),_0x156fbe=_0x3fc8be['sensorLastValues'][_0xd6d423];_0x3fc8be[_0x5e308d(0x174)][_0xd6d423]=_0x5e7031;if(!_0x300d73[_0x5e308d(0x191)]&&_0x156fbe!=undefined&&_0x156fbe==_0x5e7031)return null;const _0x4032ea=(_0x300d73[_0x5e308d(0x179)]||'')[_0x5e308d(0x1c8)](),_0x228fb0=_0x4032ea[_0x5e308d(0x1c4)](_0x5e308d(0x1b4))||_0x4032ea[_0x5e308d(0x1c4)](_0x5e308d(0x197))||_0x4032ea[_0x5e308d(0x1c4)](_0x5e308d(0x1a7))||_0x4032ea[_0x5e308d(0x1c4)](_0x5e308d(0x169))||_0x4032ea[_0x5e308d(0x1c4)](_0x5e308d(0x19b));_0x3fc8be['isProVersion']&&_0x228fb0&&recordThermodynamics(_0x3fc8be,_0xd6d423,_0x5e7031,_0x300d73[_0x5e308d(0x190)]);const _0x50a4e3={'timestamp':_0x178230,'id':_0xd6d423,'name':_0x300d73[_0x5e308d(0x177)],'type':_0x300d73['type'],'location':_0x300d73[_0x5e308d(0x190)],'value':_0x5e7031};_0x3fc8be['eventHistory']['unshift'](_0x50a4e3);if(_0x3fc8be[_0x5e308d(0x1b8)]['length']>HISTORY_MAX_SIZE)_0x3fc8be[_0x5e308d(0x1b8)][_0x5e308d(0x18f)]();await _0x3fc8be[_0x5e308d(0x1c9)](_0x5e308d(0x167),{'val':JSON['stringify'](_0x50a4e3),'ack':!![]}),await _0x3fc8be[_0x5e308d(0x1c9)]('events.history',{'val':JSON['stringify'](_0x3fc8be[_0x5e308d(0x1b8)]),'ack':!![]});if(_0x3fc8be['isProVersion']){_0x3fc8be['rawEventLog'][_0x5e308d(0x19a)](_0x50a4e3);if(_0x3fc8be[_0x5e308d(0x16c)]['length']>RAW_LOG_MAX_SIZE)_0x3fc8be[_0x5e308d(0x16c)]['splice'](0x0,_0x3fc8be[_0x5e308d(0x16c)]['length']-RAW_LOG_MAX_SIZE);await _0x3fc8be[_0x5e308d(0x1c9)](_0x5e308d(0x1a6),{'val':JSON['stringify'](_0x3fc8be[_0x5e308d(0x16c)]),'ack':!![]}),recordSequence(_0x3fc8be,_0x50a4e3);}if(_0x300d73[_0x5e308d(0x1a4)]&&_0x5e7031===!![]){if(_0x3fc8be[_0x5e308d(0x19e)]&&!_0x3fc8be['isGracePeriodActive'])startExitTimer(_0x3fc8be);else{if(!_0x3fc8be[_0x5e308d(0x19e)])setPresence(_0x3fc8be,!![]);}}else{if(_0x300d73['type']===_0x5e308d(0x189)&&_0x5e7031===!![]){if(_0x3fc8be[_0x5e308d(0x173)])abortExitTimer(_0x3fc8be);if(!_0x3fc8be['isPresent']&&_0x3fc8be[_0x5e308d(0x1ba)]==='normal')setPresence(_0x3fc8be,!![]);}}if(_0x3fc8be[_0x5e308d(0x1c5)]&&_0x3fc8be[_0x5e308d(0x192)]){_0x300d73['type']==='motion'&&_0x5e7031===!![]&&_0x300d73[_0x5e308d(0x190)]&&_0x3fc8be[_0x5e308d(0x192)]('SIMULATE_SIGNAL',{'room':_0x300d73[_0x5e308d(0x190)]});const _0x522752=[_0x5e308d(0x1c0),_0x5e308d(0x16e),_0x5e308d(0x1c7),_0x5e308d(0x178),_0x5e308d(0x194),'handle',_0x5e308d(0x182),'schloss'][_0x5e308d(0x16b)](_0xbd7a56=>_0x4032ea['includes'](_0xbd7a56)),_0xd9166e=[_0x5e308d(0x1aa),_0x5e308d(0x1b1),'switch',_0x5e308d(0x186),'dimmer',_0x5e308d(0x1ae)][_0x5e308d(0x16b)](_0x16a5c1=>_0x4032ea['includes'](_0x16a5c1)),_0x2cab83=['motion',_0x5e308d(0x1bd),_0x5e308d(0x184),_0x5e308d(0x1ad),'occupancy'][_0x5e308d(0x16b)](_0x24e48a=>_0x4032ea['includes'](_0x24e48a));if(_0x300d73[_0x5e308d(0x190)]&&(_0x522752||_0xd9166e||_0x2cab83)){const _0x438e89=_0x5e7031===!![]||typeof _0x5e7031==='number'&&_0x5e7031>0x0,_0x5b4282=_0x522752&&!_0x438e89&&_0x156fbe!==undefined&&_0x156fbe!=_0x5e7031;if(_0x438e89||_0x5b4282){const _0x245508=_0x3fc8be['lastTrackerEventTime']||_0x178230,_0x46b5a6=(_0x178230-_0x245508)/0x3e8;_0x3fc8be[_0x5e308d(0x196)]=_0x178230,_0x3fc8be[_0x5e308d(0x192)]('TRACK_EVENT',{'room':_0x300d73[_0x5e308d(0x190)],'dt':_0x46b5a6});}}}return _0x50a4e3;}module[a5_0x7a9b5d(0x18a)]={'processSensorEvent':processSensorEvent,'getOutsideTemperatureNumeric':getOutsideTemperatureNumeric,'setPresence':setPresence,'abortExitTimer':abortExitTimer,'startExitTimer':startExitTimer};