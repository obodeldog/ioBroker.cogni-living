const a5_0x42e955=a5_0x248f;(function(_0x58c550,_0x3bcaea){const _0x545c7c=a5_0x248f,_0x1db9e3=_0x58c550();while(!![]){try{const _0x2d7d40=parseInt(_0x545c7c(0x1a4))/0x1+parseInt(_0x545c7c(0x19e))/0x2*(parseInt(_0x545c7c(0x14e))/0x3)+parseInt(_0x545c7c(0x14d))/0x4*(parseInt(_0x545c7c(0x1a3))/0x5)+parseInt(_0x545c7c(0x15e))/0x6+-parseInt(_0x545c7c(0x147))/0x7+parseInt(_0x545c7c(0x199))/0x8*(parseInt(_0x545c7c(0x191))/0x9)+parseInt(_0x545c7c(0x18b))/0xa*(-parseInt(_0x545c7c(0x195))/0xb);if(_0x2d7d40===_0x3bcaea)break;else _0x1db9e3['push'](_0x1db9e3['shift']());}catch(_0x6076bc){_0x1db9e3['push'](_0x1db9e3['shift']());}}}(a5_0x4bd3,0x1c506));const a5_0x57b45d=(function(){let _0x49af4a=!![];return function(_0x291070,_0x44cf1b){const _0x4ff5d8=_0x49af4a?function(){const _0x123bab=a5_0x248f;if(_0x44cf1b){const _0x5b3250=_0x44cf1b[_0x123bab(0x148)](_0x291070,arguments);return _0x44cf1b=null,_0x5b3250;}}:function(){};return _0x49af4a=![],_0x4ff5d8;};}()),a5_0x3f2e6c=a5_0x57b45d(this,function(){const _0x376b2f=a5_0x248f;return a5_0x3f2e6c['toString']()[_0x376b2f(0x185)](_0x376b2f(0x168))[_0x376b2f(0x164)]()[_0x376b2f(0x1aa)](a5_0x3f2e6c)[_0x376b2f(0x185)](_0x376b2f(0x168));});a5_0x3f2e6c();'use strict';const HISTORY_MAX_SIZE=0x32,RAW_LOG_MAX_SIZE=0x9c4,THERMO_LOG_SIZE=0x3e8,SEQUENCE_TIMEOUT_MS=0x5*0x3c*0x3e8,MAX_TRAINING_SET_SIZE=0x1f4,EXIT_TIMER_MINUTES=0xf,EXIT_GRACE_PERIOD_SECONDS=0x1e;let activeSequence=[],sequenceTimer=null;async function getOutsideTemperatureNumeric(_0xc56a3c){const _0x345e72=a5_0x248f;if(_0xc56a3c[_0x345e72(0x18f)][_0x345e72(0x152)])try{const _0x49e6de=await _0xc56a3c['getForeignStateAsync'](_0xc56a3c[_0x345e72(0x18f)][_0x345e72(0x152)]);if(_0x49e6de&&_0x49e6de[_0x345e72(0x193)]!==undefined&&_0x49e6de[_0x345e72(0x193)]!==null)return parseFloat(_0x49e6de['val']);}catch(_0x2cd743){}const _0x3cac2b=_0xc56a3c[_0x345e72(0x18f)]['weatherInstance'];if(!_0xc56a3c['config'][_0x345e72(0x17a)]||!_0x3cac2b)return null;try{let _0x2968d8='';if(_0x3cac2b['includes'](_0x345e72(0x153)))_0x2968d8=_0x3cac2b+_0x345e72(0x14f);else{if(_0x3cac2b[_0x345e72(0x151)](_0x345e72(0x194)))_0x2968d8=_0x3cac2b+_0x345e72(0x1af);else{if(_0x3cac2b[_0x345e72(0x151)](_0x345e72(0x18a)))_0x2968d8=_0x3cac2b+_0x345e72(0x163);else{if(_0x3cac2b[_0x345e72(0x151)](_0x345e72(0x175)))_0x2968d8=_0x3cac2b+_0x345e72(0x176);}}}if(_0x2968d8){const _0x4d5119=await _0xc56a3c[_0x345e72(0x1ac)](_0x2968d8);if(_0x4d5119&&_0x4d5119['val']!==undefined&&_0x4d5119[_0x345e72(0x193)]!==null)return parseFloat(_0x4d5119[_0x345e72(0x193)]);}}catch(_0x4f9cd6){}return null;}async function recordThermodynamics(_0x9225f0,_0x3edaa1,_0x1d5277,_0x2530a8){const _0x5a9785=a5_0x248f,_0x5f03fd=await getOutsideTemperatureNumeric(_0x9225f0);if(_0x5f03fd===null)return;let _0x38a075=0x0,_0x4dc107=![];if(_0x9225f0[_0x5a9785(0x18f)]['valveMapping'])try{let _0x14d3e7=_0x9225f0[_0x5a9785(0x18f)][_0x5a9785(0x188)];if(typeof _0x14d3e7===_0x5a9785(0x140))_0x14d3e7=JSON[_0x5a9785(0x16e)](_0x14d3e7);if(_0x14d3e7[_0x3edaa1]){const _0x106b07=_0x14d3e7[_0x3edaa1],_0x3100ce=await _0x9225f0['getForeignStateAsync'](_0x106b07);if(_0x3100ce&&_0x3100ce[_0x5a9785(0x193)]!==null&&_0x3100ce[_0x5a9785(0x193)]!==undefined){let _0xe78ab2=Number(_0x3100ce[_0x5a9785(0x193)]);if(_0xe78ab2<=1.05&&!_0x106b07['includes'](_0x5a9785(0x159))&&!_0x106b07[_0x5a9785(0x151)](_0x5a9785(0x1a8)))_0xe78ab2=_0xe78ab2*0x64;_0x38a075=Math[_0x5a9785(0x198)](_0xe78ab2),_0x4dc107=!![];}}}catch(_0x445412){}if(!_0x4dc107){const _0x43067c=[{'from':_0x5a9785(0x186),'to':'.1.LEVEL'},{'from':_0x5a9785(0x186),'to':_0x5a9785(0x156)},{'from':_0x5a9785(0x16b),'to':_0x5a9785(0x17f)},{'from':_0x5a9785(0x182),'to':_0x5a9785(0x18d)},{'from':'temperature','to':_0x5a9785(0x160)},{'from':_0x5a9785(0x18c),'to':'Valve'}];for(const _0x19a92a of _0x43067c){if(_0x3edaa1[_0x5a9785(0x151)](_0x19a92a[_0x5a9785(0x1a7)])){const _0x43f502=_0x3edaa1[_0x5a9785(0x178)](_0x19a92a[_0x5a9785(0x1a7)],_0x19a92a['to']);try{const _0xb28a8=await _0x9225f0[_0x5a9785(0x1ac)](_0x43f502);if(_0xb28a8&&_0xb28a8['val']!==null&&_0xb28a8[_0x5a9785(0x193)]!==undefined){let _0x1d473d=Number(_0xb28a8[_0x5a9785(0x193)]);if(typeof _0x1d473d==='number'){if(_0x1d473d<=1.05&&_0x19a92a['to'][_0x5a9785(0x151)](_0x5a9785(0x142)))_0x1d473d=_0x1d473d*0x64;_0x38a075=Math[_0x5a9785(0x198)](_0x1d473d),_0x4dc107=!![];break;}}}catch(_0x25db52){}}}}const _0x10b9b4=await _0x9225f0[_0x5a9785(0x15b)](_0x5a9785(0x16d));let _0x323886=[];if(_0x10b9b4&&_0x10b9b4['val'])try{_0x323886=JSON[_0x5a9785(0x16e)](_0x10b9b4['val']);}catch(_0x1a1c16){}_0x323886[_0x5a9785(0x189)]({'ts':Date[_0x5a9785(0x17c)](),'room':_0x2530a8||_0x5a9785(0x155),'t_in':_0x1d5277,'t_out':_0x5f03fd,'valve':_0x38a075});if(_0x323886[_0x5a9785(0x169)]>THERMO_LOG_SIZE)_0x323886[_0x5a9785(0x19d)]();await _0x9225f0[_0x5a9785(0x1a6)]('LTM.trainingData.thermodynamics',{'val':JSON[_0x5a9785(0x19c)](_0x323886),'ack':!![]});}async function saveCompletedSequence(_0x1b38f8){const _0x4f70e0=a5_0x248f;try{const _0x110313=await _0x1b38f8[_0x4f70e0(0x15b)](_0x4f70e0(0x1ae));let _0x185e86=[];if(_0x110313&&_0x110313[_0x4f70e0(0x193)])try{_0x185e86=JSON[_0x4f70e0(0x16e)](_0x110313['val']);}catch(_0x16b8c5){}const _0x39bc50=activeSequence[0x0]['ts'],_0x36dcd1=activeSequence[_0x4f70e0(0x187)](_0x3eb2b5=>({'loc':_0x3eb2b5['loc'],'t_delta':Math[_0x4f70e0(0x198)]((_0x3eb2b5['ts']-_0x39bc50)/0x3e8)})),_0x1e2eb2={'timestamp':new Date(_0x39bc50)['toISOString'](),'steps':_0x36dcd1,'duration':Math[_0x4f70e0(0x198)]((activeSequence[activeSequence[_0x4f70e0(0x169)]-0x1]['ts']-_0x39bc50)/0x3e8),'daytime':new Date(_0x39bc50)[_0x4f70e0(0x181)]()};_0x185e86['push'](_0x1e2eb2);if(_0x185e86[_0x4f70e0(0x169)]>MAX_TRAINING_SET_SIZE)_0x185e86[_0x4f70e0(0x19d)]();await _0x1b38f8[_0x4f70e0(0x1a6)](_0x4f70e0(0x1ae),{'val':JSON[_0x4f70e0(0x19c)](_0x185e86),'ack':!![]}),_0x1b38f8[_0x4f70e0(0x183)]&&_0x1b38f8['sendToPythonWrapper']&&_0x1b38f8[_0x4f70e0(0x19f)]('ANALYZE_SEQUENCE',{'sequence':_0x1e2eb2});}catch(_0x1a2fa5){_0x1b38f8[_0x4f70e0(0x150)]['error'](_0x4f70e0(0x15d)+_0x1a2fa5[_0x4f70e0(0x1ad)]);}}function a5_0x248f(_0x30af3a,_0x4b8205){const _0x1eb32a=a5_0x4bd3();return a5_0x248f=function(_0x3f2e6c,_0x57b45d){_0x3f2e6c=_0x3f2e6c-0x13e;let _0x4bd3de=_0x1eb32a[_0x3f2e6c];return _0x4bd3de;},a5_0x248f(_0x30af3a,_0x4b8205);}async function recordSequence(_0x56fd4f,_0x462266){const _0x4ddd85=a5_0x248f,_0x480965=(_0x462266[_0x4ddd85(0x173)]||'')['toLowerCase'](),_0x3a1759=[_0x4ddd85(0x13e),'bewegung',_0x4ddd85(0x145),_0x4ddd85(0x172),_0x4ddd85(0x1a9),_0x4ddd85(0x158),_0x4ddd85(0x167),_0x4ddd85(0x154),_0x4ddd85(0x19a),_0x4ddd85(0x17b),_0x4ddd85(0x16f),_0x4ddd85(0x17d),'licht',_0x4ddd85(0x190),_0x4ddd85(0x13f),_0x4ddd85(0x14c),'lampe'];if(!_0x3a1759[_0x4ddd85(0x15a)](_0x5186bc=>_0x480965[_0x4ddd85(0x151)](_0x5186bc)))return;if(!_0x462266[_0x4ddd85(0x146)])return;if(sequenceTimer)clearTimeout(sequenceTimer);activeSequence[_0x4ddd85(0x189)]({'loc':_0x462266[_0x4ddd85(0x1a1)]||_0x4ddd85(0x155),'id':_0x462266['id'],'ts':Date['now']()}),sequenceTimer=setTimeout(async()=>{if(activeSequence['length']>0x1)await saveCompletedSequence(_0x56fd4f);activeSequence=[];},SEQUENCE_TIMEOUT_MS);}function a5_0x4bd3(){const _0x5236eb=['isPresent','tür','(((.+)+)+)+$','length','isGracePeriodActive','.1.TEMPERATURE','griff','LTM.trainingData.thermodynamics','parse','kontakt','currentSystemMode','lampe','presence','type','LTM.rawEventLog','weatherunderground','.forecast.current.temp','normal','replace','schloss','useWeather','contact','now','light','rawEventLog','.4.VALVE_STATE','exitTimer','getHours','.ACTUAL_TEMPERATURE','isProVersion','unshift','search','.1.ACTUAL_TEMPERATURE','map','valveMapping','push','openweathermap','10LJnzPU','Temperature','.LEVEL','temperature','config','switch','377514PbuGZU','heizung','val','daswetter','5204419VJFfXa','temperatur','name','round','16SGaAuV','fenster','sensorLastValues','stringify','shift','1938nNVLyI','sendToPythonWrapper','lastTrackerEventTime','location','TRACK_EVENT','276740iuIzPi','162633RCoPjP','events.lastEvent','setStateAsync','from','STATE','occupancy','constructor','number','getForeignStateAsync','message','LTM.trainingData.sequences','.NextHours.Location_1.Day_1.current.temp_value','motion','schalter','string','\x20from\x20','LEVEL','exitGraceTimer','system.isPresent','präsenz','value','80675UwtTMA','apply','eventHistory','bewegung','exports','dimmer','4dkWEwY','714MBumXd','.Current.Temperature','log','includes','outdoorSensorId','accuweather','window','Unknown','.1.VALVE_STATE','isExit','door','STATUS','some','getStateAsync','[RECORDER]\x20Ignored\x20implausible\x20temperature:\x20','[RECORDER]\x20Error:\x20','408798yFISya','toLowerCase','level','debug','logDuplicates','.forecast.current.temperature','toString','SIMULATE_SIGNAL'];a5_0x4bd3=function(){return _0x5236eb;};return a5_0x4bd3();}function startExitTimer(_0xa8390d){const _0x31c8e5=a5_0x248f;abortExitTimer(_0xa8390d),_0xa8390d['isGracePeriodActive']=!![],_0xa8390d[_0x31c8e5(0x143)]=setTimeout(()=>{const _0x169536=_0x31c8e5;_0xa8390d[_0x169536(0x16a)]=![];},EXIT_GRACE_PERIOD_SECONDS*0x3e8),_0xa8390d[_0x31c8e5(0x180)]=setTimeout(()=>{const _0x5a5c30=_0x31c8e5;setPresence(_0xa8390d,![]),_0xa8390d[_0x5a5c30(0x180)]=null;},EXIT_TIMER_MINUTES*0x3c*0x3e8);}function abortExitTimer(_0xd31f31){const _0x375157=a5_0x248f;if(_0xd31f31[_0x375157(0x180)])clearTimeout(_0xd31f31[_0x375157(0x180)]);if(_0xd31f31[_0x375157(0x143)])clearTimeout(_0xd31f31[_0x375157(0x143)]);_0xd31f31['exitTimer']=null,_0xd31f31['exitGraceTimer']=null,_0xd31f31[_0x375157(0x16a)]=![];}async function setPresence(_0x108c14,_0x3a6aa0){const _0xf892a3=a5_0x248f;if(_0x108c14[_0xf892a3(0x166)]===_0x3a6aa0)return;_0x108c14[_0xf892a3(0x166)]=_0x3a6aa0,await _0x108c14[_0xf892a3(0x1a6)](_0xf892a3(0x144),{'val':_0x3a6aa0,'ack':!![]});}async function processSensorEvent(_0x19cbdf,_0x4c9431,_0x225eea,_0x164d94){const _0xb752b4=a5_0x248f;if(!_0x164d94)return null;const _0x20afff=_0x225eea[_0xb752b4(0x193)],_0x128132=Date['now'](),_0x35f08b=_0x19cbdf[_0xb752b4(0x19b)][_0x4c9431],_0x2a4d60=(_0x164d94[_0xb752b4(0x173)]||'')[_0xb752b4(0x15f)](),_0x456e1c=_0x2a4d60[_0xb752b4(0x151)](_0xb752b4(0x18e))||_0x2a4d60[_0xb752b4(0x151)](_0xb752b4(0x196))||_0x2a4d60[_0xb752b4(0x151)]('klima')||_0x2a4d60[_0xb752b4(0x151)](_0xb752b4(0x192))||_0x2a4d60[_0xb752b4(0x151)]('thermostat');if(_0x456e1c&&typeof _0x20afff===_0xb752b4(0x1ab)){if(_0x20afff>0x50||_0x20afff<-0x32)return _0x19cbdf['log'][_0xb752b4(0x161)](_0xb752b4(0x15c)+_0x20afff+_0xb752b4(0x141)+_0x4c9431),null;}_0x19cbdf[_0xb752b4(0x19b)][_0x4c9431]=_0x20afff;if(!_0x164d94[_0xb752b4(0x162)]&&_0x35f08b!=undefined&&_0x35f08b==_0x20afff)return null;_0x19cbdf[_0xb752b4(0x183)]&&_0x456e1c&&recordThermodynamics(_0x19cbdf,_0x4c9431,_0x20afff,_0x164d94['location']);const _0xf6dfd3={'timestamp':_0x128132,'id':_0x4c9431,'name':_0x164d94[_0xb752b4(0x197)],'type':_0x164d94[_0xb752b4(0x173)],'location':_0x164d94[_0xb752b4(0x1a1)],'value':_0x20afff};_0x19cbdf[_0xb752b4(0x149)][_0xb752b4(0x184)](_0xf6dfd3);if(_0x19cbdf[_0xb752b4(0x149)][_0xb752b4(0x169)]>HISTORY_MAX_SIZE)_0x19cbdf[_0xb752b4(0x149)]['pop']();await _0x19cbdf[_0xb752b4(0x1a6)](_0xb752b4(0x1a5),{'val':JSON[_0xb752b4(0x19c)](_0xf6dfd3),'ack':!![]}),await _0x19cbdf['setStateAsync']('events.history',{'val':JSON[_0xb752b4(0x19c)](_0x19cbdf[_0xb752b4(0x149)]),'ack':!![]});if(_0x19cbdf[_0xb752b4(0x183)]){_0x19cbdf[_0xb752b4(0x17e)][_0xb752b4(0x189)](_0xf6dfd3);if(_0x19cbdf[_0xb752b4(0x17e)][_0xb752b4(0x169)]>RAW_LOG_MAX_SIZE)_0x19cbdf[_0xb752b4(0x17e)]['splice'](0x0,_0x19cbdf[_0xb752b4(0x17e)][_0xb752b4(0x169)]-RAW_LOG_MAX_SIZE);await _0x19cbdf[_0xb752b4(0x1a6)](_0xb752b4(0x174),{'val':JSON[_0xb752b4(0x19c)](_0x19cbdf[_0xb752b4(0x17e)]),'ack':!![]}),recordSequence(_0x19cbdf,_0xf6dfd3);}if(_0x164d94[_0xb752b4(0x157)]&&_0x20afff===!![]){if(_0x19cbdf['isPresent']&&!_0x19cbdf[_0xb752b4(0x16a)])startExitTimer(_0x19cbdf);else{if(!_0x19cbdf['isPresent'])setPresence(_0x19cbdf,!![]);}}else{if(_0x164d94['type']==='motion'&&_0x20afff===!![]){if(_0x19cbdf[_0xb752b4(0x180)])abortExitTimer(_0x19cbdf);if(!_0x19cbdf[_0xb752b4(0x166)]&&_0x19cbdf[_0xb752b4(0x170)]===_0xb752b4(0x177))setPresence(_0x19cbdf,!![]);}}if(_0x19cbdf['isProVersion']&&_0x19cbdf[_0xb752b4(0x19f)]){_0x164d94[_0xb752b4(0x173)]===_0xb752b4(0x13e)&&_0x20afff===!![]&&_0x164d94[_0xb752b4(0x1a1)]&&_0x19cbdf['sendToPythonWrapper'](_0xb752b4(0x165),{'room':_0x164d94[_0xb752b4(0x1a1)]});const _0x51832d=[_0xb752b4(0x158),'tür','window',_0xb752b4(0x19a),_0xb752b4(0x16c),'handle','lock',_0xb752b4(0x179)][_0xb752b4(0x15a)](_0x495dfc=>_0x2a4d60[_0xb752b4(0x151)](_0x495dfc)),_0x34ef1e=[_0xb752b4(0x17d),'licht',_0xb752b4(0x190),_0xb752b4(0x13f),_0xb752b4(0x14c),_0xb752b4(0x171)][_0xb752b4(0x15a)](_0x1473e7=>_0x2a4d60['includes'](_0x1473e7)),_0x1ba2ad=['motion',_0xb752b4(0x14a),_0xb752b4(0x145),_0xb752b4(0x172),_0xb752b4(0x1a9)][_0xb752b4(0x15a)](_0x33197a=>_0x2a4d60[_0xb752b4(0x151)](_0x33197a));if(_0x164d94[_0xb752b4(0x1a1)]&&(_0x51832d||_0x34ef1e||_0x1ba2ad)){const _0x34fcdb=_0x20afff===!![]||typeof _0x20afff===_0xb752b4(0x1ab)&&_0x20afff>0x0,_0x10cd8e=_0x51832d&&!_0x34fcdb&&_0x35f08b!==undefined&&_0x35f08b!=_0x20afff;if(_0x34fcdb||_0x10cd8e){const _0x3c9e0c=_0x19cbdf[_0xb752b4(0x1a0)]||_0x128132,_0x1b4e6b=(_0x128132-_0x3c9e0c)/0x3e8;_0x19cbdf[_0xb752b4(0x1a0)]=_0x128132,_0x19cbdf['sendToPythonWrapper'](_0xb752b4(0x1a2),{'room':_0x164d94[_0xb752b4(0x1a1)],'dt':_0x1b4e6b});}}}return _0xf6dfd3;}module[a5_0x42e955(0x14b)]={'processSensorEvent':processSensorEvent,'getOutsideTemperatureNumeric':getOutsideTemperatureNumeric,'setPresence':setPresence,'abortExitTimer':abortExitTimer,'startExitTimer':startExitTimer};