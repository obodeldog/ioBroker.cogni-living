const a5_0x1e7207=a5_0x28b9;(function(_0x432612,_0x3079cb){const _0x33b49d=a5_0x28b9,_0x51ffce=_0x432612();while(!![]){try{const _0x45b4ec=-parseInt(_0x33b49d(0x1e7))/0x1+-parseInt(_0x33b49d(0x1e2))/0x2*(parseInt(_0x33b49d(0x18f))/0x3)+-parseInt(_0x33b49d(0x191))/0x4*(parseInt(_0x33b49d(0x194))/0x5)+-parseInt(_0x33b49d(0x1d3))/0x6+parseInt(_0x33b49d(0x19f))/0x7*(parseInt(_0x33b49d(0x1d4))/0x8)+-parseInt(_0x33b49d(0x1b1))/0x9*(parseInt(_0x33b49d(0x192))/0xa)+parseInt(_0x33b49d(0x1c5))/0xb;if(_0x45b4ec===_0x3079cb)break;else _0x51ffce['push'](_0x51ffce['shift']());}catch(_0x4297d9){_0x51ffce['push'](_0x51ffce['shift']());}}}(a5_0x1247,0xefeae));const a5_0x3a4902=(function(){let _0x4c6084=!![];return function(_0x56d476,_0x30d619){const _0x26e38a=_0x4c6084?function(){const _0x1ff101=a5_0x28b9;if(_0x30d619){const _0x2fbd14=_0x30d619[_0x1ff101(0x1a4)](_0x56d476,arguments);return _0x30d619=null,_0x2fbd14;}}:function(){};return _0x4c6084=![],_0x26e38a;};}()),a5_0xd15da2=a5_0x3a4902(this,function(){const _0x2a7c17=a5_0x28b9;return a5_0xd15da2[_0x2a7c17(0x1bd)]()[_0x2a7c17(0x1c6)](_0x2a7c17(0x1c1))['toString']()[_0x2a7c17(0x19a)](a5_0xd15da2)['search'](_0x2a7c17(0x1c1));});a5_0xd15da2();'use strict';function a5_0x1247(){const _0x3e9ba3=['isGracePeriodActive','error','push','name','unshift','LTM.trainingData.sequences','normal','rawEventLog','level','.ACTUAL_TEMPERATURE','type','length','fenster','pop','[RECORDER]\x20Ignored\x20implausible\x20temperature:\x20','STATUS','exitGraceTimer','handle','some','val','15ZLmrzx','LTM.rawEventLog','484SePocy','6470PzWKgB','heizung','40865ZUdPUR','präsenz','.1.TEMPERATURE','switch','exports','toLowerCase','constructor','window','stringify','location','.LEVEL','3568684cbNrPb','weatherInstance','Unknown','now','weatherunderground','apply','getStateAsync','Temperature','SIMULATE_SIGNAL','round','licht','log','dimmer','bewegung','sendToPythonWrapper','.1.LEVEL','light','temperatur','7767lrLdGd','eventHistory','temperature','useWeather','contact','getForeignStateAsync','schalter','splice','motion','outdoorSensorId','parse','exitTimer','toString','.1.ACTUAL_TEMPERATURE','.forecast.current.temperature','message','(((.+)+)+)+$','lock','logDuplicates','schloss','38960317zNAYfR','search','currentSystemMode','isPresent','sensorLastValues','number','setStateAsync','events.lastEvent','openweathermap','lastTrackerEventTime','door','LTM.trainingData.thermodynamics','loc','presence','1671300qBGqiY','8YzFqam','isExit','isProVersion','griff','includes','system.isPresent','debug','lampe','config','LEVEL','shift','Valve','[RECORDER]\x20Error:\x20','TRACK_EVENT','133174ZeXcsB','thermostat','klima','tür','map','910178hgljaD','occupancy','valveMapping','events.history'];a5_0x1247=function(){return _0x3e9ba3;};return a5_0x1247();}const HISTORY_MAX_SIZE=0x32,RAW_LOG_MAX_SIZE=0x9c4,THERMO_LOG_SIZE=0x3e8,SEQUENCE_TIMEOUT_MS=0x5*0x3c*0x3e8,MAX_TRAINING_SET_SIZE=0x1f4,EXIT_TIMER_MINUTES=0xf,EXIT_GRACE_PERIOD_SECONDS=0x1e;let activeSequence=[],sequenceTimer=null;async function getOutsideTemperatureNumeric(_0x1d0955){const _0x19e193=a5_0x28b9;if(_0x1d0955[_0x19e193(0x1dc)][_0x19e193(0x1ba)])try{const _0x1a720d=await _0x1d0955[_0x19e193(0x1b6)](_0x1d0955[_0x19e193(0x1dc)][_0x19e193(0x1ba)]);if(_0x1a720d&&_0x1a720d[_0x19e193(0x18e)]!==undefined&&_0x1a720d['val']!==null)return parseFloat(_0x1a720d[_0x19e193(0x18e)]);}catch(_0x11ff09){}const _0x1c9bd6=_0x1d0955['config'][_0x19e193(0x1a0)];if(!_0x1d0955[_0x19e193(0x1dc)][_0x19e193(0x1b4)]||!_0x1c9bd6)return null;try{let _0x181ef8='';if(_0x1c9bd6[_0x19e193(0x1d8)]('accuweather'))_0x181ef8=_0x1c9bd6+'.Current.Temperature';else{if(_0x1c9bd6[_0x19e193(0x1d8)]('daswetter'))_0x181ef8=_0x1c9bd6+'.NextHours.Location_1.Day_1.current.temp_value';else{if(_0x1c9bd6[_0x19e193(0x1d8)](_0x19e193(0x1cd)))_0x181ef8=_0x1c9bd6+_0x19e193(0x1bf);else{if(_0x1c9bd6['includes'](_0x19e193(0x1a3)))_0x181ef8=_0x1c9bd6+'.forecast.current.temp';}}}if(_0x181ef8){const _0x3e559b=await _0x1d0955[_0x19e193(0x1b6)](_0x181ef8);if(_0x3e559b&&_0x3e559b['val']!==undefined&&_0x3e559b['val']!==null)return parseFloat(_0x3e559b['val']);}}catch(_0x3448fd){}return null;}function a5_0x28b9(_0xe1873e,_0x32d5ce){const _0xc487cd=a5_0x1247();return a5_0x28b9=function(_0xd15da2,_0x3a4902){_0xd15da2=_0xd15da2-0x189;let _0x124741=_0xc487cd[_0xd15da2];return _0x124741;},a5_0x28b9(_0xe1873e,_0x32d5ce);}async function recordThermodynamics(_0x28cded,_0x45cd01,_0xa108d6,_0xa8379a){const _0x4e23df=a5_0x28b9,_0x47828a=await getOutsideTemperatureNumeric(_0x28cded);if(_0x47828a===null)return;let _0x43d6c3=0x0,_0x442b3e=![];if(_0x28cded[_0x4e23df(0x1dc)]['valveMapping'])try{let _0x51cfef=_0x28cded[_0x4e23df(0x1dc)][_0x4e23df(0x1e9)];if(typeof _0x51cfef==='string')_0x51cfef=JSON[_0x4e23df(0x1bb)](_0x51cfef);if(_0x51cfef[_0x45cd01]){const _0x3ad720=_0x51cfef[_0x45cd01],_0x402179=await _0x28cded[_0x4e23df(0x1b6)](_0x3ad720);if(_0x402179&&_0x402179[_0x4e23df(0x18e)]!==null&&_0x402179[_0x4e23df(0x18e)]!==undefined){let _0x2f5d60=Number(_0x402179[_0x4e23df(0x18e)]);if(_0x2f5d60<=1.05&&!_0x3ad720[_0x4e23df(0x1d8)](_0x4e23df(0x18a))&&!_0x3ad720['includes']('STATE'))_0x2f5d60=_0x2f5d60*0x64;_0x43d6c3=Math[_0x4e23df(0x1a8)](_0x2f5d60),_0x442b3e=!![];}}}catch(_0x5c459f){}if(!_0x442b3e){const _0x5c1197=[{'from':_0x4e23df(0x1be),'to':_0x4e23df(0x1ae)},{'from':'.1.ACTUAL_TEMPERATURE','to':'.1.VALVE_STATE'},{'from':_0x4e23df(0x196),'to':'.4.VALVE_STATE'},{'from':_0x4e23df(0x1f4),'to':_0x4e23df(0x19e)},{'from':'temperature','to':_0x4e23df(0x1f3)},{'from':_0x4e23df(0x1a6),'to':_0x4e23df(0x1df)}];for(const _0x31e548 of _0x5c1197){if(_0x45cd01[_0x4e23df(0x1d8)](_0x31e548['from'])){const _0x7bf9b5=_0x45cd01['replace'](_0x31e548['from'],_0x31e548['to']);try{const _0x1e2a26=await _0x28cded[_0x4e23df(0x1b6)](_0x7bf9b5);if(_0x1e2a26&&_0x1e2a26[_0x4e23df(0x18e)]!==null&&_0x1e2a26[_0x4e23df(0x18e)]!==undefined){let _0x412276=Number(_0x1e2a26['val']);if(typeof _0x412276==='number'){if(_0x412276<=1.05&&_0x31e548['to'][_0x4e23df(0x1d8)](_0x4e23df(0x1dd)))_0x412276=_0x412276*0x64;_0x43d6c3=Math[_0x4e23df(0x1a8)](_0x412276),_0x442b3e=!![];break;}}}catch(_0xfe5a3a){}}}}const _0x2f26fa=await _0x28cded['getStateAsync'](_0x4e23df(0x1d0));let _0x1c0727=[];if(_0x2f26fa&&_0x2f26fa[_0x4e23df(0x18e)])try{_0x1c0727=JSON[_0x4e23df(0x1bb)](_0x2f26fa[_0x4e23df(0x18e)]);}catch(_0x3452f5){}_0x1c0727['push']({'ts':Date[_0x4e23df(0x1a2)](),'room':_0xa8379a||'Unknown','t_in':_0xa108d6,'t_out':_0x47828a,'valve':_0x43d6c3});if(_0x1c0727[_0x4e23df(0x1f6)]>THERMO_LOG_SIZE)_0x1c0727['shift']();await _0x28cded[_0x4e23df(0x1cb)](_0x4e23df(0x1d0),{'val':JSON[_0x4e23df(0x19c)](_0x1c0727),'ack':!![]});}async function saveCompletedSequence(_0x2f3cca){const _0x4c14b3=a5_0x28b9;try{const _0xa80acf=await _0x2f3cca[_0x4c14b3(0x1a5)](_0x4c14b3(0x1f0));let _0x3969af=[];if(_0xa80acf&&_0xa80acf[_0x4c14b3(0x18e)])try{_0x3969af=JSON[_0x4c14b3(0x1bb)](_0xa80acf[_0x4c14b3(0x18e)]);}catch(_0x3fae08){}const _0x4c7ecd=activeSequence[0x0]['ts'],_0x22aff7=activeSequence[_0x4c14b3(0x1e6)](_0x94913c=>({'loc':_0x94913c[_0x4c14b3(0x1d1)],'t_delta':Math['round']((_0x94913c['ts']-_0x4c7ecd)/0x3e8)})),_0x50803c={'timestamp':new Date(_0x4c7ecd)['toISOString'](),'steps':_0x22aff7,'duration':Math[_0x4c14b3(0x1a8)]((activeSequence[activeSequence[_0x4c14b3(0x1f6)]-0x1]['ts']-_0x4c7ecd)/0x3e8),'daytime':new Date(_0x4c7ecd)['getHours']()};_0x3969af[_0x4c14b3(0x1ed)](_0x50803c);if(_0x3969af['length']>MAX_TRAINING_SET_SIZE)_0x3969af[_0x4c14b3(0x1de)]();await _0x2f3cca[_0x4c14b3(0x1cb)](_0x4c14b3(0x1f0),{'val':JSON[_0x4c14b3(0x19c)](_0x3969af),'ack':!![]}),_0x2f3cca[_0x4c14b3(0x1d6)]&&_0x2f3cca['sendToPythonWrapper']&&_0x2f3cca[_0x4c14b3(0x1ad)]('ANALYZE_SEQUENCE',{'sequence':_0x50803c});}catch(_0x3a1830){_0x2f3cca[_0x4c14b3(0x1aa)][_0x4c14b3(0x1ec)](_0x4c14b3(0x1e0)+_0x3a1830[_0x4c14b3(0x1c0)]);}}async function recordSequence(_0x2720f0,_0x4aa6a8){const _0x19c1d7=a5_0x28b9,_0x285ba0=(_0x4aa6a8[_0x19c1d7(0x1f5)]||'')[_0x19c1d7(0x199)](),_0x2e5270=[_0x19c1d7(0x1b9),_0x19c1d7(0x1ac),_0x19c1d7(0x195),_0x19c1d7(0x1d2),'occupancy',_0x19c1d7(0x1cf),_0x19c1d7(0x1e5),_0x19c1d7(0x19b),_0x19c1d7(0x1f7),_0x19c1d7(0x1b5),'kontakt',_0x19c1d7(0x1af),_0x19c1d7(0x1a9),_0x19c1d7(0x197),'schalter',_0x19c1d7(0x1ab),_0x19c1d7(0x1db)];if(!_0x2e5270[_0x19c1d7(0x18d)](_0x241022=>_0x285ba0[_0x19c1d7(0x1d8)](_0x241022)))return;if(!_0x4aa6a8['value'])return;if(sequenceTimer)clearTimeout(sequenceTimer);activeSequence[_0x19c1d7(0x1ed)]({'loc':_0x4aa6a8[_0x19c1d7(0x19d)]||_0x19c1d7(0x1a1),'id':_0x4aa6a8['id'],'ts':Date[_0x19c1d7(0x1a2)]()}),sequenceTimer=setTimeout(async()=>{if(activeSequence['length']>0x1)await saveCompletedSequence(_0x2720f0);activeSequence=[];},SEQUENCE_TIMEOUT_MS);}function startExitTimer(_0x27f614){const _0x191473=a5_0x28b9;abortExitTimer(_0x27f614),_0x27f614[_0x191473(0x1eb)]=!![],_0x27f614[_0x191473(0x18b)]=setTimeout(()=>{const _0x4ec663=_0x191473;_0x27f614[_0x4ec663(0x1eb)]=![];},EXIT_GRACE_PERIOD_SECONDS*0x3e8),_0x27f614[_0x191473(0x1bc)]=setTimeout(()=>{const _0x19725e=_0x191473;setPresence(_0x27f614,![]),_0x27f614[_0x19725e(0x1bc)]=null;},EXIT_TIMER_MINUTES*0x3c*0x3e8);}function abortExitTimer(_0x142466){const _0x3e3d2c=a5_0x28b9;if(_0x142466[_0x3e3d2c(0x1bc)])clearTimeout(_0x142466[_0x3e3d2c(0x1bc)]);if(_0x142466[_0x3e3d2c(0x18b)])clearTimeout(_0x142466[_0x3e3d2c(0x18b)]);_0x142466[_0x3e3d2c(0x1bc)]=null,_0x142466[_0x3e3d2c(0x18b)]=null,_0x142466['isGracePeriodActive']=![];}async function setPresence(_0xbb8406,_0x565d41){const _0x5f19d9=a5_0x28b9;if(_0xbb8406[_0x5f19d9(0x1c8)]===_0x565d41)return;_0xbb8406['isPresent']=_0x565d41,await _0xbb8406[_0x5f19d9(0x1cb)](_0x5f19d9(0x1d9),{'val':_0x565d41,'ack':!![]});}async function processSensorEvent(_0x4429fc,_0x346137,_0x5d14df,_0x55daf4){const _0x349647=a5_0x28b9;if(!_0x55daf4)return null;const _0x15f863=_0x5d14df[_0x349647(0x18e)],_0x19081a=Date[_0x349647(0x1a2)](),_0x146d4f=_0x4429fc[_0x349647(0x1c9)][_0x346137],_0x195461=(_0x55daf4['type']||'')[_0x349647(0x199)](),_0x2785de=_0x195461[_0x349647(0x1d8)](_0x349647(0x1b3))||_0x195461['includes'](_0x349647(0x1b0))||_0x195461[_0x349647(0x1d8)](_0x349647(0x1e4))||_0x195461[_0x349647(0x1d8)](_0x349647(0x193))||_0x195461['includes'](_0x349647(0x1e3));if(_0x2785de&&typeof _0x15f863===_0x349647(0x1ca)){if(_0x15f863>0x50||_0x15f863<-0x32)return _0x4429fc[_0x349647(0x1aa)][_0x349647(0x1da)](_0x349647(0x189)+_0x15f863+'\x20from\x20'+_0x346137),null;}_0x4429fc[_0x349647(0x1c9)][_0x346137]=_0x15f863;if(!_0x55daf4[_0x349647(0x1c3)]&&_0x146d4f!=undefined&&_0x146d4f==_0x15f863)return null;_0x4429fc[_0x349647(0x1d6)]&&_0x2785de&&recordThermodynamics(_0x4429fc,_0x346137,_0x15f863,_0x55daf4['location']);const _0x2cfea2={'timestamp':_0x19081a,'id':_0x346137,'name':_0x55daf4[_0x349647(0x1ee)],'type':_0x55daf4[_0x349647(0x1f5)],'location':_0x55daf4['location'],'value':_0x15f863};_0x4429fc[_0x349647(0x1b2)][_0x349647(0x1ef)](_0x2cfea2);if(_0x4429fc[_0x349647(0x1b2)][_0x349647(0x1f6)]>HISTORY_MAX_SIZE)_0x4429fc[_0x349647(0x1b2)][_0x349647(0x1f8)]();await _0x4429fc[_0x349647(0x1cb)](_0x349647(0x1cc),{'val':JSON['stringify'](_0x2cfea2),'ack':!![]}),await _0x4429fc[_0x349647(0x1cb)](_0x349647(0x1ea),{'val':JSON['stringify'](_0x4429fc[_0x349647(0x1b2)]),'ack':!![]});if(_0x4429fc[_0x349647(0x1d6)]){_0x4429fc[_0x349647(0x1f2)][_0x349647(0x1ed)](_0x2cfea2);if(_0x4429fc['rawEventLog'][_0x349647(0x1f6)]>RAW_LOG_MAX_SIZE)_0x4429fc['rawEventLog'][_0x349647(0x1b8)](0x0,_0x4429fc[_0x349647(0x1f2)]['length']-RAW_LOG_MAX_SIZE);await _0x4429fc[_0x349647(0x1cb)](_0x349647(0x190),{'val':JSON['stringify'](_0x4429fc[_0x349647(0x1f2)]),'ack':!![]}),recordSequence(_0x4429fc,_0x2cfea2);}if(_0x55daf4[_0x349647(0x1d5)]&&_0x15f863===!![]){if(_0x4429fc[_0x349647(0x1c8)]&&!_0x4429fc[_0x349647(0x1eb)])startExitTimer(_0x4429fc);else{if(!_0x4429fc[_0x349647(0x1c8)])setPresence(_0x4429fc,!![]);}}else{if(_0x55daf4['type']===_0x349647(0x1b9)&&_0x15f863===!![]){if(_0x4429fc[_0x349647(0x1bc)])abortExitTimer(_0x4429fc);if(!_0x4429fc[_0x349647(0x1c8)]&&_0x4429fc[_0x349647(0x1c7)]===_0x349647(0x1f1))setPresence(_0x4429fc,!![]);}}if(_0x4429fc['isProVersion']&&_0x4429fc[_0x349647(0x1ad)]){_0x55daf4[_0x349647(0x1f5)]==='motion'&&_0x15f863===!![]&&_0x55daf4['location']&&_0x4429fc[_0x349647(0x1ad)](_0x349647(0x1a7),{'room':_0x55daf4['location']});const _0x25d139=[_0x349647(0x1cf),_0x349647(0x1e5),_0x349647(0x19b),_0x349647(0x1f7),_0x349647(0x1d7),_0x349647(0x18c),_0x349647(0x1c2),_0x349647(0x1c4)][_0x349647(0x18d)](_0x5bf58c=>_0x195461[_0x349647(0x1d8)](_0x5bf58c)),_0xff4202=[_0x349647(0x1af),_0x349647(0x1a9),'switch',_0x349647(0x1b7),'dimmer',_0x349647(0x1db)]['some'](_0xd24f2e=>_0x195461[_0x349647(0x1d8)](_0xd24f2e)),_0x481a33=['motion',_0x349647(0x1ac),_0x349647(0x195),'presence',_0x349647(0x1e8)]['some'](_0x43eada=>_0x195461[_0x349647(0x1d8)](_0x43eada));if(_0x55daf4[_0x349647(0x19d)]&&(_0x25d139||_0xff4202||_0x481a33)){const _0x478b89=_0x15f863===!![]||typeof _0x15f863===_0x349647(0x1ca)&&_0x15f863>0x0,_0x354357=_0x25d139&&!_0x478b89&&_0x146d4f!==undefined&&_0x146d4f!=_0x15f863;if(_0x478b89||_0x354357){const _0x10d0f3=_0x4429fc[_0x349647(0x1ce)]||_0x19081a,_0x4cb79d=(_0x19081a-_0x10d0f3)/0x3e8;_0x4429fc[_0x349647(0x1ce)]=_0x19081a,_0x4429fc[_0x349647(0x1ad)](_0x349647(0x1e1),{'room':_0x55daf4[_0x349647(0x19d)],'dt':_0x4cb79d});}}}return _0x2cfea2;}module[a5_0x1e7207(0x198)]={'processSensorEvent':processSensorEvent,'getOutsideTemperatureNumeric':getOutsideTemperatureNumeric,'setPresence':setPresence,'abortExitTimer':abortExitTimer,'startExitTimer':startExitTimer};