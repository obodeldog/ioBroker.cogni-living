const a5_0x462936=a5_0xe5d2;(function(_0x3b9844,_0x7848fb){const _0x2dce93=a5_0xe5d2,_0x132b4e=_0x3b9844();while(!![]){try{const _0xb39c65=-parseInt(_0x2dce93(0xc9))/0x1+parseInt(_0x2dce93(0xd7))/0x2+-parseInt(_0x2dce93(0xc1))/0x3*(-parseInt(_0x2dce93(0xa8))/0x4)+parseInt(_0x2dce93(0xb8))/0x5*(parseInt(_0x2dce93(0xf9))/0x6)+parseInt(_0x2dce93(0xcc))/0x7+-parseInt(_0x2dce93(0xe9))/0x8*(parseInt(_0x2dce93(0xcf))/0x9)+-parseInt(_0x2dce93(0xf5))/0xa;if(_0xb39c65===_0x7848fb)break;else _0x132b4e['push'](_0x132b4e['shift']());}catch(_0x5d921c){_0x132b4e['push'](_0x132b4e['shift']());}}}(a5_0xef81,0x9bdb4));const a5_0x18ab44=(function(){let _0x118d47=!![];return function(_0x339dd0,_0x1edeec){const _0x36e735=_0x118d47?function(){if(_0x1edeec){const _0xdd6285=_0x1edeec['apply'](_0x339dd0,arguments);return _0x1edeec=null,_0xdd6285;}}:function(){};return _0x118d47=![],_0x36e735;};}()),a5_0x8ad0fd=a5_0x18ab44(this,function(){const _0x2aa3b6=a5_0xe5d2;return a5_0x8ad0fd[_0x2aa3b6(0xa2)]()[_0x2aa3b6(0xe1)]('(((.+)+)+)+$')[_0x2aa3b6(0xa2)]()[_0x2aa3b6(0xd2)](a5_0x8ad0fd)['search']('(((.+)+)+)+$');});a5_0x8ad0fd();'use strict';const HISTORY_MAX_SIZE=0x32,RAW_LOG_MAX_SIZE=0x9c4,THERMO_LOG_SIZE=0x3e8,SEQUENCE_TIMEOUT_MS=0x5*0x3c*0x3e8,MAX_TRAINING_SET_SIZE=0x1f4,EXIT_TIMER_MINUTES=0xf,EXIT_GRACE_PERIOD_SECONDS=0x1e;let activeSequence=[],sequenceTimer=null;function a5_0xef81(){const _0x556f03=['map','pop','setStateAsync','replace','message','bewegung','dimmer','19355oAubzs','accuweather','length','rawEventLog','.forecast.current.temperature','eventHistory','unshift','occupancy','value','159zfxDEw','[RECORDER]\x20Error:\x20','LTM.rawEventLog','toISOString','klima','getHours','isProVersion','log','786000NMGXKk','.ACTUAL_TEMPERATURE','isGracePeriodActive','326088fIlCcF','weatherunderground','logDuplicates','36JQopcV','system.isPresent','LTM.trainingData.thermodynamics','constructor','includes','kontakt','getForeignStateAsync','some','1710888kjJiIV','stringify','.1.TEMPERATURE','.Current.Temperature','präsenz','push','config','LTM.trainingData.sequences','now','name','search','exports','isExit','currentSystemMode','splice','events.history','door','temperature','948192yfqWHR','location','hm-rpc','sensorLastValues','ANALYZE_SEQUENCE','round','val','isPresent','sendToPythonWrapper','fenster','shift','openweathermap','10744200FzodOo','from','SIMULATE_SIGNAL','.1.ACTUAL_TEMPERATURE','1770NATqHi','licht','temperatur','Unknown','type','daswetter','tür','number','toString','exitGraceTimer','motion','.1.VALVE_STATE','error','LEVEL','70108ozCLJL','heizung','window','exitTimer','toLowerCase','getStateAsync','schalter','weatherInstance','.1.LEVEL'];a5_0xef81=function(){return _0x556f03;};return a5_0xef81();}async function getOutsideTemperatureNumeric(_0x15d8dd){const _0x566f4f=a5_0xe5d2;if(_0x15d8dd['config']['outdoorSensorId'])try{const _0x442b4a=await _0x15d8dd[_0x566f4f(0xd5)](_0x15d8dd[_0x566f4f(0xdd)]['outdoorSensorId']);if(_0x442b4a&&_0x442b4a['val']!==undefined&&_0x442b4a[_0x566f4f(0xef)]!==null)return parseFloat(_0x442b4a[_0x566f4f(0xef)]);}catch(_0x31d97e){}const _0x171b0a=_0x15d8dd['config'][_0x566f4f(0xaf)];if(!_0x15d8dd[_0x566f4f(0xdd)]['useWeather']||!_0x171b0a)return null;try{let _0x27e7f8='';if(_0x171b0a[_0x566f4f(0xd3)](_0x566f4f(0xb9)))_0x27e7f8=_0x171b0a+_0x566f4f(0xda);else{if(_0x171b0a[_0x566f4f(0xd3)](_0x566f4f(0xfe)))_0x27e7f8=_0x171b0a+'.NextHours.Location_1.Day_1.current.temp_value';else{if(_0x171b0a[_0x566f4f(0xd3)](_0x566f4f(0xf4)))_0x27e7f8=_0x171b0a+_0x566f4f(0xbc);else{if(_0x171b0a[_0x566f4f(0xd3)](_0x566f4f(0xcd)))_0x27e7f8=_0x171b0a+'.forecast.current.temp';}}}if(_0x27e7f8){const _0xa68f83=await _0x15d8dd[_0x566f4f(0xd5)](_0x27e7f8);if(_0xa68f83&&_0xa68f83[_0x566f4f(0xef)]!==undefined&&_0xa68f83['val']!==null)return parseFloat(_0xa68f83['val']);}}catch(_0x293955){}return null;}async function recordThermodynamics(_0x4a8c10,_0x5b41f1,_0x5e4bfa,_0x53f9cc){const _0x4bf507=a5_0xe5d2,_0x3bcfce=await getOutsideTemperatureNumeric(_0x4a8c10);let _0x26f0db=0x0;if(_0x5b41f1[_0x4bf507(0xd3)](_0x4bf507(0xeb))){const _0x26c815=[{'from':_0x4bf507(0xf8),'to':_0x4bf507(0xb0)},{'from':_0x4bf507(0xf8),'to':_0x4bf507(0xa5)},{'from':_0x4bf507(0xd9),'to':'.4.VALVE_STATE'},{'from':_0x4bf507(0xca),'to':'.LEVEL'}];for(const _0x28e15f of _0x26c815){if(_0x5b41f1['includes'](_0x28e15f[_0x4bf507(0xf6)])){const _0x5dc5d0=_0x5b41f1[_0x4bf507(0xb4)](_0x28e15f[_0x4bf507(0xf6)],_0x28e15f['to']);try{const _0x23049c=await _0x4a8c10[_0x4bf507(0xd5)](_0x5dc5d0);if(_0x23049c&&_0x23049c[_0x4bf507(0xef)]!==null&&_0x23049c[_0x4bf507(0xef)]!==undefined){let _0x30e3fb=_0x23049c[_0x4bf507(0xef)];typeof _0x30e3fb===_0x4bf507(0xa1)&&_0x30e3fb<=1.05&&_0x28e15f['to']['includes'](_0x4bf507(0xa7))&&(_0x30e3fb=_0x30e3fb*0x64);_0x26f0db=Math[_0x4bf507(0xee)](_0x30e3fb);break;}}catch(_0x5cb14f){}}}}const _0x583652=await _0x4a8c10[_0x4bf507(0xad)]('LTM.trainingData.thermodynamics');let _0x4b19c9=[];if(_0x583652&&_0x583652['val'])try{_0x4b19c9=JSON['parse'](_0x583652[_0x4bf507(0xef)]);}catch(_0x1862a1){}_0x4b19c9[_0x4bf507(0xdc)]({'ts':Date[_0x4bf507(0xdf)](),'room':_0x53f9cc||_0x4bf507(0xfc),'t_in':_0x5e4bfa,'t_out':_0x3bcfce,'valve':_0x26f0db});if(_0x4b19c9[_0x4bf507(0xba)]>THERMO_LOG_SIZE)_0x4b19c9[_0x4bf507(0xf3)]();await _0x4a8c10['setStateAsync'](_0x4bf507(0xd1),{'val':JSON[_0x4bf507(0xd8)](_0x4b19c9),'ack':!![]});}function a5_0xe5d2(_0x1a6a80,_0x197058){const _0x3a6fb5=a5_0xef81();return a5_0xe5d2=function(_0x8ad0fd,_0x18ab44){_0x8ad0fd=_0x8ad0fd-0xa1;let _0xef817d=_0x3a6fb5[_0x8ad0fd];return _0xef817d;},a5_0xe5d2(_0x1a6a80,_0x197058);}async function saveCompletedSequence(_0x1333b2){const _0x424b60=a5_0xe5d2;try{const _0x4df564=await _0x1333b2['getStateAsync'](_0x424b60(0xde));let _0x23e3e7=[];if(_0x4df564&&_0x4df564[_0x424b60(0xef)])try{_0x23e3e7=JSON['parse'](_0x4df564[_0x424b60(0xef)]);}catch(_0x2bb949){}const _0x191dd8=activeSequence[0x0]['ts'],_0x56b732=activeSequence[_0x424b60(0xb1)](_0x2d3f15=>({'loc':_0x2d3f15['loc'],'t_delta':Math['round']((_0x2d3f15['ts']-_0x191dd8)/0x3e8)})),_0x420f71={'timestamp':new Date(_0x191dd8)[_0x424b60(0xc4)](),'steps':_0x56b732,'duration':Math[_0x424b60(0xee)]((activeSequence[activeSequence['length']-0x1]['ts']-_0x191dd8)/0x3e8),'daytime':new Date(_0x191dd8)[_0x424b60(0xc6)]()};_0x23e3e7[_0x424b60(0xdc)](_0x420f71);if(_0x23e3e7[_0x424b60(0xba)]>MAX_TRAINING_SET_SIZE)_0x23e3e7['shift']();await _0x1333b2[_0x424b60(0xb3)]('LTM.trainingData.sequences',{'val':JSON[_0x424b60(0xd8)](_0x23e3e7),'ack':!![]}),_0x1333b2['isProVersion']&&_0x1333b2[_0x424b60(0xf1)]&&_0x1333b2[_0x424b60(0xf1)](_0x424b60(0xed),{'sequence':_0x420f71});}catch(_0x21f9ec){_0x1333b2[_0x424b60(0xc8)][_0x424b60(0xa6)](_0x424b60(0xc2)+_0x21f9ec[_0x424b60(0xb5)]);}}async function recordSequence(_0x1fd4ba,_0x334005){const _0x2398fc=a5_0xe5d2,_0x2de00b=(_0x334005['type']||'')[_0x2398fc(0xac)](),_0x581f4b=[_0x2398fc(0xa4),_0x2398fc(0xb6),_0x2398fc(0xdb),'presence',_0x2398fc(0xbf),_0x2398fc(0xe7),_0x2398fc(0xff),_0x2398fc(0xaa),_0x2398fc(0xf2),'contact',_0x2398fc(0xd4),'light',_0x2398fc(0xfa),'switch',_0x2398fc(0xae),_0x2398fc(0xb7),'lampe'];if(!_0x581f4b[_0x2398fc(0xd6)](_0x45916d=>_0x2de00b[_0x2398fc(0xd3)](_0x45916d)))return;if(!_0x334005[_0x2398fc(0xc0)])return;if(sequenceTimer)clearTimeout(sequenceTimer);activeSequence[_0x2398fc(0xdc)]({'loc':_0x334005[_0x2398fc(0xea)]||_0x2398fc(0xfc),'id':_0x334005['id'],'ts':Date[_0x2398fc(0xdf)]()}),sequenceTimer=setTimeout(async()=>{if(activeSequence['length']>0x1)await saveCompletedSequence(_0x1fd4ba);activeSequence=[];},SEQUENCE_TIMEOUT_MS);}function startExitTimer(_0x2d7635){const _0x53c8b2=a5_0xe5d2;abortExitTimer(_0x2d7635),_0x2d7635[_0x53c8b2(0xcb)]=!![],_0x2d7635[_0x53c8b2(0xa3)]=setTimeout(()=>{const _0x308320=_0x53c8b2;_0x2d7635[_0x308320(0xcb)]=![];},EXIT_GRACE_PERIOD_SECONDS*0x3e8),_0x2d7635[_0x53c8b2(0xab)]=setTimeout(()=>{const _0x39239c=_0x53c8b2;setPresence(_0x2d7635,![]),_0x2d7635[_0x39239c(0xab)]=null;},EXIT_TIMER_MINUTES*0x3c*0x3e8);}function abortExitTimer(_0x9374c8){const _0x2cfe4f=a5_0xe5d2;if(_0x9374c8[_0x2cfe4f(0xab)])clearTimeout(_0x9374c8[_0x2cfe4f(0xab)]);if(_0x9374c8['exitGraceTimer'])clearTimeout(_0x9374c8[_0x2cfe4f(0xa3)]);_0x9374c8[_0x2cfe4f(0xab)]=null,_0x9374c8[_0x2cfe4f(0xa3)]=null,_0x9374c8[_0x2cfe4f(0xcb)]=![];}async function setPresence(_0xc4934a,_0x5cd9ed){const _0x2daca4=a5_0xe5d2;if(_0xc4934a[_0x2daca4(0xf0)]===_0x5cd9ed)return;_0xc4934a[_0x2daca4(0xf0)]=_0x5cd9ed,await _0xc4934a[_0x2daca4(0xb3)](_0x2daca4(0xd0),{'val':_0x5cd9ed,'ack':!![]});}async function processSensorEvent(_0x395156,_0x4d24e8,_0x5953c3,_0x4cd37f){const _0x2846d1=a5_0xe5d2;if(!_0x4cd37f)return null;const _0x19aba7=_0x5953c3[_0x2846d1(0xef)],_0x4056e7=Date[_0x2846d1(0xdf)](),_0x4d1f11=_0x395156[_0x2846d1(0xec)][_0x4d24e8];_0x395156['sensorLastValues'][_0x4d24e8]=_0x19aba7;if(!_0x4cd37f[_0x2846d1(0xce)]&&_0x4d1f11!=undefined&&_0x4d1f11==_0x19aba7)return null;const _0x3cb173=(_0x4cd37f[_0x2846d1(0xfd)]||'')[_0x2846d1(0xac)](),_0x47be8d=_0x3cb173[_0x2846d1(0xd3)](_0x2846d1(0xe8))||_0x3cb173[_0x2846d1(0xd3)](_0x2846d1(0xfb))||_0x3cb173[_0x2846d1(0xd3)](_0x2846d1(0xc5))||_0x3cb173[_0x2846d1(0xd3)](_0x2846d1(0xa9));_0x395156[_0x2846d1(0xc7)]&&_0x47be8d&&recordThermodynamics(_0x395156,_0x4d24e8,_0x19aba7,_0x4cd37f[_0x2846d1(0xea)]);const _0x4d9d18={'timestamp':_0x4056e7,'id':_0x4d24e8,'name':_0x4cd37f[_0x2846d1(0xe0)],'type':_0x4cd37f[_0x2846d1(0xfd)],'location':_0x4cd37f[_0x2846d1(0xea)],'value':_0x19aba7};_0x395156[_0x2846d1(0xbd)][_0x2846d1(0xbe)](_0x4d9d18);if(_0x395156[_0x2846d1(0xbd)][_0x2846d1(0xba)]>HISTORY_MAX_SIZE)_0x395156[_0x2846d1(0xbd)][_0x2846d1(0xb2)]();await _0x395156[_0x2846d1(0xb3)]('events.lastEvent',{'val':JSON['stringify'](_0x4d9d18),'ack':!![]}),await _0x395156['setStateAsync'](_0x2846d1(0xe6),{'val':JSON['stringify'](_0x395156[_0x2846d1(0xbd)]),'ack':!![]});if(_0x395156[_0x2846d1(0xc7)]){_0x395156[_0x2846d1(0xbb)]['push'](_0x4d9d18);if(_0x395156['rawEventLog'][_0x2846d1(0xba)]>RAW_LOG_MAX_SIZE)_0x395156['rawEventLog'][_0x2846d1(0xe5)](0x0,_0x395156[_0x2846d1(0xbb)][_0x2846d1(0xba)]-RAW_LOG_MAX_SIZE);await _0x395156['setStateAsync'](_0x2846d1(0xc3),{'val':JSON[_0x2846d1(0xd8)](_0x395156[_0x2846d1(0xbb)]),'ack':!![]}),recordSequence(_0x395156,_0x4d9d18);}if(_0x4cd37f[_0x2846d1(0xe3)]&&_0x19aba7===!![]){if(_0x395156['isPresent']&&!_0x395156[_0x2846d1(0xcb)])startExitTimer(_0x395156);else{if(!_0x395156[_0x2846d1(0xf0)])setPresence(_0x395156,!![]);}}else{if(_0x4cd37f[_0x2846d1(0xfd)]===_0x2846d1(0xa4)&&_0x19aba7===!![]){if(_0x395156[_0x2846d1(0xab)])abortExitTimer(_0x395156);if(!_0x395156[_0x2846d1(0xf0)]&&_0x395156[_0x2846d1(0xe4)]==='normal')setPresence(_0x395156,!![]);}}return _0x395156[_0x2846d1(0xc7)]&&_0x4cd37f[_0x2846d1(0xfd)]===_0x2846d1(0xa4)&&_0x19aba7===!![]&&_0x4cd37f[_0x2846d1(0xea)]&&_0x395156[_0x2846d1(0xf1)]&&_0x395156[_0x2846d1(0xf1)](_0x2846d1(0xf7),{'room':_0x4cd37f[_0x2846d1(0xea)]}),_0x4d9d18;}module[a5_0x462936(0xe2)]={'processSensorEvent':processSensorEvent,'getOutsideTemperatureNumeric':getOutsideTemperatureNumeric,'setPresence':setPresence,'abortExitTimer':abortExitTimer,'startExitTimer':startExitTimer};