const a5_0x3dec85=a5_0xb108;(function(_0x5c6593,_0x32339c){const _0x4adbf8=a5_0xb108,_0x286832=_0x5c6593();while(!![]){try{const _0x5deefe=-parseInt(_0x4adbf8(0x1ae))/0x1+-parseInt(_0x4adbf8(0x162))/0x2*(-parseInt(_0x4adbf8(0x1ba))/0x3)+parseInt(_0x4adbf8(0x1be))/0x4*(-parseInt(_0x4adbf8(0x1a5))/0x5)+parseInt(_0x4adbf8(0x1b4))/0x6*(-parseInt(_0x4adbf8(0x18d))/0x7)+parseInt(_0x4adbf8(0x1b7))/0x8+parseInt(_0x4adbf8(0x1b2))/0x9*(-parseInt(_0x4adbf8(0x15f))/0xa)+-parseInt(_0x4adbf8(0x19d))/0xb*(-parseInt(_0x4adbf8(0x16e))/0xc);if(_0x5deefe===_0x32339c)break;else _0x286832['push'](_0x286832['shift']());}catch(_0x469d8e){_0x286832['push'](_0x286832['shift']());}}}(a5_0x1d94,0x69d59));function a5_0xb108(_0x23c1bb,_0x41e56b){const _0x4a0aa6=a5_0x1d94();return a5_0xb108=function(_0x1fdcc5,_0x45fe17){_0x1fdcc5=_0x1fdcc5-0x152;let _0x1d94ef=_0x4a0aa6[_0x1fdcc5];return _0x1d94ef;},a5_0xb108(_0x23c1bb,_0x41e56b);}const a5_0x45fe17=(function(){let _0x541119=!![];return function(_0x291461,_0x3ac030){const _0x53c195=_0x541119?function(){const _0x18f39b=a5_0xb108;if(_0x3ac030){const _0x5ec5d4=_0x3ac030[_0x18f39b(0x199)](_0x291461,arguments);return _0x3ac030=null,_0x5ec5d4;}}:function(){};return _0x541119=![],_0x53c195;};}()),a5_0x1fdcc5=a5_0x45fe17(this,function(){const _0x44f501=a5_0xb108;return a5_0x1fdcc5['toString']()[_0x44f501(0x16d)]('(((.+)+)+)+$')[_0x44f501(0x1c5)]()[_0x44f501(0x187)](a5_0x1fdcc5)['search'](_0x44f501(0x184));});a5_0x1fdcc5();'use strict';const HISTORY_MAX_SIZE=0x32,RAW_LOG_MAX_SIZE=0x9c4,THERMO_LOG_SIZE=0x3e8,SEQUENCE_TIMEOUT_MS=0x5*0x3c*0x3e8,MAX_TRAINING_SET_SIZE=0x1f4,EXIT_TIMER_MINUTES=0xf,EXIT_GRACE_PERIOD_SECONDS=0x1e;let activeSequence=[],sequenceTimer=null;async function getOutsideTemperatureNumeric(_0x2326ae){const _0x2c7b50=a5_0xb108;if(_0x2326ae[_0x2c7b50(0x1b3)][_0x2c7b50(0x18c)])try{const _0x392544=await _0x2326ae[_0x2c7b50(0x178)](_0x2326ae[_0x2c7b50(0x1b3)][_0x2c7b50(0x18c)]);if(_0x392544&&_0x392544['val']!==undefined&&_0x392544[_0x2c7b50(0x16a)]!==null)return parseFloat(_0x392544[_0x2c7b50(0x16a)]);}catch(_0x5d26ee){}const _0x9ba753=_0x2326ae[_0x2c7b50(0x1b3)][_0x2c7b50(0x15d)];if(!_0x2326ae[_0x2c7b50(0x1b3)]['useWeather']||!_0x9ba753)return null;try{let _0x544cee='';if(_0x9ba753[_0x2c7b50(0x194)](_0x2c7b50(0x1c3)))_0x544cee=_0x9ba753+_0x2c7b50(0x17f);else{if(_0x9ba753['includes'](_0x2c7b50(0x159)))_0x544cee=_0x9ba753+_0x2c7b50(0x1bf);else{if(_0x9ba753[_0x2c7b50(0x194)](_0x2c7b50(0x17b)))_0x544cee=_0x9ba753+_0x2c7b50(0x1c7);else{if(_0x9ba753[_0x2c7b50(0x194)](_0x2c7b50(0x1a6)))_0x544cee=_0x9ba753+_0x2c7b50(0x172);}}}if(_0x544cee){const _0xd0be89=await _0x2326ae[_0x2c7b50(0x178)](_0x544cee);if(_0xd0be89&&_0xd0be89['val']!==undefined&&_0xd0be89[_0x2c7b50(0x16a)]!==null)return parseFloat(_0xd0be89[_0x2c7b50(0x16a)]);}}catch(_0x46c530){}return null;}async function recordThermodynamics(_0x13cf98,_0x2d56e8,_0x596224,_0x6c5b78){const _0x31d85a=a5_0xb108,_0x2a2763=await getOutsideTemperatureNumeric(_0x13cf98);if(_0x2a2763===null)return;let _0x100677=0x0,_0x38269d=![];if(_0x13cf98[_0x31d85a(0x1b3)]['valveMapping'])try{let _0x498e7a=_0x13cf98[_0x31d85a(0x1b3)][_0x31d85a(0x1c2)];if(typeof _0x498e7a===_0x31d85a(0x175))_0x498e7a=JSON[_0x31d85a(0x15e)](_0x498e7a);if(_0x498e7a[_0x2d56e8]){const _0x3d7b93=_0x498e7a[_0x2d56e8],_0x593458=await _0x13cf98['getForeignStateAsync'](_0x3d7b93);if(_0x593458&&_0x593458[_0x31d85a(0x16a)]!==null&&_0x593458[_0x31d85a(0x16a)]!==undefined){let _0x4362d4=Number(_0x593458[_0x31d85a(0x16a)]);if(_0x4362d4<=1.05&&!_0x3d7b93['includes'](_0x31d85a(0x188))&&!_0x3d7b93[_0x31d85a(0x194)](_0x31d85a(0x177)))_0x4362d4=_0x4362d4*0x64;_0x100677=Math['round'](_0x4362d4),_0x38269d=!![];}}}catch(_0x77b61e){}if(!_0x38269d){const _0x54d56c=[{'from':_0x31d85a(0x196),'to':'.1.LEVEL'},{'from':_0x31d85a(0x196),'to':_0x31d85a(0x1af)},{'from':_0x31d85a(0x152),'to':_0x31d85a(0x192)},{'from':'.ACTUAL_TEMPERATURE','to':'.LEVEL'},{'from':_0x31d85a(0x181),'to':_0x31d85a(0x18a)},{'from':_0x31d85a(0x1a3),'to':'Valve'}];for(const _0x2a56ce of _0x54d56c){if(_0x2d56e8[_0x31d85a(0x194)](_0x2a56ce[_0x31d85a(0x1b8)])){const _0x19995b=_0x2d56e8[_0x31d85a(0x18f)](_0x2a56ce[_0x31d85a(0x1b8)],_0x2a56ce['to']);try{const _0x4d675a=await _0x13cf98[_0x31d85a(0x178)](_0x19995b);if(_0x4d675a&&_0x4d675a[_0x31d85a(0x16a)]!==null&&_0x4d675a['val']!==undefined){let _0x4d61c9=Number(_0x4d675a['val']);if(typeof _0x4d61c9===_0x31d85a(0x179)){if(_0x4d61c9<=1.05&&_0x2a56ce['to']['includes'](_0x31d85a(0x198)))_0x4d61c9=_0x4d61c9*0x64;_0x100677=Math[_0x31d85a(0x186)](_0x4d61c9),_0x38269d=!![];break;}}}catch(_0x22c938){}}}}const _0x5e3801=await _0x13cf98['getStateAsync'](_0x31d85a(0x1bb));let _0xf26a42=[];if(_0x5e3801&&_0x5e3801['val'])try{_0xf26a42=JSON['parse'](_0x5e3801[_0x31d85a(0x16a)]);}catch(_0x22f47f){}_0xf26a42['push']({'ts':Date[_0x31d85a(0x18e)](),'room':_0x6c5b78||_0x31d85a(0x1ab),'t_in':_0x596224,'t_out':_0x2a2763,'valve':_0x100677});if(_0xf26a42[_0x31d85a(0x1bc)]>THERMO_LOG_SIZE)_0xf26a42['shift']();await _0x13cf98['setStateAsync']('LTM.trainingData.thermodynamics',{'val':JSON[_0x31d85a(0x1b5)](_0xf26a42),'ack':!![]});}function a5_0x1d94(){const _0x4c2cb8=['name','175222NYxAjq','debug','lampe','ANALYZE_SEQUENCE','licht','exitGraceTimer','klima','schloss','val','occupancy','switch','search','2700552aeLizN','door','currentSystemMode','shift','.forecast.current.temp','unshift','loc','string','isProVersion','STATE','getForeignStateAsync','number','push','openweathermap','error','contact','LTM.rawEventLog','.Current.Temperature','window','temperature','getHours','tür','(((.+)+)+)+$','thermostat','round','constructor','STATUS','rawEventLog','level','isPresent','outdoorSensorId','78148bPoujD','now','replace','some','TRACK_EVENT','.4.VALVE_STATE','motion','includes','\x20from\x20','.1.ACTUAL_TEMPERATURE','value','LEVEL','apply','isGracePeriodActive','exports','splice','44hdWmOu','message','light','events.lastEvent','LTM.trainingData.sequences','type','Temperature','map','17375rlCqca','weatherunderground','log','system.isPresent','exitTimer','kontakt','Unknown','sensorLastValues','fenster','529038dyIUvM','.1.VALVE_STATE','getDate','eventHistory','267687MXQNVS','config','18SWhtrY','stringify','sendToPythonWrapper','3713968BWxkim','from','setStateAsync','24dzlLaT','LTM.trainingData.thermodynamics','length','logDuplicates','820khyseY','.NextHours.Location_1.Day_1.current.temp_value','normal','handle','valveMapping','accuweather','pop','toString','präsenz','.forecast.current.temperature','schalter','.1.TEMPERATURE','location','dimmer','lastTrackerEventTime','toLowerCase','fill','presence','daswetter','griff','analysis.health.todayVector','lock','weatherInstance','parse','120POYNwW','getStateAsync'];a5_0x1d94=function(){return _0x4c2cb8;};return a5_0x1d94();}async function saveCompletedSequence(_0x240500){const _0x46e05d=a5_0xb108;try{const _0x38bdcb=await _0x240500[_0x46e05d(0x160)](_0x46e05d(0x1a1));let _0x558d94=[];if(_0x38bdcb&&_0x38bdcb[_0x46e05d(0x16a)])try{_0x558d94=JSON[_0x46e05d(0x15e)](_0x38bdcb[_0x46e05d(0x16a)]);}catch(_0x4c906e){}const _0x30e9be=activeSequence[0x0]['ts'],_0x26a14f=activeSequence[_0x46e05d(0x1a4)](_0x261eaa=>({'loc':_0x261eaa[_0x46e05d(0x174)],'t_delta':Math[_0x46e05d(0x186)]((_0x261eaa['ts']-_0x30e9be)/0x3e8)})),_0x2df2eb={'timestamp':new Date(_0x30e9be)['toISOString'](),'steps':_0x26a14f,'duration':Math[_0x46e05d(0x186)]((activeSequence[activeSequence[_0x46e05d(0x1bc)]-0x1]['ts']-_0x30e9be)/0x3e8),'daytime':new Date(_0x30e9be)[_0x46e05d(0x182)]()};_0x558d94[_0x46e05d(0x17a)](_0x2df2eb);if(_0x558d94[_0x46e05d(0x1bc)]>MAX_TRAINING_SET_SIZE)_0x558d94[_0x46e05d(0x171)]();await _0x240500[_0x46e05d(0x1b9)]('LTM.trainingData.sequences',{'val':JSON['stringify'](_0x558d94),'ack':!![]}),_0x240500[_0x46e05d(0x176)]&&_0x240500['sendToPythonWrapper']&&_0x240500[_0x46e05d(0x1b6)](_0x46e05d(0x165),{'sequence':_0x2df2eb});}catch(_0x50c2d8){_0x240500[_0x46e05d(0x1a7)][_0x46e05d(0x17c)]('[RECORDER]\x20Error:\x20'+_0x50c2d8[_0x46e05d(0x19e)]);}}async function recordSequence(_0xec0ca8,_0x550fd3){const _0x56c119=a5_0xb108,_0x58f41a=(_0x550fd3[_0x56c119(0x1a2)]||'')[_0x56c119(0x156)](),_0x156b21=[_0x56c119(0x193),'bewegung',_0x56c119(0x1c6),_0x56c119(0x158),_0x56c119(0x16b),_0x56c119(0x16f),_0x56c119(0x183),'window',_0x56c119(0x1ad),_0x56c119(0x17d),_0x56c119(0x1aa),'light',_0x56c119(0x166),_0x56c119(0x16c),'schalter',_0x56c119(0x154),_0x56c119(0x164)];if(!_0x156b21[_0x56c119(0x190)](_0x5502a7=>_0x58f41a[_0x56c119(0x194)](_0x5502a7)))return;if(!_0x550fd3[_0x56c119(0x197)])return;if(sequenceTimer)clearTimeout(sequenceTimer);activeSequence['push']({'loc':_0x550fd3[_0x56c119(0x153)]||_0x56c119(0x1ab),'id':_0x550fd3['id'],'ts':Date[_0x56c119(0x18e)]()}),sequenceTimer=setTimeout(async()=>{const _0x5bc01=_0x56c119;if(activeSequence[_0x5bc01(0x1bc)]>0x1)await saveCompletedSequence(_0xec0ca8);activeSequence=[];},SEQUENCE_TIMEOUT_MS);}function startExitTimer(_0x1d66ce){const _0x39680e=a5_0xb108;abortExitTimer(_0x1d66ce),_0x1d66ce[_0x39680e(0x19a)]=!![],_0x1d66ce[_0x39680e(0x167)]=setTimeout(()=>{const _0x1b6543=_0x39680e;_0x1d66ce[_0x1b6543(0x19a)]=![];},EXIT_GRACE_PERIOD_SECONDS*0x3e8),_0x1d66ce[_0x39680e(0x1a9)]=setTimeout(()=>{const _0x5b172d=_0x39680e;setPresence(_0x1d66ce,![]),_0x1d66ce[_0x5b172d(0x1a9)]=null;},EXIT_TIMER_MINUTES*0x3c*0x3e8);}function abortExitTimer(_0x14be0c){const _0x4526ea=a5_0xb108;if(_0x14be0c[_0x4526ea(0x1a9)])clearTimeout(_0x14be0c['exitTimer']);if(_0x14be0c[_0x4526ea(0x167)])clearTimeout(_0x14be0c[_0x4526ea(0x167)]);_0x14be0c[_0x4526ea(0x1a9)]=null,_0x14be0c[_0x4526ea(0x167)]=null,_0x14be0c[_0x4526ea(0x19a)]=![];}async function setPresence(_0x12ea3a,_0x36036d){const _0x15b451=a5_0xb108;if(_0x12ea3a[_0x15b451(0x18b)]===_0x36036d)return;_0x12ea3a[_0x15b451(0x18b)]=_0x36036d,await _0x12ea3a['setStateAsync'](_0x15b451(0x1a8),{'val':_0x36036d,'ack':!![]});}async function updateHourlyActivity(_0x4f8f6f){const _0xab49c=a5_0xb108;let _0x8fe88d=new Array(0x18)[_0xab49c(0x157)](0x0),_0x23d741=0x0;try{const _0x46c18c=await _0x4f8f6f[_0xab49c(0x160)]('analysis.health.todayVector');_0x46c18c&&_0x46c18c[_0xab49c(0x16a)]&&(_0x8fe88d=JSON[_0xab49c(0x15e)](_0x46c18c[_0xab49c(0x16a)]),_0x23d741=_0x46c18c['ts']);}catch(_0x39f251){}const _0x43327e=new Date(_0x23d741),_0x234645=new Date();_0x43327e[_0xab49c(0x1b0)]()!==_0x234645[_0xab49c(0x1b0)]()&&(_0x8fe88d=new Array(0x18)[_0xab49c(0x157)](0x0));const _0x3bc14f=_0x234645[_0xab49c(0x182)]();if(_0x8fe88d[_0x3bc14f]===undefined)_0x8fe88d[_0x3bc14f]=0x0;_0x8fe88d[_0x3bc14f]++,await _0x4f8f6f['setStateAsync'](_0xab49c(0x15b),{'val':JSON['stringify'](_0x8fe88d),'ack':!![]});}async function processSensorEvent(_0x418727,_0x111371,_0x481cfb,_0xfee6b0){const _0x1bddfc=a5_0xb108;if(!_0xfee6b0)return null;const _0x24fee5=_0x481cfb[_0x1bddfc(0x16a)],_0x3b4d21=Date[_0x1bddfc(0x18e)](),_0x60d2e5=_0x418727[_0x1bddfc(0x1ac)][_0x111371],_0xa9d02=(_0xfee6b0[_0x1bddfc(0x1a2)]||'')[_0x1bddfc(0x156)](),_0x4a3477=_0xa9d02[_0x1bddfc(0x194)]('temperature')||_0xa9d02[_0x1bddfc(0x194)]('temperatur')||_0xa9d02[_0x1bddfc(0x194)](_0x1bddfc(0x168))||_0xa9d02[_0x1bddfc(0x194)]('heizung')||_0xa9d02[_0x1bddfc(0x194)](_0x1bddfc(0x185));if(_0x4a3477&&typeof _0x24fee5===_0x1bddfc(0x179)){if(_0x24fee5>0x50||_0x24fee5<-0x32)return _0x418727[_0x1bddfc(0x1a7)][_0x1bddfc(0x163)]('[RECORDER]\x20Ignored\x20implausible\x20temperature:\x20'+_0x24fee5+_0x1bddfc(0x195)+_0x111371),null;}_0x418727['sensorLastValues'][_0x111371]=_0x24fee5;if(!_0xfee6b0[_0x1bddfc(0x1bd)]&&_0x60d2e5!=undefined&&_0x60d2e5==_0x24fee5)return null;_0x418727[_0x1bddfc(0x176)]&&_0x4a3477&&recordThermodynamics(_0x418727,_0x111371,_0x24fee5,_0xfee6b0[_0x1bddfc(0x153)]);const _0x306f13={'timestamp':_0x3b4d21,'id':_0x111371,'name':_0xfee6b0[_0x1bddfc(0x161)],'type':_0xfee6b0['type'],'location':_0xfee6b0[_0x1bddfc(0x153)],'value':_0x24fee5};_0x418727[_0x1bddfc(0x1b1)][_0x1bddfc(0x173)](_0x306f13);if(_0x418727['eventHistory'][_0x1bddfc(0x1bc)]>HISTORY_MAX_SIZE)_0x418727[_0x1bddfc(0x1b1)][_0x1bddfc(0x1c4)]();await _0x418727[_0x1bddfc(0x1b9)](_0x1bddfc(0x1a0),{'val':JSON['stringify'](_0x306f13),'ack':!![]}),await _0x418727[_0x1bddfc(0x1b9)]('events.history',{'val':JSON[_0x1bddfc(0x1b5)](_0x418727[_0x1bddfc(0x1b1)]),'ack':!![]}),await updateHourlyActivity(_0x418727);if(_0x418727['isProVersion']){_0x418727[_0x1bddfc(0x189)][_0x1bddfc(0x17a)](_0x306f13);if(_0x418727['rawEventLog'][_0x1bddfc(0x1bc)]>RAW_LOG_MAX_SIZE)_0x418727[_0x1bddfc(0x189)][_0x1bddfc(0x19c)](0x0,_0x418727[_0x1bddfc(0x189)][_0x1bddfc(0x1bc)]-RAW_LOG_MAX_SIZE);await _0x418727[_0x1bddfc(0x1b9)](_0x1bddfc(0x17e),{'val':JSON[_0x1bddfc(0x1b5)](_0x418727['rawEventLog']),'ack':!![]}),recordSequence(_0x418727,_0x306f13);}if(_0xfee6b0['isExit']&&_0x24fee5===!![]){if(_0x418727['isPresent']&&!_0x418727[_0x1bddfc(0x19a)])startExitTimer(_0x418727);else{if(!_0x418727[_0x1bddfc(0x18b)])setPresence(_0x418727,!![]);}}else{if(_0xfee6b0[_0x1bddfc(0x1a2)]===_0x1bddfc(0x193)&&_0x24fee5===!![]){if(_0x418727['exitTimer'])abortExitTimer(_0x418727);if(!_0x418727[_0x1bddfc(0x18b)]&&_0x418727[_0x1bddfc(0x170)]===_0x1bddfc(0x1c0))setPresence(_0x418727,!![]);}}if(_0x418727[_0x1bddfc(0x176)]&&_0x418727[_0x1bddfc(0x1b6)]){_0xfee6b0[_0x1bddfc(0x1a2)]===_0x1bddfc(0x193)&&_0x24fee5===!![]&&_0xfee6b0[_0x1bddfc(0x153)]&&_0x418727[_0x1bddfc(0x1b6)]('SIMULATE_SIGNAL',{'room':_0xfee6b0[_0x1bddfc(0x153)]});const _0x1ca55f=[_0x1bddfc(0x16f),_0x1bddfc(0x183),_0x1bddfc(0x180),_0x1bddfc(0x1ad),_0x1bddfc(0x15a),_0x1bddfc(0x1c1),_0x1bddfc(0x15c),_0x1bddfc(0x169)][_0x1bddfc(0x190)](_0x5e9b01=>_0xa9d02[_0x1bddfc(0x194)](_0x5e9b01)),_0xefc8d5=[_0x1bddfc(0x19f),_0x1bddfc(0x166),'switch',_0x1bddfc(0x1c8),_0x1bddfc(0x154),_0x1bddfc(0x164)][_0x1bddfc(0x190)](_0xc44814=>_0xa9d02[_0x1bddfc(0x194)](_0xc44814)),_0x13a720=[_0x1bddfc(0x193),'bewegung','präsenz',_0x1bddfc(0x158),_0x1bddfc(0x16b)]['some'](_0x4d9cb3=>_0xa9d02['includes'](_0x4d9cb3));if(_0xfee6b0['location']&&(_0x1ca55f||_0xefc8d5||_0x13a720)){const _0x53bec0=_0x24fee5===!![]||typeof _0x24fee5===_0x1bddfc(0x179)&&_0x24fee5>0x0,_0x56a1d8=_0x1ca55f&&!_0x53bec0&&_0x60d2e5!==undefined&&_0x60d2e5!=_0x24fee5;if(_0x53bec0||_0x56a1d8){const _0x430985=_0x418727[_0x1bddfc(0x155)]||_0x3b4d21,_0x380a80=(_0x3b4d21-_0x430985)/0x3e8;_0x418727[_0x1bddfc(0x155)]=_0x3b4d21,_0x418727['sendToPythonWrapper'](_0x1bddfc(0x191),{'room':_0xfee6b0[_0x1bddfc(0x153)],'dt':_0x380a80});}}}return _0x306f13;}module[a5_0x3dec85(0x19b)]={'processSensorEvent':processSensorEvent,'getOutsideTemperatureNumeric':getOutsideTemperatureNumeric,'setPresence':setPresence,'abortExitTimer':abortExitTimer,'startExitTimer':startExitTimer};