const a5_0x24999a=a5_0x2656;(function(_0x563d42,_0x504b6a){const _0x2c3e5b=a5_0x2656,_0x5003c5=_0x563d42();while(!![]){try{const _0x2b10bf=parseInt(_0x2c3e5b(0x15f))/0x1*(parseInt(_0x2c3e5b(0x12d))/0x2)+-parseInt(_0x2c3e5b(0x14e))/0x3+-parseInt(_0x2c3e5b(0x173))/0x4+parseInt(_0x2c3e5b(0x180))/0x5*(-parseInt(_0x2c3e5b(0x13d))/0x6)+-parseInt(_0x2c3e5b(0x181))/0x7+parseInt(_0x2c3e5b(0x149))/0x8+-parseInt(_0x2c3e5b(0x126))/0x9*(-parseInt(_0x2c3e5b(0x154))/0xa);if(_0x2b10bf===_0x504b6a)break;else _0x5003c5['push'](_0x5003c5['shift']());}catch(_0xf697d9){_0x5003c5['push'](_0x5003c5['shift']());}}}(a5_0x5ac2,0x823ac));const a5_0x3850da=(function(){let _0x56e294=!![];return function(_0x3cd7d5,_0x81d12d){const _0x3ccbd7=_0x56e294?function(){const _0x60f6b7=a5_0x2656;if(_0x81d12d){const _0x5ec8a6=_0x81d12d[_0x60f6b7(0x14a)](_0x3cd7d5,arguments);return _0x81d12d=null,_0x5ec8a6;}}:function(){};return _0x56e294=![],_0x3ccbd7;};}()),a5_0x4a0e2c=a5_0x3850da(this,function(){const _0x46e4e1=a5_0x2656;return a5_0x4a0e2c[_0x46e4e1(0x15e)]()[_0x46e4e1(0x13f)](_0x46e4e1(0x132))[_0x46e4e1(0x15e)]()[_0x46e4e1(0x146)](a5_0x4a0e2c)[_0x46e4e1(0x13f)]('(((.+)+)+)+$');});a5_0x4a0e2c();function a5_0x2656(_0x5be769,_0x267ffd){const _0x56b432=a5_0x5ac2();return a5_0x2656=function(_0x4a0e2c,_0x3850da){_0x4a0e2c=_0x4a0e2c-0x125;let _0x5ac232=_0x56b432[_0x4a0e2c];return _0x5ac232;},a5_0x2656(_0x5be769,_0x267ffd);}function a5_0x5ac2(){const _0x25ebb6=['STATE','includes','toISOString','2305995GNEkZi','1533735sfXaND','eventHistory','.Current.Temperature','präsenz','stringify','now','presence','location','daswetter','weatherunderground','sendToPythonWrapper','STATUS','getForeignStateAsync','getStateAsync','exitTimer','exports','openweathermap','valveMapping','.1.ACTUAL_TEMPERATURE','accuweather','54GCAHoF','.4.VALVE_STATE','normal','.forecast.current.temperature','dimmer','exitGraceTimer','light','4OoZqiQ','heizung','Temperature','klima','weatherInstance','(((.+)+)+)+$','TRACK_EVENT','schalter','isGracePeriodActive','replace','push','sensorLastValues','handle','setStateAsync','.1.VALVE_STATE','splice','6SaVqPf','value','search','ANALYZE_SEQUENCE','pop','.forecast.current.temp','message','door','[RECORDER]\x20Ignored\x20implausible\x20temperature:\x20','constructor','type','LTM.trainingData.sequences','3121040OJCzas','apply','val','LEVEL','some','1745244ojSWYg','isPresent','thermostat','system.isPresent','events.history','fenster','1975670bAKZzx','parse','logDuplicates','Valve','LTM.rawEventLog','lampe','temperature','shift','bewegung','tür','toString','136297OTWnUq','motion','log','\x20from\x20','licht','kontakt','debug','map','getHours','useWeather','loc','occupancy','.1.LEVEL','griff','config','outdoorSensorId','isProVersion','length','schloss','lastTrackerEventTime','210616BXLlrn','switch','Unknown','string','rawEventLog','round','toLowerCase','LTM.trainingData.thermodynamics','[RECORDER]\x20Error:\x20','number'];a5_0x5ac2=function(){return _0x25ebb6;};return a5_0x5ac2();}'use strict';const HISTORY_MAX_SIZE=0x32,RAW_LOG_MAX_SIZE=0x9c4,THERMO_LOG_SIZE=0x3e8,SEQUENCE_TIMEOUT_MS=0x5*0x3c*0x3e8,MAX_TRAINING_SET_SIZE=0x1f4,EXIT_TIMER_MINUTES=0xf,EXIT_GRACE_PERIOD_SECONDS=0x1e;let activeSequence=[],sequenceTimer=null;async function getOutsideTemperatureNumeric(_0x149f38){const _0x2bb22f=a5_0x2656;if(_0x149f38[_0x2bb22f(0x16d)][_0x2bb22f(0x16e)])try{const _0x132d2c=await _0x149f38[_0x2bb22f(0x18d)](_0x149f38[_0x2bb22f(0x16d)]['outdoorSensorId']);if(_0x132d2c&&_0x132d2c[_0x2bb22f(0x14b)]!==undefined&&_0x132d2c['val']!==null)return parseFloat(_0x132d2c[_0x2bb22f(0x14b)]);}catch(_0x2ba39c){}const _0x69a4b=_0x149f38[_0x2bb22f(0x16d)][_0x2bb22f(0x131)];if(!_0x149f38[_0x2bb22f(0x16d)][_0x2bb22f(0x168)]||!_0x69a4b)return null;try{let _0x42a3be='';if(_0x69a4b[_0x2bb22f(0x17e)](_0x2bb22f(0x125)))_0x42a3be=_0x69a4b+_0x2bb22f(0x183);else{if(_0x69a4b[_0x2bb22f(0x17e)](_0x2bb22f(0x189)))_0x42a3be=_0x69a4b+'.NextHours.Location_1.Day_1.current.temp_value';else{if(_0x69a4b[_0x2bb22f(0x17e)](_0x2bb22f(0x191)))_0x42a3be=_0x69a4b+_0x2bb22f(0x129);else{if(_0x69a4b[_0x2bb22f(0x17e)](_0x2bb22f(0x18a)))_0x42a3be=_0x69a4b+_0x2bb22f(0x142);}}}if(_0x42a3be){const _0x548e41=await _0x149f38[_0x2bb22f(0x18d)](_0x42a3be);if(_0x548e41&&_0x548e41[_0x2bb22f(0x14b)]!==undefined&&_0x548e41[_0x2bb22f(0x14b)]!==null)return parseFloat(_0x548e41[_0x2bb22f(0x14b)]);}}catch(_0x1a4524){}return null;}async function recordThermodynamics(_0x22a791,_0x506a4e,_0x5aa713,_0x4da62e){const _0x143e9a=a5_0x2656,_0x535098=await getOutsideTemperatureNumeric(_0x22a791);if(_0x535098===null)return;let _0x522956=0x0,_0x2053b3=![];if(_0x22a791[_0x143e9a(0x16d)]['valveMapping'])try{let _0x186072=_0x22a791[_0x143e9a(0x16d)][_0x143e9a(0x192)];if(typeof _0x186072===_0x143e9a(0x176))_0x186072=JSON[_0x143e9a(0x155)](_0x186072);if(_0x186072[_0x506a4e]){const _0x1498d7=_0x186072[_0x506a4e],_0x3ad752=await _0x22a791['getForeignStateAsync'](_0x1498d7);if(_0x3ad752&&_0x3ad752[_0x143e9a(0x14b)]!==null&&_0x3ad752[_0x143e9a(0x14b)]!==undefined){let _0x198456=Number(_0x3ad752[_0x143e9a(0x14b)]);if(_0x198456<=1.05&&!_0x1498d7[_0x143e9a(0x17e)](_0x143e9a(0x18c))&&!_0x1498d7[_0x143e9a(0x17e)](_0x143e9a(0x17d)))_0x198456=_0x198456*0x64;_0x522956=Math['round'](_0x198456),_0x2053b3=!![];}}}catch(_0x22e2c1){}if(!_0x2053b3){const _0x130d5d=[{'from':_0x143e9a(0x193),'to':_0x143e9a(0x16b)},{'from':'.1.ACTUAL_TEMPERATURE','to':_0x143e9a(0x13b)},{'from':'.1.TEMPERATURE','to':_0x143e9a(0x127)},{'from':'.ACTUAL_TEMPERATURE','to':'.LEVEL'},{'from':_0x143e9a(0x15a),'to':'level'},{'from':_0x143e9a(0x12f),'to':_0x143e9a(0x157)}];for(const _0x5bb9c6 of _0x130d5d){if(_0x506a4e[_0x143e9a(0x17e)](_0x5bb9c6['from'])){const _0x1a311d=_0x506a4e[_0x143e9a(0x136)](_0x5bb9c6['from'],_0x5bb9c6['to']);try{const _0x59ad0e=await _0x22a791[_0x143e9a(0x18d)](_0x1a311d);if(_0x59ad0e&&_0x59ad0e['val']!==null&&_0x59ad0e[_0x143e9a(0x14b)]!==undefined){let _0x291a83=Number(_0x59ad0e[_0x143e9a(0x14b)]);if(typeof _0x291a83===_0x143e9a(0x17c)){if(_0x291a83<=1.05&&_0x5bb9c6['to'][_0x143e9a(0x17e)](_0x143e9a(0x14c)))_0x291a83=_0x291a83*0x64;_0x522956=Math[_0x143e9a(0x178)](_0x291a83),_0x2053b3=!![];break;}}}catch(_0x1d9c6f){}}}}const _0x3bc33a=await _0x22a791[_0x143e9a(0x18e)](_0x143e9a(0x17a));let _0x2a8abc=[];if(_0x3bc33a&&_0x3bc33a[_0x143e9a(0x14b)])try{_0x2a8abc=JSON[_0x143e9a(0x155)](_0x3bc33a[_0x143e9a(0x14b)]);}catch(_0x40c2af){}_0x2a8abc['push']({'ts':Date['now'](),'room':_0x4da62e||'Unknown','t_in':_0x5aa713,'t_out':_0x535098,'valve':_0x522956});if(_0x2a8abc[_0x143e9a(0x170)]>THERMO_LOG_SIZE)_0x2a8abc[_0x143e9a(0x15b)]();await _0x22a791[_0x143e9a(0x13a)](_0x143e9a(0x17a),{'val':JSON[_0x143e9a(0x185)](_0x2a8abc),'ack':!![]});}async function saveCompletedSequence(_0x446bae){const _0x15efc9=a5_0x2656;try{const _0x55abe3=await _0x446bae[_0x15efc9(0x18e)](_0x15efc9(0x148));let _0x4da3f6=[];if(_0x55abe3&&_0x55abe3[_0x15efc9(0x14b)])try{_0x4da3f6=JSON[_0x15efc9(0x155)](_0x55abe3['val']);}catch(_0x5bd933){}const _0x3f29e6=activeSequence[0x0]['ts'],_0x4bfda2=activeSequence[_0x15efc9(0x166)](_0x2f19d7=>({'loc':_0x2f19d7[_0x15efc9(0x169)],'t_delta':Math[_0x15efc9(0x178)]((_0x2f19d7['ts']-_0x3f29e6)/0x3e8)})),_0x363002={'timestamp':new Date(_0x3f29e6)[_0x15efc9(0x17f)](),'steps':_0x4bfda2,'duration':Math[_0x15efc9(0x178)]((activeSequence[activeSequence['length']-0x1]['ts']-_0x3f29e6)/0x3e8),'daytime':new Date(_0x3f29e6)[_0x15efc9(0x167)]()};_0x4da3f6[_0x15efc9(0x137)](_0x363002);if(_0x4da3f6['length']>MAX_TRAINING_SET_SIZE)_0x4da3f6['shift']();await _0x446bae['setStateAsync'](_0x15efc9(0x148),{'val':JSON[_0x15efc9(0x185)](_0x4da3f6),'ack':!![]}),_0x446bae[_0x15efc9(0x16f)]&&_0x446bae[_0x15efc9(0x18b)]&&_0x446bae[_0x15efc9(0x18b)](_0x15efc9(0x140),{'sequence':_0x363002});}catch(_0x3edeba){_0x446bae[_0x15efc9(0x161)]['error'](_0x15efc9(0x17b)+_0x3edeba[_0x15efc9(0x143)]);}}async function recordSequence(_0x499c41,_0x3106fa){const _0x1efd50=a5_0x2656,_0x1fcd0a=(_0x3106fa[_0x1efd50(0x147)]||'')[_0x1efd50(0x179)](),_0x4ddb53=[_0x1efd50(0x160),_0x1efd50(0x15c),_0x1efd50(0x184),'presence','occupancy',_0x1efd50(0x144),_0x1efd50(0x15d),'window',_0x1efd50(0x153),'contact',_0x1efd50(0x164),_0x1efd50(0x12c),'licht',_0x1efd50(0x174),_0x1efd50(0x134),_0x1efd50(0x12a),_0x1efd50(0x159)];if(!_0x4ddb53[_0x1efd50(0x14d)](_0x4cd9f1=>_0x1fcd0a[_0x1efd50(0x17e)](_0x4cd9f1)))return;if(!_0x3106fa[_0x1efd50(0x13e)])return;if(sequenceTimer)clearTimeout(sequenceTimer);activeSequence[_0x1efd50(0x137)]({'loc':_0x3106fa[_0x1efd50(0x188)]||_0x1efd50(0x175),'id':_0x3106fa['id'],'ts':Date[_0x1efd50(0x186)]()}),sequenceTimer=setTimeout(async()=>{const _0x3fb709=_0x1efd50;if(activeSequence[_0x3fb709(0x170)]>0x1)await saveCompletedSequence(_0x499c41);activeSequence=[];},SEQUENCE_TIMEOUT_MS);}function startExitTimer(_0x377661){const _0x5b0d9e=a5_0x2656;abortExitTimer(_0x377661),_0x377661[_0x5b0d9e(0x135)]=!![],_0x377661[_0x5b0d9e(0x12b)]=setTimeout(()=>{const _0x459e28=_0x5b0d9e;_0x377661[_0x459e28(0x135)]=![];},EXIT_GRACE_PERIOD_SECONDS*0x3e8),_0x377661[_0x5b0d9e(0x18f)]=setTimeout(()=>{const _0x31d233=_0x5b0d9e;setPresence(_0x377661,![]),_0x377661[_0x31d233(0x18f)]=null;},EXIT_TIMER_MINUTES*0x3c*0x3e8);}function abortExitTimer(_0x158fc8){const _0x165bf8=a5_0x2656;if(_0x158fc8[_0x165bf8(0x18f)])clearTimeout(_0x158fc8[_0x165bf8(0x18f)]);if(_0x158fc8['exitGraceTimer'])clearTimeout(_0x158fc8[_0x165bf8(0x12b)]);_0x158fc8[_0x165bf8(0x18f)]=null,_0x158fc8[_0x165bf8(0x12b)]=null,_0x158fc8[_0x165bf8(0x135)]=![];}async function setPresence(_0x4b2591,_0x18fcdb){const _0x417560=a5_0x2656;if(_0x4b2591[_0x417560(0x14f)]===_0x18fcdb)return;_0x4b2591[_0x417560(0x14f)]=_0x18fcdb,await _0x4b2591[_0x417560(0x13a)](_0x417560(0x151),{'val':_0x18fcdb,'ack':!![]});}async function processSensorEvent(_0x50b7f3,_0x41897b,_0x1f9688,_0x2af3cc){const _0x494754=a5_0x2656;if(!_0x2af3cc)return null;const _0x200dd9=_0x1f9688[_0x494754(0x14b)],_0x46b2cf=Date[_0x494754(0x186)](),_0x24fa8a=_0x50b7f3[_0x494754(0x138)][_0x41897b],_0x419cb2=(_0x2af3cc[_0x494754(0x147)]||'')['toLowerCase'](),_0x1cef07=_0x419cb2[_0x494754(0x17e)]('temperature')||_0x419cb2[_0x494754(0x17e)]('temperatur')||_0x419cb2[_0x494754(0x17e)](_0x494754(0x130))||_0x419cb2[_0x494754(0x17e)](_0x494754(0x12e))||_0x419cb2[_0x494754(0x17e)](_0x494754(0x150));if(_0x1cef07&&typeof _0x200dd9===_0x494754(0x17c)){if(_0x200dd9>0x50||_0x200dd9<-0x32)return _0x50b7f3[_0x494754(0x161)][_0x494754(0x165)](_0x494754(0x145)+_0x200dd9+_0x494754(0x162)+_0x41897b),null;}_0x50b7f3['sensorLastValues'][_0x41897b]=_0x200dd9;if(!_0x2af3cc[_0x494754(0x156)]&&_0x24fa8a!=undefined&&_0x24fa8a==_0x200dd9)return null;_0x50b7f3[_0x494754(0x16f)]&&_0x1cef07&&recordThermodynamics(_0x50b7f3,_0x41897b,_0x200dd9,_0x2af3cc['location']);const _0x55e97b={'timestamp':_0x46b2cf,'id':_0x41897b,'name':_0x2af3cc['name'],'type':_0x2af3cc[_0x494754(0x147)],'location':_0x2af3cc[_0x494754(0x188)],'value':_0x200dd9};_0x50b7f3[_0x494754(0x182)]['unshift'](_0x55e97b);if(_0x50b7f3[_0x494754(0x182)][_0x494754(0x170)]>HISTORY_MAX_SIZE)_0x50b7f3[_0x494754(0x182)][_0x494754(0x141)]();await _0x50b7f3[_0x494754(0x13a)]('events.lastEvent',{'val':JSON[_0x494754(0x185)](_0x55e97b),'ack':!![]}),await _0x50b7f3[_0x494754(0x13a)](_0x494754(0x152),{'val':JSON[_0x494754(0x185)](_0x50b7f3[_0x494754(0x182)]),'ack':!![]});if(_0x50b7f3[_0x494754(0x16f)]){_0x50b7f3[_0x494754(0x177)][_0x494754(0x137)](_0x55e97b);if(_0x50b7f3['rawEventLog'][_0x494754(0x170)]>RAW_LOG_MAX_SIZE)_0x50b7f3[_0x494754(0x177)][_0x494754(0x13c)](0x0,_0x50b7f3[_0x494754(0x177)]['length']-RAW_LOG_MAX_SIZE);await _0x50b7f3['setStateAsync'](_0x494754(0x158),{'val':JSON[_0x494754(0x185)](_0x50b7f3[_0x494754(0x177)]),'ack':!![]}),recordSequence(_0x50b7f3,_0x55e97b);}if(_0x2af3cc['isExit']&&_0x200dd9===!![]){if(_0x50b7f3[_0x494754(0x14f)]&&!_0x50b7f3[_0x494754(0x135)])startExitTimer(_0x50b7f3);else{if(!_0x50b7f3[_0x494754(0x14f)])setPresence(_0x50b7f3,!![]);}}else{if(_0x2af3cc[_0x494754(0x147)]===_0x494754(0x160)&&_0x200dd9===!![]){if(_0x50b7f3[_0x494754(0x18f)])abortExitTimer(_0x50b7f3);if(!_0x50b7f3[_0x494754(0x14f)]&&_0x50b7f3['currentSystemMode']===_0x494754(0x128))setPresence(_0x50b7f3,!![]);}}if(_0x50b7f3['isProVersion']&&_0x50b7f3['sendToPythonWrapper']){_0x2af3cc['type']===_0x494754(0x160)&&_0x200dd9===!![]&&_0x2af3cc[_0x494754(0x188)]&&_0x50b7f3[_0x494754(0x18b)]('SIMULATE_SIGNAL',{'room':_0x2af3cc[_0x494754(0x188)]});const _0x4ec84a=[_0x494754(0x144),_0x494754(0x15d),'window',_0x494754(0x153),_0x494754(0x16c),_0x494754(0x139),'lock',_0x494754(0x171)][_0x494754(0x14d)](_0x26d782=>_0x419cb2[_0x494754(0x17e)](_0x26d782)),_0x5895b6=[_0x494754(0x12c),_0x494754(0x163),_0x494754(0x174),_0x494754(0x134),_0x494754(0x12a),_0x494754(0x159)]['some'](_0x422053=>_0x419cb2[_0x494754(0x17e)](_0x422053)),_0x2fcfdb=[_0x494754(0x160),'bewegung',_0x494754(0x184),_0x494754(0x187),_0x494754(0x16a)][_0x494754(0x14d)](_0x5a36c1=>_0x419cb2['includes'](_0x5a36c1));if(_0x2af3cc[_0x494754(0x188)]&&(_0x4ec84a||_0x5895b6||_0x2fcfdb)){const _0x2a955a=_0x200dd9===!![]||typeof _0x200dd9==='number'&&_0x200dd9>0x0,_0x475cb2=_0x4ec84a&&!_0x2a955a&&_0x24fa8a!==undefined&&_0x24fa8a!=_0x200dd9;if(_0x2a955a||_0x475cb2){const _0x24bd9=_0x50b7f3['lastTrackerEventTime']||_0x46b2cf,_0xc7a727=(_0x46b2cf-_0x24bd9)/0x3e8;_0x50b7f3[_0x494754(0x172)]=_0x46b2cf,_0x50b7f3['sendToPythonWrapper'](_0x494754(0x133),{'room':_0x2af3cc[_0x494754(0x188)],'dt':_0xc7a727});}}}return _0x55e97b;}module[a5_0x24999a(0x190)]={'processSensorEvent':processSensorEvent,'getOutsideTemperatureNumeric':getOutsideTemperatureNumeric,'setPresence':setPresence,'abortExitTimer':abortExitTimer,'startExitTimer':startExitTimer};