const a5_0x42bfa6=a5_0x320c;(function(_0x35e2ec,_0x2ee60b){const _0x43279c=a5_0x320c,_0x31f839=_0x35e2ec();while(!![]){try{const _0x3c1532=-parseInt(_0x43279c(0x14a))/0x1*(parseInt(_0x43279c(0x159))/0x2)+-parseInt(_0x43279c(0x187))/0x3*(-parseInt(_0x43279c(0x172))/0x4)+-parseInt(_0x43279c(0x1b8))/0x5+parseInt(_0x43279c(0x16f))/0x6*(-parseInt(_0x43279c(0x1b6))/0x7)+-parseInt(_0x43279c(0x190))/0x8*(parseInt(_0x43279c(0x199))/0x9)+-parseInt(_0x43279c(0x191))/0xa+parseInt(_0x43279c(0x1a5))/0xb*(parseInt(_0x43279c(0x19b))/0xc);if(_0x3c1532===_0x2ee60b)break;else _0x31f839['push'](_0x31f839['shift']());}catch(_0x1593af){_0x31f839['push'](_0x31f839['shift']());}}}(a5_0x2852,0x469b8));const a5_0x1d7b35=(function(){let _0x1a67c1=!![];return function(_0x21aba4,_0x45a00b){const _0xbfcc=_0x1a67c1?function(){const _0x5e7638=a5_0x320c;if(_0x45a00b){const _0x1ad4a6=_0x45a00b[_0x5e7638(0x160)](_0x21aba4,arguments);return _0x45a00b=null,_0x1ad4a6;}}:function(){};return _0x1a67c1=![],_0xbfcc;};}()),a5_0x27cca8=a5_0x1d7b35(this,function(){const _0x351113=a5_0x320c;return a5_0x27cca8[_0x351113(0x161)]()[_0x351113(0x19d)](_0x351113(0x181))[_0x351113(0x161)]()[_0x351113(0x1ab)](a5_0x27cca8)[_0x351113(0x19d)](_0x351113(0x181));});a5_0x27cca8();'use strict';const HISTORY_MAX_SIZE=0x32,RAW_LOG_MAX_SIZE=0x9c4,THERMO_LOG_SIZE=0x3e8,SEQUENCE_TIMEOUT_MS=0x5*0x3c*0x3e8,MAX_TRAINING_SET_SIZE=0x1f4,EXIT_TIMER_MINUTES=0xf,EXIT_GRACE_PERIOD_SECONDS=0x1e;let activeSequence=[],sequenceTimer=null;async function getOutsideTemperatureNumeric(_0x23c6a9){const _0x2d372d=a5_0x320c;if(_0x23c6a9[_0x2d372d(0x19f)][_0x2d372d(0x169)])try{const _0x45bba6=await _0x23c6a9[_0x2d372d(0x1a4)](_0x23c6a9[_0x2d372d(0x19f)][_0x2d372d(0x169)]);if(_0x45bba6&&_0x45bba6['val']!==undefined&&_0x45bba6[_0x2d372d(0x1ad)]!==null)return parseFloat(_0x45bba6['val']);}catch(_0x6c2681){}const _0x189ead=_0x23c6a9[_0x2d372d(0x19f)][_0x2d372d(0x179)];if(!_0x23c6a9[_0x2d372d(0x19f)][_0x2d372d(0x168)]||!_0x189ead)return null;try{let _0x1f0347='';if(_0x189ead['includes'](_0x2d372d(0x193)))_0x1f0347=_0x189ead+_0x2d372d(0x189);else{if(_0x189ead[_0x2d372d(0x167)](_0x2d372d(0x150)))_0x1f0347=_0x189ead+_0x2d372d(0x180);else{if(_0x189ead[_0x2d372d(0x167)](_0x2d372d(0x1a6)))_0x1f0347=_0x189ead+'.forecast.current.temperature';else{if(_0x189ead[_0x2d372d(0x167)](_0x2d372d(0x18a)))_0x1f0347=_0x189ead+_0x2d372d(0x198);}}}if(_0x1f0347){const _0x21ff8b=await _0x23c6a9[_0x2d372d(0x1a4)](_0x1f0347);if(_0x21ff8b&&_0x21ff8b[_0x2d372d(0x1ad)]!==undefined&&_0x21ff8b[_0x2d372d(0x1ad)]!==null)return parseFloat(_0x21ff8b[_0x2d372d(0x1ad)]);}}catch(_0x44fa95){}return null;}async function recordThermodynamics(_0x564530,_0x880abd,_0x730c1,_0x21656c){const _0x571eff=a5_0x320c,_0x249883=await getOutsideTemperatureNumeric(_0x564530);if(_0x249883===null)return;let _0xf4bfd8=0x0,_0x545346=![];if(_0x564530[_0x571eff(0x19f)][_0x571eff(0x17c)])try{let _0x12d651=_0x564530[_0x571eff(0x19f)][_0x571eff(0x17c)];if(typeof _0x12d651==='string')_0x12d651=JSON[_0x571eff(0x18c)](_0x12d651);if(_0x12d651[_0x880abd]){const _0x2435a3=_0x12d651[_0x880abd],_0x2432b7=await _0x564530[_0x571eff(0x1a4)](_0x2435a3);if(_0x2432b7&&_0x2432b7[_0x571eff(0x1ad)]!==null&&_0x2432b7[_0x571eff(0x1ad)]!==undefined){let _0x411803=Number(_0x2432b7[_0x571eff(0x1ad)]);if(_0x411803<=1.05&&!_0x2435a3['includes'](_0x571eff(0x1a9))&&!_0x2435a3[_0x571eff(0x167)]('STATE'))_0x411803=_0x411803*0x64;_0xf4bfd8=Math[_0x571eff(0x1b0)](_0x411803),_0x545346=!![];}}}catch(_0x236aeb){}if(!_0x545346){const _0xa6a599=[{'from':_0x571eff(0x16c),'to':_0x571eff(0x18f)},{'from':_0x571eff(0x16c),'to':'.1.VALVE_STATE'},{'from':_0x571eff(0x166),'to':'.4.VALVE_STATE'},{'from':_0x571eff(0x17f),'to':'.LEVEL'},{'from':_0x571eff(0x164),'to':_0x571eff(0x14b)},{'from':_0x571eff(0x170),'to':_0x571eff(0x15e)}];for(const _0x227f97 of _0xa6a599){if(_0x880abd['includes'](_0x227f97[_0x571eff(0x165)])){const _0x380176=_0x880abd['replace'](_0x227f97[_0x571eff(0x165)],_0x227f97['to']);try{const _0x1a93fa=await _0x564530[_0x571eff(0x1a4)](_0x380176);if(_0x1a93fa&&_0x1a93fa[_0x571eff(0x1ad)]!==null&&_0x1a93fa[_0x571eff(0x1ad)]!==undefined){let _0x35fc7c=Number(_0x1a93fa['val']);if(typeof _0x35fc7c==='number'){if(_0x35fc7c<=1.05&&_0x227f97['to'][_0x571eff(0x167)](_0x571eff(0x1ba)))_0x35fc7c=_0x35fc7c*0x64;_0xf4bfd8=Math[_0x571eff(0x1b0)](_0x35fc7c),_0x545346=!![];break;}}}catch(_0x49752d){}}}}const _0x4c6a1c=await _0x564530[_0x571eff(0x162)]('LTM.trainingData.thermodynamics');let _0x3aa59c=[];if(_0x4c6a1c&&_0x4c6a1c[_0x571eff(0x1ad)])try{_0x3aa59c=JSON['parse'](_0x4c6a1c[_0x571eff(0x1ad)]);}catch(_0x17b774){}_0x3aa59c[_0x571eff(0x1ae)]({'ts':Date[_0x571eff(0x15f)](),'room':_0x21656c||_0x571eff(0x19c),'t_in':_0x730c1,'t_out':_0x249883,'valve':_0xf4bfd8});if(_0x3aa59c[_0x571eff(0x197)]>THERMO_LOG_SIZE)_0x3aa59c[_0x571eff(0x16e)]();await _0x564530[_0x571eff(0x177)](_0x571eff(0x1b3),{'val':JSON[_0x571eff(0x15b)](_0x3aa59c),'ack':!![]});}async function saveCompletedSequence(_0x1f2ba9){const _0x2782d0=a5_0x320c;try{const _0x5cb998=await _0x1f2ba9[_0x2782d0(0x162)](_0x2782d0(0x14c));let _0x49fa85=[];if(_0x5cb998&&_0x5cb998['val'])try{_0x49fa85=JSON['parse'](_0x5cb998[_0x2782d0(0x1ad)]);}catch(_0x12a948){}const _0x150351=activeSequence[0x0]['ts'],_0x4fba65=activeSequence[_0x2782d0(0x173)](_0x5b8982=>({'loc':_0x5b8982['loc'],'t_delta':Math[_0x2782d0(0x1b0)]((_0x5b8982['ts']-_0x150351)/0x3e8)})),_0x4e0e99={'timestamp':new Date(_0x150351)[_0x2782d0(0x18b)](),'steps':_0x4fba65,'duration':Math['round']((activeSequence[activeSequence[_0x2782d0(0x197)]-0x1]['ts']-_0x150351)/0x3e8),'daytime':new Date(_0x150351)[_0x2782d0(0x151)]()};_0x49fa85[_0x2782d0(0x1ae)](_0x4e0e99);if(_0x49fa85[_0x2782d0(0x197)]>MAX_TRAINING_SET_SIZE)_0x49fa85['shift']();await _0x1f2ba9[_0x2782d0(0x177)](_0x2782d0(0x14c),{'val':JSON['stringify'](_0x49fa85),'ack':!![]}),_0x1f2ba9['isProVersion']&&_0x1f2ba9[_0x2782d0(0x196)]&&_0x1f2ba9[_0x2782d0(0x196)](_0x2782d0(0x1a3),{'sequence':_0x4e0e99});}catch(_0x19d39d){_0x1f2ba9[_0x2782d0(0x174)][_0x2782d0(0x157)]('[RECORDER]\x20Error:\x20'+_0x19d39d[_0x2782d0(0x178)]);}}async function recordSequence(_0x566b60,_0x151543){const _0x1999b9=a5_0x320c,_0x3d726e=(_0x151543[_0x1999b9(0x1a0)]||'')[_0x1999b9(0x175)](),_0x592bc1=[_0x1999b9(0x15c),'bewegung',_0x1999b9(0x17e),_0x1999b9(0x1b4),_0x1999b9(0x183),_0x1999b9(0x19e),_0x1999b9(0x14e),'window',_0x1999b9(0x1b9),'contact','kontakt',_0x1999b9(0x1a1),_0x1999b9(0x163),_0x1999b9(0x1ac),'schalter',_0x1999b9(0x195),'lampe'];if(!_0x592bc1[_0x1999b9(0x194)](_0x44fed9=>_0x3d726e[_0x1999b9(0x167)](_0x44fed9)))return;if(!_0x151543[_0x1999b9(0x17d)])return;if(sequenceTimer)clearTimeout(sequenceTimer);activeSequence['push']({'loc':_0x151543['location']||_0x1999b9(0x19c),'id':_0x151543['id'],'ts':Date[_0x1999b9(0x15f)]()}),sequenceTimer=setTimeout(async()=>{const _0x50e2bf=_0x1999b9;if(activeSequence[_0x50e2bf(0x197)]>0x1)await saveCompletedSequence(_0x566b60);activeSequence=[];},SEQUENCE_TIMEOUT_MS);}function a5_0x2852(){const _0x20257f=['round','isProVersion','schloss','LTM.trainingData.thermodynamics','presence','LTM.rawEventLog','14iieyuS','currentSystemMode','2880180JyFTbJ','fenster','LEVEL','location','73493iygOFg','level','LTM.trainingData.sequences','pop','tür','normal','daswetter','getHours','schalter','isGracePeriodActive','handle','sensorLastValues','TRACK_EVENT','error','[RECORDER]\x20Ignored\x20implausible\x20temperature:\x20','10wHIrGT','fill','stringify','motion','number','Valve','now','apply','toString','getStateAsync','licht','temperature','from','.1.TEMPERATURE','includes','useWeather','outdoorSensorId','\x20from\x20','splice','.1.ACTUAL_TEMPERATURE','eventHistory','shift','1060674ZpFniN','Temperature','bewegung','36104QlJNLY','map','log','toLowerCase','exports','setStateAsync','message','weatherInstance','exitGraceTimer','exitTimer','valveMapping','value','präsenz','.ACTUAL_TEMPERATURE','.NextHours.Location_1.Day_1.current.temp_value','(((.+)+)+)+$','system.isPresent','occupancy','events.history','SIMULATE_SIGNAL','griff','42NsnSdP','isPresent','.Current.Temperature','weatherunderground','toISOString','parse','thermostat','lastTrackerEventTime','.1.LEVEL','7992nFGHbD','1984960jRHgwO','heizung','accuweather','some','dimmer','sendToPythonWrapper','length','.forecast.current.temp','873VdoPqs','logDuplicates','10531812PHMkBO','Unknown','search','door','config','type','light','window','ANALYZE_SEQUENCE','getForeignStateAsync','22knsBan','openweathermap','lock','temperatur','STATUS','rawEventLog','constructor','switch','val','push','analysis.health.todayVector'];a5_0x2852=function(){return _0x20257f;};return a5_0x2852();}function startExitTimer(_0x14edcb){const _0x3a3190=a5_0x320c;abortExitTimer(_0x14edcb),_0x14edcb[_0x3a3190(0x153)]=!![],_0x14edcb['exitGraceTimer']=setTimeout(()=>{const _0x4380d1=_0x3a3190;_0x14edcb[_0x4380d1(0x153)]=![];},EXIT_GRACE_PERIOD_SECONDS*0x3e8),_0x14edcb[_0x3a3190(0x17b)]=setTimeout(()=>{setPresence(_0x14edcb,![]),_0x14edcb['exitTimer']=null;},EXIT_TIMER_MINUTES*0x3c*0x3e8);}function abortExitTimer(_0x35e8dc){const _0x3d2b5e=a5_0x320c;if(_0x35e8dc[_0x3d2b5e(0x17b)])clearTimeout(_0x35e8dc[_0x3d2b5e(0x17b)]);if(_0x35e8dc[_0x3d2b5e(0x17a)])clearTimeout(_0x35e8dc[_0x3d2b5e(0x17a)]);_0x35e8dc[_0x3d2b5e(0x17b)]=null,_0x35e8dc[_0x3d2b5e(0x17a)]=null,_0x35e8dc[_0x3d2b5e(0x153)]=![];}async function setPresence(_0x380b2e,_0x3f67bf){const _0x354242=a5_0x320c;if(_0x380b2e['isPresent']===_0x3f67bf)return;_0x380b2e[_0x354242(0x188)]=_0x3f67bf,await _0x380b2e[_0x354242(0x177)](_0x354242(0x182),{'val':_0x3f67bf,'ack':!![]});}function a5_0x320c(_0x2c9016,_0x5330a6){const _0x84234f=a5_0x2852();return a5_0x320c=function(_0x27cca8,_0x1d7b35){_0x27cca8=_0x27cca8-0x14a;let _0x2852be=_0x84234f[_0x27cca8];return _0x2852be;},a5_0x320c(_0x2c9016,_0x5330a6);}async function updateHourlyActivity(_0x52602b){const _0x390d79=a5_0x320c;let _0x5002b8=new Array(0x18)['fill'](0x0),_0x4b0b53=0x0;try{const _0x4ca675=await _0x52602b[_0x390d79(0x162)](_0x390d79(0x1af));_0x4ca675&&_0x4ca675[_0x390d79(0x1ad)]&&(_0x5002b8=JSON[_0x390d79(0x18c)](_0x4ca675[_0x390d79(0x1ad)]),_0x4b0b53=_0x4ca675['ts']);}catch(_0x108920){}const _0xfad6e3=new Date(_0x4b0b53),_0x137785=new Date();_0xfad6e3['getDate']()!==_0x137785['getDate']()&&(_0x5002b8=new Array(0x18)[_0x390d79(0x15a)](0x0));const _0x2ad078=_0x137785['getHours']();if(_0x5002b8[_0x2ad078]===undefined)_0x5002b8[_0x2ad078]=0x0;_0x5002b8[_0x2ad078]++,await _0x52602b[_0x390d79(0x177)](_0x390d79(0x1af),{'val':JSON['stringify'](_0x5002b8),'ack':!![]});}async function processSensorEvent(_0x3538c4,_0x3936d6,_0x4258d3,_0x88c966){const _0x1f2f08=a5_0x320c;if(!_0x88c966)return null;const _0x434c39=_0x4258d3['val'],_0x160915=Date[_0x1f2f08(0x15f)](),_0x164e34=_0x3538c4[_0x1f2f08(0x155)][_0x3936d6],_0x55aad1=(_0x88c966[_0x1f2f08(0x1a0)]||'')[_0x1f2f08(0x175)](),_0x58368e=_0x55aad1[_0x1f2f08(0x167)](_0x1f2f08(0x164))||_0x55aad1[_0x1f2f08(0x167)](_0x1f2f08(0x1a8))||_0x55aad1[_0x1f2f08(0x167)]('klima')||_0x55aad1['includes'](_0x1f2f08(0x192))||_0x55aad1[_0x1f2f08(0x167)](_0x1f2f08(0x18d));if(_0x58368e&&typeof _0x434c39===_0x1f2f08(0x15d)){if(_0x434c39>0x50||_0x434c39<-0x32)return _0x3538c4[_0x1f2f08(0x174)]['debug'](_0x1f2f08(0x158)+_0x434c39+_0x1f2f08(0x16a)+_0x3936d6),null;}_0x3538c4[_0x1f2f08(0x155)][_0x3936d6]=_0x434c39;if(!_0x88c966[_0x1f2f08(0x19a)]&&_0x164e34!=undefined&&_0x164e34==_0x434c39)return null;_0x3538c4[_0x1f2f08(0x1b1)]&&_0x58368e&&recordThermodynamics(_0x3538c4,_0x3936d6,_0x434c39,_0x88c966[_0x1f2f08(0x1bb)]);const _0x3dd5a3={'timestamp':_0x160915,'id':_0x3936d6,'name':_0x88c966['name'],'type':_0x88c966[_0x1f2f08(0x1a0)],'location':_0x88c966[_0x1f2f08(0x1bb)],'value':_0x434c39};_0x3538c4[_0x1f2f08(0x16d)]['unshift'](_0x3dd5a3);if(_0x3538c4[_0x1f2f08(0x16d)][_0x1f2f08(0x197)]>HISTORY_MAX_SIZE)_0x3538c4[_0x1f2f08(0x16d)][_0x1f2f08(0x14d)]();await _0x3538c4['setStateAsync']('events.lastEvent',{'val':JSON[_0x1f2f08(0x15b)](_0x3dd5a3),'ack':!![]}),await _0x3538c4[_0x1f2f08(0x177)](_0x1f2f08(0x184),{'val':JSON[_0x1f2f08(0x15b)](_0x3538c4['eventHistory']),'ack':!![]}),await updateHourlyActivity(_0x3538c4);if(_0x3538c4[_0x1f2f08(0x1b1)]){_0x3538c4[_0x1f2f08(0x1aa)][_0x1f2f08(0x1ae)](_0x3dd5a3);if(_0x3538c4[_0x1f2f08(0x1aa)][_0x1f2f08(0x197)]>RAW_LOG_MAX_SIZE)_0x3538c4['rawEventLog'][_0x1f2f08(0x16b)](0x0,_0x3538c4[_0x1f2f08(0x1aa)]['length']-RAW_LOG_MAX_SIZE);await _0x3538c4[_0x1f2f08(0x177)](_0x1f2f08(0x1b5),{'val':JSON['stringify'](_0x3538c4[_0x1f2f08(0x1aa)]),'ack':!![]}),recordSequence(_0x3538c4,_0x3dd5a3);}if(_0x88c966['isExit']&&_0x434c39===!![]){if(_0x3538c4[_0x1f2f08(0x188)]&&!_0x3538c4[_0x1f2f08(0x153)])startExitTimer(_0x3538c4);else{if(!_0x3538c4[_0x1f2f08(0x188)])setPresence(_0x3538c4,!![]);}}else{if(_0x88c966[_0x1f2f08(0x1a0)]===_0x1f2f08(0x15c)&&_0x434c39===!![]){if(_0x3538c4[_0x1f2f08(0x17b)])abortExitTimer(_0x3538c4);if(!_0x3538c4['isPresent']&&_0x3538c4[_0x1f2f08(0x1b7)]===_0x1f2f08(0x14f))setPresence(_0x3538c4,!![]);}}if(_0x3538c4['isProVersion']&&_0x3538c4['sendToPythonWrapper']){_0x88c966[_0x1f2f08(0x1a0)]==='motion'&&_0x434c39===!![]&&_0x88c966['location']&&_0x3538c4[_0x1f2f08(0x196)](_0x1f2f08(0x185),{'room':_0x88c966[_0x1f2f08(0x1bb)]});const _0x4b9ae6=[_0x1f2f08(0x19e),_0x1f2f08(0x14e),_0x1f2f08(0x1a2),'fenster',_0x1f2f08(0x186),_0x1f2f08(0x154),_0x1f2f08(0x1a7),_0x1f2f08(0x1b2)][_0x1f2f08(0x194)](_0x1907a1=>_0x55aad1[_0x1f2f08(0x167)](_0x1907a1)),_0x152d72=['light',_0x1f2f08(0x163),_0x1f2f08(0x1ac),_0x1f2f08(0x152),_0x1f2f08(0x195),'lampe'][_0x1f2f08(0x194)](_0x4f0dc6=>_0x55aad1[_0x1f2f08(0x167)](_0x4f0dc6)),_0x3e515b=[_0x1f2f08(0x15c),_0x1f2f08(0x171),_0x1f2f08(0x17e),_0x1f2f08(0x1b4),_0x1f2f08(0x183)]['some'](_0x381eff=>_0x55aad1[_0x1f2f08(0x167)](_0x381eff));if(_0x88c966[_0x1f2f08(0x1bb)]&&(_0x4b9ae6||_0x152d72||_0x3e515b)){const _0x13149c=_0x434c39===!![]||typeof _0x434c39===_0x1f2f08(0x15d)&&_0x434c39>0x0,_0x398844=_0x4b9ae6&&!_0x13149c&&_0x164e34!==undefined&&_0x164e34!=_0x434c39;if(_0x13149c||_0x398844){const _0xb56a7b=_0x3538c4[_0x1f2f08(0x18e)]||_0x160915,_0x1bdde4=(_0x160915-_0xb56a7b)/0x3e8;_0x3538c4['lastTrackerEventTime']=_0x160915,_0x3538c4['sendToPythonWrapper'](_0x1f2f08(0x156),{'room':_0x88c966['location'],'dt':_0x1bdde4});}}}return _0x3dd5a3;}module[a5_0x42bfa6(0x176)]={'processSensorEvent':processSensorEvent,'getOutsideTemperatureNumeric':getOutsideTemperatureNumeric,'setPresence':setPresence,'abortExitTimer':abortExitTimer,'startExitTimer':startExitTimer};