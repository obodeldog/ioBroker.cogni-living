const a5_0x4bab4b=a5_0x4483;(function(_0x103a3f,_0x25217b){const _0x41dbd8=a5_0x4483,_0x151ba5=_0x103a3f();while(!![]){try{const _0xc31e5=parseInt(_0x41dbd8(0x1d1))/0x1*(-parseInt(_0x41dbd8(0x181))/0x2)+-parseInt(_0x41dbd8(0x1aa))/0x3+-parseInt(_0x41dbd8(0x1ac))/0x4+parseInt(_0x41dbd8(0x1b6))/0x5+-parseInt(_0x41dbd8(0x1af))/0x6*(parseInt(_0x41dbd8(0x198))/0x7)+-parseInt(_0x41dbd8(0x1c3))/0x8+-parseInt(_0x41dbd8(0x1a5))/0x9*(-parseInt(_0x41dbd8(0x1a4))/0xa);if(_0xc31e5===_0x25217b)break;else _0x151ba5['push'](_0x151ba5['shift']());}catch(_0x412f96){_0x151ba5['push'](_0x151ba5['shift']());}}}(a5_0xfa64,0x355fb));const a5_0x24dfd8=(function(){let _0x1a8583=!![];return function(_0x27f1fa,_0xa4ce44){const _0x6f1ad1=_0x1a8583?function(){const _0x37d910=a5_0x4483;if(_0xa4ce44){const _0x185cf4=_0xa4ce44[_0x37d910(0x1d3)](_0x27f1fa,arguments);return _0xa4ce44=null,_0x185cf4;}}:function(){};return _0x1a8583=![],_0x6f1ad1;};}()),a5_0x27aa90=a5_0x24dfd8(this,function(){const _0x1df55e=a5_0x4483;return a5_0x27aa90[_0x1df55e(0x183)]()[_0x1df55e(0x1a1)]('(((.+)+)+)+$')[_0x1df55e(0x183)]()['constructor'](a5_0x27aa90)['search'](_0x1df55e(0x196));});a5_0x27aa90();'use strict';const HISTORY_MAX_SIZE=0x32,RAW_LOG_MAX_SIZE=0x9c4,THERMO_LOG_SIZE=0x3e8,SEQUENCE_TIMEOUT_MS=0x5*0x3c*0x3e8,MAX_TRAINING_SET_SIZE=0x1f4,EXIT_TIMER_MINUTES=0xf,EXIT_GRACE_PERIOD_SECONDS=0x1e;function a5_0x4483(_0x2c332a,_0x355935){const _0x372861=a5_0xfa64();return a5_0x4483=function(_0x27aa90,_0x24dfd8){_0x27aa90=_0x27aa90-0x180;let _0xfa64d6=_0x372861[_0x27aa90];return _0xfa64d6;},a5_0x4483(_0x2c332a,_0x355935);}let activeSequence=[],sequenceTimer=null;async function getOutsideTemperatureNumeric(_0x12e9b7){const _0x225066=a5_0x4483;if(_0x12e9b7['config']['outdoorSensorId'])try{const _0x5807d9=await _0x12e9b7['getForeignStateAsync'](_0x12e9b7['config'][_0x225066(0x1cd)]);if(_0x5807d9&&_0x5807d9[_0x225066(0x1ce)]!==undefined&&_0x5807d9['val']!==null)return parseFloat(_0x5807d9[_0x225066(0x1ce)]);}catch(_0x47eebe){}const _0x408aad=_0x12e9b7[_0x225066(0x18a)][_0x225066(0x1be)];if(!_0x12e9b7[_0x225066(0x18a)][_0x225066(0x190)]||!_0x408aad)return null;try{let _0x3d3c4e='';if(_0x408aad[_0x225066(0x1ba)](_0x225066(0x19e)))_0x3d3c4e=_0x408aad+_0x225066(0x1b8);else{if(_0x408aad[_0x225066(0x1ba)](_0x225066(0x1b0)))_0x3d3c4e=_0x408aad+_0x225066(0x182);else{if(_0x408aad[_0x225066(0x1ba)](_0x225066(0x1d0)))_0x3d3c4e=_0x408aad+_0x225066(0x1a2);else{if(_0x408aad[_0x225066(0x1ba)](_0x225066(0x1c8)))_0x3d3c4e=_0x408aad+'.forecast.current.temp';}}}if(_0x3d3c4e){const _0x1fb2f8=await _0x12e9b7[_0x225066(0x185)](_0x3d3c4e);if(_0x1fb2f8&&_0x1fb2f8[_0x225066(0x1ce)]!==undefined&&_0x1fb2f8[_0x225066(0x1ce)]!==null)return parseFloat(_0x1fb2f8[_0x225066(0x1ce)]);}}catch(_0x3f0ed1){}return null;}async function recordThermodynamics(_0x34f0f2,_0xe52a09,_0x461076,_0xd2d884){const _0x398177=a5_0x4483,_0x50e3cd=await getOutsideTemperatureNumeric(_0x34f0f2),_0x437ebe=await _0x34f0f2[_0x398177(0x1ca)]('LTM.trainingData.thermodynamics');let _0x1b7df9=[];if(_0x437ebe&&_0x437ebe[_0x398177(0x1ce)])try{_0x1b7df9=JSON['parse'](_0x437ebe[_0x398177(0x1ce)]);}catch(_0x4e236e){}_0x1b7df9['push']({'ts':Date[_0x398177(0x1a7)](),'room':_0xd2d884||'Unknown','t_in':_0x461076,'t_out':_0x50e3cd});if(_0x1b7df9[_0x398177(0x188)]>THERMO_LOG_SIZE)_0x1b7df9['shift']();await _0x34f0f2[_0x398177(0x1a3)](_0x398177(0x1bd),{'val':JSON['stringify'](_0x1b7df9),'ack':!![]});}async function saveCompletedSequence(_0x143110){const _0x234280=a5_0x4483;try{const _0x37878c=await _0x143110[_0x234280(0x1ca)]('LTM.trainingData.sequences');let _0x3ed759=[];if(_0x37878c&&_0x37878c[_0x234280(0x1ce)])try{_0x3ed759=JSON[_0x234280(0x193)](_0x37878c[_0x234280(0x1ce)]);}catch(_0x1894f2){}const _0x5e3d3b=activeSequence[0x0]['ts'],_0x9c39e7=activeSequence[_0x234280(0x1c6)](_0x2a57f1=>({'loc':_0x2a57f1['loc'],'t_delta':Math['round']((_0x2a57f1['ts']-_0x5e3d3b)/0x3e8)})),_0x2c7a14={'timestamp':new Date(_0x5e3d3b)[_0x234280(0x180)](),'steps':_0x9c39e7,'duration':Math[_0x234280(0x1a6)]((activeSequence[activeSequence[_0x234280(0x188)]-0x1]['ts']-_0x5e3d3b)/0x3e8),'daytime':new Date(_0x5e3d3b)[_0x234280(0x1a0)]()};_0x3ed759[_0x234280(0x194)](_0x2c7a14);if(_0x3ed759[_0x234280(0x188)]>MAX_TRAINING_SET_SIZE)_0x3ed759['shift']();await _0x143110[_0x234280(0x1a3)]('LTM.trainingData.sequences',{'val':JSON[_0x234280(0x197)](_0x3ed759),'ack':!![]}),_0x143110['isProVersion']&&_0x143110['sendToPythonWrapper']&&_0x143110[_0x234280(0x1a9)](_0x234280(0x1bb),{'sequence':_0x2c7a14});}catch(_0x541c6b){_0x143110[_0x234280(0x187)][_0x234280(0x19d)](_0x234280(0x1cc)+_0x541c6b[_0x234280(0x1b4)]);}}async function recordSequence(_0x520bef,_0xd1b726){const _0x26629c=a5_0x4483,_0x2b5224=(_0xd1b726[_0x26629c(0x19b)]||'')[_0x26629c(0x1bc)](),_0x1a795f=['motion',_0x26629c(0x1bf),_0x26629c(0x189),_0x26629c(0x1b2),_0x26629c(0x19c),_0x26629c(0x18b),_0x26629c(0x18f),_0x26629c(0x184),'fenster',_0x26629c(0x18e),'kontakt',_0x26629c(0x1d4),'licht',_0x26629c(0x1c1),_0x26629c(0x1b1),_0x26629c(0x1cb),'lampe'];if(!_0x1a795f[_0x26629c(0x1b3)](_0x4237dc=>_0x2b5224['includes'](_0x4237dc)))return;if(!_0xd1b726[_0x26629c(0x1d2)])return;if(sequenceTimer)clearTimeout(sequenceTimer);activeSequence['push']({'loc':_0xd1b726[_0x26629c(0x1ae)]||_0x26629c(0x192),'id':_0xd1b726['id'],'ts':Date[_0x26629c(0x1a7)]()}),sequenceTimer=setTimeout(async()=>{if(activeSequence['length']>0x1)await saveCompletedSequence(_0x520bef);activeSequence=[];},SEQUENCE_TIMEOUT_MS);}function startExitTimer(_0x335c4a){const _0x24666f=a5_0x4483;abortExitTimer(_0x335c4a),_0x335c4a['isGracePeriodActive']=!![],_0x335c4a[_0x24666f(0x19a)]=setTimeout(()=>{const _0x21ff05=_0x24666f;_0x335c4a[_0x21ff05(0x1a8)]=![];},EXIT_GRACE_PERIOD_SECONDS*0x3e8),_0x335c4a[_0x24666f(0x1c5)]=setTimeout(()=>{setPresence(_0x335c4a,![]),_0x335c4a['exitTimer']=null;},EXIT_TIMER_MINUTES*0x3c*0x3e8);}function abortExitTimer(_0x4d6c5d){const _0x4859e3=a5_0x4483;if(_0x4d6c5d[_0x4859e3(0x1c5)])clearTimeout(_0x4d6c5d[_0x4859e3(0x1c5)]);if(_0x4d6c5d[_0x4859e3(0x19a)])clearTimeout(_0x4d6c5d[_0x4859e3(0x19a)]);_0x4d6c5d['exitTimer']=null,_0x4d6c5d['exitGraceTimer']=null,_0x4d6c5d['isGracePeriodActive']=![];}function a5_0xfa64(){const _0x3611e2=['[RECORDER]\x20Error:\x20','outdoorSensorId','val','isExit','openweathermap','2lVhaNe','value','apply','light','eventHistory','toISOString','295028rIAWgS','.NextHours.Location_1.Day_1.current.temp_value','toString','window','getForeignStateAsync','name','log','length','präsenz','config','door','normal','unshift','contact','tür','useWeather','currentSystemMode','Unknown','parse','push','motion','(((.+)+)+)+$','stringify','7uGfnuG','isPresent','exitGraceTimer','type','occupancy','error','accuweather','temperature','getHours','search','.forecast.current.temperature','setStateAsync','2972860SOfRXb','18KkWBev','round','now','isGracePeriodActive','sendToPythonWrapper','547935twAvYY','logDuplicates','596528SdPueN','exports','location','437796wjRqPb','daswetter','schalter','presence','some','message','rawEventLog','1633390tYsPAR','heizung','.Current.Temperature','events.lastEvent','includes','ANALYZE_SEQUENCE','toLowerCase','LTM.trainingData.thermodynamics','weatherInstance','bewegung','isProVersion','switch','sensorLastValues','22880NDEWKH','SIMULATE_SIGNAL','exitTimer','map','events.history','weatherunderground','pop','getStateAsync','dimmer'];a5_0xfa64=function(){return _0x3611e2;};return a5_0xfa64();}async function setPresence(_0x21a9e5,_0x5b708a){const _0x38c0b1=a5_0x4483;if(_0x21a9e5[_0x38c0b1(0x199)]===_0x5b708a)return;_0x21a9e5[_0x38c0b1(0x199)]=_0x5b708a,await _0x21a9e5[_0x38c0b1(0x1a3)]('system.isPresent',{'val':_0x5b708a,'ack':!![]});}async function processSensorEvent(_0x34e396,_0x45b07d,_0x27c911,_0x1096b2){const _0x191194=a5_0x4483;if(!_0x1096b2)return null;const _0x57e8c1=_0x27c911[_0x191194(0x1ce)],_0x3db058=Date[_0x191194(0x1a7)](),_0x447d5a=_0x34e396[_0x191194(0x1c2)][_0x45b07d];_0x34e396[_0x191194(0x1c2)][_0x45b07d]=_0x57e8c1;if(!_0x1096b2[_0x191194(0x1ab)]&&_0x447d5a!=undefined&&_0x447d5a==_0x57e8c1)return null;const _0x5430a5=(_0x1096b2[_0x191194(0x19b)]||'')[_0x191194(0x1bc)](),_0x193507=_0x5430a5[_0x191194(0x1ba)](_0x191194(0x19f))||_0x5430a5[_0x191194(0x1ba)]('temperatur')||_0x5430a5['includes']('klima')||_0x5430a5[_0x191194(0x1ba)](_0x191194(0x1b7));_0x34e396[_0x191194(0x1c0)]&&_0x193507&&recordThermodynamics(_0x34e396,_0x45b07d,_0x57e8c1,_0x1096b2['location']);const _0x3f37c2={'timestamp':_0x3db058,'id':_0x45b07d,'name':_0x1096b2[_0x191194(0x186)],'type':_0x1096b2['type'],'location':_0x1096b2['location'],'value':_0x57e8c1};_0x34e396[_0x191194(0x1d5)][_0x191194(0x18d)](_0x3f37c2);if(_0x34e396['eventHistory']['length']>HISTORY_MAX_SIZE)_0x34e396[_0x191194(0x1d5)][_0x191194(0x1c9)]();await _0x34e396[_0x191194(0x1a3)](_0x191194(0x1b9),{'val':JSON['stringify'](_0x3f37c2),'ack':!![]}),await _0x34e396[_0x191194(0x1a3)](_0x191194(0x1c7),{'val':JSON[_0x191194(0x197)](_0x34e396['eventHistory']),'ack':!![]});if(_0x34e396['isProVersion']){_0x34e396[_0x191194(0x1b5)][_0x191194(0x194)](_0x3f37c2);if(_0x34e396[_0x191194(0x1b5)]['length']>RAW_LOG_MAX_SIZE)_0x34e396[_0x191194(0x1b5)]['splice'](0x0,_0x34e396[_0x191194(0x1b5)]['length']-RAW_LOG_MAX_SIZE);await _0x34e396[_0x191194(0x1a3)]('LTM.rawEventLog',{'val':JSON[_0x191194(0x197)](_0x34e396[_0x191194(0x1b5)]),'ack':!![]}),recordSequence(_0x34e396,_0x3f37c2);}if(_0x1096b2[_0x191194(0x1cf)]&&_0x57e8c1===!![]){if(_0x34e396[_0x191194(0x199)]&&!_0x34e396[_0x191194(0x1a8)])startExitTimer(_0x34e396);else{if(!_0x34e396[_0x191194(0x199)])setPresence(_0x34e396,!![]);}}else{if(_0x1096b2[_0x191194(0x19b)]===_0x191194(0x195)&&_0x57e8c1===!![]){if(_0x34e396['exitTimer'])abortExitTimer(_0x34e396);if(!_0x34e396[_0x191194(0x199)]&&_0x34e396[_0x191194(0x191)]===_0x191194(0x18c))setPresence(_0x34e396,!![]);}}return _0x34e396['isProVersion']&&_0x1096b2['type']===_0x191194(0x195)&&_0x57e8c1===!![]&&_0x1096b2[_0x191194(0x1ae)]&&_0x34e396['sendToPythonWrapper']&&_0x34e396['sendToPythonWrapper'](_0x191194(0x1c4),{'room':_0x1096b2[_0x191194(0x1ae)]}),_0x3f37c2;}module[a5_0x4bab4b(0x1ad)]={'processSensorEvent':processSensorEvent,'getOutsideTemperatureNumeric':getOutsideTemperatureNumeric,'setPresence':setPresence,'abortExitTimer':abortExitTimer,'startExitTimer':startExitTimer};