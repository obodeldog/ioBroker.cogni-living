const a5_0x35a439=a5_0x1aef;(function(_0x4cc9fa,_0x3aee42){const _0xce2c1a=a5_0x1aef,_0x1afb90=_0x4cc9fa();while(!![]){try{const _0x80ea5b=-parseInt(_0xce2c1a(0x1ae))/0x1+parseInt(_0xce2c1a(0x1bc))/0x2+-parseInt(_0xce2c1a(0x19f))/0x3*(parseInt(_0xce2c1a(0x1ad))/0x4)+parseInt(_0xce2c1a(0x183))/0x5+parseInt(_0xce2c1a(0x1ef))/0x6*(-parseInt(_0xce2c1a(0x1e5))/0x7)+-parseInt(_0xce2c1a(0x1c8))/0x8*(parseInt(_0xce2c1a(0x1d8))/0x9)+-parseInt(_0xce2c1a(0x1d3))/0xa*(-parseInt(_0xce2c1a(0x192))/0xb);if(_0x80ea5b===_0x3aee42)break;else _0x1afb90['push'](_0x1afb90['shift']());}catch(_0x471d39){_0x1afb90['push'](_0x1afb90['shift']());}}}(a5_0x34e1,0xd850d));const a5_0x3beb5e=(function(){let _0x109251=!![];return function(_0x591a84,_0x19e2d1){const _0x531958=_0x109251?function(){const _0xe4249d=a5_0x1aef;if(_0x19e2d1){const _0x46ebeb=_0x19e2d1[_0xe4249d(0x1c3)](_0x591a84,arguments);return _0x19e2d1=null,_0x46ebeb;}}:function(){};return _0x109251=![],_0x531958;};}()),a5_0x40b132=a5_0x3beb5e(this,function(){const _0x1e0521=a5_0x1aef;return a5_0x40b132[_0x1e0521(0x1a3)]()[_0x1e0521(0x1bd)](_0x1e0521(0x18e))[_0x1e0521(0x1a3)]()[_0x1e0521(0x197)](a5_0x40b132)['search'](_0x1e0521(0x18e));});a5_0x40b132();'use strict';const HISTORY_MAX_SIZE=0x32,RAW_LOG_MAX_SIZE=0x9c4,THERMO_LOG_SIZE=0x3e8,SEQUENCE_TIMEOUT_MS=0x5*0x3c*0x3e8,MAX_TRAINING_SET_SIZE=0x1f4,EXIT_TIMER_MINUTES=0xf,EXIT_GRACE_PERIOD_SECONDS=0x1e;let activeSequence=[],sequenceTimer=null;function a5_0x34e1(){const _0x3dd31d=['events.lastEvent','length','occupancy','.1.ACTUAL_TEMPERATURE','7231980thdQpZ','isProVersion','bewegung','griff','switch','light','error','stringify','level','replace','schalter','(((.+)+)+)+$','STATUS','exitGraceTimer','name','452881KlHwJY','Valve','STATE','motion','\x20from\x20','constructor','schloss','splice','val','location','contact','[RECORDER]\x20Error:\x20','from','3rEkmua','eventHistory','pop','SIMULATE_SIGNAL','toString','log','exitTimer','push','some','.ACTUAL_TEMPERATURE','isGracePeriodActive','parse','klima','fill','3600992IyESfe','1058556GtQcnd','.Current.Temperature','now','getDate','[RECORDER]\x20Ignored\x20implausible\x20temperature:\x20','weatherunderground','type','LEVEL','config','message','currentSystemMode','map','licht','shift','861792yzSnRJ','search','rawEventLog','sendToPythonWrapper','kontakt','system.isPresent','getForeignStateAsync','apply','lampe','.1.TEMPERATURE','.1.VALVE_STATE','isPresent','124648pOgwoQ','getStateAsync','Unknown','includes','round','accuweather','LTM.trainingData.thermodynamics','TRACK_EVENT','handle','toLowerCase','sensorLastValues','700wwQUxy','unshift','heizung','exports','outdoorSensorId','315ldiSRN','.NextHours.Location_1.Day_1.current.temp_value','useWeather','.1.LEVEL','LTM.rawEventLog','analysis.health.todayVector','toISOString','.4.VALVE_STATE','number','lastTrackerEventTime','fenster','logDuplicates','normal','14gYkBZU','pr채senz','.forecast.current.temperature','setStateAsync','value','.forecast.current.temp','temperature','window','daswetter','dimmer','4107282MkujpR','t체r','door','ANALYZE_SEQUENCE','events.history'];a5_0x34e1=function(){return _0x3dd31d;};return a5_0x34e1();}async function getOutsideTemperatureNumeric(_0x265e57){const _0x54f640=a5_0x1aef;if(_0x265e57[_0x54f640(0x1b6)][_0x54f640(0x1d7)])try{const _0x5a18f7=await _0x265e57[_0x54f640(0x1c2)](_0x265e57['config'][_0x54f640(0x1d7)]);if(_0x5a18f7&&_0x5a18f7[_0x54f640(0x19a)]!==undefined&&_0x5a18f7[_0x54f640(0x19a)]!==null)return parseFloat(_0x5a18f7['val']);}catch(_0x342f9a){}const _0x199a1d=_0x265e57[_0x54f640(0x1b6)]['weatherInstance'];if(!_0x265e57[_0x54f640(0x1b6)][_0x54f640(0x1da)]||!_0x199a1d)return null;try{let _0x1e39c2='';if(_0x199a1d[_0x54f640(0x1cb)](_0x54f640(0x1cd)))_0x1e39c2=_0x199a1d+_0x54f640(0x1af);else{if(_0x199a1d[_0x54f640(0x1cb)](_0x54f640(0x1ed)))_0x1e39c2=_0x199a1d+_0x54f640(0x1d9);else{if(_0x199a1d[_0x54f640(0x1cb)]('openweathermap'))_0x1e39c2=_0x199a1d+_0x54f640(0x1e7);else{if(_0x199a1d[_0x54f640(0x1cb)](_0x54f640(0x1b3)))_0x1e39c2=_0x199a1d+_0x54f640(0x1ea);}}}if(_0x1e39c2){const _0x30a613=await _0x265e57[_0x54f640(0x1c2)](_0x1e39c2);if(_0x30a613&&_0x30a613[_0x54f640(0x19a)]!==undefined&&_0x30a613[_0x54f640(0x19a)]!==null)return parseFloat(_0x30a613[_0x54f640(0x19a)]);}}catch(_0x48339d){}return null;}function a5_0x1aef(_0x482aac,_0x30029e){const _0xfd97ce=a5_0x34e1();return a5_0x1aef=function(_0x40b132,_0x3beb5e){_0x40b132=_0x40b132-0x183;let _0x34e116=_0xfd97ce[_0x40b132];return _0x34e116;},a5_0x1aef(_0x482aac,_0x30029e);}async function recordThermodynamics(_0x3c4c19,_0x11d04e,_0x4ce954,_0x2b87b6){const _0x4dab95=a5_0x1aef,_0x3ce69d=await getOutsideTemperatureNumeric(_0x3c4c19);if(_0x3ce69d===null)return;let _0x26d598=0x0,_0x57ad2f=![];if(_0x3c4c19[_0x4dab95(0x1b6)]['valveMapping'])try{let _0x28bec0=_0x3c4c19['config']['valveMapping'];if(typeof _0x28bec0==='string')_0x28bec0=JSON[_0x4dab95(0x1aa)](_0x28bec0);if(_0x28bec0[_0x11d04e]){const _0x2b0c0b=_0x28bec0[_0x11d04e],_0x203475=await _0x3c4c19[_0x4dab95(0x1c2)](_0x2b0c0b);if(_0x203475&&_0x203475[_0x4dab95(0x19a)]!==null&&_0x203475[_0x4dab95(0x19a)]!==undefined){let _0x45cfd7=Number(_0x203475['val']);if(_0x45cfd7<=1.05&&!_0x2b0c0b[_0x4dab95(0x1cb)](_0x4dab95(0x18f))&&!_0x2b0c0b[_0x4dab95(0x1cb)](_0x4dab95(0x194)))_0x45cfd7=_0x45cfd7*0x64;_0x26d598=Math[_0x4dab95(0x1cc)](_0x45cfd7),_0x57ad2f=!![];}}}catch(_0x37610d){}if(!_0x57ad2f){const _0x38f151=[{'from':_0x4dab95(0x1f7),'to':_0x4dab95(0x1db)},{'from':'.1.ACTUAL_TEMPERATURE','to':_0x4dab95(0x1c6)},{'from':_0x4dab95(0x1c5),'to':_0x4dab95(0x1df)},{'from':_0x4dab95(0x1a8),'to':'.LEVEL'},{'from':_0x4dab95(0x1eb),'to':_0x4dab95(0x18b)},{'from':'Temperature','to':_0x4dab95(0x193)}];for(const _0x2a4d18 of _0x38f151){if(_0x11d04e['includes'](_0x2a4d18[_0x4dab95(0x19e)])){const _0x3d56e4=_0x11d04e[_0x4dab95(0x18c)](_0x2a4d18['from'],_0x2a4d18['to']);try{const _0x3a5e1a=await _0x3c4c19[_0x4dab95(0x1c2)](_0x3d56e4);if(_0x3a5e1a&&_0x3a5e1a[_0x4dab95(0x19a)]!==null&&_0x3a5e1a[_0x4dab95(0x19a)]!==undefined){let _0x24cc6e=Number(_0x3a5e1a[_0x4dab95(0x19a)]);if(typeof _0x24cc6e===_0x4dab95(0x1e0)){if(_0x24cc6e<=1.05&&_0x2a4d18['to'][_0x4dab95(0x1cb)](_0x4dab95(0x1b5)))_0x24cc6e=_0x24cc6e*0x64;_0x26d598=Math['round'](_0x24cc6e),_0x57ad2f=!![];break;}}}catch(_0x5dbe38){}}}}const _0xa9682d=await _0x3c4c19[_0x4dab95(0x1c9)](_0x4dab95(0x1ce));let _0x4bf16d=[];if(_0xa9682d&&_0xa9682d[_0x4dab95(0x19a)])try{_0x4bf16d=JSON[_0x4dab95(0x1aa)](_0xa9682d[_0x4dab95(0x19a)]);}catch(_0x1daacb){}_0x4bf16d[_0x4dab95(0x1a6)]({'ts':Date[_0x4dab95(0x1b0)](),'room':_0x2b87b6||_0x4dab95(0x1ca),'t_in':_0x4ce954,'t_out':_0x3ce69d,'valve':_0x26d598});if(_0x4bf16d[_0x4dab95(0x1f5)]>THERMO_LOG_SIZE)_0x4bf16d[_0x4dab95(0x1bb)]();await _0x3c4c19[_0x4dab95(0x1e8)](_0x4dab95(0x1ce),{'val':JSON['stringify'](_0x4bf16d),'ack':!![]});}async function saveCompletedSequence(_0x1e8ad9){const _0xe62007=a5_0x1aef;try{const _0x1e0457=await _0x1e8ad9['getStateAsync']('LTM.trainingData.sequences');let _0x3b121d=[];if(_0x1e0457&&_0x1e0457[_0xe62007(0x19a)])try{_0x3b121d=JSON[_0xe62007(0x1aa)](_0x1e0457[_0xe62007(0x19a)]);}catch(_0x5da4ab){}const _0x2d7e55=activeSequence[0x0]['ts'],_0x2b6449=activeSequence[_0xe62007(0x1b9)](_0x54a63b=>({'loc':_0x54a63b['loc'],'t_delta':Math['round']((_0x54a63b['ts']-_0x2d7e55)/0x3e8)})),_0x2b4414={'timestamp':new Date(_0x2d7e55)[_0xe62007(0x1de)](),'steps':_0x2b6449,'duration':Math[_0xe62007(0x1cc)]((activeSequence[activeSequence[_0xe62007(0x1f5)]-0x1]['ts']-_0x2d7e55)/0x3e8),'daytime':new Date(_0x2d7e55)['getHours']()};_0x3b121d['push'](_0x2b4414);if(_0x3b121d[_0xe62007(0x1f5)]>MAX_TRAINING_SET_SIZE)_0x3b121d[_0xe62007(0x1bb)]();await _0x1e8ad9[_0xe62007(0x1e8)]('LTM.trainingData.sequences',{'val':JSON[_0xe62007(0x18a)](_0x3b121d),'ack':!![]}),_0x1e8ad9[_0xe62007(0x184)]&&_0x1e8ad9[_0xe62007(0x1bf)]&&_0x1e8ad9[_0xe62007(0x1bf)](_0xe62007(0x1f2),{'sequence':_0x2b4414});}catch(_0x1f01fd){_0x1e8ad9[_0xe62007(0x1a4)][_0xe62007(0x189)](_0xe62007(0x19d)+_0x1f01fd[_0xe62007(0x1b7)]);}}async function recordSequence(_0x32f19a,_0x2a40ea){const _0x4d4462=a5_0x1aef,_0x430cc5=(_0x2a40ea['type']||'')[_0x4d4462(0x1d1)](),_0x576e39=[_0x4d4462(0x195),_0x4d4462(0x185),_0x4d4462(0x1e6),'presence',_0x4d4462(0x1f6),_0x4d4462(0x1f1),_0x4d4462(0x1f0),_0x4d4462(0x1ec),_0x4d4462(0x1e2),_0x4d4462(0x19c),_0x4d4462(0x1c0),_0x4d4462(0x188),_0x4d4462(0x1ba),_0x4d4462(0x187),_0x4d4462(0x18d),_0x4d4462(0x1ee),_0x4d4462(0x1c4)];if(!_0x576e39['some'](_0x457c37=>_0x430cc5[_0x4d4462(0x1cb)](_0x457c37)))return;if(!_0x2a40ea[_0x4d4462(0x1e9)])return;if(sequenceTimer)clearTimeout(sequenceTimer);activeSequence[_0x4d4462(0x1a6)]({'loc':_0x2a40ea['location']||_0x4d4462(0x1ca),'id':_0x2a40ea['id'],'ts':Date[_0x4d4462(0x1b0)]()}),sequenceTimer=setTimeout(async()=>{const _0x3c7340=_0x4d4462;if(activeSequence[_0x3c7340(0x1f5)]>0x1)await saveCompletedSequence(_0x32f19a);activeSequence=[];},SEQUENCE_TIMEOUT_MS);}function startExitTimer(_0xdb3ebf){const _0x5ec685=a5_0x1aef;abortExitTimer(_0xdb3ebf),_0xdb3ebf['isGracePeriodActive']=!![],_0xdb3ebf['exitGraceTimer']=setTimeout(()=>{const _0x2e0081=a5_0x1aef;_0xdb3ebf[_0x2e0081(0x1a9)]=![];},EXIT_GRACE_PERIOD_SECONDS*0x3e8),_0xdb3ebf[_0x5ec685(0x1a5)]=setTimeout(()=>{setPresence(_0xdb3ebf,![]),_0xdb3ebf['exitTimer']=null;},EXIT_TIMER_MINUTES*0x3c*0x3e8);}function abortExitTimer(_0x3b29dd){const _0x52c0c2=a5_0x1aef;if(_0x3b29dd[_0x52c0c2(0x1a5)])clearTimeout(_0x3b29dd['exitTimer']);if(_0x3b29dd[_0x52c0c2(0x190)])clearTimeout(_0x3b29dd[_0x52c0c2(0x190)]);_0x3b29dd[_0x52c0c2(0x1a5)]=null,_0x3b29dd[_0x52c0c2(0x190)]=null,_0x3b29dd['isGracePeriodActive']=![];}async function setPresence(_0x5c66f1,_0x57d24f){const _0x27b330=a5_0x1aef;if(_0x5c66f1[_0x27b330(0x1c7)]===_0x57d24f)return;_0x5c66f1[_0x27b330(0x1c7)]=_0x57d24f,await _0x5c66f1['setStateAsync'](_0x27b330(0x1c1),{'val':_0x57d24f,'ack':!![]});}async function updateHourlyActivity(_0x232c89){const _0x1d602b=a5_0x1aef;let _0x322aa6=new Array(0x18)[_0x1d602b(0x1ac)](0x0),_0x180cf3=0x0;try{const _0x3ea97c=await _0x232c89[_0x1d602b(0x1c9)](_0x1d602b(0x1dd));_0x3ea97c&&_0x3ea97c[_0x1d602b(0x19a)]&&(_0x322aa6=JSON[_0x1d602b(0x1aa)](_0x3ea97c[_0x1d602b(0x19a)]),_0x180cf3=_0x3ea97c['ts']);}catch(_0x583ec1){}const _0x2910fb=new Date(_0x180cf3),_0x5498a6=new Date();_0x2910fb[_0x1d602b(0x1b1)]()!==_0x5498a6[_0x1d602b(0x1b1)]()&&(_0x322aa6=new Array(0x18)[_0x1d602b(0x1ac)](0x0));const _0x4bb4bc=_0x5498a6['getHours']();if(_0x322aa6[_0x4bb4bc]===undefined)_0x322aa6[_0x4bb4bc]=0x0;_0x322aa6[_0x4bb4bc]++,await _0x232c89[_0x1d602b(0x1e8)]('analysis.health.todayVector',{'val':JSON['stringify'](_0x322aa6),'ack':!![]});}async function processSensorEvent(_0x1f5768,_0x4cc4ac,_0x2b954d,_0x2df40a){const _0x5006a9=a5_0x1aef;if(!_0x2df40a)return null;const _0x472f9d=_0x2b954d[_0x5006a9(0x19a)],_0x72eddb=Date[_0x5006a9(0x1b0)](),_0x42c90a=_0x1f5768['sensorLastValues'][_0x4cc4ac],_0x29633a=(_0x2df40a[_0x5006a9(0x1b4)]||'')['toLowerCase'](),_0x32fd36=_0x29633a[_0x5006a9(0x1cb)](_0x5006a9(0x1eb))||_0x29633a[_0x5006a9(0x1cb)]('temperatur')||_0x29633a[_0x5006a9(0x1cb)](_0x5006a9(0x1ab))||_0x29633a[_0x5006a9(0x1cb)](_0x5006a9(0x1d5))||_0x29633a['includes']('thermostat');if(_0x32fd36&&typeof _0x472f9d===_0x5006a9(0x1e0)){if(_0x472f9d>0x50||_0x472f9d<-0x32)return _0x1f5768['log']['debug'](_0x5006a9(0x1b2)+_0x472f9d+_0x5006a9(0x196)+_0x4cc4ac),null;}_0x1f5768[_0x5006a9(0x1d2)][_0x4cc4ac]=_0x472f9d;if(!_0x2df40a[_0x5006a9(0x1e3)]&&_0x42c90a!=undefined&&_0x42c90a==_0x472f9d)return null;_0x1f5768[_0x5006a9(0x184)]&&_0x32fd36&&recordThermodynamics(_0x1f5768,_0x4cc4ac,_0x472f9d,_0x2df40a[_0x5006a9(0x19b)]);const _0x58812f={'timestamp':_0x72eddb,'id':_0x4cc4ac,'name':_0x2df40a[_0x5006a9(0x191)],'type':_0x2df40a['type'],'location':_0x2df40a[_0x5006a9(0x19b)],'value':_0x472f9d};_0x1f5768['eventHistory'][_0x5006a9(0x1d4)](_0x58812f);if(_0x1f5768[_0x5006a9(0x1a0)][_0x5006a9(0x1f5)]>HISTORY_MAX_SIZE)_0x1f5768[_0x5006a9(0x1a0)][_0x5006a9(0x1a1)]();await _0x1f5768['setStateAsync'](_0x5006a9(0x1f4),{'val':JSON['stringify'](_0x58812f),'ack':!![]}),await _0x1f5768[_0x5006a9(0x1e8)](_0x5006a9(0x1f3),{'val':JSON[_0x5006a9(0x18a)](_0x1f5768[_0x5006a9(0x1a0)]),'ack':!![]}),await updateHourlyActivity(_0x1f5768);if(_0x1f5768['isProVersion']){_0x1f5768['rawEventLog'][_0x5006a9(0x1a6)](_0x58812f);if(_0x1f5768[_0x5006a9(0x1be)]['length']>RAW_LOG_MAX_SIZE)_0x1f5768[_0x5006a9(0x1be)][_0x5006a9(0x199)](0x0,_0x1f5768['rawEventLog'][_0x5006a9(0x1f5)]-RAW_LOG_MAX_SIZE);await _0x1f5768[_0x5006a9(0x1e8)](_0x5006a9(0x1dc),{'val':JSON['stringify'](_0x1f5768[_0x5006a9(0x1be)]),'ack':!![]}),recordSequence(_0x1f5768,_0x58812f);}if(_0x2df40a['isExit']&&_0x472f9d===!![]){if(_0x1f5768['isPresent']&&!_0x1f5768['isGracePeriodActive'])startExitTimer(_0x1f5768);else{if(!_0x1f5768[_0x5006a9(0x1c7)])setPresence(_0x1f5768,!![]);}}else{if(_0x2df40a[_0x5006a9(0x1b4)]===_0x5006a9(0x195)&&_0x472f9d===!![]){if(_0x1f5768['exitTimer'])abortExitTimer(_0x1f5768);if(!_0x1f5768['isPresent']&&_0x1f5768[_0x5006a9(0x1b8)]===_0x5006a9(0x1e4))setPresence(_0x1f5768,!![]);}}if(_0x1f5768[_0x5006a9(0x184)]&&_0x1f5768[_0x5006a9(0x1bf)]){_0x2df40a[_0x5006a9(0x1b4)]===_0x5006a9(0x195)&&_0x472f9d===!![]&&_0x2df40a['location']&&_0x1f5768[_0x5006a9(0x1bf)](_0x5006a9(0x1a2),{'room':_0x2df40a[_0x5006a9(0x19b)]});const _0x2965f3=[_0x5006a9(0x1f1),'t체r',_0x5006a9(0x1ec),_0x5006a9(0x1e2),_0x5006a9(0x186),_0x5006a9(0x1d0),'lock',_0x5006a9(0x198)][_0x5006a9(0x1a7)](_0x550727=>_0x29633a['includes'](_0x550727)),_0x351375=[_0x5006a9(0x188),_0x5006a9(0x1ba),_0x5006a9(0x187),_0x5006a9(0x18d),_0x5006a9(0x1ee),_0x5006a9(0x1c4)][_0x5006a9(0x1a7)](_0x3c27c=>_0x29633a[_0x5006a9(0x1cb)](_0x3c27c)),_0x597293=[_0x5006a9(0x195),_0x5006a9(0x185),'pr채senz','presence',_0x5006a9(0x1f6)][_0x5006a9(0x1a7)](_0x50e174=>_0x29633a[_0x5006a9(0x1cb)](_0x50e174));if(_0x2df40a[_0x5006a9(0x19b)]&&(_0x2965f3||_0x351375||_0x597293)){const _0x8ab77=_0x472f9d===!![]||typeof _0x472f9d===_0x5006a9(0x1e0)&&_0x472f9d>0x0,_0x599f75=_0x2965f3&&!_0x8ab77&&_0x42c90a!==undefined&&_0x42c90a!=_0x472f9d;if(_0x8ab77||_0x599f75){const _0x584a30=_0x1f5768[_0x5006a9(0x1e1)]||_0x72eddb,_0x486d0a=(_0x72eddb-_0x584a30)/0x3e8;_0x1f5768['lastTrackerEventTime']=_0x72eddb,_0x1f5768[_0x5006a9(0x1bf)](_0x5006a9(0x1cf),{'room':_0x2df40a[_0x5006a9(0x19b)],'dt':_0x486d0a});}}}return _0x58812f;}module[a5_0x35a439(0x1d6)]={'processSensorEvent':processSensorEvent,'getOutsideTemperatureNumeric':getOutsideTemperatureNumeric,'setPresence':setPresence,'abortExitTimer':abortExitTimer,'startExitTimer':startExitTimer};