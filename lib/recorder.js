const a5_0x3e4356=a5_0x5ea4;(function(_0x72a19a,_0x2cfc69){const _0x3e38c0=a5_0x5ea4,_0x5de621=_0x72a19a();while(!![]){try{const _0x315518=parseInt(_0x3e38c0(0xdd))/0x1+-parseInt(_0x3e38c0(0x108))/0x2+parseInt(_0x3e38c0(0xe6))/0x3+-parseInt(_0x3e38c0(0xbd))/0x4+-parseInt(_0x3e38c0(0xb9))/0x5*(parseInt(_0x3e38c0(0x10c))/0x6)+-parseInt(_0x3e38c0(0xcc))/0x7+parseInt(_0x3e38c0(0xf2))/0x8;if(_0x315518===_0x2cfc69)break;else _0x5de621['push'](_0x5de621['shift']());}catch(_0x1b0441){_0x5de621['push'](_0x5de621['shift']());}}}(a5_0x5b15,0x2edff));const a5_0x5b122a=(function(){let _0x5853b5=!![];return function(_0x1cc935,_0x4e1efb){const _0x38e046=_0x5853b5?function(){const _0x2254c5=a5_0x5ea4;if(_0x4e1efb){const _0x5bae2b=_0x4e1efb[_0x2254c5(0xbb)](_0x1cc935,arguments);return _0x4e1efb=null,_0x5bae2b;}}:function(){};return _0x5853b5=![],_0x38e046;};}()),a5_0x22a35a=a5_0x5b122a(this,function(){const _0x2b0f0e=a5_0x5ea4;return a5_0x22a35a[_0x2b0f0e(0xc7)]()['search'](_0x2b0f0e(0xdc))['toString']()[_0x2b0f0e(0x116)](a5_0x22a35a)['search'](_0x2b0f0e(0xdc));});a5_0x22a35a();'use strict';const HISTORY_MAX_SIZE=0x32,RAW_LOG_MAX_SIZE=0x9c4,THERMO_LOG_SIZE=0x3e8,SEQUENCE_TIMEOUT_MS=0x5*0x3c*0x3e8,MAX_TRAINING_SET_SIZE=0x1f4,EXIT_TIMER_MINUTES=0xf,EXIT_GRACE_PERIOD_SECONDS=0x1e;let activeSequence=[],sequenceTimer=null;async function getOutsideTemperatureNumeric(_0x230267){const _0x27c627=a5_0x5ea4;if(_0x230267[_0x27c627(0xbc)][_0x27c627(0x11c)])try{const _0x99bc65=await _0x230267[_0x27c627(0xfe)](_0x230267['config'][_0x27c627(0x11c)]);if(_0x99bc65&&_0x99bc65[_0x27c627(0x103)]!==undefined&&_0x99bc65[_0x27c627(0x103)]!==null)return parseFloat(_0x99bc65[_0x27c627(0x103)]);}catch(_0x108d52){}const _0x2dedf5=_0x230267[_0x27c627(0xbc)][_0x27c627(0xcf)];if(!_0x230267['config'][_0x27c627(0x101)]||!_0x2dedf5)return null;try{let _0x5a378e='';if(_0x2dedf5[_0x27c627(0x10e)](_0x27c627(0xec)))_0x5a378e=_0x2dedf5+_0x27c627(0x115);else{if(_0x2dedf5[_0x27c627(0x10e)](_0x27c627(0xe0)))_0x5a378e=_0x2dedf5+_0x27c627(0xf8);else{if(_0x2dedf5[_0x27c627(0x10e)](_0x27c627(0xd9)))_0x5a378e=_0x2dedf5+_0x27c627(0xb5);else{if(_0x2dedf5[_0x27c627(0x10e)](_0x27c627(0x106)))_0x5a378e=_0x2dedf5+'.forecast.current.temp';}}}if(_0x5a378e){const _0x5644a2=await _0x230267[_0x27c627(0xfe)](_0x5a378e);if(_0x5644a2&&_0x5644a2[_0x27c627(0x103)]!==undefined&&_0x5644a2['val']!==null)return parseFloat(_0x5644a2['val']);}}catch(_0x34c316){}return null;}async function recordThermodynamics(_0x267ca4,_0x4762e0,_0x4a4781,_0x408b14){const _0x197b53=a5_0x5ea4,_0xb3a339=await getOutsideTemperatureNumeric(_0x267ca4);if(_0xb3a339===null)return;let _0x44d55b=0x0,_0x2fc318=![];if(_0x267ca4[_0x197b53(0xbc)]['valveMapping'])try{let _0x23214b=_0x267ca4[_0x197b53(0xbc)][_0x197b53(0x102)];if(typeof _0x23214b==='string')_0x23214b=JSON[_0x197b53(0xf5)](_0x23214b);if(_0x23214b[_0x4762e0]){const _0x2741ba=_0x23214b[_0x4762e0],_0x2bbcda=await _0x267ca4[_0x197b53(0xfe)](_0x2741ba);if(_0x2bbcda&&_0x2bbcda[_0x197b53(0x103)]!==null&&_0x2bbcda[_0x197b53(0x103)]!==undefined){let _0x294b96=Number(_0x2bbcda[_0x197b53(0x103)]);if(_0x294b96<=1.05&&!_0x2741ba[_0x197b53(0x10e)](_0x197b53(0xc1))&&!_0x2741ba['includes'](_0x197b53(0xe8)))_0x294b96=_0x294b96*0x64;_0x44d55b=Math['round'](_0x294b96),_0x2fc318=!![];}}}catch(_0x1d8b26){}if(!_0x2fc318){const _0x3e35ac=[{'from':_0x197b53(0xda),'to':_0x197b53(0x10f)},{'from':_0x197b53(0xda),'to':_0x197b53(0xe4)},{'from':_0x197b53(0xb7),'to':'.4.VALVE_STATE'},{'from':_0x197b53(0xc5),'to':'.LEVEL'},{'from':_0x197b53(0xe7),'to':_0x197b53(0xb8)},{'from':_0x197b53(0xf1),'to':_0x197b53(0xc6)}];for(const _0xa1b3f0 of _0x3e35ac){if(_0x4762e0[_0x197b53(0x10e)](_0xa1b3f0[_0x197b53(0xf0)])){const _0x10c5c9=_0x4762e0[_0x197b53(0xf3)](_0xa1b3f0[_0x197b53(0xf0)],_0xa1b3f0['to']);try{const _0x23531b=await _0x267ca4[_0x197b53(0xfe)](_0x10c5c9);if(_0x23531b&&_0x23531b[_0x197b53(0x103)]!==null&&_0x23531b[_0x197b53(0x103)]!==undefined){let _0x5303ad=Number(_0x23531b[_0x197b53(0x103)]);if(typeof _0x5303ad===_0x197b53(0xdb)){if(_0x5303ad<=1.05&&_0xa1b3f0['to']['includes']('LEVEL'))_0x5303ad=_0x5303ad*0x64;_0x44d55b=Math[_0x197b53(0xeb)](_0x5303ad),_0x2fc318=!![];break;}}}catch(_0x5c230){}}}}const _0x82108a=await _0x267ca4[_0x197b53(0x100)](_0x197b53(0x117));let _0x53b0c3=[];if(_0x82108a&&_0x82108a[_0x197b53(0x103)])try{_0x53b0c3=JSON['parse'](_0x82108a[_0x197b53(0x103)]);}catch(_0x1e711e){}_0x53b0c3['push']({'ts':Date['now'](),'room':_0x408b14||_0x197b53(0xbf),'t_in':_0x4a4781,'t_out':_0xb3a339,'valve':_0x44d55b});if(_0x53b0c3[_0x197b53(0xb4)]>THERMO_LOG_SIZE)_0x53b0c3[_0x197b53(0xde)]();await _0x267ca4[_0x197b53(0xd2)](_0x197b53(0x117),{'val':JSON[_0x197b53(0xf9)](_0x53b0c3),'ack':!![]});}async function saveCompletedSequence(_0x45e4d7){const _0xb9fef2=a5_0x5ea4;try{const _0x1ff2f5=await _0x45e4d7['getStateAsync'](_0xb9fef2(0xe1));let _0x3fa09d=[];if(_0x1ff2f5&&_0x1ff2f5[_0xb9fef2(0x103)])try{_0x3fa09d=JSON['parse'](_0x1ff2f5[_0xb9fef2(0x103)]);}catch(_0x5e9c25){}const _0x4b0812=activeSequence[0x0]['ts'],_0x12ef91=activeSequence[_0xb9fef2(0xd4)](_0x20228e=>({'loc':_0x20228e[_0xb9fef2(0xb3)],'t_delta':Math['round']((_0x20228e['ts']-_0x4b0812)/0x3e8)})),_0x36d183={'timestamp':new Date(_0x4b0812)[_0xb9fef2(0x113)](),'steps':_0x12ef91,'duration':Math['round']((activeSequence[activeSequence['length']-0x1]['ts']-_0x4b0812)/0x3e8),'daytime':new Date(_0x4b0812)[_0xb9fef2(0x105)]()};_0x3fa09d[_0xb9fef2(0x111)](_0x36d183);if(_0x3fa09d[_0xb9fef2(0xb4)]>MAX_TRAINING_SET_SIZE)_0x3fa09d['shift']();await _0x45e4d7[_0xb9fef2(0xd2)]('LTM.trainingData.sequences',{'val':JSON[_0xb9fef2(0xf9)](_0x3fa09d),'ack':!![]}),_0x45e4d7['isProVersion']&&_0x45e4d7[_0xb9fef2(0xfb)]&&_0x45e4d7[_0xb9fef2(0xfb)](_0xb9fef2(0x107),{'sequence':_0x36d183});}catch(_0x4eb3d8){_0x45e4d7[_0xb9fef2(0x109)][_0xb9fef2(0xff)](_0xb9fef2(0x104)+_0x4eb3d8[_0xb9fef2(0xf7)]);}}async function recordSequence(_0x48f627,_0x1b3c7f){const _0x1ec1a5=a5_0x5ea4,_0x570304=(_0x1b3c7f[_0x1ec1a5(0xea)]||'')['toLowerCase'](),_0x20b0ba=[_0x1ec1a5(0xd0),_0x1ec1a5(0xed),_0x1ec1a5(0x10a),'presence','occupancy','door',_0x1ec1a5(0xe3),_0x1ec1a5(0x114),_0x1ec1a5(0xce),'contact',_0x1ec1a5(0xcb),'light','licht','switch',_0x1ec1a5(0xba),_0x1ec1a5(0xc2),_0x1ec1a5(0xd3)];if(!_0x20b0ba['some'](_0x25e5ed=>_0x570304[_0x1ec1a5(0x10e)](_0x25e5ed)))return;if(!_0x1b3c7f[_0x1ec1a5(0x11a)])return;if(sequenceTimer)clearTimeout(sequenceTimer);activeSequence['push']({'loc':_0x1b3c7f['location']||_0x1ec1a5(0xbf),'id':_0x1b3c7f['id'],'ts':Date[_0x1ec1a5(0xd5)]()}),sequenceTimer=setTimeout(async()=>{if(activeSequence['length']>0x1)await saveCompletedSequence(_0x48f627);activeSequence=[];},SEQUENCE_TIMEOUT_MS);}function a5_0x5b15(){const _0x36ec3f=['parse','occupancy','message','.NextHours.Location_1.Day_1.current.temp_value','stringify','heizung','sendToPythonWrapper','lastTrackerEventTime','door','getForeignStateAsync','error','getStateAsync','useWeather','valveMapping','val','[RECORDER]\x20Error:\x20','getHours','weatherunderground','ANALYZE_SEQUENCE','605508QejKSp','log','präsenz','lock','226416AdXCkk','TRACK_EVENT','includes','.1.LEVEL','isProVersion','push','some','toISOString','window','.Current.Temperature','constructor','LTM.trainingData.thermodynamics','eventHistory','switch','value','exitGraceTimer','outdoorSensorId','LTM.rawEventLog','sensorLastValues','loc','length','.forecast.current.temperature','light','.1.TEMPERATURE','level','40fXcjvc','schalter','apply','config','494140wcsMWo','events.history','Unknown','location','STATUS','dimmer','schloss','exports','.ACTUAL_TEMPERATURE','Valve','toString','isExit','handle','toLowerCase','kontakt','2007138PGbvWN','debug','fenster','weatherInstance','motion','griff','setStateAsync','lampe','map','now','splice','exitTimer','thermostat','openweathermap','.1.ACTUAL_TEMPERATURE','number','(((.+)+)+)+$','262309wUnvRs','shift','isPresent','daswetter','LTM.trainingData.sequences','pop','tür','.1.VALVE_STATE','licht','756576dGPkWQ','temperature','STATE','events.lastEvent','type','round','accuweather','bewegung','rawEventLog','logDuplicates','from','Temperature','5539272JJCwXw','replace','presence'];a5_0x5b15=function(){return _0x36ec3f;};return a5_0x5b15();}function a5_0x5ea4(_0x4af16b,_0x18d1c0){const _0x516257=a5_0x5b15();return a5_0x5ea4=function(_0x22a35a,_0x5b122a){_0x22a35a=_0x22a35a-0xb1;let _0x5b1537=_0x516257[_0x22a35a];return _0x5b1537;},a5_0x5ea4(_0x4af16b,_0x18d1c0);}function startExitTimer(_0x106228){const _0x43d39f=a5_0x5ea4;abortExitTimer(_0x106228),_0x106228['isGracePeriodActive']=!![],_0x106228['exitGraceTimer']=setTimeout(()=>{_0x106228['isGracePeriodActive']=![];},EXIT_GRACE_PERIOD_SECONDS*0x3e8),_0x106228[_0x43d39f(0xd7)]=setTimeout(()=>{const _0x24a5eb=_0x43d39f;setPresence(_0x106228,![]),_0x106228[_0x24a5eb(0xd7)]=null;},EXIT_TIMER_MINUTES*0x3c*0x3e8);}function abortExitTimer(_0x3536e2){const _0x2659ac=a5_0x5ea4;if(_0x3536e2[_0x2659ac(0xd7)])clearTimeout(_0x3536e2[_0x2659ac(0xd7)]);if(_0x3536e2[_0x2659ac(0x11b)])clearTimeout(_0x3536e2[_0x2659ac(0x11b)]);_0x3536e2[_0x2659ac(0xd7)]=null,_0x3536e2[_0x2659ac(0x11b)]=null,_0x3536e2['isGracePeriodActive']=![];}async function setPresence(_0x286358,_0x56fa45){const _0x41395f=a5_0x5ea4;if(_0x286358[_0x41395f(0xdf)]===_0x56fa45)return;_0x286358['isPresent']=_0x56fa45,await _0x286358[_0x41395f(0xd2)]('system.isPresent',{'val':_0x56fa45,'ack':!![]});}async function processSensorEvent(_0x11811c,_0x4d4e1c,_0x27ed3d,_0x12fb4c){const _0x36dd4e=a5_0x5ea4;if(!_0x12fb4c)return null;const _0x402f6f=_0x27ed3d[_0x36dd4e(0x103)],_0x511c00=Date['now'](),_0x1c7377=_0x11811c['sensorLastValues'][_0x4d4e1c],_0x56b33c=(_0x12fb4c['type']||'')[_0x36dd4e(0xca)](),_0x3d35aa=_0x56b33c['includes'](_0x36dd4e(0xe7))||_0x56b33c[_0x36dd4e(0x10e)]('temperatur')||_0x56b33c[_0x36dd4e(0x10e)]('klima')||_0x56b33c[_0x36dd4e(0x10e)](_0x36dd4e(0xfa))||_0x56b33c[_0x36dd4e(0x10e)](_0x36dd4e(0xd8));if(_0x3d35aa&&typeof _0x402f6f===_0x36dd4e(0xdb)){if(_0x402f6f>0x50||_0x402f6f<-0x32)return _0x11811c[_0x36dd4e(0x109)][_0x36dd4e(0xcd)]('[RECORDER]\x20Ignored\x20implausible\x20temperature:\x20'+_0x402f6f+'\x20from\x20'+_0x4d4e1c),null;}_0x11811c[_0x36dd4e(0xb2)][_0x4d4e1c]=_0x402f6f;if(!_0x12fb4c[_0x36dd4e(0xef)]&&_0x1c7377!=undefined&&_0x1c7377==_0x402f6f)return null;_0x11811c['isProVersion']&&_0x3d35aa&&recordThermodynamics(_0x11811c,_0x4d4e1c,_0x402f6f,_0x12fb4c['location']);const _0x5c75e4={'timestamp':_0x511c00,'id':_0x4d4e1c,'name':_0x12fb4c['name'],'type':_0x12fb4c[_0x36dd4e(0xea)],'location':_0x12fb4c[_0x36dd4e(0xc0)],'value':_0x402f6f};_0x11811c['eventHistory']['unshift'](_0x5c75e4);if(_0x11811c[_0x36dd4e(0x118)][_0x36dd4e(0xb4)]>HISTORY_MAX_SIZE)_0x11811c[_0x36dd4e(0x118)][_0x36dd4e(0xe2)]();await _0x11811c[_0x36dd4e(0xd2)](_0x36dd4e(0xe9),{'val':JSON[_0x36dd4e(0xf9)](_0x5c75e4),'ack':!![]}),await _0x11811c[_0x36dd4e(0xd2)](_0x36dd4e(0xbe),{'val':JSON[_0x36dd4e(0xf9)](_0x11811c[_0x36dd4e(0x118)]),'ack':!![]});if(_0x11811c[_0x36dd4e(0x110)]){_0x11811c[_0x36dd4e(0xee)][_0x36dd4e(0x111)](_0x5c75e4);if(_0x11811c[_0x36dd4e(0xee)]['length']>RAW_LOG_MAX_SIZE)_0x11811c[_0x36dd4e(0xee)][_0x36dd4e(0xd6)](0x0,_0x11811c[_0x36dd4e(0xee)][_0x36dd4e(0xb4)]-RAW_LOG_MAX_SIZE);await _0x11811c[_0x36dd4e(0xd2)](_0x36dd4e(0xb1),{'val':JSON['stringify'](_0x11811c[_0x36dd4e(0xee)]),'ack':!![]}),recordSequence(_0x11811c,_0x5c75e4);}if(_0x12fb4c[_0x36dd4e(0xc8)]&&_0x402f6f===!![]){if(_0x11811c[_0x36dd4e(0xdf)]&&!_0x11811c['isGracePeriodActive'])startExitTimer(_0x11811c);else{if(!_0x11811c[_0x36dd4e(0xdf)])setPresence(_0x11811c,!![]);}}else{if(_0x12fb4c[_0x36dd4e(0xea)]===_0x36dd4e(0xd0)&&_0x402f6f===!![]){if(_0x11811c[_0x36dd4e(0xd7)])abortExitTimer(_0x11811c);if(!_0x11811c[_0x36dd4e(0xdf)]&&_0x11811c['currentSystemMode']==='normal')setPresence(_0x11811c,!![]);}}if(_0x11811c[_0x36dd4e(0x110)]&&_0x11811c['sendToPythonWrapper']){_0x12fb4c[_0x36dd4e(0xea)]===_0x36dd4e(0xd0)&&_0x402f6f===!![]&&_0x12fb4c[_0x36dd4e(0xc0)]&&_0x11811c[_0x36dd4e(0xfb)]('SIMULATE_SIGNAL',{'room':_0x12fb4c[_0x36dd4e(0xc0)]});const _0x5e54c7=[_0x36dd4e(0xfd),_0x36dd4e(0xe3),'window',_0x36dd4e(0xce),_0x36dd4e(0xd1),_0x36dd4e(0xc9),_0x36dd4e(0x10b),_0x36dd4e(0xc3)][_0x36dd4e(0x112)](_0x4dbeff=>_0x56b33c[_0x36dd4e(0x10e)](_0x4dbeff)),_0x163788=[_0x36dd4e(0xb6),_0x36dd4e(0xe5),_0x36dd4e(0x119),_0x36dd4e(0xba),_0x36dd4e(0xc2),_0x36dd4e(0xd3)][_0x36dd4e(0x112)](_0x1ce1c2=>_0x56b33c[_0x36dd4e(0x10e)](_0x1ce1c2)),_0x17e8ac=[_0x36dd4e(0xd0),_0x36dd4e(0xed),_0x36dd4e(0x10a),_0x36dd4e(0xf4),_0x36dd4e(0xf6)][_0x36dd4e(0x112)](_0x41b9be=>_0x56b33c[_0x36dd4e(0x10e)](_0x41b9be));if(_0x12fb4c[_0x36dd4e(0xc0)]&&(_0x5e54c7||_0x163788||_0x17e8ac)){const _0x30eddc=_0x402f6f===!![]||typeof _0x402f6f===_0x36dd4e(0xdb)&&_0x402f6f>0x0,_0x1d11e1=_0x5e54c7&&!_0x30eddc&&_0x1c7377!==undefined&&_0x1c7377!=_0x402f6f;if(_0x30eddc||_0x1d11e1){const _0x44caa2=_0x11811c['lastTrackerEventTime']||_0x511c00,_0x574908=(_0x511c00-_0x44caa2)/0x3e8;_0x11811c[_0x36dd4e(0xfc)]=_0x511c00,_0x11811c[_0x36dd4e(0xfb)](_0x36dd4e(0x10d),{'room':_0x12fb4c['location'],'dt':_0x574908});}}}return _0x5c75e4;}module[a5_0x3e4356(0xc4)]={'processSensorEvent':processSensorEvent,'getOutsideTemperatureNumeric':getOutsideTemperatureNumeric,'setPresence':setPresence,'abortExitTimer':abortExitTimer,'startExitTimer':startExitTimer};