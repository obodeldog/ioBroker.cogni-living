const a4_0x3c6b6c=a4_0x54d7;(function(_0x5c87d6,_0x5d09f2){const _0x6f8266=a4_0x54d7,_0x4c440c=_0x5c87d6();while(!![]){try{const _0x29cbe2=-parseInt(_0x6f8266(0x16f))/0x1*(parseInt(_0x6f8266(0x169))/0x2)+-parseInt(_0x6f8266(0x13c))/0x3*(parseInt(_0x6f8266(0x136))/0x4)+parseInt(_0x6f8266(0x152))/0x5+-parseInt(_0x6f8266(0x14c))/0x6+parseInt(_0x6f8266(0x11e))/0x7+-parseInt(_0x6f8266(0x11b))/0x8*(-parseInt(_0x6f8266(0x155))/0x9)+-parseInt(_0x6f8266(0x159))/0xa*(-parseInt(_0x6f8266(0x160))/0xb);if(_0x29cbe2===_0x5d09f2)break;else _0x4c440c['push'](_0x4c440c['shift']());}catch(_0x49f880){_0x4c440c['push'](_0x4c440c['shift']());}}}(a4_0x3721,0x56235));const a4_0x1932f6=(function(){let _0x59f821=!![];return function(_0x435a20,_0x1834d2){const _0x35b031=_0x59f821?function(){const _0x56ad01=a4_0x54d7;if(_0x1834d2){const _0x520337=_0x1834d2[_0x56ad01(0x122)](_0x435a20,arguments);return _0x1834d2=null,_0x520337;}}:function(){};return _0x59f821=![],_0x35b031;};}()),a4_0x2807b4=a4_0x1932f6(this,function(){const _0x3bc10c=a4_0x54d7;return a4_0x2807b4['toString']()[_0x3bc10c(0x145)](_0x3bc10c(0x13a))['toString']()[_0x3bc10c(0x16a)](a4_0x2807b4)['search'](_0x3bc10c(0x13a));});a4_0x2807b4();'use strict';const HISTORY_MAX_SIZE=0x32,RAW_LOG_MAX_SIZE=0x9c4,THERMO_LOG_SIZE=0x3e8,SEQUENCE_TIMEOUT_MS=0x5*0x3c*0x3e8,MAX_TRAINING_SET_SIZE=0x1f4,EXIT_TIMER_MINUTES=0xf,EXIT_GRACE_PERIOD_SECONDS=0x1e;let activeSequence=[],sequenceTimer=null;function a4_0x3721(){const _0x4ae595=['events.history','contact','bewegung','44iUfOAM','presence','3004072RlShdC','schalter','motion','4662553dhwjBG','config','temperature','weatherInstance','apply','isExit','rawEventLog','heizung','dimmer','some','klima','logDuplicates','length','eventHistory','openweathermap','currentSystemMode','push','round','sendToPythonWrapper','weatherunderground','kontakt','pop','tür','isProVersion','692fgwoJv','daswetter','temperatur','message','(((.+)+)+)+$','parse','10371oDHfCA','includes','occupancy','door','isGracePeriodActive','now','light','sensorLastValues','useWeather','search','exports','stringify','[RECORDER]\x20Error:\x20','unshift','type','exitGraceTimer','3181656FlUFJJ','.forecast.current.temp','map','.NextHours.Location_1.Day_1.current.temp_value','toISOString','value','538280DJhiFt','exitTimer','präsenz','9fRZMtk','name','.forecast.current.temperature','location','15020muaNlm','LTM.trainingData.thermodynamics','lampe','log','normal','shift','val','7139mAdZtJ','isPresent','toLowerCase','ANALYZE_SEQUENCE','setStateAsync','getForeignStateAsync','Unknown','getStateAsync','LTM.rawEventLog','29222wgUwWG','constructor','LTM.trainingData.sequences'];a4_0x3721=function(){return _0x4ae595;};return a4_0x3721();}async function getOutsideTemperatureNumeric(_0x59c0f2){const _0x4599f7=a4_0x54d7;if(_0x59c0f2[_0x4599f7(0x11f)]['outdoorSensorId'])try{const _0x1dd5a0=await _0x59c0f2[_0x4599f7(0x165)](_0x59c0f2[_0x4599f7(0x11f)]['outdoorSensorId']);if(_0x1dd5a0&&_0x1dd5a0[_0x4599f7(0x15f)]!==undefined&&_0x1dd5a0[_0x4599f7(0x15f)]!==null)return parseFloat(_0x1dd5a0[_0x4599f7(0x15f)]);}catch(_0x4d0c16){}const _0x42de72=_0x59c0f2[_0x4599f7(0x11f)][_0x4599f7(0x121)];if(!_0x59c0f2[_0x4599f7(0x11f)][_0x4599f7(0x144)]||!_0x42de72)return null;try{let _0x241c67='';if(_0x42de72[_0x4599f7(0x13d)]('accuweather'))_0x241c67=_0x42de72+'.Current.Temperature';else{if(_0x42de72[_0x4599f7(0x13d)](_0x4599f7(0x137)))_0x241c67=_0x42de72+_0x4599f7(0x14f);else{if(_0x42de72[_0x4599f7(0x13d)](_0x4599f7(0x12c)))_0x241c67=_0x42de72+_0x4599f7(0x157);else{if(_0x42de72[_0x4599f7(0x13d)](_0x4599f7(0x131)))_0x241c67=_0x42de72+_0x4599f7(0x14d);}}}if(_0x241c67){const _0x538de2=await _0x59c0f2[_0x4599f7(0x165)](_0x241c67);if(_0x538de2&&_0x538de2[_0x4599f7(0x15f)]!==undefined&&_0x538de2['val']!==null)return parseFloat(_0x538de2['val']);}}catch(_0x3d0c4a){}return null;}async function recordThermodynamics(_0x990bd4,_0x52cfff,_0x59e921,_0x118c3c){const _0x4acd83=a4_0x54d7,_0x5b3bfb=await getOutsideTemperatureNumeric(_0x990bd4),_0x47ae76=await _0x990bd4[_0x4acd83(0x167)](_0x4acd83(0x15a));let _0x2e8aa7=[];if(_0x47ae76&&_0x47ae76[_0x4acd83(0x15f)])try{_0x2e8aa7=JSON[_0x4acd83(0x13b)](_0x47ae76[_0x4acd83(0x15f)]);}catch(_0x7df3ad){}_0x2e8aa7['push']({'ts':Date[_0x4acd83(0x141)](),'room':_0x118c3c||_0x4acd83(0x166),'t_in':_0x59e921,'t_out':_0x5b3bfb});if(_0x2e8aa7[_0x4acd83(0x12a)]>THERMO_LOG_SIZE)_0x2e8aa7[_0x4acd83(0x15e)]();await _0x990bd4[_0x4acd83(0x164)]('LTM.trainingData.thermodynamics',{'val':JSON['stringify'](_0x2e8aa7),'ack':!![]});}async function saveCompletedSequence(_0x488adc){const _0x12d5a8=a4_0x54d7;try{const _0x353187=await _0x488adc['getStateAsync']('LTM.trainingData.sequences');let _0x32f71d=[];if(_0x353187&&_0x353187[_0x12d5a8(0x15f)])try{_0x32f71d=JSON[_0x12d5a8(0x13b)](_0x353187[_0x12d5a8(0x15f)]);}catch(_0x18cfd9){}const _0x2453bd=activeSequence[0x0]['ts'],_0x1ce76b=activeSequence[_0x12d5a8(0x14e)](_0x2c108a=>({'loc':_0x2c108a['loc'],'t_delta':Math[_0x12d5a8(0x12f)]((_0x2c108a['ts']-_0x2453bd)/0x3e8)})),_0x2592fd={'timestamp':new Date(_0x2453bd)[_0x12d5a8(0x150)](),'steps':_0x1ce76b,'duration':Math[_0x12d5a8(0x12f)]((activeSequence[activeSequence[_0x12d5a8(0x12a)]-0x1]['ts']-_0x2453bd)/0x3e8),'daytime':new Date(_0x2453bd)['getHours']()};_0x32f71d['push'](_0x2592fd);if(_0x32f71d[_0x12d5a8(0x12a)]>MAX_TRAINING_SET_SIZE)_0x32f71d[_0x12d5a8(0x15e)]();await _0x488adc['setStateAsync'](_0x12d5a8(0x16b),{'val':JSON[_0x12d5a8(0x147)](_0x32f71d),'ack':!![]}),_0x488adc[_0x12d5a8(0x135)]&&_0x488adc[_0x12d5a8(0x130)]&&_0x488adc['sendToPythonWrapper'](_0x12d5a8(0x163),{'sequence':_0x2592fd});}catch(_0x12d934){_0x488adc[_0x12d5a8(0x15c)]['error'](_0x12d5a8(0x148)+_0x12d934[_0x12d5a8(0x139)]);}}async function recordSequence(_0x396055,_0x13c50b){const _0x4535db=a4_0x54d7,_0x595ebb=(_0x13c50b[_0x4535db(0x14a)]||'')[_0x4535db(0x162)](),_0x14a864=[_0x4535db(0x11d),_0x4535db(0x16e),_0x4535db(0x154),_0x4535db(0x170),_0x4535db(0x13e),_0x4535db(0x13f),_0x4535db(0x134),'window','fenster',_0x4535db(0x16d),_0x4535db(0x132),_0x4535db(0x142),'licht','switch',_0x4535db(0x11c),_0x4535db(0x126),_0x4535db(0x15b)];if(!_0x14a864[_0x4535db(0x127)](_0x596c14=>_0x595ebb[_0x4535db(0x13d)](_0x596c14)))return;if(!_0x13c50b[_0x4535db(0x151)])return;if(sequenceTimer)clearTimeout(sequenceTimer);activeSequence[_0x4535db(0x12e)]({'loc':_0x13c50b[_0x4535db(0x158)]||_0x4535db(0x166),'id':_0x13c50b['id'],'ts':Date[_0x4535db(0x141)]()}),sequenceTimer=setTimeout(async()=>{if(activeSequence['length']>0x1)await saveCompletedSequence(_0x396055);activeSequence=[];},SEQUENCE_TIMEOUT_MS);}function startExitTimer(_0x435b4d){const _0x249591=a4_0x54d7;abortExitTimer(_0x435b4d),_0x435b4d['isGracePeriodActive']=!![],_0x435b4d[_0x249591(0x14b)]=setTimeout(()=>{const _0x192b50=_0x249591;_0x435b4d[_0x192b50(0x140)]=![];},EXIT_GRACE_PERIOD_SECONDS*0x3e8),_0x435b4d[_0x249591(0x153)]=setTimeout(()=>{const _0x97135c=_0x249591;setPresence(_0x435b4d,![]),_0x435b4d[_0x97135c(0x153)]=null;},EXIT_TIMER_MINUTES*0x3c*0x3e8);}function abortExitTimer(_0x343926){const _0x808275=a4_0x54d7;if(_0x343926[_0x808275(0x153)])clearTimeout(_0x343926[_0x808275(0x153)]);if(_0x343926[_0x808275(0x14b)])clearTimeout(_0x343926[_0x808275(0x14b)]);_0x343926['exitTimer']=null,_0x343926['exitGraceTimer']=null,_0x343926[_0x808275(0x140)]=![];}async function setPresence(_0x166ec1,_0x16fd97){const _0x2635ff=a4_0x54d7;if(_0x166ec1['isPresent']===_0x16fd97)return;_0x166ec1[_0x2635ff(0x161)]=_0x16fd97,await _0x166ec1[_0x2635ff(0x164)]('system.isPresent',{'val':_0x16fd97,'ack':!![]});}function a4_0x54d7(_0x273f0b,_0x3ae23f){const _0x3f0150=a4_0x3721();return a4_0x54d7=function(_0x2807b4,_0x1932f6){_0x2807b4=_0x2807b4-0x11b;let _0x3721ee=_0x3f0150[_0x2807b4];return _0x3721ee;},a4_0x54d7(_0x273f0b,_0x3ae23f);}async function processSensorEvent(_0xba3ca5,_0x1a7166,_0x45857c,_0x3967e9){const _0x116d0b=a4_0x54d7;if(!_0x3967e9)return;const _0x4d1110=_0x45857c['val'],_0x51fea1=Date['now'](),_0x55e171=_0xba3ca5[_0x116d0b(0x143)][_0x1a7166];_0xba3ca5[_0x116d0b(0x143)][_0x1a7166]=_0x4d1110;if(!_0x3967e9[_0x116d0b(0x129)]&&_0x55e171!=undefined&&_0x55e171==_0x4d1110)return;const _0x469353=(_0x3967e9['type']||'')[_0x116d0b(0x162)](),_0x58fd7c=_0x469353[_0x116d0b(0x13d)](_0x116d0b(0x120))||_0x469353['includes'](_0x116d0b(0x138))||_0x469353['includes'](_0x116d0b(0x128))||_0x469353['includes'](_0x116d0b(0x125));_0xba3ca5[_0x116d0b(0x135)]&&_0x58fd7c&&recordThermodynamics(_0xba3ca5,_0x1a7166,_0x4d1110,_0x3967e9[_0x116d0b(0x158)]);const _0x1402ff={'timestamp':_0x51fea1,'id':_0x1a7166,'name':_0x3967e9[_0x116d0b(0x156)],'type':_0x3967e9[_0x116d0b(0x14a)],'location':_0x3967e9[_0x116d0b(0x158)],'value':_0x4d1110};_0xba3ca5[_0x116d0b(0x12b)][_0x116d0b(0x149)](_0x1402ff);if(_0xba3ca5[_0x116d0b(0x12b)][_0x116d0b(0x12a)]>HISTORY_MAX_SIZE)_0xba3ca5[_0x116d0b(0x12b)][_0x116d0b(0x133)]();await _0xba3ca5['setStateAsync']('events.lastEvent',{'val':JSON[_0x116d0b(0x147)](_0x1402ff),'ack':!![]}),await _0xba3ca5[_0x116d0b(0x164)](_0x116d0b(0x16c),{'val':JSON[_0x116d0b(0x147)](_0xba3ca5['eventHistory']),'ack':!![]});if(_0xba3ca5[_0x116d0b(0x135)]){_0xba3ca5[_0x116d0b(0x124)]['push'](_0x1402ff);if(_0xba3ca5[_0x116d0b(0x124)][_0x116d0b(0x12a)]>RAW_LOG_MAX_SIZE)_0xba3ca5[_0x116d0b(0x124)]['splice'](0x0,_0xba3ca5[_0x116d0b(0x124)][_0x116d0b(0x12a)]-RAW_LOG_MAX_SIZE);await _0xba3ca5[_0x116d0b(0x164)](_0x116d0b(0x168),{'val':JSON[_0x116d0b(0x147)](_0xba3ca5[_0x116d0b(0x124)]),'ack':!![]}),recordSequence(_0xba3ca5,_0x1402ff);}if(_0x3967e9[_0x116d0b(0x123)]&&_0x4d1110===!![]){if(_0xba3ca5[_0x116d0b(0x161)]&&!_0xba3ca5[_0x116d0b(0x140)])startExitTimer(_0xba3ca5);else{if(!_0xba3ca5[_0x116d0b(0x161)])setPresence(_0xba3ca5,!![]);}}else{if(_0x3967e9['type']===_0x116d0b(0x11d)&&_0x4d1110===!![]){if(_0xba3ca5['exitTimer'])abortExitTimer(_0xba3ca5);if(!_0xba3ca5[_0x116d0b(0x161)]&&_0xba3ca5[_0x116d0b(0x12d)]===_0x116d0b(0x15d))setPresence(_0xba3ca5,!![]);}}_0xba3ca5[_0x116d0b(0x135)]&&_0x3967e9['type']===_0x116d0b(0x11d)&&_0x4d1110===!![]&&_0x3967e9['location']&&_0xba3ca5[_0x116d0b(0x130)]&&_0xba3ca5[_0x116d0b(0x130)]('SIMULATE_SIGNAL',{'room':_0x3967e9[_0x116d0b(0x158)]});}module[a4_0x3c6b6c(0x146)]={'processSensorEvent':processSensorEvent,'getOutsideTemperatureNumeric':getOutsideTemperatureNumeric,'setPresence':setPresence,'abortExitTimer':abortExitTimer,'startExitTimer':startExitTimer};