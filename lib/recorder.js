const a5_0x45d130=a5_0x1b02;(function(_0x5915f5,_0x38d81c){const _0x837f7b=a5_0x1b02,_0x5164d3=_0x5915f5();while(!![]){try{const _0xea7c18=-parseInt(_0x837f7b(0xbc))/0x1+parseInt(_0x837f7b(0xf8))/0x2*(parseInt(_0x837f7b(0xe9))/0x3)+-parseInt(_0x837f7b(0xd1))/0x4+-parseInt(_0x837f7b(0xd8))/0x5*(parseInt(_0x837f7b(0xbb))/0x6)+-parseInt(_0x837f7b(0xdd))/0x7*(parseInt(_0x837f7b(0x100))/0x8)+-parseInt(_0x837f7b(0xd9))/0x9*(-parseInt(_0x837f7b(0xc4))/0xa)+parseInt(_0x837f7b(0xbf))/0xb;if(_0xea7c18===_0x38d81c)break;else _0x5164d3['push'](_0x5164d3['shift']());}catch(_0x5a7403){_0x5164d3['push'](_0x5164d3['shift']());}}}(a5_0x2f70,0x7fa4f));function a5_0x1b02(_0x184c19,_0x6cfa3f){const _0x3f0b80=a5_0x2f70();return a5_0x1b02=function(_0x84014b,_0x22f861){_0x84014b=_0x84014b-0xb2;let _0x2f70bc=_0x3f0b80[_0x84014b];return _0x2f70bc;},a5_0x1b02(_0x184c19,_0x6cfa3f);}const a5_0x22f861=(function(){let _0x4c7114=!![];return function(_0x4a9741,_0x29a4ea){const _0x5acdd0=_0x4c7114?function(){const _0x52b890=a5_0x1b02;if(_0x29a4ea){const _0x17499d=_0x29a4ea[_0x52b890(0xb8)](_0x4a9741,arguments);return _0x29a4ea=null,_0x17499d;}}:function(){};return _0x4c7114=![],_0x5acdd0;};}()),a5_0x84014b=a5_0x22f861(this,function(){const _0x4c2777=a5_0x1b02;return a5_0x84014b['toString']()[_0x4c2777(0xce)](_0x4c2777(0x10b))[_0x4c2777(0xc5)]()[_0x4c2777(0xec)](a5_0x84014b)['search']('(((.+)+)+)+$');});a5_0x84014b();'use strict';const HISTORY_MAX_SIZE=0x32,RAW_LOG_MAX_SIZE=0x9c4,THERMO_LOG_SIZE=0x3e8,SEQUENCE_TIMEOUT_MS=0x5*0x3c*0x3e8,MAX_TRAINING_SET_SIZE=0x1f4,EXIT_TIMER_MINUTES=0xf,EXIT_GRACE_PERIOD_SECONDS=0x1e;let activeSequence=[],sequenceTimer=null;async function getOutsideTemperatureNumeric(_0x42b21e){const _0x40a044=a5_0x1b02;if(_0x42b21e[_0x40a044(0x105)][_0x40a044(0xe5)])try{const _0x43f7de=await _0x42b21e[_0x40a044(0xe8)](_0x42b21e['config'][_0x40a044(0xe5)]);if(_0x43f7de&&_0x43f7de[_0x40a044(0xdc)]!==undefined&&_0x43f7de['val']!==null)return parseFloat(_0x43f7de[_0x40a044(0xdc)]);}catch(_0x3fa3e5){}const _0x374851=_0x42b21e[_0x40a044(0x105)]['weatherInstance'];if(!_0x42b21e['config'][_0x40a044(0xe4)]||!_0x374851)return null;try{let _0x46d279='';if(_0x374851['includes']('accuweather'))_0x46d279=_0x374851+'.Current.Temperature';else{if(_0x374851[_0x40a044(0xf3)](_0x40a044(0xe7)))_0x46d279=_0x374851+_0x40a044(0xcc);else{if(_0x374851[_0x40a044(0xf3)](_0x40a044(0xf7)))_0x46d279=_0x374851+'.forecast.current.temperature';else{if(_0x374851['includes']('weatherunderground'))_0x46d279=_0x374851+'.forecast.current.temp';}}}if(_0x46d279){const _0x19b381=await _0x42b21e[_0x40a044(0xe8)](_0x46d279);if(_0x19b381&&_0x19b381['val']!==undefined&&_0x19b381[_0x40a044(0xdc)]!==null)return parseFloat(_0x19b381[_0x40a044(0xdc)]);}}catch(_0x41a01b){}return null;}function a5_0x2f70(){const _0x3f6f53=['tür','door','exports','(((.+)+)+)+$','.1.VALVE_STATE','Unknown','ANALYZE_SEQUENCE','.1.LEVEL','fenster','sensorLastValues','parse','map','push','dimmer','.1.ACTUAL_TEMPERATURE','apply','LEVEL','logDuplicates','58326nnKKoP','112721SXqnIS','contact','some','4172113efnADM','length','kontakt','toISOString','occupancy','179520DVVDJO','toString','splice','toLowerCase','system.isPresent','isExit','hm-rpc','exitTimer','.NextHours.Location_1.Day_1.current.temp_value','log','search','LTM.rawEventLog','isPresent','2852204WRuuEg','lampe','normal','value','unshift','isProVersion','[RECORDER]\x20Error:\x20','5MFohJY','333shSNVq','loc','heizung','val','7TLtgSK','stringify','switch','motion','isGracePeriodActive','message','eventHistory','useWeather','outdoorSensorId','schalter','daswetter','getForeignStateAsync','3eczzhW','setStateAsync','round','constructor','events.lastEvent','from','exitGraceTimer','.1.TEMPERATURE','.ACTUAL_TEMPERATURE','location','includes','light','präsenz','LTM.trainingData.sequences','openweathermap','2058148hqZwcZ','licht','sendToPythonWrapper','.LEVEL','SIMULATE_SIGNAL','now','getStateAsync','getHours','5714056oauTqX','LTM.trainingData.thermodynamics','bewegung','presence','rawEventLog','config','type','error'];a5_0x2f70=function(){return _0x3f6f53;};return a5_0x2f70();}async function recordThermodynamics(_0x2bbe98,_0x5866be,_0x2debfc,_0x60ab07){const _0x606f3c=a5_0x1b02,_0x366f6c=await getOutsideTemperatureNumeric(_0x2bbe98);let _0x5d21a0=0x0;if(_0x5866be[_0x606f3c(0xf3)](_0x606f3c(0xca))){const _0x5636f4=[{'from':_0x606f3c(0xb7),'to':_0x606f3c(0x10f)},{'from':'.1.ACTUAL_TEMPERATURE','to':_0x606f3c(0x10c)},{'from':_0x606f3c(0xf0),'to':'.4.VALVE_STATE'},{'from':_0x606f3c(0xf1),'to':_0x606f3c(0xfb)}];for(const _0xeb18a1 of _0x5636f4){if(_0x5866be[_0x606f3c(0xf3)](_0xeb18a1[_0x606f3c(0xee)])){const _0x52daa4=_0x5866be['replace'](_0xeb18a1[_0x606f3c(0xee)],_0xeb18a1['to']);try{const _0x241e92=await _0x2bbe98[_0x606f3c(0xe8)](_0x52daa4);if(_0x241e92&&_0x241e92['val']!==null&&_0x241e92[_0x606f3c(0xdc)]!==undefined){let _0x1cc94a=_0x241e92['val'];typeof _0x1cc94a==='number'&&_0x1cc94a<=1.05&&_0xeb18a1['to']['includes'](_0x606f3c(0xb9))&&(_0x1cc94a=_0x1cc94a*0x64);_0x5d21a0=Math[_0x606f3c(0xeb)](_0x1cc94a);break;}}catch(_0x4fd2cb){}}}}const _0x54c69d=await _0x2bbe98[_0x606f3c(0xfe)](_0x606f3c(0x101));let _0x4c2116=[];if(_0x54c69d&&_0x54c69d[_0x606f3c(0xdc)])try{_0x4c2116=JSON[_0x606f3c(0xb3)](_0x54c69d[_0x606f3c(0xdc)]);}catch(_0x340c11){}_0x4c2116[_0x606f3c(0xb5)]({'ts':Date[_0x606f3c(0xfd)](),'room':_0x60ab07||'Unknown','t_in':_0x2debfc,'t_out':_0x366f6c,'valve':_0x5d21a0});if(_0x4c2116[_0x606f3c(0xc0)]>THERMO_LOG_SIZE)_0x4c2116['shift']();await _0x2bbe98[_0x606f3c(0xea)](_0x606f3c(0x101),{'val':JSON[_0x606f3c(0xde)](_0x4c2116),'ack':!![]});}async function saveCompletedSequence(_0x21459a){const _0x208148=a5_0x1b02;try{const _0x2b9076=await _0x21459a['getStateAsync']('LTM.trainingData.sequences');let _0x2b1695=[];if(_0x2b9076&&_0x2b9076[_0x208148(0xdc)])try{_0x2b1695=JSON[_0x208148(0xb3)](_0x2b9076[_0x208148(0xdc)]);}catch(_0x44f363){}const _0x3216d0=activeSequence[0x0]['ts'],_0x48d7c9=activeSequence[_0x208148(0xb4)](_0x33a485=>({'loc':_0x33a485[_0x208148(0xda)],'t_delta':Math[_0x208148(0xeb)]((_0x33a485['ts']-_0x3216d0)/0x3e8)})),_0x2bfc94={'timestamp':new Date(_0x3216d0)[_0x208148(0xc2)](),'steps':_0x48d7c9,'duration':Math[_0x208148(0xeb)]((activeSequence[activeSequence[_0x208148(0xc0)]-0x1]['ts']-_0x3216d0)/0x3e8),'daytime':new Date(_0x3216d0)[_0x208148(0xff)]()};_0x2b1695['push'](_0x2bfc94);if(_0x2b1695['length']>MAX_TRAINING_SET_SIZE)_0x2b1695['shift']();await _0x21459a['setStateAsync'](_0x208148(0xf6),{'val':JSON['stringify'](_0x2b1695),'ack':!![]}),_0x21459a[_0x208148(0xd6)]&&_0x21459a[_0x208148(0xfa)]&&_0x21459a[_0x208148(0xfa)](_0x208148(0x10e),{'sequence':_0x2bfc94});}catch(_0x2e1b56){_0x21459a[_0x208148(0xcd)][_0x208148(0x107)](_0x208148(0xd7)+_0x2e1b56[_0x208148(0xe2)]);}}async function recordSequence(_0x4ed507,_0x4a28af){const _0x3c104c=a5_0x1b02,_0x510ded=(_0x4a28af[_0x3c104c(0x106)]||'')[_0x3c104c(0xc7)](),_0x2c8ed1=[_0x3c104c(0xe0),_0x3c104c(0x102),_0x3c104c(0xf5),_0x3c104c(0x103),_0x3c104c(0xc3),_0x3c104c(0x109),_0x3c104c(0x108),'window',_0x3c104c(0x110),_0x3c104c(0xbd),_0x3c104c(0xc1),_0x3c104c(0xf4),_0x3c104c(0xf9),_0x3c104c(0xdf),_0x3c104c(0xe6),_0x3c104c(0xb6),_0x3c104c(0xd2)];if(!_0x2c8ed1[_0x3c104c(0xbe)](_0x1e06c6=>_0x510ded[_0x3c104c(0xf3)](_0x1e06c6)))return;if(!_0x4a28af[_0x3c104c(0xd4)])return;if(sequenceTimer)clearTimeout(sequenceTimer);activeSequence['push']({'loc':_0x4a28af['location']||_0x3c104c(0x10d),'id':_0x4a28af['id'],'ts':Date[_0x3c104c(0xfd)]()}),sequenceTimer=setTimeout(async()=>{const _0x25fac3=_0x3c104c;if(activeSequence[_0x25fac3(0xc0)]>0x1)await saveCompletedSequence(_0x4ed507);activeSequence=[];},SEQUENCE_TIMEOUT_MS);}function startExitTimer(_0x45aa2c){const _0x440bca=a5_0x1b02;abortExitTimer(_0x45aa2c),_0x45aa2c[_0x440bca(0xe1)]=!![],_0x45aa2c[_0x440bca(0xef)]=setTimeout(()=>{const _0x2cb03e=_0x440bca;_0x45aa2c[_0x2cb03e(0xe1)]=![];},EXIT_GRACE_PERIOD_SECONDS*0x3e8),_0x45aa2c[_0x440bca(0xcb)]=setTimeout(()=>{const _0x46d627=_0x440bca;setPresence(_0x45aa2c,![]),_0x45aa2c[_0x46d627(0xcb)]=null;},EXIT_TIMER_MINUTES*0x3c*0x3e8);}function abortExitTimer(_0x32ff59){const _0x4460b6=a5_0x1b02;if(_0x32ff59['exitTimer'])clearTimeout(_0x32ff59[_0x4460b6(0xcb)]);if(_0x32ff59[_0x4460b6(0xef)])clearTimeout(_0x32ff59[_0x4460b6(0xef)]);_0x32ff59[_0x4460b6(0xcb)]=null,_0x32ff59[_0x4460b6(0xef)]=null,_0x32ff59[_0x4460b6(0xe1)]=![];}async function setPresence(_0x242bad,_0x5988bd){const _0x28d8c6=a5_0x1b02;if(_0x242bad[_0x28d8c6(0xd0)]===_0x5988bd)return;_0x242bad[_0x28d8c6(0xd0)]=_0x5988bd,await _0x242bad[_0x28d8c6(0xea)](_0x28d8c6(0xc8),{'val':_0x5988bd,'ack':!![]});}async function processSensorEvent(_0x2fc51a,_0x305450,_0x5b9499,_0x3ddd8d){const _0x5d6a51=a5_0x1b02;if(!_0x3ddd8d)return null;const _0x256bae=_0x5b9499[_0x5d6a51(0xdc)],_0x193ce7=Date[_0x5d6a51(0xfd)](),_0x54dacf=_0x2fc51a[_0x5d6a51(0xb2)][_0x305450];_0x2fc51a[_0x5d6a51(0xb2)][_0x305450]=_0x256bae;if(!_0x3ddd8d[_0x5d6a51(0xba)]&&_0x54dacf!=undefined&&_0x54dacf==_0x256bae)return null;const _0x48ebe6=(_0x3ddd8d[_0x5d6a51(0x106)]||'')['toLowerCase'](),_0x793b8e=_0x48ebe6['includes']('temperature')||_0x48ebe6[_0x5d6a51(0xf3)]('temperatur')||_0x48ebe6[_0x5d6a51(0xf3)]('klima')||_0x48ebe6[_0x5d6a51(0xf3)](_0x5d6a51(0xdb));_0x2fc51a[_0x5d6a51(0xd6)]&&_0x793b8e&&recordThermodynamics(_0x2fc51a,_0x305450,_0x256bae,_0x3ddd8d[_0x5d6a51(0xf2)]);const _0x2dff9a={'timestamp':_0x193ce7,'id':_0x305450,'name':_0x3ddd8d['name'],'type':_0x3ddd8d[_0x5d6a51(0x106)],'location':_0x3ddd8d[_0x5d6a51(0xf2)],'value':_0x256bae};_0x2fc51a['eventHistory'][_0x5d6a51(0xd5)](_0x2dff9a);if(_0x2fc51a[_0x5d6a51(0xe3)][_0x5d6a51(0xc0)]>HISTORY_MAX_SIZE)_0x2fc51a['eventHistory']['pop']();await _0x2fc51a[_0x5d6a51(0xea)](_0x5d6a51(0xed),{'val':JSON[_0x5d6a51(0xde)](_0x2dff9a),'ack':!![]}),await _0x2fc51a[_0x5d6a51(0xea)]('events.history',{'val':JSON['stringify'](_0x2fc51a[_0x5d6a51(0xe3)]),'ack':!![]});if(_0x2fc51a[_0x5d6a51(0xd6)]){_0x2fc51a[_0x5d6a51(0x104)][_0x5d6a51(0xb5)](_0x2dff9a);if(_0x2fc51a['rawEventLog'][_0x5d6a51(0xc0)]>RAW_LOG_MAX_SIZE)_0x2fc51a['rawEventLog'][_0x5d6a51(0xc6)](0x0,_0x2fc51a['rawEventLog'][_0x5d6a51(0xc0)]-RAW_LOG_MAX_SIZE);await _0x2fc51a[_0x5d6a51(0xea)](_0x5d6a51(0xcf),{'val':JSON[_0x5d6a51(0xde)](_0x2fc51a['rawEventLog']),'ack':!![]}),recordSequence(_0x2fc51a,_0x2dff9a);}if(_0x3ddd8d[_0x5d6a51(0xc9)]&&_0x256bae===!![]){if(_0x2fc51a[_0x5d6a51(0xd0)]&&!_0x2fc51a['isGracePeriodActive'])startExitTimer(_0x2fc51a);else{if(!_0x2fc51a[_0x5d6a51(0xd0)])setPresence(_0x2fc51a,!![]);}}else{if(_0x3ddd8d[_0x5d6a51(0x106)]===_0x5d6a51(0xe0)&&_0x256bae===!![]){if(_0x2fc51a[_0x5d6a51(0xcb)])abortExitTimer(_0x2fc51a);if(!_0x2fc51a[_0x5d6a51(0xd0)]&&_0x2fc51a['currentSystemMode']===_0x5d6a51(0xd3))setPresence(_0x2fc51a,!![]);}}return _0x2fc51a[_0x5d6a51(0xd6)]&&_0x3ddd8d[_0x5d6a51(0x106)]==='motion'&&_0x256bae===!![]&&_0x3ddd8d[_0x5d6a51(0xf2)]&&_0x2fc51a[_0x5d6a51(0xfa)]&&_0x2fc51a[_0x5d6a51(0xfa)](_0x5d6a51(0xfc),{'room':_0x3ddd8d['location']}),_0x2dff9a;}module[a5_0x45d130(0x10a)]={'processSensorEvent':processSensorEvent,'getOutsideTemperatureNumeric':getOutsideTemperatureNumeric,'setPresence':setPresence,'abortExitTimer':abortExitTimer,'startExitTimer':startExitTimer};