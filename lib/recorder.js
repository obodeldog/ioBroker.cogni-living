(function(_0x41fd3f,_0x75a089){const _0x554424=a4_0x5b24,_0x308730=_0x41fd3f();while(!![]){try{const _0x406e1a=-parseInt(_0x554424(0xac))/0x1*(-parseInt(_0x554424(0xab))/0x2)+parseInt(_0x554424(0xe0))/0x3*(parseInt(_0x554424(0xda))/0x4)+-parseInt(_0x554424(0xa2))/0x5*(parseInt(_0x554424(0xa7))/0x6)+parseInt(_0x554424(0xb4))/0x7+parseInt(_0x554424(0xea))/0x8*(parseInt(_0x554424(0xa9))/0x9)+parseInt(_0x554424(0xef))/0xa*(parseInt(_0x554424(0xce))/0xb)+-parseInt(_0x554424(0xe7))/0xc*(parseInt(_0x554424(0xe6))/0xd);if(_0x406e1a===_0x75a089)break;else _0x308730['push'](_0x308730['shift']());}catch(_0x3b75b8){_0x308730['push'](_0x308730['shift']());}}}(a4_0x40f8,0xcb23e));const a4_0x1ca228=(function(){let _0x448068=!![];return function(_0x4582cc,_0x96f55a){const _0x153573=_0x448068?function(){const _0xca25da=a4_0x5b24;if(_0x96f55a){const _0x1b1cc3=_0x96f55a[_0xca25da(0xca)](_0x4582cc,arguments);return _0x96f55a=null,_0x1b1cc3;}}:function(){};return _0x448068=![],_0x153573;};}()),a4_0x869343=a4_0x1ca228(this,function(){const _0x27efe=a4_0x5b24;return a4_0x869343['toString']()[_0x27efe(0xbb)](_0x27efe(0xee))[_0x27efe(0xcb)]()[_0x27efe(0xb2)](a4_0x869343)[_0x27efe(0xbb)](_0x27efe(0xee));});a4_0x869343();'use strict';const HISTORY_MAX_SIZE=0x32,RAW_LOG_MAX_SIZE=0x9c4,THERMO_LOG_SIZE=0x3e8,SEQUENCE_TIMEOUT_MS=0x5*0x3c*0x3e8,MAX_TRAINING_SET_SIZE=0x1f4,EXIT_TIMER_MINUTES=0xf,EXIT_GRACE_PERIOD_SECONDS=0x1e;let activeSequence=[],sequenceTimer=null;async function getOutsideTemperatureNumeric(_0x585dad){const _0x493482=a4_0x5b24;if(_0x585dad[_0x493482(0xdd)][_0x493482(0xde)])try{const _0x36f970=await _0x585dad['getForeignStateAsync'](_0x585dad['config'][_0x493482(0xde)]);if(_0x36f970&&_0x36f970[_0x493482(0xec)]!==undefined&&_0x36f970[_0x493482(0xec)]!==null)return parseFloat(_0x36f970[_0x493482(0xec)]);}catch(_0x36864b){}const _0x438b25=_0x585dad[_0x493482(0xdd)][_0x493482(0xc6)];if(!_0x585dad[_0x493482(0xdd)][_0x493482(0xc9)]||!_0x438b25)return null;try{let _0x440e7d='';if(_0x438b25[_0x493482(0xed)]('accuweather'))_0x440e7d=_0x438b25+_0x493482(0xc0);else{if(_0x438b25[_0x493482(0xed)](_0x493482(0xc5)))_0x440e7d=_0x438b25+_0x493482(0xd5);else{if(_0x438b25[_0x493482(0xed)](_0x493482(0xd4)))_0x440e7d=_0x438b25+_0x493482(0xe1);else{if(_0x438b25['includes'](_0x493482(0xaf)))_0x440e7d=_0x438b25+_0x493482(0xd9);}}}if(_0x440e7d){const _0x33949d=await _0x585dad[_0x493482(0xe4)](_0x440e7d);if(_0x33949d&&_0x33949d[_0x493482(0xec)]!==undefined&&_0x33949d[_0x493482(0xec)]!==null)return parseFloat(_0x33949d[_0x493482(0xec)]);}}catch(_0xe37044){}return null;}async function recordThermodynamics(_0x4e109f,_0x1f19fb,_0x3d3cee,_0x2b244c){const _0x50499c=a4_0x5b24,_0x402f1f=await getOutsideTemperatureNumeric(_0x4e109f),_0x1f442e=await _0x4e109f[_0x50499c(0xdc)](_0x50499c(0xd3));let _0x2e2b55=[];if(_0x1f442e&&_0x1f442e[_0x50499c(0xec)])try{_0x2e2b55=JSON['parse'](_0x1f442e[_0x50499c(0xec)]);}catch(_0x413037){}_0x2e2b55[_0x50499c(0x9b)]({'ts':Date[_0x50499c(0xb3)](),'room':_0x2b244c||_0x50499c(0xbf),'t_in':_0x3d3cee,'t_out':_0x402f1f});if(_0x2e2b55['length']>THERMO_LOG_SIZE)_0x2e2b55[_0x50499c(0xd1)]();await _0x4e109f[_0x50499c(0x9d)](_0x50499c(0xd3),{'val':JSON[_0x50499c(0xa0)](_0x2e2b55),'ack':!![]});}async function saveCompletedSequence(_0x176eb6){const _0x2f8363=a4_0x5b24;try{const _0x40f4a9=await _0x176eb6[_0x2f8363(0xdc)](_0x2f8363(0xbc));let _0x4c9564=[];if(_0x40f4a9&&_0x40f4a9[_0x2f8363(0xec)])try{_0x4c9564=JSON[_0x2f8363(0xc4)](_0x40f4a9[_0x2f8363(0xec)]);}catch(_0x32bb9d){}const _0x4a2bca=activeSequence[0x0]['ts'],_0x3cb626=activeSequence['map'](_0x3e338e=>({'loc':_0x3e338e[_0x2f8363(0xd8)],'t_delta':Math['round']((_0x3e338e['ts']-_0x4a2bca)/0x3e8)})),_0x3270f2={'timestamp':new Date(_0x4a2bca)[_0x2f8363(0xa5)](),'steps':_0x3cb626,'duration':Math[_0x2f8363(0x9e)]((activeSequence[activeSequence['length']-0x1]['ts']-_0x4a2bca)/0x3e8),'daytime':new Date(_0x4a2bca)[_0x2f8363(0xa1)]()};_0x4c9564[_0x2f8363(0x9b)](_0x3270f2);if(_0x4c9564['length']>MAX_TRAINING_SET_SIZE)_0x4c9564[_0x2f8363(0xd1)]();await _0x176eb6[_0x2f8363(0x9d)](_0x2f8363(0xbc),{'val':JSON[_0x2f8363(0xa0)](_0x4c9564),'ack':!![]}),_0x176eb6[_0x2f8363(0xb5)]&&_0x176eb6[_0x2f8363(0xb6)]&&_0x176eb6[_0x2f8363(0xb6)]('ANALYZE_SEQUENCE',{'sequence':_0x3270f2});}catch(_0x4901e9){_0x176eb6['log'][_0x2f8363(0xad)]('[RECORDER]\x20Error:\x20'+_0x4901e9[_0x2f8363(0xbe)]);}}function a4_0x5b24(_0x3c45a2,_0x617c86){const _0x4f7346=a4_0x40f8();return a4_0x5b24=function(_0x869343,_0x1ca228){_0x869343=_0x869343-0x97;let _0x40f849=_0x4f7346[_0x869343];return _0x40f849;},a4_0x5b24(_0x3c45a2,_0x617c86);}async function recordSequence(_0x14a6ec,_0x2a84c8){const _0x170e6f=a4_0x5b24,_0xb9a6a6=(_0x2a84c8[_0x170e6f(0x9f)]||'')['toLowerCase'](),_0x59dafc=[_0x170e6f(0xe9),_0x170e6f(0x9a),'präsenz',_0x170e6f(0xcd),_0x170e6f(0xb9),'door',_0x170e6f(0xc7),'window',_0x170e6f(0xcf),_0x170e6f(0xb1),_0x170e6f(0xeb),_0x170e6f(0xcc),_0x170e6f(0x98),_0x170e6f(0xc8),_0x170e6f(0xe2),_0x170e6f(0xaa),_0x170e6f(0x97)];if(!_0x59dafc['some'](_0x177c76=>_0xb9a6a6[_0x170e6f(0xed)](_0x177c76)))return;if(!_0x2a84c8[_0x170e6f(0xc1)])return;if(sequenceTimer)clearTimeout(sequenceTimer);activeSequence[_0x170e6f(0x9b)]({'loc':_0x2a84c8[_0x170e6f(0xe8)]||_0x170e6f(0xbf),'id':_0x2a84c8['id'],'ts':Date[_0x170e6f(0xb3)]()}),sequenceTimer=setTimeout(async()=>{const _0x4d3eb0=_0x170e6f;if(activeSequence[_0x4d3eb0(0xf0)]>0x1)await saveCompletedSequence(_0x14a6ec);activeSequence=[];},SEQUENCE_TIMEOUT_MS);}function startExitTimer(_0x52e5e7){const _0x3482fa=a4_0x5b24;abortExitTimer(_0x52e5e7),_0x52e5e7['isGracePeriodActive']=!![],_0x52e5e7[_0x3482fa(0xae)]=setTimeout(()=>{_0x52e5e7['isGracePeriodActive']=![];},EXIT_GRACE_PERIOD_SECONDS*0x3e8),_0x52e5e7[_0x3482fa(0x9c)]=setTimeout(()=>{const _0x526712=_0x3482fa;setPresence(_0x52e5e7,![]),_0x52e5e7[_0x526712(0x9c)]=null;},EXIT_TIMER_MINUTES*0x3c*0x3e8);}function abortExitTimer(_0x5d4ac2){const _0x9a4f73=a4_0x5b24;if(_0x5d4ac2[_0x9a4f73(0x9c)])clearTimeout(_0x5d4ac2[_0x9a4f73(0x9c)]);if(_0x5d4ac2[_0x9a4f73(0xae)])clearTimeout(_0x5d4ac2[_0x9a4f73(0xae)]);_0x5d4ac2['exitTimer']=null,_0x5d4ac2[_0x9a4f73(0xae)]=null,_0x5d4ac2[_0x9a4f73(0xd2)]=![];}async function setPresence(_0x215de6,_0x1a23e0){const _0x4c1e5b=a4_0x5b24;if(_0x215de6['isPresent']===_0x1a23e0)return;_0x215de6['isPresent']=_0x1a23e0,await _0x215de6[_0x4c1e5b(0x9d)](_0x4c1e5b(0xb7),{'val':_0x1a23e0,'ack':!![]});}function a4_0x40f8(){const _0x121ce6=['fenster','isExit','shift','isGracePeriodActive','LTM.trainingData.thermodynamics','openweathermap','.NextHours.Location_1.Day_1.current.temp_value','pop','rawEventLog','loc','.forecast.current.temp','1636rHFRbJ','isPresent','getStateAsync','config','outdoorSensorId','sensorLastValues','3126jsyKLu','.forecast.current.temperature','schalter','events.lastEvent','getForeignStateAsync','LTM.rawEventLog','18097742TgbVZF','12QyKNEx','location','motion','56400vCDzKF','kontakt','val','includes','(((.+)+)+)+$','104430xRsuuV','length','lampe','licht','heizung','bewegung','push','exitTimer','setStateAsync','round','type','stringify','getHours','55TrJrvy','unshift','toLowerCase','toISOString','klima','51246cQFzpi','name','225nXFLOv','dimmer','2ljgYNt','1283MUYOdN','error','exitGraceTimer','weatherunderground','events.history','contact','constructor','now','7761194xVyjlZ','isProVersion','sendToPythonWrapper','system.isPresent','logDuplicates','occupancy','temperature','search','LTM.trainingData.sequences','normal','message','Unknown','.Current.Temperature','value','eventHistory','splice','parse','daswetter','weatherInstance','tür','switch','useWeather','apply','toString','light','presence','638kaOaNZ'];a4_0x40f8=function(){return _0x121ce6;};return a4_0x40f8();}async function processSensorEvent(_0x28007f,_0x5c5eac,_0x1a2146,_0x581cee){const _0x137a12=a4_0x5b24;if(!_0x581cee)return;const _0x5c4a11=_0x1a2146['val'],_0x42843f=Date[_0x137a12(0xb3)](),_0x308a36=_0x28007f[_0x137a12(0xdf)][_0x5c5eac];_0x28007f[_0x137a12(0xdf)][_0x5c5eac]=_0x5c4a11;if(!_0x581cee[_0x137a12(0xb8)]&&_0x308a36!=undefined&&_0x308a36==_0x5c4a11)return;const _0x47aced=(_0x581cee[_0x137a12(0x9f)]||'')[_0x137a12(0xa4)](),_0x4335c0=_0x47aced['includes'](_0x137a12(0xba))||_0x47aced[_0x137a12(0xed)]('temperatur')||_0x47aced['includes'](_0x137a12(0xa6))||_0x47aced['includes'](_0x137a12(0x99));_0x28007f[_0x137a12(0xb5)]&&_0x4335c0&&recordThermodynamics(_0x28007f,_0x5c5eac,_0x5c4a11,_0x581cee[_0x137a12(0xe8)]);const _0x2bdbe6={'timestamp':_0x42843f,'id':_0x5c5eac,'name':_0x581cee[_0x137a12(0xa8)],'type':_0x581cee['type'],'location':_0x581cee['location'],'value':_0x5c4a11};_0x28007f['eventHistory'][_0x137a12(0xa3)](_0x2bdbe6);if(_0x28007f[_0x137a12(0xc2)]['length']>HISTORY_MAX_SIZE)_0x28007f[_0x137a12(0xc2)][_0x137a12(0xd6)]();await _0x28007f[_0x137a12(0x9d)](_0x137a12(0xe3),{'val':JSON[_0x137a12(0xa0)](_0x2bdbe6),'ack':!![]}),await _0x28007f[_0x137a12(0x9d)](_0x137a12(0xb0),{'val':JSON['stringify'](_0x28007f['eventHistory']),'ack':!![]});if(_0x28007f[_0x137a12(0xb5)]){_0x28007f['rawEventLog'][_0x137a12(0x9b)](_0x2bdbe6);if(_0x28007f['rawEventLog']['length']>RAW_LOG_MAX_SIZE)_0x28007f[_0x137a12(0xd7)][_0x137a12(0xc3)](0x0,_0x28007f[_0x137a12(0xd7)][_0x137a12(0xf0)]-RAW_LOG_MAX_SIZE);await _0x28007f[_0x137a12(0x9d)](_0x137a12(0xe5),{'val':JSON['stringify'](_0x28007f[_0x137a12(0xd7)]),'ack':!![]}),recordSequence(_0x28007f,_0x2bdbe6);}if(_0x581cee[_0x137a12(0xd0)]&&_0x5c4a11===!![]){if(_0x28007f[_0x137a12(0xdb)]&&!_0x28007f[_0x137a12(0xd2)])startExitTimer(_0x28007f);else{if(!_0x28007f[_0x137a12(0xdb)])setPresence(_0x28007f,!![]);}}else{if(_0x581cee[_0x137a12(0x9f)]===_0x137a12(0xe9)&&_0x5c4a11===!![]){if(_0x28007f['exitTimer'])abortExitTimer(_0x28007f);if(!_0x28007f['isPresent']&&_0x28007f['currentSystemMode']===_0x137a12(0xbd))setPresence(_0x28007f,!![]);}}_0x28007f[_0x137a12(0xb5)]&&_0x581cee[_0x137a12(0x9f)]===_0x137a12(0xe9)&&_0x5c4a11===!![]&&_0x581cee['location']&&_0x28007f[_0x137a12(0xb6)]&&_0x28007f[_0x137a12(0xb6)]('SIMULATE_SIGNAL',{'room':_0x581cee[_0x137a12(0xe8)]});}module['exports']={'processSensorEvent':processSensorEvent,'getOutsideTemperatureNumeric':getOutsideTemperatureNumeric,'setPresence':setPresence,'abortExitTimer':abortExitTimer,'startExitTimer':startExitTimer};