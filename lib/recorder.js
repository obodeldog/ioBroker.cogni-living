const a5_0x358ac3=a5_0xfbb6;(function(_0x1238df,_0xb21bf0){const _0x5ae242=a5_0xfbb6,_0x1cae39=_0x1238df();while(!![]){try{const _0x5f3447=-parseInt(_0x5ae242(0xda))/0x1*(parseInt(_0x5ae242(0xbf))/0x2)+-parseInt(_0x5ae242(0xd2))/0x3+parseInt(_0x5ae242(0xba))/0x4*(-parseInt(_0x5ae242(0xcb))/0x5)+parseInt(_0x5ae242(0x76))/0x6*(parseInt(_0x5ae242(0x93))/0x7)+parseInt(_0x5ae242(0x7a))/0x8+parseInt(_0x5ae242(0xb9))/0x9+parseInt(_0x5ae242(0x86))/0xa*(parseInt(_0x5ae242(0x7b))/0xb);if(_0x5f3447===_0xb21bf0)break;else _0x1cae39['push'](_0x1cae39['shift']());}catch(_0x1393fc){_0x1cae39['push'](_0x1cae39['shift']());}}}(a5_0x34e2,0x5c4eb));function a5_0x34e2(){const _0x5efd54=['4yeDzRi','isPresent','LEVEL','[RECORDER]\x20Ignored\x20implausible\x20temperature\x20value:\x20','from','2oHHYWE','light','licht','log','toString','dimmer','.ACTUAL_TEMPERATURE','thermostat','splice','weatherunderground','.forecast.current.temperature','push','1147255PnyMhO','occupancy','bewegung','currentSystemMode','contact','events.lastEvent','LTM.rawEventLog','1887912bXSGIa','map','isExit','SIMULATE_SIGNAL','toLowerCase','openweathermap','STATE','getForeignStateAsync','547442GHOWmW','째C\x20from\x20','.NextHours.Location_1.Day_1.current.temp_value','constructor','sendToPythonWrapper','exports','presence','includes','stringify','12eFsLtB','round','.1.TEMPERATURE','some','1181136TSozOL','1523951OFXAkB','exitTimer','config','t체r','now','.1.ACTUAL_TEMPERATURE','exitGraceTimer','fenster','schalter','isGracePeriodActive','temperature','70VNIWSY','window','getStateAsync','debug','weatherInstance','replace','error','number','type','location','schloss','.1.LEVEL','shift','2233644dRdcIm','switch','val','useWeather','string','level','door','lastTrackerEventTime','system.isPresent','LTM.trainingData.thermodynamics','name','unshift','pr채senz','TRACK_EVENT','heizung','value','search','getHours','Valve','LTM.trainingData.sequences','(((.+)+)+)+$','temperatur','sensorLastValues','eventHistory','Unknown','isProVersion','normal','length','parse','rawEventLog','.4.VALVE_STATE','motion','.1.VALVE_STATE','kontakt','setStateAsync','daswetter','klima','apply','258075iRTseR'];a5_0x34e2=function(){return _0x5efd54;};return a5_0x34e2();}function a5_0xfbb6(_0x3843c0,_0xdcbc96){const _0x1ad10c=a5_0x34e2();return a5_0xfbb6=function(_0x616a63,_0x15b681){_0x616a63=_0x616a63-0x71;let _0x34e2bb=_0x1ad10c[_0x616a63];return _0x34e2bb;},a5_0xfbb6(_0x3843c0,_0xdcbc96);}const a5_0x15b681=(function(){let _0x3854b7=!![];return function(_0x531dbb,_0x3fd7db){const _0x338ed6=_0x3854b7?function(){const _0xb91887=a5_0xfbb6;if(_0x3fd7db){const _0x282d44=_0x3fd7db[_0xb91887(0xb8)](_0x531dbb,arguments);return _0x3fd7db=null,_0x282d44;}}:function(){};return _0x3854b7=![],_0x338ed6;};}()),a5_0x616a63=a5_0x15b681(this,function(){const _0x2c87e8=a5_0xfbb6;return a5_0x616a63[_0x2c87e8(0xc3)]()[_0x2c87e8(0xa3)](_0x2c87e8(0xa7))[_0x2c87e8(0xc3)]()[_0x2c87e8(0xdd)](a5_0x616a63)['search'](_0x2c87e8(0xa7));});a5_0x616a63();'use strict';const HISTORY_MAX_SIZE=0x32,RAW_LOG_MAX_SIZE=0x9c4,THERMO_LOG_SIZE=0x3e8,SEQUENCE_TIMEOUT_MS=0x5*0x3c*0x3e8,MAX_TRAINING_SET_SIZE=0x1f4,EXIT_TIMER_MINUTES=0xf,EXIT_GRACE_PERIOD_SECONDS=0x1e;let activeSequence=[],sequenceTimer=null;async function getOutsideTemperatureNumeric(_0x12be11){const _0xe4b0b6=a5_0xfbb6;if(_0x12be11[_0xe4b0b6(0x7d)]['outdoorSensorId'])try{const _0x36f102=await _0x12be11[_0xe4b0b6(0xd9)](_0x12be11[_0xe4b0b6(0x7d)]['outdoorSensorId']);if(_0x36f102&&_0x36f102['val']!==undefined&&_0x36f102[_0xe4b0b6(0x95)]!==null)return parseFloat(_0x36f102[_0xe4b0b6(0x95)]);}catch(_0x3332b9){}const _0x59c951=_0x12be11[_0xe4b0b6(0x7d)][_0xe4b0b6(0x8a)];if(!_0x12be11[_0xe4b0b6(0x7d)][_0xe4b0b6(0x96)]||!_0x59c951)return null;try{let _0x864a5d='';if(_0x59c951[_0xe4b0b6(0x74)]('accuweather'))_0x864a5d=_0x59c951+'.Current.Temperature';else{if(_0x59c951[_0xe4b0b6(0x74)](_0xe4b0b6(0xb6)))_0x864a5d=_0x59c951+_0xe4b0b6(0xdc);else{if(_0x59c951[_0xe4b0b6(0x74)](_0xe4b0b6(0xd7)))_0x864a5d=_0x59c951+_0xe4b0b6(0xc9);else{if(_0x59c951['includes'](_0xe4b0b6(0xc8)))_0x864a5d=_0x59c951+'.forecast.current.temp';}}}if(_0x864a5d){const _0x41ad98=await _0x12be11[_0xe4b0b6(0xd9)](_0x864a5d);if(_0x41ad98&&_0x41ad98[_0xe4b0b6(0x95)]!==undefined&&_0x41ad98[_0xe4b0b6(0x95)]!==null)return parseFloat(_0x41ad98[_0xe4b0b6(0x95)]);}}catch(_0x4adb2b){}return null;}async function recordThermodynamics(_0x1aad45,_0x14ac37,_0x552449,_0x57ac43){const _0x4d633d=a5_0xfbb6,_0x24ce68=await getOutsideTemperatureNumeric(_0x1aad45);if(_0x24ce68===null)return;let _0x544f26=0x0,_0x11ba5e=![];if(_0x1aad45[_0x4d633d(0x7d)]['valveMapping'])try{let _0x3fa31f=_0x1aad45[_0x4d633d(0x7d)]['valveMapping'];if(typeof _0x3fa31f===_0x4d633d(0x97))_0x3fa31f=JSON[_0x4d633d(0xaf)](_0x3fa31f);if(_0x3fa31f[_0x14ac37]){const _0x17aace=_0x3fa31f[_0x14ac37],_0x54b621=await _0x1aad45[_0x4d633d(0xd9)](_0x17aace);if(_0x54b621&&_0x54b621[_0x4d633d(0x95)]!==null&&_0x54b621[_0x4d633d(0x95)]!==undefined){let _0x33342e=Number(_0x54b621['val']);if(_0x33342e<=1.05&&!_0x17aace[_0x4d633d(0x74)]('STATUS')&&!_0x17aace[_0x4d633d(0x74)](_0x4d633d(0xd8)))_0x33342e=_0x33342e*0x64;_0x544f26=Math[_0x4d633d(0x77)](_0x33342e),_0x11ba5e=!![];}}}catch(_0x1f2098){}if(!_0x11ba5e){const _0x191cd6=[{'from':_0x4d633d(0x80),'to':_0x4d633d(0x91)},{'from':_0x4d633d(0x80),'to':_0x4d633d(0xb3)},{'from':_0x4d633d(0x78),'to':_0x4d633d(0xb1)},{'from':_0x4d633d(0xc5),'to':'.LEVEL'},{'from':_0x4d633d(0x85),'to':_0x4d633d(0x98)},{'from':'Temperature','to':_0x4d633d(0xa5)}];for(const _0x3c1bf7 of _0x191cd6){if(_0x14ac37[_0x4d633d(0x74)](_0x3c1bf7[_0x4d633d(0xbe)])){const _0x4e437b=_0x14ac37[_0x4d633d(0x8b)](_0x3c1bf7[_0x4d633d(0xbe)],_0x3c1bf7['to']);try{const _0x32f593=await _0x1aad45[_0x4d633d(0xd9)](_0x4e437b);if(_0x32f593&&_0x32f593[_0x4d633d(0x95)]!==null&&_0x32f593[_0x4d633d(0x95)]!==undefined){let _0x843b2e=Number(_0x32f593[_0x4d633d(0x95)]);if(typeof _0x843b2e===_0x4d633d(0x8d)){if(_0x843b2e<=1.05&&_0x3c1bf7['to'][_0x4d633d(0x74)](_0x4d633d(0xbc)))_0x843b2e=_0x843b2e*0x64;_0x544f26=Math[_0x4d633d(0x77)](_0x843b2e),_0x11ba5e=!![];break;}}}catch(_0x167900){}}}}const _0x45b47d=await _0x1aad45[_0x4d633d(0x88)](_0x4d633d(0x9c));let _0x400adf=[];if(_0x45b47d&&_0x45b47d[_0x4d633d(0x95)])try{_0x400adf=JSON[_0x4d633d(0xaf)](_0x45b47d[_0x4d633d(0x95)]);}catch(_0x2803b2){}_0x400adf[_0x4d633d(0xca)]({'ts':Date[_0x4d633d(0x7f)](),'room':_0x57ac43||'Unknown','t_in':_0x552449,'t_out':_0x24ce68,'valve':_0x544f26});if(_0x400adf[_0x4d633d(0xae)]>THERMO_LOG_SIZE)_0x400adf[_0x4d633d(0x92)]();await _0x1aad45[_0x4d633d(0xb5)](_0x4d633d(0x9c),{'val':JSON[_0x4d633d(0x75)](_0x400adf),'ack':!![]});}async function saveCompletedSequence(_0x492bd6){const _0x144c4a=a5_0xfbb6;try{const _0xb1e564=await _0x492bd6[_0x144c4a(0x88)]('LTM.trainingData.sequences');let _0x3f0d14=[];if(_0xb1e564&&_0xb1e564[_0x144c4a(0x95)])try{_0x3f0d14=JSON[_0x144c4a(0xaf)](_0xb1e564[_0x144c4a(0x95)]);}catch(_0x42261a){}const _0x20564d=activeSequence[0x0]['ts'],_0x4362d3=activeSequence[_0x144c4a(0xd3)](_0x106397=>({'loc':_0x106397['loc'],'t_delta':Math[_0x144c4a(0x77)]((_0x106397['ts']-_0x20564d)/0x3e8)})),_0x4cf7c9={'timestamp':new Date(_0x20564d)['toISOString'](),'steps':_0x4362d3,'duration':Math[_0x144c4a(0x77)]((activeSequence[activeSequence[_0x144c4a(0xae)]-0x1]['ts']-_0x20564d)/0x3e8),'daytime':new Date(_0x20564d)[_0x144c4a(0xa4)]()};_0x3f0d14['push'](_0x4cf7c9);if(_0x3f0d14[_0x144c4a(0xae)]>MAX_TRAINING_SET_SIZE)_0x3f0d14[_0x144c4a(0x92)]();await _0x492bd6[_0x144c4a(0xb5)](_0x144c4a(0xa6),{'val':JSON[_0x144c4a(0x75)](_0x3f0d14),'ack':!![]}),_0x492bd6[_0x144c4a(0xac)]&&_0x492bd6['sendToPythonWrapper']&&_0x492bd6[_0x144c4a(0x71)]('ANALYZE_SEQUENCE',{'sequence':_0x4cf7c9});}catch(_0x959332){_0x492bd6[_0x144c4a(0xc2)][_0x144c4a(0x8c)]('[RECORDER]\x20Error:\x20'+_0x959332['message']);}}async function recordSequence(_0x1c0d2e,_0x353fae){const _0x220128=a5_0xfbb6,_0x145298=(_0x353fae[_0x220128(0x8e)]||'')[_0x220128(0xd6)](),_0x310271=[_0x220128(0xb2),_0x220128(0xcd),'pr채senz',_0x220128(0x73),'occupancy',_0x220128(0x99),_0x220128(0x7e),_0x220128(0x87),_0x220128(0x82),_0x220128(0xcf),_0x220128(0xb4),_0x220128(0xc0),_0x220128(0xc1),_0x220128(0x94),_0x220128(0x83),_0x220128(0xc4),'lampe'];if(!_0x310271['some'](_0x1a9c9a=>_0x145298['includes'](_0x1a9c9a)))return;if(!_0x353fae[_0x220128(0xa2)])return;if(sequenceTimer)clearTimeout(sequenceTimer);activeSequence[_0x220128(0xca)]({'loc':_0x353fae['location']||_0x220128(0xab),'id':_0x353fae['id'],'ts':Date[_0x220128(0x7f)]()}),sequenceTimer=setTimeout(async()=>{const _0x4b675c=_0x220128;if(activeSequence[_0x4b675c(0xae)]>0x1)await saveCompletedSequence(_0x1c0d2e);activeSequence=[];},SEQUENCE_TIMEOUT_MS);}function startExitTimer(_0x4445f0){const _0x50f6f3=a5_0xfbb6;abortExitTimer(_0x4445f0),_0x4445f0[_0x50f6f3(0x84)]=!![],_0x4445f0[_0x50f6f3(0x81)]=setTimeout(()=>{const _0x497fbb=_0x50f6f3;_0x4445f0[_0x497fbb(0x84)]=![];},EXIT_GRACE_PERIOD_SECONDS*0x3e8),_0x4445f0['exitTimer']=setTimeout(()=>{setPresence(_0x4445f0,![]),_0x4445f0['exitTimer']=null;},EXIT_TIMER_MINUTES*0x3c*0x3e8);}function abortExitTimer(_0x3f127e){const _0x227908=a5_0xfbb6;if(_0x3f127e[_0x227908(0x7c)])clearTimeout(_0x3f127e[_0x227908(0x7c)]);if(_0x3f127e['exitGraceTimer'])clearTimeout(_0x3f127e[_0x227908(0x81)]);_0x3f127e[_0x227908(0x7c)]=null,_0x3f127e[_0x227908(0x81)]=null,_0x3f127e['isGracePeriodActive']=![];}async function setPresence(_0xc79453,_0x3c39c2){const _0x14b349=a5_0xfbb6;if(_0xc79453[_0x14b349(0xbb)]===_0x3c39c2)return;_0xc79453['isPresent']=_0x3c39c2,await _0xc79453[_0x14b349(0xb5)](_0x14b349(0x9b),{'val':_0x3c39c2,'ack':!![]});}async function processSensorEvent(_0x107dad,_0x2b5bf3,_0x18ae8d,_0x43c01f){const _0x4e12f9=a5_0xfbb6;if(!_0x43c01f)return null;const _0x4f17cd=_0x18ae8d[_0x4e12f9(0x95)],_0x46532e=Date[_0x4e12f9(0x7f)](),_0x3059b5=_0x107dad[_0x4e12f9(0xa9)][_0x2b5bf3];_0x107dad['sensorLastValues'][_0x2b5bf3]=_0x4f17cd;if(!_0x43c01f['logDuplicates']&&_0x3059b5!=undefined&&_0x3059b5==_0x4f17cd)return null;const _0x411edd=(_0x43c01f[_0x4e12f9(0x8e)]||'')[_0x4e12f9(0xd6)](),_0x2192d7=_0x411edd['includes'](_0x4e12f9(0x85))||_0x411edd[_0x4e12f9(0x74)](_0x4e12f9(0xa8))||_0x411edd[_0x4e12f9(0x74)](_0x4e12f9(0xb7))||_0x411edd[_0x4e12f9(0x74)](_0x4e12f9(0xa1))||_0x411edd[_0x4e12f9(0x74)](_0x4e12f9(0xc6));if(_0x2192d7&&typeof _0x4f17cd===_0x4e12f9(0x8d)){if(_0x4f17cd>0x50||_0x4f17cd<-0x32)return _0x107dad[_0x4e12f9(0xc2)][_0x4e12f9(0x89)](_0x4e12f9(0xbd)+_0x4f17cd+_0x4e12f9(0xdb)+_0x2b5bf3),null;}_0x107dad['isProVersion']&&_0x2192d7&&recordThermodynamics(_0x107dad,_0x2b5bf3,_0x4f17cd,_0x43c01f['location']);const _0x3eb942={'timestamp':_0x46532e,'id':_0x2b5bf3,'name':_0x43c01f[_0x4e12f9(0x9d)],'type':_0x43c01f[_0x4e12f9(0x8e)],'location':_0x43c01f[_0x4e12f9(0x8f)],'value':_0x4f17cd};_0x107dad[_0x4e12f9(0xaa)][_0x4e12f9(0x9e)](_0x3eb942);if(_0x107dad[_0x4e12f9(0xaa)][_0x4e12f9(0xae)]>HISTORY_MAX_SIZE)_0x107dad[_0x4e12f9(0xaa)]['pop']();await _0x107dad['setStateAsync'](_0x4e12f9(0xd0),{'val':JSON[_0x4e12f9(0x75)](_0x3eb942),'ack':!![]}),await _0x107dad[_0x4e12f9(0xb5)]('events.history',{'val':JSON[_0x4e12f9(0x75)](_0x107dad['eventHistory']),'ack':!![]});if(_0x107dad['isProVersion']){_0x107dad[_0x4e12f9(0xb0)]['push'](_0x3eb942);if(_0x107dad[_0x4e12f9(0xb0)]['length']>RAW_LOG_MAX_SIZE)_0x107dad[_0x4e12f9(0xb0)][_0x4e12f9(0xc7)](0x0,_0x107dad[_0x4e12f9(0xb0)]['length']-RAW_LOG_MAX_SIZE);await _0x107dad['setStateAsync'](_0x4e12f9(0xd1),{'val':JSON[_0x4e12f9(0x75)](_0x107dad['rawEventLog']),'ack':!![]}),recordSequence(_0x107dad,_0x3eb942);}if(_0x43c01f[_0x4e12f9(0xd4)]&&_0x4f17cd===!![]){if(_0x107dad[_0x4e12f9(0xbb)]&&!_0x107dad['isGracePeriodActive'])startExitTimer(_0x107dad);else{if(!_0x107dad[_0x4e12f9(0xbb)])setPresence(_0x107dad,!![]);}}else{if(_0x43c01f[_0x4e12f9(0x8e)]===_0x4e12f9(0xb2)&&_0x4f17cd===!![]){if(_0x107dad[_0x4e12f9(0x7c)])abortExitTimer(_0x107dad);if(!_0x107dad['isPresent']&&_0x107dad[_0x4e12f9(0xce)]===_0x4e12f9(0xad))setPresence(_0x107dad,!![]);}}if(_0x107dad[_0x4e12f9(0xac)]&&_0x107dad[_0x4e12f9(0x71)]){_0x43c01f['type']===_0x4e12f9(0xb2)&&_0x4f17cd===!![]&&_0x43c01f[_0x4e12f9(0x8f)]&&_0x107dad[_0x4e12f9(0x71)](_0x4e12f9(0xd5),{'room':_0x43c01f['location']});const _0x2db53f=[_0x4e12f9(0x99),_0x4e12f9(0x7e),_0x4e12f9(0x87),_0x4e12f9(0x82),'griff','handle','lock',_0x4e12f9(0x90)][_0x4e12f9(0x79)](_0x189035=>_0x411edd[_0x4e12f9(0x74)](_0x189035)),_0x314571=[_0x4e12f9(0xc0),_0x4e12f9(0xc1),_0x4e12f9(0x94),_0x4e12f9(0x83),_0x4e12f9(0xc4),'lampe']['some'](_0x290a54=>_0x411edd[_0x4e12f9(0x74)](_0x290a54)),_0x9dd971=[_0x4e12f9(0xb2),'bewegung',_0x4e12f9(0x9f),_0x4e12f9(0x73),_0x4e12f9(0xcc)]['some'](_0x4ddbf4=>_0x411edd[_0x4e12f9(0x74)](_0x4ddbf4));if(_0x43c01f[_0x4e12f9(0x8f)]&&(_0x2db53f||_0x314571||_0x9dd971)){const _0x263141=_0x4f17cd===!![]||typeof _0x4f17cd===_0x4e12f9(0x8d)&&_0x4f17cd>0x0,_0xc15e8d=_0x2db53f&&!_0x263141&&_0x3059b5!==undefined&&_0x3059b5!=_0x4f17cd;if(_0x263141||_0xc15e8d){const _0x200f86=_0x107dad[_0x4e12f9(0x9a)]||_0x46532e,_0x75a92=(_0x46532e-_0x200f86)/0x3e8;_0x107dad[_0x4e12f9(0x9a)]=_0x46532e,_0x107dad[_0x4e12f9(0x71)](_0x4e12f9(0xa0),{'room':_0x43c01f[_0x4e12f9(0x8f)],'dt':_0x75a92});}}}return _0x3eb942;}module[a5_0x358ac3(0x72)]={'processSensorEvent':processSensorEvent,'getOutsideTemperatureNumeric':getOutsideTemperatureNumeric,'setPresence':setPresence,'abortExitTimer':abortExitTimer,'startExitTimer':startExitTimer};