(function(_0xff1ee4,_0x1d4855){const _0xde5ce1=a5_0x2eef,_0x530ce9=_0xff1ee4();while(!![]){try{const _0x1215fa=-parseInt(_0xde5ce1(0x112))/0x1+parseInt(_0xde5ce1(0x10b))/0x2+parseInt(_0xde5ce1(0x135))/0x3*(-parseInt(_0xde5ce1(0x11f))/0x4)+parseInt(_0xde5ce1(0x13a))/0x5*(parseInt(_0xde5ce1(0x159))/0x6)+-parseInt(_0xde5ce1(0x10f))/0x7*(-parseInt(_0xde5ce1(0x12e))/0x8)+parseInt(_0xde5ce1(0x144))/0x9*(-parseInt(_0xde5ce1(0x155))/0xa)+parseInt(_0xde5ce1(0x14e))/0xb;if(_0x1215fa===_0x1d4855)break;else _0x530ce9['push'](_0x530ce9['shift']());}catch(_0x346d20){_0x530ce9['push'](_0x530ce9['shift']());}}}(a5_0x3c97,0xba499));const a5_0x20ca39=(function(){let _0x1316f9=!![];return function(_0xd03628,_0x319ca1){const _0x288a76=_0x1316f9?function(){if(_0x319ca1){const _0x4566ef=_0x319ca1['apply'](_0xd03628,arguments);return _0x319ca1=null,_0x4566ef;}}:function(){};return _0x1316f9=![],_0x288a76;};}()),a5_0x293006=a5_0x20ca39(this,function(){const _0x4b7027=a5_0x2eef;return a5_0x293006['toString']()[_0x4b7027(0x121)](_0x4b7027(0x119))[_0x4b7027(0x152)]()[_0x4b7027(0x140)](a5_0x293006)[_0x4b7027(0x121)](_0x4b7027(0x119));});a5_0x293006();'use strict';function a5_0x3c97(){const _0x12b4cc=['openweathermap','toISOString','push','switch','logDuplicates','(((.+)+)+)+$','getStateAsync','some','schalter','sendToPythonWrapper','now','2222068YQYyFo','kontakt','search','map','accuweather','error','setStateAsync','val','loc','useWeather','round','eventHistory','name','outdoorSensorId','heizung','16MieGbR','events.history','ANALYZE_SEQUENCE','type','system.isPresent','toLowerCase','normal','6vGUcqg','exitGraceTimer','isExit','location','stringify','5LCMjlr','length','klima','.forecast.current.temperature','rawEventLog','contact','constructor','weatherunderground','fenster','pop','8058717BSKSxH','.Current.Temperature','parse','config','LTM.trainingData.sequences','light','[RECORDER]\x20Error:\x20','includes','tür','occupancy','5482994VCYcWy','präsenz','isProVersion','window','toString','motion','licht','10qhPmhQ','weatherInstance','isPresent','Unknown','7080648lxdAPx','dimmer','daswetter','unshift','value','temperature','1179836HQBzZJ','isGracePeriodActive','LTM.trainingData.thermodynamics','exitTimer','2822071YWuUHn','sensorLastValues','shift','305306ixKBne','getHours'];a5_0x3c97=function(){return _0x12b4cc;};return a5_0x3c97();}const HISTORY_MAX_SIZE=0x32,RAW_LOG_MAX_SIZE=0x9c4,THERMO_LOG_SIZE=0x3e8,SEQUENCE_TIMEOUT_MS=0x5*0x3c*0x3e8,MAX_TRAINING_SET_SIZE=0x1f4,EXIT_TIMER_MINUTES=0xf,EXIT_GRACE_PERIOD_SECONDS=0x1e;let activeSequence=[],sequenceTimer=null;async function getOutsideTemperatureNumeric(_0x1c0945){const _0xe9cc8b=a5_0x2eef;if(_0x1c0945[_0xe9cc8b(0x147)][_0xe9cc8b(0x12c)])try{const _0x388024=await _0x1c0945['getForeignStateAsync'](_0x1c0945[_0xe9cc8b(0x147)][_0xe9cc8b(0x12c)]);if(_0x388024&&_0x388024[_0xe9cc8b(0x126)]!==undefined&&_0x388024[_0xe9cc8b(0x126)]!==null)return parseFloat(_0x388024['val']);}catch(_0xf1f1d1){}const _0x5e4105=_0x1c0945[_0xe9cc8b(0x147)][_0xe9cc8b(0x156)];if(!_0x1c0945[_0xe9cc8b(0x147)][_0xe9cc8b(0x128)]||!_0x5e4105)return null;try{let _0x4b701a='';if(_0x5e4105[_0xe9cc8b(0x14b)](_0xe9cc8b(0x123)))_0x4b701a=_0x5e4105+_0xe9cc8b(0x145);else{if(_0x5e4105[_0xe9cc8b(0x14b)](_0xe9cc8b(0x15b)))_0x4b701a=_0x5e4105+'.NextHours.Location_1.Day_1.current.temp_value';else{if(_0x5e4105[_0xe9cc8b(0x14b)](_0xe9cc8b(0x114)))_0x4b701a=_0x5e4105+_0xe9cc8b(0x13d);else{if(_0x5e4105[_0xe9cc8b(0x14b)](_0xe9cc8b(0x141)))_0x4b701a=_0x5e4105+'.forecast.current.temp';}}}if(_0x4b701a){const _0x48ef8e=await _0x1c0945['getForeignStateAsync'](_0x4b701a);if(_0x48ef8e&&_0x48ef8e['val']!==undefined&&_0x48ef8e[_0xe9cc8b(0x126)]!==null)return parseFloat(_0x48ef8e[_0xe9cc8b(0x126)]);}}catch(_0x74b620){}return null;}async function recordThermodynamics(_0x5be4c5,_0x38d81a,_0x376ea3,_0x3b1789){const _0x7faa9f=a5_0x2eef,_0x33104b=await getOutsideTemperatureNumeric(_0x5be4c5),_0x47c81d=await _0x5be4c5['getStateAsync']('LTM.trainingData.thermodynamics');let _0xaad0bc=[];if(_0x47c81d&&_0x47c81d[_0x7faa9f(0x126)])try{_0xaad0bc=JSON[_0x7faa9f(0x146)](_0x47c81d[_0x7faa9f(0x126)]);}catch(_0x3ef240){}_0xaad0bc[_0x7faa9f(0x116)]({'ts':Date[_0x7faa9f(0x11e)](),'room':_0x3b1789||_0x7faa9f(0x158),'t_in':_0x376ea3,'t_out':_0x33104b});if(_0xaad0bc[_0x7faa9f(0x13b)]>THERMO_LOG_SIZE)_0xaad0bc[_0x7faa9f(0x111)]();await _0x5be4c5[_0x7faa9f(0x125)](_0x7faa9f(0x10d),{'val':JSON[_0x7faa9f(0x139)](_0xaad0bc),'ack':!![]});}async function saveCompletedSequence(_0x2d0359){const _0x225d64=a5_0x2eef;try{const _0x136e42=await _0x2d0359[_0x225d64(0x11a)](_0x225d64(0x148));let _0xcbbfd5=[];if(_0x136e42&&_0x136e42['val'])try{_0xcbbfd5=JSON[_0x225d64(0x146)](_0x136e42[_0x225d64(0x126)]);}catch(_0x5c3709){}const _0x2be266=activeSequence[0x0]['ts'],_0x4894ec=activeSequence[_0x225d64(0x122)](_0x12c020=>({'loc':_0x12c020[_0x225d64(0x127)],'t_delta':Math[_0x225d64(0x129)]((_0x12c020['ts']-_0x2be266)/0x3e8)})),_0x2cc3e7={'timestamp':new Date(_0x2be266)[_0x225d64(0x115)](),'steps':_0x4894ec,'duration':Math[_0x225d64(0x129)]((activeSequence[activeSequence[_0x225d64(0x13b)]-0x1]['ts']-_0x2be266)/0x3e8),'daytime':new Date(_0x2be266)[_0x225d64(0x113)]()};_0xcbbfd5[_0x225d64(0x116)](_0x2cc3e7);if(_0xcbbfd5[_0x225d64(0x13b)]>MAX_TRAINING_SET_SIZE)_0xcbbfd5[_0x225d64(0x111)]();await _0x2d0359['setStateAsync']('LTM.trainingData.sequences',{'val':JSON[_0x225d64(0x139)](_0xcbbfd5),'ack':!![]}),_0x2d0359[_0x225d64(0x150)]&&_0x2d0359[_0x225d64(0x11d)]&&_0x2d0359[_0x225d64(0x11d)](_0x225d64(0x130),{'sequence':_0x2cc3e7});}catch(_0x5d42e9){_0x2d0359['log'][_0x225d64(0x124)](_0x225d64(0x14a)+_0x5d42e9['message']);}}async function recordSequence(_0x48bd3d,_0x20f2c6){const _0x3536c2=a5_0x2eef,_0x1f6ee1=(_0x20f2c6[_0x3536c2(0x131)]||'')[_0x3536c2(0x133)](),_0x46ee0b=[_0x3536c2(0x153),'bewegung',_0x3536c2(0x14f),'presence',_0x3536c2(0x14d),'door',_0x3536c2(0x14c),_0x3536c2(0x151),_0x3536c2(0x142),_0x3536c2(0x13f),_0x3536c2(0x120),_0x3536c2(0x149),_0x3536c2(0x154),_0x3536c2(0x117),_0x3536c2(0x11c),_0x3536c2(0x15a),'lampe'];if(!_0x46ee0b[_0x3536c2(0x11b)](_0x535beb=>_0x1f6ee1[_0x3536c2(0x14b)](_0x535beb)))return;if(!_0x20f2c6[_0x3536c2(0x109)])return;if(sequenceTimer)clearTimeout(sequenceTimer);activeSequence[_0x3536c2(0x116)]({'loc':_0x20f2c6[_0x3536c2(0x138)]||_0x3536c2(0x158),'id':_0x20f2c6['id'],'ts':Date[_0x3536c2(0x11e)]()}),sequenceTimer=setTimeout(async()=>{const _0x3f3303=_0x3536c2;if(activeSequence[_0x3f3303(0x13b)]>0x1)await saveCompletedSequence(_0x48bd3d);activeSequence=[];},SEQUENCE_TIMEOUT_MS);}function startExitTimer(_0x26715a){const _0x483c7c=a5_0x2eef;abortExitTimer(_0x26715a),_0x26715a[_0x483c7c(0x10c)]=!![],_0x26715a[_0x483c7c(0x136)]=setTimeout(()=>{const _0x2b78e8=_0x483c7c;_0x26715a[_0x2b78e8(0x10c)]=![];},EXIT_GRACE_PERIOD_SECONDS*0x3e8),_0x26715a[_0x483c7c(0x10e)]=setTimeout(()=>{setPresence(_0x26715a,![]),_0x26715a['exitTimer']=null;},EXIT_TIMER_MINUTES*0x3c*0x3e8);}function abortExitTimer(_0x2536ad){const _0x5e2354=a5_0x2eef;if(_0x2536ad[_0x5e2354(0x10e)])clearTimeout(_0x2536ad[_0x5e2354(0x10e)]);if(_0x2536ad[_0x5e2354(0x136)])clearTimeout(_0x2536ad[_0x5e2354(0x136)]);_0x2536ad['exitTimer']=null,_0x2536ad['exitGraceTimer']=null,_0x2536ad[_0x5e2354(0x10c)]=![];}async function setPresence(_0x530c8e,_0xd68ff6){const _0x27187b=a5_0x2eef;if(_0x530c8e[_0x27187b(0x157)]===_0xd68ff6)return;_0x530c8e['isPresent']=_0xd68ff6,await _0x530c8e[_0x27187b(0x125)](_0x27187b(0x132),{'val':_0xd68ff6,'ack':!![]});}async function processSensorEvent(_0x44a6dd,_0x7d85e5,_0x4b5bc2,_0x292b22){const _0xb4f535=a5_0x2eef;if(!_0x292b22)return null;const _0x297ec8=_0x4b5bc2['val'],_0x44985c=Date[_0xb4f535(0x11e)](),_0x3b6cc9=_0x44a6dd[_0xb4f535(0x110)][_0x7d85e5];_0x44a6dd[_0xb4f535(0x110)][_0x7d85e5]=_0x297ec8;if(!_0x292b22[_0xb4f535(0x118)]&&_0x3b6cc9!=undefined&&_0x3b6cc9==_0x297ec8)return null;const _0x41d796=(_0x292b22[_0xb4f535(0x131)]||'')[_0xb4f535(0x133)](),_0x4e7680=_0x41d796['includes'](_0xb4f535(0x10a))||_0x41d796[_0xb4f535(0x14b)]('temperatur')||_0x41d796['includes'](_0xb4f535(0x13c))||_0x41d796[_0xb4f535(0x14b)](_0xb4f535(0x12d));_0x44a6dd['isProVersion']&&_0x4e7680&&recordThermodynamics(_0x44a6dd,_0x7d85e5,_0x297ec8,_0x292b22[_0xb4f535(0x138)]);const _0x21a4b4={'timestamp':_0x44985c,'id':_0x7d85e5,'name':_0x292b22[_0xb4f535(0x12b)],'type':_0x292b22[_0xb4f535(0x131)],'location':_0x292b22['location'],'value':_0x297ec8};_0x44a6dd[_0xb4f535(0x12a)][_0xb4f535(0x108)](_0x21a4b4);if(_0x44a6dd[_0xb4f535(0x12a)][_0xb4f535(0x13b)]>HISTORY_MAX_SIZE)_0x44a6dd[_0xb4f535(0x12a)][_0xb4f535(0x143)]();await _0x44a6dd['setStateAsync']('events.lastEvent',{'val':JSON[_0xb4f535(0x139)](_0x21a4b4),'ack':!![]}),await _0x44a6dd['setStateAsync'](_0xb4f535(0x12f),{'val':JSON[_0xb4f535(0x139)](_0x44a6dd[_0xb4f535(0x12a)]),'ack':!![]});if(_0x44a6dd['isProVersion']){_0x44a6dd[_0xb4f535(0x13e)][_0xb4f535(0x116)](_0x21a4b4);if(_0x44a6dd[_0xb4f535(0x13e)][_0xb4f535(0x13b)]>RAW_LOG_MAX_SIZE)_0x44a6dd[_0xb4f535(0x13e)]['splice'](0x0,_0x44a6dd['rawEventLog'][_0xb4f535(0x13b)]-RAW_LOG_MAX_SIZE);await _0x44a6dd[_0xb4f535(0x125)]('LTM.rawEventLog',{'val':JSON[_0xb4f535(0x139)](_0x44a6dd[_0xb4f535(0x13e)]),'ack':!![]}),recordSequence(_0x44a6dd,_0x21a4b4);}if(_0x292b22[_0xb4f535(0x137)]&&_0x297ec8===!![]){if(_0x44a6dd[_0xb4f535(0x157)]&&!_0x44a6dd[_0xb4f535(0x10c)])startExitTimer(_0x44a6dd);else{if(!_0x44a6dd[_0xb4f535(0x157)])setPresence(_0x44a6dd,!![]);}}else{if(_0x292b22[_0xb4f535(0x131)]===_0xb4f535(0x153)&&_0x297ec8===!![]){if(_0x44a6dd[_0xb4f535(0x10e)])abortExitTimer(_0x44a6dd);if(!_0x44a6dd[_0xb4f535(0x157)]&&_0x44a6dd['currentSystemMode']===_0xb4f535(0x134))setPresence(_0x44a6dd,!![]);}}return _0x44a6dd[_0xb4f535(0x150)]&&_0x292b22[_0xb4f535(0x131)]===_0xb4f535(0x153)&&_0x297ec8===!![]&&_0x292b22[_0xb4f535(0x138)]&&_0x44a6dd[_0xb4f535(0x11d)]&&_0x44a6dd[_0xb4f535(0x11d)]('SIMULATE_SIGNAL',{'room':_0x292b22[_0xb4f535(0x138)]}),_0x21a4b4;}function a5_0x2eef(_0x4fa64d,_0x4b0bc6){const _0xd690a5=a5_0x3c97();return a5_0x2eef=function(_0x293006,_0x20ca39){_0x293006=_0x293006-0x108;let _0x3c9759=_0xd690a5[_0x293006];return _0x3c9759;},a5_0x2eef(_0x4fa64d,_0x4b0bc6);}module['exports']={'processSensorEvent':processSensorEvent,'getOutsideTemperatureNumeric':getOutsideTemperatureNumeric,'setPresence':setPresence,'abortExitTimer':abortExitTimer,'startExitTimer':startExitTimer};