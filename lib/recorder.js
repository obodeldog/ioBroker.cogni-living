(function(_0x19b57c,_0x19f657){const _0x2aa190=a5_0x4aab,_0x5bb2e9=_0x19b57c();while(!![]){try{const _0x5790c3=parseInt(_0x2aa190(0x1ef))/0x1+-parseInt(_0x2aa190(0x1c8))/0x2+parseInt(_0x2aa190(0x204))/0x3*(parseInt(_0x2aa190(0x1e7))/0x4)+parseInt(_0x2aa190(0x1d1))/0x5*(-parseInt(_0x2aa190(0x1c9))/0x6)+parseInt(_0x2aa190(0x1ca))/0x7*(-parseInt(_0x2aa190(0x20a))/0x8)+-parseInt(_0x2aa190(0x20c))/0x9*(-parseInt(_0x2aa190(0x1f4))/0xa)+parseInt(_0x2aa190(0x1c5))/0xb*(parseInt(_0x2aa190(0x1b3))/0xc);if(_0x5790c3===_0x19f657)break;else _0x5bb2e9['push'](_0x5bb2e9['shift']());}catch(_0x1089dd){_0x5bb2e9['push'](_0x5bb2e9['shift']());}}}(a5_0x5bae,0x410f7));const a5_0x1a9f6c=(function(){let _0x2ce516=!![];return function(_0x1de3b7,_0x111233){const _0x496cb6=_0x2ce516?function(){if(_0x111233){const _0x1d0ce8=_0x111233['apply'](_0x1de3b7,arguments);return _0x111233=null,_0x1d0ce8;}}:function(){};return _0x2ce516=![],_0x496cb6;};}()),a5_0xe08dd6=a5_0x1a9f6c(this,function(){const _0x4139c1=a5_0x4aab;return a5_0xe08dd6[_0x4139c1(0x1be)]()[_0x4139c1(0x1fd)]('(((.+)+)+)+$')[_0x4139c1(0x1be)]()[_0x4139c1(0x1ad)](a5_0xe08dd6)[_0x4139c1(0x1fd)](_0x4139c1(0x202));});a5_0xe08dd6();'use strict';const HISTORY_MAX_SIZE=0x32,RAW_LOG_MAX_SIZE=0x9c4,THERMO_LOG_SIZE=0x3e8,SEQUENCE_TIMEOUT_MS=0x5*0x3c*0x3e8,MAX_TRAINING_SET_SIZE=0x1f4,EXIT_TIMER_MINUTES=0xf,EXIT_GRACE_PERIOD_SECONDS=0x1e;let activeSequence=[],sequenceTimer=null;async function getOutsideTemperatureNumeric(_0x28d31f){const _0x2da622=a5_0x4aab;if(_0x28d31f[_0x2da622(0x1c3)][_0x2da622(0x1c6)])try{const _0x5ab1cb=await _0x28d31f[_0x2da622(0x1f6)](_0x28d31f[_0x2da622(0x1c3)]['outdoorSensorId']);if(_0x5ab1cb&&_0x5ab1cb['val']!==undefined&&_0x5ab1cb[_0x2da622(0x1bf)]!==null)return parseFloat(_0x5ab1cb[_0x2da622(0x1bf)]);}catch(_0x4a3550){}const _0x2a32b2=_0x28d31f[_0x2da622(0x1c3)][_0x2da622(0x20d)];if(!_0x28d31f[_0x2da622(0x1c3)][_0x2da622(0x1a3)]||!_0x2a32b2)return null;try{let _0x1063f0='';if(_0x2a32b2[_0x2da622(0x1c7)](_0x2da622(0x1cc)))_0x1063f0=_0x2a32b2+_0x2da622(0x196);else{if(_0x2a32b2[_0x2da622(0x1c7)](_0x2da622(0x1ae)))_0x1063f0=_0x2a32b2+_0x2da622(0x1dc);else{if(_0x2a32b2['includes'](_0x2da622(0x19e)))_0x1063f0=_0x2a32b2+_0x2da622(0x1f9);else{if(_0x2a32b2['includes'](_0x2da622(0x1ab)))_0x1063f0=_0x2a32b2+_0x2da622(0x1a8);}}}if(_0x1063f0){const _0x4ec018=await _0x28d31f[_0x2da622(0x1f6)](_0x1063f0);if(_0x4ec018&&_0x4ec018['val']!==undefined&&_0x4ec018[_0x2da622(0x1bf)]!==null)return parseFloat(_0x4ec018[_0x2da622(0x1bf)]);}}catch(_0x2caca6){}return null;}async function recordThermodynamics(_0x3b3520,_0x226602,_0x52f801,_0x442365){const _0x1dbd8b=a5_0x4aab,_0xeb6ef2=await getOutsideTemperatureNumeric(_0x3b3520);if(_0xeb6ef2===null)return;let _0x382930=0x0,_0x15ef1e=![];if(_0x3b3520[_0x1dbd8b(0x1c3)][_0x1dbd8b(0x1d2)])try{let _0x33e2b8=_0x3b3520['config'][_0x1dbd8b(0x1d2)];if(typeof _0x33e2b8===_0x1dbd8b(0x1f8))_0x33e2b8=JSON[_0x1dbd8b(0x1c0)](_0x33e2b8);if(_0x33e2b8[_0x226602]){const _0x53c01d=_0x33e2b8[_0x226602],_0x1e3c65=await _0x3b3520[_0x1dbd8b(0x1f6)](_0x53c01d);if(_0x1e3c65&&_0x1e3c65[_0x1dbd8b(0x1bf)]!==null&&_0x1e3c65[_0x1dbd8b(0x1bf)]!==undefined){let _0x4cfb0b=Number(_0x1e3c65[_0x1dbd8b(0x1bf)]);if(_0x4cfb0b<=1.05&&!_0x53c01d[_0x1dbd8b(0x1c7)](_0x1dbd8b(0x1df))&&!_0x53c01d[_0x1dbd8b(0x1c7)](_0x1dbd8b(0x1f2)))_0x4cfb0b=_0x4cfb0b*0x64;_0x382930=Math[_0x1dbd8b(0x1b8)](_0x4cfb0b),_0x15ef1e=!![];}}}catch(_0x476b6b){}if(!_0x15ef1e){const _0x4e1c69=[{'from':_0x1dbd8b(0x1e4),'to':_0x1dbd8b(0x20b)},{'from':_0x1dbd8b(0x1e4),'to':_0x1dbd8b(0x1d4)},{'from':'.1.TEMPERATURE','to':_0x1dbd8b(0x1fe)},{'from':_0x1dbd8b(0x1ba),'to':_0x1dbd8b(0x1ee)},{'from':_0x1dbd8b(0x1e1),'to':_0x1dbd8b(0x1cd)},{'from':_0x1dbd8b(0x1b2),'to':_0x1dbd8b(0x207)}];for(const _0x3e5d88 of _0x4e1c69){if(_0x226602[_0x1dbd8b(0x1c7)](_0x3e5d88[_0x1dbd8b(0x1a0)])){const _0x4320e4=_0x226602['replace'](_0x3e5d88[_0x1dbd8b(0x1a0)],_0x3e5d88['to']);try{const _0x5ad557=await _0x3b3520['getForeignStateAsync'](_0x4320e4);if(_0x5ad557&&_0x5ad557['val']!==null&&_0x5ad557['val']!==undefined){let _0x90aa4f=Number(_0x5ad557[_0x1dbd8b(0x1bf)]);if(typeof _0x90aa4f==='number'){if(_0x90aa4f<=1.05&&_0x3e5d88['to'][_0x1dbd8b(0x1c7)]('LEVEL'))_0x90aa4f=_0x90aa4f*0x64;_0x382930=Math[_0x1dbd8b(0x1b8)](_0x90aa4f),_0x15ef1e=!![];break;}}}catch(_0xc768a5){}}}}const _0x28587a=await _0x3b3520['getStateAsync']('LTM.trainingData.thermodynamics');let _0x5d2952=[];if(_0x28587a&&_0x28587a[_0x1dbd8b(0x1bf)])try{_0x5d2952=JSON[_0x1dbd8b(0x1c0)](_0x28587a['val']);}catch(_0x52618){}_0x5d2952[_0x1dbd8b(0x1e5)]({'ts':Date['now'](),'room':_0x442365||'Unknown','t_in':_0x52f801,'t_out':_0xeb6ef2,'valve':_0x382930});if(_0x5d2952['length']>THERMO_LOG_SIZE)_0x5d2952[_0x1dbd8b(0x1bd)]();await _0x3b3520['setStateAsync'](_0x1dbd8b(0x1f5),{'val':JSON['stringify'](_0x5d2952),'ack':!![]});}async function saveCompletedSequence(_0x38d216){const _0x3c9ebd=a5_0x4aab;try{const _0x381a8=await _0x38d216['getStateAsync'](_0x3c9ebd(0x208));let _0x1b11aa=[];if(_0x381a8&&_0x381a8['val'])try{_0x1b11aa=JSON[_0x3c9ebd(0x1c0)](_0x381a8['val']);}catch(_0x53f202){}const _0x528aaf=activeSequence[0x0]['ts'],_0xf0b91b=activeSequence[_0x3c9ebd(0x1d7)](_0x178e90=>({'loc':_0x178e90[_0x3c9ebd(0x1ea)],'t_delta':Math[_0x3c9ebd(0x1b8)]((_0x178e90['ts']-_0x528aaf)/0x3e8)})),_0x2758e6={'timestamp':new Date(_0x528aaf)[_0x3c9ebd(0x1fc)](),'steps':_0xf0b91b,'duration':Math[_0x3c9ebd(0x1b8)]((activeSequence[activeSequence[_0x3c9ebd(0x206)]-0x1]['ts']-_0x528aaf)/0x3e8),'daytime':new Date(_0x528aaf)['getHours']()};_0x1b11aa[_0x3c9ebd(0x1e5)](_0x2758e6);if(_0x1b11aa[_0x3c9ebd(0x206)]>MAX_TRAINING_SET_SIZE)_0x1b11aa[_0x3c9ebd(0x1bd)]();await _0x38d216['setStateAsync']('LTM.trainingData.sequences',{'val':JSON['stringify'](_0x1b11aa),'ack':!![]}),_0x38d216[_0x3c9ebd(0x1b1)]&&_0x38d216['sendToPythonWrapper']&&_0x38d216[_0x3c9ebd(0x1dd)](_0x3c9ebd(0x1a1),{'sequence':_0x2758e6});}catch(_0x2eabe9){_0x38d216[_0x3c9ebd(0x19c)][_0x3c9ebd(0x1b9)](_0x3c9ebd(0x1e9)+_0x2eabe9[_0x3c9ebd(0x1fa)]);}}async function recordSequence(_0x4027af,_0x4db68b){const _0x540fc8=a5_0x4aab,_0x5652b3=(_0x4db68b[_0x540fc8(0x1c4)]||'')['toLowerCase'](),_0x5ae9c9=[_0x540fc8(0x197),_0x540fc8(0x1b0),_0x540fc8(0x1b7),_0x540fc8(0x1a9),_0x540fc8(0x195),_0x540fc8(0x1d5),_0x540fc8(0x19d),_0x540fc8(0x19b),_0x540fc8(0x19a),_0x540fc8(0x1cf),_0x540fc8(0x19f),_0x540fc8(0x1a2),_0x540fc8(0x1b4),_0x540fc8(0x1ac),_0x540fc8(0x1f7),_0x540fc8(0x200),_0x540fc8(0x1db)];if(!_0x5ae9c9[_0x540fc8(0x198)](_0x10a877=>_0x5652b3[_0x540fc8(0x1c7)](_0x10a877)))return;if(!_0x4db68b[_0x540fc8(0x1a4)])return;if(sequenceTimer)clearTimeout(sequenceTimer);activeSequence[_0x540fc8(0x1e5)]({'loc':_0x4db68b[_0x540fc8(0x1a6)]||'Unknown','id':_0x4db68b['id'],'ts':Date[_0x540fc8(0x1e3)]()}),sequenceTimer=setTimeout(async()=>{if(activeSequence['length']>0x1)await saveCompletedSequence(_0x4027af);activeSequence=[];},SEQUENCE_TIMEOUT_MS);}function startExitTimer(_0x1eb2b5){const _0x112eb9=a5_0x4aab;abortExitTimer(_0x1eb2b5),_0x1eb2b5[_0x112eb9(0x1bb)]=!![],_0x1eb2b5[_0x112eb9(0x1f1)]=setTimeout(()=>{const _0x4cb5da=_0x112eb9;_0x1eb2b5[_0x4cb5da(0x1bb)]=![];},EXIT_GRACE_PERIOD_SECONDS*0x3e8),_0x1eb2b5[_0x112eb9(0x1c1)]=setTimeout(()=>{setPresence(_0x1eb2b5,![]),_0x1eb2b5['exitTimer']=null;},EXIT_TIMER_MINUTES*0x3c*0x3e8);}function abortExitTimer(_0x47cded){const _0x4e1d26=a5_0x4aab;if(_0x47cded['exitTimer'])clearTimeout(_0x47cded[_0x4e1d26(0x1c1)]);if(_0x47cded[_0x4e1d26(0x1f1)])clearTimeout(_0x47cded['exitGraceTimer']);_0x47cded['exitTimer']=null,_0x47cded[_0x4e1d26(0x1f1)]=null,_0x47cded[_0x4e1d26(0x1bb)]=![];}function a5_0x4aab(_0x4bb3e3,_0x240e7e){const _0x1c6f3a=a5_0x5bae();return a5_0x4aab=function(_0xe08dd6,_0x1a9f6c){_0xe08dd6=_0xe08dd6-0x195;let _0x5bae69=_0x1c6f3a[_0xe08dd6];return _0x5bae69;},a5_0x4aab(_0x4bb3e3,_0x240e7e);}async function setPresence(_0x25a336,_0x44b30e){const _0x556a49=a5_0x4aab;if(_0x25a336[_0x556a49(0x1af)]===_0x44b30e)return;_0x25a336['isPresent']=_0x44b30e,await _0x25a336[_0x556a49(0x1bc)](_0x556a49(0x1d9),{'val':_0x44b30e,'ack':!![]});}function a5_0x5bae(){const _0x42a676=['search','.4.VALVE_STATE','lastTrackerEventTime','dimmer','debug','(((.+)+)+)+$','schloss','6uIiSSW','stringify','length','Valve','LTM.trainingData.sequences','getDate','1293304GaVtGR','.1.LEVEL','108EeGVNg','weatherInstance','logDuplicates','occupancy','.Current.Temperature','motion','some','lock','fenster','window','log','tür','openweathermap','kontakt','from','ANALYZE_SEQUENCE','light','useWeather','value','handle','location','analysis.health.todayVector','.forecast.current.temp','presence','pop','weatherunderground','switch','constructor','daswetter','isPresent','bewegung','isProVersion','Temperature','39732OEAGCN','licht','getHours','heizung','präsenz','round','error','.ACTUAL_TEMPERATURE','isGracePeriodActive','setStateAsync','shift','toString','val','parse','exitTimer','SIMULATE_SIGNAL','config','type','165iUuXMZ','outdoorSensorId','includes','107892vmPBSL','30WWPPdp','14DzTHjd','normal','accuweather','level','getStateAsync','contact','events.history','278795aZmFbu','valveMapping','griff','.1.VALVE_STATE','door','rawEventLog','map','sensorLastValues','system.isPresent','temperatur','lampe','.NextHours.Location_1.Day_1.current.temp_value','sendToPythonWrapper','toLowerCase','STATUS','splice','temperature','number','now','.1.ACTUAL_TEMPERATURE','push','thermostat','681076udjdNc','klima','[RECORDER]\x20Error:\x20','loc','name','LTM.rawEventLog','fill','.LEVEL','459079lSCsRT','eventHistory','exitGraceTimer','STATE','unshift','61060SPkYiK','LTM.trainingData.thermodynamics','getForeignStateAsync','schalter','string','.forecast.current.temperature','message','\x20from\x20','toISOString'];a5_0x5bae=function(){return _0x42a676;};return a5_0x5bae();}async function updateHourlyActivity(_0x5e2e4e){const _0x4fcf44=a5_0x4aab;let _0x1e61e9=new Array(0x18)[_0x4fcf44(0x1ed)](0x0),_0x5718b6=0x0;try{const _0x90f854=await _0x5e2e4e[_0x4fcf44(0x1ce)]('analysis.health.todayVector');_0x90f854&&_0x90f854[_0x4fcf44(0x1bf)]&&(_0x1e61e9=JSON[_0x4fcf44(0x1c0)](_0x90f854['val']),_0x5718b6=_0x90f854['ts']);}catch(_0x5bcbe2){}const _0x114bcc=new Date(_0x5718b6),_0x574bd7=new Date();_0x114bcc[_0x4fcf44(0x209)]()!==_0x574bd7[_0x4fcf44(0x209)]()&&(_0x1e61e9=new Array(0x18)['fill'](0x0));const _0x2fe6a6=_0x574bd7[_0x4fcf44(0x1b5)]();if(_0x1e61e9[_0x2fe6a6]===undefined)_0x1e61e9[_0x2fe6a6]=0x0;_0x1e61e9[_0x2fe6a6]++,await _0x5e2e4e[_0x4fcf44(0x1bc)](_0x4fcf44(0x1a7),{'val':JSON[_0x4fcf44(0x205)](_0x1e61e9),'ack':!![]});}async function processSensorEvent(_0x448044,_0x52569c,_0xebaa2c,_0x18e113){const _0x1fcf20=a5_0x4aab;if(!_0x18e113)return null;const _0x537f51=_0xebaa2c[_0x1fcf20(0x1bf)],_0x4fc317=Date[_0x1fcf20(0x1e3)](),_0x235954=_0x448044[_0x1fcf20(0x1d8)][_0x52569c],_0x5da217=(_0x18e113['type']||'')[_0x1fcf20(0x1de)](),_0x492922=_0x5da217[_0x1fcf20(0x1c7)](_0x1fcf20(0x1e1))||_0x5da217['includes'](_0x1fcf20(0x1da))||_0x5da217[_0x1fcf20(0x1c7)](_0x1fcf20(0x1e8))||_0x5da217[_0x1fcf20(0x1c7)](_0x1fcf20(0x1b6))||_0x5da217[_0x1fcf20(0x1c7)](_0x1fcf20(0x1e6));if(_0x492922&&typeof _0x537f51===_0x1fcf20(0x1e2)){if(_0x537f51>0x50||_0x537f51<-0x32)return _0x448044[_0x1fcf20(0x19c)][_0x1fcf20(0x201)]('[RECORDER]\x20Ignored\x20implausible\x20temperature:\x20'+_0x537f51+_0x1fcf20(0x1fb)+_0x52569c),null;}_0x448044['sensorLastValues'][_0x52569c]=_0x537f51;if(!_0x18e113[_0x1fcf20(0x20e)]&&_0x235954!=undefined&&_0x235954==_0x537f51)return null;_0x448044[_0x1fcf20(0x1b1)]&&_0x492922&&recordThermodynamics(_0x448044,_0x52569c,_0x537f51,_0x18e113[_0x1fcf20(0x1a6)]);const _0x562506={'timestamp':_0x4fc317,'id':_0x52569c,'name':_0x18e113[_0x1fcf20(0x1eb)],'type':_0x18e113['type'],'location':_0x18e113[_0x1fcf20(0x1a6)],'value':_0x537f51};_0x448044['eventHistory'][_0x1fcf20(0x1f3)](_0x562506);if(_0x448044[_0x1fcf20(0x1f0)][_0x1fcf20(0x206)]>HISTORY_MAX_SIZE)_0x448044[_0x1fcf20(0x1f0)][_0x1fcf20(0x1aa)]();await _0x448044[_0x1fcf20(0x1bc)]('events.lastEvent',{'val':JSON[_0x1fcf20(0x205)](_0x562506),'ack':!![]}),await _0x448044[_0x1fcf20(0x1bc)](_0x1fcf20(0x1d0),{'val':JSON[_0x1fcf20(0x205)](_0x448044['eventHistory']),'ack':!![]}),await updateHourlyActivity(_0x448044);if(_0x448044[_0x1fcf20(0x1b1)]){_0x448044['rawEventLog'][_0x1fcf20(0x1e5)](_0x562506);if(_0x448044[_0x1fcf20(0x1d6)]['length']>RAW_LOG_MAX_SIZE)_0x448044[_0x1fcf20(0x1d6)][_0x1fcf20(0x1e0)](0x0,_0x448044['rawEventLog']['length']-RAW_LOG_MAX_SIZE);await _0x448044[_0x1fcf20(0x1bc)](_0x1fcf20(0x1ec),{'val':JSON['stringify'](_0x448044[_0x1fcf20(0x1d6)]),'ack':!![]}),recordSequence(_0x448044,_0x562506);}if(_0x18e113['isExit']&&_0x537f51===!![]){if(_0x448044[_0x1fcf20(0x1af)]&&!_0x448044[_0x1fcf20(0x1bb)])startExitTimer(_0x448044);else{if(!_0x448044[_0x1fcf20(0x1af)])setPresence(_0x448044,!![]);}}else{if(_0x18e113['type']===_0x1fcf20(0x197)&&_0x537f51===!![]){if(_0x448044['exitTimer'])abortExitTimer(_0x448044);if(!_0x448044[_0x1fcf20(0x1af)]&&_0x448044['currentSystemMode']===_0x1fcf20(0x1cb))setPresence(_0x448044,!![]);}}if(_0x448044[_0x1fcf20(0x1b1)]&&_0x448044[_0x1fcf20(0x1dd)]){_0x18e113['type']==='motion'&&_0x537f51===!![]&&_0x18e113[_0x1fcf20(0x1a6)]&&_0x448044['sendToPythonWrapper'](_0x1fcf20(0x1c2),{'room':_0x18e113[_0x1fcf20(0x1a6)]});const _0x48cb93=[_0x1fcf20(0x1d5),_0x1fcf20(0x19d),_0x1fcf20(0x19b),_0x1fcf20(0x19a),_0x1fcf20(0x1d3),_0x1fcf20(0x1a5),_0x1fcf20(0x199),_0x1fcf20(0x203)]['some'](_0x45bea3=>_0x5da217[_0x1fcf20(0x1c7)](_0x45bea3)),_0xaea690=[_0x1fcf20(0x1a2),'licht',_0x1fcf20(0x1ac),_0x1fcf20(0x1f7),_0x1fcf20(0x200),_0x1fcf20(0x1db)][_0x1fcf20(0x198)](_0x3c9f8d=>_0x5da217[_0x1fcf20(0x1c7)](_0x3c9f8d)),_0x328388=[_0x1fcf20(0x197),_0x1fcf20(0x1b0),_0x1fcf20(0x1b7),_0x1fcf20(0x1a9),_0x1fcf20(0x195)][_0x1fcf20(0x198)](_0x31100a=>_0x5da217['includes'](_0x31100a));if(_0x18e113[_0x1fcf20(0x1a6)]&&(_0x48cb93||_0xaea690||_0x328388)){const _0x2920ab=_0x537f51===!![]||typeof _0x537f51===_0x1fcf20(0x1e2)&&_0x537f51>0x0,_0x17e3db=_0x48cb93&&!_0x2920ab&&_0x235954!==undefined&&_0x235954!=_0x537f51;if(_0x2920ab||_0x17e3db){const _0x4e9633=_0x448044[_0x1fcf20(0x1ff)]||_0x4fc317,_0x4e3239=(_0x4fc317-_0x4e9633)/0x3e8;_0x448044[_0x1fcf20(0x1ff)]=_0x4fc317,_0x448044[_0x1fcf20(0x1dd)]('TRACK_EVENT',{'room':_0x18e113[_0x1fcf20(0x1a6)],'dt':_0x4e3239});}}}return _0x562506;}module['exports']={'processSensorEvent':processSensorEvent,'getOutsideTemperatureNumeric':getOutsideTemperatureNumeric,'setPresence':setPresence,'abortExitTimer':abortExitTimer,'startExitTimer':startExitTimer};