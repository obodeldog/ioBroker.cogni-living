const a5_0x4efb7e=a5_0x1103;(function(_0x5b1516,_0x47357f){const _0x2dcbba=a5_0x1103,_0x534070=_0x5b1516();while(!![]){try{const _0x1838e2=parseInt(_0x2dcbba(0x75))/0x1+parseInt(_0x2dcbba(0xa1))/0x2*(parseInt(_0x2dcbba(0x89))/0x3)+parseInt(_0x2dcbba(0x96))/0x4+parseInt(_0x2dcbba(0xb1))/0x5+parseInt(_0x2dcbba(0x9e))/0x6+parseInt(_0x2dcbba(0xb8))/0x7*(parseInt(_0x2dcbba(0xa5))/0x8)+parseInt(_0x2dcbba(0xb0))/0x9*(-parseInt(_0x2dcbba(0xad))/0xa);if(_0x1838e2===_0x47357f)break;else _0x534070['push'](_0x534070['shift']());}catch(_0x102c4b){_0x534070['push'](_0x534070['shift']());}}}(a5_0x1582,0x859d2));const a5_0x4e58b0=(function(){let _0x27b724=!![];return function(_0xa99411,_0x21aa79){const _0x3ef450=_0x27b724?function(){const _0x34c876=a5_0x1103;if(_0x21aa79){const _0x173f8f=_0x21aa79[_0x34c876(0x84)](_0xa99411,arguments);return _0x21aa79=null,_0x173f8f;}}:function(){};return _0x27b724=![],_0x3ef450;};}()),a5_0x30fd1a=a5_0x4e58b0(this,function(){const _0x2d3f37=a5_0x1103;return a5_0x30fd1a[_0x2d3f37(0x7e)]()[_0x2d3f37(0xba)](_0x2d3f37(0xa4))[_0x2d3f37(0x7e)]()['constructor'](a5_0x30fd1a)[_0x2d3f37(0xba)]('(((.+)+)+)+$');});a5_0x30fd1a();'use strict';function a5_0x1582(){const _0x46d7a6=['fenster','currentSystemMode','exitGraceTimer','stringify','28970JDDJlu','sensorLastValues','[RECORDER]\x20Error:\x20','4383KkOqMq','881900Ehpfda','light','.ACTUAL_TEMPERATURE','string','eventHistory','lock','TRACK_EVENT','7SrFkFn','präsenz','search','rawEventLog','.1.ACTUAL_TEMPERATURE','setStateAsync','.forecast.current.temp','temperature','weatherunderground','parse','.LEVEL','.1.LEVEL','lastTrackerEventTime','now','round','STATE','.NextHours.Location_1.Day_1.current.temp_value','Valve','LTM.trainingData.thermodynamics','error','daswetter','dimmer','temperatur','isExit','sendToPythonWrapper','log','config','valveMapping','klima','map','switch','Temperature','debug','tür','system.isPresent','Unknown','motion','heizung','door','exports','LTM.rawEventLog','unshift','.1.TEMPERATURE','971498hCYCpq','exitTimer','schalter','length','lampe','.Current.Temperature','[RECORDER]\x20Ignored\x20implausible\x20temperature:\x20','getForeignStateAsync','number','toString','accuweather','includes','name','window','message','apply','splice','toISOString','level','normal','426qvyhDh','isGracePeriodActive','isProVersion','isPresent','logDuplicates','griff','val','toLowerCase','LEVEL','bewegung','shift','.forecast.current.temperature','schloss','495732iKbPUl','openweathermap','type','presence','location','loc','.4.VALVE_STATE','contact','21708MpOUtT','getStateAsync','some','2774wIlJEu','LTM.trainingData.sequences','outdoorSensorId','(((.+)+)+)+$','3885904iJxVqw','\x20from\x20','push','occupancy'];a5_0x1582=function(){return _0x46d7a6;};return a5_0x1582();}const HISTORY_MAX_SIZE=0x32,RAW_LOG_MAX_SIZE=0x9c4,THERMO_LOG_SIZE=0x3e8,SEQUENCE_TIMEOUT_MS=0x5*0x3c*0x3e8,MAX_TRAINING_SET_SIZE=0x1f4,EXIT_TIMER_MINUTES=0xf,EXIT_GRACE_PERIOD_SECONDS=0x1e;let activeSequence=[],sequenceTimer=null;async function getOutsideTemperatureNumeric(_0x3b33c5){const _0x4ab7c5=a5_0x1103;if(_0x3b33c5['config'][_0x4ab7c5(0xa3)])try{const _0x375bd0=await _0x3b33c5[_0x4ab7c5(0x7c)](_0x3b33c5[_0x4ab7c5(0xd2)][_0x4ab7c5(0xa3)]);if(_0x375bd0&&_0x375bd0[_0x4ab7c5(0x8f)]!==undefined&&_0x375bd0['val']!==null)return parseFloat(_0x375bd0[_0x4ab7c5(0x8f)]);}catch(_0x2ac4e7){}const _0x1ec69d=_0x3b33c5[_0x4ab7c5(0xd2)]['weatherInstance'];if(!_0x3b33c5[_0x4ab7c5(0xd2)]['useWeather']||!_0x1ec69d)return null;try{let _0x34aaef='';if(_0x1ec69d[_0x4ab7c5(0x80)](_0x4ab7c5(0x7f)))_0x34aaef=_0x1ec69d+_0x4ab7c5(0x7a);else{if(_0x1ec69d['includes'](_0x4ab7c5(0xcc)))_0x34aaef=_0x1ec69d+_0x4ab7c5(0xc8);else{if(_0x1ec69d[_0x4ab7c5(0x80)](_0x4ab7c5(0x97)))_0x34aaef=_0x1ec69d+_0x4ab7c5(0x94);else{if(_0x1ec69d[_0x4ab7c5(0x80)](_0x4ab7c5(0xc0)))_0x34aaef=_0x1ec69d+_0x4ab7c5(0xbe);}}}if(_0x34aaef){const _0x23fc95=await _0x3b33c5[_0x4ab7c5(0x7c)](_0x34aaef);if(_0x23fc95&&_0x23fc95[_0x4ab7c5(0x8f)]!==undefined&&_0x23fc95[_0x4ab7c5(0x8f)]!==null)return parseFloat(_0x23fc95[_0x4ab7c5(0x8f)]);}}catch(_0x54f503){}return null;}function a5_0x1103(_0x5e0497,_0x490a6e){const _0x5dffdf=a5_0x1582();return a5_0x1103=function(_0x30fd1a,_0x4e58b0){_0x30fd1a=_0x30fd1a-0x6a;let _0x15821b=_0x5dffdf[_0x30fd1a];return _0x15821b;},a5_0x1103(_0x5e0497,_0x490a6e);}async function recordThermodynamics(_0x113f19,_0x2638d8,_0x484c1a,_0x4dc54f){const _0xd5ca6a=a5_0x1103,_0x3b224b=await getOutsideTemperatureNumeric(_0x113f19);if(_0x3b224b===null)return;let _0x367b27=0x0,_0x13702c=![];if(_0x113f19[_0xd5ca6a(0xd2)][_0xd5ca6a(0xd3)])try{let _0x5280c7=_0x113f19[_0xd5ca6a(0xd2)][_0xd5ca6a(0xd3)];if(typeof _0x5280c7===_0xd5ca6a(0xb4))_0x5280c7=JSON['parse'](_0x5280c7);if(_0x5280c7[_0x2638d8]){const _0x47bf87=_0x5280c7[_0x2638d8],_0x190966=await _0x113f19['getForeignStateAsync'](_0x47bf87);if(_0x190966&&_0x190966[_0xd5ca6a(0x8f)]!==null&&_0x190966[_0xd5ca6a(0x8f)]!==undefined){let _0x39ffe0=Number(_0x190966[_0xd5ca6a(0x8f)]);if(_0x39ffe0<=1.05&&!_0x47bf87[_0xd5ca6a(0x80)]('STATUS')&&!_0x47bf87[_0xd5ca6a(0x80)](_0xd5ca6a(0xc7)))_0x39ffe0=_0x39ffe0*0x64;_0x367b27=Math[_0xd5ca6a(0xc6)](_0x39ffe0),_0x13702c=!![];}}}catch(_0x385ae8){}if(!_0x13702c){const _0x544c96=[{'from':_0xd5ca6a(0xbc),'to':_0xd5ca6a(0xc3)},{'from':'.1.ACTUAL_TEMPERATURE','to':'.1.VALVE_STATE'},{'from':_0xd5ca6a(0x74),'to':_0xd5ca6a(0x9c)},{'from':_0xd5ca6a(0xb3),'to':_0xd5ca6a(0xc2)},{'from':_0xd5ca6a(0xbf),'to':_0xd5ca6a(0x87)},{'from':_0xd5ca6a(0xd7),'to':_0xd5ca6a(0xc9)}];for(const _0x449d0e of _0x544c96){if(_0x2638d8[_0xd5ca6a(0x80)](_0x449d0e['from'])){const _0x1d32cf=_0x2638d8['replace'](_0x449d0e['from'],_0x449d0e['to']);try{const _0x211f63=await _0x113f19['getForeignStateAsync'](_0x1d32cf);if(_0x211f63&&_0x211f63[_0xd5ca6a(0x8f)]!==null&&_0x211f63[_0xd5ca6a(0x8f)]!==undefined){let _0x30307d=Number(_0x211f63[_0xd5ca6a(0x8f)]);if(typeof _0x30307d===_0xd5ca6a(0x7d)){if(_0x30307d<=1.05&&_0x449d0e['to']['includes'](_0xd5ca6a(0x91)))_0x30307d=_0x30307d*0x64;_0x367b27=Math[_0xd5ca6a(0xc6)](_0x30307d),_0x13702c=!![];break;}}}catch(_0x290c3e){}}}}const _0x353b76=await _0x113f19['getStateAsync'](_0xd5ca6a(0xca));let _0x4f0695=[];if(_0x353b76&&_0x353b76[_0xd5ca6a(0x8f)])try{_0x4f0695=JSON[_0xd5ca6a(0xc1)](_0x353b76[_0xd5ca6a(0x8f)]);}catch(_0x1089d8){}_0x4f0695[_0xd5ca6a(0xa7)]({'ts':Date[_0xd5ca6a(0xc5)](),'room':_0x4dc54f||_0xd5ca6a(0x6d),'t_in':_0x484c1a,'t_out':_0x3b224b,'valve':_0x367b27});if(_0x4f0695[_0xd5ca6a(0x78)]>THERMO_LOG_SIZE)_0x4f0695[_0xd5ca6a(0x93)]();await _0x113f19['setStateAsync'](_0xd5ca6a(0xca),{'val':JSON[_0xd5ca6a(0xac)](_0x4f0695),'ack':!![]});}async function saveCompletedSequence(_0x395a24){const _0x49f9e1=a5_0x1103;try{const _0x500fa5=await _0x395a24[_0x49f9e1(0x9f)]('LTM.trainingData.sequences');let _0x9c6bf=[];if(_0x500fa5&&_0x500fa5[_0x49f9e1(0x8f)])try{_0x9c6bf=JSON[_0x49f9e1(0xc1)](_0x500fa5[_0x49f9e1(0x8f)]);}catch(_0xa6d447){}const _0x5e584a=activeSequence[0x0]['ts'],_0x5139cd=activeSequence[_0x49f9e1(0xd5)](_0xcb7457=>({'loc':_0xcb7457[_0x49f9e1(0x9b)],'t_delta':Math[_0x49f9e1(0xc6)]((_0xcb7457['ts']-_0x5e584a)/0x3e8)})),_0x3d4a6d={'timestamp':new Date(_0x5e584a)[_0x49f9e1(0x86)](),'steps':_0x5139cd,'duration':Math[_0x49f9e1(0xc6)]((activeSequence[activeSequence[_0x49f9e1(0x78)]-0x1]['ts']-_0x5e584a)/0x3e8),'daytime':new Date(_0x5e584a)['getHours']()};_0x9c6bf[_0x49f9e1(0xa7)](_0x3d4a6d);if(_0x9c6bf['length']>MAX_TRAINING_SET_SIZE)_0x9c6bf[_0x49f9e1(0x93)]();await _0x395a24[_0x49f9e1(0xbd)](_0x49f9e1(0xa2),{'val':JSON[_0x49f9e1(0xac)](_0x9c6bf),'ack':!![]}),_0x395a24[_0x49f9e1(0x8b)]&&_0x395a24[_0x49f9e1(0xd0)]&&_0x395a24[_0x49f9e1(0xd0)]('ANALYZE_SEQUENCE',{'sequence':_0x3d4a6d});}catch(_0x4ef8e7){_0x395a24[_0x49f9e1(0xd1)][_0x49f9e1(0xcb)](_0x49f9e1(0xaf)+_0x4ef8e7[_0x49f9e1(0x83)]);}}async function recordSequence(_0x592f76,_0x528921){const _0x222d77=a5_0x1103,_0x197257=(_0x528921[_0x222d77(0x98)]||'')[_0x222d77(0x90)](),_0x5371fe=[_0x222d77(0x6e),_0x222d77(0x92),_0x222d77(0xb9),_0x222d77(0x99),'occupancy',_0x222d77(0x70),_0x222d77(0x6b),_0x222d77(0x82),_0x222d77(0xa9),_0x222d77(0x9d),'kontakt',_0x222d77(0xb2),'licht',_0x222d77(0xd6),'schalter',_0x222d77(0xcd),_0x222d77(0x79)];if(!_0x5371fe['some'](_0xc6f688=>_0x197257['includes'](_0xc6f688)))return;if(!_0x528921['value'])return;if(sequenceTimer)clearTimeout(sequenceTimer);activeSequence[_0x222d77(0xa7)]({'loc':_0x528921[_0x222d77(0x9a)]||'Unknown','id':_0x528921['id'],'ts':Date['now']()}),sequenceTimer=setTimeout(async()=>{const _0x38ea17=_0x222d77;if(activeSequence[_0x38ea17(0x78)]>0x1)await saveCompletedSequence(_0x592f76);activeSequence=[];},SEQUENCE_TIMEOUT_MS);}function startExitTimer(_0x44a126){const _0x4d972d=a5_0x1103;abortExitTimer(_0x44a126),_0x44a126[_0x4d972d(0x8a)]=!![],_0x44a126[_0x4d972d(0xab)]=setTimeout(()=>{_0x44a126['isGracePeriodActive']=![];},EXIT_GRACE_PERIOD_SECONDS*0x3e8),_0x44a126['exitTimer']=setTimeout(()=>{const _0x326087=_0x4d972d;setPresence(_0x44a126,![]),_0x44a126[_0x326087(0x76)]=null;},EXIT_TIMER_MINUTES*0x3c*0x3e8);}function abortExitTimer(_0x349b84){const _0x1be3d5=a5_0x1103;if(_0x349b84[_0x1be3d5(0x76)])clearTimeout(_0x349b84['exitTimer']);if(_0x349b84[_0x1be3d5(0xab)])clearTimeout(_0x349b84[_0x1be3d5(0xab)]);_0x349b84[_0x1be3d5(0x76)]=null,_0x349b84[_0x1be3d5(0xab)]=null,_0x349b84[_0x1be3d5(0x8a)]=![];}async function setPresence(_0xedcf07,_0x5c8534){const _0x143c3a=a5_0x1103;if(_0xedcf07['isPresent']===_0x5c8534)return;_0xedcf07[_0x143c3a(0x8c)]=_0x5c8534,await _0xedcf07['setStateAsync'](_0x143c3a(0x6c),{'val':_0x5c8534,'ack':!![]});}async function processSensorEvent(_0x5dd713,_0xe3b10c,_0x1fc1f9,_0x32cbd6){const _0x59f001=a5_0x1103;if(!_0x32cbd6)return null;const _0x58ff27=_0x1fc1f9['val'],_0x1262ff=Date[_0x59f001(0xc5)](),_0x241f68=_0x5dd713['sensorLastValues'][_0xe3b10c],_0x978d97=(_0x32cbd6['type']||'')[_0x59f001(0x90)](),_0x2b94fd=_0x978d97[_0x59f001(0x80)]('temperature')||_0x978d97[_0x59f001(0x80)](_0x59f001(0xce))||_0x978d97[_0x59f001(0x80)](_0x59f001(0xd4))||_0x978d97['includes'](_0x59f001(0x6f))||_0x978d97[_0x59f001(0x80)]('thermostat');if(_0x2b94fd&&typeof _0x58ff27==='number'){if(_0x58ff27>0x50||_0x58ff27<-0x32)return _0x5dd713[_0x59f001(0xd1)][_0x59f001(0x6a)](_0x59f001(0x7b)+_0x58ff27+_0x59f001(0xa6)+_0xe3b10c),null;}_0x5dd713[_0x59f001(0xae)][_0xe3b10c]=_0x58ff27;if(!_0x32cbd6[_0x59f001(0x8d)]&&_0x241f68!=undefined&&_0x241f68==_0x58ff27)return null;_0x5dd713[_0x59f001(0x8b)]&&_0x2b94fd&&recordThermodynamics(_0x5dd713,_0xe3b10c,_0x58ff27,_0x32cbd6[_0x59f001(0x9a)]);const _0x260bd1={'timestamp':_0x1262ff,'id':_0xe3b10c,'name':_0x32cbd6[_0x59f001(0x81)],'type':_0x32cbd6[_0x59f001(0x98)],'location':_0x32cbd6[_0x59f001(0x9a)],'value':_0x58ff27};_0x5dd713['eventHistory'][_0x59f001(0x73)](_0x260bd1);if(_0x5dd713[_0x59f001(0xb5)][_0x59f001(0x78)]>HISTORY_MAX_SIZE)_0x5dd713['eventHistory']['pop']();await _0x5dd713[_0x59f001(0xbd)]('events.lastEvent',{'val':JSON[_0x59f001(0xac)](_0x260bd1),'ack':!![]}),await _0x5dd713[_0x59f001(0xbd)]('events.history',{'val':JSON[_0x59f001(0xac)](_0x5dd713[_0x59f001(0xb5)]),'ack':!![]});if(_0x5dd713[_0x59f001(0x8b)]){_0x5dd713['rawEventLog']['push'](_0x260bd1);if(_0x5dd713[_0x59f001(0xbb)][_0x59f001(0x78)]>RAW_LOG_MAX_SIZE)_0x5dd713[_0x59f001(0xbb)][_0x59f001(0x85)](0x0,_0x5dd713[_0x59f001(0xbb)][_0x59f001(0x78)]-RAW_LOG_MAX_SIZE);await _0x5dd713[_0x59f001(0xbd)](_0x59f001(0x72),{'val':JSON[_0x59f001(0xac)](_0x5dd713[_0x59f001(0xbb)]),'ack':!![]}),recordSequence(_0x5dd713,_0x260bd1);}if(_0x32cbd6[_0x59f001(0xcf)]&&_0x58ff27===!![]){if(_0x5dd713['isPresent']&&!_0x5dd713['isGracePeriodActive'])startExitTimer(_0x5dd713);else{if(!_0x5dd713[_0x59f001(0x8c)])setPresence(_0x5dd713,!![]);}}else{if(_0x32cbd6[_0x59f001(0x98)]===_0x59f001(0x6e)&&_0x58ff27===!![]){if(_0x5dd713[_0x59f001(0x76)])abortExitTimer(_0x5dd713);if(!_0x5dd713[_0x59f001(0x8c)]&&_0x5dd713[_0x59f001(0xaa)]===_0x59f001(0x88))setPresence(_0x5dd713,!![]);}}if(_0x5dd713[_0x59f001(0x8b)]&&_0x5dd713[_0x59f001(0xd0)]){_0x32cbd6['type']===_0x59f001(0x6e)&&_0x58ff27===!![]&&_0x32cbd6['location']&&_0x5dd713[_0x59f001(0xd0)]('SIMULATE_SIGNAL',{'room':_0x32cbd6[_0x59f001(0x9a)]});const _0xbcaf98=[_0x59f001(0x70),_0x59f001(0x6b),_0x59f001(0x82),_0x59f001(0xa9),_0x59f001(0x8e),'handle',_0x59f001(0xb6),_0x59f001(0x95)][_0x59f001(0xa0)](_0x149bb6=>_0x978d97[_0x59f001(0x80)](_0x149bb6)),_0x50e547=[_0x59f001(0xb2),'licht',_0x59f001(0xd6),_0x59f001(0x77),_0x59f001(0xcd),_0x59f001(0x79)][_0x59f001(0xa0)](_0x311a86=>_0x978d97[_0x59f001(0x80)](_0x311a86)),_0x57ea91=[_0x59f001(0x6e),_0x59f001(0x92),'präsenz','presence',_0x59f001(0xa8)][_0x59f001(0xa0)](_0x2faddc=>_0x978d97[_0x59f001(0x80)](_0x2faddc));if(_0x32cbd6[_0x59f001(0x9a)]&&(_0xbcaf98||_0x50e547||_0x57ea91)){const _0x29c0d7=_0x58ff27===!![]||typeof _0x58ff27===_0x59f001(0x7d)&&_0x58ff27>0x0,_0x2c967b=_0xbcaf98&&!_0x29c0d7&&_0x241f68!==undefined&&_0x241f68!=_0x58ff27;if(_0x29c0d7||_0x2c967b){const _0x145a95=_0x5dd713[_0x59f001(0xc4)]||_0x1262ff,_0x1c06c2=(_0x1262ff-_0x145a95)/0x3e8;_0x5dd713['lastTrackerEventTime']=_0x1262ff,_0x5dd713[_0x59f001(0xd0)](_0x59f001(0xb7),{'room':_0x32cbd6['location'],'dt':_0x1c06c2});}}}return _0x260bd1;}module[a5_0x4efb7e(0x71)]={'processSensorEvent':processSensorEvent,'getOutsideTemperatureNumeric':getOutsideTemperatureNumeric,'setPresence':setPresence,'abortExitTimer':abortExitTimer,'startExitTimer':startExitTimer};