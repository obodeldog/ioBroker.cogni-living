const a5_0x5d4690=a5_0x1640;(function(_0x29bc9c,_0x15ff14){const _0x4988ed=a5_0x1640,_0x180c48=_0x29bc9c();while(!![]){try{const _0xa8905e=-parseInt(_0x4988ed(0x21b))/0x1*(-parseInt(_0x4988ed(0x202))/0x2)+parseInt(_0x4988ed(0x1d5))/0x3+parseInt(_0x4988ed(0x1eb))/0x4*(-parseInt(_0x4988ed(0x1fa))/0x5)+-parseInt(_0x4988ed(0x1e7))/0x6*(-parseInt(_0x4988ed(0x21a))/0x7)+parseInt(_0x4988ed(0x1d7))/0x8+-parseInt(_0x4988ed(0x1e5))/0x9+-parseInt(_0x4988ed(0x22a))/0xa;if(_0xa8905e===_0x15ff14)break;else _0x180c48['push'](_0x180c48['shift']());}catch(_0x3889f7){_0x180c48['push'](_0x180c48['shift']());}}}(a5_0x2858,0x61f0e));const a5_0x3e2dff=(function(){let _0x3036a8=!![];return function(_0x455d5f,_0x3df5dc){const _0x5b5337=_0x3036a8?function(){const _0x19fffb=a5_0x1640;if(_0x3df5dc){const _0x4d25c0=_0x3df5dc[_0x19fffb(0x1ef)](_0x455d5f,arguments);return _0x3df5dc=null,_0x4d25c0;}}:function(){};return _0x3036a8=![],_0x5b5337;};}()),a5_0x37126d=a5_0x3e2dff(this,function(){const _0x5cc818=a5_0x1640;return a5_0x37126d[_0x5cc818(0x217)]()[_0x5cc818(0x22e)](_0x5cc818(0x20e))['toString']()['constructor'](a5_0x37126d)[_0x5cc818(0x22e)](_0x5cc818(0x20e));});a5_0x37126d();'use strict';const HISTORY_MAX_SIZE=0x32,RAW_LOG_MAX_SIZE=0x9c4,THERMO_LOG_SIZE=0x3e8,SEQUENCE_TIMEOUT_MS=0x5*0x3c*0x3e8,MAX_TRAINING_SET_SIZE=0x1f4,EXIT_TIMER_MINUTES=0xf,EXIT_GRACE_PERIOD_SECONDS=0x1e;let activeSequence=[],sequenceTimer=null;async function getOutsideTemperatureNumeric(_0x24fd1c){const _0x46d4cf=a5_0x1640;if(_0x24fd1c[_0x46d4cf(0x203)]['outdoorSensorId'])try{const _0x32026c=await _0x24fd1c[_0x46d4cf(0x206)](_0x24fd1c[_0x46d4cf(0x203)][_0x46d4cf(0x1ee)]);if(_0x32026c&&_0x32026c[_0x46d4cf(0x228)]!==undefined&&_0x32026c[_0x46d4cf(0x228)]!==null)return parseFloat(_0x32026c['val']);}catch(_0x318221){}const _0x527d0a=_0x24fd1c['config']['weatherInstance'];if(!_0x24fd1c['config'][_0x46d4cf(0x1fd)]||!_0x527d0a)return null;try{let _0x5e4d1d='';if(_0x527d0a[_0x46d4cf(0x235)](_0x46d4cf(0x20c)))_0x5e4d1d=_0x527d0a+_0x46d4cf(0x201);else{if(_0x527d0a[_0x46d4cf(0x235)](_0x46d4cf(0x1e6)))_0x5e4d1d=_0x527d0a+_0x46d4cf(0x23a);else{if(_0x527d0a[_0x46d4cf(0x235)]('openweathermap'))_0x5e4d1d=_0x527d0a+_0x46d4cf(0x237);else{if(_0x527d0a[_0x46d4cf(0x235)]('weatherunderground'))_0x5e4d1d=_0x527d0a+_0x46d4cf(0x1f9);}}}if(_0x5e4d1d){const _0x52ce5e=await _0x24fd1c['getForeignStateAsync'](_0x5e4d1d);if(_0x52ce5e&&_0x52ce5e[_0x46d4cf(0x228)]!==undefined&&_0x52ce5e['val']!==null)return parseFloat(_0x52ce5e[_0x46d4cf(0x228)]);}}catch(_0x55c2d2){}return null;}async function recordThermodynamics(_0x348f49,_0x4516a9,_0x1141c6,_0x1ae310){const _0x4c9299=a5_0x1640,_0x53e218=await getOutsideTemperatureNumeric(_0x348f49);if(_0x53e218===null)return;let _0xfd61fd=0x0,_0x1d818e=![];if(_0x348f49[_0x4c9299(0x203)][_0x4c9299(0x1d3)])try{let _0x378d2d=_0x348f49[_0x4c9299(0x203)]['valveMapping'];if(typeof _0x378d2d==='string')_0x378d2d=JSON['parse'](_0x378d2d);if(_0x378d2d[_0x4516a9]){const _0x1a1f76=_0x378d2d[_0x4516a9],_0x35ac44=await _0x348f49[_0x4c9299(0x206)](_0x1a1f76);if(_0x35ac44&&_0x35ac44[_0x4c9299(0x228)]!==null&&_0x35ac44[_0x4c9299(0x228)]!==undefined){let _0x16adb7=Number(_0x35ac44[_0x4c9299(0x228)]);if(_0x16adb7<=1.05&&!_0x1a1f76['includes'](_0x4c9299(0x21e))&&!_0x1a1f76[_0x4c9299(0x235)](_0x4c9299(0x1df)))_0x16adb7=_0x16adb7*0x64;_0xfd61fd=Math['round'](_0x16adb7),_0x1d818e=!![];}}}catch(_0x53b176){}if(!_0x1d818e){const _0x14465f=[{'from':_0x4c9299(0x1da),'to':_0x4c9299(0x212)},{'from':_0x4c9299(0x1da),'to':_0x4c9299(0x1f6)},{'from':_0x4c9299(0x1e4),'to':_0x4c9299(0x23c)},{'from':_0x4c9299(0x1db),'to':'.LEVEL'},{'from':_0x4c9299(0x213),'to':'level'},{'from':_0x4c9299(0x1de),'to':_0x4c9299(0x21d)}];for(const _0x486503 of _0x14465f){if(_0x4516a9[_0x4c9299(0x235)](_0x486503[_0x4c9299(0x214)])){const _0x56eb91=_0x4516a9[_0x4c9299(0x1dd)](_0x486503[_0x4c9299(0x214)],_0x486503['to']);try{const _0x3d4c12=await _0x348f49['getForeignStateAsync'](_0x56eb91);if(_0x3d4c12&&_0x3d4c12['val']!==null&&_0x3d4c12[_0x4c9299(0x228)]!==undefined){let _0x4b76bd=Number(_0x3d4c12[_0x4c9299(0x228)]);if(typeof _0x4b76bd===_0x4c9299(0x1f2)){if(_0x4b76bd<=1.05&&_0x486503['to']['includes'](_0x4c9299(0x221)))_0x4b76bd=_0x4b76bd*0x64;_0xfd61fd=Math[_0x4c9299(0x1f4)](_0x4b76bd),_0x1d818e=!![];break;}}}catch(_0x3ce5da){}}}}const _0x3f4b64=await _0x348f49[_0x4c9299(0x1ec)](_0x4c9299(0x224));let _0x2037b2=[];if(_0x3f4b64&&_0x3f4b64['val'])try{_0x2037b2=JSON[_0x4c9299(0x1e9)](_0x3f4b64['val']);}catch(_0x4593c7){}_0x2037b2['push']({'ts':Date[_0x4c9299(0x205)](),'room':_0x1ae310||_0x4c9299(0x23f),'t_in':_0x1141c6,'t_out':_0x53e218,'valve':_0xfd61fd});if(_0x2037b2[_0x4c9299(0x238)]>THERMO_LOG_SIZE)_0x2037b2['shift']();await _0x348f49[_0x4c9299(0x215)]('LTM.trainingData.thermodynamics',{'val':JSON['stringify'](_0x2037b2),'ack':!![]});}async function saveCompletedSequence(_0x2bfc34){const _0x45a524=a5_0x1640;try{const _0x2231ca=await _0x2bfc34['getStateAsync']('LTM.trainingData.sequences');let _0x59c056=[];if(_0x2231ca&&_0x2231ca[_0x45a524(0x228)])try{_0x59c056=JSON[_0x45a524(0x1e9)](_0x2231ca[_0x45a524(0x228)]);}catch(_0x448120){}const _0x5b7d0b=activeSequence[0x0]['ts'],_0x2aa141=activeSequence[_0x45a524(0x21f)](_0x5452fa=>({'loc':_0x5452fa[_0x45a524(0x1fb)],'t_delta':Math[_0x45a524(0x1f4)]((_0x5452fa['ts']-_0x5b7d0b)/0x3e8)})),_0x33917c={'timestamp':new Date(_0x5b7d0b)[_0x45a524(0x22d)](),'steps':_0x2aa141,'duration':Math[_0x45a524(0x1f4)]((activeSequence[activeSequence[_0x45a524(0x238)]-0x1]['ts']-_0x5b7d0b)/0x3e8),'daytime':new Date(_0x5b7d0b)[_0x45a524(0x208)]()};_0x59c056[_0x45a524(0x236)](_0x33917c);if(_0x59c056[_0x45a524(0x238)]>MAX_TRAINING_SET_SIZE)_0x59c056['shift']();await _0x2bfc34['setStateAsync'](_0x45a524(0x1fe),{'val':JSON[_0x45a524(0x23e)](_0x59c056),'ack':!![]}),_0x2bfc34[_0x45a524(0x207)]&&_0x2bfc34[_0x45a524(0x1d6)]&&_0x2bfc34[_0x45a524(0x1d6)]('ANALYZE_SEQUENCE',{'sequence':_0x33917c});}catch(_0x53d034){_0x2bfc34[_0x45a524(0x22f)][_0x45a524(0x239)](_0x45a524(0x222)+_0x53d034['message']);}}function a5_0x2858(){const _0x2e3daf=['.1.LEVEL','temperature','from','setStateAsync','\x20from\x20','toString','rawEventLog','lock','124299XAWCGF','7fHgpFT','motion','Valve','STATUS','map','heizung','LEVEL','[RECORDER]\x20Error:\x20','type','LTM.trainingData.thermodynamics','schalter','LTM.rawEventLog','isExit','val','window','8282010DCmQKu','lampe','exitGraceTimer','toISOString','search','log','location','light','unshift','temperatur','occupancy','includes','push','.forecast.current.temperature','length','error','.NextHours.Location_1.Day_1.current.temp_value','TRACK_EVENT','.4.VALVE_STATE','eventHistory','stringify','Unknown','handle','valveMapping','dimmer','2068692rIrlCO','sendToPythonWrapper','5531552TbIPrJ','contact','bewegung','.1.ACTUAL_TEMPERATURE','.ACTUAL_TEMPERATURE','door','replace','Temperature','STATE','events.history','pop','value','präsenz','.1.TEMPERATURE','1094121kYPqCI','daswetter','24CPMLmn','licht','parse','SIMULATE_SIGNAL','556CHnJZo','getStateAsync','currentSystemMode','outdoorSensorId','apply','switch','isGracePeriodActive','number','isPresent','round','exitTimer','.1.VALVE_STATE','exports','some','.forecast.current.temp','17435AUudAG','loc','fill','useWeather','LTM.trainingData.sequences','schloss','getDate','.Current.Temperature','109598CkwmZi','config','normal','now','getForeignStateAsync','isProVersion','getHours','debug','presence','tür','accuweather','analysis.health.todayVector','(((.+)+)+)+$','toLowerCase','sensorLastValues','kontakt'];a5_0x2858=function(){return _0x2e3daf;};return a5_0x2858();}function a5_0x1640(_0x42afce,_0x36d8a9){const _0x57d84f=a5_0x2858();return a5_0x1640=function(_0x37126d,_0x3e2dff){_0x37126d=_0x37126d-0x1d3;let _0x2858ce=_0x57d84f[_0x37126d];return _0x2858ce;},a5_0x1640(_0x42afce,_0x36d8a9);}async function recordSequence(_0xbf6ec3,_0x15454b){const _0x41f245=a5_0x1640,_0x527e51=(_0x15454b[_0x41f245(0x223)]||'')[_0x41f245(0x20f)](),_0x1a8fe6=[_0x41f245(0x21c),_0x41f245(0x1d9),_0x41f245(0x1e3),'presence',_0x41f245(0x234),_0x41f245(0x1dc),_0x41f245(0x20b),_0x41f245(0x229),'fenster',_0x41f245(0x1d8),_0x41f245(0x211),_0x41f245(0x231),_0x41f245(0x1e8),_0x41f245(0x1f0),_0x41f245(0x225),_0x41f245(0x1d4),_0x41f245(0x22b)];if(!_0x1a8fe6[_0x41f245(0x1f8)](_0x2a9af5=>_0x527e51[_0x41f245(0x235)](_0x2a9af5)))return;if(!_0x15454b[_0x41f245(0x1e2)])return;if(sequenceTimer)clearTimeout(sequenceTimer);activeSequence[_0x41f245(0x236)]({'loc':_0x15454b[_0x41f245(0x230)]||_0x41f245(0x23f),'id':_0x15454b['id'],'ts':Date['now']()}),sequenceTimer=setTimeout(async()=>{if(activeSequence['length']>0x1)await saveCompletedSequence(_0xbf6ec3);activeSequence=[];},SEQUENCE_TIMEOUT_MS);}function startExitTimer(_0x5a9519){const _0x422336=a5_0x1640;abortExitTimer(_0x5a9519),_0x5a9519[_0x422336(0x1f1)]=!![],_0x5a9519[_0x422336(0x22c)]=setTimeout(()=>{_0x5a9519['isGracePeriodActive']=![];},EXIT_GRACE_PERIOD_SECONDS*0x3e8),_0x5a9519[_0x422336(0x1f5)]=setTimeout(()=>{const _0x139c8a=_0x422336;setPresence(_0x5a9519,![]),_0x5a9519[_0x139c8a(0x1f5)]=null;},EXIT_TIMER_MINUTES*0x3c*0x3e8);}function abortExitTimer(_0x2e90ce){const _0x11187e=a5_0x1640;if(_0x2e90ce[_0x11187e(0x1f5)])clearTimeout(_0x2e90ce[_0x11187e(0x1f5)]);if(_0x2e90ce['exitGraceTimer'])clearTimeout(_0x2e90ce['exitGraceTimer']);_0x2e90ce[_0x11187e(0x1f5)]=null,_0x2e90ce['exitGraceTimer']=null,_0x2e90ce[_0x11187e(0x1f1)]=![];}async function setPresence(_0x383617,_0x19be5f){const _0x13db1a=a5_0x1640;if(_0x383617['isPresent']===_0x19be5f)return;_0x383617['isPresent']=_0x19be5f,await _0x383617[_0x13db1a(0x215)]('system.isPresent',{'val':_0x19be5f,'ack':!![]});}async function updateHourlyActivity(_0x325579){const _0x304e90=a5_0x1640;let _0x402e52=new Array(0x18)[_0x304e90(0x1fc)](0x0),_0x5bf35f=0x0;try{const _0x3fb5a3=await _0x325579[_0x304e90(0x1ec)](_0x304e90(0x20d));_0x3fb5a3&&_0x3fb5a3['val']&&(_0x402e52=JSON[_0x304e90(0x1e9)](_0x3fb5a3['val']),_0x5bf35f=_0x3fb5a3['ts']);}catch(_0x492891){}const _0x44e346=new Date(_0x5bf35f),_0x48008e=new Date();_0x44e346[_0x304e90(0x200)]()!==_0x48008e[_0x304e90(0x200)]()&&(_0x402e52=new Array(0x18)[_0x304e90(0x1fc)](0x0));const _0x30d58c=_0x48008e['getHours']();if(_0x402e52[_0x30d58c]===undefined)_0x402e52[_0x30d58c]=0x0;_0x402e52[_0x30d58c]++,await _0x325579[_0x304e90(0x215)]('analysis.health.todayVector',{'val':JSON[_0x304e90(0x23e)](_0x402e52),'ack':!![]});}async function processSensorEvent(_0x26f9f6,_0x2e6c8e,_0x4965ec,_0x2d4967){const _0xcf0be7=a5_0x1640;if(!_0x2d4967)return null;const _0x4a0ba3=_0x4965ec['val'],_0x599d4a=Date[_0xcf0be7(0x205)](),_0x31f69b=_0x26f9f6[_0xcf0be7(0x210)][_0x2e6c8e],_0x4daac5=(_0x2d4967[_0xcf0be7(0x223)]||'')['toLowerCase'](),_0x71f589=_0x4daac5['includes'](_0xcf0be7(0x213))||_0x4daac5[_0xcf0be7(0x235)](_0xcf0be7(0x233))||_0x4daac5[_0xcf0be7(0x235)]('klima')||_0x4daac5['includes'](_0xcf0be7(0x220))||_0x4daac5[_0xcf0be7(0x235)]('thermostat');if(_0x71f589&&typeof _0x4a0ba3===_0xcf0be7(0x1f2)){if(_0x4a0ba3>0x50||_0x4a0ba3<-0x32)return _0x26f9f6[_0xcf0be7(0x22f)][_0xcf0be7(0x209)]('[RECORDER]\x20Ignored\x20implausible\x20temperature:\x20'+_0x4a0ba3+_0xcf0be7(0x216)+_0x2e6c8e),null;}_0x26f9f6['sensorLastValues'][_0x2e6c8e]=_0x4a0ba3;if(!_0x2d4967['logDuplicates']&&_0x31f69b!=undefined&&_0x31f69b==_0x4a0ba3)return null;_0x26f9f6[_0xcf0be7(0x207)]&&_0x71f589&&recordThermodynamics(_0x26f9f6,_0x2e6c8e,_0x4a0ba3,_0x2d4967[_0xcf0be7(0x230)]);const _0x20f67c={'timestamp':_0x599d4a,'id':_0x2e6c8e,'name':_0x2d4967['name'],'type':_0x2d4967[_0xcf0be7(0x223)],'location':_0x2d4967[_0xcf0be7(0x230)],'value':_0x4a0ba3};_0x26f9f6[_0xcf0be7(0x23d)][_0xcf0be7(0x232)](_0x20f67c);if(_0x26f9f6[_0xcf0be7(0x23d)][_0xcf0be7(0x238)]>HISTORY_MAX_SIZE)_0x26f9f6[_0xcf0be7(0x23d)][_0xcf0be7(0x1e1)]();await _0x26f9f6[_0xcf0be7(0x215)]('events.lastEvent',{'val':JSON[_0xcf0be7(0x23e)](_0x20f67c),'ack':!![]}),await _0x26f9f6[_0xcf0be7(0x215)](_0xcf0be7(0x1e0),{'val':JSON[_0xcf0be7(0x23e)](_0x26f9f6['eventHistory']),'ack':!![]}),await updateHourlyActivity(_0x26f9f6);if(_0x26f9f6[_0xcf0be7(0x207)]){_0x26f9f6[_0xcf0be7(0x218)][_0xcf0be7(0x236)](_0x20f67c);if(_0x26f9f6[_0xcf0be7(0x218)][_0xcf0be7(0x238)]>RAW_LOG_MAX_SIZE)_0x26f9f6[_0xcf0be7(0x218)]['splice'](0x0,_0x26f9f6[_0xcf0be7(0x218)][_0xcf0be7(0x238)]-RAW_LOG_MAX_SIZE);await _0x26f9f6[_0xcf0be7(0x215)](_0xcf0be7(0x226),{'val':JSON[_0xcf0be7(0x23e)](_0x26f9f6[_0xcf0be7(0x218)]),'ack':!![]}),recordSequence(_0x26f9f6,_0x20f67c);}if(_0x2d4967[_0xcf0be7(0x227)]&&_0x4a0ba3===!![]){if(_0x26f9f6['isPresent']&&!_0x26f9f6[_0xcf0be7(0x1f1)])startExitTimer(_0x26f9f6);else{if(!_0x26f9f6[_0xcf0be7(0x1f3)])setPresence(_0x26f9f6,!![]);}}else{if(_0x2d4967['type']===_0xcf0be7(0x21c)&&_0x4a0ba3===!![]){if(_0x26f9f6['exitTimer'])abortExitTimer(_0x26f9f6);if(!_0x26f9f6[_0xcf0be7(0x1f3)]&&_0x26f9f6[_0xcf0be7(0x1ed)]===_0xcf0be7(0x204))setPresence(_0x26f9f6,!![]);}}if(_0x26f9f6[_0xcf0be7(0x207)]&&_0x26f9f6[_0xcf0be7(0x1d6)]){_0x2d4967['type']===_0xcf0be7(0x21c)&&_0x4a0ba3===!![]&&_0x2d4967['location']&&_0x26f9f6['sendToPythonWrapper'](_0xcf0be7(0x1ea),{'room':_0x2d4967[_0xcf0be7(0x230)]});const _0x4ac40e=[_0xcf0be7(0x1dc),_0xcf0be7(0x20b),_0xcf0be7(0x229),'fenster','griff',_0xcf0be7(0x240),_0xcf0be7(0x219),_0xcf0be7(0x1ff)]['some'](_0x5c7a8b=>_0x4daac5[_0xcf0be7(0x235)](_0x5c7a8b)),_0x2ca873=[_0xcf0be7(0x231),'licht',_0xcf0be7(0x1f0),_0xcf0be7(0x225),'dimmer',_0xcf0be7(0x22b)][_0xcf0be7(0x1f8)](_0x501000=>_0x4daac5[_0xcf0be7(0x235)](_0x501000)),_0x1a9a76=[_0xcf0be7(0x21c),_0xcf0be7(0x1d9),_0xcf0be7(0x1e3),_0xcf0be7(0x20a),_0xcf0be7(0x234)]['some'](_0x574a4a=>_0x4daac5[_0xcf0be7(0x235)](_0x574a4a));if(_0x2d4967[_0xcf0be7(0x230)]&&(_0x4ac40e||_0x2ca873||_0x1a9a76)){const _0x10bf4f=_0x4a0ba3===!![]||typeof _0x4a0ba3===_0xcf0be7(0x1f2)&&_0x4a0ba3>0x0,_0x2fba4c=_0x4ac40e&&!_0x10bf4f&&_0x31f69b!==undefined&&_0x31f69b!=_0x4a0ba3;if(_0x10bf4f||_0x2fba4c){const _0xa1fcf=_0x26f9f6['lastTrackerEventTime']||_0x599d4a,_0x1c3e2e=(_0x599d4a-_0xa1fcf)/0x3e8;_0x26f9f6['lastTrackerEventTime']=_0x599d4a,_0x26f9f6[_0xcf0be7(0x1d6)](_0xcf0be7(0x23b),{'room':_0x2d4967[_0xcf0be7(0x230)],'dt':_0x1c3e2e});}}}return _0x20f67c;}module[a5_0x5d4690(0x1f7)]={'processSensorEvent':processSensorEvent,'getOutsideTemperatureNumeric':getOutsideTemperatureNumeric,'setPresence':setPresence,'abortExitTimer':abortExitTimer,'startExitTimer':startExitTimer};