const a5_0x152681=a5_0x2dfb;(function(_0x203860,_0x1189c0){const _0x3af1ff=a5_0x2dfb,_0x2b3ecb=_0x203860();while(!![]){try{const _0xd57792=-parseInt(_0x3af1ff(0x15c))/0x1*(parseInt(_0x3af1ff(0x187))/0x2)+parseInt(_0x3af1ff(0x179))/0x3*(parseInt(_0x3af1ff(0x189))/0x4)+-parseInt(_0x3af1ff(0x191))/0x5*(-parseInt(_0x3af1ff(0x199))/0x6)+parseInt(_0x3af1ff(0x171))/0x7+parseInt(_0x3af1ff(0x155))/0x8*(parseInt(_0x3af1ff(0x145))/0x9)+-parseInt(_0x3af1ff(0x147))/0xa+-parseInt(_0x3af1ff(0x180))/0xb;if(_0xd57792===_0x1189c0)break;else _0x2b3ecb['push'](_0x2b3ecb['shift']());}catch(_0x391afd){_0x2b3ecb['push'](_0x2b3ecb['shift']());}}}(a5_0x369f,0x77e65));const a5_0x15aded=(function(){let _0x2f8f04=!![];return function(_0x5801c6,_0x2a3346){const _0x22418d=_0x2f8f04?function(){const _0x156d03=a5_0x2dfb;if(_0x2a3346){const _0x36ebe5=_0x2a3346[_0x156d03(0x14b)](_0x5801c6,arguments);return _0x2a3346=null,_0x36ebe5;}}:function(){};return _0x2f8f04=![],_0x22418d;};}()),a5_0xe7547f=a5_0x15aded(this,function(){const _0x66686=a5_0x2dfb;return a5_0xe7547f[_0x66686(0x162)]()[_0x66686(0x182)](_0x66686(0x158))[_0x66686(0x162)]()[_0x66686(0x185)](a5_0xe7547f)[_0x66686(0x182)](_0x66686(0x158));});a5_0xe7547f();'use strict';function a5_0x2dfb(_0x15843c,_0x2e0c48){const _0x43d512=a5_0x369f();return a5_0x2dfb=function(_0xe7547f,_0x15aded){_0xe7547f=_0xe7547f-0x13d;let _0x369f8b=_0x43d512[_0xe7547f];return _0x369f8b;},a5_0x2dfb(_0x15843c,_0x2e0c48);}const HISTORY_MAX_SIZE=0x32,RAW_LOG_MAX_SIZE=0x9c4,THERMO_LOG_SIZE=0x3e8,SEQUENCE_TIMEOUT_MS=0x5*0x3c*0x3e8,MAX_TRAINING_SET_SIZE=0x1f4,EXIT_TIMER_MINUTES=0xf,EXIT_GRACE_PERIOD_SECONDS=0x1e;let activeSequence=[],sequenceTimer=null,dailyActivityLog=new Array(0x18)[a5_0x152681(0x151)](0x0),lastLogDay=new Date()[a5_0x152681(0x188)]();async function getOutsideTemperatureNumeric(_0x584570){const _0x27da78=a5_0x152681;if(_0x584570[_0x27da78(0x15d)][_0x27da78(0x17f)])try{const _0xc83a9=await _0x584570[_0x27da78(0x18d)](_0x584570[_0x27da78(0x15d)]['outdoorSensorId']);if(_0xc83a9&&_0xc83a9[_0x27da78(0x13d)]!==undefined&&_0xc83a9[_0x27da78(0x13d)]!==null)return parseFloat(_0xc83a9['val']);}catch(_0x44bb77){}const _0x450c40=_0x584570['config'][_0x27da78(0x166)];if(!_0x584570[_0x27da78(0x15d)][_0x27da78(0x1a5)]||!_0x450c40)return null;try{let _0xe965d7='';if(_0x450c40[_0x27da78(0x18b)]('accuweather'))_0xe965d7=_0x450c40+_0x27da78(0x178);else{if(_0x450c40[_0x27da78(0x18b)]('daswetter'))_0xe965d7=_0x450c40+_0x27da78(0x161);else{if(_0x450c40[_0x27da78(0x18b)](_0x27da78(0x13e)))_0xe965d7=_0x450c40+'.forecast.current.temperature';else{if(_0x450c40[_0x27da78(0x18b)]('weatherunderground'))_0xe965d7=_0x450c40+_0x27da78(0x16e);}}}if(_0xe965d7){const _0x1c86c8=await _0x584570[_0x27da78(0x18d)](_0xe965d7);if(_0x1c86c8&&_0x1c86c8[_0x27da78(0x13d)]!==undefined&&_0x1c86c8[_0x27da78(0x13d)]!==null)return parseFloat(_0x1c86c8[_0x27da78(0x13d)]);}}catch(_0xe3b04d){}return null;}async function recordThermodynamics(_0x5e6a7b,_0x10c603,_0xba2fb4,_0x18d156){const _0x6c9ff7=a5_0x152681,_0xef9698=await getOutsideTemperatureNumeric(_0x5e6a7b);if(_0xef9698===null)return;let _0x5df096=0x0,_0x4f14da=![];if(_0x5e6a7b[_0x6c9ff7(0x15d)][_0x6c9ff7(0x183)])try{let _0x168f2d=_0x5e6a7b[_0x6c9ff7(0x15d)]['valveMapping'];if(typeof _0x168f2d===_0x6c9ff7(0x15e))_0x168f2d=JSON['parse'](_0x168f2d);if(_0x168f2d[_0x10c603]){const _0x160acf=_0x168f2d[_0x10c603],_0x31626d=await _0x5e6a7b[_0x6c9ff7(0x18d)](_0x160acf);if(_0x31626d&&_0x31626d['val']!==null&&_0x31626d[_0x6c9ff7(0x13d)]!==undefined){let _0x1b1738=Number(_0x31626d[_0x6c9ff7(0x13d)]);if(_0x1b1738<=1.05&&!_0x160acf['includes'](_0x6c9ff7(0x1a7))&&!_0x160acf['includes']('STATE'))_0x1b1738=_0x1b1738*0x64;_0x5df096=Math[_0x6c9ff7(0x144)](_0x1b1738),_0x4f14da=!![];}}}catch(_0x3d3e57){}if(!_0x4f14da){const _0xe0b1aa=[{'from':_0x6c9ff7(0x19c),'to':'.1.LEVEL'},{'from':_0x6c9ff7(0x19c),'to':_0x6c9ff7(0x19a)},{'from':_0x6c9ff7(0x1aa),'to':_0x6c9ff7(0x15b)},{'from':_0x6c9ff7(0x194),'to':_0x6c9ff7(0x181)},{'from':'temperature','to':'level'},{'from':'Temperature','to':_0x6c9ff7(0x141)}];for(const _0x5be5a7 of _0xe0b1aa){if(_0x10c603[_0x6c9ff7(0x18b)](_0x5be5a7[_0x6c9ff7(0x17d)])){const _0x4fe50e=_0x10c603[_0x6c9ff7(0x1a6)](_0x5be5a7['from'],_0x5be5a7['to']);try{const _0x4328a9=await _0x5e6a7b['getForeignStateAsync'](_0x4fe50e);if(_0x4328a9&&_0x4328a9[_0x6c9ff7(0x13d)]!==null&&_0x4328a9['val']!==undefined){let _0x511724=Number(_0x4328a9[_0x6c9ff7(0x13d)]);if(typeof _0x511724===_0x6c9ff7(0x1a9)){if(_0x511724<=1.05&&_0x5be5a7['to'][_0x6c9ff7(0x18b)](_0x6c9ff7(0x1ad)))_0x511724=_0x511724*0x64;_0x5df096=Math[_0x6c9ff7(0x144)](_0x511724),_0x4f14da=!![];break;}}}catch(_0x5b42f0){}}}}const _0xac9b5a=await _0x5e6a7b[_0x6c9ff7(0x15a)](_0x6c9ff7(0x163));let _0x5934ef=[];if(_0xac9b5a&&_0xac9b5a['val'])try{_0x5934ef=JSON[_0x6c9ff7(0x177)](_0xac9b5a[_0x6c9ff7(0x13d)]);}catch(_0x260c70){}_0x5934ef[_0x6c9ff7(0x150)]({'ts':Date[_0x6c9ff7(0x198)](),'room':_0x18d156||_0x6c9ff7(0x16a),'t_in':_0xba2fb4,'t_out':_0xef9698,'valve':_0x5df096});if(_0x5934ef[_0x6c9ff7(0x168)]>THERMO_LOG_SIZE)_0x5934ef[_0x6c9ff7(0x172)]();await _0x5e6a7b[_0x6c9ff7(0x148)](_0x6c9ff7(0x163),{'val':JSON[_0x6c9ff7(0x14f)](_0x5934ef),'ack':!![]});}async function saveCompletedSequence(_0x5b57ff){const _0x1f5a61=a5_0x152681;try{const _0x2821d8=await _0x5b57ff[_0x1f5a61(0x15a)](_0x1f5a61(0x149));let _0x12909a=[];if(_0x2821d8&&_0x2821d8['val'])try{_0x12909a=JSON[_0x1f5a61(0x177)](_0x2821d8[_0x1f5a61(0x13d)]);}catch(_0x2daba0){}const _0x48f453=activeSequence[0x0]['ts'],_0xe67d9=activeSequence[_0x1f5a61(0x156)](_0x12a120=>({'loc':_0x12a120[_0x1f5a61(0x13f)],'t_delta':Math[_0x1f5a61(0x144)]((_0x12a120['ts']-_0x48f453)/0x3e8)})),_0x2977fa={'timestamp':new Date(_0x48f453)[_0x1f5a61(0x167)](),'steps':_0xe67d9,'duration':Math['round']((activeSequence[activeSequence[_0x1f5a61(0x168)]-0x1]['ts']-_0x48f453)/0x3e8),'daytime':new Date(_0x48f453)[_0x1f5a61(0x14d)]()};_0x12909a[_0x1f5a61(0x150)](_0x2977fa);if(_0x12909a['length']>MAX_TRAINING_SET_SIZE)_0x12909a[_0x1f5a61(0x172)]();await _0x5b57ff[_0x1f5a61(0x148)]('LTM.trainingData.sequences',{'val':JSON[_0x1f5a61(0x14f)](_0x12909a),'ack':!![]}),_0x5b57ff[_0x1f5a61(0x19b)]&&_0x5b57ff[_0x1f5a61(0x18c)]&&_0x5b57ff[_0x1f5a61(0x18c)](_0x1f5a61(0x173),{'sequence':_0x2977fa});}catch(_0x5b4119){_0x5b57ff[_0x1f5a61(0x16f)][_0x1f5a61(0x17a)](_0x1f5a61(0x16b)+_0x5b4119[_0x1f5a61(0x1a8)]);}}async function recordSequence(_0xf55f4b,_0xd1dddb){const _0x15f0e0=a5_0x152681,_0x31755a=(_0xd1dddb[_0x15f0e0(0x146)]||'')[_0x15f0e0(0x1ae)](),_0x13e306=[_0x15f0e0(0x165),_0x15f0e0(0x18e),_0x15f0e0(0x1ac),'presence','occupancy',_0x15f0e0(0x195),'t체r','window',_0x15f0e0(0x193),_0x15f0e0(0x164),_0x15f0e0(0x176),'light',_0x15f0e0(0x159),_0x15f0e0(0x190),_0x15f0e0(0x17c),_0x15f0e0(0x19f),_0x15f0e0(0x17e)];if(!_0x13e306[_0x15f0e0(0x1a2)](_0xcf413e=>_0x31755a[_0x15f0e0(0x18b)](_0xcf413e)))return;if(!_0xd1dddb[_0x15f0e0(0x19e)])return;if(sequenceTimer)clearTimeout(sequenceTimer);activeSequence['push']({'loc':_0xd1dddb[_0x15f0e0(0x153)]||'Unknown','id':_0xd1dddb['id'],'ts':Date[_0x15f0e0(0x198)]()}),sequenceTimer=setTimeout(async()=>{if(activeSequence['length']>0x1)await saveCompletedSequence(_0xf55f4b);activeSequence=[];},SEQUENCE_TIMEOUT_MS);}function a5_0x369f(){const _0x31275c=['valveMapping','sensorLastValues','constructor','lastTrackerEventTime','442PBOqbl','getDate','4Bfmegy','temperature','includes','sendToPythonWrapper','getForeignStateAsync','bewegung','analysis.health.todayVector','switch','30980GYQbKj','isPresent','fenster','.ACTUAL_TEMPERATURE','door','events.lastEvent','occupancy','now','96pRwyVk','.1.VALVE_STATE','isProVersion','.1.ACTUAL_TEMPERATURE','normal','value','dimmer','lock','unshift','some','light','debug','useWeather','replace','STATUS','message','number','.1.TEMPERATURE','pop','pr채senz','LEVEL','toLowerCase','val','openweathermap','loc','isGracePeriodActive','Valve','temperatur','schloss','round','3909573BhQfGo','type','1924180YPUGIv','setStateAsync','LTM.trainingData.sequences','exitGraceTimer','apply','name','getHours','SIMULATE_SIGNAL','stringify','push','fill','exitTimer','location','eventHistory','8SyRXcN','map','window','(((.+)+)+)+$','licht','getStateAsync','.4.VALVE_STATE','4055tGsFFy','config','string','presence','rawEventLog','.NextHours.Location_1.Day_1.current.temp_value','toString','LTM.trainingData.thermodynamics','contact','motion','weatherInstance','toISOString','length','exports','Unknown','[RECORDER]\x20Error:\x20','\x20from\x20','events.history','.forecast.current.temp','log','t체r','3407334OVEtAK','shift','ANALYZE_SEQUENCE','TRACK_EVENT','thermostat','kontakt','parse','.Current.Temperature','2036361ABJEgG','error','klima','schalter','from','lampe','outdoorSensorId','1313400pXyjzK','.LEVEL','search'];a5_0x369f=function(){return _0x31275c;};return a5_0x369f();}function startExitTimer(_0x3bf205){const _0x2fa29b=a5_0x152681;abortExitTimer(_0x3bf205),_0x3bf205[_0x2fa29b(0x140)]=!![],_0x3bf205[_0x2fa29b(0x14a)]=setTimeout(()=>{const _0x4504bf=_0x2fa29b;_0x3bf205[_0x4504bf(0x140)]=![];},EXIT_GRACE_PERIOD_SECONDS*0x3e8),_0x3bf205[_0x2fa29b(0x152)]=setTimeout(()=>{const _0x18dfb6=_0x2fa29b;setPresence(_0x3bf205,![]),_0x3bf205[_0x18dfb6(0x152)]=null;},EXIT_TIMER_MINUTES*0x3c*0x3e8);}function abortExitTimer(_0x359f6f){const _0x724cb0=a5_0x152681;if(_0x359f6f[_0x724cb0(0x152)])clearTimeout(_0x359f6f[_0x724cb0(0x152)]);if(_0x359f6f[_0x724cb0(0x14a)])clearTimeout(_0x359f6f[_0x724cb0(0x14a)]);_0x359f6f[_0x724cb0(0x152)]=null,_0x359f6f[_0x724cb0(0x14a)]=null,_0x359f6f[_0x724cb0(0x140)]=![];}async function setPresence(_0x188edc,_0x26057c){const _0x4ddb43=a5_0x152681;if(_0x188edc[_0x4ddb43(0x192)]===_0x26057c)return;_0x188edc[_0x4ddb43(0x192)]=_0x26057c,await _0x188edc[_0x4ddb43(0x148)]('system.isPresent',{'val':_0x26057c,'ack':!![]});}async function updateHourlyActivity(_0x4a5b40){const _0x1028b5=a5_0x152681,_0x35389d=new Date()[_0x1028b5(0x188)]();_0x35389d!==lastLogDay&&(dailyActivityLog=new Array(0x18)['fill'](0x0),lastLogDay=_0x35389d);const _0x4dfbd4=new Date()[_0x1028b5(0x14d)]();if(dailyActivityLog[_0x4dfbd4]===undefined)dailyActivityLog[_0x4dfbd4]=0x0;dailyActivityLog[_0x4dfbd4]++,await _0x4a5b40['setStateAsync'](_0x1028b5(0x18f),{'val':JSON['stringify'](dailyActivityLog),'ack':!![]});}async function processSensorEvent(_0xa99129,_0x3ab594,_0x36c160,_0xc5ec3a){const _0x389c24=a5_0x152681;if(!_0xc5ec3a)return null;const _0x4f1e20=_0x36c160[_0x389c24(0x13d)],_0x389f1b=Date[_0x389c24(0x198)](),_0x4e07f2=_0xa99129[_0x389c24(0x184)][_0x3ab594],_0x1e7052=(_0xc5ec3a['type']||'')[_0x389c24(0x1ae)](),_0x2c442c=_0x1e7052[_0x389c24(0x18b)](_0x389c24(0x18a))||_0x1e7052[_0x389c24(0x18b)](_0x389c24(0x142))||_0x1e7052['includes'](_0x389c24(0x17b))||_0x1e7052[_0x389c24(0x18b)]('heizung')||_0x1e7052[_0x389c24(0x18b)](_0x389c24(0x175));if(_0x2c442c&&typeof _0x4f1e20===_0x389c24(0x1a9)){if(_0x4f1e20>0x50||_0x4f1e20<-0x32)return _0xa99129[_0x389c24(0x16f)][_0x389c24(0x1a4)]('[RECORDER]\x20Ignored\x20implausible\x20temperature:\x20'+_0x4f1e20+_0x389c24(0x16c)+_0x3ab594),null;}_0xa99129['sensorLastValues'][_0x3ab594]=_0x4f1e20;if(!_0xc5ec3a['logDuplicates']&&_0x4e07f2!=undefined&&_0x4e07f2==_0x4f1e20)return null;_0xa99129['isProVersion']&&_0x2c442c&&recordThermodynamics(_0xa99129,_0x3ab594,_0x4f1e20,_0xc5ec3a['location']);const _0x18e292={'timestamp':_0x389f1b,'id':_0x3ab594,'name':_0xc5ec3a[_0x389c24(0x14c)],'type':_0xc5ec3a[_0x389c24(0x146)],'location':_0xc5ec3a['location'],'value':_0x4f1e20};_0xa99129[_0x389c24(0x154)][_0x389c24(0x1a1)](_0x18e292);if(_0xa99129[_0x389c24(0x154)][_0x389c24(0x168)]>HISTORY_MAX_SIZE)_0xa99129[_0x389c24(0x154)][_0x389c24(0x1ab)]();await _0xa99129['setStateAsync'](_0x389c24(0x196),{'val':JSON[_0x389c24(0x14f)](_0x18e292),'ack':!![]}),await _0xa99129['setStateAsync'](_0x389c24(0x16d),{'val':JSON[_0x389c24(0x14f)](_0xa99129['eventHistory']),'ack':!![]}),await updateHourlyActivity(_0xa99129);if(_0xa99129[_0x389c24(0x19b)]){_0xa99129[_0x389c24(0x160)][_0x389c24(0x150)](_0x18e292);if(_0xa99129[_0x389c24(0x160)]['length']>RAW_LOG_MAX_SIZE)_0xa99129[_0x389c24(0x160)]['splice'](0x0,_0xa99129['rawEventLog'][_0x389c24(0x168)]-RAW_LOG_MAX_SIZE);await _0xa99129['setStateAsync']('LTM.rawEventLog',{'val':JSON[_0x389c24(0x14f)](_0xa99129[_0x389c24(0x160)]),'ack':!![]}),recordSequence(_0xa99129,_0x18e292);}if(_0xc5ec3a['isExit']&&_0x4f1e20===!![]){if(_0xa99129[_0x389c24(0x192)]&&!_0xa99129[_0x389c24(0x140)])startExitTimer(_0xa99129);else{if(!_0xa99129['isPresent'])setPresence(_0xa99129,!![]);}}else{if(_0xc5ec3a[_0x389c24(0x146)]==='motion'&&_0x4f1e20===!![]){if(_0xa99129[_0x389c24(0x152)])abortExitTimer(_0xa99129);if(!_0xa99129[_0x389c24(0x192)]&&_0xa99129['currentSystemMode']===_0x389c24(0x19d))setPresence(_0xa99129,!![]);}}if(_0xa99129[_0x389c24(0x19b)]&&_0xa99129[_0x389c24(0x18c)]){_0xc5ec3a['type']===_0x389c24(0x165)&&_0x4f1e20===!![]&&_0xc5ec3a['location']&&_0xa99129[_0x389c24(0x18c)](_0x389c24(0x14e),{'room':_0xc5ec3a[_0x389c24(0x153)]});const _0x5aea9f=[_0x389c24(0x195),_0x389c24(0x170),_0x389c24(0x157),_0x389c24(0x193),'griff','handle',_0x389c24(0x1a0),_0x389c24(0x143)][_0x389c24(0x1a2)](_0x27613d=>_0x1e7052['includes'](_0x27613d)),_0x447c93=[_0x389c24(0x1a3),'licht',_0x389c24(0x190),_0x389c24(0x17c),'dimmer',_0x389c24(0x17e)][_0x389c24(0x1a2)](_0x23f5da=>_0x1e7052[_0x389c24(0x18b)](_0x23f5da)),_0x50fdb8=['motion',_0x389c24(0x18e),'pr채senz',_0x389c24(0x15f),_0x389c24(0x197)][_0x389c24(0x1a2)](_0x534cec=>_0x1e7052['includes'](_0x534cec));if(_0xc5ec3a['location']&&(_0x5aea9f||_0x447c93||_0x50fdb8)){const _0xabe885=_0x4f1e20===!![]||typeof _0x4f1e20===_0x389c24(0x1a9)&&_0x4f1e20>0x0,_0x318c6d=_0x5aea9f&&!_0xabe885&&_0x4e07f2!==undefined&&_0x4e07f2!=_0x4f1e20;if(_0xabe885||_0x318c6d){const _0x582389=_0xa99129['lastTrackerEventTime']||_0x389f1b,_0x54f664=(_0x389f1b-_0x582389)/0x3e8;_0xa99129[_0x389c24(0x186)]=_0x389f1b,_0xa99129[_0x389c24(0x18c)](_0x389c24(0x174),{'room':_0xc5ec3a[_0x389c24(0x153)],'dt':_0x54f664});}}}return _0x18e292;}module[a5_0x152681(0x169)]={'processSensorEvent':processSensorEvent,'getOutsideTemperatureNumeric':getOutsideTemperatureNumeric,'setPresence':setPresence,'abortExitTimer':abortExitTimer,'startExitTimer':startExitTimer};