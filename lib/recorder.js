const a5_0x57ddbc=a5_0x4bce;(function(_0x25ceac,_0x28c124){const _0x1a968b=a5_0x4bce,_0xbcda7d=_0x25ceac();while(!![]){try{const _0x495921=-parseInt(_0x1a968b(0x91))/0x1*(-parseInt(_0x1a968b(0xd7))/0x2)+-parseInt(_0x1a968b(0x6f))/0x3+-parseInt(_0x1a968b(0xb1))/0x4*(-parseInt(_0x1a968b(0x84))/0x5)+parseInt(_0x1a968b(0xd8))/0x6*(parseInt(_0x1a968b(0xd2))/0x7)+-parseInt(_0x1a968b(0x77))/0x8*(-parseInt(_0x1a968b(0xc1))/0x9)+parseInt(_0x1a968b(0xb9))/0xa+-parseInt(_0x1a968b(0xbd))/0xb*(-parseInt(_0x1a968b(0xc6))/0xc);if(_0x495921===_0x28c124)break;else _0xbcda7d['push'](_0xbcda7d['shift']());}catch(_0x2d2ecb){_0xbcda7d['push'](_0xbcda7d['shift']());}}}(a5_0x2407,0xa5a9d));const a5_0x2ade55=(function(){let _0x1c76d1=!![];return function(_0x150cda,_0x12fb1b){const _0x3911b5=_0x1c76d1?function(){const _0x426111=a5_0x4bce;if(_0x12fb1b){const _0x487f67=_0x12fb1b[_0x426111(0xa7)](_0x150cda,arguments);return _0x12fb1b=null,_0x487f67;}}:function(){};return _0x1c76d1=![],_0x3911b5;};}()),a5_0x394542=a5_0x2ade55(this,function(){const _0x3b6829=a5_0x4bce;return a5_0x394542['toString']()[_0x3b6829(0x72)](_0x3b6829(0x93))['toString']()[_0x3b6829(0x87)](a5_0x394542)[_0x3b6829(0x72)](_0x3b6829(0x93));});a5_0x394542();'use strict';const HISTORY_MAX_SIZE=0x32,RAW_LOG_MAX_SIZE=0x9c4,THERMO_LOG_SIZE=0x3e8,SEQUENCE_TIMEOUT_MS=0x5*0x3c*0x3e8,MAX_TRAINING_SET_SIZE=0x1f4,EXIT_TIMER_MINUTES=0xf,EXIT_GRACE_PERIOD_SECONDS=0x1e;let activeSequence=[],sequenceTimer=null;async function getOutsideTemperatureNumeric(_0x8a399e){const _0x4aea14=a5_0x4bce;if(_0x8a399e[_0x4aea14(0xd0)]['outdoorSensorId'])try{const _0x5b69d8=await _0x8a399e[_0x4aea14(0xcc)](_0x8a399e[_0x4aea14(0xd0)][_0x4aea14(0xb6)]);if(_0x5b69d8&&_0x5b69d8[_0x4aea14(0x73)]!==undefined&&_0x5b69d8[_0x4aea14(0x73)]!==null)return parseFloat(_0x5b69d8[_0x4aea14(0x73)]);}catch(_0x5a4067){}const _0x38224b=_0x8a399e['config'][_0x4aea14(0x7e)];if(!_0x8a399e['config']['useWeather']||!_0x38224b)return null;try{let _0x28aad1='';if(_0x38224b[_0x4aea14(0xc4)](_0x4aea14(0xa6)))_0x28aad1=_0x38224b+_0x4aea14(0x95);else{if(_0x38224b[_0x4aea14(0xc4)]('daswetter'))_0x28aad1=_0x38224b+_0x4aea14(0x8e);else{if(_0x38224b[_0x4aea14(0xc4)](_0x4aea14(0xbe)))_0x28aad1=_0x38224b+'.forecast.current.temperature';else{if(_0x38224b[_0x4aea14(0xc4)](_0x4aea14(0x8f)))_0x28aad1=_0x38224b+_0x4aea14(0xa8);}}}if(_0x28aad1){const _0xfcee78=await _0x8a399e[_0x4aea14(0xcc)](_0x28aad1);if(_0xfcee78&&_0xfcee78[_0x4aea14(0x73)]!==undefined&&_0xfcee78[_0x4aea14(0x73)]!==null)return parseFloat(_0xfcee78[_0x4aea14(0x73)]);}}catch(_0x2cefaf){}return null;}async function recordThermodynamics(_0x54f13f,_0x14f746,_0x3d471a,_0x2844d7){const _0x39e0fb=a5_0x4bce,_0x211075=await getOutsideTemperatureNumeric(_0x54f13f);if(_0x211075===null)return;let _0x1c51f7=0x0,_0x403e8d=![];if(_0x54f13f[_0x39e0fb(0xd0)][_0x39e0fb(0xc5)])try{let _0x27a35b=_0x54f13f[_0x39e0fb(0xd0)][_0x39e0fb(0xc5)];if(typeof _0x27a35b===_0x39e0fb(0x83))_0x27a35b=JSON[_0x39e0fb(0x8d)](_0x27a35b);if(_0x27a35b[_0x14f746]){const _0x1a2fc7=_0x27a35b[_0x14f746],_0x2fcac3=await _0x54f13f[_0x39e0fb(0xcc)](_0x1a2fc7);if(_0x2fcac3&&_0x2fcac3[_0x39e0fb(0x73)]!==null&&_0x2fcac3[_0x39e0fb(0x73)]!==undefined){let _0x50dfb2=Number(_0x2fcac3[_0x39e0fb(0x73)]);if(_0x50dfb2<=1.05&&!_0x1a2fc7[_0x39e0fb(0xc4)](_0x39e0fb(0x7d))&&!_0x1a2fc7[_0x39e0fb(0xc4)](_0x39e0fb(0x9d)))_0x50dfb2=_0x50dfb2*0x64;_0x1c51f7=Math[_0x39e0fb(0x9b)](_0x50dfb2),_0x403e8d=!![];}}}catch(_0x28d70b){}if(!_0x403e8d){const _0x4b2cf7=[{'from':_0x39e0fb(0xd5),'to':_0x39e0fb(0x7a)},{'from':_0x39e0fb(0xd5),'to':_0x39e0fb(0xc8)},{'from':_0x39e0fb(0x71),'to':'.4.VALVE_STATE'},{'from':_0x39e0fb(0xb0),'to':_0x39e0fb(0xaf)},{'from':_0x39e0fb(0xce),'to':_0x39e0fb(0x89)},{'from':_0x39e0fb(0xb7),'to':_0x39e0fb(0xc2)}];for(const _0x4400af of _0x4b2cf7){if(_0x14f746['includes'](_0x4400af['from'])){const _0xaf68cf=_0x14f746[_0x39e0fb(0x85)](_0x4400af[_0x39e0fb(0x75)],_0x4400af['to']);try{const _0x558f9f=await _0x54f13f[_0x39e0fb(0xcc)](_0xaf68cf);if(_0x558f9f&&_0x558f9f[_0x39e0fb(0x73)]!==null&&_0x558f9f['val']!==undefined){let _0x285228=Number(_0x558f9f[_0x39e0fb(0x73)]);if(typeof _0x285228==='number'){if(_0x285228<=1.05&&_0x4400af['to']['includes']('LEVEL'))_0x285228=_0x285228*0x64;_0x1c51f7=Math[_0x39e0fb(0x9b)](_0x285228),_0x403e8d=!![];break;}}}catch(_0x3c3e6d){}}}}const _0x34aa49=await _0x54f13f[_0x39e0fb(0x82)](_0x39e0fb(0xae));let _0x2781e2=[];if(_0x34aa49&&_0x34aa49[_0x39e0fb(0x73)])try{_0x2781e2=JSON[_0x39e0fb(0x8d)](_0x34aa49[_0x39e0fb(0x73)]);}catch(_0x9ffac1){}_0x2781e2[_0x39e0fb(0xaa)]({'ts':Date[_0x39e0fb(0x7c)](),'room':_0x2844d7||_0x39e0fb(0xb8),'t_in':_0x3d471a,'t_out':_0x211075,'valve':_0x1c51f7});if(_0x2781e2[_0x39e0fb(0xa3)]>THERMO_LOG_SIZE)_0x2781e2['shift']();await _0x54f13f[_0x39e0fb(0xc9)](_0x39e0fb(0xae),{'val':JSON[_0x39e0fb(0x7f)](_0x2781e2),'ack':!![]});}function a5_0x4bce(_0x1f15ef,_0x12c73f){const _0x1f779f=a5_0x2407();return a5_0x4bce=function(_0x394542,_0x2ade55){_0x394542=_0x394542-0x6f;let _0x240719=_0x1f779f[_0x394542];return _0x240719;},a5_0x4bce(_0x1f15ef,_0x12c73f);}async function saveCompletedSequence(_0xa4cc1a){const _0x853dc2=a5_0x4bce;try{const _0x319088=await _0xa4cc1a[_0x853dc2(0x82)]('LTM.trainingData.sequences');let _0x34b617=[];if(_0x319088&&_0x319088[_0x853dc2(0x73)])try{_0x34b617=JSON[_0x853dc2(0x8d)](_0x319088[_0x853dc2(0x73)]);}catch(_0x429b41){}const _0x413da1=activeSequence[0x0]['ts'],_0x29d1a3=activeSequence['map'](_0x3394dd=>({'loc':_0x3394dd[_0x853dc2(0xa4)],'t_delta':Math[_0x853dc2(0x9b)]((_0x3394dd['ts']-_0x413da1)/0x3e8)})),_0x572ae8={'timestamp':new Date(_0x413da1)[_0x853dc2(0xcf)](),'steps':_0x29d1a3,'duration':Math[_0x853dc2(0x9b)]((activeSequence[activeSequence[_0x853dc2(0xa3)]-0x1]['ts']-_0x413da1)/0x3e8),'daytime':new Date(_0x413da1)[_0x853dc2(0x86)]()};_0x34b617[_0x853dc2(0xaa)](_0x572ae8);if(_0x34b617[_0x853dc2(0xa3)]>MAX_TRAINING_SET_SIZE)_0x34b617['shift']();await _0xa4cc1a[_0x853dc2(0xc9)]('LTM.trainingData.sequences',{'val':JSON['stringify'](_0x34b617),'ack':!![]}),_0xa4cc1a['isProVersion']&&_0xa4cc1a[_0x853dc2(0x9f)]&&_0xa4cc1a[_0x853dc2(0x9f)](_0x853dc2(0x90),{'sequence':_0x572ae8});}catch(_0x3b1394){_0xa4cc1a[_0x853dc2(0xd6)][_0x853dc2(0xc0)](_0x853dc2(0xbf)+_0x3b1394[_0x853dc2(0xd4)]);}}async function recordSequence(_0x79fab8,_0x1668af){const _0x54916a=a5_0x4bce,_0x402505=(_0x1668af[_0x54916a(0xb2)]||'')[_0x54916a(0x94)](),_0x47e3c2=[_0x54916a(0x9c),'bewegung','präsenz','presence','occupancy',_0x54916a(0x80),_0x54916a(0xac),'window',_0x54916a(0x76),'contact',_0x54916a(0xd9),'light',_0x54916a(0xba),_0x54916a(0xa1),'schalter',_0x54916a(0x98),_0x54916a(0x81)];if(!_0x47e3c2[_0x54916a(0x7b)](_0xa80d12=>_0x402505[_0x54916a(0xc4)](_0xa80d12)))return;if(!_0x1668af[_0x54916a(0x88)])return;if(sequenceTimer)clearTimeout(sequenceTimer);activeSequence[_0x54916a(0xaa)]({'loc':_0x1668af[_0x54916a(0xad)]||_0x54916a(0xb8),'id':_0x1668af['id'],'ts':Date[_0x54916a(0x7c)]()}),sequenceTimer=setTimeout(async()=>{const _0x5c48fe=_0x54916a;if(activeSequence[_0x5c48fe(0xa3)]>0x1)await saveCompletedSequence(_0x79fab8);activeSequence=[];},SEQUENCE_TIMEOUT_MS);}function startExitTimer(_0x39d938){const _0x3840ce=a5_0x4bce;abortExitTimer(_0x39d938),_0x39d938[_0x3840ce(0xbc)]=!![],_0x39d938[_0x3840ce(0xa2)]=setTimeout(()=>{const _0x79ff1a=_0x3840ce;_0x39d938[_0x79ff1a(0xbc)]=![];},EXIT_GRACE_PERIOD_SECONDS*0x3e8),_0x39d938[_0x3840ce(0x96)]=setTimeout(()=>{const _0x383837=_0x3840ce;setPresence(_0x39d938,![]),_0x39d938[_0x383837(0x96)]=null;},EXIT_TIMER_MINUTES*0x3c*0x3e8);}function abortExitTimer(_0xe64bda){const _0xbd15a0=a5_0x4bce;if(_0xe64bda['exitTimer'])clearTimeout(_0xe64bda[_0xbd15a0(0x96)]);if(_0xe64bda[_0xbd15a0(0xa2)])clearTimeout(_0xe64bda[_0xbd15a0(0xa2)]);_0xe64bda['exitTimer']=null,_0xe64bda[_0xbd15a0(0xa2)]=null,_0xe64bda['isGracePeriodActive']=![];}async function setPresence(_0x550c11,_0x336a35){const _0x2892fe=a5_0x4bce;if(_0x550c11[_0x2892fe(0x78)]===_0x336a35)return;_0x550c11[_0x2892fe(0x78)]=_0x336a35,await _0x550c11[_0x2892fe(0xc9)](_0x2892fe(0xa0),{'val':_0x336a35,'ack':!![]});}async function processSensorEvent(_0x535215,_0x328aa2,_0x22b48f,_0x57e75e){const _0x43d8ac=a5_0x4bce;if(!_0x57e75e)return null;const _0x22d542=_0x22b48f[_0x43d8ac(0x73)],_0x58eaf7=Date['now'](),_0x4a58e9=_0x535215[_0x43d8ac(0x9e)][_0x328aa2],_0x481b0d=(_0x57e75e['type']||'')['toLowerCase'](),_0xede47c=_0x481b0d['includes'](_0x43d8ac(0xce))||_0x481b0d[_0x43d8ac(0xc4)](_0x43d8ac(0x79))||_0x481b0d[_0x43d8ac(0xc4)](_0x43d8ac(0xca))||_0x481b0d['includes'](_0x43d8ac(0x74))||_0x481b0d[_0x43d8ac(0xc4)]('thermostat');if(_0xede47c&&typeof _0x22d542===_0x43d8ac(0xcd)){if(_0x22d542>0x50||_0x22d542<-0x32)return _0x535215[_0x43d8ac(0xd6)][_0x43d8ac(0xc7)](_0x43d8ac(0x97)+_0x22d542+'\x20from\x20'+_0x328aa2),null;}_0x535215['sensorLastValues'][_0x328aa2]=_0x22d542;if(!_0x57e75e['logDuplicates']&&_0x4a58e9!=undefined&&_0x4a58e9==_0x22d542)return null;_0x535215[_0x43d8ac(0xb4)]&&_0xede47c&&recordThermodynamics(_0x535215,_0x328aa2,_0x22d542,_0x57e75e[_0x43d8ac(0xad)]);const _0x359fce={'timestamp':_0x58eaf7,'id':_0x328aa2,'name':_0x57e75e['name'],'type':_0x57e75e[_0x43d8ac(0xb2)],'location':_0x57e75e[_0x43d8ac(0xad)],'value':_0x22d542};_0x535215[_0x43d8ac(0x8c)][_0x43d8ac(0xa9)](_0x359fce);if(_0x535215[_0x43d8ac(0x8c)][_0x43d8ac(0xa3)]>HISTORY_MAX_SIZE)_0x535215[_0x43d8ac(0x8c)]['pop']();await _0x535215['setStateAsync']('events.lastEvent',{'val':JSON['stringify'](_0x359fce),'ack':!![]}),await _0x535215[_0x43d8ac(0xc9)](_0x43d8ac(0xbb),{'val':JSON['stringify'](_0x535215['eventHistory']),'ack':!![]});if(_0x535215[_0x43d8ac(0xb4)]){_0x535215[_0x43d8ac(0xb5)][_0x43d8ac(0xaa)](_0x359fce);if(_0x535215['rawEventLog'][_0x43d8ac(0xa3)]>RAW_LOG_MAX_SIZE)_0x535215[_0x43d8ac(0xb5)][_0x43d8ac(0x92)](0x0,_0x535215[_0x43d8ac(0xb5)][_0x43d8ac(0xa3)]-RAW_LOG_MAX_SIZE);await _0x535215[_0x43d8ac(0xc9)]('LTM.rawEventLog',{'val':JSON[_0x43d8ac(0x7f)](_0x535215[_0x43d8ac(0xb5)]),'ack':!![]}),recordSequence(_0x535215,_0x359fce);}if(_0x57e75e[_0x43d8ac(0xd1)]&&_0x22d542===!![]){if(_0x535215['isPresent']&&!_0x535215[_0x43d8ac(0xbc)])startExitTimer(_0x535215);else{if(!_0x535215[_0x43d8ac(0x78)])setPresence(_0x535215,!![]);}}else{if(_0x57e75e[_0x43d8ac(0xb2)]===_0x43d8ac(0x9c)&&_0x22d542===!![]){if(_0x535215[_0x43d8ac(0x96)])abortExitTimer(_0x535215);if(!_0x535215[_0x43d8ac(0x78)]&&_0x535215['currentSystemMode']===_0x43d8ac(0xcb))setPresence(_0x535215,!![]);}}if(_0x535215[_0x43d8ac(0xb4)]&&_0x535215[_0x43d8ac(0x9f)]){_0x57e75e[_0x43d8ac(0xb2)]===_0x43d8ac(0x9c)&&_0x22d542===!![]&&_0x57e75e[_0x43d8ac(0xad)]&&_0x535215[_0x43d8ac(0x9f)]('SIMULATE_SIGNAL',{'room':_0x57e75e['location']});const _0xd7b566=['door',_0x43d8ac(0xac),'window',_0x43d8ac(0x76),_0x43d8ac(0x8b),_0x43d8ac(0x99),'lock','schloss'][_0x43d8ac(0x7b)](_0x1049bb=>_0x481b0d[_0x43d8ac(0xc4)](_0x1049bb)),_0x4b929b=['light',_0x43d8ac(0xba),_0x43d8ac(0xa1),_0x43d8ac(0xb3),_0x43d8ac(0x98),_0x43d8ac(0x81)]['some'](_0x42cc69=>_0x481b0d[_0x43d8ac(0xc4)](_0x42cc69)),_0x1bdcaa=[_0x43d8ac(0x9c),_0x43d8ac(0x70),_0x43d8ac(0x8a),_0x43d8ac(0xab),_0x43d8ac(0xa5)][_0x43d8ac(0x7b)](_0x283a3b=>_0x481b0d[_0x43d8ac(0xc4)](_0x283a3b));if(_0x57e75e[_0x43d8ac(0xad)]&&(_0xd7b566||_0x4b929b||_0x1bdcaa)){const _0x564cdd=_0x22d542===!![]||typeof _0x22d542===_0x43d8ac(0xcd)&&_0x22d542>0x0,_0x1dd82f=_0xd7b566&&!_0x564cdd&&_0x4a58e9!==undefined&&_0x4a58e9!=_0x22d542;if(_0x564cdd||_0x1dd82f){const _0x47e86c=_0x535215[_0x43d8ac(0x9a)]||_0x58eaf7,_0xe3687b=(_0x58eaf7-_0x47e86c)/0x3e8;_0x535215[_0x43d8ac(0x9a)]=_0x58eaf7,_0x535215[_0x43d8ac(0x9f)](_0x43d8ac(0xd3),{'room':_0x57e75e[_0x43d8ac(0xad)],'dt':_0xe3687b});}}}return _0x359fce;}module[a5_0x57ddbc(0xc3)]={'processSensorEvent':processSensorEvent,'getOutsideTemperatureNumeric':getOutsideTemperatureNumeric,'setPresence':setPresence,'abortExitTimer':abortExitTimer,'startExitTimer':startExitTimer};function a5_0x2407(){const _0x53a2bc=['schalter','isProVersion','rawEventLog','outdoorSensorId','Temperature','Unknown','2961610ZxztPV','licht','events.history','isGracePeriodActive','181456BJoReq','openweathermap','[RECORDER]\x20Error:\x20','error','9TyeqRc','Valve','exports','includes','valveMapping','480aDGBcl','debug','.1.VALVE_STATE','setStateAsync','klima','normal','getForeignStateAsync','number','temperature','toISOString','config','isExit','82978KmuVls','TRACK_EVENT','message','.1.ACTUAL_TEMPERATURE','log','62lYkCUw','84sKtTyN','kontakt','2574504UVFZka','bewegung','.1.TEMPERATURE','search','val','heizung','from','fenster','1560968Assuqk','isPresent','temperatur','.1.LEVEL','some','now','STATUS','weatherInstance','stringify','door','lampe','getStateAsync','string','35JVkMOe','replace','getHours','constructor','value','level','präsenz','griff','eventHistory','parse','.NextHours.Location_1.Day_1.current.temp_value','weatherunderground','ANALYZE_SEQUENCE','5227NjXnAr','splice','(((.+)+)+)+$','toLowerCase','.Current.Temperature','exitTimer','[RECORDER]\x20Ignored\x20implausible\x20temperature:\x20','dimmer','handle','lastTrackerEventTime','round','motion','STATE','sensorLastValues','sendToPythonWrapper','system.isPresent','switch','exitGraceTimer','length','loc','occupancy','accuweather','apply','.forecast.current.temp','unshift','push','presence','tür','location','LTM.trainingData.thermodynamics','.LEVEL','.ACTUAL_TEMPERATURE','32920oAIkeZ','type'];a5_0x2407=function(){return _0x53a2bc;};return a5_0x2407();}