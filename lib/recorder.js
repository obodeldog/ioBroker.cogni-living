const a5_0x297c29=a5_0x4235;(function(_0x402314,_0x3b1692){const _0x48538a=a5_0x4235,_0x502c59=_0x402314();while(!![]){try{const _0x41a680=-parseInt(_0x48538a(0x126))/0x1*(parseInt(_0x48538a(0x184))/0x2)+parseInt(_0x48538a(0x11d))/0x3+-parseInt(_0x48538a(0x143))/0x4+parseInt(_0x48538a(0x149))/0x5*(-parseInt(_0x48538a(0x120))/0x6)+parseInt(_0x48538a(0x14a))/0x7+-parseInt(_0x48538a(0x17c))/0x8*(-parseInt(_0x48538a(0x144))/0x9)+parseInt(_0x48538a(0x14c))/0xa;if(_0x41a680===_0x3b1692)break;else _0x502c59['push'](_0x502c59['shift']());}catch(_0x45d4e6){_0x502c59['push'](_0x502c59['shift']());}}}(a5_0x5894,0x900fb));const a5_0x443b2a=(function(){let _0x38f193=!![];return function(_0x256df9,_0x4425ee){const _0x286e6c=_0x38f193?function(){const _0x4b9210=a5_0x4235;if(_0x4425ee){const _0x220339=_0x4425ee[_0x4b9210(0x163)](_0x256df9,arguments);return _0x4425ee=null,_0x220339;}}:function(){};return _0x38f193=![],_0x286e6c;};}()),a5_0x368c26=a5_0x443b2a(this,function(){const _0x5064b9=a5_0x4235;return a5_0x368c26['toString']()[_0x5064b9(0x16e)](_0x5064b9(0x16b))[_0x5064b9(0x133)]()[_0x5064b9(0x16c)](a5_0x368c26)[_0x5064b9(0x16e)](_0x5064b9(0x16b));});a5_0x368c26();'use strict';const HISTORY_MAX_SIZE=0x32,RAW_LOG_MAX_SIZE=0x9c4,THERMO_LOG_SIZE=0x3e8,SEQUENCE_TIMEOUT_MS=0x5*0x3c*0x3e8,MAX_TRAINING_SET_SIZE=0x1f4,EXIT_TIMER_MINUTES=0xf,EXIT_GRACE_PERIOD_SECONDS=0x1e;let activeSequence=[],sequenceTimer=null;async function getOutsideTemperatureNumeric(_0x1602d6){const _0x1a1d36=a5_0x4235;if(_0x1602d6['config'][_0x1a1d36(0x164)])try{const _0x568222=await _0x1602d6[_0x1a1d36(0x153)](_0x1602d6[_0x1a1d36(0x157)][_0x1a1d36(0x164)]);if(_0x568222&&_0x568222[_0x1a1d36(0x150)]!==undefined&&_0x568222[_0x1a1d36(0x150)]!==null)return parseFloat(_0x568222[_0x1a1d36(0x150)]);}catch(_0x3da989){}const _0x5ee2d0=_0x1602d6[_0x1a1d36(0x157)][_0x1a1d36(0x148)];if(!_0x1602d6[_0x1a1d36(0x157)][_0x1a1d36(0x138)]||!_0x5ee2d0)return null;try{let _0x23e1bf='';if(_0x5ee2d0[_0x1a1d36(0x16a)](_0x1a1d36(0x15a)))_0x23e1bf=_0x5ee2d0+'.Current.Temperature';else{if(_0x5ee2d0[_0x1a1d36(0x16a)]('daswetter'))_0x23e1bf=_0x5ee2d0+'.NextHours.Location_1.Day_1.current.temp_value';else{if(_0x5ee2d0[_0x1a1d36(0x16a)](_0x1a1d36(0x121)))_0x23e1bf=_0x5ee2d0+'.forecast.current.temperature';else{if(_0x5ee2d0[_0x1a1d36(0x16a)](_0x1a1d36(0x12c)))_0x23e1bf=_0x5ee2d0+'.forecast.current.temp';}}}if(_0x23e1bf){const _0x15cc65=await _0x1602d6[_0x1a1d36(0x153)](_0x23e1bf);if(_0x15cc65&&_0x15cc65[_0x1a1d36(0x150)]!==undefined&&_0x15cc65['val']!==null)return parseFloat(_0x15cc65[_0x1a1d36(0x150)]);}}catch(_0x3c9dac){}return null;}async function recordThermodynamics(_0x112fd5,_0x3c896b,_0x5517f3,_0x247551){const _0x660ec1=a5_0x4235,_0x4feb57=await getOutsideTemperatureNumeric(_0x112fd5);if(_0x4feb57===null)return;let _0x555d4a=0x0,_0x55ed30=![];if(_0x112fd5[_0x660ec1(0x157)]['valveMapping'])try{let _0x4badbb=_0x112fd5[_0x660ec1(0x157)][_0x660ec1(0x142)];if(typeof _0x4badbb==='string')_0x4badbb=JSON[_0x660ec1(0x162)](_0x4badbb);if(_0x4badbb[_0x3c896b]){const _0x2f6a5f=_0x4badbb[_0x3c896b],_0x1916f9=await _0x112fd5[_0x660ec1(0x153)](_0x2f6a5f);if(_0x1916f9&&_0x1916f9[_0x660ec1(0x150)]!==null&&_0x1916f9[_0x660ec1(0x150)]!==undefined){let _0x184ddc=Number(_0x1916f9[_0x660ec1(0x150)]);if(_0x184ddc<=1.05&&!_0x2f6a5f[_0x660ec1(0x16a)](_0x660ec1(0x17e))&&!_0x2f6a5f[_0x660ec1(0x16a)](_0x660ec1(0x160)))_0x184ddc=_0x184ddc*0x64;_0x555d4a=Math['round'](_0x184ddc),_0x55ed30=!![];}}}catch(_0x61e6d7){}if(!_0x55ed30){const _0x28c126=[{'from':_0x660ec1(0x15c),'to':_0x660ec1(0x161)},{'from':_0x660ec1(0x15c),'to':'.1.VALVE_STATE'},{'from':_0x660ec1(0x154),'to':'.4.VALVE_STATE'},{'from':_0x660ec1(0x122),'to':'.LEVEL'},{'from':_0x660ec1(0x13e),'to':'level'},{'from':_0x660ec1(0x15e),'to':_0x660ec1(0x11e)}];for(const _0x227d86 of _0x28c126){if(_0x3c896b['includes'](_0x227d86[_0x660ec1(0x158)])){const _0x4b4574=_0x3c896b[_0x660ec1(0x170)](_0x227d86[_0x660ec1(0x158)],_0x227d86['to']);try{const _0x1f4334=await _0x112fd5[_0x660ec1(0x153)](_0x4b4574);if(_0x1f4334&&_0x1f4334[_0x660ec1(0x150)]!==null&&_0x1f4334[_0x660ec1(0x150)]!==undefined){let _0x4a65de=Number(_0x1f4334[_0x660ec1(0x150)]);if(typeof _0x4a65de===_0x660ec1(0x132)){if(_0x4a65de<=1.05&&_0x227d86['to']['includes'](_0x660ec1(0x174)))_0x4a65de=_0x4a65de*0x64;_0x555d4a=Math[_0x660ec1(0x11f)](_0x4a65de),_0x55ed30=!![];break;}}}catch(_0x29b7eb){}}}}const _0x6d867c=await _0x112fd5[_0x660ec1(0x12f)](_0x660ec1(0x134));let _0x5e970d=[];if(_0x6d867c&&_0x6d867c[_0x660ec1(0x150)])try{_0x5e970d=JSON[_0x660ec1(0x162)](_0x6d867c[_0x660ec1(0x150)]);}catch(_0x22aa2f){}_0x5e970d[_0x660ec1(0x135)]({'ts':Date[_0x660ec1(0x171)](),'room':_0x247551||_0x660ec1(0x151),'t_in':_0x5517f3,'t_out':_0x4feb57,'valve':_0x555d4a});if(_0x5e970d[_0x660ec1(0x173)]>THERMO_LOG_SIZE)_0x5e970d['shift']();await _0x112fd5[_0x660ec1(0x137)](_0x660ec1(0x134),{'val':JSON[_0x660ec1(0x179)](_0x5e970d),'ack':!![]});}async function saveCompletedSequence(_0x2e512b){const _0x3d0670=a5_0x4235;try{const _0x1fab3b=await _0x2e512b[_0x3d0670(0x12f)](_0x3d0670(0x15f));let _0x347e21=[];if(_0x1fab3b&&_0x1fab3b['val'])try{_0x347e21=JSON[_0x3d0670(0x162)](_0x1fab3b[_0x3d0670(0x150)]);}catch(_0x29cd54){}const _0x1976c5=activeSequence[0x0]['ts'],_0x170865=activeSequence['map'](_0x2add5e=>({'loc':_0x2add5e['loc'],'t_delta':Math['round']((_0x2add5e['ts']-_0x1976c5)/0x3e8)})),_0x38856d={'timestamp':new Date(_0x1976c5)[_0x3d0670(0x156)](),'steps':_0x170865,'duration':Math[_0x3d0670(0x11f)]((activeSequence[activeSequence[_0x3d0670(0x173)]-0x1]['ts']-_0x1976c5)/0x3e8),'daytime':new Date(_0x1976c5)['getHours']()};_0x347e21[_0x3d0670(0x135)](_0x38856d);if(_0x347e21[_0x3d0670(0x173)]>MAX_TRAINING_SET_SIZE)_0x347e21[_0x3d0670(0x167)]();await _0x2e512b[_0x3d0670(0x137)](_0x3d0670(0x15f),{'val':JSON['stringify'](_0x347e21),'ack':!![]}),_0x2e512b[_0x3d0670(0x13c)]&&_0x2e512b['sendToPythonWrapper']&&_0x2e512b[_0x3d0670(0x17f)]('ANALYZE_SEQUENCE',{'sequence':_0x38856d});}catch(_0x3a880b){_0x2e512b[_0x3d0670(0x14b)][_0x3d0670(0x152)]('[RECORDER]\x20Error:\x20'+_0x3a880b[_0x3d0670(0x15b)]);}}function a5_0x5894(){const _0xfa6087=['toString','LTM.trainingData.thermodynamics','push','griff','setStateAsync','useWeather','TRACK_EVENT','lastTrackerEventTime','schalter','isProVersion','contact','temperature','exitTimer','lampe','sensorLastValues','valveMapping','3101612cCLOZQ','332172urZIRA','rawEventLog','some','licht','weatherInstance','271550uYGslu','2782843WmkgON','log','9480460LkpJFv','door','type','exports','val','Unknown','error','getForeignStateAsync','.1.TEMPERATURE','fenster','toISOString','config','from','isPresent','accuweather','message','.1.ACTUAL_TEMPERATURE','lock','Temperature','LTM.trainingData.sequences','STATE','.1.LEVEL','parse','apply','outdoorSensorId','isExit','events.lastEvent','shift','exitGraceTimer','heizung','includes','(((.+)+)+)+$','constructor','pop','search','präsenz','replace','now','presence','length','LEVEL','normal','LTM.rawEventLog','toLowerCase','handle','stringify','events.history','tür','104UhoWtG','name','STATUS','sendToPythonWrapper','isGracePeriodActive','location','temperatur','eventHistory','190vwIsfm','111852wNilcu','Valve','round','24ylyXwJ','openweathermap','.ACTUAL_TEMPERATURE','dimmer','debug','occupancy','2947rjEfrv','bewegung','\x20from\x20','system.isPresent','window','light','weatherunderground','currentSystemMode','splice','getStateAsync','motion','switch','number'];a5_0x5894=function(){return _0xfa6087;};return a5_0x5894();}async function recordSequence(_0x18812d,_0x1ff47e){const _0x37bbf1=a5_0x4235,_0x132dde=(_0x1ff47e['type']||'')[_0x37bbf1(0x177)](),_0x3a58a0=[_0x37bbf1(0x130),_0x37bbf1(0x127),_0x37bbf1(0x16f),'presence','occupancy',_0x37bbf1(0x14d),_0x37bbf1(0x17b),_0x37bbf1(0x12a),_0x37bbf1(0x155),_0x37bbf1(0x13d),'kontakt','light',_0x37bbf1(0x147),'switch','schalter',_0x37bbf1(0x123),_0x37bbf1(0x140)];if(!_0x3a58a0[_0x37bbf1(0x146)](_0x105eaa=>_0x132dde[_0x37bbf1(0x16a)](_0x105eaa)))return;if(!_0x1ff47e['value'])return;if(sequenceTimer)clearTimeout(sequenceTimer);activeSequence[_0x37bbf1(0x135)]({'loc':_0x1ff47e[_0x37bbf1(0x181)]||_0x37bbf1(0x151),'id':_0x1ff47e['id'],'ts':Date[_0x37bbf1(0x171)]()}),sequenceTimer=setTimeout(async()=>{const _0x4b238b=_0x37bbf1;if(activeSequence[_0x4b238b(0x173)]>0x1)await saveCompletedSequence(_0x18812d);activeSequence=[];},SEQUENCE_TIMEOUT_MS);}function startExitTimer(_0x132420){const _0x3ac0ff=a5_0x4235;abortExitTimer(_0x132420),_0x132420[_0x3ac0ff(0x180)]=!![],_0x132420[_0x3ac0ff(0x168)]=setTimeout(()=>{const _0x26fa77=_0x3ac0ff;_0x132420[_0x26fa77(0x180)]=![];},EXIT_GRACE_PERIOD_SECONDS*0x3e8),_0x132420['exitTimer']=setTimeout(()=>{const _0x33da1d=_0x3ac0ff;setPresence(_0x132420,![]),_0x132420[_0x33da1d(0x13f)]=null;},EXIT_TIMER_MINUTES*0x3c*0x3e8);}function a5_0x4235(_0x480422,_0x2184d9){const _0x29f13d=a5_0x5894();return a5_0x4235=function(_0x368c26,_0x443b2a){_0x368c26=_0x368c26-0x11d;let _0x58942f=_0x29f13d[_0x368c26];return _0x58942f;},a5_0x4235(_0x480422,_0x2184d9);}function abortExitTimer(_0x270c01){const _0x49f418=a5_0x4235;if(_0x270c01[_0x49f418(0x13f)])clearTimeout(_0x270c01['exitTimer']);if(_0x270c01[_0x49f418(0x168)])clearTimeout(_0x270c01[_0x49f418(0x168)]);_0x270c01[_0x49f418(0x13f)]=null,_0x270c01[_0x49f418(0x168)]=null,_0x270c01[_0x49f418(0x180)]=![];}async function setPresence(_0x2eb7cf,_0xb4afde){const _0x198b8b=a5_0x4235;if(_0x2eb7cf[_0x198b8b(0x159)]===_0xb4afde)return;_0x2eb7cf['isPresent']=_0xb4afde,await _0x2eb7cf[_0x198b8b(0x137)](_0x198b8b(0x129),{'val':_0xb4afde,'ack':!![]});}async function processSensorEvent(_0x2c66cc,_0x5b6318,_0x50ee94,_0x4a2e64){const _0x34f14a=a5_0x4235;if(!_0x4a2e64)return null;const _0x1bdea8=_0x50ee94['val'],_0x166bb4=Date[_0x34f14a(0x171)](),_0x5f582d=_0x2c66cc[_0x34f14a(0x141)][_0x5b6318],_0x3ab023=(_0x4a2e64[_0x34f14a(0x14e)]||'')[_0x34f14a(0x177)](),_0x205bb7=_0x3ab023['includes']('temperature')||_0x3ab023[_0x34f14a(0x16a)](_0x34f14a(0x182))||_0x3ab023['includes']('klima')||_0x3ab023['includes'](_0x34f14a(0x169))||_0x3ab023['includes']('thermostat');if(_0x205bb7&&typeof _0x1bdea8===_0x34f14a(0x132)){if(_0x1bdea8>0x50||_0x1bdea8<-0x32)return _0x2c66cc[_0x34f14a(0x14b)][_0x34f14a(0x124)]('[RECORDER]\x20Ignored\x20implausible\x20temperature:\x20'+_0x1bdea8+_0x34f14a(0x128)+_0x5b6318),null;}_0x2c66cc[_0x34f14a(0x141)][_0x5b6318]=_0x1bdea8;if(!_0x4a2e64['logDuplicates']&&_0x5f582d!=undefined&&_0x5f582d==_0x1bdea8)return null;_0x2c66cc['isProVersion']&&_0x205bb7&&recordThermodynamics(_0x2c66cc,_0x5b6318,_0x1bdea8,_0x4a2e64[_0x34f14a(0x181)]);const _0x159fce={'timestamp':_0x166bb4,'id':_0x5b6318,'name':_0x4a2e64[_0x34f14a(0x17d)],'type':_0x4a2e64[_0x34f14a(0x14e)],'location':_0x4a2e64['location'],'value':_0x1bdea8};_0x2c66cc['eventHistory']['unshift'](_0x159fce);if(_0x2c66cc[_0x34f14a(0x183)]['length']>HISTORY_MAX_SIZE)_0x2c66cc[_0x34f14a(0x183)][_0x34f14a(0x16d)]();await _0x2c66cc[_0x34f14a(0x137)](_0x34f14a(0x166),{'val':JSON[_0x34f14a(0x179)](_0x159fce),'ack':!![]}),await _0x2c66cc[_0x34f14a(0x137)](_0x34f14a(0x17a),{'val':JSON[_0x34f14a(0x179)](_0x2c66cc['eventHistory']),'ack':!![]});if(_0x2c66cc['isProVersion']){_0x2c66cc['rawEventLog'][_0x34f14a(0x135)](_0x159fce);if(_0x2c66cc[_0x34f14a(0x145)]['length']>RAW_LOG_MAX_SIZE)_0x2c66cc['rawEventLog'][_0x34f14a(0x12e)](0x0,_0x2c66cc[_0x34f14a(0x145)][_0x34f14a(0x173)]-RAW_LOG_MAX_SIZE);await _0x2c66cc[_0x34f14a(0x137)](_0x34f14a(0x176),{'val':JSON['stringify'](_0x2c66cc[_0x34f14a(0x145)]),'ack':!![]}),recordSequence(_0x2c66cc,_0x159fce);}if(_0x4a2e64[_0x34f14a(0x165)]&&_0x1bdea8===!![]){if(_0x2c66cc[_0x34f14a(0x159)]&&!_0x2c66cc[_0x34f14a(0x180)])startExitTimer(_0x2c66cc);else{if(!_0x2c66cc[_0x34f14a(0x159)])setPresence(_0x2c66cc,!![]);}}else{if(_0x4a2e64['type']==='motion'&&_0x1bdea8===!![]){if(_0x2c66cc['exitTimer'])abortExitTimer(_0x2c66cc);if(!_0x2c66cc[_0x34f14a(0x159)]&&_0x2c66cc[_0x34f14a(0x12d)]===_0x34f14a(0x175))setPresence(_0x2c66cc,!![]);}}if(_0x2c66cc['isProVersion']&&_0x2c66cc[_0x34f14a(0x17f)]){_0x4a2e64[_0x34f14a(0x14e)]===_0x34f14a(0x130)&&_0x1bdea8===!![]&&_0x4a2e64[_0x34f14a(0x181)]&&_0x2c66cc[_0x34f14a(0x17f)]('SIMULATE_SIGNAL',{'room':_0x4a2e64[_0x34f14a(0x181)]});const _0x474b3b=[_0x34f14a(0x14d),_0x34f14a(0x17b),_0x34f14a(0x12a),_0x34f14a(0x155),_0x34f14a(0x136),_0x34f14a(0x178),_0x34f14a(0x15d),'schloss'][_0x34f14a(0x146)](_0x446632=>_0x3ab023[_0x34f14a(0x16a)](_0x446632)),_0x3bf89b=[_0x34f14a(0x12b),'licht',_0x34f14a(0x131),_0x34f14a(0x13b),_0x34f14a(0x123),_0x34f14a(0x140)][_0x34f14a(0x146)](_0x9e3c85=>_0x3ab023[_0x34f14a(0x16a)](_0x9e3c85)),_0x34f065=['motion',_0x34f14a(0x127),_0x34f14a(0x16f),_0x34f14a(0x172),_0x34f14a(0x125)][_0x34f14a(0x146)](_0x1439b1=>_0x3ab023[_0x34f14a(0x16a)](_0x1439b1));if(_0x4a2e64[_0x34f14a(0x181)]&&(_0x474b3b||_0x3bf89b||_0x34f065)){const _0x2a38cf=_0x1bdea8===!![]||typeof _0x1bdea8===_0x34f14a(0x132)&&_0x1bdea8>0x0,_0x124f22=_0x474b3b&&!_0x2a38cf&&_0x5f582d!==undefined&&_0x5f582d!=_0x1bdea8;if(_0x2a38cf||_0x124f22){const _0x57c043=_0x2c66cc[_0x34f14a(0x13a)]||_0x166bb4,_0xab1fa5=(_0x166bb4-_0x57c043)/0x3e8;_0x2c66cc[_0x34f14a(0x13a)]=_0x166bb4,_0x2c66cc['sendToPythonWrapper'](_0x34f14a(0x139),{'room':_0x4a2e64[_0x34f14a(0x181)],'dt':_0xab1fa5});}}}return _0x159fce;}module[a5_0x297c29(0x14f)]={'processSensorEvent':processSensorEvent,'getOutsideTemperatureNumeric':getOutsideTemperatureNumeric,'setPresence':setPresence,'abortExitTimer':abortExitTimer,'startExitTimer':startExitTimer};