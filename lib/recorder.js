const a5_0x43acd3=a5_0x1995;(function(_0x5abac1,_0x199562){const _0x295bd5=a5_0x1995,_0x1cb0ca=_0x5abac1();while(!![]){try{const _0x201a8a=-parseInt(_0x295bd5(0x134))/0x1*(-parseInt(_0x295bd5(0x12e))/0x2)+-parseInt(_0x295bd5(0x12a))/0x3*(parseInt(_0x295bd5(0xda))/0x4)+parseInt(_0x295bd5(0xf2))/0x5+-parseInt(_0x295bd5(0x13c))/0x6+parseInt(_0x295bd5(0x11d))/0x7+parseInt(_0x295bd5(0xde))/0x8+-parseInt(_0x295bd5(0xd7))/0x9;if(_0x201a8a===_0x199562)break;else _0x1cb0ca['push'](_0x1cb0ca['shift']());}catch(_0x154125){_0x1cb0ca['push'](_0x1cb0ca['shift']());}}}(a5_0x4cbd,0xc3ed2));const a5_0x1647db=(function(){let _0x3cbe2d=!![];return function(_0x31efbf,_0x18a9ff){const _0x2c71cb=_0x3cbe2d?function(){const _0x29cc52=a5_0x1995;if(_0x18a9ff){const _0xeaed0d=_0x18a9ff[_0x29cc52(0x123)](_0x31efbf,arguments);return _0x18a9ff=null,_0xeaed0d;}}:function(){};return _0x3cbe2d=![],_0x2c71cb;};}()),a5_0x5b763e=a5_0x1647db(this,function(){const _0x1bd323=a5_0x1995;return a5_0x5b763e[_0x1bd323(0x130)]()[_0x1bd323(0xec)](_0x1bd323(0x118))[_0x1bd323(0x130)]()['constructor'](a5_0x5b763e)[_0x1bd323(0xec)](_0x1bd323(0x118));});a5_0x5b763e();'use strict';const HISTORY_MAX_SIZE=0x32,RAW_LOG_MAX_SIZE=0x9c4,THERMO_LOG_SIZE=0x3e8,SEQUENCE_TIMEOUT_MS=0x5*0x3c*0x3e8,MAX_TRAINING_SET_SIZE=0x1f4,EXIT_TIMER_MINUTES=0xf,EXIT_GRACE_PERIOD_SECONDS=0x1e;function a5_0x1995(_0x4712e8,_0x1f3fcf){const _0x2e72f6=a5_0x4cbd();return a5_0x1995=function(_0x5b763e,_0x1647db){_0x5b763e=_0x5b763e-0xd6;let _0x4cbd44=_0x2e72f6[_0x5b763e];return _0x4cbd44;},a5_0x1995(_0x4712e8,_0x1f3fcf);}let activeSequence=[],sequenceTimer=null;async function getOutsideTemperatureNumeric(_0x400364){const _0xa25b68=a5_0x1995;if(_0x400364[_0xa25b68(0x136)][_0xa25b68(0x13d)])try{const _0x7e8e4=await _0x400364[_0xa25b68(0x124)](_0x400364[_0xa25b68(0x136)]['outdoorSensorId']);if(_0x7e8e4&&_0x7e8e4['val']!==undefined&&_0x7e8e4[_0xa25b68(0x11f)]!==null)return parseFloat(_0x7e8e4[_0xa25b68(0x11f)]);}catch(_0x24605b){}const _0x4669cf=_0x400364['config']['weatherInstance'];if(!_0x400364[_0xa25b68(0x136)][_0xa25b68(0x103)]||!_0x4669cf)return null;try{let _0x292788='';if(_0x4669cf['includes']('accuweather'))_0x292788=_0x4669cf+_0xa25b68(0x105);else{if(_0x4669cf[_0xa25b68(0x11c)](_0xa25b68(0x135)))_0x292788=_0x4669cf+_0xa25b68(0x131);else{if(_0x4669cf['includes'](_0xa25b68(0x148)))_0x292788=_0x4669cf+_0xa25b68(0x139);else{if(_0x4669cf[_0xa25b68(0x11c)](_0xa25b68(0x13b)))_0x292788=_0x4669cf+_0xa25b68(0x104);}}}if(_0x292788){const _0x3f5599=await _0x400364[_0xa25b68(0x124)](_0x292788);if(_0x3f5599&&_0x3f5599[_0xa25b68(0x11f)]!==undefined&&_0x3f5599[_0xa25b68(0x11f)]!==null)return parseFloat(_0x3f5599[_0xa25b68(0x11f)]);}}catch(_0x2ea6f6){}return null;}async function recordThermodynamics(_0x1393d8,_0x471326,_0x1ac9a6,_0x27a563){const _0x43b66f=a5_0x1995,_0x3d3eda=await getOutsideTemperatureNumeric(_0x1393d8);if(_0x3d3eda===null)return;let _0x333ceb=0x0,_0x1549d9=![];if(_0x1393d8['config'][_0x43b66f(0x111)])try{let _0x3d4369=_0x1393d8[_0x43b66f(0x136)][_0x43b66f(0x111)];if(typeof _0x3d4369===_0x43b66f(0x142))_0x3d4369=JSON[_0x43b66f(0x109)](_0x3d4369);if(_0x3d4369[_0x471326]){const _0x1f83aa=_0x3d4369[_0x471326],_0x30f015=await _0x1393d8[_0x43b66f(0x124)](_0x1f83aa);if(_0x30f015&&_0x30f015['val']!==null&&_0x30f015[_0x43b66f(0x11f)]!==undefined){let _0x5ddd32=Number(_0x30f015[_0x43b66f(0x11f)]);if(_0x5ddd32<=1.05&&!_0x1f83aa['includes'](_0x43b66f(0x11b))&&!_0x1f83aa[_0x43b66f(0x11c)]('STATE'))_0x5ddd32=_0x5ddd32*0x64;_0x333ceb=Math[_0x43b66f(0xe0)](_0x5ddd32),_0x1549d9=!![];}}}catch(_0x3ca065){}if(!_0x1549d9){const _0x2e7c95=[{'from':_0x43b66f(0xdc),'to':_0x43b66f(0x102)},{'from':_0x43b66f(0xdc),'to':_0x43b66f(0x126)},{'from':_0x43b66f(0xdf),'to':'.4.VALVE_STATE'},{'from':'.ACTUAL_TEMPERATURE','to':_0x43b66f(0xea)},{'from':_0x43b66f(0xfb),'to':_0x43b66f(0x112)},{'from':_0x43b66f(0x121),'to':'Valve'}];for(const _0x2f434c of _0x2e7c95){if(_0x471326[_0x43b66f(0x11c)](_0x2f434c['from'])){const _0x58908c=_0x471326[_0x43b66f(0xf9)](_0x2f434c[_0x43b66f(0xe5)],_0x2f434c['to']);try{const _0x3b6e47=await _0x1393d8[_0x43b66f(0x124)](_0x58908c);if(_0x3b6e47&&_0x3b6e47['val']!==null&&_0x3b6e47[_0x43b66f(0x11f)]!==undefined){let _0xa59b9f=Number(_0x3b6e47[_0x43b66f(0x11f)]);if(typeof _0xa59b9f===_0x43b66f(0x133)){if(_0xa59b9f<=1.05&&_0x2f434c['to'][_0x43b66f(0x11c)](_0x43b66f(0xd9)))_0xa59b9f=_0xa59b9f*0x64;_0x333ceb=Math['round'](_0xa59b9f),_0x1549d9=!![];break;}}}catch(_0x6e623d){}}}}const _0x4d35dd=await _0x1393d8[_0x43b66f(0x12d)](_0x43b66f(0x125));let _0x249439=[];if(_0x4d35dd&&_0x4d35dd['val'])try{_0x249439=JSON[_0x43b66f(0x109)](_0x4d35dd[_0x43b66f(0x11f)]);}catch(_0x558f38){}_0x249439[_0x43b66f(0xeb)]({'ts':Date['now'](),'room':_0x27a563||_0x43b66f(0x128),'t_in':_0x1ac9a6,'t_out':_0x3d3eda,'valve':_0x333ceb});if(_0x249439[_0x43b66f(0xee)]>THERMO_LOG_SIZE)_0x249439[_0x43b66f(0x114)]();await _0x1393d8['setStateAsync'](_0x43b66f(0x125),{'val':JSON[_0x43b66f(0x13e)](_0x249439),'ack':!![]});}async function saveCompletedSequence(_0x293ad2){const _0xe936b=a5_0x1995;try{const _0x1aae0c=await _0x293ad2[_0xe936b(0x12d)](_0xe936b(0x13a));let _0x47490e=[];if(_0x1aae0c&&_0x1aae0c[_0xe936b(0x11f)])try{_0x47490e=JSON['parse'](_0x1aae0c[_0xe936b(0x11f)]);}catch(_0x368db1){}const _0x2fd56a=activeSequence[0x0]['ts'],_0x5150cf=activeSequence[_0xe936b(0x145)](_0x32b6fe=>({'loc':_0x32b6fe[_0xe936b(0x120)],'t_delta':Math[_0xe936b(0xe0)]((_0x32b6fe['ts']-_0x2fd56a)/0x3e8)})),_0x29748c={'timestamp':new Date(_0x2fd56a)['toISOString'](),'steps':_0x5150cf,'duration':Math[_0xe936b(0xe0)]((activeSequence[activeSequence[_0xe936b(0xee)]-0x1]['ts']-_0x2fd56a)/0x3e8),'daytime':new Date(_0x2fd56a)[_0xe936b(0xe6)]()};_0x47490e[_0xe936b(0xeb)](_0x29748c);if(_0x47490e[_0xe936b(0xee)]>MAX_TRAINING_SET_SIZE)_0x47490e[_0xe936b(0x114)]();await _0x293ad2[_0xe936b(0xf5)](_0xe936b(0x13a),{'val':JSON[_0xe936b(0x13e)](_0x47490e),'ack':!![]}),_0x293ad2[_0xe936b(0x137)]&&_0x293ad2[_0xe936b(0xd6)]&&_0x293ad2[_0xe936b(0xd6)](_0xe936b(0x143),{'sequence':_0x29748c});}catch(_0x2b26ea){_0x293ad2[_0xe936b(0x107)][_0xe936b(0x116)](_0xe936b(0x106)+_0x2b26ea[_0xe936b(0x10c)]);}}async function recordSequence(_0xf3f586,_0x5d9afd){const _0x38413e=a5_0x1995,_0x3e2260=(_0x5d9afd[_0x38413e(0x12c)]||'')[_0x38413e(0xf6)](),_0x366d70=[_0x38413e(0xfa),'bewegung',_0x38413e(0xf8),_0x38413e(0x147),_0x38413e(0xd8),_0x38413e(0xfc),_0x38413e(0xf4),_0x38413e(0x101),_0x38413e(0x110),_0x38413e(0x127),_0x38413e(0x12b),_0x38413e(0x141),_0x38413e(0x132),'switch',_0x38413e(0x146),_0x38413e(0x10a),_0x38413e(0x144)];if(!_0x366d70[_0x38413e(0xfe)](_0x36cb07=>_0x3e2260[_0x38413e(0x11c)](_0x36cb07)))return;if(!_0x5d9afd[_0x38413e(0x10b)])return;if(sequenceTimer)clearTimeout(sequenceTimer);activeSequence['push']({'loc':_0x5d9afd[_0x38413e(0xdb)]||_0x38413e(0x128),'id':_0x5d9afd['id'],'ts':Date['now']()}),sequenceTimer=setTimeout(async()=>{const _0x2f932c=_0x38413e;if(activeSequence[_0x2f932c(0xee)]>0x1)await saveCompletedSequence(_0xf3f586);activeSequence=[];},SEQUENCE_TIMEOUT_MS);}function startExitTimer(_0x387e80){const _0x4183db=a5_0x1995;abortExitTimer(_0x387e80),_0x387e80[_0x4183db(0xe4)]=!![],_0x387e80[_0x4183db(0xdd)]=setTimeout(()=>{const _0x3d44b9=_0x4183db;_0x387e80[_0x3d44b9(0xe4)]=![];},EXIT_GRACE_PERIOD_SECONDS*0x3e8),_0x387e80[_0x4183db(0xfd)]=setTimeout(()=>{const _0x489cda=_0x4183db;setPresence(_0x387e80,![]),_0x387e80[_0x489cda(0xfd)]=null;},EXIT_TIMER_MINUTES*0x3c*0x3e8);}function abortExitTimer(_0x2c9088){const _0x4cac32=a5_0x1995;if(_0x2c9088[_0x4cac32(0xfd)])clearTimeout(_0x2c9088[_0x4cac32(0xfd)]);if(_0x2c9088[_0x4cac32(0xdd)])clearTimeout(_0x2c9088[_0x4cac32(0xdd)]);_0x2c9088['exitTimer']=null,_0x2c9088['exitGraceTimer']=null,_0x2c9088[_0x4cac32(0xe4)]=![];}function a5_0x4cbd(){const _0x3391e0=['setStateAsync','toLowerCase','thermostat','präsenz','replace','motion','temperature','door','exitTimer','some','now','bewegung','window','.1.LEVEL','useWeather','.forecast.current.temp','.Current.Temperature','[RECORDER]\x20Error:\x20','log','LTM.rawEventLog','parse','dimmer','value','message','getDate','heizung','debug','fenster','valveMapping','level','isExit','shift','currentSystemMode','error','system.isPresent','(((.+)+)+)+$','normal','schloss','STATUS','includes','10276644AdsaUA','events.history','val','loc','Temperature','[RECORDER]\x20Ignored\x20implausible\x20temperature:\x20','apply','getForeignStateAsync','LTM.trainingData.thermodynamics','.1.VALVE_STATE','contact','Unknown','analysis.health.todayVector','346137HDNrrl','kontakt','type','getStateAsync','2hGSMVR','handle','toString','.NextHours.Location_1.Day_1.current.temp_value','licht','number','1350051pixtQv','daswetter','config','isProVersion','splice','.forecast.current.temperature','LTM.trainingData.sequences','weatherunderground','4573050LxZoAI','outdoorSensorId','stringify','griff','logDuplicates','light','string','ANALYZE_SEQUENCE','lampe','map','schalter','presence','openweathermap','fill','exports','sendToPythonWrapper','14702976wKJTmx','occupancy','LEVEL','36iYMDwX','location','.1.ACTUAL_TEMPERATURE','exitGraceTimer','9567624RSIrjZ','.1.TEMPERATURE','round','rawEventLog','lastTrackerEventTime','temperatur','isGracePeriodActive','from','getHours','isPresent','unshift','lock','.LEVEL','push','search','events.lastEvent','length','name','TRACK_EVENT','klima','1113340tTPvSG','eventHistory','tür'];a5_0x4cbd=function(){return _0x3391e0;};return a5_0x4cbd();}async function setPresence(_0x16cf92,_0x1445ca){const _0x503695=a5_0x1995;if(_0x16cf92[_0x503695(0xe7)]===_0x1445ca)return;_0x16cf92[_0x503695(0xe7)]=_0x1445ca,await _0x16cf92[_0x503695(0xf5)](_0x503695(0x117),{'val':_0x1445ca,'ack':!![]});}async function updateHourlyActivity(_0x35196b){const _0x3acc1a=a5_0x1995;let _0x3a013c=new Array(0x18)[_0x3acc1a(0x149)](0x0),_0x52c481=0x0;try{const _0x50c415=await _0x35196b[_0x3acc1a(0x12d)](_0x3acc1a(0x129));_0x50c415&&_0x50c415[_0x3acc1a(0x11f)]&&(_0x3a013c=JSON[_0x3acc1a(0x109)](_0x50c415[_0x3acc1a(0x11f)]),_0x52c481=_0x50c415['ts']);}catch(_0x2e9c49){}const _0x3bdd4d=new Date(_0x52c481),_0x1cb319=new Date();_0x3bdd4d[_0x3acc1a(0x10d)]()!==_0x1cb319[_0x3acc1a(0x10d)]()&&(_0x3a013c=new Array(0x18)[_0x3acc1a(0x149)](0x0));const _0x1c8f01=_0x1cb319[_0x3acc1a(0xe6)]();if(_0x3a013c[_0x1c8f01]===undefined)_0x3a013c[_0x1c8f01]=0x0;_0x3a013c[_0x1c8f01]++,await _0x35196b[_0x3acc1a(0xf5)](_0x3acc1a(0x129),{'val':JSON[_0x3acc1a(0x13e)](_0x3a013c),'ack':!![]});}async function processSensorEvent(_0x56d0b1,_0x3d92a0,_0x41a8f4,_0x489a5b){const _0x4c7154=a5_0x1995;if(!_0x489a5b)return null;const _0x1c6533=_0x41a8f4[_0x4c7154(0x11f)],_0x565460=Date[_0x4c7154(0xff)](),_0x2d74b9=_0x56d0b1['sensorLastValues'][_0x3d92a0],_0xab5ee1=(_0x489a5b[_0x4c7154(0x12c)]||'')[_0x4c7154(0xf6)](),_0x174821=_0xab5ee1[_0x4c7154(0x11c)](_0x4c7154(0xfb))||_0xab5ee1[_0x4c7154(0x11c)](_0x4c7154(0xe3))||_0xab5ee1['includes'](_0x4c7154(0xf1))||_0xab5ee1[_0x4c7154(0x11c)](_0x4c7154(0x10e))||_0xab5ee1[_0x4c7154(0x11c)](_0x4c7154(0xf7));if(_0x174821&&typeof _0x1c6533===_0x4c7154(0x133)){if(_0x1c6533>0x50||_0x1c6533<-0x32)return _0x56d0b1[_0x4c7154(0x107)][_0x4c7154(0x10f)](_0x4c7154(0x122)+_0x1c6533+'\x20from\x20'+_0x3d92a0),null;}_0x56d0b1['sensorLastValues'][_0x3d92a0]=_0x1c6533;if(!_0x489a5b[_0x4c7154(0x140)]&&_0x2d74b9!=undefined&&_0x2d74b9==_0x1c6533)return null;_0x56d0b1[_0x4c7154(0x137)]&&_0x174821&&recordThermodynamics(_0x56d0b1,_0x3d92a0,_0x1c6533,_0x489a5b[_0x4c7154(0xdb)]);const _0x460c0a={'timestamp':_0x565460,'id':_0x3d92a0,'name':_0x489a5b[_0x4c7154(0xef)],'type':_0x489a5b['type'],'location':_0x489a5b[_0x4c7154(0xdb)],'value':_0x1c6533};_0x56d0b1[_0x4c7154(0xf3)][_0x4c7154(0xe8)](_0x460c0a);if(_0x56d0b1[_0x4c7154(0xf3)][_0x4c7154(0xee)]>HISTORY_MAX_SIZE)_0x56d0b1[_0x4c7154(0xf3)]['pop']();await _0x56d0b1[_0x4c7154(0xf5)](_0x4c7154(0xed),{'val':JSON['stringify'](_0x460c0a),'ack':!![]}),await _0x56d0b1[_0x4c7154(0xf5)](_0x4c7154(0x11e),{'val':JSON[_0x4c7154(0x13e)](_0x56d0b1[_0x4c7154(0xf3)]),'ack':!![]}),await updateHourlyActivity(_0x56d0b1);if(_0x56d0b1[_0x4c7154(0x137)]){_0x56d0b1[_0x4c7154(0xe1)][_0x4c7154(0xeb)](_0x460c0a);if(_0x56d0b1[_0x4c7154(0xe1)][_0x4c7154(0xee)]>RAW_LOG_MAX_SIZE)_0x56d0b1['rawEventLog'][_0x4c7154(0x138)](0x0,_0x56d0b1['rawEventLog'][_0x4c7154(0xee)]-RAW_LOG_MAX_SIZE);await _0x56d0b1[_0x4c7154(0xf5)](_0x4c7154(0x108),{'val':JSON[_0x4c7154(0x13e)](_0x56d0b1[_0x4c7154(0xe1)]),'ack':!![]}),recordSequence(_0x56d0b1,_0x460c0a);}if(_0x489a5b[_0x4c7154(0x113)]&&_0x1c6533===!![]){if(_0x56d0b1['isPresent']&&!_0x56d0b1[_0x4c7154(0xe4)])startExitTimer(_0x56d0b1);else{if(!_0x56d0b1[_0x4c7154(0xe7)])setPresence(_0x56d0b1,!![]);}}else{if(_0x489a5b['type']===_0x4c7154(0xfa)&&_0x1c6533===!![]){if(_0x56d0b1['exitTimer'])abortExitTimer(_0x56d0b1);if(!_0x56d0b1[_0x4c7154(0xe7)]&&_0x56d0b1[_0x4c7154(0x115)]===_0x4c7154(0x119))setPresence(_0x56d0b1,!![]);}}if(_0x56d0b1[_0x4c7154(0x137)]&&_0x56d0b1[_0x4c7154(0xd6)]){_0x489a5b['type']===_0x4c7154(0xfa)&&_0x1c6533===!![]&&_0x489a5b[_0x4c7154(0xdb)]&&_0x56d0b1['sendToPythonWrapper']('SIMULATE_SIGNAL',{'room':_0x489a5b[_0x4c7154(0xdb)]});const _0x4e0251=[_0x4c7154(0xfc),_0x4c7154(0xf4),_0x4c7154(0x101),_0x4c7154(0x110),_0x4c7154(0x13f),_0x4c7154(0x12f),_0x4c7154(0xe9),_0x4c7154(0x11a)][_0x4c7154(0xfe)](_0x329f53=>_0xab5ee1[_0x4c7154(0x11c)](_0x329f53)),_0x4b7ad9=[_0x4c7154(0x141),'licht','switch',_0x4c7154(0x146),'dimmer',_0x4c7154(0x144)][_0x4c7154(0xfe)](_0xbed643=>_0xab5ee1['includes'](_0xbed643)),_0x5b81bf=[_0x4c7154(0xfa),_0x4c7154(0x100),_0x4c7154(0xf8),_0x4c7154(0x147),_0x4c7154(0xd8)]['some'](_0x51dda7=>_0xab5ee1[_0x4c7154(0x11c)](_0x51dda7));if(_0x489a5b['location']&&(_0x4e0251||_0x4b7ad9||_0x5b81bf)){const _0x40212f=_0x1c6533===!![]||typeof _0x1c6533==='number'&&_0x1c6533>0x0,_0x30da0b=_0x4e0251&&!_0x40212f&&_0x2d74b9!==undefined&&_0x2d74b9!=_0x1c6533;if(_0x40212f||_0x30da0b){const _0x2fab6b=_0x56d0b1['lastTrackerEventTime']||_0x565460,_0x4b59e5=(_0x565460-_0x2fab6b)/0x3e8;_0x56d0b1[_0x4c7154(0xe2)]=_0x565460,_0x56d0b1[_0x4c7154(0xd6)](_0x4c7154(0xf0),{'room':_0x489a5b[_0x4c7154(0xdb)],'dt':_0x4b59e5});}}}return _0x460c0a;}module[a5_0x43acd3(0x14a)]={'processSensorEvent':processSensorEvent,'getOutsideTemperatureNumeric':getOutsideTemperatureNumeric,'setPresence':setPresence,'abortExitTimer':abortExitTimer,'startExitTimer':startExitTimer};