const a5_0x70f02d=a5_0x3926;(function(_0x3042fc,_0x229ba1){const _0x530d66=a5_0x3926,_0x29f4d0=_0x3042fc();while(!![]){try{const _0x325862=-parseInt(_0x530d66(0x12f))/0x1+parseInt(_0x530d66(0x114))/0x2*(parseInt(_0x530d66(0x147))/0x3)+-parseInt(_0x530d66(0x139))/0x4+-parseInt(_0x530d66(0x13b))/0x5*(parseInt(_0x530d66(0x113))/0x6)+-parseInt(_0x530d66(0x132))/0x7*(-parseInt(_0x530d66(0x141))/0x8)+-parseInt(_0x530d66(0x14f))/0x9+parseInt(_0x530d66(0x10d))/0xa;if(_0x325862===_0x229ba1)break;else _0x29f4d0['push'](_0x29f4d0['shift']());}catch(_0x116113){_0x29f4d0['push'](_0x29f4d0['shift']());}}}(a5_0x4eeb,0xf3b6b));const a5_0x291d2e=(function(){let _0x860d0c=!![];return function(_0x161f2a,_0x4f74c7){const _0x486a91=_0x860d0c?function(){const _0x27ad74=a5_0x3926;if(_0x4f74c7){const _0x18037e=_0x4f74c7[_0x27ad74(0x121)](_0x161f2a,arguments);return _0x4f74c7=null,_0x18037e;}}:function(){};return _0x860d0c=![],_0x486a91;};}()),a5_0x961565=a5_0x291d2e(this,function(){const _0x4d1067=a5_0x3926;return a5_0x961565[_0x4d1067(0x129)]()[_0x4d1067(0x10a)](_0x4d1067(0xff))[_0x4d1067(0x129)]()[_0x4d1067(0x14d)](a5_0x961565)['search']('(((.+)+)+)+$');});a5_0x961565();'use strict';const HISTORY_MAX_SIZE=0x32,RAW_LOG_MAX_SIZE=0x9c4,THERMO_LOG_SIZE=0x3e8,SEQUENCE_TIMEOUT_MS=0x5*0x3c*0x3e8,MAX_TRAINING_SET_SIZE=0x1f4,EXIT_TIMER_MINUTES=0xf,EXIT_GRACE_PERIOD_SECONDS=0x1e;let activeSequence=[],sequenceTimer=null;async function getOutsideTemperatureNumeric(_0x8025a2){const _0x424ac7=a5_0x3926;if(_0x8025a2[_0x424ac7(0x12c)][_0x424ac7(0x10c)])try{const _0x5d42ba=await _0x8025a2[_0x424ac7(0x144)](_0x8025a2[_0x424ac7(0x12c)][_0x424ac7(0x10c)]);if(_0x5d42ba&&_0x5d42ba[_0x424ac7(0x131)]!==undefined&&_0x5d42ba[_0x424ac7(0x131)]!==null)return parseFloat(_0x5d42ba[_0x424ac7(0x131)]);}catch(_0x43df73){}const _0x1ae8df=_0x8025a2[_0x424ac7(0x12c)]['weatherInstance'];if(!_0x8025a2['config'][_0x424ac7(0x119)]||!_0x1ae8df)return null;try{let _0x54bced='';if(_0x1ae8df[_0x424ac7(0x11a)](_0x424ac7(0x117)))_0x54bced=_0x1ae8df+_0x424ac7(0x151);else{if(_0x1ae8df[_0x424ac7(0x11a)]('daswetter'))_0x54bced=_0x1ae8df+'.NextHours.Location_1.Day_1.current.temp_value';else{if(_0x1ae8df['includes']('openweathermap'))_0x54bced=_0x1ae8df+_0x424ac7(0x142);else{if(_0x1ae8df['includes']('weatherunderground'))_0x54bced=_0x1ae8df+_0x424ac7(0x116);}}}if(_0x54bced){const _0x200ff1=await _0x8025a2['getForeignStateAsync'](_0x54bced);if(_0x200ff1&&_0x200ff1[_0x424ac7(0x131)]!==undefined&&_0x200ff1[_0x424ac7(0x131)]!==null)return parseFloat(_0x200ff1['val']);}}catch(_0x484534){}return null;}async function recordThermodynamics(_0x1ac6a4,_0xdb385,_0x1b8189,_0x10ad6b){const _0x54b3d1=a5_0x3926,_0x9434aa=await getOutsideTemperatureNumeric(_0x1ac6a4),_0x3bc11d=await _0x1ac6a4['getStateAsync']('LTM.trainingData.thermodynamics');let _0x36a604=[];if(_0x3bc11d&&_0x3bc11d[_0x54b3d1(0x131)])try{_0x36a604=JSON[_0x54b3d1(0x118)](_0x3bc11d[_0x54b3d1(0x131)]);}catch(_0x5459c7){}_0x36a604[_0x54b3d1(0x125)]({'ts':Date[_0x54b3d1(0x126)](),'room':_0x10ad6b||_0x54b3d1(0x12b),'t_in':_0x1b8189,'t_out':_0x9434aa});if(_0x36a604[_0x54b3d1(0x136)]>THERMO_LOG_SIZE)_0x36a604[_0x54b3d1(0x150)]();await _0x1ac6a4[_0x54b3d1(0x14e)](_0x54b3d1(0x100),{'val':JSON[_0x54b3d1(0x101)](_0x36a604),'ack':!![]});}async function saveCompletedSequence(_0x1f6db2){const _0x287cb5=a5_0x3926;try{const _0x55b465=await _0x1f6db2['getStateAsync'](_0x287cb5(0x120));let _0x3585fb=[];if(_0x55b465&&_0x55b465['val'])try{_0x3585fb=JSON[_0x287cb5(0x118)](_0x55b465[_0x287cb5(0x131)]);}catch(_0x2fce39){}const _0x1aa1dc=activeSequence[0x0]['ts'],_0x28527f=activeSequence['map'](_0x28d107=>({'loc':_0x28d107[_0x287cb5(0x149)],'t_delta':Math[_0x287cb5(0x13d)]((_0x28d107['ts']-_0x1aa1dc)/0x3e8)})),_0x21ac93={'timestamp':new Date(_0x1aa1dc)[_0x287cb5(0x13f)](),'steps':_0x28527f,'duration':Math[_0x287cb5(0x13d)]((activeSequence[activeSequence[_0x287cb5(0x136)]-0x1]['ts']-_0x1aa1dc)/0x3e8),'daytime':new Date(_0x1aa1dc)[_0x287cb5(0x145)]()};_0x3585fb[_0x287cb5(0x125)](_0x21ac93);if(_0x3585fb[_0x287cb5(0x136)]>MAX_TRAINING_SET_SIZE)_0x3585fb['shift']();await _0x1f6db2[_0x287cb5(0x14e)](_0x287cb5(0x120),{'val':JSON[_0x287cb5(0x101)](_0x3585fb),'ack':!![]}),_0x1f6db2[_0x287cb5(0x127)]&&_0x1f6db2[_0x287cb5(0x146)]&&_0x1f6db2[_0x287cb5(0x146)](_0x287cb5(0x13c),{'sequence':_0x21ac93});}catch(_0x42e2f6){_0x1f6db2[_0x287cb5(0x105)][_0x287cb5(0x135)](_0x287cb5(0x133)+_0x42e2f6['message']);}}async function recordSequence(_0x143076,_0xa8320a){const _0x1e7892=a5_0x3926,_0x421264=(_0xa8320a['type']||'')[_0x1e7892(0x124)](),_0x48ea46=['motion',_0x1e7892(0x10e),_0x1e7892(0x152),_0x1e7892(0x143),_0x1e7892(0x122),_0x1e7892(0x12a),_0x1e7892(0x111),_0x1e7892(0x13a),'fenster',_0x1e7892(0x14c),_0x1e7892(0x13e),_0x1e7892(0x11e),_0x1e7892(0x107),_0x1e7892(0x12d),_0x1e7892(0x108),_0x1e7892(0x106),'lampe'];if(!_0x48ea46['some'](_0x1b5e5c=>_0x421264[_0x1e7892(0x11a)](_0x1b5e5c)))return;if(!_0xa8320a['value'])return;if(sequenceTimer)clearTimeout(sequenceTimer);activeSequence[_0x1e7892(0x125)]({'loc':_0xa8320a[_0x1e7892(0x10f)]||_0x1e7892(0x12b),'id':_0xa8320a['id'],'ts':Date[_0x1e7892(0x126)]()}),sequenceTimer=setTimeout(async()=>{const _0xe81135=_0x1e7892;if(activeSequence[_0xe81135(0x136)]>0x1)await saveCompletedSequence(_0x143076);activeSequence=[];},SEQUENCE_TIMEOUT_MS);}function a5_0x3926(_0x5587e4,_0x2ac0ec){const _0x1295de=a5_0x4eeb();return a5_0x3926=function(_0x961565,_0x291d2e){_0x961565=_0x961565-0xff;let _0x4eeb64=_0x1295de[_0x961565];return _0x4eeb64;},a5_0x3926(_0x5587e4,_0x2ac0ec);}function startExitTimer(_0x10e7b0){const _0x42a4c9=a5_0x3926;abortExitTimer(_0x10e7b0),_0x10e7b0[_0x42a4c9(0x11c)]=!![],_0x10e7b0['exitGraceTimer']=setTimeout(()=>{const _0x50df0a=_0x42a4c9;_0x10e7b0[_0x50df0a(0x11c)]=![];},EXIT_GRACE_PERIOD_SECONDS*0x3e8),_0x10e7b0[_0x42a4c9(0x115)]=setTimeout(()=>{const _0x2c8812=_0x42a4c9;setPresence(_0x10e7b0,![]),_0x10e7b0[_0x2c8812(0x115)]=null;},EXIT_TIMER_MINUTES*0x3c*0x3e8);}function abortExitTimer(_0x4da53f){const _0x472a5a=a5_0x3926;if(_0x4da53f[_0x472a5a(0x115)])clearTimeout(_0x4da53f['exitTimer']);if(_0x4da53f[_0x472a5a(0x11b)])clearTimeout(_0x4da53f['exitGraceTimer']);_0x4da53f[_0x472a5a(0x115)]=null,_0x4da53f[_0x472a5a(0x11b)]=null,_0x4da53f[_0x472a5a(0x11c)]=![];}async function setPresence(_0x14d26f,_0x8e14){const _0x245856=a5_0x3926;if(_0x14d26f[_0x245856(0x10b)]===_0x8e14)return;_0x14d26f[_0x245856(0x10b)]=_0x8e14,await _0x14d26f[_0x245856(0x14e)](_0x245856(0x134),{'val':_0x8e14,'ack':!![]});}async function processSensorEvent(_0x564d76,_0xef6a5,_0x266671,_0x40634c){const _0x20ed11=a5_0x3926;if(!_0x40634c)return null;const _0x5f5d02=_0x266671[_0x20ed11(0x131)],_0x2595ae=Date[_0x20ed11(0x126)](),_0x43457f=_0x564d76[_0x20ed11(0x104)][_0xef6a5];_0x564d76[_0x20ed11(0x104)][_0xef6a5]=_0x5f5d02;if(!_0x40634c['logDuplicates']&&_0x43457f!=undefined&&_0x43457f==_0x5f5d02)return null;const _0x333cb7=(_0x40634c[_0x20ed11(0x153)]||'')[_0x20ed11(0x124)](),_0x247fbf=_0x333cb7[_0x20ed11(0x11a)]('temperature')||_0x333cb7['includes'](_0x20ed11(0x11f))||_0x333cb7[_0x20ed11(0x11a)](_0x20ed11(0x102))||_0x333cb7[_0x20ed11(0x11a)](_0x20ed11(0x137));_0x564d76[_0x20ed11(0x127)]&&_0x247fbf&&recordThermodynamics(_0x564d76,_0xef6a5,_0x5f5d02,_0x40634c['location']);const _0x301502={'timestamp':_0x2595ae,'id':_0xef6a5,'name':_0x40634c[_0x20ed11(0x112)],'type':_0x40634c['type'],'location':_0x40634c[_0x20ed11(0x10f)],'value':_0x5f5d02};_0x564d76[_0x20ed11(0x110)][_0x20ed11(0x148)](_0x301502);if(_0x564d76[_0x20ed11(0x110)][_0x20ed11(0x136)]>HISTORY_MAX_SIZE)_0x564d76[_0x20ed11(0x110)][_0x20ed11(0x11d)]();await _0x564d76['setStateAsync'](_0x20ed11(0x138),{'val':JSON[_0x20ed11(0x101)](_0x301502),'ack':!![]}),await _0x564d76[_0x20ed11(0x14e)]('events.history',{'val':JSON[_0x20ed11(0x101)](_0x564d76['eventHistory']),'ack':!![]});if(_0x564d76[_0x20ed11(0x127)]){_0x564d76[_0x20ed11(0x130)][_0x20ed11(0x125)](_0x301502);if(_0x564d76[_0x20ed11(0x130)][_0x20ed11(0x136)]>RAW_LOG_MAX_SIZE)_0x564d76[_0x20ed11(0x130)][_0x20ed11(0x140)](0x0,_0x564d76[_0x20ed11(0x130)][_0x20ed11(0x136)]-RAW_LOG_MAX_SIZE);await _0x564d76['setStateAsync'](_0x20ed11(0x14b),{'val':JSON[_0x20ed11(0x101)](_0x564d76[_0x20ed11(0x130)]),'ack':!![]}),recordSequence(_0x564d76,_0x301502);}if(_0x40634c[_0x20ed11(0x14a)]&&_0x5f5d02===!![]){if(_0x564d76[_0x20ed11(0x10b)]&&!_0x564d76[_0x20ed11(0x11c)])startExitTimer(_0x564d76);else{if(!_0x564d76[_0x20ed11(0x10b)])setPresence(_0x564d76,!![]);}}else{if(_0x40634c[_0x20ed11(0x153)]===_0x20ed11(0x109)&&_0x5f5d02===!![]){if(_0x564d76[_0x20ed11(0x115)])abortExitTimer(_0x564d76);if(!_0x564d76['isPresent']&&_0x564d76[_0x20ed11(0x103)]===_0x20ed11(0x128))setPresence(_0x564d76,!![]);}}return _0x564d76[_0x20ed11(0x127)]&&_0x40634c[_0x20ed11(0x153)]===_0x20ed11(0x109)&&_0x5f5d02===!![]&&_0x40634c['location']&&_0x564d76[_0x20ed11(0x146)]&&_0x564d76[_0x20ed11(0x146)](_0x20ed11(0x123),{'room':_0x40634c[_0x20ed11(0x10f)]}),_0x301502;}module[a5_0x70f02d(0x12e)]={'processSensorEvent':processSensorEvent,'getOutsideTemperatureNumeric':getOutsideTemperatureNumeric,'setPresence':setPresence,'abortExitTimer':abortExitTimer,'startExitTimer':startExitTimer};function a5_0x4eeb(){const _0x177e41=['178536XZfBOl','unshift','loc','isExit','LTM.rawEventLog','contact','constructor','setStateAsync','16329618amdXQH','shift','.Current.Temperature','präsenz','type','(((.+)+)+)+$','LTM.trainingData.thermodynamics','stringify','klima','currentSystemMode','sensorLastValues','log','dimmer','licht','schalter','motion','search','isPresent','outdoorSensorId','41667740erPRdL','bewegung','location','eventHistory','tür','name','18gtdoFp','58GXzooe','exitTimer','.forecast.current.temp','accuweather','parse','useWeather','includes','exitGraceTimer','isGracePeriodActive','pop','light','temperatur','LTM.trainingData.sequences','apply','occupancy','SIMULATE_SIGNAL','toLowerCase','push','now','isProVersion','normal','toString','door','Unknown','config','switch','exports','968566RkeMhY','rawEventLog','val','1687hUVJfx','[RECORDER]\x20Error:\x20','system.isPresent','error','length','heizung','events.lastEvent','2914432xxRviG','window','2666560TAvGUt','ANALYZE_SEQUENCE','round','kontakt','toISOString','splice','7208WFNrUR','.forecast.current.temperature','presence','getForeignStateAsync','getHours','sendToPythonWrapper'];a5_0x4eeb=function(){return _0x177e41;};return a5_0x4eeb();}