const a5_0x1bcb56=a5_0x984f;(function(_0x57b5b6,_0x2f0c83){const _0x282595=a5_0x984f,_0x404815=_0x57b5b6();while(!![]){try{const _0x2a2d73=parseInt(_0x282595(0xd5))/0x1+-parseInt(_0x282595(0xf1))/0x2+parseInt(_0x282595(0xc6))/0x3+parseInt(_0x282595(0xb3))/0x4*(parseInt(_0x282595(0x9f))/0x5)+parseInt(_0x282595(0xd9))/0x6*(parseInt(_0x282595(0xaa))/0x7)+parseInt(_0x282595(0xba))/0x8+-parseInt(_0x282595(0xb2))/0x9;if(_0x2a2d73===_0x2f0c83)break;else _0x404815['push'](_0x404815['shift']());}catch(_0x5b32c4){_0x404815['push'](_0x404815['shift']());}}}(a5_0x2705,0xa0d5e));const a5_0x15db11=(function(){let _0x5d5c1f=!![];return function(_0x5b301b,_0x525d7d){const _0x295805=_0x5d5c1f?function(){const _0x5895ea=a5_0x984f;if(_0x525d7d){const _0x15edb0=_0x525d7d[_0x5895ea(0xfb)](_0x5b301b,arguments);return _0x525d7d=null,_0x15edb0;}}:function(){};return _0x5d5c1f=![],_0x295805;};}()),a5_0x516856=a5_0x15db11(this,function(){const _0x32907a=a5_0x984f;return a5_0x516856['toString']()[_0x32907a(0xe5)](_0x32907a(0xdd))[_0x32907a(0xe4)]()['constructor'](a5_0x516856)[_0x32907a(0xe5)](_0x32907a(0xdd));});a5_0x516856();'use strict';const HISTORY_MAX_SIZE=0x32,RAW_LOG_MAX_SIZE=0x9c4,THERMO_LOG_SIZE=0x3e8,SEQUENCE_TIMEOUT_MS=0x5*0x3c*0x3e8,MAX_TRAINING_SET_SIZE=0x1f4,EXIT_TIMER_MINUTES=0xf,EXIT_GRACE_PERIOD_SECONDS=0x1e;let activeSequence=[],sequenceTimer=null;async function getOutsideTemperatureNumeric(_0x43da44){const _0x8e4759=a5_0x984f;if(_0x43da44[_0x8e4759(0xca)][_0x8e4759(0xc5)])try{const _0x34e3a5=await _0x43da44[_0x8e4759(0xb7)](_0x43da44[_0x8e4759(0xca)][_0x8e4759(0xc5)]);if(_0x34e3a5&&_0x34e3a5[_0x8e4759(0x106)]!==undefined&&_0x34e3a5[_0x8e4759(0x106)]!==null)return parseFloat(_0x34e3a5['val']);}catch(_0x37d9c4){}const _0x476758=_0x43da44['config'][_0x8e4759(0xc8)];if(!_0x43da44['config'][_0x8e4759(0xdf)]||!_0x476758)return null;try{let _0x4ac620='';if(_0x476758[_0x8e4759(0xef)](_0x8e4759(0xfc)))_0x4ac620=_0x476758+_0x8e4759(0xa5);else{if(_0x476758[_0x8e4759(0xef)]('daswetter'))_0x4ac620=_0x476758+_0x8e4759(0xc7);else{if(_0x476758[_0x8e4759(0xef)](_0x8e4759(0x10c)))_0x4ac620=_0x476758+'.forecast.current.temperature';else{if(_0x476758['includes'](_0x8e4759(0xaf)))_0x4ac620=_0x476758+_0x8e4759(0xc0);}}}if(_0x4ac620){const _0x28ee54=await _0x43da44['getForeignStateAsync'](_0x4ac620);if(_0x28ee54&&_0x28ee54[_0x8e4759(0x106)]!==undefined&&_0x28ee54['val']!==null)return parseFloat(_0x28ee54[_0x8e4759(0x106)]);}}catch(_0x5ac788){}return null;}function a5_0x984f(_0x2d9f47,_0x4b30c){const _0x1222bc=a5_0x2705();return a5_0x984f=function(_0x516856,_0x15db11){_0x516856=_0x516856-0x9d;let _0x270536=_0x1222bc[_0x516856];return _0x270536;},a5_0x984f(_0x2d9f47,_0x4b30c);}async function recordThermodynamics(_0x4f36b2,_0x1fc9bf,_0x44b860,_0x54fa49){const _0x5e6851=a5_0x984f,_0x36d551=await getOutsideTemperatureNumeric(_0x4f36b2);if(_0x36d551===null)return;let _0x5d55af=0x0,_0x46f789=![];if(_0x4f36b2[_0x5e6851(0xca)]['valveMapping'])try{let _0x4ee5a7=_0x4f36b2[_0x5e6851(0xca)][_0x5e6851(0xfd)];if(typeof _0x4ee5a7===_0x5e6851(0xa8))_0x4ee5a7=JSON[_0x5e6851(0xad)](_0x4ee5a7);if(_0x4ee5a7[_0x1fc9bf]){const _0x5a4083=_0x4ee5a7[_0x1fc9bf],_0x2ba428=await _0x4f36b2[_0x5e6851(0xb7)](_0x5a4083);if(_0x2ba428&&_0x2ba428[_0x5e6851(0x106)]!==null&&_0x2ba428[_0x5e6851(0x106)]!==undefined){let _0x2aeba1=Number(_0x2ba428['val']);if(_0x2aeba1<=1.05&&!_0x5a4083[_0x5e6851(0xef)](_0x5e6851(0xe0))&&!_0x5a4083[_0x5e6851(0xef)]('STATE'))_0x2aeba1=_0x2aeba1*0x64;_0x5d55af=Math[_0x5e6851(0xce)](_0x2aeba1),_0x46f789=!![];}}}catch(_0x800d31){}if(!_0x46f789){const _0x3f03e5=[{'from':'.1.ACTUAL_TEMPERATURE','to':_0x5e6851(0xdb)},{'from':_0x5e6851(0xbd),'to':_0x5e6851(0xf9)},{'from':'.1.TEMPERATURE','to':_0x5e6851(0xc9)},{'from':'.ACTUAL_TEMPERATURE','to':_0x5e6851(0x104)},{'from':'temperature','to':_0x5e6851(0x10d)},{'from':_0x5e6851(0xe6),'to':_0x5e6851(0xcb)}];for(const _0x533df5 of _0x3f03e5){if(_0x1fc9bf[_0x5e6851(0xef)](_0x533df5['from'])){const _0xa4f4c6=_0x1fc9bf[_0x5e6851(0xe1)](_0x533df5[_0x5e6851(0xd1)],_0x533df5['to']);try{const _0x215983=await _0x4f36b2[_0x5e6851(0xb7)](_0xa4f4c6);if(_0x215983&&_0x215983[_0x5e6851(0x106)]!==null&&_0x215983[_0x5e6851(0x106)]!==undefined){let _0x46cd1f=Number(_0x215983['val']);if(typeof _0x46cd1f===_0x5e6851(0xa9)){if(_0x46cd1f<=1.05&&_0x533df5['to']['includes'](_0x5e6851(0xde)))_0x46cd1f=_0x46cd1f*0x64;_0x5d55af=Math[_0x5e6851(0xce)](_0x46cd1f),_0x46f789=!![];break;}}}catch(_0x5ea897){}}}}const _0x30066c=await _0x4f36b2[_0x5e6851(0xab)]('LTM.trainingData.thermodynamics');let _0x4e723e=[];if(_0x30066c&&_0x30066c['val'])try{_0x4e723e=JSON['parse'](_0x30066c[_0x5e6851(0x106)]);}catch(_0x2c28d0){}_0x4e723e[_0x5e6851(0xe8)]({'ts':Date[_0x5e6851(0xdc)](),'room':_0x54fa49||_0x5e6851(0xd7),'t_in':_0x44b860,'t_out':_0x36d551,'valve':_0x5d55af});if(_0x4e723e[_0x5e6851(0xbc)]>THERMO_LOG_SIZE)_0x4e723e[_0x5e6851(0xea)]();await _0x4f36b2[_0x5e6851(0x109)](_0x5e6851(0xd4),{'val':JSON[_0x5e6851(0xed)](_0x4e723e),'ack':!![]});}async function saveCompletedSequence(_0x2e043e){const _0x2161f8=a5_0x984f;try{const _0x1dc236=await _0x2e043e[_0x2161f8(0xab)](_0x2161f8(0xf3));let _0x53d0d2=[];if(_0x1dc236&&_0x1dc236[_0x2161f8(0x106)])try{_0x53d0d2=JSON['parse'](_0x1dc236[_0x2161f8(0x106)]);}catch(_0x308c2b){}const _0x352449=activeSequence[0x0]['ts'],_0x469e99=activeSequence[_0x2161f8(0xae)](_0x4b494d=>({'loc':_0x4b494d[_0x2161f8(0xc3)],'t_delta':Math[_0x2161f8(0xce)]((_0x4b494d['ts']-_0x352449)/0x3e8)})),_0x48143c={'timestamp':new Date(_0x352449)[_0x2161f8(0xb0)](),'steps':_0x469e99,'duration':Math[_0x2161f8(0xce)]((activeSequence[activeSequence[_0x2161f8(0xbc)]-0x1]['ts']-_0x352449)/0x3e8),'daytime':new Date(_0x352449)['getHours']()};_0x53d0d2[_0x2161f8(0xe8)](_0x48143c);if(_0x53d0d2['length']>MAX_TRAINING_SET_SIZE)_0x53d0d2[_0x2161f8(0xea)]();await _0x2e043e[_0x2161f8(0x109)]('LTM.trainingData.sequences',{'val':JSON[_0x2161f8(0xed)](_0x53d0d2),'ack':!![]}),_0x2e043e['isProVersion']&&_0x2e043e[_0x2161f8(0x101)]&&_0x2e043e[_0x2161f8(0x101)]('ANALYZE_SEQUENCE',{'sequence':_0x48143c});}catch(_0x79e24c){_0x2e043e[_0x2161f8(0x108)][_0x2161f8(0xa3)](_0x2161f8(0xcf)+_0x79e24c[_0x2161f8(0xa1)]);}}async function recordSequence(_0x38f9d3,_0xa7c5b6){const _0x5b34d4=a5_0x984f,_0xaa57c5=(_0xa7c5b6[_0x5b34d4(0xeb)]||'')[_0x5b34d4(0xfa)](),_0x37ad72=[_0x5b34d4(0xcd),_0x5b34d4(0xa6),_0x5b34d4(0xb8),_0x5b34d4(0xa2),_0x5b34d4(0xa0),_0x5b34d4(0x102),_0x5b34d4(0xbe),'window',_0x5b34d4(0xe2),_0x5b34d4(0x100),_0x5b34d4(0xb1),_0x5b34d4(0xbf),_0x5b34d4(0xc1),_0x5b34d4(0xf4),_0x5b34d4(0xcc),_0x5b34d4(0xd2),_0x5b34d4(0xf8)];if(!_0x37ad72['some'](_0x5d80f3=>_0xaa57c5[_0x5b34d4(0xef)](_0x5d80f3)))return;if(!_0xa7c5b6[_0x5b34d4(0x107)])return;if(sequenceTimer)clearTimeout(sequenceTimer);activeSequence[_0x5b34d4(0xe8)]({'loc':_0xa7c5b6[_0x5b34d4(0xa4)]||_0x5b34d4(0xd7),'id':_0xa7c5b6['id'],'ts':Date[_0x5b34d4(0xdc)]()}),sequenceTimer=setTimeout(async()=>{if(activeSequence['length']>0x1)await saveCompletedSequence(_0x38f9d3);activeSequence=[];},SEQUENCE_TIMEOUT_MS);}function a5_0x2705(){const _0x30f53d=['fenster','some','toString','search','Temperature','sensorLastValues','push','\x20from\x20','shift','type','splice','stringify','pop','includes','isGracePeriodActive','2127422jVUvRW','exitGraceTimer','LTM.trainingData.sequences','switch','system.isPresent','eventHistory','lastTrackerEventTime','lampe','.1.VALVE_STATE','toLowerCase','apply','accuweather','valveMapping','debug','schloss','contact','sendToPythonWrapper','door','[RECORDER]\x20Ignored\x20implausible\x20temperature:\x20','.LEVEL','rawEventLog','val','value','log','setStateAsync','unshift','SIMULATE_SIGNAL','openweathermap','level','lock','temperatur','40GnhVPF','occupancy','message','presence','error','location','.Current.Temperature','bewegung','exitTimer','string','number','70mEsSrI','getStateAsync','LTM.rawEventLog','parse','map','weatherunderground','toISOString','kontakt','16610697GPzAlw','568948wwtyuj','heizung','thermostat','handle','getForeignStateAsync','präsenz','klima','8989440pyFYgs','griff','length','.1.ACTUAL_TEMPERATURE','tür','light','.forecast.current.temp','licht','isProVersion','loc','isPresent','outdoorSensorId','2148057jHCPAE','.NextHours.Location_1.Day_1.current.temp_value','weatherInstance','.4.VALVE_STATE','config','Valve','schalter','motion','round','[RECORDER]\x20Error:\x20','window','from','dimmer','events.history','LTM.trainingData.thermodynamics','480261LFtLHx','name','Unknown','events.lastEvent','66162rzlAEE','exports','.1.LEVEL','now','(((.+)+)+)+$','LEVEL','useWeather','STATUS','replace'];a5_0x2705=function(){return _0x30f53d;};return a5_0x2705();}function startExitTimer(_0x4f2537){const _0x4490fb=a5_0x984f;abortExitTimer(_0x4f2537),_0x4f2537[_0x4490fb(0xf0)]=!![],_0x4f2537[_0x4490fb(0xf2)]=setTimeout(()=>{const _0x3b8e37=_0x4490fb;_0x4f2537[_0x3b8e37(0xf0)]=![];},EXIT_GRACE_PERIOD_SECONDS*0x3e8),_0x4f2537[_0x4490fb(0xa7)]=setTimeout(()=>{const _0x638e8=_0x4490fb;setPresence(_0x4f2537,![]),_0x4f2537[_0x638e8(0xa7)]=null;},EXIT_TIMER_MINUTES*0x3c*0x3e8);}function abortExitTimer(_0x1d758b){const _0x2e7c3f=a5_0x984f;if(_0x1d758b['exitTimer'])clearTimeout(_0x1d758b['exitTimer']);if(_0x1d758b['exitGraceTimer'])clearTimeout(_0x1d758b[_0x2e7c3f(0xf2)]);_0x1d758b['exitTimer']=null,_0x1d758b[_0x2e7c3f(0xf2)]=null,_0x1d758b[_0x2e7c3f(0xf0)]=![];}async function setPresence(_0x27d750,_0x3c7e8c){const _0x3005b5=a5_0x984f;if(_0x27d750['isPresent']===_0x3c7e8c)return;_0x27d750[_0x3005b5(0xc4)]=_0x3c7e8c,await _0x27d750[_0x3005b5(0x109)](_0x3005b5(0xf5),{'val':_0x3c7e8c,'ack':!![]});}async function processSensorEvent(_0x115c36,_0x1747e4,_0x247ead,_0x1ddeee){const _0x1afb2e=a5_0x984f;if(!_0x1ddeee)return null;const _0x4dc442=_0x247ead[_0x1afb2e(0x106)],_0x511a5c=Date[_0x1afb2e(0xdc)](),_0x407e0f=_0x115c36[_0x1afb2e(0xe7)][_0x1747e4],_0x1ded4b=(_0x1ddeee[_0x1afb2e(0xeb)]||'')[_0x1afb2e(0xfa)](),_0x3e73f4=_0x1ded4b['includes']('temperature')||_0x1ded4b[_0x1afb2e(0xef)](_0x1afb2e(0x9e))||_0x1ded4b[_0x1afb2e(0xef)](_0x1afb2e(0xb9))||_0x1ded4b[_0x1afb2e(0xef)](_0x1afb2e(0xb4))||_0x1ded4b[_0x1afb2e(0xef)](_0x1afb2e(0xb5));if(_0x3e73f4&&typeof _0x4dc442===_0x1afb2e(0xa9)){if(_0x4dc442>0x50||_0x4dc442<-0x32)return _0x115c36[_0x1afb2e(0x108)][_0x1afb2e(0xfe)](_0x1afb2e(0x103)+_0x4dc442+_0x1afb2e(0xe9)+_0x1747e4),null;}_0x115c36['sensorLastValues'][_0x1747e4]=_0x4dc442;if(!_0x1ddeee['logDuplicates']&&_0x407e0f!=undefined&&_0x407e0f==_0x4dc442)return null;_0x115c36[_0x1afb2e(0xc2)]&&_0x3e73f4&&recordThermodynamics(_0x115c36,_0x1747e4,_0x4dc442,_0x1ddeee[_0x1afb2e(0xa4)]);const _0x2b8234={'timestamp':_0x511a5c,'id':_0x1747e4,'name':_0x1ddeee[_0x1afb2e(0xd6)],'type':_0x1ddeee[_0x1afb2e(0xeb)],'location':_0x1ddeee[_0x1afb2e(0xa4)],'value':_0x4dc442};_0x115c36[_0x1afb2e(0xf6)][_0x1afb2e(0x10a)](_0x2b8234);if(_0x115c36[_0x1afb2e(0xf6)][_0x1afb2e(0xbc)]>HISTORY_MAX_SIZE)_0x115c36[_0x1afb2e(0xf6)][_0x1afb2e(0xee)]();await _0x115c36['setStateAsync'](_0x1afb2e(0xd8),{'val':JSON[_0x1afb2e(0xed)](_0x2b8234),'ack':!![]}),await _0x115c36['setStateAsync'](_0x1afb2e(0xd3),{'val':JSON[_0x1afb2e(0xed)](_0x115c36['eventHistory']),'ack':!![]});if(_0x115c36['isProVersion']){_0x115c36[_0x1afb2e(0x105)][_0x1afb2e(0xe8)](_0x2b8234);if(_0x115c36[_0x1afb2e(0x105)][_0x1afb2e(0xbc)]>RAW_LOG_MAX_SIZE)_0x115c36[_0x1afb2e(0x105)][_0x1afb2e(0xec)](0x0,_0x115c36[_0x1afb2e(0x105)]['length']-RAW_LOG_MAX_SIZE);await _0x115c36[_0x1afb2e(0x109)](_0x1afb2e(0xac),{'val':JSON[_0x1afb2e(0xed)](_0x115c36[_0x1afb2e(0x105)]),'ack':!![]}),recordSequence(_0x115c36,_0x2b8234);}if(_0x1ddeee['isExit']&&_0x4dc442===!![]){if(_0x115c36[_0x1afb2e(0xc4)]&&!_0x115c36[_0x1afb2e(0xf0)])startExitTimer(_0x115c36);else{if(!_0x115c36[_0x1afb2e(0xc4)])setPresence(_0x115c36,!![]);}}else{if(_0x1ddeee[_0x1afb2e(0xeb)]===_0x1afb2e(0xcd)&&_0x4dc442===!![]){if(_0x115c36[_0x1afb2e(0xa7)])abortExitTimer(_0x115c36);if(!_0x115c36['isPresent']&&_0x115c36['currentSystemMode']==='normal')setPresence(_0x115c36,!![]);}}if(_0x115c36['isProVersion']&&_0x115c36[_0x1afb2e(0x101)]){_0x1ddeee[_0x1afb2e(0xeb)]===_0x1afb2e(0xcd)&&_0x4dc442===!![]&&_0x1ddeee[_0x1afb2e(0xa4)]&&_0x115c36[_0x1afb2e(0x101)](_0x1afb2e(0x10b),{'room':_0x1ddeee[_0x1afb2e(0xa4)]});const _0x380383=['door',_0x1afb2e(0xbe),_0x1afb2e(0xd0),_0x1afb2e(0xe2),_0x1afb2e(0xbb),_0x1afb2e(0xb6),_0x1afb2e(0x9d),_0x1afb2e(0xff)][_0x1afb2e(0xe3)](_0x2ef8be=>_0x1ded4b[_0x1afb2e(0xef)](_0x2ef8be)),_0x5186cd=[_0x1afb2e(0xbf),_0x1afb2e(0xc1),_0x1afb2e(0xf4),_0x1afb2e(0xcc),'dimmer',_0x1afb2e(0xf8)][_0x1afb2e(0xe3)](_0x2b50a5=>_0x1ded4b[_0x1afb2e(0xef)](_0x2b50a5)),_0x394cd7=['motion',_0x1afb2e(0xa6),_0x1afb2e(0xb8),'presence',_0x1afb2e(0xa0)][_0x1afb2e(0xe3)](_0x4cf3e0=>_0x1ded4b['includes'](_0x4cf3e0));if(_0x1ddeee[_0x1afb2e(0xa4)]&&(_0x380383||_0x5186cd||_0x394cd7)){const _0x22b154=_0x4dc442===!![]||typeof _0x4dc442===_0x1afb2e(0xa9)&&_0x4dc442>0x0,_0x5c5766=_0x380383&&!_0x22b154&&_0x407e0f!==undefined&&_0x407e0f!=_0x4dc442;if(_0x22b154||_0x5c5766){const _0x3889da=_0x115c36[_0x1afb2e(0xf7)]||_0x511a5c,_0x319784=(_0x511a5c-_0x3889da)/0x3e8;_0x115c36[_0x1afb2e(0xf7)]=_0x511a5c,_0x115c36[_0x1afb2e(0x101)]('TRACK_EVENT',{'room':_0x1ddeee['location'],'dt':_0x319784});}}}return _0x2b8234;}module[a5_0x1bcb56(0xda)]={'processSensorEvent':processSensorEvent,'getOutsideTemperatureNumeric':getOutsideTemperatureNumeric,'setPresence':setPresence,'abortExitTimer':abortExitTimer,'startExitTimer':startExitTimer};