const a5_0x5af684=a5_0x521b;(function(_0x414bb8,_0x44396a){const _0x49585d=a5_0x521b,_0x43ea9c=_0x414bb8();while(!![]){try{const _0xc24715=parseInt(_0x49585d(0xb5))/0x1+-parseInt(_0x49585d(0xeb))/0x2*(parseInt(_0x49585d(0xa9))/0x3)+parseInt(_0x49585d(0xb7))/0x4*(-parseInt(_0x49585d(0xab))/0x5)+-parseInt(_0x49585d(0xbd))/0x6*(parseInt(_0x49585d(0xbb))/0x7)+parseInt(_0x49585d(0x9b))/0x8+parseInt(_0x49585d(0xb3))/0x9+parseInt(_0x49585d(0xf3))/0xa;if(_0xc24715===_0x44396a)break;else _0x43ea9c['push'](_0x43ea9c['shift']());}catch(_0x4cfb62){_0x43ea9c['push'](_0x43ea9c['shift']());}}}(a5_0x8b56,0xbb26f));const a5_0x5d9fa1=(function(){let _0x2821cb=!![];return function(_0x3517a6,_0x9839c6){const _0x39f78e=_0x2821cb?function(){const _0x56cc2e=a5_0x521b;if(_0x9839c6){const _0x35c5fd=_0x9839c6[_0x56cc2e(0xa2)](_0x3517a6,arguments);return _0x9839c6=null,_0x35c5fd;}}:function(){};return _0x2821cb=![],_0x39f78e;};}()),a5_0x4f75dd=a5_0x5d9fa1(this,function(){const _0x2eb7b3=a5_0x521b;return a5_0x4f75dd[_0x2eb7b3(0xa4)]()[_0x2eb7b3(0xdc)]('(((.+)+)+)+$')[_0x2eb7b3(0xa4)]()[_0x2eb7b3(0xd2)](a5_0x4f75dd)[_0x2eb7b3(0xdc)](_0x2eb7b3(0xf4));});a5_0x4f75dd();'use strict';const HISTORY_MAX_SIZE=0x32,RAW_LOG_MAX_SIZE=0x9c4,THERMO_LOG_SIZE=0x3e8,SEQUENCE_TIMEOUT_MS=0x5*0x3c*0x3e8,MAX_TRAINING_SET_SIZE=0x1f4,EXIT_TIMER_MINUTES=0xf,EXIT_GRACE_PERIOD_SECONDS=0x1e;function a5_0x521b(_0x20c2f5,_0x37a34a){const _0x4ab9b4=a5_0x8b56();return a5_0x521b=function(_0x4f75dd,_0x5d9fa1){_0x4f75dd=_0x4f75dd-0x9a;let _0x8b56d1=_0x4ab9b4[_0x4f75dd];return _0x8b56d1;},a5_0x521b(_0x20c2f5,_0x37a34a);}let activeSequence=[],sequenceTimer=null;async function getOutsideTemperatureNumeric(_0x473922){const _0x3447d3=a5_0x521b;if(_0x473922[_0x3447d3(0xac)][_0x3447d3(0xec)])try{const _0x2baa82=await _0x473922[_0x3447d3(0xe8)](_0x473922['config']['outdoorSensorId']);if(_0x2baa82&&_0x2baa82['val']!==undefined&&_0x2baa82[_0x3447d3(0xd9)]!==null)return parseFloat(_0x2baa82[_0x3447d3(0xd9)]);}catch(_0x365db1){}const _0x17655b=_0x473922[_0x3447d3(0xac)][_0x3447d3(0xdf)];if(!_0x473922[_0x3447d3(0xac)][_0x3447d3(0xd4)]||!_0x17655b)return null;try{let _0xd7a868='';if(_0x17655b['includes'](_0x3447d3(0xe0)))_0xd7a868=_0x17655b+_0x3447d3(0xc2);else{if(_0x17655b[_0x3447d3(0xba)](_0x3447d3(0xd0)))_0xd7a868=_0x17655b+'.NextHours.Location_1.Day_1.current.temp_value';else{if(_0x17655b[_0x3447d3(0xba)](_0x3447d3(0xc6)))_0xd7a868=_0x17655b+_0x3447d3(0xa0);else{if(_0x17655b['includes'](_0x3447d3(0xda)))_0xd7a868=_0x17655b+_0x3447d3(0xca);}}}if(_0xd7a868){const _0x452d0c=await _0x473922[_0x3447d3(0xe8)](_0xd7a868);if(_0x452d0c&&_0x452d0c[_0x3447d3(0xd9)]!==undefined&&_0x452d0c['val']!==null)return parseFloat(_0x452d0c[_0x3447d3(0xd9)]);}}catch(_0x3c1b94){}return null;}async function recordThermodynamics(_0x1fc82c,_0x374eed,_0x425072,_0x3fa7ba){const _0x232b97=a5_0x521b,_0x54f083=await getOutsideTemperatureNumeric(_0x1fc82c);let _0x2dd13c=0x0;if(_0x374eed[_0x232b97(0xba)](_0x232b97(0xc0))){const _0x561b79=[{'from':_0x232b97(0xe3),'to':_0x232b97(0xb4)},{'from':_0x232b97(0xe3),'to':'.1.VALVE_STATE'},{'from':'.1.TEMPERATURE','to':_0x232b97(0xea)},{'from':_0x232b97(0xaa),'to':_0x232b97(0xd1)}];for(const _0x3321e5 of _0x561b79){if(_0x374eed[_0x232b97(0xba)](_0x3321e5[_0x232b97(0xf5)])){const _0x39ba4c=_0x374eed[_0x232b97(0xbe)](_0x3321e5['from'],_0x3321e5['to']);try{const _0x3a5f0f=await _0x1fc82c[_0x232b97(0xe8)](_0x39ba4c);if(_0x3a5f0f&&_0x3a5f0f[_0x232b97(0xd9)]!==null&&_0x3a5f0f['val']!==undefined){let _0x310e59=_0x3a5f0f[_0x232b97(0xd9)];typeof _0x310e59===_0x232b97(0xae)&&_0x310e59<=1.05&&_0x3321e5['to'][_0x232b97(0xba)](_0x232b97(0xd7))&&(_0x310e59=_0x310e59*0x64);_0x2dd13c=Math[_0x232b97(0xd6)](_0x310e59);break;}}catch(_0x569678){}}}}const _0x2351c1=await _0x1fc82c[_0x232b97(0xdb)](_0x232b97(0xe9));let _0x44996d=[];if(_0x2351c1&&_0x2351c1['val'])try{_0x44996d=JSON['parse'](_0x2351c1[_0x232b97(0xd9)]);}catch(_0x921845){}_0x44996d[_0x232b97(0xe7)]({'ts':Date[_0x232b97(0xc5)](),'room':_0x3fa7ba||_0x232b97(0xaf),'t_in':_0x425072,'t_out':_0x54f083,'valve':_0x2dd13c});if(_0x44996d[_0x232b97(0xc3)]>THERMO_LOG_SIZE)_0x44996d['shift']();await _0x1fc82c[_0x232b97(0xde)]('LTM.trainingData.thermodynamics',{'val':JSON[_0x232b97(0xa8)](_0x44996d),'ack':!![]});}async function saveCompletedSequence(_0x3c013e){const _0x1c2f06=a5_0x521b;try{const _0x52f2bf=await _0x3c013e[_0x1c2f06(0xdb)](_0x1c2f06(0xa6));let _0x33276f=[];if(_0x52f2bf&&_0x52f2bf[_0x1c2f06(0xd9)])try{_0x33276f=JSON[_0x1c2f06(0xc1)](_0x52f2bf['val']);}catch(_0x60233e){}const _0x3b922e=activeSequence[0x0]['ts'],_0x84219f=activeSequence[_0x1c2f06(0xc7)](_0x5e9832=>({'loc':_0x5e9832[_0x1c2f06(0xf2)],'t_delta':Math['round']((_0x5e9832['ts']-_0x3b922e)/0x3e8)})),_0x509b47={'timestamp':new Date(_0x3b922e)[_0x1c2f06(0xe5)](),'steps':_0x84219f,'duration':Math['round']((activeSequence[activeSequence[_0x1c2f06(0xc3)]-0x1]['ts']-_0x3b922e)/0x3e8),'daytime':new Date(_0x3b922e)[_0x1c2f06(0xad)]()};_0x33276f[_0x1c2f06(0xe7)](_0x509b47);if(_0x33276f[_0x1c2f06(0xc3)]>MAX_TRAINING_SET_SIZE)_0x33276f[_0x1c2f06(0xdd)]();await _0x3c013e[_0x1c2f06(0xde)](_0x1c2f06(0xa6),{'val':JSON[_0x1c2f06(0xa8)](_0x33276f),'ack':!![]}),_0x3c013e[_0x1c2f06(0xa3)]&&_0x3c013e[_0x1c2f06(0xf1)]&&_0x3c013e['sendToPythonWrapper'](_0x1c2f06(0xc9),{'sequence':_0x509b47});}catch(_0x38ba9d){_0x3c013e[_0x1c2f06(0xe2)]['error'](_0x1c2f06(0xd5)+_0x38ba9d['message']);}}async function recordSequence(_0x15c663,_0x2790f9){const _0x3cb571=a5_0x521b,_0x38855f=(_0x2790f9[_0x3cb571(0xa1)]||'')[_0x3cb571(0xb6)](),_0x4ee239=[_0x3cb571(0xd8),_0x3cb571(0xf7),_0x3cb571(0x9c),'presence',_0x3cb571(0xbf),_0x3cb571(0x9e),_0x3cb571(0xa5),_0x3cb571(0xe4),_0x3cb571(0xed),_0x3cb571(0xe1),_0x3cb571(0xd3),_0x3cb571(0xb2),'licht',_0x3cb571(0xcb),_0x3cb571(0xc4),_0x3cb571(0xf6),'lampe'];if(!_0x4ee239[_0x3cb571(0xf0)](_0x23da54=>_0x38855f[_0x3cb571(0xba)](_0x23da54)))return;if(!_0x2790f9['value'])return;if(sequenceTimer)clearTimeout(sequenceTimer);activeSequence[_0x3cb571(0xe7)]({'loc':_0x2790f9[_0x3cb571(0xb9)]||_0x3cb571(0xaf),'id':_0x2790f9['id'],'ts':Date[_0x3cb571(0xc5)]()}),sequenceTimer=setTimeout(async()=>{const _0x3ada85=_0x3cb571;if(activeSequence[_0x3ada85(0xc3)]>0x1)await saveCompletedSequence(_0x15c663);activeSequence=[];},SEQUENCE_TIMEOUT_MS);}function startExitTimer(_0x517b7e){const _0xaff5=a5_0x521b;abortExitTimer(_0x517b7e),_0x517b7e[_0xaff5(0xc8)]=!![],_0x517b7e[_0xaff5(0xbc)]=setTimeout(()=>{const _0x50daec=_0xaff5;_0x517b7e[_0x50daec(0xc8)]=![];},EXIT_GRACE_PERIOD_SECONDS*0x3e8),_0x517b7e['exitTimer']=setTimeout(()=>{const _0x5afb5d=_0xaff5;setPresence(_0x517b7e,![]),_0x517b7e[_0x5afb5d(0xcf)]=null;},EXIT_TIMER_MINUTES*0x3c*0x3e8);}function abortExitTimer(_0x4bcc94){const _0x237fcf=a5_0x521b;if(_0x4bcc94[_0x237fcf(0xcf)])clearTimeout(_0x4bcc94['exitTimer']);if(_0x4bcc94[_0x237fcf(0xbc)])clearTimeout(_0x4bcc94[_0x237fcf(0xbc)]);_0x4bcc94['exitTimer']=null,_0x4bcc94[_0x237fcf(0xbc)]=null,_0x4bcc94[_0x237fcf(0xc8)]=![];}async function setPresence(_0x4ed97a,_0x1a21d0){const _0x18110d=a5_0x521b;if(_0x4ed97a['isPresent']===_0x1a21d0)return;_0x4ed97a[_0x18110d(0xb0)]=_0x1a21d0,await _0x4ed97a[_0x18110d(0xde)](_0x18110d(0xcd),{'val':_0x1a21d0,'ack':!![]});}async function processSensorEvent(_0x49c6d2,_0x2cf2f5,_0x370779,_0x118407){const _0x474bbe=a5_0x521b;if(!_0x118407)return null;const _0x14ba68=_0x370779['val'],_0x44f51a=Date['now'](),_0x7e239e=_0x49c6d2[_0x474bbe(0x9d)][_0x2cf2f5];_0x49c6d2[_0x474bbe(0x9d)][_0x2cf2f5]=_0x14ba68;if(!_0x118407[_0x474bbe(0xef)]&&_0x7e239e!=undefined&&_0x7e239e==_0x14ba68)return null;const _0x44e408=(_0x118407[_0x474bbe(0xa1)]||'')[_0x474bbe(0xb6)](),_0x25d719=_0x44e408[_0x474bbe(0xba)]('temperature')||_0x44e408[_0x474bbe(0xba)](_0x474bbe(0xb1))||_0x44e408['includes']('klima')||_0x44e408[_0x474bbe(0xba)]('heizung');_0x49c6d2[_0x474bbe(0xa3)]&&_0x25d719&&recordThermodynamics(_0x49c6d2,_0x2cf2f5,_0x14ba68,_0x118407[_0x474bbe(0xb9)]);const _0x2620ea={'timestamp':_0x44f51a,'id':_0x2cf2f5,'name':_0x118407['name'],'type':_0x118407[_0x474bbe(0xa1)],'location':_0x118407[_0x474bbe(0xb9)],'value':_0x14ba68};_0x49c6d2[_0x474bbe(0xa7)][_0x474bbe(0xe6)](_0x2620ea);if(_0x49c6d2['eventHistory'][_0x474bbe(0xc3)]>HISTORY_MAX_SIZE)_0x49c6d2['eventHistory'][_0x474bbe(0xcc)]();await _0x49c6d2[_0x474bbe(0xde)](_0x474bbe(0xce),{'val':JSON[_0x474bbe(0xa8)](_0x2620ea),'ack':!![]}),await _0x49c6d2[_0x474bbe(0xde)](_0x474bbe(0xee),{'val':JSON[_0x474bbe(0xa8)](_0x49c6d2[_0x474bbe(0xa7)]),'ack':!![]});if(_0x49c6d2[_0x474bbe(0xa3)]){_0x49c6d2['rawEventLog']['push'](_0x2620ea);if(_0x49c6d2[_0x474bbe(0x9f)]['length']>RAW_LOG_MAX_SIZE)_0x49c6d2[_0x474bbe(0x9f)]['splice'](0x0,_0x49c6d2[_0x474bbe(0x9f)][_0x474bbe(0xc3)]-RAW_LOG_MAX_SIZE);await _0x49c6d2[_0x474bbe(0xde)](_0x474bbe(0xb8),{'val':JSON['stringify'](_0x49c6d2[_0x474bbe(0x9f)]),'ack':!![]}),recordSequence(_0x49c6d2,_0x2620ea);}if(_0x118407['isExit']&&_0x14ba68===!![]){if(_0x49c6d2['isPresent']&&!_0x49c6d2[_0x474bbe(0xc8)])startExitTimer(_0x49c6d2);else{if(!_0x49c6d2[_0x474bbe(0xb0)])setPresence(_0x49c6d2,!![]);}}else{if(_0x118407[_0x474bbe(0xa1)]===_0x474bbe(0xd8)&&_0x14ba68===!![]){if(_0x49c6d2[_0x474bbe(0xcf)])abortExitTimer(_0x49c6d2);if(!_0x49c6d2[_0x474bbe(0xb0)]&&_0x49c6d2['currentSystemMode']==='normal')setPresence(_0x49c6d2,!![]);}}return _0x49c6d2[_0x474bbe(0xa3)]&&_0x118407[_0x474bbe(0xa1)]==='motion'&&_0x14ba68===!![]&&_0x118407[_0x474bbe(0xb9)]&&_0x49c6d2[_0x474bbe(0xf1)]&&_0x49c6d2['sendToPythonWrapper']('SIMULATE_SIGNAL',{'room':_0x118407['location']}),_0x2620ea;}function a5_0x8b56(){const _0x3bd909=['exitGraceTimer','30RBJzLM','replace','occupancy','hm-rpc','parse','.Current.Temperature','length','schalter','now','openweathermap','map','isGracePeriodActive','ANALYZE_SEQUENCE','.forecast.current.temp','switch','pop','system.isPresent','events.lastEvent','exitTimer','daswetter','.LEVEL','constructor','kontakt','useWeather','[RECORDER]\x20Error:\x20','round','LEVEL','motion','val','weatherunderground','getStateAsync','search','shift','setStateAsync','weatherInstance','accuweather','contact','log','.1.ACTUAL_TEMPERATURE','window','toISOString','unshift','push','getForeignStateAsync','LTM.trainingData.thermodynamics','.4.VALVE_STATE','14vWjqhO','outdoorSensorId','fenster','events.history','logDuplicates','some','sendToPythonWrapper','loc','26224110mFPdmg','(((.+)+)+)+$','from','dimmer','bewegung','exports','2892888FMoDTK','präsenz','sensorLastValues','door','rawEventLog','.forecast.current.temperature','type','apply','isProVersion','toString','tür','LTM.trainingData.sequences','eventHistory','stringify','579990gZcHTt','.ACTUAL_TEMPERATURE','30vcxkex','config','getHours','number','Unknown','isPresent','temperatur','light','884205owLjrN','.1.LEVEL','1148989YKgRhE','toLowerCase','533224tZNGkL','LTM.rawEventLog','location','includes','1836149erxlAv'];a5_0x8b56=function(){return _0x3bd909;};return a5_0x8b56();}module[a5_0x5af684(0x9a)]={'processSensorEvent':processSensorEvent,'getOutsideTemperatureNumeric':getOutsideTemperatureNumeric,'setPresence':setPresence,'abortExitTimer':abortExitTimer,'startExitTimer':startExitTimer};