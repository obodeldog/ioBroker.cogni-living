const a5_0x22628f=a5_0x15cf;(function(_0x256204,_0x207119){const _0x3117aa=a5_0x15cf,_0x1b350f=_0x256204();while(!![]){try{const _0x32b01c=parseInt(_0x3117aa(0x186))/0x1+-parseInt(_0x3117aa(0x198))/0x2*(parseInt(_0x3117aa(0x1ba))/0x3)+-parseInt(_0x3117aa(0x187))/0x4*(parseInt(_0x3117aa(0x177))/0x5)+-parseInt(_0x3117aa(0x1a7))/0x6*(parseInt(_0x3117aa(0x1bf))/0x7)+-parseInt(_0x3117aa(0x196))/0x8*(-parseInt(_0x3117aa(0x1b5))/0x9)+-parseInt(_0x3117aa(0x17e))/0xa*(parseInt(_0x3117aa(0x181))/0xb)+parseInt(_0x3117aa(0x1bc))/0xc;if(_0x32b01c===_0x207119)break;else _0x1b350f['push'](_0x1b350f['shift']());}catch(_0x243a10){_0x1b350f['push'](_0x1b350f['shift']());}}}(a5_0x1557,0x653e9));const a5_0x43d89d=(function(){let _0x3c2212=!![];return function(_0x3c734c,_0x320e5c){const _0x3b5a13=_0x3c2212?function(){const _0xab2a2e=a5_0x15cf;if(_0x320e5c){const _0x317401=_0x320e5c[_0xab2a2e(0x1d6)](_0x3c734c,arguments);return _0x320e5c=null,_0x317401;}}:function(){};return _0x3c2212=![],_0x3b5a13;};}()),a5_0x3beda5=a5_0x43d89d(this,function(){const _0xd96665=a5_0x15cf;return a5_0x3beda5[_0xd96665(0x1b7)]()[_0xd96665(0x1a3)](_0xd96665(0x1a0))['toString']()['constructor'](a5_0x3beda5)['search'](_0xd96665(0x1a0));});a5_0x3beda5();function a5_0x1557(){const _0x131ee8=['toString','val','exports','2493ELSeKi','isPresent','9823656mNsjKF','config','temperature','234395gmujjj','now','round','TRACK_EVENT','lampe','isProVersion','map','.LEVEL','splice','.1.VALVE_STATE','normal','weatherInstance','pop','log','SIMULATE_SIGNAL','STATUS','.4.VALVE_STATE','loc','[RECORDER]\x20Ignored\x20implausible\x20temperature:\x20','location','LEVEL','klima','.1.TEMPERATURE','apply','number','Valve','Unknown','.1.ACTUAL_TEMPERATURE','getStateAsync','präsenz','parse','type','rawEventLog','LTM.trainingData.thermodynamics','setStateAsync','.forecast.current.temperature','light','message','occupancy','door','debug','[RECORDER]\x20Error:\x20','handle','getForeignStateAsync','lastTrackerEventTime','system.isPresent','299770nLRHDN','schloss','eventHistory','exitTimer','stringify','temperatur','shift','3490mKXyyN','from','LTM.rawEventLog','2761zQSLAV','toLowerCase','error','analysis.health.todayVector','push','489278dXCJgh','36zvsrCI','fill','logDuplicates','value','accuweather','STATE','.forecast.current.temp','valveMapping','isGracePeriodActive','length','string','events.history','useWeather','unshift','LTM.trainingData.sequences','28816hwxEbk','lock','770UYzyjT','sendToPythonWrapper','exitGraceTimer','includes','daswetter','presence','dimmer','replace','(((.+)+)+)+$','fenster','schalter','search','contact','getDate','window','102SwXgli','outdoorSensorId','licht','sensorLastValues','weatherunderground','heizung','openweathermap','tür','some','currentSystemMode','thermostat','.ACTUAL_TEMPERATURE','bewegung','griff','1557tMPImb','motion'];a5_0x1557=function(){return _0x131ee8;};return a5_0x1557();}'use strict';const HISTORY_MAX_SIZE=0x32,RAW_LOG_MAX_SIZE=0x9c4,THERMO_LOG_SIZE=0x3e8,SEQUENCE_TIMEOUT_MS=0x5*0x3c*0x3e8,MAX_TRAINING_SET_SIZE=0x1f4,EXIT_TIMER_MINUTES=0xf,EXIT_GRACE_PERIOD_SECONDS=0x1e;let activeSequence=[],sequenceTimer=null;async function getOutsideTemperatureNumeric(_0x554226){const _0x3ead0c=a5_0x15cf;if(_0x554226[_0x3ead0c(0x1bd)]['outdoorSensorId'])try{const _0x3018f0=await _0x554226[_0x3ead0c(0x174)](_0x554226[_0x3ead0c(0x1bd)][_0x3ead0c(0x1a8)]);if(_0x3018f0&&_0x3018f0[_0x3ead0c(0x1b8)]!==undefined&&_0x3018f0[_0x3ead0c(0x1b8)]!==null)return parseFloat(_0x3018f0['val']);}catch(_0x4f30d7){}const _0xcf1532=_0x554226[_0x3ead0c(0x1bd)][_0x3ead0c(0x1ca)];if(!_0x554226[_0x3ead0c(0x1bd)][_0x3ead0c(0x193)]||!_0xcf1532)return null;try{let _0x49ad19='';if(_0xcf1532['includes'](_0x3ead0c(0x18b)))_0x49ad19=_0xcf1532+'.Current.Temperature';else{if(_0xcf1532[_0x3ead0c(0x19b)](_0x3ead0c(0x19c)))_0x49ad19=_0xcf1532+'.NextHours.Location_1.Day_1.current.temp_value';else{if(_0xcf1532[_0x3ead0c(0x19b)](_0x3ead0c(0x1ad)))_0x49ad19=_0xcf1532+_0x3ead0c(0x16c);else{if(_0xcf1532[_0x3ead0c(0x19b)](_0x3ead0c(0x1ab)))_0x49ad19=_0xcf1532+_0x3ead0c(0x18d);}}}if(_0x49ad19){const _0x54e07d=await _0x554226[_0x3ead0c(0x174)](_0x49ad19);if(_0x54e07d&&_0x54e07d[_0x3ead0c(0x1b8)]!==undefined&&_0x54e07d[_0x3ead0c(0x1b8)]!==null)return parseFloat(_0x54e07d[_0x3ead0c(0x1b8)]);}}catch(_0x2ff2f8){}return null;}async function recordThermodynamics(_0x3400e7,_0x52dbe4,_0x5eeadf,_0x1b340f){const _0x1585e3=a5_0x15cf,_0x1e88c0=await getOutsideTemperatureNumeric(_0x3400e7);if(_0x1e88c0===null)return;let _0x39f679=0x0,_0x287d2c=![];if(_0x3400e7[_0x1585e3(0x1bd)][_0x1585e3(0x18e)])try{let _0x1befea=_0x3400e7[_0x1585e3(0x1bd)][_0x1585e3(0x18e)];if(typeof _0x1befea===_0x1585e3(0x191))_0x1befea=JSON['parse'](_0x1befea);if(_0x1befea[_0x52dbe4]){const _0x50a656=_0x1befea[_0x52dbe4],_0x369184=await _0x3400e7[_0x1585e3(0x174)](_0x50a656);if(_0x369184&&_0x369184[_0x1585e3(0x1b8)]!==null&&_0x369184[_0x1585e3(0x1b8)]!==undefined){let _0x10efd7=Number(_0x369184['val']);if(_0x10efd7<=1.05&&!_0x50a656[_0x1585e3(0x19b)](_0x1585e3(0x1ce))&&!_0x50a656[_0x1585e3(0x19b)](_0x1585e3(0x18c)))_0x10efd7=_0x10efd7*0x64;_0x39f679=Math[_0x1585e3(0x1c1)](_0x10efd7),_0x287d2c=!![];}}}catch(_0x2b23dd){}if(!_0x287d2c){const _0x3538a8=[{'from':'.1.ACTUAL_TEMPERATURE','to':'.1.LEVEL'},{'from':_0x1585e3(0x164),'to':_0x1585e3(0x1c8)},{'from':_0x1585e3(0x1d5),'to':_0x1585e3(0x1cf)},{'from':_0x1585e3(0x1b2),'to':_0x1585e3(0x1c6)},{'from':_0x1585e3(0x1be),'to':'level'},{'from':'Temperature','to':_0x1585e3(0x1d8)}];for(const _0x30c8ef of _0x3538a8){if(_0x52dbe4[_0x1585e3(0x19b)](_0x30c8ef[_0x1585e3(0x17f)])){const _0x1b4213=_0x52dbe4[_0x1585e3(0x19f)](_0x30c8ef['from'],_0x30c8ef['to']);try{const _0x477dc7=await _0x3400e7[_0x1585e3(0x174)](_0x1b4213);if(_0x477dc7&&_0x477dc7[_0x1585e3(0x1b8)]!==null&&_0x477dc7[_0x1585e3(0x1b8)]!==undefined){let _0x1b6fbf=Number(_0x477dc7['val']);if(typeof _0x1b6fbf===_0x1585e3(0x1d7)){if(_0x1b6fbf<=1.05&&_0x30c8ef['to']['includes'](_0x1585e3(0x1d3)))_0x1b6fbf=_0x1b6fbf*0x64;_0x39f679=Math[_0x1585e3(0x1c1)](_0x1b6fbf),_0x287d2c=!![];break;}}}catch(_0x10a052){}}}}const _0x133b19=await _0x3400e7['getStateAsync'](_0x1585e3(0x16a));let _0x745048=[];if(_0x133b19&&_0x133b19[_0x1585e3(0x1b8)])try{_0x745048=JSON['parse'](_0x133b19['val']);}catch(_0x11ee6a){}_0x745048[_0x1585e3(0x185)]({'ts':Date[_0x1585e3(0x1c0)](),'room':_0x1b340f||_0x1585e3(0x163),'t_in':_0x5eeadf,'t_out':_0x1e88c0,'valve':_0x39f679});if(_0x745048[_0x1585e3(0x190)]>THERMO_LOG_SIZE)_0x745048[_0x1585e3(0x17d)]();await _0x3400e7[_0x1585e3(0x16b)](_0x1585e3(0x16a),{'val':JSON[_0x1585e3(0x17b)](_0x745048),'ack':!![]});}async function saveCompletedSequence(_0x31fbec){const _0x5e0f0f=a5_0x15cf;try{const _0x21179e=await _0x31fbec[_0x5e0f0f(0x165)](_0x5e0f0f(0x195));let _0x332bc2=[];if(_0x21179e&&_0x21179e[_0x5e0f0f(0x1b8)])try{_0x332bc2=JSON[_0x5e0f0f(0x167)](_0x21179e[_0x5e0f0f(0x1b8)]);}catch(_0x5df119){}const _0x250105=activeSequence[0x0]['ts'],_0xf75502=activeSequence[_0x5e0f0f(0x1c5)](_0x1c04d7=>({'loc':_0x1c04d7[_0x5e0f0f(0x1d0)],'t_delta':Math[_0x5e0f0f(0x1c1)]((_0x1c04d7['ts']-_0x250105)/0x3e8)})),_0x4a5a01={'timestamp':new Date(_0x250105)['toISOString'](),'steps':_0xf75502,'duration':Math['round']((activeSequence[activeSequence['length']-0x1]['ts']-_0x250105)/0x3e8),'daytime':new Date(_0x250105)['getHours']()};_0x332bc2['push'](_0x4a5a01);if(_0x332bc2['length']>MAX_TRAINING_SET_SIZE)_0x332bc2[_0x5e0f0f(0x17d)]();await _0x31fbec[_0x5e0f0f(0x16b)](_0x5e0f0f(0x195),{'val':JSON[_0x5e0f0f(0x17b)](_0x332bc2),'ack':!![]}),_0x31fbec[_0x5e0f0f(0x1c4)]&&_0x31fbec[_0x5e0f0f(0x199)]&&_0x31fbec[_0x5e0f0f(0x199)]('ANALYZE_SEQUENCE',{'sequence':_0x4a5a01});}catch(_0x291106){_0x31fbec[_0x5e0f0f(0x1cc)][_0x5e0f0f(0x183)](_0x5e0f0f(0x172)+_0x291106[_0x5e0f0f(0x16e)]);}}async function recordSequence(_0x224474,_0x244f29){const _0x2f5a3c=a5_0x15cf,_0xa1464f=(_0x244f29['type']||'')[_0x2f5a3c(0x182)](),_0x3276d8=['motion',_0x2f5a3c(0x1b3),_0x2f5a3c(0x166),_0x2f5a3c(0x19d),_0x2f5a3c(0x16f),_0x2f5a3c(0x170),_0x2f5a3c(0x1ae),_0x2f5a3c(0x1a6),_0x2f5a3c(0x1a1),_0x2f5a3c(0x1a4),'kontakt',_0x2f5a3c(0x16d),'licht','switch',_0x2f5a3c(0x1a2),_0x2f5a3c(0x19e),_0x2f5a3c(0x1c3)];if(!_0x3276d8[_0x2f5a3c(0x1af)](_0x3ed5af=>_0xa1464f[_0x2f5a3c(0x19b)](_0x3ed5af)))return;if(!_0x244f29[_0x2f5a3c(0x18a)])return;if(sequenceTimer)clearTimeout(sequenceTimer);activeSequence['push']({'loc':_0x244f29[_0x2f5a3c(0x1d2)]||'Unknown','id':_0x244f29['id'],'ts':Date[_0x2f5a3c(0x1c0)]()}),sequenceTimer=setTimeout(async()=>{if(activeSequence['length']>0x1)await saveCompletedSequence(_0x224474);activeSequence=[];},SEQUENCE_TIMEOUT_MS);}function startExitTimer(_0x4b75f4){const _0x2228bd=a5_0x15cf;abortExitTimer(_0x4b75f4),_0x4b75f4[_0x2228bd(0x18f)]=!![],_0x4b75f4[_0x2228bd(0x19a)]=setTimeout(()=>{const _0x58794b=_0x2228bd;_0x4b75f4[_0x58794b(0x18f)]=![];},EXIT_GRACE_PERIOD_SECONDS*0x3e8),_0x4b75f4[_0x2228bd(0x17a)]=setTimeout(()=>{setPresence(_0x4b75f4,![]),_0x4b75f4['exitTimer']=null;},EXIT_TIMER_MINUTES*0x3c*0x3e8);}function abortExitTimer(_0x3d1ec7){const _0xb1461c=a5_0x15cf;if(_0x3d1ec7[_0xb1461c(0x17a)])clearTimeout(_0x3d1ec7[_0xb1461c(0x17a)]);if(_0x3d1ec7['exitGraceTimer'])clearTimeout(_0x3d1ec7[_0xb1461c(0x19a)]);_0x3d1ec7['exitTimer']=null,_0x3d1ec7['exitGraceTimer']=null,_0x3d1ec7[_0xb1461c(0x18f)]=![];}function a5_0x15cf(_0x1655c5,_0x4d3e7d){const _0x5b5517=a5_0x1557();return a5_0x15cf=function(_0x3beda5,_0x43d89d){_0x3beda5=_0x3beda5-0x163;let _0x1557dd=_0x5b5517[_0x3beda5];return _0x1557dd;},a5_0x15cf(_0x1655c5,_0x4d3e7d);}async function setPresence(_0x1ec3ef,_0x537036){const _0x4d640e=a5_0x15cf;if(_0x1ec3ef[_0x4d640e(0x1bb)]===_0x537036)return;_0x1ec3ef['isPresent']=_0x537036,await _0x1ec3ef[_0x4d640e(0x16b)](_0x4d640e(0x176),{'val':_0x537036,'ack':!![]});}async function updateHourlyActivity(_0x59ad3b){const _0x26f013=a5_0x15cf;let _0x4b1b1a=new Array(0x18)[_0x26f013(0x188)](0x0),_0x454edb=0x0;try{const _0x1e1d52=await _0x59ad3b['getStateAsync'](_0x26f013(0x184));_0x1e1d52&&_0x1e1d52[_0x26f013(0x1b8)]&&(_0x4b1b1a=JSON[_0x26f013(0x167)](_0x1e1d52[_0x26f013(0x1b8)]),_0x454edb=_0x1e1d52['ts']);}catch(_0x4629d4){}const _0xff9412=new Date(_0x454edb),_0x13eae6=new Date();_0xff9412[_0x26f013(0x1a5)]()!==_0x13eae6[_0x26f013(0x1a5)]()&&(_0x4b1b1a=new Array(0x18)['fill'](0x0));const _0x2a0b29=_0x13eae6['getHours']();if(_0x4b1b1a[_0x2a0b29]===undefined)_0x4b1b1a[_0x2a0b29]=0x0;_0x4b1b1a[_0x2a0b29]++,await _0x59ad3b['setStateAsync'](_0x26f013(0x184),{'val':JSON[_0x26f013(0x17b)](_0x4b1b1a),'ack':!![]});}async function processSensorEvent(_0x166091,_0x15253f,_0x2f8e08,_0x1e784f){const _0x483d5c=a5_0x15cf;if(!_0x1e784f)return null;const _0x1e9ad5=_0x2f8e08['val'],_0x3d1568=Date[_0x483d5c(0x1c0)](),_0x3736f5=_0x166091[_0x483d5c(0x1aa)][_0x15253f],_0x15fec5=(_0x1e784f['type']||'')[_0x483d5c(0x182)](),_0x5e8188=_0x15fec5[_0x483d5c(0x19b)](_0x483d5c(0x1be))||_0x15fec5['includes'](_0x483d5c(0x17c))||_0x15fec5[_0x483d5c(0x19b)](_0x483d5c(0x1d4))||_0x15fec5[_0x483d5c(0x19b)](_0x483d5c(0x1ac))||_0x15fec5[_0x483d5c(0x19b)](_0x483d5c(0x1b1));if(_0x5e8188&&typeof _0x1e9ad5===_0x483d5c(0x1d7)){if(_0x1e9ad5>0x50||_0x1e9ad5<-0x32)return _0x166091[_0x483d5c(0x1cc)][_0x483d5c(0x171)](_0x483d5c(0x1d1)+_0x1e9ad5+'\x20from\x20'+_0x15253f),null;}_0x166091[_0x483d5c(0x1aa)][_0x15253f]=_0x1e9ad5;if(!_0x1e784f[_0x483d5c(0x189)]&&_0x3736f5!=undefined&&_0x3736f5==_0x1e9ad5)return null;_0x166091[_0x483d5c(0x1c4)]&&_0x5e8188&&recordThermodynamics(_0x166091,_0x15253f,_0x1e9ad5,_0x1e784f[_0x483d5c(0x1d2)]);const _0xf56e9e={'timestamp':_0x3d1568,'id':_0x15253f,'name':_0x1e784f['name'],'type':_0x1e784f[_0x483d5c(0x168)],'location':_0x1e784f['location'],'value':_0x1e9ad5};_0x166091[_0x483d5c(0x179)][_0x483d5c(0x194)](_0xf56e9e);if(_0x166091[_0x483d5c(0x179)][_0x483d5c(0x190)]>HISTORY_MAX_SIZE)_0x166091[_0x483d5c(0x179)][_0x483d5c(0x1cb)]();await _0x166091[_0x483d5c(0x16b)]('events.lastEvent',{'val':JSON[_0x483d5c(0x17b)](_0xf56e9e),'ack':!![]}),await _0x166091[_0x483d5c(0x16b)](_0x483d5c(0x192),{'val':JSON['stringify'](_0x166091[_0x483d5c(0x179)]),'ack':!![]}),await updateHourlyActivity(_0x166091);if(_0x166091[_0x483d5c(0x1c4)]){_0x166091[_0x483d5c(0x169)][_0x483d5c(0x185)](_0xf56e9e);if(_0x166091[_0x483d5c(0x169)][_0x483d5c(0x190)]>RAW_LOG_MAX_SIZE)_0x166091['rawEventLog'][_0x483d5c(0x1c7)](0x0,_0x166091[_0x483d5c(0x169)][_0x483d5c(0x190)]-RAW_LOG_MAX_SIZE);await _0x166091['setStateAsync'](_0x483d5c(0x180),{'val':JSON[_0x483d5c(0x17b)](_0x166091[_0x483d5c(0x169)]),'ack':!![]}),recordSequence(_0x166091,_0xf56e9e);}if(_0x1e784f['isExit']&&_0x1e9ad5===!![]){if(_0x166091[_0x483d5c(0x1bb)]&&!_0x166091[_0x483d5c(0x18f)])startExitTimer(_0x166091);else{if(!_0x166091[_0x483d5c(0x1bb)])setPresence(_0x166091,!![]);}}else{if(_0x1e784f[_0x483d5c(0x168)]===_0x483d5c(0x1b6)&&_0x1e9ad5===!![]){if(_0x166091[_0x483d5c(0x17a)])abortExitTimer(_0x166091);if(!_0x166091[_0x483d5c(0x1bb)]&&_0x166091[_0x483d5c(0x1b0)]===_0x483d5c(0x1c9))setPresence(_0x166091,!![]);}}if(_0x166091[_0x483d5c(0x1c4)]&&_0x166091[_0x483d5c(0x199)]){_0x1e784f[_0x483d5c(0x168)]===_0x483d5c(0x1b6)&&_0x1e9ad5===!![]&&_0x1e784f[_0x483d5c(0x1d2)]&&_0x166091[_0x483d5c(0x199)](_0x483d5c(0x1cd),{'room':_0x1e784f[_0x483d5c(0x1d2)]});const _0x4cb5be=[_0x483d5c(0x170),_0x483d5c(0x1ae),_0x483d5c(0x1a6),_0x483d5c(0x1a1),_0x483d5c(0x1b4),_0x483d5c(0x173),_0x483d5c(0x197),_0x483d5c(0x178)]['some'](_0x3df9af=>_0x15fec5['includes'](_0x3df9af)),_0x26c144=[_0x483d5c(0x16d),_0x483d5c(0x1a9),'switch',_0x483d5c(0x1a2),_0x483d5c(0x19e),_0x483d5c(0x1c3)][_0x483d5c(0x1af)](_0x2cdb22=>_0x15fec5['includes'](_0x2cdb22)),_0x1441ed=[_0x483d5c(0x1b6),_0x483d5c(0x1b3),'präsenz','presence',_0x483d5c(0x16f)][_0x483d5c(0x1af)](_0x485ad9=>_0x15fec5['includes'](_0x485ad9));if(_0x1e784f[_0x483d5c(0x1d2)]&&(_0x4cb5be||_0x26c144||_0x1441ed)){const _0x431939=_0x1e9ad5===!![]||typeof _0x1e9ad5==='number'&&_0x1e9ad5>0x0,_0x128261=_0x4cb5be&&!_0x431939&&_0x3736f5!==undefined&&_0x3736f5!=_0x1e9ad5;if(_0x431939||_0x128261){const _0x5df48f=_0x166091['lastTrackerEventTime']||_0x3d1568,_0x4d2ffe=(_0x3d1568-_0x5df48f)/0x3e8;_0x166091[_0x483d5c(0x175)]=_0x3d1568,_0x166091[_0x483d5c(0x199)](_0x483d5c(0x1c2),{'room':_0x1e784f[_0x483d5c(0x1d2)],'dt':_0x4d2ffe});}}}return _0xf56e9e;}module[a5_0x22628f(0x1b9)]={'processSensorEvent':processSensorEvent,'getOutsideTemperatureNumeric':getOutsideTemperatureNumeric,'setPresence':setPresence,'abortExitTimer':abortExitTimer,'startExitTimer':startExitTimer};