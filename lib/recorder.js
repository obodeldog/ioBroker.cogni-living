const a5_0x50228d=a5_0x2abd;(function(_0x5b3b33,_0x5e6215){const _0xe22878=a5_0x2abd,_0x186976=_0x5b3b33();while(!![]){try{const _0x1eb65a=-parseInt(_0xe22878(0x7c))/0x1*(parseInt(_0xe22878(0x74))/0x2)+-parseInt(_0xe22878(0x86))/0x3+parseInt(_0xe22878(0x89))/0x4+parseInt(_0xe22878(0x7b))/0x5+-parseInt(_0xe22878(0xb0))/0x6+-parseInt(_0xe22878(0x8d))/0x7*(parseInt(_0xe22878(0x90))/0x8)+parseInt(_0xe22878(0x9a))/0x9;if(_0x1eb65a===_0x5e6215)break;else _0x186976['push'](_0x186976['shift']());}catch(_0x3a672c){_0x186976['push'](_0x186976['shift']());}}}(a5_0x1ecf,0x3ff77));const a5_0x1a6091=(function(){let _0x5050fa=!![];return function(_0x3f7213,_0x42bfb4){const _0x5b5de5=_0x5050fa?function(){const _0x4ae5ad=a5_0x2abd;if(_0x42bfb4){const _0x3e16c8=_0x42bfb4[_0x4ae5ad(0x98)](_0x3f7213,arguments);return _0x42bfb4=null,_0x3e16c8;}}:function(){};return _0x5050fa=![],_0x5b5de5;};}()),a5_0x4add5d=a5_0x1a6091(this,function(){const _0x3ece46=a5_0x2abd;return a5_0x4add5d[_0x3ece46(0xab)]()[_0x3ece46(0xa6)]('(((.+)+)+)+$')[_0x3ece46(0xab)]()[_0x3ece46(0xb5)](a5_0x4add5d)[_0x3ece46(0xa6)]('(((.+)+)+)+$');});function a5_0x2abd(_0x34f86d,_0x4195c8){const _0x1f56e7=a5_0x1ecf();return a5_0x2abd=function(_0x4add5d,_0x1a6091){_0x4add5d=_0x4add5d-0x72;let _0x1ecf87=_0x1f56e7[_0x4add5d];return _0x1ecf87;},a5_0x2abd(_0x34f86d,_0x4195c8);}a5_0x4add5d();function a5_0x1ecf(){const _0x2dc350=['kontakt','apply','length','6697467HwFFxK','exports','map','daswetter','val','getHours','weatherunderground','log','sendToPythonWrapper','light','isProVersion','openweathermap','search','Unknown','events.lastEvent','LTM.rawEventLog','outdoorSensorId','toString','logDuplicates','isExit','bewegung','dimmer','2249640wlSjxL','tür','normal','pop','shift','constructor','.forecast.current.temperature','unshift','switch','now','SIMULATE_SIGNAL','getForeignStateAsync','fenster','klima','message','exitGraceTimer','410840FVTYQi','sensorLastValues','occupancy','push','type','config','ANALYZE_SEQUENCE','1874670MeZgVw','1anfBjQ','eventHistory','stringify','isGracePeriodActive','exitTimer','rawEventLog','präsenz','system.isPresent','useWeather','motion','390675trADnt','includes','LTM.trainingData.sequences','1074104pLhcmP','licht','value','some','7GYkare','setStateAsync','getStateAsync','3320248HOFHpz','.forecast.current.temp','isPresent','parse','round','lampe','location'];a5_0x1ecf=function(){return _0x2dc350;};return a5_0x1ecf();}'use strict';const HISTORY_MAX_SIZE=0x32,RAW_LOG_MAX_SIZE=0x9c4,THERMO_LOG_SIZE=0x3e8,SEQUENCE_TIMEOUT_MS=0x5*0x3c*0x3e8,MAX_TRAINING_SET_SIZE=0x1f4,EXIT_TIMER_MINUTES=0xf,EXIT_GRACE_PERIOD_SECONDS=0x1e;let activeSequence=[],sequenceTimer=null;async function getOutsideTemperatureNumeric(_0x268984){const _0x58cac3=a5_0x2abd;if(_0x268984[_0x58cac3(0x79)]['outdoorSensorId'])try{const _0x4bf5ea=await _0x268984[_0x58cac3(0xbb)](_0x268984['config'][_0x58cac3(0xaa)]);if(_0x4bf5ea&&_0x4bf5ea['val']!==undefined&&_0x4bf5ea[_0x58cac3(0x9e)]!==null)return parseFloat(_0x4bf5ea['val']);}catch(_0x20b850){}const _0x244887=_0x268984[_0x58cac3(0x79)]['weatherInstance'];if(!_0x268984[_0x58cac3(0x79)][_0x58cac3(0x84)]||!_0x244887)return null;try{let _0x4be7a0='';if(_0x244887[_0x58cac3(0x87)]('accuweather'))_0x4be7a0=_0x244887+'.Current.Temperature';else{if(_0x244887['includes'](_0x58cac3(0x9d)))_0x4be7a0=_0x244887+'.NextHours.Location_1.Day_1.current.temp_value';else{if(_0x244887['includes'](_0x58cac3(0xa5)))_0x4be7a0=_0x244887+_0x58cac3(0xb6);else{if(_0x244887[_0x58cac3(0x87)](_0x58cac3(0xa0)))_0x4be7a0=_0x244887+_0x58cac3(0x91);}}}if(_0x4be7a0){const _0x139e27=await _0x268984[_0x58cac3(0xbb)](_0x4be7a0);if(_0x139e27&&_0x139e27[_0x58cac3(0x9e)]!==undefined&&_0x139e27['val']!==null)return parseFloat(_0x139e27[_0x58cac3(0x9e)]);}}catch(_0x3b0210){}return null;}async function recordThermodynamics(_0x50e0ff,_0x668485,_0x5442b8,_0x388a61){const _0xbe8245=a5_0x2abd,_0x5f30b6=await getOutsideTemperatureNumeric(_0x50e0ff),_0x285d4d=await _0x50e0ff['getStateAsync']('LTM.trainingData.thermodynamics');let _0x3d5d83=[];if(_0x285d4d&&_0x285d4d['val'])try{_0x3d5d83=JSON[_0xbe8245(0x93)](_0x285d4d[_0xbe8245(0x9e)]);}catch(_0x5dbe90){}_0x3d5d83[_0xbe8245(0x77)]({'ts':Date[_0xbe8245(0xb9)](),'room':_0x388a61||'Unknown','t_in':_0x5442b8,'t_out':_0x5f30b6});if(_0x3d5d83[_0xbe8245(0x99)]>THERMO_LOG_SIZE)_0x3d5d83[_0xbe8245(0xb4)]();await _0x50e0ff[_0xbe8245(0x8e)]('LTM.trainingData.thermodynamics',{'val':JSON[_0xbe8245(0x7e)](_0x3d5d83),'ack':!![]});}async function saveCompletedSequence(_0x51d3a5){const _0x477b2f=a5_0x2abd;try{const _0x2a3230=await _0x51d3a5[_0x477b2f(0x8f)](_0x477b2f(0x88));let _0x462672=[];if(_0x2a3230&&_0x2a3230['val'])try{_0x462672=JSON[_0x477b2f(0x93)](_0x2a3230[_0x477b2f(0x9e)]);}catch(_0x3b58ce){}const _0x259d95=activeSequence[0x0]['ts'],_0x3d396f=activeSequence[_0x477b2f(0x9c)](_0x4e17c3=>({'loc':_0x4e17c3['loc'],'t_delta':Math[_0x477b2f(0x94)]((_0x4e17c3['ts']-_0x259d95)/0x3e8)})),_0x351a90={'timestamp':new Date(_0x259d95)['toISOString'](),'steps':_0x3d396f,'duration':Math[_0x477b2f(0x94)]((activeSequence[activeSequence[_0x477b2f(0x99)]-0x1]['ts']-_0x259d95)/0x3e8),'daytime':new Date(_0x259d95)[_0x477b2f(0x9f)]()};_0x462672[_0x477b2f(0x77)](_0x351a90);if(_0x462672[_0x477b2f(0x99)]>MAX_TRAINING_SET_SIZE)_0x462672[_0x477b2f(0xb4)]();await _0x51d3a5['setStateAsync'](_0x477b2f(0x88),{'val':JSON[_0x477b2f(0x7e)](_0x462672),'ack':!![]}),_0x51d3a5[_0x477b2f(0xa4)]&&_0x51d3a5[_0x477b2f(0xa2)]&&_0x51d3a5[_0x477b2f(0xa2)](_0x477b2f(0x7a),{'sequence':_0x351a90});}catch(_0x49d42c){_0x51d3a5[_0x477b2f(0xa1)]['error']('[RECORDER]\x20Error:\x20'+_0x49d42c[_0x477b2f(0x72)]);}}async function recordSequence(_0x255772,_0x3049d5){const _0x58e9c3=a5_0x2abd,_0x4eab18=(_0x3049d5[_0x58e9c3(0x78)]||'')['toLowerCase'](),_0x4f1e12=[_0x58e9c3(0x85),_0x58e9c3(0xae),_0x58e9c3(0x82),'presence',_0x58e9c3(0x76),'door',_0x58e9c3(0xb1),'window',_0x58e9c3(0xbc),'contact',_0x58e9c3(0x97),_0x58e9c3(0xa3),_0x58e9c3(0x8a),_0x58e9c3(0xb8),'schalter',_0x58e9c3(0xaf),_0x58e9c3(0x95)];if(!_0x4f1e12[_0x58e9c3(0x8c)](_0x54deec=>_0x4eab18[_0x58e9c3(0x87)](_0x54deec)))return;if(!_0x3049d5[_0x58e9c3(0x8b)])return;if(sequenceTimer)clearTimeout(sequenceTimer);activeSequence[_0x58e9c3(0x77)]({'loc':_0x3049d5[_0x58e9c3(0x96)]||_0x58e9c3(0xa7),'id':_0x3049d5['id'],'ts':Date[_0x58e9c3(0xb9)]()}),sequenceTimer=setTimeout(async()=>{const _0x40c86f=_0x58e9c3;if(activeSequence[_0x40c86f(0x99)]>0x1)await saveCompletedSequence(_0x255772);activeSequence=[];},SEQUENCE_TIMEOUT_MS);}function startExitTimer(_0x4fa456){const _0x23b9d0=a5_0x2abd;abortExitTimer(_0x4fa456),_0x4fa456[_0x23b9d0(0x7f)]=!![],_0x4fa456[_0x23b9d0(0x73)]=setTimeout(()=>{_0x4fa456['isGracePeriodActive']=![];},EXIT_GRACE_PERIOD_SECONDS*0x3e8),_0x4fa456[_0x23b9d0(0x80)]=setTimeout(()=>{setPresence(_0x4fa456,![]),_0x4fa456['exitTimer']=null;},EXIT_TIMER_MINUTES*0x3c*0x3e8);}function abortExitTimer(_0x27c168){const _0x156b81=a5_0x2abd;if(_0x27c168[_0x156b81(0x80)])clearTimeout(_0x27c168['exitTimer']);if(_0x27c168[_0x156b81(0x73)])clearTimeout(_0x27c168[_0x156b81(0x73)]);_0x27c168['exitTimer']=null,_0x27c168[_0x156b81(0x73)]=null,_0x27c168['isGracePeriodActive']=![];}async function setPresence(_0x1c08e6,_0x34c9c1){const _0x701406=a5_0x2abd;if(_0x1c08e6[_0x701406(0x92)]===_0x34c9c1)return;_0x1c08e6[_0x701406(0x92)]=_0x34c9c1,await _0x1c08e6['setStateAsync'](_0x701406(0x83),{'val':_0x34c9c1,'ack':!![]});}async function processSensorEvent(_0x2bb086,_0xf770f3,_0x28de47,_0x33030d){const _0x591f64=a5_0x2abd;if(!_0x33030d)return null;const _0x3027c2=_0x28de47[_0x591f64(0x9e)],_0x4ef2a2=Date[_0x591f64(0xb9)](),_0xc38b8f=_0x2bb086[_0x591f64(0x75)][_0xf770f3];_0x2bb086[_0x591f64(0x75)][_0xf770f3]=_0x3027c2;if(!_0x33030d[_0x591f64(0xac)]&&_0xc38b8f!=undefined&&_0xc38b8f==_0x3027c2)return null;const _0x3f227a=(_0x33030d[_0x591f64(0x78)]||'')['toLowerCase'](),_0x34c937=_0x3f227a[_0x591f64(0x87)]('temperature')||_0x3f227a[_0x591f64(0x87)]('temperatur')||_0x3f227a[_0x591f64(0x87)](_0x591f64(0xbd))||_0x3f227a[_0x591f64(0x87)]('heizung');_0x2bb086[_0x591f64(0xa4)]&&_0x34c937&&recordThermodynamics(_0x2bb086,_0xf770f3,_0x3027c2,_0x33030d[_0x591f64(0x96)]);const _0x1762d4={'timestamp':_0x4ef2a2,'id':_0xf770f3,'name':_0x33030d['name'],'type':_0x33030d[_0x591f64(0x78)],'location':_0x33030d['location'],'value':_0x3027c2};_0x2bb086[_0x591f64(0x7d)][_0x591f64(0xb7)](_0x1762d4);if(_0x2bb086['eventHistory'][_0x591f64(0x99)]>HISTORY_MAX_SIZE)_0x2bb086[_0x591f64(0x7d)][_0x591f64(0xb3)]();await _0x2bb086[_0x591f64(0x8e)](_0x591f64(0xa8),{'val':JSON[_0x591f64(0x7e)](_0x1762d4),'ack':!![]}),await _0x2bb086[_0x591f64(0x8e)]('events.history',{'val':JSON[_0x591f64(0x7e)](_0x2bb086[_0x591f64(0x7d)]),'ack':!![]});if(_0x2bb086[_0x591f64(0xa4)]){_0x2bb086['rawEventLog'][_0x591f64(0x77)](_0x1762d4);if(_0x2bb086[_0x591f64(0x81)][_0x591f64(0x99)]>RAW_LOG_MAX_SIZE)_0x2bb086[_0x591f64(0x81)]['splice'](0x0,_0x2bb086[_0x591f64(0x81)][_0x591f64(0x99)]-RAW_LOG_MAX_SIZE);await _0x2bb086[_0x591f64(0x8e)](_0x591f64(0xa9),{'val':JSON[_0x591f64(0x7e)](_0x2bb086['rawEventLog']),'ack':!![]}),recordSequence(_0x2bb086,_0x1762d4);}if(_0x33030d[_0x591f64(0xad)]&&_0x3027c2===!![]){if(_0x2bb086[_0x591f64(0x92)]&&!_0x2bb086[_0x591f64(0x7f)])startExitTimer(_0x2bb086);else{if(!_0x2bb086[_0x591f64(0x92)])setPresence(_0x2bb086,!![]);}}else{if(_0x33030d[_0x591f64(0x78)]===_0x591f64(0x85)&&_0x3027c2===!![]){if(_0x2bb086[_0x591f64(0x80)])abortExitTimer(_0x2bb086);if(!_0x2bb086[_0x591f64(0x92)]&&_0x2bb086['currentSystemMode']===_0x591f64(0xb2))setPresence(_0x2bb086,!![]);}}return _0x2bb086[_0x591f64(0xa4)]&&_0x33030d['type']===_0x591f64(0x85)&&_0x3027c2===!![]&&_0x33030d['location']&&_0x2bb086[_0x591f64(0xa2)]&&_0x2bb086[_0x591f64(0xa2)](_0x591f64(0xba),{'room':_0x33030d['location']}),_0x1762d4;}module[a5_0x50228d(0x9b)]={'processSensorEvent':processSensorEvent,'getOutsideTemperatureNumeric':getOutsideTemperatureNumeric,'setPresence':setPresence,'abortExitTimer':abortExitTimer,'startExitTimer':startExitTimer};