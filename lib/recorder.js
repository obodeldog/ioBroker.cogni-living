(function(_0xdaa59d,_0x83cffb){const _0x537712=a4_0x2e33,_0x31c617=_0xdaa59d();while(!![]){try{const _0x414c3a=parseInt(_0x537712(0xcc))/0x1+parseInt(_0x537712(0xa3))/0x2*(parseInt(_0x537712(0xea))/0x3)+-parseInt(_0x537712(0xb6))/0x4*(-parseInt(_0x537712(0xb8))/0x5)+-parseInt(_0x537712(0xd9))/0x6+parseInt(_0x537712(0xe6))/0x7+-parseInt(_0x537712(0xb1))/0x8+-parseInt(_0x537712(0xf2))/0x9;if(_0x414c3a===_0x83cffb)break;else _0x31c617['push'](_0x31c617['shift']());}catch(_0xecdb13){_0x31c617['push'](_0x31c617['shift']());}}}(a4_0x3491,0xacaa2));const a4_0x2fd8dd=(function(){let _0xa497d3=!![];return function(_0x46c647,_0x46ae27){const _0x17bce3=_0xa497d3?function(){const _0xde5026=a4_0x2e33;if(_0x46ae27){const _0x211d69=_0x46ae27[_0xde5026(0xdb)](_0x46c647,arguments);return _0x46ae27=null,_0x211d69;}}:function(){};return _0xa497d3=![],_0x17bce3;};}()),a4_0x1b31e8=a4_0x2fd8dd(this,function(){const _0x2fbf51=a4_0x2e33;return a4_0x1b31e8[_0x2fbf51(0xe2)]()[_0x2fbf51(0xa6)](_0x2fbf51(0xcd))[_0x2fbf51(0xe2)]()[_0x2fbf51(0xa8)](a4_0x1b31e8)[_0x2fbf51(0xa6)]('(((.+)+)+)+$');});a4_0x1b31e8();'use strict';const HISTORY_MAX_SIZE=0x32,RAW_LOG_MAX_SIZE=0x9c4,THERMO_LOG_SIZE=0x3e8,SEQUENCE_TIMEOUT_MS=0x5*0x3c*0x3e8,MAX_TRAINING_SET_SIZE=0x1f4,EXIT_TIMER_MINUTES=0xf,EXIT_GRACE_PERIOD_SECONDS=0x1e;let activeSequence=[],sequenceTimer=null;async function getOutsideTemperatureNumeric(_0x304c47){const _0xa81c4b=a4_0x2e33;if(_0x304c47[_0xa81c4b(0xee)]['outdoorSensorId'])try{const _0xf077ae=await _0x304c47[_0xa81c4b(0xd6)](_0x304c47[_0xa81c4b(0xee)][_0xa81c4b(0xe1)]);if(_0xf077ae&&_0xf077ae[_0xa81c4b(0xde)]!==undefined&&_0xf077ae['val']!==null)return parseFloat(_0xf077ae['val']);}catch(_0x545de7){}const _0x5cc0dd=_0x304c47['config'][_0xa81c4b(0xbb)];if(!_0x304c47[_0xa81c4b(0xee)][_0xa81c4b(0xb9)]||!_0x5cc0dd)return null;try{let _0x570338='';if(_0x5cc0dd['includes'](_0xa81c4b(0xc1)))_0x570338=_0x5cc0dd+_0xa81c4b(0xed);else{if(_0x5cc0dd[_0xa81c4b(0xd4)](_0xa81c4b(0xdc)))_0x570338=_0x5cc0dd+'.NextHours.Location_1.Day_1.current.temp_value';else{if(_0x5cc0dd[_0xa81c4b(0xd4)](_0xa81c4b(0xaf)))_0x570338=_0x5cc0dd+'.forecast.current.temperature';else{if(_0x5cc0dd[_0xa81c4b(0xd4)](_0xa81c4b(0xb4)))_0x570338=_0x5cc0dd+_0xa81c4b(0xc2);}}}if(_0x570338){const _0x1c1fa7=await _0x304c47[_0xa81c4b(0xd6)](_0x570338);if(_0x1c1fa7&&_0x1c1fa7[_0xa81c4b(0xde)]!==undefined&&_0x1c1fa7[_0xa81c4b(0xde)]!==null)return parseFloat(_0x1c1fa7[_0xa81c4b(0xde)]);}}catch(_0x209b3d){}return null;}async function recordThermodynamics(_0x41b08b,_0x5948e7,_0x5988ca,_0x4ca9a4){const _0x133f97=a4_0x2e33,_0x44ae0f=await getOutsideTemperatureNumeric(_0x41b08b),_0x9b90f3=await _0x41b08b['getStateAsync'](_0x133f97(0xc8));let _0x199d03=[];if(_0x9b90f3&&_0x9b90f3['val'])try{_0x199d03=JSON[_0x133f97(0xa4)](_0x9b90f3[_0x133f97(0xde)]);}catch(_0x417b84){}_0x199d03[_0x133f97(0xc0)]({'ts':Date['now'](),'room':_0x4ca9a4||_0x133f97(0xd1),'t_in':_0x5988ca,'t_out':_0x44ae0f});if(_0x199d03[_0x133f97(0xdf)]>THERMO_LOG_SIZE)_0x199d03[_0x133f97(0xcf)]();await _0x41b08b[_0x133f97(0xcb)]('LTM.trainingData.thermodynamics',{'val':JSON[_0x133f97(0xec)](_0x199d03),'ack':!![]});}async function saveCompletedSequence(_0x1d7989){const _0x4fb453=a4_0x2e33;try{const _0x55b054=await _0x1d7989[_0x4fb453(0xae)]('LTM.trainingData.sequences');let _0x5ea696=[];if(_0x55b054&&_0x55b054['val'])try{_0x5ea696=JSON[_0x4fb453(0xa4)](_0x55b054[_0x4fb453(0xde)]);}catch(_0x432bcc){}const _0x315bb5=activeSequence[0x0]['ts'],_0x58d7e9=activeSequence['map'](_0x17d232=>({'loc':_0x17d232['loc'],'t_delta':Math[_0x4fb453(0xe7)]((_0x17d232['ts']-_0x315bb5)/0x3e8)})),_0x5185bc={'timestamp':new Date(_0x315bb5)[_0x4fb453(0xe9)](),'steps':_0x58d7e9,'duration':Math['round']((activeSequence[activeSequence['length']-0x1]['ts']-_0x315bb5)/0x3e8),'daytime':new Date(_0x315bb5)[_0x4fb453(0xef)]()};_0x5ea696[_0x4fb453(0xc0)](_0x5185bc);if(_0x5ea696[_0x4fb453(0xdf)]>MAX_TRAINING_SET_SIZE)_0x5ea696[_0x4fb453(0xcf)]();await _0x1d7989[_0x4fb453(0xcb)]('LTM.trainingData.sequences',{'val':JSON[_0x4fb453(0xec)](_0x5ea696),'ack':!![]}),_0x1d7989[_0x4fb453(0xf0)]&&_0x1d7989[_0x4fb453(0xb3)]&&_0x1d7989[_0x4fb453(0xb3)](_0x4fb453(0xa7),{'sequence':_0x5185bc});}catch(_0x3d05c2){_0x1d7989[_0x4fb453(0xf1)][_0x4fb453(0xda)]('[RECORDER]\x20Error:\x20'+_0x3d05c2['message']);}}async function recordSequence(_0x4c6546,_0x3a66af){const _0x1d8db3=a4_0x2e33,_0x366a61=(_0x3a66af['type']||'')[_0x1d8db3(0xe8)](),_0x167dfc=[_0x1d8db3(0xce),_0x1d8db3(0xd5),_0x1d8db3(0xd3),_0x1d8db3(0xe3),_0x1d8db3(0xa9),_0x1d8db3(0xe4),'tür',_0x1d8db3(0xa5),'fenster',_0x1d8db3(0xc9),'kontakt',_0x1d8db3(0xd2),_0x1d8db3(0xe0),_0x1d8db3(0xd0),_0x1d8db3(0xaa),_0x1d8db3(0xd7),_0x1d8db3(0xb5)];if(!_0x167dfc[_0x1d8db3(0xeb)](_0xb4c973=>_0x366a61['includes'](_0xb4c973)))return;if(!_0x3a66af[_0x1d8db3(0xb0)])return;if(sequenceTimer)clearTimeout(sequenceTimer);activeSequence[_0x1d8db3(0xc0)]({'loc':_0x3a66af[_0x1d8db3(0xab)]||_0x1d8db3(0xd1),'id':_0x3a66af['id'],'ts':Date[_0x1d8db3(0xbe)]()}),sequenceTimer=setTimeout(async()=>{if(activeSequence['length']>0x1)await saveCompletedSequence(_0x4c6546);activeSequence=[];},SEQUENCE_TIMEOUT_MS);}function startExitTimer(_0x38897a){const _0x3e7077=a4_0x2e33;abortExitTimer(_0x38897a),_0x38897a[_0x3e7077(0xba)]=!![],_0x38897a['exitGraceTimer']=setTimeout(()=>{const _0x216400=_0x3e7077;_0x38897a[_0x216400(0xba)]=![];},EXIT_GRACE_PERIOD_SECONDS*0x3e8),_0x38897a[_0x3e7077(0xa2)]=setTimeout(()=>{const _0x37f7e0=_0x3e7077;setPresence(_0x38897a,![]),_0x38897a[_0x37f7e0(0xa2)]=null;},EXIT_TIMER_MINUTES*0x3c*0x3e8);}function abortExitTimer(_0x2b91ff){const _0x57830a=a4_0x2e33;if(_0x2b91ff[_0x57830a(0xa2)])clearTimeout(_0x2b91ff['exitTimer']);if(_0x2b91ff[_0x57830a(0xac)])clearTimeout(_0x2b91ff['exitGraceTimer']);_0x2b91ff[_0x57830a(0xa2)]=null,_0x2b91ff[_0x57830a(0xac)]=null,_0x2b91ff[_0x57830a(0xba)]=![];}async function setPresence(_0x4fe985,_0x3e075d){const _0x5436bd=a4_0x2e33;if(_0x4fe985[_0x5436bd(0xa1)]===_0x3e075d)return;_0x4fe985[_0x5436bd(0xa1)]=_0x3e075d,await _0x4fe985['setStateAsync']('system.isPresent',{'val':_0x3e075d,'ack':!![]});}async function processSensorEvent(_0x285eb6,_0x7cae7a,_0x48f5ec,_0x590697){const _0x1e95bd=a4_0x2e33;if(!_0x590697)return;const _0x1766bb=_0x48f5ec['val'],_0x5c6bd9=Date[_0x1e95bd(0xbe)](),_0x4ffebe=_0x285eb6[_0x1e95bd(0xc3)][_0x7cae7a];_0x285eb6[_0x1e95bd(0xc3)][_0x7cae7a]=_0x1766bb;if(!_0x590697['logDuplicates']&&_0x4ffebe!=undefined&&_0x4ffebe==_0x1766bb)return;const _0x3a90aa=(_0x590697[_0x1e95bd(0xb7)]||'')[_0x1e95bd(0xe8)](),_0x2649cb=_0x3a90aa[_0x1e95bd(0xd4)](_0x1e95bd(0xc5))||_0x3a90aa[_0x1e95bd(0xd4)](_0x1e95bd(0xbf))||_0x3a90aa[_0x1e95bd(0xd4)](_0x1e95bd(0xc7))||_0x3a90aa[_0x1e95bd(0xd4)](_0x1e95bd(0xc4));_0x285eb6['isProVersion']&&_0x2649cb&&recordThermodynamics(_0x285eb6,_0x7cae7a,_0x1766bb,_0x590697[_0x1e95bd(0xab)]);const _0x48e518={'timestamp':_0x5c6bd9,'id':_0x7cae7a,'name':_0x590697['name'],'type':_0x590697[_0x1e95bd(0xb7)],'location':_0x590697[_0x1e95bd(0xab)],'value':_0x1766bb};_0x285eb6[_0x1e95bd(0xe5)][_0x1e95bd(0xca)](_0x48e518);if(_0x285eb6[_0x1e95bd(0xe5)][_0x1e95bd(0xdf)]>HISTORY_MAX_SIZE)_0x285eb6['eventHistory'][_0x1e95bd(0xd8)]();await _0x285eb6[_0x1e95bd(0xcb)]('events.lastEvent',{'val':JSON[_0x1e95bd(0xec)](_0x48e518),'ack':!![]}),await _0x285eb6[_0x1e95bd(0xcb)](_0x1e95bd(0xad),{'val':JSON[_0x1e95bd(0xec)](_0x285eb6[_0x1e95bd(0xe5)]),'ack':!![]});if(_0x285eb6[_0x1e95bd(0xf0)]){_0x285eb6[_0x1e95bd(0xdd)][_0x1e95bd(0xc0)](_0x48e518);if(_0x285eb6[_0x1e95bd(0xdd)][_0x1e95bd(0xdf)]>RAW_LOG_MAX_SIZE)_0x285eb6['rawEventLog'][_0x1e95bd(0xbd)](0x0,_0x285eb6[_0x1e95bd(0xdd)][_0x1e95bd(0xdf)]-RAW_LOG_MAX_SIZE);await _0x285eb6['setStateAsync']('LTM.rawEventLog',{'val':JSON[_0x1e95bd(0xec)](_0x285eb6[_0x1e95bd(0xdd)]),'ack':!![]}),recordSequence(_0x285eb6,_0x48e518);}if(_0x590697[_0x1e95bd(0xbc)]&&_0x1766bb===!![]){if(_0x285eb6[_0x1e95bd(0xa1)]&&!_0x285eb6['isGracePeriodActive'])startExitTimer(_0x285eb6);else{if(!_0x285eb6[_0x1e95bd(0xa1)])setPresence(_0x285eb6,!![]);}}else{if(_0x590697['type']==='motion'&&_0x1766bb===!![]){if(_0x285eb6[_0x1e95bd(0xa2)])abortExitTimer(_0x285eb6);if(!_0x285eb6[_0x1e95bd(0xa1)]&&_0x285eb6[_0x1e95bd(0xc6)]===_0x1e95bd(0xb2))setPresence(_0x285eb6,!![]);}}_0x285eb6['isProVersion']&&_0x590697['type']===_0x1e95bd(0xce)&&_0x1766bb===!![]&&_0x590697[_0x1e95bd(0xab)]&&_0x285eb6[_0x1e95bd(0xb3)]&&_0x285eb6[_0x1e95bd(0xb3)]('SIMULATE_SIGNAL',{'room':_0x590697[_0x1e95bd(0xab)]});}function a4_0x2e33(_0x2c7f6c,_0x368a8f){const _0x18d67f=a4_0x3491();return a4_0x2e33=function(_0x1b31e8,_0x2fd8dd){_0x1b31e8=_0x1b31e8-0xa1;let _0x349111=_0x18d67f[_0x1b31e8];return _0x349111;},a4_0x2e33(_0x2c7f6c,_0x368a8f);}module['exports']={'processSensorEvent':processSensorEvent,'getOutsideTemperatureNumeric':getOutsideTemperatureNumeric,'setPresence':setPresence,'abortExitTimer':abortExitTimer,'startExitTimer':startExitTimer};function a4_0x3491(){const _0x12d032=['some','stringify','.Current.Temperature','config','getHours','isProVersion','log','12653235SaOgOB','isPresent','exitTimer','40EBLWHK','parse','window','search','ANALYZE_SEQUENCE','constructor','occupancy','schalter','location','exitGraceTimer','events.history','getStateAsync','openweathermap','value','50256MXHpwH','normal','sendToPythonWrapper','weatherunderground','lampe','4VqeGiP','type','6037395HRGQAU','useWeather','isGracePeriodActive','weatherInstance','isExit','splice','now','temperatur','push','accuweather','.forecast.current.temp','sensorLastValues','heizung','temperature','currentSystemMode','klima','LTM.trainingData.thermodynamics','contact','unshift','setStateAsync','864486huhteM','(((.+)+)+)+$','motion','shift','switch','Unknown','light','präsenz','includes','bewegung','getForeignStateAsync','dimmer','pop','5143830kvfeHu','error','apply','daswetter','rawEventLog','val','length','licht','outdoorSensorId','toString','presence','door','eventHistory','5570537XCxolX','round','toLowerCase','toISOString','16347gRbBSo'];a4_0x3491=function(){return _0x12d032;};return a4_0x3491();}