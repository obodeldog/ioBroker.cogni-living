const a5_0x4a2837=a5_0x1ce1;(function(_0x55cef3,_0x24dbb2){const _0x26b40d=a5_0x1ce1,_0x391909=_0x55cef3();while(!![]){try{const _0x4a8ed1=parseInt(_0x26b40d(0x155))/0x1+-parseInt(_0x26b40d(0x131))/0x2+parseInt(_0x26b40d(0x14a))/0x3+-parseInt(_0x26b40d(0x11d))/0x4+-parseInt(_0x26b40d(0x129))/0x5*(-parseInt(_0x26b40d(0x13d))/0x6)+parseInt(_0x26b40d(0x123))/0x7*(parseInt(_0x26b40d(0x118))/0x8)+parseInt(_0x26b40d(0x140))/0x9;if(_0x4a8ed1===_0x24dbb2)break;else _0x391909['push'](_0x391909['shift']());}catch(_0x23cec0){_0x391909['push'](_0x391909['shift']());}}}(a5_0x2d12,0x83d4d));const a5_0x547e03=(function(){let _0x462082=!![];return function(_0x433684,_0x4cf23f){const _0x268c32=_0x462082?function(){const _0x1059fd=a5_0x1ce1;if(_0x4cf23f){const _0xc17ce7=_0x4cf23f[_0x1059fd(0xf8)](_0x433684,arguments);return _0x4cf23f=null,_0xc17ce7;}}:function(){};return _0x462082=![],_0x268c32;};}()),a5_0x45209a=a5_0x547e03(this,function(){const _0x143109=a5_0x1ce1;return a5_0x45209a[_0x143109(0xf0)]()[_0x143109(0x11e)]('(((.+)+)+)+$')[_0x143109(0xf0)]()[_0x143109(0xfd)](a5_0x45209a)[_0x143109(0x11e)](_0x143109(0xf2));});a5_0x45209a();'use strict';const HISTORY_MAX_SIZE=0x32,RAW_LOG_MAX_SIZE=0x9c4,THERMO_LOG_SIZE=0x3e8,SEQUENCE_TIMEOUT_MS=0x5*0x3c*0x3e8,MAX_TRAINING_SET_SIZE=0x1f4,EXIT_TIMER_MINUTES=0xf,EXIT_GRACE_PERIOD_SECONDS=0x1e;function a5_0x1ce1(_0xce7011,_0x38f560){const _0x4514a2=a5_0x2d12();return a5_0x1ce1=function(_0x45209a,_0x547e03){_0x45209a=_0x45209a-0xed;let _0x2d1256=_0x4514a2[_0x45209a];return _0x2d1256;},a5_0x1ce1(_0xce7011,_0x38f560);}let activeSequence=[],sequenceTimer=null;async function getOutsideTemperatureNumeric(_0x4c6cdd){const _0x1bbaea=a5_0x1ce1;if(_0x4c6cdd[_0x1bbaea(0x14f)][_0x1bbaea(0x127)])try{const _0x3ba30e=await _0x4c6cdd[_0x1bbaea(0x108)](_0x4c6cdd[_0x1bbaea(0x14f)][_0x1bbaea(0x127)]);if(_0x3ba30e&&_0x3ba30e[_0x1bbaea(0x103)]!==undefined&&_0x3ba30e[_0x1bbaea(0x103)]!==null)return parseFloat(_0x3ba30e[_0x1bbaea(0x103)]);}catch(_0x374622){}const _0x2ade6b=_0x4c6cdd[_0x1bbaea(0x14f)]['weatherInstance'];if(!_0x4c6cdd[_0x1bbaea(0x14f)][_0x1bbaea(0x12b)]||!_0x2ade6b)return null;try{let _0x1a54a6='';if(_0x2ade6b[_0x1bbaea(0xfb)](_0x1bbaea(0x146)))_0x1a54a6=_0x2ade6b+_0x1bbaea(0x10a);else{if(_0x2ade6b[_0x1bbaea(0xfb)](_0x1bbaea(0x115)))_0x1a54a6=_0x2ade6b+_0x1bbaea(0x144);else{if(_0x2ade6b[_0x1bbaea(0xfb)](_0x1bbaea(0x158)))_0x1a54a6=_0x2ade6b+_0x1bbaea(0x15c);else{if(_0x2ade6b[_0x1bbaea(0xfb)](_0x1bbaea(0x12c)))_0x1a54a6=_0x2ade6b+_0x1bbaea(0x120);}}}if(_0x1a54a6){const _0x491326=await _0x4c6cdd[_0x1bbaea(0x108)](_0x1a54a6);if(_0x491326&&_0x491326[_0x1bbaea(0x103)]!==undefined&&_0x491326['val']!==null)return parseFloat(_0x491326['val']);}}catch(_0x3c4b8){}return null;}async function recordThermodynamics(_0x23ac2e,_0x43a9ab,_0x13c801,_0x5e737e){const _0x160397=a5_0x1ce1,_0x509aaf=await getOutsideTemperatureNumeric(_0x23ac2e);if(_0x509aaf===null)return;let _0xeb9fc=0x0,_0x828bac=![];if(_0x23ac2e[_0x160397(0x14f)][_0x160397(0x142)])try{let _0x323be9=_0x23ac2e[_0x160397(0x14f)][_0x160397(0x142)];if(typeof _0x323be9==='string')_0x323be9=JSON[_0x160397(0x104)](_0x323be9);if(_0x323be9[_0x43a9ab]){const _0x400f54=_0x323be9[_0x43a9ab],_0x3ffe3=await _0x23ac2e[_0x160397(0x108)](_0x400f54);if(_0x3ffe3&&_0x3ffe3['val']!==null&&_0x3ffe3[_0x160397(0x103)]!==undefined){let _0x20c984=Number(_0x3ffe3['val']);if(_0x20c984<=1.05&&!_0x400f54['includes'](_0x160397(0x138))&&!_0x400f54['includes'](_0x160397(0x13a)))_0x20c984=_0x20c984*0x64;_0xeb9fc=Math[_0x160397(0x15b)](_0x20c984),_0x828bac=!![];}}}catch(_0x4761fa){}if(!_0x828bac){const _0x152fdb=[{'from':_0x160397(0x11c),'to':_0x160397(0x141)},{'from':_0x160397(0x11c),'to':_0x160397(0x114)},{'from':_0x160397(0xf1),'to':_0x160397(0x13c)},{'from':_0x160397(0x13f),'to':_0x160397(0x15d)},{'from':_0x160397(0x15f),'to':_0x160397(0x111)},{'from':'Temperature','to':'Valve'}];for(const _0x286418 of _0x152fdb){if(_0x43a9ab[_0x160397(0xfb)](_0x286418[_0x160397(0x124)])){const _0x9ee696=_0x43a9ab[_0x160397(0x133)](_0x286418[_0x160397(0x124)],_0x286418['to']);try{const _0x3877ec=await _0x23ac2e[_0x160397(0x108)](_0x9ee696);if(_0x3877ec&&_0x3877ec[_0x160397(0x103)]!==null&&_0x3877ec[_0x160397(0x103)]!==undefined){let _0x5601be=Number(_0x3877ec['val']);if(typeof _0x5601be===_0x160397(0xef)){if(_0x5601be<=1.05&&_0x286418['to']['includes'](_0x160397(0x107)))_0x5601be=_0x5601be*0x64;_0xeb9fc=Math['round'](_0x5601be),_0x828bac=!![];break;}}}catch(_0x594115){}}}}const _0x35b533=await _0x23ac2e[_0x160397(0x122)](_0x160397(0x14b));let _0x1faec3=[];if(_0x35b533&&_0x35b533['val'])try{_0x1faec3=JSON[_0x160397(0x104)](_0x35b533[_0x160397(0x103)]);}catch(_0x5b4c9b){}_0x1faec3[_0x160397(0x154)]({'ts':Date['now'](),'room':_0x5e737e||'Unknown','t_in':_0x13c801,'t_out':_0x509aaf,'valve':_0xeb9fc});if(_0x1faec3[_0x160397(0xfe)]>THERMO_LOG_SIZE)_0x1faec3[_0x160397(0x101)]();await _0x23ac2e[_0x160397(0xf5)]('LTM.trainingData.thermodynamics',{'val':JSON[_0x160397(0x11b)](_0x1faec3),'ack':!![]});}async function saveCompletedSequence(_0x529870){const _0x357de8=a5_0x1ce1;try{const _0xabcb20=await _0x529870['getStateAsync'](_0x357de8(0x12d));let _0x56cc0d=[];if(_0xabcb20&&_0xabcb20[_0x357de8(0x103)])try{_0x56cc0d=JSON[_0x357de8(0x104)](_0xabcb20[_0x357de8(0x103)]);}catch(_0x5c1502){}const _0x206c97=activeSequence[0x0]['ts'],_0x2b00ed=activeSequence['map'](_0x43603e=>({'loc':_0x43603e[_0x357de8(0x145)],'t_delta':Math[_0x357de8(0x15b)]((_0x43603e['ts']-_0x206c97)/0x3e8)})),_0x146ace={'timestamp':new Date(_0x206c97)['toISOString'](),'steps':_0x2b00ed,'duration':Math[_0x357de8(0x15b)]((activeSequence[activeSequence[_0x357de8(0xfe)]-0x1]['ts']-_0x206c97)/0x3e8),'daytime':new Date(_0x206c97)[_0x357de8(0x153)]()};_0x56cc0d[_0x357de8(0x154)](_0x146ace);if(_0x56cc0d['length']>MAX_TRAINING_SET_SIZE)_0x56cc0d['shift']();await _0x529870[_0x357de8(0xf5)](_0x357de8(0x12d),{'val':JSON[_0x357de8(0x11b)](_0x56cc0d),'ack':!![]}),_0x529870['isProVersion']&&_0x529870[_0x357de8(0x157)]&&_0x529870['sendToPythonWrapper'](_0x357de8(0x15e),{'sequence':_0x146ace});}catch(_0x2faa0e){_0x529870[_0x357de8(0x148)][_0x357de8(0x134)]('[RECORDER]\x20Error:\x20'+_0x2faa0e[_0x357de8(0x151)]);}}async function recordSequence(_0x38ac6f,_0x4f116f){const _0x20ee47=a5_0x1ce1,_0x15c492=(_0x4f116f[_0x20ee47(0x12a)]||'')[_0x20ee47(0xf6)](),_0x3571ca=[_0x20ee47(0x147),_0x20ee47(0x139),_0x20ee47(0x14d),_0x20ee47(0x130),'occupancy',_0x20ee47(0x117),'tür',_0x20ee47(0x11f),'fenster',_0x20ee47(0x10b),_0x20ee47(0x149),'light','licht',_0x20ee47(0x137),_0x20ee47(0x10e),_0x20ee47(0x100),'lampe'];if(!_0x3571ca[_0x20ee47(0x109)](_0x462570=>_0x15c492[_0x20ee47(0xfb)](_0x462570)))return;if(!_0x4f116f[_0x20ee47(0xf4)])return;if(sequenceTimer)clearTimeout(sequenceTimer);activeSequence[_0x20ee47(0x154)]({'loc':_0x4f116f[_0x20ee47(0x121)]||_0x20ee47(0x136),'id':_0x4f116f['id'],'ts':Date[_0x20ee47(0x143)]()}),sequenceTimer=setTimeout(async()=>{const _0x1d92d0=_0x20ee47;if(activeSequence[_0x1d92d0(0xfe)]>0x1)await saveCompletedSequence(_0x38ac6f);activeSequence=[];},SEQUENCE_TIMEOUT_MS);}function startExitTimer(_0x311676){const _0x31b72e=a5_0x1ce1;abortExitTimer(_0x311676),_0x311676[_0x31b72e(0x113)]=!![],_0x311676[_0x31b72e(0xf9)]=setTimeout(()=>{_0x311676['isGracePeriodActive']=![];},EXIT_GRACE_PERIOD_SECONDS*0x3e8),_0x311676[_0x31b72e(0x110)]=setTimeout(()=>{const _0x476a82=_0x31b72e;setPresence(_0x311676,![]),_0x311676[_0x476a82(0x110)]=null;},EXIT_TIMER_MINUTES*0x3c*0x3e8);}function abortExitTimer(_0x5be4da){const _0x2b352d=a5_0x1ce1;if(_0x5be4da[_0x2b352d(0x110)])clearTimeout(_0x5be4da[_0x2b352d(0x110)]);if(_0x5be4da['exitGraceTimer'])clearTimeout(_0x5be4da[_0x2b352d(0xf9)]);_0x5be4da['exitTimer']=null,_0x5be4da[_0x2b352d(0xf9)]=null,_0x5be4da[_0x2b352d(0x113)]=![];}function a5_0x2d12(){const _0x3dc3c7=['\x20from\x20','stringify','.1.ACTUAL_TEMPERATURE','1656544iYlFiW','search','window','.forecast.current.temp','location','getStateAsync','7DqAUyP','from','thermostat','temperatur','outdoorSensorId','klima','2045IATiKM','type','useWeather','weatherunderground','LTM.trainingData.sequences','logDuplicates','events.lastEvent','presence','1596332qXPUTQ','splice','replace','error','griff','Unknown','switch','STATUS','bewegung','STATE','isProVersion','.4.VALVE_STATE','4470zdYaWT','occupancy','.ACTUAL_TEMPERATURE','459378ceTwgo','.1.LEVEL','valveMapping','now','.NextHours.Location_1.Day_1.current.temp_value','loc','accuweather','motion','log','kontakt','1058034ubdbFQ','LTM.trainingData.thermodynamics','rawEventLog','präsenz','unshift','config','eventHistory','message','fenster','getHours','push','512382JShazw','LTM.rawEventLog','sendToPythonWrapper','openweathermap','tür','lampe','round','.forecast.current.temperature','.LEVEL','ANALYZE_SEQUENCE','temperature','lock','light','number','toString','.1.TEMPERATURE','(((.+)+)+)+$','currentSystemMode','value','setStateAsync','toLowerCase','exports','apply','exitGraceTimer','isExit','includes','normal','constructor','length','lastTrackerEventTime','dimmer','shift','isPresent','val','parse','debug','events.history','LEVEL','getForeignStateAsync','some','.Current.Temperature','contact','name','pop','schalter','schloss','exitTimer','level','system.isPresent','isGracePeriodActive','.1.VALVE_STATE','daswetter','[RECORDER]\x20Ignored\x20implausible\x20temperature:\x20','door','4251808paoBss','sensorLastValues'];a5_0x2d12=function(){return _0x3dc3c7;};return a5_0x2d12();}async function setPresence(_0xce1dbe,_0x349d3b){const _0x4a17fc=a5_0x1ce1;if(_0xce1dbe[_0x4a17fc(0x102)]===_0x349d3b)return;_0xce1dbe[_0x4a17fc(0x102)]=_0x349d3b,await _0xce1dbe['setStateAsync'](_0x4a17fc(0x112),{'val':_0x349d3b,'ack':!![]});}async function processSensorEvent(_0x2026aa,_0x2cf391,_0x587d6b,_0x4bf36d){const _0x1f1972=a5_0x1ce1;if(!_0x4bf36d)return null;const _0x248c70=_0x587d6b[_0x1f1972(0x103)],_0x572a52=Date[_0x1f1972(0x143)](),_0x221206=_0x2026aa[_0x1f1972(0x119)][_0x2cf391],_0x4da2e2=(_0x4bf36d[_0x1f1972(0x12a)]||'')[_0x1f1972(0xf6)](),_0x1a8eca=_0x4da2e2[_0x1f1972(0xfb)](_0x1f1972(0x15f))||_0x4da2e2[_0x1f1972(0xfb)](_0x1f1972(0x126))||_0x4da2e2[_0x1f1972(0xfb)](_0x1f1972(0x128))||_0x4da2e2[_0x1f1972(0xfb)]('heizung')||_0x4da2e2[_0x1f1972(0xfb)](_0x1f1972(0x125));if(_0x1a8eca&&typeof _0x248c70===_0x1f1972(0xef)){if(_0x248c70>0x50||_0x248c70<-0x32)return _0x2026aa[_0x1f1972(0x148)][_0x1f1972(0x105)](_0x1f1972(0x116)+_0x248c70+_0x1f1972(0x11a)+_0x2cf391),null;}_0x2026aa[_0x1f1972(0x119)][_0x2cf391]=_0x248c70;if(!_0x4bf36d[_0x1f1972(0x12e)]&&_0x221206!=undefined&&_0x221206==_0x248c70)return null;_0x2026aa[_0x1f1972(0x13b)]&&_0x1a8eca&&recordThermodynamics(_0x2026aa,_0x2cf391,_0x248c70,_0x4bf36d[_0x1f1972(0x121)]);const _0x481cc7={'timestamp':_0x572a52,'id':_0x2cf391,'name':_0x4bf36d[_0x1f1972(0x10c)],'type':_0x4bf36d[_0x1f1972(0x12a)],'location':_0x4bf36d['location'],'value':_0x248c70};_0x2026aa[_0x1f1972(0x150)][_0x1f1972(0x14e)](_0x481cc7);if(_0x2026aa[_0x1f1972(0x150)][_0x1f1972(0xfe)]>HISTORY_MAX_SIZE)_0x2026aa[_0x1f1972(0x150)][_0x1f1972(0x10d)]();await _0x2026aa['setStateAsync'](_0x1f1972(0x12f),{'val':JSON[_0x1f1972(0x11b)](_0x481cc7),'ack':!![]}),await _0x2026aa[_0x1f1972(0xf5)](_0x1f1972(0x106),{'val':JSON[_0x1f1972(0x11b)](_0x2026aa['eventHistory']),'ack':!![]});if(_0x2026aa[_0x1f1972(0x13b)]){_0x2026aa[_0x1f1972(0x14c)][_0x1f1972(0x154)](_0x481cc7);if(_0x2026aa[_0x1f1972(0x14c)]['length']>RAW_LOG_MAX_SIZE)_0x2026aa[_0x1f1972(0x14c)][_0x1f1972(0x132)](0x0,_0x2026aa['rawEventLog']['length']-RAW_LOG_MAX_SIZE);await _0x2026aa[_0x1f1972(0xf5)](_0x1f1972(0x156),{'val':JSON[_0x1f1972(0x11b)](_0x2026aa[_0x1f1972(0x14c)]),'ack':!![]}),recordSequence(_0x2026aa,_0x481cc7);}if(_0x4bf36d[_0x1f1972(0xfa)]&&_0x248c70===!![]){if(_0x2026aa[_0x1f1972(0x102)]&&!_0x2026aa[_0x1f1972(0x113)])startExitTimer(_0x2026aa);else{if(!_0x2026aa[_0x1f1972(0x102)])setPresence(_0x2026aa,!![]);}}else{if(_0x4bf36d[_0x1f1972(0x12a)]===_0x1f1972(0x147)&&_0x248c70===!![]){if(_0x2026aa[_0x1f1972(0x110)])abortExitTimer(_0x2026aa);if(!_0x2026aa[_0x1f1972(0x102)]&&_0x2026aa[_0x1f1972(0xf3)]===_0x1f1972(0xfc))setPresence(_0x2026aa,!![]);}}if(_0x2026aa[_0x1f1972(0x13b)]&&_0x2026aa[_0x1f1972(0x157)]){_0x4bf36d[_0x1f1972(0x12a)]==='motion'&&_0x248c70===!![]&&_0x4bf36d[_0x1f1972(0x121)]&&_0x2026aa[_0x1f1972(0x157)]('SIMULATE_SIGNAL',{'room':_0x4bf36d[_0x1f1972(0x121)]});const _0x59e3bb=['door',_0x1f1972(0x159),_0x1f1972(0x11f),_0x1f1972(0x152),_0x1f1972(0x135),'handle',_0x1f1972(0xed),_0x1f1972(0x10f)][_0x1f1972(0x109)](_0x475fdf=>_0x4da2e2[_0x1f1972(0xfb)](_0x475fdf)),_0x2d3c4a=[_0x1f1972(0xee),'licht',_0x1f1972(0x137),'schalter',_0x1f1972(0x100),_0x1f1972(0x15a)][_0x1f1972(0x109)](_0x2fcfaf=>_0x4da2e2[_0x1f1972(0xfb)](_0x2fcfaf)),_0x1c5f60=[_0x1f1972(0x147),_0x1f1972(0x139),_0x1f1972(0x14d),'presence',_0x1f1972(0x13e)][_0x1f1972(0x109)](_0xda44ed=>_0x4da2e2[_0x1f1972(0xfb)](_0xda44ed));if(_0x4bf36d[_0x1f1972(0x121)]&&(_0x59e3bb||_0x2d3c4a||_0x1c5f60)){const _0x32d561=_0x248c70===!![]||typeof _0x248c70==='number'&&_0x248c70>0x0,_0x5a66c6=_0x59e3bb&&!_0x32d561&&_0x221206!==undefined&&_0x221206!=_0x248c70;if(_0x32d561||_0x5a66c6){const _0x26a85a=_0x2026aa[_0x1f1972(0xff)]||_0x572a52,_0x5dc878=(_0x572a52-_0x26a85a)/0x3e8;_0x2026aa[_0x1f1972(0xff)]=_0x572a52,_0x2026aa[_0x1f1972(0x157)]('TRACK_EVENT',{'room':_0x4bf36d['location'],'dt':_0x5dc878});}}}return _0x481cc7;}module[a5_0x4a2837(0xf7)]={'processSensorEvent':processSensorEvent,'getOutsideTemperatureNumeric':getOutsideTemperatureNumeric,'setPresence':setPresence,'abortExitTimer':abortExitTimer,'startExitTimer':startExitTimer};