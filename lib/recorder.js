const a5_0x484ef3=a5_0x4362;(function(_0x390186,_0x2f7db6){const _0x285eda=a5_0x4362,_0x2be658=_0x390186();while(!![]){try{const _0x499f4f=parseInt(_0x285eda(0x19d))/0x1+parseInt(_0x285eda(0x1ca))/0x2*(-parseInt(_0x285eda(0x1d4))/0x3)+parseInt(_0x285eda(0x1c2))/0x4*(parseInt(_0x285eda(0x1bf))/0x5)+-parseInt(_0x285eda(0x1b0))/0x6+-parseInt(_0x285eda(0x1e8))/0x7*(parseInt(_0x285eda(0x1a4))/0x8)+-parseInt(_0x285eda(0x1c1))/0x9+parseInt(_0x285eda(0x17a))/0xa;if(_0x499f4f===_0x2f7db6)break;else _0x2be658['push'](_0x2be658['shift']());}catch(_0x26b70c){_0x2be658['push'](_0x2be658['shift']());}}}(a5_0x5cfe,0x722c9));function a5_0x5cfe(){const _0x5bbb2f=['rawEventLog','from','lampe','map','isGracePeriodActive','switch','splice','getForeignStateAsync','getStateAsync','sendToPythonWrapper','logDuplicates','eventHistory','weatherunderground','parse','loc','41916uZxFXm','includes','[RECORDER]\x20Error:\x20','14560310PancfL','Temperature','events.lastEvent','.Current.Temperature','window','schloss','occupancy','.ACTUAL_TEMPERATURE','light','val','LTM.trainingData.sequences','.forecast.current.temp','SIMULATE_SIGNAL','lastTrackerEventTime','heizung','exitTimer','pop','LEVEL','apply','length','.LEVEL','number','(((.+)+)+)+$','exitGraceTimer','outdoorSensorId','shift','setStateAsync','constructor','message','isProVersion','\x20from\x20','config','system.isPresent','thermostat','isPresent','506038gLTCld','bewegung','dimmer','[RECORDER]\x20Ignored\x20implausible\x20temperature:\x20','push','licht','daswetter','760TGEYpT','STATE','log','schalter','tür','.1.TEMPERATURE','toString','motion','kontakt','temperature','currentSystemMode','useWeather','3907542eFrKMC','weatherInstance','toLowerCase','normal','exports','round','presence','TRACK_EVENT','klima','STATUS','location','type','getHours','value','sensorLastValues','5KsqkNa','search','5356440chdLit','2500676kDcdYO','name','.4.VALVE_STATE','griff','door','some','LTM.rawEventLog','stringify','304304lChEvN','.1.LEVEL','now','fenster','openweathermap','valveMapping','Unknown','.forecast.current.temperature','contact','replace','6ZaGPfS','.1.ACTUAL_TEMPERATURE','LTM.trainingData.thermodynamics','unshift','präsenz'];a5_0x5cfe=function(){return _0x5bbb2f;};return a5_0x5cfe();}const a5_0x1d5f88=(function(){let _0x6b049=!![];return function(_0x38acd5,_0xf83324){const _0x5a47fb=_0x6b049?function(){const _0x2c0515=a5_0x4362;if(_0xf83324){const _0x2097e5=_0xf83324[_0x2c0515(0x18c)](_0x38acd5,arguments);return _0xf83324=null,_0x2097e5;}}:function(){};return _0x6b049=![],_0x5a47fb;};}()),a5_0x15a896=a5_0x1d5f88(this,function(){const _0x3944da=a5_0x4362;return a5_0x15a896['toString']()[_0x3944da(0x1c0)](_0x3944da(0x190))[_0x3944da(0x1aa)]()[_0x3944da(0x195)](a5_0x15a896)[_0x3944da(0x1c0)](_0x3944da(0x190));});a5_0x15a896();'use strict';const HISTORY_MAX_SIZE=0x32,RAW_LOG_MAX_SIZE=0x9c4,THERMO_LOG_SIZE=0x3e8,SEQUENCE_TIMEOUT_MS=0x5*0x3c*0x3e8,MAX_TRAINING_SET_SIZE=0x1f4,EXIT_TIMER_MINUTES=0xf,EXIT_GRACE_PERIOD_SECONDS=0x1e;let activeSequence=[],sequenceTimer=null;async function getOutsideTemperatureNumeric(_0x3d85c2){const _0x15b326=a5_0x4362;if(_0x3d85c2[_0x15b326(0x199)]['outdoorSensorId'])try{const _0x4a624b=await _0x3d85c2['getForeignStateAsync'](_0x3d85c2[_0x15b326(0x199)][_0x15b326(0x192)]);if(_0x4a624b&&_0x4a624b[_0x15b326(0x183)]!==undefined&&_0x4a624b[_0x15b326(0x183)]!==null)return parseFloat(_0x4a624b[_0x15b326(0x183)]);}catch(_0x53c0fd){}const _0x2c7246=_0x3d85c2[_0x15b326(0x199)][_0x15b326(0x1b1)];if(!_0x3d85c2['config'][_0x15b326(0x1af)]||!_0x2c7246)return null;try{let _0x36c971='';if(_0x2c7246[_0x15b326(0x178)]('accuweather'))_0x36c971=_0x2c7246+_0x15b326(0x17d);else{if(_0x2c7246['includes'](_0x15b326(0x1a3)))_0x36c971=_0x2c7246+'.NextHours.Location_1.Day_1.current.temp_value';else{if(_0x2c7246[_0x15b326(0x178)](_0x15b326(0x1ce)))_0x36c971=_0x2c7246+_0x15b326(0x1d1);else{if(_0x2c7246[_0x15b326(0x178)](_0x15b326(0x1e5)))_0x36c971=_0x2c7246+_0x15b326(0x185);}}}if(_0x36c971){const _0x2a29b0=await _0x3d85c2[_0x15b326(0x1e0)](_0x36c971);if(_0x2a29b0&&_0x2a29b0[_0x15b326(0x183)]!==undefined&&_0x2a29b0[_0x15b326(0x183)]!==null)return parseFloat(_0x2a29b0['val']);}}catch(_0x5acbaf){}return null;}async function recordThermodynamics(_0x3d1213,_0x32c6ae,_0x435643,_0x327b66){const _0x3d1dd0=a5_0x4362,_0xdc5981=await getOutsideTemperatureNumeric(_0x3d1213);if(_0xdc5981===null)return;let _0x3c6f3e=0x0,_0x27280e=![];if(_0x3d1213[_0x3d1dd0(0x199)][_0x3d1dd0(0x1cf)])try{let _0x3cb2eb=_0x3d1213[_0x3d1dd0(0x199)]['valveMapping'];if(typeof _0x3cb2eb==='string')_0x3cb2eb=JSON[_0x3d1dd0(0x1e6)](_0x3cb2eb);if(_0x3cb2eb[_0x32c6ae]){const _0x5d7825=_0x3cb2eb[_0x32c6ae],_0x3729a4=await _0x3d1213[_0x3d1dd0(0x1e0)](_0x5d7825);if(_0x3729a4&&_0x3729a4[_0x3d1dd0(0x183)]!==null&&_0x3729a4['val']!==undefined){let _0x41f063=Number(_0x3729a4[_0x3d1dd0(0x183)]);if(_0x41f063<=1.05&&!_0x5d7825[_0x3d1dd0(0x178)](_0x3d1dd0(0x1b9))&&!_0x5d7825[_0x3d1dd0(0x178)](_0x3d1dd0(0x1a5)))_0x41f063=_0x41f063*0x64;_0x3c6f3e=Math[_0x3d1dd0(0x1b5)](_0x41f063),_0x27280e=!![];}}}catch(_0x395d96){}if(!_0x27280e){const _0x3666a1=[{'from':_0x3d1dd0(0x1d5),'to':_0x3d1dd0(0x1cb)},{'from':_0x3d1dd0(0x1d5),'to':'.1.VALVE_STATE'},{'from':_0x3d1dd0(0x1a9),'to':_0x3d1dd0(0x1c4)},{'from':_0x3d1dd0(0x181),'to':_0x3d1dd0(0x18e)},{'from':'temperature','to':'level'},{'from':_0x3d1dd0(0x17b),'to':'Valve'}];for(const _0x3e407d of _0x3666a1){if(_0x32c6ae['includes'](_0x3e407d['from'])){const _0x4e0310=_0x32c6ae[_0x3d1dd0(0x1d3)](_0x3e407d[_0x3d1dd0(0x1da)],_0x3e407d['to']);try{const _0x21bbe1=await _0x3d1213['getForeignStateAsync'](_0x4e0310);if(_0x21bbe1&&_0x21bbe1[_0x3d1dd0(0x183)]!==null&&_0x21bbe1[_0x3d1dd0(0x183)]!==undefined){let _0xdddebc=Number(_0x21bbe1[_0x3d1dd0(0x183)]);if(typeof _0xdddebc===_0x3d1dd0(0x18f)){if(_0xdddebc<=1.05&&_0x3e407d['to'][_0x3d1dd0(0x178)](_0x3d1dd0(0x18b)))_0xdddebc=_0xdddebc*0x64;_0x3c6f3e=Math[_0x3d1dd0(0x1b5)](_0xdddebc),_0x27280e=!![];break;}}}catch(_0xeb656f){}}}}const _0x544937=await _0x3d1213[_0x3d1dd0(0x1e1)](_0x3d1dd0(0x1d6));let _0xa6ea1f=[];if(_0x544937&&_0x544937[_0x3d1dd0(0x183)])try{_0xa6ea1f=JSON[_0x3d1dd0(0x1e6)](_0x544937[_0x3d1dd0(0x183)]);}catch(_0x2a5a36){}_0xa6ea1f[_0x3d1dd0(0x1a1)]({'ts':Date['now'](),'room':_0x327b66||_0x3d1dd0(0x1d0),'t_in':_0x435643,'t_out':_0xdc5981,'valve':_0x3c6f3e});if(_0xa6ea1f[_0x3d1dd0(0x18d)]>THERMO_LOG_SIZE)_0xa6ea1f[_0x3d1dd0(0x193)]();await _0x3d1213[_0x3d1dd0(0x194)](_0x3d1dd0(0x1d6),{'val':JSON['stringify'](_0xa6ea1f),'ack':!![]});}async function saveCompletedSequence(_0x165440){const _0x45bf22=a5_0x4362;try{const _0x522845=await _0x165440[_0x45bf22(0x1e1)]('LTM.trainingData.sequences');let _0x4f8cc0=[];if(_0x522845&&_0x522845[_0x45bf22(0x183)])try{_0x4f8cc0=JSON[_0x45bf22(0x1e6)](_0x522845[_0x45bf22(0x183)]);}catch(_0x27173e){}const _0x16c35f=activeSequence[0x0]['ts'],_0x3401fc=activeSequence[_0x45bf22(0x1dc)](_0x2a6917=>({'loc':_0x2a6917[_0x45bf22(0x1e7)],'t_delta':Math[_0x45bf22(0x1b5)]((_0x2a6917['ts']-_0x16c35f)/0x3e8)})),_0x3008ec={'timestamp':new Date(_0x16c35f)['toISOString'](),'steps':_0x3401fc,'duration':Math[_0x45bf22(0x1b5)]((activeSequence[activeSequence[_0x45bf22(0x18d)]-0x1]['ts']-_0x16c35f)/0x3e8),'daytime':new Date(_0x16c35f)[_0x45bf22(0x1bc)]()};_0x4f8cc0[_0x45bf22(0x1a1)](_0x3008ec);if(_0x4f8cc0[_0x45bf22(0x18d)]>MAX_TRAINING_SET_SIZE)_0x4f8cc0[_0x45bf22(0x193)]();await _0x165440[_0x45bf22(0x194)](_0x45bf22(0x184),{'val':JSON[_0x45bf22(0x1c9)](_0x4f8cc0),'ack':!![]}),_0x165440[_0x45bf22(0x197)]&&_0x165440[_0x45bf22(0x1e2)]&&_0x165440[_0x45bf22(0x1e2)]('ANALYZE_SEQUENCE',{'sequence':_0x3008ec});}catch(_0x427aa7){_0x165440[_0x45bf22(0x1a6)]['error'](_0x45bf22(0x179)+_0x427aa7[_0x45bf22(0x196)]);}}async function recordSequence(_0x3507ff,_0x4546b6){const _0x31a0fd=a5_0x4362,_0x14e0ce=(_0x4546b6['type']||'')[_0x31a0fd(0x1b2)](),_0x1d1a35=[_0x31a0fd(0x1ab),_0x31a0fd(0x19e),_0x31a0fd(0x1d8),_0x31a0fd(0x1b6),_0x31a0fd(0x180),_0x31a0fd(0x1c6),'tür',_0x31a0fd(0x17e),_0x31a0fd(0x1cd),_0x31a0fd(0x1d2),_0x31a0fd(0x1ac),_0x31a0fd(0x182),_0x31a0fd(0x1a2),'switch',_0x31a0fd(0x1a7),_0x31a0fd(0x19f),_0x31a0fd(0x1db)];if(!_0x1d1a35[_0x31a0fd(0x1c7)](_0xfe62ee=>_0x14e0ce[_0x31a0fd(0x178)](_0xfe62ee)))return;if(!_0x4546b6[_0x31a0fd(0x1bd)])return;if(sequenceTimer)clearTimeout(sequenceTimer);activeSequence['push']({'loc':_0x4546b6['location']||_0x31a0fd(0x1d0),'id':_0x4546b6['id'],'ts':Date[_0x31a0fd(0x1cc)]()}),sequenceTimer=setTimeout(async()=>{const _0x55c154=_0x31a0fd;if(activeSequence[_0x55c154(0x18d)]>0x1)await saveCompletedSequence(_0x3507ff);activeSequence=[];},SEQUENCE_TIMEOUT_MS);}function startExitTimer(_0x1edf53){const _0x3d7ab2=a5_0x4362;abortExitTimer(_0x1edf53),_0x1edf53[_0x3d7ab2(0x1dd)]=!![],_0x1edf53[_0x3d7ab2(0x191)]=setTimeout(()=>{const _0x3ee04b=_0x3d7ab2;_0x1edf53[_0x3ee04b(0x1dd)]=![];},EXIT_GRACE_PERIOD_SECONDS*0x3e8),_0x1edf53[_0x3d7ab2(0x189)]=setTimeout(()=>{const _0x5ea1c5=_0x3d7ab2;setPresence(_0x1edf53,![]),_0x1edf53[_0x5ea1c5(0x189)]=null;},EXIT_TIMER_MINUTES*0x3c*0x3e8);}function abortExitTimer(_0x125418){const _0x36add2=a5_0x4362;if(_0x125418[_0x36add2(0x189)])clearTimeout(_0x125418[_0x36add2(0x189)]);if(_0x125418[_0x36add2(0x191)])clearTimeout(_0x125418['exitGraceTimer']);_0x125418['exitTimer']=null,_0x125418['exitGraceTimer']=null,_0x125418['isGracePeriodActive']=![];}async function setPresence(_0x23fcb2,_0x32d66e){const _0x942fce=a5_0x4362;if(_0x23fcb2['isPresent']===_0x32d66e)return;_0x23fcb2[_0x942fce(0x19c)]=_0x32d66e,await _0x23fcb2[_0x942fce(0x194)](_0x942fce(0x19a),{'val':_0x32d66e,'ack':!![]});}async function processSensorEvent(_0x3ef190,_0x191a02,_0x3a4213,_0x1ee2a1){const _0x1deb96=a5_0x4362;if(!_0x1ee2a1)return null;const _0x2e26f7=_0x3a4213[_0x1deb96(0x183)],_0x3d06e0=Date['now'](),_0x410770=_0x3ef190[_0x1deb96(0x1be)][_0x191a02],_0x371e90=(_0x1ee2a1['type']||'')[_0x1deb96(0x1b2)](),_0x226178=_0x371e90[_0x1deb96(0x178)](_0x1deb96(0x1ad))||_0x371e90[_0x1deb96(0x178)]('temperatur')||_0x371e90[_0x1deb96(0x178)](_0x1deb96(0x1b8))||_0x371e90[_0x1deb96(0x178)](_0x1deb96(0x188))||_0x371e90[_0x1deb96(0x178)](_0x1deb96(0x19b));if(_0x226178&&typeof _0x2e26f7===_0x1deb96(0x18f)){if(_0x2e26f7>0x50||_0x2e26f7<-0x32)return _0x3ef190[_0x1deb96(0x1a6)]['debug'](_0x1deb96(0x1a0)+_0x2e26f7+_0x1deb96(0x198)+_0x191a02),null;}_0x3ef190[_0x1deb96(0x1be)][_0x191a02]=_0x2e26f7;if(!_0x1ee2a1[_0x1deb96(0x1e3)]&&_0x410770!=undefined&&_0x410770==_0x2e26f7)return null;_0x3ef190[_0x1deb96(0x197)]&&_0x226178&&recordThermodynamics(_0x3ef190,_0x191a02,_0x2e26f7,_0x1ee2a1['location']);const _0x3fa0ad={'timestamp':_0x3d06e0,'id':_0x191a02,'name':_0x1ee2a1[_0x1deb96(0x1c3)],'type':_0x1ee2a1[_0x1deb96(0x1bb)],'location':_0x1ee2a1[_0x1deb96(0x1ba)],'value':_0x2e26f7};_0x3ef190['eventHistory'][_0x1deb96(0x1d7)](_0x3fa0ad);if(_0x3ef190['eventHistory'][_0x1deb96(0x18d)]>HISTORY_MAX_SIZE)_0x3ef190[_0x1deb96(0x1e4)][_0x1deb96(0x18a)]();await _0x3ef190[_0x1deb96(0x194)](_0x1deb96(0x17c),{'val':JSON[_0x1deb96(0x1c9)](_0x3fa0ad),'ack':!![]}),await _0x3ef190['setStateAsync']('events.history',{'val':JSON['stringify'](_0x3ef190[_0x1deb96(0x1e4)]),'ack':!![]});if(_0x3ef190['isProVersion']){_0x3ef190['rawEventLog'][_0x1deb96(0x1a1)](_0x3fa0ad);if(_0x3ef190['rawEventLog']['length']>RAW_LOG_MAX_SIZE)_0x3ef190[_0x1deb96(0x1d9)][_0x1deb96(0x1df)](0x0,_0x3ef190[_0x1deb96(0x1d9)]['length']-RAW_LOG_MAX_SIZE);await _0x3ef190['setStateAsync'](_0x1deb96(0x1c8),{'val':JSON['stringify'](_0x3ef190[_0x1deb96(0x1d9)]),'ack':!![]}),recordSequence(_0x3ef190,_0x3fa0ad);}if(_0x1ee2a1['isExit']&&_0x2e26f7===!![]){if(_0x3ef190[_0x1deb96(0x19c)]&&!_0x3ef190[_0x1deb96(0x1dd)])startExitTimer(_0x3ef190);else{if(!_0x3ef190[_0x1deb96(0x19c)])setPresence(_0x3ef190,!![]);}}else{if(_0x1ee2a1[_0x1deb96(0x1bb)]==='motion'&&_0x2e26f7===!![]){if(_0x3ef190['exitTimer'])abortExitTimer(_0x3ef190);if(!_0x3ef190[_0x1deb96(0x19c)]&&_0x3ef190[_0x1deb96(0x1ae)]===_0x1deb96(0x1b3))setPresence(_0x3ef190,!![]);}}if(_0x3ef190['isProVersion']&&_0x3ef190[_0x1deb96(0x1e2)]){_0x1ee2a1[_0x1deb96(0x1bb)]===_0x1deb96(0x1ab)&&_0x2e26f7===!![]&&_0x1ee2a1[_0x1deb96(0x1ba)]&&_0x3ef190[_0x1deb96(0x1e2)](_0x1deb96(0x186),{'room':_0x1ee2a1[_0x1deb96(0x1ba)]});const _0x58567b=[_0x1deb96(0x1c6),_0x1deb96(0x1a8),_0x1deb96(0x17e),_0x1deb96(0x1cd),_0x1deb96(0x1c5),'handle','lock',_0x1deb96(0x17f)][_0x1deb96(0x1c7)](_0x30cc49=>_0x371e90[_0x1deb96(0x178)](_0x30cc49)),_0x50b4eb=[_0x1deb96(0x182),'licht',_0x1deb96(0x1de),_0x1deb96(0x1a7),'dimmer','lampe']['some'](_0x63e26b=>_0x371e90['includes'](_0x63e26b)),_0xc14251=['motion',_0x1deb96(0x19e),_0x1deb96(0x1d8),_0x1deb96(0x1b6),'occupancy']['some'](_0x59c285=>_0x371e90[_0x1deb96(0x178)](_0x59c285));if(_0x1ee2a1['location']&&(_0x58567b||_0x50b4eb||_0xc14251)){const _0x5e7a2e=_0x2e26f7===!![]||typeof _0x2e26f7==='number'&&_0x2e26f7>0x0,_0x58913c=_0x58567b&&!_0x5e7a2e&&_0x410770!==undefined&&_0x410770!=_0x2e26f7;if(_0x5e7a2e||_0x58913c){const _0x23132c=_0x3ef190[_0x1deb96(0x187)]||_0x3d06e0,_0x3e4428=(_0x3d06e0-_0x23132c)/0x3e8;_0x3ef190['lastTrackerEventTime']=_0x3d06e0,_0x3ef190['sendToPythonWrapper'](_0x1deb96(0x1b7),{'room':_0x1ee2a1[_0x1deb96(0x1ba)],'dt':_0x3e4428});}}}return _0x3fa0ad;}function a5_0x4362(_0x242e35,_0x4544a0){const _0x327864=a5_0x5cfe();return a5_0x4362=function(_0x15a896,_0x1d5f88){_0x15a896=_0x15a896-0x178;let _0x5cfe41=_0x327864[_0x15a896];return _0x5cfe41;},a5_0x4362(_0x242e35,_0x4544a0);}module[a5_0x484ef3(0x1b4)]={'processSensorEvent':processSensorEvent,'getOutsideTemperatureNumeric':getOutsideTemperatureNumeric,'setPresence':setPresence,'abortExitTimer':abortExitTimer,'startExitTimer':startExitTimer};