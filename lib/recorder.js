const a5_0x460a9f=a5_0x4b99;(function(_0x3fa22c,_0x21fa4d){const _0x27e05a=a5_0x4b99,_0x27a85c=_0x3fa22c();while(!![]){try{const _0x2ecdc1=parseInt(_0x27e05a(0x138))/0x1*(-parseInt(_0x27e05a(0x12d))/0x2)+-parseInt(_0x27e05a(0x156))/0x3*(parseInt(_0x27e05a(0x13d))/0x4)+parseInt(_0x27e05a(0x159))/0x5+-parseInt(_0x27e05a(0x147))/0x6*(parseInt(_0x27e05a(0x151))/0x7)+-parseInt(_0x27e05a(0x15a))/0x8+-parseInt(_0x27e05a(0x137))/0x9+parseInt(_0x27e05a(0x125))/0xa;if(_0x2ecdc1===_0x21fa4d)break;else _0x27a85c['push'](_0x27a85c['shift']());}catch(_0xd07da1){_0x27a85c['push'](_0x27a85c['shift']());}}}(a5_0x23b3,0xcb069));const a5_0xe3240=(function(){let _0x2f2f0e=!![];return function(_0x32cf0a,_0x68edc7){const _0x507dfb=_0x2f2f0e?function(){if(_0x68edc7){const _0x1a39df=_0x68edc7['apply'](_0x32cf0a,arguments);return _0x68edc7=null,_0x1a39df;}}:function(){};return _0x2f2f0e=![],_0x507dfb;};}()),a5_0x2105a8=a5_0xe3240(this,function(){const _0x23cb94=a5_0x4b99;return a5_0x2105a8['toString']()[_0x23cb94(0x135)](_0x23cb94(0x11a))[_0x23cb94(0x163)]()[_0x23cb94(0x14e)](a5_0x2105a8)[_0x23cb94(0x135)](_0x23cb94(0x11a));});a5_0x2105a8();'use strict';const HISTORY_MAX_SIZE=0x32,RAW_LOG_MAX_SIZE=0x9c4,THERMO_LOG_SIZE=0x3e8,SEQUENCE_TIMEOUT_MS=0x5*0x3c*0x3e8,MAX_TRAINING_SET_SIZE=0x1f4,EXIT_TIMER_MINUTES=0xf,EXIT_GRACE_PERIOD_SECONDS=0x1e;function a5_0x4b99(_0xcd8db8,_0x2727b2){const _0x4cadb9=a5_0x23b3();return a5_0x4b99=function(_0x2105a8,_0xe3240){_0x2105a8=_0x2105a8-0x118;let _0x23b399=_0x4cadb9[_0x2105a8];return _0x23b399;},a5_0x4b99(_0xcd8db8,_0x2727b2);}let activeSequence=[],sequenceTimer=null;async function getOutsideTemperatureNumeric(_0x122120){const _0x494691=a5_0x4b99;if(_0x122120[_0x494691(0x142)]['outdoorSensorId'])try{const _0x5644cf=await _0x122120['getForeignStateAsync'](_0x122120[_0x494691(0x142)]['outdoorSensorId']);if(_0x5644cf&&_0x5644cf[_0x494691(0x14a)]!==undefined&&_0x5644cf['val']!==null)return parseFloat(_0x5644cf[_0x494691(0x14a)]);}catch(_0x59b0db){}const _0x2a8a42=_0x122120[_0x494691(0x142)][_0x494691(0x121)];if(!_0x122120['config'][_0x494691(0x11e)]||!_0x2a8a42)return null;try{let _0x107591='';if(_0x2a8a42[_0x494691(0x16f)]('accuweather'))_0x107591=_0x2a8a42+_0x494691(0x124);else{if(_0x2a8a42[_0x494691(0x16f)](_0x494691(0x122)))_0x107591=_0x2a8a42+'.NextHours.Location_1.Day_1.current.temp_value';else{if(_0x2a8a42[_0x494691(0x16f)]('openweathermap'))_0x107591=_0x2a8a42+_0x494691(0x133);else{if(_0x2a8a42[_0x494691(0x16f)]('weatherunderground'))_0x107591=_0x2a8a42+_0x494691(0x15e);}}}if(_0x107591){const _0x4ce3fe=await _0x122120['getForeignStateAsync'](_0x107591);if(_0x4ce3fe&&_0x4ce3fe[_0x494691(0x14a)]!==undefined&&_0x4ce3fe[_0x494691(0x14a)]!==null)return parseFloat(_0x4ce3fe[_0x494691(0x14a)]);}}catch(_0x18c956){}return null;}async function recordThermodynamics(_0xb867d5,_0x42ae0a,_0x1c463f,_0x28ccf3){const _0x472afd=a5_0x4b99,_0x8727b4=await getOutsideTemperatureNumeric(_0xb867d5);let _0xbdb86e=0x0;if(_0x42ae0a['includes']('hm-rpc')){const _0x176c3c=[{'from':_0x472afd(0x167),'to':'.1.LEVEL'},{'from':'.1.ACTUAL_TEMPERATURE','to':_0x472afd(0x143)},{'from':_0x472afd(0x11f),'to':_0x472afd(0x16d)},{'from':_0x472afd(0x12c),'to':_0x472afd(0x118)}];for(const _0x346296 of _0x176c3c){if(_0x42ae0a['includes'](_0x346296[_0x472afd(0x168)])){const _0x5f2b22=_0x42ae0a['replace'](_0x346296[_0x472afd(0x168)],_0x346296['to']);try{const _0x2f81ae=await _0xb867d5['getForeignStateAsync'](_0x5f2b22);if(_0x2f81ae&&_0x2f81ae[_0x472afd(0x14a)]!==null&&_0x2f81ae[_0x472afd(0x14a)]!==undefined){let _0x242b05=_0x2f81ae[_0x472afd(0x14a)];typeof _0x242b05==='number'&&_0x242b05<=1.05&&_0x346296['to'][_0x472afd(0x16f)](_0x472afd(0x169))&&(_0x242b05=_0x242b05*0x64);_0xbdb86e=Math['round'](_0x242b05);break;}}catch(_0x144925){}}}}const _0x1bd8b3=await _0xb867d5[_0x472afd(0x11d)](_0x472afd(0x13b));let _0x143d19=[];if(_0x1bd8b3&&_0x1bd8b3[_0x472afd(0x14a)])try{_0x143d19=JSON[_0x472afd(0x145)](_0x1bd8b3[_0x472afd(0x14a)]);}catch(_0x2be363){}_0x143d19[_0x472afd(0x136)]({'ts':Date['now'](),'room':_0x28ccf3||'Unknown','t_in':_0x1c463f,'t_out':_0x8727b4,'valve':_0xbdb86e});if(_0x143d19[_0x472afd(0x14b)]>THERMO_LOG_SIZE)_0x143d19[_0x472afd(0x166)]();await _0xb867d5[_0x472afd(0x129)]('LTM.trainingData.thermodynamics',{'val':JSON[_0x472afd(0x144)](_0x143d19),'ack':!![]});}async function saveCompletedSequence(_0x5db24b){const _0x5bef81=a5_0x4b99;try{const _0x16f295=await _0x5db24b[_0x5bef81(0x11d)](_0x5bef81(0x170));let _0x4808e3=[];if(_0x16f295&&_0x16f295[_0x5bef81(0x14a)])try{_0x4808e3=JSON[_0x5bef81(0x145)](_0x16f295[_0x5bef81(0x14a)]);}catch(_0x893718){}const _0x7991d6=activeSequence[0x0]['ts'],_0x497cf3=activeSequence[_0x5bef81(0x12e)](_0x5d4a1f=>({'loc':_0x5d4a1f[_0x5bef81(0x148)],'t_delta':Math[_0x5bef81(0x15d)]((_0x5d4a1f['ts']-_0x7991d6)/0x3e8)})),_0x3bf1bc={'timestamp':new Date(_0x7991d6)[_0x5bef81(0x154)](),'steps':_0x497cf3,'duration':Math['round']((activeSequence[activeSequence[_0x5bef81(0x14b)]-0x1]['ts']-_0x7991d6)/0x3e8),'daytime':new Date(_0x7991d6)['getHours']()};_0x4808e3['push'](_0x3bf1bc);if(_0x4808e3[_0x5bef81(0x14b)]>MAX_TRAINING_SET_SIZE)_0x4808e3[_0x5bef81(0x166)]();await _0x5db24b[_0x5bef81(0x129)](_0x5bef81(0x170),{'val':JSON[_0x5bef81(0x144)](_0x4808e3),'ack':!![]}),_0x5db24b['isProVersion']&&_0x5db24b['sendToPythonWrapper']&&_0x5db24b[_0x5bef81(0x14f)](_0x5bef81(0x132),{'sequence':_0x3bf1bc});}catch(_0x2999b7){_0x5db24b[_0x5bef81(0x15b)][_0x5bef81(0x146)]('[RECORDER]\x20Error:\x20'+_0x2999b7[_0x5bef81(0x120)]);}}async function recordSequence(_0x1acb31,_0x1c6f33){const _0x12777d=a5_0x4b99,_0x149171=(_0x1c6f33[_0x12777d(0x16c)]||'')[_0x12777d(0x157)](),_0x2a3e72=[_0x12777d(0x131),_0x12777d(0x16e),'präsenz',_0x12777d(0x119),_0x12777d(0x141),_0x12777d(0x123),_0x12777d(0x15c),_0x12777d(0x162),_0x12777d(0x149),_0x12777d(0x152),'kontakt',_0x12777d(0x13f),'licht',_0x12777d(0x12f),_0x12777d(0x130),_0x12777d(0x14c),'lampe'];if(!_0x2a3e72['some'](_0x4d622d=>_0x149171[_0x12777d(0x16f)](_0x4d622d)))return;if(!_0x1c6f33['value'])return;if(sequenceTimer)clearTimeout(sequenceTimer);activeSequence[_0x12777d(0x136)]({'loc':_0x1c6f33[_0x12777d(0x150)]||'Unknown','id':_0x1c6f33['id'],'ts':Date[_0x12777d(0x126)]()}),sequenceTimer=setTimeout(async()=>{if(activeSequence['length']>0x1)await saveCompletedSequence(_0x1acb31);activeSequence=[];},SEQUENCE_TIMEOUT_MS);}function startExitTimer(_0x3c0cab){const _0x24d3d9=a5_0x4b99;abortExitTimer(_0x3c0cab),_0x3c0cab[_0x24d3d9(0x139)]=!![],_0x3c0cab['exitGraceTimer']=setTimeout(()=>{_0x3c0cab['isGracePeriodActive']=![];},EXIT_GRACE_PERIOD_SECONDS*0x3e8),_0x3c0cab[_0x24d3d9(0x134)]=setTimeout(()=>{const _0x31abd7=_0x24d3d9;setPresence(_0x3c0cab,![]),_0x3c0cab[_0x31abd7(0x134)]=null;},EXIT_TIMER_MINUTES*0x3c*0x3e8);}function abortExitTimer(_0x4eac8b){const _0x45cc0a=a5_0x4b99;if(_0x4eac8b[_0x45cc0a(0x134)])clearTimeout(_0x4eac8b[_0x45cc0a(0x134)]);if(_0x4eac8b[_0x45cc0a(0x160)])clearTimeout(_0x4eac8b[_0x45cc0a(0x160)]);_0x4eac8b[_0x45cc0a(0x134)]=null,_0x4eac8b['exitGraceTimer']=null,_0x4eac8b[_0x45cc0a(0x139)]=![];}function a5_0x23b3(){const _0x2a9005=['weatherInstance','daswetter','door','.Current.Temperature','38847540hsqjZK','now','rawEventLog','isPresent','setStateAsync','currentSystemMode','exports','.ACTUAL_TEMPERATURE','1065656DecpJr','map','switch','schalter','motion','ANALYZE_SEQUENCE','.forecast.current.temperature','exitTimer','search','push','2556675yqzzBx','3MisyKY','isGracePeriodActive','unshift','LTM.trainingData.thermodynamics','eventHistory','5884qwQiLn','isProVersion','light','LTM.rawEventLog','occupancy','config','.1.VALVE_STATE','stringify','parse','error','78klscTm','loc','fenster','val','length','dimmer','events.lastEvent','constructor','sendToPythonWrapper','location','351421knjRre','contact','name','toISOString','temperature','1395SkcsrX','toLowerCase','klima','878635GLAgbj','77400soJOaO','log','tür','round','.forecast.current.temp','temperatur','exitGraceTimer','events.history','window','toString','isExit','sensorLastValues','shift','.1.ACTUAL_TEMPERATURE','from','LEVEL','pop','system.isPresent','type','.4.VALVE_STATE','bewegung','includes','LTM.trainingData.sequences','normal','.LEVEL','presence','(((.+)+)+)+$','heizung','SIMULATE_SIGNAL','getStateAsync','useWeather','.1.TEMPERATURE','message'];a5_0x23b3=function(){return _0x2a9005;};return a5_0x23b3();}async function setPresence(_0x128f64,_0x38c4c0){const _0x36ee4a=a5_0x4b99;if(_0x128f64['isPresent']===_0x38c4c0)return;_0x128f64[_0x36ee4a(0x128)]=_0x38c4c0,await _0x128f64['setStateAsync'](_0x36ee4a(0x16b),{'val':_0x38c4c0,'ack':!![]});}async function processSensorEvent(_0x511657,_0x688751,_0x3a1309,_0x64c95c){const _0xff2f09=a5_0x4b99;if(!_0x64c95c)return null;const _0x2b6c75=_0x3a1309[_0xff2f09(0x14a)],_0x3b66d9=Date[_0xff2f09(0x126)](),_0x2d8dbb=_0x511657[_0xff2f09(0x165)][_0x688751];_0x511657[_0xff2f09(0x165)][_0x688751]=_0x2b6c75;if(!_0x64c95c['logDuplicates']&&_0x2d8dbb!=undefined&&_0x2d8dbb==_0x2b6c75)return null;const _0xd745e6=(_0x64c95c[_0xff2f09(0x16c)]||'')[_0xff2f09(0x157)](),_0x34bac4=_0xd745e6['includes'](_0xff2f09(0x155))||_0xd745e6[_0xff2f09(0x16f)](_0xff2f09(0x15f))||_0xd745e6[_0xff2f09(0x16f)](_0xff2f09(0x158))||_0xd745e6['includes'](_0xff2f09(0x11b));_0x511657['isProVersion']&&_0x34bac4&&recordThermodynamics(_0x511657,_0x688751,_0x2b6c75,_0x64c95c[_0xff2f09(0x150)]);const _0x1bb781={'timestamp':_0x3b66d9,'id':_0x688751,'name':_0x64c95c[_0xff2f09(0x153)],'type':_0x64c95c[_0xff2f09(0x16c)],'location':_0x64c95c[_0xff2f09(0x150)],'value':_0x2b6c75};_0x511657[_0xff2f09(0x13c)][_0xff2f09(0x13a)](_0x1bb781);if(_0x511657[_0xff2f09(0x13c)]['length']>HISTORY_MAX_SIZE)_0x511657[_0xff2f09(0x13c)][_0xff2f09(0x16a)]();await _0x511657[_0xff2f09(0x129)](_0xff2f09(0x14d),{'val':JSON['stringify'](_0x1bb781),'ack':!![]}),await _0x511657[_0xff2f09(0x129)](_0xff2f09(0x161),{'val':JSON['stringify'](_0x511657[_0xff2f09(0x13c)]),'ack':!![]});if(_0x511657[_0xff2f09(0x13e)]){_0x511657[_0xff2f09(0x127)][_0xff2f09(0x136)](_0x1bb781);if(_0x511657[_0xff2f09(0x127)]['length']>RAW_LOG_MAX_SIZE)_0x511657[_0xff2f09(0x127)]['splice'](0x0,_0x511657[_0xff2f09(0x127)][_0xff2f09(0x14b)]-RAW_LOG_MAX_SIZE);await _0x511657[_0xff2f09(0x129)](_0xff2f09(0x140),{'val':JSON[_0xff2f09(0x144)](_0x511657[_0xff2f09(0x127)]),'ack':!![]}),recordSequence(_0x511657,_0x1bb781);}if(_0x64c95c[_0xff2f09(0x164)]&&_0x2b6c75===!![]){if(_0x511657[_0xff2f09(0x128)]&&!_0x511657[_0xff2f09(0x139)])startExitTimer(_0x511657);else{if(!_0x511657[_0xff2f09(0x128)])setPresence(_0x511657,!![]);}}else{if(_0x64c95c['type']===_0xff2f09(0x131)&&_0x2b6c75===!![]){if(_0x511657[_0xff2f09(0x134)])abortExitTimer(_0x511657);if(!_0x511657['isPresent']&&_0x511657[_0xff2f09(0x12a)]===_0xff2f09(0x171))setPresence(_0x511657,!![]);}}return _0x511657[_0xff2f09(0x13e)]&&_0x64c95c[_0xff2f09(0x16c)]===_0xff2f09(0x131)&&_0x2b6c75===!![]&&_0x64c95c[_0xff2f09(0x150)]&&_0x511657['sendToPythonWrapper']&&_0x511657['sendToPythonWrapper'](_0xff2f09(0x11c),{'room':_0x64c95c[_0xff2f09(0x150)]}),_0x1bb781;}module[a5_0x460a9f(0x12b)]={'processSensorEvent':processSensorEvent,'getOutsideTemperatureNumeric':getOutsideTemperatureNumeric,'setPresence':setPresence,'abortExitTimer':abortExitTimer,'startExitTimer':startExitTimer};