function a5_0x83ac(){const _0x345c6b=['shift','switch','lampe','location','search','weatherInstance','parse','isProVersion','fenster','tür','now','handle','eventHistory','4662512HMRbIK','[RECORDER]\x20Error:\x20','\x20from\x20','6OxmwMW','lastTrackerEventTime','exitTimer','TRACK_EVENT','3223089eqRheq','3596877JUjqVU','.forecast.current.temp','events.history','val','exports','2687505JtNazC','logDuplicates','(((.+)+)+)+$','.NextHours.Location_1.Day_1.current.temp_value','sendToPythonWrapper','dimmer','toString','STATUS','presence','getStateAsync','error','length','griff','.1.VALVE_STATE','message','schalter','LTM.rawEventLog','includes','apply','number','value','round','schloss','window','replace','type','.1.LEVEL','pop','from','.4.VALVE_STATE','sensorLastValues','3821601imddCp','isGracePeriodActive','60cfgDkr','Unknown','toLowerCase','.1.ACTUAL_TEMPERATURE','useWeather','lock','log','1QGcePh','isPresent','STATE','.Current.Temperature','licht','LTM.trainingData.sequences','2250386tocCrn','valveMapping','temperatur','Temperature','rawEventLog','getForeignStateAsync','LTM.trainingData.thermodynamics','präsenz','contact','constructor','light','[RECORDER]\x20Ignored\x20implausible\x20temperature:\x20','occupancy','motion','heizung','6773240ILXRGM','stringify','bewegung','exitGraceTimer','loc','thermostat','events.lastEvent','.1.TEMPERATURE','setStateAsync','.LEVEL','some','config','getHours','outdoorSensorId','SIMULATE_SIGNAL','Valve','LEVEL','push'];a5_0x83ac=function(){return _0x345c6b;};return a5_0x83ac();}const a5_0x4a8a38=a5_0x362b;(function(_0x60f528,_0x2a7a32){const _0x8dd76=a5_0x362b,_0x1ee915=_0x60f528();while(!![]){try{const _0x95a0c4=parseInt(_0x8dd76(0x8f))/0x1*(parseInt(_0x8dd76(0x95))/0x2)+parseInt(_0x8dd76(0xca))/0x3+parseInt(_0x8dd76(0xc3))/0x4+-parseInt(_0x8dd76(0xd0))/0x5*(parseInt(_0x8dd76(0xc6))/0x6)+-parseInt(_0x8dd76(0xef))/0x7+parseInt(_0x8dd76(0xa4))/0x8+parseInt(_0x8dd76(0xcb))/0x9*(-parseInt(_0x8dd76(0xf1))/0xa);if(_0x95a0c4===_0x2a7a32)break;else _0x1ee915['push'](_0x1ee915['shift']());}catch(_0x18a728){_0x1ee915['push'](_0x1ee915['shift']());}}}(a5_0x83ac,0xb256d));const a5_0x4a54c7=(function(){let _0x10fad2=!![];return function(_0xbdc043,_0x520708){const _0x2ec077=_0x10fad2?function(){const _0x4d46b8=a5_0x362b;if(_0x520708){const _0x1e3f33=_0x520708[_0x4d46b8(0xe2)](_0xbdc043,arguments);return _0x520708=null,_0x1e3f33;}}:function(){};return _0x10fad2=![],_0x2ec077;};}()),a5_0x3856b6=a5_0x4a54c7(this,function(){const _0x1ddde8=a5_0x362b;return a5_0x3856b6[_0x1ddde8(0xd6)]()[_0x1ddde8(0xba)]('(((.+)+)+)+$')[_0x1ddde8(0xd6)]()[_0x1ddde8(0x9e)](a5_0x3856b6)[_0x1ddde8(0xba)](_0x1ddde8(0xd2));});a5_0x3856b6();'use strict';function a5_0x362b(_0x42b3ea,_0x5c0942){const _0x54caf7=a5_0x83ac();return a5_0x362b=function(_0x3856b6,_0x4a54c7){_0x3856b6=_0x3856b6-0x89;let _0x83ac73=_0x54caf7[_0x3856b6];return _0x83ac73;},a5_0x362b(_0x42b3ea,_0x5c0942);}const HISTORY_MAX_SIZE=0x32,RAW_LOG_MAX_SIZE=0x9c4,THERMO_LOG_SIZE=0x3e8,SEQUENCE_TIMEOUT_MS=0x5*0x3c*0x3e8,MAX_TRAINING_SET_SIZE=0x1f4,EXIT_TIMER_MINUTES=0xf,EXIT_GRACE_PERIOD_SECONDS=0x1e;let activeSequence=[],sequenceTimer=null;async function getOutsideTemperatureNumeric(_0x170c7e){const _0x39b23d=a5_0x362b;if(_0x170c7e[_0x39b23d(0xaf)][_0x39b23d(0xb1)])try{const _0x4597fe=await _0x170c7e[_0x39b23d(0x9a)](_0x170c7e[_0x39b23d(0xaf)][_0x39b23d(0xb1)]);if(_0x4597fe&&_0x4597fe['val']!==undefined&&_0x4597fe[_0x39b23d(0xce)]!==null)return parseFloat(_0x4597fe[_0x39b23d(0xce)]);}catch(_0x383578){}const _0x2dcfe8=_0x170c7e[_0x39b23d(0xaf)][_0x39b23d(0xbb)];if(!_0x170c7e['config'][_0x39b23d(0x8c)]||!_0x2dcfe8)return null;try{let _0x2c4b83='';if(_0x2dcfe8[_0x39b23d(0xe1)]('accuweather'))_0x2c4b83=_0x2dcfe8+_0x39b23d(0x92);else{if(_0x2dcfe8[_0x39b23d(0xe1)]('daswetter'))_0x2c4b83=_0x2dcfe8+_0x39b23d(0xd3);else{if(_0x2dcfe8[_0x39b23d(0xe1)]('openweathermap'))_0x2c4b83=_0x2dcfe8+'.forecast.current.temperature';else{if(_0x2dcfe8[_0x39b23d(0xe1)]('weatherunderground'))_0x2c4b83=_0x2dcfe8+_0x39b23d(0xcc);}}}if(_0x2c4b83){const _0x197c03=await _0x170c7e[_0x39b23d(0x9a)](_0x2c4b83);if(_0x197c03&&_0x197c03['val']!==undefined&&_0x197c03[_0x39b23d(0xce)]!==null)return parseFloat(_0x197c03[_0x39b23d(0xce)]);}}catch(_0x1b6324){}return null;}async function recordThermodynamics(_0x2b103c,_0x5a8da2,_0x2961af,_0x330871){const _0x4baded=a5_0x362b,_0x5b0805=await getOutsideTemperatureNumeric(_0x2b103c);if(_0x5b0805===null)return;let _0xab46ed=0x0,_0xc25273=![];if(_0x2b103c[_0x4baded(0xaf)][_0x4baded(0x96)])try{let _0x3d8fdf=_0x2b103c[_0x4baded(0xaf)][_0x4baded(0x96)];if(typeof _0x3d8fdf==='string')_0x3d8fdf=JSON[_0x4baded(0xbc)](_0x3d8fdf);if(_0x3d8fdf[_0x5a8da2]){const _0x43859b=_0x3d8fdf[_0x5a8da2],_0x2608fb=await _0x2b103c[_0x4baded(0x9a)](_0x43859b);if(_0x2608fb&&_0x2608fb[_0x4baded(0xce)]!==null&&_0x2608fb[_0x4baded(0xce)]!==undefined){let _0x1a83f1=Number(_0x2608fb[_0x4baded(0xce)]);if(_0x1a83f1<=1.05&&!_0x43859b[_0x4baded(0xe1)](_0x4baded(0xd7))&&!_0x43859b[_0x4baded(0xe1)](_0x4baded(0x91)))_0x1a83f1=_0x1a83f1*0x64;_0xab46ed=Math[_0x4baded(0xe5)](_0x1a83f1),_0xc25273=!![];}}}catch(_0x164310){}if(!_0xc25273){const _0x11786e=[{'from':_0x4baded(0x8b),'to':_0x4baded(0xea)},{'from':_0x4baded(0x8b),'to':_0x4baded(0xdd)},{'from':_0x4baded(0xab),'to':_0x4baded(0xed)},{'from':'.ACTUAL_TEMPERATURE','to':_0x4baded(0xad)},{'from':'temperature','to':'level'},{'from':_0x4baded(0x98),'to':_0x4baded(0xb3)}];for(const _0x3540cd of _0x11786e){if(_0x5a8da2[_0x4baded(0xe1)](_0x3540cd['from'])){const _0x38db4d=_0x5a8da2[_0x4baded(0xe8)](_0x3540cd[_0x4baded(0xec)],_0x3540cd['to']);try{const _0x959838=await _0x2b103c['getForeignStateAsync'](_0x38db4d);if(_0x959838&&_0x959838[_0x4baded(0xce)]!==null&&_0x959838[_0x4baded(0xce)]!==undefined){let _0x5cd98f=Number(_0x959838['val']);if(typeof _0x5cd98f===_0x4baded(0xe3)){if(_0x5cd98f<=1.05&&_0x3540cd['to'][_0x4baded(0xe1)](_0x4baded(0xb4)))_0x5cd98f=_0x5cd98f*0x64;_0xab46ed=Math[_0x4baded(0xe5)](_0x5cd98f),_0xc25273=!![];break;}}}catch(_0x187c27){}}}}const _0x1abc37=await _0x2b103c[_0x4baded(0xd9)]('LTM.trainingData.thermodynamics');let _0x3933ea=[];if(_0x1abc37&&_0x1abc37[_0x4baded(0xce)])try{_0x3933ea=JSON[_0x4baded(0xbc)](_0x1abc37['val']);}catch(_0x20fc74){}_0x3933ea[_0x4baded(0xb5)]({'ts':Date['now'](),'room':_0x330871||_0x4baded(0x89),'t_in':_0x2961af,'t_out':_0x5b0805,'valve':_0xab46ed});if(_0x3933ea[_0x4baded(0xdb)]>THERMO_LOG_SIZE)_0x3933ea['shift']();await _0x2b103c[_0x4baded(0xac)](_0x4baded(0x9b),{'val':JSON[_0x4baded(0xa5)](_0x3933ea),'ack':!![]});}async function saveCompletedSequence(_0x35473a){const _0x31de51=a5_0x362b;try{const _0x450773=await _0x35473a['getStateAsync'](_0x31de51(0x94));let _0x40e564=[];if(_0x450773&&_0x450773['val'])try{_0x40e564=JSON[_0x31de51(0xbc)](_0x450773[_0x31de51(0xce)]);}catch(_0x2bb100){}const _0x298840=activeSequence[0x0]['ts'],_0x15bca2=activeSequence['map'](_0x236d00=>({'loc':_0x236d00[_0x31de51(0xa8)],'t_delta':Math['round']((_0x236d00['ts']-_0x298840)/0x3e8)})),_0x462fdd={'timestamp':new Date(_0x298840)['toISOString'](),'steps':_0x15bca2,'duration':Math[_0x31de51(0xe5)]((activeSequence[activeSequence[_0x31de51(0xdb)]-0x1]['ts']-_0x298840)/0x3e8),'daytime':new Date(_0x298840)[_0x31de51(0xb0)]()};_0x40e564[_0x31de51(0xb5)](_0x462fdd);if(_0x40e564[_0x31de51(0xdb)]>MAX_TRAINING_SET_SIZE)_0x40e564[_0x31de51(0xb6)]();await _0x35473a['setStateAsync'](_0x31de51(0x94),{'val':JSON[_0x31de51(0xa5)](_0x40e564),'ack':!![]}),_0x35473a['isProVersion']&&_0x35473a[_0x31de51(0xd4)]&&_0x35473a['sendToPythonWrapper']('ANALYZE_SEQUENCE',{'sequence':_0x462fdd});}catch(_0x33f5ce){_0x35473a[_0x31de51(0x8e)][_0x31de51(0xda)](_0x31de51(0xc4)+_0x33f5ce[_0x31de51(0xde)]);}}async function recordSequence(_0xd70014,_0x1c82f4){const _0x46cf8f=a5_0x362b,_0x59fbc0=(_0x1c82f4['type']||'')[_0x46cf8f(0x8a)](),_0x4485ff=['motion',_0x46cf8f(0xa6),'präsenz',_0x46cf8f(0xd8),_0x46cf8f(0xa1),'door',_0x46cf8f(0xbf),'window',_0x46cf8f(0xbe),_0x46cf8f(0x9d),'kontakt',_0x46cf8f(0x9f),_0x46cf8f(0x93),_0x46cf8f(0xb7),_0x46cf8f(0xdf),_0x46cf8f(0xd5),_0x46cf8f(0xb8)];if(!_0x4485ff[_0x46cf8f(0xae)](_0x4f9501=>_0x59fbc0[_0x46cf8f(0xe1)](_0x4f9501)))return;if(!_0x1c82f4[_0x46cf8f(0xe4)])return;if(sequenceTimer)clearTimeout(sequenceTimer);activeSequence[_0x46cf8f(0xb5)]({'loc':_0x1c82f4[_0x46cf8f(0xb9)]||_0x46cf8f(0x89),'id':_0x1c82f4['id'],'ts':Date[_0x46cf8f(0xc0)]()}),sequenceTimer=setTimeout(async()=>{const _0x1ced41=_0x46cf8f;if(activeSequence[_0x1ced41(0xdb)]>0x1)await saveCompletedSequence(_0xd70014);activeSequence=[];},SEQUENCE_TIMEOUT_MS);}function startExitTimer(_0x28cff7){const _0x297e8e=a5_0x362b;abortExitTimer(_0x28cff7),_0x28cff7[_0x297e8e(0xf0)]=!![],_0x28cff7[_0x297e8e(0xa7)]=setTimeout(()=>{const _0x4e1b7e=_0x297e8e;_0x28cff7[_0x4e1b7e(0xf0)]=![];},EXIT_GRACE_PERIOD_SECONDS*0x3e8),_0x28cff7['exitTimer']=setTimeout(()=>{const _0x47e5c3=_0x297e8e;setPresence(_0x28cff7,![]),_0x28cff7[_0x47e5c3(0xc8)]=null;},EXIT_TIMER_MINUTES*0x3c*0x3e8);}function abortExitTimer(_0x308abf){const _0x2227b2=a5_0x362b;if(_0x308abf['exitTimer'])clearTimeout(_0x308abf['exitTimer']);if(_0x308abf[_0x2227b2(0xa7)])clearTimeout(_0x308abf[_0x2227b2(0xa7)]);_0x308abf['exitTimer']=null,_0x308abf[_0x2227b2(0xa7)]=null,_0x308abf[_0x2227b2(0xf0)]=![];}async function setPresence(_0x14df7a,_0x2ce627){const _0x41d0bf=a5_0x362b;if(_0x14df7a[_0x41d0bf(0x90)]===_0x2ce627)return;_0x14df7a[_0x41d0bf(0x90)]=_0x2ce627,await _0x14df7a[_0x41d0bf(0xac)]('system.isPresent',{'val':_0x2ce627,'ack':!![]});}async function processSensorEvent(_0x4fcac7,_0x4602d5,_0xf8d9c5,_0x50028b){const _0x20af80=a5_0x362b;if(!_0x50028b)return null;const _0x4e82c2=_0xf8d9c5['val'],_0x20f6b6=Date[_0x20af80(0xc0)](),_0x4f5f58=_0x4fcac7[_0x20af80(0xee)][_0x4602d5],_0x4152d8=(_0x50028b[_0x20af80(0xe9)]||'')[_0x20af80(0x8a)](),_0x5e2cd5=_0x4152d8[_0x20af80(0xe1)]('temperature')||_0x4152d8[_0x20af80(0xe1)](_0x20af80(0x97))||_0x4152d8[_0x20af80(0xe1)]('klima')||_0x4152d8[_0x20af80(0xe1)](_0x20af80(0xa3))||_0x4152d8[_0x20af80(0xe1)](_0x20af80(0xa9));if(_0x5e2cd5&&typeof _0x4e82c2===_0x20af80(0xe3)){if(_0x4e82c2>0x50||_0x4e82c2<-0x32)return _0x4fcac7[_0x20af80(0x8e)]['debug'](_0x20af80(0xa0)+_0x4e82c2+_0x20af80(0xc5)+_0x4602d5),null;}_0x4fcac7[_0x20af80(0xee)][_0x4602d5]=_0x4e82c2;if(!_0x50028b[_0x20af80(0xd1)]&&_0x4f5f58!=undefined&&_0x4f5f58==_0x4e82c2)return null;_0x4fcac7[_0x20af80(0xbd)]&&_0x5e2cd5&&recordThermodynamics(_0x4fcac7,_0x4602d5,_0x4e82c2,_0x50028b[_0x20af80(0xb9)]);const _0xb9429b={'timestamp':_0x20f6b6,'id':_0x4602d5,'name':_0x50028b['name'],'type':_0x50028b['type'],'location':_0x50028b[_0x20af80(0xb9)],'value':_0x4e82c2};_0x4fcac7[_0x20af80(0xc2)]['unshift'](_0xb9429b);if(_0x4fcac7['eventHistory']['length']>HISTORY_MAX_SIZE)_0x4fcac7['eventHistory'][_0x20af80(0xeb)]();await _0x4fcac7[_0x20af80(0xac)](_0x20af80(0xaa),{'val':JSON[_0x20af80(0xa5)](_0xb9429b),'ack':!![]}),await _0x4fcac7['setStateAsync'](_0x20af80(0xcd),{'val':JSON['stringify'](_0x4fcac7[_0x20af80(0xc2)]),'ack':!![]});if(_0x4fcac7['isProVersion']){_0x4fcac7[_0x20af80(0x99)][_0x20af80(0xb5)](_0xb9429b);if(_0x4fcac7[_0x20af80(0x99)][_0x20af80(0xdb)]>RAW_LOG_MAX_SIZE)_0x4fcac7[_0x20af80(0x99)]['splice'](0x0,_0x4fcac7['rawEventLog'][_0x20af80(0xdb)]-RAW_LOG_MAX_SIZE);await _0x4fcac7[_0x20af80(0xac)](_0x20af80(0xe0),{'val':JSON[_0x20af80(0xa5)](_0x4fcac7[_0x20af80(0x99)]),'ack':!![]}),recordSequence(_0x4fcac7,_0xb9429b);}if(_0x50028b['isExit']&&_0x4e82c2===!![]){if(_0x4fcac7[_0x20af80(0x90)]&&!_0x4fcac7[_0x20af80(0xf0)])startExitTimer(_0x4fcac7);else{if(!_0x4fcac7[_0x20af80(0x90)])setPresence(_0x4fcac7,!![]);}}else{if(_0x50028b['type']===_0x20af80(0xa2)&&_0x4e82c2===!![]){if(_0x4fcac7[_0x20af80(0xc8)])abortExitTimer(_0x4fcac7);if(!_0x4fcac7[_0x20af80(0x90)]&&_0x4fcac7['currentSystemMode']==='normal')setPresence(_0x4fcac7,!![]);}}if(_0x4fcac7[_0x20af80(0xbd)]&&_0x4fcac7[_0x20af80(0xd4)]){_0x50028b[_0x20af80(0xe9)]===_0x20af80(0xa2)&&_0x4e82c2===!![]&&_0x50028b['location']&&_0x4fcac7[_0x20af80(0xd4)](_0x20af80(0xb2),{'room':_0x50028b['location']});const _0x519bde=['door',_0x20af80(0xbf),_0x20af80(0xe7),'fenster',_0x20af80(0xdc),_0x20af80(0xc1),_0x20af80(0x8d),_0x20af80(0xe6)]['some'](_0x4fd7fc=>_0x4152d8[_0x20af80(0xe1)](_0x4fd7fc)),_0x527ceb=[_0x20af80(0x9f),'licht',_0x20af80(0xb7),_0x20af80(0xdf),_0x20af80(0xd5),'lampe']['some'](_0x4889dc=>_0x4152d8['includes'](_0x4889dc)),_0x103522=[_0x20af80(0xa2),'bewegung',_0x20af80(0x9c),_0x20af80(0xd8),_0x20af80(0xa1)][_0x20af80(0xae)](_0x2c6ba5=>_0x4152d8[_0x20af80(0xe1)](_0x2c6ba5));if(_0x50028b[_0x20af80(0xb9)]&&(_0x519bde||_0x527ceb||_0x103522)){const _0x3f07be=_0x4e82c2===!![]||typeof _0x4e82c2===_0x20af80(0xe3)&&_0x4e82c2>0x0,_0x2fb6f3=_0x519bde&&!_0x3f07be&&_0x4f5f58!==undefined&&_0x4f5f58!=_0x4e82c2;if(_0x3f07be||_0x2fb6f3){const _0x200712=_0x4fcac7[_0x20af80(0xc7)]||_0x20f6b6,_0x5c2642=(_0x20f6b6-_0x200712)/0x3e8;_0x4fcac7['lastTrackerEventTime']=_0x20f6b6,_0x4fcac7[_0x20af80(0xd4)](_0x20af80(0xc9),{'room':_0x50028b[_0x20af80(0xb9)],'dt':_0x5c2642});}}}return _0xb9429b;}module[a5_0x4a8a38(0xcf)]={'processSensorEvent':processSensorEvent,'getOutsideTemperatureNumeric':getOutsideTemperatureNumeric,'setPresence':setPresence,'abortExitTimer':abortExitTimer,'startExitTimer':startExitTimer};