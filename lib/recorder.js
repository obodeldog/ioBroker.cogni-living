(function(_0x3f993f,_0x30db78){const _0x272bc8=a5_0x34a1,_0xcd0d35=_0x3f993f();while(!![]){try{const _0x551a76=parseInt(_0x272bc8(0x19c))/0x1*(parseInt(_0x272bc8(0x1cc))/0x2)+-parseInt(_0x272bc8(0x18e))/0x3+-parseInt(_0x272bc8(0x168))/0x4*(parseInt(_0x272bc8(0x1c3))/0x5)+-parseInt(_0x272bc8(0x18f))/0x6+parseInt(_0x272bc8(0x1d6))/0x7*(parseInt(_0x272bc8(0x175))/0x8)+parseInt(_0x272bc8(0x19e))/0x9*(-parseInt(_0x272bc8(0x182))/0xa)+parseInt(_0x272bc8(0x1ac))/0xb;if(_0x551a76===_0x30db78)break;else _0xcd0d35['push'](_0xcd0d35['shift']());}catch(_0x5401d8){_0xcd0d35['push'](_0xcd0d35['shift']());}}}(a5_0xbbc7,0x50524));function a5_0xbbc7(){const _0x3b7ac9=['präsenz','399336RKzoDu','rawEventLog','switch','Unknown','getStateAsync','weatherunderground','setStateAsync','events.lastEvent','sendToPythonWrapper','contact','690956nEANou','length','number','getHours','system.isPresent','648972UApAxZ','.ACTUAL_TEMPERATURE','replace','schalter','[RECORDER]\x20Ignored\x20implausible\x20temperature:\x20','search','useWeather','eventHistory','(((.+)+)+)+$','Valve','from','config','toLowerCase','16AXcvKN','LEVEL','ANALYZE_SEQUENCE','tür','openweathermap','level','exitGraceTimer','TRACK_EVENT','.1.ACTUAL_TEMPERATURE','[RECORDER]\x20Error:\x20','temperatur','motion','presence','16220ezGNNW','fenster','round','sensorLastValues','normal','.LEVEL','door','klima','valveMapping','value','isExit','type','1424169BtrpsS','1330896xopWwq','push','shift','STATUS','Temperature','bewegung','light','weatherInstance','loc','name','isProVersion','stringify','isGracePeriodActive','2eGeavG','dimmer','3348sGucEo','log','SIMULATE_SIGNAL','parse','logDuplicates','location','.forecast.current.temperature','LTM.trainingData.thermodynamics','.1.TEMPERATURE','lampe','outdoorSensorId','lock','heizung','schloss','13138510NzbPzo','griff','now','getForeignStateAsync','handle','unshift','.1.VALVE_STATE','toString','exitTimer','\x20from\x20','temperature','thermostat','isPresent','.4.VALVE_STATE','accuweather','val','includes','licht','constructor','.NextHours.Location_1.Day_1.current.temp_value','error','lastTrackerEventTime','occupancy','5PqCVPc','debug','.1.LEVEL','apply','pop','window','some','.forecast.current.temp'];a5_0xbbc7=function(){return _0x3b7ac9;};return a5_0xbbc7();}const a5_0x35b62c=(function(){let _0x595467=!![];return function(_0x448222,_0x36503f){const _0x3be147=_0x595467?function(){const _0xf5f442=a5_0x34a1;if(_0x36503f){const _0x1a13b0=_0x36503f[_0xf5f442(0x1c6)](_0x448222,arguments);return _0x36503f=null,_0x1a13b0;}}:function(){};return _0x595467=![],_0x3be147;};}()),a5_0x593c85=a5_0x35b62c(this,function(){const _0x55f823=a5_0x34a1;return a5_0x593c85[_0x55f823(0x1b3)]()[_0x55f823(0x16d)](_0x55f823(0x170))[_0x55f823(0x1b3)]()[_0x55f823(0x1be)](a5_0x593c85)[_0x55f823(0x16d)](_0x55f823(0x170));});a5_0x593c85();'use strict';const HISTORY_MAX_SIZE=0x32,RAW_LOG_MAX_SIZE=0x9c4,THERMO_LOG_SIZE=0x3e8,SEQUENCE_TIMEOUT_MS=0x5*0x3c*0x3e8,MAX_TRAINING_SET_SIZE=0x1f4,EXIT_TIMER_MINUTES=0xf,EXIT_GRACE_PERIOD_SECONDS=0x1e;let activeSequence=[],sequenceTimer=null;async function getOutsideTemperatureNumeric(_0x1fd8e5){const _0x15f02b=a5_0x34a1;if(_0x1fd8e5[_0x15f02b(0x173)][_0x15f02b(0x1a8)])try{const _0x3d4d9c=await _0x1fd8e5[_0x15f02b(0x1af)](_0x1fd8e5[_0x15f02b(0x173)][_0x15f02b(0x1a8)]);if(_0x3d4d9c&&_0x3d4d9c[_0x15f02b(0x1bb)]!==undefined&&_0x3d4d9c[_0x15f02b(0x1bb)]!==null)return parseFloat(_0x3d4d9c[_0x15f02b(0x1bb)]);}catch(_0x4d7d34){}const _0x44c8fd=_0x1fd8e5[_0x15f02b(0x173)][_0x15f02b(0x196)];if(!_0x1fd8e5['config'][_0x15f02b(0x16e)]||!_0x44c8fd)return null;try{let _0x4158cd='';if(_0x44c8fd['includes'](_0x15f02b(0x1ba)))_0x4158cd=_0x44c8fd+'.Current.Temperature';else{if(_0x44c8fd[_0x15f02b(0x1bc)]('daswetter'))_0x4158cd=_0x44c8fd+_0x15f02b(0x1bf);else{if(_0x44c8fd['includes'](_0x15f02b(0x179)))_0x4158cd=_0x44c8fd+_0x15f02b(0x1a4);else{if(_0x44c8fd[_0x15f02b(0x1bc)](_0x15f02b(0x1d1)))_0x4158cd=_0x44c8fd+_0x15f02b(0x1ca);}}}if(_0x4158cd){const _0x3a454e=await _0x1fd8e5[_0x15f02b(0x1af)](_0x4158cd);if(_0x3a454e&&_0x3a454e[_0x15f02b(0x1bb)]!==undefined&&_0x3a454e[_0x15f02b(0x1bb)]!==null)return parseFloat(_0x3a454e[_0x15f02b(0x1bb)]);}}catch(_0x571666){}return null;}async function recordThermodynamics(_0xe5d850,_0x26f37f,_0x30e1a8,_0x43ee18){const _0x53189c=a5_0x34a1,_0x57235b=await getOutsideTemperatureNumeric(_0xe5d850);if(_0x57235b===null)return;let _0xc395b9=0x0,_0xc74afd=![];if(_0xe5d850[_0x53189c(0x173)][_0x53189c(0x18a)])try{let _0x2a4668=_0xe5d850['config']['valveMapping'];if(typeof _0x2a4668==='string')_0x2a4668=JSON[_0x53189c(0x1a1)](_0x2a4668);if(_0x2a4668[_0x26f37f]){const _0x3457e8=_0x2a4668[_0x26f37f],_0x132253=await _0xe5d850[_0x53189c(0x1af)](_0x3457e8);if(_0x132253&&_0x132253[_0x53189c(0x1bb)]!==null&&_0x132253[_0x53189c(0x1bb)]!==undefined){let _0x4c31f8=Number(_0x132253[_0x53189c(0x1bb)]);if(_0x4c31f8<=1.05&&!_0x3457e8[_0x53189c(0x1bc)](_0x53189c(0x192))&&!_0x3457e8[_0x53189c(0x1bc)]('STATE'))_0x4c31f8=_0x4c31f8*0x64;_0xc395b9=Math[_0x53189c(0x184)](_0x4c31f8),_0xc74afd=!![];}}}catch(_0x1dd62f){}if(!_0xc74afd){const _0x29d55f=[{'from':_0x53189c(0x17d),'to':_0x53189c(0x1c5)},{'from':_0x53189c(0x17d),'to':_0x53189c(0x1b2)},{'from':_0x53189c(0x1a6),'to':_0x53189c(0x1b9)},{'from':_0x53189c(0x169),'to':_0x53189c(0x187)},{'from':'temperature','to':_0x53189c(0x17a)},{'from':_0x53189c(0x193),'to':_0x53189c(0x171)}];for(const _0x466066 of _0x29d55f){if(_0x26f37f[_0x53189c(0x1bc)](_0x466066[_0x53189c(0x172)])){const _0x58987a=_0x26f37f[_0x53189c(0x16a)](_0x466066[_0x53189c(0x172)],_0x466066['to']);try{const _0x2d1ba7=await _0xe5d850[_0x53189c(0x1af)](_0x58987a);if(_0x2d1ba7&&_0x2d1ba7[_0x53189c(0x1bb)]!==null&&_0x2d1ba7[_0x53189c(0x1bb)]!==undefined){let _0x2d241f=Number(_0x2d1ba7[_0x53189c(0x1bb)]);if(typeof _0x2d241f==='number'){if(_0x2d241f<=1.05&&_0x466066['to'][_0x53189c(0x1bc)](_0x53189c(0x176)))_0x2d241f=_0x2d241f*0x64;_0xc395b9=Math[_0x53189c(0x184)](_0x2d241f),_0xc74afd=!![];break;}}}catch(_0x18314c){}}}}const _0x16c363=await _0xe5d850[_0x53189c(0x1d0)](_0x53189c(0x1a5));let _0x7b57a0=[];if(_0x16c363&&_0x16c363[_0x53189c(0x1bb)])try{_0x7b57a0=JSON[_0x53189c(0x1a1)](_0x16c363[_0x53189c(0x1bb)]);}catch(_0x3a2c35){}_0x7b57a0[_0x53189c(0x190)]({'ts':Date['now'](),'room':_0x43ee18||_0x53189c(0x1cf),'t_in':_0x30e1a8,'t_out':_0x57235b,'valve':_0xc395b9});if(_0x7b57a0['length']>THERMO_LOG_SIZE)_0x7b57a0[_0x53189c(0x191)]();await _0xe5d850['setStateAsync'](_0x53189c(0x1a5),{'val':JSON['stringify'](_0x7b57a0),'ack':!![]});}async function saveCompletedSequence(_0x5afc81){const _0x3ea22b=a5_0x34a1;try{const _0x5af6fc=await _0x5afc81[_0x3ea22b(0x1d0)]('LTM.trainingData.sequences');let _0x4f0987=[];if(_0x5af6fc&&_0x5af6fc[_0x3ea22b(0x1bb)])try{_0x4f0987=JSON[_0x3ea22b(0x1a1)](_0x5af6fc[_0x3ea22b(0x1bb)]);}catch(_0x1c4cd3){}const _0x4664f1=activeSequence[0x0]['ts'],_0x2d6e78=activeSequence['map'](_0x24c1d3=>({'loc':_0x24c1d3[_0x3ea22b(0x197)],'t_delta':Math[_0x3ea22b(0x184)]((_0x24c1d3['ts']-_0x4664f1)/0x3e8)})),_0x3db236={'timestamp':new Date(_0x4664f1)['toISOString'](),'steps':_0x2d6e78,'duration':Math[_0x3ea22b(0x184)]((activeSequence[activeSequence[_0x3ea22b(0x1d7)]-0x1]['ts']-_0x4664f1)/0x3e8),'daytime':new Date(_0x4664f1)[_0x3ea22b(0x166)]()};_0x4f0987[_0x3ea22b(0x190)](_0x3db236);if(_0x4f0987[_0x3ea22b(0x1d7)]>MAX_TRAINING_SET_SIZE)_0x4f0987['shift']();await _0x5afc81[_0x3ea22b(0x1d2)]('LTM.trainingData.sequences',{'val':JSON[_0x3ea22b(0x19a)](_0x4f0987),'ack':!![]}),_0x5afc81['isProVersion']&&_0x5afc81['sendToPythonWrapper']&&_0x5afc81[_0x3ea22b(0x1d4)](_0x3ea22b(0x177),{'sequence':_0x3db236});}catch(_0x1f2dcd){_0x5afc81['log'][_0x3ea22b(0x1c0)](_0x3ea22b(0x17e)+_0x1f2dcd['message']);}}function a5_0x34a1(_0x23cc10,_0x4f9c34){const _0x916046=a5_0xbbc7();return a5_0x34a1=function(_0x593c85,_0x35b62c){_0x593c85=_0x593c85-0x166;let _0xbbc73d=_0x916046[_0x593c85];return _0xbbc73d;},a5_0x34a1(_0x23cc10,_0x4f9c34);}async function recordSequence(_0x507b30,_0x530dd7){const _0x53ea67=a5_0x34a1,_0x4ba69c=(_0x530dd7['type']||'')[_0x53ea67(0x174)](),_0x35813d=[_0x53ea67(0x180),_0x53ea67(0x194),_0x53ea67(0x1cb),_0x53ea67(0x181),'occupancy',_0x53ea67(0x188),_0x53ea67(0x178),_0x53ea67(0x1c8),_0x53ea67(0x183),_0x53ea67(0x1d5),'kontakt',_0x53ea67(0x195),_0x53ea67(0x1bd),_0x53ea67(0x1ce),_0x53ea67(0x16b),_0x53ea67(0x19d),_0x53ea67(0x1a7)];if(!_0x35813d[_0x53ea67(0x1c9)](_0x164e30=>_0x4ba69c[_0x53ea67(0x1bc)](_0x164e30)))return;if(!_0x530dd7[_0x53ea67(0x18b)])return;if(sequenceTimer)clearTimeout(sequenceTimer);activeSequence[_0x53ea67(0x190)]({'loc':_0x530dd7[_0x53ea67(0x1a3)]||_0x53ea67(0x1cf),'id':_0x530dd7['id'],'ts':Date[_0x53ea67(0x1ae)]()}),sequenceTimer=setTimeout(async()=>{const _0x54e6cd=_0x53ea67;if(activeSequence[_0x54e6cd(0x1d7)]>0x1)await saveCompletedSequence(_0x507b30);activeSequence=[];},SEQUENCE_TIMEOUT_MS);}function startExitTimer(_0x49810f){const _0x11e0ab=a5_0x34a1;abortExitTimer(_0x49810f),_0x49810f['isGracePeriodActive']=!![],_0x49810f[_0x11e0ab(0x17b)]=setTimeout(()=>{_0x49810f['isGracePeriodActive']=![];},EXIT_GRACE_PERIOD_SECONDS*0x3e8),_0x49810f[_0x11e0ab(0x1b4)]=setTimeout(()=>{setPresence(_0x49810f,![]),_0x49810f['exitTimer']=null;},EXIT_TIMER_MINUTES*0x3c*0x3e8);}function abortExitTimer(_0x331a09){const _0x48b115=a5_0x34a1;if(_0x331a09['exitTimer'])clearTimeout(_0x331a09[_0x48b115(0x1b4)]);if(_0x331a09['exitGraceTimer'])clearTimeout(_0x331a09[_0x48b115(0x17b)]);_0x331a09['exitTimer']=null,_0x331a09[_0x48b115(0x17b)]=null,_0x331a09[_0x48b115(0x19b)]=![];}async function setPresence(_0x2ed316,_0x412019){const _0x1ade30=a5_0x34a1;if(_0x2ed316[_0x1ade30(0x1b8)]===_0x412019)return;_0x2ed316['isPresent']=_0x412019,await _0x2ed316[_0x1ade30(0x1d2)](_0x1ade30(0x167),{'val':_0x412019,'ack':!![]});}async function processSensorEvent(_0x3a369d,_0x461885,_0x5411ad,_0x4994db){const _0x56cd3d=a5_0x34a1;if(!_0x4994db)return null;const _0x376b6c=_0x5411ad[_0x56cd3d(0x1bb)],_0x2f083a=Date[_0x56cd3d(0x1ae)](),_0x17b355=_0x3a369d[_0x56cd3d(0x185)][_0x461885],_0x3ac9a1=(_0x4994db['type']||'')[_0x56cd3d(0x174)](),_0x168cdf=_0x3ac9a1[_0x56cd3d(0x1bc)](_0x56cd3d(0x1b6))||_0x3ac9a1[_0x56cd3d(0x1bc)](_0x56cd3d(0x17f))||_0x3ac9a1[_0x56cd3d(0x1bc)](_0x56cd3d(0x189))||_0x3ac9a1['includes'](_0x56cd3d(0x1aa))||_0x3ac9a1['includes'](_0x56cd3d(0x1b7));if(_0x168cdf&&typeof _0x376b6c===_0x56cd3d(0x1d8)){if(_0x376b6c>0x50||_0x376b6c<-0x32)return _0x3a369d[_0x56cd3d(0x19f)][_0x56cd3d(0x1c4)](_0x56cd3d(0x16c)+_0x376b6c+_0x56cd3d(0x1b5)+_0x461885),null;}_0x3a369d[_0x56cd3d(0x185)][_0x461885]=_0x376b6c;if(!_0x4994db[_0x56cd3d(0x1a2)]&&_0x17b355!=undefined&&_0x17b355==_0x376b6c)return null;_0x3a369d[_0x56cd3d(0x199)]&&_0x168cdf&&recordThermodynamics(_0x3a369d,_0x461885,_0x376b6c,_0x4994db[_0x56cd3d(0x1a3)]);const _0x717ea5={'timestamp':_0x2f083a,'id':_0x461885,'name':_0x4994db[_0x56cd3d(0x198)],'type':_0x4994db[_0x56cd3d(0x18d)],'location':_0x4994db[_0x56cd3d(0x1a3)],'value':_0x376b6c};_0x3a369d[_0x56cd3d(0x16f)][_0x56cd3d(0x1b1)](_0x717ea5);if(_0x3a369d['eventHistory'][_0x56cd3d(0x1d7)]>HISTORY_MAX_SIZE)_0x3a369d[_0x56cd3d(0x16f)][_0x56cd3d(0x1c7)]();await _0x3a369d[_0x56cd3d(0x1d2)](_0x56cd3d(0x1d3),{'val':JSON[_0x56cd3d(0x19a)](_0x717ea5),'ack':!![]}),await _0x3a369d[_0x56cd3d(0x1d2)]('events.history',{'val':JSON[_0x56cd3d(0x19a)](_0x3a369d[_0x56cd3d(0x16f)]),'ack':!![]});if(_0x3a369d[_0x56cd3d(0x199)]){_0x3a369d[_0x56cd3d(0x1cd)][_0x56cd3d(0x190)](_0x717ea5);if(_0x3a369d[_0x56cd3d(0x1cd)][_0x56cd3d(0x1d7)]>RAW_LOG_MAX_SIZE)_0x3a369d[_0x56cd3d(0x1cd)]['splice'](0x0,_0x3a369d['rawEventLog']['length']-RAW_LOG_MAX_SIZE);await _0x3a369d[_0x56cd3d(0x1d2)]('LTM.rawEventLog',{'val':JSON[_0x56cd3d(0x19a)](_0x3a369d['rawEventLog']),'ack':!![]}),recordSequence(_0x3a369d,_0x717ea5);}if(_0x4994db[_0x56cd3d(0x18c)]&&_0x376b6c===!![]){if(_0x3a369d[_0x56cd3d(0x1b8)]&&!_0x3a369d[_0x56cd3d(0x19b)])startExitTimer(_0x3a369d);else{if(!_0x3a369d[_0x56cd3d(0x1b8)])setPresence(_0x3a369d,!![]);}}else{if(_0x4994db[_0x56cd3d(0x18d)]===_0x56cd3d(0x180)&&_0x376b6c===!![]){if(_0x3a369d[_0x56cd3d(0x1b4)])abortExitTimer(_0x3a369d);if(!_0x3a369d[_0x56cd3d(0x1b8)]&&_0x3a369d['currentSystemMode']===_0x56cd3d(0x186))setPresence(_0x3a369d,!![]);}}if(_0x3a369d[_0x56cd3d(0x199)]&&_0x3a369d[_0x56cd3d(0x1d4)]){_0x4994db[_0x56cd3d(0x18d)]===_0x56cd3d(0x180)&&_0x376b6c===!![]&&_0x4994db[_0x56cd3d(0x1a3)]&&_0x3a369d['sendToPythonWrapper'](_0x56cd3d(0x1a0),{'room':_0x4994db[_0x56cd3d(0x1a3)]});const _0x5954da=[_0x56cd3d(0x188),_0x56cd3d(0x178),_0x56cd3d(0x1c8),_0x56cd3d(0x183),_0x56cd3d(0x1ad),_0x56cd3d(0x1b0),_0x56cd3d(0x1a9),_0x56cd3d(0x1ab)]['some'](_0x520082=>_0x3ac9a1[_0x56cd3d(0x1bc)](_0x520082)),_0x624473=[_0x56cd3d(0x195),_0x56cd3d(0x1bd),'switch',_0x56cd3d(0x16b),_0x56cd3d(0x19d),_0x56cd3d(0x1a7)][_0x56cd3d(0x1c9)](_0x5efff5=>_0x3ac9a1[_0x56cd3d(0x1bc)](_0x5efff5)),_0x4dcc36=[_0x56cd3d(0x180),_0x56cd3d(0x194),_0x56cd3d(0x1cb),'presence',_0x56cd3d(0x1c2)][_0x56cd3d(0x1c9)](_0x44dc87=>_0x3ac9a1[_0x56cd3d(0x1bc)](_0x44dc87));if(_0x4994db[_0x56cd3d(0x1a3)]&&(_0x5954da||_0x624473||_0x4dcc36)){const _0x263360=_0x376b6c===!![]||typeof _0x376b6c===_0x56cd3d(0x1d8)&&_0x376b6c>0x0,_0xc0512e=_0x5954da&&!_0x263360&&_0x17b355!==undefined&&_0x17b355!=_0x376b6c;if(_0x263360||_0xc0512e){const _0x1c348a=_0x3a369d['lastTrackerEventTime']||_0x2f083a,_0x51fddd=(_0x2f083a-_0x1c348a)/0x3e8;_0x3a369d[_0x56cd3d(0x1c1)]=_0x2f083a,_0x3a369d[_0x56cd3d(0x1d4)](_0x56cd3d(0x17c),{'room':_0x4994db[_0x56cd3d(0x1a3)],'dt':_0x51fddd});}}}return _0x717ea5;}module['exports']={'processSensorEvent':processSensorEvent,'getOutsideTemperatureNumeric':getOutsideTemperatureNumeric,'setPresence':setPresence,'abortExitTimer':abortExitTimer,'startExitTimer':startExitTimer};