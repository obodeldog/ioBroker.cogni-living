const a5_0x56df5d=a5_0x5dd8;(function(_0x1a7c90,_0x1bdfe5){const _0x1896f3=a5_0x5dd8,_0x17bf91=_0x1a7c90();while(!![]){try{const _0x9f6fa6=parseInt(_0x1896f3(0x1af))/0x1*(-parseInt(_0x1896f3(0x170))/0x2)+parseInt(_0x1896f3(0x16a))/0x3+parseInt(_0x1896f3(0x1be))/0x4+-parseInt(_0x1896f3(0x1ad))/0x5+parseInt(_0x1896f3(0x18f))/0x6*(parseInt(_0x1896f3(0x186))/0x7)+-parseInt(_0x1896f3(0x184))/0x8*(-parseInt(_0x1896f3(0x1a2))/0x9)+-parseInt(_0x1896f3(0x193))/0xa*(parseInt(_0x1896f3(0x18b))/0xb);if(_0x9f6fa6===_0x1bdfe5)break;else _0x17bf91['push'](_0x17bf91['shift']());}catch(_0x4c42d8){_0x17bf91['push'](_0x17bf91['shift']());}}}(a5_0xda02,0x1cd92));const a5_0x3edffd=(function(){let _0x3a16fd=!![];return function(_0x98f4ae,_0x2e7942){const _0x3079aa=_0x3a16fd?function(){const _0x2ebc13=a5_0x5dd8;if(_0x2e7942){const _0x27c710=_0x2e7942[_0x2ebc13(0x1b0)](_0x98f4ae,arguments);return _0x2e7942=null,_0x27c710;}}:function(){};return _0x3a16fd=![],_0x3079aa;};}()),a5_0x495878=a5_0x3edffd(this,function(){const _0x6d4916=a5_0x5dd8;return a5_0x495878[_0x6d4916(0x198)]()[_0x6d4916(0x179)]('(((.+)+)+)+$')[_0x6d4916(0x198)]()['constructor'](a5_0x495878)[_0x6d4916(0x179)](_0x6d4916(0x197));});function a5_0x5dd8(_0x363df4,_0x3c54e6){const _0x19446f=a5_0xda02();return a5_0x5dd8=function(_0x495878,_0x3edffd){_0x495878=_0x495878-0x15e;let _0xda027e=_0x19446f[_0x495878];return _0xda027e;},a5_0x5dd8(_0x363df4,_0x3c54e6);}a5_0x495878();'use strict';const HISTORY_MAX_SIZE=0x32,RAW_LOG_MAX_SIZE=0x9c4,THERMO_LOG_SIZE=0x3e8,SEQUENCE_TIMEOUT_MS=0x5*0x3c*0x3e8,MAX_TRAINING_SET_SIZE=0x1f4,EXIT_TIMER_MINUTES=0xf,EXIT_GRACE_PERIOD_SECONDS=0x1e;let activeSequence=[],sequenceTimer=null;async function getOutsideTemperatureNumeric(_0x173474){const _0x3fe801=a5_0x5dd8;if(_0x173474[_0x3fe801(0x185)][_0x3fe801(0x1b6)])try{const _0x6b817f=await _0x173474[_0x3fe801(0x18c)](_0x173474[_0x3fe801(0x185)]['outdoorSensorId']);if(_0x6b817f&&_0x6b817f['val']!==undefined&&_0x6b817f['val']!==null)return parseFloat(_0x6b817f[_0x3fe801(0x160)]);}catch(_0x20bcd5){}const _0x478e43=_0x173474[_0x3fe801(0x185)][_0x3fe801(0x1a5)];if(!_0x173474['config'][_0x3fe801(0x175)]||!_0x478e43)return null;try{let _0x15fbd3='';if(_0x478e43['includes'](_0x3fe801(0x1cf)))_0x15fbd3=_0x478e43+_0x3fe801(0x17b);else{if(_0x478e43['includes'](_0x3fe801(0x199)))_0x15fbd3=_0x478e43+_0x3fe801(0x18e);else{if(_0x478e43[_0x3fe801(0x178)](_0x3fe801(0x165)))_0x15fbd3=_0x478e43+'.forecast.current.temperature';else{if(_0x478e43[_0x3fe801(0x178)](_0x3fe801(0x180)))_0x15fbd3=_0x478e43+_0x3fe801(0x191);}}}if(_0x15fbd3){const _0x57b648=await _0x173474[_0x3fe801(0x18c)](_0x15fbd3);if(_0x57b648&&_0x57b648['val']!==undefined&&_0x57b648[_0x3fe801(0x160)]!==null)return parseFloat(_0x57b648[_0x3fe801(0x160)]);}}catch(_0x2906f2){}return null;}async function recordThermodynamics(_0x1dcbb0,_0x536b30,_0xeb8058,_0x442629){const _0x5412c2=a5_0x5dd8,_0x1095fe=await getOutsideTemperatureNumeric(_0x1dcbb0);if(_0x1095fe===null)return;let _0x128eac=0x0,_0x22e21b=![];if(_0x1dcbb0[_0x5412c2(0x185)][_0x5412c2(0x1ac)])try{let _0x578202=_0x1dcbb0[_0x5412c2(0x185)]['valveMapping'];if(typeof _0x578202===_0x5412c2(0x1a4))_0x578202=JSON[_0x5412c2(0x168)](_0x578202);if(_0x578202[_0x536b30]){const _0x356a58=_0x578202[_0x536b30],_0x618061=await _0x1dcbb0[_0x5412c2(0x18c)](_0x356a58);if(_0x618061&&_0x618061[_0x5412c2(0x160)]!==null&&_0x618061['val']!==undefined){let _0x33cb4a=Number(_0x618061['val']);if(_0x33cb4a<=1.05&&!_0x356a58['includes'](_0x5412c2(0x1a3))&&!_0x356a58[_0x5412c2(0x178)](_0x5412c2(0x1a8)))_0x33cb4a=_0x33cb4a*0x64;_0x128eac=Math[_0x5412c2(0x1c3)](_0x33cb4a),_0x22e21b=!![];}}}catch(_0x16b167){}if(!_0x22e21b){const _0x38d858=[{'from':_0x5412c2(0x1a9),'to':'.1.LEVEL'},{'from':'.1.ACTUAL_TEMPERATURE','to':_0x5412c2(0x19b)},{'from':'.1.TEMPERATURE','to':_0x5412c2(0x1a6)},{'from':_0x5412c2(0x188),'to':_0x5412c2(0x162)},{'from':'temperature','to':_0x5412c2(0x1c7)},{'from':_0x5412c2(0x1ba),'to':_0x5412c2(0x173)}];for(const _0x357c95 of _0x38d858){if(_0x536b30[_0x5412c2(0x178)](_0x357c95[_0x5412c2(0x1ce)])){const _0x5a1ea2=_0x536b30['replace'](_0x357c95[_0x5412c2(0x1ce)],_0x357c95['to']);try{const _0x570b40=await _0x1dcbb0[_0x5412c2(0x18c)](_0x5a1ea2);if(_0x570b40&&_0x570b40[_0x5412c2(0x160)]!==null&&_0x570b40[_0x5412c2(0x160)]!==undefined){let _0x584ae0=Number(_0x570b40[_0x5412c2(0x160)]);if(typeof _0x584ae0===_0x5412c2(0x196)){if(_0x584ae0<=1.05&&_0x357c95['to'][_0x5412c2(0x178)](_0x5412c2(0x1b2)))_0x584ae0=_0x584ae0*0x64;_0x128eac=Math[_0x5412c2(0x1c3)](_0x584ae0),_0x22e21b=!![];break;}}}catch(_0x157493){}}}}const _0x4957a5=await _0x1dcbb0[_0x5412c2(0x176)]('LTM.trainingData.thermodynamics');let _0x3aa32a=[];if(_0x4957a5&&_0x4957a5[_0x5412c2(0x160)])try{_0x3aa32a=JSON[_0x5412c2(0x168)](_0x4957a5[_0x5412c2(0x160)]);}catch(_0x5bb9ce){}_0x3aa32a[_0x5412c2(0x19f)]({'ts':Date[_0x5412c2(0x1bf)](),'room':_0x442629||_0x5412c2(0x166),'t_in':_0xeb8058,'t_out':_0x1095fe,'valve':_0x128eac});if(_0x3aa32a[_0x5412c2(0x17c)]>THERMO_LOG_SIZE)_0x3aa32a[_0x5412c2(0x182)]();await _0x1dcbb0[_0x5412c2(0x171)](_0x5412c2(0x1b1),{'val':JSON[_0x5412c2(0x192)](_0x3aa32a),'ack':!![]});}async function saveCompletedSequence(_0x2cd08b){const _0x3070b2=a5_0x5dd8;try{const _0x39e6e4=await _0x2cd08b[_0x3070b2(0x176)](_0x3070b2(0x16b));let _0xa08dc1=[];if(_0x39e6e4&&_0x39e6e4[_0x3070b2(0x160)])try{_0xa08dc1=JSON['parse'](_0x39e6e4[_0x3070b2(0x160)]);}catch(_0x279af8){}const _0x361c4b=activeSequence[0x0]['ts'],_0x2192ad=activeSequence[_0x3070b2(0x17d)](_0x245577=>({'loc':_0x245577[_0x3070b2(0x163)],'t_delta':Math['round']((_0x245577['ts']-_0x361c4b)/0x3e8)})),_0xcf63a7={'timestamp':new Date(_0x361c4b)[_0x3070b2(0x1bc)](),'steps':_0x2192ad,'duration':Math[_0x3070b2(0x1c3)]((activeSequence[activeSequence[_0x3070b2(0x17c)]-0x1]['ts']-_0x361c4b)/0x3e8),'daytime':new Date(_0x361c4b)[_0x3070b2(0x167)]()};_0xa08dc1[_0x3070b2(0x19f)](_0xcf63a7);if(_0xa08dc1[_0x3070b2(0x17c)]>MAX_TRAINING_SET_SIZE)_0xa08dc1[_0x3070b2(0x182)]();await _0x2cd08b['setStateAsync'](_0x3070b2(0x16b),{'val':JSON['stringify'](_0xa08dc1),'ack':!![]}),_0x2cd08b['isProVersion']&&_0x2cd08b[_0x3070b2(0x187)]&&_0x2cd08b[_0x3070b2(0x187)]('ANALYZE_SEQUENCE',{'sequence':_0xcf63a7});}catch(_0x16754a){_0x2cd08b[_0x3070b2(0x1c0)][_0x3070b2(0x190)](_0x3070b2(0x1ca)+_0x16754a[_0x3070b2(0x189)]);}}async function recordSequence(_0x5e0f65,_0x4a4b1c){const _0x343008=a5_0x5dd8,_0x5f0459=(_0x4a4b1c[_0x343008(0x17e)]||'')['toLowerCase'](),_0x54c010=['motion',_0x343008(0x174),_0x343008(0x1bb),'presence',_0x343008(0x15e),_0x343008(0x19c),_0x343008(0x19d),'window',_0x343008(0x1cb),_0x343008(0x16d),_0x343008(0x18a),_0x343008(0x1a0),'licht',_0x343008(0x1c9),_0x343008(0x1cd),_0x343008(0x177),'lampe'];if(!_0x54c010[_0x343008(0x1c1)](_0xa2a353=>_0x5f0459[_0x343008(0x178)](_0xa2a353)))return;if(!_0x4a4b1c[_0x343008(0x169)])return;if(sequenceTimer)clearTimeout(sequenceTimer);activeSequence['push']({'loc':_0x4a4b1c['location']||_0x343008(0x166),'id':_0x4a4b1c['id'],'ts':Date[_0x343008(0x1bf)]()}),sequenceTimer=setTimeout(async()=>{const _0x3a3948=_0x343008;if(activeSequence[_0x3a3948(0x17c)]>0x1)await saveCompletedSequence(_0x5e0f65);activeSequence=[];},SEQUENCE_TIMEOUT_MS);}function startExitTimer(_0x23191b){const _0x213b6e=a5_0x5dd8;abortExitTimer(_0x23191b),_0x23191b[_0x213b6e(0x1bd)]=!![],_0x23191b[_0x213b6e(0x1c5)]=setTimeout(()=>{_0x23191b['isGracePeriodActive']=![];},EXIT_GRACE_PERIOD_SECONDS*0x3e8),_0x23191b['exitTimer']=setTimeout(()=>{setPresence(_0x23191b,![]),_0x23191b['exitTimer']=null;},EXIT_TIMER_MINUTES*0x3c*0x3e8);}function a5_0xda02(){const _0x5e9a28=['round','isPresent','exitGraceTimer','handle','level','rawEventLog','switch','[RECORDER]\x20Error:\x20','fenster','heizung','schalter','from','accuweather','occupancy','klima','val','temperature','.LEVEL','loc','pop','openweathermap','Unknown','getHours','parse','value','346848trTFJu','LTM.trainingData.sequences','sensorLastValues','contact','SIMULATE_SIGNAL','motion','63274OmEHFL','setStateAsync','exports','Valve','bewegung','useWeather','getStateAsync','dimmer','includes','search','\x20from\x20','.Current.Temperature','length','map','type','events.lastEvent','weatherunderground','eventHistory','shift','isExit','331696mxtSpB','config','39907JmTSnD','sendToPythonWrapper','.ACTUAL_TEMPERATURE','message','kontakt','22LioBMf','getForeignStateAsync','temperatur','.NextHours.Location_1.Day_1.current.temp_value','234CIMvmQ','error','.forecast.current.temp','stringify','1628470xSaRHT','currentSystemMode','lampe','number','(((.+)+)+)+$','toString','daswetter','presence','.1.VALVE_STATE','door','tür','location','push','light','isProVersion','45ahylTS','STATUS','string','weatherInstance','.4.VALVE_STATE','lock','STATE','.1.ACTUAL_TEMPERATURE','schloss','LTM.rawEventLog','valveMapping','1101085XQCRHX','[RECORDER]\x20Ignored\x20implausible\x20temperature:\x20','1LfjXJg','apply','LTM.trainingData.thermodynamics','LEVEL','exitTimer','lastTrackerEventTime','debug','outdoorSensorId','system.isPresent','licht','name','Temperature','präsenz','toISOString','isGracePeriodActive','601780rfOKRr','now','log','some','splice'];a5_0xda02=function(){return _0x5e9a28;};return a5_0xda02();}function abortExitTimer(_0x44b9aa){const _0xf66fc9=a5_0x5dd8;if(_0x44b9aa[_0xf66fc9(0x1b3)])clearTimeout(_0x44b9aa[_0xf66fc9(0x1b3)]);if(_0x44b9aa[_0xf66fc9(0x1c5)])clearTimeout(_0x44b9aa['exitGraceTimer']);_0x44b9aa[_0xf66fc9(0x1b3)]=null,_0x44b9aa[_0xf66fc9(0x1c5)]=null,_0x44b9aa['isGracePeriodActive']=![];}async function setPresence(_0x4bb69b,_0x3f6927){const _0x3fcdaa=a5_0x5dd8;if(_0x4bb69b[_0x3fcdaa(0x1c4)]===_0x3f6927)return;_0x4bb69b[_0x3fcdaa(0x1c4)]=_0x3f6927,await _0x4bb69b[_0x3fcdaa(0x171)](_0x3fcdaa(0x1b7),{'val':_0x3f6927,'ack':!![]});}async function processSensorEvent(_0x151946,_0x936a77,_0x22325f,_0x28de4c){const _0x2f18db=a5_0x5dd8;if(!_0x28de4c)return null;const _0x3824e4=_0x22325f[_0x2f18db(0x160)],_0x5e0032=Date['now'](),_0x1d6af6=_0x151946[_0x2f18db(0x16c)][_0x936a77],_0x183d0b=(_0x28de4c[_0x2f18db(0x17e)]||'')['toLowerCase'](),_0x3aafce=_0x183d0b[_0x2f18db(0x178)](_0x2f18db(0x161))||_0x183d0b['includes'](_0x2f18db(0x18d))||_0x183d0b[_0x2f18db(0x178)](_0x2f18db(0x15f))||_0x183d0b['includes'](_0x2f18db(0x1cc))||_0x183d0b[_0x2f18db(0x178)]('thermostat');if(_0x3aafce&&typeof _0x3824e4==='number'){if(_0x3824e4>0x50||_0x3824e4<-0x32)return _0x151946[_0x2f18db(0x1c0)][_0x2f18db(0x1b5)](_0x2f18db(0x1ae)+_0x3824e4+_0x2f18db(0x17a)+_0x936a77),null;}_0x151946[_0x2f18db(0x16c)][_0x936a77]=_0x3824e4;if(!_0x28de4c['logDuplicates']&&_0x1d6af6!=undefined&&_0x1d6af6==_0x3824e4)return null;_0x151946[_0x2f18db(0x1a1)]&&_0x3aafce&&recordThermodynamics(_0x151946,_0x936a77,_0x3824e4,_0x28de4c[_0x2f18db(0x19e)]);const _0x306f61={'timestamp':_0x5e0032,'id':_0x936a77,'name':_0x28de4c[_0x2f18db(0x1b9)],'type':_0x28de4c[_0x2f18db(0x17e)],'location':_0x28de4c[_0x2f18db(0x19e)],'value':_0x3824e4};_0x151946[_0x2f18db(0x181)]['unshift'](_0x306f61);if(_0x151946[_0x2f18db(0x181)][_0x2f18db(0x17c)]>HISTORY_MAX_SIZE)_0x151946[_0x2f18db(0x181)][_0x2f18db(0x164)]();await _0x151946['setStateAsync'](_0x2f18db(0x17f),{'val':JSON[_0x2f18db(0x192)](_0x306f61),'ack':!![]}),await _0x151946[_0x2f18db(0x171)]('events.history',{'val':JSON[_0x2f18db(0x192)](_0x151946[_0x2f18db(0x181)]),'ack':!![]});if(_0x151946[_0x2f18db(0x1a1)]){_0x151946[_0x2f18db(0x1c8)]['push'](_0x306f61);if(_0x151946['rawEventLog'][_0x2f18db(0x17c)]>RAW_LOG_MAX_SIZE)_0x151946[_0x2f18db(0x1c8)][_0x2f18db(0x1c2)](0x0,_0x151946[_0x2f18db(0x1c8)][_0x2f18db(0x17c)]-RAW_LOG_MAX_SIZE);await _0x151946[_0x2f18db(0x171)](_0x2f18db(0x1ab),{'val':JSON[_0x2f18db(0x192)](_0x151946[_0x2f18db(0x1c8)]),'ack':!![]}),recordSequence(_0x151946,_0x306f61);}if(_0x28de4c[_0x2f18db(0x183)]&&_0x3824e4===!![]){if(_0x151946[_0x2f18db(0x1c4)]&&!_0x151946['isGracePeriodActive'])startExitTimer(_0x151946);else{if(!_0x151946[_0x2f18db(0x1c4)])setPresence(_0x151946,!![]);}}else{if(_0x28de4c[_0x2f18db(0x17e)]===_0x2f18db(0x16f)&&_0x3824e4===!![]){if(_0x151946[_0x2f18db(0x1b3)])abortExitTimer(_0x151946);if(!_0x151946[_0x2f18db(0x1c4)]&&_0x151946[_0x2f18db(0x194)]==='normal')setPresence(_0x151946,!![]);}}if(_0x151946[_0x2f18db(0x1a1)]&&_0x151946[_0x2f18db(0x187)]){_0x28de4c['type']===_0x2f18db(0x16f)&&_0x3824e4===!![]&&_0x28de4c[_0x2f18db(0x19e)]&&_0x151946[_0x2f18db(0x187)](_0x2f18db(0x16e),{'room':_0x28de4c[_0x2f18db(0x19e)]});const _0x268962=['door',_0x2f18db(0x19d),'window','fenster','griff',_0x2f18db(0x1c6),_0x2f18db(0x1a7),_0x2f18db(0x1aa)]['some'](_0x2579b1=>_0x183d0b[_0x2f18db(0x178)](_0x2579b1)),_0x5101ff=[_0x2f18db(0x1a0),_0x2f18db(0x1b8),_0x2f18db(0x1c9),_0x2f18db(0x1cd),_0x2f18db(0x177),_0x2f18db(0x195)][_0x2f18db(0x1c1)](_0x4dbea2=>_0x183d0b[_0x2f18db(0x178)](_0x4dbea2)),_0x4f1b1f=[_0x2f18db(0x16f),_0x2f18db(0x174),'präsenz',_0x2f18db(0x19a),_0x2f18db(0x15e)][_0x2f18db(0x1c1)](_0x140df4=>_0x183d0b['includes'](_0x140df4));if(_0x28de4c[_0x2f18db(0x19e)]&&(_0x268962||_0x5101ff||_0x4f1b1f)){const _0x4a6de6=_0x3824e4===!![]||typeof _0x3824e4===_0x2f18db(0x196)&&_0x3824e4>0x0,_0x2e67d9=_0x268962&&!_0x4a6de6&&_0x1d6af6!==undefined&&_0x1d6af6!=_0x3824e4;if(_0x4a6de6||_0x2e67d9){const _0x45201f=_0x151946[_0x2f18db(0x1b4)]||_0x5e0032,_0x4e66d5=(_0x5e0032-_0x45201f)/0x3e8;_0x151946['lastTrackerEventTime']=_0x5e0032,_0x151946[_0x2f18db(0x187)]('TRACK_EVENT',{'room':_0x28de4c[_0x2f18db(0x19e)],'dt':_0x4e66d5});}}}return _0x306f61;}module[a5_0x56df5d(0x172)]={'processSensorEvent':processSensorEvent,'getOutsideTemperatureNumeric':getOutsideTemperatureNumeric,'setPresence':setPresence,'abortExitTimer':abortExitTimer,'startExitTimer':startExitTimer};