function a5_0x16da(){const _0x3bdc91=['LTM.rawEventLog','Unknown','light','[RECORDER]\x20Error:\x20','door','griff','bewegung','klima','weatherunderground','.1.LEVEL','getHours','stringify','exitTimer','.NextHours.Location_1.Day_1.current.temp_value','debug','STATE','parse','TRACK_EVENT','isPresent','pop','val','toLowerCase','map','number','.1.ACTUAL_TEMPERATURE','valveMapping','ANALYZE_SEQUENCE','unshift','SIMULATE_SIGNAL','[RECORDER]\x20Ignored\x20implausible\x20temperature:\x20','apply','lastTrackerEventTime','fenster','schalter','daswetter','kontakt','.forecast.current.temperature','855478cAWEPG','rawEventLog','config','546fTcDfu','normal','sendToPythonWrapper','message','events.history','length','toString','setStateAsync','now','type','location','4PcYnwZ','30bCRMHk','motion','logDuplicates','8000zsxwlj','includes','isProVersion','constructor','Valve','7035260ukYPDm','replace','presence','loc','shift','sensorLastValues','weatherInstance','splice','LTM.trainingData.thermodynamics','contact','LTM.trainingData.sequences','search','name','log','STATUS','8941284vuvInS','toISOString','(((.+)+)+)+$','getStateAsync','51070130wcEgto','exitGraceTimer','\x20from\x20','temperatur','some','7474113kdsefs','level','schloss','occupancy','tür','präsenz','.1.TEMPERATURE','heizung','outdoorSensorId','currentSystemMode','.Current.Temperature','dimmer','.4.VALVE_STATE','string','switch','isGracePeriodActive','102264HaBJJB','eventHistory','from','push','temperature','openweathermap','.1.VALVE_STATE','round','Temperature','getForeignStateAsync','licht'];a5_0x16da=function(){return _0x3bdc91;};return a5_0x16da();}(function(_0x253f1a,_0x226d46){const _0x59fee5=a5_0x11b8,_0x3a1163=_0x253f1a();while(!![]){try{const _0x4aecad=-parseInt(_0x59fee5(0x1b0))/0x1*(parseInt(_0x59fee5(0x211))/0x2)+parseInt(_0x59fee5(0x1b1))/0x3*(-parseInt(_0x59fee5(0x1e1))/0x4)+-parseInt(_0x59fee5(0x1b9))/0x5+-parseInt(_0x59fee5(0x1c8))/0x6+-parseInt(_0x59fee5(0x1a5))/0x7*(parseInt(_0x59fee5(0x1b4))/0x8)+parseInt(_0x59fee5(0x1d1))/0x9+parseInt(_0x59fee5(0x1cc))/0xa;if(_0x4aecad===_0x226d46)break;else _0x3a1163['push'](_0x3a1163['shift']());}catch(_0x35c012){_0x3a1163['push'](_0x3a1163['shift']());}}}(a5_0x16da,0xf3104));const a5_0x4feec5=(function(){let _0x3ebe2b=!![];return function(_0x31dc5b,_0x57bbec){const _0x47be7c=_0x3ebe2b?function(){const _0x265645=a5_0x11b8;if(_0x57bbec){const _0x123086=_0x57bbec[_0x265645(0x20a)](_0x31dc5b,arguments);return _0x57bbec=null,_0x123086;}}:function(){};return _0x3ebe2b=![],_0x47be7c;};}()),a5_0x1a5636=a5_0x4feec5(this,function(){const _0x1a6a6b=a5_0x11b8;return a5_0x1a5636[_0x1a6a6b(0x1ab)]()[_0x1a6a6b(0x1c4)](_0x1a6a6b(0x1ca))[_0x1a6a6b(0x1ab)]()[_0x1a6a6b(0x1b7)](a5_0x1a5636)[_0x1a6a6b(0x1c4)](_0x1a6a6b(0x1ca));});a5_0x1a5636();'use strict';const HISTORY_MAX_SIZE=0x32,RAW_LOG_MAX_SIZE=0x9c4,THERMO_LOG_SIZE=0x3e8,SEQUENCE_TIMEOUT_MS=0x5*0x3c*0x3e8,MAX_TRAINING_SET_SIZE=0x1f4,EXIT_TIMER_MINUTES=0xf,EXIT_GRACE_PERIOD_SECONDS=0x1e;let activeSequence=[],sequenceTimer=null;async function getOutsideTemperatureNumeric(_0x4c05dd){const _0x17e1fd=a5_0x11b8;if(_0x4c05dd['config'][_0x17e1fd(0x1d9)])try{const _0x1204a5=await _0x4c05dd[_0x17e1fd(0x1ea)](_0x4c05dd[_0x17e1fd(0x1a4)][_0x17e1fd(0x1d9)]);if(_0x1204a5&&_0x1204a5[_0x17e1fd(0x200)]!==undefined&&_0x1204a5[_0x17e1fd(0x200)]!==null)return parseFloat(_0x1204a5[_0x17e1fd(0x200)]);}catch(_0x8cecd4){}const _0xba9428=_0x4c05dd[_0x17e1fd(0x1a4)][_0x17e1fd(0x1bf)];if(!_0x4c05dd[_0x17e1fd(0x1a4)]['useWeather']||!_0xba9428)return null;try{let _0x2e63c5='';if(_0xba9428[_0x17e1fd(0x1b5)]('accuweather'))_0x2e63c5=_0xba9428+_0x17e1fd(0x1db);else{if(_0xba9428[_0x17e1fd(0x1b5)](_0x17e1fd(0x20e)))_0x2e63c5=_0xba9428+_0x17e1fd(0x1f9);else{if(_0xba9428[_0x17e1fd(0x1b5)](_0x17e1fd(0x1e6)))_0x2e63c5=_0xba9428+_0x17e1fd(0x210);else{if(_0xba9428[_0x17e1fd(0x1b5)](_0x17e1fd(0x1f4)))_0x2e63c5=_0xba9428+'.forecast.current.temp';}}}if(_0x2e63c5){const _0x41248b=await _0x4c05dd[_0x17e1fd(0x1ea)](_0x2e63c5);if(_0x41248b&&_0x41248b[_0x17e1fd(0x200)]!==undefined&&_0x41248b[_0x17e1fd(0x200)]!==null)return parseFloat(_0x41248b['val']);}}catch(_0x28823b){}return null;}async function recordThermodynamics(_0x2c43a8,_0xeb09e4,_0x59277e,_0x1df225){const _0x8ae40=a5_0x11b8,_0x25c5de=await getOutsideTemperatureNumeric(_0x2c43a8);if(_0x25c5de===null)return;let _0x5b2357=0x0,_0x16a9ef=![];if(_0x2c43a8[_0x8ae40(0x1a4)][_0x8ae40(0x205)])try{let _0x7474ab=_0x2c43a8[_0x8ae40(0x1a4)][_0x8ae40(0x205)];if(typeof _0x7474ab===_0x8ae40(0x1de))_0x7474ab=JSON[_0x8ae40(0x1fc)](_0x7474ab);if(_0x7474ab[_0xeb09e4]){const _0x5223dd=_0x7474ab[_0xeb09e4],_0x21a4d7=await _0x2c43a8['getForeignStateAsync'](_0x5223dd);if(_0x21a4d7&&_0x21a4d7[_0x8ae40(0x200)]!==null&&_0x21a4d7[_0x8ae40(0x200)]!==undefined){let _0x3ceea3=Number(_0x21a4d7[_0x8ae40(0x200)]);if(_0x3ceea3<=1.05&&!_0x5223dd['includes'](_0x8ae40(0x1c7))&&!_0x5223dd[_0x8ae40(0x1b5)](_0x8ae40(0x1fb)))_0x3ceea3=_0x3ceea3*0x64;_0x5b2357=Math[_0x8ae40(0x1e8)](_0x3ceea3),_0x16a9ef=!![];}}}catch(_0x4bf888){}if(!_0x16a9ef){const _0x3ab0ff=[{'from':_0x8ae40(0x204),'to':_0x8ae40(0x1f5)},{'from':_0x8ae40(0x204),'to':_0x8ae40(0x1e7)},{'from':_0x8ae40(0x1d7),'to':_0x8ae40(0x1dd)},{'from':'.ACTUAL_TEMPERATURE','to':'.LEVEL'},{'from':_0x8ae40(0x1e5),'to':_0x8ae40(0x1d2)},{'from':_0x8ae40(0x1e9),'to':_0x8ae40(0x1b8)}];for(const _0x2634f8 of _0x3ab0ff){if(_0xeb09e4[_0x8ae40(0x1b5)](_0x2634f8[_0x8ae40(0x1e3)])){const _0x10a620=_0xeb09e4[_0x8ae40(0x1ba)](_0x2634f8[_0x8ae40(0x1e3)],_0x2634f8['to']);try{const _0x294f2c=await _0x2c43a8[_0x8ae40(0x1ea)](_0x10a620);if(_0x294f2c&&_0x294f2c['val']!==null&&_0x294f2c[_0x8ae40(0x200)]!==undefined){let _0x34d79f=Number(_0x294f2c['val']);if(typeof _0x34d79f===_0x8ae40(0x203)){if(_0x34d79f<=1.05&&_0x2634f8['to']['includes']('LEVEL'))_0x34d79f=_0x34d79f*0x64;_0x5b2357=Math[_0x8ae40(0x1e8)](_0x34d79f),_0x16a9ef=!![];break;}}}catch(_0x4d9210){}}}}const _0x581622=await _0x2c43a8[_0x8ae40(0x1cb)](_0x8ae40(0x1c1));let _0x1288eb=[];if(_0x581622&&_0x581622[_0x8ae40(0x200)])try{_0x1288eb=JSON[_0x8ae40(0x1fc)](_0x581622[_0x8ae40(0x200)]);}catch(_0x45fb67){}_0x1288eb[_0x8ae40(0x1e4)]({'ts':Date[_0x8ae40(0x1ad)](),'room':_0x1df225||_0x8ae40(0x1ed),'t_in':_0x59277e,'t_out':_0x25c5de,'valve':_0x5b2357});if(_0x1288eb[_0x8ae40(0x1aa)]>THERMO_LOG_SIZE)_0x1288eb[_0x8ae40(0x1bd)]();await _0x2c43a8[_0x8ae40(0x1ac)](_0x8ae40(0x1c1),{'val':JSON[_0x8ae40(0x1f7)](_0x1288eb),'ack':!![]});}async function saveCompletedSequence(_0xe6d985){const _0x2da77f=a5_0x11b8;try{const _0x10f89d=await _0xe6d985[_0x2da77f(0x1cb)]('LTM.trainingData.sequences');let _0xc6060=[];if(_0x10f89d&&_0x10f89d[_0x2da77f(0x200)])try{_0xc6060=JSON['parse'](_0x10f89d['val']);}catch(_0x448176){}const _0x29fccf=activeSequence[0x0]['ts'],_0x13dba3=activeSequence[_0x2da77f(0x202)](_0x48c87d=>({'loc':_0x48c87d[_0x2da77f(0x1bc)],'t_delta':Math['round']((_0x48c87d['ts']-_0x29fccf)/0x3e8)})),_0x4cd083={'timestamp':new Date(_0x29fccf)[_0x2da77f(0x1c9)](),'steps':_0x13dba3,'duration':Math[_0x2da77f(0x1e8)]((activeSequence[activeSequence[_0x2da77f(0x1aa)]-0x1]['ts']-_0x29fccf)/0x3e8),'daytime':new Date(_0x29fccf)[_0x2da77f(0x1f6)]()};_0xc6060['push'](_0x4cd083);if(_0xc6060[_0x2da77f(0x1aa)]>MAX_TRAINING_SET_SIZE)_0xc6060['shift']();await _0xe6d985[_0x2da77f(0x1ac)](_0x2da77f(0x1c3),{'val':JSON[_0x2da77f(0x1f7)](_0xc6060),'ack':!![]}),_0xe6d985[_0x2da77f(0x1b6)]&&_0xe6d985[_0x2da77f(0x1a7)]&&_0xe6d985[_0x2da77f(0x1a7)](_0x2da77f(0x206),{'sequence':_0x4cd083});}catch(_0x3e84ee){_0xe6d985['log']['error'](_0x2da77f(0x1ef)+_0x3e84ee[_0x2da77f(0x1a8)]);}}async function recordSequence(_0x1d2f84,_0x3b5225){const _0xa15d33=a5_0x11b8,_0x151010=(_0x3b5225['type']||'')[_0xa15d33(0x201)](),_0xa1b92=['motion',_0xa15d33(0x1f2),_0xa15d33(0x1d6),'presence',_0xa15d33(0x1d4),_0xa15d33(0x1f0),_0xa15d33(0x1d5),'window',_0xa15d33(0x20c),_0xa15d33(0x1c2),_0xa15d33(0x20f),_0xa15d33(0x1ee),_0xa15d33(0x1eb),_0xa15d33(0x1df),_0xa15d33(0x20d),_0xa15d33(0x1dc),'lampe'];if(!_0xa1b92[_0xa15d33(0x1d0)](_0x531c29=>_0x151010[_0xa15d33(0x1b5)](_0x531c29)))return;if(!_0x3b5225['value'])return;if(sequenceTimer)clearTimeout(sequenceTimer);activeSequence['push']({'loc':_0x3b5225[_0xa15d33(0x1af)]||'Unknown','id':_0x3b5225['id'],'ts':Date[_0xa15d33(0x1ad)]()}),sequenceTimer=setTimeout(async()=>{const _0x2d1871=_0xa15d33;if(activeSequence[_0x2d1871(0x1aa)]>0x1)await saveCompletedSequence(_0x1d2f84);activeSequence=[];},SEQUENCE_TIMEOUT_MS);}function startExitTimer(_0x2da355){const _0x273520=a5_0x11b8;abortExitTimer(_0x2da355),_0x2da355[_0x273520(0x1e0)]=!![],_0x2da355[_0x273520(0x1cd)]=setTimeout(()=>{const _0x1c1a30=_0x273520;_0x2da355[_0x1c1a30(0x1e0)]=![];},EXIT_GRACE_PERIOD_SECONDS*0x3e8),_0x2da355[_0x273520(0x1f8)]=setTimeout(()=>{const _0x356d15=_0x273520;setPresence(_0x2da355,![]),_0x2da355[_0x356d15(0x1f8)]=null;},EXIT_TIMER_MINUTES*0x3c*0x3e8);}function abortExitTimer(_0x36199b){const _0x2f1449=a5_0x11b8;if(_0x36199b[_0x2f1449(0x1f8)])clearTimeout(_0x36199b['exitTimer']);if(_0x36199b[_0x2f1449(0x1cd)])clearTimeout(_0x36199b[_0x2f1449(0x1cd)]);_0x36199b[_0x2f1449(0x1f8)]=null,_0x36199b['exitGraceTimer']=null,_0x36199b[_0x2f1449(0x1e0)]=![];}function a5_0x11b8(_0x2f48c2,_0x6e498e){const _0x4b460c=a5_0x16da();return a5_0x11b8=function(_0x1a5636,_0x4feec5){_0x1a5636=_0x1a5636-0x1a3;let _0x16da87=_0x4b460c[_0x1a5636];return _0x16da87;},a5_0x11b8(_0x2f48c2,_0x6e498e);}async function setPresence(_0x4820d1,_0x237563){const _0xebab6a=a5_0x11b8;if(_0x4820d1['isPresent']===_0x237563)return;_0x4820d1[_0xebab6a(0x1fe)]=_0x237563,await _0x4820d1[_0xebab6a(0x1ac)]('system.isPresent',{'val':_0x237563,'ack':!![]});}async function processSensorEvent(_0x2ee876,_0x2bfe81,_0x404e74,_0x8fb32c){const _0x1bde45=a5_0x11b8;if(!_0x8fb32c)return null;const _0xb7e37a=_0x404e74['val'],_0x9cc3d3=Date[_0x1bde45(0x1ad)](),_0x515f99=_0x2ee876[_0x1bde45(0x1be)][_0x2bfe81],_0x4e8f31=(_0x8fb32c[_0x1bde45(0x1ae)]||'')[_0x1bde45(0x201)](),_0x243294=_0x4e8f31[_0x1bde45(0x1b5)](_0x1bde45(0x1e5))||_0x4e8f31[_0x1bde45(0x1b5)](_0x1bde45(0x1cf))||_0x4e8f31[_0x1bde45(0x1b5)](_0x1bde45(0x1f3))||_0x4e8f31[_0x1bde45(0x1b5)](_0x1bde45(0x1d8))||_0x4e8f31['includes']('thermostat');if(_0x243294&&typeof _0xb7e37a==='number'){if(_0xb7e37a>0x50||_0xb7e37a<-0x32)return _0x2ee876[_0x1bde45(0x1c6)][_0x1bde45(0x1fa)](_0x1bde45(0x209)+_0xb7e37a+_0x1bde45(0x1ce)+_0x2bfe81),null;}_0x2ee876[_0x1bde45(0x1be)][_0x2bfe81]=_0xb7e37a;if(!_0x8fb32c[_0x1bde45(0x1b3)]&&_0x515f99!=undefined&&_0x515f99==_0xb7e37a)return null;_0x2ee876[_0x1bde45(0x1b6)]&&_0x243294&&recordThermodynamics(_0x2ee876,_0x2bfe81,_0xb7e37a,_0x8fb32c[_0x1bde45(0x1af)]);const _0x38417f={'timestamp':_0x9cc3d3,'id':_0x2bfe81,'name':_0x8fb32c[_0x1bde45(0x1c5)],'type':_0x8fb32c[_0x1bde45(0x1ae)],'location':_0x8fb32c[_0x1bde45(0x1af)],'value':_0xb7e37a};_0x2ee876[_0x1bde45(0x1e2)][_0x1bde45(0x207)](_0x38417f);if(_0x2ee876[_0x1bde45(0x1e2)][_0x1bde45(0x1aa)]>HISTORY_MAX_SIZE)_0x2ee876[_0x1bde45(0x1e2)][_0x1bde45(0x1ff)]();await _0x2ee876[_0x1bde45(0x1ac)]('events.lastEvent',{'val':JSON[_0x1bde45(0x1f7)](_0x38417f),'ack':!![]}),await _0x2ee876[_0x1bde45(0x1ac)](_0x1bde45(0x1a9),{'val':JSON[_0x1bde45(0x1f7)](_0x2ee876[_0x1bde45(0x1e2)]),'ack':!![]});if(_0x2ee876['isProVersion']){_0x2ee876[_0x1bde45(0x1a3)][_0x1bde45(0x1e4)](_0x38417f);if(_0x2ee876[_0x1bde45(0x1a3)][_0x1bde45(0x1aa)]>RAW_LOG_MAX_SIZE)_0x2ee876[_0x1bde45(0x1a3)][_0x1bde45(0x1c0)](0x0,_0x2ee876[_0x1bde45(0x1a3)][_0x1bde45(0x1aa)]-RAW_LOG_MAX_SIZE);await _0x2ee876[_0x1bde45(0x1ac)](_0x1bde45(0x1ec),{'val':JSON[_0x1bde45(0x1f7)](_0x2ee876[_0x1bde45(0x1a3)]),'ack':!![]}),recordSequence(_0x2ee876,_0x38417f);}if(_0x8fb32c['isExit']&&_0xb7e37a===!![]){if(_0x2ee876[_0x1bde45(0x1fe)]&&!_0x2ee876['isGracePeriodActive'])startExitTimer(_0x2ee876);else{if(!_0x2ee876[_0x1bde45(0x1fe)])setPresence(_0x2ee876,!![]);}}else{if(_0x8fb32c[_0x1bde45(0x1ae)]===_0x1bde45(0x1b2)&&_0xb7e37a===!![]){if(_0x2ee876[_0x1bde45(0x1f8)])abortExitTimer(_0x2ee876);if(!_0x2ee876['isPresent']&&_0x2ee876[_0x1bde45(0x1da)]===_0x1bde45(0x1a6))setPresence(_0x2ee876,!![]);}}if(_0x2ee876[_0x1bde45(0x1b6)]&&_0x2ee876[_0x1bde45(0x1a7)]){_0x8fb32c['type']==='motion'&&_0xb7e37a===!![]&&_0x8fb32c[_0x1bde45(0x1af)]&&_0x2ee876[_0x1bde45(0x1a7)](_0x1bde45(0x208),{'room':_0x8fb32c['location']});const _0x5b80d1=[_0x1bde45(0x1f0),_0x1bde45(0x1d5),'window',_0x1bde45(0x20c),_0x1bde45(0x1f1),'handle','lock',_0x1bde45(0x1d3)][_0x1bde45(0x1d0)](_0x362135=>_0x4e8f31[_0x1bde45(0x1b5)](_0x362135)),_0x14f72a=['light','licht',_0x1bde45(0x1df),_0x1bde45(0x20d),_0x1bde45(0x1dc),'lampe'][_0x1bde45(0x1d0)](_0x447fe0=>_0x4e8f31[_0x1bde45(0x1b5)](_0x447fe0)),_0x205075=['motion',_0x1bde45(0x1f2),_0x1bde45(0x1d6),_0x1bde45(0x1bb),'occupancy'][_0x1bde45(0x1d0)](_0x1412a9=>_0x4e8f31[_0x1bde45(0x1b5)](_0x1412a9));if(_0x8fb32c[_0x1bde45(0x1af)]&&(_0x5b80d1||_0x14f72a||_0x205075)){const _0x52878b=_0xb7e37a===!![]||typeof _0xb7e37a===_0x1bde45(0x203)&&_0xb7e37a>0x0,_0x5ba1d0=_0x5b80d1&&!_0x52878b&&_0x515f99!==undefined&&_0x515f99!=_0xb7e37a;if(_0x52878b||_0x5ba1d0){const _0x2067e8=_0x2ee876[_0x1bde45(0x20b)]||_0x9cc3d3,_0x205f4f=(_0x9cc3d3-_0x2067e8)/0x3e8;_0x2ee876[_0x1bde45(0x20b)]=_0x9cc3d3,_0x2ee876[_0x1bde45(0x1a7)](_0x1bde45(0x1fd),{'room':_0x8fb32c[_0x1bde45(0x1af)],'dt':_0x205f4f});}}}return _0x38417f;}module['exports']={'processSensorEvent':processSensorEvent,'getOutsideTemperatureNumeric':getOutsideTemperatureNumeric,'setPresence':setPresence,'abortExitTimer':abortExitTimer,'startExitTimer':startExitTimer};