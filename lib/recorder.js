const a5_0x2b417c=a5_0x1a88;(function(_0x4cd806,_0x4d0847){const _0x1bd7c9=a5_0x1a88,_0x9e8e4c=_0x4cd806();while(!![]){try{const _0x11b737=parseInt(_0x1bd7c9(0x190))/0x1+-parseInt(_0x1bd7c9(0x165))/0x2+-parseInt(_0x1bd7c9(0x197))/0x3+parseInt(_0x1bd7c9(0x1c2))/0x4*(-parseInt(_0x1bd7c9(0x1a7))/0x5)+-parseInt(_0x1bd7c9(0x1c1))/0x6+-parseInt(_0x1bd7c9(0x1bd))/0x7*(-parseInt(_0x1bd7c9(0x179))/0x8)+-parseInt(_0x1bd7c9(0x1a1))/0x9*(-parseInt(_0x1bd7c9(0x185))/0xa);if(_0x11b737===_0x4d0847)break;else _0x9e8e4c['push'](_0x9e8e4c['shift']());}catch(_0x4d8a69){_0x9e8e4c['push'](_0x9e8e4c['shift']());}}}(a5_0x1644,0xc1e1a));const a5_0x254aca=(function(){let _0x117fd0=!![];return function(_0x5501e0,_0x595023){const _0x903e69=_0x117fd0?function(){const _0x489abf=a5_0x1a88;if(_0x595023){const _0x1ac9fa=_0x595023[_0x489abf(0x18f)](_0x5501e0,arguments);return _0x595023=null,_0x1ac9fa;}}:function(){};return _0x117fd0=![],_0x903e69;};}()),a5_0xaf6c30=a5_0x254aca(this,function(){const _0x41b91e=a5_0x1a88;return a5_0xaf6c30[_0x41b91e(0x1aa)]()[_0x41b91e(0x186)](_0x41b91e(0x193))['toString']()[_0x41b91e(0x1a0)](a5_0xaf6c30)[_0x41b91e(0x186)]('(((.+)+)+)+$');});a5_0xaf6c30();'use strict';const HISTORY_MAX_SIZE=0x32,RAW_LOG_MAX_SIZE=0x9c4,THERMO_LOG_SIZE=0x3e8,SEQUENCE_TIMEOUT_MS=0x5*0x3c*0x3e8,MAX_TRAINING_SET_SIZE=0x1f4,EXIT_TIMER_MINUTES=0xf,EXIT_GRACE_PERIOD_SECONDS=0x1e;let activeSequence=[],sequenceTimer=null;async function getOutsideTemperatureNumeric(_0x5cca32){const _0x132e2c=a5_0x1a88;if(_0x5cca32[_0x132e2c(0x194)][_0x132e2c(0x19c)])try{const _0x26113b=await _0x5cca32[_0x132e2c(0x1cb)](_0x5cca32[_0x132e2c(0x194)][_0x132e2c(0x19c)]);if(_0x26113b&&_0x26113b[_0x132e2c(0x1c9)]!==undefined&&_0x26113b['val']!==null)return parseFloat(_0x26113b[_0x132e2c(0x1c9)]);}catch(_0x189abb){}const _0x2e1c27=_0x5cca32['config']['weatherInstance'];if(!_0x5cca32[_0x132e2c(0x194)][_0x132e2c(0x1bf)]||!_0x2e1c27)return null;try{let _0x5392d2='';if(_0x2e1c27[_0x132e2c(0x16d)](_0x132e2c(0x1b4)))_0x5392d2=_0x2e1c27+_0x132e2c(0x18e);else{if(_0x2e1c27[_0x132e2c(0x16d)](_0x132e2c(0x1ce)))_0x5392d2=_0x2e1c27+_0x132e2c(0x16c);else{if(_0x2e1c27[_0x132e2c(0x16d)](_0x132e2c(0x172)))_0x5392d2=_0x2e1c27+'.forecast.current.temperature';else{if(_0x2e1c27[_0x132e2c(0x16d)](_0x132e2c(0x191)))_0x5392d2=_0x2e1c27+_0x132e2c(0x17f);}}}if(_0x5392d2){const _0x3a1f1c=await _0x5cca32['getForeignStateAsync'](_0x5392d2);if(_0x3a1f1c&&_0x3a1f1c[_0x132e2c(0x1c9)]!==undefined&&_0x3a1f1c[_0x132e2c(0x1c9)]!==null)return parseFloat(_0x3a1f1c[_0x132e2c(0x1c9)]);}}catch(_0x216871){}return null;}async function recordThermodynamics(_0xabaa5f,_0x1f2a3e,_0x2e10d3,_0x4c2adc){const _0x282329=a5_0x1a88,_0x320dfc=await getOutsideTemperatureNumeric(_0xabaa5f);if(_0x320dfc===null)return;let _0x3f3b2d=0x0,_0x4d4d7d=![];if(_0xabaa5f[_0x282329(0x194)][_0x282329(0x16e)])try{let _0x4c7243=_0xabaa5f['config']['valveMapping'];if(typeof _0x4c7243===_0x282329(0x15e))_0x4c7243=JSON[_0x282329(0x15f)](_0x4c7243);if(_0x4c7243[_0x1f2a3e]){const _0x5ae790=_0x4c7243[_0x1f2a3e],_0x534212=await _0xabaa5f['getForeignStateAsync'](_0x5ae790);if(_0x534212&&_0x534212[_0x282329(0x1c9)]!==null&&_0x534212['val']!==undefined){let _0x123090=Number(_0x534212[_0x282329(0x1c9)]);if(_0x123090<=1.05&&!_0x5ae790[_0x282329(0x16d)](_0x282329(0x1ba))&&!_0x5ae790[_0x282329(0x16d)](_0x282329(0x184)))_0x123090=_0x123090*0x64;_0x3f3b2d=Math['round'](_0x123090),_0x4d4d7d=!![];}}}catch(_0x281c55){}if(!_0x4d4d7d){const _0x4cf60f=[{'from':'.1.ACTUAL_TEMPERATURE','to':'.1.LEVEL'},{'from':_0x282329(0x19b),'to':'.1.VALVE_STATE'},{'from':_0x282329(0x1b3),'to':_0x282329(0x1b6)},{'from':_0x282329(0x174),'to':_0x282329(0x1c0)},{'from':_0x282329(0x1be),'to':'level'},{'from':_0x282329(0x16a),'to':_0x282329(0x1a9)}];for(const _0x523ad0 of _0x4cf60f){if(_0x1f2a3e[_0x282329(0x16d)](_0x523ad0[_0x282329(0x16b)])){const _0x3ce6a6=_0x1f2a3e[_0x282329(0x188)](_0x523ad0[_0x282329(0x16b)],_0x523ad0['to']);try{const _0x1393a6=await _0xabaa5f[_0x282329(0x1cb)](_0x3ce6a6);if(_0x1393a6&&_0x1393a6[_0x282329(0x1c9)]!==null&&_0x1393a6['val']!==undefined){let _0x393c64=Number(_0x1393a6[_0x282329(0x1c9)]);if(typeof _0x393c64===_0x282329(0x17e)){if(_0x393c64<=1.05&&_0x523ad0['to'][_0x282329(0x16d)]('LEVEL'))_0x393c64=_0x393c64*0x64;_0x3f3b2d=Math[_0x282329(0x189)](_0x393c64),_0x4d4d7d=!![];break;}}}catch(_0x51f282){}}}}const _0xca97db=await _0xabaa5f[_0x282329(0x16f)](_0x282329(0x187));let _0x485829=[];if(_0xca97db&&_0xca97db['val'])try{_0x485829=JSON['parse'](_0xca97db[_0x282329(0x1c9)]);}catch(_0x135824){}_0x485829[_0x282329(0x1cd)]({'ts':Date['now'](),'room':_0x4c2adc||_0x282329(0x17b),'t_in':_0x2e10d3,'t_out':_0x320dfc,'valve':_0x3f3b2d});if(_0x485829['length']>THERMO_LOG_SIZE)_0x485829['shift']();await _0xabaa5f['setStateAsync']('LTM.trainingData.thermodynamics',{'val':JSON[_0x282329(0x181)](_0x485829),'ack':!![]});}async function saveCompletedSequence(_0x3f3519){const _0x44a2c0=a5_0x1a88;try{const _0x5c0556=await _0x3f3519[_0x44a2c0(0x16f)]('LTM.trainingData.sequences');let _0x37a45f=[];if(_0x5c0556&&_0x5c0556['val'])try{_0x37a45f=JSON[_0x44a2c0(0x15f)](_0x5c0556[_0x44a2c0(0x1c9)]);}catch(_0x8a659c){}const _0xcec3b3=activeSequence[0x0]['ts'],_0xd4a13a=activeSequence[_0x44a2c0(0x198)](_0x45ba86=>({'loc':_0x45ba86[_0x44a2c0(0x161)],'t_delta':Math[_0x44a2c0(0x189)]((_0x45ba86['ts']-_0xcec3b3)/0x3e8)})),_0x30d694={'timestamp':new Date(_0xcec3b3)[_0x44a2c0(0x180)](),'steps':_0xd4a13a,'duration':Math[_0x44a2c0(0x189)]((activeSequence[activeSequence[_0x44a2c0(0x163)]-0x1]['ts']-_0xcec3b3)/0x3e8),'daytime':new Date(_0xcec3b3)['getHours']()};_0x37a45f[_0x44a2c0(0x1cd)](_0x30d694);if(_0x37a45f[_0x44a2c0(0x163)]>MAX_TRAINING_SET_SIZE)_0x37a45f[_0x44a2c0(0x1c7)]();await _0x3f3519[_0x44a2c0(0x1bc)](_0x44a2c0(0x17a),{'val':JSON[_0x44a2c0(0x181)](_0x37a45f),'ack':!![]}),_0x3f3519['isProVersion']&&_0x3f3519['sendToPythonWrapper']&&_0x3f3519[_0x44a2c0(0x1b7)](_0x44a2c0(0x196),{'sequence':_0x30d694});}catch(_0xcc54e2){_0x3f3519[_0x44a2c0(0x1c5)][_0x44a2c0(0x175)](_0x44a2c0(0x1ae)+_0xcc54e2[_0x44a2c0(0x1a8)]);}}function a5_0x1644(){const _0x3682e7=['setStateAsync','35VtIhzq','temperature','useWeather','.LEVEL','9391716sbcYAN','7232QoxWWz','griff','currentSystemMode','log','some','shift','LTM.rawEventLog','val','bewegung','getForeignStateAsync','unshift','push','daswetter','presence','motion','exports','temperatur','string','parse','handle','loc','isExit','length','door','997120QxyAPW','lastTrackerEventTime','window','pop','eventHistory','Temperature','from','.NextHours.Location_1.Day_1.current.temp_value','includes','valveMapping','getStateAsync','splice','toLowerCase','openweathermap','isGracePeriodActive','.ACTUAL_TEMPERATURE','error','fill','lampe','fenster','2141712opXLlB','LTM.trainingData.sequences','Unknown','isPresent','light','number','.forecast.current.temp','toISOString','stringify','analysis.health.todayVector','SIMULATE_SIGNAL','STATE','20hCSMNy','search','LTM.trainingData.thermodynamics','replace','round','schalter','occupancy','getDate','sensorLastValues','.Current.Temperature','apply','1311658oOpITf','weatherunderground','thermostat','(((.+)+)+)+$','config','events.history','ANALYZE_SEQUENCE','2938914SXZQiy','map','lock','getHours','.1.ACTUAL_TEMPERATURE','outdoorSensorId','[RECORDER]\x20Ignored\x20implausible\x20temperature:\x20','exitGraceTimer','exitTimer','constructor','11022201nyHQSk','dimmer','rawEventLog','isProVersion','value','heizung','3490rbdkea','message','Valve','toString','contact','licht','normal','[RECORDER]\x20Error:\x20','location','pr채senz','type','logDuplicates','.1.TEMPERATURE','accuweather','now','.4.VALVE_STATE','sendToPythonWrapper','name','kontakt','STATUS','\x20from\x20'];a5_0x1644=function(){return _0x3682e7;};return a5_0x1644();}async function recordSequence(_0x64b94b,_0x3b71e9){const _0x5a5ca6=a5_0x1a88,_0x29adb6=(_0x3b71e9[_0x5a5ca6(0x1b1)]||'')['toLowerCase'](),_0x371235=[_0x5a5ca6(0x15b),_0x5a5ca6(0x1ca),'pr채senz',_0x5a5ca6(0x15a),'occupancy',_0x5a5ca6(0x164),'t체r',_0x5a5ca6(0x167),_0x5a5ca6(0x178),_0x5a5ca6(0x1ab),_0x5a5ca6(0x1b9),_0x5a5ca6(0x17d),_0x5a5ca6(0x1ac),'switch',_0x5a5ca6(0x18a),_0x5a5ca6(0x1a2),_0x5a5ca6(0x177)];if(!_0x371235['some'](_0x4207aa=>_0x29adb6[_0x5a5ca6(0x16d)](_0x4207aa)))return;if(!_0x3b71e9[_0x5a5ca6(0x1a5)])return;if(sequenceTimer)clearTimeout(sequenceTimer);activeSequence[_0x5a5ca6(0x1cd)]({'loc':_0x3b71e9[_0x5a5ca6(0x1af)]||_0x5a5ca6(0x17b),'id':_0x3b71e9['id'],'ts':Date['now']()}),sequenceTimer=setTimeout(async()=>{const _0x152d1e=_0x5a5ca6;if(activeSequence[_0x152d1e(0x163)]>0x1)await saveCompletedSequence(_0x64b94b);activeSequence=[];},SEQUENCE_TIMEOUT_MS);}function startExitTimer(_0x1b0e5c){const _0x51c60a=a5_0x1a88;abortExitTimer(_0x1b0e5c),_0x1b0e5c['isGracePeriodActive']=!![],_0x1b0e5c['exitGraceTimer']=setTimeout(()=>{const _0x19b9ce=a5_0x1a88;_0x1b0e5c[_0x19b9ce(0x173)]=![];},EXIT_GRACE_PERIOD_SECONDS*0x3e8),_0x1b0e5c[_0x51c60a(0x19f)]=setTimeout(()=>{const _0x258e40=_0x51c60a;setPresence(_0x1b0e5c,![]),_0x1b0e5c[_0x258e40(0x19f)]=null;},EXIT_TIMER_MINUTES*0x3c*0x3e8);}function a5_0x1a88(_0x465ca5,_0x13cbd7){const _0x473957=a5_0x1644();return a5_0x1a88=function(_0xaf6c30,_0x254aca){_0xaf6c30=_0xaf6c30-0x15a;let _0x1644f2=_0x473957[_0xaf6c30];return _0x1644f2;},a5_0x1a88(_0x465ca5,_0x13cbd7);}function abortExitTimer(_0x37df16){const _0x3a83d2=a5_0x1a88;if(_0x37df16[_0x3a83d2(0x19f)])clearTimeout(_0x37df16['exitTimer']);if(_0x37df16[_0x3a83d2(0x19e)])clearTimeout(_0x37df16[_0x3a83d2(0x19e)]);_0x37df16[_0x3a83d2(0x19f)]=null,_0x37df16[_0x3a83d2(0x19e)]=null,_0x37df16[_0x3a83d2(0x173)]=![];}async function setPresence(_0x380b4d,_0x564011){const _0x179cd0=a5_0x1a88;if(_0x380b4d[_0x179cd0(0x17c)]===_0x564011)return;_0x380b4d['isPresent']=_0x564011,await _0x380b4d['setStateAsync']('system.isPresent',{'val':_0x564011,'ack':!![]});}async function updateHourlyActivity(_0x7fef02){const _0x5e43e8=a5_0x1a88;let _0x1dee16=new Array(0x18)[_0x5e43e8(0x176)](0x0),_0xe096a=0x0;try{const _0x45e22e=await _0x7fef02[_0x5e43e8(0x16f)](_0x5e43e8(0x182));_0x45e22e&&_0x45e22e[_0x5e43e8(0x1c9)]&&(_0x1dee16=JSON[_0x5e43e8(0x15f)](_0x45e22e[_0x5e43e8(0x1c9)]),_0xe096a=_0x45e22e['ts']);}catch(_0x1353f7){}const _0x5e6cc4=new Date(_0xe096a),_0x24dfd9=new Date();_0x5e6cc4[_0x5e43e8(0x18c)]()!==_0x24dfd9[_0x5e43e8(0x18c)]()&&(_0x1dee16=new Array(0x18)[_0x5e43e8(0x176)](0x0));const _0x3a4be3=_0x24dfd9[_0x5e43e8(0x19a)]();if(_0x1dee16[_0x3a4be3]===undefined)_0x1dee16[_0x3a4be3]=0x0;_0x1dee16[_0x3a4be3]++,await _0x7fef02['setStateAsync'](_0x5e43e8(0x182),{'val':JSON[_0x5e43e8(0x181)](_0x1dee16),'ack':!![]});}async function processSensorEvent(_0x58450a,_0x1d1cb5,_0x168e37,_0xcbbae){const _0x96bc2=a5_0x1a88;if(!_0xcbbae)return null;const _0x4a4348=_0x168e37[_0x96bc2(0x1c9)],_0xd4fd6=Date[_0x96bc2(0x1b5)](),_0x580158=_0x58450a[_0x96bc2(0x18d)][_0x1d1cb5],_0x472389=(_0xcbbae[_0x96bc2(0x1b1)]||'')[_0x96bc2(0x171)](),_0x593d38=_0x472389[_0x96bc2(0x16d)](_0x96bc2(0x1be))||_0x472389['includes'](_0x96bc2(0x15d))||_0x472389[_0x96bc2(0x16d)]('klima')||_0x472389[_0x96bc2(0x16d)](_0x96bc2(0x1a6))||_0x472389[_0x96bc2(0x16d)](_0x96bc2(0x192));if(_0x593d38&&typeof _0x4a4348===_0x96bc2(0x17e)){if(_0x4a4348>0x50||_0x4a4348<-0x32)return _0x58450a[_0x96bc2(0x1c5)]['debug'](_0x96bc2(0x19d)+_0x4a4348+_0x96bc2(0x1bb)+_0x1d1cb5),null;}_0x58450a['sensorLastValues'][_0x1d1cb5]=_0x4a4348;if(!_0xcbbae[_0x96bc2(0x1b2)]&&_0x580158!=undefined&&_0x580158==_0x4a4348)return null;_0x58450a['isProVersion']&&_0x593d38&&recordThermodynamics(_0x58450a,_0x1d1cb5,_0x4a4348,_0xcbbae[_0x96bc2(0x1af)]);const _0x17dbeb={'timestamp':_0xd4fd6,'id':_0x1d1cb5,'name':_0xcbbae[_0x96bc2(0x1b8)],'type':_0xcbbae[_0x96bc2(0x1b1)],'location':_0xcbbae[_0x96bc2(0x1af)],'value':_0x4a4348};_0x58450a['eventHistory'][_0x96bc2(0x1cc)](_0x17dbeb);if(_0x58450a[_0x96bc2(0x169)][_0x96bc2(0x163)]>HISTORY_MAX_SIZE)_0x58450a[_0x96bc2(0x169)][_0x96bc2(0x168)]();await _0x58450a['setStateAsync']('events.lastEvent',{'val':JSON[_0x96bc2(0x181)](_0x17dbeb),'ack':!![]}),await _0x58450a[_0x96bc2(0x1bc)](_0x96bc2(0x195),{'val':JSON[_0x96bc2(0x181)](_0x58450a[_0x96bc2(0x169)]),'ack':!![]}),await updateHourlyActivity(_0x58450a);if(_0x58450a[_0x96bc2(0x1a4)]){_0x58450a[_0x96bc2(0x1a3)][_0x96bc2(0x1cd)](_0x17dbeb);if(_0x58450a[_0x96bc2(0x1a3)][_0x96bc2(0x163)]>RAW_LOG_MAX_SIZE)_0x58450a['rawEventLog'][_0x96bc2(0x170)](0x0,_0x58450a['rawEventLog'][_0x96bc2(0x163)]-RAW_LOG_MAX_SIZE);await _0x58450a[_0x96bc2(0x1bc)](_0x96bc2(0x1c8),{'val':JSON['stringify'](_0x58450a[_0x96bc2(0x1a3)]),'ack':!![]}),recordSequence(_0x58450a,_0x17dbeb);}if(_0xcbbae[_0x96bc2(0x162)]&&_0x4a4348===!![]){if(_0x58450a[_0x96bc2(0x17c)]&&!_0x58450a['isGracePeriodActive'])startExitTimer(_0x58450a);else{if(!_0x58450a[_0x96bc2(0x17c)])setPresence(_0x58450a,!![]);}}else{if(_0xcbbae[_0x96bc2(0x1b1)]===_0x96bc2(0x15b)&&_0x4a4348===!![]){if(_0x58450a[_0x96bc2(0x19f)])abortExitTimer(_0x58450a);if(!_0x58450a['isPresent']&&_0x58450a[_0x96bc2(0x1c4)]===_0x96bc2(0x1ad))setPresence(_0x58450a,!![]);}}if(_0x58450a[_0x96bc2(0x1a4)]&&_0x58450a['sendToPythonWrapper']){_0xcbbae[_0x96bc2(0x1b1)]===_0x96bc2(0x15b)&&_0x4a4348===!![]&&_0xcbbae[_0x96bc2(0x1af)]&&_0x58450a[_0x96bc2(0x1b7)](_0x96bc2(0x183),{'room':_0xcbbae[_0x96bc2(0x1af)]});const _0xdbf51=[_0x96bc2(0x164),'t체r',_0x96bc2(0x167),_0x96bc2(0x178),_0x96bc2(0x1c3),_0x96bc2(0x160),_0x96bc2(0x199),'schloss'][_0x96bc2(0x1c6)](_0x3934e2=>_0x472389[_0x96bc2(0x16d)](_0x3934e2)),_0x3e86b8=['light',_0x96bc2(0x1ac),'switch',_0x96bc2(0x18a),'dimmer',_0x96bc2(0x177)][_0x96bc2(0x1c6)](_0x4054ec=>_0x472389[_0x96bc2(0x16d)](_0x4054ec)),_0x1d9b93=[_0x96bc2(0x15b),_0x96bc2(0x1ca),_0x96bc2(0x1b0),_0x96bc2(0x15a),_0x96bc2(0x18b)][_0x96bc2(0x1c6)](_0x5a76e8=>_0x472389[_0x96bc2(0x16d)](_0x5a76e8));if(_0xcbbae[_0x96bc2(0x1af)]&&(_0xdbf51||_0x3e86b8||_0x1d9b93)){const _0x545017=_0x4a4348===!![]||typeof _0x4a4348===_0x96bc2(0x17e)&&_0x4a4348>0x0,_0x1db854=_0xdbf51&&!_0x545017&&_0x580158!==undefined&&_0x580158!=_0x4a4348;if(_0x545017||_0x1db854){const _0x1b82bd=_0x58450a[_0x96bc2(0x166)]||_0xd4fd6,_0x4b7fea=(_0xd4fd6-_0x1b82bd)/0x3e8;_0x58450a['lastTrackerEventTime']=_0xd4fd6,_0x58450a[_0x96bc2(0x1b7)]('TRACK_EVENT',{'room':_0xcbbae['location'],'dt':_0x4b7fea});}}}return _0x17dbeb;}module[a5_0x2b417c(0x15c)]={'processSensorEvent':processSensorEvent,'getOutsideTemperatureNumeric':getOutsideTemperatureNumeric,'setPresence':setPresence,'abortExitTimer':abortExitTimer,'startExitTimer':startExitTimer};