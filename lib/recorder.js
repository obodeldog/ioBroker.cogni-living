const a4_0x3eb773=a4_0x5a49;(function(_0x267bbc,_0x52f14c){const _0x2c2f7f=a4_0x5a49,_0x48a1e8=_0x267bbc();while(!![]){try{const _0x240f75=parseInt(_0x2c2f7f(0x10f))/0x1+parseInt(_0x2c2f7f(0xc1))/0x2+-parseInt(_0x2c2f7f(0x100))/0x3+parseInt(_0x2c2f7f(0xeb))/0x4*(parseInt(_0x2c2f7f(0xd6))/0x5)+-parseInt(_0x2c2f7f(0xd7))/0x6*(parseInt(_0x2c2f7f(0xf3))/0x7)+-parseInt(_0x2c2f7f(0x10e))/0x8*(parseInt(_0x2c2f7f(0x10b))/0x9)+parseInt(_0x2c2f7f(0xe7))/0xa*(-parseInt(_0x2c2f7f(0xcb))/0xb);if(_0x240f75===_0x52f14c)break;else _0x48a1e8['push'](_0x48a1e8['shift']());}catch(_0x5307f4){_0x48a1e8['push'](_0x48a1e8['shift']());}}}(a4_0x11f9,0xa251c));const a4_0x2c0bec=(function(){let _0x5e904f=!![];return function(_0x300708,_0x47f53a){const _0x5d6ee7=_0x5e904f?function(){const _0x395e64=a4_0x5a49;if(_0x47f53a){const _0x1ee6c2=_0x47f53a[_0x395e64(0xee)](_0x300708,arguments);return _0x47f53a=null,_0x1ee6c2;}}:function(){};return _0x5e904f=![],_0x5d6ee7;};}()),a4_0x2298b2=a4_0x2c0bec(this,function(){const _0x2b38f9=a4_0x5a49;return a4_0x2298b2['toString']()[_0x2b38f9(0xd8)]('(((.+)+)+)+$')[_0x2b38f9(0xed)]()[_0x2b38f9(0xd0)](a4_0x2298b2)[_0x2b38f9(0xd8)](_0x2b38f9(0x103));});a4_0x2298b2();'use strict';function a4_0x11f9(){const _0x21fea8=['973397UfygbO','normal','config','[RECORDER]\x20Error:\x20','system.isPresent','isPresent','push','loc','getHours','name','isExit','180646ppJrse','toLowerCase','klima','eventHistory','fenster','parse','bewegung','occupancy','Unknown','message','364826rcMSgi','getStateAsync','pop','licht','getForeignStateAsync','constructor','type','temperature','stringify','SIMULATE_SIGNAL','includes','5oZCXIV','438uVvYbB','search','isGracePeriodActive','LTM.trainingData.thermodynamics','length','sensorLastValues','unshift','accuweather','.Current.Temperature','door','lampe','currentSystemMode','events.lastEvent','value','round','window','10QTZGZp','val','toISOString','shift','4984752kYGGgg','weatherunderground','toString','apply','now','rawEventLog','outdoorSensorId','heizung','42091fSyOyJ','dimmer','exitTimer','motion','temperatur','contact','some','LTM.rawEventLog','location','useWeather','ANALYZE_SEQUENCE','light','map','1237746GVHIbf','tür','exports','(((.+)+)+)+$','isProVersion','.NextHours.Location_1.Day_1.current.temp_value','exitGraceTimer','presence','LTM.trainingData.sequences','sendToPythonWrapper','openweathermap','40977AGWVcF','setStateAsync','logDuplicates','1336TTFDod'];a4_0x11f9=function(){return _0x21fea8;};return a4_0x11f9();}const HISTORY_MAX_SIZE=0x32,RAW_LOG_MAX_SIZE=0x9c4,THERMO_LOG_SIZE=0x3e8,SEQUENCE_TIMEOUT_MS=0x5*0x3c*0x3e8,MAX_TRAINING_SET_SIZE=0x1f4,EXIT_TIMER_MINUTES=0xf,EXIT_GRACE_PERIOD_SECONDS=0x1e;let activeSequence=[],sequenceTimer=null;async function getOutsideTemperatureNumeric(_0x1a7858){const _0x1cdd14=a4_0x5a49;if(_0x1a7858[_0x1cdd14(0x111)][_0x1cdd14(0xf1)])try{const _0x21ccf6=await _0x1a7858['getForeignStateAsync'](_0x1a7858[_0x1cdd14(0x111)][_0x1cdd14(0xf1)]);if(_0x21ccf6&&_0x21ccf6[_0x1cdd14(0xe8)]!==undefined&&_0x21ccf6[_0x1cdd14(0xe8)]!==null)return parseFloat(_0x21ccf6['val']);}catch(_0x213be0){}const _0x316d8d=_0x1a7858[_0x1cdd14(0x111)]['weatherInstance'];if(!_0x1a7858['config'][_0x1cdd14(0xfc)]||!_0x316d8d)return null;try{let _0x4327b7='';if(_0x316d8d[_0x1cdd14(0xd5)](_0x1cdd14(0xde)))_0x4327b7=_0x316d8d+_0x1cdd14(0xdf);else{if(_0x316d8d['includes']('daswetter'))_0x4327b7=_0x316d8d+_0x1cdd14(0x105);else{if(_0x316d8d['includes'](_0x1cdd14(0x10a)))_0x4327b7=_0x316d8d+'.forecast.current.temperature';else{if(_0x316d8d['includes'](_0x1cdd14(0xec)))_0x4327b7=_0x316d8d+'.forecast.current.temp';}}}if(_0x4327b7){const _0x170321=await _0x1a7858[_0x1cdd14(0xcf)](_0x4327b7);if(_0x170321&&_0x170321[_0x1cdd14(0xe8)]!==undefined&&_0x170321[_0x1cdd14(0xe8)]!==null)return parseFloat(_0x170321[_0x1cdd14(0xe8)]);}}catch(_0x40f65e){}return null;}async function recordThermodynamics(_0x2d92ee,_0x4cc04f,_0x581b20,_0x26696d){const _0x57d966=a4_0x5a49,_0x549e8e=await getOutsideTemperatureNumeric(_0x2d92ee),_0x14db30=await _0x2d92ee[_0x57d966(0xcc)](_0x57d966(0xda));let _0x286bbf=[];if(_0x14db30&&_0x14db30[_0x57d966(0xe8)])try{_0x286bbf=JSON[_0x57d966(0xc6)](_0x14db30['val']);}catch(_0x37afb0){}_0x286bbf[_0x57d966(0x115)]({'ts':Date['now'](),'room':_0x26696d||_0x57d966(0xc9),'t_in':_0x581b20,'t_out':_0x549e8e});if(_0x286bbf[_0x57d966(0xdb)]>THERMO_LOG_SIZE)_0x286bbf[_0x57d966(0xea)]();await _0x2d92ee[_0x57d966(0x10c)](_0x57d966(0xda),{'val':JSON[_0x57d966(0xd3)](_0x286bbf),'ack':!![]});}async function saveCompletedSequence(_0x19ff48){const _0x24f93e=a4_0x5a49;try{const _0x1077c1=await _0x19ff48[_0x24f93e(0xcc)](_0x24f93e(0x108));let _0x1caf6a=[];if(_0x1077c1&&_0x1077c1[_0x24f93e(0xe8)])try{_0x1caf6a=JSON[_0x24f93e(0xc6)](_0x1077c1[_0x24f93e(0xe8)]);}catch(_0x57e14d){}const _0x4ee486=activeSequence[0x0]['ts'],_0x43a39=activeSequence[_0x24f93e(0xff)](_0x4db9a7=>({'loc':_0x4db9a7[_0x24f93e(0x116)],'t_delta':Math[_0x24f93e(0xe5)]((_0x4db9a7['ts']-_0x4ee486)/0x3e8)})),_0x97bcfc={'timestamp':new Date(_0x4ee486)[_0x24f93e(0xe9)](),'steps':_0x43a39,'duration':Math['round']((activeSequence[activeSequence[_0x24f93e(0xdb)]-0x1]['ts']-_0x4ee486)/0x3e8),'daytime':new Date(_0x4ee486)[_0x24f93e(0x117)]()};_0x1caf6a[_0x24f93e(0x115)](_0x97bcfc);if(_0x1caf6a[_0x24f93e(0xdb)]>MAX_TRAINING_SET_SIZE)_0x1caf6a[_0x24f93e(0xea)]();await _0x19ff48[_0x24f93e(0x10c)]('LTM.trainingData.sequences',{'val':JSON[_0x24f93e(0xd3)](_0x1caf6a),'ack':!![]}),_0x19ff48[_0x24f93e(0x104)]&&_0x19ff48['sendToPythonWrapper']&&_0x19ff48[_0x24f93e(0x109)](_0x24f93e(0xfd),{'sequence':_0x97bcfc});}catch(_0x199bd1){_0x19ff48['log']['error'](_0x24f93e(0x112)+_0x199bd1[_0x24f93e(0xca)]);}}function a4_0x5a49(_0x36e15f,_0x94f195){const _0x2af013=a4_0x11f9();return a4_0x5a49=function(_0x2298b2,_0x2c0bec){_0x2298b2=_0x2298b2-0xc1;let _0x11f905=_0x2af013[_0x2298b2];return _0x11f905;},a4_0x5a49(_0x36e15f,_0x94f195);}async function recordSequence(_0x2becb3,_0x23a382){const _0x14250c=a4_0x5a49,_0x13b34c=(_0x23a382[_0x14250c(0xd1)]||'')['toLowerCase'](),_0x22a44b=[_0x14250c(0xf6),_0x14250c(0xc7),'präsenz',_0x14250c(0x107),_0x14250c(0xc8),_0x14250c(0xe0),_0x14250c(0x101),_0x14250c(0xe6),_0x14250c(0xc5),_0x14250c(0xf8),'kontakt',_0x14250c(0xfe),_0x14250c(0xce),'switch','schalter',_0x14250c(0xf4),_0x14250c(0xe1)];if(!_0x22a44b[_0x14250c(0xf9)](_0x4aa47d=>_0x13b34c['includes'](_0x4aa47d)))return;if(!_0x23a382[_0x14250c(0xe4)])return;if(sequenceTimer)clearTimeout(sequenceTimer);activeSequence[_0x14250c(0x115)]({'loc':_0x23a382['location']||_0x14250c(0xc9),'id':_0x23a382['id'],'ts':Date[_0x14250c(0xef)]()}),sequenceTimer=setTimeout(async()=>{const _0x4c5b4a=_0x14250c;if(activeSequence[_0x4c5b4a(0xdb)]>0x1)await saveCompletedSequence(_0x2becb3);activeSequence=[];},SEQUENCE_TIMEOUT_MS);}function startExitTimer(_0x5c03e8){const _0x5def17=a4_0x5a49;abortExitTimer(_0x5c03e8),_0x5c03e8[_0x5def17(0xd9)]=!![],_0x5c03e8[_0x5def17(0x106)]=setTimeout(()=>{const _0x29cd51=_0x5def17;_0x5c03e8[_0x29cd51(0xd9)]=![];},EXIT_GRACE_PERIOD_SECONDS*0x3e8),_0x5c03e8['exitTimer']=setTimeout(()=>{const _0x57b25d=_0x5def17;setPresence(_0x5c03e8,![]),_0x5c03e8[_0x57b25d(0xf5)]=null;},EXIT_TIMER_MINUTES*0x3c*0x3e8);}function abortExitTimer(_0x4f7a35){const _0x3dedf0=a4_0x5a49;if(_0x4f7a35[_0x3dedf0(0xf5)])clearTimeout(_0x4f7a35[_0x3dedf0(0xf5)]);if(_0x4f7a35['exitGraceTimer'])clearTimeout(_0x4f7a35[_0x3dedf0(0x106)]);_0x4f7a35[_0x3dedf0(0xf5)]=null,_0x4f7a35['exitGraceTimer']=null,_0x4f7a35[_0x3dedf0(0xd9)]=![];}async function setPresence(_0x145b70,_0x542493){const _0x1bc444=a4_0x5a49;if(_0x145b70[_0x1bc444(0x114)]===_0x542493)return;_0x145b70[_0x1bc444(0x114)]=_0x542493,await _0x145b70[_0x1bc444(0x10c)](_0x1bc444(0x113),{'val':_0x542493,'ack':!![]});}async function processSensorEvent(_0x10c04d,_0x140627,_0x320a57,_0x2dd20e){const _0x5d1d78=a4_0x5a49;if(!_0x2dd20e)return;const _0x257432=_0x320a57[_0x5d1d78(0xe8)],_0x4a1580=Date[_0x5d1d78(0xef)](),_0x37efe6=_0x10c04d[_0x5d1d78(0xdc)][_0x140627];_0x10c04d[_0x5d1d78(0xdc)][_0x140627]=_0x257432;if(!_0x2dd20e[_0x5d1d78(0x10d)]&&_0x37efe6!=undefined&&_0x37efe6==_0x257432)return;const _0x15e979=(_0x2dd20e['type']||'')[_0x5d1d78(0xc2)](),_0x5ace15=_0x15e979[_0x5d1d78(0xd5)](_0x5d1d78(0xd2))||_0x15e979[_0x5d1d78(0xd5)](_0x5d1d78(0xf7))||_0x15e979['includes'](_0x5d1d78(0xc3))||_0x15e979[_0x5d1d78(0xd5)](_0x5d1d78(0xf2));_0x10c04d[_0x5d1d78(0x104)]&&_0x5ace15&&recordThermodynamics(_0x10c04d,_0x140627,_0x257432,_0x2dd20e[_0x5d1d78(0xfb)]);const _0x1dc425={'timestamp':_0x4a1580,'id':_0x140627,'name':_0x2dd20e[_0x5d1d78(0x118)],'type':_0x2dd20e[_0x5d1d78(0xd1)],'location':_0x2dd20e[_0x5d1d78(0xfb)],'value':_0x257432};_0x10c04d[_0x5d1d78(0xc4)][_0x5d1d78(0xdd)](_0x1dc425);if(_0x10c04d[_0x5d1d78(0xc4)][_0x5d1d78(0xdb)]>HISTORY_MAX_SIZE)_0x10c04d[_0x5d1d78(0xc4)][_0x5d1d78(0xcd)]();await _0x10c04d[_0x5d1d78(0x10c)](_0x5d1d78(0xe3),{'val':JSON[_0x5d1d78(0xd3)](_0x1dc425),'ack':!![]}),await _0x10c04d[_0x5d1d78(0x10c)]('events.history',{'val':JSON[_0x5d1d78(0xd3)](_0x10c04d[_0x5d1d78(0xc4)]),'ack':!![]});if(_0x10c04d['isProVersion']){_0x10c04d[_0x5d1d78(0xf0)][_0x5d1d78(0x115)](_0x1dc425);if(_0x10c04d['rawEventLog'][_0x5d1d78(0xdb)]>RAW_LOG_MAX_SIZE)_0x10c04d[_0x5d1d78(0xf0)]['splice'](0x0,_0x10c04d[_0x5d1d78(0xf0)][_0x5d1d78(0xdb)]-RAW_LOG_MAX_SIZE);await _0x10c04d['setStateAsync'](_0x5d1d78(0xfa),{'val':JSON[_0x5d1d78(0xd3)](_0x10c04d[_0x5d1d78(0xf0)]),'ack':!![]}),recordSequence(_0x10c04d,_0x1dc425);}if(_0x2dd20e[_0x5d1d78(0x119)]&&_0x257432===!![]){if(_0x10c04d['isPresent']&&!_0x10c04d[_0x5d1d78(0xd9)])startExitTimer(_0x10c04d);else{if(!_0x10c04d[_0x5d1d78(0x114)])setPresence(_0x10c04d,!![]);}}else{if(_0x2dd20e[_0x5d1d78(0xd1)]===_0x5d1d78(0xf6)&&_0x257432===!![]){if(_0x10c04d['exitTimer'])abortExitTimer(_0x10c04d);if(!_0x10c04d[_0x5d1d78(0x114)]&&_0x10c04d[_0x5d1d78(0xe2)]===_0x5d1d78(0x110))setPresence(_0x10c04d,!![]);}}_0x10c04d[_0x5d1d78(0x104)]&&_0x2dd20e[_0x5d1d78(0xd1)]===_0x5d1d78(0xf6)&&_0x257432===!![]&&_0x2dd20e[_0x5d1d78(0xfb)]&&_0x10c04d[_0x5d1d78(0x109)]&&_0x10c04d[_0x5d1d78(0x109)](_0x5d1d78(0xd4),{'room':_0x2dd20e[_0x5d1d78(0xfb)]});}module[a4_0x3eb773(0x102)]={'processSensorEvent':processSensorEvent,'getOutsideTemperatureNumeric':getOutsideTemperatureNumeric,'setPresence':setPresence,'abortExitTimer':abortExitTimer,'startExitTimer':startExitTimer};