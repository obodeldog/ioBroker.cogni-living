const a5_0x41fd9f=a5_0x3048;(function(_0x51a792,_0x41cfe0){const _0x49985a=a5_0x3048,_0x4fd520=_0x51a792();while(!![]){try{const _0xbdd35b=parseInt(_0x49985a(0xd6))/0x1+-parseInt(_0x49985a(0x93))/0x2+-parseInt(_0x49985a(0x8c))/0x3+-parseInt(_0x49985a(0xe7))/0x4*(parseInt(_0x49985a(0x8b))/0x5)+parseInt(_0x49985a(0x86))/0x6+-parseInt(_0x49985a(0xba))/0x7*(-parseInt(_0x49985a(0xd7))/0x8)+-parseInt(_0x49985a(0xd9))/0x9*(-parseInt(_0x49985a(0x87))/0xa);if(_0xbdd35b===_0x41cfe0)break;else _0x4fd520['push'](_0x4fd520['shift']());}catch(_0x53c9ee){_0x4fd520['push'](_0x4fd520['shift']());}}}(a5_0x480a,0x33c5a));const a5_0x4225a0=(function(){let _0x3647f4=!![];return function(_0x3441c3,_0x1a2c8e){const _0x4f9bcb=_0x3647f4?function(){const _0x5ce5df=a5_0x3048;if(_0x1a2c8e){const _0x576958=_0x1a2c8e[_0x5ce5df(0xe3)](_0x3441c3,arguments);return _0x1a2c8e=null,_0x576958;}}:function(){};return _0x3647f4=![],_0x4f9bcb;};}()),a5_0x7463be=a5_0x4225a0(this,function(){const _0x29e2d1=a5_0x3048;return a5_0x7463be[_0x29e2d1(0xdc)]()['search'](_0x29e2d1(0x9a))['toString']()['constructor'](a5_0x7463be)[_0x29e2d1(0x80)]('(((.+)+)+)+$');});a5_0x7463be();'use strict';const HISTORY_MAX_SIZE=0x32,RAW_LOG_MAX_SIZE=0x9c4,THERMO_LOG_SIZE=0x3e8,SEQUENCE_TIMEOUT_MS=0x5*0x3c*0x3e8,MAX_TRAINING_SET_SIZE=0x1f4,EXIT_TIMER_MINUTES=0xf,EXIT_GRACE_PERIOD_SECONDS=0x1e;function a5_0x480a(){const _0x377e7a=['openweathermap','error','stringify','599158KOFANC','exitGraceTimer','events.history','useWeather','unshift','schalter','toISOString','rawEventLog','logDuplicates','.1.ACTUAL_TEMPERATURE','lampe','contact','STATUS','length','LTM.trainingData.sequences','temperature','eventHistory','Temperature','log','pop','valveMapping','.forecast.current.temperature','weatherInstance','location','events.lastEvent','sendToPythonWrapper','loc','splice','269629naHGVP','8vPESAq','.1.TEMPERATURE','1638amNlMM','door','string','toString','Valve','val','sensorLastValues','exitTimer','.1.VALVE_STATE','window','apply','from','kontakt','some','12mwwNhf','round','currentSystemMode','.4.VALVE_STATE','SIMULATE_SIGNAL','search','push','level','isGracePeriodActive','.Current.Temperature','value','1247574pOqeGN','1090WmEqzZ','ANALYZE_SEQUENCE','LTM.trainingData.thermodynamics','outdoorSensorId','55890FzeZrI','85503QIWCXD','accuweather','isProVersion','message','handle','motion','isPresent','617794trhFFa','daswetter','tür','dimmer','Unknown','getHours','LEVEL','(((.+)+)+)+$','replace','STATE','map','shift','.ACTUAL_TEMPERATURE','light','occupancy','includes','licht','now','normal','\x20from\x20','exports','.1.LEVEL','parse','getForeignStateAsync','fenster','heizung','config','toLowerCase','name','setStateAsync','number','.LEVEL','lastTrackerEventTime','bewegung','type','getStateAsync'];a5_0x480a=function(){return _0x377e7a;};return a5_0x480a();}let activeSequence=[],sequenceTimer=null;async function getOutsideTemperatureNumeric(_0x4446b7){const _0xf64b88=a5_0x3048;if(_0x4446b7[_0xf64b88(0xad)][_0xf64b88(0x8a)])try{const _0x4996f1=await _0x4446b7[_0xf64b88(0xaa)](_0x4446b7['config'][_0xf64b88(0x8a)]);if(_0x4996f1&&_0x4996f1[_0xf64b88(0xde)]!==undefined&&_0x4996f1[_0xf64b88(0xde)]!==null)return parseFloat(_0x4996f1[_0xf64b88(0xde)]);}catch(_0xd8c376){}const _0x5cb5d2=_0x4446b7[_0xf64b88(0xad)][_0xf64b88(0xd0)];if(!_0x4446b7[_0xf64b88(0xad)][_0xf64b88(0xbd)]||!_0x5cb5d2)return null;try{let _0x2533ec='';if(_0x5cb5d2[_0xf64b88(0xa2)](_0xf64b88(0x8d)))_0x2533ec=_0x5cb5d2+_0xf64b88(0x84);else{if(_0x5cb5d2['includes'](_0xf64b88(0x94)))_0x2533ec=_0x5cb5d2+'.NextHours.Location_1.Day_1.current.temp_value';else{if(_0x5cb5d2[_0xf64b88(0xa2)](_0xf64b88(0xb7)))_0x2533ec=_0x5cb5d2+_0xf64b88(0xcf);else{if(_0x5cb5d2[_0xf64b88(0xa2)]('weatherunderground'))_0x2533ec=_0x5cb5d2+'.forecast.current.temp';}}}if(_0x2533ec){const _0x21bec1=await _0x4446b7[_0xf64b88(0xaa)](_0x2533ec);if(_0x21bec1&&_0x21bec1[_0xf64b88(0xde)]!==undefined&&_0x21bec1[_0xf64b88(0xde)]!==null)return parseFloat(_0x21bec1['val']);}}catch(_0x154c70){}return null;}async function recordThermodynamics(_0x4ebe56,_0x4a74fd,_0x4e1954,_0xdb8a83){const _0x413ce3=a5_0x3048,_0xc102ab=await getOutsideTemperatureNumeric(_0x4ebe56);if(_0xc102ab===null)return;let _0x144bb5=0x0,_0x592a4f=![];if(_0x4ebe56[_0x413ce3(0xad)]['valveMapping'])try{let _0x292417=_0x4ebe56[_0x413ce3(0xad)][_0x413ce3(0xce)];if(typeof _0x292417===_0x413ce3(0xdb))_0x292417=JSON[_0x413ce3(0xa9)](_0x292417);if(_0x292417[_0x4a74fd]){const _0x329239=_0x292417[_0x4a74fd],_0x18e8fb=await _0x4ebe56['getForeignStateAsync'](_0x329239);if(_0x18e8fb&&_0x18e8fb['val']!==null&&_0x18e8fb[_0x413ce3(0xde)]!==undefined){let _0xdc89af=Number(_0x18e8fb[_0x413ce3(0xde)]);if(_0xdc89af<=1.05&&!_0x329239['includes'](_0x413ce3(0xc6))&&!_0x329239[_0x413ce3(0xa2)](_0x413ce3(0x9c)))_0xdc89af=_0xdc89af*0x64;_0x144bb5=Math[_0x413ce3(0xe8)](_0xdc89af),_0x592a4f=!![];}}}catch(_0x235a2e){}if(!_0x592a4f){const _0x43c55e=[{'from':_0x413ce3(0xc3),'to':_0x413ce3(0xa8)},{'from':_0x413ce3(0xc3),'to':_0x413ce3(0xe1)},{'from':_0x413ce3(0xd8),'to':_0x413ce3(0x7e)},{'from':_0x413ce3(0x9f),'to':_0x413ce3(0xb2)},{'from':_0x413ce3(0xc9),'to':_0x413ce3(0x82)},{'from':_0x413ce3(0xcb),'to':_0x413ce3(0xdd)}];for(const _0x563369 of _0x43c55e){if(_0x4a74fd['includes'](_0x563369[_0x413ce3(0xe4)])){const _0x4cca8d=_0x4a74fd[_0x413ce3(0x9b)](_0x563369[_0x413ce3(0xe4)],_0x563369['to']);try{const _0x29f99f=await _0x4ebe56[_0x413ce3(0xaa)](_0x4cca8d);if(_0x29f99f&&_0x29f99f[_0x413ce3(0xde)]!==null&&_0x29f99f[_0x413ce3(0xde)]!==undefined){let _0x5d53bf=Number(_0x29f99f[_0x413ce3(0xde)]);if(typeof _0x5d53bf==='number'){if(_0x5d53bf<=1.05&&_0x563369['to'][_0x413ce3(0xa2)](_0x413ce3(0x99)))_0x5d53bf=_0x5d53bf*0x64;_0x144bb5=Math[_0x413ce3(0xe8)](_0x5d53bf),_0x592a4f=!![];break;}}}catch(_0x4ba7fb){}}}}const _0x1de924=await _0x4ebe56[_0x413ce3(0xb6)](_0x413ce3(0x89));let _0x1c94ca=[];if(_0x1de924&&_0x1de924['val'])try{_0x1c94ca=JSON['parse'](_0x1de924[_0x413ce3(0xde)]);}catch(_0xcd8b86){}_0x1c94ca[_0x413ce3(0x81)]({'ts':Date[_0x413ce3(0xa4)](),'room':_0xdb8a83||_0x413ce3(0x97),'t_in':_0x4e1954,'t_out':_0xc102ab,'valve':_0x144bb5});if(_0x1c94ca[_0x413ce3(0xc7)]>THERMO_LOG_SIZE)_0x1c94ca[_0x413ce3(0x9e)]();await _0x4ebe56[_0x413ce3(0xb0)](_0x413ce3(0x89),{'val':JSON['stringify'](_0x1c94ca),'ack':!![]});}function a5_0x3048(_0x36b579,_0x1a632c){const _0x3960f6=a5_0x480a();return a5_0x3048=function(_0x7463be,_0x4225a0){_0x7463be=_0x7463be-0x7d;let _0x480ab1=_0x3960f6[_0x7463be];return _0x480ab1;},a5_0x3048(_0x36b579,_0x1a632c);}async function saveCompletedSequence(_0x5b67ae){const _0xe57d57=a5_0x3048;try{const _0x18af4b=await _0x5b67ae[_0xe57d57(0xb6)](_0xe57d57(0xc8));let _0x5d2a67=[];if(_0x18af4b&&_0x18af4b['val'])try{_0x5d2a67=JSON[_0xe57d57(0xa9)](_0x18af4b[_0xe57d57(0xde)]);}catch(_0x147a61){}const _0x265afc=activeSequence[0x0]['ts'],_0x1d0d6a=activeSequence[_0xe57d57(0x9d)](_0x4aa400=>({'loc':_0x4aa400[_0xe57d57(0xd4)],'t_delta':Math[_0xe57d57(0xe8)]((_0x4aa400['ts']-_0x265afc)/0x3e8)})),_0x485bf0={'timestamp':new Date(_0x265afc)[_0xe57d57(0xc0)](),'steps':_0x1d0d6a,'duration':Math[_0xe57d57(0xe8)]((activeSequence[activeSequence[_0xe57d57(0xc7)]-0x1]['ts']-_0x265afc)/0x3e8),'daytime':new Date(_0x265afc)[_0xe57d57(0x98)]()};_0x5d2a67['push'](_0x485bf0);if(_0x5d2a67[_0xe57d57(0xc7)]>MAX_TRAINING_SET_SIZE)_0x5d2a67[_0xe57d57(0x9e)]();await _0x5b67ae[_0xe57d57(0xb0)](_0xe57d57(0xc8),{'val':JSON[_0xe57d57(0xb9)](_0x5d2a67),'ack':!![]}),_0x5b67ae[_0xe57d57(0x8e)]&&_0x5b67ae[_0xe57d57(0xd3)]&&_0x5b67ae[_0xe57d57(0xd3)](_0xe57d57(0x88),{'sequence':_0x485bf0});}catch(_0x106a1d){_0x5b67ae['log'][_0xe57d57(0xb8)]('[RECORDER]\x20Error:\x20'+_0x106a1d[_0xe57d57(0x8f)]);}}async function recordSequence(_0x5c6df5,_0x407261){const _0x3a2210=a5_0x3048,_0x312329=(_0x407261[_0x3a2210(0xb5)]||'')[_0x3a2210(0xae)](),_0x4aa3df=['motion',_0x3a2210(0xb4),'präsenz','presence',_0x3a2210(0xa1),_0x3a2210(0xda),_0x3a2210(0x95),_0x3a2210(0xe2),_0x3a2210(0xab),_0x3a2210(0xc5),_0x3a2210(0xe5),_0x3a2210(0xa0),_0x3a2210(0xa3),'switch',_0x3a2210(0xbf),_0x3a2210(0x96),_0x3a2210(0xc4)];if(!_0x4aa3df[_0x3a2210(0xe6)](_0x125cda=>_0x312329[_0x3a2210(0xa2)](_0x125cda)))return;if(!_0x407261[_0x3a2210(0x85)])return;if(sequenceTimer)clearTimeout(sequenceTimer);activeSequence[_0x3a2210(0x81)]({'loc':_0x407261['location']||_0x3a2210(0x97),'id':_0x407261['id'],'ts':Date[_0x3a2210(0xa4)]()}),sequenceTimer=setTimeout(async()=>{if(activeSequence['length']>0x1)await saveCompletedSequence(_0x5c6df5);activeSequence=[];},SEQUENCE_TIMEOUT_MS);}function startExitTimer(_0x2cec75){const _0x5ad592=a5_0x3048;abortExitTimer(_0x2cec75),_0x2cec75['isGracePeriodActive']=!![],_0x2cec75[_0x5ad592(0xbb)]=setTimeout(()=>{_0x2cec75['isGracePeriodActive']=![];},EXIT_GRACE_PERIOD_SECONDS*0x3e8),_0x2cec75[_0x5ad592(0xe0)]=setTimeout(()=>{const _0x5c6554=_0x5ad592;setPresence(_0x2cec75,![]),_0x2cec75[_0x5c6554(0xe0)]=null;},EXIT_TIMER_MINUTES*0x3c*0x3e8);}function abortExitTimer(_0x2b8921){const _0x47ce5c=a5_0x3048;if(_0x2b8921[_0x47ce5c(0xe0)])clearTimeout(_0x2b8921[_0x47ce5c(0xe0)]);if(_0x2b8921['exitGraceTimer'])clearTimeout(_0x2b8921[_0x47ce5c(0xbb)]);_0x2b8921[_0x47ce5c(0xe0)]=null,_0x2b8921['exitGraceTimer']=null,_0x2b8921[_0x47ce5c(0x83)]=![];}async function setPresence(_0x35cb0e,_0x49d002){const _0x2e1a13=a5_0x3048;if(_0x35cb0e['isPresent']===_0x49d002)return;_0x35cb0e[_0x2e1a13(0x92)]=_0x49d002,await _0x35cb0e[_0x2e1a13(0xb0)]('system.isPresent',{'val':_0x49d002,'ack':!![]});}async function processSensorEvent(_0x4fa5af,_0x42c603,_0x265813,_0x558a47){const _0x23ec4a=a5_0x3048;if(!_0x558a47)return null;const _0xa0ffcf=_0x265813['val'],_0x1ef421=Date[_0x23ec4a(0xa4)](),_0x48ee78=_0x4fa5af[_0x23ec4a(0xdf)][_0x42c603],_0xe19545=(_0x558a47['type']||'')['toLowerCase'](),_0x4901cc=_0xe19545[_0x23ec4a(0xa2)]('temperature')||_0xe19545[_0x23ec4a(0xa2)]('temperatur')||_0xe19545[_0x23ec4a(0xa2)]('klima')||_0xe19545[_0x23ec4a(0xa2)](_0x23ec4a(0xac))||_0xe19545[_0x23ec4a(0xa2)]('thermostat');if(_0x4901cc&&typeof _0xa0ffcf===_0x23ec4a(0xb1)){if(_0xa0ffcf>0x50||_0xa0ffcf<-0x32)return _0x4fa5af[_0x23ec4a(0xcc)]['debug']('[RECORDER]\x20Ignored\x20implausible\x20temperature:\x20'+_0xa0ffcf+_0x23ec4a(0xa6)+_0x42c603),null;}_0x4fa5af[_0x23ec4a(0xdf)][_0x42c603]=_0xa0ffcf;if(!_0x558a47[_0x23ec4a(0xc2)]&&_0x48ee78!=undefined&&_0x48ee78==_0xa0ffcf)return null;_0x4fa5af[_0x23ec4a(0x8e)]&&_0x4901cc&&recordThermodynamics(_0x4fa5af,_0x42c603,_0xa0ffcf,_0x558a47['location']);const _0x20944b={'timestamp':_0x1ef421,'id':_0x42c603,'name':_0x558a47[_0x23ec4a(0xaf)],'type':_0x558a47[_0x23ec4a(0xb5)],'location':_0x558a47[_0x23ec4a(0xd1)],'value':_0xa0ffcf};_0x4fa5af['eventHistory'][_0x23ec4a(0xbe)](_0x20944b);if(_0x4fa5af[_0x23ec4a(0xca)][_0x23ec4a(0xc7)]>HISTORY_MAX_SIZE)_0x4fa5af['eventHistory'][_0x23ec4a(0xcd)]();await _0x4fa5af[_0x23ec4a(0xb0)](_0x23ec4a(0xd2),{'val':JSON['stringify'](_0x20944b),'ack':!![]}),await _0x4fa5af[_0x23ec4a(0xb0)](_0x23ec4a(0xbc),{'val':JSON[_0x23ec4a(0xb9)](_0x4fa5af[_0x23ec4a(0xca)]),'ack':!![]});if(_0x4fa5af[_0x23ec4a(0x8e)]){_0x4fa5af[_0x23ec4a(0xc1)]['push'](_0x20944b);if(_0x4fa5af[_0x23ec4a(0xc1)][_0x23ec4a(0xc7)]>RAW_LOG_MAX_SIZE)_0x4fa5af[_0x23ec4a(0xc1)][_0x23ec4a(0xd5)](0x0,_0x4fa5af[_0x23ec4a(0xc1)][_0x23ec4a(0xc7)]-RAW_LOG_MAX_SIZE);await _0x4fa5af['setStateAsync']('LTM.rawEventLog',{'val':JSON['stringify'](_0x4fa5af[_0x23ec4a(0xc1)]),'ack':!![]}),recordSequence(_0x4fa5af,_0x20944b);}if(_0x558a47['isExit']&&_0xa0ffcf===!![]){if(_0x4fa5af[_0x23ec4a(0x92)]&&!_0x4fa5af[_0x23ec4a(0x83)])startExitTimer(_0x4fa5af);else{if(!_0x4fa5af[_0x23ec4a(0x92)])setPresence(_0x4fa5af,!![]);}}else{if(_0x558a47[_0x23ec4a(0xb5)]===_0x23ec4a(0x91)&&_0xa0ffcf===!![]){if(_0x4fa5af[_0x23ec4a(0xe0)])abortExitTimer(_0x4fa5af);if(!_0x4fa5af['isPresent']&&_0x4fa5af[_0x23ec4a(0x7d)]===_0x23ec4a(0xa5))setPresence(_0x4fa5af,!![]);}}if(_0x4fa5af[_0x23ec4a(0x8e)]&&_0x4fa5af['sendToPythonWrapper']){_0x558a47[_0x23ec4a(0xb5)]===_0x23ec4a(0x91)&&_0xa0ffcf===!![]&&_0x558a47[_0x23ec4a(0xd1)]&&_0x4fa5af['sendToPythonWrapper'](_0x23ec4a(0x7f),{'room':_0x558a47['location']});const _0x58cd59=[_0x23ec4a(0xda),_0x23ec4a(0x95),_0x23ec4a(0xe2),_0x23ec4a(0xab),'griff',_0x23ec4a(0x90),'lock','schloss'][_0x23ec4a(0xe6)](_0x25db19=>_0xe19545[_0x23ec4a(0xa2)](_0x25db19)),_0x385096=[_0x23ec4a(0xa0),_0x23ec4a(0xa3),'switch',_0x23ec4a(0xbf),'dimmer',_0x23ec4a(0xc4)][_0x23ec4a(0xe6)](_0x22a536=>_0xe19545[_0x23ec4a(0xa2)](_0x22a536)),_0x36d5ed=['motion',_0x23ec4a(0xb4),'präsenz','presence','occupancy'][_0x23ec4a(0xe6)](_0x140748=>_0xe19545[_0x23ec4a(0xa2)](_0x140748));if(_0x558a47['location']&&(_0x58cd59||_0x385096||_0x36d5ed)){const _0x17109c=_0xa0ffcf===!![]||typeof _0xa0ffcf===_0x23ec4a(0xb1)&&_0xa0ffcf>0x0,_0x242419=_0x58cd59&&!_0x17109c&&_0x48ee78!==undefined&&_0x48ee78!=_0xa0ffcf;if(_0x17109c||_0x242419){const _0x53f331=_0x4fa5af[_0x23ec4a(0xb3)]||_0x1ef421,_0x567251=(_0x1ef421-_0x53f331)/0x3e8;_0x4fa5af[_0x23ec4a(0xb3)]=_0x1ef421,_0x4fa5af[_0x23ec4a(0xd3)]('TRACK_EVENT',{'room':_0x558a47[_0x23ec4a(0xd1)],'dt':_0x567251});}}}return _0x20944b;}module[a5_0x41fd9f(0xa7)]={'processSensorEvent':processSensorEvent,'getOutsideTemperatureNumeric':getOutsideTemperatureNumeric,'setPresence':setPresence,'abortExitTimer':abortExitTimer,'startExitTimer':startExitTimer};