const a5_0x40a221=a5_0x6478;(function(_0x36e064,_0x1e5d68){const _0xd70658=a5_0x6478,_0x36294a=_0x36e064();while(!![]){try{const _0x1e744f=parseInt(_0xd70658(0xf4))/0x1*(-parseInt(_0xd70658(0x12a))/0x2)+-parseInt(_0xd70658(0xfb))/0x3+parseInt(_0xd70658(0x135))/0x4*(-parseInt(_0xd70658(0xdb))/0x5)+-parseInt(_0xd70658(0x110))/0x6*(parseInt(_0xd70658(0x11d))/0x7)+-parseInt(_0xd70658(0xd8))/0x8+-parseInt(_0xd70658(0x111))/0x9*(-parseInt(_0xd70658(0x107))/0xa)+-parseInt(_0xd70658(0x12b))/0xb*(-parseInt(_0xd70658(0xff))/0xc);if(_0x1e744f===_0x1e5d68)break;else _0x36294a['push'](_0x36294a['shift']());}catch(_0x1c22fa){_0x36294a['push'](_0x36294a['shift']());}}}(a5_0x436a,0x1c939));const a5_0x1c43a6=(function(){let _0x18ae94=!![];return function(_0x438014,_0x2517d5){const _0x17bcb7=_0x18ae94?function(){const _0xd83076=a5_0x6478;if(_0x2517d5){const _0x126d3a=_0x2517d5[_0xd83076(0x118)](_0x438014,arguments);return _0x2517d5=null,_0x126d3a;}}:function(){};return _0x18ae94=![],_0x17bcb7;};}()),a5_0x1c3e02=a5_0x1c43a6(this,function(){const _0x519795=a5_0x6478;return a5_0x1c3e02[_0x519795(0xe5)]()['search'](_0x519795(0xe1))['toString']()[_0x519795(0x109)](a5_0x1c3e02)['search']('(((.+)+)+)+$');});a5_0x1c3e02();'use strict';const HISTORY_MAX_SIZE=0x32,RAW_LOG_MAX_SIZE=0x9c4,THERMO_LOG_SIZE=0x3e8,SEQUENCE_TIMEOUT_MS=0x5*0x3c*0x3e8,MAX_TRAINING_SET_SIZE=0x1f4,EXIT_TIMER_MINUTES=0xf,EXIT_GRACE_PERIOD_SECONDS=0x1e;let activeSequence=[],sequenceTimer=null;async function getOutsideTemperatureNumeric(_0x5160d5){const _0x9d62c7=a5_0x6478;if(_0x5160d5[_0x9d62c7(0x106)]['outdoorSensorId'])try{const _0x1555be=await _0x5160d5['getForeignStateAsync'](_0x5160d5[_0x9d62c7(0x106)][_0x9d62c7(0x10a)]);if(_0x1555be&&_0x1555be[_0x9d62c7(0x123)]!==undefined&&_0x1555be[_0x9d62c7(0x123)]!==null)return parseFloat(_0x1555be[_0x9d62c7(0x123)]);}catch(_0x5ce28e){}const _0x144319=_0x5160d5['config'][_0x9d62c7(0xe4)];if(!_0x5160d5[_0x9d62c7(0x106)]['useWeather']||!_0x144319)return null;try{let _0x4d5de8='';if(_0x144319[_0x9d62c7(0xe3)](_0x9d62c7(0xd4)))_0x4d5de8=_0x144319+_0x9d62c7(0x124);else{if(_0x144319[_0x9d62c7(0xe3)]('daswetter'))_0x4d5de8=_0x144319+_0x9d62c7(0xf2);else{if(_0x144319['includes'](_0x9d62c7(0xea)))_0x4d5de8=_0x144319+_0x9d62c7(0xd9);else{if(_0x144319[_0x9d62c7(0xe3)](_0x9d62c7(0x10d)))_0x4d5de8=_0x144319+_0x9d62c7(0xef);}}}if(_0x4d5de8){const _0x558ae7=await _0x5160d5[_0x9d62c7(0xfa)](_0x4d5de8);if(_0x558ae7&&_0x558ae7[_0x9d62c7(0x123)]!==undefined&&_0x558ae7[_0x9d62c7(0x123)]!==null)return parseFloat(_0x558ae7[_0x9d62c7(0x123)]);}}catch(_0xe03675){}return null;}async function recordThermodynamics(_0xf3ffda,_0x11357c,_0x2506a5,_0x4a2403){const _0x3c2cdd=a5_0x6478,_0x75193c=await getOutsideTemperatureNumeric(_0xf3ffda);let _0x4c43ad=0x0;if(_0x11357c[_0x3c2cdd(0xe3)](_0x3c2cdd(0x11f))){const _0x2acd41=[{'from':_0x3c2cdd(0xd1),'to':_0x3c2cdd(0x120)},{'from':_0x3c2cdd(0xd1),'to':'.1.VALVE_STATE'},{'from':'.1.TEMPERATURE','to':_0x3c2cdd(0xe8)},{'from':_0x3c2cdd(0xee),'to':_0x3c2cdd(0x101)}];for(const _0x3dc382 of _0x2acd41){if(_0x11357c[_0x3c2cdd(0xe3)](_0x3dc382[_0x3c2cdd(0x10c)])){const _0x2ac6f4=_0x11357c[_0x3c2cdd(0xf8)](_0x3dc382[_0x3c2cdd(0x10c)],_0x3dc382['to']);try{const _0x41ddb3=await _0xf3ffda['getForeignStateAsync'](_0x2ac6f4);if(_0x41ddb3&&_0x41ddb3[_0x3c2cdd(0x123)]!==null&&_0x41ddb3['val']!==undefined){let _0x395d90=_0x41ddb3[_0x3c2cdd(0x123)];typeof _0x395d90===_0x3c2cdd(0x102)&&_0x395d90<=1.05&&_0x3dc382['to'][_0x3c2cdd(0xe3)]('LEVEL')&&(_0x395d90=_0x395d90*0x64);_0x4c43ad=Math[_0x3c2cdd(0xd2)](_0x395d90);break;}}catch(_0x15c6ba){}}}}const _0x34847c=await _0xf3ffda[_0x3c2cdd(0xed)](_0x3c2cdd(0x116));let _0x4a590c=[];if(_0x34847c&&_0x34847c[_0x3c2cdd(0x123)])try{_0x4a590c=JSON[_0x3c2cdd(0xfc)](_0x34847c[_0x3c2cdd(0x123)]);}catch(_0x37d6d5){}_0x4a590c['push']({'ts':Date[_0x3c2cdd(0x132)](),'room':_0x4a2403||'Unknown','t_in':_0x2506a5,'t_out':_0x75193c,'valve':_0x4c43ad});if(_0x4a590c['length']>THERMO_LOG_SIZE)_0x4a590c[_0x3c2cdd(0xec)]();await _0xf3ffda[_0x3c2cdd(0x12f)](_0x3c2cdd(0x116),{'val':JSON['stringify'](_0x4a590c),'ack':!![]});}async function saveCompletedSequence(_0x179b34){const _0x4f88fc=a5_0x6478;try{const _0x3d2479=await _0x179b34[_0x4f88fc(0xed)](_0x4f88fc(0x128));let _0x4625f1=[];if(_0x3d2479&&_0x3d2479[_0x4f88fc(0x123)])try{_0x4625f1=JSON['parse'](_0x3d2479[_0x4f88fc(0x123)]);}catch(_0x48a553){}const _0x29f53f=activeSequence[0x0]['ts'],_0x4870f4=activeSequence[_0x4f88fc(0x10e)](_0x387f32=>({'loc':_0x387f32[_0x4f88fc(0x12e)],'t_delta':Math['round']((_0x387f32['ts']-_0x29f53f)/0x3e8)})),_0x177469={'timestamp':new Date(_0x29f53f)[_0x4f88fc(0x10b)](),'steps':_0x4870f4,'duration':Math[_0x4f88fc(0xd2)]((activeSequence[activeSequence[_0x4f88fc(0xe6)]-0x1]['ts']-_0x29f53f)/0x3e8),'daytime':new Date(_0x29f53f)[_0x4f88fc(0xeb)]()};_0x4625f1[_0x4f88fc(0xdd)](_0x177469);if(_0x4625f1[_0x4f88fc(0xe6)]>MAX_TRAINING_SET_SIZE)_0x4625f1[_0x4f88fc(0xec)]();await _0x179b34[_0x4f88fc(0x12f)](_0x4f88fc(0x128),{'val':JSON[_0x4f88fc(0x103)](_0x4625f1),'ack':!![]}),_0x179b34[_0x4f88fc(0xdc)]&&_0x179b34[_0x4f88fc(0x108)]&&_0x179b34[_0x4f88fc(0x108)](_0x4f88fc(0x11e),{'sequence':_0x177469});}catch(_0x144102){_0x179b34[_0x4f88fc(0x12c)][_0x4f88fc(0xd6)](_0x4f88fc(0xd3)+_0x144102[_0x4f88fc(0x122)]);}}async function recordSequence(_0x46a9b7,_0x48602c){const _0x478680=a5_0x6478,_0x143886=(_0x48602c['type']||'')[_0x478680(0xd0)](),_0x50c199=[_0x478680(0x127),_0x478680(0x112),_0x478680(0xd7),_0x478680(0x131),_0x478680(0x11c),_0x478680(0xf6),_0x478680(0x125),_0x478680(0xf3),_0x478680(0xf1),_0x478680(0x119),_0x478680(0x117),_0x478680(0xe2),_0x478680(0x129),_0x478680(0xe7),_0x478680(0xde),_0x478680(0xdf),_0x478680(0x133)];if(!_0x50c199[_0x478680(0x105)](_0x3e688c=>_0x143886[_0x478680(0xe3)](_0x3e688c)))return;if(!_0x48602c[_0x478680(0xf7)])return;if(sequenceTimer)clearTimeout(sequenceTimer);activeSequence[_0x478680(0xdd)]({'loc':_0x48602c[_0x478680(0xfd)]||_0x478680(0x121),'id':_0x48602c['id'],'ts':Date[_0x478680(0x132)]()}),sequenceTimer=setTimeout(async()=>{const _0x4092ae=_0x478680;if(activeSequence[_0x4092ae(0xe6)]>0x1)await saveCompletedSequence(_0x46a9b7);activeSequence=[];},SEQUENCE_TIMEOUT_MS);}function a5_0x436a(){const _0x3b2980=['shift','getStateAsync','.ACTUAL_TEMPERATURE','.forecast.current.temp','unshift','fenster','.NextHours.Location_1.Day_1.current.temp_value','window','2NhNcIQ','LTM.rawEventLog','door','value','replace','events.history','getForeignStateAsync','14712dZjTCg','parse','location','rawEventLog','48036azawIW','currentSystemMode','.LEVEL','number','stringify','exports','some','config','1133520bXmnKs','sendToPythonWrapper','constructor','outdoorSensorId','toISOString','from','weatherunderground','map','exitGraceTimer','27012fYLJIY','9DDKPkZ','bewegung','temperatur','exitTimer','type','LTM.trainingData.thermodynamics','kontakt','apply','contact','logDuplicates','temperature','occupancy','231WELfWI','ANALYZE_SEQUENCE','hm-rpc','.1.LEVEL','Unknown','message','val','.Current.Temperature','tür','splice','motion','LTM.trainingData.sequences','licht','33458VbFnbX','1529eklXQV','log','isExit','loc','setStateAsync','sensorLastValues','presence','now','lampe','klima','856820YUxYcN','normal','toLowerCase','.1.ACTUAL_TEMPERATURE','round','[RECORDER]\x20Error:\x20','accuweather','isPresent','error','präsenz','1212696UdPEIT','.forecast.current.temperature','isGracePeriodActive','5nmVBJn','isProVersion','push','schalter','dimmer','eventHistory','(((.+)+)+)+$','light','includes','weatherInstance','toString','length','switch','.4.VALVE_STATE','name','openweathermap','getHours'];a5_0x436a=function(){return _0x3b2980;};return a5_0x436a();}function startExitTimer(_0x7ac89c){const _0x47b4a3=a5_0x6478;abortExitTimer(_0x7ac89c),_0x7ac89c[_0x47b4a3(0xda)]=!![],_0x7ac89c[_0x47b4a3(0x10f)]=setTimeout(()=>{const _0x48a283=_0x47b4a3;_0x7ac89c[_0x48a283(0xda)]=![];},EXIT_GRACE_PERIOD_SECONDS*0x3e8),_0x7ac89c['exitTimer']=setTimeout(()=>{const _0x31425b=_0x47b4a3;setPresence(_0x7ac89c,![]),_0x7ac89c[_0x31425b(0x114)]=null;},EXIT_TIMER_MINUTES*0x3c*0x3e8);}function abortExitTimer(_0x1865b2){const _0x33973c=a5_0x6478;if(_0x1865b2[_0x33973c(0x114)])clearTimeout(_0x1865b2[_0x33973c(0x114)]);if(_0x1865b2[_0x33973c(0x10f)])clearTimeout(_0x1865b2[_0x33973c(0x10f)]);_0x1865b2[_0x33973c(0x114)]=null,_0x1865b2[_0x33973c(0x10f)]=null,_0x1865b2[_0x33973c(0xda)]=![];}async function setPresence(_0x16871b,_0x3509de){const _0x11bdb=a5_0x6478;if(_0x16871b[_0x11bdb(0xd5)]===_0x3509de)return;_0x16871b[_0x11bdb(0xd5)]=_0x3509de,await _0x16871b[_0x11bdb(0x12f)]('system.isPresent',{'val':_0x3509de,'ack':!![]});}async function processSensorEvent(_0x576d6c,_0x53f69a,_0x595c4c,_0x24098f){const _0xed8a56=a5_0x6478;if(!_0x24098f)return null;const _0x1811dc=_0x595c4c[_0xed8a56(0x123)],_0x1edeac=Date[_0xed8a56(0x132)](),_0x5f4d14=_0x576d6c[_0xed8a56(0x130)][_0x53f69a];_0x576d6c[_0xed8a56(0x130)][_0x53f69a]=_0x1811dc;if(!_0x24098f[_0xed8a56(0x11a)]&&_0x5f4d14!=undefined&&_0x5f4d14==_0x1811dc)return null;const _0x22291c=(_0x24098f['type']||'')[_0xed8a56(0xd0)](),_0xd36adb=_0x22291c[_0xed8a56(0xe3)](_0xed8a56(0x11b))||_0x22291c[_0xed8a56(0xe3)](_0xed8a56(0x113))||_0x22291c[_0xed8a56(0xe3)](_0xed8a56(0x134))||_0x22291c['includes']('heizung');_0x576d6c[_0xed8a56(0xdc)]&&_0xd36adb&&recordThermodynamics(_0x576d6c,_0x53f69a,_0x1811dc,_0x24098f[_0xed8a56(0xfd)]);const _0x5a1667={'timestamp':_0x1edeac,'id':_0x53f69a,'name':_0x24098f[_0xed8a56(0xe9)],'type':_0x24098f[_0xed8a56(0x115)],'location':_0x24098f[_0xed8a56(0xfd)],'value':_0x1811dc};_0x576d6c[_0xed8a56(0xe0)][_0xed8a56(0xf0)](_0x5a1667);if(_0x576d6c[_0xed8a56(0xe0)]['length']>HISTORY_MAX_SIZE)_0x576d6c[_0xed8a56(0xe0)]['pop']();await _0x576d6c['setStateAsync']('events.lastEvent',{'val':JSON[_0xed8a56(0x103)](_0x5a1667),'ack':!![]}),await _0x576d6c[_0xed8a56(0x12f)](_0xed8a56(0xf9),{'val':JSON[_0xed8a56(0x103)](_0x576d6c[_0xed8a56(0xe0)]),'ack':!![]});if(_0x576d6c['isProVersion']){_0x576d6c[_0xed8a56(0xfe)]['push'](_0x5a1667);if(_0x576d6c['rawEventLog'][_0xed8a56(0xe6)]>RAW_LOG_MAX_SIZE)_0x576d6c[_0xed8a56(0xfe)][_0xed8a56(0x126)](0x0,_0x576d6c[_0xed8a56(0xfe)][_0xed8a56(0xe6)]-RAW_LOG_MAX_SIZE);await _0x576d6c['setStateAsync'](_0xed8a56(0xf5),{'val':JSON[_0xed8a56(0x103)](_0x576d6c[_0xed8a56(0xfe)]),'ack':!![]}),recordSequence(_0x576d6c,_0x5a1667);}if(_0x24098f[_0xed8a56(0x12d)]&&_0x1811dc===!![]){if(_0x576d6c['isPresent']&&!_0x576d6c[_0xed8a56(0xda)])startExitTimer(_0x576d6c);else{if(!_0x576d6c[_0xed8a56(0xd5)])setPresence(_0x576d6c,!![]);}}else{if(_0x24098f['type']===_0xed8a56(0x127)&&_0x1811dc===!![]){if(_0x576d6c['exitTimer'])abortExitTimer(_0x576d6c);if(!_0x576d6c['isPresent']&&_0x576d6c[_0xed8a56(0x100)]===_0xed8a56(0xcf))setPresence(_0x576d6c,!![]);}}return _0x576d6c[_0xed8a56(0xdc)]&&_0x24098f[_0xed8a56(0x115)]===_0xed8a56(0x127)&&_0x1811dc===!![]&&_0x24098f[_0xed8a56(0xfd)]&&_0x576d6c['sendToPythonWrapper']&&_0x576d6c[_0xed8a56(0x108)]('SIMULATE_SIGNAL',{'room':_0x24098f[_0xed8a56(0xfd)]}),_0x5a1667;}function a5_0x6478(_0x55856d,_0x50553e){const _0x12fb6c=a5_0x436a();return a5_0x6478=function(_0x1c3e02,_0x1c43a6){_0x1c3e02=_0x1c3e02-0xcf;let _0x436a88=_0x12fb6c[_0x1c3e02];return _0x436a88;},a5_0x6478(_0x55856d,_0x50553e);}module[a5_0x40a221(0x104)]={'processSensorEvent':processSensorEvent,'getOutsideTemperatureNumeric':getOutsideTemperatureNumeric,'setPresence':setPresence,'abortExitTimer':abortExitTimer,'startExitTimer':startExitTimer};