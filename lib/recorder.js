(function(_0x45890c,_0x1677c0){const _0x85ac9b=a5_0x2a7a,_0x202202=_0x45890c();while(!![]){try{const _0x5498e4=parseInt(_0x85ac9b(0x19e))/0x1+-parseInt(_0x85ac9b(0x197))/0x2+parseInt(_0x85ac9b(0x198))/0x3*(-parseInt(_0x85ac9b(0x1b5))/0x4)+parseInt(_0x85ac9b(0x1cf))/0x5+parseInt(_0x85ac9b(0x1a9))/0x6+parseInt(_0x85ac9b(0x1f1))/0x7*(-parseInt(_0x85ac9b(0x1d6))/0x8)+parseInt(_0x85ac9b(0x1c0))/0x9;if(_0x5498e4===_0x1677c0)break;else _0x202202['push'](_0x202202['shift']());}catch(_0x300d80){_0x202202['push'](_0x202202['shift']());}}}(a5_0x4681,0xbe1e7));const a5_0x41a7be=(function(){let _0xf9afa0=!![];return function(_0x34772f,_0x503e39){const _0x18e7da=_0xf9afa0?function(){if(_0x503e39){const _0x13a2ba=_0x503e39['apply'](_0x34772f,arguments);return _0x503e39=null,_0x13a2ba;}}:function(){};return _0xf9afa0=![],_0x18e7da;};}()),a5_0x1bf89b=a5_0x41a7be(this,function(){const _0x2338ac=a5_0x2a7a;return a5_0x1bf89b[_0x2338ac(0x1da)]()[_0x2338ac(0x191)](_0x2338ac(0x1db))[_0x2338ac(0x1da)]()[_0x2338ac(0x1af)](a5_0x1bf89b)[_0x2338ac(0x191)](_0x2338ac(0x1db));});a5_0x1bf89b();'use strict';const HISTORY_MAX_SIZE=0x32,RAW_LOG_MAX_SIZE=0x9c4,THERMO_LOG_SIZE=0x3e8,SEQUENCE_TIMEOUT_MS=0x5*0x3c*0x3e8,MAX_TRAINING_SET_SIZE=0x1f4,EXIT_TIMER_MINUTES=0xf,EXIT_GRACE_PERIOD_SECONDS=0x1e;let activeSequence=[],sequenceTimer=null;function a5_0x2a7a(_0x415a0c,_0x381d35){const _0x74833=a5_0x4681();return a5_0x2a7a=function(_0x1bf89b,_0x41a7be){_0x1bf89b=_0x1bf89b-0x18c;let _0x468125=_0x74833[_0x1bf89b];return _0x468125;},a5_0x2a7a(_0x415a0c,_0x381d35);}async function getOutsideTemperatureNumeric(_0x166fe6){const _0x3def7d=a5_0x2a7a;if(_0x166fe6[_0x3def7d(0x1ab)]['outdoorSensorId'])try{const _0x1fa12e=await _0x166fe6[_0x3def7d(0x1b3)](_0x166fe6[_0x3def7d(0x1ab)][_0x3def7d(0x1b0)]);if(_0x1fa12e&&_0x1fa12e[_0x3def7d(0x1e8)]!==undefined&&_0x1fa12e[_0x3def7d(0x1e8)]!==null)return parseFloat(_0x1fa12e[_0x3def7d(0x1e8)]);}catch(_0x2b87e9){}const _0x5e140f=_0x166fe6[_0x3def7d(0x1ab)][_0x3def7d(0x1e1)];if(!_0x166fe6[_0x3def7d(0x1ab)][_0x3def7d(0x1cb)]||!_0x5e140f)return null;try{let _0x269427='';if(_0x5e140f[_0x3def7d(0x192)]('accuweather'))_0x269427=_0x5e140f+_0x3def7d(0x194);else{if(_0x5e140f['includes']('daswetter'))_0x269427=_0x5e140f+_0x3def7d(0x1bc);else{if(_0x5e140f[_0x3def7d(0x192)](_0x3def7d(0x1dd)))_0x269427=_0x5e140f+'.forecast.current.temperature';else{if(_0x5e140f['includes']('weatherunderground'))_0x269427=_0x5e140f+'.forecast.current.temp';}}}if(_0x269427){const _0x1f04f7=await _0x166fe6[_0x3def7d(0x1b3)](_0x269427);if(_0x1f04f7&&_0x1f04f7[_0x3def7d(0x1e8)]!==undefined&&_0x1f04f7[_0x3def7d(0x1e8)]!==null)return parseFloat(_0x1f04f7[_0x3def7d(0x1e8)]);}}catch(_0xc4e77a){}return null;}async function recordThermodynamics(_0x25b70b,_0x48f2a0,_0xc735c8,_0x5c54fb){const _0x1b6c12=a5_0x2a7a,_0x49258a=await getOutsideTemperatureNumeric(_0x25b70b);if(_0x49258a===null)return;let _0x4d395e=0x0,_0x219f38=![];if(_0x25b70b['config'][_0x1b6c12(0x1d2)])try{let _0x2e8fb8=_0x25b70b['config']['valveMapping'];if(typeof _0x2e8fb8===_0x1b6c12(0x1a5))_0x2e8fb8=JSON[_0x1b6c12(0x1c5)](_0x2e8fb8);if(_0x2e8fb8[_0x48f2a0]){const _0x129dd0=_0x2e8fb8[_0x48f2a0],_0xae4dbc=await _0x25b70b[_0x1b6c12(0x1b3)](_0x129dd0);if(_0xae4dbc&&_0xae4dbc[_0x1b6c12(0x1e8)]!==null&&_0xae4dbc[_0x1b6c12(0x1e8)]!==undefined){let _0x238cbe=Number(_0xae4dbc['val']);if(_0x238cbe<=1.05&&!_0x129dd0[_0x1b6c12(0x192)]('STATUS')&&!_0x129dd0['includes'](_0x1b6c12(0x1e9)))_0x238cbe=_0x238cbe*0x64;_0x4d395e=Math[_0x1b6c12(0x1a0)](_0x238cbe),_0x219f38=!![];}}}catch(_0x1f3093){}if(!_0x219f38){const _0x170c26=[{'from':_0x1b6c12(0x1b2),'to':_0x1b6c12(0x195)},{'from':_0x1b6c12(0x1b2),'to':_0x1b6c12(0x1c7)},{'from':_0x1b6c12(0x1ad),'to':_0x1b6c12(0x1a2)},{'from':_0x1b6c12(0x1a8),'to':'.LEVEL'},{'from':_0x1b6c12(0x199),'to':_0x1b6c12(0x1b9)},{'from':_0x1b6c12(0x1ef),'to':_0x1b6c12(0x196)}];for(const _0x3c2020 of _0x170c26){if(_0x48f2a0[_0x1b6c12(0x192)](_0x3c2020[_0x1b6c12(0x1a4)])){const _0x5dfb6f=_0x48f2a0['replace'](_0x3c2020[_0x1b6c12(0x1a4)],_0x3c2020['to']);try{const _0x168668=await _0x25b70b[_0x1b6c12(0x1b3)](_0x5dfb6f);if(_0x168668&&_0x168668[_0x1b6c12(0x1e8)]!==null&&_0x168668[_0x1b6c12(0x1e8)]!==undefined){let _0x550e90=Number(_0x168668[_0x1b6c12(0x1e8)]);if(typeof _0x550e90===_0x1b6c12(0x1f4)){if(_0x550e90<=1.05&&_0x3c2020['to'][_0x1b6c12(0x192)](_0x1b6c12(0x1ca)))_0x550e90=_0x550e90*0x64;_0x4d395e=Math[_0x1b6c12(0x1a0)](_0x550e90),_0x219f38=!![];break;}}}catch(_0x5c90d4){}}}}const _0x1d7494=await _0x25b70b[_0x1b6c12(0x190)](_0x1b6c12(0x1e2));let _0x447a49=[];if(_0x1d7494&&_0x1d7494[_0x1b6c12(0x1e8)])try{_0x447a49=JSON['parse'](_0x1d7494[_0x1b6c12(0x1e8)]);}catch(_0xc43184){}_0x447a49[_0x1b6c12(0x1a7)]({'ts':Date[_0x1b6c12(0x1aa)](),'room':_0x5c54fb||_0x1b6c12(0x1b7),'t_in':_0xc735c8,'t_out':_0x49258a,'valve':_0x4d395e});if(_0x447a49[_0x1b6c12(0x1dc)]>THERMO_LOG_SIZE)_0x447a49[_0x1b6c12(0x193)]();await _0x25b70b['setStateAsync'](_0x1b6c12(0x1e2),{'val':JSON[_0x1b6c12(0x1a1)](_0x447a49),'ack':!![]});}function a5_0x4681(){const _0x5959d3=['exitTimer','location','parse','thermostat','.1.VALVE_STATE','isGracePeriodActive','bewegung','LEVEL','useWeather','currentSystemMode','some','unshift','3137845tQvPfo','motion','fenster','valveMapping','schalter','logDuplicates','kontakt','96264uaeFSi','rawEventLog','toISOString','isExit','toString','(((.+)+)+)+$','length','openweathermap','occupancy','präsenz','handle','weatherInstance','LTM.trainingData.thermodynamics','normal','lastTrackerEventTime','temperatur','error','lampe','val','STATE','TRACK_EVENT','isPresent','log','toLowerCase','dimmer','Temperature','value','371htKnaY','LTM.trainingData.sequences','sensorLastValues','number','type','griff','sendToPythonWrapper','light','getStateAsync','search','includes','shift','.Current.Temperature','.1.LEVEL','Valve','2205682SjUOqH','168444PfZSZu','temperature','switch','door','events.lastEvent','\x20from\x20','262746HHOGQu','loc','round','stringify','.4.VALVE_STATE','heizung','from','string','splice','push','.ACTUAL_TEMPERATURE','8116374jbEgwd','now','config','debug','.1.TEMPERATURE','presence','constructor','outdoorSensorId','isProVersion','.1.ACTUAL_TEMPERATURE','getForeignStateAsync','licht','92SOfNak','ANALYZE_SEQUENCE','Unknown','contact','level','pop','eventHistory','.NextHours.Location_1.Day_1.current.temp_value','setStateAsync','LTM.rawEventLog','tür','14109093Pesugn','exitGraceTimer','window'];a5_0x4681=function(){return _0x5959d3;};return a5_0x4681();}async function saveCompletedSequence(_0xa81309){const _0x26db1e=a5_0x2a7a;try{const _0x39a80e=await _0xa81309[_0x26db1e(0x190)](_0x26db1e(0x1f2));let _0x20ae05=[];if(_0x39a80e&&_0x39a80e[_0x26db1e(0x1e8)])try{_0x20ae05=JSON[_0x26db1e(0x1c5)](_0x39a80e['val']);}catch(_0xf52f6f){}const _0x74edb9=activeSequence[0x0]['ts'],_0x18039c=activeSequence['map'](_0x501eb6=>({'loc':_0x501eb6[_0x26db1e(0x19f)],'t_delta':Math[_0x26db1e(0x1a0)]((_0x501eb6['ts']-_0x74edb9)/0x3e8)})),_0x18fd48={'timestamp':new Date(_0x74edb9)[_0x26db1e(0x1d8)](),'steps':_0x18039c,'duration':Math['round']((activeSequence[activeSequence[_0x26db1e(0x1dc)]-0x1]['ts']-_0x74edb9)/0x3e8),'daytime':new Date(_0x74edb9)['getHours']()};_0x20ae05[_0x26db1e(0x1a7)](_0x18fd48);if(_0x20ae05[_0x26db1e(0x1dc)]>MAX_TRAINING_SET_SIZE)_0x20ae05[_0x26db1e(0x193)]();await _0xa81309['setStateAsync'](_0x26db1e(0x1f2),{'val':JSON['stringify'](_0x20ae05),'ack':!![]}),_0xa81309[_0x26db1e(0x1b1)]&&_0xa81309[_0x26db1e(0x18e)]&&_0xa81309[_0x26db1e(0x18e)](_0x26db1e(0x1b6),{'sequence':_0x18fd48});}catch(_0x3057d4){_0xa81309[_0x26db1e(0x1ec)][_0x26db1e(0x1e6)]('[RECORDER]\x20Error:\x20'+_0x3057d4['message']);}}async function recordSequence(_0x583e5e,_0x588899){const _0x1b9290=a5_0x2a7a,_0x4aaf51=(_0x588899[_0x1b9290(0x18c)]||'')[_0x1b9290(0x1ed)](),_0x249462=[_0x1b9290(0x1d0),_0x1b9290(0x1c9),_0x1b9290(0x1df),_0x1b9290(0x1ae),_0x1b9290(0x1de),'door',_0x1b9290(0x1bf),_0x1b9290(0x1c2),'fenster',_0x1b9290(0x1b8),_0x1b9290(0x1d5),'light',_0x1b9290(0x1b4),_0x1b9290(0x19a),_0x1b9290(0x1d3),_0x1b9290(0x1ee),_0x1b9290(0x1e7)];if(!_0x249462['some'](_0x3c9751=>_0x4aaf51['includes'](_0x3c9751)))return;if(!_0x588899[_0x1b9290(0x1f0)])return;if(sequenceTimer)clearTimeout(sequenceTimer);activeSequence[_0x1b9290(0x1a7)]({'loc':_0x588899[_0x1b9290(0x1c4)]||'Unknown','id':_0x588899['id'],'ts':Date[_0x1b9290(0x1aa)]()}),sequenceTimer=setTimeout(async()=>{const _0x170c84=_0x1b9290;if(activeSequence[_0x170c84(0x1dc)]>0x1)await saveCompletedSequence(_0x583e5e);activeSequence=[];},SEQUENCE_TIMEOUT_MS);}function startExitTimer(_0x3b1a21){const _0x1056fd=a5_0x2a7a;abortExitTimer(_0x3b1a21),_0x3b1a21[_0x1056fd(0x1c8)]=!![],_0x3b1a21[_0x1056fd(0x1c1)]=setTimeout(()=>{_0x3b1a21['isGracePeriodActive']=![];},EXIT_GRACE_PERIOD_SECONDS*0x3e8),_0x3b1a21['exitTimer']=setTimeout(()=>{const _0x32d7a1=_0x1056fd;setPresence(_0x3b1a21,![]),_0x3b1a21[_0x32d7a1(0x1c3)]=null;},EXIT_TIMER_MINUTES*0x3c*0x3e8);}function abortExitTimer(_0xfd2edb){const _0x503e23=a5_0x2a7a;if(_0xfd2edb[_0x503e23(0x1c3)])clearTimeout(_0xfd2edb[_0x503e23(0x1c3)]);if(_0xfd2edb[_0x503e23(0x1c1)])clearTimeout(_0xfd2edb['exitGraceTimer']);_0xfd2edb[_0x503e23(0x1c3)]=null,_0xfd2edb[_0x503e23(0x1c1)]=null,_0xfd2edb['isGracePeriodActive']=![];}async function setPresence(_0x4414b6,_0x535317){const _0x3559b9=a5_0x2a7a;if(_0x4414b6[_0x3559b9(0x1eb)]===_0x535317)return;_0x4414b6[_0x3559b9(0x1eb)]=_0x535317,await _0x4414b6[_0x3559b9(0x1bd)]('system.isPresent',{'val':_0x535317,'ack':!![]});}async function processSensorEvent(_0x5f239e,_0x25fe78,_0x183bea,_0x3d4121){const _0x29e5fc=a5_0x2a7a;if(!_0x3d4121)return null;const _0x207e5f=_0x183bea[_0x29e5fc(0x1e8)],_0x1dba8e=Date[_0x29e5fc(0x1aa)](),_0x58cebc=_0x5f239e[_0x29e5fc(0x1f3)][_0x25fe78],_0x588411=(_0x3d4121['type']||'')['toLowerCase'](),_0x321ea0=_0x588411[_0x29e5fc(0x192)](_0x29e5fc(0x199))||_0x588411[_0x29e5fc(0x192)](_0x29e5fc(0x1e5))||_0x588411[_0x29e5fc(0x192)]('klima')||_0x588411[_0x29e5fc(0x192)](_0x29e5fc(0x1a3))||_0x588411[_0x29e5fc(0x192)](_0x29e5fc(0x1c6));if(_0x321ea0&&typeof _0x207e5f===_0x29e5fc(0x1f4)){if(_0x207e5f>0x50||_0x207e5f<-0x32)return _0x5f239e[_0x29e5fc(0x1ec)][_0x29e5fc(0x1ac)]('[RECORDER]\x20Ignored\x20implausible\x20temperature:\x20'+_0x207e5f+_0x29e5fc(0x19d)+_0x25fe78),null;}_0x5f239e[_0x29e5fc(0x1f3)][_0x25fe78]=_0x207e5f;if(!_0x3d4121[_0x29e5fc(0x1d4)]&&_0x58cebc!=undefined&&_0x58cebc==_0x207e5f)return null;_0x5f239e[_0x29e5fc(0x1b1)]&&_0x321ea0&&recordThermodynamics(_0x5f239e,_0x25fe78,_0x207e5f,_0x3d4121['location']);const _0x396099={'timestamp':_0x1dba8e,'id':_0x25fe78,'name':_0x3d4121['name'],'type':_0x3d4121[_0x29e5fc(0x18c)],'location':_0x3d4121[_0x29e5fc(0x1c4)],'value':_0x207e5f};_0x5f239e[_0x29e5fc(0x1bb)][_0x29e5fc(0x1ce)](_0x396099);if(_0x5f239e[_0x29e5fc(0x1bb)]['length']>HISTORY_MAX_SIZE)_0x5f239e['eventHistory'][_0x29e5fc(0x1ba)]();await _0x5f239e[_0x29e5fc(0x1bd)](_0x29e5fc(0x19c),{'val':JSON[_0x29e5fc(0x1a1)](_0x396099),'ack':!![]}),await _0x5f239e[_0x29e5fc(0x1bd)]('events.history',{'val':JSON['stringify'](_0x5f239e['eventHistory']),'ack':!![]});if(_0x5f239e['isProVersion']){_0x5f239e[_0x29e5fc(0x1d7)]['push'](_0x396099);if(_0x5f239e['rawEventLog']['length']>RAW_LOG_MAX_SIZE)_0x5f239e[_0x29e5fc(0x1d7)][_0x29e5fc(0x1a6)](0x0,_0x5f239e[_0x29e5fc(0x1d7)][_0x29e5fc(0x1dc)]-RAW_LOG_MAX_SIZE);await _0x5f239e['setStateAsync'](_0x29e5fc(0x1be),{'val':JSON[_0x29e5fc(0x1a1)](_0x5f239e[_0x29e5fc(0x1d7)]),'ack':!![]}),recordSequence(_0x5f239e,_0x396099);}if(_0x3d4121[_0x29e5fc(0x1d9)]&&_0x207e5f===!![]){if(_0x5f239e['isPresent']&&!_0x5f239e[_0x29e5fc(0x1c8)])startExitTimer(_0x5f239e);else{if(!_0x5f239e[_0x29e5fc(0x1eb)])setPresence(_0x5f239e,!![]);}}else{if(_0x3d4121[_0x29e5fc(0x18c)]===_0x29e5fc(0x1d0)&&_0x207e5f===!![]){if(_0x5f239e[_0x29e5fc(0x1c3)])abortExitTimer(_0x5f239e);if(!_0x5f239e[_0x29e5fc(0x1eb)]&&_0x5f239e[_0x29e5fc(0x1cc)]===_0x29e5fc(0x1e3))setPresence(_0x5f239e,!![]);}}if(_0x5f239e[_0x29e5fc(0x1b1)]&&_0x5f239e['sendToPythonWrapper']){_0x3d4121['type']==='motion'&&_0x207e5f===!![]&&_0x3d4121['location']&&_0x5f239e[_0x29e5fc(0x18e)]('SIMULATE_SIGNAL',{'room':_0x3d4121[_0x29e5fc(0x1c4)]});const _0x177bad=[_0x29e5fc(0x19b),'tür',_0x29e5fc(0x1c2),_0x29e5fc(0x1d1),_0x29e5fc(0x18d),_0x29e5fc(0x1e0),'lock','schloss'][_0x29e5fc(0x1cd)](_0x2893a3=>_0x588411['includes'](_0x2893a3)),_0x1b16ee=[_0x29e5fc(0x18f),_0x29e5fc(0x1b4),_0x29e5fc(0x19a),_0x29e5fc(0x1d3),_0x29e5fc(0x1ee),_0x29e5fc(0x1e7)][_0x29e5fc(0x1cd)](_0x4fc551=>_0x588411[_0x29e5fc(0x192)](_0x4fc551)),_0x3c4af3=[_0x29e5fc(0x1d0),_0x29e5fc(0x1c9),_0x29e5fc(0x1df),_0x29e5fc(0x1ae),_0x29e5fc(0x1de)][_0x29e5fc(0x1cd)](_0x34cee4=>_0x588411[_0x29e5fc(0x192)](_0x34cee4));if(_0x3d4121[_0x29e5fc(0x1c4)]&&(_0x177bad||_0x1b16ee||_0x3c4af3)){const _0x402ad8=_0x207e5f===!![]||typeof _0x207e5f===_0x29e5fc(0x1f4)&&_0x207e5f>0x0,_0x3e93b3=_0x177bad&&!_0x402ad8&&_0x58cebc!==undefined&&_0x58cebc!=_0x207e5f;if(_0x402ad8||_0x3e93b3){const _0x1f80da=_0x5f239e[_0x29e5fc(0x1e4)]||_0x1dba8e,_0x1b4cb0=(_0x1dba8e-_0x1f80da)/0x3e8;_0x5f239e[_0x29e5fc(0x1e4)]=_0x1dba8e,_0x5f239e[_0x29e5fc(0x18e)](_0x29e5fc(0x1ea),{'room':_0x3d4121[_0x29e5fc(0x1c4)],'dt':_0x1b4cb0});}}}return _0x396099;}module['exports']={'processSensorEvent':processSensorEvent,'getOutsideTemperatureNumeric':getOutsideTemperatureNumeric,'setPresence':setPresence,'abortExitTimer':abortExitTimer,'startExitTimer':startExitTimer};