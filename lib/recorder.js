const a5_0x54c343=a5_0x256b;(function(_0x26eebd,_0x4e4f5e){const _0xf89817=a5_0x256b,_0x16e00c=_0x26eebd();while(!![]){try{const _0x370cfb=parseInt(_0xf89817(0x1de))/0x1*(parseInt(_0xf89817(0x18d))/0x2)+-parseInt(_0xf89817(0x197))/0x3+-parseInt(_0xf89817(0x1ab))/0x4*(parseInt(_0xf89817(0x199))/0x5)+parseInt(_0xf89817(0x189))/0x6*(parseInt(_0xf89817(0x18b))/0x7)+-parseInt(_0xf89817(0x1cb))/0x8*(parseInt(_0xf89817(0x1ae))/0x9)+-parseInt(_0xf89817(0x1a8))/0xa+parseInt(_0xf89817(0x1c9))/0xb*(parseInt(_0xf89817(0x1e7))/0xc);if(_0x370cfb===_0x4e4f5e)break;else _0x16e00c['push'](_0x16e00c['shift']());}catch(_0x249f66){_0x16e00c['push'](_0x16e00c['shift']());}}}(a5_0x253e,0x643a3));function a5_0x256b(_0x2cd82a,_0x2450e8){const _0x1583e5=a5_0x253e();return a5_0x256b=function(_0x545911,_0x39ba60){_0x545911=_0x545911-0x17a;let _0x253e77=_0x1583e5[_0x545911];return _0x253e77;},a5_0x256b(_0x2cd82a,_0x2450e8);}const a5_0x39ba60=(function(){let _0x23d07d=!![];return function(_0x37bd2f,_0x11eabe){const _0x10dac9=_0x23d07d?function(){const _0x2b59d8=a5_0x256b;if(_0x11eabe){const _0x1dbe13=_0x11eabe[_0x2b59d8(0x1b8)](_0x37bd2f,arguments);return _0x11eabe=null,_0x1dbe13;}}:function(){};return _0x23d07d=![],_0x10dac9;};}()),a5_0x545911=a5_0x39ba60(this,function(){const _0x3bb05d=a5_0x256b;return a5_0x545911[_0x3bb05d(0x1a1)]()[_0x3bb05d(0x1c0)]('(((.+)+)+)+$')[_0x3bb05d(0x1a1)]()[_0x3bb05d(0x198)](a5_0x545911)[_0x3bb05d(0x1c0)](_0x3bb05d(0x1a5));});a5_0x545911();'use strict';const HISTORY_MAX_SIZE=0x32,RAW_LOG_MAX_SIZE=0x9c4,THERMO_LOG_SIZE=0x3e8,SEQUENCE_TIMEOUT_MS=0x5*0x3c*0x3e8,MAX_TRAINING_SET_SIZE=0x1f4,EXIT_TIMER_MINUTES=0xf,EXIT_GRACE_PERIOD_SECONDS=0x1e;let activeSequence=[],sequenceTimer=null;async function getOutsideTemperatureNumeric(_0x37c098){const _0x502316=a5_0x256b;if(_0x37c098['config'][_0x502316(0x19f)])try{const _0xf3ae95=await _0x37c098[_0x502316(0x1ca)](_0x37c098[_0x502316(0x1da)][_0x502316(0x19f)]);if(_0xf3ae95&&_0xf3ae95[_0x502316(0x1dc)]!==undefined&&_0xf3ae95['val']!==null)return parseFloat(_0xf3ae95[_0x502316(0x1dc)]);}catch(_0x2d7eb5){}const _0x28eaf7=_0x37c098[_0x502316(0x1da)][_0x502316(0x193)];if(!_0x37c098[_0x502316(0x1da)][_0x502316(0x1c3)]||!_0x28eaf7)return null;try{let _0x59772d='';if(_0x28eaf7[_0x502316(0x196)]('accuweather'))_0x59772d=_0x28eaf7+_0x502316(0x1b1);else{if(_0x28eaf7[_0x502316(0x196)](_0x502316(0x1e3)))_0x59772d=_0x28eaf7+_0x502316(0x1cf);else{if(_0x28eaf7[_0x502316(0x196)]('openweathermap'))_0x59772d=_0x28eaf7+_0x502316(0x1a6);else{if(_0x28eaf7[_0x502316(0x196)](_0x502316(0x1b7)))_0x59772d=_0x28eaf7+_0x502316(0x1d3);}}}if(_0x59772d){const _0x337a61=await _0x37c098['getForeignStateAsync'](_0x59772d);if(_0x337a61&&_0x337a61['val']!==undefined&&_0x337a61['val']!==null)return parseFloat(_0x337a61['val']);}}catch(_0x109e57){}return null;}async function recordThermodynamics(_0x2ad2d2,_0x46f585,_0x3eeabc,_0x259953){const _0x27bb81=a5_0x256b,_0x77b69e=await getOutsideTemperatureNumeric(_0x2ad2d2);if(_0x77b69e===null)return;let _0x554215=0x0,_0x1b3249=![];if(_0x2ad2d2[_0x27bb81(0x1da)][_0x27bb81(0x1e1)])try{let _0x1229b3=_0x2ad2d2[_0x27bb81(0x1da)][_0x27bb81(0x1e1)];if(typeof _0x1229b3===_0x27bb81(0x1c6))_0x1229b3=JSON['parse'](_0x1229b3);if(_0x1229b3[_0x46f585]){const _0x570af5=_0x1229b3[_0x46f585],_0xfb866c=await _0x2ad2d2[_0x27bb81(0x1ca)](_0x570af5);if(_0xfb866c&&_0xfb866c[_0x27bb81(0x1dc)]!==null&&_0xfb866c[_0x27bb81(0x1dc)]!==undefined){let _0x24f497=Number(_0xfb866c[_0x27bb81(0x1dc)]);if(_0x24f497<=1.05&&!_0x570af5[_0x27bb81(0x196)](_0x27bb81(0x1ce))&&!_0x570af5[_0x27bb81(0x196)](_0x27bb81(0x1dd)))_0x24f497=_0x24f497*0x64;_0x554215=Math[_0x27bb81(0x1e4)](_0x24f497),_0x1b3249=!![];}}}catch(_0x58c85f){}if(!_0x1b3249){const _0x391922=[{'from':_0x27bb81(0x19d),'to':_0x27bb81(0x1d8)},{'from':'.1.ACTUAL_TEMPERATURE','to':_0x27bb81(0x17b)},{'from':_0x27bb81(0x1aa),'to':_0x27bb81(0x180)},{'from':'.ACTUAL_TEMPERATURE','to':_0x27bb81(0x17d)},{'from':_0x27bb81(0x185),'to':'level'},{'from':_0x27bb81(0x1cd),'to':_0x27bb81(0x17a)}];for(const _0x1d9f5d of _0x391922){if(_0x46f585[_0x27bb81(0x196)](_0x1d9f5d[_0x27bb81(0x19c)])){const _0x21c135=_0x46f585['replace'](_0x1d9f5d[_0x27bb81(0x19c)],_0x1d9f5d['to']);try{const _0x237256=await _0x2ad2d2['getForeignStateAsync'](_0x21c135);if(_0x237256&&_0x237256[_0x27bb81(0x1dc)]!==null&&_0x237256[_0x27bb81(0x1dc)]!==undefined){let _0x1ff76c=Number(_0x237256[_0x27bb81(0x1dc)]);if(typeof _0x1ff76c==='number'){if(_0x1ff76c<=1.05&&_0x1d9f5d['to']['includes'](_0x27bb81(0x1b4)))_0x1ff76c=_0x1ff76c*0x64;_0x554215=Math['round'](_0x1ff76c),_0x1b3249=!![];break;}}}catch(_0xa43543){}}}}const _0x155129=await _0x2ad2d2[_0x27bb81(0x1d2)](_0x27bb81(0x1a2));let _0x432c31=[];if(_0x155129&&_0x155129[_0x27bb81(0x1dc)])try{_0x432c31=JSON['parse'](_0x155129[_0x27bb81(0x1dc)]);}catch(_0x244546){}_0x432c31['push']({'ts':Date['now'](),'room':_0x259953||_0x27bb81(0x1b0),'t_in':_0x3eeabc,'t_out':_0x77b69e,'valve':_0x554215});if(_0x432c31['length']>THERMO_LOG_SIZE)_0x432c31['shift']();await _0x2ad2d2['setStateAsync'](_0x27bb81(0x1a2),{'val':JSON[_0x27bb81(0x190)](_0x432c31),'ack':!![]});}async function saveCompletedSequence(_0x4e3cd4){const _0x19ac65=a5_0x256b;try{const _0x436c19=await _0x4e3cd4[_0x19ac65(0x1d2)](_0x19ac65(0x18c));let _0x1d8743=[];if(_0x436c19&&_0x436c19[_0x19ac65(0x1dc)])try{_0x1d8743=JSON[_0x19ac65(0x1d6)](_0x436c19['val']);}catch(_0x4f53d5){}const _0x4a6897=activeSequence[0x0]['ts'],_0x3d455e=activeSequence[_0x19ac65(0x1c8)](_0x3fb9db=>({'loc':_0x3fb9db['loc'],'t_delta':Math['round']((_0x3fb9db['ts']-_0x4a6897)/0x3e8)})),_0x593e23={'timestamp':new Date(_0x4a6897)[_0x19ac65(0x1ba)](),'steps':_0x3d455e,'duration':Math[_0x19ac65(0x1e4)]((activeSequence[activeSequence['length']-0x1]['ts']-_0x4a6897)/0x3e8),'daytime':new Date(_0x4a6897)[_0x19ac65(0x1b3)]()};_0x1d8743[_0x19ac65(0x19e)](_0x593e23);if(_0x1d8743['length']>MAX_TRAINING_SET_SIZE)_0x1d8743[_0x19ac65(0x188)]();await _0x4e3cd4['setStateAsync'](_0x19ac65(0x18c),{'val':JSON['stringify'](_0x1d8743),'ack':!![]}),_0x4e3cd4[_0x19ac65(0x1d7)]&&_0x4e3cd4[_0x19ac65(0x17e)]&&_0x4e3cd4[_0x19ac65(0x17e)]('ANALYZE_SEQUENCE',{'sequence':_0x593e23});}catch(_0x1b5324){_0x4e3cd4[_0x19ac65(0x1cc)][_0x19ac65(0x17c)](_0x19ac65(0x187)+_0x1b5324[_0x19ac65(0x182)]);}}async function recordSequence(_0x107014,_0x423f00){const _0x21837d=a5_0x256b,_0x25949e=(_0x423f00[_0x21837d(0x17f)]||'')[_0x21837d(0x1b2)](),_0x56a8fe=[_0x21837d(0x1a7),'bewegung','präsenz','presence','occupancy',_0x21837d(0x1a9),_0x21837d(0x1d4),'window',_0x21837d(0x194),_0x21837d(0x19b),_0x21837d(0x1be),'light',_0x21837d(0x186),_0x21837d(0x18e),_0x21837d(0x1c2),_0x21837d(0x192),_0x21837d(0x1db)];if(!_0x56a8fe['some'](_0x191e79=>_0x25949e['includes'](_0x191e79)))return;if(!_0x423f00['value'])return;if(sequenceTimer)clearTimeout(sequenceTimer);activeSequence[_0x21837d(0x19e)]({'loc':_0x423f00[_0x21837d(0x18f)]||_0x21837d(0x1b0),'id':_0x423f00['id'],'ts':Date['now']()}),sequenceTimer=setTimeout(async()=>{const _0x2a1002=_0x21837d;if(activeSequence[_0x2a1002(0x1b5)]>0x1)await saveCompletedSequence(_0x107014);activeSequence=[];},SEQUENCE_TIMEOUT_MS);}function a5_0x253e(){const _0x53a6aa=['useWeather','eventHistory','events.history','string','exports','map','908303YxGwOG','getForeignStateAsync','145528DHjLIl','log','Temperature','STATUS','.NextHours.Location_1.Day_1.current.temp_value','splice','thermostat','getStateAsync','.forecast.current.temp','tür','some','parse','isProVersion','.1.LEVEL','rawEventLog','config','lampe','val','STATE','785357berjss','fill','unshift','valveMapping','exitGraceTimer','daswetter','round','system.isPresent','analysis.health.todayVector','48kpqNvD','exitTimer','sensorLastValues','normal','Valve','.1.VALVE_STATE','error','.LEVEL','sendToPythonWrapper','type','.4.VALVE_STATE','occupancy','message','light','presence','temperature','licht','[RECORDER]\x20Error:\x20','shift','2157042hBcXhl','number','7mBJRoy','LTM.trainingData.sequences','2qsLXcK','switch','location','stringify','isPresent','dimmer','weatherInstance','fenster','LTM.rawEventLog','includes','373242KCeUKc','constructor','14840UfJHPA','SIMULATE_SIGNAL','contact','from','.1.ACTUAL_TEMPERATURE','push','outdoorSensorId','pop','toString','LTM.trainingData.thermodynamics','handle','\x20from\x20','(((.+)+)+)+$','.forecast.current.temperature','motion','6901330ONLATR','door','.1.TEMPERATURE','288nXMqpg','setStateAsync','isGracePeriodActive','18vCreBb','lock','Unknown','.Current.Temperature','toLowerCase','getHours','LEVEL','length','getDate','weatherunderground','apply','currentSystemMode','toISOString','bewegung','präsenz','lastTrackerEventTime','kontakt','griff','search','window','schalter'];a5_0x253e=function(){return _0x53a6aa;};return a5_0x253e();}function startExitTimer(_0x27bb82){const _0x53ef14=a5_0x256b;abortExitTimer(_0x27bb82),_0x27bb82['isGracePeriodActive']=!![],_0x27bb82[_0x53ef14(0x1e2)]=setTimeout(()=>{const _0x5dc3f5=_0x53ef14;_0x27bb82[_0x5dc3f5(0x1ad)]=![];},EXIT_GRACE_PERIOD_SECONDS*0x3e8),_0x27bb82[_0x53ef14(0x1e8)]=setTimeout(()=>{const _0x232c9f=_0x53ef14;setPresence(_0x27bb82,![]),_0x27bb82[_0x232c9f(0x1e8)]=null;},EXIT_TIMER_MINUTES*0x3c*0x3e8);}function abortExitTimer(_0x3d7aab){const _0x3ad72f=a5_0x256b;if(_0x3d7aab['exitTimer'])clearTimeout(_0x3d7aab[_0x3ad72f(0x1e8)]);if(_0x3d7aab[_0x3ad72f(0x1e2)])clearTimeout(_0x3d7aab['exitGraceTimer']);_0x3d7aab[_0x3ad72f(0x1e8)]=null,_0x3d7aab[_0x3ad72f(0x1e2)]=null,_0x3d7aab['isGracePeriodActive']=![];}async function setPresence(_0x187118,_0x2c76cf){const _0x2d3d9b=a5_0x256b;if(_0x187118[_0x2d3d9b(0x191)]===_0x2c76cf)return;_0x187118[_0x2d3d9b(0x191)]=_0x2c76cf,await _0x187118[_0x2d3d9b(0x1ac)](_0x2d3d9b(0x1e5),{'val':_0x2c76cf,'ack':!![]});}async function updateHourlyActivity(_0x30214b){const _0x96adc7=a5_0x256b;let _0x2ad374=new Array(0x18)['fill'](0x0),_0x20f5f5=0x0;try{const _0x350ae7=await _0x30214b['getStateAsync'](_0x96adc7(0x1e6));_0x350ae7&&_0x350ae7[_0x96adc7(0x1dc)]&&(_0x2ad374=JSON[_0x96adc7(0x1d6)](_0x350ae7[_0x96adc7(0x1dc)]),_0x20f5f5=_0x350ae7['ts']);}catch(_0x3233a4){}const _0x130b34=new Date(_0x20f5f5),_0x3069c9=new Date();_0x130b34[_0x96adc7(0x1b6)]()!==_0x3069c9[_0x96adc7(0x1b6)]()&&(_0x2ad374=new Array(0x18)[_0x96adc7(0x1df)](0x0));const _0x2623e4=_0x3069c9[_0x96adc7(0x1b3)]();if(_0x2ad374[_0x2623e4]===undefined)_0x2ad374[_0x2623e4]=0x0;_0x2ad374[_0x2623e4]++,await _0x30214b[_0x96adc7(0x1ac)](_0x96adc7(0x1e6),{'val':JSON[_0x96adc7(0x190)](_0x2ad374),'ack':!![]});}async function processSensorEvent(_0x3c864c,_0xcdb7f9,_0x3e6f4b,_0x5cc35d){const _0x1de949=a5_0x256b;if(!_0x5cc35d)return null;const _0x29335c=_0x3e6f4b[_0x1de949(0x1dc)],_0x3657e0=Date['now'](),_0x266676=_0x3c864c[_0x1de949(0x1e9)][_0xcdb7f9],_0x33ff41=(_0x5cc35d[_0x1de949(0x17f)]||'')['toLowerCase'](),_0x18e5e8=_0x33ff41[_0x1de949(0x196)]('temperature')||_0x33ff41[_0x1de949(0x196)]('temperatur')||_0x33ff41[_0x1de949(0x196)]('klima')||_0x33ff41[_0x1de949(0x196)]('heizung')||_0x33ff41['includes'](_0x1de949(0x1d1));if(_0x18e5e8&&typeof _0x29335c==='number'){if(_0x29335c>0x50||_0x29335c<-0x32)return _0x3c864c[_0x1de949(0x1cc)]['debug']('[RECORDER]\x20Ignored\x20implausible\x20temperature:\x20'+_0x29335c+_0x1de949(0x1a4)+_0xcdb7f9),null;}_0x3c864c['sensorLastValues'][_0xcdb7f9]=_0x29335c;if(!_0x5cc35d['logDuplicates']&&_0x266676!=undefined&&_0x266676==_0x29335c)return null;_0x3c864c[_0x1de949(0x1d7)]&&_0x18e5e8&&recordThermodynamics(_0x3c864c,_0xcdb7f9,_0x29335c,_0x5cc35d[_0x1de949(0x18f)]);const _0x49b5cd={'timestamp':_0x3657e0,'id':_0xcdb7f9,'name':_0x5cc35d['name'],'type':_0x5cc35d['type'],'location':_0x5cc35d[_0x1de949(0x18f)],'value':_0x29335c};_0x3c864c[_0x1de949(0x1c4)][_0x1de949(0x1e0)](_0x49b5cd);if(_0x3c864c[_0x1de949(0x1c4)][_0x1de949(0x1b5)]>HISTORY_MAX_SIZE)_0x3c864c[_0x1de949(0x1c4)][_0x1de949(0x1a0)]();await _0x3c864c['setStateAsync']('events.lastEvent',{'val':JSON[_0x1de949(0x190)](_0x49b5cd),'ack':!![]}),await _0x3c864c[_0x1de949(0x1ac)](_0x1de949(0x1c5),{'val':JSON[_0x1de949(0x190)](_0x3c864c['eventHistory']),'ack':!![]}),await updateHourlyActivity(_0x3c864c);if(_0x3c864c['isProVersion']){_0x3c864c['rawEventLog'][_0x1de949(0x19e)](_0x49b5cd);if(_0x3c864c[_0x1de949(0x1d9)][_0x1de949(0x1b5)]>RAW_LOG_MAX_SIZE)_0x3c864c[_0x1de949(0x1d9)][_0x1de949(0x1d0)](0x0,_0x3c864c[_0x1de949(0x1d9)][_0x1de949(0x1b5)]-RAW_LOG_MAX_SIZE);await _0x3c864c[_0x1de949(0x1ac)](_0x1de949(0x195),{'val':JSON['stringify'](_0x3c864c[_0x1de949(0x1d9)]),'ack':!![]}),recordSequence(_0x3c864c,_0x49b5cd);}if(_0x5cc35d['isExit']&&_0x29335c===!![]){if(_0x3c864c[_0x1de949(0x191)]&&!_0x3c864c[_0x1de949(0x1ad)])startExitTimer(_0x3c864c);else{if(!_0x3c864c[_0x1de949(0x191)])setPresence(_0x3c864c,!![]);}}else{if(_0x5cc35d[_0x1de949(0x17f)]==='motion'&&_0x29335c===!![]){if(_0x3c864c['exitTimer'])abortExitTimer(_0x3c864c);if(!_0x3c864c[_0x1de949(0x191)]&&_0x3c864c[_0x1de949(0x1b9)]===_0x1de949(0x1ea))setPresence(_0x3c864c,!![]);}}if(_0x3c864c[_0x1de949(0x1d7)]&&_0x3c864c[_0x1de949(0x17e)]){_0x5cc35d[_0x1de949(0x17f)]===_0x1de949(0x1a7)&&_0x29335c===!![]&&_0x5cc35d[_0x1de949(0x18f)]&&_0x3c864c[_0x1de949(0x17e)](_0x1de949(0x19a),{'room':_0x5cc35d['location']});const _0x6a20b6=['door',_0x1de949(0x1d4),_0x1de949(0x1c1),_0x1de949(0x194),_0x1de949(0x1bf),_0x1de949(0x1a3),_0x1de949(0x1af),'schloss']['some'](_0x4c7389=>_0x33ff41['includes'](_0x4c7389)),_0x1a5844=[_0x1de949(0x183),'licht','switch',_0x1de949(0x1c2),'dimmer',_0x1de949(0x1db)][_0x1de949(0x1d5)](_0x324875=>_0x33ff41[_0x1de949(0x196)](_0x324875)),_0x4467c9=[_0x1de949(0x1a7),_0x1de949(0x1bb),_0x1de949(0x1bc),_0x1de949(0x184),_0x1de949(0x181)][_0x1de949(0x1d5)](_0x28d093=>_0x33ff41[_0x1de949(0x196)](_0x28d093));if(_0x5cc35d['location']&&(_0x6a20b6||_0x1a5844||_0x4467c9)){const _0x537169=_0x29335c===!![]||typeof _0x29335c===_0x1de949(0x18a)&&_0x29335c>0x0,_0x4291b2=_0x6a20b6&&!_0x537169&&_0x266676!==undefined&&_0x266676!=_0x29335c;if(_0x537169||_0x4291b2){const _0x48950d=_0x3c864c[_0x1de949(0x1bd)]||_0x3657e0,_0x411ade=(_0x3657e0-_0x48950d)/0x3e8;_0x3c864c['lastTrackerEventTime']=_0x3657e0,_0x3c864c['sendToPythonWrapper']('TRACK_EVENT',{'room':_0x5cc35d[_0x1de949(0x18f)],'dt':_0x411ade});}}}return _0x49b5cd;}module[a5_0x54c343(0x1c7)]={'processSensorEvent':processSensorEvent,'getOutsideTemperatureNumeric':getOutsideTemperatureNumeric,'setPresence':setPresence,'abortExitTimer':abortExitTimer,'startExitTimer':startExitTimer};