const a5_0x1bae18=a5_0x2884;(function(_0x240692,_0x26fdf3){const _0x295985=a5_0x2884,_0x1591e0=_0x240692();while(!![]){try{const _0x30d197=parseInt(_0x295985(0xc1))/0x1*(-parseInt(_0x295985(0x9d))/0x2)+-parseInt(_0x295985(0x77))/0x3+parseInt(_0x295985(0xd1))/0x4*(parseInt(_0x295985(0x85))/0x5)+-parseInt(_0x295985(0xda))/0x6*(parseInt(_0x295985(0xdf))/0x7)+-parseInt(_0x295985(0x97))/0x8*(parseInt(_0x295985(0xd0))/0x9)+parseInt(_0x295985(0xdd))/0xa+parseInt(_0x295985(0xc6))/0xb;if(_0x30d197===_0x26fdf3)break;else _0x1591e0['push'](_0x1591e0['shift']());}catch(_0x174e79){_0x1591e0['push'](_0x1591e0['shift']());}}}(a5_0x2faf,0xb174f));const a5_0x35172e=(function(){let _0x23c744=!![];return function(_0x23254e,_0x55626f){const _0x5d02fc=_0x23c744?function(){const _0x4aba04=a5_0x2884;if(_0x55626f){const _0x32ebc1=_0x55626f[_0x4aba04(0xa6)](_0x23254e,arguments);return _0x55626f=null,_0x32ebc1;}}:function(){};return _0x23c744=![],_0x5d02fc;};}()),a5_0x1bf71b=a5_0x35172e(this,function(){const _0x39f566=a5_0x2884;return a5_0x1bf71b['toString']()[_0x39f566(0x99)](_0x39f566(0xe4))[_0x39f566(0x9a)]()[_0x39f566(0xd2)](a5_0x1bf71b)[_0x39f566(0x99)](_0x39f566(0xe4));});function a5_0x2faf(){const _0x2b0a10=['map','exports','4fIEruC','TRACK_EVENT','error','\x20from\x20','push','43342706GQkXAH','motion','occupancy','getForeignStateAsync','Temperature','.1.ACTUAL_TEMPERATURE','griff','config','LTM.trainingData.sequences','lock','1224JYuOaJ','4yeQwbR','constructor','value','ANALYZE_SEQUENCE','fenster','handle','parse','sensorLastValues','LEVEL','6DMKWgi','exitGraceTimer','SIMULATE_SIGNAL','3673830HwcnEf','isProVersion','8777741SBtVEy','getStateAsync','rawEventLog','outdoorSensorId','LTM.rawEventLog','(((.+)+)+)+$','unshift','toISOString','temperature','splice','openweathermap','präsenz','from','[RECORDER]\x20Ignored\x20implausible\x20temperature:\x20','3770472YFknXF','eventHistory','isGracePeriodActive','.ACTUAL_TEMPERATURE','useWeather','presence','replace','valveMapping','debug','schalter','door','toLowerCase','events.history','.forecast.current.temp','6717205oIscLJ','[RECORDER]\x20Error:\x20','isPresent','Valve','length','heizung','contact','getHours','sendToPythonWrapper','licht','now','shift','window','weatherInstance','name','dimmer','.LEVEL','thermostat','70248WgkdrY','LTM.trainingData.thermodynamics','search','toString','some','includes','609602OOJorI','bewegung','.1.VALVE_STATE','number','level','loc','location','.1.LEVEL','tür','apply','pop','Unknown','system.isPresent','setStateAsync','daswetter','events.lastEvent','lastTrackerEventTime','normal','.forecast.current.temperature','STATE','type','switch','temperatur','.1.TEMPERATURE','exitTimer','accuweather','stringify','round','val','schloss','lampe','light','string','currentSystemMode'];a5_0x2faf=function(){return _0x2b0a10;};return a5_0x2faf();}a5_0x1bf71b();'use strict';const HISTORY_MAX_SIZE=0x32,RAW_LOG_MAX_SIZE=0x9c4,THERMO_LOG_SIZE=0x3e8,SEQUENCE_TIMEOUT_MS=0x5*0x3c*0x3e8,MAX_TRAINING_SET_SIZE=0x1f4,EXIT_TIMER_MINUTES=0xf,EXIT_GRACE_PERIOD_SECONDS=0x1e;let activeSequence=[],sequenceTimer=null;async function getOutsideTemperatureNumeric(_0x46d266){const _0x503739=a5_0x2884;if(_0x46d266[_0x503739(0xcd)][_0x503739(0xe2)])try{const _0x4b970e=await _0x46d266['getForeignStateAsync'](_0x46d266[_0x503739(0xcd)][_0x503739(0xe2)]);if(_0x4b970e&&_0x4b970e[_0x503739(0xb9)]!==undefined&&_0x4b970e[_0x503739(0xb9)]!==null)return parseFloat(_0x4b970e[_0x503739(0xb9)]);}catch(_0x5a153b){}const _0x14a89b=_0x46d266[_0x503739(0xcd)][_0x503739(0x92)];if(!_0x46d266[_0x503739(0xcd)][_0x503739(0x7b)]||!_0x14a89b)return null;try{let _0x330084='';if(_0x14a89b[_0x503739(0x9c)](_0x503739(0xb6)))_0x330084=_0x14a89b+'.Current.Temperature';else{if(_0x14a89b[_0x503739(0x9c)](_0x503739(0xab)))_0x330084=_0x14a89b+'.NextHours.Location_1.Day_1.current.temp_value';else{if(_0x14a89b[_0x503739(0x9c)](_0x503739(0xe9)))_0x330084=_0x14a89b+_0x503739(0xaf);else{if(_0x14a89b[_0x503739(0x9c)]('weatherunderground'))_0x330084=_0x14a89b+_0x503739(0x84);}}}if(_0x330084){const _0x544f6c=await _0x46d266[_0x503739(0xc9)](_0x330084);if(_0x544f6c&&_0x544f6c[_0x503739(0xb9)]!==undefined&&_0x544f6c[_0x503739(0xb9)]!==null)return parseFloat(_0x544f6c[_0x503739(0xb9)]);}}catch(_0x571fae){}return null;}async function recordThermodynamics(_0x547eb6,_0x3d4bfa,_0x28fe82,_0x28adbc){const _0x10bcc7=a5_0x2884,_0x2ce759=await getOutsideTemperatureNumeric(_0x547eb6);if(_0x2ce759===null)return;let _0x427cce=0x0,_0x4fcc93=![];if(_0x547eb6[_0x10bcc7(0xcd)][_0x10bcc7(0x7e)])try{let _0x476efd=_0x547eb6[_0x10bcc7(0xcd)]['valveMapping'];if(typeof _0x476efd===_0x10bcc7(0xbd))_0x476efd=JSON[_0x10bcc7(0xd7)](_0x476efd);if(_0x476efd[_0x3d4bfa]){const _0x4982ba=_0x476efd[_0x3d4bfa],_0x2b763b=await _0x547eb6[_0x10bcc7(0xc9)](_0x4982ba);if(_0x2b763b&&_0x2b763b[_0x10bcc7(0xb9)]!==null&&_0x2b763b[_0x10bcc7(0xb9)]!==undefined){let _0xe842a7=Number(_0x2b763b[_0x10bcc7(0xb9)]);if(_0xe842a7<=1.05&&!_0x4982ba[_0x10bcc7(0x9c)]('STATUS')&&!_0x4982ba['includes'](_0x10bcc7(0xb0)))_0xe842a7=_0xe842a7*0x64;_0x427cce=Math[_0x10bcc7(0xb8)](_0xe842a7),_0x4fcc93=!![];}}}catch(_0xaf8061){}if(!_0x4fcc93){const _0x4849d0=[{'from':'.1.ACTUAL_TEMPERATURE','to':_0x10bcc7(0xa4)},{'from':_0x10bcc7(0xcb),'to':_0x10bcc7(0x9f)},{'from':_0x10bcc7(0xb4),'to':'.4.VALVE_STATE'},{'from':_0x10bcc7(0x7a),'to':_0x10bcc7(0x95)},{'from':_0x10bcc7(0xe7),'to':_0x10bcc7(0xa1)},{'from':_0x10bcc7(0xca),'to':_0x10bcc7(0x88)}];for(const _0x515f4b of _0x4849d0){if(_0x3d4bfa['includes'](_0x515f4b[_0x10bcc7(0x75)])){const _0x33d71f=_0x3d4bfa[_0x10bcc7(0x7d)](_0x515f4b['from'],_0x515f4b['to']);try{const _0x1a7336=await _0x547eb6[_0x10bcc7(0xc9)](_0x33d71f);if(_0x1a7336&&_0x1a7336[_0x10bcc7(0xb9)]!==null&&_0x1a7336['val']!==undefined){let _0x561b3f=Number(_0x1a7336[_0x10bcc7(0xb9)]);if(typeof _0x561b3f===_0x10bcc7(0xa0)){if(_0x561b3f<=1.05&&_0x515f4b['to'][_0x10bcc7(0x9c)](_0x10bcc7(0xd9)))_0x561b3f=_0x561b3f*0x64;_0x427cce=Math[_0x10bcc7(0xb8)](_0x561b3f),_0x4fcc93=!![];break;}}}catch(_0x4360ee){}}}}const _0x8912e4=await _0x547eb6[_0x10bcc7(0xe0)]('LTM.trainingData.thermodynamics');let _0x3f9b74=[];if(_0x8912e4&&_0x8912e4[_0x10bcc7(0xb9)])try{_0x3f9b74=JSON[_0x10bcc7(0xd7)](_0x8912e4[_0x10bcc7(0xb9)]);}catch(_0xd3e92b){}_0x3f9b74[_0x10bcc7(0xc5)]({'ts':Date[_0x10bcc7(0x8f)](),'room':_0x28adbc||'Unknown','t_in':_0x28fe82,'t_out':_0x2ce759,'valve':_0x427cce});if(_0x3f9b74[_0x10bcc7(0x89)]>THERMO_LOG_SIZE)_0x3f9b74[_0x10bcc7(0x90)]();await _0x547eb6['setStateAsync'](_0x10bcc7(0x98),{'val':JSON[_0x10bcc7(0xb7)](_0x3f9b74),'ack':!![]});}function a5_0x2884(_0x4cc3c8,_0x5a99fc){const _0x3ea94a=a5_0x2faf();return a5_0x2884=function(_0x1bf71b,_0x35172e){_0x1bf71b=_0x1bf71b-0x74;let _0x2faf30=_0x3ea94a[_0x1bf71b];return _0x2faf30;},a5_0x2884(_0x4cc3c8,_0x5a99fc);}async function saveCompletedSequence(_0x27fe2e){const _0x4e3bab=a5_0x2884;try{const _0x1f7a4d=await _0x27fe2e[_0x4e3bab(0xe0)](_0x4e3bab(0xce));let _0x4221e0=[];if(_0x1f7a4d&&_0x1f7a4d['val'])try{_0x4221e0=JSON[_0x4e3bab(0xd7)](_0x1f7a4d[_0x4e3bab(0xb9)]);}catch(_0x5bbba9){}const _0x3a3612=activeSequence[0x0]['ts'],_0x28d0bd=activeSequence[_0x4e3bab(0xbf)](_0xb84318=>({'loc':_0xb84318[_0x4e3bab(0xa2)],'t_delta':Math[_0x4e3bab(0xb8)]((_0xb84318['ts']-_0x3a3612)/0x3e8)})),_0x3cdd77={'timestamp':new Date(_0x3a3612)[_0x4e3bab(0xe6)](),'steps':_0x28d0bd,'duration':Math[_0x4e3bab(0xb8)]((activeSequence[activeSequence['length']-0x1]['ts']-_0x3a3612)/0x3e8),'daytime':new Date(_0x3a3612)[_0x4e3bab(0x8c)]()};_0x4221e0[_0x4e3bab(0xc5)](_0x3cdd77);if(_0x4221e0[_0x4e3bab(0x89)]>MAX_TRAINING_SET_SIZE)_0x4221e0[_0x4e3bab(0x90)]();await _0x27fe2e[_0x4e3bab(0xaa)]('LTM.trainingData.sequences',{'val':JSON['stringify'](_0x4221e0),'ack':!![]}),_0x27fe2e[_0x4e3bab(0xde)]&&_0x27fe2e[_0x4e3bab(0x8d)]&&_0x27fe2e[_0x4e3bab(0x8d)](_0x4e3bab(0xd4),{'sequence':_0x3cdd77});}catch(_0x598048){_0x27fe2e['log'][_0x4e3bab(0xc3)](_0x4e3bab(0x86)+_0x598048['message']);}}async function recordSequence(_0x29869b,_0x32b58c){const _0x18ad29=a5_0x2884,_0x1a4551=(_0x32b58c['type']||'')['toLowerCase'](),_0x424bdd=[_0x18ad29(0xc7),_0x18ad29(0x9e),_0x18ad29(0x74),'presence','occupancy','door',_0x18ad29(0xa5),'window',_0x18ad29(0xd5),_0x18ad29(0x8b),'kontakt','light',_0x18ad29(0x8e),'switch','schalter',_0x18ad29(0x94),'lampe'];if(!_0x424bdd['some'](_0x211fca=>_0x1a4551[_0x18ad29(0x9c)](_0x211fca)))return;if(!_0x32b58c[_0x18ad29(0xd3)])return;if(sequenceTimer)clearTimeout(sequenceTimer);activeSequence[_0x18ad29(0xc5)]({'loc':_0x32b58c['location']||_0x18ad29(0xa8),'id':_0x32b58c['id'],'ts':Date[_0x18ad29(0x8f)]()}),sequenceTimer=setTimeout(async()=>{const _0x599675=_0x18ad29;if(activeSequence[_0x599675(0x89)]>0x1)await saveCompletedSequence(_0x29869b);activeSequence=[];},SEQUENCE_TIMEOUT_MS);}function startExitTimer(_0x372748){const _0x5ad829=a5_0x2884;abortExitTimer(_0x372748),_0x372748['isGracePeriodActive']=!![],_0x372748['exitGraceTimer']=setTimeout(()=>{const _0x3ccdc4=a5_0x2884;_0x372748[_0x3ccdc4(0x79)]=![];},EXIT_GRACE_PERIOD_SECONDS*0x3e8),_0x372748[_0x5ad829(0xb5)]=setTimeout(()=>{const _0x38af6e=_0x5ad829;setPresence(_0x372748,![]),_0x372748[_0x38af6e(0xb5)]=null;},EXIT_TIMER_MINUTES*0x3c*0x3e8);}function abortExitTimer(_0x58d638){const _0x176222=a5_0x2884;if(_0x58d638[_0x176222(0xb5)])clearTimeout(_0x58d638[_0x176222(0xb5)]);if(_0x58d638['exitGraceTimer'])clearTimeout(_0x58d638[_0x176222(0xdb)]);_0x58d638[_0x176222(0xb5)]=null,_0x58d638[_0x176222(0xdb)]=null,_0x58d638[_0x176222(0x79)]=![];}async function setPresence(_0x17120d,_0x30eadf){const _0x5ee02d=a5_0x2884;if(_0x17120d[_0x5ee02d(0x87)]===_0x30eadf)return;_0x17120d['isPresent']=_0x30eadf,await _0x17120d[_0x5ee02d(0xaa)](_0x5ee02d(0xa9),{'val':_0x30eadf,'ack':!![]});}async function processSensorEvent(_0x2dad4f,_0x440a0b,_0x3a0876,_0x5b0671){const _0x2a6aea=a5_0x2884;if(!_0x5b0671)return null;const _0x5b8346=_0x3a0876[_0x2a6aea(0xb9)],_0x5faa17=Date['now'](),_0x45e3d2=_0x2dad4f[_0x2a6aea(0xd8)][_0x440a0b],_0x3bd91b=(_0x5b0671[_0x2a6aea(0xb1)]||'')[_0x2a6aea(0x82)](),_0x549d61=_0x3bd91b[_0x2a6aea(0x9c)](_0x2a6aea(0xe7))||_0x3bd91b[_0x2a6aea(0x9c)](_0x2a6aea(0xb3))||_0x3bd91b['includes']('klima')||_0x3bd91b['includes'](_0x2a6aea(0x8a))||_0x3bd91b[_0x2a6aea(0x9c)](_0x2a6aea(0x96));if(_0x549d61&&typeof _0x5b8346===_0x2a6aea(0xa0)){if(_0x5b8346>0x50||_0x5b8346<-0x32)return _0x2dad4f['log'][_0x2a6aea(0x7f)](_0x2a6aea(0x76)+_0x5b8346+_0x2a6aea(0xc4)+_0x440a0b),null;}_0x2dad4f['sensorLastValues'][_0x440a0b]=_0x5b8346;if(!_0x5b0671['logDuplicates']&&_0x45e3d2!=undefined&&_0x45e3d2==_0x5b8346)return null;_0x2dad4f[_0x2a6aea(0xde)]&&_0x549d61&&recordThermodynamics(_0x2dad4f,_0x440a0b,_0x5b8346,_0x5b0671[_0x2a6aea(0xa3)]);const _0x4190bd={'timestamp':_0x5faa17,'id':_0x440a0b,'name':_0x5b0671[_0x2a6aea(0x93)],'type':_0x5b0671[_0x2a6aea(0xb1)],'location':_0x5b0671[_0x2a6aea(0xa3)],'value':_0x5b8346};_0x2dad4f[_0x2a6aea(0x78)][_0x2a6aea(0xe5)](_0x4190bd);if(_0x2dad4f[_0x2a6aea(0x78)][_0x2a6aea(0x89)]>HISTORY_MAX_SIZE)_0x2dad4f['eventHistory'][_0x2a6aea(0xa7)]();await _0x2dad4f[_0x2a6aea(0xaa)](_0x2a6aea(0xac),{'val':JSON['stringify'](_0x4190bd),'ack':!![]}),await _0x2dad4f[_0x2a6aea(0xaa)](_0x2a6aea(0x83),{'val':JSON['stringify'](_0x2dad4f[_0x2a6aea(0x78)]),'ack':!![]});if(_0x2dad4f[_0x2a6aea(0xde)]){_0x2dad4f['rawEventLog'][_0x2a6aea(0xc5)](_0x4190bd);if(_0x2dad4f['rawEventLog'][_0x2a6aea(0x89)]>RAW_LOG_MAX_SIZE)_0x2dad4f[_0x2a6aea(0xe1)][_0x2a6aea(0xe8)](0x0,_0x2dad4f['rawEventLog'][_0x2a6aea(0x89)]-RAW_LOG_MAX_SIZE);await _0x2dad4f[_0x2a6aea(0xaa)](_0x2a6aea(0xe3),{'val':JSON[_0x2a6aea(0xb7)](_0x2dad4f[_0x2a6aea(0xe1)]),'ack':!![]}),recordSequence(_0x2dad4f,_0x4190bd);}if(_0x5b0671['isExit']&&_0x5b8346===!![]){if(_0x2dad4f['isPresent']&&!_0x2dad4f['isGracePeriodActive'])startExitTimer(_0x2dad4f);else{if(!_0x2dad4f[_0x2a6aea(0x87)])setPresence(_0x2dad4f,!![]);}}else{if(_0x5b0671[_0x2a6aea(0xb1)]==='motion'&&_0x5b8346===!![]){if(_0x2dad4f[_0x2a6aea(0xb5)])abortExitTimer(_0x2dad4f);if(!_0x2dad4f[_0x2a6aea(0x87)]&&_0x2dad4f[_0x2a6aea(0xbe)]===_0x2a6aea(0xae))setPresence(_0x2dad4f,!![]);}}if(_0x2dad4f[_0x2a6aea(0xde)]&&_0x2dad4f[_0x2a6aea(0x8d)]){_0x5b0671[_0x2a6aea(0xb1)]===_0x2a6aea(0xc7)&&_0x5b8346===!![]&&_0x5b0671[_0x2a6aea(0xa3)]&&_0x2dad4f[_0x2a6aea(0x8d)](_0x2a6aea(0xdc),{'room':_0x5b0671['location']});const _0x40703e=[_0x2a6aea(0x81),_0x2a6aea(0xa5),_0x2a6aea(0x91),_0x2a6aea(0xd5),_0x2a6aea(0xcc),_0x2a6aea(0xd6),_0x2a6aea(0xcf),_0x2a6aea(0xba)]['some'](_0x4b4b22=>_0x3bd91b[_0x2a6aea(0x9c)](_0x4b4b22)),_0x4afc4e=[_0x2a6aea(0xbc),_0x2a6aea(0x8e),_0x2a6aea(0xb2),_0x2a6aea(0x80),_0x2a6aea(0x94),_0x2a6aea(0xbb)]['some'](_0x3e169e=>_0x3bd91b['includes'](_0x3e169e)),_0x5a09cd=[_0x2a6aea(0xc7),_0x2a6aea(0x9e),_0x2a6aea(0x74),_0x2a6aea(0x7c),_0x2a6aea(0xc8)][_0x2a6aea(0x9b)](_0x6a0e4=>_0x3bd91b[_0x2a6aea(0x9c)](_0x6a0e4));if(_0x5b0671[_0x2a6aea(0xa3)]&&(_0x40703e||_0x4afc4e||_0x5a09cd)){const _0x1f5571=_0x5b8346===!![]||typeof _0x5b8346===_0x2a6aea(0xa0)&&_0x5b8346>0x0,_0x48d52f=_0x40703e&&!_0x1f5571&&_0x45e3d2!==undefined&&_0x45e3d2!=_0x5b8346;if(_0x1f5571||_0x48d52f){const _0x258af7=_0x2dad4f[_0x2a6aea(0xad)]||_0x5faa17,_0x29cb77=(_0x5faa17-_0x258af7)/0x3e8;_0x2dad4f[_0x2a6aea(0xad)]=_0x5faa17,_0x2dad4f[_0x2a6aea(0x8d)](_0x2a6aea(0xc2),{'room':_0x5b0671[_0x2a6aea(0xa3)],'dt':_0x29cb77});}}}return _0x4190bd;}module[a5_0x1bae18(0xc0)]={'processSensorEvent':processSensorEvent,'getOutsideTemperatureNumeric':getOutsideTemperatureNumeric,'setPresence':setPresence,'abortExitTimer':abortExitTimer,'startExitTimer':startExitTimer};