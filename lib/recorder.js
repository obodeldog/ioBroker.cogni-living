const a5_0x1b08cd=a5_0x1844;(function(_0x2a369c,_0x357590){const _0x280f7c=a5_0x1844,_0x49b44e=_0x2a369c();while(!![]){try{const _0x40ac33=parseInt(_0x280f7c(0x88))/0x1+parseInt(_0x280f7c(0xb2))/0x2+parseInt(_0x280f7c(0xb9))/0x3+parseInt(_0x280f7c(0xd5))/0x4*(-parseInt(_0x280f7c(0xc4))/0x5)+parseInt(_0x280f7c(0x8d))/0x6+parseInt(_0x280f7c(0xae))/0x7+-parseInt(_0x280f7c(0x8a))/0x8;if(_0x40ac33===_0x357590)break;else _0x49b44e['push'](_0x49b44e['shift']());}catch(_0x55a61b){_0x49b44e['push'](_0x49b44e['shift']());}}}(a5_0x1e7d,0xb88f3));const a5_0x7b16e4=(function(){let _0x3cbb69=!![];return function(_0x44ee5c,_0x2191cf){const _0x51701d=_0x3cbb69?function(){const _0x19edbd=a5_0x1844;if(_0x2191cf){const _0xa2cdbc=_0x2191cf[_0x19edbd(0x95)](_0x44ee5c,arguments);return _0x2191cf=null,_0xa2cdbc;}}:function(){};return _0x3cbb69=![],_0x51701d;};}()),a5_0x417c08=a5_0x7b16e4(this,function(){const _0x3d19f1=a5_0x1844;return a5_0x417c08['toString']()['search'](_0x3d19f1(0xac))[_0x3d19f1(0x94)]()[_0x3d19f1(0xa7)](a5_0x417c08)['search'](_0x3d19f1(0xac));});a5_0x417c08();'use strict';const HISTORY_MAX_SIZE=0x32,RAW_LOG_MAX_SIZE=0x9c4,THERMO_LOG_SIZE=0x3e8,SEQUENCE_TIMEOUT_MS=0x5*0x3c*0x3e8,MAX_TRAINING_SET_SIZE=0x1f4,EXIT_TIMER_MINUTES=0xf,EXIT_GRACE_PERIOD_SECONDS=0x1e;function a5_0x1e7d(){const _0x12b535=['constructor','includes','unshift','system.isPresent','.1.VALVE_STATE','(((.+)+)+)+$','length','2206176mdxqGT','Temperature','temperatur','stringify','2755616urHlzM','val','message','getDate','LTM.rawEventLog','string','fenster','1421256DyFsql','griff','toISOString','switch','eventHistory','setStateAsync','exitTimer','lastTrackerEventTime','.ACTUAL_TEMPERATURE','heizung','exitGraceTimer','3420840NkkyBU','toLowerCase','.1.LEVEL','type','isExit','config','from','getHours','level','rawEventLog','sensorLastValues','door','light','STATE','präsenz','isProVersion','thermostat','4gOajuO','.forecast.current.temp','tür','TRACK_EVENT','splice','dimmer','normal','daswetter','.forecast.current.temperature','schalter','replace','analysis.health.todayVector','pop','.LEVEL','LTM.trainingData.thermodynamics','lock','push','valveMapping','location','weatherunderground','window','bewegung','round','Unknown','[RECORDER]\x20Error:\x20','presence','parse','.NextHours.Location_1.Day_1.current.temp_value','now','.4.VALVE_STATE','occupancy','isPresent','kontakt','motion','1025433hrKicY','log','25673712GDYeYi','sendToPythonWrapper','debug','8743056jNSzws','currentSystemMode','getStateAsync','exports','value','events.lastEvent','LTM.trainingData.sequences','toString','apply','Valve','lampe','[RECORDER]\x20Ignored\x20implausible\x20temperature:\x20','getForeignStateAsync','events.history','isGracePeriodActive','openweathermap','licht','map','klima','shift','weatherInstance','loc','error','fill','some','temperature'];a5_0x1e7d=function(){return _0x12b535;};return a5_0x1e7d();}function a5_0x1844(_0x114bc5,_0x3ae1e9){const _0x4fd1a5=a5_0x1e7d();return a5_0x1844=function(_0x417c08,_0x7b16e4){_0x417c08=_0x417c08-0x85;let _0x1e7db8=_0x4fd1a5[_0x417c08];return _0x1e7db8;},a5_0x1844(_0x114bc5,_0x3ae1e9);}let activeSequence=[],sequenceTimer=null;async function getOutsideTemperatureNumeric(_0x151560){const _0x221b5d=a5_0x1844;if(_0x151560[_0x221b5d(0xc9)]['outdoorSensorId'])try{const _0x162e62=await _0x151560[_0x221b5d(0x99)](_0x151560['config']['outdoorSensorId']);if(_0x162e62&&_0x162e62[_0x221b5d(0xb3)]!==undefined&&_0x162e62[_0x221b5d(0xb3)]!==null)return parseFloat(_0x162e62['val']);}catch(_0x19cfca){}const _0x17fe3d=_0x151560[_0x221b5d(0xc9)][_0x221b5d(0xa1)];if(!_0x151560[_0x221b5d(0xc9)]['useWeather']||!_0x17fe3d)return null;try{let _0x491cc8='';if(_0x17fe3d[_0x221b5d(0xa8)]('accuweather'))_0x491cc8=_0x17fe3d+'.Current.Temperature';else{if(_0x17fe3d[_0x221b5d(0xa8)](_0x221b5d(0xdc)))_0x491cc8=_0x17fe3d+_0x221b5d(0xf0);else{if(_0x17fe3d[_0x221b5d(0xa8)](_0x221b5d(0x9c)))_0x491cc8=_0x17fe3d+_0x221b5d(0xdd);else{if(_0x17fe3d[_0x221b5d(0xa8)](_0x221b5d(0xe8)))_0x491cc8=_0x17fe3d+_0x221b5d(0xd6);}}}if(_0x491cc8){const _0xce5d76=await _0x151560['getForeignStateAsync'](_0x491cc8);if(_0xce5d76&&_0xce5d76[_0x221b5d(0xb3)]!==undefined&&_0xce5d76[_0x221b5d(0xb3)]!==null)return parseFloat(_0xce5d76['val']);}}catch(_0x1c71eb){}return null;}async function recordThermodynamics(_0x38cae7,_0x3d965b,_0x569683,_0x46c48b){const _0x5b09ac=a5_0x1844,_0x3bdecd=await getOutsideTemperatureNumeric(_0x38cae7);if(_0x3bdecd===null)return;let _0x54d4c1=0x0,_0x1dc9fc=![];if(_0x38cae7[_0x5b09ac(0xc9)][_0x5b09ac(0xe6)])try{let _0x53083f=_0x38cae7[_0x5b09ac(0xc9)][_0x5b09ac(0xe6)];if(typeof _0x53083f===_0x5b09ac(0xb7))_0x53083f=JSON['parse'](_0x53083f);if(_0x53083f[_0x3d965b]){const _0xa0b1c6=_0x53083f[_0x3d965b],_0x311f15=await _0x38cae7[_0x5b09ac(0x99)](_0xa0b1c6);if(_0x311f15&&_0x311f15[_0x5b09ac(0xb3)]!==null&&_0x311f15['val']!==undefined){let _0x4e1deb=Number(_0x311f15[_0x5b09ac(0xb3)]);if(_0x4e1deb<=1.05&&!_0xa0b1c6[_0x5b09ac(0xa8)]('STATUS')&&!_0xa0b1c6[_0x5b09ac(0xa8)](_0x5b09ac(0xd1)))_0x4e1deb=_0x4e1deb*0x64;_0x54d4c1=Math['round'](_0x4e1deb),_0x1dc9fc=!![];}}}catch(_0x161439){}if(!_0x1dc9fc){const _0x4903a7=[{'from':'.1.ACTUAL_TEMPERATURE','to':_0x5b09ac(0xc6)},{'from':'.1.ACTUAL_TEMPERATURE','to':_0x5b09ac(0xab)},{'from':'.1.TEMPERATURE','to':_0x5b09ac(0xf2)},{'from':_0x5b09ac(0xc1),'to':_0x5b09ac(0xe2)},{'from':_0x5b09ac(0xa6),'to':_0x5b09ac(0xcc)},{'from':_0x5b09ac(0xaf),'to':_0x5b09ac(0x96)}];for(const _0x3a13b6 of _0x4903a7){if(_0x3d965b[_0x5b09ac(0xa8)](_0x3a13b6[_0x5b09ac(0xca)])){const _0x5e0dca=_0x3d965b[_0x5b09ac(0xdf)](_0x3a13b6[_0x5b09ac(0xca)],_0x3a13b6['to']);try{const _0x50e41a=await _0x38cae7[_0x5b09ac(0x99)](_0x5e0dca);if(_0x50e41a&&_0x50e41a[_0x5b09ac(0xb3)]!==null&&_0x50e41a['val']!==undefined){let _0x21c375=Number(_0x50e41a[_0x5b09ac(0xb3)]);if(typeof _0x21c375==='number'){if(_0x21c375<=1.05&&_0x3a13b6['to'][_0x5b09ac(0xa8)]('LEVEL'))_0x21c375=_0x21c375*0x64;_0x54d4c1=Math[_0x5b09ac(0xeb)](_0x21c375),_0x1dc9fc=!![];break;}}}catch(_0x43eec0){}}}}const _0x2a67bf=await _0x38cae7[_0x5b09ac(0x8f)](_0x5b09ac(0xe3));let _0x4e55a7=[];if(_0x2a67bf&&_0x2a67bf[_0x5b09ac(0xb3)])try{_0x4e55a7=JSON[_0x5b09ac(0xef)](_0x2a67bf[_0x5b09ac(0xb3)]);}catch(_0x9de9d9){}_0x4e55a7[_0x5b09ac(0xe5)]({'ts':Date[_0x5b09ac(0xf1)](),'room':_0x46c48b||_0x5b09ac(0xec),'t_in':_0x569683,'t_out':_0x3bdecd,'valve':_0x54d4c1});if(_0x4e55a7[_0x5b09ac(0xad)]>THERMO_LOG_SIZE)_0x4e55a7[_0x5b09ac(0xa0)]();await _0x38cae7[_0x5b09ac(0xbe)](_0x5b09ac(0xe3),{'val':JSON[_0x5b09ac(0xb1)](_0x4e55a7),'ack':!![]});}async function saveCompletedSequence(_0x55857d){const _0x2bb7bf=a5_0x1844;try{const _0x217a16=await _0x55857d[_0x2bb7bf(0x8f)](_0x2bb7bf(0x93));let _0xaacfb9=[];if(_0x217a16&&_0x217a16['val'])try{_0xaacfb9=JSON[_0x2bb7bf(0xef)](_0x217a16[_0x2bb7bf(0xb3)]);}catch(_0x1df8eb){}const _0x2c7f45=activeSequence[0x0]['ts'],_0x35be17=activeSequence[_0x2bb7bf(0x9e)](_0x1bc183=>({'loc':_0x1bc183[_0x2bb7bf(0xa2)],'t_delta':Math['round']((_0x1bc183['ts']-_0x2c7f45)/0x3e8)})),_0x3eff01={'timestamp':new Date(_0x2c7f45)[_0x2bb7bf(0xbb)](),'steps':_0x35be17,'duration':Math[_0x2bb7bf(0xeb)]((activeSequence[activeSequence[_0x2bb7bf(0xad)]-0x1]['ts']-_0x2c7f45)/0x3e8),'daytime':new Date(_0x2c7f45)['getHours']()};_0xaacfb9[_0x2bb7bf(0xe5)](_0x3eff01);if(_0xaacfb9[_0x2bb7bf(0xad)]>MAX_TRAINING_SET_SIZE)_0xaacfb9[_0x2bb7bf(0xa0)]();await _0x55857d[_0x2bb7bf(0xbe)]('LTM.trainingData.sequences',{'val':JSON['stringify'](_0xaacfb9),'ack':!![]}),_0x55857d[_0x2bb7bf(0xd3)]&&_0x55857d[_0x2bb7bf(0x8b)]&&_0x55857d[_0x2bb7bf(0x8b)]('ANALYZE_SEQUENCE',{'sequence':_0x3eff01});}catch(_0x214ae8){_0x55857d[_0x2bb7bf(0x89)][_0x2bb7bf(0xa3)](_0x2bb7bf(0xed)+_0x214ae8[_0x2bb7bf(0xb4)]);}}async function recordSequence(_0x244b2e,_0x3f38f4){const _0x260820=a5_0x1844,_0x1403a5=(_0x3f38f4['type']||'')[_0x260820(0xc5)](),_0x4f9625=[_0x260820(0x87),_0x260820(0xea),_0x260820(0xd2),_0x260820(0xee),_0x260820(0xf3),'door','tür',_0x260820(0xe9),_0x260820(0xb8),'contact',_0x260820(0x86),_0x260820(0xd0),_0x260820(0x9d),'switch',_0x260820(0xde),_0x260820(0xda),_0x260820(0x97)];if(!_0x4f9625[_0x260820(0xa5)](_0x1bcb49=>_0x1403a5['includes'](_0x1bcb49)))return;if(!_0x3f38f4[_0x260820(0x91)])return;if(sequenceTimer)clearTimeout(sequenceTimer);activeSequence[_0x260820(0xe5)]({'loc':_0x3f38f4[_0x260820(0xe7)]||_0x260820(0xec),'id':_0x3f38f4['id'],'ts':Date[_0x260820(0xf1)]()}),sequenceTimer=setTimeout(async()=>{if(activeSequence['length']>0x1)await saveCompletedSequence(_0x244b2e);activeSequence=[];},SEQUENCE_TIMEOUT_MS);}function startExitTimer(_0x49de81){const _0x1fda60=a5_0x1844;abortExitTimer(_0x49de81),_0x49de81['isGracePeriodActive']=!![],_0x49de81[_0x1fda60(0xc3)]=setTimeout(()=>{_0x49de81['isGracePeriodActive']=![];},EXIT_GRACE_PERIOD_SECONDS*0x3e8),_0x49de81[_0x1fda60(0xbf)]=setTimeout(()=>{setPresence(_0x49de81,![]),_0x49de81['exitTimer']=null;},EXIT_TIMER_MINUTES*0x3c*0x3e8);}function abortExitTimer(_0x4dd471){const _0x436c2e=a5_0x1844;if(_0x4dd471[_0x436c2e(0xbf)])clearTimeout(_0x4dd471['exitTimer']);if(_0x4dd471[_0x436c2e(0xc3)])clearTimeout(_0x4dd471[_0x436c2e(0xc3)]);_0x4dd471['exitTimer']=null,_0x4dd471[_0x436c2e(0xc3)]=null,_0x4dd471[_0x436c2e(0x9b)]=![];}async function setPresence(_0x1c948e,_0x4eed58){const _0x53401c=a5_0x1844;if(_0x1c948e['isPresent']===_0x4eed58)return;_0x1c948e['isPresent']=_0x4eed58,await _0x1c948e[_0x53401c(0xbe)](_0x53401c(0xaa),{'val':_0x4eed58,'ack':!![]});}async function updateHourlyActivity(_0x1b24df){const _0xe72ed8=a5_0x1844;let _0x5a7c63=new Array(0x18)[_0xe72ed8(0xa4)](0x0),_0x111f16=0x0;try{const _0x149658=await _0x1b24df[_0xe72ed8(0x8f)](_0xe72ed8(0xe0));_0x149658&&_0x149658['val']&&(_0x5a7c63=JSON[_0xe72ed8(0xef)](_0x149658[_0xe72ed8(0xb3)]),_0x111f16=_0x149658['ts']);}catch(_0x2c9e69){}const _0x456ce4=new Date(_0x111f16),_0x1cce16=new Date();_0x456ce4[_0xe72ed8(0xb5)]()!==_0x1cce16[_0xe72ed8(0xb5)]()&&(_0x5a7c63=new Array(0x18)[_0xe72ed8(0xa4)](0x0));const _0x2a0c93=_0x1cce16[_0xe72ed8(0xcb)]();if(_0x5a7c63[_0x2a0c93]===undefined)_0x5a7c63[_0x2a0c93]=0x0;_0x5a7c63[_0x2a0c93]++,await _0x1b24df[_0xe72ed8(0xbe)](_0xe72ed8(0xe0),{'val':JSON['stringify'](_0x5a7c63),'ack':!![]});}async function processSensorEvent(_0x34fc6b,_0x248f15,_0x248742,_0x3be06d){const _0x2431b1=a5_0x1844;if(!_0x3be06d)return null;const _0x388ea3=_0x248742['val'],_0x50d35b=Date[_0x2431b1(0xf1)](),_0x2c801a=_0x34fc6b[_0x2431b1(0xce)][_0x248f15],_0x4102b5=(_0x3be06d['type']||'')['toLowerCase'](),_0xdb3df7=_0x4102b5['includes'](_0x2431b1(0xa6))||_0x4102b5[_0x2431b1(0xa8)](_0x2431b1(0xb0))||_0x4102b5[_0x2431b1(0xa8)](_0x2431b1(0x9f))||_0x4102b5[_0x2431b1(0xa8)](_0x2431b1(0xc2))||_0x4102b5[_0x2431b1(0xa8)](_0x2431b1(0xd4));if(_0xdb3df7&&typeof _0x388ea3==='number'){if(_0x388ea3>0x50||_0x388ea3<-0x32)return _0x34fc6b[_0x2431b1(0x89)][_0x2431b1(0x8c)](_0x2431b1(0x98)+_0x388ea3+'\x20from\x20'+_0x248f15),null;}_0x34fc6b['sensorLastValues'][_0x248f15]=_0x388ea3;if(!_0x3be06d['logDuplicates']&&_0x2c801a!=undefined&&_0x2c801a==_0x388ea3)return null;_0x34fc6b[_0x2431b1(0xd3)]&&_0xdb3df7&&recordThermodynamics(_0x34fc6b,_0x248f15,_0x388ea3,_0x3be06d[_0x2431b1(0xe7)]);const _0x8d143d={'timestamp':_0x50d35b,'id':_0x248f15,'name':_0x3be06d['name'],'type':_0x3be06d[_0x2431b1(0xc7)],'location':_0x3be06d[_0x2431b1(0xe7)],'value':_0x388ea3};_0x34fc6b[_0x2431b1(0xbd)][_0x2431b1(0xa9)](_0x8d143d);if(_0x34fc6b[_0x2431b1(0xbd)][_0x2431b1(0xad)]>HISTORY_MAX_SIZE)_0x34fc6b[_0x2431b1(0xbd)][_0x2431b1(0xe1)]();await _0x34fc6b[_0x2431b1(0xbe)](_0x2431b1(0x92),{'val':JSON[_0x2431b1(0xb1)](_0x8d143d),'ack':!![]}),await _0x34fc6b[_0x2431b1(0xbe)](_0x2431b1(0x9a),{'val':JSON[_0x2431b1(0xb1)](_0x34fc6b[_0x2431b1(0xbd)]),'ack':!![]}),await updateHourlyActivity(_0x34fc6b);if(_0x34fc6b[_0x2431b1(0xd3)]){_0x34fc6b[_0x2431b1(0xcd)]['push'](_0x8d143d);if(_0x34fc6b[_0x2431b1(0xcd)][_0x2431b1(0xad)]>RAW_LOG_MAX_SIZE)_0x34fc6b[_0x2431b1(0xcd)][_0x2431b1(0xd9)](0x0,_0x34fc6b[_0x2431b1(0xcd)][_0x2431b1(0xad)]-RAW_LOG_MAX_SIZE);await _0x34fc6b[_0x2431b1(0xbe)](_0x2431b1(0xb6),{'val':JSON['stringify'](_0x34fc6b[_0x2431b1(0xcd)]),'ack':!![]}),recordSequence(_0x34fc6b,_0x8d143d);}if(_0x3be06d[_0x2431b1(0xc8)]&&_0x388ea3===!![]){if(_0x34fc6b[_0x2431b1(0x85)]&&!_0x34fc6b[_0x2431b1(0x9b)])startExitTimer(_0x34fc6b);else{if(!_0x34fc6b['isPresent'])setPresence(_0x34fc6b,!![]);}}else{if(_0x3be06d['type']===_0x2431b1(0x87)&&_0x388ea3===!![]){if(_0x34fc6b[_0x2431b1(0xbf)])abortExitTimer(_0x34fc6b);if(!_0x34fc6b['isPresent']&&_0x34fc6b[_0x2431b1(0x8e)]===_0x2431b1(0xdb))setPresence(_0x34fc6b,!![]);}}if(_0x34fc6b[_0x2431b1(0xd3)]&&_0x34fc6b[_0x2431b1(0x8b)]){_0x3be06d[_0x2431b1(0xc7)]===_0x2431b1(0x87)&&_0x388ea3===!![]&&_0x3be06d[_0x2431b1(0xe7)]&&_0x34fc6b[_0x2431b1(0x8b)]('SIMULATE_SIGNAL',{'room':_0x3be06d[_0x2431b1(0xe7)]});const _0x58f204=[_0x2431b1(0xcf),_0x2431b1(0xd7),_0x2431b1(0xe9),_0x2431b1(0xb8),_0x2431b1(0xba),'handle',_0x2431b1(0xe4),'schloss'][_0x2431b1(0xa5)](_0x346f9a=>_0x4102b5[_0x2431b1(0xa8)](_0x346f9a)),_0x856ff4=[_0x2431b1(0xd0),_0x2431b1(0x9d),_0x2431b1(0xbc),'schalter',_0x2431b1(0xda),_0x2431b1(0x97)][_0x2431b1(0xa5)](_0x50bc00=>_0x4102b5['includes'](_0x50bc00)),_0x5e9423=[_0x2431b1(0x87),_0x2431b1(0xea),_0x2431b1(0xd2),'presence',_0x2431b1(0xf3)]['some'](_0x1ea8a5=>_0x4102b5[_0x2431b1(0xa8)](_0x1ea8a5));if(_0x3be06d[_0x2431b1(0xe7)]&&(_0x58f204||_0x856ff4||_0x5e9423)){const _0x28cd80=_0x388ea3===!![]||typeof _0x388ea3==='number'&&_0x388ea3>0x0,_0xe196ce=_0x58f204&&!_0x28cd80&&_0x2c801a!==undefined&&_0x2c801a!=_0x388ea3;if(_0x28cd80||_0xe196ce){const _0x6027f=_0x34fc6b[_0x2431b1(0xc0)]||_0x50d35b,_0x3bf292=(_0x50d35b-_0x6027f)/0x3e8;_0x34fc6b['lastTrackerEventTime']=_0x50d35b,_0x34fc6b[_0x2431b1(0x8b)](_0x2431b1(0xd8),{'room':_0x3be06d[_0x2431b1(0xe7)],'dt':_0x3bf292});}}}return _0x8d143d;}module[a5_0x1b08cd(0x90)]={'processSensorEvent':processSensorEvent,'getOutsideTemperatureNumeric':getOutsideTemperatureNumeric,'setPresence':setPresence,'abortExitTimer':abortExitTimer,'startExitTimer':startExitTimer};