const a5_0x317ce7=a5_0x4c79;(function(_0x501af3,_0x1c7c1d){const _0x5b027e=a5_0x4c79,_0x5d324c=_0x501af3();while(!![]){try{const _0x1c267e=parseInt(_0x5b027e(0xb9))/0x1*(-parseInt(_0x5b027e(0xfb))/0x2)+-parseInt(_0x5b027e(0xfa))/0x3+-parseInt(_0x5b027e(0xdb))/0x4+-parseInt(_0x5b027e(0xb8))/0x5*(parseInt(_0x5b027e(0x10f))/0x6)+-parseInt(_0x5b027e(0xcd))/0x7+-parseInt(_0x5b027e(0xdd))/0x8*(-parseInt(_0x5b027e(0xdc))/0x9)+parseInt(_0x5b027e(0x115))/0xa;if(_0x1c267e===_0x1c7c1d)break;else _0x5d324c['push'](_0x5d324c['shift']());}catch(_0x444e46){_0x5d324c['push'](_0x5d324c['shift']());}}}(a5_0x39ae,0x60e2b));const a5_0x624ec1=(function(){let _0x494ab6=!![];return function(_0x30f4cc,_0x14a37a){const _0x240343=_0x494ab6?function(){if(_0x14a37a){const _0x5017cd=_0x14a37a['apply'](_0x30f4cc,arguments);return _0x14a37a=null,_0x5017cd;}}:function(){};return _0x494ab6=![],_0x240343;};}()),a5_0xd1708f=a5_0x624ec1(this,function(){const _0x1a8b5d=a5_0x4c79;return a5_0xd1708f[_0x1a8b5d(0x118)]()['search'](_0x1a8b5d(0x10d))[_0x1a8b5d(0x118)]()[_0x1a8b5d(0xca)](a5_0xd1708f)[_0x1a8b5d(0x11a)](_0x1a8b5d(0x10d));});a5_0xd1708f();'use strict';const HISTORY_MAX_SIZE=0x32,RAW_LOG_MAX_SIZE=0x9c4,THERMO_LOG_SIZE=0x3e8,SEQUENCE_TIMEOUT_MS=0x5*0x3c*0x3e8,MAX_TRAINING_SET_SIZE=0x1f4,EXIT_TIMER_MINUTES=0xf,EXIT_GRACE_PERIOD_SECONDS=0x1e;function a5_0x4c79(_0x3d1818,_0x1bf77a){const _0x21e92e=a5_0x39ae();return a5_0x4c79=function(_0xd1708f,_0x624ec1){_0xd1708f=_0xd1708f-0xb5;let _0x39aef7=_0x21e92e[_0xd1708f];return _0x39aef7;},a5_0x4c79(_0x3d1818,_0x1bf77a);}function a5_0x39ae(){const _0x57429b=['LTM.trainingData.thermodynamics','pop','system.isPresent','klima','licht','(((.+)+)+)+$','isPresent','1441122wYEfym','isGracePeriodActive','schloss','exitTimer','error','.4.VALVE_STATE','31977780QgDzft','val','schalter','toString','now','search','type','from','parse','splice','exitGraceTimer','handle','15TRUwuE','1433cgEobU','config','string','logDuplicates','log','toLowerCase','weatherInstance','[RECORDER]\x20Ignored\x20implausible\x20temperature:\x20','isProVersion','getForeignStateAsync','light','stringify','location','loc','LTM.trainingData.sequences','daswetter','round','constructor','tür','push','3895780kwNUZj','includes','some','door','shift','replace','fenster','LEVEL','value','map','eventHistory','getHours','outdoorSensorId','message','1793692rlaEhR','9kknDBA','532712NmRpHV','.LEVEL','openweathermap','LTM.rawEventLog','setStateAsync','[RECORDER]\x20Error:\x20','contact','Unknown','temperature','thermostat','debug','STATUS','valveMapping','.ACTUAL_TEMPERATURE','rawEventLog','.1.TEMPERATURE','exports','accuweather','griff','dimmer','name','.1.ACTUAL_TEMPERATURE','sensorLastValues','bewegung','sendToPythonWrapper','Temperature','lastTrackerEventTime','präsenz','switch','1392573ikObik','946JCOSUd','lampe','length','\x20from\x20','occupancy','Valve','.Current.Temperature','isExit','motion','presence','number','temperatur','useWeather'];a5_0x39ae=function(){return _0x57429b;};return a5_0x39ae();}let activeSequence=[],sequenceTimer=null;async function getOutsideTemperatureNumeric(_0x1e3c7e){const _0x523389=a5_0x4c79;if(_0x1e3c7e[_0x523389(0xba)]['outdoorSensorId'])try{const _0x4c79b5=await _0x1e3c7e[_0x523389(0xc2)](_0x1e3c7e[_0x523389(0xba)][_0x523389(0xd9)]);if(_0x4c79b5&&_0x4c79b5['val']!==undefined&&_0x4c79b5[_0x523389(0x116)]!==null)return parseFloat(_0x4c79b5['val']);}catch(_0x52a213){}const _0x292f0d=_0x1e3c7e['config'][_0x523389(0xbf)];if(!_0x1e3c7e['config'][_0x523389(0x107)]||!_0x292f0d)return null;try{let _0x6b533='';if(_0x292f0d[_0x523389(0xce)](_0x523389(0xee)))_0x6b533=_0x292f0d+_0x523389(0x101);else{if(_0x292f0d[_0x523389(0xce)](_0x523389(0xc8)))_0x6b533=_0x292f0d+'.NextHours.Location_1.Day_1.current.temp_value';else{if(_0x292f0d[_0x523389(0xce)](_0x523389(0xdf)))_0x6b533=_0x292f0d+'.forecast.current.temperature';else{if(_0x292f0d['includes']('weatherunderground'))_0x6b533=_0x292f0d+'.forecast.current.temp';}}}if(_0x6b533){const _0x21e133=await _0x1e3c7e[_0x523389(0xc2)](_0x6b533);if(_0x21e133&&_0x21e133['val']!==undefined&&_0x21e133[_0x523389(0x116)]!==null)return parseFloat(_0x21e133[_0x523389(0x116)]);}}catch(_0xbc7ad9){}return null;}async function recordThermodynamics(_0x5920fc,_0x18d419,_0xf847c6,_0x54fed3){const _0x423b78=a5_0x4c79,_0x1c224e=await getOutsideTemperatureNumeric(_0x5920fc);if(_0x1c224e===null)return;let _0x2235b6=0x0,_0x43f336=![];if(_0x5920fc[_0x423b78(0xba)][_0x423b78(0xe9)])try{let _0x3982f6=_0x5920fc[_0x423b78(0xba)][_0x423b78(0xe9)];if(typeof _0x3982f6===_0x423b78(0xbb))_0x3982f6=JSON[_0x423b78(0x11d)](_0x3982f6);if(_0x3982f6[_0x18d419]){const _0x13e9fe=_0x3982f6[_0x18d419],_0x35a1c6=await _0x5920fc[_0x423b78(0xc2)](_0x13e9fe);if(_0x35a1c6&&_0x35a1c6[_0x423b78(0x116)]!==null&&_0x35a1c6[_0x423b78(0x116)]!==undefined){let _0x34a475=Number(_0x35a1c6[_0x423b78(0x116)]);if(_0x34a475<=1.05&&!_0x13e9fe[_0x423b78(0xce)](_0x423b78(0xe8))&&!_0x13e9fe[_0x423b78(0xce)]('STATE'))_0x34a475=_0x34a475*0x64;_0x2235b6=Math[_0x423b78(0xc9)](_0x34a475),_0x43f336=!![];}}}catch(_0x28a58f){}if(!_0x43f336){const _0x2fb2e5=[{'from':_0x423b78(0xf2),'to':'.1.LEVEL'},{'from':_0x423b78(0xf2),'to':'.1.VALVE_STATE'},{'from':_0x423b78(0xec),'to':_0x423b78(0x114)},{'from':_0x423b78(0xea),'to':_0x423b78(0xde)},{'from':'temperature','to':'level'},{'from':_0x423b78(0xf6),'to':_0x423b78(0x100)}];for(const _0x377d42 of _0x2fb2e5){if(_0x18d419['includes'](_0x377d42[_0x423b78(0x11c)])){const _0x2496d1=_0x18d419[_0x423b78(0xd2)](_0x377d42[_0x423b78(0x11c)],_0x377d42['to']);try{const _0x3bf105=await _0x5920fc[_0x423b78(0xc2)](_0x2496d1);if(_0x3bf105&&_0x3bf105[_0x423b78(0x116)]!==null&&_0x3bf105[_0x423b78(0x116)]!==undefined){let _0x2de5ea=Number(_0x3bf105['val']);if(typeof _0x2de5ea==='number'){if(_0x2de5ea<=1.05&&_0x377d42['to'][_0x423b78(0xce)](_0x423b78(0xd4)))_0x2de5ea=_0x2de5ea*0x64;_0x2235b6=Math[_0x423b78(0xc9)](_0x2de5ea),_0x43f336=!![];break;}}}catch(_0x3477da){}}}}const _0x1a946f=await _0x5920fc['getStateAsync'](_0x423b78(0x108));let _0x29dee1=[];if(_0x1a946f&&_0x1a946f['val'])try{_0x29dee1=JSON[_0x423b78(0x11d)](_0x1a946f[_0x423b78(0x116)]);}catch(_0x4676d3){}_0x29dee1[_0x423b78(0xcc)]({'ts':Date['now'](),'room':_0x54fed3||_0x423b78(0xe4),'t_in':_0xf847c6,'t_out':_0x1c224e,'valve':_0x2235b6});if(_0x29dee1[_0x423b78(0xfd)]>THERMO_LOG_SIZE)_0x29dee1[_0x423b78(0xd1)]();await _0x5920fc[_0x423b78(0xe1)](_0x423b78(0x108),{'val':JSON['stringify'](_0x29dee1),'ack':!![]});}async function saveCompletedSequence(_0x5240a5){const _0x214da8=a5_0x4c79;try{const _0xb7b83d=await _0x5240a5['getStateAsync'](_0x214da8(0xc7));let _0x1ddd21=[];if(_0xb7b83d&&_0xb7b83d[_0x214da8(0x116)])try{_0x1ddd21=JSON[_0x214da8(0x11d)](_0xb7b83d[_0x214da8(0x116)]);}catch(_0x504de2){}const _0x25f870=activeSequence[0x0]['ts'],_0x420a01=activeSequence[_0x214da8(0xd6)](_0x1bd6e9=>({'loc':_0x1bd6e9[_0x214da8(0xc6)],'t_delta':Math[_0x214da8(0xc9)]((_0x1bd6e9['ts']-_0x25f870)/0x3e8)})),_0x539359={'timestamp':new Date(_0x25f870)['toISOString'](),'steps':_0x420a01,'duration':Math[_0x214da8(0xc9)]((activeSequence[activeSequence[_0x214da8(0xfd)]-0x1]['ts']-_0x25f870)/0x3e8),'daytime':new Date(_0x25f870)[_0x214da8(0xd8)]()};_0x1ddd21[_0x214da8(0xcc)](_0x539359);if(_0x1ddd21['length']>MAX_TRAINING_SET_SIZE)_0x1ddd21[_0x214da8(0xd1)]();await _0x5240a5['setStateAsync'](_0x214da8(0xc7),{'val':JSON[_0x214da8(0xc4)](_0x1ddd21),'ack':!![]}),_0x5240a5[_0x214da8(0xc1)]&&_0x5240a5[_0x214da8(0xf5)]&&_0x5240a5['sendToPythonWrapper']('ANALYZE_SEQUENCE',{'sequence':_0x539359});}catch(_0x19ea1a){_0x5240a5[_0x214da8(0xbd)][_0x214da8(0x113)](_0x214da8(0xe2)+_0x19ea1a[_0x214da8(0xda)]);}}async function recordSequence(_0x3c356e,_0x10edec){const _0x269ff6=a5_0x4c79,_0x38781d=(_0x10edec[_0x269ff6(0x11b)]||'')['toLowerCase'](),_0x5ec108=[_0x269ff6(0x103),_0x269ff6(0xf4),_0x269ff6(0xf8),_0x269ff6(0x104),_0x269ff6(0xff),'door','tür','window',_0x269ff6(0xd3),_0x269ff6(0xe3),'kontakt',_0x269ff6(0xc3),'licht',_0x269ff6(0xf9),_0x269ff6(0x117),_0x269ff6(0xf0),_0x269ff6(0xfc)];if(!_0x5ec108[_0x269ff6(0xcf)](_0x1b7ea3=>_0x38781d[_0x269ff6(0xce)](_0x1b7ea3)))return;if(!_0x10edec[_0x269ff6(0xd5)])return;if(sequenceTimer)clearTimeout(sequenceTimer);activeSequence[_0x269ff6(0xcc)]({'loc':_0x10edec[_0x269ff6(0xc5)]||'Unknown','id':_0x10edec['id'],'ts':Date[_0x269ff6(0x119)]()}),sequenceTimer=setTimeout(async()=>{const _0x40f152=_0x269ff6;if(activeSequence[_0x40f152(0xfd)]>0x1)await saveCompletedSequence(_0x3c356e);activeSequence=[];},SEQUENCE_TIMEOUT_MS);}function startExitTimer(_0x2b03e5){const _0x59256a=a5_0x4c79;abortExitTimer(_0x2b03e5),_0x2b03e5[_0x59256a(0x110)]=!![],_0x2b03e5[_0x59256a(0xb6)]=setTimeout(()=>{const _0x5506da=_0x59256a;_0x2b03e5[_0x5506da(0x110)]=![];},EXIT_GRACE_PERIOD_SECONDS*0x3e8),_0x2b03e5['exitTimer']=setTimeout(()=>{const _0x114120=_0x59256a;setPresence(_0x2b03e5,![]),_0x2b03e5[_0x114120(0x112)]=null;},EXIT_TIMER_MINUTES*0x3c*0x3e8);}function abortExitTimer(_0x345ad3){const _0x1a1342=a5_0x4c79;if(_0x345ad3[_0x1a1342(0x112)])clearTimeout(_0x345ad3[_0x1a1342(0x112)]);if(_0x345ad3[_0x1a1342(0xb6)])clearTimeout(_0x345ad3[_0x1a1342(0xb6)]);_0x345ad3[_0x1a1342(0x112)]=null,_0x345ad3[_0x1a1342(0xb6)]=null,_0x345ad3['isGracePeriodActive']=![];}async function setPresence(_0x61fb42,_0x3acd29){const _0x2e2f4e=a5_0x4c79;if(_0x61fb42['isPresent']===_0x3acd29)return;_0x61fb42[_0x2e2f4e(0x10e)]=_0x3acd29,await _0x61fb42[_0x2e2f4e(0xe1)](_0x2e2f4e(0x10a),{'val':_0x3acd29,'ack':!![]});}async function processSensorEvent(_0x7a6968,_0x44fc86,_0x3693ad,_0x39be6c){const _0x1dd050=a5_0x4c79;if(!_0x39be6c)return null;const _0x488a33=_0x3693ad['val'],_0x5d00ea=Date[_0x1dd050(0x119)](),_0x1d3c55=_0x7a6968[_0x1dd050(0xf3)][_0x44fc86],_0x44cea4=(_0x39be6c[_0x1dd050(0x11b)]||'')[_0x1dd050(0xbe)](),_0x37efd2=_0x44cea4[_0x1dd050(0xce)](_0x1dd050(0xe5))||_0x44cea4['includes'](_0x1dd050(0x106))||_0x44cea4[_0x1dd050(0xce)](_0x1dd050(0x10b))||_0x44cea4['includes']('heizung')||_0x44cea4[_0x1dd050(0xce)](_0x1dd050(0xe6));if(_0x37efd2&&typeof _0x488a33===_0x1dd050(0x105)){if(_0x488a33>0x50||_0x488a33<-0x32)return _0x7a6968[_0x1dd050(0xbd)][_0x1dd050(0xe7)](_0x1dd050(0xc0)+_0x488a33+_0x1dd050(0xfe)+_0x44fc86),null;}_0x7a6968[_0x1dd050(0xf3)][_0x44fc86]=_0x488a33;if(!_0x39be6c[_0x1dd050(0xbc)]&&_0x1d3c55!=undefined&&_0x1d3c55==_0x488a33)return null;_0x7a6968[_0x1dd050(0xc1)]&&_0x37efd2&&recordThermodynamics(_0x7a6968,_0x44fc86,_0x488a33,_0x39be6c['location']);const _0x42f0e7={'timestamp':_0x5d00ea,'id':_0x44fc86,'name':_0x39be6c[_0x1dd050(0xf1)],'type':_0x39be6c[_0x1dd050(0x11b)],'location':_0x39be6c[_0x1dd050(0xc5)],'value':_0x488a33};_0x7a6968[_0x1dd050(0xd7)]['unshift'](_0x42f0e7);if(_0x7a6968[_0x1dd050(0xd7)]['length']>HISTORY_MAX_SIZE)_0x7a6968[_0x1dd050(0xd7)][_0x1dd050(0x109)]();await _0x7a6968[_0x1dd050(0xe1)]('events.lastEvent',{'val':JSON['stringify'](_0x42f0e7),'ack':!![]}),await _0x7a6968[_0x1dd050(0xe1)]('events.history',{'val':JSON['stringify'](_0x7a6968[_0x1dd050(0xd7)]),'ack':!![]});if(_0x7a6968[_0x1dd050(0xc1)]){_0x7a6968['rawEventLog'][_0x1dd050(0xcc)](_0x42f0e7);if(_0x7a6968[_0x1dd050(0xeb)]['length']>RAW_LOG_MAX_SIZE)_0x7a6968[_0x1dd050(0xeb)][_0x1dd050(0xb5)](0x0,_0x7a6968['rawEventLog']['length']-RAW_LOG_MAX_SIZE);await _0x7a6968[_0x1dd050(0xe1)](_0x1dd050(0xe0),{'val':JSON[_0x1dd050(0xc4)](_0x7a6968['rawEventLog']),'ack':!![]}),recordSequence(_0x7a6968,_0x42f0e7);}if(_0x39be6c[_0x1dd050(0x102)]&&_0x488a33===!![]){if(_0x7a6968[_0x1dd050(0x10e)]&&!_0x7a6968[_0x1dd050(0x110)])startExitTimer(_0x7a6968);else{if(!_0x7a6968[_0x1dd050(0x10e)])setPresence(_0x7a6968,!![]);}}else{if(_0x39be6c[_0x1dd050(0x11b)]===_0x1dd050(0x103)&&_0x488a33===!![]){if(_0x7a6968[_0x1dd050(0x112)])abortExitTimer(_0x7a6968);if(!_0x7a6968[_0x1dd050(0x10e)]&&_0x7a6968['currentSystemMode']==='normal')setPresence(_0x7a6968,!![]);}}if(_0x7a6968[_0x1dd050(0xc1)]&&_0x7a6968[_0x1dd050(0xf5)]){_0x39be6c[_0x1dd050(0x11b)]==='motion'&&_0x488a33===!![]&&_0x39be6c[_0x1dd050(0xc5)]&&_0x7a6968['sendToPythonWrapper']('SIMULATE_SIGNAL',{'room':_0x39be6c['location']});const _0x4a2af8=[_0x1dd050(0xd0),_0x1dd050(0xcb),'window',_0x1dd050(0xd3),_0x1dd050(0xef),_0x1dd050(0xb7),'lock',_0x1dd050(0x111)][_0x1dd050(0xcf)](_0x17d4cf=>_0x44cea4[_0x1dd050(0xce)](_0x17d4cf)),_0x2fc5e4=['light',_0x1dd050(0x10c),_0x1dd050(0xf9),_0x1dd050(0x117),_0x1dd050(0xf0),_0x1dd050(0xfc)]['some'](_0x22ee88=>_0x44cea4[_0x1dd050(0xce)](_0x22ee88)),_0x5120ae=['motion',_0x1dd050(0xf4),_0x1dd050(0xf8),_0x1dd050(0x104),_0x1dd050(0xff)][_0x1dd050(0xcf)](_0x2b7959=>_0x44cea4['includes'](_0x2b7959));if(_0x39be6c[_0x1dd050(0xc5)]&&(_0x4a2af8||_0x2fc5e4||_0x5120ae)){const _0x2785bb=_0x488a33===!![]||typeof _0x488a33==='number'&&_0x488a33>0x0,_0x54a06c=_0x4a2af8&&!_0x2785bb&&_0x1d3c55!==undefined&&_0x1d3c55!=_0x488a33;if(_0x2785bb||_0x54a06c){const _0x155847=_0x7a6968[_0x1dd050(0xf7)]||_0x5d00ea,_0x35c225=(_0x5d00ea-_0x155847)/0x3e8;_0x7a6968[_0x1dd050(0xf7)]=_0x5d00ea,_0x7a6968['sendToPythonWrapper']('TRACK_EVENT',{'room':_0x39be6c[_0x1dd050(0xc5)],'dt':_0x35c225});}}}return _0x42f0e7;}module[a5_0x317ce7(0xed)]={'processSensorEvent':processSensorEvent,'getOutsideTemperatureNumeric':getOutsideTemperatureNumeric,'setPresence':setPresence,'abortExitTimer':abortExitTimer,'startExitTimer':startExitTimer};