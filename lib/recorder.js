(function(_0x4835a7,_0x39ca88){const _0x16919d=a5_0x3a1a,_0x5f3c65=_0x4835a7();while(!![]){try{const _0x31e1ac=parseInt(_0x16919d(0x115))/0x1+parseInt(_0x16919d(0x133))/0x2+-parseInt(_0x16919d(0x106))/0x3*(-parseInt(_0x16919d(0xf0))/0x4)+-parseInt(_0x16919d(0x119))/0x5*(parseInt(_0x16919d(0x125))/0x6)+-parseInt(_0x16919d(0x118))/0x7+parseInt(_0x16919d(0x13a))/0x8*(-parseInt(_0x16919d(0xec))/0x9)+parseInt(_0x16919d(0x10d))/0xa;if(_0x31e1ac===_0x39ca88)break;else _0x5f3c65['push'](_0x5f3c65['shift']());}catch(_0x290301){_0x5f3c65['push'](_0x5f3c65['shift']());}}}(a5_0x53fb,0x1aea2));const a5_0x10efea=(function(){let _0x315a7d=!![];return function(_0x32eebe,_0x290664){const _0x2b57da=_0x315a7d?function(){const _0xd0470e=a5_0x3a1a;if(_0x290664){const _0x487a31=_0x290664[_0xd0470e(0xf6)](_0x32eebe,arguments);return _0x290664=null,_0x487a31;}}:function(){};return _0x315a7d=![],_0x2b57da;};}()),a5_0x359d1b=a5_0x10efea(this,function(){const _0x332e0b=a5_0x3a1a;return a5_0x359d1b['toString']()['search'](_0x332e0b(0x138))[_0x332e0b(0x10f)]()['constructor'](a5_0x359d1b)[_0x332e0b(0xe9)](_0x332e0b(0x138));});a5_0x359d1b();'use strict';const HISTORY_MAX_SIZE=0x32,RAW_LOG_MAX_SIZE=0x9c4,THERMO_LOG_SIZE=0x3e8,SEQUENCE_TIMEOUT_MS=0x5*0x3c*0x3e8,MAX_TRAINING_SET_SIZE=0x1f4,EXIT_TIMER_MINUTES=0xf,EXIT_GRACE_PERIOD_SECONDS=0x1e;function a5_0x3a1a(_0xa06096,_0x15bc37){const _0x46bc16=a5_0x53fb();return a5_0x3a1a=function(_0x359d1b,_0x10efea){_0x359d1b=_0x359d1b-0xde;let _0x53fb6a=_0x46bc16[_0x359d1b];return _0x53fb6a;},a5_0x3a1a(_0xa06096,_0x15bc37);}let activeSequence=[],sequenceTimer=null;async function getOutsideTemperatureNumeric(_0x49ed6e){const _0x2871f7=a5_0x3a1a;if(_0x49ed6e[_0x2871f7(0x102)][_0x2871f7(0x10c)])try{const _0x4f33f5=await _0x49ed6e[_0x2871f7(0xef)](_0x49ed6e[_0x2871f7(0x102)][_0x2871f7(0x10c)]);if(_0x4f33f5&&_0x4f33f5['val']!==undefined&&_0x4f33f5['val']!==null)return parseFloat(_0x4f33f5[_0x2871f7(0x100)]);}catch(_0x302d2f){}const _0x1ea96d=_0x49ed6e['config'][_0x2871f7(0x132)];if(!_0x49ed6e['config'][_0x2871f7(0xeb)]||!_0x1ea96d)return null;try{let _0x5c5d03='';if(_0x1ea96d[_0x2871f7(0xf1)](_0x2871f7(0xe0)))_0x5c5d03=_0x1ea96d+_0x2871f7(0x12a);else{if(_0x1ea96d[_0x2871f7(0xf1)](_0x2871f7(0x135)))_0x5c5d03=_0x1ea96d+_0x2871f7(0x108);else{if(_0x1ea96d[_0x2871f7(0xf1)](_0x2871f7(0x137)))_0x5c5d03=_0x1ea96d+_0x2871f7(0xfb);else{if(_0x1ea96d[_0x2871f7(0xf1)](_0x2871f7(0xfc)))_0x5c5d03=_0x1ea96d+_0x2871f7(0xe6);}}}if(_0x5c5d03){const _0xdd8f96=await _0x49ed6e[_0x2871f7(0xef)](_0x5c5d03);if(_0xdd8f96&&_0xdd8f96[_0x2871f7(0x100)]!==undefined&&_0xdd8f96[_0x2871f7(0x100)]!==null)return parseFloat(_0xdd8f96[_0x2871f7(0x100)]);}}catch(_0x418244){}return null;}async function recordThermodynamics(_0x8fd4e6,_0xae88d9,_0x34816a,_0x11036d){const _0x465f60=a5_0x3a1a,_0x13a4ed=await getOutsideTemperatureNumeric(_0x8fd4e6);if(_0x13a4ed===null)return;let _0x1df534=0x0,_0x1d348e=![];if(_0x8fd4e6[_0x465f60(0x102)][_0x465f60(0xe2)])try{let _0x477787=_0x8fd4e6['config'][_0x465f60(0xe2)];if(typeof _0x477787===_0x465f60(0x12c))_0x477787=JSON[_0x465f60(0x101)](_0x477787);if(_0x477787[_0xae88d9]){const _0x1d817b=_0x477787[_0xae88d9],_0x3a1507=await _0x8fd4e6[_0x465f60(0xef)](_0x1d817b);if(_0x3a1507&&_0x3a1507[_0x465f60(0x100)]!==null&&_0x3a1507[_0x465f60(0x100)]!==undefined){let _0xdcdd0d=Number(_0x3a1507['val']);if(_0xdcdd0d<=1.05&&!_0x1d817b[_0x465f60(0xf1)]('STATUS')&&!_0x1d817b[_0x465f60(0xf1)](_0x465f60(0x11a)))_0xdcdd0d=_0xdcdd0d*0x64;_0x1df534=Math[_0x465f60(0x104)](_0xdcdd0d),_0x1d348e=!![];}}}catch(_0x566c6f){}if(!_0x1d348e){const _0x49199f=[{'from':_0x465f60(0xe8),'to':_0x465f60(0xf4)},{'from':_0x465f60(0xe8),'to':_0x465f60(0xde)},{'from':'.1.TEMPERATURE','to':'.4.VALVE_STATE'},{'from':'.ACTUAL_TEMPERATURE','to':_0x465f60(0x112)},{'from':'temperature','to':'level'},{'from':'Temperature','to':'Valve'}];for(const _0x16bb6e of _0x49199f){if(_0xae88d9[_0x465f60(0xf1)](_0x16bb6e['from'])){const _0x458f6a=_0xae88d9[_0x465f60(0xed)](_0x16bb6e[_0x465f60(0xfe)],_0x16bb6e['to']);try{const _0x136554=await _0x8fd4e6[_0x465f60(0xef)](_0x458f6a);if(_0x136554&&_0x136554[_0x465f60(0x100)]!==null&&_0x136554[_0x465f60(0x100)]!==undefined){let _0x55468b=Number(_0x136554[_0x465f60(0x100)]);if(typeof _0x55468b===_0x465f60(0xe3)){if(_0x55468b<=1.05&&_0x16bb6e['to'][_0x465f60(0xf1)](_0x465f60(0xf9)))_0x55468b=_0x55468b*0x64;_0x1df534=Math[_0x465f60(0x104)](_0x55468b),_0x1d348e=!![];break;}}}catch(_0x53122a){}}}}const _0x269acf=await _0x8fd4e6[_0x465f60(0x109)](_0x465f60(0x114));let _0xd8fb4c=[];if(_0x269acf&&_0x269acf[_0x465f60(0x100)])try{_0xd8fb4c=JSON[_0x465f60(0x101)](_0x269acf[_0x465f60(0x100)]);}catch(_0x505e59){}_0xd8fb4c[_0x465f60(0x11e)]({'ts':Date[_0x465f60(0x107)](),'room':_0x11036d||_0x465f60(0x131),'t_in':_0x34816a,'t_out':_0x13a4ed,'valve':_0x1df534});if(_0xd8fb4c['length']>THERMO_LOG_SIZE)_0xd8fb4c[_0x465f60(0xee)]();await _0x8fd4e6[_0x465f60(0x12d)](_0x465f60(0x114),{'val':JSON[_0x465f60(0x11f)](_0xd8fb4c),'ack':!![]});}async function saveCompletedSequence(_0x2eda0a){const _0x1db507=a5_0x3a1a;try{const _0x39e28b=await _0x2eda0a[_0x1db507(0x109)](_0x1db507(0xf2));let _0x420b9b=[];if(_0x39e28b&&_0x39e28b['val'])try{_0x420b9b=JSON[_0x1db507(0x101)](_0x39e28b[_0x1db507(0x100)]);}catch(_0xaf527){}const _0x1a3de6=activeSequence[0x0]['ts'],_0x488368=activeSequence[_0x1db507(0x136)](_0x48faf3=>({'loc':_0x48faf3['loc'],'t_delta':Math[_0x1db507(0x104)]((_0x48faf3['ts']-_0x1a3de6)/0x3e8)})),_0x8670b9={'timestamp':new Date(_0x1a3de6)['toISOString'](),'steps':_0x488368,'duration':Math[_0x1db507(0x104)]((activeSequence[activeSequence['length']-0x1]['ts']-_0x1a3de6)/0x3e8),'daytime':new Date(_0x1a3de6)[_0x1db507(0x10e)]()};_0x420b9b['push'](_0x8670b9);if(_0x420b9b[_0x1db507(0x128)]>MAX_TRAINING_SET_SIZE)_0x420b9b[_0x1db507(0xee)]();await _0x2eda0a[_0x1db507(0x12d)](_0x1db507(0xf2),{'val':JSON[_0x1db507(0x11f)](_0x420b9b),'ack':!![]}),_0x2eda0a[_0x1db507(0x12f)]&&_0x2eda0a[_0x1db507(0x116)]&&_0x2eda0a[_0x1db507(0x116)](_0x1db507(0xe4),{'sequence':_0x8670b9});}catch(_0x1d0934){_0x2eda0a['log'][_0x1db507(0x10b)]('[RECORDER]\x20Error:\x20'+_0x1d0934['message']);}}function a5_0x53fb(){const _0x3075df=['occupancy','LTM.trainingData.thermodynamics','6915XqNNSM','sendToPythonWrapper','contact','1403255ShRvZF','5rBkpHz','STATE','isGracePeriodActive','rawEventLog','fenster','push','stringify','light','isExit','kontakt','logDuplicates','tür','606396rfqUGC','eventHistory','pop','length','some','.Current.Temperature','events.history','string','setStateAsync','window','isProVersion','splice','Unknown','weatherInstance','350278GGpmvx','normal','daswetter','map','openweathermap','(((.+)+)+)+$','currentSystemMode','95960NDDquj','exitGraceTimer','.1.VALVE_STATE','dimmer','accuweather','toLowerCase','valveMapping','number','ANALYZE_SEQUENCE','location','.forecast.current.temp','isPresent','.1.ACTUAL_TEMPERATURE','search','door','useWeather','162GhClsI','replace','shift','getForeignStateAsync','268OSzpyg','includes','LTM.trainingData.sequences','licht','.1.LEVEL','value','apply','unshift','type','LEVEL','temperatur','.forecast.current.temperature','weatherunderground','schalter','from','exitTimer','val','parse','config','LTM.rawEventLog','round','switch','7941SgZBvo','now','.NextHours.Location_1.Day_1.current.temp_value','getStateAsync','motion','error','outdoorSensorId','2682800uODMxY','getHours','toString','events.lastEvent','bewegung','.LEVEL'];a5_0x53fb=function(){return _0x3075df;};return a5_0x53fb();}async function recordSequence(_0x2b3b25,_0x437e5a){const _0x29bb53=a5_0x3a1a,_0xb81d9b=(_0x437e5a[_0x29bb53(0xf8)]||'')[_0x29bb53(0xe1)](),_0x3095e3=[_0x29bb53(0x10a),_0x29bb53(0x111),'präsenz','presence',_0x29bb53(0x113),_0x29bb53(0xea),_0x29bb53(0x124),_0x29bb53(0x12e),_0x29bb53(0x11d),_0x29bb53(0x117),_0x29bb53(0x122),_0x29bb53(0x120),_0x29bb53(0xf3),_0x29bb53(0x105),_0x29bb53(0xfd),_0x29bb53(0xdf),'lampe'];if(!_0x3095e3[_0x29bb53(0x129)](_0x3e2bf9=>_0xb81d9b[_0x29bb53(0xf1)](_0x3e2bf9)))return;if(!_0x437e5a[_0x29bb53(0xf5)])return;if(sequenceTimer)clearTimeout(sequenceTimer);activeSequence[_0x29bb53(0x11e)]({'loc':_0x437e5a[_0x29bb53(0xe5)]||'Unknown','id':_0x437e5a['id'],'ts':Date[_0x29bb53(0x107)]()}),sequenceTimer=setTimeout(async()=>{const _0x6f7f72=_0x29bb53;if(activeSequence[_0x6f7f72(0x128)]>0x1)await saveCompletedSequence(_0x2b3b25);activeSequence=[];},SEQUENCE_TIMEOUT_MS);}function startExitTimer(_0x327884){const _0x5d1b48=a5_0x3a1a;abortExitTimer(_0x327884),_0x327884[_0x5d1b48(0x11b)]=!![],_0x327884[_0x5d1b48(0x13b)]=setTimeout(()=>{const _0x16a5d3=_0x5d1b48;_0x327884[_0x16a5d3(0x11b)]=![];},EXIT_GRACE_PERIOD_SECONDS*0x3e8),_0x327884['exitTimer']=setTimeout(()=>{const _0x2edd5b=_0x5d1b48;setPresence(_0x327884,![]),_0x327884[_0x2edd5b(0xff)]=null;},EXIT_TIMER_MINUTES*0x3c*0x3e8);}function abortExitTimer(_0x1c8306){const _0x2e8898=a5_0x3a1a;if(_0x1c8306[_0x2e8898(0xff)])clearTimeout(_0x1c8306[_0x2e8898(0xff)]);if(_0x1c8306[_0x2e8898(0x13b)])clearTimeout(_0x1c8306[_0x2e8898(0x13b)]);_0x1c8306['exitTimer']=null,_0x1c8306[_0x2e8898(0x13b)]=null,_0x1c8306[_0x2e8898(0x11b)]=![];}async function setPresence(_0x1f43ba,_0x2cd205){const _0x222730=a5_0x3a1a;if(_0x1f43ba[_0x222730(0xe7)]===_0x2cd205)return;_0x1f43ba[_0x222730(0xe7)]=_0x2cd205,await _0x1f43ba[_0x222730(0x12d)]('system.isPresent',{'val':_0x2cd205,'ack':!![]});}async function processSensorEvent(_0x54fd08,_0x4d9e54,_0xc53728,_0x21d823){const _0x51296d=a5_0x3a1a;if(!_0x21d823)return null;const _0x5db524=_0xc53728['val'],_0x547db8=Date[_0x51296d(0x107)](),_0x3a35e1=_0x54fd08['sensorLastValues'][_0x4d9e54];_0x54fd08['sensorLastValues'][_0x4d9e54]=_0x5db524;if(!_0x21d823[_0x51296d(0x123)]&&_0x3a35e1!=undefined&&_0x3a35e1==_0x5db524)return null;const _0x29738f=(_0x21d823[_0x51296d(0xf8)]||'')['toLowerCase'](),_0xb81f58=_0x29738f[_0x51296d(0xf1)]('temperature')||_0x29738f[_0x51296d(0xf1)](_0x51296d(0xfa))||_0x29738f['includes']('klima')||_0x29738f[_0x51296d(0xf1)]('heizung')||_0x29738f['includes']('thermostat');_0x54fd08[_0x51296d(0x12f)]&&_0xb81f58&&recordThermodynamics(_0x54fd08,_0x4d9e54,_0x5db524,_0x21d823[_0x51296d(0xe5)]);const _0x240101={'timestamp':_0x547db8,'id':_0x4d9e54,'name':_0x21d823['name'],'type':_0x21d823[_0x51296d(0xf8)],'location':_0x21d823[_0x51296d(0xe5)],'value':_0x5db524};_0x54fd08['eventHistory'][_0x51296d(0xf7)](_0x240101);if(_0x54fd08[_0x51296d(0x126)][_0x51296d(0x128)]>HISTORY_MAX_SIZE)_0x54fd08['eventHistory'][_0x51296d(0x127)]();await _0x54fd08['setStateAsync'](_0x51296d(0x110),{'val':JSON[_0x51296d(0x11f)](_0x240101),'ack':!![]}),await _0x54fd08[_0x51296d(0x12d)](_0x51296d(0x12b),{'val':JSON[_0x51296d(0x11f)](_0x54fd08['eventHistory']),'ack':!![]});if(_0x54fd08[_0x51296d(0x12f)]){_0x54fd08['rawEventLog'][_0x51296d(0x11e)](_0x240101);if(_0x54fd08[_0x51296d(0x11c)][_0x51296d(0x128)]>RAW_LOG_MAX_SIZE)_0x54fd08['rawEventLog'][_0x51296d(0x130)](0x0,_0x54fd08[_0x51296d(0x11c)][_0x51296d(0x128)]-RAW_LOG_MAX_SIZE);await _0x54fd08[_0x51296d(0x12d)](_0x51296d(0x103),{'val':JSON[_0x51296d(0x11f)](_0x54fd08['rawEventLog']),'ack':!![]}),recordSequence(_0x54fd08,_0x240101);}if(_0x21d823[_0x51296d(0x121)]&&_0x5db524===!![]){if(_0x54fd08[_0x51296d(0xe7)]&&!_0x54fd08[_0x51296d(0x11b)])startExitTimer(_0x54fd08);else{if(!_0x54fd08[_0x51296d(0xe7)])setPresence(_0x54fd08,!![]);}}else{if(_0x21d823[_0x51296d(0xf8)]===_0x51296d(0x10a)&&_0x5db524===!![]){if(_0x54fd08[_0x51296d(0xff)])abortExitTimer(_0x54fd08);if(!_0x54fd08[_0x51296d(0xe7)]&&_0x54fd08[_0x51296d(0x139)]===_0x51296d(0x134))setPresence(_0x54fd08,!![]);}}return _0x54fd08[_0x51296d(0x12f)]&&_0x21d823[_0x51296d(0xf8)]===_0x51296d(0x10a)&&_0x5db524===!![]&&_0x21d823[_0x51296d(0xe5)]&&_0x54fd08[_0x51296d(0x116)]&&_0x54fd08['sendToPythonWrapper']('SIMULATE_SIGNAL',{'room':_0x21d823[_0x51296d(0xe5)]}),_0x240101;}module['exports']={'processSensorEvent':processSensorEvent,'getOutsideTemperatureNumeric':getOutsideTemperatureNumeric,'setPresence':setPresence,'abortExitTimer':abortExitTimer,'startExitTimer':startExitTimer};