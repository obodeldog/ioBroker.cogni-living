(function(_0x30b539,_0x2bf84b){const _0x549973=a5_0x152f,_0x3a21b7=_0x30b539();while(!![]){try{const _0x4a28e9=parseInt(_0x549973(0x125))/0x1+parseInt(_0x549973(0x148))/0x2*(-parseInt(_0x549973(0x141))/0x3)+parseInt(_0x549973(0x109))/0x4*(parseInt(_0x549973(0x112))/0x5)+parseInt(_0x549973(0x129))/0x6*(parseInt(_0x549973(0x151))/0x7)+parseInt(_0x549973(0x15c))/0x8*(-parseInt(_0x549973(0x144))/0x9)+-parseInt(_0x549973(0x149))/0xa*(-parseInt(_0x549973(0x124))/0xb)+-parseInt(_0x549973(0x14d))/0xc;if(_0x4a28e9===_0x2bf84b)break;else _0x3a21b7['push'](_0x3a21b7['shift']());}catch(_0x462600){_0x3a21b7['push'](_0x3a21b7['shift']());}}}(a5_0x467b,0x962b8));const a5_0x11d539=(function(){let _0x531216=!![];return function(_0x4c1a7b,_0x4b6560){const _0x35154a=_0x531216?function(){const _0x120f80=a5_0x152f;if(_0x4b6560){const _0xbbb630=_0x4b6560[_0x120f80(0x159)](_0x4c1a7b,arguments);return _0x4b6560=null,_0xbbb630;}}:function(){};return _0x531216=![],_0x35154a;};}()),a5_0x304be2=a5_0x11d539(this,function(){const _0x4ffb00=a5_0x152f;return a5_0x304be2[_0x4ffb00(0x150)]()[_0x4ffb00(0x13c)](_0x4ffb00(0x10d))['toString']()[_0x4ffb00(0x14a)](a5_0x304be2)['search'](_0x4ffb00(0x10d));});a5_0x304be2();function a5_0x152f(_0xd377ac,_0x29a46c){const _0x2c08c9=a5_0x467b();return a5_0x152f=function(_0x304be2,_0x11d539){_0x304be2=_0x304be2-0x105;let _0x467b84=_0x2c08c9[_0x304be2];return _0x467b84;},a5_0x152f(_0xd377ac,_0x29a46c);}function a5_0x467b(){const _0x50aa68=['.4.VALVE_STATE','setStateAsync','isGracePeriodActive','891FFIzXZ','1026223NQYRQK','length','door','loc','6qHPCjX','value','exitGraceTimer','LTM.trainingData.thermodynamics','type','from','stringify','motion','replace','.LEVEL','now','.NextHours.Location_1.Day_1.current.temp_value','.Current.Temperature','.1.TEMPERATURE','logDuplicates','rawEventLog','config','exitTimer','location','search','round','events.lastEvent','weatherInstance','eventHistory','18630uvpVqY','.1.ACTUAL_TEMPERATURE','message','18KjuOzv','kontakt','includes','hm-rpc','142ytEjcB','117590nBtSqE','constructor','system.isPresent','contact','18860640WdybAQ','presence','schalter','toString','355705PJMaQx','log','.forecast.current.temperature','toLowerCase','some','push','tür','map','apply','getForeignStateAsync','window','1970904ZVfcDW','isPresent','currentSystemMode','outdoorSensorId','accuweather','isProVersion','sensorLastValues','4csGKdR','LEVEL','getHours','LTM.rawEventLog','(((.+)+)+)+$','daswetter','.1.VALVE_STATE','val','Unknown','5454675eLjQAy','temperature','sendToPythonWrapper','heizung','getStateAsync','fenster','useWeather','[RECORDER]\x20Error:\x20','events.history','temperatur','.1.LEVEL','normal','parse','light','switch'];a5_0x467b=function(){return _0x50aa68;};return a5_0x467b();}'use strict';const HISTORY_MAX_SIZE=0x32,RAW_LOG_MAX_SIZE=0x9c4,THERMO_LOG_SIZE=0x3e8,SEQUENCE_TIMEOUT_MS=0x5*0x3c*0x3e8,MAX_TRAINING_SET_SIZE=0x1f4,EXIT_TIMER_MINUTES=0xf,EXIT_GRACE_PERIOD_SECONDS=0x1e;let activeSequence=[],sequenceTimer=null;async function getOutsideTemperatureNumeric(_0xf3580e){const _0x21865b=a5_0x152f;if(_0xf3580e[_0x21865b(0x139)]['outdoorSensorId'])try{const _0xff617d=await _0xf3580e[_0x21865b(0x15a)](_0xf3580e[_0x21865b(0x139)][_0x21865b(0x105)]);if(_0xff617d&&_0xff617d[_0x21865b(0x110)]!==undefined&&_0xff617d[_0x21865b(0x110)]!==null)return parseFloat(_0xff617d[_0x21865b(0x110)]);}catch(_0x5f19ba){}const _0x325b78=_0xf3580e['config'][_0x21865b(0x13f)];if(!_0xf3580e['config'][_0x21865b(0x118)]||!_0x325b78)return null;try{let _0x43c8c3='';if(_0x325b78['includes'](_0x21865b(0x106)))_0x43c8c3=_0x325b78+_0x21865b(0x135);else{if(_0x325b78['includes'](_0x21865b(0x10e)))_0x43c8c3=_0x325b78+_0x21865b(0x134);else{if(_0x325b78[_0x21865b(0x146)]('openweathermap'))_0x43c8c3=_0x325b78+_0x21865b(0x153);else{if(_0x325b78[_0x21865b(0x146)]('weatherunderground'))_0x43c8c3=_0x325b78+'.forecast.current.temp';}}}if(_0x43c8c3){const _0x263fb6=await _0xf3580e[_0x21865b(0x15a)](_0x43c8c3);if(_0x263fb6&&_0x263fb6[_0x21865b(0x110)]!==undefined&&_0x263fb6[_0x21865b(0x110)]!==null)return parseFloat(_0x263fb6['val']);}}catch(_0x4d55dd){}return null;}async function recordThermodynamics(_0x2524a0,_0x1f9e81,_0x24a6ad,_0x423752){const _0x2e09b6=a5_0x152f,_0x440fa1=await getOutsideTemperatureNumeric(_0x2524a0);let _0x34817c=0x0;if(_0x1f9e81[_0x2e09b6(0x146)](_0x2e09b6(0x147))){const _0xc1bbb9=[{'from':_0x2e09b6(0x142),'to':_0x2e09b6(0x11c)},{'from':'.1.ACTUAL_TEMPERATURE','to':_0x2e09b6(0x10f)},{'from':_0x2e09b6(0x136),'to':_0x2e09b6(0x121)},{'from':'.ACTUAL_TEMPERATURE','to':_0x2e09b6(0x132)}];for(const _0x1a4216 of _0xc1bbb9){if(_0x1f9e81[_0x2e09b6(0x146)](_0x1a4216['from'])){const _0x4f019=_0x1f9e81[_0x2e09b6(0x131)](_0x1a4216[_0x2e09b6(0x12e)],_0x1a4216['to']);try{const _0x3b6912=await _0x2524a0['getForeignStateAsync'](_0x4f019);if(_0x3b6912&&_0x3b6912[_0x2e09b6(0x110)]!==null&&_0x3b6912[_0x2e09b6(0x110)]!==undefined){let _0x1d25e6=_0x3b6912['val'];typeof _0x1d25e6==='number'&&_0x1d25e6<=1.05&&_0x1a4216['to']['includes'](_0x2e09b6(0x10a))&&(_0x1d25e6=_0x1d25e6*0x64);_0x34817c=Math[_0x2e09b6(0x13d)](_0x1d25e6);break;}}catch(_0x45e940){}}}}const _0x4672d4=await _0x2524a0['getStateAsync'](_0x2e09b6(0x12c));let _0x159062=[];if(_0x4672d4&&_0x4672d4[_0x2e09b6(0x110)])try{_0x159062=JSON[_0x2e09b6(0x11e)](_0x4672d4[_0x2e09b6(0x110)]);}catch(_0xf201c9){}_0x159062[_0x2e09b6(0x156)]({'ts':Date['now'](),'room':_0x423752||_0x2e09b6(0x111),'t_in':_0x24a6ad,'t_out':_0x440fa1,'valve':_0x34817c});if(_0x159062[_0x2e09b6(0x126)]>THERMO_LOG_SIZE)_0x159062['shift']();await _0x2524a0[_0x2e09b6(0x122)](_0x2e09b6(0x12c),{'val':JSON[_0x2e09b6(0x12f)](_0x159062),'ack':!![]});}async function saveCompletedSequence(_0x2674ac){const _0x5d1401=a5_0x152f;try{const _0x3c5255=await _0x2674ac[_0x5d1401(0x116)]('LTM.trainingData.sequences');let _0x341263=[];if(_0x3c5255&&_0x3c5255['val'])try{_0x341263=JSON[_0x5d1401(0x11e)](_0x3c5255['val']);}catch(_0x5de45b){}const _0x1a9245=activeSequence[0x0]['ts'],_0x46f776=activeSequence[_0x5d1401(0x158)](_0x241934=>({'loc':_0x241934[_0x5d1401(0x128)],'t_delta':Math['round']((_0x241934['ts']-_0x1a9245)/0x3e8)})),_0x572a60={'timestamp':new Date(_0x1a9245)['toISOString'](),'steps':_0x46f776,'duration':Math[_0x5d1401(0x13d)]((activeSequence[activeSequence[_0x5d1401(0x126)]-0x1]['ts']-_0x1a9245)/0x3e8),'daytime':new Date(_0x1a9245)[_0x5d1401(0x10b)]()};_0x341263['push'](_0x572a60);if(_0x341263[_0x5d1401(0x126)]>MAX_TRAINING_SET_SIZE)_0x341263['shift']();await _0x2674ac[_0x5d1401(0x122)]('LTM.trainingData.sequences',{'val':JSON[_0x5d1401(0x12f)](_0x341263),'ack':!![]}),_0x2674ac[_0x5d1401(0x107)]&&_0x2674ac[_0x5d1401(0x114)]&&_0x2674ac[_0x5d1401(0x114)]('ANALYZE_SEQUENCE',{'sequence':_0x572a60});}catch(_0x5ce481){_0x2674ac[_0x5d1401(0x152)]['error'](_0x5d1401(0x119)+_0x5ce481[_0x5d1401(0x143)]);}}async function recordSequence(_0x7bb23b,_0x5dd516){const _0x19430e=a5_0x152f,_0x26046c=(_0x5dd516[_0x19430e(0x12d)]||'')[_0x19430e(0x154)](),_0x2115e9=[_0x19430e(0x130),'bewegung','präsenz',_0x19430e(0x14e),'occupancy',_0x19430e(0x127),_0x19430e(0x157),_0x19430e(0x15b),_0x19430e(0x117),_0x19430e(0x14c),_0x19430e(0x145),_0x19430e(0x11f),'licht',_0x19430e(0x120),_0x19430e(0x14f),'dimmer','lampe'];if(!_0x2115e9[_0x19430e(0x155)](_0x54655b=>_0x26046c[_0x19430e(0x146)](_0x54655b)))return;if(!_0x5dd516[_0x19430e(0x12a)])return;if(sequenceTimer)clearTimeout(sequenceTimer);activeSequence['push']({'loc':_0x5dd516[_0x19430e(0x13b)]||_0x19430e(0x111),'id':_0x5dd516['id'],'ts':Date[_0x19430e(0x133)]()}),sequenceTimer=setTimeout(async()=>{const _0x123441=_0x19430e;if(activeSequence[_0x123441(0x126)]>0x1)await saveCompletedSequence(_0x7bb23b);activeSequence=[];},SEQUENCE_TIMEOUT_MS);}function startExitTimer(_0xe871b2){const _0x5c264e=a5_0x152f;abortExitTimer(_0xe871b2),_0xe871b2['isGracePeriodActive']=!![],_0xe871b2[_0x5c264e(0x12b)]=setTimeout(()=>{_0xe871b2['isGracePeriodActive']=![];},EXIT_GRACE_PERIOD_SECONDS*0x3e8),_0xe871b2[_0x5c264e(0x13a)]=setTimeout(()=>{const _0x23a6fc=_0x5c264e;setPresence(_0xe871b2,![]),_0xe871b2[_0x23a6fc(0x13a)]=null;},EXIT_TIMER_MINUTES*0x3c*0x3e8);}function abortExitTimer(_0x26e27e){const _0x22b4ec=a5_0x152f;if(_0x26e27e[_0x22b4ec(0x13a)])clearTimeout(_0x26e27e['exitTimer']);if(_0x26e27e['exitGraceTimer'])clearTimeout(_0x26e27e['exitGraceTimer']);_0x26e27e[_0x22b4ec(0x13a)]=null,_0x26e27e['exitGraceTimer']=null,_0x26e27e['isGracePeriodActive']=![];}async function setPresence(_0x4b146d,_0x26c7c3){const _0x32d8ca=a5_0x152f;if(_0x4b146d['isPresent']===_0x26c7c3)return;_0x4b146d[_0x32d8ca(0x15d)]=_0x26c7c3,await _0x4b146d[_0x32d8ca(0x122)](_0x32d8ca(0x14b),{'val':_0x26c7c3,'ack':!![]});}async function processSensorEvent(_0x507281,_0x41adc9,_0x27bee0,_0x247da2){const _0x240875=a5_0x152f;if(!_0x247da2)return null;const _0x3d5110=_0x27bee0[_0x240875(0x110)],_0xadacee=Date[_0x240875(0x133)](),_0x3ce61f=_0x507281[_0x240875(0x108)][_0x41adc9];_0x507281[_0x240875(0x108)][_0x41adc9]=_0x3d5110;if(!_0x247da2[_0x240875(0x137)]&&_0x3ce61f!=undefined&&_0x3ce61f==_0x3d5110)return null;const _0x12241a=(_0x247da2[_0x240875(0x12d)]||'')[_0x240875(0x154)](),_0x4e0e0a=_0x12241a[_0x240875(0x146)](_0x240875(0x113))||_0x12241a[_0x240875(0x146)](_0x240875(0x11b))||_0x12241a[_0x240875(0x146)]('klima')||_0x12241a[_0x240875(0x146)](_0x240875(0x115));_0x507281[_0x240875(0x107)]&&_0x4e0e0a&&recordThermodynamics(_0x507281,_0x41adc9,_0x3d5110,_0x247da2[_0x240875(0x13b)]);const _0x3a1f6b={'timestamp':_0xadacee,'id':_0x41adc9,'name':_0x247da2['name'],'type':_0x247da2[_0x240875(0x12d)],'location':_0x247da2['location'],'value':_0x3d5110};_0x507281[_0x240875(0x140)]['unshift'](_0x3a1f6b);if(_0x507281['eventHistory']['length']>HISTORY_MAX_SIZE)_0x507281[_0x240875(0x140)]['pop']();await _0x507281[_0x240875(0x122)](_0x240875(0x13e),{'val':JSON[_0x240875(0x12f)](_0x3a1f6b),'ack':!![]}),await _0x507281[_0x240875(0x122)](_0x240875(0x11a),{'val':JSON[_0x240875(0x12f)](_0x507281[_0x240875(0x140)]),'ack':!![]});if(_0x507281[_0x240875(0x107)]){_0x507281[_0x240875(0x138)][_0x240875(0x156)](_0x3a1f6b);if(_0x507281['rawEventLog'][_0x240875(0x126)]>RAW_LOG_MAX_SIZE)_0x507281[_0x240875(0x138)]['splice'](0x0,_0x507281[_0x240875(0x138)][_0x240875(0x126)]-RAW_LOG_MAX_SIZE);await _0x507281[_0x240875(0x122)](_0x240875(0x10c),{'val':JSON[_0x240875(0x12f)](_0x507281['rawEventLog']),'ack':!![]}),recordSequence(_0x507281,_0x3a1f6b);}if(_0x247da2['isExit']&&_0x3d5110===!![]){if(_0x507281[_0x240875(0x15d)]&&!_0x507281[_0x240875(0x123)])startExitTimer(_0x507281);else{if(!_0x507281['isPresent'])setPresence(_0x507281,!![]);}}else{if(_0x247da2[_0x240875(0x12d)]===_0x240875(0x130)&&_0x3d5110===!![]){if(_0x507281['exitTimer'])abortExitTimer(_0x507281);if(!_0x507281[_0x240875(0x15d)]&&_0x507281[_0x240875(0x15e)]===_0x240875(0x11d))setPresence(_0x507281,!![]);}}return _0x507281[_0x240875(0x107)]&&_0x247da2['type']===_0x240875(0x130)&&_0x3d5110===!![]&&_0x247da2[_0x240875(0x13b)]&&_0x507281[_0x240875(0x114)]&&_0x507281[_0x240875(0x114)]('SIMULATE_SIGNAL',{'room':_0x247da2['location']}),_0x3a1f6b;}module['exports']={'processSensorEvent':processSensorEvent,'getOutsideTemperatureNumeric':getOutsideTemperatureNumeric,'setPresence':setPresence,'abortExitTimer':abortExitTimer,'startExitTimer':startExitTimer};