const a5_0xddc366=a5_0x1cd2;(function(_0x38d16b,_0x5b5f6e){const _0x8ee61f=a5_0x1cd2,_0x19b25d=_0x38d16b();while(!![]){try{const _0x5a1f74=-parseInt(_0x8ee61f(0x161))/0x1*(parseInt(_0x8ee61f(0x140))/0x2)+parseInt(_0x8ee61f(0x148))/0x3*(parseInt(_0x8ee61f(0x17e))/0x4)+-parseInt(_0x8ee61f(0x144))/0x5+-parseInt(_0x8ee61f(0x128))/0x6*(parseInt(_0x8ee61f(0x175))/0x7)+-parseInt(_0x8ee61f(0x118))/0x8+-parseInt(_0x8ee61f(0x155))/0x9*(parseInt(_0x8ee61f(0x132))/0xa)+parseInt(_0x8ee61f(0x182))/0xb*(parseInt(_0x8ee61f(0x15e))/0xc);if(_0x5a1f74===_0x5b5f6e)break;else _0x19b25d['push'](_0x19b25d['shift']());}catch(_0x5e1fd0){_0x19b25d['push'](_0x19b25d['shift']());}}}(a5_0x3369,0x69f91));const a5_0x437b51=(function(){let _0x16d702=!![];return function(_0x27c632,_0xbbde9e){const _0x19b875=_0x16d702?function(){if(_0xbbde9e){const _0x35d603=_0xbbde9e['apply'](_0x27c632,arguments);return _0xbbde9e=null,_0x35d603;}}:function(){};return _0x16d702=![],_0x19b875;};}()),a5_0x1e1a37=a5_0x437b51(this,function(){const _0x3e58d9=a5_0x1cd2;return a5_0x1e1a37[_0x3e58d9(0x136)]()[_0x3e58d9(0x149)]('(((.+)+)+)+$')[_0x3e58d9(0x136)]()[_0x3e58d9(0x15c)](a5_0x1e1a37)[_0x3e58d9(0x149)]('(((.+)+)+)+$');});a5_0x1e1a37();function a5_0x3369(){const _0x398e90=['eventHistory','switch','system.isPresent','1639692wRsOcE','LTM.rawEventLog','value','.LEVEL','bewegung','lampe','error','exports','handle','motion','40JyxCsX','map','events.lastEvent','getForeignStateAsync','toString','occupancy','lastTrackerEventTime','schloss','config','.forecast.current.temperature','\x20from\x20','TRACK_EVENT','fenster','presence','78JfYQwK','dimmer','type','SIMULATE_SIGNAL','2010955JShuKg','includes','LEVEL','ANALYZE_SEQUENCE','771QmsBAs','search','.1.ACTUAL_TEMPERATURE','heizung','getStateAsync','replace','schalter','licht','unshift','parse','.1.TEMPERATURE','[RECORDER]\x20Ignored\x20implausible\x20temperature:\x20','isGracePeriodActive','1055394QuoBQi','isProVersion','STATUS','weatherunderground','openweathermap','.1.VALVE_STATE','stringify','constructor','exitGraceTimer','31138980WDpxLg','Unknown','window','7374zFsFKp','sensorLastValues','events.history','round','debug','.ACTUAL_TEMPERATURE','.Current.Temperature','val','door','.4.VALVE_STATE','number','toLowerCase','accuweather','location','string','tür','contact','präsenz','currentSystemMode','temperature','14LoAFdI','name','temperatur','useWeather','klima','setStateAsync','rawEventLog','LTM.trainingData.thermodynamics','log','4040cIbVgQ','some','light','length','11XAfRSu','STATE','now','lock','push','sendToPythonWrapper','5720120DikXnZ','daswetter','toISOString','exitTimer','isPresent','logDuplicates','thermostat','weatherInstance','shift','loc','getHours','kontakt','LTM.trainingData.sequences'];a5_0x3369=function(){return _0x398e90;};return a5_0x3369();}'use strict';const HISTORY_MAX_SIZE=0x32,RAW_LOG_MAX_SIZE=0x9c4,THERMO_LOG_SIZE=0x3e8,SEQUENCE_TIMEOUT_MS=0x5*0x3c*0x3e8,MAX_TRAINING_SET_SIZE=0x1f4,EXIT_TIMER_MINUTES=0xf,EXIT_GRACE_PERIOD_SECONDS=0x1e;let activeSequence=[],sequenceTimer=null;async function getOutsideTemperatureNumeric(_0x2536f8){const _0x45d35c=a5_0x1cd2;if(_0x2536f8['config']['outdoorSensorId'])try{const _0x4e99cc=await _0x2536f8['getForeignStateAsync'](_0x2536f8[_0x45d35c(0x13a)]['outdoorSensorId']);if(_0x4e99cc&&_0x4e99cc[_0x45d35c(0x168)]!==undefined&&_0x4e99cc[_0x45d35c(0x168)]!==null)return parseFloat(_0x4e99cc[_0x45d35c(0x168)]);}catch(_0x268d0c){}const _0x54b27b=_0x2536f8[_0x45d35c(0x13a)][_0x45d35c(0x11f)];if(!_0x2536f8[_0x45d35c(0x13a)][_0x45d35c(0x178)]||!_0x54b27b)return null;try{let _0x42a107='';if(_0x54b27b[_0x45d35c(0x145)](_0x45d35c(0x16d)))_0x42a107=_0x54b27b+_0x45d35c(0x167);else{if(_0x54b27b['includes'](_0x45d35c(0x119)))_0x42a107=_0x54b27b+'.NextHours.Location_1.Day_1.current.temp_value';else{if(_0x54b27b[_0x45d35c(0x145)](_0x45d35c(0x159)))_0x42a107=_0x54b27b+_0x45d35c(0x13b);else{if(_0x54b27b[_0x45d35c(0x145)](_0x45d35c(0x158)))_0x42a107=_0x54b27b+'.forecast.current.temp';}}}if(_0x42a107){const _0x331337=await _0x2536f8[_0x45d35c(0x135)](_0x42a107);if(_0x331337&&_0x331337[_0x45d35c(0x168)]!==undefined&&_0x331337[_0x45d35c(0x168)]!==null)return parseFloat(_0x331337['val']);}}catch(_0x431352){}return null;}async function recordThermodynamics(_0x5793a8,_0x322de8,_0x1c0db6,_0x1b0087){const _0x430f00=a5_0x1cd2,_0x11b7ee=await getOutsideTemperatureNumeric(_0x5793a8);if(_0x11b7ee===null)return;let _0x377e6b=0x0,_0x490e0d=![];if(_0x5793a8[_0x430f00(0x13a)]['valveMapping'])try{let _0x34a832=_0x5793a8[_0x430f00(0x13a)]['valveMapping'];if(typeof _0x34a832===_0x430f00(0x16f))_0x34a832=JSON[_0x430f00(0x151)](_0x34a832);if(_0x34a832[_0x322de8]){const _0x834aa2=_0x34a832[_0x322de8],_0x1a5a2c=await _0x5793a8[_0x430f00(0x135)](_0x834aa2);if(_0x1a5a2c&&_0x1a5a2c['val']!==null&&_0x1a5a2c[_0x430f00(0x168)]!==undefined){let _0x151bae=Number(_0x1a5a2c[_0x430f00(0x168)]);if(_0x151bae<=1.05&&!_0x834aa2[_0x430f00(0x145)](_0x430f00(0x157))&&!_0x834aa2[_0x430f00(0x145)](_0x430f00(0x183)))_0x151bae=_0x151bae*0x64;_0x377e6b=Math['round'](_0x151bae),_0x490e0d=!![];}}}catch(_0x2798c4){}if(!_0x490e0d){const _0x2a9817=[{'from':'.1.ACTUAL_TEMPERATURE','to':'.1.LEVEL'},{'from':_0x430f00(0x14a),'to':_0x430f00(0x15a)},{'from':_0x430f00(0x152),'to':_0x430f00(0x16a)},{'from':_0x430f00(0x166),'to':_0x430f00(0x12b)},{'from':_0x430f00(0x174),'to':'level'},{'from':'Temperature','to':'Valve'}];for(const _0x26f6da of _0x2a9817){if(_0x322de8[_0x430f00(0x145)](_0x26f6da['from'])){const _0x135cee=_0x322de8[_0x430f00(0x14d)](_0x26f6da['from'],_0x26f6da['to']);try{const _0x35a47d=await _0x5793a8[_0x430f00(0x135)](_0x135cee);if(_0x35a47d&&_0x35a47d[_0x430f00(0x168)]!==null&&_0x35a47d[_0x430f00(0x168)]!==undefined){let _0x386f71=Number(_0x35a47d['val']);if(typeof _0x386f71===_0x430f00(0x16b)){if(_0x386f71<=1.05&&_0x26f6da['to'][_0x430f00(0x145)](_0x430f00(0x146)))_0x386f71=_0x386f71*0x64;_0x377e6b=Math[_0x430f00(0x164)](_0x386f71),_0x490e0d=!![];break;}}}catch(_0x1fc97d){}}}}const _0x8d3a12=await _0x5793a8[_0x430f00(0x14c)](_0x430f00(0x17c));let _0x5b25f4=[];if(_0x8d3a12&&_0x8d3a12[_0x430f00(0x168)])try{_0x5b25f4=JSON['parse'](_0x8d3a12['val']);}catch(_0x4e4e48){}_0x5b25f4[_0x430f00(0x116)]({'ts':Date[_0x430f00(0x114)](),'room':_0x1b0087||_0x430f00(0x15f),'t_in':_0x1c0db6,'t_out':_0x11b7ee,'valve':_0x377e6b});if(_0x5b25f4[_0x430f00(0x181)]>THERMO_LOG_SIZE)_0x5b25f4[_0x430f00(0x120)]();await _0x5793a8[_0x430f00(0x17a)](_0x430f00(0x17c),{'val':JSON[_0x430f00(0x15b)](_0x5b25f4),'ack':!![]});}async function saveCompletedSequence(_0x4d9688){const _0x2226e1=a5_0x1cd2;try{const _0x5b3afd=await _0x4d9688[_0x2226e1(0x14c)](_0x2226e1(0x124));let _0x4c733f=[];if(_0x5b3afd&&_0x5b3afd[_0x2226e1(0x168)])try{_0x4c733f=JSON[_0x2226e1(0x151)](_0x5b3afd['val']);}catch(_0x1e5cab){}const _0x468455=activeSequence[0x0]['ts'],_0x57f85f=activeSequence[_0x2226e1(0x133)](_0x19d346=>({'loc':_0x19d346[_0x2226e1(0x121)],'t_delta':Math[_0x2226e1(0x164)]((_0x19d346['ts']-_0x468455)/0x3e8)})),_0x5e474c={'timestamp':new Date(_0x468455)[_0x2226e1(0x11a)](),'steps':_0x57f85f,'duration':Math[_0x2226e1(0x164)]((activeSequence[activeSequence['length']-0x1]['ts']-_0x468455)/0x3e8),'daytime':new Date(_0x468455)[_0x2226e1(0x122)]()};_0x4c733f[_0x2226e1(0x116)](_0x5e474c);if(_0x4c733f[_0x2226e1(0x181)]>MAX_TRAINING_SET_SIZE)_0x4c733f[_0x2226e1(0x120)]();await _0x4d9688[_0x2226e1(0x17a)](_0x2226e1(0x124),{'val':JSON['stringify'](_0x4c733f),'ack':!![]}),_0x4d9688['isProVersion']&&_0x4d9688[_0x2226e1(0x117)]&&_0x4d9688[_0x2226e1(0x117)](_0x2226e1(0x147),{'sequence':_0x5e474c});}catch(_0x3a8656){_0x4d9688['log'][_0x2226e1(0x12e)]('[RECORDER]\x20Error:\x20'+_0x3a8656['message']);}}async function recordSequence(_0x38ba67,_0x55794b){const _0x5061b7=a5_0x1cd2,_0x89b2a2=(_0x55794b[_0x5061b7(0x142)]||'')[_0x5061b7(0x16c)](),_0x7ac9b2=[_0x5061b7(0x131),_0x5061b7(0x12c),_0x5061b7(0x172),_0x5061b7(0x13f),_0x5061b7(0x137),_0x5061b7(0x169),_0x5061b7(0x170),'window','fenster',_0x5061b7(0x171),_0x5061b7(0x123),_0x5061b7(0x180),_0x5061b7(0x14f),_0x5061b7(0x126),'schalter',_0x5061b7(0x141),_0x5061b7(0x12d)];if(!_0x7ac9b2['some'](_0x1ee47c=>_0x89b2a2[_0x5061b7(0x145)](_0x1ee47c)))return;if(!_0x55794b[_0x5061b7(0x12a)])return;if(sequenceTimer)clearTimeout(sequenceTimer);activeSequence[_0x5061b7(0x116)]({'loc':_0x55794b[_0x5061b7(0x16e)]||_0x5061b7(0x15f),'id':_0x55794b['id'],'ts':Date[_0x5061b7(0x114)]()}),sequenceTimer=setTimeout(async()=>{const _0x472f9e=_0x5061b7;if(activeSequence[_0x472f9e(0x181)]>0x1)await saveCompletedSequence(_0x38ba67);activeSequence=[];},SEQUENCE_TIMEOUT_MS);}function startExitTimer(_0x5e945d){const _0x2b0107=a5_0x1cd2;abortExitTimer(_0x5e945d),_0x5e945d[_0x2b0107(0x154)]=!![],_0x5e945d[_0x2b0107(0x15d)]=setTimeout(()=>{_0x5e945d['isGracePeriodActive']=![];},EXIT_GRACE_PERIOD_SECONDS*0x3e8),_0x5e945d[_0x2b0107(0x11b)]=setTimeout(()=>{const _0x333ced=_0x2b0107;setPresence(_0x5e945d,![]),_0x5e945d[_0x333ced(0x11b)]=null;},EXIT_TIMER_MINUTES*0x3c*0x3e8);}function abortExitTimer(_0x5a2155){const _0x3dbef0=a5_0x1cd2;if(_0x5a2155[_0x3dbef0(0x11b)])clearTimeout(_0x5a2155[_0x3dbef0(0x11b)]);if(_0x5a2155['exitGraceTimer'])clearTimeout(_0x5a2155[_0x3dbef0(0x15d)]);_0x5a2155[_0x3dbef0(0x11b)]=null,_0x5a2155['exitGraceTimer']=null,_0x5a2155[_0x3dbef0(0x154)]=![];}function a5_0x1cd2(_0x569a8b,_0x451c91){const _0x35c97c=a5_0x3369();return a5_0x1cd2=function(_0x1e1a37,_0x437b51){_0x1e1a37=_0x1e1a37-0x114;let _0x3369c5=_0x35c97c[_0x1e1a37];return _0x3369c5;},a5_0x1cd2(_0x569a8b,_0x451c91);}async function setPresence(_0x4dd361,_0x192023){const _0x1886dc=a5_0x1cd2;if(_0x4dd361[_0x1886dc(0x11c)]===_0x192023)return;_0x4dd361[_0x1886dc(0x11c)]=_0x192023,await _0x4dd361[_0x1886dc(0x17a)](_0x1886dc(0x127),{'val':_0x192023,'ack':!![]});}async function processSensorEvent(_0x353789,_0x20e3f3,_0x5d0c44,_0x4d47ff){const _0x575e27=a5_0x1cd2;if(!_0x4d47ff)return null;const _0x4a5015=_0x5d0c44[_0x575e27(0x168)],_0x57a35c=Date['now'](),_0x3a4f6d=_0x353789['sensorLastValues'][_0x20e3f3],_0x4c9541=(_0x4d47ff[_0x575e27(0x142)]||'')['toLowerCase'](),_0xc8d4c4=_0x4c9541[_0x575e27(0x145)]('temperature')||_0x4c9541[_0x575e27(0x145)](_0x575e27(0x177))||_0x4c9541['includes'](_0x575e27(0x179))||_0x4c9541['includes'](_0x575e27(0x14b))||_0x4c9541[_0x575e27(0x145)](_0x575e27(0x11e));if(_0xc8d4c4&&typeof _0x4a5015===_0x575e27(0x16b)){if(_0x4a5015>0x50||_0x4a5015<-0x32)return _0x353789[_0x575e27(0x17d)][_0x575e27(0x165)](_0x575e27(0x153)+_0x4a5015+_0x575e27(0x13c)+_0x20e3f3),null;}_0x353789[_0x575e27(0x162)][_0x20e3f3]=_0x4a5015;if(!_0x4d47ff[_0x575e27(0x11d)]&&_0x3a4f6d!=undefined&&_0x3a4f6d==_0x4a5015)return null;_0x353789['isProVersion']&&_0xc8d4c4&&recordThermodynamics(_0x353789,_0x20e3f3,_0x4a5015,_0x4d47ff[_0x575e27(0x16e)]);const _0xd2ce44={'timestamp':_0x57a35c,'id':_0x20e3f3,'name':_0x4d47ff[_0x575e27(0x176)],'type':_0x4d47ff[_0x575e27(0x142)],'location':_0x4d47ff[_0x575e27(0x16e)],'value':_0x4a5015};_0x353789[_0x575e27(0x125)][_0x575e27(0x150)](_0xd2ce44);if(_0x353789['eventHistory']['length']>HISTORY_MAX_SIZE)_0x353789[_0x575e27(0x125)]['pop']();await _0x353789[_0x575e27(0x17a)](_0x575e27(0x134),{'val':JSON[_0x575e27(0x15b)](_0xd2ce44),'ack':!![]}),await _0x353789[_0x575e27(0x17a)](_0x575e27(0x163),{'val':JSON[_0x575e27(0x15b)](_0x353789[_0x575e27(0x125)]),'ack':!![]});if(_0x353789[_0x575e27(0x156)]){_0x353789[_0x575e27(0x17b)][_0x575e27(0x116)](_0xd2ce44);if(_0x353789['rawEventLog'][_0x575e27(0x181)]>RAW_LOG_MAX_SIZE)_0x353789[_0x575e27(0x17b)]['splice'](0x0,_0x353789[_0x575e27(0x17b)][_0x575e27(0x181)]-RAW_LOG_MAX_SIZE);await _0x353789[_0x575e27(0x17a)](_0x575e27(0x129),{'val':JSON[_0x575e27(0x15b)](_0x353789[_0x575e27(0x17b)]),'ack':!![]}),recordSequence(_0x353789,_0xd2ce44);}if(_0x4d47ff['isExit']&&_0x4a5015===!![]){if(_0x353789['isPresent']&&!_0x353789['isGracePeriodActive'])startExitTimer(_0x353789);else{if(!_0x353789[_0x575e27(0x11c)])setPresence(_0x353789,!![]);}}else{if(_0x4d47ff[_0x575e27(0x142)]===_0x575e27(0x131)&&_0x4a5015===!![]){if(_0x353789[_0x575e27(0x11b)])abortExitTimer(_0x353789);if(!_0x353789[_0x575e27(0x11c)]&&_0x353789[_0x575e27(0x173)]==='normal')setPresence(_0x353789,!![]);}}if(_0x353789[_0x575e27(0x156)]&&_0x353789[_0x575e27(0x117)]){_0x4d47ff[_0x575e27(0x142)]===_0x575e27(0x131)&&_0x4a5015===!![]&&_0x4d47ff[_0x575e27(0x16e)]&&_0x353789[_0x575e27(0x117)](_0x575e27(0x143),{'room':_0x4d47ff['location']});const _0x1432bf=[_0x575e27(0x169),_0x575e27(0x170),_0x575e27(0x160),_0x575e27(0x13e),'griff',_0x575e27(0x130),_0x575e27(0x115),_0x575e27(0x139)][_0x575e27(0x17f)](_0x26b833=>_0x4c9541['includes'](_0x26b833)),_0x40e951=['light',_0x575e27(0x14f),'switch',_0x575e27(0x14e),_0x575e27(0x141),_0x575e27(0x12d)]['some'](_0x1b8de1=>_0x4c9541[_0x575e27(0x145)](_0x1b8de1)),_0x227e17=[_0x575e27(0x131),_0x575e27(0x12c),_0x575e27(0x172),_0x575e27(0x13f),'occupancy'][_0x575e27(0x17f)](_0x122ba2=>_0x4c9541[_0x575e27(0x145)](_0x122ba2));if(_0x4d47ff[_0x575e27(0x16e)]&&(_0x1432bf||_0x40e951||_0x227e17)){const _0x424ef1=_0x4a5015===!![]||typeof _0x4a5015==='number'&&_0x4a5015>0x0,_0x42a8dc=_0x1432bf&&!_0x424ef1&&_0x3a4f6d!==undefined&&_0x3a4f6d!=_0x4a5015;if(_0x424ef1||_0x42a8dc){const _0x26caeb=_0x353789[_0x575e27(0x138)]||_0x57a35c,_0x2e2378=(_0x57a35c-_0x26caeb)/0x3e8;_0x353789[_0x575e27(0x138)]=_0x57a35c,_0x353789['sendToPythonWrapper'](_0x575e27(0x13d),{'room':_0x4d47ff[_0x575e27(0x16e)],'dt':_0x2e2378});}}}return _0xd2ce44;}module[a5_0xddc366(0x12f)]={'processSensorEvent':processSensorEvent,'getOutsideTemperatureNumeric':getOutsideTemperatureNumeric,'setPresence':setPresence,'abortExitTimer':abortExitTimer,'startExitTimer':startExitTimer};