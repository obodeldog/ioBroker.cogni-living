const a5_0x330074=a5_0x3507;(function(_0xe00b07,_0x1dd620){const _0x13f2e3=a5_0x3507,_0x2221ff=_0xe00b07();while(!![]){try{const _0x4d3644=parseInt(_0x13f2e3(0xc3))/0x1+-parseInt(_0x13f2e3(0xa1))/0x2*(parseInt(_0x13f2e3(0xdc))/0x3)+parseInt(_0x13f2e3(0x95))/0x4*(parseInt(_0x13f2e3(0x97))/0x5)+-parseInt(_0x13f2e3(0x7e))/0x6+-parseInt(_0x13f2e3(0xa8))/0x7+parseInt(_0x13f2e3(0x82))/0x8+parseInt(_0x13f2e3(0x7b))/0x9*(parseInt(_0x13f2e3(0xbd))/0xa);if(_0x4d3644===_0x1dd620)break;else _0x2221ff['push'](_0x2221ff['shift']());}catch(_0x3cb68f){_0x2221ff['push'](_0x2221ff['shift']());}}}(a5_0x4abe,0xa180b));const a5_0x584b54=(function(){let _0xb5d5e8=!![];return function(_0x5731c1,_0x449969){const _0x35ed93=_0xb5d5e8?function(){const _0x163ab7=a5_0x3507;if(_0x449969){const _0x556603=_0x449969[_0x163ab7(0x91)](_0x5731c1,arguments);return _0x449969=null,_0x556603;}}:function(){};return _0xb5d5e8=![],_0x35ed93;};}()),a5_0x21a7fa=a5_0x584b54(this,function(){const _0x2fde39=a5_0x3507;return a5_0x21a7fa[_0x2fde39(0x78)]()[_0x2fde39(0x88)](_0x2fde39(0x94))[_0x2fde39(0x78)]()[_0x2fde39(0xda)](a5_0x21a7fa)[_0x2fde39(0x88)](_0x2fde39(0x94));});a5_0x21a7fa();'use strict';function a5_0x4abe(){const _0x31b260=['2696631owtqbM','griff','[RECORDER]\x20Ignored\x20implausible\x20temperature:\x20','val','length','fenster','window','.LEVEL','shift','klima','thermostat','toString','isGracePeriodActive','ANALYZE_SEQUENCE','21996891jzZthb','motion','LTM.rawEventLog','7062762TftFwo','error','heizung','exitTimer','196160uOfbOO','kontakt','LTM.trainingData.sequences','TRACK_EVENT','lampe','schloss','search','LTM.trainingData.thermodynamics','Temperature','.1.TEMPERATURE','accuweather','sendToPythonWrapper','temperatur','.forecast.current.temperature','log','apply','value','lastTrackerEventTime','(((.+)+)+)+$','140KqTxkW','daswetter','124205krkZJZ','.ACTUAL_TEMPERATURE','currentSystemMode','level','setStateAsync','STATUS','config','isExit','präsenz','Unknown','2fsGxAw','eventHistory','light','splice','licht','useWeather','presence','9073043JpWQrn','.forecast.current.temp','.4.VALVE_STATE','round','from','schalter','exports','some','.1.LEVEL','isPresent','contact','exitGraceTimer','number','events.history','stringify','toLowerCase','getForeignStateAsync','valveMapping','door','[RECORDER]\x20Error:\x20','unshift','10tQwqJI','sensorLastValues','location','tür','name','events.lastEvent','695614hzrzqi','Valve','occupancy','debug','getHours','includes','isProVersion','.1.ACTUAL_TEMPERATURE','rawEventLog','switch','type','normal','logDuplicates','push','SIMULATE_SIGNAL','getStateAsync','\x20from\x20','dimmer','parse','.1.VALVE_STATE','handle','weatherInstance','now','constructor','replace'];a5_0x4abe=function(){return _0x31b260;};return a5_0x4abe();}const HISTORY_MAX_SIZE=0x32,RAW_LOG_MAX_SIZE=0x9c4,THERMO_LOG_SIZE=0x3e8,SEQUENCE_TIMEOUT_MS=0x5*0x3c*0x3e8,MAX_TRAINING_SET_SIZE=0x1f4,EXIT_TIMER_MINUTES=0xf,EXIT_GRACE_PERIOD_SECONDS=0x1e;let activeSequence=[],sequenceTimer=null;async function getOutsideTemperatureNumeric(_0x447ce8){const _0x156aec=a5_0x3507;if(_0x447ce8[_0x156aec(0x9d)]['outdoorSensorId'])try{const _0x38f45c=await _0x447ce8[_0x156aec(0xb8)](_0x447ce8[_0x156aec(0x9d)]['outdoorSensorId']);if(_0x38f45c&&_0x38f45c[_0x156aec(0xdf)]!==undefined&&_0x38f45c[_0x156aec(0xdf)]!==null)return parseFloat(_0x38f45c[_0x156aec(0xdf)]);}catch(_0x15f752){}const _0x413f47=_0x447ce8[_0x156aec(0x9d)][_0x156aec(0xd8)];if(!_0x447ce8[_0x156aec(0x9d)][_0x156aec(0xa6)]||!_0x413f47)return null;try{let _0x4b1fed='';if(_0x413f47['includes'](_0x156aec(0x8c)))_0x4b1fed=_0x413f47+'.Current.Temperature';else{if(_0x413f47[_0x156aec(0xc8)](_0x156aec(0x96)))_0x4b1fed=_0x413f47+'.NextHours.Location_1.Day_1.current.temp_value';else{if(_0x413f47[_0x156aec(0xc8)]('openweathermap'))_0x4b1fed=_0x413f47+_0x156aec(0x8f);else{if(_0x413f47[_0x156aec(0xc8)]('weatherunderground'))_0x4b1fed=_0x413f47+_0x156aec(0xa9);}}}if(_0x4b1fed){const _0x24509b=await _0x447ce8[_0x156aec(0xb8)](_0x4b1fed);if(_0x24509b&&_0x24509b[_0x156aec(0xdf)]!==undefined&&_0x24509b[_0x156aec(0xdf)]!==null)return parseFloat(_0x24509b[_0x156aec(0xdf)]);}}catch(_0xcf531f){}return null;}async function recordThermodynamics(_0xc51e12,_0x488eaf,_0x120479,_0x5987f6){const _0x142a74=a5_0x3507,_0x41f3d3=await getOutsideTemperatureNumeric(_0xc51e12);if(_0x41f3d3===null)return;let _0x1d5049=0x0,_0x3a6b0a=![];if(_0xc51e12['config'][_0x142a74(0xb9)])try{let _0x15f7f0=_0xc51e12['config'][_0x142a74(0xb9)];if(typeof _0x15f7f0==='string')_0x15f7f0=JSON[_0x142a74(0xd5)](_0x15f7f0);if(_0x15f7f0[_0x488eaf]){const _0x59fec4=_0x15f7f0[_0x488eaf],_0x2b5c97=await _0xc51e12[_0x142a74(0xb8)](_0x59fec4);if(_0x2b5c97&&_0x2b5c97[_0x142a74(0xdf)]!==null&&_0x2b5c97[_0x142a74(0xdf)]!==undefined){let _0x43ecb2=Number(_0x2b5c97[_0x142a74(0xdf)]);if(_0x43ecb2<=1.05&&!_0x59fec4[_0x142a74(0xc8)](_0x142a74(0x9c))&&!_0x59fec4['includes']('STATE'))_0x43ecb2=_0x43ecb2*0x64;_0x1d5049=Math['round'](_0x43ecb2),_0x3a6b0a=!![];}}}catch(_0x29b31e){}if(!_0x3a6b0a){const _0x12b1af=[{'from':'.1.ACTUAL_TEMPERATURE','to':_0x142a74(0xb0)},{'from':_0x142a74(0xca),'to':_0x142a74(0xd6)},{'from':_0x142a74(0x8b),'to':_0x142a74(0xaa)},{'from':_0x142a74(0x98),'to':_0x142a74(0x74)},{'from':'temperature','to':_0x142a74(0x9a)},{'from':_0x142a74(0x8a),'to':_0x142a74(0xc4)}];for(const _0x2f151d of _0x12b1af){if(_0x488eaf[_0x142a74(0xc8)](_0x2f151d[_0x142a74(0xac)])){const _0x222713=_0x488eaf[_0x142a74(0xdb)](_0x2f151d[_0x142a74(0xac)],_0x2f151d['to']);try{const _0x1db596=await _0xc51e12[_0x142a74(0xb8)](_0x222713);if(_0x1db596&&_0x1db596['val']!==null&&_0x1db596[_0x142a74(0xdf)]!==undefined){let _0x573059=Number(_0x1db596[_0x142a74(0xdf)]);if(typeof _0x573059===_0x142a74(0xb4)){if(_0x573059<=1.05&&_0x2f151d['to'][_0x142a74(0xc8)]('LEVEL'))_0x573059=_0x573059*0x64;_0x1d5049=Math[_0x142a74(0xab)](_0x573059),_0x3a6b0a=!![];break;}}}catch(_0x201cba){}}}}const _0x187de5=await _0xc51e12[_0x142a74(0xd2)](_0x142a74(0x89));let _0x27b9e2=[];if(_0x187de5&&_0x187de5[_0x142a74(0xdf)])try{_0x27b9e2=JSON[_0x142a74(0xd5)](_0x187de5[_0x142a74(0xdf)]);}catch(_0x206a03){}_0x27b9e2[_0x142a74(0xd0)]({'ts':Date[_0x142a74(0xd9)](),'room':_0x5987f6||_0x142a74(0xa0),'t_in':_0x120479,'t_out':_0x41f3d3,'valve':_0x1d5049});if(_0x27b9e2[_0x142a74(0xe0)]>THERMO_LOG_SIZE)_0x27b9e2[_0x142a74(0x75)]();await _0xc51e12[_0x142a74(0x9b)](_0x142a74(0x89),{'val':JSON[_0x142a74(0xb6)](_0x27b9e2),'ack':!![]});}async function saveCompletedSequence(_0x20a9a8){const _0x3f6dc8=a5_0x3507;try{const _0x554edc=await _0x20a9a8[_0x3f6dc8(0xd2)](_0x3f6dc8(0x84));let _0x384586=[];if(_0x554edc&&_0x554edc[_0x3f6dc8(0xdf)])try{_0x384586=JSON[_0x3f6dc8(0xd5)](_0x554edc[_0x3f6dc8(0xdf)]);}catch(_0x3148f6){}const _0x37a99f=activeSequence[0x0]['ts'],_0xaae959=activeSequence['map'](_0x518e36=>({'loc':_0x518e36['loc'],'t_delta':Math['round']((_0x518e36['ts']-_0x37a99f)/0x3e8)})),_0x5794d1={'timestamp':new Date(_0x37a99f)['toISOString'](),'steps':_0xaae959,'duration':Math[_0x3f6dc8(0xab)]((activeSequence[activeSequence[_0x3f6dc8(0xe0)]-0x1]['ts']-_0x37a99f)/0x3e8),'daytime':new Date(_0x37a99f)[_0x3f6dc8(0xc7)]()};_0x384586[_0x3f6dc8(0xd0)](_0x5794d1);if(_0x384586[_0x3f6dc8(0xe0)]>MAX_TRAINING_SET_SIZE)_0x384586[_0x3f6dc8(0x75)]();await _0x20a9a8[_0x3f6dc8(0x9b)](_0x3f6dc8(0x84),{'val':JSON[_0x3f6dc8(0xb6)](_0x384586),'ack':!![]}),_0x20a9a8[_0x3f6dc8(0xc9)]&&_0x20a9a8[_0x3f6dc8(0x8d)]&&_0x20a9a8[_0x3f6dc8(0x8d)](_0x3f6dc8(0x7a),{'sequence':_0x5794d1});}catch(_0x139448){_0x20a9a8[_0x3f6dc8(0x90)][_0x3f6dc8(0x7f)](_0x3f6dc8(0xbb)+_0x139448['message']);}}async function recordSequence(_0x49a8e1,_0x296dd1){const _0x1e5a27=a5_0x3507,_0x2df032=(_0x296dd1[_0x1e5a27(0xcd)]||'')[_0x1e5a27(0xb7)](),_0x4ecd93=[_0x1e5a27(0x7c),'bewegung','präsenz',_0x1e5a27(0xa7),_0x1e5a27(0xc5),_0x1e5a27(0xba),_0x1e5a27(0xc0),_0x1e5a27(0xe2),_0x1e5a27(0xe1),_0x1e5a27(0xb2),_0x1e5a27(0x83),'light','licht',_0x1e5a27(0xcc),_0x1e5a27(0xad),_0x1e5a27(0xd4),_0x1e5a27(0x86)];if(!_0x4ecd93[_0x1e5a27(0xaf)](_0x4c32dc=>_0x2df032['includes'](_0x4c32dc)))return;if(!_0x296dd1[_0x1e5a27(0x92)])return;if(sequenceTimer)clearTimeout(sequenceTimer);activeSequence[_0x1e5a27(0xd0)]({'loc':_0x296dd1['location']||'Unknown','id':_0x296dd1['id'],'ts':Date[_0x1e5a27(0xd9)]()}),sequenceTimer=setTimeout(async()=>{const _0x367a30=_0x1e5a27;if(activeSequence[_0x367a30(0xe0)]>0x1)await saveCompletedSequence(_0x49a8e1);activeSequence=[];},SEQUENCE_TIMEOUT_MS);}function startExitTimer(_0x1409b3){const _0x151b2c=a5_0x3507;abortExitTimer(_0x1409b3),_0x1409b3[_0x151b2c(0x79)]=!![],_0x1409b3[_0x151b2c(0xb3)]=setTimeout(()=>{const _0x199879=_0x151b2c;_0x1409b3[_0x199879(0x79)]=![];},EXIT_GRACE_PERIOD_SECONDS*0x3e8),_0x1409b3[_0x151b2c(0x81)]=setTimeout(()=>{setPresence(_0x1409b3,![]),_0x1409b3['exitTimer']=null;},EXIT_TIMER_MINUTES*0x3c*0x3e8);}function abortExitTimer(_0x5bd322){const _0x991c01=a5_0x3507;if(_0x5bd322[_0x991c01(0x81)])clearTimeout(_0x5bd322[_0x991c01(0x81)]);if(_0x5bd322[_0x991c01(0xb3)])clearTimeout(_0x5bd322['exitGraceTimer']);_0x5bd322[_0x991c01(0x81)]=null,_0x5bd322[_0x991c01(0xb3)]=null,_0x5bd322['isGracePeriodActive']=![];}async function setPresence(_0x1dc049,_0x24cefc){const _0x2ac3b5=a5_0x3507;if(_0x1dc049[_0x2ac3b5(0xb1)]===_0x24cefc)return;_0x1dc049[_0x2ac3b5(0xb1)]=_0x24cefc,await _0x1dc049['setStateAsync']('system.isPresent',{'val':_0x24cefc,'ack':!![]});}function a5_0x3507(_0x30dc7b,_0x302526){const _0x910e56=a5_0x4abe();return a5_0x3507=function(_0x21a7fa,_0x584b54){_0x21a7fa=_0x21a7fa-0x74;let _0x4abe50=_0x910e56[_0x21a7fa];return _0x4abe50;},a5_0x3507(_0x30dc7b,_0x302526);}async function processSensorEvent(_0x1babb4,_0xd527e7,_0x1990d8,_0xf5cd66){const _0x457c9b=a5_0x3507;if(!_0xf5cd66)return null;const _0x5b19f7=_0x1990d8[_0x457c9b(0xdf)],_0x8effc4=Date[_0x457c9b(0xd9)](),_0x1d6bdb=_0x1babb4[_0x457c9b(0xbe)][_0xd527e7],_0x397eb4=(_0xf5cd66[_0x457c9b(0xcd)]||'')[_0x457c9b(0xb7)](),_0x480645=_0x397eb4[_0x457c9b(0xc8)]('temperature')||_0x397eb4[_0x457c9b(0xc8)](_0x457c9b(0x8e))||_0x397eb4[_0x457c9b(0xc8)](_0x457c9b(0x76))||_0x397eb4[_0x457c9b(0xc8)](_0x457c9b(0x80))||_0x397eb4[_0x457c9b(0xc8)](_0x457c9b(0x77));if(_0x480645&&typeof _0x5b19f7===_0x457c9b(0xb4)){if(_0x5b19f7>0x50||_0x5b19f7<-0x32)return _0x1babb4[_0x457c9b(0x90)][_0x457c9b(0xc6)](_0x457c9b(0xde)+_0x5b19f7+_0x457c9b(0xd3)+_0xd527e7),null;}_0x1babb4[_0x457c9b(0xbe)][_0xd527e7]=_0x5b19f7;if(!_0xf5cd66[_0x457c9b(0xcf)]&&_0x1d6bdb!=undefined&&_0x1d6bdb==_0x5b19f7)return null;_0x1babb4[_0x457c9b(0xc9)]&&_0x480645&&recordThermodynamics(_0x1babb4,_0xd527e7,_0x5b19f7,_0xf5cd66['location']);const _0x3a6425={'timestamp':_0x8effc4,'id':_0xd527e7,'name':_0xf5cd66[_0x457c9b(0xc1)],'type':_0xf5cd66[_0x457c9b(0xcd)],'location':_0xf5cd66[_0x457c9b(0xbf)],'value':_0x5b19f7};_0x1babb4[_0x457c9b(0xa2)][_0x457c9b(0xbc)](_0x3a6425);if(_0x1babb4[_0x457c9b(0xa2)]['length']>HISTORY_MAX_SIZE)_0x1babb4['eventHistory']['pop']();await _0x1babb4[_0x457c9b(0x9b)](_0x457c9b(0xc2),{'val':JSON[_0x457c9b(0xb6)](_0x3a6425),'ack':!![]}),await _0x1babb4[_0x457c9b(0x9b)](_0x457c9b(0xb5),{'val':JSON[_0x457c9b(0xb6)](_0x1babb4['eventHistory']),'ack':!![]});if(_0x1babb4[_0x457c9b(0xc9)]){_0x1babb4[_0x457c9b(0xcb)][_0x457c9b(0xd0)](_0x3a6425);if(_0x1babb4[_0x457c9b(0xcb)][_0x457c9b(0xe0)]>RAW_LOG_MAX_SIZE)_0x1babb4['rawEventLog'][_0x457c9b(0xa4)](0x0,_0x1babb4[_0x457c9b(0xcb)][_0x457c9b(0xe0)]-RAW_LOG_MAX_SIZE);await _0x1babb4[_0x457c9b(0x9b)](_0x457c9b(0x7d),{'val':JSON[_0x457c9b(0xb6)](_0x1babb4[_0x457c9b(0xcb)]),'ack':!![]}),recordSequence(_0x1babb4,_0x3a6425);}if(_0xf5cd66[_0x457c9b(0x9e)]&&_0x5b19f7===!![]){if(_0x1babb4['isPresent']&&!_0x1babb4[_0x457c9b(0x79)])startExitTimer(_0x1babb4);else{if(!_0x1babb4[_0x457c9b(0xb1)])setPresence(_0x1babb4,!![]);}}else{if(_0xf5cd66['type']===_0x457c9b(0x7c)&&_0x5b19f7===!![]){if(_0x1babb4[_0x457c9b(0x81)])abortExitTimer(_0x1babb4);if(!_0x1babb4[_0x457c9b(0xb1)]&&_0x1babb4[_0x457c9b(0x99)]===_0x457c9b(0xce))setPresence(_0x1babb4,!![]);}}if(_0x1babb4[_0x457c9b(0xc9)]&&_0x1babb4[_0x457c9b(0x8d)]){_0xf5cd66[_0x457c9b(0xcd)]===_0x457c9b(0x7c)&&_0x5b19f7===!![]&&_0xf5cd66[_0x457c9b(0xbf)]&&_0x1babb4[_0x457c9b(0x8d)](_0x457c9b(0xd1),{'room':_0xf5cd66[_0x457c9b(0xbf)]});const _0x56cbe9=[_0x457c9b(0xba),_0x457c9b(0xc0),'window',_0x457c9b(0xe1),_0x457c9b(0xdd),_0x457c9b(0xd7),'lock',_0x457c9b(0x87)][_0x457c9b(0xaf)](_0x40ee93=>_0x397eb4['includes'](_0x40ee93)),_0x246c2d=[_0x457c9b(0xa3),_0x457c9b(0xa5),'switch',_0x457c9b(0xad),_0x457c9b(0xd4),_0x457c9b(0x86)][_0x457c9b(0xaf)](_0x5d13db=>_0x397eb4[_0x457c9b(0xc8)](_0x5d13db)),_0x177c48=['motion','bewegung',_0x457c9b(0x9f),_0x457c9b(0xa7),_0x457c9b(0xc5)][_0x457c9b(0xaf)](_0x30d696=>_0x397eb4[_0x457c9b(0xc8)](_0x30d696));if(_0xf5cd66[_0x457c9b(0xbf)]&&(_0x56cbe9||_0x246c2d||_0x177c48)){const _0x31afbc=_0x5b19f7===!![]||typeof _0x5b19f7===_0x457c9b(0xb4)&&_0x5b19f7>0x0,_0x38ab44=_0x56cbe9&&!_0x31afbc&&_0x1d6bdb!==undefined&&_0x1d6bdb!=_0x5b19f7;if(_0x31afbc||_0x38ab44){const _0x140938=_0x1babb4[_0x457c9b(0x93)]||_0x8effc4,_0x2dfc84=(_0x8effc4-_0x140938)/0x3e8;_0x1babb4[_0x457c9b(0x93)]=_0x8effc4,_0x1babb4[_0x457c9b(0x8d)](_0x457c9b(0x85),{'room':_0xf5cd66[_0x457c9b(0xbf)],'dt':_0x2dfc84});}}}return _0x3a6425;}module[a5_0x330074(0xae)]={'processSensorEvent':processSensorEvent,'getOutsideTemperatureNumeric':getOutsideTemperatureNumeric,'setPresence':setPresence,'abortExitTimer':abortExitTimer,'startExitTimer':startExitTimer};