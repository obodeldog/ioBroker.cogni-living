const a5_0x30565d=a5_0x279f;(function(_0x298175,_0x33f6d2){const _0x3c773f=a5_0x279f,_0x172465=_0x298175();while(!![]){try{const _0x2e0279=-parseInt(_0x3c773f(0xc2))/0x1*(parseInt(_0x3c773f(0xf2))/0x2)+parseInt(_0x3c773f(0xa4))/0x3+-parseInt(_0x3c773f(0xa3))/0x4+parseInt(_0x3c773f(0x105))/0x5+parseInt(_0x3c773f(0xb7))/0x6*(-parseInt(_0x3c773f(0xf4))/0x7)+parseInt(_0x3c773f(0xd6))/0x8+-parseInt(_0x3c773f(0xca))/0x9*(-parseInt(_0x3c773f(0x111))/0xa);if(_0x2e0279===_0x33f6d2)break;else _0x172465['push'](_0x172465['shift']());}catch(_0x5530c8){_0x172465['push'](_0x172465['shift']());}}}(a5_0x857e,0x2f169));const a5_0x1234f6=(function(){let _0x38a8e5=!![];return function(_0x67e6b5,_0x94be1a){const _0x1d79b8=_0x38a8e5?function(){if(_0x94be1a){const _0x1aab72=_0x94be1a['apply'](_0x67e6b5,arguments);return _0x94be1a=null,_0x1aab72;}}:function(){};return _0x38a8e5=![],_0x1d79b8;};}()),a5_0x171aad=a5_0x1234f6(this,function(){const _0x407b28=a5_0x279f;return a5_0x171aad[_0x407b28(0xaf)]()[_0x407b28(0xfa)](_0x407b28(0x110))[_0x407b28(0xaf)]()[_0x407b28(0xb4)](a5_0x171aad)[_0x407b28(0xfa)]('(((.+)+)+)+$');});a5_0x171aad();'use strict';const HISTORY_MAX_SIZE=0x32,RAW_LOG_MAX_SIZE=0x9c4,THERMO_LOG_SIZE=0x3e8,SEQUENCE_TIMEOUT_MS=0x5*0x3c*0x3e8,MAX_TRAINING_SET_SIZE=0x1f4,EXIT_TIMER_MINUTES=0xf,EXIT_GRACE_PERIOD_SECONDS=0x1e;let activeSequence=[],sequenceTimer=null;async function getOutsideTemperatureNumeric(_0x45da6b){const _0x429bcd=a5_0x279f;if(_0x45da6b[_0x429bcd(0xb2)][_0x429bcd(0xcb)])try{const _0xda43e7=await _0x45da6b[_0x429bcd(0x101)](_0x45da6b['config'][_0x429bcd(0xcb)]);if(_0xda43e7&&_0xda43e7[_0x429bcd(0x113)]!==undefined&&_0xda43e7[_0x429bcd(0x113)]!==null)return parseFloat(_0xda43e7[_0x429bcd(0x113)]);}catch(_0xa389bd){}const _0x39f852=_0x45da6b['config'][_0x429bcd(0xc5)];if(!_0x45da6b[_0x429bcd(0xb2)][_0x429bcd(0xa8)]||!_0x39f852)return null;try{let _0x53bdca='';if(_0x39f852[_0x429bcd(0xa5)](_0x429bcd(0xff)))_0x53bdca=_0x39f852+_0x429bcd(0xb3);else{if(_0x39f852[_0x429bcd(0xa5)](_0x429bcd(0xdd)))_0x53bdca=_0x39f852+'.NextHours.Location_1.Day_1.current.temp_value';else{if(_0x39f852[_0x429bcd(0xa5)]('openweathermap'))_0x53bdca=_0x39f852+_0x429bcd(0xae);else{if(_0x39f852[_0x429bcd(0xa5)](_0x429bcd(0xac)))_0x53bdca=_0x39f852+_0x429bcd(0x108);}}}if(_0x53bdca){const _0x318a0c=await _0x45da6b[_0x429bcd(0x101)](_0x53bdca);if(_0x318a0c&&_0x318a0c[_0x429bcd(0x113)]!==undefined&&_0x318a0c[_0x429bcd(0x113)]!==null)return parseFloat(_0x318a0c[_0x429bcd(0x113)]);}}catch(_0x3b74ae){}return null;}async function recordThermodynamics(_0x36597b,_0xa33403,_0x5446b4,_0x2e3461){const _0x3dec8=a5_0x279f,_0x3b8e84=await getOutsideTemperatureNumeric(_0x36597b);if(_0x3b8e84===null)return;let _0x4939e9=0x0,_0x24c825=![];if(_0x36597b[_0x3dec8(0xb2)][_0x3dec8(0xf1)])try{let _0x4b02e1=_0x36597b['config'][_0x3dec8(0xf1)];if(typeof _0x4b02e1==='string')_0x4b02e1=JSON[_0x3dec8(0xc1)](_0x4b02e1);if(_0x4b02e1[_0xa33403]){const _0x160eb2=_0x4b02e1[_0xa33403],_0x41eef2=await _0x36597b['getForeignStateAsync'](_0x160eb2);if(_0x41eef2&&_0x41eef2[_0x3dec8(0x113)]!==null&&_0x41eef2[_0x3dec8(0x113)]!==undefined){let _0x59679f=Number(_0x41eef2[_0x3dec8(0x113)]);if(_0x59679f<=1.05&&!_0x160eb2[_0x3dec8(0xa5)]('STATUS')&&!_0x160eb2[_0x3dec8(0xa5)](_0x3dec8(0xf0)))_0x59679f=_0x59679f*0x64;_0x4939e9=Math['round'](_0x59679f),_0x24c825=!![];}}}catch(_0x90f564){}if(!_0x24c825){const _0x5f4e9e=[{'from':_0x3dec8(0xd1),'to':'.1.LEVEL'},{'from':_0x3dec8(0xd1),'to':_0x3dec8(0x104)},{'from':_0x3dec8(0xc9),'to':_0x3dec8(0x114)},{'from':'.ACTUAL_TEMPERATURE','to':_0x3dec8(0x10b)},{'from':_0x3dec8(0xd4),'to':_0x3dec8(0xc8)},{'from':_0x3dec8(0xe4),'to':_0x3dec8(0x10c)}];for(const _0x247cf0 of _0x5f4e9e){if(_0xa33403[_0x3dec8(0xa5)](_0x247cf0['from'])){const _0x470a46=_0xa33403[_0x3dec8(0x10f)](_0x247cf0[_0x3dec8(0x100)],_0x247cf0['to']);try{const _0x4ece2b=await _0x36597b['getForeignStateAsync'](_0x470a46);if(_0x4ece2b&&_0x4ece2b['val']!==null&&_0x4ece2b[_0x3dec8(0x113)]!==undefined){let _0x23ab33=Number(_0x4ece2b[_0x3dec8(0x113)]);if(typeof _0x23ab33===_0x3dec8(0x10d)){if(_0x23ab33<=1.05&&_0x247cf0['to'][_0x3dec8(0xa5)](_0x3dec8(0xb8)))_0x23ab33=_0x23ab33*0x64;_0x4939e9=Math[_0x3dec8(0xf8)](_0x23ab33),_0x24c825=!![];break;}}}catch(_0x127c4c){}}}}const _0xa512ed=await _0x36597b[_0x3dec8(0xf5)]('LTM.trainingData.thermodynamics');let _0x250629=[];if(_0xa512ed&&_0xa512ed[_0x3dec8(0x113)])try{_0x250629=JSON['parse'](_0xa512ed[_0x3dec8(0x113)]);}catch(_0x6f5c0a){}_0x250629[_0x3dec8(0xed)]({'ts':Date[_0x3dec8(0x112)](),'room':_0x2e3461||_0x3dec8(0xa7),'t_in':_0x5446b4,'t_out':_0x3b8e84,'valve':_0x4939e9});if(_0x250629['length']>THERMO_LOG_SIZE)_0x250629[_0x3dec8(0xdf)]();await _0x36597b[_0x3dec8(0xf7)](_0x3dec8(0xe5),{'val':JSON[_0x3dec8(0xe2)](_0x250629),'ack':!![]});}async function saveCompletedSequence(_0x6cb3d7){const _0x265342=a5_0x279f;try{const _0x208844=await _0x6cb3d7[_0x265342(0xf5)](_0x265342(0x109));let _0x9e9c91=[];if(_0x208844&&_0x208844[_0x265342(0x113)])try{_0x9e9c91=JSON[_0x265342(0xc1)](_0x208844[_0x265342(0x113)]);}catch(_0x46d215){}const _0x30e641=activeSequence[0x0]['ts'],_0x1bdabe=activeSequence[_0x265342(0x102)](_0x522642=>({'loc':_0x522642[_0x265342(0xd2)],'t_delta':Math['round']((_0x522642['ts']-_0x30e641)/0x3e8)})),_0x13e08={'timestamp':new Date(_0x30e641)[_0x265342(0xd0)](),'steps':_0x1bdabe,'duration':Math[_0x265342(0xf8)]((activeSequence[activeSequence['length']-0x1]['ts']-_0x30e641)/0x3e8),'daytime':new Date(_0x30e641)['getHours']()};_0x9e9c91[_0x265342(0xed)](_0x13e08);if(_0x9e9c91[_0x265342(0xba)]>MAX_TRAINING_SET_SIZE)_0x9e9c91['shift']();await _0x6cb3d7['setStateAsync'](_0x265342(0x109),{'val':JSON[_0x265342(0xe2)](_0x9e9c91),'ack':!![]}),_0x6cb3d7['isProVersion']&&_0x6cb3d7[_0x265342(0xcd)]&&_0x6cb3d7[_0x265342(0xcd)](_0x265342(0xdc),{'sequence':_0x13e08});}catch(_0x31d14e){_0x6cb3d7['log'][_0x265342(0xcc)](_0x265342(0xc3)+_0x31d14e[_0x265342(0xec)]);}}function a5_0x857e(){const _0x20df7d=['fill','temperatur','some','message','push','handle','window','STATE','valveMapping','20302OCiwZz','isExit','9338lrhnMt','getStateAsync','lastTrackerEventTime','setStateAsync','round','analysis.health.todayVector','search','exitGraceTimer','SIMULATE_SIGNAL','exports','location','accuweather','from','getForeignStateAsync','map','system.isPresent','.1.VALVE_STATE','1235345qgwFNw','isPresent','klima','.forecast.current.temp','LTM.trainingData.sequences','toLowerCase','.LEVEL','Valve','number','schloss','replace','(((.+)+)+)+$','2810370MXDuVO','now','val','.4.VALVE_STATE','1414760bEwEXd','936627FXpNNV','includes','schalter','Unknown','useWeather','lampe','currentSystemMode','exitTimer','weatherunderground','motion','.forecast.current.temperature','toString','events.lastEvent','light','config','.Current.Temperature','constructor','eventHistory','logDuplicates','450QNGpWt','LEVEL','occupancy','length','unshift','kontakt','contact','type','getDate','isProVersion','parse','32YkrrMT','[RECORDER]\x20Error:\x20','splice','weatherInstance','switch','pop','level','.1.TEMPERATURE','9axuPkx','outdoorSensorId','error','sendToPythonWrapper','präsenz','dimmer','toISOString','.1.ACTUAL_TEMPERATURE','loc','debug','temperature','isGracePeriodActive','1049040eTJNLc','events.history','rawEventLog','tür','name','LTM.rawEventLog','ANALYZE_SEQUENCE','daswetter','presence','shift','sensorLastValues','log','stringify','fenster','Temperature','LTM.trainingData.thermodynamics','thermostat','bewegung','heizung'];a5_0x857e=function(){return _0x20df7d;};return a5_0x857e();}async function recordSequence(_0x1c26c6,_0x1d4b6b){const _0x2d9cd3=a5_0x279f,_0x3628be=(_0x1d4b6b['type']||'')[_0x2d9cd3(0x10a)](),_0x3a475d=[_0x2d9cd3(0xad),'bewegung',_0x2d9cd3(0xce),_0x2d9cd3(0xde),_0x2d9cd3(0xb9),'door','tür',_0x2d9cd3(0xef),_0x2d9cd3(0xe3),_0x2d9cd3(0xbd),_0x2d9cd3(0xbc),_0x2d9cd3(0xb1),'licht',_0x2d9cd3(0xc6),_0x2d9cd3(0xa6),_0x2d9cd3(0xcf),_0x2d9cd3(0xa9)];if(!_0x3a475d['some'](_0x4908da=>_0x3628be[_0x2d9cd3(0xa5)](_0x4908da)))return;if(!_0x1d4b6b['value'])return;if(sequenceTimer)clearTimeout(sequenceTimer);activeSequence[_0x2d9cd3(0xed)]({'loc':_0x1d4b6b[_0x2d9cd3(0xfe)]||_0x2d9cd3(0xa7),'id':_0x1d4b6b['id'],'ts':Date['now']()}),sequenceTimer=setTimeout(async()=>{if(activeSequence['length']>0x1)await saveCompletedSequence(_0x1c26c6);activeSequence=[];},SEQUENCE_TIMEOUT_MS);}function startExitTimer(_0x441a80){const _0x2ff96b=a5_0x279f;abortExitTimer(_0x441a80),_0x441a80[_0x2ff96b(0xd5)]=!![],_0x441a80[_0x2ff96b(0xfb)]=setTimeout(()=>{const _0x455f6c=_0x2ff96b;_0x441a80[_0x455f6c(0xd5)]=![];},EXIT_GRACE_PERIOD_SECONDS*0x3e8),_0x441a80[_0x2ff96b(0xab)]=setTimeout(()=>{const _0x199fef=_0x2ff96b;setPresence(_0x441a80,![]),_0x441a80[_0x199fef(0xab)]=null;},EXIT_TIMER_MINUTES*0x3c*0x3e8);}function abortExitTimer(_0x5527d1){const _0x5b66f5=a5_0x279f;if(_0x5527d1[_0x5b66f5(0xab)])clearTimeout(_0x5527d1['exitTimer']);if(_0x5527d1[_0x5b66f5(0xfb)])clearTimeout(_0x5527d1[_0x5b66f5(0xfb)]);_0x5527d1[_0x5b66f5(0xab)]=null,_0x5527d1[_0x5b66f5(0xfb)]=null,_0x5527d1['isGracePeriodActive']=![];}async function setPresence(_0x29e50c,_0x2738fe){const _0x145b10=a5_0x279f;if(_0x29e50c['isPresent']===_0x2738fe)return;_0x29e50c[_0x145b10(0x106)]=_0x2738fe,await _0x29e50c['setStateAsync'](_0x145b10(0x103),{'val':_0x2738fe,'ack':!![]});}function a5_0x279f(_0x38b19b,_0x5a9533){const _0x18d6a1=a5_0x857e();return a5_0x279f=function(_0x171aad,_0x1234f6){_0x171aad=_0x171aad-0xa3;let _0x857edb=_0x18d6a1[_0x171aad];return _0x857edb;},a5_0x279f(_0x38b19b,_0x5a9533);}async function updateHourlyActivity(_0x20dae3){const _0x49405f=a5_0x279f;let _0x321c95=new Array(0x18)[_0x49405f(0xe9)](0x0),_0x2f0727=0x0;try{const _0x166a9b=await _0x20dae3[_0x49405f(0xf5)]('analysis.health.todayVector');_0x166a9b&&_0x166a9b[_0x49405f(0x113)]&&(_0x321c95=JSON[_0x49405f(0xc1)](_0x166a9b[_0x49405f(0x113)]),_0x2f0727=_0x166a9b['ts']);}catch(_0x1ad92a){}const _0x543ff5=new Date(_0x2f0727),_0x353201=new Date();_0x543ff5[_0x49405f(0xbf)]()!==_0x353201[_0x49405f(0xbf)]()&&(_0x321c95=new Array(0x18)[_0x49405f(0xe9)](0x0));const _0x538717=_0x353201['getHours']();if(_0x321c95[_0x538717]===undefined)_0x321c95[_0x538717]=0x0;_0x321c95[_0x538717]++,await _0x20dae3[_0x49405f(0xf7)](_0x49405f(0xf9),{'val':JSON['stringify'](_0x321c95),'ack':!![]});}async function processSensorEvent(_0x95b564,_0x2bf6eb,_0x31b276,_0x2bb914){const _0x3bf3f4=a5_0x279f;if(!_0x2bb914)return null;const _0x2f413b=_0x31b276[_0x3bf3f4(0x113)],_0x41fc3e=Date[_0x3bf3f4(0x112)](),_0x2f4115=_0x95b564['sensorLastValues'][_0x2bf6eb],_0x349260=(_0x2bb914['type']||'')['toLowerCase'](),_0x300b4b=_0x349260[_0x3bf3f4(0xa5)](_0x3bf3f4(0xd4))||_0x349260['includes'](_0x3bf3f4(0xea))||_0x349260[_0x3bf3f4(0xa5)](_0x3bf3f4(0x107))||_0x349260['includes'](_0x3bf3f4(0xe8))||_0x349260[_0x3bf3f4(0xa5)](_0x3bf3f4(0xe6));if(_0x300b4b&&typeof _0x2f413b===_0x3bf3f4(0x10d)){if(_0x2f413b>0x50||_0x2f413b<-0x32)return _0x95b564[_0x3bf3f4(0xe1)][_0x3bf3f4(0xd3)]('[RECORDER]\x20Ignored\x20implausible\x20temperature:\x20'+_0x2f413b+'\x20from\x20'+_0x2bf6eb),null;}_0x95b564[_0x3bf3f4(0xe0)][_0x2bf6eb]=_0x2f413b;if(!_0x2bb914[_0x3bf3f4(0xb6)]&&_0x2f4115!=undefined&&_0x2f4115==_0x2f413b)return null;_0x95b564[_0x3bf3f4(0xc0)]&&_0x300b4b&&recordThermodynamics(_0x95b564,_0x2bf6eb,_0x2f413b,_0x2bb914[_0x3bf3f4(0xfe)]);const _0x189aad={'timestamp':_0x41fc3e,'id':_0x2bf6eb,'name':_0x2bb914[_0x3bf3f4(0xda)],'type':_0x2bb914['type'],'location':_0x2bb914[_0x3bf3f4(0xfe)],'value':_0x2f413b};_0x95b564[_0x3bf3f4(0xb5)][_0x3bf3f4(0xbb)](_0x189aad);if(_0x95b564[_0x3bf3f4(0xb5)]['length']>HISTORY_MAX_SIZE)_0x95b564[_0x3bf3f4(0xb5)][_0x3bf3f4(0xc7)]();await _0x95b564[_0x3bf3f4(0xf7)](_0x3bf3f4(0xb0),{'val':JSON['stringify'](_0x189aad),'ack':!![]}),await _0x95b564[_0x3bf3f4(0xf7)](_0x3bf3f4(0xd7),{'val':JSON[_0x3bf3f4(0xe2)](_0x95b564[_0x3bf3f4(0xb5)]),'ack':!![]}),await updateHourlyActivity(_0x95b564);if(_0x95b564[_0x3bf3f4(0xc0)]){_0x95b564[_0x3bf3f4(0xd8)][_0x3bf3f4(0xed)](_0x189aad);if(_0x95b564[_0x3bf3f4(0xd8)]['length']>RAW_LOG_MAX_SIZE)_0x95b564[_0x3bf3f4(0xd8)][_0x3bf3f4(0xc4)](0x0,_0x95b564['rawEventLog'][_0x3bf3f4(0xba)]-RAW_LOG_MAX_SIZE);await _0x95b564[_0x3bf3f4(0xf7)](_0x3bf3f4(0xdb),{'val':JSON[_0x3bf3f4(0xe2)](_0x95b564['rawEventLog']),'ack':!![]}),recordSequence(_0x95b564,_0x189aad);}if(_0x2bb914[_0x3bf3f4(0xf3)]&&_0x2f413b===!![]){if(_0x95b564['isPresent']&&!_0x95b564[_0x3bf3f4(0xd5)])startExitTimer(_0x95b564);else{if(!_0x95b564[_0x3bf3f4(0x106)])setPresence(_0x95b564,!![]);}}else{if(_0x2bb914[_0x3bf3f4(0xbe)]===_0x3bf3f4(0xad)&&_0x2f413b===!![]){if(_0x95b564[_0x3bf3f4(0xab)])abortExitTimer(_0x95b564);if(!_0x95b564[_0x3bf3f4(0x106)]&&_0x95b564[_0x3bf3f4(0xaa)]==='normal')setPresence(_0x95b564,!![]);}}if(_0x95b564[_0x3bf3f4(0xc0)]&&_0x95b564['sendToPythonWrapper']){_0x2bb914[_0x3bf3f4(0xbe)]==='motion'&&_0x2f413b===!![]&&_0x2bb914[_0x3bf3f4(0xfe)]&&_0x95b564[_0x3bf3f4(0xcd)](_0x3bf3f4(0xfc),{'room':_0x2bb914[_0x3bf3f4(0xfe)]});const _0x7d5d34=['door',_0x3bf3f4(0xd9),_0x3bf3f4(0xef),'fenster','griff',_0x3bf3f4(0xee),'lock',_0x3bf3f4(0x10e)]['some'](_0xfbea63=>_0x349260['includes'](_0xfbea63)),_0x53ae1e=['light','licht',_0x3bf3f4(0xc6),_0x3bf3f4(0xa6),_0x3bf3f4(0xcf),'lampe'][_0x3bf3f4(0xeb)](_0x5efb3e=>_0x349260['includes'](_0x5efb3e)),_0x30f463=[_0x3bf3f4(0xad),_0x3bf3f4(0xe7),_0x3bf3f4(0xce),_0x3bf3f4(0xde),_0x3bf3f4(0xb9)][_0x3bf3f4(0xeb)](_0x47a441=>_0x349260['includes'](_0x47a441));if(_0x2bb914[_0x3bf3f4(0xfe)]&&(_0x7d5d34||_0x53ae1e||_0x30f463)){const _0x8434e4=_0x2f413b===!![]||typeof _0x2f413b===_0x3bf3f4(0x10d)&&_0x2f413b>0x0,_0x3df2d6=_0x7d5d34&&!_0x8434e4&&_0x2f4115!==undefined&&_0x2f4115!=_0x2f413b;if(_0x8434e4||_0x3df2d6){const _0x5eec17=_0x95b564[_0x3bf3f4(0xf6)]||_0x41fc3e,_0x28ee0c=(_0x41fc3e-_0x5eec17)/0x3e8;_0x95b564['lastTrackerEventTime']=_0x41fc3e,_0x95b564['sendToPythonWrapper']('TRACK_EVENT',{'room':_0x2bb914[_0x3bf3f4(0xfe)],'dt':_0x28ee0c});}}}return _0x189aad;}module[a5_0x30565d(0xfd)]={'processSensorEvent':processSensorEvent,'getOutsideTemperatureNumeric':getOutsideTemperatureNumeric,'setPresence':setPresence,'abortExitTimer':abortExitTimer,'startExitTimer':startExitTimer};