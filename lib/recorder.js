const a5_0x331e30=a5_0x1b38;(function(_0x33a818,_0x340348){const _0x436246=a5_0x1b38,_0x3f0c57=_0x33a818();while(!![]){try{const _0x52b148=-parseInt(_0x436246(0x205))/0x1*(-parseInt(_0x436246(0x1ee))/0x2)+-parseInt(_0x436246(0x1cf))/0x3+parseInt(_0x436246(0x1e3))/0x4+parseInt(_0x436246(0x21a))/0x5+-parseInt(_0x436246(0x1db))/0x6+-parseInt(_0x436246(0x207))/0x7*(parseInt(_0x436246(0x234))/0x8)+parseInt(_0x436246(0x209))/0x9;if(_0x52b148===_0x340348)break;else _0x3f0c57['push'](_0x3f0c57['shift']());}catch(_0x5cb20e){_0x3f0c57['push'](_0x3f0c57['shift']());}}}(a5_0x5e73,0x4f46d));const a5_0x4d233a=(function(){let _0x45df73=!![];return function(_0x4453fe,_0x360679){const _0x48d8f4=_0x45df73?function(){const _0x494df4=a5_0x1b38;if(_0x360679){const _0x2e1aff=_0x360679[_0x494df4(0x1e6)](_0x4453fe,arguments);return _0x360679=null,_0x2e1aff;}}:function(){};return _0x45df73=![],_0x48d8f4;};}()),a5_0x12c300=a5_0x4d233a(this,function(){const _0x1aa88f=a5_0x1b38;return a5_0x12c300[_0x1aa88f(0x201)]()[_0x1aa88f(0x1dd)](_0x1aa88f(0x1e5))[_0x1aa88f(0x201)]()[_0x1aa88f(0x1da)](a5_0x12c300)['search'](_0x1aa88f(0x1e5));});a5_0x12c300();'use strict';const HISTORY_MAX_SIZE=0x32,RAW_LOG_MAX_SIZE=0x9c4,THERMO_LOG_SIZE=0x3e8,SEQUENCE_TIMEOUT_MS=0x5*0x3c*0x3e8,MAX_TRAINING_SET_SIZE=0x1f4,EXIT_TIMER_MINUTES=0xf,EXIT_GRACE_PERIOD_SECONDS=0x1e;let activeSequence=[],sequenceTimer=null;async function getOutsideTemperatureNumeric(_0x7e4f05){const _0x44cfa6=a5_0x1b38;if(_0x7e4f05[_0x44cfa6(0x1f3)][_0x44cfa6(0x1fb)])try{const _0x5e8492=await _0x7e4f05[_0x44cfa6(0x1d0)](_0x7e4f05[_0x44cfa6(0x1f3)][_0x44cfa6(0x1fb)]);if(_0x5e8492&&_0x5e8492['val']!==undefined&&_0x5e8492[_0x44cfa6(0x219)]!==null)return parseFloat(_0x5e8492[_0x44cfa6(0x219)]);}catch(_0x5559be){}const _0x48d379=_0x7e4f05[_0x44cfa6(0x1f3)]['weatherInstance'];if(!_0x7e4f05[_0x44cfa6(0x1f3)][_0x44cfa6(0x225)]||!_0x48d379)return null;try{let _0x1bad64='';if(_0x48d379['includes'](_0x44cfa6(0x1e8)))_0x1bad64=_0x48d379+'.Current.Temperature';else{if(_0x48d379[_0x44cfa6(0x1e1)](_0x44cfa6(0x1df)))_0x1bad64=_0x48d379+'.NextHours.Location_1.Day_1.current.temp_value';else{if(_0x48d379[_0x44cfa6(0x1e1)](_0x44cfa6(0x1f4)))_0x1bad64=_0x48d379+_0x44cfa6(0x21c);else{if(_0x48d379[_0x44cfa6(0x1e1)](_0x44cfa6(0x1d9)))_0x1bad64=_0x48d379+_0x44cfa6(0x1d6);}}}if(_0x1bad64){const _0x456103=await _0x7e4f05[_0x44cfa6(0x1d0)](_0x1bad64);if(_0x456103&&_0x456103[_0x44cfa6(0x219)]!==undefined&&_0x456103[_0x44cfa6(0x219)]!==null)return parseFloat(_0x456103[_0x44cfa6(0x219)]);}}catch(_0x4b1ede){}return null;}async function recordThermodynamics(_0x18cee3,_0x48e7e5,_0x345ee5,_0x32e8e1){const _0x41d51e=a5_0x1b38,_0x15e759=await getOutsideTemperatureNumeric(_0x18cee3);if(_0x15e759===null)return;let _0x188b32=0x0,_0x3aa151=![];if(_0x18cee3['config'][_0x41d51e(0x1fe)])try{let _0x5a769f=_0x18cee3[_0x41d51e(0x1f3)][_0x41d51e(0x1fe)];if(typeof _0x5a769f===_0x41d51e(0x223))_0x5a769f=JSON['parse'](_0x5a769f);if(_0x5a769f[_0x48e7e5]){const _0x2cd83b=_0x5a769f[_0x48e7e5],_0x14192b=await _0x18cee3['getForeignStateAsync'](_0x2cd83b);if(_0x14192b&&_0x14192b[_0x41d51e(0x219)]!==null&&_0x14192b[_0x41d51e(0x219)]!==undefined){let _0x1306cc=Number(_0x14192b[_0x41d51e(0x219)]);if(_0x1306cc<=1.05&&!_0x2cd83b[_0x41d51e(0x1e1)]('STATUS')&&!_0x2cd83b[_0x41d51e(0x1e1)](_0x41d51e(0x23c)))_0x1306cc=_0x1306cc*0x64;_0x188b32=Math[_0x41d51e(0x21e)](_0x1306cc),_0x3aa151=!![];}}}catch(_0x4942b3){}if(!_0x3aa151){const _0x57835e=[{'from':_0x41d51e(0x21b),'to':'.1.LEVEL'},{'from':_0x41d51e(0x21b),'to':_0x41d51e(0x1ec)},{'from':_0x41d51e(0x1f1),'to':'.4.VALVE_STATE'},{'from':_0x41d51e(0x224),'to':'.LEVEL'},{'from':_0x41d51e(0x238),'to':_0x41d51e(0x1d4)},{'from':_0x41d51e(0x22c),'to':_0x41d51e(0x1d2)}];for(const _0x4a63a5 of _0x57835e){if(_0x48e7e5['includes'](_0x4a63a5[_0x41d51e(0x202)])){const _0x88efca=_0x48e7e5['replace'](_0x4a63a5[_0x41d51e(0x202)],_0x4a63a5['to']);try{const _0x4c8152=await _0x18cee3[_0x41d51e(0x1d0)](_0x88efca);if(_0x4c8152&&_0x4c8152['val']!==null&&_0x4c8152['val']!==undefined){let _0x159bfc=Number(_0x4c8152['val']);if(typeof _0x159bfc===_0x41d51e(0x231)){if(_0x159bfc<=1.05&&_0x4a63a5['to']['includes'](_0x41d51e(0x1d1)))_0x159bfc=_0x159bfc*0x64;_0x188b32=Math['round'](_0x159bfc),_0x3aa151=!![];break;}}}catch(_0x9bb51d){}}}}const _0x3fb8c0=await _0x18cee3[_0x41d51e(0x1e2)](_0x41d51e(0x206));let _0x386017=[];if(_0x3fb8c0&&_0x3fb8c0[_0x41d51e(0x219)])try{_0x386017=JSON[_0x41d51e(0x1fa)](_0x3fb8c0[_0x41d51e(0x219)]);}catch(_0x53fcd9){}_0x386017['push']({'ts':Date['now'](),'room':_0x32e8e1||'Unknown','t_in':_0x345ee5,'t_out':_0x15e759,'valve':_0x188b32});if(_0x386017[_0x41d51e(0x1fd)]>THERMO_LOG_SIZE)_0x386017[_0x41d51e(0x227)]();await _0x18cee3['setStateAsync'](_0x41d51e(0x206),{'val':JSON['stringify'](_0x386017),'ack':!![]});}async function saveCompletedSequence(_0x353b02){const _0x40e501=a5_0x1b38;try{const _0x48c042=await _0x353b02[_0x40e501(0x1e2)]('LTM.trainingData.sequences');let _0x25b51d=[];if(_0x48c042&&_0x48c042[_0x40e501(0x219)])try{_0x25b51d=JSON['parse'](_0x48c042[_0x40e501(0x219)]);}catch(_0x549441){}const _0x20c36c=activeSequence[0x0]['ts'],_0x5a0a67=activeSequence[_0x40e501(0x1d7)](_0x467afe=>({'loc':_0x467afe[_0x40e501(0x1d8)],'t_delta':Math[_0x40e501(0x21e)]((_0x467afe['ts']-_0x20c36c)/0x3e8)})),_0x2a334e={'timestamp':new Date(_0x20c36c)['toISOString'](),'steps':_0x5a0a67,'duration':Math[_0x40e501(0x21e)]((activeSequence[activeSequence[_0x40e501(0x1fd)]-0x1]['ts']-_0x20c36c)/0x3e8),'daytime':new Date(_0x20c36c)[_0x40e501(0x1ed)]()};_0x25b51d[_0x40e501(0x23a)](_0x2a334e);if(_0x25b51d[_0x40e501(0x1fd)]>MAX_TRAINING_SET_SIZE)_0x25b51d[_0x40e501(0x227)]();await _0x353b02['setStateAsync'](_0x40e501(0x1f7),{'val':JSON[_0x40e501(0x1eb)](_0x25b51d),'ack':!![]}),_0x353b02[_0x40e501(0x213)]&&_0x353b02[_0x40e501(0x21f)]&&_0x353b02['sendToPythonWrapper'](_0x40e501(0x1e9),{'sequence':_0x2a334e});}catch(_0x54413e){_0x353b02[_0x40e501(0x210)][_0x40e501(0x1ff)](_0x40e501(0x212)+_0x54413e[_0x40e501(0x20b)]);}}async function recordSequence(_0x176bf8,_0xc47801){const _0x1ca08a=a5_0x1b38,_0x532526=(_0xc47801[_0x1ca08a(0x1de)]||'')[_0x1ca08a(0x22b)](),_0x5b09f9=[_0x1ca08a(0x1dc),_0x1ca08a(0x233),_0x1ca08a(0x1e7),_0x1ca08a(0x20f),_0x1ca08a(0x22f),_0x1ca08a(0x23e),_0x1ca08a(0x211),_0x1ca08a(0x1e4),_0x1ca08a(0x237),'contact',_0x1ca08a(0x228),'light',_0x1ca08a(0x221),_0x1ca08a(0x218),'schalter','dimmer',_0x1ca08a(0x204)];if(!_0x5b09f9[_0x1ca08a(0x22d)](_0xc3603d=>_0x532526[_0x1ca08a(0x1e1)](_0xc3603d)))return;if(!_0xc47801['value'])return;if(sequenceTimer)clearTimeout(sequenceTimer);activeSequence[_0x1ca08a(0x23a)]({'loc':_0xc47801['location']||_0x1ca08a(0x235),'id':_0xc47801['id'],'ts':Date[_0x1ca08a(0x1f2)]()}),sequenceTimer=setTimeout(async()=>{if(activeSequence['length']>0x1)await saveCompletedSequence(_0x176bf8);activeSequence=[];},SEQUENCE_TIMEOUT_MS);}function a5_0x1b38(_0x2de0f9,_0x356998){const _0x283f73=a5_0x5e73();return a5_0x1b38=function(_0x12c300,_0x4d233a){_0x12c300=_0x12c300-0x1ce;let _0x5e73a5=_0x283f73[_0x12c300];return _0x5e73a5;},a5_0x1b38(_0x2de0f9,_0x356998);}function startExitTimer(_0x531e4e){const _0x5ba0c9=a5_0x1b38;abortExitTimer(_0x531e4e),_0x531e4e[_0x5ba0c9(0x21d)]=!![],_0x531e4e['exitGraceTimer']=setTimeout(()=>{_0x531e4e['isGracePeriodActive']=![];},EXIT_GRACE_PERIOD_SECONDS*0x3e8),_0x531e4e[_0x5ba0c9(0x22e)]=setTimeout(()=>{const _0x43aec3=_0x5ba0c9;setPresence(_0x531e4e,![]),_0x531e4e[_0x43aec3(0x22e)]=null;},EXIT_TIMER_MINUTES*0x3c*0x3e8);}function abortExitTimer(_0x27d332){const _0x4e0e46=a5_0x1b38;if(_0x27d332[_0x4e0e46(0x22e)])clearTimeout(_0x27d332[_0x4e0e46(0x22e)]);if(_0x27d332[_0x4e0e46(0x214)])clearTimeout(_0x27d332['exitGraceTimer']);_0x27d332[_0x4e0e46(0x22e)]=null,_0x27d332['exitGraceTimer']=null,_0x27d332[_0x4e0e46(0x21d)]=![];}async function setPresence(_0x3f9223,_0x1e7324){const _0x3b88f9=a5_0x1b38;if(_0x3f9223[_0x3b88f9(0x239)]===_0x1e7324)return;_0x3f9223['isPresent']=_0x1e7324,await _0x3f9223[_0x3b88f9(0x20e)](_0x3b88f9(0x1f5),{'val':_0x1e7324,'ack':!![]});}async function updateHourlyActivity(_0x335c23){const _0xff168d=a5_0x1b38;let _0x52d307=new Array(0x18)[_0xff168d(0x217)](0x0),_0x5e7529=0x0;try{const _0x2d0f8a=await _0x335c23[_0xff168d(0x1e2)](_0xff168d(0x1f6));_0x2d0f8a&&_0x2d0f8a[_0xff168d(0x219)]&&(_0x52d307=JSON[_0xff168d(0x1fa)](_0x2d0f8a[_0xff168d(0x219)]),_0x5e7529=_0x2d0f8a['ts']);}catch(_0x5870f6){}const _0x17908c=new Date(_0x5e7529),_0x4f976e=new Date();_0x17908c[_0xff168d(0x20c)]()!==_0x4f976e[_0xff168d(0x20c)]()&&(_0x52d307=new Array(0x18)['fill'](0x0));const _0x312247=_0x4f976e[_0xff168d(0x1ed)]();if(_0x52d307[_0x312247]===undefined)_0x52d307[_0x312247]=0x0;_0x52d307[_0x312247]++,await _0x335c23[_0xff168d(0x20e)](_0xff168d(0x1f6),{'val':JSON['stringify'](_0x52d307),'ack':!![]});}function a5_0x5e73(){const _0x15f535=['occupancy','rawEventLog','number','debug','bewegung','392BnCQvF','Unknown','klima','fenster','temperature','isPresent','push','logDuplicates','STATE','griff','door','[RECORDER]\x20Ignored\x20implausible\x20temperature:\x20','388614ftqgtz','getForeignStateAsync','LEVEL','Valve','heizung','level','eventHistory','.forecast.current.temp','map','loc','weatherunderground','constructor','1764696bHeVoy','motion','search','type','daswetter','thermostat','includes','getStateAsync','1363644JcsWIE','window','(((.+)+)+)+$','apply','präsenz','accuweather','ANALYZE_SEQUENCE','currentSystemMode','stringify','.1.VALVE_STATE','getHours','2YissFk','TRACK_EVENT','schloss','.1.TEMPERATURE','now','config','openweathermap','system.isPresent','analysis.health.todayVector','LTM.trainingData.sequences','normal','handle','parse','outdoorSensorId','unshift','length','valveMapping','error','dimmer','toString','from','exports','lampe','235527cREezC','LTM.trainingData.thermodynamics','68859PfMsXI','\x20from\x20','4601583ASByIE','lock','message','getDate','location','setStateAsync','presence','log','tür','[RECORDER]\x20Error:\x20','isProVersion','exitGraceTimer','events.lastEvent','isExit','fill','switch','val','713295kmvXfo','.1.ACTUAL_TEMPERATURE','.forecast.current.temperature','isGracePeriodActive','round','sendToPythonWrapper','light','licht','temperatur','string','.ACTUAL_TEMPERATURE','useWeather','schalter','shift','kontakt','lastTrackerEventTime','sensorLastValues','toLowerCase','Temperature','some','exitTimer'];a5_0x5e73=function(){return _0x15f535;};return a5_0x5e73();}async function processSensorEvent(_0x3b15e8,_0x22c817,_0x14f417,_0x5ac2b2){const _0x3f372f=a5_0x1b38;if(!_0x5ac2b2)return null;const _0x48bfc5=_0x14f417['val'],_0x33a8e2=Date[_0x3f372f(0x1f2)](),_0x1cd23b=_0x3b15e8[_0x3f372f(0x22a)][_0x22c817],_0x417e0c=(_0x5ac2b2[_0x3f372f(0x1de)]||'')[_0x3f372f(0x22b)](),_0x13e0c2=_0x417e0c[_0x3f372f(0x1e1)](_0x3f372f(0x238))||_0x417e0c['includes'](_0x3f372f(0x222))||_0x417e0c[_0x3f372f(0x1e1)](_0x3f372f(0x236))||_0x417e0c[_0x3f372f(0x1e1)](_0x3f372f(0x1d3))||_0x417e0c[_0x3f372f(0x1e1)](_0x3f372f(0x1e0));if(_0x13e0c2&&typeof _0x48bfc5==='number'){if(_0x48bfc5>0x50||_0x48bfc5<-0x32)return _0x3b15e8[_0x3f372f(0x210)][_0x3f372f(0x232)](_0x3f372f(0x1ce)+_0x48bfc5+_0x3f372f(0x208)+_0x22c817),null;}_0x3b15e8['sensorLastValues'][_0x22c817]=_0x48bfc5;if(!_0x5ac2b2[_0x3f372f(0x23b)]&&_0x1cd23b!=undefined&&_0x1cd23b==_0x48bfc5)return null;_0x3b15e8[_0x3f372f(0x213)]&&_0x13e0c2&&recordThermodynamics(_0x3b15e8,_0x22c817,_0x48bfc5,_0x5ac2b2[_0x3f372f(0x20d)]);const _0x3a3147={'timestamp':_0x33a8e2,'id':_0x22c817,'name':_0x5ac2b2['name'],'type':_0x5ac2b2[_0x3f372f(0x1de)],'location':_0x5ac2b2['location'],'value':_0x48bfc5};_0x3b15e8[_0x3f372f(0x1d5)][_0x3f372f(0x1fc)](_0x3a3147);if(_0x3b15e8[_0x3f372f(0x1d5)]['length']>HISTORY_MAX_SIZE)_0x3b15e8[_0x3f372f(0x1d5)]['pop']();await _0x3b15e8['setStateAsync'](_0x3f372f(0x215),{'val':JSON[_0x3f372f(0x1eb)](_0x3a3147),'ack':!![]}),await _0x3b15e8[_0x3f372f(0x20e)]('events.history',{'val':JSON[_0x3f372f(0x1eb)](_0x3b15e8[_0x3f372f(0x1d5)]),'ack':!![]}),await updateHourlyActivity(_0x3b15e8);if(_0x3b15e8['isProVersion']){_0x3b15e8[_0x3f372f(0x230)][_0x3f372f(0x23a)](_0x3a3147);if(_0x3b15e8[_0x3f372f(0x230)][_0x3f372f(0x1fd)]>RAW_LOG_MAX_SIZE)_0x3b15e8[_0x3f372f(0x230)]['splice'](0x0,_0x3b15e8[_0x3f372f(0x230)][_0x3f372f(0x1fd)]-RAW_LOG_MAX_SIZE);await _0x3b15e8[_0x3f372f(0x20e)]('LTM.rawEventLog',{'val':JSON[_0x3f372f(0x1eb)](_0x3b15e8[_0x3f372f(0x230)]),'ack':!![]}),recordSequence(_0x3b15e8,_0x3a3147);}if(_0x5ac2b2[_0x3f372f(0x216)]&&_0x48bfc5===!![]){if(_0x3b15e8[_0x3f372f(0x239)]&&!_0x3b15e8[_0x3f372f(0x21d)])startExitTimer(_0x3b15e8);else{if(!_0x3b15e8[_0x3f372f(0x239)])setPresence(_0x3b15e8,!![]);}}else{if(_0x5ac2b2['type']===_0x3f372f(0x1dc)&&_0x48bfc5===!![]){if(_0x3b15e8[_0x3f372f(0x22e)])abortExitTimer(_0x3b15e8);if(!_0x3b15e8[_0x3f372f(0x239)]&&_0x3b15e8[_0x3f372f(0x1ea)]===_0x3f372f(0x1f8))setPresence(_0x3b15e8,!![]);}}if(_0x3b15e8[_0x3f372f(0x213)]&&_0x3b15e8[_0x3f372f(0x21f)]){_0x5ac2b2[_0x3f372f(0x1de)]===_0x3f372f(0x1dc)&&_0x48bfc5===!![]&&_0x5ac2b2[_0x3f372f(0x20d)]&&_0x3b15e8[_0x3f372f(0x21f)]('SIMULATE_SIGNAL',{'room':_0x5ac2b2[_0x3f372f(0x20d)]});const _0x1c0fe7=[_0x3f372f(0x23e),'tür','window',_0x3f372f(0x237),_0x3f372f(0x23d),_0x3f372f(0x1f9),_0x3f372f(0x20a),_0x3f372f(0x1f0)]['some'](_0x34da07=>_0x417e0c[_0x3f372f(0x1e1)](_0x34da07)),_0xf8e276=[_0x3f372f(0x220),'licht',_0x3f372f(0x218),_0x3f372f(0x226),_0x3f372f(0x200),_0x3f372f(0x204)][_0x3f372f(0x22d)](_0x1d96fc=>_0x417e0c['includes'](_0x1d96fc)),_0xf6dc57=[_0x3f372f(0x1dc),'bewegung',_0x3f372f(0x1e7),_0x3f372f(0x20f),_0x3f372f(0x22f)][_0x3f372f(0x22d)](_0x2b7558=>_0x417e0c['includes'](_0x2b7558));if(_0x5ac2b2['location']&&(_0x1c0fe7||_0xf8e276||_0xf6dc57)){const _0x59bb68=_0x48bfc5===!![]||typeof _0x48bfc5===_0x3f372f(0x231)&&_0x48bfc5>0x0,_0x4f6966=_0x1c0fe7&&!_0x59bb68&&_0x1cd23b!==undefined&&_0x1cd23b!=_0x48bfc5;if(_0x59bb68||_0x4f6966){const _0x2a3025=_0x3b15e8[_0x3f372f(0x229)]||_0x33a8e2,_0x114149=(_0x33a8e2-_0x2a3025)/0x3e8;_0x3b15e8[_0x3f372f(0x229)]=_0x33a8e2,_0x3b15e8['sendToPythonWrapper'](_0x3f372f(0x1ef),{'room':_0x5ac2b2['location'],'dt':_0x114149});}}}return _0x3a3147;}module[a5_0x331e30(0x203)]={'processSensorEvent':processSensorEvent,'getOutsideTemperatureNumeric':getOutsideTemperatureNumeric,'setPresence':setPresence,'abortExitTimer':abortExitTimer,'startExitTimer':startExitTimer};