const a5_0x28cddb=a5_0x417c;(function(_0x3d5f37,_0x422059){const _0xdc337=a5_0x417c,_0x115bbe=_0x3d5f37();while(!![]){try{const _0x54a46a=-parseInt(_0xdc337(0x16b))/0x1*(-parseInt(_0xdc337(0x14f))/0x2)+-parseInt(_0xdc337(0x18c))/0x3+-parseInt(_0xdc337(0x143))/0x4*(-parseInt(_0xdc337(0x17f))/0x5)+-parseInt(_0xdc337(0x18a))/0x6*(parseInt(_0xdc337(0x158))/0x7)+-parseInt(_0xdc337(0x174))/0x8*(parseInt(_0xdc337(0x14e))/0x9)+-parseInt(_0xdc337(0x178))/0xa*(-parseInt(_0xdc337(0x160))/0xb)+-parseInt(_0xdc337(0x18f))/0xc*(-parseInt(_0xdc337(0x16f))/0xd);if(_0x54a46a===_0x422059)break;else _0x115bbe['push'](_0x115bbe['shift']());}catch(_0x3a6b50){_0x115bbe['push'](_0x115bbe['shift']());}}}(a5_0x5350,0x49a96));const a5_0x27cb95=(function(){let _0x4cea43=!![];return function(_0x45f920,_0x5dbf34){const _0x40060f=_0x4cea43?function(){const _0x40a753=a5_0x417c;if(_0x5dbf34){const _0x52a3ee=_0x5dbf34[_0x40a753(0x185)](_0x45f920,arguments);return _0x5dbf34=null,_0x52a3ee;}}:function(){};return _0x4cea43=![],_0x40060f;};}()),a5_0x473d16=a5_0x27cb95(this,function(){const _0x10b419=a5_0x417c;return a5_0x473d16[_0x10b419(0x15a)]()[_0x10b419(0x199)]('(((.+)+)+)+$')[_0x10b419(0x15a)]()[_0x10b419(0x162)](a5_0x473d16)[_0x10b419(0x199)](_0x10b419(0x176));});a5_0x473d16();'use strict';const HISTORY_MAX_SIZE=0x32,RAW_LOG_MAX_SIZE=0x9c4,THERMO_LOG_SIZE=0x3e8,SEQUENCE_TIMEOUT_MS=0x5*0x3c*0x3e8,MAX_TRAINING_SET_SIZE=0x1f4,EXIT_TIMER_MINUTES=0xf,EXIT_GRACE_PERIOD_SECONDS=0x1e;function a5_0x417c(_0x2128f0,_0x3aae7c){const _0x545958=a5_0x5350();return a5_0x417c=function(_0x473d16,_0x27cb95){_0x473d16=_0x473d16-0x13e;let _0x535086=_0x545958[_0x473d16];return _0x535086;},a5_0x417c(_0x2128f0,_0x3aae7c);}let activeSequence=[],sequenceTimer=null;async function getOutsideTemperatureNumeric(_0x4e91b8){const _0xee3887=a5_0x417c;if(_0x4e91b8[_0xee3887(0x18d)]['outdoorSensorId'])try{const _0x544def=await _0x4e91b8[_0xee3887(0x15f)](_0x4e91b8[_0xee3887(0x18d)][_0xee3887(0x17e)]);if(_0x544def&&_0x544def['val']!==undefined&&_0x544def['val']!==null)return parseFloat(_0x544def[_0xee3887(0x182)]);}catch(_0x5bda3d){}const _0x42f028=_0x4e91b8[_0xee3887(0x18d)][_0xee3887(0x152)];if(!_0x4e91b8[_0xee3887(0x18d)][_0xee3887(0x188)]||!_0x42f028)return null;try{let _0xed1e22='';if(_0x42f028[_0xee3887(0x149)](_0xee3887(0x186)))_0xed1e22=_0x42f028+'.Current.Temperature';else{if(_0x42f028[_0xee3887(0x149)](_0xee3887(0x15b)))_0xed1e22=_0x42f028+_0xee3887(0x18b);else{if(_0x42f028['includes']('openweathermap'))_0xed1e22=_0x42f028+'.forecast.current.temperature';else{if(_0x42f028['includes'](_0xee3887(0x198)))_0xed1e22=_0x42f028+_0xee3887(0x13e);}}}if(_0xed1e22){const _0xb106ea=await _0x4e91b8[_0xee3887(0x15f)](_0xed1e22);if(_0xb106ea&&_0xb106ea[_0xee3887(0x182)]!==undefined&&_0xb106ea[_0xee3887(0x182)]!==null)return parseFloat(_0xb106ea['val']);}}catch(_0x1e5642){}return null;}async function recordThermodynamics(_0x3b8b76,_0x574d6c,_0x413fbf,_0x323024){const _0x5d4eac=a5_0x417c,_0x5ce652=await getOutsideTemperatureNumeric(_0x3b8b76),_0x24ccb4=await _0x3b8b76['getStateAsync'](_0x5d4eac(0x18e));let _0x8a825c=[];if(_0x24ccb4&&_0x24ccb4[_0x5d4eac(0x182)])try{_0x8a825c=JSON['parse'](_0x24ccb4[_0x5d4eac(0x182)]);}catch(_0x5635d0){}_0x8a825c[_0x5d4eac(0x148)]({'ts':Date[_0x5d4eac(0x13f)](),'room':_0x323024||'Unknown','t_in':_0x413fbf,'t_out':_0x5ce652});if(_0x8a825c['length']>THERMO_LOG_SIZE)_0x8a825c[_0x5d4eac(0x14d)]();await _0x3b8b76[_0x5d4eac(0x140)](_0x5d4eac(0x18e),{'val':JSON['stringify'](_0x8a825c),'ack':!![]});}async function saveCompletedSequence(_0x145634){const _0x550721=a5_0x417c;try{const _0x411c34=await _0x145634[_0x550721(0x196)]('LTM.trainingData.sequences');let _0x28c46d=[];if(_0x411c34&&_0x411c34[_0x550721(0x182)])try{_0x28c46d=JSON[_0x550721(0x151)](_0x411c34['val']);}catch(_0x1a16ad){}const _0x1e7546=activeSequence[0x0]['ts'],_0x1c3924=activeSequence[_0x550721(0x16e)](_0x2966e0=>({'loc':_0x2966e0['loc'],'t_delta':Math[_0x550721(0x156)]((_0x2966e0['ts']-_0x1e7546)/0x3e8)})),_0x467b40={'timestamp':new Date(_0x1e7546)[_0x550721(0x197)](),'steps':_0x1c3924,'duration':Math[_0x550721(0x156)]((activeSequence[activeSequence[_0x550721(0x17d)]-0x1]['ts']-_0x1e7546)/0x3e8),'daytime':new Date(_0x1e7546)[_0x550721(0x184)]()};_0x28c46d[_0x550721(0x148)](_0x467b40);if(_0x28c46d[_0x550721(0x17d)]>MAX_TRAINING_SET_SIZE)_0x28c46d[_0x550721(0x14d)]();await _0x145634['setStateAsync'](_0x550721(0x15d),{'val':JSON[_0x550721(0x170)](_0x28c46d),'ack':!![]}),_0x145634[_0x550721(0x17b)]&&_0x145634[_0x550721(0x194)]&&_0x145634[_0x550721(0x194)]('ANALYZE_SEQUENCE',{'sequence':_0x467b40});}catch(_0x4616aa){_0x145634[_0x550721(0x159)][_0x550721(0x16d)](_0x550721(0x166)+_0x4616aa[_0x550721(0x146)]);}}async function recordSequence(_0x1edd20,_0x55f55f){const _0xd12d78=a5_0x417c,_0x45bc3a=(_0x55f55f[_0xd12d78(0x172)]||'')[_0xd12d78(0x14c)](),_0x32e64e=[_0xd12d78(0x142),'bewegung',_0xd12d78(0x16a),_0xd12d78(0x193),_0xd12d78(0x163),_0xd12d78(0x190),_0xd12d78(0x155),_0xd12d78(0x169),'fenster',_0xd12d78(0x195),_0xd12d78(0x187),_0xd12d78(0x17c),_0xd12d78(0x15c),'switch',_0xd12d78(0x189),_0xd12d78(0x167),_0xd12d78(0x14b)];if(!_0x32e64e[_0xd12d78(0x161)](_0x5083b4=>_0x45bc3a['includes'](_0x5083b4)))return;if(!_0x55f55f['value'])return;if(sequenceTimer)clearTimeout(sequenceTimer);activeSequence[_0xd12d78(0x148)]({'loc':_0x55f55f[_0xd12d78(0x179)]||_0xd12d78(0x164),'id':_0x55f55f['id'],'ts':Date[_0xd12d78(0x13f)]()}),sequenceTimer=setTimeout(async()=>{const _0x590650=_0xd12d78;if(activeSequence[_0x590650(0x17d)]>0x1)await saveCompletedSequence(_0x1edd20);activeSequence=[];},SEQUENCE_TIMEOUT_MS);}function startExitTimer(_0x5ae4d2){const _0xe5d75c=a5_0x417c;abortExitTimer(_0x5ae4d2),_0x5ae4d2[_0xe5d75c(0x154)]=!![],_0x5ae4d2[_0xe5d75c(0x175)]=setTimeout(()=>{const _0x3409d8=_0xe5d75c;_0x5ae4d2[_0x3409d8(0x154)]=![];},EXIT_GRACE_PERIOD_SECONDS*0x3e8),_0x5ae4d2[_0xe5d75c(0x145)]=setTimeout(()=>{const _0x3cc4a2=_0xe5d75c;setPresence(_0x5ae4d2,![]),_0x5ae4d2[_0x3cc4a2(0x145)]=null;},EXIT_TIMER_MINUTES*0x3c*0x3e8);}function a5_0x5350(){const _0x2fdf8f=['kontakt','useWeather','schalter','739692PfWwph','.NextHours.Location_1.Day_1.current.temp_value','413595nKMuvM','config','LTM.trainingData.thermodynamics','2796VIJELv','door','unshift','pop','presence','sendToPythonWrapper','contact','getStateAsync','toISOString','weatherunderground','search','.forecast.current.temp','now','setStateAsync','klima','motion','7696spSnNm','name','exitTimer','message','eventHistory','push','includes','currentSystemMode','lampe','toLowerCase','shift','1359vcRAaJ','2268jCYhfb','temperatur','parse','weatherInstance','LTM.rawEventLog','isGracePeriodActive','tür','round','temperature','28RWlhlr','log','toString','daswetter','licht','LTM.trainingData.sequences','system.isPresent','getForeignStateAsync','121SARjct','some','constructor','occupancy','Unknown','events.history','[RECORDER]\x20Error:\x20','dimmer','logDuplicates','window','präsenz','313oayPUq','rawEventLog','error','map','32721hezCBW','stringify','splice','type','events.lastEvent','17992lUelKY','exitGraceTimer','(((.+)+)+)+$','sensorLastValues','40210KGUQnX','location','isExit','isProVersion','light','length','outdoorSensorId','745NReFnR','isPresent','exports','val','heizung','getHours','apply','accuweather'];a5_0x5350=function(){return _0x2fdf8f;};return a5_0x5350();}function abortExitTimer(_0x93a6fc){const _0x3ed4bb=a5_0x417c;if(_0x93a6fc[_0x3ed4bb(0x145)])clearTimeout(_0x93a6fc['exitTimer']);if(_0x93a6fc[_0x3ed4bb(0x175)])clearTimeout(_0x93a6fc['exitGraceTimer']);_0x93a6fc[_0x3ed4bb(0x145)]=null,_0x93a6fc['exitGraceTimer']=null,_0x93a6fc[_0x3ed4bb(0x154)]=![];}async function setPresence(_0xa7f135,_0x360814){const _0x4e1ec0=a5_0x417c;if(_0xa7f135[_0x4e1ec0(0x180)]===_0x360814)return;_0xa7f135['isPresent']=_0x360814,await _0xa7f135[_0x4e1ec0(0x140)](_0x4e1ec0(0x15e),{'val':_0x360814,'ack':!![]});}async function processSensorEvent(_0x7b57e,_0x5374e2,_0x4c2848,_0x4ff390){const _0x16d1ad=a5_0x417c;if(!_0x4ff390)return null;const _0x5273c6=_0x4c2848[_0x16d1ad(0x182)],_0x91156c=Date['now'](),_0x13713e=_0x7b57e[_0x16d1ad(0x177)][_0x5374e2];_0x7b57e[_0x16d1ad(0x177)][_0x5374e2]=_0x5273c6;if(!_0x4ff390[_0x16d1ad(0x168)]&&_0x13713e!=undefined&&_0x13713e==_0x5273c6)return null;const _0x153fb6=(_0x4ff390[_0x16d1ad(0x172)]||'')[_0x16d1ad(0x14c)](),_0x2acae8=_0x153fb6[_0x16d1ad(0x149)](_0x16d1ad(0x157))||_0x153fb6[_0x16d1ad(0x149)](_0x16d1ad(0x150))||_0x153fb6[_0x16d1ad(0x149)](_0x16d1ad(0x141))||_0x153fb6[_0x16d1ad(0x149)](_0x16d1ad(0x183));_0x7b57e[_0x16d1ad(0x17b)]&&_0x2acae8&&recordThermodynamics(_0x7b57e,_0x5374e2,_0x5273c6,_0x4ff390[_0x16d1ad(0x179)]);const _0x1fd2c0={'timestamp':_0x91156c,'id':_0x5374e2,'name':_0x4ff390[_0x16d1ad(0x144)],'type':_0x4ff390[_0x16d1ad(0x172)],'location':_0x4ff390['location'],'value':_0x5273c6};_0x7b57e['eventHistory'][_0x16d1ad(0x191)](_0x1fd2c0);if(_0x7b57e[_0x16d1ad(0x147)][_0x16d1ad(0x17d)]>HISTORY_MAX_SIZE)_0x7b57e[_0x16d1ad(0x147)][_0x16d1ad(0x192)]();await _0x7b57e[_0x16d1ad(0x140)](_0x16d1ad(0x173),{'val':JSON[_0x16d1ad(0x170)](_0x1fd2c0),'ack':!![]}),await _0x7b57e[_0x16d1ad(0x140)](_0x16d1ad(0x165),{'val':JSON[_0x16d1ad(0x170)](_0x7b57e['eventHistory']),'ack':!![]});if(_0x7b57e[_0x16d1ad(0x17b)]){_0x7b57e[_0x16d1ad(0x16c)][_0x16d1ad(0x148)](_0x1fd2c0);if(_0x7b57e['rawEventLog']['length']>RAW_LOG_MAX_SIZE)_0x7b57e[_0x16d1ad(0x16c)][_0x16d1ad(0x171)](0x0,_0x7b57e[_0x16d1ad(0x16c)][_0x16d1ad(0x17d)]-RAW_LOG_MAX_SIZE);await _0x7b57e[_0x16d1ad(0x140)](_0x16d1ad(0x153),{'val':JSON[_0x16d1ad(0x170)](_0x7b57e[_0x16d1ad(0x16c)]),'ack':!![]}),recordSequence(_0x7b57e,_0x1fd2c0);}if(_0x4ff390[_0x16d1ad(0x17a)]&&_0x5273c6===!![]){if(_0x7b57e[_0x16d1ad(0x180)]&&!_0x7b57e[_0x16d1ad(0x154)])startExitTimer(_0x7b57e);else{if(!_0x7b57e[_0x16d1ad(0x180)])setPresence(_0x7b57e,!![]);}}else{if(_0x4ff390[_0x16d1ad(0x172)]===_0x16d1ad(0x142)&&_0x5273c6===!![]){if(_0x7b57e[_0x16d1ad(0x145)])abortExitTimer(_0x7b57e);if(!_0x7b57e[_0x16d1ad(0x180)]&&_0x7b57e[_0x16d1ad(0x14a)]==='normal')setPresence(_0x7b57e,!![]);}}return _0x7b57e[_0x16d1ad(0x17b)]&&_0x4ff390[_0x16d1ad(0x172)]===_0x16d1ad(0x142)&&_0x5273c6===!![]&&_0x4ff390[_0x16d1ad(0x179)]&&_0x7b57e['sendToPythonWrapper']&&_0x7b57e['sendToPythonWrapper']('SIMULATE_SIGNAL',{'room':_0x4ff390['location']}),_0x1fd2c0;}module[a5_0x28cddb(0x181)]={'processSensorEvent':processSensorEvent,'getOutsideTemperatureNumeric':getOutsideTemperatureNumeric,'setPresence':setPresence,'abortExitTimer':abortExitTimer,'startExitTimer':startExitTimer};