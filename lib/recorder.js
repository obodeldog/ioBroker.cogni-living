(function(_0x499a93,_0x3816ca){const _0x23b48e=a5_0x2637,_0x2a1e42=_0x499a93();while(!![]){try{const _0x4d4c83=-parseInt(_0x23b48e(0x127))/0x1*(-parseInt(_0x23b48e(0xf1))/0x2)+-parseInt(_0x23b48e(0x116))/0x3*(-parseInt(_0x23b48e(0x11a))/0x4)+parseInt(_0x23b48e(0x143))/0x5*(parseInt(_0x23b48e(0xf3))/0x6)+parseInt(_0x23b48e(0x130))/0x7*(-parseInt(_0x23b48e(0xea))/0x8)+-parseInt(_0x23b48e(0xef))/0x9+-parseInt(_0x23b48e(0x14a))/0xa*(parseInt(_0x23b48e(0xe0))/0xb)+-parseInt(_0x23b48e(0x10e))/0xc*(-parseInt(_0x23b48e(0x147))/0xd);if(_0x4d4c83===_0x3816ca)break;else _0x2a1e42['push'](_0x2a1e42['shift']());}catch(_0x599a8b){_0x2a1e42['push'](_0x2a1e42['shift']());}}}(a5_0x1272,0x39ce0));function a5_0x2637(_0x10439e,_0x3138dd){const _0x1138c3=a5_0x1272();return a5_0x2637=function(_0x2ea722,_0x35b823){_0x2ea722=_0x2ea722-0xdb;let _0x1272b3=_0x1138c3[_0x2ea722];return _0x1272b3;},a5_0x2637(_0x10439e,_0x3138dd);}const a5_0x35b823=(function(){let _0xdf241a=!![];return function(_0x2c9d78,_0x21dda3){const _0x162eca=_0xdf241a?function(){const _0x3924fc=a5_0x2637;if(_0x21dda3){const _0x44d8b1=_0x21dda3[_0x3924fc(0x109)](_0x2c9d78,arguments);return _0x21dda3=null,_0x44d8b1;}}:function(){};return _0xdf241a=![],_0x162eca;};}()),a5_0x2ea722=a5_0x35b823(this,function(){const _0x4e361e=a5_0x2637;return a5_0x2ea722[_0x4e361e(0xdb)]()[_0x4e361e(0x103)]('(((.+)+)+)+$')[_0x4e361e(0xdb)]()[_0x4e361e(0xee)](a5_0x2ea722)[_0x4e361e(0x103)](_0x4e361e(0x11c));});a5_0x2ea722();'use strict';function a5_0x1272(){const _0x232d3b=['.1.TEMPERATURE','.1.LEVEL','fenster','96VEvUwV','sendToPythonWrapper','events.history','stringify','constructor','1924641ISfdXN','STATUS','8260PgUanw','STATE','1018488geascn','lastTrackerEventTime','lampe','pop','door','outdoorSensorId','useWeather','.4.VALVE_STATE','push','fill','exitGraceTimer','getHours','temperature','exitTimer','eventHistory','some','search','location','getStateAsync','licht','from','[RECORDER]\x20Error:\x20','apply','currentSystemMode','rawEventLog','lock','LEVEL','348DRwDel','round','level','type','accuweather','parse','.1.ACTUAL_TEMPERATURE','.1.VALVE_STATE','3aARDyi','unshift','kontakt','daswetter','436676pXgzJk','message','(((.+)+)+)+$','toLowerCase','.Current.Temperature','events.lastEvent','number','klima','schalter','logDuplicates','value','.forecast.current.temperature','string','33SkqlON','config','isPresent','isExit','includes','heizung','pr채senz','SIMULATE_SIGNAL','setStateAsync','256277hhgQnz','TRACK_EVENT','toISOString','error','Temperature','normal','[RECORDER]\x20Ignored\x20implausible\x20temperature:\x20','val','log','openweathermap','presence','isGracePeriodActive','window','shift','weatherunderground','valveMapping','.LEVEL','system.isPresent','splice','10qXlNci','name','occupancy','Unknown','256581IiXxff','now','getDate','70cyRYbZ','thermostat','griff','dimmer','getForeignStateAsync','bewegung','light','isProVersion','replace','toString','LTM.trainingData.thermodynamics','analysis.health.todayVector','length','handle','420167IOpwvR','motion','weatherInstance','contact','\x20from\x20','Valve','.ACTUAL_TEMPERATURE'];a5_0x1272=function(){return _0x232d3b;};return a5_0x1272();}const HISTORY_MAX_SIZE=0x32,RAW_LOG_MAX_SIZE=0x9c4,THERMO_LOG_SIZE=0x3e8,SEQUENCE_TIMEOUT_MS=0x5*0x3c*0x3e8,MAX_TRAINING_SET_SIZE=0x1f4,EXIT_TIMER_MINUTES=0xf,EXIT_GRACE_PERIOD_SECONDS=0x1e;let activeSequence=[],sequenceTimer=null;async function getOutsideTemperatureNumeric(_0x57755a){const _0x4b61c6=a5_0x2637;if(_0x57755a[_0x4b61c6(0x128)]['outdoorSensorId'])try{const _0x5bbb9e=await _0x57755a[_0x4b61c6(0x14e)](_0x57755a['config'][_0x4b61c6(0xf8)]);if(_0x5bbb9e&&_0x5bbb9e[_0x4b61c6(0x137)]!==undefined&&_0x5bbb9e[_0x4b61c6(0x137)]!==null)return parseFloat(_0x5bbb9e[_0x4b61c6(0x137)]);}catch(_0x1846b7){}const _0x11bd9e=_0x57755a[_0x4b61c6(0x128)][_0x4b61c6(0xe2)];if(!_0x57755a[_0x4b61c6(0x128)][_0x4b61c6(0xf9)]||!_0x11bd9e)return null;try{let _0x56db14='';if(_0x11bd9e['includes'](_0x4b61c6(0x112)))_0x56db14=_0x11bd9e+_0x4b61c6(0x11e);else{if(_0x11bd9e['includes'](_0x4b61c6(0x119)))_0x56db14=_0x11bd9e+'.NextHours.Location_1.Day_1.current.temp_value';else{if(_0x11bd9e[_0x4b61c6(0x12b)](_0x4b61c6(0x139)))_0x56db14=_0x11bd9e+_0x4b61c6(0x125);else{if(_0x11bd9e['includes'](_0x4b61c6(0x13e)))_0x56db14=_0x11bd9e+'.forecast.current.temp';}}}if(_0x56db14){const _0x1fba47=await _0x57755a[_0x4b61c6(0x14e)](_0x56db14);if(_0x1fba47&&_0x1fba47['val']!==undefined&&_0x1fba47[_0x4b61c6(0x137)]!==null)return parseFloat(_0x1fba47['val']);}}catch(_0x8ca1ca){}return null;}async function recordThermodynamics(_0x3aa73b,_0x419c5e,_0x59ed6d,_0x369108){const _0x3c7b81=a5_0x2637,_0x15b865=await getOutsideTemperatureNumeric(_0x3aa73b);if(_0x15b865===null)return;let _0x370e46=0x0,_0x3088e5=![];if(_0x3aa73b[_0x3c7b81(0x128)]['valveMapping'])try{let _0x96ac57=_0x3aa73b[_0x3c7b81(0x128)][_0x3c7b81(0x13f)];if(typeof _0x96ac57===_0x3c7b81(0x126))_0x96ac57=JSON[_0x3c7b81(0x113)](_0x96ac57);if(_0x96ac57[_0x419c5e]){const _0x479bc2=_0x96ac57[_0x419c5e],_0x11e467=await _0x3aa73b[_0x3c7b81(0x14e)](_0x479bc2);if(_0x11e467&&_0x11e467['val']!==null&&_0x11e467[_0x3c7b81(0x137)]!==undefined){let _0x3b61c7=Number(_0x11e467[_0x3c7b81(0x137)]);if(_0x3b61c7<=1.05&&!_0x479bc2[_0x3c7b81(0x12b)](_0x3c7b81(0xf0))&&!_0x479bc2[_0x3c7b81(0x12b)](_0x3c7b81(0xf2)))_0x3b61c7=_0x3b61c7*0x64;_0x370e46=Math[_0x3c7b81(0x10f)](_0x3b61c7),_0x3088e5=!![];}}}catch(_0x34004f){}if(!_0x3088e5){const _0x497b78=[{'from':_0x3c7b81(0x114),'to':_0x3c7b81(0xe8)},{'from':_0x3c7b81(0x114),'to':_0x3c7b81(0x115)},{'from':_0x3c7b81(0xe7),'to':_0x3c7b81(0xfa)},{'from':_0x3c7b81(0xe6),'to':_0x3c7b81(0x140)},{'from':_0x3c7b81(0xff),'to':_0x3c7b81(0x110)},{'from':_0x3c7b81(0x134),'to':_0x3c7b81(0xe5)}];for(const _0x1d0d74 of _0x497b78){if(_0x419c5e[_0x3c7b81(0x12b)](_0x1d0d74[_0x3c7b81(0x107)])){const _0x9922aa=_0x419c5e[_0x3c7b81(0x152)](_0x1d0d74[_0x3c7b81(0x107)],_0x1d0d74['to']);try{const _0x4137e3=await _0x3aa73b['getForeignStateAsync'](_0x9922aa);if(_0x4137e3&&_0x4137e3[_0x3c7b81(0x137)]!==null&&_0x4137e3[_0x3c7b81(0x137)]!==undefined){let _0x5073c0=Number(_0x4137e3[_0x3c7b81(0x137)]);if(typeof _0x5073c0==='number'){if(_0x5073c0<=1.05&&_0x1d0d74['to'][_0x3c7b81(0x12b)](_0x3c7b81(0x10d)))_0x5073c0=_0x5073c0*0x64;_0x370e46=Math[_0x3c7b81(0x10f)](_0x5073c0),_0x3088e5=!![];break;}}}catch(_0x2358f3){}}}}const _0x252d08=await _0x3aa73b[_0x3c7b81(0x105)](_0x3c7b81(0xdc));let _0xc7eb0c=[];if(_0x252d08&&_0x252d08[_0x3c7b81(0x137)])try{_0xc7eb0c=JSON[_0x3c7b81(0x113)](_0x252d08[_0x3c7b81(0x137)]);}catch(_0x4c2a11){}_0xc7eb0c[_0x3c7b81(0xfb)]({'ts':Date[_0x3c7b81(0x148)](),'room':_0x369108||_0x3c7b81(0x146),'t_in':_0x59ed6d,'t_out':_0x15b865,'valve':_0x370e46});if(_0xc7eb0c[_0x3c7b81(0xde)]>THERMO_LOG_SIZE)_0xc7eb0c[_0x3c7b81(0x13d)]();await _0x3aa73b[_0x3c7b81(0x12f)](_0x3c7b81(0xdc),{'val':JSON['stringify'](_0xc7eb0c),'ack':!![]});}async function saveCompletedSequence(_0x183685){const _0x202770=a5_0x2637;try{const _0x1e5821=await _0x183685[_0x202770(0x105)]('LTM.trainingData.sequences');let _0x31e2af=[];if(_0x1e5821&&_0x1e5821[_0x202770(0x137)])try{_0x31e2af=JSON[_0x202770(0x113)](_0x1e5821[_0x202770(0x137)]);}catch(_0x5341b0){}const _0x3e0931=activeSequence[0x0]['ts'],_0x2ab5df=activeSequence['map'](_0x3a837e=>({'loc':_0x3a837e['loc'],'t_delta':Math['round']((_0x3a837e['ts']-_0x3e0931)/0x3e8)})),_0x28e5e1={'timestamp':new Date(_0x3e0931)[_0x202770(0x132)](),'steps':_0x2ab5df,'duration':Math[_0x202770(0x10f)]((activeSequence[activeSequence[_0x202770(0xde)]-0x1]['ts']-_0x3e0931)/0x3e8),'daytime':new Date(_0x3e0931)[_0x202770(0xfe)]()};_0x31e2af[_0x202770(0xfb)](_0x28e5e1);if(_0x31e2af['length']>MAX_TRAINING_SET_SIZE)_0x31e2af[_0x202770(0x13d)]();await _0x183685[_0x202770(0x12f)]('LTM.trainingData.sequences',{'val':JSON[_0x202770(0xed)](_0x31e2af),'ack':!![]}),_0x183685[_0x202770(0x151)]&&_0x183685[_0x202770(0xeb)]&&_0x183685['sendToPythonWrapper']('ANALYZE_SEQUENCE',{'sequence':_0x28e5e1});}catch(_0x3972d1){_0x183685[_0x202770(0x138)][_0x202770(0x133)](_0x202770(0x108)+_0x3972d1[_0x202770(0x11b)]);}}async function recordSequence(_0x4bcabd,_0xfe97f1){const _0x26e6d9=a5_0x2637,_0x1521a3=(_0xfe97f1['type']||'')[_0x26e6d9(0x11d)](),_0x572e53=['motion',_0x26e6d9(0x14f),_0x26e6d9(0x12d),_0x26e6d9(0x13a),_0x26e6d9(0x145),_0x26e6d9(0xf7),'t체r',_0x26e6d9(0x13c),'fenster',_0x26e6d9(0xe3),_0x26e6d9(0x118),_0x26e6d9(0x150),_0x26e6d9(0x106),'switch',_0x26e6d9(0x122),'dimmer',_0x26e6d9(0xf5)];if(!_0x572e53['some'](_0x3d932c=>_0x1521a3[_0x26e6d9(0x12b)](_0x3d932c)))return;if(!_0xfe97f1[_0x26e6d9(0x124)])return;if(sequenceTimer)clearTimeout(sequenceTimer);activeSequence['push']({'loc':_0xfe97f1[_0x26e6d9(0x104)]||_0x26e6d9(0x146),'id':_0xfe97f1['id'],'ts':Date['now']()}),sequenceTimer=setTimeout(async()=>{if(activeSequence['length']>0x1)await saveCompletedSequence(_0x4bcabd);activeSequence=[];},SEQUENCE_TIMEOUT_MS);}function startExitTimer(_0x536fd1){const _0x3b1502=a5_0x2637;abortExitTimer(_0x536fd1),_0x536fd1['isGracePeriodActive']=!![],_0x536fd1[_0x3b1502(0xfd)]=setTimeout(()=>{const _0x5a1305=_0x3b1502;_0x536fd1[_0x5a1305(0x13b)]=![];},EXIT_GRACE_PERIOD_SECONDS*0x3e8),_0x536fd1['exitTimer']=setTimeout(()=>{const _0x18c884=_0x3b1502;setPresence(_0x536fd1,![]),_0x536fd1[_0x18c884(0x100)]=null;},EXIT_TIMER_MINUTES*0x3c*0x3e8);}function abortExitTimer(_0x24808b){const _0x4f075f=a5_0x2637;if(_0x24808b[_0x4f075f(0x100)])clearTimeout(_0x24808b['exitTimer']);if(_0x24808b[_0x4f075f(0xfd)])clearTimeout(_0x24808b[_0x4f075f(0xfd)]);_0x24808b['exitTimer']=null,_0x24808b['exitGraceTimer']=null,_0x24808b[_0x4f075f(0x13b)]=![];}async function setPresence(_0x5373ae,_0x3b674c){const _0x322fc0=a5_0x2637;if(_0x5373ae[_0x322fc0(0x129)]===_0x3b674c)return;_0x5373ae['isPresent']=_0x3b674c,await _0x5373ae[_0x322fc0(0x12f)](_0x322fc0(0x141),{'val':_0x3b674c,'ack':!![]});}async function updateHourlyActivity(_0x451d5d){const _0x49b801=a5_0x2637;let _0x19bad9=new Array(0x18)[_0x49b801(0xfc)](0x0),_0x2d0a91=0x0;try{const _0x5420ec=await _0x451d5d[_0x49b801(0x105)](_0x49b801(0xdd));_0x5420ec&&_0x5420ec[_0x49b801(0x137)]&&(_0x19bad9=JSON[_0x49b801(0x113)](_0x5420ec[_0x49b801(0x137)]),_0x2d0a91=_0x5420ec['ts']);}catch(_0x54eb06){}const _0x46d1c4=new Date(_0x2d0a91),_0x3dd82b=new Date();_0x46d1c4['getDate']()!==_0x3dd82b[_0x49b801(0x149)]()&&(_0x19bad9=new Array(0x18)[_0x49b801(0xfc)](0x0));const _0x176183=_0x3dd82b[_0x49b801(0xfe)]();if(_0x19bad9[_0x176183]===undefined)_0x19bad9[_0x176183]=0x0;_0x19bad9[_0x176183]++,await _0x451d5d['setStateAsync'](_0x49b801(0xdd),{'val':JSON[_0x49b801(0xed)](_0x19bad9),'ack':!![]});}async function processSensorEvent(_0x86fd,_0x17180c,_0x1f523a,_0x44d7ec){const _0x2e59b5=a5_0x2637;if(!_0x44d7ec)return null;const _0x436ea5=_0x1f523a[_0x2e59b5(0x137)],_0x19def6=Date[_0x2e59b5(0x148)](),_0x494799=_0x86fd['sensorLastValues'][_0x17180c],_0x120b01=(_0x44d7ec[_0x2e59b5(0x111)]||'')[_0x2e59b5(0x11d)](),_0x24ea04=_0x120b01[_0x2e59b5(0x12b)](_0x2e59b5(0xff))||_0x120b01[_0x2e59b5(0x12b)]('temperatur')||_0x120b01['includes'](_0x2e59b5(0x121))||_0x120b01[_0x2e59b5(0x12b)](_0x2e59b5(0x12c))||_0x120b01[_0x2e59b5(0x12b)](_0x2e59b5(0x14b));if(_0x24ea04&&typeof _0x436ea5===_0x2e59b5(0x120)){if(_0x436ea5>0x50||_0x436ea5<-0x32)return _0x86fd[_0x2e59b5(0x138)]['debug'](_0x2e59b5(0x136)+_0x436ea5+_0x2e59b5(0xe4)+_0x17180c),null;}_0x86fd['sensorLastValues'][_0x17180c]=_0x436ea5;if(!_0x44d7ec[_0x2e59b5(0x123)]&&_0x494799!=undefined&&_0x494799==_0x436ea5)return null;_0x86fd[_0x2e59b5(0x151)]&&_0x24ea04&&recordThermodynamics(_0x86fd,_0x17180c,_0x436ea5,_0x44d7ec['location']);const _0x3d1dd5={'timestamp':_0x19def6,'id':_0x17180c,'name':_0x44d7ec[_0x2e59b5(0x144)],'type':_0x44d7ec['type'],'location':_0x44d7ec[_0x2e59b5(0x104)],'value':_0x436ea5};_0x86fd['eventHistory'][_0x2e59b5(0x117)](_0x3d1dd5);if(_0x86fd['eventHistory'][_0x2e59b5(0xde)]>HISTORY_MAX_SIZE)_0x86fd[_0x2e59b5(0x101)][_0x2e59b5(0xf6)]();await _0x86fd[_0x2e59b5(0x12f)](_0x2e59b5(0x11f),{'val':JSON['stringify'](_0x3d1dd5),'ack':!![]}),await _0x86fd['setStateAsync'](_0x2e59b5(0xec),{'val':JSON[_0x2e59b5(0xed)](_0x86fd[_0x2e59b5(0x101)]),'ack':!![]}),await updateHourlyActivity(_0x86fd);if(_0x86fd['isProVersion']){_0x86fd[_0x2e59b5(0x10b)]['push'](_0x3d1dd5);if(_0x86fd['rawEventLog']['length']>RAW_LOG_MAX_SIZE)_0x86fd[_0x2e59b5(0x10b)][_0x2e59b5(0x142)](0x0,_0x86fd[_0x2e59b5(0x10b)][_0x2e59b5(0xde)]-RAW_LOG_MAX_SIZE);await _0x86fd['setStateAsync']('LTM.rawEventLog',{'val':JSON[_0x2e59b5(0xed)](_0x86fd[_0x2e59b5(0x10b)]),'ack':!![]}),recordSequence(_0x86fd,_0x3d1dd5);}if(_0x44d7ec[_0x2e59b5(0x12a)]&&_0x436ea5===!![]){if(_0x86fd[_0x2e59b5(0x129)]&&!_0x86fd[_0x2e59b5(0x13b)])startExitTimer(_0x86fd);else{if(!_0x86fd[_0x2e59b5(0x129)])setPresence(_0x86fd,!![]);}}else{if(_0x44d7ec['type']===_0x2e59b5(0xe1)&&_0x436ea5===!![]){if(_0x86fd['exitTimer'])abortExitTimer(_0x86fd);if(!_0x86fd[_0x2e59b5(0x129)]&&_0x86fd[_0x2e59b5(0x10a)]===_0x2e59b5(0x135))setPresence(_0x86fd,!![]);}}if(_0x86fd[_0x2e59b5(0x151)]&&_0x86fd[_0x2e59b5(0xeb)]){_0x44d7ec[_0x2e59b5(0x111)]==='motion'&&_0x436ea5===!![]&&_0x44d7ec[_0x2e59b5(0x104)]&&_0x86fd[_0x2e59b5(0xeb)](_0x2e59b5(0x12e),{'room':_0x44d7ec['location']});const _0x410d50=[_0x2e59b5(0xf7),'t체r',_0x2e59b5(0x13c),_0x2e59b5(0xe9),_0x2e59b5(0x14c),_0x2e59b5(0xdf),_0x2e59b5(0x10c),'schloss'][_0x2e59b5(0x102)](_0x502e33=>_0x120b01[_0x2e59b5(0x12b)](_0x502e33)),_0x3f7bfe=[_0x2e59b5(0x150),_0x2e59b5(0x106),'switch',_0x2e59b5(0x122),_0x2e59b5(0x14d),_0x2e59b5(0xf5)][_0x2e59b5(0x102)](_0xcab205=>_0x120b01[_0x2e59b5(0x12b)](_0xcab205)),_0x29d5d2=[_0x2e59b5(0xe1),_0x2e59b5(0x14f),'pr채senz','presence','occupancy']['some'](_0x5ad6be=>_0x120b01['includes'](_0x5ad6be));if(_0x44d7ec[_0x2e59b5(0x104)]&&(_0x410d50||_0x3f7bfe||_0x29d5d2)){const _0x2ca61a=_0x436ea5===!![]||typeof _0x436ea5===_0x2e59b5(0x120)&&_0x436ea5>0x0,_0x14f91a=_0x410d50&&!_0x2ca61a&&_0x494799!==undefined&&_0x494799!=_0x436ea5;if(_0x2ca61a||_0x14f91a){const _0x81e5cc=_0x86fd[_0x2e59b5(0xf4)]||_0x19def6,_0x5475b3=(_0x19def6-_0x81e5cc)/0x3e8;_0x86fd['lastTrackerEventTime']=_0x19def6,_0x86fd[_0x2e59b5(0xeb)](_0x2e59b5(0x131),{'room':_0x44d7ec['location'],'dt':_0x5475b3});}}}return _0x3d1dd5;}module['exports']={'processSensorEvent':processSensorEvent,'getOutsideTemperatureNumeric':getOutsideTemperatureNumeric,'setPresence':setPresence,'abortExitTimer':abortExitTimer,'startExitTimer':startExitTimer};