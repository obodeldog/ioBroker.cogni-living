(function(_0x36cf55,_0x5e0b10){const _0x11837f=a5_0x597f,_0x2c5911=_0x36cf55();while(!![]){try{const _0x1d1949=-parseInt(_0x11837f(0x146))/0x1+-parseInt(_0x11837f(0x15b))/0x2+parseInt(_0x11837f(0x152))/0x3*(-parseInt(_0x11837f(0x165))/0x4)+parseInt(_0x11837f(0x161))/0x5*(-parseInt(_0x11837f(0x149))/0x6)+-parseInt(_0x11837f(0x194))/0x7*(-parseInt(_0x11837f(0x193))/0x8)+-parseInt(_0x11837f(0x144))/0x9+-parseInt(_0x11837f(0x178))/0xa*(-parseInt(_0x11837f(0x16a))/0xb);if(_0x1d1949===_0x5e0b10)break;else _0x2c5911['push'](_0x2c5911['shift']());}catch(_0xbad55){_0x2c5911['push'](_0x2c5911['shift']());}}}(a5_0x1feb,0x4784a));const a5_0x1fa9f7=(function(){let _0x794066=!![];return function(_0x11e593,_0x2eb428){const _0x5d46b1=_0x794066?function(){const _0x7489a3=a5_0x597f;if(_0x2eb428){const _0x57859b=_0x2eb428[_0x7489a3(0x16d)](_0x11e593,arguments);return _0x2eb428=null,_0x57859b;}}:function(){};return _0x794066=![],_0x5d46b1;};}()),a5_0x5234cd=a5_0x1fa9f7(this,function(){const _0x5f4b1c=a5_0x597f;return a5_0x5234cd[_0x5f4b1c(0x14b)]()[_0x5f4b1c(0x187)](_0x5f4b1c(0x16c))[_0x5f4b1c(0x14b)]()[_0x5f4b1c(0x153)](a5_0x5234cd)[_0x5f4b1c(0x187)](_0x5f4b1c(0x16c));});a5_0x5234cd();function a5_0x597f(_0x1e90bd,_0x5ad839){const _0x2af4f5=a5_0x1feb();return a5_0x597f=function(_0x5234cd,_0x1fa9f7){_0x5234cd=_0x5234cd-0x130;let _0x1febe3=_0x2af4f5[_0x5234cd];return _0x1febe3;},a5_0x597f(_0x1e90bd,_0x5ad839);}'use strict';const HISTORY_MAX_SIZE=0x32,RAW_LOG_MAX_SIZE=0x9c4,THERMO_LOG_SIZE=0x3e8,SEQUENCE_TIMEOUT_MS=0x5*0x3c*0x3e8,MAX_TRAINING_SET_SIZE=0x1f4,EXIT_TIMER_MINUTES=0xf,EXIT_GRACE_PERIOD_SECONDS=0x1e;let activeSequence=[],sequenceTimer=null;async function getOutsideTemperatureNumeric(_0x3a74df){const _0x5a012f=a5_0x597f;if(_0x3a74df['config'][_0x5a012f(0x18e)])try{const _0x24a01b=await _0x3a74df[_0x5a012f(0x13d)](_0x3a74df[_0x5a012f(0x17a)][_0x5a012f(0x18e)]);if(_0x24a01b&&_0x24a01b['val']!==undefined&&_0x24a01b[_0x5a012f(0x186)]!==null)return parseFloat(_0x24a01b['val']);}catch(_0x4a039c){}const _0x5e0e53=_0x3a74df[_0x5a012f(0x17a)][_0x5a012f(0x173)];if(!_0x3a74df['config'][_0x5a012f(0x167)]||!_0x5e0e53)return null;try{let _0x580659='';if(_0x5e0e53[_0x5a012f(0x158)](_0x5a012f(0x181)))_0x580659=_0x5e0e53+_0x5a012f(0x13f);else{if(_0x5e0e53[_0x5a012f(0x158)]('daswetter'))_0x580659=_0x5e0e53+'.NextHours.Location_1.Day_1.current.temp_value';else{if(_0x5e0e53['includes'](_0x5a012f(0x192)))_0x580659=_0x5e0e53+_0x5a012f(0x190);else{if(_0x5e0e53[_0x5a012f(0x158)](_0x5a012f(0x17e)))_0x580659=_0x5e0e53+_0x5a012f(0x18d);}}}if(_0x580659){const _0x6387de=await _0x3a74df[_0x5a012f(0x13d)](_0x580659);if(_0x6387de&&_0x6387de['val']!==undefined&&_0x6387de[_0x5a012f(0x186)]!==null)return parseFloat(_0x6387de[_0x5a012f(0x186)]);}}catch(_0x2211a7){}return null;}async function recordThermodynamics(_0x7a9bb7,_0x277017,_0x5b770d,_0x3ff669){const _0x1317ff=a5_0x597f,_0x1f48d5=await getOutsideTemperatureNumeric(_0x7a9bb7);if(_0x1f48d5===null)return;let _0x42739e=0x0,_0x23b5e3=![];if(_0x7a9bb7[_0x1317ff(0x17a)][_0x1317ff(0x163)])try{let _0x357e2c=_0x7a9bb7[_0x1317ff(0x17a)][_0x1317ff(0x163)];if(typeof _0x357e2c===_0x1317ff(0x154))_0x357e2c=JSON['parse'](_0x357e2c);if(_0x357e2c[_0x277017]){const _0x59f21f=_0x357e2c[_0x277017],_0x15d1cf=await _0x7a9bb7[_0x1317ff(0x13d)](_0x59f21f);if(_0x15d1cf&&_0x15d1cf['val']!==null&&_0x15d1cf[_0x1317ff(0x186)]!==undefined){let _0x1cc407=Number(_0x15d1cf[_0x1317ff(0x186)]);if(_0x1cc407<=1.05&&!_0x59f21f[_0x1317ff(0x158)](_0x1317ff(0x189))&&!_0x59f21f[_0x1317ff(0x158)]('STATE'))_0x1cc407=_0x1cc407*0x64;_0x42739e=Math[_0x1317ff(0x14f)](_0x1cc407),_0x23b5e3=!![];}}}catch(_0x126a59){}if(!_0x23b5e3){const _0x25503c=[{'from':'.1.ACTUAL_TEMPERATURE','to':_0x1317ff(0x16e)},{'from':_0x1317ff(0x151),'to':_0x1317ff(0x18c)},{'from':_0x1317ff(0x14c),'to':'.4.VALVE_STATE'},{'from':_0x1317ff(0x13b),'to':_0x1317ff(0x169)},{'from':_0x1317ff(0x132),'to':_0x1317ff(0x155)},{'from':_0x1317ff(0x156),'to':_0x1317ff(0x14e)}];for(const _0x54c886 of _0x25503c){if(_0x277017[_0x1317ff(0x158)](_0x54c886['from'])){const _0x2446a6=_0x277017[_0x1317ff(0x185)](_0x54c886[_0x1317ff(0x182)],_0x54c886['to']);try{const _0x325f17=await _0x7a9bb7[_0x1317ff(0x13d)](_0x2446a6);if(_0x325f17&&_0x325f17[_0x1317ff(0x186)]!==null&&_0x325f17['val']!==undefined){let _0x2622aa=Number(_0x325f17['val']);if(typeof _0x2622aa===_0x1317ff(0x18a)){if(_0x2622aa<=1.05&&_0x54c886['to'][_0x1317ff(0x158)](_0x1317ff(0x16f)))_0x2622aa=_0x2622aa*0x64;_0x42739e=Math[_0x1317ff(0x14f)](_0x2622aa),_0x23b5e3=!![];break;}}}catch(_0x5bc889){}}}}const _0x3ccb02=await _0x7a9bb7['getStateAsync'](_0x1317ff(0x176));let _0x564a3d=[];if(_0x3ccb02&&_0x3ccb02[_0x1317ff(0x186)])try{_0x564a3d=JSON[_0x1317ff(0x15e)](_0x3ccb02[_0x1317ff(0x186)]);}catch(_0x8b2a88){}_0x564a3d['push']({'ts':Date[_0x1317ff(0x130)](),'room':_0x3ff669||_0x1317ff(0x184),'t_in':_0x5b770d,'t_out':_0x1f48d5,'valve':_0x42739e});if(_0x564a3d['length']>THERMO_LOG_SIZE)_0x564a3d[_0x1317ff(0x160)]();await _0x7a9bb7[_0x1317ff(0x136)](_0x1317ff(0x176),{'val':JSON[_0x1317ff(0x174)](_0x564a3d),'ack':!![]});}async function saveCompletedSequence(_0x211b4e){const _0x2af620=a5_0x597f;try{const _0x37a010=await _0x211b4e[_0x2af620(0x140)](_0x2af620(0x131));let _0x48a65f=[];if(_0x37a010&&_0x37a010[_0x2af620(0x186)])try{_0x48a65f=JSON[_0x2af620(0x15e)](_0x37a010['val']);}catch(_0x20642c){}const _0x432037=activeSequence[0x0]['ts'],_0x321bee=activeSequence['map'](_0x3aa611=>({'loc':_0x3aa611['loc'],'t_delta':Math[_0x2af620(0x14f)]((_0x3aa611['ts']-_0x432037)/0x3e8)})),_0x590955={'timestamp':new Date(_0x432037)[_0x2af620(0x164)](),'steps':_0x321bee,'duration':Math[_0x2af620(0x14f)]((activeSequence[activeSequence[_0x2af620(0x15c)]-0x1]['ts']-_0x432037)/0x3e8),'daytime':new Date(_0x432037)[_0x2af620(0x179)]()};_0x48a65f['push'](_0x590955);if(_0x48a65f[_0x2af620(0x15c)]>MAX_TRAINING_SET_SIZE)_0x48a65f[_0x2af620(0x160)]();await _0x211b4e[_0x2af620(0x136)](_0x2af620(0x131),{'val':JSON['stringify'](_0x48a65f),'ack':!![]}),_0x211b4e[_0x2af620(0x162)]&&_0x211b4e['sendToPythonWrapper']&&_0x211b4e[_0x2af620(0x18b)]('ANALYZE_SEQUENCE',{'sequence':_0x590955});}catch(_0x491cef){_0x211b4e['log'][_0x2af620(0x13c)]('[RECORDER]\x20Error:\x20'+_0x491cef[_0x2af620(0x195)]);}}async function recordSequence(_0x1cf87e,_0x178ca6){const _0x312744=a5_0x597f,_0x48ff1d=(_0x178ca6[_0x312744(0x175)]||'')[_0x312744(0x148)](),_0x3f3c19=[_0x312744(0x18f),_0x312744(0x14a),_0x312744(0x134),'presence',_0x312744(0x13e),'door',_0x312744(0x14d),_0x312744(0x135),_0x312744(0x159),'contact',_0x312744(0x142),_0x312744(0x172),'licht',_0x312744(0x150),'schalter',_0x312744(0x177),_0x312744(0x183)];if(!_0x3f3c19[_0x312744(0x15f)](_0x42eb5b=>_0x48ff1d[_0x312744(0x158)](_0x42eb5b)))return;if(!_0x178ca6[_0x312744(0x157)])return;if(sequenceTimer)clearTimeout(sequenceTimer);activeSequence['push']({'loc':_0x178ca6['location']||'Unknown','id':_0x178ca6['id'],'ts':Date['now']()}),sequenceTimer=setTimeout(async()=>{const _0x24f527=_0x312744;if(activeSequence[_0x24f527(0x15c)]>0x1)await saveCompletedSequence(_0x1cf87e);activeSequence=[];},SEQUENCE_TIMEOUT_MS);}function startExitTimer(_0x5c3be5){const _0x39be1c=a5_0x597f;abortExitTimer(_0x5c3be5),_0x5c3be5[_0x39be1c(0x147)]=!![],_0x5c3be5[_0x39be1c(0x133)]=setTimeout(()=>{const _0x3a68d1=_0x39be1c;_0x5c3be5[_0x3a68d1(0x147)]=![];},EXIT_GRACE_PERIOD_SECONDS*0x3e8),_0x5c3be5['exitTimer']=setTimeout(()=>{const _0x1661c9=_0x39be1c;setPresence(_0x5c3be5,![]),_0x5c3be5[_0x1661c9(0x191)]=null;},EXIT_TIMER_MINUTES*0x3c*0x3e8);}function abortExitTimer(_0x485bae){const _0x295a5d=a5_0x597f;if(_0x485bae['exitTimer'])clearTimeout(_0x485bae['exitTimer']);if(_0x485bae[_0x295a5d(0x133)])clearTimeout(_0x485bae[_0x295a5d(0x133)]);_0x485bae[_0x295a5d(0x191)]=null,_0x485bae[_0x295a5d(0x133)]=null,_0x485bae[_0x295a5d(0x147)]=![];}async function setPresence(_0x1a7f23,_0x531dbd){const _0x3aff88=a5_0x597f;if(_0x1a7f23['isPresent']===_0x531dbd)return;_0x1a7f23[_0x3aff88(0x16b)]=_0x531dbd,await _0x1a7f23[_0x3aff88(0x136)](_0x3aff88(0x196),{'val':_0x531dbd,'ack':!![]});}async function processSensorEvent(_0x38c308,_0xe72885,_0x1eef54,_0x4eed7a){const _0x559d64=a5_0x597f;if(!_0x4eed7a)return null;const _0x3f575c=_0x1eef54[_0x559d64(0x186)],_0x1221c9=Date[_0x559d64(0x130)](),_0x493af1=_0x38c308[_0x559d64(0x13a)][_0xe72885];_0x38c308[_0x559d64(0x13a)][_0xe72885]=_0x3f575c;if(!_0x4eed7a['logDuplicates']&&_0x493af1!=undefined&&_0x493af1==_0x3f575c)return null;const _0x3959f2=(_0x4eed7a[_0x559d64(0x175)]||'')[_0x559d64(0x148)](),_0x2ab23d=_0x3959f2['includes'](_0x559d64(0x132))||_0x3959f2[_0x559d64(0x158)]('temperatur')||_0x3959f2[_0x559d64(0x158)]('klima')||_0x3959f2[_0x559d64(0x158)](_0x559d64(0x171))||_0x3959f2['includes'](_0x559d64(0x170));_0x38c308[_0x559d64(0x162)]&&_0x2ab23d&&recordThermodynamics(_0x38c308,_0xe72885,_0x3f575c,_0x4eed7a[_0x559d64(0x138)]);const _0x18a35e={'timestamp':_0x1221c9,'id':_0xe72885,'name':_0x4eed7a[_0x559d64(0x15d)],'type':_0x4eed7a[_0x559d64(0x175)],'location':_0x4eed7a[_0x559d64(0x138)],'value':_0x3f575c};_0x38c308[_0x559d64(0x139)][_0x559d64(0x141)](_0x18a35e);if(_0x38c308[_0x559d64(0x139)][_0x559d64(0x15c)]>HISTORY_MAX_SIZE)_0x38c308[_0x559d64(0x139)][_0x559d64(0x168)]();await _0x38c308['setStateAsync'](_0x559d64(0x17b),{'val':JSON[_0x559d64(0x174)](_0x18a35e),'ack':!![]}),await _0x38c308[_0x559d64(0x136)]('events.history',{'val':JSON[_0x559d64(0x174)](_0x38c308[_0x559d64(0x139)]),'ack':!![]});if(_0x38c308[_0x559d64(0x162)]){_0x38c308['rawEventLog'][_0x559d64(0x145)](_0x18a35e);if(_0x38c308[_0x559d64(0x188)]['length']>RAW_LOG_MAX_SIZE)_0x38c308[_0x559d64(0x188)][_0x559d64(0x166)](0x0,_0x38c308[_0x559d64(0x188)][_0x559d64(0x15c)]-RAW_LOG_MAX_SIZE);await _0x38c308[_0x559d64(0x136)](_0x559d64(0x143),{'val':JSON[_0x559d64(0x174)](_0x38c308[_0x559d64(0x188)]),'ack':!![]}),recordSequence(_0x38c308,_0x18a35e);}if(_0x4eed7a[_0x559d64(0x137)]&&_0x3f575c===!![]){if(_0x38c308['isPresent']&&!_0x38c308['isGracePeriodActive'])startExitTimer(_0x38c308);else{if(!_0x38c308[_0x559d64(0x16b)])setPresence(_0x38c308,!![]);}}else{if(_0x4eed7a['type']===_0x559d64(0x18f)&&_0x3f575c===!![]){if(_0x38c308['exitTimer'])abortExitTimer(_0x38c308);if(!_0x38c308[_0x559d64(0x16b)]&&_0x38c308[_0x559d64(0x17f)]===_0x559d64(0x17d))setPresence(_0x38c308,!![]);}}if(_0x38c308[_0x559d64(0x162)]&&_0x38c308[_0x559d64(0x18b)]){_0x4eed7a[_0x559d64(0x175)]===_0x559d64(0x18f)&&_0x3f575c===!![]&&_0x4eed7a[_0x559d64(0x138)]&&_0x38c308[_0x559d64(0x18b)](_0x559d64(0x17c),{'room':_0x4eed7a[_0x559d64(0x138)]});const _0x448fd3=_0x3f575c===!![]||typeof _0x3f575c===_0x559d64(0x18a)&&_0x3f575c>0x0,_0x240e92=!_0x448fd3&&_0x493af1!==undefined&&_0x493af1!=_0x3f575c;if(_0x4eed7a['location']&&(_0x448fd3||_0x240e92)){const _0xdf1dd0=_0x38c308[_0x559d64(0x15a)]||_0x1221c9,_0x1f96d1=(_0x1221c9-_0xdf1dd0)/0x3e8;_0x38c308['lastTrackerEventTime']=_0x1221c9,_0x38c308[_0x559d64(0x18b)](_0x559d64(0x180),{'room':_0x4eed7a[_0x559d64(0x138)],'dt':_0x1f96d1});}}return _0x18a35e;}function a5_0x1feb(){const _0x2ea701=['exitGraceTimer','präsenz','window','setStateAsync','isExit','location','eventHistory','sensorLastValues','.ACTUAL_TEMPERATURE','error','getForeignStateAsync','occupancy','.Current.Temperature','getStateAsync','unshift','kontakt','LTM.rawEventLog','5010624idjHEQ','push','282361PiSqgY','isGracePeriodActive','toLowerCase','3425550CNwRGL','bewegung','toString','.1.TEMPERATURE','tür','Valve','round','switch','.1.ACTUAL_TEMPERATURE','3BEAxvy','constructor','string','level','Temperature','value','includes','fenster','lastTrackerEventTime','573872NeaWTq','length','name','parse','some','shift','5wfEwTJ','isProVersion','valveMapping','toISOString','346168ubpdKM','splice','useWeather','pop','.LEVEL','631169FgTfZL','isPresent','(((.+)+)+)+$','apply','.1.LEVEL','LEVEL','thermostat','heizung','light','weatherInstance','stringify','type','LTM.trainingData.thermodynamics','dimmer','280jMgLdd','getHours','config','events.lastEvent','SIMULATE_SIGNAL','normal','weatherunderground','currentSystemMode','TRACK_EVENT','accuweather','from','lampe','Unknown','replace','val','search','rawEventLog','STATUS','number','sendToPythonWrapper','.1.VALVE_STATE','.forecast.current.temp','outdoorSensorId','motion','.forecast.current.temperature','exitTimer','openweathermap','14512YSFwYx','1813RKgDyz','message','system.isPresent','now','LTM.trainingData.sequences','temperature'];a5_0x1feb=function(){return _0x2ea701;};return a5_0x1feb();}module['exports']={'processSensorEvent':processSensorEvent,'getOutsideTemperatureNumeric':getOutsideTemperatureNumeric,'setPresence':setPresence,'abortExitTimer':abortExitTimer,'startExitTimer':startExitTimer};