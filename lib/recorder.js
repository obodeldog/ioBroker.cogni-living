const a5_0x3952ae=a5_0x151e;(function(_0x1c9a25,_0x42cf4c){const _0x27e2d8=a5_0x151e,_0x137aca=_0x1c9a25();while(!![]){try{const _0x32369c=-parseInt(_0x27e2d8(0x16b))/0x1*(parseInt(_0x27e2d8(0x195))/0x2)+parseInt(_0x27e2d8(0x147))/0x3*(parseInt(_0x27e2d8(0x1b1))/0x4)+parseInt(_0x27e2d8(0x153))/0x5+-parseInt(_0x27e2d8(0x18d))/0x6*(parseInt(_0x27e2d8(0x18c))/0x7)+-parseInt(_0x27e2d8(0x15a))/0x8*(-parseInt(_0x27e2d8(0x190))/0x9)+parseInt(_0x27e2d8(0x197))/0xa*(-parseInt(_0x27e2d8(0x174))/0xb)+parseInt(_0x27e2d8(0x1b0))/0xc;if(_0x32369c===_0x42cf4c)break;else _0x137aca['push'](_0x137aca['shift']());}catch(_0x570cff){_0x137aca['push'](_0x137aca['shift']());}}}(a5_0x3f1d,0xe7190));const a5_0x121580=(function(){let _0x1b08e8=!![];return function(_0x2254ce,_0x1727b2){const _0x474246=_0x1b08e8?function(){if(_0x1727b2){const _0x3b649c=_0x1727b2['apply'](_0x2254ce,arguments);return _0x1727b2=null,_0x3b649c;}}:function(){};return _0x1b08e8=![],_0x474246;};}()),a5_0x1edb6f=a5_0x121580(this,function(){const _0x12bb49=a5_0x151e;return a5_0x1edb6f[_0x12bb49(0x1a2)]()[_0x12bb49(0x18b)](_0x12bb49(0x179))[_0x12bb49(0x1a2)]()[_0x12bb49(0x181)](a5_0x1edb6f)[_0x12bb49(0x18b)](_0x12bb49(0x179));});a5_0x1edb6f();'use strict';function a5_0x3f1d(){const _0x4286f9=['exitTimer','length','toString','.1.VALVE_STATE','parse','.forecast.current.temperature','.ACTUAL_TEMPERATURE','rawEventLog','stringify','isPresent','now','.1.TEMPERATURE','isProVersion','normal','\x20from\x20','door','10039188wKiPVC','4JPuhOJ','temperature','licht','lock','TRACK_EVENT','motion','accuweather','loc','fill','STATUS','type','getHours','lastTrackerEventTime','3007644MwYFaE','useWeather','kontakt','getDate','string','bewegung','map','presence','toLowerCase','from','getForeignStateAsync','value','2070575JKRIsy','.NextHours.Location_1.Day_1.current.temp_value','weatherunderground','includes','location','error','splice','16DeJDUJ','fenster','replace','val','pop','.Current.Temperature','sendToPythonWrapper','exports','switch','[RECORDER]\x20Ignored\x20implausible\x20temperature:\x20','Unknown','events.lastEvent','unshift','occupancy','log','LTM.trainingData.thermodynamics','window','1oyieOe','daswetter','events.history','currentSystemMode','openweathermap','griff','schalter','shift','präsenz','116611lZNeuU','Valve','system.isPresent','LEVEL','round','(((.+)+)+)+$','eventHistory','light','getStateAsync','tür','.4.VALVE_STATE','sensorLastValues','config','constructor','LTM.rawEventLog','[RECORDER]\x20Error:\x20','klima','exitGraceTimer','isGracePeriodActive','some','logDuplicates','lampe','valveMapping','search','5925332TanLxC','6uBomeM','ANALYZE_SEQUENCE','temperatur','5520915tANEii','number','.1.ACTUAL_TEMPERATURE','dimmer','level','1953626xFdOfN','name','670gcmxbP','LTM.trainingData.sequences','.1.LEVEL','setStateAsync','.LEVEL','isExit','STATE','push','message'];a5_0x3f1d=function(){return _0x4286f9;};return a5_0x3f1d();}const HISTORY_MAX_SIZE=0x32,RAW_LOG_MAX_SIZE=0x9c4,THERMO_LOG_SIZE=0x3e8,SEQUENCE_TIMEOUT_MS=0x5*0x3c*0x3e8,MAX_TRAINING_SET_SIZE=0x1f4,EXIT_TIMER_MINUTES=0xf,EXIT_GRACE_PERIOD_SECONDS=0x1e;let activeSequence=[],sequenceTimer=null,dailyActivityLog=new Array(0x18)[a5_0x3952ae(0x142)](0x0),lastLogDay=new Date()['getDate']();async function getOutsideTemperatureNumeric(_0x48c511){const _0x1df488=a5_0x3952ae;if(_0x48c511[_0x1df488(0x180)]['outdoorSensorId'])try{const _0x1fbd5e=await _0x48c511[_0x1df488(0x151)](_0x48c511[_0x1df488(0x180)]['outdoorSensorId']);if(_0x1fbd5e&&_0x1fbd5e[_0x1df488(0x15d)]!==undefined&&_0x1fbd5e['val']!==null)return parseFloat(_0x1fbd5e[_0x1df488(0x15d)]);}catch(_0x58aa83){}const _0x2e87a0=_0x48c511[_0x1df488(0x180)]['weatherInstance'];if(!_0x48c511[_0x1df488(0x180)][_0x1df488(0x148)]||!_0x2e87a0)return null;try{let _0x5d2809='';if(_0x2e87a0[_0x1df488(0x156)](_0x1df488(0x140)))_0x5d2809=_0x2e87a0+_0x1df488(0x15f);else{if(_0x2e87a0['includes'](_0x1df488(0x16c)))_0x5d2809=_0x2e87a0+_0x1df488(0x154);else{if(_0x2e87a0[_0x1df488(0x156)](_0x1df488(0x16f)))_0x5d2809=_0x2e87a0+_0x1df488(0x1a5);else{if(_0x2e87a0['includes'](_0x1df488(0x155)))_0x5d2809=_0x2e87a0+'.forecast.current.temp';}}}if(_0x5d2809){const _0x102386=await _0x48c511[_0x1df488(0x151)](_0x5d2809);if(_0x102386&&_0x102386[_0x1df488(0x15d)]!==undefined&&_0x102386[_0x1df488(0x15d)]!==null)return parseFloat(_0x102386[_0x1df488(0x15d)]);}}catch(_0x5e62d1){}return null;}async function recordThermodynamics(_0x49a5ad,_0x3d3fa9,_0x280242,_0xb4a8f9){const _0x445f1e=a5_0x3952ae,_0x29ccde=await getOutsideTemperatureNumeric(_0x49a5ad);if(_0x29ccde===null)return;let _0x2958d0=0x0,_0x3f9f9b=![];if(_0x49a5ad[_0x445f1e(0x180)][_0x445f1e(0x18a)])try{let _0x16722a=_0x49a5ad[_0x445f1e(0x180)][_0x445f1e(0x18a)];if(typeof _0x16722a===_0x445f1e(0x14b))_0x16722a=JSON[_0x445f1e(0x1a4)](_0x16722a);if(_0x16722a[_0x3d3fa9]){const _0x5135c0=_0x16722a[_0x3d3fa9],_0x7f45a3=await _0x49a5ad[_0x445f1e(0x151)](_0x5135c0);if(_0x7f45a3&&_0x7f45a3[_0x445f1e(0x15d)]!==null&&_0x7f45a3[_0x445f1e(0x15d)]!==undefined){let _0x37bb51=Number(_0x7f45a3[_0x445f1e(0x15d)]);if(_0x37bb51<=1.05&&!_0x5135c0[_0x445f1e(0x156)](_0x445f1e(0x143))&&!_0x5135c0[_0x445f1e(0x156)](_0x445f1e(0x19d)))_0x37bb51=_0x37bb51*0x64;_0x2958d0=Math[_0x445f1e(0x178)](_0x37bb51),_0x3f9f9b=!![];}}}catch(_0x42a23e){}if(!_0x3f9f9b){const _0x1655f4=[{'from':_0x445f1e(0x192),'to':_0x445f1e(0x199)},{'from':_0x445f1e(0x192),'to':_0x445f1e(0x1a3)},{'from':_0x445f1e(0x1ab),'to':_0x445f1e(0x17e)},{'from':_0x445f1e(0x1a6),'to':_0x445f1e(0x19b)},{'from':_0x445f1e(0x13b),'to':_0x445f1e(0x194)},{'from':'Temperature','to':_0x445f1e(0x175)}];for(const _0x170aaa of _0x1655f4){if(_0x3d3fa9[_0x445f1e(0x156)](_0x170aaa['from'])){const _0x178d63=_0x3d3fa9[_0x445f1e(0x15c)](_0x170aaa[_0x445f1e(0x150)],_0x170aaa['to']);try{const _0x24faaa=await _0x49a5ad[_0x445f1e(0x151)](_0x178d63);if(_0x24faaa&&_0x24faaa[_0x445f1e(0x15d)]!==null&&_0x24faaa[_0x445f1e(0x15d)]!==undefined){let _0x4868c4=Number(_0x24faaa[_0x445f1e(0x15d)]);if(typeof _0x4868c4===_0x445f1e(0x191)){if(_0x4868c4<=1.05&&_0x170aaa['to'][_0x445f1e(0x156)](_0x445f1e(0x177)))_0x4868c4=_0x4868c4*0x64;_0x2958d0=Math[_0x445f1e(0x178)](_0x4868c4),_0x3f9f9b=!![];break;}}}catch(_0x59ff7b){}}}}const _0x151732=await _0x49a5ad[_0x445f1e(0x17c)](_0x445f1e(0x169));let _0x40315d=[];if(_0x151732&&_0x151732['val'])try{_0x40315d=JSON[_0x445f1e(0x1a4)](_0x151732[_0x445f1e(0x15d)]);}catch(_0x39eb8d){}_0x40315d[_0x445f1e(0x19e)]({'ts':Date[_0x445f1e(0x1aa)](),'room':_0xb4a8f9||_0x445f1e(0x164),'t_in':_0x280242,'t_out':_0x29ccde,'valve':_0x2958d0});if(_0x40315d['length']>THERMO_LOG_SIZE)_0x40315d['shift']();await _0x49a5ad[_0x445f1e(0x19a)](_0x445f1e(0x169),{'val':JSON['stringify'](_0x40315d),'ack':!![]});}async function saveCompletedSequence(_0x531aa7){const _0x4c7eb9=a5_0x3952ae;try{const _0x2c3881=await _0x531aa7[_0x4c7eb9(0x17c)](_0x4c7eb9(0x198));let _0x580130=[];if(_0x2c3881&&_0x2c3881[_0x4c7eb9(0x15d)])try{_0x580130=JSON[_0x4c7eb9(0x1a4)](_0x2c3881['val']);}catch(_0x2d9e6a){}const _0x448904=activeSequence[0x0]['ts'],_0x4e4051=activeSequence[_0x4c7eb9(0x14d)](_0x1bf2f8=>({'loc':_0x1bf2f8[_0x4c7eb9(0x141)],'t_delta':Math[_0x4c7eb9(0x178)]((_0x1bf2f8['ts']-_0x448904)/0x3e8)})),_0x55d56f={'timestamp':new Date(_0x448904)['toISOString'](),'steps':_0x4e4051,'duration':Math[_0x4c7eb9(0x178)]((activeSequence[activeSequence[_0x4c7eb9(0x1a1)]-0x1]['ts']-_0x448904)/0x3e8),'daytime':new Date(_0x448904)[_0x4c7eb9(0x145)]()};_0x580130['push'](_0x55d56f);if(_0x580130[_0x4c7eb9(0x1a1)]>MAX_TRAINING_SET_SIZE)_0x580130[_0x4c7eb9(0x172)]();await _0x531aa7[_0x4c7eb9(0x19a)]('LTM.trainingData.sequences',{'val':JSON[_0x4c7eb9(0x1a8)](_0x580130),'ack':!![]}),_0x531aa7[_0x4c7eb9(0x1ac)]&&_0x531aa7[_0x4c7eb9(0x160)]&&_0x531aa7[_0x4c7eb9(0x160)](_0x4c7eb9(0x18e),{'sequence':_0x55d56f});}catch(_0x9cf9e1){_0x531aa7[_0x4c7eb9(0x168)][_0x4c7eb9(0x158)](_0x4c7eb9(0x183)+_0x9cf9e1[_0x4c7eb9(0x19f)]);}}async function recordSequence(_0x5378f6,_0x1b2dd9){const _0x5ad045=a5_0x3952ae,_0x96fa49=(_0x1b2dd9['type']||'')[_0x5ad045(0x14f)](),_0x20815c=[_0x5ad045(0x13f),_0x5ad045(0x14c),_0x5ad045(0x173),_0x5ad045(0x14e),_0x5ad045(0x167),_0x5ad045(0x1af),_0x5ad045(0x17d),_0x5ad045(0x16a),_0x5ad045(0x15b),'contact',_0x5ad045(0x149),'light','licht','switch',_0x5ad045(0x171),_0x5ad045(0x193),_0x5ad045(0x189)];if(!_0x20815c[_0x5ad045(0x187)](_0x3ceec5=>_0x96fa49[_0x5ad045(0x156)](_0x3ceec5)))return;if(!_0x1b2dd9[_0x5ad045(0x152)])return;if(sequenceTimer)clearTimeout(sequenceTimer);activeSequence[_0x5ad045(0x19e)]({'loc':_0x1b2dd9['location']||_0x5ad045(0x164),'id':_0x1b2dd9['id'],'ts':Date[_0x5ad045(0x1aa)]()}),sequenceTimer=setTimeout(async()=>{const _0x54cb09=_0x5ad045;if(activeSequence[_0x54cb09(0x1a1)]>0x1)await saveCompletedSequence(_0x5378f6);activeSequence=[];},SEQUENCE_TIMEOUT_MS);}function startExitTimer(_0x33c6ea){const _0x5d77fa=a5_0x3952ae;abortExitTimer(_0x33c6ea),_0x33c6ea['isGracePeriodActive']=!![],_0x33c6ea['exitGraceTimer']=setTimeout(()=>{const _0x597e1c=a5_0x151e;_0x33c6ea[_0x597e1c(0x186)]=![];},EXIT_GRACE_PERIOD_SECONDS*0x3e8),_0x33c6ea[_0x5d77fa(0x1a0)]=setTimeout(()=>{const _0x5a74df=_0x5d77fa;setPresence(_0x33c6ea,![]),_0x33c6ea[_0x5a74df(0x1a0)]=null;},EXIT_TIMER_MINUTES*0x3c*0x3e8);}function abortExitTimer(_0x48c5ed){const _0x9e54d7=a5_0x3952ae;if(_0x48c5ed[_0x9e54d7(0x1a0)])clearTimeout(_0x48c5ed[_0x9e54d7(0x1a0)]);if(_0x48c5ed[_0x9e54d7(0x185)])clearTimeout(_0x48c5ed['exitGraceTimer']);_0x48c5ed[_0x9e54d7(0x1a0)]=null,_0x48c5ed[_0x9e54d7(0x185)]=null,_0x48c5ed[_0x9e54d7(0x186)]=![];}async function setPresence(_0x426a33,_0x19e4fd){const _0x2438f7=a5_0x3952ae;if(_0x426a33[_0x2438f7(0x1a9)]===_0x19e4fd)return;_0x426a33[_0x2438f7(0x1a9)]=_0x19e4fd,await _0x426a33[_0x2438f7(0x19a)](_0x2438f7(0x176),{'val':_0x19e4fd,'ack':!![]});}async function updateHourlyActivity(_0x1de131){const _0xfede65=a5_0x3952ae,_0x3e4403=new Date()[_0xfede65(0x14a)]();_0x3e4403!==lastLogDay&&(dailyActivityLog=new Array(0x18)[_0xfede65(0x142)](0x0),lastLogDay=_0x3e4403);const _0x2462e1=new Date()['getHours']();if(dailyActivityLog[_0x2462e1]===undefined)dailyActivityLog[_0x2462e1]=0x0;dailyActivityLog[_0x2462e1]++,await _0x1de131[_0xfede65(0x19a)]('analysis.health.todayVector',{'val':JSON[_0xfede65(0x1a8)](dailyActivityLog),'ack':!![]});}async function processSensorEvent(_0x1a59cc,_0x1beceb,_0x166f12,_0x4a4c5c){const _0x31e183=a5_0x3952ae;if(!_0x4a4c5c)return null;const _0x5dbb21=_0x166f12[_0x31e183(0x15d)],_0x2a5b47=Date['now'](),_0x261dcd=_0x1a59cc[_0x31e183(0x17f)][_0x1beceb],_0x48e50a=(_0x4a4c5c[_0x31e183(0x144)]||'')[_0x31e183(0x14f)](),_0x590a10=_0x48e50a[_0x31e183(0x156)](_0x31e183(0x13b))||_0x48e50a[_0x31e183(0x156)](_0x31e183(0x18f))||_0x48e50a[_0x31e183(0x156)](_0x31e183(0x184))||_0x48e50a[_0x31e183(0x156)]('heizung')||_0x48e50a[_0x31e183(0x156)]('thermostat');if(_0x590a10&&typeof _0x5dbb21==='number'){if(_0x5dbb21>0x50||_0x5dbb21<-0x32)return _0x1a59cc[_0x31e183(0x168)]['debug'](_0x31e183(0x163)+_0x5dbb21+_0x31e183(0x1ae)+_0x1beceb),null;}_0x1a59cc[_0x31e183(0x17f)][_0x1beceb]=_0x5dbb21;if(!_0x4a4c5c[_0x31e183(0x188)]&&_0x261dcd!=undefined&&_0x261dcd==_0x5dbb21)return null;_0x1a59cc[_0x31e183(0x1ac)]&&_0x590a10&&recordThermodynamics(_0x1a59cc,_0x1beceb,_0x5dbb21,_0x4a4c5c[_0x31e183(0x157)]);const _0x2db5a0={'timestamp':_0x2a5b47,'id':_0x1beceb,'name':_0x4a4c5c[_0x31e183(0x196)],'type':_0x4a4c5c[_0x31e183(0x144)],'location':_0x4a4c5c[_0x31e183(0x157)],'value':_0x5dbb21};_0x1a59cc[_0x31e183(0x17a)][_0x31e183(0x166)](_0x2db5a0);if(_0x1a59cc[_0x31e183(0x17a)][_0x31e183(0x1a1)]>HISTORY_MAX_SIZE)_0x1a59cc[_0x31e183(0x17a)][_0x31e183(0x15e)]();await _0x1a59cc[_0x31e183(0x19a)](_0x31e183(0x165),{'val':JSON[_0x31e183(0x1a8)](_0x2db5a0),'ack':!![]}),await _0x1a59cc[_0x31e183(0x19a)](_0x31e183(0x16d),{'val':JSON[_0x31e183(0x1a8)](_0x1a59cc['eventHistory']),'ack':!![]}),await updateHourlyActivity(_0x1a59cc);if(_0x1a59cc['isProVersion']){_0x1a59cc[_0x31e183(0x1a7)]['push'](_0x2db5a0);if(_0x1a59cc[_0x31e183(0x1a7)][_0x31e183(0x1a1)]>RAW_LOG_MAX_SIZE)_0x1a59cc['rawEventLog'][_0x31e183(0x159)](0x0,_0x1a59cc[_0x31e183(0x1a7)][_0x31e183(0x1a1)]-RAW_LOG_MAX_SIZE);await _0x1a59cc[_0x31e183(0x19a)](_0x31e183(0x182),{'val':JSON[_0x31e183(0x1a8)](_0x1a59cc[_0x31e183(0x1a7)]),'ack':!![]}),recordSequence(_0x1a59cc,_0x2db5a0);}if(_0x4a4c5c[_0x31e183(0x19c)]&&_0x5dbb21===!![]){if(_0x1a59cc[_0x31e183(0x1a9)]&&!_0x1a59cc[_0x31e183(0x186)])startExitTimer(_0x1a59cc);else{if(!_0x1a59cc[_0x31e183(0x1a9)])setPresence(_0x1a59cc,!![]);}}else{if(_0x4a4c5c['type']===_0x31e183(0x13f)&&_0x5dbb21===!![]){if(_0x1a59cc[_0x31e183(0x1a0)])abortExitTimer(_0x1a59cc);if(!_0x1a59cc[_0x31e183(0x1a9)]&&_0x1a59cc[_0x31e183(0x16e)]===_0x31e183(0x1ad))setPresence(_0x1a59cc,!![]);}}if(_0x1a59cc['isProVersion']&&_0x1a59cc['sendToPythonWrapper']){_0x4a4c5c['type']===_0x31e183(0x13f)&&_0x5dbb21===!![]&&_0x4a4c5c[_0x31e183(0x157)]&&_0x1a59cc[_0x31e183(0x160)]('SIMULATE_SIGNAL',{'room':_0x4a4c5c[_0x31e183(0x157)]});const _0x11f2e5=[_0x31e183(0x1af),_0x31e183(0x17d),_0x31e183(0x16a),_0x31e183(0x15b),_0x31e183(0x170),'handle',_0x31e183(0x13d),'schloss'][_0x31e183(0x187)](_0x4e45b4=>_0x48e50a[_0x31e183(0x156)](_0x4e45b4)),_0x366c44=[_0x31e183(0x17b),_0x31e183(0x13c),_0x31e183(0x162),_0x31e183(0x171),'dimmer',_0x31e183(0x189)][_0x31e183(0x187)](_0x5065e2=>_0x48e50a['includes'](_0x5065e2)),_0x44893a=['motion',_0x31e183(0x14c),'präsenz',_0x31e183(0x14e),'occupancy']['some'](_0x234488=>_0x48e50a[_0x31e183(0x156)](_0x234488));if(_0x4a4c5c['location']&&(_0x11f2e5||_0x366c44||_0x44893a)){const _0x2c119c=_0x5dbb21===!![]||typeof _0x5dbb21==='number'&&_0x5dbb21>0x0,_0x29ad5f=_0x11f2e5&&!_0x2c119c&&_0x261dcd!==undefined&&_0x261dcd!=_0x5dbb21;if(_0x2c119c||_0x29ad5f){const _0x2aa838=_0x1a59cc[_0x31e183(0x146)]||_0x2a5b47,_0x58f0a7=(_0x2a5b47-_0x2aa838)/0x3e8;_0x1a59cc['lastTrackerEventTime']=_0x2a5b47,_0x1a59cc['sendToPythonWrapper'](_0x31e183(0x13e),{'room':_0x4a4c5c['location'],'dt':_0x58f0a7});}}}return _0x2db5a0;}function a5_0x151e(_0x3762b0,_0x4bb10e){const _0x4a1dab=a5_0x3f1d();return a5_0x151e=function(_0x1edb6f,_0x121580){_0x1edb6f=_0x1edb6f-0x13b;let _0x3f1d3e=_0x4a1dab[_0x1edb6f];return _0x3f1d3e;},a5_0x151e(_0x3762b0,_0x4bb10e);}module[a5_0x3952ae(0x161)]={'processSensorEvent':processSensorEvent,'getOutsideTemperatureNumeric':getOutsideTemperatureNumeric,'setPresence':setPresence,'abortExitTimer':abortExitTimer,'startExitTimer':startExitTimer};