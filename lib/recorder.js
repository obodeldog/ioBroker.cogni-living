const a5_0x491b4c=a5_0x1614;(function(_0x3ccffc,_0x418ed8){const _0x57505c=a5_0x1614,_0x5dcd05=_0x3ccffc();while(!![]){try{const _0x337ed1=parseInt(_0x57505c(0xe8))/0x1+-parseInt(_0x57505c(0x130))/0x2+parseInt(_0x57505c(0xe1))/0x3+-parseInt(_0x57505c(0xeb))/0x4*(parseInt(_0x57505c(0x116))/0x5)+-parseInt(_0x57505c(0xe7))/0x6+parseInt(_0x57505c(0x11c))/0x7*(parseInt(_0x57505c(0x122))/0x8)+parseInt(_0x57505c(0xf4))/0x9*(-parseInt(_0x57505c(0x147))/0xa);if(_0x337ed1===_0x418ed8)break;else _0x5dcd05['push'](_0x5dcd05['shift']());}catch(_0x9bb39d){_0x5dcd05['push'](_0x5dcd05['shift']());}}}(a5_0x104b,0xa30fd));const a5_0x56cba1=(function(){let _0x1b3def=!![];return function(_0x4dba4a,_0x386f7a){const _0x5700bc=_0x1b3def?function(){if(_0x386f7a){const _0x1b7f36=_0x386f7a['apply'](_0x4dba4a,arguments);return _0x386f7a=null,_0x1b7f36;}}:function(){};return _0x1b3def=![],_0x5700bc;};}()),a5_0x3c53c2=a5_0x56cba1(this,function(){const _0x575705=a5_0x1614;return a5_0x3c53c2[_0x575705(0x131)]()[_0x575705(0x135)](_0x575705(0x109))[_0x575705(0x131)]()['constructor'](a5_0x3c53c2)[_0x575705(0x135)](_0x575705(0x109));});a5_0x3c53c2();'use strict';const HISTORY_MAX_SIZE=0x32,RAW_LOG_MAX_SIZE=0x9c4,THERMO_LOG_SIZE=0x3e8,SEQUENCE_TIMEOUT_MS=0x5*0x3c*0x3e8,MAX_TRAINING_SET_SIZE=0x1f4,EXIT_TIMER_MINUTES=0xf,EXIT_GRACE_PERIOD_SECONDS=0x1e;let activeSequence=[],sequenceTimer=null;async function getOutsideTemperatureNumeric(_0x2be326){const _0x2fdf03=a5_0x1614;if(_0x2be326[_0x2fdf03(0xfe)][_0x2fdf03(0x114)])try{const _0x5629e0=await _0x2be326['getForeignStateAsync'](_0x2be326[_0x2fdf03(0xfe)][_0x2fdf03(0x114)]);if(_0x5629e0&&_0x5629e0['val']!==undefined&&_0x5629e0['val']!==null)return parseFloat(_0x5629e0[_0x2fdf03(0xf0)]);}catch(_0xf8f229){}const _0x38adc4=_0x2be326[_0x2fdf03(0xfe)][_0x2fdf03(0xe5)];if(!_0x2be326['config']['useWeather']||!_0x38adc4)return null;try{let _0x384c09='';if(_0x38adc4[_0x2fdf03(0xed)](_0x2fdf03(0xf2)))_0x384c09=_0x38adc4+_0x2fdf03(0x12b);else{if(_0x38adc4[_0x2fdf03(0xed)]('daswetter'))_0x384c09=_0x38adc4+'.NextHours.Location_1.Day_1.current.temp_value';else{if(_0x38adc4[_0x2fdf03(0xed)](_0x2fdf03(0xe0)))_0x384c09=_0x38adc4+_0x2fdf03(0x111);else{if(_0x38adc4['includes']('weatherunderground'))_0x384c09=_0x38adc4+_0x2fdf03(0xf7);}}}if(_0x384c09){const _0xda8914=await _0x2be326[_0x2fdf03(0x140)](_0x384c09);if(_0xda8914&&_0xda8914['val']!==undefined&&_0xda8914[_0x2fdf03(0xf0)]!==null)return parseFloat(_0xda8914[_0x2fdf03(0xf0)]);}}catch(_0x35eca1){}return null;}async function recordThermodynamics(_0x5441b2,_0x2b5b76,_0x12e473,_0x3c6b09){const _0x4ca5dd=a5_0x1614,_0x3a605c=await getOutsideTemperatureNumeric(_0x5441b2);if(_0x3a605c===null)return;let _0x11c1a2=0x0,_0x3f72ae=![];if(_0x5441b2[_0x4ca5dd(0xfe)]['valveMapping'])try{let _0x413b0c=_0x5441b2[_0x4ca5dd(0xfe)][_0x4ca5dd(0xfb)];if(typeof _0x413b0c===_0x4ca5dd(0xde))_0x413b0c=JSON[_0x4ca5dd(0x12a)](_0x413b0c);if(_0x413b0c[_0x2b5b76]){const _0x4eb00b=_0x413b0c[_0x2b5b76],_0x5530d0=await _0x5441b2[_0x4ca5dd(0x140)](_0x4eb00b);if(_0x5530d0&&_0x5530d0[_0x4ca5dd(0xf0)]!==null&&_0x5530d0['val']!==undefined){let _0x3c1591=Number(_0x5530d0[_0x4ca5dd(0xf0)]);if(_0x3c1591<=1.05&&!_0x4eb00b['includes']('STATUS')&&!_0x4eb00b[_0x4ca5dd(0xed)](_0x4ca5dd(0x11f)))_0x3c1591=_0x3c1591*0x64;_0x11c1a2=Math[_0x4ca5dd(0xfc)](_0x3c1591),_0x3f72ae=!![];}}}catch(_0x3f0985){}if(!_0x3f72ae){const _0x41e7c9=[{'from':'.1.ACTUAL_TEMPERATURE','to':'.1.LEVEL'},{'from':_0x4ca5dd(0xf1),'to':_0x4ca5dd(0xf5)},{'from':'.1.TEMPERATURE','to':_0x4ca5dd(0x138)},{'from':_0x4ca5dd(0x128),'to':_0x4ca5dd(0x132)},{'from':_0x4ca5dd(0x117),'to':'level'},{'from':_0x4ca5dd(0xe6),'to':_0x4ca5dd(0xdf)}];for(const _0x264318 of _0x41e7c9){if(_0x2b5b76[_0x4ca5dd(0xed)](_0x264318[_0x4ca5dd(0x133)])){const _0x485c06=_0x2b5b76[_0x4ca5dd(0xff)](_0x264318[_0x4ca5dd(0x133)],_0x264318['to']);try{const _0x5e28e6=await _0x5441b2[_0x4ca5dd(0x140)](_0x485c06);if(_0x5e28e6&&_0x5e28e6['val']!==null&&_0x5e28e6[_0x4ca5dd(0xf0)]!==undefined){let _0xd5310a=Number(_0x5e28e6[_0x4ca5dd(0xf0)]);if(typeof _0xd5310a===_0x4ca5dd(0xe4)){if(_0xd5310a<=1.05&&_0x264318['to']['includes'](_0x4ca5dd(0x129)))_0xd5310a=_0xd5310a*0x64;_0x11c1a2=Math[_0x4ca5dd(0xfc)](_0xd5310a),_0x3f72ae=!![];break;}}}catch(_0x3ce40a){}}}}const _0x4b716b=await _0x5441b2[_0x4ca5dd(0x106)](_0x4ca5dd(0xe9));let _0x33bf6b=[];if(_0x4b716b&&_0x4b716b[_0x4ca5dd(0xf0)])try{_0x33bf6b=JSON[_0x4ca5dd(0x12a)](_0x4b716b['val']);}catch(_0x5561e8){}_0x33bf6b['push']({'ts':Date[_0x4ca5dd(0x11a)](),'room':_0x3c6b09||_0x4ca5dd(0xef),'t_in':_0x12e473,'t_out':_0x3a605c,'valve':_0x11c1a2});if(_0x33bf6b[_0x4ca5dd(0x107)]>THERMO_LOG_SIZE)_0x33bf6b[_0x4ca5dd(0x10c)]();await _0x5441b2['setStateAsync']('LTM.trainingData.thermodynamics',{'val':JSON[_0x4ca5dd(0xf9)](_0x33bf6b),'ack':!![]});}function a5_0x104b(){const _0x3a6ac7=['präsenz','29836szknxE','toString','.LEVEL','from','lastTrackerEventTime','search','motion','isPresent','.4.VALVE_STATE','griff','rawEventLog','isGracePeriodActive','window','system.isPresent','eventHistory','LTM.trainingData.sequences','getForeignStateAsync','[RECORDER]\x20Error:\x20','schloss','location','dimmer','ANALYZE_SEQUENCE','exitTimer','10bAOXOs','name','getHours','string','Valve','openweathermap','3615249aSpvDi','sendToPythonWrapper','splice','number','weatherInstance','Temperature','4655052WSAMvp','1310100RrGzfD','LTM.trainingData.thermodynamics','heizung','8ftyoCQ','unshift','includes','switch','Unknown','val','.1.ACTUAL_TEMPERATURE','accuweather','tür','17296425qQEMDy','.1.VALVE_STATE','type','.forecast.current.temp','exports','stringify','loc','valveMapping','round','map','config','replace','SIMULATE_SIGNAL','handle','events.history','currentSystemMode','setStateAsync','\x20from\x20','getStateAsync','length','klima','(((.+)+)+)+$','schalter','debug','shift','licht','some','lampe','temperatur','.forecast.current.temperature','door','isExit','outdoorSensorId','exitGraceTimer','235665NeMxfG','temperature','toISOString','fenster','now','events.lastEvent','30121gZQynJ','normal','light','STATE','lock','sensorLastValues','1784TQmZPN','bewegung','presence','occupancy','pop','toLowerCase','.ACTUAL_TEMPERATURE','LEVEL','parse','.Current.Temperature','TRACK_EVENT','isProVersion','push'];a5_0x104b=function(){return _0x3a6ac7;};return a5_0x104b();}async function saveCompletedSequence(_0x300b8c){const _0x572b5c=a5_0x1614;try{const _0x45f348=await _0x300b8c[_0x572b5c(0x106)](_0x572b5c(0x13f));let _0x226de5=[];if(_0x45f348&&_0x45f348[_0x572b5c(0xf0)])try{_0x226de5=JSON['parse'](_0x45f348[_0x572b5c(0xf0)]);}catch(_0x21e5d8){}const _0x4825dc=activeSequence[0x0]['ts'],_0x438843=activeSequence[_0x572b5c(0xfd)](_0x281ef5=>({'loc':_0x281ef5[_0x572b5c(0xfa)],'t_delta':Math['round']((_0x281ef5['ts']-_0x4825dc)/0x3e8)})),_0x2da89d={'timestamp':new Date(_0x4825dc)[_0x572b5c(0x118)](),'steps':_0x438843,'duration':Math[_0x572b5c(0xfc)]((activeSequence[activeSequence[_0x572b5c(0x107)]-0x1]['ts']-_0x4825dc)/0x3e8),'daytime':new Date(_0x4825dc)[_0x572b5c(0x149)]()};_0x226de5[_0x572b5c(0x12e)](_0x2da89d);if(_0x226de5['length']>MAX_TRAINING_SET_SIZE)_0x226de5['shift']();await _0x300b8c[_0x572b5c(0x104)](_0x572b5c(0x13f),{'val':JSON[_0x572b5c(0xf9)](_0x226de5),'ack':!![]}),_0x300b8c[_0x572b5c(0x12d)]&&_0x300b8c[_0x572b5c(0xe2)]&&_0x300b8c[_0x572b5c(0xe2)](_0x572b5c(0x145),{'sequence':_0x2da89d});}catch(_0x316c25){_0x300b8c['log']['error'](_0x572b5c(0x141)+_0x316c25['message']);}}async function recordSequence(_0x519e55,_0x3f5119){const _0x616a89=a5_0x1614,_0x13b53e=(_0x3f5119['type']||'')[_0x616a89(0x127)](),_0x1a2334=[_0x616a89(0x136),_0x616a89(0x123),_0x616a89(0x12f),'presence','occupancy',_0x616a89(0x112),_0x616a89(0xf3),_0x616a89(0x13c),_0x616a89(0x119),'contact','kontakt','light','licht','switch',_0x616a89(0x10a),_0x616a89(0x144),_0x616a89(0x10f)];if(!_0x1a2334[_0x616a89(0x10e)](_0x5480fa=>_0x13b53e[_0x616a89(0xed)](_0x5480fa)))return;if(!_0x3f5119['value'])return;if(sequenceTimer)clearTimeout(sequenceTimer);activeSequence['push']({'loc':_0x3f5119[_0x616a89(0x143)]||_0x616a89(0xef),'id':_0x3f5119['id'],'ts':Date[_0x616a89(0x11a)]()}),sequenceTimer=setTimeout(async()=>{const _0x6b866e=_0x616a89;if(activeSequence[_0x6b866e(0x107)]>0x1)await saveCompletedSequence(_0x519e55);activeSequence=[];},SEQUENCE_TIMEOUT_MS);}function startExitTimer(_0x77f9f1){const _0x393c18=a5_0x1614;abortExitTimer(_0x77f9f1),_0x77f9f1[_0x393c18(0x13b)]=!![],_0x77f9f1['exitGraceTimer']=setTimeout(()=>{const _0x38f22f=_0x393c18;_0x77f9f1[_0x38f22f(0x13b)]=![];},EXIT_GRACE_PERIOD_SECONDS*0x3e8),_0x77f9f1[_0x393c18(0x146)]=setTimeout(()=>{const _0x1b5191=_0x393c18;setPresence(_0x77f9f1,![]),_0x77f9f1[_0x1b5191(0x146)]=null;},EXIT_TIMER_MINUTES*0x3c*0x3e8);}function abortExitTimer(_0x350192){const _0x409d73=a5_0x1614;if(_0x350192['exitTimer'])clearTimeout(_0x350192[_0x409d73(0x146)]);if(_0x350192[_0x409d73(0x115)])clearTimeout(_0x350192[_0x409d73(0x115)]);_0x350192['exitTimer']=null,_0x350192['exitGraceTimer']=null,_0x350192[_0x409d73(0x13b)]=![];}async function setPresence(_0x5425de,_0x4b8e1b){const _0xf432e1=a5_0x1614;if(_0x5425de[_0xf432e1(0x137)]===_0x4b8e1b)return;_0x5425de[_0xf432e1(0x137)]=_0x4b8e1b,await _0x5425de['setStateAsync'](_0xf432e1(0x13d),{'val':_0x4b8e1b,'ack':!![]});}function a5_0x1614(_0x1a48f3,_0x2b8acd){const _0x2187bc=a5_0x104b();return a5_0x1614=function(_0x3c53c2,_0x56cba1){_0x3c53c2=_0x3c53c2-0xde;let _0x104be2=_0x2187bc[_0x3c53c2];return _0x104be2;},a5_0x1614(_0x1a48f3,_0x2b8acd);}async function processSensorEvent(_0x1484dd,_0x11d4e2,_0x493270,_0x3faabf){const _0x2a6fd3=a5_0x1614;if(!_0x3faabf)return null;const _0x36e7c4=_0x493270[_0x2a6fd3(0xf0)],_0x57c87d=Date[_0x2a6fd3(0x11a)](),_0xd978af=_0x1484dd[_0x2a6fd3(0x121)][_0x11d4e2],_0x4b5ade=(_0x3faabf['type']||'')[_0x2a6fd3(0x127)](),_0x36b07a=_0x4b5ade[_0x2a6fd3(0xed)](_0x2a6fd3(0x117))||_0x4b5ade[_0x2a6fd3(0xed)](_0x2a6fd3(0x110))||_0x4b5ade[_0x2a6fd3(0xed)](_0x2a6fd3(0x108))||_0x4b5ade[_0x2a6fd3(0xed)](_0x2a6fd3(0xea))||_0x4b5ade[_0x2a6fd3(0xed)]('thermostat');if(_0x36b07a&&typeof _0x36e7c4===_0x2a6fd3(0xe4)){if(_0x36e7c4>0x50||_0x36e7c4<-0x32)return _0x1484dd['log'][_0x2a6fd3(0x10b)]('[RECORDER]\x20Ignored\x20implausible\x20temperature:\x20'+_0x36e7c4+_0x2a6fd3(0x105)+_0x11d4e2),null;}_0x1484dd[_0x2a6fd3(0x121)][_0x11d4e2]=_0x36e7c4;if(!_0x3faabf['logDuplicates']&&_0xd978af!=undefined&&_0xd978af==_0x36e7c4)return null;_0x1484dd['isProVersion']&&_0x36b07a&&recordThermodynamics(_0x1484dd,_0x11d4e2,_0x36e7c4,_0x3faabf['location']);const _0x4d68ad={'timestamp':_0x57c87d,'id':_0x11d4e2,'name':_0x3faabf[_0x2a6fd3(0x148)],'type':_0x3faabf[_0x2a6fd3(0xf6)],'location':_0x3faabf[_0x2a6fd3(0x143)],'value':_0x36e7c4};_0x1484dd[_0x2a6fd3(0x13e)][_0x2a6fd3(0xec)](_0x4d68ad);if(_0x1484dd[_0x2a6fd3(0x13e)][_0x2a6fd3(0x107)]>HISTORY_MAX_SIZE)_0x1484dd[_0x2a6fd3(0x13e)][_0x2a6fd3(0x126)]();await _0x1484dd[_0x2a6fd3(0x104)](_0x2a6fd3(0x11b),{'val':JSON[_0x2a6fd3(0xf9)](_0x4d68ad),'ack':!![]}),await _0x1484dd[_0x2a6fd3(0x104)](_0x2a6fd3(0x102),{'val':JSON[_0x2a6fd3(0xf9)](_0x1484dd[_0x2a6fd3(0x13e)]),'ack':!![]});if(_0x1484dd[_0x2a6fd3(0x12d)]){_0x1484dd[_0x2a6fd3(0x13a)][_0x2a6fd3(0x12e)](_0x4d68ad);if(_0x1484dd[_0x2a6fd3(0x13a)][_0x2a6fd3(0x107)]>RAW_LOG_MAX_SIZE)_0x1484dd[_0x2a6fd3(0x13a)][_0x2a6fd3(0xe3)](0x0,_0x1484dd[_0x2a6fd3(0x13a)][_0x2a6fd3(0x107)]-RAW_LOG_MAX_SIZE);await _0x1484dd[_0x2a6fd3(0x104)]('LTM.rawEventLog',{'val':JSON[_0x2a6fd3(0xf9)](_0x1484dd[_0x2a6fd3(0x13a)]),'ack':!![]}),recordSequence(_0x1484dd,_0x4d68ad);}if(_0x3faabf[_0x2a6fd3(0x113)]&&_0x36e7c4===!![]){if(_0x1484dd['isPresent']&&!_0x1484dd[_0x2a6fd3(0x13b)])startExitTimer(_0x1484dd);else{if(!_0x1484dd[_0x2a6fd3(0x137)])setPresence(_0x1484dd,!![]);}}else{if(_0x3faabf[_0x2a6fd3(0xf6)]===_0x2a6fd3(0x136)&&_0x36e7c4===!![]){if(_0x1484dd[_0x2a6fd3(0x146)])abortExitTimer(_0x1484dd);if(!_0x1484dd[_0x2a6fd3(0x137)]&&_0x1484dd[_0x2a6fd3(0x103)]===_0x2a6fd3(0x11d))setPresence(_0x1484dd,!![]);}}if(_0x1484dd[_0x2a6fd3(0x12d)]&&_0x1484dd[_0x2a6fd3(0xe2)]){_0x3faabf['type']===_0x2a6fd3(0x136)&&_0x36e7c4===!![]&&_0x3faabf[_0x2a6fd3(0x143)]&&_0x1484dd[_0x2a6fd3(0xe2)](_0x2a6fd3(0x100),{'room':_0x3faabf[_0x2a6fd3(0x143)]});const _0x5d95f0=[_0x2a6fd3(0x112),_0x2a6fd3(0xf3),'window','fenster',_0x2a6fd3(0x139),_0x2a6fd3(0x101),_0x2a6fd3(0x120),_0x2a6fd3(0x142)][_0x2a6fd3(0x10e)](_0x409172=>_0x4b5ade[_0x2a6fd3(0xed)](_0x409172)),_0x54a226=[_0x2a6fd3(0x11e),_0x2a6fd3(0x10d),_0x2a6fd3(0xee),_0x2a6fd3(0x10a),_0x2a6fd3(0x144),_0x2a6fd3(0x10f)][_0x2a6fd3(0x10e)](_0xebda80=>_0x4b5ade[_0x2a6fd3(0xed)](_0xebda80)),_0x3f7d98=[_0x2a6fd3(0x136),_0x2a6fd3(0x123),_0x2a6fd3(0x12f),_0x2a6fd3(0x124),_0x2a6fd3(0x125)]['some'](_0x122f00=>_0x4b5ade[_0x2a6fd3(0xed)](_0x122f00));if(_0x3faabf[_0x2a6fd3(0x143)]&&(_0x5d95f0||_0x54a226||_0x3f7d98)){const _0x42dab0=_0x36e7c4===!![]||typeof _0x36e7c4===_0x2a6fd3(0xe4)&&_0x36e7c4>0x0,_0x4def9a=_0x5d95f0&&!_0x42dab0&&_0xd978af!==undefined&&_0xd978af!=_0x36e7c4;if(_0x42dab0||_0x4def9a){const _0x3623da=_0x1484dd[_0x2a6fd3(0x134)]||_0x57c87d,_0x20a315=(_0x57c87d-_0x3623da)/0x3e8;_0x1484dd[_0x2a6fd3(0x134)]=_0x57c87d,_0x1484dd[_0x2a6fd3(0xe2)](_0x2a6fd3(0x12c),{'room':_0x3faabf[_0x2a6fd3(0x143)],'dt':_0x20a315});}}}return _0x4d68ad;}module[a5_0x491b4c(0xf8)]={'processSensorEvent':processSensorEvent,'getOutsideTemperatureNumeric':getOutsideTemperatureNumeric,'setPresence':setPresence,'abortExitTimer':abortExitTimer,'startExitTimer':startExitTimer};