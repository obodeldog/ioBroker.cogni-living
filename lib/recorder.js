const a5_0x283f5a=a5_0x3c72;(function(_0x446301,_0x1771d0){const _0x56556f=a5_0x3c72,_0x4a1adf=_0x446301();while(!![]){try{const _0xf20e4f=parseInt(_0x56556f(0x1b0))/0x1*(-parseInt(_0x56556f(0x1c2))/0x2)+parseInt(_0x56556f(0x199))/0x3*(-parseInt(_0x56556f(0x193))/0x4)+parseInt(_0x56556f(0x1ad))/0x5*(parseInt(_0x56556f(0x1b9))/0x6)+-parseInt(_0x56556f(0x1cc))/0x7*(-parseInt(_0x56556f(0x189))/0x8)+-parseInt(_0x56556f(0x180))/0x9*(parseInt(_0x56556f(0x1a2))/0xa)+parseInt(_0x56556f(0x184))/0xb*(-parseInt(_0x56556f(0x1b5))/0xc)+-parseInt(_0x56556f(0x1b8))/0xd*(-parseInt(_0x56556f(0x1b7))/0xe);if(_0xf20e4f===_0x1771d0)break;else _0x4a1adf['push'](_0x4a1adf['shift']());}catch(_0x227ced){_0x4a1adf['push'](_0x4a1adf['shift']());}}}(a5_0x48a8,0x9a04d));const a5_0x4c9835=(function(){let _0x2f2794=!![];return function(_0x5dfe2a,_0x5c11a7){const _0x42738f=_0x2f2794?function(){const _0x13d93c=a5_0x3c72;if(_0x5c11a7){const _0xab5a01=_0x5c11a7[_0x13d93c(0x1ab)](_0x5dfe2a,arguments);return _0x5c11a7=null,_0xab5a01;}}:function(){};return _0x2f2794=![],_0x42738f;};}()),a5_0x31d819=a5_0x4c9835(this,function(){const _0x4872e1=a5_0x3c72;return a5_0x31d819['toString']()['search'](_0x4872e1(0x1a3))['toString']()[_0x4872e1(0x191)](a5_0x31d819)[_0x4872e1(0x1b2)](_0x4872e1(0x1a3));});a5_0x31d819();'use strict';const HISTORY_MAX_SIZE=0x32,RAW_LOG_MAX_SIZE=0x9c4,THERMO_LOG_SIZE=0x3e8,SEQUENCE_TIMEOUT_MS=0x5*0x3c*0x3e8,MAX_TRAINING_SET_SIZE=0x1f4,EXIT_TIMER_MINUTES=0xf,EXIT_GRACE_PERIOD_SECONDS=0x1e;let activeSequence=[],sequenceTimer=null;async function getOutsideTemperatureNumeric(_0x4a3230){const _0x6bc5d3=a5_0x3c72;if(_0x4a3230[_0x6bc5d3(0x188)][_0x6bc5d3(0x17d)])try{const _0x4fe71e=await _0x4a3230['getForeignStateAsync'](_0x4a3230[_0x6bc5d3(0x188)][_0x6bc5d3(0x17d)]);if(_0x4fe71e&&_0x4fe71e[_0x6bc5d3(0x17c)]!==undefined&&_0x4fe71e[_0x6bc5d3(0x17c)]!==null)return parseFloat(_0x4fe71e[_0x6bc5d3(0x17c)]);}catch(_0x2f4cc0){}const _0x3cdea2=_0x4a3230[_0x6bc5d3(0x188)]['weatherInstance'];if(!_0x4a3230['config'][_0x6bc5d3(0x17f)]||!_0x3cdea2)return null;try{let _0x4961a5='';if(_0x3cdea2[_0x6bc5d3(0x181)](_0x6bc5d3(0x1a8)))_0x4961a5=_0x3cdea2+_0x6bc5d3(0x1c5);else{if(_0x3cdea2['includes']('daswetter'))_0x4961a5=_0x3cdea2+_0x6bc5d3(0x18e);else{if(_0x3cdea2[_0x6bc5d3(0x181)](_0x6bc5d3(0x19b)))_0x4961a5=_0x3cdea2+_0x6bc5d3(0x1c3);else{if(_0x3cdea2[_0x6bc5d3(0x181)]('weatherunderground'))_0x4961a5=_0x3cdea2+_0x6bc5d3(0x1a0);}}}if(_0x4961a5){const _0x2d1e71=await _0x4a3230[_0x6bc5d3(0x1ae)](_0x4961a5);if(_0x2d1e71&&_0x2d1e71[_0x6bc5d3(0x17c)]!==undefined&&_0x2d1e71[_0x6bc5d3(0x17c)]!==null)return parseFloat(_0x2d1e71[_0x6bc5d3(0x17c)]);}}catch(_0x48a30f){}return null;}async function recordThermodynamics(_0x515ce1,_0x3a7f03,_0x130316,_0x5dbc88){const _0x5317ec=a5_0x3c72,_0x188795=await getOutsideTemperatureNumeric(_0x515ce1),_0x83b7ec=await _0x515ce1[_0x5317ec(0x197)](_0x5317ec(0x1c0));let _0x3abb6f=[];if(_0x83b7ec&&_0x83b7ec[_0x5317ec(0x17c)])try{_0x3abb6f=JSON['parse'](_0x83b7ec[_0x5317ec(0x17c)]);}catch(_0x36ac5a){}_0x3abb6f[_0x5317ec(0x18b)]({'ts':Date[_0x5317ec(0x1b1)](),'room':_0x5dbc88||'Unknown','t_in':_0x130316,'t_out':_0x188795});if(_0x3abb6f[_0x5317ec(0x1aa)]>THERMO_LOG_SIZE)_0x3abb6f[_0x5317ec(0x1af)]();await _0x515ce1[_0x5317ec(0x194)](_0x5317ec(0x1c0),{'val':JSON[_0x5317ec(0x190)](_0x3abb6f),'ack':!![]});}async function saveCompletedSequence(_0xa7fa10){const _0x223dd4=a5_0x3c72;try{const _0x365633=await _0xa7fa10[_0x223dd4(0x197)](_0x223dd4(0x1cd));let _0x30f2ce=[];if(_0x365633&&_0x365633[_0x223dd4(0x17c)])try{_0x30f2ce=JSON['parse'](_0x365633[_0x223dd4(0x17c)]);}catch(_0x2ac18a){}const _0x20cee5=activeSequence[0x0]['ts'],_0x47b9d4=activeSequence['map'](_0x5f3b2e=>({'loc':_0x5f3b2e['loc'],'t_delta':Math['round']((_0x5f3b2e['ts']-_0x20cee5)/0x3e8)})),_0x13a6c5={'timestamp':new Date(_0x20cee5)[_0x223dd4(0x1ce)](),'steps':_0x47b9d4,'duration':Math['round']((activeSequence[activeSequence['length']-0x1]['ts']-_0x20cee5)/0x3e8),'daytime':new Date(_0x20cee5)[_0x223dd4(0x18a)]()};_0x30f2ce[_0x223dd4(0x18b)](_0x13a6c5);if(_0x30f2ce[_0x223dd4(0x1aa)]>MAX_TRAINING_SET_SIZE)_0x30f2ce[_0x223dd4(0x1af)]();await _0xa7fa10[_0x223dd4(0x194)]('LTM.trainingData.sequences',{'val':JSON['stringify'](_0x30f2ce),'ack':!![]}),_0xa7fa10['isProVersion']&&_0xa7fa10['sendToPythonWrapper']&&_0xa7fa10[_0x223dd4(0x198)]('ANALYZE_SEQUENCE',{'sequence':_0x13a6c5});}catch(_0xaf13a0){_0xa7fa10['log']['error'](_0x223dd4(0x19f)+_0xaf13a0['message']);}}async function recordSequence(_0x285364,_0x58f450){const _0x471330=a5_0x3c72,_0x52939d=(_0x58f450[_0x471330(0x1c6)]||'')['toLowerCase'](),_0x1c04fe=[_0x471330(0x1be),'bewegung','präsenz',_0x471330(0x19e),_0x471330(0x1b6),_0x471330(0x1c9),_0x471330(0x17b),'window',_0x471330(0x1c1),_0x471330(0x1ca),_0x471330(0x18c),'light',_0x471330(0x192),_0x471330(0x1cb),_0x471330(0x195),_0x471330(0x1ac),_0x471330(0x19c)];if(!_0x1c04fe['some'](_0xd9b6d6=>_0x52939d['includes'](_0xd9b6d6)))return;if(!_0x58f450[_0x471330(0x19a)])return;if(sequenceTimer)clearTimeout(sequenceTimer);activeSequence[_0x471330(0x18b)]({'loc':_0x58f450[_0x471330(0x1a4)]||_0x471330(0x186),'id':_0x58f450['id'],'ts':Date['now']()}),sequenceTimer=setTimeout(async()=>{const _0x24f106=_0x471330;if(activeSequence[_0x24f106(0x1aa)]>0x1)await saveCompletedSequence(_0x285364);activeSequence=[];},SEQUENCE_TIMEOUT_MS);}function startExitTimer(_0x4aa71c){const _0x5abbf8=a5_0x3c72;abortExitTimer(_0x4aa71c),_0x4aa71c[_0x5abbf8(0x18f)]=!![],_0x4aa71c[_0x5abbf8(0x1a5)]=setTimeout(()=>{_0x4aa71c['isGracePeriodActive']=![];},EXIT_GRACE_PERIOD_SECONDS*0x3e8),_0x4aa71c[_0x5abbf8(0x1c7)]=setTimeout(()=>{const _0x47b7c4=_0x5abbf8;setPresence(_0x4aa71c,![]),_0x4aa71c[_0x47b7c4(0x1c7)]=null;},EXIT_TIMER_MINUTES*0x3c*0x3e8);}function abortExitTimer(_0x4fe6bd){const _0x1adfe2=a5_0x3c72;if(_0x4fe6bd[_0x1adfe2(0x1c7)])clearTimeout(_0x4fe6bd[_0x1adfe2(0x1c7)]);if(_0x4fe6bd['exitGraceTimer'])clearTimeout(_0x4fe6bd[_0x1adfe2(0x1a5)]);_0x4fe6bd[_0x1adfe2(0x1c7)]=null,_0x4fe6bd[_0x1adfe2(0x1a5)]=null,_0x4fe6bd['isGracePeriodActive']=![];}async function setPresence(_0x1a7743,_0x2eddb3){const _0x4c2ee7=a5_0x3c72;if(_0x1a7743[_0x4c2ee7(0x196)]===_0x2eddb3)return;_0x1a7743[_0x4c2ee7(0x196)]=_0x2eddb3,await _0x1a7743['setStateAsync']('system.isPresent',{'val':_0x2eddb3,'ack':!![]});}async function processSensorEvent(_0x525023,_0x4c2ada,_0x3960f1,_0x1d41f2){const _0x438cec=a5_0x3c72;if(!_0x1d41f2)return null;const _0x433352=_0x3960f1[_0x438cec(0x17c)],_0x120272=Date['now'](),_0x4b92ae=_0x525023[_0x438cec(0x1a7)][_0x4c2ada];_0x525023['sensorLastValues'][_0x4c2ada]=_0x433352;if(!_0x1d41f2[_0x438cec(0x1b4)]&&_0x4b92ae!=undefined&&_0x4b92ae==_0x433352)return null;const _0x400712=(_0x1d41f2[_0x438cec(0x1c6)]||'')[_0x438cec(0x17e)](),_0x1fdf39=_0x400712[_0x438cec(0x181)]('temperature')||_0x400712[_0x438cec(0x181)](_0x438cec(0x1a1))||_0x400712[_0x438cec(0x181)](_0x438cec(0x1c4))||_0x400712[_0x438cec(0x181)](_0x438cec(0x1a9));_0x525023[_0x438cec(0x1bd)]&&_0x1fdf39&&recordThermodynamics(_0x525023,_0x4c2ada,_0x433352,_0x1d41f2['location']);const _0x545b2b={'timestamp':_0x120272,'id':_0x4c2ada,'name':_0x1d41f2[_0x438cec(0x187)],'type':_0x1d41f2[_0x438cec(0x1c6)],'location':_0x1d41f2['location'],'value':_0x433352};_0x525023[_0x438cec(0x1bb)][_0x438cec(0x183)](_0x545b2b);if(_0x525023[_0x438cec(0x1bb)][_0x438cec(0x1aa)]>HISTORY_MAX_SIZE)_0x525023[_0x438cec(0x1bb)]['pop']();await _0x525023[_0x438cec(0x194)](_0x438cec(0x185),{'val':JSON[_0x438cec(0x190)](_0x545b2b),'ack':!![]}),await _0x525023[_0x438cec(0x194)](_0x438cec(0x1a6),{'val':JSON[_0x438cec(0x190)](_0x525023[_0x438cec(0x1bb)]),'ack':!![]});if(_0x525023[_0x438cec(0x1bd)]){_0x525023[_0x438cec(0x18d)][_0x438cec(0x18b)](_0x545b2b);if(_0x525023[_0x438cec(0x18d)]['length']>RAW_LOG_MAX_SIZE)_0x525023[_0x438cec(0x18d)][_0x438cec(0x182)](0x0,_0x525023[_0x438cec(0x18d)][_0x438cec(0x1aa)]-RAW_LOG_MAX_SIZE);await _0x525023['setStateAsync'](_0x438cec(0x1bf),{'val':JSON[_0x438cec(0x190)](_0x525023['rawEventLog']),'ack':!![]}),recordSequence(_0x525023,_0x545b2b);}if(_0x1d41f2[_0x438cec(0x1b3)]&&_0x433352===!![]){if(_0x525023[_0x438cec(0x196)]&&!_0x525023[_0x438cec(0x18f)])startExitTimer(_0x525023);else{if(!_0x525023[_0x438cec(0x196)])setPresence(_0x525023,!![]);}}else{if(_0x1d41f2[_0x438cec(0x1c6)]===_0x438cec(0x1be)&&_0x433352===!![]){if(_0x525023[_0x438cec(0x1c7)])abortExitTimer(_0x525023);if(!_0x525023[_0x438cec(0x196)]&&_0x525023[_0x438cec(0x19d)]===_0x438cec(0x1c8))setPresence(_0x525023,!![]);}}return _0x525023[_0x438cec(0x1bd)]&&_0x1d41f2[_0x438cec(0x1c6)]===_0x438cec(0x1be)&&_0x433352===!![]&&_0x1d41f2[_0x438cec(0x1a4)]&&_0x525023['sendToPythonWrapper']&&_0x525023[_0x438cec(0x198)](_0x438cec(0x1ba),{'room':_0x1d41f2[_0x438cec(0x1a4)]}),_0x545b2b;}function a5_0x3c72(_0x34be6c,_0x5594b1){const _0x4993cf=a5_0x48a8();return a5_0x3c72=function(_0x31d819,_0x4c9835){_0x31d819=_0x31d819-0x17b;let _0x48a86f=_0x4993cf[_0x31d819];return _0x48a86f;},a5_0x3c72(_0x34be6c,_0x5594b1);}function a5_0x48a8(){const _0x383dd3=['eventHistory','exports','isProVersion','motion','LTM.rawEventLog','LTM.trainingData.thermodynamics','fenster','18ihtSqj','.forecast.current.temperature','klima','.Current.Temperature','type','exitTimer','normal','door','contact','switch','14XSPwXU','LTM.trainingData.sequences','toISOString','tür','val','outdoorSensorId','toLowerCase','useWeather','153711nBBiKe','includes','splice','unshift','1772155fGmFBi','events.lastEvent','Unknown','name','config','781128QBCgEs','getHours','push','kontakt','rawEventLog','.NextHours.Location_1.Day_1.current.temp_value','isGracePeriodActive','stringify','constructor','licht','4376388CTcLoT','setStateAsync','schalter','isPresent','getStateAsync','sendToPythonWrapper','3dqwiOA','value','openweathermap','lampe','currentSystemMode','presence','[RECORDER]\x20Error:\x20','.forecast.current.temp','temperatur','90URqabe','(((.+)+)+)+$','location','exitGraceTimer','events.history','sensorLastValues','accuweather','heizung','length','apply','dimmer','1400tTBnAY','getForeignStateAsync','shift','4079YhIVKR','now','search','isExit','logDuplicates','12iWlDqs','occupancy','14iduYvo','19021119KdNacX','8958EqDWoi','SIMULATE_SIGNAL'];a5_0x48a8=function(){return _0x383dd3;};return a5_0x48a8();}module[a5_0x283f5a(0x1bc)]={'processSensorEvent':processSensorEvent,'getOutsideTemperatureNumeric':getOutsideTemperatureNumeric,'setPresence':setPresence,'abortExitTimer':abortExitTimer,'startExitTimer':startExitTimer};