const a5_0x1af6b1=a5_0x17de;(function(_0x3f1200,_0x55a1da){const _0x555474=a5_0x17de,_0x8d82dc=_0x3f1200();while(!![]){try{const _0x2aa120=parseInt(_0x555474(0x11b))/0x1*(-parseInt(_0x555474(0x11e))/0x2)+parseInt(_0x555474(0x131))/0x3*(parseInt(_0x555474(0xe9))/0x4)+-parseInt(_0x555474(0x100))/0x5+parseInt(_0x555474(0x125))/0x6+-parseInt(_0x555474(0x116))/0x7+-parseInt(_0x555474(0x136))/0x8+parseInt(_0x555474(0x13d))/0x9;if(_0x2aa120===_0x55a1da)break;else _0x8d82dc['push'](_0x8d82dc['shift']());}catch(_0x4cecc8){_0x8d82dc['push'](_0x8d82dc['shift']());}}}(a5_0x95c1,0xc8650));const a5_0xabe3b=(function(){let _0x4d5d73=!![];return function(_0x4c36fa,_0xbf1853){const _0xe18130=_0x4d5d73?function(){const _0x440677=a5_0x17de;if(_0xbf1853){const _0x9312f=_0xbf1853[_0x440677(0xe2)](_0x4c36fa,arguments);return _0xbf1853=null,_0x9312f;}}:function(){};return _0x4d5d73=![],_0xe18130;};}()),a5_0x50d8dd=a5_0xabe3b(this,function(){const _0x1753a8=a5_0x17de;return a5_0x50d8dd['toString']()[_0x1753a8(0xe6)](_0x1753a8(0xea))[_0x1753a8(0xf7)]()['constructor'](a5_0x50d8dd)[_0x1753a8(0xe6)](_0x1753a8(0xea));});function a5_0x17de(_0x350670,_0x985416){const _0x313bd2=a5_0x95c1();return a5_0x17de=function(_0x50d8dd,_0xabe3b){_0x50d8dd=_0x50d8dd-0xe0;let _0x95c1b0=_0x313bd2[_0x50d8dd];return _0x95c1b0;},a5_0x17de(_0x350670,_0x985416);}a5_0x50d8dd();'use strict';const HISTORY_MAX_SIZE=0x32,RAW_LOG_MAX_SIZE=0x9c4,THERMO_LOG_SIZE=0x3e8,SEQUENCE_TIMEOUT_MS=0x5*0x3c*0x3e8,MAX_TRAINING_SET_SIZE=0x1f4,EXIT_TIMER_MINUTES=0xf,EXIT_GRACE_PERIOD_SECONDS=0x1e;let activeSequence=[],sequenceTimer=null;async function getOutsideTemperatureNumeric(_0x3f49c1){const _0x1783a6=a5_0x17de;if(_0x3f49c1[_0x1783a6(0xfd)][_0x1783a6(0x108)])try{const _0x445e64=await _0x3f49c1['getForeignStateAsync'](_0x3f49c1[_0x1783a6(0xfd)][_0x1783a6(0x108)]);if(_0x445e64&&_0x445e64[_0x1783a6(0x119)]!==undefined&&_0x445e64[_0x1783a6(0x119)]!==null)return parseFloat(_0x445e64[_0x1783a6(0x119)]);}catch(_0x246339){}const _0x1e37b3=_0x3f49c1[_0x1783a6(0xfd)][_0x1783a6(0x122)];if(!_0x3f49c1[_0x1783a6(0xfd)][_0x1783a6(0x12c)]||!_0x1e37b3)return null;try{let _0x3f5be0='';if(_0x1e37b3[_0x1783a6(0x101)]('accuweather'))_0x3f5be0=_0x1e37b3+_0x1783a6(0x137);else{if(_0x1e37b3[_0x1783a6(0x101)](_0x1783a6(0xf9)))_0x3f5be0=_0x1e37b3+'.NextHours.Location_1.Day_1.current.temp_value';else{if(_0x1e37b3['includes'](_0x1783a6(0x120)))_0x3f5be0=_0x1e37b3+_0x1783a6(0x12a);else{if(_0x1e37b3[_0x1783a6(0x101)](_0x1783a6(0xec)))_0x3f5be0=_0x1e37b3+_0x1783a6(0xe1);}}}if(_0x3f5be0){const _0x59a5a3=await _0x3f49c1[_0x1783a6(0xfb)](_0x3f5be0);if(_0x59a5a3&&_0x59a5a3['val']!==undefined&&_0x59a5a3['val']!==null)return parseFloat(_0x59a5a3[_0x1783a6(0x119)]);}}catch(_0xbefe7e){}return null;}async function recordThermodynamics(_0x3809ea,_0x343a44,_0x499e3d,_0x460a72){const _0x4e29d=a5_0x17de,_0x5ad90f=await getOutsideTemperatureNumeric(_0x3809ea);if(_0x5ad90f===null)return;let _0x2ae2d0=0x0,_0x552c81=![];if(_0x3809ea['config'][_0x4e29d(0xf5)])try{let _0x3a8fbe=_0x3809ea['config'][_0x4e29d(0xf5)];if(typeof _0x3a8fbe===_0x4e29d(0x113))_0x3a8fbe=JSON[_0x4e29d(0xee)](_0x3a8fbe);if(_0x3a8fbe[_0x343a44]){const _0x1dc2e7=_0x3a8fbe[_0x343a44],_0x31a91f=await _0x3809ea[_0x4e29d(0xfb)](_0x1dc2e7);if(_0x31a91f&&_0x31a91f[_0x4e29d(0x119)]!==null&&_0x31a91f['val']!==undefined){let _0x3a20fa=Number(_0x31a91f[_0x4e29d(0x119)]);if(_0x3a20fa<=1.05&&!_0x1dc2e7['includes'](_0x4e29d(0x143))&&!_0x1dc2e7[_0x4e29d(0x101)](_0x4e29d(0xf1)))_0x3a20fa=_0x3a20fa*0x64;_0x2ae2d0=Math[_0x4e29d(0x13f)](_0x3a20fa),_0x552c81=!![];}}}catch(_0x5b8602){}if(!_0x552c81){const _0x39f2d2=[{'from':_0x4e29d(0x121),'to':_0x4e29d(0xf4)},{'from':_0x4e29d(0x121),'to':_0x4e29d(0xfc)},{'from':_0x4e29d(0x141),'to':'.4.VALVE_STATE'},{'from':_0x4e29d(0x13a),'to':'.LEVEL'},{'from':_0x4e29d(0x114),'to':_0x4e29d(0x118)},{'from':'Temperature','to':_0x4e29d(0xe5)}];for(const _0x41fbe5 of _0x39f2d2){if(_0x343a44[_0x4e29d(0x101)](_0x41fbe5[_0x4e29d(0xf8)])){const _0x866e10=_0x343a44['replace'](_0x41fbe5[_0x4e29d(0xf8)],_0x41fbe5['to']);try{const _0x20153c=await _0x3809ea[_0x4e29d(0xfb)](_0x866e10);if(_0x20153c&&_0x20153c[_0x4e29d(0x119)]!==null&&_0x20153c[_0x4e29d(0x119)]!==undefined){let _0x1b12c6=Number(_0x20153c[_0x4e29d(0x119)]);if(typeof _0x1b12c6==='number'){if(_0x1b12c6<=1.05&&_0x41fbe5['to'][_0x4e29d(0x101)](_0x4e29d(0x123)))_0x1b12c6=_0x1b12c6*0x64;_0x2ae2d0=Math[_0x4e29d(0x13f)](_0x1b12c6),_0x552c81=!![];break;}}}catch(_0x59e922){}}}}const _0xc9b4ed=await _0x3809ea[_0x4e29d(0x127)](_0x4e29d(0x10f));let _0x493e3f=[];if(_0xc9b4ed&&_0xc9b4ed[_0x4e29d(0x119)])try{_0x493e3f=JSON['parse'](_0xc9b4ed[_0x4e29d(0x119)]);}catch(_0x366626){}_0x493e3f[_0x4e29d(0x148)]({'ts':Date[_0x4e29d(0x11a)](),'room':_0x460a72||_0x4e29d(0x128),'t_in':_0x499e3d,'t_out':_0x5ad90f,'valve':_0x2ae2d0});if(_0x493e3f[_0x4e29d(0x10d)]>THERMO_LOG_SIZE)_0x493e3f[_0x4e29d(0x135)]();await _0x3809ea[_0x4e29d(0x147)](_0x4e29d(0x10f),{'val':JSON[_0x4e29d(0x111)](_0x493e3f),'ack':!![]});}async function saveCompletedSequence(_0x534318){const _0x28cfa0=a5_0x17de;try{const _0x3c551a=await _0x534318['getStateAsync'](_0x28cfa0(0xeb));let _0x412fd6=[];if(_0x3c551a&&_0x3c551a['val'])try{_0x412fd6=JSON[_0x28cfa0(0xee)](_0x3c551a[_0x28cfa0(0x119)]);}catch(_0x39b92e){}const _0x3a4bda=activeSequence[0x0]['ts'],_0x312e06=activeSequence[_0x28cfa0(0x112)](_0x151e5d=>({'loc':_0x151e5d[_0x28cfa0(0x12d)],'t_delta':Math[_0x28cfa0(0x13f)]((_0x151e5d['ts']-_0x3a4bda)/0x3e8)})),_0x1ae92a={'timestamp':new Date(_0x3a4bda)[_0x28cfa0(0xf2)](),'steps':_0x312e06,'duration':Math['round']((activeSequence[activeSequence[_0x28cfa0(0x10d)]-0x1]['ts']-_0x3a4bda)/0x3e8),'daytime':new Date(_0x3a4bda)['getHours']()};_0x412fd6[_0x28cfa0(0x148)](_0x1ae92a);if(_0x412fd6[_0x28cfa0(0x10d)]>MAX_TRAINING_SET_SIZE)_0x412fd6['shift']();await _0x534318[_0x28cfa0(0x147)](_0x28cfa0(0xeb),{'val':JSON[_0x28cfa0(0x111)](_0x412fd6),'ack':!![]}),_0x534318['isProVersion']&&_0x534318[_0x28cfa0(0xff)]&&_0x534318[_0x28cfa0(0xff)](_0x28cfa0(0x134),{'sequence':_0x1ae92a});}catch(_0x5dce52){_0x534318[_0x28cfa0(0xef)][_0x28cfa0(0xe8)](_0x28cfa0(0x124)+_0x5dce52['message']);}}async function recordSequence(_0x230017,_0x33a221){const _0x1aeac5=a5_0x17de,_0xe058c8=(_0x33a221['type']||'')['toLowerCase'](),_0x54992a=[_0x1aeac5(0x12f),_0x1aeac5(0xf3),'pr채senz',_0x1aeac5(0x129),_0x1aeac5(0xe7),'door',_0x1aeac5(0x105),_0x1aeac5(0x115),'fenster',_0x1aeac5(0xe4),'kontakt',_0x1aeac5(0x126),_0x1aeac5(0x110),_0x1aeac5(0xe3),_0x1aeac5(0x10b),_0x1aeac5(0x140),'lampe'];if(!_0x54992a[_0x1aeac5(0x10c)](_0x505562=>_0xe058c8[_0x1aeac5(0x101)](_0x505562)))return;if(!_0x33a221['value'])return;if(sequenceTimer)clearTimeout(sequenceTimer);activeSequence[_0x1aeac5(0x148)]({'loc':_0x33a221[_0x1aeac5(0xf6)]||_0x1aeac5(0x128),'id':_0x33a221['id'],'ts':Date['now']()}),sequenceTimer=setTimeout(async()=>{const _0x34ae3f=_0x1aeac5;if(activeSequence[_0x34ae3f(0x10d)]>0x1)await saveCompletedSequence(_0x230017);activeSequence=[];},SEQUENCE_TIMEOUT_MS);}function startExitTimer(_0x5d052a){const _0x5c1be4=a5_0x17de;abortExitTimer(_0x5d052a),_0x5d052a[_0x5c1be4(0x13b)]=!![],_0x5d052a[_0x5c1be4(0x10e)]=setTimeout(()=>{const _0x4a6da0=_0x5c1be4;_0x5d052a[_0x4a6da0(0x13b)]=![];},EXIT_GRACE_PERIOD_SECONDS*0x3e8),_0x5d052a[_0x5c1be4(0x11f)]=setTimeout(()=>{const _0x43ab1b=_0x5c1be4;setPresence(_0x5d052a,![]),_0x5d052a[_0x43ab1b(0x11f)]=null;},EXIT_TIMER_MINUTES*0x3c*0x3e8);}function abortExitTimer(_0x3162fe){const _0x20790e=a5_0x17de;if(_0x3162fe[_0x20790e(0x11f)])clearTimeout(_0x3162fe[_0x20790e(0x11f)]);if(_0x3162fe[_0x20790e(0x10e)])clearTimeout(_0x3162fe[_0x20790e(0x10e)]);_0x3162fe[_0x20790e(0x11f)]=null,_0x3162fe['exitGraceTimer']=null,_0x3162fe[_0x20790e(0x13b)]=![];}async function setPresence(_0x5d9278,_0x15297f){const _0x3097bf=a5_0x17de;if(_0x5d9278[_0x3097bf(0xfe)]===_0x15297f)return;_0x5d9278[_0x3097bf(0xfe)]=_0x15297f,await _0x5d9278[_0x3097bf(0x147)](_0x3097bf(0x130),{'val':_0x15297f,'ack':!![]});}function a5_0x95c1(){const _0x45f40c=['openweathermap','.1.ACTUAL_TEMPERATURE','weatherInstance','LEVEL','[RECORDER]\x20Error:\x20','4117080QNVbsm','light','getStateAsync','Unknown','presence','.forecast.current.temperature','pr채senz','useWeather','loc','LTM.rawEventLog','motion','system.isPresent','3351GNbYag','door','getDate','ANALYZE_SEQUENCE','shift','11018792wztVvw','.Current.Temperature','currentSystemMode','handle','.ACTUAL_TEMPERATURE','isGracePeriodActive','name','12782763HxXITu','events.history','round','dimmer','.1.TEMPERATURE','lastTrackerEventTime','STATUS','[RECORDER]\x20Ignored\x20implausible\x20temperature:\x20','pop','type','setStateAsync','push','TRACK_EVENT','isProVersion','.forecast.current.temp','apply','switch','contact','Valve','search','occupancy','error','3084jULWJB','(((.+)+)+)+$','LTM.trainingData.sequences','weatherunderground','sensorLastValues','parse','log','klima','STATE','toISOString','bewegung','.1.LEVEL','valveMapping','location','toString','from','daswetter','fill','getForeignStateAsync','.1.VALVE_STATE','config','isPresent','sendToPythonWrapper','719610eSRTDs','includes','events.lastEvent','exports','schloss','t체r','\x20from\x20','temperatur','outdoorSensorId','eventHistory','number','schalter','some','length','exitGraceTimer','LTM.trainingData.thermodynamics','licht','stringify','map','string','temperature','window','1631406VYbqgH','rawEventLog','level','val','now','1nVwEBx','analysis.health.todayVector','unshift','785098KINXhl','exitTimer'];a5_0x95c1=function(){return _0x45f40c;};return a5_0x95c1();}async function updateHourlyActivity(_0x355af3){const _0x113daf=a5_0x17de;let _0x26dac4=new Array(0x18)[_0x113daf(0xfa)](0x0),_0x24b262=0x0;try{const _0x3e512f=await _0x355af3[_0x113daf(0x127)](_0x113daf(0x11c));_0x3e512f&&_0x3e512f['val']&&(_0x26dac4=JSON[_0x113daf(0xee)](_0x3e512f[_0x113daf(0x119)]),_0x24b262=_0x3e512f['ts']);}catch(_0x4f10d4){}const _0x9e7147=new Date(_0x24b262),_0x163222=new Date();_0x9e7147[_0x113daf(0x133)]()!==_0x163222[_0x113daf(0x133)]()&&(_0x26dac4=new Array(0x18)[_0x113daf(0xfa)](0x0));const _0x403b46=_0x163222['getHours']();if(_0x26dac4[_0x403b46]===undefined)_0x26dac4[_0x403b46]=0x0;_0x26dac4[_0x403b46]++,await _0x355af3[_0x113daf(0x147)]('analysis.health.todayVector',{'val':JSON[_0x113daf(0x111)](_0x26dac4),'ack':!![]});}async function processSensorEvent(_0x2dc3a3,_0x105b9a,_0x23b78c,_0x3015f4){const _0x9686a9=a5_0x17de;if(!_0x3015f4)return null;const _0x4bb8ee=_0x23b78c[_0x9686a9(0x119)],_0x5e41fd=Date['now'](),_0x2c4c29=_0x2dc3a3[_0x9686a9(0xed)][_0x105b9a],_0x459934=(_0x3015f4[_0x9686a9(0x146)]||'')['toLowerCase'](),_0x669c3c=_0x459934[_0x9686a9(0x101)](_0x9686a9(0x114))||_0x459934[_0x9686a9(0x101)](_0x9686a9(0x107))||_0x459934[_0x9686a9(0x101)](_0x9686a9(0xf0))||_0x459934[_0x9686a9(0x101)]('heizung')||_0x459934[_0x9686a9(0x101)]('thermostat');if(_0x669c3c&&typeof _0x4bb8ee===_0x9686a9(0x10a)){if(_0x4bb8ee>0x50||_0x4bb8ee<-0x32)return _0x2dc3a3['log']['debug'](_0x9686a9(0x144)+_0x4bb8ee+_0x9686a9(0x106)+_0x105b9a),null;}_0x2dc3a3[_0x9686a9(0xed)][_0x105b9a]=_0x4bb8ee;if(!_0x3015f4['logDuplicates']&&_0x2c4c29!=undefined&&_0x2c4c29==_0x4bb8ee)return null;_0x2dc3a3['isProVersion']&&_0x669c3c&&recordThermodynamics(_0x2dc3a3,_0x105b9a,_0x4bb8ee,_0x3015f4[_0x9686a9(0xf6)]);const _0x1e8d1f={'timestamp':_0x5e41fd,'id':_0x105b9a,'name':_0x3015f4[_0x9686a9(0x13c)],'type':_0x3015f4['type'],'location':_0x3015f4[_0x9686a9(0xf6)],'value':_0x4bb8ee};_0x2dc3a3[_0x9686a9(0x109)][_0x9686a9(0x11d)](_0x1e8d1f);if(_0x2dc3a3[_0x9686a9(0x109)][_0x9686a9(0x10d)]>HISTORY_MAX_SIZE)_0x2dc3a3[_0x9686a9(0x109)][_0x9686a9(0x145)]();await _0x2dc3a3[_0x9686a9(0x147)](_0x9686a9(0x102),{'val':JSON[_0x9686a9(0x111)](_0x1e8d1f),'ack':!![]}),await _0x2dc3a3['setStateAsync'](_0x9686a9(0x13e),{'val':JSON[_0x9686a9(0x111)](_0x2dc3a3[_0x9686a9(0x109)]),'ack':!![]}),await updateHourlyActivity(_0x2dc3a3);if(_0x2dc3a3[_0x9686a9(0xe0)]){_0x2dc3a3[_0x9686a9(0x117)][_0x9686a9(0x148)](_0x1e8d1f);if(_0x2dc3a3[_0x9686a9(0x117)][_0x9686a9(0x10d)]>RAW_LOG_MAX_SIZE)_0x2dc3a3['rawEventLog']['splice'](0x0,_0x2dc3a3['rawEventLog']['length']-RAW_LOG_MAX_SIZE);await _0x2dc3a3['setStateAsync'](_0x9686a9(0x12e),{'val':JSON['stringify'](_0x2dc3a3['rawEventLog']),'ack':!![]}),recordSequence(_0x2dc3a3,_0x1e8d1f);}if(_0x3015f4['isExit']&&_0x4bb8ee===!![]){if(_0x2dc3a3[_0x9686a9(0xfe)]&&!_0x2dc3a3[_0x9686a9(0x13b)])startExitTimer(_0x2dc3a3);else{if(!_0x2dc3a3[_0x9686a9(0xfe)])setPresence(_0x2dc3a3,!![]);}}else{if(_0x3015f4[_0x9686a9(0x146)]===_0x9686a9(0x12f)&&_0x4bb8ee===!![]){if(_0x2dc3a3[_0x9686a9(0x11f)])abortExitTimer(_0x2dc3a3);if(!_0x2dc3a3[_0x9686a9(0xfe)]&&_0x2dc3a3[_0x9686a9(0x138)]==='normal')setPresence(_0x2dc3a3,!![]);}}if(_0x2dc3a3['isProVersion']&&_0x2dc3a3[_0x9686a9(0xff)]){_0x3015f4[_0x9686a9(0x146)]===_0x9686a9(0x12f)&&_0x4bb8ee===!![]&&_0x3015f4[_0x9686a9(0xf6)]&&_0x2dc3a3[_0x9686a9(0xff)]('SIMULATE_SIGNAL',{'room':_0x3015f4[_0x9686a9(0xf6)]});const _0x367d12=[_0x9686a9(0x132),'t체r',_0x9686a9(0x115),'fenster','griff',_0x9686a9(0x139),'lock',_0x9686a9(0x104)][_0x9686a9(0x10c)](_0xd4e81a=>_0x459934['includes'](_0xd4e81a)),_0xfa9f4=[_0x9686a9(0x126),_0x9686a9(0x110),_0x9686a9(0xe3),'schalter','dimmer','lampe'][_0x9686a9(0x10c)](_0x14ba3e=>_0x459934[_0x9686a9(0x101)](_0x14ba3e)),_0x19c68c=[_0x9686a9(0x12f),_0x9686a9(0xf3),_0x9686a9(0x12b),_0x9686a9(0x129),_0x9686a9(0xe7)]['some'](_0x50fdf9=>_0x459934[_0x9686a9(0x101)](_0x50fdf9));if(_0x3015f4[_0x9686a9(0xf6)]&&(_0x367d12||_0xfa9f4||_0x19c68c)){const _0x20564f=_0x4bb8ee===!![]||typeof _0x4bb8ee===_0x9686a9(0x10a)&&_0x4bb8ee>0x0,_0x5d27ca=_0x367d12&&!_0x20564f&&_0x2c4c29!==undefined&&_0x2c4c29!=_0x4bb8ee;if(_0x20564f||_0x5d27ca){const _0x3d7f43=_0x2dc3a3['lastTrackerEventTime']||_0x5e41fd,_0x178373=(_0x5e41fd-_0x3d7f43)/0x3e8;_0x2dc3a3[_0x9686a9(0x142)]=_0x5e41fd,_0x2dc3a3[_0x9686a9(0xff)](_0x9686a9(0x149),{'room':_0x3015f4['location'],'dt':_0x178373});}}}return _0x1e8d1f;}module[a5_0x1af6b1(0x103)]={'processSensorEvent':processSensorEvent,'getOutsideTemperatureNumeric':getOutsideTemperatureNumeric,'setPresence':setPresence,'abortExitTimer':abortExitTimer,'startExitTimer':startExitTimer};