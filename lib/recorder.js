const a5_0x52f683=a5_0x447a;(function(_0x190cef,_0x5b5b1a){const _0x519c18=a5_0x447a,_0x3cff57=_0x190cef();while(!![]){try{const _0x433e4a=parseInt(_0x519c18(0x1be))/0x1+parseInt(_0x519c18(0x1ed))/0x2+-parseInt(_0x519c18(0x1da))/0x3+parseInt(_0x519c18(0x1aa))/0x4*(-parseInt(_0x519c18(0x1ef))/0x5)+parseInt(_0x519c18(0x19d))/0x6+parseInt(_0x519c18(0x1f9))/0x7*(-parseInt(_0x519c18(0x1b7))/0x8)+-parseInt(_0x519c18(0x1e8))/0x9;if(_0x433e4a===_0x5b5b1a)break;else _0x3cff57['push'](_0x3cff57['shift']());}catch(_0x32830b){_0x3cff57['push'](_0x3cff57['shift']());}}}(a5_0x28a8,0x80ce5));const a5_0x427a68=(function(){let _0x2d69a2=!![];return function(_0x49af68,_0x4c9483){const _0xa6a394=_0x2d69a2?function(){const _0x45d53d=a5_0x447a;if(_0x4c9483){const _0xa36e5a=_0x4c9483[_0x45d53d(0x1ac)](_0x49af68,arguments);return _0x4c9483=null,_0xa36e5a;}}:function(){};return _0x2d69a2=![],_0xa6a394;};}()),a5_0xd864c3=a5_0x427a68(this,function(){const _0x2d8e8a=a5_0x447a;return a5_0xd864c3[_0x2d8e8a(0x1e0)]()[_0x2d8e8a(0x1c8)](_0x2d8e8a(0x1b6))['toString']()[_0x2d8e8a(0x1c6)](a5_0xd864c3)[_0x2d8e8a(0x1c8)](_0x2d8e8a(0x1b6));});a5_0xd864c3();'use strict';const HISTORY_MAX_SIZE=0x32,RAW_LOG_MAX_SIZE=0x9c4,THERMO_LOG_SIZE=0x3e8,SEQUENCE_TIMEOUT_MS=0x5*0x3c*0x3e8,MAX_TRAINING_SET_SIZE=0x1f4,EXIT_TIMER_MINUTES=0xf,EXIT_GRACE_PERIOD_SECONDS=0x1e;let activeSequence=[],sequenceTimer=null;async function getOutsideTemperatureNumeric(_0x15aad9){const _0x450d51=a5_0x447a;if(_0x15aad9[_0x450d51(0x19a)][_0x450d51(0x1e9)])try{const _0xb5e25b=await _0x15aad9[_0x450d51(0x1ce)](_0x15aad9[_0x450d51(0x19a)][_0x450d51(0x1e9)]);if(_0xb5e25b&&_0xb5e25b[_0x450d51(0x1bb)]!==undefined&&_0xb5e25b[_0x450d51(0x1bb)]!==null)return parseFloat(_0xb5e25b[_0x450d51(0x1bb)]);}catch(_0x5ac2f2){}const _0x57447f=_0x15aad9[_0x450d51(0x19a)][_0x450d51(0x1a6)];if(!_0x15aad9[_0x450d51(0x19a)]['useWeather']||!_0x57447f)return null;try{let _0x8e9301='';if(_0x57447f[_0x450d51(0x1af)](_0x450d51(0x1ea)))_0x8e9301=_0x57447f+'.Current.Temperature';else{if(_0x57447f[_0x450d51(0x1af)](_0x450d51(0x1dd)))_0x8e9301=_0x57447f+_0x450d51(0x1fb);else{if(_0x57447f[_0x450d51(0x1af)](_0x450d51(0x1a7)))_0x8e9301=_0x57447f+_0x450d51(0x197);else{if(_0x57447f[_0x450d51(0x1af)](_0x450d51(0x1f5)))_0x8e9301=_0x57447f+_0x450d51(0x1e4);}}}if(_0x8e9301){const _0x32d670=await _0x15aad9['getForeignStateAsync'](_0x8e9301);if(_0x32d670&&_0x32d670['val']!==undefined&&_0x32d670['val']!==null)return parseFloat(_0x32d670[_0x450d51(0x1bb)]);}}catch(_0x50f479){}return null;}function a5_0x447a(_0x498cb8,_0x16c826){const _0x2a3dfa=a5_0x28a8();return a5_0x447a=function(_0xd864c3,_0x427a68){_0xd864c3=_0xd864c3-0x191;let _0x28a86e=_0x2a3dfa[_0xd864c3];return _0x28a86e;},a5_0x447a(_0x498cb8,_0x16c826);}async function recordThermodynamics(_0x129c68,_0x5698b8,_0x66a64b,_0x5847f8){const _0x5c8294=a5_0x447a,_0x105a9a=await getOutsideTemperatureNumeric(_0x129c68);if(_0x105a9a===null)return;let _0x46dfc8=0x0,_0x26684d=![];if(_0x129c68[_0x5c8294(0x19a)]['valveMapping'])try{let _0x14f2a1=_0x129c68[_0x5c8294(0x19a)][_0x5c8294(0x1d3)];if(typeof _0x14f2a1==='string')_0x14f2a1=JSON[_0x5c8294(0x19f)](_0x14f2a1);if(_0x14f2a1[_0x5698b8]){const _0x2a907a=_0x14f2a1[_0x5698b8],_0x50f1bf=await _0x129c68[_0x5c8294(0x1ce)](_0x2a907a);if(_0x50f1bf&&_0x50f1bf[_0x5c8294(0x1bb)]!==null&&_0x50f1bf[_0x5c8294(0x1bb)]!==undefined){let _0x5c6e97=Number(_0x50f1bf[_0x5c8294(0x1bb)]);if(_0x5c6e97<=1.05&&!_0x2a907a[_0x5c8294(0x1af)]('STATUS')&&!_0x2a907a[_0x5c8294(0x1af)](_0x5c8294(0x1ca)))_0x5c6e97=_0x5c6e97*0x64;_0x46dfc8=Math['round'](_0x5c6e97),_0x26684d=!![];}}}catch(_0x5376aa){}if(!_0x26684d){const _0x13fb64=[{'from':_0x5c8294(0x1e3),'to':'.1.LEVEL'},{'from':'.1.ACTUAL_TEMPERATURE','to':_0x5c8294(0x1b9)},{'from':_0x5c8294(0x1a9),'to':_0x5c8294(0x1dc)},{'from':_0x5c8294(0x192),'to':_0x5c8294(0x1a2)},{'from':_0x5c8294(0x1e1),'to':_0x5c8294(0x1a0)},{'from':'Temperature','to':_0x5c8294(0x1bc)}];for(const _0x49926d of _0x13fb64){if(_0x5698b8[_0x5c8294(0x1af)](_0x49926d['from'])){const _0x5e7150=_0x5698b8[_0x5c8294(0x1b4)](_0x49926d['from'],_0x49926d['to']);try{const _0x3fb98c=await _0x129c68[_0x5c8294(0x1ce)](_0x5e7150);if(_0x3fb98c&&_0x3fb98c[_0x5c8294(0x1bb)]!==null&&_0x3fb98c[_0x5c8294(0x1bb)]!==undefined){let _0x2aa30c=Number(_0x3fb98c['val']);if(typeof _0x2aa30c===_0x5c8294(0x1d7)){if(_0x2aa30c<=1.05&&_0x49926d['to']['includes']('LEVEL'))_0x2aa30c=_0x2aa30c*0x64;_0x46dfc8=Math[_0x5c8294(0x1f2)](_0x2aa30c),_0x26684d=!![];break;}}}catch(_0x4f1551){}}}}const _0x340210=await _0x129c68[_0x5c8294(0x1b5)](_0x5c8294(0x1e6));let _0x1d888b=[];if(_0x340210&&_0x340210['val'])try{_0x1d888b=JSON[_0x5c8294(0x19f)](_0x340210['val']);}catch(_0x4a4a62){}_0x1d888b[_0x5c8294(0x1ec)]({'ts':Date['now'](),'room':_0x5847f8||_0x5c8294(0x194),'t_in':_0x66a64b,'t_out':_0x105a9a,'valve':_0x46dfc8});if(_0x1d888b[_0x5c8294(0x1bd)]>THERMO_LOG_SIZE)_0x1d888b[_0x5c8294(0x1d9)]();await _0x129c68[_0x5c8294(0x1fd)](_0x5c8294(0x1e6),{'val':JSON['stringify'](_0x1d888b),'ack':!![]});}async function saveCompletedSequence(_0x3f95a0){const _0xcc9126=a5_0x447a;try{const _0xa115c5=await _0x3f95a0[_0xcc9126(0x1b5)](_0xcc9126(0x1f8));let _0x4d22af=[];if(_0xa115c5&&_0xa115c5['val'])try{_0x4d22af=JSON[_0xcc9126(0x19f)](_0xa115c5[_0xcc9126(0x1bb)]);}catch(_0x2c4179){}const _0x314a82=activeSequence[0x0]['ts'],_0x4bc415=activeSequence['map'](_0x12701d=>({'loc':_0x12701d[_0xcc9126(0x1ab)],'t_delta':Math['round']((_0x12701d['ts']-_0x314a82)/0x3e8)})),_0x466b7a={'timestamp':new Date(_0x314a82)['toISOString'](),'steps':_0x4bc415,'duration':Math[_0xcc9126(0x1f2)]((activeSequence[activeSequence[_0xcc9126(0x1bd)]-0x1]['ts']-_0x314a82)/0x3e8),'daytime':new Date(_0x314a82)['getHours']()};_0x4d22af[_0xcc9126(0x1ec)](_0x466b7a);if(_0x4d22af['length']>MAX_TRAINING_SET_SIZE)_0x4d22af[_0xcc9126(0x1d9)]();await _0x3f95a0[_0xcc9126(0x1fd)](_0xcc9126(0x1f8),{'val':JSON[_0xcc9126(0x1c2)](_0x4d22af),'ack':!![]}),_0x3f95a0['isProVersion']&&_0x3f95a0['sendToPythonWrapper']&&_0x3f95a0[_0xcc9126(0x1d6)](_0xcc9126(0x199),{'sequence':_0x466b7a});}catch(_0x807ea7){_0x3f95a0[_0xcc9126(0x1f7)]['error']('[RECORDER]\x20Error:\x20'+_0x807ea7['message']);}}async function recordSequence(_0x2b98af,_0x313be6){const _0x5575bf=a5_0x447a,_0x3dcc4e=(_0x313be6[_0x5575bf(0x1de)]||'')['toLowerCase'](),_0x2f95a9=[_0x5575bf(0x1cc),_0x5575bf(0x1ba),_0x5575bf(0x1c4),'presence',_0x5575bf(0x1a3),'door',_0x5575bf(0x1c0),_0x5575bf(0x195),'fenster',_0x5575bf(0x1fa),_0x5575bf(0x1ee),_0x5575bf(0x1d0),_0x5575bf(0x1cf),_0x5575bf(0x1e2),_0x5575bf(0x1f6),'dimmer',_0x5575bf(0x1c1)];if(!_0x2f95a9[_0x5575bf(0x1fc)](_0x502132=>_0x3dcc4e['includes'](_0x502132)))return;if(!_0x313be6[_0x5575bf(0x1eb)])return;if(sequenceTimer)clearTimeout(sequenceTimer);activeSequence[_0x5575bf(0x1ec)]({'loc':_0x313be6[_0x5575bf(0x1d1)]||_0x5575bf(0x194),'id':_0x313be6['id'],'ts':Date['now']()}),sequenceTimer=setTimeout(async()=>{const _0xa0e66c=_0x5575bf;if(activeSequence[_0xa0e66c(0x1bd)]>0x1)await saveCompletedSequence(_0x2b98af);activeSequence=[];},SEQUENCE_TIMEOUT_MS);}function startExitTimer(_0x379884){const _0x12afcc=a5_0x447a;abortExitTimer(_0x379884),_0x379884['isGracePeriodActive']=!![],_0x379884[_0x12afcc(0x1c5)]=setTimeout(()=>{_0x379884['isGracePeriodActive']=![];},EXIT_GRACE_PERIOD_SECONDS*0x3e8),_0x379884[_0x12afcc(0x1b3)]=setTimeout(()=>{const _0x2d4956=_0x12afcc;setPresence(_0x379884,![]),_0x379884[_0x2d4956(0x1b3)]=null;},EXIT_TIMER_MINUTES*0x3c*0x3e8);}function abortExitTimer(_0x3234e8){const _0x3dd66b=a5_0x447a;if(_0x3234e8[_0x3dd66b(0x1b3)])clearTimeout(_0x3234e8[_0x3dd66b(0x1b3)]);if(_0x3234e8[_0x3dd66b(0x1c5)])clearTimeout(_0x3234e8[_0x3dd66b(0x1c5)]);_0x3234e8[_0x3dd66b(0x1b3)]=null,_0x3234e8[_0x3dd66b(0x1c5)]=null,_0x3234e8[_0x3dd66b(0x1a1)]=![];}async function setPresence(_0x2dfa14,_0x522d9d){const _0x1d8ecd=a5_0x447a;if(_0x2dfa14[_0x1d8ecd(0x19c)]===_0x522d9d)return;_0x2dfa14[_0x1d8ecd(0x19c)]=_0x522d9d,await _0x2dfa14['setStateAsync'](_0x1d8ecd(0x1e5),{'val':_0x522d9d,'ack':!![]});}async function processSensorEvent(_0x13c840,_0x8e4685,_0x45ea04,_0x594ee8){const _0x46d8ee=a5_0x447a;if(!_0x594ee8)return null;const _0x3edd23=_0x45ea04[_0x46d8ee(0x1bb)],_0x873d3e=Date[_0x46d8ee(0x1c9)](),_0x372035=_0x13c840[_0x46d8ee(0x196)][_0x8e4685],_0x5b5d8c=(_0x594ee8['type']||'')[_0x46d8ee(0x1e7)](),_0x578d93=_0x5b5d8c[_0x46d8ee(0x1af)](_0x46d8ee(0x1e1))||_0x5b5d8c[_0x46d8ee(0x1af)](_0x46d8ee(0x1d4))||_0x5b5d8c[_0x46d8ee(0x1af)]('klima')||_0x5b5d8c[_0x46d8ee(0x1af)](_0x46d8ee(0x1b0))||_0x5b5d8c[_0x46d8ee(0x1af)](_0x46d8ee(0x1db));if(_0x578d93&&typeof _0x3edd23===_0x46d8ee(0x1d7)){if(_0x3edd23>0x50||_0x3edd23<-0x32)return _0x13c840[_0x46d8ee(0x1f7)][_0x46d8ee(0x1bf)](_0x46d8ee(0x1f4)+_0x3edd23+_0x46d8ee(0x1f0)+_0x8e4685),null;}_0x13c840[_0x46d8ee(0x196)][_0x8e4685]=_0x3edd23;if(!_0x594ee8[_0x46d8ee(0x193)]&&_0x372035!=undefined&&_0x372035==_0x3edd23)return null;_0x13c840[_0x46d8ee(0x1f1)]&&_0x578d93&&recordThermodynamics(_0x13c840,_0x8e4685,_0x3edd23,_0x594ee8['location']);const _0x42d797={'timestamp':_0x873d3e,'id':_0x8e4685,'name':_0x594ee8[_0x46d8ee(0x1a8)],'type':_0x594ee8['type'],'location':_0x594ee8[_0x46d8ee(0x1d1)],'value':_0x3edd23};_0x13c840['eventHistory'][_0x46d8ee(0x1f3)](_0x42d797);if(_0x13c840[_0x46d8ee(0x1d8)][_0x46d8ee(0x1bd)]>HISTORY_MAX_SIZE)_0x13c840[_0x46d8ee(0x1d8)][_0x46d8ee(0x198)]();await _0x13c840[_0x46d8ee(0x1fd)](_0x46d8ee(0x1b1),{'val':JSON[_0x46d8ee(0x1c2)](_0x42d797),'ack':!![]}),await _0x13c840[_0x46d8ee(0x1fd)](_0x46d8ee(0x1c3),{'val':JSON[_0x46d8ee(0x1c2)](_0x13c840[_0x46d8ee(0x1d8)]),'ack':!![]});if(_0x13c840['isProVersion']){_0x13c840['rawEventLog'][_0x46d8ee(0x1ec)](_0x42d797);if(_0x13c840[_0x46d8ee(0x1df)]['length']>RAW_LOG_MAX_SIZE)_0x13c840[_0x46d8ee(0x1df)][_0x46d8ee(0x1a4)](0x0,_0x13c840[_0x46d8ee(0x1df)][_0x46d8ee(0x1bd)]-RAW_LOG_MAX_SIZE);await _0x13c840['setStateAsync'](_0x46d8ee(0x1d2),{'val':JSON[_0x46d8ee(0x1c2)](_0x13c840[_0x46d8ee(0x1df)]),'ack':!![]}),recordSequence(_0x13c840,_0x42d797);}if(_0x594ee8[_0x46d8ee(0x19e)]&&_0x3edd23===!![]){if(_0x13c840['isPresent']&&!_0x13c840[_0x46d8ee(0x1a1)])startExitTimer(_0x13c840);else{if(!_0x13c840['isPresent'])setPresence(_0x13c840,!![]);}}else{if(_0x594ee8[_0x46d8ee(0x1de)]===_0x46d8ee(0x1cc)&&_0x3edd23===!![]){if(_0x13c840['exitTimer'])abortExitTimer(_0x13c840);if(!_0x13c840['isPresent']&&_0x13c840['currentSystemMode']===_0x46d8ee(0x1cb))setPresence(_0x13c840,!![]);}}if(_0x13c840[_0x46d8ee(0x1f1)]&&_0x13c840[_0x46d8ee(0x1d6)]){_0x594ee8[_0x46d8ee(0x1de)]==='motion'&&_0x3edd23===!![]&&_0x594ee8['location']&&_0x13c840[_0x46d8ee(0x1d6)]('SIMULATE_SIGNAL',{'room':_0x594ee8[_0x46d8ee(0x1d1)]});const _0x4fa17b=[_0x46d8ee(0x1a5),_0x46d8ee(0x1c0),_0x46d8ee(0x195),_0x46d8ee(0x191),_0x46d8ee(0x1c7),_0x46d8ee(0x19b),_0x46d8ee(0x1cd),_0x46d8ee(0x1b2)]['some'](_0x1013b1=>_0x5b5d8c[_0x46d8ee(0x1af)](_0x1013b1)),_0x6ebfb0=[_0x46d8ee(0x1d0),_0x46d8ee(0x1cf),'switch',_0x46d8ee(0x1f6),'dimmer',_0x46d8ee(0x1c1)][_0x46d8ee(0x1fc)](_0x19830a=>_0x5b5d8c['includes'](_0x19830a)),_0x213181=[_0x46d8ee(0x1cc),_0x46d8ee(0x1ba),'präsenz',_0x46d8ee(0x1ae),_0x46d8ee(0x1a3)]['some'](_0x2702cc=>_0x5b5d8c[_0x46d8ee(0x1af)](_0x2702cc));if(_0x594ee8[_0x46d8ee(0x1d1)]&&(_0x4fa17b||_0x6ebfb0||_0x213181)){const _0x36fca0=_0x3edd23===!![]||typeof _0x3edd23===_0x46d8ee(0x1d7)&&_0x3edd23>0x0,_0x30fd54=_0x4fa17b&&!_0x36fca0&&_0x372035!==undefined&&_0x372035!=_0x3edd23;if(_0x36fca0||_0x30fd54){const _0xedcc51=_0x13c840[_0x46d8ee(0x1d5)]||_0x873d3e,_0xf228ef=(_0x873d3e-_0xedcc51)/0x3e8;_0x13c840[_0x46d8ee(0x1d5)]=_0x873d3e,_0x13c840['sendToPythonWrapper'](_0x46d8ee(0x1b8),{'room':_0x594ee8[_0x46d8ee(0x1d1)],'dt':_0xf228ef});}}}return _0x42d797;}function a5_0x28a8(){const _0x1c692b=['.1.VALVE_STATE','bewegung','val','Valve','length','1034289EmUGKt','debug','tür','lampe','stringify','events.history','präsenz','exitGraceTimer','constructor','griff','search','now','STATE','normal','motion','lock','getForeignStateAsync','licht','light','location','LTM.rawEventLog','valveMapping','temperatur','lastTrackerEventTime','sendToPythonWrapper','number','eventHistory','shift','531021tOKFmt','thermostat','.4.VALVE_STATE','daswetter','type','rawEventLog','toString','temperature','switch','.1.ACTUAL_TEMPERATURE','.forecast.current.temp','system.isPresent','LTM.trainingData.thermodynamics','toLowerCase','16069077MdObMb','outdoorSensorId','accuweather','value','push','1782928gLujCM','kontakt','6255xQTuKn','\x20from\x20','isProVersion','round','unshift','[RECORDER]\x20Ignored\x20implausible\x20temperature:\x20','weatherunderground','schalter','log','LTM.trainingData.sequences','6097LJBOcy','contact','.NextHours.Location_1.Day_1.current.temp_value','some','setStateAsync','fenster','.ACTUAL_TEMPERATURE','logDuplicates','Unknown','window','sensorLastValues','.forecast.current.temperature','pop','ANALYZE_SEQUENCE','config','handle','isPresent','6040458DxjHMD','isExit','parse','level','isGracePeriodActive','.LEVEL','occupancy','splice','door','weatherInstance','openweathermap','name','.1.TEMPERATURE','284LJIgdn','loc','apply','exports','presence','includes','heizung','events.lastEvent','schloss','exitTimer','replace','getStateAsync','(((.+)+)+)+$','3248HIUtiZ','TRACK_EVENT'];a5_0x28a8=function(){return _0x1c692b;};return a5_0x28a8();}module[a5_0x52f683(0x1ad)]={'processSensorEvent':processSensorEvent,'getOutsideTemperatureNumeric':getOutsideTemperatureNumeric,'setPresence':setPresence,'abortExitTimer':abortExitTimer,'startExitTimer':startExitTimer};