function a5_0x168e(_0x38e65c,_0x5d96dd){const _0x134002=a5_0x22af();return a5_0x168e=function(_0x4f534d,_0x22d6b4){_0x4f534d=_0x4f534d-0x11b;let _0x22afb7=_0x134002[_0x4f534d];return _0x22afb7;},a5_0x168e(_0x38e65c,_0x5d96dd);}const a5_0xd12287=a5_0x168e;(function(_0x2b7025,_0xb75090){const _0x440091=a5_0x168e,_0x3ba695=_0x2b7025();while(!![]){try{const _0x4d2a76=parseInt(_0x440091(0x129))/0x1+-parseInt(_0x440091(0x173))/0x2*(parseInt(_0x440091(0x16f))/0x3)+-parseInt(_0x440091(0x174))/0x4+-parseInt(_0x440091(0x121))/0x5+parseInt(_0x440091(0x149))/0x6*(parseInt(_0x440091(0x14c))/0x7)+parseInt(_0x440091(0x159))/0x8+parseInt(_0x440091(0x147))/0x9*(parseInt(_0x440091(0x15b))/0xa);if(_0x4d2a76===_0xb75090)break;else _0x3ba695['push'](_0x3ba695['shift']());}catch(_0x404e2f){_0x3ba695['push'](_0x3ba695['shift']());}}}(a5_0x22af,0x99967));const a5_0x22d6b4=(function(){let _0x442a3c=!![];return function(_0x94fc81,_0x5018ca){const _0x2d4398=_0x442a3c?function(){if(_0x5018ca){const _0xe2cd20=_0x5018ca['apply'](_0x94fc81,arguments);return _0x5018ca=null,_0xe2cd20;}}:function(){};return _0x442a3c=![],_0x2d4398;};}()),a5_0x4f534d=a5_0x22d6b4(this,function(){const _0x256cae=a5_0x168e;return a5_0x4f534d['toString']()[_0x256cae(0x133)](_0x256cae(0x124))['toString']()[_0x256cae(0x132)](a5_0x4f534d)[_0x256cae(0x133)]('(((.+)+)+)+$');});a5_0x4f534d();'use strict';const HISTORY_MAX_SIZE=0x32,RAW_LOG_MAX_SIZE=0x9c4,THERMO_LOG_SIZE=0x3e8,SEQUENCE_TIMEOUT_MS=0x5*0x3c*0x3e8,MAX_TRAINING_SET_SIZE=0x1f4,EXIT_TIMER_MINUTES=0xf,EXIT_GRACE_PERIOD_SECONDS=0x1e;let activeSequence=[],sequenceTimer=null;function a5_0x22af(){const _0xf953ef=['presence','ANALYZE_SEQUENCE','config','openweathermap','contact','accuweather','.LEVEL','3738130sUmoMW','stringify','loc','(((.+)+)+)+$','.1.TEMPERATURE','klima','events.history','getStateAsync','1195669ROgRmA','temperatur','map','door','.ACTUAL_TEMPERATURE','light','splice','isProVersion','schalter','constructor','search','events.lastEvent','sendToPythonWrapper','push','.NextHours.Location_1.Day_1.current.temp_value','log','unshift','exitTimer','replace','value','LTM.rawEventLog','name','bewegung','toLowerCase','.1.ACTUAL_TEMPERATURE','dimmer','tür','normal','shift','currentSystemMode','3168TCEKrS','rawEventLog','6ghEbCH','now','isPresent','4150727FBivPE','location','outdoorSensorId','.1.LEVEL','eventHistory','LTM.trainingData.thermodynamics','from','round','SIMULATE_SIGNAL','setStateAsync','length','includes','licht','163408xahRnv','number','7230ZMCTGH','sensorLastValues','kontakt','LEVEL','occupancy','system.isPresent','isGracePeriodActive','.forecast.current.temperature','pop','exports','heizung','parse','motion','exitGraceTimer','isExit','temperature','fenster','Unknown','hm-rpc','val','6iKyEoN','getForeignStateAsync','switch','message','7346syxAsc','2717940kEgCIR','.Current.Temperature','getHours','type','.1.VALVE_STATE','useWeather'];a5_0x22af=function(){return _0xf953ef;};return a5_0x22af();}async function getOutsideTemperatureNumeric(_0x3088ff){const _0x1816c5=a5_0x168e;if(_0x3088ff[_0x1816c5(0x11c)][_0x1816c5(0x14e)])try{const _0x5626cd=await _0x3088ff[_0x1816c5(0x170)](_0x3088ff['config'][_0x1816c5(0x14e)]);if(_0x5626cd&&_0x5626cd[_0x1816c5(0x16e)]!==undefined&&_0x5626cd['val']!==null)return parseFloat(_0x5626cd[_0x1816c5(0x16e)]);}catch(_0x2ad509){}const _0xc66731=_0x3088ff[_0x1816c5(0x11c)]['weatherInstance'];if(!_0x3088ff[_0x1816c5(0x11c)][_0x1816c5(0x179)]||!_0xc66731)return null;try{let _0x2329fb='';if(_0xc66731[_0x1816c5(0x157)](_0x1816c5(0x11f)))_0x2329fb=_0xc66731+_0x1816c5(0x175);else{if(_0xc66731[_0x1816c5(0x157)]('daswetter'))_0x2329fb=_0xc66731+_0x1816c5(0x137);else{if(_0xc66731[_0x1816c5(0x157)](_0x1816c5(0x11d)))_0x2329fb=_0xc66731+_0x1816c5(0x162);else{if(_0xc66731['includes']('weatherunderground'))_0x2329fb=_0xc66731+'.forecast.current.temp';}}}if(_0x2329fb){const _0x407bae=await _0x3088ff[_0x1816c5(0x170)](_0x2329fb);if(_0x407bae&&_0x407bae[_0x1816c5(0x16e)]!==undefined&&_0x407bae['val']!==null)return parseFloat(_0x407bae[_0x1816c5(0x16e)]);}}catch(_0x1fe3b0){}return null;}async function recordThermodynamics(_0x45ac67,_0x206f3e,_0x232fbc,_0x56a248){const _0x316604=a5_0x168e,_0x47a095=await getOutsideTemperatureNumeric(_0x45ac67);let _0x3f9d8b=0x0;if(_0x206f3e['includes'](_0x316604(0x16d))){const _0x14a561=[{'from':_0x316604(0x141),'to':_0x316604(0x14f)},{'from':_0x316604(0x141),'to':_0x316604(0x178)},{'from':_0x316604(0x125),'to':'.4.VALVE_STATE'},{'from':_0x316604(0x12d),'to':_0x316604(0x120)}];for(const _0x3cab00 of _0x14a561){if(_0x206f3e[_0x316604(0x157)](_0x3cab00[_0x316604(0x152)])){const _0x2f684a=_0x206f3e[_0x316604(0x13b)](_0x3cab00['from'],_0x3cab00['to']);try{const _0x4fb616=await _0x45ac67[_0x316604(0x170)](_0x2f684a);if(_0x4fb616&&_0x4fb616[_0x316604(0x16e)]!==null&&_0x4fb616[_0x316604(0x16e)]!==undefined){let _0x4df34a=_0x4fb616[_0x316604(0x16e)];typeof _0x4df34a===_0x316604(0x15a)&&_0x4df34a<=1.05&&_0x3cab00['to'][_0x316604(0x157)](_0x316604(0x15e))&&(_0x4df34a=_0x4df34a*0x64);_0x3f9d8b=Math['round'](_0x4df34a);break;}}catch(_0x2b45f8){}}}}const _0x34ed09=await _0x45ac67[_0x316604(0x128)](_0x316604(0x151));let _0x4bd749=[];if(_0x34ed09&&_0x34ed09[_0x316604(0x16e)])try{_0x4bd749=JSON['parse'](_0x34ed09[_0x316604(0x16e)]);}catch(_0x4e499d){}_0x4bd749['push']({'ts':Date[_0x316604(0x14a)](),'room':_0x56a248||_0x316604(0x16c),'t_in':_0x232fbc,'t_out':_0x47a095,'valve':_0x3f9d8b});if(_0x4bd749['length']>THERMO_LOG_SIZE)_0x4bd749[_0x316604(0x145)]();await _0x45ac67[_0x316604(0x155)]('LTM.trainingData.thermodynamics',{'val':JSON[_0x316604(0x122)](_0x4bd749),'ack':!![]});}async function saveCompletedSequence(_0x9e96f2){const _0x57c936=a5_0x168e;try{const _0x2b8d7b=await _0x9e96f2[_0x57c936(0x128)]('LTM.trainingData.sequences');let _0x57b3c3=[];if(_0x2b8d7b&&_0x2b8d7b[_0x57c936(0x16e)])try{_0x57b3c3=JSON[_0x57c936(0x166)](_0x2b8d7b['val']);}catch(_0x3020ff){}const _0x22bbef=activeSequence[0x0]['ts'],_0x500ddc=activeSequence[_0x57c936(0x12b)](_0x568056=>({'loc':_0x568056[_0x57c936(0x123)],'t_delta':Math[_0x57c936(0x153)]((_0x568056['ts']-_0x22bbef)/0x3e8)})),_0xa4964c={'timestamp':new Date(_0x22bbef)['toISOString'](),'steps':_0x500ddc,'duration':Math[_0x57c936(0x153)]((activeSequence[activeSequence['length']-0x1]['ts']-_0x22bbef)/0x3e8),'daytime':new Date(_0x22bbef)[_0x57c936(0x176)]()};_0x57b3c3[_0x57c936(0x136)](_0xa4964c);if(_0x57b3c3[_0x57c936(0x156)]>MAX_TRAINING_SET_SIZE)_0x57b3c3[_0x57c936(0x145)]();await _0x9e96f2[_0x57c936(0x155)]('LTM.trainingData.sequences',{'val':JSON[_0x57c936(0x122)](_0x57b3c3),'ack':!![]}),_0x9e96f2[_0x57c936(0x130)]&&_0x9e96f2[_0x57c936(0x135)]&&_0x9e96f2[_0x57c936(0x135)](_0x57c936(0x11b),{'sequence':_0xa4964c});}catch(_0x422134){_0x9e96f2[_0x57c936(0x138)]['error']('[RECORDER]\x20Error:\x20'+_0x422134[_0x57c936(0x172)]);}}async function recordSequence(_0x580668,_0x52b1e9){const _0x3f4c1f=a5_0x168e,_0x3de386=(_0x52b1e9['type']||'')[_0x3f4c1f(0x140)](),_0xd295bf=['motion',_0x3f4c1f(0x13f),'präsenz',_0x3f4c1f(0x17a),_0x3f4c1f(0x15f),_0x3f4c1f(0x12c),_0x3f4c1f(0x143),'window',_0x3f4c1f(0x16b),_0x3f4c1f(0x11e),_0x3f4c1f(0x15d),_0x3f4c1f(0x12e),_0x3f4c1f(0x158),_0x3f4c1f(0x171),_0x3f4c1f(0x131),_0x3f4c1f(0x142),'lampe'];if(!_0xd295bf['some'](_0x4ff32a=>_0x3de386[_0x3f4c1f(0x157)](_0x4ff32a)))return;if(!_0x52b1e9[_0x3f4c1f(0x13c)])return;if(sequenceTimer)clearTimeout(sequenceTimer);activeSequence[_0x3f4c1f(0x136)]({'loc':_0x52b1e9[_0x3f4c1f(0x14d)]||_0x3f4c1f(0x16c),'id':_0x52b1e9['id'],'ts':Date['now']()}),sequenceTimer=setTimeout(async()=>{const _0x294032=_0x3f4c1f;if(activeSequence[_0x294032(0x156)]>0x1)await saveCompletedSequence(_0x580668);activeSequence=[];},SEQUENCE_TIMEOUT_MS);}function startExitTimer(_0x350b4c){const _0x560ed0=a5_0x168e;abortExitTimer(_0x350b4c),_0x350b4c[_0x560ed0(0x161)]=!![],_0x350b4c[_0x560ed0(0x168)]=setTimeout(()=>{const _0x1dd484=_0x560ed0;_0x350b4c[_0x1dd484(0x161)]=![];},EXIT_GRACE_PERIOD_SECONDS*0x3e8),_0x350b4c[_0x560ed0(0x13a)]=setTimeout(()=>{const _0x3dafa0=_0x560ed0;setPresence(_0x350b4c,![]),_0x350b4c[_0x3dafa0(0x13a)]=null;},EXIT_TIMER_MINUTES*0x3c*0x3e8);}function abortExitTimer(_0x4677f2){const _0x5ae7ae=a5_0x168e;if(_0x4677f2[_0x5ae7ae(0x13a)])clearTimeout(_0x4677f2[_0x5ae7ae(0x13a)]);if(_0x4677f2[_0x5ae7ae(0x168)])clearTimeout(_0x4677f2[_0x5ae7ae(0x168)]);_0x4677f2['exitTimer']=null,_0x4677f2['exitGraceTimer']=null,_0x4677f2[_0x5ae7ae(0x161)]=![];}async function setPresence(_0x1dcf4c,_0x28d9df){const _0x367d8f=a5_0x168e;if(_0x1dcf4c[_0x367d8f(0x14b)]===_0x28d9df)return;_0x1dcf4c['isPresent']=_0x28d9df,await _0x1dcf4c['setStateAsync'](_0x367d8f(0x160),{'val':_0x28d9df,'ack':!![]});}async function processSensorEvent(_0x1ab66d,_0x470da7,_0x2c38bb,_0x522fec){const _0x1f62f7=a5_0x168e;if(!_0x522fec)return null;const _0x14fe92=_0x2c38bb[_0x1f62f7(0x16e)],_0x709887=Date[_0x1f62f7(0x14a)](),_0xf2669=_0x1ab66d[_0x1f62f7(0x15c)][_0x470da7];_0x1ab66d[_0x1f62f7(0x15c)][_0x470da7]=_0x14fe92;if(!_0x522fec['logDuplicates']&&_0xf2669!=undefined&&_0xf2669==_0x14fe92)return null;const _0x49900e=(_0x522fec[_0x1f62f7(0x177)]||'')[_0x1f62f7(0x140)](),_0x43da7a=_0x49900e[_0x1f62f7(0x157)](_0x1f62f7(0x16a))||_0x49900e['includes'](_0x1f62f7(0x12a))||_0x49900e[_0x1f62f7(0x157)](_0x1f62f7(0x126))||_0x49900e[_0x1f62f7(0x157)](_0x1f62f7(0x165));_0x1ab66d[_0x1f62f7(0x130)]&&_0x43da7a&&recordThermodynamics(_0x1ab66d,_0x470da7,_0x14fe92,_0x522fec[_0x1f62f7(0x14d)]);const _0x377555={'timestamp':_0x709887,'id':_0x470da7,'name':_0x522fec[_0x1f62f7(0x13e)],'type':_0x522fec[_0x1f62f7(0x177)],'location':_0x522fec['location'],'value':_0x14fe92};_0x1ab66d[_0x1f62f7(0x150)][_0x1f62f7(0x139)](_0x377555);if(_0x1ab66d['eventHistory'][_0x1f62f7(0x156)]>HISTORY_MAX_SIZE)_0x1ab66d['eventHistory'][_0x1f62f7(0x163)]();await _0x1ab66d[_0x1f62f7(0x155)](_0x1f62f7(0x134),{'val':JSON[_0x1f62f7(0x122)](_0x377555),'ack':!![]}),await _0x1ab66d[_0x1f62f7(0x155)](_0x1f62f7(0x127),{'val':JSON[_0x1f62f7(0x122)](_0x1ab66d['eventHistory']),'ack':!![]});if(_0x1ab66d['isProVersion']){_0x1ab66d['rawEventLog']['push'](_0x377555);if(_0x1ab66d[_0x1f62f7(0x148)][_0x1f62f7(0x156)]>RAW_LOG_MAX_SIZE)_0x1ab66d['rawEventLog'][_0x1f62f7(0x12f)](0x0,_0x1ab66d[_0x1f62f7(0x148)][_0x1f62f7(0x156)]-RAW_LOG_MAX_SIZE);await _0x1ab66d[_0x1f62f7(0x155)](_0x1f62f7(0x13d),{'val':JSON[_0x1f62f7(0x122)](_0x1ab66d[_0x1f62f7(0x148)]),'ack':!![]}),recordSequence(_0x1ab66d,_0x377555);}if(_0x522fec[_0x1f62f7(0x169)]&&_0x14fe92===!![]){if(_0x1ab66d[_0x1f62f7(0x14b)]&&!_0x1ab66d[_0x1f62f7(0x161)])startExitTimer(_0x1ab66d);else{if(!_0x1ab66d['isPresent'])setPresence(_0x1ab66d,!![]);}}else{if(_0x522fec['type']===_0x1f62f7(0x167)&&_0x14fe92===!![]){if(_0x1ab66d[_0x1f62f7(0x13a)])abortExitTimer(_0x1ab66d);if(!_0x1ab66d[_0x1f62f7(0x14b)]&&_0x1ab66d[_0x1f62f7(0x146)]===_0x1f62f7(0x144))setPresence(_0x1ab66d,!![]);}}return _0x1ab66d[_0x1f62f7(0x130)]&&_0x522fec[_0x1f62f7(0x177)]===_0x1f62f7(0x167)&&_0x14fe92===!![]&&_0x522fec[_0x1f62f7(0x14d)]&&_0x1ab66d[_0x1f62f7(0x135)]&&_0x1ab66d['sendToPythonWrapper'](_0x1f62f7(0x154),{'room':_0x522fec[_0x1f62f7(0x14d)]}),_0x377555;}module[a5_0xd12287(0x164)]={'processSensorEvent':processSensorEvent,'getOutsideTemperatureNumeric':getOutsideTemperatureNumeric,'setPresence':setPresence,'abortExitTimer':abortExitTimer,'startExitTimer':startExitTimer};