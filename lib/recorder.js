const a5_0x2e1c78=a5_0x5f57;(function(_0x3d5d10,_0x31dda5){const _0x46616e=a5_0x5f57,_0x37a16b=_0x3d5d10();while(!![]){try{const _0x29717d=parseInt(_0x46616e(0x144))/0x1*(-parseInt(_0x46616e(0x12f))/0x2)+-parseInt(_0x46616e(0x106))/0x3*(-parseInt(_0x46616e(0x133))/0x4)+parseInt(_0x46616e(0xd9))/0x5*(parseInt(_0x46616e(0x124))/0x6)+-parseInt(_0x46616e(0x12b))/0x7*(parseInt(_0x46616e(0xe0))/0x8)+parseInt(_0x46616e(0x10b))/0x9+parseInt(_0x46616e(0x130))/0xa*(parseInt(_0x46616e(0xf8))/0xb)+parseInt(_0x46616e(0xf7))/0xc*(parseInt(_0x46616e(0x138))/0xd);if(_0x29717d===_0x31dda5)break;else _0x37a16b['push'](_0x37a16b['shift']());}catch(_0x62c425){_0x37a16b['push'](_0x37a16b['shift']());}}}(a5_0x42de,0x9d45f));const a5_0x2732ad=(function(){let _0x528bba=!![];return function(_0x1fb959,_0x114a76){const _0x204bc9=_0x528bba?function(){const _0x218079=a5_0x5f57;if(_0x114a76){const _0x2d2efd=_0x114a76[_0x218079(0xdb)](_0x1fb959,arguments);return _0x114a76=null,_0x2d2efd;}}:function(){};return _0x528bba=![],_0x204bc9;};}()),a5_0x50c74c=a5_0x2732ad(this,function(){const _0x4c958a=a5_0x5f57;return a5_0x50c74c[_0x4c958a(0xd6)]()[_0x4c958a(0x12e)](_0x4c958a(0x114))[_0x4c958a(0xd6)]()[_0x4c958a(0x12d)](a5_0x50c74c)[_0x4c958a(0x12e)]('(((.+)+)+)+$');});a5_0x50c74c();'use strict';const HISTORY_MAX_SIZE=0x32,RAW_LOG_MAX_SIZE=0x9c4,THERMO_LOG_SIZE=0x3e8,SEQUENCE_TIMEOUT_MS=0x5*0x3c*0x3e8,MAX_TRAINING_SET_SIZE=0x1f4,EXIT_TIMER_MINUTES=0xf,EXIT_GRACE_PERIOD_SECONDS=0x1e;let activeSequence=[],sequenceTimer=null;async function getOutsideTemperatureNumeric(_0x46b94d){const _0x345b81=a5_0x5f57;if(_0x46b94d['config'][_0x345b81(0x13b)])try{const _0x11b9cd=await _0x46b94d[_0x345b81(0x121)](_0x46b94d[_0x345b81(0x109)]['outdoorSensorId']);if(_0x11b9cd&&_0x11b9cd['val']!==undefined&&_0x11b9cd[_0x345b81(0x108)]!==null)return parseFloat(_0x11b9cd[_0x345b81(0x108)]);}catch(_0x779004){}const _0x88a2b2=_0x46b94d[_0x345b81(0x109)][_0x345b81(0xee)];if(!_0x46b94d[_0x345b81(0x109)][_0x345b81(0x10e)]||!_0x88a2b2)return null;try{let _0x58c0bb='';if(_0x88a2b2[_0x345b81(0xf0)](_0x345b81(0x132)))_0x58c0bb=_0x88a2b2+_0x345b81(0x127);else{if(_0x88a2b2[_0x345b81(0xf0)](_0x345b81(0xe9)))_0x58c0bb=_0x88a2b2+_0x345b81(0xf6);else{if(_0x88a2b2[_0x345b81(0xf0)](_0x345b81(0x126)))_0x58c0bb=_0x88a2b2+_0x345b81(0xf9);else{if(_0x88a2b2['includes']('weatherunderground'))_0x58c0bb=_0x88a2b2+_0x345b81(0xf1);}}}if(_0x58c0bb){const _0x346d92=await _0x46b94d[_0x345b81(0x121)](_0x58c0bb);if(_0x346d92&&_0x346d92['val']!==undefined&&_0x346d92[_0x345b81(0x108)]!==null)return parseFloat(_0x346d92[_0x345b81(0x108)]);}}catch(_0x36857f){}return null;}async function recordThermodynamics(_0x140201,_0x336d04,_0x537d07,_0x531af7){const _0x219be0=a5_0x5f57,_0x4f26c9=await getOutsideTemperatureNumeric(_0x140201);if(_0x4f26c9===null)return;let _0x4c3938=0x0,_0x5b2f04=![];if(_0x140201[_0x219be0(0x109)][_0x219be0(0xff)])try{let _0x1a55f0=_0x140201[_0x219be0(0x109)][_0x219be0(0xff)];if(typeof _0x1a55f0===_0x219be0(0x100))_0x1a55f0=JSON[_0x219be0(0x105)](_0x1a55f0);if(_0x1a55f0[_0x336d04]){const _0x3b0763=_0x1a55f0[_0x336d04],_0x308c1e=await _0x140201[_0x219be0(0x121)](_0x3b0763);if(_0x308c1e&&_0x308c1e[_0x219be0(0x108)]!==null&&_0x308c1e[_0x219be0(0x108)]!==undefined){let _0x432ec3=Number(_0x308c1e[_0x219be0(0x108)]);if(_0x432ec3<=1.05&&!_0x3b0763[_0x219be0(0xf0)](_0x219be0(0xed))&&!_0x3b0763['includes'](_0x219be0(0xdc)))_0x432ec3=_0x432ec3*0x64;_0x4c3938=Math[_0x219be0(0xde)](_0x432ec3),_0x5b2f04=!![];}}}catch(_0x2fc88e){}if(!_0x5b2f04){const _0x2fb44f=[{'from':_0x219be0(0x134),'to':'.1.LEVEL'},{'from':_0x219be0(0x134),'to':_0x219be0(0x13c)},{'from':_0x219be0(0x116),'to':_0x219be0(0x11a)},{'from':_0x219be0(0x141),'to':_0x219be0(0x129)},{'from':_0x219be0(0xdd),'to':_0x219be0(0xd8)},{'from':_0x219be0(0x148),'to':_0x219be0(0x122)}];for(const _0x4e8252 of _0x2fb44f){if(_0x336d04[_0x219be0(0xf0)](_0x4e8252[_0x219be0(0x140)])){const _0x3d018f=_0x336d04[_0x219be0(0xec)](_0x4e8252['from'],_0x4e8252['to']);try{const _0x17c25c=await _0x140201['getForeignStateAsync'](_0x3d018f);if(_0x17c25c&&_0x17c25c[_0x219be0(0x108)]!==null&&_0x17c25c[_0x219be0(0x108)]!==undefined){let _0x586b42=Number(_0x17c25c[_0x219be0(0x108)]);if(typeof _0x586b42===_0x219be0(0x12a)){if(_0x586b42<=1.05&&_0x4e8252['to'][_0x219be0(0xf0)](_0x219be0(0x12c)))_0x586b42=_0x586b42*0x64;_0x4c3938=Math[_0x219be0(0xde)](_0x586b42),_0x5b2f04=!![];break;}}}catch(_0x2636dd){}}}}const _0x474d59=await _0x140201['getStateAsync'](_0x219be0(0x110));let _0x261f5a=[];if(_0x474d59&&_0x474d59[_0x219be0(0x108)])try{_0x261f5a=JSON['parse'](_0x474d59[_0x219be0(0x108)]);}catch(_0x1d9ee4){}_0x261f5a['push']({'ts':Date[_0x219be0(0x137)](),'room':_0x531af7||_0x219be0(0xfc),'t_in':_0x537d07,'t_out':_0x4f26c9,'valve':_0x4c3938});if(_0x261f5a[_0x219be0(0x10d)]>THERMO_LOG_SIZE)_0x261f5a[_0x219be0(0x11c)]();await _0x140201[_0x219be0(0x10f)]('LTM.trainingData.thermodynamics',{'val':JSON[_0x219be0(0x11d)](_0x261f5a),'ack':!![]});}async function saveCompletedSequence(_0x277f52){const _0xb5c80d=a5_0x5f57;try{const _0x5e83e5=await _0x277f52['getStateAsync']('LTM.trainingData.sequences');let _0x2e2e5e=[];if(_0x5e83e5&&_0x5e83e5[_0xb5c80d(0x108)])try{_0x2e2e5e=JSON[_0xb5c80d(0x105)](_0x5e83e5[_0xb5c80d(0x108)]);}catch(_0x1bf58c){}const _0x1e1301=activeSequence[0x0]['ts'],_0x66f749=activeSequence['map'](_0x40d05e=>({'loc':_0x40d05e[_0xb5c80d(0x13a)],'t_delta':Math[_0xb5c80d(0xde)]((_0x40d05e['ts']-_0x1e1301)/0x3e8)})),_0x39ea42={'timestamp':new Date(_0x1e1301)[_0xb5c80d(0xf3)](),'steps':_0x66f749,'duration':Math['round']((activeSequence[activeSequence['length']-0x1]['ts']-_0x1e1301)/0x3e8),'daytime':new Date(_0x1e1301)[_0xb5c80d(0x13d)]()};_0x2e2e5e['push'](_0x39ea42);if(_0x2e2e5e['length']>MAX_TRAINING_SET_SIZE)_0x2e2e5e[_0xb5c80d(0x11c)]();await _0x277f52[_0xb5c80d(0x10f)]('LTM.trainingData.sequences',{'val':JSON[_0xb5c80d(0x11d)](_0x2e2e5e),'ack':!![]}),_0x277f52[_0xb5c80d(0x10a)]&&_0x277f52[_0xb5c80d(0x112)]&&_0x277f52[_0xb5c80d(0x112)](_0xb5c80d(0x118),{'sequence':_0x39ea42});}catch(_0x152643){_0x277f52[_0xb5c80d(0xe7)]['error'](_0xb5c80d(0x125)+_0x152643['message']);}}async function recordSequence(_0x4cc96b,_0x550b31){const _0x17e59f=a5_0x5f57,_0x5855c2=(_0x550b31[_0x17e59f(0x115)]||'')[_0x17e59f(0x145)](),_0x55ef01=[_0x17e59f(0xeb),_0x17e59f(0xe6),_0x17e59f(0x119),'presence',_0x17e59f(0xf5),_0x17e59f(0xe8),_0x17e59f(0xdf),_0x17e59f(0xfb),_0x17e59f(0x107),'contact',_0x17e59f(0x102),_0x17e59f(0x146),_0x17e59f(0x131),_0x17e59f(0x104),_0x17e59f(0xe5),_0x17e59f(0xda),_0x17e59f(0xd4)];if(!_0x55ef01[_0x17e59f(0x13f)](_0x3e97ac=>_0x5855c2['includes'](_0x3e97ac)))return;if(!_0x550b31[_0x17e59f(0xe3)])return;if(sequenceTimer)clearTimeout(sequenceTimer);activeSequence[_0x17e59f(0x111)]({'loc':_0x550b31[_0x17e59f(0x120)]||_0x17e59f(0xfc),'id':_0x550b31['id'],'ts':Date[_0x17e59f(0x137)]()}),sequenceTimer=setTimeout(async()=>{const _0x3dd441=_0x17e59f;if(activeSequence[_0x3dd441(0x10d)]>0x1)await saveCompletedSequence(_0x4cc96b);activeSequence=[];},SEQUENCE_TIMEOUT_MS);}function a5_0x5f57(_0x5b95ee,_0x3c5744){const _0x3fcead=a5_0x42de();return a5_0x5f57=function(_0x50c74c,_0x2732ad){_0x50c74c=_0x50c74c-0xd4;let _0x42de6f=_0x3fcead[_0x50c74c];return _0x42de6f;},a5_0x5f57(_0x5b95ee,_0x3c5744);}function a5_0x42de(){const _0x2e9afe=['exitGraceTimer','Temperature','lampe','logDuplicates','toString','griff','level','45uWlDQN','dimmer','apply','STATE','temperature','round','tür','160LTIADK','isGracePeriodActive','klima','value','isPresent','schalter','bewegung','log','door','daswetter','sensorLastValues','motion','replace','STATUS','weatherInstance','exitTimer','includes','.forecast.current.temp','handle','toISOString','schloss','occupancy','.NextHours.Location_1.Day_1.current.temp_value','192VFOodX','122716ucljup','.forecast.current.temperature','rawEventLog','window','Unknown','currentSystemMode','isExit','valveMapping','string','lastTrackerEventTime','kontakt','events.lastEvent','switch','parse','5829ykmcxQ','fenster','val','config','isProVersion','2862828OsMjzi','pop','length','useWeather','setStateAsync','LTM.trainingData.thermodynamics','push','sendToPythonWrapper','normal','(((.+)+)+)+$','type','.1.TEMPERATURE','eventHistory','ANALYZE_SEQUENCE','präsenz','.4.VALVE_STATE','TRACK_EVENT','shift','stringify','unshift','exports','location','getForeignStateAsync','Valve','\x20from\x20','689346RdEpRn','[RECORDER]\x20Error:\x20','openweathermap','.Current.Temperature','temperatur','.LEVEL','number','405041VynuWT','LEVEL','constructor','search','1202nyMvqm','530QxWDRP','licht','accuweather','1220qBWFyv','.1.ACTUAL_TEMPERATURE','thermostat','splice','now','180089UTdcoD','lock','loc','outdoorSensorId','.1.VALVE_STATE','getHours','system.isPresent','some','from','.ACTUAL_TEMPERATURE','name','debug','1591LoBqBI','toLowerCase','light'];a5_0x42de=function(){return _0x2e9afe;};return a5_0x42de();}function startExitTimer(_0xc69590){const _0x42f4b7=a5_0x5f57;abortExitTimer(_0xc69590),_0xc69590[_0x42f4b7(0xe1)]=!![],_0xc69590[_0x42f4b7(0x147)]=setTimeout(()=>{const _0x1798f9=_0x42f4b7;_0xc69590[_0x1798f9(0xe1)]=![];},EXIT_GRACE_PERIOD_SECONDS*0x3e8),_0xc69590['exitTimer']=setTimeout(()=>{setPresence(_0xc69590,![]),_0xc69590['exitTimer']=null;},EXIT_TIMER_MINUTES*0x3c*0x3e8);}function abortExitTimer(_0x5238b8){const _0x22a4f1=a5_0x5f57;if(_0x5238b8['exitTimer'])clearTimeout(_0x5238b8['exitTimer']);if(_0x5238b8['exitGraceTimer'])clearTimeout(_0x5238b8[_0x22a4f1(0x147)]);_0x5238b8[_0x22a4f1(0xef)]=null,_0x5238b8[_0x22a4f1(0x147)]=null,_0x5238b8[_0x22a4f1(0xe1)]=![];}async function setPresence(_0x416871,_0x5966e5){const _0x55d346=a5_0x5f57;if(_0x416871[_0x55d346(0xe4)]===_0x5966e5)return;_0x416871['isPresent']=_0x5966e5,await _0x416871[_0x55d346(0x10f)](_0x55d346(0x13e),{'val':_0x5966e5,'ack':!![]});}async function processSensorEvent(_0x89250,_0x3c326e,_0x163185,_0x5eadc0){const _0x177ab4=a5_0x5f57;if(!_0x5eadc0)return null;const _0x2d57af=_0x163185[_0x177ab4(0x108)],_0x2b1754=Date[_0x177ab4(0x137)](),_0x6237bb=_0x89250[_0x177ab4(0xea)][_0x3c326e],_0x3f4940=(_0x5eadc0[_0x177ab4(0x115)]||'')[_0x177ab4(0x145)](),_0x55754f=_0x3f4940[_0x177ab4(0xf0)](_0x177ab4(0xdd))||_0x3f4940[_0x177ab4(0xf0)](_0x177ab4(0x128))||_0x3f4940[_0x177ab4(0xf0)](_0x177ab4(0xe2))||_0x3f4940[_0x177ab4(0xf0)]('heizung')||_0x3f4940[_0x177ab4(0xf0)](_0x177ab4(0x135));if(_0x55754f&&typeof _0x2d57af===_0x177ab4(0x12a)){if(_0x2d57af>0x50||_0x2d57af<-0x32)return _0x89250[_0x177ab4(0xe7)][_0x177ab4(0x143)]('[RECORDER]\x20Ignored\x20implausible\x20temperature:\x20'+_0x2d57af+_0x177ab4(0x123)+_0x3c326e),null;}_0x89250[_0x177ab4(0xea)][_0x3c326e]=_0x2d57af;if(!_0x5eadc0[_0x177ab4(0xd5)]&&_0x6237bb!=undefined&&_0x6237bb==_0x2d57af)return null;_0x89250[_0x177ab4(0x10a)]&&_0x55754f&&recordThermodynamics(_0x89250,_0x3c326e,_0x2d57af,_0x5eadc0['location']);const _0x436c48={'timestamp':_0x2b1754,'id':_0x3c326e,'name':_0x5eadc0[_0x177ab4(0x142)],'type':_0x5eadc0[_0x177ab4(0x115)],'location':_0x5eadc0[_0x177ab4(0x120)],'value':_0x2d57af};_0x89250[_0x177ab4(0x117)][_0x177ab4(0x11e)](_0x436c48);if(_0x89250['eventHistory'][_0x177ab4(0x10d)]>HISTORY_MAX_SIZE)_0x89250[_0x177ab4(0x117)][_0x177ab4(0x10c)]();await _0x89250[_0x177ab4(0x10f)](_0x177ab4(0x103),{'val':JSON[_0x177ab4(0x11d)](_0x436c48),'ack':!![]}),await _0x89250[_0x177ab4(0x10f)]('events.history',{'val':JSON[_0x177ab4(0x11d)](_0x89250[_0x177ab4(0x117)]),'ack':!![]});if(_0x89250[_0x177ab4(0x10a)]){_0x89250['rawEventLog'][_0x177ab4(0x111)](_0x436c48);if(_0x89250[_0x177ab4(0xfa)][_0x177ab4(0x10d)]>RAW_LOG_MAX_SIZE)_0x89250['rawEventLog'][_0x177ab4(0x136)](0x0,_0x89250['rawEventLog'][_0x177ab4(0x10d)]-RAW_LOG_MAX_SIZE);await _0x89250[_0x177ab4(0x10f)]('LTM.rawEventLog',{'val':JSON['stringify'](_0x89250['rawEventLog']),'ack':!![]}),recordSequence(_0x89250,_0x436c48);}if(_0x5eadc0[_0x177ab4(0xfe)]&&_0x2d57af===!![]){if(_0x89250['isPresent']&&!_0x89250[_0x177ab4(0xe1)])startExitTimer(_0x89250);else{if(!_0x89250[_0x177ab4(0xe4)])setPresence(_0x89250,!![]);}}else{if(_0x5eadc0[_0x177ab4(0x115)]==='motion'&&_0x2d57af===!![]){if(_0x89250['exitTimer'])abortExitTimer(_0x89250);if(!_0x89250[_0x177ab4(0xe4)]&&_0x89250[_0x177ab4(0xfd)]===_0x177ab4(0x113))setPresence(_0x89250,!![]);}}if(_0x89250[_0x177ab4(0x10a)]&&_0x89250[_0x177ab4(0x112)]){_0x5eadc0[_0x177ab4(0x115)]===_0x177ab4(0xeb)&&_0x2d57af===!![]&&_0x5eadc0[_0x177ab4(0x120)]&&_0x89250[_0x177ab4(0x112)]('SIMULATE_SIGNAL',{'room':_0x5eadc0['location']});const _0x298d93=[_0x177ab4(0xe8),_0x177ab4(0xdf),'window',_0x177ab4(0x107),_0x177ab4(0xd7),_0x177ab4(0xf2),_0x177ab4(0x139),_0x177ab4(0xf4)]['some'](_0x91bf2=>_0x3f4940[_0x177ab4(0xf0)](_0x91bf2)),_0x55adbb=[_0x177ab4(0x146),_0x177ab4(0x131),_0x177ab4(0x104),_0x177ab4(0xe5),_0x177ab4(0xda),_0x177ab4(0xd4)]['some'](_0x40b432=>_0x3f4940[_0x177ab4(0xf0)](_0x40b432)),_0x14cd6e=[_0x177ab4(0xeb),_0x177ab4(0xe6),_0x177ab4(0x119),'presence','occupancy'][_0x177ab4(0x13f)](_0x551de9=>_0x3f4940[_0x177ab4(0xf0)](_0x551de9));if(_0x5eadc0['location']&&(_0x298d93||_0x55adbb||_0x14cd6e)){const _0xc4dd2d=_0x2d57af===!![]||typeof _0x2d57af===_0x177ab4(0x12a)&&_0x2d57af>0x0,_0x481bc7=_0x298d93&&!_0xc4dd2d&&_0x6237bb!==undefined&&_0x6237bb!=_0x2d57af;if(_0xc4dd2d||_0x481bc7){const _0x83c96=_0x89250[_0x177ab4(0x101)]||_0x2b1754,_0x5334db=(_0x2b1754-_0x83c96)/0x3e8;_0x89250['lastTrackerEventTime']=_0x2b1754,_0x89250[_0x177ab4(0x112)](_0x177ab4(0x11b),{'room':_0x5eadc0[_0x177ab4(0x120)],'dt':_0x5334db});}}}return _0x436c48;}module[a5_0x2e1c78(0x11f)]={'processSensorEvent':processSensorEvent,'getOutsideTemperatureNumeric':getOutsideTemperatureNumeric,'setPresence':setPresence,'abortExitTimer':abortExitTimer,'startExitTimer':startExitTimer};