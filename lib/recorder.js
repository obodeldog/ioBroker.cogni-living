const a5_0x5d7984=a5_0x8804;function a5_0x1b5a(){const _0x1c445c=['isGracePeriodActive','daswetter','round','.1.VALVE_STATE','präsenz','138609pieUHr','lampe','467179OzLurC','7476270MZeSHB','SIMULATE_SIGNAL','eventHistory','32113464gDeUan','isExit','getStateAsync','presence','.ACTUAL_TEMPERATURE','4XUiYxh','events.lastEvent','config','670088gyzDiJ','kontakt','useWeather','setStateAsync','klima','49YlnlyT','LTM.trainingData.thermodynamics','schalter','logDuplicates','occupancy','val','[RECORDER]\x20Error:\x20','location','sensorLastValues','.NextHours.Location_1.Day_1.current.temp_value','fenster','.forecast.current.temperature','parse','length','tür','accuweather','system.isPresent','from','11CQHKdJ','stringify','includes','number','4180120yFGFqX','.4.VALVE_STATE','.1.LEVEL','sendToPythonWrapper','type','apply','contact','some','430LkdKvl','toString','currentSystemMode','847647kgaptP','name','.1.TEMPERATURE','exitGraceTimer','normal','temperature','exitTimer','getForeignStateAsync','.1.ACTUAL_TEMPERATURE','dimmer','weatherunderground','now','push','2lGeUOp','heizung','.Current.Temperature','isPresent','exports','weatherInstance','.forecast.current.temp','bewegung','message','rawEventLog','LTM.rawEventLog','events.history','window','Unknown','LTM.trainingData.sequences','log','openweathermap','search','shift','motion','hm-rpc','outdoorSensorId','isProVersion','ANALYZE_SEQUENCE','toLowerCase','.LEVEL','replace','(((.+)+)+)+$'];a5_0x1b5a=function(){return _0x1c445c;};return a5_0x1b5a();}(function(_0x47272e,_0xd7716c){const _0xd75999=a5_0x8804,_0x54890d=_0x47272e();while(!![]){try{const _0x39390d=-parseInt(_0xd75999(0x106))/0x1*(parseInt(_0xd75999(0x145))/0x2)+-parseInt(_0xd75999(0x138))/0x3*(-parseInt(_0xd75999(0x10f))/0x4)+parseInt(_0xd75999(0x12d))/0x5+-parseInt(_0xd75999(0x107))/0x6+parseInt(_0xd75999(0x117))/0x7*(-parseInt(_0xd75999(0x112))/0x8)+-parseInt(_0xd75999(0x166))/0x9*(parseInt(_0xd75999(0x135))/0xa)+-parseInt(_0xd75999(0x129))/0xb*(-parseInt(_0xd75999(0x10a))/0xc);if(_0x39390d===_0xd7716c)break;else _0x54890d['push'](_0x54890d['shift']());}catch(_0x3834b7){_0x54890d['push'](_0x54890d['shift']());}}}(a5_0x1b5a,0xcb585));const a5_0x17738b=(function(){let _0x53d13d=!![];return function(_0x423496,_0x36ae15){const _0x20b443=_0x53d13d?function(){const _0x3f8f5f=a5_0x8804;if(_0x36ae15){const _0x2f1f25=_0x36ae15[_0x3f8f5f(0x132)](_0x423496,arguments);return _0x36ae15=null,_0x2f1f25;}}:function(){};return _0x53d13d=![],_0x20b443;};}()),a5_0x1c0c42=a5_0x17738b(this,function(){const _0x2815ea=a5_0x8804;return a5_0x1c0c42[_0x2815ea(0x136)]()[_0x2815ea(0x156)]('(((.+)+)+)+$')['toString']()['constructor'](a5_0x1c0c42)['search'](_0x2815ea(0x160));});a5_0x1c0c42();'use strict';const HISTORY_MAX_SIZE=0x32,RAW_LOG_MAX_SIZE=0x9c4,THERMO_LOG_SIZE=0x3e8,SEQUENCE_TIMEOUT_MS=0x5*0x3c*0x3e8,MAX_TRAINING_SET_SIZE=0x1f4,EXIT_TIMER_MINUTES=0xf,EXIT_GRACE_PERIOD_SECONDS=0x1e;let activeSequence=[],sequenceTimer=null;function a5_0x8804(_0x3ce22a,_0x1df1bb){const _0x4bf8e7=a5_0x1b5a();return a5_0x8804=function(_0x1c0c42,_0x17738b){_0x1c0c42=_0x1c0c42-0x106;let _0x1b5aa6=_0x4bf8e7[_0x1c0c42];return _0x1b5aa6;},a5_0x8804(_0x3ce22a,_0x1df1bb);}async function getOutsideTemperatureNumeric(_0x18109b){const _0x225b33=a5_0x8804;if(_0x18109b['config'][_0x225b33(0x15a)])try{const _0x620443=await _0x18109b['getForeignStateAsync'](_0x18109b['config'][_0x225b33(0x15a)]);if(_0x620443&&_0x620443['val']!==undefined&&_0x620443[_0x225b33(0x11c)]!==null)return parseFloat(_0x620443['val']);}catch(_0x1540fa){}const _0x4de32c=_0x18109b[_0x225b33(0x111)][_0x225b33(0x14a)];if(!_0x18109b[_0x225b33(0x111)][_0x225b33(0x114)]||!_0x4de32c)return null;try{let _0x18be3a='';if(_0x4de32c['includes'](_0x225b33(0x126)))_0x18be3a=_0x4de32c+_0x225b33(0x147);else{if(_0x4de32c[_0x225b33(0x12b)](_0x225b33(0x162)))_0x18be3a=_0x4de32c+_0x225b33(0x120);else{if(_0x4de32c[_0x225b33(0x12b)](_0x225b33(0x155)))_0x18be3a=_0x4de32c+_0x225b33(0x122);else{if(_0x4de32c[_0x225b33(0x12b)](_0x225b33(0x142)))_0x18be3a=_0x4de32c+_0x225b33(0x14b);}}}if(_0x18be3a){const _0x3bdc04=await _0x18109b[_0x225b33(0x13f)](_0x18be3a);if(_0x3bdc04&&_0x3bdc04[_0x225b33(0x11c)]!==undefined&&_0x3bdc04[_0x225b33(0x11c)]!==null)return parseFloat(_0x3bdc04[_0x225b33(0x11c)]);}}catch(_0x295c3f){}return null;}async function recordThermodynamics(_0x463574,_0x35e001,_0x17cac8,_0x5d1c95){const _0x453100=a5_0x8804,_0x4ebbef=await getOutsideTemperatureNumeric(_0x463574);let _0x31c680=0x0;if(_0x35e001[_0x453100(0x12b)](_0x453100(0x159))){const _0x37fc54=[{'from':_0x453100(0x140),'to':_0x453100(0x12f)},{'from':_0x453100(0x140),'to':_0x453100(0x164)},{'from':_0x453100(0x13a),'to':_0x453100(0x12e)},{'from':_0x453100(0x10e),'to':_0x453100(0x15e)}];for(const _0x48f02f of _0x37fc54){if(_0x35e001[_0x453100(0x12b)](_0x48f02f[_0x453100(0x128)])){const _0x3b7868=_0x35e001[_0x453100(0x15f)](_0x48f02f['from'],_0x48f02f['to']);try{const _0x57c57c=await _0x463574[_0x453100(0x13f)](_0x3b7868);if(_0x57c57c&&_0x57c57c[_0x453100(0x11c)]!==null&&_0x57c57c[_0x453100(0x11c)]!==undefined){let _0x32bfe3=_0x57c57c[_0x453100(0x11c)];typeof _0x32bfe3===_0x453100(0x12c)&&_0x32bfe3<=1.05&&_0x48f02f['to'][_0x453100(0x12b)]('LEVEL')&&(_0x32bfe3=_0x32bfe3*0x64);_0x31c680=Math['round'](_0x32bfe3);break;}}catch(_0x296577){}}}}const _0x312a9f=await _0x463574['getStateAsync'](_0x453100(0x118));let _0x4b8d28=[];if(_0x312a9f&&_0x312a9f[_0x453100(0x11c)])try{_0x4b8d28=JSON[_0x453100(0x123)](_0x312a9f[_0x453100(0x11c)]);}catch(_0x2bbe4a){}_0x4b8d28[_0x453100(0x144)]({'ts':Date[_0x453100(0x143)](),'room':_0x5d1c95||_0x453100(0x152),'t_in':_0x17cac8,'t_out':_0x4ebbef,'valve':_0x31c680});if(_0x4b8d28[_0x453100(0x124)]>THERMO_LOG_SIZE)_0x4b8d28[_0x453100(0x157)]();await _0x463574[_0x453100(0x115)](_0x453100(0x118),{'val':JSON[_0x453100(0x12a)](_0x4b8d28),'ack':!![]});}async function saveCompletedSequence(_0x811cd3){const _0x5c2128=a5_0x8804;try{const _0x1851e8=await _0x811cd3[_0x5c2128(0x10c)](_0x5c2128(0x153));let _0x5a48ec=[];if(_0x1851e8&&_0x1851e8[_0x5c2128(0x11c)])try{_0x5a48ec=JSON[_0x5c2128(0x123)](_0x1851e8[_0x5c2128(0x11c)]);}catch(_0x541f1d){}const _0x31faa3=activeSequence[0x0]['ts'],_0x3cd924=activeSequence['map'](_0x3bc753=>({'loc':_0x3bc753['loc'],'t_delta':Math[_0x5c2128(0x163)]((_0x3bc753['ts']-_0x31faa3)/0x3e8)})),_0x3e290a={'timestamp':new Date(_0x31faa3)['toISOString'](),'steps':_0x3cd924,'duration':Math[_0x5c2128(0x163)]((activeSequence[activeSequence['length']-0x1]['ts']-_0x31faa3)/0x3e8),'daytime':new Date(_0x31faa3)['getHours']()};_0x5a48ec[_0x5c2128(0x144)](_0x3e290a);if(_0x5a48ec['length']>MAX_TRAINING_SET_SIZE)_0x5a48ec['shift']();await _0x811cd3[_0x5c2128(0x115)]('LTM.trainingData.sequences',{'val':JSON[_0x5c2128(0x12a)](_0x5a48ec),'ack':!![]}),_0x811cd3['isProVersion']&&_0x811cd3[_0x5c2128(0x130)]&&_0x811cd3[_0x5c2128(0x130)](_0x5c2128(0x15c),{'sequence':_0x3e290a});}catch(_0x21ea04){_0x811cd3[_0x5c2128(0x154)]['error'](_0x5c2128(0x11d)+_0x21ea04[_0x5c2128(0x14d)]);}}async function recordSequence(_0x408711,_0x45bcf2){const _0x1fe0c0=a5_0x8804,_0x2f2e1c=(_0x45bcf2[_0x1fe0c0(0x131)]||'')[_0x1fe0c0(0x15d)](),_0x57ceb1=['motion',_0x1fe0c0(0x14c),_0x1fe0c0(0x165),_0x1fe0c0(0x10d),_0x1fe0c0(0x11b),'door',_0x1fe0c0(0x125),_0x1fe0c0(0x151),_0x1fe0c0(0x121),_0x1fe0c0(0x133),_0x1fe0c0(0x113),'light','licht','switch',_0x1fe0c0(0x119),_0x1fe0c0(0x141),_0x1fe0c0(0x167)];if(!_0x57ceb1[_0x1fe0c0(0x134)](_0x5516f7=>_0x2f2e1c[_0x1fe0c0(0x12b)](_0x5516f7)))return;if(!_0x45bcf2['value'])return;if(sequenceTimer)clearTimeout(sequenceTimer);activeSequence[_0x1fe0c0(0x144)]({'loc':_0x45bcf2[_0x1fe0c0(0x11e)]||_0x1fe0c0(0x152),'id':_0x45bcf2['id'],'ts':Date[_0x1fe0c0(0x143)]()}),sequenceTimer=setTimeout(async()=>{if(activeSequence['length']>0x1)await saveCompletedSequence(_0x408711);activeSequence=[];},SEQUENCE_TIMEOUT_MS);}function startExitTimer(_0x4a89f7){const _0x18dd2f=a5_0x8804;abortExitTimer(_0x4a89f7),_0x4a89f7[_0x18dd2f(0x161)]=!![],_0x4a89f7[_0x18dd2f(0x13b)]=setTimeout(()=>{_0x4a89f7['isGracePeriodActive']=![];},EXIT_GRACE_PERIOD_SECONDS*0x3e8),_0x4a89f7['exitTimer']=setTimeout(()=>{const _0x469f78=_0x18dd2f;setPresence(_0x4a89f7,![]),_0x4a89f7[_0x469f78(0x13e)]=null;},EXIT_TIMER_MINUTES*0x3c*0x3e8);}function abortExitTimer(_0xc64259){const _0xe64eec=a5_0x8804;if(_0xc64259[_0xe64eec(0x13e)])clearTimeout(_0xc64259[_0xe64eec(0x13e)]);if(_0xc64259[_0xe64eec(0x13b)])clearTimeout(_0xc64259['exitGraceTimer']);_0xc64259[_0xe64eec(0x13e)]=null,_0xc64259[_0xe64eec(0x13b)]=null,_0xc64259[_0xe64eec(0x161)]=![];}async function setPresence(_0x551501,_0x38760d){const _0xc9efb8=a5_0x8804;if(_0x551501[_0xc9efb8(0x148)]===_0x38760d)return;_0x551501[_0xc9efb8(0x148)]=_0x38760d,await _0x551501[_0xc9efb8(0x115)](_0xc9efb8(0x127),{'val':_0x38760d,'ack':!![]});}async function processSensorEvent(_0x45e458,_0x214c70,_0x2b7f81,_0x5dbba1){const _0x41c82c=a5_0x8804;if(!_0x5dbba1)return null;const _0x6dee69=_0x2b7f81[_0x41c82c(0x11c)],_0x506873=Date[_0x41c82c(0x143)](),_0x39303b=_0x45e458[_0x41c82c(0x11f)][_0x214c70];_0x45e458[_0x41c82c(0x11f)][_0x214c70]=_0x6dee69;if(!_0x5dbba1[_0x41c82c(0x11a)]&&_0x39303b!=undefined&&_0x39303b==_0x6dee69)return null;const _0x47f479=(_0x5dbba1['type']||'')[_0x41c82c(0x15d)](),_0x17d9c8=_0x47f479[_0x41c82c(0x12b)](_0x41c82c(0x13d))||_0x47f479['includes']('temperatur')||_0x47f479['includes'](_0x41c82c(0x116))||_0x47f479[_0x41c82c(0x12b)](_0x41c82c(0x146));_0x45e458['isProVersion']&&_0x17d9c8&&recordThermodynamics(_0x45e458,_0x214c70,_0x6dee69,_0x5dbba1['location']);const _0x19c67b={'timestamp':_0x506873,'id':_0x214c70,'name':_0x5dbba1[_0x41c82c(0x139)],'type':_0x5dbba1[_0x41c82c(0x131)],'location':_0x5dbba1[_0x41c82c(0x11e)],'value':_0x6dee69};_0x45e458[_0x41c82c(0x109)]['unshift'](_0x19c67b);if(_0x45e458[_0x41c82c(0x109)][_0x41c82c(0x124)]>HISTORY_MAX_SIZE)_0x45e458[_0x41c82c(0x109)]['pop']();await _0x45e458[_0x41c82c(0x115)](_0x41c82c(0x110),{'val':JSON[_0x41c82c(0x12a)](_0x19c67b),'ack':!![]}),await _0x45e458[_0x41c82c(0x115)](_0x41c82c(0x150),{'val':JSON[_0x41c82c(0x12a)](_0x45e458[_0x41c82c(0x109)]),'ack':!![]});if(_0x45e458['isProVersion']){_0x45e458[_0x41c82c(0x14e)]['push'](_0x19c67b);if(_0x45e458[_0x41c82c(0x14e)][_0x41c82c(0x124)]>RAW_LOG_MAX_SIZE)_0x45e458[_0x41c82c(0x14e)]['splice'](0x0,_0x45e458['rawEventLog'][_0x41c82c(0x124)]-RAW_LOG_MAX_SIZE);await _0x45e458['setStateAsync'](_0x41c82c(0x14f),{'val':JSON[_0x41c82c(0x12a)](_0x45e458['rawEventLog']),'ack':!![]}),recordSequence(_0x45e458,_0x19c67b);}if(_0x5dbba1[_0x41c82c(0x10b)]&&_0x6dee69===!![]){if(_0x45e458[_0x41c82c(0x148)]&&!_0x45e458[_0x41c82c(0x161)])startExitTimer(_0x45e458);else{if(!_0x45e458['isPresent'])setPresence(_0x45e458,!![]);}}else{if(_0x5dbba1[_0x41c82c(0x131)]==='motion'&&_0x6dee69===!![]){if(_0x45e458[_0x41c82c(0x13e)])abortExitTimer(_0x45e458);if(!_0x45e458['isPresent']&&_0x45e458[_0x41c82c(0x137)]===_0x41c82c(0x13c))setPresence(_0x45e458,!![]);}}return _0x45e458[_0x41c82c(0x15b)]&&_0x5dbba1[_0x41c82c(0x131)]===_0x41c82c(0x158)&&_0x6dee69===!![]&&_0x5dbba1[_0x41c82c(0x11e)]&&_0x45e458[_0x41c82c(0x130)]&&_0x45e458[_0x41c82c(0x130)](_0x41c82c(0x108),{'room':_0x5dbba1['location']}),_0x19c67b;}module[a5_0x5d7984(0x149)]={'processSensorEvent':processSensorEvent,'getOutsideTemperatureNumeric':getOutsideTemperatureNumeric,'setPresence':setPresence,'abortExitTimer':abortExitTimer,'startExitTimer':startExitTimer};