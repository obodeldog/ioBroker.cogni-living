const a5_0x1a24ca=a5_0x1660;(function(_0x423973,_0x3b9f66){const _0xe520df=a5_0x1660,_0x5c7db8=_0x423973();while(!![]){try{const _0x4e20b7=-parseInt(_0xe520df(0x186))/0x1+parseInt(_0xe520df(0x1d7))/0x2*(parseInt(_0xe520df(0x1bf))/0x3)+parseInt(_0xe520df(0x18f))/0x4*(-parseInt(_0xe520df(0x1c6))/0x5)+-parseInt(_0xe520df(0x1ba))/0x6*(parseInt(_0xe520df(0x16f))/0x7)+-parseInt(_0xe520df(0x1a8))/0x8+parseInt(_0xe520df(0x1cf))/0x9+parseInt(_0xe520df(0x17b))/0xa*(parseInt(_0xe520df(0x1ab))/0xb);if(_0x4e20b7===_0x3b9f66)break;else _0x5c7db8['push'](_0x5c7db8['shift']());}catch(_0x348004){_0x5c7db8['push'](_0x5c7db8['shift']());}}}(a5_0x7aad,0x734c8));const a5_0x391b59=(function(){let _0x5e569d=!![];return function(_0x1a6370,_0x25a151){const _0x1542c2=_0x5e569d?function(){const _0x471c5f=a5_0x1660;if(_0x25a151){const _0x27b507=_0x25a151[_0x471c5f(0x187)](_0x1a6370,arguments);return _0x25a151=null,_0x27b507;}}:function(){};return _0x5e569d=![],_0x1542c2;};}()),a5_0x2fa3cc=a5_0x391b59(this,function(){const _0x45d847=a5_0x1660;return a5_0x2fa3cc[_0x45d847(0x19e)]()['search']('(((.+)+)+)+$')['toString']()[_0x45d847(0x1a7)](a5_0x2fa3cc)[_0x45d847(0x1aa)](_0x45d847(0x176));});a5_0x2fa3cc();function a5_0x7aad(){const _0x47b39a=['isExit','loc','8JtTeFN','Temperature','now','licht','dimmer','openweathermap','heizung','LTM.trainingData.thermodynamics','3136791WDvaiC','light','valveMapping','system.isPresent','map','eventHistory','type','(((.+)+)+)+$','Unknown','length','push','name','22871590KFOuRm','toISOString','.1.LEVEL','location','TRACK_EVENT','config','tür','pop','daswetter','contact','griff','778591YVcozq','apply','temperatur','isGracePeriodActive','.Current.Temperature','some','occupancy','LEVEL','getForeignStateAsync','1904Ewjiba','sendToPythonWrapper','motion','exports','round','stringify','SIMULATE_SIGNAL','kontakt','toLowerCase','lampe','.1.ACTUAL_TEMPERATURE','STATE','parse','replace','.forecast.current.temp','toString','.LEVEL','.forecast.current.temperature','val','LTM.trainingData.sequences','STATUS','number','rawEventLog','debug','constructor','11536CfQBzb','isProVersion','search','11ePsaaX','schloss','präsenz','weatherunderground','presence','shift','Valve','.NextHours.Location_1.Day_1.current.temp_value','useWeather','.ACTUAL_TEMPERATURE','fenster','error','isPresent','.1.TEMPERATURE','bewegung','12ybVFQu','level','door','logDuplicates','\x20from\x20','325065IqYXyU','setStateAsync','sensorLastValues','lock','switch','lastTrackerEventTime','outdoorSensorId','7195oYfatj','normal','from','[RECORDER]\x20Error:\x20','temperature','.1.VALVE_STATE','getStateAsync','message','exitTimer','1016172aTBBWQ','schalter','log','exitGraceTimer','includes','window'];a5_0x7aad=function(){return _0x47b39a;};return a5_0x7aad();}'use strict';const HISTORY_MAX_SIZE=0x32,RAW_LOG_MAX_SIZE=0x9c4,THERMO_LOG_SIZE=0x3e8,SEQUENCE_TIMEOUT_MS=0x5*0x3c*0x3e8,MAX_TRAINING_SET_SIZE=0x1f4,EXIT_TIMER_MINUTES=0xf,EXIT_GRACE_PERIOD_SECONDS=0x1e;let activeSequence=[],sequenceTimer=null;async function getOutsideTemperatureNumeric(_0x3f0aba){const _0x6c066c=a5_0x1660;if(_0x3f0aba[_0x6c066c(0x180)][_0x6c066c(0x1c5)])try{const _0x7541fa=await _0x3f0aba[_0x6c066c(0x18e)](_0x3f0aba[_0x6c066c(0x180)][_0x6c066c(0x1c5)]);if(_0x7541fa&&_0x7541fa[_0x6c066c(0x1a1)]!==undefined&&_0x7541fa['val']!==null)return parseFloat(_0x7541fa[_0x6c066c(0x1a1)]);}catch(_0x26e0d2){}const _0x54e260=_0x3f0aba[_0x6c066c(0x180)]['weatherInstance'];if(!_0x3f0aba[_0x6c066c(0x180)][_0x6c066c(0x1b3)]||!_0x54e260)return null;try{let _0x16954f='';if(_0x54e260[_0x6c066c(0x1d3)]('accuweather'))_0x16954f=_0x54e260+_0x6c066c(0x18a);else{if(_0x54e260[_0x6c066c(0x1d3)](_0x6c066c(0x183)))_0x16954f=_0x54e260+_0x6c066c(0x1b2);else{if(_0x54e260[_0x6c066c(0x1d3)](_0x6c066c(0x1dc)))_0x16954f=_0x54e260+_0x6c066c(0x1a0);else{if(_0x54e260[_0x6c066c(0x1d3)](_0x6c066c(0x1ae)))_0x16954f=_0x54e260+_0x6c066c(0x19d);}}}if(_0x16954f){const _0x3a4a4c=await _0x3f0aba[_0x6c066c(0x18e)](_0x16954f);if(_0x3a4a4c&&_0x3a4a4c['val']!==undefined&&_0x3a4a4c[_0x6c066c(0x1a1)]!==null)return parseFloat(_0x3a4a4c[_0x6c066c(0x1a1)]);}}catch(_0x395c5a){}return null;}async function recordThermodynamics(_0x82828a,_0x1a83ba,_0x3e05fd,_0x279ad1){const _0x3002e6=a5_0x1660,_0x55d507=await getOutsideTemperatureNumeric(_0x82828a);if(_0x55d507===null)return;let _0xcabf58=0x0,_0x570c71=![];if(_0x82828a[_0x3002e6(0x180)]['valveMapping'])try{let _0x4c6cc7=_0x82828a[_0x3002e6(0x180)][_0x3002e6(0x171)];if(typeof _0x4c6cc7==='string')_0x4c6cc7=JSON['parse'](_0x4c6cc7);if(_0x4c6cc7[_0x1a83ba]){const _0x3f109c=_0x4c6cc7[_0x1a83ba],_0xc7d369=await _0x82828a[_0x3002e6(0x18e)](_0x3f109c);if(_0xc7d369&&_0xc7d369[_0x3002e6(0x1a1)]!==null&&_0xc7d369['val']!==undefined){let _0x4ce460=Number(_0xc7d369[_0x3002e6(0x1a1)]);if(_0x4ce460<=1.05&&!_0x3f109c[_0x3002e6(0x1d3)](_0x3002e6(0x1a3))&&!_0x3f109c['includes'](_0x3002e6(0x19a)))_0x4ce460=_0x4ce460*0x64;_0xcabf58=Math[_0x3002e6(0x193)](_0x4ce460),_0x570c71=!![];}}}catch(_0x57fd4d){}if(!_0x570c71){const _0x334005=[{'from':_0x3002e6(0x199),'to':_0x3002e6(0x17d)},{'from':_0x3002e6(0x199),'to':_0x3002e6(0x1cb)},{'from':_0x3002e6(0x1b8),'to':'.4.VALVE_STATE'},{'from':_0x3002e6(0x1b4),'to':_0x3002e6(0x19f)},{'from':_0x3002e6(0x1ca),'to':_0x3002e6(0x1bb)},{'from':_0x3002e6(0x1d8),'to':_0x3002e6(0x1b1)}];for(const _0xb65c9a of _0x334005){if(_0x1a83ba[_0x3002e6(0x1d3)](_0xb65c9a[_0x3002e6(0x1c8)])){const _0x38bbc4=_0x1a83ba[_0x3002e6(0x19c)](_0xb65c9a['from'],_0xb65c9a['to']);try{const _0x1a9800=await _0x82828a['getForeignStateAsync'](_0x38bbc4);if(_0x1a9800&&_0x1a9800['val']!==null&&_0x1a9800[_0x3002e6(0x1a1)]!==undefined){let _0x285733=Number(_0x1a9800['val']);if(typeof _0x285733===_0x3002e6(0x1a4)){if(_0x285733<=1.05&&_0xb65c9a['to'][_0x3002e6(0x1d3)](_0x3002e6(0x18d)))_0x285733=_0x285733*0x64;_0xcabf58=Math[_0x3002e6(0x193)](_0x285733),_0x570c71=!![];break;}}}catch(_0x22351b){}}}}const _0xbad3a3=await _0x82828a[_0x3002e6(0x1cc)](_0x3002e6(0x16e));let _0x4157dc=[];if(_0xbad3a3&&_0xbad3a3[_0x3002e6(0x1a1)])try{_0x4157dc=JSON[_0x3002e6(0x19b)](_0xbad3a3['val']);}catch(_0xe32c45){}_0x4157dc[_0x3002e6(0x179)]({'ts':Date['now'](),'room':_0x279ad1||'Unknown','t_in':_0x3e05fd,'t_out':_0x55d507,'valve':_0xcabf58});if(_0x4157dc['length']>THERMO_LOG_SIZE)_0x4157dc[_0x3002e6(0x1b0)]();await _0x82828a[_0x3002e6(0x1c0)](_0x3002e6(0x16e),{'val':JSON[_0x3002e6(0x194)](_0x4157dc),'ack':!![]});}async function saveCompletedSequence(_0x4b35ee){const _0xbe0826=a5_0x1660;try{const _0x59caf3=await _0x4b35ee[_0xbe0826(0x1cc)](_0xbe0826(0x1a2));let _0x3a7887=[];if(_0x59caf3&&_0x59caf3['val'])try{_0x3a7887=JSON['parse'](_0x59caf3[_0xbe0826(0x1a1)]);}catch(_0x2ef076){}const _0xacef24=activeSequence[0x0]['ts'],_0x47986f=activeSequence[_0xbe0826(0x173)](_0x298a5d=>({'loc':_0x298a5d[_0xbe0826(0x1d6)],'t_delta':Math[_0xbe0826(0x193)]((_0x298a5d['ts']-_0xacef24)/0x3e8)})),_0x10608b={'timestamp':new Date(_0xacef24)[_0xbe0826(0x17c)](),'steps':_0x47986f,'duration':Math[_0xbe0826(0x193)]((activeSequence[activeSequence[_0xbe0826(0x178)]-0x1]['ts']-_0xacef24)/0x3e8),'daytime':new Date(_0xacef24)['getHours']()};_0x3a7887[_0xbe0826(0x179)](_0x10608b);if(_0x3a7887['length']>MAX_TRAINING_SET_SIZE)_0x3a7887[_0xbe0826(0x1b0)]();await _0x4b35ee['setStateAsync'](_0xbe0826(0x1a2),{'val':JSON['stringify'](_0x3a7887),'ack':!![]}),_0x4b35ee['isProVersion']&&_0x4b35ee[_0xbe0826(0x190)]&&_0x4b35ee[_0xbe0826(0x190)]('ANALYZE_SEQUENCE',{'sequence':_0x10608b});}catch(_0x3c7468){_0x4b35ee[_0xbe0826(0x1d1)][_0xbe0826(0x1b6)](_0xbe0826(0x1c9)+_0x3c7468[_0xbe0826(0x1cd)]);}}async function recordSequence(_0x4696e4,_0x283e0c){const _0x1c42c6=a5_0x1660,_0x14f980=(_0x283e0c[_0x1c42c6(0x175)]||'')[_0x1c42c6(0x197)](),_0x2483cb=['motion',_0x1c42c6(0x1b9),_0x1c42c6(0x1ad),'presence','occupancy',_0x1c42c6(0x1bc),_0x1c42c6(0x181),_0x1c42c6(0x1d4),_0x1c42c6(0x1b5),_0x1c42c6(0x184),_0x1c42c6(0x196),_0x1c42c6(0x170),_0x1c42c6(0x1da),_0x1c42c6(0x1c3),'schalter',_0x1c42c6(0x1db),_0x1c42c6(0x198)];if(!_0x2483cb[_0x1c42c6(0x18b)](_0x103d05=>_0x14f980['includes'](_0x103d05)))return;if(!_0x283e0c['value'])return;if(sequenceTimer)clearTimeout(sequenceTimer);activeSequence[_0x1c42c6(0x179)]({'loc':_0x283e0c[_0x1c42c6(0x17e)]||_0x1c42c6(0x177),'id':_0x283e0c['id'],'ts':Date[_0x1c42c6(0x1d9)]()}),sequenceTimer=setTimeout(async()=>{if(activeSequence['length']>0x1)await saveCompletedSequence(_0x4696e4);activeSequence=[];},SEQUENCE_TIMEOUT_MS);}function startExitTimer(_0x1f457f){const _0x39394e=a5_0x1660;abortExitTimer(_0x1f457f),_0x1f457f[_0x39394e(0x189)]=!![],_0x1f457f[_0x39394e(0x1d2)]=setTimeout(()=>{const _0xf6090a=_0x39394e;_0x1f457f[_0xf6090a(0x189)]=![];},EXIT_GRACE_PERIOD_SECONDS*0x3e8),_0x1f457f[_0x39394e(0x1ce)]=setTimeout(()=>{setPresence(_0x1f457f,![]),_0x1f457f['exitTimer']=null;},EXIT_TIMER_MINUTES*0x3c*0x3e8);}function abortExitTimer(_0xa4c316){const _0x1a6fb4=a5_0x1660;if(_0xa4c316[_0x1a6fb4(0x1ce)])clearTimeout(_0xa4c316['exitTimer']);if(_0xa4c316['exitGraceTimer'])clearTimeout(_0xa4c316[_0x1a6fb4(0x1d2)]);_0xa4c316['exitTimer']=null,_0xa4c316[_0x1a6fb4(0x1d2)]=null,_0xa4c316['isGracePeriodActive']=![];}async function setPresence(_0x3e3fd3,_0x32fca1){const _0xcf31a1=a5_0x1660;if(_0x3e3fd3[_0xcf31a1(0x1b7)]===_0x32fca1)return;_0x3e3fd3[_0xcf31a1(0x1b7)]=_0x32fca1,await _0x3e3fd3[_0xcf31a1(0x1c0)](_0xcf31a1(0x172),{'val':_0x32fca1,'ack':!![]});}function a5_0x1660(_0x3036fc,_0x1c0342){const _0x16ef74=a5_0x7aad();return a5_0x1660=function(_0x2fa3cc,_0x391b59){_0x2fa3cc=_0x2fa3cc-0x16d;let _0x7aad6=_0x16ef74[_0x2fa3cc];return _0x7aad6;},a5_0x1660(_0x3036fc,_0x1c0342);}async function processSensorEvent(_0x1edcc3,_0x5e5867,_0x223f39,_0x51749e){const _0x396b16=a5_0x1660;if(!_0x51749e)return null;const _0x38a6e2=_0x223f39['val'],_0x5e78cc=Date['now'](),_0x168c5c=_0x1edcc3[_0x396b16(0x1c1)][_0x5e5867],_0x4b7fcd=(_0x51749e[_0x396b16(0x175)]||'')['toLowerCase'](),_0x46517e=_0x4b7fcd['includes'](_0x396b16(0x1ca))||_0x4b7fcd[_0x396b16(0x1d3)](_0x396b16(0x188))||_0x4b7fcd[_0x396b16(0x1d3)]('klima')||_0x4b7fcd[_0x396b16(0x1d3)](_0x396b16(0x16d))||_0x4b7fcd[_0x396b16(0x1d3)]('thermostat');if(_0x46517e&&typeof _0x38a6e2===_0x396b16(0x1a4)){if(_0x38a6e2>0x50||_0x38a6e2<-0x32)return _0x1edcc3[_0x396b16(0x1d1)][_0x396b16(0x1a6)]('[RECORDER]\x20Ignored\x20implausible\x20temperature:\x20'+_0x38a6e2+_0x396b16(0x1be)+_0x5e5867),null;}_0x1edcc3[_0x396b16(0x1c1)][_0x5e5867]=_0x38a6e2;if(!_0x51749e[_0x396b16(0x1bd)]&&_0x168c5c!=undefined&&_0x168c5c==_0x38a6e2)return null;_0x1edcc3[_0x396b16(0x1a9)]&&_0x46517e&&recordThermodynamics(_0x1edcc3,_0x5e5867,_0x38a6e2,_0x51749e[_0x396b16(0x17e)]);const _0x28edb5={'timestamp':_0x5e78cc,'id':_0x5e5867,'name':_0x51749e[_0x396b16(0x17a)],'type':_0x51749e[_0x396b16(0x175)],'location':_0x51749e[_0x396b16(0x17e)],'value':_0x38a6e2};_0x1edcc3[_0x396b16(0x174)]['unshift'](_0x28edb5);if(_0x1edcc3[_0x396b16(0x174)]['length']>HISTORY_MAX_SIZE)_0x1edcc3[_0x396b16(0x174)][_0x396b16(0x182)]();await _0x1edcc3[_0x396b16(0x1c0)]('events.lastEvent',{'val':JSON[_0x396b16(0x194)](_0x28edb5),'ack':!![]}),await _0x1edcc3[_0x396b16(0x1c0)]('events.history',{'val':JSON[_0x396b16(0x194)](_0x1edcc3[_0x396b16(0x174)]),'ack':!![]});if(_0x1edcc3[_0x396b16(0x1a9)]){_0x1edcc3['rawEventLog'][_0x396b16(0x179)](_0x28edb5);if(_0x1edcc3[_0x396b16(0x1a5)][_0x396b16(0x178)]>RAW_LOG_MAX_SIZE)_0x1edcc3[_0x396b16(0x1a5)]['splice'](0x0,_0x1edcc3[_0x396b16(0x1a5)]['length']-RAW_LOG_MAX_SIZE);await _0x1edcc3['setStateAsync']('LTM.rawEventLog',{'val':JSON[_0x396b16(0x194)](_0x1edcc3['rawEventLog']),'ack':!![]}),recordSequence(_0x1edcc3,_0x28edb5);}if(_0x51749e[_0x396b16(0x1d5)]&&_0x38a6e2===!![]){if(_0x1edcc3[_0x396b16(0x1b7)]&&!_0x1edcc3[_0x396b16(0x189)])startExitTimer(_0x1edcc3);else{if(!_0x1edcc3[_0x396b16(0x1b7)])setPresence(_0x1edcc3,!![]);}}else{if(_0x51749e[_0x396b16(0x175)]===_0x396b16(0x191)&&_0x38a6e2===!![]){if(_0x1edcc3[_0x396b16(0x1ce)])abortExitTimer(_0x1edcc3);if(!_0x1edcc3[_0x396b16(0x1b7)]&&_0x1edcc3['currentSystemMode']===_0x396b16(0x1c7))setPresence(_0x1edcc3,!![]);}}if(_0x1edcc3[_0x396b16(0x1a9)]&&_0x1edcc3[_0x396b16(0x190)]){_0x51749e[_0x396b16(0x175)]===_0x396b16(0x191)&&_0x38a6e2===!![]&&_0x51749e['location']&&_0x1edcc3['sendToPythonWrapper'](_0x396b16(0x195),{'room':_0x51749e[_0x396b16(0x17e)]});const _0x2b5d43=[_0x396b16(0x1bc),'tür',_0x396b16(0x1d4),_0x396b16(0x1b5),_0x396b16(0x185),'handle',_0x396b16(0x1c2),_0x396b16(0x1ac)]['some'](_0x44ef06=>_0x4b7fcd[_0x396b16(0x1d3)](_0x44ef06)),_0x347c8c=['light',_0x396b16(0x1da),'switch',_0x396b16(0x1d0),_0x396b16(0x1db),'lampe']['some'](_0x1b1b56=>_0x4b7fcd[_0x396b16(0x1d3)](_0x1b1b56)),_0x35755d=['motion',_0x396b16(0x1b9),_0x396b16(0x1ad),_0x396b16(0x1af),_0x396b16(0x18c)][_0x396b16(0x18b)](_0x57f396=>_0x4b7fcd[_0x396b16(0x1d3)](_0x57f396));if(_0x51749e[_0x396b16(0x17e)]&&(_0x2b5d43||_0x347c8c||_0x35755d)){const _0x4d95d4=_0x38a6e2===!![]||typeof _0x38a6e2===_0x396b16(0x1a4)&&_0x38a6e2>0x0,_0x586457=_0x2b5d43&&!_0x4d95d4&&_0x168c5c!==undefined&&_0x168c5c!=_0x38a6e2;if(_0x4d95d4||_0x586457){const _0x5de4d4=_0x1edcc3[_0x396b16(0x1c4)]||_0x5e78cc,_0x2cd611=(_0x5e78cc-_0x5de4d4)/0x3e8;_0x1edcc3[_0x396b16(0x1c4)]=_0x5e78cc,_0x1edcc3[_0x396b16(0x190)](_0x396b16(0x17f),{'room':_0x51749e['location'],'dt':_0x2cd611});}}}return _0x28edb5;}module[a5_0x1a24ca(0x192)]={'processSensorEvent':processSensorEvent,'getOutsideTemperatureNumeric':getOutsideTemperatureNumeric,'setPresence':setPresence,'abortExitTimer':abortExitTimer,'startExitTimer':startExitTimer};