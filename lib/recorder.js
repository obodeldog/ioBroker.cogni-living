const a5_0x2fe2ba=a5_0x9db5;(function(_0x390c37,_0x15e936){const _0x452015=a5_0x9db5,_0x45a7db=_0x390c37();while(!![]){try{const _0x526641=-parseInt(_0x452015(0x15c))/0x1+parseInt(_0x452015(0x163))/0x2+parseInt(_0x452015(0x117))/0x3*(parseInt(_0x452015(0x132))/0x4)+parseInt(_0x452015(0x121))/0x5+-parseInt(_0x452015(0x15d))/0x6*(-parseInt(_0x452015(0x115))/0x7)+parseInt(_0x452015(0x113))/0x8*(parseInt(_0x452015(0xfa))/0x9)+-parseInt(_0x452015(0x11f))/0xa;if(_0x526641===_0x15e936)break;else _0x45a7db['push'](_0x45a7db['shift']());}catch(_0x13cd3f){_0x45a7db['push'](_0x45a7db['shift']());}}}(a5_0x4640,0x32a36));const a5_0x14ec95=(function(){let _0x355805=!![];return function(_0x5e140a,_0x471ee9){const _0x340d6e=_0x355805?function(){const _0xf76829=a5_0x9db5;if(_0x471ee9){const _0x2f5e32=_0x471ee9[_0xf76829(0x148)](_0x5e140a,arguments);return _0x471ee9=null,_0x2f5e32;}}:function(){};return _0x355805=![],_0x340d6e;};}()),a5_0x3da90f=a5_0x14ec95(this,function(){const _0x2f0d84=a5_0x9db5;return a5_0x3da90f[_0x2f0d84(0xfe)]()[_0x2f0d84(0x13d)]('(((.+)+)+)+$')[_0x2f0d84(0xfe)]()[_0x2f0d84(0x13c)](a5_0x3da90f)[_0x2f0d84(0x13d)](_0x2f0d84(0xfd));});a5_0x3da90f();'use strict';const HISTORY_MAX_SIZE=0x32,RAW_LOG_MAX_SIZE=0x9c4,THERMO_LOG_SIZE=0x3e8,SEQUENCE_TIMEOUT_MS=0x5*0x3c*0x3e8,MAX_TRAINING_SET_SIZE=0x1f4,EXIT_TIMER_MINUTES=0xf,EXIT_GRACE_PERIOD_SECONDS=0x1e;let activeSequence=[],sequenceTimer=null,dailyActivityLog=new Array(0x18)[a5_0x2fe2ba(0x10d)](0x0),lastLogDay=new Date()[a5_0x2fe2ba(0x143)]();function a5_0x9db5(_0x2675bb,_0x12b975){const _0xa7bf2c=a5_0x4640();return a5_0x9db5=function(_0x3da90f,_0x14ec95){_0x3da90f=_0x3da90f-0xf6;let _0x46409e=_0xa7bf2c[_0x3da90f];return _0x46409e;},a5_0x9db5(_0x2675bb,_0x12b975);}async function getOutsideTemperatureNumeric(_0x4f691b){const _0x2065f6=a5_0x2fe2ba;if(_0x4f691b[_0x2065f6(0x147)][_0x2065f6(0x158)])try{const _0x41ed60=await _0x4f691b[_0x2065f6(0x15e)](_0x4f691b['config'][_0x2065f6(0x158)]);if(_0x41ed60&&_0x41ed60[_0x2065f6(0x166)]!==undefined&&_0x41ed60['val']!==null)return parseFloat(_0x41ed60[_0x2065f6(0x166)]);}catch(_0x14b6e8){}const _0x3ea3b6=_0x4f691b[_0x2065f6(0x147)]['weatherInstance'];if(!_0x4f691b[_0x2065f6(0x147)][_0x2065f6(0x15b)]||!_0x3ea3b6)return null;try{let _0x4bc091='';if(_0x3ea3b6[_0x2065f6(0xfc)](_0x2065f6(0x153)))_0x4bc091=_0x3ea3b6+_0x2065f6(0xf9);else{if(_0x3ea3b6[_0x2065f6(0xfc)](_0x2065f6(0x162)))_0x4bc091=_0x3ea3b6+_0x2065f6(0x12b);else{if(_0x3ea3b6[_0x2065f6(0xfc)](_0x2065f6(0x11a)))_0x4bc091=_0x3ea3b6+_0x2065f6(0x137);else{if(_0x3ea3b6[_0x2065f6(0xfc)](_0x2065f6(0x134)))_0x4bc091=_0x3ea3b6+'.forecast.current.temp';}}}if(_0x4bc091){const _0x5bbd2d=await _0x4f691b[_0x2065f6(0x15e)](_0x4bc091);if(_0x5bbd2d&&_0x5bbd2d[_0x2065f6(0x166)]!==undefined&&_0x5bbd2d[_0x2065f6(0x166)]!==null)return parseFloat(_0x5bbd2d['val']);}}catch(_0x35c296){}return null;}async function recordThermodynamics(_0x9cbb75,_0x4bc7ce,_0x281140,_0x13b9db){const _0x40f040=a5_0x2fe2ba,_0x338431=await getOutsideTemperatureNumeric(_0x9cbb75);if(_0x338431===null)return;let _0x21fa74=0x0,_0x1087d4=![];if(_0x9cbb75['config']['valveMapping'])try{let _0xae4a75=_0x9cbb75['config'][_0x40f040(0x156)];if(typeof _0xae4a75==='string')_0xae4a75=JSON['parse'](_0xae4a75);if(_0xae4a75[_0x4bc7ce]){const _0x2617d9=_0xae4a75[_0x4bc7ce],_0x30c7da=await _0x9cbb75[_0x40f040(0x15e)](_0x2617d9);if(_0x30c7da&&_0x30c7da[_0x40f040(0x166)]!==null&&_0x30c7da['val']!==undefined){let _0x4a938c=Number(_0x30c7da['val']);if(_0x4a938c<=1.05&&!_0x2617d9[_0x40f040(0xfc)](_0x40f040(0x14e))&&!_0x2617d9[_0x40f040(0xfc)](_0x40f040(0x14f)))_0x4a938c=_0x4a938c*0x64;_0x21fa74=Math[_0x40f040(0x106)](_0x4a938c),_0x1087d4=!![];}}}catch(_0x1c27f0){}if(!_0x1087d4){const _0x55ef1c=[{'from':_0x40f040(0x11d),'to':_0x40f040(0x151)},{'from':_0x40f040(0x11d),'to':'.1.VALVE_STATE'},{'from':_0x40f040(0x149),'to':_0x40f040(0x130)},{'from':_0x40f040(0x145),'to':_0x40f040(0x10c)},{'from':_0x40f040(0x12e),'to':_0x40f040(0x160)},{'from':_0x40f040(0x161),'to':_0x40f040(0x133)}];for(const _0xf3b03e of _0x55ef1c){if(_0x4bc7ce[_0x40f040(0xfc)](_0xf3b03e[_0x40f040(0x12a)])){const _0x2bcaab=_0x4bc7ce[_0x40f040(0x108)](_0xf3b03e[_0x40f040(0x12a)],_0xf3b03e['to']);try{const _0x203183=await _0x9cbb75[_0x40f040(0x15e)](_0x2bcaab);if(_0x203183&&_0x203183[_0x40f040(0x166)]!==null&&_0x203183[_0x40f040(0x166)]!==undefined){let _0xf672aa=Number(_0x203183[_0x40f040(0x166)]);if(typeof _0xf672aa==='number'){if(_0xf672aa<=1.05&&_0xf3b03e['to'][_0x40f040(0xfc)](_0x40f040(0x112)))_0xf672aa=_0xf672aa*0x64;_0x21fa74=Math[_0x40f040(0x106)](_0xf672aa),_0x1087d4=!![];break;}}}catch(_0x437232){}}}}const _0x164152=await _0x9cbb75[_0x40f040(0x100)]('LTM.trainingData.thermodynamics');let _0x4ed2b6=[];if(_0x164152&&_0x164152[_0x40f040(0x166)])try{_0x4ed2b6=JSON[_0x40f040(0x102)](_0x164152[_0x40f040(0x166)]);}catch(_0x19f827){}_0x4ed2b6[_0x40f040(0x15f)]({'ts':Date['now'](),'room':_0x13b9db||'Unknown','t_in':_0x281140,'t_out':_0x338431,'valve':_0x21fa74});if(_0x4ed2b6[_0x40f040(0x101)]>THERMO_LOG_SIZE)_0x4ed2b6['shift']();await _0x9cbb75[_0x40f040(0x129)](_0x40f040(0x144),{'val':JSON[_0x40f040(0x124)](_0x4ed2b6),'ack':!![]});}async function saveCompletedSequence(_0x332f12){const _0x5ba119=a5_0x2fe2ba;try{const _0x14faae=await _0x332f12['getStateAsync'](_0x5ba119(0xf8));let _0x2c19b2=[];if(_0x14faae&&_0x14faae['val'])try{_0x2c19b2=JSON['parse'](_0x14faae['val']);}catch(_0x25bc84){}const _0xf23cb3=activeSequence[0x0]['ts'],_0x413c56=activeSequence[_0x5ba119(0x15a)](_0x257a4d=>({'loc':_0x257a4d[_0x5ba119(0x105)],'t_delta':Math[_0x5ba119(0x106)]((_0x257a4d['ts']-_0xf23cb3)/0x3e8)})),_0xc2b292={'timestamp':new Date(_0xf23cb3)['toISOString'](),'steps':_0x413c56,'duration':Math[_0x5ba119(0x106)]((activeSequence[activeSequence[_0x5ba119(0x101)]-0x1]['ts']-_0xf23cb3)/0x3e8),'daytime':new Date(_0xf23cb3)[_0x5ba119(0x10b)]()};_0x2c19b2['push'](_0xc2b292);if(_0x2c19b2['length']>MAX_TRAINING_SET_SIZE)_0x2c19b2[_0x5ba119(0xf7)]();await _0x332f12['setStateAsync']('LTM.trainingData.sequences',{'val':JSON[_0x5ba119(0x124)](_0x2c19b2),'ack':!![]}),_0x332f12[_0x5ba119(0x10e)]&&_0x332f12[_0x5ba119(0x14b)]&&_0x332f12[_0x5ba119(0x14b)](_0x5ba119(0x13e),{'sequence':_0xc2b292});}catch(_0x5bee6e){_0x332f12[_0x5ba119(0x152)]['error']('[RECORDER]\x20Error:\x20'+_0x5bee6e[_0x5ba119(0x142)]);}}async function recordSequence(_0x3bd36d,_0x316aec){const _0xde8a6d=a5_0x2fe2ba,_0x5a64a8=(_0x316aec[_0xde8a6d(0x122)]||'')[_0xde8a6d(0x146)](),_0x865532=['motion','bewegung',_0xde8a6d(0x110),_0xde8a6d(0x127),_0xde8a6d(0x111),_0xde8a6d(0x116),_0xde8a6d(0x14c),_0xde8a6d(0x103),_0xde8a6d(0x155),_0xde8a6d(0xf6),_0xde8a6d(0x125),_0xde8a6d(0x138),_0xde8a6d(0x164),_0xde8a6d(0x11e),_0xde8a6d(0xff),_0xde8a6d(0x139),_0xde8a6d(0x104)];if(!_0x865532[_0xde8a6d(0x12f)](_0x2b1246=>_0x5a64a8[_0xde8a6d(0xfc)](_0x2b1246)))return;if(!_0x316aec['value'])return;if(sequenceTimer)clearTimeout(sequenceTimer);activeSequence['push']({'loc':_0x316aec[_0xde8a6d(0x154)]||_0xde8a6d(0x140),'id':_0x316aec['id'],'ts':Date[_0xde8a6d(0x11c)]()}),sequenceTimer=setTimeout(async()=>{if(activeSequence['length']>0x1)await saveCompletedSequence(_0x3bd36d);activeSequence=[];},SEQUENCE_TIMEOUT_MS);}function a5_0x4640(){const _0xd5907a=['exitTimer','10171qzVUPI','door','51IujfRr','splice','isExit','openweathermap','exports','now','.1.ACTUAL_TEMPERATURE','switch','5623490EBgFhj','schloss','266885nxLAyT','type','motion','stringify','kontakt','bewegung','presence','LTM.rawEventLog','setStateAsync','from','.NextHours.Location_1.Day_1.current.temp_value','SIMULATE_SIGNAL','rawEventLog','temperature','some','.4.VALVE_STATE','klima','92924lMooZc','Valve','weatherunderground','pop','system.isPresent','.forecast.current.temperature','light','dimmer','sensorLastValues','isGracePeriodActive','constructor','search','ANALYZE_SEQUENCE','isPresent','Unknown','[RECORDER]\x20Ignored\x20implausible\x20temperature:\x20','message','getDate','LTM.trainingData.thermodynamics','.ACTUAL_TEMPERATURE','toLowerCase','config','apply','.1.TEMPERATURE','currentSystemMode','sendToPythonWrapper','tür','debug','STATUS','STATE','exitGraceTimer','.1.LEVEL','log','accuweather','location','fenster','valveMapping','eventHistory','outdoorSensorId','unshift','map','useWeather','364134mlLDsN','1488rggRcy','getForeignStateAsync','push','level','Temperature','daswetter','387406MfxWiK','licht','normal','val','logDuplicates','contact','shift','LTM.trainingData.sequences','.Current.Temperature','657kifbiy','number','includes','(((.+)+)+)+$','toString','schalter','getStateAsync','length','parse','window','lampe','loc','round','name','replace','\x20from\x20','lastTrackerEventTime','getHours','.LEVEL','fill','isProVersion','events.history','präsenz','occupancy','LEVEL','14416rmDqbi'];a5_0x4640=function(){return _0xd5907a;};return a5_0x4640();}function startExitTimer(_0xeedad7){const _0x2593b1=a5_0x2fe2ba;abortExitTimer(_0xeedad7),_0xeedad7['isGracePeriodActive']=!![],_0xeedad7[_0x2593b1(0x150)]=setTimeout(()=>{const _0x524fac=_0x2593b1;_0xeedad7[_0x524fac(0x13b)]=![];},EXIT_GRACE_PERIOD_SECONDS*0x3e8),_0xeedad7[_0x2593b1(0x114)]=setTimeout(()=>{const _0x440a8f=_0x2593b1;setPresence(_0xeedad7,![]),_0xeedad7[_0x440a8f(0x114)]=null;},EXIT_TIMER_MINUTES*0x3c*0x3e8);}function abortExitTimer(_0x2ba5b1){const _0x23f557=a5_0x2fe2ba;if(_0x2ba5b1[_0x23f557(0x114)])clearTimeout(_0x2ba5b1[_0x23f557(0x114)]);if(_0x2ba5b1[_0x23f557(0x150)])clearTimeout(_0x2ba5b1[_0x23f557(0x150)]);_0x2ba5b1[_0x23f557(0x114)]=null,_0x2ba5b1[_0x23f557(0x150)]=null,_0x2ba5b1[_0x23f557(0x13b)]=![];}async function setPresence(_0x4789a7,_0x5bb2da){const _0x24d056=a5_0x2fe2ba;if(_0x4789a7['isPresent']===_0x5bb2da)return;_0x4789a7[_0x24d056(0x13f)]=_0x5bb2da,await _0x4789a7[_0x24d056(0x129)](_0x24d056(0x136),{'val':_0x5bb2da,'ack':!![]});}async function updateHourlyActivity(_0x117283){const _0x1207a8=a5_0x2fe2ba,_0x4d90d5=new Date()['getDate']();_0x4d90d5!==lastLogDay&&(dailyActivityLog=new Array(0x18)[_0x1207a8(0x10d)](0x0),lastLogDay=_0x4d90d5);const _0x5694dd=new Date()['getHours']();if(dailyActivityLog[_0x5694dd]===undefined)dailyActivityLog[_0x5694dd]=0x0;dailyActivityLog[_0x5694dd]++,await _0x117283[_0x1207a8(0x129)]('analysis.health.todayVector',{'val':JSON[_0x1207a8(0x124)](dailyActivityLog),'ack':!![]});}async function processSensorEvent(_0xae07d4,_0x40642a,_0x7bb0db,_0x44f646){const _0x1adf15=a5_0x2fe2ba;if(!_0x44f646)return null;const _0x1cd986=_0x7bb0db[_0x1adf15(0x166)],_0x2d01cb=Date[_0x1adf15(0x11c)](),_0x5d7d62=_0xae07d4[_0x1adf15(0x13a)][_0x40642a],_0x50dc21=(_0x44f646[_0x1adf15(0x122)]||'')['toLowerCase'](),_0x3bf264=_0x50dc21['includes'](_0x1adf15(0x12e))||_0x50dc21[_0x1adf15(0xfc)]('temperatur')||_0x50dc21[_0x1adf15(0xfc)](_0x1adf15(0x131))||_0x50dc21[_0x1adf15(0xfc)]('heizung')||_0x50dc21[_0x1adf15(0xfc)]('thermostat');if(_0x3bf264&&typeof _0x1cd986===_0x1adf15(0xfb)){if(_0x1cd986>0x50||_0x1cd986<-0x32)return _0xae07d4[_0x1adf15(0x152)][_0x1adf15(0x14d)](_0x1adf15(0x141)+_0x1cd986+_0x1adf15(0x109)+_0x40642a),null;}_0xae07d4['sensorLastValues'][_0x40642a]=_0x1cd986;if(!_0x44f646[_0x1adf15(0x167)]&&_0x5d7d62!=undefined&&_0x5d7d62==_0x1cd986)return null;_0xae07d4['isProVersion']&&_0x3bf264&&recordThermodynamics(_0xae07d4,_0x40642a,_0x1cd986,_0x44f646['location']);const _0x4a21a0={'timestamp':_0x2d01cb,'id':_0x40642a,'name':_0x44f646[_0x1adf15(0x107)],'type':_0x44f646[_0x1adf15(0x122)],'location':_0x44f646['location'],'value':_0x1cd986};_0xae07d4[_0x1adf15(0x157)][_0x1adf15(0x159)](_0x4a21a0);if(_0xae07d4[_0x1adf15(0x157)][_0x1adf15(0x101)]>HISTORY_MAX_SIZE)_0xae07d4[_0x1adf15(0x157)][_0x1adf15(0x135)]();await _0xae07d4[_0x1adf15(0x129)]('events.lastEvent',{'val':JSON[_0x1adf15(0x124)](_0x4a21a0),'ack':!![]}),await _0xae07d4[_0x1adf15(0x129)](_0x1adf15(0x10f),{'val':JSON[_0x1adf15(0x124)](_0xae07d4[_0x1adf15(0x157)]),'ack':!![]}),await updateHourlyActivity(_0xae07d4);if(_0xae07d4[_0x1adf15(0x10e)]){_0xae07d4[_0x1adf15(0x12d)][_0x1adf15(0x15f)](_0x4a21a0);if(_0xae07d4[_0x1adf15(0x12d)][_0x1adf15(0x101)]>RAW_LOG_MAX_SIZE)_0xae07d4[_0x1adf15(0x12d)][_0x1adf15(0x118)](0x0,_0xae07d4[_0x1adf15(0x12d)][_0x1adf15(0x101)]-RAW_LOG_MAX_SIZE);await _0xae07d4['setStateAsync'](_0x1adf15(0x128),{'val':JSON['stringify'](_0xae07d4[_0x1adf15(0x12d)]),'ack':!![]}),recordSequence(_0xae07d4,_0x4a21a0);}if(_0x44f646[_0x1adf15(0x119)]&&_0x1cd986===!![]){if(_0xae07d4[_0x1adf15(0x13f)]&&!_0xae07d4[_0x1adf15(0x13b)])startExitTimer(_0xae07d4);else{if(!_0xae07d4[_0x1adf15(0x13f)])setPresence(_0xae07d4,!![]);}}else{if(_0x44f646['type']===_0x1adf15(0x123)&&_0x1cd986===!![]){if(_0xae07d4[_0x1adf15(0x114)])abortExitTimer(_0xae07d4);if(!_0xae07d4[_0x1adf15(0x13f)]&&_0xae07d4[_0x1adf15(0x14a)]===_0x1adf15(0x165))setPresence(_0xae07d4,!![]);}}if(_0xae07d4['isProVersion']&&_0xae07d4[_0x1adf15(0x14b)]){_0x44f646[_0x1adf15(0x122)]===_0x1adf15(0x123)&&_0x1cd986===!![]&&_0x44f646['location']&&_0xae07d4[_0x1adf15(0x14b)](_0x1adf15(0x12c),{'room':_0x44f646[_0x1adf15(0x154)]});const _0x2289b0=[_0x1adf15(0x116),_0x1adf15(0x14c),_0x1adf15(0x103),_0x1adf15(0x155),'griff','handle','lock',_0x1adf15(0x120)][_0x1adf15(0x12f)](_0x2d9c7e=>_0x50dc21[_0x1adf15(0xfc)](_0x2d9c7e)),_0x422c64=[_0x1adf15(0x138),_0x1adf15(0x164),_0x1adf15(0x11e),_0x1adf15(0xff),_0x1adf15(0x139),_0x1adf15(0x104)][_0x1adf15(0x12f)](_0x4e7921=>_0x50dc21[_0x1adf15(0xfc)](_0x4e7921)),_0x3ba042=[_0x1adf15(0x123),_0x1adf15(0x126),'präsenz',_0x1adf15(0x127),_0x1adf15(0x111)][_0x1adf15(0x12f)](_0xc85351=>_0x50dc21[_0x1adf15(0xfc)](_0xc85351));if(_0x44f646[_0x1adf15(0x154)]&&(_0x2289b0||_0x422c64||_0x3ba042)){const _0x1d0bad=_0x1cd986===!![]||typeof _0x1cd986===_0x1adf15(0xfb)&&_0x1cd986>0x0,_0x5bae52=_0x2289b0&&!_0x1d0bad&&_0x5d7d62!==undefined&&_0x5d7d62!=_0x1cd986;if(_0x1d0bad||_0x5bae52){const _0x17bf40=_0xae07d4['lastTrackerEventTime']||_0x2d01cb,_0x2cc055=(_0x2d01cb-_0x17bf40)/0x3e8;_0xae07d4[_0x1adf15(0x10a)]=_0x2d01cb,_0xae07d4['sendToPythonWrapper']('TRACK_EVENT',{'room':_0x44f646['location'],'dt':_0x2cc055});}}}return _0x4a21a0;}module[a5_0x2fe2ba(0x11b)]={'processSensorEvent':processSensorEvent,'getOutsideTemperatureNumeric':getOutsideTemperatureNumeric,'setPresence':setPresence,'abortExitTimer':abortExitTimer,'startExitTimer':startExitTimer};