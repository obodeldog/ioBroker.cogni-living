function a5_0x2077(_0x53d89a,_0x41dc52){const _0x9ea1c5=a5_0x48cf();return a5_0x2077=function(_0xff36fe,_0xa409){_0xff36fe=_0xff36fe-0x168;let _0x48cf3b=_0x9ea1c5[_0xff36fe];return _0x48cf3b;},a5_0x2077(_0x53d89a,_0x41dc52);}const a5_0x7b64a2=a5_0x2077;(function(_0x166eb9,_0x49016c){const _0x20b12a=a5_0x2077,_0x2b7c61=_0x166eb9();while(!![]){try{const _0x4b55cc=parseInt(_0x20b12a(0x1c7))/0x1+-parseInt(_0x20b12a(0x170))/0x2+-parseInt(_0x20b12a(0x173))/0x3*(parseInt(_0x20b12a(0x16f))/0x4)+parseInt(_0x20b12a(0x1b4))/0x5*(-parseInt(_0x20b12a(0x169))/0x6)+parseInt(_0x20b12a(0x185))/0x7*(-parseInt(_0x20b12a(0x19f))/0x8)+-parseInt(_0x20b12a(0x1d8))/0x9*(-parseInt(_0x20b12a(0x1c2))/0xa)+-parseInt(_0x20b12a(0x19b))/0xb*(-parseInt(_0x20b12a(0x184))/0xc);if(_0x4b55cc===_0x49016c)break;else _0x2b7c61['push'](_0x2b7c61['shift']());}catch(_0x2ec6c9){_0x2b7c61['push'](_0x2b7c61['shift']());}}}(a5_0x48cf,0x79892));const a5_0xa409=(function(){let _0x4c0b36=!![];return function(_0x50b008,_0x16e710){const _0x30cf14=_0x4c0b36?function(){if(_0x16e710){const _0x8ce08e=_0x16e710['apply'](_0x50b008,arguments);return _0x16e710=null,_0x8ce08e;}}:function(){};return _0x4c0b36=![],_0x30cf14;};}()),a5_0xff36fe=a5_0xa409(this,function(){const _0x4b182e=a5_0x2077;return a5_0xff36fe[_0x4b182e(0x16c)]()[_0x4b182e(0x1a6)](_0x4b182e(0x1b1))[_0x4b182e(0x16c)]()[_0x4b182e(0x18c)](a5_0xff36fe)[_0x4b182e(0x1a6)](_0x4b182e(0x1b1));});a5_0xff36fe();'use strict';const HISTORY_MAX_SIZE=0x32,RAW_LOG_MAX_SIZE=0x9c4,THERMO_LOG_SIZE=0x3e8,SEQUENCE_TIMEOUT_MS=0x5*0x3c*0x3e8,MAX_TRAINING_SET_SIZE=0x1f4,EXIT_TIMER_MINUTES=0xf,EXIT_GRACE_PERIOD_SECONDS=0x1e;let activeSequence=[],sequenceTimer=null;async function getOutsideTemperatureNumeric(_0x222d13){const _0xee495d=a5_0x2077;if(_0x222d13[_0xee495d(0x1cd)]['outdoorSensorId'])try{const _0x379c10=await _0x222d13[_0xee495d(0x175)](_0x222d13[_0xee495d(0x1cd)][_0xee495d(0x1a5)]);if(_0x379c10&&_0x379c10['val']!==undefined&&_0x379c10[_0xee495d(0x199)]!==null)return parseFloat(_0x379c10[_0xee495d(0x199)]);}catch(_0x8c9897){}const _0x20d054=_0x222d13[_0xee495d(0x1cd)][_0xee495d(0x191)];if(!_0x222d13[_0xee495d(0x1cd)]['useWeather']||!_0x20d054)return null;try{let _0x46b7af='';if(_0x20d054['includes'](_0xee495d(0x1dc)))_0x46b7af=_0x20d054+_0xee495d(0x17d);else{if(_0x20d054[_0xee495d(0x1c0)](_0xee495d(0x18e)))_0x46b7af=_0x20d054+_0xee495d(0x192);else{if(_0x20d054[_0xee495d(0x1c0)](_0xee495d(0x1bc)))_0x46b7af=_0x20d054+_0xee495d(0x17a);else{if(_0x20d054['includes'](_0xee495d(0x1cf)))_0x46b7af=_0x20d054+_0xee495d(0x1c8);}}}if(_0x46b7af){const _0x3ed750=await _0x222d13[_0xee495d(0x175)](_0x46b7af);if(_0x3ed750&&_0x3ed750[_0xee495d(0x199)]!==undefined&&_0x3ed750[_0xee495d(0x199)]!==null)return parseFloat(_0x3ed750[_0xee495d(0x199)]);}}catch(_0x1307ae){}return null;}async function recordThermodynamics(_0x521b6f,_0x564251,_0x3d55fa,_0x6b31bc){const _0x425508=a5_0x2077,_0x45ded9=await getOutsideTemperatureNumeric(_0x521b6f);if(_0x45ded9===null)return;let _0x7f8db3=0x0,_0x151692=![];if(_0x521b6f['config']['valveMapping'])try{let _0x4c2467=_0x521b6f[_0x425508(0x1cd)]['valveMapping'];if(typeof _0x4c2467===_0x425508(0x1a2))_0x4c2467=JSON[_0x425508(0x1c5)](_0x4c2467);if(_0x4c2467[_0x564251]){const _0x405d47=_0x4c2467[_0x564251],_0x1fc5ff=await _0x521b6f[_0x425508(0x175)](_0x405d47);if(_0x1fc5ff&&_0x1fc5ff[_0x425508(0x199)]!==null&&_0x1fc5ff[_0x425508(0x199)]!==undefined){let _0x3feb38=Number(_0x1fc5ff[_0x425508(0x199)]);if(_0x3feb38<=1.05&&!_0x405d47['includes'](_0x425508(0x177))&&!_0x405d47[_0x425508(0x1c0)]('STATE'))_0x3feb38=_0x3feb38*0x64;_0x7f8db3=Math[_0x425508(0x172)](_0x3feb38),_0x151692=!![];}}}catch(_0x39aa3d){}if(!_0x151692){const _0x22fd4d=[{'from':'.1.ACTUAL_TEMPERATURE','to':_0x425508(0x176)},{'from':_0x425508(0x1aa),'to':_0x425508(0x196)},{'from':'.1.TEMPERATURE','to':_0x425508(0x19d)},{'from':'.ACTUAL_TEMPERATURE','to':_0x425508(0x180)},{'from':_0x425508(0x181),'to':_0x425508(0x1a9)},{'from':_0x425508(0x1ae),'to':_0x425508(0x197)}];for(const _0x1d81fc of _0x22fd4d){if(_0x564251['includes'](_0x1d81fc[_0x425508(0x18a)])){const _0x248e10=_0x564251[_0x425508(0x1c4)](_0x1d81fc[_0x425508(0x18a)],_0x1d81fc['to']);try{const _0x5421e1=await _0x521b6f[_0x425508(0x175)](_0x248e10);if(_0x5421e1&&_0x5421e1['val']!==null&&_0x5421e1[_0x425508(0x199)]!==undefined){let _0x1071ca=Number(_0x5421e1['val']);if(typeof _0x1071ca==='number'){if(_0x1071ca<=1.05&&_0x1d81fc['to'][_0x425508(0x1c0)](_0x425508(0x1d6)))_0x1071ca=_0x1071ca*0x64;_0x7f8db3=Math[_0x425508(0x172)](_0x1071ca),_0x151692=!![];break;}}}catch(_0x3585a4){}}}}const _0x11934a=await _0x521b6f[_0x425508(0x16a)]('LTM.trainingData.thermodynamics');let _0x319d35=[];if(_0x11934a&&_0x11934a[_0x425508(0x199)])try{_0x319d35=JSON[_0x425508(0x1c5)](_0x11934a[_0x425508(0x199)]);}catch(_0x62f93d){}_0x319d35['push']({'ts':Date[_0x425508(0x1d5)](),'room':_0x6b31bc||_0x425508(0x18b),'t_in':_0x3d55fa,'t_out':_0x45ded9,'valve':_0x7f8db3});if(_0x319d35[_0x425508(0x1b0)]>THERMO_LOG_SIZE)_0x319d35[_0x425508(0x1bb)]();await _0x521b6f[_0x425508(0x1a1)]('LTM.trainingData.thermodynamics',{'val':JSON[_0x425508(0x1b8)](_0x319d35),'ack':!![]});}async function saveCompletedSequence(_0x58e933){const _0x588785=a5_0x2077;try{const _0x2e66b9=await _0x58e933[_0x588785(0x16a)]('LTM.trainingData.sequences');let _0x112496=[];if(_0x2e66b9&&_0x2e66b9[_0x588785(0x199)])try{_0x112496=JSON[_0x588785(0x1c5)](_0x2e66b9[_0x588785(0x199)]);}catch(_0x45897c){}const _0x90c176=activeSequence[0x0]['ts'],_0x9f2c52=activeSequence[_0x588785(0x17b)](_0x113ca6=>({'loc':_0x113ca6[_0x588785(0x1a0)],'t_delta':Math[_0x588785(0x172)]((_0x113ca6['ts']-_0x90c176)/0x3e8)})),_0x262e17={'timestamp':new Date(_0x90c176)[_0x588785(0x1ce)](),'steps':_0x9f2c52,'duration':Math[_0x588785(0x172)]((activeSequence[activeSequence['length']-0x1]['ts']-_0x90c176)/0x3e8),'daytime':new Date(_0x90c176)[_0x588785(0x1bd)]()};_0x112496[_0x588785(0x19c)](_0x262e17);if(_0x112496[_0x588785(0x1b0)]>MAX_TRAINING_SET_SIZE)_0x112496['shift']();await _0x58e933[_0x588785(0x1a1)](_0x588785(0x17c),{'val':JSON[_0x588785(0x1b8)](_0x112496),'ack':!![]}),_0x58e933[_0x588785(0x183)]&&_0x58e933[_0x588785(0x1de)]&&_0x58e933[_0x588785(0x1de)](_0x588785(0x1d3),{'sequence':_0x262e17});}catch(_0x4b245b){_0x58e933['log'][_0x588785(0x186)](_0x588785(0x1ac)+_0x4b245b[_0x588785(0x1c3)]);}}async function recordSequence(_0x2b8e9e,_0x2fafe2){const _0x576e79=a5_0x2077,_0x533d9e=(_0x2fafe2['type']||'')[_0x576e79(0x16e)](),_0x3810ea=[_0x576e79(0x190),_0x576e79(0x1b3),_0x576e79(0x1a4),'presence',_0x576e79(0x19e),_0x576e79(0x1c1),'tür','window',_0x576e79(0x1da),_0x576e79(0x18f),'kontakt',_0x576e79(0x198),_0x576e79(0x1a8),_0x576e79(0x1d2),_0x576e79(0x171),_0x576e79(0x17f),_0x576e79(0x1b6)];if(!_0x3810ea[_0x576e79(0x1b7)](_0x1a1c7e=>_0x533d9e[_0x576e79(0x1c0)](_0x1a1c7e)))return;if(!_0x2fafe2[_0x576e79(0x1c6)])return;if(sequenceTimer)clearTimeout(sequenceTimer);activeSequence['push']({'loc':_0x2fafe2[_0x576e79(0x168)]||_0x576e79(0x18b),'id':_0x2fafe2['id'],'ts':Date[_0x576e79(0x1d5)]()}),sequenceTimer=setTimeout(async()=>{const _0x561a9e=_0x576e79;if(activeSequence[_0x561a9e(0x1b0)]>0x1)await saveCompletedSequence(_0x2b8e9e);activeSequence=[];},SEQUENCE_TIMEOUT_MS);}function startExitTimer(_0x557609){const _0x502143=a5_0x2077;abortExitTimer(_0x557609),_0x557609['isGracePeriodActive']=!![],_0x557609[_0x502143(0x16b)]=setTimeout(()=>{const _0x77f404=_0x502143;_0x557609[_0x77f404(0x18d)]=![];},EXIT_GRACE_PERIOD_SECONDS*0x3e8),_0x557609[_0x502143(0x1d0)]=setTimeout(()=>{const _0x20a48f=_0x502143;setPresence(_0x557609,![]),_0x557609[_0x20a48f(0x1d0)]=null;},EXIT_TIMER_MINUTES*0x3c*0x3e8);}function abortExitTimer(_0x36664f){const _0x503322=a5_0x2077;if(_0x36664f[_0x503322(0x1d0)])clearTimeout(_0x36664f[_0x503322(0x1d0)]);if(_0x36664f[_0x503322(0x16b)])clearTimeout(_0x36664f[_0x503322(0x16b)]);_0x36664f[_0x503322(0x1d0)]=null,_0x36664f['exitGraceTimer']=null,_0x36664f[_0x503322(0x18d)]=![];}async function setPresence(_0x276a68,_0x8bf5f1){const _0x18ab66=a5_0x2077;if(_0x276a68['isPresent']===_0x8bf5f1)return;_0x276a68[_0x18ab66(0x1ba)]=_0x8bf5f1,await _0x276a68[_0x18ab66(0x1a1)]('system.isPresent',{'val':_0x8bf5f1,'ack':!![]});}function a5_0x48cf(){const _0x58e95f=['bewegung','125365zLnfpE','exports','lampe','some','stringify','griff','isPresent','shift','openweathermap','getHours','sensorLastValues','thermostat','includes','door','2627610JmEPSp','message','replace','parse','value','434329GRSiZa','.forecast.current.temp','events.history','heizung','normal','unshift','config','toISOString','weatherunderground','exitTimer','TRACK_EVENT','switch','ANALYZE_SEQUENCE','debug','now','LEVEL','type','9VoqSBQ','handle','fenster','LTM.rawEventLog','accuweather','presence','sendToPythonWrapper','location','66gyMEEm','getStateAsync','exitGraceTimer','toString','rawEventLog','toLowerCase','4odNMTj','1817586OnxZdh','schalter','round','834072SYJeRg','fill','getForeignStateAsync','.1.LEVEL','STATUS','temperatur','isExit','.forecast.current.temperature','map','LTM.trainingData.sequences','.Current.Temperature','klima','dimmer','.LEVEL','temperature','lock','isProVersion','30372DuVYMi','21yuzGRv','error','number','getDate','eventHistory','from','Unknown','constructor','isGracePeriodActive','daswetter','contact','motion','weatherInstance','.NextHours.Location_1.Day_1.current.temp_value','schloss','[RECORDER]\x20Ignored\x20implausible\x20temperature:\x20','events.lastEvent','.1.VALVE_STATE','Valve','light','val','\x20from\x20','9526IXDPmy','push','.4.VALVE_STATE','occupancy','2476016bgnacK','loc','setStateAsync','string','name','präsenz','outdoorSensorId','search','logDuplicates','licht','level','.1.ACTUAL_TEMPERATURE','window','[RECORDER]\x20Error:\x20','currentSystemMode','Temperature','lastTrackerEventTime','length','(((.+)+)+)+$','analysis.health.todayVector'];a5_0x48cf=function(){return _0x58e95f;};return a5_0x48cf();}async function updateHourlyActivity(_0x3e378d){const _0x12a0cb=a5_0x2077;let _0x538020=new Array(0x18)[_0x12a0cb(0x174)](0x0),_0x4c08b3=0x0;try{const _0x5d0122=await _0x3e378d[_0x12a0cb(0x16a)](_0x12a0cb(0x1b2));_0x5d0122&&_0x5d0122[_0x12a0cb(0x199)]&&(_0x538020=JSON[_0x12a0cb(0x1c5)](_0x5d0122['val']),_0x4c08b3=_0x5d0122['ts']);}catch(_0x31fa7b){}const _0x2e4992=new Date(_0x4c08b3),_0x530972=new Date();_0x2e4992[_0x12a0cb(0x188)]()!==_0x530972[_0x12a0cb(0x188)]()&&(_0x538020=new Array(0x18)[_0x12a0cb(0x174)](0x0));const _0x156eb2=_0x530972[_0x12a0cb(0x1bd)]();if(_0x538020[_0x156eb2]===undefined)_0x538020[_0x156eb2]=0x0;_0x538020[_0x156eb2]++,await _0x3e378d[_0x12a0cb(0x1a1)](_0x12a0cb(0x1b2),{'val':JSON[_0x12a0cb(0x1b8)](_0x538020),'ack':!![]});}async function processSensorEvent(_0x16d0c7,_0x84d1e4,_0x2d3382,_0x987142){const _0x575167=a5_0x2077;if(!_0x987142)return null;const _0x37cfb4=_0x2d3382[_0x575167(0x199)],_0x476c55=Date[_0x575167(0x1d5)](),_0x2cca68=_0x16d0c7[_0x575167(0x1be)][_0x84d1e4],_0x2adc09=(_0x987142[_0x575167(0x1d7)]||'')[_0x575167(0x16e)](),_0x5a0a74=_0x2adc09['includes'](_0x575167(0x181))||_0x2adc09['includes'](_0x575167(0x178))||_0x2adc09[_0x575167(0x1c0)](_0x575167(0x17e))||_0x2adc09['includes'](_0x575167(0x1ca))||_0x2adc09[_0x575167(0x1c0)](_0x575167(0x1bf));if(_0x5a0a74&&typeof _0x37cfb4==='number'){if(_0x37cfb4>0x50||_0x37cfb4<-0x32)return _0x16d0c7['log'][_0x575167(0x1d4)](_0x575167(0x194)+_0x37cfb4+_0x575167(0x19a)+_0x84d1e4),null;}_0x16d0c7['sensorLastValues'][_0x84d1e4]=_0x37cfb4;if(!_0x987142[_0x575167(0x1a7)]&&_0x2cca68!=undefined&&_0x2cca68==_0x37cfb4)return null;_0x16d0c7[_0x575167(0x183)]&&_0x5a0a74&&recordThermodynamics(_0x16d0c7,_0x84d1e4,_0x37cfb4,_0x987142['location']);const _0x549b1b={'timestamp':_0x476c55,'id':_0x84d1e4,'name':_0x987142[_0x575167(0x1a3)],'type':_0x987142[_0x575167(0x1d7)],'location':_0x987142[_0x575167(0x168)],'value':_0x37cfb4};_0x16d0c7[_0x575167(0x189)][_0x575167(0x1cc)](_0x549b1b);if(_0x16d0c7[_0x575167(0x189)][_0x575167(0x1b0)]>HISTORY_MAX_SIZE)_0x16d0c7[_0x575167(0x189)]['pop']();await _0x16d0c7['setStateAsync'](_0x575167(0x195),{'val':JSON[_0x575167(0x1b8)](_0x549b1b),'ack':!![]}),await _0x16d0c7[_0x575167(0x1a1)](_0x575167(0x1c9),{'val':JSON['stringify'](_0x16d0c7['eventHistory']),'ack':!![]}),await updateHourlyActivity(_0x16d0c7);if(_0x16d0c7[_0x575167(0x183)]){_0x16d0c7[_0x575167(0x16d)]['push'](_0x549b1b);if(_0x16d0c7[_0x575167(0x16d)][_0x575167(0x1b0)]>RAW_LOG_MAX_SIZE)_0x16d0c7['rawEventLog']['splice'](0x0,_0x16d0c7['rawEventLog'][_0x575167(0x1b0)]-RAW_LOG_MAX_SIZE);await _0x16d0c7[_0x575167(0x1a1)](_0x575167(0x1db),{'val':JSON['stringify'](_0x16d0c7['rawEventLog']),'ack':!![]}),recordSequence(_0x16d0c7,_0x549b1b);}if(_0x987142[_0x575167(0x179)]&&_0x37cfb4===!![]){if(_0x16d0c7[_0x575167(0x1ba)]&&!_0x16d0c7['isGracePeriodActive'])startExitTimer(_0x16d0c7);else{if(!_0x16d0c7[_0x575167(0x1ba)])setPresence(_0x16d0c7,!![]);}}else{if(_0x987142[_0x575167(0x1d7)]===_0x575167(0x190)&&_0x37cfb4===!![]){if(_0x16d0c7[_0x575167(0x1d0)])abortExitTimer(_0x16d0c7);if(!_0x16d0c7[_0x575167(0x1ba)]&&_0x16d0c7[_0x575167(0x1ad)]===_0x575167(0x1cb))setPresence(_0x16d0c7,!![]);}}if(_0x16d0c7[_0x575167(0x183)]&&_0x16d0c7[_0x575167(0x1de)]){_0x987142[_0x575167(0x1d7)]===_0x575167(0x190)&&_0x37cfb4===!![]&&_0x987142[_0x575167(0x168)]&&_0x16d0c7[_0x575167(0x1de)]('SIMULATE_SIGNAL',{'room':_0x987142['location']});const _0x2246e9=['door','tür',_0x575167(0x1ab),'fenster',_0x575167(0x1b9),_0x575167(0x1d9),_0x575167(0x182),_0x575167(0x193)]['some'](_0x55c7b9=>_0x2adc09[_0x575167(0x1c0)](_0x55c7b9)),_0x3335f1=[_0x575167(0x198),_0x575167(0x1a8),'switch',_0x575167(0x171),_0x575167(0x17f),_0x575167(0x1b6)][_0x575167(0x1b7)](_0xe7afae=>_0x2adc09['includes'](_0xe7afae)),_0x4e189d=[_0x575167(0x190),_0x575167(0x1b3),_0x575167(0x1a4),_0x575167(0x1dd),'occupancy'][_0x575167(0x1b7)](_0xa3abb5=>_0x2adc09[_0x575167(0x1c0)](_0xa3abb5));if(_0x987142['location']&&(_0x2246e9||_0x3335f1||_0x4e189d)){const _0x4ae3a0=_0x37cfb4===!![]||typeof _0x37cfb4===_0x575167(0x187)&&_0x37cfb4>0x0,_0x3e5efc=_0x2246e9&&!_0x4ae3a0&&_0x2cca68!==undefined&&_0x2cca68!=_0x37cfb4;if(_0x4ae3a0||_0x3e5efc){const _0x12c139=_0x16d0c7[_0x575167(0x1af)]||_0x476c55,_0x1fd0ec=(_0x476c55-_0x12c139)/0x3e8;_0x16d0c7['lastTrackerEventTime']=_0x476c55,_0x16d0c7['sendToPythonWrapper'](_0x575167(0x1d1),{'room':_0x987142['location'],'dt':_0x1fd0ec});}}}return _0x549b1b;}module[a5_0x7b64a2(0x1b5)]={'processSensorEvent':processSensorEvent,'getOutsideTemperatureNumeric':getOutsideTemperatureNumeric,'setPresence':setPresence,'abortExitTimer':abortExitTimer,'startExitTimer':startExitTimer};