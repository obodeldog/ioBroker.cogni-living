(function(_0xaf4bb4,_0x334582){const _0xc267ca=a5_0x2485,_0xd0be9e=_0xaf4bb4();while(!![]){try{const _0x3868e8=parseInt(_0xc267ca(0x1f3))/0x1*(-parseInt(_0xc267ca(0x209))/0x2)+-parseInt(_0xc267ca(0x1b2))/0x3+-parseInt(_0xc267ca(0x1b6))/0x4*(-parseInt(_0xc267ca(0x1bf))/0x5)+parseInt(_0xc267ca(0x1cf))/0x6*(parseInt(_0xc267ca(0x1f2))/0x7)+parseInt(_0xc267ca(0x202))/0x8+parseInt(_0xc267ca(0x1e5))/0x9*(-parseInt(_0xc267ca(0x1fe))/0xa)+parseInt(_0xc267ca(0x1c4))/0xb*(parseInt(_0xc267ca(0x1bb))/0xc);if(_0x3868e8===_0x334582)break;else _0xd0be9e['push'](_0xd0be9e['shift']());}catch(_0x2b1510){_0xd0be9e['push'](_0xd0be9e['shift']());}}}(a5_0x2eac,0xbca93));const a5_0x4d985b=(function(){let _0x3e2df0=!![];return function(_0x57a823,_0x4f0329){const _0x485878=_0x3e2df0?function(){const _0x115d93=a5_0x2485;if(_0x4f0329){const _0x3ea82f=_0x4f0329[_0x115d93(0x1b4)](_0x57a823,arguments);return _0x4f0329=null,_0x3ea82f;}}:function(){};return _0x3e2df0=![],_0x485878;};}()),a5_0x2f28cc=a5_0x4d985b(this,function(){const _0x22c636=a5_0x2485;return a5_0x2f28cc[_0x22c636(0x1a4)]()[_0x22c636(0x1f7)](_0x22c636(0x1aa))[_0x22c636(0x1a4)]()[_0x22c636(0x1a6)](a5_0x2f28cc)[_0x22c636(0x1f7)](_0x22c636(0x1aa));});function a5_0x2eac(){const _0x4173c0=['30065064qhYRvV','motion','map','replace','85zDdaHh','rawEventLog','stringify','occupancy','[RECORDER]\x20Error:\x20','11ldGIPP','dimmer','outdoorSensorId','.1.LEVEL','accuweather','.forecast.current.temperature','setStateAsync','bewegung','exitGraceTimer','door','sensorLastValues','65196cLuMfk','pr채senz','kontakt','STATE','.ACTUAL_TEMPERATURE','.Current.Temperature','pop','switch','.4.VALVE_STATE','STATUS','\x20from\x20','LTM.trainingData.sequences','schalter','loc','number','light','sendToPythonWrapper','fill','log','val','contact','some','5256kuZzAt','licht','schloss','getDate','griff','from','.1.VALVE_STATE','fenster','.NextHours.Location_1.Day_1.current.temp_value','error','debug','t체r','now','35FlhGHa','12kMQfKj','isGracePeriodActive','Unknown','events.lastEvent','search','isPresent','getStateAsync','name','events.history','presence','getHours','18220mUCSuY','temperatur','temperature','.LEVEL','4155360siaHRg','logDuplicates','valveMapping','toLowerCase','openweathermap','analysis.health.todayVector','ANALYZE_SEQUENCE','239580xospDE','useWeather','system.isPresent','window','weatherunderground','getForeignStateAsync','weatherInstance','splice','push','type','location','isProVersion','config','parse','LTM.rawEventLog','shift','toString','eventHistory','constructor','.1.ACTUAL_TEMPERATURE','lastTrackerEventTime','includes','(((.+)+)+)+$','klima','message','lock','length','LEVEL','heizung','normal','72108GHVldh','lampe','apply','handle','51564TSwJRC','round','exitTimer','value','SIMULATE_SIGNAL'];a5_0x2eac=function(){return _0x4173c0;};return a5_0x2eac();}a5_0x2f28cc();'use strict';const HISTORY_MAX_SIZE=0x32,RAW_LOG_MAX_SIZE=0x9c4,THERMO_LOG_SIZE=0x3e8,SEQUENCE_TIMEOUT_MS=0x5*0x3c*0x3e8,MAX_TRAINING_SET_SIZE=0x1f4,EXIT_TIMER_MINUTES=0xf,EXIT_GRACE_PERIOD_SECONDS=0x1e;let activeSequence=[],sequenceTimer=null;async function getOutsideTemperatureNumeric(_0x413868){const _0x29c10b=a5_0x2485;if(_0x413868['config'][_0x29c10b(0x1c6)])try{const _0xa7458=await _0x413868[_0x29c10b(0x199)](_0x413868[_0x29c10b(0x1a0)]['outdoorSensorId']);if(_0xa7458&&_0xa7458[_0x29c10b(0x1e2)]!==undefined&&_0xa7458[_0x29c10b(0x1e2)]!==null)return parseFloat(_0xa7458[_0x29c10b(0x1e2)]);}catch(_0x55c3db){}const _0x5156a1=_0x413868[_0x29c10b(0x1a0)][_0x29c10b(0x19a)];if(!_0x413868[_0x29c10b(0x1a0)][_0x29c10b(0x20a)]||!_0x5156a1)return null;try{let _0x2cbe9f='';if(_0x5156a1[_0x29c10b(0x1a9)](_0x29c10b(0x1c8)))_0x2cbe9f=_0x5156a1+_0x29c10b(0x1d4);else{if(_0x5156a1[_0x29c10b(0x1a9)]('daswetter'))_0x2cbe9f=_0x5156a1+_0x29c10b(0x1ed);else{if(_0x5156a1['includes'](_0x29c10b(0x206)))_0x2cbe9f=_0x5156a1+_0x29c10b(0x1c9);else{if(_0x5156a1[_0x29c10b(0x1a9)](_0x29c10b(0x198)))_0x2cbe9f=_0x5156a1+'.forecast.current.temp';}}}if(_0x2cbe9f){const _0x1d04ab=await _0x413868[_0x29c10b(0x199)](_0x2cbe9f);if(_0x1d04ab&&_0x1d04ab['val']!==undefined&&_0x1d04ab[_0x29c10b(0x1e2)]!==null)return parseFloat(_0x1d04ab[_0x29c10b(0x1e2)]);}}catch(_0x33ac41){}return null;}async function recordThermodynamics(_0x238395,_0x118a54,_0x5508ef,_0x22a06c){const _0x4375a6=a5_0x2485,_0x1f8aba=await getOutsideTemperatureNumeric(_0x238395);if(_0x1f8aba===null)return;let _0x2c6044=0x0,_0x28a1fc=![];if(_0x238395['config']['valveMapping'])try{let _0x458952=_0x238395[_0x4375a6(0x1a0)][_0x4375a6(0x204)];if(typeof _0x458952==='string')_0x458952=JSON[_0x4375a6(0x1a1)](_0x458952);if(_0x458952[_0x118a54]){const _0x5f27f0=_0x458952[_0x118a54],_0x73de47=await _0x238395[_0x4375a6(0x199)](_0x5f27f0);if(_0x73de47&&_0x73de47[_0x4375a6(0x1e2)]!==null&&_0x73de47[_0x4375a6(0x1e2)]!==undefined){let _0x54a918=Number(_0x73de47[_0x4375a6(0x1e2)]);if(_0x54a918<=1.05&&!_0x5f27f0[_0x4375a6(0x1a9)](_0x4375a6(0x1d8))&&!_0x5f27f0['includes'](_0x4375a6(0x1d2)))_0x54a918=_0x54a918*0x64;_0x2c6044=Math[_0x4375a6(0x1b7)](_0x54a918),_0x28a1fc=!![];}}}catch(_0x5e7ee0){}if(!_0x28a1fc){const _0x5634bc=[{'from':'.1.ACTUAL_TEMPERATURE','to':_0x4375a6(0x1c7)},{'from':_0x4375a6(0x1a7),'to':_0x4375a6(0x1eb)},{'from':'.1.TEMPERATURE','to':_0x4375a6(0x1d7)},{'from':_0x4375a6(0x1d3),'to':_0x4375a6(0x201)},{'from':'temperature','to':'level'},{'from':'Temperature','to':'Valve'}];for(const _0x128b27 of _0x5634bc){if(_0x118a54[_0x4375a6(0x1a9)](_0x128b27[_0x4375a6(0x1ea)])){const _0x3dcc7b=_0x118a54[_0x4375a6(0x1be)](_0x128b27[_0x4375a6(0x1ea)],_0x128b27['to']);try{const _0x2486b2=await _0x238395['getForeignStateAsync'](_0x3dcc7b);if(_0x2486b2&&_0x2486b2['val']!==null&&_0x2486b2['val']!==undefined){let _0x2aface=Number(_0x2486b2[_0x4375a6(0x1e2)]);if(typeof _0x2aface===_0x4375a6(0x1dd)){if(_0x2aface<=1.05&&_0x128b27['to'][_0x4375a6(0x1a9)](_0x4375a6(0x1af)))_0x2aface=_0x2aface*0x64;_0x2c6044=Math['round'](_0x2aface),_0x28a1fc=!![];break;}}}catch(_0x382c27){}}}}const _0x524caf=await _0x238395[_0x4375a6(0x1f9)]('LTM.trainingData.thermodynamics');let _0x3fc5d1=[];if(_0x524caf&&_0x524caf['val'])try{_0x3fc5d1=JSON[_0x4375a6(0x1a1)](_0x524caf['val']);}catch(_0x2aba4d){}_0x3fc5d1['push']({'ts':Date[_0x4375a6(0x1f1)](),'room':_0x22a06c||_0x4375a6(0x1f5),'t_in':_0x5508ef,'t_out':_0x1f8aba,'valve':_0x2c6044});if(_0x3fc5d1[_0x4375a6(0x1ae)]>THERMO_LOG_SIZE)_0x3fc5d1[_0x4375a6(0x1a3)]();await _0x238395[_0x4375a6(0x1ca)]('LTM.trainingData.thermodynamics',{'val':JSON[_0x4375a6(0x1c1)](_0x3fc5d1),'ack':!![]});}async function saveCompletedSequence(_0x56d314){const _0x4ee50e=a5_0x2485;try{const _0x4f5e1d=await _0x56d314[_0x4ee50e(0x1f9)]('LTM.trainingData.sequences');let _0x278610=[];if(_0x4f5e1d&&_0x4f5e1d[_0x4ee50e(0x1e2)])try{_0x278610=JSON['parse'](_0x4f5e1d[_0x4ee50e(0x1e2)]);}catch(_0x366c6b){}const _0x1a978e=activeSequence[0x0]['ts'],_0x1ef6a6=activeSequence[_0x4ee50e(0x1bd)](_0x35b7a8=>({'loc':_0x35b7a8[_0x4ee50e(0x1dc)],'t_delta':Math[_0x4ee50e(0x1b7)]((_0x35b7a8['ts']-_0x1a978e)/0x3e8)})),_0x39b5fc={'timestamp':new Date(_0x1a978e)['toISOString'](),'steps':_0x1ef6a6,'duration':Math[_0x4ee50e(0x1b7)]((activeSequence[activeSequence[_0x4ee50e(0x1ae)]-0x1]['ts']-_0x1a978e)/0x3e8),'daytime':new Date(_0x1a978e)['getHours']()};_0x278610[_0x4ee50e(0x19c)](_0x39b5fc);if(_0x278610[_0x4ee50e(0x1ae)]>MAX_TRAINING_SET_SIZE)_0x278610[_0x4ee50e(0x1a3)]();await _0x56d314[_0x4ee50e(0x1ca)](_0x4ee50e(0x1da),{'val':JSON[_0x4ee50e(0x1c1)](_0x278610),'ack':!![]}),_0x56d314[_0x4ee50e(0x19f)]&&_0x56d314[_0x4ee50e(0x1df)]&&_0x56d314['sendToPythonWrapper'](_0x4ee50e(0x208),{'sequence':_0x39b5fc});}catch(_0x1dcb79){_0x56d314[_0x4ee50e(0x1e1)][_0x4ee50e(0x1ee)](_0x4ee50e(0x1c3)+_0x1dcb79[_0x4ee50e(0x1ac)]);}}async function recordSequence(_0x1a877e,_0x4d7569){const _0x2cb104=a5_0x2485,_0x36b00d=(_0x4d7569[_0x2cb104(0x19d)]||'')[_0x2cb104(0x205)](),_0x1b56ee=[_0x2cb104(0x1bc),_0x2cb104(0x1cb),_0x2cb104(0x1d0),_0x2cb104(0x1fc),_0x2cb104(0x1c2),_0x2cb104(0x1cd),_0x2cb104(0x1f0),_0x2cb104(0x197),_0x2cb104(0x1ec),_0x2cb104(0x1e3),_0x2cb104(0x1d1),_0x2cb104(0x1de),'licht','switch',_0x2cb104(0x1db),_0x2cb104(0x1c5),_0x2cb104(0x1b3)];if(!_0x1b56ee[_0x2cb104(0x1e4)](_0x42d329=>_0x36b00d[_0x2cb104(0x1a9)](_0x42d329)))return;if(!_0x4d7569[_0x2cb104(0x1b9)])return;if(sequenceTimer)clearTimeout(sequenceTimer);activeSequence['push']({'loc':_0x4d7569[_0x2cb104(0x19e)]||_0x2cb104(0x1f5),'id':_0x4d7569['id'],'ts':Date[_0x2cb104(0x1f1)]()}),sequenceTimer=setTimeout(async()=>{if(activeSequence['length']>0x1)await saveCompletedSequence(_0x1a877e);activeSequence=[];},SEQUENCE_TIMEOUT_MS);}function startExitTimer(_0x469dbd){const _0x46c0ae=a5_0x2485;abortExitTimer(_0x469dbd),_0x469dbd[_0x46c0ae(0x1f4)]=!![],_0x469dbd[_0x46c0ae(0x1cc)]=setTimeout(()=>{const _0x13d963=_0x46c0ae;_0x469dbd[_0x13d963(0x1f4)]=![];},EXIT_GRACE_PERIOD_SECONDS*0x3e8),_0x469dbd['exitTimer']=setTimeout(()=>{const _0x573dc8=_0x46c0ae;setPresence(_0x469dbd,![]),_0x469dbd[_0x573dc8(0x1b8)]=null;},EXIT_TIMER_MINUTES*0x3c*0x3e8);}function abortExitTimer(_0x207f4f){const _0x2328fd=a5_0x2485;if(_0x207f4f[_0x2328fd(0x1b8)])clearTimeout(_0x207f4f[_0x2328fd(0x1b8)]);if(_0x207f4f[_0x2328fd(0x1cc)])clearTimeout(_0x207f4f[_0x2328fd(0x1cc)]);_0x207f4f[_0x2328fd(0x1b8)]=null,_0x207f4f[_0x2328fd(0x1cc)]=null,_0x207f4f[_0x2328fd(0x1f4)]=![];}async function setPresence(_0x211514,_0x4f81c7){const _0x425982=a5_0x2485;if(_0x211514[_0x425982(0x1f8)]===_0x4f81c7)return;_0x211514[_0x425982(0x1f8)]=_0x4f81c7,await _0x211514[_0x425982(0x1ca)](_0x425982(0x196),{'val':_0x4f81c7,'ack':!![]});}async function updateHourlyActivity(_0x1e8b01){const _0x49b206=a5_0x2485;let _0x39ac4b=new Array(0x18)[_0x49b206(0x1e0)](0x0),_0x9a97d8=0x0;try{const _0x4c7a0e=await _0x1e8b01['getStateAsync']('analysis.health.todayVector');_0x4c7a0e&&_0x4c7a0e[_0x49b206(0x1e2)]&&(_0x39ac4b=JSON[_0x49b206(0x1a1)](_0x4c7a0e[_0x49b206(0x1e2)]),_0x9a97d8=_0x4c7a0e['ts']);}catch(_0x5b3fa0){}const _0x2797e3=new Date(_0x9a97d8),_0x3c8fb0=new Date();_0x2797e3[_0x49b206(0x1e8)]()!==_0x3c8fb0['getDate']()&&(_0x39ac4b=new Array(0x18)[_0x49b206(0x1e0)](0x0));const _0x118e30=_0x3c8fb0[_0x49b206(0x1fd)]();if(_0x39ac4b[_0x118e30]===undefined)_0x39ac4b[_0x118e30]=0x0;_0x39ac4b[_0x118e30]++,await _0x1e8b01[_0x49b206(0x1ca)](_0x49b206(0x207),{'val':JSON[_0x49b206(0x1c1)](_0x39ac4b),'ack':!![]});}function a5_0x2485(_0x5d09bf,_0x3c8c46){const _0x267526=a5_0x2eac();return a5_0x2485=function(_0x2f28cc,_0x4d985b){_0x2f28cc=_0x2f28cc-0x196;let _0x2eac41=_0x267526[_0x2f28cc];return _0x2eac41;},a5_0x2485(_0x5d09bf,_0x3c8c46);}async function processSensorEvent(_0x5d043e,_0x45223e,_0x3c4b48,_0x2eac89){const _0x4a02ab=a5_0x2485;if(!_0x2eac89)return null;const _0x5ca313=_0x3c4b48[_0x4a02ab(0x1e2)],_0x1a4be2=Date[_0x4a02ab(0x1f1)](),_0xdc450c=_0x5d043e[_0x4a02ab(0x1ce)][_0x45223e],_0x15f3b5=(_0x2eac89[_0x4a02ab(0x19d)]||'')[_0x4a02ab(0x205)](),_0x36505e=_0x15f3b5[_0x4a02ab(0x1a9)](_0x4a02ab(0x200))||_0x15f3b5['includes'](_0x4a02ab(0x1ff))||_0x15f3b5['includes'](_0x4a02ab(0x1ab))||_0x15f3b5[_0x4a02ab(0x1a9)](_0x4a02ab(0x1b0))||_0x15f3b5[_0x4a02ab(0x1a9)]('thermostat');if(_0x36505e&&typeof _0x5ca313===_0x4a02ab(0x1dd)){if(_0x5ca313>0x50||_0x5ca313<-0x32)return _0x5d043e[_0x4a02ab(0x1e1)][_0x4a02ab(0x1ef)]('[RECORDER]\x20Ignored\x20implausible\x20temperature:\x20'+_0x5ca313+_0x4a02ab(0x1d9)+_0x45223e),null;}_0x5d043e[_0x4a02ab(0x1ce)][_0x45223e]=_0x5ca313;if(!_0x2eac89[_0x4a02ab(0x203)]&&_0xdc450c!=undefined&&_0xdc450c==_0x5ca313)return null;_0x5d043e[_0x4a02ab(0x19f)]&&_0x36505e&&recordThermodynamics(_0x5d043e,_0x45223e,_0x5ca313,_0x2eac89[_0x4a02ab(0x19e)]);const _0x52b2bc={'timestamp':_0x1a4be2,'id':_0x45223e,'name':_0x2eac89[_0x4a02ab(0x1fa)],'type':_0x2eac89[_0x4a02ab(0x19d)],'location':_0x2eac89[_0x4a02ab(0x19e)],'value':_0x5ca313};_0x5d043e[_0x4a02ab(0x1a5)]['unshift'](_0x52b2bc);if(_0x5d043e['eventHistory'][_0x4a02ab(0x1ae)]>HISTORY_MAX_SIZE)_0x5d043e['eventHistory'][_0x4a02ab(0x1d5)]();await _0x5d043e[_0x4a02ab(0x1ca)](_0x4a02ab(0x1f6),{'val':JSON['stringify'](_0x52b2bc),'ack':!![]}),await _0x5d043e[_0x4a02ab(0x1ca)](_0x4a02ab(0x1fb),{'val':JSON[_0x4a02ab(0x1c1)](_0x5d043e[_0x4a02ab(0x1a5)]),'ack':!![]}),await updateHourlyActivity(_0x5d043e);if(_0x5d043e['isProVersion']){_0x5d043e['rawEventLog'][_0x4a02ab(0x19c)](_0x52b2bc);if(_0x5d043e[_0x4a02ab(0x1c0)][_0x4a02ab(0x1ae)]>RAW_LOG_MAX_SIZE)_0x5d043e[_0x4a02ab(0x1c0)][_0x4a02ab(0x19b)](0x0,_0x5d043e['rawEventLog'][_0x4a02ab(0x1ae)]-RAW_LOG_MAX_SIZE);await _0x5d043e[_0x4a02ab(0x1ca)](_0x4a02ab(0x1a2),{'val':JSON[_0x4a02ab(0x1c1)](_0x5d043e[_0x4a02ab(0x1c0)]),'ack':!![]}),recordSequence(_0x5d043e,_0x52b2bc);}if(_0x2eac89['isExit']&&_0x5ca313===!![]){if(_0x5d043e[_0x4a02ab(0x1f8)]&&!_0x5d043e[_0x4a02ab(0x1f4)])startExitTimer(_0x5d043e);else{if(!_0x5d043e[_0x4a02ab(0x1f8)])setPresence(_0x5d043e,!![]);}}else{if(_0x2eac89[_0x4a02ab(0x19d)]===_0x4a02ab(0x1bc)&&_0x5ca313===!![]){if(_0x5d043e['exitTimer'])abortExitTimer(_0x5d043e);if(!_0x5d043e[_0x4a02ab(0x1f8)]&&_0x5d043e['currentSystemMode']===_0x4a02ab(0x1b1))setPresence(_0x5d043e,!![]);}}if(_0x5d043e[_0x4a02ab(0x19f)]&&_0x5d043e[_0x4a02ab(0x1df)]){_0x2eac89[_0x4a02ab(0x19d)]===_0x4a02ab(0x1bc)&&_0x5ca313===!![]&&_0x2eac89[_0x4a02ab(0x19e)]&&_0x5d043e[_0x4a02ab(0x1df)](_0x4a02ab(0x1ba),{'room':_0x2eac89[_0x4a02ab(0x19e)]});const _0x1bb50a=[_0x4a02ab(0x1cd),'t체r','window',_0x4a02ab(0x1ec),_0x4a02ab(0x1e9),_0x4a02ab(0x1b5),_0x4a02ab(0x1ad),_0x4a02ab(0x1e7)][_0x4a02ab(0x1e4)](_0x586938=>_0x15f3b5[_0x4a02ab(0x1a9)](_0x586938)),_0x40b9ca=[_0x4a02ab(0x1de),_0x4a02ab(0x1e6),_0x4a02ab(0x1d6),_0x4a02ab(0x1db),_0x4a02ab(0x1c5),_0x4a02ab(0x1b3)][_0x4a02ab(0x1e4)](_0x24c5ab=>_0x15f3b5[_0x4a02ab(0x1a9)](_0x24c5ab)),_0x255cd2=[_0x4a02ab(0x1bc),_0x4a02ab(0x1cb),'pr채senz',_0x4a02ab(0x1fc),_0x4a02ab(0x1c2)][_0x4a02ab(0x1e4)](_0x107151=>_0x15f3b5[_0x4a02ab(0x1a9)](_0x107151));if(_0x2eac89[_0x4a02ab(0x19e)]&&(_0x1bb50a||_0x40b9ca||_0x255cd2)){const _0x344b71=_0x5ca313===!![]||typeof _0x5ca313===_0x4a02ab(0x1dd)&&_0x5ca313>0x0,_0x1757b4=_0x1bb50a&&!_0x344b71&&_0xdc450c!==undefined&&_0xdc450c!=_0x5ca313;if(_0x344b71||_0x1757b4){const _0x23cf33=_0x5d043e[_0x4a02ab(0x1a8)]||_0x1a4be2,_0x3e6f08=(_0x1a4be2-_0x23cf33)/0x3e8;_0x5d043e[_0x4a02ab(0x1a8)]=_0x1a4be2,_0x5d043e['sendToPythonWrapper']('TRACK_EVENT',{'room':_0x2eac89[_0x4a02ab(0x19e)],'dt':_0x3e6f08});}}}return _0x52b2bc;}module['exports']={'processSensorEvent':processSensorEvent,'getOutsideTemperatureNumeric':getOutsideTemperatureNumeric,'setPresence':setPresence,'abortExitTimer':abortExitTimer,'startExitTimer':startExitTimer};