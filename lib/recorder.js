const a5_0x398a29=a5_0x4980;(function(_0x20b241,_0x2ed4be){const _0x323629=a5_0x4980,_0x275dc8=_0x20b241();while(!![]){try{const _0x5131c3=parseInt(_0x323629(0x1c5))/0x1*(parseInt(_0x323629(0x1d1))/0x2)+parseInt(_0x323629(0x1dc))/0x3+-parseInt(_0x323629(0x19d))/0x4*(-parseInt(_0x323629(0x1b7))/0x5)+-parseInt(_0x323629(0x185))/0x6*(parseInt(_0x323629(0x1cb))/0x7)+parseInt(_0x323629(0x1c2))/0x8*(parseInt(_0x323629(0x1d0))/0x9)+parseInt(_0x323629(0x1bc))/0xa*(-parseInt(_0x323629(0x184))/0xb)+parseInt(_0x323629(0x17f))/0xc*(-parseInt(_0x323629(0x19c))/0xd);if(_0x5131c3===_0x2ed4be)break;else _0x275dc8['push'](_0x275dc8['shift']());}catch(_0x2aa5c0){_0x275dc8['push'](_0x275dc8['shift']());}}}(a5_0x2a74,0xbb48a));const a5_0x4c3366=(function(){let _0xc86ea=!![];return function(_0xcc220d,_0x4fa7df){const _0x2c97a5=_0xc86ea?function(){const _0x54cc9f=a5_0x4980;if(_0x4fa7df){const _0x29db48=_0x4fa7df[_0x54cc9f(0x1d6)](_0xcc220d,arguments);return _0x4fa7df=null,_0x29db48;}}:function(){};return _0xc86ea=![],_0x2c97a5;};}()),a5_0x3f029d=a5_0x4c3366(this,function(){const _0x9b0037=a5_0x4980;return a5_0x3f029d['toString']()[_0x9b0037(0x1a9)](_0x9b0037(0x1c8))[_0x9b0037(0x1d4)]()['constructor'](a5_0x3f029d)[_0x9b0037(0x1a9)](_0x9b0037(0x1c8));});a5_0x3f029d();'use strict';const HISTORY_MAX_SIZE=0x32,RAW_LOG_MAX_SIZE=0x9c4,THERMO_LOG_SIZE=0x3e8,SEQUENCE_TIMEOUT_MS=0x5*0x3c*0x3e8,MAX_TRAINING_SET_SIZE=0x1f4,EXIT_TIMER_MINUTES=0xf,EXIT_GRACE_PERIOD_SECONDS=0x1e;let activeSequence=[],sequenceTimer=null;async function getOutsideTemperatureNumeric(_0x2518e3){const _0x22f671=a5_0x4980;if(_0x2518e3['config'][_0x22f671(0x19e)])try{const _0x4c580f=await _0x2518e3['getForeignStateAsync'](_0x2518e3[_0x22f671(0x1c0)][_0x22f671(0x19e)]);if(_0x4c580f&&_0x4c580f[_0x22f671(0x1cf)]!==undefined&&_0x4c580f[_0x22f671(0x1cf)]!==null)return parseFloat(_0x4c580f[_0x22f671(0x1cf)]);}catch(_0x3fa9c7){}const _0x565044=_0x2518e3[_0x22f671(0x1c0)][_0x22f671(0x1af)];if(!_0x2518e3[_0x22f671(0x1c0)][_0x22f671(0x1a7)]||!_0x565044)return null;try{let _0x2ef459='';if(_0x565044['includes'](_0x22f671(0x1ac)))_0x2ef459=_0x565044+_0x22f671(0x1bd);else{if(_0x565044[_0x22f671(0x1a1)](_0x22f671(0x1ba)))_0x2ef459=_0x565044+_0x22f671(0x194);else{if(_0x565044[_0x22f671(0x1a1)](_0x22f671(0x1d5)))_0x2ef459=_0x565044+_0x22f671(0x1aa);else{if(_0x565044[_0x22f671(0x1a1)]('weatherunderground'))_0x2ef459=_0x565044+_0x22f671(0x198);}}}if(_0x2ef459){const _0x4a1a51=await _0x2518e3[_0x22f671(0x182)](_0x2ef459);if(_0x4a1a51&&_0x4a1a51[_0x22f671(0x1cf)]!==undefined&&_0x4a1a51[_0x22f671(0x1cf)]!==null)return parseFloat(_0x4a1a51[_0x22f671(0x1cf)]);}}catch(_0x271e95){}return null;}async function recordThermodynamics(_0x1156a7,_0x317036,_0x55dc67,_0x5d6541){const _0x36f996=a5_0x4980,_0x11fe49=await getOutsideTemperatureNumeric(_0x1156a7);let _0x36ff2a=0x0;if(_0x317036['includes'](_0x36f996(0x180))){const _0x464c74=[{'from':_0x36f996(0x190),'to':'.1.LEVEL'},{'from':_0x36f996(0x190),'to':'.1.VALVE_STATE'},{'from':_0x36f996(0x199),'to':'.4.VALVE_STATE'},{'from':_0x36f996(0x1be),'to':_0x36f996(0x17e)}];for(const _0x3f95f7 of _0x464c74){if(_0x317036[_0x36f996(0x1a1)](_0x3f95f7[_0x36f996(0x195)])){const _0x3c7483=_0x317036[_0x36f996(0x1cd)](_0x3f95f7[_0x36f996(0x195)],_0x3f95f7['to']);try{const _0x1f9e9d=await _0x1156a7[_0x36f996(0x182)](_0x3c7483);if(_0x1f9e9d&&_0x1f9e9d[_0x36f996(0x1cf)]!==null&&_0x1f9e9d['val']!==undefined){let _0x347677=_0x1f9e9d[_0x36f996(0x1cf)];typeof _0x347677==='number'&&_0x347677<=1.05&&_0x3f95f7['to'][_0x36f996(0x1a1)](_0x36f996(0x186))&&(_0x347677=_0x347677*0x64);_0x36ff2a=Math['round'](_0x347677);break;}}catch(_0x34832a){}}}}const _0x4f39ed=await _0x1156a7[_0x36f996(0x1a5)](_0x36f996(0x197));let _0x2453d7=[];if(_0x4f39ed&&_0x4f39ed['val'])try{_0x2453d7=JSON[_0x36f996(0x1ae)](_0x4f39ed[_0x36f996(0x1cf)]);}catch(_0xc7554b){}_0x2453d7[_0x36f996(0x18a)]({'ts':Date['now'](),'room':_0x5d6541||_0x36f996(0x1bb),'t_in':_0x55dc67,'t_out':_0x11fe49,'valve':_0x36ff2a});if(_0x2453d7['length']>THERMO_LOG_SIZE)_0x2453d7[_0x36f996(0x18f)]();await _0x1156a7['setStateAsync']('LTM.trainingData.thermodynamics',{'val':JSON['stringify'](_0x2453d7),'ack':!![]});}async function saveCompletedSequence(_0x5b6667){const _0x564a1e=a5_0x4980;try{const _0xe11a5b=await _0x5b6667[_0x564a1e(0x1a5)](_0x564a1e(0x183));let _0xf6c972=[];if(_0xe11a5b&&_0xe11a5b[_0x564a1e(0x1cf)])try{_0xf6c972=JSON[_0x564a1e(0x1ae)](_0xe11a5b[_0x564a1e(0x1cf)]);}catch(_0x40b19d){}const _0xf71ba5=activeSequence[0x0]['ts'],_0x7d0f4=activeSequence[_0x564a1e(0x1a3)](_0x1c2a72=>({'loc':_0x1c2a72[_0x564a1e(0x18d)],'t_delta':Math['round']((_0x1c2a72['ts']-_0xf71ba5)/0x3e8)})),_0x3cee6a={'timestamp':new Date(_0xf71ba5)['toISOString'](),'steps':_0x7d0f4,'duration':Math[_0x564a1e(0x1ab)]((activeSequence[activeSequence[_0x564a1e(0x1a6)]-0x1]['ts']-_0xf71ba5)/0x3e8),'daytime':new Date(_0xf71ba5)['getHours']()};_0xf6c972[_0x564a1e(0x18a)](_0x3cee6a);if(_0xf6c972['length']>MAX_TRAINING_SET_SIZE)_0xf6c972[_0x564a1e(0x18f)]();await _0x5b6667['setStateAsync']('LTM.trainingData.sequences',{'val':JSON[_0x564a1e(0x193)](_0xf6c972),'ack':!![]}),_0x5b6667[_0x564a1e(0x1a2)]&&_0x5b6667[_0x564a1e(0x192)]&&_0x5b6667[_0x564a1e(0x192)]('ANALYZE_SEQUENCE',{'sequence':_0x3cee6a});}catch(_0x115246){_0x5b6667['log']['error'](_0x564a1e(0x18e)+_0x115246[_0x564a1e(0x18b)]);}}async function recordSequence(_0x2487b3,_0x3df7c8){const _0xc97cfc=a5_0x4980,_0x261ca5=(_0x3df7c8[_0xc97cfc(0x1b0)]||'')['toLowerCase'](),_0x309a73=[_0xc97cfc(0x1c9),_0xc97cfc(0x1d3),_0xc97cfc(0x1d9),_0xc97cfc(0x1b6),_0xc97cfc(0x1b1),_0xc97cfc(0x1c1),_0xc97cfc(0x1a4),'window',_0xc97cfc(0x1bf),'contact',_0xc97cfc(0x1ca),'light',_0xc97cfc(0x1db),_0xc97cfc(0x1ad),_0xc97cfc(0x18c),'dimmer',_0xc97cfc(0x196)];if(!_0x309a73[_0xc97cfc(0x1ce)](_0x5d4cd0=>_0x261ca5[_0xc97cfc(0x1a1)](_0x5d4cd0)))return;if(!_0x3df7c8['value'])return;if(sequenceTimer)clearTimeout(sequenceTimer);activeSequence[_0xc97cfc(0x18a)]({'loc':_0x3df7c8[_0xc97cfc(0x19b)]||'Unknown','id':_0x3df7c8['id'],'ts':Date[_0xc97cfc(0x1c7)]()}),sequenceTimer=setTimeout(async()=>{const _0x48a82b=_0xc97cfc;if(activeSequence[_0x48a82b(0x1a6)]>0x1)await saveCompletedSequence(_0x2487b3);activeSequence=[];},SEQUENCE_TIMEOUT_MS);}function startExitTimer(_0x43df79){const _0x228780=a5_0x4980;abortExitTimer(_0x43df79),_0x43df79['isGracePeriodActive']=!![],_0x43df79[_0x228780(0x1c3)]=setTimeout(()=>{const _0x51c239=_0x228780;_0x43df79[_0x51c239(0x1c4)]=![];},EXIT_GRACE_PERIOD_SECONDS*0x3e8),_0x43df79[_0x228780(0x1cc)]=setTimeout(()=>{const _0x2cf756=_0x228780;setPresence(_0x43df79,![]),_0x43df79[_0x2cf756(0x1cc)]=null;},EXIT_TIMER_MINUTES*0x3c*0x3e8);}function a5_0x4980(_0x797540,_0xee3c77){const _0x57bae8=a5_0x2a74();return a5_0x4980=function(_0x3f029d,_0x4c3366){_0x3f029d=_0x3f029d-0x17d;let _0x2a74a0=_0x57bae8[_0x3f029d];return _0x2a74a0;},a5_0x4980(_0x797540,_0xee3c77);}function abortExitTimer(_0x31c9a){const _0x1e37ba=a5_0x4980;if(_0x31c9a['exitTimer'])clearTimeout(_0x31c9a[_0x1e37ba(0x1cc)]);if(_0x31c9a['exitGraceTimer'])clearTimeout(_0x31c9a[_0x1e37ba(0x1c3)]);_0x31c9a['exitTimer']=null,_0x31c9a[_0x1e37ba(0x1c3)]=null,_0x31c9a[_0x1e37ba(0x1c4)]=![];}async function setPresence(_0xb03a17,_0x2d0743){const _0x5316af=a5_0x4980;if(_0xb03a17['isPresent']===_0x2d0743)return;_0xb03a17['isPresent']=_0x2d0743,await _0xb03a17[_0x5316af(0x1a8)](_0x5316af(0x17d),{'val':_0x2d0743,'ack':!![]});}async function processSensorEvent(_0x55930e,_0x20b0b0,_0xea3221,_0x4cb9eb){const _0x4b0eb7=a5_0x4980;if(!_0x4cb9eb)return null;const _0x4ee911=_0xea3221[_0x4b0eb7(0x1cf)],_0x3c6d77=Date[_0x4b0eb7(0x1c7)](),_0x12e8c1=_0x55930e['sensorLastValues'][_0x20b0b0];_0x55930e[_0x4b0eb7(0x19a)][_0x20b0b0]=_0x4ee911;if(!_0x4cb9eb['logDuplicates']&&_0x12e8c1!=undefined&&_0x12e8c1==_0x4ee911)return null;const _0x26bdf4=(_0x4cb9eb['type']||'')[_0x4b0eb7(0x181)](),_0x3ce349=_0x26bdf4[_0x4b0eb7(0x1a1)](_0x4b0eb7(0x189))||_0x26bdf4[_0x4b0eb7(0x1a1)](_0x4b0eb7(0x1b3))||_0x26bdf4[_0x4b0eb7(0x1a1)](_0x4b0eb7(0x1d7))||_0x26bdf4[_0x4b0eb7(0x1a1)](_0x4b0eb7(0x1da));_0x55930e[_0x4b0eb7(0x1a2)]&&_0x3ce349&&recordThermodynamics(_0x55930e,_0x20b0b0,_0x4ee911,_0x4cb9eb[_0x4b0eb7(0x19b)]);const _0x270206={'timestamp':_0x3c6d77,'id':_0x20b0b0,'name':_0x4cb9eb[_0x4b0eb7(0x19f)],'type':_0x4cb9eb[_0x4b0eb7(0x1b0)],'location':_0x4cb9eb[_0x4b0eb7(0x19b)],'value':_0x4ee911};_0x55930e[_0x4b0eb7(0x1b5)][_0x4b0eb7(0x1b2)](_0x270206);if(_0x55930e[_0x4b0eb7(0x1b5)][_0x4b0eb7(0x1a6)]>HISTORY_MAX_SIZE)_0x55930e[_0x4b0eb7(0x1b5)][_0x4b0eb7(0x1a0)]();await _0x55930e[_0x4b0eb7(0x1a8)](_0x4b0eb7(0x1b8),{'val':JSON['stringify'](_0x270206),'ack':!![]}),await _0x55930e[_0x4b0eb7(0x1a8)](_0x4b0eb7(0x1d8),{'val':JSON[_0x4b0eb7(0x193)](_0x55930e['eventHistory']),'ack':!![]});if(_0x55930e[_0x4b0eb7(0x1a2)]){_0x55930e['rawEventLog'][_0x4b0eb7(0x18a)](_0x270206);if(_0x55930e[_0x4b0eb7(0x191)][_0x4b0eb7(0x1a6)]>RAW_LOG_MAX_SIZE)_0x55930e[_0x4b0eb7(0x191)][_0x4b0eb7(0x1b4)](0x0,_0x55930e[_0x4b0eb7(0x191)][_0x4b0eb7(0x1a6)]-RAW_LOG_MAX_SIZE);await _0x55930e[_0x4b0eb7(0x1a8)](_0x4b0eb7(0x1b9),{'val':JSON[_0x4b0eb7(0x193)](_0x55930e[_0x4b0eb7(0x191)]),'ack':!![]}),recordSequence(_0x55930e,_0x270206);}if(_0x4cb9eb['isExit']&&_0x4ee911===!![]){if(_0x55930e[_0x4b0eb7(0x187)]&&!_0x55930e['isGracePeriodActive'])startExitTimer(_0x55930e);else{if(!_0x55930e['isPresent'])setPresence(_0x55930e,!![]);}}else{if(_0x4cb9eb[_0x4b0eb7(0x1b0)]===_0x4b0eb7(0x1c9)&&_0x4ee911===!![]){if(_0x55930e[_0x4b0eb7(0x1cc)])abortExitTimer(_0x55930e);if(!_0x55930e['isPresent']&&_0x55930e['currentSystemMode']===_0x4b0eb7(0x1d2))setPresence(_0x55930e,!![]);}}return _0x55930e['isProVersion']&&_0x4cb9eb[_0x4b0eb7(0x1b0)]==='motion'&&_0x4ee911===!![]&&_0x4cb9eb['location']&&_0x55930e[_0x4b0eb7(0x192)]&&_0x55930e[_0x4b0eb7(0x192)](_0x4b0eb7(0x188),{'room':_0x4cb9eb[_0x4b0eb7(0x19b)]}),_0x270206;}module[a5_0x398a29(0x1c6)]={'processSensorEvent':processSensorEvent,'getOutsideTemperatureNumeric':getOutsideTemperatureNumeric,'setPresence':setPresence,'abortExitTimer':abortExitTimer,'startExitTimer':startExitTimer};function a5_0x2a74(){const _0xa9aa70=['name','pop','includes','isProVersion','map','tür','getStateAsync','length','useWeather','setStateAsync','search','.forecast.current.temperature','round','accuweather','switch','parse','weatherInstance','type','occupancy','unshift','temperatur','splice','eventHistory','presence','199915WmJZMF','events.lastEvent','LTM.rawEventLog','daswetter','Unknown','10jZBaKd','.Current.Temperature','.ACTUAL_TEMPERATURE','fenster','config','door','15448VLuqnt','exitGraceTimer','isGracePeriodActive','1ucbMEi','exports','now','(((.+)+)+)+$','motion','kontakt','21UzIHwY','exitTimer','replace','some','val','5652lCnZFS','634622TFrjSQ','normal','bewegung','toString','openweathermap','apply','klima','events.history','präsenz','heizung','licht','3820002PrsZDE','system.isPresent','.LEVEL','23460RArzUS','hm-rpc','toLowerCase','getForeignStateAsync','LTM.trainingData.sequences','501094yyUVKK','1671744beTDPY','LEVEL','isPresent','SIMULATE_SIGNAL','temperature','push','message','schalter','loc','[RECORDER]\x20Error:\x20','shift','.1.ACTUAL_TEMPERATURE','rawEventLog','sendToPythonWrapper','stringify','.NextHours.Location_1.Day_1.current.temp_value','from','lampe','LTM.trainingData.thermodynamics','.forecast.current.temp','.1.TEMPERATURE','sensorLastValues','location','11401OglCmx','56cnbydl','outdoorSensorId'];a5_0x2a74=function(){return _0xa9aa70;};return a5_0x2a74();}