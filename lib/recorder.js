const a5_0x2c1f5d=a5_0x5bc5;(function(_0x4e8f51,_0x1598e2){const _0xa75cf1=a5_0x5bc5,_0x1538f0=_0x4e8f51();while(!![]){try{const _0x4e1ee5=-parseInt(_0xa75cf1(0x1e5))/0x1+-parseInt(_0xa75cf1(0x1a4))/0x2*(-parseInt(_0xa75cf1(0x1a1))/0x3)+-parseInt(_0xa75cf1(0x1cf))/0x4+-parseInt(_0xa75cf1(0x1d3))/0x5*(parseInt(_0xa75cf1(0x182))/0x6)+parseInt(_0xa75cf1(0x1ab))/0x7*(-parseInt(_0xa75cf1(0x180))/0x8)+parseInt(_0xa75cf1(0x1d6))/0x9+-parseInt(_0xa75cf1(0x1e1))/0xa*(-parseInt(_0xa75cf1(0x190))/0xb);if(_0x4e1ee5===_0x1598e2)break;else _0x1538f0['push'](_0x1538f0['shift']());}catch(_0x5d75b2){_0x1538f0['push'](_0x1538f0['shift']());}}}(a5_0x4423,0xd3db2));const a5_0x3c3a02=(function(){let _0xa3689e=!![];return function(_0xb7ed34,_0x5dd184){const _0x4991b5=_0xa3689e?function(){const _0x13aee6=a5_0x5bc5;if(_0x5dd184){const _0x1a3d57=_0x5dd184[_0x13aee6(0x1bb)](_0xb7ed34,arguments);return _0x5dd184=null,_0x1a3d57;}}:function(){};return _0xa3689e=![],_0x4991b5;};}()),a5_0xd8a859=a5_0x3c3a02(this,function(){const _0x502317=a5_0x5bc5;return a5_0xd8a859[_0x502317(0x1c8)]()[_0x502317(0x1b5)](_0x502317(0x18d))['toString']()[_0x502317(0x1cc)](a5_0xd8a859)[_0x502317(0x1b5)](_0x502317(0x18d));});a5_0xd8a859();'use strict';const HISTORY_MAX_SIZE=0x32,RAW_LOG_MAX_SIZE=0x9c4,THERMO_LOG_SIZE=0x3e8,SEQUENCE_TIMEOUT_MS=0x5*0x3c*0x3e8,MAX_TRAINING_SET_SIZE=0x1f4,EXIT_TIMER_MINUTES=0xf,EXIT_GRACE_PERIOD_SECONDS=0x1e;let activeSequence=[],sequenceTimer=null;async function getOutsideTemperatureNumeric(_0x286347){const _0x5914fc=a5_0x5bc5;if(_0x286347[_0x5914fc(0x1bd)][_0x5914fc(0x1d5)])try{const _0x7602af=await _0x286347[_0x5914fc(0x1da)](_0x286347[_0x5914fc(0x1bd)][_0x5914fc(0x1d5)]);if(_0x7602af&&_0x7602af[_0x5914fc(0x193)]!==undefined&&_0x7602af[_0x5914fc(0x193)]!==null)return parseFloat(_0x7602af[_0x5914fc(0x193)]);}catch(_0x25ad9c){}const _0x318a2c=_0x286347['config']['weatherInstance'];if(!_0x286347[_0x5914fc(0x1bd)][_0x5914fc(0x18b)]||!_0x318a2c)return null;try{let _0x97e5e8='';if(_0x318a2c[_0x5914fc(0x1de)](_0x5914fc(0x1b3)))_0x97e5e8=_0x318a2c+_0x5914fc(0x17f);else{if(_0x318a2c[_0x5914fc(0x1de)](_0x5914fc(0x1c4)))_0x97e5e8=_0x318a2c+'.NextHours.Location_1.Day_1.current.temp_value';else{if(_0x318a2c[_0x5914fc(0x1de)]('openweathermap'))_0x97e5e8=_0x318a2c+_0x5914fc(0x1ce);else{if(_0x318a2c[_0x5914fc(0x1de)](_0x5914fc(0x19d)))_0x97e5e8=_0x318a2c+'.forecast.current.temp';}}}if(_0x97e5e8){const _0xa6c9d6=await _0x286347[_0x5914fc(0x1da)](_0x97e5e8);if(_0xa6c9d6&&_0xa6c9d6[_0x5914fc(0x193)]!==undefined&&_0xa6c9d6[_0x5914fc(0x193)]!==null)return parseFloat(_0xa6c9d6[_0x5914fc(0x193)]);}}catch(_0x1a45d6){}return null;}async function recordThermodynamics(_0x3fe821,_0x4b8790,_0x3d52aa,_0x337bd8){const _0x4fb584=a5_0x5bc5,_0x98f82d=await getOutsideTemperatureNumeric(_0x3fe821);if(_0x98f82d===null)return;let _0x5938f6=0x0,_0x14bf43=![];if(_0x3fe821['config'][_0x4fb584(0x1a3)])try{let _0xabfec9=_0x3fe821[_0x4fb584(0x1bd)][_0x4fb584(0x1a3)];if(typeof _0xabfec9===_0x4fb584(0x1ad))_0xabfec9=JSON['parse'](_0xabfec9);if(_0xabfec9[_0x4b8790]){const _0x43e6b3=_0xabfec9[_0x4b8790],_0x1b6d28=await _0x3fe821[_0x4fb584(0x1da)](_0x43e6b3);if(_0x1b6d28&&_0x1b6d28[_0x4fb584(0x193)]!==null&&_0x1b6d28[_0x4fb584(0x193)]!==undefined){let _0x42b181=Number(_0x1b6d28['val']);if(_0x42b181<=1.05&&!_0x43e6b3[_0x4fb584(0x1de)]('STATUS')&&!_0x43e6b3[_0x4fb584(0x1de)](_0x4fb584(0x19a)))_0x42b181=_0x42b181*0x64;_0x5938f6=Math[_0x4fb584(0x1e4)](_0x42b181),_0x14bf43=!![];}}}catch(_0x4d8578){}if(!_0x14bf43){const _0xdf130d=[{'from':'.1.ACTUAL_TEMPERATURE','to':'.1.LEVEL'},{'from':_0x4fb584(0x1d8),'to':_0x4fb584(0x1b2)},{'from':_0x4fb584(0x1e9),'to':_0x4fb584(0x1ac)},{'from':_0x4fb584(0x1dd),'to':_0x4fb584(0x1c1)},{'from':'temperature','to':_0x4fb584(0x1e6)},{'from':_0x4fb584(0x1a5),'to':_0x4fb584(0x1b8)}];for(const _0x809339 of _0xdf130d){if(_0x4b8790[_0x4fb584(0x1de)](_0x809339[_0x4fb584(0x1c3)])){const _0x47cf73=_0x4b8790[_0x4fb584(0x1d2)](_0x809339[_0x4fb584(0x1c3)],_0x809339['to']);try{const _0x3f5ae3=await _0x3fe821[_0x4fb584(0x1da)](_0x47cf73);if(_0x3f5ae3&&_0x3f5ae3[_0x4fb584(0x193)]!==null&&_0x3f5ae3['val']!==undefined){let _0x5464b5=Number(_0x3f5ae3[_0x4fb584(0x193)]);if(typeof _0x5464b5===_0x4fb584(0x1c6)){if(_0x5464b5<=1.05&&_0x809339['to']['includes'](_0x4fb584(0x1e0)))_0x5464b5=_0x5464b5*0x64;_0x5938f6=Math[_0x4fb584(0x1e4)](_0x5464b5),_0x14bf43=!![];break;}}}catch(_0x5a503b){}}}}const _0xaadd94=await _0x3fe821[_0x4fb584(0x1a6)](_0x4fb584(0x186));let _0x432751=[];if(_0xaadd94&&_0xaadd94['val'])try{_0x432751=JSON['parse'](_0xaadd94[_0x4fb584(0x193)]);}catch(_0x2ed885){}_0x432751['push']({'ts':Date[_0x4fb584(0x1ec)](),'room':_0x337bd8||_0x4fb584(0x1b6),'t_in':_0x3d52aa,'t_out':_0x98f82d,'valve':_0x5938f6});if(_0x432751[_0x4fb584(0x1cd)]>THERMO_LOG_SIZE)_0x432751[_0x4fb584(0x1a7)]();await _0x3fe821['setStateAsync']('LTM.trainingData.thermodynamics',{'val':JSON[_0x4fb584(0x1ca)](_0x432751),'ack':!![]});}async function saveCompletedSequence(_0x545112){const _0x373ab3=a5_0x5bc5;try{const _0x18560c=await _0x545112[_0x373ab3(0x1a6)]('LTM.trainingData.sequences');let _0x3d172d=[];if(_0x18560c&&_0x18560c[_0x373ab3(0x193)])try{_0x3d172d=JSON[_0x373ab3(0x1df)](_0x18560c[_0x373ab3(0x193)]);}catch(_0x4d8ad4){}const _0x28462f=activeSequence[0x0]['ts'],_0x6604a8=activeSequence[_0x373ab3(0x196)](_0x12f191=>({'loc':_0x12f191[_0x373ab3(0x19b)],'t_delta':Math['round']((_0x12f191['ts']-_0x28462f)/0x3e8)})),_0x3b4bcc={'timestamp':new Date(_0x28462f)['toISOString'](),'steps':_0x6604a8,'duration':Math[_0x373ab3(0x1e4)]((activeSequence[activeSequence[_0x373ab3(0x1cd)]-0x1]['ts']-_0x28462f)/0x3e8),'daytime':new Date(_0x28462f)['getHours']()};_0x3d172d[_0x373ab3(0x1e2)](_0x3b4bcc);if(_0x3d172d[_0x373ab3(0x1cd)]>MAX_TRAINING_SET_SIZE)_0x3d172d[_0x373ab3(0x1a7)]();await _0x545112['setStateAsync'](_0x373ab3(0x1eb),{'val':JSON[_0x373ab3(0x1ca)](_0x3d172d),'ack':!![]}),_0x545112[_0x373ab3(0x1e8)]&&_0x545112['sendToPythonWrapper']&&_0x545112['sendToPythonWrapper'](_0x373ab3(0x1db),{'sequence':_0x3b4bcc});}catch(_0x275c58){_0x545112[_0x373ab3(0x1bf)][_0x373ab3(0x1b4)](_0x373ab3(0x183)+_0x275c58['message']);}}async function recordSequence(_0x294e11,_0x190548){const _0x25c461=a5_0x5bc5,_0x254935=(_0x190548[_0x25c461(0x199)]||'')[_0x25c461(0x1ae)](),_0x23c169=[_0x25c461(0x194),_0x25c461(0x1b9),'pr채senz',_0x25c461(0x1aa),_0x25c461(0x1a9),_0x25c461(0x19e),_0x25c461(0x1be),'window',_0x25c461(0x1d9),_0x25c461(0x1a8),_0x25c461(0x195),_0x25c461(0x19f),_0x25c461(0x1c5),_0x25c461(0x1b0),_0x25c461(0x19c),_0x25c461(0x1c9),'lampe'];if(!_0x23c169['some'](_0x25cbb3=>_0x254935['includes'](_0x25cbb3)))return;if(!_0x190548[_0x25c461(0x181)])return;if(sequenceTimer)clearTimeout(sequenceTimer);activeSequence[_0x25c461(0x1e2)]({'loc':_0x190548['location']||_0x25c461(0x1b6),'id':_0x190548['id'],'ts':Date[_0x25c461(0x1ec)]()}),sequenceTimer=setTimeout(async()=>{const _0x1b49de=_0x25c461;if(activeSequence[_0x1b49de(0x1cd)]>0x1)await saveCompletedSequence(_0x294e11);activeSequence=[];},SEQUENCE_TIMEOUT_MS);}function a5_0x5bc5(_0xe6c5d0,_0xb42e13){const _0x4dbb43=a5_0x4423();return a5_0x5bc5=function(_0xd8a859,_0x3c3a02){_0xd8a859=_0xd8a859-0x17e;let _0x4423c6=_0x4dbb43[_0xd8a859];return _0x4423c6;},a5_0x5bc5(_0xe6c5d0,_0xb42e13);}function a5_0x4423(){const _0x151f52=['STATE','loc','schalter','weatherunderground','door','light','griff','813PTsxdT','some','valveMapping','5870eWQGom','Temperature','getStateAsync','shift','contact','occupancy','presence','21qFrtDc','.4.VALVE_STATE','string','toLowerCase','exports','switch','temperatur','.1.VALVE_STATE','accuweather','error','search','Unknown','exitGraceTimer','Valve','bewegung','temperature','apply','currentSystemMode','config','t체r','log','pr채senz','.LEVEL','exitTimer','from','daswetter','licht','number','sensorLastValues','toString','dimmer','stringify','TRACK_EVENT','constructor','length','.forecast.current.temperature','1248992qzDHrN','eventHistory','events.lastEvent','replace','20BbsZDC','heizung','outdoorSensorId','4616532AGbkin','sendToPythonWrapper','.1.ACTUAL_TEMPERATURE','fenster','getForeignStateAsync','ANALYZE_SEQUENCE','system.isPresent','.ACTUAL_TEMPERATURE','includes','parse','LEVEL','140NpnTyD','push','isPresent','round','569438DqWrCN','level','rawEventLog','isProVersion','.1.TEMPERATURE','logDuplicates','LTM.trainingData.sequences','now','pop','[RECORDER]\x20Ignored\x20implausible\x20temperature:\x20','.Current.Temperature','2096392ZzuQxK','value','551616gyQvrx','[RECORDER]\x20Error:\x20','unshift','location','LTM.trainingData.thermodynamics','isExit','thermostat','handle','isGracePeriodActive','useWeather','setStateAsync','(((.+)+)+)+$','window','lampe','1253219uozVYg','lastTrackerEventTime','klima','val','motion','kontakt','map','splice','SIMULATE_SIGNAL','type'];a5_0x4423=function(){return _0x151f52;};return a5_0x4423();}function startExitTimer(_0x39f8d0){const _0x2ef021=a5_0x5bc5;abortExitTimer(_0x39f8d0),_0x39f8d0[_0x2ef021(0x18a)]=!![],_0x39f8d0[_0x2ef021(0x1b7)]=setTimeout(()=>{const _0x15db78=_0x2ef021;_0x39f8d0[_0x15db78(0x18a)]=![];},EXIT_GRACE_PERIOD_SECONDS*0x3e8),_0x39f8d0[_0x2ef021(0x1c2)]=setTimeout(()=>{const _0x5c9fab=_0x2ef021;setPresence(_0x39f8d0,![]),_0x39f8d0[_0x5c9fab(0x1c2)]=null;},EXIT_TIMER_MINUTES*0x3c*0x3e8);}function abortExitTimer(_0x47488f){const _0x4a17b9=a5_0x5bc5;if(_0x47488f[_0x4a17b9(0x1c2)])clearTimeout(_0x47488f[_0x4a17b9(0x1c2)]);if(_0x47488f[_0x4a17b9(0x1b7)])clearTimeout(_0x47488f[_0x4a17b9(0x1b7)]);_0x47488f['exitTimer']=null,_0x47488f[_0x4a17b9(0x1b7)]=null,_0x47488f[_0x4a17b9(0x18a)]=![];}async function setPresence(_0x586f40,_0x20ecc9){const _0x2fd638=a5_0x5bc5;if(_0x586f40[_0x2fd638(0x1e3)]===_0x20ecc9)return;_0x586f40[_0x2fd638(0x1e3)]=_0x20ecc9,await _0x586f40['setStateAsync'](_0x2fd638(0x1dc),{'val':_0x20ecc9,'ack':!![]});}async function processSensorEvent(_0x50dfeb,_0x4400c4,_0x78e8f,_0x276ace){const _0x393133=a5_0x5bc5;if(!_0x276ace)return null;const _0x526eab=_0x78e8f[_0x393133(0x193)],_0x5a9b5b=Date[_0x393133(0x1ec)](),_0x555c06=_0x50dfeb[_0x393133(0x1c7)][_0x4400c4],_0x493168=(_0x276ace[_0x393133(0x199)]||'')[_0x393133(0x1ae)](),_0x4b6148=_0x493168[_0x393133(0x1de)](_0x393133(0x1ba))||_0x493168[_0x393133(0x1de)](_0x393133(0x1b1))||_0x493168['includes'](_0x393133(0x192))||_0x493168[_0x393133(0x1de)](_0x393133(0x1d4))||_0x493168[_0x393133(0x1de)](_0x393133(0x188));if(_0x4b6148&&typeof _0x526eab===_0x393133(0x1c6)){if(_0x526eab>0x50||_0x526eab<-0x32)return _0x50dfeb[_0x393133(0x1bf)]['debug'](_0x393133(0x17e)+_0x526eab+'\x20from\x20'+_0x4400c4),null;}_0x50dfeb['sensorLastValues'][_0x4400c4]=_0x526eab;if(!_0x276ace[_0x393133(0x1ea)]&&_0x555c06!=undefined&&_0x555c06==_0x526eab)return null;_0x50dfeb[_0x393133(0x1e8)]&&_0x4b6148&&recordThermodynamics(_0x50dfeb,_0x4400c4,_0x526eab,_0x276ace[_0x393133(0x185)]);const _0x4b8a9a={'timestamp':_0x5a9b5b,'id':_0x4400c4,'name':_0x276ace['name'],'type':_0x276ace['type'],'location':_0x276ace[_0x393133(0x185)],'value':_0x526eab};_0x50dfeb['eventHistory'][_0x393133(0x184)](_0x4b8a9a);if(_0x50dfeb[_0x393133(0x1d0)]['length']>HISTORY_MAX_SIZE)_0x50dfeb[_0x393133(0x1d0)][_0x393133(0x1ed)]();await _0x50dfeb['setStateAsync'](_0x393133(0x1d1),{'val':JSON[_0x393133(0x1ca)](_0x4b8a9a),'ack':!![]}),await _0x50dfeb[_0x393133(0x18c)]('events.history',{'val':JSON[_0x393133(0x1ca)](_0x50dfeb['eventHistory']),'ack':!![]});if(_0x50dfeb[_0x393133(0x1e8)]){_0x50dfeb[_0x393133(0x1e7)]['push'](_0x4b8a9a);if(_0x50dfeb[_0x393133(0x1e7)]['length']>RAW_LOG_MAX_SIZE)_0x50dfeb[_0x393133(0x1e7)][_0x393133(0x197)](0x0,_0x50dfeb[_0x393133(0x1e7)][_0x393133(0x1cd)]-RAW_LOG_MAX_SIZE);await _0x50dfeb[_0x393133(0x18c)]('LTM.rawEventLog',{'val':JSON[_0x393133(0x1ca)](_0x50dfeb[_0x393133(0x1e7)]),'ack':!![]}),recordSequence(_0x50dfeb,_0x4b8a9a);}if(_0x276ace[_0x393133(0x187)]&&_0x526eab===!![]){if(_0x50dfeb[_0x393133(0x1e3)]&&!_0x50dfeb['isGracePeriodActive'])startExitTimer(_0x50dfeb);else{if(!_0x50dfeb[_0x393133(0x1e3)])setPresence(_0x50dfeb,!![]);}}else{if(_0x276ace[_0x393133(0x199)]==='motion'&&_0x526eab===!![]){if(_0x50dfeb['exitTimer'])abortExitTimer(_0x50dfeb);if(!_0x50dfeb[_0x393133(0x1e3)]&&_0x50dfeb[_0x393133(0x1bc)]==='normal')setPresence(_0x50dfeb,!![]);}}if(_0x50dfeb['isProVersion']&&_0x50dfeb[_0x393133(0x1d7)]){_0x276ace[_0x393133(0x199)]===_0x393133(0x194)&&_0x526eab===!![]&&_0x276ace[_0x393133(0x185)]&&_0x50dfeb['sendToPythonWrapper'](_0x393133(0x198),{'room':_0x276ace[_0x393133(0x185)]});const _0x1fc3b8=['door','t체r',_0x393133(0x18e),'fenster',_0x393133(0x1a0),_0x393133(0x189),'lock','schloss'][_0x393133(0x1a2)](_0x47ba02=>_0x493168['includes'](_0x47ba02)),_0x16af67=[_0x393133(0x19f),_0x393133(0x1c5),_0x393133(0x1b0),'schalter',_0x393133(0x1c9),_0x393133(0x18f)][_0x393133(0x1a2)](_0x6ec8b7=>_0x493168[_0x393133(0x1de)](_0x6ec8b7)),_0x41ba61=['motion',_0x393133(0x1b9),_0x393133(0x1c0),_0x393133(0x1aa),'occupancy'][_0x393133(0x1a2)](_0x2201c8=>_0x493168[_0x393133(0x1de)](_0x2201c8));if(_0x276ace['location']&&(_0x1fc3b8||_0x16af67||_0x41ba61)){const _0x5230c8=_0x526eab===!![]||typeof _0x526eab==='number'&&_0x526eab>0x0,_0xa5d166=_0x1fc3b8&&!_0x5230c8&&_0x555c06!==undefined&&_0x555c06!=_0x526eab;if(_0x5230c8||_0xa5d166){const _0x53be8c=_0x50dfeb[_0x393133(0x191)]||_0x5a9b5b,_0x1586a4=(_0x5a9b5b-_0x53be8c)/0x3e8;_0x50dfeb[_0x393133(0x191)]=_0x5a9b5b,_0x50dfeb[_0x393133(0x1d7)](_0x393133(0x1cb),{'room':_0x276ace[_0x393133(0x185)],'dt':_0x1586a4});}}}return _0x4b8a9a;}module[a5_0x2c1f5d(0x1af)]={'processSensorEvent':processSensorEvent,'getOutsideTemperatureNumeric':getOutsideTemperatureNumeric,'setPresence':setPresence,'abortExitTimer':abortExitTimer,'startExitTimer':startExitTimer};