const a5_0xabe6f7=a5_0xc002;(function(_0x2b7dec,_0x52aeb0){const _0x1ec9e8=a5_0xc002,_0x5753c3=_0x2b7dec();while(!![]){try{const _0x43bdd1=-parseInt(_0x1ec9e8(0x12d))/0x1*(-parseInt(_0x1ec9e8(0x117))/0x2)+-parseInt(_0x1ec9e8(0x153))/0x3*(-parseInt(_0x1ec9e8(0x16f))/0x4)+parseInt(_0x1ec9e8(0x137))/0x5+parseInt(_0x1ec9e8(0x122))/0x6+-parseInt(_0x1ec9e8(0x161))/0x7+parseInt(_0x1ec9e8(0x17e))/0x8+parseInt(_0x1ec9e8(0x13b))/0x9*(-parseInt(_0x1ec9e8(0x179))/0xa);if(_0x43bdd1===_0x52aeb0)break;else _0x5753c3['push'](_0x5753c3['shift']());}catch(_0x43afaa){_0x5753c3['push'](_0x5753c3['shift']());}}}(a5_0x4757,0x7555f));const a5_0x4133e1=(function(){let _0x1d3660=!![];return function(_0x4901b9,_0x7a1c31){const _0xd6b650=_0x1d3660?function(){const _0x426d5d=a5_0xc002;if(_0x7a1c31){const _0x46cd94=_0x7a1c31[_0x426d5d(0x17c)](_0x4901b9,arguments);return _0x7a1c31=null,_0x46cd94;}}:function(){};return _0x1d3660=![],_0xd6b650;};}()),a5_0x2dbfd9=a5_0x4133e1(this,function(){const _0x2ad3f0=a5_0xc002;return a5_0x2dbfd9[_0x2ad3f0(0x12f)]()[_0x2ad3f0(0x13d)](_0x2ad3f0(0x164))[_0x2ad3f0(0x12f)]()[_0x2ad3f0(0x130)](a5_0x2dbfd9)[_0x2ad3f0(0x13d)](_0x2ad3f0(0x164));});a5_0x2dbfd9();function a5_0xc002(_0xfcd121,_0xfec1e6){const _0x5f235d=a5_0x4757();return a5_0xc002=function(_0x2dbfd9,_0x4133e1){_0x2dbfd9=_0x2dbfd9-0x115;let _0x475740=_0x5f235d[_0x2dbfd9];return _0x475740;},a5_0xc002(_0xfcd121,_0xfec1e6);}'use strict';const HISTORY_MAX_SIZE=0x32,RAW_LOG_MAX_SIZE=0x9c4,THERMO_LOG_SIZE=0x3e8,SEQUENCE_TIMEOUT_MS=0x5*0x3c*0x3e8,MAX_TRAINING_SET_SIZE=0x1f4,EXIT_TIMER_MINUTES=0xf,EXIT_GRACE_PERIOD_SECONDS=0x1e;let activeSequence=[],sequenceTimer=null;async function getOutsideTemperatureNumeric(_0x143c2b){const _0x1857fa=a5_0xc002;if(_0x143c2b[_0x1857fa(0x157)][_0x1857fa(0x17d)])try{const _0x29e2f5=await _0x143c2b[_0x1857fa(0x12e)](_0x143c2b[_0x1857fa(0x157)][_0x1857fa(0x17d)]);if(_0x29e2f5&&_0x29e2f5[_0x1857fa(0x14f)]!==undefined&&_0x29e2f5[_0x1857fa(0x14f)]!==null)return parseFloat(_0x29e2f5[_0x1857fa(0x14f)]);}catch(_0x5cc087){}const _0xae1fef=_0x143c2b[_0x1857fa(0x157)][_0x1857fa(0x162)];if(!_0x143c2b[_0x1857fa(0x157)]['useWeather']||!_0xae1fef)return null;try{let _0x52a178='';if(_0xae1fef[_0x1857fa(0x178)](_0x1857fa(0x131)))_0x52a178=_0xae1fef+_0x1857fa(0x134);else{if(_0xae1fef[_0x1857fa(0x178)](_0x1857fa(0x15b)))_0x52a178=_0xae1fef+'.NextHours.Location_1.Day_1.current.temp_value';else{if(_0xae1fef[_0x1857fa(0x178)](_0x1857fa(0x171)))_0x52a178=_0xae1fef+'.forecast.current.temperature';else{if(_0xae1fef[_0x1857fa(0x178)](_0x1857fa(0x13c)))_0x52a178=_0xae1fef+_0x1857fa(0x133);}}}if(_0x52a178){const _0x42303c=await _0x143c2b[_0x1857fa(0x12e)](_0x52a178);if(_0x42303c&&_0x42303c['val']!==undefined&&_0x42303c[_0x1857fa(0x14f)]!==null)return parseFloat(_0x42303c[_0x1857fa(0x14f)]);}}catch(_0x580a5c){}return null;}async function recordThermodynamics(_0x2b5e8b,_0x100522,_0x1ac864,_0x2c0c6f){const _0xee368=a5_0xc002,_0x4e408d=await getOutsideTemperatureNumeric(_0x2b5e8b);if(_0x4e408d===null)return;let _0x17af34=0x0,_0x14cfc1=![];if(_0x2b5e8b[_0xee368(0x157)][_0xee368(0x139)])try{let _0x1d7940=_0x2b5e8b[_0xee368(0x157)][_0xee368(0x139)];if(typeof _0x1d7940==='string')_0x1d7940=JSON[_0xee368(0x174)](_0x1d7940);if(_0x1d7940[_0x100522]){const _0x514860=_0x1d7940[_0x100522],_0x535398=await _0x2b5e8b[_0xee368(0x12e)](_0x514860);if(_0x535398&&_0x535398[_0xee368(0x14f)]!==null&&_0x535398['val']!==undefined){let _0x8845f6=Number(_0x535398[_0xee368(0x14f)]);if(_0x8845f6<=1.05&&!_0x514860[_0xee368(0x178)](_0xee368(0x147))&&!_0x514860[_0xee368(0x178)](_0xee368(0x16b)))_0x8845f6=_0x8845f6*0x64;_0x17af34=Math['round'](_0x8845f6),_0x14cfc1=!![];}}}catch(_0x1e6a0f){}if(!_0x14cfc1){const _0x290f13=[{'from':_0xee368(0x141),'to':_0xee368(0x115)},{'from':_0xee368(0x141),'to':_0xee368(0x169)},{'from':_0xee368(0x16d),'to':'.4.VALVE_STATE'},{'from':_0xee368(0x11e),'to':'.LEVEL'},{'from':_0xee368(0x140),'to':_0xee368(0x132)},{'from':'Temperature','to':_0xee368(0x119)}];for(const _0x3a8046 of _0x290f13){if(_0x100522[_0xee368(0x178)](_0x3a8046[_0xee368(0x125)])){const _0xfc4ec5=_0x100522['replace'](_0x3a8046[_0xee368(0x125)],_0x3a8046['to']);try{const _0x79c548=await _0x2b5e8b['getForeignStateAsync'](_0xfc4ec5);if(_0x79c548&&_0x79c548[_0xee368(0x14f)]!==null&&_0x79c548[_0xee368(0x14f)]!==undefined){let _0x4ddc63=Number(_0x79c548[_0xee368(0x14f)]);if(typeof _0x4ddc63===_0xee368(0x128)){if(_0x4ddc63<=1.05&&_0x3a8046['to'][_0xee368(0x178)](_0xee368(0x15d)))_0x4ddc63=_0x4ddc63*0x64;_0x17af34=Math[_0xee368(0x160)](_0x4ddc63),_0x14cfc1=!![];break;}}}catch(_0x47bd8f){}}}}const _0x3947ac=await _0x2b5e8b[_0xee368(0x129)]('LTM.trainingData.thermodynamics');let _0x3cc9b6=[];if(_0x3947ac&&_0x3947ac[_0xee368(0x14f)])try{_0x3cc9b6=JSON[_0xee368(0x174)](_0x3947ac[_0xee368(0x14f)]);}catch(_0x457bc6){}_0x3cc9b6[_0xee368(0x12b)]({'ts':Date[_0xee368(0x118)](),'room':_0x2c0c6f||_0xee368(0x14d),'t_in':_0x1ac864,'t_out':_0x4e408d,'valve':_0x17af34});if(_0x3cc9b6[_0xee368(0x146)]>THERMO_LOG_SIZE)_0x3cc9b6[_0xee368(0x138)]();await _0x2b5e8b[_0xee368(0x11a)](_0xee368(0x14c),{'val':JSON['stringify'](_0x3cc9b6),'ack':!![]});}function a5_0x4757(){const _0x4cdf3d=['präsenz','4xcxaST','schloss','openweathermap','ANALYZE_SEQUENCE','LTM.trainingData.sequences','parse','\x20from\x20','switch','error','includes','10VdIWqt','events.lastEvent','lampe','apply','outdoorSensorId','7127216zzPRKs','LTM.rawEventLog','isPresent','.1.LEVEL','isGracePeriodActive','368314eisJOd','now','Valve','setStateAsync','toISOString','sendToPythonWrapper','tür','.ACTUAL_TEMPERATURE','lastTrackerEventTime','presence','SIMULATE_SIGNAL','3757836AgoNWe','eventHistory','value','from','message','isProVersion','number','getStateAsync','licht','push','splice','5QorqXx','getForeignStateAsync','toString','constructor','accuweather','level','.forecast.current.temp','.Current.Temperature','system.isPresent','schalter','3206255bgWufZ','shift','valveMapping','dimmer','21337263hGXyfV','weatherunderground','search','motion','normal','temperature','.1.ACTUAL_TEMPERATURE','rawEventLog','exitTimer','[RECORDER]\x20Error:\x20','window','length','STATUS','sensorLastValues','occupancy','stringify','log','LTM.trainingData.thermodynamics','Unknown','debug','val','exports','kontakt','bewegung','691059rIbCdI','type','heizung','light','config','[RECORDER]\x20Ignored\x20implausible\x20temperature:\x20','klima','events.history','daswetter','location','LEVEL','name','toLowerCase','round','3207281AsmRoC','weatherInstance','contact','(((.+)+)+)+$','griff','lock','some','isExit','.1.VALVE_STATE','exitGraceTimer','STATE','fenster','.1.TEMPERATURE'];a5_0x4757=function(){return _0x4cdf3d;};return a5_0x4757();}async function saveCompletedSequence(_0x4f90a7){const _0x4aed50=a5_0xc002;try{const _0x5ea7eb=await _0x4f90a7['getStateAsync'](_0x4aed50(0x173));let _0xbbdb2d=[];if(_0x5ea7eb&&_0x5ea7eb[_0x4aed50(0x14f)])try{_0xbbdb2d=JSON[_0x4aed50(0x174)](_0x5ea7eb[_0x4aed50(0x14f)]);}catch(_0xb75bf1){}const _0x3e994c=activeSequence[0x0]['ts'],_0x5012c6=activeSequence['map'](_0x5839bc=>({'loc':_0x5839bc['loc'],'t_delta':Math['round']((_0x5839bc['ts']-_0x3e994c)/0x3e8)})),_0x2a0f70={'timestamp':new Date(_0x3e994c)[_0x4aed50(0x11b)](),'steps':_0x5012c6,'duration':Math['round']((activeSequence[activeSequence[_0x4aed50(0x146)]-0x1]['ts']-_0x3e994c)/0x3e8),'daytime':new Date(_0x3e994c)['getHours']()};_0xbbdb2d[_0x4aed50(0x12b)](_0x2a0f70);if(_0xbbdb2d['length']>MAX_TRAINING_SET_SIZE)_0xbbdb2d[_0x4aed50(0x138)]();await _0x4f90a7[_0x4aed50(0x11a)](_0x4aed50(0x173),{'val':JSON['stringify'](_0xbbdb2d),'ack':!![]}),_0x4f90a7[_0x4aed50(0x127)]&&_0x4f90a7[_0x4aed50(0x11c)]&&_0x4f90a7[_0x4aed50(0x11c)](_0x4aed50(0x172),{'sequence':_0x2a0f70});}catch(_0x5b4270){_0x4f90a7[_0x4aed50(0x14b)][_0x4aed50(0x177)](_0x4aed50(0x144)+_0x5b4270[_0x4aed50(0x126)]);}}async function recordSequence(_0x3b2104,_0x26abf0){const _0x4019ba=a5_0xc002,_0xad49e1=(_0x26abf0[_0x4019ba(0x154)]||'')['toLowerCase'](),_0x22a4d2=['motion',_0x4019ba(0x152),_0x4019ba(0x16e),_0x4019ba(0x120),_0x4019ba(0x149),'door','tür',_0x4019ba(0x145),_0x4019ba(0x16c),_0x4019ba(0x163),_0x4019ba(0x151),_0x4019ba(0x156),_0x4019ba(0x12a),_0x4019ba(0x176),_0x4019ba(0x136),_0x4019ba(0x13a),_0x4019ba(0x17b)];if(!_0x22a4d2[_0x4019ba(0x167)](_0x30998b=>_0xad49e1[_0x4019ba(0x178)](_0x30998b)))return;if(!_0x26abf0[_0x4019ba(0x124)])return;if(sequenceTimer)clearTimeout(sequenceTimer);activeSequence[_0x4019ba(0x12b)]({'loc':_0x26abf0[_0x4019ba(0x15c)]||_0x4019ba(0x14d),'id':_0x26abf0['id'],'ts':Date[_0x4019ba(0x118)]()}),sequenceTimer=setTimeout(async()=>{if(activeSequence['length']>0x1)await saveCompletedSequence(_0x3b2104);activeSequence=[];},SEQUENCE_TIMEOUT_MS);}function startExitTimer(_0x4fd0a9){const _0x2e898d=a5_0xc002;abortExitTimer(_0x4fd0a9),_0x4fd0a9[_0x2e898d(0x116)]=!![],_0x4fd0a9[_0x2e898d(0x16a)]=setTimeout(()=>{const _0x3d6607=_0x2e898d;_0x4fd0a9[_0x3d6607(0x116)]=![];},EXIT_GRACE_PERIOD_SECONDS*0x3e8),_0x4fd0a9[_0x2e898d(0x143)]=setTimeout(()=>{const _0x43131a=_0x2e898d;setPresence(_0x4fd0a9,![]),_0x4fd0a9[_0x43131a(0x143)]=null;},EXIT_TIMER_MINUTES*0x3c*0x3e8);}function abortExitTimer(_0x5248e0){const _0x4d4bd4=a5_0xc002;if(_0x5248e0[_0x4d4bd4(0x143)])clearTimeout(_0x5248e0['exitTimer']);if(_0x5248e0[_0x4d4bd4(0x16a)])clearTimeout(_0x5248e0[_0x4d4bd4(0x16a)]);_0x5248e0[_0x4d4bd4(0x143)]=null,_0x5248e0[_0x4d4bd4(0x16a)]=null,_0x5248e0[_0x4d4bd4(0x116)]=![];}async function setPresence(_0x2b2096,_0x4d821b){const _0xce70ce=a5_0xc002;if(_0x2b2096[_0xce70ce(0x180)]===_0x4d821b)return;_0x2b2096[_0xce70ce(0x180)]=_0x4d821b,await _0x2b2096[_0xce70ce(0x11a)](_0xce70ce(0x135),{'val':_0x4d821b,'ack':!![]});}async function processSensorEvent(_0x2aaed8,_0x11b4d3,_0x4e549e,_0x3a7ab9){const _0x3f9d3a=a5_0xc002;if(!_0x3a7ab9)return null;const _0x3c3bd5=_0x4e549e['val'],_0x163b8f=Date[_0x3f9d3a(0x118)](),_0x2ed7d0=_0x2aaed8['sensorLastValues'][_0x11b4d3],_0x30e029=(_0x3a7ab9[_0x3f9d3a(0x154)]||'')[_0x3f9d3a(0x15f)](),_0x5b47b3=_0x30e029['includes'](_0x3f9d3a(0x140))||_0x30e029[_0x3f9d3a(0x178)]('temperatur')||_0x30e029['includes'](_0x3f9d3a(0x159))||_0x30e029[_0x3f9d3a(0x178)](_0x3f9d3a(0x155))||_0x30e029[_0x3f9d3a(0x178)]('thermostat');if(_0x5b47b3&&typeof _0x3c3bd5==='number'){if(_0x3c3bd5>0x50||_0x3c3bd5<-0x32)return _0x2aaed8[_0x3f9d3a(0x14b)][_0x3f9d3a(0x14e)](_0x3f9d3a(0x158)+_0x3c3bd5+_0x3f9d3a(0x175)+_0x11b4d3),null;}_0x2aaed8[_0x3f9d3a(0x148)][_0x11b4d3]=_0x3c3bd5;if(!_0x3a7ab9['logDuplicates']&&_0x2ed7d0!=undefined&&_0x2ed7d0==_0x3c3bd5)return null;_0x2aaed8[_0x3f9d3a(0x127)]&&_0x5b47b3&&recordThermodynamics(_0x2aaed8,_0x11b4d3,_0x3c3bd5,_0x3a7ab9[_0x3f9d3a(0x15c)]);const _0x23fa2b={'timestamp':_0x163b8f,'id':_0x11b4d3,'name':_0x3a7ab9[_0x3f9d3a(0x15e)],'type':_0x3a7ab9[_0x3f9d3a(0x154)],'location':_0x3a7ab9[_0x3f9d3a(0x15c)],'value':_0x3c3bd5};_0x2aaed8[_0x3f9d3a(0x123)]['unshift'](_0x23fa2b);if(_0x2aaed8[_0x3f9d3a(0x123)][_0x3f9d3a(0x146)]>HISTORY_MAX_SIZE)_0x2aaed8['eventHistory']['pop']();await _0x2aaed8[_0x3f9d3a(0x11a)](_0x3f9d3a(0x17a),{'val':JSON['stringify'](_0x23fa2b),'ack':!![]}),await _0x2aaed8[_0x3f9d3a(0x11a)](_0x3f9d3a(0x15a),{'val':JSON[_0x3f9d3a(0x14a)](_0x2aaed8[_0x3f9d3a(0x123)]),'ack':!![]});if(_0x2aaed8[_0x3f9d3a(0x127)]){_0x2aaed8[_0x3f9d3a(0x142)][_0x3f9d3a(0x12b)](_0x23fa2b);if(_0x2aaed8[_0x3f9d3a(0x142)][_0x3f9d3a(0x146)]>RAW_LOG_MAX_SIZE)_0x2aaed8[_0x3f9d3a(0x142)][_0x3f9d3a(0x12c)](0x0,_0x2aaed8[_0x3f9d3a(0x142)][_0x3f9d3a(0x146)]-RAW_LOG_MAX_SIZE);await _0x2aaed8[_0x3f9d3a(0x11a)](_0x3f9d3a(0x17f),{'val':JSON[_0x3f9d3a(0x14a)](_0x2aaed8['rawEventLog']),'ack':!![]}),recordSequence(_0x2aaed8,_0x23fa2b);}if(_0x3a7ab9[_0x3f9d3a(0x168)]&&_0x3c3bd5===!![]){if(_0x2aaed8[_0x3f9d3a(0x180)]&&!_0x2aaed8[_0x3f9d3a(0x116)])startExitTimer(_0x2aaed8);else{if(!_0x2aaed8[_0x3f9d3a(0x180)])setPresence(_0x2aaed8,!![]);}}else{if(_0x3a7ab9[_0x3f9d3a(0x154)]===_0x3f9d3a(0x13e)&&_0x3c3bd5===!![]){if(_0x2aaed8[_0x3f9d3a(0x143)])abortExitTimer(_0x2aaed8);if(!_0x2aaed8['isPresent']&&_0x2aaed8['currentSystemMode']===_0x3f9d3a(0x13f))setPresence(_0x2aaed8,!![]);}}if(_0x2aaed8[_0x3f9d3a(0x127)]&&_0x2aaed8[_0x3f9d3a(0x11c)]){_0x3a7ab9['type']===_0x3f9d3a(0x13e)&&_0x3c3bd5===!![]&&_0x3a7ab9[_0x3f9d3a(0x15c)]&&_0x2aaed8[_0x3f9d3a(0x11c)](_0x3f9d3a(0x121),{'room':_0x3a7ab9['location']});const _0x2cb1ed=['door',_0x3f9d3a(0x11d),_0x3f9d3a(0x145),_0x3f9d3a(0x16c),_0x3f9d3a(0x165),'handle',_0x3f9d3a(0x166),_0x3f9d3a(0x170)][_0x3f9d3a(0x167)](_0x5d9dde=>_0x30e029[_0x3f9d3a(0x178)](_0x5d9dde)),_0x345b24=['light',_0x3f9d3a(0x12a),'switch',_0x3f9d3a(0x136),_0x3f9d3a(0x13a),_0x3f9d3a(0x17b)][_0x3f9d3a(0x167)](_0x219de4=>_0x30e029['includes'](_0x219de4)),_0x3ff962=[_0x3f9d3a(0x13e),_0x3f9d3a(0x152),_0x3f9d3a(0x16e),_0x3f9d3a(0x120),_0x3f9d3a(0x149)][_0x3f9d3a(0x167)](_0x13ea62=>_0x30e029['includes'](_0x13ea62));if(_0x3a7ab9[_0x3f9d3a(0x15c)]&&(_0x2cb1ed||_0x345b24||_0x3ff962)){const _0x202b1b=_0x3c3bd5===!![]||typeof _0x3c3bd5===_0x3f9d3a(0x128)&&_0x3c3bd5>0x0,_0x5decfa=_0x2cb1ed&&!_0x202b1b&&_0x2ed7d0!==undefined&&_0x2ed7d0!=_0x3c3bd5;if(_0x202b1b||_0x5decfa){const _0x4c0674=_0x2aaed8[_0x3f9d3a(0x11f)]||_0x163b8f,_0x1af137=(_0x163b8f-_0x4c0674)/0x3e8;_0x2aaed8[_0x3f9d3a(0x11f)]=_0x163b8f,_0x2aaed8[_0x3f9d3a(0x11c)]('TRACK_EVENT',{'room':_0x3a7ab9[_0x3f9d3a(0x15c)],'dt':_0x1af137});}}}return _0x23fa2b;}module[a5_0xabe6f7(0x150)]={'processSensorEvent':processSensorEvent,'getOutsideTemperatureNumeric':getOutsideTemperatureNumeric,'setPresence':setPresence,'abortExitTimer':abortExitTimer,'startExitTimer':startExitTimer};