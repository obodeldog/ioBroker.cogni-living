const a5_0x117ff9=a5_0x301c;(function(_0x4f6564,_0x4a9acf){const _0x1be342=a5_0x301c,_0x2e26ed=_0x4f6564();while(!![]){try{const _0x59e372=-parseInt(_0x1be342(0xf8))/0x1+parseInt(_0x1be342(0x132))/0x2*(parseInt(_0x1be342(0xf4))/0x3)+parseInt(_0x1be342(0xff))/0x4*(-parseInt(_0x1be342(0xf2))/0x5)+parseInt(_0x1be342(0xcc))/0x6*(-parseInt(_0x1be342(0x10d))/0x7)+-parseInt(_0x1be342(0x12a))/0x8+-parseInt(_0x1be342(0x101))/0x9+parseInt(_0x1be342(0x107))/0xa*(parseInt(_0x1be342(0xe9))/0xb);if(_0x59e372===_0x4a9acf)break;else _0x2e26ed['push'](_0x2e26ed['shift']());}catch(_0x486b75){_0x2e26ed['push'](_0x2e26ed['shift']());}}}(a5_0x27da,0x57ad8));const a5_0x3d382e=(function(){let _0x52419a=!![];return function(_0x18ab67,_0x55be39){const _0x5c3184=_0x52419a?function(){const _0x67f2ff=a5_0x301c;if(_0x55be39){const _0xa52a44=_0x55be39[_0x67f2ff(0x125)](_0x18ab67,arguments);return _0x55be39=null,_0xa52a44;}}:function(){};return _0x52419a=![],_0x5c3184;};}()),a5_0x28ba52=a5_0x3d382e(this,function(){const _0x5c8104=a5_0x301c;return a5_0x28ba52[_0x5c8104(0x106)]()[_0x5c8104(0xd0)](_0x5c8104(0x104))['toString']()[_0x5c8104(0xd7)](a5_0x28ba52)[_0x5c8104(0xd0)](_0x5c8104(0x104));});a5_0x28ba52();'use strict';function a5_0x27da(){const _0x3b3d9b=['normal','isExit','val','from','message','licht','door','LEVEL','currentSystemMode','eventHistory','getStateAsync','LTM.trainingData.thermodynamics','.1.VALVE_STATE','thermostat','isProVersion','apply','.LEVEL','outdoorSensorId','.ACTUAL_TEMPERATURE','rawEventLog','3562968hNncGn','temperatur','motion','pr채senz','[RECORDER]\x20Ignored\x20implausible\x20temperature:\x20','sensorLastValues','length','log','2YTfSjv','LTM.trainingData.sequences','presence','loc','\x20from\x20','ANALYZE_SEQUENCE','toISOString','window','logDuplicates','.NextHours.Location_1.Day_1.current.temp_value','18aqojcY','valveMapping','exitTimer','number','search','push','map','heizung','round','error','fenster','constructor','t체r','Unknown','temperature','debug','bewegung','config','isPresent','kontakt','.4.VALVE_STATE','[RECORDER]\x20Error:\x20','events.lastEvent','sendToPythonWrapper','getHours','exitGraceTimer','parse','isGracePeriodActive','griff','3986455jBVNSm','pop','some','stringify','weatherunderground','.1.ACTUAL_TEMPERATURE','daswetter','switch','Temperature','5MXoDju','includes','1860177FhRZcU','occupancy','unshift','contact','129441dHEtFF','schalter','getForeignStateAsync','setStateAsync','toLowerCase','replace','SIMULATE_SIGNAL','208388FVjvha','location','1997739CAkfwW','Valve','string','(((.+)+)+)+$','splice','toString','30FnFOjG','.forecast.current.temp','schloss','type','handle','lastTrackerEventTime','1164954ALJuJf','now','.1.TEMPERATURE','.Current.Temperature','exports','weatherInstance','light','level','lampe'];a5_0x27da=function(){return _0x3b3d9b;};return a5_0x27da();}const HISTORY_MAX_SIZE=0x32,RAW_LOG_MAX_SIZE=0x9c4,THERMO_LOG_SIZE=0x3e8,SEQUENCE_TIMEOUT_MS=0x5*0x3c*0x3e8,MAX_TRAINING_SET_SIZE=0x1f4,EXIT_TIMER_MINUTES=0xf,EXIT_GRACE_PERIOD_SECONDS=0x1e;let activeSequence=[],sequenceTimer=null;async function getOutsideTemperatureNumeric(_0x119900){const _0x5ae1d9=a5_0x301c;if(_0x119900[_0x5ae1d9(0xdd)][_0x5ae1d9(0x127)])try{const _0x527a17=await _0x119900['getForeignStateAsync'](_0x119900['config']['outdoorSensorId']);if(_0x527a17&&_0x527a17[_0x5ae1d9(0x118)]!==undefined&&_0x527a17[_0x5ae1d9(0x118)]!==null)return parseFloat(_0x527a17['val']);}catch(_0x11306f){}const _0xc38b71=_0x119900[_0x5ae1d9(0xdd)][_0x5ae1d9(0x112)];if(!_0x119900[_0x5ae1d9(0xdd)]['useWeather']||!_0xc38b71)return null;try{let _0x838c48='';if(_0xc38b71[_0x5ae1d9(0xf3)]('accuweather'))_0x838c48=_0xc38b71+_0x5ae1d9(0x110);else{if(_0xc38b71[_0x5ae1d9(0xf3)](_0x5ae1d9(0xef)))_0x838c48=_0xc38b71+_0x5ae1d9(0xcb);else{if(_0xc38b71[_0x5ae1d9(0xf3)]('openweathermap'))_0x838c48=_0xc38b71+'.forecast.current.temperature';else{if(_0xc38b71[_0x5ae1d9(0xf3)](_0x5ae1d9(0xed)))_0x838c48=_0xc38b71+_0x5ae1d9(0x108);}}}if(_0x838c48){const _0x53b128=await _0x119900[_0x5ae1d9(0xfa)](_0x838c48);if(_0x53b128&&_0x53b128['val']!==undefined&&_0x53b128[_0x5ae1d9(0x118)]!==null)return parseFloat(_0x53b128['val']);}}catch(_0x616794){}return null;}async function recordThermodynamics(_0x43cf55,_0x226662,_0x3e09bf,_0x469abe){const _0x371187=a5_0x301c,_0x11f801=await getOutsideTemperatureNumeric(_0x43cf55);if(_0x11f801===null)return;let _0x31ba1b=0x0,_0x5a03ec=![];if(_0x43cf55[_0x371187(0xdd)][_0x371187(0xcd)])try{let _0x2afe42=_0x43cf55[_0x371187(0xdd)][_0x371187(0xcd)];if(typeof _0x2afe42===_0x371187(0x103))_0x2afe42=JSON[_0x371187(0xe6)](_0x2afe42);if(_0x2afe42[_0x226662]){const _0x323cc3=_0x2afe42[_0x226662],_0x819052=await _0x43cf55['getForeignStateAsync'](_0x323cc3);if(_0x819052&&_0x819052[_0x371187(0x118)]!==null&&_0x819052['val']!==undefined){let _0x1a0296=Number(_0x819052[_0x371187(0x118)]);if(_0x1a0296<=1.05&&!_0x323cc3[_0x371187(0xf3)]('STATUS')&&!_0x323cc3[_0x371187(0xf3)]('STATE'))_0x1a0296=_0x1a0296*0x64;_0x31ba1b=Math[_0x371187(0xd4)](_0x1a0296),_0x5a03ec=!![];}}}catch(_0x37b84c){}if(!_0x5a03ec){const _0x336a0d=[{'from':_0x371187(0xee),'to':'.1.LEVEL'},{'from':_0x371187(0xee),'to':_0x371187(0x122)},{'from':_0x371187(0x10f),'to':_0x371187(0xe0)},{'from':_0x371187(0x128),'to':_0x371187(0x126)},{'from':'temperature','to':_0x371187(0x114)},{'from':_0x371187(0xf1),'to':_0x371187(0x102)}];for(const _0x102453 of _0x336a0d){if(_0x226662['includes'](_0x102453[_0x371187(0x119)])){const _0x50232d=_0x226662[_0x371187(0xfd)](_0x102453['from'],_0x102453['to']);try{const _0x2762ba=await _0x43cf55[_0x371187(0xfa)](_0x50232d);if(_0x2762ba&&_0x2762ba[_0x371187(0x118)]!==null&&_0x2762ba[_0x371187(0x118)]!==undefined){let _0x207b3d=Number(_0x2762ba[_0x371187(0x118)]);if(typeof _0x207b3d===_0x371187(0xcf)){if(_0x207b3d<=1.05&&_0x102453['to'][_0x371187(0xf3)](_0x371187(0x11d)))_0x207b3d=_0x207b3d*0x64;_0x31ba1b=Math['round'](_0x207b3d),_0x5a03ec=!![];break;}}}catch(_0x1fd6e8){}}}}const _0xa7168a=await _0x43cf55[_0x371187(0x120)](_0x371187(0x121));let _0xc6d1da=[];if(_0xa7168a&&_0xa7168a[_0x371187(0x118)])try{_0xc6d1da=JSON[_0x371187(0xe6)](_0xa7168a[_0x371187(0x118)]);}catch(_0x72d851){}_0xc6d1da['push']({'ts':Date[_0x371187(0x10e)](),'room':_0x469abe||_0x371187(0xd9),'t_in':_0x3e09bf,'t_out':_0x11f801,'valve':_0x31ba1b});if(_0xc6d1da[_0x371187(0x130)]>THERMO_LOG_SIZE)_0xc6d1da['shift']();await _0x43cf55['setStateAsync'](_0x371187(0x121),{'val':JSON[_0x371187(0xec)](_0xc6d1da),'ack':!![]});}async function saveCompletedSequence(_0x34c71d){const _0x54e96a=a5_0x301c;try{const _0x1da2cc=await _0x34c71d[_0x54e96a(0x120)](_0x54e96a(0x133));let _0x487f93=[];if(_0x1da2cc&&_0x1da2cc[_0x54e96a(0x118)])try{_0x487f93=JSON[_0x54e96a(0xe6)](_0x1da2cc[_0x54e96a(0x118)]);}catch(_0x654d06){}const _0x2ef5dd=activeSequence[0x0]['ts'],_0x4e5a40=activeSequence[_0x54e96a(0xd2)](_0x1c5a7c=>({'loc':_0x1c5a7c[_0x54e96a(0x135)],'t_delta':Math[_0x54e96a(0xd4)]((_0x1c5a7c['ts']-_0x2ef5dd)/0x3e8)})),_0x56ade5={'timestamp':new Date(_0x2ef5dd)[_0x54e96a(0x138)](),'steps':_0x4e5a40,'duration':Math[_0x54e96a(0xd4)]((activeSequence[activeSequence[_0x54e96a(0x130)]-0x1]['ts']-_0x2ef5dd)/0x3e8),'daytime':new Date(_0x2ef5dd)[_0x54e96a(0xe4)]()};_0x487f93['push'](_0x56ade5);if(_0x487f93[_0x54e96a(0x130)]>MAX_TRAINING_SET_SIZE)_0x487f93['shift']();await _0x34c71d[_0x54e96a(0xfb)](_0x54e96a(0x133),{'val':JSON['stringify'](_0x487f93),'ack':!![]}),_0x34c71d[_0x54e96a(0x124)]&&_0x34c71d['sendToPythonWrapper']&&_0x34c71d[_0x54e96a(0xe3)](_0x54e96a(0x137),{'sequence':_0x56ade5});}catch(_0x467f64){_0x34c71d['log'][_0x54e96a(0xd5)](_0x54e96a(0xe1)+_0x467f64[_0x54e96a(0x11a)]);}}async function recordSequence(_0x2d0602,_0x288efd){const _0x840136=a5_0x301c,_0x7b0962=(_0x288efd[_0x840136(0x10a)]||'')['toLowerCase'](),_0x372b18=[_0x840136(0x12c),_0x840136(0xdc),'pr채senz','presence',_0x840136(0xf5),_0x840136(0x11c),'t체r',_0x840136(0xc9),_0x840136(0xd6),_0x840136(0xf7),_0x840136(0xdf),'light',_0x840136(0x11b),'switch',_0x840136(0xf9),'dimmer',_0x840136(0x115)];if(!_0x372b18['some'](_0xd5c18=>_0x7b0962[_0x840136(0xf3)](_0xd5c18)))return;if(!_0x288efd['value'])return;if(sequenceTimer)clearTimeout(sequenceTimer);activeSequence['push']({'loc':_0x288efd[_0x840136(0x100)]||_0x840136(0xd9),'id':_0x288efd['id'],'ts':Date['now']()}),sequenceTimer=setTimeout(async()=>{const _0x2af827=_0x840136;if(activeSequence[_0x2af827(0x130)]>0x1)await saveCompletedSequence(_0x2d0602);activeSequence=[];},SEQUENCE_TIMEOUT_MS);}function startExitTimer(_0x1d0cf0){const _0x59160b=a5_0x301c;abortExitTimer(_0x1d0cf0),_0x1d0cf0[_0x59160b(0xe7)]=!![],_0x1d0cf0[_0x59160b(0xe5)]=setTimeout(()=>{_0x1d0cf0['isGracePeriodActive']=![];},EXIT_GRACE_PERIOD_SECONDS*0x3e8),_0x1d0cf0[_0x59160b(0xce)]=setTimeout(()=>{const _0x4b7b43=_0x59160b;setPresence(_0x1d0cf0,![]),_0x1d0cf0[_0x4b7b43(0xce)]=null;},EXIT_TIMER_MINUTES*0x3c*0x3e8);}function abortExitTimer(_0x442b9d){const _0xe291ff=a5_0x301c;if(_0x442b9d[_0xe291ff(0xce)])clearTimeout(_0x442b9d[_0xe291ff(0xce)]);if(_0x442b9d[_0xe291ff(0xe5)])clearTimeout(_0x442b9d[_0xe291ff(0xe5)]);_0x442b9d['exitTimer']=null,_0x442b9d[_0xe291ff(0xe5)]=null,_0x442b9d[_0xe291ff(0xe7)]=![];}async function setPresence(_0x3ad527,_0x5d66df){const _0x3539d3=a5_0x301c;if(_0x3ad527[_0x3539d3(0xde)]===_0x5d66df)return;_0x3ad527[_0x3539d3(0xde)]=_0x5d66df,await _0x3ad527[_0x3539d3(0xfb)]('system.isPresent',{'val':_0x5d66df,'ack':!![]});}function a5_0x301c(_0x409730,_0x5ddc4b){const _0x4fd3e4=a5_0x27da();return a5_0x301c=function(_0x28ba52,_0x3d382e){_0x28ba52=_0x28ba52-0xc9;let _0x27da02=_0x4fd3e4[_0x28ba52];return _0x27da02;},a5_0x301c(_0x409730,_0x5ddc4b);}async function processSensorEvent(_0x2b74e9,_0x7c03ba,_0x2b3e5f,_0x15ec90){const _0x2e678f=a5_0x301c;if(!_0x15ec90)return null;const _0x156c58=_0x2b3e5f[_0x2e678f(0x118)],_0x552c59=Date[_0x2e678f(0x10e)](),_0x2b7a6c=_0x2b74e9[_0x2e678f(0x12f)][_0x7c03ba],_0x399e39=(_0x15ec90[_0x2e678f(0x10a)]||'')[_0x2e678f(0xfc)](),_0x9ae18a=_0x399e39['includes'](_0x2e678f(0xda))||_0x399e39[_0x2e678f(0xf3)](_0x2e678f(0x12b))||_0x399e39['includes']('klima')||_0x399e39[_0x2e678f(0xf3)](_0x2e678f(0xd3))||_0x399e39[_0x2e678f(0xf3)](_0x2e678f(0x123));if(_0x9ae18a&&typeof _0x156c58===_0x2e678f(0xcf)){if(_0x156c58>0x50||_0x156c58<-0x32)return _0x2b74e9[_0x2e678f(0x131)][_0x2e678f(0xdb)](_0x2e678f(0x12e)+_0x156c58+_0x2e678f(0x136)+_0x7c03ba),null;}_0x2b74e9[_0x2e678f(0x12f)][_0x7c03ba]=_0x156c58;if(!_0x15ec90[_0x2e678f(0xca)]&&_0x2b7a6c!=undefined&&_0x2b7a6c==_0x156c58)return null;_0x2b74e9[_0x2e678f(0x124)]&&_0x9ae18a&&recordThermodynamics(_0x2b74e9,_0x7c03ba,_0x156c58,_0x15ec90[_0x2e678f(0x100)]);const _0x20c8e9={'timestamp':_0x552c59,'id':_0x7c03ba,'name':_0x15ec90['name'],'type':_0x15ec90[_0x2e678f(0x10a)],'location':_0x15ec90[_0x2e678f(0x100)],'value':_0x156c58};_0x2b74e9[_0x2e678f(0x11f)][_0x2e678f(0xf6)](_0x20c8e9);if(_0x2b74e9[_0x2e678f(0x11f)][_0x2e678f(0x130)]>HISTORY_MAX_SIZE)_0x2b74e9[_0x2e678f(0x11f)][_0x2e678f(0xea)]();await _0x2b74e9[_0x2e678f(0xfb)](_0x2e678f(0xe2),{'val':JSON[_0x2e678f(0xec)](_0x20c8e9),'ack':!![]}),await _0x2b74e9['setStateAsync']('events.history',{'val':JSON[_0x2e678f(0xec)](_0x2b74e9[_0x2e678f(0x11f)]),'ack':!![]});if(_0x2b74e9['isProVersion']){_0x2b74e9['rawEventLog'][_0x2e678f(0xd1)](_0x20c8e9);if(_0x2b74e9[_0x2e678f(0x129)]['length']>RAW_LOG_MAX_SIZE)_0x2b74e9[_0x2e678f(0x129)][_0x2e678f(0x105)](0x0,_0x2b74e9[_0x2e678f(0x129)][_0x2e678f(0x130)]-RAW_LOG_MAX_SIZE);await _0x2b74e9[_0x2e678f(0xfb)]('LTM.rawEventLog',{'val':JSON[_0x2e678f(0xec)](_0x2b74e9[_0x2e678f(0x129)]),'ack':!![]}),recordSequence(_0x2b74e9,_0x20c8e9);}if(_0x15ec90[_0x2e678f(0x117)]&&_0x156c58===!![]){if(_0x2b74e9[_0x2e678f(0xde)]&&!_0x2b74e9[_0x2e678f(0xe7)])startExitTimer(_0x2b74e9);else{if(!_0x2b74e9[_0x2e678f(0xde)])setPresence(_0x2b74e9,!![]);}}else{if(_0x15ec90[_0x2e678f(0x10a)]==='motion'&&_0x156c58===!![]){if(_0x2b74e9['exitTimer'])abortExitTimer(_0x2b74e9);if(!_0x2b74e9[_0x2e678f(0xde)]&&_0x2b74e9[_0x2e678f(0x11e)]===_0x2e678f(0x116))setPresence(_0x2b74e9,!![]);}}if(_0x2b74e9['isProVersion']&&_0x2b74e9[_0x2e678f(0xe3)]){_0x15ec90['type']===_0x2e678f(0x12c)&&_0x156c58===!![]&&_0x15ec90['location']&&_0x2b74e9['sendToPythonWrapper'](_0x2e678f(0xfe),{'room':_0x15ec90[_0x2e678f(0x100)]});const _0x26ec6f=[_0x2e678f(0x11c),_0x2e678f(0xd8),_0x2e678f(0xc9),_0x2e678f(0xd6),_0x2e678f(0xe8),_0x2e678f(0x10b),'lock',_0x2e678f(0x109)][_0x2e678f(0xeb)](_0x346609=>_0x399e39['includes'](_0x346609)),_0x8b09f8=[_0x2e678f(0x113),_0x2e678f(0x11b),_0x2e678f(0xf0),_0x2e678f(0xf9),'dimmer','lampe']['some'](_0x1f1418=>_0x399e39['includes'](_0x1f1418)),_0x566816=['motion',_0x2e678f(0xdc),_0x2e678f(0x12d),_0x2e678f(0x134),_0x2e678f(0xf5)]['some'](_0x5c553d=>_0x399e39[_0x2e678f(0xf3)](_0x5c553d));if(_0x15ec90[_0x2e678f(0x100)]&&(_0x26ec6f||_0x8b09f8||_0x566816)){const _0x1c523f=_0x156c58===!![]||typeof _0x156c58===_0x2e678f(0xcf)&&_0x156c58>0x0,_0x49c593=_0x26ec6f&&!_0x1c523f&&_0x2b7a6c!==undefined&&_0x2b7a6c!=_0x156c58;if(_0x1c523f||_0x49c593){const _0xf43bcd=_0x2b74e9[_0x2e678f(0x10c)]||_0x552c59,_0x433e29=(_0x552c59-_0xf43bcd)/0x3e8;_0x2b74e9[_0x2e678f(0x10c)]=_0x552c59,_0x2b74e9[_0x2e678f(0xe3)]('TRACK_EVENT',{'room':_0x15ec90['location'],'dt':_0x433e29});}}}return _0x20c8e9;}module[a5_0x117ff9(0x111)]={'processSensorEvent':processSensorEvent,'getOutsideTemperatureNumeric':getOutsideTemperatureNumeric,'setPresence':setPresence,'abortExitTimer':abortExitTimer,'startExitTimer':startExitTimer};