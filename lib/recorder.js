(function(_0x4ded01,_0x2d2f43){const _0x3d3cef=a5_0x4dda,_0x3b668d=_0x4ded01();while(!![]){try{const _0x137745=parseInt(_0x3d3cef(0x1c6))/0x1+-parseInt(_0x3d3cef(0x1b5))/0x2+-parseInt(_0x3d3cef(0x1de))/0x3+-parseInt(_0x3d3cef(0x1af))/0x4*(-parseInt(_0x3d3cef(0x1cd))/0x5)+parseInt(_0x3d3cef(0x1ea))/0x6*(parseInt(_0x3d3cef(0x1db))/0x7)+parseInt(_0x3d3cef(0x1a7))/0x8*(-parseInt(_0x3d3cef(0x1c1))/0x9)+parseInt(_0x3d3cef(0x1ec))/0xa*(-parseInt(_0x3d3cef(0x1e7))/0xb);if(_0x137745===_0x2d2f43)break;else _0x3b668d['push'](_0x3b668d['shift']());}catch(_0x5f1df8){_0x3b668d['push'](_0x3b668d['shift']());}}}(a5_0x4c0d,0x9a05f));const a5_0x14b59f=(function(){let _0x307670=!![];return function(_0x21ae0b,_0x304b3b){const _0x4147ea=_0x307670?function(){const _0x4f148e=a5_0x4dda;if(_0x304b3b){const _0x5b2afa=_0x304b3b[_0x4f148e(0x19c)](_0x21ae0b,arguments);return _0x304b3b=null,_0x5b2afa;}}:function(){};return _0x307670=![],_0x4147ea;};}()),a5_0x22e8bd=a5_0x14b59f(this,function(){const _0x232090=a5_0x4dda;return a5_0x22e8bd[_0x232090(0x1fd)]()[_0x232090(0x1e0)]('(((.+)+)+)+$')[_0x232090(0x1fd)]()[_0x232090(0x197)](a5_0x22e8bd)['search'](_0x232090(0x1a6));});a5_0x22e8bd();'use strict';const HISTORY_MAX_SIZE=0x32,RAW_LOG_MAX_SIZE=0x9c4,THERMO_LOG_SIZE=0x3e8,SEQUENCE_TIMEOUT_MS=0x5*0x3c*0x3e8,MAX_TRAINING_SET_SIZE=0x1f4,EXIT_TIMER_MINUTES=0xf,EXIT_GRACE_PERIOD_SECONDS=0x1e;let activeSequence=[],sequenceTimer=null;async function getOutsideTemperatureNumeric(_0x1764ba){const _0x1db8b3=a5_0x4dda;if(_0x1764ba[_0x1db8b3(0x1ad)]['outdoorSensorId'])try{const _0x53c1b2=await _0x1764ba[_0x1db8b3(0x1f5)](_0x1764ba['config']['outdoorSensorId']);if(_0x53c1b2&&_0x53c1b2['val']!==undefined&&_0x53c1b2[_0x1db8b3(0x1ae)]!==null)return parseFloat(_0x53c1b2[_0x1db8b3(0x1ae)]);}catch(_0x1ef70f){}const _0x4f9b6c=_0x1764ba[_0x1db8b3(0x1ad)][_0x1db8b3(0x1fb)];if(!_0x1764ba[_0x1db8b3(0x1ad)][_0x1db8b3(0x1fe)]||!_0x4f9b6c)return null;try{let _0x30f916='';if(_0x4f9b6c['includes']('accuweather'))_0x30f916=_0x4f9b6c+'.Current.Temperature';else{if(_0x4f9b6c[_0x1db8b3(0x1a3)]('daswetter'))_0x30f916=_0x4f9b6c+'.NextHours.Location_1.Day_1.current.temp_value';else{if(_0x4f9b6c[_0x1db8b3(0x1a3)]('openweathermap'))_0x30f916=_0x4f9b6c+_0x1db8b3(0x1c9);else{if(_0x4f9b6c[_0x1db8b3(0x1a3)](_0x1db8b3(0x194)))_0x30f916=_0x4f9b6c+_0x1db8b3(0x1ef);}}}if(_0x30f916){const _0xd05317=await _0x1764ba[_0x1db8b3(0x1f5)](_0x30f916);if(_0xd05317&&_0xd05317[_0x1db8b3(0x1ae)]!==undefined&&_0xd05317[_0x1db8b3(0x1ae)]!==null)return parseFloat(_0xd05317['val']);}}catch(_0x58961f){}return null;}async function recordThermodynamics(_0x44b3d3,_0x3fa2a1,_0x1e21ce,_0x11fbb3){const _0x19cfaa=a5_0x4dda,_0x1ea2ce=await getOutsideTemperatureNumeric(_0x44b3d3);if(_0x1ea2ce===null)return;let _0x3982bf=0x0,_0x4803ad=![];if(_0x44b3d3[_0x19cfaa(0x1ad)][_0x19cfaa(0x1d7)])try{let _0x4b11da=_0x44b3d3[_0x19cfaa(0x1ad)][_0x19cfaa(0x1d7)];if(typeof _0x4b11da==='string')_0x4b11da=JSON[_0x19cfaa(0x1b4)](_0x4b11da);if(_0x4b11da[_0x3fa2a1]){const _0x13a431=_0x4b11da[_0x3fa2a1],_0x1b2273=await _0x44b3d3['getForeignStateAsync'](_0x13a431);if(_0x1b2273&&_0x1b2273[_0x19cfaa(0x1ae)]!==null&&_0x1b2273[_0x19cfaa(0x1ae)]!==undefined){let _0x2ebd4a=Number(_0x1b2273[_0x19cfaa(0x1ae)]);if(_0x2ebd4a<=1.05&&!_0x13a431[_0x19cfaa(0x1a3)](_0x19cfaa(0x196))&&!_0x13a431[_0x19cfaa(0x1a3)](_0x19cfaa(0x1aa)))_0x2ebd4a=_0x2ebd4a*0x64;_0x3982bf=Math[_0x19cfaa(0x1c7)](_0x2ebd4a),_0x4803ad=!![];}}}catch(_0x53c985){}if(!_0x4803ad){const _0x31c46a=[{'from':'.1.ACTUAL_TEMPERATURE','to':_0x19cfaa(0x193)},{'from':_0x19cfaa(0x1c5),'to':'.1.VALVE_STATE'},{'from':_0x19cfaa(0x1a4),'to':_0x19cfaa(0x1cf)},{'from':_0x19cfaa(0x1df),'to':'.LEVEL'},{'from':'temperature','to':_0x19cfaa(0x1b1)},{'from':'Temperature','to':_0x19cfaa(0x1e6)}];for(const _0x4e297d of _0x31c46a){if(_0x3fa2a1['includes'](_0x4e297d[_0x19cfaa(0x1a8)])){const _0x5c99e9=_0x3fa2a1[_0x19cfaa(0x1bf)](_0x4e297d[_0x19cfaa(0x1a8)],_0x4e297d['to']);try{const _0x4d5ddc=await _0x44b3d3['getForeignStateAsync'](_0x5c99e9);if(_0x4d5ddc&&_0x4d5ddc[_0x19cfaa(0x1ae)]!==null&&_0x4d5ddc[_0x19cfaa(0x1ae)]!==undefined){let _0x4f7c98=Number(_0x4d5ddc[_0x19cfaa(0x1ae)]);if(typeof _0x4f7c98===_0x19cfaa(0x1f4)){if(_0x4f7c98<=1.05&&_0x4e297d['to'][_0x19cfaa(0x1a3)]('LEVEL'))_0x4f7c98=_0x4f7c98*0x64;_0x3982bf=Math[_0x19cfaa(0x1c7)](_0x4f7c98),_0x4803ad=!![];break;}}}catch(_0x56f906){}}}}const _0x367422=await _0x44b3d3[_0x19cfaa(0x1a5)](_0x19cfaa(0x19e));let _0x56201e=[];if(_0x367422&&_0x367422[_0x19cfaa(0x1ae)])try{_0x56201e=JSON[_0x19cfaa(0x1b4)](_0x367422[_0x19cfaa(0x1ae)]);}catch(_0x4c9a3b){}_0x56201e[_0x19cfaa(0x1a2)]({'ts':Date[_0x19cfaa(0x1cb)](),'room':_0x11fbb3||_0x19cfaa(0x19b),'t_in':_0x1e21ce,'t_out':_0x1ea2ce,'valve':_0x3982bf});if(_0x56201e[_0x19cfaa(0x1bc)]>THERMO_LOG_SIZE)_0x56201e[_0x19cfaa(0x1f9)]();await _0x44b3d3['setStateAsync']('LTM.trainingData.thermodynamics',{'val':JSON['stringify'](_0x56201e),'ack':!![]});}async function saveCompletedSequence(_0x1fcd7d){const _0x35e988=a5_0x4dda;try{const _0x30f5d6=await _0x1fcd7d[_0x35e988(0x1a5)](_0x35e988(0x1b9));let _0x2b4074=[];if(_0x30f5d6&&_0x30f5d6[_0x35e988(0x1ae)])try{_0x2b4074=JSON[_0x35e988(0x1b4)](_0x30f5d6[_0x35e988(0x1ae)]);}catch(_0x30c9ce){}const _0x37ee01=activeSequence[0x0]['ts'],_0x343192=activeSequence[_0x35e988(0x1f6)](_0x14194b=>({'loc':_0x14194b['loc'],'t_delta':Math['round']((_0x14194b['ts']-_0x37ee01)/0x3e8)})),_0x2cd0ed={'timestamp':new Date(_0x37ee01)[_0x35e988(0x1d8)](),'steps':_0x343192,'duration':Math[_0x35e988(0x1c7)]((activeSequence[activeSequence[_0x35e988(0x1bc)]-0x1]['ts']-_0x37ee01)/0x3e8),'daytime':new Date(_0x37ee01)[_0x35e988(0x19f)]()};_0x2b4074[_0x35e988(0x1a2)](_0x2cd0ed);if(_0x2b4074['length']>MAX_TRAINING_SET_SIZE)_0x2b4074['shift']();await _0x1fcd7d[_0x35e988(0x1b0)](_0x35e988(0x1b9),{'val':JSON[_0x35e988(0x1ac)](_0x2b4074),'ack':!![]}),_0x1fcd7d['isProVersion']&&_0x1fcd7d[_0x35e988(0x1ab)]&&_0x1fcd7d['sendToPythonWrapper'](_0x35e988(0x198),{'sequence':_0x2cd0ed});}catch(_0x5b16a1){_0x1fcd7d[_0x35e988(0x1d4)]['error'](_0x35e988(0x1f1)+_0x5b16a1[_0x35e988(0x1ba)]);}}async function recordSequence(_0x485221,_0x23117c){const _0x5336fd=a5_0x4dda,_0x124a69=(_0x23117c[_0x5336fd(0x1e2)]||'')['toLowerCase'](),_0x2d99d5=[_0x5336fd(0x1f0),_0x5336fd(0x19d),_0x5336fd(0x1d2),_0x5336fd(0x1e3),_0x5336fd(0x1a1),_0x5336fd(0x199),_0x5336fd(0x1ed),_0x5336fd(0x1a9),_0x5336fd(0x1e9),_0x5336fd(0x1d3),_0x5336fd(0x1f3),_0x5336fd(0x1d6),'licht',_0x5336fd(0x1e8),_0x5336fd(0x1b6),_0x5336fd(0x1eb),_0x5336fd(0x1c3)];if(!_0x2d99d5[_0x5336fd(0x1be)](_0x1b84a6=>_0x124a69['includes'](_0x1b84a6)))return;if(!_0x23117c[_0x5336fd(0x1ca)])return;if(sequenceTimer)clearTimeout(sequenceTimer);activeSequence[_0x5336fd(0x1a2)]({'loc':_0x23117c[_0x5336fd(0x1da)]||_0x5336fd(0x19b),'id':_0x23117c['id'],'ts':Date['now']()}),sequenceTimer=setTimeout(async()=>{const _0x122f0c=_0x5336fd;if(activeSequence[_0x122f0c(0x1bc)]>0x1)await saveCompletedSequence(_0x485221);activeSequence=[];},SEQUENCE_TIMEOUT_MS);}function startExitTimer(_0x14cb5f){const _0x392b56=a5_0x4dda;abortExitTimer(_0x14cb5f),_0x14cb5f[_0x392b56(0x195)]=!![],_0x14cb5f[_0x392b56(0x1f8)]=setTimeout(()=>{const _0x3c4f41=_0x392b56;_0x14cb5f[_0x3c4f41(0x195)]=![];},EXIT_GRACE_PERIOD_SECONDS*0x3e8),_0x14cb5f[_0x392b56(0x1b2)]=setTimeout(()=>{const _0x45f197=_0x392b56;setPresence(_0x14cb5f,![]),_0x14cb5f[_0x45f197(0x1b2)]=null;},EXIT_TIMER_MINUTES*0x3c*0x3e8);}function a5_0x4c0d(){const _0x254dfe=['ANALYZE_SEQUENCE','door','isExit','Unknown','apply','bewegung','LTM.trainingData.thermodynamics','getHours','temperature','occupancy','push','includes','.1.TEMPERATURE','getStateAsync','(((.+)+)+)+$','8QMmPmg','from','window','STATE','sendToPythonWrapper','stringify','config','val','4076RzELsW','setStateAsync','level','exitTimer','splice','parse','1247260bDPVUa','schalter','SIMULATE_SIGNAL','klima','LTM.trainingData.sequences','message','unshift','length','\x20from\x20','some','replace','sensorLastValues','4823649ZzIbEt','eventHistory','lampe','heizung','.1.ACTUAL_TEMPERATURE','598677jxWgOk','round','currentSystemMode','.forecast.current.temperature','value','now','name','5325EtdRKo','toLowerCase','.4.VALVE_STATE','normal','logDuplicates','präsenz','contact','log','licht','light','valveMapping','toISOString','events.lastEvent','location','54369YoLhhL','TRACK_EVENT','griff','397692xyDZbe','.ACTUAL_TEMPERATURE','search','schloss','type','presence','[RECORDER]\x20Ignored\x20implausible\x20temperature:\x20','lock','Valve','89078BKWXgp','switch','fenster','216uIlyux','dimmer','50mtSNgt','tür','thermostat','.forecast.current.temp','motion','[RECORDER]\x20Error:\x20','temperatur','kontakt','number','getForeignStateAsync','map','rawEventLog','exitGraceTimer','shift','isProVersion','weatherInstance','handle','toString','useWeather','isPresent','.1.LEVEL','weatherunderground','isGracePeriodActive','STATUS','constructor'];a5_0x4c0d=function(){return _0x254dfe;};return a5_0x4c0d();}function a5_0x4dda(_0x27f221,_0x5413a0){const _0x463383=a5_0x4c0d();return a5_0x4dda=function(_0x22e8bd,_0x14b59f){_0x22e8bd=_0x22e8bd-0x192;let _0x4c0d12=_0x463383[_0x22e8bd];return _0x4c0d12;},a5_0x4dda(_0x27f221,_0x5413a0);}function abortExitTimer(_0x303a6d){const _0x14ba73=a5_0x4dda;if(_0x303a6d[_0x14ba73(0x1b2)])clearTimeout(_0x303a6d[_0x14ba73(0x1b2)]);if(_0x303a6d['exitGraceTimer'])clearTimeout(_0x303a6d[_0x14ba73(0x1f8)]);_0x303a6d[_0x14ba73(0x1b2)]=null,_0x303a6d[_0x14ba73(0x1f8)]=null,_0x303a6d[_0x14ba73(0x195)]=![];}async function setPresence(_0xfa9705,_0x42395f){const _0x3a3c02=a5_0x4dda;if(_0xfa9705[_0x3a3c02(0x192)]===_0x42395f)return;_0xfa9705[_0x3a3c02(0x192)]=_0x42395f,await _0xfa9705[_0x3a3c02(0x1b0)]('system.isPresent',{'val':_0x42395f,'ack':!![]});}async function processSensorEvent(_0x115e31,_0x1f67fb,_0x172169,_0x57f7f0){const _0x3d621f=a5_0x4dda;if(!_0x57f7f0)return null;const _0xf0f487=_0x172169[_0x3d621f(0x1ae)],_0x1abe10=Date[_0x3d621f(0x1cb)](),_0x195750=_0x115e31[_0x3d621f(0x1c0)][_0x1f67fb],_0x2de532=(_0x57f7f0[_0x3d621f(0x1e2)]||'')[_0x3d621f(0x1ce)](),_0x367aa9=_0x2de532[_0x3d621f(0x1a3)](_0x3d621f(0x1a0))||_0x2de532[_0x3d621f(0x1a3)](_0x3d621f(0x1f2))||_0x2de532['includes'](_0x3d621f(0x1b8))||_0x2de532[_0x3d621f(0x1a3)](_0x3d621f(0x1c4))||_0x2de532[_0x3d621f(0x1a3)](_0x3d621f(0x1ee));if(_0x367aa9&&typeof _0xf0f487===_0x3d621f(0x1f4)){if(_0xf0f487>0x50||_0xf0f487<-0x32)return _0x115e31[_0x3d621f(0x1d4)]['debug'](_0x3d621f(0x1e4)+_0xf0f487+_0x3d621f(0x1bd)+_0x1f67fb),null;}_0x115e31[_0x3d621f(0x1c0)][_0x1f67fb]=_0xf0f487;if(!_0x57f7f0[_0x3d621f(0x1d1)]&&_0x195750!=undefined&&_0x195750==_0xf0f487)return null;_0x115e31[_0x3d621f(0x1fa)]&&_0x367aa9&&recordThermodynamics(_0x115e31,_0x1f67fb,_0xf0f487,_0x57f7f0['location']);const _0x10f116={'timestamp':_0x1abe10,'id':_0x1f67fb,'name':_0x57f7f0[_0x3d621f(0x1cc)],'type':_0x57f7f0[_0x3d621f(0x1e2)],'location':_0x57f7f0[_0x3d621f(0x1da)],'value':_0xf0f487};_0x115e31['eventHistory'][_0x3d621f(0x1bb)](_0x10f116);if(_0x115e31[_0x3d621f(0x1c2)][_0x3d621f(0x1bc)]>HISTORY_MAX_SIZE)_0x115e31[_0x3d621f(0x1c2)]['pop']();await _0x115e31[_0x3d621f(0x1b0)](_0x3d621f(0x1d9),{'val':JSON[_0x3d621f(0x1ac)](_0x10f116),'ack':!![]}),await _0x115e31['setStateAsync']('events.history',{'val':JSON[_0x3d621f(0x1ac)](_0x115e31[_0x3d621f(0x1c2)]),'ack':!![]});if(_0x115e31[_0x3d621f(0x1fa)]){_0x115e31[_0x3d621f(0x1f7)][_0x3d621f(0x1a2)](_0x10f116);if(_0x115e31[_0x3d621f(0x1f7)][_0x3d621f(0x1bc)]>RAW_LOG_MAX_SIZE)_0x115e31[_0x3d621f(0x1f7)][_0x3d621f(0x1b3)](0x0,_0x115e31['rawEventLog'][_0x3d621f(0x1bc)]-RAW_LOG_MAX_SIZE);await _0x115e31['setStateAsync']('LTM.rawEventLog',{'val':JSON['stringify'](_0x115e31[_0x3d621f(0x1f7)]),'ack':!![]}),recordSequence(_0x115e31,_0x10f116);}if(_0x57f7f0[_0x3d621f(0x19a)]&&_0xf0f487===!![]){if(_0x115e31['isPresent']&&!_0x115e31['isGracePeriodActive'])startExitTimer(_0x115e31);else{if(!_0x115e31[_0x3d621f(0x192)])setPresence(_0x115e31,!![]);}}else{if(_0x57f7f0['type']===_0x3d621f(0x1f0)&&_0xf0f487===!![]){if(_0x115e31[_0x3d621f(0x1b2)])abortExitTimer(_0x115e31);if(!_0x115e31[_0x3d621f(0x192)]&&_0x115e31[_0x3d621f(0x1c8)]===_0x3d621f(0x1d0))setPresence(_0x115e31,!![]);}}if(_0x115e31['isProVersion']&&_0x115e31[_0x3d621f(0x1ab)]){_0x57f7f0[_0x3d621f(0x1e2)]===_0x3d621f(0x1f0)&&_0xf0f487===!![]&&_0x57f7f0[_0x3d621f(0x1da)]&&_0x115e31['sendToPythonWrapper'](_0x3d621f(0x1b7),{'room':_0x57f7f0[_0x3d621f(0x1da)]});const _0x45d9ce=[_0x3d621f(0x199),_0x3d621f(0x1ed),'window',_0x3d621f(0x1e9),_0x3d621f(0x1dd),_0x3d621f(0x1fc),_0x3d621f(0x1e5),_0x3d621f(0x1e1)]['some'](_0x13d538=>_0x2de532[_0x3d621f(0x1a3)](_0x13d538)),_0x15ff13=[_0x3d621f(0x1d6),_0x3d621f(0x1d5),'switch',_0x3d621f(0x1b6),_0x3d621f(0x1eb),_0x3d621f(0x1c3)][_0x3d621f(0x1be)](_0x1926a0=>_0x2de532[_0x3d621f(0x1a3)](_0x1926a0)),_0x1bb5d1=[_0x3d621f(0x1f0),_0x3d621f(0x19d),'präsenz','presence',_0x3d621f(0x1a1)][_0x3d621f(0x1be)](_0x362c51=>_0x2de532[_0x3d621f(0x1a3)](_0x362c51));if(_0x57f7f0['location']&&(_0x45d9ce||_0x15ff13||_0x1bb5d1)){const _0x288e5a=_0xf0f487===!![]||typeof _0xf0f487===_0x3d621f(0x1f4)&&_0xf0f487>0x0,_0x48d94c=_0x45d9ce&&!_0x288e5a&&_0x195750!==undefined&&_0x195750!=_0xf0f487;if(_0x288e5a||_0x48d94c){const _0x134f8d=_0x115e31['lastTrackerEventTime']||_0x1abe10,_0x631a99=(_0x1abe10-_0x134f8d)/0x3e8;_0x115e31['lastTrackerEventTime']=_0x1abe10,_0x115e31[_0x3d621f(0x1ab)](_0x3d621f(0x1dc),{'room':_0x57f7f0[_0x3d621f(0x1da)],'dt':_0x631a99});}}}return _0x10f116;}module['exports']={'processSensorEvent':processSensorEvent,'getOutsideTemperatureNumeric':getOutsideTemperatureNumeric,'setPresence':setPresence,'abortExitTimer':abortExitTimer,'startExitTimer':startExitTimer};