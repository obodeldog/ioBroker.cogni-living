const a5_0x696938=a5_0x27c0;(function(_0x403532,_0x3e9abb){const _0x42e071=a5_0x27c0,_0x3989da=_0x403532();while(!![]){try{const _0x5e985f=parseInt(_0x42e071(0x1e7))/0x1+parseInt(_0x42e071(0x1ca))/0x2*(-parseInt(_0x42e071(0x1c9))/0x3)+parseInt(_0x42e071(0x1ff))/0x4*(-parseInt(_0x42e071(0x1fe))/0x5)+parseInt(_0x42e071(0x207))/0x6*(-parseInt(_0x42e071(0x1f5))/0x7)+parseInt(_0x42e071(0x1cb))/0x8+parseInt(_0x42e071(0x22a))/0x9+parseInt(_0x42e071(0x1ed))/0xa;if(_0x5e985f===_0x3e9abb)break;else _0x3989da['push'](_0x3989da['shift']());}catch(_0x14c2a6){_0x3989da['push'](_0x3989da['shift']());}}}(a5_0x21b0,0xb7541));const a5_0x5205ed=(function(){let _0x371daf=!![];return function(_0x1abc7f,_0x3e5309){const _0x1b6c47=_0x371daf?function(){if(_0x3e5309){const _0xfc6a6f=_0x3e5309['apply'](_0x1abc7f,arguments);return _0x3e5309=null,_0xfc6a6f;}}:function(){};return _0x371daf=![],_0x1b6c47;};}()),a5_0x4503ea=a5_0x5205ed(this,function(){const _0x2351f0=a5_0x27c0;return a5_0x4503ea['toString']()[_0x2351f0(0x1cd)](_0x2351f0(0x1f6))[_0x2351f0(0x1d4)]()[_0x2351f0(0x1e5)](a5_0x4503ea)[_0x2351f0(0x1cd)](_0x2351f0(0x1f6));});a5_0x4503ea();'use strict';const HISTORY_MAX_SIZE=0x32,RAW_LOG_MAX_SIZE=0x9c4,THERMO_LOG_SIZE=0x3e8,SEQUENCE_TIMEOUT_MS=0x5*0x3c*0x3e8,MAX_TRAINING_SET_SIZE=0x1f4,EXIT_TIMER_MINUTES=0xf,EXIT_GRACE_PERIOD_SECONDS=0x1e;let activeSequence=[],sequenceTimer=null;async function getOutsideTemperatureNumeric(_0x4608de){const _0x2aa9e8=a5_0x27c0;if(_0x4608de[_0x2aa9e8(0x1d0)][_0x2aa9e8(0x1db)])try{const _0x18cf8e=await _0x4608de[_0x2aa9e8(0x1d6)](_0x4608de[_0x2aa9e8(0x1d0)]['outdoorSensorId']);if(_0x18cf8e&&_0x18cf8e[_0x2aa9e8(0x232)]!==undefined&&_0x18cf8e[_0x2aa9e8(0x232)]!==null)return parseFloat(_0x18cf8e[_0x2aa9e8(0x232)]);}catch(_0x4ad8b3){}const _0x4cc6fb=_0x4608de['config'][_0x2aa9e8(0x1e0)];if(!_0x4608de[_0x2aa9e8(0x1d0)][_0x2aa9e8(0x21c)]||!_0x4cc6fb)return null;try{let _0x4ab814='';if(_0x4cc6fb[_0x2aa9e8(0x223)](_0x2aa9e8(0x1dd)))_0x4ab814=_0x4cc6fb+_0x2aa9e8(0x209);else{if(_0x4cc6fb['includes']('daswetter'))_0x4ab814=_0x4cc6fb+'.NextHours.Location_1.Day_1.current.temp_value';else{if(_0x4cc6fb[_0x2aa9e8(0x223)](_0x2aa9e8(0x1fc)))_0x4ab814=_0x4cc6fb+_0x2aa9e8(0x1e3);else{if(_0x4cc6fb['includes'](_0x2aa9e8(0x211)))_0x4ab814=_0x4cc6fb+'.forecast.current.temp';}}}if(_0x4ab814){const _0x4a00f6=await _0x4608de[_0x2aa9e8(0x1d6)](_0x4ab814);if(_0x4a00f6&&_0x4a00f6[_0x2aa9e8(0x232)]!==undefined&&_0x4a00f6[_0x2aa9e8(0x232)]!==null)return parseFloat(_0x4a00f6[_0x2aa9e8(0x232)]);}}catch(_0x2742ac){}return null;}function a5_0x21b0(){const _0x19022c=['replace','toLowerCase','.forecast.current.temperature','from','constructor','lastTrackerEventTime','981498cGIBbt','push','.1.LEVEL','switch','window','lock','144620yNhcQm','presence','events.lastEvent','logDuplicates','LTM.trainingData.sequences','schalter','ANALYZE_SEQUENCE','value','252091yutptM','(((.+)+)+)+$','rawEventLog','currentSystemMode','occupancy','sendToPythonWrapper','type','openweathermap','number','3724885PeNCml','4GfrhrQ','.4.VALVE_STATE','setStateAsync','getStateAsync','parse','tür','kontakt','schloss','42YOPGrN','.1.ACTUAL_TEMPERATURE','.Current.Temperature','contact','round','some','[RECORDER]\x20Ignored\x20implausible\x20temperature:\x20','exitTimer','klima','loc','weatherunderground','präsenz','LTM.trainingData.thermodynamics','Unknown','STATUS','exports','.LEVEL','fenster','getHours','exitGraceTimer','isExit','useWeather','isProVersion','.ACTUAL_TEMPERATURE','motion','\x20from\x20','Temperature','handle','includes','lampe','thermostat','events.history','eventHistory','unshift','licht','5946759PknkdP','LTM.rawEventLog','level','.1.VALVE_STATE','sensorLastValues','location','length','stringify','val','door','18nfrgZr','359906ovFgrh','9367904XiYSbb','map','search','isPresent','now','config','system.isPresent','TRACK_EVENT','shift','toString','log','getForeignStateAsync','bewegung','isGracePeriodActive','temperatur','dimmer','outdoorSensorId','valveMapping','accuweather','light','pop','weatherInstance'];a5_0x21b0=function(){return _0x19022c;};return a5_0x21b0();}async function recordThermodynamics(_0x455b25,_0x42b6b9,_0x839f28,_0x55d33c){const _0x572e7e=a5_0x27c0,_0x292aa7=await getOutsideTemperatureNumeric(_0x455b25);if(_0x292aa7===null)return;let _0x52c668=0x0,_0x53de99=![];if(_0x455b25['config'][_0x572e7e(0x1dc)])try{let _0x49a43a=_0x455b25[_0x572e7e(0x1d0)][_0x572e7e(0x1dc)];if(typeof _0x49a43a==='string')_0x49a43a=JSON[_0x572e7e(0x203)](_0x49a43a);if(_0x49a43a[_0x42b6b9]){const _0x400128=_0x49a43a[_0x42b6b9],_0x3837f1=await _0x455b25[_0x572e7e(0x1d6)](_0x400128);if(_0x3837f1&&_0x3837f1['val']!==null&&_0x3837f1[_0x572e7e(0x232)]!==undefined){let _0x2d186a=Number(_0x3837f1[_0x572e7e(0x232)]);if(_0x2d186a<=1.05&&!_0x400128[_0x572e7e(0x223)](_0x572e7e(0x215))&&!_0x400128[_0x572e7e(0x223)]('STATE'))_0x2d186a=_0x2d186a*0x64;_0x52c668=Math[_0x572e7e(0x20b)](_0x2d186a),_0x53de99=!![];}}}catch(_0x4b49cf){}if(!_0x53de99){const _0x3755df=[{'from':_0x572e7e(0x208),'to':_0x572e7e(0x1e9)},{'from':_0x572e7e(0x208),'to':_0x572e7e(0x22d)},{'from':'.1.TEMPERATURE','to':_0x572e7e(0x200)},{'from':_0x572e7e(0x21e),'to':_0x572e7e(0x217)},{'from':'temperature','to':_0x572e7e(0x22c)},{'from':_0x572e7e(0x221),'to':'Valve'}];for(const _0x1046cd of _0x3755df){if(_0x42b6b9[_0x572e7e(0x223)](_0x1046cd[_0x572e7e(0x1e4)])){const _0x59b6b0=_0x42b6b9[_0x572e7e(0x1e1)](_0x1046cd[_0x572e7e(0x1e4)],_0x1046cd['to']);try{const _0x1a8f3d=await _0x455b25[_0x572e7e(0x1d6)](_0x59b6b0);if(_0x1a8f3d&&_0x1a8f3d[_0x572e7e(0x232)]!==null&&_0x1a8f3d['val']!==undefined){let _0x50dae5=Number(_0x1a8f3d[_0x572e7e(0x232)]);if(typeof _0x50dae5===_0x572e7e(0x1fd)){if(_0x50dae5<=1.05&&_0x1046cd['to'][_0x572e7e(0x223)]('LEVEL'))_0x50dae5=_0x50dae5*0x64;_0x52c668=Math['round'](_0x50dae5),_0x53de99=!![];break;}}}catch(_0x1486cf){}}}}const _0x115c30=await _0x455b25[_0x572e7e(0x202)](_0x572e7e(0x213));let _0x3c55af=[];if(_0x115c30&&_0x115c30[_0x572e7e(0x232)])try{_0x3c55af=JSON[_0x572e7e(0x203)](_0x115c30['val']);}catch(_0x41f52e){}_0x3c55af[_0x572e7e(0x1e8)]({'ts':Date[_0x572e7e(0x1cf)](),'room':_0x55d33c||_0x572e7e(0x214),'t_in':_0x839f28,'t_out':_0x292aa7,'valve':_0x52c668});if(_0x3c55af[_0x572e7e(0x230)]>THERMO_LOG_SIZE)_0x3c55af[_0x572e7e(0x1d3)]();await _0x455b25['setStateAsync']('LTM.trainingData.thermodynamics',{'val':JSON[_0x572e7e(0x231)](_0x3c55af),'ack':!![]});}function a5_0x27c0(_0x376a9f,_0x245f8d){const _0x110092=a5_0x21b0();return a5_0x27c0=function(_0x4503ea,_0x5205ed){_0x4503ea=_0x4503ea-0x1c8;let _0x21b0ed=_0x110092[_0x4503ea];return _0x21b0ed;},a5_0x27c0(_0x376a9f,_0x245f8d);}async function saveCompletedSequence(_0x15e4a4){const _0x46879c=a5_0x27c0;try{const _0x2798e2=await _0x15e4a4['getStateAsync'](_0x46879c(0x1f1));let _0x48f303=[];if(_0x2798e2&&_0x2798e2[_0x46879c(0x232)])try{_0x48f303=JSON[_0x46879c(0x203)](_0x2798e2[_0x46879c(0x232)]);}catch(_0x4a0b9a){}const _0x597215=activeSequence[0x0]['ts'],_0x5f0549=activeSequence[_0x46879c(0x1cc)](_0x4d8bd2=>({'loc':_0x4d8bd2[_0x46879c(0x210)],'t_delta':Math[_0x46879c(0x20b)]((_0x4d8bd2['ts']-_0x597215)/0x3e8)})),_0x30fc86={'timestamp':new Date(_0x597215)['toISOString'](),'steps':_0x5f0549,'duration':Math[_0x46879c(0x20b)]((activeSequence[activeSequence['length']-0x1]['ts']-_0x597215)/0x3e8),'daytime':new Date(_0x597215)[_0x46879c(0x219)]()};_0x48f303[_0x46879c(0x1e8)](_0x30fc86);if(_0x48f303['length']>MAX_TRAINING_SET_SIZE)_0x48f303['shift']();await _0x15e4a4[_0x46879c(0x201)](_0x46879c(0x1f1),{'val':JSON[_0x46879c(0x231)](_0x48f303),'ack':!![]}),_0x15e4a4['isProVersion']&&_0x15e4a4[_0x46879c(0x1fa)]&&_0x15e4a4['sendToPythonWrapper'](_0x46879c(0x1f3),{'sequence':_0x30fc86});}catch(_0x522dc5){_0x15e4a4['log']['error']('[RECORDER]\x20Error:\x20'+_0x522dc5['message']);}}async function recordSequence(_0x273ba1,_0x13f9c6){const _0x402651=a5_0x27c0,_0x5e6a74=(_0x13f9c6['type']||'')[_0x402651(0x1e2)](),_0x122cfc=['motion','bewegung',_0x402651(0x212),_0x402651(0x1ee),_0x402651(0x1f9),'door',_0x402651(0x204),_0x402651(0x1eb),'fenster',_0x402651(0x20a),_0x402651(0x205),'light',_0x402651(0x229),_0x402651(0x1ea),_0x402651(0x1f2),_0x402651(0x1da),_0x402651(0x224)];if(!_0x122cfc[_0x402651(0x20c)](_0x350a05=>_0x5e6a74['includes'](_0x350a05)))return;if(!_0x13f9c6[_0x402651(0x1f4)])return;if(sequenceTimer)clearTimeout(sequenceTimer);activeSequence[_0x402651(0x1e8)]({'loc':_0x13f9c6['location']||_0x402651(0x214),'id':_0x13f9c6['id'],'ts':Date['now']()}),sequenceTimer=setTimeout(async()=>{const _0x6a659c=_0x402651;if(activeSequence[_0x6a659c(0x230)]>0x1)await saveCompletedSequence(_0x273ba1);activeSequence=[];},SEQUENCE_TIMEOUT_MS);}function startExitTimer(_0x4e6b8c){const _0x51c9b8=a5_0x27c0;abortExitTimer(_0x4e6b8c),_0x4e6b8c['isGracePeriodActive']=!![],_0x4e6b8c['exitGraceTimer']=setTimeout(()=>{const _0x35920e=a5_0x27c0;_0x4e6b8c[_0x35920e(0x1d8)]=![];},EXIT_GRACE_PERIOD_SECONDS*0x3e8),_0x4e6b8c[_0x51c9b8(0x20e)]=setTimeout(()=>{setPresence(_0x4e6b8c,![]),_0x4e6b8c['exitTimer']=null;},EXIT_TIMER_MINUTES*0x3c*0x3e8);}function abortExitTimer(_0x1eb4fb){const _0xd2802d=a5_0x27c0;if(_0x1eb4fb[_0xd2802d(0x20e)])clearTimeout(_0x1eb4fb[_0xd2802d(0x20e)]);if(_0x1eb4fb['exitGraceTimer'])clearTimeout(_0x1eb4fb[_0xd2802d(0x21a)]);_0x1eb4fb[_0xd2802d(0x20e)]=null,_0x1eb4fb[_0xd2802d(0x21a)]=null,_0x1eb4fb[_0xd2802d(0x1d8)]=![];}async function setPresence(_0x543c75,_0x5ea1b3){const _0x6be66f=a5_0x27c0;if(_0x543c75[_0x6be66f(0x1ce)]===_0x5ea1b3)return;_0x543c75[_0x6be66f(0x1ce)]=_0x5ea1b3,await _0x543c75['setStateAsync'](_0x6be66f(0x1d1),{'val':_0x5ea1b3,'ack':!![]});}async function processSensorEvent(_0x141288,_0x3a6a23,_0x4b8e2a,_0x33ef84){const _0x2ea573=a5_0x27c0;if(!_0x33ef84)return null;const _0xacb6e9=_0x4b8e2a['val'],_0x4ff686=Date[_0x2ea573(0x1cf)](),_0x1e79ee=_0x141288[_0x2ea573(0x22e)][_0x3a6a23],_0x55aee7=(_0x33ef84[_0x2ea573(0x1fb)]||'')['toLowerCase'](),_0x18f018=_0x55aee7['includes']('temperature')||_0x55aee7[_0x2ea573(0x223)](_0x2ea573(0x1d9))||_0x55aee7[_0x2ea573(0x223)](_0x2ea573(0x20f))||_0x55aee7[_0x2ea573(0x223)]('heizung')||_0x55aee7[_0x2ea573(0x223)](_0x2ea573(0x225));if(_0x18f018&&typeof _0xacb6e9===_0x2ea573(0x1fd)){if(_0xacb6e9>0x50||_0xacb6e9<-0x32)return _0x141288[_0x2ea573(0x1d5)]['debug'](_0x2ea573(0x20d)+_0xacb6e9+_0x2ea573(0x220)+_0x3a6a23),null;}_0x141288['sensorLastValues'][_0x3a6a23]=_0xacb6e9;if(!_0x33ef84[_0x2ea573(0x1f0)]&&_0x1e79ee!=undefined&&_0x1e79ee==_0xacb6e9)return null;_0x141288['isProVersion']&&_0x18f018&&recordThermodynamics(_0x141288,_0x3a6a23,_0xacb6e9,_0x33ef84['location']);const _0x439017={'timestamp':_0x4ff686,'id':_0x3a6a23,'name':_0x33ef84['name'],'type':_0x33ef84[_0x2ea573(0x1fb)],'location':_0x33ef84['location'],'value':_0xacb6e9};_0x141288[_0x2ea573(0x227)][_0x2ea573(0x228)](_0x439017);if(_0x141288[_0x2ea573(0x227)][_0x2ea573(0x230)]>HISTORY_MAX_SIZE)_0x141288[_0x2ea573(0x227)][_0x2ea573(0x1df)]();await _0x141288['setStateAsync'](_0x2ea573(0x1ef),{'val':JSON['stringify'](_0x439017),'ack':!![]}),await _0x141288[_0x2ea573(0x201)](_0x2ea573(0x226),{'val':JSON[_0x2ea573(0x231)](_0x141288[_0x2ea573(0x227)]),'ack':!![]});if(_0x141288[_0x2ea573(0x21d)]){_0x141288['rawEventLog'][_0x2ea573(0x1e8)](_0x439017);if(_0x141288[_0x2ea573(0x1f7)]['length']>RAW_LOG_MAX_SIZE)_0x141288[_0x2ea573(0x1f7)]['splice'](0x0,_0x141288[_0x2ea573(0x1f7)][_0x2ea573(0x230)]-RAW_LOG_MAX_SIZE);await _0x141288[_0x2ea573(0x201)](_0x2ea573(0x22b),{'val':JSON[_0x2ea573(0x231)](_0x141288[_0x2ea573(0x1f7)]),'ack':!![]}),recordSequence(_0x141288,_0x439017);}if(_0x33ef84[_0x2ea573(0x21b)]&&_0xacb6e9===!![]){if(_0x141288[_0x2ea573(0x1ce)]&&!_0x141288[_0x2ea573(0x1d8)])startExitTimer(_0x141288);else{if(!_0x141288['isPresent'])setPresence(_0x141288,!![]);}}else{if(_0x33ef84['type']===_0x2ea573(0x21f)&&_0xacb6e9===!![]){if(_0x141288[_0x2ea573(0x20e)])abortExitTimer(_0x141288);if(!_0x141288[_0x2ea573(0x1ce)]&&_0x141288[_0x2ea573(0x1f8)]==='normal')setPresence(_0x141288,!![]);}}if(_0x141288[_0x2ea573(0x21d)]&&_0x141288[_0x2ea573(0x1fa)]){_0x33ef84[_0x2ea573(0x1fb)]===_0x2ea573(0x21f)&&_0xacb6e9===!![]&&_0x33ef84[_0x2ea573(0x22f)]&&_0x141288[_0x2ea573(0x1fa)]('SIMULATE_SIGNAL',{'room':_0x33ef84['location']});const _0x3df699=[_0x2ea573(0x1c8),_0x2ea573(0x204),_0x2ea573(0x1eb),_0x2ea573(0x218),'griff',_0x2ea573(0x222),_0x2ea573(0x1ec),_0x2ea573(0x206)][_0x2ea573(0x20c)](_0xa08c=>_0x55aee7[_0x2ea573(0x223)](_0xa08c)),_0x50e66b=[_0x2ea573(0x1de),_0x2ea573(0x229),_0x2ea573(0x1ea),_0x2ea573(0x1f2),_0x2ea573(0x1da),_0x2ea573(0x224)][_0x2ea573(0x20c)](_0x1440c1=>_0x55aee7[_0x2ea573(0x223)](_0x1440c1)),_0x1ccdf1=[_0x2ea573(0x21f),_0x2ea573(0x1d7),_0x2ea573(0x212),'presence',_0x2ea573(0x1f9)][_0x2ea573(0x20c)](_0x50ba72=>_0x55aee7[_0x2ea573(0x223)](_0x50ba72));if(_0x33ef84[_0x2ea573(0x22f)]&&(_0x3df699||_0x50e66b||_0x1ccdf1)){const _0x149698=_0xacb6e9===!![]||typeof _0xacb6e9===_0x2ea573(0x1fd)&&_0xacb6e9>0x0,_0x368e37=_0x3df699&&!_0x149698&&_0x1e79ee!==undefined&&_0x1e79ee!=_0xacb6e9;if(_0x149698||_0x368e37){const _0x2be7a1=_0x141288[_0x2ea573(0x1e6)]||_0x4ff686,_0x57a187=(_0x4ff686-_0x2be7a1)/0x3e8;_0x141288[_0x2ea573(0x1e6)]=_0x4ff686,_0x141288[_0x2ea573(0x1fa)](_0x2ea573(0x1d2),{'room':_0x33ef84[_0x2ea573(0x22f)],'dt':_0x57a187});}}}return _0x439017;}module[a5_0x696938(0x216)]={'processSensorEvent':processSensorEvent,'getOutsideTemperatureNumeric':getOutsideTemperatureNumeric,'setPresence':setPresence,'abortExitTimer':abortExitTimer,'startExitTimer':startExitTimer};