const a3_0x455006=a3_0x14fa;(function(_0x31e182,_0x277f9e){const _0xa5025b=a3_0x14fa,_0x15d115=_0x31e182();while(!![]){try{const _0xf7d9d1=parseInt(_0xa5025b(0x137))/0x1*(parseInt(_0xa5025b(0x14b))/0x2)+parseInt(_0xa5025b(0x14c))/0x3*(-parseInt(_0xa5025b(0x183))/0x4)+parseInt(_0xa5025b(0x17a))/0x5*(parseInt(_0xa5025b(0x144))/0x6)+parseInt(_0xa5025b(0x156))/0x7*(parseInt(_0xa5025b(0x180))/0x8)+parseInt(_0xa5025b(0x184))/0x9+parseInt(_0xa5025b(0x146))/0xa+-parseInt(_0xa5025b(0x15a))/0xb;if(_0xf7d9d1===_0x277f9e)break;else _0x15d115['push'](_0x15d115['shift']());}catch(_0x1f6973){_0x15d115['push'](_0x15d115['shift']());}}}(a3_0x47c9,0x3e5e5));const a3_0x1787ea=(function(){let _0x134c9a=!![];return function(_0x3aa753,_0x2925eb){const _0x552c7d=_0x134c9a?function(){const _0x95806c=a3_0x14fa;if(_0x2925eb){const _0x3e0fc6=_0x2925eb[_0x95806c(0x162)](_0x3aa753,arguments);return _0x2925eb=null,_0x3e0fc6;}}:function(){};return _0x134c9a=![],_0x552c7d;};}()),a3_0x27d847=a3_0x1787ea(this,function(){const _0x596f86=a3_0x14fa;return a3_0x27d847[_0x596f86(0x155)]()[_0x596f86(0x13f)](_0x596f86(0x188))[_0x596f86(0x155)]()[_0x596f86(0x141)](a3_0x27d847)[_0x596f86(0x13f)](_0x596f86(0x188));});a3_0x27d847();'use strict';const HISTORY_MAX_SIZE=0x32,RAW_LOG_MAX_SIZE=0x9c4,THERMO_LOG_SIZE=0x3e8,SEQUENCE_TIMEOUT_MS=0x5*0x3c*0x3e8,MAX_TRAINING_SET_SIZE=0x1f4,EXIT_TIMER_MINUTES=0xf,EXIT_GRACE_PERIOD_SECONDS=0x1e;let activeSequence=[],sequenceTimer=null;async function getOutsideTemperatureNumeric(_0x6557f){const _0x4195a2=a3_0x14fa;if(_0x6557f['config'][_0x4195a2(0x175)])try{const _0x4d90ec=await _0x6557f[_0x4195a2(0x14e)](_0x6557f[_0x4195a2(0x132)]['outdoorSensorId']);if(_0x4d90ec&&_0x4d90ec[_0x4195a2(0x148)]!==undefined&&_0x4d90ec[_0x4195a2(0x148)]!==null)return parseFloat(_0x4d90ec[_0x4195a2(0x148)]);}catch(_0xd050cb){}const _0x348df2=_0x6557f[_0x4195a2(0x132)][_0x4195a2(0x150)];if(!_0x6557f[_0x4195a2(0x132)][_0x4195a2(0x161)]||!_0x348df2)return null;try{let _0x38f849='';if(_0x348df2[_0x4195a2(0x170)](_0x4195a2(0x154)))_0x38f849=_0x348df2+'.Current.Temperature';else{if(_0x348df2[_0x4195a2(0x170)](_0x4195a2(0x179)))_0x38f849=_0x348df2+_0x4195a2(0x16c);else{if(_0x348df2['includes'](_0x4195a2(0x145)))_0x38f849=_0x348df2+_0x4195a2(0x153);else{if(_0x348df2[_0x4195a2(0x170)]('weatherunderground'))_0x38f849=_0x348df2+_0x4195a2(0x157);}}}if(_0x38f849){const _0x536d56=await _0x6557f[_0x4195a2(0x14e)](_0x38f849);if(_0x536d56&&_0x536d56[_0x4195a2(0x148)]!==undefined&&_0x536d56['val']!==null)return parseFloat(_0x536d56[_0x4195a2(0x148)]);}}catch(_0x135275){}return null;}async function recordThermodynamics(_0x1727c7,_0x5b0783,_0x4a4982,_0x4da3a0){const _0x3a998f=a3_0x14fa,_0x46cae8=await getOutsideTemperatureNumeric(_0x1727c7),_0x38e2e0=await _0x1727c7[_0x3a998f(0x16d)]('LTM.trainingData.thermodynamics');let _0x460341=[];if(_0x38e2e0&&_0x38e2e0[_0x3a998f(0x148)])try{_0x460341=JSON[_0x3a998f(0x17d)](_0x38e2e0[_0x3a998f(0x148)]);}catch(_0x391f11){}_0x460341[_0x3a998f(0x178)]({'ts':Date[_0x3a998f(0x163)](),'room':_0x4da3a0||'Unknown','t_in':_0x4a4982,'t_out':_0x46cae8});if(_0x460341[_0x3a998f(0x14a)]>THERMO_LOG_SIZE)_0x460341[_0x3a998f(0x158)]();await _0x1727c7[_0x3a998f(0x142)](_0x3a998f(0x130),{'val':JSON[_0x3a998f(0x152)](_0x460341),'ack':!![]});}async function saveCompletedSequence(_0x2307cd){const _0x2b7f65=a3_0x14fa;try{const _0x4bd001=await _0x2307cd['getStateAsync']('LTM.trainingData.sequences');let _0x20a627=[];if(_0x4bd001&&_0x4bd001['val'])try{_0x20a627=JSON[_0x2b7f65(0x17d)](_0x4bd001['val']);}catch(_0xb1bdad){}const _0x40d191=activeSequence[0x0]['ts'],_0x35d08c=activeSequence['map'](_0x355a55=>({'loc':_0x355a55[_0x2b7f65(0x166)],'t_delta':Math[_0x2b7f65(0x17b)]((_0x355a55['ts']-_0x40d191)/0x3e8)})),_0xbb2144={'timestamp':new Date(_0x40d191)[_0x2b7f65(0x181)](),'steps':_0x35d08c,'duration':Math[_0x2b7f65(0x17b)]((activeSequence[activeSequence['length']-0x1]['ts']-_0x40d191)/0x3e8),'daytime':new Date(_0x40d191)['getHours']()};_0x20a627[_0x2b7f65(0x178)](_0xbb2144);if(_0x20a627[_0x2b7f65(0x14a)]>MAX_TRAINING_SET_SIZE)_0x20a627[_0x2b7f65(0x158)]();await _0x2307cd[_0x2b7f65(0x142)](_0x2b7f65(0x16a),{'val':JSON[_0x2b7f65(0x152)](_0x20a627),'ack':!![]}),_0x2307cd[_0x2b7f65(0x182)]&&_0x2307cd['sendToPythonWrapper']&&_0x2307cd['sendToPythonWrapper'](_0x2b7f65(0x17f),{'sequence':_0xbb2144});}catch(_0x13e780){_0x2307cd[_0x2b7f65(0x160)][_0x2b7f65(0x15b)]('[RECORDER]\x20Error:\x20'+_0x13e780[_0x2b7f65(0x134)]);}}async function recordSequence(_0x9bbcbc,_0x33b9f0){const _0x84842a=a3_0x14fa,_0x294f05=(_0x33b9f0[_0x84842a(0x165)]||'')['toLowerCase'](),_0x25472a=['motion',_0x84842a(0x159),'präsenz','presence','occupancy',_0x84842a(0x173),'tür',_0x84842a(0x15e),_0x84842a(0x177),_0x84842a(0x149),_0x84842a(0x138),_0x84842a(0x135),_0x84842a(0x187),_0x84842a(0x186),_0x84842a(0x17e),_0x84842a(0x172),_0x84842a(0x13b)];if(!_0x25472a[_0x84842a(0x151)](_0x27e36a=>_0x294f05[_0x84842a(0x170)](_0x27e36a)))return;if(!_0x33b9f0[_0x84842a(0x140)])return;if(sequenceTimer)clearTimeout(sequenceTimer);activeSequence[_0x84842a(0x178)]({'loc':_0x33b9f0[_0x84842a(0x13c)]||_0x84842a(0x143),'id':_0x33b9f0['id'],'ts':Date[_0x84842a(0x163)]()}),sequenceTimer=setTimeout(async()=>{const _0x1373a4=_0x84842a;if(activeSequence[_0x1373a4(0x14a)]>0x1)await saveCompletedSequence(_0x9bbcbc);activeSequence=[];},SEQUENCE_TIMEOUT_MS);}function a3_0x14fa(_0x58c8e9,_0x3b6455){const _0x2b46ef=a3_0x47c9();return a3_0x14fa=function(_0x27d847,_0x1787ea){_0x27d847=_0x27d847-0x130;let _0x47c9fe=_0x2b46ef[_0x27d847];return _0x47c9fe;},a3_0x14fa(_0x58c8e9,_0x3b6455);}function a3_0x47c9(){const _0x3e0230=['getStateAsync','sensorLastValues','system.isPresent','includes','isExit','dimmer','door','pop','outdoorSensorId','logDuplicates','fenster','push','daswetter','1788735bClxjW','round','exitGraceTimer','parse','schalter','ANALYZE_SEQUENCE','56ExGWUn','toISOString','isProVersion','17260pPdncK','1302291pkBXni','rawEventLog','switch','licht','(((.+)+)+)+$','SIMULATE_SIGNAL','LTM.trainingData.thermodynamics','unshift','config','isPresent','message','light','LTM.rawEventLog','44uTTIjb','kontakt','toLowerCase','currentSystemMode','lampe','location','motion','exitTimer','search','value','constructor','setStateAsync','Unknown','6syaxcq','openweathermap','1578250NckBeD','name','val','contact','length','4124QNJNwm','78OYOrXT','events.history','getForeignStateAsync','events.lastEvent','weatherInstance','some','stringify','.forecast.current.temperature','accuweather','toString','65618opRgqJ','.forecast.current.temp','shift','bewegung','4938626EFSBOf','error','temperatur','sendToPythonWrapper','window','isGracePeriodActive','log','useWeather','apply','now','normal','type','loc','klima','exports','splice','LTM.trainingData.sequences','eventHistory','.NextHours.Location_1.Day_1.current.temp_value'];a3_0x47c9=function(){return _0x3e0230;};return a3_0x47c9();}function startExitTimer(_0x565402){const _0x354872=a3_0x14fa;abortExitTimer(_0x565402),_0x565402[_0x354872(0x15f)]=!![],_0x565402['exitGraceTimer']=setTimeout(()=>{const _0xe70885=_0x354872;_0x565402[_0xe70885(0x15f)]=![];},EXIT_GRACE_PERIOD_SECONDS*0x3e8),_0x565402[_0x354872(0x13e)]=setTimeout(()=>{const _0x4adcd6=_0x354872;setPresence(_0x565402,![]),_0x565402[_0x4adcd6(0x13e)]=null;},EXIT_TIMER_MINUTES*0x3c*0x3e8);}function abortExitTimer(_0x45e526){const _0x313c8a=a3_0x14fa;if(_0x45e526[_0x313c8a(0x13e)])clearTimeout(_0x45e526['exitTimer']);if(_0x45e526['exitGraceTimer'])clearTimeout(_0x45e526[_0x313c8a(0x17c)]);_0x45e526[_0x313c8a(0x13e)]=null,_0x45e526[_0x313c8a(0x17c)]=null,_0x45e526[_0x313c8a(0x15f)]=![];}async function setPresence(_0x5d8d12,_0x1c0bfc){const _0x1f1e44=a3_0x14fa;if(_0x5d8d12[_0x1f1e44(0x133)]===_0x1c0bfc)return;_0x5d8d12[_0x1f1e44(0x133)]=_0x1c0bfc,await _0x5d8d12['setStateAsync'](_0x1f1e44(0x16f),{'val':_0x1c0bfc,'ack':!![]});}async function processSensorEvent(_0x5e39db,_0x5110ed,_0x1d3bfe,_0x491a78){const _0x46c9f7=a3_0x14fa;if(!_0x491a78)return;const _0x578398=_0x1d3bfe[_0x46c9f7(0x148)],_0x5a36fb=Date[_0x46c9f7(0x163)](),_0x31278a=_0x5e39db[_0x46c9f7(0x16e)][_0x5110ed];_0x5e39db['sensorLastValues'][_0x5110ed]=_0x578398;if(!_0x491a78[_0x46c9f7(0x176)]&&_0x31278a!=undefined&&_0x31278a==_0x578398)return;const _0x5144d7=(_0x491a78['type']||'')[_0x46c9f7(0x139)](),_0x3b4002=_0x5144d7[_0x46c9f7(0x170)]('temperature')||_0x5144d7[_0x46c9f7(0x170)](_0x46c9f7(0x15c))||_0x5144d7[_0x46c9f7(0x170)](_0x46c9f7(0x167))||_0x5144d7['includes']('heizung');_0x5e39db[_0x46c9f7(0x182)]&&_0x3b4002&&recordThermodynamics(_0x5e39db,_0x5110ed,_0x578398,_0x491a78['location']);const _0x2049da={'timestamp':_0x5a36fb,'id':_0x5110ed,'name':_0x491a78[_0x46c9f7(0x147)],'type':_0x491a78[_0x46c9f7(0x165)],'location':_0x491a78[_0x46c9f7(0x13c)],'value':_0x578398};_0x5e39db[_0x46c9f7(0x16b)][_0x46c9f7(0x131)](_0x2049da);if(_0x5e39db[_0x46c9f7(0x16b)][_0x46c9f7(0x14a)]>HISTORY_MAX_SIZE)_0x5e39db[_0x46c9f7(0x16b)][_0x46c9f7(0x174)]();await _0x5e39db[_0x46c9f7(0x142)](_0x46c9f7(0x14f),{'val':JSON[_0x46c9f7(0x152)](_0x2049da),'ack':!![]}),await _0x5e39db['setStateAsync'](_0x46c9f7(0x14d),{'val':JSON[_0x46c9f7(0x152)](_0x5e39db[_0x46c9f7(0x16b)]),'ack':!![]});if(_0x5e39db[_0x46c9f7(0x182)]){_0x5e39db['rawEventLog'][_0x46c9f7(0x178)](_0x2049da);if(_0x5e39db[_0x46c9f7(0x185)][_0x46c9f7(0x14a)]>RAW_LOG_MAX_SIZE)_0x5e39db['rawEventLog'][_0x46c9f7(0x169)](0x0,_0x5e39db[_0x46c9f7(0x185)][_0x46c9f7(0x14a)]-RAW_LOG_MAX_SIZE);await _0x5e39db[_0x46c9f7(0x142)](_0x46c9f7(0x136),{'val':JSON[_0x46c9f7(0x152)](_0x5e39db[_0x46c9f7(0x185)]),'ack':!![]}),recordSequence(_0x5e39db,_0x2049da);}if(_0x491a78[_0x46c9f7(0x171)]&&_0x578398===!![]){if(_0x5e39db[_0x46c9f7(0x133)]&&!_0x5e39db['isGracePeriodActive'])startExitTimer(_0x5e39db);else{if(!_0x5e39db[_0x46c9f7(0x133)])setPresence(_0x5e39db,!![]);}}else{if(_0x491a78[_0x46c9f7(0x165)]==='motion'&&_0x578398===!![]){if(_0x5e39db[_0x46c9f7(0x13e)])abortExitTimer(_0x5e39db);if(!_0x5e39db['isPresent']&&_0x5e39db[_0x46c9f7(0x13a)]===_0x46c9f7(0x164))setPresence(_0x5e39db,!![]);}}_0x5e39db['isProVersion']&&_0x491a78[_0x46c9f7(0x165)]===_0x46c9f7(0x13d)&&_0x578398===!![]&&_0x491a78[_0x46c9f7(0x13c)]&&_0x5e39db[_0x46c9f7(0x15d)]&&_0x5e39db['sendToPythonWrapper'](_0x46c9f7(0x189),{'room':_0x491a78[_0x46c9f7(0x13c)]});}module[a3_0x455006(0x168)]={'processSensorEvent':processSensorEvent,'getOutsideTemperatureNumeric':getOutsideTemperatureNumeric,'setPresence':setPresence,'abortExitTimer':abortExitTimer,'startExitTimer':startExitTimer};