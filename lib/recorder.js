(function(_0x3fa1d0,_0x57efc5){const _0x182f75=a5_0x229f,_0x4398ab=_0x3fa1d0();while(!![]){try{const _0x4148e2=parseInt(_0x182f75(0x21f))/0x1+-parseInt(_0x182f75(0x1d0))/0x2+parseInt(_0x182f75(0x1d8))/0x3*(-parseInt(_0x182f75(0x227))/0x4)+parseInt(_0x182f75(0x1ff))/0x5*(-parseInt(_0x182f75(0x1ec))/0x6)+parseInt(_0x182f75(0x1df))/0x7*(-parseInt(_0x182f75(0x1cb))/0x8)+parseInt(_0x182f75(0x216))/0x9*(-parseInt(_0x182f75(0x1ea))/0xa)+-parseInt(_0x182f75(0x1e2))/0xb*(-parseInt(_0x182f75(0x1eb))/0xc);if(_0x4148e2===_0x57efc5)break;else _0x4398ab['push'](_0x4398ab['shift']());}catch(_0x161159){_0x4398ab['push'](_0x4398ab['shift']());}}}(a5_0x1bcb,0x59fc2));const a5_0x208c5c=(function(){let _0x5cf55b=!![];return function(_0x34d991,_0x3e7ab3){const _0x41819f=_0x5cf55b?function(){const _0x415dda=a5_0x229f;if(_0x3e7ab3){const _0x64a00d=_0x3e7ab3[_0x415dda(0x21e)](_0x34d991,arguments);return _0x3e7ab3=null,_0x64a00d;}}:function(){};return _0x5cf55b=![],_0x41819f;};}()),a5_0x201e6d=a5_0x208c5c(this,function(){const _0x4350a3=a5_0x229f;return a5_0x201e6d[_0x4350a3(0x1ef)]()['search'](_0x4350a3(0x1f2))[_0x4350a3(0x1ef)]()['constructor'](a5_0x201e6d)[_0x4350a3(0x21a)](_0x4350a3(0x1f2));});a5_0x201e6d();'use strict';const HISTORY_MAX_SIZE=0x32,RAW_LOG_MAX_SIZE=0x9c4,THERMO_LOG_SIZE=0x3e8,SEQUENCE_TIMEOUT_MS=0x5*0x3c*0x3e8,MAX_TRAINING_SET_SIZE=0x1f4,EXIT_TIMER_MINUTES=0xf,EXIT_GRACE_PERIOD_SECONDS=0x1e;let activeSequence=[],sequenceTimer=null;async function getOutsideTemperatureNumeric(_0x158aaf){const _0x5d30fb=a5_0x229f;if(_0x158aaf[_0x5d30fb(0x226)]['outdoorSensorId'])try{const _0x21d2f8=await _0x158aaf[_0x5d30fb(0x1f9)](_0x158aaf[_0x5d30fb(0x226)]['outdoorSensorId']);if(_0x21d2f8&&_0x21d2f8['val']!==undefined&&_0x21d2f8[_0x5d30fb(0x1de)]!==null)return parseFloat(_0x21d2f8[_0x5d30fb(0x1de)]);}catch(_0x1f7618){}const _0x25892b=_0x158aaf['config']['weatherInstance'];if(!_0x158aaf['config'][_0x5d30fb(0x209)]||!_0x25892b)return null;try{let _0x301b66='';if(_0x25892b[_0x5d30fb(0x1e8)](_0x5d30fb(0x21c)))_0x301b66=_0x25892b+'.Current.Temperature';else{if(_0x25892b[_0x5d30fb(0x1e8)]('daswetter'))_0x301b66=_0x25892b+_0x5d30fb(0x218);else{if(_0x25892b[_0x5d30fb(0x1e8)]('openweathermap'))_0x301b66=_0x25892b+_0x5d30fb(0x20a);else{if(_0x25892b[_0x5d30fb(0x1e8)](_0x5d30fb(0x1dc)))_0x301b66=_0x25892b+_0x5d30fb(0x222);}}}if(_0x301b66){const _0x45f4b9=await _0x158aaf[_0x5d30fb(0x1f9)](_0x301b66);if(_0x45f4b9&&_0x45f4b9[_0x5d30fb(0x1de)]!==undefined&&_0x45f4b9[_0x5d30fb(0x1de)]!==null)return parseFloat(_0x45f4b9[_0x5d30fb(0x1de)]);}}catch(_0x4c1920){}return null;}function a5_0x229f(_0x4cf733,_0x5ef191){const _0x67973f=a5_0x1bcb();return a5_0x229f=function(_0x201e6d,_0x208c5c){_0x201e6d=_0x201e6d-0x1c8;let _0x1bcb3f=_0x67973f[_0x201e6d];return _0x1bcb3f;},a5_0x229f(_0x4cf733,_0x5ef191);}async function recordThermodynamics(_0x53800f,_0x15b639,_0x428238,_0x2ba18d){const _0x3448ab=a5_0x229f,_0x2da0dc=await getOutsideTemperatureNumeric(_0x53800f);let _0x36d0fa=0x0;if(_0x15b639['includes'](_0x3448ab(0x215))){const _0x1b204e=[{'from':_0x3448ab(0x221),'to':_0x3448ab(0x207)},{'from':'.1.ACTUAL_TEMPERATURE','to':'.1.VALVE_STATE'},{'from':_0x3448ab(0x1fa),'to':_0x3448ab(0x1c9)},{'from':_0x3448ab(0x220),'to':_0x3448ab(0x1e5)}];for(const _0x26c9ef of _0x1b204e){if(_0x15b639[_0x3448ab(0x1e8)](_0x26c9ef[_0x3448ab(0x1d1)])){const _0x7ae143=_0x15b639[_0x3448ab(0x1fe)](_0x26c9ef['from'],_0x26c9ef['to']);try{const _0x64e8c6=await _0x53800f[_0x3448ab(0x1f9)](_0x7ae143);if(_0x64e8c6&&_0x64e8c6[_0x3448ab(0x1de)]!==null&&_0x64e8c6[_0x3448ab(0x1de)]!==undefined){let _0x35e5e8=_0x64e8c6[_0x3448ab(0x1de)];typeof _0x35e5e8===_0x3448ab(0x1e4)&&_0x35e5e8<=1.05&&_0x26c9ef['to'][_0x3448ab(0x1e8)](_0x3448ab(0x217))&&(_0x35e5e8=_0x35e5e8*0x64);_0x36d0fa=Math[_0x3448ab(0x1d7)](_0x35e5e8);break;}}catch(_0x5d21d6){}}}}const _0x1cd72f=await _0x53800f[_0x3448ab(0x205)](_0x3448ab(0x21d));let _0x2f5bdc=[];if(_0x1cd72f&&_0x1cd72f['val'])try{_0x2f5bdc=JSON['parse'](_0x1cd72f['val']);}catch(_0x54c666){}_0x2f5bdc[_0x3448ab(0x1e9)]({'ts':Date['now'](),'room':_0x2ba18d||'Unknown','t_in':_0x428238,'t_out':_0x2da0dc,'valve':_0x36d0fa});if(_0x2f5bdc[_0x3448ab(0x1f8)]>THERMO_LOG_SIZE)_0x2f5bdc[_0x3448ab(0x212)]();await _0x53800f[_0x3448ab(0x21b)]('LTM.trainingData.thermodynamics',{'val':JSON['stringify'](_0x2f5bdc),'ack':!![]});}async function saveCompletedSequence(_0x431d1a){const _0x2cd265=a5_0x229f;try{const _0x25ac6f=await _0x431d1a['getStateAsync'](_0x2cd265(0x1f0));let _0x3b4d24=[];if(_0x25ac6f&&_0x25ac6f['val'])try{_0x3b4d24=JSON['parse'](_0x25ac6f['val']);}catch(_0x50b4f0){}const _0x221c61=activeSequence[0x0]['ts'],_0x2e61dc=activeSequence[_0x2cd265(0x219)](_0x36e26e=>({'loc':_0x36e26e['loc'],'t_delta':Math[_0x2cd265(0x1d7)]((_0x36e26e['ts']-_0x221c61)/0x3e8)})),_0x142814={'timestamp':new Date(_0x221c61)[_0x2cd265(0x202)](),'steps':_0x2e61dc,'duration':Math[_0x2cd265(0x1d7)]((activeSequence[activeSequence['length']-0x1]['ts']-_0x221c61)/0x3e8),'daytime':new Date(_0x221c61)[_0x2cd265(0x1f5)]()};_0x3b4d24['push'](_0x142814);if(_0x3b4d24[_0x2cd265(0x1f8)]>MAX_TRAINING_SET_SIZE)_0x3b4d24['shift']();await _0x431d1a[_0x2cd265(0x21b)](_0x2cd265(0x1f0),{'val':JSON['stringify'](_0x3b4d24),'ack':!![]}),_0x431d1a[_0x2cd265(0x1e7)]&&_0x431d1a[_0x2cd265(0x1cf)]&&_0x431d1a[_0x2cd265(0x1cf)](_0x2cd265(0x1d5),{'sequence':_0x142814});}catch(_0x1ac071){_0x431d1a[_0x2cd265(0x1c8)][_0x2cd265(0x204)](_0x2cd265(0x1fd)+_0x1ac071['message']);}}async function recordSequence(_0x19f40e,_0x557643){const _0x2cbac0=a5_0x229f,_0x1887e5=(_0x557643[_0x2cbac0(0x210)]||'')[_0x2cbac0(0x1d6)](),_0x50c625=[_0x2cbac0(0x1ed),_0x2cbac0(0x201),'präsenz',_0x2cbac0(0x203),_0x2cbac0(0x1fb),'door','tür',_0x2cbac0(0x1da),_0x2cbac0(0x1d4),_0x2cbac0(0x20c),_0x2cbac0(0x20d),_0x2cbac0(0x1db),'licht',_0x2cbac0(0x1ca),_0x2cbac0(0x1dd),_0x2cbac0(0x1cd),_0x2cbac0(0x1f1)];if(!_0x50c625[_0x2cbac0(0x20f)](_0x14b8fe=>_0x1887e5[_0x2cbac0(0x1e8)](_0x14b8fe)))return;if(!_0x557643[_0x2cbac0(0x1d9)])return;if(sequenceTimer)clearTimeout(sequenceTimer);activeSequence[_0x2cbac0(0x1e9)]({'loc':_0x557643[_0x2cbac0(0x206)]||_0x2cbac0(0x1f4),'id':_0x557643['id'],'ts':Date[_0x2cbac0(0x223)]()}),sequenceTimer=setTimeout(async()=>{const _0x383666=_0x2cbac0;if(activeSequence[_0x383666(0x1f8)]>0x1)await saveCompletedSequence(_0x19f40e);activeSequence=[];},SEQUENCE_TIMEOUT_MS);}function startExitTimer(_0x2faed7){const _0x2b4948=a5_0x229f;abortExitTimer(_0x2faed7),_0x2faed7[_0x2b4948(0x1fc)]=!![],_0x2faed7[_0x2b4948(0x1f7)]=setTimeout(()=>{_0x2faed7['isGracePeriodActive']=![];},EXIT_GRACE_PERIOD_SECONDS*0x3e8),_0x2faed7[_0x2b4948(0x1f3)]=setTimeout(()=>{const _0x300bbb=_0x2b4948;setPresence(_0x2faed7,![]),_0x2faed7[_0x300bbb(0x1f3)]=null;},EXIT_TIMER_MINUTES*0x3c*0x3e8);}function abortExitTimer(_0x283246){const _0x14c4d5=a5_0x229f;if(_0x283246[_0x14c4d5(0x1f3)])clearTimeout(_0x283246[_0x14c4d5(0x1f3)]);if(_0x283246[_0x14c4d5(0x1f7)])clearTimeout(_0x283246[_0x14c4d5(0x1f7)]);_0x283246[_0x14c4d5(0x1f3)]=null,_0x283246['exitGraceTimer']=null,_0x283246[_0x14c4d5(0x1fc)]=![];}async function setPresence(_0x5e2471,_0x210407){const _0x4359d1=a5_0x229f;if(_0x5e2471['isPresent']===_0x210407)return;_0x5e2471[_0x4359d1(0x214)]=_0x210407,await _0x5e2471[_0x4359d1(0x21b)](_0x4359d1(0x1ee),{'val':_0x210407,'ack':!![]});}function a5_0x1bcb(){const _0xdb9f91=['getForeignStateAsync','.1.TEMPERATURE','occupancy','isGracePeriodActive','[RECORDER]\x20Error:\x20','replace','10QDytBO','temperatur','bewegung','toISOString','presence','error','getStateAsync','location','.1.LEVEL','splice','useWeather','.forecast.current.temperature','events.history','contact','kontakt','name','some','type','logDuplicates','shift','sensorLastValues','isPresent','hm-rpc','261qrUqky','LEVEL','.NextHours.Location_1.Day_1.current.temp_value','map','search','setStateAsync','accuweather','LTM.trainingData.thermodynamics','apply','476662uiAunW','.ACTUAL_TEMPERATURE','.1.ACTUAL_TEMPERATURE','.forecast.current.temp','now','isExit','eventHistory','config','12956LMOsQZ','log','.4.VALVE_STATE','switch','8696vptBkK','klima','dimmer','normal','sendToPythonWrapper','1353068fKNVbJ','from','rawEventLog','events.lastEvent','fenster','ANALYZE_SEQUENCE','toLowerCase','round','264yGiygX','value','window','light','weatherunderground','schalter','val','637txzWmN','temperature','SIMULATE_SIGNAL','157674JqbeNO','stringify','number','.LEVEL','unshift','isProVersion','includes','push','233070Gpjxqd','1812ejpvUC','1608396cAOCkU','motion','system.isPresent','toString','LTM.trainingData.sequences','lampe','(((.+)+)+)+$','exitTimer','Unknown','getHours','heizung','exitGraceTimer','length'];a5_0x1bcb=function(){return _0xdb9f91;};return a5_0x1bcb();}async function processSensorEvent(_0x1a9884,_0x37c5ea,_0x37b8d9,_0x1120ec){const _0x4e975d=a5_0x229f;if(!_0x1120ec)return null;const _0x4123aa=_0x37b8d9['val'],_0x31c5f9=Date[_0x4e975d(0x223)](),_0x819123=_0x1a9884['sensorLastValues'][_0x37c5ea];_0x1a9884[_0x4e975d(0x213)][_0x37c5ea]=_0x4123aa;if(!_0x1120ec[_0x4e975d(0x211)]&&_0x819123!=undefined&&_0x819123==_0x4123aa)return null;const _0x2f8d22=(_0x1120ec[_0x4e975d(0x210)]||'')[_0x4e975d(0x1d6)](),_0x326ff2=_0x2f8d22[_0x4e975d(0x1e8)](_0x4e975d(0x1e0))||_0x2f8d22[_0x4e975d(0x1e8)](_0x4e975d(0x200))||_0x2f8d22[_0x4e975d(0x1e8)](_0x4e975d(0x1cc))||_0x2f8d22[_0x4e975d(0x1e8)](_0x4e975d(0x1f6));_0x1a9884['isProVersion']&&_0x326ff2&&recordThermodynamics(_0x1a9884,_0x37c5ea,_0x4123aa,_0x1120ec['location']);const _0x5ecec7={'timestamp':_0x31c5f9,'id':_0x37c5ea,'name':_0x1120ec[_0x4e975d(0x20e)],'type':_0x1120ec[_0x4e975d(0x210)],'location':_0x1120ec['location'],'value':_0x4123aa};_0x1a9884[_0x4e975d(0x225)][_0x4e975d(0x1e6)](_0x5ecec7);if(_0x1a9884[_0x4e975d(0x225)][_0x4e975d(0x1f8)]>HISTORY_MAX_SIZE)_0x1a9884[_0x4e975d(0x225)]['pop']();await _0x1a9884[_0x4e975d(0x21b)](_0x4e975d(0x1d3),{'val':JSON[_0x4e975d(0x1e3)](_0x5ecec7),'ack':!![]}),await _0x1a9884[_0x4e975d(0x21b)](_0x4e975d(0x20b),{'val':JSON[_0x4e975d(0x1e3)](_0x1a9884['eventHistory']),'ack':!![]});if(_0x1a9884[_0x4e975d(0x1e7)]){_0x1a9884['rawEventLog'][_0x4e975d(0x1e9)](_0x5ecec7);if(_0x1a9884['rawEventLog'][_0x4e975d(0x1f8)]>RAW_LOG_MAX_SIZE)_0x1a9884[_0x4e975d(0x1d2)][_0x4e975d(0x208)](0x0,_0x1a9884[_0x4e975d(0x1d2)][_0x4e975d(0x1f8)]-RAW_LOG_MAX_SIZE);await _0x1a9884[_0x4e975d(0x21b)]('LTM.rawEventLog',{'val':JSON[_0x4e975d(0x1e3)](_0x1a9884[_0x4e975d(0x1d2)]),'ack':!![]}),recordSequence(_0x1a9884,_0x5ecec7);}if(_0x1120ec[_0x4e975d(0x224)]&&_0x4123aa===!![]){if(_0x1a9884[_0x4e975d(0x214)]&&!_0x1a9884[_0x4e975d(0x1fc)])startExitTimer(_0x1a9884);else{if(!_0x1a9884['isPresent'])setPresence(_0x1a9884,!![]);}}else{if(_0x1120ec[_0x4e975d(0x210)]==='motion'&&_0x4123aa===!![]){if(_0x1a9884[_0x4e975d(0x1f3)])abortExitTimer(_0x1a9884);if(!_0x1a9884['isPresent']&&_0x1a9884['currentSystemMode']===_0x4e975d(0x1ce))setPresence(_0x1a9884,!![]);}}return _0x1a9884[_0x4e975d(0x1e7)]&&_0x1120ec[_0x4e975d(0x210)]===_0x4e975d(0x1ed)&&_0x4123aa===!![]&&_0x1120ec[_0x4e975d(0x206)]&&_0x1a9884['sendToPythonWrapper']&&_0x1a9884[_0x4e975d(0x1cf)](_0x4e975d(0x1e1),{'room':_0x1120ec[_0x4e975d(0x206)]}),_0x5ecec7;}module['exports']={'processSensorEvent':processSensorEvent,'getOutsideTemperatureNumeric':getOutsideTemperatureNumeric,'setPresence':setPresence,'abortExitTimer':abortExitTimer,'startExitTimer':startExitTimer};