const a5_0x2288d0=a5_0x3239;function a5_0x4ced(){const _0x4c2ed7=['[RECORDER]\x20Error:\x20','isProVersion','length','TRACK_EVENT','94700FzgPNK','includes','.ACTUAL_TEMPERATURE','analysis.health.todayVector','unshift','rawEventLog','eventHistory','number','getDate','val','presence','LTM.trainingData.sequences','lampe','fenster','window','events.lastEvent','getForeignStateAsync','SIMULATE_SIGNAL','door','schloss','[RECORDER]\x20Ignored\x20implausible\x20temperature:\x20','replace','.1.ACTUAL_TEMPERATURE','LTM.rawEventLog','toString','switch','message','type','debug','temperature','some','LTM.trainingData.thermodynamics','stringify','456075cugOUt','openweathermap','isGracePeriodActive','sensorLastValues','config','klima','fill','lastTrackerEventTime','exitGraceTimer','ANALYZE_SEQUENCE','.1.LEVEL','parse','getHours','setStateAsync','2226InuqZG','916QDtKBU','isPresent','temperatur','apply','splice','präsenz','schalter','.1.VALVE_STATE','licht','motion','events.history','push','147Rwcuye','STATUS','lock','pop','light','Valve','outdoorSensorId','currentSystemMode','value','(((.+)+)+)+$','string','toLowerCase','valveMapping','289290vAeosI','shift','getStateAsync','exitTimer','exports','round','STATE','isExit','kontakt','occupancy','Unknown','location','toISOString','144988UFUtHi','dimmer','.4.VALVE_STATE','LEVEL','\x20from\x20','sendToPythonWrapper','bewegung','logDuplicates','tür','error','from','search','234041yLbEzg','.LEVEL','map','34384HpZnLx','log','useWeather','daswetter','.NextHours.Location_1.Day_1.current.temp_value','loc','contact','now'];a5_0x4ced=function(){return _0x4c2ed7;};return a5_0x4ced();}(function(_0x490550,_0x2eb2f5){const _0x251e5c=a5_0x3239,_0x29e14f=_0x490550();while(!![]){try{const _0x4e23a5=-parseInt(_0x251e5c(0x16b))/0x1+parseInt(_0x251e5c(0x15f))/0x2+-parseInt(_0x251e5c(0x138))/0x3*(-parseInt(_0x251e5c(0x139))/0x4)+parseInt(_0x251e5c(0x17a))/0x5+-parseInt(_0x251e5c(0x152))/0x6+parseInt(_0x251e5c(0x145))/0x7*(parseInt(_0x251e5c(0x16e))/0x8)+parseInt(_0x251e5c(0x19b))/0x9;if(_0x4e23a5===_0x2eb2f5)break;else _0x29e14f['push'](_0x29e14f['shift']());}catch(_0x1cf4ac){_0x29e14f['push'](_0x29e14f['shift']());}}}(a5_0x4ced,0x1d4dd));const a5_0x2667b4=(function(){let _0x5c0ae4=!![];return function(_0x1b1d87,_0x16eedb){const _0x22adc3=_0x5c0ae4?function(){const _0x2ee67c=a5_0x3239;if(_0x16eedb){const _0xa88288=_0x16eedb[_0x2ee67c(0x13c)](_0x1b1d87,arguments);return _0x16eedb=null,_0xa88288;}}:function(){};return _0x5c0ae4=![],_0x22adc3;};}()),a5_0x244b51=a5_0x2667b4(this,function(){const _0x4e5d73=a5_0x3239;return a5_0x244b51[_0x4e5d73(0x192)]()[_0x4e5d73(0x16a)](_0x4e5d73(0x14e))[_0x4e5d73(0x192)]()['constructor'](a5_0x244b51)[_0x4e5d73(0x16a)](_0x4e5d73(0x14e));});a5_0x244b51();'use strict';const HISTORY_MAX_SIZE=0x32,RAW_LOG_MAX_SIZE=0x9c4,THERMO_LOG_SIZE=0x3e8,SEQUENCE_TIMEOUT_MS=0x5*0x3c*0x3e8,MAX_TRAINING_SET_SIZE=0x1f4,EXIT_TIMER_MINUTES=0xf,EXIT_GRACE_PERIOD_SECONDS=0x1e;let activeSequence=[],sequenceTimer=null;async function getOutsideTemperatureNumeric(_0x4fb342){const _0x2defcf=a5_0x3239;if(_0x4fb342['config'][_0x2defcf(0x14b)])try{const _0x52735e=await _0x4fb342['getForeignStateAsync'](_0x4fb342[_0x2defcf(0x19f)][_0x2defcf(0x14b)]);if(_0x52735e&&_0x52735e[_0x2defcf(0x183)]!==undefined&&_0x52735e[_0x2defcf(0x183)]!==null)return parseFloat(_0x52735e['val']);}catch(_0x23d69c){}const _0x529e89=_0x4fb342[_0x2defcf(0x19f)]['weatherInstance'];if(!_0x4fb342['config'][_0x2defcf(0x170)]||!_0x529e89)return null;try{let _0x201ca1='';if(_0x529e89[_0x2defcf(0x17b)]('accuweather'))_0x201ca1=_0x529e89+'.Current.Temperature';else{if(_0x529e89[_0x2defcf(0x17b)](_0x2defcf(0x171)))_0x201ca1=_0x529e89+_0x2defcf(0x172);else{if(_0x529e89[_0x2defcf(0x17b)](_0x2defcf(0x19c)))_0x201ca1=_0x529e89+'.forecast.current.temperature';else{if(_0x529e89[_0x2defcf(0x17b)]('weatherunderground'))_0x201ca1=_0x529e89+'.forecast.current.temp';}}}if(_0x201ca1){const _0x5c38a7=await _0x4fb342[_0x2defcf(0x18a)](_0x201ca1);if(_0x5c38a7&&_0x5c38a7['val']!==undefined&&_0x5c38a7[_0x2defcf(0x183)]!==null)return parseFloat(_0x5c38a7[_0x2defcf(0x183)]);}}catch(_0x2c1bb9){}return null;}async function recordThermodynamics(_0x2b95c2,_0x503824,_0x5edec7,_0x36c414){const _0x49d479=a5_0x3239,_0x2401d0=await getOutsideTemperatureNumeric(_0x2b95c2);if(_0x2401d0===null)return;let _0x498a49=0x0,_0x155669=![];if(_0x2b95c2[_0x49d479(0x19f)][_0x49d479(0x151)])try{let _0x5152b8=_0x2b95c2[_0x49d479(0x19f)][_0x49d479(0x151)];if(typeof _0x5152b8===_0x49d479(0x14f))_0x5152b8=JSON[_0x49d479(0x1a6)](_0x5152b8);if(_0x5152b8[_0x503824]){const _0x3ef733=_0x5152b8[_0x503824],_0x52c2bd=await _0x2b95c2[_0x49d479(0x18a)](_0x3ef733);if(_0x52c2bd&&_0x52c2bd['val']!==null&&_0x52c2bd['val']!==undefined){let _0x3dc88e=Number(_0x52c2bd['val']);if(_0x3dc88e<=1.05&&!_0x3ef733[_0x49d479(0x17b)](_0x49d479(0x146))&&!_0x3ef733['includes'](_0x49d479(0x158)))_0x3dc88e=_0x3dc88e*0x64;_0x498a49=Math[_0x49d479(0x157)](_0x3dc88e),_0x155669=!![];}}}catch(_0x2178c5){}if(!_0x155669){const _0x15d4c6=[{'from':'.1.ACTUAL_TEMPERATURE','to':_0x49d479(0x1a5)},{'from':_0x49d479(0x190),'to':_0x49d479(0x140)},{'from':'.1.TEMPERATURE','to':_0x49d479(0x161)},{'from':_0x49d479(0x17c),'to':_0x49d479(0x16c)},{'from':_0x49d479(0x197),'to':'level'},{'from':'Temperature','to':_0x49d479(0x14a)}];for(const _0x379e98 of _0x15d4c6){if(_0x503824['includes'](_0x379e98[_0x49d479(0x169)])){const _0x244a6f=_0x503824[_0x49d479(0x18f)](_0x379e98[_0x49d479(0x169)],_0x379e98['to']);try{const _0x5f8421=await _0x2b95c2[_0x49d479(0x18a)](_0x244a6f);if(_0x5f8421&&_0x5f8421['val']!==null&&_0x5f8421[_0x49d479(0x183)]!==undefined){let _0x39c27c=Number(_0x5f8421[_0x49d479(0x183)]);if(typeof _0x39c27c===_0x49d479(0x181)){if(_0x39c27c<=1.05&&_0x379e98['to']['includes'](_0x49d479(0x162)))_0x39c27c=_0x39c27c*0x64;_0x498a49=Math['round'](_0x39c27c),_0x155669=!![];break;}}}catch(_0x271395){}}}}const _0x5c439b=await _0x2b95c2[_0x49d479(0x154)](_0x49d479(0x199));let _0x760471=[];if(_0x5c439b&&_0x5c439b['val'])try{_0x760471=JSON['parse'](_0x5c439b[_0x49d479(0x183)]);}catch(_0x38e27d){}_0x760471[_0x49d479(0x144)]({'ts':Date[_0x49d479(0x175)](),'room':_0x36c414||_0x49d479(0x15c),'t_in':_0x5edec7,'t_out':_0x2401d0,'valve':_0x498a49});if(_0x760471['length']>THERMO_LOG_SIZE)_0x760471[_0x49d479(0x153)]();await _0x2b95c2[_0x49d479(0x1a8)](_0x49d479(0x199),{'val':JSON[_0x49d479(0x19a)](_0x760471),'ack':!![]});}async function saveCompletedSequence(_0x35ffa9){const _0x5ac330=a5_0x3239;try{const _0x1fa96e=await _0x35ffa9[_0x5ac330(0x154)](_0x5ac330(0x185));let _0x54d518=[];if(_0x1fa96e&&_0x1fa96e['val'])try{_0x54d518=JSON[_0x5ac330(0x1a6)](_0x1fa96e[_0x5ac330(0x183)]);}catch(_0x18966e){}const _0x175950=activeSequence[0x0]['ts'],_0x286423=activeSequence[_0x5ac330(0x16d)](_0xc3492c=>({'loc':_0xc3492c[_0x5ac330(0x173)],'t_delta':Math[_0x5ac330(0x157)]((_0xc3492c['ts']-_0x175950)/0x3e8)})),_0x520102={'timestamp':new Date(_0x175950)[_0x5ac330(0x15e)](),'steps':_0x286423,'duration':Math[_0x5ac330(0x157)]((activeSequence[activeSequence['length']-0x1]['ts']-_0x175950)/0x3e8),'daytime':new Date(_0x175950)[_0x5ac330(0x1a7)]()};_0x54d518[_0x5ac330(0x144)](_0x520102);if(_0x54d518[_0x5ac330(0x178)]>MAX_TRAINING_SET_SIZE)_0x54d518[_0x5ac330(0x153)]();await _0x35ffa9[_0x5ac330(0x1a8)](_0x5ac330(0x185),{'val':JSON[_0x5ac330(0x19a)](_0x54d518),'ack':!![]}),_0x35ffa9['isProVersion']&&_0x35ffa9[_0x5ac330(0x164)]&&_0x35ffa9[_0x5ac330(0x164)](_0x5ac330(0x1a4),{'sequence':_0x520102});}catch(_0x36d3f6){_0x35ffa9[_0x5ac330(0x16f)][_0x5ac330(0x168)](_0x5ac330(0x176)+_0x36d3f6[_0x5ac330(0x194)]);}}async function recordSequence(_0x5d09fd,_0x2d7949){const _0x2fa83d=a5_0x3239,_0x149cee=(_0x2d7949[_0x2fa83d(0x195)]||'')[_0x2fa83d(0x150)](),_0x5f59c7=[_0x2fa83d(0x142),_0x2fa83d(0x165),_0x2fa83d(0x13e),_0x2fa83d(0x184),_0x2fa83d(0x15b),_0x2fa83d(0x18c),_0x2fa83d(0x167),_0x2fa83d(0x188),_0x2fa83d(0x187),_0x2fa83d(0x174),_0x2fa83d(0x15a),_0x2fa83d(0x149),_0x2fa83d(0x141),_0x2fa83d(0x193),_0x2fa83d(0x13f),_0x2fa83d(0x160),_0x2fa83d(0x186)];if(!_0x5f59c7[_0x2fa83d(0x198)](_0xcd9908=>_0x149cee['includes'](_0xcd9908)))return;if(!_0x2d7949[_0x2fa83d(0x14d)])return;if(sequenceTimer)clearTimeout(sequenceTimer);activeSequence['push']({'loc':_0x2d7949[_0x2fa83d(0x15d)]||'Unknown','id':_0x2d7949['id'],'ts':Date[_0x2fa83d(0x175)]()}),sequenceTimer=setTimeout(async()=>{if(activeSequence['length']>0x1)await saveCompletedSequence(_0x5d09fd);activeSequence=[];},SEQUENCE_TIMEOUT_MS);}function startExitTimer(_0x1fa856){const _0x4f4a46=a5_0x3239;abortExitTimer(_0x1fa856),_0x1fa856[_0x4f4a46(0x19d)]=!![],_0x1fa856[_0x4f4a46(0x1a3)]=setTimeout(()=>{const _0x634414=_0x4f4a46;_0x1fa856[_0x634414(0x19d)]=![];},EXIT_GRACE_PERIOD_SECONDS*0x3e8),_0x1fa856[_0x4f4a46(0x155)]=setTimeout(()=>{const _0x173a73=_0x4f4a46;setPresence(_0x1fa856,![]),_0x1fa856[_0x173a73(0x155)]=null;},EXIT_TIMER_MINUTES*0x3c*0x3e8);}function a5_0x3239(_0x37db2c,_0x1da09e){const _0x47cfe9=a5_0x4ced();return a5_0x3239=function(_0x244b51,_0x2667b4){_0x244b51=_0x244b51-0x138;let _0x4ced9e=_0x47cfe9[_0x244b51];return _0x4ced9e;},a5_0x3239(_0x37db2c,_0x1da09e);}function abortExitTimer(_0x48bb53){const _0x576886=a5_0x3239;if(_0x48bb53['exitTimer'])clearTimeout(_0x48bb53[_0x576886(0x155)]);if(_0x48bb53[_0x576886(0x1a3)])clearTimeout(_0x48bb53[_0x576886(0x1a3)]);_0x48bb53[_0x576886(0x155)]=null,_0x48bb53[_0x576886(0x1a3)]=null,_0x48bb53[_0x576886(0x19d)]=![];}async function setPresence(_0x5c1b7c,_0x4b2541){const _0x50062a=a5_0x3239;if(_0x5c1b7c[_0x50062a(0x13a)]===_0x4b2541)return;_0x5c1b7c[_0x50062a(0x13a)]=_0x4b2541,await _0x5c1b7c['setStateAsync']('system.isPresent',{'val':_0x4b2541,'ack':!![]});}async function updateHourlyActivity(_0x3f50cb){const _0x1f5a96=a5_0x3239;let _0x26abfd=new Array(0x18)[_0x1f5a96(0x1a1)](0x0),_0x35dd3f=0x0;try{const _0x4942b2=await _0x3f50cb[_0x1f5a96(0x154)](_0x1f5a96(0x17d));_0x4942b2&&_0x4942b2['val']&&(_0x26abfd=JSON[_0x1f5a96(0x1a6)](_0x4942b2[_0x1f5a96(0x183)]),_0x35dd3f=_0x4942b2['ts']);}catch(_0x38fb45){}const _0x1db431=new Date(_0x35dd3f),_0x5f4439=new Date();_0x1db431[_0x1f5a96(0x182)]()!==_0x5f4439[_0x1f5a96(0x182)]()&&(_0x26abfd=new Array(0x18)[_0x1f5a96(0x1a1)](0x0));const _0xf5836=_0x5f4439['getHours']();if(_0x26abfd[_0xf5836]===undefined)_0x26abfd[_0xf5836]=0x0;_0x26abfd[_0xf5836]++,await _0x3f50cb[_0x1f5a96(0x1a8)](_0x1f5a96(0x17d),{'val':JSON['stringify'](_0x26abfd),'ack':!![]});}async function processSensorEvent(_0x2ac601,_0x45673e,_0x4de5dc,_0xc8152f){const _0x4f91fc=a5_0x3239;if(!_0xc8152f)return null;const _0x55aac0=_0x4de5dc[_0x4f91fc(0x183)],_0x4a386e=Date['now'](),_0xc4ed9=_0x2ac601[_0x4f91fc(0x19e)][_0x45673e],_0x6dbf60=(_0xc8152f[_0x4f91fc(0x195)]||'')['toLowerCase'](),_0x53ca4a=_0x6dbf60[_0x4f91fc(0x17b)](_0x4f91fc(0x197))||_0x6dbf60[_0x4f91fc(0x17b)](_0x4f91fc(0x13b))||_0x6dbf60['includes'](_0x4f91fc(0x1a0))||_0x6dbf60[_0x4f91fc(0x17b)]('heizung')||_0x6dbf60['includes']('thermostat');if(_0x53ca4a&&typeof _0x55aac0==='number'){if(_0x55aac0>0x50||_0x55aac0<-0x32)return _0x2ac601['log'][_0x4f91fc(0x196)](_0x4f91fc(0x18e)+_0x55aac0+_0x4f91fc(0x163)+_0x45673e),null;}_0x2ac601[_0x4f91fc(0x19e)][_0x45673e]=_0x55aac0;if(!_0xc8152f[_0x4f91fc(0x166)]&&_0xc4ed9!=undefined&&_0xc4ed9==_0x55aac0)return null;_0x2ac601[_0x4f91fc(0x177)]&&_0x53ca4a&&recordThermodynamics(_0x2ac601,_0x45673e,_0x55aac0,_0xc8152f[_0x4f91fc(0x15d)]);const _0x3b5d9e={'timestamp':_0x4a386e,'id':_0x45673e,'name':_0xc8152f['name'],'type':_0xc8152f[_0x4f91fc(0x195)],'location':_0xc8152f[_0x4f91fc(0x15d)],'value':_0x55aac0};_0x2ac601[_0x4f91fc(0x180)][_0x4f91fc(0x17e)](_0x3b5d9e);if(_0x2ac601[_0x4f91fc(0x180)][_0x4f91fc(0x178)]>HISTORY_MAX_SIZE)_0x2ac601['eventHistory'][_0x4f91fc(0x148)]();await _0x2ac601[_0x4f91fc(0x1a8)](_0x4f91fc(0x189),{'val':JSON[_0x4f91fc(0x19a)](_0x3b5d9e),'ack':!![]}),await _0x2ac601[_0x4f91fc(0x1a8)](_0x4f91fc(0x143),{'val':JSON[_0x4f91fc(0x19a)](_0x2ac601[_0x4f91fc(0x180)]),'ack':!![]}),await updateHourlyActivity(_0x2ac601);if(_0x2ac601[_0x4f91fc(0x177)]){_0x2ac601[_0x4f91fc(0x17f)]['push'](_0x3b5d9e);if(_0x2ac601[_0x4f91fc(0x17f)][_0x4f91fc(0x178)]>RAW_LOG_MAX_SIZE)_0x2ac601[_0x4f91fc(0x17f)][_0x4f91fc(0x13d)](0x0,_0x2ac601[_0x4f91fc(0x17f)][_0x4f91fc(0x178)]-RAW_LOG_MAX_SIZE);await _0x2ac601['setStateAsync'](_0x4f91fc(0x191),{'val':JSON[_0x4f91fc(0x19a)](_0x2ac601[_0x4f91fc(0x17f)]),'ack':!![]}),recordSequence(_0x2ac601,_0x3b5d9e);}if(_0xc8152f[_0x4f91fc(0x159)]&&_0x55aac0===!![]){if(_0x2ac601[_0x4f91fc(0x13a)]&&!_0x2ac601[_0x4f91fc(0x19d)])startExitTimer(_0x2ac601);else{if(!_0x2ac601['isPresent'])setPresence(_0x2ac601,!![]);}}else{if(_0xc8152f['type']===_0x4f91fc(0x142)&&_0x55aac0===!![]){if(_0x2ac601[_0x4f91fc(0x155)])abortExitTimer(_0x2ac601);if(!_0x2ac601[_0x4f91fc(0x13a)]&&_0x2ac601[_0x4f91fc(0x14c)]==='normal')setPresence(_0x2ac601,!![]);}}if(_0x2ac601[_0x4f91fc(0x177)]&&_0x2ac601[_0x4f91fc(0x164)]){_0xc8152f[_0x4f91fc(0x195)]===_0x4f91fc(0x142)&&_0x55aac0===!![]&&_0xc8152f['location']&&_0x2ac601[_0x4f91fc(0x164)](_0x4f91fc(0x18b),{'room':_0xc8152f['location']});const _0x3176f2=[_0x4f91fc(0x18c),_0x4f91fc(0x167),_0x4f91fc(0x188),_0x4f91fc(0x187),'griff','handle',_0x4f91fc(0x147),_0x4f91fc(0x18d)]['some'](_0x1d0696=>_0x6dbf60[_0x4f91fc(0x17b)](_0x1d0696)),_0x1959d1=[_0x4f91fc(0x149),'licht',_0x4f91fc(0x193),'schalter',_0x4f91fc(0x160),'lampe']['some'](_0x228345=>_0x6dbf60[_0x4f91fc(0x17b)](_0x228345)),_0x38b8e4=[_0x4f91fc(0x142),_0x4f91fc(0x165),'präsenz',_0x4f91fc(0x184),_0x4f91fc(0x15b)][_0x4f91fc(0x198)](_0x2611ec=>_0x6dbf60[_0x4f91fc(0x17b)](_0x2611ec));if(_0xc8152f[_0x4f91fc(0x15d)]&&(_0x3176f2||_0x1959d1||_0x38b8e4)){const _0x5e016f=_0x55aac0===!![]||typeof _0x55aac0==='number'&&_0x55aac0>0x0,_0x386891=_0x3176f2&&!_0x5e016f&&_0xc4ed9!==undefined&&_0xc4ed9!=_0x55aac0;if(_0x5e016f||_0x386891){const _0x366940=_0x2ac601[_0x4f91fc(0x1a2)]||_0x4a386e,_0x6274a2=(_0x4a386e-_0x366940)/0x3e8;_0x2ac601['lastTrackerEventTime']=_0x4a386e,_0x2ac601[_0x4f91fc(0x164)](_0x4f91fc(0x179),{'room':_0xc8152f['location'],'dt':_0x6274a2});}}}return _0x3b5d9e;}module[a5_0x2288d0(0x156)]={'processSensorEvent':processSensorEvent,'getOutsideTemperatureNumeric':getOutsideTemperatureNumeric,'setPresence':setPresence,'abortExitTimer':abortExitTimer,'startExitTimer':startExitTimer};