function a4_0x50c1(_0x2e5e6d,_0x121b62){const _0x5ce53e=a4_0x20bc();return a4_0x50c1=function(_0x565ce9,_0x838fae){_0x565ce9=_0x565ce9-0x84;let _0x20bc3f=_0x5ce53e[_0x565ce9];return _0x20bc3f;},a4_0x50c1(_0x2e5e6d,_0x121b62);}const a4_0x152280=a4_0x50c1;function a4_0x20bc(){const _0x385b10=['[RECORDER]\x20Error:\x20','8eFlUgU','outdoorSensorId','(((.+)+)+)+$','constructor','length','lampe','6343767tLicuv','apply','präsenz','heizung','Unknown','exitGraceTimer','5IpRypW','sensorLastValues','45127awvuNp','pop','accuweather','type','.forecast.current.temp','exports','includes','currentSystemMode','4BRQwic','45546QnwtgU','toString','getHours','getStateAsync','switch','temperatur','useWeather','rawEventLog','motion','location','LTM.rawEventLog','dimmer','logDuplicates','splice','door','ANALYZE_SEQUENCE','normal','light','events.history','LTM.trainingData.sequences','SIMULATE_SIGNAL','exitTimer','round','presence','.forecast.current.temperature','eventHistory','96KXkmCg','isExit','sendToPythonWrapper','val','5723300FNZtbx','toLowerCase','stringify','isPresent','fenster','search','now','.Current.Temperature','some','weatherInstance','push','setStateAsync','config','events.lastEvent','message','loc','log','window','temperature','shift','value','klima','494417eFhCAj','contact','daswetter','isGracePeriodActive','parse','isProVersion','toISOString','22620OJKBWI','getForeignStateAsync','unshift','map','weatherunderground','1184644MYktEL','189DlgGve'];a4_0x20bc=function(){return _0x385b10;};return a4_0x20bc();}(function(_0x14206a,_0x105030){const _0x5918d1=a4_0x50c1,_0x5571d1=_0x14206a();while(!![]){try{const _0x9bc4c4=parseInt(_0x5918d1(0xdc))/0x1*(parseInt(_0x5918d1(0x8a))/0x2)+parseInt(_0x5918d1(0xc6))/0x3+parseInt(_0x5918d1(0xcb))/0x4*(parseInt(_0x5918d1(0xda))/0x5)+parseInt(_0x5918d1(0x8b))/0x6*(-parseInt(_0x5918d1(0xcc))/0x7)+-parseInt(_0x5918d1(0xce))/0x8*(parseInt(_0x5918d1(0xd4))/0x9)+parseInt(_0x5918d1(0xa9))/0xa+parseInt(_0x5918d1(0xbf))/0xb*(parseInt(_0x5918d1(0xa5))/0xc);if(_0x9bc4c4===_0x105030)break;else _0x5571d1['push'](_0x5571d1['shift']());}catch(_0x486d38){_0x5571d1['push'](_0x5571d1['shift']());}}}(a4_0x20bc,0x65929));const a4_0x838fae=(function(){let _0x44625b=!![];return function(_0x212236,_0x5a0f50){const _0x5968d3=_0x44625b?function(){const _0x3ae88c=a4_0x50c1;if(_0x5a0f50){const _0x49e1df=_0x5a0f50[_0x3ae88c(0xd5)](_0x212236,arguments);return _0x5a0f50=null,_0x49e1df;}}:function(){};return _0x44625b=![],_0x5968d3;};}()),a4_0x565ce9=a4_0x838fae(this,function(){const _0x272fef=a4_0x50c1;return a4_0x565ce9[_0x272fef(0x8c)]()[_0x272fef(0xae)](_0x272fef(0xd0))[_0x272fef(0x8c)]()[_0x272fef(0xd1)](a4_0x565ce9)[_0x272fef(0xae)](_0x272fef(0xd0));});a4_0x565ce9();'use strict';const HISTORY_MAX_SIZE=0x32,RAW_LOG_MAX_SIZE=0x9c4,THERMO_LOG_SIZE=0x3e8,SEQUENCE_TIMEOUT_MS=0x5*0x3c*0x3e8,MAX_TRAINING_SET_SIZE=0x1f4,EXIT_TIMER_MINUTES=0xf,EXIT_GRACE_PERIOD_SECONDS=0x1e;let activeSequence=[],sequenceTimer=null;async function getOutsideTemperatureNumeric(_0xfe72ae){const _0x398d58=a4_0x50c1;if(_0xfe72ae[_0x398d58(0xb5)]['outdoorSensorId'])try{const _0x2affdf=await _0xfe72ae[_0x398d58(0xc7)](_0xfe72ae[_0x398d58(0xb5)][_0x398d58(0xcf)]);if(_0x2affdf&&_0x2affdf[_0x398d58(0xa8)]!==undefined&&_0x2affdf['val']!==null)return parseFloat(_0x2affdf[_0x398d58(0xa8)]);}catch(_0x3794d8){}const _0x4c01c3=_0xfe72ae[_0x398d58(0xb5)][_0x398d58(0xb2)];if(!_0xfe72ae[_0x398d58(0xb5)][_0x398d58(0x91)]||!_0x4c01c3)return null;try{let _0x2ab859='';if(_0x4c01c3[_0x398d58(0x88)](_0x398d58(0x84)))_0x2ab859=_0x4c01c3+_0x398d58(0xb0);else{if(_0x4c01c3['includes'](_0x398d58(0xc1)))_0x2ab859=_0x4c01c3+'.NextHours.Location_1.Day_1.current.temp_value';else{if(_0x4c01c3['includes']('openweathermap'))_0x2ab859=_0x4c01c3+_0x398d58(0xa3);else{if(_0x4c01c3[_0x398d58(0x88)](_0x398d58(0xca)))_0x2ab859=_0x4c01c3+_0x398d58(0x86);}}}if(_0x2ab859){const _0x198df7=await _0xfe72ae[_0x398d58(0xc7)](_0x2ab859);if(_0x198df7&&_0x198df7[_0x398d58(0xa8)]!==undefined&&_0x198df7['val']!==null)return parseFloat(_0x198df7['val']);}}catch(_0x4bf4cb){}return null;}async function recordThermodynamics(_0x5bcc75,_0x2e334c,_0x3ac322,_0x12dd79){const _0x2879f3=a4_0x50c1,_0x42dc53=await getOutsideTemperatureNumeric(_0x5bcc75),_0x5a03cd=await _0x5bcc75[_0x2879f3(0x8e)]('LTM.trainingData.thermodynamics');let _0x14845a=[];if(_0x5a03cd&&_0x5a03cd[_0x2879f3(0xa8)])try{_0x14845a=JSON[_0x2879f3(0xc3)](_0x5a03cd['val']);}catch(_0x1356c1){}_0x14845a['push']({'ts':Date[_0x2879f3(0xaf)](),'room':_0x12dd79||_0x2879f3(0xd8),'t_in':_0x3ac322,'t_out':_0x42dc53});if(_0x14845a[_0x2879f3(0xd2)]>THERMO_LOG_SIZE)_0x14845a[_0x2879f3(0xbc)]();await _0x5bcc75[_0x2879f3(0xb4)]('LTM.trainingData.thermodynamics',{'val':JSON[_0x2879f3(0xab)](_0x14845a),'ack':!![]});}async function saveCompletedSequence(_0x5d4609){const _0x686254=a4_0x50c1;try{const _0x559469=await _0x5d4609['getStateAsync']('LTM.trainingData.sequences');let _0x1e6278=[];if(_0x559469&&_0x559469[_0x686254(0xa8)])try{_0x1e6278=JSON['parse'](_0x559469[_0x686254(0xa8)]);}catch(_0x19e065){}const _0xc324de=activeSequence[0x0]['ts'],_0x25247f=activeSequence[_0x686254(0xc9)](_0x281a6f=>({'loc':_0x281a6f[_0x686254(0xb8)],'t_delta':Math[_0x686254(0xa1)]((_0x281a6f['ts']-_0xc324de)/0x3e8)})),_0x50269d={'timestamp':new Date(_0xc324de)[_0x686254(0xc5)](),'steps':_0x25247f,'duration':Math['round']((activeSequence[activeSequence[_0x686254(0xd2)]-0x1]['ts']-_0xc324de)/0x3e8),'daytime':new Date(_0xc324de)[_0x686254(0x8d)]()};_0x1e6278[_0x686254(0xb3)](_0x50269d);if(_0x1e6278[_0x686254(0xd2)]>MAX_TRAINING_SET_SIZE)_0x1e6278[_0x686254(0xbc)]();await _0x5d4609[_0x686254(0xb4)](_0x686254(0x9e),{'val':JSON[_0x686254(0xab)](_0x1e6278),'ack':!![]}),_0x5d4609[_0x686254(0xc4)]&&_0x5d4609[_0x686254(0xa7)]&&_0x5d4609[_0x686254(0xa7)](_0x686254(0x9a),{'sequence':_0x50269d});}catch(_0xd6e776){_0x5d4609[_0x686254(0xb9)]['error'](_0x686254(0xcd)+_0xd6e776[_0x686254(0xb7)]);}}async function recordSequence(_0x481a5b,_0xd2af2c){const _0x339ed5=a4_0x50c1,_0x38830c=(_0xd2af2c[_0x339ed5(0x85)]||'')[_0x339ed5(0xaa)](),_0x2814c1=[_0x339ed5(0x93),'bewegung',_0x339ed5(0xd6),_0x339ed5(0xa2),'occupancy',_0x339ed5(0x99),'tür',_0x339ed5(0xba),_0x339ed5(0xad),_0x339ed5(0xc0),'kontakt',_0x339ed5(0x9c),'licht',_0x339ed5(0x8f),'schalter',_0x339ed5(0x96),_0x339ed5(0xd3)];if(!_0x2814c1[_0x339ed5(0xb1)](_0xddf2b9=>_0x38830c[_0x339ed5(0x88)](_0xddf2b9)))return;if(!_0xd2af2c[_0x339ed5(0xbd)])return;if(sequenceTimer)clearTimeout(sequenceTimer);activeSequence[_0x339ed5(0xb3)]({'loc':_0xd2af2c[_0x339ed5(0x94)]||_0x339ed5(0xd8),'id':_0xd2af2c['id'],'ts':Date[_0x339ed5(0xaf)]()}),sequenceTimer=setTimeout(async()=>{if(activeSequence['length']>0x1)await saveCompletedSequence(_0x481a5b);activeSequence=[];},SEQUENCE_TIMEOUT_MS);}function startExitTimer(_0x54458d){const _0x1a382b=a4_0x50c1;abortExitTimer(_0x54458d),_0x54458d[_0x1a382b(0xc2)]=!![],_0x54458d[_0x1a382b(0xd9)]=setTimeout(()=>{const _0x227255=_0x1a382b;_0x54458d[_0x227255(0xc2)]=![];},EXIT_GRACE_PERIOD_SECONDS*0x3e8),_0x54458d[_0x1a382b(0xa0)]=setTimeout(()=>{const _0x5daaf1=_0x1a382b;setPresence(_0x54458d,![]),_0x54458d[_0x5daaf1(0xa0)]=null;},EXIT_TIMER_MINUTES*0x3c*0x3e8);}function abortExitTimer(_0x27eb82){const _0xe965e5=a4_0x50c1;if(_0x27eb82['exitTimer'])clearTimeout(_0x27eb82[_0xe965e5(0xa0)]);if(_0x27eb82[_0xe965e5(0xd9)])clearTimeout(_0x27eb82['exitGraceTimer']);_0x27eb82[_0xe965e5(0xa0)]=null,_0x27eb82[_0xe965e5(0xd9)]=null,_0x27eb82[_0xe965e5(0xc2)]=![];}async function setPresence(_0x12dad8,_0x4185d8){const _0x18e0d8=a4_0x50c1;if(_0x12dad8[_0x18e0d8(0xac)]===_0x4185d8)return;_0x12dad8[_0x18e0d8(0xac)]=_0x4185d8,await _0x12dad8[_0x18e0d8(0xb4)]('system.isPresent',{'val':_0x4185d8,'ack':!![]});}async function processSensorEvent(_0x5032be,_0x2a49f0,_0x3519e9,_0x436e0b){const _0x303c69=a4_0x50c1;if(!_0x436e0b)return;const _0x500876=_0x3519e9['val'],_0x4152c7=Date[_0x303c69(0xaf)](),_0x188fde=_0x5032be['sensorLastValues'][_0x2a49f0];_0x5032be[_0x303c69(0xdb)][_0x2a49f0]=_0x500876;if(!_0x436e0b[_0x303c69(0x97)]&&_0x188fde!=undefined&&_0x188fde==_0x500876)return;const _0xc41380=(_0x436e0b[_0x303c69(0x85)]||'')['toLowerCase'](),_0x216565=_0xc41380['includes'](_0x303c69(0xbb))||_0xc41380[_0x303c69(0x88)](_0x303c69(0x90))||_0xc41380[_0x303c69(0x88)](_0x303c69(0xbe))||_0xc41380[_0x303c69(0x88)](_0x303c69(0xd7));_0x5032be[_0x303c69(0xc4)]&&_0x216565&&recordThermodynamics(_0x5032be,_0x2a49f0,_0x500876,_0x436e0b['location']);const _0x2c8f33={'timestamp':_0x4152c7,'id':_0x2a49f0,'name':_0x436e0b['name'],'type':_0x436e0b['type'],'location':_0x436e0b['location'],'value':_0x500876};_0x5032be[_0x303c69(0xa4)][_0x303c69(0xc8)](_0x2c8f33);if(_0x5032be[_0x303c69(0xa4)]['length']>HISTORY_MAX_SIZE)_0x5032be[_0x303c69(0xa4)][_0x303c69(0xdd)]();await _0x5032be[_0x303c69(0xb4)](_0x303c69(0xb6),{'val':JSON['stringify'](_0x2c8f33),'ack':!![]}),await _0x5032be['setStateAsync'](_0x303c69(0x9d),{'val':JSON['stringify'](_0x5032be[_0x303c69(0xa4)]),'ack':!![]});if(_0x5032be[_0x303c69(0xc4)]){_0x5032be['rawEventLog'][_0x303c69(0xb3)](_0x2c8f33);if(_0x5032be[_0x303c69(0x92)]['length']>RAW_LOG_MAX_SIZE)_0x5032be[_0x303c69(0x92)][_0x303c69(0x98)](0x0,_0x5032be['rawEventLog']['length']-RAW_LOG_MAX_SIZE);await _0x5032be[_0x303c69(0xb4)](_0x303c69(0x95),{'val':JSON['stringify'](_0x5032be[_0x303c69(0x92)]),'ack':!![]}),recordSequence(_0x5032be,_0x2c8f33);}if(_0x436e0b[_0x303c69(0xa6)]&&_0x500876===!![]){if(_0x5032be[_0x303c69(0xac)]&&!_0x5032be['isGracePeriodActive'])startExitTimer(_0x5032be);else{if(!_0x5032be[_0x303c69(0xac)])setPresence(_0x5032be,!![]);}}else{if(_0x436e0b[_0x303c69(0x85)]===_0x303c69(0x93)&&_0x500876===!![]){if(_0x5032be[_0x303c69(0xa0)])abortExitTimer(_0x5032be);if(!_0x5032be[_0x303c69(0xac)]&&_0x5032be[_0x303c69(0x89)]===_0x303c69(0x9b))setPresence(_0x5032be,!![]);}}_0x5032be[_0x303c69(0xc4)]&&_0x436e0b[_0x303c69(0x85)]===_0x303c69(0x93)&&_0x500876===!![]&&_0x436e0b['location']&&_0x5032be['sendToPythonWrapper']&&_0x5032be['sendToPythonWrapper'](_0x303c69(0x9f),{'room':_0x436e0b['location']});}module[a4_0x152280(0x87)]={'processSensorEvent':processSensorEvent,'getOutsideTemperatureNumeric':getOutsideTemperatureNumeric,'setPresence':setPresence,'abortExitTimer':abortExitTimer,'startExitTimer':startExitTimer};