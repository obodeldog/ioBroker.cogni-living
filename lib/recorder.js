const a5_0x3fbf57=a5_0x2138;(function(_0x34407b,_0x1c3b81){const _0x659f31=a5_0x2138,_0x5db548=_0x34407b();while(!![]){try{const _0x108a9c=parseInt(_0x659f31(0x1d1))/0x1*(-parseInt(_0x659f31(0x1b9))/0x2)+parseInt(_0x659f31(0x1e5))/0x3+parseInt(_0x659f31(0x1eb))/0x4*(parseInt(_0x659f31(0x195))/0x5)+-parseInt(_0x659f31(0x1dc))/0x6+-parseInt(_0x659f31(0x1a7))/0x7+parseInt(_0x659f31(0x1cb))/0x8*(parseInt(_0x659f31(0x1e4))/0x9)+-parseInt(_0x659f31(0x1a5))/0xa*(-parseInt(_0x659f31(0x1d9))/0xb);if(_0x108a9c===_0x1c3b81)break;else _0x5db548['push'](_0x5db548['shift']());}catch(_0x1276cb){_0x5db548['push'](_0x5db548['shift']());}}}(a5_0x131d,0x213b8));function a5_0x131d(){const _0x4f6689=['accuweather','getStateAsync','toISOString','outdoorSensorId','error','daswetter','.LEVEL','sensorLastValues','location','presence','isProVersion','.1.ACTUAL_TEMPERATURE','Temperature','30448ahtDkx','push','licht','type','LTM.trainingData.sequences','.1.VALVE_STATE','SIMULATE_SIGNAL','events.lastEvent','rawEventLog','includes','shift','(((.+)+)+)+$','TRACK_EVENT','pr채senz','exitTimer','temperature','isExit','[RECORDER]\x20Ignored\x20implausible\x20temperature:\x20','16NOVblP','Unknown','number','schalter','pop','replace','14ijLkhi','thermostat','lastTrackerEventTime','useWeather','.NextHours.Location_1.Day_1.current.temp_value','string','now','getHours','2647062ijUQgH','log','ANALYZE_SEQUENCE','1534590QkEASg','valveMapping','STATUS','config','toString','.Current.Temperature','debug','isGracePeriodActive','1101267pmPiQX','111135iZLhBR','weatherInstance','value','.forecast.current.temp','klima','round','4cDAkRd','\x20from\x20','stringify','splice','length','kontakt','system.isPresent','level','motion','t체r','dimmer','.1.TEMPERATURE','.ACTUAL_TEMPERATURE','.4.VALVE_STATE','isPresent','name','window','sendToPythonWrapper','schloss','openweathermap','apply','map','normal','bewegung','some','517015Mvfhen','griff','LTM.trainingData.thermodynamics','currentSystemMode','eventHistory','from','search','exitGraceTimer','setStateAsync','light','weatherunderground','getForeignStateAsync','toLowerCase','val','occupancy','fenster','20SzTUpU','.forecast.current.temperature','1830059mfBxRW','lampe','exports','logDuplicates','STATE'];a5_0x131d=function(){return _0x4f6689;};return a5_0x131d();}const a5_0x1ad3d9=(function(){let _0x29c1b1=!![];return function(_0x687a9d,_0xefa708){const _0x43cede=_0x29c1b1?function(){const _0x465361=a5_0x2138;if(_0xefa708){const _0x3b03ed=_0xefa708[_0x465361(0x1ff)](_0x687a9d,arguments);return _0xefa708=null,_0x3b03ed;}}:function(){};return _0x29c1b1=![],_0x43cede;};}()),a5_0x50ba1c=a5_0x1ad3d9(this,function(){const _0x3da33a=a5_0x2138;return a5_0x50ba1c['toString']()[_0x3da33a(0x19b)](_0x3da33a(0x1c4))[_0x3da33a(0x1e0)]()['constructor'](a5_0x50ba1c)[_0x3da33a(0x19b)](_0x3da33a(0x1c4));});a5_0x50ba1c();function a5_0x2138(_0xebca9b,_0x5dc6dd){const _0x138a0c=a5_0x131d();return a5_0x2138=function(_0x50ba1c,_0x1ad3d9){_0x50ba1c=_0x50ba1c-0x191;let _0x131d89=_0x138a0c[_0x50ba1c];return _0x131d89;},a5_0x2138(_0xebca9b,_0x5dc6dd);}'use strict';const HISTORY_MAX_SIZE=0x32,RAW_LOG_MAX_SIZE=0x9c4,THERMO_LOG_SIZE=0x3e8,SEQUENCE_TIMEOUT_MS=0x5*0x3c*0x3e8,MAX_TRAINING_SET_SIZE=0x1f4,EXIT_TIMER_MINUTES=0xf,EXIT_GRACE_PERIOD_SECONDS=0x1e;let activeSequence=[],sequenceTimer=null;async function getOutsideTemperatureNumeric(_0x39f497){const _0x59b1aa=a5_0x2138;if(_0x39f497[_0x59b1aa(0x1df)][_0x59b1aa(0x1af)])try{const _0x5d7664=await _0x39f497[_0x59b1aa(0x1a0)](_0x39f497[_0x59b1aa(0x1df)]['outdoorSensorId']);if(_0x5d7664&&_0x5d7664[_0x59b1aa(0x1a2)]!==undefined&&_0x5d7664[_0x59b1aa(0x1a2)]!==null)return parseFloat(_0x5d7664['val']);}catch(_0x2475aa){}const _0x1349e3=_0x39f497['config'][_0x59b1aa(0x1e6)];if(!_0x39f497[_0x59b1aa(0x1df)][_0x59b1aa(0x1d4)]||!_0x1349e3)return null;try{let _0x4f3b18='';if(_0x1349e3[_0x59b1aa(0x1c2)](_0x59b1aa(0x1ac)))_0x4f3b18=_0x1349e3+_0x59b1aa(0x1e1);else{if(_0x1349e3[_0x59b1aa(0x1c2)](_0x59b1aa(0x1b1)))_0x4f3b18=_0x1349e3+_0x59b1aa(0x1d5);else{if(_0x1349e3[_0x59b1aa(0x1c2)](_0x59b1aa(0x1fe)))_0x4f3b18=_0x1349e3+_0x59b1aa(0x1a6);else{if(_0x1349e3[_0x59b1aa(0x1c2)](_0x59b1aa(0x19f)))_0x4f3b18=_0x1349e3+_0x59b1aa(0x1e8);}}}if(_0x4f3b18){const _0x534a76=await _0x39f497[_0x59b1aa(0x1a0)](_0x4f3b18);if(_0x534a76&&_0x534a76[_0x59b1aa(0x1a2)]!==undefined&&_0x534a76[_0x59b1aa(0x1a2)]!==null)return parseFloat(_0x534a76['val']);}}catch(_0x3f96ae){}return null;}async function recordThermodynamics(_0x21d77c,_0x1e83f1,_0x10f254,_0x32cf6b){const _0x88343f=a5_0x2138,_0x15fc66=await getOutsideTemperatureNumeric(_0x21d77c);if(_0x15fc66===null)return;let _0x3c239b=0x0,_0x4ab2c4=![];if(_0x21d77c['config']['valveMapping'])try{let _0x4619d6=_0x21d77c[_0x88343f(0x1df)][_0x88343f(0x1dd)];if(typeof _0x4619d6===_0x88343f(0x1d6))_0x4619d6=JSON['parse'](_0x4619d6);if(_0x4619d6[_0x1e83f1]){const _0x307b1b=_0x4619d6[_0x1e83f1],_0x2fb526=await _0x21d77c[_0x88343f(0x1a0)](_0x307b1b);if(_0x2fb526&&_0x2fb526[_0x88343f(0x1a2)]!==null&&_0x2fb526[_0x88343f(0x1a2)]!==undefined){let _0x27eb72=Number(_0x2fb526['val']);if(_0x27eb72<=1.05&&!_0x307b1b[_0x88343f(0x1c2)](_0x88343f(0x1de))&&!_0x307b1b[_0x88343f(0x1c2)](_0x88343f(0x1ab)))_0x27eb72=_0x27eb72*0x64;_0x3c239b=Math['round'](_0x27eb72),_0x4ab2c4=!![];}}}catch(_0x35b270){}if(!_0x4ab2c4){const _0x5ad788=[{'from':_0x88343f(0x1b7),'to':'.1.LEVEL'},{'from':_0x88343f(0x1b7),'to':_0x88343f(0x1be)},{'from':_0x88343f(0x1f6),'to':_0x88343f(0x1f8)},{'from':_0x88343f(0x1f7),'to':_0x88343f(0x1b2)},{'from':_0x88343f(0x1c8),'to':_0x88343f(0x1f2)},{'from':_0x88343f(0x1b8),'to':'Valve'}];for(const _0x6c4e37 of _0x5ad788){if(_0x1e83f1[_0x88343f(0x1c2)](_0x6c4e37[_0x88343f(0x19a)])){const _0x1c32c7=_0x1e83f1[_0x88343f(0x1d0)](_0x6c4e37['from'],_0x6c4e37['to']);try{const _0x2c4f58=await _0x21d77c[_0x88343f(0x1a0)](_0x1c32c7);if(_0x2c4f58&&_0x2c4f58[_0x88343f(0x1a2)]!==null&&_0x2c4f58[_0x88343f(0x1a2)]!==undefined){let _0x4d9b7b=Number(_0x2c4f58[_0x88343f(0x1a2)]);if(typeof _0x4d9b7b===_0x88343f(0x1cd)){if(_0x4d9b7b<=1.05&&_0x6c4e37['to'][_0x88343f(0x1c2)]('LEVEL'))_0x4d9b7b=_0x4d9b7b*0x64;_0x3c239b=Math[_0x88343f(0x1ea)](_0x4d9b7b),_0x4ab2c4=!![];break;}}}catch(_0x5c5a38){}}}}const _0x28cd2a=await _0x21d77c[_0x88343f(0x1ad)](_0x88343f(0x197));let _0x4f22d4=[];if(_0x28cd2a&&_0x28cd2a[_0x88343f(0x1a2)])try{_0x4f22d4=JSON['parse'](_0x28cd2a[_0x88343f(0x1a2)]);}catch(_0x48d8e6){}_0x4f22d4[_0x88343f(0x1ba)]({'ts':Date[_0x88343f(0x1d7)](),'room':_0x32cf6b||_0x88343f(0x1cc),'t_in':_0x10f254,'t_out':_0x15fc66,'valve':_0x3c239b});if(_0x4f22d4[_0x88343f(0x1ef)]>THERMO_LOG_SIZE)_0x4f22d4[_0x88343f(0x1c3)]();await _0x21d77c['setStateAsync'](_0x88343f(0x197),{'val':JSON[_0x88343f(0x1ed)](_0x4f22d4),'ack':!![]});}async function saveCompletedSequence(_0x308cca){const _0x52a040=a5_0x2138;try{const _0x59c192=await _0x308cca['getStateAsync'](_0x52a040(0x1bd));let _0x18ea13=[];if(_0x59c192&&_0x59c192[_0x52a040(0x1a2)])try{_0x18ea13=JSON['parse'](_0x59c192[_0x52a040(0x1a2)]);}catch(_0x166598){}const _0x5b9d00=activeSequence[0x0]['ts'],_0x400d64=activeSequence[_0x52a040(0x191)](_0x4a8fee=>({'loc':_0x4a8fee['loc'],'t_delta':Math[_0x52a040(0x1ea)]((_0x4a8fee['ts']-_0x5b9d00)/0x3e8)})),_0xf6da6b={'timestamp':new Date(_0x5b9d00)[_0x52a040(0x1ae)](),'steps':_0x400d64,'duration':Math[_0x52a040(0x1ea)]((activeSequence[activeSequence[_0x52a040(0x1ef)]-0x1]['ts']-_0x5b9d00)/0x3e8),'daytime':new Date(_0x5b9d00)[_0x52a040(0x1d8)]()};_0x18ea13[_0x52a040(0x1ba)](_0xf6da6b);if(_0x18ea13[_0x52a040(0x1ef)]>MAX_TRAINING_SET_SIZE)_0x18ea13[_0x52a040(0x1c3)]();await _0x308cca[_0x52a040(0x19d)](_0x52a040(0x1bd),{'val':JSON[_0x52a040(0x1ed)](_0x18ea13),'ack':!![]}),_0x308cca[_0x52a040(0x1b6)]&&_0x308cca[_0x52a040(0x1fc)]&&_0x308cca[_0x52a040(0x1fc)](_0x52a040(0x1db),{'sequence':_0xf6da6b});}catch(_0x5a3d14){_0x308cca[_0x52a040(0x1da)][_0x52a040(0x1b0)]('[RECORDER]\x20Error:\x20'+_0x5a3d14['message']);}}async function recordSequence(_0x68d66d,_0x4cc4c2){const _0x4a912a=a5_0x2138,_0x294a90=(_0x4cc4c2['type']||'')[_0x4a912a(0x1a1)](),_0x29c01b=[_0x4a912a(0x1f3),_0x4a912a(0x193),'pr채senz','presence',_0x4a912a(0x1a3),'door','t체r',_0x4a912a(0x1fb),'fenster','contact',_0x4a912a(0x1f0),_0x4a912a(0x19e),'licht','switch',_0x4a912a(0x1ce),_0x4a912a(0x1f5),_0x4a912a(0x1a8)];if(!_0x29c01b[_0x4a912a(0x194)](_0x44d80f=>_0x294a90[_0x4a912a(0x1c2)](_0x44d80f)))return;if(!_0x4cc4c2[_0x4a912a(0x1e7)])return;if(sequenceTimer)clearTimeout(sequenceTimer);activeSequence[_0x4a912a(0x1ba)]({'loc':_0x4cc4c2[_0x4a912a(0x1b4)]||_0x4a912a(0x1cc),'id':_0x4cc4c2['id'],'ts':Date[_0x4a912a(0x1d7)]()}),sequenceTimer=setTimeout(async()=>{const _0x2a7a9a=_0x4a912a;if(activeSequence[_0x2a7a9a(0x1ef)]>0x1)await saveCompletedSequence(_0x68d66d);activeSequence=[];},SEQUENCE_TIMEOUT_MS);}function startExitTimer(_0x300a35){const _0x4a4ce5=a5_0x2138;abortExitTimer(_0x300a35),_0x300a35[_0x4a4ce5(0x1e3)]=!![],_0x300a35[_0x4a4ce5(0x19c)]=setTimeout(()=>{const _0xf29461=_0x4a4ce5;_0x300a35[_0xf29461(0x1e3)]=![];},EXIT_GRACE_PERIOD_SECONDS*0x3e8),_0x300a35[_0x4a4ce5(0x1c7)]=setTimeout(()=>{setPresence(_0x300a35,![]),_0x300a35['exitTimer']=null;},EXIT_TIMER_MINUTES*0x3c*0x3e8);}function abortExitTimer(_0x489e34){const _0x28c910=a5_0x2138;if(_0x489e34[_0x28c910(0x1c7)])clearTimeout(_0x489e34[_0x28c910(0x1c7)]);if(_0x489e34[_0x28c910(0x19c)])clearTimeout(_0x489e34[_0x28c910(0x19c)]);_0x489e34['exitTimer']=null,_0x489e34['exitGraceTimer']=null,_0x489e34['isGracePeriodActive']=![];}async function setPresence(_0x32c682,_0x37593b){const _0x57f12=a5_0x2138;if(_0x32c682['isPresent']===_0x37593b)return;_0x32c682['isPresent']=_0x37593b,await _0x32c682[_0x57f12(0x19d)](_0x57f12(0x1f1),{'val':_0x37593b,'ack':!![]});}async function processSensorEvent(_0x216b2d,_0x357341,_0x9417fe,_0x5d251b){const _0xaf65c8=a5_0x2138;if(!_0x5d251b)return null;const _0x8f809d=_0x9417fe[_0xaf65c8(0x1a2)],_0x18d338=Date[_0xaf65c8(0x1d7)](),_0x46e576=_0x216b2d[_0xaf65c8(0x1b3)][_0x357341],_0x8b0fa4=(_0x5d251b[_0xaf65c8(0x1bc)]||'')['toLowerCase'](),_0x55c262=_0x8b0fa4[_0xaf65c8(0x1c2)]('temperature')||_0x8b0fa4[_0xaf65c8(0x1c2)]('temperatur')||_0x8b0fa4[_0xaf65c8(0x1c2)](_0xaf65c8(0x1e9))||_0x8b0fa4[_0xaf65c8(0x1c2)]('heizung')||_0x8b0fa4[_0xaf65c8(0x1c2)](_0xaf65c8(0x1d2));if(_0x55c262&&typeof _0x8f809d===_0xaf65c8(0x1cd)){if(_0x8f809d>0x50||_0x8f809d<-0x32)return _0x216b2d[_0xaf65c8(0x1da)][_0xaf65c8(0x1e2)](_0xaf65c8(0x1ca)+_0x8f809d+_0xaf65c8(0x1ec)+_0x357341),null;}_0x216b2d[_0xaf65c8(0x1b3)][_0x357341]=_0x8f809d;if(!_0x5d251b[_0xaf65c8(0x1aa)]&&_0x46e576!=undefined&&_0x46e576==_0x8f809d)return null;_0x216b2d[_0xaf65c8(0x1b6)]&&_0x55c262&&recordThermodynamics(_0x216b2d,_0x357341,_0x8f809d,_0x5d251b[_0xaf65c8(0x1b4)]);const _0x59135d={'timestamp':_0x18d338,'id':_0x357341,'name':_0x5d251b[_0xaf65c8(0x1fa)],'type':_0x5d251b[_0xaf65c8(0x1bc)],'location':_0x5d251b[_0xaf65c8(0x1b4)],'value':_0x8f809d};_0x216b2d['eventHistory']['unshift'](_0x59135d);if(_0x216b2d[_0xaf65c8(0x199)]['length']>HISTORY_MAX_SIZE)_0x216b2d[_0xaf65c8(0x199)][_0xaf65c8(0x1cf)]();await _0x216b2d[_0xaf65c8(0x19d)](_0xaf65c8(0x1c0),{'val':JSON['stringify'](_0x59135d),'ack':!![]}),await _0x216b2d[_0xaf65c8(0x19d)]('events.history',{'val':JSON['stringify'](_0x216b2d[_0xaf65c8(0x199)]),'ack':!![]});if(_0x216b2d[_0xaf65c8(0x1b6)]){_0x216b2d[_0xaf65c8(0x1c1)][_0xaf65c8(0x1ba)](_0x59135d);if(_0x216b2d[_0xaf65c8(0x1c1)][_0xaf65c8(0x1ef)]>RAW_LOG_MAX_SIZE)_0x216b2d[_0xaf65c8(0x1c1)][_0xaf65c8(0x1ee)](0x0,_0x216b2d[_0xaf65c8(0x1c1)]['length']-RAW_LOG_MAX_SIZE);await _0x216b2d[_0xaf65c8(0x19d)]('LTM.rawEventLog',{'val':JSON['stringify'](_0x216b2d[_0xaf65c8(0x1c1)]),'ack':!![]}),recordSequence(_0x216b2d,_0x59135d);}if(_0x5d251b[_0xaf65c8(0x1c9)]&&_0x8f809d===!![]){if(_0x216b2d[_0xaf65c8(0x1f9)]&&!_0x216b2d['isGracePeriodActive'])startExitTimer(_0x216b2d);else{if(!_0x216b2d[_0xaf65c8(0x1f9)])setPresence(_0x216b2d,!![]);}}else{if(_0x5d251b[_0xaf65c8(0x1bc)]===_0xaf65c8(0x1f3)&&_0x8f809d===!![]){if(_0x216b2d[_0xaf65c8(0x1c7)])abortExitTimer(_0x216b2d);if(!_0x216b2d[_0xaf65c8(0x1f9)]&&_0x216b2d[_0xaf65c8(0x198)]===_0xaf65c8(0x192))setPresence(_0x216b2d,!![]);}}if(_0x216b2d['isProVersion']&&_0x216b2d['sendToPythonWrapper']){_0x5d251b[_0xaf65c8(0x1bc)]===_0xaf65c8(0x1f3)&&_0x8f809d===!![]&&_0x5d251b[_0xaf65c8(0x1b4)]&&_0x216b2d['sendToPythonWrapper'](_0xaf65c8(0x1bf),{'room':_0x5d251b['location']});const _0x2ac4ff=['door',_0xaf65c8(0x1f4),'window',_0xaf65c8(0x1a4),_0xaf65c8(0x196),'handle','lock',_0xaf65c8(0x1fd)][_0xaf65c8(0x194)](_0x4d29d2=>_0x8b0fa4['includes'](_0x4d29d2)),_0x4420c5=[_0xaf65c8(0x19e),_0xaf65c8(0x1bb),'switch',_0xaf65c8(0x1ce),_0xaf65c8(0x1f5),_0xaf65c8(0x1a8)][_0xaf65c8(0x194)](_0x53af95=>_0x8b0fa4[_0xaf65c8(0x1c2)](_0x53af95)),_0x2e28c2=[_0xaf65c8(0x1f3),'bewegung',_0xaf65c8(0x1c6),_0xaf65c8(0x1b5),_0xaf65c8(0x1a3)]['some'](_0x59903d=>_0x8b0fa4['includes'](_0x59903d));if(_0x5d251b[_0xaf65c8(0x1b4)]&&(_0x2ac4ff||_0x4420c5||_0x2e28c2)){const _0x7c7236=_0x8f809d===!![]||typeof _0x8f809d===_0xaf65c8(0x1cd)&&_0x8f809d>0x0,_0x5a7dbd=_0x2ac4ff&&!_0x7c7236&&_0x46e576!==undefined&&_0x46e576!=_0x8f809d;if(_0x7c7236||_0x5a7dbd){const _0x2b2f0b=_0x216b2d[_0xaf65c8(0x1d3)]||_0x18d338,_0x405df3=(_0x18d338-_0x2b2f0b)/0x3e8;_0x216b2d[_0xaf65c8(0x1d3)]=_0x18d338,_0x216b2d[_0xaf65c8(0x1fc)](_0xaf65c8(0x1c5),{'room':_0x5d251b[_0xaf65c8(0x1b4)],'dt':_0x405df3});}}}return _0x59135d;}module[a5_0x3fbf57(0x1a9)]={'processSensorEvent':processSensorEvent,'getOutsideTemperatureNumeric':getOutsideTemperatureNumeric,'setPresence':setPresence,'abortExitTimer':abortExitTimer,'startExitTimer':startExitTimer};