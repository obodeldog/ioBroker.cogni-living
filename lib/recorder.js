const a5_0x43e75c=a5_0x4e5e;function a5_0x4e5e(_0xa0a275,_0x2edcd3){const _0x36b4cc=a5_0x4ba8();return a5_0x4e5e=function(_0x9067d,_0x2ac11f){_0x9067d=_0x9067d-0xb6;let _0x4ba890=_0x36b4cc[_0x9067d];return _0x4ba890;},a5_0x4e5e(_0xa0a275,_0x2edcd3);}(function(_0x58222b,_0x39928e){const _0x546214=a5_0x4e5e,_0x5a8ccf=_0x58222b();while(!![]){try{const _0x80356a=parseInt(_0x546214(0xe6))/0x1*(parseInt(_0x546214(0xc8))/0x2)+parseInt(_0x546214(0xbc))/0x3*(parseInt(_0x546214(0xe4))/0x4)+-parseInt(_0x546214(0xd2))/0x5*(parseInt(_0x546214(0xf0))/0x6)+parseInt(_0x546214(0xcd))/0x7*(parseInt(_0x546214(0xf5))/0x8)+parseInt(_0x546214(0xe1))/0x9*(parseInt(_0x546214(0xdf))/0xa)+parseInt(_0x546214(0x102))/0xb*(parseInt(_0x546214(0xcc))/0xc)+-parseInt(_0x546214(0xf6))/0xd*(parseInt(_0x546214(0xdc))/0xe);if(_0x80356a===_0x39928e)break;else _0x5a8ccf['push'](_0x5a8ccf['shift']());}catch(_0x3a682a){_0x5a8ccf['push'](_0x5a8ccf['shift']());}}}(a5_0x4ba8,0xf05c1));const a5_0x2ac11f=(function(){let _0x3d1a91=!![];return function(_0x53e355,_0x39519f){const _0x1cf9bb=_0x3d1a91?function(){if(_0x39519f){const _0x579012=_0x39519f['apply'](_0x53e355,arguments);return _0x39519f=null,_0x579012;}}:function(){};return _0x3d1a91=![],_0x1cf9bb;};}()),a5_0x9067d=a5_0x2ac11f(this,function(){const _0x14f02c=a5_0x4e5e;return a5_0x9067d[_0x14f02c(0xfd)]()[_0x14f02c(0x108)](_0x14f02c(0xf9))['toString']()['constructor'](a5_0x9067d)['search'](_0x14f02c(0xf9));});a5_0x9067d();'use strict';const HISTORY_MAX_SIZE=0x32,RAW_LOG_MAX_SIZE=0x9c4,THERMO_LOG_SIZE=0x3e8,SEQUENCE_TIMEOUT_MS=0x5*0x3c*0x3e8,MAX_TRAINING_SET_SIZE=0x1f4,EXIT_TIMER_MINUTES=0xf,EXIT_GRACE_PERIOD_SECONDS=0x1e;let activeSequence=[],sequenceTimer=null;async function getOutsideTemperatureNumeric(_0x5475f3){const _0xdcb09c=a5_0x4e5e;if(_0x5475f3['config'][_0xdcb09c(0xce)])try{const _0x2f89cf=await _0x5475f3['getForeignStateAsync'](_0x5475f3[_0xdcb09c(0xeb)][_0xdcb09c(0xce)]);if(_0x2f89cf&&_0x2f89cf[_0xdcb09c(0xee)]!==undefined&&_0x2f89cf[_0xdcb09c(0xee)]!==null)return parseFloat(_0x2f89cf[_0xdcb09c(0xee)]);}catch(_0x49e6f2){}const _0x349d67=_0x5475f3['config'][_0xdcb09c(0x103)];if(!_0x5475f3[_0xdcb09c(0xeb)][_0xdcb09c(0xc2)]||!_0x349d67)return null;try{let _0x4cee72='';if(_0x349d67[_0xdcb09c(0x100)](_0xdcb09c(0xe7)))_0x4cee72=_0x349d67+'.Current.Temperature';else{if(_0x349d67[_0xdcb09c(0x100)](_0xdcb09c(0xb9)))_0x4cee72=_0x349d67+'.NextHours.Location_1.Day_1.current.temp_value';else{if(_0x349d67[_0xdcb09c(0x100)](_0xdcb09c(0x110)))_0x4cee72=_0x349d67+'.forecast.current.temperature';else{if(_0x349d67[_0xdcb09c(0x100)](_0xdcb09c(0xea)))_0x4cee72=_0x349d67+_0xdcb09c(0xe2);}}}if(_0x4cee72){const _0x3f9e26=await _0x5475f3[_0xdcb09c(0x10a)](_0x4cee72);if(_0x3f9e26&&_0x3f9e26[_0xdcb09c(0xee)]!==undefined&&_0x3f9e26[_0xdcb09c(0xee)]!==null)return parseFloat(_0x3f9e26[_0xdcb09c(0xee)]);}}catch(_0x7f9f26){}return null;}async function recordThermodynamics(_0x573831,_0x497465,_0x197464,_0x38dbf4){const _0x3c1c7a=a5_0x4e5e,_0x2f68e5=await getOutsideTemperatureNumeric(_0x573831);let _0x42f51c=0x0;if(_0x497465[_0x3c1c7a(0x100)](_0x3c1c7a(0xbd))){const _0x500b6b=[{'from':_0x3c1c7a(0xba),'to':'.1.LEVEL'},{'from':'.1.ACTUAL_TEMPERATURE','to':'.1.VALVE_STATE'},{'from':_0x3c1c7a(0xd3),'to':_0x3c1c7a(0xc6)},{'from':_0x3c1c7a(0xc7),'to':'.LEVEL'}];for(const _0x1c4574 of _0x500b6b){if(_0x497465['includes'](_0x1c4574[_0x3c1c7a(0x106)])){const _0xbdfcd0=_0x497465[_0x3c1c7a(0xc1)](_0x1c4574['from'],_0x1c4574['to']);try{const _0x160399=await _0x573831['getForeignStateAsync'](_0xbdfcd0);if(_0x160399&&_0x160399[_0x3c1c7a(0xee)]!==null&&_0x160399[_0x3c1c7a(0xee)]!==undefined){let _0x3dcd2d=_0x160399[_0x3c1c7a(0xee)];typeof _0x3dcd2d===_0x3c1c7a(0xca)&&_0x3dcd2d<=1.05&&_0x1c4574['to'][_0x3c1c7a(0x100)]('LEVEL')&&(_0x3dcd2d=_0x3dcd2d*0x64);_0x42f51c=Math['round'](_0x3dcd2d);break;}}catch(_0x40f718){}}}}const _0x23b455=await _0x573831[_0x3c1c7a(0xd9)](_0x3c1c7a(0x10b));let _0x34fd24=[];if(_0x23b455&&_0x23b455['val'])try{_0x34fd24=JSON[_0x3c1c7a(0x115)](_0x23b455[_0x3c1c7a(0xee)]);}catch(_0xed3729){}_0x34fd24['push']({'ts':Date[_0x3c1c7a(0xe9)](),'room':_0x38dbf4||_0x3c1c7a(0xed),'t_in':_0x197464,'t_out':_0x2f68e5,'valve':_0x42f51c});if(_0x34fd24['length']>THERMO_LOG_SIZE)_0x34fd24[_0x3c1c7a(0xff)]();await _0x573831[_0x3c1c7a(0xb6)](_0x3c1c7a(0x10b),{'val':JSON[_0x3c1c7a(0xda)](_0x34fd24),'ack':!![]});}async function saveCompletedSequence(_0x2dc35f){const _0x592459=a5_0x4e5e;try{const _0x3d8290=await _0x2dc35f[_0x592459(0xd9)](_0x592459(0x107));let _0x3aa7e7=[];if(_0x3d8290&&_0x3d8290[_0x592459(0xee)])try{_0x3aa7e7=JSON['parse'](_0x3d8290[_0x592459(0xee)]);}catch(_0xbc7fc){}const _0x1649d9=activeSequence[0x0]['ts'],_0x4883d6=activeSequence[_0x592459(0xc4)](_0x59a1f6=>({'loc':_0x59a1f6['loc'],'t_delta':Math['round']((_0x59a1f6['ts']-_0x1649d9)/0x3e8)})),_0x4c2b45={'timestamp':new Date(_0x1649d9)[_0x592459(0xe0)](),'steps':_0x4883d6,'duration':Math[_0x592459(0xd0)]((activeSequence[activeSequence[_0x592459(0xe3)]-0x1]['ts']-_0x1649d9)/0x3e8),'daytime':new Date(_0x1649d9)['getHours']()};_0x3aa7e7['push'](_0x4c2b45);if(_0x3aa7e7['length']>MAX_TRAINING_SET_SIZE)_0x3aa7e7[_0x592459(0xff)]();await _0x2dc35f[_0x592459(0xb6)]('LTM.trainingData.sequences',{'val':JSON[_0x592459(0xda)](_0x3aa7e7),'ack':!![]}),_0x2dc35f[_0x592459(0x109)]&&_0x2dc35f['sendToPythonWrapper']&&_0x2dc35f[_0x592459(0xc0)](_0x592459(0xdd),{'sequence':_0x4c2b45});}catch(_0x7ebfad){_0x2dc35f[_0x592459(0x105)][_0x592459(0xb8)](_0x592459(0xbe)+_0x7ebfad[_0x592459(0xf4)]);}}async function recordSequence(_0x18a079,_0x23c51d){const _0x129756=a5_0x4e5e,_0x3b3e9b=(_0x23c51d[_0x129756(0xfb)]||'')[_0x129756(0xb7)](),_0x58d03d=[_0x129756(0x104),_0x129756(0xfe),_0x129756(0xd4),_0x129756(0xd5),_0x129756(0xec),_0x129756(0xbb),_0x129756(0xc3),'window',_0x129756(0xc5),_0x129756(0xc9),'kontakt','light',_0x129756(0x101),'switch','schalter',_0x129756(0xcf),_0x129756(0xe8)];if(!_0x58d03d[_0x129756(0xf3)](_0x3d0871=>_0x3b3e9b[_0x129756(0x100)](_0x3d0871)))return;if(!_0x23c51d[_0x129756(0x10d)])return;if(sequenceTimer)clearTimeout(sequenceTimer);activeSequence[_0x129756(0xcb)]({'loc':_0x23c51d[_0x129756(0x10c)]||'Unknown','id':_0x23c51d['id'],'ts':Date[_0x129756(0xe9)]()}),sequenceTimer=setTimeout(async()=>{const _0x5a5f5f=_0x129756;if(activeSequence[_0x5a5f5f(0xe3)]>0x1)await saveCompletedSequence(_0x18a079);activeSequence=[];},SEQUENCE_TIMEOUT_MS);}function startExitTimer(_0x5d1103){const _0x84dce9=a5_0x4e5e;abortExitTimer(_0x5d1103),_0x5d1103[_0x84dce9(0x10f)]=!![],_0x5d1103[_0x84dce9(0xf8)]=setTimeout(()=>{_0x5d1103['isGracePeriodActive']=![];},EXIT_GRACE_PERIOD_SECONDS*0x3e8),_0x5d1103['exitTimer']=setTimeout(()=>{const _0x56092f=_0x84dce9;setPresence(_0x5d1103,![]),_0x5d1103[_0x56092f(0x112)]=null;},EXIT_TIMER_MINUTES*0x3c*0x3e8);}function abortExitTimer(_0x13a2ee){const _0x38eb72=a5_0x4e5e;if(_0x13a2ee[_0x38eb72(0x112)])clearTimeout(_0x13a2ee[_0x38eb72(0x112)]);if(_0x13a2ee[_0x38eb72(0xf8)])clearTimeout(_0x13a2ee[_0x38eb72(0xf8)]);_0x13a2ee['exitTimer']=null,_0x13a2ee[_0x38eb72(0xf8)]=null,_0x13a2ee[_0x38eb72(0x10f)]=![];}function a5_0x4ba8(){const _0x18f0e=['lampe','now','weatherunderground','config','occupancy','Unknown','val','sensorLastValues','117822jvnQzd','heizung','pop','some','message','104YqtdnO','13ABVtom','exports','exitGraceTimer','(((.+)+)+)+$','events.history','type','isPresent','toString','bewegung','shift','includes','licht','6075333JDnQmG','weatherInstance','motion','log','from','LTM.trainingData.sequences','search','isProVersion','getForeignStateAsync','LTM.trainingData.thermodynamics','location','value','currentSystemMode','isGracePeriodActive','openweathermap','system.isPresent','exitTimer','unshift','rawEventLog','parse','setStateAsync','toLowerCase','error','daswetter','.1.ACTUAL_TEMPERATURE','door','152493YRsIpT','hm-rpc','[RECORDER]\x20Error:\x20','logDuplicates','sendToPythonWrapper','replace','useWeather','tür','map','fenster','.4.VALVE_STATE','.ACTUAL_TEMPERATURE','55274bhkhrT','contact','number','push','24QgAGFF','931238ObPIWw','outdoorSensorId','dimmer','round','normal','465PVrRii','.1.TEMPERATURE','präsenz','presence','isExit','eventHistory','SIMULATE_SIGNAL','getStateAsync','stringify','temperature','58457742vapVqi','ANALYZE_SEQUENCE','splice','3645590EZWStf','toISOString','9zfcZkg','.forecast.current.temp','length','148nrGrCa','LTM.rawEventLog','69NTUAKq','accuweather'];a5_0x4ba8=function(){return _0x18f0e;};return a5_0x4ba8();}async function setPresence(_0x57f5bc,_0x37a019){const _0x1b093f=a5_0x4e5e;if(_0x57f5bc[_0x1b093f(0xfc)]===_0x37a019)return;_0x57f5bc['isPresent']=_0x37a019,await _0x57f5bc['setStateAsync'](_0x1b093f(0x111),{'val':_0x37a019,'ack':!![]});}async function processSensorEvent(_0x4a3473,_0x5f4967,_0x48b3df,_0x464693){const _0x12f541=a5_0x4e5e;if(!_0x464693)return null;const _0x414eff=_0x48b3df[_0x12f541(0xee)],_0x403134=Date[_0x12f541(0xe9)](),_0x52c0c7=_0x4a3473['sensorLastValues'][_0x5f4967];_0x4a3473[_0x12f541(0xef)][_0x5f4967]=_0x414eff;if(!_0x464693[_0x12f541(0xbf)]&&_0x52c0c7!=undefined&&_0x52c0c7==_0x414eff)return null;const _0x5d6b3c=(_0x464693['type']||'')[_0x12f541(0xb7)](),_0x163f64=_0x5d6b3c[_0x12f541(0x100)](_0x12f541(0xdb))||_0x5d6b3c[_0x12f541(0x100)]('temperatur')||_0x5d6b3c[_0x12f541(0x100)]('klima')||_0x5d6b3c[_0x12f541(0x100)](_0x12f541(0xf1));_0x4a3473['isProVersion']&&_0x163f64&&recordThermodynamics(_0x4a3473,_0x5f4967,_0x414eff,_0x464693['location']);const _0x3c13be={'timestamp':_0x403134,'id':_0x5f4967,'name':_0x464693['name'],'type':_0x464693[_0x12f541(0xfb)],'location':_0x464693['location'],'value':_0x414eff};_0x4a3473[_0x12f541(0xd7)][_0x12f541(0x113)](_0x3c13be);if(_0x4a3473['eventHistory'][_0x12f541(0xe3)]>HISTORY_MAX_SIZE)_0x4a3473['eventHistory'][_0x12f541(0xf2)]();await _0x4a3473['setStateAsync']('events.lastEvent',{'val':JSON['stringify'](_0x3c13be),'ack':!![]}),await _0x4a3473[_0x12f541(0xb6)](_0x12f541(0xfa),{'val':JSON['stringify'](_0x4a3473[_0x12f541(0xd7)]),'ack':!![]});if(_0x4a3473[_0x12f541(0x109)]){_0x4a3473[_0x12f541(0x114)][_0x12f541(0xcb)](_0x3c13be);if(_0x4a3473[_0x12f541(0x114)][_0x12f541(0xe3)]>RAW_LOG_MAX_SIZE)_0x4a3473[_0x12f541(0x114)][_0x12f541(0xde)](0x0,_0x4a3473[_0x12f541(0x114)][_0x12f541(0xe3)]-RAW_LOG_MAX_SIZE);await _0x4a3473[_0x12f541(0xb6)](_0x12f541(0xe5),{'val':JSON[_0x12f541(0xda)](_0x4a3473['rawEventLog']),'ack':!![]}),recordSequence(_0x4a3473,_0x3c13be);}if(_0x464693[_0x12f541(0xd6)]&&_0x414eff===!![]){if(_0x4a3473['isPresent']&&!_0x4a3473[_0x12f541(0x10f)])startExitTimer(_0x4a3473);else{if(!_0x4a3473[_0x12f541(0xfc)])setPresence(_0x4a3473,!![]);}}else{if(_0x464693[_0x12f541(0xfb)]==='motion'&&_0x414eff===!![]){if(_0x4a3473['exitTimer'])abortExitTimer(_0x4a3473);if(!_0x4a3473[_0x12f541(0xfc)]&&_0x4a3473[_0x12f541(0x10e)]===_0x12f541(0xd1))setPresence(_0x4a3473,!![]);}}return _0x4a3473[_0x12f541(0x109)]&&_0x464693[_0x12f541(0xfb)]===_0x12f541(0x104)&&_0x414eff===!![]&&_0x464693['location']&&_0x4a3473[_0x12f541(0xc0)]&&_0x4a3473['sendToPythonWrapper'](_0x12f541(0xd8),{'room':_0x464693['location']}),_0x3c13be;}module[a5_0x43e75c(0xf7)]={'processSensorEvent':processSensorEvent,'getOutsideTemperatureNumeric':getOutsideTemperatureNumeric,'setPresence':setPresence,'abortExitTimer':abortExitTimer,'startExitTimer':startExitTimer};