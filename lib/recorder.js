const a5_0x551840=a5_0x2853;(function(_0xe6f276,_0x276d6c){const _0x14647a=a5_0x2853,_0x4624d9=_0xe6f276();while(!![]){try{const _0x1a214a=parseInt(_0x14647a(0xeb))/0x1*(-parseInt(_0x14647a(0xc8))/0x2)+-parseInt(_0x14647a(0xf2))/0x3+parseInt(_0x14647a(0xdb))/0x4+parseInt(_0x14647a(0xab))/0x5*(parseInt(_0x14647a(0x10a))/0x6)+-parseInt(_0x14647a(0xc2))/0x7*(-parseInt(_0x14647a(0xd4))/0x8)+-parseInt(_0x14647a(0xe9))/0x9*(-parseInt(_0x14647a(0xe5))/0xa)+-parseInt(_0x14647a(0xf6))/0xb;if(_0x1a214a===_0x276d6c)break;else _0x4624d9['push'](_0x4624d9['shift']());}catch(_0x2d28bf){_0x4624d9['push'](_0x4624d9['shift']());}}}(a5_0x2203,0x629a1));function a5_0x2853(_0x16c2ca,_0x358fd2){const _0x54662b=a5_0x2203();return a5_0x2853=function(_0x5949cb,_0x773ac0){_0x5949cb=_0x5949cb-0xaa;let _0x2203db=_0x54662b[_0x5949cb];return _0x2203db;},a5_0x2853(_0x16c2ca,_0x358fd2);}function a5_0x2203(){const _0x3736be=['openweathermap','round','2aTlPhL','weatherunderground','heizung','temperatur','licht','isProVersion','schalter','system.isPresent','search','shift','push','now','32OYEvOt','.1.ACTUAL_TEMPERATURE','normal','location','map','door','LTM.rawEventLog','293356iCeHCM','length','exports','präsenz','.forecast.current.temperature','some','isExit','eventHistory','getForeignStateAsync','presence','1785430ejljUn','includes','[RECORDER]\x20Error:\x20','outdoorSensorId','27vHqAKl','.LEVEL','509482rgNgeD','getStateAsync','SIMULATE_SIGNAL','.1.TEMPERATURE','isPresent','from','LTM.trainingData.sequences','1161009tVINTO','setStateAsync','sendToPythonWrapper','light','3574274TvkPzc','name','kontakt','val','bewegung','currentSystemMode','lampe','parse','apply','toLowerCase','exitGraceTimer','replace','contact','value','.NextHours.Location_1.Day_1.current.temp_value','motion','hm-rpc','splice','message','stringify','918096fPIBvX','logDuplicates','15QDjvtP','log','number','.ACTUAL_TEMPERATURE','exitTimer','toISOString','isGracePeriodActive','.forecast.current.temp','type','sensorLastValues','config','temperature','LEVEL','.1.LEVEL','useWeather','.1.VALVE_STATE','daswetter','dimmer','LTM.trainingData.thermodynamics','rawEventLog','fenster','getHours','tür','975233kIyqJp','Unknown','window','switch'];a5_0x2203=function(){return _0x3736be;};return a5_0x2203();}const a5_0x773ac0=(function(){let _0x4d6b87=!![];return function(_0x56adde,_0x4d06d3){const _0x1a2a82=_0x4d6b87?function(){const _0x4dbd57=a5_0x2853;if(_0x4d06d3){const _0x4e065e=_0x4d06d3[_0x4dbd57(0xfe)](_0x56adde,arguments);return _0x4d06d3=null,_0x4e065e;}}:function(){};return _0x4d6b87=![],_0x1a2a82;};}()),a5_0x5949cb=a5_0x773ac0(this,function(){const _0x40ca6b=a5_0x2853;return a5_0x5949cb['toString']()[_0x40ca6b(0xd0)]('(((.+)+)+)+$')['toString']()['constructor'](a5_0x5949cb)[_0x40ca6b(0xd0)]('(((.+)+)+)+$');});a5_0x5949cb();'use strict';const HISTORY_MAX_SIZE=0x32,RAW_LOG_MAX_SIZE=0x9c4,THERMO_LOG_SIZE=0x3e8,SEQUENCE_TIMEOUT_MS=0x5*0x3c*0x3e8,MAX_TRAINING_SET_SIZE=0x1f4,EXIT_TIMER_MINUTES=0xf,EXIT_GRACE_PERIOD_SECONDS=0x1e;let activeSequence=[],sequenceTimer=null;async function getOutsideTemperatureNumeric(_0x3724f6){const _0x23994b=a5_0x2853;if(_0x3724f6[_0x23994b(0xb5)]['outdoorSensorId'])try{const _0x4555ab=await _0x3724f6[_0x23994b(0xe3)](_0x3724f6[_0x23994b(0xb5)][_0x23994b(0xe8)]);if(_0x4555ab&&_0x4555ab[_0x23994b(0xf9)]!==undefined&&_0x4555ab[_0x23994b(0xf9)]!==null)return parseFloat(_0x4555ab[_0x23994b(0xf9)]);}catch(_0x3c7c9e){}const _0x4f3143=_0x3724f6['config']['weatherInstance'];if(!_0x3724f6[_0x23994b(0xb5)][_0x23994b(0xb9)]||!_0x4f3143)return null;try{let _0x526cee='';if(_0x4f3143[_0x23994b(0xe6)]('accuweather'))_0x526cee=_0x4f3143+'.Current.Temperature';else{if(_0x4f3143[_0x23994b(0xe6)](_0x23994b(0xbb)))_0x526cee=_0x4f3143+_0x23994b(0x104);else{if(_0x4f3143[_0x23994b(0xe6)](_0x23994b(0xc6)))_0x526cee=_0x4f3143+_0x23994b(0xdf);else{if(_0x4f3143[_0x23994b(0xe6)](_0x23994b(0xc9)))_0x526cee=_0x4f3143+_0x23994b(0xb2);}}}if(_0x526cee){const _0x4bd19f=await _0x3724f6[_0x23994b(0xe3)](_0x526cee);if(_0x4bd19f&&_0x4bd19f[_0x23994b(0xf9)]!==undefined&&_0x4bd19f[_0x23994b(0xf9)]!==null)return parseFloat(_0x4bd19f['val']);}}catch(_0x23022f){}return null;}async function recordThermodynamics(_0x4b136f,_0x3f25e5,_0x3c103d,_0x18b106){const _0x394ef0=a5_0x2853,_0x32e1ee=await getOutsideTemperatureNumeric(_0x4b136f);let _0x3cd0b3=0x0;if(_0x3f25e5[_0x394ef0(0xe6)](_0x394ef0(0x106))){const _0x4889da=[{'from':_0x394ef0(0xd5),'to':_0x394ef0(0xb8)},{'from':'.1.ACTUAL_TEMPERATURE','to':_0x394ef0(0xba)},{'from':_0x394ef0(0xee),'to':'.4.VALVE_STATE'},{'from':_0x394ef0(0xae),'to':_0x394ef0(0xea)}];for(const _0x5db7aa of _0x4889da){if(_0x3f25e5[_0x394ef0(0xe6)](_0x5db7aa[_0x394ef0(0xf0)])){const _0x48a495=_0x3f25e5[_0x394ef0(0x101)](_0x5db7aa['from'],_0x5db7aa['to']);try{const _0x23dd07=await _0x4b136f[_0x394ef0(0xe3)](_0x48a495);if(_0x23dd07&&_0x23dd07['val']!==null&&_0x23dd07[_0x394ef0(0xf9)]!==undefined){let _0x2e82ea=_0x23dd07[_0x394ef0(0xf9)];typeof _0x2e82ea===_0x394ef0(0xad)&&_0x2e82ea<=1.05&&_0x5db7aa['to'][_0x394ef0(0xe6)](_0x394ef0(0xb7))&&(_0x2e82ea=_0x2e82ea*0x64);_0x3cd0b3=Math[_0x394ef0(0xc7)](_0x2e82ea);break;}}catch(_0x11a6d6){}}}}const _0x2192f3=await _0x4b136f[_0x394ef0(0xec)](_0x394ef0(0xbd));let _0x1d4728=[];if(_0x2192f3&&_0x2192f3[_0x394ef0(0xf9)])try{_0x1d4728=JSON[_0x394ef0(0xfd)](_0x2192f3['val']);}catch(_0x427be9){}_0x1d4728[_0x394ef0(0xd2)]({'ts':Date[_0x394ef0(0xd3)](),'room':_0x18b106||_0x394ef0(0xc3),'t_in':_0x3c103d,'t_out':_0x32e1ee,'valve':_0x3cd0b3});if(_0x1d4728['length']>THERMO_LOG_SIZE)_0x1d4728[_0x394ef0(0xd1)]();await _0x4b136f[_0x394ef0(0xf3)](_0x394ef0(0xbd),{'val':JSON[_0x394ef0(0x109)](_0x1d4728),'ack':!![]});}async function saveCompletedSequence(_0x3b32af){const _0x4d214f=a5_0x2853;try{const _0x5a6315=await _0x3b32af[_0x4d214f(0xec)](_0x4d214f(0xf1));let _0x428340=[];if(_0x5a6315&&_0x5a6315[_0x4d214f(0xf9)])try{_0x428340=JSON['parse'](_0x5a6315['val']);}catch(_0x81743c){}const _0x330f36=activeSequence[0x0]['ts'],_0x54ce17=activeSequence[_0x4d214f(0xd8)](_0x44c1dc=>({'loc':_0x44c1dc['loc'],'t_delta':Math[_0x4d214f(0xc7)]((_0x44c1dc['ts']-_0x330f36)/0x3e8)})),_0x5a8944={'timestamp':new Date(_0x330f36)[_0x4d214f(0xb0)](),'steps':_0x54ce17,'duration':Math[_0x4d214f(0xc7)]((activeSequence[activeSequence[_0x4d214f(0xdc)]-0x1]['ts']-_0x330f36)/0x3e8),'daytime':new Date(_0x330f36)[_0x4d214f(0xc0)]()};_0x428340[_0x4d214f(0xd2)](_0x5a8944);if(_0x428340['length']>MAX_TRAINING_SET_SIZE)_0x428340[_0x4d214f(0xd1)]();await _0x3b32af['setStateAsync'](_0x4d214f(0xf1),{'val':JSON[_0x4d214f(0x109)](_0x428340),'ack':!![]}),_0x3b32af[_0x4d214f(0xcd)]&&_0x3b32af[_0x4d214f(0xf4)]&&_0x3b32af[_0x4d214f(0xf4)]('ANALYZE_SEQUENCE',{'sequence':_0x5a8944});}catch(_0x2d8b30){_0x3b32af[_0x4d214f(0xac)]['error'](_0x4d214f(0xe7)+_0x2d8b30[_0x4d214f(0x108)]);}}async function recordSequence(_0xbc91aa,_0x17838d){const _0x5daaff=a5_0x2853,_0x43d98d=(_0x17838d[_0x5daaff(0xb3)]||'')[_0x5daaff(0xff)](),_0x5e4994=[_0x5daaff(0x105),_0x5daaff(0xfa),_0x5daaff(0xde),_0x5daaff(0xe4),'occupancy',_0x5daaff(0xd9),_0x5daaff(0xc1),_0x5daaff(0xc4),_0x5daaff(0xbf),_0x5daaff(0x102),_0x5daaff(0xf8),_0x5daaff(0xf5),_0x5daaff(0xcc),_0x5daaff(0xc5),_0x5daaff(0xce),_0x5daaff(0xbc),_0x5daaff(0xfc)];if(!_0x5e4994[_0x5daaff(0xe0)](_0x4aaab7=>_0x43d98d[_0x5daaff(0xe6)](_0x4aaab7)))return;if(!_0x17838d[_0x5daaff(0x103)])return;if(sequenceTimer)clearTimeout(sequenceTimer);activeSequence[_0x5daaff(0xd2)]({'loc':_0x17838d[_0x5daaff(0xd7)]||'Unknown','id':_0x17838d['id'],'ts':Date['now']()}),sequenceTimer=setTimeout(async()=>{if(activeSequence['length']>0x1)await saveCompletedSequence(_0xbc91aa);activeSequence=[];},SEQUENCE_TIMEOUT_MS);}function startExitTimer(_0x13845d){const _0x4eb4b1=a5_0x2853;abortExitTimer(_0x13845d),_0x13845d[_0x4eb4b1(0xb1)]=!![],_0x13845d[_0x4eb4b1(0x100)]=setTimeout(()=>{const _0x40944a=_0x4eb4b1;_0x13845d[_0x40944a(0xb1)]=![];},EXIT_GRACE_PERIOD_SECONDS*0x3e8),_0x13845d['exitTimer']=setTimeout(()=>{const _0x4f0773=_0x4eb4b1;setPresence(_0x13845d,![]),_0x13845d[_0x4f0773(0xaf)]=null;},EXIT_TIMER_MINUTES*0x3c*0x3e8);}function abortExitTimer(_0x983ba5){const _0x26fa5b=a5_0x2853;if(_0x983ba5['exitTimer'])clearTimeout(_0x983ba5[_0x26fa5b(0xaf)]);if(_0x983ba5[_0x26fa5b(0x100)])clearTimeout(_0x983ba5['exitGraceTimer']);_0x983ba5[_0x26fa5b(0xaf)]=null,_0x983ba5[_0x26fa5b(0x100)]=null,_0x983ba5[_0x26fa5b(0xb1)]=![];}async function setPresence(_0x1c278d,_0x554924){const _0x223e93=a5_0x2853;if(_0x1c278d['isPresent']===_0x554924)return;_0x1c278d[_0x223e93(0xef)]=_0x554924,await _0x1c278d[_0x223e93(0xf3)](_0x223e93(0xcf),{'val':_0x554924,'ack':!![]});}async function processSensorEvent(_0x1742ee,_0x268c20,_0x1e300f,_0x2bb8af){const _0x2b97de=a5_0x2853;if(!_0x2bb8af)return null;const _0x2623d8=_0x1e300f[_0x2b97de(0xf9)],_0x313d7e=Date['now'](),_0x1d718b=_0x1742ee['sensorLastValues'][_0x268c20];_0x1742ee[_0x2b97de(0xb4)][_0x268c20]=_0x2623d8;if(!_0x2bb8af[_0x2b97de(0xaa)]&&_0x1d718b!=undefined&&_0x1d718b==_0x2623d8)return null;const _0x155286=(_0x2bb8af[_0x2b97de(0xb3)]||'')['toLowerCase'](),_0x19142b=_0x155286['includes'](_0x2b97de(0xb6))||_0x155286[_0x2b97de(0xe6)](_0x2b97de(0xcb))||_0x155286[_0x2b97de(0xe6)]('klima')||_0x155286[_0x2b97de(0xe6)](_0x2b97de(0xca));_0x1742ee[_0x2b97de(0xcd)]&&_0x19142b&&recordThermodynamics(_0x1742ee,_0x268c20,_0x2623d8,_0x2bb8af[_0x2b97de(0xd7)]);const _0x25b832={'timestamp':_0x313d7e,'id':_0x268c20,'name':_0x2bb8af[_0x2b97de(0xf7)],'type':_0x2bb8af[_0x2b97de(0xb3)],'location':_0x2bb8af[_0x2b97de(0xd7)],'value':_0x2623d8};_0x1742ee[_0x2b97de(0xe2)]['unshift'](_0x25b832);if(_0x1742ee[_0x2b97de(0xe2)][_0x2b97de(0xdc)]>HISTORY_MAX_SIZE)_0x1742ee[_0x2b97de(0xe2)]['pop']();await _0x1742ee[_0x2b97de(0xf3)]('events.lastEvent',{'val':JSON['stringify'](_0x25b832),'ack':!![]}),await _0x1742ee[_0x2b97de(0xf3)]('events.history',{'val':JSON[_0x2b97de(0x109)](_0x1742ee[_0x2b97de(0xe2)]),'ack':!![]});if(_0x1742ee[_0x2b97de(0xcd)]){_0x1742ee[_0x2b97de(0xbe)]['push'](_0x25b832);if(_0x1742ee[_0x2b97de(0xbe)][_0x2b97de(0xdc)]>RAW_LOG_MAX_SIZE)_0x1742ee[_0x2b97de(0xbe)][_0x2b97de(0x107)](0x0,_0x1742ee['rawEventLog'][_0x2b97de(0xdc)]-RAW_LOG_MAX_SIZE);await _0x1742ee[_0x2b97de(0xf3)](_0x2b97de(0xda),{'val':JSON[_0x2b97de(0x109)](_0x1742ee[_0x2b97de(0xbe)]),'ack':!![]}),recordSequence(_0x1742ee,_0x25b832);}if(_0x2bb8af[_0x2b97de(0xe1)]&&_0x2623d8===!![]){if(_0x1742ee[_0x2b97de(0xef)]&&!_0x1742ee['isGracePeriodActive'])startExitTimer(_0x1742ee);else{if(!_0x1742ee[_0x2b97de(0xef)])setPresence(_0x1742ee,!![]);}}else{if(_0x2bb8af[_0x2b97de(0xb3)]==='motion'&&_0x2623d8===!![]){if(_0x1742ee[_0x2b97de(0xaf)])abortExitTimer(_0x1742ee);if(!_0x1742ee[_0x2b97de(0xef)]&&_0x1742ee[_0x2b97de(0xfb)]===_0x2b97de(0xd6))setPresence(_0x1742ee,!![]);}}return _0x1742ee[_0x2b97de(0xcd)]&&_0x2bb8af['type']===_0x2b97de(0x105)&&_0x2623d8===!![]&&_0x2bb8af[_0x2b97de(0xd7)]&&_0x1742ee[_0x2b97de(0xf4)]&&_0x1742ee[_0x2b97de(0xf4)](_0x2b97de(0xed),{'room':_0x2bb8af[_0x2b97de(0xd7)]}),_0x25b832;}module[a5_0x551840(0xdd)]={'processSensorEvent':processSensorEvent,'getOutsideTemperatureNumeric':getOutsideTemperatureNumeric,'setPresence':setPresence,'abortExitTimer':abortExitTimer,'startExitTimer':startExitTimer};