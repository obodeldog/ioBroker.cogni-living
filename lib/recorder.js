const a4_0x509814=a4_0x436f;function a4_0x436f(_0x51ed0b,_0x51899b){const _0x40291c=a4_0x9780();return a4_0x436f=function(_0x15e1c7,_0x68e6de){_0x15e1c7=_0x15e1c7-0x128;let _0x97800b=_0x40291c[_0x15e1c7];return _0x97800b;},a4_0x436f(_0x51ed0b,_0x51899b);}(function(_0x2bdd18,_0x2244fd){const _0x1bfa16=a4_0x436f,_0x4c092d=_0x2bdd18();while(!![]){try{const _0x18f97d=-parseInt(_0x1bfa16(0x138))/0x1*(parseInt(_0x1bfa16(0x141))/0x2)+parseInt(_0x1bfa16(0x14f))/0x3*(-parseInt(_0x1bfa16(0x135))/0x4)+parseInt(_0x1bfa16(0x17a))/0x5+-parseInt(_0x1bfa16(0x16d))/0x6*(-parseInt(_0x1bfa16(0x139))/0x7)+-parseInt(_0x1bfa16(0x13c))/0x8+parseInt(_0x1bfa16(0x14a))/0x9+parseInt(_0x1bfa16(0x17c))/0xa*(-parseInt(_0x1bfa16(0x146))/0xb);if(_0x18f97d===_0x2244fd)break;else _0x4c092d['push'](_0x4c092d['shift']());}catch(_0x1e8335){_0x4c092d['push'](_0x4c092d['shift']());}}}(a4_0x9780,0x3f8ce));const a4_0x68e6de=(function(){let _0x515126=!![];return function(_0x4cac4f,_0x864c06){const _0xff602=_0x515126?function(){const _0x2bc39e=a4_0x436f;if(_0x864c06){const _0x54d1aa=_0x864c06[_0x2bc39e(0x148)](_0x4cac4f,arguments);return _0x864c06=null,_0x54d1aa;}}:function(){};return _0x515126=![],_0xff602;};}()),a4_0x15e1c7=a4_0x68e6de(this,function(){const _0x3ed167=a4_0x436f;return a4_0x15e1c7[_0x3ed167(0x15b)]()[_0x3ed167(0x130)](_0x3ed167(0x14d))[_0x3ed167(0x15b)]()['constructor'](a4_0x15e1c7)[_0x3ed167(0x130)](_0x3ed167(0x14d));});a4_0x15e1c7();'use strict';const HISTORY_MAX_SIZE=0x32,RAW_LOG_MAX_SIZE=0x9c4,THERMO_LOG_SIZE=0x3e8,SEQUENCE_TIMEOUT_MS=0x5*0x3c*0x3e8,MAX_TRAINING_SET_SIZE=0x1f4,EXIT_TIMER_MINUTES=0xf,EXIT_GRACE_PERIOD_SECONDS=0x1e;let activeSequence=[],sequenceTimer=null;async function getOutsideTemperatureNumeric(_0x3354ba){const _0x1af4ae=a4_0x436f;if(_0x3354ba[_0x1af4ae(0x12b)][_0x1af4ae(0x145)])try{const _0xe0741a=await _0x3354ba['getForeignStateAsync'](_0x3354ba[_0x1af4ae(0x12b)][_0x1af4ae(0x145)]);if(_0xe0741a&&_0xe0741a[_0x1af4ae(0x13f)]!==undefined&&_0xe0741a[_0x1af4ae(0x13f)]!==null)return parseFloat(_0xe0741a[_0x1af4ae(0x13f)]);}catch(_0x52c455){}const _0x50a95e=_0x3354ba[_0x1af4ae(0x12b)][_0x1af4ae(0x150)];if(!_0x3354ba['config'][_0x1af4ae(0x172)]||!_0x50a95e)return null;try{let _0x11ad48='';if(_0x50a95e['includes']('accuweather'))_0x11ad48=_0x50a95e+'.Current.Temperature';else{if(_0x50a95e['includes'](_0x1af4ae(0x12d)))_0x11ad48=_0x50a95e+_0x1af4ae(0x142);else{if(_0x50a95e['includes']('openweathermap'))_0x11ad48=_0x50a95e+_0x1af4ae(0x159);else{if(_0x50a95e[_0x1af4ae(0x177)](_0x1af4ae(0x143)))_0x11ad48=_0x50a95e+_0x1af4ae(0x163);}}}if(_0x11ad48){const _0x3c1788=await _0x3354ba[_0x1af4ae(0x13b)](_0x11ad48);if(_0x3c1788&&_0x3c1788['val']!==undefined&&_0x3c1788[_0x1af4ae(0x13f)]!==null)return parseFloat(_0x3c1788['val']);}}catch(_0x5610d8){}return null;}async function recordThermodynamics(_0x4fbca1,_0x5a6615,_0x4c4bea,_0xee6e5c){const _0x201857=a4_0x436f,_0x14a716=await getOutsideTemperatureNumeric(_0x4fbca1),_0x568dd5=await _0x4fbca1[_0x201857(0x170)](_0x201857(0x13e));let _0x1c359f=[];if(_0x568dd5&&_0x568dd5['val'])try{_0x1c359f=JSON[_0x201857(0x14c)](_0x568dd5[_0x201857(0x13f)]);}catch(_0x4afe5b){}_0x1c359f[_0x201857(0x155)]({'ts':Date[_0x201857(0x12c)](),'room':_0xee6e5c||_0x201857(0x153),'t_in':_0x4c4bea,'t_out':_0x14a716});if(_0x1c359f['length']>THERMO_LOG_SIZE)_0x1c359f['shift']();await _0x4fbca1[_0x201857(0x134)]('LTM.trainingData.thermodynamics',{'val':JSON['stringify'](_0x1c359f),'ack':!![]});}async function saveCompletedSequence(_0x38c51d){const _0x10192e=a4_0x436f;try{const _0x422990=await _0x38c51d[_0x10192e(0x170)]('LTM.trainingData.sequences');let _0x7c8cc0=[];if(_0x422990&&_0x422990[_0x10192e(0x13f)])try{_0x7c8cc0=JSON[_0x10192e(0x14c)](_0x422990['val']);}catch(_0xec9df9){}const _0xcb44df=activeSequence[0x0]['ts'],_0x417268=activeSequence[_0x10192e(0x147)](_0x18267c=>({'loc':_0x18267c[_0x10192e(0x133)],'t_delta':Math[_0x10192e(0x17b)]((_0x18267c['ts']-_0xcb44df)/0x3e8)})),_0x2eeb66={'timestamp':new Date(_0xcb44df)[_0x10192e(0x16f)](),'steps':_0x417268,'duration':Math[_0x10192e(0x17b)]((activeSequence[activeSequence[_0x10192e(0x131)]-0x1]['ts']-_0xcb44df)/0x3e8),'daytime':new Date(_0xcb44df)[_0x10192e(0x162)]()};_0x7c8cc0[_0x10192e(0x155)](_0x2eeb66);if(_0x7c8cc0['length']>MAX_TRAINING_SET_SIZE)_0x7c8cc0[_0x10192e(0x15d)]();await _0x38c51d['setStateAsync'](_0x10192e(0x12a),{'val':JSON[_0x10192e(0x16e)](_0x7c8cc0),'ack':!![]}),_0x38c51d['isProVersion']&&_0x38c51d['sendToPythonWrapper']&&_0x38c51d[_0x10192e(0x151)]('ANALYZE_SEQUENCE',{'sequence':_0x2eeb66});}catch(_0x1bf329){_0x38c51d['log'][_0x10192e(0x154)](_0x10192e(0x15e)+_0x1bf329[_0x10192e(0x174)]);}}async function recordSequence(_0x1c1b01,_0xebc3a9){const _0x57a8dd=a4_0x436f,_0x559401=(_0xebc3a9[_0x57a8dd(0x152)]||'')[_0x57a8dd(0x12f)](),_0x464782=[_0x57a8dd(0x165),'bewegung',_0x57a8dd(0x156),_0x57a8dd(0x132),_0x57a8dd(0x137),_0x57a8dd(0x12e),_0x57a8dd(0x149),_0x57a8dd(0x179),_0x57a8dd(0x173),_0x57a8dd(0x140),'kontakt',_0x57a8dd(0x178),'licht','switch','schalter',_0x57a8dd(0x129),_0x57a8dd(0x14b)];if(!_0x464782[_0x57a8dd(0x144)](_0x3ab477=>_0x559401[_0x57a8dd(0x177)](_0x3ab477)))return;if(!_0xebc3a9['value'])return;if(sequenceTimer)clearTimeout(sequenceTimer);activeSequence[_0x57a8dd(0x155)]({'loc':_0xebc3a9[_0x57a8dd(0x14e)]||_0x57a8dd(0x153),'id':_0xebc3a9['id'],'ts':Date[_0x57a8dd(0x12c)]()}),sequenceTimer=setTimeout(async()=>{const _0x57dd45=_0x57a8dd;if(activeSequence[_0x57dd45(0x131)]>0x1)await saveCompletedSequence(_0x1c1b01);activeSequence=[];},SEQUENCE_TIMEOUT_MS);}function startExitTimer(_0x2dff9e){const _0x5a9b11=a4_0x436f;abortExitTimer(_0x2dff9e),_0x2dff9e[_0x5a9b11(0x16b)]=!![],_0x2dff9e[_0x5a9b11(0x168)]=setTimeout(()=>{_0x2dff9e['isGracePeriodActive']=![];},EXIT_GRACE_PERIOD_SECONDS*0x3e8),_0x2dff9e['exitTimer']=setTimeout(()=>{const _0x558aec=_0x5a9b11;setPresence(_0x2dff9e,![]),_0x2dff9e[_0x558aec(0x166)]=null;},EXIT_TIMER_MINUTES*0x3c*0x3e8);}function abortExitTimer(_0x35d820){const _0x2c9438=a4_0x436f;if(_0x35d820[_0x2c9438(0x166)])clearTimeout(_0x35d820['exitTimer']);if(_0x35d820[_0x2c9438(0x168)])clearTimeout(_0x35d820['exitGraceTimer']);_0x35d820['exitTimer']=null,_0x35d820[_0x2c9438(0x168)]=null,_0x35d820[_0x2c9438(0x16b)]=![];}async function setPresence(_0x1e0487,_0x2d56ad){const _0x17d4e0=a4_0x436f;if(_0x1e0487['isPresent']===_0x2d56ad)return;_0x1e0487[_0x17d4e0(0x160)]=_0x2d56ad,await _0x1e0487['setStateAsync'](_0x17d4e0(0x158),{'val':_0x2d56ad,'ack':!![]});}async function processSensorEvent(_0x4301d1,_0x501759,_0x1b7bd3,_0x33e68f){const _0x3a562e=a4_0x436f;if(!_0x33e68f)return;const _0x5ea4b3=_0x1b7bd3[_0x3a562e(0x13f)],_0x26d4aa=Date[_0x3a562e(0x12c)](),_0x2a32dc=_0x4301d1[_0x3a562e(0x161)][_0x501759];_0x4301d1[_0x3a562e(0x161)][_0x501759]=_0x5ea4b3;if(!_0x33e68f[_0x3a562e(0x128)]&&_0x2a32dc!=undefined&&_0x2a32dc==_0x5ea4b3)return;const _0x59d15c=(_0x33e68f['type']||'')[_0x3a562e(0x12f)](),_0x159026=_0x59d15c[_0x3a562e(0x177)](_0x3a562e(0x15a))||_0x59d15c[_0x3a562e(0x177)](_0x3a562e(0x16c))||_0x59d15c[_0x3a562e(0x177)](_0x3a562e(0x164))||_0x59d15c[_0x3a562e(0x177)](_0x3a562e(0x15f));_0x4301d1[_0x3a562e(0x15c)]&&_0x159026&&recordThermodynamics(_0x4301d1,_0x501759,_0x5ea4b3,_0x33e68f[_0x3a562e(0x14e)]);const _0xc917a8={'timestamp':_0x26d4aa,'id':_0x501759,'name':_0x33e68f['name'],'type':_0x33e68f['type'],'location':_0x33e68f[_0x3a562e(0x14e)],'value':_0x5ea4b3};_0x4301d1[_0x3a562e(0x171)]['unshift'](_0xc917a8);if(_0x4301d1[_0x3a562e(0x171)][_0x3a562e(0x131)]>HISTORY_MAX_SIZE)_0x4301d1[_0x3a562e(0x171)][_0x3a562e(0x169)]();await _0x4301d1['setStateAsync']('events.lastEvent',{'val':JSON[_0x3a562e(0x16e)](_0xc917a8),'ack':!![]}),await _0x4301d1['setStateAsync'](_0x3a562e(0x167),{'val':JSON['stringify'](_0x4301d1[_0x3a562e(0x171)]),'ack':!![]});if(_0x4301d1[_0x3a562e(0x15c)]){_0x4301d1[_0x3a562e(0x13a)][_0x3a562e(0x155)](_0xc917a8);if(_0x4301d1[_0x3a562e(0x13a)][_0x3a562e(0x131)]>RAW_LOG_MAX_SIZE)_0x4301d1[_0x3a562e(0x13a)][_0x3a562e(0x176)](0x0,_0x4301d1[_0x3a562e(0x13a)][_0x3a562e(0x131)]-RAW_LOG_MAX_SIZE);await _0x4301d1[_0x3a562e(0x134)](_0x3a562e(0x157),{'val':JSON['stringify'](_0x4301d1[_0x3a562e(0x13a)]),'ack':!![]}),recordSequence(_0x4301d1,_0xc917a8);}if(_0x33e68f[_0x3a562e(0x13d)]&&_0x5ea4b3===!![]){if(_0x4301d1[_0x3a562e(0x160)]&&!_0x4301d1[_0x3a562e(0x16b)])startExitTimer(_0x4301d1);else{if(!_0x4301d1[_0x3a562e(0x160)])setPresence(_0x4301d1,!![]);}}else{if(_0x33e68f[_0x3a562e(0x152)]===_0x3a562e(0x165)&&_0x5ea4b3===!![]){if(_0x4301d1[_0x3a562e(0x166)])abortExitTimer(_0x4301d1);if(!_0x4301d1[_0x3a562e(0x160)]&&_0x4301d1[_0x3a562e(0x136)]==='normal')setPresence(_0x4301d1,!![]);}}_0x4301d1[_0x3a562e(0x15c)]&&_0x33e68f['type']===_0x3a562e(0x165)&&_0x5ea4b3===!![]&&_0x33e68f[_0x3a562e(0x14e)]&&_0x4301d1[_0x3a562e(0x151)]&&_0x4301d1[_0x3a562e(0x151)](_0x3a562e(0x175),{'room':_0x33e68f['location']});}module[a4_0x509814(0x16a)]={'processSensorEvent':processSensorEvent,'getOutsideTemperatureNumeric':getOutsideTemperatureNumeric,'setPresence':setPresence,'abortExitTimer':abortExitTimer,'startExitTimer':startExitTimer};function a4_0x9780(){const _0x4cba24=['error','push','präsenz','LTM.rawEventLog','system.isPresent','.forecast.current.temperature','temperature','toString','isProVersion','shift','[RECORDER]\x20Error:\x20','heizung','isPresent','sensorLastValues','getHours','.forecast.current.temp','klima','motion','exitTimer','events.history','exitGraceTimer','pop','exports','isGracePeriodActive','temperatur','790782lkzrXu','stringify','toISOString','getStateAsync','eventHistory','useWeather','fenster','message','SIMULATE_SIGNAL','splice','includes','light','window','148865wvqoSa','round','103750pCpzKN','logDuplicates','dimmer','LTM.trainingData.sequences','config','now','daswetter','door','toLowerCase','search','length','presence','loc','setStateAsync','1220IsAgTS','currentSystemMode','occupancy','2RNAKzj','21GxcRRt','rawEventLog','getForeignStateAsync','3097632aMJWYJ','isExit','LTM.trainingData.thermodynamics','val','contact','9254enLWXK','.NextHours.Location_1.Day_1.current.temp_value','weatherunderground','some','outdoorSensorId','121uctkdZ','map','apply','tür','3122469tgmKcq','lampe','parse','(((.+)+)+)+$','location','12ANctmD','weatherInstance','sendToPythonWrapper','type','Unknown'];a4_0x9780=function(){return _0x4cba24;};return a4_0x9780();}