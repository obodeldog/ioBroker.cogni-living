function a5_0x2e6b(_0x5063de,_0xce39fe){const _0x19a739=a5_0x510a();return a5_0x2e6b=function(_0x2eb061,_0x5d55c4){_0x2eb061=_0x2eb061-0x1a3;let _0x510a6a=_0x19a739[_0x2eb061];return _0x510a6a;},a5_0x2e6b(_0x5063de,_0xce39fe);}(function(_0x3af047,_0x5c691c){const _0x10a1b8=a5_0x2e6b,_0x19718e=_0x3af047();while(!![]){try{const _0x1b19f9=-parseInt(_0x10a1b8(0x1b2))/0x1*(-parseInt(_0x10a1b8(0x1c7))/0x2)+-parseInt(_0x10a1b8(0x1e8))/0x3+-parseInt(_0x10a1b8(0x1ee))/0x4*(parseInt(_0x10a1b8(0x1a4))/0x5)+-parseInt(_0x10a1b8(0x1e5))/0x6*(-parseInt(_0x10a1b8(0x1c5))/0x7)+parseInt(_0x10a1b8(0x1b5))/0x8*(parseInt(_0x10a1b8(0x1ac))/0x9)+parseInt(_0x10a1b8(0x1bc))/0xa*(parseInt(_0x10a1b8(0x201))/0xb)+-parseInt(_0x10a1b8(0x1fb))/0xc;if(_0x1b19f9===_0x5c691c)break;else _0x19718e['push'](_0x19718e['shift']());}catch(_0x4f97b6){_0x19718e['push'](_0x19718e['shift']());}}}(a5_0x510a,0x5e8c5));const a5_0x5d55c4=(function(){let _0x5f3d4a=!![];return function(_0x4f06e0,_0x2eeca6){const _0x2d5ee7=_0x5f3d4a?function(){const _0xd1bfda=a5_0x2e6b;if(_0x2eeca6){const _0x2efdeb=_0x2eeca6[_0xd1bfda(0x1cd)](_0x4f06e0,arguments);return _0x2eeca6=null,_0x2efdeb;}}:function(){};return _0x5f3d4a=![],_0x2d5ee7;};}()),a5_0x2eb061=a5_0x5d55c4(this,function(){const _0x435d46=a5_0x2e6b;return a5_0x2eb061['toString']()[_0x435d46(0x1fd)](_0x435d46(0x1f0))['toString']()[_0x435d46(0x1d1)](a5_0x2eb061)['search'](_0x435d46(0x1f0));});a5_0x2eb061();'use strict';const HISTORY_MAX_SIZE=0x32,RAW_LOG_MAX_SIZE=0x9c4,THERMO_LOG_SIZE=0x3e8,SEQUENCE_TIMEOUT_MS=0x5*0x3c*0x3e8,MAX_TRAINING_SET_SIZE=0x1f4,EXIT_TIMER_MINUTES=0xf,EXIT_GRACE_PERIOD_SECONDS=0x1e;let activeSequence=[],sequenceTimer=null;async function getOutsideTemperatureNumeric(_0x4c0441){const _0x235a98=a5_0x2e6b;if(_0x4c0441[_0x235a98(0x1dc)]['outdoorSensorId'])try{const _0x6f1188=await _0x4c0441[_0x235a98(0x1cb)](_0x4c0441[_0x235a98(0x1dc)][_0x235a98(0x1b6)]);if(_0x6f1188&&_0x6f1188[_0x235a98(0x1a3)]!==undefined&&_0x6f1188['val']!==null)return parseFloat(_0x6f1188[_0x235a98(0x1a3)]);}catch(_0x3be0c2){}const _0x13b339=_0x4c0441['config']['weatherInstance'];if(!_0x4c0441['config'][_0x235a98(0x1e3)]||!_0x13b339)return null;try{let _0x5f8cf5='';if(_0x13b339['includes'](_0x235a98(0x1f2)))_0x5f8cf5=_0x13b339+'.Current.Temperature';else{if(_0x13b339[_0x235a98(0x1b3)](_0x235a98(0x1a5)))_0x5f8cf5=_0x13b339+'.NextHours.Location_1.Day_1.current.temp_value';else{if(_0x13b339[_0x235a98(0x1b3)](_0x235a98(0x206)))_0x5f8cf5=_0x13b339+'.forecast.current.temperature';else{if(_0x13b339['includes']('weatherunderground'))_0x5f8cf5=_0x13b339+_0x235a98(0x1d3);}}}if(_0x5f8cf5){const _0x3a397e=await _0x4c0441[_0x235a98(0x1cb)](_0x5f8cf5);if(_0x3a397e&&_0x3a397e[_0x235a98(0x1a3)]!==undefined&&_0x3a397e[_0x235a98(0x1a3)]!==null)return parseFloat(_0x3a397e['val']);}}catch(_0x39173d){}return null;}async function recordThermodynamics(_0x54a668,_0x32bdce,_0x563808,_0x105be2){const _0x18f5df=a5_0x2e6b,_0x4c400d=await getOutsideTemperatureNumeric(_0x54a668);if(_0x4c400d===null)return;let _0x3ffde2=0x0,_0x3ebc55=![];if(_0x54a668['config'][_0x18f5df(0x1ae)])try{let _0x2f9257=_0x54a668[_0x18f5df(0x1dc)]['valveMapping'];if(typeof _0x2f9257===_0x18f5df(0x1e6))_0x2f9257=JSON[_0x18f5df(0x1e1)](_0x2f9257);if(_0x2f9257[_0x32bdce]){const _0x4e54c6=_0x2f9257[_0x32bdce],_0x14613c=await _0x54a668[_0x18f5df(0x1cb)](_0x4e54c6);if(_0x14613c&&_0x14613c[_0x18f5df(0x1a3)]!==null&&_0x14613c['val']!==undefined){let _0x8e0e69=Number(_0x14613c['val']);if(_0x8e0e69<=1.05&&!_0x4e54c6[_0x18f5df(0x1b3)](_0x18f5df(0x1c3))&&!_0x4e54c6[_0x18f5df(0x1b3)]('STATE'))_0x8e0e69=_0x8e0e69*0x64;_0x3ffde2=Math['round'](_0x8e0e69),_0x3ebc55=!![];}}}catch(_0x44e872){}if(!_0x3ebc55){const _0x721860=[{'from':_0x18f5df(0x1c6),'to':_0x18f5df(0x1ce)},{'from':_0x18f5df(0x1c6),'to':'.1.VALVE_STATE'},{'from':'.1.TEMPERATURE','to':'.4.VALVE_STATE'},{'from':'.ACTUAL_TEMPERATURE','to':_0x18f5df(0x1ea)},{'from':_0x18f5df(0x1d6),'to':_0x18f5df(0x1e9)},{'from':'Temperature','to':_0x18f5df(0x1d7)}];for(const _0x16d681 of _0x721860){if(_0x32bdce[_0x18f5df(0x1b3)](_0x16d681[_0x18f5df(0x1af)])){const _0x2d831f=_0x32bdce[_0x18f5df(0x1b8)](_0x16d681[_0x18f5df(0x1af)],_0x16d681['to']);try{const _0x4c2465=await _0x54a668[_0x18f5df(0x1cb)](_0x2d831f);if(_0x4c2465&&_0x4c2465[_0x18f5df(0x1a3)]!==null&&_0x4c2465[_0x18f5df(0x1a3)]!==undefined){let _0x311b15=Number(_0x4c2465[_0x18f5df(0x1a3)]);if(typeof _0x311b15===_0x18f5df(0x1f3)){if(_0x311b15<=1.05&&_0x16d681['to'][_0x18f5df(0x1b3)]('LEVEL'))_0x311b15=_0x311b15*0x64;_0x3ffde2=Math[_0x18f5df(0x1c0)](_0x311b15),_0x3ebc55=!![];break;}}}catch(_0x3fec32){}}}}const _0x22c9f9=await _0x54a668[_0x18f5df(0x1d4)](_0x18f5df(0x207));let _0x50fced=[];if(_0x22c9f9&&_0x22c9f9[_0x18f5df(0x1a3)])try{_0x50fced=JSON['parse'](_0x22c9f9[_0x18f5df(0x1a3)]);}catch(_0x313c58){}_0x50fced['push']({'ts':Date['now'](),'room':_0x105be2||_0x18f5df(0x1db),'t_in':_0x563808,'t_out':_0x4c400d,'valve':_0x3ffde2});if(_0x50fced[_0x18f5df(0x1cf)]>THERMO_LOG_SIZE)_0x50fced[_0x18f5df(0x205)]();await _0x54a668[_0x18f5df(0x1a9)]('LTM.trainingData.thermodynamics',{'val':JSON['stringify'](_0x50fced),'ack':!![]});}async function saveCompletedSequence(_0x3c0afd){const _0x26e807=a5_0x2e6b;try{const _0x59f3fd=await _0x3c0afd[_0x26e807(0x1d4)](_0x26e807(0x1f8));let _0x3e0603=[];if(_0x59f3fd&&_0x59f3fd['val'])try{_0x3e0603=JSON[_0x26e807(0x1e1)](_0x59f3fd['val']);}catch(_0x6f7c85){}const _0x17e568=activeSequence[0x0]['ts'],_0x241d57=activeSequence[_0x26e807(0x1f6)](_0x3b4281=>({'loc':_0x3b4281['loc'],'t_delta':Math[_0x26e807(0x1c0)]((_0x3b4281['ts']-_0x17e568)/0x3e8)})),_0x4a8ce7={'timestamp':new Date(_0x17e568)[_0x26e807(0x1df)](),'steps':_0x241d57,'duration':Math[_0x26e807(0x1c0)]((activeSequence[activeSequence[_0x26e807(0x1cf)]-0x1]['ts']-_0x17e568)/0x3e8),'daytime':new Date(_0x17e568)[_0x26e807(0x1a8)]()};_0x3e0603[_0x26e807(0x1c8)](_0x4a8ce7);if(_0x3e0603[_0x26e807(0x1cf)]>MAX_TRAINING_SET_SIZE)_0x3e0603[_0x26e807(0x205)]();await _0x3c0afd[_0x26e807(0x1a9)](_0x26e807(0x1f8),{'val':JSON[_0x26e807(0x204)](_0x3e0603),'ack':!![]}),_0x3c0afd[_0x26e807(0x1a7)]&&_0x3c0afd['sendToPythonWrapper']&&_0x3c0afd[_0x26e807(0x1b9)](_0x26e807(0x1e7),{'sequence':_0x4a8ce7});}catch(_0x47eb51){_0x3c0afd[_0x26e807(0x1c4)][_0x26e807(0x1e4)]('[RECORDER]\x20Error:\x20'+_0x47eb51['message']);}}async function recordSequence(_0x11bbe1,_0x2e914d){const _0x103531=a5_0x2e6b,_0x1d1047=(_0x2e914d[_0x103531(0x1c2)]||'')['toLowerCase'](),_0x5033d3=[_0x103531(0x200),_0x103531(0x1b7),'präsenz',_0x103531(0x1ab),_0x103531(0x1fe),'door',_0x103531(0x1d9),'window',_0x103531(0x1e0),'contact',_0x103531(0x1bd),_0x103531(0x1cc),_0x103531(0x1ad),_0x103531(0x1aa),'schalter',_0x103531(0x1ff),_0x103531(0x1e2)];if(!_0x5033d3[_0x103531(0x1b0)](_0x5a8c95=>_0x1d1047[_0x103531(0x1b3)](_0x5a8c95)))return;if(!_0x2e914d[_0x103531(0x1fa)])return;if(sequenceTimer)clearTimeout(sequenceTimer);activeSequence['push']({'loc':_0x2e914d[_0x103531(0x1ef)]||_0x103531(0x1db),'id':_0x2e914d['id'],'ts':Date[_0x103531(0x1be)]()}),sequenceTimer=setTimeout(async()=>{const _0x3f42e6=_0x103531;if(activeSequence[_0x3f42e6(0x1cf)]>0x1)await saveCompletedSequence(_0x11bbe1);activeSequence=[];},SEQUENCE_TIMEOUT_MS);}function a5_0x510a(){const _0xef893f=['3779334nzRsAS','licht','valveMapping','from','some','schloss','1vfbctR','includes','schalter','8SDACDy','outdoorSensorId','bewegung','replace','sendToPythonWrapper','splice','debug','152210IHbPgB','kontakt','now','isPresent','round','toLowerCase','type','STATUS','log','2607507XMPZbl','.1.ACTUAL_TEMPERATURE','1547606tBmedU','push','sensorLastValues','unshift','getForeignStateAsync','light','apply','.1.LEVEL','length','[RECORDER]\x20Ignored\x20implausible\x20temperature:\x20','constructor','isGracePeriodActive','.forecast.current.temp','getStateAsync','pop','temperature','Valve','präsenz','tür','temperatur','Unknown','config','events.history','system.isPresent','toISOString','fenster','parse','lampe','useWeather','error','6YWlYmX','string','ANALYZE_SEQUENCE','223872cmvKWT','level','.LEVEL','exitGraceTimer','klima','\x20from\x20','1135068FdZXVV','location','(((.+)+)+)+$','door','accuweather','number','exitTimer','events.lastEvent','map','rawEventLog','LTM.trainingData.sequences','window','value','11856012lSaLTe','eventHistory','search','occupancy','dimmer','motion','121SpwXqx','logDuplicates','heizung','stringify','shift','openweathermap','LTM.trainingData.thermodynamics','val','5uZQeOd','daswetter','lock','isProVersion','getHours','setStateAsync','switch','presence'];a5_0x510a=function(){return _0xef893f;};return a5_0x510a();}function startExitTimer(_0x1e6227){const _0x36126c=a5_0x2e6b;abortExitTimer(_0x1e6227),_0x1e6227[_0x36126c(0x1d2)]=!![],_0x1e6227[_0x36126c(0x1eb)]=setTimeout(()=>{const _0x4eb7b6=_0x36126c;_0x1e6227[_0x4eb7b6(0x1d2)]=![];},EXIT_GRACE_PERIOD_SECONDS*0x3e8),_0x1e6227[_0x36126c(0x1f4)]=setTimeout(()=>{const _0x299cfd=_0x36126c;setPresence(_0x1e6227,![]),_0x1e6227[_0x299cfd(0x1f4)]=null;},EXIT_TIMER_MINUTES*0x3c*0x3e8);}function abortExitTimer(_0x1a1c81){const _0x52b78f=a5_0x2e6b;if(_0x1a1c81[_0x52b78f(0x1f4)])clearTimeout(_0x1a1c81[_0x52b78f(0x1f4)]);if(_0x1a1c81[_0x52b78f(0x1eb)])clearTimeout(_0x1a1c81[_0x52b78f(0x1eb)]);_0x1a1c81[_0x52b78f(0x1f4)]=null,_0x1a1c81[_0x52b78f(0x1eb)]=null,_0x1a1c81[_0x52b78f(0x1d2)]=![];}async function setPresence(_0x2501de,_0x37d671){const _0x235978=a5_0x2e6b;if(_0x2501de['isPresent']===_0x37d671)return;_0x2501de[_0x235978(0x1bf)]=_0x37d671,await _0x2501de[_0x235978(0x1a9)](_0x235978(0x1de),{'val':_0x37d671,'ack':!![]});}async function processSensorEvent(_0x1752ea,_0x4a1f43,_0x1cd7c6,_0x191802){const _0x2a0472=a5_0x2e6b;if(!_0x191802)return null;const _0x582718=_0x1cd7c6[_0x2a0472(0x1a3)],_0x11c48d=Date[_0x2a0472(0x1be)](),_0x4af54=_0x1752ea[_0x2a0472(0x1c9)][_0x4a1f43],_0x53bc2f=(_0x191802[_0x2a0472(0x1c2)]||'')[_0x2a0472(0x1c1)](),_0x45576e=_0x53bc2f[_0x2a0472(0x1b3)](_0x2a0472(0x1d6))||_0x53bc2f[_0x2a0472(0x1b3)](_0x2a0472(0x1da))||_0x53bc2f[_0x2a0472(0x1b3)](_0x2a0472(0x1ec))||_0x53bc2f[_0x2a0472(0x1b3)](_0x2a0472(0x203))||_0x53bc2f[_0x2a0472(0x1b3)]('thermostat');if(_0x45576e&&typeof _0x582718===_0x2a0472(0x1f3)){if(_0x582718>0x50||_0x582718<-0x32)return _0x1752ea[_0x2a0472(0x1c4)][_0x2a0472(0x1bb)](_0x2a0472(0x1d0)+_0x582718+_0x2a0472(0x1ed)+_0x4a1f43),null;}_0x1752ea[_0x2a0472(0x1c9)][_0x4a1f43]=_0x582718;if(!_0x191802[_0x2a0472(0x202)]&&_0x4af54!=undefined&&_0x4af54==_0x582718)return null;_0x1752ea[_0x2a0472(0x1a7)]&&_0x45576e&&recordThermodynamics(_0x1752ea,_0x4a1f43,_0x582718,_0x191802[_0x2a0472(0x1ef)]);const _0x422c8b={'timestamp':_0x11c48d,'id':_0x4a1f43,'name':_0x191802['name'],'type':_0x191802[_0x2a0472(0x1c2)],'location':_0x191802[_0x2a0472(0x1ef)],'value':_0x582718};_0x1752ea[_0x2a0472(0x1fc)][_0x2a0472(0x1ca)](_0x422c8b);if(_0x1752ea[_0x2a0472(0x1fc)][_0x2a0472(0x1cf)]>HISTORY_MAX_SIZE)_0x1752ea[_0x2a0472(0x1fc)][_0x2a0472(0x1d5)]();await _0x1752ea[_0x2a0472(0x1a9)](_0x2a0472(0x1f5),{'val':JSON[_0x2a0472(0x204)](_0x422c8b),'ack':!![]}),await _0x1752ea[_0x2a0472(0x1a9)](_0x2a0472(0x1dd),{'val':JSON[_0x2a0472(0x204)](_0x1752ea[_0x2a0472(0x1fc)]),'ack':!![]});if(_0x1752ea['isProVersion']){_0x1752ea['rawEventLog']['push'](_0x422c8b);if(_0x1752ea[_0x2a0472(0x1f7)][_0x2a0472(0x1cf)]>RAW_LOG_MAX_SIZE)_0x1752ea[_0x2a0472(0x1f7)][_0x2a0472(0x1ba)](0x0,_0x1752ea[_0x2a0472(0x1f7)][_0x2a0472(0x1cf)]-RAW_LOG_MAX_SIZE);await _0x1752ea[_0x2a0472(0x1a9)]('LTM.rawEventLog',{'val':JSON[_0x2a0472(0x204)](_0x1752ea[_0x2a0472(0x1f7)]),'ack':!![]}),recordSequence(_0x1752ea,_0x422c8b);}if(_0x191802['isExit']&&_0x582718===!![]){if(_0x1752ea[_0x2a0472(0x1bf)]&&!_0x1752ea[_0x2a0472(0x1d2)])startExitTimer(_0x1752ea);else{if(!_0x1752ea['isPresent'])setPresence(_0x1752ea,!![]);}}else{if(_0x191802[_0x2a0472(0x1c2)]===_0x2a0472(0x200)&&_0x582718===!![]){if(_0x1752ea['exitTimer'])abortExitTimer(_0x1752ea);if(!_0x1752ea[_0x2a0472(0x1bf)]&&_0x1752ea['currentSystemMode']==='normal')setPresence(_0x1752ea,!![]);}}if(_0x1752ea['isProVersion']&&_0x1752ea[_0x2a0472(0x1b9)]){_0x191802[_0x2a0472(0x1c2)]===_0x2a0472(0x200)&&_0x582718===!![]&&_0x191802['location']&&_0x1752ea['sendToPythonWrapper']('SIMULATE_SIGNAL',{'room':_0x191802['location']});const _0x5bae8e=[_0x2a0472(0x1f1),_0x2a0472(0x1d9),_0x2a0472(0x1f9),_0x2a0472(0x1e0),'griff','handle',_0x2a0472(0x1a6),_0x2a0472(0x1b1)]['some'](_0x161665=>_0x53bc2f[_0x2a0472(0x1b3)](_0x161665)),_0x10a928=[_0x2a0472(0x1cc),'licht','switch',_0x2a0472(0x1b4),_0x2a0472(0x1ff),_0x2a0472(0x1e2)][_0x2a0472(0x1b0)](_0x4f8b4d=>_0x53bc2f[_0x2a0472(0x1b3)](_0x4f8b4d)),_0x8e510a=[_0x2a0472(0x200),'bewegung',_0x2a0472(0x1d8),'presence','occupancy'][_0x2a0472(0x1b0)](_0x3291b4=>_0x53bc2f[_0x2a0472(0x1b3)](_0x3291b4));if(_0x191802[_0x2a0472(0x1ef)]&&(_0x5bae8e||_0x10a928||_0x8e510a)){const _0x80ea35=_0x582718===!![]||typeof _0x582718===_0x2a0472(0x1f3)&&_0x582718>0x0,_0x574b03=_0x5bae8e&&!_0x80ea35&&_0x4af54!==undefined&&_0x4af54!=_0x582718;if(_0x80ea35||_0x574b03){const _0xd9818b=_0x1752ea['lastTrackerEventTime']||_0x11c48d,_0x3fc261=(_0x11c48d-_0xd9818b)/0x3e8;_0x1752ea['lastTrackerEventTime']=_0x11c48d,_0x1752ea[_0x2a0472(0x1b9)]('TRACK_EVENT',{'room':_0x191802['location'],'dt':_0x3fc261});}}}return _0x422c8b;}module['exports']={'processSensorEvent':processSensorEvent,'getOutsideTemperatureNumeric':getOutsideTemperatureNumeric,'setPresence':setPresence,'abortExitTimer':abortExitTimer,'startExitTimer':startExitTimer};