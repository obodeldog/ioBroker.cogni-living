const a5_0x198212=a5_0x4a13;(function(_0x3614aa,_0x42a12b){const _0x53f644=a5_0x4a13,_0x524c38=_0x3614aa();while(!![]){try{const _0x32313f=-parseInt(_0x53f644(0xba))/0x1*(parseInt(_0x53f644(0x98))/0x2)+parseInt(_0x53f644(0xbf))/0x3*(-parseInt(_0x53f644(0x8d))/0x4)+-parseInt(_0x53f644(0x91))/0x5+parseInt(_0x53f644(0x9b))/0x6*(-parseInt(_0x53f644(0xb3))/0x7)+-parseInt(_0x53f644(0xb2))/0x8+-parseInt(_0x53f644(0xa5))/0x9*(parseInt(_0x53f644(0xa7))/0xa)+parseInt(_0x53f644(0xb6))/0xb;if(_0x32313f===_0x42a12b)break;else _0x524c38['push'](_0x524c38['shift']());}catch(_0x53b61f){_0x524c38['push'](_0x524c38['shift']());}}}(a5_0x2348,0x8a43a));function a5_0x4a13(_0x3f5750,_0x3c6efc){const _0x4447a7=a5_0x2348();return a5_0x4a13=function(_0x255a1d,_0x34bd1e){_0x255a1d=_0x255a1d-0x76;let _0x234838=_0x4447a7[_0x255a1d];return _0x234838;},a5_0x4a13(_0x3f5750,_0x3c6efc);}function a5_0x2348(){const _0x5cddd2=['normal','weatherunderground','1066McpYaK','events.history','präsenz','temperatur','exports','3lLeVLb','contact','loc','door','sendToPythonWrapper','light','round','setStateAsync','error','config','klima','motion','fenster','bewegung','switch','daswetter','tür','type','value','toLowerCase','.Current.Temperature','dimmer','getStateAsync','exitTimer','isGracePeriodActive','temperature','length','unshift','events.lastEvent','apply','val','toString','SIMULATE_SIGNAL','splice','LTM.trainingData.thermodynamics','heizung','1208684xNIUQp','isPresent','eventHistory','now','2659230HDtZmg','presence','window','shift','rawEventLog','constructor','LTM.trainingData.sequences','1166OLRDql','exitGraceTimer','logDuplicates','18OLvgdU','Unknown','includes','name','push','system.isPresent','stringify','outdoorSensorId','isProVersion','.NextHours.Location_1.Day_1.current.temp_value','8703GgpmZU','licht','2490geLpXU','getForeignStateAsync','sensorLastValues','.forecast.current.temperature','map','search','location','parse','schalter','accuweather','pop','8639544dncGqt','2344153fyBhJG','some','LTM.rawEventLog','47819068XczIRl','(((.+)+)+)+$'];a5_0x2348=function(){return _0x5cddd2;};return a5_0x2348();}const a5_0x34bd1e=(function(){let _0xac4e89=!![];return function(_0x472bda,_0x337970){const _0x399af9=_0xac4e89?function(){const _0x3aa820=a5_0x4a13;if(_0x337970){const _0x1da80c=_0x337970[_0x3aa820(0x86)](_0x472bda,arguments);return _0x337970=null,_0x1da80c;}}:function(){};return _0xac4e89=![],_0x399af9;};}()),a5_0x255a1d=a5_0x34bd1e(this,function(){const _0xd65740=a5_0x4a13;return a5_0x255a1d[_0xd65740(0x88)]()[_0xd65740(0xac)](_0xd65740(0xb7))[_0xd65740(0x88)]()[_0xd65740(0x96)](a5_0x255a1d)[_0xd65740(0xac)]('(((.+)+)+)+$');});a5_0x255a1d();'use strict';const HISTORY_MAX_SIZE=0x32,RAW_LOG_MAX_SIZE=0x9c4,THERMO_LOG_SIZE=0x3e8,SEQUENCE_TIMEOUT_MS=0x5*0x3c*0x3e8,MAX_TRAINING_SET_SIZE=0x1f4,EXIT_TIMER_MINUTES=0xf,EXIT_GRACE_PERIOD_SECONDS=0x1e;let activeSequence=[],sequenceTimer=null;async function getOutsideTemperatureNumeric(_0x8ce41){const _0x341bb8=a5_0x4a13;if(_0x8ce41[_0x341bb8(0xc8)][_0x341bb8(0xa2)])try{const _0x1a18e0=await _0x8ce41[_0x341bb8(0xa8)](_0x8ce41[_0x341bb8(0xc8)][_0x341bb8(0xa2)]);if(_0x1a18e0&&_0x1a18e0[_0x341bb8(0x87)]!==undefined&&_0x1a18e0[_0x341bb8(0x87)]!==null)return parseFloat(_0x1a18e0[_0x341bb8(0x87)]);}catch(_0x3dfe63){}const _0x2e469a=_0x8ce41[_0x341bb8(0xc8)]['weatherInstance'];if(!_0x8ce41['config']['useWeather']||!_0x2e469a)return null;try{let _0x2e750c='';if(_0x2e469a['includes'](_0x341bb8(0xb0)))_0x2e750c=_0x2e469a+_0x341bb8(0x7d);else{if(_0x2e469a['includes'](_0x341bb8(0x78)))_0x2e750c=_0x2e469a+_0x341bb8(0xa4);else{if(_0x2e469a[_0x341bb8(0x9d)]('openweathermap'))_0x2e750c=_0x2e469a+_0x341bb8(0xaa);else{if(_0x2e469a[_0x341bb8(0x9d)](_0x341bb8(0xb9)))_0x2e750c=_0x2e469a+'.forecast.current.temp';}}}if(_0x2e750c){const _0x3baddf=await _0x8ce41[_0x341bb8(0xa8)](_0x2e750c);if(_0x3baddf&&_0x3baddf['val']!==undefined&&_0x3baddf[_0x341bb8(0x87)]!==null)return parseFloat(_0x3baddf[_0x341bb8(0x87)]);}}catch(_0x4e9e3a){}return null;}async function recordThermodynamics(_0x3d646f,_0x102843,_0xa3634f,_0x2769c3){const _0x567a03=a5_0x4a13,_0x123215=await getOutsideTemperatureNumeric(_0x3d646f),_0x22d5b4=await _0x3d646f[_0x567a03(0x7f)](_0x567a03(0x8b));let _0x3b58d2=[];if(_0x22d5b4&&_0x22d5b4['val'])try{_0x3b58d2=JSON[_0x567a03(0xae)](_0x22d5b4[_0x567a03(0x87)]);}catch(_0xafee15){}_0x3b58d2[_0x567a03(0x9f)]({'ts':Date[_0x567a03(0x90)](),'room':_0x2769c3||_0x567a03(0x9c),'t_in':_0xa3634f,'t_out':_0x123215});if(_0x3b58d2[_0x567a03(0x83)]>THERMO_LOG_SIZE)_0x3b58d2[_0x567a03(0x94)]();await _0x3d646f['setStateAsync'](_0x567a03(0x8b),{'val':JSON['stringify'](_0x3b58d2),'ack':!![]});}async function saveCompletedSequence(_0xcda413){const _0x41d5e8=a5_0x4a13;try{const _0x11915d=await _0xcda413[_0x41d5e8(0x7f)](_0x41d5e8(0x97));let _0x1fc892=[];if(_0x11915d&&_0x11915d[_0x41d5e8(0x87)])try{_0x1fc892=JSON[_0x41d5e8(0xae)](_0x11915d['val']);}catch(_0x152dc4){}const _0x494ccc=activeSequence[0x0]['ts'],_0x10d8fe=activeSequence[_0x41d5e8(0xab)](_0x21b3e5=>({'loc':_0x21b3e5[_0x41d5e8(0xc1)],'t_delta':Math[_0x41d5e8(0xc5)]((_0x21b3e5['ts']-_0x494ccc)/0x3e8)})),_0x48518f={'timestamp':new Date(_0x494ccc)['toISOString'](),'steps':_0x10d8fe,'duration':Math[_0x41d5e8(0xc5)]((activeSequence[activeSequence[_0x41d5e8(0x83)]-0x1]['ts']-_0x494ccc)/0x3e8),'daytime':new Date(_0x494ccc)['getHours']()};_0x1fc892[_0x41d5e8(0x9f)](_0x48518f);if(_0x1fc892[_0x41d5e8(0x83)]>MAX_TRAINING_SET_SIZE)_0x1fc892[_0x41d5e8(0x94)]();await _0xcda413[_0x41d5e8(0xc6)]('LTM.trainingData.sequences',{'val':JSON[_0x41d5e8(0xa1)](_0x1fc892),'ack':!![]}),_0xcda413['isProVersion']&&_0xcda413[_0x41d5e8(0xc3)]&&_0xcda413[_0x41d5e8(0xc3)]('ANALYZE_SEQUENCE',{'sequence':_0x48518f});}catch(_0x499427){_0xcda413['log'][_0x41d5e8(0xc7)]('[RECORDER]\x20Error:\x20'+_0x499427['message']);}}async function recordSequence(_0x16abc6,_0x4ddbf7){const _0x114c42=a5_0x4a13,_0x5dba6e=(_0x4ddbf7[_0x114c42(0x7a)]||'')[_0x114c42(0x7c)](),_0x1e41f1=[_0x114c42(0xca),_0x114c42(0x76),_0x114c42(0xbc),_0x114c42(0x92),'occupancy',_0x114c42(0xc2),_0x114c42(0x79),_0x114c42(0x93),_0x114c42(0xcb),_0x114c42(0xc0),'kontakt',_0x114c42(0xc4),_0x114c42(0xa6),_0x114c42(0x77),_0x114c42(0xaf),_0x114c42(0x7e),'lampe'];if(!_0x1e41f1[_0x114c42(0xb4)](_0x5e8aaa=>_0x5dba6e[_0x114c42(0x9d)](_0x5e8aaa)))return;if(!_0x4ddbf7[_0x114c42(0x7b)])return;if(sequenceTimer)clearTimeout(sequenceTimer);activeSequence[_0x114c42(0x9f)]({'loc':_0x4ddbf7[_0x114c42(0xad)]||_0x114c42(0x9c),'id':_0x4ddbf7['id'],'ts':Date[_0x114c42(0x90)]()}),sequenceTimer=setTimeout(async()=>{if(activeSequence['length']>0x1)await saveCompletedSequence(_0x16abc6);activeSequence=[];},SEQUENCE_TIMEOUT_MS);}function startExitTimer(_0x21f3a2){const _0xaa30df=a5_0x4a13;abortExitTimer(_0x21f3a2),_0x21f3a2[_0xaa30df(0x81)]=!![],_0x21f3a2[_0xaa30df(0x99)]=setTimeout(()=>{const _0x1d059e=_0xaa30df;_0x21f3a2[_0x1d059e(0x81)]=![];},EXIT_GRACE_PERIOD_SECONDS*0x3e8),_0x21f3a2[_0xaa30df(0x80)]=setTimeout(()=>{setPresence(_0x21f3a2,![]),_0x21f3a2['exitTimer']=null;},EXIT_TIMER_MINUTES*0x3c*0x3e8);}function abortExitTimer(_0x2e0163){const _0x4e7250=a5_0x4a13;if(_0x2e0163[_0x4e7250(0x80)])clearTimeout(_0x2e0163[_0x4e7250(0x80)]);if(_0x2e0163[_0x4e7250(0x99)])clearTimeout(_0x2e0163[_0x4e7250(0x99)]);_0x2e0163[_0x4e7250(0x80)]=null,_0x2e0163[_0x4e7250(0x99)]=null,_0x2e0163[_0x4e7250(0x81)]=![];}async function setPresence(_0x5041ec,_0x56a3ec){const _0x1d9623=a5_0x4a13;if(_0x5041ec[_0x1d9623(0x8e)]===_0x56a3ec)return;_0x5041ec[_0x1d9623(0x8e)]=_0x56a3ec,await _0x5041ec[_0x1d9623(0xc6)](_0x1d9623(0xa0),{'val':_0x56a3ec,'ack':!![]});}async function processSensorEvent(_0x33b941,_0x3dbea9,_0x2b4208,_0xc7005e){const _0x17d055=a5_0x4a13;if(!_0xc7005e)return null;const _0x5d73f4=_0x2b4208[_0x17d055(0x87)],_0x3286c1=Date[_0x17d055(0x90)](),_0x46e1f8=_0x33b941['sensorLastValues'][_0x3dbea9];_0x33b941[_0x17d055(0xa9)][_0x3dbea9]=_0x5d73f4;if(!_0xc7005e[_0x17d055(0x9a)]&&_0x46e1f8!=undefined&&_0x46e1f8==_0x5d73f4)return null;const _0x54df62=(_0xc7005e['type']||'')[_0x17d055(0x7c)](),_0x11c72a=_0x54df62[_0x17d055(0x9d)](_0x17d055(0x82))||_0x54df62[_0x17d055(0x9d)](_0x17d055(0xbd))||_0x54df62[_0x17d055(0x9d)](_0x17d055(0xc9))||_0x54df62[_0x17d055(0x9d)](_0x17d055(0x8c));_0x33b941[_0x17d055(0xa3)]&&_0x11c72a&&recordThermodynamics(_0x33b941,_0x3dbea9,_0x5d73f4,_0xc7005e['location']);const _0x222ffb={'timestamp':_0x3286c1,'id':_0x3dbea9,'name':_0xc7005e[_0x17d055(0x9e)],'type':_0xc7005e['type'],'location':_0xc7005e[_0x17d055(0xad)],'value':_0x5d73f4};_0x33b941[_0x17d055(0x8f)][_0x17d055(0x84)](_0x222ffb);if(_0x33b941[_0x17d055(0x8f)][_0x17d055(0x83)]>HISTORY_MAX_SIZE)_0x33b941[_0x17d055(0x8f)][_0x17d055(0xb1)]();await _0x33b941[_0x17d055(0xc6)](_0x17d055(0x85),{'val':JSON['stringify'](_0x222ffb),'ack':!![]}),await _0x33b941[_0x17d055(0xc6)](_0x17d055(0xbb),{'val':JSON[_0x17d055(0xa1)](_0x33b941[_0x17d055(0x8f)]),'ack':!![]});if(_0x33b941['isProVersion']){_0x33b941[_0x17d055(0x95)][_0x17d055(0x9f)](_0x222ffb);if(_0x33b941[_0x17d055(0x95)][_0x17d055(0x83)]>RAW_LOG_MAX_SIZE)_0x33b941[_0x17d055(0x95)][_0x17d055(0x8a)](0x0,_0x33b941['rawEventLog'][_0x17d055(0x83)]-RAW_LOG_MAX_SIZE);await _0x33b941['setStateAsync'](_0x17d055(0xb5),{'val':JSON['stringify'](_0x33b941[_0x17d055(0x95)]),'ack':!![]}),recordSequence(_0x33b941,_0x222ffb);}if(_0xc7005e['isExit']&&_0x5d73f4===!![]){if(_0x33b941[_0x17d055(0x8e)]&&!_0x33b941[_0x17d055(0x81)])startExitTimer(_0x33b941);else{if(!_0x33b941[_0x17d055(0x8e)])setPresence(_0x33b941,!![]);}}else{if(_0xc7005e[_0x17d055(0x7a)]===_0x17d055(0xca)&&_0x5d73f4===!![]){if(_0x33b941[_0x17d055(0x80)])abortExitTimer(_0x33b941);if(!_0x33b941['isPresent']&&_0x33b941['currentSystemMode']===_0x17d055(0xb8))setPresence(_0x33b941,!![]);}}return _0x33b941[_0x17d055(0xa3)]&&_0xc7005e[_0x17d055(0x7a)]==='motion'&&_0x5d73f4===!![]&&_0xc7005e[_0x17d055(0xad)]&&_0x33b941[_0x17d055(0xc3)]&&_0x33b941['sendToPythonWrapper'](_0x17d055(0x89),{'room':_0xc7005e[_0x17d055(0xad)]}),_0x222ffb;}module[a5_0x198212(0xbe)]={'processSensorEvent':processSensorEvent,'getOutsideTemperatureNumeric':getOutsideTemperatureNumeric,'setPresence':setPresence,'abortExitTimer':abortExitTimer,'startExitTimer':startExitTimer};