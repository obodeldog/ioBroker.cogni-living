const a5_0x256675=a5_0x3a3b;(function(_0x387a44,_0x437ead){const _0x4758b9=a5_0x3a3b,_0x5f6538=_0x387a44();while(!![]){try{const _0xe5a778=parseInt(_0x4758b9(0x1e4))/0x1*(-parseInt(_0x4758b9(0x1c1))/0x2)+-parseInt(_0x4758b9(0x204))/0x3+-parseInt(_0x4758b9(0x1f7))/0x4+-parseInt(_0x4758b9(0x1e0))/0x5*(parseInt(_0x4758b9(0x1bc))/0x6)+-parseInt(_0x4758b9(0x1ea))/0x7+-parseInt(_0x4758b9(0x1cc))/0x8+parseInt(_0x4758b9(0x1b4))/0x9;if(_0xe5a778===_0x437ead)break;else _0x5f6538['push'](_0x5f6538['shift']());}catch(_0x46dc1e){_0x5f6538['push'](_0x5f6538['shift']());}}}(a5_0x2449,0x5f517));const a5_0x279842=(function(){let _0x137d3c=!![];return function(_0x405688,_0x38b910){const _0x387c0f=_0x137d3c?function(){const _0x1ff2b3=a5_0x3a3b;if(_0x38b910){const _0x5c2f56=_0x38b910[_0x1ff2b3(0x1d9)](_0x405688,arguments);return _0x38b910=null,_0x5c2f56;}}:function(){};return _0x137d3c=![],_0x387c0f;};}()),a5_0x4a6e97=a5_0x279842(this,function(){const _0x2665c3=a5_0x3a3b;return a5_0x4a6e97['toString']()[_0x2665c3(0x1d6)](_0x2665c3(0x1ec))['toString']()['constructor'](a5_0x4a6e97)['search'](_0x2665c3(0x1ec));});a5_0x4a6e97();'use strict';const HISTORY_MAX_SIZE=0x32,RAW_LOG_MAX_SIZE=0x9c4,THERMO_LOG_SIZE=0x3e8,SEQUENCE_TIMEOUT_MS=0x5*0x3c*0x3e8,MAX_TRAINING_SET_SIZE=0x1f4,EXIT_TIMER_MINUTES=0xf,EXIT_GRACE_PERIOD_SECONDS=0x1e;let activeSequence=[],sequenceTimer=null;async function getOutsideTemperatureNumeric(_0x3d358e){const _0x157ad2=a5_0x3a3b;if(_0x3d358e[_0x157ad2(0x1a5)]['outdoorSensorId'])try{const _0x378dfd=await _0x3d358e['getForeignStateAsync'](_0x3d358e[_0x157ad2(0x1a5)][_0x157ad2(0x19a)]);if(_0x378dfd&&_0x378dfd['val']!==undefined&&_0x378dfd['val']!==null)return parseFloat(_0x378dfd[_0x157ad2(0x1b3)]);}catch(_0x9fe2a){}const _0x523ba5=_0x3d358e[_0x157ad2(0x1a5)][_0x157ad2(0x1f6)];if(!_0x3d358e['config']['useWeather']||!_0x523ba5)return null;try{let _0x4f851f='';if(_0x523ba5[_0x157ad2(0x1b7)](_0x157ad2(0x1f9)))_0x4f851f=_0x523ba5+'.Current.Temperature';else{if(_0x523ba5[_0x157ad2(0x1b7)](_0x157ad2(0x1b2)))_0x4f851f=_0x523ba5+'.NextHours.Location_1.Day_1.current.temp_value';else{if(_0x523ba5[_0x157ad2(0x1b7)]('openweathermap'))_0x4f851f=_0x523ba5+_0x157ad2(0x1b5);else{if(_0x523ba5[_0x157ad2(0x1b7)](_0x157ad2(0x1b8)))_0x4f851f=_0x523ba5+_0x157ad2(0x1e7);}}}if(_0x4f851f){const _0x15c769=await _0x3d358e['getForeignStateAsync'](_0x4f851f);if(_0x15c769&&_0x15c769[_0x157ad2(0x1b3)]!==undefined&&_0x15c769[_0x157ad2(0x1b3)]!==null)return parseFloat(_0x15c769['val']);}}catch(_0x15d9b6){}return null;}async function recordThermodynamics(_0x19b34f,_0x44ee40,_0x3f2096,_0x47c97d){const _0x168056=a5_0x3a3b,_0xbac3bf=await getOutsideTemperatureNumeric(_0x19b34f);if(_0xbac3bf===null)return;let _0x4a761c=0x0,_0x21e4ff=![];if(_0x19b34f[_0x168056(0x1a5)][_0x168056(0x1f2)])try{let _0x34ad0a=_0x19b34f[_0x168056(0x1a5)]['valveMapping'];if(typeof _0x34ad0a===_0x168056(0x1c3))_0x34ad0a=JSON[_0x168056(0x1de)](_0x34ad0a);if(_0x34ad0a[_0x44ee40]){const _0xfc2941=_0x34ad0a[_0x44ee40],_0x2d3f59=await _0x19b34f[_0x168056(0x1ba)](_0xfc2941);if(_0x2d3f59&&_0x2d3f59[_0x168056(0x1b3)]!==null&&_0x2d3f59[_0x168056(0x1b3)]!==undefined){let _0x25b8b6=Number(_0x2d3f59['val']);if(_0x25b8b6<=1.05&&!_0xfc2941[_0x168056(0x1b7)](_0x168056(0x1f1))&&!_0xfc2941[_0x168056(0x1b7)](_0x168056(0x1a7)))_0x25b8b6=_0x25b8b6*0x64;_0x4a761c=Math[_0x168056(0x200)](_0x25b8b6),_0x21e4ff=!![];}}}catch(_0x34b1be){}if(!_0x21e4ff){const _0x54f5f6=[{'from':_0x168056(0x1c2),'to':'.1.LEVEL'},{'from':_0x168056(0x1c2),'to':_0x168056(0x1c0)},{'from':_0x168056(0x1bf),'to':'.4.VALVE_STATE'},{'from':'.ACTUAL_TEMPERATURE','to':_0x168056(0x1fa)},{'from':_0x168056(0x205),'to':_0x168056(0x19f)},{'from':_0x168056(0x1f3),'to':_0x168056(0x201)}];for(const _0x412baf of _0x54f5f6){if(_0x44ee40[_0x168056(0x1b7)](_0x412baf[_0x168056(0x1b6)])){const _0x4dcbde=_0x44ee40[_0x168056(0x1fb)](_0x412baf['from'],_0x412baf['to']);try{const _0x54fb2c=await _0x19b34f[_0x168056(0x1ba)](_0x4dcbde);if(_0x54fb2c&&_0x54fb2c['val']!==null&&_0x54fb2c['val']!==undefined){let _0x4665d5=Number(_0x54fb2c[_0x168056(0x1b3)]);if(typeof _0x4665d5===_0x168056(0x1fc)){if(_0x4665d5<=1.05&&_0x412baf['to'][_0x168056(0x1b7)](_0x168056(0x1c9)))_0x4665d5=_0x4665d5*0x64;_0x4a761c=Math[_0x168056(0x200)](_0x4665d5),_0x21e4ff=!![];break;}}}catch(_0x360b6c){}}}}const _0x471d9c=await _0x19b34f[_0x168056(0x1c8)](_0x168056(0x1a6));let _0x3f2ab3=[];if(_0x471d9c&&_0x471d9c[_0x168056(0x1b3)])try{_0x3f2ab3=JSON['parse'](_0x471d9c[_0x168056(0x1b3)]);}catch(_0x15c195){}_0x3f2ab3[_0x168056(0x206)]({'ts':Date[_0x168056(0x1a3)](),'room':_0x47c97d||_0x168056(0x20a),'t_in':_0x3f2096,'t_out':_0xbac3bf,'valve':_0x4a761c});if(_0x3f2ab3[_0x168056(0x1d1)]>THERMO_LOG_SIZE)_0x3f2ab3[_0x168056(0x1fe)]();await _0x19b34f['setStateAsync'](_0x168056(0x1a6),{'val':JSON[_0x168056(0x199)](_0x3f2ab3),'ack':!![]});}function a5_0x2449(){const _0x4e7526=['pr채senz','analysis.health.todayVector','weatherInstance','1672268AIIjJd','SIMULATE_SIGNAL','accuweather','.LEVEL','replace','number','occupancy','shift','lock','round','Valve','LTM.rawEventLog','sendToPythonWrapper','282972lXlIaD','temperature','push','licht','debug','type','Unknown','stringify','outdoorSensorId','temperatur','window','setStateAsync','some','level','log','isGracePeriodActive','eventHistory','now','kontakt','config','LTM.trainingData.thermodynamics','STATE','isPresent','value','lampe','motion','logDuplicates','unshift','lastTrackerEventTime','fill','exitGraceTimer','griff','daswetter','val','19241064fidEov','.forecast.current.temperature','from','includes','weatherunderground','events.history','getForeignStateAsync','system.isPresent','557520CqMEUV','getDate','contact','.1.TEMPERATURE','.1.VALVE_STATE','168382GEidoi','.1.ACTUAL_TEMPERATURE','string','name','exports','bewegung','\x20from\x20','getStateAsync','LEVEL','getHours','schalter','2039496AoWobY','heizung','fenster','t체r','switch','length','toLowerCase','LTM.trainingData.sequences','normal','rawEventLog','search','presence','loc','apply','map','location','isExit','klima','parse','exitTimer','15DXfyhf','error','handle','door','8SLqZjh','toISOString','dimmer','.forecast.current.temp','TRACK_EVENT','[RECORDER]\x20Ignored\x20implausible\x20temperature:\x20','194999uQiBnU','light','(((.+)+)+)+$','schloss','isProVersion','splice','sensorLastValues','STATUS','valveMapping','Temperature'];a5_0x2449=function(){return _0x4e7526;};return a5_0x2449();}function a5_0x3a3b(_0x48fbf9,_0x2bd7ae){const _0x557bf3=a5_0x2449();return a5_0x3a3b=function(_0x4a6e97,_0x279842){_0x4a6e97=_0x4a6e97-0x199;let _0x2449b6=_0x557bf3[_0x4a6e97];return _0x2449b6;},a5_0x3a3b(_0x48fbf9,_0x2bd7ae);}async function saveCompletedSequence(_0x59d971){const _0x398fdb=a5_0x3a3b;try{const _0xdc2bac=await _0x59d971[_0x398fdb(0x1c8)](_0x398fdb(0x1d3));let _0x10f829=[];if(_0xdc2bac&&_0xdc2bac[_0x398fdb(0x1b3)])try{_0x10f829=JSON[_0x398fdb(0x1de)](_0xdc2bac['val']);}catch(_0x551a4b){}const _0x3dc766=activeSequence[0x0]['ts'],_0x481190=activeSequence[_0x398fdb(0x1da)](_0x1b1f57=>({'loc':_0x1b1f57[_0x398fdb(0x1d8)],'t_delta':Math[_0x398fdb(0x200)]((_0x1b1f57['ts']-_0x3dc766)/0x3e8)})),_0x3bba09={'timestamp':new Date(_0x3dc766)[_0x398fdb(0x1e5)](),'steps':_0x481190,'duration':Math['round']((activeSequence[activeSequence['length']-0x1]['ts']-_0x3dc766)/0x3e8),'daytime':new Date(_0x3dc766)[_0x398fdb(0x1ca)]()};_0x10f829[_0x398fdb(0x206)](_0x3bba09);if(_0x10f829[_0x398fdb(0x1d1)]>MAX_TRAINING_SET_SIZE)_0x10f829[_0x398fdb(0x1fe)]();await _0x59d971[_0x398fdb(0x19d)](_0x398fdb(0x1d3),{'val':JSON[_0x398fdb(0x199)](_0x10f829),'ack':!![]}),_0x59d971[_0x398fdb(0x1ee)]&&_0x59d971[_0x398fdb(0x203)]&&_0x59d971['sendToPythonWrapper']('ANALYZE_SEQUENCE',{'sequence':_0x3bba09});}catch(_0x1889ed){_0x59d971[_0x398fdb(0x1a0)][_0x398fdb(0x1e1)]('[RECORDER]\x20Error:\x20'+_0x1889ed['message']);}}async function recordSequence(_0x4273b9,_0x14383b){const _0x2cf5eb=a5_0x3a3b,_0x3048f8=(_0x14383b[_0x2cf5eb(0x209)]||'')[_0x2cf5eb(0x1d2)](),_0x5cb4bf=[_0x2cf5eb(0x1ab),_0x2cf5eb(0x1c6),'pr채senz','presence','occupancy',_0x2cf5eb(0x1e3),'t체r',_0x2cf5eb(0x19c),_0x2cf5eb(0x1ce),_0x2cf5eb(0x1be),_0x2cf5eb(0x1a4),_0x2cf5eb(0x1eb),_0x2cf5eb(0x207),'switch',_0x2cf5eb(0x1cb),_0x2cf5eb(0x1e6),'lampe'];if(!_0x5cb4bf[_0x2cf5eb(0x19e)](_0x101a5c=>_0x3048f8[_0x2cf5eb(0x1b7)](_0x101a5c)))return;if(!_0x14383b[_0x2cf5eb(0x1a9)])return;if(sequenceTimer)clearTimeout(sequenceTimer);activeSequence[_0x2cf5eb(0x206)]({'loc':_0x14383b[_0x2cf5eb(0x1db)]||'Unknown','id':_0x14383b['id'],'ts':Date['now']()}),sequenceTimer=setTimeout(async()=>{if(activeSequence['length']>0x1)await saveCompletedSequence(_0x4273b9);activeSequence=[];},SEQUENCE_TIMEOUT_MS);}function startExitTimer(_0x57f999){const _0x13fa3c=a5_0x3a3b;abortExitTimer(_0x57f999),_0x57f999[_0x13fa3c(0x1a1)]=!![],_0x57f999[_0x13fa3c(0x1b0)]=setTimeout(()=>{const _0x27bcd4=_0x13fa3c;_0x57f999[_0x27bcd4(0x1a1)]=![];},EXIT_GRACE_PERIOD_SECONDS*0x3e8),_0x57f999['exitTimer']=setTimeout(()=>{setPresence(_0x57f999,![]),_0x57f999['exitTimer']=null;},EXIT_TIMER_MINUTES*0x3c*0x3e8);}function abortExitTimer(_0x24d831){const _0x49bc1c=a5_0x3a3b;if(_0x24d831[_0x49bc1c(0x1df)])clearTimeout(_0x24d831['exitTimer']);if(_0x24d831[_0x49bc1c(0x1b0)])clearTimeout(_0x24d831['exitGraceTimer']);_0x24d831[_0x49bc1c(0x1df)]=null,_0x24d831[_0x49bc1c(0x1b0)]=null,_0x24d831[_0x49bc1c(0x1a1)]=![];}async function setPresence(_0x40529e,_0x3d6a7f){const _0x3cc657=a5_0x3a3b;if(_0x40529e[_0x3cc657(0x1a8)]===_0x3d6a7f)return;_0x40529e[_0x3cc657(0x1a8)]=_0x3d6a7f,await _0x40529e['setStateAsync'](_0x3cc657(0x1bb),{'val':_0x3d6a7f,'ack':!![]});}async function updateHourlyActivity(_0x247846){const _0x3f863d=a5_0x3a3b;let _0xa50278=new Array(0x18)[_0x3f863d(0x1af)](0x0),_0x243a9a=0x0;try{const _0x1e0209=await _0x247846['getStateAsync']('analysis.health.todayVector');_0x1e0209&&_0x1e0209[_0x3f863d(0x1b3)]&&(_0xa50278=JSON[_0x3f863d(0x1de)](_0x1e0209[_0x3f863d(0x1b3)]),_0x243a9a=_0x1e0209['ts']);}catch(_0x30f78f){}const _0x4a80b7=new Date(_0x243a9a),_0x31dddc=new Date();_0x4a80b7['getDate']()!==_0x31dddc[_0x3f863d(0x1bd)]()&&(_0xa50278=new Array(0x18)[_0x3f863d(0x1af)](0x0));const _0x2f2436=_0x31dddc[_0x3f863d(0x1ca)]();if(_0xa50278[_0x2f2436]===undefined)_0xa50278[_0x2f2436]=0x0;_0xa50278[_0x2f2436]++,await _0x247846[_0x3f863d(0x19d)](_0x3f863d(0x1f5),{'val':JSON[_0x3f863d(0x199)](_0xa50278),'ack':!![]});}async function processSensorEvent(_0x50bb9c,_0x95ccb6,_0x3a9bed,_0x533471){const _0x5391ae=a5_0x3a3b;if(!_0x533471)return null;const _0x4aa7e5=_0x3a9bed[_0x5391ae(0x1b3)],_0x350609=Date[_0x5391ae(0x1a3)](),_0x5edcbe=_0x50bb9c[_0x5391ae(0x1f0)][_0x95ccb6],_0x378571=(_0x533471[_0x5391ae(0x209)]||'')['toLowerCase'](),_0x56a502=_0x378571['includes'](_0x5391ae(0x205))||_0x378571['includes'](_0x5391ae(0x19b))||_0x378571[_0x5391ae(0x1b7)](_0x5391ae(0x1dd))||_0x378571['includes'](_0x5391ae(0x1cd))||_0x378571[_0x5391ae(0x1b7)]('thermostat');if(_0x56a502&&typeof _0x4aa7e5===_0x5391ae(0x1fc)){if(_0x4aa7e5>0x50||_0x4aa7e5<-0x32)return _0x50bb9c[_0x5391ae(0x1a0)][_0x5391ae(0x208)](_0x5391ae(0x1e9)+_0x4aa7e5+_0x5391ae(0x1c7)+_0x95ccb6),null;}_0x50bb9c[_0x5391ae(0x1f0)][_0x95ccb6]=_0x4aa7e5;if(!_0x533471[_0x5391ae(0x1ac)]&&_0x5edcbe!=undefined&&_0x5edcbe==_0x4aa7e5)return null;_0x50bb9c[_0x5391ae(0x1ee)]&&_0x56a502&&recordThermodynamics(_0x50bb9c,_0x95ccb6,_0x4aa7e5,_0x533471[_0x5391ae(0x1db)]);const _0x181884={'timestamp':_0x350609,'id':_0x95ccb6,'name':_0x533471[_0x5391ae(0x1c4)],'type':_0x533471['type'],'location':_0x533471[_0x5391ae(0x1db)],'value':_0x4aa7e5};_0x50bb9c[_0x5391ae(0x1a2)][_0x5391ae(0x1ad)](_0x181884);if(_0x50bb9c['eventHistory'][_0x5391ae(0x1d1)]>HISTORY_MAX_SIZE)_0x50bb9c[_0x5391ae(0x1a2)]['pop']();await _0x50bb9c[_0x5391ae(0x19d)]('events.lastEvent',{'val':JSON[_0x5391ae(0x199)](_0x181884),'ack':!![]}),await _0x50bb9c[_0x5391ae(0x19d)](_0x5391ae(0x1b9),{'val':JSON['stringify'](_0x50bb9c['eventHistory']),'ack':!![]}),await updateHourlyActivity(_0x50bb9c);if(_0x50bb9c[_0x5391ae(0x1ee)]){_0x50bb9c['rawEventLog']['push'](_0x181884);if(_0x50bb9c['rawEventLog'][_0x5391ae(0x1d1)]>RAW_LOG_MAX_SIZE)_0x50bb9c[_0x5391ae(0x1d5)][_0x5391ae(0x1ef)](0x0,_0x50bb9c['rawEventLog'][_0x5391ae(0x1d1)]-RAW_LOG_MAX_SIZE);await _0x50bb9c[_0x5391ae(0x19d)](_0x5391ae(0x202),{'val':JSON['stringify'](_0x50bb9c[_0x5391ae(0x1d5)]),'ack':!![]}),recordSequence(_0x50bb9c,_0x181884);}if(_0x533471[_0x5391ae(0x1dc)]&&_0x4aa7e5===!![]){if(_0x50bb9c[_0x5391ae(0x1a8)]&&!_0x50bb9c['isGracePeriodActive'])startExitTimer(_0x50bb9c);else{if(!_0x50bb9c[_0x5391ae(0x1a8)])setPresence(_0x50bb9c,!![]);}}else{if(_0x533471[_0x5391ae(0x209)]===_0x5391ae(0x1ab)&&_0x4aa7e5===!![]){if(_0x50bb9c['exitTimer'])abortExitTimer(_0x50bb9c);if(!_0x50bb9c[_0x5391ae(0x1a8)]&&_0x50bb9c['currentSystemMode']===_0x5391ae(0x1d4))setPresence(_0x50bb9c,!![]);}}if(_0x50bb9c[_0x5391ae(0x1ee)]&&_0x50bb9c[_0x5391ae(0x203)]){_0x533471[_0x5391ae(0x209)]===_0x5391ae(0x1ab)&&_0x4aa7e5===!![]&&_0x533471[_0x5391ae(0x1db)]&&_0x50bb9c[_0x5391ae(0x203)](_0x5391ae(0x1f8),{'room':_0x533471[_0x5391ae(0x1db)]});const _0x569fbd=[_0x5391ae(0x1e3),_0x5391ae(0x1cf),_0x5391ae(0x19c),_0x5391ae(0x1ce),_0x5391ae(0x1b1),_0x5391ae(0x1e2),_0x5391ae(0x1ff),_0x5391ae(0x1ed)][_0x5391ae(0x19e)](_0xfbe0a0=>_0x378571[_0x5391ae(0x1b7)](_0xfbe0a0)),_0x239fbc=[_0x5391ae(0x1eb),_0x5391ae(0x207),_0x5391ae(0x1d0),_0x5391ae(0x1cb),_0x5391ae(0x1e6),_0x5391ae(0x1aa)][_0x5391ae(0x19e)](_0xf1338b=>_0x378571['includes'](_0xf1338b)),_0x4db8b4=['motion','bewegung',_0x5391ae(0x1f4),_0x5391ae(0x1d7),_0x5391ae(0x1fd)][_0x5391ae(0x19e)](_0x554fd0=>_0x378571[_0x5391ae(0x1b7)](_0x554fd0));if(_0x533471[_0x5391ae(0x1db)]&&(_0x569fbd||_0x239fbc||_0x4db8b4)){const _0x526fc0=_0x4aa7e5===!![]||typeof _0x4aa7e5===_0x5391ae(0x1fc)&&_0x4aa7e5>0x0,_0x443787=_0x569fbd&&!_0x526fc0&&_0x5edcbe!==undefined&&_0x5edcbe!=_0x4aa7e5;if(_0x526fc0||_0x443787){const _0x1914f5=_0x50bb9c[_0x5391ae(0x1ae)]||_0x350609,_0x4a404d=(_0x350609-_0x1914f5)/0x3e8;_0x50bb9c[_0x5391ae(0x1ae)]=_0x350609,_0x50bb9c['sendToPythonWrapper'](_0x5391ae(0x1e8),{'room':_0x533471[_0x5391ae(0x1db)],'dt':_0x4a404d});}}}return _0x181884;}module[a5_0x256675(0x1c5)]={'processSensorEvent':processSensorEvent,'getOutsideTemperatureNumeric':getOutsideTemperatureNumeric,'setPresence':setPresence,'abortExitTimer':abortExitTimer,'startExitTimer':startExitTimer};