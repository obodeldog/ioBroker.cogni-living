(function(_0x2b3f81,_0x487a2f){const _0x53c934=a5_0x9d76,_0x6d122e=_0x2b3f81();while(!![]){try{const _0x432dd7=parseInt(_0x53c934(0x1cf))/0x1+-parseInt(_0x53c934(0x1c1))/0x2*(-parseInt(_0x53c934(0x20d))/0x3)+parseInt(_0x53c934(0x20c))/0x4+parseInt(_0x53c934(0x1fb))/0x5+parseInt(_0x53c934(0x1b9))/0x6+-parseInt(_0x53c934(0x210))/0x7+-parseInt(_0x53c934(0x1be))/0x8;if(_0x432dd7===_0x487a2f)break;else _0x6d122e['push'](_0x6d122e['shift']());}catch(_0x1e67ae){_0x6d122e['push'](_0x6d122e['shift']());}}}(a5_0x46e8,0x5679d));function a5_0x46e8(){const _0x1d00de=['value','2CgSlKb','unshift','parse','search','constructor','events.history','config','bewegung','sendToPythonWrapper','events.lastEvent','switch','push','.LEVEL','message','419487cYWunH','isExit','stringify','LEVEL','location','occupancy','number','LTM.trainingData.thermodynamics','temperatur','getStateAsync','type','presence','name','toLowerCase','klima','sensorLastValues','(((.+)+)+)+$','dimmer','getForeignStateAsync','.ACTUAL_TEMPERATURE','isPresent','isGracePeriodActive','heizung','door','exitTimer','contact','error','apply','eventHistory','splice','normal','shift','isProVersion','motion','now','.1.ACTUAL_TEMPERATURE','rawEventLog','schalter','log','LTM.trainingData.sequences','logDuplicates','hm-rpc','outdoorSensorId','toString','3504605nfvvbt','length','.1.TEMPERATURE','includes','ANALYZE_SEQUENCE','lampe','weatherInstance','val','kontakt','Unknown','currentSystemMode','exitGraceTimer','system.isPresent','.Current.Temperature','LTM.rawEventLog','map','licht','1664540TtkUQc','590022nfDhca','from','SIMULATE_SIGNAL','1583232Nrirmp','window','3669066EHqoOf','.1.VALVE_STATE','loc','pop','round','14114776XLJhIJ','setStateAsync'];a5_0x46e8=function(){return _0x1d00de;};return a5_0x46e8();}const a5_0x135a13=(function(){let _0x540bb5=!![];return function(_0x34b314,_0xf72e12){const _0x3bc902=_0x540bb5?function(){const _0x30c1e9=a5_0x9d76;if(_0xf72e12){const _0x252099=_0xf72e12[_0x30c1e9(0x1ea)](_0x34b314,arguments);return _0xf72e12=null,_0x252099;}}:function(){};return _0x540bb5=![],_0x3bc902;};}()),a5_0x2737e4=a5_0x135a13(this,function(){const _0x88ba79=a5_0x9d76;return a5_0x2737e4[_0x88ba79(0x1fa)]()[_0x88ba79(0x1c4)](_0x88ba79(0x1df))['toString']()[_0x88ba79(0x1c5)](a5_0x2737e4)[_0x88ba79(0x1c4)]('(((.+)+)+)+$');});a5_0x2737e4();'use strict';const HISTORY_MAX_SIZE=0x32,RAW_LOG_MAX_SIZE=0x9c4,THERMO_LOG_SIZE=0x3e8,SEQUENCE_TIMEOUT_MS=0x5*0x3c*0x3e8,MAX_TRAINING_SET_SIZE=0x1f4,EXIT_TIMER_MINUTES=0xf,EXIT_GRACE_PERIOD_SECONDS=0x1e;let activeSequence=[],sequenceTimer=null;function a5_0x9d76(_0x4d3eb6,_0x5147b6){const _0x228c42=a5_0x46e8();return a5_0x9d76=function(_0x2737e4,_0x135a13){_0x2737e4=_0x2737e4-0x1b9;let _0x46e83e=_0x228c42[_0x2737e4];return _0x46e83e;},a5_0x9d76(_0x4d3eb6,_0x5147b6);}async function getOutsideTemperatureNumeric(_0x1570a4){const _0x4e794e=a5_0x9d76;if(_0x1570a4[_0x4e794e(0x1c7)][_0x4e794e(0x1f9)])try{const _0x24c2db=await _0x1570a4['getForeignStateAsync'](_0x1570a4['config']['outdoorSensorId']);if(_0x24c2db&&_0x24c2db[_0x4e794e(0x202)]!==undefined&&_0x24c2db[_0x4e794e(0x202)]!==null)return parseFloat(_0x24c2db[_0x4e794e(0x202)]);}catch(_0x209f79){}const _0x2c6bf8=_0x1570a4['config'][_0x4e794e(0x201)];if(!_0x1570a4[_0x4e794e(0x1c7)]['useWeather']||!_0x2c6bf8)return null;try{let _0x11122b='';if(_0x2c6bf8[_0x4e794e(0x1fe)]('accuweather'))_0x11122b=_0x2c6bf8+_0x4e794e(0x208);else{if(_0x2c6bf8[_0x4e794e(0x1fe)]('daswetter'))_0x11122b=_0x2c6bf8+'.NextHours.Location_1.Day_1.current.temp_value';else{if(_0x2c6bf8[_0x4e794e(0x1fe)]('openweathermap'))_0x11122b=_0x2c6bf8+'.forecast.current.temperature';else{if(_0x2c6bf8[_0x4e794e(0x1fe)]('weatherunderground'))_0x11122b=_0x2c6bf8+'.forecast.current.temp';}}}if(_0x11122b){const _0x323116=await _0x1570a4[_0x4e794e(0x1e1)](_0x11122b);if(_0x323116&&_0x323116[_0x4e794e(0x202)]!==undefined&&_0x323116[_0x4e794e(0x202)]!==null)return parseFloat(_0x323116[_0x4e794e(0x202)]);}}catch(_0x557882){}return null;}async function recordThermodynamics(_0x57a3da,_0x1e5e85,_0x356c31,_0x35db95){const _0x4d41db=a5_0x9d76,_0x490fd4=await getOutsideTemperatureNumeric(_0x57a3da);let _0x1927a1=0x0;if(_0x1e5e85[_0x4d41db(0x1fe)](_0x4d41db(0x1f8))){const _0x84d7ec=[{'from':_0x4d41db(0x1f2),'to':'.1.LEVEL'},{'from':'.1.ACTUAL_TEMPERATURE','to':_0x4d41db(0x1ba)},{'from':_0x4d41db(0x1fd),'to':'.4.VALVE_STATE'},{'from':_0x4d41db(0x1e2),'to':_0x4d41db(0x1cd)}];for(const _0x21cc4f of _0x84d7ec){if(_0x1e5e85[_0x4d41db(0x1fe)](_0x21cc4f['from'])){const _0x2d483d=_0x1e5e85['replace'](_0x21cc4f[_0x4d41db(0x20e)],_0x21cc4f['to']);try{const _0x2f787b=await _0x57a3da[_0x4d41db(0x1e1)](_0x2d483d);if(_0x2f787b&&_0x2f787b[_0x4d41db(0x202)]!==null&&_0x2f787b[_0x4d41db(0x202)]!==undefined){let _0x5a1e46=_0x2f787b[_0x4d41db(0x202)];typeof _0x5a1e46===_0x4d41db(0x1d5)&&_0x5a1e46<=1.05&&_0x21cc4f['to'][_0x4d41db(0x1fe)](_0x4d41db(0x1d2))&&(_0x5a1e46=_0x5a1e46*0x64);_0x1927a1=Math[_0x4d41db(0x1bd)](_0x5a1e46);break;}}catch(_0x4089fa){}}}}const _0x3da808=await _0x57a3da['getStateAsync'](_0x4d41db(0x1d6));let _0x5639f4=[];if(_0x3da808&&_0x3da808[_0x4d41db(0x202)])try{_0x5639f4=JSON[_0x4d41db(0x1c3)](_0x3da808[_0x4d41db(0x202)]);}catch(_0x4d519f){}_0x5639f4[_0x4d41db(0x1cc)]({'ts':Date[_0x4d41db(0x1f1)](),'room':_0x35db95||'Unknown','t_in':_0x356c31,'t_out':_0x490fd4,'valve':_0x1927a1});if(_0x5639f4[_0x4d41db(0x1fc)]>THERMO_LOG_SIZE)_0x5639f4[_0x4d41db(0x1ee)]();await _0x57a3da[_0x4d41db(0x1bf)](_0x4d41db(0x1d6),{'val':JSON['stringify'](_0x5639f4),'ack':!![]});}async function saveCompletedSequence(_0x2ba465){const _0x38eb79=a5_0x9d76;try{const _0x4933b3=await _0x2ba465[_0x38eb79(0x1d8)](_0x38eb79(0x1f6));let _0x3636aa=[];if(_0x4933b3&&_0x4933b3['val'])try{_0x3636aa=JSON['parse'](_0x4933b3[_0x38eb79(0x202)]);}catch(_0x464c2a){}const _0x5ea3e2=activeSequence[0x0]['ts'],_0x4e3099=activeSequence[_0x38eb79(0x20a)](_0x55963b=>({'loc':_0x55963b[_0x38eb79(0x1bb)],'t_delta':Math['round']((_0x55963b['ts']-_0x5ea3e2)/0x3e8)})),_0x2f352c={'timestamp':new Date(_0x5ea3e2)['toISOString'](),'steps':_0x4e3099,'duration':Math[_0x38eb79(0x1bd)]((activeSequence[activeSequence[_0x38eb79(0x1fc)]-0x1]['ts']-_0x5ea3e2)/0x3e8),'daytime':new Date(_0x5ea3e2)['getHours']()};_0x3636aa[_0x38eb79(0x1cc)](_0x2f352c);if(_0x3636aa[_0x38eb79(0x1fc)]>MAX_TRAINING_SET_SIZE)_0x3636aa[_0x38eb79(0x1ee)]();await _0x2ba465['setStateAsync']('LTM.trainingData.sequences',{'val':JSON[_0x38eb79(0x1d1)](_0x3636aa),'ack':!![]}),_0x2ba465[_0x38eb79(0x1ef)]&&_0x2ba465[_0x38eb79(0x1c9)]&&_0x2ba465[_0x38eb79(0x1c9)](_0x38eb79(0x1ff),{'sequence':_0x2f352c});}catch(_0x1ab65f){_0x2ba465[_0x38eb79(0x1f5)][_0x38eb79(0x1e9)]('[RECORDER]\x20Error:\x20'+_0x1ab65f[_0x38eb79(0x1ce)]);}}async function recordSequence(_0x35b902,_0x4d4849){const _0xd8e1aa=a5_0x9d76,_0x244867=(_0x4d4849[_0xd8e1aa(0x1d9)]||'')[_0xd8e1aa(0x1dc)](),_0x350782=[_0xd8e1aa(0x1f0),_0xd8e1aa(0x1c8),'präsenz',_0xd8e1aa(0x1da),_0xd8e1aa(0x1d4),_0xd8e1aa(0x1e6),'tür',_0xd8e1aa(0x211),'fenster',_0xd8e1aa(0x1e8),_0xd8e1aa(0x203),'light',_0xd8e1aa(0x20b),_0xd8e1aa(0x1cb),_0xd8e1aa(0x1f4),_0xd8e1aa(0x1e0),_0xd8e1aa(0x200)];if(!_0x350782['some'](_0x3b4034=>_0x244867['includes'](_0x3b4034)))return;if(!_0x4d4849[_0xd8e1aa(0x1c0)])return;if(sequenceTimer)clearTimeout(sequenceTimer);activeSequence['push']({'loc':_0x4d4849[_0xd8e1aa(0x1d3)]||_0xd8e1aa(0x204),'id':_0x4d4849['id'],'ts':Date[_0xd8e1aa(0x1f1)]()}),sequenceTimer=setTimeout(async()=>{const _0x269af0=_0xd8e1aa;if(activeSequence[_0x269af0(0x1fc)]>0x1)await saveCompletedSequence(_0x35b902);activeSequence=[];},SEQUENCE_TIMEOUT_MS);}function startExitTimer(_0x183aaf){const _0x3b5ae6=a5_0x9d76;abortExitTimer(_0x183aaf),_0x183aaf[_0x3b5ae6(0x1e4)]=!![],_0x183aaf[_0x3b5ae6(0x206)]=setTimeout(()=>{const _0x457ae9=_0x3b5ae6;_0x183aaf[_0x457ae9(0x1e4)]=![];},EXIT_GRACE_PERIOD_SECONDS*0x3e8),_0x183aaf['exitTimer']=setTimeout(()=>{const _0x91d434=_0x3b5ae6;setPresence(_0x183aaf,![]),_0x183aaf[_0x91d434(0x1e7)]=null;},EXIT_TIMER_MINUTES*0x3c*0x3e8);}function abortExitTimer(_0x4748a2){const _0x2c5849=a5_0x9d76;if(_0x4748a2['exitTimer'])clearTimeout(_0x4748a2[_0x2c5849(0x1e7)]);if(_0x4748a2[_0x2c5849(0x206)])clearTimeout(_0x4748a2[_0x2c5849(0x206)]);_0x4748a2[_0x2c5849(0x1e7)]=null,_0x4748a2[_0x2c5849(0x206)]=null,_0x4748a2[_0x2c5849(0x1e4)]=![];}async function setPresence(_0xf03a29,_0x137078){const _0x2d3a90=a5_0x9d76;if(_0xf03a29[_0x2d3a90(0x1e3)]===_0x137078)return;_0xf03a29[_0x2d3a90(0x1e3)]=_0x137078,await _0xf03a29['setStateAsync'](_0x2d3a90(0x207),{'val':_0x137078,'ack':!![]});}async function processSensorEvent(_0x3b463a,_0x12fb5a,_0x3c6259,_0x448b99){const _0xf0cb7c=a5_0x9d76;if(!_0x448b99)return null;const _0x15e94d=_0x3c6259[_0xf0cb7c(0x202)],_0x58b901=Date[_0xf0cb7c(0x1f1)](),_0x414627=_0x3b463a['sensorLastValues'][_0x12fb5a];_0x3b463a[_0xf0cb7c(0x1de)][_0x12fb5a]=_0x15e94d;if(!_0x448b99[_0xf0cb7c(0x1f7)]&&_0x414627!=undefined&&_0x414627==_0x15e94d)return null;const _0x47f23e=(_0x448b99[_0xf0cb7c(0x1d9)]||'')[_0xf0cb7c(0x1dc)](),_0x2a9d73=_0x47f23e[_0xf0cb7c(0x1fe)]('temperature')||_0x47f23e[_0xf0cb7c(0x1fe)](_0xf0cb7c(0x1d7))||_0x47f23e['includes'](_0xf0cb7c(0x1dd))||_0x47f23e[_0xf0cb7c(0x1fe)](_0xf0cb7c(0x1e5));_0x3b463a[_0xf0cb7c(0x1ef)]&&_0x2a9d73&&recordThermodynamics(_0x3b463a,_0x12fb5a,_0x15e94d,_0x448b99[_0xf0cb7c(0x1d3)]);const _0xf5e8a5={'timestamp':_0x58b901,'id':_0x12fb5a,'name':_0x448b99[_0xf0cb7c(0x1db)],'type':_0x448b99[_0xf0cb7c(0x1d9)],'location':_0x448b99[_0xf0cb7c(0x1d3)],'value':_0x15e94d};_0x3b463a['eventHistory'][_0xf0cb7c(0x1c2)](_0xf5e8a5);if(_0x3b463a[_0xf0cb7c(0x1eb)][_0xf0cb7c(0x1fc)]>HISTORY_MAX_SIZE)_0x3b463a['eventHistory'][_0xf0cb7c(0x1bc)]();await _0x3b463a[_0xf0cb7c(0x1bf)](_0xf0cb7c(0x1ca),{'val':JSON['stringify'](_0xf5e8a5),'ack':!![]}),await _0x3b463a['setStateAsync'](_0xf0cb7c(0x1c6),{'val':JSON[_0xf0cb7c(0x1d1)](_0x3b463a[_0xf0cb7c(0x1eb)]),'ack':!![]});if(_0x3b463a[_0xf0cb7c(0x1ef)]){_0x3b463a[_0xf0cb7c(0x1f3)][_0xf0cb7c(0x1cc)](_0xf5e8a5);if(_0x3b463a[_0xf0cb7c(0x1f3)][_0xf0cb7c(0x1fc)]>RAW_LOG_MAX_SIZE)_0x3b463a[_0xf0cb7c(0x1f3)][_0xf0cb7c(0x1ec)](0x0,_0x3b463a[_0xf0cb7c(0x1f3)][_0xf0cb7c(0x1fc)]-RAW_LOG_MAX_SIZE);await _0x3b463a[_0xf0cb7c(0x1bf)](_0xf0cb7c(0x209),{'val':JSON[_0xf0cb7c(0x1d1)](_0x3b463a[_0xf0cb7c(0x1f3)]),'ack':!![]}),recordSequence(_0x3b463a,_0xf5e8a5);}if(_0x448b99[_0xf0cb7c(0x1d0)]&&_0x15e94d===!![]){if(_0x3b463a[_0xf0cb7c(0x1e3)]&&!_0x3b463a[_0xf0cb7c(0x1e4)])startExitTimer(_0x3b463a);else{if(!_0x3b463a[_0xf0cb7c(0x1e3)])setPresence(_0x3b463a,!![]);}}else{if(_0x448b99[_0xf0cb7c(0x1d9)]===_0xf0cb7c(0x1f0)&&_0x15e94d===!![]){if(_0x3b463a[_0xf0cb7c(0x1e7)])abortExitTimer(_0x3b463a);if(!_0x3b463a[_0xf0cb7c(0x1e3)]&&_0x3b463a[_0xf0cb7c(0x205)]===_0xf0cb7c(0x1ed))setPresence(_0x3b463a,!![]);}}return _0x3b463a[_0xf0cb7c(0x1ef)]&&_0x448b99[_0xf0cb7c(0x1d9)]===_0xf0cb7c(0x1f0)&&_0x15e94d===!![]&&_0x448b99['location']&&_0x3b463a[_0xf0cb7c(0x1c9)]&&_0x3b463a[_0xf0cb7c(0x1c9)](_0xf0cb7c(0x20f),{'room':_0x448b99[_0xf0cb7c(0x1d3)]}),_0xf5e8a5;}module['exports']={'processSensorEvent':processSensorEvent,'getOutsideTemperatureNumeric':getOutsideTemperatureNumeric,'setPresence':setPresence,'abortExitTimer':abortExitTimer,'startExitTimer':startExitTimer};