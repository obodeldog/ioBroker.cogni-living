const a5_0x199071=a5_0x2a46;(function(_0x1060de,_0x3cadcc){const _0x39aaf9=a5_0x2a46,_0x948623=_0x1060de();while(!![]){try{const _0x3de1ba=-parseInt(_0x39aaf9(0x154))/0x1+parseInt(_0x39aaf9(0x191))/0x2*(-parseInt(_0x39aaf9(0x150))/0x3)+parseInt(_0x39aaf9(0x19e))/0x4+-parseInt(_0x39aaf9(0x171))/0x5*(parseInt(_0x39aaf9(0x1ab))/0x6)+parseInt(_0x39aaf9(0x19f))/0x7*(parseInt(_0x39aaf9(0x169))/0x8)+-parseInt(_0x39aaf9(0x162))/0x9*(parseInt(_0x39aaf9(0x172))/0xa)+parseInt(_0x39aaf9(0x196))/0xb;if(_0x3de1ba===_0x3cadcc)break;else _0x948623['push'](_0x948623['shift']());}catch(_0x3234fc){_0x948623['push'](_0x948623['shift']());}}}(a5_0x12ed,0xa62cd));const a5_0x238a16=(function(){let _0x1f9235=!![];return function(_0x48b707,_0x1cbd51){const _0x48580f=_0x1f9235?function(){const _0x2e003e=a5_0x2a46;if(_0x1cbd51){const _0x7a0725=_0x1cbd51[_0x2e003e(0x1a6)](_0x48b707,arguments);return _0x1cbd51=null,_0x7a0725;}}:function(){};return _0x1f9235=![],_0x48580f;};}()),a5_0x34126b=a5_0x238a16(this,function(){const _0x1629c4=a5_0x2a46;return a5_0x34126b[_0x1629c4(0x16d)]()['search'](_0x1629c4(0x166))[_0x1629c4(0x16d)]()[_0x1629c4(0x15a)](a5_0x34126b)[_0x1629c4(0x183)](_0x1629c4(0x166));});a5_0x34126b();function a5_0x12ed(){const _0xdb0604=['val','dimmer','STATUS','includes','Valve','from','number','t체r','STATE','round','exports','isProVersion','message','search','shift','setStateAsync','pop','switch','.NextHours.Location_1.Day_1.current.temp_value','window','bewegung','parse','sensorLastValues','[RECORDER]\x20Error:\x20','presence','contact','heizung','126324ntJapj','occupancy','string','rawEventLog','logDuplicates','16890346cnmJDW','fenster','events.history','LTM.trainingData.thermodynamics','Temperature','daswetter','splice','some','3344528tohixt','70574TXHnQf','system.isPresent','valveMapping','kontakt','loc','.1.VALVE_STATE','lampe','apply','klima','outdoorSensorId','accuweather','push','7220508ckOANS','getStateAsync','length','licht','toLowerCase','.LEVEL','.1.TEMPERATURE','pr채senz','toISOString','name','TRACK_EVENT','.4.VALVE_STATE','.forecast.current.temp','error','54GzzLTN','type','schalter','isGracePeriodActive','224056vgKnun','weatherInstance','debug','normal','sendToPythonWrapper','temperature','constructor','exitGraceTimer','value','exitTimer','eventHistory','\x20from\x20','light','location','279sxrfCj','.1.LEVEL','log','now','(((.+)+)+)+$','door','motion','992vpNmtW','[RECORDER]\x20Ignored\x20implausible\x20temperature:\x20','LTM.trainingData.sequences','isPresent','toString','stringify','config','getForeignStateAsync','5GlgdNF','121530OtcgUB','lock','schloss','LTM.rawEventLog'];a5_0x12ed=function(){return _0xdb0604;};return a5_0x12ed();}'use strict';const HISTORY_MAX_SIZE=0x32,RAW_LOG_MAX_SIZE=0x9c4,THERMO_LOG_SIZE=0x3e8,SEQUENCE_TIMEOUT_MS=0x5*0x3c*0x3e8,MAX_TRAINING_SET_SIZE=0x1f4,EXIT_TIMER_MINUTES=0xf,EXIT_GRACE_PERIOD_SECONDS=0x1e;let activeSequence=[],sequenceTimer=null;async function getOutsideTemperatureNumeric(_0x2886ff){const _0x39a8e7=a5_0x2a46;if(_0x2886ff[_0x39a8e7(0x16f)][_0x39a8e7(0x1a8)])try{const _0x3f4234=await _0x2886ff['getForeignStateAsync'](_0x2886ff[_0x39a8e7(0x16f)][_0x39a8e7(0x1a8)]);if(_0x3f4234&&_0x3f4234[_0x39a8e7(0x176)]!==undefined&&_0x3f4234['val']!==null)return parseFloat(_0x3f4234[_0x39a8e7(0x176)]);}catch(_0xc487bd){}const _0x3f2462=_0x2886ff[_0x39a8e7(0x16f)][_0x39a8e7(0x155)];if(!_0x2886ff['config']['useWeather']||!_0x3f2462)return null;try{let _0x4614c6='';if(_0x3f2462[_0x39a8e7(0x179)](_0x39a8e7(0x1a9)))_0x4614c6=_0x3f2462+'.Current.Temperature';else{if(_0x3f2462[_0x39a8e7(0x179)](_0x39a8e7(0x19b)))_0x4614c6=_0x3f2462+_0x39a8e7(0x188);else{if(_0x3f2462[_0x39a8e7(0x179)]('openweathermap'))_0x4614c6=_0x3f2462+'.forecast.current.temperature';else{if(_0x3f2462[_0x39a8e7(0x179)]('weatherunderground'))_0x4614c6=_0x3f2462+_0x39a8e7(0x14e);}}}if(_0x4614c6){const _0x4e15f6=await _0x2886ff[_0x39a8e7(0x170)](_0x4614c6);if(_0x4e15f6&&_0x4e15f6[_0x39a8e7(0x176)]!==undefined&&_0x4e15f6[_0x39a8e7(0x176)]!==null)return parseFloat(_0x4e15f6['val']);}}catch(_0x5838e8){}return null;}async function recordThermodynamics(_0x221666,_0x3cfbc3,_0xb5a017,_0x41f50c){const _0x2cf6cf=a5_0x2a46,_0x30004d=await getOutsideTemperatureNumeric(_0x221666);if(_0x30004d===null)return;let _0x4f1ed3=0x0,_0x357ff1=![];if(_0x221666['config'][_0x2cf6cf(0x1a1)])try{let _0x22fb92=_0x221666[_0x2cf6cf(0x16f)][_0x2cf6cf(0x1a1)];if(typeof _0x22fb92===_0x2cf6cf(0x193))_0x22fb92=JSON[_0x2cf6cf(0x18b)](_0x22fb92);if(_0x22fb92[_0x3cfbc3]){const _0x404641=_0x22fb92[_0x3cfbc3],_0x5c6385=await _0x221666['getForeignStateAsync'](_0x404641);if(_0x5c6385&&_0x5c6385[_0x2cf6cf(0x176)]!==null&&_0x5c6385[_0x2cf6cf(0x176)]!==undefined){let _0x18a788=Number(_0x5c6385['val']);if(_0x18a788<=1.05&&!_0x404641[_0x2cf6cf(0x179)](_0x2cf6cf(0x178))&&!_0x404641[_0x2cf6cf(0x179)](_0x2cf6cf(0x17e)))_0x18a788=_0x18a788*0x64;_0x4f1ed3=Math[_0x2cf6cf(0x17f)](_0x18a788),_0x357ff1=!![];}}}catch(_0x1756a3){}if(!_0x357ff1){const _0x3cdf59=[{'from':'.1.ACTUAL_TEMPERATURE','to':_0x2cf6cf(0x163)},{'from':'.1.ACTUAL_TEMPERATURE','to':_0x2cf6cf(0x1a4)},{'from':_0x2cf6cf(0x1b1),'to':_0x2cf6cf(0x14d)},{'from':'.ACTUAL_TEMPERATURE','to':_0x2cf6cf(0x1b0)},{'from':'temperature','to':'level'},{'from':_0x2cf6cf(0x19a),'to':_0x2cf6cf(0x17a)}];for(const _0x1a57e1 of _0x3cdf59){if(_0x3cfbc3['includes'](_0x1a57e1['from'])){const _0x4b0e30=_0x3cfbc3['replace'](_0x1a57e1[_0x2cf6cf(0x17b)],_0x1a57e1['to']);try{const _0x3b980c=await _0x221666[_0x2cf6cf(0x170)](_0x4b0e30);if(_0x3b980c&&_0x3b980c[_0x2cf6cf(0x176)]!==null&&_0x3b980c[_0x2cf6cf(0x176)]!==undefined){let _0x40f9da=Number(_0x3b980c[_0x2cf6cf(0x176)]);if(typeof _0x40f9da===_0x2cf6cf(0x17c)){if(_0x40f9da<=1.05&&_0x1a57e1['to']['includes']('LEVEL'))_0x40f9da=_0x40f9da*0x64;_0x4f1ed3=Math[_0x2cf6cf(0x17f)](_0x40f9da),_0x357ff1=!![];break;}}}catch(_0x338c7c){}}}}const _0x3eccf0=await _0x221666[_0x2cf6cf(0x1ac)](_0x2cf6cf(0x199));let _0x25c586=[];if(_0x3eccf0&&_0x3eccf0[_0x2cf6cf(0x176)])try{_0x25c586=JSON[_0x2cf6cf(0x18b)](_0x3eccf0[_0x2cf6cf(0x176)]);}catch(_0x31c7a9){}_0x25c586[_0x2cf6cf(0x1aa)]({'ts':Date[_0x2cf6cf(0x165)](),'room':_0x41f50c||'Unknown','t_in':_0xb5a017,'t_out':_0x30004d,'valve':_0x4f1ed3});if(_0x25c586[_0x2cf6cf(0x1ad)]>THERMO_LOG_SIZE)_0x25c586[_0x2cf6cf(0x184)]();await _0x221666[_0x2cf6cf(0x185)](_0x2cf6cf(0x199),{'val':JSON['stringify'](_0x25c586),'ack':!![]});}async function saveCompletedSequence(_0x1cef89){const _0x5f352c=a5_0x2a46;try{const _0x128d69=await _0x1cef89['getStateAsync'](_0x5f352c(0x16b));let _0x215d6b=[];if(_0x128d69&&_0x128d69[_0x5f352c(0x176)])try{_0x215d6b=JSON[_0x5f352c(0x18b)](_0x128d69[_0x5f352c(0x176)]);}catch(_0x419506){}const _0x41e4fb=activeSequence[0x0]['ts'],_0x511f33=activeSequence['map'](_0x38abc9=>({'loc':_0x38abc9[_0x5f352c(0x1a3)],'t_delta':Math[_0x5f352c(0x17f)]((_0x38abc9['ts']-_0x41e4fb)/0x3e8)})),_0x25c6c5={'timestamp':new Date(_0x41e4fb)[_0x5f352c(0x14a)](),'steps':_0x511f33,'duration':Math[_0x5f352c(0x17f)]((activeSequence[activeSequence[_0x5f352c(0x1ad)]-0x1]['ts']-_0x41e4fb)/0x3e8),'daytime':new Date(_0x41e4fb)['getHours']()};_0x215d6b[_0x5f352c(0x1aa)](_0x25c6c5);if(_0x215d6b['length']>MAX_TRAINING_SET_SIZE)_0x215d6b[_0x5f352c(0x184)]();await _0x1cef89[_0x5f352c(0x185)]('LTM.trainingData.sequences',{'val':JSON[_0x5f352c(0x16e)](_0x215d6b),'ack':!![]}),_0x1cef89['isProVersion']&&_0x1cef89[_0x5f352c(0x158)]&&_0x1cef89[_0x5f352c(0x158)]('ANALYZE_SEQUENCE',{'sequence':_0x25c6c5});}catch(_0x4cb1a0){_0x1cef89[_0x5f352c(0x164)][_0x5f352c(0x14f)](_0x5f352c(0x18d)+_0x4cb1a0[_0x5f352c(0x182)]);}}async function recordSequence(_0x4e718a,_0x4540eb){const _0x127dac=a5_0x2a46,_0x124c8d=(_0x4540eb['type']||'')[_0x127dac(0x1af)](),_0x517c48=[_0x127dac(0x168),_0x127dac(0x18a),'pr채senz','presence',_0x127dac(0x192),_0x127dac(0x167),'t체r','window',_0x127dac(0x197),_0x127dac(0x18f),_0x127dac(0x1a2),_0x127dac(0x160),'licht',_0x127dac(0x187),_0x127dac(0x152),_0x127dac(0x177),_0x127dac(0x1a5)];if(!_0x517c48[_0x127dac(0x19d)](_0x29e585=>_0x124c8d[_0x127dac(0x179)](_0x29e585)))return;if(!_0x4540eb[_0x127dac(0x15c)])return;if(sequenceTimer)clearTimeout(sequenceTimer);activeSequence[_0x127dac(0x1aa)]({'loc':_0x4540eb[_0x127dac(0x161)]||'Unknown','id':_0x4540eb['id'],'ts':Date[_0x127dac(0x165)]()}),sequenceTimer=setTimeout(async()=>{if(activeSequence['length']>0x1)await saveCompletedSequence(_0x4e718a);activeSequence=[];},SEQUENCE_TIMEOUT_MS);}function startExitTimer(_0x5d28cb){const _0x5bc6b9=a5_0x2a46;abortExitTimer(_0x5d28cb),_0x5d28cb[_0x5bc6b9(0x153)]=!![],_0x5d28cb[_0x5bc6b9(0x15b)]=setTimeout(()=>{const _0x1f75f4=_0x5bc6b9;_0x5d28cb[_0x1f75f4(0x153)]=![];},EXIT_GRACE_PERIOD_SECONDS*0x3e8),_0x5d28cb[_0x5bc6b9(0x15d)]=setTimeout(()=>{const _0x4d9a96=_0x5bc6b9;setPresence(_0x5d28cb,![]),_0x5d28cb[_0x4d9a96(0x15d)]=null;},EXIT_TIMER_MINUTES*0x3c*0x3e8);}function abortExitTimer(_0x30e48c){const _0x209b51=a5_0x2a46;if(_0x30e48c[_0x209b51(0x15d)])clearTimeout(_0x30e48c[_0x209b51(0x15d)]);if(_0x30e48c['exitGraceTimer'])clearTimeout(_0x30e48c[_0x209b51(0x15b)]);_0x30e48c[_0x209b51(0x15d)]=null,_0x30e48c[_0x209b51(0x15b)]=null,_0x30e48c[_0x209b51(0x153)]=![];}async function setPresence(_0x4dd957,_0x3fb0c3){const _0x22bcfd=a5_0x2a46;if(_0x4dd957['isPresent']===_0x3fb0c3)return;_0x4dd957['isPresent']=_0x3fb0c3,await _0x4dd957[_0x22bcfd(0x185)](_0x22bcfd(0x1a0),{'val':_0x3fb0c3,'ack':!![]});}function a5_0x2a46(_0x6518cc,_0x44ae01){const _0x1eff71=a5_0x12ed();return a5_0x2a46=function(_0x34126b,_0x238a16){_0x34126b=_0x34126b-0x14a;let _0x12ed8c=_0x1eff71[_0x34126b];return _0x12ed8c;},a5_0x2a46(_0x6518cc,_0x44ae01);}async function processSensorEvent(_0x49f954,_0x16c937,_0x42c4fb,_0x2ee1a3){const _0x48729e=a5_0x2a46;if(!_0x2ee1a3)return null;const _0x3ac9c8=_0x42c4fb[_0x48729e(0x176)],_0x225eae=Date[_0x48729e(0x165)](),_0x2564e9=_0x49f954[_0x48729e(0x18c)][_0x16c937],_0x33b148=(_0x2ee1a3['type']||'')[_0x48729e(0x1af)](),_0x21a866=_0x33b148['includes'](_0x48729e(0x159))||_0x33b148[_0x48729e(0x179)]('temperatur')||_0x33b148[_0x48729e(0x179)](_0x48729e(0x1a7))||_0x33b148[_0x48729e(0x179)](_0x48729e(0x190))||_0x33b148['includes']('thermostat');if(_0x21a866&&typeof _0x3ac9c8==='number'){if(_0x3ac9c8>0x50||_0x3ac9c8<-0x32)return _0x49f954[_0x48729e(0x164)][_0x48729e(0x156)](_0x48729e(0x16a)+_0x3ac9c8+_0x48729e(0x15f)+_0x16c937),null;}_0x49f954[_0x48729e(0x18c)][_0x16c937]=_0x3ac9c8;if(!_0x2ee1a3[_0x48729e(0x195)]&&_0x2564e9!=undefined&&_0x2564e9==_0x3ac9c8)return null;_0x49f954[_0x48729e(0x181)]&&_0x21a866&&recordThermodynamics(_0x49f954,_0x16c937,_0x3ac9c8,_0x2ee1a3[_0x48729e(0x161)]);const _0x401b68={'timestamp':_0x225eae,'id':_0x16c937,'name':_0x2ee1a3[_0x48729e(0x14b)],'type':_0x2ee1a3[_0x48729e(0x151)],'location':_0x2ee1a3['location'],'value':_0x3ac9c8};_0x49f954[_0x48729e(0x15e)]['unshift'](_0x401b68);if(_0x49f954[_0x48729e(0x15e)][_0x48729e(0x1ad)]>HISTORY_MAX_SIZE)_0x49f954[_0x48729e(0x15e)][_0x48729e(0x186)]();await _0x49f954[_0x48729e(0x185)]('events.lastEvent',{'val':JSON[_0x48729e(0x16e)](_0x401b68),'ack':!![]}),await _0x49f954['setStateAsync'](_0x48729e(0x198),{'val':JSON[_0x48729e(0x16e)](_0x49f954[_0x48729e(0x15e)]),'ack':!![]});if(_0x49f954[_0x48729e(0x181)]){_0x49f954[_0x48729e(0x194)][_0x48729e(0x1aa)](_0x401b68);if(_0x49f954['rawEventLog']['length']>RAW_LOG_MAX_SIZE)_0x49f954['rawEventLog'][_0x48729e(0x19c)](0x0,_0x49f954['rawEventLog'][_0x48729e(0x1ad)]-RAW_LOG_MAX_SIZE);await _0x49f954['setStateAsync'](_0x48729e(0x175),{'val':JSON['stringify'](_0x49f954[_0x48729e(0x194)]),'ack':!![]}),recordSequence(_0x49f954,_0x401b68);}if(_0x2ee1a3['isExit']&&_0x3ac9c8===!![]){if(_0x49f954[_0x48729e(0x16c)]&&!_0x49f954['isGracePeriodActive'])startExitTimer(_0x49f954);else{if(!_0x49f954[_0x48729e(0x16c)])setPresence(_0x49f954,!![]);}}else{if(_0x2ee1a3[_0x48729e(0x151)]===_0x48729e(0x168)&&_0x3ac9c8===!![]){if(_0x49f954[_0x48729e(0x15d)])abortExitTimer(_0x49f954);if(!_0x49f954['isPresent']&&_0x49f954['currentSystemMode']===_0x48729e(0x157))setPresence(_0x49f954,!![]);}}if(_0x49f954[_0x48729e(0x181)]&&_0x49f954['sendToPythonWrapper']){_0x2ee1a3['type']===_0x48729e(0x168)&&_0x3ac9c8===!![]&&_0x2ee1a3[_0x48729e(0x161)]&&_0x49f954[_0x48729e(0x158)]('SIMULATE_SIGNAL',{'room':_0x2ee1a3[_0x48729e(0x161)]});const _0x36b395=['door',_0x48729e(0x17d),_0x48729e(0x189),_0x48729e(0x197),'griff','handle',_0x48729e(0x173),_0x48729e(0x174)][_0x48729e(0x19d)](_0x47c41f=>_0x33b148[_0x48729e(0x179)](_0x47c41f)),_0x31285e=[_0x48729e(0x160),_0x48729e(0x1ae),_0x48729e(0x187),_0x48729e(0x152),_0x48729e(0x177),'lampe'][_0x48729e(0x19d)](_0x56703f=>_0x33b148['includes'](_0x56703f)),_0x2d42b5=[_0x48729e(0x168),_0x48729e(0x18a),_0x48729e(0x1b2),_0x48729e(0x18e),_0x48729e(0x192)][_0x48729e(0x19d)](_0x2a47b5=>_0x33b148['includes'](_0x2a47b5));if(_0x2ee1a3[_0x48729e(0x161)]&&(_0x36b395||_0x31285e||_0x2d42b5)){const _0x1041d2=_0x3ac9c8===!![]||typeof _0x3ac9c8===_0x48729e(0x17c)&&_0x3ac9c8>0x0,_0x4e57a5=_0x36b395&&!_0x1041d2&&_0x2564e9!==undefined&&_0x2564e9!=_0x3ac9c8;if(_0x1041d2||_0x4e57a5){const _0x17b03f=_0x49f954['lastTrackerEventTime']||_0x225eae,_0x31c773=(_0x225eae-_0x17b03f)/0x3e8;_0x49f954['lastTrackerEventTime']=_0x225eae,_0x49f954[_0x48729e(0x158)](_0x48729e(0x14c),{'room':_0x2ee1a3[_0x48729e(0x161)],'dt':_0x31c773});}}}return _0x401b68;}module[a5_0x199071(0x180)]={'processSensorEvent':processSensorEvent,'getOutsideTemperatureNumeric':getOutsideTemperatureNumeric,'setPresence':setPresence,'abortExitTimer':abortExitTimer,'startExitTimer':startExitTimer};