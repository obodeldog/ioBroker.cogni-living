(function(_0x2ade1b,_0x5be791){const _0x3778d6=a5_0x5acc,_0x15d213=_0x2ade1b();while(!![]){try{const _0x3610e7=-parseInt(_0x3778d6(0x1d5))/0x1+-parseInt(_0x3778d6(0x17c))/0x2+parseInt(_0x3778d6(0x1de))/0x3+-parseInt(_0x3778d6(0x191))/0x4*(parseInt(_0x3778d6(0x19b))/0x5)+-parseInt(_0x3778d6(0x19a))/0x6+parseInt(_0x3778d6(0x189))/0x7+parseInt(_0x3778d6(0x1b1))/0x8;if(_0x3610e7===_0x5be791)break;else _0x15d213['push'](_0x15d213['shift']());}catch(_0x54e3d6){_0x15d213['push'](_0x15d213['shift']());}}}(a5_0x20e2,0x28410));const a5_0xd0ed0e=(function(){let _0x1b94de=!![];return function(_0x43556c,_0x4e4936){const _0x2dc6de=_0x1b94de?function(){if(_0x4e4936){const _0x22748d=_0x4e4936['apply'](_0x43556c,arguments);return _0x4e4936=null,_0x22748d;}}:function(){};return _0x1b94de=![],_0x2dc6de;};}()),a5_0x12be8a=a5_0xd0ed0e(this,function(){const _0x45af85=a5_0x5acc;return a5_0x12be8a['toString']()[_0x45af85(0x186)]('(((.+)+)+)+$')[_0x45af85(0x17f)]()[_0x45af85(0x1c8)](a5_0x12be8a)[_0x45af85(0x186)](_0x45af85(0x1ce));});function a5_0x5acc(_0x486dbe,_0x1ee94a){const _0x533bcd=a5_0x20e2();return a5_0x5acc=function(_0x12be8a,_0xd0ed0e){_0x12be8a=_0x12be8a-0x178;let _0x20e2ef=_0x533bcd[_0x12be8a];return _0x20e2ef;},a5_0x5acc(_0x486dbe,_0x1ee94a);}a5_0x12be8a();'use strict';const HISTORY_MAX_SIZE=0x32,RAW_LOG_MAX_SIZE=0x9c4,THERMO_LOG_SIZE=0x3e8,SEQUENCE_TIMEOUT_MS=0x5*0x3c*0x3e8,MAX_TRAINING_SET_SIZE=0x1f4,EXIT_TIMER_MINUTES=0xf,EXIT_GRACE_PERIOD_SECONDS=0x1e;let activeSequence=[],sequenceTimer=null;async function getOutsideTemperatureNumeric(_0xf535f0){const _0x3ae37a=a5_0x5acc;if(_0xf535f0[_0x3ae37a(0x1d7)][_0x3ae37a(0x183)])try{const _0x393153=await _0xf535f0[_0x3ae37a(0x18d)](_0xf535f0[_0x3ae37a(0x1d7)][_0x3ae37a(0x183)]);if(_0x393153&&_0x393153[_0x3ae37a(0x198)]!==undefined&&_0x393153[_0x3ae37a(0x198)]!==null)return parseFloat(_0x393153['val']);}catch(_0x5e1f34){}const _0x2c7e27=_0xf535f0[_0x3ae37a(0x1d7)][_0x3ae37a(0x1cd)];if(!_0xf535f0[_0x3ae37a(0x1d7)][_0x3ae37a(0x1cb)]||!_0x2c7e27)return null;try{let _0x2db146='';if(_0x2c7e27['includes'](_0x3ae37a(0x17b)))_0x2db146=_0x2c7e27+_0x3ae37a(0x1b2);else{if(_0x2c7e27['includes'](_0x3ae37a(0x1a0)))_0x2db146=_0x2c7e27+_0x3ae37a(0x1d2);else{if(_0x2c7e27[_0x3ae37a(0x1c5)]('openweathermap'))_0x2db146=_0x2c7e27+_0x3ae37a(0x1cf);else{if(_0x2c7e27['includes']('weatherunderground'))_0x2db146=_0x2c7e27+_0x3ae37a(0x194);}}}if(_0x2db146){const _0x1a3038=await _0xf535f0[_0x3ae37a(0x18d)](_0x2db146);if(_0x1a3038&&_0x1a3038[_0x3ae37a(0x198)]!==undefined&&_0x1a3038['val']!==null)return parseFloat(_0x1a3038[_0x3ae37a(0x198)]);}}catch(_0x1fbbfe){}return null;}async function recordThermodynamics(_0xa045d1,_0x5e6ee7,_0x1eefb4,_0x41d8be){const _0x4b4840=a5_0x5acc,_0x2f587f=await getOutsideTemperatureNumeric(_0xa045d1);if(_0x2f587f===null)return;let _0xfeea62=0x0,_0x31fb5f=![];if(_0xa045d1[_0x4b4840(0x1d7)][_0x4b4840(0x1a9)])try{let _0x131844=_0xa045d1[_0x4b4840(0x1d7)][_0x4b4840(0x1a9)];if(typeof _0x131844===_0x4b4840(0x1d0))_0x131844=JSON[_0x4b4840(0x1ab)](_0x131844);if(_0x131844[_0x5e6ee7]){const _0xf93b45=_0x131844[_0x5e6ee7],_0x23ca6b=await _0xa045d1[_0x4b4840(0x18d)](_0xf93b45);if(_0x23ca6b&&_0x23ca6b[_0x4b4840(0x198)]!==null&&_0x23ca6b[_0x4b4840(0x198)]!==undefined){let _0x4766a5=Number(_0x23ca6b['val']);if(_0x4766a5<=1.05&&!_0xf93b45[_0x4b4840(0x1c5)]('STATUS')&&!_0xf93b45[_0x4b4840(0x1c5)](_0x4b4840(0x190)))_0x4766a5=_0x4766a5*0x64;_0xfeea62=Math['round'](_0x4766a5),_0x31fb5f=!![];}}}catch(_0x463374){}if(!_0x31fb5f){const _0x15bafc=[{'from':_0x4b4840(0x1c2),'to':'.1.LEVEL'},{'from':_0x4b4840(0x1c2),'to':_0x4b4840(0x1b9)},{'from':'.1.TEMPERATURE','to':'.4.VALVE_STATE'},{'from':_0x4b4840(0x187),'to':'.LEVEL'},{'from':'temperature','to':'level'},{'from':_0x4b4840(0x18f),'to':'Valve'}];for(const _0x341ff3 of _0x15bafc){if(_0x5e6ee7[_0x4b4840(0x1c5)](_0x341ff3[_0x4b4840(0x17a)])){const _0x5ce462=_0x5e6ee7[_0x4b4840(0x1a6)](_0x341ff3[_0x4b4840(0x17a)],_0x341ff3['to']);try{const _0x411391=await _0xa045d1[_0x4b4840(0x18d)](_0x5ce462);if(_0x411391&&_0x411391[_0x4b4840(0x198)]!==null&&_0x411391['val']!==undefined){let _0x42a595=Number(_0x411391[_0x4b4840(0x198)]);if(typeof _0x42a595===_0x4b4840(0x19e)){if(_0x42a595<=1.05&&_0x341ff3['to'][_0x4b4840(0x1c5)](_0x4b4840(0x1d1)))_0x42a595=_0x42a595*0x64;_0xfeea62=Math['round'](_0x42a595),_0x31fb5f=!![];break;}}}catch(_0xbc89f7){}}}}const _0x45458f=await _0xa045d1[_0x4b4840(0x1a7)](_0x4b4840(0x1d8));let _0x256bf6=[];if(_0x45458f&&_0x45458f['val'])try{_0x256bf6=JSON[_0x4b4840(0x1ab)](_0x45458f[_0x4b4840(0x198)]);}catch(_0x16d466){}_0x256bf6['push']({'ts':Date['now'](),'room':_0x41d8be||_0x4b4840(0x17d),'t_in':_0x1eefb4,'t_out':_0x2f587f,'valve':_0xfeea62});if(_0x256bf6[_0x4b4840(0x19c)]>THERMO_LOG_SIZE)_0x256bf6[_0x4b4840(0x1ba)]();await _0xa045d1[_0x4b4840(0x1b6)](_0x4b4840(0x1d8),{'val':JSON[_0x4b4840(0x1d3)](_0x256bf6),'ack':!![]});}async function saveCompletedSequence(_0x38211e){const _0x6e36b3=a5_0x5acc;try{const _0x7e0be2=await _0x38211e['getStateAsync'](_0x6e36b3(0x196));let _0x1ccb2d=[];if(_0x7e0be2&&_0x7e0be2['val'])try{_0x1ccb2d=JSON[_0x6e36b3(0x1ab)](_0x7e0be2[_0x6e36b3(0x198)]);}catch(_0x2bacef){}const _0x532a6b=activeSequence[0x0]['ts'],_0x239dfb=activeSequence[_0x6e36b3(0x1ca)](_0x5a8fd1=>({'loc':_0x5a8fd1[_0x6e36b3(0x18b)],'t_delta':Math[_0x6e36b3(0x1be)]((_0x5a8fd1['ts']-_0x532a6b)/0x3e8)})),_0x2624a4={'timestamp':new Date(_0x532a6b)['toISOString'](),'steps':_0x239dfb,'duration':Math[_0x6e36b3(0x1be)]((activeSequence[activeSequence[_0x6e36b3(0x19c)]-0x1]['ts']-_0x532a6b)/0x3e8),'daytime':new Date(_0x532a6b)['getHours']()};_0x1ccb2d[_0x6e36b3(0x17e)](_0x2624a4);if(_0x1ccb2d[_0x6e36b3(0x19c)]>MAX_TRAINING_SET_SIZE)_0x1ccb2d[_0x6e36b3(0x1ba)]();await _0x38211e[_0x6e36b3(0x1b6)]('LTM.trainingData.sequences',{'val':JSON[_0x6e36b3(0x1d3)](_0x1ccb2d),'ack':!![]}),_0x38211e[_0x6e36b3(0x199)]&&_0x38211e[_0x6e36b3(0x193)]&&_0x38211e[_0x6e36b3(0x193)](_0x6e36b3(0x1c7),{'sequence':_0x2624a4});}catch(_0x49b452){_0x38211e['log'][_0x6e36b3(0x1b0)](_0x6e36b3(0x1dd)+_0x49b452[_0x6e36b3(0x1d4)]);}}async function recordSequence(_0xc293,_0x12920d){const _0x2f9c07=a5_0x5acc,_0x431906=(_0x12920d['type']||'')['toLowerCase'](),_0x19b34b=[_0x2f9c07(0x1c1),'bewegung','pr채senz',_0x2f9c07(0x1a1),_0x2f9c07(0x1c6),_0x2f9c07(0x1bd),'t체r',_0x2f9c07(0x1ac),_0x2f9c07(0x1ad),_0x2f9c07(0x1da),_0x2f9c07(0x1c3),_0x2f9c07(0x1aa),_0x2f9c07(0x1a2),_0x2f9c07(0x181),_0x2f9c07(0x1dc),_0x2f9c07(0x1c0),_0x2f9c07(0x192)];if(!_0x19b34b[_0x2f9c07(0x1b8)](_0x465322=>_0x431906[_0x2f9c07(0x1c5)](_0x465322)))return;if(!_0x12920d[_0x2f9c07(0x1a8)])return;if(sequenceTimer)clearTimeout(sequenceTimer);activeSequence[_0x2f9c07(0x17e)]({'loc':_0x12920d[_0x2f9c07(0x1b4)]||'Unknown','id':_0x12920d['id'],'ts':Date[_0x2f9c07(0x1bf)]()}),sequenceTimer=setTimeout(async()=>{const _0x133635=_0x2f9c07;if(activeSequence[_0x133635(0x19c)]>0x1)await saveCompletedSequence(_0xc293);activeSequence=[];},SEQUENCE_TIMEOUT_MS);}function startExitTimer(_0x549a65){const _0x3a5680=a5_0x5acc;abortExitTimer(_0x549a65),_0x549a65[_0x3a5680(0x184)]=!![],_0x549a65[_0x3a5680(0x1b7)]=setTimeout(()=>{const _0xa19c00=_0x3a5680;_0x549a65[_0xa19c00(0x184)]=![];},EXIT_GRACE_PERIOD_SECONDS*0x3e8),_0x549a65[_0x3a5680(0x1b3)]=setTimeout(()=>{const _0x9b9d02=_0x3a5680;setPresence(_0x549a65,![]),_0x549a65[_0x9b9d02(0x1b3)]=null;},EXIT_TIMER_MINUTES*0x3c*0x3e8);}function abortExitTimer(_0x529783){const _0x559bc8=a5_0x5acc;if(_0x529783['exitTimer'])clearTimeout(_0x529783[_0x559bc8(0x1b3)]);if(_0x529783[_0x559bc8(0x1b7)])clearTimeout(_0x529783[_0x559bc8(0x1b7)]);_0x529783[_0x559bc8(0x1b3)]=null,_0x529783['exitGraceTimer']=null,_0x529783['isGracePeriodActive']=![];}function a5_0x20e2(){const _0x5163d5=['sensorLastValues','eventHistory','replace','getStateAsync','value','valveMapping','light','parse','window','fenster','pr채senz','lastTrackerEventTime','error','4707168JfnKOn','.Current.Temperature','exitTimer','location','log','setStateAsync','exitGraceTimer','some','.1.VALVE_STATE','shift','unshift','klima','door','round','now','dimmer','motion','.1.ACTUAL_TEMPERATURE','kontakt','events.history','includes','occupancy','ANALYZE_SEQUENCE','constructor','LTM.rawEventLog','map','useWeather','schloss','weatherInstance','(((.+)+)+)+$','.forecast.current.temperature','string','LEVEL','.NextHours.Location_1.Day_1.current.temp_value','stringify','message','296937vgAfTe','[RECORDER]\x20Ignored\x20implausible\x20temperature:\x20','config','LTM.trainingData.thermodynamics','type','contact','thermostat','schalter','[RECORDER]\x20Error:\x20','58659UGKHMj','events.lastEvent','lock','from','accuweather','419778PbctsE','Unknown','push','toString','pop','switch','temperature','outdoorSensorId','isGracePeriodActive','currentSystemMode','search','.ACTUAL_TEMPERATURE','system.isPresent','2098971RWjrdo','heizung','loc','splice','getForeignStateAsync','rawEventLog','Temperature','STATE','4ZNqxBC','lampe','sendToPythonWrapper','.forecast.current.temp','logDuplicates','LTM.trainingData.sequences','handle','val','isProVersion','1150668WYBZpR','221590Wlpkeb','length','toLowerCase','number','isPresent','daswetter','presence','licht','griff'];a5_0x20e2=function(){return _0x5163d5;};return a5_0x20e2();}async function setPresence(_0x221b14,_0x351089){const _0x27ddc6=a5_0x5acc;if(_0x221b14[_0x27ddc6(0x19f)]===_0x351089)return;_0x221b14[_0x27ddc6(0x19f)]=_0x351089,await _0x221b14[_0x27ddc6(0x1b6)](_0x27ddc6(0x188),{'val':_0x351089,'ack':!![]});}async function processSensorEvent(_0x1f5520,_0x432b83,_0x45d384,_0x30d0db){const _0x18493d=a5_0x5acc;if(!_0x30d0db)return null;const _0x1be403=_0x45d384['val'],_0x44f425=Date[_0x18493d(0x1bf)](),_0x15ca19=_0x1f5520[_0x18493d(0x1a4)][_0x432b83],_0x46e7dd=(_0x30d0db[_0x18493d(0x1d9)]||'')[_0x18493d(0x19d)](),_0x29fcdc=_0x46e7dd['includes'](_0x18493d(0x182))||_0x46e7dd[_0x18493d(0x1c5)]('temperatur')||_0x46e7dd[_0x18493d(0x1c5)](_0x18493d(0x1bc))||_0x46e7dd[_0x18493d(0x1c5)](_0x18493d(0x18a))||_0x46e7dd[_0x18493d(0x1c5)](_0x18493d(0x1db));if(_0x29fcdc&&typeof _0x1be403===_0x18493d(0x19e)){if(_0x1be403>0x50||_0x1be403<-0x32)return _0x1f5520[_0x18493d(0x1b5)]['debug'](_0x18493d(0x1d6)+_0x1be403+'\x20from\x20'+_0x432b83),null;}_0x1f5520[_0x18493d(0x1a4)][_0x432b83]=_0x1be403;if(!_0x30d0db[_0x18493d(0x195)]&&_0x15ca19!=undefined&&_0x15ca19==_0x1be403)return null;_0x1f5520[_0x18493d(0x199)]&&_0x29fcdc&&recordThermodynamics(_0x1f5520,_0x432b83,_0x1be403,_0x30d0db[_0x18493d(0x1b4)]);const _0x21a7c5={'timestamp':_0x44f425,'id':_0x432b83,'name':_0x30d0db['name'],'type':_0x30d0db[_0x18493d(0x1d9)],'location':_0x30d0db[_0x18493d(0x1b4)],'value':_0x1be403};_0x1f5520[_0x18493d(0x1a5)][_0x18493d(0x1bb)](_0x21a7c5);if(_0x1f5520[_0x18493d(0x1a5)][_0x18493d(0x19c)]>HISTORY_MAX_SIZE)_0x1f5520['eventHistory'][_0x18493d(0x180)]();await _0x1f5520['setStateAsync'](_0x18493d(0x178),{'val':JSON[_0x18493d(0x1d3)](_0x21a7c5),'ack':!![]}),await _0x1f5520[_0x18493d(0x1b6)](_0x18493d(0x1c4),{'val':JSON[_0x18493d(0x1d3)](_0x1f5520[_0x18493d(0x1a5)]),'ack':!![]});if(_0x1f5520[_0x18493d(0x199)]){_0x1f5520[_0x18493d(0x18e)][_0x18493d(0x17e)](_0x21a7c5);if(_0x1f5520[_0x18493d(0x18e)]['length']>RAW_LOG_MAX_SIZE)_0x1f5520[_0x18493d(0x18e)][_0x18493d(0x18c)](0x0,_0x1f5520[_0x18493d(0x18e)][_0x18493d(0x19c)]-RAW_LOG_MAX_SIZE);await _0x1f5520[_0x18493d(0x1b6)](_0x18493d(0x1c9),{'val':JSON[_0x18493d(0x1d3)](_0x1f5520[_0x18493d(0x18e)]),'ack':!![]}),recordSequence(_0x1f5520,_0x21a7c5);}if(_0x30d0db['isExit']&&_0x1be403===!![]){if(_0x1f5520[_0x18493d(0x19f)]&&!_0x1f5520['isGracePeriodActive'])startExitTimer(_0x1f5520);else{if(!_0x1f5520['isPresent'])setPresence(_0x1f5520,!![]);}}else{if(_0x30d0db['type']===_0x18493d(0x1c1)&&_0x1be403===!![]){if(_0x1f5520[_0x18493d(0x1b3)])abortExitTimer(_0x1f5520);if(!_0x1f5520[_0x18493d(0x19f)]&&_0x1f5520[_0x18493d(0x185)]==='normal')setPresence(_0x1f5520,!![]);}}if(_0x1f5520['isProVersion']&&_0x1f5520['sendToPythonWrapper']){_0x30d0db['type']==='motion'&&_0x1be403===!![]&&_0x30d0db[_0x18493d(0x1b4)]&&_0x1f5520[_0x18493d(0x193)]('SIMULATE_SIGNAL',{'room':_0x30d0db[_0x18493d(0x1b4)]});const _0x422379=[_0x18493d(0x1bd),'t체r','window',_0x18493d(0x1ad),_0x18493d(0x1a3),_0x18493d(0x197),_0x18493d(0x179),_0x18493d(0x1cc)][_0x18493d(0x1b8)](_0x5b906f=>_0x46e7dd[_0x18493d(0x1c5)](_0x5b906f)),_0x501812=[_0x18493d(0x1aa),_0x18493d(0x1a2),_0x18493d(0x181),_0x18493d(0x1dc),_0x18493d(0x1c0),'lampe'][_0x18493d(0x1b8)](_0x28b306=>_0x46e7dd[_0x18493d(0x1c5)](_0x28b306)),_0x20f1e8=[_0x18493d(0x1c1),'bewegung',_0x18493d(0x1ae),_0x18493d(0x1a1),'occupancy']['some'](_0x20b486=>_0x46e7dd[_0x18493d(0x1c5)](_0x20b486));if(_0x30d0db[_0x18493d(0x1b4)]&&(_0x422379||_0x501812||_0x20f1e8)){const _0x2da38c=_0x1be403===!![]||typeof _0x1be403===_0x18493d(0x19e)&&_0x1be403>0x0,_0x1213a0=_0x422379&&!_0x2da38c&&_0x15ca19!==undefined&&_0x15ca19!=_0x1be403;if(_0x2da38c||_0x1213a0){const _0x22c3de=_0x1f5520[_0x18493d(0x1af)]||_0x44f425,_0xf9958a=(_0x44f425-_0x22c3de)/0x3e8;_0x1f5520[_0x18493d(0x1af)]=_0x44f425,_0x1f5520[_0x18493d(0x193)]('TRACK_EVENT',{'room':_0x30d0db[_0x18493d(0x1b4)],'dt':_0xf9958a});}}}return _0x21a7c5;}module['exports']={'processSensorEvent':processSensorEvent,'getOutsideTemperatureNumeric':getOutsideTemperatureNumeric,'setPresence':setPresence,'abortExitTimer':abortExitTimer,'startExitTimer':startExitTimer};