(function(_0x24d21d,_0x1bff81){const _0x1faa76=a5_0x1458,_0x18dc3b=_0x24d21d();while(!![]){try{const _0x19b62d=-parseInt(_0x1faa76(0x1a7))/0x1*(-parseInt(_0x1faa76(0x18d))/0x2)+-parseInt(_0x1faa76(0x1b4))/0x3*(parseInt(_0x1faa76(0x1b8))/0x4)+parseInt(_0x1faa76(0x190))/0x5*(-parseInt(_0x1faa76(0x177))/0x6)+parseInt(_0x1faa76(0x1af))/0x7*(parseInt(_0x1faa76(0x17c))/0x8)+parseInt(_0x1faa76(0x16e))/0x9*(parseInt(_0x1faa76(0x191))/0xa)+-parseInt(_0x1faa76(0x181))/0xb+parseInt(_0x1faa76(0x1ac))/0xc*(parseInt(_0x1faa76(0x174))/0xd);if(_0x19b62d===_0x1bff81)break;else _0x18dc3b['push'](_0x18dc3b['shift']());}catch(_0x57a2b1){_0x18dc3b['push'](_0x18dc3b['shift']());}}}(a5_0x4ba3,0xdb670));const a5_0x56ba06=(function(){let _0x1d59aa=!![];return function(_0x479a67,_0x253fe0){const _0x4009b5=_0x1d59aa?function(){const _0x2e7317=a5_0x1458;if(_0x253fe0){const _0x4e862c=_0x253fe0[_0x2e7317(0x161)](_0x479a67,arguments);return _0x253fe0=null,_0x4e862c;}}:function(){};return _0x1d59aa=![],_0x4009b5;};}()),a5_0x734943=a5_0x56ba06(this,function(){const _0x5c8030=a5_0x1458;return a5_0x734943[_0x5c8030(0x167)]()[_0x5c8030(0x18c)](_0x5c8030(0x1ad))[_0x5c8030(0x167)]()['constructor'](a5_0x734943)['search'](_0x5c8030(0x1ad));});a5_0x734943();'use strict';const HISTORY_MAX_SIZE=0x32,RAW_LOG_MAX_SIZE=0x9c4,THERMO_LOG_SIZE=0x3e8,SEQUENCE_TIMEOUT_MS=0x5*0x3c*0x3e8,MAX_TRAINING_SET_SIZE=0x1f4,EXIT_TIMER_MINUTES=0xf,EXIT_GRACE_PERIOD_SECONDS=0x1e;let activeSequence=[],sequenceTimer=null;async function getOutsideTemperatureNumeric(_0x2e4ed0){const _0x48b14a=a5_0x1458;if(_0x2e4ed0[_0x48b14a(0x1a4)][_0x48b14a(0x19f)])try{const _0x22175d=await _0x2e4ed0['getForeignStateAsync'](_0x2e4ed0[_0x48b14a(0x1a4)]['outdoorSensorId']);if(_0x22175d&&_0x22175d[_0x48b14a(0x17f)]!==undefined&&_0x22175d['val']!==null)return parseFloat(_0x22175d['val']);}catch(_0x9bed81){}const _0xf05a9a=_0x2e4ed0[_0x48b14a(0x1a4)][_0x48b14a(0x178)];if(!_0x2e4ed0[_0x48b14a(0x1a4)]['useWeather']||!_0xf05a9a)return null;try{let _0x343e65='';if(_0xf05a9a[_0x48b14a(0x1b6)]('accuweather'))_0x343e65=_0xf05a9a+'.Current.Temperature';else{if(_0xf05a9a[_0x48b14a(0x1b6)](_0x48b14a(0x1b1)))_0x343e65=_0xf05a9a+_0x48b14a(0x16c);else{if(_0xf05a9a['includes'](_0x48b14a(0x1b7)))_0x343e65=_0xf05a9a+_0x48b14a(0x182);else{if(_0xf05a9a[_0x48b14a(0x1b6)](_0x48b14a(0x172)))_0x343e65=_0xf05a9a+_0x48b14a(0x1a9);}}}if(_0x343e65){const _0x4f36d2=await _0x2e4ed0[_0x48b14a(0x1b2)](_0x343e65);if(_0x4f36d2&&_0x4f36d2[_0x48b14a(0x17f)]!==undefined&&_0x4f36d2[_0x48b14a(0x17f)]!==null)return parseFloat(_0x4f36d2[_0x48b14a(0x17f)]);}}catch(_0x269b8b){}return null;}function a5_0x1458(_0x5d9a26,_0x244f18){const _0xafae8e=a5_0x4ba3();return a5_0x1458=function(_0x734943,_0x56ba06){_0x734943=_0x734943-0x160;let _0x4ba356=_0xafae8e[_0x734943];return _0x4ba356;},a5_0x1458(_0x5d9a26,_0x244f18);}async function recordThermodynamics(_0x4971c7,_0x2197b2,_0x1f523b,_0x5a63f9){const _0x4618b6=a5_0x1458,_0x14b569=await getOutsideTemperatureNumeric(_0x4971c7);let _0x310d18=0x0;if(_0x2197b2[_0x4618b6(0x1b6)](_0x4618b6(0x1ba))){const _0x492436=[{'from':_0x4618b6(0x19d),'to':'.1.LEVEL'},{'from':'.1.ACTUAL_TEMPERATURE','to':_0x4618b6(0x17d)},{'from':_0x4618b6(0x1b5),'to':'.4.VALVE_STATE'},{'from':'.ACTUAL_TEMPERATURE','to':_0x4618b6(0x18b)}];for(const _0x28d339 of _0x492436){if(_0x2197b2[_0x4618b6(0x1b6)](_0x28d339[_0x4618b6(0x193)])){const _0x115dfb=_0x2197b2[_0x4618b6(0x185)](_0x28d339[_0x4618b6(0x193)],_0x28d339['to']);try{const _0x2797f1=await _0x4971c7['getForeignStateAsync'](_0x115dfb);if(_0x2797f1&&_0x2797f1[_0x4618b6(0x17f)]!==null&&_0x2797f1[_0x4618b6(0x17f)]!==undefined){let _0x3a2734=_0x2797f1[_0x4618b6(0x17f)];typeof _0x3a2734===_0x4618b6(0x1b0)&&_0x3a2734<=1.05&&_0x28d339['to'][_0x4618b6(0x1b6)](_0x4618b6(0x16b))&&(_0x3a2734=_0x3a2734*0x64);_0x310d18=Math['round'](_0x3a2734);break;}}catch(_0x8d7907){}}}}const _0x547076=await _0x4971c7['getStateAsync'](_0x4618b6(0x187));let _0x15cbe4=[];if(_0x547076&&_0x547076[_0x4618b6(0x17f)])try{_0x15cbe4=JSON[_0x4618b6(0x1a2)](_0x547076[_0x4618b6(0x17f)]);}catch(_0x299c3c){}_0x15cbe4[_0x4618b6(0x170)]({'ts':Date[_0x4618b6(0x1a5)](),'room':_0x5a63f9||_0x4618b6(0x164),'t_in':_0x1f523b,'t_out':_0x14b569,'valve':_0x310d18});if(_0x15cbe4[_0x4618b6(0x179)]>THERMO_LOG_SIZE)_0x15cbe4[_0x4618b6(0x17a)]();await _0x4971c7[_0x4618b6(0x18a)](_0x4618b6(0x187),{'val':JSON[_0x4618b6(0x198)](_0x15cbe4),'ack':!![]});}async function saveCompletedSequence(_0xf340a){const _0x3526f0=a5_0x1458;try{const _0x15ef2e=await _0xf340a['getStateAsync'](_0x3526f0(0x1a6));let _0x560aca=[];if(_0x15ef2e&&_0x15ef2e[_0x3526f0(0x17f)])try{_0x560aca=JSON[_0x3526f0(0x1a2)](_0x15ef2e[_0x3526f0(0x17f)]);}catch(_0x48ec84){}const _0x5cdba8=activeSequence[0x0]['ts'],_0x560c32=activeSequence[_0x3526f0(0x19e)](_0x2123d9=>({'loc':_0x2123d9[_0x3526f0(0x175)],'t_delta':Math[_0x3526f0(0x16d)]((_0x2123d9['ts']-_0x5cdba8)/0x3e8)})),_0x566f7c={'timestamp':new Date(_0x5cdba8)[_0x3526f0(0x1a0)](),'steps':_0x560c32,'duration':Math['round']((activeSequence[activeSequence[_0x3526f0(0x179)]-0x1]['ts']-_0x5cdba8)/0x3e8),'daytime':new Date(_0x5cdba8)[_0x3526f0(0x183)]()};_0x560aca[_0x3526f0(0x170)](_0x566f7c);if(_0x560aca[_0x3526f0(0x179)]>MAX_TRAINING_SET_SIZE)_0x560aca[_0x3526f0(0x17a)]();await _0xf340a[_0x3526f0(0x18a)](_0x3526f0(0x1a6),{'val':JSON[_0x3526f0(0x198)](_0x560aca),'ack':!![]}),_0xf340a[_0x3526f0(0x186)]&&_0xf340a['sendToPythonWrapper']&&_0xf340a[_0x3526f0(0x1ae)](_0x3526f0(0x163),{'sequence':_0x566f7c});}catch(_0x243640){_0xf340a['log']['error'](_0x3526f0(0x17e)+_0x243640[_0x3526f0(0x168)]);}}async function recordSequence(_0x3f9ec3,_0x2947b8){const _0x12eb5d=a5_0x1458,_0x4cec6e=(_0x2947b8['type']||'')[_0x12eb5d(0x1a8)](),_0x1a0411=['motion',_0x12eb5d(0x173),_0x12eb5d(0x192),_0x12eb5d(0x1ab),'occupancy',_0x12eb5d(0x165),_0x12eb5d(0x199),'window','fenster',_0x12eb5d(0x17b),_0x12eb5d(0x176),_0x12eb5d(0x162),'licht','switch',_0x12eb5d(0x188),_0x12eb5d(0x1a1),_0x12eb5d(0x16f)];if(!_0x1a0411[_0x12eb5d(0x180)](_0x51177b=>_0x4cec6e[_0x12eb5d(0x1b6)](_0x51177b)))return;if(!_0x2947b8[_0x12eb5d(0x169)])return;if(sequenceTimer)clearTimeout(sequenceTimer);activeSequence['push']({'loc':_0x2947b8[_0x12eb5d(0x18e)]||'Unknown','id':_0x2947b8['id'],'ts':Date[_0x12eb5d(0x1a5)]()}),sequenceTimer=setTimeout(async()=>{const _0x4556bb=_0x12eb5d;if(activeSequence[_0x4556bb(0x179)]>0x1)await saveCompletedSequence(_0x3f9ec3);activeSequence=[];},SEQUENCE_TIMEOUT_MS);}function startExitTimer(_0x5d99f3){const _0x297fee=a5_0x1458;abortExitTimer(_0x5d99f3),_0x5d99f3[_0x297fee(0x1bb)]=!![],_0x5d99f3[_0x297fee(0x189)]=setTimeout(()=>{const _0x597316=_0x297fee;_0x5d99f3[_0x597316(0x1bb)]=![];},EXIT_GRACE_PERIOD_SECONDS*0x3e8),_0x5d99f3[_0x297fee(0x196)]=setTimeout(()=>{setPresence(_0x5d99f3,![]),_0x5d99f3['exitTimer']=null;},EXIT_TIMER_MINUTES*0x3c*0x3e8);}function abortExitTimer(_0x2c2a06){const _0x4bc8e2=a5_0x1458;if(_0x2c2a06[_0x4bc8e2(0x196)])clearTimeout(_0x2c2a06[_0x4bc8e2(0x196)]);if(_0x2c2a06[_0x4bc8e2(0x189)])clearTimeout(_0x2c2a06[_0x4bc8e2(0x189)]);_0x2c2a06['exitTimer']=null,_0x2c2a06[_0x4bc8e2(0x189)]=null,_0x2c2a06[_0x4bc8e2(0x1bb)]=![];}async function setPresence(_0x23dd71,_0x253487){const _0x304c32=a5_0x1458;if(_0x23dd71['isPresent']===_0x253487)return;_0x23dd71[_0x304c32(0x195)]=_0x253487,await _0x23dd71['setStateAsync'](_0x304c32(0x1b9),{'val':_0x253487,'ack':!![]});}function a5_0x4ba3(){const _0x555ffc=['temperatur','stringify','tür','logDuplicates','motion','LTM.rawEventLog','.1.ACTUAL_TEMPERATURE','map','outdoorSensorId','toISOString','dimmer','parse','currentSystemMode','config','now','LTM.trainingData.sequences','162413SOlTSD','toLowerCase','.forecast.current.temp','type','presence','480oXhALR','(((.+)+)+)+$','sendToPythonWrapper','7fQtHAr','number','daswetter','getForeignStateAsync','isExit','1769427wBqxsk','.1.TEMPERATURE','includes','openweathermap','4Nzgrlk','system.isPresent','hm-rpc','isGracePeriodActive','SIMULATE_SIGNAL','apply','light','ANALYZE_SEQUENCE','Unknown','door','sensorLastValues','toString','message','value','pop','LEVEL','.NextHours.Location_1.Day_1.current.temp_value','round','18ksIHYQ','lampe','push','eventHistory','weatherunderground','bewegung','523835GLIZrG','loc','kontakt','5908482PlPWYK','weatherInstance','length','shift','contact','848816VlOnJA','.1.VALVE_STATE','[RECORDER]\x20Error:\x20','val','some','9337614khROjz','.forecast.current.temperature','getHours','name','replace','isProVersion','LTM.trainingData.thermodynamics','schalter','exitGraceTimer','setStateAsync','.LEVEL','search','12GPRYFS','location','klima','5GkBuVi','3148610camwdm','präsenz','from','rawEventLog','isPresent','exitTimer'];a5_0x4ba3=function(){return _0x555ffc;};return a5_0x4ba3();}async function processSensorEvent(_0x57ccbc,_0x5e866b,_0x4b06f1,_0x53cfa8){const _0xce5f9e=a5_0x1458;if(!_0x53cfa8)return null;const _0x23f40a=_0x4b06f1[_0xce5f9e(0x17f)],_0x5a0b8d=Date[_0xce5f9e(0x1a5)](),_0x28c330=_0x57ccbc[_0xce5f9e(0x166)][_0x5e866b];_0x57ccbc[_0xce5f9e(0x166)][_0x5e866b]=_0x23f40a;if(!_0x53cfa8[_0xce5f9e(0x19a)]&&_0x28c330!=undefined&&_0x28c330==_0x23f40a)return null;const _0x554432=(_0x53cfa8[_0xce5f9e(0x1aa)]||'')[_0xce5f9e(0x1a8)](),_0x5beb43=_0x554432[_0xce5f9e(0x1b6)]('temperature')||_0x554432[_0xce5f9e(0x1b6)](_0xce5f9e(0x197))||_0x554432[_0xce5f9e(0x1b6)](_0xce5f9e(0x18f))||_0x554432[_0xce5f9e(0x1b6)]('heizung');_0x57ccbc[_0xce5f9e(0x186)]&&_0x5beb43&&recordThermodynamics(_0x57ccbc,_0x5e866b,_0x23f40a,_0x53cfa8[_0xce5f9e(0x18e)]);const _0xf88366={'timestamp':_0x5a0b8d,'id':_0x5e866b,'name':_0x53cfa8[_0xce5f9e(0x184)],'type':_0x53cfa8[_0xce5f9e(0x1aa)],'location':_0x53cfa8[_0xce5f9e(0x18e)],'value':_0x23f40a};_0x57ccbc[_0xce5f9e(0x171)]['unshift'](_0xf88366);if(_0x57ccbc[_0xce5f9e(0x171)][_0xce5f9e(0x179)]>HISTORY_MAX_SIZE)_0x57ccbc[_0xce5f9e(0x171)][_0xce5f9e(0x16a)]();await _0x57ccbc[_0xce5f9e(0x18a)]('events.lastEvent',{'val':JSON[_0xce5f9e(0x198)](_0xf88366),'ack':!![]}),await _0x57ccbc[_0xce5f9e(0x18a)]('events.history',{'val':JSON[_0xce5f9e(0x198)](_0x57ccbc[_0xce5f9e(0x171)]),'ack':!![]});if(_0x57ccbc['isProVersion']){_0x57ccbc[_0xce5f9e(0x194)][_0xce5f9e(0x170)](_0xf88366);if(_0x57ccbc[_0xce5f9e(0x194)][_0xce5f9e(0x179)]>RAW_LOG_MAX_SIZE)_0x57ccbc[_0xce5f9e(0x194)]['splice'](0x0,_0x57ccbc[_0xce5f9e(0x194)][_0xce5f9e(0x179)]-RAW_LOG_MAX_SIZE);await _0x57ccbc[_0xce5f9e(0x18a)](_0xce5f9e(0x19c),{'val':JSON[_0xce5f9e(0x198)](_0x57ccbc['rawEventLog']),'ack':!![]}),recordSequence(_0x57ccbc,_0xf88366);}if(_0x53cfa8[_0xce5f9e(0x1b3)]&&_0x23f40a===!![]){if(_0x57ccbc[_0xce5f9e(0x195)]&&!_0x57ccbc['isGracePeriodActive'])startExitTimer(_0x57ccbc);else{if(!_0x57ccbc[_0xce5f9e(0x195)])setPresence(_0x57ccbc,!![]);}}else{if(_0x53cfa8[_0xce5f9e(0x1aa)]==='motion'&&_0x23f40a===!![]){if(_0x57ccbc[_0xce5f9e(0x196)])abortExitTimer(_0x57ccbc);if(!_0x57ccbc[_0xce5f9e(0x195)]&&_0x57ccbc[_0xce5f9e(0x1a3)]==='normal')setPresence(_0x57ccbc,!![]);}}return _0x57ccbc[_0xce5f9e(0x186)]&&_0x53cfa8['type']===_0xce5f9e(0x19b)&&_0x23f40a===!![]&&_0x53cfa8['location']&&_0x57ccbc['sendToPythonWrapper']&&_0x57ccbc[_0xce5f9e(0x1ae)](_0xce5f9e(0x160),{'room':_0x53cfa8[_0xce5f9e(0x18e)]}),_0xf88366;}module['exports']={'processSensorEvent':processSensorEvent,'getOutsideTemperatureNumeric':getOutsideTemperatureNumeric,'setPresence':setPresence,'abortExitTimer':abortExitTimer,'startExitTimer':startExitTimer};