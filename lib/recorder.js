const a5_0x3ba4df=a5_0x56e3;(function(_0x344d45,_0x146309){const _0x2ff88a=a5_0x56e3,_0x362bfb=_0x344d45();while(!![]){try{const _0x27dac8=-parseInt(_0x2ff88a(0x14a))/0x1+-parseInt(_0x2ff88a(0x13c))/0x2*(parseInt(_0x2ff88a(0x144))/0x3)+-parseInt(_0x2ff88a(0x119))/0x4+parseInt(_0x2ff88a(0x164))/0x5*(parseInt(_0x2ff88a(0x106))/0x6)+-parseInt(_0x2ff88a(0x123))/0x7+parseInt(_0x2ff88a(0x13a))/0x8*(parseInt(_0x2ff88a(0x13f))/0x9)+-parseInt(_0x2ff88a(0x10d))/0xa*(-parseInt(_0x2ff88a(0x165))/0xb);if(_0x27dac8===_0x146309)break;else _0x362bfb['push'](_0x362bfb['shift']());}catch(_0x1c49eb){_0x362bfb['push'](_0x362bfb['shift']());}}}(a5_0x4f66,0x5f7b0));const a5_0x16df6b=(function(){let _0x29146f=!![];return function(_0x16dd8a,_0x582eff){const _0x507dea=_0x29146f?function(){const _0x111fcf=a5_0x56e3;if(_0x582eff){const _0x333edc=_0x582eff[_0x111fcf(0x120)](_0x16dd8a,arguments);return _0x582eff=null,_0x333edc;}}:function(){};return _0x29146f=![],_0x507dea;};}()),a5_0x674e1b=a5_0x16df6b(this,function(){const _0x587980=a5_0x56e3;return a5_0x674e1b['toString']()[_0x587980(0x11e)](_0x587980(0x152))[_0x587980(0x103)]()[_0x587980(0x134)](a5_0x674e1b)[_0x587980(0x11e)](_0x587980(0x152));});a5_0x674e1b();'use strict';const HISTORY_MAX_SIZE=0x32,RAW_LOG_MAX_SIZE=0x9c4,THERMO_LOG_SIZE=0x3e8,SEQUENCE_TIMEOUT_MS=0x5*0x3c*0x3e8,MAX_TRAINING_SET_SIZE=0x1f4,EXIT_TIMER_MINUTES=0xf,EXIT_GRACE_PERIOD_SECONDS=0x1e;let activeSequence=[],sequenceTimer=null;async function getOutsideTemperatureNumeric(_0x41303a){const _0x92056a=a5_0x56e3;if(_0x41303a[_0x92056a(0x111)]['outdoorSensorId'])try{const _0x542ecb=await _0x41303a['getForeignStateAsync'](_0x41303a[_0x92056a(0x111)]['outdoorSensorId']);if(_0x542ecb&&_0x542ecb['val']!==undefined&&_0x542ecb[_0x92056a(0x104)]!==null)return parseFloat(_0x542ecb['val']);}catch(_0x125ebd){}const _0x3373dc=_0x41303a['config'][_0x92056a(0x135)];if(!_0x41303a[_0x92056a(0x111)]['useWeather']||!_0x3373dc)return null;try{let _0x3e7fc1='';if(_0x3373dc['includes']('accuweather'))_0x3e7fc1=_0x3373dc+_0x92056a(0x126);else{if(_0x3373dc['includes'](_0x92056a(0x143)))_0x3e7fc1=_0x3373dc+_0x92056a(0xf8);else{if(_0x3373dc['includes'](_0x92056a(0xfe)))_0x3e7fc1=_0x3373dc+'.forecast.current.temperature';else{if(_0x3373dc[_0x92056a(0x13d)](_0x92056a(0x110)))_0x3e7fc1=_0x3373dc+_0x92056a(0x14c);}}}if(_0x3e7fc1){const _0x170a1b=await _0x41303a['getForeignStateAsync'](_0x3e7fc1);if(_0x170a1b&&_0x170a1b[_0x92056a(0x104)]!==undefined&&_0x170a1b[_0x92056a(0x104)]!==null)return parseFloat(_0x170a1b[_0x92056a(0x104)]);}}catch(_0x3f4e62){}return null;}async function recordThermodynamics(_0x26a48c,_0x3e442b,_0x1c752d,_0x172506){const _0x434a4a=a5_0x56e3,_0x11c9e1=await getOutsideTemperatureNumeric(_0x26a48c);if(_0x11c9e1===null)return;let _0x17dcbb=0x0,_0x4162f5=![];if(_0x26a48c['config'][_0x434a4a(0x102)])try{let _0x46c28b=_0x26a48c[_0x434a4a(0x111)][_0x434a4a(0x102)];if(typeof _0x46c28b===_0x434a4a(0x15c))_0x46c28b=JSON['parse'](_0x46c28b);if(_0x46c28b[_0x3e442b]){const _0x27436f=_0x46c28b[_0x3e442b],_0xb1eab7=await _0x26a48c[_0x434a4a(0x133)](_0x27436f);if(_0xb1eab7&&_0xb1eab7[_0x434a4a(0x104)]!==null&&_0xb1eab7['val']!==undefined){let _0x2125b4=Number(_0xb1eab7[_0x434a4a(0x104)]);if(_0x2125b4<=1.05&&!_0x27436f[_0x434a4a(0x13d)](_0x434a4a(0x101))&&!_0x27436f[_0x434a4a(0x13d)](_0x434a4a(0x10c)))_0x2125b4=_0x2125b4*0x64;_0x17dcbb=Math['round'](_0x2125b4),_0x4162f5=!![];}}}catch(_0x35269e){}if(!_0x4162f5){const _0x40499a=[{'from':_0x434a4a(0x124),'to':_0x434a4a(0x163)},{'from':_0x434a4a(0x124),'to':_0x434a4a(0x118)},{'from':_0x434a4a(0x159),'to':'.4.VALVE_STATE'},{'from':_0x434a4a(0x128),'to':_0x434a4a(0x142)},{'from':_0x434a4a(0x136),'to':'level'},{'from':_0x434a4a(0x158),'to':_0x434a4a(0x13e)}];for(const _0x31b44e of _0x40499a){if(_0x3e442b['includes'](_0x31b44e['from'])){const _0x44ba5a=_0x3e442b[_0x434a4a(0x167)](_0x31b44e['from'],_0x31b44e['to']);try{const _0x1fb4f0=await _0x26a48c[_0x434a4a(0x133)](_0x44ba5a);if(_0x1fb4f0&&_0x1fb4f0[_0x434a4a(0x104)]!==null&&_0x1fb4f0[_0x434a4a(0x104)]!==undefined){let _0x1dc48c=Number(_0x1fb4f0[_0x434a4a(0x104)]);if(typeof _0x1dc48c===_0x434a4a(0x156)){if(_0x1dc48c<=1.05&&_0x31b44e['to']['includes'](_0x434a4a(0x162)))_0x1dc48c=_0x1dc48c*0x64;_0x17dcbb=Math[_0x434a4a(0xfd)](_0x1dc48c),_0x4162f5=!![];break;}}}catch(_0x351b32){}}}}const _0x1395b1=await _0x26a48c[_0x434a4a(0xfa)](_0x434a4a(0x146));let _0x2d06f8=[];if(_0x1395b1&&_0x1395b1['val'])try{_0x2d06f8=JSON[_0x434a4a(0x114)](_0x1395b1['val']);}catch(_0x4f7018){}_0x2d06f8[_0x434a4a(0x137)]({'ts':Date[_0x434a4a(0x122)](),'room':_0x172506||_0x434a4a(0x140),'t_in':_0x1c752d,'t_out':_0x11c9e1,'valve':_0x17dcbb});if(_0x2d06f8[_0x434a4a(0x100)]>THERMO_LOG_SIZE)_0x2d06f8[_0x434a4a(0x108)]();await _0x26a48c[_0x434a4a(0xf9)]('LTM.trainingData.thermodynamics',{'val':JSON[_0x434a4a(0x15f)](_0x2d06f8),'ack':!![]});}async function saveCompletedSequence(_0xa20925){const _0x3bf4c4=a5_0x56e3;try{const _0xc5cbcd=await _0xa20925['getStateAsync'](_0x3bf4c4(0x12b));let _0x3adf99=[];if(_0xc5cbcd&&_0xc5cbcd[_0x3bf4c4(0x104)])try{_0x3adf99=JSON[_0x3bf4c4(0x114)](_0xc5cbcd[_0x3bf4c4(0x104)]);}catch(_0x346cc7){}const _0x390758=activeSequence[0x0]['ts'],_0x10224c=activeSequence[_0x3bf4c4(0x161)](_0x36c4f=>({'loc':_0x36c4f[_0x3bf4c4(0x127)],'t_delta':Math['round']((_0x36c4f['ts']-_0x390758)/0x3e8)})),_0x1eea1b={'timestamp':new Date(_0x390758)['toISOString'](),'steps':_0x10224c,'duration':Math[_0x3bf4c4(0xfd)]((activeSequence[activeSequence['length']-0x1]['ts']-_0x390758)/0x3e8),'daytime':new Date(_0x390758)[_0x3bf4c4(0x10f)]()};_0x3adf99[_0x3bf4c4(0x137)](_0x1eea1b);if(_0x3adf99[_0x3bf4c4(0x100)]>MAX_TRAINING_SET_SIZE)_0x3adf99[_0x3bf4c4(0x108)]();await _0xa20925['setStateAsync']('LTM.trainingData.sequences',{'val':JSON['stringify'](_0x3adf99),'ack':!![]}),_0xa20925[_0x3bf4c4(0x12e)]&&_0xa20925['sendToPythonWrapper']&&_0xa20925[_0x3bf4c4(0x141)]('ANALYZE_SEQUENCE',{'sequence':_0x1eea1b});}catch(_0x56eb5c){_0xa20925[_0x3bf4c4(0x12c)]['error']('[RECORDER]\x20Error:\x20'+_0x56eb5c[_0x3bf4c4(0x149)]);}}async function recordSequence(_0x1a8e59,_0x3ff573){const _0x530396=a5_0x56e3,_0x18ee96=(_0x3ff573['type']||'')[_0x530396(0x13b)](),_0x36f30f=[_0x530396(0x11d),_0x530396(0x11a),_0x530396(0x14e),_0x530396(0x155),_0x530396(0x131),'door',_0x530396(0x157),_0x530396(0x166),_0x530396(0x10e),_0x530396(0x121),_0x530396(0x129),'light',_0x530396(0x112),_0x530396(0x160),'schalter',_0x530396(0x14d),_0x530396(0x14b)];if(!_0x36f30f[_0x530396(0x139)](_0x1a2294=>_0x18ee96[_0x530396(0x13d)](_0x1a2294)))return;if(!_0x3ff573[_0x530396(0x12d)])return;if(sequenceTimer)clearTimeout(sequenceTimer);activeSequence[_0x530396(0x137)]({'loc':_0x3ff573['location']||_0x530396(0x140),'id':_0x3ff573['id'],'ts':Date[_0x530396(0x122)]()}),sequenceTimer=setTimeout(async()=>{const _0x1d1f92=_0x530396;if(activeSequence[_0x1d1f92(0x100)]>0x1)await saveCompletedSequence(_0x1a8e59);activeSequence=[];},SEQUENCE_TIMEOUT_MS);}function a5_0x4f66(){const _0x3f3add=['thermostat','SIMULATE_SIGNAL','.1.VALVE_STATE','421364XjKVMD','bewegung','events.lastEvent','schloss','motion','search','rawEventLog','apply','contact','now','357560TWJjEC','.1.ACTUAL_TEMPERATURE','lock','.Current.Temperature','loc','.ACTUAL_TEMPERATURE','kontakt','sensorLastValues','LTM.trainingData.sequences','log','value','isProVersion','exports','normal','occupancy','location','getForeignStateAsync','constructor','weatherInstance','temperature','push','griff','some','5311888uCuyXK','toLowerCase','1460960cvIXeu','includes','Valve','9PicwoX','Unknown','sendToPythonWrapper','.LEVEL','daswetter','3DsBQJv','currentSystemMode','LTM.trainingData.thermodynamics','light','analysis.health.todayVector','message','319086jpMWPz','lampe','.forecast.current.temp','dimmer','präsenz','isGracePeriodActive','events.history','exitTimer','(((.+)+)+)+$','eventHistory','name','presence','number','tür','Temperature','.1.TEMPERATURE','klima','unshift','string','isPresent','fill','stringify','switch','map','LEVEL','.1.LEVEL','21685XUEmVC','429IbUXJh','window','replace','temperatur','lastTrackerEventTime','.NextHours.Location_1.Day_1.current.temp_value','setStateAsync','getStateAsync','schalter','exitGraceTimer','round','openweathermap','getDate','length','STATUS','valveMapping','toString','val','type','186FMMrSA','pop','shift','LTM.rawEventLog','logDuplicates','handle','STATE','204780xfUPJb','fenster','getHours','weatherunderground','config','licht','debug','parse','heizung'];a5_0x4f66=function(){return _0x3f3add;};return a5_0x4f66();}function startExitTimer(_0x34668d){const _0x47710f=a5_0x56e3;abortExitTimer(_0x34668d),_0x34668d[_0x47710f(0x14f)]=!![],_0x34668d[_0x47710f(0xfc)]=setTimeout(()=>{const _0x1d2c03=_0x47710f;_0x34668d[_0x1d2c03(0x14f)]=![];},EXIT_GRACE_PERIOD_SECONDS*0x3e8),_0x34668d[_0x47710f(0x151)]=setTimeout(()=>{const _0x5c17d9=_0x47710f;setPresence(_0x34668d,![]),_0x34668d[_0x5c17d9(0x151)]=null;},EXIT_TIMER_MINUTES*0x3c*0x3e8);}function abortExitTimer(_0x4c2d39){const _0x25dead=a5_0x56e3;if(_0x4c2d39['exitTimer'])clearTimeout(_0x4c2d39[_0x25dead(0x151)]);if(_0x4c2d39['exitGraceTimer'])clearTimeout(_0x4c2d39[_0x25dead(0xfc)]);_0x4c2d39[_0x25dead(0x151)]=null,_0x4c2d39['exitGraceTimer']=null,_0x4c2d39[_0x25dead(0x14f)]=![];}async function setPresence(_0xcf48fc,_0x3ec84a){const _0x517a3b=a5_0x56e3;if(_0xcf48fc['isPresent']===_0x3ec84a)return;_0xcf48fc[_0x517a3b(0x15d)]=_0x3ec84a,await _0xcf48fc['setStateAsync']('system.isPresent',{'val':_0x3ec84a,'ack':!![]});}async function updateHourlyActivity(_0x4ecf0f){const _0x33b5b6=a5_0x56e3;let _0x466c9f=new Array(0x18)['fill'](0x0),_0x1f1b5a=0x0;try{const _0x2a214b=await _0x4ecf0f[_0x33b5b6(0xfa)]('analysis.health.todayVector');_0x2a214b&&_0x2a214b['val']&&(_0x466c9f=JSON[_0x33b5b6(0x114)](_0x2a214b['val']),_0x1f1b5a=_0x2a214b['ts']);}catch(_0x39ca9d){}const _0x44cd97=new Date(_0x1f1b5a),_0x11a994=new Date();_0x44cd97[_0x33b5b6(0xff)]()!==_0x11a994[_0x33b5b6(0xff)]()&&(_0x466c9f=new Array(0x18)[_0x33b5b6(0x15e)](0x0));const _0x197788=_0x11a994['getHours']();if(_0x466c9f[_0x197788]===undefined)_0x466c9f[_0x197788]=0x0;_0x466c9f[_0x197788]++,await _0x4ecf0f[_0x33b5b6(0xf9)](_0x33b5b6(0x148),{'val':JSON[_0x33b5b6(0x15f)](_0x466c9f),'ack':!![]});}async function processSensorEvent(_0x2952e9,_0x9276e0,_0x9557eb,_0xb94c1){const _0x1c2d8a=a5_0x56e3;if(!_0xb94c1)return null;const _0x5c0622=_0x9557eb[_0x1c2d8a(0x104)],_0x31b198=Date['now'](),_0x513f98=_0x2952e9[_0x1c2d8a(0x12a)][_0x9276e0],_0x524f19=(_0xb94c1['type']||'')[_0x1c2d8a(0x13b)](),_0x5193d0=_0x524f19[_0x1c2d8a(0x13d)](_0x1c2d8a(0x136))||_0x524f19[_0x1c2d8a(0x13d)](_0x1c2d8a(0xf6))||_0x524f19[_0x1c2d8a(0x13d)](_0x1c2d8a(0x15a))||_0x524f19[_0x1c2d8a(0x13d)](_0x1c2d8a(0x115))||_0x524f19[_0x1c2d8a(0x13d)](_0x1c2d8a(0x116));if(_0x5193d0&&typeof _0x5c0622==='number'){if(_0x5c0622>0x50||_0x5c0622<-0x32)return _0x2952e9[_0x1c2d8a(0x12c)][_0x1c2d8a(0x113)]('[RECORDER]\x20Ignored\x20implausible\x20temperature:\x20'+_0x5c0622+'\x20from\x20'+_0x9276e0),null;}_0x2952e9[_0x1c2d8a(0x12a)][_0x9276e0]=_0x5c0622;if(!_0xb94c1[_0x1c2d8a(0x10a)]&&_0x513f98!=undefined&&_0x513f98==_0x5c0622)return null;_0x2952e9[_0x1c2d8a(0x12e)]&&_0x5193d0&&recordThermodynamics(_0x2952e9,_0x9276e0,_0x5c0622,_0xb94c1['location']);const _0x59cb0a={'timestamp':_0x31b198,'id':_0x9276e0,'name':_0xb94c1[_0x1c2d8a(0x154)],'type':_0xb94c1[_0x1c2d8a(0x105)],'location':_0xb94c1[_0x1c2d8a(0x132)],'value':_0x5c0622};_0x2952e9['eventHistory'][_0x1c2d8a(0x15b)](_0x59cb0a);if(_0x2952e9[_0x1c2d8a(0x153)][_0x1c2d8a(0x100)]>HISTORY_MAX_SIZE)_0x2952e9['eventHistory'][_0x1c2d8a(0x107)]();await _0x2952e9[_0x1c2d8a(0xf9)](_0x1c2d8a(0x11b),{'val':JSON[_0x1c2d8a(0x15f)](_0x59cb0a),'ack':!![]}),await _0x2952e9[_0x1c2d8a(0xf9)](_0x1c2d8a(0x150),{'val':JSON['stringify'](_0x2952e9['eventHistory']),'ack':!![]}),await updateHourlyActivity(_0x2952e9);if(_0x2952e9[_0x1c2d8a(0x12e)]){_0x2952e9[_0x1c2d8a(0x11f)][_0x1c2d8a(0x137)](_0x59cb0a);if(_0x2952e9[_0x1c2d8a(0x11f)][_0x1c2d8a(0x100)]>RAW_LOG_MAX_SIZE)_0x2952e9[_0x1c2d8a(0x11f)]['splice'](0x0,_0x2952e9['rawEventLog'][_0x1c2d8a(0x100)]-RAW_LOG_MAX_SIZE);await _0x2952e9['setStateAsync'](_0x1c2d8a(0x109),{'val':JSON[_0x1c2d8a(0x15f)](_0x2952e9['rawEventLog']),'ack':!![]}),recordSequence(_0x2952e9,_0x59cb0a);}if(_0xb94c1['isExit']&&_0x5c0622===!![]){if(_0x2952e9[_0x1c2d8a(0x15d)]&&!_0x2952e9[_0x1c2d8a(0x14f)])startExitTimer(_0x2952e9);else{if(!_0x2952e9['isPresent'])setPresence(_0x2952e9,!![]);}}else{if(_0xb94c1['type']==='motion'&&_0x5c0622===!![]){if(_0x2952e9[_0x1c2d8a(0x151)])abortExitTimer(_0x2952e9);if(!_0x2952e9['isPresent']&&_0x2952e9[_0x1c2d8a(0x145)]===_0x1c2d8a(0x130))setPresence(_0x2952e9,!![]);}}if(_0x2952e9['isProVersion']&&_0x2952e9[_0x1c2d8a(0x141)]){_0xb94c1[_0x1c2d8a(0x105)]===_0x1c2d8a(0x11d)&&_0x5c0622===!![]&&_0xb94c1['location']&&_0x2952e9[_0x1c2d8a(0x141)](_0x1c2d8a(0x117),{'room':_0xb94c1[_0x1c2d8a(0x132)]});const _0x43b13c=['door',_0x1c2d8a(0x157),'window',_0x1c2d8a(0x10e),_0x1c2d8a(0x138),_0x1c2d8a(0x10b),_0x1c2d8a(0x125),_0x1c2d8a(0x11c)]['some'](_0x12291d=>_0x524f19[_0x1c2d8a(0x13d)](_0x12291d)),_0x28ee25=[_0x1c2d8a(0x147),_0x1c2d8a(0x112),_0x1c2d8a(0x160),_0x1c2d8a(0xfb),_0x1c2d8a(0x14d),_0x1c2d8a(0x14b)][_0x1c2d8a(0x139)](_0x494480=>_0x524f19[_0x1c2d8a(0x13d)](_0x494480)),_0x1eb43b=[_0x1c2d8a(0x11d),'bewegung',_0x1c2d8a(0x14e),_0x1c2d8a(0x155),_0x1c2d8a(0x131)][_0x1c2d8a(0x139)](_0x4f9e76=>_0x524f19[_0x1c2d8a(0x13d)](_0x4f9e76));if(_0xb94c1[_0x1c2d8a(0x132)]&&(_0x43b13c||_0x28ee25||_0x1eb43b)){const _0x3753a8=_0x5c0622===!![]||typeof _0x5c0622===_0x1c2d8a(0x156)&&_0x5c0622>0x0,_0x3c9e18=_0x43b13c&&!_0x3753a8&&_0x513f98!==undefined&&_0x513f98!=_0x5c0622;if(_0x3753a8||_0x3c9e18){const _0x3c3c59=_0x2952e9[_0x1c2d8a(0xf7)]||_0x31b198,_0x3df673=(_0x31b198-_0x3c3c59)/0x3e8;_0x2952e9[_0x1c2d8a(0xf7)]=_0x31b198,_0x2952e9['sendToPythonWrapper']('TRACK_EVENT',{'room':_0xb94c1[_0x1c2d8a(0x132)],'dt':_0x3df673});}}}return _0x59cb0a;}function a5_0x56e3(_0xb9d5f,_0x27c5e3){const _0x59800c=a5_0x4f66();return a5_0x56e3=function(_0x674e1b,_0x16df6b){_0x674e1b=_0x674e1b-0xf6;let _0x4f66aa=_0x59800c[_0x674e1b];return _0x4f66aa;},a5_0x56e3(_0xb9d5f,_0x27c5e3);}module[a5_0x3ba4df(0x12f)]={'processSensorEvent':processSensorEvent,'getOutsideTemperatureNumeric':getOutsideTemperatureNumeric,'setPresence':setPresence,'abortExitTimer':abortExitTimer,'startExitTimer':startExitTimer};