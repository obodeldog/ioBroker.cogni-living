const a5_0x36e940=a5_0x4e18;(function(_0xd5b7fd,_0x1fc446){const _0x4fad00=a5_0x4e18,_0x21b753=_0xd5b7fd();while(!![]){try{const _0x49dd44=-parseInt(_0x4fad00(0x17c))/0x1*(-parseInt(_0x4fad00(0x164))/0x2)+-parseInt(_0x4fad00(0x18c))/0x3*(parseInt(_0x4fad00(0x14b))/0x4)+-parseInt(_0x4fad00(0x15b))/0x5*(parseInt(_0x4fad00(0x1a9))/0x6)+parseInt(_0x4fad00(0x159))/0x7*(parseInt(_0x4fad00(0x18d))/0x8)+-parseInt(_0x4fad00(0x143))/0x9+parseInt(_0x4fad00(0x181))/0xa*(parseInt(_0x4fad00(0x1af))/0xb)+-parseInt(_0x4fad00(0x196))/0xc;if(_0x49dd44===_0x1fc446)break;else _0x21b753['push'](_0x21b753['shift']());}catch(_0x4b1506){_0x21b753['push'](_0x21b753['shift']());}}}(a5_0xf43c,0xcad00));function a5_0x4e18(_0x471444,_0x60a413){const _0x15acce=a5_0xf43c();return a5_0x4e18=function(_0x3cb03f,_0x416453){_0x3cb03f=_0x3cb03f-0x141;let _0xf43cb9=_0x15acce[_0x3cb03f];return _0xf43cb9;},a5_0x4e18(_0x471444,_0x60a413);}const a5_0x416453=(function(){let _0x4992f2=!![];return function(_0x4f860f,_0x39dbbc){const _0x5138fe=_0x4992f2?function(){const _0x3d64dc=a5_0x4e18;if(_0x39dbbc){const _0x3a9525=_0x39dbbc[_0x3d64dc(0x192)](_0x4f860f,arguments);return _0x39dbbc=null,_0x3a9525;}}:function(){};return _0x4992f2=![],_0x5138fe;};}()),a5_0x3cb03f=a5_0x416453(this,function(){const _0x2d1da7=a5_0x4e18;return a5_0x3cb03f[_0x2d1da7(0x167)]()[_0x2d1da7(0x153)](_0x2d1da7(0x199))[_0x2d1da7(0x167)]()['constructor'](a5_0x3cb03f)['search'](_0x2d1da7(0x199));});a5_0x3cb03f();'use strict';const HISTORY_MAX_SIZE=0x32,RAW_LOG_MAX_SIZE=0x9c4,THERMO_LOG_SIZE=0x3e8,SEQUENCE_TIMEOUT_MS=0x5*0x3c*0x3e8,MAX_TRAINING_SET_SIZE=0x1f4,EXIT_TIMER_MINUTES=0xf,EXIT_GRACE_PERIOD_SECONDS=0x1e;function a5_0xf43c(){const _0x3352e0=['Temperature','getStateAsync','apply','.1.TEMPERATURE','weatherunderground','length','2929704txpcyU','light','.forecast.current.temp','(((.+)+)+)+$','location','round','includes','rawEventLog','LEVEL','lock','lampe','.1.LEVEL','system.isPresent','push','value','parse','dimmer','message','stringify','176106PHcjKD','temperature','\x20from\x20','präsenz','ANALYZE_SEQUENCE','temperatur','88SxQxJm','door','normal','shift','SIMULATE_SIGNAL','1553769akYNFd','loc','true','schalter','.1.VALVE_STATE','exports','window','sendToPythonWrapper','604GNNrpe','toLowerCase','val','LTM.trainingData.thermodynamics','fenster','config','isPresent','now','search','klima','getHours','licht','useWeather','number','238658oZgbPM','getForeignStateAsync','235BrZTWK','lastTrackerEventTime','occupancy','replace','.4.VALVE_STATE','.Current.Temperature','kontakt','griff','map','822508gYBWQw','[RECORDER]\x20Error:\x20','STATUS','toString','heizung','exitGraceTimer','isGracePeriodActive','LTM.rawEventLog','type','some','logDuplicates','splice','switch','daswetter','setStateAsync','handle','getDate','from','LTM.trainingData.sequences','isProVersion','eventHistory','STATE','tür','name','1SYHVyN','fill','analysis.health.todayVector','log','debug','1651320OTfqKH','Unknown','motion','toISOString','presence','openweathermap','bewegung','contact','.LEVEL','unshift','currentSystemMode','10674SDHmrT','336RXapZl','.ACTUAL_TEMPERATURE','exitTimer'];a5_0xf43c=function(){return _0x3352e0;};return a5_0xf43c();}let activeSequence=[],sequenceTimer=null;async function getOutsideTemperatureNumeric(_0x334421){const _0x56c260=a5_0x4e18;if(_0x334421[_0x56c260(0x150)]['outdoorSensorId'])try{const _0xb91a9b=await _0x334421[_0x56c260(0x15a)](_0x334421[_0x56c260(0x150)]['outdoorSensorId']);if(_0xb91a9b&&_0xb91a9b[_0x56c260(0x14d)]!==undefined&&_0xb91a9b['val']!==null)return parseFloat(_0xb91a9b['val']);}catch(_0x2e609f){}const _0x487e81=_0x334421['config']['weatherInstance'];if(!_0x334421[_0x56c260(0x150)][_0x56c260(0x157)]||!_0x487e81)return null;try{let _0x401ee7='';if(_0x487e81[_0x56c260(0x19c)]('accuweather'))_0x401ee7=_0x487e81+_0x56c260(0x160);else{if(_0x487e81['includes'](_0x56c260(0x171)))_0x401ee7=_0x487e81+'.NextHours.Location_1.Day_1.current.temp_value';else{if(_0x487e81[_0x56c260(0x19c)](_0x56c260(0x186)))_0x401ee7=_0x487e81+'.forecast.current.temperature';else{if(_0x487e81['includes'](_0x56c260(0x194)))_0x401ee7=_0x487e81+_0x56c260(0x198);}}}if(_0x401ee7){const _0x18414a=await _0x334421[_0x56c260(0x15a)](_0x401ee7);if(_0x18414a&&_0x18414a[_0x56c260(0x14d)]!==undefined&&_0x18414a['val']!==null)return parseFloat(_0x18414a[_0x56c260(0x14d)]);}}catch(_0x467619){}return null;}async function recordThermodynamics(_0x411509,_0x2528cf,_0xeeb695,_0x35c383){const _0x586c3c=a5_0x4e18,_0x394c55=await getOutsideTemperatureNumeric(_0x411509);if(_0x394c55===null)return;let _0x598361=0x0,_0x57864e=![];if(_0x411509[_0x586c3c(0x150)]['valveMapping'])try{let _0x62522d=_0x411509['config']['valveMapping'];if(typeof _0x62522d==='string')_0x62522d=JSON['parse'](_0x62522d);if(_0x62522d[_0x2528cf]){const _0x1c7a80=_0x62522d[_0x2528cf],_0x4e7e2f=await _0x411509[_0x586c3c(0x15a)](_0x1c7a80);if(_0x4e7e2f&&_0x4e7e2f[_0x586c3c(0x14d)]!==null&&_0x4e7e2f[_0x586c3c(0x14d)]!==undefined){let _0x9d6d88=Number(_0x4e7e2f['val']);if(_0x9d6d88<=1.05&&!_0x1c7a80[_0x586c3c(0x19c)](_0x586c3c(0x166))&&!_0x1c7a80[_0x586c3c(0x19c)](_0x586c3c(0x179)))_0x9d6d88=_0x9d6d88*0x64;_0x598361=Math['round'](_0x9d6d88),_0x57864e=!![];}}}catch(_0x5da5e1){}if(!_0x57864e){const _0x2acfd0=[{'from':'.1.ACTUAL_TEMPERATURE','to':_0x586c3c(0x1a1)},{'from':'.1.ACTUAL_TEMPERATURE','to':_0x586c3c(0x147)},{'from':_0x586c3c(0x193),'to':_0x586c3c(0x15f)},{'from':_0x586c3c(0x18e),'to':_0x586c3c(0x189)},{'from':_0x586c3c(0x1aa),'to':'level'},{'from':_0x586c3c(0x190),'to':'Valve'}];for(const _0x49d59f of _0x2acfd0){if(_0x2528cf[_0x586c3c(0x19c)](_0x49d59f['from'])){const _0x25468a=_0x2528cf[_0x586c3c(0x15e)](_0x49d59f[_0x586c3c(0x175)],_0x49d59f['to']);try{const _0x126e1a=await _0x411509[_0x586c3c(0x15a)](_0x25468a);if(_0x126e1a&&_0x126e1a['val']!==null&&_0x126e1a[_0x586c3c(0x14d)]!==undefined){let _0x27eb3e=Number(_0x126e1a['val']);if(typeof _0x27eb3e===_0x586c3c(0x158)){if(_0x27eb3e<=1.05&&_0x49d59f['to'][_0x586c3c(0x19c)](_0x586c3c(0x19e)))_0x27eb3e=_0x27eb3e*0x64;_0x598361=Math[_0x586c3c(0x19b)](_0x27eb3e),_0x57864e=!![];break;}}}catch(_0x5352e1){}}}}const _0x4bdc85=await _0x411509['getStateAsync'](_0x586c3c(0x14e));let _0x5f5bd5=[];if(_0x4bdc85&&_0x4bdc85[_0x586c3c(0x14d)])try{_0x5f5bd5=JSON[_0x586c3c(0x1a5)](_0x4bdc85['val']);}catch(_0x1cc2a2){}_0x5f5bd5['push']({'ts':Date['now'](),'room':_0x35c383||_0x586c3c(0x182),'t_in':_0xeeb695,'t_out':_0x394c55,'valve':_0x598361});if(_0x5f5bd5[_0x586c3c(0x195)]>THERMO_LOG_SIZE)_0x5f5bd5[_0x586c3c(0x141)]();await _0x411509['setStateAsync'](_0x586c3c(0x14e),{'val':JSON['stringify'](_0x5f5bd5),'ack':!![]});}async function saveCompletedSequence(_0x2c9397){const _0x2e0569=a5_0x4e18;try{const _0x232337=await _0x2c9397['getStateAsync'](_0x2e0569(0x176));let _0xf6934c=[];if(_0x232337&&_0x232337['val'])try{_0xf6934c=JSON['parse'](_0x232337['val']);}catch(_0x447054){}const _0x329836=activeSequence[0x0]['ts'],_0x40adf9=activeSequence[_0x2e0569(0x163)](_0x38b37f=>({'loc':_0x38b37f[_0x2e0569(0x144)],'t_delta':Math[_0x2e0569(0x19b)]((_0x38b37f['ts']-_0x329836)/0x3e8)})),_0x3516c7={'timestamp':new Date(_0x329836)[_0x2e0569(0x184)](),'steps':_0x40adf9,'duration':Math[_0x2e0569(0x19b)]((activeSequence[activeSequence[_0x2e0569(0x195)]-0x1]['ts']-_0x329836)/0x3e8),'daytime':new Date(_0x329836)[_0x2e0569(0x155)]()};_0xf6934c['push'](_0x3516c7);if(_0xf6934c[_0x2e0569(0x195)]>MAX_TRAINING_SET_SIZE)_0xf6934c['shift']();await _0x2c9397[_0x2e0569(0x172)](_0x2e0569(0x176),{'val':JSON[_0x2e0569(0x1a8)](_0xf6934c),'ack':!![]}),_0x2c9397['isProVersion']&&_0x2c9397[_0x2e0569(0x14a)]&&_0x2c9397['sendToPythonWrapper'](_0x2e0569(0x1ad),{'sequence':_0x3516c7});}catch(_0x2b6c7c){_0x2c9397['log']['error'](_0x2e0569(0x165)+_0x2b6c7c[_0x2e0569(0x1a7)]);}}async function recordSequence(_0xed7eab,_0x691f30){const _0xda6711=a5_0x4e18,_0x9118af=(_0x691f30['type']||'')[_0xda6711(0x14c)](),_0x222d9a=[_0xda6711(0x183),_0xda6711(0x187),_0xda6711(0x1ac),_0xda6711(0x185),_0xda6711(0x15d),_0xda6711(0x1b0),_0xda6711(0x17a),_0xda6711(0x149),_0xda6711(0x14f),'contact',_0xda6711(0x161),'light',_0xda6711(0x156),'switch',_0xda6711(0x146),_0xda6711(0x1a6),_0xda6711(0x1a0)];if(!_0x222d9a['some'](_0x1af13e=>_0x9118af[_0xda6711(0x19c)](_0x1af13e)))return;if(!_0x691f30[_0xda6711(0x1a4)])return;if(sequenceTimer)clearTimeout(sequenceTimer);activeSequence['push']({'loc':_0x691f30[_0xda6711(0x19a)]||_0xda6711(0x182),'id':_0x691f30['id'],'ts':Date[_0xda6711(0x152)]()}),sequenceTimer=setTimeout(async()=>{const _0x49fe11=_0xda6711;if(activeSequence[_0x49fe11(0x195)]>0x1)await saveCompletedSequence(_0xed7eab);activeSequence=[];},SEQUENCE_TIMEOUT_MS);}function startExitTimer(_0x4a1a14){const _0x2c07e5=a5_0x4e18;abortExitTimer(_0x4a1a14),_0x4a1a14[_0x2c07e5(0x16a)]=!![],_0x4a1a14[_0x2c07e5(0x169)]=setTimeout(()=>{const _0x1e7962=_0x2c07e5;_0x4a1a14[_0x1e7962(0x16a)]=![];},EXIT_GRACE_PERIOD_SECONDS*0x3e8),_0x4a1a14['exitTimer']=setTimeout(()=>{const _0x2a7429=_0x2c07e5;setPresence(_0x4a1a14,![]),_0x4a1a14[_0x2a7429(0x18f)]=null;},EXIT_TIMER_MINUTES*0x3c*0x3e8);}function abortExitTimer(_0x992e6f){const _0x34f6b7=a5_0x4e18;if(_0x992e6f[_0x34f6b7(0x18f)])clearTimeout(_0x992e6f[_0x34f6b7(0x18f)]);if(_0x992e6f['exitGraceTimer'])clearTimeout(_0x992e6f[_0x34f6b7(0x169)]);_0x992e6f['exitTimer']=null,_0x992e6f[_0x34f6b7(0x169)]=null,_0x992e6f[_0x34f6b7(0x16a)]=![];}async function setPresence(_0x508a30,_0x52f19e){const _0x2bfc3b=a5_0x4e18;if(_0x508a30[_0x2bfc3b(0x151)]===_0x52f19e)return;_0x508a30[_0x2bfc3b(0x151)]=_0x52f19e,await _0x508a30[_0x2bfc3b(0x172)](_0x2bfc3b(0x1a2),{'val':_0x52f19e,'ack':!![]});}function isRelevantActivity(_0x21f63a,_0x454a7d){const _0x36b460=a5_0x4e18;if(!_0x21f63a)return![];const _0x418fa1=_0x21f63a[_0x36b460(0x14c)](),_0x1f2522=_0x454a7d===!![]||_0x454a7d===0x1||_0x454a7d==='on'||_0x454a7d===_0x36b460(0x145);if(!_0x1f2522)return![];const _0x30617d=[_0x36b460(0x183),_0x36b460(0x187),_0x36b460(0x1ac),_0x36b460(0x185),_0x36b460(0x15d)]['some'](_0x411c52=>_0x418fa1[_0x36b460(0x19c)](_0x411c52)),_0x2dc0b8=[_0x36b460(0x1b0),_0x36b460(0x17a),_0x36b460(0x149),_0x36b460(0x14f),_0x36b460(0x162),_0x36b460(0x173),_0x36b460(0x19f),'schloss',_0x36b460(0x188),_0x36b460(0x161)][_0x36b460(0x16d)](_0x9433b8=>_0x418fa1[_0x36b460(0x19c)](_0x9433b8)),_0x1d4478=[_0x36b460(0x197),'licht',_0x36b460(0x170),_0x36b460(0x146),_0x36b460(0x1a6),_0x36b460(0x1a0)][_0x36b460(0x16d)](_0x475260=>_0x418fa1[_0x36b460(0x19c)](_0x475260));return _0x30617d||_0x2dc0b8||_0x1d4478;}async function updateHourlyActivity(_0x4278d2,_0x2fa185){const _0x1852e2=a5_0x4e18;if(!isRelevantActivity(_0x2fa185[_0x1852e2(0x16c)],_0x2fa185[_0x1852e2(0x1a4)]))return;let _0x5d43a9=new Array(0x18)[_0x1852e2(0x17d)](0x0),_0x1273db=0x0;try{const _0x251307=await _0x4278d2[_0x1852e2(0x191)]('analysis.health.todayVector');_0x251307&&_0x251307[_0x1852e2(0x14d)]&&(_0x5d43a9=JSON['parse'](_0x251307[_0x1852e2(0x14d)]),_0x1273db=_0x251307['ts']);}catch(_0x28ba6c){}const _0x7e6be1=new Date(_0x1273db),_0x4f9df0=new Date();_0x7e6be1['getDate']()!==_0x4f9df0[_0x1852e2(0x174)]()&&(_0x5d43a9=new Array(0x18)['fill'](0x0));const _0x131db6=_0x4f9df0['getHours']();if(_0x5d43a9[_0x131db6]===undefined)_0x5d43a9[_0x131db6]=0x0;_0x5d43a9[_0x131db6]++,await _0x4278d2[_0x1852e2(0x172)](_0x1852e2(0x17e),{'val':JSON['stringify'](_0x5d43a9),'ack':!![]});}async function processSensorEvent(_0x5c7b4c,_0x36da23,_0x21f3d1,_0x1c21f4){const _0x172899=a5_0x4e18;if(!_0x1c21f4)return null;const _0x4a78b0=_0x21f3d1[_0x172899(0x14d)],_0x7c2cf6=Date[_0x172899(0x152)](),_0xd76e37=_0x5c7b4c['sensorLastValues'][_0x36da23],_0x2de323=(_0x1c21f4[_0x172899(0x16c)]||'')[_0x172899(0x14c)](),_0x9f5e8d=_0x2de323['includes'](_0x172899(0x1aa))||_0x2de323['includes'](_0x172899(0x1ae))||_0x2de323['includes'](_0x172899(0x154))||_0x2de323['includes'](_0x172899(0x168))||_0x2de323[_0x172899(0x19c)]('thermostat');if(_0x9f5e8d&&typeof _0x4a78b0===_0x172899(0x158)){if(_0x4a78b0>0x50||_0x4a78b0<-0x32)return _0x5c7b4c[_0x172899(0x17f)][_0x172899(0x180)]('[RECORDER]\x20Ignored\x20implausible\x20temperature:\x20'+_0x4a78b0+_0x172899(0x1ab)+_0x36da23),null;}_0x5c7b4c['sensorLastValues'][_0x36da23]=_0x4a78b0;if(!_0x1c21f4[_0x172899(0x16e)]&&_0xd76e37!=undefined&&_0xd76e37==_0x4a78b0)return null;_0x5c7b4c[_0x172899(0x177)]&&_0x9f5e8d&&recordThermodynamics(_0x5c7b4c,_0x36da23,_0x4a78b0,_0x1c21f4[_0x172899(0x19a)]);const _0x4f3c00={'timestamp':_0x7c2cf6,'id':_0x36da23,'name':_0x1c21f4[_0x172899(0x17b)],'type':_0x1c21f4['type'],'location':_0x1c21f4[_0x172899(0x19a)],'value':_0x4a78b0};_0x5c7b4c[_0x172899(0x178)][_0x172899(0x18a)](_0x4f3c00);if(_0x5c7b4c['eventHistory'][_0x172899(0x195)]>HISTORY_MAX_SIZE)_0x5c7b4c[_0x172899(0x178)]['pop']();await _0x5c7b4c[_0x172899(0x172)]('events.lastEvent',{'val':JSON[_0x172899(0x1a8)](_0x4f3c00),'ack':!![]}),await _0x5c7b4c[_0x172899(0x172)]('events.history',{'val':JSON[_0x172899(0x1a8)](_0x5c7b4c[_0x172899(0x178)]),'ack':!![]}),await updateHourlyActivity(_0x5c7b4c,_0x4f3c00);if(_0x5c7b4c[_0x172899(0x177)]){_0x5c7b4c[_0x172899(0x19d)][_0x172899(0x1a3)](_0x4f3c00);if(_0x5c7b4c['rawEventLog'][_0x172899(0x195)]>RAW_LOG_MAX_SIZE)_0x5c7b4c['rawEventLog'][_0x172899(0x16f)](0x0,_0x5c7b4c[_0x172899(0x19d)][_0x172899(0x195)]-RAW_LOG_MAX_SIZE);await _0x5c7b4c[_0x172899(0x172)](_0x172899(0x16b),{'val':JSON[_0x172899(0x1a8)](_0x5c7b4c['rawEventLog']),'ack':!![]}),recordSequence(_0x5c7b4c,_0x4f3c00);}if(_0x1c21f4['isExit']&&_0x4a78b0===!![]){if(_0x5c7b4c[_0x172899(0x151)]&&!_0x5c7b4c[_0x172899(0x16a)])startExitTimer(_0x5c7b4c);else{if(!_0x5c7b4c['isPresent'])setPresence(_0x5c7b4c,!![]);}}else{if(_0x1c21f4[_0x172899(0x16c)]===_0x172899(0x183)&&_0x4a78b0===!![]){if(_0x5c7b4c[_0x172899(0x18f)])abortExitTimer(_0x5c7b4c);if(!_0x5c7b4c['isPresent']&&_0x5c7b4c[_0x172899(0x18b)]===_0x172899(0x1b1))setPresence(_0x5c7b4c,!![]);}}if(_0x5c7b4c['isProVersion']&&_0x5c7b4c[_0x172899(0x14a)]){_0x1c21f4[_0x172899(0x16c)]===_0x172899(0x183)&&_0x4a78b0===!![]&&_0x1c21f4['location']&&_0x5c7b4c[_0x172899(0x14a)](_0x172899(0x142),{'room':_0x1c21f4[_0x172899(0x19a)]});const _0x4b138e=[_0x172899(0x1b0),'tür',_0x172899(0x149),_0x172899(0x14f),_0x172899(0x162),_0x172899(0x173),_0x172899(0x19f),'schloss'][_0x172899(0x16d)](_0x4bfed5=>_0x2de323[_0x172899(0x19c)](_0x4bfed5)),_0x145167=['light',_0x172899(0x156),_0x172899(0x170),_0x172899(0x146),_0x172899(0x1a6),'lampe'][_0x172899(0x16d)](_0x374c80=>_0x2de323[_0x172899(0x19c)](_0x374c80)),_0xd7affe=['motion','bewegung',_0x172899(0x1ac),'presence',_0x172899(0x15d)][_0x172899(0x16d)](_0x2372f8=>_0x2de323['includes'](_0x2372f8));if(_0x1c21f4['location']&&(_0x4b138e||_0x145167||_0xd7affe)){const _0x2f5aaf=_0x4a78b0===!![]||typeof _0x4a78b0===_0x172899(0x158)&&_0x4a78b0>0x0,_0x2fbc71=_0x4b138e&&!_0x2f5aaf&&_0xd76e37!==undefined&&_0xd76e37!=_0x4a78b0;if(_0x2f5aaf||_0x2fbc71){const _0x737810=_0x5c7b4c[_0x172899(0x15c)]||_0x7c2cf6,_0x1668fb=(_0x7c2cf6-_0x737810)/0x3e8;_0x5c7b4c[_0x172899(0x15c)]=_0x7c2cf6,_0x5c7b4c[_0x172899(0x14a)]('TRACK_EVENT',{'room':_0x1c21f4[_0x172899(0x19a)],'dt':_0x1668fb});}}}return _0x4f3c00;}module[a5_0x36e940(0x148)]={'processSensorEvent':processSensorEvent,'getOutsideTemperatureNumeric':getOutsideTemperatureNumeric,'setPresence':setPresence,'abortExitTimer':abortExitTimer,'startExitTimer':startExitTimer,'isRelevantActivity':isRelevantActivity};