const a5_0x3f126b=a5_0x2aa5;(function(_0x2d6eba,_0x24312c){const _0x2a0e7e=a5_0x2aa5,_0x5e2b81=_0x2d6eba();while(!![]){try{const _0x45ce0d=parseInt(_0x2a0e7e(0xd9))/0x1+-parseInt(_0x2a0e7e(0xd1))/0x2*(parseInt(_0x2a0e7e(0xdc))/0x3)+-parseInt(_0x2a0e7e(0xc5))/0x4+-parseInt(_0x2a0e7e(0xda))/0x5*(parseInt(_0x2a0e7e(0xec))/0x6)+parseInt(_0x2a0e7e(0xb5))/0x7+parseInt(_0x2a0e7e(0x106))/0x8*(parseInt(_0x2a0e7e(0xd0))/0x9)+-parseInt(_0x2a0e7e(0x114))/0xa;if(_0x45ce0d===_0x24312c)break;else _0x5e2b81['push'](_0x5e2b81['shift']());}catch(_0x771dbf){_0x5e2b81['push'](_0x5e2b81['shift']());}}}(a5_0x4a46,0xc97da));const a5_0x493eb8=(function(){let _0x4b1a2a=!![];return function(_0x191fb5,_0x21df0c){const _0x55325d=_0x4b1a2a?function(){const _0x18661b=a5_0x2aa5;if(_0x21df0c){const _0x150a2b=_0x21df0c[_0x18661b(0xc9)](_0x191fb5,arguments);return _0x21df0c=null,_0x150a2b;}}:function(){};return _0x4b1a2a=![],_0x55325d;};}()),a5_0x5747e1=a5_0x493eb8(this,function(){const _0x255023=a5_0x2aa5;return a5_0x5747e1['toString']()['search'](_0x255023(0xae))['toString']()['constructor'](a5_0x5747e1)[_0x255023(0x10f)](_0x255023(0xae));});a5_0x5747e1();'use strict';const HISTORY_MAX_SIZE=0x32,RAW_LOG_MAX_SIZE=0x9c4,THERMO_LOG_SIZE=0x3e8,SEQUENCE_TIMEOUT_MS=0x5*0x3c*0x3e8,MAX_TRAINING_SET_SIZE=0x1f4,EXIT_TIMER_MINUTES=0xf,EXIT_GRACE_PERIOD_SECONDS=0x1e;let activeSequence=[],sequenceTimer=null;async function getOutsideTemperatureNumeric(_0x109563){const _0x22185d=a5_0x2aa5;if(_0x109563[_0x22185d(0xfe)][_0x22185d(0xf6)])try{const _0x53e731=await _0x109563[_0x22185d(0x105)](_0x109563[_0x22185d(0xfe)][_0x22185d(0xf6)]);if(_0x53e731&&_0x53e731[_0x22185d(0x10e)]!==undefined&&_0x53e731[_0x22185d(0x10e)]!==null)return parseFloat(_0x53e731[_0x22185d(0x10e)]);}catch(_0x52e4c8){}const _0x13fea1=_0x109563[_0x22185d(0xfe)][_0x22185d(0xfd)];if(!_0x109563[_0x22185d(0xfe)][_0x22185d(0xdd)]||!_0x13fea1)return null;try{let _0xcc60c8='';if(_0x13fea1[_0x22185d(0xbe)](_0x22185d(0x108)))_0xcc60c8=_0x13fea1+_0x22185d(0xb9);else{if(_0x13fea1[_0x22185d(0xbe)](_0x22185d(0xc2)))_0xcc60c8=_0x13fea1+_0x22185d(0x10c);else{if(_0x13fea1['includes'](_0x22185d(0x11a)))_0xcc60c8=_0x13fea1+'.forecast.current.temperature';else{if(_0x13fea1['includes'](_0x22185d(0xd5)))_0xcc60c8=_0x13fea1+_0x22185d(0x116);}}}if(_0xcc60c8){const _0x52d4ce=await _0x109563[_0x22185d(0x105)](_0xcc60c8);if(_0x52d4ce&&_0x52d4ce[_0x22185d(0x10e)]!==undefined&&_0x52d4ce['val']!==null)return parseFloat(_0x52d4ce[_0x22185d(0x10e)]);}}catch(_0x3eb365){}return null;}async function recordThermodynamics(_0x35e6e2,_0x50ac92,_0x2de644,_0x413a2c){const _0x16304f=a5_0x2aa5,_0x727664=await getOutsideTemperatureNumeric(_0x35e6e2);if(_0x727664===null)return;let _0x54313f=0x0,_0x4c3c37=![];if(_0x35e6e2[_0x16304f(0xfe)][_0x16304f(0xb6)])try{let _0x53be7c=_0x35e6e2[_0x16304f(0xfe)]['valveMapping'];if(typeof _0x53be7c==='string')_0x53be7c=JSON[_0x16304f(0x112)](_0x53be7c);if(_0x53be7c[_0x50ac92]){const _0x1c0d4b=_0x53be7c[_0x50ac92],_0x58b6d1=await _0x35e6e2[_0x16304f(0x105)](_0x1c0d4b);if(_0x58b6d1&&_0x58b6d1[_0x16304f(0x10e)]!==null&&_0x58b6d1[_0x16304f(0x10e)]!==undefined){let _0x1091e1=Number(_0x58b6d1['val']);if(_0x1091e1<=1.05&&!_0x1c0d4b[_0x16304f(0xbe)](_0x16304f(0xcd))&&!_0x1c0d4b[_0x16304f(0xbe)]('STATE'))_0x1091e1=_0x1091e1*0x64;_0x54313f=Math[_0x16304f(0xf7)](_0x1091e1),_0x4c3c37=!![];}}}catch(_0x4890b4){}if(!_0x4c3c37){const _0x26b850=[{'from':_0x16304f(0xb7),'to':'.1.LEVEL'},{'from':_0x16304f(0xb7),'to':_0x16304f(0xb8)},{'from':'.1.TEMPERATURE','to':'.4.VALVE_STATE'},{'from':_0x16304f(0xb0),'to':_0x16304f(0xfa)},{'from':_0x16304f(0xc7),'to':'level'},{'from':_0x16304f(0xb1),'to':'Valve'}];for(const _0x5be705 of _0x26b850){if(_0x50ac92[_0x16304f(0xbe)](_0x5be705[_0x16304f(0x101)])){const _0x3ba4a4=_0x50ac92[_0x16304f(0xaf)](_0x5be705[_0x16304f(0x101)],_0x5be705['to']);try{const _0x11a036=await _0x35e6e2[_0x16304f(0x105)](_0x3ba4a4);if(_0x11a036&&_0x11a036[_0x16304f(0x10e)]!==null&&_0x11a036[_0x16304f(0x10e)]!==undefined){let _0x534d5a=Number(_0x11a036[_0x16304f(0x10e)]);if(typeof _0x534d5a===_0x16304f(0x117)){if(_0x534d5a<=1.05&&_0x5be705['to'][_0x16304f(0xbe)]('LEVEL'))_0x534d5a=_0x534d5a*0x64;_0x54313f=Math['round'](_0x534d5a),_0x4c3c37=!![];break;}}}catch(_0x3b3752){}}}}const _0x23a54f=await _0x35e6e2[_0x16304f(0xe6)]('LTM.trainingData.thermodynamics');let _0x5d2f58=[];if(_0x23a54f&&_0x23a54f['val'])try{_0x5d2f58=JSON[_0x16304f(0x112)](_0x23a54f[_0x16304f(0x10e)]);}catch(_0x301026){}_0x5d2f58[_0x16304f(0xc3)]({'ts':Date[_0x16304f(0x104)](),'room':_0x413a2c||'Unknown','t_in':_0x2de644,'t_out':_0x727664,'valve':_0x54313f});if(_0x5d2f58[_0x16304f(0xc1)]>THERMO_LOG_SIZE)_0x5d2f58[_0x16304f(0xf3)]();await _0x35e6e2['setStateAsync'](_0x16304f(0x109),{'val':JSON['stringify'](_0x5d2f58),'ack':!![]});}function a5_0x2aa5(_0x19ced2,_0x3d6aaf){const _0x3a02fe=a5_0x4a46();return a5_0x2aa5=function(_0x5747e1,_0x493eb8){_0x5747e1=_0x5747e1-0xac;let _0x4a467c=_0x3a02fe[_0x5747e1];return _0x4a467c;},a5_0x2aa5(_0x19ced2,_0x3d6aaf);}function a5_0x4a46(){const _0x37ef65=['includes','getDate','[RECORDER]\x20Error:\x20','length','daswetter','push','presence','4266744DACmAX','exitGraceTimer','temperature','some','apply','message','stringify','toISOString','STATUS','präsenz','isGracePeriodActive','1359XRewLV','20108HliHfz','contact','switch','error','weatherunderground','getHours','location','isExit','1468906CFWMjx','31430QKckuk','handle','24yHWfkG','useWeather','rawEventLog','dimmer','system.isPresent','heizung','normal','SIMULATE_SIGNAL','eventHistory','tür','getStateAsync','setStateAsync','[RECORDER]\x20Ignored\x20implausible\x20temperature:\x20','LTM.trainingData.sequences','events.lastEvent','analysis.health.todayVector','12nleiZP','isProVersion','schloss','light','TRACK_EVENT','exitTimer','licht','shift','isPresent','bewegung','outdoorSensorId','round','events.history','lastTrackerEventTime','.LEVEL','currentSystemMode','thermostat','weatherInstance','config','LTM.rawEventLog','toLowerCase','from','door','fenster','now','getForeignStateAsync','20776WJlzNj','sensorLastValues','accuweather','LTM.trainingData.thermodynamics','griff','name','.NextHours.Location_1.Day_1.current.temp_value','loc','val','search','window','map','parse','motion','8309350PypOxJ','\x20from\x20','.forecast.current.temp','number','lampe','unshift','openweathermap','schalter','exports','sendToPythonWrapper','temperatur','(((.+)+)+)+$','replace','.ACTUAL_TEMPERATURE','Temperature','occupancy','lock','logDuplicates','6684146XbjKDs','valveMapping','.1.ACTUAL_TEMPERATURE','.1.VALVE_STATE','.Current.Temperature','splice','ANALYZE_SEQUENCE','type','fill'];a5_0x4a46=function(){return _0x37ef65;};return a5_0x4a46();}async function saveCompletedSequence(_0xe80950){const _0x3938f4=a5_0x2aa5;try{const _0x44b457=await _0xe80950[_0x3938f4(0xe6)]('LTM.trainingData.sequences');let _0x1a48aa=[];if(_0x44b457&&_0x44b457['val'])try{_0x1a48aa=JSON[_0x3938f4(0x112)](_0x44b457[_0x3938f4(0x10e)]);}catch(_0x4e2848){}const _0x36be7c=activeSequence[0x0]['ts'],_0x38ef60=activeSequence[_0x3938f4(0x111)](_0x2d93fd=>({'loc':_0x2d93fd[_0x3938f4(0x10d)],'t_delta':Math[_0x3938f4(0xf7)]((_0x2d93fd['ts']-_0x36be7c)/0x3e8)})),_0x575558={'timestamp':new Date(_0x36be7c)[_0x3938f4(0xcc)](),'steps':_0x38ef60,'duration':Math[_0x3938f4(0xf7)]((activeSequence[activeSequence[_0x3938f4(0xc1)]-0x1]['ts']-_0x36be7c)/0x3e8),'daytime':new Date(_0x36be7c)['getHours']()};_0x1a48aa[_0x3938f4(0xc3)](_0x575558);if(_0x1a48aa['length']>MAX_TRAINING_SET_SIZE)_0x1a48aa[_0x3938f4(0xf3)]();await _0xe80950['setStateAsync'](_0x3938f4(0xe9),{'val':JSON[_0x3938f4(0xcb)](_0x1a48aa),'ack':!![]}),_0xe80950['isProVersion']&&_0xe80950['sendToPythonWrapper']&&_0xe80950['sendToPythonWrapper'](_0x3938f4(0xbb),{'sequence':_0x575558});}catch(_0x44c606){_0xe80950['log'][_0x3938f4(0xd4)](_0x3938f4(0xc0)+_0x44c606[_0x3938f4(0xca)]);}}async function recordSequence(_0x342a8b,_0x1f17c1){const _0x25f3bf=a5_0x2aa5,_0x399e6b=(_0x1f17c1['type']||'')[_0x25f3bf(0x100)](),_0x574d64=[_0x25f3bf(0x113),_0x25f3bf(0xf5),_0x25f3bf(0xce),'presence','occupancy',_0x25f3bf(0x102),'tür',_0x25f3bf(0x110),_0x25f3bf(0x103),_0x25f3bf(0xd2),'kontakt',_0x25f3bf(0xef),_0x25f3bf(0xf2),_0x25f3bf(0xd3),_0x25f3bf(0x11b),'dimmer',_0x25f3bf(0x118)];if(!_0x574d64[_0x25f3bf(0xc8)](_0x19f4df=>_0x399e6b['includes'](_0x19f4df)))return;if(!_0x1f17c1['value'])return;if(sequenceTimer)clearTimeout(sequenceTimer);activeSequence['push']({'loc':_0x1f17c1[_0x25f3bf(0xd7)]||'Unknown','id':_0x1f17c1['id'],'ts':Date['now']()}),sequenceTimer=setTimeout(async()=>{const _0x3517b4=_0x25f3bf;if(activeSequence[_0x3517b4(0xc1)]>0x1)await saveCompletedSequence(_0x342a8b);activeSequence=[];},SEQUENCE_TIMEOUT_MS);}function startExitTimer(_0x31c663){const _0x34f95a=a5_0x2aa5;abortExitTimer(_0x31c663),_0x31c663[_0x34f95a(0xcf)]=!![],_0x31c663['exitGraceTimer']=setTimeout(()=>{const _0x1b4ecf=_0x34f95a;_0x31c663[_0x1b4ecf(0xcf)]=![];},EXIT_GRACE_PERIOD_SECONDS*0x3e8),_0x31c663[_0x34f95a(0xf1)]=setTimeout(()=>{const _0x1825df=_0x34f95a;setPresence(_0x31c663,![]),_0x31c663[_0x1825df(0xf1)]=null;},EXIT_TIMER_MINUTES*0x3c*0x3e8);}function abortExitTimer(_0x5ed3df){const _0x406756=a5_0x2aa5;if(_0x5ed3df[_0x406756(0xf1)])clearTimeout(_0x5ed3df['exitTimer']);if(_0x5ed3df[_0x406756(0xc6)])clearTimeout(_0x5ed3df[_0x406756(0xc6)]);_0x5ed3df['exitTimer']=null,_0x5ed3df[_0x406756(0xc6)]=null,_0x5ed3df[_0x406756(0xcf)]=![];}async function setPresence(_0x1c927c,_0x1dc008){const _0x23f7bc=a5_0x2aa5;if(_0x1c927c['isPresent']===_0x1dc008)return;_0x1c927c[_0x23f7bc(0xf4)]=_0x1dc008,await _0x1c927c[_0x23f7bc(0xe7)](_0x23f7bc(0xe0),{'val':_0x1dc008,'ack':!![]});}async function updateHourlyActivity(_0xc70fec){const _0x393d1c=a5_0x2aa5;let _0x33bbeb=new Array(0x18)['fill'](0x0),_0x1180e0=0x0;try{const _0x1dc18e=await _0xc70fec[_0x393d1c(0xe6)]('analysis.health.todayVector');_0x1dc18e&&_0x1dc18e[_0x393d1c(0x10e)]&&(_0x33bbeb=JSON['parse'](_0x1dc18e[_0x393d1c(0x10e)]),_0x1180e0=_0x1dc18e['ts']);}catch(_0x3071dd){}const _0x12aadc=new Date(_0x1180e0),_0x437813=new Date();_0x12aadc[_0x393d1c(0xbf)]()!==_0x437813['getDate']()&&(_0x33bbeb=new Array(0x18)[_0x393d1c(0xbd)](0x0));const _0x502d7b=_0x437813[_0x393d1c(0xd6)]();if(_0x33bbeb[_0x502d7b]===undefined)_0x33bbeb[_0x502d7b]=0x0;_0x33bbeb[_0x502d7b]++,await _0xc70fec['setStateAsync'](_0x393d1c(0xeb),{'val':JSON[_0x393d1c(0xcb)](_0x33bbeb),'ack':!![]});}async function processSensorEvent(_0x376674,_0x29fc76,_0x17ebbf,_0x401f11){const _0x4e6eb1=a5_0x2aa5;if(!_0x401f11)return null;const _0x50f8e6=_0x17ebbf['val'],_0x5e9562=Date['now'](),_0x387e9c=_0x376674[_0x4e6eb1(0x107)][_0x29fc76],_0x4c1cd5=(_0x401f11[_0x4e6eb1(0xbc)]||'')[_0x4e6eb1(0x100)](),_0xf4a313=_0x4c1cd5['includes'](_0x4e6eb1(0xc7))||_0x4c1cd5[_0x4e6eb1(0xbe)](_0x4e6eb1(0xad))||_0x4c1cd5['includes']('klima')||_0x4c1cd5['includes'](_0x4e6eb1(0xe1))||_0x4c1cd5[_0x4e6eb1(0xbe)](_0x4e6eb1(0xfc));if(_0xf4a313&&typeof _0x50f8e6===_0x4e6eb1(0x117)){if(_0x50f8e6>0x50||_0x50f8e6<-0x32)return _0x376674['log']['debug'](_0x4e6eb1(0xe8)+_0x50f8e6+_0x4e6eb1(0x115)+_0x29fc76),null;}_0x376674['sensorLastValues'][_0x29fc76]=_0x50f8e6;if(!_0x401f11[_0x4e6eb1(0xb4)]&&_0x387e9c!=undefined&&_0x387e9c==_0x50f8e6)return null;_0x376674[_0x4e6eb1(0xed)]&&_0xf4a313&&recordThermodynamics(_0x376674,_0x29fc76,_0x50f8e6,_0x401f11[_0x4e6eb1(0xd7)]);const _0x1ae1a0={'timestamp':_0x5e9562,'id':_0x29fc76,'name':_0x401f11[_0x4e6eb1(0x10b)],'type':_0x401f11[_0x4e6eb1(0xbc)],'location':_0x401f11['location'],'value':_0x50f8e6};_0x376674[_0x4e6eb1(0xe4)][_0x4e6eb1(0x119)](_0x1ae1a0);if(_0x376674[_0x4e6eb1(0xe4)][_0x4e6eb1(0xc1)]>HISTORY_MAX_SIZE)_0x376674[_0x4e6eb1(0xe4)]['pop']();await _0x376674['setStateAsync'](_0x4e6eb1(0xea),{'val':JSON[_0x4e6eb1(0xcb)](_0x1ae1a0),'ack':!![]}),await _0x376674[_0x4e6eb1(0xe7)](_0x4e6eb1(0xf8),{'val':JSON[_0x4e6eb1(0xcb)](_0x376674[_0x4e6eb1(0xe4)]),'ack':!![]}),await updateHourlyActivity(_0x376674);if(_0x376674[_0x4e6eb1(0xed)]){_0x376674[_0x4e6eb1(0xde)][_0x4e6eb1(0xc3)](_0x1ae1a0);if(_0x376674[_0x4e6eb1(0xde)][_0x4e6eb1(0xc1)]>RAW_LOG_MAX_SIZE)_0x376674['rawEventLog'][_0x4e6eb1(0xba)](0x0,_0x376674['rawEventLog'][_0x4e6eb1(0xc1)]-RAW_LOG_MAX_SIZE);await _0x376674[_0x4e6eb1(0xe7)](_0x4e6eb1(0xff),{'val':JSON[_0x4e6eb1(0xcb)](_0x376674[_0x4e6eb1(0xde)]),'ack':!![]}),recordSequence(_0x376674,_0x1ae1a0);}if(_0x401f11[_0x4e6eb1(0xd8)]&&_0x50f8e6===!![]){if(_0x376674[_0x4e6eb1(0xf4)]&&!_0x376674['isGracePeriodActive'])startExitTimer(_0x376674);else{if(!_0x376674[_0x4e6eb1(0xf4)])setPresence(_0x376674,!![]);}}else{if(_0x401f11[_0x4e6eb1(0xbc)]===_0x4e6eb1(0x113)&&_0x50f8e6===!![]){if(_0x376674['exitTimer'])abortExitTimer(_0x376674);if(!_0x376674['isPresent']&&_0x376674[_0x4e6eb1(0xfb)]===_0x4e6eb1(0xe2))setPresence(_0x376674,!![]);}}if(_0x376674[_0x4e6eb1(0xed)]&&_0x376674['sendToPythonWrapper']){_0x401f11[_0x4e6eb1(0xbc)]===_0x4e6eb1(0x113)&&_0x50f8e6===!![]&&_0x401f11['location']&&_0x376674[_0x4e6eb1(0xac)](_0x4e6eb1(0xe3),{'room':_0x401f11[_0x4e6eb1(0xd7)]});const _0x55c475=[_0x4e6eb1(0x102),_0x4e6eb1(0xe5),_0x4e6eb1(0x110),'fenster',_0x4e6eb1(0x10a),_0x4e6eb1(0xdb),_0x4e6eb1(0xb3),_0x4e6eb1(0xee)]['some'](_0x358939=>_0x4c1cd5[_0x4e6eb1(0xbe)](_0x358939)),_0x6a1235=['light','licht',_0x4e6eb1(0xd3),'schalter',_0x4e6eb1(0xdf),_0x4e6eb1(0x118)][_0x4e6eb1(0xc8)](_0x2dae92=>_0x4c1cd5[_0x4e6eb1(0xbe)](_0x2dae92)),_0x5a908f=[_0x4e6eb1(0x113),'bewegung',_0x4e6eb1(0xce),_0x4e6eb1(0xc4),_0x4e6eb1(0xb2)]['some'](_0x10a84a=>_0x4c1cd5[_0x4e6eb1(0xbe)](_0x10a84a));if(_0x401f11[_0x4e6eb1(0xd7)]&&(_0x55c475||_0x6a1235||_0x5a908f)){const _0x5041e4=_0x50f8e6===!![]||typeof _0x50f8e6===_0x4e6eb1(0x117)&&_0x50f8e6>0x0,_0x29b3a5=_0x55c475&&!_0x5041e4&&_0x387e9c!==undefined&&_0x387e9c!=_0x50f8e6;if(_0x5041e4||_0x29b3a5){const _0x1c1cf2=_0x376674[_0x4e6eb1(0xf9)]||_0x5e9562,_0x580278=(_0x5e9562-_0x1c1cf2)/0x3e8;_0x376674[_0x4e6eb1(0xf9)]=_0x5e9562,_0x376674[_0x4e6eb1(0xac)](_0x4e6eb1(0xf0),{'room':_0x401f11['location'],'dt':_0x580278});}}}return _0x1ae1a0;}module[a5_0x3f126b(0x11c)]={'processSensorEvent':processSensorEvent,'getOutsideTemperatureNumeric':getOutsideTemperatureNumeric,'setPresence':setPresence,'abortExitTimer':abortExitTimer,'startExitTimer':startExitTimer};