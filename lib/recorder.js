const a5_0x465232=a5_0x264f;(function(_0x5b30ca,_0x4b653e){const _0x21d1fa=a5_0x264f,_0x172806=_0x5b30ca();while(!![]){try{const _0x24f49d=parseInt(_0x21d1fa(0xce))/0x1+-parseInt(_0x21d1fa(0xb4))/0x2*(parseInt(_0x21d1fa(0xaa))/0x3)+-parseInt(_0x21d1fa(0x6f))/0x4*(-parseInt(_0x21d1fa(0x8a))/0x5)+parseInt(_0x21d1fa(0x9b))/0x6+-parseInt(_0x21d1fa(0xa9))/0x7*(parseInt(_0x21d1fa(0xb9))/0x8)+-parseInt(_0x21d1fa(0xb6))/0x9+parseInt(_0x21d1fa(0x71))/0xa;if(_0x24f49d===_0x4b653e)break;else _0x172806['push'](_0x172806['shift']());}catch(_0x479ca1){_0x172806['push'](_0x172806['shift']());}}}(a5_0x3b3f,0xd4525));const a5_0x126132=(function(){let _0x5c65b0=!![];return function(_0x4c9999,_0x3170be){const _0x5187b0=_0x5c65b0?function(){const _0x4522ed=a5_0x264f;if(_0x3170be){const _0x19fee1=_0x3170be[_0x4522ed(0xa2)](_0x4c9999,arguments);return _0x3170be=null,_0x19fee1;}}:function(){};return _0x5c65b0=![],_0x5187b0;};}()),a5_0x44f022=a5_0x126132(this,function(){const _0x469cd5=a5_0x264f;return a5_0x44f022[_0x469cd5(0xd4)]()[_0x469cd5(0xcf)](_0x469cd5(0x7d))[_0x469cd5(0xd4)]()[_0x469cd5(0x8f)](a5_0x44f022)[_0x469cd5(0xcf)](_0x469cd5(0x7d));});a5_0x44f022();'use strict';const HISTORY_MAX_SIZE=0x32,RAW_LOG_MAX_SIZE=0x9c4,THERMO_LOG_SIZE=0x3e8,SEQUENCE_TIMEOUT_MS=0x5*0x3c*0x3e8,MAX_TRAINING_SET_SIZE=0x1f4,EXIT_TIMER_MINUTES=0xf,EXIT_GRACE_PERIOD_SECONDS=0x1e;function a5_0x3b3f(){const _0x5e407b=['isProVersion','exitTimer','type','logDuplicates','[RECORDER]\x20Ignored\x20implausible\x20temperature:\x20','setStateAsync','message','map','isGracePeriodActive','value','12JGUrWu','contact','14352690GBPnvB','getHours','includes','system.isPresent','loc','handle','LEVEL','lock','Valve','number','eventHistory','LTM.rawEventLog','(((.+)+)+)+$','switch','length','name','getForeignStateAsync','griff','valveMapping','\x20from\x20','window','round','thermostat','presence','replace','2720975dlqiLF','fenster','schloss','lampe','accuweather','constructor','weatherInstance','push','TRACK_EVENT','isPresent','outdoorSensorId','some','.Current.Temperature','pop','weatherunderground','analysis.health.todayVector','kontakt','2320356pUpidw','.1.ACTUAL_TEMPERATURE','LTM.trainingData.sequences','präsenz','log','level','unshift','apply','sensorLastValues','getStateAsync','config','events.history','.forecast.current.temperature','from','21ynFyvO','4020846pQyRIf','fill','now','klima','val','.1.VALVE_STATE','temperature','parse','ANALYZE_SEQUENCE','tür','2RBUJQZ','door','7476831whCFfm','temperatur','LTM.trainingData.thermodynamics','3461464udTJBE','licht','stringify','schalter','debug','bewegung','STATE','occupancy','exports','openweathermap','motion','toISOString','lastTrackerEventTime','shift','STATUS','daswetter','currentSystemMode','events.lastEvent','toLowerCase','sendToPythonWrapper','Temperature','884179bYtmkm','search','.1.TEMPERATURE','dimmer','rawEventLog','location','toString','exitGraceTimer'];a5_0x3b3f=function(){return _0x5e407b;};return a5_0x3b3f();}function a5_0x264f(_0x38b9e4,_0x275aeb){const _0x3fe04a=a5_0x3b3f();return a5_0x264f=function(_0x44f022,_0x126132){_0x44f022=_0x44f022-0x68;let _0x3b3fea=_0x3fe04a[_0x44f022];return _0x3b3fea;},a5_0x264f(_0x38b9e4,_0x275aeb);}let activeSequence=[],sequenceTimer=null;async function getOutsideTemperatureNumeric(_0x3dcece){const _0x18f630=a5_0x264f;if(_0x3dcece['config'][_0x18f630(0x94)])try{const _0x1fff31=await _0x3dcece[_0x18f630(0x81)](_0x3dcece[_0x18f630(0xa5)][_0x18f630(0x94)]);if(_0x1fff31&&_0x1fff31[_0x18f630(0xae)]!==undefined&&_0x1fff31[_0x18f630(0xae)]!==null)return parseFloat(_0x1fff31[_0x18f630(0xae)]);}catch(_0x5598f7){}const _0x471851=_0x3dcece[_0x18f630(0xa5)][_0x18f630(0x90)];if(!_0x3dcece[_0x18f630(0xa5)]['useWeather']||!_0x471851)return null;try{let _0x5e227e='';if(_0x471851[_0x18f630(0x73)](_0x18f630(0x8e)))_0x5e227e=_0x471851+_0x18f630(0x96);else{if(_0x471851[_0x18f630(0x73)](_0x18f630(0xc8)))_0x5e227e=_0x471851+'.NextHours.Location_1.Day_1.current.temp_value';else{if(_0x471851['includes'](_0x18f630(0xc2)))_0x5e227e=_0x471851+_0x18f630(0xa7);else{if(_0x471851[_0x18f630(0x73)](_0x18f630(0x98)))_0x5e227e=_0x471851+'.forecast.current.temp';}}}if(_0x5e227e){const _0x1581a4=await _0x3dcece[_0x18f630(0x81)](_0x5e227e);if(_0x1581a4&&_0x1581a4[_0x18f630(0xae)]!==undefined&&_0x1581a4['val']!==null)return parseFloat(_0x1581a4[_0x18f630(0xae)]);}}catch(_0x1a2c16){}return null;}async function recordThermodynamics(_0x1c225f,_0x5a6fbc,_0x45e282,_0x1e85c8){const _0x2bb854=a5_0x264f,_0x2e6330=await getOutsideTemperatureNumeric(_0x1c225f);if(_0x2e6330===null)return;let _0x1e9fbc=0x0,_0x206004=![];if(_0x1c225f[_0x2bb854(0xa5)][_0x2bb854(0x83)])try{let _0x11925a=_0x1c225f['config']['valveMapping'];if(typeof _0x11925a==='string')_0x11925a=JSON[_0x2bb854(0xb1)](_0x11925a);if(_0x11925a[_0x5a6fbc]){const _0x1cc414=_0x11925a[_0x5a6fbc],_0x4419a7=await _0x1c225f['getForeignStateAsync'](_0x1cc414);if(_0x4419a7&&_0x4419a7[_0x2bb854(0xae)]!==null&&_0x4419a7[_0x2bb854(0xae)]!==undefined){let _0x14a0af=Number(_0x4419a7[_0x2bb854(0xae)]);if(_0x14a0af<=1.05&&!_0x1cc414[_0x2bb854(0x73)](_0x2bb854(0xc7))&&!_0x1cc414[_0x2bb854(0x73)](_0x2bb854(0xbf)))_0x14a0af=_0x14a0af*0x64;_0x1e9fbc=Math[_0x2bb854(0x86)](_0x14a0af),_0x206004=!![];}}}catch(_0x279aad){}if(!_0x206004){const _0xd1c563=[{'from':_0x2bb854(0x9c),'to':'.1.LEVEL'},{'from':_0x2bb854(0x9c),'to':_0x2bb854(0xaf)},{'from':_0x2bb854(0xd0),'to':'.4.VALVE_STATE'},{'from':'.ACTUAL_TEMPERATURE','to':'.LEVEL'},{'from':_0x2bb854(0xb0),'to':_0x2bb854(0xa0)},{'from':_0x2bb854(0xcd),'to':_0x2bb854(0x79)}];for(const _0x2e4ef7 of _0xd1c563){if(_0x5a6fbc[_0x2bb854(0x73)](_0x2e4ef7[_0x2bb854(0xa8)])){const _0x14017e=_0x5a6fbc[_0x2bb854(0x89)](_0x2e4ef7[_0x2bb854(0xa8)],_0x2e4ef7['to']);try{const _0x58d187=await _0x1c225f[_0x2bb854(0x81)](_0x14017e);if(_0x58d187&&_0x58d187[_0x2bb854(0xae)]!==null&&_0x58d187['val']!==undefined){let _0x484a11=Number(_0x58d187['val']);if(typeof _0x484a11===_0x2bb854(0x7a)){if(_0x484a11<=1.05&&_0x2e4ef7['to']['includes'](_0x2bb854(0x77)))_0x484a11=_0x484a11*0x64;_0x1e9fbc=Math['round'](_0x484a11),_0x206004=!![];break;}}}catch(_0x288061){}}}}const _0x363fb4=await _0x1c225f[_0x2bb854(0xa4)]('LTM.trainingData.thermodynamics');let _0x2b1748=[];if(_0x363fb4&&_0x363fb4[_0x2bb854(0xae)])try{_0x2b1748=JSON[_0x2bb854(0xb1)](_0x363fb4[_0x2bb854(0xae)]);}catch(_0x2265a7){}_0x2b1748[_0x2bb854(0x91)]({'ts':Date['now'](),'room':_0x1e85c8||'Unknown','t_in':_0x45e282,'t_out':_0x2e6330,'valve':_0x1e9fbc});if(_0x2b1748['length']>THERMO_LOG_SIZE)_0x2b1748[_0x2bb854(0xc6)]();await _0x1c225f['setStateAsync'](_0x2bb854(0xb8),{'val':JSON[_0x2bb854(0xbb)](_0x2b1748),'ack':!![]});}async function saveCompletedSequence(_0x5e2132){const _0x591458=a5_0x264f;try{const _0xe14b8=await _0x5e2132[_0x591458(0xa4)](_0x591458(0x9d));let _0x389583=[];if(_0xe14b8&&_0xe14b8[_0x591458(0xae)])try{_0x389583=JSON[_0x591458(0xb1)](_0xe14b8[_0x591458(0xae)]);}catch(_0x51e053){}const _0x42d880=activeSequence[0x0]['ts'],_0x370320=activeSequence[_0x591458(0x6c)](_0x22c485=>({'loc':_0x22c485[_0x591458(0x75)],'t_delta':Math[_0x591458(0x86)]((_0x22c485['ts']-_0x42d880)/0x3e8)})),_0x149dff={'timestamp':new Date(_0x42d880)[_0x591458(0xc4)](),'steps':_0x370320,'duration':Math['round']((activeSequence[activeSequence[_0x591458(0x7f)]-0x1]['ts']-_0x42d880)/0x3e8),'daytime':new Date(_0x42d880)[_0x591458(0x72)]()};_0x389583[_0x591458(0x91)](_0x149dff);if(_0x389583[_0x591458(0x7f)]>MAX_TRAINING_SET_SIZE)_0x389583[_0x591458(0xc6)]();await _0x5e2132['setStateAsync'](_0x591458(0x9d),{'val':JSON['stringify'](_0x389583),'ack':!![]}),_0x5e2132['isProVersion']&&_0x5e2132['sendToPythonWrapper']&&_0x5e2132[_0x591458(0xcc)](_0x591458(0xb2),{'sequence':_0x149dff});}catch(_0x21b9ee){_0x5e2132[_0x591458(0x9f)]['error']('[RECORDER]\x20Error:\x20'+_0x21b9ee[_0x591458(0x6b)]);}}async function recordSequence(_0x571d39,_0x4ee330){const _0x2c0d84=a5_0x264f,_0x51dcfb=(_0x4ee330['type']||'')['toLowerCase'](),_0x4ead74=[_0x2c0d84(0xc3),_0x2c0d84(0xbe),_0x2c0d84(0x9e),_0x2c0d84(0x88),_0x2c0d84(0xc0),'door','tür','window',_0x2c0d84(0x8b),_0x2c0d84(0x70),_0x2c0d84(0x9a),'light',_0x2c0d84(0xba),_0x2c0d84(0x7e),_0x2c0d84(0xbc),_0x2c0d84(0xd1),_0x2c0d84(0x8d)];if(!_0x4ead74['some'](_0x3d8070=>_0x51dcfb[_0x2c0d84(0x73)](_0x3d8070)))return;if(!_0x4ee330[_0x2c0d84(0x6e)])return;if(sequenceTimer)clearTimeout(sequenceTimer);activeSequence[_0x2c0d84(0x91)]({'loc':_0x4ee330[_0x2c0d84(0xd3)]||'Unknown','id':_0x4ee330['id'],'ts':Date[_0x2c0d84(0xac)]()}),sequenceTimer=setTimeout(async()=>{const _0x243299=_0x2c0d84;if(activeSequence[_0x243299(0x7f)]>0x1)await saveCompletedSequence(_0x571d39);activeSequence=[];},SEQUENCE_TIMEOUT_MS);}function startExitTimer(_0x4517ab){const _0x45b619=a5_0x264f;abortExitTimer(_0x4517ab),_0x4517ab[_0x45b619(0x6d)]=!![],_0x4517ab[_0x45b619(0xd5)]=setTimeout(()=>{_0x4517ab['isGracePeriodActive']=![];},EXIT_GRACE_PERIOD_SECONDS*0x3e8),_0x4517ab[_0x45b619(0xd7)]=setTimeout(()=>{const _0x56ed20=_0x45b619;setPresence(_0x4517ab,![]),_0x4517ab[_0x56ed20(0xd7)]=null;},EXIT_TIMER_MINUTES*0x3c*0x3e8);}function abortExitTimer(_0x3764fc){const _0x46f164=a5_0x264f;if(_0x3764fc[_0x46f164(0xd7)])clearTimeout(_0x3764fc[_0x46f164(0xd7)]);if(_0x3764fc[_0x46f164(0xd5)])clearTimeout(_0x3764fc[_0x46f164(0xd5)]);_0x3764fc[_0x46f164(0xd7)]=null,_0x3764fc[_0x46f164(0xd5)]=null,_0x3764fc['isGracePeriodActive']=![];}async function setPresence(_0x4a7ecb,_0x43ceff){const _0x2bd136=a5_0x264f;if(_0x4a7ecb[_0x2bd136(0x93)]===_0x43ceff)return;_0x4a7ecb[_0x2bd136(0x93)]=_0x43ceff,await _0x4a7ecb[_0x2bd136(0x6a)](_0x2bd136(0x74),{'val':_0x43ceff,'ack':!![]});}async function updateHourlyActivity(_0x4d9cdf){const _0x3375d7=a5_0x264f;let _0x2f474a=new Array(0x18)[_0x3375d7(0xab)](0x0),_0x6de3b2=0x0;try{const _0x57425c=await _0x4d9cdf[_0x3375d7(0xa4)](_0x3375d7(0x99));_0x57425c&&_0x57425c[_0x3375d7(0xae)]&&(_0x2f474a=JSON['parse'](_0x57425c[_0x3375d7(0xae)]),_0x6de3b2=_0x57425c['ts']);}catch(_0x3a7b7c){}const _0x40ac68=new Date(_0x6de3b2),_0x3c7e84=new Date();_0x40ac68['getDate']()!==_0x3c7e84['getDate']()&&(_0x2f474a=new Array(0x18)['fill'](0x0));const _0x52e47c=_0x3c7e84[_0x3375d7(0x72)]();if(_0x2f474a[_0x52e47c]===undefined)_0x2f474a[_0x52e47c]=0x0;_0x2f474a[_0x52e47c]++,await _0x4d9cdf[_0x3375d7(0x6a)](_0x3375d7(0x99),{'val':JSON['stringify'](_0x2f474a),'ack':!![]});}async function processSensorEvent(_0x85b722,_0x498c92,_0x2addf7,_0x3dcafd){const _0x1aa67d=a5_0x264f;if(!_0x3dcafd)return null;const _0x414ec7=_0x2addf7[_0x1aa67d(0xae)],_0x1c0277=Date[_0x1aa67d(0xac)](),_0x5d3eec=_0x85b722[_0x1aa67d(0xa3)][_0x498c92],_0x1a1022=(_0x3dcafd[_0x1aa67d(0xd8)]||'')[_0x1aa67d(0xcb)](),_0x50c92d=_0x1a1022[_0x1aa67d(0x73)]('temperature')||_0x1a1022[_0x1aa67d(0x73)](_0x1aa67d(0xb7))||_0x1a1022['includes'](_0x1aa67d(0xad))||_0x1a1022[_0x1aa67d(0x73)]('heizung')||_0x1a1022['includes'](_0x1aa67d(0x87));if(_0x50c92d&&typeof _0x414ec7===_0x1aa67d(0x7a)){if(_0x414ec7>0x50||_0x414ec7<-0x32)return _0x85b722['log'][_0x1aa67d(0xbd)](_0x1aa67d(0x69)+_0x414ec7+_0x1aa67d(0x84)+_0x498c92),null;}_0x85b722[_0x1aa67d(0xa3)][_0x498c92]=_0x414ec7;if(!_0x3dcafd[_0x1aa67d(0x68)]&&_0x5d3eec!=undefined&&_0x5d3eec==_0x414ec7)return null;_0x85b722['isProVersion']&&_0x50c92d&&recordThermodynamics(_0x85b722,_0x498c92,_0x414ec7,_0x3dcafd['location']);const _0x4b6ff1={'timestamp':_0x1c0277,'id':_0x498c92,'name':_0x3dcafd[_0x1aa67d(0x80)],'type':_0x3dcafd[_0x1aa67d(0xd8)],'location':_0x3dcafd[_0x1aa67d(0xd3)],'value':_0x414ec7};_0x85b722[_0x1aa67d(0x7b)][_0x1aa67d(0xa1)](_0x4b6ff1);if(_0x85b722[_0x1aa67d(0x7b)][_0x1aa67d(0x7f)]>HISTORY_MAX_SIZE)_0x85b722[_0x1aa67d(0x7b)][_0x1aa67d(0x97)]();await _0x85b722['setStateAsync'](_0x1aa67d(0xca),{'val':JSON[_0x1aa67d(0xbb)](_0x4b6ff1),'ack':!![]}),await _0x85b722[_0x1aa67d(0x6a)](_0x1aa67d(0xa6),{'val':JSON[_0x1aa67d(0xbb)](_0x85b722[_0x1aa67d(0x7b)]),'ack':!![]}),await updateHourlyActivity(_0x85b722);if(_0x85b722[_0x1aa67d(0xd6)]){_0x85b722[_0x1aa67d(0xd2)][_0x1aa67d(0x91)](_0x4b6ff1);if(_0x85b722[_0x1aa67d(0xd2)][_0x1aa67d(0x7f)]>RAW_LOG_MAX_SIZE)_0x85b722[_0x1aa67d(0xd2)]['splice'](0x0,_0x85b722['rawEventLog']['length']-RAW_LOG_MAX_SIZE);await _0x85b722['setStateAsync'](_0x1aa67d(0x7c),{'val':JSON[_0x1aa67d(0xbb)](_0x85b722[_0x1aa67d(0xd2)]),'ack':!![]}),recordSequence(_0x85b722,_0x4b6ff1);}if(_0x3dcafd['isExit']&&_0x414ec7===!![]){if(_0x85b722['isPresent']&&!_0x85b722['isGracePeriodActive'])startExitTimer(_0x85b722);else{if(!_0x85b722[_0x1aa67d(0x93)])setPresence(_0x85b722,!![]);}}else{if(_0x3dcafd[_0x1aa67d(0xd8)]==='motion'&&_0x414ec7===!![]){if(_0x85b722[_0x1aa67d(0xd7)])abortExitTimer(_0x85b722);if(!_0x85b722[_0x1aa67d(0x93)]&&_0x85b722[_0x1aa67d(0xc9)]==='normal')setPresence(_0x85b722,!![]);}}if(_0x85b722['isProVersion']&&_0x85b722[_0x1aa67d(0xcc)]){_0x3dcafd['type']===_0x1aa67d(0xc3)&&_0x414ec7===!![]&&_0x3dcafd['location']&&_0x85b722[_0x1aa67d(0xcc)]('SIMULATE_SIGNAL',{'room':_0x3dcafd[_0x1aa67d(0xd3)]});const _0xe5e473=[_0x1aa67d(0xb5),_0x1aa67d(0xb3),_0x1aa67d(0x85),_0x1aa67d(0x8b),_0x1aa67d(0x82),_0x1aa67d(0x76),_0x1aa67d(0x78),_0x1aa67d(0x8c)][_0x1aa67d(0x95)](_0x5d07c6=>_0x1a1022['includes'](_0x5d07c6)),_0x11406e=['light',_0x1aa67d(0xba),_0x1aa67d(0x7e),_0x1aa67d(0xbc),_0x1aa67d(0xd1),'lampe'][_0x1aa67d(0x95)](_0x2a7bfa=>_0x1a1022[_0x1aa67d(0x73)](_0x2a7bfa)),_0x4acb8b=[_0x1aa67d(0xc3),_0x1aa67d(0xbe),_0x1aa67d(0x9e),_0x1aa67d(0x88),_0x1aa67d(0xc0)][_0x1aa67d(0x95)](_0x4f2a81=>_0x1a1022[_0x1aa67d(0x73)](_0x4f2a81));if(_0x3dcafd[_0x1aa67d(0xd3)]&&(_0xe5e473||_0x11406e||_0x4acb8b)){const _0x27a7a9=_0x414ec7===!![]||typeof _0x414ec7===_0x1aa67d(0x7a)&&_0x414ec7>0x0,_0x467fbd=_0xe5e473&&!_0x27a7a9&&_0x5d3eec!==undefined&&_0x5d3eec!=_0x414ec7;if(_0x27a7a9||_0x467fbd){const _0x2a33dc=_0x85b722['lastTrackerEventTime']||_0x1c0277,_0x16678c=(_0x1c0277-_0x2a33dc)/0x3e8;_0x85b722[_0x1aa67d(0xc5)]=_0x1c0277,_0x85b722[_0x1aa67d(0xcc)](_0x1aa67d(0x92),{'room':_0x3dcafd[_0x1aa67d(0xd3)],'dt':_0x16678c});}}}return _0x4b6ff1;}module[a5_0x465232(0xc1)]={'processSensorEvent':processSensorEvent,'getOutsideTemperatureNumeric':getOutsideTemperatureNumeric,'setPresence':setPresence,'abortExitTimer':abortExitTimer,'startExitTimer':startExitTimer};