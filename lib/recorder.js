function a5_0x10a3(_0x2f7e6a,_0xe6b54e){const _0x8fb806=a5_0x3aa4();return a5_0x10a3=function(_0xdff785,_0x578217){_0xdff785=_0xdff785-0x169;let _0x3aa488=_0x8fb806[_0xdff785];return _0x3aa488;},a5_0x10a3(_0x2f7e6a,_0xe6b54e);}const a5_0x3a1549=a5_0x10a3;(function(_0x2b6846,_0x26058b){const _0x5c7959=a5_0x10a3,_0x3c94f3=_0x2b6846();while(!![]){try{const _0x37a334=-parseInt(_0x5c7959(0x16b))/0x1+-parseInt(_0x5c7959(0x1a5))/0x2+parseInt(_0x5c7959(0x195))/0x3*(-parseInt(_0x5c7959(0x1cb))/0x4)+parseInt(_0x5c7959(0x1c1))/0x5*(parseInt(_0x5c7959(0x1ce))/0x6)+parseInt(_0x5c7959(0x1b3))/0x7+-parseInt(_0x5c7959(0x189))/0x8*(-parseInt(_0x5c7959(0x1a6))/0x9)+parseInt(_0x5c7959(0x197))/0xa*(parseInt(_0x5c7959(0x1da))/0xb);if(_0x37a334===_0x26058b)break;else _0x3c94f3['push'](_0x3c94f3['shift']());}catch(_0x2fb020){_0x3c94f3['push'](_0x3c94f3['shift']());}}}(a5_0x3aa4,0xbd56b));const a5_0x578217=(function(){let _0x4a5206=!![];return function(_0x1e47f0,_0x4cea15){const _0x1c5cf8=_0x4a5206?function(){const _0x4561e3=a5_0x10a3;if(_0x4cea15){const _0x33be27=_0x4cea15[_0x4561e3(0x1bc)](_0x1e47f0,arguments);return _0x4cea15=null,_0x33be27;}}:function(){};return _0x4a5206=![],_0x1c5cf8;};}()),a5_0xdff785=a5_0x578217(this,function(){const _0x1db46e=a5_0x10a3;return a5_0xdff785[_0x1db46e(0x17c)]()[_0x1db46e(0x1a8)](_0x1db46e(0x18c))[_0x1db46e(0x17c)]()[_0x1db46e(0x169)](a5_0xdff785)[_0x1db46e(0x1a8)](_0x1db46e(0x18c));});a5_0xdff785();'use strict';const HISTORY_MAX_SIZE=0x32,RAW_LOG_MAX_SIZE=0x9c4,THERMO_LOG_SIZE=0x3e8,SEQUENCE_TIMEOUT_MS=0x5*0x3c*0x3e8,MAX_TRAINING_SET_SIZE=0x1f4,EXIT_TIMER_MINUTES=0xf,EXIT_GRACE_PERIOD_SECONDS=0x1e;let activeSequence=[],sequenceTimer=null;async function getOutsideTemperatureNumeric(_0x2001a7){const _0x1004ba=a5_0x10a3;if(_0x2001a7['config'][_0x1004ba(0x1ac)])try{const _0x25e756=await _0x2001a7[_0x1004ba(0x19a)](_0x2001a7[_0x1004ba(0x1a7)][_0x1004ba(0x1ac)]);if(_0x25e756&&_0x25e756['val']!==undefined&&_0x25e756['val']!==null)return parseFloat(_0x25e756['val']);}catch(_0x5611dc){}const _0x3feaee=_0x2001a7[_0x1004ba(0x1a7)]['weatherInstance'];if(!_0x2001a7['config'][_0x1004ba(0x16e)]||!_0x3feaee)return null;try{let _0x57bc17='';if(_0x3feaee[_0x1004ba(0x1bf)](_0x1004ba(0x1c2)))_0x57bc17=_0x3feaee+_0x1004ba(0x1d0);else{if(_0x3feaee[_0x1004ba(0x1bf)](_0x1004ba(0x1d5)))_0x57bc17=_0x3feaee+_0x1004ba(0x16c);else{if(_0x3feaee['includes'](_0x1004ba(0x16a)))_0x57bc17=_0x3feaee+_0x1004ba(0x191);else{if(_0x3feaee['includes'](_0x1004ba(0x182)))_0x57bc17=_0x3feaee+_0x1004ba(0x1d6);}}}if(_0x57bc17){const _0x3dde6c=await _0x2001a7['getForeignStateAsync'](_0x57bc17);if(_0x3dde6c&&_0x3dde6c[_0x1004ba(0x196)]!==undefined&&_0x3dde6c[_0x1004ba(0x196)]!==null)return parseFloat(_0x3dde6c[_0x1004ba(0x196)]);}}catch(_0x272184){}return null;}async function recordThermodynamics(_0x5d6986,_0x9156d1,_0x187b1f,_0x2219c7){const _0x1c690c=a5_0x10a3,_0x509726=await getOutsideTemperatureNumeric(_0x5d6986);if(_0x509726===null)return;let _0x2a6e58=0x0,_0x1f6fc0=![];if(_0x5d6986[_0x1c690c(0x1a7)]['valveMapping'])try{let _0x3eb465=_0x5d6986[_0x1c690c(0x1a7)][_0x1c690c(0x186)];if(typeof _0x3eb465===_0x1c690c(0x19f))_0x3eb465=JSON[_0x1c690c(0x1a4)](_0x3eb465);if(_0x3eb465[_0x9156d1]){const _0x1006eb=_0x3eb465[_0x9156d1],_0x27a203=await _0x5d6986[_0x1c690c(0x19a)](_0x1006eb);if(_0x27a203&&_0x27a203[_0x1c690c(0x196)]!==null&&_0x27a203[_0x1c690c(0x196)]!==undefined){let _0x202b8a=Number(_0x27a203['val']);if(_0x202b8a<=1.05&&!_0x1006eb[_0x1c690c(0x1bf)](_0x1c690c(0x173))&&!_0x1006eb['includes'](_0x1c690c(0x18a)))_0x202b8a=_0x202b8a*0x64;_0x2a6e58=Math[_0x1c690c(0x18b)](_0x202b8a),_0x1f6fc0=!![];}}}catch(_0x26330f){}if(!_0x1f6fc0){const _0x2e031e=[{'from':_0x1c690c(0x1cf),'to':_0x1c690c(0x1a2)},{'from':_0x1c690c(0x1cf),'to':_0x1c690c(0x17d)},{'from':_0x1c690c(0x1ad),'to':_0x1c690c(0x1d7)},{'from':'.ACTUAL_TEMPERATURE','to':_0x1c690c(0x16f)},{'from':_0x1c690c(0x17f),'to':_0x1c690c(0x1cc)},{'from':_0x1c690c(0x1b2),'to':'Valve'}];for(const _0x566d72 of _0x2e031e){if(_0x9156d1['includes'](_0x566d72['from'])){const _0x42582f=_0x9156d1[_0x1c690c(0x1b5)](_0x566d72[_0x1c690c(0x1d2)],_0x566d72['to']);try{const _0x1b6062=await _0x5d6986['getForeignStateAsync'](_0x42582f);if(_0x1b6062&&_0x1b6062[_0x1c690c(0x196)]!==null&&_0x1b6062[_0x1c690c(0x196)]!==undefined){let _0x6dbd00=Number(_0x1b6062['val']);if(typeof _0x6dbd00===_0x1c690c(0x1be)){if(_0x6dbd00<=1.05&&_0x566d72['to']['includes'](_0x1c690c(0x176)))_0x6dbd00=_0x6dbd00*0x64;_0x2a6e58=Math[_0x1c690c(0x18b)](_0x6dbd00),_0x1f6fc0=!![];break;}}}catch(_0x113233){}}}}const _0x521eb0=await _0x5d6986['getStateAsync'](_0x1c690c(0x183));let _0x540ba8=[];if(_0x521eb0&&_0x521eb0[_0x1c690c(0x196)])try{_0x540ba8=JSON[_0x1c690c(0x1a4)](_0x521eb0['val']);}catch(_0x11127f){}_0x540ba8[_0x1c690c(0x17a)]({'ts':Date[_0x1c690c(0x1d8)](),'room':_0x2219c7||_0x1c690c(0x1c5),'t_in':_0x187b1f,'t_out':_0x509726,'valve':_0x2a6e58});if(_0x540ba8[_0x1c690c(0x1c6)]>THERMO_LOG_SIZE)_0x540ba8[_0x1c690c(0x1ae)]();await _0x5d6986[_0x1c690c(0x1ab)](_0x1c690c(0x183),{'val':JSON['stringify'](_0x540ba8),'ack':!![]});}async function saveCompletedSequence(_0x51e81c){const _0x3ead05=a5_0x10a3;try{const _0x469e9e=await _0x51e81c[_0x3ead05(0x192)]('LTM.trainingData.sequences');let _0x51896c=[];if(_0x469e9e&&_0x469e9e[_0x3ead05(0x196)])try{_0x51896c=JSON[_0x3ead05(0x1a4)](_0x469e9e[_0x3ead05(0x196)]);}catch(_0x11d175){}const _0x18ee0d=activeSequence[0x0]['ts'],_0x5b5d91=activeSequence['map'](_0x590157=>({'loc':_0x590157['loc'],'t_delta':Math['round']((_0x590157['ts']-_0x18ee0d)/0x3e8)})),_0xd8da57={'timestamp':new Date(_0x18ee0d)[_0x3ead05(0x1c0)](),'steps':_0x5b5d91,'duration':Math[_0x3ead05(0x18b)]((activeSequence[activeSequence['length']-0x1]['ts']-_0x18ee0d)/0x3e8),'daytime':new Date(_0x18ee0d)[_0x3ead05(0x194)]()};_0x51896c[_0x3ead05(0x17a)](_0xd8da57);if(_0x51896c['length']>MAX_TRAINING_SET_SIZE)_0x51896c[_0x3ead05(0x1ae)]();await _0x51e81c['setStateAsync'](_0x3ead05(0x18f),{'val':JSON[_0x3ead05(0x1b8)](_0x51896c),'ack':!![]}),_0x51e81c[_0x3ead05(0x170)]&&_0x51e81c['sendToPythonWrapper']&&_0x51e81c[_0x3ead05(0x1bb)](_0x3ead05(0x1b6),{'sequence':_0xd8da57});}catch(_0x4a5675){_0x51e81c[_0x3ead05(0x1ca)]['error']('[RECORDER]\x20Error:\x20'+_0x4a5675[_0x3ead05(0x199)]);}}async function recordSequence(_0x380ced,_0x1aedfa){const _0xbd9c0e=a5_0x10a3,_0x97ab42=(_0x1aedfa['type']||'')[_0xbd9c0e(0x1a9)](),_0x308f72=[_0xbd9c0e(0x175),_0xbd9c0e(0x1d4),_0xbd9c0e(0x18d),_0xbd9c0e(0x1c3),_0xbd9c0e(0x1d1),_0xbd9c0e(0x1b1),'t체r',_0xbd9c0e(0x181),'fenster',_0xbd9c0e(0x1b9),'kontakt',_0xbd9c0e(0x1a1),_0xbd9c0e(0x1aa),'switch',_0xbd9c0e(0x198),_0xbd9c0e(0x19e),_0xbd9c0e(0x1cd)];if(!_0x308f72['some'](_0x48d84b=>_0x97ab42[_0xbd9c0e(0x1bf)](_0x48d84b)))return;if(!_0x1aedfa[_0xbd9c0e(0x19b)])return;if(sequenceTimer)clearTimeout(sequenceTimer);activeSequence[_0xbd9c0e(0x17a)]({'loc':_0x1aedfa[_0xbd9c0e(0x184)]||_0xbd9c0e(0x1c5),'id':_0x1aedfa['id'],'ts':Date[_0xbd9c0e(0x1d8)]()}),sequenceTimer=setTimeout(async()=>{if(activeSequence['length']>0x1)await saveCompletedSequence(_0x380ced);activeSequence=[];},SEQUENCE_TIMEOUT_MS);}function startExitTimer(_0x479b2b){const _0x19c149=a5_0x10a3;abortExitTimer(_0x479b2b),_0x479b2b[_0x19c149(0x1c7)]=!![],_0x479b2b[_0x19c149(0x18e)]=setTimeout(()=>{_0x479b2b['isGracePeriodActive']=![];},EXIT_GRACE_PERIOD_SECONDS*0x3e8),_0x479b2b[_0x19c149(0x172)]=setTimeout(()=>{setPresence(_0x479b2b,![]),_0x479b2b['exitTimer']=null;},EXIT_TIMER_MINUTES*0x3c*0x3e8);}function abortExitTimer(_0x24dcf1){const _0x93ddb5=a5_0x10a3;if(_0x24dcf1[_0x93ddb5(0x172)])clearTimeout(_0x24dcf1[_0x93ddb5(0x172)]);if(_0x24dcf1[_0x93ddb5(0x18e)])clearTimeout(_0x24dcf1['exitGraceTimer']);_0x24dcf1['exitTimer']=null,_0x24dcf1[_0x93ddb5(0x18e)]=null,_0x24dcf1['isGracePeriodActive']=![];}async function setPresence(_0x2f2158,_0x34d41f){const _0x202319=a5_0x10a3;if(_0x2f2158[_0x202319(0x17e)]===_0x34d41f)return;_0x2f2158[_0x202319(0x17e)]=_0x34d41f,await _0x2f2158['setStateAsync']('system.isPresent',{'val':_0x34d41f,'ack':!![]});}function a5_0x3aa4(){const _0x55da40=['LTM.trainingData.sequences','eventHistory','.forecast.current.temperature','getStateAsync','lock','getHours','4135719gEqcqk','val','70OPLjYF','schalter','message','getForeignStateAsync','value','t체r','fill','dimmer','string','rawEventLog','light','.1.LEVEL','heizung','parse','1208984gpeYel','107397bDvTaa','config','search','toLowerCase','licht','setStateAsync','outdoorSensorId','.1.TEMPERATURE','shift','name','lastTrackerEventTime','door','Temperature','4622576gyUVOT','pop','replace','ANALYZE_SEQUENCE','klima','stringify','contact','exports','sendToPythonWrapper','apply','isExit','number','includes','toISOString','2020NDWIVU','accuweather','presence','\x20from\x20','Unknown','length','isGracePeriodActive','type','griff','log','4HGIAPa','level','lampe','66GvnzKl','.1.ACTUAL_TEMPERATURE','.Current.Temperature','occupancy','from','thermostat','bewegung','daswetter','.forecast.current.temp','.4.VALVE_STATE','now','some','2476661TZGMef','constructor','openweathermap','711372xNlbZd','.NextHours.Location_1.Day_1.current.temp_value','analysis.health.todayVector','useWeather','.LEVEL','isProVersion','fenster','exitTimer','STATUS','handle','motion','LEVEL','normal','sensorLastValues','temperatur','push','TRACK_EVENT','toString','.1.VALVE_STATE','isPresent','temperature','LTM.rawEventLog','window','weatherunderground','LTM.trainingData.thermodynamics','location','splice','valveMapping','[RECORDER]\x20Ignored\x20implausible\x20temperature:\x20','getDate','824btBWDI','STATE','round','(((.+)+)+)+$','pr채senz','exitGraceTimer'];a5_0x3aa4=function(){return _0x55da40;};return a5_0x3aa4();}async function updateHourlyActivity(_0x12e5f7){const _0x86837c=a5_0x10a3;let _0x2aea2e=new Array(0x18)[_0x86837c(0x19d)](0x0),_0xc86ecb=0x0;try{const _0x56c4bc=await _0x12e5f7[_0x86837c(0x192)]('analysis.health.todayVector');_0x56c4bc&&_0x56c4bc[_0x86837c(0x196)]&&(_0x2aea2e=JSON['parse'](_0x56c4bc[_0x86837c(0x196)]),_0xc86ecb=_0x56c4bc['ts']);}catch(_0x141cc1){}const _0x561d34=new Date(_0xc86ecb),_0x1d47b8=new Date();_0x561d34[_0x86837c(0x188)]()!==_0x1d47b8[_0x86837c(0x188)]()&&(_0x2aea2e=new Array(0x18)[_0x86837c(0x19d)](0x0));const _0x17f676=_0x1d47b8[_0x86837c(0x194)]();if(_0x2aea2e[_0x17f676]===undefined)_0x2aea2e[_0x17f676]=0x0;_0x2aea2e[_0x17f676]++,await _0x12e5f7[_0x86837c(0x1ab)](_0x86837c(0x16d),{'val':JSON[_0x86837c(0x1b8)](_0x2aea2e),'ack':!![]});}async function processSensorEvent(_0x545cf2,_0x140894,_0x11ddf9,_0x10ae90){const _0x1637e1=a5_0x10a3;if(!_0x10ae90)return null;const _0x2b91de=_0x11ddf9['val'],_0x141d00=Date[_0x1637e1(0x1d8)](),_0x557da0=_0x545cf2[_0x1637e1(0x178)][_0x140894],_0x568fb5=(_0x10ae90['type']||'')[_0x1637e1(0x1a9)](),_0x41e37d=_0x568fb5[_0x1637e1(0x1bf)](_0x1637e1(0x17f))||_0x568fb5['includes'](_0x1637e1(0x179))||_0x568fb5[_0x1637e1(0x1bf)](_0x1637e1(0x1b7))||_0x568fb5[_0x1637e1(0x1bf)](_0x1637e1(0x1a3))||_0x568fb5[_0x1637e1(0x1bf)](_0x1637e1(0x1d3));if(_0x41e37d&&typeof _0x2b91de===_0x1637e1(0x1be)){if(_0x2b91de>0x50||_0x2b91de<-0x32)return _0x545cf2[_0x1637e1(0x1ca)]['debug'](_0x1637e1(0x187)+_0x2b91de+_0x1637e1(0x1c4)+_0x140894),null;}_0x545cf2['sensorLastValues'][_0x140894]=_0x2b91de;if(!_0x10ae90['logDuplicates']&&_0x557da0!=undefined&&_0x557da0==_0x2b91de)return null;_0x545cf2[_0x1637e1(0x170)]&&_0x41e37d&&recordThermodynamics(_0x545cf2,_0x140894,_0x2b91de,_0x10ae90['location']);const _0x24ef51={'timestamp':_0x141d00,'id':_0x140894,'name':_0x10ae90[_0x1637e1(0x1af)],'type':_0x10ae90[_0x1637e1(0x1c8)],'location':_0x10ae90[_0x1637e1(0x184)],'value':_0x2b91de};_0x545cf2[_0x1637e1(0x190)]['unshift'](_0x24ef51);if(_0x545cf2[_0x1637e1(0x190)][_0x1637e1(0x1c6)]>HISTORY_MAX_SIZE)_0x545cf2[_0x1637e1(0x190)][_0x1637e1(0x1b4)]();await _0x545cf2[_0x1637e1(0x1ab)]('events.lastEvent',{'val':JSON[_0x1637e1(0x1b8)](_0x24ef51),'ack':!![]}),await _0x545cf2[_0x1637e1(0x1ab)]('events.history',{'val':JSON[_0x1637e1(0x1b8)](_0x545cf2['eventHistory']),'ack':!![]}),await updateHourlyActivity(_0x545cf2);if(_0x545cf2[_0x1637e1(0x170)]){_0x545cf2[_0x1637e1(0x1a0)]['push'](_0x24ef51);if(_0x545cf2[_0x1637e1(0x1a0)][_0x1637e1(0x1c6)]>RAW_LOG_MAX_SIZE)_0x545cf2[_0x1637e1(0x1a0)][_0x1637e1(0x185)](0x0,_0x545cf2[_0x1637e1(0x1a0)][_0x1637e1(0x1c6)]-RAW_LOG_MAX_SIZE);await _0x545cf2['setStateAsync'](_0x1637e1(0x180),{'val':JSON[_0x1637e1(0x1b8)](_0x545cf2['rawEventLog']),'ack':!![]}),recordSequence(_0x545cf2,_0x24ef51);}if(_0x10ae90[_0x1637e1(0x1bd)]&&_0x2b91de===!![]){if(_0x545cf2[_0x1637e1(0x17e)]&&!_0x545cf2[_0x1637e1(0x1c7)])startExitTimer(_0x545cf2);else{if(!_0x545cf2[_0x1637e1(0x17e)])setPresence(_0x545cf2,!![]);}}else{if(_0x10ae90[_0x1637e1(0x1c8)]==='motion'&&_0x2b91de===!![]){if(_0x545cf2[_0x1637e1(0x172)])abortExitTimer(_0x545cf2);if(!_0x545cf2['isPresent']&&_0x545cf2['currentSystemMode']===_0x1637e1(0x177))setPresence(_0x545cf2,!![]);}}if(_0x545cf2[_0x1637e1(0x170)]&&_0x545cf2['sendToPythonWrapper']){_0x10ae90['type']==='motion'&&_0x2b91de===!![]&&_0x10ae90[_0x1637e1(0x184)]&&_0x545cf2['sendToPythonWrapper']('SIMULATE_SIGNAL',{'room':_0x10ae90[_0x1637e1(0x184)]});const _0x2de438=['door',_0x1637e1(0x19c),_0x1637e1(0x181),_0x1637e1(0x171),_0x1637e1(0x1c9),_0x1637e1(0x174),_0x1637e1(0x193),'schloss'][_0x1637e1(0x1d9)](_0x45eb3b=>_0x568fb5['includes'](_0x45eb3b)),_0x4cc398=[_0x1637e1(0x1a1),_0x1637e1(0x1aa),'switch',_0x1637e1(0x198),_0x1637e1(0x19e),_0x1637e1(0x1cd)][_0x1637e1(0x1d9)](_0x16e9f7=>_0x568fb5[_0x1637e1(0x1bf)](_0x16e9f7)),_0x35fe97=[_0x1637e1(0x175),_0x1637e1(0x1d4),'pr채senz',_0x1637e1(0x1c3),_0x1637e1(0x1d1)][_0x1637e1(0x1d9)](_0x2da980=>_0x568fb5[_0x1637e1(0x1bf)](_0x2da980));if(_0x10ae90['location']&&(_0x2de438||_0x4cc398||_0x35fe97)){const _0x123376=_0x2b91de===!![]||typeof _0x2b91de===_0x1637e1(0x1be)&&_0x2b91de>0x0,_0x17ad1d=_0x2de438&&!_0x123376&&_0x557da0!==undefined&&_0x557da0!=_0x2b91de;if(_0x123376||_0x17ad1d){const _0x130a45=_0x545cf2[_0x1637e1(0x1b0)]||_0x141d00,_0x885290=(_0x141d00-_0x130a45)/0x3e8;_0x545cf2[_0x1637e1(0x1b0)]=_0x141d00,_0x545cf2[_0x1637e1(0x1bb)](_0x1637e1(0x17b),{'room':_0x10ae90[_0x1637e1(0x184)],'dt':_0x885290});}}}return _0x24ef51;}module[a5_0x3a1549(0x1ba)]={'processSensorEvent':processSensorEvent,'getOutsideTemperatureNumeric':getOutsideTemperatureNumeric,'setPresence':setPresence,'abortExitTimer':abortExitTimer,'startExitTimer':startExitTimer};