const a5_0x26eb85=a5_0x6033;(function(_0x2a2c06,_0x3b3cf0){const _0x5511f4=a5_0x6033,_0x314113=_0x2a2c06();while(!![]){try{const _0x31c9c6=parseInt(_0x5511f4(0x1fb))/0x1+parseInt(_0x5511f4(0x20a))/0x2+-parseInt(_0x5511f4(0x228))/0x3+-parseInt(_0x5511f4(0x226))/0x4+parseInt(_0x5511f4(0x1e4))/0x5*(-parseInt(_0x5511f4(0x21b))/0x6)+-parseInt(_0x5511f4(0x201))/0x7*(-parseInt(_0x5511f4(0x238))/0x8)+-parseInt(_0x5511f4(0x1ef))/0x9*(-parseInt(_0x5511f4(0x236))/0xa);if(_0x31c9c6===_0x3b3cf0)break;else _0x314113['push'](_0x314113['shift']());}catch(_0x4d2143){_0x314113['push'](_0x314113['shift']());}}}(a5_0x1c16,0x4574b));const a5_0x67ae59=(function(){let _0x40a6ff=!![];return function(_0x150584,_0x2ae253){const _0x3e529d=_0x40a6ff?function(){const _0x5dbe51=a5_0x6033;if(_0x2ae253){const _0x5b313a=_0x2ae253[_0x5dbe51(0x1f7)](_0x150584,arguments);return _0x2ae253=null,_0x5b313a;}}:function(){};return _0x40a6ff=![],_0x3e529d;};}()),a5_0x68345f=a5_0x67ae59(this,function(){const _0x104b46=a5_0x6033;return a5_0x68345f[_0x104b46(0x1ee)]()[_0x104b46(0x222)](_0x104b46(0x224))['toString']()['constructor'](a5_0x68345f)[_0x104b46(0x222)](_0x104b46(0x224));});a5_0x68345f();'use strict';function a5_0x1c16(){const _0x97207d=['message','events.lastEvent','value','temperatur','.forecast.current.temp','klima','isGracePeriodActive','openweathermap','318762JvMExF','accuweather','ANALYZE_SEQUENCE','lampe','exports','temperature','useWeather','schalter','toISOString','exitGraceTimer','name','isPresent','unshift','light','currentSystemMode','dimmer','licht','114gYYfkZ','LTM.trainingData.thermodynamics','logDuplicates','fenster','daswetter','switch','parse','search','exitTimer','(((.+)+)+)+$','LTM.rawEventLog','481708DvKYHr','eventHistory','1098843QRGElK','tür','präsenz','.NextHours.Location_1.Day_1.current.temp_value','loc','some','SIMULATE_SIGNAL','now','shift','[RECORDER]\x20Error:\x20','isExit','pop','toLowerCase','motion','538740jJwVke','splice','953776lXNpAW','val','.Current.Temperature','rawEventLog','location','getForeignStateAsync','bewegung','weatherunderground','error','77865EzbHuX','isProVersion','stringify','setStateAsync','config','sendToPythonWrapper','includes','normal','events.history','outdoorSensorId','toString','36weuUes','kontakt','round','type','push','getStateAsync','length','system.isPresent','apply','door','sensorLastValues','weatherInstance','334543AGeweK','map','window','LTM.trainingData.sequences','presence','Unknown','21rgoSIW'];a5_0x1c16=function(){return _0x97207d;};return a5_0x1c16();}function a5_0x6033(_0xd29727,_0x34d3e6){const _0x5e7847=a5_0x1c16();return a5_0x6033=function(_0x68345f,_0x67ae59){_0x68345f=_0x68345f-0x1dc;let _0x1c165c=_0x5e7847[_0x68345f];return _0x1c165c;},a5_0x6033(_0xd29727,_0x34d3e6);}const HISTORY_MAX_SIZE=0x32,RAW_LOG_MAX_SIZE=0x9c4,THERMO_LOG_SIZE=0x3e8,SEQUENCE_TIMEOUT_MS=0x5*0x3c*0x3e8,MAX_TRAINING_SET_SIZE=0x1f4,EXIT_TIMER_MINUTES=0xf,EXIT_GRACE_PERIOD_SECONDS=0x1e;let activeSequence=[],sequenceTimer=null;async function getOutsideTemperatureNumeric(_0x56391b){const _0x63704c=a5_0x6033;if(_0x56391b[_0x63704c(0x1e8)][_0x63704c(0x1ed)])try{const _0x5d91cc=await _0x56391b['getForeignStateAsync'](_0x56391b[_0x63704c(0x1e8)][_0x63704c(0x1ed)]);if(_0x5d91cc&&_0x5d91cc[_0x63704c(0x1dc)]!==undefined&&_0x5d91cc[_0x63704c(0x1dc)]!==null)return parseFloat(_0x5d91cc['val']);}catch(_0xa7ba23){}const _0x55281e=_0x56391b[_0x63704c(0x1e8)][_0x63704c(0x1fa)];if(!_0x56391b[_0x63704c(0x1e8)][_0x63704c(0x210)]||!_0x55281e)return null;try{let _0x48d82d='';if(_0x55281e[_0x63704c(0x1ea)](_0x63704c(0x20b)))_0x48d82d=_0x55281e+_0x63704c(0x1dd);else{if(_0x55281e['includes'](_0x63704c(0x21f)))_0x48d82d=_0x55281e+_0x63704c(0x22b);else{if(_0x55281e['includes'](_0x63704c(0x209)))_0x48d82d=_0x55281e+'.forecast.current.temperature';else{if(_0x55281e['includes'](_0x63704c(0x1e2)))_0x48d82d=_0x55281e+_0x63704c(0x206);}}}if(_0x48d82d){const _0x329174=await _0x56391b[_0x63704c(0x1e0)](_0x48d82d);if(_0x329174&&_0x329174[_0x63704c(0x1dc)]!==undefined&&_0x329174['val']!==null)return parseFloat(_0x329174[_0x63704c(0x1dc)]);}}catch(_0x1f169e){}return null;}async function recordThermodynamics(_0x1a0eb4,_0x26c00a,_0x3e89e6,_0x250759){const _0x1a2626=a5_0x6033,_0x107715=await getOutsideTemperatureNumeric(_0x1a0eb4),_0x5531ba=await _0x1a0eb4['getStateAsync']('LTM.trainingData.thermodynamics');let _0xa04db2=[];if(_0x5531ba&&_0x5531ba['val'])try{_0xa04db2=JSON[_0x1a2626(0x221)](_0x5531ba[_0x1a2626(0x1dc)]);}catch(_0x49e037){}_0xa04db2[_0x1a2626(0x1f3)]({'ts':Date[_0x1a2626(0x22f)](),'room':_0x250759||_0x1a2626(0x200),'t_in':_0x3e89e6,'t_out':_0x107715});if(_0xa04db2[_0x1a2626(0x1f5)]>THERMO_LOG_SIZE)_0xa04db2[_0x1a2626(0x230)]();await _0x1a0eb4[_0x1a2626(0x1e7)](_0x1a2626(0x21c),{'val':JSON['stringify'](_0xa04db2),'ack':!![]});}async function saveCompletedSequence(_0x8f00ae){const _0x2049bb=a5_0x6033;try{const _0xe9b9cd=await _0x8f00ae[_0x2049bb(0x1f4)]('LTM.trainingData.sequences');let _0x571917=[];if(_0xe9b9cd&&_0xe9b9cd[_0x2049bb(0x1dc)])try{_0x571917=JSON[_0x2049bb(0x221)](_0xe9b9cd['val']);}catch(_0x4305b5){}const _0x10f17e=activeSequence[0x0]['ts'],_0x59ac12=activeSequence[_0x2049bb(0x1fc)](_0x4ea8c0=>({'loc':_0x4ea8c0[_0x2049bb(0x22c)],'t_delta':Math[_0x2049bb(0x1f1)]((_0x4ea8c0['ts']-_0x10f17e)/0x3e8)})),_0x2cb9bb={'timestamp':new Date(_0x10f17e)[_0x2049bb(0x212)](),'steps':_0x59ac12,'duration':Math['round']((activeSequence[activeSequence[_0x2049bb(0x1f5)]-0x1]['ts']-_0x10f17e)/0x3e8),'daytime':new Date(_0x10f17e)['getHours']()};_0x571917['push'](_0x2cb9bb);if(_0x571917[_0x2049bb(0x1f5)]>MAX_TRAINING_SET_SIZE)_0x571917[_0x2049bb(0x230)]();await _0x8f00ae[_0x2049bb(0x1e7)](_0x2049bb(0x1fe),{'val':JSON['stringify'](_0x571917),'ack':!![]}),_0x8f00ae['isProVersion']&&_0x8f00ae[_0x2049bb(0x1e9)]&&_0x8f00ae[_0x2049bb(0x1e9)](_0x2049bb(0x20c),{'sequence':_0x2cb9bb});}catch(_0x3c9269){_0x8f00ae['log'][_0x2049bb(0x1e3)](_0x2049bb(0x231)+_0x3c9269[_0x2049bb(0x202)]);}}async function recordSequence(_0x28b26e,_0xf9466c){const _0x39b1d=a5_0x6033,_0x4b0fc9=(_0xf9466c[_0x39b1d(0x1f2)]||'')[_0x39b1d(0x234)](),_0x324631=[_0x39b1d(0x235),_0x39b1d(0x1e1),_0x39b1d(0x22a),_0x39b1d(0x1ff),'occupancy',_0x39b1d(0x1f8),_0x39b1d(0x229),_0x39b1d(0x1fd),_0x39b1d(0x21e),'contact',_0x39b1d(0x1f0),_0x39b1d(0x217),_0x39b1d(0x21a),_0x39b1d(0x220),_0x39b1d(0x211),_0x39b1d(0x219),_0x39b1d(0x20d)];if(!_0x324631[_0x39b1d(0x22d)](_0x34eab3=>_0x4b0fc9[_0x39b1d(0x1ea)](_0x34eab3)))return;if(!_0xf9466c[_0x39b1d(0x204)])return;if(sequenceTimer)clearTimeout(sequenceTimer);activeSequence['push']({'loc':_0xf9466c[_0x39b1d(0x1df)]||_0x39b1d(0x200),'id':_0xf9466c['id'],'ts':Date['now']()}),sequenceTimer=setTimeout(async()=>{const _0x1c6e33=_0x39b1d;if(activeSequence[_0x1c6e33(0x1f5)]>0x1)await saveCompletedSequence(_0x28b26e);activeSequence=[];},SEQUENCE_TIMEOUT_MS);}function startExitTimer(_0x550ebb){const _0x11f8d5=a5_0x6033;abortExitTimer(_0x550ebb),_0x550ebb[_0x11f8d5(0x208)]=!![],_0x550ebb[_0x11f8d5(0x213)]=setTimeout(()=>{_0x550ebb['isGracePeriodActive']=![];},EXIT_GRACE_PERIOD_SECONDS*0x3e8),_0x550ebb[_0x11f8d5(0x223)]=setTimeout(()=>{const _0x46ab6c=_0x11f8d5;setPresence(_0x550ebb,![]),_0x550ebb[_0x46ab6c(0x223)]=null;},EXIT_TIMER_MINUTES*0x3c*0x3e8);}function abortExitTimer(_0x1bc80e){const _0x2e4ed5=a5_0x6033;if(_0x1bc80e[_0x2e4ed5(0x223)])clearTimeout(_0x1bc80e[_0x2e4ed5(0x223)]);if(_0x1bc80e['exitGraceTimer'])clearTimeout(_0x1bc80e[_0x2e4ed5(0x213)]);_0x1bc80e[_0x2e4ed5(0x223)]=null,_0x1bc80e['exitGraceTimer']=null,_0x1bc80e[_0x2e4ed5(0x208)]=![];}async function setPresence(_0x25927c,_0x199ecf){const _0x5a4cf6=a5_0x6033;if(_0x25927c[_0x5a4cf6(0x215)]===_0x199ecf)return;_0x25927c[_0x5a4cf6(0x215)]=_0x199ecf,await _0x25927c['setStateAsync'](_0x5a4cf6(0x1f6),{'val':_0x199ecf,'ack':!![]});}async function processSensorEvent(_0x39a903,_0x1d8fe7,_0x46c6ef,_0x5c4d7f){const _0x208bda=a5_0x6033;if(!_0x5c4d7f)return null;const _0x156f31=_0x46c6ef[_0x208bda(0x1dc)],_0x52b423=Date[_0x208bda(0x22f)](),_0x3bf1fc=_0x39a903[_0x208bda(0x1f9)][_0x1d8fe7];_0x39a903['sensorLastValues'][_0x1d8fe7]=_0x156f31;if(!_0x5c4d7f[_0x208bda(0x21d)]&&_0x3bf1fc!=undefined&&_0x3bf1fc==_0x156f31)return null;const _0x112181=(_0x5c4d7f[_0x208bda(0x1f2)]||'')['toLowerCase'](),_0x20f949=_0x112181[_0x208bda(0x1ea)](_0x208bda(0x20f))||_0x112181[_0x208bda(0x1ea)](_0x208bda(0x205))||_0x112181[_0x208bda(0x1ea)](_0x208bda(0x207))||_0x112181['includes']('heizung');_0x39a903['isProVersion']&&_0x20f949&&recordThermodynamics(_0x39a903,_0x1d8fe7,_0x156f31,_0x5c4d7f[_0x208bda(0x1df)]);const _0x861595={'timestamp':_0x52b423,'id':_0x1d8fe7,'name':_0x5c4d7f[_0x208bda(0x214)],'type':_0x5c4d7f[_0x208bda(0x1f2)],'location':_0x5c4d7f[_0x208bda(0x1df)],'value':_0x156f31};_0x39a903[_0x208bda(0x227)][_0x208bda(0x216)](_0x861595);if(_0x39a903[_0x208bda(0x227)]['length']>HISTORY_MAX_SIZE)_0x39a903['eventHistory'][_0x208bda(0x233)]();await _0x39a903[_0x208bda(0x1e7)](_0x208bda(0x203),{'val':JSON[_0x208bda(0x1e6)](_0x861595),'ack':!![]}),await _0x39a903['setStateAsync'](_0x208bda(0x1ec),{'val':JSON['stringify'](_0x39a903[_0x208bda(0x227)]),'ack':!![]});if(_0x39a903[_0x208bda(0x1e5)]){_0x39a903['rawEventLog'][_0x208bda(0x1f3)](_0x861595);if(_0x39a903[_0x208bda(0x1de)][_0x208bda(0x1f5)]>RAW_LOG_MAX_SIZE)_0x39a903[_0x208bda(0x1de)][_0x208bda(0x237)](0x0,_0x39a903[_0x208bda(0x1de)]['length']-RAW_LOG_MAX_SIZE);await _0x39a903[_0x208bda(0x1e7)](_0x208bda(0x225),{'val':JSON[_0x208bda(0x1e6)](_0x39a903[_0x208bda(0x1de)]),'ack':!![]}),recordSequence(_0x39a903,_0x861595);}if(_0x5c4d7f[_0x208bda(0x232)]&&_0x156f31===!![]){if(_0x39a903[_0x208bda(0x215)]&&!_0x39a903[_0x208bda(0x208)])startExitTimer(_0x39a903);else{if(!_0x39a903['isPresent'])setPresence(_0x39a903,!![]);}}else{if(_0x5c4d7f[_0x208bda(0x1f2)]===_0x208bda(0x235)&&_0x156f31===!![]){if(_0x39a903['exitTimer'])abortExitTimer(_0x39a903);if(!_0x39a903[_0x208bda(0x215)]&&_0x39a903[_0x208bda(0x218)]===_0x208bda(0x1eb))setPresence(_0x39a903,!![]);}}return _0x39a903['isProVersion']&&_0x5c4d7f[_0x208bda(0x1f2)]===_0x208bda(0x235)&&_0x156f31===!![]&&_0x5c4d7f[_0x208bda(0x1df)]&&_0x39a903[_0x208bda(0x1e9)]&&_0x39a903[_0x208bda(0x1e9)](_0x208bda(0x22e),{'room':_0x5c4d7f[_0x208bda(0x1df)]}),_0x861595;}module[a5_0x26eb85(0x20e)]={'processSensorEvent':processSensorEvent,'getOutsideTemperatureNumeric':getOutsideTemperatureNumeric,'setPresence':setPresence,'abortExitTimer':abortExitTimer,'startExitTimer':startExitTimer};