const a5_0x4c9285=a5_0x4b82;(function(_0x3338b3,_0x37481f){const _0x482144=a5_0x4b82,_0x113a14=_0x3338b3();while(!![]){try{const _0x51a1f5=-parseInt(_0x482144(0x1ed))/0x1*(-parseInt(_0x482144(0x1e7))/0x2)+-parseInt(_0x482144(0x1af))/0x3*(-parseInt(_0x482144(0x1b9))/0x4)+-parseInt(_0x482144(0x1f9))/0x5+parseInt(_0x482144(0x1e2))/0x6+-parseInt(_0x482144(0x1bc))/0x7+-parseInt(_0x482144(0x195))/0x8*(-parseInt(_0x482144(0x1f6))/0x9)+-parseInt(_0x482144(0x1d3))/0xa;if(_0x51a1f5===_0x37481f)break;else _0x113a14['push'](_0x113a14['shift']());}catch(_0x209b0b){_0x113a14['push'](_0x113a14['shift']());}}}(a5_0x1a28,0xef8c5));const a5_0x3c8640=(function(){let _0x4e1b7f=!![];return function(_0x207c3a,_0xf46db2){const _0x1355cc=_0x4e1b7f?function(){if(_0xf46db2){const _0x121879=_0xf46db2['apply'](_0x207c3a,arguments);return _0xf46db2=null,_0x121879;}}:function(){};return _0x4e1b7f=![],_0x1355cc;};}()),a5_0x5b543d=a5_0x3c8640(this,function(){const _0xc12325=a5_0x4b82;return a5_0x5b543d[_0xc12325(0x1a0)]()['search']('(((.+)+)+)+$')[_0xc12325(0x1a0)]()[_0xc12325(0x1c2)](a5_0x5b543d)[_0xc12325(0x1d0)](_0xc12325(0x1a8));});a5_0x5b543d();'use strict';const HISTORY_MAX_SIZE=0x32,RAW_LOG_MAX_SIZE=0x9c4,THERMO_LOG_SIZE=0x3e8,SEQUENCE_TIMEOUT_MS=0x5*0x3c*0x3e8,MAX_TRAINING_SET_SIZE=0x1f4,EXIT_TIMER_MINUTES=0xf,EXIT_GRACE_PERIOD_SECONDS=0x1e;let activeSequence=[],sequenceTimer=null;async function getOutsideTemperatureNumeric(_0x2fb0eb){const _0x3ab785=a5_0x4b82;if(_0x2fb0eb['config'][_0x3ab785(0x1a1)])try{const _0x6f9b1b=await _0x2fb0eb['getForeignStateAsync'](_0x2fb0eb['config']['outdoorSensorId']);if(_0x6f9b1b&&_0x6f9b1b['val']!==undefined&&_0x6f9b1b[_0x3ab785(0x19d)]!==null)return parseFloat(_0x6f9b1b[_0x3ab785(0x19d)]);}catch(_0x3a74a0){}const _0x8d1625=_0x2fb0eb[_0x3ab785(0x1b8)]['weatherInstance'];if(!_0x2fb0eb[_0x3ab785(0x1b8)][_0x3ab785(0x1c3)]||!_0x8d1625)return null;try{let _0x2a7cae='';if(_0x8d1625[_0x3ab785(0x1e5)]('accuweather'))_0x2a7cae=_0x8d1625+_0x3ab785(0x1fd);else{if(_0x8d1625[_0x3ab785(0x1e5)](_0x3ab785(0x1a4)))_0x2a7cae=_0x8d1625+'.NextHours.Location_1.Day_1.current.temp_value';else{if(_0x8d1625[_0x3ab785(0x1e5)]('openweathermap'))_0x2a7cae=_0x8d1625+_0x3ab785(0x1a5);else{if(_0x8d1625['includes'](_0x3ab785(0x1e8)))_0x2a7cae=_0x8d1625+_0x3ab785(0x1bb);}}}if(_0x2a7cae){const _0x37986b=await _0x2fb0eb[_0x3ab785(0x1ec)](_0x2a7cae);if(_0x37986b&&_0x37986b[_0x3ab785(0x19d)]!==undefined&&_0x37986b['val']!==null)return parseFloat(_0x37986b[_0x3ab785(0x19d)]);}}catch(_0x50df9c){}return null;}async function recordThermodynamics(_0x384a6b,_0x5d664c,_0x88d6f1,_0x3825f0){const _0x47a265=a5_0x4b82,_0x332084=await getOutsideTemperatureNumeric(_0x384a6b);if(_0x332084===null)return;let _0x42fd1a=0x0,_0x122e75=![];if(_0x384a6b[_0x47a265(0x1b8)]['valveMapping'])try{let _0x819cfc=_0x384a6b[_0x47a265(0x1b8)]['valveMapping'];if(typeof _0x819cfc===_0x47a265(0x1e0))_0x819cfc=JSON['parse'](_0x819cfc);if(_0x819cfc[_0x5d664c]){const _0x6a52a5=_0x819cfc[_0x5d664c],_0x20bf82=await _0x384a6b['getForeignStateAsync'](_0x6a52a5);if(_0x20bf82&&_0x20bf82['val']!==null&&_0x20bf82['val']!==undefined){let _0x5c960a=Number(_0x20bf82['val']);if(_0x5c960a<=1.05&&!_0x6a52a5[_0x47a265(0x1e5)](_0x47a265(0x1ad))&&!_0x6a52a5[_0x47a265(0x1e5)](_0x47a265(0x1ef)))_0x5c960a=_0x5c960a*0x64;_0x42fd1a=Math[_0x47a265(0x1ac)](_0x5c960a),_0x122e75=!![];}}}catch(_0x45a3c0){}if(!_0x122e75){const _0x1e3a50=[{'from':_0x47a265(0x199),'to':_0x47a265(0x19a)},{'from':_0x47a265(0x199),'to':'.1.VALVE_STATE'},{'from':_0x47a265(0x1fa),'to':_0x47a265(0x1bd)},{'from':_0x47a265(0x19f),'to':_0x47a265(0x1e9)},{'from':'temperature','to':'level'},{'from':'Temperature','to':'Valve'}];for(const _0x293c28 of _0x1e3a50){if(_0x5d664c[_0x47a265(0x1e5)](_0x293c28[_0x47a265(0x1c5)])){const _0x2c8c2a=_0x5d664c[_0x47a265(0x1ea)](_0x293c28[_0x47a265(0x1c5)],_0x293c28['to']);try{const _0x2c98d3=await _0x384a6b[_0x47a265(0x1ec)](_0x2c8c2a);if(_0x2c98d3&&_0x2c98d3[_0x47a265(0x19d)]!==null&&_0x2c98d3[_0x47a265(0x19d)]!==undefined){let _0x395927=Number(_0x2c98d3[_0x47a265(0x19d)]);if(typeof _0x395927===_0x47a265(0x1c7)){if(_0x395927<=1.05&&_0x293c28['to'][_0x47a265(0x1e5)](_0x47a265(0x1bf)))_0x395927=_0x395927*0x64;_0x42fd1a=Math[_0x47a265(0x1ac)](_0x395927),_0x122e75=!![];break;}}}catch(_0x320db7){}}}}const _0x5c49d7=await _0x384a6b[_0x47a265(0x1f3)]('LTM.trainingData.thermodynamics');let _0x2261a0=[];if(_0x5c49d7&&_0x5c49d7[_0x47a265(0x19d)])try{_0x2261a0=JSON[_0x47a265(0x1fb)](_0x5c49d7[_0x47a265(0x19d)]);}catch(_0x2b576){}_0x2261a0[_0x47a265(0x19e)]({'ts':Date[_0x47a265(0x198)](),'room':_0x3825f0||_0x47a265(0x1c1),'t_in':_0x88d6f1,'t_out':_0x332084,'valve':_0x42fd1a});if(_0x2261a0[_0x47a265(0x1c8)]>THERMO_LOG_SIZE)_0x2261a0[_0x47a265(0x1ab)]();await _0x384a6b[_0x47a265(0x1ca)](_0x47a265(0x1f4),{'val':JSON['stringify'](_0x2261a0),'ack':!![]});}async function saveCompletedSequence(_0x5bb0cb){const _0x5bd25c=a5_0x4b82;try{const _0x3d9bd1=await _0x5bb0cb[_0x5bd25c(0x1f3)]('LTM.trainingData.sequences');let _0xae6923=[];if(_0x3d9bd1&&_0x3d9bd1[_0x5bd25c(0x19d)])try{_0xae6923=JSON[_0x5bd25c(0x1fb)](_0x3d9bd1['val']);}catch(_0x4568c8){}const _0x515bd0=activeSequence[0x0]['ts'],_0x469cd9=activeSequence['map'](_0xa6692f=>({'loc':_0xa6692f[_0x5bd25c(0x1f1)],'t_delta':Math[_0x5bd25c(0x1ac)]((_0xa6692f['ts']-_0x515bd0)/0x3e8)})),_0x57e4c0={'timestamp':new Date(_0x515bd0)[_0x5bd25c(0x1d5)](),'steps':_0x469cd9,'duration':Math[_0x5bd25c(0x1ac)]((activeSequence[activeSequence['length']-0x1]['ts']-_0x515bd0)/0x3e8),'daytime':new Date(_0x515bd0)['getHours']()};_0xae6923['push'](_0x57e4c0);if(_0xae6923['length']>MAX_TRAINING_SET_SIZE)_0xae6923[_0x5bd25c(0x1ab)]();await _0x5bb0cb[_0x5bd25c(0x1ca)]('LTM.trainingData.sequences',{'val':JSON[_0x5bd25c(0x1dd)](_0xae6923),'ack':!![]}),_0x5bb0cb[_0x5bd25c(0x1cd)]&&_0x5bb0cb['sendToPythonWrapper']&&_0x5bb0cb[_0x5bd25c(0x1aa)](_0x5bd25c(0x1b5),{'sequence':_0x57e4c0});}catch(_0x16488b){_0x5bb0cb[_0x5bd25c(0x1a6)][_0x5bd25c(0x1c6)](_0x5bd25c(0x1b0)+_0x16488b[_0x5bd25c(0x1b7)]);}}function a5_0x4b82(_0x92825,_0x48e622){const _0x5320b6=a5_0x1a28();return a5_0x4b82=function(_0x5b543d,_0x3c8640){_0x5b543d=_0x5b543d-0x195;let _0x1a2800=_0x5320b6[_0x5b543d];return _0x1a2800;},a5_0x4b82(_0x92825,_0x48e622);}async function recordSequence(_0x34335f,_0xb276e2){const _0xc5fc72=a5_0x4b82,_0x2285cf=(_0xb276e2['type']||'')['toLowerCase'](),_0x41ccfe=['motion','bewegung',_0xc5fc72(0x1a2),_0xc5fc72(0x1b3),_0xc5fc72(0x1cb),'door',_0xc5fc72(0x1ee),'window',_0xc5fc72(0x1fc),'contact','kontakt',_0xc5fc72(0x1a3),_0xc5fc72(0x1d2),_0xc5fc72(0x1c4),_0xc5fc72(0x1e3),_0xc5fc72(0x1b1),_0xc5fc72(0x1f5)];if(!_0x41ccfe['some'](_0x91803b=>_0x2285cf[_0xc5fc72(0x1e5)](_0x91803b)))return;if(!_0xb276e2[_0xc5fc72(0x1b2)])return;if(sequenceTimer)clearTimeout(sequenceTimer);activeSequence[_0xc5fc72(0x19e)]({'loc':_0xb276e2[_0xc5fc72(0x200)]||_0xc5fc72(0x1c1),'id':_0xb276e2['id'],'ts':Date[_0xc5fc72(0x198)]()}),sequenceTimer=setTimeout(async()=>{const _0x4c27c9=_0xc5fc72;if(activeSequence[_0x4c27c9(0x1c8)]>0x1)await saveCompletedSequence(_0x34335f);activeSequence=[];},SEQUENCE_TIMEOUT_MS);}function startExitTimer(_0x471d35){const _0x3e870a=a5_0x4b82;abortExitTimer(_0x471d35),_0x471d35[_0x3e870a(0x1ff)]=!![],_0x471d35['exitGraceTimer']=setTimeout(()=>{const _0x203051=_0x3e870a;_0x471d35[_0x203051(0x1ff)]=![];},EXIT_GRACE_PERIOD_SECONDS*0x3e8),_0x471d35[_0x3e870a(0x1d9)]=setTimeout(()=>{const _0x28f0c1=_0x3e870a;setPresence(_0x471d35,![]),_0x471d35[_0x28f0c1(0x1d9)]=null;},EXIT_TIMER_MINUTES*0x3c*0x3e8);}function abortExitTimer(_0x5a1907){const _0x562ac2=a5_0x4b82;if(_0x5a1907[_0x562ac2(0x1d9)])clearTimeout(_0x5a1907[_0x562ac2(0x1d9)]);if(_0x5a1907[_0x562ac2(0x1f0)])clearTimeout(_0x5a1907[_0x562ac2(0x1f0)]);_0x5a1907[_0x562ac2(0x1d9)]=null,_0x5a1907['exitGraceTimer']=null,_0x5a1907['isGracePeriodActive']=![];}async function setPresence(_0x42d302,_0x102b12){const _0x3d9caa=a5_0x4b82;if(_0x42d302['isPresent']===_0x102b12)return;_0x42d302[_0x3d9caa(0x1f2)]=_0x102b12,await _0x42d302[_0x3d9caa(0x1ca)](_0x3d9caa(0x1cc),{'val':_0x102b12,'ack':!![]});}async function processSensorEvent(_0x444ef5,_0x1c3b8,_0x16bd97,_0x554083){const _0x10bb6b=a5_0x4b82;if(!_0x554083)return null;const _0x8e5969=_0x16bd97[_0x10bb6b(0x19d)],_0x50e9fe=Date['now'](),_0x139d75=_0x444ef5[_0x10bb6b(0x1a7)][_0x1c3b8],_0x2c835=(_0x554083[_0x10bb6b(0x1e6)]||'')[_0x10bb6b(0x1d4)](),_0x491b40=_0x2c835['includes'](_0x10bb6b(0x1de))||_0x2c835['includes']('temperatur')||_0x2c835['includes'](_0x10bb6b(0x1b6))||_0x2c835[_0x10bb6b(0x1e5)](_0x10bb6b(0x1cf))||_0x2c835['includes'](_0x10bb6b(0x1f7));if(_0x491b40&&typeof _0x8e5969==='number'){if(_0x8e5969>0x50||_0x8e5969<-0x32)return _0x444ef5[_0x10bb6b(0x1a6)][_0x10bb6b(0x1ae)](_0x10bb6b(0x1eb)+_0x8e5969+_0x10bb6b(0x1fe)+_0x1c3b8),null;}_0x444ef5[_0x10bb6b(0x1a7)][_0x1c3b8]=_0x8e5969;if(!_0x554083[_0x10bb6b(0x19b)]&&_0x139d75!=undefined&&_0x139d75==_0x8e5969)return null;_0x444ef5[_0x10bb6b(0x1cd)]&&_0x491b40&&recordThermodynamics(_0x444ef5,_0x1c3b8,_0x8e5969,_0x554083[_0x10bb6b(0x200)]);const _0x274210={'timestamp':_0x50e9fe,'id':_0x1c3b8,'name':_0x554083[_0x10bb6b(0x196)],'type':_0x554083[_0x10bb6b(0x1e6)],'location':_0x554083[_0x10bb6b(0x200)],'value':_0x8e5969};_0x444ef5[_0x10bb6b(0x19c)][_0x10bb6b(0x1f8)](_0x274210);if(_0x444ef5[_0x10bb6b(0x19c)]['length']>HISTORY_MAX_SIZE)_0x444ef5['eventHistory']['pop']();await _0x444ef5[_0x10bb6b(0x1ca)](_0x10bb6b(0x1dc),{'val':JSON[_0x10bb6b(0x1dd)](_0x274210),'ack':!![]}),await _0x444ef5[_0x10bb6b(0x1ca)](_0x10bb6b(0x1d6),{'val':JSON['stringify'](_0x444ef5['eventHistory']),'ack':!![]});if(_0x444ef5[_0x10bb6b(0x1cd)]){_0x444ef5[_0x10bb6b(0x1a9)]['push'](_0x274210);if(_0x444ef5[_0x10bb6b(0x1a9)][_0x10bb6b(0x1c8)]>RAW_LOG_MAX_SIZE)_0x444ef5[_0x10bb6b(0x1a9)][_0x10bb6b(0x1d1)](0x0,_0x444ef5[_0x10bb6b(0x1a9)]['length']-RAW_LOG_MAX_SIZE);await _0x444ef5[_0x10bb6b(0x1ca)](_0x10bb6b(0x1df),{'val':JSON['stringify'](_0x444ef5[_0x10bb6b(0x1a9)]),'ack':!![]}),recordSequence(_0x444ef5,_0x274210);}if(_0x554083['isExit']&&_0x8e5969===!![]){if(_0x444ef5[_0x10bb6b(0x1f2)]&&!_0x444ef5[_0x10bb6b(0x1ff)])startExitTimer(_0x444ef5);else{if(!_0x444ef5[_0x10bb6b(0x1f2)])setPresence(_0x444ef5,!![]);}}else{if(_0x554083[_0x10bb6b(0x1e6)]===_0x10bb6b(0x1da)&&_0x8e5969===!![]){if(_0x444ef5[_0x10bb6b(0x1d9)])abortExitTimer(_0x444ef5);if(!_0x444ef5[_0x10bb6b(0x1f2)]&&_0x444ef5[_0x10bb6b(0x1ba)]===_0x10bb6b(0x1b4))setPresence(_0x444ef5,!![]);}}if(_0x444ef5[_0x10bb6b(0x1cd)]&&_0x444ef5[_0x10bb6b(0x1aa)]){_0x554083['type']===_0x10bb6b(0x1da)&&_0x8e5969===!![]&&_0x554083[_0x10bb6b(0x200)]&&_0x444ef5[_0x10bb6b(0x1aa)]('SIMULATE_SIGNAL',{'room':_0x554083[_0x10bb6b(0x200)]});const _0x2d7045=[_0x10bb6b(0x1db),_0x10bb6b(0x1ee),'window',_0x10bb6b(0x1fc),_0x10bb6b(0x1d7),_0x10bb6b(0x1e4),_0x10bb6b(0x1e1),_0x10bb6b(0x1ce)][_0x10bb6b(0x1be)](_0x482b46=>_0x2c835[_0x10bb6b(0x1e5)](_0x482b46)),_0x13b06e=[_0x10bb6b(0x1a3),_0x10bb6b(0x1d2),_0x10bb6b(0x1c4),_0x10bb6b(0x1e3),_0x10bb6b(0x1b1),_0x10bb6b(0x1f5)]['some'](_0x5cb4b7=>_0x2c835[_0x10bb6b(0x1e5)](_0x5cb4b7)),_0x2e9a70=['motion',_0x10bb6b(0x1c0),'präsenz',_0x10bb6b(0x1b3),_0x10bb6b(0x1cb)][_0x10bb6b(0x1be)](_0x56fe55=>_0x2c835[_0x10bb6b(0x1e5)](_0x56fe55));if(_0x554083['location']&&(_0x2d7045||_0x13b06e||_0x2e9a70)){const _0x42cb1c=_0x8e5969===!![]||typeof _0x8e5969===_0x10bb6b(0x1c7)&&_0x8e5969>0x0,_0x33c5eb=_0x2d7045&&!_0x42cb1c&&_0x139d75!==undefined&&_0x139d75!=_0x8e5969;if(_0x42cb1c||_0x33c5eb){const _0x3f9995=_0x444ef5[_0x10bb6b(0x197)]||_0x50e9fe,_0x339c2a=(_0x50e9fe-_0x3f9995)/0x3e8;_0x444ef5[_0x10bb6b(0x197)]=_0x50e9fe,_0x444ef5['sendToPythonWrapper'](_0x10bb6b(0x1c9),{'room':_0x554083[_0x10bb6b(0x200)],'dt':_0x339c2a});}}}return _0x274210;}module[a5_0x4c9285(0x1d8)]={'processSensorEvent':processSensorEvent,'getOutsideTemperatureNumeric':getOutsideTemperatureNumeric,'setPresence':setPresence,'abortExitTimer':abortExitTimer,'startExitTimer':startExitTimer};function a5_0x1a28(){const _0x47e900=['schloss','heizung','search','splice','licht','28619560xETTAs','toLowerCase','toISOString','events.history','griff','exports','exitTimer','motion','door','events.lastEvent','stringify','temperature','LTM.rawEventLog','string','lock','4656930DWpGGY','schalter','handle','includes','type','2409206wXKrNi','weatherunderground','.LEVEL','replace','[RECORDER]\x20Ignored\x20implausible\x20temperature:\x20','getForeignStateAsync','1RvlIxm','tür','STATE','exitGraceTimer','loc','isPresent','getStateAsync','LTM.trainingData.thermodynamics','lampe','9MQMJGR','thermostat','unshift','945150IZVqDX','.1.TEMPERATURE','parse','fenster','.Current.Temperature','\x20from\x20','isGracePeriodActive','location','12047368WbannM','name','lastTrackerEventTime','now','.1.ACTUAL_TEMPERATURE','.1.LEVEL','logDuplicates','eventHistory','val','push','.ACTUAL_TEMPERATURE','toString','outdoorSensorId','präsenz','light','daswetter','.forecast.current.temperature','log','sensorLastValues','(((.+)+)+)+$','rawEventLog','sendToPythonWrapper','shift','round','STATUS','debug','1923249udyVXd','[RECORDER]\x20Error:\x20','dimmer','value','presence','normal','ANALYZE_SEQUENCE','klima','message','config','4HbqhtQ','currentSystemMode','.forecast.current.temp','669109DgCoNv','.4.VALVE_STATE','some','LEVEL','bewegung','Unknown','constructor','useWeather','switch','from','error','number','length','TRACK_EVENT','setStateAsync','occupancy','system.isPresent','isProVersion'];a5_0x1a28=function(){return _0x47e900;};return a5_0x1a28();}