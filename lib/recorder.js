function a5_0x5a24(){const _0x58be47=['[RECORDER]\x20Error:\x20','shift','.LEVEL','light','toString','getHours','message','door','daswetter','klima','config','10FxMUuZ','weatherunderground','some','5rezOoq','licht','pop','val','.1.ACTUAL_TEMPERATURE','search','100JKvLYM','getStateAsync','.forecast.current.temperature','exitGraceTimer','3oYYmga','stringify','rawEventLog','from','42sytrqF','1181742VxCNFz','contact','11574rvWeXj','präsenz','now','includes','round','hm-rpc','.1.VALVE_STATE','.1.TEMPERATURE','replace','.4.VALVE_STATE','map','getForeignStateAsync','24wJyuzo','loc','constructor','.NextHours.Location_1.Day_1.current.temp_value','857701ontdIS','sendToPythonWrapper','switch','setStateAsync','presence','logDuplicates','Unknown','.ACTUAL_TEMPERATURE','.1.LEVEL','motion','fenster','lampe','sensorLastValues','parse','(((.+)+)+)+$','toLowerCase','temperatur','138916MIBUaj','222871xbyZdP','ANALYZE_SEQUENCE','bewegung','isGracePeriodActive','log','isProVersion','108017OOAVnV','isExit','LTM.trainingData.sequences','type','outdoorSensorId','location','push','tür','number','length','kontakt','exports','eventHistory','isPresent','name','occupancy','currentSystemMode','1403739SLgsPt','LTM.rawEventLog','exitTimer','120gNlpdB','useWeather','error'];a5_0x5a24=function(){return _0x58be47;};return a5_0x5a24();}const a5_0x43332e=a5_0x4eeb;(function(_0x193d0a,_0x1600cf){const _0x46e590=a5_0x4eeb,_0x38a96c=_0x193d0a();while(!![]){try{const _0x122727=parseInt(_0x46e590(0x1be))/0x1*(parseInt(_0x46e590(0x188))/0x2)+parseInt(_0x46e590(0x1c5))/0x3*(-parseInt(_0x46e590(0x1ba))/0x4)+-parseInt(_0x46e590(0x1b4))/0x5*(parseInt(_0x46e590(0x1c3))/0x6)+-parseInt(_0x46e590(0x18f))/0x7*(-parseInt(_0x46e590(0x1a3))/0x8)+parseInt(_0x46e590(0x1a0))/0x9*(parseInt(_0x46e590(0x1b1))/0xa)+-parseInt(_0x46e590(0x189))/0xb*(-parseInt(_0x46e590(0x1d1))/0xc)+parseInt(_0x46e590(0x1d5))/0xd*(-parseInt(_0x46e590(0x1c2))/0xe);if(_0x122727===_0x1600cf)break;else _0x38a96c['push'](_0x38a96c['shift']());}catch(_0xf9413e){_0x38a96c['push'](_0x38a96c['shift']());}}}(a5_0x5a24,0x23662));const a5_0x212943=(function(){let _0x252505=!![];return function(_0xb29fd1,_0x382305){const _0x2ba9da=_0x252505?function(){if(_0x382305){const _0x50da34=_0x382305['apply'](_0xb29fd1,arguments);return _0x382305=null,_0x50da34;}}:function(){};return _0x252505=![],_0x2ba9da;};}()),a5_0x5c5ea7=a5_0x212943(this,function(){const _0x44f198=a5_0x4eeb;return a5_0x5c5ea7[_0x44f198(0x1aa)]()[_0x44f198(0x1b9)](_0x44f198(0x185))[_0x44f198(0x1aa)]()[_0x44f198(0x1d3)](a5_0x5c5ea7)[_0x44f198(0x1b9)](_0x44f198(0x185));});a5_0x5c5ea7();'use strict';const HISTORY_MAX_SIZE=0x32,RAW_LOG_MAX_SIZE=0x9c4,THERMO_LOG_SIZE=0x3e8,SEQUENCE_TIMEOUT_MS=0x5*0x3c*0x3e8,MAX_TRAINING_SET_SIZE=0x1f4,EXIT_TIMER_MINUTES=0xf,EXIT_GRACE_PERIOD_SECONDS=0x1e;let activeSequence=[],sequenceTimer=null;async function getOutsideTemperatureNumeric(_0xd25f82){const _0x23aeed=a5_0x4eeb;if(_0xd25f82[_0x23aeed(0x1b0)][_0x23aeed(0x193)])try{const _0x4770a3=await _0xd25f82[_0x23aeed(0x1d0)](_0xd25f82[_0x23aeed(0x1b0)][_0x23aeed(0x193)]);if(_0x4770a3&&_0x4770a3[_0x23aeed(0x1b7)]!==undefined&&_0x4770a3[_0x23aeed(0x1b7)]!==null)return parseFloat(_0x4770a3[_0x23aeed(0x1b7)]);}catch(_0x497058){}const _0x2b1c0a=_0xd25f82[_0x23aeed(0x1b0)]['weatherInstance'];if(!_0xd25f82[_0x23aeed(0x1b0)][_0x23aeed(0x1a4)]||!_0x2b1c0a)return null;try{let _0x57486c='';if(_0x2b1c0a['includes']('accuweather'))_0x57486c=_0x2b1c0a+'.Current.Temperature';else{if(_0x2b1c0a['includes'](_0x23aeed(0x1ae)))_0x57486c=_0x2b1c0a+_0x23aeed(0x1d4);else{if(_0x2b1c0a[_0x23aeed(0x1c8)]('openweathermap'))_0x57486c=_0x2b1c0a+_0x23aeed(0x1bc);else{if(_0x2b1c0a['includes'](_0x23aeed(0x1b2)))_0x57486c=_0x2b1c0a+'.forecast.current.temp';}}}if(_0x57486c){const _0x466403=await _0xd25f82['getForeignStateAsync'](_0x57486c);if(_0x466403&&_0x466403['val']!==undefined&&_0x466403[_0x23aeed(0x1b7)]!==null)return parseFloat(_0x466403['val']);}}catch(_0x31f917){}return null;}async function recordThermodynamics(_0x484ffe,_0x323dc2,_0xb12637,_0x26bfaf){const _0x4034c2=a5_0x4eeb,_0x2d4528=await getOutsideTemperatureNumeric(_0x484ffe);let _0x3fafab=0x0;if(_0x323dc2[_0x4034c2(0x1c8)](_0x4034c2(0x1ca))){const _0x1bd261=[{'from':_0x4034c2(0x1b8),'to':_0x4034c2(0x17f)},{'from':_0x4034c2(0x1b8),'to':_0x4034c2(0x1cb)},{'from':_0x4034c2(0x1cc),'to':_0x4034c2(0x1ce)},{'from':_0x4034c2(0x17e),'to':_0x4034c2(0x1a8)}];for(const _0x15d6ce of _0x1bd261){if(_0x323dc2[_0x4034c2(0x1c8)](_0x15d6ce[_0x4034c2(0x1c1)])){const _0x2fa7e0=_0x323dc2[_0x4034c2(0x1cd)](_0x15d6ce[_0x4034c2(0x1c1)],_0x15d6ce['to']);try{const _0x590d3e=await _0x484ffe[_0x4034c2(0x1d0)](_0x2fa7e0);if(_0x590d3e&&_0x590d3e[_0x4034c2(0x1b7)]!==null&&_0x590d3e[_0x4034c2(0x1b7)]!==undefined){let _0x1f8504=_0x590d3e[_0x4034c2(0x1b7)];typeof _0x1f8504===_0x4034c2(0x197)&&_0x1f8504<=1.05&&_0x15d6ce['to']['includes']('LEVEL')&&(_0x1f8504=_0x1f8504*0x64);_0x3fafab=Math[_0x4034c2(0x1c9)](_0x1f8504);break;}}catch(_0x4a7ab6){}}}}const _0x22a271=await _0x484ffe[_0x4034c2(0x1bb)]('LTM.trainingData.thermodynamics');let _0x5303d4=[];if(_0x22a271&&_0x22a271[_0x4034c2(0x1b7)])try{_0x5303d4=JSON[_0x4034c2(0x184)](_0x22a271[_0x4034c2(0x1b7)]);}catch(_0x31d6db){}_0x5303d4[_0x4034c2(0x195)]({'ts':Date['now'](),'room':_0x26bfaf||_0x4034c2(0x17d),'t_in':_0xb12637,'t_out':_0x2d4528,'valve':_0x3fafab});if(_0x5303d4[_0x4034c2(0x198)]>THERMO_LOG_SIZE)_0x5303d4[_0x4034c2(0x1a7)]();await _0x484ffe[_0x4034c2(0x1d8)]('LTM.trainingData.thermodynamics',{'val':JSON[_0x4034c2(0x1bf)](_0x5303d4),'ack':!![]});}function a5_0x4eeb(_0x30d280,_0xb5ede3){const _0x1b1c76=a5_0x5a24();return a5_0x4eeb=function(_0x5c5ea7,_0x212943){_0x5c5ea7=_0x5c5ea7-0x17c;let _0x5a2450=_0x1b1c76[_0x5c5ea7];return _0x5a2450;},a5_0x4eeb(_0x30d280,_0xb5ede3);}async function saveCompletedSequence(_0x537ac2){const _0x5e14fc=a5_0x4eeb;try{const _0x4edee5=await _0x537ac2[_0x5e14fc(0x1bb)]('LTM.trainingData.sequences');let _0xd041a1=[];if(_0x4edee5&&_0x4edee5['val'])try{_0xd041a1=JSON['parse'](_0x4edee5['val']);}catch(_0x385d0d){}const _0x2ec2df=activeSequence[0x0]['ts'],_0x3bc7de=activeSequence[_0x5e14fc(0x1cf)](_0x3c7db4=>({'loc':_0x3c7db4[_0x5e14fc(0x1d2)],'t_delta':Math[_0x5e14fc(0x1c9)]((_0x3c7db4['ts']-_0x2ec2df)/0x3e8)})),_0x47a678={'timestamp':new Date(_0x2ec2df)['toISOString'](),'steps':_0x3bc7de,'duration':Math[_0x5e14fc(0x1c9)]((activeSequence[activeSequence['length']-0x1]['ts']-_0x2ec2df)/0x3e8),'daytime':new Date(_0x2ec2df)[_0x5e14fc(0x1ab)]()};_0xd041a1['push'](_0x47a678);if(_0xd041a1[_0x5e14fc(0x198)]>MAX_TRAINING_SET_SIZE)_0xd041a1[_0x5e14fc(0x1a7)]();await _0x537ac2[_0x5e14fc(0x1d8)](_0x5e14fc(0x191),{'val':JSON[_0x5e14fc(0x1bf)](_0xd041a1),'ack':!![]}),_0x537ac2[_0x5e14fc(0x18e)]&&_0x537ac2['sendToPythonWrapper']&&_0x537ac2[_0x5e14fc(0x1d6)](_0x5e14fc(0x18a),{'sequence':_0x47a678});}catch(_0x145bf7){_0x537ac2[_0x5e14fc(0x18d)][_0x5e14fc(0x1a5)](_0x5e14fc(0x1a6)+_0x145bf7[_0x5e14fc(0x1ac)]);}}async function recordSequence(_0x30f4ac,_0x123438){const _0x54e659=a5_0x4eeb,_0x793c9d=(_0x123438['type']||'')[_0x54e659(0x186)](),_0x4ff54a=[_0x54e659(0x180),_0x54e659(0x18b),_0x54e659(0x1c6),_0x54e659(0x1d9),_0x54e659(0x19e),_0x54e659(0x1ad),_0x54e659(0x196),'window',_0x54e659(0x181),_0x54e659(0x1c4),_0x54e659(0x199),_0x54e659(0x1a9),_0x54e659(0x1b5),_0x54e659(0x1d7),'schalter','dimmer',_0x54e659(0x182)];if(!_0x4ff54a[_0x54e659(0x1b3)](_0x5f1b04=>_0x793c9d[_0x54e659(0x1c8)](_0x5f1b04)))return;if(!_0x123438['value'])return;if(sequenceTimer)clearTimeout(sequenceTimer);activeSequence['push']({'loc':_0x123438[_0x54e659(0x194)]||_0x54e659(0x17d),'id':_0x123438['id'],'ts':Date[_0x54e659(0x1c7)]()}),sequenceTimer=setTimeout(async()=>{const _0x5168be=_0x54e659;if(activeSequence[_0x5168be(0x198)]>0x1)await saveCompletedSequence(_0x30f4ac);activeSequence=[];},SEQUENCE_TIMEOUT_MS);}function startExitTimer(_0x588728){const _0x1798c6=a5_0x4eeb;abortExitTimer(_0x588728),_0x588728[_0x1798c6(0x18c)]=!![],_0x588728[_0x1798c6(0x1bd)]=setTimeout(()=>{const _0x44ca87=_0x1798c6;_0x588728[_0x44ca87(0x18c)]=![];},EXIT_GRACE_PERIOD_SECONDS*0x3e8),_0x588728[_0x1798c6(0x1a2)]=setTimeout(()=>{const _0x3d38c3=_0x1798c6;setPresence(_0x588728,![]),_0x588728[_0x3d38c3(0x1a2)]=null;},EXIT_TIMER_MINUTES*0x3c*0x3e8);}function abortExitTimer(_0x19c55f){const _0x330c16=a5_0x4eeb;if(_0x19c55f['exitTimer'])clearTimeout(_0x19c55f[_0x330c16(0x1a2)]);if(_0x19c55f[_0x330c16(0x1bd)])clearTimeout(_0x19c55f[_0x330c16(0x1bd)]);_0x19c55f[_0x330c16(0x1a2)]=null,_0x19c55f[_0x330c16(0x1bd)]=null,_0x19c55f[_0x330c16(0x18c)]=![];}async function setPresence(_0x17d0ab,_0x5cafd7){const _0x3f44fe=a5_0x4eeb;if(_0x17d0ab[_0x3f44fe(0x19c)]===_0x5cafd7)return;_0x17d0ab[_0x3f44fe(0x19c)]=_0x5cafd7,await _0x17d0ab[_0x3f44fe(0x1d8)]('system.isPresent',{'val':_0x5cafd7,'ack':!![]});}async function processSensorEvent(_0x50c692,_0x28ccd3,_0x1fd78f,_0xc9cac){const _0x50432a=a5_0x4eeb;if(!_0xc9cac)return null;const _0x3d3e7b=_0x1fd78f[_0x50432a(0x1b7)],_0x3e1c0b=Date[_0x50432a(0x1c7)](),_0x4f20da=_0x50c692[_0x50432a(0x183)][_0x28ccd3];_0x50c692[_0x50432a(0x183)][_0x28ccd3]=_0x3d3e7b;if(!_0xc9cac[_0x50432a(0x17c)]&&_0x4f20da!=undefined&&_0x4f20da==_0x3d3e7b)return null;const _0x5ad94f=(_0xc9cac[_0x50432a(0x192)]||'')[_0x50432a(0x186)](),_0x25ccce=_0x5ad94f[_0x50432a(0x1c8)]('temperature')||_0x5ad94f[_0x50432a(0x1c8)](_0x50432a(0x187))||_0x5ad94f[_0x50432a(0x1c8)](_0x50432a(0x1af))||_0x5ad94f[_0x50432a(0x1c8)]('heizung');_0x50c692[_0x50432a(0x18e)]&&_0x25ccce&&recordThermodynamics(_0x50c692,_0x28ccd3,_0x3d3e7b,_0xc9cac['location']);const _0x1ef602={'timestamp':_0x3e1c0b,'id':_0x28ccd3,'name':_0xc9cac[_0x50432a(0x19d)],'type':_0xc9cac[_0x50432a(0x192)],'location':_0xc9cac[_0x50432a(0x194)],'value':_0x3d3e7b};_0x50c692[_0x50432a(0x19b)]['unshift'](_0x1ef602);if(_0x50c692[_0x50432a(0x19b)][_0x50432a(0x198)]>HISTORY_MAX_SIZE)_0x50c692[_0x50432a(0x19b)][_0x50432a(0x1b6)]();await _0x50c692[_0x50432a(0x1d8)]('events.lastEvent',{'val':JSON[_0x50432a(0x1bf)](_0x1ef602),'ack':!![]}),await _0x50c692[_0x50432a(0x1d8)]('events.history',{'val':JSON['stringify'](_0x50c692[_0x50432a(0x19b)]),'ack':!![]});if(_0x50c692[_0x50432a(0x18e)]){_0x50c692[_0x50432a(0x1c0)][_0x50432a(0x195)](_0x1ef602);if(_0x50c692[_0x50432a(0x1c0)][_0x50432a(0x198)]>RAW_LOG_MAX_SIZE)_0x50c692[_0x50432a(0x1c0)]['splice'](0x0,_0x50c692['rawEventLog'][_0x50432a(0x198)]-RAW_LOG_MAX_SIZE);await _0x50c692[_0x50432a(0x1d8)](_0x50432a(0x1a1),{'val':JSON['stringify'](_0x50c692[_0x50432a(0x1c0)]),'ack':!![]}),recordSequence(_0x50c692,_0x1ef602);}if(_0xc9cac[_0x50432a(0x190)]&&_0x3d3e7b===!![]){if(_0x50c692['isPresent']&&!_0x50c692['isGracePeriodActive'])startExitTimer(_0x50c692);else{if(!_0x50c692[_0x50432a(0x19c)])setPresence(_0x50c692,!![]);}}else{if(_0xc9cac[_0x50432a(0x192)]===_0x50432a(0x180)&&_0x3d3e7b===!![]){if(_0x50c692[_0x50432a(0x1a2)])abortExitTimer(_0x50c692);if(!_0x50c692[_0x50432a(0x19c)]&&_0x50c692[_0x50432a(0x19f)]==='normal')setPresence(_0x50c692,!![]);}}return _0x50c692[_0x50432a(0x18e)]&&_0xc9cac[_0x50432a(0x192)]==='motion'&&_0x3d3e7b===!![]&&_0xc9cac[_0x50432a(0x194)]&&_0x50c692['sendToPythonWrapper']&&_0x50c692[_0x50432a(0x1d6)]('SIMULATE_SIGNAL',{'room':_0xc9cac[_0x50432a(0x194)]}),_0x1ef602;}module[a5_0x43332e(0x19a)]={'processSensorEvent':processSensorEvent,'getOutsideTemperatureNumeric':getOutsideTemperatureNumeric,'setPresence':setPresence,'abortExitTimer':abortExitTimer,'startExitTimer':startExitTimer};