const a5_0x2ed79a=a5_0x37e0;(function(_0xfb1152,_0x2aec38){const _0x12fdef=a5_0x37e0,_0xf2b6ef=_0xfb1152();while(!![]){try{const _0x4004ed=parseInt(_0x12fdef(0x1dc))/0x1*(parseInt(_0x12fdef(0x1ab))/0x2)+-parseInt(_0x12fdef(0x1d3))/0x3+parseInt(_0x12fdef(0x1e3))/0x4+-parseInt(_0x12fdef(0x1a4))/0x5*(parseInt(_0x12fdef(0x1dd))/0x6)+-parseInt(_0x12fdef(0x1f0))/0x7+-parseInt(_0x12fdef(0x1e9))/0x8*(-parseInt(_0x12fdef(0x1ef))/0x9)+parseInt(_0x12fdef(0x1cb))/0xa*(-parseInt(_0x12fdef(0x1c2))/0xb);if(_0x4004ed===_0x2aec38)break;else _0xf2b6ef['push'](_0xf2b6ef['shift']());}catch(_0x5a5671){_0xf2b6ef['push'](_0xf2b6ef['shift']());}}}(a5_0x3b8e,0xb78bf));const a5_0x2657c1=(function(){let _0x23e756=!![];return function(_0x13c92a,_0x1d2ff1){const _0x518f5c=_0x23e756?function(){const _0x28ff1c=a5_0x37e0;if(_0x1d2ff1){const _0xef7375=_0x1d2ff1[_0x28ff1c(0x1ad)](_0x13c92a,arguments);return _0x1d2ff1=null,_0xef7375;}}:function(){};return _0x23e756=![],_0x518f5c;};}()),a5_0xfb5abc=a5_0x2657c1(this,function(){const _0xcef948=a5_0x37e0;return a5_0xfb5abc[_0xcef948(0x204)]()[_0xcef948(0x1cc)](_0xcef948(0x1e0))[_0xcef948(0x204)]()['constructor'](a5_0xfb5abc)[_0xcef948(0x1cc)](_0xcef948(0x1e0));});a5_0xfb5abc();'use strict';const HISTORY_MAX_SIZE=0x32,RAW_LOG_MAX_SIZE=0x9c4,THERMO_LOG_SIZE=0x3e8,SEQUENCE_TIMEOUT_MS=0x5*0x3c*0x3e8,MAX_TRAINING_SET_SIZE=0x1f4,EXIT_TIMER_MINUTES=0xf,EXIT_GRACE_PERIOD_SECONDS=0x1e;function a5_0x37e0(_0x389377,_0xab3644){const _0x5c8d9d=a5_0x3b8e();return a5_0x37e0=function(_0xfb5abc,_0x2657c1){_0xfb5abc=_0xfb5abc-0x198;let _0x3b8e4b=_0x5c8d9d[_0xfb5abc];return _0x3b8e4b;},a5_0x37e0(_0x389377,_0xab3644);}let activeSequence=[],sequenceTimer=null;async function getOutsideTemperatureNumeric(_0x29b54a){const _0x3ad6e9=a5_0x37e0;if(_0x29b54a[_0x3ad6e9(0x1a7)][_0x3ad6e9(0x1ca)])try{const _0x3b581f=await _0x29b54a[_0x3ad6e9(0x1ce)](_0x29b54a[_0x3ad6e9(0x1a7)]['outdoorSensorId']);if(_0x3b581f&&_0x3b581f[_0x3ad6e9(0x1fb)]!==undefined&&_0x3b581f[_0x3ad6e9(0x1fb)]!==null)return parseFloat(_0x3b581f[_0x3ad6e9(0x1fb)]);}catch(_0x390ea9){}const _0x369fe3=_0x29b54a[_0x3ad6e9(0x1a7)][_0x3ad6e9(0x19d)];if(!_0x29b54a[_0x3ad6e9(0x1a7)]['useWeather']||!_0x369fe3)return null;try{let _0x2d373e='';if(_0x369fe3['includes'](_0x3ad6e9(0x1f9)))_0x2d373e=_0x369fe3+_0x3ad6e9(0x1e7);else{if(_0x369fe3[_0x3ad6e9(0x1c3)](_0x3ad6e9(0x1a3)))_0x2d373e=_0x369fe3+_0x3ad6e9(0x1c6);else{if(_0x369fe3[_0x3ad6e9(0x1c3)]('openweathermap'))_0x2d373e=_0x369fe3+_0x3ad6e9(0x1aa);else{if(_0x369fe3[_0x3ad6e9(0x1c3)](_0x3ad6e9(0x1c1)))_0x2d373e=_0x369fe3+_0x3ad6e9(0x1bd);}}}if(_0x2d373e){const _0x56aa1a=await _0x29b54a[_0x3ad6e9(0x1ce)](_0x2d373e);if(_0x56aa1a&&_0x56aa1a['val']!==undefined&&_0x56aa1a[_0x3ad6e9(0x1fb)]!==null)return parseFloat(_0x56aa1a['val']);}}catch(_0x5117fe){}return null;}async function recordThermodynamics(_0x299cab,_0x1f19a3,_0x52f8d7,_0x562743){const _0xeca40e=a5_0x37e0,_0x58f37c=await getOutsideTemperatureNumeric(_0x299cab);if(_0x58f37c===null)return;let _0x32834e=0x0,_0x54d39e=![];if(_0x299cab[_0xeca40e(0x1a7)][_0xeca40e(0x1c9)])try{let _0xe3e5d8=_0x299cab[_0xeca40e(0x1a7)]['valveMapping'];if(typeof _0xe3e5d8===_0xeca40e(0x1fa))_0xe3e5d8=JSON[_0xeca40e(0x1ea)](_0xe3e5d8);if(_0xe3e5d8[_0x1f19a3]){const _0x5f392e=_0xe3e5d8[_0x1f19a3],_0xe138da=await _0x299cab['getForeignStateAsync'](_0x5f392e);if(_0xe138da&&_0xe138da[_0xeca40e(0x1fb)]!==null&&_0xe138da[_0xeca40e(0x1fb)]!==undefined){let _0x540757=Number(_0xe138da[_0xeca40e(0x1fb)]);if(_0x540757<=1.05&&!_0x5f392e[_0xeca40e(0x1c3)](_0xeca40e(0x1b9))&&!_0x5f392e['includes'](_0xeca40e(0x1d7)))_0x540757=_0x540757*0x64;_0x32834e=Math[_0xeca40e(0x1bc)](_0x540757),_0x54d39e=!![];}}}catch(_0x387557){}if(!_0x54d39e){const _0x374df4=[{'from':'.1.ACTUAL_TEMPERATURE','to':_0xeca40e(0x203)},{'from':_0xeca40e(0x1e4),'to':'.1.VALVE_STATE'},{'from':_0xeca40e(0x1a6),'to':_0xeca40e(0x1b2)},{'from':_0xeca40e(0x199),'to':'.LEVEL'},{'from':'temperature','to':_0xeca40e(0x1f7)},{'from':_0xeca40e(0x1ae),'to':_0xeca40e(0x1b7)}];for(const _0x142191 of _0x374df4){if(_0x1f19a3['includes'](_0x142191['from'])){const _0x5b2688=_0x1f19a3[_0xeca40e(0x1d8)](_0x142191[_0xeca40e(0x1c4)],_0x142191['to']);try{const _0x502b46=await _0x299cab['getForeignStateAsync'](_0x5b2688);if(_0x502b46&&_0x502b46[_0xeca40e(0x1fb)]!==null&&_0x502b46[_0xeca40e(0x1fb)]!==undefined){let _0xd14e91=Number(_0x502b46['val']);if(typeof _0xd14e91==='number'){if(_0xd14e91<=1.05&&_0x142191['to'][_0xeca40e(0x1c3)](_0xeca40e(0x1e6)))_0xd14e91=_0xd14e91*0x64;_0x32834e=Math[_0xeca40e(0x1bc)](_0xd14e91),_0x54d39e=!![];break;}}}catch(_0x35be8e){}}}}const _0x5281cd=await _0x299cab[_0xeca40e(0x1d9)](_0xeca40e(0x1bf));let _0x4342cd=[];if(_0x5281cd&&_0x5281cd[_0xeca40e(0x1fb)])try{_0x4342cd=JSON[_0xeca40e(0x1ea)](_0x5281cd[_0xeca40e(0x1fb)]);}catch(_0x30e3cb){}_0x4342cd[_0xeca40e(0x1ee)]({'ts':Date['now'](),'room':_0x562743||_0xeca40e(0x1b8),'t_in':_0x52f8d7,'t_out':_0x58f37c,'valve':_0x32834e});if(_0x4342cd[_0xeca40e(0x1ac)]>THERMO_LOG_SIZE)_0x4342cd['shift']();await _0x299cab[_0xeca40e(0x1c5)]('LTM.trainingData.thermodynamics',{'val':JSON[_0xeca40e(0x19b)](_0x4342cd),'ack':!![]});}async function saveCompletedSequence(_0x401a6d){const _0x1e282a=a5_0x37e0;try{const _0x1a35bc=await _0x401a6d['getStateAsync'](_0x1e282a(0x1f8));let _0x52b270=[];if(_0x1a35bc&&_0x1a35bc[_0x1e282a(0x1fb)])try{_0x52b270=JSON[_0x1e282a(0x1ea)](_0x1a35bc[_0x1e282a(0x1fb)]);}catch(_0x377274){}const _0x8f2ddf=activeSequence[0x0]['ts'],_0x59073b=activeSequence[_0x1e282a(0x1e1)](_0x2433f5=>({'loc':_0x2433f5[_0x1e282a(0x1d2)],'t_delta':Math['round']((_0x2433f5['ts']-_0x8f2ddf)/0x3e8)})),_0x34a293={'timestamp':new Date(_0x8f2ddf)[_0x1e282a(0x1c7)](),'steps':_0x59073b,'duration':Math[_0x1e282a(0x1bc)]((activeSequence[activeSequence['length']-0x1]['ts']-_0x8f2ddf)/0x3e8),'daytime':new Date(_0x8f2ddf)[_0x1e282a(0x1ba)]()};_0x52b270[_0x1e282a(0x1ee)](_0x34a293);if(_0x52b270[_0x1e282a(0x1ac)]>MAX_TRAINING_SET_SIZE)_0x52b270['shift']();await _0x401a6d[_0x1e282a(0x1c5)]('LTM.trainingData.sequences',{'val':JSON['stringify'](_0x52b270),'ack':!![]}),_0x401a6d[_0x1e282a(0x1a9)]&&_0x401a6d[_0x1e282a(0x1a2)]&&_0x401a6d[_0x1e282a(0x1a2)](_0x1e282a(0x1c8),{'sequence':_0x34a293});}catch(_0x2b72e0){_0x401a6d['log'][_0x1e282a(0x1af)](_0x1e282a(0x202)+_0x2b72e0[_0x1e282a(0x1b0)]);}}async function recordSequence(_0x11bbbf,_0x2f62c0){const _0x256007=a5_0x37e0,_0x544bad=(_0x2f62c0['type']||'')[_0x256007(0x1df)](),_0x4237cd=[_0x256007(0x198),_0x256007(0x19a),_0x256007(0x1b6),_0x256007(0x1e5),_0x256007(0x1d6),'door',_0x256007(0x1b4),_0x256007(0x1f4),_0x256007(0x1de),'contact',_0x256007(0x1d5),_0x256007(0x1da),_0x256007(0x1ed),_0x256007(0x1eb),_0x256007(0x1cf),'dimmer',_0x256007(0x1fc)];if(!_0x4237cd[_0x256007(0x1f5)](_0x225326=>_0x544bad[_0x256007(0x1c3)](_0x225326)))return;if(!_0x2f62c0[_0x256007(0x1cd)])return;if(sequenceTimer)clearTimeout(sequenceTimer);activeSequence['push']({'loc':_0x2f62c0['location']||_0x256007(0x1b8),'id':_0x2f62c0['id'],'ts':Date['now']()}),sequenceTimer=setTimeout(async()=>{const _0x4a23e6=_0x256007;if(activeSequence[_0x4a23e6(0x1ac)]>0x1)await saveCompletedSequence(_0x11bbbf);activeSequence=[];},SEQUENCE_TIMEOUT_MS);}function startExitTimer(_0x149c21){const _0x10b3f3=a5_0x37e0;abortExitTimer(_0x149c21),_0x149c21['isGracePeriodActive']=!![],_0x149c21[_0x10b3f3(0x1ec)]=setTimeout(()=>{_0x149c21['isGracePeriodActive']=![];},EXIT_GRACE_PERIOD_SECONDS*0x3e8),_0x149c21[_0x10b3f3(0x1e8)]=setTimeout(()=>{const _0x535346=_0x10b3f3;setPresence(_0x149c21,![]),_0x149c21[_0x535346(0x1e8)]=null;},EXIT_TIMER_MINUTES*0x3c*0x3e8);}function abortExitTimer(_0x5f0c88){const _0x1df8ba=a5_0x37e0;if(_0x5f0c88[_0x1df8ba(0x1e8)])clearTimeout(_0x5f0c88[_0x1df8ba(0x1e8)]);if(_0x5f0c88[_0x1df8ba(0x1ec)])clearTimeout(_0x5f0c88[_0x1df8ba(0x1ec)]);_0x5f0c88[_0x1df8ba(0x1e8)]=null,_0x5f0c88[_0x1df8ba(0x1ec)]=null,_0x5f0c88[_0x1df8ba(0x1f1)]=![];}function a5_0x3b8e(){const _0x109b8f=['motion','.ACTUAL_TEMPERATURE','bewegung','stringify','log','weatherInstance','analysis.health.todayVector','sensorLastValues','type','number','sendToPythonWrapper','daswetter','155fOmXMT','SIMULATE_SIGNAL','.1.TEMPERATURE','config','temperatur','isProVersion','.forecast.current.temperature','2492jpQRJJ','length','apply','Temperature','error','message','rawEventLog','.4.VALVE_STATE','debug','tür','location','präsenz','Valve','Unknown','STATUS','getHours','logDuplicates','round','.forecast.current.temp','currentSystemMode','LTM.trainingData.thermodynamics','normal','weatherunderground','1518693WagYMn','includes','from','setStateAsync','.NextHours.Location_1.Day_1.current.temp_value','toISOString','ANALYZE_SEQUENCE','valveMapping','outdoorSensorId','30aMUYUv','search','value','getForeignStateAsync','schalter','splice','eventHistory','loc','906024tTUjiw','exports','kontakt','occupancy','STATE','replace','getStateAsync','light','TRACK_EVENT','773GWBqhA','60054SSnNZe','fenster','toLowerCase','(((.+)+)+)+$','map','isPresent','3541900bsNDdw','.1.ACTUAL_TEMPERATURE','presence','LEVEL','.Current.Temperature','exitTimer','9444888gWpGSt','parse','switch','exitGraceTimer','licht','push','9lKhpvt','8756727KLIgyQ','isGracePeriodActive','unshift','lastTrackerEventTime','window','some','door','level','LTM.trainingData.sequences','accuweather','string','val','lampe','dimmer','fill','griff','isExit','getDate','[RECORDER]\x20Error:\x20','.1.LEVEL','toString'];a5_0x3b8e=function(){return _0x109b8f;};return a5_0x3b8e();}async function setPresence(_0x4ceb30,_0x5cdb3f){const _0x553234=a5_0x37e0;if(_0x4ceb30[_0x553234(0x1e2)]===_0x5cdb3f)return;_0x4ceb30['isPresent']=_0x5cdb3f,await _0x4ceb30['setStateAsync']('system.isPresent',{'val':_0x5cdb3f,'ack':!![]});}async function updateHourlyActivity(_0x175d1b){const _0x397b07=a5_0x37e0;let _0x340ba6=new Array(0x18)[_0x397b07(0x1fe)](0x0),_0x163796=0x0;try{const _0x4ed841=await _0x175d1b[_0x397b07(0x1d9)](_0x397b07(0x19e));_0x4ed841&&_0x4ed841[_0x397b07(0x1fb)]&&(_0x340ba6=JSON[_0x397b07(0x1ea)](_0x4ed841[_0x397b07(0x1fb)]),_0x163796=_0x4ed841['ts']);}catch(_0x137d5e){}const _0xef180d=new Date(_0x163796),_0x4795ba=new Date();_0xef180d[_0x397b07(0x201)]()!==_0x4795ba['getDate']()&&(_0x340ba6=new Array(0x18)[_0x397b07(0x1fe)](0x0));const _0x1a5d4e=_0x4795ba[_0x397b07(0x1ba)]();if(_0x340ba6[_0x1a5d4e]===undefined)_0x340ba6[_0x1a5d4e]=0x0;_0x340ba6[_0x1a5d4e]++,await _0x175d1b[_0x397b07(0x1c5)](_0x397b07(0x19e),{'val':JSON[_0x397b07(0x19b)](_0x340ba6),'ack':!![]});}async function processSensorEvent(_0x36f18b,_0x4ee740,_0x40cc95,_0x5ac595){const _0x56e00b=a5_0x37e0;if(!_0x5ac595)return null;const _0x207d83=_0x40cc95[_0x56e00b(0x1fb)],_0x20d682=Date['now'](),_0x1d4ea8=_0x36f18b[_0x56e00b(0x19f)][_0x4ee740],_0x5bd24f=(_0x5ac595[_0x56e00b(0x1a0)]||'')[_0x56e00b(0x1df)](),_0x346f06=_0x5bd24f[_0x56e00b(0x1c3)]('temperature')||_0x5bd24f['includes'](_0x56e00b(0x1a8))||_0x5bd24f[_0x56e00b(0x1c3)]('klima')||_0x5bd24f[_0x56e00b(0x1c3)]('heizung')||_0x5bd24f[_0x56e00b(0x1c3)]('thermostat');if(_0x346f06&&typeof _0x207d83===_0x56e00b(0x1a1)){if(_0x207d83>0x50||_0x207d83<-0x32)return _0x36f18b[_0x56e00b(0x19c)][_0x56e00b(0x1b3)]('[RECORDER]\x20Ignored\x20implausible\x20temperature:\x20'+_0x207d83+'\x20from\x20'+_0x4ee740),null;}_0x36f18b['sensorLastValues'][_0x4ee740]=_0x207d83;if(!_0x5ac595[_0x56e00b(0x1bb)]&&_0x1d4ea8!=undefined&&_0x1d4ea8==_0x207d83)return null;_0x36f18b[_0x56e00b(0x1a9)]&&_0x346f06&&recordThermodynamics(_0x36f18b,_0x4ee740,_0x207d83,_0x5ac595[_0x56e00b(0x1b5)]);const _0x1767f5={'timestamp':_0x20d682,'id':_0x4ee740,'name':_0x5ac595['name'],'type':_0x5ac595[_0x56e00b(0x1a0)],'location':_0x5ac595[_0x56e00b(0x1b5)],'value':_0x207d83};_0x36f18b[_0x56e00b(0x1d1)][_0x56e00b(0x1f2)](_0x1767f5);if(_0x36f18b[_0x56e00b(0x1d1)][_0x56e00b(0x1ac)]>HISTORY_MAX_SIZE)_0x36f18b[_0x56e00b(0x1d1)]['pop']();await _0x36f18b[_0x56e00b(0x1c5)]('events.lastEvent',{'val':JSON[_0x56e00b(0x19b)](_0x1767f5),'ack':!![]}),await _0x36f18b[_0x56e00b(0x1c5)]('events.history',{'val':JSON[_0x56e00b(0x19b)](_0x36f18b['eventHistory']),'ack':!![]}),await updateHourlyActivity(_0x36f18b);if(_0x36f18b[_0x56e00b(0x1a9)]){_0x36f18b['rawEventLog']['push'](_0x1767f5);if(_0x36f18b[_0x56e00b(0x1b1)][_0x56e00b(0x1ac)]>RAW_LOG_MAX_SIZE)_0x36f18b['rawEventLog'][_0x56e00b(0x1d0)](0x0,_0x36f18b[_0x56e00b(0x1b1)][_0x56e00b(0x1ac)]-RAW_LOG_MAX_SIZE);await _0x36f18b['setStateAsync']('LTM.rawEventLog',{'val':JSON[_0x56e00b(0x19b)](_0x36f18b[_0x56e00b(0x1b1)]),'ack':!![]}),recordSequence(_0x36f18b,_0x1767f5);}if(_0x5ac595[_0x56e00b(0x200)]&&_0x207d83===!![]){if(_0x36f18b[_0x56e00b(0x1e2)]&&!_0x36f18b[_0x56e00b(0x1f1)])startExitTimer(_0x36f18b);else{if(!_0x36f18b[_0x56e00b(0x1e2)])setPresence(_0x36f18b,!![]);}}else{if(_0x5ac595[_0x56e00b(0x1a0)]===_0x56e00b(0x198)&&_0x207d83===!![]){if(_0x36f18b[_0x56e00b(0x1e8)])abortExitTimer(_0x36f18b);if(!_0x36f18b[_0x56e00b(0x1e2)]&&_0x36f18b[_0x56e00b(0x1be)]===_0x56e00b(0x1c0))setPresence(_0x36f18b,!![]);}}if(_0x36f18b[_0x56e00b(0x1a9)]&&_0x36f18b[_0x56e00b(0x1a2)]){_0x5ac595['type']===_0x56e00b(0x198)&&_0x207d83===!![]&&_0x5ac595[_0x56e00b(0x1b5)]&&_0x36f18b['sendToPythonWrapper'](_0x56e00b(0x1a5),{'room':_0x5ac595[_0x56e00b(0x1b5)]});const _0x337985=[_0x56e00b(0x1f6),_0x56e00b(0x1b4),_0x56e00b(0x1f4),_0x56e00b(0x1de),_0x56e00b(0x1ff),'handle','lock','schloss']['some'](_0x6dcc17=>_0x5bd24f[_0x56e00b(0x1c3)](_0x6dcc17)),_0x48b120=['light',_0x56e00b(0x1ed),'switch',_0x56e00b(0x1cf),_0x56e00b(0x1fd),'lampe'][_0x56e00b(0x1f5)](_0x42e063=>_0x5bd24f[_0x56e00b(0x1c3)](_0x42e063)),_0x339dbf=[_0x56e00b(0x198),_0x56e00b(0x19a),'präsenz','presence',_0x56e00b(0x1d6)][_0x56e00b(0x1f5)](_0x441cbb=>_0x5bd24f[_0x56e00b(0x1c3)](_0x441cbb));if(_0x5ac595['location']&&(_0x337985||_0x48b120||_0x339dbf)){const _0x39314d=_0x207d83===!![]||typeof _0x207d83==='number'&&_0x207d83>0x0,_0x8fa592=_0x337985&&!_0x39314d&&_0x1d4ea8!==undefined&&_0x1d4ea8!=_0x207d83;if(_0x39314d||_0x8fa592){const _0x5076a1=_0x36f18b[_0x56e00b(0x1f3)]||_0x20d682,_0x468338=(_0x20d682-_0x5076a1)/0x3e8;_0x36f18b[_0x56e00b(0x1f3)]=_0x20d682,_0x36f18b[_0x56e00b(0x1a2)](_0x56e00b(0x1db),{'room':_0x5ac595[_0x56e00b(0x1b5)],'dt':_0x468338});}}}return _0x1767f5;}module[a5_0x2ed79a(0x1d4)]={'processSensorEvent':processSensorEvent,'getOutsideTemperatureNumeric':getOutsideTemperatureNumeric,'setPresence':setPresence,'abortExitTimer':abortExitTimer,'startExitTimer':startExitTimer};