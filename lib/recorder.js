const a5_0x4f2031=a5_0xbbaf;(function(_0x59ce77,_0x4e3afc){const _0x18f912=a5_0xbbaf,_0x563f62=_0x59ce77();while(!![]){try{const _0xa43581=parseInt(_0x18f912(0x12f))/0x1+parseInt(_0x18f912(0x18e))/0x2*(-parseInt(_0x18f912(0x14c))/0x3)+parseInt(_0x18f912(0x183))/0x4*(-parseInt(_0x18f912(0x182))/0x5)+-parseInt(_0x18f912(0x172))/0x6+parseInt(_0x18f912(0x17c))/0x7*(-parseInt(_0x18f912(0x190))/0x8)+-parseInt(_0x18f912(0x159))/0x9*(parseInt(_0x18f912(0x155))/0xa)+parseInt(_0x18f912(0x193))/0xb;if(_0xa43581===_0x4e3afc)break;else _0x563f62['push'](_0x563f62['shift']());}catch(_0xc2cea8){_0x563f62['push'](_0x563f62['shift']());}}}(a5_0x3dc5,0xa171e));function a5_0xbbaf(_0x37d7c3,_0x1cccaa){const _0x57e1fb=a5_0x3dc5();return a5_0xbbaf=function(_0x283098,_0x594f47){_0x283098=_0x283098-0x12d;let _0x3dc5ff=_0x57e1fb[_0x283098];return _0x3dc5ff;},a5_0xbbaf(_0x37d7c3,_0x1cccaa);}function a5_0x3dc5(){const _0x6cae7f=['724hhgjeU','lampe','apply','map','location','getDate','getForeignStateAsync','(((.+)+)+)+$','.forecast.current.temperature','getHours','STATUS','18SzfvNk','getStateAsync','6504nwpgXc','message','fill','28446495dKUyBT','präsenz','Temperature','schloss','pop','thermostat','LTM.trainingData.thermodynamics','stringify','.Current.Temperature','push','window','TRACK_EVENT','556721XthumW','some','sendToPythonWrapper','toISOString','weatherInstance','Unknown','rawEventLog','exitGraceTimer','.NextHours.Location_1.Day_1.current.temp_value','shift','isGracePeriodActive','isPresent','exports','eventHistory','motion','door','[RECORDER]\x20Ignored\x20implausible\x20temperature:\x20','from','contact','normal','LTM.trainingData.sequences','val','schalter','sensorLastValues','temperature','logDuplicates','string','lock','light','243471EyiJxA','type','splice','weatherunderground','presence','outdoorSensorId','constructor','level','log','838330cnnBcV','toString','.4.VALVE_STATE','name','27bkGyma','length','handle','LEVEL','includes','round','lastTrackerEventTime','licht','isProVersion','now','.1.ACTUAL_TEMPERATURE','config','valveMapping','accuweather','tür','.forecast.current.temp','dimmer','Valve','.1.TEMPERATURE','error','switch','events.history','exitTimer','search','parse','4537494kdgKNK','number','bewegung','analysis.health.todayVector','system.isPresent','.LEVEL','occupancy','events.lastEvent','toLowerCase','SIMULATE_SIGNAL','5677dtvcCk','STATE','temperatur','.ACTUAL_TEMPERATURE','.1.VALVE_STATE','setStateAsync','2320lDwOEJ'];a5_0x3dc5=function(){return _0x6cae7f;};return a5_0x3dc5();}const a5_0x594f47=(function(){let _0x380f72=!![];return function(_0x526baa,_0x246bf2){const _0x53e7ef=_0x380f72?function(){const _0x400e52=a5_0xbbaf;if(_0x246bf2){const _0x51daa3=_0x246bf2[_0x400e52(0x185)](_0x526baa,arguments);return _0x246bf2=null,_0x51daa3;}}:function(){};return _0x380f72=![],_0x53e7ef;};}()),a5_0x283098=a5_0x594f47(this,function(){const _0x489d86=a5_0xbbaf;return a5_0x283098[_0x489d86(0x156)]()[_0x489d86(0x170)](_0x489d86(0x18a))['toString']()[_0x489d86(0x152)](a5_0x283098)[_0x489d86(0x170)](_0x489d86(0x18a));});a5_0x283098();'use strict';const HISTORY_MAX_SIZE=0x32,RAW_LOG_MAX_SIZE=0x9c4,THERMO_LOG_SIZE=0x3e8,SEQUENCE_TIMEOUT_MS=0x5*0x3c*0x3e8,MAX_TRAINING_SET_SIZE=0x1f4,EXIT_TIMER_MINUTES=0xf,EXIT_GRACE_PERIOD_SECONDS=0x1e;let activeSequence=[],sequenceTimer=null,dailyActivityLog=new Array(0x18)['fill'](0x0),lastLogDay=new Date()[a5_0x4f2031(0x188)]();async function getOutsideTemperatureNumeric(_0x33e25b){const _0x4ae171=a5_0x4f2031;if(_0x33e25b[_0x4ae171(0x164)][_0x4ae171(0x151)])try{const _0x85c76c=await _0x33e25b['getForeignStateAsync'](_0x33e25b[_0x4ae171(0x164)][_0x4ae171(0x151)]);if(_0x85c76c&&_0x85c76c[_0x4ae171(0x144)]!==undefined&&_0x85c76c['val']!==null)return parseFloat(_0x85c76c[_0x4ae171(0x144)]);}catch(_0x276f81){}const _0x4a2c17=_0x33e25b[_0x4ae171(0x164)][_0x4ae171(0x133)];if(!_0x33e25b[_0x4ae171(0x164)]['useWeather']||!_0x4a2c17)return null;try{let _0x56bde8='';if(_0x4a2c17[_0x4ae171(0x15d)](_0x4ae171(0x166)))_0x56bde8=_0x4a2c17+_0x4ae171(0x19b);else{if(_0x4a2c17[_0x4ae171(0x15d)]('daswetter'))_0x56bde8=_0x4a2c17+_0x4ae171(0x137);else{if(_0x4a2c17[_0x4ae171(0x15d)]('openweathermap'))_0x56bde8=_0x4a2c17+_0x4ae171(0x18b);else{if(_0x4a2c17[_0x4ae171(0x15d)](_0x4ae171(0x14f)))_0x56bde8=_0x4a2c17+_0x4ae171(0x168);}}}if(_0x56bde8){const _0x77c7b8=await _0x33e25b['getForeignStateAsync'](_0x56bde8);if(_0x77c7b8&&_0x77c7b8[_0x4ae171(0x144)]!==undefined&&_0x77c7b8[_0x4ae171(0x144)]!==null)return parseFloat(_0x77c7b8[_0x4ae171(0x144)]);}}catch(_0x37fa25){}return null;}async function recordThermodynamics(_0x548c6e,_0x2cfad3,_0x39b4c7,_0x526f3c){const _0x11f9e7=a5_0x4f2031,_0x36ec69=await getOutsideTemperatureNumeric(_0x548c6e);if(_0x36ec69===null)return;let _0x1091c9=0x0,_0x3f0b2e=![];if(_0x548c6e[_0x11f9e7(0x164)][_0x11f9e7(0x165)])try{let _0x2809b2=_0x548c6e[_0x11f9e7(0x164)][_0x11f9e7(0x165)];if(typeof _0x2809b2===_0x11f9e7(0x149))_0x2809b2=JSON[_0x11f9e7(0x171)](_0x2809b2);if(_0x2809b2[_0x2cfad3]){const _0x50c41e=_0x2809b2[_0x2cfad3],_0xbc9651=await _0x548c6e[_0x11f9e7(0x189)](_0x50c41e);if(_0xbc9651&&_0xbc9651[_0x11f9e7(0x144)]!==null&&_0xbc9651[_0x11f9e7(0x144)]!==undefined){let _0x3a189a=Number(_0xbc9651[_0x11f9e7(0x144)]);if(_0x3a189a<=1.05&&!_0x50c41e[_0x11f9e7(0x15d)](_0x11f9e7(0x18d))&&!_0x50c41e['includes'](_0x11f9e7(0x17d)))_0x3a189a=_0x3a189a*0x64;_0x1091c9=Math[_0x11f9e7(0x15e)](_0x3a189a),_0x3f0b2e=!![];}}}catch(_0x43b80a){}if(!_0x3f0b2e){const _0xaa9746=[{'from':_0x11f9e7(0x163),'to':'.1.LEVEL'},{'from':_0x11f9e7(0x163),'to':_0x11f9e7(0x180)},{'from':_0x11f9e7(0x16b),'to':_0x11f9e7(0x157)},{'from':_0x11f9e7(0x17f),'to':_0x11f9e7(0x177)},{'from':_0x11f9e7(0x147),'to':_0x11f9e7(0x153)},{'from':_0x11f9e7(0x195),'to':_0x11f9e7(0x16a)}];for(const _0x1364ce of _0xaa9746){if(_0x2cfad3['includes'](_0x1364ce[_0x11f9e7(0x140)])){const _0x2ebd58=_0x2cfad3['replace'](_0x1364ce['from'],_0x1364ce['to']);try{const _0x8c0504=await _0x548c6e[_0x11f9e7(0x189)](_0x2ebd58);if(_0x8c0504&&_0x8c0504[_0x11f9e7(0x144)]!==null&&_0x8c0504[_0x11f9e7(0x144)]!==undefined){let _0xbad87=Number(_0x8c0504[_0x11f9e7(0x144)]);if(typeof _0xbad87==='number'){if(_0xbad87<=1.05&&_0x1364ce['to'][_0x11f9e7(0x15d)](_0x11f9e7(0x15c)))_0xbad87=_0xbad87*0x64;_0x1091c9=Math[_0x11f9e7(0x15e)](_0xbad87),_0x3f0b2e=!![];break;}}}catch(_0x51a423){}}}}const _0x1d30f7=await _0x548c6e[_0x11f9e7(0x18f)](_0x11f9e7(0x199));let _0x9e9976=[];if(_0x1d30f7&&_0x1d30f7[_0x11f9e7(0x144)])try{_0x9e9976=JSON['parse'](_0x1d30f7[_0x11f9e7(0x144)]);}catch(_0xfc3a36){}_0x9e9976['push']({'ts':Date[_0x11f9e7(0x162)](),'room':_0x526f3c||_0x11f9e7(0x134),'t_in':_0x39b4c7,'t_out':_0x36ec69,'valve':_0x1091c9});if(_0x9e9976['length']>THERMO_LOG_SIZE)_0x9e9976[_0x11f9e7(0x138)]();await _0x548c6e[_0x11f9e7(0x181)](_0x11f9e7(0x199),{'val':JSON['stringify'](_0x9e9976),'ack':!![]});}async function saveCompletedSequence(_0x135774){const _0xce0ba2=a5_0x4f2031;try{const _0x269167=await _0x135774[_0xce0ba2(0x18f)](_0xce0ba2(0x143));let _0x4c83ce=[];if(_0x269167&&_0x269167[_0xce0ba2(0x144)])try{_0x4c83ce=JSON[_0xce0ba2(0x171)](_0x269167[_0xce0ba2(0x144)]);}catch(_0x16493f){}const _0x792589=activeSequence[0x0]['ts'],_0x57b279=activeSequence[_0xce0ba2(0x186)](_0x4b2c5f=>({'loc':_0x4b2c5f['loc'],'t_delta':Math[_0xce0ba2(0x15e)]((_0x4b2c5f['ts']-_0x792589)/0x3e8)})),_0x1bd759={'timestamp':new Date(_0x792589)[_0xce0ba2(0x132)](),'steps':_0x57b279,'duration':Math[_0xce0ba2(0x15e)]((activeSequence[activeSequence['length']-0x1]['ts']-_0x792589)/0x3e8),'daytime':new Date(_0x792589)[_0xce0ba2(0x18c)]()};_0x4c83ce[_0xce0ba2(0x19c)](_0x1bd759);if(_0x4c83ce[_0xce0ba2(0x15a)]>MAX_TRAINING_SET_SIZE)_0x4c83ce[_0xce0ba2(0x138)]();await _0x135774[_0xce0ba2(0x181)](_0xce0ba2(0x143),{'val':JSON[_0xce0ba2(0x19a)](_0x4c83ce),'ack':!![]}),_0x135774[_0xce0ba2(0x161)]&&_0x135774[_0xce0ba2(0x131)]&&_0x135774[_0xce0ba2(0x131)]('ANALYZE_SEQUENCE',{'sequence':_0x1bd759});}catch(_0x5e1b66){_0x135774[_0xce0ba2(0x154)][_0xce0ba2(0x16c)]('[RECORDER]\x20Error:\x20'+_0x5e1b66[_0xce0ba2(0x191)]);}}async function recordSequence(_0x436dfc,_0x3c6647){const _0x102510=a5_0x4f2031,_0x9822e4=(_0x3c6647[_0x102510(0x14d)]||'')[_0x102510(0x17a)](),_0x34d5de=['motion',_0x102510(0x174),_0x102510(0x194),_0x102510(0x150),_0x102510(0x178),_0x102510(0x13e),'tür',_0x102510(0x12d),'fenster',_0x102510(0x141),'kontakt',_0x102510(0x14b),'licht',_0x102510(0x16d),'schalter',_0x102510(0x169),_0x102510(0x184)];if(!_0x34d5de['some'](_0x1c662f=>_0x9822e4[_0x102510(0x15d)](_0x1c662f)))return;if(!_0x3c6647['value'])return;if(sequenceTimer)clearTimeout(sequenceTimer);activeSequence[_0x102510(0x19c)]({'loc':_0x3c6647[_0x102510(0x187)]||_0x102510(0x134),'id':_0x3c6647['id'],'ts':Date[_0x102510(0x162)]()}),sequenceTimer=setTimeout(async()=>{const _0x2f5137=_0x102510;if(activeSequence[_0x2f5137(0x15a)]>0x1)await saveCompletedSequence(_0x436dfc);activeSequence=[];},SEQUENCE_TIMEOUT_MS);}function startExitTimer(_0x187d13){const _0x42d62a=a5_0x4f2031;abortExitTimer(_0x187d13),_0x187d13[_0x42d62a(0x139)]=!![],_0x187d13[_0x42d62a(0x136)]=setTimeout(()=>{_0x187d13['isGracePeriodActive']=![];},EXIT_GRACE_PERIOD_SECONDS*0x3e8),_0x187d13[_0x42d62a(0x16f)]=setTimeout(()=>{const _0x50a533=_0x42d62a;setPresence(_0x187d13,![]),_0x187d13[_0x50a533(0x16f)]=null;},EXIT_TIMER_MINUTES*0x3c*0x3e8);}function abortExitTimer(_0x579d6f){const _0x88f74=a5_0x4f2031;if(_0x579d6f[_0x88f74(0x16f)])clearTimeout(_0x579d6f[_0x88f74(0x16f)]);if(_0x579d6f[_0x88f74(0x136)])clearTimeout(_0x579d6f[_0x88f74(0x136)]);_0x579d6f['exitTimer']=null,_0x579d6f[_0x88f74(0x136)]=null,_0x579d6f[_0x88f74(0x139)]=![];}async function setPresence(_0x59a444,_0x1b8732){const _0x2ad0bc=a5_0x4f2031;if(_0x59a444[_0x2ad0bc(0x13a)]===_0x1b8732)return;_0x59a444['isPresent']=_0x1b8732,await _0x59a444[_0x2ad0bc(0x181)](_0x2ad0bc(0x176),{'val':_0x1b8732,'ack':!![]});}async function updateHourlyActivity(_0x2a2dc2){const _0xecddf9=a5_0x4f2031,_0x1b829a=new Date()[_0xecddf9(0x188)]();_0x1b829a!==lastLogDay&&(dailyActivityLog=new Array(0x18)[_0xecddf9(0x192)](0x0),lastLogDay=_0x1b829a);const _0x9c333f=new Date()[_0xecddf9(0x18c)]();if(dailyActivityLog[_0x9c333f]===undefined)dailyActivityLog[_0x9c333f]=0x0;dailyActivityLog[_0x9c333f]++,await _0x2a2dc2[_0xecddf9(0x181)](_0xecddf9(0x175),{'val':JSON['stringify'](dailyActivityLog),'ack':!![]});}async function processSensorEvent(_0x51db2d,_0x13a2b0,_0xd30f43,_0x188c9b){const _0xe4fccc=a5_0x4f2031;if(!_0x188c9b)return null;const _0x66e27d=_0xd30f43[_0xe4fccc(0x144)],_0x516253=Date[_0xe4fccc(0x162)](),_0x59c596=_0x51db2d[_0xe4fccc(0x146)][_0x13a2b0],_0x50754c=(_0x188c9b[_0xe4fccc(0x14d)]||'')['toLowerCase'](),_0x4e06c0=_0x50754c[_0xe4fccc(0x15d)](_0xe4fccc(0x147))||_0x50754c['includes'](_0xe4fccc(0x17e))||_0x50754c[_0xe4fccc(0x15d)]('klima')||_0x50754c[_0xe4fccc(0x15d)]('heizung')||_0x50754c[_0xe4fccc(0x15d)](_0xe4fccc(0x198));if(_0x4e06c0&&typeof _0x66e27d==='number'){if(_0x66e27d>0x50||_0x66e27d<-0x32)return _0x51db2d[_0xe4fccc(0x154)]['debug'](_0xe4fccc(0x13f)+_0x66e27d+'\x20from\x20'+_0x13a2b0),null;}_0x51db2d['sensorLastValues'][_0x13a2b0]=_0x66e27d;if(!_0x188c9b[_0xe4fccc(0x148)]&&_0x59c596!=undefined&&_0x59c596==_0x66e27d)return null;_0x51db2d[_0xe4fccc(0x161)]&&_0x4e06c0&&recordThermodynamics(_0x51db2d,_0x13a2b0,_0x66e27d,_0x188c9b['location']);const _0x121444={'timestamp':_0x516253,'id':_0x13a2b0,'name':_0x188c9b[_0xe4fccc(0x158)],'type':_0x188c9b[_0xe4fccc(0x14d)],'location':_0x188c9b[_0xe4fccc(0x187)],'value':_0x66e27d};_0x51db2d['eventHistory']['unshift'](_0x121444);if(_0x51db2d[_0xe4fccc(0x13c)]['length']>HISTORY_MAX_SIZE)_0x51db2d[_0xe4fccc(0x13c)][_0xe4fccc(0x197)]();await _0x51db2d[_0xe4fccc(0x181)](_0xe4fccc(0x179),{'val':JSON['stringify'](_0x121444),'ack':!![]}),await _0x51db2d[_0xe4fccc(0x181)](_0xe4fccc(0x16e),{'val':JSON[_0xe4fccc(0x19a)](_0x51db2d[_0xe4fccc(0x13c)]),'ack':!![]}),await updateHourlyActivity(_0x51db2d);if(_0x51db2d[_0xe4fccc(0x161)]){_0x51db2d[_0xe4fccc(0x135)][_0xe4fccc(0x19c)](_0x121444);if(_0x51db2d[_0xe4fccc(0x135)][_0xe4fccc(0x15a)]>RAW_LOG_MAX_SIZE)_0x51db2d[_0xe4fccc(0x135)][_0xe4fccc(0x14e)](0x0,_0x51db2d[_0xe4fccc(0x135)][_0xe4fccc(0x15a)]-RAW_LOG_MAX_SIZE);await _0x51db2d[_0xe4fccc(0x181)]('LTM.rawEventLog',{'val':JSON[_0xe4fccc(0x19a)](_0x51db2d[_0xe4fccc(0x135)]),'ack':!![]}),recordSequence(_0x51db2d,_0x121444);}if(_0x188c9b['isExit']&&_0x66e27d===!![]){if(_0x51db2d['isPresent']&&!_0x51db2d[_0xe4fccc(0x139)])startExitTimer(_0x51db2d);else{if(!_0x51db2d['isPresent'])setPresence(_0x51db2d,!![]);}}else{if(_0x188c9b[_0xe4fccc(0x14d)]===_0xe4fccc(0x13d)&&_0x66e27d===!![]){if(_0x51db2d[_0xe4fccc(0x16f)])abortExitTimer(_0x51db2d);if(!_0x51db2d[_0xe4fccc(0x13a)]&&_0x51db2d['currentSystemMode']===_0xe4fccc(0x142))setPresence(_0x51db2d,!![]);}}if(_0x51db2d[_0xe4fccc(0x161)]&&_0x51db2d[_0xe4fccc(0x131)]){_0x188c9b[_0xe4fccc(0x14d)]===_0xe4fccc(0x13d)&&_0x66e27d===!![]&&_0x188c9b[_0xe4fccc(0x187)]&&_0x51db2d['sendToPythonWrapper'](_0xe4fccc(0x17b),{'room':_0x188c9b[_0xe4fccc(0x187)]});const _0x1d7409=[_0xe4fccc(0x13e),_0xe4fccc(0x167),_0xe4fccc(0x12d),'fenster','griff',_0xe4fccc(0x15b),_0xe4fccc(0x14a),_0xe4fccc(0x196)][_0xe4fccc(0x130)](_0x3fb33d=>_0x50754c['includes'](_0x3fb33d)),_0x27e969=[_0xe4fccc(0x14b),_0xe4fccc(0x160),_0xe4fccc(0x16d),_0xe4fccc(0x145),_0xe4fccc(0x169),_0xe4fccc(0x184)][_0xe4fccc(0x130)](_0x172f14=>_0x50754c[_0xe4fccc(0x15d)](_0x172f14)),_0x1b37ed=[_0xe4fccc(0x13d),_0xe4fccc(0x174),_0xe4fccc(0x194),_0xe4fccc(0x150),'occupancy']['some'](_0x518dcb=>_0x50754c[_0xe4fccc(0x15d)](_0x518dcb));if(_0x188c9b[_0xe4fccc(0x187)]&&(_0x1d7409||_0x27e969||_0x1b37ed)){const _0x1d88d5=_0x66e27d===!![]||typeof _0x66e27d===_0xe4fccc(0x173)&&_0x66e27d>0x0,_0x5db06f=_0x1d7409&&!_0x1d88d5&&_0x59c596!==undefined&&_0x59c596!=_0x66e27d;if(_0x1d88d5||_0x5db06f){const _0x4e6973=_0x51db2d[_0xe4fccc(0x15f)]||_0x516253,_0x180f8e=(_0x516253-_0x4e6973)/0x3e8;_0x51db2d[_0xe4fccc(0x15f)]=_0x516253,_0x51db2d[_0xe4fccc(0x131)](_0xe4fccc(0x12e),{'room':_0x188c9b[_0xe4fccc(0x187)],'dt':_0x180f8e});}}}return _0x121444;}module[a5_0x4f2031(0x13b)]={'processSensorEvent':processSensorEvent,'getOutsideTemperatureNumeric':getOutsideTemperatureNumeric,'setPresence':setPresence,'abortExitTimer':abortExitTimer,'startExitTimer':startExitTimer};