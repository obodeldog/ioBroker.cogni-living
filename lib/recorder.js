const a5_0x1580fe=a5_0x2640;function a5_0x2640(_0x5404cb,_0x55f2ee){const _0x56f981=a5_0x180e();return a5_0x2640=function(_0x5475d8,_0x2fa3b1){_0x5475d8=_0x5475d8-0x159;let _0x180e14=_0x56f981[_0x5475d8];return _0x180e14;},a5_0x2640(_0x5404cb,_0x55f2ee);}(function(_0xa381b4,_0x4737bb){const _0x71bcae=a5_0x2640,_0x50889e=_0xa381b4();while(!![]){try{const _0x48f1ce=-parseInt(_0x71bcae(0x196))/0x1+-parseInt(_0x71bcae(0x170))/0x2+-parseInt(_0x71bcae(0x18a))/0x3+-parseInt(_0x71bcae(0x160))/0x4+-parseInt(_0x71bcae(0x1c8))/0x5+parseInt(_0x71bcae(0x1b6))/0x6*(parseInt(_0x71bcae(0x171))/0x7)+parseInt(_0x71bcae(0x193))/0x8*(parseInt(_0x71bcae(0x174))/0x9);if(_0x48f1ce===_0x4737bb)break;else _0x50889e['push'](_0x50889e['shift']());}catch(_0x29f1c3){_0x50889e['push'](_0x50889e['shift']());}}}(a5_0x180e,0x55674));const a5_0x2fa3b1=(function(){let _0x312b23=!![];return function(_0x410ccb,_0x5b067f){const _0x26fb82=_0x312b23?function(){if(_0x5b067f){const _0x1c67a3=_0x5b067f['apply'](_0x410ccb,arguments);return _0x5b067f=null,_0x1c67a3;}}:function(){};return _0x312b23=![],_0x26fb82;};}()),a5_0x5475d8=a5_0x2fa3b1(this,function(){const _0x23ddf5=a5_0x2640;return a5_0x5475d8[_0x23ddf5(0x18f)]()[_0x23ddf5(0x1c3)](_0x23ddf5(0x1bc))['toString']()[_0x23ddf5(0x16f)](a5_0x5475d8)[_0x23ddf5(0x1c3)](_0x23ddf5(0x1bc));});a5_0x5475d8();function a5_0x180e(){const _0x54ef62=['30YZqLkZ','eventHistory','events.lastEvent','.forecast.current.temperature','toLowerCase','temperature','(((.+)+)+)+$','contact','map','accuweather','switch','isPresent','motion','search','thermostat','SIMULATE_SIGNAL','isProVersion','lastTrackerEventTime','1254565BybjDm','.LEVEL','\x20from\x20','präsenz','occupancy','push','value','.1.TEMPERATURE','setStateAsync','name','1221280HdQblO','some','error','.1.VALVE_STATE','debug','Valve','exports','valveMapping','.NextHours.Location_1.Day_1.current.temp_value','logDuplicates','bewegung','handle','presence','licht','window','constructor','391088OmMfbT','215117BgAmrD','string','log','126Pxytyq','schloss','config','isExit','light','useWeather','loc','.Current.Temperature','system.isPresent','outdoorSensorId','Temperature','griff','getHours','includes','shift','LTM.trainingData.thermodynamics','message','rawEventLog','splice','type','tür','sensorLastValues','163875JaCAag','location','.1.ACTUAL_TEMPERATURE','number','[RECORDER]\x20Error:\x20','toString','normal','kontakt','[RECORDER]\x20Ignored\x20implausible\x20temperature:\x20','693168NTEcZA','isGracePeriodActive','exitTimer','210485FgHXhU','stringify','replace','now','exitGraceTimer','fenster','length','parse','dimmer','temperatur','heizung','schalter','.forecast.current.temp','STATE','getForeignStateAsync','weatherInstance','LEVEL','from','STATUS','lampe','getStateAsync','Unknown','weatherunderground','sendToPythonWrapper','currentSystemMode','val','daswetter','level','round','ANALYZE_SEQUENCE','toISOString','.1.LEVEL'];a5_0x180e=function(){return _0x54ef62;};return a5_0x180e();}'use strict';const HISTORY_MAX_SIZE=0x32,RAW_LOG_MAX_SIZE=0x9c4,THERMO_LOG_SIZE=0x3e8,SEQUENCE_TIMEOUT_MS=0x5*0x3c*0x3e8,MAX_TRAINING_SET_SIZE=0x1f4,EXIT_TIMER_MINUTES=0xf,EXIT_GRACE_PERIOD_SECONDS=0x1e;let activeSequence=[],sequenceTimer=null;async function getOutsideTemperatureNumeric(_0x29f740){const _0x606a7c=a5_0x2640;if(_0x29f740['config'][_0x606a7c(0x17d)])try{const _0x49ac6b=await _0x29f740[_0x606a7c(0x1a4)](_0x29f740['config'][_0x606a7c(0x17d)]);if(_0x49ac6b&&_0x49ac6b[_0x606a7c(0x1af)]!==undefined&&_0x49ac6b['val']!==null)return parseFloat(_0x49ac6b[_0x606a7c(0x1af)]);}catch(_0xdd06be){}const _0x4d8774=_0x29f740['config'][_0x606a7c(0x1a5)];if(!_0x29f740['config'][_0x606a7c(0x179)]||!_0x4d8774)return null;try{let _0x2a1877='';if(_0x4d8774[_0x606a7c(0x181)](_0x606a7c(0x1bf)))_0x2a1877=_0x4d8774+_0x606a7c(0x17b);else{if(_0x4d8774[_0x606a7c(0x181)](_0x606a7c(0x1b0)))_0x2a1877=_0x4d8774+_0x606a7c(0x168);else{if(_0x4d8774['includes']('openweathermap'))_0x2a1877=_0x4d8774+_0x606a7c(0x1b9);else{if(_0x4d8774['includes'](_0x606a7c(0x1ac)))_0x2a1877=_0x4d8774+_0x606a7c(0x1a2);}}}if(_0x2a1877){const _0x5d01bf=await _0x29f740[_0x606a7c(0x1a4)](_0x2a1877);if(_0x5d01bf&&_0x5d01bf['val']!==undefined&&_0x5d01bf[_0x606a7c(0x1af)]!==null)return parseFloat(_0x5d01bf[_0x606a7c(0x1af)]);}}catch(_0x1c967f){}return null;}async function recordThermodynamics(_0x25b9a5,_0xd1de7f,_0x4f3e78,_0x3c4e59){const _0x703ce6=a5_0x2640,_0x475642=await getOutsideTemperatureNumeric(_0x25b9a5);if(_0x475642===null)return;let _0x677f38=0x0,_0x364a21=![];if(_0x25b9a5['config'][_0x703ce6(0x167)])try{let _0x4f6f28=_0x25b9a5[_0x703ce6(0x176)][_0x703ce6(0x167)];if(typeof _0x4f6f28===_0x703ce6(0x172))_0x4f6f28=JSON['parse'](_0x4f6f28);if(_0x4f6f28[_0xd1de7f]){const _0x14c62f=_0x4f6f28[_0xd1de7f],_0x457e0e=await _0x25b9a5[_0x703ce6(0x1a4)](_0x14c62f);if(_0x457e0e&&_0x457e0e[_0x703ce6(0x1af)]!==null&&_0x457e0e[_0x703ce6(0x1af)]!==undefined){let _0x5f55cf=Number(_0x457e0e[_0x703ce6(0x1af)]);if(_0x5f55cf<=1.05&&!_0x14c62f[_0x703ce6(0x181)](_0x703ce6(0x1a8))&&!_0x14c62f[_0x703ce6(0x181)](_0x703ce6(0x1a3)))_0x5f55cf=_0x5f55cf*0x64;_0x677f38=Math[_0x703ce6(0x1b2)](_0x5f55cf),_0x364a21=!![];}}}catch(_0x26bba8){}if(!_0x364a21){const _0x3177c4=[{'from':_0x703ce6(0x18c),'to':_0x703ce6(0x1b5)},{'from':_0x703ce6(0x18c),'to':_0x703ce6(0x163)},{'from':_0x703ce6(0x15d),'to':'.4.VALVE_STATE'},{'from':'.ACTUAL_TEMPERATURE','to':_0x703ce6(0x1c9)},{'from':_0x703ce6(0x1bb),'to':_0x703ce6(0x1b1)},{'from':_0x703ce6(0x17e),'to':_0x703ce6(0x165)}];for(const _0x11e955 of _0x3177c4){if(_0xd1de7f[_0x703ce6(0x181)](_0x11e955[_0x703ce6(0x1a7)])){const _0x379e91=_0xd1de7f[_0x703ce6(0x198)](_0x11e955[_0x703ce6(0x1a7)],_0x11e955['to']);try{const _0x18c020=await _0x25b9a5[_0x703ce6(0x1a4)](_0x379e91);if(_0x18c020&&_0x18c020[_0x703ce6(0x1af)]!==null&&_0x18c020['val']!==undefined){let _0x166453=Number(_0x18c020['val']);if(typeof _0x166453==='number'){if(_0x166453<=1.05&&_0x11e955['to'][_0x703ce6(0x181)](_0x703ce6(0x1a6)))_0x166453=_0x166453*0x64;_0x677f38=Math[_0x703ce6(0x1b2)](_0x166453),_0x364a21=!![];break;}}}catch(_0x361152){}}}}const _0x3bdc97=await _0x25b9a5[_0x703ce6(0x1aa)](_0x703ce6(0x183));let _0x1ba1e0=[];if(_0x3bdc97&&_0x3bdc97[_0x703ce6(0x1af)])try{_0x1ba1e0=JSON[_0x703ce6(0x19d)](_0x3bdc97[_0x703ce6(0x1af)]);}catch(_0x346371){}_0x1ba1e0[_0x703ce6(0x15b)]({'ts':Date[_0x703ce6(0x199)](),'room':_0x3c4e59||_0x703ce6(0x1ab),'t_in':_0x4f3e78,'t_out':_0x475642,'valve':_0x677f38});if(_0x1ba1e0['length']>THERMO_LOG_SIZE)_0x1ba1e0[_0x703ce6(0x182)]();await _0x25b9a5[_0x703ce6(0x15e)](_0x703ce6(0x183),{'val':JSON[_0x703ce6(0x197)](_0x1ba1e0),'ack':!![]});}async function saveCompletedSequence(_0x28ebc5){const _0x4db641=a5_0x2640;try{const _0xca03de=await _0x28ebc5[_0x4db641(0x1aa)]('LTM.trainingData.sequences');let _0x3cfec9=[];if(_0xca03de&&_0xca03de[_0x4db641(0x1af)])try{_0x3cfec9=JSON[_0x4db641(0x19d)](_0xca03de[_0x4db641(0x1af)]);}catch(_0x485846){}const _0x2ddcb5=activeSequence[0x0]['ts'],_0x13f610=activeSequence[_0x4db641(0x1be)](_0x608a97=>({'loc':_0x608a97[_0x4db641(0x17a)],'t_delta':Math[_0x4db641(0x1b2)]((_0x608a97['ts']-_0x2ddcb5)/0x3e8)})),_0x41d552={'timestamp':new Date(_0x2ddcb5)[_0x4db641(0x1b4)](),'steps':_0x13f610,'duration':Math['round']((activeSequence[activeSequence['length']-0x1]['ts']-_0x2ddcb5)/0x3e8),'daytime':new Date(_0x2ddcb5)[_0x4db641(0x180)]()};_0x3cfec9[_0x4db641(0x15b)](_0x41d552);if(_0x3cfec9[_0x4db641(0x19c)]>MAX_TRAINING_SET_SIZE)_0x3cfec9[_0x4db641(0x182)]();await _0x28ebc5['setStateAsync']('LTM.trainingData.sequences',{'val':JSON[_0x4db641(0x197)](_0x3cfec9),'ack':!![]}),_0x28ebc5[_0x4db641(0x1c6)]&&_0x28ebc5['sendToPythonWrapper']&&_0x28ebc5[_0x4db641(0x1ad)](_0x4db641(0x1b3),{'sequence':_0x41d552});}catch(_0x43e0ca){_0x28ebc5['log'][_0x4db641(0x162)](_0x4db641(0x18e)+_0x43e0ca[_0x4db641(0x184)]);}}async function recordSequence(_0x226d25,_0x145695){const _0x45d510=a5_0x2640,_0xcd35ad=(_0x145695['type']||'')[_0x45d510(0x1ba)](),_0x24b6d1=[_0x45d510(0x1c2),_0x45d510(0x16a),_0x45d510(0x159),_0x45d510(0x16c),_0x45d510(0x15a),'door',_0x45d510(0x188),_0x45d510(0x16e),'fenster',_0x45d510(0x1bd),_0x45d510(0x191),'light',_0x45d510(0x16d),'switch',_0x45d510(0x1a1),'dimmer',_0x45d510(0x1a9)];if(!_0x24b6d1[_0x45d510(0x161)](_0x3ffcd9=>_0xcd35ad[_0x45d510(0x181)](_0x3ffcd9)))return;if(!_0x145695[_0x45d510(0x15c)])return;if(sequenceTimer)clearTimeout(sequenceTimer);activeSequence[_0x45d510(0x15b)]({'loc':_0x145695['location']||_0x45d510(0x1ab),'id':_0x145695['id'],'ts':Date[_0x45d510(0x199)]()}),sequenceTimer=setTimeout(async()=>{const _0x2e764d=_0x45d510;if(activeSequence[_0x2e764d(0x19c)]>0x1)await saveCompletedSequence(_0x226d25);activeSequence=[];},SEQUENCE_TIMEOUT_MS);}function startExitTimer(_0x28ea3f){const _0x4af866=a5_0x2640;abortExitTimer(_0x28ea3f),_0x28ea3f['isGracePeriodActive']=!![],_0x28ea3f[_0x4af866(0x19a)]=setTimeout(()=>{const _0xf72bfe=_0x4af866;_0x28ea3f[_0xf72bfe(0x194)]=![];},EXIT_GRACE_PERIOD_SECONDS*0x3e8),_0x28ea3f['exitTimer']=setTimeout(()=>{const _0x4fc6e7=_0x4af866;setPresence(_0x28ea3f,![]),_0x28ea3f[_0x4fc6e7(0x195)]=null;},EXIT_TIMER_MINUTES*0x3c*0x3e8);}function abortExitTimer(_0x5ab072){const _0x528ca3=a5_0x2640;if(_0x5ab072[_0x528ca3(0x195)])clearTimeout(_0x5ab072['exitTimer']);if(_0x5ab072[_0x528ca3(0x19a)])clearTimeout(_0x5ab072[_0x528ca3(0x19a)]);_0x5ab072[_0x528ca3(0x195)]=null,_0x5ab072[_0x528ca3(0x19a)]=null,_0x5ab072['isGracePeriodActive']=![];}async function setPresence(_0x476b61,_0x3fae23){const _0x15e2a2=a5_0x2640;if(_0x476b61[_0x15e2a2(0x1c1)]===_0x3fae23)return;_0x476b61[_0x15e2a2(0x1c1)]=_0x3fae23,await _0x476b61[_0x15e2a2(0x15e)](_0x15e2a2(0x17c),{'val':_0x3fae23,'ack':!![]});}async function processSensorEvent(_0x5c853a,_0x56b56b,_0x4f6520,_0x1f1f9b){const _0x26a314=a5_0x2640;if(!_0x1f1f9b)return null;const _0xc07a6=_0x4f6520[_0x26a314(0x1af)],_0x31e667=Date[_0x26a314(0x199)](),_0x553ac4=_0x5c853a['sensorLastValues'][_0x56b56b],_0x184c66=(_0x1f1f9b[_0x26a314(0x187)]||'')[_0x26a314(0x1ba)](),_0x4cffbf=_0x184c66['includes'](_0x26a314(0x1bb))||_0x184c66['includes'](_0x26a314(0x19f))||_0x184c66[_0x26a314(0x181)]('klima')||_0x184c66[_0x26a314(0x181)](_0x26a314(0x1a0))||_0x184c66['includes'](_0x26a314(0x1c4));if(_0x4cffbf&&typeof _0xc07a6==='number'){if(_0xc07a6>0x50||_0xc07a6<-0x32)return _0x5c853a[_0x26a314(0x173)][_0x26a314(0x164)](_0x26a314(0x192)+_0xc07a6+_0x26a314(0x1ca)+_0x56b56b),null;}_0x5c853a[_0x26a314(0x189)][_0x56b56b]=_0xc07a6;if(!_0x1f1f9b[_0x26a314(0x169)]&&_0x553ac4!=undefined&&_0x553ac4==_0xc07a6)return null;_0x5c853a[_0x26a314(0x1c6)]&&_0x4cffbf&&recordThermodynamics(_0x5c853a,_0x56b56b,_0xc07a6,_0x1f1f9b['location']);const _0x5b8a31={'timestamp':_0x31e667,'id':_0x56b56b,'name':_0x1f1f9b[_0x26a314(0x15f)],'type':_0x1f1f9b[_0x26a314(0x187)],'location':_0x1f1f9b[_0x26a314(0x18b)],'value':_0xc07a6};_0x5c853a[_0x26a314(0x1b7)]['unshift'](_0x5b8a31);if(_0x5c853a['eventHistory'][_0x26a314(0x19c)]>HISTORY_MAX_SIZE)_0x5c853a['eventHistory']['pop']();await _0x5c853a['setStateAsync'](_0x26a314(0x1b8),{'val':JSON[_0x26a314(0x197)](_0x5b8a31),'ack':!![]}),await _0x5c853a['setStateAsync']('events.history',{'val':JSON[_0x26a314(0x197)](_0x5c853a[_0x26a314(0x1b7)]),'ack':!![]});if(_0x5c853a[_0x26a314(0x1c6)]){_0x5c853a[_0x26a314(0x185)][_0x26a314(0x15b)](_0x5b8a31);if(_0x5c853a[_0x26a314(0x185)][_0x26a314(0x19c)]>RAW_LOG_MAX_SIZE)_0x5c853a['rawEventLog'][_0x26a314(0x186)](0x0,_0x5c853a['rawEventLog']['length']-RAW_LOG_MAX_SIZE);await _0x5c853a['setStateAsync']('LTM.rawEventLog',{'val':JSON[_0x26a314(0x197)](_0x5c853a[_0x26a314(0x185)]),'ack':!![]}),recordSequence(_0x5c853a,_0x5b8a31);}if(_0x1f1f9b[_0x26a314(0x177)]&&_0xc07a6===!![]){if(_0x5c853a[_0x26a314(0x1c1)]&&!_0x5c853a[_0x26a314(0x194)])startExitTimer(_0x5c853a);else{if(!_0x5c853a[_0x26a314(0x1c1)])setPresence(_0x5c853a,!![]);}}else{if(_0x1f1f9b['type']==='motion'&&_0xc07a6===!![]){if(_0x5c853a['exitTimer'])abortExitTimer(_0x5c853a);if(!_0x5c853a[_0x26a314(0x1c1)]&&_0x5c853a[_0x26a314(0x1ae)]===_0x26a314(0x190))setPresence(_0x5c853a,!![]);}}if(_0x5c853a[_0x26a314(0x1c6)]&&_0x5c853a[_0x26a314(0x1ad)]){_0x1f1f9b[_0x26a314(0x187)]===_0x26a314(0x1c2)&&_0xc07a6===!![]&&_0x1f1f9b[_0x26a314(0x18b)]&&_0x5c853a[_0x26a314(0x1ad)](_0x26a314(0x1c5),{'room':_0x1f1f9b[_0x26a314(0x18b)]});const _0x3d53fe=['door',_0x26a314(0x188),'window',_0x26a314(0x19b),_0x26a314(0x17f),_0x26a314(0x16b),'lock',_0x26a314(0x175)][_0x26a314(0x161)](_0x108d31=>_0x184c66[_0x26a314(0x181)](_0x108d31)),_0x51eb0b=[_0x26a314(0x178),_0x26a314(0x16d),_0x26a314(0x1c0),_0x26a314(0x1a1),_0x26a314(0x19e),_0x26a314(0x1a9)][_0x26a314(0x161)](_0xc2e27f=>_0x184c66['includes'](_0xc2e27f)),_0x15cb0d=[_0x26a314(0x1c2),_0x26a314(0x16a),_0x26a314(0x159),_0x26a314(0x16c),_0x26a314(0x15a)]['some'](_0x56881c=>_0x184c66[_0x26a314(0x181)](_0x56881c));if(_0x1f1f9b[_0x26a314(0x18b)]&&(_0x3d53fe||_0x51eb0b||_0x15cb0d)){const _0x3d9315=_0xc07a6===!![]||typeof _0xc07a6===_0x26a314(0x18d)&&_0xc07a6>0x0,_0x5a2443=_0x3d53fe&&!_0x3d9315&&_0x553ac4!==undefined&&_0x553ac4!=_0xc07a6;if(_0x3d9315||_0x5a2443){const _0x3b36ef=_0x5c853a['lastTrackerEventTime']||_0x31e667,_0x18a34d=(_0x31e667-_0x3b36ef)/0x3e8;_0x5c853a[_0x26a314(0x1c7)]=_0x31e667,_0x5c853a['sendToPythonWrapper']('TRACK_EVENT',{'room':_0x1f1f9b[_0x26a314(0x18b)],'dt':_0x18a34d});}}}return _0x5b8a31;}module[a5_0x1580fe(0x166)]={'processSensorEvent':processSensorEvent,'getOutsideTemperatureNumeric':getOutsideTemperatureNumeric,'setPresence':setPresence,'abortExitTimer':abortExitTimer,'startExitTimer':startExitTimer};