const a5_0x1332e5=a5_0x4bbf;(function(_0x58c3be,_0x237492){const _0x39d15c=a5_0x4bbf,_0xb55442=_0x58c3be();while(!![]){try{const _0x28d150=parseInt(_0x39d15c(0x20c))/0x1*(parseInt(_0x39d15c(0x1ff))/0x2)+parseInt(_0x39d15c(0x207))/0x3+parseInt(_0x39d15c(0x20e))/0x4+-parseInt(_0x39d15c(0x1bd))/0x5*(-parseInt(_0x39d15c(0x1d5))/0x6)+-parseInt(_0x39d15c(0x1ee))/0x7*(-parseInt(_0x39d15c(0x1fa))/0x8)+parseInt(_0x39d15c(0x21b))/0x9+-parseInt(_0x39d15c(0x1c6))/0xa*(parseInt(_0x39d15c(0x21f))/0xb);if(_0x28d150===_0x237492)break;else _0xb55442['push'](_0xb55442['shift']());}catch(_0x5bccef){_0xb55442['push'](_0xb55442['shift']());}}}(a5_0x5941,0xe4ee1));function a5_0x5941(){const _0x3b2855=['openweathermap','map','326335DqXOtr','from','5030020CSQpIj','some','isGracePeriodActive','message','splice','search','getStateAsync','.1.ACTUAL_TEMPERATURE','temperature','val','bewegung','light','rawEventLog','9589221CyATfX','setStateAsync','stringify','lastTrackerEventTime','275jlWJqf','LEVEL','loc','klima','toLowerCase','events.lastEvent','unshift','outdoorSensorId','temperatur','10TSudsP','config','lampe','SIMULATE_SIGNAL','exitTimer','getForeignStateAsync','daswetter','STATE','schalter','2592710epvaAc','lock','LTM.trainingData.thermodynamics','parse','contact','.forecast.current.temp','STATUS','heizung','.ACTUAL_TEMPERATURE','.forecast.current.temperature','exports','.NextHours.Location_1.Day_1.current.temp_value','.4.VALVE_STATE','.LEVEL','logDuplicates','5477388YJRkTA','presence','.1.TEMPERATURE','log','window','isPresent','type','length','isProVersion','pop','normal','includes','currentSystemMode','constructor','dimmer','kontakt','tür','useWeather','.Current.Temperature','shift','push','sensorLastValues','events.history','weatherInstance','location','45661OSXsiG','replace','accuweather','toString','motion','round','number','sendToPythonWrapper','valveMapping','weatherunderground','[RECORDER]\x20Error:\x20','apply','2176LkJhhd','eventHistory','fenster','exitGraceTimer','value','4GCOqen','door','LTM.trainingData.sequences','TRACK_EVENT','Temperature','präsenz','now','licht','2531328QhDHdq','occupancy','ANALYZE_SEQUENCE'];a5_0x5941=function(){return _0x3b2855;};return a5_0x5941();}const a5_0x36d265=(function(){let _0x5e9afd=!![];return function(_0x8408d9,_0x4dde1e){const _0x382fde=_0x5e9afd?function(){const _0x6f7f05=a5_0x4bbf;if(_0x4dde1e){const _0x170a8f=_0x4dde1e[_0x6f7f05(0x1f9)](_0x8408d9,arguments);return _0x4dde1e=null,_0x170a8f;}}:function(){};return _0x5e9afd=![],_0x382fde;};}()),a5_0x2ab63b=a5_0x36d265(this,function(){const _0x11b91c=a5_0x4bbf;return a5_0x2ab63b[_0x11b91c(0x1f1)]()[_0x11b91c(0x213)]('(((.+)+)+)+$')[_0x11b91c(0x1f1)]()[_0x11b91c(0x1e2)](a5_0x2ab63b)[_0x11b91c(0x213)]('(((.+)+)+)+$');});a5_0x2ab63b();'use strict';const HISTORY_MAX_SIZE=0x32,RAW_LOG_MAX_SIZE=0x9c4,THERMO_LOG_SIZE=0x3e8,SEQUENCE_TIMEOUT_MS=0x5*0x3c*0x3e8,MAX_TRAINING_SET_SIZE=0x1f4,EXIT_TIMER_MINUTES=0xf,EXIT_GRACE_PERIOD_SECONDS=0x1e;let activeSequence=[],sequenceTimer=null;function a5_0x4bbf(_0x456840,_0x169bfa){const _0x3db5df=a5_0x5941();return a5_0x4bbf=function(_0x2ab63b,_0x36d265){_0x2ab63b=_0x2ab63b-0x1b6;let _0x59410f=_0x3db5df[_0x2ab63b];return _0x59410f;},a5_0x4bbf(_0x456840,_0x169bfa);}async function getOutsideTemperatureNumeric(_0x662b01){const _0xfaee7e=a5_0x4bbf;if(_0x662b01[_0xfaee7e(0x1be)][_0xfaee7e(0x1bb)])try{const _0x322bd4=await _0x662b01['getForeignStateAsync'](_0x662b01[_0xfaee7e(0x1be)][_0xfaee7e(0x1bb)]);if(_0x322bd4&&_0x322bd4[_0xfaee7e(0x217)]!==undefined&&_0x322bd4[_0xfaee7e(0x217)]!==null)return parseFloat(_0x322bd4[_0xfaee7e(0x217)]);}catch(_0x2108f6){}const _0x54e2d1=_0x662b01[_0xfaee7e(0x1be)][_0xfaee7e(0x1ec)];if(!_0x662b01['config'][_0xfaee7e(0x1e6)]||!_0x54e2d1)return null;try{let _0x5cb26f='';if(_0x54e2d1[_0xfaee7e(0x1e0)](_0xfaee7e(0x1f0)))_0x5cb26f=_0x54e2d1+_0xfaee7e(0x1e7);else{if(_0x54e2d1['includes'](_0xfaee7e(0x1c3)))_0x5cb26f=_0x54e2d1+_0xfaee7e(0x1d1);else{if(_0x54e2d1[_0xfaee7e(0x1e0)](_0xfaee7e(0x20a)))_0x5cb26f=_0x54e2d1+_0xfaee7e(0x1cf);else{if(_0x54e2d1[_0xfaee7e(0x1e0)](_0xfaee7e(0x1f7)))_0x5cb26f=_0x54e2d1+_0xfaee7e(0x1cb);}}}if(_0x5cb26f){const _0x42af49=await _0x662b01[_0xfaee7e(0x1c2)](_0x5cb26f);if(_0x42af49&&_0x42af49['val']!==undefined&&_0x42af49['val']!==null)return parseFloat(_0x42af49[_0xfaee7e(0x217)]);}}catch(_0x20ba7c){}return null;}async function recordThermodynamics(_0x3c7fe3,_0x56caaa,_0x145b85,_0x1953d5){const _0x389df0=a5_0x4bbf,_0x391312=await getOutsideTemperatureNumeric(_0x3c7fe3);if(_0x391312===null)return;let _0x3faef5=0x0,_0x2051e2=![];if(_0x3c7fe3[_0x389df0(0x1be)]['valveMapping'])try{let _0x1605f5=_0x3c7fe3[_0x389df0(0x1be)][_0x389df0(0x1f6)];if(typeof _0x1605f5==='string')_0x1605f5=JSON[_0x389df0(0x1c9)](_0x1605f5);if(_0x1605f5[_0x56caaa]){const _0x1269f9=_0x1605f5[_0x56caaa],_0x3ca123=await _0x3c7fe3[_0x389df0(0x1c2)](_0x1269f9);if(_0x3ca123&&_0x3ca123[_0x389df0(0x217)]!==null&&_0x3ca123[_0x389df0(0x217)]!==undefined){let _0x1d2587=Number(_0x3ca123[_0x389df0(0x217)]);if(_0x1d2587<=1.05&&!_0x1269f9['includes'](_0x389df0(0x1cc))&&!_0x1269f9[_0x389df0(0x1e0)](_0x389df0(0x1c4)))_0x1d2587=_0x1d2587*0x64;_0x3faef5=Math[_0x389df0(0x1f3)](_0x1d2587),_0x2051e2=!![];}}}catch(_0x40dcb4){}if(!_0x2051e2){const _0x254bc1=[{'from':'.1.ACTUAL_TEMPERATURE','to':'.1.LEVEL'},{'from':_0x389df0(0x215),'to':'.1.VALVE_STATE'},{'from':_0x389df0(0x1d7),'to':_0x389df0(0x1d2)},{'from':_0x389df0(0x1ce),'to':_0x389df0(0x1d3)},{'from':_0x389df0(0x216),'to':'level'},{'from':_0x389df0(0x203),'to':'Valve'}];for(const _0x32c748 of _0x254bc1){if(_0x56caaa[_0x389df0(0x1e0)](_0x32c748[_0x389df0(0x20d)])){const _0x50538a=_0x56caaa[_0x389df0(0x1ef)](_0x32c748[_0x389df0(0x20d)],_0x32c748['to']);try{const _0x4281ba=await _0x3c7fe3[_0x389df0(0x1c2)](_0x50538a);if(_0x4281ba&&_0x4281ba['val']!==null&&_0x4281ba['val']!==undefined){let _0x4f0ec2=Number(_0x4281ba[_0x389df0(0x217)]);if(typeof _0x4f0ec2===_0x389df0(0x1f4)){if(_0x4f0ec2<=1.05&&_0x32c748['to'][_0x389df0(0x1e0)](_0x389df0(0x220)))_0x4f0ec2=_0x4f0ec2*0x64;_0x3faef5=Math[_0x389df0(0x1f3)](_0x4f0ec2),_0x2051e2=!![];break;}}}catch(_0x1b3d5a){}}}}const _0x3b8285=await _0x3c7fe3[_0x389df0(0x214)](_0x389df0(0x1c8));let _0x277e83=[];if(_0x3b8285&&_0x3b8285[_0x389df0(0x217)])try{_0x277e83=JSON['parse'](_0x3b8285[_0x389df0(0x217)]);}catch(_0x55311e){}_0x277e83[_0x389df0(0x1e9)]({'ts':Date[_0x389df0(0x205)](),'room':_0x1953d5||'Unknown','t_in':_0x145b85,'t_out':_0x391312,'valve':_0x3faef5});if(_0x277e83['length']>THERMO_LOG_SIZE)_0x277e83[_0x389df0(0x1e8)]();await _0x3c7fe3['setStateAsync'](_0x389df0(0x1c8),{'val':JSON[_0x389df0(0x21d)](_0x277e83),'ack':!![]});}async function saveCompletedSequence(_0x16d74a){const _0x6ed6c=a5_0x4bbf;try{const _0x384378=await _0x16d74a[_0x6ed6c(0x214)](_0x6ed6c(0x201));let _0x549088=[];if(_0x384378&&_0x384378[_0x6ed6c(0x217)])try{_0x549088=JSON[_0x6ed6c(0x1c9)](_0x384378['val']);}catch(_0x139cfc){}const _0x3076ce=activeSequence[0x0]['ts'],_0x1d3a93=activeSequence[_0x6ed6c(0x20b)](_0x5e7712=>({'loc':_0x5e7712[_0x6ed6c(0x1b6)],'t_delta':Math['round']((_0x5e7712['ts']-_0x3076ce)/0x3e8)})),_0x1e9483={'timestamp':new Date(_0x3076ce)['toISOString'](),'steps':_0x1d3a93,'duration':Math[_0x6ed6c(0x1f3)]((activeSequence[activeSequence[_0x6ed6c(0x1dc)]-0x1]['ts']-_0x3076ce)/0x3e8),'daytime':new Date(_0x3076ce)['getHours']()};_0x549088['push'](_0x1e9483);if(_0x549088['length']>MAX_TRAINING_SET_SIZE)_0x549088[_0x6ed6c(0x1e8)]();await _0x16d74a['setStateAsync'](_0x6ed6c(0x201),{'val':JSON[_0x6ed6c(0x21d)](_0x549088),'ack':!![]}),_0x16d74a[_0x6ed6c(0x1dd)]&&_0x16d74a[_0x6ed6c(0x1f5)]&&_0x16d74a[_0x6ed6c(0x1f5)](_0x6ed6c(0x209),{'sequence':_0x1e9483});}catch(_0x2c7fc9){_0x16d74a[_0x6ed6c(0x1d8)]['error'](_0x6ed6c(0x1f8)+_0x2c7fc9[_0x6ed6c(0x211)]);}}async function recordSequence(_0x3a1041,_0x3597f4){const _0x519595=a5_0x4bbf,_0x43f85a=(_0x3597f4[_0x519595(0x1db)]||'')[_0x519595(0x1b8)](),_0x781c77=[_0x519595(0x1f2),_0x519595(0x218),_0x519595(0x204),_0x519595(0x1d6),_0x519595(0x208),_0x519595(0x200),_0x519595(0x1e5),_0x519595(0x1d9),_0x519595(0x1fc),_0x519595(0x1ca),_0x519595(0x1e4),_0x519595(0x219),_0x519595(0x206),'switch',_0x519595(0x1c5),_0x519595(0x1e3),_0x519595(0x1bf)];if(!_0x781c77[_0x519595(0x20f)](_0x28ce86=>_0x43f85a[_0x519595(0x1e0)](_0x28ce86)))return;if(!_0x3597f4[_0x519595(0x1fe)])return;if(sequenceTimer)clearTimeout(sequenceTimer);activeSequence[_0x519595(0x1e9)]({'loc':_0x3597f4[_0x519595(0x1ed)]||'Unknown','id':_0x3597f4['id'],'ts':Date[_0x519595(0x205)]()}),sequenceTimer=setTimeout(async()=>{const _0x18e2c1=_0x519595;if(activeSequence[_0x18e2c1(0x1dc)]>0x1)await saveCompletedSequence(_0x3a1041);activeSequence=[];},SEQUENCE_TIMEOUT_MS);}function startExitTimer(_0x52b54e){const _0x58f21d=a5_0x4bbf;abortExitTimer(_0x52b54e),_0x52b54e['isGracePeriodActive']=!![],_0x52b54e['exitGraceTimer']=setTimeout(()=>{const _0x12a277=a5_0x4bbf;_0x52b54e[_0x12a277(0x210)]=![];},EXIT_GRACE_PERIOD_SECONDS*0x3e8),_0x52b54e[_0x58f21d(0x1c1)]=setTimeout(()=>{const _0x6db263=_0x58f21d;setPresence(_0x52b54e,![]),_0x52b54e[_0x6db263(0x1c1)]=null;},EXIT_TIMER_MINUTES*0x3c*0x3e8);}function abortExitTimer(_0x5cbca6){const _0x233399=a5_0x4bbf;if(_0x5cbca6[_0x233399(0x1c1)])clearTimeout(_0x5cbca6[_0x233399(0x1c1)]);if(_0x5cbca6[_0x233399(0x1fd)])clearTimeout(_0x5cbca6[_0x233399(0x1fd)]);_0x5cbca6['exitTimer']=null,_0x5cbca6[_0x233399(0x1fd)]=null,_0x5cbca6[_0x233399(0x210)]=![];}async function setPresence(_0x337053,_0x209a24){const _0x572742=a5_0x4bbf;if(_0x337053[_0x572742(0x1da)]===_0x209a24)return;_0x337053[_0x572742(0x1da)]=_0x209a24,await _0x337053[_0x572742(0x21c)]('system.isPresent',{'val':_0x209a24,'ack':!![]});}async function processSensorEvent(_0x19d2c0,_0xf03689,_0x5122fe,_0x4c23ea){const _0x37c825=a5_0x4bbf;if(!_0x4c23ea)return null;const _0x2eba00=_0x5122fe[_0x37c825(0x217)],_0x238281=Date[_0x37c825(0x205)](),_0x34bcf8=_0x19d2c0[_0x37c825(0x1ea)][_0xf03689];_0x19d2c0[_0x37c825(0x1ea)][_0xf03689]=_0x2eba00;if(!_0x4c23ea[_0x37c825(0x1d4)]&&_0x34bcf8!=undefined&&_0x34bcf8==_0x2eba00)return null;const _0x1f61b3=(_0x4c23ea[_0x37c825(0x1db)]||'')[_0x37c825(0x1b8)](),_0x47bd9f=_0x1f61b3[_0x37c825(0x1e0)](_0x37c825(0x216))||_0x1f61b3[_0x37c825(0x1e0)](_0x37c825(0x1bc))||_0x1f61b3[_0x37c825(0x1e0)](_0x37c825(0x1b7))||_0x1f61b3[_0x37c825(0x1e0)](_0x37c825(0x1cd))||_0x1f61b3[_0x37c825(0x1e0)]('thermostat');_0x19d2c0[_0x37c825(0x1dd)]&&_0x47bd9f&&recordThermodynamics(_0x19d2c0,_0xf03689,_0x2eba00,_0x4c23ea['location']);const _0xc5b29a={'timestamp':_0x238281,'id':_0xf03689,'name':_0x4c23ea['name'],'type':_0x4c23ea[_0x37c825(0x1db)],'location':_0x4c23ea['location'],'value':_0x2eba00};_0x19d2c0['eventHistory'][_0x37c825(0x1ba)](_0xc5b29a);if(_0x19d2c0[_0x37c825(0x1fb)][_0x37c825(0x1dc)]>HISTORY_MAX_SIZE)_0x19d2c0[_0x37c825(0x1fb)][_0x37c825(0x1de)]();await _0x19d2c0[_0x37c825(0x21c)](_0x37c825(0x1b9),{'val':JSON[_0x37c825(0x21d)](_0xc5b29a),'ack':!![]}),await _0x19d2c0[_0x37c825(0x21c)](_0x37c825(0x1eb),{'val':JSON[_0x37c825(0x21d)](_0x19d2c0[_0x37c825(0x1fb)]),'ack':!![]});if(_0x19d2c0[_0x37c825(0x1dd)]){_0x19d2c0['rawEventLog']['push'](_0xc5b29a);if(_0x19d2c0[_0x37c825(0x21a)][_0x37c825(0x1dc)]>RAW_LOG_MAX_SIZE)_0x19d2c0['rawEventLog'][_0x37c825(0x212)](0x0,_0x19d2c0[_0x37c825(0x21a)][_0x37c825(0x1dc)]-RAW_LOG_MAX_SIZE);await _0x19d2c0[_0x37c825(0x21c)]('LTM.rawEventLog',{'val':JSON['stringify'](_0x19d2c0[_0x37c825(0x21a)]),'ack':!![]}),recordSequence(_0x19d2c0,_0xc5b29a);}if(_0x4c23ea['isExit']&&_0x2eba00===!![]){if(_0x19d2c0[_0x37c825(0x1da)]&&!_0x19d2c0[_0x37c825(0x210)])startExitTimer(_0x19d2c0);else{if(!_0x19d2c0[_0x37c825(0x1da)])setPresence(_0x19d2c0,!![]);}}else{if(_0x4c23ea[_0x37c825(0x1db)]===_0x37c825(0x1f2)&&_0x2eba00===!![]){if(_0x19d2c0['exitTimer'])abortExitTimer(_0x19d2c0);if(!_0x19d2c0[_0x37c825(0x1da)]&&_0x19d2c0[_0x37c825(0x1e1)]===_0x37c825(0x1df))setPresence(_0x19d2c0,!![]);}}if(_0x19d2c0['isProVersion']&&_0x19d2c0['sendToPythonWrapper']){_0x4c23ea[_0x37c825(0x1db)]==='motion'&&_0x2eba00===!![]&&_0x4c23ea[_0x37c825(0x1ed)]&&_0x19d2c0[_0x37c825(0x1f5)](_0x37c825(0x1c0),{'room':_0x4c23ea['location']});const _0x21ee79=[_0x37c825(0x1f2),'bewegung',_0x37c825(0x204),_0x37c825(0x1d6),'occupancy','door',_0x37c825(0x1e5),_0x37c825(0x1d9),'fenster','contact',_0x37c825(0x1e4),_0x37c825(0x219),_0x37c825(0x206),'switch','schalter',_0x37c825(0x1e3),_0x37c825(0x1bf),_0x37c825(0x1c7),'schloss']['some'](_0x1d0d12=>_0x1f61b3['includes'](_0x1d0d12));if(_0x4c23ea[_0x37c825(0x1ed)]&&_0x21ee79){const _0x279038=_0x2eba00===!![]||typeof _0x2eba00===_0x37c825(0x1f4)&&_0x2eba00>0x0,_0x4a8196=!_0x279038&&_0x34bcf8!==undefined&&_0x34bcf8!=_0x2eba00;if(_0x279038||_0x4a8196){const _0x700ff2=_0x19d2c0[_0x37c825(0x21e)]||_0x238281,_0xaf9249=(_0x238281-_0x700ff2)/0x3e8;_0x19d2c0[_0x37c825(0x21e)]=_0x238281,_0x19d2c0[_0x37c825(0x1f5)](_0x37c825(0x202),{'room':_0x4c23ea[_0x37c825(0x1ed)],'dt':_0xaf9249});}}}return _0xc5b29a;}module[a5_0x1332e5(0x1d0)]={'processSensorEvent':processSensorEvent,'getOutsideTemperatureNumeric':getOutsideTemperatureNumeric,'setPresence':setPresence,'abortExitTimer':abortExitTimer,'startExitTimer':startExitTimer};