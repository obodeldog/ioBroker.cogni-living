const a5_0x3da0a3=a5_0x1fa4;(function(_0x565e52,_0x4a0a72){const _0x5d07a4=a5_0x1fa4,_0x2c39e5=_0x565e52();while(!![]){try{const _0x70446a=parseInt(_0x5d07a4(0x234))/0x1+-parseInt(_0x5d07a4(0x214))/0x2+parseInt(_0x5d07a4(0x209))/0x3*(-parseInt(_0x5d07a4(0x248))/0x4)+-parseInt(_0x5d07a4(0x24a))/0x5*(parseInt(_0x5d07a4(0x226))/0x6)+parseInt(_0x5d07a4(0x21c))/0x7+-parseInt(_0x5d07a4(0x245))/0x8*(-parseInt(_0x5d07a4(0x1f6))/0x9)+parseInt(_0x5d07a4(0x1f3))/0xa;if(_0x70446a===_0x4a0a72)break;else _0x2c39e5['push'](_0x2c39e5['shift']());}catch(_0x11ccb1){_0x2c39e5['push'](_0x2c39e5['shift']());}}}(a5_0x4888,0x344f7));const a5_0x2631b5=(function(){let _0x5881cf=!![];return function(_0x19e21c,_0x201e8e){const _0x4773db=_0x5881cf?function(){const _0x15dfeb=a5_0x1fa4;if(_0x201e8e){const _0x38aee4=_0x201e8e[_0x15dfeb(0x229)](_0x19e21c,arguments);return _0x201e8e=null,_0x38aee4;}}:function(){};return _0x5881cf=![],_0x4773db;};}()),a5_0xe977fd=a5_0x2631b5(this,function(){const _0x776a10=a5_0x1fa4;return a5_0xe977fd['toString']()['search'](_0x776a10(0x1ec))[_0x776a10(0x218)]()[_0x776a10(0x23a)](a5_0xe977fd)[_0x776a10(0x224)]('(((.+)+)+)+$');});a5_0xe977fd();'use strict';function a5_0x1fa4(_0x3cb07a,_0x576760){const _0x2e03b3=a5_0x4888();return a5_0x1fa4=function(_0xe977fd,_0x2631b5){_0xe977fd=_0xe977fd-0x1eb;let _0x4888f9=_0x2e03b3[_0xe977fd];return _0x4888f9;},a5_0x1fa4(_0x3cb07a,_0x576760);}const HISTORY_MAX_SIZE=0x32,RAW_LOG_MAX_SIZE=0x9c4,THERMO_LOG_SIZE=0x3e8,SEQUENCE_TIMEOUT_MS=0x5*0x3c*0x3e8,MAX_TRAINING_SET_SIZE=0x1f4,EXIT_TIMER_MINUTES=0xf,EXIT_GRACE_PERIOD_SECONDS=0x1e;let activeSequence=[],sequenceTimer=null;async function getOutsideTemperatureNumeric(_0x43ba48){const _0x282a31=a5_0x1fa4;if(_0x43ba48[_0x282a31(0x253)][_0x282a31(0x252)])try{const _0x2ea03f=await _0x43ba48['getForeignStateAsync'](_0x43ba48[_0x282a31(0x253)]['outdoorSensorId']);if(_0x2ea03f&&_0x2ea03f[_0x282a31(0x202)]!==undefined&&_0x2ea03f[_0x282a31(0x202)]!==null)return parseFloat(_0x2ea03f[_0x282a31(0x202)]);}catch(_0x845c99){}const _0x3602a8=_0x43ba48[_0x282a31(0x253)][_0x282a31(0x23b)];if(!_0x43ba48['config'][_0x282a31(0x247)]||!_0x3602a8)return null;try{let _0x40776d='';if(_0x3602a8['includes'](_0x282a31(0x230)))_0x40776d=_0x3602a8+_0x282a31(0x237);else{if(_0x3602a8['includes']('daswetter'))_0x40776d=_0x3602a8+_0x282a31(0x225);else{if(_0x3602a8[_0x282a31(0x254)](_0x282a31(0x1fc)))_0x40776d=_0x3602a8+'.forecast.current.temperature';else{if(_0x3602a8[_0x282a31(0x254)]('weatherunderground'))_0x40776d=_0x3602a8+'.forecast.current.temp';}}}if(_0x40776d){const _0x1303a5=await _0x43ba48[_0x282a31(0x212)](_0x40776d);if(_0x1303a5&&_0x1303a5[_0x282a31(0x202)]!==undefined&&_0x1303a5['val']!==null)return parseFloat(_0x1303a5[_0x282a31(0x202)]);}}catch(_0x4436ca){}return null;}async function recordThermodynamics(_0x5afe12,_0x11f1f9,_0x177a3d,_0x17b4e0){const _0x207e9a=a5_0x1fa4,_0x54211f=await getOutsideTemperatureNumeric(_0x5afe12);if(_0x54211f===null)return;let _0x20e16e=0x0,_0x58e492=![];if(_0x5afe12[_0x207e9a(0x253)][_0x207e9a(0x1fe)])try{let _0x27ad3f=_0x5afe12[_0x207e9a(0x253)]['valveMapping'];if(typeof _0x27ad3f===_0x207e9a(0x20f))_0x27ad3f=JSON[_0x207e9a(0x255)](_0x27ad3f);if(_0x27ad3f[_0x11f1f9]){const _0x18d78b=_0x27ad3f[_0x11f1f9],_0x5c4dfe=await _0x5afe12[_0x207e9a(0x212)](_0x18d78b);if(_0x5c4dfe&&_0x5c4dfe[_0x207e9a(0x202)]!==null&&_0x5c4dfe[_0x207e9a(0x202)]!==undefined){let _0x125cb9=Number(_0x5c4dfe[_0x207e9a(0x202)]);if(_0x125cb9<=1.05&&!_0x18d78b['includes'](_0x207e9a(0x208))&&!_0x18d78b[_0x207e9a(0x254)]('STATE'))_0x125cb9=_0x125cb9*0x64;_0x20e16e=Math[_0x207e9a(0x1f7)](_0x125cb9),_0x58e492=!![];}}}catch(_0x15e2f8){}if(!_0x58e492){const _0x591bb6=[{'from':_0x207e9a(0x241),'to':_0x207e9a(0x213)},{'from':'.1.ACTUAL_TEMPERATURE','to':_0x207e9a(0x232)},{'from':_0x207e9a(0x217),'to':_0x207e9a(0x1f5)},{'from':_0x207e9a(0x1f1),'to':'.LEVEL'},{'from':_0x207e9a(0x206),'to':_0x207e9a(0x246)},{'from':_0x207e9a(0x240),'to':_0x207e9a(0x1ef)}];for(const _0x1cd2d1 of _0x591bb6){if(_0x11f1f9['includes'](_0x1cd2d1[_0x207e9a(0x24f)])){const _0x27b6bd=_0x11f1f9[_0x207e9a(0x219)](_0x1cd2d1[_0x207e9a(0x24f)],_0x1cd2d1['to']);try{const _0x212a87=await _0x5afe12[_0x207e9a(0x212)](_0x27b6bd);if(_0x212a87&&_0x212a87['val']!==null&&_0x212a87[_0x207e9a(0x202)]!==undefined){let _0x22cd90=Number(_0x212a87['val']);if(typeof _0x22cd90==='number'){if(_0x22cd90<=1.05&&_0x1cd2d1['to'][_0x207e9a(0x254)]('LEVEL'))_0x22cd90=_0x22cd90*0x64;_0x20e16e=Math['round'](_0x22cd90),_0x58e492=!![];break;}}}catch(_0x22c3af){}}}}const _0x527174=await _0x5afe12[_0x207e9a(0x23c)](_0x207e9a(0x1f8));let _0x1a2712=[];if(_0x527174&&_0x527174[_0x207e9a(0x202)])try{_0x1a2712=JSON['parse'](_0x527174[_0x207e9a(0x202)]);}catch(_0x416309){}_0x1a2712[_0x207e9a(0x1ee)]({'ts':Date[_0x207e9a(0x23d)](),'room':_0x17b4e0||_0x207e9a(0x1ed),'t_in':_0x177a3d,'t_out':_0x54211f,'valve':_0x20e16e});if(_0x1a2712[_0x207e9a(0x22d)]>THERMO_LOG_SIZE)_0x1a2712[_0x207e9a(0x211)]();await _0x5afe12['setStateAsync'](_0x207e9a(0x1f8),{'val':JSON[_0x207e9a(0x21e)](_0x1a2712),'ack':!![]});}async function saveCompletedSequence(_0x1be29e){const _0x3320c2=a5_0x1fa4;try{const _0x58daff=await _0x1be29e[_0x3320c2(0x23c)]('LTM.trainingData.sequences');let _0x190be8=[];if(_0x58daff&&_0x58daff[_0x3320c2(0x202)])try{_0x190be8=JSON[_0x3320c2(0x255)](_0x58daff[_0x3320c2(0x202)]);}catch(_0x3de202){}const _0x2c1ec3=activeSequence[0x0]['ts'],_0x3cdcb1=activeSequence[_0x3320c2(0x238)](_0x1c6293=>({'loc':_0x1c6293[_0x3320c2(0x216)],'t_delta':Math[_0x3320c2(0x1f7)]((_0x1c6293['ts']-_0x2c1ec3)/0x3e8)})),_0x4ee041={'timestamp':new Date(_0x2c1ec3)[_0x3320c2(0x236)](),'steps':_0x3cdcb1,'duration':Math['round']((activeSequence[activeSequence['length']-0x1]['ts']-_0x2c1ec3)/0x3e8),'daytime':new Date(_0x2c1ec3)[_0x3320c2(0x203)]()};_0x190be8[_0x3320c2(0x1ee)](_0x4ee041);if(_0x190be8[_0x3320c2(0x22d)]>MAX_TRAINING_SET_SIZE)_0x190be8[_0x3320c2(0x211)]();await _0x1be29e[_0x3320c2(0x239)](_0x3320c2(0x220),{'val':JSON[_0x3320c2(0x21e)](_0x190be8),'ack':!![]}),_0x1be29e['isProVersion']&&_0x1be29e[_0x3320c2(0x24c)]&&_0x1be29e[_0x3320c2(0x24c)](_0x3320c2(0x21a),{'sequence':_0x4ee041});}catch(_0x6b95ed){_0x1be29e[_0x3320c2(0x242)][_0x3320c2(0x257)]('[RECORDER]\x20Error:\x20'+_0x6b95ed[_0x3320c2(0x251)]);}}async function recordSequence(_0x60f328,_0x228c21){const _0x5cde2e=a5_0x1fa4,_0xd18381=(_0x228c21[_0x5cde2e(0x24b)]||'')[_0x5cde2e(0x1fd)](),_0x2a7e72=[_0x5cde2e(0x244),_0x5cde2e(0x249),_0x5cde2e(0x1f4),'presence',_0x5cde2e(0x24e),_0x5cde2e(0x200),_0x5cde2e(0x1f0),_0x5cde2e(0x22b),_0x5cde2e(0x201),'contact',_0x5cde2e(0x1fa),_0x5cde2e(0x258),'licht',_0x5cde2e(0x207),_0x5cde2e(0x20e),_0x5cde2e(0x24d),'lampe'];if(!_0x2a7e72[_0x5cde2e(0x22f)](_0xedbc80=>_0xd18381[_0x5cde2e(0x254)](_0xedbc80)))return;if(!_0x228c21[_0x5cde2e(0x235)])return;if(sequenceTimer)clearTimeout(sequenceTimer);activeSequence[_0x5cde2e(0x1ee)]({'loc':_0x228c21['location']||_0x5cde2e(0x1ed),'id':_0x228c21['id'],'ts':Date[_0x5cde2e(0x23d)]()}),sequenceTimer=setTimeout(async()=>{const _0x380d29=_0x5cde2e;if(activeSequence[_0x380d29(0x22d)]>0x1)await saveCompletedSequence(_0x60f328);activeSequence=[];},SEQUENCE_TIMEOUT_MS);}function startExitTimer(_0x12f02b){const _0xe571d5=a5_0x1fa4;abortExitTimer(_0x12f02b),_0x12f02b[_0xe571d5(0x256)]=!![],_0x12f02b[_0xe571d5(0x227)]=setTimeout(()=>{const _0xadf29e=_0xe571d5;_0x12f02b[_0xadf29e(0x256)]=![];},EXIT_GRACE_PERIOD_SECONDS*0x3e8),_0x12f02b['exitTimer']=setTimeout(()=>{const _0x1d2453=_0xe571d5;setPresence(_0x12f02b,![]),_0x12f02b[_0x1d2453(0x215)]=null;},EXIT_TIMER_MINUTES*0x3c*0x3e8);}function a5_0x4888(){const _0x448c14=['Temperature','.1.ACTUAL_TEMPERATURE','log','thermostat','motion','20152pIAoZh','level','useWeather','4onvRaq','bewegung','10duNRpP','type','sendToPythonWrapper','dimmer','occupancy','from','number','message','outdoorSensorId','config','includes','parse','isGracePeriodActive','error','light','schloss','(((.+)+)+)+$','Unknown','push','Valve','tür','.ACTUAL_TEMPERATURE','rawEventLog','314170JHoxSC','präsenz','.4.VALVE_STATE','981oHXVnc','round','LTM.trainingData.thermodynamics','splice','kontakt','lastTrackerEventTime','openweathermap','toLowerCase','valveMapping','TRACK_EVENT','door','fenster','val','getHours','heizung','handle','temperature','switch','STATUS','1060557zOVhUl','temperatur','SIMULATE_SIGNAL','unshift','eventHistory','schalter','string','lampe','shift','getForeignStateAsync','.1.LEVEL','282682xutOLb','exitTimer','loc','.1.TEMPERATURE','toString','replace','ANALYZE_SEQUENCE','isProVersion','2902039PCxkdE','lock','stringify','presence','LTM.trainingData.sequences','\x20from\x20','exports','currentSystemMode','search','.NextHours.Location_1.Day_1.current.temp_value','408018XIpKBl','exitGraceTimer','isExit','apply','system.isPresent','window','sensorLastValues','length','normal','some','accuweather','location','.1.VALVE_STATE','isPresent','124564kOhdFv','value','toISOString','.Current.Temperature','map','setStateAsync','constructor','weatherInstance','getStateAsync','now','name','[RECORDER]\x20Ignored\x20implausible\x20temperature:\x20'];a5_0x4888=function(){return _0x448c14;};return a5_0x4888();}function abortExitTimer(_0x4d371e){const _0x43746f=a5_0x1fa4;if(_0x4d371e[_0x43746f(0x215)])clearTimeout(_0x4d371e['exitTimer']);if(_0x4d371e[_0x43746f(0x227)])clearTimeout(_0x4d371e[_0x43746f(0x227)]);_0x4d371e[_0x43746f(0x215)]=null,_0x4d371e[_0x43746f(0x227)]=null,_0x4d371e[_0x43746f(0x256)]=![];}async function setPresence(_0x411741,_0x49ee71){const _0x4c6b30=a5_0x1fa4;if(_0x411741[_0x4c6b30(0x233)]===_0x49ee71)return;_0x411741[_0x4c6b30(0x233)]=_0x49ee71,await _0x411741[_0x4c6b30(0x239)](_0x4c6b30(0x22a),{'val':_0x49ee71,'ack':!![]});}async function processSensorEvent(_0xfd0aff,_0x176270,_0x5d86db,_0x394361){const _0x47690f=a5_0x1fa4;if(!_0x394361)return null;const _0x4d0be9=_0x5d86db[_0x47690f(0x202)],_0x3d4ede=Date['now'](),_0x51fb16=_0xfd0aff[_0x47690f(0x22c)][_0x176270],_0x5f514e=(_0x394361[_0x47690f(0x24b)]||'')[_0x47690f(0x1fd)](),_0x4ce3e9=_0x5f514e['includes']('temperature')||_0x5f514e[_0x47690f(0x254)](_0x47690f(0x20a))||_0x5f514e[_0x47690f(0x254)]('klima')||_0x5f514e['includes'](_0x47690f(0x204))||_0x5f514e['includes'](_0x47690f(0x243));if(_0x4ce3e9&&typeof _0x4d0be9===_0x47690f(0x250)){if(_0x4d0be9>0x50||_0x4d0be9<-0x32)return _0xfd0aff[_0x47690f(0x242)]['debug'](_0x47690f(0x23f)+_0x4d0be9+_0x47690f(0x221)+_0x176270),null;}_0xfd0aff['sensorLastValues'][_0x176270]=_0x4d0be9;if(!_0x394361['logDuplicates']&&_0x51fb16!=undefined&&_0x51fb16==_0x4d0be9)return null;_0xfd0aff[_0x47690f(0x21b)]&&_0x4ce3e9&&recordThermodynamics(_0xfd0aff,_0x176270,_0x4d0be9,_0x394361[_0x47690f(0x231)]);const _0x176b18={'timestamp':_0x3d4ede,'id':_0x176270,'name':_0x394361[_0x47690f(0x23e)],'type':_0x394361[_0x47690f(0x24b)],'location':_0x394361[_0x47690f(0x231)],'value':_0x4d0be9};_0xfd0aff[_0x47690f(0x20d)][_0x47690f(0x20c)](_0x176b18);if(_0xfd0aff['eventHistory']['length']>HISTORY_MAX_SIZE)_0xfd0aff[_0x47690f(0x20d)]['pop']();await _0xfd0aff[_0x47690f(0x239)]('events.lastEvent',{'val':JSON[_0x47690f(0x21e)](_0x176b18),'ack':!![]}),await _0xfd0aff[_0x47690f(0x239)]('events.history',{'val':JSON[_0x47690f(0x21e)](_0xfd0aff['eventHistory']),'ack':!![]});if(_0xfd0aff[_0x47690f(0x21b)]){_0xfd0aff[_0x47690f(0x1f2)][_0x47690f(0x1ee)](_0x176b18);if(_0xfd0aff[_0x47690f(0x1f2)][_0x47690f(0x22d)]>RAW_LOG_MAX_SIZE)_0xfd0aff[_0x47690f(0x1f2)][_0x47690f(0x1f9)](0x0,_0xfd0aff[_0x47690f(0x1f2)]['length']-RAW_LOG_MAX_SIZE);await _0xfd0aff[_0x47690f(0x239)]('LTM.rawEventLog',{'val':JSON[_0x47690f(0x21e)](_0xfd0aff[_0x47690f(0x1f2)]),'ack':!![]}),recordSequence(_0xfd0aff,_0x176b18);}if(_0x394361[_0x47690f(0x228)]&&_0x4d0be9===!![]){if(_0xfd0aff[_0x47690f(0x233)]&&!_0xfd0aff[_0x47690f(0x256)])startExitTimer(_0xfd0aff);else{if(!_0xfd0aff['isPresent'])setPresence(_0xfd0aff,!![]);}}else{if(_0x394361[_0x47690f(0x24b)]===_0x47690f(0x244)&&_0x4d0be9===!![]){if(_0xfd0aff[_0x47690f(0x215)])abortExitTimer(_0xfd0aff);if(!_0xfd0aff[_0x47690f(0x233)]&&_0xfd0aff[_0x47690f(0x223)]===_0x47690f(0x22e))setPresence(_0xfd0aff,!![]);}}if(_0xfd0aff['isProVersion']&&_0xfd0aff['sendToPythonWrapper']){_0x394361[_0x47690f(0x24b)]==='motion'&&_0x4d0be9===!![]&&_0x394361[_0x47690f(0x231)]&&_0xfd0aff[_0x47690f(0x24c)](_0x47690f(0x20b),{'room':_0x394361[_0x47690f(0x231)]});const _0x2ac5b9=['door',_0x47690f(0x1f0),_0x47690f(0x22b),_0x47690f(0x201),'griff',_0x47690f(0x205),_0x47690f(0x21d),_0x47690f(0x1eb)][_0x47690f(0x22f)](_0x2b937a=>_0x5f514e[_0x47690f(0x254)](_0x2b937a)),_0x2fe760=[_0x47690f(0x258),'licht','switch',_0x47690f(0x20e),'dimmer',_0x47690f(0x210)][_0x47690f(0x22f)](_0x4699db=>_0x5f514e['includes'](_0x4699db)),_0xc68cc1=[_0x47690f(0x244),'bewegung',_0x47690f(0x1f4),_0x47690f(0x21f),_0x47690f(0x24e)][_0x47690f(0x22f)](_0x36b0f2=>_0x5f514e[_0x47690f(0x254)](_0x36b0f2));if(_0x394361['location']&&(_0x2ac5b9||_0x2fe760||_0xc68cc1)){const _0x27aa09=_0x4d0be9===!![]||typeof _0x4d0be9===_0x47690f(0x250)&&_0x4d0be9>0x0,_0x4d4f47=_0x2ac5b9&&!_0x27aa09&&_0x51fb16!==undefined&&_0x51fb16!=_0x4d0be9;if(_0x27aa09||_0x4d4f47){const _0x400f8d=_0xfd0aff['lastTrackerEventTime']||_0x3d4ede,_0x336b96=(_0x3d4ede-_0x400f8d)/0x3e8;_0xfd0aff[_0x47690f(0x1fb)]=_0x3d4ede,_0xfd0aff[_0x47690f(0x24c)](_0x47690f(0x1ff),{'room':_0x394361['location'],'dt':_0x336b96});}}}return _0x176b18;}module[a5_0x3da0a3(0x222)]={'processSensorEvent':processSensorEvent,'getOutsideTemperatureNumeric':getOutsideTemperatureNumeric,'setPresence':setPresence,'abortExitTimer':abortExitTimer,'startExitTimer':startExitTimer};