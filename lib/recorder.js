const a5_0x4177ba=a5_0x5235;(function(_0x28494d,_0x1444cf){const _0x35d08e=a5_0x5235,_0x552590=_0x28494d();while(!![]){try{const _0x417977=parseInt(_0x35d08e(0xf6))/0x1*(parseInt(_0x35d08e(0x127))/0x2)+-parseInt(_0x35d08e(0x12a))/0x3+parseInt(_0x35d08e(0x134))/0x4+-parseInt(_0x35d08e(0xef))/0x5+parseInt(_0x35d08e(0x10c))/0x6*(parseInt(_0x35d08e(0x148))/0x7)+parseInt(_0x35d08e(0x143))/0x8+parseInt(_0x35d08e(0x144))/0x9*(-parseInt(_0x35d08e(0xe1))/0xa);if(_0x417977===_0x1444cf)break;else _0x552590['push'](_0x552590['shift']());}catch(_0x364643){_0x552590['push'](_0x552590['shift']());}}}(a5_0x41c8,0x7fcce));const a5_0x3a5d74=(function(){let _0x24f283=!![];return function(_0x3d93ae,_0x7f7a18){const _0x3f0f25=_0x24f283?function(){const _0x26698a=a5_0x5235;if(_0x7f7a18){const _0x63995=_0x7f7a18[_0x26698a(0x14a)](_0x3d93ae,arguments);return _0x7f7a18=null,_0x63995;}}:function(){};return _0x24f283=![],_0x3f0f25;};}()),a5_0x2e50da=a5_0x3a5d74(this,function(){const _0x5f1887=a5_0x5235;return a5_0x2e50da[_0x5f1887(0xff)]()[_0x5f1887(0x11f)]('(((.+)+)+)+$')['toString']()['constructor'](a5_0x2e50da)['search'](_0x5f1887(0xf0));});a5_0x2e50da();'use strict';const HISTORY_MAX_SIZE=0x32,RAW_LOG_MAX_SIZE=0x9c4,THERMO_LOG_SIZE=0x3e8,SEQUENCE_TIMEOUT_MS=0x5*0x3c*0x3e8,MAX_TRAINING_SET_SIZE=0x1f4,EXIT_TIMER_MINUTES=0xf,EXIT_GRACE_PERIOD_SECONDS=0x1e;let activeSequence=[],sequenceTimer=null;async function getOutsideTemperatureNumeric(_0x3774b8){const _0xd4b8e7=a5_0x5235;if(_0x3774b8[_0xd4b8e7(0x124)][_0xd4b8e7(0x125)])try{const _0x27d28d=await _0x3774b8[_0xd4b8e7(0xea)](_0x3774b8[_0xd4b8e7(0x124)][_0xd4b8e7(0x125)]);if(_0x27d28d&&_0x27d28d['val']!==undefined&&_0x27d28d['val']!==null)return parseFloat(_0x27d28d['val']);}catch(_0xd6d602){}const _0x12aa04=_0x3774b8[_0xd4b8e7(0x124)][_0xd4b8e7(0x149)];if(!_0x3774b8[_0xd4b8e7(0x124)][_0xd4b8e7(0x100)]||!_0x12aa04)return null;try{let _0x42cbac='';if(_0x12aa04[_0xd4b8e7(0x112)](_0xd4b8e7(0x119)))_0x42cbac=_0x12aa04+'.Current.Temperature';else{if(_0x12aa04[_0xd4b8e7(0x112)](_0xd4b8e7(0xfb)))_0x42cbac=_0x12aa04+'.NextHours.Location_1.Day_1.current.temp_value';else{if(_0x12aa04[_0xd4b8e7(0x112)](_0xd4b8e7(0x142)))_0x42cbac=_0x12aa04+_0xd4b8e7(0x11a);else{if(_0x12aa04[_0xd4b8e7(0x112)]('weatherunderground'))_0x42cbac=_0x12aa04+_0xd4b8e7(0x105);}}}if(_0x42cbac){const _0x42cc1d=await _0x3774b8[_0xd4b8e7(0xea)](_0x42cbac);if(_0x42cc1d&&_0x42cc1d['val']!==undefined&&_0x42cc1d['val']!==null)return parseFloat(_0x42cc1d[_0xd4b8e7(0xf4)]);}}catch(_0x3ec19c){}return null;}async function recordThermodynamics(_0x26df8a,_0x4407ec,_0x2e90b5,_0x2f4180){const _0x5b74ea=a5_0x5235,_0x3522ec=await getOutsideTemperatureNumeric(_0x26df8a);if(_0x3522ec===null)return;let _0x4b8307=0x0,_0x12d9f4=![];if(_0x26df8a['config']['valveMapping'])try{let _0x5afd43=_0x26df8a['config'][_0x5b74ea(0x136)];if(typeof _0x5afd43===_0x5b74ea(0xee))_0x5afd43=JSON['parse'](_0x5afd43);if(_0x5afd43[_0x4407ec]){const _0xa02b51=_0x5afd43[_0x4407ec],_0x3f66b7=await _0x26df8a[_0x5b74ea(0xea)](_0xa02b51);if(_0x3f66b7&&_0x3f66b7['val']!==null&&_0x3f66b7['val']!==undefined){let _0x5338f7=Number(_0x3f66b7['val']);if(_0x5338f7<=1.05&&!_0xa02b51['includes'](_0x5b74ea(0x102))&&!_0xa02b51[_0x5b74ea(0x112)](_0x5b74ea(0x108)))_0x5338f7=_0x5338f7*0x64;_0x4b8307=Math[_0x5b74ea(0x107)](_0x5338f7),_0x12d9f4=!![];}}}catch(_0x18d9b4){}if(!_0x12d9f4){const _0x30f788=[{'from':_0x5b74ea(0x126),'to':_0x5b74ea(0x128)},{'from':_0x5b74ea(0x126),'to':_0x5b74ea(0x123)},{'from':_0x5b74ea(0x129),'to':_0x5b74ea(0xfc)},{'from':'.ACTUAL_TEMPERATURE','to':'.LEVEL'},{'from':_0x5b74ea(0x13c),'to':'level'},{'from':'Temperature','to':_0x5b74ea(0x147)}];for(const _0x4384c4 of _0x30f788){if(_0x4407ec[_0x5b74ea(0x112)](_0x4384c4[_0x5b74ea(0x13f)])){const _0x14d627=_0x4407ec['replace'](_0x4384c4[_0x5b74ea(0x13f)],_0x4384c4['to']);try{const _0x2899f7=await _0x26df8a['getForeignStateAsync'](_0x14d627);if(_0x2899f7&&_0x2899f7[_0x5b74ea(0xf4)]!==null&&_0x2899f7[_0x5b74ea(0xf4)]!==undefined){let _0x4f71e3=Number(_0x2899f7[_0x5b74ea(0xf4)]);if(typeof _0x4f71e3==='number'){if(_0x4f71e3<=1.05&&_0x4384c4['to'][_0x5b74ea(0x112)](_0x5b74ea(0x111)))_0x4f71e3=_0x4f71e3*0x64;_0x4b8307=Math[_0x5b74ea(0x107)](_0x4f71e3),_0x12d9f4=!![];break;}}}catch(_0x2dbeb2){}}}}const _0x3bed35=await _0x26df8a['getStateAsync']('LTM.trainingData.thermodynamics');let _0x3c4b17=[];if(_0x3bed35&&_0x3bed35[_0x5b74ea(0xf4)])try{_0x3c4b17=JSON[_0x5b74ea(0x12f)](_0x3bed35[_0x5b74ea(0xf4)]);}catch(_0x1e6098){}_0x3c4b17[_0x5b74ea(0xe8)]({'ts':Date[_0x5b74ea(0xe7)](),'room':_0x2f4180||'Unknown','t_in':_0x2e90b5,'t_out':_0x3522ec,'valve':_0x4b8307});if(_0x3c4b17[_0x5b74ea(0x12c)]>THERMO_LOG_SIZE)_0x3c4b17[_0x5b74ea(0xe2)]();await _0x26df8a[_0x5b74ea(0xf7)](_0x5b74ea(0x12b),{'val':JSON[_0x5b74ea(0x122)](_0x3c4b17),'ack':!![]});}async function saveCompletedSequence(_0x195856){const _0x4da6cd=a5_0x5235;try{const _0x339a30=await _0x195856[_0x4da6cd(0xf5)](_0x4da6cd(0xf1));let _0xbc3ed8=[];if(_0x339a30&&_0x339a30[_0x4da6cd(0xf4)])try{_0xbc3ed8=JSON[_0x4da6cd(0x12f)](_0x339a30[_0x4da6cd(0xf4)]);}catch(_0x37779a){}const _0x8322a1=activeSequence[0x0]['ts'],_0x4d6056=activeSequence[_0x4da6cd(0x11d)](_0x28e729=>({'loc':_0x28e729[_0x4da6cd(0x11e)],'t_delta':Math[_0x4da6cd(0x107)]((_0x28e729['ts']-_0x8322a1)/0x3e8)})),_0x3e6710={'timestamp':new Date(_0x8322a1)[_0x4da6cd(0xf3)](),'steps':_0x4d6056,'duration':Math['round']((activeSequence[activeSequence[_0x4da6cd(0x12c)]-0x1]['ts']-_0x8322a1)/0x3e8),'daytime':new Date(_0x8322a1)[_0x4da6cd(0x12d)]()};_0xbc3ed8['push'](_0x3e6710);if(_0xbc3ed8[_0x4da6cd(0x12c)]>MAX_TRAINING_SET_SIZE)_0xbc3ed8[_0x4da6cd(0xe2)]();await _0x195856[_0x4da6cd(0xf7)](_0x4da6cd(0xf1),{'val':JSON['stringify'](_0xbc3ed8),'ack':!![]}),_0x195856[_0x4da6cd(0x120)]&&_0x195856[_0x4da6cd(0x133)]&&_0x195856[_0x4da6cd(0x133)](_0x4da6cd(0xf2),{'sequence':_0x3e6710});}catch(_0x5bb4f9){_0x195856[_0x4da6cd(0x116)][_0x4da6cd(0x146)](_0x4da6cd(0x117)+_0x5bb4f9[_0x4da6cd(0xe4)]);}}async function recordSequence(_0x529e6b,_0xc21f69){const _0x2a546c=a5_0x5235,_0x359ef5=(_0xc21f69['type']||'')['toLowerCase'](),_0x8eed6b=[_0x2a546c(0x135),_0x2a546c(0x139),_0x2a546c(0xfd),_0x2a546c(0x131),_0x2a546c(0x141),_0x2a546c(0x132),_0x2a546c(0x109),_0x2a546c(0x104),_0x2a546c(0xf9),_0x2a546c(0xfe),'kontakt',_0x2a546c(0xed),_0x2a546c(0x140),_0x2a546c(0xdf),'schalter','dimmer','lampe'];if(!_0x8eed6b[_0x2a546c(0x14d)](_0x34bf4e=>_0x359ef5['includes'](_0x34bf4e)))return;if(!_0xc21f69[_0x2a546c(0x106)])return;if(sequenceTimer)clearTimeout(sequenceTimer);activeSequence[_0x2a546c(0xe8)]({'loc':_0xc21f69[_0x2a546c(0x14c)]||_0x2a546c(0xeb),'id':_0xc21f69['id'],'ts':Date[_0x2a546c(0xe7)]()}),sequenceTimer=setTimeout(async()=>{const _0x277ac7=_0x2a546c;if(activeSequence[_0x277ac7(0x12c)]>0x1)await saveCompletedSequence(_0x529e6b);activeSequence=[];},SEQUENCE_TIMEOUT_MS);}function startExitTimer(_0x3f36d8){const _0x112639=a5_0x5235;abortExitTimer(_0x3f36d8),_0x3f36d8[_0x112639(0xfa)]=!![],_0x3f36d8[_0x112639(0x118)]=setTimeout(()=>{_0x3f36d8['isGracePeriodActive']=![];},EXIT_GRACE_PERIOD_SECONDS*0x3e8),_0x3f36d8[_0x112639(0x138)]=setTimeout(()=>{const _0x370421=_0x112639;setPresence(_0x3f36d8,![]),_0x3f36d8[_0x370421(0x138)]=null;},EXIT_TIMER_MINUTES*0x3c*0x3e8);}function abortExitTimer(_0x4e980b){const _0x13b6d1=a5_0x5235;if(_0x4e980b[_0x13b6d1(0x138)])clearTimeout(_0x4e980b[_0x13b6d1(0x138)]);if(_0x4e980b[_0x13b6d1(0x118)])clearTimeout(_0x4e980b['exitGraceTimer']);_0x4e980b['exitTimer']=null,_0x4e980b[_0x13b6d1(0x118)]=null,_0x4e980b[_0x13b6d1(0xfa)]=![];}function a5_0x5235(_0x41c9ef,_0x284508){const _0x23670e=a5_0x41c8();return a5_0x5235=function(_0x2e50da,_0x3a5d74){_0x2e50da=_0x2e50da-0xde;let _0x41c8d2=_0x23670e[_0x2e50da];return _0x41c8d2;},a5_0x5235(_0x41c9ef,_0x284508);}async function setPresence(_0x3e5401,_0x495286){const _0x53cedd=a5_0x5235;if(_0x3e5401[_0x53cedd(0x13d)]===_0x495286)return;_0x3e5401['isPresent']=_0x495286,await _0x3e5401[_0x53cedd(0xf7)](_0x53cedd(0x113),{'val':_0x495286,'ack':!![]});}async function processSensorEvent(_0x3eb182,_0x2f0683,_0x3a5769,_0x17b6f4){const _0x1075b5=a5_0x5235;if(!_0x17b6f4)return null;const _0x558e71=_0x3a5769[_0x1075b5(0xf4)],_0x3904a9=Date[_0x1075b5(0xe7)](),_0x132e2f=_0x3eb182[_0x1075b5(0x10a)][_0x2f0683],_0x148e90=(_0x17b6f4[_0x1075b5(0x13e)]||'')[_0x1075b5(0x145)](),_0x567505=_0x148e90['includes'](_0x1075b5(0x13c))||_0x148e90[_0x1075b5(0x112)](_0x1075b5(0x115))||_0x148e90[_0x1075b5(0x112)](_0x1075b5(0xe9))||_0x148e90['includes'](_0x1075b5(0x11c))||_0x148e90['includes']('thermostat');if(_0x567505&&typeof _0x558e71===_0x1075b5(0xe5)){if(_0x558e71>0x50||_0x558e71<-0x32)return _0x3eb182[_0x1075b5(0x116)]['debug'](_0x1075b5(0xe0)+_0x558e71+'\x20from\x20'+_0x2f0683),null;}_0x3eb182[_0x1075b5(0x10a)][_0x2f0683]=_0x558e71;if(!_0x17b6f4[_0x1075b5(0xde)]&&_0x132e2f!=undefined&&_0x132e2f==_0x558e71)return null;_0x3eb182[_0x1075b5(0x120)]&&_0x567505&&recordThermodynamics(_0x3eb182,_0x2f0683,_0x558e71,_0x17b6f4[_0x1075b5(0x14c)]);const _0x5daff9={'timestamp':_0x3904a9,'id':_0x2f0683,'name':_0x17b6f4[_0x1075b5(0x103)],'type':_0x17b6f4[_0x1075b5(0x13e)],'location':_0x17b6f4[_0x1075b5(0x14c)],'value':_0x558e71};_0x3eb182[_0x1075b5(0x114)][_0x1075b5(0xec)](_0x5daff9);if(_0x3eb182[_0x1075b5(0x114)][_0x1075b5(0x12c)]>HISTORY_MAX_SIZE)_0x3eb182[_0x1075b5(0x114)]['pop']();await _0x3eb182[_0x1075b5(0xf7)](_0x1075b5(0xf8),{'val':JSON[_0x1075b5(0x122)](_0x5daff9),'ack':!![]}),await _0x3eb182['setStateAsync'](_0x1075b5(0x10b),{'val':JSON['stringify'](_0x3eb182[_0x1075b5(0x114)]),'ack':!![]});if(_0x3eb182[_0x1075b5(0x120)]){_0x3eb182['rawEventLog'][_0x1075b5(0xe8)](_0x5daff9);if(_0x3eb182[_0x1075b5(0x110)]['length']>RAW_LOG_MAX_SIZE)_0x3eb182[_0x1075b5(0x110)][_0x1075b5(0x10f)](0x0,_0x3eb182[_0x1075b5(0x110)][_0x1075b5(0x12c)]-RAW_LOG_MAX_SIZE);await _0x3eb182[_0x1075b5(0xf7)](_0x1075b5(0x101),{'val':JSON[_0x1075b5(0x122)](_0x3eb182[_0x1075b5(0x110)]),'ack':!![]}),recordSequence(_0x3eb182,_0x5daff9);}if(_0x17b6f4[_0x1075b5(0xe3)]&&_0x558e71===!![]){if(_0x3eb182[_0x1075b5(0x13d)]&&!_0x3eb182[_0x1075b5(0xfa)])startExitTimer(_0x3eb182);else{if(!_0x3eb182[_0x1075b5(0x13d)])setPresence(_0x3eb182,!![]);}}else{if(_0x17b6f4[_0x1075b5(0x13e)]===_0x1075b5(0x135)&&_0x558e71===!![]){if(_0x3eb182['exitTimer'])abortExitTimer(_0x3eb182);if(!_0x3eb182['isPresent']&&_0x3eb182[_0x1075b5(0x137)]===_0x1075b5(0x13b))setPresence(_0x3eb182,!![]);}}if(_0x3eb182[_0x1075b5(0x120)]&&_0x3eb182[_0x1075b5(0x133)]){_0x17b6f4['type']===_0x1075b5(0x135)&&_0x558e71===!![]&&_0x17b6f4[_0x1075b5(0x14c)]&&_0x3eb182[_0x1075b5(0x133)](_0x1075b5(0x14b),{'room':_0x17b6f4[_0x1075b5(0x14c)]});const _0x41b251=[_0x1075b5(0x132),_0x1075b5(0x109),_0x1075b5(0x104),_0x1075b5(0xf9),_0x1075b5(0x11b),_0x1075b5(0x121),_0x1075b5(0xe6),'schloss']['some'](_0x3b238f=>_0x148e90[_0x1075b5(0x112)](_0x3b238f)),_0x422456=[_0x1075b5(0xed),_0x1075b5(0x140),_0x1075b5(0xdf),_0x1075b5(0x130),_0x1075b5(0x10d),_0x1075b5(0x10e)][_0x1075b5(0x14d)](_0x3955d7=>_0x148e90[_0x1075b5(0x112)](_0x3955d7)),_0x3dbba4=['motion',_0x1075b5(0x139),_0x1075b5(0xfd),_0x1075b5(0x131),_0x1075b5(0x141)][_0x1075b5(0x14d)](_0x4cff47=>_0x148e90[_0x1075b5(0x112)](_0x4cff47));if(_0x17b6f4[_0x1075b5(0x14c)]&&(_0x41b251||_0x422456||_0x3dbba4)){const _0x102bc3=_0x558e71===!![]||typeof _0x558e71===_0x1075b5(0xe5)&&_0x558e71>0x0,_0xab87c=_0x41b251&&!_0x102bc3&&_0x132e2f!==undefined&&_0x132e2f!=_0x558e71;if(_0x102bc3||_0xab87c){const _0x5c6855=_0x3eb182['lastTrackerEventTime']||_0x3904a9,_0x12229d=(_0x3904a9-_0x5c6855)/0x3e8;_0x3eb182[_0x1075b5(0x13a)]=_0x3904a9,_0x3eb182[_0x1075b5(0x133)]('TRACK_EVENT',{'room':_0x17b6f4[_0x1075b5(0x14c)],'dt':_0x12229d});}}}return _0x5daff9;}module[a5_0x4177ba(0x12e)]={'processSensorEvent':processSensorEvent,'getOutsideTemperatureNumeric':getOutsideTemperatureNumeric,'setPresence':setPresence,'abortExitTimer':abortExitTimer,'startExitTimer':startExitTimer};function a5_0x41c8(){const _0x525dc6=['rawEventLog','LEVEL','includes','system.isPresent','eventHistory','temperatur','log','[RECORDER]\x20Error:\x20','exitGraceTimer','accuweather','.forecast.current.temperature','griff','heizung','map','loc','search','isProVersion','handle','stringify','.1.VALVE_STATE','config','outdoorSensorId','.1.ACTUAL_TEMPERATURE','22VWTSDC','.1.LEVEL','.1.TEMPERATURE','703287kzTgEv','LTM.trainingData.thermodynamics','length','getHours','exports','parse','schalter','presence','door','sendToPythonWrapper','1110740blDXiM','motion','valveMapping','currentSystemMode','exitTimer','bewegung','lastTrackerEventTime','normal','temperature','isPresent','type','from','licht','occupancy','openweathermap','1385568yqQGLY','225135YBuvcv','toLowerCase','error','Valve','245pJnVgX','weatherInstance','apply','SIMULATE_SIGNAL','location','some','logDuplicates','switch','[RECORDER]\x20Ignored\x20implausible\x20temperature:\x20','230OdjhYU','shift','isExit','message','number','lock','now','push','klima','getForeignStateAsync','Unknown','unshift','light','string','4463655RYbQEE','(((.+)+)+)+$','LTM.trainingData.sequences','ANALYZE_SEQUENCE','toISOString','val','getStateAsync','71419YuRGIc','setStateAsync','events.lastEvent','fenster','isGracePeriodActive','daswetter','.4.VALVE_STATE','präsenz','contact','toString','useWeather','LTM.rawEventLog','STATUS','name','window','.forecast.current.temp','value','round','STATE','tür','sensorLastValues','events.history','169626wnxhsk','dimmer','lampe','splice'];a5_0x41c8=function(){return _0x525dc6;};return a5_0x41c8();}