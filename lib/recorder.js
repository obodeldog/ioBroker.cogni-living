const a5_0x432663=a5_0x83e3;(function(_0x52e628,_0x2256eb){const _0x284b26=a5_0x83e3,_0x46438c=_0x52e628();while(!![]){try{const _0x98ecdc=-parseInt(_0x284b26(0xa4))/0x1*(parseInt(_0x284b26(0x97))/0x2)+-parseInt(_0x284b26(0xe6))/0x3+parseInt(_0x284b26(0xe3))/0x4*(parseInt(_0x284b26(0x91))/0x5)+parseInt(_0x284b26(0x9b))/0x6*(parseInt(_0x284b26(0xe8))/0x7)+-parseInt(_0x284b26(0x9d))/0x8*(-parseInt(_0x284b26(0xcd))/0x9)+parseInt(_0x284b26(0xef))/0xa*(-parseInt(_0x284b26(0xe4))/0xb)+parseInt(_0x284b26(0xac))/0xc;if(_0x98ecdc===_0x2256eb)break;else _0x46438c['push'](_0x46438c['shift']());}catch(_0x50bf05){_0x46438c['push'](_0x46438c['shift']());}}}(a5_0x2ccc,0x96679));const a5_0x38ab56=(function(){let _0x50ca41=!![];return function(_0x157d98,_0x4df93c){const _0x226332=_0x50ca41?function(){const _0x5b9c0b=a5_0x83e3;if(_0x4df93c){const _0x5a0d77=_0x4df93c[_0x5b9c0b(0xa1)](_0x157d98,arguments);return _0x4df93c=null,_0x5a0d77;}}:function(){};return _0x50ca41=![],_0x226332;};}()),a5_0x5de7ad=a5_0x38ab56(this,function(){const _0x281ca4=a5_0x83e3;return a5_0x5de7ad[_0x281ca4(0x92)]()['search'](_0x281ca4(0xda))[_0x281ca4(0x92)]()[_0x281ca4(0xc9)](a5_0x5de7ad)[_0x281ca4(0xcb)](_0x281ca4(0xda));});a5_0x5de7ad();'use strict';const HISTORY_MAX_SIZE=0x32,RAW_LOG_MAX_SIZE=0x9c4,THERMO_LOG_SIZE=0x3e8,SEQUENCE_TIMEOUT_MS=0x5*0x3c*0x3e8,MAX_TRAINING_SET_SIZE=0x1f4,EXIT_TIMER_MINUTES=0xf,EXIT_GRACE_PERIOD_SECONDS=0x1e;function a5_0x83e3(_0x1da6be,_0x16d3db){const _0x2ef4a4=a5_0x2ccc();return a5_0x83e3=function(_0x5de7ad,_0x38ab56){_0x5de7ad=_0x5de7ad-0x85;let _0x2cccfc=_0x2ef4a4[_0x5de7ad];return _0x2cccfc;},a5_0x83e3(_0x1da6be,_0x16d3db);}function a5_0x2ccc(){const _0x3f82f6=['408104FyFols','string','number','[RECORDER]\x20Ignored\x20implausible\x20temperature:\x20','apply','debug','shift','7WTKHCY','events.lastEvent','isPresent','valveMapping','level','some','LEVEL','log','14971080PjpIEl','sendToPythonWrapper','LTM.trainingData.sequences','eventHistory','schalter','light','window','getForeignStateAsync','exitGraceTimer','exitTimer','weatherunderground','location','switch','\x20from\x20','motion','fenster','round','.4.VALVE_STATE','parse','griff','rawEventLog','bewegung','toLowerCase','sensorLastValues','.NextHours.Location_1.Day_1.current.temp_value','replace','error','now','message','constructor','contact','search','lampe','45pAETiK','exports','LTM.trainingData.thermodynamics','.1.LEVEL','.1.ACTUAL_TEMPERATURE','getStateAsync','normal','accuweather','isProVersion','temperatur','ANALYZE_SEQUENCE','getHours','length','(((.+)+)+)+$','logDuplicates','STATUS','lastTrackerEventTime','temperature','STATE','isGracePeriodActive','[RECORDER]\x20Error:\x20','LTM.rawEventLog','90764nPAYMn','286FvBovi','Unknown','1085310ysbacE','thermostat','203XpTQES','Valve','map','name','setStateAsync','dimmer','stringify','291190fjSgvO','tür','unshift','config','schloss','weatherInstance','occupancy','value','val','outdoorSensorId','includes','.1.VALVE_STATE','splice','type','klima','system.isPresent','40RGVdtu','toString','push','TRACK_EVENT','.ACTUAL_TEMPERATURE','loc','277318tPjMpB','toISOString','useWeather','SIMULATE_SIGNAL','211314jFqXrx','door'];a5_0x2ccc=function(){return _0x3f82f6;};return a5_0x2ccc();}let activeSequence=[],sequenceTimer=null;async function getOutsideTemperatureNumeric(_0x1b364c){const _0xae675=a5_0x83e3;if(_0x1b364c[_0xae675(0xf2)][_0xae675(0x8a)])try{const _0x505c00=await _0x1b364c[_0xae675(0xb3)](_0x1b364c['config'][_0xae675(0x8a)]);if(_0x505c00&&_0x505c00[_0xae675(0x89)]!==undefined&&_0x505c00[_0xae675(0x89)]!==null)return parseFloat(_0x505c00[_0xae675(0x89)]);}catch(_0x523741){}const _0x4c59c3=_0x1b364c[_0xae675(0xf2)][_0xae675(0x86)];if(!_0x1b364c['config'][_0xae675(0x99)]||!_0x4c59c3)return null;try{let _0x302513='';if(_0x4c59c3[_0xae675(0x8b)](_0xae675(0xd4)))_0x302513=_0x4c59c3+'.Current.Temperature';else{if(_0x4c59c3[_0xae675(0x8b)]('daswetter'))_0x302513=_0x4c59c3+_0xae675(0xc4);else{if(_0x4c59c3[_0xae675(0x8b)]('openweathermap'))_0x302513=_0x4c59c3+'.forecast.current.temperature';else{if(_0x4c59c3[_0xae675(0x8b)](_0xae675(0xb6)))_0x302513=_0x4c59c3+'.forecast.current.temp';}}}if(_0x302513){const _0x19ffc3=await _0x1b364c[_0xae675(0xb3)](_0x302513);if(_0x19ffc3&&_0x19ffc3[_0xae675(0x89)]!==undefined&&_0x19ffc3[_0xae675(0x89)]!==null)return parseFloat(_0x19ffc3['val']);}}catch(_0x5f2292){}return null;}async function recordThermodynamics(_0x1f3574,_0x163252,_0x40aa12,_0x5a1396){const _0x5a9f0e=a5_0x83e3,_0x386f78=await getOutsideTemperatureNumeric(_0x1f3574);if(_0x386f78===null)return;let _0x305f5d=0x0,_0x28d5f5=![];if(_0x1f3574['config'][_0x5a9f0e(0xa7)])try{let _0x17ddc5=_0x1f3574[_0x5a9f0e(0xf2)][_0x5a9f0e(0xa7)];if(typeof _0x17ddc5===_0x5a9f0e(0x9e))_0x17ddc5=JSON[_0x5a9f0e(0xbe)](_0x17ddc5);if(_0x17ddc5[_0x163252]){const _0x4938a7=_0x17ddc5[_0x163252],_0x455daf=await _0x1f3574['getForeignStateAsync'](_0x4938a7);if(_0x455daf&&_0x455daf[_0x5a9f0e(0x89)]!==null&&_0x455daf['val']!==undefined){let _0x1a3175=Number(_0x455daf[_0x5a9f0e(0x89)]);if(_0x1a3175<=1.05&&!_0x4938a7[_0x5a9f0e(0x8b)](_0x5a9f0e(0xdc))&&!_0x4938a7['includes'](_0x5a9f0e(0xdf)))_0x1a3175=_0x1a3175*0x64;_0x305f5d=Math[_0x5a9f0e(0xbc)](_0x1a3175),_0x28d5f5=!![];}}}catch(_0x3a6e1e){}if(!_0x28d5f5){const _0x1286c6=[{'from':_0x5a9f0e(0xd1),'to':_0x5a9f0e(0xd0)},{'from':_0x5a9f0e(0xd1),'to':_0x5a9f0e(0x8c)},{'from':'.1.TEMPERATURE','to':_0x5a9f0e(0xbd)},{'from':_0x5a9f0e(0x95),'to':'.LEVEL'},{'from':'temperature','to':_0x5a9f0e(0xa8)},{'from':'Temperature','to':_0x5a9f0e(0xe9)}];for(const _0x51f0aa of _0x1286c6){if(_0x163252[_0x5a9f0e(0x8b)](_0x51f0aa['from'])){const _0x428c64=_0x163252[_0x5a9f0e(0xc5)](_0x51f0aa['from'],_0x51f0aa['to']);try{const _0x1e94f6=await _0x1f3574[_0x5a9f0e(0xb3)](_0x428c64);if(_0x1e94f6&&_0x1e94f6[_0x5a9f0e(0x89)]!==null&&_0x1e94f6[_0x5a9f0e(0x89)]!==undefined){let _0x48ee09=Number(_0x1e94f6[_0x5a9f0e(0x89)]);if(typeof _0x48ee09===_0x5a9f0e(0x9f)){if(_0x48ee09<=1.05&&_0x51f0aa['to'][_0x5a9f0e(0x8b)](_0x5a9f0e(0xaa)))_0x48ee09=_0x48ee09*0x64;_0x305f5d=Math['round'](_0x48ee09),_0x28d5f5=!![];break;}}}catch(_0x598590){}}}}const _0x38dbe8=await _0x1f3574['getStateAsync'](_0x5a9f0e(0xcf));let _0x4b8e78=[];if(_0x38dbe8&&_0x38dbe8[_0x5a9f0e(0x89)])try{_0x4b8e78=JSON[_0x5a9f0e(0xbe)](_0x38dbe8[_0x5a9f0e(0x89)]);}catch(_0x45e334){}_0x4b8e78[_0x5a9f0e(0x93)]({'ts':Date[_0x5a9f0e(0xc7)](),'room':_0x5a1396||_0x5a9f0e(0xe5),'t_in':_0x40aa12,'t_out':_0x386f78,'valve':_0x305f5d});if(_0x4b8e78[_0x5a9f0e(0xd9)]>THERMO_LOG_SIZE)_0x4b8e78[_0x5a9f0e(0xa3)]();await _0x1f3574[_0x5a9f0e(0xec)]('LTM.trainingData.thermodynamics',{'val':JSON[_0x5a9f0e(0xee)](_0x4b8e78),'ack':!![]});}async function saveCompletedSequence(_0xb8b8f8){const _0x3ef2af=a5_0x83e3;try{const _0x99ee8a=await _0xb8b8f8[_0x3ef2af(0xd2)]('LTM.trainingData.sequences');let _0x58ac24=[];if(_0x99ee8a&&_0x99ee8a[_0x3ef2af(0x89)])try{_0x58ac24=JSON[_0x3ef2af(0xbe)](_0x99ee8a['val']);}catch(_0x510714){}const _0x3a8510=activeSequence[0x0]['ts'],_0x32f1ee=activeSequence[_0x3ef2af(0xea)](_0x58094e=>({'loc':_0x58094e[_0x3ef2af(0x96)],'t_delta':Math[_0x3ef2af(0xbc)]((_0x58094e['ts']-_0x3a8510)/0x3e8)})),_0x279afb={'timestamp':new Date(_0x3a8510)[_0x3ef2af(0x98)](),'steps':_0x32f1ee,'duration':Math[_0x3ef2af(0xbc)]((activeSequence[activeSequence[_0x3ef2af(0xd9)]-0x1]['ts']-_0x3a8510)/0x3e8),'daytime':new Date(_0x3a8510)[_0x3ef2af(0xd8)]()};_0x58ac24[_0x3ef2af(0x93)](_0x279afb);if(_0x58ac24[_0x3ef2af(0xd9)]>MAX_TRAINING_SET_SIZE)_0x58ac24[_0x3ef2af(0xa3)]();await _0xb8b8f8[_0x3ef2af(0xec)](_0x3ef2af(0xae),{'val':JSON[_0x3ef2af(0xee)](_0x58ac24),'ack':!![]}),_0xb8b8f8[_0x3ef2af(0xd5)]&&_0xb8b8f8[_0x3ef2af(0xad)]&&_0xb8b8f8[_0x3ef2af(0xad)](_0x3ef2af(0xd7),{'sequence':_0x279afb});}catch(_0x49402b){_0xb8b8f8[_0x3ef2af(0xab)][_0x3ef2af(0xc6)](_0x3ef2af(0xe1)+_0x49402b[_0x3ef2af(0xc8)]);}}async function recordSequence(_0x246067,_0x207839){const _0x464ced=a5_0x83e3,_0x6b01b9=(_0x207839[_0x464ced(0x8e)]||'')[_0x464ced(0xc2)](),_0x5d0317=[_0x464ced(0xba),_0x464ced(0xc1),'präsenz','presence',_0x464ced(0x87),_0x464ced(0x9c),_0x464ced(0xf0),_0x464ced(0xb2),'fenster',_0x464ced(0xca),'kontakt','light','licht',_0x464ced(0xb8),_0x464ced(0xb0),_0x464ced(0xed),'lampe'];if(!_0x5d0317[_0x464ced(0xa9)](_0x32dc6c=>_0x6b01b9[_0x464ced(0x8b)](_0x32dc6c)))return;if(!_0x207839[_0x464ced(0x88)])return;if(sequenceTimer)clearTimeout(sequenceTimer);activeSequence[_0x464ced(0x93)]({'loc':_0x207839[_0x464ced(0xb7)]||_0x464ced(0xe5),'id':_0x207839['id'],'ts':Date[_0x464ced(0xc7)]()}),sequenceTimer=setTimeout(async()=>{const _0x1e143f=_0x464ced;if(activeSequence[_0x1e143f(0xd9)]>0x1)await saveCompletedSequence(_0x246067);activeSequence=[];},SEQUENCE_TIMEOUT_MS);}function startExitTimer(_0x192e61){const _0x48ffd6=a5_0x83e3;abortExitTimer(_0x192e61),_0x192e61[_0x48ffd6(0xe0)]=!![],_0x192e61[_0x48ffd6(0xb4)]=setTimeout(()=>{_0x192e61['isGracePeriodActive']=![];},EXIT_GRACE_PERIOD_SECONDS*0x3e8),_0x192e61[_0x48ffd6(0xb5)]=setTimeout(()=>{const _0x1ecd33=_0x48ffd6;setPresence(_0x192e61,![]),_0x192e61[_0x1ecd33(0xb5)]=null;},EXIT_TIMER_MINUTES*0x3c*0x3e8);}function abortExitTimer(_0x8863c5){const _0x480cfa=a5_0x83e3;if(_0x8863c5[_0x480cfa(0xb5)])clearTimeout(_0x8863c5[_0x480cfa(0xb5)]);if(_0x8863c5['exitGraceTimer'])clearTimeout(_0x8863c5[_0x480cfa(0xb4)]);_0x8863c5[_0x480cfa(0xb5)]=null,_0x8863c5[_0x480cfa(0xb4)]=null,_0x8863c5['isGracePeriodActive']=![];}async function setPresence(_0x24b21c,_0x559c16){const _0x3c00a6=a5_0x83e3;if(_0x24b21c[_0x3c00a6(0xa6)]===_0x559c16)return;_0x24b21c[_0x3c00a6(0xa6)]=_0x559c16,await _0x24b21c[_0x3c00a6(0xec)](_0x3c00a6(0x90),{'val':_0x559c16,'ack':!![]});}async function processSensorEvent(_0x1212ce,_0x3e9e01,_0x50fb86,_0x7ee264){const _0x33c720=a5_0x83e3;if(!_0x7ee264)return null;const _0x634dfe=_0x50fb86[_0x33c720(0x89)],_0x36701b=Date[_0x33c720(0xc7)](),_0x3ae41f=_0x1212ce[_0x33c720(0xc3)][_0x3e9e01],_0x50dfbd=(_0x7ee264['type']||'')[_0x33c720(0xc2)](),_0x36d6e8=_0x50dfbd[_0x33c720(0x8b)](_0x33c720(0xde))||_0x50dfbd[_0x33c720(0x8b)](_0x33c720(0xd6))||_0x50dfbd[_0x33c720(0x8b)](_0x33c720(0x8f))||_0x50dfbd[_0x33c720(0x8b)]('heizung')||_0x50dfbd[_0x33c720(0x8b)](_0x33c720(0xe7));if(_0x36d6e8&&typeof _0x634dfe===_0x33c720(0x9f)){if(_0x634dfe>0x50||_0x634dfe<-0x32)return _0x1212ce[_0x33c720(0xab)][_0x33c720(0xa2)](_0x33c720(0xa0)+_0x634dfe+_0x33c720(0xb9)+_0x3e9e01),null;}_0x1212ce[_0x33c720(0xc3)][_0x3e9e01]=_0x634dfe;if(!_0x7ee264[_0x33c720(0xdb)]&&_0x3ae41f!=undefined&&_0x3ae41f==_0x634dfe)return null;_0x1212ce[_0x33c720(0xd5)]&&_0x36d6e8&&recordThermodynamics(_0x1212ce,_0x3e9e01,_0x634dfe,_0x7ee264[_0x33c720(0xb7)]);const _0x1d87d9={'timestamp':_0x36701b,'id':_0x3e9e01,'name':_0x7ee264[_0x33c720(0xeb)],'type':_0x7ee264[_0x33c720(0x8e)],'location':_0x7ee264['location'],'value':_0x634dfe};_0x1212ce[_0x33c720(0xaf)][_0x33c720(0xf1)](_0x1d87d9);if(_0x1212ce['eventHistory'][_0x33c720(0xd9)]>HISTORY_MAX_SIZE)_0x1212ce[_0x33c720(0xaf)]['pop']();await _0x1212ce['setStateAsync'](_0x33c720(0xa5),{'val':JSON[_0x33c720(0xee)](_0x1d87d9),'ack':!![]}),await _0x1212ce[_0x33c720(0xec)]('events.history',{'val':JSON['stringify'](_0x1212ce['eventHistory']),'ack':!![]});if(_0x1212ce[_0x33c720(0xd5)]){_0x1212ce[_0x33c720(0xc0)]['push'](_0x1d87d9);if(_0x1212ce[_0x33c720(0xc0)][_0x33c720(0xd9)]>RAW_LOG_MAX_SIZE)_0x1212ce[_0x33c720(0xc0)][_0x33c720(0x8d)](0x0,_0x1212ce['rawEventLog'][_0x33c720(0xd9)]-RAW_LOG_MAX_SIZE);await _0x1212ce[_0x33c720(0xec)](_0x33c720(0xe2),{'val':JSON[_0x33c720(0xee)](_0x1212ce[_0x33c720(0xc0)]),'ack':!![]}),recordSequence(_0x1212ce,_0x1d87d9);}if(_0x7ee264['isExit']&&_0x634dfe===!![]){if(_0x1212ce[_0x33c720(0xa6)]&&!_0x1212ce['isGracePeriodActive'])startExitTimer(_0x1212ce);else{if(!_0x1212ce[_0x33c720(0xa6)])setPresence(_0x1212ce,!![]);}}else{if(_0x7ee264['type']==='motion'&&_0x634dfe===!![]){if(_0x1212ce[_0x33c720(0xb5)])abortExitTimer(_0x1212ce);if(!_0x1212ce[_0x33c720(0xa6)]&&_0x1212ce['currentSystemMode']===_0x33c720(0xd3))setPresence(_0x1212ce,!![]);}}if(_0x1212ce[_0x33c720(0xd5)]&&_0x1212ce[_0x33c720(0xad)]){_0x7ee264[_0x33c720(0x8e)]===_0x33c720(0xba)&&_0x634dfe===!![]&&_0x7ee264[_0x33c720(0xb7)]&&_0x1212ce[_0x33c720(0xad)](_0x33c720(0x9a),{'room':_0x7ee264[_0x33c720(0xb7)]});const _0x4e8ff8=[_0x33c720(0x9c),_0x33c720(0xf0),_0x33c720(0xb2),_0x33c720(0xbb),_0x33c720(0xbf),'handle','lock',_0x33c720(0x85)][_0x33c720(0xa9)](_0x4de344=>_0x50dfbd[_0x33c720(0x8b)](_0x4de344)),_0x48b4eb=[_0x33c720(0xb1),'licht',_0x33c720(0xb8),'schalter',_0x33c720(0xed),_0x33c720(0xcc)]['some'](_0x1d04b3=>_0x50dfbd['includes'](_0x1d04b3)),_0x1d6eca=['motion',_0x33c720(0xc1),'präsenz','presence',_0x33c720(0x87)][_0x33c720(0xa9)](_0x3d0ef9=>_0x50dfbd[_0x33c720(0x8b)](_0x3d0ef9));if(_0x7ee264[_0x33c720(0xb7)]&&(_0x4e8ff8||_0x48b4eb||_0x1d6eca)){const _0x144107=_0x634dfe===!![]||typeof _0x634dfe===_0x33c720(0x9f)&&_0x634dfe>0x0,_0x48bc4c=_0x4e8ff8&&!_0x144107&&_0x3ae41f!==undefined&&_0x3ae41f!=_0x634dfe;if(_0x144107||_0x48bc4c){const _0x3a04df=_0x1212ce['lastTrackerEventTime']||_0x36701b,_0x3bccc4=(_0x36701b-_0x3a04df)/0x3e8;_0x1212ce[_0x33c720(0xdd)]=_0x36701b,_0x1212ce['sendToPythonWrapper'](_0x33c720(0x94),{'room':_0x7ee264['location'],'dt':_0x3bccc4});}}}return _0x1d87d9;}module[a5_0x432663(0xce)]={'processSensorEvent':processSensorEvent,'getOutsideTemperatureNumeric':getOutsideTemperatureNumeric,'setPresence':setPresence,'abortExitTimer':abortExitTimer,'startExitTimer':startExitTimer};