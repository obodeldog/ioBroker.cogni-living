const a5_0x2a3b7e=a5_0x3ce1;(function(_0x4d42fa,_0x49732e){const _0x549b99=a5_0x3ce1,_0x2eeb5f=_0x4d42fa();while(!![]){try{const _0x2e2df4=-parseInt(_0x549b99(0x1b4))/0x1+parseInt(_0x549b99(0x1e7))/0x2*(-parseInt(_0x549b99(0x1d2))/0x3)+parseInt(_0x549b99(0x1cf))/0x4+parseInt(_0x549b99(0x1fe))/0x5+parseInt(_0x549b99(0x1d7))/0x6+-parseInt(_0x549b99(0x1c4))/0x7+parseInt(_0x549b99(0x1d0))/0x8;if(_0x2e2df4===_0x49732e)break;else _0x2eeb5f['push'](_0x2eeb5f['shift']());}catch(_0x491d48){_0x2eeb5f['push'](_0x2eeb5f['shift']());}}}(a5_0x3a8c,0x4aeb6));const a5_0x4ff463=(function(){let _0x1402eb=!![];return function(_0x4e2223,_0x2c0cbf){const _0x1707ce=_0x1402eb?function(){const _0x66aa99=a5_0x3ce1;if(_0x2c0cbf){const _0x51327f=_0x2c0cbf[_0x66aa99(0x1ee)](_0x4e2223,arguments);return _0x2c0cbf=null,_0x51327f;}}:function(){};return _0x1402eb=![],_0x1707ce;};}()),a5_0x242855=a5_0x4ff463(this,function(){const _0x1460c5=a5_0x3ce1;return a5_0x242855['toString']()['search']('(((.+)+)+)+$')[_0x1460c5(0x1ac)]()['constructor'](a5_0x242855)[_0x1460c5(0x1f2)](_0x1460c5(0x1ff));});a5_0x242855();'use strict';const HISTORY_MAX_SIZE=0x32,RAW_LOG_MAX_SIZE=0x9c4,THERMO_LOG_SIZE=0x3e8,SEQUENCE_TIMEOUT_MS=0x5*0x3c*0x3e8,MAX_TRAINING_SET_SIZE=0x1f4,EXIT_TIMER_MINUTES=0xf,EXIT_GRACE_PERIOD_SECONDS=0x1e;let activeSequence=[],sequenceTimer=null;async function getOutsideTemperatureNumeric(_0x4c2f90){const _0xda37cd=a5_0x3ce1;if(_0x4c2f90[_0xda37cd(0x201)][_0xda37cd(0x202)])try{const _0x153d0a=await _0x4c2f90[_0xda37cd(0x205)](_0x4c2f90[_0xda37cd(0x201)][_0xda37cd(0x202)]);if(_0x153d0a&&_0x153d0a[_0xda37cd(0x1dd)]!==undefined&&_0x153d0a[_0xda37cd(0x1dd)]!==null)return parseFloat(_0x153d0a[_0xda37cd(0x1dd)]);}catch(_0x3d6735){}const _0x2befa8=_0x4c2f90[_0xda37cd(0x201)]['weatherInstance'];if(!_0x4c2f90[_0xda37cd(0x201)][_0xda37cd(0x1ba)]||!_0x2befa8)return null;try{let _0x4460b6='';if(_0x2befa8['includes']('accuweather'))_0x4460b6=_0x2befa8+_0xda37cd(0x1c6);else{if(_0x2befa8['includes'](_0xda37cd(0x1d1)))_0x4460b6=_0x2befa8+_0xda37cd(0x1d5);else{if(_0x2befa8[_0xda37cd(0x1e9)](_0xda37cd(0x1dc)))_0x4460b6=_0x2befa8+'.forecast.current.temperature';else{if(_0x2befa8[_0xda37cd(0x1e9)](_0xda37cd(0x1f7)))_0x4460b6=_0x2befa8+_0xda37cd(0x1eb);}}}if(_0x4460b6){const _0x435609=await _0x4c2f90['getForeignStateAsync'](_0x4460b6);if(_0x435609&&_0x435609['val']!==undefined&&_0x435609[_0xda37cd(0x1dd)]!==null)return parseFloat(_0x435609[_0xda37cd(0x1dd)]);}}catch(_0x455729){}return null;}function a5_0x3a8c(){const _0x380d4d=['.Current.Temperature','now','currentSystemMode','hm-rpc','dimmer','isExit','normal','.1.VALVE_STATE','exitTimer','1959936REedOy','2118040HDSAds','daswetter','32187iDCYAZ','stringify','occupancy','.NextHours.Location_1.Day_1.current.temp_value','getStateAsync','676734RBSMCe','value','schalter','shift','toISOString','openweathermap','val','eventHistory','parse','switch','.1.ACTUAL_TEMPERATURE','licht','tür','.1.LEVEL','kontakt','events.history','32ueLmLO','logDuplicates','includes','bewegung','.forecast.current.temp','.4.VALVE_STATE','window','apply','isPresent','error','contact','search','type','loc','LEVEL','ANALYZE_SEQUENCE','weatherunderground','LTM.rawEventLog','push','round','sensorLastValues','from','klima','931240HRfOvz','(((.+)+)+)+$','isProVersion','config','outdoorSensorId','Unknown','heizung','getForeignStateAsync','toLowerCase','LTM.trainingData.thermodynamics','events.lastEvent','rawEventLog','location','toString','.ACTUAL_TEMPERATURE','[RECORDER]\x20Error:\x20','LTM.trainingData.sequences','length','exitGraceTimer','motion','some','288366iWYcvH','.1.TEMPERATURE','isGracePeriodActive','light','presence','name','useWeather','sendToPythonWrapper','map','SIMULATE_SIGNAL','system.isPresent','door','message','exports','setStateAsync','pop','2008132MAvqUp','präsenz'];a5_0x3a8c=function(){return _0x380d4d;};return a5_0x3a8c();}async function recordThermodynamics(_0x19c994,_0x249aca,_0x48da02,_0x46929a){const _0xb6e69e=a5_0x3ce1,_0x4970a9=await getOutsideTemperatureNumeric(_0x19c994);let _0x12abec=0x0;if(_0x249aca[_0xb6e69e(0x1e9)](_0xb6e69e(0x1c9))){const _0x3f1ea8=[{'from':_0xb6e69e(0x1e1),'to':_0xb6e69e(0x1e4)},{'from':'.1.ACTUAL_TEMPERATURE','to':_0xb6e69e(0x1cd)},{'from':_0xb6e69e(0x1b5),'to':_0xb6e69e(0x1ec)},{'from':_0xb6e69e(0x1ad),'to':'.LEVEL'}];for(const _0x41c743 of _0x3f1ea8){if(_0x249aca['includes'](_0x41c743[_0xb6e69e(0x1fc)])){const _0x1370c2=_0x249aca['replace'](_0x41c743['from'],_0x41c743['to']);try{const _0xdd59a7=await _0x19c994['getForeignStateAsync'](_0x1370c2);if(_0xdd59a7&&_0xdd59a7[_0xb6e69e(0x1dd)]!==null&&_0xdd59a7[_0xb6e69e(0x1dd)]!==undefined){let _0x4609ca=_0xdd59a7['val'];typeof _0x4609ca==='number'&&_0x4609ca<=1.05&&_0x41c743['to'][_0xb6e69e(0x1e9)](_0xb6e69e(0x1f5))&&(_0x4609ca=_0x4609ca*0x64);_0x12abec=Math['round'](_0x4609ca);break;}}catch(_0xe35a75){}}}}const _0x5d05e4=await _0x19c994[_0xb6e69e(0x1d6)](_0xb6e69e(0x207));let _0x3586cf=[];if(_0x5d05e4&&_0x5d05e4[_0xb6e69e(0x1dd)])try{_0x3586cf=JSON['parse'](_0x5d05e4['val']);}catch(_0xd6556b){}_0x3586cf[_0xb6e69e(0x1f9)]({'ts':Date['now'](),'room':_0x46929a||_0xb6e69e(0x203),'t_in':_0x48da02,'t_out':_0x4970a9,'valve':_0x12abec});if(_0x3586cf[_0xb6e69e(0x1b0)]>THERMO_LOG_SIZE)_0x3586cf[_0xb6e69e(0x1da)]();await _0x19c994[_0xb6e69e(0x1c2)](_0xb6e69e(0x207),{'val':JSON['stringify'](_0x3586cf),'ack':!![]});}function a5_0x3ce1(_0x28213b,_0x405453){const _0x5f639a=a5_0x3a8c();return a5_0x3ce1=function(_0x242855,_0x4ff463){_0x242855=_0x242855-0x1aa;let _0x3a8c21=_0x5f639a[_0x242855];return _0x3a8c21;},a5_0x3ce1(_0x28213b,_0x405453);}async function saveCompletedSequence(_0x3220d3){const _0x55bb10=a5_0x3ce1;try{const _0x3d0b4a=await _0x3220d3['getStateAsync'](_0x55bb10(0x1af));let _0x596df6=[];if(_0x3d0b4a&&_0x3d0b4a['val'])try{_0x596df6=JSON[_0x55bb10(0x1df)](_0x3d0b4a[_0x55bb10(0x1dd)]);}catch(_0x146285){}const _0x500ca1=activeSequence[0x0]['ts'],_0x3104f7=activeSequence[_0x55bb10(0x1bc)](_0x2a06a2=>({'loc':_0x2a06a2[_0x55bb10(0x1f4)],'t_delta':Math[_0x55bb10(0x1fa)]((_0x2a06a2['ts']-_0x500ca1)/0x3e8)})),_0x26fa06={'timestamp':new Date(_0x500ca1)[_0x55bb10(0x1db)](),'steps':_0x3104f7,'duration':Math[_0x55bb10(0x1fa)]((activeSequence[activeSequence['length']-0x1]['ts']-_0x500ca1)/0x3e8),'daytime':new Date(_0x500ca1)['getHours']()};_0x596df6[_0x55bb10(0x1f9)](_0x26fa06);if(_0x596df6[_0x55bb10(0x1b0)]>MAX_TRAINING_SET_SIZE)_0x596df6[_0x55bb10(0x1da)]();await _0x3220d3[_0x55bb10(0x1c2)]('LTM.trainingData.sequences',{'val':JSON[_0x55bb10(0x1d3)](_0x596df6),'ack':!![]}),_0x3220d3['isProVersion']&&_0x3220d3[_0x55bb10(0x1bb)]&&_0x3220d3['sendToPythonWrapper'](_0x55bb10(0x1f6),{'sequence':_0x26fa06});}catch(_0x2f4ebd){_0x3220d3['log'][_0x55bb10(0x1f0)](_0x55bb10(0x1ae)+_0x2f4ebd[_0x55bb10(0x1c0)]);}}async function recordSequence(_0x336b0f,_0x5823e6){const _0x447576=a5_0x3ce1,_0x3ea9f3=(_0x5823e6['type']||'')['toLowerCase'](),_0x546fe2=[_0x447576(0x1b2),_0x447576(0x1ea),_0x447576(0x1c5),_0x447576(0x1b8),_0x447576(0x1d4),_0x447576(0x1bf),_0x447576(0x1e3),_0x447576(0x1ed),'fenster',_0x447576(0x1f1),_0x447576(0x1e5),_0x447576(0x1b7),_0x447576(0x1e2),_0x447576(0x1e0),_0x447576(0x1d9),_0x447576(0x1ca),'lampe'];if(!_0x546fe2[_0x447576(0x1b3)](_0x40ed0a=>_0x3ea9f3['includes'](_0x40ed0a)))return;if(!_0x5823e6[_0x447576(0x1d8)])return;if(sequenceTimer)clearTimeout(sequenceTimer);activeSequence[_0x447576(0x1f9)]({'loc':_0x5823e6[_0x447576(0x1ab)]||'Unknown','id':_0x5823e6['id'],'ts':Date['now']()}),sequenceTimer=setTimeout(async()=>{if(activeSequence['length']>0x1)await saveCompletedSequence(_0x336b0f);activeSequence=[];},SEQUENCE_TIMEOUT_MS);}function startExitTimer(_0x22cc1f){const _0x4cb3d8=a5_0x3ce1;abortExitTimer(_0x22cc1f),_0x22cc1f[_0x4cb3d8(0x1b6)]=!![],_0x22cc1f[_0x4cb3d8(0x1b1)]=setTimeout(()=>{const _0x407952=_0x4cb3d8;_0x22cc1f[_0x407952(0x1b6)]=![];},EXIT_GRACE_PERIOD_SECONDS*0x3e8),_0x22cc1f[_0x4cb3d8(0x1ce)]=setTimeout(()=>{setPresence(_0x22cc1f,![]),_0x22cc1f['exitTimer']=null;},EXIT_TIMER_MINUTES*0x3c*0x3e8);}function abortExitTimer(_0xa6bedc){const _0x1f7c0b=a5_0x3ce1;if(_0xa6bedc[_0x1f7c0b(0x1ce)])clearTimeout(_0xa6bedc['exitTimer']);if(_0xa6bedc[_0x1f7c0b(0x1b1)])clearTimeout(_0xa6bedc[_0x1f7c0b(0x1b1)]);_0xa6bedc['exitTimer']=null,_0xa6bedc[_0x1f7c0b(0x1b1)]=null,_0xa6bedc[_0x1f7c0b(0x1b6)]=![];}async function setPresence(_0x5e6919,_0x49a73c){const _0x3a36cc=a5_0x3ce1;if(_0x5e6919[_0x3a36cc(0x1ef)]===_0x49a73c)return;_0x5e6919[_0x3a36cc(0x1ef)]=_0x49a73c,await _0x5e6919[_0x3a36cc(0x1c2)](_0x3a36cc(0x1be),{'val':_0x49a73c,'ack':!![]});}async function processSensorEvent(_0x376d3e,_0x2ce840,_0x50015a,_0x3f38e5){const _0x1c5775=a5_0x3ce1;if(!_0x3f38e5)return null;const _0x334aa5=_0x50015a[_0x1c5775(0x1dd)],_0x12398d=Date[_0x1c5775(0x1c7)](),_0x4134ca=_0x376d3e[_0x1c5775(0x1fb)][_0x2ce840];_0x376d3e[_0x1c5775(0x1fb)][_0x2ce840]=_0x334aa5;if(!_0x3f38e5[_0x1c5775(0x1e8)]&&_0x4134ca!=undefined&&_0x4134ca==_0x334aa5)return null;const _0x15f483=(_0x3f38e5[_0x1c5775(0x1f3)]||'')[_0x1c5775(0x206)](),_0xfdc8eb=_0x15f483['includes']('temperature')||_0x15f483['includes']('temperatur')||_0x15f483['includes'](_0x1c5775(0x1fd))||_0x15f483[_0x1c5775(0x1e9)](_0x1c5775(0x204));_0x376d3e[_0x1c5775(0x200)]&&_0xfdc8eb&&recordThermodynamics(_0x376d3e,_0x2ce840,_0x334aa5,_0x3f38e5[_0x1c5775(0x1ab)]);const _0x2f77ba={'timestamp':_0x12398d,'id':_0x2ce840,'name':_0x3f38e5[_0x1c5775(0x1b9)],'type':_0x3f38e5[_0x1c5775(0x1f3)],'location':_0x3f38e5[_0x1c5775(0x1ab)],'value':_0x334aa5};_0x376d3e['eventHistory']['unshift'](_0x2f77ba);if(_0x376d3e[_0x1c5775(0x1de)][_0x1c5775(0x1b0)]>HISTORY_MAX_SIZE)_0x376d3e[_0x1c5775(0x1de)][_0x1c5775(0x1c3)]();await _0x376d3e[_0x1c5775(0x1c2)](_0x1c5775(0x208),{'val':JSON[_0x1c5775(0x1d3)](_0x2f77ba),'ack':!![]}),await _0x376d3e['setStateAsync'](_0x1c5775(0x1e6),{'val':JSON[_0x1c5775(0x1d3)](_0x376d3e['eventHistory']),'ack':!![]});if(_0x376d3e[_0x1c5775(0x200)]){_0x376d3e['rawEventLog']['push'](_0x2f77ba);if(_0x376d3e[_0x1c5775(0x1aa)]['length']>RAW_LOG_MAX_SIZE)_0x376d3e[_0x1c5775(0x1aa)]['splice'](0x0,_0x376d3e[_0x1c5775(0x1aa)][_0x1c5775(0x1b0)]-RAW_LOG_MAX_SIZE);await _0x376d3e[_0x1c5775(0x1c2)](_0x1c5775(0x1f8),{'val':JSON['stringify'](_0x376d3e[_0x1c5775(0x1aa)]),'ack':!![]}),recordSequence(_0x376d3e,_0x2f77ba);}if(_0x3f38e5[_0x1c5775(0x1cb)]&&_0x334aa5===!![]){if(_0x376d3e[_0x1c5775(0x1ef)]&&!_0x376d3e[_0x1c5775(0x1b6)])startExitTimer(_0x376d3e);else{if(!_0x376d3e[_0x1c5775(0x1ef)])setPresence(_0x376d3e,!![]);}}else{if(_0x3f38e5['type']===_0x1c5775(0x1b2)&&_0x334aa5===!![]){if(_0x376d3e[_0x1c5775(0x1ce)])abortExitTimer(_0x376d3e);if(!_0x376d3e[_0x1c5775(0x1ef)]&&_0x376d3e[_0x1c5775(0x1c8)]===_0x1c5775(0x1cc))setPresence(_0x376d3e,!![]);}}return _0x376d3e['isProVersion']&&_0x3f38e5[_0x1c5775(0x1f3)]===_0x1c5775(0x1b2)&&_0x334aa5===!![]&&_0x3f38e5[_0x1c5775(0x1ab)]&&_0x376d3e[_0x1c5775(0x1bb)]&&_0x376d3e[_0x1c5775(0x1bb)](_0x1c5775(0x1bd),{'room':_0x3f38e5['location']}),_0x2f77ba;}module[a5_0x2a3b7e(0x1c1)]={'processSensorEvent':processSensorEvent,'getOutsideTemperatureNumeric':getOutsideTemperatureNumeric,'setPresence':setPresence,'abortExitTimer':abortExitTimer,'startExitTimer':startExitTimer};