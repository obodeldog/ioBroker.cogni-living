const a5_0x402e3e=a5_0x2e56;(function(_0x3a6494,_0xd9e24a){const _0x2bfbaa=a5_0x2e56,_0x1c4f56=_0x3a6494();while(!![]){try{const _0x86a68a=-parseInt(_0x2bfbaa(0x179))/0x1+-parseInt(_0x2bfbaa(0x13c))/0x2+parseInt(_0x2bfbaa(0x177))/0x3+-parseInt(_0x2bfbaa(0x132))/0x4*(-parseInt(_0x2bfbaa(0x146))/0x5)+parseInt(_0x2bfbaa(0x16f))/0x6+-parseInt(_0x2bfbaa(0x14b))/0x7+-parseInt(_0x2bfbaa(0x154))/0x8;if(_0x86a68a===_0xd9e24a)break;else _0x1c4f56['push'](_0x1c4f56['shift']());}catch(_0x10e5b3){_0x1c4f56['push'](_0x1c4f56['shift']());}}}(a5_0x11c2,0xda1f5));const a5_0x33ea9c=(function(){let _0x25c4c2=!![];return function(_0x23f990,_0x77cb2b){const _0x4e3baa=_0x25c4c2?function(){const _0x16b832=a5_0x2e56;if(_0x77cb2b){const _0x457732=_0x77cb2b[_0x16b832(0x169)](_0x23f990,arguments);return _0x77cb2b=null,_0x457732;}}:function(){};return _0x25c4c2=![],_0x4e3baa;};}()),a5_0xf42792=a5_0x33ea9c(this,function(){const _0x27fd50=a5_0x2e56;return a5_0xf42792[_0x27fd50(0x11b)]()[_0x27fd50(0x166)](_0x27fd50(0x14c))[_0x27fd50(0x11b)]()[_0x27fd50(0x168)](a5_0xf42792)[_0x27fd50(0x166)](_0x27fd50(0x14c));});a5_0xf42792();'use strict';const HISTORY_MAX_SIZE=0x32,RAW_LOG_MAX_SIZE=0x9c4,THERMO_LOG_SIZE=0x3e8,SEQUENCE_TIMEOUT_MS=0x5*0x3c*0x3e8,MAX_TRAINING_SET_SIZE=0x1f4,EXIT_TIMER_MINUTES=0xf,EXIT_GRACE_PERIOD_SECONDS=0x1e;let activeSequence=[],sequenceTimer=null;async function getOutsideTemperatureNumeric(_0x1af514){const _0x115342=a5_0x2e56;if(_0x1af514['config'][_0x115342(0x115)])try{const _0x509326=await _0x1af514['getForeignStateAsync'](_0x1af514[_0x115342(0x15e)][_0x115342(0x115)]);if(_0x509326&&_0x509326[_0x115342(0x137)]!==undefined&&_0x509326[_0x115342(0x137)]!==null)return parseFloat(_0x509326[_0x115342(0x137)]);}catch(_0x9a72a9){}const _0x79c941=_0x1af514[_0x115342(0x15e)][_0x115342(0x13d)];if(!_0x1af514[_0x115342(0x15e)]['useWeather']||!_0x79c941)return null;try{let _0x51fee7='';if(_0x79c941['includes'](_0x115342(0x125)))_0x51fee7=_0x79c941+'.Current.Temperature';else{if(_0x79c941[_0x115342(0x145)](_0x115342(0x158)))_0x51fee7=_0x79c941+_0x115342(0x17a);else{if(_0x79c941[_0x115342(0x145)]('openweathermap'))_0x51fee7=_0x79c941+_0x115342(0x117);else{if(_0x79c941[_0x115342(0x145)](_0x115342(0x127)))_0x51fee7=_0x79c941+_0x115342(0x111);}}}if(_0x51fee7){const _0x2fa2be=await _0x1af514[_0x115342(0x151)](_0x51fee7);if(_0x2fa2be&&_0x2fa2be[_0x115342(0x137)]!==undefined&&_0x2fa2be['val']!==null)return parseFloat(_0x2fa2be[_0x115342(0x137)]);}}catch(_0x3e6849){}return null;}async function recordThermodynamics(_0x220c44,_0x21510c,_0x57f28f,_0x10b60a){const _0x43d10f=a5_0x2e56,_0x2420ea=await getOutsideTemperatureNumeric(_0x220c44);if(_0x2420ea===null)return;let _0x1e14ec=0x0,_0x3458d9=![];if(_0x220c44[_0x43d10f(0x15e)][_0x43d10f(0x135)])try{let _0x163cc8=_0x220c44['config'][_0x43d10f(0x135)];if(typeof _0x163cc8===_0x43d10f(0x180))_0x163cc8=JSON[_0x43d10f(0x13b)](_0x163cc8);if(_0x163cc8[_0x21510c]){const _0x24eb8f=_0x163cc8[_0x21510c],_0x3dfd7c=await _0x220c44[_0x43d10f(0x151)](_0x24eb8f);if(_0x3dfd7c&&_0x3dfd7c[_0x43d10f(0x137)]!==null&&_0x3dfd7c['val']!==undefined){let _0x1f7b4b=Number(_0x3dfd7c['val']);if(_0x1f7b4b<=1.05&&!_0x24eb8f[_0x43d10f(0x145)](_0x43d10f(0x176))&&!_0x24eb8f['includes'](_0x43d10f(0x129)))_0x1f7b4b=_0x1f7b4b*0x64;_0x1e14ec=Math[_0x43d10f(0x147)](_0x1f7b4b),_0x3458d9=!![];}}}catch(_0x40ce19){}if(!_0x3458d9){const _0x52572f=[{'from':'.1.ACTUAL_TEMPERATURE','to':_0x43d10f(0x123)},{'from':_0x43d10f(0x12d),'to':'.1.VALVE_STATE'},{'from':_0x43d10f(0x133),'to':_0x43d10f(0x124)},{'from':_0x43d10f(0x116),'to':_0x43d10f(0x162)},{'from':_0x43d10f(0x140),'to':_0x43d10f(0x13a)},{'from':_0x43d10f(0x173),'to':_0x43d10f(0x160)}];for(const _0x1368dd of _0x52572f){if(_0x21510c[_0x43d10f(0x145)](_0x1368dd[_0x43d10f(0x112)])){const _0x129388=_0x21510c[_0x43d10f(0x170)](_0x1368dd[_0x43d10f(0x112)],_0x1368dd['to']);try{const _0x513cfa=await _0x220c44[_0x43d10f(0x151)](_0x129388);if(_0x513cfa&&_0x513cfa[_0x43d10f(0x137)]!==null&&_0x513cfa[_0x43d10f(0x137)]!==undefined){let _0x23cb74=Number(_0x513cfa[_0x43d10f(0x137)]);if(typeof _0x23cb74===_0x43d10f(0x11e)){if(_0x23cb74<=1.05&&_0x1368dd['to'][_0x43d10f(0x145)](_0x43d10f(0x17f)))_0x23cb74=_0x23cb74*0x64;_0x1e14ec=Math['round'](_0x23cb74),_0x3458d9=!![];break;}}}catch(_0x4962c2){}}}}const _0xb88246=await _0x220c44['getStateAsync'](_0x43d10f(0x15a));let _0x443bbe=[];if(_0xb88246&&_0xb88246[_0x43d10f(0x137)])try{_0x443bbe=JSON[_0x43d10f(0x13b)](_0xb88246['val']);}catch(_0x1bc3c6){}_0x443bbe[_0x43d10f(0x174)]({'ts':Date[_0x43d10f(0x150)](),'room':_0x10b60a||_0x43d10f(0x113),'t_in':_0x57f28f,'t_out':_0x2420ea,'valve':_0x1e14ec});if(_0x443bbe[_0x43d10f(0x122)]>THERMO_LOG_SIZE)_0x443bbe[_0x43d10f(0x11d)]();await _0x220c44[_0x43d10f(0x14d)](_0x43d10f(0x15a),{'val':JSON['stringify'](_0x443bbe),'ack':!![]});}async function saveCompletedSequence(_0x5a2ad2){const _0x3d5409=a5_0x2e56;try{const _0x25ba74=await _0x5a2ad2['getStateAsync'](_0x3d5409(0x11c));let _0x32f5de=[];if(_0x25ba74&&_0x25ba74['val'])try{_0x32f5de=JSON[_0x3d5409(0x13b)](_0x25ba74['val']);}catch(_0x3bceff){}const _0x37494f=activeSequence[0x0]['ts'],_0x4bbc30=activeSequence[_0x3d5409(0x17d)](_0x3a083e=>({'loc':_0x3a083e['loc'],'t_delta':Math[_0x3d5409(0x147)]((_0x3a083e['ts']-_0x37494f)/0x3e8)})),_0x3e2835={'timestamp':new Date(_0x37494f)[_0x3d5409(0x134)](),'steps':_0x4bbc30,'duration':Math['round']((activeSequence[activeSequence[_0x3d5409(0x122)]-0x1]['ts']-_0x37494f)/0x3e8),'daytime':new Date(_0x37494f)[_0x3d5409(0x175)]()};_0x32f5de['push'](_0x3e2835);if(_0x32f5de[_0x3d5409(0x122)]>MAX_TRAINING_SET_SIZE)_0x32f5de['shift']();await _0x5a2ad2['setStateAsync'](_0x3d5409(0x11c),{'val':JSON[_0x3d5409(0x183)](_0x32f5de),'ack':!![]}),_0x5a2ad2[_0x3d5409(0x11f)]&&_0x5a2ad2[_0x3d5409(0x149)]&&_0x5a2ad2[_0x3d5409(0x149)](_0x3d5409(0x114),{'sequence':_0x3e2835});}catch(_0x1dff0){_0x5a2ad2[_0x3d5409(0x142)][_0x3d5409(0x136)](_0x3d5409(0x171)+_0x1dff0[_0x3d5409(0x12b)]);}}function a5_0x11c2(){const _0x9a6d4d=['LTM.rawEventLog','system.isPresent','heizung','temperatur','licht','7042590bnUOud','replace','[RECORDER]\x20Error:\x20','präsenz','Temperature','push','getHours','STATUS','2609220lNOuen','sensorLastValues','162910NjBaiF','.NextHours.Location_1.Day_1.current.temp_value','isGracePeriodActive','toLowerCase','map','klima','LEVEL','string','exitTimer','value','stringify','schalter','events.lastEvent','exports','.forecast.current.temp','from','Unknown','ANALYZE_SEQUENCE','outdoorSensorId','.ACTUAL_TEMPERATURE','.forecast.current.temperature','getDate','splice','logDuplicates','toString','LTM.trainingData.sequences','shift','number','isProVersion','debug','window','length','.1.LEVEL','.4.VALVE_STATE','accuweather','location','weatherunderground','name','STATE','type','message','\x20from\x20','.1.ACTUAL_TEMPERATURE','presence','kontakt','fill','bewegung','9508jewBOP','.1.TEMPERATURE','toISOString','valveMapping','error','val','isExit','some','level','parse','670478WTFQKh','weatherInstance','switch','TRACK_EVENT','temperature','lampe','log','SIMULATE_SIGNAL','occupancy','includes','125oQDtfL','round','exitGraceTimer','sendToPythonWrapper','isPresent','2328893FtGVjd','(((.+)+)+)+$','setStateAsync','currentSystemMode','light','now','getForeignStateAsync','dimmer','normal','3029224owyAzW','motion','lock','lastTrackerEventTime','daswetter','events.history','LTM.trainingData.thermodynamics','[RECORDER]\x20Ignored\x20implausible\x20temperature:\x20','eventHistory','tür','config','analysis.health.todayVector','Valve','rawEventLog','.LEVEL','fenster','griff','getStateAsync','search','contact','constructor','apply'];a5_0x11c2=function(){return _0x9a6d4d;};return a5_0x11c2();}async function recordSequence(_0x182caa,_0x598e02){const _0x46b967=a5_0x2e56,_0x459f46=(_0x598e02[_0x46b967(0x12a)]||'')['toLowerCase'](),_0x5b6230=['motion',_0x46b967(0x131),_0x46b967(0x172),_0x46b967(0x12e),'occupancy','door',_0x46b967(0x15d),'window','fenster',_0x46b967(0x167),_0x46b967(0x12f),_0x46b967(0x14f),'licht',_0x46b967(0x13e),'schalter',_0x46b967(0x152),_0x46b967(0x141)];if(!_0x5b6230[_0x46b967(0x139)](_0x456a56=>_0x459f46[_0x46b967(0x145)](_0x456a56)))return;if(!_0x598e02[_0x46b967(0x182)])return;if(sequenceTimer)clearTimeout(sequenceTimer);activeSequence['push']({'loc':_0x598e02['location']||_0x46b967(0x113),'id':_0x598e02['id'],'ts':Date[_0x46b967(0x150)]()}),sequenceTimer=setTimeout(async()=>{const _0x5b3b4a=_0x46b967;if(activeSequence[_0x5b3b4a(0x122)]>0x1)await saveCompletedSequence(_0x182caa);activeSequence=[];},SEQUENCE_TIMEOUT_MS);}function startExitTimer(_0x502ac2){const _0x5e357b=a5_0x2e56;abortExitTimer(_0x502ac2),_0x502ac2['isGracePeriodActive']=!![],_0x502ac2[_0x5e357b(0x148)]=setTimeout(()=>{_0x502ac2['isGracePeriodActive']=![];},EXIT_GRACE_PERIOD_SECONDS*0x3e8),_0x502ac2['exitTimer']=setTimeout(()=>{const _0x4637d5=_0x5e357b;setPresence(_0x502ac2,![]),_0x502ac2[_0x4637d5(0x181)]=null;},EXIT_TIMER_MINUTES*0x3c*0x3e8);}function a5_0x2e56(_0x1003ed,_0x3cf9d9){const _0x1d6ef5=a5_0x11c2();return a5_0x2e56=function(_0xf42792,_0x33ea9c){_0xf42792=_0xf42792-0x10f;let _0x11c298=_0x1d6ef5[_0xf42792];return _0x11c298;},a5_0x2e56(_0x1003ed,_0x3cf9d9);}function abortExitTimer(_0x11d04c){const _0x564926=a5_0x2e56;if(_0x11d04c[_0x564926(0x181)])clearTimeout(_0x11d04c[_0x564926(0x181)]);if(_0x11d04c[_0x564926(0x148)])clearTimeout(_0x11d04c[_0x564926(0x148)]);_0x11d04c[_0x564926(0x181)]=null,_0x11d04c[_0x564926(0x148)]=null,_0x11d04c[_0x564926(0x17b)]=![];}async function setPresence(_0x3420fd,_0xae1c45){const _0x2d2c1d=a5_0x2e56;if(_0x3420fd[_0x2d2c1d(0x14a)]===_0xae1c45)return;_0x3420fd[_0x2d2c1d(0x14a)]=_0xae1c45,await _0x3420fd[_0x2d2c1d(0x14d)](_0x2d2c1d(0x16b),{'val':_0xae1c45,'ack':!![]});}async function updateHourlyActivity(_0x52633f){const _0x211259=a5_0x2e56;let _0x348987=new Array(0x18)[_0x211259(0x130)](0x0),_0x4151a4=0x0;try{const _0x194b5e=await _0x52633f[_0x211259(0x165)]('analysis.health.todayVector');_0x194b5e&&_0x194b5e['val']&&(_0x348987=JSON[_0x211259(0x13b)](_0x194b5e['val']),_0x4151a4=_0x194b5e['ts']);}catch(_0xa78a1c){}const _0x4074a7=new Date(_0x4151a4),_0x34db89=new Date();_0x4074a7[_0x211259(0x118)]()!==_0x34db89[_0x211259(0x118)]()&&(_0x348987=new Array(0x18)[_0x211259(0x130)](0x0));const _0x2f30a9=_0x34db89[_0x211259(0x175)]();if(_0x348987[_0x2f30a9]===undefined)_0x348987[_0x2f30a9]=0x0;_0x348987[_0x2f30a9]++,await _0x52633f[_0x211259(0x14d)](_0x211259(0x15f),{'val':JSON[_0x211259(0x183)](_0x348987),'ack':!![]});}async function processSensorEvent(_0x51b7b0,_0x349fee,_0x1b5ff6,_0x14685b){const _0x445b68=a5_0x2e56;if(!_0x14685b)return null;const _0x34d359=_0x1b5ff6['val'],_0x185202=Date[_0x445b68(0x150)](),_0x2385fe=_0x51b7b0['sensorLastValues'][_0x349fee],_0x310259=(_0x14685b['type']||'')[_0x445b68(0x17c)](),_0x308fae=_0x310259[_0x445b68(0x145)](_0x445b68(0x140))||_0x310259[_0x445b68(0x145)](_0x445b68(0x16d))||_0x310259[_0x445b68(0x145)](_0x445b68(0x17e))||_0x310259[_0x445b68(0x145)](_0x445b68(0x16c))||_0x310259[_0x445b68(0x145)]('thermostat');if(_0x308fae&&typeof _0x34d359===_0x445b68(0x11e)){if(_0x34d359>0x50||_0x34d359<-0x32)return _0x51b7b0[_0x445b68(0x142)][_0x445b68(0x120)](_0x445b68(0x15b)+_0x34d359+_0x445b68(0x12c)+_0x349fee),null;}_0x51b7b0[_0x445b68(0x178)][_0x349fee]=_0x34d359;if(!_0x14685b[_0x445b68(0x11a)]&&_0x2385fe!=undefined&&_0x2385fe==_0x34d359)return null;_0x51b7b0[_0x445b68(0x11f)]&&_0x308fae&&recordThermodynamics(_0x51b7b0,_0x349fee,_0x34d359,_0x14685b[_0x445b68(0x126)]);const _0x817a7b={'timestamp':_0x185202,'id':_0x349fee,'name':_0x14685b[_0x445b68(0x128)],'type':_0x14685b[_0x445b68(0x12a)],'location':_0x14685b[_0x445b68(0x126)],'value':_0x34d359};_0x51b7b0[_0x445b68(0x15c)]['unshift'](_0x817a7b);if(_0x51b7b0[_0x445b68(0x15c)][_0x445b68(0x122)]>HISTORY_MAX_SIZE)_0x51b7b0[_0x445b68(0x15c)]['pop']();await _0x51b7b0[_0x445b68(0x14d)](_0x445b68(0x10f),{'val':JSON['stringify'](_0x817a7b),'ack':!![]}),await _0x51b7b0[_0x445b68(0x14d)](_0x445b68(0x159),{'val':JSON[_0x445b68(0x183)](_0x51b7b0[_0x445b68(0x15c)]),'ack':!![]}),await updateHourlyActivity(_0x51b7b0);if(_0x51b7b0[_0x445b68(0x11f)]){_0x51b7b0['rawEventLog'][_0x445b68(0x174)](_0x817a7b);if(_0x51b7b0['rawEventLog'][_0x445b68(0x122)]>RAW_LOG_MAX_SIZE)_0x51b7b0[_0x445b68(0x161)][_0x445b68(0x119)](0x0,_0x51b7b0[_0x445b68(0x161)][_0x445b68(0x122)]-RAW_LOG_MAX_SIZE);await _0x51b7b0['setStateAsync'](_0x445b68(0x16a),{'val':JSON[_0x445b68(0x183)](_0x51b7b0['rawEventLog']),'ack':!![]}),recordSequence(_0x51b7b0,_0x817a7b);}if(_0x14685b[_0x445b68(0x138)]&&_0x34d359===!![]){if(_0x51b7b0[_0x445b68(0x14a)]&&!_0x51b7b0[_0x445b68(0x17b)])startExitTimer(_0x51b7b0);else{if(!_0x51b7b0[_0x445b68(0x14a)])setPresence(_0x51b7b0,!![]);}}else{if(_0x14685b[_0x445b68(0x12a)]===_0x445b68(0x155)&&_0x34d359===!![]){if(_0x51b7b0[_0x445b68(0x181)])abortExitTimer(_0x51b7b0);if(!_0x51b7b0['isPresent']&&_0x51b7b0[_0x445b68(0x14e)]===_0x445b68(0x153))setPresence(_0x51b7b0,!![]);}}if(_0x51b7b0[_0x445b68(0x11f)]&&_0x51b7b0['sendToPythonWrapper']){_0x14685b[_0x445b68(0x12a)]===_0x445b68(0x155)&&_0x34d359===!![]&&_0x14685b['location']&&_0x51b7b0[_0x445b68(0x149)](_0x445b68(0x143),{'room':_0x14685b[_0x445b68(0x126)]});const _0x1ba073=['door','tür',_0x445b68(0x121),_0x445b68(0x163),_0x445b68(0x164),'handle',_0x445b68(0x156),'schloss'][_0x445b68(0x139)](_0x2b3660=>_0x310259['includes'](_0x2b3660)),_0x17ffe0=[_0x445b68(0x14f),_0x445b68(0x16e),_0x445b68(0x13e),_0x445b68(0x184),_0x445b68(0x152),_0x445b68(0x141)]['some'](_0x2656bd=>_0x310259[_0x445b68(0x145)](_0x2656bd)),_0x3e44a2=['motion',_0x445b68(0x131),_0x445b68(0x172),_0x445b68(0x12e),_0x445b68(0x144)]['some'](_0x609689=>_0x310259[_0x445b68(0x145)](_0x609689));if(_0x14685b[_0x445b68(0x126)]&&(_0x1ba073||_0x17ffe0||_0x3e44a2)){const _0x27f049=_0x34d359===!![]||typeof _0x34d359===_0x445b68(0x11e)&&_0x34d359>0x0,_0x43af1f=_0x1ba073&&!_0x27f049&&_0x2385fe!==undefined&&_0x2385fe!=_0x34d359;if(_0x27f049||_0x43af1f){const _0x2ba241=_0x51b7b0[_0x445b68(0x157)]||_0x185202,_0x4ccfb8=(_0x185202-_0x2ba241)/0x3e8;_0x51b7b0['lastTrackerEventTime']=_0x185202,_0x51b7b0[_0x445b68(0x149)](_0x445b68(0x13f),{'room':_0x14685b[_0x445b68(0x126)],'dt':_0x4ccfb8});}}}return _0x817a7b;}module[a5_0x402e3e(0x110)]={'processSensorEvent':processSensorEvent,'getOutsideTemperatureNumeric':getOutsideTemperatureNumeric,'setPresence':setPresence,'abortExitTimer':abortExitTimer,'startExitTimer':startExitTimer};