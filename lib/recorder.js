const a5_0x330766=a5_0x214e;(function(_0x4651c0,_0x534063){const _0xe4c253=a5_0x214e,_0x2c1d30=_0x4651c0();while(!![]){try{const _0x188ccf=parseInt(_0xe4c253(0x1db))/0x1*(-parseInt(_0xe4c253(0x176))/0x2)+parseInt(_0xe4c253(0x1e3))/0x3+parseInt(_0xe4c253(0x18e))/0x4+parseInt(_0xe4c253(0x1d3))/0x5*(-parseInt(_0xe4c253(0x1b4))/0x6)+parseInt(_0xe4c253(0x18f))/0x7*(parseInt(_0xe4c253(0x1d8))/0x8)+-parseInt(_0xe4c253(0x1c0))/0x9*(parseInt(_0xe4c253(0x1bd))/0xa)+parseInt(_0xe4c253(0x17b))/0xb*(parseInt(_0xe4c253(0x1dd))/0xc);if(_0x188ccf===_0x534063)break;else _0x2c1d30['push'](_0x2c1d30['shift']());}catch(_0xe4b656){_0x2c1d30['push'](_0x2c1d30['shift']());}}}(a5_0x163c,0xb0087));const a5_0x11fcb1=(function(){let _0x1d6117=!![];return function(_0x3af98c,_0xa0e37f){const _0x4094bb=_0x1d6117?function(){const _0x20fa48=a5_0x214e;if(_0xa0e37f){const _0x46b7a8=_0xa0e37f[_0x20fa48(0x1bb)](_0x3af98c,arguments);return _0xa0e37f=null,_0x46b7a8;}}:function(){};return _0x1d6117=![],_0x4094bb;};}()),a5_0x3be3e0=a5_0x11fcb1(this,function(){const _0x5f125d=a5_0x214e;return a5_0x3be3e0['toString']()['search'](_0x5f125d(0x17d))['toString']()[_0x5f125d(0x179)](a5_0x3be3e0)[_0x5f125d(0x17a)](_0x5f125d(0x17d));});a5_0x3be3e0();'use strict';const HISTORY_MAX_SIZE=0x32,RAW_LOG_MAX_SIZE=0x9c4,THERMO_LOG_SIZE=0x3e8,SEQUENCE_TIMEOUT_MS=0x5*0x3c*0x3e8,MAX_TRAINING_SET_SIZE=0x1f4,EXIT_TIMER_MINUTES=0xf,EXIT_GRACE_PERIOD_SECONDS=0x1e;let activeSequence=[],sequenceTimer=null;async function getOutsideTemperatureNumeric(_0x120070){const _0x827167=a5_0x214e;if(_0x120070[_0x827167(0x193)][_0x827167(0x1df)])try{const _0x113631=await _0x120070[_0x827167(0x194)](_0x120070['config'][_0x827167(0x1df)]);if(_0x113631&&_0x113631[_0x827167(0x183)]!==undefined&&_0x113631[_0x827167(0x183)]!==null)return parseFloat(_0x113631[_0x827167(0x183)]);}catch(_0x24ddee){}const _0x33c898=_0x120070[_0x827167(0x193)][_0x827167(0x1e2)];if(!_0x120070[_0x827167(0x193)][_0x827167(0x1da)]||!_0x33c898)return null;try{let _0x398e92='';if(_0x33c898[_0x827167(0x19a)](_0x827167(0x1a5)))_0x398e92=_0x33c898+_0x827167(0x197);else{if(_0x33c898['includes'](_0x827167(0x198)))_0x398e92=_0x33c898+_0x827167(0x1e4);else{if(_0x33c898[_0x827167(0x19a)](_0x827167(0x1e0)))_0x398e92=_0x33c898+_0x827167(0x1c9);else{if(_0x33c898[_0x827167(0x19a)](_0x827167(0x190)))_0x398e92=_0x33c898+_0x827167(0x192);}}}if(_0x398e92){const _0x5416fc=await _0x120070[_0x827167(0x194)](_0x398e92);if(_0x5416fc&&_0x5416fc['val']!==undefined&&_0x5416fc[_0x827167(0x183)]!==null)return parseFloat(_0x5416fc[_0x827167(0x183)]);}}catch(_0x1a7e8a){}return null;}async function recordThermodynamics(_0x37d86f,_0x358008,_0x3605ba,_0x4f0260){const _0x5d8417=a5_0x214e,_0x493db9=await getOutsideTemperatureNumeric(_0x37d86f);if(_0x493db9===null)return;let _0x3ab4cf=0x0,_0x48c8da=![];if(_0x37d86f[_0x5d8417(0x193)][_0x5d8417(0x178)])try{let _0x315ec2=_0x37d86f[_0x5d8417(0x193)][_0x5d8417(0x178)];if(typeof _0x315ec2===_0x5d8417(0x1a4))_0x315ec2=JSON[_0x5d8417(0x1d0)](_0x315ec2);if(_0x315ec2[_0x358008]){const _0x5d58ac=_0x315ec2[_0x358008],_0x3bd39c=await _0x37d86f[_0x5d8417(0x194)](_0x5d58ac);if(_0x3bd39c&&_0x3bd39c[_0x5d8417(0x183)]!==null&&_0x3bd39c[_0x5d8417(0x183)]!==undefined){let _0x37eb62=Number(_0x3bd39c[_0x5d8417(0x183)]);if(_0x37eb62<=1.05&&!_0x5d58ac[_0x5d8417(0x19a)](_0x5d8417(0x1c3))&&!_0x5d58ac[_0x5d8417(0x19a)](_0x5d8417(0x1b0)))_0x37eb62=_0x37eb62*0x64;_0x3ab4cf=Math[_0x5d8417(0x1cd)](_0x37eb62),_0x48c8da=!![];}}}catch(_0x4f9379){}if(!_0x48c8da){const _0x9e03ec=[{'from':_0x5d8417(0x180),'to':_0x5d8417(0x1cb)},{'from':_0x5d8417(0x180),'to':'.1.VALVE_STATE'},{'from':_0x5d8417(0x1a6),'to':_0x5d8417(0x1cf)},{'from':_0x5d8417(0x186),'to':'.LEVEL'},{'from':_0x5d8417(0x1d6),'to':'level'},{'from':_0x5d8417(0x1c4),'to':_0x5d8417(0x175)}];for(const _0x5844f3 of _0x9e03ec){if(_0x358008[_0x5d8417(0x19a)](_0x5844f3[_0x5d8417(0x1e6)])){const _0x2c8df0=_0x358008[_0x5d8417(0x17c)](_0x5844f3['from'],_0x5844f3['to']);try{const _0x38951b=await _0x37d86f[_0x5d8417(0x194)](_0x2c8df0);if(_0x38951b&&_0x38951b[_0x5d8417(0x183)]!==null&&_0x38951b[_0x5d8417(0x183)]!==undefined){let _0x5d964a=Number(_0x38951b[_0x5d8417(0x183)]);if(typeof _0x5d964a==='number'){if(_0x5d964a<=1.05&&_0x5844f3['to']['includes'](_0x5d8417(0x1aa)))_0x5d964a=_0x5d964a*0x64;_0x3ab4cf=Math[_0x5d8417(0x1cd)](_0x5d964a),_0x48c8da=!![];break;}}}catch(_0x40d3de){}}}}const _0xac0708=await _0x37d86f[_0x5d8417(0x18a)](_0x5d8417(0x1e8));let _0x49ee5c=[];if(_0xac0708&&_0xac0708[_0x5d8417(0x183)])try{_0x49ee5c=JSON[_0x5d8417(0x1d0)](_0xac0708[_0x5d8417(0x183)]);}catch(_0x4bc097){}_0x49ee5c['push']({'ts':Date[_0x5d8417(0x19c)](),'room':_0x4f0260||'Unknown','t_in':_0x3605ba,'t_out':_0x493db9,'valve':_0x3ab4cf});if(_0x49ee5c[_0x5d8417(0x17f)]>THERMO_LOG_SIZE)_0x49ee5c[_0x5d8417(0x1a0)]();await _0x37d86f['setStateAsync'](_0x5d8417(0x1e8),{'val':JSON['stringify'](_0x49ee5c),'ack':!![]});}async function saveCompletedSequence(_0x3cb609){const _0xb4dcce=a5_0x214e;try{const _0x4dfe66=await _0x3cb609['getStateAsync']('LTM.trainingData.sequences');let _0x46b422=[];if(_0x4dfe66&&_0x4dfe66[_0xb4dcce(0x183)])try{_0x46b422=JSON['parse'](_0x4dfe66['val']);}catch(_0x1c64a8){}const _0x4e4b40=activeSequence[0x0]['ts'],_0x1ce510=activeSequence[_0xb4dcce(0x181)](_0x5b59bd=>({'loc':_0x5b59bd[_0xb4dcce(0x1ca)],'t_delta':Math[_0xb4dcce(0x1cd)]((_0x5b59bd['ts']-_0x4e4b40)/0x3e8)})),_0x39e224={'timestamp':new Date(_0x4e4b40)[_0xb4dcce(0x1ac)](),'steps':_0x1ce510,'duration':Math[_0xb4dcce(0x1cd)]((activeSequence[activeSequence['length']-0x1]['ts']-_0x4e4b40)/0x3e8),'daytime':new Date(_0x4e4b40)[_0xb4dcce(0x1b1)]()};_0x46b422['push'](_0x39e224);if(_0x46b422[_0xb4dcce(0x17f)]>MAX_TRAINING_SET_SIZE)_0x46b422[_0xb4dcce(0x1a0)]();await _0x3cb609[_0xb4dcce(0x1e5)](_0xb4dcce(0x1c8),{'val':JSON['stringify'](_0x46b422),'ack':!![]}),_0x3cb609[_0xb4dcce(0x1ae)]&&_0x3cb609[_0xb4dcce(0x1d5)]&&_0x3cb609['sendToPythonWrapper'](_0xb4dcce(0x1a8),{'sequence':_0x39e224});}catch(_0x270acf){_0x3cb609[_0xb4dcce(0x19e)]['error']('[RECORDER]\x20Error:\x20'+_0x270acf['message']);}}async function recordSequence(_0x1f6c5a,_0xd52273){const _0x216d14=a5_0x214e,_0x3a8cfb=(_0xd52273[_0x216d14(0x18c)]||'')[_0x216d14(0x1d2)](),_0x1e2135=[_0x216d14(0x189),_0x216d14(0x1b6),_0x216d14(0x1e9),_0x216d14(0x17e),_0x216d14(0x1e1),_0x216d14(0x1d4),_0x216d14(0x1b5),'window',_0x216d14(0x1c1),'contact',_0x216d14(0x1bc),_0x216d14(0x1dc),'licht','switch',_0x216d14(0x1c2),_0x216d14(0x19b),_0x216d14(0x1de)];if(!_0x1e2135[_0x216d14(0x1bf)](_0x93001f=>_0x3a8cfb[_0x216d14(0x19a)](_0x93001f)))return;if(!_0xd52273[_0x216d14(0x199)])return;if(sequenceTimer)clearTimeout(sequenceTimer);activeSequence[_0x216d14(0x1b2)]({'loc':_0xd52273[_0x216d14(0x1af)]||_0x216d14(0x185),'id':_0xd52273['id'],'ts':Date[_0x216d14(0x19c)]()}),sequenceTimer=setTimeout(async()=>{if(activeSequence['length']>0x1)await saveCompletedSequence(_0x1f6c5a);activeSequence=[];},SEQUENCE_TIMEOUT_MS);}function startExitTimer(_0x5e2aa4){const _0x296832=a5_0x214e;abortExitTimer(_0x5e2aa4),_0x5e2aa4[_0x296832(0x1c6)]=!![],_0x5e2aa4['exitGraceTimer']=setTimeout(()=>{const _0x49166f=_0x296832;_0x5e2aa4[_0x49166f(0x1c6)]=![];},EXIT_GRACE_PERIOD_SECONDS*0x3e8),_0x5e2aa4[_0x296832(0x1c5)]=setTimeout(()=>{const _0x1ae0b4=_0x296832;setPresence(_0x5e2aa4,![]),_0x5e2aa4[_0x1ae0b4(0x1c5)]=null;},EXIT_TIMER_MINUTES*0x3c*0x3e8);}function abortExitTimer(_0x27edcc){const _0x1f0112=a5_0x214e;if(_0x27edcc['exitTimer'])clearTimeout(_0x27edcc[_0x1f0112(0x1c5)]);if(_0x27edcc[_0x1f0112(0x19d)])clearTimeout(_0x27edcc[_0x1f0112(0x19d)]);_0x27edcc[_0x1f0112(0x1c5)]=null,_0x27edcc[_0x1f0112(0x19d)]=null,_0x27edcc['isGracePeriodActive']=![];}async function setPresence(_0x5221fa,_0x3b8e86){const _0x135946=a5_0x214e;if(_0x5221fa[_0x135946(0x1ad)]===_0x3b8e86)return;_0x5221fa['isPresent']=_0x3b8e86,await _0x5221fa[_0x135946(0x1e5)](_0x135946(0x1ab),{'val':_0x3b8e86,'ack':!![]});}function a5_0x214e(_0x5cb91e,_0x52ee74){const _0x3f66ab=a5_0x163c();return a5_0x214e=function(_0x3be3e0,_0x11fcb1){_0x3be3e0=_0x3be3e0-0x174;let _0x163ccb=_0x3f66ab[_0x3be3e0];return _0x163ccb;},a5_0x214e(_0x5cb91e,_0x52ee74);}async function updateHourlyActivity(_0x53fc59){const _0x1e142f=a5_0x214e;let _0x47b1a2=new Array(0x18)['fill'](0x0),_0x275db1=0x0;try{const _0xf5173b=await _0x53fc59['getStateAsync'](_0x1e142f(0x1a1));_0xf5173b&&_0xf5173b[_0x1e142f(0x183)]&&(_0x47b1a2=JSON[_0x1e142f(0x1d0)](_0xf5173b[_0x1e142f(0x183)]),_0x275db1=_0xf5173b['ts']);}catch(_0xb4bf6a){}const _0x2ad7fc=new Date(_0x275db1),_0x352118=new Date();_0x2ad7fc[_0x1e142f(0x1ba)]()!==_0x352118['getDate']()&&(_0x47b1a2=new Array(0x18)[_0x1e142f(0x1a7)](0x0));const _0x5c04fb=_0x352118[_0x1e142f(0x1b1)]();if(_0x47b1a2[_0x5c04fb]===undefined)_0x47b1a2[_0x5c04fb]=0x0;_0x47b1a2[_0x5c04fb]++,await _0x53fc59['setStateAsync']('analysis.health.todayVector',{'val':JSON[_0x1e142f(0x187)](_0x47b1a2),'ack':!![]});}async function processSensorEvent(_0x1c7d2c,_0x19d18a,_0xeac1f0,_0x633f87){const _0x4feb1a=a5_0x214e;if(!_0x633f87)return null;const _0x5e5fe2=_0xeac1f0[_0x4feb1a(0x183)],_0x3712da=Date[_0x4feb1a(0x19c)](),_0x4ba394=_0x1c7d2c[_0x4feb1a(0x1e7)][_0x19d18a],_0xb57343=(_0x633f87[_0x4feb1a(0x18c)]||'')[_0x4feb1a(0x1d2)](),_0x240501=_0xb57343['includes'](_0x4feb1a(0x1d6))||_0xb57343[_0x4feb1a(0x19a)]('temperatur')||_0xb57343['includes'](_0x4feb1a(0x1a9))||_0xb57343[_0x4feb1a(0x19a)](_0x4feb1a(0x182))||_0xb57343[_0x4feb1a(0x19a)](_0x4feb1a(0x19f));if(_0x240501&&typeof _0x5e5fe2==='number'){if(_0x5e5fe2>0x50||_0x5e5fe2<-0x32)return _0x1c7d2c['log']['debug']('[RECORDER]\x20Ignored\x20implausible\x20temperature:\x20'+_0x5e5fe2+_0x4feb1a(0x1b8)+_0x19d18a),null;}_0x1c7d2c[_0x4feb1a(0x1e7)][_0x19d18a]=_0x5e5fe2;if(!_0x633f87['logDuplicates']&&_0x4ba394!=undefined&&_0x4ba394==_0x5e5fe2)return null;_0x1c7d2c[_0x4feb1a(0x1ae)]&&_0x240501&&recordThermodynamics(_0x1c7d2c,_0x19d18a,_0x5e5fe2,_0x633f87[_0x4feb1a(0x1af)]);const _0xa70b61={'timestamp':_0x3712da,'id':_0x19d18a,'name':_0x633f87[_0x4feb1a(0x1a2)],'type':_0x633f87['type'],'location':_0x633f87[_0x4feb1a(0x1af)],'value':_0x5e5fe2};_0x1c7d2c[_0x4feb1a(0x18b)][_0x4feb1a(0x1ce)](_0xa70b61);if(_0x1c7d2c['eventHistory'][_0x4feb1a(0x17f)]>HISTORY_MAX_SIZE)_0x1c7d2c[_0x4feb1a(0x18b)]['pop']();await _0x1c7d2c[_0x4feb1a(0x1e5)](_0x4feb1a(0x18d),{'val':JSON['stringify'](_0xa70b61),'ack':!![]}),await _0x1c7d2c[_0x4feb1a(0x1e5)](_0x4feb1a(0x174),{'val':JSON[_0x4feb1a(0x187)](_0x1c7d2c[_0x4feb1a(0x18b)]),'ack':!![]}),await updateHourlyActivity(_0x1c7d2c);if(_0x1c7d2c[_0x4feb1a(0x1ae)]){_0x1c7d2c['rawEventLog'][_0x4feb1a(0x1b2)](_0xa70b61);if(_0x1c7d2c['rawEventLog'][_0x4feb1a(0x17f)]>RAW_LOG_MAX_SIZE)_0x1c7d2c[_0x4feb1a(0x1c7)][_0x4feb1a(0x195)](0x0,_0x1c7d2c[_0x4feb1a(0x1c7)][_0x4feb1a(0x17f)]-RAW_LOG_MAX_SIZE);await _0x1c7d2c['setStateAsync'](_0x4feb1a(0x191),{'val':JSON['stringify'](_0x1c7d2c[_0x4feb1a(0x1c7)]),'ack':!![]}),recordSequence(_0x1c7d2c,_0xa70b61);}if(_0x633f87['isExit']&&_0x5e5fe2===!![]){if(_0x1c7d2c[_0x4feb1a(0x1ad)]&&!_0x1c7d2c[_0x4feb1a(0x1c6)])startExitTimer(_0x1c7d2c);else{if(!_0x1c7d2c['isPresent'])setPresence(_0x1c7d2c,!![]);}}else{if(_0x633f87[_0x4feb1a(0x18c)]==='motion'&&_0x5e5fe2===!![]){if(_0x1c7d2c[_0x4feb1a(0x1c5)])abortExitTimer(_0x1c7d2c);if(!_0x1c7d2c['isPresent']&&_0x1c7d2c[_0x4feb1a(0x1d7)]==='normal')setPresence(_0x1c7d2c,!![]);}}if(_0x1c7d2c[_0x4feb1a(0x1ae)]&&_0x1c7d2c['sendToPythonWrapper']){_0x633f87['type']===_0x4feb1a(0x189)&&_0x5e5fe2===!![]&&_0x633f87[_0x4feb1a(0x1af)]&&_0x1c7d2c['sendToPythonWrapper'](_0x4feb1a(0x1b9),{'room':_0x633f87[_0x4feb1a(0x1af)]});const _0x50cdf8=['door',_0x4feb1a(0x1b5),_0x4feb1a(0x1cc),_0x4feb1a(0x1c1),_0x4feb1a(0x1a3),_0x4feb1a(0x196),_0x4feb1a(0x184),_0x4feb1a(0x1d9)][_0x4feb1a(0x1bf)](_0x57b169=>_0xb57343['includes'](_0x57b169)),_0xc082a2=[_0x4feb1a(0x1dc),_0x4feb1a(0x1b7),_0x4feb1a(0x177),'schalter',_0x4feb1a(0x19b),'lampe'][_0x4feb1a(0x1bf)](_0x59cbd1=>_0xb57343[_0x4feb1a(0x19a)](_0x59cbd1)),_0xd012a=['motion',_0x4feb1a(0x1b6),_0x4feb1a(0x1e9),_0x4feb1a(0x17e),_0x4feb1a(0x1e1)]['some'](_0x578dba=>_0xb57343['includes'](_0x578dba));if(_0x633f87[_0x4feb1a(0x1af)]&&(_0x50cdf8||_0xc082a2||_0xd012a)){const _0x5e2d31=_0x5e5fe2===!![]||typeof _0x5e5fe2===_0x4feb1a(0x188)&&_0x5e5fe2>0x0,_0xb771ca=_0x50cdf8&&!_0x5e2d31&&_0x4ba394!==undefined&&_0x4ba394!=_0x5e5fe2;if(_0x5e2d31||_0xb771ca){const _0x3c8ce2=_0x1c7d2c[_0x4feb1a(0x1be)]||_0x3712da,_0x3c0b8e=(_0x3712da-_0x3c8ce2)/0x3e8;_0x1c7d2c['lastTrackerEventTime']=_0x3712da,_0x1c7d2c[_0x4feb1a(0x1d5)](_0x4feb1a(0x1d1),{'room':_0x633f87[_0x4feb1a(0x1af)],'dt':_0x3c0b8e});}}}return _0xa70b61;}function a5_0x163c(){const _0x45777e=['door','sendToPythonWrapper','temperature','currentSystemMode','3585272zCoukr','schloss','useWeather','1sjpAIM','light','125124MIaAcR','lampe','outdoorSensorId','openweathermap','occupancy','weatherInstance','3993105MLNvla','.NextHours.Location_1.Day_1.current.temp_value','setStateAsync','from','sensorLastValues','LTM.trainingData.thermodynamics','präsenz','events.history','Valve','2375434HmULYm','switch','valveMapping','constructor','search','55jeCMFR','replace','(((.+)+)+)+$','presence','length','.1.ACTUAL_TEMPERATURE','map','heizung','val','lock','Unknown','.ACTUAL_TEMPERATURE','stringify','number','motion','getStateAsync','eventHistory','type','events.lastEvent','2758072DwmfcF','7xMjZaC','weatherunderground','LTM.rawEventLog','.forecast.current.temp','config','getForeignStateAsync','splice','handle','.Current.Temperature','daswetter','value','includes','dimmer','now','exitGraceTimer','log','thermostat','shift','analysis.health.todayVector','name','griff','string','accuweather','.1.TEMPERATURE','fill','ANALYZE_SEQUENCE','klima','LEVEL','system.isPresent','toISOString','isPresent','isProVersion','location','STATE','getHours','push','exports','66dIyXBN','tür','bewegung','licht','\x20from\x20','SIMULATE_SIGNAL','getDate','apply','kontakt','492740lONtXl','lastTrackerEventTime','some','27QHPsfO','fenster','schalter','STATUS','Temperature','exitTimer','isGracePeriodActive','rawEventLog','LTM.trainingData.sequences','.forecast.current.temperature','loc','.1.LEVEL','window','round','unshift','.4.VALVE_STATE','parse','TRACK_EVENT','toLowerCase','211035kppZiM'];a5_0x163c=function(){return _0x45777e;};return a5_0x163c();}module[a5_0x330766(0x1b3)]={'processSensorEvent':processSensorEvent,'getOutsideTemperatureNumeric':getOutsideTemperatureNumeric,'setPresence':setPresence,'abortExitTimer':abortExitTimer,'startExitTimer':startExitTimer};