const a4_0x15ede5=a4_0x3e52;(function(_0x2e55aa,_0x114ca0){const _0x3c7a4d=a4_0x3e52,_0x316c6c=_0x2e55aa();while(!![]){try{const _0x28b761=parseInt(_0x3c7a4d(0x1c8))/0x1+parseInt(_0x3c7a4d(0x203))/0x2+-parseInt(_0x3c7a4d(0x1f9))/0x3*(-parseInt(_0x3c7a4d(0x1d4))/0x4)+-parseInt(_0x3c7a4d(0x1f2))/0x5+parseInt(_0x3c7a4d(0x1d8))/0x6+-parseInt(_0x3c7a4d(0x1c2))/0x7*(-parseInt(_0x3c7a4d(0x202))/0x8)+-parseInt(_0x3c7a4d(0x1ca))/0x9*(parseInt(_0x3c7a4d(0x1f8))/0xa);if(_0x28b761===_0x114ca0)break;else _0x316c6c['push'](_0x316c6c['shift']());}catch(_0x2608c7){_0x316c6c['push'](_0x316c6c['shift']());}}}(a4_0x1606,0x9ebb8));const a4_0x464511=(function(){let _0x3882bb=!![];return function(_0x267ff0,_0x33e358){const _0x22036f=_0x3882bb?function(){const _0x54020d=a4_0x3e52;if(_0x33e358){const _0xf4a6ca=_0x33e358[_0x54020d(0x1f1)](_0x267ff0,arguments);return _0x33e358=null,_0xf4a6ca;}}:function(){};return _0x3882bb=![],_0x22036f;};}()),a4_0x5a4335=a4_0x464511(this,function(){const _0x2febe1=a4_0x3e52;return a4_0x5a4335['toString']()['search']('(((.+)+)+)+$')['toString']()[_0x2febe1(0x1b9)](a4_0x5a4335)[_0x2febe1(0x1c7)](_0x2febe1(0x1d6));});a4_0x5a4335();'use strict';const HISTORY_MAX_SIZE=0x32,RAW_LOG_MAX_SIZE=0x9c4,THERMO_LOG_SIZE=0x3e8,SEQUENCE_TIMEOUT_MS=0x5*0x3c*0x3e8,MAX_TRAINING_SET_SIZE=0x1f4,EXIT_TIMER_MINUTES=0xf,EXIT_GRACE_PERIOD_SECONDS=0x1e;let activeSequence=[],sequenceTimer=null;async function getOutsideTemperatureNumeric(_0x16d215){const _0x17a1d3=a4_0x3e52;if(_0x16d215[_0x17a1d3(0x1e1)][_0x17a1d3(0x1f0)])try{const _0x4dcd12=await _0x16d215[_0x17a1d3(0x1b6)](_0x16d215[_0x17a1d3(0x1e1)][_0x17a1d3(0x1f0)]);if(_0x4dcd12&&_0x4dcd12[_0x17a1d3(0x1cf)]!==undefined&&_0x4dcd12[_0x17a1d3(0x1cf)]!==null)return parseFloat(_0x4dcd12['val']);}catch(_0x8bd5b8){}const _0xa38f2d=_0x16d215[_0x17a1d3(0x1e1)][_0x17a1d3(0x1d5)];if(!_0x16d215[_0x17a1d3(0x1e1)]['useWeather']||!_0xa38f2d)return null;try{let _0x505aed='';if(_0xa38f2d['includes']('accuweather'))_0x505aed=_0xa38f2d+'.Current.Temperature';else{if(_0xa38f2d[_0x17a1d3(0x1e5)](_0x17a1d3(0x1fb)))_0x505aed=_0xa38f2d+_0x17a1d3(0x1c6);else{if(_0xa38f2d['includes'](_0x17a1d3(0x1e0)))_0x505aed=_0xa38f2d+_0x17a1d3(0x1be);else{if(_0xa38f2d['includes']('weatherunderground'))_0x505aed=_0xa38f2d+_0x17a1d3(0x1bc);}}}if(_0x505aed){const _0x1745c9=await _0x16d215['getForeignStateAsync'](_0x505aed);if(_0x1745c9&&_0x1745c9[_0x17a1d3(0x1cf)]!==undefined&&_0x1745c9[_0x17a1d3(0x1cf)]!==null)return parseFloat(_0x1745c9[_0x17a1d3(0x1cf)]);}}catch(_0x463e63){}return null;}async function recordThermodynamics(_0x25d335,_0x35b572,_0x32f24c,_0x5e8733){const _0x21b795=a4_0x3e52,_0x5e81c1=await getOutsideTemperatureNumeric(_0x25d335),_0x2b9172=await _0x25d335[_0x21b795(0x1e6)]('LTM.trainingData.thermodynamics');let _0x413226=[];if(_0x2b9172&&_0x2b9172[_0x21b795(0x1cf)])try{_0x413226=JSON['parse'](_0x2b9172[_0x21b795(0x1cf)]);}catch(_0x11f10a){}_0x413226[_0x21b795(0x1ba)]({'ts':Date[_0x21b795(0x1fc)](),'room':_0x5e8733||_0x21b795(0x1d0),'t_in':_0x32f24c,'t_out':_0x5e81c1});if(_0x413226[_0x21b795(0x1fe)]>THERMO_LOG_SIZE)_0x413226[_0x21b795(0x1eb)]();await _0x25d335['setStateAsync'](_0x21b795(0x1b2),{'val':JSON[_0x21b795(0x1ef)](_0x413226),'ack':!![]});}async function saveCompletedSequence(_0x570d53){const _0x1a993e=a4_0x3e52;try{const _0x2a3f74=await _0x570d53[_0x1a993e(0x1e6)]('LTM.trainingData.sequences');let _0xfcc9f8=[];if(_0x2a3f74&&_0x2a3f74['val'])try{_0xfcc9f8=JSON[_0x1a993e(0x1c5)](_0x2a3f74[_0x1a993e(0x1cf)]);}catch(_0x39c399){}const _0xe54213=activeSequence[0x0]['ts'],_0xfe0012=activeSequence[_0x1a993e(0x1ed)](_0x2b94a9=>({'loc':_0x2b94a9[_0x1a993e(0x1c0)],'t_delta':Math[_0x1a993e(0x1f3)]((_0x2b94a9['ts']-_0xe54213)/0x3e8)})),_0x2c4875={'timestamp':new Date(_0xe54213)[_0x1a993e(0x1e7)](),'steps':_0xfe0012,'duration':Math['round']((activeSequence[activeSequence['length']-0x1]['ts']-_0xe54213)/0x3e8),'daytime':new Date(_0xe54213)[_0x1a993e(0x1ff)]()};_0xfcc9f8[_0x1a993e(0x1ba)](_0x2c4875);if(_0xfcc9f8[_0x1a993e(0x1fe)]>MAX_TRAINING_SET_SIZE)_0xfcc9f8[_0x1a993e(0x1eb)]();await _0x570d53[_0x1a993e(0x1df)]('LTM.trainingData.sequences',{'val':JSON[_0x1a993e(0x1ef)](_0xfcc9f8),'ack':!![]}),_0x570d53[_0x1a993e(0x1cb)]&&_0x570d53[_0x1a993e(0x201)]&&_0x570d53[_0x1a993e(0x201)](_0x1a993e(0x1cd),{'sequence':_0x2c4875});}catch(_0x267870){_0x570d53['log'][_0x1a993e(0x1f6)]('[RECORDER]\x20Error:\x20'+_0x267870[_0x1a993e(0x1bd)]);}}async function recordSequence(_0x280d0f,_0x328b45){const _0x17f51a=a4_0x3e52,_0x41d2ae=(_0x328b45[_0x17f51a(0x1b5)]||'')['toLowerCase'](),_0x32ba3e=['motion',_0x17f51a(0x1e4),'präsenz',_0x17f51a(0x1e9),_0x17f51a(0x1c9),_0x17f51a(0x1cc),_0x17f51a(0x1fd),_0x17f51a(0x1f5),'fenster','contact','kontakt',_0x17f51a(0x1b1),_0x17f51a(0x1b8),_0x17f51a(0x1c3),_0x17f51a(0x1ea),'dimmer',_0x17f51a(0x1bb)];if(!_0x32ba3e[_0x17f51a(0x1db)](_0x45c573=>_0x41d2ae[_0x17f51a(0x1e5)](_0x45c573)))return;if(!_0x328b45[_0x17f51a(0x1ee)])return;if(sequenceTimer)clearTimeout(sequenceTimer);activeSequence[_0x17f51a(0x1ba)]({'loc':_0x328b45['location']||'Unknown','id':_0x328b45['id'],'ts':Date['now']()}),sequenceTimer=setTimeout(async()=>{const _0x10dd85=_0x17f51a;if(activeSequence[_0x10dd85(0x1fe)]>0x1)await saveCompletedSequence(_0x280d0f);activeSequence=[];},SEQUENCE_TIMEOUT_MS);}function startExitTimer(_0x566f0c){const _0x323ecb=a4_0x3e52;abortExitTimer(_0x566f0c),_0x566f0c[_0x323ecb(0x1e3)]=!![],_0x566f0c['exitGraceTimer']=setTimeout(()=>{const _0x4832d5=_0x323ecb;_0x566f0c[_0x4832d5(0x1e3)]=![];},EXIT_GRACE_PERIOD_SECONDS*0x3e8),_0x566f0c[_0x323ecb(0x1ec)]=setTimeout(()=>{const _0x49e065=_0x323ecb;setPresence(_0x566f0c,![]),_0x566f0c[_0x49e065(0x1ec)]=null;},EXIT_TIMER_MINUTES*0x3c*0x3e8);}function abortExitTimer(_0x29ba41){const _0x302d53=a4_0x3e52;if(_0x29ba41[_0x302d53(0x1ec)])clearTimeout(_0x29ba41[_0x302d53(0x1ec)]);if(_0x29ba41[_0x302d53(0x1d9)])clearTimeout(_0x29ba41[_0x302d53(0x1d9)]);_0x29ba41[_0x302d53(0x1ec)]=null,_0x29ba41[_0x302d53(0x1d9)]=null,_0x29ba41[_0x302d53(0x1e3)]=![];}async function setPresence(_0x194326,_0x33b5a4){const _0x12d2f4=a4_0x3e52;if(_0x194326[_0x12d2f4(0x1d7)]===_0x33b5a4)return;_0x194326['isPresent']=_0x33b5a4,await _0x194326[_0x12d2f4(0x1df)](_0x12d2f4(0x1e2),{'val':_0x33b5a4,'ack':!![]});}async function processSensorEvent(_0x36c128,_0x3724c2,_0x3f0616,_0x59cc68){const _0x4ea03d=a4_0x3e52;if(!_0x59cc68)return;const _0x3d419a=_0x3f0616['val'],_0x1f7ff0=Date[_0x4ea03d(0x1fc)](),_0x27fe05=_0x36c128[_0x4ea03d(0x1c4)][_0x3724c2];_0x36c128[_0x4ea03d(0x1c4)][_0x3724c2]=_0x3d419a;if(!_0x59cc68[_0x4ea03d(0x1d3)]&&_0x27fe05!=undefined&&_0x27fe05==_0x3d419a)return;const _0x5126a5=(_0x59cc68['type']||'')[_0x4ea03d(0x1dc)](),_0x4e794b=_0x5126a5[_0x4ea03d(0x1e5)](_0x4ea03d(0x1da))||_0x5126a5[_0x4ea03d(0x1e5)](_0x4ea03d(0x1ce))||_0x5126a5[_0x4ea03d(0x1e5)]('klima')||_0x5126a5[_0x4ea03d(0x1e5)](_0x4ea03d(0x1b4));_0x36c128[_0x4ea03d(0x1cb)]&&_0x4e794b&&recordThermodynamics(_0x36c128,_0x3724c2,_0x3d419a,_0x59cc68[_0x4ea03d(0x1b3)]);const _0x1eb7d1={'timestamp':_0x1f7ff0,'id':_0x3724c2,'name':_0x59cc68[_0x4ea03d(0x1d1)],'type':_0x59cc68[_0x4ea03d(0x1b5)],'location':_0x59cc68[_0x4ea03d(0x1b3)],'value':_0x3d419a};_0x36c128[_0x4ea03d(0x1f4)][_0x4ea03d(0x1d2)](_0x1eb7d1);if(_0x36c128[_0x4ea03d(0x1f4)]['length']>HISTORY_MAX_SIZE)_0x36c128['eventHistory'][_0x4ea03d(0x1f7)]();await _0x36c128['setStateAsync']('events.lastEvent',{'val':JSON['stringify'](_0x1eb7d1),'ack':!![]}),await _0x36c128['setStateAsync'](_0x4ea03d(0x1c1),{'val':JSON[_0x4ea03d(0x1ef)](_0x36c128[_0x4ea03d(0x1f4)]),'ack':!![]});if(_0x36c128[_0x4ea03d(0x1cb)]){_0x36c128[_0x4ea03d(0x1fa)][_0x4ea03d(0x1ba)](_0x1eb7d1);if(_0x36c128[_0x4ea03d(0x1fa)][_0x4ea03d(0x1fe)]>RAW_LOG_MAX_SIZE)_0x36c128[_0x4ea03d(0x1fa)][_0x4ea03d(0x1b0)](0x0,_0x36c128[_0x4ea03d(0x1fa)][_0x4ea03d(0x1fe)]-RAW_LOG_MAX_SIZE);await _0x36c128[_0x4ea03d(0x1df)](_0x4ea03d(0x1dd),{'val':JSON[_0x4ea03d(0x1ef)](_0x36c128['rawEventLog']),'ack':!![]}),recordSequence(_0x36c128,_0x1eb7d1);}if(_0x59cc68[_0x4ea03d(0x1bf)]&&_0x3d419a===!![]){if(_0x36c128[_0x4ea03d(0x1d7)]&&!_0x36c128[_0x4ea03d(0x1e3)])startExitTimer(_0x36c128);else{if(!_0x36c128[_0x4ea03d(0x1d7)])setPresence(_0x36c128,!![]);}}else{if(_0x59cc68[_0x4ea03d(0x1b5)]===_0x4ea03d(0x1b7)&&_0x3d419a===!![]){if(_0x36c128[_0x4ea03d(0x1ec)])abortExitTimer(_0x36c128);if(!_0x36c128[_0x4ea03d(0x1d7)]&&_0x36c128[_0x4ea03d(0x1de)]==='normal')setPresence(_0x36c128,!![]);}}_0x36c128['isProVersion']&&_0x59cc68['type']==='motion'&&_0x3d419a===!![]&&_0x59cc68['location']&&_0x36c128[_0x4ea03d(0x201)]&&_0x36c128['sendToPythonWrapper'](_0x4ea03d(0x200),{'room':_0x59cc68[_0x4ea03d(0x1b3)]});}module[a4_0x15ede5(0x1e8)]={'processSensorEvent':processSensorEvent,'getOutsideTemperatureNumeric':getOutsideTemperatureNumeric,'setPresence':setPresence,'abortExitTimer':abortExitTimer,'startExitTimer':startExitTimer};function a4_0x3e52(_0x174d45,_0x17bb02){const _0x217297=a4_0x1606();return a4_0x3e52=function(_0x5a4335,_0x464511){_0x5a4335=_0x5a4335-0x1b0;let _0x16068a=_0x217297[_0x5a4335];return _0x16068a;},a4_0x3e52(_0x174d45,_0x17bb02);}function a4_0x1606(){const _0x361873=['location','heizung','type','getForeignStateAsync','motion','licht','constructor','push','lampe','.forecast.current.temp','message','.forecast.current.temperature','isExit','loc','events.history','189VgsbqZ','switch','sensorLastValues','parse','.NextHours.Location_1.Day_1.current.temp_value','search','1077414HlBWBp','occupancy','36VlgJJX','isProVersion','door','ANALYZE_SEQUENCE','temperatur','val','Unknown','name','unshift','logDuplicates','40txdwYb','weatherInstance','(((.+)+)+)+$','isPresent','6438708jUnnxX','exitGraceTimer','temperature','some','toLowerCase','LTM.rawEventLog','currentSystemMode','setStateAsync','openweathermap','config','system.isPresent','isGracePeriodActive','bewegung','includes','getStateAsync','toISOString','exports','presence','schalter','shift','exitTimer','map','value','stringify','outdoorSensorId','apply','5870710ehtaGL','round','eventHistory','window','error','pop','7548970muyixc','224121PNERYd','rawEventLog','daswetter','now','tür','length','getHours','SIMULATE_SIGNAL','sendToPythonWrapper','240000MwxTyW','2272592tscSHi','splice','light','LTM.trainingData.thermodynamics'];a4_0x1606=function(){return _0x361873;};return a4_0x1606();}