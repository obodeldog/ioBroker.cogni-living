const a5_0x57c249=a5_0x308d;(function(_0x47a0b6,_0x12b6f6){const _0x5f7829=a5_0x308d,_0x301594=_0x47a0b6();while(!![]){try{const _0x3c4fed=-parseInt(_0x5f7829(0x83))/0x1*(parseInt(_0x5f7829(0xc1))/0x2)+-parseInt(_0x5f7829(0x7a))/0x3*(parseInt(_0x5f7829(0x75))/0x4)+parseInt(_0x5f7829(0xd4))/0x5+parseInt(_0x5f7829(0xa0))/0x6*(-parseInt(_0x5f7829(0xc4))/0x7)+-parseInt(_0x5f7829(0x8b))/0x8*(-parseInt(_0x5f7829(0x87))/0x9)+-parseInt(_0x5f7829(0xcf))/0xa*(-parseInt(_0x5f7829(0x95))/0xb)+-parseInt(_0x5f7829(0xb2))/0xc*(-parseInt(_0x5f7829(0xe6))/0xd);if(_0x3c4fed===_0x12b6f6)break;else _0x301594['push'](_0x301594['shift']());}catch(_0x20001a){_0x301594['push'](_0x301594['shift']());}}}(a5_0x2503,0x88f7b));const a5_0x18ebb3=(function(){let _0x1fb7ae=!![];return function(_0x48a121,_0x609ab4){const _0x2531c0=_0x1fb7ae?function(){const _0x1909e0=a5_0x308d;if(_0x609ab4){const _0x4d28ff=_0x609ab4[_0x1909e0(0xce)](_0x48a121,arguments);return _0x609ab4=null,_0x4d28ff;}}:function(){};return _0x1fb7ae=![],_0x2531c0;};}()),a5_0x27a8c1=a5_0x18ebb3(this,function(){const _0x3d532d=a5_0x308d;return a5_0x27a8c1[_0x3d532d(0x88)]()[_0x3d532d(0xd8)](_0x3d532d(0x9d))[_0x3d532d(0x88)]()[_0x3d532d(0xa8)](a5_0x27a8c1)[_0x3d532d(0xd8)](_0x3d532d(0x9d));});a5_0x27a8c1();'use strict';function a5_0x308d(_0x219e90,_0x27cc06){const _0x37457c=a5_0x2503();return a5_0x308d=function(_0x27a8c1,_0x18ebb3){_0x27a8c1=_0x27a8c1-0x73;let _0x250398=_0x37457c[_0x27a8c1];return _0x250398;},a5_0x308d(_0x219e90,_0x27cc06);}const HISTORY_MAX_SIZE=0x32,RAW_LOG_MAX_SIZE=0x9c4,THERMO_LOG_SIZE=0x3e8,SEQUENCE_TIMEOUT_MS=0x5*0x3c*0x3e8,MAX_TRAINING_SET_SIZE=0x1f4,EXIT_TIMER_MINUTES=0xf,EXIT_GRACE_PERIOD_SECONDS=0x1e;function a5_0x2503(){const _0x36bf30=['normal','accuweather','temperature','handle','setStateAsync','apply','20GUxxfL','isGracePeriodActive','.1.VALVE_STATE','config','sendToPythonWrapper','2715730pBWJEH','getStateAsync','.LEVEL','toISOString','search','Unknown','griff','message','pop','fenster','eventHistory','LTM.trainingData.thermodynamics','schloss','STATE','includes','loc','name','unshift','2250521gqxKcQ','events.lastEvent','logDuplicates','100392GNERSN','präsenz','error','splice','LEVEL','66NyaTlc','motion','weatherunderground','contact','schalter','light','Temperature','currentSystemMode','exports','412bPzzhv','lastTrackerEventTime','openweathermap','tür','36243BLffPp','toString','parse','log','8vpJTWy','stringify','events.history','dimmer','daswetter','ANALYZE_SEQUENCE','getHours','isPresent','switch','window','5360113oXFqir','[RECORDER]\x20Ignored\x20implausible\x20temperature:\x20','kontakt','presence','now','some','exitTimer','.forecast.current.temp','(((.+)+)+)+$','lampe','isProVersion','1212YqXNau','length','isExit','TRACK_EVENT','STATUS','valveMapping','toLowerCase','occupancy','constructor','shift','round','val','push','LTM.rawEventLog','door','type','bewegung','thermostat','24viQsxY','system.isPresent','.1.ACTUAL_TEMPERATURE','lock','getForeignStateAsync','rawEventLog','number','.1.TEMPERATURE','level','.NextHours.Location_1.Day_1.current.temp_value','licht','.ACTUAL_TEMPERATURE','from','location','outdoorSensorId','2304MdXkyT','klima','Valve','9709FUMiwS','sensorLastValues','exitGraceTimer','LTM.trainingData.sequences','.Current.Temperature'];a5_0x2503=function(){return _0x36bf30;};return a5_0x2503();}let activeSequence=[],sequenceTimer=null;async function getOutsideTemperatureNumeric(_0x4bec9b){const _0x453dae=a5_0x308d;if(_0x4bec9b[_0x453dae(0xd2)][_0x453dae(0xc0)])try{const _0x50c327=await _0x4bec9b[_0x453dae(0xb6)](_0x4bec9b[_0x453dae(0xd2)][_0x453dae(0xc0)]);if(_0x50c327&&_0x50c327[_0x453dae(0xab)]!==undefined&&_0x50c327[_0x453dae(0xab)]!==null)return parseFloat(_0x50c327[_0x453dae(0xab)]);}catch(_0x351b11){}const _0x4771b2=_0x4bec9b['config']['weatherInstance'];if(!_0x4bec9b['config']['useWeather']||!_0x4771b2)return null;try{let _0x2d1f1f='';if(_0x4771b2['includes'](_0x453dae(0xca)))_0x2d1f1f=_0x4771b2+_0x453dae(0xc8);else{if(_0x4771b2[_0x453dae(0xe2)](_0x453dae(0x8f)))_0x2d1f1f=_0x4771b2+_0x453dae(0xbb);else{if(_0x4771b2['includes'](_0x453dae(0x85)))_0x2d1f1f=_0x4771b2+'.forecast.current.temperature';else{if(_0x4771b2['includes'](_0x453dae(0x7c)))_0x2d1f1f=_0x4771b2+_0x453dae(0x9c);}}}if(_0x2d1f1f){const _0x3a531e=await _0x4bec9b[_0x453dae(0xb6)](_0x2d1f1f);if(_0x3a531e&&_0x3a531e[_0x453dae(0xab)]!==undefined&&_0x3a531e[_0x453dae(0xab)]!==null)return parseFloat(_0x3a531e[_0x453dae(0xab)]);}}catch(_0x169389){}return null;}async function recordThermodynamics(_0x15a5d8,_0x3ef3bf,_0x5a05ca,_0x2ce664){const _0xf0e743=a5_0x308d,_0x8d016e=await getOutsideTemperatureNumeric(_0x15a5d8);if(_0x8d016e===null)return;let _0x264ecd=0x0,_0x199c46=![];if(_0x15a5d8['config'][_0xf0e743(0xa5)])try{let _0x47595c=_0x15a5d8[_0xf0e743(0xd2)][_0xf0e743(0xa5)];if(typeof _0x47595c==='string')_0x47595c=JSON[_0xf0e743(0x89)](_0x47595c);if(_0x47595c[_0x3ef3bf]){const _0x13cc4c=_0x47595c[_0x3ef3bf],_0x50dd53=await _0x15a5d8[_0xf0e743(0xb6)](_0x13cc4c);if(_0x50dd53&&_0x50dd53['val']!==null&&_0x50dd53[_0xf0e743(0xab)]!==undefined){let _0x572670=Number(_0x50dd53[_0xf0e743(0xab)]);if(_0x572670<=1.05&&!_0x13cc4c[_0xf0e743(0xe2)](_0xf0e743(0xa4))&&!_0x13cc4c[_0xf0e743(0xe2)](_0xf0e743(0xe1)))_0x572670=_0x572670*0x64;_0x264ecd=Math['round'](_0x572670),_0x199c46=!![];}}}catch(_0xe3f5df){}if(!_0x199c46){const _0x472269=[{'from':_0xf0e743(0xb4),'to':'.1.LEVEL'},{'from':_0xf0e743(0xb4),'to':_0xf0e743(0xd1)},{'from':_0xf0e743(0xb9),'to':'.4.VALVE_STATE'},{'from':_0xf0e743(0xbd),'to':_0xf0e743(0xd6)},{'from':_0xf0e743(0xcb),'to':_0xf0e743(0xba)},{'from':_0xf0e743(0x80),'to':_0xf0e743(0xc3)}];for(const _0x1b88df of _0x472269){if(_0x3ef3bf['includes'](_0x1b88df[_0xf0e743(0xbe)])){const _0x34ca12=_0x3ef3bf['replace'](_0x1b88df[_0xf0e743(0xbe)],_0x1b88df['to']);try{const _0x5b936c=await _0x15a5d8['getForeignStateAsync'](_0x34ca12);if(_0x5b936c&&_0x5b936c[_0xf0e743(0xab)]!==null&&_0x5b936c[_0xf0e743(0xab)]!==undefined){let _0x50d352=Number(_0x5b936c['val']);if(typeof _0x50d352==='number'){if(_0x50d352<=1.05&&_0x1b88df['to'][_0xf0e743(0xe2)](_0xf0e743(0x79)))_0x50d352=_0x50d352*0x64;_0x264ecd=Math[_0xf0e743(0xaa)](_0x50d352),_0x199c46=!![];break;}}}catch(_0x27df45){}}}}const _0xe0aa43=await _0x15a5d8['getStateAsync'](_0xf0e743(0xdf));let _0x260574=[];if(_0xe0aa43&&_0xe0aa43[_0xf0e743(0xab)])try{_0x260574=JSON['parse'](_0xe0aa43[_0xf0e743(0xab)]);}catch(_0x53f330){}_0x260574['push']({'ts':Date[_0xf0e743(0x99)](),'room':_0x2ce664||_0xf0e743(0xd9),'t_in':_0x5a05ca,'t_out':_0x8d016e,'valve':_0x264ecd});if(_0x260574[_0xf0e743(0xa1)]>THERMO_LOG_SIZE)_0x260574[_0xf0e743(0xa9)]();await _0x15a5d8['setStateAsync'](_0xf0e743(0xdf),{'val':JSON[_0xf0e743(0x8c)](_0x260574),'ack':!![]});}async function saveCompletedSequence(_0x3bd721){const _0x293a9e=a5_0x308d;try{const _0xa0fbdb=await _0x3bd721[_0x293a9e(0xd5)](_0x293a9e(0xc7));let _0x33cfb1=[];if(_0xa0fbdb&&_0xa0fbdb[_0x293a9e(0xab)])try{_0x33cfb1=JSON[_0x293a9e(0x89)](_0xa0fbdb[_0x293a9e(0xab)]);}catch(_0x2672e9){}const _0x29f560=activeSequence[0x0]['ts'],_0x49c60e=activeSequence['map'](_0x30bf93=>({'loc':_0x30bf93[_0x293a9e(0xe3)],'t_delta':Math[_0x293a9e(0xaa)]((_0x30bf93['ts']-_0x29f560)/0x3e8)})),_0x2924d0={'timestamp':new Date(_0x29f560)[_0x293a9e(0xd7)](),'steps':_0x49c60e,'duration':Math[_0x293a9e(0xaa)]((activeSequence[activeSequence['length']-0x1]['ts']-_0x29f560)/0x3e8),'daytime':new Date(_0x29f560)[_0x293a9e(0x91)]()};_0x33cfb1[_0x293a9e(0xac)](_0x2924d0);if(_0x33cfb1[_0x293a9e(0xa1)]>MAX_TRAINING_SET_SIZE)_0x33cfb1[_0x293a9e(0xa9)]();await _0x3bd721[_0x293a9e(0xcd)]('LTM.trainingData.sequences',{'val':JSON['stringify'](_0x33cfb1),'ack':!![]}),_0x3bd721[_0x293a9e(0x9f)]&&_0x3bd721['sendToPythonWrapper']&&_0x3bd721[_0x293a9e(0xd3)](_0x293a9e(0x90),{'sequence':_0x2924d0});}catch(_0x55885f){_0x3bd721[_0x293a9e(0x8a)][_0x293a9e(0x77)]('[RECORDER]\x20Error:\x20'+_0x55885f[_0x293a9e(0xdb)]);}}async function recordSequence(_0x167ca7,_0x42fb1e){const _0x5462c9=a5_0x308d,_0x24d3c2=(_0x42fb1e[_0x5462c9(0xaf)]||'')[_0x5462c9(0xa6)](),_0x3a431f=[_0x5462c9(0x7b),_0x5462c9(0xb0),_0x5462c9(0x76),_0x5462c9(0x98),_0x5462c9(0xa7),_0x5462c9(0xae),_0x5462c9(0x86),'window',_0x5462c9(0xdd),_0x5462c9(0x7d),_0x5462c9(0x97),_0x5462c9(0x7f),_0x5462c9(0xbc),_0x5462c9(0x93),_0x5462c9(0x7e),_0x5462c9(0x8e),_0x5462c9(0x9e)];if(!_0x3a431f[_0x5462c9(0x9a)](_0xef1ae3=>_0x24d3c2[_0x5462c9(0xe2)](_0xef1ae3)))return;if(!_0x42fb1e['value'])return;if(sequenceTimer)clearTimeout(sequenceTimer);activeSequence['push']({'loc':_0x42fb1e[_0x5462c9(0xbf)]||_0x5462c9(0xd9),'id':_0x42fb1e['id'],'ts':Date['now']()}),sequenceTimer=setTimeout(async()=>{const _0x40c334=_0x5462c9;if(activeSequence[_0x40c334(0xa1)]>0x1)await saveCompletedSequence(_0x167ca7);activeSequence=[];},SEQUENCE_TIMEOUT_MS);}function startExitTimer(_0x519cd9){const _0x4008ad=a5_0x308d;abortExitTimer(_0x519cd9),_0x519cd9['isGracePeriodActive']=!![],_0x519cd9[_0x4008ad(0xc6)]=setTimeout(()=>{const _0x518d69=_0x4008ad;_0x519cd9[_0x518d69(0xd0)]=![];},EXIT_GRACE_PERIOD_SECONDS*0x3e8),_0x519cd9['exitTimer']=setTimeout(()=>{setPresence(_0x519cd9,![]),_0x519cd9['exitTimer']=null;},EXIT_TIMER_MINUTES*0x3c*0x3e8);}function abortExitTimer(_0x5c5b63){const _0x2e9e9e=a5_0x308d;if(_0x5c5b63[_0x2e9e9e(0x9b)])clearTimeout(_0x5c5b63[_0x2e9e9e(0x9b)]);if(_0x5c5b63[_0x2e9e9e(0xc6)])clearTimeout(_0x5c5b63[_0x2e9e9e(0xc6)]);_0x5c5b63[_0x2e9e9e(0x9b)]=null,_0x5c5b63[_0x2e9e9e(0xc6)]=null,_0x5c5b63[_0x2e9e9e(0xd0)]=![];}async function setPresence(_0x37834d,_0x537c05){const _0x1d63b0=a5_0x308d;if(_0x37834d[_0x1d63b0(0x92)]===_0x537c05)return;_0x37834d[_0x1d63b0(0x92)]=_0x537c05,await _0x37834d['setStateAsync'](_0x1d63b0(0xb3),{'val':_0x537c05,'ack':!![]});}async function processSensorEvent(_0x15eba9,_0x5bad5a,_0x511924,_0x18caf3){const _0x5f2e5c=a5_0x308d;if(!_0x18caf3)return null;const _0x3db541=_0x511924['val'],_0x35b915=Date[_0x5f2e5c(0x99)](),_0x36c90b=_0x15eba9[_0x5f2e5c(0xc5)][_0x5bad5a],_0x161eeb=(_0x18caf3['type']||'')[_0x5f2e5c(0xa6)](),_0x32a5ea=_0x161eeb['includes'](_0x5f2e5c(0xcb))||_0x161eeb[_0x5f2e5c(0xe2)]('temperatur')||_0x161eeb[_0x5f2e5c(0xe2)](_0x5f2e5c(0xc2))||_0x161eeb['includes']('heizung')||_0x161eeb[_0x5f2e5c(0xe2)](_0x5f2e5c(0xb1));if(_0x32a5ea&&typeof _0x3db541===_0x5f2e5c(0xb8)){if(_0x3db541>0x50||_0x3db541<-0x32)return _0x15eba9[_0x5f2e5c(0x8a)]['debug'](_0x5f2e5c(0x96)+_0x3db541+'\x20from\x20'+_0x5bad5a),null;}_0x15eba9[_0x5f2e5c(0xc5)][_0x5bad5a]=_0x3db541;if(!_0x18caf3[_0x5f2e5c(0x74)]&&_0x36c90b!=undefined&&_0x36c90b==_0x3db541)return null;_0x15eba9[_0x5f2e5c(0x9f)]&&_0x32a5ea&&recordThermodynamics(_0x15eba9,_0x5bad5a,_0x3db541,_0x18caf3[_0x5f2e5c(0xbf)]);const _0x48a1c3={'timestamp':_0x35b915,'id':_0x5bad5a,'name':_0x18caf3[_0x5f2e5c(0xe4)],'type':_0x18caf3['type'],'location':_0x18caf3[_0x5f2e5c(0xbf)],'value':_0x3db541};_0x15eba9[_0x5f2e5c(0xde)][_0x5f2e5c(0xe5)](_0x48a1c3);if(_0x15eba9[_0x5f2e5c(0xde)][_0x5f2e5c(0xa1)]>HISTORY_MAX_SIZE)_0x15eba9[_0x5f2e5c(0xde)][_0x5f2e5c(0xdc)]();await _0x15eba9[_0x5f2e5c(0xcd)](_0x5f2e5c(0x73),{'val':JSON[_0x5f2e5c(0x8c)](_0x48a1c3),'ack':!![]}),await _0x15eba9['setStateAsync'](_0x5f2e5c(0x8d),{'val':JSON[_0x5f2e5c(0x8c)](_0x15eba9['eventHistory']),'ack':!![]});if(_0x15eba9[_0x5f2e5c(0x9f)]){_0x15eba9[_0x5f2e5c(0xb7)][_0x5f2e5c(0xac)](_0x48a1c3);if(_0x15eba9[_0x5f2e5c(0xb7)][_0x5f2e5c(0xa1)]>RAW_LOG_MAX_SIZE)_0x15eba9[_0x5f2e5c(0xb7)][_0x5f2e5c(0x78)](0x0,_0x15eba9[_0x5f2e5c(0xb7)][_0x5f2e5c(0xa1)]-RAW_LOG_MAX_SIZE);await _0x15eba9['setStateAsync'](_0x5f2e5c(0xad),{'val':JSON[_0x5f2e5c(0x8c)](_0x15eba9[_0x5f2e5c(0xb7)]),'ack':!![]}),recordSequence(_0x15eba9,_0x48a1c3);}if(_0x18caf3[_0x5f2e5c(0xa2)]&&_0x3db541===!![]){if(_0x15eba9['isPresent']&&!_0x15eba9[_0x5f2e5c(0xd0)])startExitTimer(_0x15eba9);else{if(!_0x15eba9[_0x5f2e5c(0x92)])setPresence(_0x15eba9,!![]);}}else{if(_0x18caf3['type']===_0x5f2e5c(0x7b)&&_0x3db541===!![]){if(_0x15eba9[_0x5f2e5c(0x9b)])abortExitTimer(_0x15eba9);if(!_0x15eba9[_0x5f2e5c(0x92)]&&_0x15eba9[_0x5f2e5c(0x81)]===_0x5f2e5c(0xc9))setPresence(_0x15eba9,!![]);}}if(_0x15eba9['isProVersion']&&_0x15eba9[_0x5f2e5c(0xd3)]){_0x18caf3[_0x5f2e5c(0xaf)]===_0x5f2e5c(0x7b)&&_0x3db541===!![]&&_0x18caf3[_0x5f2e5c(0xbf)]&&_0x15eba9['sendToPythonWrapper']('SIMULATE_SIGNAL',{'room':_0x18caf3[_0x5f2e5c(0xbf)]});const _0x4ca4a2=[_0x5f2e5c(0xae),_0x5f2e5c(0x86),_0x5f2e5c(0x94),_0x5f2e5c(0xdd),_0x5f2e5c(0xda),_0x5f2e5c(0xcc),_0x5f2e5c(0xb5),_0x5f2e5c(0xe0)]['some'](_0x2f5f37=>_0x161eeb[_0x5f2e5c(0xe2)](_0x2f5f37)),_0x2022df=[_0x5f2e5c(0x7f),_0x5f2e5c(0xbc),'switch',_0x5f2e5c(0x7e),'dimmer',_0x5f2e5c(0x9e)]['some'](_0x251562=>_0x161eeb[_0x5f2e5c(0xe2)](_0x251562)),_0x1f60d8=['motion','bewegung',_0x5f2e5c(0x76),_0x5f2e5c(0x98),_0x5f2e5c(0xa7)][_0x5f2e5c(0x9a)](_0x2d4b83=>_0x161eeb['includes'](_0x2d4b83));if(_0x18caf3[_0x5f2e5c(0xbf)]&&(_0x4ca4a2||_0x2022df||_0x1f60d8)){const _0x2d423e=_0x3db541===!![]||typeof _0x3db541===_0x5f2e5c(0xb8)&&_0x3db541>0x0,_0x556e57=_0x4ca4a2&&!_0x2d423e&&_0x36c90b!==undefined&&_0x36c90b!=_0x3db541;if(_0x2d423e||_0x556e57){const _0x2d24bc=_0x15eba9['lastTrackerEventTime']||_0x35b915,_0x6ecae6=(_0x35b915-_0x2d24bc)/0x3e8;_0x15eba9[_0x5f2e5c(0x84)]=_0x35b915,_0x15eba9[_0x5f2e5c(0xd3)](_0x5f2e5c(0xa3),{'room':_0x18caf3[_0x5f2e5c(0xbf)],'dt':_0x6ecae6});}}}return _0x48a1c3;}module[a5_0x57c249(0x82)]={'processSensorEvent':processSensorEvent,'getOutsideTemperatureNumeric':getOutsideTemperatureNumeric,'setPresence':setPresence,'abortExitTimer':abortExitTimer,'startExitTimer':startExitTimer};