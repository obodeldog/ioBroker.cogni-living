const a4_0x347007=a4_0xf17e;(function(_0x1e5b1c,_0x3df83f){const _0xa3748f=a4_0xf17e,_0x294271=_0x1e5b1c();while(!![]){try{const _0x38b87e=-parseInt(_0xa3748f(0x107))/0x1+-parseInt(_0xa3748f(0x125))/0x2+parseInt(_0xa3748f(0x103))/0x3*(-parseInt(_0xa3748f(0x11f))/0x4)+-parseInt(_0xa3748f(0x12a))/0x5+-parseInt(_0xa3748f(0x143))/0x6*(-parseInt(_0xa3748f(0x10b))/0x7)+-parseInt(_0xa3748f(0x112))/0x8*(-parseInt(_0xa3748f(0x111))/0x9)+parseInt(_0xa3748f(0x144))/0xa;if(_0x38b87e===_0x3df83f)break;else _0x294271['push'](_0x294271['shift']());}catch(_0x310fe7){_0x294271['push'](_0x294271['shift']());}}}(a4_0x495c,0x19928));const a4_0x59526b=(function(){let _0x4a7bb0=!![];return function(_0x5a8cf5,_0x317144){const _0x10e37b=_0x4a7bb0?function(){if(_0x317144){const _0x27377f=_0x317144['apply'](_0x5a8cf5,arguments);return _0x317144=null,_0x27377f;}}:function(){};return _0x4a7bb0=![],_0x10e37b;};}()),a4_0x473041=a4_0x59526b(this,function(){const _0x28c41a=a4_0xf17e;return a4_0x473041['toString']()[_0x28c41a(0x130)](_0x28c41a(0x12f))[_0x28c41a(0x151)]()[_0x28c41a(0x14a)](a4_0x473041)[_0x28c41a(0x130)](_0x28c41a(0x12f));});a4_0x473041();'use strict';const HISTORY_MAX_SIZE=0x32,RAW_LOG_MAX_SIZE=0x9c4,THERMO_LOG_SIZE=0x3e8,SEQUENCE_TIMEOUT_MS=0x5*0x3c*0x3e8,MAX_TRAINING_SET_SIZE=0x1f4,EXIT_TIMER_MINUTES=0xf,EXIT_GRACE_PERIOD_SECONDS=0x1e;let activeSequence=[],sequenceTimer=null;async function getOutsideTemperatureNumeric(_0x5a4ef9){const _0x245d6f=a4_0xf17e;if(_0x5a4ef9[_0x245d6f(0x13e)]['outdoorSensorId'])try{const _0x3a249b=await _0x5a4ef9[_0x245d6f(0x126)](_0x5a4ef9[_0x245d6f(0x13e)][_0x245d6f(0x132)]);if(_0x3a249b&&_0x3a249b[_0x245d6f(0x138)]!==undefined&&_0x3a249b[_0x245d6f(0x138)]!==null)return parseFloat(_0x3a249b[_0x245d6f(0x138)]);}catch(_0x21a9ea){}const _0x57c5e8=_0x5a4ef9[_0x245d6f(0x13e)][_0x245d6f(0x140)];if(!_0x5a4ef9[_0x245d6f(0x13e)][_0x245d6f(0x129)]||!_0x57c5e8)return null;try{let _0x4aa996='';if(_0x57c5e8['includes']('accuweather'))_0x4aa996=_0x57c5e8+_0x245d6f(0x10c);else{if(_0x57c5e8[_0x245d6f(0x137)]('daswetter'))_0x4aa996=_0x57c5e8+'.NextHours.Location_1.Day_1.current.temp_value';else{if(_0x57c5e8[_0x245d6f(0x137)](_0x245d6f(0x120)))_0x4aa996=_0x57c5e8+_0x245d6f(0x11b);else{if(_0x57c5e8[_0x245d6f(0x137)](_0x245d6f(0x135)))_0x4aa996=_0x57c5e8+_0x245d6f(0x10d);}}}if(_0x4aa996){const _0x265179=await _0x5a4ef9[_0x245d6f(0x126)](_0x4aa996);if(_0x265179&&_0x265179[_0x245d6f(0x138)]!==undefined&&_0x265179[_0x245d6f(0x138)]!==null)return parseFloat(_0x265179['val']);}}catch(_0x3ce6ac){}return null;}async function recordThermodynamics(_0x253501,_0x11222d,_0x17e664,_0x5cb510){const _0x41a7a5=a4_0xf17e,_0x4b55b4=await getOutsideTemperatureNumeric(_0x253501),_0x347c6f=await _0x253501['getStateAsync'](_0x41a7a5(0x116));let _0x451ed4=[];if(_0x347c6f&&_0x347c6f[_0x41a7a5(0x138)])try{_0x451ed4=JSON[_0x41a7a5(0x10a)](_0x347c6f[_0x41a7a5(0x138)]);}catch(_0x3ba7d2){}_0x451ed4[_0x41a7a5(0x11e)]({'ts':Date[_0x41a7a5(0x124)](),'room':_0x5cb510||'Unknown','t_in':_0x17e664,'t_out':_0x4b55b4});if(_0x451ed4[_0x41a7a5(0x115)]>THERMO_LOG_SIZE)_0x451ed4['shift']();await _0x253501[_0x41a7a5(0x11c)](_0x41a7a5(0x116),{'val':JSON[_0x41a7a5(0x128)](_0x451ed4),'ack':!![]});}async function saveCompletedSequence(_0x5b5219){const _0xd4f1a3=a4_0xf17e;try{const _0x1b96a1=await _0x5b5219['getStateAsync'](_0xd4f1a3(0x114));let _0x4aee53=[];if(_0x1b96a1&&_0x1b96a1[_0xd4f1a3(0x138)])try{_0x4aee53=JSON[_0xd4f1a3(0x10a)](_0x1b96a1[_0xd4f1a3(0x138)]);}catch(_0x251aa2){}const _0x4ba632=activeSequence[0x0]['ts'],_0x3f9af6=activeSequence[_0xd4f1a3(0x14c)](_0x3c3237=>({'loc':_0x3c3237[_0xd4f1a3(0x148)],'t_delta':Math['round']((_0x3c3237['ts']-_0x4ba632)/0x3e8)})),_0x5e2114={'timestamp':new Date(_0x4ba632)[_0xd4f1a3(0x117)](),'steps':_0x3f9af6,'duration':Math[_0xd4f1a3(0x152)]((activeSequence[activeSequence[_0xd4f1a3(0x115)]-0x1]['ts']-_0x4ba632)/0x3e8),'daytime':new Date(_0x4ba632)['getHours']()};_0x4aee53[_0xd4f1a3(0x11e)](_0x5e2114);if(_0x4aee53[_0xd4f1a3(0x115)]>MAX_TRAINING_SET_SIZE)_0x4aee53[_0xd4f1a3(0x127)]();await _0x5b5219[_0xd4f1a3(0x11c)]('LTM.trainingData.sequences',{'val':JSON[_0xd4f1a3(0x128)](_0x4aee53),'ack':!![]}),_0x5b5219[_0xd4f1a3(0x14b)]&&_0x5b5219[_0xd4f1a3(0x134)]&&_0x5b5219[_0xd4f1a3(0x134)](_0xd4f1a3(0x139),{'sequence':_0x5e2114});}catch(_0x368b88){_0x5b5219[_0xd4f1a3(0x146)][_0xd4f1a3(0x104)]('[RECORDER]\x20Error:\x20'+_0x368b88[_0xd4f1a3(0x145)]);}}async function recordSequence(_0x405303,_0x35eb83){const _0x5d3531=a4_0xf17e,_0x2c5dab=(_0x35eb83[_0x5d3531(0x147)]||'')[_0x5d3531(0x13b)](),_0x1546a6=[_0x5d3531(0x113),'bewegung','präsenz',_0x5d3531(0x13f),_0x5d3531(0x14f),_0x5d3531(0x12b),_0x5d3531(0x149),'window','fenster','contact',_0x5d3531(0x10f),_0x5d3531(0x136),_0x5d3531(0x141),_0x5d3531(0x11a),'schalter',_0x5d3531(0x10e),_0x5d3531(0x110)];if(!_0x1546a6[_0x5d3531(0x106)](_0x475267=>_0x2c5dab['includes'](_0x475267)))return;if(!_0x35eb83[_0x5d3531(0x13c)])return;if(sequenceTimer)clearTimeout(sequenceTimer);activeSequence[_0x5d3531(0x11e)]({'loc':_0x35eb83[_0x5d3531(0x133)]||'Unknown','id':_0x35eb83['id'],'ts':Date[_0x5d3531(0x124)]()}),sequenceTimer=setTimeout(async()=>{if(activeSequence['length']>0x1)await saveCompletedSequence(_0x405303);activeSequence=[];},SEQUENCE_TIMEOUT_MS);}function startExitTimer(_0x167e5a){const _0x3c2ed4=a4_0xf17e;abortExitTimer(_0x167e5a),_0x167e5a[_0x3c2ed4(0x14e)]=!![],_0x167e5a[_0x3c2ed4(0x131)]=setTimeout(()=>{_0x167e5a['isGracePeriodActive']=![];},EXIT_GRACE_PERIOD_SECONDS*0x3e8),_0x167e5a[_0x3c2ed4(0x108)]=setTimeout(()=>{const _0x2819fc=_0x3c2ed4;setPresence(_0x167e5a,![]),_0x167e5a[_0x2819fc(0x108)]=null;},EXIT_TIMER_MINUTES*0x3c*0x3e8);}function abortExitTimer(_0x5e0fd3){const _0x53d7df=a4_0xf17e;if(_0x5e0fd3['exitTimer'])clearTimeout(_0x5e0fd3[_0x53d7df(0x108)]);if(_0x5e0fd3[_0x53d7df(0x131)])clearTimeout(_0x5e0fd3[_0x53d7df(0x131)]);_0x5e0fd3[_0x53d7df(0x108)]=null,_0x5e0fd3[_0x53d7df(0x131)]=null,_0x5e0fd3['isGracePeriodActive']=![];}async function setPresence(_0x2478bc,_0xef0b6d){const _0x433f61=a4_0xf17e;if(_0x2478bc['isPresent']===_0xef0b6d)return;_0x2478bc['isPresent']=_0xef0b6d,await _0x2478bc[_0x433f61(0x11c)](_0x433f61(0x118),{'val':_0xef0b6d,'ack':!![]});}function a4_0xf17e(_0x3acf9c,_0xad24be){const _0x5c8af0=a4_0x495c();return a4_0xf17e=function(_0x473041,_0x59526b){_0x473041=_0x473041-0x103;let _0x495c1d=_0x5c8af0[_0x473041];return _0x495c1d;},a4_0xf17e(_0x3acf9c,_0xad24be);}async function processSensorEvent(_0x2d8d7d,_0x24e11a,_0x359c02,_0x33b39f){const _0x8a28d1=a4_0xf17e;if(!_0x33b39f)return;const _0x539550=_0x359c02[_0x8a28d1(0x138)],_0x4eb98d=Date[_0x8a28d1(0x124)](),_0x471025=_0x2d8d7d[_0x8a28d1(0x12d)][_0x24e11a];_0x2d8d7d[_0x8a28d1(0x12d)][_0x24e11a]=_0x539550;if(!_0x33b39f['logDuplicates']&&_0x471025!=undefined&&_0x471025==_0x539550)return;const _0x52b77c=(_0x33b39f[_0x8a28d1(0x147)]||'')[_0x8a28d1(0x13b)](),_0x102391=_0x52b77c[_0x8a28d1(0x137)](_0x8a28d1(0x105))||_0x52b77c[_0x8a28d1(0x137)](_0x8a28d1(0x142))||_0x52b77c[_0x8a28d1(0x137)]('klima')||_0x52b77c[_0x8a28d1(0x137)](_0x8a28d1(0x13a));_0x2d8d7d['isProVersion']&&_0x102391&&recordThermodynamics(_0x2d8d7d,_0x24e11a,_0x539550,_0x33b39f[_0x8a28d1(0x133)]);const _0x2c45b7={'timestamp':_0x4eb98d,'id':_0x24e11a,'name':_0x33b39f['name'],'type':_0x33b39f[_0x8a28d1(0x147)],'location':_0x33b39f['location'],'value':_0x539550};_0x2d8d7d[_0x8a28d1(0x12c)][_0x8a28d1(0x150)](_0x2c45b7);if(_0x2d8d7d[_0x8a28d1(0x12c)]['length']>HISTORY_MAX_SIZE)_0x2d8d7d[_0x8a28d1(0x12c)][_0x8a28d1(0x12e)]();await _0x2d8d7d[_0x8a28d1(0x11c)]('events.lastEvent',{'val':JSON[_0x8a28d1(0x128)](_0x2c45b7),'ack':!![]}),await _0x2d8d7d[_0x8a28d1(0x11c)](_0x8a28d1(0x119),{'val':JSON['stringify'](_0x2d8d7d[_0x8a28d1(0x12c)]),'ack':!![]});if(_0x2d8d7d[_0x8a28d1(0x14b)]){_0x2d8d7d[_0x8a28d1(0x121)][_0x8a28d1(0x11e)](_0x2c45b7);if(_0x2d8d7d[_0x8a28d1(0x121)][_0x8a28d1(0x115)]>RAW_LOG_MAX_SIZE)_0x2d8d7d[_0x8a28d1(0x121)][_0x8a28d1(0x13d)](0x0,_0x2d8d7d['rawEventLog'][_0x8a28d1(0x115)]-RAW_LOG_MAX_SIZE);await _0x2d8d7d[_0x8a28d1(0x11c)]('LTM.rawEventLog',{'val':JSON[_0x8a28d1(0x128)](_0x2d8d7d[_0x8a28d1(0x121)]),'ack':!![]}),recordSequence(_0x2d8d7d,_0x2c45b7);}if(_0x33b39f[_0x8a28d1(0x122)]&&_0x539550===!![]){if(_0x2d8d7d['isPresent']&&!_0x2d8d7d['isGracePeriodActive'])startExitTimer(_0x2d8d7d);else{if(!_0x2d8d7d[_0x8a28d1(0x11d)])setPresence(_0x2d8d7d,!![]);}}else{if(_0x33b39f[_0x8a28d1(0x147)]==='motion'&&_0x539550===!![]){if(_0x2d8d7d[_0x8a28d1(0x108)])abortExitTimer(_0x2d8d7d);if(!_0x2d8d7d['isPresent']&&_0x2d8d7d['currentSystemMode']===_0x8a28d1(0x109))setPresence(_0x2d8d7d,!![]);}}_0x2d8d7d[_0x8a28d1(0x14b)]&&_0x33b39f[_0x8a28d1(0x147)]===_0x8a28d1(0x113)&&_0x539550===!![]&&_0x33b39f[_0x8a28d1(0x133)]&&_0x2d8d7d[_0x8a28d1(0x134)]&&_0x2d8d7d[_0x8a28d1(0x134)](_0x8a28d1(0x14d),{'room':_0x33b39f[_0x8a28d1(0x133)]});}function a4_0x495c(){const _0x74d7df=['message','log','type','loc','tür','constructor','isProVersion','map','SIMULATE_SIGNAL','isGracePeriodActive','occupancy','unshift','toString','round','9AYbIQf','error','temperature','some','112841hjZvYM','exitTimer','normal','parse','545006copFID','.Current.Temperature','.forecast.current.temp','dimmer','kontakt','lampe','567855ykhsLJ','16Qcyzfw','motion','LTM.trainingData.sequences','length','LTM.trainingData.thermodynamics','toISOString','system.isPresent','events.history','switch','.forecast.current.temperature','setStateAsync','isPresent','push','247004IeetuY','openweathermap','rawEventLog','isExit','exports','now','108920rQrfiy','getForeignStateAsync','shift','stringify','useWeather','7445OrWUZo','door','eventHistory','sensorLastValues','pop','(((.+)+)+)+$','search','exitGraceTimer','outdoorSensorId','location','sendToPythonWrapper','weatherunderground','light','includes','val','ANALYZE_SEQUENCE','heizung','toLowerCase','value','splice','config','presence','weatherInstance','licht','temperatur','12ipwkaa','1768810RutXGA'];a4_0x495c=function(){return _0x74d7df;};return a4_0x495c();}module[a4_0x347007(0x123)]={'processSensorEvent':processSensorEvent,'getOutsideTemperatureNumeric':getOutsideTemperatureNumeric,'setPresence':setPresence,'abortExitTimer':abortExitTimer,'startExitTimer':startExitTimer};