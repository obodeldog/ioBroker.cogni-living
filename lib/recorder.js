(function(_0x4982e4,_0x104de1){const _0x2e5495=a5_0x2e48,_0xa2f131=_0x4982e4();while(!![]){try{const _0x51aeaf=-parseInt(_0x2e5495(0x1ec))/0x1*(parseInt(_0x2e5495(0x23e))/0x2)+parseInt(_0x2e5495(0x230))/0x3*(parseInt(_0x2e5495(0x1f4))/0x4)+parseInt(_0x2e5495(0x21b))/0x5+parseInt(_0x2e5495(0x22b))/0x6*(parseInt(_0x2e5495(0x1fe))/0x7)+-parseInt(_0x2e5495(0x1f3))/0x8*(parseInt(_0x2e5495(0x24b))/0x9)+-parseInt(_0x2e5495(0x24e))/0xa+-parseInt(_0x2e5495(0x218))/0xb*(parseInt(_0x2e5495(0x1f6))/0xc);if(_0x51aeaf===_0x104de1)break;else _0xa2f131['push'](_0xa2f131['shift']());}catch(_0x59f58a){_0xa2f131['push'](_0xa2f131['shift']());}}}(a5_0x305b,0x99824));const a5_0x51c8fa=(function(){let _0x11a566=!![];return function(_0x5a3ebb,_0x1fa079){const _0x1779f2=_0x11a566?function(){const _0x420480=a5_0x2e48;if(_0x1fa079){const _0x9ab004=_0x1fa079[_0x420480(0x246)](_0x5a3ebb,arguments);return _0x1fa079=null,_0x9ab004;}}:function(){};return _0x11a566=![],_0x1779f2;};}()),a5_0x8df8a5=a5_0x51c8fa(this,function(){const _0x3d201c=a5_0x2e48;return a5_0x8df8a5[_0x3d201c(0x231)]()[_0x3d201c(0x234)](_0x3d201c(0x227))['toString']()[_0x3d201c(0x1ee)](a5_0x8df8a5)[_0x3d201c(0x234)](_0x3d201c(0x227));});a5_0x8df8a5();'use strict';const HISTORY_MAX_SIZE=0x32,RAW_LOG_MAX_SIZE=0x9c4,THERMO_LOG_SIZE=0x3e8,SEQUENCE_TIMEOUT_MS=0x5*0x3c*0x3e8,MAX_TRAINING_SET_SIZE=0x1f4,EXIT_TIMER_MINUTES=0xf,EXIT_GRACE_PERIOD_SECONDS=0x1e;let activeSequence=[],sequenceTimer=null;async function getOutsideTemperatureNumeric(_0x1d4e19){const _0x4e20bb=a5_0x2e48;if(_0x1d4e19['config'][_0x4e20bb(0x248)])try{const _0x21df97=await _0x1d4e19[_0x4e20bb(0x217)](_0x1d4e19[_0x4e20bb(0x1f5)][_0x4e20bb(0x248)]);if(_0x21df97&&_0x21df97[_0x4e20bb(0x214)]!==undefined&&_0x21df97[_0x4e20bb(0x214)]!==null)return parseFloat(_0x21df97[_0x4e20bb(0x214)]);}catch(_0x327c02){}const _0x3e66e6=_0x1d4e19[_0x4e20bb(0x1f5)]['weatherInstance'];if(!_0x1d4e19['config'][_0x4e20bb(0x251)]||!_0x3e66e6)return null;try{let _0x529756='';if(_0x3e66e6[_0x4e20bb(0x209)](_0x4e20bb(0x1f2)))_0x529756=_0x3e66e6+_0x4e20bb(0x20f);else{if(_0x3e66e6[_0x4e20bb(0x209)]('daswetter'))_0x529756=_0x3e66e6+'.NextHours.Location_1.Day_1.current.temp_value';else{if(_0x3e66e6[_0x4e20bb(0x209)](_0x4e20bb(0x233)))_0x529756=_0x3e66e6+_0x4e20bb(0x253);else{if(_0x3e66e6['includes'](_0x4e20bb(0x22c)))_0x529756=_0x3e66e6+'.forecast.current.temp';}}}if(_0x529756){const _0x41192f=await _0x1d4e19[_0x4e20bb(0x217)](_0x529756);if(_0x41192f&&_0x41192f[_0x4e20bb(0x214)]!==undefined&&_0x41192f['val']!==null)return parseFloat(_0x41192f[_0x4e20bb(0x214)]);}}catch(_0x44ae81){}return null;}async function recordThermodynamics(_0x2d839b,_0x984861,_0x3fb84c,_0x255287){const _0x354a8e=a5_0x2e48,_0x5c32db=await getOutsideTemperatureNumeric(_0x2d839b);if(_0x5c32db===null)return;let _0x1a2c7b=0x0,_0x50669a=![];if(_0x2d839b[_0x354a8e(0x1f5)]['valveMapping'])try{let _0x13cdeb=_0x2d839b[_0x354a8e(0x1f5)][_0x354a8e(0x205)];if(typeof _0x13cdeb===_0x354a8e(0x1ff))_0x13cdeb=JSON[_0x354a8e(0x20e)](_0x13cdeb);if(_0x13cdeb[_0x984861]){const _0x209d3a=_0x13cdeb[_0x984861],_0x2abb2c=await _0x2d839b['getForeignStateAsync'](_0x209d3a);if(_0x2abb2c&&_0x2abb2c[_0x354a8e(0x214)]!==null&&_0x2abb2c[_0x354a8e(0x214)]!==undefined){let _0x3b047e=Number(_0x2abb2c['val']);if(_0x3b047e<=1.05&&!_0x209d3a[_0x354a8e(0x209)]('STATUS')&&!_0x209d3a['includes']('STATE'))_0x3b047e=_0x3b047e*0x64;_0x1a2c7b=Math[_0x354a8e(0x1ef)](_0x3b047e),_0x50669a=!![];}}}catch(_0x1f7858){}if(!_0x50669a){const _0x10728f=[{'from':_0x354a8e(0x235),'to':_0x354a8e(0x23b)},{'from':_0x354a8e(0x235),'to':'.1.VALVE_STATE'},{'from':_0x354a8e(0x21d),'to':_0x354a8e(0x20c)},{'from':_0x354a8e(0x23c),'to':_0x354a8e(0x239)},{'from':'temperature','to':'level'},{'from':_0x354a8e(0x204),'to':_0x354a8e(0x242)}];for(const _0x40a6e1 of _0x10728f){if(_0x984861[_0x354a8e(0x209)](_0x40a6e1['from'])){const _0x13de20=_0x984861[_0x354a8e(0x22f)](_0x40a6e1[_0x354a8e(0x224)],_0x40a6e1['to']);try{const _0x50fd4b=await _0x2d839b[_0x354a8e(0x217)](_0x13de20);if(_0x50fd4b&&_0x50fd4b['val']!==null&&_0x50fd4b[_0x354a8e(0x214)]!==undefined){let _0x539699=Number(_0x50fd4b[_0x354a8e(0x214)]);if(typeof _0x539699===_0x354a8e(0x243)){if(_0x539699<=1.05&&_0x40a6e1['to'][_0x354a8e(0x209)](_0x354a8e(0x1fc)))_0x539699=_0x539699*0x64;_0x1a2c7b=Math[_0x354a8e(0x1ef)](_0x539699),_0x50669a=!![];break;}}}catch(_0xa71ce){}}}}const _0x376e2b=await _0x2d839b[_0x354a8e(0x244)](_0x354a8e(0x20d));let _0x123e4b=[];if(_0x376e2b&&_0x376e2b[_0x354a8e(0x214)])try{_0x123e4b=JSON[_0x354a8e(0x20e)](_0x376e2b[_0x354a8e(0x214)]);}catch(_0x3d3f6c){}_0x123e4b['push']({'ts':Date['now'](),'room':_0x255287||_0x354a8e(0x219),'t_in':_0x3fb84c,'t_out':_0x5c32db,'valve':_0x1a2c7b});if(_0x123e4b['length']>THERMO_LOG_SIZE)_0x123e4b['shift']();await _0x2d839b[_0x354a8e(0x23f)](_0x354a8e(0x20d),{'val':JSON['stringify'](_0x123e4b),'ack':!![]});}function a5_0x2e48(_0x56fcf3,_0x5a3e14){const _0x14f853=a5_0x305b();return a5_0x2e48=function(_0x8df8a5,_0x51c8fa){_0x8df8a5=_0x8df8a5-0x1ec;let _0x305ba6=_0x14f853[_0x8df8a5];return _0x305ba6;},a5_0x2e48(_0x56fcf3,_0x5a3e14);}async function saveCompletedSequence(_0xb3f70e){const _0x13a65d=a5_0x2e48;try{const _0x50aebf=await _0xb3f70e['getStateAsync'](_0x13a65d(0x21e));let _0x25e24e=[];if(_0x50aebf&&_0x50aebf[_0x13a65d(0x214)])try{_0x25e24e=JSON[_0x13a65d(0x20e)](_0x50aebf[_0x13a65d(0x214)]);}catch(_0x5643ec){}const _0x4a8b81=activeSequence[0x0]['ts'],_0x3e558f=activeSequence[_0x13a65d(0x212)](_0x282ee3=>({'loc':_0x282ee3[_0x13a65d(0x202)],'t_delta':Math['round']((_0x282ee3['ts']-_0x4a8b81)/0x3e8)})),_0x18bb70={'timestamp':new Date(_0x4a8b81)['toISOString'](),'steps':_0x3e558f,'duration':Math['round']((activeSequence[activeSequence[_0x13a65d(0x1f0)]-0x1]['ts']-_0x4a8b81)/0x3e8),'daytime':new Date(_0x4a8b81)[_0x13a65d(0x24a)]()};_0x25e24e['push'](_0x18bb70);if(_0x25e24e[_0x13a65d(0x1f0)]>MAX_TRAINING_SET_SIZE)_0x25e24e['shift']();await _0xb3f70e[_0x13a65d(0x23f)](_0x13a65d(0x21e),{'val':JSON[_0x13a65d(0x213)](_0x25e24e),'ack':!![]}),_0xb3f70e[_0x13a65d(0x203)]&&_0xb3f70e['sendToPythonWrapper']&&_0xb3f70e[_0x13a65d(0x208)](_0x13a65d(0x23a),{'sequence':_0x18bb70});}catch(_0x44da74){_0xb3f70e['log'][_0x13a65d(0x22a)](_0x13a65d(0x21a)+_0x44da74['message']);}}async function recordSequence(_0x37d43d,_0xf3c59f){const _0x280493=a5_0x2e48,_0x1a40d7=(_0xf3c59f[_0x280493(0x22e)]||'')[_0x280493(0x223)](),_0x16957a=['motion',_0x280493(0x247),_0x280493(0x1ed),_0x280493(0x1fb),_0x280493(0x21f),_0x280493(0x1fd),_0x280493(0x24c),_0x280493(0x229),'fenster','contact',_0x280493(0x206),_0x280493(0x22d),_0x280493(0x252),'switch',_0x280493(0x236),_0x280493(0x225),_0x280493(0x220)];if(!_0x16957a[_0x280493(0x211)](_0x3ac5e0=>_0x1a40d7['includes'](_0x3ac5e0)))return;if(!_0xf3c59f[_0x280493(0x1f8)])return;if(sequenceTimer)clearTimeout(sequenceTimer);activeSequence[_0x280493(0x200)]({'loc':_0xf3c59f['location']||_0x280493(0x219),'id':_0xf3c59f['id'],'ts':Date[_0x280493(0x250)]()}),sequenceTimer=setTimeout(async()=>{if(activeSequence['length']>0x1)await saveCompletedSequence(_0x37d43d);activeSequence=[];},SEQUENCE_TIMEOUT_MS);}function startExitTimer(_0x345dec){const _0x461141=a5_0x2e48;abortExitTimer(_0x345dec),_0x345dec['isGracePeriodActive']=!![],_0x345dec[_0x461141(0x201)]=setTimeout(()=>{_0x345dec['isGracePeriodActive']=![];},EXIT_GRACE_PERIOD_SECONDS*0x3e8),_0x345dec[_0x461141(0x238)]=setTimeout(()=>{setPresence(_0x345dec,![]),_0x345dec['exitTimer']=null;},EXIT_TIMER_MINUTES*0x3c*0x3e8);}function abortExitTimer(_0x3d5c55){const _0x47b92a=a5_0x2e48;if(_0x3d5c55[_0x47b92a(0x238)])clearTimeout(_0x3d5c55[_0x47b92a(0x238)]);if(_0x3d5c55[_0x47b92a(0x201)])clearTimeout(_0x3d5c55[_0x47b92a(0x201)]);_0x3d5c55[_0x47b92a(0x238)]=null,_0x3d5c55[_0x47b92a(0x201)]=null,_0x3d5c55['isGracePeriodActive']=![];}async function setPresence(_0x23f8d3,_0x5dc2a7){const _0x46fdcf=a5_0x2e48;if(_0x23f8d3[_0x46fdcf(0x21c)]===_0x5dc2a7)return;_0x23f8d3[_0x46fdcf(0x21c)]=_0x5dc2a7,await _0x23f8d3[_0x46fdcf(0x23f)](_0x46fdcf(0x245),{'val':_0x5dc2a7,'ack':!![]});}function a5_0x305b(){const _0x561278=['TRACK_EVENT','openweathermap','search','.1.ACTUAL_TEMPERATURE','schalter','splice','exitTimer','.LEVEL','ANALYZE_SEQUENCE','.1.LEVEL','.ACTUAL_TEMPERATURE','normal','2462ccHRFh','setStateAsync','isExit','isGracePeriodActive','Valve','number','getStateAsync','system.isPresent','apply','bewegung','outdoorSensorId','log','getHours','611109EnQpvj','tür','heizung','1608390nAzDLW','[RECORDER]\x20Ignored\x20implausible\x20temperature:\x20','now','useWeather','licht','.forecast.current.temperature','eventHistory','234osJNWC','präsenz','constructor','round','length','events.lastEvent','accuweather','40IXhYZA','16nVohXU','config','12bAVNgs','handle','value','LTM.rawEventLog','location','presence','LEVEL','door','28jliZxe','string','push','exitGraceTimer','loc','isProVersion','Temperature','valveMapping','kontakt','lastTrackerEventTime','sendToPythonWrapper','includes','SIMULATE_SIGNAL','motion','.4.VALVE_STATE','LTM.trainingData.thermodynamics','parse','.Current.Temperature','rawEventLog','some','map','stringify','val','schloss','logDuplicates','getForeignStateAsync','4885881wImutt','Unknown','[RECORDER]\x20Error:\x20','2901505adepuV','isPresent','.1.TEMPERATURE','LTM.trainingData.sequences','occupancy','lampe','thermostat','sensorLastValues','toLowerCase','from','dimmer','events.history','(((.+)+)+)+$','fenster','window','error','1607478FvLXEw','weatherunderground','light','type','replace','157041PcbwXK','toString'];a5_0x305b=function(){return _0x561278;};return a5_0x305b();}async function processSensorEvent(_0x5ee803,_0x11cc17,_0x4df58d,_0x157417){const _0x59c5cb=a5_0x2e48;if(!_0x157417)return null;const _0x33822e=_0x4df58d[_0x59c5cb(0x214)],_0x3480c6=Date['now'](),_0x2ca0f8=_0x5ee803['sensorLastValues'][_0x11cc17],_0x129fac=(_0x157417[_0x59c5cb(0x22e)]||'')[_0x59c5cb(0x223)](),_0x484452=_0x129fac[_0x59c5cb(0x209)]('temperature')||_0x129fac[_0x59c5cb(0x209)]('temperatur')||_0x129fac[_0x59c5cb(0x209)]('klima')||_0x129fac[_0x59c5cb(0x209)](_0x59c5cb(0x24d))||_0x129fac['includes'](_0x59c5cb(0x221));if(_0x484452&&typeof _0x33822e===_0x59c5cb(0x243)){if(_0x33822e>0x50||_0x33822e<-0x32)return _0x5ee803[_0x59c5cb(0x249)]['debug'](_0x59c5cb(0x24f)+_0x33822e+'\x20from\x20'+_0x11cc17),null;}_0x5ee803[_0x59c5cb(0x222)][_0x11cc17]=_0x33822e;if(!_0x157417[_0x59c5cb(0x216)]&&_0x2ca0f8!=undefined&&_0x2ca0f8==_0x33822e)return null;_0x5ee803[_0x59c5cb(0x203)]&&_0x484452&&recordThermodynamics(_0x5ee803,_0x11cc17,_0x33822e,_0x157417['location']);const _0x3163d5={'timestamp':_0x3480c6,'id':_0x11cc17,'name':_0x157417['name'],'type':_0x157417[_0x59c5cb(0x22e)],'location':_0x157417[_0x59c5cb(0x1fa)],'value':_0x33822e};_0x5ee803[_0x59c5cb(0x254)]['unshift'](_0x3163d5);if(_0x5ee803['eventHistory'][_0x59c5cb(0x1f0)]>HISTORY_MAX_SIZE)_0x5ee803['eventHistory']['pop']();await _0x5ee803[_0x59c5cb(0x23f)](_0x59c5cb(0x1f1),{'val':JSON[_0x59c5cb(0x213)](_0x3163d5),'ack':!![]}),await _0x5ee803[_0x59c5cb(0x23f)](_0x59c5cb(0x226),{'val':JSON[_0x59c5cb(0x213)](_0x5ee803[_0x59c5cb(0x254)]),'ack':!![]});if(_0x5ee803['isProVersion']){_0x5ee803[_0x59c5cb(0x210)]['push'](_0x3163d5);if(_0x5ee803[_0x59c5cb(0x210)][_0x59c5cb(0x1f0)]>RAW_LOG_MAX_SIZE)_0x5ee803[_0x59c5cb(0x210)][_0x59c5cb(0x237)](0x0,_0x5ee803[_0x59c5cb(0x210)][_0x59c5cb(0x1f0)]-RAW_LOG_MAX_SIZE);await _0x5ee803[_0x59c5cb(0x23f)](_0x59c5cb(0x1f9),{'val':JSON[_0x59c5cb(0x213)](_0x5ee803[_0x59c5cb(0x210)]),'ack':!![]}),recordSequence(_0x5ee803,_0x3163d5);}if(_0x157417[_0x59c5cb(0x240)]&&_0x33822e===!![]){if(_0x5ee803['isPresent']&&!_0x5ee803[_0x59c5cb(0x241)])startExitTimer(_0x5ee803);else{if(!_0x5ee803[_0x59c5cb(0x21c)])setPresence(_0x5ee803,!![]);}}else{if(_0x157417[_0x59c5cb(0x22e)]===_0x59c5cb(0x20b)&&_0x33822e===!![]){if(_0x5ee803[_0x59c5cb(0x238)])abortExitTimer(_0x5ee803);if(!_0x5ee803[_0x59c5cb(0x21c)]&&_0x5ee803['currentSystemMode']===_0x59c5cb(0x23d))setPresence(_0x5ee803,!![]);}}if(_0x5ee803[_0x59c5cb(0x203)]&&_0x5ee803[_0x59c5cb(0x208)]){_0x157417[_0x59c5cb(0x22e)]==='motion'&&_0x33822e===!![]&&_0x157417[_0x59c5cb(0x1fa)]&&_0x5ee803[_0x59c5cb(0x208)](_0x59c5cb(0x20a),{'room':_0x157417[_0x59c5cb(0x1fa)]});const _0x54d0b5=['door',_0x59c5cb(0x24c),_0x59c5cb(0x229),_0x59c5cb(0x228),'griff',_0x59c5cb(0x1f7),'lock',_0x59c5cb(0x215)]['some'](_0x33fe59=>_0x129fac['includes'](_0x33fe59)),_0x57fc98=['light','licht','switch',_0x59c5cb(0x236),_0x59c5cb(0x225),'lampe'][_0x59c5cb(0x211)](_0x138e0b=>_0x129fac[_0x59c5cb(0x209)](_0x138e0b)),_0x769277=[_0x59c5cb(0x20b),_0x59c5cb(0x247),_0x59c5cb(0x1ed),_0x59c5cb(0x1fb),_0x59c5cb(0x21f)][_0x59c5cb(0x211)](_0x1cbc9f=>_0x129fac[_0x59c5cb(0x209)](_0x1cbc9f));if(_0x157417[_0x59c5cb(0x1fa)]&&(_0x54d0b5||_0x57fc98||_0x769277)){const _0x344021=_0x33822e===!![]||typeof _0x33822e==='number'&&_0x33822e>0x0,_0x4d2c51=_0x54d0b5&&!_0x344021&&_0x2ca0f8!==undefined&&_0x2ca0f8!=_0x33822e;if(_0x344021||_0x4d2c51){const _0xc36bac=_0x5ee803['lastTrackerEventTime']||_0x3480c6,_0x9d75a=(_0x3480c6-_0xc36bac)/0x3e8;_0x5ee803[_0x59c5cb(0x207)]=_0x3480c6,_0x5ee803['sendToPythonWrapper'](_0x59c5cb(0x232),{'room':_0x157417[_0x59c5cb(0x1fa)],'dt':_0x9d75a});}}}return _0x3163d5;}module['exports']={'processSensorEvent':processSensorEvent,'getOutsideTemperatureNumeric':getOutsideTemperatureNumeric,'setPresence':setPresence,'abortExitTimer':abortExitTimer,'startExitTimer':startExitTimer};