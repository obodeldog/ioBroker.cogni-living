function a5_0x4613(_0x264db5,_0x8ad3ed){const _0x52f875=a5_0x3edd();return a5_0x4613=function(_0xc9cae3,_0x26c73f){_0xc9cae3=_0xc9cae3-0xca;let _0x3eddaf=_0x52f875[_0xc9cae3];return _0x3eddaf;},a5_0x4613(_0x264db5,_0x8ad3ed);}const a5_0x136430=a5_0x4613;(function(_0x84ab72,_0x1e0a7a){const _0xea0486=a5_0x4613,_0x2c2414=_0x84ab72();while(!![]){try{const _0x31dafe=parseInt(_0xea0486(0x125))/0x1*(-parseInt(_0xea0486(0xcc))/0x2)+-parseInt(_0xea0486(0x120))/0x3*(parseInt(_0xea0486(0xd4))/0x4)+parseInt(_0xea0486(0x105))/0x5*(-parseInt(_0xea0486(0xfc))/0x6)+parseInt(_0xea0486(0xfa))/0x7*(parseInt(_0xea0486(0xed))/0x8)+-parseInt(_0xea0486(0xe1))/0x9*(-parseInt(_0xea0486(0x103))/0xa)+parseInt(_0xea0486(0x110))/0xb+parseInt(_0xea0486(0xd2))/0xc*(parseInt(_0xea0486(0xe6))/0xd);if(_0x31dafe===_0x1e0a7a)break;else _0x2c2414['push'](_0x2c2414['shift']());}catch(_0x5bb253){_0x2c2414['push'](_0x2c2414['shift']());}}}(a5_0x3edd,0xb49f4));const a5_0x26c73f=(function(){let _0x28ddd0=!![];return function(_0xca70c8,_0x5bb17f){const _0x7ce801=_0x28ddd0?function(){const _0x2db9ba=a5_0x4613;if(_0x5bb17f){const _0x2e69c8=_0x5bb17f[_0x2db9ba(0xe7)](_0xca70c8,arguments);return _0x5bb17f=null,_0x2e69c8;}}:function(){};return _0x28ddd0=![],_0x7ce801;};}()),a5_0xc9cae3=a5_0x26c73f(this,function(){const _0x4f7ea7=a5_0x4613;return a5_0xc9cae3[_0x4f7ea7(0x12e)]()[_0x4f7ea7(0xe4)]('(((.+)+)+)+$')[_0x4f7ea7(0x12e)]()[_0x4f7ea7(0x128)](a5_0xc9cae3)[_0x4f7ea7(0xe4)](_0x4f7ea7(0xd9));});a5_0xc9cae3();'use strict';function a5_0x3edd(){const _0x98186b=['2mDXsdu','switch','kontakt','level','.1.ACTUAL_TEMPERATURE','LTM.rawEventLog','37938912OGesEz','.NextHours.Location_1.Day_1.current.temp_value','4sCIWvC','push','weatherInstance','openweathermap','LTM.trainingData.sequences','(((.+)+)+)+$','setStateAsync','Temperature','daswetter','.forecast.current.temp','STATUS','location','getForeignStateAsync','828eqMHgY','contact','pop','search','rawEventLog','13INSoXJ','apply','motion','number','events.history','parse','message','40520DiNmzD','isProVersion','.LEVEL','unshift','shift','valveMapping','exports','fenster','SIMULATE_SIGNAL','presence','name','isGracePeriodActive','getHours','364mwXcoj','thermostat','128292KfrGVe','val','includes','getStateAsync','temperature','occupancy','.Current.Temperature','870sbIfhq','weatherunderground','335nOPDlT','stringify','.4.VALVE_STATE','system.isPresent','now','.1.VALVE_STATE','type','dimmer','length','loc','sensorLastValues','456357pjSxPv','LEVEL','.forecast.current.temperature','bewegung','log','from','Unknown','STATE','LTM.trainingData.thermodynamics','temperatur','outdoorSensorId','config','isExit','.1.LEVEL','heizung','exitTimer','3762285EaNEbg','normal','light','.1.TEMPERATURE','events.lastEvent','47930TvWgUH','schalter','tür','constructor','round','isPresent','eventHistory','currentSystemMode','replace','toString','error','exitGraceTimer','sendToPythonWrapper'];a5_0x3edd=function(){return _0x98186b;};return a5_0x3edd();}const HISTORY_MAX_SIZE=0x32,RAW_LOG_MAX_SIZE=0x9c4,THERMO_LOG_SIZE=0x3e8,SEQUENCE_TIMEOUT_MS=0x5*0x3c*0x3e8,MAX_TRAINING_SET_SIZE=0x1f4,EXIT_TIMER_MINUTES=0xf,EXIT_GRACE_PERIOD_SECONDS=0x1e;let activeSequence=[],sequenceTimer=null;async function getOutsideTemperatureNumeric(_0x433404){const _0x13777f=a5_0x4613;if(_0x433404[_0x13777f(0x11b)]['outdoorSensorId'])try{const _0x1adee2=await _0x433404[_0x13777f(0xe0)](_0x433404['config'][_0x13777f(0x11a)]);if(_0x1adee2&&_0x1adee2[_0x13777f(0xfd)]!==undefined&&_0x1adee2[_0x13777f(0xfd)]!==null)return parseFloat(_0x1adee2[_0x13777f(0xfd)]);}catch(_0xc2af82){}const _0x384d27=_0x433404[_0x13777f(0x11b)][_0x13777f(0xd6)];if(!_0x433404[_0x13777f(0x11b)]['useWeather']||!_0x384d27)return null;try{let _0x2deb4b='';if(_0x384d27['includes']('accuweather'))_0x2deb4b=_0x384d27+_0x13777f(0x102);else{if(_0x384d27[_0x13777f(0xfe)](_0x13777f(0xdc)))_0x2deb4b=_0x384d27+_0x13777f(0xd3);else{if(_0x384d27['includes'](_0x13777f(0xd7)))_0x2deb4b=_0x384d27+_0x13777f(0x112);else{if(_0x384d27[_0x13777f(0xfe)](_0x13777f(0x104)))_0x2deb4b=_0x384d27+_0x13777f(0xdd);}}}if(_0x2deb4b){const _0x159bef=await _0x433404['getForeignStateAsync'](_0x2deb4b);if(_0x159bef&&_0x159bef[_0x13777f(0xfd)]!==undefined&&_0x159bef[_0x13777f(0xfd)]!==null)return parseFloat(_0x159bef[_0x13777f(0xfd)]);}}catch(_0xbe229c){}return null;}async function recordThermodynamics(_0x573fa8,_0xb36463,_0x52ee11,_0x45a474){const _0x206f29=a5_0x4613,_0x1ffc65=await getOutsideTemperatureNumeric(_0x573fa8);if(_0x1ffc65===null)return;let _0x1978e8=0x0,_0x549400=![];if(_0x573fa8[_0x206f29(0x11b)][_0x206f29(0xf2)])try{let _0x1c3572=_0x573fa8['config'][_0x206f29(0xf2)];if(typeof _0x1c3572==='string')_0x1c3572=JSON['parse'](_0x1c3572);if(_0x1c3572[_0xb36463]){const _0x58d22e=_0x1c3572[_0xb36463],_0x3a56a6=await _0x573fa8[_0x206f29(0xe0)](_0x58d22e);if(_0x3a56a6&&_0x3a56a6['val']!==null&&_0x3a56a6[_0x206f29(0xfd)]!==undefined){let _0x5eebaf=Number(_0x3a56a6[_0x206f29(0xfd)]);if(_0x5eebaf<=1.05&&!_0x58d22e[_0x206f29(0xfe)](_0x206f29(0xde))&&!_0x58d22e[_0x206f29(0xfe)](_0x206f29(0x117)))_0x5eebaf=_0x5eebaf*0x64;_0x1978e8=Math[_0x206f29(0x129)](_0x5eebaf),_0x549400=!![];}}}catch(_0x1b35ab){}if(!_0x549400){const _0x356c4c=[{'from':_0x206f29(0xd0),'to':_0x206f29(0x11d)},{'from':_0x206f29(0xd0),'to':_0x206f29(0x10a)},{'from':_0x206f29(0x123),'to':_0x206f29(0x107)},{'from':'.ACTUAL_TEMPERATURE','to':_0x206f29(0xef)},{'from':_0x206f29(0x100),'to':_0x206f29(0xcf)},{'from':_0x206f29(0xdb),'to':'Valve'}];for(const _0x1e58ae of _0x356c4c){if(_0xb36463[_0x206f29(0xfe)](_0x1e58ae['from'])){const _0x5a7420=_0xb36463[_0x206f29(0x12d)](_0x1e58ae[_0x206f29(0x115)],_0x1e58ae['to']);try{const _0x2ee992=await _0x573fa8[_0x206f29(0xe0)](_0x5a7420);if(_0x2ee992&&_0x2ee992[_0x206f29(0xfd)]!==null&&_0x2ee992[_0x206f29(0xfd)]!==undefined){let _0x4755c1=Number(_0x2ee992[_0x206f29(0xfd)]);if(typeof _0x4755c1===_0x206f29(0xe9)){if(_0x4755c1<=1.05&&_0x1e58ae['to'][_0x206f29(0xfe)](_0x206f29(0x111)))_0x4755c1=_0x4755c1*0x64;_0x1978e8=Math[_0x206f29(0x129)](_0x4755c1),_0x549400=!![];break;}}}catch(_0x1886a2){}}}}const _0x54048d=await _0x573fa8[_0x206f29(0xff)]('LTM.trainingData.thermodynamics');let _0x40e3f7=[];if(_0x54048d&&_0x54048d[_0x206f29(0xfd)])try{_0x40e3f7=JSON[_0x206f29(0xeb)](_0x54048d[_0x206f29(0xfd)]);}catch(_0xa58dda){}_0x40e3f7['push']({'ts':Date['now'](),'room':_0x45a474||_0x206f29(0x116),'t_in':_0x52ee11,'t_out':_0x1ffc65,'valve':_0x1978e8});if(_0x40e3f7['length']>THERMO_LOG_SIZE)_0x40e3f7[_0x206f29(0xf1)]();await _0x573fa8[_0x206f29(0xda)](_0x206f29(0x118),{'val':JSON[_0x206f29(0x106)](_0x40e3f7),'ack':!![]});}async function saveCompletedSequence(_0x32dc9a){const _0x27ff17=a5_0x4613;try{const _0x35b78d=await _0x32dc9a[_0x27ff17(0xff)](_0x27ff17(0xd8));let _0xddcad2=[];if(_0x35b78d&&_0x35b78d['val'])try{_0xddcad2=JSON[_0x27ff17(0xeb)](_0x35b78d[_0x27ff17(0xfd)]);}catch(_0x565528){}const _0x15c826=activeSequence[0x0]['ts'],_0x5a6440=activeSequence['map'](_0x367c67=>({'loc':_0x367c67[_0x27ff17(0x10e)],'t_delta':Math['round']((_0x367c67['ts']-_0x15c826)/0x3e8)})),_0x475aa4={'timestamp':new Date(_0x15c826)['toISOString'](),'steps':_0x5a6440,'duration':Math[_0x27ff17(0x129)]((activeSequence[activeSequence['length']-0x1]['ts']-_0x15c826)/0x3e8),'daytime':new Date(_0x15c826)[_0x27ff17(0xf9)]()};_0xddcad2[_0x27ff17(0xd5)](_0x475aa4);if(_0xddcad2[_0x27ff17(0x10d)]>MAX_TRAINING_SET_SIZE)_0xddcad2[_0x27ff17(0xf1)]();await _0x32dc9a['setStateAsync'](_0x27ff17(0xd8),{'val':JSON[_0x27ff17(0x106)](_0xddcad2),'ack':!![]}),_0x32dc9a[_0x27ff17(0xee)]&&_0x32dc9a[_0x27ff17(0xcb)]&&_0x32dc9a[_0x27ff17(0xcb)]('ANALYZE_SEQUENCE',{'sequence':_0x475aa4});}catch(_0x48420f){_0x32dc9a[_0x27ff17(0x114)][_0x27ff17(0x12f)]('[RECORDER]\x20Error:\x20'+_0x48420f[_0x27ff17(0xec)]);}}async function recordSequence(_0x2c6033,_0x4eff30){const _0x5c0c00=a5_0x4613,_0x343710=(_0x4eff30[_0x5c0c00(0x10b)]||'')['toLowerCase'](),_0x4ca919=[_0x5c0c00(0xe8),_0x5c0c00(0x113),'präsenz',_0x5c0c00(0xf6),_0x5c0c00(0x101),'door',_0x5c0c00(0x127),'window',_0x5c0c00(0xf4),_0x5c0c00(0xe2),_0x5c0c00(0xce),_0x5c0c00(0x122),'licht',_0x5c0c00(0xcd),_0x5c0c00(0x126),_0x5c0c00(0x10c),'lampe'];if(!_0x4ca919['some'](_0x4681c1=>_0x343710[_0x5c0c00(0xfe)](_0x4681c1)))return;if(!_0x4eff30['value'])return;if(sequenceTimer)clearTimeout(sequenceTimer);activeSequence[_0x5c0c00(0xd5)]({'loc':_0x4eff30[_0x5c0c00(0xdf)]||_0x5c0c00(0x116),'id':_0x4eff30['id'],'ts':Date['now']()}),sequenceTimer=setTimeout(async()=>{const _0x457eb8=_0x5c0c00;if(activeSequence[_0x457eb8(0x10d)]>0x1)await saveCompletedSequence(_0x2c6033);activeSequence=[];},SEQUENCE_TIMEOUT_MS);}function startExitTimer(_0x3bd764){const _0x22dffd=a5_0x4613;abortExitTimer(_0x3bd764),_0x3bd764[_0x22dffd(0xf8)]=!![],_0x3bd764[_0x22dffd(0xca)]=setTimeout(()=>{const _0x3fc8d0=_0x22dffd;_0x3bd764[_0x3fc8d0(0xf8)]=![];},EXIT_GRACE_PERIOD_SECONDS*0x3e8),_0x3bd764[_0x22dffd(0x11f)]=setTimeout(()=>{setPresence(_0x3bd764,![]),_0x3bd764['exitTimer']=null;},EXIT_TIMER_MINUTES*0x3c*0x3e8);}function abortExitTimer(_0x647d7d){const _0x2fe26d=a5_0x4613;if(_0x647d7d['exitTimer'])clearTimeout(_0x647d7d[_0x2fe26d(0x11f)]);if(_0x647d7d[_0x2fe26d(0xca)])clearTimeout(_0x647d7d['exitGraceTimer']);_0x647d7d[_0x2fe26d(0x11f)]=null,_0x647d7d[_0x2fe26d(0xca)]=null,_0x647d7d[_0x2fe26d(0xf8)]=![];}async function setPresence(_0x502aca,_0x59d6f5){const _0x2969e8=a5_0x4613;if(_0x502aca[_0x2969e8(0x12a)]===_0x59d6f5)return;_0x502aca[_0x2969e8(0x12a)]=_0x59d6f5,await _0x502aca[_0x2969e8(0xda)](_0x2969e8(0x108),{'val':_0x59d6f5,'ack':!![]});}async function processSensorEvent(_0x1a5da2,_0x330569,_0x38256e,_0x145c61){const _0x489ec8=a5_0x4613;if(!_0x145c61)return null;const _0x16af41=_0x38256e[_0x489ec8(0xfd)],_0x149883=Date[_0x489ec8(0x109)](),_0x1e85d1=_0x1a5da2[_0x489ec8(0x10f)][_0x330569];_0x1a5da2[_0x489ec8(0x10f)][_0x330569]=_0x16af41;if(!_0x145c61['logDuplicates']&&_0x1e85d1!=undefined&&_0x1e85d1==_0x16af41)return null;const _0x47fafb=(_0x145c61['type']||'')['toLowerCase'](),_0xf4e67=_0x47fafb[_0x489ec8(0xfe)](_0x489ec8(0x100))||_0x47fafb[_0x489ec8(0xfe)](_0x489ec8(0x119))||_0x47fafb[_0x489ec8(0xfe)]('klima')||_0x47fafb[_0x489ec8(0xfe)](_0x489ec8(0x11e))||_0x47fafb[_0x489ec8(0xfe)](_0x489ec8(0xfb));_0x1a5da2[_0x489ec8(0xee)]&&_0xf4e67&&recordThermodynamics(_0x1a5da2,_0x330569,_0x16af41,_0x145c61[_0x489ec8(0xdf)]);const _0x451cf6={'timestamp':_0x149883,'id':_0x330569,'name':_0x145c61[_0x489ec8(0xf7)],'type':_0x145c61[_0x489ec8(0x10b)],'location':_0x145c61[_0x489ec8(0xdf)],'value':_0x16af41};_0x1a5da2[_0x489ec8(0x12b)][_0x489ec8(0xf0)](_0x451cf6);if(_0x1a5da2[_0x489ec8(0x12b)][_0x489ec8(0x10d)]>HISTORY_MAX_SIZE)_0x1a5da2[_0x489ec8(0x12b)][_0x489ec8(0xe3)]();await _0x1a5da2[_0x489ec8(0xda)](_0x489ec8(0x124),{'val':JSON[_0x489ec8(0x106)](_0x451cf6),'ack':!![]}),await _0x1a5da2[_0x489ec8(0xda)](_0x489ec8(0xea),{'val':JSON['stringify'](_0x1a5da2[_0x489ec8(0x12b)]),'ack':!![]});if(_0x1a5da2[_0x489ec8(0xee)]){_0x1a5da2[_0x489ec8(0xe5)][_0x489ec8(0xd5)](_0x451cf6);if(_0x1a5da2[_0x489ec8(0xe5)][_0x489ec8(0x10d)]>RAW_LOG_MAX_SIZE)_0x1a5da2[_0x489ec8(0xe5)]['splice'](0x0,_0x1a5da2[_0x489ec8(0xe5)]['length']-RAW_LOG_MAX_SIZE);await _0x1a5da2['setStateAsync'](_0x489ec8(0xd1),{'val':JSON[_0x489ec8(0x106)](_0x1a5da2['rawEventLog']),'ack':!![]}),recordSequence(_0x1a5da2,_0x451cf6);}if(_0x145c61[_0x489ec8(0x11c)]&&_0x16af41===!![]){if(_0x1a5da2['isPresent']&&!_0x1a5da2[_0x489ec8(0xf8)])startExitTimer(_0x1a5da2);else{if(!_0x1a5da2[_0x489ec8(0x12a)])setPresence(_0x1a5da2,!![]);}}else{if(_0x145c61['type']===_0x489ec8(0xe8)&&_0x16af41===!![]){if(_0x1a5da2[_0x489ec8(0x11f)])abortExitTimer(_0x1a5da2);if(!_0x1a5da2[_0x489ec8(0x12a)]&&_0x1a5da2[_0x489ec8(0x12c)]===_0x489ec8(0x121))setPresence(_0x1a5da2,!![]);}}return _0x1a5da2[_0x489ec8(0xee)]&&_0x145c61[_0x489ec8(0x10b)]===_0x489ec8(0xe8)&&_0x16af41===!![]&&_0x145c61[_0x489ec8(0xdf)]&&_0x1a5da2[_0x489ec8(0xcb)]&&_0x1a5da2[_0x489ec8(0xcb)](_0x489ec8(0xf5),{'room':_0x145c61[_0x489ec8(0xdf)]}),_0x451cf6;}module[a5_0x136430(0xf3)]={'processSensorEvent':processSensorEvent,'getOutsideTemperatureNumeric':getOutsideTemperatureNumeric,'setPresence':setPresence,'abortExitTimer':abortExitTimer,'startExitTimer':startExitTimer};