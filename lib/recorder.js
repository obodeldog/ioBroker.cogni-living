function a5_0x4118(){const _0x48b371=['getForeignStateAsync','1165213BIVSef','door','getHours','rawEventLog','dimmer','isGracePeriodActive','kontakt','licht','1324413HvtADQ','fenster','logDuplicates','splice','unshift','.forecast.current.temperature','1143963ZUZyYb','STATUS','ANALYZE_SEQUENCE','contact','toString','temperature','80UUbDcU','.1.LEVEL','string','lastTrackerEventTime','isProVersion','push','setStateAsync','präsenz','.LEVEL','LTM.rawEventLog','val','[RECORDER]\x20Error:\x20','heizung','currentSystemMode','level','events.history','.ACTUAL_TEMPERATURE','value','.1.VALVE_STATE','pop','now','8EpvAoH','includes','weatherInstance','(((.+)+)+)+$','occupancy','exitTimer','2605VKlvhZ','eventHistory','shift','log','round','message','.Current.Temperature','schalter','useWeather','replace','.NextHours.Location_1.Day_1.current.temp_value','6204000OeJMdr','openweathermap','search','some','outdoorSensorId','length','TRACK_EVENT','tür','STATE','Unknown','presence','sensorLastValues','type','klima','17xvOmRA','.forecast.current.temp','daswetter','parse','.1.ACTUAL_TEMPERATURE','toLowerCase','switch','49490TUEFyY','from','sendToPythonWrapper','window','config','Valve','system.isPresent','map','isPresent','motion','normal','weatherunderground','LTM.trainingData.thermodynamics','apply','valveMapping','lampe','LTM.trainingData.sequences','number','1806408MHyCYE','exitGraceTimer','stringify','events.lastEvent','location','isExit'];a5_0x4118=function(){return _0x48b371;};return a5_0x4118();}(function(_0x36a0cc,_0xc198f6){const _0x57e81d=a5_0x39fb,_0x187b2a=_0x36a0cc();while(!![]){try{const _0x42ed4b=-parseInt(_0x57e81d(0x1c3))/0x1*(parseInt(_0x57e81d(0x1ca))/0x2)+parseInt(_0x57e81d(0x1f1))/0x3+parseInt(_0x57e81d(0x1f7))/0x4*(-parseInt(_0x57e81d(0x212))/0x5)+-parseInt(_0x57e81d(0x1dc))/0x6+parseInt(_0x57e81d(0x1e3))/0x7*(-parseInt(_0x57e81d(0x20c))/0x8)+parseInt(_0x57e81d(0x1eb))/0x9+parseInt(_0x57e81d(0x1b5))/0xa;if(_0x42ed4b===_0xc198f6)break;else _0x187b2a['push'](_0x187b2a['shift']());}catch(_0x2da3e0){_0x187b2a['push'](_0x187b2a['shift']());}}}(a5_0x4118,0x3d19a));const a5_0x3694b3=(function(){let _0x4202b9=!![];return function(_0x5c88f1,_0x1bb8c3){const _0x29221d=_0x4202b9?function(){const _0x3337bf=a5_0x39fb;if(_0x1bb8c3){const _0x3d0271=_0x1bb8c3[_0x3337bf(0x1d7)](_0x5c88f1,arguments);return _0x1bb8c3=null,_0x3d0271;}}:function(){};return _0x4202b9=![],_0x29221d;};}()),a5_0x3f3d14=a5_0x3694b3(this,function(){const _0x14a013=a5_0x39fb;return a5_0x3f3d14['toString']()[_0x14a013(0x1b7)](_0x14a013(0x20f))[_0x14a013(0x1f5)]()['constructor'](a5_0x3f3d14)['search']('(((.+)+)+)+$');});a5_0x3f3d14();'use strict';const HISTORY_MAX_SIZE=0x32,RAW_LOG_MAX_SIZE=0x9c4,THERMO_LOG_SIZE=0x3e8,SEQUENCE_TIMEOUT_MS=0x5*0x3c*0x3e8,MAX_TRAINING_SET_SIZE=0x1f4,EXIT_TIMER_MINUTES=0xf,EXIT_GRACE_PERIOD_SECONDS=0x1e;let activeSequence=[],sequenceTimer=null;function a5_0x39fb(_0x5676f7,_0x15b08c){const _0x673262=a5_0x4118();return a5_0x39fb=function(_0x3f3d14,_0x3694b3){_0x3f3d14=_0x3f3d14-0x1b3;let _0x411867=_0x673262[_0x3f3d14];return _0x411867;},a5_0x39fb(_0x5676f7,_0x15b08c);}async function getOutsideTemperatureNumeric(_0x14a560){const _0x609ad5=a5_0x39fb;if(_0x14a560['config']['outdoorSensorId'])try{const _0x59f44a=await _0x14a560[_0x609ad5(0x1e2)](_0x14a560[_0x609ad5(0x1ce)][_0x609ad5(0x1b9)]);if(_0x59f44a&&_0x59f44a[_0x609ad5(0x201)]!==undefined&&_0x59f44a[_0x609ad5(0x201)]!==null)return parseFloat(_0x59f44a['val']);}catch(_0x129e24){}const _0x157208=_0x14a560[_0x609ad5(0x1ce)][_0x609ad5(0x20e)];if(!_0x14a560['config'][_0x609ad5(0x21a)]||!_0x157208)return null;try{let _0x44cfb2='';if(_0x157208[_0x609ad5(0x20d)]('accuweather'))_0x44cfb2=_0x157208+_0x609ad5(0x218);else{if(_0x157208[_0x609ad5(0x20d)](_0x609ad5(0x1c5)))_0x44cfb2=_0x157208+_0x609ad5(0x1b4);else{if(_0x157208['includes'](_0x609ad5(0x1b6)))_0x44cfb2=_0x157208+_0x609ad5(0x1f0);else{if(_0x157208['includes'](_0x609ad5(0x1d5)))_0x44cfb2=_0x157208+_0x609ad5(0x1c4);}}}if(_0x44cfb2){const _0x5a2bf3=await _0x14a560[_0x609ad5(0x1e2)](_0x44cfb2);if(_0x5a2bf3&&_0x5a2bf3[_0x609ad5(0x201)]!==undefined&&_0x5a2bf3[_0x609ad5(0x201)]!==null)return parseFloat(_0x5a2bf3[_0x609ad5(0x201)]);}}catch(_0x1a1ab9){}return null;}async function recordThermodynamics(_0x5ebec4,_0x225209,_0x2bd109,_0x5ad44e){const _0x5811af=a5_0x39fb,_0xedef7b=await getOutsideTemperatureNumeric(_0x5ebec4);if(_0xedef7b===null)return;let _0x13db3d=0x0,_0x16a3d1=![];if(_0x5ebec4[_0x5811af(0x1ce)]['valveMapping'])try{let _0x439ab1=_0x5ebec4['config'][_0x5811af(0x1d8)];if(typeof _0x439ab1===_0x5811af(0x1f9))_0x439ab1=JSON[_0x5811af(0x1c6)](_0x439ab1);if(_0x439ab1[_0x225209]){const _0x35dfe9=_0x439ab1[_0x225209],_0x569577=await _0x5ebec4[_0x5811af(0x1e2)](_0x35dfe9);if(_0x569577&&_0x569577[_0x5811af(0x201)]!==null&&_0x569577[_0x5811af(0x201)]!==undefined){let _0x253a07=Number(_0x569577['val']);if(_0x253a07<=1.05&&!_0x35dfe9['includes'](_0x5811af(0x1f2))&&!_0x35dfe9[_0x5811af(0x20d)](_0x5811af(0x1bd)))_0x253a07=_0x253a07*0x64;_0x13db3d=Math['round'](_0x253a07),_0x16a3d1=!![];}}}catch(_0x1718ab){}if(!_0x16a3d1){const _0x473cba=[{'from':_0x5811af(0x1c7),'to':_0x5811af(0x1f8)},{'from':_0x5811af(0x1c7),'to':_0x5811af(0x209)},{'from':'.1.TEMPERATURE','to':'.4.VALVE_STATE'},{'from':_0x5811af(0x207),'to':_0x5811af(0x1ff)},{'from':_0x5811af(0x1f6),'to':_0x5811af(0x205)},{'from':'Temperature','to':_0x5811af(0x1cf)}];for(const _0x255638 of _0x473cba){if(_0x225209[_0x5811af(0x20d)](_0x255638[_0x5811af(0x1cb)])){const _0x2681f0=_0x225209[_0x5811af(0x1b3)](_0x255638[_0x5811af(0x1cb)],_0x255638['to']);try{const _0x2f2058=await _0x5ebec4[_0x5811af(0x1e2)](_0x2681f0);if(_0x2f2058&&_0x2f2058[_0x5811af(0x201)]!==null&&_0x2f2058['val']!==undefined){let _0x2d3996=Number(_0x2f2058[_0x5811af(0x201)]);if(typeof _0x2d3996===_0x5811af(0x1db)){if(_0x2d3996<=1.05&&_0x255638['to'][_0x5811af(0x20d)]('LEVEL'))_0x2d3996=_0x2d3996*0x64;_0x13db3d=Math['round'](_0x2d3996),_0x16a3d1=!![];break;}}}catch(_0xe31b){}}}}const _0x4c1a07=await _0x5ebec4['getStateAsync'](_0x5811af(0x1d6));let _0x58be39=[];if(_0x4c1a07&&_0x4c1a07[_0x5811af(0x201)])try{_0x58be39=JSON[_0x5811af(0x1c6)](_0x4c1a07[_0x5811af(0x201)]);}catch(_0x53dbe5){}_0x58be39[_0x5811af(0x1fc)]({'ts':Date[_0x5811af(0x20b)](),'room':_0x5ad44e||_0x5811af(0x1be),'t_in':_0x2bd109,'t_out':_0xedef7b,'valve':_0x13db3d});if(_0x58be39[_0x5811af(0x1ba)]>THERMO_LOG_SIZE)_0x58be39[_0x5811af(0x214)]();await _0x5ebec4[_0x5811af(0x1fd)](_0x5811af(0x1d6),{'val':JSON[_0x5811af(0x1de)](_0x58be39),'ack':!![]});}async function saveCompletedSequence(_0x32b29a){const _0x1a1323=a5_0x39fb;try{const _0x3733ca=await _0x32b29a['getStateAsync'](_0x1a1323(0x1da));let _0x5e3ac2=[];if(_0x3733ca&&_0x3733ca['val'])try{_0x5e3ac2=JSON[_0x1a1323(0x1c6)](_0x3733ca[_0x1a1323(0x201)]);}catch(_0x18230e){}const _0x44aabd=activeSequence[0x0]['ts'],_0x254929=activeSequence[_0x1a1323(0x1d1)](_0x429b28=>({'loc':_0x429b28['loc'],'t_delta':Math[_0x1a1323(0x216)]((_0x429b28['ts']-_0x44aabd)/0x3e8)})),_0x38f6cd={'timestamp':new Date(_0x44aabd)['toISOString'](),'steps':_0x254929,'duration':Math['round']((activeSequence[activeSequence[_0x1a1323(0x1ba)]-0x1]['ts']-_0x44aabd)/0x3e8),'daytime':new Date(_0x44aabd)[_0x1a1323(0x1e5)]()};_0x5e3ac2['push'](_0x38f6cd);if(_0x5e3ac2['length']>MAX_TRAINING_SET_SIZE)_0x5e3ac2['shift']();await _0x32b29a[_0x1a1323(0x1fd)](_0x1a1323(0x1da),{'val':JSON['stringify'](_0x5e3ac2),'ack':!![]}),_0x32b29a['isProVersion']&&_0x32b29a['sendToPythonWrapper']&&_0x32b29a[_0x1a1323(0x1cc)](_0x1a1323(0x1f3),{'sequence':_0x38f6cd});}catch(_0x1ddfe1){_0x32b29a[_0x1a1323(0x215)]['error'](_0x1a1323(0x202)+_0x1ddfe1[_0x1a1323(0x217)]);}}async function recordSequence(_0x1ccd59,_0x520365){const _0x68f0e=a5_0x39fb,_0x576362=(_0x520365[_0x68f0e(0x1c1)]||'')[_0x68f0e(0x1c8)](),_0x573402=[_0x68f0e(0x1d3),'bewegung',_0x68f0e(0x1fe),_0x68f0e(0x1bf),_0x68f0e(0x210),_0x68f0e(0x1e4),_0x68f0e(0x1bc),_0x68f0e(0x1cd),_0x68f0e(0x1ec),_0x68f0e(0x1f4),_0x68f0e(0x1e9),'light',_0x68f0e(0x1ea),_0x68f0e(0x1c9),_0x68f0e(0x219),_0x68f0e(0x1e7),_0x68f0e(0x1d9)];if(!_0x573402[_0x68f0e(0x1b8)](_0x527423=>_0x576362['includes'](_0x527423)))return;if(!_0x520365[_0x68f0e(0x208)])return;if(sequenceTimer)clearTimeout(sequenceTimer);activeSequence[_0x68f0e(0x1fc)]({'loc':_0x520365[_0x68f0e(0x1e0)]||'Unknown','id':_0x520365['id'],'ts':Date[_0x68f0e(0x20b)]()}),sequenceTimer=setTimeout(async()=>{const _0x3b897=_0x68f0e;if(activeSequence[_0x3b897(0x1ba)]>0x1)await saveCompletedSequence(_0x1ccd59);activeSequence=[];},SEQUENCE_TIMEOUT_MS);}function startExitTimer(_0x664614){const _0x52952c=a5_0x39fb;abortExitTimer(_0x664614),_0x664614['isGracePeriodActive']=!![],_0x664614[_0x52952c(0x1dd)]=setTimeout(()=>{const _0xfd3eb5=_0x52952c;_0x664614[_0xfd3eb5(0x1e8)]=![];},EXIT_GRACE_PERIOD_SECONDS*0x3e8),_0x664614['exitTimer']=setTimeout(()=>{setPresence(_0x664614,![]),_0x664614['exitTimer']=null;},EXIT_TIMER_MINUTES*0x3c*0x3e8);}function abortExitTimer(_0x10c970){const _0x43cf8e=a5_0x39fb;if(_0x10c970[_0x43cf8e(0x211)])clearTimeout(_0x10c970[_0x43cf8e(0x211)]);if(_0x10c970[_0x43cf8e(0x1dd)])clearTimeout(_0x10c970[_0x43cf8e(0x1dd)]);_0x10c970[_0x43cf8e(0x211)]=null,_0x10c970[_0x43cf8e(0x1dd)]=null,_0x10c970['isGracePeriodActive']=![];}async function setPresence(_0x3139ff,_0x7a6f25){const _0x36ad69=a5_0x39fb;if(_0x3139ff[_0x36ad69(0x1d2)]===_0x7a6f25)return;_0x3139ff[_0x36ad69(0x1d2)]=_0x7a6f25,await _0x3139ff[_0x36ad69(0x1fd)](_0x36ad69(0x1d0),{'val':_0x7a6f25,'ack':!![]});}async function processSensorEvent(_0x4a6fe6,_0x5dfd99,_0x4faf97,_0x143946){const _0x142cca=a5_0x39fb;if(!_0x143946)return null;const _0x11d315=_0x4faf97['val'],_0x1bffed=Date['now'](),_0x2b1180=_0x4a6fe6[_0x142cca(0x1c0)][_0x5dfd99];_0x4a6fe6[_0x142cca(0x1c0)][_0x5dfd99]=_0x11d315;if(!_0x143946[_0x142cca(0x1ed)]&&_0x2b1180!=undefined&&_0x2b1180==_0x11d315)return null;const _0xac724d=(_0x143946[_0x142cca(0x1c1)]||'')[_0x142cca(0x1c8)](),_0x2ce367=_0xac724d[_0x142cca(0x20d)](_0x142cca(0x1f6))||_0xac724d[_0x142cca(0x20d)]('temperatur')||_0xac724d['includes'](_0x142cca(0x1c2))||_0xac724d[_0x142cca(0x20d)](_0x142cca(0x203))||_0xac724d[_0x142cca(0x20d)]('thermostat');_0x4a6fe6['isProVersion']&&_0x2ce367&&recordThermodynamics(_0x4a6fe6,_0x5dfd99,_0x11d315,_0x143946[_0x142cca(0x1e0)]);const _0x3f956a={'timestamp':_0x1bffed,'id':_0x5dfd99,'name':_0x143946['name'],'type':_0x143946[_0x142cca(0x1c1)],'location':_0x143946[_0x142cca(0x1e0)],'value':_0x11d315};_0x4a6fe6[_0x142cca(0x213)][_0x142cca(0x1ef)](_0x3f956a);if(_0x4a6fe6[_0x142cca(0x213)][_0x142cca(0x1ba)]>HISTORY_MAX_SIZE)_0x4a6fe6[_0x142cca(0x213)][_0x142cca(0x20a)]();await _0x4a6fe6[_0x142cca(0x1fd)](_0x142cca(0x1df),{'val':JSON[_0x142cca(0x1de)](_0x3f956a),'ack':!![]}),await _0x4a6fe6['setStateAsync'](_0x142cca(0x206),{'val':JSON[_0x142cca(0x1de)](_0x4a6fe6[_0x142cca(0x213)]),'ack':!![]});if(_0x4a6fe6['isProVersion']){_0x4a6fe6['rawEventLog'][_0x142cca(0x1fc)](_0x3f956a);if(_0x4a6fe6[_0x142cca(0x1e6)][_0x142cca(0x1ba)]>RAW_LOG_MAX_SIZE)_0x4a6fe6[_0x142cca(0x1e6)][_0x142cca(0x1ee)](0x0,_0x4a6fe6['rawEventLog'][_0x142cca(0x1ba)]-RAW_LOG_MAX_SIZE);await _0x4a6fe6['setStateAsync'](_0x142cca(0x200),{'val':JSON[_0x142cca(0x1de)](_0x4a6fe6[_0x142cca(0x1e6)]),'ack':!![]}),recordSequence(_0x4a6fe6,_0x3f956a);}if(_0x143946[_0x142cca(0x1e1)]&&_0x11d315===!![]){if(_0x4a6fe6[_0x142cca(0x1d2)]&&!_0x4a6fe6[_0x142cca(0x1e8)])startExitTimer(_0x4a6fe6);else{if(!_0x4a6fe6['isPresent'])setPresence(_0x4a6fe6,!![]);}}else{if(_0x143946[_0x142cca(0x1c1)]===_0x142cca(0x1d3)&&_0x11d315===!![]){if(_0x4a6fe6[_0x142cca(0x211)])abortExitTimer(_0x4a6fe6);if(!_0x4a6fe6[_0x142cca(0x1d2)]&&_0x4a6fe6[_0x142cca(0x204)]===_0x142cca(0x1d4))setPresence(_0x4a6fe6,!![]);}}if(_0x4a6fe6[_0x142cca(0x1fb)]&&_0x4a6fe6[_0x142cca(0x1cc)]){_0x143946[_0x142cca(0x1c1)]==='motion'&&_0x11d315===!![]&&_0x143946[_0x142cca(0x1e0)]&&_0x4a6fe6[_0x142cca(0x1cc)]('SIMULATE_SIGNAL',{'room':_0x143946[_0x142cca(0x1e0)]});if(_0x143946['location']&&(_0x11d315===!![]||typeof _0x11d315===_0x142cca(0x1db))){const _0x2d1a42=_0x4a6fe6[_0x142cca(0x1fa)]||_0x1bffed,_0x182269=(_0x1bffed-_0x2d1a42)/0x3e8;_0x4a6fe6[_0x142cca(0x1fa)]=_0x1bffed,_0x4a6fe6[_0x142cca(0x1cc)](_0x142cca(0x1bb),{'room':_0x143946[_0x142cca(0x1e0)],'dt':_0x182269});}}return _0x3f956a;}module['exports']={'processSensorEvent':processSensorEvent,'getOutsideTemperatureNumeric':getOutsideTemperatureNumeric,'setPresence':setPresence,'abortExitTimer':abortExitTimer,'startExitTimer':startExitTimer};