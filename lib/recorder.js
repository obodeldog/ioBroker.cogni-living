function a5_0x1dd6(_0x3b0420,_0x10dec9){const _0x16f04f=a5_0x1a70();return a5_0x1dd6=function(_0x5183b7,_0x9440cf){_0x5183b7=_0x5183b7-0x1db;let _0x1a70b2=_0x16f04f[_0x5183b7];return _0x1a70b2;},a5_0x1dd6(_0x3b0420,_0x10dec9);}const a5_0x48db8a=a5_0x1dd6;(function(_0x1993c8,_0x277def){const _0x456403=a5_0x1dd6,_0x4de31e=_0x1993c8();while(!![]){try{const _0xb200b6=-parseInt(_0x456403(0x1db))/0x1*(parseInt(_0x456403(0x223))/0x2)+parseInt(_0x456403(0x242))/0x3*(-parseInt(_0x456403(0x209))/0x4)+parseInt(_0x456403(0x1e7))/0x5+parseInt(_0x456403(0x236))/0x6+parseInt(_0x456403(0x1f5))/0x7+parseInt(_0x456403(0x22b))/0x8*(-parseInt(_0x456403(0x1e0))/0x9)+-parseInt(_0x456403(0x214))/0xa*(-parseInt(_0x456403(0x1e9))/0xb);if(_0xb200b6===_0x277def)break;else _0x4de31e['push'](_0x4de31e['shift']());}catch(_0x363da7){_0x4de31e['push'](_0x4de31e['shift']());}}}(a5_0x1a70,0xb5737));const a5_0x9440cf=(function(){let _0x5b961e=!![];return function(_0x49c6b4,_0x3f9a6d){const _0x308151=_0x5b961e?function(){const _0x168d1e=a5_0x1dd6;if(_0x3f9a6d){const _0x1a7385=_0x3f9a6d[_0x168d1e(0x202)](_0x49c6b4,arguments);return _0x3f9a6d=null,_0x1a7385;}}:function(){};return _0x5b961e=![],_0x308151;};}()),a5_0x5183b7=a5_0x9440cf(this,function(){const _0x3bac24=a5_0x1dd6;return a5_0x5183b7[_0x3bac24(0x221)]()[_0x3bac24(0x1f6)](_0x3bac24(0x20c))['toString']()[_0x3bac24(0x1f4)](a5_0x5183b7)[_0x3bac24(0x1f6)](_0x3bac24(0x20c));});a5_0x5183b7();function a5_0x1a70(){const _0x5015cc=['Unknown','schalter','Valve','message','window','events.lastEvent','3MzdFCu','tür','LTM.trainingData.sequences','lampe','eventHistory','val','length','.1.LEVEL','getStateAsync','accuweather','motion','.1.VALVE_STATE','97PnfMWi','STATE','[RECORDER]\x20Ignored\x20implausible\x20temperature:\x20','openweathermap','error','11556UQFtRt','exitGraceTimer','contact','STATUS','logDuplicates','SIMULATE_SIGNAL','heizung','4121245UkqQaQ','parse','12057749PcjgHe','from','bewegung','temperatur','log','isExit','isGracePeriodActive','.forecast.current.temperature','valveMapping','handle','\x20from\x20','constructor','7100338AGbHiB','search','location','.LEVEL','now','schloss','replace','LTM.trainingData.thermodynamics','door','switch','dimmer','.NextHours.Location_1.Day_1.current.temp_value','events.history','apply','ANALYZE_SEQUENCE','getForeignStateAsync','licht','klima','.1.ACTUAL_TEMPERATURE','unshift','5909624XvfsTP','config','weatherInstance','(((.+)+)+)+$','thermostat','level','rawEventLog','system.isPresent','exitTimer','currentSystemMode','number','10SfTxfK','string','.forecast.current.temp','präsenz','getHours','sendToPythonWrapper','griff','temperature','exports','LTM.rawEventLog','includes','normal','TRACK_EVENT','toString','round','19546kjWZTx','.4.VALVE_STATE','name','.Current.Temperature','some','push','daswetter','toLowerCase','3832VMCwIX','lastTrackerEventTime','isPresent','sensorLastValues','debug','useWeather','setStateAsync','stringify','pop','toISOString','occupancy','5093424ISgUbU','presence','map','isProVersion','type','loc'];a5_0x1a70=function(){return _0x5015cc;};return a5_0x1a70();}'use strict';const HISTORY_MAX_SIZE=0x32,RAW_LOG_MAX_SIZE=0x9c4,THERMO_LOG_SIZE=0x3e8,SEQUENCE_TIMEOUT_MS=0x5*0x3c*0x3e8,MAX_TRAINING_SET_SIZE=0x1f4,EXIT_TIMER_MINUTES=0xf,EXIT_GRACE_PERIOD_SECONDS=0x1e;let activeSequence=[],sequenceTimer=null;async function getOutsideTemperatureNumeric(_0x1ec444){const _0x43a587=a5_0x1dd6;if(_0x1ec444['config']['outdoorSensorId'])try{const _0x182a86=await _0x1ec444['getForeignStateAsync'](_0x1ec444[_0x43a587(0x20a)]['outdoorSensorId']);if(_0x182a86&&_0x182a86[_0x43a587(0x247)]!==undefined&&_0x182a86[_0x43a587(0x247)]!==null)return parseFloat(_0x182a86[_0x43a587(0x247)]);}catch(_0x568009){}const _0x19dbe5=_0x1ec444[_0x43a587(0x20a)][_0x43a587(0x20b)];if(!_0x1ec444[_0x43a587(0x20a)][_0x43a587(0x230)]||!_0x19dbe5)return null;try{let _0x486398='';if(_0x19dbe5[_0x43a587(0x21e)](_0x43a587(0x24b)))_0x486398=_0x19dbe5+_0x43a587(0x226);else{if(_0x19dbe5['includes'](_0x43a587(0x229)))_0x486398=_0x19dbe5+_0x43a587(0x200);else{if(_0x19dbe5[_0x43a587(0x21e)](_0x43a587(0x1de)))_0x486398=_0x19dbe5+_0x43a587(0x1f0);else{if(_0x19dbe5[_0x43a587(0x21e)]('weatherunderground'))_0x486398=_0x19dbe5+_0x43a587(0x216);}}}if(_0x486398){const _0x382eb9=await _0x1ec444['getForeignStateAsync'](_0x486398);if(_0x382eb9&&_0x382eb9[_0x43a587(0x247)]!==undefined&&_0x382eb9[_0x43a587(0x247)]!==null)return parseFloat(_0x382eb9[_0x43a587(0x247)]);}}catch(_0x116d64){}return null;}async function recordThermodynamics(_0x2a8a8d,_0x576e03,_0x1e7017,_0x2638f1){const _0x516909=a5_0x1dd6,_0x346a53=await getOutsideTemperatureNumeric(_0x2a8a8d);if(_0x346a53===null)return;let _0x30ee6d=0x0,_0x585d24=![];if(_0x2a8a8d[_0x516909(0x20a)][_0x516909(0x1f1)])try{let _0x46f487=_0x2a8a8d[_0x516909(0x20a)][_0x516909(0x1f1)];if(typeof _0x46f487===_0x516909(0x215))_0x46f487=JSON[_0x516909(0x1e8)](_0x46f487);if(_0x46f487[_0x576e03]){const _0x1cf122=_0x46f487[_0x576e03],_0x385627=await _0x2a8a8d['getForeignStateAsync'](_0x1cf122);if(_0x385627&&_0x385627[_0x516909(0x247)]!==null&&_0x385627[_0x516909(0x247)]!==undefined){let _0x4c6c18=Number(_0x385627[_0x516909(0x247)]);if(_0x4c6c18<=1.05&&!_0x1cf122[_0x516909(0x21e)](_0x516909(0x1e3))&&!_0x1cf122['includes'](_0x516909(0x1dc)))_0x4c6c18=_0x4c6c18*0x64;_0x30ee6d=Math['round'](_0x4c6c18),_0x585d24=!![];}}}catch(_0x157e81){}if(!_0x585d24){const _0x33d530=[{'from':_0x516909(0x207),'to':_0x516909(0x249)},{'from':_0x516909(0x207),'to':_0x516909(0x24d)},{'from':'.1.TEMPERATURE','to':_0x516909(0x224)},{'from':'.ACTUAL_TEMPERATURE','to':_0x516909(0x1f8)},{'from':_0x516909(0x21b),'to':_0x516909(0x20e)},{'from':'Temperature','to':_0x516909(0x23e)}];for(const _0x38cad0 of _0x33d530){if(_0x576e03[_0x516909(0x21e)](_0x38cad0[_0x516909(0x1ea)])){const _0x34d4fb=_0x576e03[_0x516909(0x1fb)](_0x38cad0['from'],_0x38cad0['to']);try{const _0x47ac74=await _0x2a8a8d[_0x516909(0x204)](_0x34d4fb);if(_0x47ac74&&_0x47ac74[_0x516909(0x247)]!==null&&_0x47ac74[_0x516909(0x247)]!==undefined){let _0x18365f=Number(_0x47ac74['val']);if(typeof _0x18365f===_0x516909(0x213)){if(_0x18365f<=1.05&&_0x38cad0['to'][_0x516909(0x21e)]('LEVEL'))_0x18365f=_0x18365f*0x64;_0x30ee6d=Math['round'](_0x18365f),_0x585d24=!![];break;}}}catch(_0x35673b){}}}}const _0x5304fd=await _0x2a8a8d['getStateAsync'](_0x516909(0x1fc));let _0xf759e6=[];if(_0x5304fd&&_0x5304fd[_0x516909(0x247)])try{_0xf759e6=JSON[_0x516909(0x1e8)](_0x5304fd[_0x516909(0x247)]);}catch(_0x295fac){}_0xf759e6[_0x516909(0x228)]({'ts':Date[_0x516909(0x1f9)](),'room':_0x2638f1||_0x516909(0x23c),'t_in':_0x1e7017,'t_out':_0x346a53,'valve':_0x30ee6d});if(_0xf759e6['length']>THERMO_LOG_SIZE)_0xf759e6['shift']();await _0x2a8a8d['setStateAsync'](_0x516909(0x1fc),{'val':JSON[_0x516909(0x232)](_0xf759e6),'ack':!![]});}async function saveCompletedSequence(_0x21f6b7){const _0xa478d9=a5_0x1dd6;try{const _0x1ccfb4=await _0x21f6b7[_0xa478d9(0x24a)](_0xa478d9(0x244));let _0x46f5d4=[];if(_0x1ccfb4&&_0x1ccfb4[_0xa478d9(0x247)])try{_0x46f5d4=JSON[_0xa478d9(0x1e8)](_0x1ccfb4['val']);}catch(_0xb9f1d5){}const _0x2e34a4=activeSequence[0x0]['ts'],_0xa0fee3=activeSequence[_0xa478d9(0x238)](_0x4cfaf9=>({'loc':_0x4cfaf9[_0xa478d9(0x23b)],'t_delta':Math[_0xa478d9(0x222)]((_0x4cfaf9['ts']-_0x2e34a4)/0x3e8)})),_0x20070c={'timestamp':new Date(_0x2e34a4)[_0xa478d9(0x234)](),'steps':_0xa0fee3,'duration':Math[_0xa478d9(0x222)]((activeSequence[activeSequence[_0xa478d9(0x248)]-0x1]['ts']-_0x2e34a4)/0x3e8),'daytime':new Date(_0x2e34a4)[_0xa478d9(0x218)]()};_0x46f5d4[_0xa478d9(0x228)](_0x20070c);if(_0x46f5d4['length']>MAX_TRAINING_SET_SIZE)_0x46f5d4['shift']();await _0x21f6b7[_0xa478d9(0x231)]('LTM.trainingData.sequences',{'val':JSON[_0xa478d9(0x232)](_0x46f5d4),'ack':!![]}),_0x21f6b7['isProVersion']&&_0x21f6b7[_0xa478d9(0x219)]&&_0x21f6b7[_0xa478d9(0x219)](_0xa478d9(0x203),{'sequence':_0x20070c});}catch(_0x1f6376){_0x21f6b7[_0xa478d9(0x1ed)][_0xa478d9(0x1df)]('[RECORDER]\x20Error:\x20'+_0x1f6376[_0xa478d9(0x23f)]);}}async function recordSequence(_0x562929,_0xb02119){const _0x5073d4=a5_0x1dd6,_0x7eb38=(_0xb02119['type']||'')[_0x5073d4(0x22a)](),_0x41505a=[_0x5073d4(0x24c),_0x5073d4(0x1eb),_0x5073d4(0x217),_0x5073d4(0x237),_0x5073d4(0x235),_0x5073d4(0x1fd),_0x5073d4(0x243),_0x5073d4(0x240),'fenster',_0x5073d4(0x1e2),'kontakt','light',_0x5073d4(0x205),_0x5073d4(0x1fe),'schalter','dimmer',_0x5073d4(0x245)];if(!_0x41505a[_0x5073d4(0x227)](_0x1c78b8=>_0x7eb38['includes'](_0x1c78b8)))return;if(!_0xb02119['value'])return;if(sequenceTimer)clearTimeout(sequenceTimer);activeSequence[_0x5073d4(0x228)]({'loc':_0xb02119['location']||_0x5073d4(0x23c),'id':_0xb02119['id'],'ts':Date['now']()}),sequenceTimer=setTimeout(async()=>{const _0x30eef1=_0x5073d4;if(activeSequence[_0x30eef1(0x248)]>0x1)await saveCompletedSequence(_0x562929);activeSequence=[];},SEQUENCE_TIMEOUT_MS);}function startExitTimer(_0x21248c){const _0xfc051b=a5_0x1dd6;abortExitTimer(_0x21248c),_0x21248c[_0xfc051b(0x1ef)]=!![],_0x21248c[_0xfc051b(0x1e1)]=setTimeout(()=>{const _0x2ba19e=_0xfc051b;_0x21248c[_0x2ba19e(0x1ef)]=![];},EXIT_GRACE_PERIOD_SECONDS*0x3e8),_0x21248c['exitTimer']=setTimeout(()=>{const _0x40a0fc=_0xfc051b;setPresence(_0x21248c,![]),_0x21248c[_0x40a0fc(0x211)]=null;},EXIT_TIMER_MINUTES*0x3c*0x3e8);}function abortExitTimer(_0x39db10){const _0x153b94=a5_0x1dd6;if(_0x39db10[_0x153b94(0x211)])clearTimeout(_0x39db10[_0x153b94(0x211)]);if(_0x39db10[_0x153b94(0x1e1)])clearTimeout(_0x39db10[_0x153b94(0x1e1)]);_0x39db10[_0x153b94(0x211)]=null,_0x39db10[_0x153b94(0x1e1)]=null,_0x39db10[_0x153b94(0x1ef)]=![];}async function setPresence(_0x432d6f,_0x33a484){const _0x402123=a5_0x1dd6;if(_0x432d6f['isPresent']===_0x33a484)return;_0x432d6f[_0x402123(0x22d)]=_0x33a484,await _0x432d6f[_0x402123(0x231)](_0x402123(0x210),{'val':_0x33a484,'ack':!![]});}async function processSensorEvent(_0x52591c,_0x4193cf,_0x2b095e,_0x7c6f91){const _0x56b4c8=a5_0x1dd6;if(!_0x7c6f91)return null;const _0x4ea979=_0x2b095e[_0x56b4c8(0x247)],_0x579612=Date[_0x56b4c8(0x1f9)](),_0x3d66d7=_0x52591c[_0x56b4c8(0x22e)][_0x4193cf],_0x566458=(_0x7c6f91[_0x56b4c8(0x23a)]||'')['toLowerCase'](),_0x509243=_0x566458[_0x56b4c8(0x21e)](_0x56b4c8(0x21b))||_0x566458[_0x56b4c8(0x21e)](_0x56b4c8(0x1ec))||_0x566458[_0x56b4c8(0x21e)](_0x56b4c8(0x206))||_0x566458[_0x56b4c8(0x21e)](_0x56b4c8(0x1e6))||_0x566458[_0x56b4c8(0x21e)](_0x56b4c8(0x20d));if(_0x509243&&typeof _0x4ea979===_0x56b4c8(0x213)){if(_0x4ea979>0x50||_0x4ea979<-0x32)return _0x52591c[_0x56b4c8(0x1ed)][_0x56b4c8(0x22f)](_0x56b4c8(0x1dd)+_0x4ea979+_0x56b4c8(0x1f3)+_0x4193cf),null;}_0x52591c[_0x56b4c8(0x22e)][_0x4193cf]=_0x4ea979;if(!_0x7c6f91[_0x56b4c8(0x1e4)]&&_0x3d66d7!=undefined&&_0x3d66d7==_0x4ea979)return null;_0x52591c[_0x56b4c8(0x239)]&&_0x509243&&recordThermodynamics(_0x52591c,_0x4193cf,_0x4ea979,_0x7c6f91['location']);const _0x27848e={'timestamp':_0x579612,'id':_0x4193cf,'name':_0x7c6f91[_0x56b4c8(0x225)],'type':_0x7c6f91['type'],'location':_0x7c6f91[_0x56b4c8(0x1f7)],'value':_0x4ea979};_0x52591c[_0x56b4c8(0x246)][_0x56b4c8(0x208)](_0x27848e);if(_0x52591c[_0x56b4c8(0x246)]['length']>HISTORY_MAX_SIZE)_0x52591c[_0x56b4c8(0x246)][_0x56b4c8(0x233)]();await _0x52591c[_0x56b4c8(0x231)](_0x56b4c8(0x241),{'val':JSON[_0x56b4c8(0x232)](_0x27848e),'ack':!![]}),await _0x52591c[_0x56b4c8(0x231)](_0x56b4c8(0x201),{'val':JSON[_0x56b4c8(0x232)](_0x52591c[_0x56b4c8(0x246)]),'ack':!![]});if(_0x52591c[_0x56b4c8(0x239)]){_0x52591c[_0x56b4c8(0x20f)]['push'](_0x27848e);if(_0x52591c['rawEventLog'][_0x56b4c8(0x248)]>RAW_LOG_MAX_SIZE)_0x52591c[_0x56b4c8(0x20f)]['splice'](0x0,_0x52591c[_0x56b4c8(0x20f)][_0x56b4c8(0x248)]-RAW_LOG_MAX_SIZE);await _0x52591c[_0x56b4c8(0x231)](_0x56b4c8(0x21d),{'val':JSON[_0x56b4c8(0x232)](_0x52591c[_0x56b4c8(0x20f)]),'ack':!![]}),recordSequence(_0x52591c,_0x27848e);}if(_0x7c6f91[_0x56b4c8(0x1ee)]&&_0x4ea979===!![]){if(_0x52591c[_0x56b4c8(0x22d)]&&!_0x52591c['isGracePeriodActive'])startExitTimer(_0x52591c);else{if(!_0x52591c[_0x56b4c8(0x22d)])setPresence(_0x52591c,!![]);}}else{if(_0x7c6f91[_0x56b4c8(0x23a)]===_0x56b4c8(0x24c)&&_0x4ea979===!![]){if(_0x52591c[_0x56b4c8(0x211)])abortExitTimer(_0x52591c);if(!_0x52591c[_0x56b4c8(0x22d)]&&_0x52591c[_0x56b4c8(0x212)]===_0x56b4c8(0x21f))setPresence(_0x52591c,!![]);}}if(_0x52591c[_0x56b4c8(0x239)]&&_0x52591c['sendToPythonWrapper']){_0x7c6f91['type']==='motion'&&_0x4ea979===!![]&&_0x7c6f91[_0x56b4c8(0x1f7)]&&_0x52591c[_0x56b4c8(0x219)](_0x56b4c8(0x1e5),{'room':_0x7c6f91['location']});const _0x455b54=[_0x56b4c8(0x1fd),_0x56b4c8(0x243),_0x56b4c8(0x240),'fenster',_0x56b4c8(0x21a),_0x56b4c8(0x1f2),'lock',_0x56b4c8(0x1fa)][_0x56b4c8(0x227)](_0xff3f0c=>_0x566458[_0x56b4c8(0x21e)](_0xff3f0c)),_0x57e1f4=['light',_0x56b4c8(0x205),_0x56b4c8(0x1fe),_0x56b4c8(0x23d),_0x56b4c8(0x1ff),_0x56b4c8(0x245)][_0x56b4c8(0x227)](_0x17b794=>_0x566458[_0x56b4c8(0x21e)](_0x17b794)),_0x5ebf68=[_0x56b4c8(0x24c),_0x56b4c8(0x1eb),'präsenz',_0x56b4c8(0x237),_0x56b4c8(0x235)]['some'](_0x49b7a3=>_0x566458[_0x56b4c8(0x21e)](_0x49b7a3));if(_0x7c6f91[_0x56b4c8(0x1f7)]&&(_0x455b54||_0x57e1f4||_0x5ebf68)){const _0x25b19f=_0x4ea979===!![]||typeof _0x4ea979==='number'&&_0x4ea979>0x0,_0x168acb=_0x455b54&&!_0x25b19f&&_0x3d66d7!==undefined&&_0x3d66d7!=_0x4ea979;if(_0x25b19f||_0x168acb){const _0x20b7c3=_0x52591c[_0x56b4c8(0x22c)]||_0x579612,_0x17369d=(_0x579612-_0x20b7c3)/0x3e8;_0x52591c[_0x56b4c8(0x22c)]=_0x579612,_0x52591c[_0x56b4c8(0x219)](_0x56b4c8(0x220),{'room':_0x7c6f91[_0x56b4c8(0x1f7)],'dt':_0x17369d});}}}return _0x27848e;}module[a5_0x48db8a(0x21c)]={'processSensorEvent':processSensorEvent,'getOutsideTemperatureNumeric':getOutsideTemperatureNumeric,'setPresence':setPresence,'abortExitTimer':abortExitTimer,'startExitTimer':startExitTimer};