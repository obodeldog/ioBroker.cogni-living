const a5_0x1dcac1=a5_0x8f48;(function(_0x287d8b,_0x272a78){const _0x11f752=a5_0x8f48,_0x5318a0=_0x287d8b();while(!![]){try{const _0x34bfee=parseInt(_0x11f752(0x185))/0x1*(-parseInt(_0x11f752(0x190))/0x2)+parseInt(_0x11f752(0x16e))/0x3+parseInt(_0x11f752(0x1a6))/0x4*(-parseInt(_0x11f752(0x19b))/0x5)+parseInt(_0x11f752(0x162))/0x6*(parseInt(_0x11f752(0x143))/0x7)+-parseInt(_0x11f752(0x144))/0x8+parseInt(_0x11f752(0x14f))/0x9*(parseInt(_0x11f752(0x196))/0xa)+-parseInt(_0x11f752(0x172))/0xb*(-parseInt(_0x11f752(0x1a1))/0xc);if(_0x34bfee===_0x272a78)break;else _0x5318a0['push'](_0x5318a0['shift']());}catch(_0x1f19eb){_0x5318a0['push'](_0x5318a0['shift']());}}}(a5_0x50f2,0x29936));const a5_0xaa3cb5=(function(){let _0x4a5536=!![];return function(_0x1c713e,_0xd9ce4c){const _0x2a95f1=_0x4a5536?function(){const _0x3af5b2=a5_0x8f48;if(_0xd9ce4c){const _0x320b0e=_0xd9ce4c[_0x3af5b2(0x19e)](_0x1c713e,arguments);return _0xd9ce4c=null,_0x320b0e;}}:function(){};return _0x4a5536=![],_0x2a95f1;};}()),a5_0x175a47=a5_0xaa3cb5(this,function(){const _0x221b80=a5_0x8f48;return a5_0x175a47[_0x221b80(0x173)]()[_0x221b80(0x1ab)](_0x221b80(0x145))[_0x221b80(0x173)]()[_0x221b80(0x17d)](a5_0x175a47)[_0x221b80(0x1ab)](_0x221b80(0x145));});a5_0x175a47();'use strict';const HISTORY_MAX_SIZE=0x32,RAW_LOG_MAX_SIZE=0x9c4,THERMO_LOG_SIZE=0x3e8,SEQUENCE_TIMEOUT_MS=0x5*0x3c*0x3e8,MAX_TRAINING_SET_SIZE=0x1f4,EXIT_TIMER_MINUTES=0xf,EXIT_GRACE_PERIOD_SECONDS=0x1e;function a5_0x50f2(){const _0x22d1a7=['kontakt','toLowerCase','LTM.trainingData.sequences','eventHistory','log','dimmer','sendToPythonWrapper','getHours','door','now','lock','102BPDKcQ','SIMULATE_SIGNAL','.1.ACTUAL_TEMPERATURE','from','some','getStateAsync','.1.LEVEL','rawEventLog','config','sensorLastValues','type','val','798411zUGVVA','getForeignStateAsync','debug','message','22BMxTSU','toString','lastTrackerEventTime','events.history','handle','weatherunderground','exitGraceTimer','TRACK_EVENT','string','präsenz','LEVEL','constructor','light','licht','STATE','isProVersion','outdoorSensorId','window','presence','1qAFalW','setStateAsync','\x20from\x20','.LEVEL','stringify','fenster','schalter','.ACTUAL_TEMPERATURE','switch','.forecast.current.temperature','includes','672992DVNGfN','system.isPresent','temperature','motion','location','openweathermap','20YJHniO','exitTimer','shift','valveMapping','bewegung','50MgddYl','toISOString','replace','apply','[RECORDER]\x20Error:\x20','.1.VALVE_STATE','1131672dVHdPg','isGracePeriodActive','LTM.rawEventLog','klima','Valve','94804zOuKje','temperatur','weatherInstance','lampe','push','search','exports','tür','LTM.trainingData.thermodynamics','events.lastEvent','loc','Temperature','STATUS','isPresent','120862tkxLMp','1848056VgsCnh','(((.+)+)+)+$','unshift','useWeather','pop','contact','round','daswetter','occupancy','Unknown','.NextHours.Location_1.Day_1.current.temp_value','1019412sEloMo','number','ANALYZE_SEQUENCE','parse','length','.forecast.current.temp','name','error'];a5_0x50f2=function(){return _0x22d1a7;};return a5_0x50f2();}let activeSequence=[],sequenceTimer=null;async function getOutsideTemperatureNumeric(_0x3c3eac){const _0x1fb1c9=a5_0x8f48;if(_0x3c3eac[_0x1fb1c9(0x16a)][_0x1fb1c9(0x182)])try{const _0x481968=await _0x3c3eac[_0x1fb1c9(0x16f)](_0x3c3eac[_0x1fb1c9(0x16a)]['outdoorSensorId']);if(_0x481968&&_0x481968[_0x1fb1c9(0x16d)]!==undefined&&_0x481968[_0x1fb1c9(0x16d)]!==null)return parseFloat(_0x481968[_0x1fb1c9(0x16d)]);}catch(_0x598bd1){}const _0x51d1f8=_0x3c3eac['config'][_0x1fb1c9(0x1a8)];if(!_0x3c3eac[_0x1fb1c9(0x16a)][_0x1fb1c9(0x147)]||!_0x51d1f8)return null;try{let _0x2d4210='';if(_0x51d1f8[_0x1fb1c9(0x18f)]('accuweather'))_0x2d4210=_0x51d1f8+'.Current.Temperature';else{if(_0x51d1f8['includes'](_0x1fb1c9(0x14b)))_0x2d4210=_0x51d1f8+_0x1fb1c9(0x14e);else{if(_0x51d1f8['includes'](_0x1fb1c9(0x195)))_0x2d4210=_0x51d1f8+_0x1fb1c9(0x18e);else{if(_0x51d1f8[_0x1fb1c9(0x18f)](_0x1fb1c9(0x177)))_0x2d4210=_0x51d1f8+_0x1fb1c9(0x154);}}}if(_0x2d4210){const _0x9c0971=await _0x3c3eac['getForeignStateAsync'](_0x2d4210);if(_0x9c0971&&_0x9c0971[_0x1fb1c9(0x16d)]!==undefined&&_0x9c0971[_0x1fb1c9(0x16d)]!==null)return parseFloat(_0x9c0971[_0x1fb1c9(0x16d)]);}}catch(_0x48afa5){}return null;}async function recordThermodynamics(_0x50a80e,_0x1d8790,_0x304582,_0x3ceee8){const _0x4f6a73=a5_0x8f48,_0x686289=await getOutsideTemperatureNumeric(_0x50a80e);if(_0x686289===null)return;let _0x3f16e5=0x0,_0x540f2c=![];if(_0x50a80e['config'][_0x4f6a73(0x199)])try{let _0x1a81a8=_0x50a80e[_0x4f6a73(0x16a)]['valveMapping'];if(typeof _0x1a81a8===_0x4f6a73(0x17a))_0x1a81a8=JSON[_0x4f6a73(0x152)](_0x1a81a8);if(_0x1a81a8[_0x1d8790]){const _0x38659f=_0x1a81a8[_0x1d8790],_0x5c651d=await _0x50a80e[_0x4f6a73(0x16f)](_0x38659f);if(_0x5c651d&&_0x5c651d[_0x4f6a73(0x16d)]!==null&&_0x5c651d['val']!==undefined){let _0x5617bc=Number(_0x5c651d[_0x4f6a73(0x16d)]);if(_0x5617bc<=1.05&&!_0x38659f['includes'](_0x4f6a73(0x1b2))&&!_0x38659f['includes'](_0x4f6a73(0x180)))_0x5617bc=_0x5617bc*0x64;_0x3f16e5=Math[_0x4f6a73(0x14a)](_0x5617bc),_0x540f2c=!![];}}}catch(_0x3aa21e){}if(!_0x540f2c){const _0x27407e=[{'from':_0x4f6a73(0x164),'to':_0x4f6a73(0x168)},{'from':_0x4f6a73(0x164),'to':_0x4f6a73(0x1a0)},{'from':'.1.TEMPERATURE','to':'.4.VALVE_STATE'},{'from':_0x4f6a73(0x18c),'to':_0x4f6a73(0x188)},{'from':_0x4f6a73(0x192),'to':'level'},{'from':_0x4f6a73(0x1b1),'to':_0x4f6a73(0x1a5)}];for(const _0x186e74 of _0x27407e){if(_0x1d8790[_0x4f6a73(0x18f)](_0x186e74['from'])){const _0x1ad161=_0x1d8790[_0x4f6a73(0x19d)](_0x186e74[_0x4f6a73(0x165)],_0x186e74['to']);try{const _0x3d3c2b=await _0x50a80e[_0x4f6a73(0x16f)](_0x1ad161);if(_0x3d3c2b&&_0x3d3c2b[_0x4f6a73(0x16d)]!==null&&_0x3d3c2b[_0x4f6a73(0x16d)]!==undefined){let _0x59b2f9=Number(_0x3d3c2b[_0x4f6a73(0x16d)]);if(typeof _0x59b2f9===_0x4f6a73(0x150)){if(_0x59b2f9<=1.05&&_0x186e74['to'][_0x4f6a73(0x18f)](_0x4f6a73(0x17c)))_0x59b2f9=_0x59b2f9*0x64;_0x3f16e5=Math['round'](_0x59b2f9),_0x540f2c=!![];break;}}}catch(_0x16ec3f){}}}}const _0x493a0f=await _0x50a80e[_0x4f6a73(0x167)](_0x4f6a73(0x1ae));let _0x248951=[];if(_0x493a0f&&_0x493a0f[_0x4f6a73(0x16d)])try{_0x248951=JSON['parse'](_0x493a0f[_0x4f6a73(0x16d)]);}catch(_0x337690){}_0x248951[_0x4f6a73(0x1aa)]({'ts':Date[_0x4f6a73(0x160)](),'room':_0x3ceee8||_0x4f6a73(0x14d),'t_in':_0x304582,'t_out':_0x686289,'valve':_0x3f16e5});if(_0x248951[_0x4f6a73(0x153)]>THERMO_LOG_SIZE)_0x248951[_0x4f6a73(0x198)]();await _0x50a80e['setStateAsync'](_0x4f6a73(0x1ae),{'val':JSON[_0x4f6a73(0x189)](_0x248951),'ack':!![]});}async function saveCompletedSequence(_0x41ad17){const _0x2b824a=a5_0x8f48;try{const _0x356675=await _0x41ad17[_0x2b824a(0x167)]('LTM.trainingData.sequences');let _0x247242=[];if(_0x356675&&_0x356675[_0x2b824a(0x16d)])try{_0x247242=JSON[_0x2b824a(0x152)](_0x356675[_0x2b824a(0x16d)]);}catch(_0x310172){}const _0x5f2bf0=activeSequence[0x0]['ts'],_0x153d25=activeSequence['map'](_0x56f1df=>({'loc':_0x56f1df[_0x2b824a(0x1b0)],'t_delta':Math[_0x2b824a(0x14a)]((_0x56f1df['ts']-_0x5f2bf0)/0x3e8)})),_0x27b5c8={'timestamp':new Date(_0x5f2bf0)[_0x2b824a(0x19c)](),'steps':_0x153d25,'duration':Math[_0x2b824a(0x14a)]((activeSequence[activeSequence['length']-0x1]['ts']-_0x5f2bf0)/0x3e8),'daytime':new Date(_0x5f2bf0)[_0x2b824a(0x15e)]()};_0x247242[_0x2b824a(0x1aa)](_0x27b5c8);if(_0x247242[_0x2b824a(0x153)]>MAX_TRAINING_SET_SIZE)_0x247242[_0x2b824a(0x198)]();await _0x41ad17[_0x2b824a(0x186)](_0x2b824a(0x159),{'val':JSON['stringify'](_0x247242),'ack':!![]}),_0x41ad17[_0x2b824a(0x181)]&&_0x41ad17[_0x2b824a(0x15d)]&&_0x41ad17['sendToPythonWrapper'](_0x2b824a(0x151),{'sequence':_0x27b5c8});}catch(_0x3464b2){_0x41ad17[_0x2b824a(0x15b)][_0x2b824a(0x156)](_0x2b824a(0x19f)+_0x3464b2[_0x2b824a(0x171)]);}}async function recordSequence(_0x530394,_0x5eb11e){const _0x2647cd=a5_0x8f48,_0x1b10eb=(_0x5eb11e[_0x2647cd(0x16c)]||'')[_0x2647cd(0x158)](),_0x423197=['motion',_0x2647cd(0x19a),_0x2647cd(0x17b),_0x2647cd(0x184),_0x2647cd(0x14c),_0x2647cd(0x15f),_0x2647cd(0x1ad),_0x2647cd(0x183),_0x2647cd(0x18a),_0x2647cd(0x149),_0x2647cd(0x157),'light',_0x2647cd(0x17f),_0x2647cd(0x18d),_0x2647cd(0x18b),_0x2647cd(0x15c),_0x2647cd(0x1a9)];if(!_0x423197[_0x2647cd(0x166)](_0x3a8445=>_0x1b10eb['includes'](_0x3a8445)))return;if(!_0x5eb11e['value'])return;if(sequenceTimer)clearTimeout(sequenceTimer);activeSequence[_0x2647cd(0x1aa)]({'loc':_0x5eb11e[_0x2647cd(0x194)]||_0x2647cd(0x14d),'id':_0x5eb11e['id'],'ts':Date[_0x2647cd(0x160)]()}),sequenceTimer=setTimeout(async()=>{if(activeSequence['length']>0x1)await saveCompletedSequence(_0x530394);activeSequence=[];},SEQUENCE_TIMEOUT_MS);}function startExitTimer(_0x40a51a){const _0x1e6f41=a5_0x8f48;abortExitTimer(_0x40a51a),_0x40a51a[_0x1e6f41(0x1a2)]=!![],_0x40a51a[_0x1e6f41(0x178)]=setTimeout(()=>{const _0x4118cc=_0x1e6f41;_0x40a51a[_0x4118cc(0x1a2)]=![];},EXIT_GRACE_PERIOD_SECONDS*0x3e8),_0x40a51a[_0x1e6f41(0x197)]=setTimeout(()=>{const _0x29dc67=_0x1e6f41;setPresence(_0x40a51a,![]),_0x40a51a[_0x29dc67(0x197)]=null;},EXIT_TIMER_MINUTES*0x3c*0x3e8);}function abortExitTimer(_0x428603){const _0x204829=a5_0x8f48;if(_0x428603[_0x204829(0x197)])clearTimeout(_0x428603['exitTimer']);if(_0x428603[_0x204829(0x178)])clearTimeout(_0x428603[_0x204829(0x178)]);_0x428603['exitTimer']=null,_0x428603[_0x204829(0x178)]=null,_0x428603['isGracePeriodActive']=![];}async function setPresence(_0x4a98a5,_0x3a0e20){const _0x5382f8=a5_0x8f48;if(_0x4a98a5['isPresent']===_0x3a0e20)return;_0x4a98a5['isPresent']=_0x3a0e20,await _0x4a98a5['setStateAsync'](_0x5382f8(0x191),{'val':_0x3a0e20,'ack':!![]});}async function processSensorEvent(_0x2896aa,_0x3982e5,_0x10a580,_0x4f6207){const _0x3b1977=a5_0x8f48;if(!_0x4f6207)return null;const _0x370566=_0x10a580[_0x3b1977(0x16d)],_0x50ee8d=Date[_0x3b1977(0x160)](),_0x37d269=_0x2896aa[_0x3b1977(0x16b)][_0x3982e5],_0x4aaa3c=(_0x4f6207[_0x3b1977(0x16c)]||'')[_0x3b1977(0x158)](),_0xbf2f52=_0x4aaa3c[_0x3b1977(0x18f)](_0x3b1977(0x192))||_0x4aaa3c[_0x3b1977(0x18f)](_0x3b1977(0x1a7))||_0x4aaa3c[_0x3b1977(0x18f)](_0x3b1977(0x1a4))||_0x4aaa3c[_0x3b1977(0x18f)]('heizung')||_0x4aaa3c[_0x3b1977(0x18f)]('thermostat');if(_0xbf2f52&&typeof _0x370566===_0x3b1977(0x150)){if(_0x370566>0x50||_0x370566<-0x32)return _0x2896aa['log'][_0x3b1977(0x170)]('[RECORDER]\x20Ignored\x20implausible\x20temperature:\x20'+_0x370566+_0x3b1977(0x187)+_0x3982e5),null;}_0x2896aa[_0x3b1977(0x16b)][_0x3982e5]=_0x370566;if(!_0x4f6207['logDuplicates']&&_0x37d269!=undefined&&_0x37d269==_0x370566)return null;_0x2896aa[_0x3b1977(0x181)]&&_0xbf2f52&&recordThermodynamics(_0x2896aa,_0x3982e5,_0x370566,_0x4f6207['location']);const _0x46c06d={'timestamp':_0x50ee8d,'id':_0x3982e5,'name':_0x4f6207[_0x3b1977(0x155)],'type':_0x4f6207[_0x3b1977(0x16c)],'location':_0x4f6207[_0x3b1977(0x194)],'value':_0x370566};_0x2896aa['eventHistory'][_0x3b1977(0x146)](_0x46c06d);if(_0x2896aa[_0x3b1977(0x15a)][_0x3b1977(0x153)]>HISTORY_MAX_SIZE)_0x2896aa[_0x3b1977(0x15a)][_0x3b1977(0x148)]();await _0x2896aa[_0x3b1977(0x186)](_0x3b1977(0x1af),{'val':JSON[_0x3b1977(0x189)](_0x46c06d),'ack':!![]}),await _0x2896aa[_0x3b1977(0x186)](_0x3b1977(0x175),{'val':JSON['stringify'](_0x2896aa[_0x3b1977(0x15a)]),'ack':!![]});if(_0x2896aa[_0x3b1977(0x181)]){_0x2896aa[_0x3b1977(0x169)][_0x3b1977(0x1aa)](_0x46c06d);if(_0x2896aa[_0x3b1977(0x169)][_0x3b1977(0x153)]>RAW_LOG_MAX_SIZE)_0x2896aa[_0x3b1977(0x169)]['splice'](0x0,_0x2896aa[_0x3b1977(0x169)][_0x3b1977(0x153)]-RAW_LOG_MAX_SIZE);await _0x2896aa[_0x3b1977(0x186)](_0x3b1977(0x1a3),{'val':JSON['stringify'](_0x2896aa[_0x3b1977(0x169)]),'ack':!![]}),recordSequence(_0x2896aa,_0x46c06d);}if(_0x4f6207['isExit']&&_0x370566===!![]){if(_0x2896aa['isPresent']&&!_0x2896aa['isGracePeriodActive'])startExitTimer(_0x2896aa);else{if(!_0x2896aa[_0x3b1977(0x142)])setPresence(_0x2896aa,!![]);}}else{if(_0x4f6207[_0x3b1977(0x16c)]===_0x3b1977(0x193)&&_0x370566===!![]){if(_0x2896aa['exitTimer'])abortExitTimer(_0x2896aa);if(!_0x2896aa[_0x3b1977(0x142)]&&_0x2896aa['currentSystemMode']==='normal')setPresence(_0x2896aa,!![]);}}if(_0x2896aa[_0x3b1977(0x181)]&&_0x2896aa['sendToPythonWrapper']){_0x4f6207[_0x3b1977(0x16c)]===_0x3b1977(0x193)&&_0x370566===!![]&&_0x4f6207[_0x3b1977(0x194)]&&_0x2896aa['sendToPythonWrapper'](_0x3b1977(0x163),{'room':_0x4f6207[_0x3b1977(0x194)]});const _0x2f96ea=['door',_0x3b1977(0x1ad),'window',_0x3b1977(0x18a),'griff',_0x3b1977(0x176),_0x3b1977(0x161),'schloss']['some'](_0x27a6b0=>_0x4aaa3c[_0x3b1977(0x18f)](_0x27a6b0)),_0x1ba9a1=[_0x3b1977(0x17e),_0x3b1977(0x17f),'switch',_0x3b1977(0x18b),_0x3b1977(0x15c),_0x3b1977(0x1a9)][_0x3b1977(0x166)](_0x3388a1=>_0x4aaa3c['includes'](_0x3388a1)),_0x351eaf=[_0x3b1977(0x193),_0x3b1977(0x19a),_0x3b1977(0x17b),'presence',_0x3b1977(0x14c)][_0x3b1977(0x166)](_0x262ebb=>_0x4aaa3c[_0x3b1977(0x18f)](_0x262ebb));if(_0x4f6207[_0x3b1977(0x194)]&&(_0x2f96ea||_0x1ba9a1||_0x351eaf)){const _0x134b32=_0x370566===!![]||typeof _0x370566===_0x3b1977(0x150)&&_0x370566>0x0,_0x8a51aa=_0x2f96ea&&!_0x134b32&&_0x37d269!==undefined&&_0x37d269!=_0x370566;if(_0x134b32||_0x8a51aa){const _0x2c7cb4=_0x2896aa[_0x3b1977(0x174)]||_0x50ee8d,_0x4f1200=(_0x50ee8d-_0x2c7cb4)/0x3e8;_0x2896aa[_0x3b1977(0x174)]=_0x50ee8d,_0x2896aa[_0x3b1977(0x15d)](_0x3b1977(0x179),{'room':_0x4f6207[_0x3b1977(0x194)],'dt':_0x4f1200});}}}return _0x46c06d;}function a5_0x8f48(_0x5f0817,_0x3cc2af){const _0x538e21=a5_0x50f2();return a5_0x8f48=function(_0x175a47,_0xaa3cb5){_0x175a47=_0x175a47-0x142;let _0x50f2da=_0x538e21[_0x175a47];return _0x50f2da;},a5_0x8f48(_0x5f0817,_0x3cc2af);}module[a5_0x1dcac1(0x1ac)]={'processSensorEvent':processSensorEvent,'getOutsideTemperatureNumeric':getOutsideTemperatureNumeric,'setPresence':setPresence,'abortExitTimer':abortExitTimer,'startExitTimer':startExitTimer};