(function(_0x231b74,_0x5980ef){const _0x524892=a5_0x1811,_0x27bdcc=_0x231b74();while(!![]){try{const _0x2fe44a=parseInt(_0x524892(0xdf))/0x1+parseInt(_0x524892(0xcb))/0x2*(parseInt(_0x524892(0xa8))/0x3)+-parseInt(_0x524892(0xda))/0x4*(-parseInt(_0x524892(0xf2))/0x5)+-parseInt(_0x524892(0xc1))/0x6*(parseInt(_0x524892(0xb0))/0x7)+parseInt(_0x524892(0x105))/0x8*(parseInt(_0x524892(0xcf))/0x9)+-parseInt(_0x524892(0xc2))/0xa+-parseInt(_0x524892(0x101))/0xb;if(_0x2fe44a===_0x5980ef)break;else _0x27bdcc['push'](_0x27bdcc['shift']());}catch(_0x2b1337){_0x27bdcc['push'](_0x27bdcc['shift']());}}}(a5_0x39bf,0xa8ce8));const a5_0x44ac36=(function(){let _0x23d4f1=!![];return function(_0x57f268,_0x286f5e){const _0x2a0dac=_0x23d4f1?function(){const _0x5883e5=a5_0x1811;if(_0x286f5e){const _0x4383e4=_0x286f5e[_0x5883e5(0xf0)](_0x57f268,arguments);return _0x286f5e=null,_0x4383e4;}}:function(){};return _0x23d4f1=![],_0x2a0dac;};}()),a5_0x46a186=a5_0x44ac36(this,function(){const _0xc21905=a5_0x1811;return a5_0x46a186[_0xc21905(0xe6)]()['search'](_0xc21905(0xd8))[_0xc21905(0xe6)]()[_0xc21905(0xf1)](a5_0x46a186)[_0xc21905(0xd6)]('(((.+)+)+)+$');});a5_0x46a186();'use strict';const HISTORY_MAX_SIZE=0x32,RAW_LOG_MAX_SIZE=0x9c4,THERMO_LOG_SIZE=0x3e8,SEQUENCE_TIMEOUT_MS=0x5*0x3c*0x3e8,MAX_TRAINING_SET_SIZE=0x1f4,EXIT_TIMER_MINUTES=0xf,EXIT_GRACE_PERIOD_SECONDS=0x1e;let activeSequence=[],sequenceTimer=null;async function getOutsideTemperatureNumeric(_0x2c3d83){const _0x45f5cb=a5_0x1811;if(_0x2c3d83[_0x45f5cb(0xe1)]['outdoorSensorId'])try{const _0x4e0178=await _0x2c3d83[_0x45f5cb(0xe0)](_0x2c3d83['config']['outdoorSensorId']);if(_0x4e0178&&_0x4e0178[_0x45f5cb(0xaa)]!==undefined&&_0x4e0178[_0x45f5cb(0xaa)]!==null)return parseFloat(_0x4e0178['val']);}catch(_0x60917a){}const _0x1bc278=_0x2c3d83[_0x45f5cb(0xe1)][_0x45f5cb(0x110)];if(!_0x2c3d83[_0x45f5cb(0xe1)]['useWeather']||!_0x1bc278)return null;try{let _0x5a81bc='';if(_0x1bc278[_0x45f5cb(0xe3)](_0x45f5cb(0xaf)))_0x5a81bc=_0x1bc278+_0x45f5cb(0xae);else{if(_0x1bc278[_0x45f5cb(0xe3)](_0x45f5cb(0xee)))_0x5a81bc=_0x1bc278+'.NextHours.Location_1.Day_1.current.temp_value';else{if(_0x1bc278[_0x45f5cb(0xe3)](_0x45f5cb(0xa7)))_0x5a81bc=_0x1bc278+'.forecast.current.temperature';else{if(_0x1bc278['includes'](_0x45f5cb(0xca)))_0x5a81bc=_0x1bc278+'.forecast.current.temp';}}}if(_0x5a81bc){const _0x36799d=await _0x2c3d83['getForeignStateAsync'](_0x5a81bc);if(_0x36799d&&_0x36799d[_0x45f5cb(0xaa)]!==undefined&&_0x36799d[_0x45f5cb(0xaa)]!==null)return parseFloat(_0x36799d[_0x45f5cb(0xaa)]);}}catch(_0x3660d7){}return null;}async function recordThermodynamics(_0x5a9a9e,_0x5e7041,_0x5aa9d9,_0x30d4e3){const _0x4bb5ab=a5_0x1811,_0x44a402=await getOutsideTemperatureNumeric(_0x5a9a9e);if(_0x44a402===null)return;let _0x2e2267=0x0,_0x5a698c=![];if(_0x5a9a9e[_0x4bb5ab(0xe1)][_0x4bb5ab(0xb2)])try{let _0x184cc4=_0x5a9a9e[_0x4bb5ab(0xe1)]['valveMapping'];if(typeof _0x184cc4==='string')_0x184cc4=JSON['parse'](_0x184cc4);if(_0x184cc4[_0x5e7041]){const _0x5a9519=_0x184cc4[_0x5e7041],_0x42fd1e=await _0x5a9a9e[_0x4bb5ab(0xe0)](_0x5a9519);if(_0x42fd1e&&_0x42fd1e[_0x4bb5ab(0xaa)]!==null&&_0x42fd1e['val']!==undefined){let _0x40ac40=Number(_0x42fd1e[_0x4bb5ab(0xaa)]);if(_0x40ac40<=1.05&&!_0x5a9519[_0x4bb5ab(0xe3)](_0x4bb5ab(0xc7))&&!_0x5a9519[_0x4bb5ab(0xe3)](_0x4bb5ab(0xf6)))_0x40ac40=_0x40ac40*0x64;_0x2e2267=Math[_0x4bb5ab(0x107)](_0x40ac40),_0x5a698c=!![];}}}catch(_0x2b9d8f){}if(!_0x5a698c){const _0x3db29d=[{'from':_0x4bb5ab(0xab),'to':_0x4bb5ab(0xe2)},{'from':_0x4bb5ab(0xab),'to':_0x4bb5ab(0xb1)},{'from':'.1.TEMPERATURE','to':_0x4bb5ab(0xd2)},{'from':_0x4bb5ab(0xf7),'to':_0x4bb5ab(0xec)},{'from':_0x4bb5ab(0xc3),'to':_0x4bb5ab(0xf8)},{'from':_0x4bb5ab(0xf5),'to':'Valve'}];for(const _0x49edc1 of _0x3db29d){if(_0x5e7041[_0x4bb5ab(0xe3)](_0x49edc1[_0x4bb5ab(0xb8)])){const _0x163f55=_0x5e7041[_0x4bb5ab(0xed)](_0x49edc1[_0x4bb5ab(0xb8)],_0x49edc1['to']);try{const _0x1fd685=await _0x5a9a9e[_0x4bb5ab(0xe0)](_0x163f55);if(_0x1fd685&&_0x1fd685[_0x4bb5ab(0xaa)]!==null&&_0x1fd685[_0x4bb5ab(0xaa)]!==undefined){let _0x29dd7e=Number(_0x1fd685[_0x4bb5ab(0xaa)]);if(typeof _0x29dd7e===_0x4bb5ab(0xe8)){if(_0x29dd7e<=1.05&&_0x49edc1['to'][_0x4bb5ab(0xe3)](_0x4bb5ab(0xce)))_0x29dd7e=_0x29dd7e*0x64;_0x2e2267=Math[_0x4bb5ab(0x107)](_0x29dd7e),_0x5a698c=!![];break;}}}catch(_0x5363b1){}}}}const _0x14cc3d=await _0x5a9a9e[_0x4bb5ab(0xdd)](_0x4bb5ab(0x104));let _0x88d50b=[];if(_0x14cc3d&&_0x14cc3d[_0x4bb5ab(0xaa)])try{_0x88d50b=JSON[_0x4bb5ab(0xe4)](_0x14cc3d[_0x4bb5ab(0xaa)]);}catch(_0x23063e){}_0x88d50b[_0x4bb5ab(0x109)]({'ts':Date['now'](),'room':_0x30d4e3||_0x4bb5ab(0xb7),'t_in':_0x5aa9d9,'t_out':_0x44a402,'valve':_0x2e2267});if(_0x88d50b[_0x4bb5ab(0x10f)]>THERMO_LOG_SIZE)_0x88d50b[_0x4bb5ab(0xfa)]();await _0x5a9a9e[_0x4bb5ab(0x10a)](_0x4bb5ab(0x104),{'val':JSON[_0x4bb5ab(0xd5)](_0x88d50b),'ack':!![]});}function a5_0x39bf(){const _0x37cd6e=['light','map','getStateAsync','handle','173847ROEfKR','getForeignStateAsync','config','.1.LEVEL','includes','parse','fenster','toString','occupancy','number','kontakt','licht','lock','.LEVEL','replace','daswetter','motion','apply','constructor','6523485ZoDBIO','toLowerCase','currentSystemMode','Temperature','STATE','.ACTUAL_TEMPERATURE','level','location','shift','value','schloss','error','schalter','bewegung','dimmer','1827166oACvHg','switch','toISOString','LTM.trainingData.thermodynamics','112oATdML','events.lastEvent','round','type','push','setStateAsync','now','presence','log','exitTimer','length','weatherInstance','lampe','openweathermap','388473yZQkpt','präsenz','val','.1.ACTUAL_TEMPERATURE','contact','isProVersion','.Current.Temperature','accuweather','322483KUJUAC','.1.VALVE_STATE','valveMapping','some','rawEventLog','LTM.rawEventLog','isPresent','Unknown','from','heizung','TRACK_EVENT','splice','loc','debug','sensorLastValues','tür','isGracePeriodActive','108hbOfkW','7666550lUxHBp','temperature','exitGraceTimer','sendToPythonWrapper','system.isPresent','STATUS','\x20from\x20','eventHistory','weatherunderground','6XWQhZH','door','getHours','LEVEL','376983liTAGq','[RECORDER]\x20Ignored\x20implausible\x20temperature:\x20','[RECORDER]\x20Error:\x20','.4.VALVE_STATE','SIMULATE_SIGNAL','normal','stringify','search','message','(((.+)+)+)+$','window','4TVSsoG'];a5_0x39bf=function(){return _0x37cd6e;};return a5_0x39bf();}async function saveCompletedSequence(_0x4440e4){const _0x53126b=a5_0x1811;try{const _0x122b7c=await _0x4440e4[_0x53126b(0xdd)]('LTM.trainingData.sequences');let _0x20ab85=[];if(_0x122b7c&&_0x122b7c[_0x53126b(0xaa)])try{_0x20ab85=JSON[_0x53126b(0xe4)](_0x122b7c[_0x53126b(0xaa)]);}catch(_0x14a95d){}const _0x2f2eb5=activeSequence[0x0]['ts'],_0x5309c8=activeSequence[_0x53126b(0xdc)](_0x128ce2=>({'loc':_0x128ce2[_0x53126b(0xbc)],'t_delta':Math['round']((_0x128ce2['ts']-_0x2f2eb5)/0x3e8)})),_0x458da6={'timestamp':new Date(_0x2f2eb5)[_0x53126b(0x103)](),'steps':_0x5309c8,'duration':Math[_0x53126b(0x107)]((activeSequence[activeSequence[_0x53126b(0x10f)]-0x1]['ts']-_0x2f2eb5)/0x3e8),'daytime':new Date(_0x2f2eb5)[_0x53126b(0xcd)]()};_0x20ab85[_0x53126b(0x109)](_0x458da6);if(_0x20ab85[_0x53126b(0x10f)]>MAX_TRAINING_SET_SIZE)_0x20ab85[_0x53126b(0xfa)]();await _0x4440e4[_0x53126b(0x10a)]('LTM.trainingData.sequences',{'val':JSON[_0x53126b(0xd5)](_0x20ab85),'ack':!![]}),_0x4440e4[_0x53126b(0xad)]&&_0x4440e4[_0x53126b(0xc5)]&&_0x4440e4[_0x53126b(0xc5)]('ANALYZE_SEQUENCE',{'sequence':_0x458da6});}catch(_0x22414c){_0x4440e4[_0x53126b(0x10d)][_0x53126b(0xfd)](_0x53126b(0xd1)+_0x22414c[_0x53126b(0xd7)]);}}async function recordSequence(_0x1fe34f,_0x472958){const _0x7c1f2a=a5_0x1811,_0x4724de=(_0x472958[_0x7c1f2a(0x108)]||'')[_0x7c1f2a(0xf3)](),_0x343ab3=[_0x7c1f2a(0xef),_0x7c1f2a(0xff),_0x7c1f2a(0xa9),_0x7c1f2a(0x10c),'occupancy',_0x7c1f2a(0xcc),_0x7c1f2a(0xbf),_0x7c1f2a(0xd9),'fenster',_0x7c1f2a(0xac),_0x7c1f2a(0xe9),_0x7c1f2a(0xdb),_0x7c1f2a(0xea),_0x7c1f2a(0x102),_0x7c1f2a(0xfe),_0x7c1f2a(0x100),'lampe'];if(!_0x343ab3[_0x7c1f2a(0xb3)](_0x517431=>_0x4724de[_0x7c1f2a(0xe3)](_0x517431)))return;if(!_0x472958[_0x7c1f2a(0xfb)])return;if(sequenceTimer)clearTimeout(sequenceTimer);activeSequence[_0x7c1f2a(0x109)]({'loc':_0x472958[_0x7c1f2a(0xf9)]||_0x7c1f2a(0xb7),'id':_0x472958['id'],'ts':Date['now']()}),sequenceTimer=setTimeout(async()=>{const _0x1f5df5=_0x7c1f2a;if(activeSequence[_0x1f5df5(0x10f)]>0x1)await saveCompletedSequence(_0x1fe34f);activeSequence=[];},SEQUENCE_TIMEOUT_MS);}function startExitTimer(_0x7d3e96){const _0x454f54=a5_0x1811;abortExitTimer(_0x7d3e96),_0x7d3e96[_0x454f54(0xc0)]=!![],_0x7d3e96['exitGraceTimer']=setTimeout(()=>{_0x7d3e96['isGracePeriodActive']=![];},EXIT_GRACE_PERIOD_SECONDS*0x3e8),_0x7d3e96['exitTimer']=setTimeout(()=>{setPresence(_0x7d3e96,![]),_0x7d3e96['exitTimer']=null;},EXIT_TIMER_MINUTES*0x3c*0x3e8);}function abortExitTimer(_0x4ec9c8){const _0x2f7e10=a5_0x1811;if(_0x4ec9c8['exitTimer'])clearTimeout(_0x4ec9c8[_0x2f7e10(0x10e)]);if(_0x4ec9c8['exitGraceTimer'])clearTimeout(_0x4ec9c8[_0x2f7e10(0xc4)]);_0x4ec9c8[_0x2f7e10(0x10e)]=null,_0x4ec9c8[_0x2f7e10(0xc4)]=null,_0x4ec9c8[_0x2f7e10(0xc0)]=![];}async function setPresence(_0x4296a8,_0x3698ca){const _0x1270ca=a5_0x1811;if(_0x4296a8[_0x1270ca(0xb6)]===_0x3698ca)return;_0x4296a8[_0x1270ca(0xb6)]=_0x3698ca,await _0x4296a8[_0x1270ca(0x10a)](_0x1270ca(0xc6),{'val':_0x3698ca,'ack':!![]});}function a5_0x1811(_0x2b18be,_0x2ea944){const _0x232785=a5_0x39bf();return a5_0x1811=function(_0x46a186,_0x44ac36){_0x46a186=_0x46a186-0xa7;let _0x39bf3a=_0x232785[_0x46a186];return _0x39bf3a;},a5_0x1811(_0x2b18be,_0x2ea944);}async function processSensorEvent(_0x1415b1,_0xccbb36,_0x31fc9f,_0x33c9b6){const _0x29ed4e=a5_0x1811;if(!_0x33c9b6)return null;const _0xe104ec=_0x31fc9f['val'],_0x11226c=Date[_0x29ed4e(0x10b)](),_0x4a47af=_0x1415b1[_0x29ed4e(0xbe)][_0xccbb36],_0x192d94=(_0x33c9b6[_0x29ed4e(0x108)]||'')[_0x29ed4e(0xf3)](),_0x290d2e=_0x192d94[_0x29ed4e(0xe3)](_0x29ed4e(0xc3))||_0x192d94[_0x29ed4e(0xe3)]('temperatur')||_0x192d94[_0x29ed4e(0xe3)]('klima')||_0x192d94[_0x29ed4e(0xe3)](_0x29ed4e(0xb9))||_0x192d94[_0x29ed4e(0xe3)]('thermostat');if(_0x290d2e&&typeof _0xe104ec==='number'){if(_0xe104ec>0x50||_0xe104ec<-0x32)return _0x1415b1['log'][_0x29ed4e(0xbd)](_0x29ed4e(0xd0)+_0xe104ec+_0x29ed4e(0xc8)+_0xccbb36),null;}_0x1415b1[_0x29ed4e(0xbe)][_0xccbb36]=_0xe104ec;if(!_0x33c9b6['logDuplicates']&&_0x4a47af!=undefined&&_0x4a47af==_0xe104ec)return null;_0x1415b1[_0x29ed4e(0xad)]&&_0x290d2e&&recordThermodynamics(_0x1415b1,_0xccbb36,_0xe104ec,_0x33c9b6[_0x29ed4e(0xf9)]);const _0x29bb92={'timestamp':_0x11226c,'id':_0xccbb36,'name':_0x33c9b6['name'],'type':_0x33c9b6['type'],'location':_0x33c9b6[_0x29ed4e(0xf9)],'value':_0xe104ec};_0x1415b1[_0x29ed4e(0xc9)]['unshift'](_0x29bb92);if(_0x1415b1[_0x29ed4e(0xc9)]['length']>HISTORY_MAX_SIZE)_0x1415b1[_0x29ed4e(0xc9)]['pop']();await _0x1415b1[_0x29ed4e(0x10a)](_0x29ed4e(0x106),{'val':JSON[_0x29ed4e(0xd5)](_0x29bb92),'ack':!![]}),await _0x1415b1['setStateAsync']('events.history',{'val':JSON[_0x29ed4e(0xd5)](_0x1415b1[_0x29ed4e(0xc9)]),'ack':!![]});if(_0x1415b1[_0x29ed4e(0xad)]){_0x1415b1[_0x29ed4e(0xb4)][_0x29ed4e(0x109)](_0x29bb92);if(_0x1415b1['rawEventLog'][_0x29ed4e(0x10f)]>RAW_LOG_MAX_SIZE)_0x1415b1[_0x29ed4e(0xb4)][_0x29ed4e(0xbb)](0x0,_0x1415b1[_0x29ed4e(0xb4)][_0x29ed4e(0x10f)]-RAW_LOG_MAX_SIZE);await _0x1415b1['setStateAsync'](_0x29ed4e(0xb5),{'val':JSON[_0x29ed4e(0xd5)](_0x1415b1[_0x29ed4e(0xb4)]),'ack':!![]}),recordSequence(_0x1415b1,_0x29bb92);}if(_0x33c9b6['isExit']&&_0xe104ec===!![]){if(_0x1415b1[_0x29ed4e(0xb6)]&&!_0x1415b1[_0x29ed4e(0xc0)])startExitTimer(_0x1415b1);else{if(!_0x1415b1[_0x29ed4e(0xb6)])setPresence(_0x1415b1,!![]);}}else{if(_0x33c9b6['type']===_0x29ed4e(0xef)&&_0xe104ec===!![]){if(_0x1415b1[_0x29ed4e(0x10e)])abortExitTimer(_0x1415b1);if(!_0x1415b1[_0x29ed4e(0xb6)]&&_0x1415b1[_0x29ed4e(0xf4)]===_0x29ed4e(0xd4))setPresence(_0x1415b1,!![]);}}if(_0x1415b1[_0x29ed4e(0xad)]&&_0x1415b1['sendToPythonWrapper']){_0x33c9b6['type']===_0x29ed4e(0xef)&&_0xe104ec===!![]&&_0x33c9b6[_0x29ed4e(0xf9)]&&_0x1415b1[_0x29ed4e(0xc5)](_0x29ed4e(0xd3),{'room':_0x33c9b6[_0x29ed4e(0xf9)]});const _0x187dc4=[_0x29ed4e(0xcc),'tür',_0x29ed4e(0xd9),_0x29ed4e(0xe5),'griff',_0x29ed4e(0xde),_0x29ed4e(0xeb),_0x29ed4e(0xfc)][_0x29ed4e(0xb3)](_0x4a33e8=>_0x192d94[_0x29ed4e(0xe3)](_0x4a33e8)),_0x3f9ee1=[_0x29ed4e(0xdb),_0x29ed4e(0xea),'switch',_0x29ed4e(0xfe),_0x29ed4e(0x100),_0x29ed4e(0x111)][_0x29ed4e(0xb3)](_0x12a2d8=>_0x192d94[_0x29ed4e(0xe3)](_0x12a2d8)),_0x402db0=['motion',_0x29ed4e(0xff),_0x29ed4e(0xa9),_0x29ed4e(0x10c),_0x29ed4e(0xe7)][_0x29ed4e(0xb3)](_0x7c2c09=>_0x192d94[_0x29ed4e(0xe3)](_0x7c2c09));if(_0x33c9b6[_0x29ed4e(0xf9)]&&(_0x187dc4||_0x3f9ee1||_0x402db0)){const _0x3de647=_0xe104ec===!![]||typeof _0xe104ec===_0x29ed4e(0xe8)&&_0xe104ec>0x0,_0x528c4d=_0x187dc4&&!_0x3de647&&_0x4a47af!==undefined&&_0x4a47af!=_0xe104ec;if(_0x3de647||_0x528c4d){const _0xc7b21d=_0x1415b1['lastTrackerEventTime']||_0x11226c,_0x297f33=(_0x11226c-_0xc7b21d)/0x3e8;_0x1415b1['lastTrackerEventTime']=_0x11226c,_0x1415b1['sendToPythonWrapper'](_0x29ed4e(0xba),{'room':_0x33c9b6[_0x29ed4e(0xf9)],'dt':_0x297f33});}}}return _0x29bb92;}module['exports']={'processSensorEvent':processSensorEvent,'getOutsideTemperatureNumeric':getOutsideTemperatureNumeric,'setPresence':setPresence,'abortExitTimer':abortExitTimer,'startExitTimer':startExitTimer};