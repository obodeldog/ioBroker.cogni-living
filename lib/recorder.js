const a5_0x532b2f=a5_0x2786;(function(_0x4cb9a4,_0x5eb0a1){const _0x49b7c1=a5_0x2786,_0x4b7051=_0x4cb9a4();while(!![]){try{const _0x5b572c=parseInt(_0x49b7c1(0xbb))/0x1*(-parseInt(_0x49b7c1(0xdd))/0x2)+parseInt(_0x49b7c1(0xdb))/0x3+parseInt(_0x49b7c1(0x102))/0x4+-parseInt(_0x49b7c1(0xd3))/0x5*(-parseInt(_0x49b7c1(0xea))/0x6)+-parseInt(_0x49b7c1(0xc2))/0x7+parseInt(_0x49b7c1(0x9e))/0x8+parseInt(_0x49b7c1(0xc4))/0x9;if(_0x5b572c===_0x5eb0a1)break;else _0x4b7051['push'](_0x4b7051['shift']());}catch(_0x524be2){_0x4b7051['push'](_0x4b7051['shift']());}}}(a5_0x34db,0xc38af));const a5_0x31acd7=(function(){let _0x3e172e=!![];return function(_0x2bf88c,_0x26aa85){const _0xd2aad9=_0x3e172e?function(){if(_0x26aa85){const _0x565cfe=_0x26aa85['apply'](_0x2bf88c,arguments);return _0x26aa85=null,_0x565cfe;}}:function(){};return _0x3e172e=![],_0xd2aad9;};}()),a5_0x416767=a5_0x31acd7(this,function(){const _0x4e1adb=a5_0x2786;return a5_0x416767[_0x4e1adb(0x93)]()[_0x4e1adb(0xc3)](_0x4e1adb(0x9a))['toString']()['constructor'](a5_0x416767)[_0x4e1adb(0xc3)](_0x4e1adb(0x9a));});a5_0x416767();'use strict';const HISTORY_MAX_SIZE=0x32,RAW_LOG_MAX_SIZE=0x9c4,THERMO_LOG_SIZE=0x3e8,SEQUENCE_TIMEOUT_MS=0x5*0x3c*0x3e8,MAX_TRAINING_SET_SIZE=0x1f4,EXIT_TIMER_MINUTES=0xf,EXIT_GRACE_PERIOD_SECONDS=0x1e;let activeSequence=[],sequenceTimer=null;async function getOutsideTemperatureNumeric(_0x1d45d2){const _0x553d97=a5_0x2786;if(_0x1d45d2['config'][_0x553d97(0x91)])try{const _0x1698e4=await _0x1d45d2[_0x553d97(0xa1)](_0x1d45d2[_0x553d97(0xfa)][_0x553d97(0x91)]);if(_0x1698e4&&_0x1698e4['val']!==undefined&&_0x1698e4[_0x553d97(0xec)]!==null)return parseFloat(_0x1698e4[_0x553d97(0xec)]);}catch(_0x2332a6){}const _0x5b3ad1=_0x1d45d2[_0x553d97(0xfa)][_0x553d97(0xc5)];if(!_0x1d45d2[_0x553d97(0xfa)][_0x553d97(0xc9)]||!_0x5b3ad1)return null;try{let _0x4eca88='';if(_0x5b3ad1['includes'](_0x553d97(0xe9)))_0x4eca88=_0x5b3ad1+_0x553d97(0xcf);else{if(_0x5b3ad1[_0x553d97(0xeb)](_0x553d97(0xa2)))_0x4eca88=_0x5b3ad1+_0x553d97(0x98);else{if(_0x5b3ad1[_0x553d97(0xeb)](_0x553d97(0xe4)))_0x4eca88=_0x5b3ad1+_0x553d97(0xae);else{if(_0x5b3ad1[_0x553d97(0xeb)](_0x553d97(0xdc)))_0x4eca88=_0x5b3ad1+_0x553d97(0xc1);}}}if(_0x4eca88){const _0x5f20ca=await _0x1d45d2[_0x553d97(0xa1)](_0x4eca88);if(_0x5f20ca&&_0x5f20ca[_0x553d97(0xec)]!==undefined&&_0x5f20ca[_0x553d97(0xec)]!==null)return parseFloat(_0x5f20ca[_0x553d97(0xec)]);}}catch(_0xf4119b){}return null;}async function recordThermodynamics(_0x376bb6,_0x359a22,_0x1a9752,_0x3f48db){const _0x4b36c0=a5_0x2786,_0xaa96b=await getOutsideTemperatureNumeric(_0x376bb6);if(_0xaa96b===null)return;let _0x41faca=0x0,_0xe4b492=![];if(_0x376bb6['config'][_0x4b36c0(0xf4)])try{let _0x3fb95f=_0x376bb6[_0x4b36c0(0xfa)][_0x4b36c0(0xf4)];if(typeof _0x3fb95f===_0x4b36c0(0xf7))_0x3fb95f=JSON['parse'](_0x3fb95f);if(_0x3fb95f[_0x359a22]){const _0x337606=_0x3fb95f[_0x359a22],_0xde9f8a=await _0x376bb6[_0x4b36c0(0xa1)](_0x337606);if(_0xde9f8a&&_0xde9f8a[_0x4b36c0(0xec)]!==null&&_0xde9f8a['val']!==undefined){let _0xbd53fc=Number(_0xde9f8a[_0x4b36c0(0xec)]);if(_0xbd53fc<=1.05&&!_0x337606[_0x4b36c0(0xeb)](_0x4b36c0(0xad))&&!_0x337606[_0x4b36c0(0xeb)]('STATE'))_0xbd53fc=_0xbd53fc*0x64;_0x41faca=Math['round'](_0xbd53fc),_0xe4b492=!![];}}}catch(_0x243fd5){}if(!_0xe4b492){const _0x35ed9e=[{'from':_0x4b36c0(0xed),'to':_0x4b36c0(0xde)},{'from':_0x4b36c0(0xed),'to':_0x4b36c0(0xfd)},{'from':_0x4b36c0(0xb8),'to':_0x4b36c0(0xb7)},{'from':'.ACTUAL_TEMPERATURE','to':_0x4b36c0(0xe7)},{'from':_0x4b36c0(0xe5),'to':'level'},{'from':'Temperature','to':'Valve'}];for(const _0x3d360b of _0x35ed9e){if(_0x359a22['includes'](_0x3d360b[_0x4b36c0(0x101)])){const _0x224ffc=_0x359a22['replace'](_0x3d360b[_0x4b36c0(0x101)],_0x3d360b['to']);try{const _0x2a3628=await _0x376bb6[_0x4b36c0(0xa1)](_0x224ffc);if(_0x2a3628&&_0x2a3628[_0x4b36c0(0xec)]!==null&&_0x2a3628[_0x4b36c0(0xec)]!==undefined){let _0xceb36d=Number(_0x2a3628[_0x4b36c0(0xec)]);if(typeof _0xceb36d===_0x4b36c0(0x95)){if(_0xceb36d<=1.05&&_0x3d360b['to'][_0x4b36c0(0xeb)](_0x4b36c0(0xa6)))_0xceb36d=_0xceb36d*0x64;_0x41faca=Math['round'](_0xceb36d),_0xe4b492=!![];break;}}}catch(_0x58bb15){}}}}const _0x123f9a=await _0x376bb6[_0x4b36c0(0xd1)](_0x4b36c0(0x94));let _0xb14f25=[];if(_0x123f9a&&_0x123f9a[_0x4b36c0(0xec)])try{_0xb14f25=JSON[_0x4b36c0(0xb0)](_0x123f9a[_0x4b36c0(0xec)]);}catch(_0x58c4fc){}_0xb14f25[_0x4b36c0(0xa0)]({'ts':Date[_0x4b36c0(0xbd)](),'room':_0x3f48db||_0x4b36c0(0xab),'t_in':_0x1a9752,'t_out':_0xaa96b,'valve':_0x41faca});if(_0xb14f25[_0x4b36c0(0xa8)]>THERMO_LOG_SIZE)_0xb14f25[_0x4b36c0(0xc0)]();await _0x376bb6['setStateAsync'](_0x4b36c0(0x94),{'val':JSON[_0x4b36c0(0xf0)](_0xb14f25),'ack':!![]});}async function saveCompletedSequence(_0x343dd2){const _0x3adb5c=a5_0x2786;try{const _0x409472=await _0x343dd2[_0x3adb5c(0xd1)](_0x3adb5c(0xb5));let _0xa9d884=[];if(_0x409472&&_0x409472[_0x3adb5c(0xec)])try{_0xa9d884=JSON[_0x3adb5c(0xb0)](_0x409472[_0x3adb5c(0xec)]);}catch(_0x565f34){}const _0x18f1f3=activeSequence[0x0]['ts'],_0x24db39=activeSequence[_0x3adb5c(0xbf)](_0x4b0c7c=>({'loc':_0x4b0c7c[_0x3adb5c(0xb1)],'t_delta':Math[_0x3adb5c(0xba)]((_0x4b0c7c['ts']-_0x18f1f3)/0x3e8)})),_0x3653a5={'timestamp':new Date(_0x18f1f3)[_0x3adb5c(0xe0)](),'steps':_0x24db39,'duration':Math['round']((activeSequence[activeSequence[_0x3adb5c(0xa8)]-0x1]['ts']-_0x18f1f3)/0x3e8),'daytime':new Date(_0x18f1f3)[_0x3adb5c(0xf9)]()};_0xa9d884[_0x3adb5c(0xa0)](_0x3653a5);if(_0xa9d884[_0x3adb5c(0xa8)]>MAX_TRAINING_SET_SIZE)_0xa9d884[_0x3adb5c(0xc0)]();await _0x343dd2['setStateAsync'](_0x3adb5c(0xb5),{'val':JSON[_0x3adb5c(0xf0)](_0xa9d884),'ack':!![]}),_0x343dd2['isProVersion']&&_0x343dd2['sendToPythonWrapper']&&_0x343dd2[_0x3adb5c(0xc7)]('ANALYZE_SEQUENCE',{'sequence':_0x3653a5});}catch(_0x41a618){_0x343dd2[_0x3adb5c(0x92)][_0x3adb5c(0xe2)](_0x3adb5c(0xf6)+_0x41a618[_0x3adb5c(0xa3)]);}}async function recordSequence(_0x3d2a6f,_0xe9e66a){const _0x3050be=a5_0x2786,_0x295f82=(_0xe9e66a[_0x3050be(0xa9)]||'')[_0x3050be(0xd6)](),_0x58b661=[_0x3050be(0xaa),_0x3050be(0xf2),_0x3050be(0x9b),'presence',_0x3050be(0xca),_0x3050be(0xb6),'tür','window',_0x3050be(0xb4),'contact',_0x3050be(0xa4),_0x3050be(0xfb),_0x3050be(0xd4),_0x3050be(0xd7),_0x3050be(0xfc),'dimmer',_0x3050be(0xa5)];if(!_0x58b661['some'](_0x2b6f83=>_0x295f82[_0x3050be(0xeb)](_0x2b6f83)))return;if(!_0xe9e66a[_0x3050be(0xc6)])return;if(sequenceTimer)clearTimeout(sequenceTimer);activeSequence[_0x3050be(0xa0)]({'loc':_0xe9e66a[_0x3050be(0xaf)]||_0x3050be(0xab),'id':_0xe9e66a['id'],'ts':Date['now']()}),sequenceTimer=setTimeout(async()=>{const _0x1c42a0=_0x3050be;if(activeSequence[_0x1c42a0(0xa8)]>0x1)await saveCompletedSequence(_0x3d2a6f);activeSequence=[];},SEQUENCE_TIMEOUT_MS);}function startExitTimer(_0x4ebc11){const _0x388c60=a5_0x2786;abortExitTimer(_0x4ebc11),_0x4ebc11[_0x388c60(0xda)]=!![],_0x4ebc11['exitGraceTimer']=setTimeout(()=>{_0x4ebc11['isGracePeriodActive']=![];},EXIT_GRACE_PERIOD_SECONDS*0x3e8),_0x4ebc11[_0x388c60(0x96)]=setTimeout(()=>{setPresence(_0x4ebc11,![]),_0x4ebc11['exitTimer']=null;},EXIT_TIMER_MINUTES*0x3c*0x3e8);}function a5_0x34db(){const _0x7cdb1c=['string','splice','getHours','config','light','schalter','.1.VALVE_STATE','lastTrackerEventTime','fill','events.history','from','1625128UktNXF','SIMULATE_SIGNAL','outdoorSensorId','log','toString','LTM.trainingData.thermodynamics','number','exitTimer','normal','.NextHours.Location_1.Day_1.current.temp_value','LTM.rawEventLog','(((.+)+)+)+$','präsenz','system.isPresent','analysis.health.todayVector','606088ahznMV','exports','push','getForeignStateAsync','daswetter','message','kontakt','lampe','LEVEL','TRACK_EVENT','length','type','motion','Unknown','isExit','STATUS','.forecast.current.temperature','location','parse','loc','sensorLastValues','eventHistory','fenster','LTM.trainingData.sequences','door','.4.VALVE_STATE','.1.TEMPERATURE','exitGraceTimer','round','3146gEUMUx','debug','now','dimmer','map','shift','.forecast.current.temp','6014421VGVPtT','search','7051302DKNiZU','weatherInstance','value','sendToPythonWrapper','isProVersion','useWeather','occupancy','tür','setStateAsync','handle','name','.Current.Temperature','window','getStateAsync','presence','5vQMvpA','licht','unshift','toLowerCase','switch','some','heizung','isGracePeriodActive','778698PUkfJd','weatherunderground','410iJEsNa','.1.LEVEL','thermostat','toISOString','lock','error','griff','openweathermap','temperature','klima','.LEVEL','schloss','accuweather','4679934wzAizF','includes','val','.1.ACTUAL_TEMPERATURE','getDate','currentSystemMode','stringify','rawEventLog','bewegung','pop','valveMapping','isPresent','[RECORDER]\x20Error:\x20'];a5_0x34db=function(){return _0x7cdb1c;};return a5_0x34db();}function abortExitTimer(_0x48b473){const _0x4c92a1=a5_0x2786;if(_0x48b473['exitTimer'])clearTimeout(_0x48b473['exitTimer']);if(_0x48b473[_0x4c92a1(0xb9)])clearTimeout(_0x48b473[_0x4c92a1(0xb9)]);_0x48b473[_0x4c92a1(0x96)]=null,_0x48b473[_0x4c92a1(0xb9)]=null,_0x48b473[_0x4c92a1(0xda)]=![];}async function setPresence(_0x265d00,_0x4c1b19){const _0x22cf38=a5_0x2786;if(_0x265d00[_0x22cf38(0xf5)]===_0x4c1b19)return;_0x265d00[_0x22cf38(0xf5)]=_0x4c1b19,await _0x265d00[_0x22cf38(0xcc)](_0x22cf38(0x9c),{'val':_0x4c1b19,'ack':!![]});}async function updateHourlyActivity(_0x54144a){const _0x4e7200=a5_0x2786;let _0xba2e23=new Array(0x18)[_0x4e7200(0xff)](0x0),_0x5eaf98=0x0;try{const _0x461568=await _0x54144a[_0x4e7200(0xd1)](_0x4e7200(0x9d));_0x461568&&_0x461568[_0x4e7200(0xec)]&&(_0xba2e23=JSON['parse'](_0x461568[_0x4e7200(0xec)]),_0x5eaf98=_0x461568['ts']);}catch(_0x1407ec){}const _0x20303d=new Date(_0x5eaf98),_0x5e1db9=new Date();_0x20303d[_0x4e7200(0xee)]()!==_0x5e1db9[_0x4e7200(0xee)]()&&(_0xba2e23=new Array(0x18)[_0x4e7200(0xff)](0x0));const _0x4eaddd=_0x5e1db9[_0x4e7200(0xf9)]();if(_0xba2e23[_0x4eaddd]===undefined)_0xba2e23[_0x4eaddd]=0x0;_0xba2e23[_0x4eaddd]++,await _0x54144a[_0x4e7200(0xcc)]('analysis.health.todayVector',{'val':JSON[_0x4e7200(0xf0)](_0xba2e23),'ack':!![]});}async function processSensorEvent(_0x56775b,_0x5d1654,_0x5227e3,_0x25c43b){const _0x1b8bf6=a5_0x2786;if(!_0x25c43b)return null;const _0x2dae80=_0x5227e3[_0x1b8bf6(0xec)],_0x2b637a=Date['now'](),_0x4562d7=_0x56775b[_0x1b8bf6(0xb2)][_0x5d1654],_0x43518e=(_0x25c43b['type']||'')[_0x1b8bf6(0xd6)](),_0x4cd5be=_0x43518e[_0x1b8bf6(0xeb)]('temperature')||_0x43518e[_0x1b8bf6(0xeb)]('temperatur')||_0x43518e['includes'](_0x1b8bf6(0xe6))||_0x43518e[_0x1b8bf6(0xeb)](_0x1b8bf6(0xd9))||_0x43518e['includes'](_0x1b8bf6(0xdf));if(_0x4cd5be&&typeof _0x2dae80===_0x1b8bf6(0x95)){if(_0x2dae80>0x50||_0x2dae80<-0x32)return _0x56775b[_0x1b8bf6(0x92)][_0x1b8bf6(0xbc)]('[RECORDER]\x20Ignored\x20implausible\x20temperature:\x20'+_0x2dae80+'\x20from\x20'+_0x5d1654),null;}_0x56775b['sensorLastValues'][_0x5d1654]=_0x2dae80;if(!_0x25c43b['logDuplicates']&&_0x4562d7!=undefined&&_0x4562d7==_0x2dae80)return null;_0x56775b[_0x1b8bf6(0xc8)]&&_0x4cd5be&&recordThermodynamics(_0x56775b,_0x5d1654,_0x2dae80,_0x25c43b[_0x1b8bf6(0xaf)]);const _0x22d375={'timestamp':_0x2b637a,'id':_0x5d1654,'name':_0x25c43b[_0x1b8bf6(0xce)],'type':_0x25c43b[_0x1b8bf6(0xa9)],'location':_0x25c43b[_0x1b8bf6(0xaf)],'value':_0x2dae80};_0x56775b['eventHistory'][_0x1b8bf6(0xd5)](_0x22d375);if(_0x56775b[_0x1b8bf6(0xb3)][_0x1b8bf6(0xa8)]>HISTORY_MAX_SIZE)_0x56775b[_0x1b8bf6(0xb3)][_0x1b8bf6(0xf3)]();await _0x56775b[_0x1b8bf6(0xcc)]('events.lastEvent',{'val':JSON[_0x1b8bf6(0xf0)](_0x22d375),'ack':!![]}),await _0x56775b[_0x1b8bf6(0xcc)](_0x1b8bf6(0x100),{'val':JSON[_0x1b8bf6(0xf0)](_0x56775b['eventHistory']),'ack':!![]}),await updateHourlyActivity(_0x56775b);if(_0x56775b[_0x1b8bf6(0xc8)]){_0x56775b['rawEventLog'][_0x1b8bf6(0xa0)](_0x22d375);if(_0x56775b[_0x1b8bf6(0xf1)][_0x1b8bf6(0xa8)]>RAW_LOG_MAX_SIZE)_0x56775b[_0x1b8bf6(0xf1)][_0x1b8bf6(0xf8)](0x0,_0x56775b[_0x1b8bf6(0xf1)][_0x1b8bf6(0xa8)]-RAW_LOG_MAX_SIZE);await _0x56775b[_0x1b8bf6(0xcc)](_0x1b8bf6(0x99),{'val':JSON[_0x1b8bf6(0xf0)](_0x56775b[_0x1b8bf6(0xf1)]),'ack':!![]}),recordSequence(_0x56775b,_0x22d375);}if(_0x25c43b[_0x1b8bf6(0xac)]&&_0x2dae80===!![]){if(_0x56775b[_0x1b8bf6(0xf5)]&&!_0x56775b[_0x1b8bf6(0xda)])startExitTimer(_0x56775b);else{if(!_0x56775b[_0x1b8bf6(0xf5)])setPresence(_0x56775b,!![]);}}else{if(_0x25c43b[_0x1b8bf6(0xa9)]===_0x1b8bf6(0xaa)&&_0x2dae80===!![]){if(_0x56775b[_0x1b8bf6(0x96)])abortExitTimer(_0x56775b);if(!_0x56775b[_0x1b8bf6(0xf5)]&&_0x56775b[_0x1b8bf6(0xef)]===_0x1b8bf6(0x97))setPresence(_0x56775b,!![]);}}if(_0x56775b[_0x1b8bf6(0xc8)]&&_0x56775b[_0x1b8bf6(0xc7)]){_0x25c43b[_0x1b8bf6(0xa9)]===_0x1b8bf6(0xaa)&&_0x2dae80===!![]&&_0x25c43b[_0x1b8bf6(0xaf)]&&_0x56775b[_0x1b8bf6(0xc7)](_0x1b8bf6(0x90),{'room':_0x25c43b[_0x1b8bf6(0xaf)]});const _0x2b4119=['door',_0x1b8bf6(0xcb),_0x1b8bf6(0xd0),_0x1b8bf6(0xb4),_0x1b8bf6(0xe3),_0x1b8bf6(0xcd),_0x1b8bf6(0xe1),_0x1b8bf6(0xe8)]['some'](_0x21840d=>_0x43518e[_0x1b8bf6(0xeb)](_0x21840d)),_0x4defae=[_0x1b8bf6(0xfb),_0x1b8bf6(0xd4),'switch',_0x1b8bf6(0xfc),_0x1b8bf6(0xbe),_0x1b8bf6(0xa5)][_0x1b8bf6(0xd8)](_0x1ce652=>_0x43518e[_0x1b8bf6(0xeb)](_0x1ce652)),_0x1a7299=[_0x1b8bf6(0xaa),_0x1b8bf6(0xf2),_0x1b8bf6(0x9b),_0x1b8bf6(0xd2),_0x1b8bf6(0xca)][_0x1b8bf6(0xd8)](_0x5d67c9=>_0x43518e[_0x1b8bf6(0xeb)](_0x5d67c9));if(_0x25c43b['location']&&(_0x2b4119||_0x4defae||_0x1a7299)){const _0x22ba5b=_0x2dae80===!![]||typeof _0x2dae80==='number'&&_0x2dae80>0x0,_0x58bcc9=_0x2b4119&&!_0x22ba5b&&_0x4562d7!==undefined&&_0x4562d7!=_0x2dae80;if(_0x22ba5b||_0x58bcc9){const _0x126517=_0x56775b[_0x1b8bf6(0xfe)]||_0x2b637a,_0x3b4f0b=(_0x2b637a-_0x126517)/0x3e8;_0x56775b['lastTrackerEventTime']=_0x2b637a,_0x56775b[_0x1b8bf6(0xc7)](_0x1b8bf6(0xa7),{'room':_0x25c43b['location'],'dt':_0x3b4f0b});}}}return _0x22d375;}function a5_0x2786(_0x5ebd77,_0x473ecd){const _0x1458b9=a5_0x34db();return a5_0x2786=function(_0x416767,_0x31acd7){_0x416767=_0x416767-0x90;let _0x34db5a=_0x1458b9[_0x416767];return _0x34db5a;},a5_0x2786(_0x5ebd77,_0x473ecd);}module[a5_0x532b2f(0x9f)]={'processSensorEvent':processSensorEvent,'getOutsideTemperatureNumeric':getOutsideTemperatureNumeric,'setPresence':setPresence,'abortExitTimer':abortExitTimer,'startExitTimer':startExitTimer};