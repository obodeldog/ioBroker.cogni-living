const a5_0x5b56a2=a5_0x5b72;(function(_0x316beb,_0x3f6369){const _0x1b2daa=a5_0x5b72,_0x5cb553=_0x316beb();while(!![]){try{const _0x51949d=parseInt(_0x1b2daa(0xbb))/0x1*(parseInt(_0x1b2daa(0xd7))/0x2)+-parseInt(_0x1b2daa(0x99))/0x3*(-parseInt(_0x1b2daa(0xee))/0x4)+-parseInt(_0x1b2daa(0xbe))/0x5+-parseInt(_0x1b2daa(0xc4))/0x6*(-parseInt(_0x1b2daa(0xf2))/0x7)+parseInt(_0x1b2daa(0xe2))/0x8+-parseInt(_0x1b2daa(0xf4))/0x9*(parseInt(_0x1b2daa(0xb0))/0xa)+-parseInt(_0x1b2daa(0xad))/0xb;if(_0x51949d===_0x3f6369)break;else _0x5cb553['push'](_0x5cb553['shift']());}catch(_0x54aa4e){_0x5cb553['push'](_0x5cb553['shift']());}}}(a5_0x4a10,0x9ae0c));const a5_0x8f534d=(function(){let _0x13648a=!![];return function(_0x1d265b,_0x1fee80){const _0x2d1603=_0x13648a?function(){const _0x197609=a5_0x5b72;if(_0x1fee80){const _0x15b1e5=_0x1fee80[_0x197609(0xe5)](_0x1d265b,arguments);return _0x1fee80=null,_0x15b1e5;}}:function(){};return _0x13648a=![],_0x2d1603;};}()),a5_0x310cbd=a5_0x8f534d(this,function(){const _0x4c4568=a5_0x5b72;return a5_0x310cbd['toString']()['search']('(((.+)+)+)+$')[_0x4c4568(0xd1)]()[_0x4c4568(0xd3)](a5_0x310cbd)['search'](_0x4c4568(0xe3));});a5_0x310cbd();'use strict';const HISTORY_MAX_SIZE=0x32,RAW_LOG_MAX_SIZE=0x9c4,THERMO_LOG_SIZE=0x3e8,SEQUENCE_TIMEOUT_MS=0x5*0x3c*0x3e8,MAX_TRAINING_SET_SIZE=0x1f4,EXIT_TIMER_MINUTES=0xf,EXIT_GRACE_PERIOD_SECONDS=0x1e;function a5_0x5b72(_0x3e9fbd,_0x6853f2){const _0x13cd2e=a5_0x4a10();return a5_0x5b72=function(_0x310cbd,_0x8f534d){_0x310cbd=_0x310cbd-0x98;let _0x4a1027=_0x13cd2e[_0x310cbd];return _0x4a1027;},a5_0x5b72(_0x3e9fbd,_0x6853f2);}let activeSequence=[],sequenceTimer=null;async function getOutsideTemperatureNumeric(_0x69bce0){const _0x52391d=a5_0x5b72;if(_0x69bce0[_0x52391d(0xc7)][_0x52391d(0x9a)])try{const _0x289b79=await _0x69bce0[_0x52391d(0xab)](_0x69bce0['config'][_0x52391d(0x9a)]);if(_0x289b79&&_0x289b79[_0x52391d(0xc9)]!==undefined&&_0x289b79['val']!==null)return parseFloat(_0x289b79[_0x52391d(0xc9)]);}catch(_0x517eca){}const _0x306ef1=_0x69bce0['config'][_0x52391d(0xca)];if(!_0x69bce0[_0x52391d(0xc7)][_0x52391d(0xc2)]||!_0x306ef1)return null;try{let _0x22855b='';if(_0x306ef1[_0x52391d(0xa8)](_0x52391d(0xdb)))_0x22855b=_0x306ef1+_0x52391d(0xde);else{if(_0x306ef1[_0x52391d(0xa8)](_0x52391d(0xaf)))_0x22855b=_0x306ef1+_0x52391d(0xd4);else{if(_0x306ef1[_0x52391d(0xa8)](_0x52391d(0xe6)))_0x22855b=_0x306ef1+_0x52391d(0xc3);else{if(_0x306ef1['includes'](_0x52391d(0xf1)))_0x22855b=_0x306ef1+_0x52391d(0xb6);}}}if(_0x22855b){const _0xf12148=await _0x69bce0[_0x52391d(0xab)](_0x22855b);if(_0xf12148&&_0xf12148[_0x52391d(0xc9)]!==undefined&&_0xf12148[_0x52391d(0xc9)]!==null)return parseFloat(_0xf12148[_0x52391d(0xc9)]);}}catch(_0x2b3331){}return null;}async function recordThermodynamics(_0x21857b,_0x3f45e6,_0xce17,_0x75281d){const _0xd991dc=a5_0x5b72,_0x14385a=await getOutsideTemperatureNumeric(_0x21857b),_0x3f761a=await _0x21857b['getStateAsync'](_0xd991dc(0xa4));let _0x44ae53=[];if(_0x3f761a&&_0x3f761a[_0xd991dc(0xc9)])try{_0x44ae53=JSON[_0xd991dc(0xd9)](_0x3f761a[_0xd991dc(0xc9)]);}catch(_0x264619){}_0x44ae53[_0xd991dc(0x9b)]({'ts':Date['now'](),'room':_0x75281d||_0xd991dc(0x9e),'t_in':_0xce17,'t_out':_0x14385a});if(_0x44ae53[_0xd991dc(0xb3)]>THERMO_LOG_SIZE)_0x44ae53[_0xd991dc(0xc0)]();await _0x21857b['setStateAsync']('LTM.trainingData.thermodynamics',{'val':JSON['stringify'](_0x44ae53),'ack':!![]});}async function saveCompletedSequence(_0x14b2a1){const _0x17d1ce=a5_0x5b72;try{const _0x49b6c8=await _0x14b2a1[_0x17d1ce(0xaa)]('LTM.trainingData.sequences');let _0x541ed1=[];if(_0x49b6c8&&_0x49b6c8[_0x17d1ce(0xc9)])try{_0x541ed1=JSON[_0x17d1ce(0xd9)](_0x49b6c8['val']);}catch(_0x5c604f){}const _0x137f7a=activeSequence[0x0]['ts'],_0x89ebc8=activeSequence[_0x17d1ce(0xcb)](_0x2eca8e=>({'loc':_0x2eca8e[_0x17d1ce(0xd2)],'t_delta':Math['round']((_0x2eca8e['ts']-_0x137f7a)/0x3e8)})),_0x532f5f={'timestamp':new Date(_0x137f7a)[_0x17d1ce(0xdd)](),'steps':_0x89ebc8,'duration':Math[_0x17d1ce(0x9f)]((activeSequence[activeSequence[_0x17d1ce(0xb3)]-0x1]['ts']-_0x137f7a)/0x3e8),'daytime':new Date(_0x137f7a)[_0x17d1ce(0x98)]()};_0x541ed1[_0x17d1ce(0x9b)](_0x532f5f);if(_0x541ed1[_0x17d1ce(0xb3)]>MAX_TRAINING_SET_SIZE)_0x541ed1[_0x17d1ce(0xc0)]();await _0x14b2a1[_0x17d1ce(0xea)](_0x17d1ce(0xa6),{'val':JSON[_0x17d1ce(0xa1)](_0x541ed1),'ack':!![]}),_0x14b2a1[_0x17d1ce(0xc5)]&&_0x14b2a1[_0x17d1ce(0xec)]&&_0x14b2a1[_0x17d1ce(0xec)](_0x17d1ce(0xeb),{'sequence':_0x532f5f});}catch(_0x24dc59){_0x14b2a1[_0x17d1ce(0xba)][_0x17d1ce(0xd6)](_0x17d1ce(0x9d)+_0x24dc59[_0x17d1ce(0xbf)]);}}async function recordSequence(_0xb27caf,_0x10a94e){const _0x371c97=a5_0x5b72,_0x4f5389=(_0x10a94e[_0x371c97(0xa9)]||'')[_0x371c97(0xa2)](),_0x439272=[_0x371c97(0xef),_0x371c97(0xa0),_0x371c97(0x9c),'presence',_0x371c97(0xc8),'door',_0x371c97(0xd8),_0x371c97(0xb9),_0x371c97(0xf0),_0x371c97(0xa3),'kontakt',_0x371c97(0xce),_0x371c97(0xc1),'switch',_0x371c97(0xed),_0x371c97(0xb1),_0x371c97(0xcd)];if(!_0x439272['some'](_0x41ebbf=>_0x4f5389[_0x371c97(0xa8)](_0x41ebbf)))return;if(!_0x10a94e[_0x371c97(0xa5)])return;if(sequenceTimer)clearTimeout(sequenceTimer);activeSequence[_0x371c97(0x9b)]({'loc':_0x10a94e[_0x371c97(0xa7)]||'Unknown','id':_0x10a94e['id'],'ts':Date[_0x371c97(0xdf)]()}),sequenceTimer=setTimeout(async()=>{if(activeSequence['length']>0x1)await saveCompletedSequence(_0xb27caf);activeSequence=[];},SEQUENCE_TIMEOUT_MS);}function startExitTimer(_0x924b38){const _0x28c8e4=a5_0x5b72;abortExitTimer(_0x924b38),_0x924b38[_0x28c8e4(0xe4)]=!![],_0x924b38[_0x28c8e4(0xe7)]=setTimeout(()=>{const _0xd85ea2=_0x28c8e4;_0x924b38[_0xd85ea2(0xe4)]=![];},EXIT_GRACE_PERIOD_SECONDS*0x3e8),_0x924b38[_0x28c8e4(0xe1)]=setTimeout(()=>{const _0x33a41b=_0x28c8e4;setPresence(_0x924b38,![]),_0x924b38[_0x33a41b(0xe1)]=null;},EXIT_TIMER_MINUTES*0x3c*0x3e8);}function abortExitTimer(_0x4e6279){const _0x3f79e0=a5_0x5b72;if(_0x4e6279[_0x3f79e0(0xe1)])clearTimeout(_0x4e6279['exitTimer']);if(_0x4e6279[_0x3f79e0(0xe7)])clearTimeout(_0x4e6279['exitGraceTimer']);_0x4e6279[_0x3f79e0(0xe1)]=null,_0x4e6279[_0x3f79e0(0xe7)]=null,_0x4e6279[_0x3f79e0(0xe4)]=![];}async function setPresence(_0x16dd98,_0x3cfade){const _0x2ab037=a5_0x5b72;if(_0x16dd98[_0x2ab037(0xe9)]===_0x3cfade)return;_0x16dd98[_0x2ab037(0xe9)]=_0x3cfade,await _0x16dd98['setStateAsync'](_0x2ab037(0xcc),{'val':_0x3cfade,'ack':!![]});}async function processSensorEvent(_0x4b7279,_0x303b41,_0x22e2e3,_0x39307d){const _0x5d3f78=a5_0x5b72;if(!_0x39307d)return null;const _0x5da931=_0x22e2e3[_0x5d3f78(0xc9)],_0x5456e3=Date[_0x5d3f78(0xdf)](),_0x1248ae=_0x4b7279[_0x5d3f78(0xdc)][_0x303b41];_0x4b7279['sensorLastValues'][_0x303b41]=_0x5da931;if(!_0x39307d[_0x5d3f78(0xc6)]&&_0x1248ae!=undefined&&_0x1248ae==_0x5da931)return null;const _0x2f6335=(_0x39307d[_0x5d3f78(0xa9)]||'')[_0x5d3f78(0xa2)](),_0x24b7fd=_0x2f6335[_0x5d3f78(0xa8)](_0x5d3f78(0xbd))||_0x2f6335[_0x5d3f78(0xa8)](_0x5d3f78(0xb4))||_0x2f6335[_0x5d3f78(0xa8)](_0x5d3f78(0xd5))||_0x2f6335[_0x5d3f78(0xa8)](_0x5d3f78(0xe0));_0x4b7279[_0x5d3f78(0xc5)]&&_0x24b7fd&&recordThermodynamics(_0x4b7279,_0x303b41,_0x5da931,_0x39307d[_0x5d3f78(0xa7)]);const _0xa0013d={'timestamp':_0x5456e3,'id':_0x303b41,'name':_0x39307d[_0x5d3f78(0xf5)],'type':_0x39307d['type'],'location':_0x39307d[_0x5d3f78(0xa7)],'value':_0x5da931};_0x4b7279[_0x5d3f78(0xb7)][_0x5d3f78(0xac)](_0xa0013d);if(_0x4b7279[_0x5d3f78(0xb7)][_0x5d3f78(0xb3)]>HISTORY_MAX_SIZE)_0x4b7279[_0x5d3f78(0xb7)][_0x5d3f78(0xda)]();await _0x4b7279[_0x5d3f78(0xea)](_0x5d3f78(0xf3),{'val':JSON[_0x5d3f78(0xa1)](_0xa0013d),'ack':!![]}),await _0x4b7279['setStateAsync'](_0x5d3f78(0xe8),{'val':JSON[_0x5d3f78(0xa1)](_0x4b7279[_0x5d3f78(0xb7)]),'ack':!![]});if(_0x4b7279['isProVersion']){_0x4b7279[_0x5d3f78(0xae)][_0x5d3f78(0x9b)](_0xa0013d);if(_0x4b7279['rawEventLog'][_0x5d3f78(0xb3)]>RAW_LOG_MAX_SIZE)_0x4b7279[_0x5d3f78(0xae)][_0x5d3f78(0xcf)](0x0,_0x4b7279['rawEventLog'][_0x5d3f78(0xb3)]-RAW_LOG_MAX_SIZE);await _0x4b7279[_0x5d3f78(0xea)](_0x5d3f78(0xbc),{'val':JSON[_0x5d3f78(0xa1)](_0x4b7279[_0x5d3f78(0xae)]),'ack':!![]}),recordSequence(_0x4b7279,_0xa0013d);}if(_0x39307d[_0x5d3f78(0xb8)]&&_0x5da931===!![]){if(_0x4b7279[_0x5d3f78(0xe9)]&&!_0x4b7279[_0x5d3f78(0xe4)])startExitTimer(_0x4b7279);else{if(!_0x4b7279['isPresent'])setPresence(_0x4b7279,!![]);}}else{if(_0x39307d[_0x5d3f78(0xa9)]===_0x5d3f78(0xef)&&_0x5da931===!![]){if(_0x4b7279['exitTimer'])abortExitTimer(_0x4b7279);if(!_0x4b7279[_0x5d3f78(0xe9)]&&_0x4b7279['currentSystemMode']===_0x5d3f78(0xd0))setPresence(_0x4b7279,!![]);}}return _0x4b7279[_0x5d3f78(0xc5)]&&_0x39307d[_0x5d3f78(0xa9)]===_0x5d3f78(0xef)&&_0x5da931===!![]&&_0x39307d[_0x5d3f78(0xa7)]&&_0x4b7279[_0x5d3f78(0xec)]&&_0x4b7279[_0x5d3f78(0xec)](_0x5d3f78(0xb2),{'room':_0x39307d[_0x5d3f78(0xa7)]}),_0xa0013d;}function a5_0x4a10(){const _0x5f13db=['toString','loc','constructor','.NextHours.Location_1.Day_1.current.temp_value','klima','error','65336njKFXs','tür','parse','pop','accuweather','sensorLastValues','toISOString','.Current.Temperature','now','heizung','exitTimer','4191808TMEwQz','(((.+)+)+)+$','isGracePeriodActive','apply','openweathermap','exitGraceTimer','events.history','isPresent','setStateAsync','ANALYZE_SEQUENCE','sendToPythonWrapper','schalter','311020ZdHAuU','motion','fenster','weatherunderground','4912460rbwLlM','events.lastEvent','9bcuCJm','name','getHours','12EMIWmq','outdoorSensorId','push','präsenz','[RECORDER]\x20Error:\x20','Unknown','round','bewegung','stringify','toLowerCase','contact','LTM.trainingData.thermodynamics','value','LTM.trainingData.sequences','location','includes','type','getStateAsync','getForeignStateAsync','unshift','5994428bgDUVj','rawEventLog','daswetter','4368470gDsyzi','dimmer','SIMULATE_SIGNAL','length','temperatur','exports','.forecast.current.temp','eventHistory','isExit','window','log','17ZrzOgf','LTM.rawEventLog','temperature','2379785vIBsWj','message','shift','licht','useWeather','.forecast.current.temperature','6xNtRrD','isProVersion','logDuplicates','config','occupancy','val','weatherInstance','map','system.isPresent','lampe','light','splice','normal'];a5_0x4a10=function(){return _0x5f13db;};return a5_0x4a10();}module[a5_0x5b56a2(0xb5)]={'processSensorEvent':processSensorEvent,'getOutsideTemperatureNumeric':getOutsideTemperatureNumeric,'setPresence':setPresence,'abortExitTimer':abortExitTimer,'startExitTimer':startExitTimer};