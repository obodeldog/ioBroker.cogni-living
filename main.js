const a0_0x36ff8e=a0_0x2b2b;(function(_0x20376d,_0x5a33a6){const _0x5cc7b2=a0_0x2b2b,_0x26724f=_0x20376d();while(!![]){try{const _0x286384=parseInt(_0x5cc7b2(0x12b))/0x1*(parseInt(_0x5cc7b2(0x116))/0x2)+-parseInt(_0x5cc7b2(0x1a3))/0x3+parseInt(_0x5cc7b2(0x11e))/0x4+parseInt(_0x5cc7b2(0x97))/0x5+-parseInt(_0x5cc7b2(0xfb))/0x6*(parseInt(_0x5cc7b2(0x1f8))/0x7)+parseInt(_0x5cc7b2(0x19d))/0x8+parseInt(_0x5cc7b2(0xcf))/0x9*(-parseInt(_0x5cc7b2(0x180))/0xa);if(_0x286384===_0x5a33a6)break;else _0x26724f['push'](_0x26724f['shift']());}catch(_0x505814){_0x26724f['push'](_0x26724f['shift']());}}}(a0_0x1733,0x80405));const a0_0x1d115f=(function(){let _0x129b80=!![];return function(_0x116352,_0x15a06e){const _0x20ef0d=_0x129b80?function(){if(_0x15a06e){const _0x2b3a5f=_0x15a06e['apply'](_0x116352,arguments);return _0x15a06e=null,_0x2b3a5f;}}:function(){};return _0x129b80=![],_0x20ef0d;};}()),a0_0x3f1217=a0_0x1d115f(this,function(){const _0xb57ba2=a0_0x2b2b;return a0_0x3f1217['toString']()[_0xb57ba2(0xe7)](_0xb57ba2(0x134))['toString']()['constructor'](a0_0x3f1217)['search'](_0xb57ba2(0x134));});a0_0x3f1217();'use strict';const utils=require(a0_0x36ff8e(0x1ad)),{GoogleGenerativeAI}=require('@google/generative-ai'),schedule=require(a0_0x36ff8e(0x1ed)),{spawn,exec}=require(a0_0x36ff8e(0xef)),path=require(a0_0x36ff8e(0x190)),HISTORY_MAX_SIZE=0x32,RAW_LOG_MAX_SIZE=0x5dc,LTM_MIN_EVENTS_FOR_COMPRESSION=0x5,GEMINI_MODEL=a0_0x36ff8e(0x10b),LTM_SCHEDULE='0\x203\x20*\x20*\x20*',MODE_RESET_SCHEDULE=a0_0x36ff8e(0x240),ANALYSIS_HISTORY_MAX_SIZE=0x64,EXIT_TIMER_MINUTES=0xf,EXIT_GRACE_PERIOD_SECONDS=0x1e,LTM_DP_RAW_LOG=a0_0x36ff8e(0x131),LTM_DP_DAILY_DIGESTS=a0_0x36ff8e(0x208),LTM_DP_STATUS=a0_0x36ff8e(0x247),LTM_DP_TRIGGER_DIGEST=a0_0x36ff8e(0x9b),LTM_DP_BASELINE_STATUS=a0_0x36ff8e(0x156),LTM_DP_DRIFT_CHANNEL=a0_0x36ff8e(0x1ba),LTM_DP_DRIFT_STATUS=a0_0x36ff8e(0xc8),LTM_DP_DRIFT_DETAILS=a0_0x36ff8e(0xf1),LTM_DP_DRIFT_LAST_CHECK=a0_0x36ff8e(0x1d7),SYSTEM_DP_MODE=a0_0x36ff8e(0xf2),HARD_IGNORE_TERMS=['scriptProblem','scriptEnabled',a0_0x36ff8e(0x18f),'unreach',a0_0x36ff8e(0xaf),'rssi',a0_0x36ff8e(0x75),a0_0x36ff8e(0x244),a0_0x36ff8e(0x98),a0_0x36ff8e(0x15f),a0_0x36ff8e(0x195),a0_0x36ff8e(0x1c6),'stick_unreach','config_pending',a0_0x36ff8e(0xd9),a0_0x36ff8e(0xb4),a0_0x36ff8e(0x1ef),'link_quality'],BAD_NAMES=[a0_0x36ff8e(0x186),a0_0x36ff8e(0x15d),a0_0x36ff8e(0x80),a0_0x36ff8e(0x1a6),'value',a0_0x36ff8e(0x1b7),'on','off',a0_0x36ff8e(0x112),'position',a0_0x36ff8e(0xa8),a0_0x36ff8e(0x1a5),a0_0x36ff8e(0x1ac),a0_0x36ff8e(0x12c),a0_0x36ff8e(0x215),'presence',a0_0x36ff8e(0x1b2),a0_0x36ff8e(0x214),a0_0x36ff8e(0x13a),a0_0x36ff8e(0x86),a0_0x36ff8e(0x230),a0_0x36ff8e(0x1f7),'valve',a0_0x36ff8e(0x219),a0_0x36ff8e(0xad)],ADAPTER_BLACKLIST=[a0_0x36ff8e(0x1fb),a0_0x36ff8e(0x129),'info.',a0_0x36ff8e(0x1f0),a0_0x36ff8e(0x203),a0_0x36ff8e(0x24e),a0_0x36ff8e(0x1ec),'flot.','echarts.',a0_0x36ff8e(0x1ca),'simple-api.'],SYSTEM_MODES={'NORMAL':a0_0x36ff8e(0x1c7),'VACATION':a0_0x36ff8e(0x20a),'PARTY':a0_0x36ff8e(0x162),'GUEST':a0_0x36ff8e(0x19e)},AUTO_RESET_MODES=[SYSTEM_MODES[a0_0x36ff8e(0x104)],SYSTEM_MODES[a0_0x36ff8e(0xe4)]],PERSONA_MAPPING={'generic':a0_0x36ff8e(0xbc),'senior_aal':a0_0x36ff8e(0xe0),'family':a0_0x36ff8e(0x1b3),'single_comfort':a0_0x36ff8e(0xdd),'security':a0_0x36ff8e(0x242)},ACTIVITY_LEVEL_MAP={'sehr\x20hoch':0x64,'hoch':0x50,'normal':0x3c,'niedrig':0x28,'sehr\x20niedrig':0x14,'inaktiv':0x0};async function initZombies(_0x443070){const _0x2fa894=a0_0x36ff8e;try{const _0x48c44f=[_0x2fa894(0x1e9),_0x2fa894(0x83)];for(const _0x5e0ab6 of _0x48c44f){try{const _0x4d25d8=await _0x443070[_0x2fa894(0x77)](_0x5e0ab6);_0x4d25d8&&await _0x443070[_0x2fa894(0xd4)](_0x5e0ab6);}catch(_0xdc1b0b){}}}catch(_0x21d871){}}async function initHistory(_0x16bd6b){const _0x40d90f=a0_0x36ff8e;try{const _0x1bcebe=await _0x16bd6b[_0x40d90f(0xd5)]('events.history');_0x1bcebe&&_0x1bcebe['val']&&(_0x16bd6b[_0x40d90f(0x13e)]=JSON[_0x40d90f(0xae)](_0x1bcebe['val'][_0x40d90f(0x7c)]()));}catch(_0x243ab6){_0x16bd6b[_0x40d90f(0x13e)]=[];}try{const _0x3d3731=await _0x16bd6b[_0x40d90f(0xd5)]('analysis.analysisHistory');if(_0x3d3731&&_0x3d3731[_0x40d90f(0x145)])_0x16bd6b[_0x40d90f(0x165)]=JSON[_0x40d90f(0xae)](_0x3d3731[_0x40d90f(0x145)]['toString']());}catch(_0xf766ac){_0x16bd6b['analysisHistory']=[];}if(_0x16bd6b[_0x40d90f(0x13e)]&&_0x16bd6b['eventHistory'][_0x40d90f(0x8c)]>0x0){_0x16bd6b['log'][_0x40d90f(0x24d)](_0x40d90f(0x191)+_0x16bd6b[_0x40d90f(0x13e)][_0x40d90f(0x8c)]+_0x40d90f(0x163));for(let _0x1ddd7b=_0x16bd6b[_0x40d90f(0x13e)][_0x40d90f(0x8c)]-0x1;_0x1ddd7b>=0x0;_0x1ddd7b--){const _0x2c7990=_0x16bd6b['eventHistory'][_0x1ddd7b];_0x2c7990&&_0x2c7990['id']!==undefined&&_0x2c7990[_0x40d90f(0x151)]!==undefined&&(_0x16bd6b[_0x40d90f(0x117)][_0x2c7990['id']]=_0x2c7990[_0x40d90f(0x151)]);}}}async function initSystemConfig(_0x434210){const _0x56084a=a0_0x36ff8e;try{const _0x4b2842=await _0x434210[_0x56084a(0x132)](_0x56084a(0x1ee));_0x4b2842&&_0x4b2842[_0x56084a(0x169)]&&(_0x434210[_0x56084a(0xf4)]={'latitude':_0x4b2842['common']['latitude']||0x0,'longitude':_0x4b2842[_0x56084a(0x169)][_0x56084a(0x18c)]||0x0,'city':_0x4b2842[_0x56084a(0x169)]['city']||''});}catch(_0x47478d){}}async function checkLicense(_0x3fbbef,_0x332a4d){const _0x1f93c7=a0_0x36ff8e;if(!_0x332a4d)return![];_0x3fbbef[_0x1f93c7(0x24c)]=await getSystemUUID(_0x3fbbef);if(_0x332a4d===_0x1f93c7(0x1cf)||_0x332a4d['startsWith'](_0x1f93c7(0x1f1)))return!![];return![];}async function getSystemUUID(_0x62dff3){const _0x571730=a0_0x36ff8e;try{const _0xfe31c8=await _0x62dff3[_0x571730(0x132)](_0x571730(0x1b5));if(_0xfe31c8&&_0xfe31c8['native']&&_0xfe31c8[_0x571730(0xe3)][_0x571730(0x15a)])return _0xfe31c8[_0x571730(0xe3)][_0x571730(0x15a)];return _0x571730(0x22d);}catch(_0x34b440){return _0x571730(0x1fe);}}async function createAllObjects(_0x4de428){const _0x50acec=a0_0x36ff8e;await checkSystemObjects(_0x4de428),await _0x4de428[_0x50acec(0x1b1)]('system.presenceWho',{'type':_0x50acec(0x80),'common':{'name':_0x50acec(0x107),'type':_0x50acec(0xd3),'role':_0x50acec(0xf7),'read':!![],'write':![],'def':''},'native':{}}),await _0x4de428[_0x50acec(0x1b1)](_0x50acec(0x1af),{'type':_0x50acec(0x80),'common':{'name':'Last\x20raw\x20event','type':_0x50acec(0xd3),'role':_0x50acec(0x20c),'read':!![],'write':![]},'native':{}}),await _0x4de428['setObjectNotExistsAsync'](_0x50acec(0xb5),{'type':_0x50acec(0x80),'common':{'name':'Event\x20History','type':_0x50acec(0xd3),'role':_0x50acec(0x20c),'read':!![],'write':![]},'native':{}}),await _0x4de428[_0x50acec(0x1b1)](_0x50acec(0x124),{'type':_0x50acec(0x80),'common':{'name':_0x50acec(0x1e4),'type':_0x50acec(0xf3),'role':_0x50acec(0xf6),'read':!![],'write':!![],'def':![]},'native':{}}),await _0x4de428['setObjectNotExistsAsync'](_0x50acec(0xa6),{'type':_0x50acec(0x80),'common':{'name':_0x50acec(0x17a),'type':_0x50acec(0xf3),'role':_0x50acec(0xf6),'read':!![],'write':!![],'def':![]},'native':{}}),await _0x4de428[_0x50acec(0x1b1)](_0x50acec(0x250),{'type':_0x50acec(0x80),'common':{'name':_0x50acec(0x10f),'type':_0x50acec(0xd3),'role':_0x50acec(0x20c),'read':!![],'write':![]},'native':{}}),await _0x4de428[_0x50acec(0x1b1)](_0x50acec(0x133),{'type':_0x50acec(0x80),'common':{'name':_0x50acec(0x99),'type':'boolean','role':'indicator.alarm','read':!![],'write':![],'def':![]},'native':{}}),await _0x4de428['setObjectNotExistsAsync']('analysis.isEmergency',{'type':_0x50acec(0x80),'common':{'name':'AI\x20Emergency\x20Status','type':_0x50acec(0xf3),'role':_0x50acec(0x7d),'read':!![],'write':![],'def':![]},'native':{}}),await _0x4de428[_0x50acec(0x1b1)]('analysis.alertReason',{'type':_0x50acec(0x80),'common':{'name':_0x50acec(0x183),'type':_0x50acec(0xd3),'role':_0x50acec(0x7e),'read':!![],'write':![]},'native':{}}),await _0x4de428[_0x50acec(0x1b1)](_0x50acec(0x121),{'type':_0x50acec(0x80),'common':{'name':_0x50acec(0x111),'type':'string','role':'text','read':!![],'write':![]},'native':{}}),await _0x4de428[_0x50acec(0x1b1)]('analysis.deviationFromBaseline',{'type':_0x50acec(0x80),'common':{'name':'Deviation','type':_0x50acec(0xd3),'role':_0x50acec(0x80),'read':!![],'write':![],'def':'N/A'},'native':{}}),await _0x4de428[_0x50acec(0x1b1)](_0x50acec(0x227),{'type':_0x50acec(0x80),'common':{'name':_0x50acec(0x139),'type':_0x50acec(0xd3),'role':'text','read':!![],'write':![]},'native':{}}),await _0x4de428[_0x50acec(0x1b1)](_0x50acec(0xb8),{'type':'state','common':{'name':_0x50acec(0x170),'type':_0x50acec(0xd3),'role':_0x50acec(0xf7),'read':!![],'write':![]},'native':{}}),await _0x4de428[_0x50acec(0x188)]('analysis.automation',{'type':_0x50acec(0x14e),'common':{'name':_0x50acec(0x1c0)},'native':{}}),await _0x4de428['setObjectNotExistsAsync'](_0x50acec(0x24a),{'type':_0x50acec(0x80),'common':{'name':'Pattern\x20Detected','type':_0x50acec(0xf3),'role':'indicator','read':!![],'write':![],'def':![]},'native':{}}),await _0x4de428[_0x50acec(0x1b1)](_0x50acec(0x123),{'type':_0x50acec(0x80),'common':{'name':_0x50acec(0xb6),'type':_0x50acec(0xd3),'role':_0x50acec(0xf7),'read':!![],'write':![]},'native':{}}),await _0x4de428['setObjectNotExistsAsync'](_0x50acec(0x174),{'type':'state','common':{'name':_0x50acec(0x168),'type':_0x50acec(0xd3),'role':_0x50acec(0xf7),'read':!![],'write':![]},'native':{}}),await _0x4de428['setObjectNotExistsAsync'](_0x50acec(0x1ce),{'type':_0x50acec(0x80),'common':{'name':'Target\x20ID','type':_0x50acec(0xd3),'role':_0x50acec(0xf7),'read':!![],'write':![]},'native':{}}),await _0x4de428[_0x50acec(0x1b1)](_0x50acec(0xa1),{'type':_0x50acec(0x80),'common':{'name':'Target\x20Value','type':'string','role':_0x50acec(0xf7),'read':!![],'write':![]},'native':{}}),await _0x4de428[_0x50acec(0x1b1)](_0x50acec(0x1a4),{'type':'state','common':{'name':'Auto\x20Apply\x20Rule','type':_0x50acec(0xf3),'role':_0x50acec(0x112),'read':!![],'write':!![],'def':![]},'native':{}}),await _0x4de428[_0x50acec(0x1b1)](_0x50acec(0x1f4),{'type':_0x50acec(0x80),'common':{'name':_0x50acec(0x1ab),'type':_0x50acec(0xf3),'role':'button','read':!![],'write':!![],'def':![]},'native':{}}),await _0x4de428[_0x50acec(0x1b1)]('analysis.analysisHistory',{'type':_0x50acec(0x80),'common':{'name':'Logbook','type':_0x50acec(0xd3),'role':_0x50acec(0x20c),'read':!![],'write':![],'def':'[]'},'native':{}}),await _0x4de428['setObjectNotExistsAsync']('analysis.feedbackHistory',{'type':_0x50acec(0x80),'common':{'name':_0x50acec(0x198),'type':_0x50acec(0xd3),'role':_0x50acec(0x20c),'read':!![],'write':![],'def':'[]'},'native':{}}),await _0x4de428[_0x50acec(0x188)](_0x50acec(0x17b),{'type':_0x50acec(0x14e),'common':{'name':'Health\x20&\x20Sleep\x20Analysis'},'native':{}}),await _0x4de428['setObjectNotExistsAsync']('analysis.health.sleepScore',{'type':'state','common':{'name':_0x50acec(0xc9),'type':_0x50acec(0x14c),'role':_0x50acec(0x1de),'read':!![],'write':![],'def':0x0},'native':{}}),await _0x4de428[_0x50acec(0x1b1)](_0x50acec(0xdb),{'type':_0x50acec(0x80),'common':{'name':'Restlessness\x20Level','type':_0x50acec(0xd3),'role':_0x50acec(0xf7),'read':!![],'write':![],'def':'none'},'native':{}}),await _0x4de428[_0x50acec(0x1b1)](_0x50acec(0x1b6),{'type':_0x50acec(0x80),'common':{'name':_0x50acec(0x166),'type':_0x50acec(0xd3),'role':_0x50acec(0xf7),'read':!![],'write':![],'def':''},'native':{}}),await _0x4de428['setObjectNotExistsAsync'](_0x50acec(0x226),{'type':_0x50acec(0x80),'common':{'name':'Trend\x20Diagnosis\x20(Python)','type':_0x50acec(0xd3),'role':'text','read':!![],'write':![],'def':_0x50acec(0x105)},'native':{}}),await _0x4de428[_0x50acec(0x1b1)](_0x50acec(0x1ea),{'type':_0x50acec(0x80),'common':{'name':_0x50acec(0x147),'type':_0x50acec(0x14c),'role':_0x50acec(0x151),'read':!![],'write':![],'def':0x0},'native':{}}),await checkLtmObjects(_0x4de428),await checkLtmDriftObjects(_0x4de428);}async function checkSystemObjects(_0x51ec71){const _0x39f0de=a0_0x36ff8e;await _0x51ec71['extendObjectAsync'](_0x39f0de(0x1e1),{'type':_0x39f0de(0x14e),'common':{'name':'System\x20Status\x20&\x20Control'},'native':{}}),await _0x51ec71['extendObjectAsync'](SYSTEM_DP_MODE,{'type':_0x39f0de(0x80),'common':{'name':_0x39f0de(0x200),'type':'string','role':_0x39f0de(0x80),'read':!![],'write':!![],'def':SYSTEM_MODES[_0x39f0de(0x22a)],'states':{[SYSTEM_MODES[_0x39f0de(0x22a)]]:_0x39f0de(0x87),[SYSTEM_MODES['VACATION']]:_0x39f0de(0x115),[SYSTEM_MODES[_0x39f0de(0x104)]]:'Party',[SYSTEM_MODES[_0x39f0de(0xe4)]]:_0x39f0de(0x122)}},'native':{}});}async function checkLtmObjects(_0xd0d203){const _0x532849=a0_0x36ff8e;await _0xd0d203[_0x532849(0x188)]('LTM',{'type':'channel','common':{'name':_0x532849(0x95)},'native':{}}),await _0xd0d203[_0x532849(0x188)](LTM_DP_RAW_LOG,{'type':'state','common':{'name':_0x532849(0xb1),'type':_0x532849(0xd3),'role':_0x532849(0x20c),'read':!![],'write':![]},'native':{}}),await _0xd0d203['extendObjectAsync'](LTM_DP_DAILY_DIGESTS,{'type':_0x532849(0x80),'common':{'name':'Daily\x20Digests','type':_0x532849(0xd3),'role':_0x532849(0x20c),'read':!![],'write':![]},'native':{}}),await _0xd0d203['extendObjectAsync'](LTM_DP_STATUS,{'type':'state','common':{'name':_0x532849(0x229),'type':_0x532849(0xd3),'role':_0x532849(0xf7),'read':!![],'write':![]},'native':{}}),await _0xd0d203['extendObjectAsync'](LTM_DP_TRIGGER_DIGEST,{'type':'state','common':{'name':_0x532849(0x76),'type':'boolean','role':_0x532849(0xf6),'read':!![],'write':!![],'def':![]},'native':{}}),await _0xd0d203['extendObjectAsync'](LTM_DP_BASELINE_STATUS,{'type':_0x532849(0x80),'common':{'name':'Baseline\x20Status','type':_0x532849(0xd3),'role':_0x532849(0xf7),'read':!![],'write':![]},'native':{}});}async function checkLtmDriftObjects(_0x56fbb6){const _0x5757d6=a0_0x36ff8e;await _0x56fbb6[_0x5757d6(0x188)](LTM_DP_DRIFT_CHANNEL,{'type':_0x5757d6(0x14e),'common':{'name':'Drift\x20Analysis'},'native':{}}),await _0x56fbb6[_0x5757d6(0x188)](LTM_DP_DRIFT_STATUS,{'type':_0x5757d6(0x80),'common':{'name':'Drift\x20Status','type':'string','role':'state','read':!![],'write':![],'def':_0x5757d6(0x105)},'native':{}}),await _0x56fbb6[_0x5757d6(0x188)](LTM_DP_DRIFT_DETAILS,{'type':_0x5757d6(0x80),'common':{'name':_0x5757d6(0x13c),'type':_0x5757d6(0xd3),'role':_0x5757d6(0xf7),'read':!![],'write':![]},'native':{}}),await _0x56fbb6['extendObjectAsync'](LTM_DP_DRIFT_LAST_CHECK,{'type':_0x5757d6(0x80),'common':{'name':_0x5757d6(0x91),'type':'number','role':_0x5757d6(0x23f),'read':!![],'write':![]},'native':{}});}async function loadSystemMode(_0xd6f91c){const _0x2966ef=a0_0x36ff8e;try{const _0x470345=await _0xd6f91c['getStateAsync'](SYSTEM_DP_MODE);_0x470345&&_0x470345[_0x2966ef(0x145)]&&Object[_0x2966ef(0x199)](SYSTEM_MODES)[_0x2966ef(0x1c9)](_0x470345[_0x2966ef(0x145)])?_0xd6f91c[_0x2966ef(0x110)]=_0x470345[_0x2966ef(0x145)]:(_0xd6f91c[_0x2966ef(0x110)]=SYSTEM_MODES[_0x2966ef(0x22a)],await _0xd6f91c['setStateAsync'](SYSTEM_DP_MODE,{'val':SYSTEM_MODES[_0x2966ef(0x22a)],'ack':!![]}));}catch(_0x1fd896){_0xd6f91c[_0x2966ef(0x110)]=SYSTEM_MODES[_0x2966ef(0x22a)];}}async function loadRawEventLog(_0x2c68b1){const _0x43edb4=a0_0x36ff8e;try{const _0x1b7ccc=await _0x2c68b1[_0x43edb4(0xd5)](LTM_DP_RAW_LOG);if(_0x1b7ccc&&_0x1b7ccc[_0x43edb4(0x145)])_0x2c68b1[_0x43edb4(0x15e)]=JSON[_0x43edb4(0xae)](_0x1b7ccc[_0x43edb4(0x145)]);}catch(_0x661f9c){_0x2c68b1[_0x43edb4(0x15e)]=[];}}async function saveRawEventLog(_0x526ca2){const _0x5ce917=a0_0x36ff8e;_0x526ca2[_0x5ce917(0x15e)][_0x5ce917(0x8c)]>RAW_LOG_MAX_SIZE&&_0x526ca2['rawEventLog']['splice'](0x0,_0x526ca2[_0x5ce917(0x15e)][_0x5ce917(0x8c)]-RAW_LOG_MAX_SIZE),await _0x526ca2[_0x5ce917(0x1dd)](LTM_DP_RAW_LOG,{'val':JSON['stringify'](_0x526ca2['rawEventLog']),'ack':!![]});}async function loadDailyDigests(_0x15fc00){const _0x36202a=a0_0x36ff8e;try{const _0x22914d=await _0x15fc00['getStateAsync'](LTM_DP_DAILY_DIGESTS);if(_0x22914d&&_0x22914d[_0x36202a(0x145)])_0x15fc00['dailyDigests']=JSON[_0x36202a(0xae)](_0x22914d[_0x36202a(0x145)]);}catch(_0x145fa9){_0x15fc00[_0x36202a(0x23d)]=[];}await updateBaselineStatus(_0x15fc00);}async function saveDailyDigests(_0x539727,_0x14020f=!![]){const _0x267588=a0_0x36ff8e,_0x47b1c3=_0x539727[_0x267588(0x142)][_0x267588(0x143)]||0x3c;_0x539727['dailyDigests'][_0x267588(0x8c)]>_0x47b1c3&&_0x539727[_0x267588(0x23d)][_0x267588(0x1d3)](0x0,_0x539727[_0x267588(0x23d)][_0x267588(0x8c)]-_0x47b1c3);await _0x539727[_0x267588(0x1dd)](LTM_DP_DAILY_DIGESTS,{'val':JSON[_0x267588(0x14f)](_0x539727[_0x267588(0x23d)]),'ack':!![]});if(_0x14020f)await updateBaselineStatus(_0x539727);}async function updateAnalysisHistory(_0x3e49aa,_0x2a1d9c){const _0x402ab6=a0_0x36ff8e;_0x3e49aa[_0x402ab6(0x165)][_0x402ab6(0x1c1)](_0x2a1d9c);if(_0x3e49aa[_0x402ab6(0x165)][_0x402ab6(0x8c)]>ANALYSIS_HISTORY_MAX_SIZE)_0x3e49aa['analysisHistory'][_0x402ab6(0xc1)]();await _0x3e49aa[_0x402ab6(0x1dd)](_0x402ab6(0x159),{'val':JSON[_0x402ab6(0x14f)](_0x3e49aa[_0x402ab6(0x165)]),'ack':!![]});}async function updateBaselineStatus(_0x1493d8){const _0x50e8ac=a0_0x36ff8e;if(!_0x1493d8[_0x50e8ac(0x74)]){await _0x1493d8[_0x50e8ac(0x1dd)](LTM_DP_BASELINE_STATUS,{'val':_0x50e8ac(0x1b0),'ack':!![]});return;}const _0x12a4ac=_0x1493d8['dailyDigests'][_0x50e8ac(0x8c)]>=(_0x1493d8[_0x50e8ac(0x142)][_0x50e8ac(0x21f)]||0x7)?'Aktiv\x20('+_0x1493d8[_0x50e8ac(0x23d)]['length']+_0x50e8ac(0xc5):_0x50e8ac(0xbe)+_0x1493d8[_0x50e8ac(0x23d)][_0x50e8ac(0x8c)]+'/'+(_0x1493d8['config'][_0x50e8ac(0x21f)]||0x7)+')';await _0x1493d8[_0x50e8ac(0x1dd)](LTM_DP_BASELINE_STATUS,{'val':_0x12a4ac,'ack':!![]});}async function initSensorSubscriptions(_0x5ee2b3){const _0x37c773=a0_0x36ff8e,_0x1f388e=_0x5ee2b3[_0x37c773(0x142)][_0x37c773(0xdc)];if(_0x1f388e&&_0x1f388e['length']>0x0){_0x5ee2b3[_0x37c773(0x92)][_0x37c773(0x24d)](_0x37c773(0x231)+_0x1f388e[_0x37c773(0x8c)]+_0x37c773(0x209));for(const _0x5a5797 of _0x1f388e){if(_0x5a5797['id']){await _0x5ee2b3[_0x37c773(0xcc)](_0x5a5797['id']);try{const _0x46d94e=await _0x5ee2b3['getForeignStateAsync'](_0x5a5797['id']);if(_0x46d94e)_0x5ee2b3['sensorLastValues'][_0x5a5797['id']]=_0x46d94e[_0x37c773(0x145)];}catch(_0x54d4f2){}}}}}async function initPresenceSubscriptions(_0xd81492){const _0xe178eb=a0_0x36ff8e,_0x46b294=_0xd81492[_0xe178eb(0x142)][_0xe178eb(0xa0)]||[];if(_0x46b294[_0xe178eb(0x8c)]>0x0){_0xd81492[_0xe178eb(0x92)][_0xe178eb(0x24d)]('Subscribing\x20to\x20'+_0x46b294[_0xe178eb(0x8c)]+_0xe178eb(0x14b));for(const _0x3945ac of _0x46b294){await _0xd81492[_0xe178eb(0xcc)](_0x3945ac);}try{await checkWifiPresence(_0xd81492);}catch(_0x5f68e9){}}}async function getWeatherContext(_0x135306){const _0x6f35ea=a0_0x36ff8e;try{if(!_0x135306[_0x6f35ea(0x142)]['useWeather'])return _0x6f35ea(0xa2);let _0xd3f0ff='';const _0x340e42=_0x135306[_0x6f35ea(0x142)][_0x6f35ea(0x120)];if(_0x340e42)try{if(_0x340e42[_0x6f35ea(0x1c9)](_0x6f35ea(0x127))){const _0x58447c=await _0x135306[_0x6f35ea(0xce)](_0x340e42+_0x6f35ea(0xe6));if(_0x58447c&&_0x58447c[_0x6f35ea(0x145)])_0xd3f0ff=_0x58447c['val'];}else{if(_0x340e42[_0x6f35ea(0x1c9)]('daswetter')){const _0x137838=await _0x135306[_0x6f35ea(0xce)](_0x340e42+_0x6f35ea(0x237));if(_0x137838&&_0x137838[_0x6f35ea(0x145)])_0xd3f0ff=_0x137838['val'];}else{if(_0x340e42[_0x6f35ea(0x1c9)](_0x6f35ea(0x7b))){const _0x3c233d=await _0x135306['getForeignStateAsync'](_0x340e42+_0x6f35ea(0x176));if(_0x3c233d&&_0x3c233d['val'])_0xd3f0ff=_0x3c233d['val'];}}}}catch(_0x3bfdd7){}if(!_0xd3f0ff){const _0x1471c3=[_0x6f35ea(0xea),'daswetter.0',_0x6f35ea(0x234),_0x6f35ea(0x82)];for(const _0x3662ca of _0x1471c3){try{const _0x311bb4=await _0x135306[_0x6f35ea(0x132)](_0x3662ca);if(_0x311bb4){if(_0x3662ca[_0x6f35ea(0x1c9)](_0x6f35ea(0x127))){const _0x1365dc=await _0x135306[_0x6f35ea(0xce)](_0x3662ca+_0x6f35ea(0xe6));if(_0x1365dc&&_0x1365dc[_0x6f35ea(0x145)]){_0xd3f0ff=_0x1365dc[_0x6f35ea(0x145)];break;}}}}catch(_0xb8d873){}}}return _0xd3f0ff?_0x6f35ea(0xc6)+_0xd3f0ff:_0x6f35ea(0xfe);}catch(_0x442a27){return _0x6f35ea(0xe1)+_0x442a27[_0x6f35ea(0x148)];}}async function getCalendarContext(_0xc371c1){const _0x483a10=a0_0x36ff8e;try{if(!_0xc371c1[_0x483a10(0x142)][_0x483a10(0x1b4)])return _0x483a10(0x178);let _0x5eee3e=_0xc371c1[_0x483a10(0x142)][_0x483a10(0x15c)]||_0x483a10(0xe2),_0x52ed8d=_0xc371c1[_0x483a10(0x142)][_0x483a10(0xde)]||[];if(typeof _0x52ed8d===_0x483a10(0xd3))_0x52ed8d=_0x52ed8d['split'](',');try{const _0x1498b1=await _0xc371c1[_0x483a10(0xce)](_0x5eee3e+'.data.table');if(_0x1498b1&&_0x1498b1[_0x483a10(0x145)]){let _0x1e4aae=tryParse(_0x1498b1[_0x483a10(0x145)]);if(_0x1e4aae&&Array[_0x483a10(0x239)](_0x1e4aae)){if(_0x52ed8d[_0x483a10(0x8c)]>0x0)_0x1e4aae=_0x1e4aae[_0x483a10(0x158)](_0x24b1c4=>_0x52ed8d[_0x483a10(0x1c9)](_0x24b1c4['_calName']||''));else return _0x483a10(0x12a);if(_0x1e4aae[_0x483a10(0x8c)]>0x0){const _0x4735f2=_0x1e4aae[_0x483a10(0x16f)](0x0,0x3)[_0x483a10(0xfa)](_0xdbba06=>{const _0x445bcb=_0x483a10;let _0x49f0e0=_0xdbba06['date'];if(_0xdbba06['time'])_0x49f0e0+='\x20'+_0xdbba06[_0x445bcb(0x1f3)];return _0x49f0e0+':\x20'+_0xdbba06[_0x445bcb(0x232)]+'\x20('+_0xdbba06[_0x445bcb(0xfd)]+')';});return'KALENDER:\x20'+_0x4735f2[_0x483a10(0x185)](_0x483a10(0x221));}else return _0x483a10(0x10c);}}}catch(_0x48aae2){_0xc371c1[_0x483a10(0x92)][_0x483a10(0x1e5)](_0x483a10(0x245)+_0x48aae2[_0x483a10(0x148)]);}return _0x483a10(0xa4);}catch(_0xab5614){return _0x483a10(0xab)+_0xab5614[_0x483a10(0x148)];}}async function getCalendarNames(_0x395a62,_0x37168c){const _0x109f64=a0_0x36ff8e;try{const _0x3c7629=await _0x395a62[_0x109f64(0xce)](_0x37168c+_0x109f64(0x89));if(_0x3c7629&&_0x3c7629['val']){const _0x26213f=tryParse(_0x3c7629[_0x109f64(0x145)]);if(_0x26213f&&Array[_0x109f64(0x239)](_0x26213f)){const _0xe262db=[...new Set(_0x26213f[_0x109f64(0xfa)](_0x3426cc=>_0x3426cc['_calName'])['filter'](Boolean))];return _0xe262db[_0x109f64(0x1fd)]();}}return[];}catch(_0x29de88){return _0x395a62[_0x109f64(0x92)][_0x109f64(0x98)](_0x109f64(0x1fc)+_0x29de88[_0x109f64(0x148)]),[];}}async function checkWifiPresence(_0x29066c){const _0x3473a7=a0_0x36ff8e;try{const _0x482bc9=_0x29066c[_0x3473a7(0x142)][_0x3473a7(0xa0)]||[];let _0x56de46=![];const _0x2029d9=[];for(const _0x56491b of _0x482bc9){try{const _0x25f2a0=await _0x29066c[_0x3473a7(0xce)](_0x56491b);if(_0x25f2a0&&(_0x25f2a0['val']===!![]||_0x25f2a0[_0x3473a7(0x145)]==='online'||_0x25f2a0[_0x3473a7(0x145)]===0x1)){_0x56de46=!![];const _0x15db89=await _0x29066c[_0x3473a7(0x132)](_0x56491b);let _0x1385f4=_0x56491b;_0x15db89&&_0x15db89['common']&&_0x15db89[_0x3473a7(0x169)]['name']&&(_0x1385f4=typeof _0x15db89[_0x3473a7(0x169)][_0x3473a7(0x204)]===_0x3473a7(0xd2)?_0x15db89['common'][_0x3473a7(0x204)]['de']||_0x15db89[_0x3473a7(0x169)][_0x3473a7(0x204)]['en']:_0x15db89[_0x3473a7(0x169)][_0x3473a7(0x204)]),_0x2029d9[_0x3473a7(0x11c)](_0x1385f4);}}catch(_0x26112a){}}return await _0x29066c['setStateAsync'](_0x3473a7(0xdf),{'val':_0x2029d9[_0x3473a7(0x185)](',\x20'),'ack':!![]}),_0x56de46&&(_0x29066c[_0x3473a7(0xeb)]&&(_0x29066c[_0x3473a7(0x92)][_0x3473a7(0x24d)](_0x3473a7(0x220)),abortExitTimer(_0x29066c)),!_0x29066c[_0x3473a7(0x224)]&&_0x29066c['currentSystemMode']===SYSTEM_MODES['NORMAL']&&await setPresence(_0x29066c,!![])),_0x56de46;}catch(_0x106ffe){return _0x29066c[_0x3473a7(0x92)][_0x3473a7(0x98)]('Error\x20checking\x20WiFi:\x20'+_0x106ffe[_0x3473a7(0x148)]),![];}}function startExitTimer(_0x592192){const _0x6f553=a0_0x36ff8e;abortExitTimer(_0x592192),_0x592192[_0x6f553(0xbf)]=!![],_0x592192[_0x6f553(0x1d6)]=setTimeout(()=>{const _0x38b287=_0x6f553;_0x592192[_0x38b287(0xbf)]=![];},EXIT_GRACE_PERIOD_SECONDS*0x3e8),_0x592192[_0x6f553(0xeb)]=setTimeout(()=>{const _0x433f81=_0x6f553;setPresence(_0x592192,![]),_0x592192[_0x433f81(0xeb)]=null;},EXIT_TIMER_MINUTES*0x3c*0x3e8);}function abortExitTimer(_0x2af559){const _0x2cf885=a0_0x36ff8e;if(_0x2af559[_0x2cf885(0xeb)])clearTimeout(_0x2af559[_0x2cf885(0xeb)]);if(_0x2af559[_0x2cf885(0x1d6)])clearTimeout(_0x2af559[_0x2cf885(0x1d6)]);_0x2af559[_0x2cf885(0xeb)]=null,_0x2af559[_0x2cf885(0x1d6)]=null,_0x2af559[_0x2cf885(0xbf)]=![];}async function setPresence(_0x3aa018,_0x540731){const _0x491e09=a0_0x36ff8e;if(_0x3aa018[_0x491e09(0x224)]===_0x540731)return;_0x3aa018['isPresent']=_0x540731,await _0x3aa018[_0x491e09(0x1dd)](_0x491e09(0x216),{'val':_0x540731,'ack':!![]});}async function saveFeedback(_0x2e7d63,_0x43238b){const _0x555707=a0_0x36ff8e;_0x2e7d63[_0x555707(0x92)][_0x555707(0x24d)](_0x555707(0x241)+JSON['stringify'](_0x43238b));}async function runBaselineDriftAnalysis(_0x35a0e0){const _0x381cf3=a0_0x36ff8e;if(!_0x35a0e0[_0x381cf3(0x74)]||!_0x35a0e0[_0x381cf3(0x1c4)])return;const _0x42fe2b=_0x35a0e0[_0x381cf3(0x142)][_0x381cf3(0x17d)]||0xe;if(_0x35a0e0[_0x381cf3(0x23d)]['length']<_0x42fe2b+(_0x35a0e0[_0x381cf3(0x142)][_0x381cf3(0x21f)]||0x7)){await _0x35a0e0['setStateAsync'](LTM_DP_DRIFT_STATUS,{'val':_0x381cf3(0x225),'ack':!![]});return;}const _0x58409a=_0x35a0e0['dailyDigests'][_0x381cf3(0x16f)](-_0x42fe2b),_0x11c190=_0x35a0e0[_0x381cf3(0x23d)][_0x381cf3(0x16f)](0x0,_0x35a0e0['dailyDigests'][_0x381cf3(0x8c)]-_0x42fe2b),_0x10a5b6=_0x381cf3(0x13f)+JSON[_0x381cf3(0x14f)](_0x11c190)+_0x381cf3(0xcd)+JSON['stringify'](_0x58409a);try{const _0x1613c7=await _0x35a0e0[_0x381cf3(0x1c4)]['generateContent'](_0x10a5b6),_0xc2417c=JSON[_0x381cf3(0xae)](_0x1613c7[_0x381cf3(0x153)][_0x381cf3(0xf7)]()['replace'](/```json|```/g,'')['trim']());_0xc2417c[_0x381cf3(0x10a)]&&(await _0x35a0e0[_0x381cf3(0x1dd)](LTM_DP_DRIFT_STATUS,{'val':_0xc2417c['baselineDrift'],'ack':!![]}),await _0x35a0e0['setStateAsync'](LTM_DP_DRIFT_DETAILS,{'val':_0xc2417c[_0x381cf3(0x19a)],'ack':!![]}),await _0x35a0e0[_0x381cf3(0x1dd)](LTM_DP_DRIFT_LAST_CHECK,{'val':Date[_0x381cf3(0x1d0)](),'ack':!![]}));}catch(_0xce18a4){}}function setupLtmScheduler(_0x5aeb59){const _0x11a29f=a0_0x36ff8e;try{if(_0x5aeb59[_0x11a29f(0x21b)])_0x5aeb59['ltmJob'][_0x11a29f(0x1d9)]();if(!_0x5aeb59[_0x11a29f(0x74)]){_0x5aeb59[_0x11a29f(0x1dd)](LTM_DP_STATUS,{'val':_0x11a29f(0x1b0),'ack':!![]});return;}_0x5aeb59[_0x11a29f(0x21b)]=schedule['scheduleJob'](LTM_SCHEDULE,()=>createDailyDigest(_0x5aeb59));}catch(_0x59b3ac){_0x5aeb59[_0x11a29f(0x92)]['error']('LTM\x20Sched\x20Error:\x20'+_0x59b3ac[_0x11a29f(0x148)]);}}function setupModeResetScheduler(_0x63ac71){const _0xffac81=a0_0x36ff8e;try{if(_0x63ac71['modeResetJob'])_0x63ac71['modeResetJob']['cancel']();_0x63ac71[_0xffac81(0x1bc)]=schedule[_0xffac81(0x1bb)](MODE_RESET_SCHEDULE,async()=>{const _0x3d22be=_0xffac81;await loadSystemMode(_0x63ac71),AUTO_RESET_MODES['includes'](_0x63ac71[_0x3d22be(0x110)])&&await _0x63ac71[_0x3d22be(0x1dd)](SYSTEM_DP_MODE,{'val':SYSTEM_MODES[_0x3d22be(0x22a)],'ack':![]});});}catch(_0x47ba12){_0x63ac71['log']['error'](_0xffac81(0x246)+_0x47ba12['message']);}}function setupDriftAnalysisScheduler(_0xdda226){const _0x2ed44a=a0_0x36ff8e;try{if(_0xdda226[_0x2ed44a(0x24b)])clearInterval(_0xdda226[_0x2ed44a(0x24b)]);if(!_0xdda226[_0x2ed44a(0x74)])return;_0xdda226[_0x2ed44a(0x24b)]=setInterval(()=>runBaselineDriftAnalysis(_0xdda226),(_0xdda226[_0x2ed44a(0x142)]['ltmDriftCheckIntervalHours']||0x18)*0x36ee80),setTimeout(()=>runBaselineDriftAnalysis(_0xdda226),0x1388);}catch(_0x2a7e9c){_0xdda226[_0x2ed44a(0x92)]['error']('Drift\x20Sched\x20Error:\x20'+_0x2a7e9c[_0x2ed44a(0x148)]);}}function setupBriefingScheduler(_0x398b5d){const _0xa2dd14=a0_0x36ff8e;try{if(_0x398b5d[_0xa2dd14(0x1bf)])_0x398b5d[_0xa2dd14(0x1bf)]['cancel']();if(!_0x398b5d['config']['briefingEnabled'])return;const _0x1f7686=(_0x398b5d[_0xa2dd14(0x142)]['briefingTime']||_0xa2dd14(0x1cd))['split'](':'),_0x44bebe=parseInt(_0x1f7686[0x0])||0x8,_0x40d888=parseInt(_0x1f7686[0x1])||0x0,_0x2dc887=_0x40d888+'\x20'+_0x44bebe+_0xa2dd14(0x17e);_0x398b5d[_0xa2dd14(0x92)][_0xa2dd14(0x24d)](_0xa2dd14(0x1e6)+_0x44bebe+':'+(_0x40d888<0xa?'0'+_0x40d888:_0x40d888)),_0x398b5d[_0xa2dd14(0x1bf)]=schedule['scheduleJob'](_0x2dc887,()=>{sendMorningBriefing(_0x398b5d);});}catch(_0x51a1b9){_0x398b5d['log'][_0xa2dd14(0x98)]('Briefing\x20Sched\x20Error:\x20'+_0x51a1b9[_0xa2dd14(0x148)]);}}async function sendNotification(_0x11475f,_0x496c00,_0x4741c2=![],_0x43672d=![]){const _0x42216b=a0_0x36ff8e;_0x11475f['log'][_0x42216b(0x24d)]((_0x4741c2?'[TEST]\x20':'')+_0x42216b(0x12e)+_0x496c00+'\x22');const _0x2f2a25=_0x11475f[_0x42216b(0x142)];let _0x2d6983=0x0;if(_0x2f2a25['notifyTelegramEnabled']){let _0x374619={};(_0x496c00[_0x42216b(0x1c9)](_0x42216b(0x113))||_0x43672d)&&(_0x374619={'reply_markup':{'inline_keyboard':[[{'text':_0x42216b(0x1c3),'callback_data':_0x42216b(0x1d2)}],[{'text':_0x42216b(0xe8),'callback_data':'COGNI_REQUEST_CALL'}]]}}),await _0x11475f[_0x42216b(0x222)](_0x2f2a25['notifyTelegramInstance'],_0x42216b(0x79),{'text':_0x496c00,'user':_0x2f2a25['notifyTelegramRecipient'],..._0x374619}),_0x2d6983++;}if(_0x2f2a25[_0x42216b(0x161)]){let _0x118b3d={'message':_0x496c00,'title':_0x43672d?'üö®\x20EMERGENCY':_0x42216b(0x128),'priority':_0x43672d?0x2:0x1,'device':_0x2f2a25[_0x42216b(0xda)]};_0x43672d&&(_0x118b3d[_0x42216b(0x138)]=0x1e,_0x118b3d[_0x42216b(0x1c2)]=0xe10,_0x118b3d['sound']=_0x42216b(0xa5)),await _0x11475f['sendToAsync'](_0x2f2a25[_0x42216b(0x126)],_0x42216b(0x79),_0x118b3d),_0x2d6983++;}return _0x2f2a25[_0x42216b(0x236)]&&(await _0x11475f[_0x42216b(0x222)](_0x2f2a25[_0x42216b(0x11b)],_0x42216b(0x79),{'text':_0x496c00,'to':_0x2f2a25[_0x42216b(0x20e)]}),_0x2d6983++),_0x2d6983;}async function setupTelegramListener(_0x1f884){const _0x5f0c8e=a0_0x36ff8e,_0x3a3ef6=_0x1f884[_0x5f0c8e(0x142)][_0x5f0c8e(0x1f9)];_0x1f884[_0x5f0c8e(0x142)][_0x5f0c8e(0x205)]&&_0x3a3ef6&&(_0x1f884[_0x5f0c8e(0x92)][_0x5f0c8e(0x24d)](_0x5f0c8e(0x10e)+_0x3a3ef6+'\x20for\x20interactive\x20buttons...'),await _0x1f884[_0x5f0c8e(0xcc)](_0x3a3ef6+_0x5f0c8e(0x7a)));}async function handleTelegramResponse(_0x13d490,_0x25bcb7){const _0xbfacbb=a0_0x36ff8e;let _0x114138=_0x25bcb7;_0x25bcb7[_0xbfacbb(0x12f)]('[')&&(_0x114138=_0x25bcb7[_0xbfacbb(0xaa)](_0x25bcb7['indexOf'](']')+0x1));if(_0x114138==='COGNI_CONFIRM_OK')_0x13d490[_0xbfacbb(0x92)][_0xbfacbb(0x24d)](_0xbfacbb(0x108)),await _0x13d490[_0xbfacbb(0x1dd)](_0xbfacbb(0x133),{'val':![],'ack':!![]}),await _0x13d490['setStateAsync'](_0xbfacbb(0x11d),{'val':'Vom\x20Benutzer\x20best√§tigt\x20(OK).','ack':!![]}),_0x13d490[_0xbfacbb(0xba)]=![],sendNotification(_0x13d490,_0xbfacbb(0x8a),![]);else _0x114138===_0xbfacbb(0xcb)&&(_0x13d490[_0xbfacbb(0x92)][_0xbfacbb(0x1e5)](_0xbfacbb(0x22c)),sendNotification(_0x13d490,_0xbfacbb(0x135),![],!![]));}function a0_0x2b2b(_0x4e38c6,_0x1308bc){const _0x2aa998=a0_0x1733();return a0_0x2b2b=function(_0x3f1217,_0x1d115f){_0x3f1217=_0x3f1217-0x74;let _0x1733b6=_0x2aa998[_0x3f1217];return _0x1733b6;},a0_0x2b2b(_0x4e38c6,_0x1308bc);}async function runAutopilot(_0x239bcd){const _0x2ed38f=a0_0x36ff8e,_0x419751=_0x239bcd[_0x2ed38f(0x142)][_0x2ed38f(0x136)],_0x522efc=_0x239bcd[_0x2ed38f(0x13e)]['length']>0x0?_0x239bcd[_0x2ed38f(0x13e)][0x0][_0x2ed38f(0x19f)]:Date[_0x2ed38f(0x1d0)](),_0x2a08d1=(Date[_0x2ed38f(0x1d0)]()-_0x522efc)/(0x3e8*0x3c*0x3c);let _0x3a2cf7='';_0x239bcd['config']['inactivityMonitoringEnabled']&&_0x239bcd['currentSystemMode']===SYSTEM_MODES[_0x2ed38f(0x22a)]&&_0x239bcd[_0x2ed38f(0x224)]&&(_0x2a08d1>_0x419751&&(_0x3a2cf7=_0x2ed38f(0x1d5)+_0x2a08d1[_0x2ed38f(0x201)](0x1)+_0x2ed38f(0x197))),runGeminiAnalysis(_0x239bcd,_0x3a2cf7)[_0x2ed38f(0xbb)](_0x4d8cdb=>_0x239bcd[_0x2ed38f(0x92)]['error'](_0x4d8cdb));}async function createDailyDigest(_0x446d18){const _0x1e39cf=a0_0x36ff8e;if(!_0x446d18[_0x1e39cf(0x74)])return;await _0x446d18[_0x1e39cf(0x1dd)](LTM_DP_STATUS,{'val':'Started\x20at\x20'+new Date()[_0x1e39cf(0x16c)](),'ack':!![]});if(!_0x446d18[_0x1e39cf(0x1c4)]||_0x446d18[_0x1e39cf(0x15e)][_0x1e39cf(0x8c)]<LTM_MIN_EVENTS_FOR_COMPRESSION){await _0x446d18[_0x1e39cf(0x1dd)](LTM_DP_STATUS,{'val':_0x1e39cf(0x1ff),'ack':!![]});return;}const _0x437365=JSON[_0x1e39cf(0xae)](JSON['stringify'](_0x446d18[_0x1e39cf(0x15e)])),_0x342357=_0x437365[_0x1e39cf(0x8c)],_0x1a43e1='ROLLE:\x20Data\x20Compression\x20Agent.\x20SPRACHE:\x20DE.\x20FORMAT:\x20JSON.\x20ANWEISUNG:\x20Fasse\x20Sensor-Events\x20zusammen.\x20SCHEMA:\x20{\x20\x22summary\x22:\x20\x22string\x22,\x20\x22activityLevel\x22:\x20\x22string\x22\x20}\x20\x0a\x0aEVENTS:\x0a'+JSON[_0x1e39cf(0x14f)](_0x437365);try{const _0x1c0d20=await _0x446d18[_0x1e39cf(0x1c4)][_0x1e39cf(0x157)](_0x1a43e1),_0x4c8123=JSON[_0x1e39cf(0xae)](_0x1c0d20[_0x1e39cf(0x153)][_0x1e39cf(0xf7)]()[_0x1e39cf(0x90)](/```json|```/g,'')[_0x1e39cf(0x9d)]());_0x4c8123['summary']&&(_0x446d18[_0x1e39cf(0x23d)][_0x1e39cf(0x11c)]({'timestamp':new Date()[_0x1e39cf(0x93)](),'eventCount':_0x342357,'summary':_0x4c8123[_0x1e39cf(0xc0)],'activityLevel':_0x4c8123[_0x1e39cf(0x14d)],'systemMode':_0x446d18[_0x1e39cf(0x110)]}),await saveDailyDigests(_0x446d18),_0x446d18[_0x1e39cf(0x15e)]=[],await saveRawEventLog(_0x446d18),await _0x446d18[_0x1e39cf(0x1dd)](LTM_DP_STATUS,{'val':_0x1e39cf(0x9c)+_0x342357+_0x1e39cf(0xd0),'ack':!![]}),runPythonHealthCheck(_0x446d18));}catch(_0x3c6073){await _0x446d18['setStateAsync'](LTM_DP_STATUS,{'val':_0x1e39cf(0x146)+_0x3c6073[_0x1e39cf(0x148)],'ack':!![]});}}async function sendMorningBriefing(_0x48b6e9){const _0x53dc6b=a0_0x36ff8e;if(!_0x48b6e9[_0x53dc6b(0x1c4)])return;_0x48b6e9[_0x53dc6b(0x92)][_0x53dc6b(0x24d)](_0x53dc6b(0x12d));const _0x23e179=_0x48b6e9[_0x53dc6b(0x23d)][_0x53dc6b(0x8c)]>0x0?_0x48b6e9[_0x53dc6b(0x23d)][_0x48b6e9[_0x53dc6b(0x23d)]['length']-0x1]:null,_0x219c07=_0x23e179&&_0x23e179[_0x53dc6b(0x17f)]?_0x23e179[_0x53dc6b(0x17f)]['sleepScore']:_0x53dc6b(0x105),_0x30525a=new Date();_0x30525a[_0x53dc6b(0x251)](0x4,0x0,0x0,0x0);const _0x4e0ec0=_0x48b6e9['eventHistory'][_0x53dc6b(0x158)](_0x2f6260=>new Date(_0x2f6260[_0x53dc6b(0x19f)])>_0x30525a),_0xd74a63=PERSONA_MAPPING[_0x48b6e9['config'][_0x53dc6b(0x179)]||_0x53dc6b(0x140)],_0x59bcdf=_0x48b6e9[_0x53dc6b(0x142)]['livingContext']||'',_0x12c444=await getWeatherContext(_0x48b6e9),_0x4c5b3c=await getCalendarContext(_0x48b6e9),_0x13c1c2='ROLLE:\x20F√ºrsorglicher\x20Assistent.\x20AUFGABE:\x20Schreibe\x20eine\x20kurze,\x20beruhigende\x20\x22Guten\x20Morgen\x22-Nachricht.\x20PERSONA:\x20'+_0xd74a63+_0x53dc6b(0x22e)+_0x59bcdf+_0x53dc6b(0x8f)+_0x12c444+'\x20'+_0x4c5b3c+_0x53dc6b(0xa3)+_0x219c07+_0x53dc6b(0x1f6)+JSON[_0x53dc6b(0x14f)](_0x4e0ec0[_0x53dc6b(0x16f)](0x0,0xa))+_0x53dc6b(0x202);try{const _0x4de980=await _0x48b6e9[_0x53dc6b(0x1c4)][_0x53dc6b(0x157)](_0x13c1c2),_0x3b2c14=_0x53dc6b(0x23c)+_0x4de980[_0x53dc6b(0x153)]['text']()[_0x53dc6b(0x9d)]();sendNotification(_0x48b6e9,_0x3b2c14),_0x48b6e9[_0x53dc6b(0x92)][_0x53dc6b(0x24d)](_0x53dc6b(0xf0));}catch(_0x4d2550){_0x48b6e9[_0x53dc6b(0x92)]['error']('Briefing\x20Error:\x20'+_0x4d2550[_0x53dc6b(0x148)]);}}async function scanForDevices(_0xef7baf,_0x14e8c2){const _0x4c86ca=a0_0x36ff8e;_0xef7baf[_0x4c86ca(0x92)]['info']('Scanning\x20for\x20devices\x20(V8:\x20Whitelist\x20Priority)...');const _0x1a14e1=[],_0x385589=await _0xef7baf[_0x4c86ca(0x14a)]('*'),_0x51d69c=await _0xef7baf[_0x4c86ca(0x14a)](_0x4c86ca(0x144),_0x4c86ca(0x9a)),_0x1983a8=await _0xef7baf[_0x4c86ca(0x14a)]('enum.rooms.*',_0x4c86ca(0x9a)),_0x3d02f3={};if(_0x51d69c)for(const _0x34e1b3 in _0x51d69c){const _0x10b78c=_0x51d69c[_0x34e1b3][_0x4c86ca(0x169)]['members']||[];_0x10b78c[_0x4c86ca(0x1d1)](_0x2d2f80=>{const _0x174370=_0x4c86ca;if(!_0x3d02f3[_0x2d2f80])_0x3d02f3[_0x2d2f80]=[];_0x3d02f3[_0x2d2f80][_0x174370(0x11c)](_0x34e1b3);});}const _0x3f4182={};if(_0x1983a8)for(const _0x14e242 in _0x1983a8){const _0x2508c0=_0x1983a8[_0x14e242]['common'][_0x4c86ca(0xd7)]||[],_0x1d8c7f=typeof _0x1983a8[_0x14e242][_0x4c86ca(0x169)][_0x4c86ca(0x204)]==='object'?_0x1983a8[_0x14e242][_0x4c86ca(0x169)][_0x4c86ca(0x204)]['de']:_0x1983a8[_0x14e242][_0x4c86ca(0x169)][_0x4c86ca(0x204)];_0x2508c0[_0x4c86ca(0x1d1)](_0x135bb8=>_0x3f4182[_0x135bb8]=_0x1d8c7f);}const _0x2cc50c=_0x14e8c2['selectedFunctionIds']||[],_0x13c66d=_0x14e8c2[_0x4c86ca(0x215)]!==![],_0xdb3eab=_0x14e8c2[_0x4c86ca(0x152)]!==![],_0x38c24b=_0x14e8c2[_0x4c86ca(0x1fa)]!==![],_0x1a882b=_0x14e8c2[_0x4c86ca(0x214)]===!![],_0x574deb=_0x14e8c2[_0x4c86ca(0x175)]===!![];for(const _0x27303e in _0x385589){const _0x452b29=_0x385589[_0x27303e];if(_0x452b29[_0x4c86ca(0x7f)]!==_0x4c86ca(0x80)||!_0x452b29['common'])continue;if(ADAPTER_BLACKLIST['some'](_0x1d5c5a=>_0x27303e['startsWith'](_0x1d5c5a))&&!_0x574deb)continue;const _0x3ec6f2=(_0x452b29[_0x4c86ca(0x169)][_0x4c86ca(0xe5)]||'')[_0x4c86ca(0x206)]();let _0xd12917=(typeof _0x452b29[_0x4c86ca(0x169)][_0x4c86ca(0x204)]===_0x4c86ca(0xd2)?_0x452b29[_0x4c86ca(0x169)][_0x4c86ca(0x204)]['de']:_0x452b29[_0x4c86ca(0x169)][_0x4c86ca(0x204)])||_0x27303e;const _0x35c247=_0xd12917[_0x4c86ca(0x206)]();let _0x3f3144=![],_0x38053d=![];if(_0x2cc50c[_0x4c86ca(0x8c)]>0x0){const _0x3182f9=_0x3d02f3[_0x27303e]||[],_0x4d1b56=_0x27303e['split']('.')['slice'](0x0,-0x1)[_0x4c86ca(0x185)]('.'),_0x1140a5=_0x3d02f3[_0x4d1b56]||[];(_0x3182f9[_0x4c86ca(0x100)](_0x16e01d=>_0x2cc50c[_0x4c86ca(0x1c9)](_0x16e01d))||_0x1140a5[_0x4c86ca(0x100)](_0x1091f6=>_0x2cc50c[_0x4c86ca(0x1c9)](_0x1091f6)))&&(_0x3f3144=!![],_0x38053d=!![]);}if(!_0x3f3144&&!_0x574deb){if(HARD_IGNORE_TERMS[_0x4c86ca(0x100)](_0x4ef908=>_0x27303e[_0x4c86ca(0x1c9)](_0x4ef908)||_0x35c247[_0x4c86ca(0x1c9)](_0x4ef908[_0x4c86ca(0x206)]())))continue;}if(BAD_NAMES[_0x4c86ca(0x100)](_0x2aba42=>_0x35c247===_0x2aba42||_0x35c247[_0x4c86ca(0x16d)]('.'+_0x2aba42))){const _0x3ea9fc=_0x27303e[_0x4c86ca(0x9e)]('.');if(_0x3ea9fc[_0x4c86ca(0x8c)]>0x2){const _0x446eb8=_0x3ea9fc[_0x4c86ca(0x16f)](0x0,-0x1)[_0x4c86ca(0x185)]('.'),_0x55471e=_0x385589[_0x446eb8];if(_0x55471e&&_0x55471e[_0x4c86ca(0x169)]&&_0x55471e[_0x4c86ca(0x169)][_0x4c86ca(0x204)]){const _0x1ccc5a=typeof _0x55471e[_0x4c86ca(0x169)][_0x4c86ca(0x204)]===_0x4c86ca(0xd2)?_0x55471e[_0x4c86ca(0x169)]['name']['de']:_0x55471e['common'][_0x4c86ca(0x204)];_0x1ccc5a&&!_0xd12917[_0x4c86ca(0x1c9)](_0x1ccc5a)&&(_0xd12917=_0x1ccc5a+'\x20'+_0xd12917);}}}let _0x4b8504='';if(_0x13c66d&&(_0x3ec6f2[_0x4c86ca(0x1c9)](_0x4c86ca(0x215))||_0x3ec6f2['includes'](_0x4c86ca(0x1b2))||_0x35c247[_0x4c86ca(0x1c9)](_0x4c86ca(0x114))||_0x35c247[_0x4c86ca(0x1c9)](_0x4c86ca(0x22f))))_0x4b8504=_0x4c86ca(0x215);else{if(!_0x4b8504&&_0xdb3eab&&(_0x3ec6f2[_0x4c86ca(0x1c9)](_0x4c86ca(0x1a7))||_0x3ec6f2[_0x4c86ca(0x1c9)](_0x4c86ca(0x207))||_0x3ec6f2[_0x4c86ca(0x1c9)](_0x4c86ca(0xfc))||_0x3ec6f2['includes']('blind')||_0x3ec6f2[_0x4c86ca(0x1c9)](_0x4c86ca(0xa8))||_0x35c247[_0x4c86ca(0x1c9)](_0x4c86ca(0x155))||_0x35c247[_0x4c86ca(0x1c9)](_0x4c86ca(0x1e3))||_0x35c247[_0x4c86ca(0x1c9)](_0x4c86ca(0x1a0))))_0x4b8504=_0x4c86ca(0x1a7);else{if(!_0x4b8504&&_0x38c24b&&(_0x3ec6f2['includes'](_0x4c86ca(0x16a))||_0x3ec6f2[_0x4c86ca(0x1c9)](_0x4c86ca(0x112))||_0x3ec6f2['includes'](_0x4c86ca(0x171))||_0x35c247[_0x4c86ca(0x1c9)](_0x4c86ca(0x19c))||_0x35c247[_0x4c86ca(0x1c9)](_0x4c86ca(0x106))||_0x35c247[_0x4c86ca(0x1c9)]('schalter'))){if(_0x452b29[_0x4c86ca(0x169)]['write']||_0x3ec6f2[_0x4c86ca(0x1c9)](_0x4c86ca(0x13d)))_0x4b8504=_0x4c86ca(0x16a);}else{if(!_0x4b8504&&_0x1a882b&&(_0x3ec6f2[_0x4c86ca(0x1c9)]('temperature')||_0x3ec6f2[_0x4c86ca(0x1c9)]('humidity')||_0x3ec6f2['includes'](_0x4c86ca(0xc3))||_0x35c247[_0x4c86ca(0x1c9)](_0x4c86ca(0xb3))||_0x35c247[_0x4c86ca(0x1c9)](_0x4c86ca(0x1db))||_0x35c247['includes'](_0x4c86ca(0x8b))))_0x4b8504='temperature';else{if(!_0x4b8504&&_0x38053d)_0x4b8504=_0x4c86ca(0x119);}}}}if(_0x4b8504){let _0x118afa=_0x3f4182[_0x27303e]||'';if(!_0x118afa){let _0x369637=_0x27303e;for(let _0x1a406e=0x0;_0x1a406e<0x3;_0x1a406e++){const _0x46c147=_0x369637['lastIndexOf']('.');if(_0x46c147===-0x1)break;_0x369637=_0x369637[_0x4c86ca(0xaa)](0x0,_0x46c147);if(_0x3f4182[_0x369637]){_0x118afa=_0x3f4182[_0x369637];break;}}}_0x1a14e1[_0x4c86ca(0x11c)]({'id':_0x27303e,'name':_0xd12917,'location':_0x118afa,'type':_0x4b8504,'logDuplicates':_0x4b8504===_0x4c86ca(0x215),'isExit':![],'_score':_0x118afa?0x50:_0x4b8504==='custom'?0x5a:0x28});}}return _0x1a14e1[_0x4c86ca(0x1fd)]((_0x564b47,_0x26d7ee)=>_0x26d7ee[_0x4c86ca(0x1aa)]-_0x564b47[_0x4c86ca(0x1aa)]),_0x1a14e1;}async function executeAutomationAction(_0x52c4d0){const _0x1dabb2=a0_0x36ff8e;try{const _0x15eec4=await _0x52c4d0[_0x1dabb2(0xd5)](_0x1dabb2(0x1ce)),_0x116458=await _0x52c4d0[_0x1dabb2(0xd5)](_0x1dabb2(0xa1));if(_0x15eec4&&_0x15eec4[_0x1dabb2(0x145)]&&_0x116458){const _0xffc4bb=_0x15eec4[_0x1dabb2(0x145)];let _0x2b2c83=_0x116458['val'];try{_0x2b2c83=JSON[_0x1dabb2(0xae)](_0x2b2c83);}catch(_0x5c066f){}_0x52c4d0['log'][_0x1dabb2(0x24d)](_0x1dabb2(0x11f)+_0xffc4bb+_0x1dabb2(0x1a9)+_0x2b2c83),await _0x52c4d0[_0x1dabb2(0x23e)](_0xffc4bb,_0x2b2c83);}else _0x52c4d0[_0x1dabb2(0x92)][_0x1dabb2(0x1e5)](_0x1dabb2(0x1e8));}catch(_0x3b8c8a){_0x52c4d0[_0x1dabb2(0x92)][_0x1dabb2(0x98)](_0x1dabb2(0x1d4)+_0x3b8c8a[_0x1dabb2(0x148)]);}}function a0_0x1733(){const _0x206c0e=['devices','Fokus\x20auf\x20Komfort.','calendarSelection','system.presenceWho','PRIORIT√ÑT:\x20Gesundheit/AAL.','WETTER\x20ERROR:\x20','ical.0','native','GUEST','role','.Summary.Current','search','üìû\x20R√ºckruf\x20anfordern','telegram','accuweather.0','exitTimer','üß™\x20Simulating\x20Butler\x20Proposal:\x20','Motion\x20detected\x20inside.\x20Aborting\x20Exit\x20Timer.','VACATION','child_process','Morning\x20Briefing\x20sent.','LTM.driftAnalysis.driftDetails','system.mode','boolean','systemConfig','Activity-Level','button','text','submitFeedback','üõ†Ô∏è\x20AUTO-FIX:\x20Installing\x20Python\x20dependencies\x20from\x20','map','4422480zSGeyW','lock','_calName','WETTER:\x20Keine\x20Daten\x20gefunden','pythonProcess','some','from','service.py','Keine\x20Details.','PARTY','N/A','lampe','Who\x20is\x20present?','‚úÖ\x20User\x20confirmed\x20ALARM\x20via\x20Telegram.\x20Resetting\x20system.','getOverviewData','baselineDrift','models/gemini-flash-latest','KALENDER:\x20Keine\x20relevanten\x20Termine','automationProposal','üì°\x20Hooking\x20into\x20','Last\x20Result','currentSystemMode','Activity\x20Summary','switch','Alarm','bewegung','Urlaub','471190kghdLD','sensorLastValues','Error\x20launching\x20Python\x20service:\x20','custom','Keiner','notifyEmailInstance','push','analysis.alertReason','3224128gBREQJ','ü§ñ\x20BUTLER:\x20Executing\x20Action\x20->\x20','weatherInstance','analysis.activitySummary','Gast','analysis.automation.description','analysis.trigger','geminiApiKey','notifyPushoverInstance','accuweather','Cogni-Living','admin.','KALENDER:\x20Keine\x20Kalender\x20ausgew√§hlt\x20(Bitte\x20in\x20Settings\x20konfigurieren)','3zcgPkf','status','Generating\x20Morning\x20Briefing...','Sending\x20notification:\x20\x22','startsWith',').\x20Starting\x20Timer.','LTM.rawEventLog','getForeignObjectAsync','analysis.isAlert','(((.+)+)+)+$','üìû\x20R√úCKRUF\x20BITTE!\x20Der\x20Bewohner\x20hat\x20den\x20R√ºckruf-Button\x20gedr√ºckt.','inactivityThresholdHours','Exit\x20Sensor\x20triggered\x20(','retry','Comfort\x20Summary','humidity','setState','Drift\x20Details','sensor','eventHistory','ROLLE:\x20Data\x20Scientist.\x20ZIEL:\x20Drift\x20erkennen.\x20SCHEMA:\x20{\x20\x22baselineDrift\x22:\x20\x22none|slight|significant|critical\x22,\x20\x22driftDetails\x22:\x20\x22string\x22\x20}\x0a\x0aLTB:\x20','generic','getGenerativeModel','config','ltmLtbWindowDays','enum.functions.*','val','Error:\x20','Trend\x20Value\x20(%)','message','targetValue','getForeignObjectsAsync','\x20presence\x20devices...','number','activityLevel','channel','stringify','unload','value','doors','response','subscribeStates','fenster','LTM.baselineStatus','generateContent','filter','analysis.analysisHistory','uuid','details','calendarInstance','currentposition','rawEventLog','fault','analysisTimer','notifyPushoverEnabled','party','\x20events)...','licenseKey','analysisHistory','Health\x20Notes','Entry\x20detected\x20via\x20','Action','common','light','\x20(Value:\x20','toLocaleString','endsWith','üêç\x20Starting\x20Python\x20Sidecar:\x20','slice','Comfort\x20Suggestion','dimmer','genAI','triggerDailyDigest','analysis.automation.suggestedAction','weather','.forecast.current.state','unknown','Kalender:\x20Deaktiviert','aiPersona','Trigger\x20Briefing\x20(Test)','analysis.health','isAlert','ltmStbWindowDays','\x20*\x20*\x20*','health','10oYPOJY','Guardian:\x20Not\x20enough\x20history\x20data\x20for\x20trend\x20analysis\x20yet.','simulateButler','Alert\x20Reason','üêç\x20Guardian\x20Diagnosis\x20(','join','targetposition','getLtmData','extendObjectAsync','cogni-living\x20adapter\x20starting\x20(v','onReady','Gemini\x20Analysis\x20Error:\x20','longitude','getDate','kill','update','path','Restoring\x20sensor\x20cache\x20from\x20history\x20(','onUnload','ü§ñ\x20BUTLER\x20PROPOSAL:\x20','automation.triggerAction','working','onMessage','\x20hours.\x20Potential\x20incapacitation.','Feedback\x20Log','values','driftDetails','testNotification','licht','6488976ewEUoO','guest','timestamp','rollladen','):\x20','writable','535551alnucH','analysis.automation.autoApply','blind','level','door','data','\x20=\x20','_score','Trigger\x20Action\x20Now','cover','@iobroker/adapter-core','onStateChange','events.lastEvent','Deaktiviert\x20(Pro-Feature)','setObjectNotExistsAsync','occupancy','Fokus\x20auf\x20Familienroutinen.','useCalendar','system.meta.uuid','analysis.health.notes','brightness','ack','ready','LTM.driftAnalysis','scheduleJob','modeResetJob','close','Adapter','briefingJob','Automation\x20Proposals','unshift','expire','‚úÖ\x20Alles\x20OK\x20(Reset)','geminiModel','‚ö†Ô∏è\x20Python\x20missing\x20dependencies.\x20Triggering\x20Auto-Install...','direction','normal','\x0a\x20\x20\x20\x20ROLLE:\x20KI-Hausverwalter\x20&\x20Gesundheits-Assistent.\x0a\x20\x20\x20\x20PERSONA:\x20','includes','javascript.','debug','scanDevices','08:00','analysis.automation.targetId','TEST-PRO-KEY','now','forEach','COGNI_CONFIRM_OK','splice','BUTLER\x20Execution\x20Error:\x20','HARD\x20WATCHDOG:\x20No\x20sensor\x20activity\x20detected\x20for\x20','exitGraceTimer','LTM.driftAnalysis.lastCheck','getCalendarNames','cancel','targetId','klima','Gemini\x20Init\x20Error:\x20','setStateAsync','value.health','cogni-living','Guardian:\x20Sending\x20','system','logDuplicates','t√ºr','Trigger\x20Analysis','warn','Scheduling\x20Morning\x20Briefing\x20for\x20','testApiKey','ü§ñ\x20BUTLER:\x20No\x20valid\x20target\x20ID\x20or\x20value\x20stored\x20for\x20execution.','analysis.history_debug_00','analysis.health.trendValue','\x20days\x20of\x20activity\x20data\x20to\x20Python...','icons-mfd.','node-schedule','system.config','reachable','vis.','PRO-','[PYTHON]\x20Failed\x20to\x20start\x20(is\x20python3\x20installed?):\x20','time','analysis.automation.triggerAction','stdout','/100,\x20Aktivit√§t\x20seit\x2004:00:\x20','setpoint','7EwzoNf','notifyTelegramInstance','lights','system.','getCalendarNames\x20Error:\x20','sort','uuid-error','Skipped\x20(No\x20AI\x20or\x20Data)','System\x20Mode','toFixed','.\x20OUTPUT:\x20Nur\x20Text.','history.','name','notifyTelegramEnabled','toLowerCase','window','LTM.dailyDigests','\x20sensors...','vacation','stdin','json','getEnums','notifyEmailRecipient','.\x0a\x20\x20\x20\x20KONTEXT:\x20','main','Details:\x20','No\x20module\x20named','command','temperature','motion','system.isPresent','stderr','TREND_RESULT','actual_temperature','Missing\x20data','ltmJob','location','callback','üêç\x20Stopping\x20Python\x20Sidecar...','minDaysForBaseline','WiFi\x20Presence\x20detected\x20->\x20Aborting\x20Exit\x20Timer.\x20User\x20is\x20present.','\x20|\x20','sendToAsync','getTime','isPresent','N/A\x20(Learning)','analysis.health.trendDiagnosis','analysis.comfortSummary','‚úÖ\x20AUTO-FIX\x20SUCCESS.\x20Dependencies\x20installed.\x20Restarting\x20Service...','Processing\x20Status','NORMAL','livingContext','üìû\x20User\x20requested\x20CALL\x20via\x20Telegram!','uuid-not-found','.\x20KONTEXT:\x20','pr√§senz','energy','Subscribing\x20to\x20','event','[RESULT]','weatherunderground.0','\x20min).','notifyEmailEnabled','.NextHours.Location_1.Day_1.current.symbol_desc','isEmergency','isArray','.\x0a\x20\x20\x20\x20NOTFALL-KONTEXT:\x20','alertReason','üåÖ\x20Daily\x20Briefing:\x0a','dailyDigests','setForeignStateAsync','date','0\x204\x20*\x20*\x20*','Feedback\x20saved:\x20','PRIORIT√ÑT:\x20Sicherheit.','[PYTHON]\x20Service\x20exited\x20with\x20code\x20','maintenance','Error\x20reading\x20calendar\x20table:\x20','Reset\x20Sched\x20Error:\x20','LTM.processingStatus','python_service','No\x20instance','analysis.automation.patternDetected','driftAnalysisTimer','systemUUID','info','material.','.\x0a\x20\x20\x20\x20\x0a\x20\x20\x20\x20INPUT\x20DATEN\x20(Letzte\x20Events):\x0a\x20\x20\x20\x20','analysis.lastResult','setHours','isProVersion','connection','Trigger\x20Digest','getObjectAsync','dismissAutomation','send','.communicate.request','openweathermap','toString','indicator.alarm.fire','text.alarm','type','state','instance','openweathermap.0','events.history_debug_00','python3','Gemini\x20AI\x20initialized.','power','Normal','communicate.request','.data.table','‚úÖ\x20Alarm\x20quittiert.\x20System\x20normal.','heizung','length','dependencyInstallInProgress','‚ö†Ô∏è\x20ALARM:\x20','.\x20ZUSATZ:\x20','replace','Last\x20Check','log','toISOString','Event\x20received:\x20','LTM','python3\x20-m\x20pip\x20install\x20-r\x20\x22','946050MCvrVC','error','AI\x20Alert\x20Status','enum','LTM.triggerDailyDigest','Success:\x20Compressed\x20','trim','split','requirements.txt','presenceDevices','analysis.automation.targetValue','Wetter:\x20Deaktiviert','.\x20DATEN:\x20Schlaf\x20','KALENDER:\x20Keine\x20Daten','siren','analysis.triggerBriefing','application/json','shutter','Bibliotheken\x20nicht\x20gefunden','substring','KALENDER\x20ERROR:\x20','lastCheck','set_temperature','parse','lowbat','description','Raw\x20Log','version','temp','firmware','events.history','Description','Invalid\x20JSON\x20from\x20Python:\x20','analysis.comfortSuggestion','sendTo','lastAlertState','catch','Analysiere\x20ausgewogen.','.\x0a\x20\x20\x20\x20WETTER:\x20','Lernphase\x20(','isGracePeriodActive','summary','pop','...','thermostat','write','\x20Tage)','WETTER:\x20','autoApply','LTM.driftAnalysis.baselineDrift','Sleep\x20Score\x20(0-100)','[PYTHON]\x20','COGNI_REQUEST_CALL','subscribeForeignStatesAsync','\x0aSTB:\x20','getForeignStateAsync','9650115hrSObb','\x20events','bind','object','string','delObjectAsync','getStateAsync','[PYTHON\x20ERR]\x20','members','detected','dutycycle','notifyPushoverRecipient','analysis.health.restlessness'];a0_0x1733=function(){return _0x206c0e;};return a0_0x1733();}function tryParse(_0x5a599d){const _0x1c32ba=a0_0x36ff8e;try{return JSON[_0x1c32ba(0xae)](_0x5a599d);}catch(_0x23a29c){return null;}}async function processSensorEvent(_0x3600c0,_0x3cfac5,_0x52c0ed,_0x3ccfe6){const _0x62120d=a0_0x36ff8e;if(!_0x3ccfe6)return;const _0x447e43=_0x52c0ed[_0x62120d(0x145)],_0x33e964=Date['now']();_0x3600c0[_0x62120d(0x92)][_0x62120d(0x1cb)](_0x62120d(0x94)+_0x3cfac5+_0x62120d(0x1a9)+_0x447e43);const _0x4176ce=_0x3600c0[_0x62120d(0x117)][_0x3cfac5];_0x3600c0['sensorLastValues'][_0x3cfac5]=_0x447e43;if(!_0x3ccfe6[_0x62120d(0x1e2)]&&_0x4176ce!=undefined&&_0x4176ce==_0x447e43){_0x3600c0['log'][_0x62120d(0x1cb)]('IGNORING\x20DUPLICATE\x20(Cached):\x20'+_0x3ccfe6[_0x62120d(0x204)]+_0x62120d(0x16b)+_0x447e43+')');return;}const _0x2d26ab={'timestamp':_0x33e964,'id':_0x3cfac5,'name':_0x3ccfe6[_0x62120d(0x204)],'type':_0x3ccfe6[_0x62120d(0x7f)],'location':_0x3ccfe6[_0x62120d(0x21c)],'value':_0x447e43};_0x3600c0[_0x62120d(0x13e)][_0x62120d(0x1c1)](_0x2d26ab);if(_0x3600c0['eventHistory'][_0x62120d(0x8c)]>HISTORY_MAX_SIZE)_0x3600c0[_0x62120d(0x13e)][_0x62120d(0xc1)]();await _0x3600c0['setStateAsync'](_0x62120d(0x1af),{'val':JSON['stringify'](_0x2d26ab),'ack':!![]}),await _0x3600c0[_0x62120d(0x1dd)](_0x62120d(0xb5),{'val':JSON[_0x62120d(0x14f)](_0x3600c0[_0x62120d(0x13e)]),'ack':!![]});_0x3600c0[_0x62120d(0x74)]&&(_0x3600c0[_0x62120d(0x15e)][_0x62120d(0x11c)](_0x2d26ab),await saveRawEventLog(_0x3600c0));if(_0x3ccfe6['isExit']&&_0x447e43===!![]){if(_0x3600c0[_0x62120d(0x224)]&&!_0x3600c0['isGracePeriodActive'])_0x3600c0['log']['info'](_0x62120d(0x137)+_0x3ccfe6[_0x62120d(0x204)]+_0x62120d(0x130)),startExitTimer(_0x3600c0);else!_0x3600c0[_0x62120d(0x224)]&&(_0x3600c0[_0x62120d(0x92)][_0x62120d(0x24d)](_0x62120d(0x167)+_0x3ccfe6[_0x62120d(0x204)]+'.\x20Welcome\x20home.'),await setPresence(_0x3600c0,!![]));}else _0x3ccfe6['type']===_0x62120d(0x215)&&_0x447e43===!![]&&(_0x3600c0[_0x62120d(0xeb)]&&(_0x3600c0[_0x62120d(0x92)]['info'](_0x62120d(0xed)),abortExitTimer(_0x3600c0)),!_0x3600c0[_0x62120d(0x224)]&&_0x3600c0[_0x62120d(0x110)]===SYSTEM_MODES[_0x62120d(0x22a)]&&await setPresence(_0x3600c0,!![]));}async function runGeminiAnalysis(_0x265616,_0x47608c=''){const _0x4440b4=a0_0x36ff8e;if(!_0x265616[_0x4440b4(0x1c4)])return;if(_0x265616[_0x4440b4(0x13e)]['length']===0x0)return;const _0x24e3da=_0x265616[_0x4440b4(0x13e)][_0x4440b4(0x16f)](0x0,0xf),_0x3a234d=await getWeatherContext(_0x265616),_0x3796f0=_0x265616[_0x4440b4(0x110)],_0x4b630e=PERSONA_MAPPING[_0x265616[_0x4440b4(0x142)][_0x4440b4(0x179)]||_0x4440b4(0x140)],_0x5d865f=_0x265616[_0x4440b4(0x142)][_0x4440b4(0x22b)]||_0x4440b4(0x103);let _0xb86850=![];try{const _0x14c7aa=await _0x265616['getStateAsync'](_0x4440b4(0x1a4));if(_0x14c7aa&&_0x14c7aa[_0x4440b4(0x145)])_0xb86850=!![];}catch(_0x527eca){}const _0x153094=_0x4440b4(0x1c8)+_0x4b630e+_0x4440b4(0x20f)+_0x5d865f+'.\x0a\x20\x20\x20\x20SYSTEM_MODE:\x20'+_0x3796f0+_0x4440b4(0xbd)+_0x3a234d+_0x4440b4(0x23a)+(_0x47608c||_0x4440b4(0x11a))+_0x4440b4(0x24f)+JSON['stringify'](_0x24e3da)+'\x0a\x0a\x20\x20\x20\x20AUFGABE:\x0a\x20\x20\x20\x201.\x20Analysiere\x20auf\x20Gesundheitsrisiken\x20(Sturz,\x20Inaktivit√§t).\x0a\x20\x20\x20\x202.\x20Analysiere\x20auf\x20Komfort/Automatisierung\x20(\x22Butler\x22).\x20Erkennst\x20du\x20ein\x20Muster?\x20(z.B.\x20\x22Wenn\x20Bewegung\x20Flur,\x20dann\x20Licht\x20an\x22).\x0a\x20\x20\x20\x20\x0a\x20\x20\x20\x20FORMAT\x20(JSON\x20Only!):\x0a\x20\x20\x20\x20{\x0a\x20\x20\x20\x20\x20\x20\x22isAlert\x22:\x20boolean,\x0a\x20\x20\x20\x20\x20\x20\x22alertReason\x22:\x20\x22string\x20(kurz)\x22,\x0a\x20\x20\x20\x20\x20\x20\x22isEmergency\x22:\x20boolean,\x0a\x20\x20\x20\x20\x20\x20\x22summary\x22:\x20\x22string\x20(Was\x20passiert\x20gerade?)\x22,\x0a\x20\x20\x20\x20\x20\x20\x22automationProposal\x22:\x20{\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x22detected\x22:\x20boolean,\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x22description\x22:\x20\x22string\x20(Was\x20soll\x20automatisiert\x20werden?)\x22,\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x22targetId\x22:\x20\x22string\x20(ioBroker\x20ID,\x20z.B.\x200_userdata.0.light)\x22,\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x22targetValue\x22:\x20\x22any\x20(Wert,\x20z.B.\x20true\x20oder\x2050)\x22\x0a\x20\x20\x20\x20\x20\x20}\x0a\x20\x20\x20\x20}\x0a\x20\x20\x20\x20';try{const _0x5684f6=await _0x265616[_0x4440b4(0x1c4)]['generateContent'](_0x153094),_0x583ab2=_0x5684f6[_0x4440b4(0x153)][_0x4440b4(0xf7)]()[_0x4440b4(0x90)](/```json|```/g,'')[_0x4440b4(0x9d)](),_0x128ac7=JSON[_0x4440b4(0xae)](_0x583ab2);await _0x265616['setStateAsync'](_0x4440b4(0x250),{'val':JSON['stringify'](_0x128ac7),'ack':!![]});const _0x1440c3=_0x128ac7[_0x4440b4(0x17c)]||![];_0x1440c3!==_0x265616[_0x4440b4(0xba)]&&(await _0x265616['setStateAsync']('analysis.isAlert',{'val':_0x1440c3,'ack':!![]}),_0x265616[_0x4440b4(0xba)]=_0x1440c3,_0x1440c3&&(await _0x265616[_0x4440b4(0x1dd)](_0x4440b4(0x11d),{'val':_0x128ac7['alertReason'],'ack':!![]}),sendNotification(_0x265616,_0x4440b4(0x8e)+_0x128ac7[_0x4440b4(0x23b)],![],_0x128ac7[_0x4440b4(0x238)]))),_0x128ac7[_0x4440b4(0x10d)]&&_0x128ac7[_0x4440b4(0x10d)][_0x4440b4(0xd8)]&&_0x128ac7[_0x4440b4(0x10d)][_0x4440b4(0x1da)]&&(_0x265616[_0x4440b4(0x92)][_0x4440b4(0x24d)](_0x4440b4(0x193)+_0x128ac7[_0x4440b4(0x10d)][_0x4440b4(0xb0)]),await _0x265616[_0x4440b4(0x1dd)](_0x4440b4(0x24a),{'val':!![],'ack':!![]}),await _0x265616['setStateAsync'](_0x4440b4(0x123),{'val':_0x128ac7[_0x4440b4(0x10d)][_0x4440b4(0xb0)],'ack':!![]}),await _0x265616[_0x4440b4(0x1dd)](_0x4440b4(0x1ce),{'val':_0x128ac7[_0x4440b4(0x10d)][_0x4440b4(0x1da)],'ack':!![]}),await _0x265616[_0x4440b4(0x1dd)]('analysis.automation.targetValue',{'val':JSON[_0x4440b4(0x14f)](_0x128ac7[_0x4440b4(0x10d)][_0x4440b4(0x149)]),'ack':!![]}),_0xb86850&&(_0x265616[_0x4440b4(0x92)]['info']('ü§ñ\x20BUTLER\x20AUTO-APPLY:\x20Executing\x20'+_0x128ac7[_0x4440b4(0x10d)][_0x4440b4(0x1da)]+_0x4440b4(0xc2)),await executeAutomationAction(_0x265616)));}catch(_0x3a9dab){_0x265616[_0x4440b4(0x92)][_0x4440b4(0x98)](_0x4440b4(0x18b)+_0x3a9dab['message']);}}function installPythonDependencies(_0xde0226){const _0x211e78=a0_0x36ff8e;if(_0xde0226['dependencyInstallInProgress'])return;_0xde0226[_0x211e78(0x8d)]=!![];const _0x241448=path[_0x211e78(0x185)](__dirname,_0x211e78(0x248),_0x211e78(0x9f));_0xde0226[_0x211e78(0x92)][_0x211e78(0x24d)](_0x211e78(0xf9)+_0x241448+'...'),stopPythonService(_0xde0226);const _0x3fb413=_0x211e78(0x96)+_0x241448+'\x22\x20--break-system-packages';exec(_0x3fb413,(_0x28c900,_0x3303b1,_0x192f6d)=>{const _0x6fbcc1=_0x211e78;_0xde0226[_0x6fbcc1(0x8d)]=![],_0x28c900?(_0xde0226['log']['error']('‚ùå\x20AUTO-FIX\x20FAILED.\x20Please\x20run\x20manually:\x20sudo\x20'+_0x3fb413),_0xde0226[_0x6fbcc1(0x92)][_0x6fbcc1(0x98)](_0x6fbcc1(0x211)+(_0x192f6d||_0x28c900[_0x6fbcc1(0x148)]))):(_0xde0226[_0x6fbcc1(0x92)][_0x6fbcc1(0x24d)](_0x6fbcc1(0x228)),startPythonService(_0xde0226));});}function sendToPython(_0x1bfc21,_0x34500b,_0x1fb890={}){const _0x5252da=a0_0x36ff8e;if(!_0x1bfc21[_0x5252da(0xff)]||!_0x1bfc21[_0x5252da(0xff)]['stdin'][_0x5252da(0x1a2)])return;const _0x12e9ef=JSON[_0x5252da(0x14f)]({'command':_0x34500b,..._0x1fb890});try{_0x1bfc21[_0x5252da(0xff)][_0x5252da(0x20b)][_0x5252da(0xc4)](_0x12e9ef+'\x0a');}catch(_0x20615b){_0x1bfc21['log']['error']('Failed\x20to\x20send\x20to\x20Python:\x20'+_0x20615b[_0x5252da(0x148)]);}}function runPythonHealthCheck(_0x505a84){const _0x598b01=a0_0x36ff8e;if(!_0x505a84[_0x598b01(0x23d)]||_0x505a84['dailyDigests']['length']<0x2){_0x505a84['log'][_0x598b01(0x24d)](_0x598b01(0x181));return;}const _0x3a4e28=_0x505a84['dailyDigests'][_0x598b01(0xfa)](_0x481695=>{const _0xa8aad2=_0x598b01,_0x180023=(_0x481695[_0xa8aad2(0x14d)]||'')['toLowerCase']();return ACTIVITY_LEVEL_MAP[_0x180023]||0x32;});_0x505a84[_0x598b01(0x92)][_0x598b01(0x24d)](_0x598b01(0x1e0)+_0x3a4e28['length']+_0x598b01(0x1eb)),sendToPython(_0x505a84,'ANALYZE_TREND',{'values':_0x3a4e28,'tag':_0x598b01(0xf5)});}function handlePythonResult(_0x55664a,_0x2e7cdb){const _0xdaeedf=a0_0x36ff8e;if(_0x2e7cdb[_0xdaeedf(0x7f)]==='PONG')_0x55664a[_0xdaeedf(0x92)][_0xdaeedf(0x1cb)]('üêç\x20Python\x20Pong\x20received!\x20Latency\x20check\x20passed.');else{if(_0x2e7cdb[_0xdaeedf(0x7f)]===_0xdaeedf(0x218)){const {tag:_0x365f07,diagnosis:_0x3b7bd2,change_percent:_0x46794a}=_0x2e7cdb['payload'];_0x55664a[_0xdaeedf(0x92)]['info'](_0xdaeedf(0x184)+_0x365f07+_0xdaeedf(0x1a1)+_0x3b7bd2+'\x20('+_0x46794a+'%)'),_0x55664a[_0xdaeedf(0x1dd)](_0xdaeedf(0x226),{'val':_0x3b7bd2,'ack':!![]}),_0x55664a['setStateAsync'](_0xdaeedf(0x1ea),{'val':_0x46794a,'ack':!![]});}}}function startPythonService(_0x4d1c65){const _0x50cdcf=a0_0x36ff8e;try{const _0x15e4a7=path[_0x50cdcf(0x185)](__dirname,_0x50cdcf(0x248),_0x50cdcf(0x102));_0x4d1c65[_0x50cdcf(0x92)][_0x50cdcf(0x24d)](_0x50cdcf(0x16e)+_0x15e4a7),_0x4d1c65[_0x50cdcf(0xff)]=spawn(_0x50cdcf(0x84),[_0x15e4a7]),_0x4d1c65[_0x50cdcf(0xff)][_0x50cdcf(0x1f5)]['on'](_0x50cdcf(0x1a8),_0x4571de=>{const _0x427e01=_0x50cdcf,_0x26af4a=_0x4571de[_0x427e01(0x7c)]()[_0x427e01(0x9e)]('\x0a');_0x26af4a[_0x427e01(0x1d1)](_0x5bd658=>{const _0x4e8f34=_0x427e01,_0x534031=_0x5bd658['trim']();if(!_0x534031)return;if(_0x534031[_0x4e8f34(0x12f)]('[LOG]'))_0x4d1c65[_0x4e8f34(0x92)][_0x4e8f34(0x1cb)](_0x4e8f34(0xca)+_0x534031[_0x4e8f34(0xaa)](0x5)['trim']());else{if(_0x534031[_0x4e8f34(0x12f)](_0x4e8f34(0x233)))try{const _0x446c23=JSON[_0x4e8f34(0xae)](_0x534031[_0x4e8f34(0xaa)](0x8)[_0x4e8f34(0x9d)]());handlePythonResult(_0x4d1c65,_0x446c23);}catch(_0x3370d1){_0x4d1c65['log'][_0x4e8f34(0x1e5)](_0x4e8f34(0xb7)+_0x534031);}}(_0x534031['includes'](_0x4e8f34(0x212))||_0x534031[_0x4e8f34(0x1c9)](_0x4e8f34(0xa9)))&&(_0x4d1c65[_0x4e8f34(0x92)]['warn'](_0x4e8f34(0x1c5)),installPythonDependencies(_0x4d1c65));});}),_0x4d1c65[_0x50cdcf(0xff)][_0x50cdcf(0x217)]['on'](_0x50cdcf(0x1a8),_0x37123f=>{const _0x353579=_0x50cdcf,_0x4fd2b9=_0x37123f['toString']()[_0x353579(0x9d)]();_0x4d1c65[_0x353579(0x92)][_0x353579(0x98)](_0x353579(0xd6)+_0x4fd2b9);}),_0x4d1c65[_0x50cdcf(0xff)]['on'](_0x50cdcf(0x1bd),_0x339f48=>{const _0x2aabae=_0x50cdcf;_0x4d1c65['log'][_0x2aabae(0x24d)](_0x2aabae(0x243)+_0x339f48),_0x4d1c65[_0x2aabae(0xff)]=null;}),_0x4d1c65[_0x50cdcf(0xff)]['on']('error',_0xb62c04=>{const _0x5b7a0f=_0x50cdcf;_0x4d1c65[_0x5b7a0f(0x92)][_0x5b7a0f(0x1e5)](_0x5b7a0f(0x1f2)+_0xb62c04[_0x5b7a0f(0x148)]);});}catch(_0x332fcc){_0x4d1c65[_0x50cdcf(0x92)]['error'](_0x50cdcf(0x118)+_0x332fcc[_0x50cdcf(0x148)]);}}function stopPythonService(_0x44079d){const _0x15f351=a0_0x36ff8e;if(_0x44079d[_0x15f351(0xff)]){_0x44079d[_0x15f351(0x92)]['info'](_0x15f351(0x21e));try{_0x44079d[_0x15f351(0xff)][_0x15f351(0x18e)]();}catch(_0x250b46){_0x44079d['log'][_0x15f351(0x1e5)]('Could\x20not\x20kill\x20Python\x20process:\x20'+_0x250b46[_0x15f351(0x148)]);}_0x44079d[_0x15f351(0xff)]=null;}}class CogniLiving extends utils[a0_0x36ff8e(0x1be)]{constructor(_0x2245bf){const _0x5e3d21=a0_0x36ff8e;super({..._0x2245bf,'name':_0x5e3d21(0x1df)}),this['eventHistory']=[],this[_0x5e3d21(0x165)]=[],this['feedbackHistory']=[],this[_0x5e3d21(0x15e)]=[],this[_0x5e3d21(0x23d)]=[],this['sensorLastValues']={},this[_0x5e3d21(0xf4)]={'latitude':0x0,'longitude':0x0,'city':''},this['isPresent']=!![],this[_0x5e3d21(0xeb)]=null,this[_0x5e3d21(0x1d6)]=null,this['isGracePeriodActive']=![],this['genAI']=null,this['geminiModel']=null,this[_0x5e3d21(0x110)]=SYSTEM_MODES['NORMAL'],this[_0x5e3d21(0x74)]=![],this['lastAlertState']=![],this[_0x5e3d21(0x24c)]=_0x5e3d21(0x177),this[_0x5e3d21(0x160)]=null,this[_0x5e3d21(0x21b)]=null,this['modeResetJob']=null,this['driftAnalysisTimer']=null,this['briefingJob']=null,this[_0x5e3d21(0xff)]=null,this[_0x5e3d21(0x8d)]=![],this['on'](_0x5e3d21(0x1b9),this['onReady'][_0x5e3d21(0xd1)](this)),this['on']('stateChange',this[_0x5e3d21(0x1ae)][_0x5e3d21(0xd1)](this)),this['on'](_0x5e3d21(0x150),this[_0x5e3d21(0x192)][_0x5e3d21(0xd1)](this)),this['on'](_0x5e3d21(0x148),this[_0x5e3d21(0x196)][_0x5e3d21(0xd1)](this));}async[a0_0x36ff8e(0x18a)](){const _0xc0c316=a0_0x36ff8e;this[_0xc0c316(0x92)]['info'](_0xc0c316(0x189)+this[_0xc0c316(0xb2)]+')\x20-\x20FUNCTIONS\x20FIRST\x20ARCHITECTURE'),await initZombies(this),this[_0xc0c316(0x142)][_0xc0c316(0x164)]=this[_0xc0c316(0x142)][_0xc0c316(0x164)]||'';try{this['isProVersion']=await checkLicense(this,this['config']['licenseKey']);}catch(_0x5dc949){}if(!this[_0xc0c316(0x142)][_0xc0c316(0x136)]||this[_0xc0c316(0x142)][_0xc0c316(0x136)]<0.1)this[_0xc0c316(0x142)][_0xc0c316(0x136)]=0xc;await initHistory(this),await initSystemConfig(this);if(this[_0xc0c316(0x142)][_0xc0c316(0x125)])try{this[_0xc0c316(0x172)]=new GoogleGenerativeAI(this[_0xc0c316(0x142)][_0xc0c316(0x125)]),this['geminiModel']=this[_0xc0c316(0x172)][_0xc0c316(0x141)]({'model':GEMINI_MODEL,'generationConfig':{'responseMimeType':_0xc0c316(0xa7)}}),this[_0xc0c316(0x92)][_0xc0c316(0x24d)](_0xc0c316(0x85));}catch(_0x370c0c){this['log']['error'](_0xc0c316(0x1dc)+_0x370c0c[_0xc0c316(0x148)]);}await createAllObjects(this),await loadSystemMode(this),await loadRawEventLog(this),await loadDailyDigests(this),this['subscribeStates'](_0xc0c316(0x124)),this[_0xc0c316(0x154)](LTM_DP_TRIGGER_DIGEST),this[_0xc0c316(0x154)](_0xc0c316(0xf2)),this[_0xc0c316(0x154)](_0xc0c316(0xa6)),this[_0xc0c316(0x154)](_0xc0c316(0x1f4)),this[_0xc0c316(0x154)](_0xc0c316(0x1a4)),await initSensorSubscriptions(this),await initPresenceSubscriptions(this),await setupTelegramListener(this),setTimeout(()=>checkWifiPresence(this),0x1388);if(this[_0xc0c316(0x160)])clearInterval(this[_0xc0c316(0x160)]);const _0x5e9cf5=this[_0xc0c316(0x142)]['analysisInterval']||0xf;_0x5e9cf5>0x0&&(this['log'][_0xc0c316(0x24d)]('Starting\x20Autopilot\x20('+_0x5e9cf5+_0xc0c316(0x235)),this[_0xc0c316(0x160)]=setInterval(()=>{runAutopilot(this);},_0x5e9cf5*0x3c*0x3e8)),setupLtmScheduler(this),setupModeResetScheduler(this),setupDriftAnalysisScheduler(this),setupBriefingScheduler(this),startPythonService(this),setTimeout(()=>{const _0xd9c8a8=_0xc0c316;this[_0xd9c8a8(0xff)]&&runPythonHealthCheck(this);},0x1388);}['onUnload'](_0x39edae){const _0x2c3d38=a0_0x36ff8e;if(this[_0x2c3d38(0x160)])clearInterval(this[_0x2c3d38(0x160)]);if(this[_0x2c3d38(0x24b)])clearInterval(this[_0x2c3d38(0x24b)]);if(this[_0x2c3d38(0x21b)])this[_0x2c3d38(0x21b)][_0x2c3d38(0x1d9)]();if(this['modeResetJob'])this['modeResetJob']['cancel']();if(this[_0x2c3d38(0x1bf)])this[_0x2c3d38(0x1bf)][_0x2c3d38(0x1d9)]();if(this[_0x2c3d38(0xeb)])clearTimeout(this[_0x2c3d38(0xeb)]);if(this[_0x2c3d38(0x1d6)])clearTimeout(this[_0x2c3d38(0x1d6)]);stopPythonService(this),_0x39edae();}async['onStateChange'](_0x4f1cb2,_0x1b0a70){const _0x30f198=a0_0x36ff8e;if(!_0x1b0a70)return;if(_0x4f1cb2['includes'](_0x30f198(0xe9))&&_0x4f1cb2[_0x30f198(0x16d)](_0x30f198(0x88))&&_0x1b0a70[_0x30f198(0x145)]){await handleTelegramResponse(this,_0x1b0a70[_0x30f198(0x145)]);return;}if(_0x4f1cb2===this['namespace']+'.'+SYSTEM_DP_MODE){_0x1b0a70[_0x30f198(0x145)]&&Object['values'](SYSTEM_MODES)['includes'](_0x1b0a70[_0x30f198(0x145)])&&(this[_0x30f198(0x110)]=_0x1b0a70[_0x30f198(0x145)],_0x1b0a70[_0x30f198(0x145)]===SYSTEM_MODES[_0x30f198(0xee)]?await setPresence(this,![]):await setPresence(this,!![]));if(!_0x1b0a70[_0x30f198(0x1b8)])this[_0x30f198(0x13b)](_0x4f1cb2,{'val':this['currentSystemMode'],'ack':!![]});return;}if(!_0x1b0a70[_0x30f198(0x1b8)]){_0x4f1cb2[_0x30f198(0x1c9)](_0x30f198(0x124))&&_0x1b0a70[_0x30f198(0x145)]&&(this[_0x30f198(0x13b)](_0x4f1cb2,{'val':![],'ack':!![]}),runGeminiAnalysis(this));if(_0x4f1cb2[_0x30f198(0x1c9)](_0x30f198(0x173))&&_0x1b0a70[_0x30f198(0x145)]){this['setState'](_0x4f1cb2,{'val':![],'ack':!![]});if(this[_0x30f198(0x74)])createDailyDigest(this);}_0x4f1cb2[_0x30f198(0x1c9)]('triggerBriefing')&&_0x1b0a70[_0x30f198(0x145)]&&(this[_0x30f198(0x13b)](_0x4f1cb2,{'val':![],'ack':!![]}),sendMorningBriefing(this));_0x4f1cb2[_0x30f198(0x1c9)](_0x30f198(0x194))&&_0x1b0a70[_0x30f198(0x145)]&&(this[_0x30f198(0x13b)](_0x4f1cb2,{'val':![],'ack':!![]}),executeAutomationAction(this));return;}if(this[_0x30f198(0x142)][_0x30f198(0xa0)]&&this[_0x30f198(0x142)][_0x30f198(0xa0)][_0x30f198(0x1c9)](_0x4f1cb2)){await checkWifiPresence(this);return;}const _0x4c9f38=(this['config'][_0x30f198(0xdc)]||[])['find'](_0x4b6f04=>_0x4b6f04['id']===_0x4f1cb2);if(_0x4c9f38)processSensorEvent(this,_0x4f1cb2,_0x1b0a70,_0x4c9f38);}async[a0_0x36ff8e(0x196)](_0x42af54){const _0x3638ac=a0_0x36ff8e;if(typeof _0x42af54===_0x3638ac(0xd2)&&_0x42af54[_0x3638ac(0x148)])try{if(_0x42af54[_0x3638ac(0x213)]===_0x3638ac(0x1e7)){}else{if(_0x42af54[_0x3638ac(0x213)]===_0x3638ac(0x19b)){}else{if(_0x42af54[_0x3638ac(0x213)]===_0x3638ac(0x187)){if(!this[_0x3638ac(0x74)])return this[_0x3638ac(0xb9)](_0x42af54['from'],_0x42af54[_0x3638ac(0x213)],{'success':![],'isPro':![]},_0x42af54[_0x3638ac(0x21d)]);let _0x3077a4={'status':_0x3638ac(0x105),'details':'','lastCheck':0x0};try{_0x3077a4[_0x3638ac(0x12c)]=(await this['getStateAsync'](LTM_DP_DRIFT_STATUS))['val'],_0x3077a4[_0x3638ac(0x15b)]=(await this[_0x3638ac(0xd5)](LTM_DP_DRIFT_DETAILS))['val'],_0x3077a4[_0x3638ac(0xac)]=(await this[_0x3638ac(0xd5)](LTM_DP_DRIFT_LAST_CHECK))['val'];}catch(_0x82a509){}const _0x94042c=this[_0x3638ac(0x165)]||[];this[_0x3638ac(0xb9)](_0x42af54[_0x3638ac(0x101)],_0x42af54[_0x3638ac(0x213)],{'success':!![],'isPro':!![],'dailyDigests':this[_0x3638ac(0x23d)],'driftAnalysis':_0x3077a4,'analysisHistory':_0x94042c},_0x42af54[_0x3638ac(0x21d)]);}else{if(_0x42af54['command']===_0x3638ac(0x109)){const _0x14465e=this[_0x3638ac(0x23d)][_0x3638ac(0x8c)],_0x396c6f=new Date(),_0x2e1d7b=new Date(_0x396c6f['getFullYear'](),_0x396c6f['getMonth'](),_0x396c6f[_0x3638ac(0x18d)]())[_0x3638ac(0x223)](),_0x225b18=this[_0x3638ac(0x15e)][_0x3638ac(0x158)](_0x167611=>new Date(_0x167611[_0x3638ac(0x19f)])[_0x3638ac(0x223)]()>_0x2e1d7b)['length'],_0x1fdf68=new Array(0x18)['fill'](0x0);this[_0x3638ac(0x15e)][_0x3638ac(0x1d1)](_0x1986e0=>{const _0x136020=_0x3638ac,_0x112bb8=new Date(_0x1986e0[_0x136020(0x19f)]);if(_0x112bb8['getTime']()>_0x2e1d7b)_0x1fdf68[_0x112bb8['getHours']()]++;});let _0x288675={'status':_0x3638ac(0x105)};try{_0x288675['status']=(await this[_0x3638ac(0xd5)](LTM_DP_DRIFT_STATUS))[_0x3638ac(0x145)];}catch(_0x215058){}let _0x51a393='';try{const _0x2de59c=await this['getStateAsync'](_0x3638ac(0xdf));_0x51a393=_0x2de59c?_0x2de59c[_0x3638ac(0x145)]:'';}catch(_0x56e699){}let _0x4eb199=null;!this[_0x3638ac(0x1c4)]&&(_0x4eb199=this['config']['geminiApiKey']?'KI-Modell\x20nicht\x20initialisiert':'Kein\x20API\x20Key!');let _0x489304={'detected':![],'description':'','targetId':'','targetValue':'','autoApply':![]};try{const _0x3fa6a6=await this[_0x3638ac(0xd5)](_0x3638ac(0x24a)),_0x102857=await this[_0x3638ac(0xd5)](_0x3638ac(0x123)),_0x49e75e=await this['getStateAsync'](_0x3638ac(0x1ce)),_0xfb80dc=await this['getStateAsync'](_0x3638ac(0xa1)),_0x5bda6c=await this[_0x3638ac(0xd5)](_0x3638ac(0x1a4));_0x3fa6a6&&_0x3fa6a6[_0x3638ac(0x145)]&&(_0x489304[_0x3638ac(0xd8)]=!![],_0x489304[_0x3638ac(0xb0)]=_0x102857?_0x102857['val']:'',_0x489304[_0x3638ac(0x1da)]=_0x49e75e?_0x49e75e[_0x3638ac(0x145)]:'',_0x489304['targetValue']=_0xfb80dc?_0xfb80dc[_0x3638ac(0x145)]:''),_0x489304[_0x3638ac(0xc7)]=_0x5bda6c?!!_0x5bda6c[_0x3638ac(0x145)]:![];}catch(_0x30c8ea){}this[_0x3638ac(0xb9)](_0x42af54['from'],_0x42af54[_0x3638ac(0x213)],{'success':!![],'eventHistory':this[_0x3638ac(0x13e)][_0x3638ac(0x16f)](0x0,0xf),'stats':{'digestCount':_0x14465e,'eventCountToday':_0x225b18,'hourlyActivity':_0x1fdf68,'driftStatus':_0x288675[_0x3638ac(0x12c)],'isPresent':this[_0x3638ac(0x224)],'presenceWho':_0x51a393,'minDays':this[_0x3638ac(0x142)]['minDaysForBaseline']||0x7,'stbDays':this[_0x3638ac(0x142)]['ltmStbWindowDays']||0xe,'ltbDays':this[_0x3638ac(0x142)][_0x3638ac(0x143)]||0x3c,'systemError':_0x4eb199},'automation':_0x489304},_0x42af54[_0x3638ac(0x21d)]);}else{if(_0x42af54['command']===_0x3638ac(0x20d)){const _0x2ef0e2=await this[_0x3638ac(0x14a)](_0x3638ac(0x144),_0x3638ac(0x9a)),_0x52416e=[];if(_0x2ef0e2)for(const _0x3ce415 in _0x2ef0e2){const _0x445fdb=_0x2ef0e2[_0x3ce415],_0x54faed=(_0x445fdb[_0x3638ac(0x169)]&&typeof _0x445fdb[_0x3638ac(0x169)]['name']===_0x3638ac(0xd2)?_0x445fdb['common'][_0x3638ac(0x204)]['de']:_0x445fdb[_0x3638ac(0x169)]['name'])||_0x445fdb[_0x3638ac(0x169)][_0x3638ac(0x204)];_0x52416e[_0x3638ac(0x11c)]({'id':_0x3ce415,'name':_0x54faed});}this[_0x3638ac(0xb9)](_0x42af54[_0x3638ac(0x101)],_0x42af54[_0x3638ac(0x213)],{'success':!![],'enums':_0x52416e},_0x42af54[_0x3638ac(0x21d)]);}else{if(_0x42af54[_0x3638ac(0x213)]===_0x3638ac(0x1cc))try{const _0x4957d=await scanForDevices(this,_0x42af54[_0x3638ac(0x148)]||{});this[_0x3638ac(0xb9)](_0x42af54[_0x3638ac(0x101)],_0x42af54['command'],{'success':!![],'devices':_0x4957d},_0x42af54[_0x3638ac(0x21d)]);}catch(_0x2c74aa){this['sendTo'](_0x42af54[_0x3638ac(0x101)],_0x42af54[_0x3638ac(0x213)],{'success':![],'error':_0x2c74aa['message']},_0x42af54['callback']);}else{if(_0x42af54['command']===_0x3638ac(0x1d8)){const _0x373f15=_0x42af54[_0x3638ac(0x148)][_0x3638ac(0x81)];if(!_0x373f15)return this[_0x3638ac(0xb9)](_0x42af54[_0x3638ac(0x101)],_0x42af54['command'],{'success':![],'error':_0x3638ac(0x249)},_0x42af54[_0x3638ac(0x21d)]);const _0x235e89=await getCalendarNames(this,_0x373f15);this[_0x3638ac(0xb9)](_0x42af54['from'],_0x42af54['command'],{'success':!![],'names':_0x235e89},_0x42af54[_0x3638ac(0x21d)]);}else{if(_0x42af54[_0x3638ac(0x213)]===_0x3638ac(0x182)){const {targetId:_0x29ab1a,targetValue:_0x31d1dc}=_0x42af54[_0x3638ac(0x148)];this[_0x3638ac(0x92)]['info'](_0x3638ac(0xec)+_0x29ab1a+_0x3638ac(0x1a9)+_0x31d1dc),await this[_0x3638ac(0x1dd)]('analysis.automation.patternDetected',{'val':!![],'ack':!![]}),await this[_0x3638ac(0x1dd)](_0x3638ac(0x123),{'val':'SIMULATION:\x20Test-Vorschlag\x20f√ºr\x20'+_0x29ab1a,'ack':!![]}),await this[_0x3638ac(0x1dd)](_0x3638ac(0x1ce),{'val':_0x29ab1a,'ack':!![]}),await this[_0x3638ac(0x1dd)](_0x3638ac(0xa1),{'val':_0x31d1dc,'ack':!![]}),this[_0x3638ac(0xb9)](_0x42af54[_0x3638ac(0x101)],_0x42af54['command'],{'success':!![]},_0x42af54[_0x3638ac(0x21d)]);}else{if(_0x42af54['command']===_0x3638ac(0xf8)){const {historyId:_0x4f2f09,rating:_0x45eaee,comment:_0x281325,alertReason:_0x280014}=_0x42af54['message'];_0x4f2f09&&_0x45eaee?(await saveFeedback(this,{'timestamp':Date[_0x3638ac(0x1d0)](),'historyId':_0x4f2f09,'rating':_0x45eaee,'comment':_0x281325,'alertReason':_0x280014}),this[_0x3638ac(0xb9)](_0x42af54[_0x3638ac(0x101)],_0x42af54[_0x3638ac(0x213)],{'success':!![]},_0x42af54[_0x3638ac(0x21d)])):this[_0x3638ac(0xb9)](_0x42af54[_0x3638ac(0x101)],_0x42af54[_0x3638ac(0x213)],{'success':![],'error':_0x3638ac(0x21a)},_0x42af54[_0x3638ac(0x21d)]);}else _0x42af54[_0x3638ac(0x213)]===_0x3638ac(0x78)&&(this[_0x3638ac(0x92)][_0x3638ac(0x24d)]('User\x20dismissed\x20automation\x20proposal.'),await this[_0x3638ac(0x1dd)](_0x3638ac(0x24a),{'val':![],'ack':!![]}),await this[_0x3638ac(0x1dd)](_0x3638ac(0x123),{'val':'','ack':!![]}),this[_0x3638ac(0xb9)](_0x42af54[_0x3638ac(0x101)],_0x42af54[_0x3638ac(0x213)],{'success':!![]},_0x42af54['callback']));}}}}}}}}}catch(_0x5c9ce8){this['log']['error']('Error\x20in\x20onMessage\x20command\x20'+_0x42af54['command']+':\x20'+_0x5c9ce8[_0x3638ac(0x148)]);if(_0x42af54['callback'])this[_0x3638ac(0xb9)](_0x42af54['from'],_0x42af54['command'],{'success':![],'error':_0x5c9ce8[_0x3638ac(0x148)]},_0x42af54[_0x3638ac(0x21d)]);}}}if(require[a0_0x36ff8e(0x210)]!==module)module['exports']=_0x1cd998=>new CogniLiving(_0x1cd998);else new CogniLiving();