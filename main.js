const a0_0x567e26=a0_0x24fa;(function(_0x56f1b4,_0x1fe880){const _0x5d4371=a0_0x24fa,_0x58d3df=_0x56f1b4();while(!![]){try{const _0x48a2ee=-parseInt(_0x5d4371(0x203))/0x1*(-parseInt(_0x5d4371(0x171))/0x2)+-parseInt(_0x5d4371(0x8c))/0x3*(-parseInt(_0x5d4371(0x1be))/0x4)+parseInt(_0x5d4371(0x9d))/0x5+-parseInt(_0x5d4371(0x1a3))/0x6+-parseInt(_0x5d4371(0x200))/0x7+parseInt(_0x5d4371(0x1a2))/0x8*(parseInt(_0x5d4371(0x188))/0x9)+parseInt(_0x5d4371(0x140))/0xa*(-parseInt(_0x5d4371(0x208))/0xb);if(_0x48a2ee===_0x1fe880)break;else _0x58d3df['push'](_0x58d3df['shift']());}catch(_0x3c94e1){_0x58d3df['push'](_0x58d3df['shift']());}}}(a0_0x1228,0xda24a));const a0_0x534486=(function(){let _0x4f9f75=!![];return function(_0x5d61d3,_0x33602d){const _0x390c81=_0x4f9f75?function(){if(_0x33602d){const _0x527673=_0x33602d['apply'](_0x5d61d3,arguments);return _0x33602d=null,_0x527673;}}:function(){};return _0x4f9f75=![],_0x390c81;};}()),a0_0x1fd4dc=a0_0x534486(this,function(){const _0x56ec99=a0_0x24fa;return a0_0x1fd4dc['toString']()['search']('(((.+)+)+)+$')[_0x56ec99(0xa4)]()['constructor'](a0_0x1fd4dc)[_0x56ec99(0x14e)](_0x56ec99(0xad));});a0_0x1fd4dc();function a0_0x24fa(_0x2776de,_0x166ae1){const _0x78e8bb=a0_0x1228();return a0_0x24fa=function(_0x1fd4dc,_0x534486){_0x1fd4dc=_0x1fd4dc-0x86;let _0x122851=_0x78e8bb[_0x1fd4dc];return _0x122851;},a0_0x24fa(_0x2776de,_0x166ae1);}'use strict';function a0_0x1228(){const _0x37b338=['modeResetJob','config','analysis.isAlert','checkLtmObjects','Error\x20reading\x20calendar\x20table:\x20','Logbook','checkSystemObjects','ack','KALENDER\x20ERROR:\x20','openweathermap.0','Generating\x20Morning\x20Briefing...','party','isArray','Fehler:\x20','system','Activity\x20Summary','slice','devices','AI\x20Alert\x20Status','ltmJob','@iobroker/adapter-core','\x20raw\x20events...','scheduleJob','loadDailyDigests','trim','useCalendar','PARTY','normal','testApiKey','from','analysis.health.sleepScore','indicator','\x20sensors...','\x20(EMERGENCY)','üö®üö®\x20NOTFALL','Drift\x20Status','motion','exitTimer','toISOString','accuweather','lastCheck','setHours','activityLevel','KALENDER:\x20Keine\x20relevanten\x20Termine','system.meta.uuid','analysis.automation.suggestedAction','stringify','string','processSensorEvent','instance','window','alertReason','analysis.health.notes','aiPersona','WETTER:\x20Keine\x20Daten\x20gefunden','\x20hours.\x20The\x20resident\x20might\x20be\x20incapacitated.\x20Risk\x20level:\x20HIGH.','isPresent','TEST-PRO-KEY','subscribeForeignStatesAsync','Feedback\x20Log','Gast','\x20|\x20','events.lastEvent','exports','runBaselineDriftAnalysis','Sleep\x20Score\x20(0-100)','runAutopilot','bind','\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x0a\x20\x20\x20\x20\x20\x20\x20\x20OUTPUT:\x20Nur\x20der\x20Nachrichtentext\x20(kein\x20JSON).\x20Integriere\x20den\x20Kontext\x20(Wetter/Kalender)\x20nur\x20wenn\x20relevant.','baselineDrift','events.history','response','notifyWhatsappRecipient','GUEST','analysis.triggerBriefing','text','unknown','geminiApiKey','find','Deviation','stateChange','type','License\x20Check\x20failed:\x20','send','cancel','analysis.health.restlessness','test','lastAlertState','systemConfig','long','‚ö†Ô∏è\x20Alarm','switch','suggestedAction','analysisHistory','tryParse','scanForDevices','Deaktiviert\x20(Pro-Feature)','triggerDailyDigest','\x20min).\x20Watchdog\x20Limit:\x20','\x20presence\x20devices...','getObjectAsync','LTM.driftAnalysis.baselineDrift','json','createDailyDigest','Description',')\x20-\x20OBFUSCATION\x20SAFE\x20MODE','value.health','LTM.dailyDigests','de-DE','Pattern\x20Detected','daswetter.0','sort','Drift\x20Analysis','üåÖ\x20Daily\x20Briefing:\x0a','280OWCJxi','callback','notifyEmailEnabled','minDaysForBaseline','Wetter:\x20Deaktiviert','licenseKey','log','command','briefingEnabled','notifySignalRecipient','Comfort\x20Suggestion','Urlaub','Scanning\x20for\x20devices...','getCalendarContext','search','notifyPushoverRecipient','delObjectAsync','Subscribing\x20to\x20','isEmergency','setPresence','getCalendarNames','notifyEmailInstance','analysis.alertReason','abortExitTimer','ROLLE:\x20Smart\x20Home\x20Analyst.\x20SPRACHE:\x20DE.\x20FORMAT:\x20JSON.\x20\x0a\x20\x20\x20\x20\x20\x20\x20\x20AKTUELLE\x20ZEIT:\x20','\x20sent','saveFeedback','health','sleepScore','thermostat','initZombies','setState','node-schedule','enum.rooms.*','Error\x20creating\x20objects:\x20','Gemini\x20AI\x20initialized.','light','analysis.history_debug_03','2-digit','dimmer','notes','analysisInterval','\x20*\x20*\x20*','retry','Presence\x20Status','analysis.trigger','onUnload','onReady','setupLtmScheduler','382454iKlwfB','Success','analysis.feedbackHistory','initHistory','notifyEmailRecipient','Daily\x20Digest\x20erstellt\x20&\x20gespeichert.','[Test]\x20Notification','catch','generic','notifyWhatsappInstance','automationProposal','boolean','humidity','\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x0a\x20\x20\x20\x20\x20\x20\x20\x20DATEN:\x0a\x20\x20\x20\x20\x20\x20\x20\x20-\x20Schlafqualit√§t\x20letzte\x20Nacht:\x20','\x22\x20was\x20','analysis.health','weatherInstance','getStateAsync','setupBriefingScheduler','sendMorningBriefing','join','analysis.analysisHistory','val','2805021YJNzzC','suggestion','Baseline\x20Status','Error\x20in\x20onMessage\x20command\x20','getForeignObjectsAsync','location','doors','\x0a\x20\x20\x20\x20\x20\x20\x20\x20ZUSATZ-KONTEXT:\x20','Baseline:\x20Inactive\x20(Pro\x20Feature).','\x20Tage)','restlessness','getLtmData','enum','uuid-not-found','Fokus\x20auf\x20Maximierung\x20von\x20Komfort,\x20Automatisierungseffizienz\x20und\x20Energieeinsparung.','Trigger\x20Analysis','map','KALENDER:\x20Keine\x20Kalender\x20ausgew√§hlt\x20(Bitte\x20in\x20Settings\x20konfigurieren)','sendToAsync','checkWifiPresence','ical.0','uuid-error','PRIORIT√ÑT:\x20Sicherheit.\x20Erkenne\x20Eindringlinge,\x20ungew√∂hnliche\x20Anwesenheit.','channel','notifyTelegramInstance','.Summary.Current','40cjncEF','2698548QfGzLG','submitFeedback','runGeminiAnalysis','briefingJob','LTM.triggerDailyDigest','onStateChange','Sending\x20notification:\x20\x22','setObjectNotExistsAsync','cogni-living','getCalendarNames\x20Error:\x20','parse','LTM.processingStatus','events.history_debug_02','Error\x20checking\x20WiFi:\x20','\x0aFEEDBACK:\x0a','extendObjectAsync','Raw\x20Log','isProVersion','testContext','splice','Last\x20Result','unload','version','getForeignStateAsync','comfort','@google/generative-ai','logDuplicates','4UlcGVQ','push','analysis.activitySummary','isExit','VACATION','generateContent','.\x0a\x20\x20\x20\x20\x20\x20\x20\x20EXTERNER\x20KONTEXT\x20(WICHTIG):\x20','ROLLE:\x20Data\x20Scientist.\x20VERGLEICHE:\x20Dataset\x20A\x20(Recent)\x20vs\x20B\x20(Established).\x20ZIEL:\x20Erkenne\x20Drift.\x20SCHEMA:\x20{\x20\x22baselineDrift\x22:\x20\x22none|slight|significant|critical\x22,\x20\x22driftDetails\x22:\x20\x22string\x22\x20}\x0a\x0aB\x20(LTB):\x0a','status','online','Creating\x20Daily\x20Digest\x20from\x20','Feedback\x20saved:\x20','Analysiere\x20ausgewogen\x20auf\x20Gesundheit,\x20Sicherheit\x20und\x20Komfort.','subscribeStates','initSensorSubscriptions','summary','city','Drift\x20Sched\x20Error:\x20','sendTo','LTM\x20Sched\x20Error:\x20','error','Action','uuid','setupDriftAnalysisScheduler','info','sensorLastValues','WETTER\x20ERROR:\x20','NORMAL','No\x20instance','lock','daswetter','\x20\x0a\x20\x20\x20\x20\x20\x20\x20\x20AUFGABE:\x20Analysiere\x20die\x20Events\x20auf\x20Aktivit√§t,\x20Komfort\x20und\x20GESUNDHEIT.\x20\x0a\x20\x20\x20\x20\x20\x20\x20\x20Nutze\x20den\x20EXTERNEN\x20KONTEXT\x20(Wetter/Kalender)\x20um\x20Fehlalarme\x20zu\x20vermeiden\x20(z.B.\x20Regen\x20=\x20keine\x20Gartenaktivit√§t,\x20Termin\x20=\x20Abwesend).\x0a\x20\x20\x20\x20\x20\x20\x20\x20SCHEMA:\x20{\x20\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x22activity\x22:\x20{\x20\x22summary\x22:\x20\x22string\x22,\x20\x22deviationFromBaseline\x22:\x20\x22string\x22,\x20\x22isAlert\x22:\x20bool,\x20\x22isEmergency\x22:\x20bool,\x20\x22alertReason\x22:\x20\x22string\x22\x20},\x20\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x22comfort\x22:\x20{\x20\x22summary\x22:\x20\x22string\x22,\x20\x22suggestion\x22:\x20\x22string\x22,\x20\x22automationProposal\x22:\x20{\x20\x22patternDetected\x22:\x20bool,\x20\x22description\x22:\x20\x22string\x22,\x20\x22suggestedAction\x22:\x20\x22string\x22\x20}\x20},\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x22health\x22:\x20{\x20\x22sleepScore\x22:\x20number\x20(0-100),\x20\x22restlessness\x22:\x20\x22none|low|medium|high\x22,\x20\x22notes\x22:\x20\x22string\x22\x20}\x20\x0a\x20\x20\x20\x20\x20\x20\x20\x20}','startExitTimer','system.isPresent','setupModeResetScheduler','analysis.history_debug_02','analysis.comfortSuggestion','native','role','events.history_debug_03','inactivityMonitoringEnabled','0\x204\x20*\x20*\x20*','setStateAsync','latitude','notifyPushoverEnabled','time','details','System\x20Status\x20&\x20Control','N/A','common','state','isGracePeriodActive','rating','WiFi\x20Presence\x20detected\x20->\x20Aborting\x20Exit\x20Timer.\x20User\x20is\x20present.','Daily\x20Digest\x20created\x20successfully.','door','LTM.driftAnalysis.lastCheck','\x0a\x20\x20\x20\x20\x20\x20\x20\x20EVENTS:\x20','getWeatherContext','analysis.deviationFromBaseline','analysis.history_debug_04','temperature','replace','analysis.isEmergency','notifySignalEnabled','.data.table','3254944SkXPam','name','driftDetails','6JEqjNs','checkLicense','Event\x20History','Comfort\x20Summary','\x0a!!!\x20EXTERNAL\x20SYSTEM\x20WARNING\x20!!!\x0a','1225598nLyxht','unshift','models/gemini-flash-latest','getForeignObjectAsync','main','apiKey','Alert\x20Reason','System\x20Mode','rawEventLog','cogni-living\x20adapter\x20starting\x20(v','analysisTimer','Processing\x20Status','PRIORIT√ÑT:\x20Gesundheit\x20und\x20Sicherheit\x20f√ºr\x20Senioren\x20(AAL).\x20Erkenne\x20Inaktivit√§t,\x20potenzielle\x20St√ºrze\x20(indirekt),\x20Schlafunterbrechungen\x20und\x20n√§chtliche\x20Unruhe.','Gemini\x20Init\x20Error:\x20','sendNotification','date','KALENDER:\x20','onMessage','object','includes','Automation\x20Proposals','systemUUID','currentSystemMode','.\x0a\x20\x20\x20\x20\x20\x20\x20\x20MODUS:\x20','lights','length','Adapter','loadRawEventLog','LTM.baselineStatus','system.mode','activity','namespace','analysis.automation.description','2404551pdWVAo','livingContext','_calName','none','analysis.history_debug_01','exitGraceTimer','getGenerativeModel','notifyWhatsappEnabled','inactivityThresholdHours','openweathermap','saveRawEventLog','timestamp','values','initPresenceSubscriptions','message','vacation','createAllObjects','7103720jylhff','User\x20Feedback:\x20Alarm\x20\x22','PRO-','genAI','text.alarm','.forecast.current.state','Normal','toString','calendarSelection','Reset\x20Sched\x20Error:\x20','driftAnalysisTimer','presenceDevices','Missing\x20data','now','analysis.comfortSummary','Bewegung\x20w√§hrend\x20Exit-Timer\x20erkannt\x20->\x20Bewohner\x20ist\x20noch\x20da.','(((.+)+)+)+$','Trigger\x20Briefing\x20(Test)','dailyDigests','scanDevices','updateAnalysisHistory','ltmDriftCheckIntervalHours','Last\x20raw\x20event','Scheduling\x20Morning\x20Briefing\x20for\x20','feedbackHistory','/100\x0a\x20\x20\x20\x20\x20\x20\x20\x20-\x20Aktivit√§t\x20seit\x2004:00\x20Uhr:\x20','events.history_debug_01','.\x20PERSONA:\x20','Trigger\x20Digest','geminiModel','analysis.lastResult','updateBaselineStatus','button','number','Aktiv\x20(','filter','indicator.alarm','LTM.rawEventLog','loadSystemMode','split','warn','weatherunderground.0','\x0a\x20\x20\x20\x20\x20\x20\x20\x20INPUT:\x20','getSystemUUID','notifySignalInstance','\x0a!!!\x20END\x20WARNING\x20!!!\x0a','eventHistory','\x0a\x20\x20\x20\x20\x20\x20\x20\x20OUTPUT\x20SCHEMA:\x20{\x20\x22summary\x22:\x20\x22string\x22,\x20\x22activityLevel\x22:\x20\x22string\x22,\x20\x22health\x22:\x20{\x20\x22sleepScore\x22:\x20number,\x20\x22restlessness\x22:\x20\x22string\x22\x20}\x20}','events.history_debug_04'];a0_0x1228=function(){return _0x37b338;};return a0_0x1228();}const utils=require(a0_0x567e26(0xe2)),{GoogleGenerativeAI}=require(a0_0x567e26(0x1bc)),schedule=require(a0_0x567e26(0x160)),HISTORY_MAX_SIZE=0x32,RAW_LOG_MAX_SIZE=0x5dc,LTM_MIN_EVENTS_FOR_COMPRESSION=0x5,GEMINI_MODEL=a0_0x567e26(0x20a),LTM_SCHEDULE='0\x203\x20*\x20*\x20*',MODE_RESET_SCHEDULE=a0_0x567e26(0x1e7),ANALYSIS_HISTORY_MAX_SIZE=0x64,LTM_DP_RAW_LOG=a0_0x567e26(0xc2),LTM_DP_DAILY_DIGESTS=a0_0x567e26(0x139),LTM_DP_STATUS=a0_0x567e26(0x1ae),LTM_DP_TRIGGER_DIGEST=a0_0x567e26(0x1a7),LTM_DP_BASELINE_STATUS=a0_0x567e26(0x87),LTM_DP_DRIFT_CHANNEL='LTM.driftAnalysis',LTM_DP_DRIFT_STATUS=a0_0x567e26(0x133),LTM_DP_DRIFT_DETAILS='LTM.driftAnalysis.driftDetails',LTM_DP_DRIFT_LAST_CHECK=a0_0x567e26(0x1f6),SYSTEM_DP_MODE=a0_0x567e26(0x88),SYSTEM_MODES={'NORMAL':a0_0x567e26(0xe9),'VACATION':a0_0x567e26(0x9b),'PARTY':a0_0x567e26(0xd9),'GUEST':'guest'},AUTO_RESET_MODES=[SYSTEM_MODES[a0_0x567e26(0xe8)],SYSTEM_MODES[a0_0x567e26(0x117)]],EXIT_TIMER_MINUTES=0xf,EXIT_GRACE_PERIOD_SECONDS=0x1e,PERSONA_MAPPING={'generic':a0_0x567e26(0x1ca),'senior_aal':a0_0x567e26(0x214),'family':'Fokus\x20auf\x20Familienroutinen,\x20Kindersicherheit\x20und\x20allgemeines\x20Haushaltsmanagement.','single_comfort':a0_0x567e26(0x196),'security':a0_0x567e26(0x19e)};class CogniLiving extends utils[a0_0x567e26(0x222)]{constructor(_0x486ca3){const _0x40a57f=a0_0x567e26;super({..._0x486ca3,'name':_0x40a57f(0x1ab)}),this['eventHistory']=[],this[_0x40a57f(0x12b)]=[],this[_0x40a57f(0xb5)]=[],this[_0x40a57f(0x210)]=[],this[_0x40a57f(0xaf)]=[],this['sensorLastValues']={},this[_0x40a57f(0x126)]={'latitude':0x0,'longitude':0x0,'city':''},this[_0x40a57f(0x106)]=!![],this['exitTimer']=null,this[_0x40a57f(0x91)]=null,this['isGracePeriodActive']=![],this[_0x40a57f(0xa0)]=null,this[_0x40a57f(0xba)]=null,this['currentSystemMode']=SYSTEM_MODES[_0x40a57f(0x1d9)],this[_0x40a57f(0x1b4)]=![],this['lastAlertState']=![],this['systemUUID']=_0x40a57f(0x11a),this[_0x40a57f(0x212)]=null,this[_0x40a57f(0xe1)]=null,this['modeResetJob']=null,this[_0x40a57f(0xa7)]=null,this[_0x40a57f(0x1a6)]=null,this['on']('ready',this[_0x40a57f(0x16f)][_0x40a57f(0x111)](this)),this['on'](_0x40a57f(0x11e),this[_0x40a57f(0x1a8)][_0x40a57f(0x111)](this)),this['on'](_0x40a57f(0x1b8),this[_0x40a57f(0x16e)][_0x40a57f(0x111)](this)),this['on'](_0x40a57f(0x9a),this[_0x40a57f(0x219)][_0x40a57f(0x111)](this));}async[a0_0x567e26(0x16f)](){const _0x386641=a0_0x567e26;this[_0x386641(0x146)][_0x386641(0x1d6)](_0x386641(0x211)+this[_0x386641(0x1b9)]+_0x386641(0x137)),await this[_0x386641(0x15e)](),this[_0x386641(0xcf)]['licenseKey']=this['config'][_0x386641(0x145)]||'';try{this[_0x386641(0x1b4)]=await this[_0x386641(0x204)](this[_0x386641(0xcf)][_0x386641(0x145)]);}catch(_0xbc8d9e){this['log']['error'](_0x386641(0x120)+_0xbc8d9e[_0x386641(0x9a)]);}if(!this[_0x386641(0xcf)]['inactivityThresholdHours']||this[_0x386641(0xcf)][_0x386641(0x94)]<0.1)this['config'][_0x386641(0x94)]=0xc;await this['initHistory'](),await this['initSystemConfig']();if(this[_0x386641(0xcf)][_0x386641(0x11b)])try{this['genAI']=new GoogleGenerativeAI(this[_0x386641(0xcf)][_0x386641(0x11b)]),this[_0x386641(0xba)]=this[_0x386641(0xa0)][_0x386641(0x92)]({'model':GEMINI_MODEL,'generationConfig':{'responseMimeType':'application/json'}}),this['log'][_0x386641(0x1d6)](_0x386641(0x163));}catch(_0x8408b3){this[_0x386641(0x146)]['error'](_0x386641(0x215)+_0x8408b3[_0x386641(0x9a)]);}await this['createAllObjects'](),await this[_0x386641(0xc3)](),await this[_0x386641(0x86)](),await this[_0x386641(0xe5)](),this[_0x386641(0x1cb)](_0x386641(0x16d)),this[_0x386641(0x1cb)](LTM_DP_TRIGGER_DIGEST),this['subscribeStates'](_0x386641(0x88)),this['subscribeStates']('analysis.triggerBriefing'),await this[_0x386641(0x1cc)](),await this[_0x386641(0x99)]();if(this[_0x386641(0x212)])clearInterval(this[_0x386641(0x212)]);const _0x31c542=this[_0x386641(0xcf)][_0x386641(0x169)]||0xf;_0x31c542>0x0&&(this[_0x386641(0x146)]['info']('Starting\x20Autopilot\x20('+_0x31c542+_0x386641(0x130)+this[_0x386641(0xcf)]['inactivityThresholdHours']+'h.'),this[_0x386641(0x212)]=setInterval(()=>{const _0x4feb45=_0x386641;this[_0x4feb45(0x110)]();},_0x31c542*0x3c*0x3e8)),this[_0x386641(0x170)](),this[_0x386641(0x1e0)](),this[_0x386641(0x1d5)](),this[_0x386641(0x183)]();}[a0_0x567e26(0x16e)](_0xb5c151){const _0x36ade8=a0_0x567e26;if(this[_0x36ade8(0x212)])clearInterval(this[_0x36ade8(0x212)]);if(this[_0x36ade8(0xa7)])clearInterval(this['driftAnalysisTimer']);if(this[_0x36ade8(0xe1)])this[_0x36ade8(0xe1)][_0x36ade8(0x122)]();if(this[_0x36ade8(0xce)])this['modeResetJob']['cancel']();if(this['briefingJob'])this[_0x36ade8(0x1a6)][_0x36ade8(0x122)]();if(this[_0x36ade8(0xf3)])clearTimeout(this[_0x36ade8(0xf3)]);if(this[_0x36ade8(0x91)])clearTimeout(this[_0x36ade8(0x91)]);_0xb5c151();}async['onStateChange'](_0x5809dd,_0x49e96d){const _0x28e479=a0_0x567e26;if(!_0x49e96d)return;if(_0x5809dd===this[_0x28e479(0x8a)]+'.'+SYSTEM_DP_MODE){_0x49e96d[_0x28e479(0x187)]&&Object[_0x28e479(0x98)](SYSTEM_MODES)['includes'](_0x49e96d[_0x28e479(0x187)])&&(this[_0x28e479(0x21e)]=_0x49e96d[_0x28e479(0x187)],_0x49e96d[_0x28e479(0x187)]===SYSTEM_MODES['VACATION']?await this[_0x28e479(0x153)](![]):await this[_0x28e479(0x153)](!![]));if(!_0x49e96d[_0x28e479(0xd5)])this[_0x28e479(0x15f)](_0x5809dd,{'val':this[_0x28e479(0x21e)],'ack':!![]});return;}if(!_0x49e96d[_0x28e479(0xd5)]){_0x5809dd['includes']('analysis.trigger')&&_0x49e96d[_0x28e479(0x187)]&&(this[_0x28e479(0x15f)](_0x5809dd,{'val':![],'ack':!![]}),this[_0x28e479(0x1a5)]());if(_0x5809dd[_0x28e479(0x21b)](_0x28e479(0x12f))&&_0x49e96d['val']){this[_0x28e479(0x15f)](_0x5809dd,{'val':![],'ack':!![]});if(this[_0x28e479(0x1b4)])this['createDailyDigest']();}_0x5809dd[_0x28e479(0x21b)]('triggerBriefing')&&_0x49e96d[_0x28e479(0x187)]&&(this[_0x28e479(0x15f)](_0x5809dd,{'val':![],'ack':!![]}),this[_0x28e479(0x184)]());return;}if(this['config']['presenceDevices']&&this[_0x28e479(0xcf)][_0x28e479(0xa8)][_0x28e479(0x21b)](_0x5809dd)){await this[_0x28e479(0x19b)]();return;}const _0x521d1d=(this[_0x28e479(0xcf)][_0x28e479(0xdf)]||[])[_0x28e479(0x11c)](_0x2d6816=>_0x2d6816['id']===_0x5809dd);if(_0x521d1d)this['processSensorEvent'](_0x5809dd,_0x49e96d,_0x521d1d);}async[a0_0x567e26(0x219)](_0xa5fc7c){const _0x1d116c=a0_0x567e26;if(typeof _0xa5fc7c===_0x1d116c(0x21a)&&_0xa5fc7c[_0x1d116c(0x9a)])try{if(_0xa5fc7c['command']===_0x1d116c(0xea)){if(!_0xa5fc7c[_0x1d116c(0x9a)][_0x1d116c(0x20d)])return this[_0x1d116c(0x1d0)](_0xa5fc7c[_0x1d116c(0xeb)],_0xa5fc7c[_0x1d116c(0x147)],{'success':![],'message':'No\x20Key'},_0xa5fc7c['callback']);try{const _0x16d3d6=new GoogleGenerativeAI(_0xa5fc7c['message'][_0x1d116c(0x20d)])[_0x1d116c(0x92)]({'model':'models/gemini-flash-latest'});await _0x16d3d6[_0x1d116c(0x1c3)](_0x1d116c(0x124)),this[_0x1d116c(0x1d0)](_0xa5fc7c[_0x1d116c(0xeb)],_0xa5fc7c['command'],{'success':!![],'message':_0x1d116c(0x172)},_0xa5fc7c[_0x1d116c(0x141)]);}catch(_0x53c40e){this['sendTo'](_0xa5fc7c[_0x1d116c(0xeb)],_0xa5fc7c[_0x1d116c(0x147)],{'success':![],'message':_0x53c40e[_0x1d116c(0x9a)]},_0xa5fc7c[_0x1d116c(0x141)]);}}else{if(_0xa5fc7c[_0x1d116c(0x147)]==='testNotification'){const _0x1c355f=await this[_0x1d116c(0x216)](_0x1d116c(0x177),!![]);this['sendTo'](_0xa5fc7c[_0x1d116c(0xeb)],_0xa5fc7c[_0x1d116c(0x147)],{'success':_0x1c355f>0x0,'message':_0x1c355f+_0x1d116c(0x159)},_0xa5fc7c[_0x1d116c(0x141)]);}else{if(_0xa5fc7c[_0x1d116c(0x147)]===_0x1d116c(0x193)){if(!this[_0x1d116c(0x1b4)])return this[_0x1d116c(0x1d0)](_0xa5fc7c[_0x1d116c(0xeb)],_0xa5fc7c[_0x1d116c(0x147)],{'success':![],'isPro':![]},_0xa5fc7c[_0x1d116c(0x141)]);let _0x2768f8={'status':_0x1d116c(0x1ee),'details':'','lastCheck':0x0};try{_0x2768f8[_0x1d116c(0x1c6)]=(await this[_0x1d116c(0x182)](LTM_DP_DRIFT_STATUS))[_0x1d116c(0x187)],_0x2768f8[_0x1d116c(0x1ec)]=(await this[_0x1d116c(0x182)](LTM_DP_DRIFT_DETAILS))[_0x1d116c(0x187)],_0x2768f8[_0x1d116c(0xf6)]=(await this['getStateAsync'](LTM_DP_DRIFT_LAST_CHECK))[_0x1d116c(0x187)];}catch(_0x5ef3ee){}this[_0x1d116c(0x1d0)](_0xa5fc7c[_0x1d116c(0xeb)],_0xa5fc7c[_0x1d116c(0x147)],{'success':!![],'isPro':!![],'dailyDigests':this[_0x1d116c(0xaf)],'driftAnalysis':_0x2768f8,'analysisHistory':this[_0x1d116c(0x12b)]},_0xa5fc7c['callback']);}else{if(_0xa5fc7c['command']==='getEnums'){const _0x267f83=await this['getForeignObjectsAsync']('enum.functions.*',_0x1d116c(0x194)),_0x3e17a4=[];if(_0x267f83)for(const _0x1c08a8 in _0x267f83){const _0x21e751=_0x267f83[_0x1c08a8],_0x288ebb=(_0x21e751[_0x1d116c(0x1ef)]&&typeof _0x21e751[_0x1d116c(0x1ef)][_0x1d116c(0x201)]==='object'?_0x21e751[_0x1d116c(0x1ef)][_0x1d116c(0x201)]['de']:_0x21e751[_0x1d116c(0x1ef)]['name'])||_0x21e751['common']['name'];_0x3e17a4[_0x1d116c(0x1bf)]({'id':_0x1c08a8,'name':_0x288ebb});}this[_0x1d116c(0x1d0)](_0xa5fc7c['from'],_0xa5fc7c[_0x1d116c(0x147)],{'success':!![],'enums':_0x3e17a4},_0xa5fc7c[_0x1d116c(0x141)]);}else{if(_0xa5fc7c[_0x1d116c(0x147)]===_0x1d116c(0xb0))try{const _0xf9960f=await this[_0x1d116c(0x12d)](_0xa5fc7c[_0x1d116c(0x9a)]||{});this[_0x1d116c(0x1d0)](_0xa5fc7c[_0x1d116c(0xeb)],_0xa5fc7c[_0x1d116c(0x147)],{'success':!![],'devices':_0xf9960f},_0xa5fc7c[_0x1d116c(0x141)]);}catch(_0x2522f2){this[_0x1d116c(0x1d0)](_0xa5fc7c[_0x1d116c(0xeb)],_0xa5fc7c['command'],{'success':![],'error':_0x2522f2[_0x1d116c(0x9a)]},_0xa5fc7c['callback']);}else{if(_0xa5fc7c[_0x1d116c(0x147)]===_0x1d116c(0x1a4)){const {historyId:_0x4b2bfd,rating:_0x596ebd,comment:_0x39869d,alertReason:_0xbf6411}=_0xa5fc7c[_0x1d116c(0x9a)];_0x4b2bfd&&_0x596ebd?(await this[_0x1d116c(0x15a)]({'timestamp':Date[_0x1d116c(0xaa)](),'historyId':_0x4b2bfd,'rating':_0x596ebd,'comment':_0x39869d,'alertReason':_0xbf6411}),this['sendTo'](_0xa5fc7c[_0x1d116c(0xeb)],_0xa5fc7c[_0x1d116c(0x147)],{'success':!![]},_0xa5fc7c[_0x1d116c(0x141)])):this[_0x1d116c(0x1d0)](_0xa5fc7c[_0x1d116c(0xeb)],_0xa5fc7c['command'],{'success':![],'error':_0x1d116c(0xa9)},_0xa5fc7c['callback']);}else{if(_0xa5fc7c[_0x1d116c(0x147)]===_0x1d116c(0x1b5)){const _0x552307=await this['getWeatherContext'](),_0x1ab029=await this[_0x1d116c(0x14d)]();this[_0x1d116c(0x1d0)](_0xa5fc7c[_0x1d116c(0xeb)],_0xa5fc7c[_0x1d116c(0x147)],{'success':!![],'weather':_0x552307,'calendar':_0x1ab029},_0xa5fc7c['callback']);}else{if(_0xa5fc7c[_0x1d116c(0x147)]===_0x1d116c(0x154)){const _0x218406=_0xa5fc7c[_0x1d116c(0x9a)][_0x1d116c(0xff)];if(!_0x218406)return this['sendTo'](_0xa5fc7c['from'],_0xa5fc7c[_0x1d116c(0x147)],{'success':![],'error':_0x1d116c(0x1da)},_0xa5fc7c[_0x1d116c(0x141)]);const _0x5e9a39=await this[_0x1d116c(0x154)](_0x218406);this[_0x1d116c(0x1d0)](_0xa5fc7c[_0x1d116c(0xeb)],_0xa5fc7c[_0x1d116c(0x147)],{'success':!![],'names':_0x5e9a39},_0xa5fc7c[_0x1d116c(0x141)]);}}}}}}}}}catch(_0x1b8ff0){this[_0x1d116c(0x146)][_0x1d116c(0x1d2)](_0x1d116c(0x18b)+_0xa5fc7c[_0x1d116c(0x147)]+':\x20'+_0x1b8ff0[_0x1d116c(0x9a)]);if(_0xa5fc7c[_0x1d116c(0x141)])this[_0x1d116c(0x1d0)](_0xa5fc7c[_0x1d116c(0xeb)],_0xa5fc7c['command'],{'success':![],'error':_0x1b8ff0[_0x1d116c(0x9a)]},_0xa5fc7c['callback']);}}async[a0_0x567e26(0xfe)](_0x7b826f,_0x3e9e9c,_0x1d9ee6){const _0x26ac9f=a0_0x567e26;if(!_0x1d9ee6[_0x26ac9f(0x1bd)]&&this[_0x26ac9f(0x1d7)][_0x7b826f]===_0x3e9e9c[_0x26ac9f(0x187)])return;this[_0x26ac9f(0x1d7)][_0x7b826f]=_0x3e9e9c[_0x26ac9f(0x187)];if(this[_0x26ac9f(0x1f1)])return;const _0x266b42=await this[_0x26ac9f(0x19b)]();if(_0x266b42){if(!this[_0x26ac9f(0x106)])await this[_0x26ac9f(0x153)](!![]);}else{const _0x2ed76e=_0x1d9ee6[_0x26ac9f(0x1c1)]===!![];_0x2ed76e?this['startExitTimer']():(this['exitTimer']&&(this[_0x26ac9f(0x146)][_0x26ac9f(0x1d6)](_0x26ac9f(0xac)),this[_0x26ac9f(0x157)]()),!this['isPresent']&&this[_0x26ac9f(0x21e)]===SYSTEM_MODES[_0x26ac9f(0x1d9)]&&await this[_0x26ac9f(0x153)](!![]));}const _0x4b6d89={'timestamp':_0x3e9e9c['ts'],'id':_0x7b826f,'name':_0x1d9ee6['name'],'value':_0x3e9e9c[_0x26ac9f(0x187)],'location':_0x1d9ee6[_0x26ac9f(0x18d)],'type':_0x1d9ee6[_0x26ac9f(0x11f)]};this[_0x26ac9f(0xcb)][_0x26ac9f(0x209)](_0x4b6d89);if(this[_0x26ac9f(0xcb)][_0x26ac9f(0x221)]>HISTORY_MAX_SIZE)this[_0x26ac9f(0xcb)]['pop']();await this[_0x26ac9f(0x1e8)](_0x26ac9f(0x10c),{'val':JSON[_0x26ac9f(0xfc)](_0x4b6d89),'ack':!![]}),await this[_0x26ac9f(0x1e8)](_0x26ac9f(0x114),{'val':JSON[_0x26ac9f(0xfc)](this[_0x26ac9f(0xcb)]),'ack':!![]}),this['rawEventLog']['push']({'timestamp':new Date(_0x3e9e9c['ts'])['toISOString'](),'sensorName':_0x1d9ee6[_0x26ac9f(0x201)],'location':_0x1d9ee6[_0x26ac9f(0x18d)],'value':_0x3e9e9c['val']}),await this['saveRawEventLog']();}async[a0_0x567e26(0x110)](){const _0x20641a=a0_0x567e26,_0x348f82=this[_0x20641a(0xcf)][_0x20641a(0x94)],_0x209571=this['config'][_0x20641a(0x1e6)],_0x48c3f0=this[_0x20641a(0xcb)]['length']>0x0?this[_0x20641a(0xcb)][0x0][_0x20641a(0x97)]:Date[_0x20641a(0xaa)](),_0x3c341a=(Date['now']()-_0x48c3f0)/(0x3e8*0x3c*0x3c);let _0x4d4574='';_0x209571&&this[_0x20641a(0x21e)]===SYSTEM_MODES[_0x20641a(0x1d9)]&&this['isPresent']&&(_0x3c341a>_0x348f82&&(_0x4d4574='CRITICAL\x20WARNING:\x20No\x20sensor\x20activity\x20detected\x20for\x20'+_0x3c341a['toFixed'](0x1)+_0x20641a(0x105)));if(_0x4d4574){this[_0x20641a(0x1a5)](_0x4d4574)[_0x20641a(0x178)](_0x44c372=>this['log'][_0x20641a(0x1d2)](_0x44c372));return;}const _0x259a7b=Date[_0x20641a(0xaa)](),_0x4a0815=_0x259a7b-_0x48c3f0,_0x3b0483=(this[_0x20641a(0xcf)][_0x20641a(0x169)]||0xf)*0x3c*0x3e8;this[_0x20641a(0xcb)][_0x20641a(0x221)]>0x0&&_0x4a0815<=_0x3b0483?this[_0x20641a(0x1a5)]()[_0x20641a(0x178)](_0x409e09=>this['log'][_0x20641a(0x1d2)](_0x409e09)):!this['lastAlertState']&&(this[_0x20641a(0x15f)]('analysis.isAlert',{'val':![],'ack':!![]}),this[_0x20641a(0x15f)](_0x20641a(0x1fd),{'val':![],'ack':!![]}));}async['runGeminiAnalysis'](_0x351448=''){const _0x3c10d7=a0_0x567e26;if(!this[_0x3c10d7(0xba)])return;const _0x1c7391=this[_0x3c10d7(0xcb)][_0x3c10d7(0x221)]>0x0?this[_0x3c10d7(0xcb)]:[{'note':'No\x20recorded\x20events\x20yet.'}],_0x26a59b=PERSONA_MAPPING[this[_0x3c10d7(0xcf)][_0x3c10d7(0x103)]||'generic'],_0x4d94be=this[_0x3c10d7(0xcf)][_0x3c10d7(0x8d)]||'',_0x2ce158=this[_0x3c10d7(0x21e)],_0xf0366a=await this[_0x3c10d7(0x1f8)](),_0x2f814d=await this['getCalendarContext'](),_0x385fc6=(_0xf0366a+'\x20'+_0x2f814d)['trim'](),_0x4866a8=new Date(),_0x1628ab=_0x4866a8['toLocaleString'](_0x3c10d7(0x13a),{'weekday':_0x3c10d7(0x127),'hour':_0x3c10d7(0x166),'minute':_0x3c10d7(0x166)}),_0x56a069=this[_0x3c10d7(0x126)];let _0x240e96='';if(this['feedbackHistory']['length']>0x0){const _0x4c4cd8=this[_0x3c10d7(0xb5)][_0x3c10d7(0xde)](0x0,0x3)[_0x3c10d7(0x198)](_0xba7987=>_0x3c10d7(0x9e)+_0xba7987[_0x3c10d7(0x101)]+_0x3c10d7(0x17f)+_0xba7987[_0x3c10d7(0x1f2)]+'.')['join']('\x0a');_0x240e96=_0x3c10d7(0x1b1)+_0x4c4cd8+'\x0a';}const _0x2442b5=_0x351448?_0x3c10d7(0x207)+_0x351448+_0x3c10d7(0xca):'',_0x41d4a3=_0x3c10d7(0x190),_0x3fdc83=_0x3c10d7(0x158)+_0x1628ab+'.\x20ORT:\x20'+_0x56a069[_0x3c10d7(0x1ce)]+_0x3c10d7(0x21f)+_0x2ce158+'.\x20PR√ÑSENZ:\x20'+(this[_0x3c10d7(0x106)]?'Ja':'Nein')+'.\x20\x0a\x20\x20\x20\x20\x20\x20\x20\x20KONTEXT\x20(Wohnen):\x20'+_0x4d94be+_0x3c10d7(0xb8)+_0x26a59b+_0x3c10d7(0x1c4)+_0x385fc6+'\x0a\x20\x20\x20\x20\x20\x20\x20\x20'+_0x41d4a3+'\x20'+_0x240e96+'\x20'+_0x2442b5+_0x3c10d7(0x1f7)+JSON[_0x3c10d7(0xfc)](_0x1c7391)+_0x3c10d7(0x1dd);try{const _0x20cd8f=await this[_0x3c10d7(0xba)][_0x3c10d7(0x1c3)](_0x3fdc83),_0x21b49f=_0x20cd8f[_0x3c10d7(0x115)][_0x3c10d7(0x119)]()['replace'](/```json|```/g,'')[_0x3c10d7(0xe6)](),_0x2ed78c=JSON[_0x3c10d7(0x1ad)](_0x21b49f);await this[_0x3c10d7(0x1e8)](_0x3c10d7(0xbb),{'val':_0x21b49f,'ack':!![]}),await this[_0x3c10d7(0x1e8)](_0x3c10d7(0x156),{'val':_0x2ed78c['activity'][_0x3c10d7(0x101)]||'','ack':!![]}),await this[_0x3c10d7(0x1e8)]('analysis.activitySummary',{'val':_0x2ed78c[_0x3c10d7(0x89)][_0x3c10d7(0x1cd)]||_0x3c10d7(0x1ee),'ack':!![]}),await this[_0x3c10d7(0x1e8)](_0x3c10d7(0x1f9),{'val':_0x2ed78c['activity']['deviationFromBaseline']||_0x3c10d7(0x1ee),'ack':!![]});_0x2ed78c[_0x3c10d7(0x1bb)]&&(await this[_0x3c10d7(0x1e8)](_0x3c10d7(0xab),{'val':_0x2ed78c[_0x3c10d7(0x1bb)][_0x3c10d7(0x1cd)]||'','ack':!![]}),await this[_0x3c10d7(0x1e8)](_0x3c10d7(0x1e2),{'val':_0x2ed78c[_0x3c10d7(0x1bb)][_0x3c10d7(0x189)]||'','ack':!![]}),_0x2ed78c[_0x3c10d7(0x1bb)][_0x3c10d7(0x17b)]&&(await this[_0x3c10d7(0x1e8)]('analysis.automation.patternDetected',{'val':_0x2ed78c[_0x3c10d7(0x1bb)][_0x3c10d7(0x17b)]['patternDetected']||![],'ack':!![]}),await this[_0x3c10d7(0x1e8)](_0x3c10d7(0x8b),{'val':_0x2ed78c[_0x3c10d7(0x1bb)]['automationProposal']['description']||'','ack':!![]}),await this[_0x3c10d7(0x1e8)](_0x3c10d7(0xfb),{'val':_0x2ed78c['comfort'][_0x3c10d7(0x17b)][_0x3c10d7(0x12a)]||'','ack':!![]})));_0x2ed78c[_0x3c10d7(0x15b)]&&(await this[_0x3c10d7(0x1e8)](_0x3c10d7(0xec),{'val':typeof _0x2ed78c[_0x3c10d7(0x15b)]['sleepScore']===_0x3c10d7(0xbe)?_0x2ed78c[_0x3c10d7(0x15b)][_0x3c10d7(0x15c)]:0x0,'ack':!![]}),await this[_0x3c10d7(0x1e8)](_0x3c10d7(0x123),{'val':_0x2ed78c[_0x3c10d7(0x15b)][_0x3c10d7(0x192)]||'none','ack':!![]}),await this[_0x3c10d7(0x1e8)](_0x3c10d7(0x102),{'val':_0x2ed78c[_0x3c10d7(0x15b)][_0x3c10d7(0x168)]||'','ack':!![]}));const _0x80b9a3=_0x2ed78c[_0x3c10d7(0x89)]['isAlert']||![],_0x2972f6=_0x2ed78c[_0x3c10d7(0x89)][_0x3c10d7(0x152)]||![];if(_0x80b9a3||_0x2972f6){await this[_0x3c10d7(0x1e8)](_0x3c10d7(0xd0),{'val':!![],'ack':!![]}),await this[_0x3c10d7(0x1e8)](_0x3c10d7(0x1fd),{'val':_0x2972f6,'ack':!![]});if(!this[_0x3c10d7(0x125)]||_0x2972f6){const _0x3aae50=_0x2972f6?_0x3c10d7(0xf0):_0x3c10d7(0x128);this[_0x3c10d7(0x216)](_0x3aae50+':\x20'+_0x2ed78c[_0x3c10d7(0x89)][_0x3c10d7(0x101)],![],_0x2972f6);}}else await this[_0x3c10d7(0x1e8)]('analysis.isAlert',{'val':![],'ack':!![]}),await this[_0x3c10d7(0x1e8)]('analysis.isEmergency',{'val':![],'ack':!![]});this['lastAlertState']=_0x80b9a3||_0x2972f6;const _0x315ce7={'timestamp':Date[_0x3c10d7(0xaa)](),'id':Date[_0x3c10d7(0xaa)]()[_0x3c10d7(0xa4)](),'analysis':_0x2ed78c,'systemMode':_0x2ce158,'isPro':this[_0x3c10d7(0x1b4)]};this[_0x3c10d7(0xb1)](_0x315ce7);}catch(_0x312ca2){this[_0x3c10d7(0x146)][_0x3c10d7(0x1d2)]('Analysis\x20Error:\x20'+_0x312ca2['message']);}}async[a0_0x567e26(0x135)](){const _0x2bb8e1=a0_0x567e26;if(!this[_0x2bb8e1(0xba)]||this[_0x2bb8e1(0x210)][_0x2bb8e1(0x221)]<LTM_MIN_EVENTS_FOR_COMPRESSION){await this[_0x2bb8e1(0x1e8)](LTM_DP_STATUS,{'val':'Zu\x20wenig\x20Daten\x20f√ºr\x20Daily\x20Digest.','ack':!![]});return;}this[_0x2bb8e1(0x146)][_0x2bb8e1(0x1d6)](_0x2bb8e1(0x1c8)+this[_0x2bb8e1(0x210)]['length']+_0x2bb8e1(0xe3)),await this['setStateAsync'](LTM_DP_STATUS,{'val':'Analysiere\x20Tag...','ack':!![]});const _0x56efb2=this[_0x2bb8e1(0x210)][_0x2bb8e1(0x221)]>0x320?this[_0x2bb8e1(0x210)][_0x2bb8e1(0xde)](this[_0x2bb8e1(0x210)][_0x2bb8e1(0x221)]-0x320):this[_0x2bb8e1(0x210)],_0x5413fa=PERSONA_MAPPING[this['config'][_0x2bb8e1(0x103)]||_0x2bb8e1(0x179)],_0x47a6b6='ROLLE:\x20Data\x20Analyst.\x20AUFGABE:\x20Fasse\x20den\x20heutigen\x20Tag\x20basierend\x20auf\x20den\x20Sensor-Logs\x20zusammen.\x0a\x20\x20\x20\x20\x20\x20\x20\x20PERSONA:\x20'+_0x5413fa+_0x2bb8e1(0xc7)+JSON[_0x2bb8e1(0xfc)](_0x56efb2)+_0x2bb8e1(0xcc);try{const _0x1496d8=await this[_0x2bb8e1(0xba)]['generateContent'](_0x47a6b6),_0x53ffbb=_0x1496d8[_0x2bb8e1(0x115)]['text']()[_0x2bb8e1(0x1fc)](/```json|```/g,'')[_0x2bb8e1(0xe6)](),_0x211140=JSON[_0x2bb8e1(0x1ad)](_0x53ffbb),_0x3f3273={'timestamp':new Date()[_0x2bb8e1(0xf4)](),'eventCount':this[_0x2bb8e1(0x210)][_0x2bb8e1(0x221)],'summary':_0x211140[_0x2bb8e1(0x1cd)],'activityLevel':_0x211140[_0x2bb8e1(0xf8)],'health':{'sleepScore':_0x211140[_0x2bb8e1(0x15b)]?_0x211140[_0x2bb8e1(0x15b)]['sleepScore']:0x0,'restlessness':_0x211140['health']?_0x211140[_0x2bb8e1(0x15b)][_0x2bb8e1(0x192)]:_0x2bb8e1(0x8f)},'systemMode':this[_0x2bb8e1(0x21e)]};this[_0x2bb8e1(0xaf)][_0x2bb8e1(0x1bf)](_0x3f3273),await this['saveDailyDigests'](),this[_0x2bb8e1(0x210)]=[],await this[_0x2bb8e1(0x96)](),await this[_0x2bb8e1(0x1e8)](LTM_DP_STATUS,{'val':_0x2bb8e1(0x176),'ack':!![]}),this['log']['info'](_0x2bb8e1(0x1f4));}catch(_0x1f96b7){this[_0x2bb8e1(0x146)][_0x2bb8e1(0x1d2)]('Daily\x20Digest\x20Error:\x20'+_0x1f96b7[_0x2bb8e1(0x9a)]),await this['setStateAsync'](LTM_DP_STATUS,{'val':_0x2bb8e1(0xdb)+_0x1f96b7[_0x2bb8e1(0x9a)],'ack':!![]});}}async[a0_0x567e26(0x184)](){const _0x28d813=a0_0x567e26;if(!this[_0x28d813(0xba)])return;this[_0x28d813(0x146)]['info'](_0x28d813(0xd8));const _0x233ce6=this['dailyDigests'][_0x28d813(0x221)]>0x0?this[_0x28d813(0xaf)][this['dailyDigests'][_0x28d813(0x221)]-0x1]:null,_0x5f457b=_0x233ce6&&_0x233ce6['health']?_0x233ce6['health']['sleepScore']:_0x28d813(0x1ee),_0x342cc7=new Date();_0x342cc7[_0x28d813(0xf7)](0x4,0x0,0x0,0x0);const _0x511371=this[_0x28d813(0xcb)][_0x28d813(0xc0)](_0x321448=>new Date(_0x321448[_0x28d813(0x97)])>_0x342cc7),_0x5aaf04=PERSONA_MAPPING[this[_0x28d813(0xcf)][_0x28d813(0x103)]||_0x28d813(0x179)],_0x2527b2=this[_0x28d813(0xcf)][_0x28d813(0x8d)]||'',_0x11b713=await this['getWeatherContext'](),_0x293d49=await this[_0x28d813(0x14d)](),_0x49dec2='ROLLE:\x20F√ºrsorglicher\x20Assistent.\x0a\x20\x20\x20\x20\x20\x20\x20\x20AUFGABE:\x20Schreibe\x20eine\x20kurze,\x20beruhigende\x20\x22Guten\x20Morgen\x22-Nachricht\x20an\x20die\x20Angeh√∂rigen/Bewohner.\x0a\x20\x20\x20\x20\x20\x20\x20\x20TON:\x20Freundlich,\x20professionell,\x20kurz.\x0a\x20\x20\x20\x20\x20\x20\x20\x20PERSONA\x20(Fokus):\x20'+_0x5aaf04+'\x0a\x20\x20\x20\x20\x20\x20\x20\x20KONTEXT\x20(Wer\x20wohnt\x20hier?):\x20'+_0x2527b2+_0x28d813(0x18f)+_0x11b713+'\x20'+_0x293d49+_0x28d813(0x17e)+_0x5f457b+_0x28d813(0xb6)+JSON[_0x28d813(0xfc)](_0x511371[_0x28d813(0xde)](0x0,0xa))+_0x28d813(0x112);try{const _0x2ac159=await this[_0x28d813(0xba)]['generateContent'](_0x49dec2),_0x22a541=_0x28d813(0x13f)+_0x2ac159[_0x28d813(0x115)]['text']()[_0x28d813(0xe6)]();this[_0x28d813(0x216)](_0x22a541),this['log']['info']('Morning\x20Briefing\x20sent.');}catch(_0x43fbed){this[_0x28d813(0x146)][_0x28d813(0x1d2)]('Briefing\x20Error:\x20'+_0x43fbed[_0x28d813(0x9a)]);}}async['scanForDevices'](_0x4790e9){const _0x4258b7=a0_0x567e26;this[_0x4258b7(0x146)][_0x4258b7(0x1d6)](_0x4258b7(0x14c));const _0x28ff79=[],_0x3fe553=await this[_0x4258b7(0x18c)]('*',_0x4258b7(0x1f0)),_0x473ddd=await this[_0x4258b7(0x18c)](_0x4258b7(0x161),_0x4258b7(0x194)),_0x1eb4ea={};if(_0x473ddd)for(const _0x58e773 in _0x473ddd){const _0x3e400e=_0x473ddd[_0x58e773]['common']['members'];if(_0x3e400e&&Array[_0x4258b7(0xda)](_0x3e400e)){const _0xbf5fd3=typeof _0x473ddd[_0x58e773]['common'][_0x4258b7(0x201)]===_0x4258b7(0x21a)?_0x473ddd[_0x58e773][_0x4258b7(0x1ef)][_0x4258b7(0x201)]['de']:_0x473ddd[_0x58e773]['common']['name'];for(const _0xa24489 of _0x3e400e){_0x1eb4ea[_0xa24489]=_0xbf5fd3;}}}for(const _0x3de3b9 in _0x3fe553){const _0x17df24=_0x3fe553[_0x3de3b9];if(!_0x17df24[_0x4258b7(0x1ef)])continue;const _0xfa8f96=_0x17df24[_0x4258b7(0x1ef)][_0x4258b7(0x1e4)]||'',_0x2c14ae=(typeof _0x17df24[_0x4258b7(0x1ef)]['name']===_0x4258b7(0x21a)?_0x17df24[_0x4258b7(0x1ef)][_0x4258b7(0x201)]['de']:_0x17df24['common'][_0x4258b7(0x201)])||_0x3de3b9;let _0x40895c='';if(_0x4790e9[_0x4258b7(0xf2)]&&(_0xfa8f96[_0x4258b7(0x21b)](_0x4258b7(0xf2))||_0xfa8f96==='sensor.alarm'))_0x40895c=_0x4258b7(0xf2);else{if(_0x4790e9[_0x4258b7(0x18e)]&&(_0xfa8f96[_0x4258b7(0x21b)](_0x4258b7(0x1f5))||_0xfa8f96['includes'](_0x4258b7(0x100))||_0xfa8f96[_0x4258b7(0x21b)](_0x4258b7(0x1db))))_0x40895c=_0x4258b7(0x1f5);else{if(_0x4790e9[_0x4258b7(0x220)]&&(_0xfa8f96[_0x4258b7(0x21b)](_0x4258b7(0x164))||_0xfa8f96['includes'](_0x4258b7(0x129))||_0xfa8f96[_0x4258b7(0x21b)](_0x4258b7(0x167))))_0x40895c=_0x4258b7(0x164);else{if(_0x4790e9[_0x4258b7(0x1fb)]&&(_0xfa8f96[_0x4258b7(0x21b)](_0x4258b7(0x1fb))||_0xfa8f96[_0x4258b7(0x21b)](_0x4258b7(0x17d))||_0xfa8f96['includes'](_0x4258b7(0x15d))))_0x40895c=_0x4258b7(0x1fb);}}}if(_0x40895c){let _0x5a03a0=_0x1eb4ea[_0x3de3b9]||'';if(!_0x5a03a0){const _0x282362=_0x3de3b9['split']('.');_0x282362['pop']();const _0x4ef5d4=_0x282362['join']('.');_0x5a03a0=_0x1eb4ea[_0x4ef5d4]||'';}_0x28ff79[_0x4258b7(0x1bf)]({'id':_0x3de3b9,'name':_0x2c14ae,'location':_0x5a03a0,'type':_0x40895c,'logDuplicates':![],'isExit':![],'_score':_0x5a03a0?0x50:0x28});}}return _0x28ff79;}['tryParse'](_0x4e8e72){const _0x3766b0=a0_0x567e26;if(typeof _0x4e8e72===_0x3766b0(0x21a))return _0x4e8e72;try{return JSON[_0x3766b0(0x1ad)](_0x4e8e72);}catch(_0x5317b9){return null;}}async[a0_0x567e26(0x15e)](){const _0x3b617b=a0_0x567e26;try{const _0x1f38dc=['analysis.history_debug_00',_0x3b617b(0x90),_0x3b617b(0x1e1),_0x3b617b(0x165),_0x3b617b(0x1fa),'events.history_debug_00',_0x3b617b(0xb7),_0x3b617b(0x1af),_0x3b617b(0x1e5),_0x3b617b(0xcd)];for(const _0x4ff3c3 of _0x1f38dc){try{const _0x30bf63=await this[_0x3b617b(0x132)](_0x4ff3c3);_0x30bf63&&await this[_0x3b617b(0x150)](_0x4ff3c3);}catch(_0xf6da4d){}}}catch(_0x26dcf8){}}async[a0_0x567e26(0x174)](){const _0x22c1f6=a0_0x567e26;try{const _0x11a773=await this[_0x22c1f6(0x182)](_0x22c1f6(0x114));_0x11a773&&_0x11a773[_0x22c1f6(0x187)]&&(this[_0x22c1f6(0xcb)]=JSON[_0x22c1f6(0x1ad)](_0x11a773['val']['toString']()));}catch(_0x36bcbd){this[_0x22c1f6(0xcb)]=[];}try{const _0x4edd44=await this[_0x22c1f6(0x182)](_0x22c1f6(0x186));if(_0x4edd44&&_0x4edd44[_0x22c1f6(0x187)])this[_0x22c1f6(0x12b)]=JSON[_0x22c1f6(0x1ad)](_0x4edd44[_0x22c1f6(0x187)][_0x22c1f6(0xa4)]());}catch(_0x447295){this[_0x22c1f6(0x12b)]=[];}}async['initSystemConfig'](){const _0x2ec544=a0_0x567e26;try{const _0x43b778=await this[_0x2ec544(0x20b)]('system.config');_0x43b778&&_0x43b778[_0x2ec544(0x1ef)]&&(this[_0x2ec544(0x126)]={'latitude':_0x43b778[_0x2ec544(0x1ef)][_0x2ec544(0x1e9)]||0x0,'longitude':_0x43b778[_0x2ec544(0x1ef)]['longitude']||0x0,'city':_0x43b778['common'][_0x2ec544(0x1ce)]||''});}catch(_0x270970){}}async[a0_0x567e26(0x204)](_0x365a78){const _0x2a2539=a0_0x567e26;if(!_0x365a78)return![];this[_0x2a2539(0x21d)]=await this['getSystemUUID']();if(_0x365a78===_0x2a2539(0x107)||_0x365a78['startsWith'](_0x2a2539(0x9f)))return!![];return![];}async[a0_0x567e26(0xc8)](){const _0x5e47ae=a0_0x567e26;try{const _0xed2a4b=await this['getForeignObjectAsync'](_0x5e47ae(0xfa));if(_0xed2a4b&&_0xed2a4b[_0x5e47ae(0x1e3)]&&_0xed2a4b[_0x5e47ae(0x1e3)][_0x5e47ae(0x1d4)])return _0xed2a4b['native']['uuid'];return _0x5e47ae(0x195);}catch(_0xb78a3a){return _0x5e47ae(0x19d);}}async[a0_0x567e26(0x9c)](){const _0x70f56b=a0_0x567e26;try{await this[_0x70f56b(0xd4)](),await this[_0x70f56b(0x1aa)]('system.isPresent',{'type':_0x70f56b(0x1f0),'common':{'name':_0x70f56b(0x16c),'type':_0x70f56b(0x17c),'role':_0x70f56b(0xed),'read':!![],'write':![],'def':!![]},'native':{}}),await this[_0x70f56b(0x1aa)](_0x70f56b(0x10c),{'type':_0x70f56b(0x1f0),'common':{'name':_0x70f56b(0xb3),'type':_0x70f56b(0xfd),'role':'json','read':!![],'write':![]},'native':{}}),await this[_0x70f56b(0x1aa)](_0x70f56b(0x114),{'type':'state','common':{'name':_0x70f56b(0x205),'type':_0x70f56b(0xfd),'role':_0x70f56b(0x134),'read':!![],'write':![]},'native':{}}),await this[_0x70f56b(0x1aa)](_0x70f56b(0x16d),{'type':'state','common':{'name':_0x70f56b(0x197),'type':_0x70f56b(0x17c),'role':'button','read':!![],'write':!![],'def':![]},'native':{}}),await this[_0x70f56b(0x1aa)](_0x70f56b(0x118),{'type':_0x70f56b(0x1f0),'common':{'name':_0x70f56b(0xae),'type':_0x70f56b(0x17c),'role':_0x70f56b(0xbd),'read':!![],'write':!![],'def':![]},'native':{}}),await this[_0x70f56b(0x1aa)]('analysis.lastResult',{'type':_0x70f56b(0x1f0),'common':{'name':_0x70f56b(0x1b7),'type':_0x70f56b(0xfd),'role':_0x70f56b(0x134),'read':!![],'write':![]},'native':{}}),await this[_0x70f56b(0x1aa)](_0x70f56b(0xd0),{'type':'state','common':{'name':_0x70f56b(0xe0),'type':_0x70f56b(0x17c),'role':_0x70f56b(0xc1),'read':!![],'write':![],'def':![]},'native':{}}),await this['setObjectNotExistsAsync'](_0x70f56b(0x1fd),{'type':_0x70f56b(0x1f0),'common':{'name':'AI\x20Emergency\x20Status','type':'boolean','role':'indicator.alarm.fire','read':!![],'write':![],'def':![]},'native':{}}),await this[_0x70f56b(0x1aa)](_0x70f56b(0x156),{'type':_0x70f56b(0x1f0),'common':{'name':_0x70f56b(0x20e),'type':_0x70f56b(0xfd),'role':_0x70f56b(0xa1),'read':!![],'write':![]},'native':{}}),await this[_0x70f56b(0x1aa)](_0x70f56b(0x1c0),{'type':_0x70f56b(0x1f0),'common':{'name':_0x70f56b(0xdd),'type':'string','role':_0x70f56b(0x119),'read':!![],'write':![]},'native':{}}),await this[_0x70f56b(0x1aa)]('analysis.deviationFromBaseline',{'type':_0x70f56b(0x1f0),'common':{'name':_0x70f56b(0x11d),'type':_0x70f56b(0xfd),'role':_0x70f56b(0x1f0),'read':!![],'write':![],'def':_0x70f56b(0x1ee)},'native':{}}),await this[_0x70f56b(0x1aa)](_0x70f56b(0xab),{'type':_0x70f56b(0x1f0),'common':{'name':_0x70f56b(0x206),'type':_0x70f56b(0xfd),'role':_0x70f56b(0x119),'read':!![],'write':![]},'native':{}}),await this['setObjectNotExistsAsync']('analysis.comfortSuggestion',{'type':_0x70f56b(0x1f0),'common':{'name':_0x70f56b(0x14a),'type':_0x70f56b(0xfd),'role':_0x70f56b(0x119),'read':!![],'write':![]},'native':{}}),await this[_0x70f56b(0x1b2)]('analysis.automation',{'type':'channel','common':{'name':_0x70f56b(0x21c)},'native':{}}),await this['setObjectNotExistsAsync']('analysis.automation.patternDetected',{'type':_0x70f56b(0x1f0),'common':{'name':_0x70f56b(0x13b),'type':_0x70f56b(0x17c),'role':_0x70f56b(0xed),'read':!![],'write':![],'def':![]},'native':{}}),await this[_0x70f56b(0x1aa)]('analysis.automation.description',{'type':'state','common':{'name':_0x70f56b(0x136),'type':_0x70f56b(0xfd),'role':'text','read':!![],'write':![]},'native':{}}),await this[_0x70f56b(0x1aa)]('analysis.automation.suggestedAction',{'type':'state','common':{'name':_0x70f56b(0x1d3),'type':'string','role':_0x70f56b(0x119),'read':!![],'write':![]},'native':{}}),await this[_0x70f56b(0x1aa)](_0x70f56b(0x186),{'type':_0x70f56b(0x1f0),'common':{'name':_0x70f56b(0xd3),'type':_0x70f56b(0xfd),'role':_0x70f56b(0x134),'read':!![],'write':![],'def':'[]'},'native':{}}),await this[_0x70f56b(0x1aa)](_0x70f56b(0x173),{'type':_0x70f56b(0x1f0),'common':{'name':_0x70f56b(0x109),'type':_0x70f56b(0xfd),'role':'json','read':!![],'write':![],'def':'[]'},'native':{}}),await this[_0x70f56b(0x1b2)](_0x70f56b(0x180),{'type':_0x70f56b(0x19f),'common':{'name':'Health\x20&\x20Sleep\x20Analysis'},'native':{}}),await this[_0x70f56b(0x1aa)](_0x70f56b(0xec),{'type':_0x70f56b(0x1f0),'common':{'name':_0x70f56b(0x10f),'type':_0x70f56b(0xbe),'role':_0x70f56b(0x138),'read':!![],'write':![],'def':0x0},'native':{}}),await this['setObjectNotExistsAsync']('analysis.health.restlessness',{'type':_0x70f56b(0x1f0),'common':{'name':'Restlessness\x20Level','type':'string','role':_0x70f56b(0x119),'read':!![],'write':![],'def':_0x70f56b(0x8f)},'native':{}}),await this[_0x70f56b(0x1aa)](_0x70f56b(0x102),{'type':'state','common':{'name':'Health\x20Notes','type':'string','role':_0x70f56b(0x119),'read':!![],'write':![],'def':''},'native':{}}),await this[_0x70f56b(0xd1)](),await this['checkLtmDriftObjects']();}catch(_0x380c04){this[_0x70f56b(0x146)][_0x70f56b(0x1d2)](_0x70f56b(0x162)+_0x380c04[_0x70f56b(0x9a)]);}}async[a0_0x567e26(0xd4)](){const _0x5c572b=a0_0x567e26;await this[_0x5c572b(0x1b2)](_0x5c572b(0xdc),{'type':'channel','common':{'name':_0x5c572b(0x1ed)},'native':{}}),await this[_0x5c572b(0x1b2)](SYSTEM_DP_MODE,{'type':_0x5c572b(0x1f0),'common':{'name':_0x5c572b(0x20f),'type':_0x5c572b(0xfd),'role':_0x5c572b(0x1f0),'read':!![],'write':!![],'def':SYSTEM_MODES['NORMAL'],'states':{[SYSTEM_MODES[_0x5c572b(0x1d9)]]:_0x5c572b(0xa3),[SYSTEM_MODES[_0x5c572b(0x1c2)]]:_0x5c572b(0x14b),[SYSTEM_MODES[_0x5c572b(0xe8)]]:'Party',[SYSTEM_MODES['GUEST']]:_0x5c572b(0x10a)}},'native':{}});}async['checkLtmObjects'](){const _0xd665a8=a0_0x567e26;await this[_0xd665a8(0x1b2)]('LTM',{'type':_0xd665a8(0x19f),'common':{'name':'LTM'},'native':{}}),await this[_0xd665a8(0x1b2)](LTM_DP_RAW_LOG,{'type':_0xd665a8(0x1f0),'common':{'name':_0xd665a8(0x1b3),'type':_0xd665a8(0xfd),'role':_0xd665a8(0x134),'read':!![],'write':![]},'native':{}}),await this[_0xd665a8(0x1b2)](LTM_DP_DAILY_DIGESTS,{'type':_0xd665a8(0x1f0),'common':{'name':'Daily\x20Digests','type':_0xd665a8(0xfd),'role':'json','read':!![],'write':![]},'native':{}}),await this[_0xd665a8(0x1b2)](LTM_DP_STATUS,{'type':_0xd665a8(0x1f0),'common':{'name':_0xd665a8(0x213),'type':'string','role':_0xd665a8(0x119),'read':!![],'write':![]},'native':{}}),await this[_0xd665a8(0x1b2)](LTM_DP_TRIGGER_DIGEST,{'type':_0xd665a8(0x1f0),'common':{'name':_0xd665a8(0xb9),'type':_0xd665a8(0x17c),'role':_0xd665a8(0xbd),'read':!![],'write':!![],'def':![]},'native':{}}),await this[_0xd665a8(0x1b2)](LTM_DP_BASELINE_STATUS,{'type':'state','common':{'name':_0xd665a8(0x18a),'type':'string','role':'text','read':!![],'write':![]},'native':{}});}async['checkLtmDriftObjects'](){const _0x5b617a=a0_0x567e26;await this['extendObjectAsync'](LTM_DP_DRIFT_CHANNEL,{'type':_0x5b617a(0x19f),'common':{'name':_0x5b617a(0x13e)},'native':{}}),await this['extendObjectAsync'](LTM_DP_DRIFT_STATUS,{'type':_0x5b617a(0x1f0),'common':{'name':_0x5b617a(0xf1),'type':_0x5b617a(0xfd),'role':_0x5b617a(0x1f0),'read':!![],'write':![],'def':'N/A'},'native':{}}),await this['extendObjectAsync'](LTM_DP_DRIFT_DETAILS,{'type':_0x5b617a(0x1f0),'common':{'name':'Drift\x20Details','type':_0x5b617a(0xfd),'role':_0x5b617a(0x119),'read':!![],'write':![]},'native':{}}),await this[_0x5b617a(0x1b2)](LTM_DP_DRIFT_LAST_CHECK,{'type':_0x5b617a(0x1f0),'common':{'name':'Last\x20Check','type':_0x5b617a(0xbe),'role':_0x5b617a(0x217),'read':!![],'write':![]},'native':{}});}async[a0_0x567e26(0xc3)](){const _0x53523f=a0_0x567e26;try{const _0xf87851=await this[_0x53523f(0x182)](SYSTEM_DP_MODE);_0xf87851&&_0xf87851['val']&&Object[_0x53523f(0x98)](SYSTEM_MODES)[_0x53523f(0x21b)](_0xf87851[_0x53523f(0x187)])?this['currentSystemMode']=_0xf87851[_0x53523f(0x187)]:(this[_0x53523f(0x21e)]=SYSTEM_MODES[_0x53523f(0x1d9)],await this[_0x53523f(0x1e8)](SYSTEM_DP_MODE,{'val':SYSTEM_MODES[_0x53523f(0x1d9)],'ack':!![]}));}catch(_0x5ef9ca){this[_0x53523f(0x21e)]=SYSTEM_MODES[_0x53523f(0x1d9)];}}async[a0_0x567e26(0x86)](){const _0x784b93=a0_0x567e26;try{const _0x26ba21=await this[_0x784b93(0x182)](LTM_DP_RAW_LOG);if(_0x26ba21&&_0x26ba21[_0x784b93(0x187)])this[_0x784b93(0x210)]=JSON[_0x784b93(0x1ad)](_0x26ba21['val']);}catch(_0x2b1dca){this[_0x784b93(0x210)]=[];}}async[a0_0x567e26(0xe5)](){const _0x59625a=a0_0x567e26;try{const _0x217e06=await this[_0x59625a(0x182)](LTM_DP_DAILY_DIGESTS);if(_0x217e06&&_0x217e06['val'])this[_0x59625a(0xaf)]=JSON[_0x59625a(0x1ad)](_0x217e06[_0x59625a(0x187)]);}catch(_0x3f3deb){this[_0x59625a(0xaf)]=[];}await this[_0x59625a(0xbc)]();}async[a0_0x567e26(0x96)](){const _0x121d82=a0_0x567e26;this[_0x121d82(0x210)][_0x121d82(0x221)]>RAW_LOG_MAX_SIZE&&this[_0x121d82(0x210)]['splice'](0x0,this[_0x121d82(0x210)][_0x121d82(0x221)]-RAW_LOG_MAX_SIZE),await this[_0x121d82(0x1e8)](LTM_DP_RAW_LOG,{'val':JSON[_0x121d82(0xfc)](this[_0x121d82(0x210)]),'ack':!![]});}async['saveDailyDigests'](_0x38da29=!![]){const _0x8e9d2f=a0_0x567e26,_0x4909eb=this[_0x8e9d2f(0xcf)]['ltmLtbWindowDays']||0x3c;this[_0x8e9d2f(0xaf)][_0x8e9d2f(0x221)]>_0x4909eb&&this[_0x8e9d2f(0xaf)][_0x8e9d2f(0x1b6)](0x0,this[_0x8e9d2f(0xaf)]['length']-_0x4909eb);await this['setStateAsync'](LTM_DP_DAILY_DIGESTS,{'val':JSON['stringify'](this['dailyDigests']),'ack':!![]});if(_0x38da29)await this['updateBaselineStatus']();}async[a0_0x567e26(0xb1)](_0x530faf){const _0x4e689a=a0_0x567e26;this['analysisHistory'][_0x4e689a(0x209)](_0x530faf);if(this[_0x4e689a(0x12b)][_0x4e689a(0x221)]>ANALYSIS_HISTORY_MAX_SIZE)this['analysisHistory']['pop']();await this['setStateAsync'](_0x4e689a(0x186),{'val':JSON[_0x4e689a(0xfc)](this[_0x4e689a(0x12b)]),'ack':!![]});}async[a0_0x567e26(0xbc)](){const _0x4e23cb=a0_0x567e26;if(!this['isProVersion']){await this[_0x4e23cb(0x1e8)](LTM_DP_BASELINE_STATUS,{'val':_0x4e23cb(0x12e),'ack':!![]});return;}const _0x91e018=this[_0x4e23cb(0xaf)][_0x4e23cb(0x221)]>=(this[_0x4e23cb(0xcf)][_0x4e23cb(0x143)]||0x7)?_0x4e23cb(0xbf)+this['dailyDigests']['length']+_0x4e23cb(0x191):'Lernphase\x20('+this[_0x4e23cb(0xaf)][_0x4e23cb(0x221)]+'/'+(this['config']['minDaysForBaseline']||0x7)+')';await this[_0x4e23cb(0x1e8)](LTM_DP_BASELINE_STATUS,{'val':_0x91e018,'ack':!![]});}async[a0_0x567e26(0x1cc)](){const _0x38f366=a0_0x567e26,_0x42b055=this[_0x38f366(0xcf)][_0x38f366(0xdf)];if(_0x42b055&&_0x42b055[_0x38f366(0x221)]>0x0){this[_0x38f366(0x146)]['info'](_0x38f366(0x151)+_0x42b055[_0x38f366(0x221)]+_0x38f366(0xee));for(const _0x579e2e of _0x42b055){if(_0x579e2e['id']){await this[_0x38f366(0x108)](_0x579e2e['id']);try{const _0x365e4a=await this[_0x38f366(0x1ba)](_0x579e2e['id']);if(_0x365e4a)this[_0x38f366(0x1d7)][_0x579e2e['id']]=_0x365e4a[_0x38f366(0x187)];}catch(_0x271f02){}}}}}async[a0_0x567e26(0x99)](){const _0x57ad29=a0_0x567e26,_0x5c9d36=this['config'][_0x57ad29(0xa8)]||[];if(_0x5c9d36[_0x57ad29(0x221)]>0x0){this['log']['info']('Subscribing\x20to\x20'+_0x5c9d36['length']+_0x57ad29(0x131));for(const _0x5eb5e9 of _0x5c9d36){await this[_0x57ad29(0x108)](_0x5eb5e9);}try{await this[_0x57ad29(0x19b)]();}catch(_0x5a8cfc){}}}async[a0_0x567e26(0x1f8)](){const _0xf3158e=a0_0x567e26;try{if(!this['config']['useWeather'])return _0xf3158e(0x144);let _0x1aad7d='';const _0x2cdb62=this[_0xf3158e(0xcf)][_0xf3158e(0x181)];if(_0x2cdb62)try{if(_0x2cdb62[_0xf3158e(0x21b)]('accuweather')){const _0x473a6e=await this[_0xf3158e(0x1ba)](_0x2cdb62+'.Summary.Current');if(_0x473a6e&&_0x473a6e['val'])_0x1aad7d=_0x473a6e[_0xf3158e(0x187)];}else{if(_0x2cdb62[_0xf3158e(0x21b)](_0xf3158e(0x1dc))){const _0x43f1ef=await this['getForeignStateAsync'](_0x2cdb62+'.NextHours.Location_1.Day_1.current.symbol_desc');if(_0x43f1ef&&_0x43f1ef[_0xf3158e(0x187)])_0x1aad7d=_0x43f1ef[_0xf3158e(0x187)];}else{if(_0x2cdb62[_0xf3158e(0x21b)](_0xf3158e(0x95))){const _0x2e794c=await this['getForeignStateAsync'](_0x2cdb62+_0xf3158e(0xa2));if(_0x2e794c&&_0x2e794c[_0xf3158e(0x187)])_0x1aad7d=_0x2e794c[_0xf3158e(0x187)];}}}}catch(_0x2a7d2a){}if(!_0x1aad7d){const _0x13fb1e=['accuweather.0',_0xf3158e(0x13c),_0xf3158e(0xc6),_0xf3158e(0xd7)];for(const _0x24cebc of _0x13fb1e){try{const _0x908c0f=await this[_0xf3158e(0x20b)](_0x24cebc);if(_0x908c0f){if(_0x24cebc['includes'](_0xf3158e(0xf5))){const _0x41fb51=await this[_0xf3158e(0x1ba)](_0x24cebc+_0xf3158e(0x1a1));if(_0x41fb51&&_0x41fb51[_0xf3158e(0x187)]){_0x1aad7d=_0x41fb51[_0xf3158e(0x187)];break;}}}}catch(_0x166142){}}}return _0x1aad7d?'WETTER:\x20'+_0x1aad7d:_0xf3158e(0x104);}catch(_0x167a56){return _0xf3158e(0x1d8)+_0x167a56[_0xf3158e(0x9a)];}}async['getCalendarContext'](){const _0x346b40=a0_0x567e26;try{if(!this['config'][_0x346b40(0xe7)])return'Kalender:\x20Deaktiviert';let _0x5aa195=this['config']['calendarInstance']||_0x346b40(0x19c),_0x2a2564=this[_0x346b40(0xcf)][_0x346b40(0xa5)]||[];if(typeof _0x2a2564===_0x346b40(0xfd))_0x2a2564=_0x2a2564[_0x346b40(0xc4)](',');try{const _0x195f5a=await this[_0x346b40(0x1ba)](_0x5aa195+_0x346b40(0x1ff));if(_0x195f5a&&_0x195f5a[_0x346b40(0x187)]){let _0x3d0909=this[_0x346b40(0x12c)](_0x195f5a[_0x346b40(0x187)]);if(_0x3d0909&&Array[_0x346b40(0xda)](_0x3d0909)){if(_0x2a2564[_0x346b40(0x221)]>0x0)_0x3d0909=_0x3d0909['filter'](_0xdf3f2d=>_0x2a2564[_0x346b40(0x21b)](_0xdf3f2d[_0x346b40(0x8e)]||''));else return _0x346b40(0x199);if(_0x3d0909[_0x346b40(0x221)]>0x0){const _0xcbeae9=_0x3d0909[_0x346b40(0xde)](0x0,0x3)['map'](_0x8344b3=>{const _0x3d7826=_0x346b40;let _0x756873=_0x8344b3['date'];if(_0x8344b3[_0x3d7826(0x1eb)])_0x756873+='\x20'+_0x8344b3[_0x3d7826(0x1eb)];return _0x756873+':\x20'+_0x8344b3['event']+'\x20('+_0x8344b3['_calName']+')';});return _0x346b40(0x218)+_0xcbeae9[_0x346b40(0x185)](_0x346b40(0x10b));}else return _0x346b40(0xf9);}}}catch(_0x37edad){this['log'][_0x346b40(0xc5)](_0x346b40(0xd2)+_0x37edad[_0x346b40(0x9a)]);}return'KALENDER:\x20Keine\x20Daten';}catch(_0x222b06){return _0x346b40(0xd6)+_0x222b06[_0x346b40(0x9a)];}}async[a0_0x567e26(0x154)](_0x3eb3c8){const _0x232e64=a0_0x567e26;try{const _0x58fa30=await this[_0x232e64(0x1ba)](_0x3eb3c8+'.data.table');if(_0x58fa30&&_0x58fa30[_0x232e64(0x187)]){const _0x2e3dd7=this[_0x232e64(0x12c)](_0x58fa30[_0x232e64(0x187)]);if(_0x2e3dd7&&Array[_0x232e64(0xda)](_0x2e3dd7)){const _0x5ce2c9=[...new Set(_0x2e3dd7[_0x232e64(0x198)](_0x40254f=>_0x40254f[_0x232e64(0x8e)])[_0x232e64(0xc0)](Boolean))];return _0x5ce2c9[_0x232e64(0x13d)]();}}return[];}catch(_0x54edb0){return this[_0x232e64(0x146)][_0x232e64(0x1d2)](_0x232e64(0x1ac)+_0x54edb0[_0x232e64(0x9a)]),[];}}async['checkWifiPresence'](){const _0xf3e7ba=a0_0x567e26;try{const _0x57b4e8=this['config'][_0xf3e7ba(0xa8)]||[];let _0x5c4b7d=![];for(const _0x1b565a of _0x57b4e8){try{const _0x5b4f51=await this[_0xf3e7ba(0x1ba)](_0x1b565a);if(_0x5b4f51&&(_0x5b4f51[_0xf3e7ba(0x187)]===!![]||_0x5b4f51['val']===_0xf3e7ba(0x1c7)||_0x5b4f51[_0xf3e7ba(0x187)]===0x1)){_0x5c4b7d=!![];break;}}catch(_0x2191ad){}}return _0x5c4b7d&&(this[_0xf3e7ba(0xf3)]&&(this[_0xf3e7ba(0x146)][_0xf3e7ba(0x1d6)](_0xf3e7ba(0x1f3)),this['abortExitTimer']()),!this['isPresent']&&this['currentSystemMode']===SYSTEM_MODES['NORMAL']&&await this['setPresence'](!![])),_0x5c4b7d;}catch(_0xb2b8fb){return this['log'][_0xf3e7ba(0x1d2)](_0xf3e7ba(0x1b0)+_0xb2b8fb[_0xf3e7ba(0x9a)]),![];}}[a0_0x567e26(0x1de)](){const _0x42a7c4=a0_0x567e26;this[_0x42a7c4(0x157)](),this[_0x42a7c4(0x1f1)]=!![],this[_0x42a7c4(0x91)]=setTimeout(()=>{const _0x3f7eb2=_0x42a7c4;this[_0x3f7eb2(0x1f1)]=![];},EXIT_GRACE_PERIOD_SECONDS*0x3e8),this[_0x42a7c4(0xf3)]=setTimeout(()=>{const _0x4f990f=_0x42a7c4;this[_0x4f990f(0x153)](![]),this[_0x4f990f(0xf3)]=null;},EXIT_TIMER_MINUTES*0x3c*0x3e8);}['abortExitTimer'](){const _0x104db9=a0_0x567e26;if(this['exitTimer'])clearTimeout(this[_0x104db9(0xf3)]);if(this[_0x104db9(0x91)])clearTimeout(this[_0x104db9(0x91)]);this[_0x104db9(0xf3)]=null,this[_0x104db9(0x91)]=null,this[_0x104db9(0x1f1)]=![];}async['setPresence'](_0x26c364){const _0x5380d5=a0_0x567e26;if(this[_0x5380d5(0x106)]===_0x26c364)return;this[_0x5380d5(0x106)]=_0x26c364,await this['setStateAsync'](_0x5380d5(0x1df),{'val':_0x26c364,'ack':!![]});}async[a0_0x567e26(0x15a)](_0x567ab2){const _0xc15693=a0_0x567e26;this['log'][_0xc15693(0x1d6)](_0xc15693(0x1c9)+JSON[_0xc15693(0xfc)](_0x567ab2));}async[a0_0x567e26(0x10e)](){const _0x484c2b=a0_0x567e26;if(!this[_0x484c2b(0x1b4)]||!this[_0x484c2b(0xba)])return;const _0x5b92d5=this[_0x484c2b(0xcf)]['ltmStbWindowDays']||0xe;if(this[_0x484c2b(0xaf)][_0x484c2b(0x221)]<_0x5b92d5+(this['config'][_0x484c2b(0x143)]||0x7)){await this['setStateAsync'](LTM_DP_DRIFT_STATUS,{'val':'N/A\x20(Learning)','ack':!![]});return;}const _0x2e05a6=this[_0x484c2b(0xaf)][_0x484c2b(0xde)](-_0x5b92d5),_0xb9e605=this['dailyDigests']['slice'](0x0,this['dailyDigests']['length']-_0x5b92d5),_0x4a33f5=_0x484c2b(0x1c5)+JSON[_0x484c2b(0xfc)](_0xb9e605)+'\x0a\x0aA\x20(STB):\x0a'+JSON['stringify'](_0x2e05a6);try{const _0x3e291a=await this[_0x484c2b(0xba)][_0x484c2b(0x1c3)](_0x4a33f5),_0x1d0b29=JSON[_0x484c2b(0x1ad)](_0x3e291a[_0x484c2b(0x115)][_0x484c2b(0x119)]()[_0x484c2b(0x1fc)](/```json|```/g,'')[_0x484c2b(0xe6)]());_0x1d0b29[_0x484c2b(0x113)]&&(await this[_0x484c2b(0x1e8)](LTM_DP_DRIFT_STATUS,{'val':_0x1d0b29[_0x484c2b(0x113)],'ack':!![]}),await this[_0x484c2b(0x1e8)](LTM_DP_DRIFT_DETAILS,{'val':_0x1d0b29[_0x484c2b(0x202)],'ack':!![]}),await this['setStateAsync'](LTM_DP_DRIFT_LAST_CHECK,{'val':Date[_0x484c2b(0xaa)](),'ack':!![]}));}catch(_0x155ea9){}}[a0_0x567e26(0x170)](){const _0x1711be=a0_0x567e26;try{if(this[_0x1711be(0xe1)])this[_0x1711be(0xe1)][_0x1711be(0x122)]();if(!this[_0x1711be(0x1b4)]){this[_0x1711be(0x1e8)](LTM_DP_STATUS,{'val':_0x1711be(0x12e),'ack':!![]});return;}this['ltmJob']=schedule[_0x1711be(0xe4)](LTM_SCHEDULE,()=>this[_0x1711be(0x135)]());}catch(_0x20759d){this[_0x1711be(0x146)][_0x1711be(0x1d2)](_0x1711be(0x1d1)+_0x20759d['message']);}}[a0_0x567e26(0x1e0)](){const _0x1f61a7=a0_0x567e26;try{if(this[_0x1f61a7(0xce)])this[_0x1f61a7(0xce)]['cancel']();this[_0x1f61a7(0xce)]=schedule[_0x1f61a7(0xe4)](MODE_RESET_SCHEDULE,async()=>{const _0x550f06=_0x1f61a7;await this['loadSystemMode'](),AUTO_RESET_MODES[_0x550f06(0x21b)](this[_0x550f06(0x21e)])&&await this[_0x550f06(0x1e8)](SYSTEM_DP_MODE,{'val':SYSTEM_MODES[_0x550f06(0x1d9)],'ack':![]});});}catch(_0x595cb0){this[_0x1f61a7(0x146)][_0x1f61a7(0x1d2)](_0x1f61a7(0xa6)+_0x595cb0[_0x1f61a7(0x9a)]);}}[a0_0x567e26(0x1d5)](){const _0x29597f=a0_0x567e26;try{if(this['driftAnalysisTimer'])clearInterval(this[_0x29597f(0xa7)]);if(!this[_0x29597f(0x1b4)])return;this[_0x29597f(0xa7)]=setInterval(()=>this[_0x29597f(0x10e)](),(this[_0x29597f(0xcf)][_0x29597f(0xb2)]||0x18)*0x36ee80),setTimeout(()=>this[_0x29597f(0x10e)](),0x1388);}catch(_0x6c3175){this[_0x29597f(0x146)][_0x29597f(0x1d2)](_0x29597f(0x1cf)+_0x6c3175[_0x29597f(0x9a)]);}}[a0_0x567e26(0x183)](){const _0x51f302=a0_0x567e26;try{if(this['briefingJob'])this[_0x51f302(0x1a6)][_0x51f302(0x122)]();if(!this[_0x51f302(0xcf)][_0x51f302(0x148)])return;const _0x550a82=(this[_0x51f302(0xcf)]['briefingTime']||'08:00')[_0x51f302(0xc4)](':'),_0x3277e0=parseInt(_0x550a82[0x0])||0x8,_0x447b1e=parseInt(_0x550a82[0x1])||0x0,_0x57c3df=_0x447b1e+'\x20'+_0x3277e0+_0x51f302(0x16a);this[_0x51f302(0x146)][_0x51f302(0x1d6)](_0x51f302(0xb4)+_0x3277e0+':'+(_0x447b1e<0xa?'0'+_0x447b1e:_0x447b1e)),this[_0x51f302(0x1a6)]=schedule[_0x51f302(0xe4)](_0x57c3df,()=>{const _0x55cedf=_0x51f302;this[_0x55cedf(0x184)]();});}catch(_0x2ed270){this[_0x51f302(0x146)][_0x51f302(0x1d2)]('Briefing\x20Sched\x20Error:\x20'+_0x2ed270[_0x51f302(0x9a)]);}}async[a0_0x567e26(0x216)](_0x4c05dc,_0x30daff=![],_0x92ca7=![]){const _0x952e97=a0_0x567e26;this[_0x952e97(0x146)][_0x952e97(0x1d6)]((_0x30daff?'[TEST]\x20':'')+_0x952e97(0x1a9)+_0x4c05dc+'\x22'+(_0x92ca7?_0x952e97(0xef):''));const _0x512bf7=this[_0x952e97(0xcf)];let _0x587dd8=0x0;_0x512bf7['notifyTelegramEnabled']&&_0x512bf7[_0x952e97(0x1a0)]&&(await this[_0x952e97(0x19a)](_0x512bf7[_0x952e97(0x1a0)],_0x952e97(0x121),{'text':_0x4c05dc,'user':_0x512bf7['notifyTelegramRecipient']}),_0x587dd8++);if(_0x512bf7[_0x952e97(0x1ea)]&&_0x512bf7['notifyPushoverInstance']){let _0x244840={'message':_0x4c05dc,'title':_0x92ca7?'üö®\x20EMERGENCY':'Cogni-Living\x20Alert','priority':_0x92ca7?0x2:0x1,'device':_0x512bf7[_0x952e97(0x14f)]};_0x92ca7&&(_0x244840[_0x952e97(0x16b)]=0x1e,_0x244840['expire']=0xe10,_0x244840['sound']='siren'),await this[_0x952e97(0x19a)](_0x512bf7['notifyPushoverInstance'],_0x952e97(0x121),_0x244840),_0x587dd8++;}return _0x512bf7[_0x952e97(0x142)]&&_0x512bf7[_0x952e97(0x155)]&&(await this[_0x952e97(0x19a)](_0x512bf7[_0x952e97(0x155)],_0x952e97(0x121),{'text':_0x4c05dc,'to':_0x512bf7[_0x952e97(0x175)]}),_0x587dd8++),_0x512bf7[_0x952e97(0x93)]&&_0x512bf7[_0x952e97(0x17a)]&&(await this[_0x952e97(0x19a)](_0x512bf7[_0x952e97(0x17a)],_0x952e97(0x121),{'text':_0x4c05dc,'phone':_0x512bf7[_0x952e97(0x116)]}),_0x587dd8++),_0x512bf7[_0x952e97(0x1fe)]&&_0x512bf7[_0x952e97(0xc9)]&&(await this[_0x952e97(0x19a)](_0x512bf7['notifySignalInstance'],_0x952e97(0x121),{'text':_0x4c05dc,'phone':_0x512bf7[_0x952e97(0x149)]}),_0x587dd8++),_0x587dd8;}}if(require[a0_0x567e26(0x20c)]!==module)module[a0_0x567e26(0x10d)]=_0xfe332f=>new CogniLiving(_0xfe332f);else new CogniLiving();