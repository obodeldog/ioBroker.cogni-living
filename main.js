const a0_0x4c9e73=a0_0x32b9;(function(_0xafb513,_0x39fd42){const _0x49e22b=a0_0x32b9,_0x1c3ec6=_0xafb513();while(!![]){try{const _0x57a448=-parseInt(_0x49e22b(0x1fe))/0x1+parseInt(_0x49e22b(0x223))/0x2*(parseInt(_0x49e22b(0x1c1))/0x3)+-parseInt(_0x49e22b(0x15e))/0x4*(parseInt(_0x49e22b(0x194))/0x5)+parseInt(_0x49e22b(0x1b2))/0x6*(-parseInt(_0x49e22b(0x136))/0x7)+-parseInt(_0x49e22b(0x19c))/0x8*(parseInt(_0x49e22b(0x131))/0x9)+-parseInt(_0x49e22b(0x1f8))/0xa+-parseInt(_0x49e22b(0x185))/0xb*(-parseInt(_0x49e22b(0x1ae))/0xc);if(_0x57a448===_0x39fd42)break;else _0x1c3ec6['push'](_0x1c3ec6['shift']());}catch(_0x170478){_0x1c3ec6['push'](_0x1c3ec6['shift']());}}}(a0_0x2a5f,0x2c52c));const a0_0x12a10e=(function(){let _0x491940=!![];return function(_0x587cfb,_0x372c24){const _0x5acb77=_0x491940?function(){const _0x484cba=a0_0x32b9;if(_0x372c24){const _0x58df11=_0x372c24[_0x484cba(0x167)](_0x587cfb,arguments);return _0x372c24=null,_0x58df11;}}:function(){};return _0x491940=![],_0x5acb77;};}()),a0_0x1f2af4=a0_0x12a10e(this,function(){const _0x4ae3aa=a0_0x32b9;return a0_0x1f2af4[_0x4ae3aa(0x1ab)]()[_0x4ae3aa(0x12f)](_0x4ae3aa(0x165))['toString']()[_0x4ae3aa(0x245)](a0_0x1f2af4)[_0x4ae3aa(0x12f)](_0x4ae3aa(0x165));});a0_0x1f2af4();'use strict';const utils=require('@iobroker/adapter-core'),{GoogleGenerativeAI}=require('@google/generative-ai'),schedule=require(a0_0x4c9e73(0x229)),HISTORY_MAX_SIZE=0x32,FEEDBACK_MAX_SIZE=0x14,GEMINI_MODEL=a0_0x4c9e73(0x20d),ANALYSIS_HISTORY_MAX_SIZE=0x64,RAW_LOG_MAX_SIZE=0x5dc,DAILY_DIGEST_MAX_SIZE_LIMIT=0xb4,LTM_MIN_EVENTS_FOR_COMPRESSION=0x5,LTM_SCHEDULE=a0_0x4c9e73(0x133),LTM_DP_RAW_LOG=a0_0x4c9e73(0x196),LTM_DP_DAILY_DIGESTS=a0_0x4c9e73(0x1bc),LTM_DP_STATUS=a0_0x4c9e73(0x15d),LTM_DP_TRIGGER_DIGEST=a0_0x4c9e73(0x1c8),LTM_DP_BASELINE_STATUS=a0_0x4c9e73(0x226),LTM_DP_DRIFT_CHANNEL='LTM.driftAnalysis',LTM_DP_DRIFT_STATUS=a0_0x4c9e73(0x23b),LTM_DP_DRIFT_DETAILS=a0_0x4c9e73(0x18a),LTM_DP_DRIFT_LAST_CHECK=a0_0x4c9e73(0x27a),SYSTEM_DP_MODE=a0_0x4c9e73(0x1c2),MODE_RESET_SCHEDULE=a0_0x4c9e73(0x130),SYSTEM_MODES={'NORMAL':a0_0x4c9e73(0x15f),'VACATION':a0_0x4c9e73(0x204),'PARTY':a0_0x4c9e73(0x210),'GUEST':a0_0x4c9e73(0x14e)},AUTO_RESET_MODES=[SYSTEM_MODES[a0_0x4c9e73(0x173)],SYSTEM_MODES[a0_0x4c9e73(0x20b)]],EXIT_TIMER_MINUTES=0xf,EXIT_GRACE_PERIOD_SECONDS=0x1e,PERSONA_MAPPING={'generic':a0_0x4c9e73(0x1c9),'senior_aal':a0_0x4c9e73(0x25b),'family':a0_0x4c9e73(0x239),'single_comfort':a0_0x4c9e73(0x217),'security':'PRIORIT√ÑT:\x20Sicherheit.\x20Erkenne\x20Eindringlinge,\x20ungew√∂hnliche\x20Anwesenheit.'};function a0_0x32b9(_0x3db26f,_0x44266d){const _0x3a6bb0=a0_0x2a5f();return a0_0x32b9=function(_0x1f2af4,_0x12a10e){_0x1f2af4=_0x1f2af4-0x12a;let _0x2a5f92=_0x3a6bb0[_0x1f2af4];return _0x2a5f92;},a0_0x32b9(_0x3db26f,_0x44266d);}class CogniLiving extends utils['Adapter']{constructor(_0x45f518){const _0x5dec48=a0_0x4c9e73;super({..._0x45f518,'name':'cogni-living'}),this[_0x5dec48(0x1a7)]=[],this[_0x5dec48(0x192)]=[],this['feedbackHistory']=[],this['rawEventLog']=[],this['dailyDigests']=[],this['sensorLastValues']={},this[_0x5dec48(0x13c)]={'latitude':0x0,'longitude':0x0,'city':''},this[_0x5dec48(0x155)]=!![],this[_0x5dec48(0x228)]=null,this[_0x5dec48(0x24f)]=null,this[_0x5dec48(0x157)]=![],this[_0x5dec48(0x1c7)]=null,this[_0x5dec48(0x24e)]=null,this[_0x5dec48(0x154)]=SYSTEM_MODES['NORMAL'],this[_0x5dec48(0x160)]=![],this['lastAlertState']=![],this[_0x5dec48(0x1e3)]='unknown',this[_0x5dec48(0x1bd)]=null,this[_0x5dec48(0x1fd)]=null,this['modeResetJob']=null,this[_0x5dec48(0x24a)]=null,this['on'](_0x5dec48(0x1ac),this[_0x5dec48(0x26f)][_0x5dec48(0x17b)](this)),this['on']('stateChange',this[_0x5dec48(0x277)]['bind'](this)),this['on'](_0x5dec48(0x258),this[_0x5dec48(0x265)][_0x5dec48(0x17b)](this)),this['on']('message',this['onMessage'][_0x5dec48(0x17b)](this));}async[a0_0x4c9e73(0x26f)](){const _0xce4b9c=a0_0x4c9e73;this[_0xce4b9c(0x1f4)][_0xce4b9c(0x193)]('cogni-living\x20adapter\x20starting\x20(v'+this[_0xce4b9c(0x19e)]+')\x20-\x20DEBUG\x20MODE\x20ENABLED'),await this['cleanUpZombies'](),this[_0xce4b9c(0x244)][_0xce4b9c(0x139)]=this[_0xce4b9c(0x244)]['licenseKey']||'',this[_0xce4b9c(0x160)]=await this[_0xce4b9c(0x1c3)](this[_0xce4b9c(0x244)][_0xce4b9c(0x139)]);if(!this[_0xce4b9c(0x244)][_0xce4b9c(0x18c)]||this[_0xce4b9c(0x244)]['inactivityThresholdHours']<0.1)this['config'][_0xce4b9c(0x18c)]=0xc;await this['loadHistoryFromState']();try{const _0x5284ec=await this[_0xce4b9c(0x1dd)](_0xce4b9c(0x141));_0x5284ec&&_0x5284ec['common']&&(this[_0xce4b9c(0x13c)]={'latitude':_0x5284ec[_0xce4b9c(0x19f)][_0xce4b9c(0x147)]||0x0,'longitude':_0x5284ec[_0xce4b9c(0x19f)][_0xce4b9c(0x22e)]||0x0,'city':_0x5284ec[_0xce4b9c(0x19f)][_0xce4b9c(0x158)]||''},this['log'][_0xce4b9c(0x193)](_0xce4b9c(0x132)+this[_0xce4b9c(0x13c)]['city']));}catch(_0x241f06){this[_0xce4b9c(0x1f4)][_0xce4b9c(0x15a)](_0xce4b9c(0x188));}if(this[_0xce4b9c(0x244)][_0xce4b9c(0x151)])try{this[_0xce4b9c(0x1c7)]=new GoogleGenerativeAI(this[_0xce4b9c(0x244)][_0xce4b9c(0x151)]),this[_0xce4b9c(0x24e)]=this[_0xce4b9c(0x1c7)][_0xce4b9c(0x17f)]({'model':GEMINI_MODEL,'generationConfig':{'responseMimeType':_0xce4b9c(0x227)}}),this[_0xce4b9c(0x1f4)]['info'](_0xce4b9c(0x27d));}catch(_0x7682c8){this[_0xce4b9c(0x1f4)][_0xce4b9c(0x1a2)](_0xce4b9c(0x13f)+_0x7682c8[_0xce4b9c(0x1ff)]);}else this['log'][_0xce4b9c(0x15a)](_0xce4b9c(0x25c));await this[_0xce4b9c(0x26b)](),await this[_0xce4b9c(0x206)](),await this[_0xce4b9c(0x190)](),await this[_0xce4b9c(0x214)](),this[_0xce4b9c(0x1a1)](_0xce4b9c(0x248)),this[_0xce4b9c(0x1a1)](LTM_DP_TRIGGER_DIGEST),this[_0xce4b9c(0x1a1)](_0xce4b9c(0x1c2));const _0x1c161b=this[_0xce4b9c(0x244)][_0xce4b9c(0x220)];if(_0x1c161b&&_0x1c161b['length']>0x0){this[_0xce4b9c(0x1f4)][_0xce4b9c(0x193)](_0xce4b9c(0x1d8)+_0x1c161b[_0xce4b9c(0x17c)]+_0xce4b9c(0x1bb));for(const _0x5c92cf of _0x1c161b){if(_0x5c92cf['id']){await this[_0xce4b9c(0x135)](_0x5c92cf['id']);try{const _0x5499e4=await this[_0xce4b9c(0x207)](_0x5c92cf['id']);if(_0x5499e4)this[_0xce4b9c(0x13d)][_0x5c92cf['id']]=_0x5499e4[_0xce4b9c(0x1b8)];}catch(_0x2d0885){}}}}if(this['analysisTimer'])clearInterval(this['analysisTimer']);const _0x3c7259=this[_0xce4b9c(0x244)][_0xce4b9c(0x1b4)]||0xf;_0x3c7259>0x0&&(this[_0xce4b9c(0x1f4)][_0xce4b9c(0x193)]('Starting\x20Autopilot\x20('+_0x3c7259+_0xce4b9c(0x1e0)+this[_0xce4b9c(0x244)][_0xce4b9c(0x18c)]+'h.'),this[_0xce4b9c(0x1bd)]=setInterval(()=>this['runAutopilot'](),_0x3c7259*0x3c*0x3e8)),this[_0xce4b9c(0x222)](),this[_0xce4b9c(0x161)](),this[_0xce4b9c(0x1b7)]();}async[a0_0x4c9e73(0x25e)](){const _0x561ce3=a0_0x4c9e73,_0x1d1688=[_0x561ce3(0x274),'analysis.history_debug_01',_0x561ce3(0x182),'analysis.history_debug_03','analysis.history_debug_04',_0x561ce3(0x24c),_0x561ce3(0x23c),_0x561ce3(0x225),_0x561ce3(0x1c0),_0x561ce3(0x266)];for(const _0x3ad7cf of _0x1d1688){try{const _0x2b233a=await this[_0x561ce3(0x260)](_0x3ad7cf);_0x2b233a&&await this[_0x561ce3(0x1a8)](_0x3ad7cf);}catch(_0x47e06b){}}}async[a0_0x4c9e73(0x1d2)](){const _0x483b80=a0_0x4c9e73;try{const _0x4d1bf9=await this[_0x483b80(0x19a)](_0x483b80(0x1e6));_0x4d1bf9&&_0x4d1bf9['val']&&(this['eventHistory']=JSON[_0x483b80(0x171)](_0x4d1bf9[_0x483b80(0x1b8)][_0x483b80(0x1ab)]()),this[_0x483b80(0x1f4)][_0x483b80(0x193)]('Loaded\x20'+this[_0x483b80(0x1a7)][_0x483b80(0x17c)]+_0x483b80(0x12a)));}catch(_0x3e90d1){this['eventHistory']=[];}try{const _0x5a5b3d=await this[_0x483b80(0x19a)](_0x483b80(0x1ea));if(_0x5a5b3d&&_0x5a5b3d['val'])this[_0x483b80(0x192)]=JSON[_0x483b80(0x171)](_0x5a5b3d[_0x483b80(0x1b8)]['toString']());}catch(_0x33872a){this[_0x483b80(0x192)]=[];}}[a0_0x4c9e73(0x277)](_0x43f706,_0x57d6aa){const _0x571583=a0_0x4c9e73;if(!_0x57d6aa)return;if(_0x43f706===this[_0x571583(0x1db)]+'.'+SYSTEM_DP_MODE){_0x57d6aa[_0x571583(0x1b8)]&&Object[_0x571583(0x242)](SYSTEM_MODES)[_0x571583(0x21f)](_0x57d6aa[_0x571583(0x1b8)])&&(this[_0x571583(0x154)]=_0x57d6aa[_0x571583(0x1b8)],_0x57d6aa[_0x571583(0x1b8)]===SYSTEM_MODES['VACATION']?this[_0x571583(0x276)](![]):this[_0x571583(0x276)](!![]));if(!_0x57d6aa[_0x571583(0x1ad)])this[_0x571583(0x255)](_0x43f706,{'val':this[_0x571583(0x154)],'ack':!![]});return;}if(!_0x57d6aa[_0x571583(0x1ad)]){_0x43f706[_0x571583(0x21f)]('analysis.trigger')&&_0x57d6aa['val']&&(this[_0x571583(0x1f4)][_0x571583(0x193)](_0x571583(0x1da)),this[_0x571583(0x255)](_0x43f706,{'val':![],'ack':!![]}),this[_0x571583(0x1b3)]());if(_0x43f706[_0x571583(0x21f)](_0x571583(0x159))&&_0x57d6aa['val']){this[_0x571583(0x255)](_0x43f706,{'val':![],'ack':!![]});if(this[_0x571583(0x160)])this[_0x571583(0x27f)]();}return;}const _0x4502da=(this[_0x571583(0x244)][_0x571583(0x220)]||[])[_0x571583(0x1d4)](_0x5269da=>_0x5269da['id']===_0x43f706);if(_0x4502da)this[_0x571583(0x184)](_0x43f706,_0x57d6aa,_0x4502da);}async[a0_0x4c9e73(0x184)](_0x3b0a34,_0x30ad4b,_0x5a4b19){const _0x4003e4=a0_0x4c9e73;if(!_0x5a4b19[_0x4003e4(0x1cf)]&&this[_0x4003e4(0x13d)][_0x3b0a34]===_0x30ad4b[_0x4003e4(0x1b8)])return;this[_0x4003e4(0x13d)][_0x3b0a34]=_0x30ad4b[_0x4003e4(0x1b8)];if(this[_0x4003e4(0x157)]){this[_0x4003e4(0x1f4)][_0x4003e4(0x1f5)](_0x4003e4(0x1b6)+_0x5a4b19[_0x4003e4(0x199)]);return;}const _0x1fa79e=_0x5a4b19['type']===_0x4003e4(0x224)&&(_0x5a4b19[_0x4003e4(0x199)]['toLowerCase']()[_0x4003e4(0x21f)](_0x4003e4(0x16f))||_0x5a4b19[_0x4003e4(0x199)][_0x4003e4(0x150)]()[_0x4003e4(0x21f)](_0x4003e4(0x12e))||_0x5a4b19['location']['toLowerCase']()[_0x4003e4(0x21f)]('flur'));_0x1fa79e&&!_0x30ad4b['val']?this[_0x4003e4(0x178)]():(this[_0x4003e4(0x228)]&&(this[_0x4003e4(0x1f4)][_0x4003e4(0x193)](_0x4003e4(0x22b)),this[_0x4003e4(0x1eb)]()),!this[_0x4003e4(0x155)]&&this[_0x4003e4(0x154)]===SYSTEM_MODES[_0x4003e4(0x146)]&&this[_0x4003e4(0x276)](!![]));const _0x3ea0b7={'timestamp':_0x30ad4b['ts'],'id':_0x3b0a34,'name':_0x5a4b19[_0x4003e4(0x199)],'value':_0x30ad4b['val'],'location':_0x5a4b19[_0x4003e4(0x271)],'type':_0x5a4b19[_0x4003e4(0x1c5)]};this[_0x4003e4(0x1a7)][_0x4003e4(0x268)](_0x3ea0b7);if(this['eventHistory'][_0x4003e4(0x17c)]>HISTORY_MAX_SIZE)this[_0x4003e4(0x1a7)][_0x4003e4(0x12b)]();await this['setStateAsync'](_0x4003e4(0x1e8),{'val':JSON[_0x4003e4(0x148)](_0x3ea0b7),'ack':!![]}),await this[_0x4003e4(0x1cb)]('events.history',{'val':JSON[_0x4003e4(0x148)](this[_0x4003e4(0x1a7)]),'ack':!![]}),this[_0x4003e4(0x20c)]['push']({'timestamp':new Date(_0x30ad4b['ts'])['toISOString'](),'sensorName':_0x5a4b19[_0x4003e4(0x199)],'location':_0x5a4b19['location'],'value':_0x30ad4b[_0x4003e4(0x1b8)]}),await this['saveRawEventLog']();}[a0_0x4c9e73(0x178)](){const _0x47a65b=a0_0x4c9e73;this[_0x47a65b(0x1f4)][_0x47a65b(0x193)](_0x47a65b(0x1c4)+EXIT_TIMER_MINUTES+'min\x20Timer,\x20'+EXIT_GRACE_PERIOD_SECONDS+'s\x20Grace).'),this[_0x47a65b(0x1eb)](),this['isGracePeriodActive']=!![],this[_0x47a65b(0x24f)]=setTimeout(()=>{const _0x21f717=_0x47a65b;this[_0x21f717(0x157)]=![],this['log'][_0x21f717(0x1f5)]('Exit\x20Grace\x20Period\x20beendet.\x20√úberwache\x20nun\x20Innenraum...');},EXIT_GRACE_PERIOD_SECONDS*0x3e8),this['exitTimer']=setTimeout(()=>{const _0x4e560d=_0x47a65b;this['log'][_0x4e560d(0x193)](_0x4e560d(0x1d0)),this[_0x4e560d(0x276)](![]),this[_0x4e560d(0x228)]=null;},EXIT_TIMER_MINUTES*0x3c*0x3e8);}[a0_0x4c9e73(0x1eb)](){const _0x548ae2=a0_0x4c9e73;if(this[_0x548ae2(0x228)])clearTimeout(this['exitTimer']);if(this[_0x548ae2(0x24f)])clearTimeout(this[_0x548ae2(0x24f)]);this[_0x548ae2(0x228)]=null,this['exitGraceTimer']=null,this['isGracePeriodActive']=![];}async['setPresence'](_0x2c93c7){const _0x478692=a0_0x4c9e73;if(this[_0x478692(0x155)]===_0x2c93c7)return;this[_0x478692(0x155)]=_0x2c93c7,await this[_0x478692(0x1cb)](_0x478692(0x1a5),{'val':_0x2c93c7,'ack':!![]}),this[_0x478692(0x1f4)][_0x478692(0x193)]('Pr√§senz-Status\x20ge√§ndert:\x20'+(_0x2c93c7?_0x478692(0x144):_0x478692(0x152)));}['runAutopilot'](){const _0x4ecc1e=a0_0x4c9e73,_0x49b530=this[_0x4ecc1e(0x244)][_0x4ecc1e(0x18c)],_0x39f355=this['config'][_0x4ecc1e(0x16a)],_0x91438f=this['eventHistory'][_0x4ecc1e(0x17c)]>0x0?this[_0x4ecc1e(0x1a7)][0x0]['timestamp']:Date[_0x4ecc1e(0x270)](),_0x1296cc=(Date[_0x4ecc1e(0x270)]()-_0x91438f)/(0x3e8*0x3c*0x3c);let _0x446877='';_0x39f355&&this['currentSystemMode']===SYSTEM_MODES[_0x4ecc1e(0x146)]&&this[_0x4ecc1e(0x155)]&&(_0x1296cc>_0x49b530&&(this[_0x4ecc1e(0x1f4)][_0x4ecc1e(0x15a)](_0x4ecc1e(0x1a0)+_0x1296cc[_0x4ecc1e(0x14c)](0x1)+_0x4ecc1e(0x234)),_0x446877='CRITICAL\x20WARNING:\x20No\x20sensor\x20activity\x20detected\x20for\x20'+_0x1296cc['toFixed'](0x1)+_0x4ecc1e(0x233)));if(_0x446877){this[_0x4ecc1e(0x1b3)](_0x446877)['catch'](_0x43f4af=>this['log'][_0x4ecc1e(0x1a2)](_0x43f4af));return;}const _0x1ba5c3=Date['now'](),_0x5f2d56=_0x1ba5c3-_0x91438f,_0x5f1ace=(this['config'][_0x4ecc1e(0x1b4)]||0xf)*0x3c*0x3e8;this[_0x4ecc1e(0x1a7)]['length']>0x0&&_0x5f2d56<=_0x5f1ace?this[_0x4ecc1e(0x1b3)]()[_0x4ecc1e(0x1dc)](_0xc1a309=>this[_0x4ecc1e(0x1f4)][_0x4ecc1e(0x1a2)](_0xc1a309)):!this['lastAlertState']&&(this[_0x4ecc1e(0x255)](_0x4ecc1e(0x17d),{'val':![],'ack':!![]}),this[_0x4ecc1e(0x255)](_0x4ecc1e(0x16d),{'val':![],'ack':!![]}));}async[a0_0x4c9e73(0x1b3)](_0x343d13=''){const _0x3f9b0d=a0_0x4c9e73;this[_0x3f9b0d(0x1f4)][_0x3f9b0d(0x193)]('ü§ñ\x20Starting\x20Gemini\x20Analysis...');if(!this[_0x3f9b0d(0x24e)]){this[_0x3f9b0d(0x1f4)][_0x3f9b0d(0x1a2)](_0x3f9b0d(0x1fc));return;}const _0x267dc2=this['eventHistory'][_0x3f9b0d(0x17c)]>0x0?this[_0x3f9b0d(0x1a7)]:[{'note':'No\x20recorded\x20events\x20yet.'}],_0x3a4e8e=PERSONA_MAPPING[this[_0x3f9b0d(0x244)]['aiPersona']||_0x3f9b0d(0x176)],_0x3317eb=this[_0x3f9b0d(0x244)][_0x3f9b0d(0x153)]||'',_0x50213f=this[_0x3f9b0d(0x154)],_0x558b08=new Date(),_0x41ef2d=_0x558b08[_0x3f9b0d(0x26c)](_0x3f9b0d(0x1d3),{'weekday':_0x3f9b0d(0x231),'hour':'2-digit','minute':_0x3f9b0d(0x18b)}),_0x4cfc3b=this[_0x3f9b0d(0x13c)];let _0x432ad2='';if(this[_0x3f9b0d(0x279)][_0x3f9b0d(0x17c)]>0x0){const _0x3124bf=this[_0x3f9b0d(0x279)]['slice'](0x0,0x3)[_0x3f9b0d(0x16c)](_0x13d6bd=>_0x3f9b0d(0x20a)+_0x13d6bd['alertReason']+_0x3f9b0d(0x1d5)+_0x13d6bd['rating']+'.')[_0x3f9b0d(0x180)]('\x0a');_0x432ad2=_0x3f9b0d(0x18d)+_0x3124bf+'\x0a';}const _0x24c72d=_0x343d13?_0x3f9b0d(0x27c)+_0x343d13+'\x0a!!!\x20END\x20WARNING\x20!!!\x0a':'',_0x296a92=_0x3f9b0d(0x21c),_0x503bd3=_0x3f9b0d(0x25a)+_0x41ef2d+_0x3f9b0d(0x237)+_0x4cfc3b[_0x3f9b0d(0x158)]+_0x3f9b0d(0x1af)+_0x50213f+_0x3f9b0d(0x21d)+(this[_0x3f9b0d(0x155)]?'Ja':'Nein')+_0x3f9b0d(0x1d9)+_0x3317eb+_0x3f9b0d(0x1f0)+_0x3a4e8e+_0x3f9b0d(0x1b0)+_0x296a92+'\x20'+_0x432ad2+'\x20'+_0x24c72d+_0x3f9b0d(0x149)+JSON['stringify'](_0x267dc2)+_0x3f9b0d(0x197);try{this['log'][_0x3f9b0d(0x1f5)](_0x3f9b0d(0x259)+_0x503bd3[_0x3f9b0d(0x17c)]+_0x3f9b0d(0x13e));const _0x44d728=await this['geminiModel']['generateContent'](_0x503bd3),_0x1bd6fc=_0x44d728[_0x3f9b0d(0x175)][_0x3f9b0d(0x16b)]()[_0x3f9b0d(0x137)](/```json|```/g,'')[_0x3f9b0d(0x263)]();this['log'][_0x3f9b0d(0x193)](_0x3f9b0d(0x1e7));const _0x241b99=JSON['parse'](_0x1bd6fc);await this[_0x3f9b0d(0x1cb)](_0x3f9b0d(0x20e),{'val':_0x1bd6fc,'ack':!![]}),await this[_0x3f9b0d(0x1cb)]('analysis.alertReason',{'val':_0x241b99['activity'][_0x3f9b0d(0x14d)]||'','ack':!![]}),await this[_0x3f9b0d(0x1cb)](_0x3f9b0d(0x23e),{'val':_0x241b99[_0x3f9b0d(0x195)][_0x3f9b0d(0x198)]||_0x3f9b0d(0x1de),'ack':!![]});const _0xf4932e=_0x241b99[_0x3f9b0d(0x195)]['isAlert']||![],_0x2312f5=_0x241b99['activity']['isEmergency']||![];if(_0xf4932e||_0x2312f5){await this[_0x3f9b0d(0x1cb)](_0x3f9b0d(0x17d),{'val':!![],'ack':!![]}),await this[_0x3f9b0d(0x1cb)]('analysis.isEmergency',{'val':_0x2312f5,'ack':!![]});if(!this[_0x3f9b0d(0x1e4)]||_0x2312f5){const _0x366124=_0x2312f5?_0x3f9b0d(0x20f):_0x3f9b0d(0x215);this[_0x3f9b0d(0x13a)](_0x366124+':\x20'+_0x241b99[_0x3f9b0d(0x195)][_0x3f9b0d(0x14d)],![],_0x2312f5);}}else await this[_0x3f9b0d(0x1cb)]('analysis.isAlert',{'val':![],'ack':!![]}),await this[_0x3f9b0d(0x1cb)](_0x3f9b0d(0x16d),{'val':![],'ack':!![]});this[_0x3f9b0d(0x1e4)]=_0xf4932e||_0x2312f5;const _0x3ca5ab={'timestamp':Date[_0x3f9b0d(0x270)](),'id':Date['now']()['toString'](),'analysis':_0x241b99,'systemMode':_0x50213f,'isPro':this[_0x3f9b0d(0x160)]};this['updateAnalysisHistory'](_0x3ca5ab);}catch(_0x5a74e3){this[_0x3f9b0d(0x1f4)][_0x3f9b0d(0x1a2)](_0x3f9b0d(0x201)+_0x5a74e3[_0x3f9b0d(0x1ff)]);}}async['createDailyDigest'](){const _0x1fd14a=a0_0x4c9e73;if(!this[_0x1fd14a(0x160)])return;await this[_0x1fd14a(0x1cb)](LTM_DP_STATUS,{'val':_0x1fd14a(0x240)+new Date()[_0x1fd14a(0x26c)](),'ack':!![]});if(!this[_0x1fd14a(0x24e)]||this['rawEventLog'][_0x1fd14a(0x17c)]<LTM_MIN_EVENTS_FOR_COMPRESSION){await this[_0x1fd14a(0x1cb)](LTM_DP_STATUS,{'val':_0x1fd14a(0x243),'ack':!![]});return;}const _0x564b01=JSON[_0x1fd14a(0x171)](JSON[_0x1fd14a(0x148)](this[_0x1fd14a(0x20c)])),_0x4156d0=(this[_0x1fd14a(0x244)][_0x1fd14a(0x153)]||'')[_0x1fd14a(0x1ec)](0x0,0x3e8),_0x1cc468=_0x1fd14a(0x236)+_0x4156d0+_0x1fd14a(0x1a3)+JSON[_0x1fd14a(0x148)](_0x564b01);try{const _0x52c38d=await this['geminiModel'][_0x1fd14a(0x191)](_0x1cc468),_0x566a3f=JSON[_0x1fd14a(0x171)](_0x52c38d['response'][_0x1fd14a(0x16b)]()[_0x1fd14a(0x137)](/```json|```/g,'')[_0x1fd14a(0x263)]());_0x566a3f[_0x1fd14a(0x198)]&&(this[_0x1fd14a(0x1cd)][_0x1fd14a(0x1b5)]({'timestamp':new Date()[_0x1fd14a(0x26d)](),'eventCount':_0x564b01[_0x1fd14a(0x17c)],'summary':_0x566a3f[_0x1fd14a(0x198)],'activityLevel':_0x566a3f[_0x1fd14a(0x219)],'systemMode':this[_0x1fd14a(0x154)]}),await this[_0x1fd14a(0x1f7)](),this['rawEventLog']=[],await this[_0x1fd14a(0x168)](),await this[_0x1fd14a(0x1cb)](LTM_DP_STATUS,{'val':_0x1fd14a(0x183)+_0x564b01[_0x1fd14a(0x17c)]+_0x1fd14a(0x21b),'ack':!![]}));}catch(_0x53c2ed){await this[_0x1fd14a(0x1cb)](LTM_DP_STATUS,{'val':'Error:\x20'+_0x53c2ed[_0x1fd14a(0x1ff)],'ack':!![]});}}async[a0_0x4c9e73(0x26b)](){const _0x5c0a95=a0_0x4c9e73;await this[_0x5c0a95(0x24b)](),await this['setObjectNotExistsAsync'](_0x5c0a95(0x1a5),{'type':'state','common':{'name':_0x5c0a95(0x13b),'type':'boolean','role':'indicator','read':!![],'write':![],'def':!![]},'native':{}}),await this['setObjectNotExistsAsync'](_0x5c0a95(0x1e8),{'type':_0x5c0a95(0x179),'common':{'name':'Last\x20raw\x20event','type':_0x5c0a95(0x262),'role':_0x5c0a95(0x1e9),'read':!![],'write':![]},'native':{}}),await this[_0x5c0a95(0x249)]('events.history',{'type':'state','common':{'name':'Event\x20History','type':_0x5c0a95(0x262),'role':'json','read':!![],'write':![]},'native':{}}),await this['setObjectNotExistsAsync']('analysis.trigger',{'type':_0x5c0a95(0x179),'common':{'name':'Trigger\x20Analysis','type':_0x5c0a95(0x22f),'role':_0x5c0a95(0x14f),'read':!![],'write':!![],'def':![]},'native':{}}),await this['setObjectNotExistsAsync']('analysis.lastResult',{'type':_0x5c0a95(0x179),'common':{'name':'Last\x20Result','type':'string','role':_0x5c0a95(0x1e9),'read':!![],'write':![]},'native':{}}),await this[_0x5c0a95(0x249)](_0x5c0a95(0x17d),{'type':_0x5c0a95(0x179),'common':{'name':_0x5c0a95(0x256),'type':_0x5c0a95(0x22f),'role':_0x5c0a95(0x1f2),'read':!![],'write':![],'def':![]},'native':{}}),await this['setObjectNotExistsAsync'](_0x5c0a95(0x16d),{'type':_0x5c0a95(0x179),'common':{'name':_0x5c0a95(0x1ca),'type':_0x5c0a95(0x22f),'role':'indicator.alarm.fire','read':!![],'write':![],'def':![]},'native':{}}),await this['setObjectNotExistsAsync'](_0x5c0a95(0x209),{'type':_0x5c0a95(0x179),'common':{'name':_0x5c0a95(0x246),'type':_0x5c0a95(0x262),'role':_0x5c0a95(0x174),'read':!![],'write':![]},'native':{}}),await this[_0x5c0a95(0x249)](_0x5c0a95(0x23e),{'type':'state','common':{'name':'Activity\x20Summary','type':_0x5c0a95(0x262),'role':_0x5c0a95(0x16b),'read':!![],'write':![]},'native':{}}),await this[_0x5c0a95(0x249)]('analysis.deviationFromBaseline',{'type':'state','common':{'name':_0x5c0a95(0x213),'type':_0x5c0a95(0x262),'role':_0x5c0a95(0x179),'read':!![],'write':![],'def':_0x5c0a95(0x1de)},'native':{}}),await this[_0x5c0a95(0x249)](_0x5c0a95(0x17e),{'type':_0x5c0a95(0x179),'common':{'name':_0x5c0a95(0x275),'type':_0x5c0a95(0x262),'role':_0x5c0a95(0x16b),'read':!![],'write':![]},'native':{}}),await this[_0x5c0a95(0x249)](_0x5c0a95(0x254),{'type':_0x5c0a95(0x179),'common':{'name':_0x5c0a95(0x24d),'type':_0x5c0a95(0x262),'role':_0x5c0a95(0x16b),'read':!![],'write':![]},'native':{}}),await this['extendObjectAsync'](_0x5c0a95(0x181),{'type':_0x5c0a95(0x1fb),'common':{'name':_0x5c0a95(0x15c)},'native':{}}),await this[_0x5c0a95(0x249)](_0x5c0a95(0x1b9),{'type':'state','common':{'name':_0x5c0a95(0x25f),'type':'boolean','role':_0x5c0a95(0x177),'read':!![],'write':![],'def':![]},'native':{}}),await this[_0x5c0a95(0x249)](_0x5c0a95(0x272),{'type':_0x5c0a95(0x179),'common':{'name':_0x5c0a95(0x203),'type':_0x5c0a95(0x262),'role':'text','read':!![],'write':![]},'native':{}}),await this[_0x5c0a95(0x249)](_0x5c0a95(0x16e),{'type':_0x5c0a95(0x179),'common':{'name':_0x5c0a95(0x247),'type':_0x5c0a95(0x262),'role':'text','read':!![],'write':![]},'native':{}}),await this[_0x5c0a95(0x249)](_0x5c0a95(0x1ea),{'type':'state','common':{'name':_0x5c0a95(0x238),'type':'string','role':'json','read':!![],'write':![],'def':'[]'},'native':{}}),await this['setObjectNotExistsAsync']('analysis.feedbackHistory',{'type':_0x5c0a95(0x179),'common':{'name':'Feedback\x20Log','type':_0x5c0a95(0x262),'role':_0x5c0a95(0x1e9),'read':!![],'write':![],'def':'[]'},'native':{}}),await this[_0x5c0a95(0x23a)](),await this[_0x5c0a95(0x17a)]();}async[a0_0x4c9e73(0x24b)](){const _0x55e1dd=a0_0x4c9e73;await this[_0x55e1dd(0x1f3)](_0x55e1dd(0x235),{'type':'channel','common':{'name':_0x55e1dd(0x250)},'native':{}}),await this[_0x55e1dd(0x1f3)](SYSTEM_DP_MODE,{'type':_0x55e1dd(0x179),'common':{'name':_0x55e1dd(0x1b1),'type':_0x55e1dd(0x262),'role':_0x55e1dd(0x179),'read':!![],'write':!![],'def':SYSTEM_MODES[_0x55e1dd(0x146)],'states':{[SYSTEM_MODES[_0x55e1dd(0x146)]]:_0x55e1dd(0x166),[SYSTEM_MODES[_0x55e1dd(0x241)]]:_0x55e1dd(0x22a),[SYSTEM_MODES[_0x55e1dd(0x173)]]:'Party',[SYSTEM_MODES[_0x55e1dd(0x20b)]]:_0x55e1dd(0x202)}},'native':{}});}async['sendNotification'](_0x25df23,_0x196430=![],_0x141a01=![]){const _0xf3715e=a0_0x4c9e73;this['log'][_0xf3715e(0x193)]((_0x196430?_0xf3715e(0x138):'')+'Sending\x20notification:\x20\x22'+_0x25df23+'\x22'+(_0x141a01?_0xf3715e(0x1fa):''));const _0x33b17a=this[_0xf3715e(0x244)];let _0x5d0001=0x0;_0x33b17a[_0xf3715e(0x264)]&&_0x33b17a[_0xf3715e(0x23f)]&&(await this[_0xf3715e(0x27b)](_0x33b17a[_0xf3715e(0x23f)],'send',{'text':_0x25df23,'user':_0x33b17a[_0xf3715e(0x25d)]}),_0x5d0001++);if(_0x33b17a[_0xf3715e(0x12c)]&&_0x33b17a[_0xf3715e(0x273)]){let _0x5246ca={'message':_0x25df23,'title':_0x141a01?_0xf3715e(0x172):_0xf3715e(0x1f6),'priority':_0x141a01?0x2:0x1,'device':_0x33b17a[_0xf3715e(0x1e1)]};_0x141a01&&(_0x5246ca[_0xf3715e(0x18e)]=0x1e,_0x5246ca['expire']=0xe10,_0x5246ca[_0xf3715e(0x163)]=_0xf3715e(0x253)),await this[_0xf3715e(0x27b)](_0x33b17a[_0xf3715e(0x273)],_0xf3715e(0x1e2),_0x5246ca),_0x5d0001++;}return _0x33b17a[_0xf3715e(0x1d7)]&&_0x33b17a['notifyEmailInstance']&&(await this[_0xf3715e(0x27b)](_0x33b17a[_0xf3715e(0x1be)],_0xf3715e(0x1e2),{'text':_0x25df23,'to':_0x33b17a[_0xf3715e(0x19b)]}),_0x5d0001++),_0x33b17a[_0xf3715e(0x251)]&&_0x33b17a['notifyWhatsappInstance']&&(await this[_0xf3715e(0x27b)](_0x33b17a[_0xf3715e(0x1e5)],'send',{'text':_0x25df23,'phone':_0x33b17a['notifyWhatsappRecipient']}),_0x5d0001++),_0x33b17a[_0xf3715e(0x143)]&&_0x33b17a['notifySignalInstance']&&(await this[_0xf3715e(0x27b)](_0x33b17a['notifySignalInstance'],_0xf3715e(0x1e2),{'text':_0x25df23,'phone':_0x33b17a[_0xf3715e(0x218)]}),_0x5d0001++),_0x5d0001;}async[a0_0x4c9e73(0x190)](){const _0x3ec307=a0_0x4c9e73;try{const _0x377c6c=await this[_0x3ec307(0x19a)](LTM_DP_RAW_LOG);if(_0x377c6c&&_0x377c6c[_0x3ec307(0x1b8)])this[_0x3ec307(0x20c)]=JSON[_0x3ec307(0x171)](_0x377c6c[_0x3ec307(0x1b8)]);}catch(_0x11458d){this[_0x3ec307(0x20c)]=[];}}async[a0_0x4c9e73(0x168)](){const _0x39b8e4=a0_0x4c9e73;this[_0x39b8e4(0x20c)][_0x39b8e4(0x17c)]>RAW_LOG_MAX_SIZE&&this[_0x39b8e4(0x20c)][_0x39b8e4(0x1d1)](0x0,this[_0x39b8e4(0x20c)][_0x39b8e4(0x17c)]-RAW_LOG_MAX_SIZE),await this['setStateAsync'](LTM_DP_RAW_LOG,{'val':JSON[_0x39b8e4(0x148)](this[_0x39b8e4(0x20c)]),'ack':!![]});}async['loadDailyDigests'](){const _0x708ab4=a0_0x4c9e73;try{const _0x1e9cf7=await this['getStateAsync'](LTM_DP_DAILY_DIGESTS);if(_0x1e9cf7&&_0x1e9cf7['val'])this['dailyDigests']=JSON[_0x708ab4(0x171)](_0x1e9cf7[_0x708ab4(0x1b8)]);}catch(_0x6dc42c){this[_0x708ab4(0x1cd)]=[];}await this[_0x708ab4(0x208)]();}async[a0_0x4c9e73(0x1f7)](_0x124625=!![]){const _0x35841e=a0_0x4c9e73,_0x2dd966=this[_0x35841e(0x244)][_0x35841e(0x12d)]||0x3c;this[_0x35841e(0x1cd)][_0x35841e(0x17c)]>_0x2dd966&&this[_0x35841e(0x1cd)][_0x35841e(0x1d1)](0x0,this[_0x35841e(0x1cd)][_0x35841e(0x17c)]-_0x2dd966);await this[_0x35841e(0x1cb)](LTM_DP_DAILY_DIGESTS,{'val':JSON['stringify'](this[_0x35841e(0x1cd)]),'ack':!![]});if(_0x124625)await this[_0x35841e(0x208)]();}[a0_0x4c9e73(0x222)](){const _0x38684d=a0_0x4c9e73;if(this[_0x38684d(0x1fd)])this[_0x38684d(0x1fd)][_0x38684d(0x1f1)]();if(!this['isProVersion']){this[_0x38684d(0x1cb)](LTM_DP_STATUS,{'val':_0x38684d(0x232),'ack':!![]});return;}this['ltmJob']=schedule[_0x38684d(0x189)](LTM_SCHEDULE,()=>this[_0x38684d(0x27f)]());}[a0_0x4c9e73(0x1b7)](){const _0x57f06c=a0_0x4c9e73;if(this[_0x57f06c(0x24a)])clearInterval(this[_0x57f06c(0x24a)]);if(!this[_0x57f06c(0x160)])return;this[_0x57f06c(0x24a)]=setInterval(()=>this[_0x57f06c(0x1c6)](),(this[_0x57f06c(0x244)][_0x57f06c(0x221)]||0x18)*0x36ee80),setTimeout(()=>this[_0x57f06c(0x1c6)](),0x1388);}async[a0_0x4c9e73(0x252)](){const _0x377d7e=a0_0x4c9e73;await this['setStateAsync'](_0x377d7e(0x23e),{'val':_0x377d7e(0x1a6),'ack':!![]}),await this[_0x377d7e(0x1cb)](_0x377d7e(0x170),{'val':this['isProVersion']?_0x377d7e(0x1a9):_0x377d7e(0x186),'ack':!![]}),await this[_0x377d7e(0x1cb)](_0x377d7e(0x17d),{'val':![],'ack':!![]}),await this[_0x377d7e(0x1cb)](_0x377d7e(0x16d),{'val':![],'ack':!![]}),this[_0x377d7e(0x1e4)]=![];}async[a0_0x4c9e73(0x21a)](_0x4956bd){const _0x2df158=a0_0x4c9e73;this[_0x2df158(0x192)][_0x2df158(0x268)](_0x4956bd);if(this['analysisHistory'][_0x2df158(0x17c)]>ANALYSIS_HISTORY_MAX_SIZE)this[_0x2df158(0x192)][_0x2df158(0x12b)]();await this[_0x2df158(0x1cb)](_0x2df158(0x1ea),{'val':JSON[_0x2df158(0x148)](this[_0x2df158(0x192)]),'ack':!![]});}[a0_0x4c9e73(0x161)](){const _0x1349fb=a0_0x4c9e73;if(this[_0x1349fb(0x169)])this[_0x1349fb(0x169)]['cancel']();this[_0x1349fb(0x169)]=schedule[_0x1349fb(0x189)](MODE_RESET_SCHEDULE,async()=>{const _0x2d29fa=_0x1349fb;await this[_0x2d29fa(0x206)](),AUTO_RESET_MODES[_0x2d29fa(0x21f)](this[_0x2d29fa(0x154)])&&await this['setStateAsync'](SYSTEM_DP_MODE,{'val':SYSTEM_MODES['NORMAL'],'ack':![]});});}async[a0_0x4c9e73(0x208)](){const _0x58f816=a0_0x4c9e73;if(!this[_0x58f816(0x160)]){await this['setStateAsync'](LTM_DP_BASELINE_STATUS,{'val':_0x58f816(0x232),'ack':!![]});return;}const _0x307308=this[_0x58f816(0x1cd)]['length']>=(this[_0x58f816(0x244)][_0x58f816(0x1ba)]||0x7)?_0x58f816(0x212)+this['dailyDigests'][_0x58f816(0x17c)]+'\x20Tage)':'Lernphase\x20('+this['dailyDigests'][_0x58f816(0x17c)]+'/'+(this[_0x58f816(0x244)]['minDaysForBaseline']||0x7)+')';await this[_0x58f816(0x1cb)](LTM_DP_BASELINE_STATUS,{'val':_0x307308,'ack':!![]});}async[a0_0x4c9e73(0x23a)](){const _0x2f21b3=a0_0x4c9e73;await this[_0x2f21b3(0x1f3)](_0x2f21b3(0x269),{'type':'channel','common':{'name':_0x2f21b3(0x269)},'native':{}}),await this[_0x2f21b3(0x1f3)](LTM_DP_RAW_LOG,{'type':'state','common':{'name':_0x2f21b3(0x22d),'type':_0x2f21b3(0x262),'role':_0x2f21b3(0x1e9),'read':!![],'write':![]},'native':{}}),await this[_0x2f21b3(0x1f3)](LTM_DP_DAILY_DIGESTS,{'type':_0x2f21b3(0x179),'common':{'name':_0x2f21b3(0x134),'type':_0x2f21b3(0x262),'role':'json','read':!![],'write':![]},'native':{}}),await this[_0x2f21b3(0x1f3)](LTM_DP_STATUS,{'type':_0x2f21b3(0x179),'common':{'name':'Processing\x20Status','type':'string','role':'text','read':!![],'write':![]},'native':{}}),await this[_0x2f21b3(0x1f3)](LTM_DP_TRIGGER_DIGEST,{'type':_0x2f21b3(0x179),'common':{'name':_0x2f21b3(0x1bf),'type':'boolean','role':_0x2f21b3(0x14f),'read':!![],'write':!![],'def':![]},'native':{}}),await this['extendObjectAsync'](LTM_DP_BASELINE_STATUS,{'type':'state','common':{'name':'Baseline\x20Status','type':_0x2f21b3(0x262),'role':_0x2f21b3(0x16b),'read':!![],'write':![]},'native':{}});}async['checkLtmDriftObjects'](){const _0x31478d=a0_0x4c9e73;await this['extendObjectAsync'](LTM_DP_DRIFT_CHANNEL,{'type':_0x31478d(0x1fb),'common':{'name':'Drift\x20Analysis'},'native':{}}),await this[_0x31478d(0x1f3)](LTM_DP_DRIFT_STATUS,{'type':_0x31478d(0x179),'common':{'name':_0x31478d(0x200),'type':_0x31478d(0x262),'role':_0x31478d(0x179),'read':!![],'write':![],'def':_0x31478d(0x1de)},'native':{}}),await this['extendObjectAsync'](LTM_DP_DRIFT_DETAILS,{'type':_0x31478d(0x179),'common':{'name':_0x31478d(0x205),'type':_0x31478d(0x262),'role':_0x31478d(0x16b),'read':!![],'write':![]},'native':{}}),await this['extendObjectAsync'](LTM_DP_DRIFT_LAST_CHECK,{'type':_0x31478d(0x179),'common':{'name':_0x31478d(0x26a),'type':_0x31478d(0x145),'role':_0x31478d(0x140),'read':!![],'write':![]},'native':{}});}async[a0_0x4c9e73(0x1c6)](){const _0x1f753d=a0_0x4c9e73;if(!this[_0x1f753d(0x160)]||!this[_0x1f753d(0x24e)])return;const _0x3753cc=this[_0x1f753d(0x244)][_0x1f753d(0x21e)]||0xe;if(this[_0x1f753d(0x1cd)]['length']<_0x3753cc+(this[_0x1f753d(0x244)][_0x1f753d(0x1ba)]||0x7)){await this[_0x1f753d(0x1cb)](LTM_DP_DRIFT_STATUS,{'val':_0x1f753d(0x142),'ack':!![]});return;}const _0x5782e9=this['dailyDigests']['slice'](-_0x3753cc),_0x4ab55e=this[_0x1f753d(0x1cd)][_0x1f753d(0x27e)](0x0,this[_0x1f753d(0x1cd)][_0x1f753d(0x17c)]-_0x3753cc),_0x5bca21=_0x1f753d(0x187)+JSON['stringify'](_0x4ab55e)+'\x0a\x0aA\x20(STB):\x0a'+JSON[_0x1f753d(0x148)](_0x5782e9);try{const _0xd0c051=await this[_0x1f753d(0x24e)][_0x1f753d(0x191)](_0x5bca21),_0x36c3d6=JSON['parse'](_0xd0c051[_0x1f753d(0x175)][_0x1f753d(0x16b)]()[_0x1f753d(0x137)](/```json|```/g,'')[_0x1f753d(0x263)]());_0x36c3d6['baselineDrift']&&(await this[_0x1f753d(0x1cb)](LTM_DP_DRIFT_STATUS,{'val':_0x36c3d6[_0x1f753d(0x216)],'ack':!![]}),await this[_0x1f753d(0x1cb)](LTM_DP_DRIFT_DETAILS,{'val':_0x36c3d6['driftDetails'],'ack':!![]}),await this[_0x1f753d(0x1cb)](LTM_DP_DRIFT_LAST_CHECK,{'val':Date[_0x1f753d(0x270)](),'ack':!![]}));}catch(_0x47315c){}}async[a0_0x4c9e73(0x206)](){const _0x9e1e76=a0_0x4c9e73;try{const _0x5bcb5d=await this['getStateAsync'](SYSTEM_DP_MODE);_0x5bcb5d&&_0x5bcb5d[_0x9e1e76(0x1b8)]&&Object[_0x9e1e76(0x242)](SYSTEM_MODES)['includes'](_0x5bcb5d['val'])?this[_0x9e1e76(0x154)]=_0x5bcb5d[_0x9e1e76(0x1b8)]:(this[_0x9e1e76(0x154)]=SYSTEM_MODES[_0x9e1e76(0x146)],await this[_0x9e1e76(0x1cb)](SYSTEM_DP_MODE,{'val':SYSTEM_MODES[_0x9e1e76(0x146)],'ack':!![]}));}catch(_0x1c275b){this[_0x9e1e76(0x154)]=SYSTEM_MODES[_0x9e1e76(0x146)];}}async['getSystemUUID'](){const _0x4bf442=a0_0x4c9e73;try{const _0x45470b=await this[_0x4bf442(0x1dd)](_0x4bf442(0x1d6));if(_0x45470b&&_0x45470b[_0x4bf442(0x1ce)]&&_0x45470b[_0x4bf442(0x1ce)][_0x4bf442(0x1a4)])return _0x45470b['native'][_0x4bf442(0x1a4)];return _0x4bf442(0x257);}catch(_0x4712ae){return _0x4bf442(0x1cc);}}async[a0_0x4c9e73(0x1c3)](_0x507861){const _0x22f342=a0_0x4c9e73;if(!_0x507861)return![];this['systemUUID']=await this[_0x22f342(0x230)]();if(_0x507861==='TEST-PRO-KEY'||_0x507861[_0x22f342(0x164)]('PRO-'))return!![];return![];}['onUnload'](_0x376580){const _0x2f7455=a0_0x4c9e73;if(this['analysisTimer'])clearInterval(this['analysisTimer']);if(this[_0x2f7455(0x24a)])clearInterval(this[_0x2f7455(0x24a)]);if(this['ltmJob'])this[_0x2f7455(0x1fd)][_0x2f7455(0x1f1)]();if(this['modeResetJob'])this['modeResetJob']['cancel']();if(this[_0x2f7455(0x228)])clearTimeout(this[_0x2f7455(0x228)]);if(this[_0x2f7455(0x24f)])clearTimeout(this[_0x2f7455(0x24f)]);_0x376580();}async['onMessage'](_0x1856e9){const _0x1be3eb=a0_0x4c9e73;if(typeof _0x1856e9===_0x1be3eb(0x18f)&&_0x1856e9[_0x1be3eb(0x1ff)]){if(_0x1856e9[_0x1be3eb(0x267)]===_0x1be3eb(0x1ee)){if(!_0x1856e9['message'][_0x1be3eb(0x278)])return this[_0x1be3eb(0x1ed)](_0x1856e9['from'],_0x1856e9[_0x1be3eb(0x267)],{'success':![],'message':'No\x20Key'},_0x1856e9[_0x1be3eb(0x14b)]);try{const _0x2ffc62=new GoogleGenerativeAI(_0x1856e9['message']['apiKey'])[_0x1be3eb(0x17f)]({'model':_0x1be3eb(0x20d)});await _0x2ffc62[_0x1be3eb(0x191)]('test'),this[_0x1be3eb(0x1ed)](_0x1856e9[_0x1be3eb(0x19d)],_0x1856e9[_0x1be3eb(0x267)],{'success':!![],'message':'Success'},_0x1856e9['callback']);}catch(_0x52b75b){this['sendTo'](_0x1856e9[_0x1be3eb(0x19d)],_0x1856e9[_0x1be3eb(0x267)],{'success':![],'message':_0x52b75b[_0x1be3eb(0x1ff)]},_0x1856e9[_0x1be3eb(0x14b)]);}}else{if(_0x1856e9['command']===_0x1be3eb(0x261)){const _0x1e2fd=await this[_0x1be3eb(0x13a)](_0x1be3eb(0x1df),!![]);this[_0x1be3eb(0x1ed)](_0x1856e9[_0x1be3eb(0x19d)],_0x1856e9['command'],{'success':_0x1e2fd>0x0,'message':_0x1e2fd+_0x1be3eb(0x22c)},_0x1856e9['callback']);}else{if(_0x1856e9['command']==='getLtmData'){if(!this[_0x1be3eb(0x160)])return this['sendTo'](_0x1856e9[_0x1be3eb(0x19d)],_0x1856e9['command'],{'success':![],'isPro':![]},_0x1856e9['callback']);let _0x18fb50={'status':_0x1be3eb(0x1de),'details':'','lastCheck':0x0};try{_0x18fb50['status']=(await this[_0x1be3eb(0x19a)](LTM_DP_DRIFT_STATUS))[_0x1be3eb(0x1b8)],_0x18fb50['details']=(await this['getStateAsync'](LTM_DP_DRIFT_DETAILS))[_0x1be3eb(0x1b8)],_0x18fb50[_0x1be3eb(0x1ef)]=(await this['getStateAsync'](LTM_DP_DRIFT_LAST_CHECK))[_0x1be3eb(0x1b8)];}catch(_0x66482b){}this[_0x1be3eb(0x1ed)](_0x1856e9[_0x1be3eb(0x19d)],_0x1856e9[_0x1be3eb(0x267)],{'success':!![],'isPro':!![],'dailyDigests':this[_0x1be3eb(0x1cd)],'driftAnalysis':_0x18fb50,'analysisHistory':this[_0x1be3eb(0x192)]},_0x1856e9[_0x1be3eb(0x14b)]);}else{if(_0x1856e9['command']===_0x1be3eb(0x26e)){const _0x35d54f=await this[_0x1be3eb(0x14a)]('enum.functions.*',_0x1be3eb(0x1aa)),_0x1bf74f=[];if(_0x35d54f)for(const _0x38f876 in _0x35d54f){const _0x128033=_0x35d54f[_0x38f876],_0x14b000=(_0x128033[_0x1be3eb(0x19f)]&&typeof _0x128033[_0x1be3eb(0x19f)][_0x1be3eb(0x199)]===_0x1be3eb(0x18f)?_0x128033['common'][_0x1be3eb(0x199)]['de']:_0x128033[_0x1be3eb(0x19f)][_0x1be3eb(0x199)])||_0x128033[_0x1be3eb(0x19f)][_0x1be3eb(0x199)];_0x1bf74f[_0x1be3eb(0x1b5)]({'id':_0x38f876,'name':_0x14b000});}this['sendTo'](_0x1856e9[_0x1be3eb(0x19d)],_0x1856e9[_0x1be3eb(0x267)],{'success':!![],'enums':_0x1bf74f},_0x1856e9[_0x1be3eb(0x14b)]);}else{if(_0x1856e9[_0x1be3eb(0x267)]===_0x1be3eb(0x211)){this[_0x1be3eb(0x1f4)][_0x1be3eb(0x193)](_0x1be3eb(0x15b));const _0x323128=_0x1856e9[_0x1be3eb(0x1ff)]||{};try{const _0x5c8b6a=await this['scanForDevices'](_0x323128);this[_0x1be3eb(0x1ed)](_0x1856e9[_0x1be3eb(0x19d)],_0x1856e9['command'],{'success':!![],'devices':_0x5c8b6a},_0x1856e9[_0x1be3eb(0x14b)]);}catch(_0x51fb05){this[_0x1be3eb(0x1ed)](_0x1856e9[_0x1be3eb(0x19d)],_0x1856e9[_0x1be3eb(0x267)],{'success':![],'error':_0x51fb05[_0x1be3eb(0x1ff)]},_0x1856e9[_0x1be3eb(0x14b)]);}}else{if(_0x1856e9['command']===_0x1be3eb(0x156)){const {historyId:_0x2dcc77,rating:_0x5be9ff,comment:_0x351ad4,alertReason:_0x759af8}=_0x1856e9[_0x1be3eb(0x1ff)];_0x2dcc77&&_0x5be9ff?(await this['saveFeedback']({'timestamp':Date['now'](),'historyId':_0x2dcc77,'rating':_0x5be9ff,'comment':_0x351ad4,'alertReason':_0x759af8}),this[_0x1be3eb(0x1ed)](_0x1856e9['from'],_0x1856e9[_0x1be3eb(0x267)],{'success':!![]},_0x1856e9['callback'])):this[_0x1be3eb(0x1ed)](_0x1856e9[_0x1be3eb(0x19d)],_0x1856e9['command'],{'success':![],'error':_0x1be3eb(0x1f9)},_0x1856e9['callback']);}}}}}}}}}function a0_0x2a5f(){const _0x2e0b33=['\x22\x20was\x20','system.meta.uuid','notifyEmailEnabled','Subscribing\x20to\x20','.\x20\x0a\x20\x20\x20\x20\x20\x20\x20\x20KONTEXT:\x20','Manual\x20Analysis\x20Trigger\x20detected!','namespace','catch','getForeignObjectAsync','N/A','[Test]\x20Notification','\x20min).\x20Watchdog\x20Limit:\x20','notifyPushoverRecipient','send','systemUUID','lastAlertState','notifyWhatsappInstance','events.history','‚úÖ\x20Gemini\x20Response\x20received.','events.lastEvent','json','analysis.analysisHistory','abortExitTimer','substring','sendTo','testApiKey','lastCheck','.\x20PERSONA:\x20','cancel','indicator.alarm','extendObjectAsync','log','debug','Cogni-Living\x20Alert','saveDailyDigests','546040lCKrmX','Missing\x20data','\x20(EMERGENCY)','channel','‚ùå\x20Gemini\x20Model\x20not\x20initialized!\x20Check\x20API\x20Key.','ltmJob','96140ONrAPb','message','Drift\x20Status','Analysis\x20Error:\x20','Gast','Description','vacation','Drift\x20Details','loadSystemMode','getForeignStateAsync','updateBaselineStatus','analysis.alertReason','User\x20Feedback:\x20Alarm\x20\x22','GUEST','rawEventLog','models/gemini-flash-latest','analysis.lastResult','üö®üö®\x20NOTFALL','party','scanDevices','Aktiv\x20(','Deviation','loadDailyDigests','‚ö†Ô∏è\x20Alarm','baselineDrift','Fokus\x20auf\x20Maximierung\x20von\x20Komfort,\x20Automatisierungseffizienz\x20und\x20Energieeinsparung.','notifySignalRecipient','activityLevel','updateAnalysisHistory','\x20events','Baseline:\x20Inactive\x20(Pro\x20Feature).','.\x20PR√ÑSENZ:\x20','ltmStbWindowDays','includes','devices','ltmDriftCheckIntervalHours','setupLtmScheduler','1142IyBFKt','Fenster/T√ºr','events.history_debug_02','LTM.baselineStatus','application/json','exitTimer','node-schedule','Urlaub','Bewegung\x20w√§hrend\x20Exit-Timer\x20erkannt\x20->\x20Bewohner\x20ist\x20noch\x20da.','\x20sent','Raw\x20Log','longitude','boolean','getSystemUUID','long','Deaktiviert\x20(Pro-Feature)','\x20hours.\x20The\x20resident\x20might\x20be\x20incapacitated.\x20Risk\x20level:\x20HIGH.','\x20Stunden!','system','ROLLE:\x20Compression\x20Agent.\x20SPRACHE:\x20DE.\x20FORMAT:\x20JSON.\x20KONTEXT:\x20','.\x20ORT:\x20','Logbook','Fokus\x20auf\x20Familienroutinen,\x20Kindersicherheit\x20und\x20allgemeines\x20Haushaltsmanagement.','checkLtmObjects','LTM.driftAnalysis.baselineDrift','events.history_debug_01','main','analysis.activitySummary','notifyTelegramInstance','Started\x20at\x20','VACATION','values','Skipped\x20(No\x20AI\x20or\x20Data)','config','constructor','Alert\x20Reason','Action','analysis.trigger','setObjectNotExistsAsync','driftAnalysisTimer','checkSystemObjects','events.history_debug_00','Comfort\x20Suggestion','geminiModel','exitGraceTimer','System\x20Status\x20&\x20Control','notifyWhatsappEnabled','resetAnalysisStates','siren','analysis.comfortSuggestion','setState','AI\x20Alert\x20Status','uuid-not-found','unload','Sending\x20Prompt\x20(Length:\x20','ROLLE:\x20Smart\x20Home\x20Analyst.\x20SPRACHE:\x20DE.\x20FORMAT:\x20JSON.\x20\x0a\x20\x20\x20\x20\x20\x20\x20\x20AKTUELLE\x20ZEIT:\x20','PRIORIT√ÑT:\x20Gesundheit\x20und\x20Sicherheit\x20f√ºr\x20Senioren\x20(AAL).\x20Erkenne\x20Inaktivit√§t,\x20potenzielle\x20St√ºrze\x20(indirekt),\x20ungew√∂hnliche\x20n√§chtliche\x20Aktivit√§t.','Gemini\x20API\x20Key\x20missing.\x20AI\x20features\x20disabled.','notifyTelegramRecipient','cleanUpZombies','Pattern\x20Detected','getObjectAsync','testNotification','string','trim','notifyTelegramEnabled','onUnload','events.history_debug_04','command','unshift','LTM','Last\x20Check','createAllObjects','toLocaleString','toISOString','getEnums','onReady','now','location','analysis.automation.description','notifyPushoverInstance','analysis.history_debug_00','Comfort\x20Summary','setPresence','onStateChange','apiKey','feedbackHistory','LTM.driftAnalysis.lastCheck','sendToAsync','\x0a!!!\x20EXTERNAL\x20SYSTEM\x20WARNING\x20!!!\x0a','Gemini\x20AI\x20initialized.','slice','createDailyDigest','\x20events\x20from\x20history.','pop','notifyPushoverEnabled','ltmLtbWindowDays','eingang','search','0\x204\x20*\x20*\x20*','174987bRYYXY','üìç\x20Standort\x20geladen:\x20','0\x203\x20*\x20*\x20*','Daily\x20Digests','subscribeForeignStatesAsync','9422TmroAO','replace','[TEST]\x20','licenseKey','sendNotification','Presence\x20Status','systemConfig','sensorLastValues',')...','Gemini\x20Init\x20Error:\x20','date','system.config','N/A\x20(Learning)','notifySignalEnabled','ANWESEND\x20üè†','number','NORMAL','latitude','stringify','\x0a\x20\x20\x20\x20\x20\x20\x20\x20EVENTS:\x20','getForeignObjectsAsync','callback','toFixed','alertReason','guest','button','toLowerCase','geminiApiKey','ABWESEND\x20‚úàÔ∏è','livingContext','currentSystemMode','isPresent','submitFeedback','isGracePeriodActive','city','triggerDailyDigest','warn','Received\x20scanDevices\x20request\x20from\x20Admin\x20UI.','Automation\x20Proposals','LTM.processingStatus','1174660IMCZwz','normal','isProVersion','setupModeResetScheduler','exports','sound','startsWith','(((.+)+)+)+$','Normal','apply','saveRawEventLog','modeResetJob','inactivityMonitoringEnabled','text','map','analysis.isEmergency','analysis.automation.suggestedAction','haust√ºr','analysis.deviationFromBaseline','parse','üö®\x20EMERGENCY','PARTY','text.alarm','response','generic','indicator','startExitTimer','state','checkLtmDriftObjects','bind','length','analysis.isAlert','analysis.comfortSummary','getGenerativeModel','join','analysis.automation','analysis.history_debug_02','Success:\x20Compressed\x20','processSensorEvent','341WRqpCX','N/A\x20(Pro\x20Feature)','ROLLE:\x20Data\x20Scientist.\x20VERGLEICHE:\x20Dataset\x20A\x20(Recent)\x20vs\x20B\x20(Established).\x20ZIEL:\x20Erkenne\x20Drift.\x20SCHEMA:\x20{\x20\x22baselineDrift\x22:\x20\x22none|slight|significant|critical\x22,\x20\x22driftDetails\x22:\x20\x22string\x22\x20}\x0a\x0aB\x20(LTB):\x0a','Konnte\x20System-Standort\x20nicht\x20laden.','scheduleJob','LTM.driftAnalysis.driftDetails','2-digit','inactivityThresholdHours','\x0aFEEDBACK:\x0a','retry','object','loadRawEventLog','generateContent','analysisHistory','info','5nezwgN','activity','LTM.rawEventLog','\x20\x0a\x20\x20\x20\x20\x20\x20\x20\x20SCHEMA:\x20{\x20\x22activity\x22:\x20{\x20\x22summary\x22:\x20\x22string\x22,\x20\x22deviationFromBaseline\x22:\x20\x22string\x22,\x20\x22isAlert\x22:\x20bool,\x20\x22isEmergency\x22:\x20bool,\x20\x22alertReason\x22:\x20\x22string\x22\x20},\x20\x22comfort\x22:\x20{\x20\x22summary\x22:\x20\x22string\x22,\x20\x22suggestion\x22:\x20\x22string\x22,\x20\x22automationProposal\x22:\x20{\x20\x22patternDetected\x22:\x20bool,\x20\x22description\x22:\x20\x22string\x22,\x20\x22suggestedAction\x22:\x20\x22string\x22\x20}\x20}\x20}','summary','name','getStateAsync','notifyEmailRecipient','80OPHtPY','from','version','common','üö®\x20Dead\x20Man\x27s\x20Switch:\x20Keine\x20Aktivit√§t\x20seit\x20','subscribeStates','error','.\x20ANWEISUNG:\x20Fasse\x20Sensor-Events\x20zusammen.\x20SCHEMA:\x20{\x20\x22summary\x22:\x20\x22string\x22,\x20\x22activityLevel\x22:\x20\x22string\x22\x20}\x20\x0a\x0aEVENTS:\x0a','uuid','system.isPresent','No\x20recent\x20activity.','eventHistory','delObjectAsync','N/A\x20(No\x20Activity)','enum','toString','ready','ack','262596KgTzRV','.\x0a\x20\x20\x20\x20\x20\x20\x20\x20MODUS:\x20','.\x0a\x20\x20\x20\x20\x20\x20\x20\x20','System\x20Mode','156iEbLrN','runGeminiAnalysis','analysisInterval','push','Ignoring\x20event\x20during\x20Exit\x20Grace\x20Period:\x20','setupDriftAnalysisScheduler','val','analysis.automation.patternDetected','minDaysForBaseline','\x20sensors...','LTM.dailyDigests','analysisTimer','notifyEmailInstance','Trigger\x20Digest','events.history_debug_03','930DDVDcB','system.mode','checkLicense','Haust√ºr\x20Event:\x20Starte\x20Exit-Logik\x20(','type','runBaselineDriftAnalysis','genAI','LTM.triggerDailyDigest','Analysiere\x20ausgewogen\x20auf\x20Gesundheit,\x20Sicherheit\x20und\x20Komfort.','AI\x20Emergency\x20Status','setStateAsync','uuid-error','dailyDigests','native','logDuplicates','Exit-Timer\x20abgelaufen:\x20Keine\x20Bewegung\x20innen\x20erkannt\x20->\x20ABWESEND.','splice','loadHistoryFromState','de-DE','find'];a0_0x2a5f=function(){return _0x2e0b33;};return a0_0x2a5f();}if(require[a0_0x4c9e73(0x23d)]!==module)module[a0_0x4c9e73(0x162)]=_0x43f731=>new CogniLiving(_0x43f731);else new CogniLiving();