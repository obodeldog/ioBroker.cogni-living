const a0_0x58ce74=a0_0x2c29;(function(_0x1c244e,_0x2a46c8){const _0x35f719=a0_0x2c29,_0x1e919d=_0x1c244e();while(!![]){try{const _0xe54e9c=-parseInt(_0x35f719(0x1f4))/0x1+parseInt(_0x35f719(0x2a8))/0x2*(-parseInt(_0x35f719(0x17e))/0x3)+parseInt(_0x35f719(0x1ea))/0x4*(parseInt(_0x35f719(0x16e))/0x5)+-parseInt(_0x35f719(0x1b0))/0x6+-parseInt(_0x35f719(0x254))/0x7+-parseInt(_0x35f719(0x133))/0x8*(-parseInt(_0x35f719(0x21a))/0x9)+-parseInt(_0x35f719(0x216))/0xa;if(_0xe54e9c===_0x2a46c8)break;else _0x1e919d['push'](_0x1e919d['shift']());}catch(_0x400ad9){_0x1e919d['push'](_0x1e919d['shift']());}}}(a0_0x1517,0x39c6a));const a0_0x3ef307=(function(){let _0x5dc271=!![];return function(_0x5e9349,_0x1d79fb){const _0x3d928d=_0x5dc271?function(){if(_0x1d79fb){const _0x4445c9=_0x1d79fb['apply'](_0x5e9349,arguments);return _0x1d79fb=null,_0x4445c9;}}:function(){};return _0x5dc271=![],_0x3d928d;};}()),a0_0x5d36ee=a0_0x3ef307(this,function(){const _0x1d3735=a0_0x2c29;return a0_0x5d36ee['toString']()[_0x1d3735(0x28b)](_0x1d3735(0x293))[_0x1d3735(0x176)]()[_0x1d3735(0x14d)](a0_0x5d36ee)[_0x1d3735(0x28b)]('(((.+)+)+)+$');});a0_0x5d36ee();'use strict';const utils=require(a0_0x58ce74(0x27d)),{GoogleGenerativeAI}=require(a0_0x58ce74(0x174)),schedule=require(a0_0x58ce74(0x18a)),HISTORY_MAX_SIZE=0x32,RAW_LOG_MAX_SIZE=0x5dc,LTM_MIN_EVENTS_FOR_COMPRESSION=0x5,GEMINI_MODEL=a0_0x58ce74(0x1de),LTM_SCHEDULE=a0_0x58ce74(0x136),MODE_RESET_SCHEDULE=a0_0x58ce74(0x2aa),ANALYSIS_HISTORY_MAX_SIZE=0x64,LTM_DP_RAW_LOG=a0_0x58ce74(0x292),LTM_DP_DAILY_DIGESTS=a0_0x58ce74(0x297),LTM_DP_STATUS=a0_0x58ce74(0x1d2),LTM_DP_TRIGGER_DIGEST=a0_0x58ce74(0x240),LTM_DP_BASELINE_STATUS='LTM.baselineStatus',LTM_DP_DRIFT_CHANNEL=a0_0x58ce74(0x26c),LTM_DP_DRIFT_STATUS=a0_0x58ce74(0x134),LTM_DP_DRIFT_DETAILS=a0_0x58ce74(0x186),LTM_DP_DRIFT_LAST_CHECK=a0_0x58ce74(0x121),SYSTEM_DP_MODE='system.mode',HARD_IGNORE_TERMS=[a0_0x58ce74(0x177),a0_0x58ce74(0x22c),a0_0x58ce74(0x128),a0_0x58ce74(0x1ef),a0_0x58ce74(0x1e8),a0_0x58ce74(0x1a5),a0_0x58ce74(0x28c),a0_0x58ce74(0x1c9),a0_0x58ce74(0x152),a0_0x58ce74(0x150),a0_0x58ce74(0x213),a0_0x58ce74(0x138),a0_0x58ce74(0x2a9),a0_0x58ce74(0x1e0),a0_0x58ce74(0x149),a0_0x58ce74(0x281),a0_0x58ce74(0x27b),'link_quality'],BAD_NAMES=['targetposition',a0_0x58ce74(0x1d3),a0_0x58ce74(0x1ae),a0_0x58ce74(0x1bb),a0_0x58ce74(0x227),a0_0x58ce74(0x1dc),'on','off',a0_0x58ce74(0x257),'position',a0_0x58ce74(0x19a),a0_0x58ce74(0x15a),'cover',a0_0x58ce74(0x126),a0_0x58ce74(0x23f),'presence',a0_0x58ce74(0x24d),a0_0x58ce74(0x249),a0_0x58ce74(0x203),a0_0x58ce74(0x1da),a0_0x58ce74(0x1e2),'setpoint','valve','actual_temperature',a0_0x58ce74(0x13a)],ADAPTER_BLACKLIST=['system.','admin.',a0_0x58ce74(0x261),a0_0x58ce74(0x189),'history.',a0_0x58ce74(0x160),a0_0x58ce74(0x248),a0_0x58ce74(0x1f0),a0_0x58ce74(0x1a4),'javascript.','simple-api.'],SYSTEM_MODES={'NORMAL':'normal','VACATION':a0_0x58ce74(0x230),'PARTY':'party','GUEST':a0_0x58ce74(0x159)},AUTO_RESET_MODES=[SYSTEM_MODES[a0_0x58ce74(0x1f5)],SYSTEM_MODES[a0_0x58ce74(0x221)]],PERSONA_MAPPING={'generic':a0_0x58ce74(0x262),'senior_aal':a0_0x58ce74(0x271),'family':a0_0x58ce74(0x13c),'single_comfort':a0_0x58ce74(0x118),'security':'PRIORITÃ„T:\x20Sicherheit.\x20Erkenne\x20Eindringlinge,\x20ungewÃ¶hnliche\x20Anwesenheit.'};class CogniLiving extends utils[a0_0x58ce74(0x191)]{constructor(_0x1b7be1){const _0x312162=a0_0x58ce74;super({..._0x1b7be1,'name':_0x312162(0x1dd)}),this[_0x312162(0x268)]=[],this[_0x312162(0x209)]=[],this['feedbackHistory']=[],this[_0x312162(0x25d)]=[],this[_0x312162(0x14f)]=[],this[_0x312162(0x276)]={},this['systemConfig']={'latitude':0x0,'longitude':0x0,'city':''},this['isPresent']=!![],this[_0x312162(0x29a)]=null,this[_0x312162(0x168)]=null,this[_0x312162(0x243)]=![],this[_0x312162(0x1f9)]=null,this['geminiModel']=null,this['currentSystemMode']=SYSTEM_MODES['NORMAL'],this[_0x312162(0x1ab)]=![],this[_0x312162(0x1d9)]=![],this['systemUUID']=_0x312162(0x142),this[_0x312162(0x1d5)]=null,this[_0x312162(0x1b6)]=null,this[_0x312162(0x208)]=null,this['driftAnalysisTimer']=null,this[_0x312162(0x22e)]=null,this['on']('ready',this['onReady'][_0x312162(0x226)](this)),this['on'](_0x312162(0x122),this['onStateChange']['bind'](this)),this['on'](_0x312162(0x182),this[_0x312162(0x23c)]['bind'](this)),this['on'](_0x312162(0x1c7),this[_0x312162(0x129)][_0x312162(0x226)](this));}async[a0_0x58ce74(0x199)](){const _0xc00f77=a0_0x58ce74;this[_0xc00f77(0x27e)]['info'](_0xc00f77(0x164)+this['version']+_0xc00f77(0x12c)),await initZombies(this),this['config'][_0xc00f77(0x1e9)]=this[_0xc00f77(0x196)][_0xc00f77(0x1e9)]||'';try{this[_0xc00f77(0x1ab)]=await checkLicense(this,this[_0xc00f77(0x196)][_0xc00f77(0x1e9)]);}catch(_0xd6cf19){}if(!this[_0xc00f77(0x196)][_0xc00f77(0x28a)]||this[_0xc00f77(0x196)][_0xc00f77(0x28a)]<0.1)this['config'][_0xc00f77(0x28a)]=0xc;await initHistory(this),await initSystemConfig(this);if(this[_0xc00f77(0x196)][_0xc00f77(0x242)])try{this['genAI']=new GoogleGenerativeAI(this[_0xc00f77(0x196)]['geminiApiKey']),this[_0xc00f77(0x1ac)]=this['genAI'][_0xc00f77(0x1cd)]({'model':GEMINI_MODEL,'generationConfig':{'responseMimeType':_0xc00f77(0x239)}}),this[_0xc00f77(0x27e)]['info'](_0xc00f77(0x1b9));}catch(_0x26f413){this[_0xc00f77(0x27e)][_0xc00f77(0x152)]('Gemini\x20Init\x20Error:\x20'+_0x26f413[_0xc00f77(0x1c7)]);}await createAllObjects(this),await loadSystemMode(this),await loadRawEventLog(this),await loadDailyDigests(this),this[_0xc00f77(0x294)](_0xc00f77(0x172)),this[_0xc00f77(0x294)](LTM_DP_TRIGGER_DIGEST),this[_0xc00f77(0x294)]('system.mode'),this[_0xc00f77(0x294)](_0xc00f77(0x26f)),this[_0xc00f77(0x294)](_0xc00f77(0x220)),this['subscribeStates'](_0xc00f77(0x214)),await initSensorSubscriptions(this),await initPresenceSubscriptions(this),await setupTelegramListener(this);if(this[_0xc00f77(0x1d5)])clearInterval(this['analysisTimer']);const _0x251a06=this[_0xc00f77(0x196)][_0xc00f77(0x17a)]||0xf;_0x251a06>0x0&&(this['log'][_0xc00f77(0x23a)](_0xc00f77(0x1a9)+_0x251a06+_0xc00f77(0x250)),this[_0xc00f77(0x1d5)]=setInterval(()=>{runAutopilot(this);},_0x251a06*0x3c*0x3e8)),setupLtmScheduler(this),setupModeResetScheduler(this),setupDriftAnalysisScheduler(this),setupBriefingScheduler(this);}[a0_0x58ce74(0x23c)](_0x2db7fc){const _0x4f2295=a0_0x58ce74;if(this[_0x4f2295(0x1d5)])clearInterval(this[_0x4f2295(0x1d5)]);if(this[_0x4f2295(0x23d)])clearInterval(this[_0x4f2295(0x23d)]);if(this[_0x4f2295(0x1b6)])this['ltmJob'][_0x4f2295(0x233)]();if(this[_0x4f2295(0x208)])this['modeResetJob']['cancel']();if(this[_0x4f2295(0x22e)])this[_0x4f2295(0x22e)][_0x4f2295(0x233)]();if(this[_0x4f2295(0x29a)])clearTimeout(this[_0x4f2295(0x29a)]);if(this[_0x4f2295(0x168)])clearTimeout(this['exitGraceTimer']);_0x2db7fc();}async[a0_0x58ce74(0x11b)](_0x1fa6eb,_0x36c08f){const _0x46b572=a0_0x58ce74;if(!_0x36c08f)return;if(_0x1fa6eb['includes'](_0x46b572(0x1af))&&_0x1fa6eb[_0x46b572(0x29e)](_0x46b572(0x29b))&&_0x36c08f[_0x46b572(0x1c8)]){await handleTelegramResponse(this,_0x36c08f[_0x46b572(0x1c8)]);return;}if(_0x1fa6eb===this['namespace']+'.'+SYSTEM_DP_MODE){_0x36c08f['val']&&Object[_0x46b572(0x278)](SYSTEM_MODES)[_0x46b572(0x11a)](_0x36c08f['val'])&&(this[_0x46b572(0x241)]=_0x36c08f[_0x46b572(0x1c8)],_0x36c08f[_0x46b572(0x1c8)]===SYSTEM_MODES[_0x46b572(0x1e7)]?await setPresence(this,![]):await setPresence(this,!![]));if(!_0x36c08f[_0x46b572(0x22f)])this['setState'](_0x1fa6eb,{'val':this[_0x46b572(0x241)],'ack':!![]});return;}if(!_0x36c08f[_0x46b572(0x22f)]){_0x1fa6eb['includes'](_0x46b572(0x172))&&_0x36c08f[_0x46b572(0x1c8)]&&(this[_0x46b572(0x16f)](_0x1fa6eb,{'val':![],'ack':!![]}),runGeminiAnalysis(this));if(_0x1fa6eb[_0x46b572(0x11a)](_0x46b572(0x25f))&&_0x36c08f[_0x46b572(0x1c8)]){this[_0x46b572(0x16f)](_0x1fa6eb,{'val':![],'ack':!![]});if(this[_0x46b572(0x1ab)])createDailyDigest(this);}_0x1fa6eb['includes'](_0x46b572(0x14a))&&_0x36c08f[_0x46b572(0x1c8)]&&(this[_0x46b572(0x16f)](_0x1fa6eb,{'val':![],'ack':!![]}),sendMorningBriefing(this));_0x1fa6eb[_0x46b572(0x11a)](_0x46b572(0x190))&&_0x36c08f[_0x46b572(0x1c8)]&&(this[_0x46b572(0x16f)](_0x1fa6eb,{'val':![],'ack':!![]}),executeAutomationAction(this));return;}if(this['config'][_0x46b572(0x1b8)]&&this['config'][_0x46b572(0x1b8)][_0x46b572(0x11a)](_0x1fa6eb)){await checkWifiPresence(this);return;}const _0x3e7160=(this[_0x46b572(0x196)][_0x46b572(0x127)]||[])[_0x46b572(0x156)](_0x182488=>_0x182488['id']===_0x1fa6eb);if(_0x3e7160)processSensorEvent(this,_0x1fa6eb,_0x36c08f,_0x3e7160);}async['onMessage'](_0x1fff0b){const _0x56ea4d=a0_0x58ce74;if(typeof _0x1fff0b===_0x56ea4d(0x235)&&_0x1fff0b['message'])try{if(_0x1fff0b['command']===_0x56ea4d(0x28e)){if(!_0x1fff0b[_0x56ea4d(0x1c7)]['apiKey'])return this['sendTo'](_0x1fff0b[_0x56ea4d(0x14b)],_0x1fff0b['command'],{'success':![],'message':_0x56ea4d(0x20d)},_0x1fff0b[_0x56ea4d(0x17f)]);try{const _0xb8e1fe=new GoogleGenerativeAI(_0x1fff0b['message']['apiKey'])['getGenerativeModel']({'model':_0x56ea4d(0x1de)});await _0xb8e1fe[_0x56ea4d(0x19d)](_0x56ea4d(0x1e4)),this[_0x56ea4d(0x28f)](_0x1fff0b['from'],_0x1fff0b[_0x56ea4d(0x15c)],{'success':!![],'message':_0x56ea4d(0x1b3)},_0x1fff0b[_0x56ea4d(0x17f)]);}catch(_0x5c3927){this['sendTo'](_0x1fff0b['from'],_0x1fff0b['command'],{'success':![],'message':_0x5c3927[_0x56ea4d(0x1c7)]},_0x1fff0b[_0x56ea4d(0x17f)]);}}else{if(_0x1fff0b[_0x56ea4d(0x15c)]===_0x56ea4d(0x202)){const _0x3853c8=await sendNotification(this,_0x56ea4d(0x285),!![],!![]);this[_0x56ea4d(0x28f)](_0x1fff0b[_0x56ea4d(0x14b)],_0x1fff0b[_0x56ea4d(0x15c)],{'success':_0x3853c8>0x0,'message':_0x3853c8+_0x56ea4d(0x18d)},_0x1fff0b[_0x56ea4d(0x17f)]);}else{if(_0x1fff0b['command']==='getLtmData'){if(!this[_0x56ea4d(0x1ab)])return this[_0x56ea4d(0x28f)](_0x1fff0b[_0x56ea4d(0x14b)],_0x1fff0b[_0x56ea4d(0x15c)],{'success':![],'isPro':![]},_0x1fff0b[_0x56ea4d(0x17f)]);let _0x560be4={'status':'N/A','details':'','lastCheck':0x0};try{_0x560be4[_0x56ea4d(0x126)]=(await this[_0x56ea4d(0x154)](LTM_DP_DRIFT_STATUS))[_0x56ea4d(0x1c8)],_0x560be4[_0x56ea4d(0x1c5)]=(await this['getStateAsync'](LTM_DP_DRIFT_DETAILS))[_0x56ea4d(0x1c8)],_0x560be4[_0x56ea4d(0x11e)]=(await this[_0x56ea4d(0x154)](LTM_DP_DRIFT_LAST_CHECK))[_0x56ea4d(0x1c8)];}catch(_0x53ac35){}const _0x3b1800=this[_0x56ea4d(0x209)]||[];this[_0x56ea4d(0x28f)](_0x1fff0b[_0x56ea4d(0x14b)],_0x1fff0b[_0x56ea4d(0x15c)],{'success':!![],'isPro':!![],'dailyDigests':this[_0x56ea4d(0x14f)],'driftAnalysis':_0x560be4,'analysisHistory':_0x3b1800},_0x1fff0b[_0x56ea4d(0x17f)]);}else{if(_0x1fff0b['command']==='getOverviewData'){const _0x185885=this['dailyDigests']['length'],_0x10224b=this[_0x56ea4d(0x268)][_0x56ea4d(0x198)](_0x33b911=>_0x33b911[_0x56ea4d(0x1cc)]>new Date()[_0x56ea4d(0x206)](0x0,0x0,0x0,0x0))[_0x56ea4d(0x17b)];let _0x4772e5={'status':_0x56ea4d(0x1b7)};try{_0x4772e5['status']=(await this[_0x56ea4d(0x154)](LTM_DP_DRIFT_STATUS))['val'];}catch(_0x3d92b9){}let _0x3682b8=null;!this[_0x56ea4d(0x1ac)]&&(_0x3682b8=this[_0x56ea4d(0x196)]['geminiApiKey']?_0x56ea4d(0x183):'Kein\x20API\x20Key!');let _0x191acd={'detected':![],'description':'','targetId':'','targetValue':'','autoApply':![]};try{const _0x311d28=await this[_0x56ea4d(0x154)]('analysis.automation.patternDetected'),_0x4df69e=await this['getStateAsync'](_0x56ea4d(0x273)),_0x2c8047=await this[_0x56ea4d(0x154)](_0x56ea4d(0x16a)),_0x56fdc2=await this[_0x56ea4d(0x154)](_0x56ea4d(0x1c0)),_0xced64=await this[_0x56ea4d(0x154)](_0x56ea4d(0x214));_0x311d28&&_0x311d28[_0x56ea4d(0x1c8)]&&(_0x191acd['detected']=!![],_0x191acd[_0x56ea4d(0x1fa)]=_0x4df69e?_0x4df69e['val']:'',_0x191acd['targetId']=_0x2c8047?_0x2c8047['val']:'',_0x191acd['targetValue']=_0x56fdc2?_0x56fdc2['val']:''),_0x191acd[_0x56ea4d(0x1b1)]=_0xced64?!!_0xced64['val']:![];}catch(_0x46503e){}this[_0x56ea4d(0x28f)](_0x1fff0b[_0x56ea4d(0x14b)],_0x1fff0b['command'],{'success':!![],'eventHistory':this[_0x56ea4d(0x268)][_0x56ea4d(0x25b)](0x0,0xf),'stats':{'digestCount':_0x185885,'eventCountToday':_0x10224b,'driftStatus':_0x4772e5[_0x56ea4d(0x126)],'isPresent':this[_0x56ea4d(0x20a)],'minDays':this[_0x56ea4d(0x196)][_0x56ea4d(0x265)]||0x7,'stbDays':this[_0x56ea4d(0x196)][_0x56ea4d(0x157)]||0xe,'ltbDays':this['config'][_0x56ea4d(0x2a6)]||0x3c,'systemError':_0x3682b8},'automation':_0x191acd},_0x1fff0b[_0x56ea4d(0x17f)]);}else{if(_0x1fff0b[_0x56ea4d(0x15c)]===_0x56ea4d(0x1ed)){const _0xc8cf24=await this['getForeignObjectsAsync']('enum.functions.*',_0x56ea4d(0x1cf)),_0x27b3cd=[];if(_0xc8cf24)for(const _0x1f278d in _0xc8cf24){const _0x56704e=_0xc8cf24[_0x1f278d],_0x6133d5=(_0x56704e[_0x56ea4d(0x166)]&&typeof _0x56704e[_0x56ea4d(0x166)][_0x56ea4d(0x2a2)]===_0x56ea4d(0x235)?_0x56704e['common'][_0x56ea4d(0x2a2)]['de']:_0x56704e[_0x56ea4d(0x166)][_0x56ea4d(0x2a2)])||_0x56704e[_0x56ea4d(0x166)][_0x56ea4d(0x2a2)];_0x27b3cd[_0x56ea4d(0x18e)]({'id':_0x1f278d,'name':_0x6133d5});}this['sendTo'](_0x1fff0b[_0x56ea4d(0x14b)],_0x1fff0b[_0x56ea4d(0x15c)],{'success':!![],'enums':_0x27b3cd},_0x1fff0b['callback']);}else{if(_0x1fff0b[_0x56ea4d(0x15c)]===_0x56ea4d(0x26b))try{const _0x6558af=await scanForDevices(this,_0x1fff0b['message']||{});this['sendTo'](_0x1fff0b[_0x56ea4d(0x14b)],_0x1fff0b['command'],{'success':!![],'devices':_0x6558af},_0x1fff0b[_0x56ea4d(0x17f)]);}catch(_0x5eeda7){this[_0x56ea4d(0x28f)](_0x1fff0b[_0x56ea4d(0x14b)],_0x1fff0b[_0x56ea4d(0x15c)],{'success':![],'error':_0x5eeda7[_0x56ea4d(0x1c7)]},_0x1fff0b[_0x56ea4d(0x17f)]);}else{if(_0x1fff0b[_0x56ea4d(0x15c)]===_0x56ea4d(0x139)){const _0x36b8ad=_0x1fff0b[_0x56ea4d(0x1c7)][_0x56ea4d(0x25e)];if(!_0x36b8ad)return this[_0x56ea4d(0x28f)](_0x1fff0b[_0x56ea4d(0x14b)],_0x1fff0b[_0x56ea4d(0x15c)],{'success':![],'error':_0x56ea4d(0x287)},_0x1fff0b[_0x56ea4d(0x17f)]);const _0x3c6998=await getCalendarNames(this,_0x36b8ad);this['sendTo'](_0x1fff0b[_0x56ea4d(0x14b)],_0x1fff0b[_0x56ea4d(0x15c)],{'success':!![],'names':_0x3c6998},_0x1fff0b[_0x56ea4d(0x17f)]);}else{if(_0x1fff0b[_0x56ea4d(0x15c)]===_0x56ea4d(0x244)){const {historyId:_0x24c039,rating:_0x7fbd21,comment:_0x19eeed,alertReason:_0xefd030}=_0x1fff0b[_0x56ea4d(0x1c7)];_0x24c039&&_0x7fbd21?(await saveFeedback(this,{'timestamp':Date[_0x56ea4d(0x267)](),'historyId':_0x24c039,'rating':_0x7fbd21,'comment':_0x19eeed,'alertReason':_0xefd030}),this[_0x56ea4d(0x28f)](_0x1fff0b[_0x56ea4d(0x14b)],_0x1fff0b[_0x56ea4d(0x15c)],{'success':!![]},_0x1fff0b[_0x56ea4d(0x17f)])):this[_0x56ea4d(0x28f)](_0x1fff0b[_0x56ea4d(0x14b)],_0x1fff0b[_0x56ea4d(0x15c)],{'success':![],'error':_0x56ea4d(0x207)},_0x1fff0b[_0x56ea4d(0x17f)]);}}}}}}}}}catch(_0x132871){this[_0x56ea4d(0x27e)]['error'](_0x56ea4d(0x291)+_0x1fff0b[_0x56ea4d(0x15c)]+':\x20'+_0x132871['message']);if(_0x1fff0b['callback'])this[_0x56ea4d(0x28f)](_0x1fff0b['from'],_0x1fff0b[_0x56ea4d(0x15c)],{'success':![],'error':_0x132871[_0x56ea4d(0x1c7)]},_0x1fff0b[_0x56ea4d(0x17f)]);}}}async function initZombies(_0xca685a){const _0x54a9=a0_0x58ce74;try{const _0x3957a2=[_0x54a9(0x200),'events.history_debug_00'];for(const _0x5e8e2a of _0x3957a2){try{const _0x5c1c0c=await _0xca685a['getObjectAsync'](_0x5e8e2a);_0x5c1c0c&&await _0xca685a[_0x54a9(0x151)](_0x5e8e2a);}catch(_0x3676ff){}}}catch(_0x5cb36f){}}async function initHistory(_0xdef1d8){const _0x380c9=a0_0x58ce74;try{const _0x4f8884=await _0xdef1d8[_0x380c9(0x154)](_0x380c9(0x28d));_0x4f8884&&_0x4f8884[_0x380c9(0x1c8)]&&(_0xdef1d8[_0x380c9(0x268)]=JSON[_0x380c9(0x1d4)](_0x4f8884['val'][_0x380c9(0x176)]()));}catch(_0x416ab7){_0xdef1d8[_0x380c9(0x268)]=[];}try{const _0x53641f=await _0xdef1d8[_0x380c9(0x154)](_0x380c9(0x229));if(_0x53641f&&_0x53641f[_0x380c9(0x1c8)])_0xdef1d8[_0x380c9(0x209)]=JSON[_0x380c9(0x1d4)](_0x53641f[_0x380c9(0x1c8)][_0x380c9(0x176)]());}catch(_0x17cd2e){_0xdef1d8[_0x380c9(0x209)]=[];}}function a0_0x2c29(_0x3dff6f,_0x4f75bb){const _0xb18811=a0_0x1517();return a0_0x2c29=function(_0x5d36ee,_0x3ef307){_0x5d36ee=_0x5d36ee-0x116;let _0x151701=_0xb18811[_0x5d36ee];return _0x151701;},a0_0x2c29(_0x3dff6f,_0x4f75bb);}async function initSystemConfig(_0x576c50){const _0x34cad7=a0_0x58ce74;try{const _0x33fef5=await _0x576c50[_0x34cad7(0x219)]('system.config');_0x33fef5&&_0x33fef5[_0x34cad7(0x166)]&&(_0x576c50[_0x34cad7(0x1f8)]={'latitude':_0x33fef5['common']['latitude']||0x0,'longitude':_0x33fef5['common'][_0x34cad7(0x12d)]||0x0,'city':_0x33fef5['common'][_0x34cad7(0x16c)]||''});}catch(_0x5025eb){}}async function checkLicense(_0x2d18b4,_0x9e514d){const _0x3c10f0=a0_0x58ce74;if(!_0x9e514d)return![];_0x2d18b4['systemUUID']=await getSystemUUID(_0x2d18b4);if(_0x9e514d==='TEST-PRO-KEY'||_0x9e514d['startsWith'](_0x3c10f0(0x298)))return!![];return![];}async function getSystemUUID(_0x44e12d){const _0x5af9d6=a0_0x58ce74;try{const _0x39e6ee=await _0x44e12d['getForeignObjectAsync'](_0x5af9d6(0x1ad));if(_0x39e6ee&&_0x39e6ee[_0x5af9d6(0x161)]&&_0x39e6ee[_0x5af9d6(0x161)][_0x5af9d6(0x2ac)])return _0x39e6ee['native'][_0x5af9d6(0x2ac)];return _0x5af9d6(0x2a7);}catch(_0x4f077a){return _0x5af9d6(0x231);}}async function createAllObjects(_0x581d09){const _0x506e60=a0_0x58ce74;await checkSystemObjects(_0x581d09),await _0x581d09[_0x506e60(0x173)](_0x506e60(0x184),{'type':_0x506e60(0x1ae),'common':{'name':'Last\x20raw\x20event','type':'string','role':'json','read':!![],'write':![]},'native':{}}),await _0x581d09[_0x506e60(0x173)]('events.history',{'type':_0x506e60(0x1ae),'common':{'name':_0x506e60(0x15e),'type':_0x506e60(0x18b),'role':_0x506e60(0x238),'read':!![],'write':![]},'native':{}}),await _0x581d09['setObjectNotExistsAsync'](_0x506e60(0x172),{'type':_0x506e60(0x1ae),'common':{'name':'Trigger\x20Analysis','type':'boolean','role':_0x506e60(0x1a0),'read':!![],'write':!![],'def':![]},'native':{}}),await _0x581d09['setObjectNotExistsAsync'](_0x506e60(0x26f),{'type':_0x506e60(0x1ae),'common':{'name':_0x506e60(0x1ca),'type':'boolean','role':_0x506e60(0x1a0),'read':!![],'write':!![],'def':![]},'native':{}}),await _0x581d09[_0x506e60(0x173)](_0x506e60(0x256),{'type':_0x506e60(0x1ae),'common':{'name':'Last\x20Result','type':_0x506e60(0x18b),'role':_0x506e60(0x238),'read':!![],'write':![]},'native':{}}),await _0x581d09[_0x506e60(0x173)]('analysis.isAlert',{'type':'state','common':{'name':'AI\x20Alert\x20Status','type':_0x506e60(0x13e),'role':'indicator.alarm','read':!![],'write':![],'def':![]},'native':{}}),await _0x581d09['setObjectNotExistsAsync'](_0x506e60(0x187),{'type':_0x506e60(0x1ae),'common':{'name':_0x506e60(0x224),'type':'boolean','role':_0x506e60(0x179),'read':!![],'write':![],'def':![]},'native':{}}),await _0x581d09[_0x506e60(0x173)](_0x506e60(0x279),{'type':_0x506e60(0x1ae),'common':{'name':_0x506e60(0x17c),'type':_0x506e60(0x18b),'role':_0x506e60(0x1fe),'read':!![],'write':![]},'native':{}}),await _0x581d09[_0x506e60(0x173)]('analysis.activitySummary',{'type':_0x506e60(0x1ae),'common':{'name':_0x506e60(0x26d),'type':_0x506e60(0x18b),'role':_0x506e60(0x19f),'read':!![],'write':![]},'native':{}}),await _0x581d09[_0x506e60(0x173)](_0x506e60(0x2ab),{'type':_0x506e60(0x1ae),'common':{'name':'Deviation','type':'string','role':_0x506e60(0x1ae),'read':!![],'write':![],'def':'N/A'},'native':{}}),await _0x581d09[_0x506e60(0x173)](_0x506e60(0x1a6),{'type':'state','common':{'name':_0x506e60(0x1fb),'type':_0x506e60(0x18b),'role':_0x506e60(0x19f),'read':!![],'write':![]},'native':{}}),await _0x581d09[_0x506e60(0x173)](_0x506e60(0x2a0),{'type':_0x506e60(0x1ae),'common':{'name':'Comfort\x20Suggestion','type':_0x506e60(0x18b),'role':_0x506e60(0x19f),'read':!![],'write':![]},'native':{}}),await _0x581d09[_0x506e60(0x1f6)](_0x506e60(0x131),{'type':_0x506e60(0x147),'common':{'name':'Automation\x20Proposals'},'native':{}}),await _0x581d09[_0x506e60(0x173)](_0x506e60(0x169),{'type':_0x506e60(0x1ae),'common':{'name':'Pattern\x20Detected','type':_0x506e60(0x13e),'role':_0x506e60(0x155),'read':!![],'write':![],'def':![]},'native':{}}),await _0x581d09[_0x506e60(0x173)](_0x506e60(0x273),{'type':_0x506e60(0x1ae),'common':{'name':_0x506e60(0x289),'type':_0x506e60(0x18b),'role':_0x506e60(0x19f),'read':!![],'write':![]},'native':{}}),await _0x581d09['setObjectNotExistsAsync'](_0x506e60(0x283),{'type':_0x506e60(0x1ae),'common':{'name':_0x506e60(0x21b),'type':_0x506e60(0x18b),'role':_0x506e60(0x19f),'read':!![],'write':![]},'native':{}}),await _0x581d09[_0x506e60(0x173)](_0x506e60(0x16a),{'type':_0x506e60(0x1ae),'common':{'name':_0x506e60(0x1ba),'type':'string','role':_0x506e60(0x19f),'read':!![],'write':![]},'native':{}}),await _0x581d09[_0x506e60(0x173)](_0x506e60(0x1c0),{'type':_0x506e60(0x1ae),'common':{'name':'Target\x20Value','type':_0x506e60(0x18b),'role':_0x506e60(0x19f),'read':!![],'write':![]},'native':{}}),await _0x581d09[_0x506e60(0x173)](_0x506e60(0x214),{'type':_0x506e60(0x1ae),'common':{'name':_0x506e60(0x1bf),'type':_0x506e60(0x13e),'role':_0x506e60(0x257),'read':!![],'write':!![],'def':![]},'native':{}}),await _0x581d09[_0x506e60(0x173)](_0x506e60(0x220),{'type':'state','common':{'name':'Trigger\x20Action\x20Now','type':_0x506e60(0x13e),'role':_0x506e60(0x1a0),'read':!![],'write':!![],'def':![]},'native':{}}),await _0x581d09[_0x506e60(0x173)](_0x506e60(0x229),{'type':_0x506e60(0x1ae),'common':{'name':_0x506e60(0x266),'type':_0x506e60(0x18b),'role':_0x506e60(0x238),'read':!![],'write':![],'def':'[]'},'native':{}}),await _0x581d09[_0x506e60(0x173)]('analysis.feedbackHistory',{'type':_0x506e60(0x1ae),'common':{'name':_0x506e60(0x24c),'type':_0x506e60(0x18b),'role':_0x506e60(0x238),'read':!![],'write':![],'def':'[]'},'native':{}}),await _0x581d09[_0x506e60(0x1f6)]('analysis.health',{'type':'channel','common':{'name':'Health\x20&\x20Sleep\x20Analysis'},'native':{}}),await _0x581d09['setObjectNotExistsAsync']('analysis.health.sleepScore',{'type':_0x506e60(0x1ae),'common':{'name':_0x506e60(0x25a),'type':_0x506e60(0x193),'role':_0x506e60(0x280),'read':!![],'write':![],'def':0x0},'native':{}}),await _0x581d09[_0x506e60(0x173)]('analysis.health.restlessness',{'type':_0x506e60(0x1ae),'common':{'name':'Restlessness\x20Level','type':'string','role':_0x506e60(0x19f),'read':!![],'write':![],'def':_0x506e60(0x13b)},'native':{}}),await _0x581d09['setObjectNotExistsAsync'](_0x506e60(0x162),{'type':_0x506e60(0x1ae),'common':{'name':_0x506e60(0x1f7),'type':_0x506e60(0x18b),'role':_0x506e60(0x19f),'read':!![],'write':![],'def':''},'native':{}}),await checkLtmObjects(_0x581d09),await checkLtmDriftObjects(_0x581d09);}async function checkSystemObjects(_0x5037c2){const _0x116337=a0_0x58ce74;await _0x5037c2[_0x116337(0x1f6)](_0x116337(0x21f),{'type':'channel','common':{'name':_0x116337(0x18c)},'native':{}}),await _0x5037c2[_0x116337(0x1f6)](SYSTEM_DP_MODE,{'type':'state','common':{'name':_0x116337(0x1a2),'type':_0x116337(0x18b),'role':_0x116337(0x1ae),'read':!![],'write':!![],'def':SYSTEM_MODES[_0x116337(0x1bc)],'states':{[SYSTEM_MODES[_0x116337(0x1bc)]]:_0x116337(0x1d7),[SYSTEM_MODES[_0x116337(0x1e7)]]:_0x116337(0x246),[SYSTEM_MODES[_0x116337(0x1f5)]]:_0x116337(0x1bd),[SYSTEM_MODES[_0x116337(0x221)]]:_0x116337(0x251)}},'native':{}});}async function checkLtmObjects(_0x139c44){const _0x5789e4=a0_0x58ce74;await _0x139c44[_0x5789e4(0x1f6)]('LTM',{'type':'channel','common':{'name':_0x5789e4(0x217)},'native':{}}),await _0x139c44[_0x5789e4(0x1f6)](LTM_DP_RAW_LOG,{'type':_0x5789e4(0x1ae),'common':{'name':_0x5789e4(0x12a),'type':_0x5789e4(0x18b),'role':_0x5789e4(0x238),'read':!![],'write':![]},'native':{}}),await _0x139c44[_0x5789e4(0x1f6)](LTM_DP_DAILY_DIGESTS,{'type':'state','common':{'name':_0x5789e4(0x1aa),'type':_0x5789e4(0x18b),'role':_0x5789e4(0x238),'read':!![],'write':![]},'native':{}}),await _0x139c44[_0x5789e4(0x1f6)](LTM_DP_STATUS,{'type':_0x5789e4(0x1ae),'common':{'name':_0x5789e4(0x171),'type':'string','role':'text','read':!![],'write':![]},'native':{}}),await _0x139c44[_0x5789e4(0x1f6)](LTM_DP_TRIGGER_DIGEST,{'type':'state','common':{'name':_0x5789e4(0x1df),'type':'boolean','role':'button','read':!![],'write':!![],'def':![]},'native':{}}),await _0x139c44[_0x5789e4(0x1f6)](LTM_DP_BASELINE_STATUS,{'type':_0x5789e4(0x1ae),'common':{'name':_0x5789e4(0x16d),'type':_0x5789e4(0x18b),'role':'text','read':!![],'write':![]},'native':{}});}async function checkLtmDriftObjects(_0x528b79){const _0x42e216=a0_0x58ce74;await _0x528b79[_0x42e216(0x1f6)](LTM_DP_DRIFT_CHANNEL,{'type':'channel','common':{'name':_0x42e216(0x2a3)},'native':{}}),await _0x528b79['extendObjectAsync'](LTM_DP_DRIFT_STATUS,{'type':'state','common':{'name':'Drift\x20Status','type':_0x42e216(0x18b),'role':_0x42e216(0x1ae),'read':!![],'write':![],'def':_0x42e216(0x1b7)},'native':{}}),await _0x528b79[_0x42e216(0x1f6)](LTM_DP_DRIFT_DETAILS,{'type':_0x42e216(0x1ae),'common':{'name':_0x42e216(0x27c),'type':_0x42e216(0x18b),'role':_0x42e216(0x19f),'read':!![],'write':![]},'native':{}}),await _0x528b79[_0x42e216(0x1f6)](LTM_DP_DRIFT_LAST_CHECK,{'type':_0x42e216(0x1ae),'common':{'name':_0x42e216(0x12e),'type':'number','role':'date','read':!![],'write':![]},'native':{}});}async function loadSystemMode(_0xb05100){const _0x43e99b=a0_0x58ce74;try{const _0xb4ca40=await _0xb05100[_0x43e99b(0x154)](SYSTEM_DP_MODE);_0xb4ca40&&_0xb4ca40[_0x43e99b(0x1c8)]&&Object[_0x43e99b(0x278)](SYSTEM_MODES)['includes'](_0xb4ca40[_0x43e99b(0x1c8)])?_0xb05100[_0x43e99b(0x241)]=_0xb4ca40[_0x43e99b(0x1c8)]:(_0xb05100[_0x43e99b(0x241)]=SYSTEM_MODES[_0x43e99b(0x1bc)],await _0xb05100['setStateAsync'](SYSTEM_DP_MODE,{'val':SYSTEM_MODES[_0x43e99b(0x1bc)],'ack':!![]}));}catch(_0x17e5f7){_0xb05100['currentSystemMode']=SYSTEM_MODES[_0x43e99b(0x1bc)];}}async function loadRawEventLog(_0x5127ff){const _0x5131e2=a0_0x58ce74;try{const _0x200f71=await _0x5127ff[_0x5131e2(0x154)](LTM_DP_RAW_LOG);if(_0x200f71&&_0x200f71[_0x5131e2(0x1c8)])_0x5127ff['rawEventLog']=JSON[_0x5131e2(0x1d4)](_0x200f71[_0x5131e2(0x1c8)]);}catch(_0x4e4154){_0x5127ff['rawEventLog']=[];}}async function loadDailyDigests(_0xb99f9b){const _0x21b8f7=a0_0x58ce74;try{const _0x237767=await _0xb99f9b[_0x21b8f7(0x154)](LTM_DP_DAILY_DIGESTS);if(_0x237767&&_0x237767['val'])_0xb99f9b[_0x21b8f7(0x14f)]=JSON[_0x21b8f7(0x1d4)](_0x237767[_0x21b8f7(0x1c8)]);}catch(_0x3a1fa8){_0xb99f9b[_0x21b8f7(0x14f)]=[];}await updateBaselineStatus(_0xb99f9b);}async function saveRawEventLog(_0x567bac){const _0x4d240e=a0_0x58ce74;_0x567bac[_0x4d240e(0x25d)][_0x4d240e(0x17b)]>RAW_LOG_MAX_SIZE&&_0x567bac[_0x4d240e(0x25d)][_0x4d240e(0x116)](0x0,_0x567bac[_0x4d240e(0x25d)][_0x4d240e(0x17b)]-RAW_LOG_MAX_SIZE),await _0x567bac['setStateAsync'](LTM_DP_RAW_LOG,{'val':JSON[_0x4d240e(0x1d6)](_0x567bac[_0x4d240e(0x25d)]),'ack':!![]});}async function saveDailyDigests(_0x1af868,_0x3617af=!![]){const _0x2eff99=a0_0x58ce74,_0x3b3a45=_0x1af868[_0x2eff99(0x196)][_0x2eff99(0x2a6)]||0x3c;_0x1af868[_0x2eff99(0x14f)][_0x2eff99(0x17b)]>_0x3b3a45&&_0x1af868[_0x2eff99(0x14f)][_0x2eff99(0x116)](0x0,_0x1af868[_0x2eff99(0x14f)]['length']-_0x3b3a45);await _0x1af868[_0x2eff99(0x27f)](LTM_DP_DAILY_DIGESTS,{'val':JSON['stringify'](_0x1af868['dailyDigests']),'ack':!![]});if(_0x3617af)await updateBaselineStatus(_0x1af868);}async function updateAnalysisHistory(_0x5e55f5,_0x5d1bb1){const _0x50a640=a0_0x58ce74;_0x5e55f5[_0x50a640(0x209)][_0x50a640(0x11c)](_0x5d1bb1);if(_0x5e55f5[_0x50a640(0x209)]['length']>ANALYSIS_HISTORY_MAX_SIZE)_0x5e55f5['analysisHistory']['pop']();await _0x5e55f5[_0x50a640(0x27f)](_0x50a640(0x229),{'val':JSON['stringify'](_0x5e55f5[_0x50a640(0x209)]),'ack':!![]});}async function updateBaselineStatus(_0x444a99){const _0x138ef1=a0_0x58ce74;if(!_0x444a99[_0x138ef1(0x1ab)]){await _0x444a99['setStateAsync'](LTM_DP_BASELINE_STATUS,{'val':_0x138ef1(0x288),'ack':!![]});return;}const _0x8b942d=_0x444a99[_0x138ef1(0x14f)][_0x138ef1(0x17b)]>=(_0x444a99['config'][_0x138ef1(0x265)]||0x7)?_0x138ef1(0x19b)+_0x444a99[_0x138ef1(0x14f)][_0x138ef1(0x17b)]+_0x138ef1(0x165):'Lernphase\x20('+_0x444a99[_0x138ef1(0x14f)]['length']+'/'+(_0x444a99[_0x138ef1(0x196)][_0x138ef1(0x265)]||0x7)+')';await _0x444a99[_0x138ef1(0x27f)](LTM_DP_BASELINE_STATUS,{'val':_0x8b942d,'ack':!![]});}async function initSensorSubscriptions(_0x180244){const _0x51116d=a0_0x58ce74,_0x4107c1=_0x180244['config'][_0x51116d(0x127)];if(_0x4107c1&&_0x4107c1[_0x51116d(0x17b)]>0x0){_0x180244[_0x51116d(0x27e)][_0x51116d(0x23a)](_0x51116d(0x1e3)+_0x4107c1[_0x51116d(0x17b)]+_0x51116d(0x195));for(const _0xb89b72 of _0x4107c1){if(_0xb89b72['id']){await _0x180244['subscribeForeignStatesAsync'](_0xb89b72['id']);try{const _0xa080a6=await _0x180244[_0x51116d(0x1c3)](_0xb89b72['id']);if(_0xa080a6)_0x180244[_0x51116d(0x276)][_0xb89b72['id']]=_0xa080a6[_0x51116d(0x1c8)];}catch(_0x4a8fc5){}}}}}async function initPresenceSubscriptions(_0x3c25af){const _0x11d0fd=a0_0x58ce74,_0x9d2e0a=_0x3c25af['config'][_0x11d0fd(0x1b8)]||[];if(_0x9d2e0a[_0x11d0fd(0x17b)]>0x0){_0x3c25af[_0x11d0fd(0x27e)]['info'](_0x11d0fd(0x1e3)+_0x9d2e0a[_0x11d0fd(0x17b)]+_0x11d0fd(0x253));for(const _0x6d4128 of _0x9d2e0a){await _0x3c25af[_0x11d0fd(0x25c)](_0x6d4128);}try{await checkWifiPresence(_0x3c25af);}catch(_0x4212a3){}}}async function getWeatherContext(_0x398ce5){const _0x5dfa67=a0_0x58ce74;try{if(!_0x398ce5[_0x5dfa67(0x196)][_0x5dfa67(0x245)])return _0x5dfa67(0x284);let _0x418817='';const _0x7603b1=_0x398ce5[_0x5dfa67(0x196)][_0x5dfa67(0x205)];if(_0x7603b1)try{if(_0x7603b1['includes']('accuweather')){const _0x4ca514=await _0x398ce5[_0x5dfa67(0x1c3)](_0x7603b1+'.Summary.Current');if(_0x4ca514&&_0x4ca514[_0x5dfa67(0x1c8)])_0x418817=_0x4ca514[_0x5dfa67(0x1c8)];}else{if(_0x7603b1['includes'](_0x5dfa67(0x215))){const _0x3c4dd5=await _0x398ce5[_0x5dfa67(0x1c3)](_0x7603b1+'.NextHours.Location_1.Day_1.current.symbol_desc');if(_0x3c4dd5&&_0x3c4dd5[_0x5dfa67(0x1c8)])_0x418817=_0x3c4dd5[_0x5dfa67(0x1c8)];}else{if(_0x7603b1[_0x5dfa67(0x11a)]('openweathermap')){const _0x4add9c=await _0x398ce5['getForeignStateAsync'](_0x7603b1+_0x5dfa67(0x29d));if(_0x4add9c&&_0x4add9c[_0x5dfa67(0x1c8)])_0x418817=_0x4add9c[_0x5dfa67(0x1c8)];}}}}catch(_0x3a6990){}if(!_0x418817){const _0x1bac07=[_0x5dfa67(0x21c),'daswetter.0','weatherunderground.0',_0x5dfa67(0x194)];for(const _0x195517 of _0x1bac07){try{const _0x4152e2=await _0x398ce5[_0x5dfa67(0x219)](_0x195517);if(_0x4152e2){if(_0x195517[_0x5dfa67(0x11a)](_0x5dfa67(0x120))){const _0x29d0be=await _0x398ce5[_0x5dfa67(0x1c3)](_0x195517+'.Summary.Current');if(_0x29d0be&&_0x29d0be[_0x5dfa67(0x1c8)]){_0x418817=_0x29d0be[_0x5dfa67(0x1c8)];break;}}}}catch(_0x5e0aee){}}}return _0x418817?_0x5dfa67(0x1b5)+_0x418817:_0x5dfa67(0x236);}catch(_0x54f59a){return'WETTER\x20ERROR:\x20'+_0x54f59a[_0x5dfa67(0x1c7)];}}async function getCalendarContext(_0x5a66c5){const _0x55dec2=a0_0x58ce74;try{if(!_0x5a66c5['config'][_0x55dec2(0x19c)])return _0x55dec2(0x22d);let _0x2dc935=_0x5a66c5[_0x55dec2(0x196)][_0x55dec2(0x143)]||_0x55dec2(0x24e),_0x1e132f=_0x5a66c5['config']['calendarSelection']||[];if(typeof _0x1e132f==='string')_0x1e132f=_0x1e132f[_0x55dec2(0x1e5)](',');try{const _0x40f5f=await _0x5a66c5[_0x55dec2(0x1c3)](_0x2dc935+_0x55dec2(0x286));if(_0x40f5f&&_0x40f5f[_0x55dec2(0x1c8)]){let _0x3b8c6c=tryParse(_0x40f5f[_0x55dec2(0x1c8)]);if(_0x3b8c6c&&Array[_0x55dec2(0x123)](_0x3b8c6c)){if(_0x1e132f[_0x55dec2(0x17b)]>0x0)_0x3b8c6c=_0x3b8c6c['filter'](_0x2755bb=>_0x1e132f[_0x55dec2(0x11a)](_0x2755bb[_0x55dec2(0x252)]||''));else return _0x55dec2(0x141);if(_0x3b8c6c[_0x55dec2(0x17b)]>0x0){const _0x1ea4d6=_0x3b8c6c[_0x55dec2(0x25b)](0x0,0x3)[_0x55dec2(0x20e)](_0x28ed91=>{const _0x2e70ec=_0x55dec2;let _0xdd1673=_0x28ed91[_0x2e70ec(0x26e)];if(_0x28ed91[_0x2e70ec(0x144)])_0xdd1673+='\x20'+_0x28ed91[_0x2e70ec(0x144)];return _0xdd1673+':\x20'+_0x28ed91[_0x2e70ec(0x212)]+'\x20('+_0x28ed91[_0x2e70ec(0x252)]+')';});return _0x55dec2(0x192)+_0x1ea4d6[_0x55dec2(0x290)](_0x55dec2(0x255));}else return _0x55dec2(0x13f);}}}catch(_0x31eebc){_0x5a66c5[_0x55dec2(0x27e)][_0x55dec2(0x18f)](_0x55dec2(0x1a7)+_0x31eebc[_0x55dec2(0x1c7)]);}return _0x55dec2(0x299);}catch(_0x4443b8){return'KALENDER\x20ERROR:\x20'+_0x4443b8[_0x55dec2(0x1c7)];}}async function getCalendarNames(_0x5bcf62,_0x137465){const _0x2d0b3c=a0_0x58ce74;try{const _0x45f1b2=await _0x5bcf62[_0x2d0b3c(0x1c3)](_0x137465+_0x2d0b3c(0x286));if(_0x45f1b2&&_0x45f1b2['val']){const _0x1bf3eb=tryParse(_0x45f1b2['val']);if(_0x1bf3eb&&Array[_0x2d0b3c(0x123)](_0x1bf3eb)){const _0x39bbe6=[...new Set(_0x1bf3eb[_0x2d0b3c(0x20e)](_0x3643eb=>_0x3643eb[_0x2d0b3c(0x252)])[_0x2d0b3c(0x198)](Boolean))];return _0x39bbe6[_0x2d0b3c(0x20f)]();}}return[];}catch(_0x229314){return _0x5bcf62[_0x2d0b3c(0x27e)]['error'](_0x2d0b3c(0x140)+_0x229314[_0x2d0b3c(0x1c7)]),[];}}async function checkWifiPresence(_0x4f24e8){const _0x2ed996=a0_0x58ce74;try{const _0x3703b4=_0x4f24e8[_0x2ed996(0x196)][_0x2ed996(0x1b8)]||[];let _0x979c89=![];for(const _0x4b35d4 of _0x3703b4){try{const _0x248aeb=await _0x4f24e8['getForeignStateAsync'](_0x4b35d4);if(_0x248aeb&&(_0x248aeb['val']===!![]||_0x248aeb['val']===_0x2ed996(0x1c1)||_0x248aeb['val']===0x1)){_0x979c89=!![];break;}}catch(_0x3b0c1a){}}return _0x979c89&&(_0x4f24e8[_0x2ed996(0x29a)]&&(_0x4f24e8['log'][_0x2ed996(0x23a)](_0x2ed996(0x29f)),abortExitTimer(_0x4f24e8)),!_0x4f24e8[_0x2ed996(0x20a)]&&_0x4f24e8[_0x2ed996(0x241)]===SYSTEM_MODES[_0x2ed996(0x1bc)]&&await setPresence(_0x4f24e8,!![])),_0x979c89;}catch(_0x3074a2){return _0x4f24e8[_0x2ed996(0x27e)][_0x2ed996(0x152)](_0x2ed996(0x17d)+_0x3074a2[_0x2ed996(0x1c7)]),![];}}function startExitTimer(_0x20c52d){const _0x38f451=a0_0x58ce74;abortExitTimer(_0x20c52d),_0x20c52d[_0x38f451(0x243)]=!![],_0x20c52d['exitGraceTimer']=setTimeout(()=>{const _0x8ad685=_0x38f451;_0x20c52d[_0x8ad685(0x243)]=![];},EXIT_GRACE_PERIOD_SECONDS*0x3e8),_0x20c52d[_0x38f451(0x29a)]=setTimeout(()=>{const _0x24acf8=_0x38f451;setPresence(_0x20c52d,![]),_0x20c52d[_0x24acf8(0x29a)]=null;},EXIT_TIMER_MINUTES*0x3c*0x3e8);}function abortExitTimer(_0x89ee99){const _0x3e90de=a0_0x58ce74;if(_0x89ee99['exitTimer'])clearTimeout(_0x89ee99[_0x3e90de(0x29a)]);if(_0x89ee99[_0x3e90de(0x168)])clearTimeout(_0x89ee99[_0x3e90de(0x168)]);_0x89ee99[_0x3e90de(0x29a)]=null,_0x89ee99[_0x3e90de(0x168)]=null,_0x89ee99['isGracePeriodActive']=![];}async function setPresence(_0x376fc3,_0x536cc4){const _0x4624e0=a0_0x58ce74;if(_0x376fc3[_0x4624e0(0x20a)]===_0x536cc4)return;_0x376fc3[_0x4624e0(0x20a)]=_0x536cc4,await _0x376fc3[_0x4624e0(0x27f)](_0x4624e0(0x26a),{'val':_0x536cc4,'ack':!![]});}async function saveFeedback(_0x51cc6f,_0x5e31e1){const _0x53b48c=a0_0x58ce74;_0x51cc6f[_0x53b48c(0x27e)][_0x53b48c(0x23a)](_0x53b48c(0x180)+JSON[_0x53b48c(0x1d6)](_0x5e31e1));}async function runBaselineDriftAnalysis(_0x15a2e1){const _0x2aebe3=a0_0x58ce74;if(!_0x15a2e1['isProVersion']||!_0x15a2e1['geminiModel'])return;const _0x5658b9=_0x15a2e1['config'][_0x2aebe3(0x157)]||0xe;if(_0x15a2e1[_0x2aebe3(0x14f)][_0x2aebe3(0x17b)]<_0x5658b9+(_0x15a2e1['config']['minDaysForBaseline']||0x7)){await _0x15a2e1[_0x2aebe3(0x27f)](LTM_DP_DRIFT_STATUS,{'val':_0x2aebe3(0x181),'ack':!![]});return;}const _0x48f3ca=_0x15a2e1[_0x2aebe3(0x14f)][_0x2aebe3(0x25b)](-_0x5658b9),_0x19a140=_0x15a2e1[_0x2aebe3(0x14f)][_0x2aebe3(0x25b)](0x0,_0x15a2e1[_0x2aebe3(0x14f)]['length']-_0x5658b9),_0x23d3ee=_0x2aebe3(0x21e)+JSON[_0x2aebe3(0x1d6)](_0x19a140)+_0x2aebe3(0x117)+JSON[_0x2aebe3(0x1d6)](_0x48f3ca);try{const _0x12d523=await _0x15a2e1[_0x2aebe3(0x1ac)][_0x2aebe3(0x19d)](_0x23d3ee),_0x1e31d1=JSON[_0x2aebe3(0x1d4)](_0x12d523[_0x2aebe3(0x2a5)][_0x2aebe3(0x19f)]()[_0x2aebe3(0x260)](/```json|```/g,'')[_0x2aebe3(0x232)]());_0x1e31d1['baselineDrift']&&(await _0x15a2e1[_0x2aebe3(0x27f)](LTM_DP_DRIFT_STATUS,{'val':_0x1e31d1[_0x2aebe3(0x137)],'ack':!![]}),await _0x15a2e1['setStateAsync'](LTM_DP_DRIFT_DETAILS,{'val':_0x1e31d1[_0x2aebe3(0x272)],'ack':!![]}),await _0x15a2e1[_0x2aebe3(0x27f)](LTM_DP_DRIFT_LAST_CHECK,{'val':Date[_0x2aebe3(0x267)](),'ack':!![]}));}catch(_0x4b09ba){}}function setupLtmScheduler(_0x2286be){const _0x47aeb8=a0_0x58ce74;try{if(_0x2286be[_0x47aeb8(0x1b6)])_0x2286be['ltmJob'][_0x47aeb8(0x233)]();if(!_0x2286be[_0x47aeb8(0x1ab)]){_0x2286be[_0x47aeb8(0x27f)](LTM_DP_STATUS,{'val':_0x47aeb8(0x288),'ack':!![]});return;}_0x2286be[_0x47aeb8(0x1b6)]=schedule[_0x47aeb8(0x247)](LTM_SCHEDULE,()=>createDailyDigest(_0x2286be));}catch(_0x33f313){_0x2286be[_0x47aeb8(0x27e)]['error']('LTM\x20Sched\x20Error:\x20'+_0x33f313['message']);}}function setupModeResetScheduler(_0x385ee3){const _0x346735=a0_0x58ce74;try{if(_0x385ee3['modeResetJob'])_0x385ee3['modeResetJob'][_0x346735(0x233)]();_0x385ee3[_0x346735(0x208)]=schedule[_0x346735(0x247)](MODE_RESET_SCHEDULE,async()=>{const _0x2ff426=_0x346735;await loadSystemMode(_0x385ee3),AUTO_RESET_MODES[_0x2ff426(0x11a)](_0x385ee3[_0x2ff426(0x241)])&&await _0x385ee3['setStateAsync'](SYSTEM_DP_MODE,{'val':SYSTEM_MODES[_0x2ff426(0x1bc)],'ack':![]});});}catch(_0x20c3de){_0x385ee3[_0x346735(0x27e)][_0x346735(0x152)](_0x346735(0x237)+_0x20c3de[_0x346735(0x1c7)]);}}function setupDriftAnalysisScheduler(_0xb62670){const _0x3192a4=a0_0x58ce74;try{if(_0xb62670[_0x3192a4(0x23d)])clearInterval(_0xb62670['driftAnalysisTimer']);if(!_0xb62670[_0x3192a4(0x1ab)])return;_0xb62670[_0x3192a4(0x23d)]=setInterval(()=>runBaselineDriftAnalysis(_0xb62670),(_0xb62670[_0x3192a4(0x196)][_0x3192a4(0x145)]||0x18)*0x36ee80),setTimeout(()=>runBaselineDriftAnalysis(_0xb62670),0x1388);}catch(_0x25ee43){_0xb62670[_0x3192a4(0x27e)][_0x3192a4(0x152)]('Drift\x20Sched\x20Error:\x20'+_0x25ee43[_0x3192a4(0x1c7)]);}}function setupBriefingScheduler(_0x28024d){const _0x4162e9=a0_0x58ce74;try{if(_0x28024d[_0x4162e9(0x22e)])_0x28024d[_0x4162e9(0x22e)][_0x4162e9(0x233)]();if(!_0x28024d[_0x4162e9(0x196)][_0x4162e9(0x158)])return;const _0x5972c5=(_0x28024d[_0x4162e9(0x196)]['briefingTime']||'08:00')[_0x4162e9(0x1e5)](':'),_0x589916=parseInt(_0x5972c5[0x0])||0x8,_0x312bd7=parseInt(_0x5972c5[0x1])||0x0,_0x1afe02=_0x312bd7+'\x20'+_0x589916+_0x4162e9(0x1cb);_0x28024d[_0x4162e9(0x27e)][_0x4162e9(0x23a)](_0x4162e9(0x22a)+_0x589916+':'+(_0x312bd7<0xa?'0'+_0x312bd7:_0x312bd7)),_0x28024d['briefingJob']=schedule['scheduleJob'](_0x1afe02,()=>{sendMorningBriefing(_0x28024d);});}catch(_0x2cd8f1){_0x28024d[_0x4162e9(0x27e)][_0x4162e9(0x152)](_0x4162e9(0x12f)+_0x2cd8f1[_0x4162e9(0x1c7)]);}}async function sendNotification(_0x23e8d8,_0x1f757c,_0x3464fe=![],_0x39cc56=![]){const _0x3c1ae8=a0_0x58ce74;_0x23e8d8[_0x3c1ae8(0x27e)][_0x3c1ae8(0x23a)]((_0x3464fe?_0x3c1ae8(0x23e):'')+_0x3c1ae8(0x1c2)+_0x1f757c+'\x22');const _0x593348=_0x23e8d8[_0x3c1ae8(0x196)];let _0x50a337=0x0;if(_0x593348['notifyTelegramEnabled']){let _0x545810={};(_0x1f757c[_0x3c1ae8(0x11a)]('Alarm')||_0x39cc56)&&(_0x545810={'reply_markup':{'inline_keyboard':[[{'text':'âœ…\x20Alles\x20OK\x20(Reset)','callback_data':'COGNI_CONFIRM_OK'}],[{'text':_0x3c1ae8(0x222),'callback_data':_0x3c1ae8(0x29c)}]]}}),await _0x23e8d8['sendToAsync'](_0x593348[_0x3c1ae8(0x15d)],_0x3c1ae8(0x1b4),{'text':_0x1f757c,'user':_0x593348[_0x3c1ae8(0x119)],..._0x545810}),_0x50a337++;}if(_0x593348[_0x3c1ae8(0x263)]){let _0x46ee5b={'message':_0x1f757c,'title':_0x39cc56?_0x3c1ae8(0x15f):_0x3c1ae8(0x296),'priority':_0x39cc56?0x2:0x1,'device':_0x593348[_0x3c1ae8(0x258)]};_0x39cc56&&(_0x46ee5b['retry']=0x1e,_0x46ee5b[_0x3c1ae8(0x178)]=0xe10,_0x46ee5b[_0x3c1ae8(0x1d0)]='siren'),await _0x23e8d8['sendToAsync'](_0x593348[_0x3c1ae8(0x1eb)],_0x3c1ae8(0x1b4),_0x46ee5b),_0x50a337++;}return _0x593348[_0x3c1ae8(0x24b)]&&(await _0x23e8d8['sendToAsync'](_0x593348[_0x3c1ae8(0x2a4)],'send',{'text':_0x1f757c,'to':_0x593348[_0x3c1ae8(0x185)]}),_0x50a337++),_0x50a337;}async function setupTelegramListener(_0x2e3696){const _0x4c3bc9=a0_0x58ce74,_0x5ae4f0=_0x2e3696['config'][_0x4c3bc9(0x15d)];_0x2e3696[_0x4c3bc9(0x196)]['notifyTelegramEnabled']&&_0x5ae4f0&&(_0x2e3696[_0x4c3bc9(0x27e)]['info'](_0x4c3bc9(0x218)+_0x5ae4f0+_0x4c3bc9(0x1ec)),await _0x2e3696[_0x4c3bc9(0x25c)](_0x5ae4f0+_0x4c3bc9(0x20b)));}async function handleTelegramResponse(_0x34ace7,_0x3ec8fa){const _0xc7ab2b=a0_0x58ce74;let _0x812bf7=_0x3ec8fa;_0x3ec8fa[_0xc7ab2b(0x234)]('[')&&(_0x812bf7=_0x3ec8fa[_0xc7ab2b(0x197)](_0x3ec8fa['indexOf'](']')+0x1));if(_0x812bf7===_0xc7ab2b(0x146))_0x34ace7[_0xc7ab2b(0x27e)][_0xc7ab2b(0x23a)](_0xc7ab2b(0x277)),await _0x34ace7[_0xc7ab2b(0x27f)]('analysis.isAlert',{'val':![],'ack':!![]}),await _0x34ace7[_0xc7ab2b(0x27f)](_0xc7ab2b(0x279),{'val':'Vom\x20Benutzer\x20bestÃ¤tigt\x20(OK).','ack':!![]}),_0x34ace7[_0xc7ab2b(0x1d9)]=![],sendNotification(_0x34ace7,_0xc7ab2b(0x274),![]);else _0x812bf7==='COGNI_REQUEST_CALL'&&(_0x34ace7[_0xc7ab2b(0x27e)]['warn'](_0xc7ab2b(0x264)),sendNotification(_0x34ace7,_0xc7ab2b(0x24f),![],!![]));}async function processSensorEvent(_0x460774,_0x1163bf,_0x2bbedd,_0x5df1b8){const _0x26d7b2=a0_0x58ce74;if(!_0x5df1b8[_0x26d7b2(0x1ee)]&&_0x460774['sensorLastValues'][_0x1163bf]===_0x2bbedd[_0x26d7b2(0x1c8)])return;_0x460774[_0x26d7b2(0x276)][_0x1163bf]=_0x2bbedd[_0x26d7b2(0x1c8)];if(_0x460774[_0x26d7b2(0x243)])return;const _0x4de8c2=await checkWifiPresence(_0x460774);if(_0x4de8c2){if(!_0x460774[_0x26d7b2(0x20a)])await setPresence(_0x460774,!![]);}else{const _0x5a26a2=_0x5df1b8[_0x26d7b2(0x1c6)]===!![];if(_0x5a26a2)startExitTimer(_0x460774);else{if(_0x460774['exitTimer'])abortExitTimer(_0x460774);if(!_0x460774[_0x26d7b2(0x20a)]&&_0x460774[_0x26d7b2(0x241)]===SYSTEM_MODES['NORMAL'])await setPresence(_0x460774,!![]);}}const _0x8625da={'timestamp':_0x2bbedd['ts'],'id':_0x1163bf,'name':_0x5df1b8[_0x26d7b2(0x2a2)],'value':_0x2bbedd[_0x26d7b2(0x1c8)],'location':_0x5df1b8[_0x26d7b2(0x1fc)],'type':_0x5df1b8[_0x26d7b2(0x1a1)]};_0x460774[_0x26d7b2(0x268)][_0x26d7b2(0x11c)](_0x8625da);if(_0x460774[_0x26d7b2(0x268)]['length']>HISTORY_MAX_SIZE)_0x460774[_0x26d7b2(0x268)]['pop']();await _0x460774[_0x26d7b2(0x27f)](_0x26d7b2(0x184),{'val':JSON[_0x26d7b2(0x1d6)](_0x8625da),'ack':!![]}),await _0x460774[_0x26d7b2(0x27f)](_0x26d7b2(0x28d),{'val':JSON[_0x26d7b2(0x1d6)](_0x460774[_0x26d7b2(0x268)]),'ack':!![]}),_0x460774[_0x26d7b2(0x25d)][_0x26d7b2(0x18e)]({'timestamp':new Date(_0x2bbedd['ts'])['toISOString'](),'sensorName':_0x5df1b8[_0x26d7b2(0x2a2)],'location':_0x5df1b8[_0x26d7b2(0x1fc)],'value':_0x2bbedd[_0x26d7b2(0x1c8)]}),await saveRawEventLog(_0x460774);}async function runGeminiAnalysis(_0x282d09,_0x28365d=''){const _0x1beb2a=a0_0x58ce74;if(!_0x282d09[_0x1beb2a(0x1ac)]){_0x282d09[_0x1beb2a(0x27e)]['warn']('Triggered\x20analysis\x20but\x20Gemini\x20AI\x20is\x20not\x20initialized!\x20Check\x20API\x20Key.');return;}const _0x4acc8e=_0x282d09[_0x1beb2a(0x268)][_0x1beb2a(0x17b)]>0x0?_0x282d09['eventHistory']:[{'note':_0x1beb2a(0x1a8)}],_0x3506df=PERSONA_MAPPING[_0x282d09[_0x1beb2a(0x196)][_0x1beb2a(0x269)]||'generic'],_0x2dc3ca=_0x282d09[_0x1beb2a(0x196)][_0x1beb2a(0x11d)]||'',_0x582bf6=_0x282d09[_0x1beb2a(0x241)],_0x29fe2a=await getWeatherContext(_0x282d09),_0xb86203=await getCalendarContext(_0x282d09),_0x49d9ef=(_0x29fe2a+'\x20'+_0xb86203)[_0x1beb2a(0x232)](),_0x113f9d=new Date(),_0x568cb8=_0x113f9d['toLocaleString'](_0x1beb2a(0x1f2),{'weekday':'long','hour':'2-digit','minute':'2-digit'});let _0x2a3efd=_0x1beb2a(0x1fd);const _0x78c5ca=_0x282d09[_0x1beb2a(0x14f)][_0x1beb2a(0x17b)];if(_0x282d09['isProVersion']&&_0x78c5ca>=(_0x282d09['config']['minDaysForBaseline']||0x7)){const _0x2752e4=_0x282d09['dailyDigests']['slice'](-(_0x282d09[_0x1beb2a(0x196)][_0x1beb2a(0x157)]||0xe));_0x2a3efd=_0x1beb2a(0x22b)+JSON[_0x1beb2a(0x1d6)](_0x2752e4)+'.';if(_0x78c5ca>=0x1e)_0x2a3efd+='\x20Phase\x203:\x20DRIFT\x20ACTIVE.';}const _0x11fa61=_0x1beb2a(0x125)+_0x568cb8+')\x20verdÃ¤chtig\x20still?\x202.\x20Akut\x20(vs.\x20STB):\x20Weicht\x20das\x20heutige\x20Verhalten\x20stark\x20von\x20den\x20letzten\x2014\x20Tagen\x20ab?\x20Ignoriere\x20Fehlalarme\x20durch\x20Kontext:\x20'+_0x49d9ef,_0x33c940=_0x1beb2a(0x225),_0x29c464=_0x1beb2a(0x1f1)+_0x568cb8+'.\x20MODUS:\x20'+_0x582bf6+_0x1beb2a(0x1c4)+(_0x282d09[_0x1beb2a(0x20a)]?'Ja':_0x1beb2a(0x1a3))+_0x1beb2a(0x275)+_0x2dc3ca+'.\x20PERSONA:\x20'+_0x3506df+'.\x20'+_0x2a3efd+'\x20'+(_0x28365d?_0x28365d:'')+'\x20'+_0x11fa61+'\x20'+_0x33c940+_0x1beb2a(0x15b)+JSON[_0x1beb2a(0x1d6)](_0x4acc8e)+'\x20SCHEMA:\x20{\x20\x22activity\x22:\x20{\x20\x22summary\x22:\x20\x22string\x22,\x20\x22deviationFromBaseline\x22:\x20\x22string\x22,\x20\x22isAlert\x22:\x20bool,\x20\x22isEmergency\x22:\x20bool,\x20\x22alertReason\x22:\x20\x22string\x22\x20},\x20\x22comfort\x22:\x20{\x20\x22automationProposal\x22:\x20{\x20\x22patternDetected\x22:\x20bool,\x20\x22description\x22:\x20\x22string\x22,\x20\x22execution\x22:\x20{\x20\x22targetId\x22:\x20\x22string|null\x22,\x20\x22targetValue\x22:\x20\x22boolean|number|null\x22\x20}\x20}\x20},\x20\x22health\x22:\x20{\x20\x22sleepScore\x22:\x20number\x20(0-100),\x20\x22restlessness\x22:\x20\x22string\x22,\x20\x22notes\x22:\x20\x22string\x22\x20}\x20}';try{const _0x1266a7=await _0x282d09[_0x1beb2a(0x1ac)]['generateContent'](_0x29c464),_0x213d64=_0x1266a7[_0x1beb2a(0x2a5)][_0x1beb2a(0x19f)]()[_0x1beb2a(0x260)](/```json|```/g,'')['trim'](),_0x33d3b9=JSON[_0x1beb2a(0x1d4)](_0x213d64);await _0x282d09[_0x1beb2a(0x27f)](_0x1beb2a(0x256),{'val':_0x213d64,'ack':!![]}),await _0x282d09[_0x1beb2a(0x27f)](_0x1beb2a(0x279),{'val':_0x33d3b9[_0x1beb2a(0x1d8)][_0x1beb2a(0x282)]||'','ack':!![]}),await _0x282d09[_0x1beb2a(0x27f)](_0x1beb2a(0x27a),{'val':_0x33d3b9[_0x1beb2a(0x1d8)][_0x1beb2a(0x20c)]||'N/A','ack':!![]});const _0x512e03=_0x33d3b9[_0x1beb2a(0x1ce)]?.[_0x1beb2a(0x13d)];if(_0x282d09['isProVersion']&&_0x512e03){const _0x3e1313=_0x512e03[_0x1beb2a(0x188)]||![];await _0x282d09[_0x1beb2a(0x27f)](_0x1beb2a(0x169),{'val':_0x3e1313,'ack':!![]}),await _0x282d09['setStateAsync']('analysis.automation.description',{'val':_0x3e1313?_0x512e03[_0x1beb2a(0x1fa)]:_0x1beb2a(0x132),'ack':!![]});if(_0x3e1313&&_0x512e03['execution']&&_0x512e03[_0x1beb2a(0x201)]['targetId']){await _0x282d09[_0x1beb2a(0x27f)](_0x1beb2a(0x16a),{'val':_0x512e03[_0x1beb2a(0x201)][_0x1beb2a(0x12b)],'ack':!![]}),await _0x282d09[_0x1beb2a(0x27f)](_0x1beb2a(0x1c0),{'val':JSON[_0x1beb2a(0x1d6)](_0x512e03[_0x1beb2a(0x201)][_0x1beb2a(0x204)]),'ack':!![]});const _0x701cdf=await _0x282d09[_0x1beb2a(0x154)]('analysis.automation.autoApply');_0x701cdf&&_0x701cdf[_0x1beb2a(0x1c8)]&&(_0x282d09['log'][_0x1beb2a(0x23a)](_0x1beb2a(0x1db)+_0x512e03[_0x1beb2a(0x201)][_0x1beb2a(0x12b)]+_0x1beb2a(0x228)+_0x512e03['execution'][_0x1beb2a(0x204)]),executeAutomationAction(_0x282d09));}else await _0x282d09[_0x1beb2a(0x27f)]('analysis.automation.targetId',{'val':'','ack':!![]}),await _0x282d09[_0x1beb2a(0x27f)](_0x1beb2a(0x1c0),{'val':'','ack':!![]});}if(_0x33d3b9[_0x1beb2a(0x1d8)][_0x1beb2a(0x223)]||_0x33d3b9['activity'][_0x1beb2a(0x1b2)]){await _0x282d09[_0x1beb2a(0x27f)](_0x1beb2a(0x163),{'val':!![],'ack':!![]});if(!_0x282d09[_0x1beb2a(0x1d9)]||_0x33d3b9[_0x1beb2a(0x1d8)]['isEmergency']){const _0x2bb274=_0x33d3b9[_0x1beb2a(0x1d8)][_0x1beb2a(0x1b2)]?_0x1beb2a(0x1be):_0x1beb2a(0x23b);sendNotification(_0x282d09,_0x2bb274+':\x20'+_0x33d3b9[_0x1beb2a(0x1d8)][_0x1beb2a(0x282)],![],_0x33d3b9[_0x1beb2a(0x1d8)][_0x1beb2a(0x1b2)]);}}else await _0x282d09['setStateAsync'](_0x1beb2a(0x163),{'val':![],'ack':!![]});_0x282d09[_0x1beb2a(0x1d9)]=_0x33d3b9[_0x1beb2a(0x1d8)][_0x1beb2a(0x223)]||_0x33d3b9[_0x1beb2a(0x1d8)][_0x1beb2a(0x1b2)],updateAnalysisHistory(_0x282d09,{'timestamp':Date[_0x1beb2a(0x267)](),'id':Date[_0x1beb2a(0x267)]()['toString'](),'analysis':_0x33d3b9,'systemMode':_0x582bf6,'isPro':_0x282d09[_0x1beb2a(0x1ab)]});}catch(_0x467d5e){_0x282d09[_0x1beb2a(0x27e)][_0x1beb2a(0x152)](_0x1beb2a(0x259)+_0x467d5e['message']);}}async function executeAutomationAction(_0x45a55b){const _0x4280a5=a0_0x58ce74;try{const _0x4c8a73=await _0x45a55b[_0x4280a5(0x154)](_0x4280a5(0x16a)),_0xc3ddb4=await _0x45a55b[_0x4280a5(0x154)](_0x4280a5(0x1c0));if(_0x4c8a73&&_0x4c8a73[_0x4280a5(0x1c8)]&&_0xc3ddb4){const _0x5cf299=_0x4c8a73[_0x4280a5(0x1c8)];let _0xe18a06=_0xc3ddb4[_0x4280a5(0x1c8)];try{_0xe18a06=JSON[_0x4280a5(0x1d4)](_0xe18a06);}catch(_0x368bbc){}_0x45a55b[_0x4280a5(0x27e)][_0x4280a5(0x23a)](_0x4280a5(0x19e)+_0x5cf299+_0x4280a5(0x228)+_0xe18a06),await _0x45a55b[_0x4280a5(0x124)](_0x5cf299,_0xe18a06);}else _0x45a55b[_0x4280a5(0x27e)][_0x4280a5(0x18f)](_0x4280a5(0x295));}catch(_0xc29f14){_0x45a55b[_0x4280a5(0x27e)][_0x4280a5(0x152)](_0x4280a5(0x14c)+_0xc29f14[_0x4280a5(0x1c7)]);}}async function runAutopilot(_0x192215){const _0xabc696=a0_0x58ce74,_0x4f528d=_0x192215[_0xabc696(0x196)]['inactivityThresholdHours'],_0x30382e=_0x192215['eventHistory'][_0xabc696(0x17b)]>0x0?_0x192215['eventHistory'][0x0][_0xabc696(0x1cc)]:Date[_0xabc696(0x267)](),_0x5b25ce=(Date[_0xabc696(0x267)]()-_0x30382e)/(0x3e8*0x3c*0x3c);let _0x1a7494='';_0x192215[_0xabc696(0x196)]['inactivityMonitoringEnabled']&&_0x192215[_0xabc696(0x241)]===SYSTEM_MODES['NORMAL']&&_0x192215[_0xabc696(0x20a)]&&(_0x5b25ce>_0x4f528d&&(_0x1a7494=_0xabc696(0x210)+_0x5b25ce['toFixed'](0x1)+_0xabc696(0x24a))),runGeminiAnalysis(_0x192215,_0x1a7494)[_0xabc696(0x170)](_0x521a04=>_0x192215[_0xabc696(0x27e)]['error'](_0x521a04));}function a0_0x1517(){const _0x2ebf9a=['ðŸ“ž\x20User\x20requested\x20CALL\x20via\x20Telegram!','minDaysForBaseline','Logbook','now','eventHistory','aiPersona','system.isPresent','scanDevices','LTM.driftAnalysis','Activity\x20Summary','date','analysis.triggerBriefing','exports','PRIORITÃ„T:\x20Gesundheit\x20und\x20Sicherheit\x20fÃ¼r\x20Senioren\x20(AAL).\x20Erkenne\x20InaktivitÃ¤t,\x20potenzielle\x20StÃ¼rze\x20(indirekt),\x20Schlafunterbrechungen\x20und\x20nÃ¤chtliche\x20Unruhe.','driftDetails','analysis.automation.description','âœ…\x20Alarm\x20quittiert.\x20System\x20normal.','.\x20KONTEXT:\x20','sensorLastValues','âœ…\x20User\x20confirmed\x20ALARM\x20via\x20Telegram.\x20Resetting\x20system.','values','analysis.alertReason','analysis.activitySummary','reachable','Drift\x20Details','@iobroker/adapter-core','log','setStateAsync','value.health','firmware','alertReason','analysis.automation.suggestedAction','Wetter:\x20Deaktiviert','[Test]\x20Interaktiver\x20Alarm','.data.table','No\x20instance','Deaktiviert\x20(Pro-Feature)','Description','inactivityThresholdHours','search','connection','events.history','testApiKey','sendTo','join','Error\x20in\x20onMessage\x20command\x20','LTM.rawEventLog','(((.+)+)+)+$','subscribeStates','ðŸ¤–\x20BUTLER:\x20No\x20valid\x20target\x20ID\x20or\x20value\x20stored\x20for\x20execution.','Cogni-Living','LTM.dailyDigests','PRO-','KALENDER:\x20Keine\x20Daten','exitTimer','communicate.request','COGNI_REQUEST_CALL','.forecast.current.state','endsWith','WiFi\x20Presence\x20detected\x20->\x20Aborting\x20Exit\x20Timer.\x20User\x20is\x20present.','analysis.comfortSuggestion','sleepScore','name','Drift\x20Analysis','notifyEmailInstance','response','ltmLtbWindowDays','uuid-not-found','6mqRvgr','stick_unreach','0\x204\x20*\x20*\x20*','analysis.deviationFromBaseline','uuid','splice','\x0aSTB:\x20','Fokus\x20auf\x20Maximierung\x20von\x20Komfort,\x20Automatisierungseffizienz\x20und\x20Energieeinsparung.','notifyTelegramRecipient','includes','onStateChange','unshift','livingContext','lastCheck','Started\x20at\x20','accuweather','LTM.driftAnalysis.lastCheck','stateChange','isArray','setForeignStateAsync','CRITICAL\x20SAFETY\x20CHECK:\x201.\x20Sofort/Ad-Hoc:\x20Ist\x20es\x20jetzt\x20(','status','devices','update','onMessage','Raw\x20Log','targetId',')\x20-\x20SAFE\x20MODE\x20ARCHITECTURE','longitude','Last\x20Check','Briefing\x20Sched\x20Error:\x20','health','analysis.automation','Keine\x20neuen\x20Automatisierungs-Muster\x20erkannt.','1315112klVoRD','LTM.driftAnalysis.baselineDrift','activityLevel','0\x203\x20*\x20*\x20*','baselineDrift','direction','getCalendarNames','set_temperature','none','Fokus\x20auf\x20Familienroutinen,\x20Kindersicherheit\x20und\x20allgemeines\x20Haushaltsmanagement.','automationProposal','boolean','KALENDER:\x20Keine\x20relevanten\x20Termine','getCalendarNames\x20Error:\x20','KALENDER:\x20Keine\x20Kalender\x20ausgewÃ¤hlt\x20(Bitte\x20in\x20Settings\x20konfigurieren)','unknown','calendarInstance','time','ltmDriftCheckIntervalHours','COGNI_CONFIRM_OK','channel','generic','dutycycle','triggerBriefing','from','BUTLER\x20Execution\x20Error:\x20','constructor','/100,\x20AktivitÃ¤t\x20seit\x2004:00:\x20','dailyDigests','fault','delObjectAsync','error','main','getStateAsync','indicator','find','ltmStbWindowDays','briefingEnabled','guest','blind','\x20EVENTS:\x20','command','notifyTelegramInstance','Event\x20History','ðŸš¨\x20EMERGENCY','material.','native','analysis.health.notes','analysis.isAlert','cogni-living\x20adapter\x20starting\x20(v','\x20Tage)','common','Error:\x20','exitGraceTimer','analysis.automation.patternDetected','analysis.automation.targetId','Skipped\x20(No\x20AI\x20or\x20Data)','city','Baseline\x20Status','45JSZdXj','setState','catch','Processing\x20Status','analysis.trigger','setObjectNotExistsAsync','@google/generative-ai','.\x20OUTPUT:\x20Nur\x20Text.','toString','scriptProblem','expire','indicator.alarm.fire','analysisInterval','length','Alert\x20Reason','Error\x20checking\x20WiFi:\x20','41862GxjQWD','callback','Feedback\x20saved:\x20','N/A\x20(Learning)','unload','KI-Modell\x20nicht\x20initialisiert','events.lastEvent','notifyEmailRecipient','LTM.driftAnalysis.driftDetails','analysis.isEmergency','patternDetected','vis.','node-schedule','string','System\x20Status\x20&\x20Control','\x20sent','push','warn','automation.triggerAction','Adapter','KALENDER:\x20','number','openweathermap.0','\x20sensors...','config','substring','filter','onReady','shutter','Aktiv\x20(','useCalendar','generateContent','ðŸ¤–\x20BUTLER:\x20Executing\x20Action\x20->\x20','text','button','type','System\x20Mode','Nein','echarts.','rssi','analysis.comfortSummary','Error\x20reading\x20calendar\x20table:\x20','No\x20recorded\x20events\x20yet.','Starting\x20Autopilot\x20(','Daily\x20Digests','isProVersion','geminiModel','system.meta.uuid','state','telegram','384864zJJTYI','autoApply','isEmergency','Success','send','WETTER:\x20','ltmJob','N/A','presenceDevices','Gemini\x20AI\x20initialized.','Target\x20ID','level','NORMAL','Party','ðŸš¨ðŸš¨\x20NOTFALL','Auto\x20Apply\x20Rule','analysis.automation.targetValue','online','Sending\x20notification:\x20\x22','getForeignStateAsync','.\x20PRÃ„SENZ:\x20','details','isExit','message','val','maintenance','Trigger\x20Briefing\x20(Test)','\x20*\x20*\x20*','timestamp','getGenerativeModel','comfort','enum','sound','Briefing\x20Error:\x20','LTM.processingStatus','currentposition','parse','analysisTimer','stringify','Normal','activity','lastAlertState','power','ðŸ¤–\x20AUTO-APPLY:\x20Executing\x20','brightness','cogni-living','models/gemini-flash-latest','Trigger\x20Digest','config_pending','toISOString','energy','Subscribing\x20to\x20','test','split','toLocaleString','VACATION','lowbat','licenseKey','181412uAjegs','notifyPushoverInstance','\x20for\x20interactive\x20buttons...','getEnums','logDuplicates','unreach','flot.','ROLLE:\x20Smart\x20Home\x20Analyst.\x20SPRACHE:\x20DE.\x20FORMAT:\x20JSON.\x20AKTUELLE\x20ZEIT:\x20','de-DE','.\x20ZUSATZ:\x20','31787njwgyG','PARTY','extendObjectAsync','Health\x20Notes','systemConfig','genAI','description','Comfort\x20Summary','location','Phase\x201:\x20Learning\x20(No\x20Baseline).\x20Rely\x20on\x20common\x20sense.','text.alarm','.\x20DATEN:\x20Schlaf\x20','analysis.history_debug_00','execution','testNotification','humidity','targetValue','weatherInstance','setHours','Missing\x20data','modeResetJob','analysisHistory','isPresent','.communicate.request','summary','No\x20Key','map','sort','HARD\x20WATCHDOG:\x20No\x20sensor\x20activity\x20detected\x20for\x20','ROLLE:\x20FÃ¼rsorglicher\x20Assistent.\x20AUFGABE:\x20Schreibe\x20eine\x20kurze,\x20beruhigende\x20\x22Guten\x20Morgen\x22-Nachricht.\x20PERSONA:\x20','event','working','analysis.automation.autoApply','daswetter','1743510iSMqSG','LTM','ðŸ“¡\x20Hooking\x20into\x20','getForeignObjectAsync','18ERSxfn','Action','accuweather.0','ðŸŒ…\x20Daily\x20Briefing:\x0a','ROLLE:\x20Data\x20Scientist.\x20ZIEL:\x20Drift\x20erkennen.\x20SCHEMA:\x20{\x20\x22baselineDrift\x22:\x20\x22none|slight|significant|critical\x22,\x20\x22driftDetails\x22:\x20\x22string\x22\x20}\x0a\x0aLTB:\x20','system','analysis.automation.triggerAction','GUEST','ðŸ“ž\x20RÃ¼ckruf\x20anfordern','isAlert','AI\x20Emergency\x20Status','AUTOMATION\x20RULES\x20(THE\x20BUTLER):\x20-\x20Only\x20propose\x20automation\x20if\x20you\x20see\x20a\x20STABLE,\x20REPETITIVE\x20pattern\x20(e.g.\x20happens\x20every\x20day).\x20-\x20IGNORE\x20one-time\x20events.\x20Do\x20NOT\x20trigger\x20on\x20first\x20occurrence.\x20-\x20\x22targetId\x22\x20MUSS\x20eine\x20ID\x20aus\x20der\x20Event-Liste\x20sein.','bind','value','\x20=\x20','analysis.analysisHistory','Scheduling\x20Morning\x20Briefing\x20for\x20','Phase\x202:\x20ACUTE\x20MONITORING.\x20STB\x20(Last\x2014d):\x20','scriptEnabled','Kalender:\x20Deaktiviert','briefingJob','ack','vacation','uuid-error','trim','cancel','startsWith','object','WETTER:\x20Keine\x20Daten\x20gefunden','Reset\x20Sched\x20Error:\x20','json','application/json','info','âš ï¸\x20Alarm','onUnload','driftAnalysisTimer','[TEST]\x20','motion','LTM.triggerDailyDigest','currentSystemMode','geminiApiKey','isGracePeriodActive','submitFeedback','useWeather','Urlaub','scheduleJob','icons-mfd.','temperature','\x20hours.\x20Potential\x20incapacitation.','notifyEmailEnabled','Feedback\x20Log','occupancy','ical.0','ðŸ“ž\x20RÃœCKRUF\x20BITTE!\x20Der\x20Bewohner\x20hat\x20den\x20RÃ¼ckruf-Button\x20gedrÃ¼ckt.','\x20min).','Gast','_calName','\x20presence\x20devices...','1317127VeltUN','\x20|\x20','analysis.lastResult','switch','notifyPushoverRecipient','Analysis\x20Error:\x20','Sleep\x20Score\x20(0-100)','slice','subscribeForeignStatesAsync','rawEventLog','instance','triggerDailyDigest','replace','info.','Analysiere\x20ausgewogen\x20auf\x20Gesundheit,\x20Sicherheit\x20und\x20Komfort.','notifyPushoverEnabled'];a0_0x1517=function(){return _0x2ebf9a;};return a0_0x1517();}async function createDailyDigest(_0x69fb56){const _0x32a092=a0_0x58ce74;if(!_0x69fb56[_0x32a092(0x1ab)])return;await _0x69fb56[_0x32a092(0x27f)](LTM_DP_STATUS,{'val':_0x32a092(0x11f)+new Date()[_0x32a092(0x1e6)](),'ack':!![]});if(!_0x69fb56['geminiModel']||_0x69fb56[_0x32a092(0x25d)][_0x32a092(0x17b)]<LTM_MIN_EVENTS_FOR_COMPRESSION){await _0x69fb56['setStateAsync'](LTM_DP_STATUS,{'val':_0x32a092(0x16b),'ack':!![]});return;}const _0x3059b1=JSON[_0x32a092(0x1d4)](JSON[_0x32a092(0x1d6)](_0x69fb56[_0x32a092(0x25d)])),_0x2b8619=_0x3059b1[_0x32a092(0x17b)],_0x3ae8bd='ROLLE:\x20Data\x20Compression\x20Agent.\x20SPRACHE:\x20DE.\x20FORMAT:\x20JSON.\x20ANWEISUNG:\x20Fasse\x20Sensor-Events\x20zusammen.\x20SCHEMA:\x20{\x20\x22summary\x22:\x20\x22string\x22,\x20\x22activityLevel\x22:\x20\x22string\x22\x20}\x20\x0a\x0aEVENTS:\x0a'+JSON['stringify'](_0x3059b1);try{const _0x39f7c6=await _0x69fb56[_0x32a092(0x1ac)][_0x32a092(0x19d)](_0x3ae8bd),_0x3f3903=JSON['parse'](_0x39f7c6[_0x32a092(0x2a5)][_0x32a092(0x19f)]()[_0x32a092(0x260)](/```json|```/g,'')['trim']());_0x3f3903[_0x32a092(0x20c)]&&(_0x69fb56[_0x32a092(0x14f)][_0x32a092(0x18e)]({'timestamp':new Date()[_0x32a092(0x1e1)](),'eventCount':_0x2b8619,'summary':_0x3f3903[_0x32a092(0x20c)],'activityLevel':_0x3f3903[_0x32a092(0x135)],'systemMode':_0x69fb56[_0x32a092(0x241)]}),await saveDailyDigests(_0x69fb56),_0x69fb56[_0x32a092(0x25d)]=[],await saveRawEventLog(_0x69fb56),await _0x69fb56['setStateAsync'](LTM_DP_STATUS,{'val':'Success:\x20Compressed\x20'+_0x2b8619+'\x20events','ack':!![]}));}catch(_0x58f9db){await _0x69fb56[_0x32a092(0x27f)](LTM_DP_STATUS,{'val':_0x32a092(0x167)+_0x58f9db[_0x32a092(0x1c7)],'ack':!![]});}}async function sendMorningBriefing(_0xa6ff53){const _0x327a95=a0_0x58ce74;if(!_0xa6ff53[_0x327a95(0x1ac)])return;_0xa6ff53[_0x327a95(0x27e)][_0x327a95(0x23a)]('Generating\x20Morning\x20Briefing...');const _0x5c5711=_0xa6ff53[_0x327a95(0x14f)][_0x327a95(0x17b)]>0x0?_0xa6ff53['dailyDigests'][_0xa6ff53['dailyDigests'][_0x327a95(0x17b)]-0x1]:null,_0x46ec46=_0x5c5711&&_0x5c5711[_0x327a95(0x130)]?_0x5c5711[_0x327a95(0x130)][_0x327a95(0x2a1)]:_0x327a95(0x1b7),_0x34e69b=new Date();_0x34e69b[_0x327a95(0x206)](0x4,0x0,0x0,0x0);const _0x9601da=_0xa6ff53['eventHistory'][_0x327a95(0x198)](_0x324476=>new Date(_0x324476[_0x327a95(0x1cc)])>_0x34e69b),_0x1688e3=PERSONA_MAPPING[_0xa6ff53[_0x327a95(0x196)][_0x327a95(0x269)]||_0x327a95(0x148)],_0x550529=_0xa6ff53['config']['livingContext']||'',_0x45dd4c=await getWeatherContext(_0xa6ff53),_0x2ac601=await getCalendarContext(_0xa6ff53),_0x421396=_0x327a95(0x211)+_0x1688e3+_0x327a95(0x275)+_0x550529+_0x327a95(0x1f3)+_0x45dd4c+'\x20'+_0x2ac601+_0x327a95(0x1ff)+_0x46ec46+_0x327a95(0x14e)+JSON['stringify'](_0x9601da[_0x327a95(0x25b)](0x0,0xa))+_0x327a95(0x175);try{const _0x52e6fb=await _0xa6ff53[_0x327a95(0x1ac)]['generateContent'](_0x421396),_0x28f469=_0x327a95(0x21d)+_0x52e6fb['response']['text']()[_0x327a95(0x232)]();sendNotification(_0xa6ff53,_0x28f469),_0xa6ff53[_0x327a95(0x27e)][_0x327a95(0x23a)]('Morning\x20Briefing\x20sent.');}catch(_0x12711e){_0xa6ff53['log'][_0x327a95(0x152)](_0x327a95(0x1d1)+_0x12711e[_0x327a95(0x1c7)]);}}if(require[a0_0x58ce74(0x153)]!==module)module[a0_0x58ce74(0x270)]=_0x3bc92d=>new CogniLiving(_0x3bc92d);else new CogniLiving();