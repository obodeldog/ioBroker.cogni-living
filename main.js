const a0_0x421815=a0_0x5197;(function(_0x59c975,_0x179d1f){const _0x2b85e4=a0_0x5197,_0x57b2ed=_0x59c975();while(!![]){try{const _0x4002ca=parseInt(_0x2b85e4(0x90))/0x1+-parseInt(_0x2b85e4(0x194))/0x2+parseInt(_0x2b85e4(0xaf))/0x3+parseInt(_0x2b85e4(0xb6))/0x4*(-parseInt(_0x2b85e4(0x16c))/0x5)+-parseInt(_0x2b85e4(0x9c))/0x6+-parseInt(_0x2b85e4(0xb9))/0x7+parseInt(_0x2b85e4(0x173))/0x8*(parseInt(_0x2b85e4(0x1ba))/0x9);if(_0x4002ca===_0x179d1f)break;else _0x57b2ed['push'](_0x57b2ed['shift']());}catch(_0x1f07ae){_0x57b2ed['push'](_0x57b2ed['shift']());}}}(a0_0x68b8,0xe4f0c));const a0_0x4be670=(function(){let _0x4a8b97=!![];return function(_0x52ba96,_0x4f3a4d){const _0x5d870c=_0x4a8b97?function(){const _0x46a573=a0_0x5197;if(_0x4f3a4d){const _0x37cf7a=_0x4f3a4d[_0x46a573(0xdd)](_0x52ba96,arguments);return _0x4f3a4d=null,_0x37cf7a;}}:function(){};return _0x4a8b97=![],_0x5d870c;};}()),a0_0x478bce=a0_0x4be670(this,function(){const _0x144956=a0_0x5197;return a0_0x478bce[_0x144956(0xba)]()['search']('(((.+)+)+)+$')[_0x144956(0xba)]()[_0x144956(0x10b)](a0_0x478bce)[_0x144956(0x179)](_0x144956(0xbb));});function a0_0x5197(_0x5e2f84,_0xf4f7f){const _0x3e7dbb=a0_0x68b8();return a0_0x5197=function(_0x478bce,_0x4be670){_0x478bce=_0x478bce-0x8c;let _0x68b87d=_0x3e7dbb[_0x478bce];return _0x68b87d;},a0_0x5197(_0x5e2f84,_0xf4f7f);}a0_0x478bce();'use strict';const utils=require(a0_0x421815(0x166)),{GoogleGenerativeAI}=require('@google/generative-ai'),schedule=require(a0_0x421815(0x149)),HISTORY_MAX_SIZE=0x32,FEEDBACK_MAX_SIZE=0x14,GEMINI_MODEL=a0_0x421815(0x143),ANALYSIS_HISTORY_MAX_SIZE=0x64,RAW_LOG_MAX_SIZE=0x5dc,DAILY_DIGEST_MAX_SIZE_LIMIT=0xb4,LTM_MIN_EVENTS_FOR_COMPRESSION=0x5,LTM_SCHEDULE=a0_0x421815(0x13c),LTM_DP_RAW_LOG=a0_0x421815(0x17f),LTM_DP_DAILY_DIGESTS=a0_0x421815(0x1b3),LTM_DP_STATUS=a0_0x421815(0xc4),LTM_DP_TRIGGER_DIGEST='LTM.triggerDailyDigest',LTM_DP_BASELINE_STATUS=a0_0x421815(0xbf),LTM_DP_DRIFT_CHANNEL='LTM.driftAnalysis',LTM_DP_DRIFT_STATUS=a0_0x421815(0xe6),LTM_DP_DRIFT_DETAILS=a0_0x421815(0x167),LTM_DP_DRIFT_LAST_CHECK='LTM.driftAnalysis.lastCheck',SYSTEM_DP_MODE=a0_0x421815(0x100),MODE_RESET_SCHEDULE=a0_0x421815(0x16d),SYSTEM_MODES={'NORMAL':a0_0x421815(0x92),'VACATION':a0_0x421815(0x1c2),'PARTY':'party','GUEST':a0_0x421815(0xc6)},AUTO_RESET_MODES=[SYSTEM_MODES[a0_0x421815(0x177)],SYSTEM_MODES[a0_0x421815(0x135)]],EXIT_TIMER_MINUTES=0xf,EXIT_GRACE_PERIOD_SECONDS=0x1e,PERSONA_MAPPING={'generic':a0_0x421815(0x15d),'senior_aal':a0_0x421815(0xfb),'family':'Fokus\x20auf\x20Familienroutinen,\x20Kindersicherheit\x20und\x20allgemeines\x20Haushaltsmanagement.','single_comfort':a0_0x421815(0x1a1),'security':a0_0x421815(0xa5)};class CogniLiving extends utils['Adapter']{constructor(_0x9118e7){const _0x3a4432=a0_0x421815;super({..._0x9118e7,'name':_0x3a4432(0x190)}),this[_0x3a4432(0x1c4)]=[],this[_0x3a4432(0xaa)]=[],this[_0x3a4432(0xdf)]=[],this[_0x3a4432(0x119)]=[],this[_0x3a4432(0x104)]=[],this[_0x3a4432(0x152)]={},this[_0x3a4432(0x10a)]={'latitude':0x0,'longitude':0x0,'city':''},this[_0x3a4432(0x1c1)]=!![],this[_0x3a4432(0xda)]=null,this[_0x3a4432(0x16e)]=null,this[_0x3a4432(0xbd)]=![],this[_0x3a4432(0x12a)]=null,this[_0x3a4432(0x142)]=null,this[_0x3a4432(0x15c)]=SYSTEM_MODES[_0x3a4432(0xb4)],this[_0x3a4432(0x116)]=![],this[_0x3a4432(0x159)]=![],this['systemUUID']='unknown',this[_0x3a4432(0x1b5)]=null,this[_0x3a4432(0x1a2)]=null,this['modeResetJob']=null,this['driftAnalysisTimer']=null,this['on'](_0x3a4432(0x18f),this[_0x3a4432(0x11e)][_0x3a4432(0x139)](this)),this['on'](_0x3a4432(0x113),this[_0x3a4432(0x108)]['bind'](this)),this['on'](_0x3a4432(0xac),this[_0x3a4432(0x13d)]['bind'](this)),this['on'](_0x3a4432(0x151),this[_0x3a4432(0x98)][_0x3a4432(0x139)](this));}async[a0_0x421815(0x11e)](){const _0x4a39f9=a0_0x421815;this[_0x4a39f9(0xdc)]['info'](_0x4a39f9(0x124)+this[_0x4a39f9(0x160)]+')'),await this['cleanUpZombies'](),this['config'][_0x4a39f9(0x18b)]=this['config'][_0x4a39f9(0x18b)]||'',this[_0x4a39f9(0x116)]=await this[_0x4a39f9(0xca)](this[_0x4a39f9(0x96)][_0x4a39f9(0x18b)]);if(!this['config'][_0x4a39f9(0xce)]||this['config'][_0x4a39f9(0xce)]<0.1)this[_0x4a39f9(0x96)][_0x4a39f9(0xce)]=0xc;await this[_0x4a39f9(0x197)]();try{const _0xc4b612=await this['getForeignObjectAsync'](_0x4a39f9(0x12f));_0xc4b612&&_0xc4b612[_0x4a39f9(0x169)]&&(this[_0x4a39f9(0x10a)]={'latitude':_0xc4b612[_0x4a39f9(0x169)][_0x4a39f9(0x162)]||0x0,'longitude':_0xc4b612[_0x4a39f9(0x169)][_0x4a39f9(0x18e)]||0x0,'city':_0xc4b612['common'][_0x4a39f9(0x155)]||''});}catch(_0x4fcfbd){}if(this[_0x4a39f9(0x96)][_0x4a39f9(0xdb)])try{this['genAI']=new GoogleGenerativeAI(this[_0x4a39f9(0x96)][_0x4a39f9(0xdb)]),this[_0x4a39f9(0x142)]=this['genAI']['getGenerativeModel']({'model':GEMINI_MODEL,'generationConfig':{'responseMimeType':_0x4a39f9(0x171)}}),this[_0x4a39f9(0xdc)]['info'](_0x4a39f9(0x101));}catch(_0x3845c8){this['log'][_0x4a39f9(0x128)](_0x4a39f9(0x103)+_0x3845c8[_0x4a39f9(0x151)]);}await this[_0x4a39f9(0x95)](),await this[_0x4a39f9(0xd4)](),await this[_0x4a39f9(0xa3)](),await this['loadDailyDigests'](),this[_0x4a39f9(0x114)](_0x4a39f9(0xfd)),this[_0x4a39f9(0x114)](LTM_DP_TRIGGER_DIGEST),this['subscribeStates'](_0x4a39f9(0x100));const _0x3352b5=this[_0x4a39f9(0x96)]['devices'];if(_0x3352b5&&_0x3352b5['length']>0x0){this[_0x4a39f9(0xdc)][_0x4a39f9(0xc2)](_0x4a39f9(0x1a6)+_0x3352b5[_0x4a39f9(0x1cd)]+_0x4a39f9(0x1b1));for(const _0x5f41bd of _0x3352b5){if(_0x5f41bd['id']){await this[_0x4a39f9(0xf0)](_0x5f41bd['id']);try{const _0x19d2ae=await this['getForeignStateAsync'](_0x5f41bd['id']);if(_0x19d2ae)this[_0x4a39f9(0x152)][_0x5f41bd['id']]=_0x19d2ae[_0x4a39f9(0xc7)];}catch(_0x50e9db){}}}}const _0x1d922a=this[_0x4a39f9(0x96)][_0x4a39f9(0xd5)]||[];if(_0x1d922a[_0x4a39f9(0x1cd)]>0x0){this['log'][_0x4a39f9(0xc2)]('Subscribing\x20to\x20'+_0x1d922a[_0x4a39f9(0x1cd)]+_0x4a39f9(0x1b4));for(const _0x4bac6d of _0x1d922a){await this[_0x4a39f9(0xf0)](_0x4bac6d);}await this[_0x4a39f9(0x184)]();}if(this[_0x4a39f9(0x1b5)])clearInterval(this['analysisTimer']);const _0x3104e9=this[_0x4a39f9(0x96)]['analysisInterval']||0xf;_0x3104e9>0x0&&(this[_0x4a39f9(0xdc)][_0x4a39f9(0xc2)](_0x4a39f9(0xbc)+_0x3104e9+_0x4a39f9(0x12b)+this['config'][_0x4a39f9(0xce)]+'h.'),this[_0x4a39f9(0x1b5)]=setInterval(()=>this['runAutopilot'](),_0x3104e9*0x3c*0x3e8)),this['setupLtmScheduler'](),this[_0x4a39f9(0xb0)](),this[_0x4a39f9(0x140)]();}async[a0_0x421815(0x184)](){const _0x2e5b06=a0_0x421815,_0x5d3fc1=this['config'][_0x2e5b06(0xd5)]||[];let _0x1b54c1=![];for(const _0x241bc1 of _0x5d3fc1){try{const _0x4f8de4=await this[_0x2e5b06(0x11d)](_0x241bc1);if(_0x4f8de4&&(_0x4f8de4[_0x2e5b06(0xc7)]===!![]||_0x4f8de4[_0x2e5b06(0xc7)]==='online'||_0x4f8de4[_0x2e5b06(0xc7)]===0x1)){_0x1b54c1=!![];break;}}catch(_0x408d2a){}}return _0x1b54c1&&(this[_0x2e5b06(0xda)]&&(this['log']['info'](_0x2e5b06(0x11b)),this[_0x2e5b06(0x146)]()),!this['isPresent']&&this[_0x2e5b06(0x15c)]===SYSTEM_MODES['NORMAL']&&this[_0x2e5b06(0x131)](!![])),_0x1b54c1;}async[a0_0x421815(0x108)](_0x2653fe,_0x949ad1){const _0x43e5b9=a0_0x421815;if(!_0x949ad1)return;if(_0x2653fe===this[_0x43e5b9(0x1ac)]+'.'+SYSTEM_DP_MODE){_0x949ad1[_0x43e5b9(0xc7)]&&Object[_0x43e5b9(0x16f)](SYSTEM_MODES)['includes'](_0x949ad1[_0x43e5b9(0xc7)])&&(this[_0x43e5b9(0x15c)]=_0x949ad1[_0x43e5b9(0xc7)],_0x949ad1[_0x43e5b9(0xc7)]===SYSTEM_MODES[_0x43e5b9(0x165)]?this[_0x43e5b9(0x131)](![]):this[_0x43e5b9(0x131)](!![]));if(!_0x949ad1['ack'])this[_0x43e5b9(0x19a)](_0x2653fe,{'val':this[_0x43e5b9(0x15c)],'ack':!![]});return;}if(!_0x949ad1[_0x43e5b9(0x1ce)]){_0x2653fe[_0x43e5b9(0x18d)]('analysis.trigger')&&_0x949ad1[_0x43e5b9(0xc7)]&&(this[_0x43e5b9(0x19a)](_0x2653fe,{'val':![],'ack':!![]}),this['runGeminiAnalysis']());if(_0x2653fe[_0x43e5b9(0x18d)](_0x43e5b9(0x183))&&_0x949ad1[_0x43e5b9(0xc7)]){this[_0x43e5b9(0x19a)](_0x2653fe,{'val':![],'ack':!![]});if(this[_0x43e5b9(0x116)])this[_0x43e5b9(0xec)]();}return;}if(this[_0x43e5b9(0x96)][_0x43e5b9(0xd5)]&&this[_0x43e5b9(0x96)][_0x43e5b9(0xd5)][_0x43e5b9(0x18d)](_0x2653fe)){await this['checkWifiPresence']();return;}const _0x328acb=(this[_0x43e5b9(0x96)]['devices']||[])[_0x43e5b9(0x175)](_0x235a22=>_0x235a22['id']===_0x2653fe);if(_0x328acb)this[_0x43e5b9(0xd7)](_0x2653fe,_0x949ad1,_0x328acb);}async[a0_0x421815(0xd7)](_0x165adf,_0x382316,_0x294e25){const _0x71ae80=a0_0x421815;if(!_0x294e25['logDuplicates']&&this[_0x71ae80(0x152)][_0x165adf]===_0x382316['val'])return;this[_0x71ae80(0x152)][_0x165adf]=_0x382316[_0x71ae80(0xc7)];if(this[_0x71ae80(0xbd)])return;const _0x499ba2=await this[_0x71ae80(0x184)]();if(_0x499ba2){if(!this['isPresent'])this[_0x71ae80(0x131)](!![]);}else{const _0x355ed8=_0x294e25[_0x71ae80(0x1b2)]===!![];_0x355ed8?this[_0x71ae80(0xe7)]():(this[_0x71ae80(0xda)]&&(this[_0x71ae80(0xdc)][_0x71ae80(0xc2)]('Bewegung\x20wÃ¤hrend\x20Exit-Timer\x20erkannt\x20->\x20Bewohner\x20ist\x20noch\x20da.'),this['abortExitTimer']()),!this['isPresent']&&this[_0x71ae80(0x15c)]===SYSTEM_MODES[_0x71ae80(0xb4)]&&this[_0x71ae80(0x131)](!![]));}const _0x12ce15={'timestamp':_0x382316['ts'],'id':_0x165adf,'name':_0x294e25[_0x71ae80(0x199)],'value':_0x382316[_0x71ae80(0xc7)],'location':_0x294e25[_0x71ae80(0x19e)],'type':_0x294e25[_0x71ae80(0x107)]};this[_0x71ae80(0x1c4)]['unshift'](_0x12ce15);if(this['eventHistory'][_0x71ae80(0x1cd)]>HISTORY_MAX_SIZE)this['eventHistory'][_0x71ae80(0x129)]();await this[_0x71ae80(0x111)](_0x71ae80(0x115),{'val':JSON[_0x71ae80(0x18c)](_0x12ce15),'ack':!![]}),await this['setStateAsync'](_0x71ae80(0x121),{'val':JSON['stringify'](this[_0x71ae80(0x1c4)]),'ack':!![]}),this[_0x71ae80(0x119)][_0x71ae80(0x19f)]({'timestamp':new Date(_0x382316['ts'])['toISOString'](),'sensorName':_0x294e25[_0x71ae80(0x199)],'location':_0x294e25[_0x71ae80(0x19e)],'value':_0x382316[_0x71ae80(0xc7)]}),await this['saveRawEventLog']();}[a0_0x421815(0xe7)](){const _0x3bdde4=a0_0x421815;this['abortExitTimer'](),this[_0x3bdde4(0xbd)]=!![],this[_0x3bdde4(0x16e)]=setTimeout(()=>{this['isGracePeriodActive']=![];},EXIT_GRACE_PERIOD_SECONDS*0x3e8),this[_0x3bdde4(0xda)]=setTimeout(()=>{const _0x341555=_0x3bdde4;this['setPresence'](![]),this[_0x341555(0xda)]=null;},EXIT_TIMER_MINUTES*0x3c*0x3e8);}[a0_0x421815(0x146)](){const _0x5b2f76=a0_0x421815;if(this[_0x5b2f76(0xda)])clearTimeout(this['exitTimer']);if(this[_0x5b2f76(0x16e)])clearTimeout(this[_0x5b2f76(0x16e)]);this[_0x5b2f76(0xda)]=null,this[_0x5b2f76(0x16e)]=null,this['isGracePeriodActive']=![];}async[a0_0x421815(0x131)](_0x5b595e){const _0x38f575=a0_0x421815;if(this[_0x38f575(0x1c1)]===_0x5b595e)return;this['isPresent']=_0x5b595e,await this['setStateAsync'](_0x38f575(0x198),{'val':_0x5b595e,'ack':!![]});}[a0_0x421815(0x10e)](){const _0x47e3dc=a0_0x421815,_0x20b020=this[_0x47e3dc(0x96)][_0x47e3dc(0xce)],_0x49f5db=this['config'][_0x47e3dc(0xef)],_0x3c3048=this[_0x47e3dc(0x1c4)][_0x47e3dc(0x1cd)]>0x0?this[_0x47e3dc(0x1c4)][0x0][_0x47e3dc(0x91)]:Date[_0x47e3dc(0x19d)](),_0x1f0259=(Date[_0x47e3dc(0x19d)]()-_0x3c3048)/(0x3e8*0x3c*0x3c);let _0x2d7044='';_0x49f5db&&this[_0x47e3dc(0x15c)]===SYSTEM_MODES[_0x47e3dc(0xb4)]&&this[_0x47e3dc(0x1c1)]&&(_0x1f0259>_0x20b020&&(_0x2d7044='CRITICAL\x20WARNING:\x20No\x20sensor\x20activity\x20detected\x20for\x20'+_0x1f0259[_0x47e3dc(0xfa)](0x1)+_0x47e3dc(0x105)));if(_0x2d7044){this[_0x47e3dc(0xa4)](_0x2d7044)[_0x47e3dc(0xe9)](_0x5a8eac=>this[_0x47e3dc(0xdc)][_0x47e3dc(0x128)](_0x5a8eac));return;}const _0x362abe=Date[_0x47e3dc(0x19d)](),_0x488172=_0x362abe-_0x3c3048,_0x3c7f83=(this[_0x47e3dc(0x96)][_0x47e3dc(0x150)]||0xf)*0x3c*0x3e8;this['eventHistory']['length']>0x0&&_0x488172<=_0x3c7f83?this[_0x47e3dc(0xa4)]()[_0x47e3dc(0xe9)](_0x17890f=>this['log'][_0x47e3dc(0x128)](_0x17890f)):!this[_0x47e3dc(0x159)]&&(this['setState'](_0x47e3dc(0x1ad),{'val':![],'ack':!![]}),this[_0x47e3dc(0x19a)]('analysis.isEmergency',{'val':![],'ack':!![]}));}async[a0_0x421815(0xa4)](_0xd269a6=''){const _0x27d203=a0_0x421815;if(!this[_0x27d203(0x142)])return;const _0x55933b=this[_0x27d203(0x1c4)][_0x27d203(0x1cd)]>0x0?this[_0x27d203(0x1c4)]:[{'note':'No\x20recorded\x20events\x20yet.'}],_0x463a65=PERSONA_MAPPING[this[_0x27d203(0x96)][_0x27d203(0x9a)]||_0x27d203(0x15a)],_0x2997e5=this[_0x27d203(0x96)][_0x27d203(0x163)]||'',_0x3c81d3=this['currentSystemMode'],_0x14498c=new Date(),_0x31d7fb=_0x14498c[_0x27d203(0x147)]('de-DE',{'weekday':'long','hour':_0x27d203(0x17e),'minute':'2-digit'}),_0x151a38=this['systemConfig'];let _0x1dd7d5='';if(this[_0x27d203(0xdf)][_0x27d203(0x1cd)]>0x0){const _0x3d2edb=this[_0x27d203(0xdf)][_0x27d203(0x158)](0x0,0x3)[_0x27d203(0x1b0)](_0x1d40db=>_0x27d203(0x192)+_0x1d40db[_0x27d203(0x14c)]+_0x27d203(0x112)+_0x1d40db[_0x27d203(0x196)]+'.')[_0x27d203(0x17c)]('\x0a');_0x1dd7d5=_0x27d203(0x161)+_0x3d2edb+'\x0a';}const _0x861f32=_0xd269a6?'\x0a!!!\x20EXTERNAL\x20SYSTEM\x20WARNING\x20!!!\x0a'+_0xd269a6+_0x27d203(0xf6):'',_0x3cf530=_0x27d203(0x14f),_0x58c344=_0x27d203(0x134)+_0x31d7fb+'.\x20ORT:\x20'+_0x151a38[_0x27d203(0x155)]+_0x27d203(0xa8)+_0x3c81d3+'.\x20PRÃ„SENZ:\x20'+(this[_0x27d203(0x1c1)]?'Ja':_0x27d203(0x1af))+_0x27d203(0x176)+_0x2997e5+_0x27d203(0x138)+_0x463a65+'.\x0a\x20\x20\x20\x20\x20\x20\x20\x20'+_0x3cf530+'\x20'+_0x1dd7d5+'\x20'+_0x861f32+_0x27d203(0xb3)+JSON[_0x27d203(0x18c)](_0x55933b)+_0x27d203(0x187);try{const _0x469963=await this[_0x27d203(0x142)][_0x27d203(0x126)](_0x58c344),_0x39640c=_0x469963[_0x27d203(0xf1)]['text']()[_0x27d203(0xbe)](/```json|```/g,'')[_0x27d203(0x141)](),_0x276d46=JSON[_0x27d203(0xa1)](_0x39640c);await this['setStateAsync'](_0x27d203(0xf3),{'val':_0x39640c,'ack':!![]}),await this['setStateAsync'](_0x27d203(0x17a),{'val':_0x276d46['activity'][_0x27d203(0x14c)]||'','ack':!![]}),await this[_0x27d203(0x111)](_0x27d203(0x97),{'val':_0x276d46['activity'][_0x27d203(0x16b)]||_0x27d203(0xd3),'ack':!![]}),await this[_0x27d203(0x111)](_0x27d203(0x195),{'val':_0x276d46['activity'][_0x27d203(0x1bd)]||_0x27d203(0xd3),'ack':!![]});_0x276d46[_0x27d203(0x118)]&&(await this[_0x27d203(0x111)](_0x27d203(0x1cc),{'val':_0x276d46[_0x27d203(0x118)]['summary']||'','ack':!![]}),await this[_0x27d203(0x111)](_0x27d203(0x185),{'val':_0x276d46[_0x27d203(0x118)][_0x27d203(0x93)]||'','ack':!![]}),_0x276d46[_0x27d203(0x118)][_0x27d203(0x1ca)]&&(await this[_0x27d203(0x111)](_0x27d203(0xb2),{'val':_0x276d46['comfort'][_0x27d203(0x1ca)][_0x27d203(0x110)]||![],'ack':!![]}),await this['setStateAsync'](_0x27d203(0x13a),{'val':_0x276d46[_0x27d203(0x118)]['automationProposal']['description']||'','ack':!![]}),await this[_0x27d203(0x111)](_0x27d203(0xfc),{'val':_0x276d46['comfort'][_0x27d203(0x1ca)][_0x27d203(0x178)]||'','ack':!![]})));const _0x54bcb4=_0x276d46[_0x27d203(0xcf)][_0x27d203(0x11f)]||![],_0x2db78f=_0x276d46[_0x27d203(0xcf)][_0x27d203(0xad)]||![];if(_0x54bcb4||_0x2db78f){await this[_0x27d203(0x111)]('analysis.isAlert',{'val':!![],'ack':!![]}),await this[_0x27d203(0x111)](_0x27d203(0xe0),{'val':_0x2db78f,'ack':!![]});if(!this[_0x27d203(0x159)]||_0x2db78f){const _0x5ed183=_0x2db78f?'ðŸš¨ðŸš¨\x20NOTFALL':_0x27d203(0x13b);this[_0x27d203(0x15e)](_0x5ed183+':\x20'+_0x276d46[_0x27d203(0xcf)]['alertReason'],![],_0x2db78f);}}else await this[_0x27d203(0x111)](_0x27d203(0x1ad),{'val':![],'ack':!![]}),await this[_0x27d203(0x111)](_0x27d203(0xe0),{'val':![],'ack':!![]});this[_0x27d203(0x159)]=_0x54bcb4||_0x2db78f;const _0x27c91b={'timestamp':Date['now'](),'id':Date['now']()[_0x27d203(0xba)](),'analysis':_0x276d46,'systemMode':_0x3c81d3,'isPro':this[_0x27d203(0x116)]};this['updateAnalysisHistory'](_0x27c91b);}catch(_0x1f5108){this['log']['error'](_0x27d203(0xd2)+_0x1f5108[_0x27d203(0x151)]);}}async['createDailyDigest'](){const _0x5e4a6c=a0_0x421815;if(!this[_0x5e4a6c(0x116)])return;await this[_0x5e4a6c(0x111)](LTM_DP_STATUS,{'val':_0x5e4a6c(0x13e)+new Date()['toLocaleString'](),'ack':!![]});if(!this[_0x5e4a6c(0x142)]||this[_0x5e4a6c(0x119)][_0x5e4a6c(0x1cd)]<LTM_MIN_EVENTS_FOR_COMPRESSION){await this['setStateAsync'](LTM_DP_STATUS,{'val':_0x5e4a6c(0x133),'ack':!![]});return;}const _0x3ffbfd=JSON[_0x5e4a6c(0xa1)](JSON[_0x5e4a6c(0x18c)](this[_0x5e4a6c(0x119)])),_0x28d347=(this[_0x5e4a6c(0x96)][_0x5e4a6c(0x163)]||'')[_0x5e4a6c(0xc1)](0x0,0x3e8),_0x3ba6d8=_0x5e4a6c(0xd6)+_0x28d347+'.\x20ANWEISUNG:\x20Fasse\x20Sensor-Events\x20zusammen.\x20SCHEMA:\x20{\x20\x22summary\x22:\x20\x22string\x22,\x20\x22activityLevel\x22:\x20\x22string\x22\x20}\x20\x0a\x0aEVENTS:\x0a'+JSON[_0x5e4a6c(0x18c)](_0x3ffbfd);try{const _0x455103=await this['geminiModel'][_0x5e4a6c(0x126)](_0x3ba6d8),_0x28c8c1=JSON[_0x5e4a6c(0xa1)](_0x455103[_0x5e4a6c(0xf1)][_0x5e4a6c(0xf7)]()[_0x5e4a6c(0xbe)](/```json|```/g,'')[_0x5e4a6c(0x141)]());_0x28c8c1[_0x5e4a6c(0x16b)]&&(this[_0x5e4a6c(0x104)][_0x5e4a6c(0x19f)]({'timestamp':new Date()[_0x5e4a6c(0x144)](),'eventCount':_0x3ffbfd[_0x5e4a6c(0x1cd)],'summary':_0x28c8c1[_0x5e4a6c(0x16b)],'activityLevel':_0x28c8c1[_0x5e4a6c(0xa2)],'systemMode':this[_0x5e4a6c(0x15c)]}),await this[_0x5e4a6c(0x1b9)](),this[_0x5e4a6c(0x119)]=[],await this['saveRawEventLog'](),await this['setStateAsync'](LTM_DP_STATUS,{'val':_0x5e4a6c(0x145)+_0x3ffbfd['length']+_0x5e4a6c(0x17b),'ack':!![]}));}catch(_0x21830e){await this[_0x5e4a6c(0x111)](LTM_DP_STATUS,{'val':_0x5e4a6c(0xe8)+_0x21830e['message'],'ack':!![]});}}async[a0_0x421815(0x95)](){const _0x132a85=a0_0x421815;await this[_0x132a85(0xd0)](),await this[_0x132a85(0x130)](_0x132a85(0x198),{'type':_0x132a85(0x9b),'common':{'name':_0x132a85(0x172),'type':_0x132a85(0x1a7),'role':_0x132a85(0x156),'read':!![],'write':![],'def':!![]},'native':{}}),await this['setObjectNotExistsAsync']('events.lastEvent',{'type':_0x132a85(0x9b),'common':{'name':_0x132a85(0x1c7),'type':'string','role':_0x132a85(0x123),'read':!![],'write':![]},'native':{}}),await this[_0x132a85(0x130)](_0x132a85(0x121),{'type':_0x132a85(0x9b),'common':{'name':_0x132a85(0x1c0),'type':_0x132a85(0x14b),'role':'json','read':!![],'write':![]},'native':{}}),await this[_0x132a85(0x130)](_0x132a85(0xfd),{'type':_0x132a85(0x9b),'common':{'name':'Trigger\x20Analysis','type':_0x132a85(0x1a7),'role':_0x132a85(0x189),'read':!![],'write':!![],'def':![]},'native':{}}),await this[_0x132a85(0x130)]('analysis.lastResult',{'type':'state','common':{'name':_0x132a85(0xed),'type':_0x132a85(0x14b),'role':'json','read':!![],'write':![]},'native':{}}),await this['setObjectNotExistsAsync']('analysis.isAlert',{'type':_0x132a85(0x9b),'common':{'name':_0x132a85(0x19c),'type':'boolean','role':_0x132a85(0xf5),'read':!![],'write':![],'def':![]},'native':{}}),await this[_0x132a85(0x130)](_0x132a85(0xe0),{'type':_0x132a85(0x9b),'common':{'name':_0x132a85(0xe1),'type':_0x132a85(0x1a7),'role':_0x132a85(0x188),'read':!![],'write':![],'def':![]},'native':{}}),await this[_0x132a85(0x130)](_0x132a85(0x17a),{'type':_0x132a85(0x9b),'common':{'name':_0x132a85(0x1a8),'type':'string','role':'text.alarm','read':!![],'write':![]},'native':{}}),await this[_0x132a85(0x130)](_0x132a85(0x97),{'type':'state','common':{'name':_0x132a85(0xe5),'type':_0x132a85(0x14b),'role':'text','read':!![],'write':![]},'native':{}}),await this[_0x132a85(0x130)]('analysis.deviationFromBaseline',{'type':_0x132a85(0x9b),'common':{'name':_0x132a85(0xe4),'type':_0x132a85(0x14b),'role':_0x132a85(0x9b),'read':!![],'write':![],'def':_0x132a85(0xd3)},'native':{}}),await this[_0x132a85(0x130)](_0x132a85(0x1cc),{'type':'state','common':{'name':_0x132a85(0xa7),'type':_0x132a85(0x14b),'role':'text','read':!![],'write':![]},'native':{}}),await this[_0x132a85(0x130)](_0x132a85(0x185),{'type':_0x132a85(0x9b),'common':{'name':'Comfort\x20Suggestion','type':_0x132a85(0x14b),'role':'text','read':!![],'write':![]},'native':{}}),await this[_0x132a85(0x1bb)](_0x132a85(0x180),{'type':'channel','common':{'name':_0x132a85(0x1b8)},'native':{}}),await this[_0x132a85(0x130)](_0x132a85(0xb2),{'type':_0x132a85(0x9b),'common':{'name':_0x132a85(0xee),'type':_0x132a85(0x1a7),'role':_0x132a85(0x156),'read':!![],'write':![],'def':![]},'native':{}}),await this[_0x132a85(0x130)](_0x132a85(0x13a),{'type':_0x132a85(0x9b),'common':{'name':_0x132a85(0x132),'type':'string','role':_0x132a85(0xf7),'read':!![],'write':![]},'native':{}}),await this['setObjectNotExistsAsync'](_0x132a85(0xfc),{'type':_0x132a85(0x9b),'common':{'name':_0x132a85(0xeb),'type':_0x132a85(0x14b),'role':_0x132a85(0xf7),'read':!![],'write':![]},'native':{}}),await this[_0x132a85(0x130)](_0x132a85(0x182),{'type':_0x132a85(0x9b),'common':{'name':_0x132a85(0x1aa),'type':_0x132a85(0x14b),'role':_0x132a85(0x123),'read':!![],'write':![],'def':'[]'},'native':{}}),await this[_0x132a85(0x130)](_0x132a85(0xd8),{'type':_0x132a85(0x9b),'common':{'name':_0x132a85(0x1be),'type':_0x132a85(0x14b),'role':_0x132a85(0x123),'read':!![],'write':![],'def':'[]'},'native':{}}),await this['checkLtmObjects'](),await this[_0x132a85(0xa0)]();}async[a0_0x421815(0xd0)](){const _0x140ca2=a0_0x421815;await this[_0x140ca2(0x1bb)](_0x140ca2(0x170),{'type':_0x140ca2(0x12c),'common':{'name':_0x140ca2(0x12d)},'native':{}}),await this[_0x140ca2(0x1bb)](SYSTEM_DP_MODE,{'type':'state','common':{'name':_0x140ca2(0x13f),'type':_0x140ca2(0x14b),'role':'state','read':!![],'write':!![],'def':SYSTEM_MODES['NORMAL'],'states':{[SYSTEM_MODES['NORMAL']]:_0x140ca2(0x1bc),[SYSTEM_MODES[_0x140ca2(0x165)]]:_0x140ca2(0xfe),[SYSTEM_MODES[_0x140ca2(0x177)]]:_0x140ca2(0x10d),[SYSTEM_MODES[_0x140ca2(0x135)]]:_0x140ca2(0x14a)}},'native':{}});}async[a0_0x421815(0x15e)](_0x238a7f,_0x218387=![],_0x4b86af=![]){const _0x1d0004=a0_0x421815;this['log']['info']((_0x218387?'[TEST]\x20':'')+'Sending\x20notification:\x20\x22'+_0x238a7f+'\x22'+(_0x4b86af?_0x1d0004(0x122):''));const _0x14329f=this[_0x1d0004(0x96)];let _0x205a95=0x0;_0x14329f[_0x1d0004(0x1a0)]&&_0x14329f[_0x1d0004(0x1c6)]&&(await this[_0x1d0004(0x186)](_0x14329f[_0x1d0004(0x1c6)],_0x1d0004(0x1c8),{'text':_0x238a7f,'user':_0x14329f[_0x1d0004(0x125)]}),_0x205a95++);if(_0x14329f[_0x1d0004(0xf2)]&&_0x14329f['notifyPushoverInstance']){let _0x1a49c4={'message':_0x238a7f,'title':_0x4b86af?_0x1d0004(0xb8):_0x1d0004(0x1b6),'priority':_0x4b86af?0x2:0x1,'device':_0x14329f[_0x1d0004(0xff)]};_0x4b86af&&(_0x1a49c4[_0x1d0004(0xa9)]=0x1e,_0x1a49c4[_0x1d0004(0x168)]=0xe10,_0x1a49c4['sound']=_0x1d0004(0x1ab)),await this[_0x1d0004(0x186)](_0x14329f[_0x1d0004(0x1a9)],_0x1d0004(0x1c8),_0x1a49c4),_0x205a95++;}return _0x14329f['notifyEmailEnabled']&&_0x14329f[_0x1d0004(0xa6)]&&(await this[_0x1d0004(0x186)](_0x14329f[_0x1d0004(0xa6)],_0x1d0004(0x1c8),{'text':_0x238a7f,'to':_0x14329f['notifyEmailRecipient']}),_0x205a95++),_0x14329f['notifyWhatsappEnabled']&&_0x14329f[_0x1d0004(0x11c)]&&(await this[_0x1d0004(0x186)](_0x14329f['notifyWhatsappInstance'],_0x1d0004(0x1c8),{'text':_0x238a7f,'phone':_0x14329f['notifyWhatsappRecipient']}),_0x205a95++),_0x14329f[_0x1d0004(0xe3)]&&_0x14329f['notifySignalInstance']&&(await this[_0x1d0004(0x186)](_0x14329f[_0x1d0004(0x9d)],'send',{'text':_0x238a7f,'phone':_0x14329f[_0x1d0004(0x181)]}),_0x205a95++),_0x205a95;}async[a0_0x421815(0xa3)](){const _0xacbd0=a0_0x421815;try{const _0x846b78=await this[_0xacbd0(0xf9)](LTM_DP_RAW_LOG);if(_0x846b78&&_0x846b78[_0xacbd0(0xc7)])this[_0xacbd0(0x119)]=JSON[_0xacbd0(0xa1)](_0x846b78[_0xacbd0(0xc7)]);}catch(_0x52de73){this[_0xacbd0(0x119)]=[];}}async[a0_0x421815(0xc3)](){const _0x100980=a0_0x421815;this['rawEventLog']['length']>RAW_LOG_MAX_SIZE&&this['rawEventLog']['splice'](0x0,this['rawEventLog'][_0x100980(0x1cd)]-RAW_LOG_MAX_SIZE),await this[_0x100980(0x111)](LTM_DP_RAW_LOG,{'val':JSON[_0x100980(0x18c)](this[_0x100980(0x119)]),'ack':!![]});}async['loadDailyDigests'](){const _0x47168f=a0_0x421815;try{const _0x368ff6=await this[_0x47168f(0xf9)](LTM_DP_DAILY_DIGESTS);if(_0x368ff6&&_0x368ff6[_0x47168f(0xc7)])this[_0x47168f(0x104)]=JSON[_0x47168f(0xa1)](_0x368ff6[_0x47168f(0xc7)]);}catch(_0x59ce8f){this[_0x47168f(0x104)]=[];}await this[_0x47168f(0x191)]();}async[a0_0x421815(0x1b9)](_0x20402c=!![]){const _0x161dd5=a0_0x421815,_0x40ad3b=this['config'][_0x161dd5(0x1a4)]||0x3c;this[_0x161dd5(0x104)][_0x161dd5(0x1cd)]>_0x40ad3b&&this[_0x161dd5(0x104)][_0x161dd5(0xc8)](0x0,this[_0x161dd5(0x104)][_0x161dd5(0x1cd)]-_0x40ad3b);await this[_0x161dd5(0x111)](LTM_DP_DAILY_DIGESTS,{'val':JSON[_0x161dd5(0x18c)](this[_0x161dd5(0x104)]),'ack':!![]});if(_0x20402c)await this['updateBaselineStatus']();}[a0_0x421815(0x136)](){const _0x273ef3=a0_0x421815;if(this['ltmJob'])this[_0x273ef3(0x1a2)][_0x273ef3(0x117)]();if(!this[_0x273ef3(0x116)]){this[_0x273ef3(0x111)](LTM_DP_STATUS,{'val':_0x273ef3(0x8e),'ack':!![]});return;}this[_0x273ef3(0x1a2)]=schedule[_0x273ef3(0x127)](LTM_SCHEDULE,()=>this[_0x273ef3(0xec)]());}['setupDriftAnalysisScheduler'](){const _0x5b23e1=a0_0x421815;if(this[_0x5b23e1(0x164)])clearInterval(this[_0x5b23e1(0x164)]);if(!this['isProVersion'])return;this[_0x5b23e1(0x164)]=setInterval(()=>this['runBaselineDriftAnalysis'](),(this[_0x5b23e1(0x96)][_0x5b23e1(0xf8)]||0x18)*0x36ee80),setTimeout(()=>this[_0x5b23e1(0x106)](),0x1388);}async[a0_0x421815(0x153)](){const _0x12a956=a0_0x421815;await this[_0x12a956(0x111)](_0x12a956(0x97),{'val':_0x12a956(0xde),'ack':!![]}),await this[_0x12a956(0x111)](_0x12a956(0x195),{'val':this[_0x12a956(0x116)]?'N/A\x20(No\x20Activity)':_0x12a956(0xd1),'ack':!![]}),await this[_0x12a956(0x111)](_0x12a956(0x1ad),{'val':![],'ack':!![]}),await this[_0x12a956(0x111)](_0x12a956(0xe0),{'val':![],'ack':!![]}),this[_0x12a956(0x159)]=![];}async[a0_0x421815(0x1c9)](_0x2a5778){const _0x2fd2c5=a0_0x421815;this['analysisHistory']['unshift'](_0x2a5778);if(this[_0x2fd2c5(0xaa)][_0x2fd2c5(0x1cd)]>ANALYSIS_HISTORY_MAX_SIZE)this[_0x2fd2c5(0xaa)][_0x2fd2c5(0x129)]();await this[_0x2fd2c5(0x111)](_0x2fd2c5(0x182),{'val':JSON[_0x2fd2c5(0x18c)](this[_0x2fd2c5(0xaa)]),'ack':!![]});}['setupModeResetScheduler'](){const _0x4cb73c=a0_0x421815;if(this[_0x4cb73c(0xf4)])this[_0x4cb73c(0xf4)][_0x4cb73c(0x117)]();this['modeResetJob']=schedule[_0x4cb73c(0x127)](MODE_RESET_SCHEDULE,async()=>{const _0x17a2d8=_0x4cb73c;await this['loadSystemMode'](),AUTO_RESET_MODES[_0x17a2d8(0x18d)](this['currentSystemMode'])&&await this['setStateAsync'](SYSTEM_DP_MODE,{'val':SYSTEM_MODES[_0x17a2d8(0xb4)],'ack':![]});});}async[a0_0x421815(0x191)](){const _0xaab692=a0_0x421815;if(!this[_0xaab692(0x116)]){await this[_0xaab692(0x111)](LTM_DP_BASELINE_STATUS,{'val':_0xaab692(0x8e),'ack':!![]});return;}const _0x263f99=this[_0xaab692(0x104)][_0xaab692(0x1cd)]>=(this[_0xaab692(0x96)][_0xaab692(0x99)]||0x7)?_0xaab692(0xe2)+this[_0xaab692(0x104)][_0xaab692(0x1cd)]+_0xaab692(0x15b):_0xaab692(0xea)+this['dailyDigests'][_0xaab692(0x1cd)]+'/'+(this[_0xaab692(0x96)][_0xaab692(0x99)]||0x7)+')';await this['setStateAsync'](LTM_DP_BASELINE_STATUS,{'val':_0x263f99,'ack':!![]});}async[a0_0x421815(0x18a)](){const _0xedcae7=a0_0x421815;await this[_0xedcae7(0x1bb)](_0xedcae7(0xcb),{'type':_0xedcae7(0x12c),'common':{'name':_0xedcae7(0xcb)},'native':{}}),await this[_0xedcae7(0x1bb)](LTM_DP_RAW_LOG,{'type':'state','common':{'name':_0xedcae7(0x174),'type':_0xedcae7(0x14b),'role':'json','read':!![],'write':![]},'native':{}}),await this[_0xedcae7(0x1bb)](LTM_DP_DAILY_DIGESTS,{'type':_0xedcae7(0x9b),'common':{'name':_0xedcae7(0x8f),'type':_0xedcae7(0x14b),'role':_0xedcae7(0x123),'read':!![],'write':![]},'native':{}}),await this[_0xedcae7(0x1bb)](LTM_DP_STATUS,{'type':'state','common':{'name':_0xedcae7(0x12e),'type':_0xedcae7(0x14b),'role':_0xedcae7(0xf7),'read':!![],'write':![]},'native':{}}),await this[_0xedcae7(0x1bb)](LTM_DP_TRIGGER_DIGEST,{'type':_0xedcae7(0x9b),'common':{'name':'Trigger\x20Digest','type':'boolean','role':_0xedcae7(0x189),'read':!![],'write':!![],'def':![]},'native':{}}),await this[_0xedcae7(0x1bb)](LTM_DP_BASELINE_STATUS,{'type':_0xedcae7(0x9b),'common':{'name':_0xedcae7(0xcc),'type':_0xedcae7(0x14b),'role':'text','read':!![],'write':![]},'native':{}});}async['checkLtmDriftObjects'](){const _0x5732c9=a0_0x421815;await this[_0x5732c9(0x1bb)](LTM_DP_DRIFT_CHANNEL,{'type':'channel','common':{'name':_0x5732c9(0x14e)},'native':{}}),await this[_0x5732c9(0x1bb)](LTM_DP_DRIFT_STATUS,{'type':'state','common':{'name':_0x5732c9(0x11a),'type':_0x5732c9(0x14b),'role':_0x5732c9(0x9b),'read':!![],'write':![],'def':_0x5732c9(0xd3)},'native':{}}),await this[_0x5732c9(0x1bb)](LTM_DP_DRIFT_DETAILS,{'type':_0x5732c9(0x9b),'common':{'name':_0x5732c9(0x1b7),'type':'string','role':_0x5732c9(0xf7),'read':!![],'write':![]},'native':{}}),await this[_0x5732c9(0x1bb)](LTM_DP_DRIFT_LAST_CHECK,{'type':_0x5732c9(0x9b),'common':{'name':_0x5732c9(0x19b),'type':_0x5732c9(0x1bf),'role':_0x5732c9(0xcd),'read':!![],'write':![]},'native':{}});}async[a0_0x421815(0x106)](){const _0x18e1b8=a0_0x421815;if(!this[_0x18e1b8(0x116)]||!this['geminiModel'])return;const _0x2dfd2d=this[_0x18e1b8(0x96)]['ltmStbWindowDays']||0xe;if(this[_0x18e1b8(0x104)][_0x18e1b8(0x1cd)]<_0x2dfd2d+(this[_0x18e1b8(0x96)][_0x18e1b8(0x99)]||0x7)){await this[_0x18e1b8(0x111)](LTM_DP_DRIFT_STATUS,{'val':'N/A\x20(Learning)','ack':!![]});return;}const _0x2f0448=this[_0x18e1b8(0x104)]['slice'](-_0x2dfd2d),_0x347076=this[_0x18e1b8(0x104)][_0x18e1b8(0x158)](0x0,this[_0x18e1b8(0x104)][_0x18e1b8(0x1cd)]-_0x2dfd2d),_0x1cce0f='ROLLE:\x20Data\x20Scientist.\x20VERGLEICHE:\x20Dataset\x20A\x20(Recent)\x20vs\x20B\x20(Established).\x20ZIEL:\x20Erkenne\x20Drift.\x20SCHEMA:\x20{\x20\x22baselineDrift\x22:\x20\x22none|slight|significant|critical\x22,\x20\x22driftDetails\x22:\x20\x22string\x22\x20}\x0a\x0aB\x20(LTB):\x0a'+JSON[_0x18e1b8(0x18c)](_0x347076)+_0x18e1b8(0x14d)+JSON[_0x18e1b8(0x18c)](_0x2f0448);try{const _0x12076c=await this[_0x18e1b8(0x142)][_0x18e1b8(0x126)](_0x1cce0f),_0x5a81ec=JSON['parse'](_0x12076c[_0x18e1b8(0xf1)][_0x18e1b8(0xf7)]()[_0x18e1b8(0xbe)](/```json|```/g,'')[_0x18e1b8(0x141)]());_0x5a81ec['baselineDrift']&&(await this[_0x18e1b8(0x111)](LTM_DP_DRIFT_STATUS,{'val':_0x5a81ec['baselineDrift'],'ack':!![]}),await this[_0x18e1b8(0x111)](LTM_DP_DRIFT_DETAILS,{'val':_0x5a81ec[_0x18e1b8(0x1a5)],'ack':!![]}),await this[_0x18e1b8(0x111)](LTM_DP_DRIFT_LAST_CHECK,{'val':Date[_0x18e1b8(0x19d)](),'ack':!![]}));}catch(_0x169761){}}async['loadSystemMode'](){const _0x4808f7=a0_0x421815;try{const _0x3ebd6b=await this['getStateAsync'](SYSTEM_DP_MODE);_0x3ebd6b&&_0x3ebd6b[_0x4808f7(0xc7)]&&Object[_0x4808f7(0x16f)](SYSTEM_MODES)['includes'](_0x3ebd6b[_0x4808f7(0xc7)])?this[_0x4808f7(0x15c)]=_0x3ebd6b[_0x4808f7(0xc7)]:(this[_0x4808f7(0x15c)]=SYSTEM_MODES[_0x4808f7(0xb4)],await this[_0x4808f7(0x111)](SYSTEM_DP_MODE,{'val':SYSTEM_MODES[_0x4808f7(0xb4)],'ack':!![]}));}catch(_0x20f5f2){this[_0x4808f7(0x15c)]=SYSTEM_MODES[_0x4808f7(0xb4)];}}async[a0_0x421815(0x109)](){const _0x1df002=a0_0x421815;try{const _0x58bd3f=await this[_0x1df002(0x102)](_0x1df002(0x9f));if(_0x58bd3f&&_0x58bd3f[_0x1df002(0x193)]&&_0x58bd3f[_0x1df002(0x193)][_0x1df002(0x10c)])return _0x58bd3f[_0x1df002(0x193)][_0x1df002(0x10c)];return'uuid-not-found';}catch(_0x3c1a67){return'uuid-error';}}async['checkLicense'](_0x4f8ed3){const _0x29db3f=a0_0x421815;if(!_0x4f8ed3)return![];this[_0x29db3f(0x8d)]=await this['getSystemUUID']();if(_0x4f8ed3==='TEST-PRO-KEY'||_0x4f8ed3[_0x29db3f(0x157)](_0x29db3f(0x148)))return!![];return![];}['onUnload'](_0x5305b1){const _0x1d1aaf=a0_0x421815;if(this[_0x1d1aaf(0x1b5)])clearInterval(this[_0x1d1aaf(0x1b5)]);if(this[_0x1d1aaf(0x164)])clearInterval(this[_0x1d1aaf(0x164)]);if(this[_0x1d1aaf(0x1a2)])this[_0x1d1aaf(0x1a2)][_0x1d1aaf(0x117)]();if(this[_0x1d1aaf(0xf4)])this[_0x1d1aaf(0xf4)][_0x1d1aaf(0x117)]();if(this[_0x1d1aaf(0xda)])clearTimeout(this[_0x1d1aaf(0xda)]);if(this[_0x1d1aaf(0x16e)])clearTimeout(this[_0x1d1aaf(0x16e)]);_0x5305b1();}async[a0_0x421815(0x98)](_0x2aaa28){const _0x586b74=a0_0x421815;if(typeof _0x2aaa28===_0x586b74(0x1c3)&&_0x2aaa28['message']){if(_0x2aaa28[_0x586b74(0xb1)]===_0x586b74(0xc0)){if(!_0x2aaa28[_0x586b74(0x151)]['apiKey'])return this[_0x586b74(0x10f)](_0x2aaa28['from'],_0x2aaa28[_0x586b74(0xb1)],{'success':![],'message':_0x586b74(0x1ae)},_0x2aaa28[_0x586b74(0xae)]);try{const _0x3325d6=new GoogleGenerativeAI(_0x2aaa28['message'][_0x586b74(0xc5)])[_0x586b74(0x1cb)]({'model':'models/gemini-flash-latest'});await _0x3325d6[_0x586b74(0x126)](_0x586b74(0xb5)),this[_0x586b74(0x10f)](_0x2aaa28['from'],_0x2aaa28[_0x586b74(0xb1)],{'success':!![],'message':'Success'},_0x2aaa28[_0x586b74(0xae)]);}catch(_0x53a922){this['sendTo'](_0x2aaa28[_0x586b74(0x137)],_0x2aaa28['command'],{'success':![],'message':_0x53a922[_0x586b74(0x151)]},_0x2aaa28[_0x586b74(0xae)]);}}else{if(_0x2aaa28[_0x586b74(0xb1)]===_0x586b74(0x9e)){const _0x4f43bd=await this[_0x586b74(0x15e)](_0x586b74(0x120),!![]);this[_0x586b74(0x10f)](_0x2aaa28['from'],_0x2aaa28[_0x586b74(0xb1)],{'success':_0x4f43bd>0x0,'message':_0x4f43bd+_0x586b74(0x15f)},_0x2aaa28['callback']);}else{if(_0x2aaa28[_0x586b74(0xb1)]===_0x586b74(0x94)){if(!this[_0x586b74(0x116)])return this[_0x586b74(0x10f)](_0x2aaa28['from'],_0x2aaa28[_0x586b74(0xb1)],{'success':![],'isPro':![]},_0x2aaa28['callback']);let _0xcf3916={'status':'N/A','details':'','lastCheck':0x0};try{_0xcf3916[_0x586b74(0x8c)]=(await this[_0x586b74(0xf9)](LTM_DP_DRIFT_STATUS))[_0x586b74(0xc7)],_0xcf3916[_0x586b74(0x1c5)]=(await this[_0x586b74(0xf9)](LTM_DP_DRIFT_DETAILS))['val'],_0xcf3916[_0x586b74(0xab)]=(await this[_0x586b74(0xf9)](LTM_DP_DRIFT_LAST_CHECK))['val'];}catch(_0x4f0b3f){}this['sendTo'](_0x2aaa28[_0x586b74(0x137)],_0x2aaa28[_0x586b74(0xb1)],{'success':!![],'isPro':!![],'dailyDigests':this['dailyDigests'],'driftAnalysis':_0xcf3916,'analysisHistory':this[_0x586b74(0xaa)]},_0x2aaa28[_0x586b74(0xae)]);}else{if(_0x2aaa28[_0x586b74(0xb1)]===_0x586b74(0xb7)){const _0x51daa8=await this[_0x586b74(0x17d)]('enum.functions.*',_0x586b74(0xd9)),_0x8a696c=[];if(_0x51daa8)for(const _0x39036f in _0x51daa8){const _0x59f441=_0x51daa8[_0x39036f],_0x3b8637=(_0x59f441[_0x586b74(0x169)]&&typeof _0x59f441[_0x586b74(0x169)][_0x586b74(0x199)]===_0x586b74(0x1c3)?_0x59f441[_0x586b74(0x169)][_0x586b74(0x199)]['de']:_0x59f441[_0x586b74(0x169)][_0x586b74(0x199)])||_0x59f441['common'][_0x586b74(0x199)];_0x8a696c[_0x586b74(0x19f)]({'id':_0x39036f,'name':_0x3b8637});}this[_0x586b74(0x10f)](_0x2aaa28['from'],_0x2aaa28[_0x586b74(0xb1)],{'success':!![],'enums':_0x8a696c},_0x2aaa28[_0x586b74(0xae)]);}else{if(_0x2aaa28['command']==='scanDevices')try{const _0x1fd9b2=await this['scanForDevices'](_0x2aaa28[_0x586b74(0x151)]||{});this[_0x586b74(0x10f)](_0x2aaa28[_0x586b74(0x137)],_0x2aaa28['command'],{'success':!![],'devices':_0x1fd9b2},_0x2aaa28[_0x586b74(0xae)]);}catch(_0x14ecac){this[_0x586b74(0x10f)](_0x2aaa28['from'],_0x2aaa28['command'],{'success':![],'error':_0x14ecac[_0x586b74(0x151)]},_0x2aaa28[_0x586b74(0xae)]);}else{if(_0x2aaa28[_0x586b74(0xb1)]===_0x586b74(0x154)){const {historyId:_0x4c9eb7,rating:_0x29735d,comment:_0x50b9d1,alertReason:_0x26ba01}=_0x2aaa28[_0x586b74(0x151)];_0x4c9eb7&&_0x29735d?(await this[_0x586b74(0xc9)]({'timestamp':Date[_0x586b74(0x19d)](),'historyId':_0x4c9eb7,'rating':_0x29735d,'comment':_0x50b9d1,'alertReason':_0x26ba01}),this[_0x586b74(0x10f)](_0x2aaa28['from'],_0x2aaa28[_0x586b74(0xb1)],{'success':!![]},_0x2aaa28[_0x586b74(0xae)])):this[_0x586b74(0x10f)](_0x2aaa28[_0x586b74(0x137)],_0x2aaa28[_0x586b74(0xb1)],{'success':![],'error':_0x586b74(0x16a)},_0x2aaa28[_0x586b74(0xae)]);}}}}}}}}}function a0_0x68b8(){const _0x3e6048=['type','onStateChange','getSystemUUID','systemConfig','constructor','uuid','Party','runAutopilot','sendTo','patternDetected','setStateAsync','\x22\x20was\x20','stateChange','subscribeStates','events.lastEvent','isProVersion','cancel','comfort','rawEventLog','Drift\x20Status','WiFi\x20Presence\x20detected\x20->\x20Aborting\x20Exit\x20Timer.\x20User\x20is\x20present.','notifyWhatsappInstance','getForeignStateAsync','onReady','isAlert','[Test]\x20Notification','events.history','\x20(EMERGENCY)','json','cogni-living\x20adapter\x20starting\x20(v','notifyTelegramRecipient','generateContent','scheduleJob','error','pop','genAI','\x20min).\x20Watchdog\x20Limit:\x20','channel','System\x20Status\x20&\x20Control','Processing\x20Status','system.config','setObjectNotExistsAsync','setPresence','Description','Skipped\x20(No\x20AI\x20or\x20Data)','ROLLE:\x20Smart\x20Home\x20Analyst.\x20SPRACHE:\x20DE.\x20FORMAT:\x20JSON.\x20\x0a\x20\x20\x20\x20\x20\x20\x20\x20AKTUELLE\x20ZEIT:\x20','GUEST','setupLtmScheduler','from','.\x20PERSONA:\x20','bind','analysis.automation.description','âš ï¸\x20Alarm','0\x203\x20*\x20*\x20*','onUnload','Started\x20at\x20','System\x20Mode','setupDriftAnalysisScheduler','trim','geminiModel','models/gemini-flash-latest','toISOString','Success:\x20Compressed\x20','abortExitTimer','toLocaleString','PRO-','node-schedule','Gast','string','alertReason','\x0a\x0aA\x20(STB):\x0a','Drift\x20Analysis','Baseline:\x20Inactive\x20(Pro\x20Feature).','analysisInterval','message','sensorLastValues','resetAnalysisStates','submitFeedback','city','indicator','startsWith','slice','lastAlertState','generic','\x20Tage)','currentSystemMode','Analysiere\x20ausgewogen\x20auf\x20Gesundheit,\x20Sicherheit\x20und\x20Komfort.','sendNotification','\x20sent','version','\x0aFEEDBACK:\x0a','latitude','livingContext','driftAnalysisTimer','VACATION','@iobroker/adapter-core','LTM.driftAnalysis.driftDetails','expire','common','Missing\x20data','summary','2416905TGunGe','0\x204\x20*\x20*\x20*','exitGraceTimer','values','system','application/json','Presence\x20Status','8UXmfej','Raw\x20Log','find','.\x20\x0a\x20\x20\x20\x20\x20\x20\x20\x20KONTEXT:\x20','PARTY','suggestedAction','search','analysis.alertReason','\x20events','join','getForeignObjectsAsync','2-digit','LTM.rawEventLog','analysis.automation','notifySignalRecipient','analysis.analysisHistory','triggerDailyDigest','checkWifiPresence','analysis.comfortSuggestion','sendToAsync','\x20\x0a\x20\x20\x20\x20\x20\x20\x20\x20SCHEMA:\x20{\x20\x22activity\x22:\x20{\x20\x22summary\x22:\x20\x22string\x22,\x20\x22deviationFromBaseline\x22:\x20\x22string\x22,\x20\x22isAlert\x22:\x20bool,\x20\x22isEmergency\x22:\x20bool,\x20\x22alertReason\x22:\x20\x22string\x22\x20},\x20\x22comfort\x22:\x20{\x20\x22summary\x22:\x20\x22string\x22,\x20\x22suggestion\x22:\x20\x22string\x22,\x20\x22automationProposal\x22:\x20{\x20\x22patternDetected\x22:\x20bool,\x20\x22description\x22:\x20\x22string\x22,\x20\x22suggestedAction\x22:\x20\x22string\x22\x20}\x20}\x20}','indicator.alarm.fire','button','checkLtmObjects','licenseKey','stringify','includes','longitude','ready','cogni-living','updateBaselineStatus','User\x20Feedback:\x20Alarm\x20\x22','native','948256nrAdOC','analysis.deviationFromBaseline','rating','loadHistoryFromState','system.isPresent','name','setState','Last\x20Check','AI\x20Alert\x20Status','now','location','push','notifyTelegramEnabled','Fokus\x20auf\x20Maximierung\x20von\x20Komfort,\x20Automatisierungseffizienz\x20und\x20Energieeinsparung.','ltmJob','exports','ltmLtbWindowDays','driftDetails','Subscribing\x20to\x20','boolean','Alert\x20Reason','notifyPushoverInstance','Logbook','siren','namespace','analysis.isAlert','No\x20Key','Nein','map','\x20sensors...','isExit','LTM.dailyDigests','\x20presence\x20devices\x20(WiFi/Network)...','analysisTimer','Cogni-Living\x20Alert','Drift\x20Details','Automation\x20Proposals','saveDailyDigests','25767333rsDZuN','extendObjectAsync','Normal','deviationFromBaseline','Feedback\x20Log','number','Event\x20History','isPresent','vacation','object','eventHistory','details','notifyTelegramInstance','Last\x20raw\x20event','send','updateAnalysisHistory','automationProposal','getGenerativeModel','analysis.comfortSummary','length','ack','status','systemUUID','Deaktiviert\x20(Pro-Feature)','Daily\x20Digests','1232266figOxd','timestamp','normal','suggestion','getLtmData','createAllObjects','config','analysis.activitySummary','onMessage','minDaysForBaseline','aiPersona','state','9828444SaxRaw','notifySignalInstance','testNotification','system.meta.uuid','checkLtmDriftObjects','parse','activityLevel','loadRawEventLog','runGeminiAnalysis','PRIORITÃ„T:\x20Sicherheit.\x20Erkenne\x20Eindringlinge,\x20ungewÃ¶hnliche\x20Anwesenheit.','notifyEmailInstance','Comfort\x20Summary','.\x0a\x20\x20\x20\x20\x20\x20\x20\x20MODUS:\x20','retry','analysisHistory','lastCheck','unload','isEmergency','callback','3281244uBmEoK','setupModeResetScheduler','command','analysis.automation.patternDetected','\x0a\x20\x20\x20\x20\x20\x20\x20\x20EVENTS:\x20','NORMAL','test','4aOiCit','getEnums','ðŸš¨\x20EMERGENCY','11590096EHOejm','toString','(((.+)+)+)+$','Starting\x20Autopilot\x20(','isGracePeriodActive','replace','LTM.baselineStatus','testApiKey','substring','info','saveRawEventLog','LTM.processingStatus','apiKey','guest','val','splice','saveFeedback','checkLicense','LTM','Baseline\x20Status','date','inactivityThresholdHours','activity','checkSystemObjects','N/A\x20(Pro\x20Feature)','Analysis\x20Error:\x20','N/A','loadSystemMode','presenceDevices','ROLLE:\x20Compression\x20Agent.\x20SPRACHE:\x20DE.\x20FORMAT:\x20JSON.\x20KONTEXT:\x20','processSensorEvent','analysis.feedbackHistory','enum','exitTimer','geminiApiKey','log','apply','No\x20recent\x20activity.','feedbackHistory','analysis.isEmergency','AI\x20Emergency\x20Status','Aktiv\x20(','notifySignalEnabled','Deviation','Activity\x20Summary','LTM.driftAnalysis.baselineDrift','startExitTimer','Error:\x20','catch','Lernphase\x20(','Action','createDailyDigest','Last\x20Result','Pattern\x20Detected','inactivityMonitoringEnabled','subscribeForeignStatesAsync','response','notifyPushoverEnabled','analysis.lastResult','modeResetJob','indicator.alarm','\x0a!!!\x20END\x20WARNING\x20!!!\x0a','text','ltmDriftCheckIntervalHours','getStateAsync','toFixed','PRIORITÃ„T:\x20Gesundheit\x20und\x20Sicherheit\x20fÃ¼r\x20Senioren\x20(AAL).\x20Erkenne\x20InaktivitÃ¤t,\x20potenzielle\x20StÃ¼rze\x20(indirekt),\x20ungewÃ¶hnliche\x20nÃ¤chtliche\x20AktivitÃ¤t.','analysis.automation.suggestedAction','analysis.trigger','Urlaub','notifyPushoverRecipient','system.mode','Gemini\x20AI\x20initialized.','getForeignObjectAsync','Gemini\x20Init\x20Error:\x20','dailyDigests','\x20hours.\x20The\x20resident\x20might\x20be\x20incapacitated.\x20Risk\x20level:\x20HIGH.','runBaselineDriftAnalysis'];a0_0x68b8=function(){return _0x3e6048;};return a0_0x68b8();}if(require['main']!==module)module[a0_0x421815(0x1a3)]=_0x999b31=>new CogniLiving(_0x999b31);else new CogniLiving();