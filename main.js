const a0_0x15e53b=a0_0x555f;(function(_0x120631,_0x4152cd){const _0x3dc241=a0_0x555f,_0x32f0cc=_0x120631();while(!![]){try{const _0x410c59=-parseInt(_0x3dc241(0x2c6))/0x1*(-parseInt(_0x3dc241(0x29b))/0x2)+parseInt(_0x3dc241(0x246))/0x3+parseInt(_0x3dc241(0x29a))/0x4+parseInt(_0x3dc241(0x2ad))/0x5*(parseInt(_0x3dc241(0x248))/0x6)+parseInt(_0x3dc241(0x1fa))/0x7+parseInt(_0x3dc241(0x22b))/0x8+-parseInt(_0x3dc241(0x204))/0x9*(parseInt(_0x3dc241(0x258))/0xa);if(_0x410c59===_0x4152cd)break;else _0x32f0cc['push'](_0x32f0cc['shift']());}catch(_0x21e3df){_0x32f0cc['push'](_0x32f0cc['shift']());}}}(a0_0x4932,0x9f3e2));const a0_0x45ab9a=(function(){let _0x11712e=!![];return function(_0x5a4339,_0x36ff9a){const _0x2b0491=_0x11712e?function(){const _0x2e42df=a0_0x555f;if(_0x36ff9a){const _0x1f0eec=_0x36ff9a[_0x2e42df(0x284)](_0x5a4339,arguments);return _0x36ff9a=null,_0x1f0eec;}}:function(){};return _0x11712e=![],_0x2b0491;};}()),a0_0x36df59=a0_0x45ab9a(this,function(){const _0x8dfdf6=a0_0x555f;return a0_0x36df59[_0x8dfdf6(0x285)]()[_0x8dfdf6(0x1f1)]('(((.+)+)+)+$')[_0x8dfdf6(0x285)]()['constructor'](a0_0x36df59)[_0x8dfdf6(0x1f1)]('(((.+)+)+)+$');});a0_0x36df59();'use strict';function a0_0x555f(_0x5532a2,_0x97cf0a){const _0xdebf21=a0_0x4932();return a0_0x555f=function(_0x36df59,_0x45ab9a){_0x36df59=_0x36df59-0x1e5;let _0x49327e=_0xdebf21[_0x36df59];return _0x49327e;},a0_0x555f(_0x5532a2,_0x97cf0a);}const utils=require(a0_0x15e53b(0x205)),{GoogleGenerativeAI}=require(a0_0x15e53b(0x280)),installer=require(a0_0x15e53b(0x29e)),scanner=require(a0_0x15e53b(0x23c)),schedulers=require(a0_0x15e53b(0x24f)),topology=require(a0_0x15e53b(0x2a5)),setup=require(a0_0x15e53b(0x2a4)),recorder=require(a0_0x15e53b(0x23a)),pythonBridge=require(a0_0x15e53b(0x243)),aiAgent=require('./lib/ai_agent'),deadMan=require(a0_0x15e53b(0x2b0)),automation=require(a0_0x15e53b(0x251)),GEMINI_MODEL=a0_0x15e53b(0x2a3),ACTIVITY_LEVEL_MAP={'sehr\x20hoch':0x64,'hoch':0x50,'normal':0x3c,'niedrig':0x28,'sehr\x20niedrig':0x14,'inaktiv':0x0};class CogniLiving extends utils['Adapter']{constructor(_0x2c28b2){const _0x24d37b=a0_0x15e53b;super({..._0x2c28b2,'name':_0x24d37b(0x242)}),this[_0x24d37b(0x25d)]=[],this[_0x24d37b(0x21e)]=[],this[_0x24d37b(0x1ea)]=[],this[_0x24d37b(0x24e)]=[],this['sensorLastValues']={},this[_0x24d37b(0x282)]={'latitude':0x0,'longitude':0x0,'city':''},this[_0x24d37b(0x250)]=!![],this[_0x24d37b(0x271)]=null,this[_0x24d37b(0x256)]=null,this[_0x24d37b(0x299)]=![],this['genAI']=null,this[_0x24d37b(0x27d)]=null,this[_0x24d37b(0x291)]=setup[_0x24d37b(0x287)]['NORMAL'],this[_0x24d37b(0x200)]=![],this[_0x24d37b(0x2b6)]=![],this[_0x24d37b(0x1f6)]=null,this['ltmJob']=null,this[_0x24d37b(0x294)]=null,this[_0x24d37b(0x2a7)]=null,this['briefingJob']=null,this[_0x24d37b(0x1ed)]=![],this['on'](_0x24d37b(0x20a),this[_0x24d37b(0x1ff)][_0x24d37b(0x229)](this)),this['on'](_0x24d37b(0x2a1),this[_0x24d37b(0x2aa)][_0x24d37b(0x229)](this)),this['on'](_0x24d37b(0x269),this[_0x24d37b(0x27a)][_0x24d37b(0x229)](this)),this['on'](_0x24d37b(0x211),this[_0x24d37b(0x254)][_0x24d37b(0x229)](this));}async[a0_0x15e53b(0x1ff)](){const _0x39510a=a0_0x15e53b;this[_0x39510a(0x25b)][_0x39510a(0x235)]('cogni-living\x20adapter\x20starting\x20(v'+this[_0x39510a(0x265)]+_0x39510a(0x234));if(!installer[_0x39510a(0x220)](this,()=>this['startSystem']()))return;}async[a0_0x15e53b(0x24a)](){const _0x300807=a0_0x15e53b;await setup[_0x300807(0x232)](this);try{this[_0x300807(0x200)]=await setup[_0x300807(0x25e)](this[_0x300807(0x286)][_0x300807(0x20d)]);}catch(_0x129a1d){}if(!this[_0x300807(0x286)][_0x300807(0x20f)]||this['config'][_0x300807(0x20f)]<0.1)this['config']['inactivityThresholdHours']=0xc;await setup[_0x300807(0x1e7)](this),await setup['initSystemConfig'](this);if(this[_0x300807(0x286)][_0x300807(0x266)])try{this[_0x300807(0x2d4)]=new GoogleGenerativeAI(this[_0x300807(0x286)]['geminiApiKey']),this[_0x300807(0x27d)]=this[_0x300807(0x2d4)][_0x300807(0x2d1)]({'model':GEMINI_MODEL,'generationConfig':{'responseMimeType':_0x300807(0x216)}}),this[_0x300807(0x25b)][_0x300807(0x235)](_0x300807(0x2ce));}catch(_0x199b9d){this[_0x300807(0x25b)][_0x300807(0x20b)](_0x300807(0x252)+_0x199b9d[_0x300807(0x211)]);}await setup[_0x300807(0x2a6)](this),await this[_0x300807(0x225)]();try{const _0x24184b=await this[_0x300807(0x223)](_0x300807(0x1fb));if(_0x24184b&&_0x24184b[_0x300807(0x228)])this[_0x300807(0x1ea)]=JSON[_0x300807(0x28c)](_0x24184b[_0x300807(0x228)]);}catch(_0x43b844){this[_0x300807(0x1ea)]=[];}try{const _0x55ddef=await this[_0x300807(0x223)](_0x300807(0x227));if(_0x55ddef&&_0x55ddef['val'])this[_0x300807(0x24e)]=JSON['parse'](_0x55ddef[_0x300807(0x228)]);}catch(_0x14a890){this['dailyDigests']=[];}const _0x2c3d19=this[_0x300807(0x24e)][_0x300807(0x201)]>=(this[_0x300807(0x286)][_0x300807(0x214)]||0x7)?_0x300807(0x1eb)+this[_0x300807(0x24e)][_0x300807(0x201)]+_0x300807(0x2c9):_0x300807(0x22d)+this[_0x300807(0x24e)][_0x300807(0x201)]+'/'+(this['config'][_0x300807(0x214)]||0x7)+')';await this['setStateAsync'](_0x300807(0x292),{'val':_0x2c3d19,'ack':!![]}),this['subscribeStates'](_0x300807(0x2cb)),this['subscribeStates'](_0x300807(0x2d0)),this[_0x300807(0x230)](_0x300807(0x219)),this[_0x300807(0x230)](_0x300807(0x260)),this['subscribeStates'](_0x300807(0x203)),this['subscribeStates']('analysis.automation.autoApply'),this['subscribeStates'](_0x300807(0x26b)),this[_0x300807(0x230)](_0x300807(0x1f2)),this[_0x300807(0x230)]('analysis.training.triggerEnergy'),this[_0x300807(0x230)](_0x300807(0x23d)),this[_0x300807(0x230)]('analysis.training.triggerTopology'),this[_0x300807(0x230)]('analysis.energy.mpcActive');const _0x364193=this['config']['devices'];if(_0x364193)for(const _0x404616 of _0x364193){await this[_0x300807(0x2c4)](_0x404616['id']);}const _0x15340e=this[_0x300807(0x286)][_0x300807(0x297)];if(_0x15340e)for(const _0x2bd607 of _0x15340e){await this[_0x300807(0x2c4)](_0x2bd607);}if(this[_0x300807(0x286)][_0x300807(0x277)]&&this[_0x300807(0x286)]['notifyTelegramInstance'])await this['subscribeForeignStatesAsync'](this[_0x300807(0x286)][_0x300807(0x222)]+_0x300807(0x1fc));setTimeout(()=>this[_0x300807(0x2d2)](),0x1388);if(this['analysisTimer'])clearInterval(this['analysisTimer']);const _0x36d2f9=this[_0x300807(0x286)][_0x300807(0x23b)]||0xf;_0x36d2f9>0x0&&(this[_0x300807(0x1f6)]=setInterval(()=>{const _0x3852df=_0x300807;this[_0x3852df(0x213)]();},_0x36d2f9*0x3c*0x3e8)),schedulers[_0x300807(0x202)](this,()=>aiAgent['createDailyDigest'](this,pythonBridge)),schedulers[_0x300807(0x290)](this),schedulers[_0x300807(0x236)](this,()=>aiAgent[_0x300807(0x27f)](this)),schedulers[_0x300807(0x20c)](this,()=>aiAgent[_0x300807(0x21d)](this)),pythonBridge[_0x300807(0x1ee)](this,installer['PYTHON_EXE']),setTimeout(async()=>{const _0x56e2f3=_0x300807;await topology[_0x56e2f3(0x2b1)](this);try{const _0x2e0589=await this['getStateAsync'](_0x56e2f3(0x1ec));if(_0x2e0589&&_0x2e0589[_0x56e2f3(0x228)])pythonBridge[_0x56e2f3(0x26a)](this,_0x56e2f3(0x2d3),JSON['parse'](_0x2e0589[_0x56e2f3(0x228)]));}catch(_0x1c1c69){}this[_0x56e2f3(0x2c5)](),this[_0x56e2f3(0x2ae)](),this[_0x56e2f3(0x2b3)](),this['updateHealthVector']();},0x1388);}[a0_0x15e53b(0x27a)](_0x210c62){const _0x35fa40=a0_0x15e53b;if(this[_0x35fa40(0x1f6)])clearInterval(this['analysisTimer']);if(this[_0x35fa40(0x2a7)])clearInterval(this[_0x35fa40(0x2a7)]);if(this[_0x35fa40(0x2b5)])this[_0x35fa40(0x2b5)][_0x35fa40(0x2a2)]();if(this[_0x35fa40(0x294)])this[_0x35fa40(0x294)]['cancel']();if(this[_0x35fa40(0x2ca)])this[_0x35fa40(0x2ca)][_0x35fa40(0x2a2)]();recorder[_0x35fa40(0x268)](this),pythonBridge['stopService'](this),_0x210c62();}async['onStateChange'](_0x31422a,_0x17db24){const _0x2389f3=a0_0x15e53b;if(!_0x17db24||this['dependencyInstallInProgress'])return;if(_0x31422a[_0x2389f3(0x1f9)](_0x2389f3(0x22e))&&_0x31422a[_0x2389f3(0x283)]('communicate.request')&&_0x17db24[_0x2389f3(0x228)])return;if(_0x31422a===this[_0x2389f3(0x27e)]+_0x2389f3(0x1fd)){if(_0x17db24['val']&&Object[_0x2389f3(0x272)](setup['SYSTEM_MODES'])[_0x2389f3(0x1f9)](_0x17db24[_0x2389f3(0x228)])){this['currentSystemMode']=_0x17db24[_0x2389f3(0x228)];if(_0x17db24[_0x2389f3(0x228)]===setup[_0x2389f3(0x287)]['VACATION'])await recorder[_0x2389f3(0x2ba)](this,![]);else await recorder['setPresence'](this,!![]);}if(!_0x17db24[_0x2389f3(0x26f)])this['setState'](_0x31422a,{'val':this[_0x2389f3(0x291)],'ack':!![]});return;}if(!_0x17db24[_0x2389f3(0x26f)]){_0x31422a[_0x2389f3(0x1f9)](_0x2389f3(0x2cb))&&_0x17db24[_0x2389f3(0x228)]&&(this[_0x2389f3(0x2af)](_0x31422a,{'val':![],'ack':!![]}),aiAgent[_0x2389f3(0x208)](this));if(_0x31422a['includes'](_0x2389f3(0x1f5))&&_0x17db24['val']){this['setState'](_0x31422a,{'val':![],'ack':!![]});if(this['isProVersion'])aiAgent[_0x2389f3(0x264)](this,pythonBridge);}_0x31422a[_0x2389f3(0x1f9)]('triggerBriefing')&&_0x17db24[_0x2389f3(0x228)]&&(this[_0x2389f3(0x2af)](_0x31422a,{'val':![],'ack':!![]}),aiAgent[_0x2389f3(0x21d)](this));_0x31422a[_0x2389f3(0x1f9)](_0x2389f3(0x226))&&_0x17db24[_0x2389f3(0x228)]&&(this[_0x2389f3(0x2af)](_0x31422a,{'val':![],'ack':!![]}),aiAgent[_0x2389f3(0x2b2)](this));if(_0x31422a['includes'](_0x2389f3(0x26b))&&_0x17db24[_0x2389f3(0x228)]){this['setState'](_0x31422a,{'val':![],'ack':!![]});if(this[_0x2389f3(0x200)])try{const _0x4e5ba5=await this['getStateAsync'](_0x2389f3(0x2a9));if(_0x4e5ba5&&_0x4e5ba5['val']){const _0x510a99=JSON[_0x2389f3(0x28c)](_0x4e5ba5[_0x2389f3(0x228)]);this[_0x2389f3(0x245)]('analysis.training.status',{'val':_0x2389f3(0x2b8),'ack':!![]}),pythonBridge[_0x2389f3(0x26a)](this,_0x2389f3(0x259),{'sequences':_0x510a99});}}catch(_0x473371){}}if(_0x31422a[_0x2389f3(0x1f9)](_0x2389f3(0x1f2))&&_0x17db24['val']){this[_0x2389f3(0x2af)](_0x31422a,{'val':![],'ack':!![]});if(this['isProVersion'])try{const _0x3a7b76=await this[_0x2389f3(0x223)](_0x2389f3(0x227));if(_0x3a7b76&&_0x3a7b76[_0x2389f3(0x228)])pythonBridge[_0x2389f3(0x26a)](this,_0x2389f3(0x2b9),{'digests':JSON[_0x2389f3(0x28c)](_0x3a7b76[_0x2389f3(0x228)])});}catch(_0x1ff4b2){}}if(_0x31422a[_0x2389f3(0x1f9)]('analysis.training.triggerEnergy')&&_0x17db24['val']){this['setState'](_0x31422a,{'val':![],'ack':!![]});if(this['isProVersion'])try{const _0x241355=await this['getStateAsync'](_0x2389f3(0x240));if(_0x241355&&_0x241355[_0x2389f3(0x228)])pythonBridge[_0x2389f3(0x26a)](this,_0x2389f3(0x212),{'points':JSON[_0x2389f3(0x28c)](_0x241355['val'])});}catch(_0x1f4450){}}if(_0x31422a[_0x2389f3(0x1f9)](_0x2389f3(0x23d))&&_0x17db24[_0x2389f3(0x228)]){this[_0x2389f3(0x2af)](_0x31422a,{'val':![],'ack':!![]});if(this[_0x2389f3(0x200)])try{const _0x67aa23=await this[_0x2389f3(0x223)]('LTM.rawEventLog');if(_0x67aa23&&_0x67aa23[_0x2389f3(0x228)])pythonBridge['send'](this,_0x2389f3(0x26e),{'events':JSON['parse'](_0x67aa23[_0x2389f3(0x228)])});}catch(_0x2981d5){}}_0x31422a['includes'](_0x2389f3(0x295))&&_0x17db24[_0x2389f3(0x228)]&&(this[_0x2389f3(0x2af)](_0x31422a,{'val':![],'ack':!![]}),topology['updateTopology'](this));return;}if(this['config'][_0x2389f3(0x297)]&&this['config'][_0x2389f3(0x297)][_0x2389f3(0x1f9)](_0x31422a)){await this[_0x2389f3(0x2d2)]();return;}const _0xbb5daf=(this[_0x2389f3(0x286)][_0x2389f3(0x217)]||[])[_0x2389f3(0x241)](_0x2b4229=>_0x2b4229['id']===_0x31422a);if(_0xbb5daf){const _0x1edebc=await recorder[_0x2389f3(0x28b)](this,_0x31422a,_0x17db24,_0xbb5daf);_0x1edebc&&_0x1edebc[_0x2389f3(0x2cf)]===_0x2389f3(0x257)&&_0x1edebc[_0x2389f3(0x1e6)]&&this[_0x2389f3(0x200)]&&deadMan[_0x2389f3(0x2c8)](this,_0x1edebc[_0x2389f3(0x1e6)]);}}async[a0_0x15e53b(0x254)](_0x33df5f){const _0x12e1f9=a0_0x15e53b;if(typeof _0x33df5f===_0x12e1f9(0x2bd)&&_0x33df5f[_0x12e1f9(0x211)]){if(_0x33df5f[_0x12e1f9(0x218)]===_0x12e1f9(0x1f3))try{const _0x2951ef=await automation[_0x12e1f9(0x21a)](this);this[_0x12e1f9(0x2bc)](_0x33df5f['from'],_0x33df5f[_0x12e1f9(0x218)],{'success':!![],'results':_0x2951ef},_0x33df5f[_0x12e1f9(0x21c)]);}catch(_0x4a8922){this[_0x12e1f9(0x2bc)](_0x33df5f[_0x12e1f9(0x29c)],_0x33df5f[_0x12e1f9(0x218)],{'success':![],'error':_0x4a8922[_0x12e1f9(0x211)]},_0x33df5f[_0x12e1f9(0x21c)]);}else{if(_0x33df5f[_0x12e1f9(0x218)]===_0x12e1f9(0x24c))try{const {current_temps:_0x48b95c,t_out:_0x29fa8b,targets:_0x4fa7ba,t_forecast:_0x56205f}=_0x33df5f['message'],_0xded888=[];let _0x56c12f={};try{const _0x293d4e=await this[_0x12e1f9(0x223)](_0x12e1f9(0x253));if(_0x293d4e&&_0x293d4e[_0x12e1f9(0x228)]){const _0x13cff2=JSON[_0x12e1f9(0x28c)](_0x293d4e[_0x12e1f9(0x228)]);_0x56c12f=_0x13cff2[_0x12e1f9(0x298)]||_0x13cff2;}}catch(_0x2ae594){}const _0x11f024=_0x56205f!==undefined&&_0x56205f!==null?(_0x29fa8b+_0x56205f)/0x2:_0x29fa8b;for(const [_0x2e5eaf,_0x4e3fcb]of Object['entries'](_0x48b95c)){const _0x7cf09b=_0x4fa7ba[_0x2e5eaf]||0x15;if(_0x4e3fcb<=_0x7cf09b)continue;let _0x2431ae=_0x56c12f[_0x2e5eaf]||-0.5;if(_0x2431ae>=0x0)_0x2431ae=-0.5;const _0x221224=Math[_0x12e1f9(0x24b)](_0x2431ae),_0xe9ccbe=_0x4e3fcb-_0x7cf09b;let _0x4fbcac=Math[_0x12e1f9(0x2b4)](_0xe9ccbe/_0x221224*0x3c);const _0x6ed325=_0x4e3fcb-_0x29fa8b,_0x1b4484=_0x4e3fcb-_0x11f024;if(_0x1b4484!==0x0&&_0x6ed325!==0x0){const _0x812153=_0x6ed325/_0x1b4484;_0x4fbcac=Math[_0x12e1f9(0x2b4)](_0x4fbcac*_0x812153);}if(_0x4fbcac>0xf){if(_0x4fbcac>0xf0)_0x4fbcac=0xf0;_0xded888['push']({'room':_0x2e5eaf,'minutes_safe':_0x4fbcac,'target':_0x7cf09b,'current':_0x4e3fcb,'savings_msg':'Heizung\x20kann\x20'+_0x4fbcac+'\x20min\x20ausbleiben.'});}}_0xded888['sort']((_0xa4e1ae,_0x47550c)=>_0x47550c[_0x12e1f9(0x279)]-_0xa4e1ae[_0x12e1f9(0x279)]),this['sendTo'](_0x33df5f[_0x12e1f9(0x29c)],_0x33df5f['command'],{'success':!![],'proposals':_0xded888},_0x33df5f[_0x12e1f9(0x21c)]);}catch(_0x173bf3){this[_0x12e1f9(0x2bc)](_0x33df5f['from'],_0x33df5f[_0x12e1f9(0x218)],{'success':![],'error':_0x173bf3[_0x12e1f9(0x211)]},_0x33df5f[_0x12e1f9(0x21c)]);}else{if(_0x33df5f[_0x12e1f9(0x218)]===_0x12e1f9(0x2c2))await this[_0x12e1f9(0x245)]('analysis.automation.patternDetected',{'val':![],'ack':!![]}),await this[_0x12e1f9(0x245)](_0x12e1f9(0x239),{'val':'','ack':!![]}),await this['setStateAsync'](_0x12e1f9(0x27c),{'val':'','ack':!![]}),this[_0x12e1f9(0x2bc)](_0x33df5f['from'],_0x33df5f[_0x12e1f9(0x218)],{'success':!![]},_0x33df5f[_0x12e1f9(0x21c)]);else{if(_0x33df5f['command']===_0x12e1f9(0x2cc)){const {targetId:_0x5cf50c,targetValue:_0x5829f9}=_0x33df5f[_0x12e1f9(0x211)];await this[_0x12e1f9(0x245)](_0x12e1f9(0x244),{'val':!![],'ack':!![]}),await this[_0x12e1f9(0x245)](_0x12e1f9(0x239),{'val':_0x12e1f9(0x1f4),'ack':!![]}),await this[_0x12e1f9(0x245)](_0x12e1f9(0x27c),{'val':_0x5cf50c,'ack':!![]}),await this['setStateAsync']('analysis.automation.targetValue',{'val':String(_0x5829f9),'ack':!![]}),this[_0x12e1f9(0x2bc)](_0x33df5f['from'],_0x33df5f[_0x12e1f9(0x218)],{'success':!![]},_0x33df5f[_0x12e1f9(0x21c)]);}else{if(_0x33df5f[_0x12e1f9(0x218)]===_0x12e1f9(0x2c0))try{const _0x3c573a=_0x33df5f[_0x12e1f9(0x211)][_0x12e1f9(0x276)];if(!_0x3c573a)throw new Error('Kein\x20API\x20Key\x20Ã¼bergeben');const _0x369349=new GoogleGenerativeAI(_0x3c573a),_0x10a9d5=_0x369349[_0x12e1f9(0x2d1)]({'model':GEMINI_MODEL}),_0x4484f1=await _0x10a9d5[_0x12e1f9(0x22c)](_0x12e1f9(0x2c1)),_0x2e37ae=await _0x4484f1[_0x12e1f9(0x281)];if(_0x2e37ae[_0x12e1f9(0x26c)]())this[_0x12e1f9(0x2bc)](_0x33df5f[_0x12e1f9(0x29c)],_0x33df5f['command'],{'success':!![],'message':'Verbindung\x20erfolgreich!'},_0x33df5f[_0x12e1f9(0x21c)]);else throw new Error(_0x12e1f9(0x1f0));}catch(_0xc9edea){this[_0x12e1f9(0x2bc)](_0x33df5f[_0x12e1f9(0x29c)],_0x33df5f['command'],{'success':![],'message':_0xc9edea[_0x12e1f9(0x211)]},_0x33df5f[_0x12e1f9(0x21c)]);}else{if(_0x33df5f[_0x12e1f9(0x218)]==='scanDevices')try{const _0x3ca509=await scanner['scanForDevices'](this,_0x33df5f[_0x12e1f9(0x211)]||{});this[_0x12e1f9(0x2bc)](_0x33df5f['from'],_0x33df5f['command'],{'success':!![],'devices':_0x3ca509},_0x33df5f[_0x12e1f9(0x21c)]);}catch(_0x2410c2){this[_0x12e1f9(0x2bc)](_0x33df5f[_0x12e1f9(0x29c)],_0x33df5f[_0x12e1f9(0x218)],{'success':![],'error':_0x2410c2[_0x12e1f9(0x211)]},_0x33df5f[_0x12e1f9(0x21c)]);}else{if(_0x33df5f[_0x12e1f9(0x218)]===_0x12e1f9(0x28f))try{const {matrix:_0x3e67d2}=_0x33df5f[_0x12e1f9(0x211)],_0x58a383=await this[_0x12e1f9(0x223)](_0x12e1f9(0x1ec));if(_0x58a383&&_0x58a383[_0x12e1f9(0x228)]){const _0x5d3b41=JSON[_0x12e1f9(0x28c)](_0x58a383[_0x12e1f9(0x228)]);_0x5d3b41[_0x12e1f9(0x28a)]=_0x3e67d2,_0x5d3b41['updated']=Date[_0x12e1f9(0x2be)](),await this['setStateAsync'](_0x12e1f9(0x1ec),{'val':JSON[_0x12e1f9(0x2a8)](_0x5d3b41),'ack':!![]}),pythonBridge[_0x12e1f9(0x26a)](this,_0x12e1f9(0x2d3),_0x5d3b41);}this[_0x12e1f9(0x2bc)](_0x33df5f[_0x12e1f9(0x29c)],_0x33df5f['command'],{'success':!![]},_0x33df5f[_0x12e1f9(0x21c)]);}catch(_0x35873f){this[_0x12e1f9(0x25b)]['error'](_0x35873f);}else{if(_0x33df5f[_0x12e1f9(0x218)]==='getLtmData')this[_0x12e1f9(0x2bc)](_0x33df5f[_0x12e1f9(0x29c)],_0x33df5f[_0x12e1f9(0x218)],{'success':!![],'dailyDigests':this[_0x12e1f9(0x24e)]||[],'analysisHistory':this[_0x12e1f9(0x21e)]||[]},_0x33df5f['callback']);else{if(_0x33df5f['command']===_0x12e1f9(0x1e8)){const _0x17c057=this[_0x12e1f9(0x24e)][_0x12e1f9(0x201)],_0xbed97c=new Array(0x18)['fill'](0x0),_0x36e935=new Date()[_0x12e1f9(0x237)](0x0,0x0,0x0,0x0);this[_0x12e1f9(0x25d)]&&this[_0x12e1f9(0x25d)][_0x12e1f9(0x20e)](_0x389455=>{const _0xcc8598=_0x12e1f9;if(_0x389455['timestamp']>=_0x36e935){const _0x3f6a12=new Date(_0x389455[_0xcc8598(0x293)])[_0xcc8598(0x296)]();if(_0x3f6a12>=0x0&&_0x3f6a12<0x18)_0xbed97c[_0x3f6a12]++;}});let _0x526c45=![],_0x14945c='',_0x153982='',_0x337448='';try{const _0x10f3cf=await this['getStateAsync'](_0x12e1f9(0x244));if(_0x10f3cf&&_0x10f3cf[_0x12e1f9(0x228)]){_0x526c45=!![];const _0x5250fe=await this[_0x12e1f9(0x223)](_0x12e1f9(0x239));_0x14945c=_0x5250fe?_0x5250fe[_0x12e1f9(0x228)]:'';const _0x31b2b1=await this['getStateAsync'](_0x12e1f9(0x27c));_0x153982=_0x31b2b1?_0x31b2b1[_0x12e1f9(0x228)]:'';const _0x4b06d3=await this[_0x12e1f9(0x223)](_0x12e1f9(0x2bf));_0x337448=_0x4b06d3?_0x4b06d3['val']:'';}}catch(_0x56cc92){}this[_0x12e1f9(0x2bc)](_0x33df5f[_0x12e1f9(0x29c)],_0x33df5f[_0x12e1f9(0x218)],{'success':!![],'eventHistory':this[_0x12e1f9(0x25d)][_0x12e1f9(0x2ab)](0x0,0xf),'stats':{'digestCount':_0x17c057,'isPresent':this[_0x12e1f9(0x250)],'hourlyActivity':_0xbed97c},'automation':{'detected':_0x526c45,'description':_0x14945c,'targetId':_0x153982,'targetValue':_0x337448}},_0x33df5f[_0x12e1f9(0x21c)]);}else{if(_0x33df5f[_0x12e1f9(0x218)]===_0x12e1f9(0x215)){const _0x1945c8=await this['getForeignObjectsAsync']('enum.functions.*',_0x12e1f9(0x233)),_0x4d370a=[];if(_0x1945c8)for(const _0x968acf in _0x1945c8){const _0x51e1d6=_0x1945c8[_0x968acf],_0x44d595=(_0x51e1d6['common']&&typeof _0x51e1d6[_0x12e1f9(0x2c3)][_0x12e1f9(0x231)]===_0x12e1f9(0x2bd)?_0x51e1d6[_0x12e1f9(0x2c3)]['name']['de']:_0x51e1d6['common'][_0x12e1f9(0x231)])||_0x51e1d6[_0x12e1f9(0x2c3)]['name'];_0x4d370a[_0x12e1f9(0x29d)]({'id':_0x968acf,'name':_0x44d595});}const _0x57c30d=await this[_0x12e1f9(0x21f)](_0x12e1f9(0x255),'enum'),_0x201c1a=[];if(_0x57c30d)for(const _0x2084fb in _0x57c30d){const _0x36db0a=_0x57c30d[_0x2084fb],_0x52614c=(_0x36db0a[_0x12e1f9(0x2c3)]&&typeof _0x36db0a[_0x12e1f9(0x2c3)][_0x12e1f9(0x231)]===_0x12e1f9(0x2bd)?_0x36db0a[_0x12e1f9(0x2c3)][_0x12e1f9(0x231)]['de']:_0x36db0a[_0x12e1f9(0x2c3)][_0x12e1f9(0x231)])||_0x2084fb[_0x12e1f9(0x24d)]('.')['pop']();_0x201c1a[_0x12e1f9(0x29d)](_0x52614c);}this['sendTo'](_0x33df5f[_0x12e1f9(0x29c)],_0x33df5f[_0x12e1f9(0x218)],{'success':!![],'enums':_0x4d370a,'rooms':_0x201c1a},_0x33df5f[_0x12e1f9(0x21c)]);}else{if(_0x33df5f[_0x12e1f9(0x218)]===_0x12e1f9(0x207))try{let _0x30ee5d=_0x12e1f9(0x1ef),_0xe4912f=_0x12e1f9(0x2c7);if(this['config'][_0x12e1f9(0x1fe)]){const _0x44a124=await recorder[_0x12e1f9(0x263)](this);_0x30ee5d=_0x44a124!==null?_0x44a124+'Â°C':_0x12e1f9(0x25c);}if(this[_0x12e1f9(0x286)]['calendarInstance']){const _0x34e49e=await this['getForeignObjectAsync'](_0x12e1f9(0x238)+this[_0x12e1f9(0x286)][_0x12e1f9(0x28e)]);_0xe4912f=_0x34e49e?_0x12e1f9(0x28d):_0x12e1f9(0x1e9);}this['sendTo'](_0x33df5f[_0x12e1f9(0x29c)],_0x33df5f['command'],{'success':!![],'weather':_0x30ee5d,'calendar':_0xe4912f},_0x33df5f[_0x12e1f9(0x21c)]);}catch(_0x196d78){this[_0x12e1f9(0x2bc)](_0x33df5f[_0x12e1f9(0x29c)],_0x33df5f['command'],{'success':![],'error':_0x196d78[_0x12e1f9(0x211)]},_0x33df5f[_0x12e1f9(0x21c)]);}else{if(_0x33df5f['command']===_0x12e1f9(0x2ac))try{const _0x1e4368=_0x33df5f[_0x12e1f9(0x211)][_0x12e1f9(0x249)],_0x2373c7=await this[_0x12e1f9(0x22f)](_0x1e4368+_0x12e1f9(0x210));let _0x371b75=[];if(_0x2373c7&&_0x2373c7[_0x12e1f9(0x228)]){const _0x46dfe1=JSON['parse'](_0x2373c7[_0x12e1f9(0x228)]),_0x1e1e3d=new Set();Array['isArray'](_0x46dfe1)&&_0x46dfe1[_0x12e1f9(0x20e)](_0x2ca774=>{const _0x2088b6=_0x12e1f9;if(_0x2ca774[_0x2088b6(0x22a)])_0x1e1e3d[_0x2088b6(0x23e)](_0x2ca774[_0x2088b6(0x22a)]);else{if(_0x2ca774['calendarName'])_0x1e1e3d[_0x2088b6(0x23e)](_0x2ca774[_0x2088b6(0x1f7)]);}}),_0x371b75=Array['from'](_0x1e1e3d)[_0x12e1f9(0x288)]();}if(_0x371b75[_0x12e1f9(0x201)]===0x0)_0x371b75=['Standard'];this[_0x12e1f9(0x2bc)](_0x33df5f[_0x12e1f9(0x29c)],_0x33df5f[_0x12e1f9(0x218)],{'success':!![],'names':_0x371b75},_0x33df5f[_0x12e1f9(0x21c)]);}catch(_0x4f62f1){this['sendTo'](_0x33df5f[_0x12e1f9(0x29c)],_0x33df5f[_0x12e1f9(0x218)],{'success':![],'error':_0x4f62f1[_0x12e1f9(0x211)]},_0x33df5f['callback']);}else{if(_0x33df5f[_0x12e1f9(0x218)]===_0x12e1f9(0x261))try{await setup[_0x12e1f9(0x1e5)](this,_0x12e1f9(0x267),![],![]),this[_0x12e1f9(0x2bc)](_0x33df5f['from'],_0x33df5f['command'],{'success':!![],'message':_0x12e1f9(0x289)},_0x33df5f['callback']);}catch(_0x497ab8){this[_0x12e1f9(0x25b)][_0x12e1f9(0x20b)](_0x12e1f9(0x2bb)+_0x497ab8[_0x12e1f9(0x211)]),this[_0x12e1f9(0x2bc)](_0x33df5f[_0x12e1f9(0x29c)],_0x33df5f['command'],{'success':![],'message':_0x12e1f9(0x278)+_0x497ab8[_0x12e1f9(0x211)]},_0x33df5f[_0x12e1f9(0x21c)]);}}}}}}}}}}}}}}}async[a0_0x15e53b(0x225)](){const _0x135562=a0_0x15e53b;try{const _0x22cb9e=await this['getStateAsync'](setup['SYSTEM_DP_MODE']);_0x22cb9e&&_0x22cb9e['val']&&Object[_0x135562(0x272)](setup[_0x135562(0x287)])[_0x135562(0x1f9)](_0x22cb9e[_0x135562(0x228)])?this[_0x135562(0x291)]=_0x22cb9e[_0x135562(0x228)]:(this[_0x135562(0x291)]=setup['SYSTEM_MODES'][_0x135562(0x221)],await this[_0x135562(0x245)](setup[_0x135562(0x23f)],{'val':setup['SYSTEM_MODES'][_0x135562(0x221)],'ack':!![]}));}catch(_0x349c52){this[_0x135562(0x291)]=setup[_0x135562(0x287)][_0x135562(0x221)];}}async['checkWifiPresence'](){const _0x53e899=a0_0x15e53b;try{const _0x40ffff=this[_0x53e899(0x286)]['presenceDevices']||[];let _0x340990=![];const _0x508002=[];for(const _0x10c272 of _0x40ffff){try{const _0x1b5b5e=await this['getForeignStateAsync'](_0x10c272);_0x1b5b5e&&(_0x1b5b5e[_0x53e899(0x228)]===!![]||_0x1b5b5e['val']===_0x53e899(0x247)||_0x1b5b5e[_0x53e899(0x228)]===0x1)&&(_0x340990=!![],_0x508002[_0x53e899(0x29d)](_0x10c272));}catch(_0xdedcbe){}}return await this[_0x53e899(0x245)]('system.presenceWho',{'val':_0x508002[_0x53e899(0x26d)](',\x20'),'ack':!![]}),_0x340990&&(this['exitTimer']&&(this[_0x53e899(0x25b)]['info'](_0x53e899(0x270)),recorder[_0x53e899(0x268)](this)),!this[_0x53e899(0x250)]&&this[_0x53e899(0x291)]===setup[_0x53e899(0x287)][_0x53e899(0x221)]&&await recorder['setPresence'](this,!![])),_0x340990;}catch(_0x582d89){return![];}}async['runAutopilot'](){const _0x132207=a0_0x15e53b;this[_0x132207(0x25b)][_0x132207(0x25f)](_0x132207(0x275)),await aiAgent['runGeminiAnalysis'](this),this[_0x132207(0x262)](),this[_0x132207(0x2ae)](),this['triggerEnergyPrediction']();}['triggerGaitAnalysis'](){const _0x2640f1=a0_0x15e53b;if(!this[_0x2640f1(0x200)])return;try{this[_0x2640f1(0x224)]('LTM.trainingData.sequences',(_0x504fb0,_0x3aca27)=>{const _0x342761=_0x2640f1;_0x3aca27&&_0x3aca27[_0x342761(0x228)]&&pythonBridge[_0x342761(0x26a)](this,'ANALYZE_GAIT',{'sequences':JSON[_0x342761(0x28c)](_0x3aca27[_0x342761(0x228)])});});}catch(_0xc5c6de){}}async[a0_0x15e53b(0x2b3)](){const _0x2f01d7=a0_0x15e53b;if(!this[_0x2f01d7(0x200)])return;try{const _0xf331c5=await recorder[_0x2f01d7(0x263)](this);if(_0xf331c5===null)return;const _0x18bf94={},_0x1b4d86=this[_0x2f01d7(0x286)][_0x2f01d7(0x217)]||[];for(const _0x72d1d3 of _0x1b4d86){if(_0x72d1d3[_0x2f01d7(0x2cf)]==='temperature'&&_0x72d1d3[_0x2f01d7(0x1e6)]){const _0x8be8bc=this[_0x2f01d7(0x274)][_0x72d1d3['id']];if(_0x8be8bc!==undefined)_0x18bf94[_0x72d1d3[_0x2f01d7(0x1e6)]]=_0x8be8bc;}}Object['keys'](_0x18bf94)[_0x2f01d7(0x201)]>0x0&&(pythonBridge[_0x2f01d7(0x26a)](this,_0x2f01d7(0x2a0),{'current_temps':_0x18bf94,'t_out':_0xf331c5}),pythonBridge[_0x2f01d7(0x26a)](this,_0x2f01d7(0x25a),{'current_temps':_0x18bf94,'t_out':_0xf331c5,'targets':{}}));}catch(_0x2d469d){}}[a0_0x15e53b(0x262)](){const _0x577aeb=a0_0x15e53b;if(!this[_0x577aeb(0x1ea)]||this[_0x577aeb(0x1ea)][_0x577aeb(0x201)]===0x0)return;const _0x67721c=new Array(0x60)[_0x577aeb(0x209)](0x0),_0x122ce5=new Date()['setHours'](0x0,0x0,0x0,0x0);this[_0x577aeb(0x1ea)][_0x577aeb(0x20e)](_0x33fa7b=>{const _0x3b6ad6=_0x577aeb,_0x1dcb22=new Date(_0x33fa7b[_0x3b6ad6(0x293)]);if(_0x1dcb22[_0x3b6ad6(0x27b)]()>=_0x122ce5){const _0x1fbfa7=_0x1dcb22[_0x3b6ad6(0x296)](),_0x48bbaa=_0x1dcb22[_0x3b6ad6(0x273)](),_0x5970c4=_0x1fbfa7*0x4+Math[_0x3b6ad6(0x2b4)](_0x48bbaa/0xf);if(_0x5970c4>=0x0&&_0x5970c4<0x60)_0x67721c[_0x5970c4]++;}}),this['setStateAsync'](_0x577aeb(0x206),{'val':JSON[_0x577aeb(0x2a8)](_0x67721c),'ack':!![]});}['runPythonHealthCheck'](){const _0x14245b=a0_0x15e53b;if(!this['dailyDigests']||this['dailyDigests'][_0x14245b(0x201)]<0x2)return;const _0x133cb2=this[_0x14245b(0x24e)]['map'](_0x20fd06=>{const _0x4c8f87=_0x14245b,_0x5b8a46=(_0x20fd06[_0x4c8f87(0x29f)]||'')[_0x4c8f87(0x2b7)]();return ACTIVITY_LEVEL_MAP[_0x5b8a46]||0x32;});pythonBridge[_0x14245b(0x26a)](this,_0x14245b(0x2cd),{'values':_0x133cb2,'tag':_0x14245b(0x21b)});}}function a0_0x4932(){const _0x704f33=['add','SYSTEM_DP_MODE','LTM.trainingData.thermodynamics','find','cogni-living','./lib/python_bridge','analysis.automation.patternDetected','setStateAsync','632181ByyKmg','online','6096mXIURr','instance','startSystem','abs','simulateEnergyMPC','split','dailyDigests','./lib/scheduler','isPresent','./lib/automation','Gemini\x20Init\x20Error:\x20','analysis.energy.insulationScore','onMessage','enum.rooms.*','exitGraceTimer','motion','4534580XLULmh','TRAIN_SECURITY','OPTIMIZE_ENERGY','log','Daten\x20nicht\x20verfÃ¼gbar','eventHistory','checkLicense','debug','analysis.triggerBriefing','testNotification','updateHealthVector','getOutsideTemperatureNumeric','createDailyDigest','version','geminiApiKey','ðŸ””\x20Dies\x20ist\x20ein\x20Test\x20von\x20Cogni-Living.','abortExitTimer','unload','send','analysis.training.triggerSecurity','text','join','TRAIN_COMFORT','ack','WiFi\x20Presence\x20detected.','exitTimer','values','getMinutes','sensorLastValues','ðŸ¤–\x20Autopilot:\x20Running\x20periodic\x20analysis...','apiKey','notifyTelegramEnabled','Fehler:\x20','minutes_safe','onUnload','getTime','analysis.automation.targetId','geminiModel','namespace','runBaselineDriftAnalysis','@google/generative-ai','response','systemConfig','endsWith','apply','toString','config','SYSTEM_MODES','sort','Gesendet','matrix','processSensorEvent','parse','Verbunden','calendarInstance','updateTopologyMatrix','setupModeResetScheduler','currentSystemMode','LTM.baselineStatus','timestamp','modeResetJob','analysis.training.triggerTopology','getHours','presenceDevices','scores','isGracePeriodActive','2353568JePTPR','1453182aloOGn','from','push','./lib/installer','activityLevel','PREDICT_ENERGY','stateChange','cancel','models/gemini-flash-latest','./lib/setup','./lib/topology','createAllObjects','driftAnalysisTimer','stringify','LTM.trainingData.sequences','onStateChange','slice','getCalendarNames','5380TfKwvf','triggerGaitAnalysis','setState','./lib/dead_man','updateTopology','executeAutomationAction','triggerEnergyPrediction','floor','ltmJob','lastAlertState','toLowerCase','Sec-Training\x20started...','TRAIN_HEALTH','setPresence','Notification\x20Test\x20Failed:\x20','sendTo','object','now','analysis.automation.targetValue','testApiKey','Test','dismissAutomation','common','subscribeForeignStatesAsync','runPythonHealthCheck','1YvhfmN','Kein\x20Kalender-Adapter','updateLocation','\x20Tage)','briefingJob','analysis.trigger','simulateButler','ANALYZE_TREND','Gemini\x20AI\x20initialized.','type','LTM.triggerDailyDigest','getGenerativeModel','checkWifiPresence','SET_TOPOLOGY','genAI','sendNotification','location','initHistory','getOverviewData','Instanz\x20nicht\x20gefunden','rawEventLog','Aktiv\x20(','analysis.topology.structure','dependencyInstallInProgress','startService','Kein\x20Wetter-Adapter','Keine\x20Antwort\x20von\x20Gemini','search','analysis.training.triggerHealth','checkThermostats','Simulation\x20durch\x20Admin\x20(Test)','triggerDailyDigest','analysisTimer','calendarName','main','includes','2258816gFiGSh','LTM.rawEventLog','.communicate.request','.system.mode','weatherInstance','onReady','isProVersion','length','setupLtmScheduler','analysis.automation.triggerAction','63tLZWTx','@iobroker/adapter-core','analysis.health.todayVector','testContext','runGeminiAnalysis','fill','ready','error','setupBriefingScheduler','licenseKey','forEach','inactivityThresholdHours','.data.table','message','TRAIN_ENERGY','runAutopilot','minDaysForBaseline','getEnums','application/json','devices','command','system.mode','scanThermostats','Activity-Level','callback','sendMorningBriefing','analysisHistory','getForeignObjectsAsync','checkAndInstall','NORMAL','notifyTelegramInstance','getStateAsync','getState','loadSystemMode','automation.triggerAction','LTM.dailyDigests','val','bind','_calName','7078800LUzOtd','generateContent','Lernphase\x20(','telegram','getForeignStateAsync','subscribeStates','name','initZombies','enum',')\x20-\x20Phase\x20C\x20(Hardened)','info','setupDriftAnalysisScheduler','setHours','system.adapter.','analysis.automation.description','./lib/recorder','analysisInterval','./lib/scanner','analysis.training.triggerComfort'];a0_0x4932=function(){return _0x704f33;};return a0_0x4932();}if(require[a0_0x15e53b(0x1f8)]!==module)module['exports']=_0xb8ff02=>new CogniLiving(_0xb8ff02);else new CogniLiving();