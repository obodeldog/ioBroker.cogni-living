const a0_0x4ea597=a0_0x4859;(function(_0x288b38,_0x107afc){const _0x28ad5b=a0_0x4859,_0xbba1c2=_0x288b38();while(!![]){try{const _0x27baee=parseInt(_0x28ad5b(0x15b))/0x1*(-parseInt(_0x28ad5b(0x166))/0x2)+-parseInt(_0x28ad5b(0x1cb))/0x3*(-parseInt(_0x28ad5b(0x126))/0x4)+-parseInt(_0x28ad5b(0xda))/0x5*(-parseInt(_0x28ad5b(0xd7))/0x6)+-parseInt(_0x28ad5b(0xf5))/0x7*(-parseInt(_0x28ad5b(0x1f6))/0x8)+parseInt(_0x28ad5b(0x19c))/0x9*(-parseInt(_0x28ad5b(0x229))/0xa)+parseInt(_0x28ad5b(0x184))/0xb+-parseInt(_0x28ad5b(0x192))/0xc*(parseInt(_0x28ad5b(0x18d))/0xd);if(_0x27baee===_0x107afc)break;else _0xbba1c2['push'](_0xbba1c2['shift']());}catch(_0x3033c2){_0xbba1c2['push'](_0xbba1c2['shift']());}}}(a0_0x4af5,0xa709e));const a0_0xfbfb75=(function(){let _0x8cc6fc=!![];return function(_0x1bf87c,_0x5750e2){const _0x5a0a6c=_0x8cc6fc?function(){if(_0x5750e2){const _0x21ca33=_0x5750e2['apply'](_0x1bf87c,arguments);return _0x5750e2=null,_0x21ca33;}}:function(){};return _0x8cc6fc=![],_0x5a0a6c;};}()),a0_0x438e77=a0_0xfbfb75(this,function(){const _0x4d95b9=a0_0x4859;return a0_0x438e77[_0x4d95b9(0x1de)]()['search'](_0x4d95b9(0x18e))[_0x4d95b9(0x1de)]()['constructor'](a0_0x438e77)[_0x4d95b9(0x258)](_0x4d95b9(0x18e));});a0_0x438e77();'use strict';const utils=require('@iobroker/adapter-core'),{GoogleGenerativeAI}=require(a0_0x4ea597(0x1dd)),schedule=require('node-schedule'),{spawn,exec,execSync}=require(a0_0x4ea597(0x142)),path=require('path'),fs=require('fs'),HISTORY_MAX_SIZE=0x32,RAW_LOG_MAX_SIZE=0x9c4,LTM_MIN_EVENTS_FOR_COMPRESSION=0x5,GEMINI_MODEL=a0_0x4ea597(0x260),LTM_SCHEDULE=a0_0x4ea597(0x1ac),MODE_RESET_SCHEDULE=a0_0x4ea597(0x25f),SEQUENCE_TIMEOUT_MS=0x5*0x3c*0x3e8,MAX_TRAINING_SET_SIZE=0x1f4,THERMO_LOG_SIZE=0x3e8,EXIT_TIMER_MINUTES=0xf,EXIT_GRACE_PERIOD_SECONDS=0x1e,LTM_DP_RAW_LOG=a0_0x4ea597(0x128),LTM_DP_DAILY_DIGESTS='LTM.dailyDigests',LTM_DP_STATUS=a0_0x4ea597(0x19a),LTM_DP_TRIGGER_DIGEST=a0_0x4ea597(0x204),LTM_DP_BASELINE_STATUS=a0_0x4ea597(0xb9),LTM_DP_DRIFT_CHANNEL=a0_0x4ea597(0x20b),LTM_DP_DRIFT_STATUS='LTM.driftAnalysis.baselineDrift',LTM_DP_DRIFT_DETAILS='LTM.driftAnalysis.driftDetails',LTM_DP_DRIFT_LAST_CHECK=a0_0x4ea597(0xf8),SYSTEM_DP_MODE=a0_0x4ea597(0x12a),SYSTEM_MODES={'NORMAL':a0_0x4ea597(0x1e2),'VACATION':a0_0x4ea597(0xc5),'PARTY':a0_0x4ea597(0x261),'GUEST':a0_0x4ea597(0x158)},AUTO_RESET_MODES=[SYSTEM_MODES[a0_0x4ea597(0x138)],SYSTEM_MODES['GUEST']],PERSONA_MAPPING={'generic':'Analysiere\x20ausgewogen.','senior_aal':a0_0x4ea597(0x1f3),'family':a0_0x4ea597(0x24a),'single_comfort':a0_0x4ea597(0x1a6),'security':'PRIORIT√ÑT:\x20Sicherheit.'},ACTIVITY_LEVEL_MAP={'sehr\x20hoch':0x64,'hoch':0x50,'normal':0x3c,'niedrig':0x28,'sehr\x20niedrig':0x14,'inaktiv':0x0},IS_WIN=process[a0_0x4ea597(0xba)]===a0_0x4ea597(0x225),PERSISTENT_DIR=path[a0_0x4ea597(0x16a)](__dirname,a0_0x4ea597(0x20e)),VENV_PATH=PERSISTENT_DIR,PYTHON_EXE=IS_WIN?path[a0_0x4ea597(0x16a)](VENV_PATH,'Scripts','python.exe'):path[a0_0x4ea597(0x16a)](VENV_PATH,a0_0x4ea597(0xdb),a0_0x4ea597(0x115)),PIP_EXE=IS_WIN?path[a0_0x4ea597(0x16a)](VENV_PATH,a0_0x4ea597(0x218),a0_0x4ea597(0x228)):path[a0_0x4ea597(0x16a)](VENV_PATH,a0_0x4ea597(0xdb),a0_0x4ea597(0x262));let activeSequence=[],sequenceTimer=null;async function startSystem(_0x28b190){const _0x52ef26=a0_0x4ea597;_0x28b190[_0x52ef26(0x10b)][_0x52ef26(0x180)](_0x52ef26(0x1e9)),await initZombies(_0x28b190);try{_0x28b190[_0x52ef26(0x1f7)]=await checkLicense(_0x28b190[_0x52ef26(0x209)][_0x52ef26(0x1f8)]);}catch(_0x44ae1a){}if(!_0x28b190[_0x52ef26(0x209)][_0x52ef26(0x19f)]||_0x28b190['config']['inactivityThresholdHours']<0.1)_0x28b190[_0x52ef26(0x209)][_0x52ef26(0x19f)]=0xc;await initHistory(_0x28b190),await initSystemConfig(_0x28b190);if(_0x28b190[_0x52ef26(0x209)][_0x52ef26(0x263)])try{_0x28b190[_0x52ef26(0x24d)]=new GoogleGenerativeAI(_0x28b190[_0x52ef26(0x209)][_0x52ef26(0x263)]),_0x28b190['geminiModel']=_0x28b190['genAI'][_0x52ef26(0x1aa)]({'model':GEMINI_MODEL,'generationConfig':{'responseMimeType':'application/json'}}),_0x28b190[_0x52ef26(0x10b)]['info'](_0x52ef26(0x1f9));}catch(_0x2a41d4){_0x28b190[_0x52ef26(0x10b)][_0x52ef26(0x11b)](_0x52ef26(0x1c1)+_0x2a41d4['message']);}await createAllObjects(_0x28b190),await loadSystemMode(_0x28b190),await loadRawEventLog(_0x28b190),await loadDailyDigests(_0x28b190),_0x28b190[_0x52ef26(0x1c7)](_0x52ef26(0x12d)),_0x28b190['subscribeStates'](LTM_DP_TRIGGER_DIGEST),_0x28b190[_0x52ef26(0x1c7)]('system.mode'),_0x28b190['subscribeStates'](_0x52ef26(0xf4)),_0x28b190[_0x52ef26(0x1c7)](_0x52ef26(0x18b)),_0x28b190[_0x52ef26(0x1c7)]('analysis.automation.autoApply'),_0x28b190[_0x52ef26(0x1c7)](_0x52ef26(0x243)),_0x28b190[_0x52ef26(0x1c7)](_0x52ef26(0x108)),_0x28b190[_0x52ef26(0x1c7)](_0x52ef26(0xec)),_0x28b190[_0x52ef26(0x1c7)](_0x52ef26(0x19e)),_0x28b190[_0x52ef26(0x1c7)](_0x52ef26(0x140)),await initSensorSubscriptions(_0x28b190),await initPresenceSubscriptions(_0x28b190),await setupTelegramListener(_0x28b190),setTimeout(()=>checkWifiPresence(_0x28b190),0x1388);if(_0x28b190['analysisTimer'])clearInterval(_0x28b190[_0x52ef26(0x1ff)]);const _0x1b580c=_0x28b190[_0x52ef26(0x209)][_0x52ef26(0xaf)]||0xf;_0x1b580c>0x0&&(_0x28b190['analysisTimer']=setInterval(()=>{runAutopilot(_0x28b190);},_0x1b580c*0x3c*0x3e8)),setupLtmScheduler(_0x28b190),setupModeResetScheduler(_0x28b190),setupDriftAnalysisScheduler(_0x28b190),setupBriefingScheduler(_0x28b190),startPythonService(_0x28b190),setTimeout(()=>{const _0x5e87ab=_0x52ef26;_0x28b190[_0x5e87ab(0xb1)]&&(runPythonHealthCheck(_0x28b190),triggerGaitAnalysis(_0x28b190),triggerEnergyPrediction(_0x28b190)),updateHealthVector(_0x28b190);},0x1388);}async function runAutopilot(_0x49570e){const _0x31b4e2=a0_0x4ea597;_0x49570e['log'][_0x31b4e2(0x1f1)](_0x31b4e2(0x24f)),await runGeminiAnalysis(_0x49570e),updateHealthVector(_0x49570e),triggerGaitAnalysis(_0x49570e),triggerEnergyPrediction(_0x49570e);}async function triggerGaitAnalysis(_0x13fca0){const _0x2471ac=a0_0x4ea597;if(!_0x13fca0['isProVersion'])return;try{const _0x344efc=await _0x13fca0['getStateAsync'](_0x2471ac(0x146));_0x344efc&&_0x344efc[_0x2471ac(0xd4)]&&sendToPython(_0x13fca0,_0x2471ac(0x156),{'sequences':JSON[_0x2471ac(0xb4)](_0x344efc['val'])});}catch(_0x4b5958){}}function a0_0x4859(_0xd57a67,_0x8402b1){const _0x534ed7=a0_0x4af5();return a0_0x4859=function(_0x438e77,_0xfbfb75){_0x438e77=_0x438e77-0x9f;let _0x4af52d=_0x534ed7[_0x438e77];return _0x4af52d;},a0_0x4859(_0xd57a67,_0x8402b1);}async function triggerEnergyPrediction(_0x5d9ee4){const _0x259ce0=a0_0x4ea597;if(!_0x5d9ee4[_0x259ce0(0x1f7)])return;try{const _0x52a381=await getOutsideTemperatureNumeric(_0x5d9ee4);if(_0x52a381===null)return;const _0x52563a={},_0x2873f6=_0x5d9ee4[_0x259ce0(0x209)]['devices']||[];for(const _0x3bb35a of _0x2873f6){if(_0x3bb35a[_0x259ce0(0x1d4)]===_0x259ce0(0x18f)&&_0x3bb35a[_0x259ce0(0x1ae)]){const _0x54c683=_0x5d9ee4['sensorLastValues'][_0x3bb35a['id']];if(_0x54c683!==undefined)_0x52563a[_0x3bb35a[_0x259ce0(0x1ae)]]=_0x54c683;}}Object['keys'](_0x52563a)[_0x259ce0(0x1d6)]>0x0&&sendToPython(_0x5d9ee4,'PREDICT_ENERGY',{'current_temps':_0x52563a,'t_out':_0x52a381});}catch(_0x353770){}}function updateHealthVector(_0x29c5fc){const _0x22eb82=a0_0x4ea597;if(!_0x29c5fc[_0x22eb82(0x150)]||_0x29c5fc[_0x22eb82(0x150)]['length']===0x0)return;const _0x399a37=new Array(0x60)[_0x22eb82(0x235)](0x0),_0x15c6e9=new Date()['setHours'](0x0,0x0,0x0,0x0);_0x29c5fc['rawEventLog'][_0x22eb82(0x246)](_0x4e5541=>{const _0x31138b=_0x22eb82,_0x3eadab=new Date(_0x4e5541[_0x31138b(0x1ec)]);if(_0x3eadab[_0x31138b(0x20d)]()>=_0x15c6e9){const _0x30d374=_0x3eadab[_0x31138b(0x216)](),_0x32357d=_0x3eadab['getMinutes'](),_0x4d8fd5=_0x30d374*0x4+Math[_0x31138b(0x111)](_0x32357d/0xf);if(_0x4d8fd5>=0x0&&_0x4d8fd5<0x60)_0x399a37[_0x4d8fd5]++;}}),_0x29c5fc['setStateAsync'](_0x22eb82(0x14e),{'val':JSON[_0x22eb82(0x1f4)](_0x399a37),'ack':!![]});}async function scanForDevices(_0x96f5cc,_0x4f6e58){const _0x54fd92=a0_0x4ea597;_0x96f5cc[_0x54fd92(0x10b)][_0x54fd92(0x180)](_0x54fd92(0xa0));const _0x105763=[],_0x112307=await _0x96f5cc['getForeignObjectsAsync']('*');for(const _0x319e7c in _0x112307){const _0x56abc7=_0x112307[_0x319e7c];if(_0x56abc7&&_0x56abc7[_0x54fd92(0xfb)]&&_0x56abc7['type']===_0x54fd92(0xf2)){const _0x169a59=(_0x56abc7[_0x54fd92(0xfb)][_0x54fd92(0x241)]&&typeof _0x56abc7[_0x54fd92(0xfb)][_0x54fd92(0x241)]===_0x54fd92(0x145)?_0x56abc7['common'][_0x54fd92(0x241)]['de']:_0x56abc7[_0x54fd92(0xfb)]['name'])||'',_0x16bf0e=_0x56abc7['common'][_0x54fd92(0x157)]||'';let _0x18dbc3=null;if(_0x4f6e58[_0x54fd92(0x17c)]&&(_0x16bf0e[_0x54fd92(0x215)](_0x54fd92(0x17c))||_0x169a59[_0x54fd92(0x169)]()[_0x54fd92(0x215)](_0x54fd92(0x114))))_0x18dbc3=_0x54fd92(0x17c);else{if(_0x4f6e58[_0x54fd92(0x1d8)]&&(_0x16bf0e[_0x54fd92(0x215)](_0x54fd92(0x250))||_0x16bf0e[_0x54fd92(0x215)]('window')||_0x169a59['toLowerCase']()[_0x54fd92(0x215)](_0x54fd92(0x213))||_0x169a59['toLowerCase']()[_0x54fd92(0x215)](_0x54fd92(0xb3))))_0x18dbc3=_0x54fd92(0x250);else{if(_0x4f6e58[_0x54fd92(0x21c)]&&(_0x16bf0e[_0x54fd92(0x215)]('light')||_0x16bf0e[_0x54fd92(0x215)]('switch')||_0x169a59[_0x54fd92(0x169)]()[_0x54fd92(0x215)](_0x54fd92(0x1a3))))_0x18dbc3=_0x54fd92(0x1f2);else{if(_0x4f6e58[_0x54fd92(0x18f)]&&(_0x16bf0e[_0x54fd92(0x215)](_0x54fd92(0x18f))||_0x169a59['toLowerCase']()[_0x54fd92(0x215)](_0x54fd92(0xd2))))_0x18dbc3=_0x54fd92(0x18f);}}}if(_0x18dbc3){let _0x13f96d='';const _0x4f5baa=_0x319e7c[_0x54fd92(0x9f)]('.');if(_0x4f5baa['length']>0x2)_0x13f96d=_0x4f5baa[0x2];_0x105763[_0x54fd92(0x1c5)]({'id':_0x319e7c,'name':_0x169a59||_0x319e7c,'type':_0x18dbc3,'location':_0x13f96d,'_score':0x32});}}}return _0x105763;}async function getWeatherContext(_0x194010){const _0x447962=a0_0x4ea597;if(!_0x194010[_0x447962(0x209)]['useWeather']||!_0x194010['config'][_0x447962(0x197)])return _0x447962(0x17e);try{const _0x3f3b46=_0x194010['config'][_0x447962(0x197)];let _0xdba10b=await _0x194010[_0x447962(0xb8)](_0x3f3b46+_0x447962(0xf3));if(!_0xdba10b)_0xdba10b=await _0x194010[_0x447962(0xb8)](_0x3f3b46+_0x447962(0xf1));let _0x43b0e1=await _0x194010[_0x447962(0xb8)](_0x3f3b46+_0x447962(0x23c));if(!_0x43b0e1)_0x43b0e1=await _0x194010['getForeignStateAsync'](_0x3f3b46+_0x447962(0x148));if(_0xdba10b&&_0x43b0e1)return _0xdba10b['val']+_0x447962(0x22a)+_0x43b0e1[_0x447962(0xd4)];}catch(_0x3d316d){}return'Keine\x20Wetterdaten\x20verf√ºgbar.';}async function getCalendarContext(_0x33c543){const _0x453d1b=a0_0x4ea597;if(!_0x33c543['config'][_0x453d1b(0x102)]||!_0x33c543[_0x453d1b(0x209)]['calendarInstance'])return'Kalender\x20deaktiviert.';return _0x453d1b(0xce);}async function getCalendarNames(_0x4038a9,_0x5d03b4){return[];}async function saveFeedback(_0x2cf5d3,_0x586571){const _0x57dac6=a0_0x4ea597;_0x2cf5d3['log'][_0x57dac6(0x180)](_0x57dac6(0x23f)+_0x586571[_0x57dac6(0x207)]);}async function sendMorningBriefing(_0x50dec3){const _0x27bdfe=a0_0x4ea597;if(!_0x50dec3[_0x27bdfe(0x141)])return;try{const _0x37a46f=_0x27bdfe(0x14f),_0xe316fe=await _0x50dec3[_0x27bdfe(0x141)][_0x27bdfe(0xd0)](_0x37a46f),_0x43e660=_0xe316fe[_0x27bdfe(0x10e)]['text']();sendNotification(_0x50dec3,_0x27bdfe(0x153)+_0x43e660);}catch(_0x51377c){_0x50dec3[_0x27bdfe(0x10b)]['error'](_0x27bdfe(0x132)+_0x51377c[_0x27bdfe(0x178)]);}}function checkAndInstall(_0x58ff68){const _0x4ff4cf=a0_0x4ea597;if(fs[_0x4ff4cf(0x125)](PYTHON_EXE))try{return _0x58ff68[_0x4ff4cf(0x10b)][_0x4ff4cf(0x180)]('üêç\x20Checking\x20Python\x20environment...'),execSync('\x22'+PYTHON_EXE+_0x4ff4cf(0x191),{'timeout':0x3a98}),_0x58ff68['log'][_0x4ff4cf(0x180)](_0x4ff4cf(0x1cd)),!![];}catch(_0xc41112){_0x58ff68[_0x4ff4cf(0x10b)]['warn']('‚ö†Ô∏è\x20Fast-Boot\x20failed\x20(Libs\x20broken\x20or\x20missing).\x20Starting\x20repair/install...');}else _0x58ff68[_0x4ff4cf(0x10b)][_0x4ff4cf(0x1d9)](_0x4ff4cf(0x1af));return installPythonDependencies(_0x58ff68),![];}function installPythonDependencies(_0x458acf){const _0x45130c=a0_0x4ea597;if(_0x458acf['dependencyInstallInProgress'])return;_0x458acf['dependencyInstallInProgress']=!![];const _0x32c311=path['join'](__dirname,'python_service',_0x45130c(0x267));stopPythonService(_0x458acf);if(!fs['existsSync'](VENV_PATH))try{_0x458acf[_0x45130c(0x10b)]['info'](_0x45130c(0x1ad)),execSync(_0x45130c(0xdc)+VENV_PATH+'\x22');}catch(_0x50c5e4){_0x458acf[_0x45130c(0x10b)][_0x45130c(0x11b)](_0x45130c(0x1f5)+_0x50c5e4[_0x45130c(0x178)]),_0x458acf[_0x45130c(0xd8)]=![];return;}installRequirementsInVenv(_0x458acf,_0x32c311);}function installRequirementsInVenv(_0x2bcb32,_0x18c4ca){const _0x3d3feb=a0_0x4ea597;_0x2bcb32[_0x3d3feb(0x10b)]['info'](_0x3d3feb(0x200));const _0x5fc70='\x22'+PIP_EXE+_0x3d3feb(0x10d)+_0x18c4ca+'\x22';exec(_0x5fc70,{'timeout':0x1b7740},(_0x475e65,_0x218bf3,_0x91dd54)=>{const _0x34f355=_0x3d3feb;_0x2bcb32[_0x34f355(0xd8)]=![];if(_0x475e65){_0x2bcb32['log'][_0x34f355(0x11b)](_0x34f355(0x206)+(_0x91dd54||_0x475e65[_0x34f355(0x178)]));try{fs['rmSync'](VENV_PATH,{'recursive':!![],'force':!![]});}catch(_0xd66348){}}else _0x2bcb32[_0x34f355(0x10b)][_0x34f355(0x180)](_0x34f355(0xe6)),startSystem(_0x2bcb32);});}async function initZombies(_0x18d442){const _0x100f42=a0_0x4ea597;try{const _0x30968c=[_0x100f42(0x1cc),_0x100f42(0x183)];for(const _0x22e3cb of _0x30968c){try{const _0x5cbbcb=await _0x18d442[_0x100f42(0xeb)](_0x22e3cb);if(_0x5cbbcb)await _0x18d442['delObjectAsync'](_0x22e3cb);}catch(_0x201606){}}}catch(_0x2db2a4){}}async function checkLicense(_0x3b3f2d){return!![];}async function initHistory(_0x25b99d){const _0x207e08=a0_0x4ea597;try{const _0x163d76=await _0x25b99d[_0x207e08(0x244)](_0x207e08(0x237));_0x163d76&&_0x163d76[_0x207e08(0xd4)]&&(_0x25b99d[_0x207e08(0x1a5)]=JSON[_0x207e08(0xb4)](_0x163d76[_0x207e08(0xd4)][_0x207e08(0x1de)]()));}catch(_0x331a53){_0x25b99d[_0x207e08(0x1a5)]=[];}try{const _0x70e96c=await _0x25b99d['getStateAsync'](_0x207e08(0xd5));if(_0x70e96c&&_0x70e96c['val'])_0x25b99d[_0x207e08(0x1b2)]=JSON['parse'](_0x70e96c[_0x207e08(0xd4)][_0x207e08(0x1de)]());}catch(_0x3a3428){_0x25b99d[_0x207e08(0x1b2)]=[];}if(_0x25b99d[_0x207e08(0x1a5)]&&_0x25b99d[_0x207e08(0x1a5)][_0x207e08(0x1d6)]>0x0){_0x25b99d[_0x207e08(0x10b)]['info'](_0x207e08(0x1c9));for(let _0x4264d2=_0x25b99d['eventHistory']['length']-0x1;_0x4264d2>=0x0;_0x4264d2--){const _0x5d3040=_0x25b99d[_0x207e08(0x1a5)][_0x4264d2];if(_0x5d3040&&_0x5d3040['id']!==undefined&&_0x5d3040[_0x207e08(0x1bb)]!==undefined)_0x25b99d[_0x207e08(0x1ca)][_0x5d3040['id']]=_0x5d3040[_0x207e08(0x1bb)];}}}async function initSystemConfig(_0x2181c9){const _0x364088=a0_0x4ea597;try{const _0x40a83c=await _0x2181c9[_0x364088(0x135)](_0x364088(0x134));if(_0x40a83c&&_0x40a83c[_0x364088(0xfb)])_0x2181c9[_0x364088(0x1d3)]={'latitude':_0x40a83c['common'][_0x364088(0x13d)]||0x0,'longitude':_0x40a83c['common'][_0x364088(0x1fd)]||0x0,'city':_0x40a83c['common'][_0x364088(0xe8)]||''};}catch(_0x4737ca){}}async function createAllObjects(_0x282748){const _0x348b7d=a0_0x4ea597;await _0x282748['extendObjectAsync'](_0x348b7d(0x236),{'type':_0x348b7d(0xc6),'common':{'name':'System'},'native':{}}),await _0x282748[_0x348b7d(0x1d5)](SYSTEM_DP_MODE,{'type':_0x348b7d(0xf2),'common':{'name':_0x348b7d(0x269),'type':_0x348b7d(0xbf),'role':'state','read':!![],'write':!![],'def':SYSTEM_MODES['NORMAL']},'native':{}}),await _0x282748['setObjectNotExistsAsync'](_0x348b7d(0x16d),{'type':_0x348b7d(0xf2),'common':{'name':_0x348b7d(0x15d),'type':_0x348b7d(0xbf),'role':_0x348b7d(0x1f0),'read':!![],'write':![]},'native':{}}),await _0x282748[_0x348b7d(0x161)]('events.lastEvent',{'type':_0x348b7d(0xf2),'common':{'name':_0x348b7d(0x1ed),'type':_0x348b7d(0xbf),'role':_0x348b7d(0x1e7),'read':!![],'write':![]},'native':{}}),await _0x282748['setObjectNotExistsAsync'](_0x348b7d(0x237),{'type':_0x348b7d(0xf2),'common':{'name':'Event\x20History','type':_0x348b7d(0xbf),'role':_0x348b7d(0x1e7),'read':!![],'write':![]},'native':{}}),await _0x282748[_0x348b7d(0x1d5)]('analysis.training',{'type':'channel','common':{'name':_0x348b7d(0xa1)},'native':{}}),await _0x282748[_0x348b7d(0x161)]('analysis.training.triggerSecurity',{'type':_0x348b7d(0xf2),'common':{'name':_0x348b7d(0xac),'type':_0x348b7d(0x124),'role':'button','read':!![],'write':!![]},'native':{}}),await _0x282748[_0x348b7d(0x161)](_0x348b7d(0x108),{'type':'state','common':{'name':_0x348b7d(0xa4),'type':_0x348b7d(0x124),'role':'button','read':!![],'write':!![]},'native':{}}),await _0x282748[_0x348b7d(0x161)](_0x348b7d(0xec),{'type':_0x348b7d(0xf2),'common':{'name':'Train\x20Energy','type':'boolean','role':_0x348b7d(0x16b),'read':!![],'write':!![]},'native':{}}),await _0x282748['setObjectNotExistsAsync'](_0x348b7d(0x19e),{'type':_0x348b7d(0xf2),'common':{'name':'Train\x20Comfort','type':_0x348b7d(0x124),'role':_0x348b7d(0x16b),'read':!![],'write':!![]},'native':{}}),await _0x282748[_0x348b7d(0x161)](_0x348b7d(0x140),{'type':_0x348b7d(0xf2),'common':{'name':_0x348b7d(0x18a),'type':_0x348b7d(0x124),'role':_0x348b7d(0x16b),'read':!![],'write':!![]},'native':{}}),await _0x282748[_0x348b7d(0x161)](_0x348b7d(0x121),{'type':_0x348b7d(0xf2),'common':{'name':'Training\x20Status','type':_0x348b7d(0xbf),'role':_0x348b7d(0x1f0),'read':!![],'write':![]},'native':{}}),await _0x282748['extendObjectAsync'](_0x348b7d(0xcb),{'type':_0x348b7d(0xc6),'common':{'name':'Security\x20Monitor'},'native':{}}),await _0x282748[_0x348b7d(0x161)](_0x348b7d(0x194),{'type':_0x348b7d(0xf2),'common':{'name':'Anomaly\x20Score','type':_0x348b7d(0x227),'role':_0x348b7d(0x1bb),'read':!![],'write':![]},'native':{}}),await _0x282748[_0x348b7d(0x161)](_0x348b7d(0xd3),{'type':_0x348b7d(0xf2),'common':{'name':_0x348b7d(0x103),'type':_0x348b7d(0x227),'role':_0x348b7d(0x1bb),'read':!![],'write':![],'def':0.05},'native':{}}),await _0x282748[_0x348b7d(0x161)](_0x348b7d(0xfc),{'type':_0x348b7d(0xf2),'common':{'name':_0x348b7d(0xe0),'type':'string','role':_0x348b7d(0x20f),'read':!![],'write':![]},'native':{}}),await _0x282748[_0x348b7d(0x161)](_0x348b7d(0xde),{'type':_0x348b7d(0xf2),'common':{'name':_0x348b7d(0x186),'type':_0x348b7d(0xbf),'role':_0x348b7d(0x1e7),'read':!![],'write':![]},'native':{}}),await _0x282748[_0x348b7d(0x1d5)]('analysis.health',{'type':_0x348b7d(0xc6),'common':{'name':'Health\x20Analysis'},'native':{}}),await _0x282748['setObjectNotExistsAsync'](_0x348b7d(0x1e5),{'type':'state','common':{'name':_0x348b7d(0xe0),'type':_0x348b7d(0xbf),'role':_0x348b7d(0x20f),'read':!![],'write':![]},'native':{}}),await _0x282748[_0x348b7d(0x161)](_0x348b7d(0xed),{'type':'state','common':{'name':_0x348b7d(0x181),'type':_0x348b7d(0x124),'role':_0x348b7d(0x201),'read':!![],'write':![]},'native':{}}),await _0x282748[_0x348b7d(0x161)](_0x348b7d(0x230),{'type':_0x348b7d(0xf2),'common':{'name':_0x348b7d(0x1b6),'type':_0x348b7d(0xbf),'role':'text','read':!![],'write':![]},'native':{}}),await _0x282748[_0x348b7d(0x161)](_0x348b7d(0x19d),{'type':_0x348b7d(0xf2),'common':{'name':'Trend\x20Value','type':_0x348b7d(0x227),'role':_0x348b7d(0x1bb),'read':!![],'write':![]},'native':{}}),await _0x282748[_0x348b7d(0x161)](_0x348b7d(0x14e),{'type':_0x348b7d(0xf2),'common':{'name':_0x348b7d(0x219),'type':'string','role':'json','read':!![],'write':![]},'native':{}}),await _0x282748[_0x348b7d(0x161)](_0x348b7d(0x127),{'type':_0x348b7d(0xf2),'common':{'name':_0x348b7d(0x247),'type':_0x348b7d(0x227),'role':'value','read':!![],'write':![]},'native':{}}),await _0x282748[_0x348b7d(0x1d5)](_0x348b7d(0x221),{'type':_0x348b7d(0xc6),'common':{'name':_0x348b7d(0x14d)},'native':{}}),await _0x282748[_0x348b7d(0x161)](_0x348b7d(0x208),{'type':_0x348b7d(0xf2),'common':{'name':_0x348b7d(0x255),'type':_0x348b7d(0xbf),'role':'text','read':!![],'write':![]},'native':{}}),await _0x282748[_0x348b7d(0x161)](_0x348b7d(0x18c),{'type':_0x348b7d(0xf2),'common':{'name':_0x348b7d(0x1d0),'type':'string','role':_0x348b7d(0x1f0),'read':!![],'write':![]},'native':{}}),await _0x282748['setObjectNotExistsAsync'](_0x348b7d(0x149),{'type':'state','common':{'name':'Temperature\x20Forecast','type':'string','role':_0x348b7d(0x1e7),'read':!![],'write':![]},'native':{}}),await _0x282748[_0x348b7d(0x1d5)](_0x348b7d(0x177),{'type':'channel','common':{'name':_0x348b7d(0x177)},'native':{}}),await _0x282748['extendObjectAsync'](LTM_DP_RAW_LOG,{'type':_0x348b7d(0xf2),'common':{'name':_0x348b7d(0x12c),'type':_0x348b7d(0xbf),'role':_0x348b7d(0x1e7),'read':!![],'write':![]},'native':{}}),await _0x282748[_0x348b7d(0x1d5)](LTM_DP_DAILY_DIGESTS,{'type':'state','common':{'name':_0x348b7d(0x160),'type':_0x348b7d(0xbf),'role':_0x348b7d(0x1e7),'read':!![],'write':![]},'native':{}}),await _0x282748[_0x348b7d(0x161)](_0x348b7d(0x146),{'type':'state','common':{'name':_0x348b7d(0x224),'type':_0x348b7d(0xbf),'role':_0x348b7d(0x1e7),'read':!![],'write':![]},'native':{}}),await _0x282748[_0x348b7d(0x161)](_0x348b7d(0x210),{'type':_0x348b7d(0xf2),'common':{'name':_0x348b7d(0x1c0),'type':_0x348b7d(0xbf),'role':_0x348b7d(0x1e7),'read':!![],'write':![]},'native':{}}),await _0x282748[_0x348b7d(0x161)]('analysis.trigger',{'type':'state','common':{'name':_0x348b7d(0x212),'type':_0x348b7d(0x124),'role':_0x348b7d(0x16b),'read':!![],'write':!![]},'native':{}}),await _0x282748[_0x348b7d(0x161)]('analysis.triggerBriefing',{'type':_0x348b7d(0xf2),'common':{'name':_0x348b7d(0x249),'type':'boolean','role':_0x348b7d(0x16b),'read':!![],'write':!![]},'native':{}}),await _0x282748[_0x348b7d(0x161)]('analysis.isAlert',{'type':'state','common':{'name':_0x348b7d(0x21e),'type':'boolean','role':'indicator.alarm','read':!![],'write':![]},'native':{}}),await _0x282748[_0x348b7d(0x161)]('analysis.alertReason',{'type':_0x348b7d(0xf2),'common':{'name':_0x348b7d(0x118),'type':_0x348b7d(0xbf),'role':_0x348b7d(0xa6),'read':!![],'write':![]},'native':{}}),await _0x282748[_0x348b7d(0x161)](_0x348b7d(0x17a),{'type':_0x348b7d(0xf2),'common':{'name':_0x348b7d(0xa7),'type':_0x348b7d(0xbf),'role':_0x348b7d(0x1f0),'read':!![],'write':![]},'native':{}}),await _0x282748['setObjectNotExistsAsync'](_0x348b7d(0x1c8),{'type':_0x348b7d(0xf2),'common':{'name':_0x348b7d(0x23e),'type':_0x348b7d(0x124),'role':_0x348b7d(0x201),'read':!![],'write':![]},'native':{}}),await _0x282748[_0x348b7d(0x161)](_0x348b7d(0x223),{'type':_0x348b7d(0xf2),'common':{'name':_0x348b7d(0xb6),'type':_0x348b7d(0xbf),'role':_0x348b7d(0x1f0),'read':!![],'write':![]},'native':{}}),await _0x282748[_0x348b7d(0x161)](_0x348b7d(0x268),{'type':'state','common':{'name':_0x348b7d(0x105),'type':_0x348b7d(0xbf),'role':_0x348b7d(0x1e7),'read':!![],'write':![]},'native':{}}),await _0x282748[_0x348b7d(0x161)](_0x348b7d(0x1c4),{'type':_0x348b7d(0xf2),'common':{'name':_0x348b7d(0x25d),'type':_0x348b7d(0xbf),'role':_0x348b7d(0x1f0),'read':!![],'write':![]},'native':{}}),await _0x282748[_0x348b7d(0x161)](_0x348b7d(0xab),{'type':_0x348b7d(0xf2),'common':{'name':'Target\x20Value','type':_0x348b7d(0xbf),'role':_0x348b7d(0x1f0),'read':!![],'write':![]},'native':{}}),await _0x282748[_0x348b7d(0x161)](_0x348b7d(0x112),{'type':'state','common':{'name':_0x348b7d(0x24b),'type':_0x348b7d(0x124),'role':'switch','read':!![],'write':!![]},'native':{}}),await _0x282748[_0x348b7d(0x161)](_0x348b7d(0x18b),{'type':_0x348b7d(0xf2),'common':{'name':_0x348b7d(0x168),'type':_0x348b7d(0x124),'role':_0x348b7d(0x16b),'read':!![],'write':!![]},'native':{}});}async function loadSystemMode(_0x172526){const _0x2f3fca=a0_0x4ea597;try{const _0x15fe9b=await _0x172526[_0x2f3fca(0x244)](SYSTEM_DP_MODE);_0x15fe9b&&_0x15fe9b[_0x2f3fca(0xd4)]&&Object[_0x2f3fca(0xa3)](SYSTEM_MODES)[_0x2f3fca(0x215)](_0x15fe9b[_0x2f3fca(0xd4)])?_0x172526[_0x2f3fca(0xf0)]=_0x15fe9b['val']:(_0x172526['currentSystemMode']=SYSTEM_MODES['NORMAL'],await _0x172526[_0x2f3fca(0xcf)](SYSTEM_DP_MODE,{'val':SYSTEM_MODES[_0x2f3fca(0x21d)],'ack':!![]}));}catch(_0x5381ad){_0x172526[_0x2f3fca(0xf0)]=SYSTEM_MODES[_0x2f3fca(0x21d)];}}async function loadRawEventLog(_0x3dabc4){const _0x3f47ac=a0_0x4ea597;try{const _0x2e4303=await _0x3dabc4[_0x3f47ac(0x244)](LTM_DP_RAW_LOG);if(_0x2e4303&&_0x2e4303[_0x3f47ac(0xd4)])_0x3dabc4[_0x3f47ac(0x150)]=JSON[_0x3f47ac(0xb4)](_0x2e4303[_0x3f47ac(0xd4)]);}catch(_0x26118d){_0x3dabc4['rawEventLog']=[];}}async function saveRawEventLog(_0x53656f){const _0x521cf7=a0_0x4ea597;if(_0x53656f['rawEventLog']['length']>RAW_LOG_MAX_SIZE)_0x53656f['rawEventLog']['splice'](0x0,_0x53656f[_0x521cf7(0x150)][_0x521cf7(0x1d6)]-RAW_LOG_MAX_SIZE);await _0x53656f[_0x521cf7(0xcf)](LTM_DP_RAW_LOG,{'val':JSON[_0x521cf7(0x1f4)](_0x53656f['rawEventLog']),'ack':!![]});}async function loadDailyDigests(_0x22ac9e){const _0x490b79=a0_0x4ea597;try{const _0x2e6597=await _0x22ac9e[_0x490b79(0x244)](LTM_DP_DAILY_DIGESTS);if(_0x2e6597&&_0x2e6597['val'])_0x22ac9e[_0x490b79(0x1bd)]=JSON[_0x490b79(0xb4)](_0x2e6597[_0x490b79(0xd4)]);}catch(_0x4b8cef){_0x22ac9e[_0x490b79(0x1bd)]=[];}await updateBaselineStatus(_0x22ac9e);}async function saveDailyDigests(_0x29fc42,_0x561ac5=!![]){const _0x3f17ad=a0_0x4ea597,_0x307a0f=_0x29fc42[_0x3f17ad(0x209)]['ltmLtbWindowDays']||0x3c;_0x29fc42['dailyDigests'][_0x3f17ad(0x1d6)]>_0x307a0f&&_0x29fc42[_0x3f17ad(0x1bd)]['splice'](0x0,_0x29fc42['dailyDigests'][_0x3f17ad(0x1d6)]-_0x307a0f);await _0x29fc42[_0x3f17ad(0xcf)](LTM_DP_DAILY_DIGESTS,{'val':JSON['stringify'](_0x29fc42['dailyDigests']),'ack':!![]});if(_0x561ac5)await updateBaselineStatus(_0x29fc42);}async function updateAnalysisHistory(_0x81c7db,_0x2215b5){const _0x334a57=a0_0x4ea597;_0x81c7db['analysisHistory'][_0x334a57(0x1e6)](_0x2215b5);if(_0x81c7db[_0x334a57(0x1b2)][_0x334a57(0x1d6)]>HISTORY_MAX_SIZE)_0x81c7db[_0x334a57(0x1b2)][_0x334a57(0x182)]();await _0x81c7db[_0x334a57(0xcf)](_0x334a57(0xd5),{'val':JSON[_0x334a57(0x1f4)](_0x81c7db[_0x334a57(0x1b2)]),'ack':!![]});}async function updateBaselineStatus(_0x51de69){const _0x2cda11=a0_0x4ea597;if(!_0x51de69[_0x2cda11(0x1f7)]){await _0x51de69['setStateAsync'](LTM_DP_BASELINE_STATUS,{'val':_0x2cda11(0x100),'ack':!![]});return;}const _0x572caf=_0x51de69[_0x2cda11(0x1bd)][_0x2cda11(0x1d6)]>=(_0x51de69['config']['minDaysForBaseline']||0x7)?_0x2cda11(0x12f)+_0x51de69[_0x2cda11(0x1bd)][_0x2cda11(0x1d6)]+_0x2cda11(0x1b7):'Lernphase\x20('+_0x51de69[_0x2cda11(0x1bd)]['length']+'/'+(_0x51de69[_0x2cda11(0x209)]['minDaysForBaseline']||0x7)+')';await _0x51de69[_0x2cda11(0xcf)](LTM_DP_BASELINE_STATUS,{'val':_0x572caf,'ack':!![]});}async function initSensorSubscriptions(_0x549dae){const _0x356031=a0_0x4ea597,_0x4c7a9f=_0x549dae[_0x356031(0x209)][_0x356031(0x10c)];if(_0x4c7a9f)for(const _0x4c02b9 of _0x4c7a9f){await _0x549dae[_0x356031(0xc9)](_0x4c02b9['id']);}}async function initPresenceSubscriptions(_0x5082e0){const _0x447daf=a0_0x4ea597,_0x1c7c88=_0x5082e0[_0x447daf(0x209)][_0x447daf(0xff)];if(_0x1c7c88)for(const _0x4552e1 of _0x1c7c88){await _0x5082e0[_0x447daf(0xc9)](_0x4552e1);}}async function setupTelegramListener(_0x124ebb){const _0x1a4c10=a0_0x4ea597,_0x554520=_0x124ebb[_0x1a4c10(0x209)]['notifyTelegramInstance'];if(_0x124ebb[_0x1a4c10(0x209)][_0x1a4c10(0xea)]&&_0x554520)await _0x124ebb[_0x1a4c10(0xc9)](_0x554520+'.communicate.request');}async function checkWifiPresence(_0x39b724){const _0xbb26ab=a0_0x4ea597;try{const _0x25daf9=_0x39b724[_0xbb26ab(0x209)][_0xbb26ab(0xff)]||[];let _0x3d624b=![];const _0x129e2c=[];for(const _0x384c08 of _0x25daf9){try{const _0x1af0ed=await _0x39b724['getForeignStateAsync'](_0x384c08);_0x1af0ed&&(_0x1af0ed[_0xbb26ab(0xd4)]===!![]||_0x1af0ed[_0xbb26ab(0xd4)]==='online'||_0x1af0ed['val']===0x1)&&(_0x3d624b=!![],_0x129e2c[_0xbb26ab(0x1c5)](_0x384c08));}catch(_0x2ba4a3){}}return await _0x39b724[_0xbb26ab(0xcf)](_0xbb26ab(0x16d),{'val':_0x129e2c[_0xbb26ab(0x16a)](',\x20'),'ack':!![]}),_0x3d624b&&(_0x39b724[_0xbb26ab(0x129)]&&(_0x39b724[_0xbb26ab(0x10b)][_0xbb26ab(0x180)](_0xbb26ab(0x21a)),abortExitTimer(_0x39b724)),!_0x39b724[_0xbb26ab(0x1ee)]&&_0x39b724[_0xbb26ab(0xf0)]===SYSTEM_MODES[_0xbb26ab(0x21d)]&&await setPresence(_0x39b724,!![])),_0x3d624b;}catch(_0x360e3d){return![];}}function startExitTimer(_0x1c3bb5){const _0x34df14=a0_0x4ea597;abortExitTimer(_0x1c3bb5),_0x1c3bb5[_0x34df14(0x264)]=!![],_0x1c3bb5[_0x34df14(0x19b)]=setTimeout(()=>{const _0xa1b8d6=_0x34df14;_0x1c3bb5[_0xa1b8d6(0x264)]=![];},EXIT_GRACE_PERIOD_SECONDS*0x3e8),_0x1c3bb5[_0x34df14(0x129)]=setTimeout(()=>{const _0x7d1dd8=_0x34df14;setPresence(_0x1c3bb5,![]),_0x1c3bb5[_0x7d1dd8(0x129)]=null;},EXIT_TIMER_MINUTES*0x3c*0x3e8);}function abortExitTimer(_0x1699ed){const _0x3a93d0=a0_0x4ea597;if(_0x1699ed[_0x3a93d0(0x129)])clearTimeout(_0x1699ed[_0x3a93d0(0x129)]);if(_0x1699ed[_0x3a93d0(0x19b)])clearTimeout(_0x1699ed[_0x3a93d0(0x19b)]);_0x1699ed[_0x3a93d0(0x129)]=null,_0x1699ed[_0x3a93d0(0x19b)]=null,_0x1699ed[_0x3a93d0(0x264)]=![];}async function setPresence(_0x5e6b9e,_0x46617f){const _0x351b3e=a0_0x4ea597;if(_0x5e6b9e[_0x351b3e(0x1ee)]===_0x46617f)return;_0x5e6b9e['isPresent']=_0x46617f,await _0x5e6b9e[_0x351b3e(0xcf)](_0x351b3e(0x12b),{'val':_0x46617f,'ack':!![]});}async function executeAutomationAction(_0xef6204){const _0x3d7c26=a0_0x4ea597;try{const _0x48e1b6=await _0xef6204['getStateAsync'](_0x3d7c26(0x1c4)),_0x5adfc6=await _0xef6204['getStateAsync'](_0x3d7c26(0xab));if(_0x48e1b6&&_0x48e1b6[_0x3d7c26(0xd4)]&&_0x5adfc6){const _0x49bd71=_0x48e1b6[_0x3d7c26(0xd4)];let _0x54aa69=_0x5adfc6[_0x3d7c26(0xd4)];try{_0x54aa69=JSON[_0x3d7c26(0xb4)](_0x54aa69);}catch(_0x2e7ce1){}_0xef6204[_0x3d7c26(0x10b)][_0x3d7c26(0x180)](_0x3d7c26(0x144)+_0x49bd71+_0x3d7c26(0x155)+_0x54aa69),await _0xef6204[_0x3d7c26(0x176)](_0x49bd71,_0x54aa69);}else _0xef6204['log'][_0x3d7c26(0x1d9)]('ü§ñ\x20BUTLER:\x20No\x20valid\x20target\x20ID\x20or\x20value\x20stored\x20for\x20execution.');}catch(_0x5e25a1){_0xef6204['log'][_0x3d7c26(0x11b)](_0x3d7c26(0x17b)+_0x5e25a1['message']);}}async function processSensorEvent(_0x1b1741,_0x4bae4f,_0xcd6251,_0x57d92c){const _0x5a84e7=a0_0x4ea597;if(!_0x57d92c)return;const _0x2a0d06=_0xcd6251[_0x5a84e7(0xd4)],_0x1f0b1b=Date['now'](),_0x2e7190=_0x1b1741[_0x5a84e7(0x1ca)][_0x4bae4f];_0x1b1741[_0x5a84e7(0x1ca)][_0x4bae4f]=_0x2a0d06;if(!_0x57d92c['logDuplicates']&&_0x2e7190!=undefined&&_0x2e7190==_0x2a0d06)return;const _0x51eae2=(_0x57d92c[_0x5a84e7(0x1d4)]||'')[_0x5a84e7(0x169)](),_0x2b9c53=_0x51eae2[_0x5a84e7(0x215)](_0x5a84e7(0x18f))||_0x51eae2[_0x5a84e7(0x215)](_0x5a84e7(0xd2))||_0x51eae2[_0x5a84e7(0x215)]('klima')||_0x51eae2[_0x5a84e7(0x215)](_0x5a84e7(0xad));_0x1b1741[_0x5a84e7(0x1f7)]&&_0x2b9c53&&recordThermodynamics(_0x1b1741,_0x4bae4f,_0x2a0d06,_0x57d92c[_0x5a84e7(0x1ae)]);const _0x41ff95={'timestamp':_0x1f0b1b,'id':_0x4bae4f,'name':_0x57d92c[_0x5a84e7(0x241)],'type':_0x57d92c[_0x5a84e7(0x1d4)],'location':_0x57d92c[_0x5a84e7(0x1ae)],'value':_0x2a0d06};_0x1b1741[_0x5a84e7(0x1a5)][_0x5a84e7(0x1e6)](_0x41ff95);if(_0x1b1741[_0x5a84e7(0x1a5)]['length']>HISTORY_MAX_SIZE)_0x1b1741[_0x5a84e7(0x1a5)][_0x5a84e7(0x182)]();await _0x1b1741[_0x5a84e7(0xcf)]('events.lastEvent',{'val':JSON[_0x5a84e7(0x1f4)](_0x41ff95),'ack':!![]}),await _0x1b1741[_0x5a84e7(0xcf)](_0x5a84e7(0x237),{'val':JSON[_0x5a84e7(0x1f4)](_0x1b1741[_0x5a84e7(0x1a5)]),'ack':!![]});_0x1b1741[_0x5a84e7(0x1f7)]&&(_0x1b1741[_0x5a84e7(0x150)][_0x5a84e7(0x1c5)](_0x41ff95),await saveRawEventLog(_0x1b1741),recordSequence(_0x1b1741,_0x41ff95));if(_0x57d92c['isExit']&&_0x2a0d06===!![]){if(_0x1b1741[_0x5a84e7(0x1ee)]&&!_0x1b1741['isGracePeriodActive'])startExitTimer(_0x1b1741);else{if(!_0x1b1741[_0x5a84e7(0x1ee)])setPresence(_0x1b1741,!![]);}}else{if(_0x57d92c['type']===_0x5a84e7(0x17c)&&_0x2a0d06===!![]){if(_0x1b1741['exitTimer'])abortExitTimer(_0x1b1741);if(!_0x1b1741[_0x5a84e7(0x1ee)]&&_0x1b1741[_0x5a84e7(0xf0)]===SYSTEM_MODES[_0x5a84e7(0x21d)])setPresence(_0x1b1741,!![]);}}}async function recordThermodynamics(_0x45300a,_0x89d66e,_0x130f0b,_0x41f1ca){const _0x28232b=a0_0x4ea597,_0x4260bc=await getOutsideTemperatureNumeric(_0x45300a),_0x344318=await _0x45300a[_0x28232b(0x244)](_0x28232b(0x210));let _0x2cc319=[];if(_0x344318&&_0x344318[_0x28232b(0xd4)])try{_0x2cc319=JSON['parse'](_0x344318[_0x28232b(0xd4)]);}catch(_0x56cd3a){}_0x2cc319[_0x28232b(0x1c5)]({'ts':Date[_0x28232b(0xe1)](),'room':_0x41f1ca||_0x28232b(0x189),'t_in':_0x130f0b,'t_out':_0x4260bc});if(_0x2cc319[_0x28232b(0x1d6)]>THERMO_LOG_SIZE)_0x2cc319[_0x28232b(0x25b)]();await _0x45300a[_0x28232b(0xcf)]('LTM.trainingData.thermodynamics',{'val':JSON[_0x28232b(0x1f4)](_0x2cc319),'ack':!![]});}async function getOutsideTemperatureNumeric(_0xb63280){const _0x154ec1=a0_0x4ea597;if(_0xb63280['config'][_0x154ec1(0x238)])try{const _0x1a420c=await _0xb63280[_0x154ec1(0xb8)](_0xb63280[_0x154ec1(0x209)][_0x154ec1(0x238)]);if(_0x1a420c&&_0x1a420c[_0x154ec1(0xd4)]!==undefined&&_0x1a420c[_0x154ec1(0xd4)]!==null)return parseFloat(_0x1a420c['val']);}catch(_0x24e76b){}const _0xff4de8=_0xb63280[_0x154ec1(0x209)]['weatherInstance'];if(!_0xb63280[_0x154ec1(0x209)][_0x154ec1(0xe5)]||!_0xff4de8)return null;try{let _0x557d55='';if(_0xff4de8[_0x154ec1(0x215)](_0x154ec1(0x195)))_0x557d55=_0xff4de8+_0x154ec1(0xf3);else{if(_0xff4de8[_0x154ec1(0x215)](_0x154ec1(0x152)))_0x557d55=_0xff4de8+_0x154ec1(0xe2);else{if(_0xff4de8[_0x154ec1(0x215)](_0x154ec1(0x21f)))_0x557d55=_0xff4de8+_0x154ec1(0xf1);else{if(_0xff4de8[_0x154ec1(0x215)]('weatherunderground'))_0x557d55=_0xff4de8+_0x154ec1(0x22f);}}}if(_0x557d55){const _0x258ca8=await _0xb63280[_0x154ec1(0xb8)](_0x557d55);if(_0x258ca8&&_0x258ca8[_0x154ec1(0xd4)]!==undefined&&_0x258ca8[_0x154ec1(0xd4)]!==null)return parseFloat(_0x258ca8['val']);}}catch(_0xff8ba6){}return null;}async function recordSequence(_0x3a7f52,_0x183868){const _0x4ad683=a0_0x4ea597,_0x14f8e9=(_0x183868[_0x4ad683(0x1d4)]||'')[_0x4ad683(0x169)](),_0x5576bd=['motion',_0x4ad683(0x114),_0x4ad683(0x1db),'presence','occupancy',_0x4ad683(0x250),'t√ºr',_0x4ad683(0x163),_0x4ad683(0xb3),_0x4ad683(0x170),_0x4ad683(0x23b),_0x4ad683(0x1f2),'licht','switch',_0x4ad683(0x1a4),_0x4ad683(0x13a),_0x4ad683(0x1e4)];if(!_0x5576bd['some'](_0x76ea1e=>_0x14f8e9['includes'](_0x76ea1e)))return;if(!_0x183868[_0x4ad683(0x1bb)])return;if(sequenceTimer)clearTimeout(sequenceTimer);activeSequence[_0x4ad683(0x1c5)]({'loc':_0x183868[_0x4ad683(0x1ae)]||_0x4ad683(0x189),'id':_0x183868['id'],'ts':Date['now']()}),sequenceTimer=setTimeout(async()=>{const _0x304b34=_0x4ad683;if(activeSequence[_0x304b34(0x1d6)]>0x1)await saveCompletedSequence(_0x3a7f52);activeSequence=[];},SEQUENCE_TIMEOUT_MS);}async function saveCompletedSequence(_0x3c3cb2){const _0x527912=a0_0x4ea597;try{const _0x194e28=await _0x3c3cb2[_0x527912(0x244)](_0x527912(0x146));let _0x39c11c=[];if(_0x194e28&&_0x194e28[_0x527912(0xd4)])try{_0x39c11c=JSON['parse'](_0x194e28['val']);}catch(_0x52334d){}const _0x99057c=activeSequence[0x0]['ts'],_0x1a8aa9=activeSequence['map'](_0x47e90d=>({'loc':_0x47e90d[_0x527912(0x133)],'t_delta':Math['round']((_0x47e90d['ts']-_0x99057c)/0x3e8)})),_0x2367f0={'timestamp':new Date(_0x99057c)['toISOString'](),'steps':_0x1a8aa9,'duration':Math['round']((activeSequence[activeSequence['length']-0x1]['ts']-_0x99057c)/0x3e8),'daytime':new Date(_0x99057c)[_0x527912(0x216)]()};_0x39c11c[_0x527912(0x1c5)](_0x2367f0);if(_0x39c11c[_0x527912(0x1d6)]>MAX_TRAINING_SET_SIZE)_0x39c11c[_0x527912(0x25b)]();await _0x3c3cb2[_0x527912(0xcf)](_0x527912(0x146),{'val':JSON[_0x527912(0x1f4)](_0x39c11c),'ack':!![]}),runSecurityCheck(_0x3c3cb2,_0x2367f0);}catch(_0x1ca538){_0x3c3cb2[_0x527912(0x10b)][_0x527912(0x11b)]('[RECORDER]\x20Error:\x20'+_0x1ca538[_0x527912(0x178)]);}}function runSecurityCheck(_0x122cf9,_0x2e4834){const _0x15e30c=a0_0x4ea597;if(!_0x122cf9[_0x15e30c(0x1f7)])return;sendToPython(_0x122cf9,'ANALYZE_SEQUENCE',{'sequence':_0x2e4834});}function sendToPython(_0x47188b,_0x29f302,_0x5e0683={}){const _0x391644=a0_0x4ea597;if(!_0x47188b[_0x391644(0xb1)]||!_0x47188b[_0x391644(0xb1)][_0x391644(0x15f)]['writable'])return;const _0xe54b70=JSON[_0x391644(0x1f4)]({'command':_0x29f302,..._0x5e0683});try{_0x47188b[_0x391644(0xb1)][_0x391644(0x15f)][_0x391644(0x1ce)](_0xe54b70+'\x0a');}catch(_0x29baa0){}}function startPythonService(_0x332f10){const _0x230be0=a0_0x4ea597;let _0x16edd5=_0x230be0(0xa2);if(fs[_0x230be0(0x125)](PYTHON_EXE))_0x16edd5=PYTHON_EXE;try{const _0x3f1416=path[_0x230be0(0x16a)](__dirname,_0x230be0(0x20c),'service.py');_0x332f10['pythonProcess']=spawn(_0x16edd5,[_0x3f1416]),_0x332f10[_0x230be0(0xb1)]['stdout']['on'](_0x230be0(0x188),_0xa64078=>{const _0x36ed11=_0xa64078['toString']()['split']('\x0a');_0x36ed11['forEach'](_0x507975=>{const _0x1eb824=a0_0x4859,_0x248c69=_0x507975['trim']();if(!_0x248c69)return;if(_0x248c69['startsWith'](_0x1eb824(0x1ea)))_0x332f10[_0x1eb824(0x10b)]['debug'](_0x1eb824(0xbb)+_0x248c69[_0x1eb824(0x174)](0x5)[_0x1eb824(0x25c)]());else{if(_0x248c69[_0x1eb824(0xe3)](_0x1eb824(0x193)))try{const _0x18eee4=JSON[_0x1eb824(0xb4)](_0x248c69[_0x1eb824(0x174)](0x8)[_0x1eb824(0x25c)]());handlePythonResult(_0x332f10,_0x18eee4);}catch(_0xe77f27){}}});}),_0x332f10[_0x230be0(0xb1)]['on'](_0x230be0(0x20a),_0x57cf68=>{const _0x189ae8=_0x230be0;_0x332f10[_0x189ae8(0xb1)]=null;});}catch(_0x3868b0){_0x332f10[_0x230be0(0x10b)][_0x230be0(0x11b)](_0x230be0(0x162)+_0x3868b0[_0x230be0(0x178)]);}}function stopPythonService(_0x4b003b){const _0xb4708e=a0_0x4ea597;if(_0x4b003b['pythonProcess']){try{_0x4b003b[_0xb4708e(0xb1)][_0xb4708e(0x214)]();}catch(_0xb9bad){}_0x4b003b[_0xb4708e(0xb1)]=null;}}function handlePythonResult(_0x28feff,_0x34da47){const _0x28bace=a0_0x4ea597;if(_0x34da47[_0x28bace(0x1d4)]==='PONG')_0x28feff[_0x28bace(0x10b)]['debug'](_0x28bace(0x14b));else{if(_0x34da47['type']===_0x28bace(0x25a)){const {anomaly_score:_0x4f7d34,is_anomaly:_0x5c4b56,threshold:_0x87d1a2,explanation:_0x68c9a7}=_0x34da47['payload'];_0x28feff[_0x28bace(0x10b)][_0x28bace(0x180)](_0x28bace(0x185)+_0x4f7d34[_0x28bace(0x1cf)](0x5)+_0x28bace(0x1da)+(_0x5c4b56?_0x28bace(0x15e):'OK')),_0x28feff['setStateAsync'](_0x28bace(0x194),{'val':_0x4f7d34,'ack':!![]}),_0x28feff[_0x28bace(0xcf)](_0x28bace(0xfc),{'val':new Date()[_0x28bace(0x196)](),'ack':!![]});if(_0x87d1a2)_0x28feff[_0x28bace(0xcf)](_0x28bace(0xd3),{'val':_0x87d1a2,'ack':!![]});if(_0x5c4b56){let _0x179504='Ungew√∂hnliches\x20Bewegungsmuster!\x20(Score:\x20'+_0x4f7d34[_0x28bace(0x1cf)](0x4)+')';if(_0x68c9a7&&_0x68c9a7!==_0x28bace(0x189))_0x179504+=_0x28bace(0xd1)+_0x68c9a7;_0x28feff[_0x28bace(0xcf)](_0x28bace(0x1b3),{'val':!![],'ack':!![]}),_0x28feff[_0x28bace(0xcf)]('analysis.alertReason',{'val':_0x179504,'ack':!![]}),sendNotification(_0x28feff,'‚ö†Ô∏è\x20SECURITY\x20ALARM:\x20'+_0x179504,![],!![]);}}else{if(_0x34da47['type']===_0x28bace(0xc4)){const _0xf18e38=_0x34da47[_0x28bace(0x172)][_0x28bace(0x15c)]||'',_0x4ddebd=_0x34da47[_0x28bace(0x172)][_0x28bace(0x159)],_0xb18dc5=_0x34da47[_0x28bace(0x172)][_0x28bace(0x171)]?_0x28bace(0x16c)+new Date()['toLocaleTimeString']()+'\x20('+_0xf18e38+')':_0x28bace(0xbe)+_0x34da47[_0x28bace(0x172)]['reason'];_0x28feff[_0x28bace(0xcf)](_0x28bace(0x121),{'val':_0xb18dc5,'ack':!![]});if(_0x34da47[_0x28bace(0x172)]['success']&&_0x4ddebd)_0x28feff[_0x28bace(0xcf)](_0x28bace(0xd3),{'val':_0x4ddebd,'ack':!![]});}else{if(_0x34da47['type']===_0x28bace(0x139)){const {patterns:_0x39d65a}=_0x34da47[_0x28bace(0x172)];if(_0x39d65a&&_0x39d65a[_0x28bace(0x1d6)]>0x0){_0x28feff[_0x28bace(0x10b)][_0x28bace(0x180)](_0x28bace(0x199)+_0x39d65a['length']+_0x28bace(0xfe)),_0x28feff[_0x28bace(0xcf)](_0x28bace(0x268),{'val':JSON['stringify'](_0x39d65a),'ack':!![]});const _0x4b9141=_0x39d65a[0x0],_0x27dccb='Regel\x20erkannt:\x20'+_0x4b9141[_0x28bace(0x187)]+'\x20('+(_0x4b9141[_0x28bace(0x11e)]*0x64)[_0x28bace(0x1cf)](0x0)+'%)';_0x28feff[_0x28bace(0xcf)]('analysis.automation.patternDetected',{'val':!![],'ack':!![]}),_0x28feff[_0x28bace(0xcf)](_0x28bace(0x223),{'val':_0x27dccb,'ack':!![]});}else _0x28feff[_0x28bace(0x10b)][_0x28bace(0x180)](_0x28bace(0xee)),_0x28feff[_0x28bace(0xcf)](_0x28bace(0x1c8),{'val':![],'ack':!![]}),_0x28feff[_0x28bace(0xcf)](_0x28bace(0x268),{'val':'[]','ack':!![]});}else{if(_0x34da47[_0x28bace(0x1d4)]==='ENERGY_TRAIN_RESULT'){if(_0x34da47[_0x28bace(0x172)][_0x28bace(0x171)])try{const _0x67a828=JSON[_0x28bace(0xb4)](_0x34da47[_0x28bace(0x172)][_0x28bace(0x15c)]);if(_0x67a828['insulation'])_0x28feff['setStateAsync']('analysis.energy.insulationScore',{'val':JSON[_0x28bace(0x1f4)](_0x67a828['insulation']),'ack':!![]});if(_0x67a828[_0x28bace(0x173)])_0x28feff['setStateAsync'](_0x28bace(0x18c),{'val':JSON[_0x28bace(0x1f4)](_0x67a828[_0x28bace(0x173)]),'ack':!![]});}catch(_0xc55e8d){}}else{if(_0x34da47['type']===_0x28bace(0x1df)){if(_0x34da47[_0x28bace(0x172)][_0x28bace(0x171)])_0x28feff[_0x28bace(0x10b)][_0x28bace(0x180)]('‚úÖ\x20HEALTH\x20TRAINED.');}else{if(_0x34da47[_0x28bace(0x1d4)]==='HEALTH_RESULT')_0x28feff[_0x28bace(0xcf)](_0x28bace(0x1e5),{'val':new Date()[_0x28bace(0x196)](),'ack':!![]}),_0x28feff[_0x28bace(0xcf)](_0x28bace(0xed),{'val':_0x34da47[_0x28bace(0x172)][_0x28bace(0x117)],'ack':!![]});else{if(_0x34da47[_0x28bace(0x1d4)]===_0x28bace(0x137))_0x28feff[_0x28bace(0xcf)](_0x28bace(0x230),{'val':_0x34da47['payload'][_0x28bace(0x11c)],'ack':!![]}),_0x28feff[_0x28bace(0xcf)](_0x28bace(0x19d),{'val':_0x34da47[_0x28bace(0x172)][_0x28bace(0x17d)],'ack':!![]});else{if(_0x34da47[_0x28bace(0x1d4)]===_0x28bace(0xf9)){const {speed_trend:_0x135e3a}=_0x34da47[_0x28bace(0x172)];_0x135e3a!==undefined&&_0x28feff[_0x28bace(0xcf)](_0x28bace(0x127),{'val':_0x135e3a,'ack':!![]});}else{if(_0x34da47[_0x28bace(0x1d4)]==='ENERGY_PREDICT_RESULT'){const {forecast:_0x1f931a}=_0x34da47[_0x28bace(0x172)];_0x1f931a&&_0x28feff[_0x28bace(0xcf)](_0x28bace(0x149),{'val':JSON['stringify'](_0x1f931a),'ack':!![]});}else{if(_0x34da47[_0x28bace(0x1d4)]===_0x28bace(0x123)){const {data:_0x5c0084}=_0x34da47[_0x28bace(0x172)];_0x5c0084&&(_0x28feff[_0x28bace(0x10b)]['info'](_0x28bace(0x234)),_0x28feff[_0x28bace(0xcf)](_0x28bace(0xde),{'val':JSON[_0x28bace(0x1f4)](_0x5c0084),'ack':!![]}));}}}}}}}}}}}}function runPythonHealthCheck(_0x2f00cb){const _0x521117=a0_0x4ea597;if(!_0x2f00cb[_0x521117(0x1bd)]||_0x2f00cb[_0x521117(0x1bd)][_0x521117(0x1d6)]<0x2)return;const _0x423522=_0x2f00cb[_0x521117(0x1bd)][_0x521117(0x14a)](_0x1270fd=>{const _0x30b3ce=_0x521117,_0x351018=(_0x1270fd[_0x30b3ce(0x259)]||'')[_0x30b3ce(0x169)]();return ACTIVITY_LEVEL_MAP[_0x351018]||0x32;});sendToPython(_0x2f00cb,_0x521117(0xa5),{'values':_0x423522,'tag':_0x521117(0xca)});}async function handleTelegramResponse(_0x1f7e5d,_0x38ad08){const _0x2a9764=a0_0x4ea597;let _0x573aef=_0x38ad08;_0x38ad08[_0x2a9764(0xe3)]('[')&&(_0x573aef=_0x38ad08[_0x2a9764(0x174)](_0x38ad08['indexOf'](']')+0x1));if(_0x573aef===_0x2a9764(0x24e))await _0x1f7e5d[_0x2a9764(0xcf)](_0x2a9764(0x1b3),{'val':![],'ack':!![]}),await _0x1f7e5d[_0x2a9764(0xcf)](_0x2a9764(0x1b5),{'val':_0x2a9764(0xaa),'ack':!![]}),_0x1f7e5d[_0x2a9764(0x11f)]=![],sendNotification(_0x1f7e5d,_0x2a9764(0xcc),![]);else _0x573aef==='COGNI_REQUEST_CALL'&&sendNotification(_0x1f7e5d,_0x2a9764(0x248),![],!![]);}async function sendNotification(_0x1efe63,_0x5083d3,_0x4a5dfd=![],_0x3b8e39=![]){const _0x7a2f69=a0_0x4ea597,_0x40a454=_0x1efe63[_0x7a2f69(0x209)];if(_0x40a454['notifyTelegramEnabled']){let _0x1867b8={};(_0x5083d3['includes']('Alarm')||_0x3b8e39)&&(_0x1867b8={'reply_markup':{'inline_keyboard':[[{'text':'‚úÖ\x20Alles\x20OK\x20(Reset)','callback_data':_0x7a2f69(0x24e)}],[{'text':_0x7a2f69(0x130),'callback_data':_0x7a2f69(0x1a1)}]]}}),await _0x1efe63[_0x7a2f69(0xe7)](_0x40a454[_0x7a2f69(0x10f)],_0x7a2f69(0x1fa),{'text':_0x5083d3,'user':_0x40a454[_0x7a2f69(0x1e1)],..._0x1867b8});}if(_0x40a454[_0x7a2f69(0x22d)]){let _0x5c4158={'message':_0x5083d3,'title':_0x3b8e39?_0x7a2f69(0x252):_0x7a2f69(0x25e),'priority':_0x3b8e39?0x2:0x1,'device':_0x40a454[_0x7a2f69(0x1fc)]};_0x3b8e39&&(_0x5c4158[_0x7a2f69(0xbd)]=0x1e,_0x5c4158[_0x7a2f69(0x1e0)]=0xe10,_0x5c4158['sound']=_0x7a2f69(0x1d2)),await _0x1efe63['sendToAsync'](_0x40a454[_0x7a2f69(0x13f)],_0x7a2f69(0x1fa),_0x5c4158);}_0x40a454[_0x7a2f69(0x1c2)]&&await _0x1efe63[_0x7a2f69(0xe7)](_0x40a454[_0x7a2f69(0xa9)],_0x7a2f69(0x1fa),{'text':_0x5083d3,'to':_0x40a454[_0x7a2f69(0x1ba)]});}async function runGeminiAnalysis(_0x272674,_0x45e6dc=''){const _0x1ff6f0=a0_0x4ea597;if(!_0x272674[_0x1ff6f0(0x141)])return;if(_0x272674[_0x1ff6f0(0x1a5)]['length']===0x0)return;const _0xe1dd11=_0x272674['eventHistory'][_0x1ff6f0(0xf6)](0x0,0xf),_0x1d331b=await getWeatherContext(_0x272674),_0xe0625f=_0x272674['currentSystemMode'],_0x52ce9d=PERSONA_MAPPING[_0x272674[_0x1ff6f0(0x209)][_0x1ff6f0(0xfd)]||_0x1ff6f0(0x1b1)],_0x1c57c0=_0x272674[_0x1ff6f0(0x209)][_0x1ff6f0(0x179)]||_0x1ff6f0(0x222);let _0x30bcef='Unbekannt';try{const _0x353f28=await _0x272674['getStateAsync'](_0x1ff6f0(0x16d));if(_0x353f28&&_0x353f28[_0x1ff6f0(0xd4)])_0x30bcef=_0x353f28[_0x1ff6f0(0xd4)];}catch(_0x1a1d63){}let _0x54fd59=![];try{const _0x4e7ffb=await _0x272674[_0x1ff6f0(0x244)](_0x1ff6f0(0x112));if(_0x4e7ffb&&_0x4e7ffb[_0x1ff6f0(0xd4)])_0x54fd59=!![];}catch(_0x38a4d0){}const _0x6816df=_0x1ff6f0(0xb0)+_0x52ce9d+_0x1ff6f0(0x11a)+_0x1c57c0+_0x1ff6f0(0xd6)+_0xe0625f+'.\x20WETTER:\x20'+_0x1d331b+_0x1ff6f0(0x1d7)+_0x30bcef+_0x1ff6f0(0x22c)+JSON[_0x1ff6f0(0x1f4)](_0xe1dd11)+_0x1ff6f0(0x119)+_0x45e6dc+_0x1ff6f0(0x11d);try{const _0x2bcc1a=await _0x272674['geminiModel'][_0x1ff6f0(0xd0)](_0x6816df),_0xe9efca=JSON['parse'](_0x2bcc1a[_0x1ff6f0(0x10e)][_0x1ff6f0(0x1f0)]()['replace'](/```json|```/g,'')[_0x1ff6f0(0x25c)]());await _0x272674[_0x1ff6f0(0xcf)](_0x1ff6f0(0x233),{'val':JSON[_0x1ff6f0(0x1f4)](_0xe9efca),'ack':!![]});if(_0xe9efca[_0x1ff6f0(0x1e3)])await _0x272674[_0x1ff6f0(0xcf)]('analysis.activitySummary',{'val':_0xe9efca[_0x1ff6f0(0x1e3)],'ack':!![]});const _0x137d14={'timestamp':Date[_0x1ff6f0(0xe1)](),'id':Date[_0x1ff6f0(0xe1)]()[_0x1ff6f0(0x1de)](),'analysis':{'activity':{'summary':_0xe9efca[_0x1ff6f0(0x1e3)],'isAlert':_0xe9efca[_0x1ff6f0(0x16e)],'alertReason':_0xe9efca['alertReason']},'comfort':{'automationProposal':_0xe9efca[_0x1ff6f0(0x1a9)]}}};await updateAnalysisHistory(_0x272674,_0x137d14);const _0x5a766a=_0xe9efca[_0x1ff6f0(0x16e)]||![];_0x5a766a!==_0x272674['lastAlertState']&&(await _0x272674['setStateAsync']('analysis.isAlert',{'val':_0x5a766a,'ack':!![]}),_0x272674[_0x1ff6f0(0x11f)]=_0x5a766a,_0x5a766a&&(await _0x272674[_0x1ff6f0(0xcf)](_0x1ff6f0(0x1b5),{'val':_0xe9efca[_0x1ff6f0(0xc8)],'ack':!![]}),sendNotification(_0x272674,_0x1ff6f0(0x22e)+_0xe9efca[_0x1ff6f0(0xc8)],![],_0xe9efca[_0x1ff6f0(0x217)])));if(_0xe9efca[_0x1ff6f0(0x1a9)]&&_0xe9efca['automationProposal'][_0x1ff6f0(0x253)]){await _0x272674[_0x1ff6f0(0xcf)]('analysis.automation.patternDetected',{'val':!![],'ack':!![]}),await _0x272674[_0x1ff6f0(0xcf)](_0x1ff6f0(0x223),{'val':_0xe9efca['automationProposal'][_0x1ff6f0(0x13e)],'ack':!![]}),await _0x272674[_0x1ff6f0(0xcf)](_0x1ff6f0(0x1c4),{'val':_0xe9efca[_0x1ff6f0(0x1a9)]['targetId'],'ack':!![]}),await _0x272674['setStateAsync'](_0x1ff6f0(0xab),{'val':JSON[_0x1ff6f0(0x1f4)](_0xe9efca[_0x1ff6f0(0x1a9)][_0x1ff6f0(0x202)]),'ack':!![]});if(_0x54fd59)executeAutomationAction(_0x272674);}}catch(_0x1223cf){_0x272674['log'][_0x1ff6f0(0x11b)](_0x1ff6f0(0xef)+_0x1223cf[_0x1ff6f0(0x178)]);}}async function createDailyDigest(_0x2da4c4){const _0x40bdaf=a0_0x4ea597;if(!_0x2da4c4['isProVersion'])return;await _0x2da4c4[_0x40bdaf(0xcf)](LTM_DP_STATUS,{'val':_0x40bdaf(0x24c),'ack':!![]});if(!_0x2da4c4[_0x40bdaf(0x141)]||_0x2da4c4[_0x40bdaf(0x150)][_0x40bdaf(0x1d6)]<LTM_MIN_EVENTS_FOR_COMPRESSION){await _0x2da4c4[_0x40bdaf(0xcf)](LTM_DP_STATUS,{'val':'Skipped\x20(No\x20AI\x20or\x20Data)','ack':!![]});return;}const _0x543346=JSON[_0x40bdaf(0xb4)](JSON['stringify'](_0x2da4c4['rawEventLog'])),_0x20286f=_0x543346[_0x40bdaf(0x1d6)],_0x32c494='ROLLE:\x20Data\x20Compression\x20Agent.\x20SPRACHE:\x20DE.\x20FORMAT:\x20JSON.\x20ANWEISUNG:\x20Fasse\x20Sensor-Events\x20zusammen.\x20SCHEMA:\x20{\x20\x22summary\x22:\x20\x22string\x22,\x20\x22activityLevel\x22:\x20\x22string\x22\x20}\x20\x0a\x0aEVENTS:\x0a'+JSON[_0x40bdaf(0x1f4)](_0x543346);try{const _0x5d6f22=await _0x2da4c4['geminiModel'][_0x40bdaf(0xd0)](_0x32c494),_0x33c7c7=JSON[_0x40bdaf(0xb4)](_0x5d6f22[_0x40bdaf(0x10e)]['text']()[_0x40bdaf(0xcd)](/```json|```/g,'')[_0x40bdaf(0x25c)]()),_0x372bc0={'timestamp':new Date()[_0x40bdaf(0x196)](),'eventCount':_0x20286f,'summary':_0x33c7c7[_0x40bdaf(0x1e3)]||_0x40bdaf(0x1a7),'activityLevel':_0x33c7c7[_0x40bdaf(0x259)]||'normal','systemMode':_0x2da4c4[_0x40bdaf(0xf0)]};_0x2da4c4[_0x40bdaf(0x1bd)][_0x40bdaf(0x1c5)](_0x372bc0),await saveDailyDigests(_0x2da4c4),_0x2da4c4[_0x40bdaf(0x150)]=[],await saveRawEventLog(_0x2da4c4),await _0x2da4c4[_0x40bdaf(0xcf)](LTM_DP_STATUS,{'val':_0x40bdaf(0xc3),'ack':!![]});if(_0x2da4c4[_0x40bdaf(0x1f7)])sendToPython(_0x2da4c4,_0x40bdaf(0xb5),{'digest':_0x372bc0});}catch(_0x2d4611){_0x2da4c4[_0x40bdaf(0x10b)][_0x40bdaf(0x11b)](_0x2d4611[_0x40bdaf(0x178)]);}}function a0_0x4af5(){const _0x3ef7df=['PARTY','COMFORT_RESULT','dimmer','ready',')\x20-\x20SAFE\x20BOOT','latitude','description','notifyPushoverInstance','analysis.training.triggerTopology','geminiModel','child_process','\x20*\x20*\x20*','ü§ñ\x20BUTLER:\x20Executing\x20Action\x20->\x20','object','LTM.trainingData.sequences','ltmStbWindowDays','.forecast.current.state','analysis.energy.forecast','map','üêç\x20Python\x20Pong','\x0aSTB:\x20','Energy\x20Intelligence','analysis.health.todayVector','Erstelle\x20ein\x20kurzes\x20\x27Guten\x20Morgen\x27\x20Briefing\x20basierend\x20auf\x20den\x20Events\x20der\x20letzten\x20Nacht.','rawEventLog','Missing\x20data','daswetter','üåÖ\x20Morning\x20Briefing:\x0a','sendTo','\x20=\x20','ANALYZE_GAIT','role','guest','threshold','getMonth','511367BdaQvA','details','Who\x20is\x20present?','ANOMALY','stdin','Daily\x20Digests','setObjectNotExistsAsync','Error\x20launching\x20Python:\x20','window','ltmLtbWindowDays','testApiKey','2mjYTlV','communicate.request','Trigger\x20Action','toLowerCase','join','button','Success:\x20','system.presenceWho','isAlert','submitFeedback','contact','success','payload','heating','substring','triggerDailyDigest','setForeignStateAsync','LTM','message','livingContext','analysis.activitySummary','BUTLER\x20Execution\x20Error:\x20','motion','change_percent','Wetterdaten\x20deaktiviert.','cancel','info','Anomaly\x20Detected','pop','events.history_debug_00','9374101bxlDJR','üõ°Ô∏è\x20SECURITY\x20CHECK:\x20Score\x20','Topology\x20Matrix','rule','data','Unknown','Build\x20Topology','analysis.automation.triggerAction','analysis.energy.heatingScore','26ugSRWg','(((.+)+)+)+$','temperature','OK:\x20','\x22\x20-c\x20\x22import\x20tensorflow;\x20import\x20pandas;\x20import\x20numpy;\x20print(\x27libs_ok\x27)\x22','1554948AkOGqe','[RESULT]','analysis.security.lastScore','accuweather','toISOString','weatherInstance','scanDevices','üõãÔ∏è\x20BUTLER:\x20Found\x20','LTM.processingStatus','exitGraceTimer','913014YUudru','analysis.health.trendValue','analysis.training.triggerComfort','inactivityThresholdHours','unknown','COGNI_REQUEST_CALL','Topology\x20Error:\x20','licht','schalter','eventHistory','Fokus\x20auf\x20Komfort.','Digest','instance','automationProposal','getGenerativeModel','getEnums','0\x203\x20*\x20*\x20*','Creating\x20new\x20VENV...','location','‚ö†Ô∏è\x20Python\x20VENV\x20missing.\x20Installing\x20locally...','exports','generic','analysisHistory','analysis.isAlert','üß†\x20Triggering\x20Security\x20Training...','analysis.alertReason','Trend','\x20Tage)','Adapter','getForeignObjectsAsync','notifyEmailRecipient','value','getLtmData','dailyDigests','filter','Sec-Training\x20started...','Thermodynamics','Gemini\x20Init\x20Error:\x20','notifyEmailEnabled','endsWith','analysis.automation.targetId','push','modeResetJob','subscribeStates','analysis.automation.patternDetected','Restoring\x20sensor\x20cache...','sensorLastValues','3NTvyaX','analysis.history_debug_00','‚úÖ\x20Fast-Boot:\x20Environment\x20healthy.\x20Skipping\x20installation.','write','toFixed','Heating\x20Score','08:00','siren','systemConfig','type','extendObjectAsync','length','.\x20ANWESEND:\x20','doors','warn','\x20->\x20','pr√§senz','triggerBriefing','@google/generative-ai','toString','HEALTH_TRAIN_RESULT','expire','notifyTelegramRecipient','normal','summary','lampe','analysis.health.lastCheck','unshift','json','TRAIN_SECURITY','üöÄ\x20Starting\x20NUUKANNI\x20Logic\x20(v0.12.0)...','[LOG]','simulateButler','timestamp','Last\x20raw\x20event','isPresent','driftAnalysisTimer','text','debug','light','PRIORIT√ÑT:\x20Gesundheit/AAL.','stringify','‚ùå\x20VENV\x20CREATION\x20FAILED:\x20','1009496nJtaNi','isProVersion','licenseKey','Gemini\x20AI\x20initialized.','send','driftDetails','notifyPushoverRecipient','longitude','Reset\x20Sched\x20Error:\x20','analysisTimer','Installing\x20pip\x20packages...\x20(Caching\x20enabled)','indicator','targetValue','status','LTM.triggerDailyDigest','onReady','‚ùå\x20INSTALL\x20FAILED:\x20','rating','analysis.energy.insulationScore','config','close','LTM.driftAnalysis','python_service','getTime','.venv','date','LTM.trainingData.thermodynamics','telegram','Trigger\x20Analysis','t√ºr','kill','includes','getHours','isEmergency','Scripts','Today\x20Vector\x20(15m)','WiFi\x20Presence\x20detected.','N/A','lights','NORMAL','Alert\x20Status','openweathermap','briefingEnabled','analysis.energy','Keine\x20Details.','analysis.automation.description','Sequences','win32','namespace','number','pip.exe','60DBSeAo','¬∞C,\x20','from','.\x20EVENTS:\x20','notifyPushoverEnabled','‚ö†Ô∏è\x20ALARM:\x20','.forecast.current.temp','analysis.health.trendDiagnosis','getFullYear','TRAIN_HEALTH','analysis.lastResult','üï∏Ô∏è\x20Topology\x20Map\x20updated.','fill','system','events.history','outdoorSensorId','TRAIN_COMFORT','üß™\x20Simulating\x20Butler\x20Proposal:\x20','kontakt','.Current.WeatherText','onUnload','Pattern\x20Detected','üìù\x20Feedback\x20received:\x20','systemUUID','name','getDate','analysis.training.triggerSecurity','getStateAsync','main','forEach','Gait\x20Speed\x20Trend','üìû\x20R√úCKRUF\x20BITTE!\x20Der\x20Bewohner\x20hat\x20den\x20R√ºckruf-Button\x20gedr√ºckt.','Trigger\x20Briefing','Fokus\x20auf\x20Familienroutinen.','Auto\x20Apply','Started...','genAI','COGNI_CONFIRM_OK','ü§ñ\x20Autopilot:\x20Running\x20periodic\x20analysis...','door','TRAIN_ENERGY','üö®\x20EMERGENCY','detected','unload','Insulation\x20Score','apiKey','No\x20instance','search','activityLevel','SECURITY_RESULT','shift','trim','Target\x20ID','Cogni-Living','0\x204\x20*\x20*\x20*','models/gemini-flash-latest','party','pip','geminiApiKey','isGracePeriodActive','version','Err:\x20','requirements.txt','analysis.automation.detectedPatterns','System\x20Mode','split','üîç\x20Scanning\x20for\x20devices...','AI\x20Training','python3','values','Train\x20Health','ANALYZE_TREND','text.alarm','Activity\x20Summary','ack','notifyEmailInstance','Vom\x20Benutzer\x20best√§tigt\x20(OK).','analysis.automation.targetValue','Train\x20Security','heizung','callback','analysisInterval','ROLLE:\x20KI-Hausverwalter.\x20PERSONA:\x20','pythonProcess','ROLLE:\x20Data\x20Scientist.\x20ZIEL:\x20Drift\x20erkennen.\x20SCHEMA:\x20{\x20\x22baselineDrift\x22:\x20\x22none|slight|significant|critical\x22,\x20\x22driftDetails\x22:\x20\x22string\x22\x20}\x0a\x0aLTB:\x20','fenster','parse','ANALYZE_HEALTH','Description','briefingJob','getForeignStateAsync','LTM.baselineStatus','platform','[PYTHON]\x20','KI-Modell\x20nicht\x20initialisiert','retry','Failed:\x20','string','Briefing\x20Sched\x20Error:\x20','Training\x20Error:\x20','Drift\x20Sched\x20Error:\x20','Success','TRAINING_COMPLETE','vacation','channel','BUILD_TOPOLOGY','alertReason','subscribeForeignStatesAsync','Activity-Level','analysis.security','‚úÖ\x20Alarm\x20quittiert.\x20System\x20normal.','replace','Keine\x20Termine.','setStateAsync','generateContent','\x0aGrund:\x20','temperatur','analysis.security.currentThreshold','val','analysis.analysisHistory','.\x20SYSTEM_MODE:\x20','48XkNZfr','dependencyInstallInProgress','onMessage','20ahfabQ','bin','python3\x20-m\x20venv\x20\x22','getOverviewData','analysis.security.topologyMatrix','setState','Last\x20Check','now','.NextHours.Location_1.Day_1.current.temp_value','startsWith','LTM\x20Sched\x20Error:\x20','useWeather','‚úÖ\x20INSTALL\x20SUCCESS.','sendToAsync','city','dismissAutomation','notifyTelegramEnabled','getObjectAsync','analysis.training.triggerEnergy','analysis.health.isAnomaly','üõãÔ∏è\x20BUTLER:\x20Keine\x20neuen\x20Muster\x20gefunden.','Gemini\x20Error:\x20','currentSystemMode','.forecast.current.temperature','state','.Current.Temperature','analysis.triggerBriefing','21GutYXA','slice','N/A\x20(Learning)','LTM.driftAnalysis.lastCheck','GAIT_RESULT','bind','common','analysis.security.lastCheck','aiPersona','\x20new\x20patterns.','presenceDevices','Deaktiviert\x20(Pro-Feature)','targetId','useCalendar','Current\x20Threshold','briefingTime','Detected\x20Patterns','autoApply','enum.functions.*','analysis.training.triggerHealth','command','üï∏Ô∏è\x20Building\x20Topology\x20Matrix...','log','devices','\x22\x20install\x20-r\x20\x22','response','notifyTelegramInstance','ltmDriftCheckIntervalHours','floor','analysis.automation.autoApply','SIMULATION:\x20Test-Vorschlag\x20f√ºr\x20','bewegung','python','find','is_anomaly','Alert\x20Reason','.\x20EMERGENCY:\x20','.\x20KONTEXT:\x20','error','diagnosis','.\x20AUFGABE:\x201.\x20Gesundheit?\x202.\x20Komfort?\x20FORMAT\x20(JSON):\x20{\x20\x22isAlert\x22:\x20boolean,\x20\x22alertReason\x22:\x20\x22string\x22,\x20\x22isEmergency\x22:\x20boolean,\x20\x22summary\x22:\x20\x22string\x22,\x20\x22automationProposal\x22:\x20{\x20\x22detected\x22:\x20boolean,\x20\x22description\x22:\x20\x22string\x22,\x20\x22targetId\x22:\x20\x22string\x22,\x20\x22targetValue\x22:\x20\x22any\x22\x20}\x20}','confidence','lastAlertState','ltmJob','analysis.training.status','minDaysForBaseline','TOPOLOGY_RESULT','boolean','existsSync','3330428TiixwX','analysis.health.gaitSpeed','LTM.rawEventLog','exitTimer','system.mode','system.isPresent','Raw\x20Log','analysis.trigger','automation.triggerAction','Aktiv\x20(','üìû\x20R√ºckruf\x20anfordern','scheduleJob','Briefing\x20Error:\x20','loc','system.config','getForeignObjectAsync','enum','TREND_RESULT'];a0_0x4af5=function(){return _0x3ef7df;};return a0_0x4af5();}function setupLtmScheduler(_0x668e4d){const _0x262b91=a0_0x4ea597;try{if(_0x668e4d['ltmJob'])_0x668e4d[_0x262b91(0x120)][_0x262b91(0x17f)]();if(!_0x668e4d[_0x262b91(0x1f7)])return;_0x668e4d['ltmJob']=schedule[_0x262b91(0x131)](LTM_SCHEDULE,()=>createDailyDigest(_0x668e4d));}catch(_0x2fb1e8){_0x668e4d[_0x262b91(0x10b)][_0x262b91(0x11b)](_0x262b91(0xe4)+_0x2fb1e8[_0x262b91(0x178)]);}}function setupModeResetScheduler(_0x4a295f){const _0xf172a4=a0_0x4ea597;try{if(_0x4a295f[_0xf172a4(0x1c6)])_0x4a295f['modeResetJob'][_0xf172a4(0x17f)]();_0x4a295f['modeResetJob']=schedule[_0xf172a4(0x131)](MODE_RESET_SCHEDULE,async()=>{const _0xf3c7b5=_0xf172a4;await loadSystemMode(_0x4a295f),AUTO_RESET_MODES[_0xf3c7b5(0x215)](_0x4a295f[_0xf3c7b5(0xf0)])&&await _0x4a295f[_0xf3c7b5(0xcf)](SYSTEM_DP_MODE,{'val':SYSTEM_MODES[_0xf3c7b5(0x21d)],'ack':![]});});}catch(_0xd2269b){_0x4a295f[_0xf172a4(0x10b)][_0xf172a4(0x11b)](_0xf172a4(0x1fe)+_0xd2269b[_0xf172a4(0x178)]);}}function setupDriftAnalysisScheduler(_0xd2e053){const _0x590fee=a0_0x4ea597;try{if(_0xd2e053[_0x590fee(0x1ef)])clearInterval(_0xd2e053[_0x590fee(0x1ef)]);if(!_0xd2e053['isProVersion'])return;_0xd2e053[_0x590fee(0x1ef)]=setInterval(()=>runBaselineDriftAnalysis(_0xd2e053),(_0xd2e053[_0x590fee(0x209)][_0x590fee(0x110)]||0x18)*0x36ee80),setTimeout(()=>runBaselineDriftAnalysis(_0xd2e053),0x1388);}catch(_0x483dde){_0xd2e053[_0x590fee(0x10b)]['error'](_0x590fee(0xc2)+_0x483dde[_0x590fee(0x178)]);}}function setupBriefingScheduler(_0x3fed03){const _0x2db146=a0_0x4ea597;try{if(_0x3fed03[_0x2db146(0xb7)])_0x3fed03['briefingJob']['cancel']();if(!_0x3fed03['config'][_0x2db146(0x220)])return;const _0xe06f8=(_0x3fed03[_0x2db146(0x209)][_0x2db146(0x104)]||_0x2db146(0x1d1))['split'](':'),_0x21ec8c=parseInt(_0xe06f8[0x0])||0x8,_0x4c7670=parseInt(_0xe06f8[0x1])||0x0,_0x2e4a0a=_0x4c7670+'\x20'+_0x21ec8c+_0x2db146(0x143);_0x3fed03[_0x2db146(0xb7)]=schedule[_0x2db146(0x131)](_0x2e4a0a,()=>{sendMorningBriefing(_0x3fed03);});}catch(_0x488d91){_0x3fed03[_0x2db146(0x10b)][_0x2db146(0x11b)](_0x2db146(0xc0)+_0x488d91[_0x2db146(0x178)]);}}async function runBaselineDriftAnalysis(_0x3a1b19){const _0x3bf4ff=a0_0x4ea597;if(!_0x3a1b19[_0x3bf4ff(0x1f7)]||!_0x3a1b19['geminiModel'])return;const _0x47d9bb=_0x3a1b19[_0x3bf4ff(0x209)][_0x3bf4ff(0x147)]||0xe;if(_0x3a1b19['dailyDigests'][_0x3bf4ff(0x1d6)]<_0x47d9bb+0x7){await _0x3a1b19[_0x3bf4ff(0xcf)](LTM_DP_DRIFT_STATUS,{'val':_0x3bf4ff(0xf7),'ack':!![]});return;}const _0xd99e42=_0x3a1b19[_0x3bf4ff(0x1bd)]['slice'](-_0x47d9bb),_0x2c8f52=_0x3a1b19[_0x3bf4ff(0x1bd)]['slice'](0x0,_0x3a1b19[_0x3bf4ff(0x1bd)][_0x3bf4ff(0x1d6)]-_0x47d9bb),_0x4b939f=_0x3bf4ff(0xb2)+JSON[_0x3bf4ff(0x1f4)](_0x2c8f52)+_0x3bf4ff(0x14c)+JSON['stringify'](_0xd99e42);try{const _0x4e336d=await _0x3a1b19[_0x3bf4ff(0x141)][_0x3bf4ff(0xd0)](_0x4b939f),_0x54d611=JSON[_0x3bf4ff(0xb4)](_0x4e336d[_0x3bf4ff(0x10e)]['text']()[_0x3bf4ff(0xcd)](/```json|```/g,'')[_0x3bf4ff(0x25c)]());_0x54d611['baselineDrift']&&(await _0x3a1b19[_0x3bf4ff(0xcf)](LTM_DP_DRIFT_STATUS,{'val':_0x54d611['baselineDrift'],'ack':!![]}),await _0x3a1b19[_0x3bf4ff(0xcf)](LTM_DP_DRIFT_DETAILS,{'val':_0x54d611[_0x3bf4ff(0x1fb)],'ack':!![]}),await _0x3a1b19[_0x3bf4ff(0xcf)](LTM_DP_DRIFT_LAST_CHECK,{'val':Date[_0x3bf4ff(0xe1)](),'ack':!![]}));}catch(_0x558a46){}}class CogniLiving extends utils[a0_0x4ea597(0x1b8)]{constructor(_0x497543){const _0x1f1a47=a0_0x4ea597;super({..._0x497543,'name':'cogni-living'}),this[_0x1f1a47(0x1a5)]=[],this[_0x1f1a47(0x1b2)]=[],this[_0x1f1a47(0x150)]=[],this[_0x1f1a47(0x1bd)]=[],this[_0x1f1a47(0x1ca)]={},this[_0x1f1a47(0x1d3)]={'latitude':0x0,'longitude':0x0,'city':''},this[_0x1f1a47(0x1ee)]=!![],this[_0x1f1a47(0x129)]=null,this[_0x1f1a47(0x19b)]=null,this[_0x1f1a47(0x264)]=![],this[_0x1f1a47(0x24d)]=null,this[_0x1f1a47(0x141)]=null,this['currentSystemMode']=SYSTEM_MODES[_0x1f1a47(0x21d)],this[_0x1f1a47(0x1f7)]=![],this['lastAlertState']=![],this[_0x1f1a47(0x240)]=_0x1f1a47(0x1a0),this['analysisTimer']=null,this['ltmJob']=null,this['modeResetJob']=null,this[_0x1f1a47(0x1ef)]=null,this[_0x1f1a47(0xb7)]=null,this[_0x1f1a47(0xb1)]=null,this['dependencyInstallInProgress']=![],this['on'](_0x1f1a47(0x13b),this[_0x1f1a47(0x205)][_0x1f1a47(0xfa)](this)),this['on']('stateChange',this['onStateChange']['bind'](this)),this['on'](_0x1f1a47(0x254),this[_0x1f1a47(0x23d)][_0x1f1a47(0xfa)](this)),this['on'](_0x1f1a47(0x178),this[_0x1f1a47(0xd9)][_0x1f1a47(0xfa)](this));}async[a0_0x4ea597(0x205)](){const _0x104db2=a0_0x4ea597;this[_0x104db2(0x10b)][_0x104db2(0x180)]('cogni-living\x20adapter\x20starting\x20(v'+this[_0x104db2(0x265)]+_0x104db2(0x13c));if(!checkAndInstall(this))return;await startSystem(this);}[a0_0x4ea597(0x23d)](_0x910409){const _0x4f336a=a0_0x4ea597;if(this[_0x4f336a(0x1ff)])clearInterval(this[_0x4f336a(0x1ff)]);if(this[_0x4f336a(0x1ef)])clearInterval(this[_0x4f336a(0x1ef)]);if(this[_0x4f336a(0x120)])this[_0x4f336a(0x120)][_0x4f336a(0x17f)]();if(this[_0x4f336a(0x1c6)])this['modeResetJob']['cancel']();if(this[_0x4f336a(0xb7)])this[_0x4f336a(0xb7)][_0x4f336a(0x17f)]();if(this['exitTimer'])clearTimeout(this[_0x4f336a(0x129)]);if(this['exitGraceTimer'])clearTimeout(this[_0x4f336a(0x19b)]);stopPythonService(this),_0x910409();}async['onStateChange'](_0x3c3bae,_0x268a1b){const _0x44a232=a0_0x4ea597;if(!_0x268a1b||this[_0x44a232(0xd8)])return;if(_0x3c3bae[_0x44a232(0x215)](_0x44a232(0x211))&&_0x3c3bae[_0x44a232(0x1c3)](_0x44a232(0x167))&&_0x268a1b[_0x44a232(0xd4)]){await handleTelegramResponse(this,_0x268a1b[_0x44a232(0xd4)]);return;}if(_0x3c3bae===this[_0x44a232(0x226)]+'.'+SYSTEM_DP_MODE){if(_0x268a1b[_0x44a232(0xd4)]&&Object[_0x44a232(0xa3)](SYSTEM_MODES)[_0x44a232(0x215)](_0x268a1b[_0x44a232(0xd4)])){this[_0x44a232(0xf0)]=_0x268a1b['val'];if(_0x268a1b['val']===SYSTEM_MODES['VACATION'])await setPresence(this,![]);else await setPresence(this,!![]);}if(!_0x268a1b[_0x44a232(0xa8)])this[_0x44a232(0xdf)](_0x3c3bae,{'val':this[_0x44a232(0xf0)],'ack':!![]});return;}if(!_0x268a1b[_0x44a232(0xa8)]){_0x3c3bae[_0x44a232(0x215)](_0x44a232(0x12d))&&_0x268a1b[_0x44a232(0xd4)]&&(this[_0x44a232(0xdf)](_0x3c3bae,{'val':![],'ack':!![]}),runGeminiAnalysis(this));if(_0x3c3bae[_0x44a232(0x215)](_0x44a232(0x175))&&_0x268a1b['val']){this[_0x44a232(0xdf)](_0x3c3bae,{'val':![],'ack':!![]});if(this[_0x44a232(0x1f7)])createDailyDigest(this);}_0x3c3bae[_0x44a232(0x215)](_0x44a232(0x1dc))&&_0x268a1b['val']&&(this[_0x44a232(0xdf)](_0x3c3bae,{'val':![],'ack':!![]}),sendMorningBriefing(this));_0x3c3bae[_0x44a232(0x215)](_0x44a232(0x12e))&&_0x268a1b[_0x44a232(0xd4)]&&(this[_0x44a232(0xdf)](_0x3c3bae,{'val':![],'ack':!![]}),executeAutomationAction(this));if(_0x3c3bae[_0x44a232(0x215)](_0x44a232(0x243))&&_0x268a1b[_0x44a232(0xd4)]){this[_0x44a232(0xdf)](_0x3c3bae,{'val':![],'ack':!![]});if(this[_0x44a232(0x1f7)])try{const _0x2bb40a=await this['getStateAsync'](_0x44a232(0x146));if(_0x2bb40a&&_0x2bb40a[_0x44a232(0xd4)]){const _0x49807a=JSON[_0x44a232(0xb4)](_0x2bb40a[_0x44a232(0xd4)]);this[_0x44a232(0x10b)][_0x44a232(0x180)](_0x44a232(0x1b4)),this['setStateAsync']('analysis.training.status',{'val':_0x44a232(0x1bf),'ack':!![]}),sendToPython(this,_0x44a232(0x1e8),{'sequences':_0x49807a});}}catch(_0x454858){this[_0x44a232(0x10b)][_0x44a232(0x11b)](_0x44a232(0xc1)+_0x454858['message']);}}if(_0x3c3bae[_0x44a232(0x215)](_0x44a232(0x108))&&_0x268a1b[_0x44a232(0xd4)]){this['setState'](_0x3c3bae,{'val':![],'ack':!![]});if(this[_0x44a232(0x1f7)])try{const _0x549da5=await this[_0x44a232(0x244)](LTM_DP_DAILY_DIGESTS);if(_0x549da5&&_0x549da5[_0x44a232(0xd4)])sendToPython(this,_0x44a232(0x232),{'digests':JSON[_0x44a232(0xb4)](_0x549da5[_0x44a232(0xd4)])});}catch(_0x6c2eeb){}}if(_0x3c3bae['includes'](_0x44a232(0xec))&&_0x268a1b['val']){this[_0x44a232(0xdf)](_0x3c3bae,{'val':![],'ack':!![]});if(this[_0x44a232(0x1f7)])try{const _0x35d95d=await this['getStateAsync'](_0x44a232(0x210));if(_0x35d95d&&_0x35d95d[_0x44a232(0xd4)])sendToPython(this,_0x44a232(0x251),{'points':JSON['parse'](_0x35d95d[_0x44a232(0xd4)])});}catch(_0x38fa5a){}}if(_0x3c3bae[_0x44a232(0x215)](_0x44a232(0x19e))&&_0x268a1b[_0x44a232(0xd4)]){this['setState'](_0x3c3bae,{'val':![],'ack':!![]});if(this[_0x44a232(0x1f7)])try{const _0x3e40b2=await this[_0x44a232(0x244)](LTM_DP_RAW_LOG);_0x3e40b2&&_0x3e40b2[_0x44a232(0xd4)]&&(this['log'][_0x44a232(0x180)]('üõãÔ∏è\x20Triggering\x20Comfort\x20Analysis\x20(Pattern\x20Mining)...'),sendToPython(this,_0x44a232(0x239),{'events':JSON['parse'](_0x3e40b2[_0x44a232(0xd4)])}));}catch(_0x5e909b){}}if(_0x3c3bae[_0x44a232(0x215)](_0x44a232(0x140))&&_0x268a1b[_0x44a232(0xd4)]){this['setState'](_0x3c3bae,{'val':![],'ack':!![]});if(this[_0x44a232(0x1f7)])try{const _0x42a994=await this[_0x44a232(0x244)]('LTM.trainingData.sequences');if(_0x42a994&&_0x42a994[_0x44a232(0xd4)]){const _0x5ef8d0=JSON[_0x44a232(0xb4)](_0x42a994[_0x44a232(0xd4)]);this[_0x44a232(0x10b)]['info'](_0x44a232(0x10a)),sendToPython(this,_0x44a232(0xc7),{'sequences':_0x5ef8d0});}}catch(_0x553901){this['log'][_0x44a232(0x11b)](_0x44a232(0x1a2)+_0x553901[_0x44a232(0x178)]);}}return;}if(this[_0x44a232(0x209)][_0x44a232(0xff)]&&this[_0x44a232(0x209)][_0x44a232(0xff)][_0x44a232(0x215)](_0x3c3bae)){await checkWifiPresence(this);return;}const _0xd33b45=(this[_0x44a232(0x209)][_0x44a232(0x10c)]||[])[_0x44a232(0x116)](_0xc6cc22=>_0xc6cc22['id']===_0x3c3bae);if(_0xd33b45)processSensorEvent(this,_0x3c3bae,_0x268a1b,_0xd33b45);}async[a0_0x4ea597(0xd9)](_0x68bb3c){const _0x57e44b=a0_0x4ea597;if(typeof _0x68bb3c==='object'&&_0x68bb3c['message']){if(_0x68bb3c[_0x57e44b(0x109)]===_0x57e44b(0x165)){const _0xc5d416=_0x68bb3c['message'][_0x57e44b(0x256)]||this['config'][_0x57e44b(0x263)];if(!_0xc5d416)return this['sendTo'](_0x68bb3c[_0x57e44b(0x22b)],_0x68bb3c[_0x57e44b(0x109)],{'success':![],'message':'Kein\x20API\x20Key.'},_0x68bb3c[_0x57e44b(0xae)]);try{const _0x2de7c9=new GoogleGenerativeAI(_0xc5d416),_0x4af7ce=_0x2de7c9[_0x57e44b(0x1aa)]({'model':GEMINI_MODEL}),_0x3b0c94=await _0x4af7ce[_0x57e44b(0xd0)]('Hi');this[_0x57e44b(0x154)](_0x68bb3c[_0x57e44b(0x22b)],_0x68bb3c[_0x57e44b(0x109)],{'success':!![],'message':_0x57e44b(0x190)+_0x3b0c94[_0x57e44b(0x10e)]['text']()},_0x68bb3c[_0x57e44b(0xae)]);}catch(_0x30bb8b){this[_0x57e44b(0x154)](_0x68bb3c[_0x57e44b(0x22b)],_0x68bb3c['command'],{'success':![],'message':_0x57e44b(0x266)+_0x30bb8b[_0x57e44b(0x178)]},_0x68bb3c[_0x57e44b(0xae)]);}}else{if(_0x68bb3c['command']==='testContext'){const _0x34b03f=await getWeatherContext(this),_0x1f6e83=await getCalendarContext(this);this[_0x57e44b(0x154)](_0x68bb3c['from'],_0x68bb3c[_0x57e44b(0x109)],{'success':!![],'weather':_0x34b03f,'calendar':_0x1f6e83},_0x68bb3c['callback']);}else{if(_0x68bb3c[_0x57e44b(0x109)]===_0x57e44b(0x1bc)){if(!this[_0x57e44b(0x1f7)])return this[_0x57e44b(0x154)](_0x68bb3c[_0x57e44b(0x22b)],_0x68bb3c[_0x57e44b(0x109)],{'success':![],'isPro':![]},_0x68bb3c[_0x57e44b(0xae)]);let _0x53f08c={'status':_0x57e44b(0x21b)};try{const _0x1c427e=await this['getStateAsync'](LTM_DP_DRIFT_STATUS);_0x53f08c['status']=_0x1c427e?_0x1c427e[_0x57e44b(0xd4)]:_0x57e44b(0x21b);}catch(_0x15f5e5){}this[_0x57e44b(0x154)](_0x68bb3c[_0x57e44b(0x22b)],_0x68bb3c[_0x57e44b(0x109)],{'success':!![],'isPro':!![],'dailyDigests':this[_0x57e44b(0x1bd)],'driftAnalysis':_0x53f08c,'analysisHistory':this['analysisHistory']},_0x68bb3c[_0x57e44b(0xae)]);}else{if(_0x68bb3c[_0x57e44b(0x109)]===_0x57e44b(0xdd)){const _0x3681ab=this[_0x57e44b(0x1bd)][_0x57e44b(0x1d6)],_0x4f7f6e=new Date(),_0xf84023=new Date(_0x4f7f6e[_0x57e44b(0x231)](),_0x4f7f6e[_0x57e44b(0x15a)](),_0x4f7f6e[_0x57e44b(0x242)]())['getTime'](),_0x490699=this[_0x57e44b(0x150)][_0x57e44b(0x1be)](_0x4ec471=>new Date(_0x4ec471[_0x57e44b(0x1ec)])[_0x57e44b(0x20d)]()>_0xf84023)[_0x57e44b(0x1d6)],_0x15b75b=new Array(0x18)[_0x57e44b(0x235)](0x0);this['rawEventLog']['forEach'](_0x274f4b=>{const _0x16791c=_0x57e44b,_0x511572=new Date(_0x274f4b['timestamp']);if(_0x511572[_0x16791c(0x20d)]()>_0xf84023)_0x15b75b[_0x511572[_0x16791c(0x216)]()]++;});let _0x29cd99={'status':_0x57e44b(0x21b)};try{const _0x108ff2=await this['getStateAsync'](LTM_DP_DRIFT_STATUS);_0x29cd99[_0x57e44b(0x203)]=_0x108ff2?_0x108ff2[_0x57e44b(0xd4)]:_0x57e44b(0x21b);}catch(_0x2700e4){}let _0x4ae8ce='';try{const _0xd267a8=await this['getStateAsync'](_0x57e44b(0x16d));_0x4ae8ce=_0xd267a8?_0xd267a8[_0x57e44b(0xd4)]:'';}catch(_0x4efa60){}let _0x2b2278=null;!this[_0x57e44b(0x141)]&&(_0x2b2278=this['config']['geminiApiKey']?_0x57e44b(0xbc):'Kein\x20API\x20Key!');let _0xa554e3={'detected':![],'description':'','targetId':'','targetValue':'','autoApply':![]};try{const _0x2f8257=await this[_0x57e44b(0x244)](_0x57e44b(0x1c8));if(_0x2f8257&&_0x2f8257[_0x57e44b(0xd4)]){_0xa554e3[_0x57e44b(0x253)]=!![];const _0x5a7597=await this[_0x57e44b(0x244)]('analysis.automation.description');_0xa554e3[_0x57e44b(0x13e)]=_0x5a7597?_0x5a7597[_0x57e44b(0xd4)]:'';const _0x576941=await this[_0x57e44b(0x244)](_0x57e44b(0x1c4));_0xa554e3[_0x57e44b(0x101)]=_0x576941?_0x576941[_0x57e44b(0xd4)]:'';const _0x4518bf=await this[_0x57e44b(0x244)](_0x57e44b(0xab));_0xa554e3[_0x57e44b(0x202)]=_0x4518bf?_0x4518bf[_0x57e44b(0xd4)]:'';}const _0x755bb3=await this['getStateAsync'](_0x57e44b(0x112));_0xa554e3[_0x57e44b(0x106)]=_0x755bb3?!!_0x755bb3[_0x57e44b(0xd4)]:![];}catch(_0x7000d4){}this[_0x57e44b(0x154)](_0x68bb3c['from'],_0x68bb3c[_0x57e44b(0x109)],{'success':!![],'eventHistory':this['eventHistory'][_0x57e44b(0xf6)](0x0,0xf),'stats':{'digestCount':_0x3681ab,'eventCountToday':_0x490699,'hourlyActivity':_0x15b75b,'driftStatus':_0x29cd99[_0x57e44b(0x203)],'isPresent':this[_0x57e44b(0x1ee)],'presenceWho':_0x4ae8ce,'minDays':this[_0x57e44b(0x209)][_0x57e44b(0x122)]||0x7,'stbDays':this[_0x57e44b(0x209)][_0x57e44b(0x147)]||0xe,'ltbDays':this[_0x57e44b(0x209)][_0x57e44b(0x164)]||0x3c,'systemError':_0x2b2278},'automation':_0xa554e3},_0x68bb3c[_0x57e44b(0xae)]);}else{if(_0x68bb3c['command']===_0x57e44b(0x198))try{const _0x4f37d0=await scanForDevices(this,_0x68bb3c[_0x57e44b(0x178)]||{});this['sendTo'](_0x68bb3c['from'],_0x68bb3c['command'],{'success':!![],'devices':_0x4f37d0},_0x68bb3c['callback']);}catch(_0xb2432a){this['sendTo'](_0x68bb3c['from'],_0x68bb3c[_0x57e44b(0x109)],{'success':![],'error':_0xb2432a[_0x57e44b(0x178)]},_0x68bb3c['callback']);}else{if(_0x68bb3c[_0x57e44b(0x109)]===_0x57e44b(0x1ab)){const _0x5d4afc=await this[_0x57e44b(0x1b9)](_0x57e44b(0x107),_0x57e44b(0x136)),_0xb0f4c7=[];if(_0x5d4afc)for(const _0x11e263 in _0x5d4afc){const _0x526394=_0x5d4afc[_0x11e263],_0x6218c5=(_0x526394[_0x57e44b(0xfb)]&&typeof _0x526394[_0x57e44b(0xfb)]['name']===_0x57e44b(0x145)?_0x526394[_0x57e44b(0xfb)][_0x57e44b(0x241)]['de']:_0x526394[_0x57e44b(0xfb)]['name'])||_0x526394['common'][_0x57e44b(0x241)];_0xb0f4c7['push']({'id':_0x11e263,'name':_0x6218c5});}const _0x2cc111=await this['getForeignObjectsAsync']('enum.rooms.*',_0x57e44b(0x136)),_0x49cf36=[];if(_0x2cc111)for(const _0x192c83 in _0x2cc111){const _0x140bb6=_0x2cc111[_0x192c83],_0x57b2ff=(_0x140bb6[_0x57e44b(0xfb)]&&typeof _0x140bb6[_0x57e44b(0xfb)][_0x57e44b(0x241)]==='object'?_0x140bb6[_0x57e44b(0xfb)][_0x57e44b(0x241)]['de']:_0x140bb6['common'][_0x57e44b(0x241)])||_0x192c83[_0x57e44b(0x9f)]('.')[_0x57e44b(0x182)]();_0x49cf36[_0x57e44b(0x1c5)](_0x57b2ff);}this[_0x57e44b(0x154)](_0x68bb3c['from'],_0x68bb3c[_0x57e44b(0x109)],{'success':!![],'enums':_0xb0f4c7,'rooms':_0x49cf36},_0x68bb3c['callback']);}else{if(_0x68bb3c[_0x57e44b(0x109)]==='getCalendarNames'){const _0x139113=_0x68bb3c[_0x57e44b(0x178)][_0x57e44b(0x1a8)];if(!_0x139113)return this['sendTo'](_0x68bb3c['from'],_0x68bb3c['command'],{'success':![],'error':_0x57e44b(0x257)},_0x68bb3c[_0x57e44b(0xae)]);const _0x3af09b=await getCalendarNames(this,_0x139113);this[_0x57e44b(0x154)](_0x68bb3c[_0x57e44b(0x22b)],_0x68bb3c[_0x57e44b(0x109)],{'success':!![],'names':_0x3af09b},_0x68bb3c['callback']);}else{if(_0x68bb3c[_0x57e44b(0x109)]===_0x57e44b(0x1eb)){const {targetId:_0x2fc6d9,targetValue:_0x4ca1b3}=_0x68bb3c[_0x57e44b(0x178)];this['log']['info'](_0x57e44b(0x23a)+_0x2fc6d9+_0x57e44b(0x155)+_0x4ca1b3),await this['setStateAsync'](_0x57e44b(0x1c8),{'val':!![],'ack':!![]}),await this['setStateAsync']('analysis.automation.description',{'val':_0x57e44b(0x113)+_0x2fc6d9,'ack':!![]}),await this[_0x57e44b(0xcf)]('analysis.automation.targetId',{'val':_0x2fc6d9,'ack':!![]}),await this[_0x57e44b(0xcf)](_0x57e44b(0xab),{'val':_0x4ca1b3,'ack':!![]}),this[_0x57e44b(0x154)](_0x68bb3c[_0x57e44b(0x22b)],_0x68bb3c[_0x57e44b(0x109)],{'success':!![]},_0x68bb3c[_0x57e44b(0xae)]);}else{if(_0x68bb3c[_0x57e44b(0x109)]===_0x57e44b(0x16f)){const {historyId:_0x32b915,rating:_0x23e84b,comment:_0x102042,alertReason:_0x6b777a}=_0x68bb3c[_0x57e44b(0x178)];_0x32b915&&_0x23e84b?(await saveFeedback(this,{'timestamp':Date[_0x57e44b(0xe1)](),'historyId':_0x32b915,'rating':_0x23e84b,'comment':_0x102042,'alertReason':_0x6b777a}),this[_0x57e44b(0x154)](_0x68bb3c[_0x57e44b(0x22b)],_0x68bb3c[_0x57e44b(0x109)],{'success':!![]},_0x68bb3c[_0x57e44b(0xae)])):this[_0x57e44b(0x154)](_0x68bb3c[_0x57e44b(0x22b)],_0x68bb3c['command'],{'success':![],'error':_0x57e44b(0x151)},_0x68bb3c['callback']);}else _0x68bb3c[_0x57e44b(0x109)]===_0x57e44b(0xe9)&&(this[_0x57e44b(0x10b)][_0x57e44b(0x180)]('User\x20dismissed\x20automation\x20proposal.'),await this[_0x57e44b(0xcf)](_0x57e44b(0x1c8),{'val':![],'ack':!![]}),await this[_0x57e44b(0xcf)](_0x57e44b(0x223),{'val':'','ack':!![]}),this[_0x57e44b(0x154)](_0x68bb3c['from'],_0x68bb3c[_0x57e44b(0x109)],{'success':!![]},_0x68bb3c[_0x57e44b(0xae)]));}}}}}}}}}}}if(require[a0_0x4ea597(0x245)]!==module)module[a0_0x4ea597(0x1b0)]=_0xa31fbc=>new CogniLiving(_0xa31fbc);else new CogniLiving();