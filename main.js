const a0_0x254785=a0_0x191b;(function(_0x419901,_0x414086){const _0x294ca8=a0_0x191b,_0x48bb64=_0x419901();while(!![]){try{const _0x41518b=parseInt(_0x294ca8(0x125))/0x1*(-parseInt(_0x294ca8(0x24d))/0x2)+parseInt(_0x294ca8(0x1ae))/0x3*(-parseInt(_0x294ca8(0x140))/0x4)+-parseInt(_0x294ca8(0x249))/0x5+-parseInt(_0x294ca8(0x115))/0x6*(parseInt(_0x294ca8(0x17c))/0x7)+parseInt(_0x294ca8(0x136))/0x8+-parseInt(_0x294ca8(0x147))/0x9*(-parseInt(_0x294ca8(0x16e))/0xa)+parseInt(_0x294ca8(0x171))/0xb;if(_0x41518b===_0x414086)break;else _0x48bb64['push'](_0x48bb64['shift']());}catch(_0x3f43c7){_0x48bb64['push'](_0x48bb64['shift']());}}}(a0_0xe2a2,0x65f56));const a0_0x340613=(function(){let _0x363b79=!![];return function(_0x1cde3d,_0x1cc275){const _0x4eca1a=_0x363b79?function(){const _0x29a5ae=a0_0x191b;if(_0x1cc275){const _0x31425b=_0x1cc275[_0x29a5ae(0x1b9)](_0x1cde3d,arguments);return _0x1cc275=null,_0x31425b;}}:function(){};return _0x363b79=![],_0x4eca1a;};}()),a0_0x338bcf=a0_0x340613(this,function(){const _0x242d45=a0_0x191b;return a0_0x338bcf['toString']()[_0x242d45(0x15e)](_0x242d45(0xf4))[_0x242d45(0x170)]()[_0x242d45(0x236)](a0_0x338bcf)['search'](_0x242d45(0xf4));});a0_0x338bcf();'use strict';const utils=require(a0_0x254785(0x121)),{GoogleGenerativeAI}=require(a0_0x254785(0x223)),schedule=require('node-schedule'),{spawn,exec}=require(a0_0x254785(0x144)),path=require(a0_0x254785(0x1bd)),fs=require('fs'),HISTORY_MAX_SIZE=0x32,RAW_LOG_MAX_SIZE=0x5dc,LTM_MIN_EVENTS_FOR_COMPRESSION=0x5,GEMINI_MODEL=a0_0x254785(0x239),LTM_SCHEDULE=a0_0x254785(0x120),MODE_RESET_SCHEDULE=a0_0x254785(0x1d5),SEQUENCE_TIMEOUT_MS=0x5*0x3c*0x3e8,MAX_TRAINING_SET_SIZE=0x1f4,THERMO_LOG_SIZE=0x3e8,ANALYSIS_HISTORY_MAX_SIZE=0x64,EXIT_TIMER_MINUTES=0xf,EXIT_GRACE_PERIOD_SECONDS=0x1e,LTM_DP_RAW_LOG='LTM.rawEventLog',LTM_DP_DAILY_DIGESTS='LTM.dailyDigests',LTM_DP_STATUS=a0_0x254785(0x181),LTM_DP_TRIGGER_DIGEST=a0_0x254785(0x178),LTM_DP_BASELINE_STATUS=a0_0x254785(0x184),LTM_DP_DRIFT_CHANNEL=a0_0x254785(0x17d),LTM_DP_DRIFT_STATUS='LTM.driftAnalysis.baselineDrift',LTM_DP_DRIFT_DETAILS=a0_0x254785(0x24a),LTM_DP_DRIFT_LAST_CHECK='LTM.driftAnalysis.lastCheck',SYSTEM_DP_MODE=a0_0x254785(0x207),SYSTEM_MODES={'NORMAL':'normal','VACATION':a0_0x254785(0x206),'PARTY':'party','GUEST':a0_0x254785(0x12a)},AUTO_RESET_MODES=[SYSTEM_MODES[a0_0x254785(0x210)],SYSTEM_MODES[a0_0x254785(0x21d)]],PERSONA_MAPPING={'generic':a0_0x254785(0x1fc),'senior_aal':a0_0x254785(0x273),'family':a0_0x254785(0x1bc),'single_comfort':a0_0x254785(0x167),'security':a0_0x254785(0x14b)},ACTIVITY_LEVEL_MAP={'sehr\x20hoch':0x64,'hoch':0x50,'normal':0x3c,'niedrig':0x28,'sehr\x20niedrig':0x14,'inaktiv':0x0},HARD_IGNORE_TERMS=[a0_0x254785(0x256),'scriptEnabled','update','unreach',a0_0x254785(0x168),a0_0x254785(0x257),a0_0x254785(0x146),'maintenance','error','fault','working',a0_0x254785(0x1f7),'stick_unreach','config_pending',a0_0x254785(0x24c),'firmware',a0_0x254785(0x232),a0_0x254785(0x165)],BAD_NAMES=[a0_0x254785(0x1d0),a0_0x254785(0x1d9),a0_0x254785(0x26c),a0_0x254785(0x1b2),a0_0x254785(0x1f1),'brightness','on',a0_0x254785(0x21a),'switch',a0_0x254785(0x272),a0_0x254785(0x1fa),a0_0x254785(0x1eb),a0_0x254785(0x1d7),a0_0x254785(0x1cd),'motion','presence',a0_0x254785(0x266),a0_0x254785(0x1b5),a0_0x254785(0xec),a0_0x254785(0xf5),a0_0x254785(0x274),a0_0x254785(0x1c5),'valve',a0_0x254785(0x22f),a0_0x254785(0x1f9)],ADAPTER_BLACKLIST=[a0_0x254785(0x235),'admin.',a0_0x254785(0x22d),a0_0x254785(0x201),'history.',a0_0x254785(0x247),a0_0x254785(0xf7),a0_0x254785(0x1e6),a0_0x254785(0x225),a0_0x254785(0x23b),'simple-api.'],IS_WIN=process[a0_0x254785(0x26b)]===a0_0x254785(0x1f3),VENV_PATH=path[a0_0x254785(0x141)](__dirname,a0_0x254785(0x10d)),PYTHON_EXE=IS_WIN?path['join'](VENV_PATH,'Scripts',a0_0x254785(0x1f2)):path[a0_0x254785(0x141)](VENV_PATH,a0_0x254785(0xfc),a0_0x254785(0x14f)),PIP_EXE=IS_WIN?path[a0_0x254785(0x141)](VENV_PATH,a0_0x254785(0x1ce),a0_0x254785(0x204)):path[a0_0x254785(0x141)](VENV_PATH,a0_0x254785(0xfc),a0_0x254785(0x16c));let activeSequence=[],sequenceTimer=null,installAttemptCount=0x0;async function initZombies(_0x602e7a){const _0x5c605b=a0_0x254785;try{const _0x4047fc=[_0x5c605b(0x124),_0x5c605b(0x186)];for(const _0x122edf of _0x4047fc){try{const _0x2ac389=await _0x602e7a[_0x5c605b(0x1cc)](_0x122edf);if(_0x2ac389)await _0x602e7a[_0x5c605b(0x19d)](_0x122edf);}catch(_0x274d02){}}}catch(_0x467597){}}async function initHistory(_0x565b63){const _0x3d0d3b=a0_0x254785;try{const _0x4509a0=await _0x565b63['getStateAsync'](_0x3d0d3b(0x11f));_0x4509a0&&_0x4509a0[_0x3d0d3b(0x187)]&&(_0x565b63[_0x3d0d3b(0x1c9)]=JSON[_0x3d0d3b(0x17a)](_0x4509a0[_0x3d0d3b(0x187)][_0x3d0d3b(0x170)]()));}catch(_0x5a19bc){_0x565b63[_0x3d0d3b(0x1c9)]=[];}try{const _0x8d1057=await _0x565b63[_0x3d0d3b(0x248)](_0x3d0d3b(0x169));if(_0x8d1057&&_0x8d1057['val'])_0x565b63[_0x3d0d3b(0x11a)]=JSON[_0x3d0d3b(0x17a)](_0x8d1057[_0x3d0d3b(0x187)][_0x3d0d3b(0x170)]());}catch(_0x45acc8){_0x565b63[_0x3d0d3b(0x11a)]=[];}if(_0x565b63['eventHistory']&&_0x565b63['eventHistory'][_0x3d0d3b(0x11d)]>0x0){_0x565b63[_0x3d0d3b(0x1fe)][_0x3d0d3b(0x14e)](_0x3d0d3b(0x1c0)+_0x565b63['eventHistory']['length']+_0x3d0d3b(0x15c));for(let _0x1dba70=_0x565b63['eventHistory'][_0x3d0d3b(0x11d)]-0x1;_0x1dba70>=0x0;_0x1dba70--){const _0x7e2cbb=_0x565b63[_0x3d0d3b(0x1c9)][_0x1dba70];if(_0x7e2cbb&&_0x7e2cbb['id']!==undefined&&_0x7e2cbb[_0x3d0d3b(0x1f1)]!==undefined)_0x565b63[_0x3d0d3b(0x1ea)][_0x7e2cbb['id']]=_0x7e2cbb[_0x3d0d3b(0x1f1)];}}}async function initSystemConfig(_0x2910ae){const _0x4b36bd=a0_0x254785;try{const _0x129d2d=await _0x2910ae[_0x4b36bd(0x1a4)](_0x4b36bd(0x268));if(_0x129d2d&&_0x129d2d[_0x4b36bd(0x258)])_0x2910ae[_0x4b36bd(0x240)]={'latitude':_0x129d2d[_0x4b36bd(0x258)][_0x4b36bd(0xee)]||0x0,'longitude':_0x129d2d['common'][_0x4b36bd(0x180)]||0x0,'city':_0x129d2d[_0x4b36bd(0x258)][_0x4b36bd(0xfd)]||''};}catch(_0x3cda1b){}}async function checkLicense(_0x1fff02,_0x36f314){return!![];}async function getSystemUUID(_0x2e8225){const _0x28ec7d=a0_0x254785;return _0x28ec7d(0x1b1);}async function loadRawEventLog(_0x51ca83){const _0x46946b=a0_0x254785;try{const _0x3059fc=await _0x51ca83['getStateAsync'](LTM_DP_RAW_LOG);if(_0x3059fc&&_0x3059fc[_0x46946b(0x187)])_0x51ca83['rawEventLog']=JSON[_0x46946b(0x17a)](_0x3059fc['val']);}catch(_0x4ecda3){_0x51ca83['rawEventLog']=[];}}async function saveRawEventLog(_0x3a39e8){const _0x599e0c=a0_0x254785;if(_0x3a39e8[_0x599e0c(0x1a5)][_0x599e0c(0x11d)]>RAW_LOG_MAX_SIZE)_0x3a39e8[_0x599e0c(0x1a5)][_0x599e0c(0x1f5)](0x0,_0x3a39e8[_0x599e0c(0x1a5)][_0x599e0c(0x11d)]-RAW_LOG_MAX_SIZE);await _0x3a39e8[_0x599e0c(0x1ad)](LTM_DP_RAW_LOG,{'val':JSON[_0x599e0c(0x20e)](_0x3a39e8[_0x599e0c(0x1a5)]),'ack':!![]});}async function loadDailyDigests(_0x3b6817){const _0x594bf9=a0_0x254785;try{const _0x2f93c2=await _0x3b6817[_0x594bf9(0x248)](LTM_DP_DAILY_DIGESTS);if(_0x2f93c2&&_0x2f93c2[_0x594bf9(0x187)])_0x3b6817[_0x594bf9(0x205)]=JSON[_0x594bf9(0x17a)](_0x2f93c2[_0x594bf9(0x187)]);}catch(_0x47cff7){_0x3b6817[_0x594bf9(0x205)]=[];}await updateBaselineStatus(_0x3b6817);}async function saveDailyDigests(_0x4214b6,_0x28830b=!![]){const _0x4fd77b=a0_0x254785,_0x32f5a3=_0x4214b6['config'][_0x4fd77b(0x1a9)]||0x3c;_0x4214b6[_0x4fd77b(0x205)][_0x4fd77b(0x11d)]>_0x32f5a3&&_0x4214b6[_0x4fd77b(0x205)][_0x4fd77b(0x1f5)](0x0,_0x4214b6[_0x4fd77b(0x205)][_0x4fd77b(0x11d)]-_0x32f5a3);await _0x4214b6[_0x4fd77b(0x1ad)](LTM_DP_DAILY_DIGESTS,{'val':JSON[_0x4fd77b(0x20e)](_0x4214b6[_0x4fd77b(0x205)]),'ack':!![]});if(_0x28830b)await updateBaselineStatus(_0x4214b6);}async function updateAnalysisHistory(_0x30c8d9,_0x5b6849){const _0x35585c=a0_0x254785;_0x30c8d9[_0x35585c(0x11a)][_0x35585c(0x1b0)](_0x5b6849);if(_0x30c8d9['analysisHistory'][_0x35585c(0x11d)]>ANALYSIS_HISTORY_MAX_SIZE)_0x30c8d9[_0x35585c(0x11a)]['pop']();await _0x30c8d9[_0x35585c(0x1ad)](_0x35585c(0x169),{'val':JSON[_0x35585c(0x20e)](_0x30c8d9[_0x35585c(0x11a)]),'ack':!![]});}async function updateBaselineStatus(_0x263bc7){const _0x5f354d=a0_0x254785;if(!_0x263bc7[_0x5f354d(0x19c)]){await _0x263bc7[_0x5f354d(0x1ad)](LTM_DP_BASELINE_STATUS,{'val':_0x5f354d(0x111),'ack':!![]});return;}const _0x3987c6=_0x263bc7[_0x5f354d(0x205)][_0x5f354d(0x11d)]>=(_0x263bc7[_0x5f354d(0x1d3)][_0x5f354d(0x1df)]||0x7)?'Aktiv\x20('+_0x263bc7[_0x5f354d(0x205)][_0x5f354d(0x11d)]+_0x5f354d(0x275):'Lernphase\x20('+_0x263bc7[_0x5f354d(0x205)][_0x5f354d(0x11d)]+'/'+(_0x263bc7[_0x5f354d(0x1d3)][_0x5f354d(0x1df)]||0x7)+')';await _0x263bc7[_0x5f354d(0x1ad)](LTM_DP_BASELINE_STATUS,{'val':_0x3987c6,'ack':!![]});}async function loadSystemMode(_0x3c8784){const _0x226ece=a0_0x254785;try{const _0x492b81=await _0x3c8784[_0x226ece(0x248)](SYSTEM_DP_MODE);_0x492b81&&_0x492b81['val']&&Object[_0x226ece(0x253)](SYSTEM_MODES)['includes'](_0x492b81[_0x226ece(0x187)])?_0x3c8784[_0x226ece(0x153)]=_0x492b81['val']:(_0x3c8784[_0x226ece(0x153)]=SYSTEM_MODES[_0x226ece(0x190)],await _0x3c8784[_0x226ece(0x1ad)](SYSTEM_DP_MODE,{'val':SYSTEM_MODES['NORMAL'],'ack':!![]}));}catch(_0x42f7c0){_0x3c8784['currentSystemMode']=SYSTEM_MODES[_0x226ece(0x190)];}}async function createAllObjects(_0x15d644){const _0x4b4faf=a0_0x254785;await _0x15d644[_0x4b4faf(0x251)](_0x4b4faf(0x139),{'type':'channel','common':{'name':_0x4b4faf(0x15d)},'native':{}}),await _0x15d644[_0x4b4faf(0x251)](SYSTEM_DP_MODE,{'type':'state','common':{'name':_0x4b4faf(0x132),'type':_0x4b4faf(0xed),'role':'state','read':!![],'write':!![],'def':SYSTEM_MODES['NORMAL']},'native':{}}),await _0x15d644['setObjectNotExistsAsync'](_0x4b4faf(0x152),{'type':_0x4b4faf(0x26c),'common':{'name':_0x4b4faf(0x172),'type':_0x4b4faf(0xed),'role':'text','read':!![],'write':![]},'native':{}}),await _0x15d644['setObjectNotExistsAsync'](_0x4b4faf(0x241),{'type':_0x4b4faf(0x26c),'common':{'name':_0x4b4faf(0xf1),'type':_0x4b4faf(0xed),'role':_0x4b4faf(0x155),'read':!![],'write':![]},'native':{}}),await _0x15d644[_0x4b4faf(0x162)](_0x4b4faf(0x11f),{'type':_0x4b4faf(0x26c),'common':{'name':'Event\x20History','type':_0x4b4faf(0xed),'role':_0x4b4faf(0x155),'read':!![],'write':![]},'native':{}}),await _0x15d644[_0x4b4faf(0x251)](_0x4b4faf(0x122),{'type':_0x4b4faf(0x238),'common':{'name':_0x4b4faf(0x226)},'native':{}}),await _0x15d644[_0x4b4faf(0x162)](_0x4b4faf(0x1ac),{'type':'state','common':{'name':_0x4b4faf(0x242),'type':_0x4b4faf(0x106),'role':_0x4b4faf(0x159),'read':!![],'write':!![]},'native':{}}),await _0x15d644[_0x4b4faf(0x162)](_0x4b4faf(0x16d),{'type':_0x4b4faf(0x26c),'common':{'name':'Train\x20Health','type':'boolean','role':_0x4b4faf(0x159),'read':!![],'write':!![]},'native':{}}),await _0x15d644[_0x4b4faf(0x162)](_0x4b4faf(0x16a),{'type':_0x4b4faf(0x26c),'common':{'name':_0x4b4faf(0x1d8),'type':_0x4b4faf(0x106),'role':_0x4b4faf(0x159),'read':!![],'write':!![]},'native':{}}),await _0x15d644[_0x4b4faf(0x162)](_0x4b4faf(0x24b),{'type':_0x4b4faf(0x26c),'common':{'name':_0x4b4faf(0x1ef),'type':_0x4b4faf(0xed),'role':_0x4b4faf(0x1e2),'read':!![],'write':![]},'native':{}}),await _0x15d644[_0x4b4faf(0x251)](_0x4b4faf(0x1e9),{'type':_0x4b4faf(0x238),'common':{'name':_0x4b4faf(0x1fd)},'native':{}}),await _0x15d644[_0x4b4faf(0x162)](_0x4b4faf(0xf8),{'type':_0x4b4faf(0x26c),'common':{'name':_0x4b4faf(0x23e),'type':'number','role':_0x4b4faf(0x1f1),'read':!![],'write':![]},'native':{}}),await _0x15d644['setObjectNotExistsAsync'](_0x4b4faf(0x151),{'type':_0x4b4faf(0x26c),'common':{'name':_0x4b4faf(0x16b),'type':_0x4b4faf(0xed),'role':_0x4b4faf(0x25c),'read':!![],'write':![]},'native':{}}),await _0x15d644[_0x4b4faf(0x251)]('analysis.health',{'type':'channel','common':{'name':_0x4b4faf(0x1f8)},'native':{}}),await _0x15d644[_0x4b4faf(0x162)]('analysis.health.lastCheck',{'type':_0x4b4faf(0x26c),'common':{'name':_0x4b4faf(0x16b),'type':_0x4b4faf(0xed),'role':_0x4b4faf(0x25c),'read':!![],'write':![]},'native':{}}),await _0x15d644[_0x4b4faf(0x162)](_0x4b4faf(0x142),{'type':_0x4b4faf(0x26c),'common':{'name':_0x4b4faf(0x1bf),'type':_0x4b4faf(0x106),'role':'indicator','read':!![],'write':![]},'native':{}}),await _0x15d644['setObjectNotExistsAsync'](_0x4b4faf(0x130),{'type':_0x4b4faf(0x26c),'common':{'name':'Trend','type':_0x4b4faf(0xed),'role':_0x4b4faf(0x1e2),'read':!![],'write':![]},'native':{}}),await _0x15d644[_0x4b4faf(0x162)]('analysis.health.trendValue',{'type':_0x4b4faf(0x26c),'common':{'name':_0x4b4faf(0x1be),'type':_0x4b4faf(0x1fb),'role':'value','read':!![],'write':![]},'native':{}}),await _0x15d644[_0x4b4faf(0x251)](_0x4b4faf(0x128),{'type':_0x4b4faf(0x238),'common':{'name':'Energy\x20Intelligence'},'native':{}}),await _0x15d644[_0x4b4faf(0x162)](_0x4b4faf(0x118),{'type':'state','common':{'name':'Insulation\x20Score','type':_0x4b4faf(0xed),'role':'text','read':!![],'write':![]},'native':{}}),await _0x15d644['setObjectNotExistsAsync'](_0x4b4faf(0x1dd),{'type':_0x4b4faf(0x26c),'common':{'name':_0x4b4faf(0x143),'type':_0x4b4faf(0xed),'role':_0x4b4faf(0x1e2),'read':!![],'write':![]},'native':{}}),await _0x15d644[_0x4b4faf(0x251)](_0x4b4faf(0x262),{'type':_0x4b4faf(0x238),'common':{'name':'LTM'},'native':{}}),await _0x15d644[_0x4b4faf(0x251)](LTM_DP_RAW_LOG,{'type':_0x4b4faf(0x26c),'common':{'name':_0x4b4faf(0xfe),'type':_0x4b4faf(0xed),'role':_0x4b4faf(0x155),'read':!![],'write':![]},'native':{}}),await _0x15d644[_0x4b4faf(0x251)](LTM_DP_DAILY_DIGESTS,{'type':_0x4b4faf(0x26c),'common':{'name':'Daily\x20Digests','type':'string','role':_0x4b4faf(0x155),'read':!![],'write':![]},'native':{}}),await _0x15d644['setObjectNotExistsAsync']('LTM.trainingData.sequences',{'type':_0x4b4faf(0x26c),'common':{'name':_0x4b4faf(0x20d),'type':_0x4b4faf(0xed),'role':'json','read':!![],'write':![]},'native':{}}),await _0x15d644['setObjectNotExistsAsync'](_0x4b4faf(0x16f),{'type':'state','common':{'name':_0x4b4faf(0x188),'type':_0x4b4faf(0xed),'role':_0x4b4faf(0x155),'read':!![],'write':![]},'native':{}}),await _0x15d644[_0x4b4faf(0x162)]('analysis.trigger',{'type':_0x4b4faf(0x26c),'common':{'name':'Trigger\x20Analysis','type':_0x4b4faf(0x106),'role':_0x4b4faf(0x159),'read':!![],'write':!![]},'native':{}}),await _0x15d644[_0x4b4faf(0x162)](_0x4b4faf(0x215),{'type':_0x4b4faf(0x26c),'common':{'name':'Trigger\x20Briefing','type':_0x4b4faf(0x106),'role':'button','read':!![],'write':!![]},'native':{}}),await _0x15d644['setObjectNotExistsAsync']('analysis.isAlert',{'type':_0x4b4faf(0x26c),'common':{'name':_0x4b4faf(0x1e7),'type':_0x4b4faf(0x106),'role':_0x4b4faf(0x1c6),'read':!![],'write':![]},'native':{}}),await _0x15d644[_0x4b4faf(0x162)]('analysis.alertReason',{'type':_0x4b4faf(0x26c),'common':{'name':_0x4b4faf(0x1f6),'type':_0x4b4faf(0xed),'role':'text.alarm','read':!![],'write':![]},'native':{}}),await _0x15d644[_0x4b4faf(0x162)](_0x4b4faf(0xef),{'type':_0x4b4faf(0x26c),'common':{'name':'Activity\x20Summary','type':_0x4b4faf(0xed),'role':_0x4b4faf(0x1e2),'read':!![],'write':![]},'native':{}}),await _0x15d644[_0x4b4faf(0x162)]('analysis.automation.patternDetected',{'type':'state','common':{'name':_0x4b4faf(0x211),'type':_0x4b4faf(0x106),'role':'indicator','read':!![],'write':![]},'native':{}}),await _0x15d644[_0x4b4faf(0x162)]('analysis.automation.description',{'type':'state','common':{'name':'Description','type':_0x4b4faf(0xed),'role':_0x4b4faf(0x1e2),'read':!![],'write':![]},'native':{}}),await _0x15d644[_0x4b4faf(0x162)](_0x4b4faf(0x160),{'type':'state','common':{'name':'Target\x20ID','type':_0x4b4faf(0xed),'role':_0x4b4faf(0x1e2),'read':!![],'write':![]},'native':{}}),await _0x15d644[_0x4b4faf(0x162)](_0x4b4faf(0x19b),{'type':_0x4b4faf(0x26c),'common':{'name':_0x4b4faf(0x25d),'type':'string','role':_0x4b4faf(0x1e2),'read':!![],'write':![]},'native':{}}),await _0x15d644[_0x4b4faf(0x162)]('analysis.automation.autoApply',{'type':'state','common':{'name':_0x4b4faf(0x1c3),'type':'boolean','role':_0x4b4faf(0x1c7),'read':!![],'write':!![]},'native':{}}),await _0x15d644[_0x4b4faf(0x162)](_0x4b4faf(0x198),{'type':_0x4b4faf(0x26c),'common':{'name':_0x4b4faf(0x133),'type':_0x4b4faf(0x106),'role':'button','read':!![],'write':!![]},'native':{}});}async function recordThermodynamics(_0x2e5966,_0x2f4157,_0x530999,_0xb49db6){const _0x29b97a=a0_0x254785,_0x1bbb03=await getOutsideTemperatureNumeric(_0x2e5966),_0x50dd4b=await _0x2e5966[_0x29b97a(0x248)]('LTM.trainingData.thermodynamics');let _0x5e3309=[];if(_0x50dd4b&&_0x50dd4b[_0x29b97a(0x187)])try{_0x5e3309=JSON['parse'](_0x50dd4b[_0x29b97a(0x187)]);}catch(_0x28325d){}_0x5e3309[_0x29b97a(0x277)]({'ts':Date['now'](),'room':_0xb49db6||'Unknown','t_in':_0x530999,'t_out':_0x1bbb03});if(_0x5e3309[_0x29b97a(0x11d)]>THERMO_LOG_SIZE)_0x5e3309['shift']();await _0x2e5966['setStateAsync']('LTM.trainingData.thermodynamics',{'val':JSON[_0x29b97a(0x20e)](_0x5e3309),'ack':!![]});}async function getOutsideTemperatureNumeric(_0x5ad913){const _0x4c01b7=a0_0x254785;if(_0x5ad913[_0x4c01b7(0x1d3)][_0x4c01b7(0x227)])try{const _0x564212=await _0x5ad913[_0x4c01b7(0x1e4)](_0x5ad913[_0x4c01b7(0x1d3)][_0x4c01b7(0x227)]);if(_0x564212&&_0x564212['val']!==undefined&&_0x564212[_0x4c01b7(0x187)]!==null)return parseFloat(_0x564212[_0x4c01b7(0x187)]);}catch(_0x345d50){}const _0x3238ca=_0x5ad913['config']['weatherInstance'];if(!_0x5ad913[_0x4c01b7(0x1d3)][_0x4c01b7(0xeb)]||!_0x3238ca)return null;try{let _0x314d49='';if(_0x3238ca[_0x4c01b7(0x18e)]('accuweather'))_0x314d49=_0x3238ca+_0x4c01b7(0x250);else{if(_0x3238ca['includes'](_0x4c01b7(0x176)))_0x314d49=_0x3238ca+_0x4c01b7(0x20f);else{if(_0x3238ca['includes'](_0x4c01b7(0x1d2)))_0x314d49=_0x3238ca+_0x4c01b7(0x119);else{if(_0x3238ca[_0x4c01b7(0x18e)](_0x4c01b7(0x229)))_0x314d49=_0x3238ca+'.forecast.current.temp';}}}if(_0x314d49){const _0x487b6d=await _0x5ad913['getForeignStateAsync'](_0x314d49);if(_0x487b6d&&_0x487b6d[_0x4c01b7(0x187)]!==undefined&&_0x487b6d[_0x4c01b7(0x187)]!==null)return parseFloat(_0x487b6d[_0x4c01b7(0x187)]);}}catch(_0xd982a4){}return null;}async function recordSequence(_0x32f06f,_0x4dd9e0){const _0x3eacbf=a0_0x254785,_0xb4a37a=(_0x4dd9e0[_0x3eacbf(0x260)]||'')[_0x3eacbf(0x108)](),_0x4e3a9b=['motion',_0x3eacbf(0x131),'prÃ¤senz','presence',_0x3eacbf(0x266),_0x3eacbf(0x189),'tÃ¼r',_0x3eacbf(0x1c2),_0x3eacbf(0x195),_0x3eacbf(0x15a),'kontakt',_0x3eacbf(0x1a1),_0x3eacbf(0x1f0),_0x3eacbf(0x1c7),_0x3eacbf(0x163),_0x3eacbf(0x22b),_0x3eacbf(0x1bb)];if(!_0x4e3a9b[_0x3eacbf(0x23c)](_0x194df5=>_0xb4a37a[_0x3eacbf(0x18e)](_0x194df5)))return;if(!_0x4dd9e0[_0x3eacbf(0x1f1)])return;if(sequenceTimer)clearTimeout(sequenceTimer);activeSequence[_0x3eacbf(0x277)]({'loc':_0x4dd9e0['location']||_0x3eacbf(0x26e),'id':_0x4dd9e0['id'],'ts':Date['now']()}),_0x32f06f[_0x3eacbf(0x1fe)][_0x3eacbf(0x148)](_0x3eacbf(0x135)+_0x4dd9e0[_0x3eacbf(0x220)]+'\x20(Length:\x20'+activeSequence[_0x3eacbf(0x11d)]+')'),sequenceTimer=setTimeout(async()=>{const _0x468ed3=_0x3eacbf;if(activeSequence[_0x468ed3(0x11d)]>0x1)await saveCompletedSequence(_0x32f06f);activeSequence=[];},SEQUENCE_TIMEOUT_MS);}function a0_0x191b(_0x260391,_0x18a53d){const _0x1351e9=a0_0xe2a2();return a0_0x191b=function(_0x338bcf,_0x340613){_0x338bcf=_0x338bcf-0xeb;let _0xe2a2f9=_0x1351e9[_0x338bcf];return _0xe2a2f9;},a0_0x191b(_0x260391,_0x18a53d);}async function saveCompletedSequence(_0x53fd71){const _0x3a9482=a0_0x254785;try{const _0x260fdf=await _0x53fd71[_0x3a9482(0x248)]('LTM.trainingData.sequences');let _0x15268e=[];if(_0x260fdf&&_0x260fdf[_0x3a9482(0x187)])try{_0x15268e=JSON[_0x3a9482(0x17a)](_0x260fdf[_0x3a9482(0x187)]);}catch(_0x400ab3){}const _0x439cb8=activeSequence[0x0]['ts'],_0xb63dab=activeSequence[_0x3a9482(0x202)](_0x168483=>({'loc':_0x168483[_0x3a9482(0x185)],'t_delta':Math[_0x3a9482(0x1e5)]((_0x168483['ts']-_0x439cb8)/0x3e8)})),_0x4c3817={'timestamp':new Date(_0x439cb8)[_0x3a9482(0x192)](),'steps':_0xb63dab,'duration':Math[_0x3a9482(0x1e5)]((activeSequence[activeSequence[_0x3a9482(0x11d)]-0x1]['ts']-_0x439cb8)/0x3e8),'daytime':new Date(_0x439cb8)[_0x3a9482(0x228)]()};_0x15268e[_0x3a9482(0x277)](_0x4c3817);if(_0x15268e['length']>MAX_TRAINING_SET_SIZE)_0x15268e[_0x3a9482(0x12f)]();await _0x53fd71[_0x3a9482(0x1ad)]('LTM.trainingData.sequences',{'val':JSON[_0x3a9482(0x20e)](_0x15268e),'ack':!![]}),runSecurityCheck(_0x53fd71,_0x4c3817);}catch(_0x1c67e1){_0x53fd71[_0x3a9482(0x1fe)][_0x3a9482(0x1ab)]('[RECORDER]\x20Error\x20saving\x20sequence:\x20'+_0x1c67e1[_0x3a9482(0x18a)]);}}function runSecurityCheck(_0x13d5af,_0x6ceac){const _0x1087e3=a0_0x254785;if(!_0x13d5af[_0x1087e3(0x19c)])return;_0x13d5af[_0x1087e3(0x1fe)]['debug']('ðŸ›¡ï¸\x20SECURITY:\x20Sending\x20sequence\x20to\x20Guard\x20for\x20analysis...'),sendToPython(_0x13d5af,'ANALYZE_SEQUENCE',{'sequence':_0x6ceac});}async function processSensorEvent(_0x256be4,_0x57ccef,_0xa2aea4,_0x2196b9){const _0x347c6a=a0_0x254785;if(!_0x2196b9)return;const _0x114b6b=_0xa2aea4['val'],_0x3708ac=Date[_0x347c6a(0xfa)](),_0x50b3de=_0x256be4[_0x347c6a(0x1ea)][_0x57ccef];_0x256be4[_0x347c6a(0x1ea)][_0x57ccef]=_0x114b6b;if(!_0x2196b9[_0x347c6a(0x216)]&&_0x50b3de!=undefined&&_0x50b3de==_0x114b6b)return;const _0x566106=(_0x2196b9[_0x347c6a(0x260)]||'')[_0x347c6a(0x108)](),_0x7453db=_0x566106[_0x347c6a(0x18e)]('temperature')||_0x566106[_0x347c6a(0x18e)](_0x347c6a(0x1dc))||_0x566106['includes'](_0x347c6a(0x1e8))||_0x566106['includes'](_0x347c6a(0x14d));_0x256be4['isProVersion']&&_0x7453db&&recordThermodynamics(_0x256be4,_0x57ccef,_0x114b6b,_0x2196b9[_0x347c6a(0x220)]);const _0x236a16={'timestamp':_0x3708ac,'id':_0x57ccef,'name':_0x2196b9[_0x347c6a(0x149)],'type':_0x2196b9[_0x347c6a(0x260)],'location':_0x2196b9[_0x347c6a(0x220)],'value':_0x114b6b};_0x256be4[_0x347c6a(0x1c9)][_0x347c6a(0x1b0)](_0x236a16);if(_0x256be4[_0x347c6a(0x1c9)][_0x347c6a(0x11d)]>HISTORY_MAX_SIZE)_0x256be4['eventHistory']['pop']();await _0x256be4[_0x347c6a(0x1ad)](_0x347c6a(0x241),{'val':JSON[_0x347c6a(0x20e)](_0x236a16),'ack':!![]}),await _0x256be4['setStateAsync']('events.history',{'val':JSON[_0x347c6a(0x20e)](_0x256be4[_0x347c6a(0x1c9)]),'ack':!![]});_0x256be4[_0x347c6a(0x19c)]&&(_0x256be4[_0x347c6a(0x1a5)][_0x347c6a(0x277)](_0x236a16),await saveRawEventLog(_0x256be4),recordSequence(_0x256be4,_0x236a16));if(_0x2196b9[_0x347c6a(0x12e)]&&_0x114b6b===!![]){if(_0x256be4[_0x347c6a(0x194)]&&!_0x256be4[_0x347c6a(0x200)])startExitTimer(_0x256be4);else{if(!_0x256be4['isPresent'])setPresence(_0x256be4,!![]);}}else{if(_0x2196b9[_0x347c6a(0x260)]===_0x347c6a(0x193)&&_0x114b6b===!![]){if(_0x256be4['exitTimer'])abortExitTimer(_0x256be4);if(!_0x256be4['isPresent']&&_0x256be4['currentSystemMode']===SYSTEM_MODES[_0x347c6a(0x190)])setPresence(_0x256be4,!![]);}}}function installPythonDependencies(_0x2d94d8){const _0x5bdfe4=a0_0x254785;if(_0x2d94d8[_0x5bdfe4(0x21f)])return;_0x2d94d8[_0x5bdfe4(0x21f)]=!![];if(installAttemptCount>0x3){_0x2d94d8[_0x5bdfe4(0x1fe)]['error'](_0x5bdfe4(0x233));return;}installAttemptCount++;const _0xcd7713=path[_0x5bdfe4(0x141)](__dirname,_0x5bdfe4(0x21b),_0x5bdfe4(0x208));_0x2d94d8[_0x5bdfe4(0x1fe)][_0x5bdfe4(0x14e)](_0x5bdfe4(0x1a6)),stopPythonService(_0x2d94d8);const _0x46242d=_0x5bdfe4(0x1c8)+VENV_PATH+'\x22';exec(_0x46242d,_0x1a076b=>{const _0x5c06e9=_0x5bdfe4;if(_0x1a076b)_0x2d94d8[_0x5c06e9(0x1fe)][_0x5c06e9(0x1c1)](_0x5c06e9(0x1e3));_0x2d94d8['log'][_0x5c06e9(0x14e)]('Creating\x20fresh\x20venv...'),exec(_0x5c06e9(0x23a)+VENV_PATH+'\x22',_0x1b866e=>{const _0x52abb2=_0x5c06e9;if(_0x1b866e){_0x2d94d8[_0x52abb2(0x1fe)][_0x52abb2(0x1ab)](_0x52abb2(0x214)),_0x2d94d8['dependencyInstallInProgress']=![];return;}const _0x32ff35='\x22'+PIP_EXE+'\x22\x20install\x20--upgrade\x20pip\x20&&\x20\x22'+PIP_EXE+_0x52abb2(0x230)+_0xcd7713+'\x22';_0x2d94d8['log'][_0x52abb2(0x14e)](_0x52abb2(0x196)),exec(_0x32ff35,{'timeout':0x124f80},(_0xfb599f,_0x4bf290,_0x35f617)=>{const _0xa5aaed=_0x52abb2;_0x2d94d8['dependencyInstallInProgress']=![],_0xfb599f?_0x2d94d8[_0xa5aaed(0x1fe)][_0xa5aaed(0x1ab)](_0xa5aaed(0x104)+(_0x35f617||_0xfb599f['message'])):(_0x2d94d8[_0xa5aaed(0x1fe)]['info'](_0xa5aaed(0x278)),exec('\x22'+PYTHON_EXE+_0xa5aaed(0x158),(_0xd4338a,_0x43a221)=>{const _0x43a09c=_0xa5aaed;_0x43a221&&_0x43a221[_0x43a09c(0x18e)]('OK')?(_0x2d94d8[_0x43a09c(0x1fe)][_0x43a09c(0x14e)](_0x43a09c(0x197)),installAttemptCount=0x0,startPythonService(_0x2d94d8)):_0x2d94d8[_0x43a09c(0x1fe)][_0x43a09c(0x1ab)](_0x43a09c(0x177));}));});});});}function startPythonService(_0x3aea70){const _0x269a8e=a0_0x254785;if(_0x3aea70[_0x269a8e(0x21f)])return;let _0x32bd40=_0x269a8e(0x26a);if(fs[_0x269a8e(0x18f)](PYTHON_EXE))_0x3aea70['log'][_0x269a8e(0x14e)](_0x269a8e(0x24f)+PYTHON_EXE),_0x32bd40=PYTHON_EXE;else{_0x3aea70[_0x269a8e(0x1fe)][_0x269a8e(0x1c1)](_0x269a8e(0x1ec)),installPythonDependencies(_0x3aea70);return;}try{const _0x4a3e4c=path[_0x269a8e(0x141)](__dirname,_0x269a8e(0x21b),_0x269a8e(0x1a2));_0x3aea70[_0x269a8e(0x175)]=spawn(_0x32bd40,[_0x4a3e4c]),_0x3aea70[_0x269a8e(0x175)][_0x269a8e(0x1e1)]['on'](_0x269a8e(0x261),_0xa76ccf=>{const _0x20e263=_0x269a8e,_0x29b766=_0xa76ccf[_0x20e263(0x170)]()[_0x20e263(0x1f4)]('\x0a');_0x29b766[_0x20e263(0x1ca)](_0x20a5cc=>{const _0x533ec8=_0x20e263,_0x44b2ec=_0x20a5cc[_0x533ec8(0x23d)]();if(!_0x44b2ec)return;if(_0x44b2ec[_0x533ec8(0x1e0)]('[LOG]'))_0x3aea70[_0x533ec8(0x1fe)]['debug'](_0x533ec8(0x1d4)+_0x44b2ec[_0x533ec8(0x15b)](0x5)[_0x533ec8(0x23d)]());else{if(_0x44b2ec['startsWith']('[RESULT]'))try{const _0x43fc08=JSON['parse'](_0x44b2ec['substring'](0x8)['trim']());handlePythonResult(_0x3aea70,_0x43fc08);}catch(_0x45aa0d){_0x3aea70[_0x533ec8(0x1fe)][_0x533ec8(0x1c1)](_0x533ec8(0x20a)+_0x44b2ec);}}_0x44b2ec[_0x533ec8(0x18e)](_0x533ec8(0x129))&&(_0x3aea70[_0x533ec8(0x1fe)][_0x533ec8(0x1c1)](_0x533ec8(0x25f)+_0x44b2ec+').\x20Triggering\x20maintenance...'),installPythonDependencies(_0x3aea70));});}),_0x3aea70[_0x269a8e(0x175)][_0x269a8e(0x19e)]['on']('data',_0x2bb9be=>{const _0x25849a=_0x269a8e,_0x4a353b=_0x2bb9be['toString']()['trim']();if(!_0x4a353b[_0x25849a(0x18e)]('cpu_feature_guard'))_0x3aea70[_0x25849a(0x1fe)][_0x25849a(0x1ab)](_0x25849a(0x1de)+_0x4a353b);}),_0x3aea70[_0x269a8e(0x175)]['on'](_0x269a8e(0x263),_0x258406=>{const _0x1cfaa0=_0x269a8e;_0x3aea70[_0x1cfaa0(0x1fe)]['info'](_0x1cfaa0(0x164)+_0x258406),_0x3aea70['pythonProcess']=null;});}catch(_0x11b035){_0x3aea70[_0x269a8e(0x1fe)][_0x269a8e(0x1ab)](_0x269a8e(0x270)+_0x11b035[_0x269a8e(0x18a)]);}}function stopPythonService(_0x57b18f){const _0xad5441=a0_0x254785;if(_0x57b18f[_0xad5441(0x175)]){_0x57b18f[_0xad5441(0x1fe)][_0xad5441(0x14e)]('ðŸ\x20Stopping\x20Python...');try{_0x57b18f[_0xad5441(0x175)]['kill']();}catch(_0x8c81fa){}_0x57b18f[_0xad5441(0x175)]=null;}}function handlePythonResult(_0x4ecb02,_0x4c23e6){const _0x592e50=a0_0x254785;if(_0x4c23e6[_0x592e50(0x260)]==='PONG')_0x4ecb02[_0x592e50(0x1fe)][_0x592e50(0x148)](_0x592e50(0x1a3));else{if(_0x4c23e6[_0x592e50(0x260)]==='SECURITY_RESULT'){const {anomaly_score:_0x5ef0f4,is_anomaly:_0x50cf6e,threshold:_0x2bab39}=_0x4c23e6[_0x592e50(0x17b)];_0x4ecb02[_0x592e50(0x1fe)]['info'](_0x592e50(0x1cf)+_0x5ef0f4[_0x592e50(0x1b7)](0x5)+'\x20->\x20'+(_0x50cf6e?_0x592e50(0xf0):'OK')),_0x4ecb02[_0x592e50(0x1ad)](_0x592e50(0xf8),{'val':_0x5ef0f4,'ack':!![]}),_0x4ecb02['setStateAsync'](_0x592e50(0x151),{'val':new Date()['toISOString'](),'ack':!![]});if(_0x50cf6e){const _0xc52745='UngewÃ¶hnliches\x20Bewegungsmuster!\x20(Score:\x20'+_0x5ef0f4['toFixed'](0x4)+')';_0x4ecb02[_0x592e50(0x1ad)](_0x592e50(0x1a8),{'val':!![],'ack':!![]}),_0x4ecb02['setStateAsync'](_0x592e50(0x254),{'val':_0xc52745,'ack':!![]}),sendNotification(_0x4ecb02,_0x592e50(0x20b)+_0xc52745,![],!![]);}}else{if(_0x4c23e6[_0x592e50(0x260)]===_0x592e50(0xf3)){const {success:_0x123108,details:_0x4d1077}=_0x4c23e6['payload'];_0x4ecb02[_0x592e50(0x1ad)](_0x592e50(0x24b),{'val':_0x123108?_0x592e50(0x166)+new Date()[_0x592e50(0x219)]()+'\x20('+_0x4d1077+')':_0x592e50(0x11e)+_0x4d1077,'ack':!![]});}else{if(_0x4c23e6[_0x592e50(0x260)]===_0x592e50(0x237)){const {success:_0x34ac9c,details:_0x5abd44}=_0x4c23e6['payload'];if(_0x34ac9c)try{const _0x76bf5a=JSON[_0x592e50(0x17a)](_0x5abd44);if(_0x76bf5a[_0x592e50(0x116)])_0x4ecb02[_0x592e50(0x1ad)]('analysis.energy.insulationScore',{'val':JSON[_0x592e50(0x20e)](_0x76bf5a[_0x592e50(0x116)]),'ack':!![]});if(_0x76bf5a['heating'])_0x4ecb02[_0x592e50(0x1ad)](_0x592e50(0x1dd),{'val':JSON['stringify'](_0x76bf5a[_0x592e50(0x126)]),'ack':!![]});}catch(_0x3a7a7e){}}else{if(_0x4c23e6[_0x592e50(0x260)]===_0x592e50(0x1d1)){const {success:_0x290917,details:_0x121ce0}=_0x4c23e6[_0x592e50(0x17b)];if(_0x290917)_0x4ecb02[_0x592e50(0x1fe)][_0x592e50(0x14e)]('âœ…\x20HEALTH\x20TRAINED:\x20'+_0x121ce0);}else{if(_0x4c23e6[_0x592e50(0x260)]==='HEALTH_RESULT'){const {is_anomaly:_0x109bff,details:_0x4eee5d}=_0x4c23e6['payload'];_0x4ecb02[_0x592e50(0x1ad)](_0x592e50(0x110),{'val':new Date()[_0x592e50(0x192)](),'ack':!![]}),_0x4ecb02[_0x592e50(0x1ad)](_0x592e50(0x142),{'val':_0x109bff,'ack':!![]});}else{if(_0x4c23e6[_0x592e50(0x260)]===_0x592e50(0x255)){const {diagnosis:_0x3f2883,change_percent:_0x453dce}=_0x4c23e6[_0x592e50(0x17b)];_0x4ecb02['log'][_0x592e50(0x14e)](_0x592e50(0x154)+_0x3f2883+'\x20('+_0x453dce+'%)'),_0x4ecb02[_0x592e50(0x1ad)](_0x592e50(0x130),{'val':_0x3f2883,'ack':!![]}),_0x4ecb02['setStateAsync'](_0x592e50(0x157),{'val':_0x453dce,'ack':!![]});}}}}}}}}function sendToPython(_0xd00a2b,_0x53af53,_0x4fb26f={}){const _0x4403ad=a0_0x254785;if(!_0xd00a2b[_0x4403ad(0x175)]||!_0xd00a2b[_0x4403ad(0x175)]['stdin']['writable'])return;const _0x45abef=JSON['stringify']({'command':_0x53af53,..._0x4fb26f});try{_0xd00a2b[_0x4403ad(0x175)]['stdin'][_0x4403ad(0x13d)](_0x45abef+'\x0a');}catch(_0x3907e7){}}async function initSensorSubscriptions(_0xedcfa){const _0xb3072a=a0_0x254785,_0xda689d=_0xedcfa['config'][_0xb3072a(0x234)];if(_0xda689d)for(const _0x1a39b8 of _0xda689d){await _0xedcfa[_0xb3072a(0x203)](_0x1a39b8['id']);}}async function initPresenceSubscriptions(_0x3e3557){const _0x45a4ec=_0x3e3557['config']['presenceDevices'];if(_0x45a4ec)for(const _0x7b4dc5 of _0x45a4ec){await _0x3e3557['subscribeForeignStatesAsync'](_0x7b4dc5);}}function a0_0xe2a2(){const _0x5457bd=['presenceDevices','unshift','uuid','level','WiFi\x20Presence\x20detected.','version','temperature','analysis.automation.patternDetected','toFixed','notifyEmailEnabled','apply','modeResetJob','lampe','Fokus\x20auf\x20Familienroutinen.','path','Trend\x20Value','Anomaly\x20Detected','Restoring\x20sensor\x20cache\x20from\x20history\x20(','warn','window','Auto\x20Apply','inactivityThresholdHours','setpoint','indicator.alarm','switch','rm\x20-rf\x20\x22','eventHistory','forEach','notifyTelegramRecipient','getObjectAsync','status','Scripts','ðŸ›¡ï¸\x20SECURITY\x20CHECK:\x20Score\x20','targetposition','HEALTH_TRAIN_RESULT','openweathermap','config','[PYTHON]\x20','0\x204\x20*\x20*\x20*','generateContent','cover','Train\x20Energy','currentposition','TRAIN_HEALTH','getFullYear','temperatur','analysis.energy.heatingScore','[PYTHON\x20ERR]\x20','minDaysForBaseline','startsWith','stdout','text','Could\x20not\x20remove\x20.venv\x20(maybe\x20permission?),\x20continuing...','getForeignStateAsync','round','flot.','Alert\x20Status','klima','analysis.security','sensorLastValues','blind','âš ï¸\x20VENV\x20missing.\x20Triggering\x20install...','telegram','COGNI_CONFIRM_OK','Training\x20Status','licht','value','python.exe','win32','split','splice','Alert\x20Reason','direction','Health\x20Analysis','set_temperature','shutter','number','Analysiere\x20ausgewogen.','Security\x20Monitor','log','autoApply','isGracePeriodActive','vis.','map','subscribeForeignStatesAsync','pip.exe','dailyDigests','vacation','system.mode','requirements.txt','triggerBriefing','Invalid\x20JSON:\x20','âš ï¸\x20SECURITY\x20ALARM:\x20','enum.functions.*','Sequences','stringify','.NextHours.Location_1.Day_1.current.temp_value','PARTY','Pattern\x20Detected','geminiModel','ðŸ¤–\x20BUTLER:\x20Executing\x20Action\x20->\x20','âŒ\x20VENV\x20CREATION\x20FAILED.\x20Please\x20run:\x20sudo\x20apt\x20install\x20python3-venv','analysis.triggerBriefing','logDuplicates','Missing\x20data','LTM.trainingData.sequences','toLocaleTimeString','off','python_service','notifyEmailRecipient','GUEST','analysisTimer','dependencyInstallInProgress','location','Alarm','onMessage','@google/generative-ai','analysis.automation.autoApply','echarts.','AI\x20Training','outdoorSensorId','getHours','weatherunderground','notifyTelegramEnabled','dimmer','Training\x20Error:\x20','info.','notifyPushoverRecipient','actual_temperature','\x22\x20install\x20--no-cache-dir\x20--force-reinstall\x20-r\x20\x22','briefingJob','reachable','ðŸš¨\x20Too\x20many\x20failed\x20install\x20attempts.\x20Stopping\x20to\x20prevent\x20loop.\x20Check\x20logs/permissions.','devices','system.','constructor','ENERGY_TRAIN_RESULT','channel','models/gemini-flash-latest','python3\x20-m\x20venv\x20\x22','javascript.','some','trim','Anomaly\x20Score','getTime','systemConfig','events.lastEvent','Train\x20Security','ðŸ¤–\x20BUTLER:\x20No\x20valid\x20target\x20ID\x20or\x20value\x20stored\x20for\x20execution.','retry','inactivityMonitoringEnabled','sound','material.','getStateAsync','1364665EKOqxx','LTM.driftAnalysis.driftDetails','analysis.training.status','dutycycle','430034pdJUYm','setState','ðŸ\x20Using\x20VENV\x20Python:\x20','.Current.Temperature','extendObjectAsync','ðŸ§ \x20Triggering\x20Security\x20Training...','values','analysis.alertReason','TREND_RESULT','scriptProblem','rssi','common','send','Vom\x20Benutzer\x20bestÃ¤tigt\x20(OK).','system.isPresent','date','Target\x20Value','exitGraceTimer','âš ï¸\x20Missing\x20Libs\x20detected\x20(','type','data','LTM','close','cancel','ack','occupancy','.communicate.request','system.config','Activity-Level','python3','platform','state','scanDevices','Unknown','COGNI_REQUEST_CALL','Error\x20launching\x20Python:\x20','slice','position','PRIORITÃ„T:\x20Gesundheit/AAL.','energy','\x20Tage)','dismissAutomation','push','âœ…\x20INSTALLATION\x20SUCCESS.\x20Validating...','systemUUID','useWeather','humidity','string','latitude','analysis.activitySummary','ANOMALY','Last\x20raw\x20event','from','TRAINING_COMPLETE','(((.+)+)+)+$','power','SIMULATION:\x20Test-Vorschlag\x20fÃ¼r\x20','icons-mfd.','analysis.security.lastScore','targetValue','now','onReady','bin','city','Raw\x20Log','ltmStbWindowDays','ðŸš¨\x20EMERGENCY','geminiApiKey','unload','setForeignStateAsync','âŒ\x20INSTALL\x20FAILED:\x20','Kein\x20API\x20Key.','boolean','lastAlertState','toLowerCase','ðŸ“ž\x20RÃ¼ckruf\x20anfordern','targetId','notifyPushoverInstance','command','.venv','Adapter','sendToAsync','analysis.health.lastCheck','Deaktiviert\x20(Pro-Feature)','âœ…\x20Alles\x20OK\x20(Reset)]','Gemini\x20Init\x20Error:\x20','getGenerativeModel','11868SHRlYd','insulation','bind','analysis.energy.insulationScore','.forecast.current.temperature','analysisHistory','\x20=\x20','notifyTelegramInstance','length','Failed:\x20','events.history','0\x203\x20*\x20*\x20*','@iobroker/adapter-core','analysis.training','exitTimer','analysis.history_debug_00','1koKXPJ','heating','exports','analysis.energy','No\x20module\x20named','guest','ANALYZE_TREND','N/A','main','isExit','shift','analysis.health.trendDiagnosis','bewegung','System\x20Mode','Trigger\x20Action','onUnload','[RECORDER]\x20Added\x20step\x20to\x20sequence:\x20','4954824lVrLiy','Sec-Training\x20started...','testContext','system',')\x20-\x20VERIFIED\x20INSTALL','object','indexOf','write','automation.triggerAction','detected','2291692woilLq','join','analysis.health.isAnomaly','Heating\x20Score','child_process','sendTo','connection','3484314udJJhd','debug','name','VACATION','PRIORITÃ„T:\x20Sicherheit.','getEnums','heizung','info','python','OK:\x20','analysis.security.lastCheck','system.presenceWho','currentSystemMode','ðŸ\x20Guardian\x20Diagnosis:\x20','json','driftAnalysisTimer','analysis.health.trendValue','\x22\x20-c\x20\x22import\x20tensorflow;\x20print(\x27OK\x27)\x22','button','contact','substring','\x20events)...','System','search','Err:\x20','analysis.automation.targetId','response','setObjectNotExistsAsync','schalter','[PYTHON]\x20Exited\x20code\x20','link_quality','Success:\x20','Fokus\x20auf\x20Komfort.','lowbat','analysis.analysisHistory','analysis.training.triggerEnergy','Last\x20Check','pip','analysis.training.triggerHealth','20bsiXQJ','LTM.trainingData.thermodynamics','toString','7547782rSLqoR','Who\x20is\x20present?','No\x20instance','HARD\x20WATCHDOG:\x20No\x20activity\x20for\x20','pythonProcess','daswetter','âŒ\x20Verification\x20Failed!\x20TensorFlow\x20import\x20error.\x20Check\x20console.','LTM.triggerDailyDigest','callback','parse','payload','2128huodlC','LTM.driftAnalysis','genAI','getDate','longitude','LTM.processingStatus','ltmJob','analysis.trigger','LTM.baselineStatus','loc','events.history_debug_00','val','Thermodynamics','door','message','stateChange','notifyPushoverEnabled','ðŸ§ª\x20Simulating\x20Butler\x20Proposal:\x20','includes','existsSync','NORMAL','Kein\x20API\x20Key!','toISOString','motion','isPresent','fenster','Running\x20Pip\x20Install...\x20(Wait...)','âœ…\x20Verification\x20Passed.\x20Starting\x20Service.','analysis.automation.triggerAction','ðŸ“ž\x20RÃœCKRUF\x20BITTE!\x20Der\x20Bewohner\x20hat\x20den\x20RÃ¼ckruf-Button\x20gedrÃ¼ckt.','cogni-living','analysis.automation.targetValue','isProVersion','delObjectAsync','stderr','onStateChange','subscribeStates','light','service.py','ðŸ\x20Python\x20Pong','getForeignObjectAsync','rawEventLog','ðŸ› ï¸\x20MAINTENANCE\x20MODE:\x20Complete\x20environment\x20reset\x20&\x20reinstall...','timestamp','analysis.isAlert','ltmLtbWindowDays','namespace','error','analysis.training.triggerSecurity','setStateAsync','3TLPSsu'];a0_0xe2a2=function(){return _0x5457bd;};return a0_0xe2a2();}async function setupTelegramListener(_0x4cc0b6){const _0x3e5370=a0_0x254785,_0x5a9e00=_0x4cc0b6[_0x3e5370(0x1d3)][_0x3e5370(0x11c)];if(_0x4cc0b6['config'][_0x3e5370(0x22a)]&&_0x5a9e00)await _0x4cc0b6[_0x3e5370(0x203)](_0x5a9e00+_0x3e5370(0x267));}async function checkWifiPresence(_0x4a4686){const _0x110152=a0_0x254785;try{const _0x4fbcff=_0x4a4686[_0x110152(0x1d3)][_0x110152(0x1af)]||[];let _0x4be9d4=![];const _0x1acda7=[];for(const _0x2911eb of _0x4fbcff){try{const _0x288f07=await _0x4a4686[_0x110152(0x1e4)](_0x2911eb);_0x288f07&&(_0x288f07[_0x110152(0x187)]===!![]||_0x288f07[_0x110152(0x187)]==='online'||_0x288f07['val']===0x1)&&(_0x4be9d4=!![],_0x1acda7['push'](_0x2911eb));}catch(_0x234124){}}return await _0x4a4686['setStateAsync']('system.presenceWho',{'val':_0x1acda7['join'](',\x20'),'ack':!![]}),_0x4be9d4&&(_0x4a4686[_0x110152(0x123)]&&(_0x4a4686[_0x110152(0x1fe)]['info'](_0x110152(0x1b3)),abortExitTimer(_0x4a4686)),!_0x4a4686[_0x110152(0x194)]&&_0x4a4686[_0x110152(0x153)]===SYSTEM_MODES[_0x110152(0x190)]&&await setPresence(_0x4a4686,!![])),_0x4be9d4;}catch(_0x18c50a){return![];}}function startExitTimer(_0xe3e8b9){const _0x144c83=a0_0x254785;abortExitTimer(_0xe3e8b9),_0xe3e8b9['isGracePeriodActive']=!![],_0xe3e8b9[_0x144c83(0x25e)]=setTimeout(()=>{const _0x2f3830=_0x144c83;_0xe3e8b9[_0x2f3830(0x200)]=![];},EXIT_GRACE_PERIOD_SECONDS*0x3e8),_0xe3e8b9[_0x144c83(0x123)]=setTimeout(()=>{setPresence(_0xe3e8b9,![]),_0xe3e8b9['exitTimer']=null;},EXIT_TIMER_MINUTES*0x3c*0x3e8);}function abortExitTimer(_0x36690a){const _0x221bd2=a0_0x254785;if(_0x36690a[_0x221bd2(0x123)])clearTimeout(_0x36690a[_0x221bd2(0x123)]);if(_0x36690a['exitGraceTimer'])clearTimeout(_0x36690a['exitGraceTimer']);this[_0x221bd2(0x123)]=null,this[_0x221bd2(0x25e)]=null,_0x36690a['isGracePeriodActive']=![];}async function setPresence(_0x4151c4,_0x1f34f1){const _0x1feed9=a0_0x254785;if(_0x4151c4[_0x1feed9(0x194)]===_0x1f34f1)return;_0x4151c4[_0x1feed9(0x194)]=_0x1f34f1,await _0x4151c4[_0x1feed9(0x1ad)](_0x1feed9(0x25b),{'val':_0x1f34f1,'ack':!![]});}async function executeAutomationAction(_0x38b146){const _0x37c0cb=a0_0x254785;try{const _0x57ac72=await _0x38b146['getStateAsync']('analysis.automation.targetId'),_0x20e5a0=await _0x38b146[_0x37c0cb(0x248)]('analysis.automation.targetValue');if(_0x57ac72&&_0x57ac72[_0x37c0cb(0x187)]&&_0x20e5a0){const _0x4f78fb=_0x57ac72[_0x37c0cb(0x187)];let _0x703ae8=_0x20e5a0[_0x37c0cb(0x187)];try{_0x703ae8=JSON[_0x37c0cb(0x17a)](_0x703ae8);}catch(_0x217e3b){}_0x38b146['log'][_0x37c0cb(0x14e)](_0x37c0cb(0x213)+_0x4f78fb+_0x37c0cb(0x11b)+_0x703ae8),await _0x38b146[_0x37c0cb(0x103)](_0x4f78fb,_0x703ae8);}else _0x38b146[_0x37c0cb(0x1fe)][_0x37c0cb(0x1c1)](_0x37c0cb(0x243));}catch(_0x1a7e39){_0x38b146[_0x37c0cb(0x1fe)][_0x37c0cb(0x1ab)]('BUTLER\x20Execution\x20Error:\x20'+_0x1a7e39[_0x37c0cb(0x18a)]);}}async function handleTelegramResponse(_0x2e31cf,_0x1bedba){const _0x403213=a0_0x254785;let _0x123457=_0x1bedba;_0x1bedba[_0x403213(0x1e0)]('[')&&(_0x123457=_0x1bedba[_0x403213(0x15b)](_0x1bedba[_0x403213(0x13c)](']')+0x1));if(_0x123457==='COGNI_CONFIRM_OK')await _0x2e31cf['setStateAsync']('analysis.isAlert',{'val':![],'ack':!![]}),await _0x2e31cf[_0x403213(0x1ad)](_0x403213(0x254),{'val':_0x403213(0x25a),'ack':!![]}),_0x2e31cf[_0x403213(0x107)]=![],sendNotification(_0x2e31cf,'âœ…\x20Alarm\x20quittiert.\x20System\x20normal.',![]);else _0x123457===_0x403213(0x26f)&&sendNotification(_0x2e31cf,_0x403213(0x199),![],!![]);}async function sendNotification(_0x201225,_0x1ad29b,_0x8f448b=![],_0xf15361=![]){const _0x4f0193=a0_0x254785,_0x283945=_0x201225[_0x4f0193(0x1d3)];if(_0x283945['notifyTelegramEnabled']){let _0x309690={};(_0x1ad29b[_0x4f0193(0x18e)](_0x4f0193(0x221))||_0xf15361)&&(_0x309690={'reply_markup':{'inline_keyboard':[[{'text':_0x4f0193(0x112),'callback_data':_0x4f0193(0x1ee)}],[{'text':_0x4f0193(0x109),'callback_data':'COGNI_REQUEST_CALL'}]]}}),await _0x201225[_0x4f0193(0x10f)](_0x283945[_0x4f0193(0x11c)],'send',{'text':_0x1ad29b,'user':_0x283945[_0x4f0193(0x1cb)],..._0x309690});}if(_0x283945[_0x4f0193(0x18c)]){let _0x43fa2f={'message':_0x1ad29b,'title':_0xf15361?_0x4f0193(0x100):'Cogni-Living','priority':_0xf15361?0x2:0x1,'device':_0x283945[_0x4f0193(0x22e)]};_0xf15361&&(_0x43fa2f[_0x4f0193(0x244)]=0x1e,_0x43fa2f['expire']=0xe10,_0x43fa2f[_0x4f0193(0x246)]='siren'),await _0x201225[_0x4f0193(0x10f)](_0x283945[_0x4f0193(0x10b)],_0x4f0193(0x259),_0x43fa2f);}_0x283945[_0x4f0193(0x1b8)]&&await _0x201225[_0x4f0193(0x10f)](_0x283945['notifyEmailInstance'],'send',{'text':_0x1ad29b,'to':_0x283945[_0x4f0193(0x21c)]});}async function runAutopilot(_0x5a1a56){const _0x4d9e5d=a0_0x254785,_0x51803f=_0x5a1a56[_0x4d9e5d(0x1d3)][_0x4d9e5d(0x1c4)],_0x597d16=_0x5a1a56[_0x4d9e5d(0x1c9)]['length']>0x0?_0x5a1a56[_0x4d9e5d(0x1c9)][0x0]['timestamp']:Date['now'](),_0x5978a6=(Date[_0x4d9e5d(0xfa)]()-_0x597d16)/(0x3e8*0x3c*0x3c);let _0x2c84f4='';_0x5a1a56[_0x4d9e5d(0x1d3)][_0x4d9e5d(0x245)]&&_0x5a1a56[_0x4d9e5d(0x153)]===SYSTEM_MODES[_0x4d9e5d(0x190)]&&_0x5a1a56[_0x4d9e5d(0x194)]&&(_0x5978a6>_0x51803f&&(_0x2c84f4=_0x4d9e5d(0x174)+_0x5978a6[_0x4d9e5d(0x1b7)](0x1)+'h.')),runGeminiAnalysis(_0x5a1a56,_0x2c84f4);}async function runPythonHealthCheck(_0x5ca5b3){const _0x49fa6d=a0_0x254785;if(!_0x5ca5b3[_0x49fa6d(0x205)]||_0x5ca5b3[_0x49fa6d(0x205)][_0x49fa6d(0x11d)]<0x2)return;const _0x124f9b=_0x5ca5b3[_0x49fa6d(0x205)][_0x49fa6d(0x202)](_0x2de983=>{const _0x502437=_0x49fa6d,_0x4c4ce2=(_0x2de983['activityLevel']||'')[_0x502437(0x108)]();return ACTIVITY_LEVEL_MAP[_0x4c4ce2]||0x32;});sendToPython(_0x5ca5b3,_0x49fa6d(0x12b),{'values':_0x124f9b,'tag':_0x49fa6d(0x269)});}class CogniLiving extends utils[a0_0x254785(0x10e)]{constructor(_0x3f4096){const _0x1c9975=a0_0x254785;super({..._0x3f4096,'name':_0x1c9975(0x19a)}),this['eventHistory']=[],this[_0x1c9975(0x11a)]=[],this[_0x1c9975(0x1a5)]=[],this[_0x1c9975(0x205)]=[],this[_0x1c9975(0x1ea)]={},this[_0x1c9975(0x240)]={'latitude':0x0,'longitude':0x0,'city':''},this[_0x1c9975(0x194)]=!![],this['exitTimer']=null,this[_0x1c9975(0x25e)]=null,this[_0x1c9975(0x200)]=![],this['genAI']=null,this[_0x1c9975(0x212)]=null,this['currentSystemMode']=SYSTEM_MODES[_0x1c9975(0x190)],this[_0x1c9975(0x19c)]=![],this[_0x1c9975(0x107)]=![],this[_0x1c9975(0x279)]='unknown',this[_0x1c9975(0x21e)]=null,this['ltmJob']=null,this[_0x1c9975(0x1ba)]=null,this[_0x1c9975(0x156)]=null,this[_0x1c9975(0x231)]=null,this['pythonProcess']=null,this['dependencyInstallInProgress']=![],this['on']('ready',this[_0x1c9975(0xfb)][_0x1c9975(0x117)](this)),this['on'](_0x1c9975(0x18b),this[_0x1c9975(0x19f)][_0x1c9975(0x117)](this)),this['on'](_0x1c9975(0x102),this[_0x1c9975(0x134)][_0x1c9975(0x117)](this)),this['on'](_0x1c9975(0x18a),this[_0x1c9975(0x222)][_0x1c9975(0x117)](this));}async[a0_0x254785(0xfb)](){const _0x19eba2=a0_0x254785;this[_0x19eba2(0x1fe)]['info']('cogni-living\x20adapter\x20starting\x20(v'+this[_0x19eba2(0x1b4)]+_0x19eba2(0x13a)),await initZombies(this);try{this[_0x19eba2(0x19c)]=await checkLicense(this,this[_0x19eba2(0x1d3)]['licenseKey']);}catch(_0x1c4346){}if(!this[_0x19eba2(0x1d3)][_0x19eba2(0x1c4)]||this['config']['inactivityThresholdHours']<0.1)this[_0x19eba2(0x1d3)][_0x19eba2(0x1c4)]=0xc;await initHistory(this),await initSystemConfig(this);if(this['config'][_0x19eba2(0x101)])try{this[_0x19eba2(0x17e)]=new GoogleGenerativeAI(this['config'][_0x19eba2(0x101)]),this['geminiModel']=this[_0x19eba2(0x17e)][_0x19eba2(0x114)]({'model':GEMINI_MODEL,'generationConfig':{'responseMimeType':'application/json'}}),this[_0x19eba2(0x1fe)][_0x19eba2(0x14e)]('Gemini\x20AI\x20initialized.');}catch(_0x522cc4){this[_0x19eba2(0x1fe)]['error'](_0x19eba2(0x113)+_0x522cc4['message']);}await createAllObjects(this),await loadSystemMode(this),await loadRawEventLog(this),await loadDailyDigests(this),this['subscribeStates'](_0x19eba2(0x183)),this[_0x19eba2(0x1a0)](LTM_DP_TRIGGER_DIGEST),this[_0x19eba2(0x1a0)](_0x19eba2(0x207)),this[_0x19eba2(0x1a0)]('analysis.triggerBriefing'),this[_0x19eba2(0x1a0)](_0x19eba2(0x198)),this[_0x19eba2(0x1a0)](_0x19eba2(0x224)),this[_0x19eba2(0x1a0)](_0x19eba2(0x1ac)),this['subscribeStates'](_0x19eba2(0x16d)),this[_0x19eba2(0x1a0)](_0x19eba2(0x16a)),await initSensorSubscriptions(this),await initPresenceSubscriptions(this),await setupTelegramListener(this),setTimeout(()=>checkWifiPresence(this),0x1388);if(this[_0x19eba2(0x21e)])clearInterval(this[_0x19eba2(0x21e)]);const _0x3d514b=this['config']['analysisInterval']||0xf;_0x3d514b>0x0&&(this[_0x19eba2(0x21e)]=setInterval(()=>{runAutopilot(this);},_0x3d514b*0x3c*0x3e8)),setupLtmScheduler(this),setupModeResetScheduler(this),setupDriftAnalysisScheduler(this),setupBriefingScheduler(this),startPythonService(this),setTimeout(()=>{const _0x179b74=_0x19eba2;if(this[_0x179b74(0x175)])runPythonHealthCheck(this);},0x1388);}[a0_0x254785(0x134)](_0x276355){const _0x2a12fa=a0_0x254785;if(this['analysisTimer'])clearInterval(this[_0x2a12fa(0x21e)]);if(this[_0x2a12fa(0x156)])clearInterval(this[_0x2a12fa(0x156)]);if(this['ltmJob'])this[_0x2a12fa(0x182)][_0x2a12fa(0x264)]();if(this[_0x2a12fa(0x1ba)])this[_0x2a12fa(0x1ba)][_0x2a12fa(0x264)]();if(this['briefingJob'])this[_0x2a12fa(0x231)][_0x2a12fa(0x264)]();if(this[_0x2a12fa(0x123)])clearTimeout(this[_0x2a12fa(0x123)]);if(this[_0x2a12fa(0x25e)])clearTimeout(this[_0x2a12fa(0x25e)]);stopPythonService(this),_0x276355();}async['onStateChange'](_0x12c040,_0x14a9fc){const _0x33e516=a0_0x254785;if(!_0x14a9fc||this[_0x33e516(0x21f)])return;if(_0x12c040['includes'](_0x33e516(0x1ed))&&_0x12c040['endsWith']('communicate.request')&&_0x14a9fc[_0x33e516(0x187)]){await handleTelegramResponse(this,_0x14a9fc[_0x33e516(0x187)]);return;}if(_0x12c040===this[_0x33e516(0x1aa)]+'.'+SYSTEM_DP_MODE){if(_0x14a9fc[_0x33e516(0x187)]&&Object[_0x33e516(0x253)](SYSTEM_MODES)['includes'](_0x14a9fc[_0x33e516(0x187)])){this[_0x33e516(0x153)]=_0x14a9fc[_0x33e516(0x187)];if(_0x14a9fc[_0x33e516(0x187)]===SYSTEM_MODES[_0x33e516(0x14a)])await setPresence(this,![]);else await setPresence(this,!![]);}if(!_0x14a9fc[_0x33e516(0x265)])this[_0x33e516(0x24e)](_0x12c040,{'val':this[_0x33e516(0x153)],'ack':!![]});return;}if(!_0x14a9fc[_0x33e516(0x265)]){_0x12c040[_0x33e516(0x18e)]('analysis.trigger')&&_0x14a9fc['val']&&(this[_0x33e516(0x24e)](_0x12c040,{'val':![],'ack':!![]}),runGeminiAnalysis(this));if(_0x12c040[_0x33e516(0x18e)]('triggerDailyDigest')&&_0x14a9fc['val']){this[_0x33e516(0x24e)](_0x12c040,{'val':![],'ack':!![]});if(this[_0x33e516(0x19c)])createDailyDigest(this);}_0x12c040['includes'](_0x33e516(0x209))&&_0x14a9fc[_0x33e516(0x187)]&&(this[_0x33e516(0x24e)](_0x12c040,{'val':![],'ack':!![]}),sendMorningBriefing(this));_0x12c040[_0x33e516(0x18e)](_0x33e516(0x13e))&&_0x14a9fc[_0x33e516(0x187)]&&(this['setState'](_0x12c040,{'val':![],'ack':!![]}),executeAutomationAction(this));if(_0x12c040['includes'](_0x33e516(0x1ac))&&_0x14a9fc[_0x33e516(0x187)]){this[_0x33e516(0x24e)](_0x12c040,{'val':![],'ack':!![]});if(this['isProVersion'])try{const _0x44dc32=await this['getStateAsync'](_0x33e516(0x218));if(_0x44dc32&&_0x44dc32[_0x33e516(0x187)]){const _0x3f1371=JSON[_0x33e516(0x17a)](_0x44dc32[_0x33e516(0x187)]);this[_0x33e516(0x1fe)][_0x33e516(0x14e)](_0x33e516(0x252)),this[_0x33e516(0x1ad)](_0x33e516(0x24b),{'val':_0x33e516(0x137),'ack':!![]}),sendToPython(this,'TRAIN_SECURITY',{'sequences':_0x3f1371});}}catch(_0x5176ef){this['log'][_0x33e516(0x1ab)](_0x33e516(0x22c)+_0x5176ef['message']);}}if(_0x12c040[_0x33e516(0x18e)]('analysis.training.triggerHealth')&&_0x14a9fc[_0x33e516(0x187)]){this[_0x33e516(0x24e)](_0x12c040,{'val':![],'ack':!![]});if(this[_0x33e516(0x19c)])try{const _0x480fab=await this['getStateAsync'](LTM_DP_DAILY_DIGESTS);if(_0x480fab&&_0x480fab[_0x33e516(0x187)])sendToPython(this,_0x33e516(0x1da),{'digests':JSON['parse'](_0x480fab[_0x33e516(0x187)])});}catch(_0x3e54fd){}}if(_0x12c040[_0x33e516(0x18e)](_0x33e516(0x16a))&&_0x14a9fc[_0x33e516(0x187)]){this[_0x33e516(0x24e)](_0x12c040,{'val':![],'ack':!![]});if(this[_0x33e516(0x19c)])try{const _0x1c5376=await this[_0x33e516(0x248)](_0x33e516(0x16f));if(_0x1c5376&&_0x1c5376[_0x33e516(0x187)])sendToPython(this,'TRAIN_ENERGY',{'points':JSON[_0x33e516(0x17a)](_0x1c5376[_0x33e516(0x187)])});}catch(_0x55939e){}}return;}if(this[_0x33e516(0x1d3)]['presenceDevices']&&this[_0x33e516(0x1d3)][_0x33e516(0x1af)][_0x33e516(0x18e)](_0x12c040)){await checkWifiPresence(this);return;}const _0x4d9f14=(this['config'][_0x33e516(0x234)]||[])['find'](_0x18dd1f=>_0x18dd1f['id']===_0x12c040);if(_0x4d9f14)processSensorEvent(this,_0x12c040,_0x14a9fc,_0x4d9f14);}async['onMessage'](_0x116023){const _0x208c94=a0_0x254785;if(typeof _0x116023==='object'&&_0x116023[_0x208c94(0x18a)]){if(_0x116023[_0x208c94(0x10c)]==='testApiKey'){const _0x744532=_0x116023['message']['apiKey']||this[_0x208c94(0x1d3)][_0x208c94(0x101)];if(!_0x744532)return this[_0x208c94(0x145)](_0x116023[_0x208c94(0xf2)],_0x116023[_0x208c94(0x10c)],{'success':![],'message':_0x208c94(0x105)},_0x116023[_0x208c94(0x179)]);try{const _0x1958d0=new GoogleGenerativeAI(_0x744532),_0x27ada4=_0x1958d0[_0x208c94(0x114)]({'model':GEMINI_MODEL}),_0x3192bb=await _0x27ada4[_0x208c94(0x1d6)]('Hi');this['sendTo'](_0x116023[_0x208c94(0xf2)],_0x116023['command'],{'success':!![],'message':_0x208c94(0x150)+_0x3192bb[_0x208c94(0x161)][_0x208c94(0x1e2)]()},_0x116023['callback']);}catch(_0x494af1){this['sendTo'](_0x116023[_0x208c94(0xf2)],_0x116023[_0x208c94(0x10c)],{'success':![],'message':_0x208c94(0x15f)+_0x494af1[_0x208c94(0x18a)]},_0x116023[_0x208c94(0x179)]);}}else{if(_0x116023[_0x208c94(0x10c)]===_0x208c94(0x138)){const _0x15af8e=await getWeatherContext(this),_0x4946b1=await getCalendarContext(this);this['sendTo'](_0x116023[_0x208c94(0xf2)],_0x116023[_0x208c94(0x10c)],{'success':!![],'weather':_0x15af8e,'calendar':_0x4946b1},_0x116023['callback']);}else{if(_0x116023[_0x208c94(0x10c)]==='getLtmData'){if(!this[_0x208c94(0x19c)])return this[_0x208c94(0x145)](_0x116023[_0x208c94(0xf2)],_0x116023[_0x208c94(0x10c)],{'success':![],'isPro':![]},_0x116023[_0x208c94(0x179)]);let _0xe391d3={'status':_0x208c94(0x12c)};try{const _0x13550e=await this[_0x208c94(0x248)](LTM_DP_DRIFT_STATUS);_0xe391d3[_0x208c94(0x1cd)]=_0x13550e?_0x13550e[_0x208c94(0x187)]:'N/A';}catch(_0x14394c){}this[_0x208c94(0x145)](_0x116023['from'],_0x116023[_0x208c94(0x10c)],{'success':!![],'isPro':!![],'dailyDigests':this['dailyDigests'],'driftAnalysis':_0xe391d3,'analysisHistory':this[_0x208c94(0x11a)]},_0x116023[_0x208c94(0x179)]);}else{if(_0x116023[_0x208c94(0x10c)]==='getOverviewData'){const _0x3c580b=this[_0x208c94(0x205)][_0x208c94(0x11d)],_0x4e9011=new Date(),_0x579ebe=new Date(_0x4e9011[_0x208c94(0x1db)](),_0x4e9011['getMonth'](),_0x4e9011[_0x208c94(0x17f)]())[_0x208c94(0x23f)](),_0x22b1e5=this[_0x208c94(0x1a5)]['filter'](_0x2f10c4=>new Date(_0x2f10c4['timestamp'])[_0x208c94(0x23f)]()>_0x579ebe)[_0x208c94(0x11d)],_0x341125=new Array(0x18)['fill'](0x0);this[_0x208c94(0x1a5)][_0x208c94(0x1ca)](_0x1cebe2=>{const _0x2823c3=_0x208c94,_0x100f07=new Date(_0x1cebe2[_0x2823c3(0x1a7)]);if(_0x100f07[_0x2823c3(0x23f)]()>_0x579ebe)_0x341125[_0x100f07[_0x2823c3(0x228)]()]++;});let _0x53dc13={'status':_0x208c94(0x12c)};try{const _0x1ab8f6=await this[_0x208c94(0x248)](LTM_DP_DRIFT_STATUS);_0x53dc13['status']=_0x1ab8f6?_0x1ab8f6['val']:_0x208c94(0x12c);}catch(_0x50071b){}let _0x47e729='';try{const _0xcd62a7=await this[_0x208c94(0x248)](_0x208c94(0x152));_0x47e729=_0xcd62a7?_0xcd62a7[_0x208c94(0x187)]:'';}catch(_0x6d57af){}let _0x1e8a7c=null;!this[_0x208c94(0x212)]&&(_0x1e8a7c=this[_0x208c94(0x1d3)][_0x208c94(0x101)]?'KI-Modell\x20nicht\x20initialisiert':_0x208c94(0x191));let _0x4f461e={'detected':![],'description':'','targetId':'','targetValue':'','autoApply':![]};try{const _0x49a856=await this[_0x208c94(0x248)]('analysis.automation.patternDetected');if(_0x49a856&&_0x49a856[_0x208c94(0x187)]){_0x4f461e[_0x208c94(0x13f)]=!![];const _0xd624e2=await this[_0x208c94(0x248)]('analysis.automation.description');_0x4f461e['description']=_0xd624e2?_0xd624e2[_0x208c94(0x187)]:'';const _0x278404=await this[_0x208c94(0x248)](_0x208c94(0x160));_0x4f461e[_0x208c94(0x10a)]=_0x278404?_0x278404[_0x208c94(0x187)]:'';const _0x45bdf1=await this['getStateAsync']('analysis.automation.targetValue');_0x4f461e[_0x208c94(0xf9)]=_0x45bdf1?_0x45bdf1[_0x208c94(0x187)]:'';}const _0x5211a1=await this[_0x208c94(0x248)]('analysis.automation.autoApply');_0x4f461e[_0x208c94(0x1ff)]=_0x5211a1?!!_0x5211a1[_0x208c94(0x187)]:![];}catch(_0x1daba8){}this[_0x208c94(0x145)](_0x116023['from'],_0x116023[_0x208c94(0x10c)],{'success':!![],'eventHistory':this[_0x208c94(0x1c9)][_0x208c94(0x271)](0x0,0xf),'stats':{'digestCount':_0x3c580b,'eventCountToday':_0x22b1e5,'hourlyActivity':_0x341125,'driftStatus':_0x53dc13[_0x208c94(0x1cd)],'isPresent':this['isPresent'],'presenceWho':_0x47e729,'minDays':this['config']['minDaysForBaseline']||0x7,'stbDays':this[_0x208c94(0x1d3)][_0x208c94(0xff)]||0xe,'ltbDays':this[_0x208c94(0x1d3)]['ltmLtbWindowDays']||0x3c,'systemError':_0x1e8a7c},'automation':_0x4f461e},_0x116023['callback']);}else{if(_0x116023[_0x208c94(0x10c)]===_0x208c94(0x26d))try{const _0x56a385=await scanForDevices(this,_0x116023[_0x208c94(0x18a)]||{});this['sendTo'](_0x116023[_0x208c94(0xf2)],_0x116023['command'],{'success':!![],'devices':_0x56a385},_0x116023[_0x208c94(0x179)]);}catch(_0x124bec){this[_0x208c94(0x145)](_0x116023['from'],_0x116023[_0x208c94(0x10c)],{'success':![],'error':_0x124bec['message']},_0x116023['callback']);}else{if(_0x116023[_0x208c94(0x10c)]===_0x208c94(0x14c)){const _0x34a864=await this['getForeignObjectsAsync'](_0x208c94(0x20c),'enum'),_0x4fa424=[];if(_0x34a864)for(const _0x5190c7 in _0x34a864){const _0x45dbd2=_0x34a864[_0x5190c7],_0x2b3b47=(_0x45dbd2[_0x208c94(0x258)]&&typeof _0x45dbd2['common'][_0x208c94(0x149)]===_0x208c94(0x13b)?_0x45dbd2['common']['name']['de']:_0x45dbd2['common'][_0x208c94(0x149)])||_0x45dbd2['common']['name'];_0x4fa424[_0x208c94(0x277)]({'id':_0x5190c7,'name':_0x2b3b47});}this[_0x208c94(0x145)](_0x116023[_0x208c94(0xf2)],_0x116023[_0x208c94(0x10c)],{'success':!![],'enums':_0x4fa424},_0x116023[_0x208c94(0x179)]);}else{if(_0x116023[_0x208c94(0x10c)]==='getCalendarNames'){const _0x2545c0=_0x116023[_0x208c94(0x18a)]['instance'];if(!_0x2545c0)return this[_0x208c94(0x145)](_0x116023[_0x208c94(0xf2)],_0x116023[_0x208c94(0x10c)],{'success':![],'error':_0x208c94(0x173)},_0x116023[_0x208c94(0x179)]);const _0xcfa029=await getCalendarNames(this,_0x2545c0);this[_0x208c94(0x145)](_0x116023[_0x208c94(0xf2)],_0x116023['command'],{'success':!![],'names':_0xcfa029},_0x116023[_0x208c94(0x179)]);}else{if(_0x116023[_0x208c94(0x10c)]==='simulateButler'){const {targetId:_0x2cf31d,targetValue:_0x49d5d3}=_0x116023[_0x208c94(0x18a)];this[_0x208c94(0x1fe)]['info'](_0x208c94(0x18d)+_0x2cf31d+_0x208c94(0x11b)+_0x49d5d3),await this[_0x208c94(0x1ad)](_0x208c94(0x1b6),{'val':!![],'ack':!![]}),await this[_0x208c94(0x1ad)]('analysis.automation.description',{'val':_0x208c94(0xf6)+_0x2cf31d,'ack':!![]}),await this[_0x208c94(0x1ad)](_0x208c94(0x160),{'val':_0x2cf31d,'ack':!![]}),await this['setStateAsync'](_0x208c94(0x19b),{'val':_0x49d5d3,'ack':!![]}),this[_0x208c94(0x145)](_0x116023[_0x208c94(0xf2)],_0x116023[_0x208c94(0x10c)],{'success':!![]},_0x116023[_0x208c94(0x179)]);}else{if(_0x116023[_0x208c94(0x10c)]==='submitFeedback'){const {historyId:_0x22fa70,rating:_0x47d52f,comment:_0xdcf13d,alertReason:_0x42a375}=_0x116023[_0x208c94(0x18a)];_0x22fa70&&_0x47d52f?(await saveFeedback(this,{'timestamp':Date['now'](),'historyId':_0x22fa70,'rating':_0x47d52f,'comment':_0xdcf13d,'alertReason':_0x42a375}),this[_0x208c94(0x145)](_0x116023[_0x208c94(0xf2)],_0x116023[_0x208c94(0x10c)],{'success':!![]},_0x116023[_0x208c94(0x179)])):this[_0x208c94(0x145)](_0x116023[_0x208c94(0xf2)],_0x116023['command'],{'success':![],'error':_0x208c94(0x217)},_0x116023[_0x208c94(0x179)]);}else _0x116023[_0x208c94(0x10c)]===_0x208c94(0x276)&&(this[_0x208c94(0x1fe)][_0x208c94(0x14e)]('User\x20dismissed\x20automation\x20proposal.'),await this['setStateAsync'](_0x208c94(0x1b6),{'val':![],'ack':!![]}),await this['setStateAsync']('analysis.automation.description',{'val':'','ack':!![]}),this[_0x208c94(0x145)](_0x116023['from'],_0x116023['command'],{'success':!![]},_0x116023[_0x208c94(0x179)]));}}}}}}}}}}}if(require[a0_0x254785(0x12d)]!==module)module[a0_0x254785(0x127)]=_0x65e549=>new CogniLiving(_0x65e549);else new CogniLiving();