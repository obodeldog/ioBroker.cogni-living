const a0_0x21f9c7=a0_0x9d5e;(function(_0x4034be,_0x228524){const _0x4b13f7=a0_0x9d5e,_0x2945b9=_0x4034be();while(!![]){try{const _0x4d41e2=-parseInt(_0x4b13f7(0x119))/0x1*(parseInt(_0x4b13f7(0x22f))/0x2)+parseInt(_0x4b13f7(0x21f))/0x3+-parseInt(_0x4b13f7(0x10c))/0x4*(parseInt(_0x4b13f7(0x20c))/0x5)+parseInt(_0x4b13f7(0x266))/0x6*(-parseInt(_0x4b13f7(0x15e))/0x7)+-parseInt(_0x4b13f7(0x265))/0x8+-parseInt(_0x4b13f7(0x21c))/0x9*(parseInt(_0x4b13f7(0x23d))/0xa)+parseInt(_0x4b13f7(0x1c8))/0xb;if(_0x4d41e2===_0x228524)break;else _0x2945b9['push'](_0x2945b9['shift']());}catch(_0x211f1e){_0x2945b9['push'](_0x2945b9['shift']());}}}(a0_0x2241,0x4a006));const a0_0x4ad5e9=(function(){let _0x199cf5=!![];return function(_0x27bca3,_0x5736d7){const _0x15d226=_0x199cf5?function(){const _0x3e2c6d=a0_0x9d5e;if(_0x5736d7){const _0x9bb00c=_0x5736d7[_0x3e2c6d(0x20f)](_0x27bca3,arguments);return _0x5736d7=null,_0x9bb00c;}}:function(){};return _0x199cf5=![],_0x15d226;};}()),a0_0x36f5dc=a0_0x4ad5e9(this,function(){const _0x382c11=a0_0x9d5e;return a0_0x36f5dc['toString']()[_0x382c11(0x238)]('(((.+)+)+)+$')[_0x382c11(0x27b)]()[_0x382c11(0x18a)](a0_0x36f5dc)[_0x382c11(0x238)](_0x382c11(0x213));});a0_0x36f5dc();'use strict';function a0_0x2241(){const _0x5ea9e5=['briefingTime','testContext','python3','SIMULATION:\x20Test-Vorschlag\x20f√ºr\x20','location','city','Restoring\x20sensor\x20cache...','22812823AQqJBR','Trigger\x20Action','forEach','AI\x20Training','toFixed','analysis.security','close','Wetterdaten\x20deaktiviert.','briefingJob','08:00','string','timestamp','slice','analysisTimer','üöÄ\x20Starting\x20NUUKANNI\x20Logic\x20(v0.10.1)...','triggerDailyDigest','TRAIN_ENERGY','HEALTH_RESULT','analysis.alertReason','analysis.isAlert','Alert\x20Reason','analysis.training.triggerComfort','summary','analysis.energy.heatingScore','toLowerCase','toISOString','.forecast.current.temperature','generateContent','Erstelle\x20ein\x20kurzes\x20\x27Guten\x20Morgen\x27\x20Briefing\x20basierend\x20auf\x20den\x20Events\x20der\x20letzten\x20Nacht.','detected','analysis.automation.detectedPatterns','.Current.Temperature','indicator','Briefing\x20Sched\x20Error:\x20','Trend\x20Value','presence','\x20new\x20patterns.','config','lights','analysis.training.triggerHealth','analysis.security.lastCheck','system.mode','Fokus\x20auf\x20Komfort.','online','enum.functions.*','guest','Adapter','LTM.driftAnalysis.driftDetails','üìû\x20R√ºckruf\x20anfordern','analysisHistory','TRAIN_COMFORT','Scripts','pip.exe','Current\x20Threshold','ANALYZE_TREND','submitFeedback','logDuplicates','warn','üêç\x20Python\x20Pong','COMFORT_RESULT','ack','Event\x20History','data','python_service','getForeignObjectAsync','‚ùå\x20INSTALL\x20FAILED:\x20','PARTY','analysis.automation.targetValue','10CgTcuN','confidence','analysis.health.trendValue','apply','kontakt','useWeather','notifyTelegramInstance','(((.+)+)+)+$','ltmDriftCheckIntervalHours','notifyEmailEnabled','LTM.trainingData.thermodynamics','name','siren','ROLLE:\x20KI-Hausverwalter.\x20PERSONA:\x20','genAI','Gemini\x20Init\x20Error:\x20','9lQKnBe','livingContext','@google/generative-ai','207234vJEJHw','retry','Insulation\x20Score','Reset\x20Sched\x20Error:\x20','ENERGY_TRAIN_RESULT','rating','fill','exitGraceTimer','analysis.automation.patternDetected','events.history','analysis.security.lastScore','getHours','scheduleJob','TRAIN_SECURITY','fenster','notifyPushoverEnabled','27568RsfRPp','Activity-Level','devices','pip','dailyDigests','toLocaleTimeString','threshold','vacation','getTime','search','analysis.health.todayVector','minDaysForBaseline','system','sendToAsync','3741830OTmoeV','dismissAutomation','üß™\x20Simulating\x20Butler\x20Proposal:\x20','analysis.activitySummary','role','requirements.txt','analysis.lastResult','type','LTM.driftAnalysis.baselineDrift','callback','Trigger\x20Analysis','Training\x20Error:\x20','analysis.automation.autoApply','analysis.automation.targetId','party','‚úÖ\x20HEALTH\x20TRAINED.','PONG','analysis.health','analysis.security.currentThreshold','.forecast.current.state','accuweather','getGenerativeModel','value','ltmStbWindowDays','\x20*\x20*\x20*','message','analysis.training.triggerEnergy','Anomaly\x20Score','automation.triggerAction','dependencyInstallInProgress','splice','N/A','text','getStateAsync','getForeignStateAsync','Sequences','PRIORIT√ÑT:\x20Gesundheit/AAL.','t√ºr','getFullYear','object','3288480QJOrho','3888mkVozk','service.py','exitTimer','isExit','.\x20KONTEXT:\x20','cancel','channel','pr√§senz','json','systemConfig','Daily\x20Digests','currentSystemMode','LTM.triggerDailyDigest','inactivityThresholdHours','analysis.health.lastCheck','now','[RECORDER]\x20Error:\x20','existsSync','temperatur','unshift','Err:\x20','toString','substring','üõ°Ô∏è\x20SECURITY\x20CHECK:\x20Score\x20','write','main','ROLLE:\x20Data\x20Compression\x20Agent.\x20SPRACHE:\x20DE.\x20FORMAT:\x20JSON.\x20ANWEISUNG:\x20Fasse\x20Sensor-Events\x20zusammen.\x20SCHEMA:\x20{\x20\x22summary\x22:\x20\x22string\x22,\x20\x22activityLevel\x22:\x20\x22string\x22\x20}\x20\x0a\x0aEVENTS:\x0a','ANALYZE_SEQUENCE','temperature','sensorLastValues','Target\x20Value','System\x20Mode','split','analysis.energy.insulationScore','¬∞C,\x20','Target\x20ID','info','ü§ñ\x20BUTLER:\x20No\x20valid\x20target\x20ID\x20or\x20value\x20stored\x20for\x20execution.','klima','LTM\x20Sched\x20Error:\x20','Anomaly\x20Detected','Keine\x20Wetterdaten\x20verf√ºgbar.','driftDetails','isEmergency','number','from','status','bind','boolean','presenceDevices','Who\x20is\x20present?','isPresent','autoApply','stdin','log','.\x20EVENTS:\x20','.\x20SYSTEM_MODE:\x20','alertReason','Digest','Heating\x20Score','\x20=\x20','schalter','Security\x20Monitor','switch','üõãÔ∏è\x20BUTLER:\x20Keine\x20neuen\x20Muster\x20gefunden.','events.history_debug_00','modeResetJob','Lernphase\x20(','Aktiv\x20(','light','bin','some','‚úÖ\x20Alarm\x20quittiert.\x20System\x20normal.','getForeignObjectsAsync','ü§ñ\x20Autopilot:\x20Running\x20periodic\x20analysis...','sendTo','getObjectAsync','automationProposal','description','door','Vom\x20Benutzer\x20best√§tigt\x20(OK).','Deaktiviert\x20(Pro-Feature)','payload','outdoorSensorId','\x0aGrund:\x20','716404htkizW','change_percent','\x20Tage)','targetId','ready','send','systemUUID','analysis.triggerBriefing','openweathermap','details','onUnload','setObjectNotExistsAsync','subscribeStates','10LxqWWK','notifyEmailInstance','üåÖ\x20Morning\x20Briefing:\x0a','BUTLER\x20Execution\x20Error:\x20','NORMAL','driftAnalysisTimer','contact','floor','Energy\x20Intelligence','analysis.trigger','find','Success:\x20','weatherInstance','analysis.health.trendDiagnosis','Started...','rule','activityLevel','.\x20WETTER:\x20','isAlert','error','startsWith','motion','models/gemini-flash-latest','Detected\x20Patterns','Keine\x20Details.','val','Kein\x20API\x20Key!','Train\x20Security','replace','subscribeForeignStatesAsync','exports','push','delObjectAsync','.venv','geminiApiKey','üõãÔ∏è\x20Triggering\x20Comfort\x20Analysis\x20(Pattern\x20Mining)...','onReady','Last\x20Check','onMessage','WiFi\x20Presence\x20detected.','heating','stringify','analysis.energy','win32','common','getEnums','‚úÖ\x20Alles\x20OK\x20(Reset)','Analysiere\x20ausgewogen.','ANALYZE_HEALTH','longitude','application/json','licht','ROLLE:\x20Data\x20Scientist.\x20ZIEL:\x20Drift\x20erkennen.\x20SCHEMA:\x20{\x20\x22baselineDrift\x22:\x20\x22none|slight|significant|critical\x22,\x20\x22driftDetails\x22:\x20\x22string\x22\x20}\x0a\x0aLTB:\x20','unknown','sound','\x22\x20install\x20--no-cache-dir\x20--force-reinstall\x20-r\x20\x22','ltmLtbWindowDays','system.isPresent','\x0aSTB:\x20','scanDevices','notifyEmailRecipient','Kalender\x20deaktiviert.','rmSync','weatherunderground','HEALTH_TRAIN_RESULT','response','Description','command','pythonProcess','6034WdAIbY','debug','unload','.forecast.current.temp','setStateAsync','System','.NextHours.Location_1.Day_1.current.temp_value','child_process','Failed:\x20','join','communicate.request','[LOG]','getMinutes','ANOMALY','bewegung','analysis.health.isAnomaly','N/A\x20(Learning)','LTM.trainingData.sequences','Missing\x20data','length','shift','User\x20dismissed\x20automation\x20proposal.','notifyTelegramEnabled','rawEventLog','button','analysis.automation.triggerAction','setHours','Regel\x20erkannt:\x20','Alarm','LTM.processingStatus','ltmJob','stateChange','PRIORIT√ÑT:\x20Sicherheit.','.\x20EMERGENCY:\x20','calendarInstance','daswetter','parse','includes','indicator.alarm','isProVersion','system.presenceWho','version','generic','analysis.training.status','constructor','analysis.training.triggerSecurity','Gemini\x20Error:\x20','analysis.automation.description','üîç\x20Scanning\x20for\x20devices...','namespace','apiKey','baselineDrift','Last\x20raw\x20event','0\x204\x20*\x20*\x20*','is_anomaly','.\x20ANWESEND:\x20','COGNI_CONFIRM_OK','Fokus\x20auf\x20Familienroutinen.','notifyTelegramRecipient','eventHistory','geminiModel','doors','.\x20AUFGABE:\x201.\x20Gesundheit?\x202.\x20Komfort?\x20FORMAT\x20(JSON):\x20{\x20\x22isAlert\x22:\x20boolean,\x20\x22alertReason\x22:\x20\x22string\x22,\x20\x22isEmergency\x22:\x20boolean,\x20\x22summary\x22:\x20\x22string\x22,\x20\x22automationProposal\x22:\x20{\x20\x22detected\x22:\x20boolean,\x20\x22description\x22:\x20\x22string\x22,\x20\x22targetId\x22:\x20\x22string\x22,\x20\x22targetValue\x22:\x20\x22any\x22\x20}\x20}','TRAIN_HEALTH','text.alarm','targetValue','analysis.analysisHistory','Activity\x20Summary','onStateChange','Alert\x20Status','platform','aiPersona','system.config','trim','success','values','pop','python3\x20-m\x20venv\x20\x22','isGracePeriodActive','setState','extendObjectAsync','Unknown','LTM.baselineStatus','COGNI_REQUEST_CALL','events.lastEvent','Today\x20Vector\x20(15m)','LTM.rawEventLog','cogni-living','triggerBriefing','state','OK:\x20','Keine\x20Termine.','LTM','telegram','No\x20instance','Skipped\x20(No\x20AI\x20or\x20Data)','TRAINING_COMPLETE','lastAlertState','dimmer'];a0_0x2241=function(){return _0x5ea9e5;};return a0_0x2241();}const utils=require('@iobroker/adapter-core'),{GoogleGenerativeAI}=require(a0_0x21f9c7(0x21e)),schedule=require('node-schedule'),{spawn,exec}=require(a0_0x21f9c7(0x165)),path=require('path'),fs=require('fs'),HISTORY_MAX_SIZE=0x32,RAW_LOG_MAX_SIZE=0x9c4,LTM_MIN_EVENTS_FOR_COMPRESSION=0x5,GEMINI_MODEL=a0_0x21f9c7(0x12f),LTM_SCHEDULE='0\x203\x20*\x20*\x20*',MODE_RESET_SCHEDULE=a0_0x21f9c7(0x193),SEQUENCE_TIMEOUT_MS=0x5*0x3c*0x3e8,MAX_TRAINING_SET_SIZE=0x1f4,THERMO_LOG_SIZE=0x3e8,EXIT_TIMER_MINUTES=0xf,EXIT_GRACE_PERIOD_SECONDS=0x1e,LTM_DP_RAW_LOG=a0_0x21f9c7(0x1b4),LTM_DP_DAILY_DIGESTS='LTM.dailyDigests',LTM_DP_STATUS=a0_0x21f9c7(0x17b),LTM_DP_TRIGGER_DIGEST=a0_0x21f9c7(0x272),LTM_DP_BASELINE_STATUS=a0_0x21f9c7(0x1b0),LTM_DP_DRIFT_CHANNEL='LTM.driftAnalysis',LTM_DP_DRIFT_STATUS=a0_0x21f9c7(0x245),LTM_DP_DRIFT_DETAILS=a0_0x21f9c7(0x1f7),LTM_DP_DRIFT_LAST_CHECK='LTM.driftAnalysis.lastCheck',SYSTEM_DP_MODE=a0_0x21f9c7(0x1f1),SYSTEM_MODES={'NORMAL':'normal','VACATION':a0_0x21f9c7(0x236),'PARTY':a0_0x21f9c7(0x24b),'GUEST':a0_0x21f9c7(0x1f5)},AUTO_RESET_MODES=[SYSTEM_MODES[a0_0x21f9c7(0x20a)],SYSTEM_MODES['GUEST']],PERSONA_MAPPING={'generic':a0_0x21f9c7(0x148),'senior_aal':a0_0x21f9c7(0x261),'family':a0_0x21f9c7(0x197),'single_comfort':a0_0x21f9c7(0x1f2),'security':a0_0x21f9c7(0x17e)},ACTIVITY_LEVEL_MAP={'sehr\x20hoch':0x64,'hoch':0x50,'normal':0x3c,'niedrig':0x28,'sehr\x20niedrig':0x14,'inaktiv':0x0},IS_WIN=process[a0_0x21f9c7(0x1a4)]===a0_0x21f9c7(0x144),PERSISTENT_DIR=path[a0_0x21f9c7(0x167)](__dirname,a0_0x21f9c7(0x13a)),VENV_PATH=PERSISTENT_DIR,PYTHON_EXE=IS_WIN?path[a0_0x21f9c7(0x167)](VENV_PATH,a0_0x21f9c7(0x1fb),'python.exe'):path[a0_0x21f9c7(0x167)](VENV_PATH,'bin','python'),PIP_EXE=IS_WIN?path['join'](VENV_PATH,a0_0x21f9c7(0x1fb),a0_0x21f9c7(0x1fc)):path[a0_0x21f9c7(0x167)](VENV_PATH,a0_0x21f9c7(0xfd),a0_0x21f9c7(0x232));let activeSequence=[],sequenceTimer=null;async function startSystem(_0x11bf65){const _0x1aeb46=a0_0x21f9c7;_0x11bf65[_0x1aeb46(0xed)]['info'](_0x1aeb46(0x1d6)),await initZombies(_0x11bf65);try{_0x11bf65['isProVersion']=await checkLicense(_0x11bf65[_0x1aeb46(0x1ed)]['licenseKey']);}catch(_0x2bc919){}if(!_0x11bf65[_0x1aeb46(0x1ed)][_0x1aeb46(0x273)]||_0x11bf65['config'][_0x1aeb46(0x273)]<0.1)_0x11bf65[_0x1aeb46(0x1ed)][_0x1aeb46(0x273)]=0xc;await initHistory(_0x11bf65),await initSystemConfig(_0x11bf65);if(_0x11bf65[_0x1aeb46(0x1ed)][_0x1aeb46(0x13b)])try{_0x11bf65[_0x1aeb46(0x21a)]=new GoogleGenerativeAI(_0x11bf65[_0x1aeb46(0x1ed)][_0x1aeb46(0x13b)]),_0x11bf65[_0x1aeb46(0x19a)]=_0x11bf65[_0x1aeb46(0x21a)][_0x1aeb46(0x252)]({'model':GEMINI_MODEL,'generationConfig':{'responseMimeType':_0x1aeb46(0x14b)}}),_0x11bf65[_0x1aeb46(0xed)]['info']('Gemini\x20AI\x20initialized.');}catch(_0x5d331e){_0x11bf65['log'][_0x1aeb46(0x12c)](_0x1aeb46(0x21b)+_0x5d331e['message']);}await createAllObjects(_0x11bf65),await loadSystemMode(_0x11bf65),await loadRawEventLog(_0x11bf65),await loadDailyDigests(_0x11bf65),_0x11bf65[_0x1aeb46(0x118)](_0x1aeb46(0x122)),_0x11bf65[_0x1aeb46(0x118)](LTM_DP_TRIGGER_DIGEST),_0x11bf65[_0x1aeb46(0x118)](_0x1aeb46(0x1f1)),_0x11bf65[_0x1aeb46(0x118)](_0x1aeb46(0x113)),_0x11bf65[_0x1aeb46(0x118)](_0x1aeb46(0x177)),_0x11bf65[_0x1aeb46(0x118)](_0x1aeb46(0x249)),_0x11bf65[_0x1aeb46(0x118)](_0x1aeb46(0x18b)),_0x11bf65[_0x1aeb46(0x118)](_0x1aeb46(0x1ef)),_0x11bf65[_0x1aeb46(0x118)](_0x1aeb46(0x257)),_0x11bf65[_0x1aeb46(0x118)](_0x1aeb46(0x1dd)),await initSensorSubscriptions(_0x11bf65),await initPresenceSubscriptions(_0x11bf65),await setupTelegramListener(_0x11bf65),setTimeout(()=>checkWifiPresence(_0x11bf65),0x1388);if(_0x11bf65[_0x1aeb46(0x1d5)])clearInterval(_0x11bf65['analysisTimer']);const _0x34f53a=_0x11bf65[_0x1aeb46(0x1ed)]['analysisInterval']||0xf;_0x34f53a>0x0&&(_0x11bf65['analysisTimer']=setInterval(()=>{runAutopilot(_0x11bf65);},_0x34f53a*0x3c*0x3e8)),setupLtmScheduler(_0x11bf65),setupModeResetScheduler(_0x11bf65),setupDriftAnalysisScheduler(_0x11bf65),setupBriefingScheduler(_0x11bf65),startPythonService(_0x11bf65),setTimeout(()=>{const _0x588694=_0x1aeb46;if(_0x11bf65[_0x588694(0x15d)])runPythonHealthCheck(_0x11bf65);updateHealthVector(_0x11bf65);},0x1388);}async function runAutopilot(_0x151113){const _0x25423e=a0_0x21f9c7;_0x151113['log']['debug'](_0x25423e(0x101)),await runGeminiAnalysis(_0x151113),updateHealthVector(_0x151113);}function updateHealthVector(_0x39709a){const _0x1d01cf=a0_0x21f9c7;if(!_0x39709a['rawEventLog']||_0x39709a[_0x1d01cf(0x175)]['length']===0x0)return;const _0x4c6b32=new Array(0x60)[_0x1d01cf(0x225)](0x0),_0x54ad0e=new Date()[_0x1d01cf(0x178)](0x0,0x0,0x0,0x0);_0x39709a[_0x1d01cf(0x175)][_0x1d01cf(0x1ca)](_0x9d32d5=>{const _0x2e2415=_0x1d01cf,_0x2dc1a8=new Date(_0x9d32d5[_0x2e2415(0x1d3)]);if(_0x2dc1a8['getTime']()>=_0x54ad0e){const _0x243c8e=_0x2dc1a8[_0x2e2415(0x22a)](),_0x3983b9=_0x2dc1a8[_0x2e2415(0x16a)](),_0x3b3755=_0x243c8e*0x4+Math[_0x2e2415(0x120)](_0x3983b9/0xf);if(_0x3b3755>=0x0&&_0x3b3755<0x60)_0x4c6b32[_0x3b3755]++;}}),_0x39709a['setStateAsync'](_0x1d01cf(0x239),{'val':JSON['stringify'](_0x4c6b32),'ack':!![]});}async function scanForDevices(_0x5d4754,_0x547ec3){const _0x264450=a0_0x21f9c7;_0x5d4754[_0x264450(0xed)][_0x264450(0xdb)](_0x264450(0x18e));const _0x166f4a=[],_0x38acea=await _0x5d4754[_0x264450(0x100)]('*');for(const _0x3d0171 in _0x38acea){const _0x54b8a2=_0x38acea[_0x3d0171];if(_0x54b8a2&&_0x54b8a2[_0x264450(0x145)]&&_0x54b8a2[_0x264450(0x244)]===_0x264450(0x1b7)){const _0x26d996=(_0x54b8a2['common'][_0x264450(0x217)]&&typeof _0x54b8a2[_0x264450(0x145)][_0x264450(0x217)]===_0x264450(0x264)?_0x54b8a2['common'][_0x264450(0x217)]['de']:_0x54b8a2[_0x264450(0x145)][_0x264450(0x217)])||'',_0x18db6a=_0x54b8a2[_0x264450(0x145)][_0x264450(0x241)]||'';let _0x37a0e3=null;if(_0x547ec3[_0x264450(0x12e)]&&(_0x18db6a[_0x264450(0x183)]('motion')||_0x26d996[_0x264450(0x1e0)]()[_0x264450(0x183)]('bewegung')))_0x37a0e3=_0x264450(0x12e);else{if(_0x547ec3[_0x264450(0x19b)]&&(_0x18db6a[_0x264450(0x183)](_0x264450(0x106))||_0x18db6a['includes']('window')||_0x26d996[_0x264450(0x1e0)]()[_0x264450(0x183)](_0x264450(0x262))||_0x26d996['toLowerCase']()[_0x264450(0x183)](_0x264450(0x22d))))_0x37a0e3=_0x264450(0x106);else{if(_0x547ec3[_0x264450(0x1ee)]&&(_0x18db6a[_0x264450(0x183)]('light')||_0x18db6a[_0x264450(0x183)](_0x264450(0xf6))||_0x26d996[_0x264450(0x1e0)]()['includes'](_0x264450(0x14c))))_0x37a0e3=_0x264450(0xfc);else{if(_0x547ec3[_0x264450(0x282)]&&(_0x18db6a['includes']('temperature')||_0x26d996[_0x264450(0x1e0)]()[_0x264450(0x183)]('temperatur')))_0x37a0e3=_0x264450(0x282);}}}if(_0x37a0e3){let _0x2d16b7='';const _0x5f42db=_0x3d0171[_0x264450(0x286)]('.');if(_0x5f42db[_0x264450(0x171)]>0x2)_0x2d16b7=_0x5f42db[0x2];_0x166f4a[_0x264450(0x138)]({'id':_0x3d0171,'name':_0x26d996||_0x3d0171,'type':_0x37a0e3,'location':_0x2d16b7,'_score':0x32});}}}return _0x166f4a;}async function getWeatherContext(_0x4d8f20){const _0x4bc5f0=a0_0x21f9c7;if(!_0x4d8f20[_0x4bc5f0(0x1ed)][_0x4bc5f0(0x211)]||!_0x4d8f20[_0x4bc5f0(0x1ed)][_0x4bc5f0(0x125)])return _0x4bc5f0(0x1cf);try{const _0x12f36f=_0x4d8f20['config'][_0x4bc5f0(0x125)];let _0x336c41=await _0x4d8f20['getForeignStateAsync'](_0x12f36f+_0x4bc5f0(0x1e7));if(!_0x336c41)_0x336c41=await _0x4d8f20[_0x4bc5f0(0x25f)](_0x12f36f+_0x4bc5f0(0x1e2));let _0x53208b=await _0x4d8f20['getForeignStateAsync'](_0x12f36f+'.Current.WeatherText');if(!_0x53208b)_0x53208b=await _0x4d8f20[_0x4bc5f0(0x25f)](_0x12f36f+_0x4bc5f0(0x250));if(_0x336c41&&_0x53208b)return _0x336c41['val']+_0x4bc5f0(0x288)+_0x53208b['val'];}catch(_0x208603){}return _0x4bc5f0(0xe0);}async function getCalendarContext(_0x51efe9){const _0x1da0fe=a0_0x21f9c7;if(!_0x51efe9['config']['useCalendar']||!_0x51efe9[_0x1da0fe(0x1ed)][_0x1da0fe(0x180)])return _0x1da0fe(0x156);return _0x1da0fe(0x1b9);}async function getCalendarNames(_0x1368b6,_0x531529){return[];}async function saveFeedback(_0x11fd14,_0x3d1c43){const _0x2be8b4=a0_0x21f9c7;_0x11fd14[_0x2be8b4(0xed)][_0x2be8b4(0xdb)]('üìù\x20Feedback\x20received:\x20'+_0x3d1c43[_0x2be8b4(0x224)]);}async function sendMorningBriefing(_0xe3ee15){const _0x5c816c=a0_0x21f9c7;if(!_0xe3ee15[_0x5c816c(0x19a)])return;try{const _0x529c47=_0x5c816c(0x1e4),_0x46e830=await _0xe3ee15[_0x5c816c(0x19a)][_0x5c816c(0x1e3)](_0x529c47),_0x5e3db9=_0x46e830[_0x5c816c(0x15a)][_0x5c816c(0x25d)]();sendNotification(_0xe3ee15,_0x5c816c(0x11b)+_0x5e3db9);}catch(_0xe26820){_0xe3ee15[_0x5c816c(0xed)][_0x5c816c(0x12c)]('Briefing\x20Error:\x20'+_0xe26820[_0x5c816c(0x256)]);}}function checkAndInstall(_0x234121){const _0x45bdbc=a0_0x21f9c7;if(!fs[_0x45bdbc(0x277)](VENV_PATH)||!fs['existsSync'](PIP_EXE))return _0x234121[_0x45bdbc(0xed)][_0x45bdbc(0x201)]('‚ö†Ô∏è\x20Python\x20VENV\x20missing.\x20Installing\x20locally...'),installPythonDependencies(_0x234121),![];return!![];}function installPythonDependencies(_0x3a0d82){const _0x5b8918=a0_0x21f9c7;if(_0x3a0d82[_0x5b8918(0x25a)])return;_0x3a0d82[_0x5b8918(0x25a)]=!![];const _0xda45ec=path[_0x5b8918(0x167)](__dirname,_0x5b8918(0x207),_0x5b8918(0x242));stopPythonService(_0x3a0d82);if(fs[_0x5b8918(0x277)](VENV_PATH))try{fs[_0x5b8918(0x157)](VENV_PATH,{'recursive':!![],'force':!![]});}catch(_0x42feba){}exec(_0x5b8918(0x1ab)+VENV_PATH+'\x22',_0x1273a7=>{const _0x3b00f0=_0x5b8918;if(_0x1273a7){_0x3a0d82['log'][_0x3b00f0(0x12c)]('‚ùå\x20VENV\x20FAILED:\x20'+_0x1273a7['message']),_0x3a0d82[_0x3b00f0(0x25a)]=![];return;}installRequirementsInVenv(_0x3a0d82,_0xda45ec);});}function installRequirementsInVenv(_0xf60d06,_0x4977b2){const _0x6a4f37=a0_0x21f9c7;_0xf60d06[_0x6a4f37(0xed)]['info']('Installing\x20pip\x20packages...');const _0x1586dd='\x22'+PIP_EXE+_0x6a4f37(0x150)+_0x4977b2+'\x22';exec(_0x1586dd,{'timeout':0x124f80},(_0x45b70e,_0x361bac,_0x21a664)=>{const _0x297c89=_0x6a4f37;_0xf60d06[_0x297c89(0x25a)]=![],_0x45b70e?_0xf60d06[_0x297c89(0xed)][_0x297c89(0x12c)](_0x297c89(0x209)+(_0x21a664||_0x45b70e[_0x297c89(0x256)])):(_0xf60d06[_0x297c89(0xed)][_0x297c89(0xdb)]('‚úÖ\x20INSTALL\x20SUCCESS.'),startSystem(_0xf60d06));});}async function initZombies(_0x22b8c3){const _0x1bc1da=a0_0x21f9c7;try{const _0x497701=['analysis.history_debug_00',_0x1bc1da(0xf8)];for(const _0x1a747a of _0x497701){try{const _0x618d89=await _0x22b8c3[_0x1bc1da(0x103)](_0x1a747a);if(_0x618d89)await _0x22b8c3[_0x1bc1da(0x139)](_0x1a747a);}catch(_0x3a89b9){}}}catch(_0x1ddc49){}}async function checkLicense(_0x51cd69){return!![];}function a0_0x9d5e(_0x43fcc4,_0x1305f9){const _0x49acb9=a0_0x2241();return a0_0x9d5e=function(_0x36f5dc,_0x4ad5e9){_0x36f5dc=_0x36f5dc-0xda;let _0x224130=_0x49acb9[_0x36f5dc];return _0x224130;},a0_0x9d5e(_0x43fcc4,_0x1305f9);}async function initHistory(_0x4617b3){const _0x308a8b=a0_0x21f9c7;try{const _0x28cf27=await _0x4617b3['getStateAsync'](_0x308a8b(0x228));_0x28cf27&&_0x28cf27[_0x308a8b(0x132)]&&(_0x4617b3['eventHistory']=JSON[_0x308a8b(0x182)](_0x28cf27[_0x308a8b(0x132)][_0x308a8b(0x27b)]()));}catch(_0x2fd4a4){_0x4617b3['eventHistory']=[];}try{const _0x16a781=await _0x4617b3['getStateAsync'](_0x308a8b(0x1a0));if(_0x16a781&&_0x16a781['val'])_0x4617b3['analysisHistory']=JSON['parse'](_0x16a781[_0x308a8b(0x132)][_0x308a8b(0x27b)]());}catch(_0x1ada4b){_0x4617b3[_0x308a8b(0x1f9)]=[];}if(_0x4617b3[_0x308a8b(0x199)]&&_0x4617b3[_0x308a8b(0x199)][_0x308a8b(0x171)]>0x0){_0x4617b3['log'][_0x308a8b(0xdb)](_0x308a8b(0x1c7));for(let _0x526ea0=_0x4617b3[_0x308a8b(0x199)]['length']-0x1;_0x526ea0>=0x0;_0x526ea0--){const _0x17be4e=_0x4617b3[_0x308a8b(0x199)][_0x526ea0];if(_0x17be4e&&_0x17be4e['id']!==undefined&&_0x17be4e[_0x308a8b(0x253)]!==undefined)_0x4617b3[_0x308a8b(0x283)][_0x17be4e['id']]=_0x17be4e['value'];}}}async function initSystemConfig(_0x406022){const _0x14d8a8=a0_0x21f9c7;try{const _0x4ba579=await _0x406022[_0x14d8a8(0x208)](_0x14d8a8(0x1a6));if(_0x4ba579&&_0x4ba579[_0x14d8a8(0x145)])_0x406022[_0x14d8a8(0x26f)]={'latitude':_0x4ba579[_0x14d8a8(0x145)]['latitude']||0x0,'longitude':_0x4ba579[_0x14d8a8(0x145)][_0x14d8a8(0x14a)]||0x0,'city':_0x4ba579[_0x14d8a8(0x145)][_0x14d8a8(0x1c6)]||''};}catch(_0x2f6455){}}async function createAllObjects(_0x572d31){const _0xe23c70=a0_0x21f9c7;await _0x572d31['extendObjectAsync'](_0xe23c70(0x23b),{'type':'channel','common':{'name':_0xe23c70(0x163)},'native':{}}),await _0x572d31[_0xe23c70(0x1ae)](SYSTEM_DP_MODE,{'type':_0xe23c70(0x1b7),'common':{'name':_0xe23c70(0x285),'type':_0xe23c70(0x1d2),'role':'state','read':!![],'write':!![],'def':SYSTEM_MODES[_0xe23c70(0x11d)]},'native':{}}),await _0x572d31[_0xe23c70(0x117)](_0xe23c70(0x186),{'type':'state','common':{'name':_0xe23c70(0xe9),'type':_0xe23c70(0x1d2),'role':'text','read':!![],'write':![]},'native':{}}),await _0x572d31['setObjectNotExistsAsync'](_0xe23c70(0x1b2),{'type':'state','common':{'name':_0xe23c70(0x192),'type':_0xe23c70(0x1d2),'role':_0xe23c70(0x26e),'read':!![],'write':![]},'native':{}}),await _0x572d31[_0xe23c70(0x117)](_0xe23c70(0x228),{'type':'state','common':{'name':_0xe23c70(0x205),'type':'string','role':_0xe23c70(0x26e),'read':!![],'write':![]},'native':{}}),await _0x572d31[_0xe23c70(0x1ae)]('analysis.training',{'type':'channel','common':{'name':_0xe23c70(0x1cb)},'native':{}}),await _0x572d31['setObjectNotExistsAsync'](_0xe23c70(0x18b),{'type':_0xe23c70(0x1b7),'common':{'name':_0xe23c70(0x134),'type':_0xe23c70(0xe7),'role':_0xe23c70(0x176),'read':!![],'write':!![]},'native':{}}),await _0x572d31[_0xe23c70(0x117)](_0xe23c70(0x1ef),{'type':_0xe23c70(0x1b7),'common':{'name':'Train\x20Health','type':'boolean','role':_0xe23c70(0x176),'read':!![],'write':!![]},'native':{}}),await _0x572d31[_0xe23c70(0x117)](_0xe23c70(0x257),{'type':_0xe23c70(0x1b7),'common':{'name':'Train\x20Energy','type':'boolean','role':_0xe23c70(0x176),'read':!![],'write':!![]},'native':{}}),await _0x572d31[_0xe23c70(0x117)](_0xe23c70(0x1dd),{'type':_0xe23c70(0x1b7),'common':{'name':'Train\x20Comfort','type':_0xe23c70(0xe7),'role':'button','read':!![],'write':!![]},'native':{}}),await _0x572d31[_0xe23c70(0x117)]('analysis.training.status',{'type':_0xe23c70(0x1b7),'common':{'name':'Training\x20Status','type':'string','role':'text','read':!![],'write':![]},'native':{}}),await _0x572d31[_0xe23c70(0x1ae)](_0xe23c70(0x1cd),{'type':_0xe23c70(0x26c),'common':{'name':_0xe23c70(0xf5)},'native':{}}),await _0x572d31[_0xe23c70(0x117)]('analysis.security.lastScore',{'type':'state','common':{'name':_0xe23c70(0x258),'type':_0xe23c70(0xe3),'role':_0xe23c70(0x253),'read':!![],'write':![]},'native':{}}),await _0x572d31['setObjectNotExistsAsync'](_0xe23c70(0x24f),{'type':_0xe23c70(0x1b7),'common':{'name':_0xe23c70(0x1fd),'type':'number','role':_0xe23c70(0x253),'read':!![],'write':![],'def':0.05},'native':{}}),await _0x572d31[_0xe23c70(0x117)](_0xe23c70(0x1f0),{'type':_0xe23c70(0x1b7),'common':{'name':_0xe23c70(0x13e),'type':_0xe23c70(0x1d2),'role':'date','read':!![],'write':![]},'native':{}}),await _0x572d31[_0xe23c70(0x1ae)](_0xe23c70(0x24e),{'type':_0xe23c70(0x26c),'common':{'name':'Health\x20Analysis'},'native':{}}),await _0x572d31['setObjectNotExistsAsync'](_0xe23c70(0x274),{'type':_0xe23c70(0x1b7),'common':{'name':_0xe23c70(0x13e),'type':_0xe23c70(0x1d2),'role':'date','read':!![],'write':![]},'native':{}}),await _0x572d31[_0xe23c70(0x117)]('analysis.health.isAnomaly',{'type':_0xe23c70(0x1b7),'common':{'name':_0xe23c70(0xdf),'type':_0xe23c70(0xe7),'role':_0xe23c70(0x1e8),'read':!![],'write':![]},'native':{}}),await _0x572d31[_0xe23c70(0x117)](_0xe23c70(0x126),{'type':_0xe23c70(0x1b7),'common':{'name':'Trend','type':_0xe23c70(0x1d2),'role':_0xe23c70(0x25d),'read':!![],'write':![]},'native':{}}),await _0x572d31['setObjectNotExistsAsync'](_0xe23c70(0x20e),{'type':_0xe23c70(0x1b7),'common':{'name':_0xe23c70(0x1ea),'type':_0xe23c70(0xe3),'role':_0xe23c70(0x253),'read':!![],'write':![]},'native':{}}),await _0x572d31['setObjectNotExistsAsync'](_0xe23c70(0x239),{'type':_0xe23c70(0x1b7),'common':{'name':_0xe23c70(0x1b3),'type':_0xe23c70(0x1d2),'role':'json','read':!![],'write':![]},'native':{}}),await _0x572d31[_0xe23c70(0x1ae)](_0xe23c70(0x143),{'type':_0xe23c70(0x26c),'common':{'name':_0xe23c70(0x121)},'native':{}}),await _0x572d31['setObjectNotExistsAsync'](_0xe23c70(0x287),{'type':_0xe23c70(0x1b7),'common':{'name':_0xe23c70(0x221),'type':_0xe23c70(0x1d2),'role':_0xe23c70(0x25d),'read':!![],'write':![]},'native':{}}),await _0x572d31['setObjectNotExistsAsync'](_0xe23c70(0x1df),{'type':_0xe23c70(0x1b7),'common':{'name':_0xe23c70(0xf2),'type':_0xe23c70(0x1d2),'role':_0xe23c70(0x25d),'read':!![],'write':![]},'native':{}}),await _0x572d31[_0xe23c70(0x1ae)](_0xe23c70(0x1ba),{'type':'channel','common':{'name':'LTM'},'native':{}}),await _0x572d31[_0xe23c70(0x1ae)](LTM_DP_RAW_LOG,{'type':_0xe23c70(0x1b7),'common':{'name':'Raw\x20Log','type':'string','role':_0xe23c70(0x26e),'read':!![],'write':![]},'native':{}}),await _0x572d31[_0xe23c70(0x1ae)](LTM_DP_DAILY_DIGESTS,{'type':'state','common':{'name':_0xe23c70(0x270),'type':_0xe23c70(0x1d2),'role':_0xe23c70(0x26e),'read':!![],'write':![]},'native':{}}),await _0x572d31[_0xe23c70(0x117)](_0xe23c70(0x16f),{'type':'state','common':{'name':_0xe23c70(0x260),'type':_0xe23c70(0x1d2),'role':_0xe23c70(0x26e),'read':!![],'write':![]},'native':{}}),await _0x572d31[_0xe23c70(0x117)]('LTM.trainingData.thermodynamics',{'type':_0xe23c70(0x1b7),'common':{'name':'Thermodynamics','type':_0xe23c70(0x1d2),'role':'json','read':!![],'write':![]},'native':{}}),await _0x572d31[_0xe23c70(0x117)](_0xe23c70(0x122),{'type':_0xe23c70(0x1b7),'common':{'name':_0xe23c70(0x247),'type':_0xe23c70(0xe7),'role':'button','read':!![],'write':!![]},'native':{}}),await _0x572d31[_0xe23c70(0x117)](_0xe23c70(0x113),{'type':_0xe23c70(0x1b7),'common':{'name':'Trigger\x20Briefing','type':'boolean','role':'button','read':!![],'write':!![]},'native':{}}),await _0x572d31[_0xe23c70(0x117)](_0xe23c70(0x1db),{'type':'state','common':{'name':_0xe23c70(0x1a3),'type':_0xe23c70(0xe7),'role':_0xe23c70(0x184),'read':!![],'write':![]},'native':{}}),await _0x572d31[_0xe23c70(0x117)](_0xe23c70(0x1da),{'type':_0xe23c70(0x1b7),'common':{'name':_0xe23c70(0x1dc),'type':_0xe23c70(0x1d2),'role':_0xe23c70(0x19e),'read':!![],'write':![]},'native':{}}),await _0x572d31[_0xe23c70(0x117)](_0xe23c70(0x240),{'type':_0xe23c70(0x1b7),'common':{'name':_0xe23c70(0x1a1),'type':'string','role':'text','read':!![],'write':![]},'native':{}}),await _0x572d31[_0xe23c70(0x117)](_0xe23c70(0x227),{'type':_0xe23c70(0x1b7),'common':{'name':'Pattern\x20Detected','type':_0xe23c70(0xe7),'role':_0xe23c70(0x1e8),'read':!![],'write':![]},'native':{}}),await _0x572d31[_0xe23c70(0x117)]('analysis.automation.description',{'type':_0xe23c70(0x1b7),'common':{'name':_0xe23c70(0x15b),'type':_0xe23c70(0x1d2),'role':'text','read':!![],'write':![]},'native':{}}),await _0x572d31[_0xe23c70(0x117)](_0xe23c70(0x1e6),{'type':'state','common':{'name':_0xe23c70(0x130),'type':_0xe23c70(0x1d2),'role':_0xe23c70(0x26e),'read':!![],'write':![]},'native':{}}),await _0x572d31[_0xe23c70(0x117)](_0xe23c70(0x24a),{'type':_0xe23c70(0x1b7),'common':{'name':_0xe23c70(0xda),'type':'string','role':_0xe23c70(0x25d),'read':!![],'write':![]},'native':{}}),await _0x572d31[_0xe23c70(0x117)](_0xe23c70(0x20b),{'type':_0xe23c70(0x1b7),'common':{'name':_0xe23c70(0x284),'type':_0xe23c70(0x1d2),'role':_0xe23c70(0x25d),'read':!![],'write':![]},'native':{}}),await _0x572d31[_0xe23c70(0x117)](_0xe23c70(0x249),{'type':_0xe23c70(0x1b7),'common':{'name':'Auto\x20Apply','type':_0xe23c70(0xe7),'role':_0xe23c70(0xf6),'read':!![],'write':!![]},'native':{}}),await _0x572d31[_0xe23c70(0x117)](_0xe23c70(0x177),{'type':_0xe23c70(0x1b7),'common':{'name':_0xe23c70(0x1c9),'type':_0xe23c70(0xe7),'role':_0xe23c70(0x176),'read':!![],'write':!![]},'native':{}});}async function loadSystemMode(_0x2fe7f0){const _0x51455c=a0_0x21f9c7;try{const _0x5d9edc=await _0x2fe7f0[_0x51455c(0x25e)](SYSTEM_DP_MODE);_0x5d9edc&&_0x5d9edc[_0x51455c(0x132)]&&Object[_0x51455c(0x1a9)](SYSTEM_MODES)['includes'](_0x5d9edc[_0x51455c(0x132)])?_0x2fe7f0[_0x51455c(0x271)]=_0x5d9edc[_0x51455c(0x132)]:(_0x2fe7f0[_0x51455c(0x271)]=SYSTEM_MODES[_0x51455c(0x11d)],await _0x2fe7f0['setStateAsync'](SYSTEM_DP_MODE,{'val':SYSTEM_MODES[_0x51455c(0x11d)],'ack':!![]}));}catch(_0xb84725){_0x2fe7f0[_0x51455c(0x271)]=SYSTEM_MODES[_0x51455c(0x11d)];}}async function loadRawEventLog(_0x2f71ff){const _0x26581f=a0_0x21f9c7;try{const _0x44f197=await _0x2f71ff[_0x26581f(0x25e)](LTM_DP_RAW_LOG);if(_0x44f197&&_0x44f197[_0x26581f(0x132)])_0x2f71ff[_0x26581f(0x175)]=JSON[_0x26581f(0x182)](_0x44f197[_0x26581f(0x132)]);}catch(_0x205f61){_0x2f71ff[_0x26581f(0x175)]=[];}}async function saveRawEventLog(_0x139af6){const _0x450902=a0_0x21f9c7;if(_0x139af6[_0x450902(0x175)][_0x450902(0x171)]>RAW_LOG_MAX_SIZE)_0x139af6[_0x450902(0x175)]['splice'](0x0,_0x139af6['rawEventLog'][_0x450902(0x171)]-RAW_LOG_MAX_SIZE);await _0x139af6[_0x450902(0x162)](LTM_DP_RAW_LOG,{'val':JSON['stringify'](_0x139af6[_0x450902(0x175)]),'ack':!![]});}async function loadDailyDigests(_0x1f4cde){const _0x4965a9=a0_0x21f9c7;try{const _0x93276b=await _0x1f4cde['getStateAsync'](LTM_DP_DAILY_DIGESTS);if(_0x93276b&&_0x93276b['val'])_0x1f4cde[_0x4965a9(0x233)]=JSON[_0x4965a9(0x182)](_0x93276b[_0x4965a9(0x132)]);}catch(_0x5214f2){_0x1f4cde[_0x4965a9(0x233)]=[];}await updateBaselineStatus(_0x1f4cde);}async function saveDailyDigests(_0x986500,_0x5a005e=!![]){const _0x277039=a0_0x21f9c7,_0x54edb3=_0x986500[_0x277039(0x1ed)]['ltmLtbWindowDays']||0x3c;_0x986500[_0x277039(0x233)]['length']>_0x54edb3&&_0x986500[_0x277039(0x233)][_0x277039(0x25b)](0x0,_0x986500[_0x277039(0x233)][_0x277039(0x171)]-_0x54edb3);await _0x986500[_0x277039(0x162)](LTM_DP_DAILY_DIGESTS,{'val':JSON[_0x277039(0x142)](_0x986500['dailyDigests']),'ack':!![]});if(_0x5a005e)await updateBaselineStatus(_0x986500);}async function updateAnalysisHistory(_0x5e40cd,_0x326416){const _0x450cb8=a0_0x21f9c7;_0x5e40cd[_0x450cb8(0x1f9)]['unshift'](_0x326416);if(_0x5e40cd[_0x450cb8(0x1f9)][_0x450cb8(0x171)]>HISTORY_MAX_SIZE)_0x5e40cd[_0x450cb8(0x1f9)][_0x450cb8(0x1aa)]();await _0x5e40cd[_0x450cb8(0x162)](_0x450cb8(0x1a0),{'val':JSON[_0x450cb8(0x142)](_0x5e40cd['analysisHistory']),'ack':!![]});}async function updateBaselineStatus(_0x498a03){const _0x50f2a1=a0_0x21f9c7;if(!_0x498a03[_0x50f2a1(0x185)]){await _0x498a03[_0x50f2a1(0x162)](LTM_DP_BASELINE_STATUS,{'val':_0x50f2a1(0x108),'ack':!![]});return;}const _0x232f89=_0x498a03[_0x50f2a1(0x233)][_0x50f2a1(0x171)]>=(_0x498a03['config'][_0x50f2a1(0x23a)]||0x7)?_0x50f2a1(0xfb)+_0x498a03[_0x50f2a1(0x233)]['length']+_0x50f2a1(0x10e):_0x50f2a1(0xfa)+_0x498a03[_0x50f2a1(0x233)][_0x50f2a1(0x171)]+'/'+(_0x498a03[_0x50f2a1(0x1ed)]['minDaysForBaseline']||0x7)+')';await _0x498a03[_0x50f2a1(0x162)](LTM_DP_BASELINE_STATUS,{'val':_0x232f89,'ack':!![]});}async function initSensorSubscriptions(_0x1cd424){const _0x4d4ee5=a0_0x21f9c7,_0x36d83b=_0x1cd424[_0x4d4ee5(0x1ed)][_0x4d4ee5(0x231)];if(_0x36d83b)for(const _0x521bb1 of _0x36d83b){await _0x1cd424['subscribeForeignStatesAsync'](_0x521bb1['id']);}}async function initPresenceSubscriptions(_0x541238){const _0x1c1099=a0_0x21f9c7,_0x3a1ce3=_0x541238['config'][_0x1c1099(0xe8)];if(_0x3a1ce3)for(const _0xb28b34 of _0x3a1ce3){await _0x541238[_0x1c1099(0x136)](_0xb28b34);}}async function setupTelegramListener(_0x402bdd){const _0x52d3d4=a0_0x21f9c7,_0x24fdd2=_0x402bdd['config']['notifyTelegramInstance'];if(_0x402bdd[_0x52d3d4(0x1ed)][_0x52d3d4(0x174)]&&_0x24fdd2)await _0x402bdd[_0x52d3d4(0x136)](_0x24fdd2+'.communicate.request');}async function checkWifiPresence(_0x17bed6){const _0xf42e7b=a0_0x21f9c7;try{const _0x21621a=_0x17bed6[_0xf42e7b(0x1ed)][_0xf42e7b(0xe8)]||[];let _0x154cbd=![];const _0x1185f3=[];for(const _0x12321f of _0x21621a){try{const _0x11b745=await _0x17bed6[_0xf42e7b(0x25f)](_0x12321f);_0x11b745&&(_0x11b745[_0xf42e7b(0x132)]===!![]||_0x11b745['val']===_0xf42e7b(0x1f3)||_0x11b745[_0xf42e7b(0x132)]===0x1)&&(_0x154cbd=!![],_0x1185f3[_0xf42e7b(0x138)](_0x12321f));}catch(_0x3ead0f){}}return await _0x17bed6['setStateAsync']('system.presenceWho',{'val':_0x1185f3[_0xf42e7b(0x167)](',\x20'),'ack':!![]}),_0x154cbd&&(_0x17bed6[_0xf42e7b(0x268)]&&(_0x17bed6[_0xf42e7b(0xed)][_0xf42e7b(0xdb)](_0xf42e7b(0x140)),abortExitTimer(_0x17bed6)),!_0x17bed6['isPresent']&&_0x17bed6[_0xf42e7b(0x271)]===SYSTEM_MODES[_0xf42e7b(0x11d)]&&await setPresence(_0x17bed6,!![])),_0x154cbd;}catch(_0x42b04e){return![];}}function startExitTimer(_0x18d44f){const _0x441824=a0_0x21f9c7;abortExitTimer(_0x18d44f),_0x18d44f[_0x441824(0x1ac)]=!![],_0x18d44f[_0x441824(0x226)]=setTimeout(()=>{const _0x57a5fe=_0x441824;_0x18d44f[_0x57a5fe(0x1ac)]=![];},EXIT_GRACE_PERIOD_SECONDS*0x3e8),_0x18d44f[_0x441824(0x268)]=setTimeout(()=>{const _0x34327c=_0x441824;setPresence(_0x18d44f,![]),_0x18d44f[_0x34327c(0x268)]=null;},EXIT_TIMER_MINUTES*0x3c*0x3e8);}function abortExitTimer(_0x16cb4d){const _0x3ae668=a0_0x21f9c7;if(_0x16cb4d[_0x3ae668(0x268)])clearTimeout(_0x16cb4d[_0x3ae668(0x268)]);if(_0x16cb4d[_0x3ae668(0x226)])clearTimeout(_0x16cb4d[_0x3ae668(0x226)]);_0x16cb4d[_0x3ae668(0x268)]=null,_0x16cb4d[_0x3ae668(0x226)]=null,_0x16cb4d[_0x3ae668(0x1ac)]=![];}async function setPresence(_0x3c7123,_0x30da3b){const _0x4f640c=a0_0x21f9c7;if(_0x3c7123[_0x4f640c(0xea)]===_0x30da3b)return;_0x3c7123[_0x4f640c(0xea)]=_0x30da3b,await _0x3c7123[_0x4f640c(0x162)](_0x4f640c(0x152),{'val':_0x30da3b,'ack':!![]});}async function executeAutomationAction(_0x557cd8){const _0x752e2b=a0_0x21f9c7;try{const _0x1ff746=await _0x557cd8[_0x752e2b(0x25e)](_0x752e2b(0x24a)),_0x174f6b=await _0x557cd8[_0x752e2b(0x25e)](_0x752e2b(0x20b));if(_0x1ff746&&_0x1ff746['val']&&_0x174f6b){const _0x543db8=_0x1ff746[_0x752e2b(0x132)];let _0x1a8fe7=_0x174f6b[_0x752e2b(0x132)];try{_0x1a8fe7=JSON[_0x752e2b(0x182)](_0x1a8fe7);}catch(_0x228bdc){}_0x557cd8[_0x752e2b(0xed)][_0x752e2b(0xdb)]('ü§ñ\x20BUTLER:\x20Executing\x20Action\x20->\x20'+_0x543db8+_0x752e2b(0xf3)+_0x1a8fe7),await _0x557cd8['setForeignStateAsync'](_0x543db8,_0x1a8fe7);}else _0x557cd8[_0x752e2b(0xed)]['warn'](_0x752e2b(0xdc));}catch(_0x213de0){_0x557cd8[_0x752e2b(0xed)][_0x752e2b(0x12c)](_0x752e2b(0x11c)+_0x213de0[_0x752e2b(0x256)]);}}async function processSensorEvent(_0x42feb3,_0x44e466,_0x54f079,_0x5f3395){const _0x44baba=a0_0x21f9c7;if(!_0x5f3395)return;const _0x2c2d85=_0x54f079[_0x44baba(0x132)],_0x2c41b1=Date[_0x44baba(0x275)](),_0x238fcf=_0x42feb3[_0x44baba(0x283)][_0x44e466];_0x42feb3[_0x44baba(0x283)][_0x44e466]=_0x2c2d85;if(!_0x5f3395[_0x44baba(0x200)]&&_0x238fcf!=undefined&&_0x238fcf==_0x2c2d85)return;const _0x22838a=(_0x5f3395[_0x44baba(0x244)]||'')[_0x44baba(0x1e0)](),_0x494dbf=_0x22838a['includes'](_0x44baba(0x282))||_0x22838a['includes'](_0x44baba(0x278))||_0x22838a['includes'](_0x44baba(0xdd))||_0x22838a[_0x44baba(0x183)]('heizung');_0x42feb3[_0x44baba(0x185)]&&_0x494dbf&&recordThermodynamics(_0x42feb3,_0x44e466,_0x2c2d85,_0x5f3395[_0x44baba(0x1c5)]);const _0x53dd7b={'timestamp':_0x2c41b1,'id':_0x44e466,'name':_0x5f3395[_0x44baba(0x217)],'type':_0x5f3395[_0x44baba(0x244)],'location':_0x5f3395[_0x44baba(0x1c5)],'value':_0x2c2d85};_0x42feb3[_0x44baba(0x199)][_0x44baba(0x279)](_0x53dd7b);if(_0x42feb3[_0x44baba(0x199)][_0x44baba(0x171)]>HISTORY_MAX_SIZE)_0x42feb3[_0x44baba(0x199)]['pop']();await _0x42feb3['setStateAsync'](_0x44baba(0x1b2),{'val':JSON['stringify'](_0x53dd7b),'ack':!![]}),await _0x42feb3[_0x44baba(0x162)](_0x44baba(0x228),{'val':JSON[_0x44baba(0x142)](_0x42feb3['eventHistory']),'ack':!![]});_0x42feb3[_0x44baba(0x185)]&&(_0x42feb3[_0x44baba(0x175)]['push'](_0x53dd7b),await saveRawEventLog(_0x42feb3),recordSequence(_0x42feb3,_0x53dd7b));if(_0x5f3395[_0x44baba(0x269)]&&_0x2c2d85===!![]){if(_0x42feb3[_0x44baba(0xea)]&&!_0x42feb3[_0x44baba(0x1ac)])startExitTimer(_0x42feb3);else{if(!_0x42feb3[_0x44baba(0xea)])setPresence(_0x42feb3,!![]);}}else{if(_0x5f3395[_0x44baba(0x244)]==='motion'&&_0x2c2d85===!![]){if(_0x42feb3[_0x44baba(0x268)])abortExitTimer(_0x42feb3);if(!_0x42feb3[_0x44baba(0xea)]&&_0x42feb3['currentSystemMode']===SYSTEM_MODES[_0x44baba(0x11d)])setPresence(_0x42feb3,!![]);}}}async function recordThermodynamics(_0x17769d,_0x7a28d6,_0xa6541f,_0xcf73e1){const _0x2ad05c=a0_0x21f9c7,_0x2384d0=await getOutsideTemperatureNumeric(_0x17769d),_0x1e0fe5=await _0x17769d['getStateAsync'](_0x2ad05c(0x216));let _0x4d47ea=[];if(_0x1e0fe5&&_0x1e0fe5['val'])try{_0x4d47ea=JSON['parse'](_0x1e0fe5[_0x2ad05c(0x132)]);}catch(_0x62359d){}_0x4d47ea[_0x2ad05c(0x138)]({'ts':Date[_0x2ad05c(0x275)](),'room':_0xcf73e1||_0x2ad05c(0x1af),'t_in':_0xa6541f,'t_out':_0x2384d0});if(_0x4d47ea[_0x2ad05c(0x171)]>THERMO_LOG_SIZE)_0x4d47ea[_0x2ad05c(0x172)]();await _0x17769d['setStateAsync'](_0x2ad05c(0x216),{'val':JSON[_0x2ad05c(0x142)](_0x4d47ea),'ack':!![]});}async function getOutsideTemperatureNumeric(_0x1e464d){const _0xe7b126=a0_0x21f9c7;if(_0x1e464d[_0xe7b126(0x1ed)][_0xe7b126(0x10a)])try{const _0x20c493=await _0x1e464d[_0xe7b126(0x25f)](_0x1e464d[_0xe7b126(0x1ed)][_0xe7b126(0x10a)]);if(_0x20c493&&_0x20c493[_0xe7b126(0x132)]!==undefined&&_0x20c493[_0xe7b126(0x132)]!==null)return parseFloat(_0x20c493['val']);}catch(_0x2ea39a){}const _0x5bd535=_0x1e464d[_0xe7b126(0x1ed)]['weatherInstance'];if(!_0x1e464d[_0xe7b126(0x1ed)][_0xe7b126(0x211)]||!_0x5bd535)return null;try{let _0x3eea86='';if(_0x5bd535['includes'](_0xe7b126(0x251)))_0x3eea86=_0x5bd535+'.Current.Temperature';else{if(_0x5bd535[_0xe7b126(0x183)](_0xe7b126(0x181)))_0x3eea86=_0x5bd535+_0xe7b126(0x164);else{if(_0x5bd535[_0xe7b126(0x183)](_0xe7b126(0x114)))_0x3eea86=_0x5bd535+_0xe7b126(0x1e2);else{if(_0x5bd535[_0xe7b126(0x183)](_0xe7b126(0x158)))_0x3eea86=_0x5bd535+_0xe7b126(0x161);}}}if(_0x3eea86){const _0x43d982=await _0x1e464d[_0xe7b126(0x25f)](_0x3eea86);if(_0x43d982&&_0x43d982[_0xe7b126(0x132)]!==undefined&&_0x43d982['val']!==null)return parseFloat(_0x43d982[_0xe7b126(0x132)]);}}catch(_0x1dd26a){}return null;}async function recordSequence(_0x23cda2,_0x206db8){const _0x335a7e=a0_0x21f9c7,_0x3ac292=(_0x206db8[_0x335a7e(0x244)]||'')[_0x335a7e(0x1e0)](),_0x5e56a8=['motion',_0x335a7e(0x16c),_0x335a7e(0x26d),_0x335a7e(0x1eb),'occupancy',_0x335a7e(0x106),_0x335a7e(0x262),'window',_0x335a7e(0x22d),_0x335a7e(0x11f),_0x335a7e(0x210),_0x335a7e(0xfc),_0x335a7e(0x14c),_0x335a7e(0xf6),_0x335a7e(0xf4),_0x335a7e(0x1c0),'lampe'];if(!_0x5e56a8[_0x335a7e(0xfe)](_0x1a576c=>_0x3ac292[_0x335a7e(0x183)](_0x1a576c)))return;if(!_0x206db8[_0x335a7e(0x253)])return;if(sequenceTimer)clearTimeout(sequenceTimer);activeSequence[_0x335a7e(0x138)]({'loc':_0x206db8['location']||_0x335a7e(0x1af),'id':_0x206db8['id'],'ts':Date['now']()}),sequenceTimer=setTimeout(async()=>{if(activeSequence['length']>0x1)await saveCompletedSequence(_0x23cda2);activeSequence=[];},SEQUENCE_TIMEOUT_MS);}async function saveCompletedSequence(_0x34b91f){const _0x38b6c8=a0_0x21f9c7;try{const _0x1940e1=await _0x34b91f[_0x38b6c8(0x25e)](_0x38b6c8(0x16f));let _0x36f7ee=[];if(_0x1940e1&&_0x1940e1[_0x38b6c8(0x132)])try{_0x36f7ee=JSON[_0x38b6c8(0x182)](_0x1940e1['val']);}catch(_0x2ca25f){}const _0x408de2=activeSequence[0x0]['ts'],_0x57237f=activeSequence['map'](_0x328f70=>({'loc':_0x328f70['loc'],'t_delta':Math['round']((_0x328f70['ts']-_0x408de2)/0x3e8)})),_0x23573d={'timestamp':new Date(_0x408de2)[_0x38b6c8(0x1e1)](),'steps':_0x57237f,'duration':Math['round']((activeSequence[activeSequence[_0x38b6c8(0x171)]-0x1]['ts']-_0x408de2)/0x3e8),'daytime':new Date(_0x408de2)[_0x38b6c8(0x22a)]()};_0x36f7ee[_0x38b6c8(0x138)](_0x23573d);if(_0x36f7ee[_0x38b6c8(0x171)]>MAX_TRAINING_SET_SIZE)_0x36f7ee[_0x38b6c8(0x172)]();await _0x34b91f[_0x38b6c8(0x162)](_0x38b6c8(0x16f),{'val':JSON[_0x38b6c8(0x142)](_0x36f7ee),'ack':!![]}),runSecurityCheck(_0x34b91f,_0x23573d);}catch(_0x24b7d8){_0x34b91f[_0x38b6c8(0xed)][_0x38b6c8(0x12c)](_0x38b6c8(0x276)+_0x24b7d8[_0x38b6c8(0x256)]);}}function runSecurityCheck(_0x5bca6a,_0x228f68){const _0x2bde24=a0_0x21f9c7;if(!_0x5bca6a[_0x2bde24(0x185)])return;sendToPython(_0x5bca6a,_0x2bde24(0x281),{'sequence':_0x228f68});}function sendToPython(_0x3520b0,_0x4fdc5c,_0xfb8f5e={}){const _0x33e82f=a0_0x21f9c7;if(!_0x3520b0[_0x33e82f(0x15d)]||!_0x3520b0['pythonProcess'][_0x33e82f(0xec)]['writable'])return;const _0x53a150=JSON[_0x33e82f(0x142)]({'command':_0x4fdc5c,..._0xfb8f5e});try{_0x3520b0[_0x33e82f(0x15d)][_0x33e82f(0xec)][_0x33e82f(0x27e)](_0x53a150+'\x0a');}catch(_0x3d3198){}}function startPythonService(_0x38893f){const _0x3966b5=a0_0x21f9c7;let _0x345ac4=_0x3966b5(0x1c3);if(fs[_0x3966b5(0x277)](PYTHON_EXE))_0x345ac4=PYTHON_EXE;try{const _0x853f3e=path[_0x3966b5(0x167)](__dirname,_0x3966b5(0x207),_0x3966b5(0x267));_0x38893f[_0x3966b5(0x15d)]=spawn(_0x345ac4,[_0x853f3e]),_0x38893f['pythonProcess']['stdout']['on'](_0x3966b5(0x206),_0x51bd9=>{const _0x4642e9=_0x3966b5,_0x43ac02=_0x51bd9[_0x4642e9(0x27b)]()[_0x4642e9(0x286)]('\x0a');_0x43ac02[_0x4642e9(0x1ca)](_0x20150d=>{const _0x960cdf=_0x4642e9,_0x95d45e=_0x20150d[_0x960cdf(0x1a7)]();if(!_0x95d45e)return;if(_0x95d45e[_0x960cdf(0x12d)](_0x960cdf(0x169)))_0x38893f['log'][_0x960cdf(0x15f)]('[PYTHON]\x20'+_0x95d45e[_0x960cdf(0x27c)](0x5)[_0x960cdf(0x1a7)]());else{if(_0x95d45e[_0x960cdf(0x12d)]('[RESULT]'))try{const _0x567d3e=JSON[_0x960cdf(0x182)](_0x95d45e['substring'](0x8)[_0x960cdf(0x1a7)]());handlePythonResult(_0x38893f,_0x567d3e);}catch(_0x21dcb6){}}});}),_0x38893f[_0x3966b5(0x15d)]['on'](_0x3966b5(0x1ce),_0x21f750=>{const _0x4ad908=_0x3966b5;_0x38893f[_0x4ad908(0x15d)]=null;});}catch(_0x537713){_0x38893f[_0x3966b5(0xed)]['error']('Error\x20launching\x20Python:\x20'+_0x537713[_0x3966b5(0x256)]);}}function stopPythonService(_0x24796a){const _0x150629=a0_0x21f9c7;if(_0x24796a[_0x150629(0x15d)]){try{_0x24796a['pythonProcess']['kill']();}catch(_0x4c7413){}_0x24796a['pythonProcess']=null;}}function handlePythonResult(_0xc92eac,_0x4c4cb3){const _0x2c0d68=a0_0x21f9c7;if(_0x4c4cb3[_0x2c0d68(0x244)]===_0x2c0d68(0x24d))_0xc92eac[_0x2c0d68(0xed)][_0x2c0d68(0x15f)](_0x2c0d68(0x202));else{if(_0x4c4cb3[_0x2c0d68(0x244)]==='SECURITY_RESULT'){const {anomaly_score:_0x5bfff4,is_anomaly:_0x324a07,threshold:_0x660b71,explanation:_0x34d332}=_0x4c4cb3['payload'];_0xc92eac[_0x2c0d68(0xed)][_0x2c0d68(0xdb)](_0x2c0d68(0x27d)+_0x5bfff4[_0x2c0d68(0x1cc)](0x5)+'\x20->\x20'+(_0x324a07?_0x2c0d68(0x16b):'OK')),_0xc92eac['setStateAsync'](_0x2c0d68(0x229),{'val':_0x5bfff4,'ack':!![]}),_0xc92eac['setStateAsync'](_0x2c0d68(0x1f0),{'val':new Date()['toISOString'](),'ack':!![]});if(_0x660b71)_0xc92eac['setStateAsync'](_0x2c0d68(0x24f),{'val':_0x660b71,'ack':!![]});if(_0x324a07){let _0x550826='Ungew√∂hnliches\x20Bewegungsmuster!\x20(Score:\x20'+_0x5bfff4['toFixed'](0x4)+')';if(_0x34d332&&_0x34d332!==_0x2c0d68(0x1af))_0x550826+=_0x2c0d68(0x10b)+_0x34d332;_0xc92eac[_0x2c0d68(0x162)](_0x2c0d68(0x1db),{'val':!![],'ack':!![]}),_0xc92eac[_0x2c0d68(0x162)](_0x2c0d68(0x1da),{'val':_0x550826,'ack':!![]}),sendNotification(_0xc92eac,'‚ö†Ô∏è\x20SECURITY\x20ALARM:\x20'+_0x550826,![],!![]);}}else{if(_0x4c4cb3['type']===_0x2c0d68(0x1be)){const _0x1a2c67=_0x4c4cb3['payload'][_0x2c0d68(0x115)]||'',_0x4a6564=_0x4c4cb3[_0x2c0d68(0x109)][_0x2c0d68(0x235)],_0x4b8034=_0x4c4cb3['payload']['success']?_0x2c0d68(0x124)+new Date()[_0x2c0d68(0x234)]()+'\x20('+_0x1a2c67+')':_0x2c0d68(0x166)+_0x4c4cb3[_0x2c0d68(0x109)]['reason'];_0xc92eac[_0x2c0d68(0x162)](_0x2c0d68(0x189),{'val':_0x4b8034,'ack':!![]});if(_0x4c4cb3['payload'][_0x2c0d68(0x1a8)]&&_0x4a6564)_0xc92eac[_0x2c0d68(0x162)](_0x2c0d68(0x24f),{'val':_0x4a6564,'ack':!![]});}else{if(_0x4c4cb3[_0x2c0d68(0x244)]===_0x2c0d68(0x203)){const {patterns:_0x105f4d}=_0x4c4cb3[_0x2c0d68(0x109)];if(_0x105f4d&&_0x105f4d[_0x2c0d68(0x171)]>0x0){_0xc92eac[_0x2c0d68(0xed)]['info']('üõãÔ∏è\x20BUTLER:\x20Found\x20'+_0x105f4d[_0x2c0d68(0x171)]+_0x2c0d68(0x1ec)),_0xc92eac['setStateAsync'](_0x2c0d68(0x1e6),{'val':JSON[_0x2c0d68(0x142)](_0x105f4d),'ack':!![]});const _0x2a6b80=_0x105f4d[0x0],_0x14c0db=_0x2c0d68(0x179)+_0x2a6b80[_0x2c0d68(0x128)]+'\x20('+(_0x2a6b80[_0x2c0d68(0x20d)]*0x64)['toFixed'](0x0)+'%)';_0xc92eac[_0x2c0d68(0x162)](_0x2c0d68(0x227),{'val':!![],'ack':!![]}),_0xc92eac[_0x2c0d68(0x162)](_0x2c0d68(0x18d),{'val':_0x14c0db,'ack':!![]});}else _0xc92eac['log']['info'](_0x2c0d68(0xf7)),_0xc92eac[_0x2c0d68(0x162)]('analysis.automation.patternDetected',{'val':![],'ack':!![]}),_0xc92eac[_0x2c0d68(0x162)](_0x2c0d68(0x1e6),{'val':'[]','ack':!![]});}else{if(_0x4c4cb3['type']===_0x2c0d68(0x223)){if(_0x4c4cb3['payload'][_0x2c0d68(0x1a8)])try{const _0x215a03=JSON[_0x2c0d68(0x182)](_0x4c4cb3[_0x2c0d68(0x109)]['details']);if(_0x215a03['insulation'])_0xc92eac[_0x2c0d68(0x162)](_0x2c0d68(0x287),{'val':JSON[_0x2c0d68(0x142)](_0x215a03['insulation']),'ack':!![]});if(_0x215a03[_0x2c0d68(0x141)])_0xc92eac['setStateAsync'](_0x2c0d68(0x1df),{'val':JSON['stringify'](_0x215a03[_0x2c0d68(0x141)]),'ack':!![]});}catch(_0x184a4a){}}else{if(_0x4c4cb3[_0x2c0d68(0x244)]===_0x2c0d68(0x159)){if(_0x4c4cb3[_0x2c0d68(0x109)][_0x2c0d68(0x1a8)])_0xc92eac[_0x2c0d68(0xed)]['info'](_0x2c0d68(0x24c));}else{if(_0x4c4cb3['type']===_0x2c0d68(0x1d9))_0xc92eac[_0x2c0d68(0x162)](_0x2c0d68(0x274),{'val':new Date()['toISOString'](),'ack':!![]}),_0xc92eac[_0x2c0d68(0x162)](_0x2c0d68(0x16d),{'val':_0x4c4cb3[_0x2c0d68(0x109)][_0x2c0d68(0x194)],'ack':!![]});else _0x4c4cb3[_0x2c0d68(0x244)]==='TREND_RESULT'&&(_0xc92eac[_0x2c0d68(0x162)](_0x2c0d68(0x126),{'val':_0x4c4cb3[_0x2c0d68(0x109)]['diagnosis'],'ack':!![]}),_0xc92eac[_0x2c0d68(0x162)](_0x2c0d68(0x20e),{'val':_0x4c4cb3[_0x2c0d68(0x109)][_0x2c0d68(0x10d)],'ack':!![]}));}}}}}}}function runPythonHealthCheck(_0x7a29af){const _0x1999f8=a0_0x21f9c7;if(!_0x7a29af[_0x1999f8(0x233)]||_0x7a29af[_0x1999f8(0x233)][_0x1999f8(0x171)]<0x2)return;const _0x4cb3cb=_0x7a29af[_0x1999f8(0x233)]['map'](_0x3ce4d2=>{const _0x1c509d=_0x1999f8,_0x2b2bd6=(_0x3ce4d2[_0x1c509d(0x129)]||'')['toLowerCase']();return ACTIVITY_LEVEL_MAP[_0x2b2bd6]||0x32;});sendToPython(_0x7a29af,_0x1999f8(0x1fe),{'values':_0x4cb3cb,'tag':_0x1999f8(0x230)});}async function handleTelegramResponse(_0xe6abd9,_0x168e23){const _0x5efe28=a0_0x21f9c7;let _0xcf1906=_0x168e23;_0x168e23[_0x5efe28(0x12d)]('[')&&(_0xcf1906=_0x168e23[_0x5efe28(0x27c)](_0x168e23['indexOf'](']')+0x1));if(_0xcf1906===_0x5efe28(0x196))await _0xe6abd9['setStateAsync']('analysis.isAlert',{'val':![],'ack':!![]}),await _0xe6abd9[_0x5efe28(0x162)]('analysis.alertReason',{'val':_0x5efe28(0x107),'ack':!![]}),_0xe6abd9[_0x5efe28(0x1bf)]=![],sendNotification(_0xe6abd9,_0x5efe28(0xff),![]);else _0xcf1906===_0x5efe28(0x1b1)&&sendNotification(_0xe6abd9,'üìû\x20R√úCKRUF\x20BITTE!\x20Der\x20Bewohner\x20hat\x20den\x20R√ºckruf-Button\x20gedr√ºckt.',![],!![]);}async function sendNotification(_0x3f3176,_0x2adb06,_0x2a0ce3=![],_0x1d2275=![]){const _0x4fcf64=a0_0x21f9c7,_0x52dcdf=_0x3f3176[_0x4fcf64(0x1ed)];if(_0x52dcdf[_0x4fcf64(0x174)]){let _0x452090={};(_0x2adb06['includes'](_0x4fcf64(0x17a))||_0x1d2275)&&(_0x452090={'reply_markup':{'inline_keyboard':[[{'text':_0x4fcf64(0x147),'callback_data':_0x4fcf64(0x196)}],[{'text':_0x4fcf64(0x1f8),'callback_data':_0x4fcf64(0x1b1)}]]}}),await _0x3f3176[_0x4fcf64(0x23c)](_0x52dcdf[_0x4fcf64(0x212)],_0x4fcf64(0x111),{'text':_0x2adb06,'user':_0x52dcdf[_0x4fcf64(0x198)],..._0x452090});}if(_0x52dcdf[_0x4fcf64(0x22e)]){let _0x276e58={'message':_0x2adb06,'title':_0x1d2275?'üö®\x20EMERGENCY':'Cogni-Living','priority':_0x1d2275?0x2:0x1,'device':_0x52dcdf['notifyPushoverRecipient']};_0x1d2275&&(_0x276e58[_0x4fcf64(0x220)]=0x1e,_0x276e58['expire']=0xe10,_0x276e58[_0x4fcf64(0x14f)]=_0x4fcf64(0x218)),await _0x3f3176[_0x4fcf64(0x23c)](_0x52dcdf['notifyPushoverInstance'],_0x4fcf64(0x111),_0x276e58);}_0x52dcdf[_0x4fcf64(0x215)]&&await _0x3f3176[_0x4fcf64(0x23c)](_0x52dcdf[_0x4fcf64(0x11a)],_0x4fcf64(0x111),{'text':_0x2adb06,'to':_0x52dcdf[_0x4fcf64(0x155)]});}async function runGeminiAnalysis(_0xa8e634,_0x433eb7=''){const _0x4a6341=a0_0x21f9c7;if(!_0xa8e634['geminiModel'])return;if(_0xa8e634[_0x4a6341(0x199)][_0x4a6341(0x171)]===0x0)return;const _0x315cda=_0xa8e634[_0x4a6341(0x199)][_0x4a6341(0x1d4)](0x0,0xf),_0x481edc=await getWeatherContext(_0xa8e634),_0x1725b2=_0xa8e634['currentSystemMode'],_0x474535=PERSONA_MAPPING[_0xa8e634[_0x4a6341(0x1ed)][_0x4a6341(0x1a5)]||_0x4a6341(0x188)],_0x3b62db=_0xa8e634[_0x4a6341(0x1ed)][_0x4a6341(0x21d)]||_0x4a6341(0x131);let _0xfce89c='Unbekannt';try{const _0x178c2d=await _0xa8e634[_0x4a6341(0x25e)](_0x4a6341(0x186));if(_0x178c2d&&_0x178c2d[_0x4a6341(0x132)])_0xfce89c=_0x178c2d['val'];}catch(_0x5a88dd){}let _0x5300ab=![];try{const _0x1ad138=await _0xa8e634[_0x4a6341(0x25e)](_0x4a6341(0x249));if(_0x1ad138&&_0x1ad138[_0x4a6341(0x132)])_0x5300ab=!![];}catch(_0x149f81){}const _0x1b3e11=_0x4a6341(0x219)+_0x474535+_0x4a6341(0x26a)+_0x3b62db+_0x4a6341(0xef)+_0x1725b2+_0x4a6341(0x12a)+_0x481edc+_0x4a6341(0x195)+_0xfce89c+_0x4a6341(0xee)+JSON[_0x4a6341(0x142)](_0x315cda)+_0x4a6341(0x17f)+_0x433eb7+_0x4a6341(0x19c);try{const _0x2cc04e=await _0xa8e634[_0x4a6341(0x19a)]['generateContent'](_0x1b3e11),_0x2dcf4e=JSON[_0x4a6341(0x182)](_0x2cc04e[_0x4a6341(0x15a)][_0x4a6341(0x25d)]()[_0x4a6341(0x135)](/```json|```/g,'')['trim']());await _0xa8e634[_0x4a6341(0x162)](_0x4a6341(0x243),{'val':JSON[_0x4a6341(0x142)](_0x2dcf4e),'ack':!![]});if(_0x2dcf4e[_0x4a6341(0x1de)])await _0xa8e634['setStateAsync'](_0x4a6341(0x240),{'val':_0x2dcf4e[_0x4a6341(0x1de)],'ack':!![]});const _0x2ac32f={'timestamp':Date[_0x4a6341(0x275)](),'id':Date['now']()[_0x4a6341(0x27b)](),'analysis':{'activity':{'summary':_0x2dcf4e['summary'],'isAlert':_0x2dcf4e[_0x4a6341(0x12b)],'alertReason':_0x2dcf4e['alertReason']},'comfort':{'automationProposal':_0x2dcf4e[_0x4a6341(0x104)]}}};await updateAnalysisHistory(_0xa8e634,_0x2ac32f);const _0x554ab7=_0x2dcf4e[_0x4a6341(0x12b)]||![];_0x554ab7!==_0xa8e634[_0x4a6341(0x1bf)]&&(await _0xa8e634[_0x4a6341(0x162)](_0x4a6341(0x1db),{'val':_0x554ab7,'ack':!![]}),_0xa8e634['lastAlertState']=_0x554ab7,_0x554ab7&&(await _0xa8e634[_0x4a6341(0x162)](_0x4a6341(0x1da),{'val':_0x2dcf4e[_0x4a6341(0xf0)],'ack':!![]}),sendNotification(_0xa8e634,'‚ö†Ô∏è\x20ALARM:\x20'+_0x2dcf4e['alertReason'],![],_0x2dcf4e[_0x4a6341(0xe2)])));if(_0x2dcf4e[_0x4a6341(0x104)]&&_0x2dcf4e['automationProposal'][_0x4a6341(0x1e5)]){await _0xa8e634['setStateAsync'](_0x4a6341(0x227),{'val':!![],'ack':!![]}),await _0xa8e634[_0x4a6341(0x162)]('analysis.automation.description',{'val':_0x2dcf4e[_0x4a6341(0x104)][_0x4a6341(0x105)],'ack':!![]}),await _0xa8e634[_0x4a6341(0x162)]('analysis.automation.targetId',{'val':_0x2dcf4e[_0x4a6341(0x104)][_0x4a6341(0x10f)],'ack':!![]}),await _0xa8e634[_0x4a6341(0x162)](_0x4a6341(0x20b),{'val':JSON['stringify'](_0x2dcf4e[_0x4a6341(0x104)][_0x4a6341(0x19f)]),'ack':!![]});if(_0x5300ab)executeAutomationAction(_0xa8e634);}}catch(_0x19dbaa){_0xa8e634[_0x4a6341(0xed)][_0x4a6341(0x12c)](_0x4a6341(0x18c)+_0x19dbaa[_0x4a6341(0x256)]);}}async function createDailyDigest(_0x3d4fda){const _0x161a4e=a0_0x21f9c7;if(!_0x3d4fda[_0x161a4e(0x185)])return;await _0x3d4fda[_0x161a4e(0x162)](LTM_DP_STATUS,{'val':_0x161a4e(0x127),'ack':!![]});if(!_0x3d4fda[_0x161a4e(0x19a)]||_0x3d4fda[_0x161a4e(0x175)][_0x161a4e(0x171)]<LTM_MIN_EVENTS_FOR_COMPRESSION){await _0x3d4fda[_0x161a4e(0x162)](LTM_DP_STATUS,{'val':_0x161a4e(0x1bd),'ack':!![]});return;}const _0x5098bc=JSON['parse'](JSON[_0x161a4e(0x142)](_0x3d4fda[_0x161a4e(0x175)])),_0x21219c=_0x5098bc[_0x161a4e(0x171)],_0x7ffe9e=new Array(0x60)[_0x161a4e(0x225)](0x0),_0x45af6c=new Date()['setHours'](0x0,0x0,0x0,0x0);_0x5098bc[_0x161a4e(0x1ca)](_0x40cf51=>{const _0x5dad6b=_0x161a4e,_0x422213=new Date(_0x40cf51[_0x5dad6b(0x1d3)]),_0x319b16=_0x422213['getHours'](),_0x1e5a88=_0x422213['getMinutes'](),_0x5d6c40=_0x319b16*0x4+Math[_0x5dad6b(0x120)](_0x1e5a88/0xf);if(_0x5d6c40>=0x0&&_0x5d6c40<0x60)_0x7ffe9e[_0x5d6c40]++;});const _0x1804e5=_0x161a4e(0x280)+JSON[_0x161a4e(0x142)](_0x5098bc[_0x161a4e(0x1d4)](0x0,0x32));try{const _0x46a5dc=await _0x3d4fda[_0x161a4e(0x19a)][_0x161a4e(0x1e3)](_0x1804e5),_0x2917d6=JSON['parse'](_0x46a5dc[_0x161a4e(0x15a)][_0x161a4e(0x25d)]()[_0x161a4e(0x135)](/```json|```/g,'')[_0x161a4e(0x1a7)]()),_0x42cba2={'timestamp':new Date()[_0x161a4e(0x1e1)](),'eventCount':_0x21219c,'summary':_0x2917d6[_0x161a4e(0x1de)]||_0x161a4e(0xf1),'activityLevel':_0x2917d6[_0x161a4e(0x129)]||'normal','systemMode':_0x3d4fda[_0x161a4e(0x271)],'activityVector':_0x7ffe9e};_0x3d4fda[_0x161a4e(0x233)][_0x161a4e(0x138)](_0x42cba2),await saveDailyDigests(_0x3d4fda),_0x3d4fda['rawEventLog']=[],await saveRawEventLog(_0x3d4fda),await _0x3d4fda[_0x161a4e(0x162)](LTM_DP_STATUS,{'val':'Success','ack':!![]});if(_0x3d4fda['isProVersion'])sendToPython(_0x3d4fda,_0x161a4e(0x149),{'digest':_0x42cba2});}catch(_0x25f212){_0x3d4fda[_0x161a4e(0xed)]['error'](_0x25f212[_0x161a4e(0x256)]);}}function setupLtmScheduler(_0x3dc63d){const _0x175e90=a0_0x21f9c7;try{if(_0x3dc63d['ltmJob'])_0x3dc63d[_0x175e90(0x17c)][_0x175e90(0x26b)]();if(!_0x3dc63d[_0x175e90(0x185)])return;_0x3dc63d[_0x175e90(0x17c)]=schedule[_0x175e90(0x22b)](LTM_SCHEDULE,()=>createDailyDigest(_0x3dc63d));}catch(_0x195d24){_0x3dc63d[_0x175e90(0xed)][_0x175e90(0x12c)](_0x175e90(0xde)+_0x195d24[_0x175e90(0x256)]);}}function setupModeResetScheduler(_0x489a4e){const _0x2dc507=a0_0x21f9c7;try{if(_0x489a4e['modeResetJob'])_0x489a4e[_0x2dc507(0xf9)]['cancel']();_0x489a4e['modeResetJob']=schedule[_0x2dc507(0x22b)](MODE_RESET_SCHEDULE,async()=>{const _0x23ff70=_0x2dc507;await loadSystemMode(_0x489a4e),AUTO_RESET_MODES[_0x23ff70(0x183)](_0x489a4e['currentSystemMode'])&&await _0x489a4e[_0x23ff70(0x162)](SYSTEM_DP_MODE,{'val':SYSTEM_MODES[_0x23ff70(0x11d)],'ack':![]});});}catch(_0x2100d4){_0x489a4e['log'][_0x2dc507(0x12c)](_0x2dc507(0x222)+_0x2100d4[_0x2dc507(0x256)]);}}function setupDriftAnalysisScheduler(_0x4e8e62){const _0x56bc48=a0_0x21f9c7;try{if(_0x4e8e62[_0x56bc48(0x11e)])clearInterval(_0x4e8e62['driftAnalysisTimer']);if(!_0x4e8e62[_0x56bc48(0x185)])return;_0x4e8e62['driftAnalysisTimer']=setInterval(()=>runBaselineDriftAnalysis(_0x4e8e62),(_0x4e8e62[_0x56bc48(0x1ed)][_0x56bc48(0x214)]||0x18)*0x36ee80),setTimeout(()=>runBaselineDriftAnalysis(_0x4e8e62),0x1388);}catch(_0x3563a7){_0x4e8e62[_0x56bc48(0xed)]['error']('Drift\x20Sched\x20Error:\x20'+_0x3563a7[_0x56bc48(0x256)]);}}function setupBriefingScheduler(_0x5660be){const _0xd01deb=a0_0x21f9c7;try{if(_0x5660be[_0xd01deb(0x1d0)])_0x5660be[_0xd01deb(0x1d0)][_0xd01deb(0x26b)]();if(!_0x5660be[_0xd01deb(0x1ed)]['briefingEnabled'])return;const _0x1330b8=(_0x5660be[_0xd01deb(0x1ed)][_0xd01deb(0x1c1)]||_0xd01deb(0x1d1))['split'](':'),_0x300da6=parseInt(_0x1330b8[0x0])||0x8,_0x215a80=parseInt(_0x1330b8[0x1])||0x0,_0x3405d0=_0x215a80+'\x20'+_0x300da6+_0xd01deb(0x255);_0x5660be[_0xd01deb(0x1d0)]=schedule['scheduleJob'](_0x3405d0,()=>{sendMorningBriefing(_0x5660be);});}catch(_0x42bc02){_0x5660be[_0xd01deb(0xed)][_0xd01deb(0x12c)](_0xd01deb(0x1e9)+_0x42bc02[_0xd01deb(0x256)]);}}async function runBaselineDriftAnalysis(_0x3c7eee){const _0xa97eda=a0_0x21f9c7;if(!_0x3c7eee[_0xa97eda(0x185)]||!_0x3c7eee[_0xa97eda(0x19a)])return;const _0x4efffc=_0x3c7eee[_0xa97eda(0x1ed)][_0xa97eda(0x254)]||0xe;if(_0x3c7eee[_0xa97eda(0x233)][_0xa97eda(0x171)]<_0x4efffc+0x7){await _0x3c7eee[_0xa97eda(0x162)](LTM_DP_DRIFT_STATUS,{'val':_0xa97eda(0x16e),'ack':!![]});return;}const _0x2e9e86=_0x3c7eee['dailyDigests'][_0xa97eda(0x1d4)](-_0x4efffc),_0x11a160=_0x3c7eee[_0xa97eda(0x233)][_0xa97eda(0x1d4)](0x0,_0x3c7eee[_0xa97eda(0x233)][_0xa97eda(0x171)]-_0x4efffc),_0x24fbd5=_0xa97eda(0x14d)+JSON[_0xa97eda(0x142)](_0x11a160)+_0xa97eda(0x153)+JSON[_0xa97eda(0x142)](_0x2e9e86);try{const _0x3400e3=await _0x3c7eee['geminiModel'][_0xa97eda(0x1e3)](_0x24fbd5),_0x59f4c3=JSON[_0xa97eda(0x182)](_0x3400e3[_0xa97eda(0x15a)][_0xa97eda(0x25d)]()['replace'](/```json|```/g,'')['trim']());_0x59f4c3['baselineDrift']&&(await _0x3c7eee[_0xa97eda(0x162)](LTM_DP_DRIFT_STATUS,{'val':_0x59f4c3[_0xa97eda(0x191)],'ack':!![]}),await _0x3c7eee[_0xa97eda(0x162)](LTM_DP_DRIFT_DETAILS,{'val':_0x59f4c3[_0xa97eda(0xe1)],'ack':!![]}),await _0x3c7eee[_0xa97eda(0x162)](LTM_DP_DRIFT_LAST_CHECK,{'val':Date['now'](),'ack':!![]}));}catch(_0x229ef5){}}class CogniLiving extends utils[a0_0x21f9c7(0x1f6)]{constructor(_0x599d49){const _0x2cc7ef=a0_0x21f9c7;super({..._0x599d49,'name':_0x2cc7ef(0x1b5)}),this[_0x2cc7ef(0x199)]=[],this['analysisHistory']=[],this[_0x2cc7ef(0x175)]=[],this['dailyDigests']=[],this['sensorLastValues']={},this[_0x2cc7ef(0x26f)]={'latitude':0x0,'longitude':0x0,'city':''},this[_0x2cc7ef(0xea)]=!![],this[_0x2cc7ef(0x268)]=null,this['exitGraceTimer']=null,this['isGracePeriodActive']=![],this[_0x2cc7ef(0x21a)]=null,this[_0x2cc7ef(0x19a)]=null,this[_0x2cc7ef(0x271)]=SYSTEM_MODES[_0x2cc7ef(0x11d)],this[_0x2cc7ef(0x185)]=![],this[_0x2cc7ef(0x1bf)]=![],this[_0x2cc7ef(0x112)]=_0x2cc7ef(0x14e),this[_0x2cc7ef(0x1d5)]=null,this[_0x2cc7ef(0x17c)]=null,this[_0x2cc7ef(0xf9)]=null,this[_0x2cc7ef(0x11e)]=null,this[_0x2cc7ef(0x1d0)]=null,this[_0x2cc7ef(0x15d)]=null,this[_0x2cc7ef(0x25a)]=![],this['on'](_0x2cc7ef(0x110),this[_0x2cc7ef(0x13d)][_0x2cc7ef(0xe6)](this)),this['on'](_0x2cc7ef(0x17d),this[_0x2cc7ef(0x1a2)][_0x2cc7ef(0xe6)](this)),this['on'](_0x2cc7ef(0x160),this[_0x2cc7ef(0x116)][_0x2cc7ef(0xe6)](this)),this['on'](_0x2cc7ef(0x256),this[_0x2cc7ef(0x13f)]['bind'](this));}async[a0_0x21f9c7(0x13d)](){const _0x4932ec=a0_0x21f9c7;this[_0x4932ec(0xed)][_0x4932ec(0xdb)]('cogni-living\x20adapter\x20starting\x20(v'+this[_0x4932ec(0x187)]+')\x20-\x20SAFE\x20BOOT');if(!checkAndInstall(this))return;await startSystem(this);}[a0_0x21f9c7(0x116)](_0x522aca){const _0x3bbab5=a0_0x21f9c7;if(this[_0x3bbab5(0x1d5)])clearInterval(this[_0x3bbab5(0x1d5)]);if(this[_0x3bbab5(0x11e)])clearInterval(this['driftAnalysisTimer']);if(this[_0x3bbab5(0x17c)])this[_0x3bbab5(0x17c)]['cancel']();if(this[_0x3bbab5(0xf9)])this['modeResetJob'][_0x3bbab5(0x26b)]();if(this[_0x3bbab5(0x1d0)])this[_0x3bbab5(0x1d0)][_0x3bbab5(0x26b)]();if(this[_0x3bbab5(0x268)])clearTimeout(this[_0x3bbab5(0x268)]);if(this['exitGraceTimer'])clearTimeout(this[_0x3bbab5(0x226)]);stopPythonService(this),_0x522aca();}async['onStateChange'](_0x35c3e9,_0x3fd2f4){const _0x1a67af=a0_0x21f9c7;if(!_0x3fd2f4||this[_0x1a67af(0x25a)])return;if(_0x35c3e9[_0x1a67af(0x183)](_0x1a67af(0x1bb))&&_0x35c3e9['endsWith'](_0x1a67af(0x168))&&_0x3fd2f4[_0x1a67af(0x132)]){await handleTelegramResponse(this,_0x3fd2f4[_0x1a67af(0x132)]);return;}if(_0x35c3e9===this[_0x1a67af(0x18f)]+'.'+SYSTEM_DP_MODE){if(_0x3fd2f4[_0x1a67af(0x132)]&&Object[_0x1a67af(0x1a9)](SYSTEM_MODES)[_0x1a67af(0x183)](_0x3fd2f4['val'])){this[_0x1a67af(0x271)]=_0x3fd2f4[_0x1a67af(0x132)];if(_0x3fd2f4[_0x1a67af(0x132)]===SYSTEM_MODES['VACATION'])await setPresence(this,![]);else await setPresence(this,!![]);}if(!_0x3fd2f4[_0x1a67af(0x204)])this[_0x1a67af(0x1ad)](_0x35c3e9,{'val':this[_0x1a67af(0x271)],'ack':!![]});return;}if(!_0x3fd2f4['ack']){_0x35c3e9[_0x1a67af(0x183)](_0x1a67af(0x122))&&_0x3fd2f4['val']&&(this['setState'](_0x35c3e9,{'val':![],'ack':!![]}),runGeminiAnalysis(this));if(_0x35c3e9[_0x1a67af(0x183)](_0x1a67af(0x1d7))&&_0x3fd2f4[_0x1a67af(0x132)]){this[_0x1a67af(0x1ad)](_0x35c3e9,{'val':![],'ack':!![]});if(this[_0x1a67af(0x185)])createDailyDigest(this);}_0x35c3e9[_0x1a67af(0x183)](_0x1a67af(0x1b6))&&_0x3fd2f4[_0x1a67af(0x132)]&&(this[_0x1a67af(0x1ad)](_0x35c3e9,{'val':![],'ack':!![]}),sendMorningBriefing(this));_0x35c3e9[_0x1a67af(0x183)](_0x1a67af(0x259))&&_0x3fd2f4['val']&&(this[_0x1a67af(0x1ad)](_0x35c3e9,{'val':![],'ack':!![]}),executeAutomationAction(this));if(_0x35c3e9[_0x1a67af(0x183)](_0x1a67af(0x18b))&&_0x3fd2f4['val']){this[_0x1a67af(0x1ad)](_0x35c3e9,{'val':![],'ack':!![]});if(this['isProVersion'])try{const _0x6e57ef=await this['getStateAsync'](_0x1a67af(0x16f));if(_0x6e57ef&&_0x6e57ef['val']){const _0x1b34b4=JSON['parse'](_0x6e57ef[_0x1a67af(0x132)]);this[_0x1a67af(0xed)][_0x1a67af(0xdb)]('üß†\x20Triggering\x20Security\x20Training...'),this[_0x1a67af(0x162)](_0x1a67af(0x189),{'val':'Sec-Training\x20started...','ack':!![]}),sendToPython(this,_0x1a67af(0x22c),{'sequences':_0x1b34b4});}}catch(_0x111fad){this[_0x1a67af(0xed)][_0x1a67af(0x12c)](_0x1a67af(0x248)+_0x111fad[_0x1a67af(0x256)]);}}if(_0x35c3e9[_0x1a67af(0x183)](_0x1a67af(0x1ef))&&_0x3fd2f4[_0x1a67af(0x132)]){this[_0x1a67af(0x1ad)](_0x35c3e9,{'val':![],'ack':!![]});if(this[_0x1a67af(0x185)])try{const _0x480aee=await this[_0x1a67af(0x25e)](LTM_DP_DAILY_DIGESTS);if(_0x480aee&&_0x480aee['val'])sendToPython(this,_0x1a67af(0x19d),{'digests':JSON[_0x1a67af(0x182)](_0x480aee[_0x1a67af(0x132)])});}catch(_0x15c878){}}if(_0x35c3e9[_0x1a67af(0x183)](_0x1a67af(0x257))&&_0x3fd2f4[_0x1a67af(0x132)]){this[_0x1a67af(0x1ad)](_0x35c3e9,{'val':![],'ack':!![]});if(this[_0x1a67af(0x185)])try{const _0x1b0d2f=await this[_0x1a67af(0x25e)](_0x1a67af(0x216));if(_0x1b0d2f&&_0x1b0d2f[_0x1a67af(0x132)])sendToPython(this,_0x1a67af(0x1d8),{'points':JSON[_0x1a67af(0x182)](_0x1b0d2f[_0x1a67af(0x132)])});}catch(_0xf570c5){}}if(_0x35c3e9[_0x1a67af(0x183)](_0x1a67af(0x1dd))&&_0x3fd2f4[_0x1a67af(0x132)]){this['setState'](_0x35c3e9,{'val':![],'ack':!![]});if(this[_0x1a67af(0x185)])try{const _0x222587=await this['getStateAsync'](LTM_DP_RAW_LOG);_0x222587&&_0x222587['val']&&(this[_0x1a67af(0xed)][_0x1a67af(0xdb)](_0x1a67af(0x13c)),sendToPython(this,_0x1a67af(0x1fa),{'events':JSON[_0x1a67af(0x182)](_0x222587[_0x1a67af(0x132)])}));}catch(_0x5d44d2){}}return;}if(this[_0x1a67af(0x1ed)][_0x1a67af(0xe8)]&&this[_0x1a67af(0x1ed)][_0x1a67af(0xe8)][_0x1a67af(0x183)](_0x35c3e9)){await checkWifiPresence(this);return;}const _0x30d8a9=(this[_0x1a67af(0x1ed)]['devices']||[])[_0x1a67af(0x123)](_0x10ea15=>_0x10ea15['id']===_0x35c3e9);if(_0x30d8a9)processSensorEvent(this,_0x35c3e9,_0x3fd2f4,_0x30d8a9);}async[a0_0x21f9c7(0x13f)](_0x4adb89){const _0x2baf41=a0_0x21f9c7;if(typeof _0x4adb89===_0x2baf41(0x264)&&_0x4adb89[_0x2baf41(0x256)]){if(_0x4adb89[_0x2baf41(0x15c)]==='testApiKey'){const _0x478dd3=_0x4adb89[_0x2baf41(0x256)][_0x2baf41(0x190)]||this[_0x2baf41(0x1ed)][_0x2baf41(0x13b)];if(!_0x478dd3)return this['sendTo'](_0x4adb89[_0x2baf41(0xe4)],_0x4adb89[_0x2baf41(0x15c)],{'success':![],'message':'Kein\x20API\x20Key.'},_0x4adb89[_0x2baf41(0x246)]);try{const _0x12bbc2=new GoogleGenerativeAI(_0x478dd3),_0x3a77df=_0x12bbc2[_0x2baf41(0x252)]({'model':GEMINI_MODEL}),_0x193b80=await _0x3a77df['generateContent']('Hi');this[_0x2baf41(0x102)](_0x4adb89[_0x2baf41(0xe4)],_0x4adb89[_0x2baf41(0x15c)],{'success':!![],'message':_0x2baf41(0x1b8)+_0x193b80['response'][_0x2baf41(0x25d)]()},_0x4adb89['callback']);}catch(_0x3b27e6){this[_0x2baf41(0x102)](_0x4adb89['from'],_0x4adb89[_0x2baf41(0x15c)],{'success':![],'message':_0x2baf41(0x27a)+_0x3b27e6[_0x2baf41(0x256)]},_0x4adb89[_0x2baf41(0x246)]);}}else{if(_0x4adb89[_0x2baf41(0x15c)]===_0x2baf41(0x1c2)){const _0x370021=await getWeatherContext(this),_0x13621b=await getCalendarContext(this);this[_0x2baf41(0x102)](_0x4adb89[_0x2baf41(0xe4)],_0x4adb89['command'],{'success':!![],'weather':_0x370021,'calendar':_0x13621b},_0x4adb89[_0x2baf41(0x246)]);}else{if(_0x4adb89[_0x2baf41(0x15c)]==='getLtmData'){if(!this['isProVersion'])return this[_0x2baf41(0x102)](_0x4adb89[_0x2baf41(0xe4)],_0x4adb89['command'],{'success':![],'isPro':![]},_0x4adb89['callback']);let _0x1910e2={'status':_0x2baf41(0x25c)};try{const _0x265568=await this[_0x2baf41(0x25e)](LTM_DP_DRIFT_STATUS);_0x1910e2[_0x2baf41(0xe5)]=_0x265568?_0x265568[_0x2baf41(0x132)]:'N/A';}catch(_0x1d04b8){}this[_0x2baf41(0x102)](_0x4adb89['from'],_0x4adb89[_0x2baf41(0x15c)],{'success':!![],'isPro':!![],'dailyDigests':this[_0x2baf41(0x233)],'driftAnalysis':_0x1910e2,'analysisHistory':this['analysisHistory']},_0x4adb89[_0x2baf41(0x246)]);}else{if(_0x4adb89[_0x2baf41(0x15c)]==='getOverviewData'){const _0xe34e01=this[_0x2baf41(0x233)][_0x2baf41(0x171)],_0x18f267=new Date(),_0x486a25=new Date(_0x18f267[_0x2baf41(0x263)](),_0x18f267['getMonth'](),_0x18f267['getDate']())[_0x2baf41(0x237)](),_0xa6e503=this[_0x2baf41(0x175)]['filter'](_0x3de8a2=>new Date(_0x3de8a2['timestamp'])[_0x2baf41(0x237)]()>_0x486a25)[_0x2baf41(0x171)],_0x487289=new Array(0x18)['fill'](0x0);this['rawEventLog'][_0x2baf41(0x1ca)](_0x1c5e78=>{const _0xa84a34=_0x2baf41,_0x2f28af=new Date(_0x1c5e78[_0xa84a34(0x1d3)]);if(_0x2f28af[_0xa84a34(0x237)]()>_0x486a25)_0x487289[_0x2f28af['getHours']()]++;});let _0x1bb4de={'status':_0x2baf41(0x25c)};try{const _0x5d0482=await this[_0x2baf41(0x25e)](LTM_DP_DRIFT_STATUS);_0x1bb4de[_0x2baf41(0xe5)]=_0x5d0482?_0x5d0482[_0x2baf41(0x132)]:'N/A';}catch(_0x4272f3){}let _0x413bf1='';try{const _0x3c0b5d=await this[_0x2baf41(0x25e)]('system.presenceWho');_0x413bf1=_0x3c0b5d?_0x3c0b5d['val']:'';}catch(_0x541b50){}let _0x508f47=null;!this[_0x2baf41(0x19a)]&&(_0x508f47=this['config'][_0x2baf41(0x13b)]?'KI-Modell\x20nicht\x20initialisiert':_0x2baf41(0x133));let _0x260dc4={'detected':![],'description':'','targetId':'','targetValue':'','autoApply':![]};try{const _0xc2a799=await this[_0x2baf41(0x25e)](_0x2baf41(0x227));if(_0xc2a799&&_0xc2a799[_0x2baf41(0x132)]){_0x260dc4[_0x2baf41(0x1e5)]=!![];const _0x291f22=await this[_0x2baf41(0x25e)](_0x2baf41(0x18d));_0x260dc4[_0x2baf41(0x105)]=_0x291f22?_0x291f22[_0x2baf41(0x132)]:'';const _0x46a645=await this[_0x2baf41(0x25e)](_0x2baf41(0x24a));_0x260dc4['targetId']=_0x46a645?_0x46a645[_0x2baf41(0x132)]:'';const _0x5599bd=await this['getStateAsync'](_0x2baf41(0x20b));_0x260dc4['targetValue']=_0x5599bd?_0x5599bd[_0x2baf41(0x132)]:'';}const _0x1bc110=await this[_0x2baf41(0x25e)](_0x2baf41(0x249));_0x260dc4[_0x2baf41(0xeb)]=_0x1bc110?!!_0x1bc110[_0x2baf41(0x132)]:![];}catch(_0x9c1f7){}this[_0x2baf41(0x102)](_0x4adb89[_0x2baf41(0xe4)],_0x4adb89[_0x2baf41(0x15c)],{'success':!![],'eventHistory':this['eventHistory']['slice'](0x0,0xf),'stats':{'digestCount':_0xe34e01,'eventCountToday':_0xa6e503,'hourlyActivity':_0x487289,'driftStatus':_0x1bb4de[_0x2baf41(0xe5)],'isPresent':this['isPresent'],'presenceWho':_0x413bf1,'minDays':this['config'][_0x2baf41(0x23a)]||0x7,'stbDays':this['config']['ltmStbWindowDays']||0xe,'ltbDays':this[_0x2baf41(0x1ed)][_0x2baf41(0x151)]||0x3c,'systemError':_0x508f47},'automation':_0x260dc4},_0x4adb89[_0x2baf41(0x246)]);}else{if(_0x4adb89['command']===_0x2baf41(0x154))try{const _0x3d0563=await scanForDevices(this,_0x4adb89[_0x2baf41(0x256)]||{});this[_0x2baf41(0x102)](_0x4adb89[_0x2baf41(0xe4)],_0x4adb89[_0x2baf41(0x15c)],{'success':!![],'devices':_0x3d0563},_0x4adb89['callback']);}catch(_0x424d0d){this[_0x2baf41(0x102)](_0x4adb89['from'],_0x4adb89[_0x2baf41(0x15c)],{'success':![],'error':_0x424d0d[_0x2baf41(0x256)]},_0x4adb89['callback']);}else{if(_0x4adb89['command']===_0x2baf41(0x146)){const _0x30e806=await this[_0x2baf41(0x100)](_0x2baf41(0x1f4),'enum'),_0x4adb8d=[];if(_0x30e806)for(const _0x2892f0 in _0x30e806){const _0x590744=_0x30e806[_0x2892f0],_0x1744d5=(_0x590744['common']&&typeof _0x590744[_0x2baf41(0x145)][_0x2baf41(0x217)]===_0x2baf41(0x264)?_0x590744[_0x2baf41(0x145)][_0x2baf41(0x217)]['de']:_0x590744[_0x2baf41(0x145)][_0x2baf41(0x217)])||_0x590744[_0x2baf41(0x145)]['name'];_0x4adb8d[_0x2baf41(0x138)]({'id':_0x2892f0,'name':_0x1744d5});}this['sendTo'](_0x4adb89[_0x2baf41(0xe4)],_0x4adb89[_0x2baf41(0x15c)],{'success':!![],'enums':_0x4adb8d},_0x4adb89[_0x2baf41(0x246)]);}else{if(_0x4adb89[_0x2baf41(0x15c)]==='getCalendarNames'){const _0x211924=_0x4adb89['message']['instance'];if(!_0x211924)return this[_0x2baf41(0x102)](_0x4adb89['from'],_0x4adb89[_0x2baf41(0x15c)],{'success':![],'error':_0x2baf41(0x1bc)},_0x4adb89[_0x2baf41(0x246)]);const _0x10556a=await getCalendarNames(this,_0x211924);this[_0x2baf41(0x102)](_0x4adb89[_0x2baf41(0xe4)],_0x4adb89['command'],{'success':!![],'names':_0x10556a},_0x4adb89[_0x2baf41(0x246)]);}else{if(_0x4adb89[_0x2baf41(0x15c)]==='simulateButler'){const {targetId:_0x3c3aea,targetValue:_0x484a37}=_0x4adb89['message'];this[_0x2baf41(0xed)][_0x2baf41(0xdb)](_0x2baf41(0x23f)+_0x3c3aea+_0x2baf41(0xf3)+_0x484a37),await this[_0x2baf41(0x162)](_0x2baf41(0x227),{'val':!![],'ack':!![]}),await this[_0x2baf41(0x162)](_0x2baf41(0x18d),{'val':_0x2baf41(0x1c4)+_0x3c3aea,'ack':!![]}),await this['setStateAsync'](_0x2baf41(0x24a),{'val':_0x3c3aea,'ack':!![]}),await this[_0x2baf41(0x162)]('analysis.automation.targetValue',{'val':_0x484a37,'ack':!![]}),this[_0x2baf41(0x102)](_0x4adb89[_0x2baf41(0xe4)],_0x4adb89[_0x2baf41(0x15c)],{'success':!![]},_0x4adb89['callback']);}else{if(_0x4adb89[_0x2baf41(0x15c)]===_0x2baf41(0x1ff)){const {historyId:_0x241f60,rating:_0x36ae8a,comment:_0x3b6664,alertReason:_0x1827c9}=_0x4adb89[_0x2baf41(0x256)];_0x241f60&&_0x36ae8a?(await saveFeedback(this,{'timestamp':Date[_0x2baf41(0x275)](),'historyId':_0x241f60,'rating':_0x36ae8a,'comment':_0x3b6664,'alertReason':_0x1827c9}),this[_0x2baf41(0x102)](_0x4adb89[_0x2baf41(0xe4)],_0x4adb89['command'],{'success':!![]},_0x4adb89[_0x2baf41(0x246)])):this['sendTo'](_0x4adb89[_0x2baf41(0xe4)],_0x4adb89[_0x2baf41(0x15c)],{'success':![],'error':_0x2baf41(0x170)},_0x4adb89[_0x2baf41(0x246)]);}else _0x4adb89[_0x2baf41(0x15c)]===_0x2baf41(0x23e)&&(this[_0x2baf41(0xed)]['info'](_0x2baf41(0x173)),await this[_0x2baf41(0x162)](_0x2baf41(0x227),{'val':![],'ack':!![]}),await this[_0x2baf41(0x162)](_0x2baf41(0x18d),{'val':'','ack':!![]}),this[_0x2baf41(0x102)](_0x4adb89['from'],_0x4adb89[_0x2baf41(0x15c)],{'success':!![]},_0x4adb89[_0x2baf41(0x246)]));}}}}}}}}}}}if(require[a0_0x21f9c7(0x27f)]!==module)module[a0_0x21f9c7(0x137)]=_0x2124e6=>new CogniLiving(_0x2124e6);else new CogniLiving();