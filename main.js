const a0_0x47a950=a0_0x5820;(function(_0x5718d5,_0x324498){const _0x369693=a0_0x5820,_0x30f8a2=_0x5718d5();while(!![]){try{const _0x3c9af1=-parseInt(_0x369693(0x15e))/0x1+-parseInt(_0x369693(0x10b))/0x2+-parseInt(_0x369693(0x143))/0x3+parseInt(_0x369693(0x249))/0x4+parseInt(_0x369693(0x288))/0x5+parseInt(_0x369693(0x10e))/0x6+parseInt(_0x369693(0x188))/0x7*(parseInt(_0x369693(0x173))/0x8);if(_0x3c9af1===_0x324498)break;else _0x30f8a2['push'](_0x30f8a2['shift']());}catch(_0x2173b9){_0x30f8a2['push'](_0x30f8a2['shift']());}}}(a0_0x3779,0xea563));function a0_0x5820(_0x3fa654,_0xd234e9){const _0x33a948=a0_0x3779();return a0_0x5820=function(_0x100790,_0x3a858c){_0x100790=_0x100790-0xf7;let _0x377947=_0x33a948[_0x100790];return _0x377947;},a0_0x5820(_0x3fa654,_0xd234e9);}const a0_0x3a858c=(function(){let _0x286856=!![];return function(_0x79aa65,_0x4ea08a){const _0x4675ac=_0x286856?function(){const _0x311766=a0_0x5820;if(_0x4ea08a){const _0x3596e8=_0x4ea08a[_0x311766(0x195)](_0x79aa65,arguments);return _0x4ea08a=null,_0x3596e8;}}:function(){};return _0x286856=![],_0x4675ac;};}()),a0_0x100790=a0_0x3a858c(this,function(){const _0x4b1492=a0_0x5820;return a0_0x100790[_0x4b1492(0x1ee)]()[_0x4b1492(0x21c)](_0x4b1492(0x264))[_0x4b1492(0x1ee)]()[_0x4b1492(0x20b)](a0_0x100790)[_0x4b1492(0x21c)](_0x4b1492(0x264));});a0_0x100790();'use strict';const utils=require('@iobroker/adapter-core'),{GoogleGenerativeAI}=require(a0_0x47a950(0x286)),schedule=require(a0_0x47a950(0x164)),{spawn,exec}=require('child_process'),path=require(a0_0x47a950(0x20e)),fs=require('fs'),HISTORY_MAX_SIZE=0x32,RAW_LOG_MAX_SIZE=0x5dc,LTM_MIN_EVENTS_FOR_COMPRESSION=0x5,GEMINI_MODEL='models/gemini-flash-latest',LTM_SCHEDULE=a0_0x47a950(0x167),MODE_RESET_SCHEDULE=a0_0x47a950(0x1a6),SEQUENCE_TIMEOUT_MS=0x5*0x3c*0x3e8,MAX_TRAINING_SET_SIZE=0x1f4,THERMO_LOG_SIZE=0x3e8,ANALYSIS_HISTORY_MAX_SIZE=0x64,EXIT_TIMER_MINUTES=0xf,EXIT_GRACE_PERIOD_SECONDS=0x1e,LTM_DP_RAW_LOG='LTM.rawEventLog',LTM_DP_DAILY_DIGESTS='LTM.dailyDigests',LTM_DP_STATUS=a0_0x47a950(0x27a),LTM_DP_TRIGGER_DIGEST='LTM.triggerDailyDigest',LTM_DP_BASELINE_STATUS=a0_0x47a950(0x20a),LTM_DP_DRIFT_CHANNEL=a0_0x47a950(0x127),LTM_DP_DRIFT_STATUS='LTM.driftAnalysis.baselineDrift',LTM_DP_DRIFT_DETAILS=a0_0x47a950(0x1c9),LTM_DP_DRIFT_LAST_CHECK=a0_0x47a950(0x1c8),SYSTEM_DP_MODE=a0_0x47a950(0x1ff),SYSTEM_MODES={'NORMAL':a0_0x47a950(0x13e),'VACATION':a0_0x47a950(0x280),'PARTY':a0_0x47a950(0x1ae),'GUEST':a0_0x47a950(0x230)},AUTO_RESET_MODES=[SYSTEM_MODES['PARTY'],SYSTEM_MODES[a0_0x47a950(0x25f)]],PERSONA_MAPPING={'generic':'Analysiere\x20ausgewogen.','senior_aal':a0_0x47a950(0x26a),'family':a0_0x47a950(0x17c),'single_comfort':a0_0x47a950(0x292),'security':a0_0x47a950(0x105)},ACTIVITY_LEVEL_MAP={'sehr\x20hoch':0x64,'hoch':0x50,'normal':0x3c,'niedrig':0x28,'sehr\x20niedrig':0x14,'inaktiv':0x0},HARD_IGNORE_TERMS=[a0_0x47a950(0x1d9),a0_0x47a950(0x11f),a0_0x47a950(0x283),a0_0x47a950(0x142),a0_0x47a950(0x203),a0_0x47a950(0x25c),a0_0x47a950(0x18c),a0_0x47a950(0x296),a0_0x47a950(0x23c),a0_0x47a950(0x12c),'working',a0_0x47a950(0x24b),a0_0x47a950(0x282),a0_0x47a950(0x209),'dutycycle',a0_0x47a950(0x1e3),a0_0x47a950(0x108),a0_0x47a950(0x14f)],BAD_NAMES=[a0_0x47a950(0x14a),'currentposition',a0_0x47a950(0x1d3),a0_0x47a950(0x23f),a0_0x47a950(0x178),a0_0x47a950(0x217),'on',a0_0x47a950(0x25b),a0_0x47a950(0x1e7),a0_0x47a950(0x281),a0_0x47a950(0x135),a0_0x47a950(0x1df),a0_0x47a950(0x21d),a0_0x47a950(0x28b),a0_0x47a950(0x129),a0_0x47a950(0x166),a0_0x47a950(0x1ba),a0_0x47a950(0x1b8),'humidity',a0_0x47a950(0x24e),a0_0x47a950(0x256),a0_0x47a950(0xf7),a0_0x47a950(0x1b0),a0_0x47a950(0x25e),'set_temperature'],ADAPTER_BLACKLIST=[a0_0x47a950(0x27f),a0_0x47a950(0x1b1),a0_0x47a950(0x279),a0_0x47a950(0x1d0),a0_0x47a950(0x23d),a0_0x47a950(0x103),a0_0x47a950(0x1fe),'flot.',a0_0x47a950(0x148),'javascript.',a0_0x47a950(0x12f)],IS_WIN=process[a0_0x47a950(0x14c)]===a0_0x47a950(0xf9),VENV_PATH=path[a0_0x47a950(0x190)](__dirname,a0_0x47a950(0x199)),PYTHON_EXE=IS_WIN?path[a0_0x47a950(0x190)](VENV_PATH,'Scripts','python.exe'):path[a0_0x47a950(0x190)](VENV_PATH,'bin',a0_0x47a950(0x1ac)),PIP_EXE=IS_WIN?path[a0_0x47a950(0x190)](VENV_PATH,a0_0x47a950(0x226),a0_0x47a950(0x19c)):path[a0_0x47a950(0x190)](VENV_PATH,'bin',a0_0x47a950(0x1f8));let activeSequence=[],sequenceTimer=null,panicMode=![];async function initZombies(_0x537229){const _0x50a6ed=a0_0x47a950;try{const _0x1a2d50=[_0x50a6ed(0x1dc),_0x50a6ed(0x153)];for(const _0x1750d4 of _0x1a2d50){try{const _0xc2f67b=await _0x537229[_0x50a6ed(0x21e)](_0x1750d4);if(_0xc2f67b)await _0x537229[_0x50a6ed(0x207)](_0x1750d4);}catch(_0x1ca13a){}}}catch(_0x5d22bd){}}async function initHistory(_0x390b14){const _0x5cb865=a0_0x47a950;try{const _0x52bb6b=await _0x390b14[_0x5cb865(0x24d)](_0x5cb865(0x22b));_0x52bb6b&&_0x52bb6b[_0x5cb865(0x260)]&&(_0x390b14[_0x5cb865(0x120)]=JSON['parse'](_0x52bb6b[_0x5cb865(0x260)]['toString']()));}catch(_0x2b49b6){_0x390b14[_0x5cb865(0x120)]=[];}try{const _0x4d9ad5=await _0x390b14[_0x5cb865(0x24d)](_0x5cb865(0x136));if(_0x4d9ad5&&_0x4d9ad5[_0x5cb865(0x260)])_0x390b14['analysisHistory']=JSON[_0x5cb865(0x257)](_0x4d9ad5[_0x5cb865(0x260)][_0x5cb865(0x1ee)]());}catch(_0x4c6624){_0x390b14[_0x5cb865(0x205)]=[];}if(_0x390b14[_0x5cb865(0x120)]&&_0x390b14['eventHistory']['length']>0x0){_0x390b14['log'][_0x5cb865(0x1e5)]('Restoring\x20sensor\x20cache\x20from\x20history\x20('+_0x390b14[_0x5cb865(0x120)][_0x5cb865(0x193)]+_0x5cb865(0x1f9));for(let _0x2d1e82=_0x390b14[_0x5cb865(0x120)][_0x5cb865(0x193)]-0x1;_0x2d1e82>=0x0;_0x2d1e82--){const _0x368c7a=_0x390b14[_0x5cb865(0x120)][_0x2d1e82];if(_0x368c7a&&_0x368c7a['id']!==undefined&&_0x368c7a[_0x5cb865(0x178)]!==undefined)_0x390b14[_0x5cb865(0x22c)][_0x368c7a['id']]=_0x368c7a[_0x5cb865(0x178)];}}}async function initSystemConfig(_0x4cf4dd){const _0x58a085=a0_0x47a950;try{const _0x250682=await _0x4cf4dd[_0x58a085(0x152)](_0x58a085(0x248));if(_0x250682&&_0x250682['common'])_0x4cf4dd[_0x58a085(0x140)]={'latitude':_0x250682[_0x58a085(0x1ce)][_0x58a085(0x18e)]||0x0,'longitude':_0x250682[_0x58a085(0x1ce)]['longitude']||0x0,'city':_0x250682[_0x58a085(0x1ce)][_0x58a085(0x113)]||''};}catch(_0xad00af){}}async function checkLicense(_0xc13909,_0x4a7d6a){return!![];}async function getSystemUUID(_0x51042f){return'uuid';}async function loadRawEventLog(_0x50aeb2){const _0x51fd64=a0_0x47a950;try{const _0xba0aaf=await _0x50aeb2[_0x51fd64(0x24d)](LTM_DP_RAW_LOG);if(_0xba0aaf&&_0xba0aaf['val'])_0x50aeb2[_0x51fd64(0x18a)]=JSON[_0x51fd64(0x257)](_0xba0aaf[_0x51fd64(0x260)]);}catch(_0x1713a0){_0x50aeb2[_0x51fd64(0x18a)]=[];}}async function saveRawEventLog(_0x34d270){const _0x393798=a0_0x47a950;if(_0x34d270[_0x393798(0x18a)]['length']>RAW_LOG_MAX_SIZE)_0x34d270[_0x393798(0x18a)]['splice'](0x0,_0x34d270[_0x393798(0x18a)]['length']-RAW_LOG_MAX_SIZE);await _0x34d270[_0x393798(0xfa)](LTM_DP_RAW_LOG,{'val':JSON['stringify'](_0x34d270['rawEventLog']),'ack':!![]});}async function loadDailyDigests(_0x2786bb){const _0x27df3f=a0_0x47a950;try{const _0x349f9a=await _0x2786bb[_0x27df3f(0x24d)](LTM_DP_DAILY_DIGESTS);if(_0x349f9a&&_0x349f9a[_0x27df3f(0x260)])_0x2786bb[_0x27df3f(0x219)]=JSON['parse'](_0x349f9a[_0x27df3f(0x260)]);}catch(_0x2a4270){_0x2786bb['dailyDigests']=[];}await updateBaselineStatus(_0x2786bb);}function a0_0x3779(){const _0x4e2e64=['update','json','analysis.health','@google/generative-ai','exitTimer','2743665AqQXsu','window','schalter','status','targetValue','devices','notifyEmailRecipient','KI-Modell\x20nicht\x20initialisiert','licenseKey','analysis.training.triggerSecurity','Fokus\x20auf\x20Komfort.','LTM','onStateChange','unshift','maintenance','analysis.automation.description','Could\x20not\x20delete\x20.venv,\x20trying\x20to\x20overwrite...','setpoint','Vom\x20Benutzer\x20bestÃ¤tigt\x20(OK).','win32','setStateAsync','getMonth','triggerDailyDigest','Train\x20Health','getForeignStateAsync','âœ…\x20HEALTH\x20TRAINED:\x20','âŒ\x20VALIDATION\x20FAILED.\x20Tensorflow\x20broken.\x20Panic\x20Mode.','currentSystemMode','from','material.','temperatur','PRIORITÃ„T:\x20Sicherheit.','door','Trend','reachable','ðŸ›¡ï¸\x20SECURITY:\x20Sending\x20sequence\x20to\x20Guard\x20for\x20analysis...','sendTo','2799056gpvNMJ','System\x20Mode',').\x20Repairing...','10317660azYCgT','button','Err:\x20','analysis.automation.targetValue','scanDevices','city','ANALYZE_TREND','\x20Tage)','analysis.automation.triggerAction','Kein\x20API\x20Key!','boolean','communicate.request','system.isPresent','endsWith','PONG','text.alarm','weatherunderground','scriptEnabled','eventHistory','ðŸ“ž\x20RÃœCKRUF\x20BITTE!\x20Der\x20Bewohner\x20hat\x20den\x20RÃ¼ckruf-Button\x20gedrÃ¼ckt.','LTM.trainingData.thermodynamics','lastAlertState','âš ï¸\x20Module\x20missing\x20(','toLocaleTimeString','text','LTM.driftAnalysis','online','motion','Trigger\x20Analysis','extendObjectAsync','fault','ack','toFixed','simple-api.','requirements.txt','getDate','split','bind','round','shutter','analysis.analysisHistory','Adapter','debug','exitGraceTimer','enum','analysis.training.status','prÃ¤senz','SECURITY_RESULT','normal','minDaysForBaseline','systemConfig','getLtmData','unreach','4015281OfXojW','COGNI_REQUEST_CALL','trim','fill','useWeather','echarts.','\x22\x20install\x20--no-cache-dir\x20--force-reinstall\x20-r\x20\x22','targetposition','Who\x20is\x20present?','platform','\x20->\x20','date','link_quality','subscribeStates','Trigger\x20Briefing','getForeignObjectAsync','events.history_debug_00','notifyTelegramEnabled','ðŸ§ª\x20Simulating\x20Butler\x20Proposal:\x20','isProVersion','filter','python3\x20-m\x20venv\x20\x22','kill','heizung','onMessage','notifyEmailEnabled','analysis.security.lastScore','1342549BTdfSa','analysis.triggerBriefing','indicator','Cogni-Living','analysis.training.triggerHealth','service.py','node-schedule','notifyEmailInstance','presence','0\x203\x20*\x20*\x20*','VACATION','main','analysis.automation.patternDetected','telegram','getEnums','Security\x20Monitor','presenceDevices','response','close','[RESULT]','analysis.automation.autoApply','11061672SMZmSJ','systemUUID','kontakt','analysis.energy.heatingScore','getFullYear','value','ANALYZE_SEQUENCE','dimmer','ltmJob','Fokus\x20auf\x20Familienroutinen.','.forecast.current.temp','[RECORDER]\x20Added\x20step\x20to\x20sequence:\x20','[PYTHON\x20ERR]\x20','ready','Failed:\x20','log','User\x20dismissed\x20automation\x20proposal.','ðŸ› ï¸\x20REPAIR\x20MODE:\x20Reinstalling\x20Python\x20environment.\x20DO\x20NOT\x20RESTART\x20MANUALLY.','Aktiv\x20(','shift','ðŸ“ž\x20RÃ¼ckruf\x20anfordern','7yiLLht','sendToAsync','rawEventLog','COGNI_CONFIRM_OK','connection','âœ…\x20INSTALL\x20SUCCESS.\x20Validating...','latitude','genAI','join','Insulation\x20Score','ltmStbWindowDays','length','system.presenceWho','apply','Train\x20Security','includes','cogni-living','.venv','Training\x20Error:\x20','subscribeForeignStatesAsync','pip.exe','stdout','\x20=\x20','Invalid\x20JSON:\x20','geminiApiKey','pop','python_service','driftAnalysisTimer','analysisTimer','UngewÃ¶hnliches\x20Bewegungsmuster!\x20(Score:\x20','0\x204\x20*\x20*\x20*','generateContent','warn','activityLevel','message','config','python','ðŸ\x20Python\x20Pong','party','notifyTelegramInstance','valve','admin.','heating','values','Lernphase\x20(','Alarm','Energy\x20Intelligence','find','temperature','analysis.health.isAnomaly','occupancy','LTM.trainingData.sequences','stateChange','timestamp','analysis.health.trendDiagnosis','description','push','TRAINING_COMPLETE','\x20(Length:\x20','cogni-living\x20adapter\x20starting\x20(v','simulateButler','rm\x20-rf\x20\x22','expire','âŒ\x20INSTALL\x20FAILED.\x20Panic\x20Mode\x20activated.\x20Check\x20logs.','LTM.driftAnalysis.lastCheck','LTM.driftAnalysis.driftDetails','modeResetJob','NORMAL','Deaktiviert\x20(Pro-Feature)','write','common','daswetter','vis.','dependencyInstallInProgress','Trigger\x20Action','state','Alert\x20Reason','No\x20instance','forEach','now','toLowerCase','scriptProblem','stringify','command','analysis.history_debug_00','writable','inactivityThresholdHours','blind','namespace','getTime','startsWith','firmware','geminiModel','info','analysis.health.lastCheck','switch','location','indicator.alarm','loc','ðŸ\x20Guardian\x20Diagnosis:\x20','Sec-Training\x20started...','getHours','toString','analysis.trigger',')\x20-\x20PANIC\x20MODE\x20FIX','object','version','Raw\x20Log','setState','analysis.alertReason','ltmLtbWindowDays','klima','pip','\x20events)...','Train\x20Energy','Activity-Level','analysis.training','number','icons-mfd.','system.mode','channel','notifyPushoverEnabled','Pattern\x20Detected','lowbat','detected','analysisHistory','TRAIN_HEALTH','delObjectAsync','indexOf','config_pending','LTM.baselineStatus','constructor','send','Heating\x20Score','path','âŒ\x20VENV\x20FAILED.\x20Check\x20system\x20package:\x20sudo\x20apt\x20install\x20python3-venv','Kein\x20API\x20Key.','events.lastEvent','Event\x20History','analysis.security.lastCheck','OK:\x20','N/A','onUnload','brightness','âš ï¸\x20VENV\x20missing.\x20Fixing...','dailyDigests','TRAIN_SECURITY','analysis.isAlert','search','cover','getObjectAsync','isExit','Missing\x20data','SIMULATION:\x20Test-Vorschlag\x20fÃ¼r\x20','âœ…\x20VALIDATION\x20PASSED.\x20Starting...','âœ…\x20Alarm\x20quittiert.\x20System\x20normal.','ðŸ¤–\x20BUTLER:\x20Executing\x20Action\x20->\x20','cpu_feature_guard','Scripts','Success:\x20','BUTLER\x20Execution\x20Error:\x20','Auto\x20Apply','onReady','events.history','sensorLastValues','unknown','map','.NextHours.Location_1.Day_1.current.temp_value','guest','Daily\x20Digests','briefingJob','âœ…\x20Alles\x20OK\x20(Reset)]','ðŸš¨\x20EMERGENCY','Anomaly\x20Score','unload','insulation','Sequences','isPresent','setObjectNotExistsAsync','type','error','history.','Last\x20Check','level','System','analysis.automation.targetId','submitFeedback','callback','stdin','cancel','payload','sound','system.config','5557180kQpFhN','triggerBriefing','direction','weatherInstance','getStateAsync','power','notifyPushoverRecipient','Trend\x20Value','getForeignObjectsAsync','analysis.energy.insulationScore','data','outdoorSensorId','name','energy','parse','pythonProcess','Target\x20ID','autoApply','off','rssi','isGracePeriodActive','actual_temperature','GUEST','val','contact','lampe','.communicate.request','(((.+)+)+)+$','setForeignStateAsync','siren','analysis.health.trendValue','Alert\x20Status','analysis.activitySummary','PRIORITÃ„T:\x20Gesundheit/AAL.','analysis.training.triggerEnergy','substring','openweathermap','[LOG]','some','Target\x20Value','enum.functions.*','ANOMALY','analysis.security','python3','logDuplicates','toISOString','HARD\x20WATCHDOG:\x20No\x20activity\x20for\x20','.Current.Temperature','info.','LTM.processingStatus','Thermodynamics','string','apiKey','fenster','system.','vacation','position','stick_unreach'];a0_0x3779=function(){return _0x4e2e64;};return a0_0x3779();}async function saveDailyDigests(_0x408c07,_0x32063a=!![]){const _0x1c9253=a0_0x47a950,_0x59951d=_0x408c07[_0x1c9253(0x1ab)][_0x1c9253(0x1f6)]||0x3c;_0x408c07[_0x1c9253(0x219)][_0x1c9253(0x193)]>_0x59951d&&_0x408c07[_0x1c9253(0x219)]['splice'](0x0,_0x408c07[_0x1c9253(0x219)]['length']-_0x59951d);await _0x408c07['setStateAsync'](LTM_DP_DAILY_DIGESTS,{'val':JSON[_0x1c9253(0x1da)](_0x408c07[_0x1c9253(0x219)]),'ack':!![]});if(_0x32063a)await updateBaselineStatus(_0x408c07);}async function updateAnalysisHistory(_0x334113,_0xbc35d3){const _0x598852=a0_0x47a950;_0x334113[_0x598852(0x205)][_0x598852(0x295)](_0xbc35d3);if(_0x334113[_0x598852(0x205)][_0x598852(0x193)]>ANALYSIS_HISTORY_MAX_SIZE)_0x334113[_0x598852(0x205)]['pop']();await _0x334113[_0x598852(0xfa)]('analysis.analysisHistory',{'val':JSON[_0x598852(0x1da)](_0x334113[_0x598852(0x205)]),'ack':!![]});}async function updateBaselineStatus(_0x4877b0){const _0xa67dde=a0_0x47a950;if(!_0x4877b0['isProVersion']){await _0x4877b0[_0xa67dde(0xfa)](LTM_DP_BASELINE_STATUS,{'val':_0xa67dde(0x1cc),'ack':!![]});return;}const _0xa920ec=_0x4877b0[_0xa67dde(0x219)][_0xa67dde(0x193)]>=(_0x4877b0[_0xa67dde(0x1ab)][_0xa67dde(0x13f)]||0x7)?_0xa67dde(0x185)+_0x4877b0[_0xa67dde(0x219)]['length']+_0xa67dde(0x115):_0xa67dde(0x1b4)+_0x4877b0['dailyDigests'][_0xa67dde(0x193)]+'/'+(_0x4877b0[_0xa67dde(0x1ab)][_0xa67dde(0x13f)]||0x7)+')';await _0x4877b0[_0xa67dde(0xfa)](LTM_DP_BASELINE_STATUS,{'val':_0xa920ec,'ack':!![]});}async function loadSystemMode(_0x2cc616){const _0x1c2221=a0_0x47a950;try{const _0x5b829c=await _0x2cc616[_0x1c2221(0x24d)](SYSTEM_DP_MODE);_0x5b829c&&_0x5b829c[_0x1c2221(0x260)]&&Object[_0x1c2221(0x1b3)](SYSTEM_MODES)[_0x1c2221(0x197)](_0x5b829c['val'])?_0x2cc616[_0x1c2221(0x101)]=_0x5b829c[_0x1c2221(0x260)]:(_0x2cc616[_0x1c2221(0x101)]=SYSTEM_MODES[_0x1c2221(0x1cb)],await _0x2cc616['setStateAsync'](SYSTEM_DP_MODE,{'val':SYSTEM_MODES[_0x1c2221(0x1cb)],'ack':!![]}));}catch(_0x296335){_0x2cc616['currentSystemMode']=SYSTEM_MODES[_0x1c2221(0x1cb)];}}async function createAllObjects(_0x23171f){const _0x22cb93=a0_0x47a950;await _0x23171f[_0x22cb93(0x12b)]('system',{'type':_0x22cb93(0x200),'common':{'name':_0x22cb93(0x240)},'native':{}}),await _0x23171f[_0x22cb93(0x12b)](SYSTEM_DP_MODE,{'type':_0x22cb93(0x1d3),'common':{'name':_0x22cb93(0x10c),'type':_0x22cb93(0x27c),'role':'state','read':!![],'write':!![],'def':SYSTEM_MODES['NORMAL']},'native':{}}),await _0x23171f[_0x22cb93(0x23a)](_0x22cb93(0x194),{'type':_0x22cb93(0x1d3),'common':{'name':_0x22cb93(0x14b),'type':_0x22cb93(0x27c),'role':_0x22cb93(0x126),'read':!![],'write':![]},'native':{}}),await _0x23171f['setObjectNotExistsAsync'](_0x22cb93(0x211),{'type':'state','common':{'name':'Last\x20raw\x20event','type':'string','role':_0x22cb93(0x284),'read':!![],'write':![]},'native':{}}),await _0x23171f[_0x22cb93(0x23a)](_0x22cb93(0x22b),{'type':_0x22cb93(0x1d3),'common':{'name':_0x22cb93(0x212),'type':_0x22cb93(0x27c),'role':_0x22cb93(0x284),'read':!![],'write':![]},'native':{}}),await _0x23171f[_0x22cb93(0x12b)](_0x22cb93(0x1fc),{'type':_0x22cb93(0x200),'common':{'name':'AI\x20Training'},'native':{}}),await _0x23171f[_0x22cb93(0x23a)](_0x22cb93(0x291),{'type':'state','common':{'name':_0x22cb93(0x196),'type':'boolean','role':_0x22cb93(0x10f),'read':!![],'write':!![]},'native':{}}),await _0x23171f[_0x22cb93(0x23a)](_0x22cb93(0x162),{'type':_0x22cb93(0x1d3),'common':{'name':_0x22cb93(0xfd),'type':_0x22cb93(0x118),'role':'button','read':!![],'write':!![]},'native':{}}),await _0x23171f[_0x22cb93(0x23a)]('analysis.training.triggerEnergy',{'type':'state','common':{'name':_0x22cb93(0x1fa),'type':'boolean','role':'button','read':!![],'write':!![]},'native':{}}),await _0x23171f['setObjectNotExistsAsync']('analysis.training.status',{'type':_0x22cb93(0x1d3),'common':{'name':'Training\x20Status','type':_0x22cb93(0x27c),'role':_0x22cb93(0x126),'read':!![],'write':![]},'native':{}}),await _0x23171f['extendObjectAsync'](_0x22cb93(0x273),{'type':_0x22cb93(0x200),'common':{'name':_0x22cb93(0x16d)},'native':{}}),await _0x23171f[_0x22cb93(0x23a)](_0x22cb93(0x15d),{'type':_0x22cb93(0x1d3),'common':{'name':_0x22cb93(0x235),'type':'number','role':_0x22cb93(0x178),'read':!![],'write':![]},'native':{}}),await _0x23171f['setObjectNotExistsAsync'](_0x22cb93(0x213),{'type':_0x22cb93(0x1d3),'common':{'name':_0x22cb93(0x23e),'type':_0x22cb93(0x27c),'role':_0x22cb93(0x14e),'read':!![],'write':![]},'native':{}}),await _0x23171f['extendObjectAsync'](_0x22cb93(0x285),{'type':_0x22cb93(0x200),'common':{'name':'Health\x20Analysis'},'native':{}}),await _0x23171f[_0x22cb93(0x23a)]('analysis.health.lastCheck',{'type':_0x22cb93(0x1d3),'common':{'name':_0x22cb93(0x23e),'type':_0x22cb93(0x27c),'role':_0x22cb93(0x14e),'read':!![],'write':![]},'native':{}}),await _0x23171f['setObjectNotExistsAsync'](_0x22cb93(0x1b9),{'type':_0x22cb93(0x1d3),'common':{'name':'Anomaly\x20Detected','type':_0x22cb93(0x118),'role':_0x22cb93(0x160),'read':!![],'write':![]},'native':{}}),await _0x23171f[_0x22cb93(0x23a)](_0x22cb93(0x1be),{'type':'state','common':{'name':_0x22cb93(0x107),'type':'string','role':_0x22cb93(0x126),'read':!![],'write':![]},'native':{}}),await _0x23171f[_0x22cb93(0x23a)]('analysis.health.trendValue',{'type':_0x22cb93(0x1d3),'common':{'name':_0x22cb93(0x250),'type':_0x22cb93(0x1fd),'role':'value','read':!![],'write':![]},'native':{}}),await _0x23171f[_0x22cb93(0x12b)]('analysis.energy',{'type':_0x22cb93(0x200),'common':{'name':_0x22cb93(0x1b6)},'native':{}}),await _0x23171f['setObjectNotExistsAsync'](_0x22cb93(0x252),{'type':_0x22cb93(0x1d3),'common':{'name':_0x22cb93(0x191),'type':'string','role':_0x22cb93(0x126),'read':!![],'write':![]},'native':{}}),await _0x23171f[_0x22cb93(0x23a)](_0x22cb93(0x176),{'type':'state','common':{'name':_0x22cb93(0x20d),'type':_0x22cb93(0x27c),'role':_0x22cb93(0x126),'read':!![],'write':![]},'native':{}}),await _0x23171f['extendObjectAsync'](_0x22cb93(0x293),{'type':'channel','common':{'name':_0x22cb93(0x293)},'native':{}}),await _0x23171f[_0x22cb93(0x12b)](LTM_DP_RAW_LOG,{'type':_0x22cb93(0x1d3),'common':{'name':_0x22cb93(0x1f3),'type':_0x22cb93(0x27c),'role':_0x22cb93(0x284),'read':!![],'write':![]},'native':{}}),await _0x23171f[_0x22cb93(0x12b)](LTM_DP_DAILY_DIGESTS,{'type':_0x22cb93(0x1d3),'common':{'name':_0x22cb93(0x231),'type':_0x22cb93(0x27c),'role':_0x22cb93(0x284),'read':!![],'write':![]},'native':{}}),await _0x23171f[_0x22cb93(0x23a)]('LTM.trainingData.sequences',{'type':_0x22cb93(0x1d3),'common':{'name':_0x22cb93(0x238),'type':'string','role':'json','read':!![],'write':![]},'native':{}}),await _0x23171f[_0x22cb93(0x23a)]('LTM.trainingData.thermodynamics',{'type':_0x22cb93(0x1d3),'common':{'name':_0x22cb93(0x27b),'type':_0x22cb93(0x27c),'role':_0x22cb93(0x284),'read':!![],'write':![]},'native':{}}),await _0x23171f['setObjectNotExistsAsync'](_0x22cb93(0x1ef),{'type':'state','common':{'name':_0x22cb93(0x12a),'type':_0x22cb93(0x118),'role':_0x22cb93(0x10f),'read':!![],'write':!![]},'native':{}}),await _0x23171f[_0x22cb93(0x23a)](_0x22cb93(0x15f),{'type':'state','common':{'name':_0x22cb93(0x151),'type':_0x22cb93(0x118),'role':_0x22cb93(0x10f),'read':!![],'write':!![]},'native':{}}),await _0x23171f[_0x22cb93(0x23a)](_0x22cb93(0x21b),{'type':_0x22cb93(0x1d3),'common':{'name':_0x22cb93(0x268),'type':_0x22cb93(0x118),'role':_0x22cb93(0x1e9),'read':!![],'write':![]},'native':{}}),await _0x23171f[_0x22cb93(0x23a)](_0x22cb93(0x1f5),{'type':_0x22cb93(0x1d3),'common':{'name':_0x22cb93(0x1d4),'type':'string','role':_0x22cb93(0x11d),'read':!![],'write':![]},'native':{}}),await _0x23171f['setObjectNotExistsAsync'](_0x22cb93(0x269),{'type':'state','common':{'name':'Activity\x20Summary','type':_0x22cb93(0x27c),'role':'text','read':!![],'write':![]},'native':{}}),await _0x23171f[_0x22cb93(0x23a)](_0x22cb93(0x16a),{'type':'state','common':{'name':_0x22cb93(0x202),'type':_0x22cb93(0x118),'role':_0x22cb93(0x160),'read':!![],'write':![]},'native':{}}),await _0x23171f['setObjectNotExistsAsync']('analysis.automation.description',{'type':_0x22cb93(0x1d3),'common':{'name':'Description','type':_0x22cb93(0x27c),'role':'text','read':!![],'write':![]},'native':{}}),await _0x23171f[_0x22cb93(0x23a)](_0x22cb93(0x241),{'type':'state','common':{'name':_0x22cb93(0x259),'type':'string','role':_0x22cb93(0x126),'read':!![],'write':![]},'native':{}}),await _0x23171f[_0x22cb93(0x23a)](_0x22cb93(0x111),{'type':_0x22cb93(0x1d3),'common':{'name':_0x22cb93(0x270),'type':'string','role':_0x22cb93(0x126),'read':!![],'write':![]},'native':{}}),await _0x23171f['setObjectNotExistsAsync'](_0x22cb93(0x172),{'type':_0x22cb93(0x1d3),'common':{'name':_0x22cb93(0x229),'type':_0x22cb93(0x118),'role':_0x22cb93(0x1e7),'read':!![],'write':!![]},'native':{}}),await _0x23171f[_0x22cb93(0x23a)](_0x22cb93(0x116),{'type':_0x22cb93(0x1d3),'common':{'name':_0x22cb93(0x1d2),'type':'boolean','role':_0x22cb93(0x10f),'read':!![],'write':!![]},'native':{}});}async function recordThermodynamics(_0x48c219,_0x5d20e7,_0x459171,_0x3810ff){const _0x4c9750=a0_0x47a950,_0x2f2405=await getOutsideTemperatureNumeric(_0x48c219),_0x2d82fe=await _0x48c219['getStateAsync'](_0x4c9750(0x122));let _0x9589b=[];if(_0x2d82fe&&_0x2d82fe[_0x4c9750(0x260)])try{_0x9589b=JSON[_0x4c9750(0x257)](_0x2d82fe[_0x4c9750(0x260)]);}catch(_0x5591ef){}_0x9589b['push']({'ts':Date[_0x4c9750(0x1d7)](),'room':_0x3810ff||'Unknown','t_in':_0x459171,'t_out':_0x2f2405});if(_0x9589b[_0x4c9750(0x193)]>THERMO_LOG_SIZE)_0x9589b['shift']();await _0x48c219[_0x4c9750(0xfa)]('LTM.trainingData.thermodynamics',{'val':JSON[_0x4c9750(0x1da)](_0x9589b),'ack':!![]});}async function getOutsideTemperatureNumeric(_0x1e9152){const _0x2f53d0=a0_0x47a950;if(_0x1e9152[_0x2f53d0(0x1ab)][_0x2f53d0(0x254)])try{const _0x3e2733=await _0x1e9152[_0x2f53d0(0xfe)](_0x1e9152[_0x2f53d0(0x1ab)][_0x2f53d0(0x254)]);if(_0x3e2733&&_0x3e2733[_0x2f53d0(0x260)]!==undefined&&_0x3e2733[_0x2f53d0(0x260)]!==null)return parseFloat(_0x3e2733[_0x2f53d0(0x260)]);}catch(_0x2a1905){}const _0x489fe5=_0x1e9152[_0x2f53d0(0x1ab)][_0x2f53d0(0x24c)];if(!_0x1e9152[_0x2f53d0(0x1ab)][_0x2f53d0(0x147)]||!_0x489fe5)return null;try{let _0x150b51='';if(_0x489fe5['includes']('accuweather'))_0x150b51=_0x489fe5+_0x2f53d0(0x278);else{if(_0x489fe5[_0x2f53d0(0x197)](_0x2f53d0(0x1cf)))_0x150b51=_0x489fe5+_0x2f53d0(0x22f);else{if(_0x489fe5[_0x2f53d0(0x197)](_0x2f53d0(0x26d)))_0x150b51=_0x489fe5+'.forecast.current.temperature';else{if(_0x489fe5['includes'](_0x2f53d0(0x11e)))_0x150b51=_0x489fe5+_0x2f53d0(0x17d);}}}if(_0x150b51){const _0x3b557e=await _0x1e9152['getForeignStateAsync'](_0x150b51);if(_0x3b557e&&_0x3b557e[_0x2f53d0(0x260)]!==undefined&&_0x3b557e['val']!==null)return parseFloat(_0x3b557e[_0x2f53d0(0x260)]);}}catch(_0x5a3b5a){}return null;}async function recordSequence(_0x261a2b,_0x54f58e){const _0x1c9d6d=a0_0x47a950,_0x4af447=(_0x54f58e[_0x1c9d6d(0x23b)]||'')['toLowerCase'](),_0x521561=['motion','bewegung',_0x1c9d6d(0x13c),_0x1c9d6d(0x166),_0x1c9d6d(0x1ba),_0x1c9d6d(0x106),'tÃ¼r',_0x1c9d6d(0x289),_0x1c9d6d(0x27e),_0x1c9d6d(0x261),_0x1c9d6d(0x175),'light','licht','switch',_0x1c9d6d(0x28a),_0x1c9d6d(0x17a),_0x1c9d6d(0x262)];if(!_0x521561[_0x1c9d6d(0x26f)](_0x11fca1=>_0x4af447['includes'](_0x11fca1)))return;if(!_0x54f58e['value'])return;if(sequenceTimer)clearTimeout(sequenceTimer);activeSequence['push']({'loc':_0x54f58e['location']||'Unknown','id':_0x54f58e['id'],'ts':Date[_0x1c9d6d(0x1d7)]()}),_0x261a2b[_0x1c9d6d(0x182)][_0x1c9d6d(0x138)](_0x1c9d6d(0x17e)+_0x54f58e[_0x1c9d6d(0x1e8)]+_0x1c9d6d(0x1c2)+activeSequence['length']+')'),sequenceTimer=setTimeout(async()=>{if(activeSequence['length']>0x1)await saveCompletedSequence(_0x261a2b);activeSequence=[];},SEQUENCE_TIMEOUT_MS);}async function saveCompletedSequence(_0x59ca30){const _0x54df17=a0_0x47a950;try{const _0x23347a=await _0x59ca30[_0x54df17(0x24d)](_0x54df17(0x1bb));let _0x586265=[];if(_0x23347a&&_0x23347a[_0x54df17(0x260)])try{_0x586265=JSON['parse'](_0x23347a['val']);}catch(_0x3237ff){}const _0x506f42=activeSequence[0x0]['ts'],_0x1af045=activeSequence[_0x54df17(0x22e)](_0x49548c=>({'loc':_0x49548c[_0x54df17(0x1ea)],'t_delta':Math[_0x54df17(0x134)]((_0x49548c['ts']-_0x506f42)/0x3e8)})),_0x24b6c7={'timestamp':new Date(_0x506f42)[_0x54df17(0x276)](),'steps':_0x1af045,'duration':Math[_0x54df17(0x134)]((activeSequence[activeSequence[_0x54df17(0x193)]-0x1]['ts']-_0x506f42)/0x3e8),'daytime':new Date(_0x506f42)[_0x54df17(0x1ed)]()};_0x586265[_0x54df17(0x1c0)](_0x24b6c7);if(_0x586265[_0x54df17(0x193)]>MAX_TRAINING_SET_SIZE)_0x586265[_0x54df17(0x186)]();await _0x59ca30[_0x54df17(0xfa)](_0x54df17(0x1bb),{'val':JSON['stringify'](_0x586265),'ack':!![]}),runSecurityCheck(_0x59ca30,_0x24b6c7);}catch(_0x2645a0){_0x59ca30[_0x54df17(0x182)][_0x54df17(0x23c)]('[RECORDER]\x20Error\x20saving\x20sequence:\x20'+_0x2645a0[_0x54df17(0x1aa)]);}}function runSecurityCheck(_0x11d075,_0x36962a){const _0x1f27e3=a0_0x47a950;if(!_0x11d075[_0x1f27e3(0x156)])return;_0x11d075['log']['debug'](_0x1f27e3(0x109)),sendToPython(_0x11d075,_0x1f27e3(0x179),{'sequence':_0x36962a});}async function processSensorEvent(_0xae7274,_0x1b3b3a,_0x1232d3,_0x290e8c){const _0x397b3c=a0_0x47a950;if(!_0x290e8c)return;const _0x21e508=_0x1232d3[_0x397b3c(0x260)],_0x50c66a=Date[_0x397b3c(0x1d7)](),_0x471f3a=_0xae7274[_0x397b3c(0x22c)][_0x1b3b3a];_0xae7274[_0x397b3c(0x22c)][_0x1b3b3a]=_0x21e508;if(!_0x290e8c[_0x397b3c(0x275)]&&_0x471f3a!=undefined&&_0x471f3a==_0x21e508)return;const _0x46eedd=(_0x290e8c[_0x397b3c(0x23b)]||'')['toLowerCase'](),_0x364f23=_0x46eedd[_0x397b3c(0x197)](_0x397b3c(0x1b8))||_0x46eedd[_0x397b3c(0x197)](_0x397b3c(0x104))||_0x46eedd[_0x397b3c(0x197)](_0x397b3c(0x1f7))||_0x46eedd[_0x397b3c(0x197)](_0x397b3c(0x15a));_0xae7274[_0x397b3c(0x156)]&&_0x364f23&&recordThermodynamics(_0xae7274,_0x1b3b3a,_0x21e508,_0x290e8c[_0x397b3c(0x1e8)]);const _0x387e6e={'timestamp':_0x50c66a,'id':_0x1b3b3a,'name':_0x290e8c[_0x397b3c(0x255)],'type':_0x290e8c[_0x397b3c(0x23b)],'location':_0x290e8c['location'],'value':_0x21e508};_0xae7274[_0x397b3c(0x120)][_0x397b3c(0x295)](_0x387e6e);if(_0xae7274[_0x397b3c(0x120)][_0x397b3c(0x193)]>HISTORY_MAX_SIZE)_0xae7274['eventHistory'][_0x397b3c(0x1a1)]();await _0xae7274[_0x397b3c(0xfa)](_0x397b3c(0x211),{'val':JSON[_0x397b3c(0x1da)](_0x387e6e),'ack':!![]}),await _0xae7274[_0x397b3c(0xfa)](_0x397b3c(0x22b),{'val':JSON['stringify'](_0xae7274['eventHistory']),'ack':!![]});_0xae7274[_0x397b3c(0x156)]&&(_0xae7274[_0x397b3c(0x18a)][_0x397b3c(0x1c0)](_0x387e6e),await saveRawEventLog(_0xae7274),recordSequence(_0xae7274,_0x387e6e));if(_0x290e8c[_0x397b3c(0x21f)]&&_0x21e508===!![]){if(_0xae7274[_0x397b3c(0x239)]&&!_0xae7274[_0x397b3c(0x25d)])startExitTimer(_0xae7274);else{if(!_0xae7274[_0x397b3c(0x239)])setPresence(_0xae7274,!![]);}}else{if(_0x290e8c['type']===_0x397b3c(0x129)&&_0x21e508===!![]){if(_0xae7274['exitTimer'])abortExitTimer(_0xae7274);if(!_0xae7274[_0x397b3c(0x239)]&&_0xae7274[_0x397b3c(0x101)]===SYSTEM_MODES[_0x397b3c(0x1cb)])setPresence(_0xae7274,!![]);}}}function installPythonDependencies(_0x4a88ae){const _0x93f1c8=a0_0x47a950;if(_0x4a88ae[_0x93f1c8(0x1d1)]||panicMode)return;_0x4a88ae[_0x93f1c8(0x1d1)]=!![];const _0x4607e0=path[_0x93f1c8(0x190)](__dirname,_0x93f1c8(0x1a2),_0x93f1c8(0x130));_0x4a88ae[_0x93f1c8(0x182)][_0x93f1c8(0x1e5)](_0x93f1c8(0x184)),stopPythonService(_0x4a88ae);const _0x5a3627=_0x93f1c8(0x1c5)+VENV_PATH+'\x22';exec(_0x5a3627,_0x1da739=>{const _0x59aa27=_0x93f1c8;if(_0x1da739)_0x4a88ae[_0x59aa27(0x182)][_0x59aa27(0x1a8)](_0x59aa27(0x298));exec(_0x59aa27(0x158)+VENV_PATH+'\x22',_0x4c028b=>{const _0x5d8066=_0x59aa27;if(_0x4c028b){_0x4a88ae['log'][_0x5d8066(0x23c)](_0x5d8066(0x20f)),_0x4a88ae[_0x5d8066(0x1d1)]=![],panicMode=!![];return;}installRequirementsInVenv(_0x4a88ae,_0x4607e0);});});}function installRequirementsInVenv(_0x254473,_0x5a408e){const _0x55fd4f=a0_0x47a950;_0x254473[_0x55fd4f(0x182)][_0x55fd4f(0x1e5)]('Installing\x20pip\x20packages...');const _0x5e5688='\x22'+PIP_EXE+_0x55fd4f(0x149)+_0x5a408e+'\x22';exec(_0x5e5688,{'timeout':0x124f80},(_0x2aad26,_0xb4433,_0x3cf5af)=>{const _0xa52910=_0x55fd4f;_0x254473[_0xa52910(0x1d1)]=![],_0x2aad26?(_0x254473['log'][_0xa52910(0x23c)](_0xa52910(0x1c7)),_0x254473[_0xa52910(0x182)]['error'](_0x3cf5af),panicMode=!![]):(_0x254473['log'][_0xa52910(0x1e5)](_0xa52910(0x18d)),exec('\x22'+PYTHON_EXE+'\x22\x20-c\x20\x22import\x20tensorflow;\x20print(\x27OK\x27)\x22',(_0x45051f,_0x29b408)=>{const _0x4f59dc=_0xa52910;_0x29b408&&_0x29b408[_0x4f59dc(0x197)]('OK')?(_0x254473[_0x4f59dc(0x182)]['info'](_0x4f59dc(0x222)),startPythonService(_0x254473)):(_0x254473[_0x4f59dc(0x182)][_0x4f59dc(0x23c)](_0x4f59dc(0x100)),panicMode=!![]);}));});}function startPythonService(_0x10b943){const _0x543ea6=a0_0x47a950;if(_0x10b943[_0x543ea6(0x1d1)]||panicMode)return;let _0x4d5d60=_0x543ea6(0x274);if(fs['existsSync'](PYTHON_EXE))_0x10b943['log'][_0x543ea6(0x1e5)]('ðŸ\x20Using\x20VENV:\x20'+PYTHON_EXE),_0x4d5d60=PYTHON_EXE;else{_0x10b943['log'][_0x543ea6(0x1a8)](_0x543ea6(0x218)),installPythonDependencies(_0x10b943);return;}try{const _0x3bb680=path[_0x543ea6(0x190)](__dirname,'python_service',_0x543ea6(0x163));_0x10b943['pythonProcess']=spawn(_0x4d5d60,[_0x3bb680]),_0x10b943[_0x543ea6(0x258)][_0x543ea6(0x19d)]['on'](_0x543ea6(0x253),_0x2e0e2b=>{const _0x3ed277=_0x543ea6,_0x1ba218=_0x2e0e2b[_0x3ed277(0x1ee)]()[_0x3ed277(0x132)]('\x0a');_0x1ba218[_0x3ed277(0x1d6)](_0x30b110=>{const _0x54dd70=_0x3ed277,_0x45b3d5=_0x30b110['trim']();if(!_0x45b3d5)return;if(_0x45b3d5[_0x54dd70(0x1e2)](_0x54dd70(0x26e)))_0x10b943[_0x54dd70(0x182)][_0x54dd70(0x138)]('[PYTHON]\x20'+_0x45b3d5['substring'](0x5)['trim']());else{if(_0x45b3d5[_0x54dd70(0x1e2)](_0x54dd70(0x171)))try{const _0x40148e=JSON[_0x54dd70(0x257)](_0x45b3d5['substring'](0x8)[_0x54dd70(0x145)]());handlePythonResult(_0x10b943,_0x40148e);}catch(_0x5c2212){_0x10b943[_0x54dd70(0x182)][_0x54dd70(0x1a8)](_0x54dd70(0x19f)+_0x45b3d5);}}_0x45b3d5['includes']('No\x20module\x20named')&&(_0x10b943['log']['error'](_0x54dd70(0x124)+_0x45b3d5+_0x54dd70(0x10d)),installPythonDependencies(_0x10b943));});}),_0x10b943['pythonProcess']['stderr']['on'](_0x543ea6(0x253),_0x290830=>{const _0x3edf02=_0x543ea6,_0x5228e5=_0x290830[_0x3edf02(0x1ee)]()[_0x3edf02(0x145)]();if(!_0x5228e5[_0x3edf02(0x197)](_0x3edf02(0x225)))_0x10b943[_0x3edf02(0x182)][_0x3edf02(0x23c)](_0x3edf02(0x17f)+_0x5228e5);}),_0x10b943[_0x543ea6(0x258)]['on'](_0x543ea6(0x170),_0x4d6f69=>{const _0x33f068=_0x543ea6;_0x10b943['log'][_0x33f068(0x1e5)]('[PYTHON]\x20Exited\x20'+_0x4d6f69),_0x10b943[_0x33f068(0x258)]=null,_0x4d6f69!==0x0&&_0x4d6f69!==null&&(_0x10b943[_0x33f068(0x182)][_0x33f068(0x1a8)]('Python\x20crashed.\x20Waiting\x2030s\x20before\x20restart...'),setTimeout(()=>startPythonService(_0x10b943),0x7530));});}catch(_0x1b6fd8){_0x10b943[_0x543ea6(0x182)][_0x543ea6(0x23c)]('Error\x20launching\x20Python:\x20'+_0x1b6fd8['message']);}}function stopPythonService(_0x514fe7){const _0x4a4477=a0_0x47a950;if(_0x514fe7[_0x4a4477(0x258)]){_0x514fe7[_0x4a4477(0x182)][_0x4a4477(0x1e5)]('ðŸ\x20Stopping\x20Python...');try{_0x514fe7['pythonProcess'][_0x4a4477(0x159)]();}catch(_0x4b000f){}_0x514fe7[_0x4a4477(0x258)]=null;}}function handlePythonResult(_0x29b655,_0x11bdca){const _0x203d99=a0_0x47a950;if(_0x11bdca[_0x203d99(0x23b)]===_0x203d99(0x11c))_0x29b655[_0x203d99(0x182)][_0x203d99(0x138)](_0x203d99(0x1ad));else{if(_0x11bdca[_0x203d99(0x23b)]===_0x203d99(0x13d)){const {anomaly_score:_0x810e6d,is_anomaly:_0x4e6d87,threshold:_0x725c5e}=_0x11bdca['payload'];_0x29b655[_0x203d99(0x182)][_0x203d99(0x1e5)]('ðŸ›¡ï¸\x20SECURITY\x20CHECK:\x20Score\x20'+_0x810e6d[_0x203d99(0x12e)](0x5)+_0x203d99(0x14d)+(_0x4e6d87?_0x203d99(0x272):'OK')),_0x29b655[_0x203d99(0xfa)]('analysis.security.lastScore',{'val':_0x810e6d,'ack':!![]}),_0x29b655['setStateAsync'](_0x203d99(0x213),{'val':new Date()[_0x203d99(0x276)](),'ack':!![]});if(_0x4e6d87){const _0x34e7bd=_0x203d99(0x1a5)+_0x810e6d['toFixed'](0x4)+')';_0x29b655[_0x203d99(0xfa)](_0x203d99(0x21b),{'val':!![],'ack':!![]}),_0x29b655[_0x203d99(0xfa)](_0x203d99(0x1f5),{'val':_0x34e7bd,'ack':!![]}),sendNotification(_0x29b655,'âš ï¸\x20SECURITY\x20ALARM:\x20'+_0x34e7bd,![],!![]);}}else{if(_0x11bdca[_0x203d99(0x23b)]===_0x203d99(0x1c1)){const {success:_0x54c3f2,details:_0x598b55}=_0x11bdca['payload'];_0x29b655[_0x203d99(0xfa)](_0x203d99(0x13b),{'val':_0x54c3f2?_0x203d99(0x227)+new Date()[_0x203d99(0x125)]()+'\x20('+_0x598b55+')':_0x203d99(0x181)+_0x598b55,'ack':!![]});}else{if(_0x11bdca['type']==='ENERGY_TRAIN_RESULT'){const {success:_0x5666a8,details:_0x1eb72a}=_0x11bdca[_0x203d99(0x246)];if(_0x5666a8)try{const _0x3a845c=JSON[_0x203d99(0x257)](_0x1eb72a);if(_0x3a845c['insulation'])_0x29b655[_0x203d99(0xfa)]('analysis.energy.insulationScore',{'val':JSON[_0x203d99(0x1da)](_0x3a845c[_0x203d99(0x237)]),'ack':!![]});if(_0x3a845c[_0x203d99(0x1b2)])_0x29b655[_0x203d99(0xfa)](_0x203d99(0x176),{'val':JSON['stringify'](_0x3a845c[_0x203d99(0x1b2)]),'ack':!![]});}catch(_0x4d7415){}}else{if(_0x11bdca[_0x203d99(0x23b)]==='HEALTH_TRAIN_RESULT'){const {success:_0x15f47d,details:_0x58b8ac}=_0x11bdca[_0x203d99(0x246)];if(_0x15f47d)_0x29b655[_0x203d99(0x182)][_0x203d99(0x1e5)](_0x203d99(0xff)+_0x58b8ac);}else{if(_0x11bdca[_0x203d99(0x23b)]==='HEALTH_RESULT'){const {is_anomaly:_0x5863ee,details:_0x4229d5}=_0x11bdca[_0x203d99(0x246)];_0x29b655[_0x203d99(0xfa)](_0x203d99(0x1e6),{'val':new Date()[_0x203d99(0x276)](),'ack':!![]}),_0x29b655[_0x203d99(0xfa)]('analysis.health.isAnomaly',{'val':_0x5863ee,'ack':!![]});}else{if(_0x11bdca[_0x203d99(0x23b)]==='TREND_RESULT'){const {diagnosis:_0xd363b3,change_percent:_0x8ad4ae}=_0x11bdca[_0x203d99(0x246)];_0x29b655['log']['info'](_0x203d99(0x1eb)+_0xd363b3+'\x20('+_0x8ad4ae+'%)'),_0x29b655[_0x203d99(0xfa)](_0x203d99(0x1be),{'val':_0xd363b3,'ack':!![]}),_0x29b655['setStateAsync'](_0x203d99(0x267),{'val':_0x8ad4ae,'ack':!![]});}}}}}}}}function sendToPython(_0x104d03,_0x1b995d,_0x1e5ec1={}){const _0x439e98=a0_0x47a950;if(!_0x104d03[_0x439e98(0x258)]||!_0x104d03[_0x439e98(0x258)][_0x439e98(0x244)][_0x439e98(0x1dd)])return;const _0xe7ea4c=JSON[_0x439e98(0x1da)]({'command':_0x1b995d,..._0x1e5ec1});try{_0x104d03['pythonProcess'][_0x439e98(0x244)][_0x439e98(0x1cd)](_0xe7ea4c+'\x0a');}catch(_0x559fac){}}async function initSensorSubscriptions(_0x2bab86){const _0x3d0950=a0_0x47a950,_0x1f232e=_0x2bab86[_0x3d0950(0x1ab)][_0x3d0950(0x28d)];if(_0x1f232e)for(const _0x1baa82 of _0x1f232e){await _0x2bab86['subscribeForeignStatesAsync'](_0x1baa82['id']);}}async function initPresenceSubscriptions(_0x5cf0a1){const _0x580908=a0_0x47a950,_0x5a74a5=_0x5cf0a1['config'][_0x580908(0x16e)];if(_0x5a74a5)for(const _0x20f8c1 of _0x5a74a5){await _0x5cf0a1['subscribeForeignStatesAsync'](_0x20f8c1);}}async function setupTelegramListener(_0x574478){const _0x360d91=a0_0x47a950,_0x24bf85=_0x574478[_0x360d91(0x1ab)][_0x360d91(0x1af)];if(_0x574478[_0x360d91(0x1ab)][_0x360d91(0x154)]&&_0x24bf85)await _0x574478[_0x360d91(0x19b)](_0x24bf85+_0x360d91(0x263));}async function checkWifiPresence(_0xfaf499){const _0x4cf639=a0_0x47a950;try{const _0x1e7e59=_0xfaf499[_0x4cf639(0x1ab)]['presenceDevices']||[];let _0xd1268e=![];const _0x453e71=[];for(const _0x50f5ba of _0x1e7e59){try{const _0x49cf4f=await _0xfaf499[_0x4cf639(0xfe)](_0x50f5ba);_0x49cf4f&&(_0x49cf4f[_0x4cf639(0x260)]===!![]||_0x49cf4f[_0x4cf639(0x260)]===_0x4cf639(0x128)||_0x49cf4f[_0x4cf639(0x260)]===0x1)&&(_0xd1268e=!![],_0x453e71[_0x4cf639(0x1c0)](_0x50f5ba));}catch(_0x4b25cb){}}return await _0xfaf499[_0x4cf639(0xfa)]('system.presenceWho',{'val':_0x453e71['join'](',\x20'),'ack':!![]}),_0xd1268e&&(_0xfaf499[_0x4cf639(0x287)]&&(_0xfaf499[_0x4cf639(0x182)][_0x4cf639(0x1e5)]('WiFi\x20Presence\x20detected.'),abortExitTimer(_0xfaf499)),!_0xfaf499['isPresent']&&_0xfaf499['currentSystemMode']===SYSTEM_MODES[_0x4cf639(0x1cb)]&&await setPresence(_0xfaf499,!![])),_0xd1268e;}catch(_0x153717){return![];}}function startExitTimer(_0x222a41){const _0x2fb8d1=a0_0x47a950;abortExitTimer(_0x222a41),_0x222a41[_0x2fb8d1(0x25d)]=!![],_0x222a41[_0x2fb8d1(0x139)]=setTimeout(()=>{const _0x5b9606=_0x2fb8d1;_0x222a41[_0x5b9606(0x25d)]=![];},EXIT_GRACE_PERIOD_SECONDS*0x3e8),_0x222a41[_0x2fb8d1(0x287)]=setTimeout(()=>{setPresence(_0x222a41,![]),_0x222a41['exitTimer']=null;},EXIT_TIMER_MINUTES*0x3c*0x3e8);}function abortExitTimer(_0x311d6f){const _0x29b68e=a0_0x47a950;if(_0x311d6f[_0x29b68e(0x287)])clearTimeout(_0x311d6f['exitTimer']);if(_0x311d6f['exitGraceTimer'])clearTimeout(_0x311d6f[_0x29b68e(0x139)]);_0x311d6f[_0x29b68e(0x287)]=null,_0x311d6f[_0x29b68e(0x139)]=null,_0x311d6f[_0x29b68e(0x25d)]=![];}async function setPresence(_0x3020bb,_0x46c998){const _0x390dca=a0_0x47a950;if(_0x3020bb[_0x390dca(0x239)]===_0x46c998)return;_0x3020bb[_0x390dca(0x239)]=_0x46c998,await _0x3020bb[_0x390dca(0xfa)](_0x390dca(0x11a),{'val':_0x46c998,'ack':!![]});}async function executeAutomationAction(_0x38cdf8){const _0x1bb4c1=a0_0x47a950;try{const _0x45e984=await _0x38cdf8['getStateAsync'](_0x1bb4c1(0x241)),_0x536f3e=await _0x38cdf8['getStateAsync']('analysis.automation.targetValue');if(_0x45e984&&_0x45e984[_0x1bb4c1(0x260)]&&_0x536f3e){const _0x10e56f=_0x45e984[_0x1bb4c1(0x260)];let _0x1b813c=_0x536f3e[_0x1bb4c1(0x260)];try{_0x1b813c=JSON[_0x1bb4c1(0x257)](_0x1b813c);}catch(_0x1a5eab){}_0x38cdf8[_0x1bb4c1(0x182)]['info'](_0x1bb4c1(0x224)+_0x10e56f+_0x1bb4c1(0x19e)+_0x1b813c),await _0x38cdf8[_0x1bb4c1(0x265)](_0x10e56f,_0x1b813c);}else _0x38cdf8[_0x1bb4c1(0x182)][_0x1bb4c1(0x1a8)]('ðŸ¤–\x20BUTLER:\x20No\x20valid\x20target\x20ID\x20or\x20value\x20stored\x20for\x20execution.');}catch(_0x392136){_0x38cdf8[_0x1bb4c1(0x182)][_0x1bb4c1(0x23c)](_0x1bb4c1(0x228)+_0x392136['message']);}}async function handleTelegramResponse(_0x275ba8,_0x4163a5){const _0x3db8ea=a0_0x47a950;let _0x1358ab=_0x4163a5;_0x4163a5[_0x3db8ea(0x1e2)]('[')&&(_0x1358ab=_0x4163a5[_0x3db8ea(0x26c)](_0x4163a5[_0x3db8ea(0x208)](']')+0x1));if(_0x1358ab===_0x3db8ea(0x18b))await _0x275ba8['setStateAsync'](_0x3db8ea(0x21b),{'val':![],'ack':!![]}),await _0x275ba8[_0x3db8ea(0xfa)](_0x3db8ea(0x1f5),{'val':_0x3db8ea(0xf8),'ack':!![]}),_0x275ba8['lastAlertState']=![],sendNotification(_0x275ba8,_0x3db8ea(0x223),![]);else _0x1358ab==='COGNI_REQUEST_CALL'&&sendNotification(_0x275ba8,_0x3db8ea(0x121),![],!![]);}async function sendNotification(_0x5bef98,_0x4df930,_0x2e522b=![],_0x1eb9e6=![]){const _0x38a7b4=a0_0x47a950,_0x52c4a0=_0x5bef98['config'];if(_0x52c4a0['notifyTelegramEnabled']){let _0x24c40c={};(_0x4df930[_0x38a7b4(0x197)](_0x38a7b4(0x1b5))||_0x1eb9e6)&&(_0x24c40c={'reply_markup':{'inline_keyboard':[[{'text':_0x38a7b4(0x233),'callback_data':_0x38a7b4(0x18b)}],[{'text':_0x38a7b4(0x187),'callback_data':_0x38a7b4(0x144)}]]}}),await _0x5bef98[_0x38a7b4(0x189)](_0x52c4a0['notifyTelegramInstance'],_0x38a7b4(0x20c),{'text':_0x4df930,'user':_0x52c4a0['notifyTelegramRecipient'],..._0x24c40c});}if(_0x52c4a0[_0x38a7b4(0x201)]){let _0x208628={'message':_0x4df930,'title':_0x1eb9e6?_0x38a7b4(0x234):_0x38a7b4(0x161),'priority':_0x1eb9e6?0x2:0x1,'device':_0x52c4a0[_0x38a7b4(0x24f)]};_0x1eb9e6&&(_0x208628['retry']=0x1e,_0x208628[_0x38a7b4(0x1c6)]=0xe10,_0x208628[_0x38a7b4(0x247)]=_0x38a7b4(0x266)),await _0x5bef98[_0x38a7b4(0x189)](_0x52c4a0['notifyPushoverInstance'],_0x38a7b4(0x20c),_0x208628);}_0x52c4a0[_0x38a7b4(0x15c)]&&await _0x5bef98['sendToAsync'](_0x52c4a0[_0x38a7b4(0x165)],'send',{'text':_0x4df930,'to':_0x52c4a0[_0x38a7b4(0x28e)]});}async function runAutopilot(_0x505095){const _0x157347=a0_0x47a950,_0x2eec1e=_0x505095[_0x157347(0x1ab)][_0x157347(0x1de)],_0x521be6=_0x505095['eventHistory']['length']>0x0?_0x505095[_0x157347(0x120)][0x0][_0x157347(0x1bd)]:Date[_0x157347(0x1d7)](),_0x27abe6=(Date[_0x157347(0x1d7)]()-_0x521be6)/(0x3e8*0x3c*0x3c);let _0x147e3f='';_0x505095[_0x157347(0x1ab)]['inactivityMonitoringEnabled']&&_0x505095['currentSystemMode']===SYSTEM_MODES[_0x157347(0x1cb)]&&_0x505095[_0x157347(0x239)]&&(_0x27abe6>_0x2eec1e&&(_0x147e3f=_0x157347(0x277)+_0x27abe6[_0x157347(0x12e)](0x1)+'h.')),runGeminiAnalysis(_0x505095,_0x147e3f);}async function runPythonHealthCheck(_0x7948bc){const _0x5d43fe=a0_0x47a950;if(!_0x7948bc[_0x5d43fe(0x219)]||_0x7948bc[_0x5d43fe(0x219)][_0x5d43fe(0x193)]<0x2)return;const _0xa0095c=_0x7948bc[_0x5d43fe(0x219)][_0x5d43fe(0x22e)](_0x1e2504=>{const _0x3dfa59=_0x5d43fe,_0x15637a=(_0x1e2504[_0x3dfa59(0x1a9)]||'')[_0x3dfa59(0x1d8)]();return ACTIVITY_LEVEL_MAP[_0x15637a]||0x32;});sendToPython(_0x7948bc,_0x5d43fe(0x114),{'values':_0xa0095c,'tag':_0x5d43fe(0x1fb)});}class CogniLiving extends utils[a0_0x47a950(0x137)]{constructor(_0x3cbadd){const _0x4e2758=a0_0x47a950;super({..._0x3cbadd,'name':_0x4e2758(0x198)}),this[_0x4e2758(0x120)]=[],this[_0x4e2758(0x205)]=[],this[_0x4e2758(0x18a)]=[],this[_0x4e2758(0x219)]=[],this[_0x4e2758(0x22c)]={},this[_0x4e2758(0x140)]={'latitude':0x0,'longitude':0x0,'city':''},this[_0x4e2758(0x239)]=!![],this['exitTimer']=null,this['exitGraceTimer']=null,this[_0x4e2758(0x25d)]=![],this[_0x4e2758(0x18f)]=null,this[_0x4e2758(0x1e4)]=null,this[_0x4e2758(0x101)]=SYSTEM_MODES[_0x4e2758(0x1cb)],this[_0x4e2758(0x156)]=![],this[_0x4e2758(0x123)]=![],this[_0x4e2758(0x174)]=_0x4e2758(0x22d),this[_0x4e2758(0x1a4)]=null,this['ltmJob']=null,this['modeResetJob']=null,this['driftAnalysisTimer']=null,this[_0x4e2758(0x232)]=null,this[_0x4e2758(0x258)]=null,this[_0x4e2758(0x1d1)]=![],this['on'](_0x4e2758(0x180),this[_0x4e2758(0x22a)][_0x4e2758(0x133)](this)),this['on'](_0x4e2758(0x1bc),this[_0x4e2758(0x294)][_0x4e2758(0x133)](this)),this['on'](_0x4e2758(0x236),this['onUnload']['bind'](this)),this['on'](_0x4e2758(0x1aa),this[_0x4e2758(0x15b)][_0x4e2758(0x133)](this));}async[a0_0x47a950(0x22a)](){const _0x5273d2=a0_0x47a950;this[_0x5273d2(0x182)][_0x5273d2(0x1e5)](_0x5273d2(0x1c3)+this[_0x5273d2(0x1f2)]+_0x5273d2(0x1f0)),await initZombies(this);try{this[_0x5273d2(0x156)]=await checkLicense(this,this[_0x5273d2(0x1ab)][_0x5273d2(0x290)]);}catch(_0x4aa8a8){}if(!this['config'][_0x5273d2(0x1de)]||this[_0x5273d2(0x1ab)][_0x5273d2(0x1de)]<0.1)this[_0x5273d2(0x1ab)][_0x5273d2(0x1de)]=0xc;await initHistory(this),await initSystemConfig(this);if(this[_0x5273d2(0x1ab)][_0x5273d2(0x1a0)])try{this[_0x5273d2(0x18f)]=new GoogleGenerativeAI(this[_0x5273d2(0x1ab)][_0x5273d2(0x1a0)]),this[_0x5273d2(0x1e4)]=this[_0x5273d2(0x18f)]['getGenerativeModel']({'model':GEMINI_MODEL,'generationConfig':{'responseMimeType':'application/json'}}),this[_0x5273d2(0x182)]['info']('Gemini\x20AI\x20initialized.');}catch(_0x2ffb54){this[_0x5273d2(0x182)]['error']('Gemini\x20Init\x20Error:\x20'+_0x2ffb54[_0x5273d2(0x1aa)]);}await createAllObjects(this),await loadSystemMode(this),await loadRawEventLog(this),await loadDailyDigests(this),this['subscribeStates']('analysis.trigger'),this['subscribeStates'](LTM_DP_TRIGGER_DIGEST),this['subscribeStates'](_0x5273d2(0x1ff)),this[_0x5273d2(0x150)](_0x5273d2(0x15f)),this[_0x5273d2(0x150)]('analysis.automation.triggerAction'),this[_0x5273d2(0x150)]('analysis.automation.autoApply'),this['subscribeStates'](_0x5273d2(0x291)),this[_0x5273d2(0x150)](_0x5273d2(0x162)),this[_0x5273d2(0x150)]('analysis.training.triggerEnergy'),await initSensorSubscriptions(this),await initPresenceSubscriptions(this),await setupTelegramListener(this),setTimeout(()=>checkWifiPresence(this),0x1388);if(this[_0x5273d2(0x1a4)])clearInterval(this['analysisTimer']);const _0x4706de=this[_0x5273d2(0x1ab)]['analysisInterval']||0xf;_0x4706de>0x0&&(this[_0x5273d2(0x1a4)]=setInterval(()=>{runAutopilot(this);},_0x4706de*0x3c*0x3e8)),setupLtmScheduler(this),setupModeResetScheduler(this),setupDriftAnalysisScheduler(this),setupBriefingScheduler(this),startPythonService(this),setTimeout(()=>{const _0x1433c4=_0x5273d2;if(this[_0x1433c4(0x258)])runPythonHealthCheck(this);},0x1388);}[a0_0x47a950(0x216)](_0x516f8e){const _0x7e92e9=a0_0x47a950;if(this[_0x7e92e9(0x1a4)])clearInterval(this[_0x7e92e9(0x1a4)]);if(this['driftAnalysisTimer'])clearInterval(this[_0x7e92e9(0x1a3)]);if(this[_0x7e92e9(0x17b)])this['ltmJob'][_0x7e92e9(0x245)]();if(this[_0x7e92e9(0x1ca)])this['modeResetJob']['cancel']();if(this[_0x7e92e9(0x232)])this[_0x7e92e9(0x232)][_0x7e92e9(0x245)]();if(this[_0x7e92e9(0x287)])clearTimeout(this['exitTimer']);if(this[_0x7e92e9(0x139)])clearTimeout(this[_0x7e92e9(0x139)]);stopPythonService(this),_0x516f8e();}async[a0_0x47a950(0x294)](_0x154dea,_0x2b69d0){const _0x4b435f=a0_0x47a950;if(!_0x2b69d0||this[_0x4b435f(0x1d1)])return;if(_0x154dea[_0x4b435f(0x197)](_0x4b435f(0x16b))&&_0x154dea[_0x4b435f(0x11b)](_0x4b435f(0x119))&&_0x2b69d0[_0x4b435f(0x260)]){await handleTelegramResponse(this,_0x2b69d0[_0x4b435f(0x260)]);return;}if(_0x154dea===this[_0x4b435f(0x1e0)]+'.'+SYSTEM_DP_MODE){if(_0x2b69d0[_0x4b435f(0x260)]&&Object[_0x4b435f(0x1b3)](SYSTEM_MODES)['includes'](_0x2b69d0['val'])){this[_0x4b435f(0x101)]=_0x2b69d0['val'];if(_0x2b69d0[_0x4b435f(0x260)]===SYSTEM_MODES[_0x4b435f(0x168)])await setPresence(this,![]);else await setPresence(this,!![]);}if(!_0x2b69d0[_0x4b435f(0x12d)])this['setState'](_0x154dea,{'val':this['currentSystemMode'],'ack':!![]});return;}if(!_0x2b69d0['ack']){_0x154dea[_0x4b435f(0x197)](_0x4b435f(0x1ef))&&_0x2b69d0['val']&&(this[_0x4b435f(0x1f4)](_0x154dea,{'val':![],'ack':!![]}),runGeminiAnalysis(this));if(_0x154dea[_0x4b435f(0x197)](_0x4b435f(0xfc))&&_0x2b69d0[_0x4b435f(0x260)]){this[_0x4b435f(0x1f4)](_0x154dea,{'val':![],'ack':!![]});if(this['isProVersion'])createDailyDigest(this);}_0x154dea[_0x4b435f(0x197)](_0x4b435f(0x24a))&&_0x2b69d0[_0x4b435f(0x260)]&&(this[_0x4b435f(0x1f4)](_0x154dea,{'val':![],'ack':!![]}),sendMorningBriefing(this));_0x154dea[_0x4b435f(0x197)]('automation.triggerAction')&&_0x2b69d0[_0x4b435f(0x260)]&&(this['setState'](_0x154dea,{'val':![],'ack':!![]}),executeAutomationAction(this));if(_0x154dea[_0x4b435f(0x197)](_0x4b435f(0x291))&&_0x2b69d0['val']){this[_0x4b435f(0x1f4)](_0x154dea,{'val':![],'ack':!![]});if(this[_0x4b435f(0x156)])try{const _0x3ec15f=await this[_0x4b435f(0x24d)](_0x4b435f(0x1bb));if(_0x3ec15f&&_0x3ec15f[_0x4b435f(0x260)]){const _0x5e0d83=JSON[_0x4b435f(0x257)](_0x3ec15f['val']);this[_0x4b435f(0x182)]['info']('ðŸ§ \x20Triggering\x20Security\x20Training...'),this['setStateAsync']('analysis.training.status',{'val':_0x4b435f(0x1ec),'ack':!![]}),sendToPython(this,_0x4b435f(0x21a),{'sequences':_0x5e0d83});}}catch(_0x383f59){this[_0x4b435f(0x182)][_0x4b435f(0x23c)](_0x4b435f(0x19a)+_0x383f59[_0x4b435f(0x1aa)]);}}if(_0x154dea[_0x4b435f(0x197)](_0x4b435f(0x162))&&_0x2b69d0[_0x4b435f(0x260)]){this[_0x4b435f(0x1f4)](_0x154dea,{'val':![],'ack':!![]});if(this[_0x4b435f(0x156)])try{const _0x3a09ce=await this[_0x4b435f(0x24d)](LTM_DP_DAILY_DIGESTS);if(_0x3a09ce&&_0x3a09ce[_0x4b435f(0x260)])sendToPython(this,_0x4b435f(0x206),{'digests':JSON[_0x4b435f(0x257)](_0x3a09ce[_0x4b435f(0x260)])});}catch(_0x17fcd1){}}if(_0x154dea[_0x4b435f(0x197)](_0x4b435f(0x26b))&&_0x2b69d0[_0x4b435f(0x260)]){this[_0x4b435f(0x1f4)](_0x154dea,{'val':![],'ack':!![]});if(this['isProVersion'])try{const _0x26c7c3=await this[_0x4b435f(0x24d)](_0x4b435f(0x122));if(_0x26c7c3&&_0x26c7c3[_0x4b435f(0x260)])sendToPython(this,'TRAIN_ENERGY',{'points':JSON[_0x4b435f(0x257)](_0x26c7c3[_0x4b435f(0x260)])});}catch(_0x284107){}}return;}if(this[_0x4b435f(0x1ab)][_0x4b435f(0x16e)]&&this['config'][_0x4b435f(0x16e)]['includes'](_0x154dea)){await checkWifiPresence(this);return;}const _0x5dcf74=(this[_0x4b435f(0x1ab)][_0x4b435f(0x28d)]||[])[_0x4b435f(0x1b7)](_0x1f3927=>_0x1f3927['id']===_0x154dea);if(_0x5dcf74)processSensorEvent(this,_0x154dea,_0x2b69d0,_0x5dcf74);}async['onMessage'](_0xc04b29){const _0x23d1c7=a0_0x47a950;if(typeof _0xc04b29===_0x23d1c7(0x1f1)&&_0xc04b29[_0x23d1c7(0x1aa)]){if(_0xc04b29[_0x23d1c7(0x1db)]==='testApiKey'){const _0x42b518=_0xc04b29[_0x23d1c7(0x1aa)][_0x23d1c7(0x27d)]||this[_0x23d1c7(0x1ab)]['geminiApiKey'];if(!_0x42b518)return this[_0x23d1c7(0x10a)](_0xc04b29[_0x23d1c7(0x102)],_0xc04b29[_0x23d1c7(0x1db)],{'success':![],'message':_0x23d1c7(0x210)},_0xc04b29[_0x23d1c7(0x243)]);try{const _0x23149c=new GoogleGenerativeAI(_0x42b518),_0x479679=_0x23149c['getGenerativeModel']({'model':GEMINI_MODEL}),_0x2602c0=await _0x479679[_0x23d1c7(0x1a7)]('Hi');this['sendTo'](_0xc04b29[_0x23d1c7(0x102)],_0xc04b29[_0x23d1c7(0x1db)],{'success':!![],'message':_0x23d1c7(0x214)+_0x2602c0[_0x23d1c7(0x16f)]['text']()},_0xc04b29[_0x23d1c7(0x243)]);}catch(_0xf699e0){this[_0x23d1c7(0x10a)](_0xc04b29['from'],_0xc04b29['command'],{'success':![],'message':_0x23d1c7(0x110)+_0xf699e0['message']},_0xc04b29[_0x23d1c7(0x243)]);}}else{if(_0xc04b29[_0x23d1c7(0x1db)]==='testContext'){const _0x2bd77e=await getWeatherContext(this),_0x9c2770=await getCalendarContext(this);this[_0x23d1c7(0x10a)](_0xc04b29[_0x23d1c7(0x102)],_0xc04b29[_0x23d1c7(0x1db)],{'success':!![],'weather':_0x2bd77e,'calendar':_0x9c2770},_0xc04b29[_0x23d1c7(0x243)]);}else{if(_0xc04b29['command']===_0x23d1c7(0x141)){if(!this[_0x23d1c7(0x156)])return this[_0x23d1c7(0x10a)](_0xc04b29[_0x23d1c7(0x102)],_0xc04b29['command'],{'success':![],'isPro':![]},_0xc04b29[_0x23d1c7(0x243)]);let _0xda119e={'status':_0x23d1c7(0x215)};try{const _0x55753f=await this['getStateAsync'](LTM_DP_DRIFT_STATUS);_0xda119e['status']=_0x55753f?_0x55753f[_0x23d1c7(0x260)]:_0x23d1c7(0x215);}catch(_0x3ba98b){}this[_0x23d1c7(0x10a)](_0xc04b29[_0x23d1c7(0x102)],_0xc04b29[_0x23d1c7(0x1db)],{'success':!![],'isPro':!![],'dailyDigests':this[_0x23d1c7(0x219)],'driftAnalysis':_0xda119e,'analysisHistory':this[_0x23d1c7(0x205)]},_0xc04b29[_0x23d1c7(0x243)]);}else{if(_0xc04b29[_0x23d1c7(0x1db)]==='getOverviewData'){const _0x171fd1=this[_0x23d1c7(0x219)][_0x23d1c7(0x193)],_0x3fe24a=new Date(),_0x17ce74=new Date(_0x3fe24a[_0x23d1c7(0x177)](),_0x3fe24a[_0x23d1c7(0xfb)](),_0x3fe24a[_0x23d1c7(0x131)]())['getTime'](),_0x4edc2e=this[_0x23d1c7(0x18a)][_0x23d1c7(0x157)](_0x43676d=>new Date(_0x43676d['timestamp'])[_0x23d1c7(0x1e1)]()>_0x17ce74)[_0x23d1c7(0x193)],_0x4c6a50=new Array(0x18)[_0x23d1c7(0x146)](0x0);this[_0x23d1c7(0x18a)][_0x23d1c7(0x1d6)](_0x5b9da4=>{const _0x470d45=_0x23d1c7,_0x2a69ed=new Date(_0x5b9da4[_0x470d45(0x1bd)]);if(_0x2a69ed[_0x470d45(0x1e1)]()>_0x17ce74)_0x4c6a50[_0x2a69ed['getHours']()]++;});let _0x44ebac={'status':_0x23d1c7(0x215)};try{const _0x429645=await this[_0x23d1c7(0x24d)](LTM_DP_DRIFT_STATUS);_0x44ebac[_0x23d1c7(0x28b)]=_0x429645?_0x429645[_0x23d1c7(0x260)]:_0x23d1c7(0x215);}catch(_0x2bb893){}let _0x419265='';try{const _0x189389=await this[_0x23d1c7(0x24d)](_0x23d1c7(0x194));_0x419265=_0x189389?_0x189389[_0x23d1c7(0x260)]:'';}catch(_0x1d68e3){}let _0x410b23=null;!this['geminiModel']&&(_0x410b23=this['config'][_0x23d1c7(0x1a0)]?_0x23d1c7(0x28f):_0x23d1c7(0x117));let _0x54474d={'detected':![],'description':'','targetId':'','targetValue':'','autoApply':![]};try{const _0x3d6a93=await this[_0x23d1c7(0x24d)]('analysis.automation.patternDetected');if(_0x3d6a93&&_0x3d6a93['val']){_0x54474d[_0x23d1c7(0x204)]=!![];const _0x2baf6c=await this[_0x23d1c7(0x24d)](_0x23d1c7(0x297));_0x54474d[_0x23d1c7(0x1bf)]=_0x2baf6c?_0x2baf6c[_0x23d1c7(0x260)]:'';const _0x5a0600=await this[_0x23d1c7(0x24d)](_0x23d1c7(0x241));_0x54474d['targetId']=_0x5a0600?_0x5a0600[_0x23d1c7(0x260)]:'';const _0x557286=await this[_0x23d1c7(0x24d)](_0x23d1c7(0x111));_0x54474d[_0x23d1c7(0x28c)]=_0x557286?_0x557286['val']:'';}const _0x202e5d=await this[_0x23d1c7(0x24d)]('analysis.automation.autoApply');_0x54474d[_0x23d1c7(0x25a)]=_0x202e5d?!!_0x202e5d[_0x23d1c7(0x260)]:![];}catch(_0x1ab197){}this[_0x23d1c7(0x10a)](_0xc04b29['from'],_0xc04b29[_0x23d1c7(0x1db)],{'success':!![],'eventHistory':this['eventHistory']['slice'](0x0,0xf),'stats':{'digestCount':_0x171fd1,'eventCountToday':_0x4edc2e,'hourlyActivity':_0x4c6a50,'driftStatus':_0x44ebac[_0x23d1c7(0x28b)],'isPresent':this[_0x23d1c7(0x239)],'presenceWho':_0x419265,'minDays':this[_0x23d1c7(0x1ab)][_0x23d1c7(0x13f)]||0x7,'stbDays':this[_0x23d1c7(0x1ab)][_0x23d1c7(0x192)]||0xe,'ltbDays':this['config'][_0x23d1c7(0x1f6)]||0x3c,'systemError':_0x410b23},'automation':_0x54474d},_0xc04b29['callback']);}else{if(_0xc04b29[_0x23d1c7(0x1db)]===_0x23d1c7(0x112))try{const _0x49bb3d=await scanForDevices(this,_0xc04b29[_0x23d1c7(0x1aa)]||{});this[_0x23d1c7(0x10a)](_0xc04b29[_0x23d1c7(0x102)],_0xc04b29['command'],{'success':!![],'devices':_0x49bb3d},_0xc04b29[_0x23d1c7(0x243)]);}catch(_0xce1956){this['sendTo'](_0xc04b29[_0x23d1c7(0x102)],_0xc04b29[_0x23d1c7(0x1db)],{'success':![],'error':_0xce1956['message']},_0xc04b29[_0x23d1c7(0x243)]);}else{if(_0xc04b29[_0x23d1c7(0x1db)]===_0x23d1c7(0x16c)){const _0x4d0125=await this[_0x23d1c7(0x251)](_0x23d1c7(0x271),_0x23d1c7(0x13a)),_0x4d47e5=[];if(_0x4d0125)for(const _0x37759a in _0x4d0125){const _0x262d7f=_0x4d0125[_0x37759a],_0x818b8c=(_0x262d7f[_0x23d1c7(0x1ce)]&&typeof _0x262d7f['common'][_0x23d1c7(0x255)]===_0x23d1c7(0x1f1)?_0x262d7f[_0x23d1c7(0x1ce)][_0x23d1c7(0x255)]['de']:_0x262d7f[_0x23d1c7(0x1ce)][_0x23d1c7(0x255)])||_0x262d7f[_0x23d1c7(0x1ce)][_0x23d1c7(0x255)];_0x4d47e5['push']({'id':_0x37759a,'name':_0x818b8c});}this[_0x23d1c7(0x10a)](_0xc04b29['from'],_0xc04b29[_0x23d1c7(0x1db)],{'success':!![],'enums':_0x4d47e5},_0xc04b29[_0x23d1c7(0x243)]);}else{if(_0xc04b29[_0x23d1c7(0x1db)]==='getCalendarNames'){const _0x529a01=_0xc04b29[_0x23d1c7(0x1aa)]['instance'];if(!_0x529a01)return this[_0x23d1c7(0x10a)](_0xc04b29[_0x23d1c7(0x102)],_0xc04b29[_0x23d1c7(0x1db)],{'success':![],'error':_0x23d1c7(0x1d5)},_0xc04b29[_0x23d1c7(0x243)]);const _0x1cfa09=await getCalendarNames(this,_0x529a01);this[_0x23d1c7(0x10a)](_0xc04b29['from'],_0xc04b29['command'],{'success':!![],'names':_0x1cfa09},_0xc04b29[_0x23d1c7(0x243)]);}else{if(_0xc04b29[_0x23d1c7(0x1db)]===_0x23d1c7(0x1c4)){const {targetId:_0x4180b7,targetValue:_0xb23313}=_0xc04b29[_0x23d1c7(0x1aa)];this[_0x23d1c7(0x182)][_0x23d1c7(0x1e5)](_0x23d1c7(0x155)+_0x4180b7+'\x20=\x20'+_0xb23313),await this[_0x23d1c7(0xfa)]('analysis.automation.patternDetected',{'val':!![],'ack':!![]}),await this['setStateAsync'](_0x23d1c7(0x297),{'val':_0x23d1c7(0x221)+_0x4180b7,'ack':!![]}),await this[_0x23d1c7(0xfa)](_0x23d1c7(0x241),{'val':_0x4180b7,'ack':!![]}),await this[_0x23d1c7(0xfa)](_0x23d1c7(0x111),{'val':_0xb23313,'ack':!![]}),this[_0x23d1c7(0x10a)](_0xc04b29[_0x23d1c7(0x102)],_0xc04b29[_0x23d1c7(0x1db)],{'success':!![]},_0xc04b29['callback']);}else{if(_0xc04b29[_0x23d1c7(0x1db)]===_0x23d1c7(0x242)){const {historyId:_0x534d4c,rating:_0x5827d2,comment:_0x115308,alertReason:_0x923f79}=_0xc04b29[_0x23d1c7(0x1aa)];_0x534d4c&&_0x5827d2?(await saveFeedback(this,{'timestamp':Date[_0x23d1c7(0x1d7)](),'historyId':_0x534d4c,'rating':_0x5827d2,'comment':_0x115308,'alertReason':_0x923f79}),this['sendTo'](_0xc04b29[_0x23d1c7(0x102)],_0xc04b29['command'],{'success':!![]},_0xc04b29[_0x23d1c7(0x243)])):this[_0x23d1c7(0x10a)](_0xc04b29[_0x23d1c7(0x102)],_0xc04b29['command'],{'success':![],'error':_0x23d1c7(0x220)},_0xc04b29[_0x23d1c7(0x243)]);}else _0xc04b29['command']==='dismissAutomation'&&(this[_0x23d1c7(0x182)]['info'](_0x23d1c7(0x183)),await this[_0x23d1c7(0xfa)](_0x23d1c7(0x16a),{'val':![],'ack':!![]}),await this['setStateAsync'](_0x23d1c7(0x297),{'val':'','ack':!![]}),this[_0x23d1c7(0x10a)](_0xc04b29[_0x23d1c7(0x102)],_0xc04b29[_0x23d1c7(0x1db)],{'success':!![]},_0xc04b29['callback']));}}}}}}}}}}}if(require[a0_0x47a950(0x169)]!==module)module['exports']=_0x2c1678=>new CogniLiving(_0x2c1678);else new CogniLiving();