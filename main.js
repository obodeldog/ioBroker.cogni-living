const a0_0x34930b=a0_0x5b09;function a0_0x57f5(){const _0x1e7417=['Target\x20Value','ltmStbWindowDays','cogni-living','channel','driftAnalysisTimer','LTM.driftAnalysis','GUEST','boolean','triggerDailyDigest','shutter','extendObjectAsync','history.','test',')\x20-\x20OBFUSCATION\x20SAFE\x20MODE','.Summary.Current','Feedback\x20saved:\x20','ltmJob','analysis.activitySummary','sendToAsync','info','apiKey','2-digit','actual_temperature','notifyTelegramInstance','firmware','Normal','\x20min).','isEmergency','cancel','endsWith','622116QGEqKF','system.mode','system','node-schedule','Briefing\x20Sched\x20Error:\x20','1275592nThIVG','Urlaub','NORMAL','toISOString','Party','length','unknown','analysis.automation.autoApply','scheduleJob','now','getForeignStateAsync','callback','1059330jOeHUv','.\x20PRÃ„SENZ:\x20','unload','Deaktiviert\x20(Pro-Feature)','PARTY','18pIiYMP','getLtmData','ROLLE:\x20Data\x20Scientist.\x20ZIEL:\x20Drift\x20erkennen.\x20SCHEMA:\x20{\x20\x22baselineDrift\x22:\x20\x22none|slight|significant|critical\x22,\x20\x22driftDetails\x22:\x20\x22string\x22\x20}\x0a\x0aLTB:\x20','dutycycle','getStateAsync','config_pending','system.isPresent','ðŸ¤–\x20AUTO-APPLY:\x20Executing\x20','Drift\x20Details','LTM.driftAnalysis.lastCheck','PRIORITÃ„T:\x20Gesundheit\x20und\x20Sicherheit\x20fÃ¼r\x20Senioren\x20(AAL).\x20Erkenne\x20InaktivitÃ¤t,\x20potenzielle\x20StÃ¼rze\x20(indirekt),\x20Schlafunterbrechungen\x20und\x20nÃ¤chtliche\x20Unruhe.','Reset\x20Sched\x20Error:\x20','isProVersion','isGracePeriodActive','Action','âš ï¸\x20Alarm','set_temperature','latitude','subscribeStates','Restlessness\x20Level','KALENDER:\x20Keine\x20relevanten\x20Termine','VACATION','text','status','âœ…\x20User\x20confirmed\x20ALARM\x20via\x20Telegram.\x20Resetting\x20system.','state','setState','switch','livingContext','COGNI_CONFIRM_OK','Processing\x20Status','@google/generative-ai','briefingTime','LTM.processingStatus','search','split','ðŸ“ž\x20User\x20requested\x20CALL\x20via\x20Telegram!','analysis.automation.suggestedAction','Wetter:\x20Deaktiviert','notifyPushoverEnabled','.\x20KONTEXT:\x20','Event\x20History','temperature','ðŸŒ…\x20Daily\x20Briefing:\x0a','inactivityThresholdHours','Last\x20Result','isArray','long','isAlert','position','targetId','indicator','includes','analysisInterval','log','onReady','alertReason','analysis.isAlert','power','working','analysis.health.sleepScore','toLocaleString','CRITICAL\x20SAFETY\x20CHECK:\x201.\x20Sofort/Ad-Hoc:\x20Ist\x20es\x20jetzt\x20(','events.history','N/A','catch','values','vacation','geminiModel','Skipped\x20(No\x20AI\x20or\x20Data)','baselineDrift','isExit','useCalendar','Gemini\x20AI\x20initialized.','flot.','activity','Vom\x20Benutzer\x20bestÃ¤tigt\x20(OK).','echarts.','analysis.automation.description','indicator.alarm.fire','scanDevices','response','Kalender:\x20Deaktiviert','presenceDevices','message','Missing\x20data','string','replace','from','details','link_quality','licenseKey','LTM','version','time','value.health','eventHistory','setStateAsync','Feedback\x20Log','send','telegram','LTM.triggerDailyDigest','analysis.alertReason','Last\x20raw\x20event','map','.\x20ZUSATZ:\x20','uuid-error','location','BUTLER\x20Execution\x20Error:\x20','unshift','Alert\x20Reason','calendarInstance','Kein\x20API\x20Key!','.\x20PERSONA:\x20','ðŸ¤–\x20BUTLER:\x20No\x20valid\x20target\x20ID\x20or\x20value\x20stored\x20for\x20execution.','sensorLastValues','models/gemini-flash-latest','analysis.automation.targetValue','parse','.forecast.current.state','getForeignObjectAsync','material.','Drift\x20Status','ROLLE:\x20FÃ¼rsorglicher\x20Assistent.\x20AUFGABE:\x20Schreibe\x20eine\x20kurze,\x20beruhigende\x20\x22Guten\x20Morgen\x22-Nachricht.\x20PERSONA:\x20','fault','\x20=\x20','Generating\x20Morning\x20Briefing...','button','minDaysForBaseline','Health\x20&\x20Sleep\x20Analysis','No\x20recorded\x20events\x20yet.','Success','notifyEmailEnabled','openweathermap.0','Sleep\x20Score\x20(0-100)','TEST-PRO-KEY','type','aiPersona','AI\x20Alert\x20Status','summary','analysis.analysisHistory','off','activityLevel','Trigger\x20Action\x20Now','KALENDER:\x20Keine\x20Daten','Logbook','Phase\x202:\x20ACUTE\x20MONITORING.\x20STB\x20(Last\x2014d):\x20','\x20Tage)','/100,\x20AktivitÃ¤t\x20seit\x2004:00:\x20','json','setpoint','name','enum','triggerBriefing','ical.0','valve','setHours','Error\x20reading\x20calendar\x20table:\x20','analysis.history_debug_00','command','onUnload','uuid-not-found','generateContent','unreach','currentSystemMode','geminiApiKey','city','logDuplicates','value','onStateChange','WETTER\x20ERROR:\x20','cogni-living\x20adapter\x20starting\x20(v','config','\x20sensors...','Lernphase\x20(','getCalendarNames\x20Error:\x20','\x20Phase\x203:\x20DRIFT\x20ACTIVE.','analysisTimer','stateChange','direction','common','\x20for\x20interactive\x20buttons...','blind','automation.triggerAction','notifyEmailInstance','13336424pZcnNA','Comfort\x20Suggestion','online','analysisHistory','analysis.trigger','rawEventLog','native','genAI','simulateButler','LTM.driftAnalysis.driftDetails','filter','communicate.request','cover','ðŸ§ª\x20Simulating\x20Butler\x20Proposal:\x20','9307746SGIBOC','simple-api.','admin.','analysis.triggerBriefing','accuweather.0','Error:\x20','pop','Error\x20in\x20onMessage\x20command\x20','LTM.baselineStatus','ðŸ“ž\x20RÃ¼ckruf\x20anfordern','events.lastEvent','@iobroker/adapter-core','number','Starting\x20Autopilot\x20(','execution','exitGraceTimer','analysis.deviationFromBaseline','briefingJob','5453610SpTGNS','feedbackHistory','analysis.comfortSummary','motion','Cogni-Living','detected','Trigger\x20Analysis','isPresent','ack','useWeather','apply','daswetter','getEnums','Health\x20Notes','\x0aSTB:\x20','subscribeForeignStatesAsync','dailyDigests','patternDetected','analysis.automation.patternDetected','system.','KALENDER:\x20','Aktiv\x20(','WETTER:\x20','error','object','targetValue','ðŸ“¡\x20Hooking\x20into\x20','reachable','Drift\x20Sched\x20Error:\x20','timestamp','_calName','âœ…\x20Alles\x20OK\x20(Reset)','getObjectAsync','Raw\x20Log','Drift\x20Analysis','uuid','getCalendarNames','level','sort','siren','PRO-','WETTER:\x20Keine\x20Daten\x20gefunden','find','namespace','modeResetJob','HARD\x20WATCHDOG:\x20No\x20sensor\x20activity\x20detected\x20for\x20','systemUUID','sleepScore','WiFi\x20Presence\x20detected\x20->\x20Aborting\x20Exit\x20Timer.\x20User\x20is\x20present.','weatherInstance',')\x20verdÃ¤chtig\x20still?\x202.\x20Akut\x20(vs.\x20STB):\x20Weicht\x20das\x20heutige\x20Verhalten\x20stark\x20von\x20den\x20letzten\x2014\x20Tagen\x20ab?\x20Ignoriere\x20Fehlalarme\x20durch\x20Kontext:\x20','notifyTelegramRecipient','6452DsfarP','analysis.health.notes','analysis.automation.triggerAction','accuweather','sound','.NextHours.Location_1.Day_1.current.symbol_desc','PRIORITÃ„T:\x20Sicherheit.\x20Erkenne\x20Eindringlinge,\x20ungewÃ¶hnliche\x20Anwesenheit.','update','System\x20Mode','setForeignStateAsync','Trigger\x20Briefing\x20(Test)','toString','getGenerativeModel','Phase\x201:\x20Learning\x20(No\x20Baseline).\x20Rely\x20on\x20common\x20sense.','health','Success:\x20Compressed\x20','getOverviewData','AUTOMATION\x20RULES\x20(THE\x20BUTLER):\x20-\x20Only\x20propose\x20automation\x20if\x20you\x20see\x20a\x20STABLE,\x20REPETITIVE\x20pattern.\x20-\x20IGNORE\x20one-time\x20events.\x20-\x20\x22targetId\x22\x20MUST\x20be\x20a\x20valid\x20sensor\x20ID.','notifyPushoverInstance','(((.+)+)+)+$','setObjectNotExistsAsync','ROLLE:\x20Smart\x20Home\x20Analyst.\x20SPRACHE:\x20DE.\x20FORMAT:\x20JSON.\x20AKTUELLE\x20ZEIT:\x20','Subscribing\x20to\x20','delObjectAsync','Error\x20checking\x20WiFi:\x20','Deviation','event','slice','val','Baseline\x20Status','stringify','systemConfig','description','inactivityMonitoringEnabled','Description','enum.functions.*','Pattern\x20Detected','LTM.dailyDigests','bind','splice','party','getForeignObjectsAsync','sendTo','Fokus\x20auf\x20Familienroutinen,\x20Kindersicherheit\x20und\x20allgemeines\x20Haushaltsmanagement.','notifyPushoverRecipient','events.history_debug_00','COGNI_REQUEST_CALL','Nein','push','Morning\x20Briefing\x20sent.','rssi','trim','analysis.lastResult','warn','comfort','741lPdDUQ','LTM.driftAnalysis.baselineDrift','text.alarm','generic','Scheduling\x20Morning\x20Briefing\x20for\x20','startsWith','AI\x20Emergency\x20Status','openweathermap','notifyTelegramEnabled','notifyEmailRecipient','analysis.automation.targetId','Triggered\x20analysis\x20but\x20Gemini\x20AI\x20is\x20not\x20initialized!\x20Check\x20API\x20Key.','Comfort\x20Summary','devices','Gast','daswetter.0','lastAlertState','analysis.health','date','analysis.health.restlessness','onMessage','targetposition','connection','calendarSelection','exitTimer','Analysiere\x20ausgewogen\x20auf\x20Gesundheit,\x20Sicherheit\x20und\x20Komfort.','brightness'];a0_0x57f5=function(){return _0x1e7417;};return a0_0x57f5();}(function(_0x56cb69,_0x10ff4b){const _0x4363b8=a0_0x5b09,_0x530b4c=_0x56cb69();while(!![]){try{const _0xfd756b=parseInt(_0x4363b8(0x216))/0x1+parseInt(_0x4363b8(0x195))/0x2*(-parseInt(_0x4363b8(0x1cc))/0x3)+-parseInt(_0x4363b8(0x20a))/0x4+-parseInt(_0x4363b8(0x2f4))/0x5+-parseInt(_0x4363b8(0x205))/0x6+-parseInt(_0x4363b8(0x2e2))/0x7+parseInt(_0x4363b8(0x2d4))/0x8*(parseInt(_0x4363b8(0x21b))/0x9);if(_0xfd756b===_0x10ff4b)break;else _0x530b4c['push'](_0x530b4c['shift']());}catch(_0x3bb805){_0x530b4c['push'](_0x530b4c['shift']());}}}(a0_0x57f5,0xb7fde));const a0_0x134a5b=(function(){let _0x3ab1eb=!![];return function(_0x4faa51,_0x17a056){const _0x2ebdae=_0x3ab1eb?function(){const _0x2a3821=a0_0x5b09;if(_0x17a056){const _0x8c5dec=_0x17a056[_0x2a3821(0x16b)](_0x4faa51,arguments);return _0x17a056=null,_0x8c5dec;}}:function(){};return _0x3ab1eb=![],_0x2ebdae;};}()),a0_0x13e093=a0_0x134a5b(this,function(){const _0x197570=a0_0x5b09;return a0_0x13e093[_0x197570(0x1a0)]()['search']('(((.+)+)+)+$')['toString']()['constructor'](a0_0x13e093)[_0x197570(0x23d)](_0x197570(0x1a8));});a0_0x13e093();'use strict';const utils=require(a0_0x34930b(0x2ed)),{GoogleGenerativeAI}=require(a0_0x34930b(0x23a)),schedule=require(a0_0x34930b(0x208)),HISTORY_MAX_SIZE=0x32,RAW_LOG_MAX_SIZE=0x5dc,LTM_MIN_EVENTS_FOR_COMPRESSION=0x5,GEMINI_MODEL=a0_0x34930b(0x28f),LTM_SCHEDULE='0\x203\x20*\x20*\x20*',MODE_RESET_SCHEDULE='0\x204\x20*\x20*\x20*',ANALYSIS_HISTORY_MAX_SIZE=0x64,LTM_DP_RAW_LOG='LTM.rawEventLog',LTM_DP_DAILY_DIGESTS=a0_0x34930b(0x1ba),LTM_DP_STATUS=a0_0x34930b(0x23c),LTM_DP_TRIGGER_DIGEST=a0_0x34930b(0x280),LTM_DP_BASELINE_STATUS=a0_0x34930b(0x2ea),LTM_DP_DRIFT_CHANNEL=a0_0x34930b(0x1ec),LTM_DP_DRIFT_STATUS=a0_0x34930b(0x1cd),LTM_DP_DRIFT_DETAILS=a0_0x34930b(0x2dd),LTM_DP_DRIFT_LAST_CHECK=a0_0x34930b(0x224),SYSTEM_DP_MODE='system.mode',HARD_IGNORE_TERMS=['scriptProblem','scriptEnabled',a0_0x34930b(0x19c),a0_0x34930b(0x2be),'lowbat',a0_0x34930b(0x1c7),a0_0x34930b(0x1e2),'maintenance',a0_0x34930b(0x178),a0_0x34930b(0x297),a0_0x34930b(0x256),a0_0x34930b(0x2ce),'stick_unreach',a0_0x34930b(0x220),a0_0x34930b(0x21e),a0_0x34930b(0x1ff),a0_0x34930b(0x17c),a0_0x34930b(0x275)],BAD_NAMES=[a0_0x34930b(0x1e1),'currentposition',a0_0x34930b(0x234),a0_0x34930b(0x186),a0_0x34930b(0x2c3),a0_0x34930b(0x1e6),'on',a0_0x34930b(0x2a8),'switch',a0_0x34930b(0x24c),a0_0x34930b(0x1f0),a0_0x34930b(0x2d1),a0_0x34930b(0x2e0),a0_0x34930b(0x232),a0_0x34930b(0x2f7),'presence','occupancy',a0_0x34930b(0x245),'humidity',a0_0x34930b(0x255),'energy',a0_0x34930b(0x2b1),a0_0x34930b(0x2b6),a0_0x34930b(0x1fd),a0_0x34930b(0x22b)],ADAPTER_BLACKLIST=[a0_0x34930b(0x174),a0_0x34930b(0x2e4),'info.','vis.',a0_0x34930b(0x1f2),a0_0x34930b(0x294),'icons-mfd.',a0_0x34930b(0x265),a0_0x34930b(0x268),'javascript.',a0_0x34930b(0x2e3)],SYSTEM_MODES={'NORMAL':'normal','VACATION':a0_0x34930b(0x25e),'PARTY':a0_0x34930b(0x1bd),'GUEST':'guest'},AUTO_RESET_MODES=[SYSTEM_MODES[a0_0x34930b(0x21a)],SYSTEM_MODES['GUEST']],PERSONA_MAPPING={'generic':a0_0x34930b(0x1e5),'senior_aal':a0_0x34930b(0x225),'family':a0_0x34930b(0x1c0),'single_comfort':'Fokus\x20auf\x20Maximierung\x20von\x20Komfort,\x20Automatisierungseffizienz\x20und\x20Energieeinsparung.','security':a0_0x34930b(0x19b)};class CogniLiving extends utils['Adapter']{constructor(_0x31843d){const _0x1f9fa2=a0_0x34930b;super({..._0x31843d,'name':_0x1f9fa2(0x1e9)}),this[_0x1f9fa2(0x27b)]=[],this[_0x1f9fa2(0x2d7)]=[],this[_0x1f9fa2(0x2f5)]=[],this[_0x1f9fa2(0x2d9)]=[],this[_0x1f9fa2(0x171)]=[],this['sensorLastValues']={},this[_0x1f9fa2(0x1b4)]={'latitude':0x0,'longitude':0x0,'city':''},this[_0x1f9fa2(0x168)]=!![],this[_0x1f9fa2(0x1e4)]=null,this[_0x1f9fa2(0x2f1)]=null,this[_0x1f9fa2(0x228)]=![],this[_0x1f9fa2(0x2db)]=null,this[_0x1f9fa2(0x25f)]=null,this['currentSystemMode']=SYSTEM_MODES[_0x1f9fa2(0x20c)],this[_0x1f9fa2(0x227)]=![],this[_0x1f9fa2(0x1dc)]=![],this[_0x1f9fa2(0x18f)]=_0x1f9fa2(0x210),this[_0x1f9fa2(0x2cc)]=null,this[_0x1f9fa2(0x1f7)]=null,this[_0x1f9fa2(0x18d)]=null,this[_0x1f9fa2(0x1eb)]=null,this[_0x1f9fa2(0x2f3)]=null,this['on']('ready',this[_0x1f9fa2(0x252)][_0x1f9fa2(0x1bb)](this)),this['on'](_0x1f9fa2(0x2cd),this[_0x1f9fa2(0x2c4)][_0x1f9fa2(0x1bb)](this)),this['on'](_0x1f9fa2(0x218),this[_0x1f9fa2(0x2bb)]['bind'](this)),this['on'](_0x1f9fa2(0x26f),this['onMessage']['bind'](this));}async[a0_0x34930b(0x252)](){const _0xdf85f=a0_0x34930b;this[_0xdf85f(0x251)][_0xdf85f(0x1fa)](_0xdf85f(0x2c6)+this[_0xdf85f(0x278)]+_0xdf85f(0x1f4)),await initZombies(this),this[_0xdf85f(0x2c7)][_0xdf85f(0x276)]=this[_0xdf85f(0x2c7)][_0xdf85f(0x276)]||'';try{this[_0xdf85f(0x227)]=await checkLicense(this,this[_0xdf85f(0x2c7)][_0xdf85f(0x276)]);}catch(_0x1e885c){}if(!this[_0xdf85f(0x2c7)][_0xdf85f(0x247)]||this[_0xdf85f(0x2c7)][_0xdf85f(0x247)]<0.1)this[_0xdf85f(0x2c7)][_0xdf85f(0x247)]=0xc;await initHistory(this),await initSystemConfig(this);if(this['config'][_0xdf85f(0x2c0)])try{this[_0xdf85f(0x2db)]=new GoogleGenerativeAI(this[_0xdf85f(0x2c7)]['geminiApiKey']),this[_0xdf85f(0x25f)]=this[_0xdf85f(0x2db)][_0xdf85f(0x1a1)]({'model':GEMINI_MODEL,'generationConfig':{'responseMimeType':'application/json'}}),this[_0xdf85f(0x251)][_0xdf85f(0x1fa)](_0xdf85f(0x264));}catch(_0x270109){this[_0xdf85f(0x251)][_0xdf85f(0x178)]('Gemini\x20Init\x20Error:\x20'+_0x270109[_0xdf85f(0x26f)]);}await createAllObjects(this),await loadSystemMode(this),await loadRawEventLog(this),await loadDailyDigests(this),this[_0xdf85f(0x22d)](_0xdf85f(0x2d8)),this['subscribeStates'](LTM_DP_TRIGGER_DIGEST),this[_0xdf85f(0x22d)](_0xdf85f(0x206)),this[_0xdf85f(0x22d)]('analysis.triggerBriefing'),this[_0xdf85f(0x22d)](_0xdf85f(0x197)),this[_0xdf85f(0x22d)](_0xdf85f(0x211)),await initSensorSubscriptions(this),await initPresenceSubscriptions(this),await setupTelegramListener(this);if(this[_0xdf85f(0x2cc)])clearInterval(this[_0xdf85f(0x2cc)]);const _0x482cf4=this[_0xdf85f(0x2c7)][_0xdf85f(0x250)]||0xf;_0x482cf4>0x0&&(this[_0xdf85f(0x251)][_0xdf85f(0x1fa)](_0xdf85f(0x2ef)+_0x482cf4+_0xdf85f(0x201)),this['analysisTimer']=setInterval(()=>{runAutopilot(this);},_0x482cf4*0x3c*0x3e8)),setupLtmScheduler(this),setupModeResetScheduler(this),setupDriftAnalysisScheduler(this),setupBriefingScheduler(this);}[a0_0x34930b(0x2bb)](_0x4d8483){const _0x1cee31=a0_0x34930b;if(this[_0x1cee31(0x2cc)])clearInterval(this[_0x1cee31(0x2cc)]);if(this[_0x1cee31(0x1eb)])clearInterval(this[_0x1cee31(0x1eb)]);if(this[_0x1cee31(0x1f7)])this[_0x1cee31(0x1f7)][_0x1cee31(0x203)]();if(this[_0x1cee31(0x18d)])this[_0x1cee31(0x18d)][_0x1cee31(0x203)]();if(this['briefingJob'])this[_0x1cee31(0x2f3)][_0x1cee31(0x203)]();if(this[_0x1cee31(0x1e4)])clearTimeout(this['exitTimer']);if(this[_0x1cee31(0x2f1)])clearTimeout(this['exitGraceTimer']);_0x4d8483();}async['onStateChange'](_0x35931a,_0x210cdc){const _0x44d18d=a0_0x34930b;if(!_0x210cdc)return;if(_0x35931a[_0x44d18d(0x24f)](_0x44d18d(0x27f))&&_0x35931a[_0x44d18d(0x204)](_0x44d18d(0x2df))&&_0x210cdc[_0x44d18d(0x1b1)]){await handleTelegramResponse(this,_0x210cdc['val']);return;}if(_0x35931a===this[_0x44d18d(0x18c)]+'.'+SYSTEM_DP_MODE){_0x210cdc[_0x44d18d(0x1b1)]&&Object[_0x44d18d(0x25d)](SYSTEM_MODES)[_0x44d18d(0x24f)](_0x210cdc[_0x44d18d(0x1b1)])&&(this[_0x44d18d(0x2bf)]=_0x210cdc['val'],_0x210cdc[_0x44d18d(0x1b1)]===SYSTEM_MODES[_0x44d18d(0x230)]?await setPresence(this,![]):await setPresence(this,!![]));if(!_0x210cdc[_0x44d18d(0x169)])this[_0x44d18d(0x235)](_0x35931a,{'val':this[_0x44d18d(0x2bf)],'ack':!![]});return;}if(!_0x210cdc['ack']){_0x35931a[_0x44d18d(0x24f)](_0x44d18d(0x2d8))&&_0x210cdc[_0x44d18d(0x1b1)]&&(this[_0x44d18d(0x235)](_0x35931a,{'val':![],'ack':!![]}),runGeminiAnalysis(this));if(_0x35931a[_0x44d18d(0x24f)](_0x44d18d(0x1ef))&&_0x210cdc['val']){this[_0x44d18d(0x235)](_0x35931a,{'val':![],'ack':!![]});if(this[_0x44d18d(0x227)])createDailyDigest(this);}_0x35931a['includes'](_0x44d18d(0x2b4))&&_0x210cdc[_0x44d18d(0x1b1)]&&(this[_0x44d18d(0x235)](_0x35931a,{'val':![],'ack':!![]}),sendMorningBriefing(this));_0x35931a[_0x44d18d(0x24f)](_0x44d18d(0x2d2))&&_0x210cdc[_0x44d18d(0x1b1)]&&(this['setState'](_0x35931a,{'val':![],'ack':!![]}),executeAutomationAction(this));return;}if(this['config'][_0x44d18d(0x26e)]&&this[_0x44d18d(0x2c7)]['presenceDevices']['includes'](_0x35931a)){await checkWifiPresence(this);return;}const _0x4f6641=(this[_0x44d18d(0x2c7)][_0x44d18d(0x1d9)]||[])[_0x44d18d(0x18b)](_0x55673b=>_0x55673b['id']===_0x35931a);if(_0x4f6641)processSensorEvent(this,_0x35931a,_0x210cdc,_0x4f6641);}async[a0_0x34930b(0x1e0)](_0x3c9644){const _0x1e6993=a0_0x34930b;if(typeof _0x3c9644==='object'&&_0x3c9644[_0x1e6993(0x26f)])try{if(_0x3c9644[_0x1e6993(0x2ba)]==='testApiKey'){if(!_0x3c9644['message']['apiKey'])return this['sendTo'](_0x3c9644[_0x1e6993(0x273)],_0x3c9644[_0x1e6993(0x2ba)],{'success':![],'message':'No\x20Key'},_0x3c9644[_0x1e6993(0x215)]);try{const _0x8f88d6=new GoogleGenerativeAI(_0x3c9644[_0x1e6993(0x26f)][_0x1e6993(0x1fb)])[_0x1e6993(0x1a1)]({'model':_0x1e6993(0x28f)});await _0x8f88d6['generateContent'](_0x1e6993(0x1f3)),this[_0x1e6993(0x1bf)](_0x3c9644[_0x1e6993(0x273)],_0x3c9644[_0x1e6993(0x2ba)],{'success':!![],'message':_0x1e6993(0x29e)},_0x3c9644[_0x1e6993(0x215)]);}catch(_0x1b3de4){this[_0x1e6993(0x1bf)](_0x3c9644['from'],_0x3c9644['command'],{'success':![],'message':_0x1b3de4[_0x1e6993(0x26f)]},_0x3c9644[_0x1e6993(0x215)]);}}else{if(_0x3c9644[_0x1e6993(0x2ba)]==='testNotification'){const _0x3b18b9=await sendNotification(this,'[Test]\x20Interaktiver\x20Alarm',!![],!![]);this[_0x1e6993(0x1bf)](_0x3c9644[_0x1e6993(0x273)],_0x3c9644['command'],{'success':_0x3b18b9>0x0,'message':_0x3b18b9+'\x20sent'},_0x3c9644[_0x1e6993(0x215)]);}else{if(_0x3c9644['command']===_0x1e6993(0x21c)){if(!this['isProVersion'])return this['sendTo'](_0x3c9644['from'],_0x3c9644[_0x1e6993(0x2ba)],{'success':![],'isPro':![]},_0x3c9644[_0x1e6993(0x215)]);let _0x16cb55={'status':_0x1e6993(0x25b),'details':'','lastCheck':0x0};try{_0x16cb55['status']=(await this[_0x1e6993(0x21f)](LTM_DP_DRIFT_STATUS))[_0x1e6993(0x1b1)],_0x16cb55[_0x1e6993(0x274)]=(await this['getStateAsync'](LTM_DP_DRIFT_DETAILS))[_0x1e6993(0x1b1)],_0x16cb55['lastCheck']=(await this[_0x1e6993(0x21f)](LTM_DP_DRIFT_LAST_CHECK))['val'];}catch(_0x4f2897){}const _0x3dda62=this[_0x1e6993(0x2d7)]||[];this['sendTo'](_0x3c9644['from'],_0x3c9644['command'],{'success':!![],'isPro':!![],'dailyDigests':this[_0x1e6993(0x171)],'driftAnalysis':_0x16cb55,'analysisHistory':_0x3dda62},_0x3c9644[_0x1e6993(0x215)]);}else{if(_0x3c9644[_0x1e6993(0x2ba)]===_0x1e6993(0x1a5)){const _0x44da5b=this['dailyDigests'][_0x1e6993(0x20f)],_0x22f95e=this['eventHistory'][_0x1e6993(0x2de)](_0x5f0440=>_0x5f0440[_0x1e6993(0x17e)]>new Date()[_0x1e6993(0x2b7)](0x0,0x0,0x0,0x0))['length'];let _0x1fd4bc={'status':_0x1e6993(0x25b)};try{_0x1fd4bc[_0x1e6993(0x232)]=(await this['getStateAsync'](LTM_DP_DRIFT_STATUS))[_0x1e6993(0x1b1)];}catch(_0x505df3){}let _0x354a9a=null;!this[_0x1e6993(0x25f)]&&(_0x354a9a=this['config'][_0x1e6993(0x2c0)]?'KI-Modell\x20nicht\x20initialisiert':_0x1e6993(0x28b));let _0x39fbf5={'detected':![],'description':'','targetId':'','targetValue':'','autoApply':![]};try{const _0x244f1d=await this[_0x1e6993(0x21f)]('analysis.automation.patternDetected'),_0x383ccd=await this[_0x1e6993(0x21f)](_0x1e6993(0x269)),_0x32ec28=await this['getStateAsync']('analysis.automation.targetId'),_0x1117e7=await this[_0x1e6993(0x21f)](_0x1e6993(0x290)),_0x3852e8=await this[_0x1e6993(0x21f)](_0x1e6993(0x211));_0x244f1d&&_0x244f1d['val']&&(_0x39fbf5[_0x1e6993(0x2f9)]=!![],_0x39fbf5['description']=_0x383ccd?_0x383ccd['val']:'',_0x39fbf5['targetId']=_0x32ec28?_0x32ec28[_0x1e6993(0x1b1)]:'',_0x39fbf5[_0x1e6993(0x17a)]=_0x1117e7?_0x1117e7[_0x1e6993(0x1b1)]:''),_0x39fbf5['autoApply']=_0x3852e8?!!_0x3852e8[_0x1e6993(0x1b1)]:![];}catch(_0x2daf1b){}this['sendTo'](_0x3c9644[_0x1e6993(0x273)],_0x3c9644[_0x1e6993(0x2ba)],{'success':!![],'eventHistory':this[_0x1e6993(0x27b)][_0x1e6993(0x1b0)](0x0,0xf),'stats':{'digestCount':_0x44da5b,'eventCountToday':_0x22f95e,'driftStatus':_0x1fd4bc['status'],'isPresent':this['isPresent'],'minDays':this[_0x1e6993(0x2c7)][_0x1e6993(0x29b)]||0x7,'stbDays':this[_0x1e6993(0x2c7)]['ltmStbWindowDays']||0xe,'ltbDays':this[_0x1e6993(0x2c7)]['ltmLtbWindowDays']||0x3c,'systemError':_0x354a9a},'automation':_0x39fbf5},_0x3c9644['callback']);}else{if(_0x3c9644[_0x1e6993(0x2ba)]===_0x1e6993(0x16d)){const _0x5946cc=await this[_0x1e6993(0x1be)](_0x1e6993(0x1b8),_0x1e6993(0x2b3)),_0x567107=[];if(_0x5946cc)for(const _0x4e2206 in _0x5946cc){const _0x101e84=_0x5946cc[_0x4e2206],_0x3e5d8f=(_0x101e84['common']&&typeof _0x101e84['common'][_0x1e6993(0x2b2)]===_0x1e6993(0x179)?_0x101e84[_0x1e6993(0x2cf)][_0x1e6993(0x2b2)]['de']:_0x101e84[_0x1e6993(0x2cf)]['name'])||_0x101e84[_0x1e6993(0x2cf)][_0x1e6993(0x2b2)];_0x567107[_0x1e6993(0x1c5)]({'id':_0x4e2206,'name':_0x3e5d8f});}this['sendTo'](_0x3c9644['from'],_0x3c9644[_0x1e6993(0x2ba)],{'success':!![],'enums':_0x567107},_0x3c9644[_0x1e6993(0x215)]);}else{if(_0x3c9644['command']===_0x1e6993(0x26b))try{const _0x27188b=await scanForDevices(this,_0x3c9644[_0x1e6993(0x26f)]||{});this[_0x1e6993(0x1bf)](_0x3c9644['from'],_0x3c9644[_0x1e6993(0x2ba)],{'success':!![],'devices':_0x27188b},_0x3c9644[_0x1e6993(0x215)]);}catch(_0x4740e0){this['sendTo'](_0x3c9644[_0x1e6993(0x273)],_0x3c9644[_0x1e6993(0x2ba)],{'success':![],'error':_0x4740e0[_0x1e6993(0x26f)]},_0x3c9644[_0x1e6993(0x215)]);}else{if(_0x3c9644[_0x1e6993(0x2ba)]===_0x1e6993(0x185)){const _0x2db103=_0x3c9644[_0x1e6993(0x26f)]['instance'];if(!_0x2db103)return this[_0x1e6993(0x1bf)](_0x3c9644[_0x1e6993(0x273)],_0x3c9644[_0x1e6993(0x2ba)],{'success':![],'error':'No\x20instance'},_0x3c9644[_0x1e6993(0x215)]);const _0x24548d=await getCalendarNames(this,_0x2db103);this[_0x1e6993(0x1bf)](_0x3c9644[_0x1e6993(0x273)],_0x3c9644[_0x1e6993(0x2ba)],{'success':!![],'names':_0x24548d},_0x3c9644[_0x1e6993(0x215)]);}else{if(_0x3c9644[_0x1e6993(0x2ba)]===_0x1e6993(0x2dc)){const {targetId:_0x2680f1,targetValue:_0x559c4d}=_0x3c9644['message'];this[_0x1e6993(0x251)][_0x1e6993(0x1fa)](_0x1e6993(0x2e1)+_0x2680f1+_0x1e6993(0x298)+_0x559c4d),await this[_0x1e6993(0x27c)](_0x1e6993(0x173),{'val':!![],'ack':!![]}),await this['setStateAsync'](_0x1e6993(0x269),{'val':'SIMULATION:\x20Test-Vorschlag\x20fÃ¼r\x20'+_0x2680f1,'ack':!![]}),await this[_0x1e6993(0x27c)](_0x1e6993(0x1d6),{'val':_0x2680f1,'ack':!![]}),await this[_0x1e6993(0x27c)]('analysis.automation.targetValue',{'val':_0x559c4d,'ack':!![]}),this['sendTo'](_0x3c9644[_0x1e6993(0x273)],_0x3c9644[_0x1e6993(0x2ba)],{'success':!![]},_0x3c9644['callback']);}else{if(_0x3c9644[_0x1e6993(0x2ba)]==='submitFeedback'){const {historyId:_0x50a782,rating:_0x7f4c4,comment:_0x424efc,alertReason:_0x3795a0}=_0x3c9644[_0x1e6993(0x26f)];_0x50a782&&_0x7f4c4?(await saveFeedback(this,{'timestamp':Date[_0x1e6993(0x213)](),'historyId':_0x50a782,'rating':_0x7f4c4,'comment':_0x424efc,'alertReason':_0x3795a0}),this['sendTo'](_0x3c9644['from'],_0x3c9644['command'],{'success':!![]},_0x3c9644[_0x1e6993(0x215)])):this[_0x1e6993(0x1bf)](_0x3c9644[_0x1e6993(0x273)],_0x3c9644[_0x1e6993(0x2ba)],{'success':![],'error':_0x1e6993(0x270)},_0x3c9644[_0x1e6993(0x215)]);}}}}}}}}}}catch(_0x45784c){this[_0x1e6993(0x251)][_0x1e6993(0x178)](_0x1e6993(0x2e9)+_0x3c9644[_0x1e6993(0x2ba)]+':\x20'+_0x45784c['message']);if(_0x3c9644[_0x1e6993(0x215)])this['sendTo'](_0x3c9644['from'],_0x3c9644[_0x1e6993(0x2ba)],{'success':![],'error':_0x45784c[_0x1e6993(0x26f)]},_0x3c9644[_0x1e6993(0x215)]);}}}async function initZombies(_0x37e361){const _0x125ff8=a0_0x34930b;try{const _0x1a4726=[_0x125ff8(0x2b9),_0x125ff8(0x1c2)];for(const _0x4b6f90 of _0x1a4726){try{const _0x17714d=await _0x37e361[_0x125ff8(0x181)](_0x4b6f90);_0x17714d&&await _0x37e361[_0x125ff8(0x1ac)](_0x4b6f90);}catch(_0x548f6e){}}}catch(_0x110921){}}async function initHistory(_0xf810c5){const _0x5f1215=a0_0x34930b;try{const _0x1826eb=await _0xf810c5[_0x5f1215(0x21f)](_0x5f1215(0x25a));_0x1826eb&&_0x1826eb['val']&&(_0xf810c5[_0x5f1215(0x27b)]=JSON[_0x5f1215(0x291)](_0x1826eb['val'][_0x5f1215(0x1a0)]()));}catch(_0x337867){_0xf810c5['eventHistory']=[];}try{const _0x54001a=await _0xf810c5[_0x5f1215(0x21f)](_0x5f1215(0x2a7));if(_0x54001a&&_0x54001a[_0x5f1215(0x1b1)])_0xf810c5[_0x5f1215(0x2d7)]=JSON['parse'](_0x54001a[_0x5f1215(0x1b1)][_0x5f1215(0x1a0)]());}catch(_0x664dba){_0xf810c5[_0x5f1215(0x2d7)]=[];}}async function initSystemConfig(_0x317b09){const _0x5ae5b7=a0_0x34930b;try{const _0x144358=await _0x317b09[_0x5ae5b7(0x293)]('system.config');_0x144358&&_0x144358[_0x5ae5b7(0x2cf)]&&(_0x317b09[_0x5ae5b7(0x1b4)]={'latitude':_0x144358[_0x5ae5b7(0x2cf)][_0x5ae5b7(0x22c)]||0x0,'longitude':_0x144358[_0x5ae5b7(0x2cf)]['longitude']||0x0,'city':_0x144358[_0x5ae5b7(0x2cf)][_0x5ae5b7(0x2c1)]||''});}catch(_0x237a71){}}async function checkLicense(_0x54d97a,_0x587a2f){const _0x133f21=a0_0x34930b;if(!_0x587a2f)return![];_0x54d97a[_0x133f21(0x18f)]=await getSystemUUID(_0x54d97a);if(_0x587a2f===_0x133f21(0x2a2)||_0x587a2f[_0x133f21(0x1d1)](_0x133f21(0x189)))return!![];return![];}async function getSystemUUID(_0x561adc){const _0xdf77d1=a0_0x34930b;try{const _0x5f2a0e=await _0x561adc[_0xdf77d1(0x293)]('system.meta.uuid');if(_0x5f2a0e&&_0x5f2a0e['native']&&_0x5f2a0e['native'][_0xdf77d1(0x184)])return _0x5f2a0e[_0xdf77d1(0x2da)][_0xdf77d1(0x184)];return _0xdf77d1(0x2bc);}catch(_0x40a2cf){return _0xdf77d1(0x285);}}async function createAllObjects(_0x29e11e){const _0x219582=a0_0x34930b;await checkSystemObjects(_0x29e11e),await _0x29e11e[_0x219582(0x1a9)](_0x219582(0x2ec),{'type':_0x219582(0x234),'common':{'name':_0x219582(0x282),'type':'string','role':_0x219582(0x2b0),'read':!![],'write':![]},'native':{}}),await _0x29e11e[_0x219582(0x1a9)](_0x219582(0x25a),{'type':_0x219582(0x234),'common':{'name':_0x219582(0x244),'type':_0x219582(0x271),'role':_0x219582(0x2b0),'read':!![],'write':![]},'native':{}}),await _0x29e11e[_0x219582(0x1a9)]('analysis.trigger',{'type':_0x219582(0x234),'common':{'name':_0x219582(0x2fa),'type':'boolean','role':_0x219582(0x29a),'read':!![],'write':!![],'def':![]},'native':{}}),await _0x29e11e[_0x219582(0x1a9)](_0x219582(0x2e5),{'type':_0x219582(0x234),'common':{'name':_0x219582(0x19f),'type':_0x219582(0x1ee),'role':_0x219582(0x29a),'read':!![],'write':!![],'def':![]},'native':{}}),await _0x29e11e[_0x219582(0x1a9)](_0x219582(0x1c9),{'type':_0x219582(0x234),'common':{'name':_0x219582(0x248),'type':_0x219582(0x271),'role':_0x219582(0x2b0),'read':!![],'write':![]},'native':{}}),await _0x29e11e[_0x219582(0x1a9)](_0x219582(0x254),{'type':'state','common':{'name':_0x219582(0x2a5),'type':'boolean','role':'indicator.alarm','read':!![],'write':![],'def':![]},'native':{}}),await _0x29e11e[_0x219582(0x1a9)]('analysis.isEmergency',{'type':_0x219582(0x234),'common':{'name':_0x219582(0x1d2),'type':_0x219582(0x1ee),'role':_0x219582(0x26a),'read':!![],'write':![],'def':![]},'native':{}}),await _0x29e11e['setObjectNotExistsAsync']('analysis.alertReason',{'type':_0x219582(0x234),'common':{'name':_0x219582(0x289),'type':'string','role':_0x219582(0x1ce),'read':!![],'write':![]},'native':{}}),await _0x29e11e[_0x219582(0x1a9)]('analysis.activitySummary',{'type':_0x219582(0x234),'common':{'name':'Activity\x20Summary','type':_0x219582(0x271),'role':'text','read':!![],'write':![]},'native':{}}),await _0x29e11e[_0x219582(0x1a9)](_0x219582(0x2f2),{'type':'state','common':{'name':_0x219582(0x1ae),'type':_0x219582(0x271),'role':_0x219582(0x234),'read':!![],'write':![],'def':_0x219582(0x25b)},'native':{}}),await _0x29e11e[_0x219582(0x1a9)](_0x219582(0x2f6),{'type':'state','common':{'name':_0x219582(0x1d8),'type':'string','role':'text','read':!![],'write':![]},'native':{}}),await _0x29e11e[_0x219582(0x1a9)]('analysis.comfortSuggestion',{'type':_0x219582(0x234),'common':{'name':_0x219582(0x2d5),'type':'string','role':_0x219582(0x231),'read':!![],'write':![]},'native':{}}),await _0x29e11e[_0x219582(0x1f1)]('analysis.automation',{'type':_0x219582(0x1ea),'common':{'name':'Automation\x20Proposals'},'native':{}}),await _0x29e11e[_0x219582(0x1a9)](_0x219582(0x173),{'type':'state','common':{'name':_0x219582(0x1b9),'type':_0x219582(0x1ee),'role':_0x219582(0x24e),'read':!![],'write':![],'def':![]},'native':{}}),await _0x29e11e['setObjectNotExistsAsync'](_0x219582(0x269),{'type':'state','common':{'name':_0x219582(0x1b7),'type':_0x219582(0x271),'role':_0x219582(0x231),'read':!![],'write':![]},'native':{}}),await _0x29e11e[_0x219582(0x1a9)](_0x219582(0x240),{'type':_0x219582(0x234),'common':{'name':_0x219582(0x229),'type':_0x219582(0x271),'role':_0x219582(0x231),'read':!![],'write':![]},'native':{}}),await _0x29e11e[_0x219582(0x1a9)]('analysis.automation.targetId',{'type':'state','common':{'name':'Target\x20ID','type':_0x219582(0x271),'role':'text','read':!![],'write':![]},'native':{}}),await _0x29e11e[_0x219582(0x1a9)]('analysis.automation.targetValue',{'type':_0x219582(0x234),'common':{'name':_0x219582(0x1e7),'type':_0x219582(0x271),'role':'text','read':!![],'write':![]},'native':{}}),await _0x29e11e['setObjectNotExistsAsync'](_0x219582(0x211),{'type':_0x219582(0x234),'common':{'name':'Auto\x20Apply\x20Rule','type':_0x219582(0x1ee),'role':_0x219582(0x236),'read':!![],'write':!![],'def':![]},'native':{}}),await _0x29e11e[_0x219582(0x1a9)](_0x219582(0x197),{'type':'state','common':{'name':_0x219582(0x2aa),'type':'boolean','role':'button','read':!![],'write':!![],'def':![]},'native':{}}),await _0x29e11e[_0x219582(0x1a9)](_0x219582(0x2a7),{'type':'state','common':{'name':_0x219582(0x2ac),'type':_0x219582(0x271),'role':_0x219582(0x2b0),'read':!![],'write':![],'def':'[]'},'native':{}}),await _0x29e11e[_0x219582(0x1a9)]('analysis.feedbackHistory',{'type':'state','common':{'name':_0x219582(0x27d),'type':_0x219582(0x271),'role':_0x219582(0x2b0),'read':!![],'write':![],'def':'[]'},'native':{}}),await _0x29e11e[_0x219582(0x1f1)](_0x219582(0x1dd),{'type':_0x219582(0x1ea),'common':{'name':_0x219582(0x29c)},'native':{}}),await _0x29e11e['setObjectNotExistsAsync'](_0x219582(0x257),{'type':'state','common':{'name':_0x219582(0x2a1),'type':_0x219582(0x2ee),'role':_0x219582(0x27a),'read':!![],'write':![],'def':0x0},'native':{}}),await _0x29e11e[_0x219582(0x1a9)](_0x219582(0x1df),{'type':_0x219582(0x234),'common':{'name':_0x219582(0x22e),'type':'string','role':_0x219582(0x231),'read':!![],'write':![],'def':'none'},'native':{}}),await _0x29e11e[_0x219582(0x1a9)](_0x219582(0x196),{'type':_0x219582(0x234),'common':{'name':_0x219582(0x16e),'type':'string','role':_0x219582(0x231),'read':!![],'write':![],'def':''},'native':{}}),await checkLtmObjects(_0x29e11e),await checkLtmDriftObjects(_0x29e11e);}async function checkSystemObjects(_0x119720){const _0x413b75=a0_0x34930b;await _0x119720['extendObjectAsync'](_0x413b75(0x207),{'type':_0x413b75(0x1ea),'common':{'name':'System\x20Status\x20&\x20Control'},'native':{}}),await _0x119720[_0x413b75(0x1f1)](SYSTEM_DP_MODE,{'type':_0x413b75(0x234),'common':{'name':_0x413b75(0x19d),'type':_0x413b75(0x271),'role':_0x413b75(0x234),'read':!![],'write':!![],'def':SYSTEM_MODES[_0x413b75(0x20c)],'states':{[SYSTEM_MODES[_0x413b75(0x20c)]]:_0x413b75(0x200),[SYSTEM_MODES['VACATION']]:_0x413b75(0x20b),[SYSTEM_MODES[_0x413b75(0x21a)]]:_0x413b75(0x20e),[SYSTEM_MODES[_0x413b75(0x1ed)]]:_0x413b75(0x1da)}},'native':{}});}async function checkLtmObjects(_0x51da06){const _0x3baf2e=a0_0x34930b;await _0x51da06[_0x3baf2e(0x1f1)](_0x3baf2e(0x277),{'type':_0x3baf2e(0x1ea),'common':{'name':'LTM'},'native':{}}),await _0x51da06[_0x3baf2e(0x1f1)](LTM_DP_RAW_LOG,{'type':_0x3baf2e(0x234),'common':{'name':_0x3baf2e(0x182),'type':'string','role':_0x3baf2e(0x2b0),'read':!![],'write':![]},'native':{}}),await _0x51da06['extendObjectAsync'](LTM_DP_DAILY_DIGESTS,{'type':_0x3baf2e(0x234),'common':{'name':'Daily\x20Digests','type':_0x3baf2e(0x271),'role':'json','read':!![],'write':![]},'native':{}}),await _0x51da06[_0x3baf2e(0x1f1)](LTM_DP_STATUS,{'type':_0x3baf2e(0x234),'common':{'name':_0x3baf2e(0x239),'type':'string','role':_0x3baf2e(0x231),'read':!![],'write':![]},'native':{}}),await _0x51da06[_0x3baf2e(0x1f1)](LTM_DP_TRIGGER_DIGEST,{'type':'state','common':{'name':'Trigger\x20Digest','type':'boolean','role':_0x3baf2e(0x29a),'read':!![],'write':!![],'def':![]},'native':{}}),await _0x51da06[_0x3baf2e(0x1f1)](LTM_DP_BASELINE_STATUS,{'type':_0x3baf2e(0x234),'common':{'name':_0x3baf2e(0x1b2),'type':'string','role':'text','read':!![],'write':![]},'native':{}});}async function checkLtmDriftObjects(_0x135461){const _0x579e52=a0_0x34930b;await _0x135461[_0x579e52(0x1f1)](LTM_DP_DRIFT_CHANNEL,{'type':_0x579e52(0x1ea),'common':{'name':_0x579e52(0x183)},'native':{}}),await _0x135461[_0x579e52(0x1f1)](LTM_DP_DRIFT_STATUS,{'type':_0x579e52(0x234),'common':{'name':_0x579e52(0x295),'type':_0x579e52(0x271),'role':_0x579e52(0x234),'read':!![],'write':![],'def':_0x579e52(0x25b)},'native':{}}),await _0x135461[_0x579e52(0x1f1)](LTM_DP_DRIFT_DETAILS,{'type':_0x579e52(0x234),'common':{'name':_0x579e52(0x223),'type':_0x579e52(0x271),'role':_0x579e52(0x231),'read':!![],'write':![]},'native':{}}),await _0x135461[_0x579e52(0x1f1)](LTM_DP_DRIFT_LAST_CHECK,{'type':_0x579e52(0x234),'common':{'name':'Last\x20Check','type':_0x579e52(0x2ee),'role':'date','read':!![],'write':![]},'native':{}});}async function loadSystemMode(_0x4028e8){const _0x2b7879=a0_0x34930b;try{const _0x3a5b18=await _0x4028e8['getStateAsync'](SYSTEM_DP_MODE);_0x3a5b18&&_0x3a5b18[_0x2b7879(0x1b1)]&&Object[_0x2b7879(0x25d)](SYSTEM_MODES)[_0x2b7879(0x24f)](_0x3a5b18['val'])?_0x4028e8[_0x2b7879(0x2bf)]=_0x3a5b18[_0x2b7879(0x1b1)]:(_0x4028e8[_0x2b7879(0x2bf)]=SYSTEM_MODES[_0x2b7879(0x20c)],await _0x4028e8[_0x2b7879(0x27c)](SYSTEM_DP_MODE,{'val':SYSTEM_MODES[_0x2b7879(0x20c)],'ack':!![]}));}catch(_0x2d7352){_0x4028e8[_0x2b7879(0x2bf)]=SYSTEM_MODES[_0x2b7879(0x20c)];}}async function loadRawEventLog(_0x114f7c){const _0x23fb1a=a0_0x34930b;try{const _0x3fe7c7=await _0x114f7c[_0x23fb1a(0x21f)](LTM_DP_RAW_LOG);if(_0x3fe7c7&&_0x3fe7c7['val'])_0x114f7c[_0x23fb1a(0x2d9)]=JSON[_0x23fb1a(0x291)](_0x3fe7c7['val']);}catch(_0x3cf146){_0x114f7c[_0x23fb1a(0x2d9)]=[];}}async function loadDailyDigests(_0x590e1e){const _0x5e2e6e=a0_0x34930b;try{const _0x26d1fc=await _0x590e1e[_0x5e2e6e(0x21f)](LTM_DP_DAILY_DIGESTS);if(_0x26d1fc&&_0x26d1fc[_0x5e2e6e(0x1b1)])_0x590e1e[_0x5e2e6e(0x171)]=JSON[_0x5e2e6e(0x291)](_0x26d1fc[_0x5e2e6e(0x1b1)]);}catch(_0x421dc9){_0x590e1e[_0x5e2e6e(0x171)]=[];}await updateBaselineStatus(_0x590e1e);}async function saveRawEventLog(_0x311c2d){const _0x19e0f7=a0_0x34930b;_0x311c2d['rawEventLog'][_0x19e0f7(0x20f)]>RAW_LOG_MAX_SIZE&&_0x311c2d[_0x19e0f7(0x2d9)]['splice'](0x0,_0x311c2d[_0x19e0f7(0x2d9)][_0x19e0f7(0x20f)]-RAW_LOG_MAX_SIZE),await _0x311c2d[_0x19e0f7(0x27c)](LTM_DP_RAW_LOG,{'val':JSON['stringify'](_0x311c2d[_0x19e0f7(0x2d9)]),'ack':!![]});}async function saveDailyDigests(_0x5900a8,_0x5b183=!![]){const _0x5c0e0f=a0_0x34930b,_0x2f9c39=_0x5900a8[_0x5c0e0f(0x2c7)]['ltmLtbWindowDays']||0x3c;_0x5900a8['dailyDigests'][_0x5c0e0f(0x20f)]>_0x2f9c39&&_0x5900a8[_0x5c0e0f(0x171)][_0x5c0e0f(0x1bc)](0x0,_0x5900a8[_0x5c0e0f(0x171)]['length']-_0x2f9c39);await _0x5900a8[_0x5c0e0f(0x27c)](LTM_DP_DAILY_DIGESTS,{'val':JSON[_0x5c0e0f(0x1b3)](_0x5900a8[_0x5c0e0f(0x171)]),'ack':!![]});if(_0x5b183)await updateBaselineStatus(_0x5900a8);}async function updateAnalysisHistory(_0x586896,_0xff1c27){const _0x2dda50=a0_0x34930b;_0x586896[_0x2dda50(0x2d7)][_0x2dda50(0x288)](_0xff1c27);if(_0x586896[_0x2dda50(0x2d7)][_0x2dda50(0x20f)]>ANALYSIS_HISTORY_MAX_SIZE)_0x586896[_0x2dda50(0x2d7)]['pop']();await _0x586896[_0x2dda50(0x27c)]('analysis.analysisHistory',{'val':JSON[_0x2dda50(0x1b3)](_0x586896['analysisHistory']),'ack':!![]});}async function updateBaselineStatus(_0x580124){const _0x3775dd=a0_0x34930b;if(!_0x580124[_0x3775dd(0x227)]){await _0x580124[_0x3775dd(0x27c)](LTM_DP_BASELINE_STATUS,{'val':_0x3775dd(0x219),'ack':!![]});return;}const _0x4e0d47=_0x580124[_0x3775dd(0x171)][_0x3775dd(0x20f)]>=(_0x580124[_0x3775dd(0x2c7)]['minDaysForBaseline']||0x7)?_0x3775dd(0x176)+_0x580124[_0x3775dd(0x171)][_0x3775dd(0x20f)]+_0x3775dd(0x2ae):_0x3775dd(0x2c9)+_0x580124[_0x3775dd(0x171)][_0x3775dd(0x20f)]+'/'+(_0x580124[_0x3775dd(0x2c7)][_0x3775dd(0x29b)]||0x7)+')';await _0x580124[_0x3775dd(0x27c)](LTM_DP_BASELINE_STATUS,{'val':_0x4e0d47,'ack':!![]});}async function initSensorSubscriptions(_0xc3bc0e){const _0x179172=a0_0x34930b,_0x1a47d6=_0xc3bc0e[_0x179172(0x2c7)][_0x179172(0x1d9)];if(_0x1a47d6&&_0x1a47d6['length']>0x0){_0xc3bc0e[_0x179172(0x251)][_0x179172(0x1fa)](_0x179172(0x1ab)+_0x1a47d6[_0x179172(0x20f)]+_0x179172(0x2c8));for(const _0x356ca6 of _0x1a47d6){if(_0x356ca6['id']){await _0xc3bc0e[_0x179172(0x170)](_0x356ca6['id']);try{const _0x381676=await _0xc3bc0e['getForeignStateAsync'](_0x356ca6['id']);if(_0x381676)_0xc3bc0e[_0x179172(0x28e)][_0x356ca6['id']]=_0x381676['val'];}catch(_0x5d791e){}}}}}async function initPresenceSubscriptions(_0x5da796){const _0x248037=a0_0x34930b,_0x363eb4=_0x5da796[_0x248037(0x2c7)][_0x248037(0x26e)]||[];if(_0x363eb4[_0x248037(0x20f)]>0x0){_0x5da796[_0x248037(0x251)]['info'](_0x248037(0x1ab)+_0x363eb4[_0x248037(0x20f)]+'\x20presence\x20devices...');for(const _0x5b291b of _0x363eb4){await _0x5da796['subscribeForeignStatesAsync'](_0x5b291b);}try{await checkWifiPresence(_0x5da796);}catch(_0x6a5ed9){}}}async function getWeatherContext(_0xaf5957){const _0x3c6d33=a0_0x34930b;try{if(!_0xaf5957['config'][_0x3c6d33(0x16a)])return _0x3c6d33(0x241);let _0x2a7664='';const _0x39abb9=_0xaf5957[_0x3c6d33(0x2c7)][_0x3c6d33(0x192)];if(_0x39abb9)try{if(_0x39abb9[_0x3c6d33(0x24f)](_0x3c6d33(0x198))){const _0x43c4ff=await _0xaf5957[_0x3c6d33(0x214)](_0x39abb9+'.Summary.Current');if(_0x43c4ff&&_0x43c4ff['val'])_0x2a7664=_0x43c4ff['val'];}else{if(_0x39abb9['includes'](_0x3c6d33(0x16c))){const _0x4a7c07=await _0xaf5957[_0x3c6d33(0x214)](_0x39abb9+_0x3c6d33(0x19a));if(_0x4a7c07&&_0x4a7c07[_0x3c6d33(0x1b1)])_0x2a7664=_0x4a7c07[_0x3c6d33(0x1b1)];}else{if(_0x39abb9['includes'](_0x3c6d33(0x1d3))){const _0x5be93a=await _0xaf5957[_0x3c6d33(0x214)](_0x39abb9+_0x3c6d33(0x292));if(_0x5be93a&&_0x5be93a[_0x3c6d33(0x1b1)])_0x2a7664=_0x5be93a[_0x3c6d33(0x1b1)];}}}}catch(_0x38f96b){}if(!_0x2a7664){const _0x207f3c=[_0x3c6d33(0x2e6),_0x3c6d33(0x1db),'weatherunderground.0',_0x3c6d33(0x2a0)];for(const _0x1d1d24 of _0x207f3c){try{const _0x40b778=await _0xaf5957[_0x3c6d33(0x293)](_0x1d1d24);if(_0x40b778){if(_0x1d1d24[_0x3c6d33(0x24f)](_0x3c6d33(0x198))){const _0x4a1b5e=await _0xaf5957[_0x3c6d33(0x214)](_0x1d1d24+_0x3c6d33(0x1f5));if(_0x4a1b5e&&_0x4a1b5e[_0x3c6d33(0x1b1)]){_0x2a7664=_0x4a1b5e[_0x3c6d33(0x1b1)];break;}}}}catch(_0x37d3c0){}}}return _0x2a7664?_0x3c6d33(0x177)+_0x2a7664:_0x3c6d33(0x18a);}catch(_0x5dea77){return _0x3c6d33(0x2c5)+_0x5dea77[_0x3c6d33(0x26f)];}}async function getCalendarContext(_0x17044c){const _0x28b898=a0_0x34930b;try{if(!_0x17044c[_0x28b898(0x2c7)][_0x28b898(0x263)])return _0x28b898(0x26d);let _0x25426d=_0x17044c[_0x28b898(0x2c7)][_0x28b898(0x28a)]||_0x28b898(0x2b5),_0x198e21=_0x17044c['config'][_0x28b898(0x1e3)]||[];if(typeof _0x198e21===_0x28b898(0x271))_0x198e21=_0x198e21['split'](',');try{const _0x5ef954=await _0x17044c['getForeignStateAsync'](_0x25426d+'.data.table');if(_0x5ef954&&_0x5ef954[_0x28b898(0x1b1)]){let _0x21c559=tryParse(_0x5ef954[_0x28b898(0x1b1)]);if(_0x21c559&&Array[_0x28b898(0x249)](_0x21c559)){if(_0x198e21[_0x28b898(0x20f)]>0x0)_0x21c559=_0x21c559[_0x28b898(0x2de)](_0x4cc2e1=>_0x198e21['includes'](_0x4cc2e1[_0x28b898(0x17f)]||''));else return'KALENDER:\x20Keine\x20Kalender\x20ausgewÃ¤hlt\x20(Bitte\x20in\x20Settings\x20konfigurieren)';if(_0x21c559['length']>0x0){const _0x4ce844=_0x21c559['slice'](0x0,0x3)['map'](_0x2ea390=>{const _0x4394eb=_0x28b898;let _0xaa2515=_0x2ea390[_0x4394eb(0x1de)];if(_0x2ea390[_0x4394eb(0x279)])_0xaa2515+='\x20'+_0x2ea390[_0x4394eb(0x279)];return _0xaa2515+':\x20'+_0x2ea390[_0x4394eb(0x1af)]+'\x20('+_0x2ea390[_0x4394eb(0x17f)]+')';});return _0x28b898(0x175)+_0x4ce844['join']('\x20|\x20');}else return _0x28b898(0x22f);}}}catch(_0x2149ff){_0x17044c[_0x28b898(0x251)][_0x28b898(0x1ca)](_0x28b898(0x2b8)+_0x2149ff[_0x28b898(0x26f)]);}return _0x28b898(0x2ab);}catch(_0x1a949b){return'KALENDER\x20ERROR:\x20'+_0x1a949b[_0x28b898(0x26f)];}}async function getCalendarNames(_0x13c6d,_0x3723ad){const _0xa3e78c=a0_0x34930b;try{const _0x207112=await _0x13c6d[_0xa3e78c(0x214)](_0x3723ad+'.data.table');if(_0x207112&&_0x207112['val']){const _0x5f22d1=tryParse(_0x207112[_0xa3e78c(0x1b1)]);if(_0x5f22d1&&Array[_0xa3e78c(0x249)](_0x5f22d1)){const _0x2eb80f=[...new Set(_0x5f22d1[_0xa3e78c(0x283)](_0x4fea42=>_0x4fea42[_0xa3e78c(0x17f)])[_0xa3e78c(0x2de)](Boolean))];return _0x2eb80f[_0xa3e78c(0x187)]();}}return[];}catch(_0x1ef70f){return _0x13c6d[_0xa3e78c(0x251)][_0xa3e78c(0x178)](_0xa3e78c(0x2ca)+_0x1ef70f[_0xa3e78c(0x26f)]),[];}}async function checkWifiPresence(_0x5b702d){const _0x3f0306=a0_0x34930b;try{const _0x1f76b3=_0x5b702d[_0x3f0306(0x2c7)][_0x3f0306(0x26e)]||[];let _0x374764=![];for(const _0x2c08b4 of _0x1f76b3){try{const _0x3b5e5f=await _0x5b702d[_0x3f0306(0x214)](_0x2c08b4);if(_0x3b5e5f&&(_0x3b5e5f[_0x3f0306(0x1b1)]===!![]||_0x3b5e5f['val']===_0x3f0306(0x2d6)||_0x3b5e5f[_0x3f0306(0x1b1)]===0x1)){_0x374764=!![];break;}}catch(_0x1a5d28){}}return _0x374764&&(_0x5b702d[_0x3f0306(0x1e4)]&&(_0x5b702d[_0x3f0306(0x251)]['info'](_0x3f0306(0x191)),abortExitTimer(_0x5b702d)),!_0x5b702d[_0x3f0306(0x168)]&&_0x5b702d[_0x3f0306(0x2bf)]===SYSTEM_MODES[_0x3f0306(0x20c)]&&await setPresence(_0x5b702d,!![])),_0x374764;}catch(_0x5b6476){return _0x5b702d[_0x3f0306(0x251)][_0x3f0306(0x178)](_0x3f0306(0x1ad)+_0x5b6476[_0x3f0306(0x26f)]),![];}}function startExitTimer(_0x3d7a94){const _0x12f342=a0_0x34930b;abortExitTimer(_0x3d7a94),_0x3d7a94[_0x12f342(0x228)]=!![],_0x3d7a94['exitGraceTimer']=setTimeout(()=>{const _0x2531d5=_0x12f342;_0x3d7a94[_0x2531d5(0x228)]=![];},EXIT_GRACE_PERIOD_SECONDS*0x3e8),_0x3d7a94[_0x12f342(0x1e4)]=setTimeout(()=>{setPresence(_0x3d7a94,![]),_0x3d7a94['exitTimer']=null;},EXIT_TIMER_MINUTES*0x3c*0x3e8);}function abortExitTimer(_0x21c10f){const _0x55db3a=a0_0x34930b;if(_0x21c10f['exitTimer'])clearTimeout(_0x21c10f[_0x55db3a(0x1e4)]);if(_0x21c10f[_0x55db3a(0x2f1)])clearTimeout(_0x21c10f[_0x55db3a(0x2f1)]);_0x21c10f['exitTimer']=null,_0x21c10f[_0x55db3a(0x2f1)]=null,_0x21c10f['isGracePeriodActive']=![];}async function setPresence(_0x1a4212,_0x58538d){const _0x192823=a0_0x34930b;if(_0x1a4212[_0x192823(0x168)]===_0x58538d)return;_0x1a4212[_0x192823(0x168)]=_0x58538d,await _0x1a4212[_0x192823(0x27c)](_0x192823(0x221),{'val':_0x58538d,'ack':!![]});}async function saveFeedback(_0x121550,_0x54d466){const _0x4a6805=a0_0x34930b;_0x121550[_0x4a6805(0x251)][_0x4a6805(0x1fa)](_0x4a6805(0x1f6)+JSON['stringify'](_0x54d466));}async function runBaselineDriftAnalysis(_0x52e9e7){const _0x124147=a0_0x34930b;if(!_0x52e9e7['isProVersion']||!_0x52e9e7[_0x124147(0x25f)])return;const _0x21181e=_0x52e9e7[_0x124147(0x2c7)][_0x124147(0x1e8)]||0xe;if(_0x52e9e7[_0x124147(0x171)]['length']<_0x21181e+(_0x52e9e7[_0x124147(0x2c7)][_0x124147(0x29b)]||0x7)){await _0x52e9e7[_0x124147(0x27c)](LTM_DP_DRIFT_STATUS,{'val':'N/A\x20(Learning)','ack':!![]});return;}const _0x28f470=_0x52e9e7[_0x124147(0x171)]['slice'](-_0x21181e),_0x1bef43=_0x52e9e7['dailyDigests'][_0x124147(0x1b0)](0x0,_0x52e9e7[_0x124147(0x171)][_0x124147(0x20f)]-_0x21181e),_0x3a7cab=_0x124147(0x21d)+JSON[_0x124147(0x1b3)](_0x1bef43)+_0x124147(0x16f)+JSON['stringify'](_0x28f470);try{const _0x4d7976=await _0x52e9e7[_0x124147(0x25f)][_0x124147(0x2bd)](_0x3a7cab),_0x27b59d=JSON[_0x124147(0x291)](_0x4d7976['response']['text']()['replace'](/```json|```/g,'')[_0x124147(0x1c8)]());_0x27b59d[_0x124147(0x261)]&&(await _0x52e9e7[_0x124147(0x27c)](LTM_DP_DRIFT_STATUS,{'val':_0x27b59d['baselineDrift'],'ack':!![]}),await _0x52e9e7[_0x124147(0x27c)](LTM_DP_DRIFT_DETAILS,{'val':_0x27b59d['driftDetails'],'ack':!![]}),await _0x52e9e7['setStateAsync'](LTM_DP_DRIFT_LAST_CHECK,{'val':Date['now'](),'ack':!![]}));}catch(_0x58f236){}}function setupLtmScheduler(_0x45bffb){const _0x5f2a9f=a0_0x34930b;try{if(_0x45bffb[_0x5f2a9f(0x1f7)])_0x45bffb[_0x5f2a9f(0x1f7)][_0x5f2a9f(0x203)]();if(!_0x45bffb[_0x5f2a9f(0x227)]){_0x45bffb['setStateAsync'](LTM_DP_STATUS,{'val':_0x5f2a9f(0x219),'ack':!![]});return;}_0x45bffb[_0x5f2a9f(0x1f7)]=schedule[_0x5f2a9f(0x212)](LTM_SCHEDULE,()=>createDailyDigest(_0x45bffb));}catch(_0x258e46){_0x45bffb[_0x5f2a9f(0x251)][_0x5f2a9f(0x178)]('LTM\x20Sched\x20Error:\x20'+_0x258e46['message']);}}function setupModeResetScheduler(_0x2a5971){const _0x52195a=a0_0x34930b;try{if(_0x2a5971[_0x52195a(0x18d)])_0x2a5971[_0x52195a(0x18d)][_0x52195a(0x203)]();_0x2a5971['modeResetJob']=schedule[_0x52195a(0x212)](MODE_RESET_SCHEDULE,async()=>{const _0x3f078a=_0x52195a;await loadSystemMode(_0x2a5971),AUTO_RESET_MODES[_0x3f078a(0x24f)](_0x2a5971[_0x3f078a(0x2bf)])&&await _0x2a5971[_0x3f078a(0x27c)](SYSTEM_DP_MODE,{'val':SYSTEM_MODES[_0x3f078a(0x20c)],'ack':![]});});}catch(_0xcd3dd6){_0x2a5971[_0x52195a(0x251)][_0x52195a(0x178)](_0x52195a(0x226)+_0xcd3dd6[_0x52195a(0x26f)]);}}function setupDriftAnalysisScheduler(_0x260ce3){const _0x24e120=a0_0x34930b;try{if(_0x260ce3[_0x24e120(0x1eb)])clearInterval(_0x260ce3['driftAnalysisTimer']);if(!_0x260ce3[_0x24e120(0x227)])return;_0x260ce3[_0x24e120(0x1eb)]=setInterval(()=>runBaselineDriftAnalysis(_0x260ce3),(_0x260ce3['config']['ltmDriftCheckIntervalHours']||0x18)*0x36ee80),setTimeout(()=>runBaselineDriftAnalysis(_0x260ce3),0x1388);}catch(_0x1e31cb){_0x260ce3[_0x24e120(0x251)][_0x24e120(0x178)](_0x24e120(0x17d)+_0x1e31cb[_0x24e120(0x26f)]);}}function setupBriefingScheduler(_0x2db53c){const _0xa08970=a0_0x34930b;try{if(_0x2db53c[_0xa08970(0x2f3)])_0x2db53c[_0xa08970(0x2f3)][_0xa08970(0x203)]();if(!_0x2db53c[_0xa08970(0x2c7)]['briefingEnabled'])return;const _0xe1b2eb=(_0x2db53c[_0xa08970(0x2c7)][_0xa08970(0x23b)]||'08:00')[_0xa08970(0x23e)](':'),_0x3df8bf=parseInt(_0xe1b2eb[0x0])||0x8,_0x1d6ef0=parseInt(_0xe1b2eb[0x1])||0x0,_0x30a3c7=_0x1d6ef0+'\x20'+_0x3df8bf+'\x20*\x20*\x20*';_0x2db53c[_0xa08970(0x251)]['info'](_0xa08970(0x1d0)+_0x3df8bf+':'+(_0x1d6ef0<0xa?'0'+_0x1d6ef0:_0x1d6ef0)),_0x2db53c[_0xa08970(0x2f3)]=schedule[_0xa08970(0x212)](_0x30a3c7,()=>{sendMorningBriefing(_0x2db53c);});}catch(_0x1ce6a2){_0x2db53c['log']['error'](_0xa08970(0x209)+_0x1ce6a2[_0xa08970(0x26f)]);}}async function sendNotification(_0x46d1e7,_0x3346ae,_0x5f179b=![],_0x2731f0=![]){const _0x5a30ad=a0_0x34930b;_0x46d1e7[_0x5a30ad(0x251)][_0x5a30ad(0x1fa)]((_0x5f179b?'[TEST]\x20':'')+'Sending\x20notification:\x20\x22'+_0x3346ae+'\x22');const _0x59cf65=_0x46d1e7[_0x5a30ad(0x2c7)];let _0xa27375=0x0;if(_0x59cf65[_0x5a30ad(0x1d4)]){let _0xc9a4f0={};(_0x3346ae[_0x5a30ad(0x24f)]('Alarm')||_0x2731f0)&&(_0xc9a4f0={'reply_markup':{'inline_keyboard':[[{'text':_0x5a30ad(0x180),'callback_data':_0x5a30ad(0x238)}],[{'text':_0x5a30ad(0x2eb),'callback_data':_0x5a30ad(0x1c3)}]]}}),await _0x46d1e7[_0x5a30ad(0x1f9)](_0x59cf65[_0x5a30ad(0x1fe)],_0x5a30ad(0x27e),{'text':_0x3346ae,'user':_0x59cf65[_0x5a30ad(0x194)],..._0xc9a4f0}),_0xa27375++;}if(_0x59cf65[_0x5a30ad(0x242)]){let _0x4c5441={'message':_0x3346ae,'title':_0x2731f0?'ðŸš¨\x20EMERGENCY':_0x5a30ad(0x2f8),'priority':_0x2731f0?0x2:0x1,'device':_0x59cf65[_0x5a30ad(0x1c1)]};_0x2731f0&&(_0x4c5441['retry']=0x1e,_0x4c5441['expire']=0xe10,_0x4c5441[_0x5a30ad(0x199)]=_0x5a30ad(0x188)),await _0x46d1e7[_0x5a30ad(0x1f9)](_0x59cf65[_0x5a30ad(0x1a7)],_0x5a30ad(0x27e),_0x4c5441),_0xa27375++;}return _0x59cf65[_0x5a30ad(0x29f)]&&(await _0x46d1e7['sendToAsync'](_0x59cf65[_0x5a30ad(0x2d3)],_0x5a30ad(0x27e),{'text':_0x3346ae,'to':_0x59cf65[_0x5a30ad(0x1d5)]}),_0xa27375++),_0xa27375;}async function setupTelegramListener(_0xeaaf78){const _0x350e4a=a0_0x34930b,_0x45f712=_0xeaaf78['config'][_0x350e4a(0x1fe)];_0xeaaf78['config']['notifyTelegramEnabled']&&_0x45f712&&(_0xeaaf78[_0x350e4a(0x251)]['info'](_0x350e4a(0x17b)+_0x45f712+_0x350e4a(0x2d0)),await _0xeaaf78[_0x350e4a(0x170)](_0x45f712+'.communicate.request'));}async function handleTelegramResponse(_0x549eec,_0x3f3f8d){const _0x562cfb=a0_0x34930b;let _0x130650=_0x3f3f8d;_0x3f3f8d[_0x562cfb(0x1d1)]('[')&&(_0x130650=_0x3f3f8d['substring'](_0x3f3f8d['indexOf'](']')+0x1));if(_0x130650===_0x562cfb(0x238))_0x549eec[_0x562cfb(0x251)]['info'](_0x562cfb(0x233)),await _0x549eec[_0x562cfb(0x27c)](_0x562cfb(0x254),{'val':![],'ack':!![]}),await _0x549eec[_0x562cfb(0x27c)](_0x562cfb(0x281),{'val':_0x562cfb(0x267),'ack':!![]}),_0x549eec[_0x562cfb(0x1dc)]=![],sendNotification(_0x549eec,'âœ…\x20Alarm\x20quittiert.\x20System\x20normal.',![]);else _0x130650===_0x562cfb(0x1c3)&&(_0x549eec[_0x562cfb(0x251)][_0x562cfb(0x1ca)](_0x562cfb(0x23f)),sendNotification(_0x549eec,'ðŸ“ž\x20RÃœCKRUF\x20BITTE!\x20Der\x20Bewohner\x20hat\x20den\x20RÃ¼ckruf-Button\x20gedrÃ¼ckt.',![],!![]));}function a0_0x5b09(_0x1c3031,_0x3b9872){const _0x520013=a0_0x57f5();return a0_0x5b09=function(_0x13e093,_0x134a5b){_0x13e093=_0x13e093-0x168;let _0x57f59d=_0x520013[_0x13e093];return _0x57f59d;},a0_0x5b09(_0x1c3031,_0x3b9872);}async function processSensorEvent(_0x58e728,_0x570394,_0x59e10e,_0xdecafe){const _0xed942a=a0_0x34930b;if(!_0xdecafe[_0xed942a(0x2c2)]&&_0x58e728[_0xed942a(0x28e)][_0x570394]===_0x59e10e[_0xed942a(0x1b1)])return;_0x58e728[_0xed942a(0x28e)][_0x570394]=_0x59e10e[_0xed942a(0x1b1)];if(_0x58e728[_0xed942a(0x228)])return;const _0x2a00fb=await checkWifiPresence(_0x58e728);if(_0x2a00fb){if(!_0x58e728['isPresent'])await setPresence(_0x58e728,!![]);}else{const _0x4335d9=_0xdecafe[_0xed942a(0x262)]===!![];if(_0x4335d9)startExitTimer(_0x58e728);else{if(_0x58e728[_0xed942a(0x1e4)])abortExitTimer(_0x58e728);if(!_0x58e728['isPresent']&&_0x58e728['currentSystemMode']===SYSTEM_MODES['NORMAL'])await setPresence(_0x58e728,!![]);}}const _0x2454a3={'timestamp':_0x59e10e['ts'],'id':_0x570394,'name':_0xdecafe[_0xed942a(0x2b2)],'value':_0x59e10e[_0xed942a(0x1b1)],'location':_0xdecafe[_0xed942a(0x286)],'type':_0xdecafe[_0xed942a(0x2a3)]};_0x58e728[_0xed942a(0x27b)][_0xed942a(0x288)](_0x2454a3);if(_0x58e728[_0xed942a(0x27b)][_0xed942a(0x20f)]>HISTORY_MAX_SIZE)_0x58e728[_0xed942a(0x27b)][_0xed942a(0x2e8)]();await _0x58e728[_0xed942a(0x27c)](_0xed942a(0x2ec),{'val':JSON[_0xed942a(0x1b3)](_0x2454a3),'ack':!![]}),await _0x58e728[_0xed942a(0x27c)](_0xed942a(0x25a),{'val':JSON[_0xed942a(0x1b3)](_0x58e728[_0xed942a(0x27b)]),'ack':!![]}),_0x58e728['rawEventLog'][_0xed942a(0x1c5)]({'timestamp':new Date(_0x59e10e['ts'])[_0xed942a(0x20d)](),'sensorName':_0xdecafe[_0xed942a(0x2b2)],'location':_0xdecafe[_0xed942a(0x286)],'value':_0x59e10e[_0xed942a(0x1b1)]}),await saveRawEventLog(_0x58e728);}async function runGeminiAnalysis(_0x5dee00,_0x481ef3=''){const _0x24003f=a0_0x34930b;if(!_0x5dee00[_0x24003f(0x25f)]){_0x5dee00[_0x24003f(0x251)]['warn'](_0x24003f(0x1d7));return;}const _0xdcebf=_0x5dee00[_0x24003f(0x27b)][_0x24003f(0x20f)]>0x0?_0x5dee00[_0x24003f(0x27b)]:[{'note':_0x24003f(0x29d)}],_0x22db2b=PERSONA_MAPPING[_0x5dee00[_0x24003f(0x2c7)][_0x24003f(0x2a4)]||_0x24003f(0x1cf)],_0x47face=_0x5dee00[_0x24003f(0x2c7)][_0x24003f(0x237)]||'',_0x50a10c=_0x5dee00[_0x24003f(0x2bf)],_0x4eba33=await getWeatherContext(_0x5dee00),_0x35faeb=await getCalendarContext(_0x5dee00),_0xdcd5b=(_0x4eba33+'\x20'+_0x35faeb)[_0x24003f(0x1c8)](),_0xa747ac=new Date(),_0x1b51f5=_0xa747ac[_0x24003f(0x258)]('de-DE',{'weekday':_0x24003f(0x24a),'hour':_0x24003f(0x1fc),'minute':_0x24003f(0x1fc)});let _0x11ae51=_0x24003f(0x1a2);const _0x1bbae6=_0x5dee00[_0x24003f(0x171)][_0x24003f(0x20f)];if(_0x5dee00[_0x24003f(0x227)]&&_0x1bbae6>=(_0x5dee00[_0x24003f(0x2c7)][_0x24003f(0x29b)]||0x7)){const _0x4fb55c=_0x5dee00['dailyDigests'][_0x24003f(0x1b0)](-(_0x5dee00[_0x24003f(0x2c7)][_0x24003f(0x1e8)]||0xe));_0x11ae51=_0x24003f(0x2ad)+JSON[_0x24003f(0x1b3)](_0x4fb55c)+'.';if(_0x1bbae6>=0x1e)_0x11ae51+=_0x24003f(0x2cb);}const _0x1b2f90=_0x24003f(0x259)+_0x1b51f5+_0x24003f(0x193)+_0xdcd5b,_0x1a9e41=_0x24003f(0x1a6),_0x1c30fe=_0x24003f(0x1aa)+_0x1b51f5+'.\x20MODUS:\x20'+_0x50a10c+_0x24003f(0x217)+(_0x5dee00[_0x24003f(0x168)]?'Ja':_0x24003f(0x1c4))+_0x24003f(0x243)+_0x47face+_0x24003f(0x28c)+_0x22db2b+'.\x20'+_0x11ae51+'\x20'+(_0x481ef3?_0x481ef3:'')+'\x20'+_0x1b2f90+'\x20'+_0x1a9e41+'\x20EVENTS:\x20'+JSON['stringify'](_0xdcebf)+'\x20SCHEMA:\x20{\x20\x22activity\x22:\x20{\x20\x22summary\x22:\x20\x22string\x22,\x20\x22deviationFromBaseline\x22:\x20\x22string\x22,\x20\x22isAlert\x22:\x20bool,\x20\x22isEmergency\x22:\x20bool,\x20\x22alertReason\x22:\x20\x22string\x22\x20},\x20\x22comfort\x22:\x20{\x20\x22automationProposal\x22:\x20{\x20\x22patternDetected\x22:\x20bool,\x20\x22description\x22:\x20\x22string\x22,\x20\x22execution\x22:\x20{\x20\x22targetId\x22:\x20\x22string|null\x22,\x20\x22targetValue\x22:\x20\x22boolean|number|null\x22\x20}\x20}\x20},\x20\x22health\x22:\x20{\x20\x22sleepScore\x22:\x20number\x20(0-100),\x20\x22restlessness\x22:\x20\x22string\x22,\x20\x22notes\x22:\x20\x22string\x22\x20}\x20}';try{const _0x4341ef=await _0x5dee00['geminiModel'][_0x24003f(0x2bd)](_0x1c30fe),_0x59f8a6=_0x4341ef[_0x24003f(0x26c)][_0x24003f(0x231)]()[_0x24003f(0x272)](/```json|```/g,'')[_0x24003f(0x1c8)](),_0x45d231=JSON[_0x24003f(0x291)](_0x59f8a6);await _0x5dee00[_0x24003f(0x27c)]('analysis.lastResult',{'val':_0x59f8a6,'ack':!![]}),await _0x5dee00[_0x24003f(0x27c)](_0x24003f(0x281),{'val':_0x45d231[_0x24003f(0x266)][_0x24003f(0x253)]||'','ack':!![]}),await _0x5dee00[_0x24003f(0x27c)](_0x24003f(0x1f8),{'val':_0x45d231[_0x24003f(0x266)][_0x24003f(0x2a6)]||_0x24003f(0x25b),'ack':!![]});const _0x2ef847=_0x45d231[_0x24003f(0x1cb)]?.['automationProposal'];if(_0x5dee00[_0x24003f(0x227)]&&_0x2ef847){const _0x5587ff=_0x2ef847[_0x24003f(0x172)]||![];await _0x5dee00[_0x24003f(0x27c)](_0x24003f(0x173),{'val':_0x5587ff,'ack':!![]}),await _0x5dee00[_0x24003f(0x27c)](_0x24003f(0x269),{'val':_0x5587ff?_0x2ef847[_0x24003f(0x1b5)]:'Keine\x20neuen\x20Automatisierungs-Muster\x20erkannt.','ack':!![]});if(_0x5587ff&&_0x2ef847[_0x24003f(0x2f0)]&&_0x2ef847[_0x24003f(0x2f0)][_0x24003f(0x24d)]){await _0x5dee00[_0x24003f(0x27c)](_0x24003f(0x1d6),{'val':_0x2ef847[_0x24003f(0x2f0)][_0x24003f(0x24d)],'ack':!![]}),await _0x5dee00[_0x24003f(0x27c)](_0x24003f(0x290),{'val':JSON[_0x24003f(0x1b3)](_0x2ef847[_0x24003f(0x2f0)][_0x24003f(0x17a)]),'ack':!![]});const _0x2221cc=await _0x5dee00['getStateAsync'](_0x24003f(0x211));_0x2221cc&&_0x2221cc['val']&&(_0x5dee00[_0x24003f(0x251)]['info'](_0x24003f(0x222)+_0x2ef847['execution'][_0x24003f(0x24d)]+_0x24003f(0x298)+_0x2ef847[_0x24003f(0x2f0)][_0x24003f(0x17a)]),executeAutomationAction(_0x5dee00));}else await _0x5dee00['setStateAsync'](_0x24003f(0x1d6),{'val':'','ack':!![]}),await _0x5dee00['setStateAsync']('analysis.automation.targetValue',{'val':'','ack':!![]});}if(_0x45d231[_0x24003f(0x266)][_0x24003f(0x24b)]||_0x45d231[_0x24003f(0x266)][_0x24003f(0x202)]){await _0x5dee00[_0x24003f(0x27c)]('analysis.isAlert',{'val':!![],'ack':!![]});if(!_0x5dee00['lastAlertState']||_0x45d231[_0x24003f(0x266)][_0x24003f(0x202)]){const _0x4ccafb=_0x45d231[_0x24003f(0x266)]['isEmergency']?'ðŸš¨ðŸš¨\x20NOTFALL':_0x24003f(0x22a);sendNotification(_0x5dee00,_0x4ccafb+':\x20'+_0x45d231[_0x24003f(0x266)]['alertReason'],![],_0x45d231[_0x24003f(0x266)][_0x24003f(0x202)]);}}else await _0x5dee00[_0x24003f(0x27c)](_0x24003f(0x254),{'val':![],'ack':!![]});_0x5dee00['lastAlertState']=_0x45d231[_0x24003f(0x266)][_0x24003f(0x24b)]||_0x45d231['activity']['isEmergency'],updateAnalysisHistory(_0x5dee00,{'timestamp':Date[_0x24003f(0x213)](),'id':Date['now']()[_0x24003f(0x1a0)](),'analysis':_0x45d231,'systemMode':_0x50a10c,'isPro':_0x5dee00[_0x24003f(0x227)]});}catch(_0x48a0cd){_0x5dee00[_0x24003f(0x251)]['error']('Analysis\x20Error:\x20'+_0x48a0cd[_0x24003f(0x26f)]);}}async function executeAutomationAction(_0x73f5db){const _0x44ca4b=a0_0x34930b;try{const _0x17e447=await _0x73f5db['getStateAsync']('analysis.automation.targetId'),_0x5721f3=await _0x73f5db['getStateAsync'](_0x44ca4b(0x290));if(_0x17e447&&_0x17e447[_0x44ca4b(0x1b1)]&&_0x5721f3){const _0x2df45e=_0x17e447[_0x44ca4b(0x1b1)];let _0x485c90=_0x5721f3[_0x44ca4b(0x1b1)];try{_0x485c90=JSON[_0x44ca4b(0x291)](_0x485c90);}catch(_0x5f2223){}_0x73f5db[_0x44ca4b(0x251)][_0x44ca4b(0x1fa)]('ðŸ¤–\x20BUTLER:\x20Executing\x20Action\x20->\x20'+_0x2df45e+_0x44ca4b(0x298)+_0x485c90),await _0x73f5db[_0x44ca4b(0x19e)](_0x2df45e,_0x485c90);}else _0x73f5db[_0x44ca4b(0x251)]['warn'](_0x44ca4b(0x28d));}catch(_0x1b2884){_0x73f5db[_0x44ca4b(0x251)][_0x44ca4b(0x178)](_0x44ca4b(0x287)+_0x1b2884[_0x44ca4b(0x26f)]);}}async function runAutopilot(_0x27bed0){const _0x3e52e1=a0_0x34930b,_0x362fab=_0x27bed0[_0x3e52e1(0x2c7)]['inactivityThresholdHours'],_0x4e6524=_0x27bed0[_0x3e52e1(0x27b)][_0x3e52e1(0x20f)]>0x0?_0x27bed0[_0x3e52e1(0x27b)][0x0][_0x3e52e1(0x17e)]:Date['now'](),_0x430f7e=(Date[_0x3e52e1(0x213)]()-_0x4e6524)/(0x3e8*0x3c*0x3c);let _0x1f7d78='';_0x27bed0['config'][_0x3e52e1(0x1b6)]&&_0x27bed0['currentSystemMode']===SYSTEM_MODES[_0x3e52e1(0x20c)]&&_0x27bed0[_0x3e52e1(0x168)]&&(_0x430f7e>_0x362fab&&(_0x1f7d78=_0x3e52e1(0x18e)+_0x430f7e['toFixed'](0x1)+'\x20hours.\x20Potential\x20incapacitation.')),runGeminiAnalysis(_0x27bed0,_0x1f7d78)[_0x3e52e1(0x25c)](_0x636118=>_0x27bed0[_0x3e52e1(0x251)][_0x3e52e1(0x178)](_0x636118));}async function createDailyDigest(_0x3e68d2){const _0x5a6ed9=a0_0x34930b;if(!_0x3e68d2['isProVersion'])return;await _0x3e68d2['setStateAsync'](LTM_DP_STATUS,{'val':'Started\x20at\x20'+new Date()[_0x5a6ed9(0x258)](),'ack':!![]});if(!_0x3e68d2['geminiModel']||_0x3e68d2[_0x5a6ed9(0x2d9)]['length']<LTM_MIN_EVENTS_FOR_COMPRESSION){await _0x3e68d2[_0x5a6ed9(0x27c)](LTM_DP_STATUS,{'val':_0x5a6ed9(0x260),'ack':!![]});return;}const _0x3c9d62=JSON['parse'](JSON[_0x5a6ed9(0x1b3)](_0x3e68d2[_0x5a6ed9(0x2d9)])),_0x1e39b3=_0x3c9d62[_0x5a6ed9(0x20f)],_0x24ce91='ROLLE:\x20Data\x20Compression\x20Agent.\x20SPRACHE:\x20DE.\x20FORMAT:\x20JSON.\x20ANWEISUNG:\x20Fasse\x20Sensor-Events\x20zusammen.\x20SCHEMA:\x20{\x20\x22summary\x22:\x20\x22string\x22,\x20\x22activityLevel\x22:\x20\x22string\x22\x20}\x20\x0a\x0aEVENTS:\x0a'+JSON[_0x5a6ed9(0x1b3)](_0x3c9d62);try{const _0x4a5d94=await _0x3e68d2['geminiModel']['generateContent'](_0x24ce91),_0x4e7e2d=JSON[_0x5a6ed9(0x291)](_0x4a5d94['response']['text']()[_0x5a6ed9(0x272)](/```json|```/g,'')[_0x5a6ed9(0x1c8)]());_0x4e7e2d[_0x5a6ed9(0x2a6)]&&(_0x3e68d2[_0x5a6ed9(0x171)]['push']({'timestamp':new Date()[_0x5a6ed9(0x20d)](),'eventCount':_0x1e39b3,'summary':_0x4e7e2d[_0x5a6ed9(0x2a6)],'activityLevel':_0x4e7e2d[_0x5a6ed9(0x2a9)],'systemMode':_0x3e68d2[_0x5a6ed9(0x2bf)]}),await saveDailyDigests(_0x3e68d2),_0x3e68d2[_0x5a6ed9(0x2d9)]=[],await saveRawEventLog(_0x3e68d2),await _0x3e68d2[_0x5a6ed9(0x27c)](LTM_DP_STATUS,{'val':_0x5a6ed9(0x1a4)+_0x1e39b3+'\x20events','ack':!![]}));}catch(_0x1de7f7){await _0x3e68d2[_0x5a6ed9(0x27c)](LTM_DP_STATUS,{'val':_0x5a6ed9(0x2e7)+_0x1de7f7[_0x5a6ed9(0x26f)],'ack':!![]});}}async function sendMorningBriefing(_0x584e62){const _0xea5718=a0_0x34930b;if(!_0x584e62[_0xea5718(0x25f)])return;_0x584e62[_0xea5718(0x251)][_0xea5718(0x1fa)](_0xea5718(0x299));const _0x4b9cc5=_0x584e62[_0xea5718(0x171)][_0xea5718(0x20f)]>0x0?_0x584e62[_0xea5718(0x171)][_0x584e62[_0xea5718(0x171)][_0xea5718(0x20f)]-0x1]:null,_0x1e83a8=_0x4b9cc5&&_0x4b9cc5[_0xea5718(0x1a3)]?_0x4b9cc5[_0xea5718(0x1a3)][_0xea5718(0x190)]:'N/A',_0x2644c7=new Date();_0x2644c7['setHours'](0x4,0x0,0x0,0x0);const _0x176bac=_0x584e62['eventHistory'][_0xea5718(0x2de)](_0x225d7e=>new Date(_0x225d7e[_0xea5718(0x17e)])>_0x2644c7),_0x368e8a=PERSONA_MAPPING[_0x584e62[_0xea5718(0x2c7)]['aiPersona']||_0xea5718(0x1cf)],_0x43af45=_0x584e62[_0xea5718(0x2c7)][_0xea5718(0x237)]||'',_0x34f555=await getWeatherContext(_0x584e62),_0x19d60e=await getCalendarContext(_0x584e62),_0x140b04=_0xea5718(0x296)+_0x368e8a+_0xea5718(0x243)+_0x43af45+_0xea5718(0x284)+_0x34f555+'\x20'+_0x19d60e+'.\x20DATEN:\x20Schlaf\x20'+_0x1e83a8+_0xea5718(0x2af)+JSON[_0xea5718(0x1b3)](_0x176bac['slice'](0x0,0xa))+'.\x20OUTPUT:\x20Nur\x20Text.';try{const _0x4f19bd=await _0x584e62['geminiModel'][_0xea5718(0x2bd)](_0x140b04),_0x4c7fc8=_0xea5718(0x246)+_0x4f19bd[_0xea5718(0x26c)][_0xea5718(0x231)]()[_0xea5718(0x1c8)]();sendNotification(_0x584e62,_0x4c7fc8),_0x584e62[_0xea5718(0x251)][_0xea5718(0x1fa)](_0xea5718(0x1c6));}catch(_0x46ae81){_0x584e62[_0xea5718(0x251)][_0xea5718(0x178)]('Briefing\x20Error:\x20'+_0x46ae81[_0xea5718(0x26f)]);}}if(require['main']!==module)module['exports']=_0xfeb637=>new CogniLiving(_0xfeb637);else new CogniLiving();