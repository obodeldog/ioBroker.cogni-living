const a0_0x377f18=a0_0x5170;(function(_0x14fb1b,_0x1a9b02){const _0x40fc78=a0_0x5170,_0x188206=_0x14fb1b();while(!![]){try{const _0x59f359=parseInt(_0x40fc78(0x2ce))/0x1+parseInt(_0x40fc78(0x345))/0x2*(parseInt(_0x40fc78(0x25d))/0x3)+-parseInt(_0x40fc78(0x35d))/0x4+parseInt(_0x40fc78(0x2b0))/0x5+parseInt(_0x40fc78(0x359))/0x6+parseInt(_0x40fc78(0x225))/0x7+-parseInt(_0x40fc78(0x2f7))/0x8;if(_0x59f359===_0x1a9b02)break;else _0x188206['push'](_0x188206['shift']());}catch(_0x4d1223){_0x188206['push'](_0x188206['shift']());}}}(a0_0x2ea0,0x255e4));const a0_0x15de8c=(function(){let _0x14f3aa=!![];return function(_0x4971b4,_0x176e55){const _0x5a6fd2=_0x14f3aa?function(){const _0x2dd89f=a0_0x5170;if(_0x176e55){const _0xd88b0f=_0x176e55[_0x2dd89f(0x363)](_0x4971b4,arguments);return _0x176e55=null,_0xd88b0f;}}:function(){};return _0x14f3aa=![],_0x5a6fd2;};}()),a0_0x29868d=a0_0x15de8c(this,function(){const _0x28224c=a0_0x5170;return a0_0x29868d[_0x28224c(0x223)]()[_0x28224c(0x349)](_0x28224c(0x33c))['toString']()[_0x28224c(0x2e5)](a0_0x29868d)['search'](_0x28224c(0x33c));});a0_0x29868d();'use strict';const utils=require(a0_0x377f18(0x205)),{GoogleGenerativeAI}=require(a0_0x377f18(0x1ed)),schedule=require(a0_0x377f18(0x294)),HISTORY_MAX_SIZE=0x32,RAW_LOG_MAX_SIZE=0x5dc,LTM_MIN_EVENTS_FOR_COMPRESSION=0x5,GEMINI_MODEL=a0_0x377f18(0x314),LTM_SCHEDULE=a0_0x377f18(0x22e),MODE_RESET_SCHEDULE='0\x204\x20*\x20*\x20*',ANALYSIS_HISTORY_MAX_SIZE=0x64,LTM_DP_RAW_LOG=a0_0x377f18(0x32e),LTM_DP_DAILY_DIGESTS='LTM.dailyDigests',LTM_DP_STATUS='LTM.processingStatus',LTM_DP_TRIGGER_DIGEST='LTM.triggerDailyDigest',LTM_DP_BASELINE_STATUS=a0_0x377f18(0x33b),LTM_DP_DRIFT_CHANNEL=a0_0x377f18(0x2d5),LTM_DP_DRIFT_STATUS='LTM.driftAnalysis.baselineDrift',LTM_DP_DRIFT_DETAILS='LTM.driftAnalysis.driftDetails',LTM_DP_DRIFT_LAST_CHECK=a0_0x377f18(0x201),SYSTEM_DP_MODE='system.mode',HARD_IGNORE_TERMS=[a0_0x377f18(0x34c),a0_0x377f18(0x286),a0_0x377f18(0x20b),'unreach',a0_0x377f18(0x1f6),a0_0x377f18(0x265),a0_0x377f18(0x239),a0_0x377f18(0x200),a0_0x377f18(0x2a9),a0_0x377f18(0x2c6),'working',a0_0x377f18(0x360),'stick_unreach','config_pending',a0_0x377f18(0x1f4),a0_0x377f18(0x219),'reachable','link_quality'],BAD_NAMES=[a0_0x377f18(0x2bc),'currentposition',a0_0x377f18(0x288),a0_0x377f18(0x29a),a0_0x377f18(0x307),'brightness','on',a0_0x377f18(0x327),a0_0x377f18(0x204),a0_0x377f18(0x289),a0_0x377f18(0x1e4),a0_0x377f18(0x347),a0_0x377f18(0x2f4),'status',a0_0x377f18(0x22c),a0_0x377f18(0x249),a0_0x377f18(0x328),a0_0x377f18(0x2ea),a0_0x377f18(0x2d1),a0_0x377f18(0x217),a0_0x377f18(0x230),'setpoint',a0_0x377f18(0x372),'actual_temperature',a0_0x377f18(0x2e9)],ADAPTER_BLACKLIST=['system.',a0_0x377f18(0x2da),'info.',a0_0x377f18(0x338),a0_0x377f18(0x2dd),a0_0x377f18(0x252),a0_0x377f18(0x36a),a0_0x377f18(0x280),a0_0x377f18(0x2d0),'javascript.',a0_0x377f18(0x210)],SYSTEM_MODES={'NORMAL':'normal','VACATION':'vacation','PARTY':'party','GUEST':a0_0x377f18(0x2a5)},AUTO_RESET_MODES=[SYSTEM_MODES['PARTY'],SYSTEM_MODES['GUEST']],PERSONA_MAPPING={'generic':a0_0x377f18(0x23c),'senior_aal':a0_0x377f18(0x21d),'family':a0_0x377f18(0x1e3),'single_comfort':a0_0x377f18(0x35f),'security':'PRIORITÃ„T:\x20Sicherheit.\x20Erkenne\x20Eindringlinge,\x20ungewÃ¶hnliche\x20Anwesenheit.'};class CogniLiving extends utils[a0_0x377f18(0x1fc)]{constructor(_0x7431d7){const _0x15d089=a0_0x377f18;super({..._0x7431d7,'name':_0x15d089(0x29d)}),this[_0x15d089(0x2fa)]=[],this[_0x15d089(0x323)]=[],this[_0x15d089(0x32b)]=[],this['rawEventLog']=[],this[_0x15d089(0x2c3)]=[],this[_0x15d089(0x35b)]={},this['systemConfig']={'latitude':0x0,'longitude':0x0,'city':''},this[_0x15d089(0x31b)]=!![],this[_0x15d089(0x1fa)]=null,this[_0x15d089(0x2c0)]=null,this[_0x15d089(0x1ea)]=![],this['genAI']=null,this[_0x15d089(0x27a)]=null,this[_0x15d089(0x24b)]=SYSTEM_MODES[_0x15d089(0x35a)],this[_0x15d089(0x364)]=![],this[_0x15d089(0x333)]=![],this['systemUUID']=_0x15d089(0x21e),this[_0x15d089(0x1f2)]=null,this['ltmJob']=null,this[_0x15d089(0x367)]=null,this['driftAnalysisTimer']=null,this[_0x15d089(0x2bd)]=null,this['on']('ready',this[_0x15d089(0x302)][_0x15d089(0x2c8)](this)),this['on'](_0x15d089(0x272),this[_0x15d089(0x2b3)][_0x15d089(0x2c8)](this)),this['on']('unload',this[_0x15d089(0x31d)][_0x15d089(0x2c8)](this)),this['on'](_0x15d089(0x2e2),this[_0x15d089(0x351)][_0x15d089(0x2c8)](this));}async[a0_0x377f18(0x302)](){const _0x39241d=a0_0x377f18;this[_0x39241d(0x2f0)][_0x39241d(0x2ec)](_0x39241d(0x316)+this[_0x39241d(0x2d3)]+_0x39241d(0x2df)),await initZombies(this),this[_0x39241d(0x2fd)][_0x39241d(0x20e)]=this['config'][_0x39241d(0x20e)]||'';try{this[_0x39241d(0x364)]=await checkLicense(this,this[_0x39241d(0x2fd)][_0x39241d(0x20e)]);}catch(_0x39891e){}if(!this[_0x39241d(0x2fd)]['inactivityThresholdHours']||this['config'][_0x39241d(0x320)]<0.1)this['config']['inactivityThresholdHours']=0xc;await initHistory(this),await initSystemConfig(this);if(this['config']['geminiApiKey'])try{this[_0x39241d(0x32a)]=new GoogleGenerativeAI(this['config'][_0x39241d(0x202)]),this['geminiModel']=this[_0x39241d(0x32a)]['getGenerativeModel']({'model':GEMINI_MODEL,'generationConfig':{'responseMimeType':_0x39241d(0x2b4)}}),this[_0x39241d(0x2f0)][_0x39241d(0x2ec)](_0x39241d(0x2b6));}catch(_0x59b8f3){this['log']['error']('Gemini\x20Init\x20Error:\x20'+_0x59b8f3[_0x39241d(0x2e2)]);}await createAllObjects(this),await loadSystemMode(this),await loadRawEventLog(this),await loadDailyDigests(this),this[_0x39241d(0x310)](_0x39241d(0x25e)),this['subscribeStates'](LTM_DP_TRIGGER_DIGEST),this[_0x39241d(0x310)](_0x39241d(0x1f8)),this['subscribeStates']('analysis.triggerBriefing'),this[_0x39241d(0x310)](_0x39241d(0x2be)),this['subscribeStates'](_0x39241d(0x241)),await initSensorSubscriptions(this),await initPresenceSubscriptions(this),await setupTelegramListener(this);if(this[_0x39241d(0x1f2)])clearInterval(this['analysisTimer']);const _0x876f1b=this[_0x39241d(0x2fd)][_0x39241d(0x224)]||0xf;_0x876f1b>0x0&&(this['log']['info'](_0x39241d(0x299)+_0x876f1b+_0x39241d(0x36d)),this[_0x39241d(0x1f2)]=setInterval(()=>{runAutopilot(this);},_0x876f1b*0x3c*0x3e8)),setupLtmScheduler(this),setupModeResetScheduler(this),setupDriftAnalysisScheduler(this),setupBriefingScheduler(this);}[a0_0x377f18(0x31d)](_0x49d543){const _0x53f9da=a0_0x377f18;if(this[_0x53f9da(0x1f2)])clearInterval(this[_0x53f9da(0x1f2)]);if(this[_0x53f9da(0x26d)])clearInterval(this[_0x53f9da(0x26d)]);if(this[_0x53f9da(0x2e6)])this[_0x53f9da(0x2e6)][_0x53f9da(0x228)]();if(this[_0x53f9da(0x367)])this['modeResetJob'][_0x53f9da(0x228)]();if(this[_0x53f9da(0x2bd)])this[_0x53f9da(0x2bd)]['cancel']();if(this[_0x53f9da(0x1fa)])clearTimeout(this[_0x53f9da(0x1fa)]);if(this[_0x53f9da(0x2c0)])clearTimeout(this[_0x53f9da(0x2c0)]);_0x49d543();}async['onStateChange'](_0x41d342,_0x54addf){const _0xc691e1=a0_0x377f18;if(!_0x54addf)return;if(_0x41d342['includes']('telegram')&&_0x41d342[_0xc691e1(0x2f5)](_0xc691e1(0x277))&&_0x54addf[_0xc691e1(0x361)]){await handleTelegramResponse(this,_0x54addf[_0xc691e1(0x361)]);return;}if(_0x41d342===this[_0xc691e1(0x220)]+'.'+SYSTEM_DP_MODE){_0x54addf[_0xc691e1(0x361)]&&Object[_0xc691e1(0x1ef)](SYSTEM_MODES)['includes'](_0x54addf['val'])&&(this[_0xc691e1(0x24b)]=_0x54addf[_0xc691e1(0x361)],_0x54addf[_0xc691e1(0x361)]===SYSTEM_MODES[_0xc691e1(0x2aa)]?await setPresence(this,![]):await setPresence(this,!![]));if(!_0x54addf[_0xc691e1(0x1e8)])this[_0xc691e1(0x366)](_0x41d342,{'val':this[_0xc691e1(0x24b)],'ack':!![]});return;}if(!_0x54addf[_0xc691e1(0x1e8)]){_0x41d342['includes'](_0xc691e1(0x25e))&&_0x54addf['val']&&(this[_0xc691e1(0x366)](_0x41d342,{'val':![],'ack':!![]}),runGeminiAnalysis(this));if(_0x41d342['includes'](_0xc691e1(0x274))&&_0x54addf[_0xc691e1(0x361)]){this[_0xc691e1(0x366)](_0x41d342,{'val':![],'ack':!![]});if(this[_0xc691e1(0x364)])createDailyDigest(this);}_0x41d342[_0xc691e1(0x290)](_0xc691e1(0x2f6))&&_0x54addf[_0xc691e1(0x361)]&&(this[_0xc691e1(0x366)](_0x41d342,{'val':![],'ack':!![]}),sendMorningBriefing(this));_0x41d342[_0xc691e1(0x290)](_0xc691e1(0x24c))&&_0x54addf[_0xc691e1(0x361)]&&(this[_0xc691e1(0x366)](_0x41d342,{'val':![],'ack':!![]}),executeAutomationAction(this));return;}if(this[_0xc691e1(0x2fd)]['presenceDevices']&&this[_0xc691e1(0x2fd)]['presenceDevices'][_0xc691e1(0x290)](_0x41d342)){await checkWifiPresence(this);return;}const _0x1ad89d=(this[_0xc691e1(0x2fd)][_0xc691e1(0x26f)]||[])[_0xc691e1(0x2b2)](_0x54f20b=>_0x54f20b['id']===_0x41d342);if(_0x1ad89d)processSensorEvent(this,_0x41d342,_0x54addf,_0x1ad89d);}async[a0_0x377f18(0x351)](_0x4247f3){const _0x1e2199=a0_0x377f18;if(typeof _0x4247f3===_0x1e2199(0x2e3)&&_0x4247f3['message'])try{if(_0x4247f3[_0x1e2199(0x318)]===_0x1e2199(0x27b)){if(!_0x4247f3[_0x1e2199(0x2e2)][_0x1e2199(0x337)])return this['sendTo'](_0x4247f3[_0x1e2199(0x1ec)],_0x4247f3[_0x1e2199(0x318)],{'success':![],'message':_0x1e2199(0x2ca)},_0x4247f3[_0x1e2199(0x2b5)]);try{const _0x5ba2b1=new GoogleGenerativeAI(_0x4247f3['message'][_0x1e2199(0x337)])[_0x1e2199(0x303)]({'model':_0x1e2199(0x314)});await _0x5ba2b1[_0x1e2199(0x240)](_0x1e2199(0x1e1)),this['sendTo'](_0x4247f3[_0x1e2199(0x1ec)],_0x4247f3[_0x1e2199(0x318)],{'success':!![],'message':'Success'},_0x4247f3[_0x1e2199(0x2b5)]);}catch(_0x4ba737){this['sendTo'](_0x4247f3[_0x1e2199(0x1ec)],_0x4247f3[_0x1e2199(0x318)],{'success':![],'message':_0x4ba737[_0x1e2199(0x2e2)]},_0x4247f3[_0x1e2199(0x2b5)]);}}else{if(_0x4247f3[_0x1e2199(0x318)]==='testNotification'){const _0x5b71c5=await sendNotification(this,_0x1e2199(0x2ac),!![],!![]);this[_0x1e2199(0x368)](_0x4247f3[_0x1e2199(0x1ec)],_0x4247f3[_0x1e2199(0x318)],{'success':_0x5b71c5>0x0,'message':_0x5b71c5+_0x1e2199(0x1f7)},_0x4247f3[_0x1e2199(0x2b5)]);}else{if(_0x4247f3[_0x1e2199(0x318)]==='getLtmData'){if(!this['isProVersion'])return this['sendTo'](_0x4247f3['from'],_0x4247f3[_0x1e2199(0x318)],{'success':![],'isPro':![]},_0x4247f3['callback']);let _0xe978d3={'status':_0x1e2199(0x2bb),'details':'','lastCheck':0x0};try{_0xe978d3['status']=(await this[_0x1e2199(0x34a)](LTM_DP_DRIFT_STATUS))[_0x1e2199(0x361)],_0xe978d3[_0x1e2199(0x30c)]=(await this['getStateAsync'](LTM_DP_DRIFT_DETAILS))[_0x1e2199(0x361)],_0xe978d3['lastCheck']=(await this[_0x1e2199(0x34a)](LTM_DP_DRIFT_LAST_CHECK))[_0x1e2199(0x361)];}catch(_0x47d460){}const _0x164f02=this[_0x1e2199(0x323)]||[];this['sendTo'](_0x4247f3[_0x1e2199(0x1ec)],_0x4247f3[_0x1e2199(0x318)],{'success':!![],'isPro':!![],'dailyDigests':this[_0x1e2199(0x2c3)],'driftAnalysis':_0xe978d3,'analysisHistory':_0x164f02},_0x4247f3[_0x1e2199(0x2b5)]);}else{if(_0x4247f3[_0x1e2199(0x318)]===_0x1e2199(0x352)){const _0x532b4c=this[_0x1e2199(0x2c3)][_0x1e2199(0x369)],_0x4e7833=this[_0x1e2199(0x2fa)][_0x1e2199(0x298)](_0x572ac7=>_0x572ac7[_0x1e2199(0x267)]>new Date()['setHours'](0x0,0x0,0x0,0x0))['length'];let _0x1e5a77={'status':_0x1e2199(0x2bb)};try{_0x1e5a77[_0x1e2199(0x20d)]=(await this['getStateAsync'](LTM_DP_DRIFT_STATUS))[_0x1e2199(0x361)];}catch(_0xb2a59d){}let _0x346ca4=null;!this['geminiModel']&&(_0x346ca4=this[_0x1e2199(0x2fd)][_0x1e2199(0x202)]?_0x1e2199(0x24d):_0x1e2199(0x1dd));let _0x540a78={'detected':![],'description':'','targetId':'','targetValue':'','autoApply':![]};try{const _0x584f4d=await this[_0x1e2199(0x34a)](_0x1e2199(0x222)),_0x5d8714=await this[_0x1e2199(0x34a)](_0x1e2199(0x23d)),_0x159126=await this[_0x1e2199(0x34a)](_0x1e2199(0x2f2)),_0xeca2ce=await this[_0x1e2199(0x34a)]('analysis.automation.targetValue'),_0x33da93=await this['getStateAsync'](_0x1e2199(0x241));_0x584f4d&&_0x584f4d[_0x1e2199(0x361)]&&(_0x540a78[_0x1e2199(0x273)]=!![],_0x540a78[_0x1e2199(0x331)]=_0x5d8714?_0x5d8714[_0x1e2199(0x361)]:'',_0x540a78[_0x1e2199(0x336)]=_0x159126?_0x159126[_0x1e2199(0x361)]:'',_0x540a78['targetValue']=_0xeca2ce?_0xeca2ce[_0x1e2199(0x361)]:''),_0x540a78[_0x1e2199(0x1e7)]=_0x33da93?!!_0x33da93['val']:![];}catch(_0x18acb1){}this[_0x1e2199(0x368)](_0x4247f3[_0x1e2199(0x1ec)],_0x4247f3[_0x1e2199(0x318)],{'success':!![],'eventHistory':this[_0x1e2199(0x2fa)][_0x1e2199(0x306)](0x0,0xf),'stats':{'digestCount':_0x532b4c,'eventCountToday':_0x4e7833,'driftStatus':_0x1e5a77[_0x1e2199(0x20d)],'isPresent':this[_0x1e2199(0x31b)],'minDays':this[_0x1e2199(0x2fd)][_0x1e2199(0x26e)]||0x7,'stbDays':this[_0x1e2199(0x2fd)]['ltmStbWindowDays']||0xe,'ltbDays':this[_0x1e2199(0x2fd)]['ltmLtbWindowDays']||0x3c,'systemError':_0x346ca4},'automation':_0x540a78},_0x4247f3['callback']);}else{if(_0x4247f3['command']===_0x1e2199(0x1eb)){const _0x3b8f21=await this[_0x1e2199(0x26b)]('enum.functions.*',_0x1e2199(0x300)),_0x560926=[];if(_0x3b8f21)for(const _0x356519 in _0x3b8f21){const _0x37cc84=_0x3b8f21[_0x356519],_0x133bb3=(_0x37cc84[_0x1e2199(0x24e)]&&typeof _0x37cc84[_0x1e2199(0x24e)]['name']==='object'?_0x37cc84[_0x1e2199(0x24e)]['name']['de']:_0x37cc84[_0x1e2199(0x24e)]['name'])||_0x37cc84[_0x1e2199(0x24e)][_0x1e2199(0x2cf)];_0x560926[_0x1e2199(0x2ab)]({'id':_0x356519,'name':_0x133bb3});}this[_0x1e2199(0x368)](_0x4247f3['from'],_0x4247f3['command'],{'success':!![],'enums':_0x560926},_0x4247f3[_0x1e2199(0x2b5)]);}else{if(_0x4247f3['command']==='scanDevices')try{const _0x14d0f3=await scanForDevices(this,_0x4247f3[_0x1e2199(0x2e2)]||{});this['sendTo'](_0x4247f3['from'],_0x4247f3[_0x1e2199(0x318)],{'success':!![],'devices':_0x14d0f3},_0x4247f3[_0x1e2199(0x2b5)]);}catch(_0x138e78){this[_0x1e2199(0x368)](_0x4247f3[_0x1e2199(0x1ec)],_0x4247f3[_0x1e2199(0x318)],{'success':![],'error':_0x138e78['message']},_0x4247f3[_0x1e2199(0x2b5)]);}else{if(_0x4247f3['command']===_0x1e2199(0x1f3)){const _0x4036d0=_0x4247f3[_0x1e2199(0x2e2)][_0x1e2199(0x30f)];if(!_0x4036d0)return this[_0x1e2199(0x368)](_0x4247f3[_0x1e2199(0x1ec)],_0x4247f3['command'],{'success':![],'error':'No\x20instance'},_0x4247f3[_0x1e2199(0x2b5)]);const _0x155149=await getCalendarNames(this,_0x4036d0);this[_0x1e2199(0x368)](_0x4247f3['from'],_0x4247f3[_0x1e2199(0x318)],{'success':!![],'names':_0x155149},_0x4247f3[_0x1e2199(0x2b5)]);}else{if(_0x4247f3[_0x1e2199(0x318)]===_0x1e2199(0x254)){const {historyId:_0x2169c6,rating:_0x3dbe7b,comment:_0xf9b548,alertReason:_0x130c9a}=_0x4247f3['message'];_0x2169c6&&_0x3dbe7b?(await saveFeedback(this,{'timestamp':Date[_0x1e2199(0x324)](),'historyId':_0x2169c6,'rating':_0x3dbe7b,'comment':_0xf9b548,'alertReason':_0x130c9a}),this['sendTo'](_0x4247f3[_0x1e2199(0x1ec)],_0x4247f3[_0x1e2199(0x318)],{'success':!![]},_0x4247f3['callback'])):this[_0x1e2199(0x368)](_0x4247f3[_0x1e2199(0x1ec)],_0x4247f3[_0x1e2199(0x318)],{'success':![],'error':_0x1e2199(0x22d)},_0x4247f3['callback']);}}}}}}}}}catch(_0x2cec37){this[_0x1e2199(0x2f0)][_0x1e2199(0x2a9)](_0x1e2199(0x244)+_0x4247f3['command']+':\x20'+_0x2cec37[_0x1e2199(0x2e2)]);if(_0x4247f3['callback'])this[_0x1e2199(0x368)](_0x4247f3[_0x1e2199(0x1ec)],_0x4247f3[_0x1e2199(0x318)],{'success':![],'error':_0x2cec37[_0x1e2199(0x2e2)]},_0x4247f3[_0x1e2199(0x2b5)]);}}}function a0_0x5170(_0x31ef4f,_0x568b26){const _0x7df7c0=a0_0x2ea0();return a0_0x5170=function(_0x29868d,_0x15de8c){_0x29868d=_0x29868d-0x1dd;let _0x2ea09e=_0x7df7c0[_0x29868d];return _0x2ea09e;},a0_0x5170(_0x31ef4f,_0x568b26);}async function initZombies(_0x234304){const _0x4bc1dc=a0_0x377f18;try{const _0x3cfc10=[_0x4bc1dc(0x242),_0x4bc1dc(0x32d)];for(const _0x3ca307 of _0x3cfc10){try{const _0x177a5d=await _0x234304[_0x4bc1dc(0x1fe)](_0x3ca307);_0x177a5d&&await _0x234304[_0x4bc1dc(0x2b9)](_0x3ca307);}catch(_0x247854){}}}catch(_0x4d59b6){}}async function initHistory(_0x4e9c69){const _0x56f48b=a0_0x377f18;try{const _0x4ad0ca=await _0x4e9c69[_0x56f48b(0x34a)](_0x56f48b(0x35c));_0x4ad0ca&&_0x4ad0ca[_0x56f48b(0x361)]&&(_0x4e9c69['eventHistory']=JSON[_0x56f48b(0x237)](_0x4ad0ca[_0x56f48b(0x361)][_0x56f48b(0x223)]()));}catch(_0x22c819){_0x4e9c69[_0x56f48b(0x2fa)]=[];}try{const _0x25f16c=await _0x4e9c69[_0x56f48b(0x34a)](_0x56f48b(0x21f));if(_0x25f16c&&_0x25f16c[_0x56f48b(0x361)])_0x4e9c69['analysisHistory']=JSON[_0x56f48b(0x237)](_0x25f16c[_0x56f48b(0x361)]['toString']());}catch(_0x200547){_0x4e9c69[_0x56f48b(0x323)]=[];}}async function initSystemConfig(_0xd5a73){const _0x27bc4c=a0_0x377f18;try{const _0x403e88=await _0xd5a73['getForeignObjectAsync'](_0x27bc4c(0x283));_0x403e88&&_0x403e88['common']&&(_0xd5a73[_0x27bc4c(0x258)]={'latitude':_0x403e88['common'][_0x27bc4c(0x29f)]||0x0,'longitude':_0x403e88['common'][_0x27bc4c(0x259)]||0x0,'city':_0x403e88['common'][_0x27bc4c(0x233)]||''});}catch(_0x1d2328){}}async function checkLicense(_0x5e2a25,_0x5a0a26){const _0x74e757=a0_0x377f18;if(!_0x5a0a26)return![];_0x5e2a25[_0x74e757(0x2de)]=await getSystemUUID(_0x5e2a25);if(_0x5a0a26==='TEST-PRO-KEY'||_0x5a0a26[_0x74e757(0x2e8)](_0x74e757(0x271)))return!![];return![];}async function getSystemUUID(_0x56f63c){const _0x2382ac=a0_0x377f18;try{const _0xc564e1=await _0x56f63c[_0x2382ac(0x226)](_0x2382ac(0x2e7));if(_0xc564e1&&_0xc564e1[_0x2382ac(0x24f)]&&_0xc564e1[_0x2382ac(0x24f)][_0x2382ac(0x1fb)])return _0xc564e1[_0x2382ac(0x24f)][_0x2382ac(0x1fb)];return _0x2382ac(0x27c);}catch(_0x416fee){return'uuid-error';}}async function createAllObjects(_0x56233c){const _0x5e6263=a0_0x377f18;await checkSystemObjects(_0x56233c),await _0x56233c[_0x5e6263(0x1e6)]('events.lastEvent',{'type':'state','common':{'name':'Last\x20raw\x20event','type':_0x5e6263(0x28a),'role':'json','read':!![],'write':![]},'native':{}}),await _0x56233c[_0x5e6263(0x1e6)](_0x5e6263(0x35c),{'type':_0x5e6263(0x288),'common':{'name':_0x5e6263(0x370),'type':_0x5e6263(0x28a),'role':_0x5e6263(0x24a),'read':!![],'write':![]},'native':{}}),await _0x56233c[_0x5e6263(0x1e6)](_0x5e6263(0x25e),{'type':_0x5e6263(0x288),'common':{'name':_0x5e6263(0x231),'type':_0x5e6263(0x229),'role':'button','read':!![],'write':!![],'def':![]},'native':{}}),await _0x56233c[_0x5e6263(0x1e6)](_0x5e6263(0x31a),{'type':_0x5e6263(0x288),'common':{'name':_0x5e6263(0x2ba),'type':_0x5e6263(0x229),'role':'button','read':!![],'write':!![],'def':![]},'native':{}}),await _0x56233c['setObjectNotExistsAsync'](_0x5e6263(0x319),{'type':_0x5e6263(0x288),'common':{'name':_0x5e6263(0x25f),'type':_0x5e6263(0x28a),'role':_0x5e6263(0x24a),'read':!![],'write':![]},'native':{}}),await _0x56233c[_0x5e6263(0x1e6)](_0x5e6263(0x1e9),{'type':_0x5e6263(0x288),'common':{'name':_0x5e6263(0x284),'type':_0x5e6263(0x229),'role':_0x5e6263(0x248),'read':!![],'write':![],'def':![]},'native':{}}),await _0x56233c[_0x5e6263(0x1e6)](_0x5e6263(0x264),{'type':_0x5e6263(0x288),'common':{'name':'AI\x20Emergency\x20Status','type':_0x5e6263(0x229),'role':'indicator.alarm.fire','read':!![],'write':![],'def':![]},'native':{}}),await _0x56233c[_0x5e6263(0x1e6)]('analysis.alertReason',{'type':_0x5e6263(0x288),'common':{'name':_0x5e6263(0x2f8),'type':_0x5e6263(0x28a),'role':_0x5e6263(0x308),'read':!![],'write':![]},'native':{}}),await _0x56233c[_0x5e6263(0x1e6)](_0x5e6263(0x285),{'type':_0x5e6263(0x288),'common':{'name':_0x5e6263(0x30e),'type':_0x5e6263(0x28a),'role':_0x5e6263(0x291),'read':!![],'write':![]},'native':{}}),await _0x56233c[_0x5e6263(0x1e6)](_0x5e6263(0x305),{'type':_0x5e6263(0x288),'common':{'name':_0x5e6263(0x255),'type':_0x5e6263(0x28a),'role':_0x5e6263(0x288),'read':!![],'write':![],'def':_0x5e6263(0x2bb)},'native':{}}),await _0x56233c['setObjectNotExistsAsync'](_0x5e6263(0x23e),{'type':_0x5e6263(0x288),'common':{'name':_0x5e6263(0x257),'type':_0x5e6263(0x28a),'role':_0x5e6263(0x291),'read':!![],'write':![]},'native':{}}),await _0x56233c[_0x5e6263(0x1e6)](_0x5e6263(0x2a3),{'type':_0x5e6263(0x288),'common':{'name':_0x5e6263(0x33a),'type':_0x5e6263(0x28a),'role':_0x5e6263(0x291),'read':!![],'write':![]},'native':{}}),await _0x56233c[_0x5e6263(0x356)](_0x5e6263(0x227),{'type':_0x5e6263(0x235),'common':{'name':_0x5e6263(0x1df)},'native':{}}),await _0x56233c['setObjectNotExistsAsync'](_0x5e6263(0x222),{'type':_0x5e6263(0x288),'common':{'name':'Pattern\x20Detected','type':_0x5e6263(0x229),'role':_0x5e6263(0x2d9),'read':!![],'write':![],'def':![]},'native':{}}),await _0x56233c[_0x5e6263(0x1e6)]('analysis.automation.description',{'type':_0x5e6263(0x288),'common':{'name':_0x5e6263(0x2ed),'type':'string','role':_0x5e6263(0x291),'read':!![],'write':![]},'native':{}}),await _0x56233c[_0x5e6263(0x1e6)]('analysis.automation.suggestedAction',{'type':'state','common':{'name':'Action','type':_0x5e6263(0x28a),'role':_0x5e6263(0x291),'read':!![],'write':![]},'native':{}}),await _0x56233c[_0x5e6263(0x1e6)](_0x5e6263(0x2f2),{'type':_0x5e6263(0x288),'common':{'name':_0x5e6263(0x22f),'type':'string','role':_0x5e6263(0x291),'read':!![],'write':![]},'native':{}}),await _0x56233c[_0x5e6263(0x1e6)](_0x5e6263(0x36b),{'type':_0x5e6263(0x288),'common':{'name':_0x5e6263(0x1f1),'type':'string','role':_0x5e6263(0x291),'read':!![],'write':![]},'native':{}}),await _0x56233c[_0x5e6263(0x1e6)](_0x5e6263(0x241),{'type':'state','common':{'name':_0x5e6263(0x2dc),'type':_0x5e6263(0x229),'role':'switch','read':!![],'write':!![],'def':![]},'native':{}}),await _0x56233c[_0x5e6263(0x1e6)]('analysis.automation.triggerAction',{'type':_0x5e6263(0x288),'common':{'name':_0x5e6263(0x251),'type':'boolean','role':'button','read':!![],'write':!![],'def':![]},'native':{}}),await _0x56233c[_0x5e6263(0x1e6)](_0x5e6263(0x21f),{'type':_0x5e6263(0x288),'common':{'name':'Logbook','type':'string','role':_0x5e6263(0x24a),'read':!![],'write':![],'def':'[]'},'native':{}}),await _0x56233c['setObjectNotExistsAsync'](_0x5e6263(0x325),{'type':_0x5e6263(0x288),'common':{'name':_0x5e6263(0x232),'type':_0x5e6263(0x28a),'role':'json','read':!![],'write':![],'def':'[]'},'native':{}}),await _0x56233c[_0x5e6263(0x356)](_0x5e6263(0x332),{'type':'channel','common':{'name':_0x5e6263(0x315)},'native':{}}),await _0x56233c['setObjectNotExistsAsync']('analysis.health.sleepScore',{'type':_0x5e6263(0x288),'common':{'name':_0x5e6263(0x301),'type':_0x5e6263(0x321),'role':_0x5e6263(0x2e4),'read':!![],'write':![],'def':0x0},'native':{}}),await _0x56233c['setObjectNotExistsAsync']('analysis.health.restlessness',{'type':_0x5e6263(0x288),'common':{'name':_0x5e6263(0x256),'type':_0x5e6263(0x28a),'role':'text','read':!![],'write':![],'def':_0x5e6263(0x2a0)},'native':{}}),await _0x56233c['setObjectNotExistsAsync']('analysis.health.notes',{'type':_0x5e6263(0x288),'common':{'name':_0x5e6263(0x246),'type':'string','role':'text','read':!![],'write':![],'def':''},'native':{}}),await checkLtmObjects(_0x56233c),await checkLtmDriftObjects(_0x56233c);}async function checkSystemObjects(_0x4b95c2){const _0x45315c=a0_0x377f18;await _0x4b95c2[_0x45315c(0x356)]('system',{'type':_0x45315c(0x235),'common':{'name':_0x45315c(0x28c)},'native':{}}),await _0x4b95c2[_0x45315c(0x356)](SYSTEM_DP_MODE,{'type':_0x45315c(0x288),'common':{'name':_0x45315c(0x28f),'type':_0x45315c(0x28a),'role':_0x45315c(0x288),'read':!![],'write':!![],'def':SYSTEM_MODES[_0x45315c(0x35a)],'states':{[SYSTEM_MODES[_0x45315c(0x35a)]]:'Normal',[SYSTEM_MODES[_0x45315c(0x2aa)]]:_0x45315c(0x1e2),[SYSTEM_MODES[_0x45315c(0x34d)]]:'Party',[SYSTEM_MODES[_0x45315c(0x346)]]:_0x45315c(0x2c5)}},'native':{}});}async function checkLtmObjects(_0x3bcfc1){const _0x27ed1a=a0_0x377f18;await _0x3bcfc1[_0x27ed1a(0x356)](_0x27ed1a(0x2f3),{'type':_0x27ed1a(0x235),'common':{'name':_0x27ed1a(0x2f3)},'native':{}}),await _0x3bcfc1[_0x27ed1a(0x356)](LTM_DP_RAW_LOG,{'type':'state','common':{'name':_0x27ed1a(0x33f),'type':'string','role':_0x27ed1a(0x24a),'read':!![],'write':![]},'native':{}}),await _0x3bcfc1[_0x27ed1a(0x356)](LTM_DP_DAILY_DIGESTS,{'type':_0x27ed1a(0x288),'common':{'name':'Daily\x20Digests','type':_0x27ed1a(0x28a),'role':'json','read':!![],'write':![]},'native':{}}),await _0x3bcfc1['extendObjectAsync'](LTM_DP_STATUS,{'type':_0x27ed1a(0x288),'common':{'name':_0x27ed1a(0x2fc),'type':_0x27ed1a(0x28a),'role':_0x27ed1a(0x291),'read':!![],'write':![]},'native':{}}),await _0x3bcfc1[_0x27ed1a(0x356)](LTM_DP_TRIGGER_DIGEST,{'type':_0x27ed1a(0x288),'common':{'name':_0x27ed1a(0x215),'type':_0x27ed1a(0x229),'role':_0x27ed1a(0x2d6),'read':!![],'write':!![],'def':![]},'native':{}}),await _0x3bcfc1[_0x27ed1a(0x356)](LTM_DP_BASELINE_STATUS,{'type':_0x27ed1a(0x288),'common':{'name':_0x27ed1a(0x20c),'type':_0x27ed1a(0x28a),'role':_0x27ed1a(0x291),'read':!![],'write':![]},'native':{}});}async function checkLtmDriftObjects(_0x3c6a6a){const _0x15a0af=a0_0x377f18;await _0x3c6a6a[_0x15a0af(0x356)](LTM_DP_DRIFT_CHANNEL,{'type':_0x15a0af(0x235),'common':{'name':_0x15a0af(0x326)},'native':{}}),await _0x3c6a6a['extendObjectAsync'](LTM_DP_DRIFT_STATUS,{'type':_0x15a0af(0x288),'common':{'name':'Drift\x20Status','type':'string','role':_0x15a0af(0x288),'read':!![],'write':![],'def':_0x15a0af(0x2bb)},'native':{}}),await _0x3c6a6a[_0x15a0af(0x356)](LTM_DP_DRIFT_DETAILS,{'type':_0x15a0af(0x288),'common':{'name':_0x15a0af(0x2d8),'type':_0x15a0af(0x28a),'role':_0x15a0af(0x291),'read':!![],'write':![]},'native':{}}),await _0x3c6a6a[_0x15a0af(0x356)](LTM_DP_DRIFT_LAST_CHECK,{'type':_0x15a0af(0x288),'common':{'name':_0x15a0af(0x221),'type':_0x15a0af(0x321),'role':_0x15a0af(0x1e5),'read':!![],'write':![]},'native':{}});}async function loadSystemMode(_0x1cc7d2){const _0x414276=a0_0x377f18;try{const _0x131ae3=await _0x1cc7d2['getStateAsync'](SYSTEM_DP_MODE);_0x131ae3&&_0x131ae3[_0x414276(0x361)]&&Object[_0x414276(0x1ef)](SYSTEM_MODES)[_0x414276(0x290)](_0x131ae3['val'])?_0x1cc7d2[_0x414276(0x24b)]=_0x131ae3[_0x414276(0x361)]:(_0x1cc7d2['currentSystemMode']=SYSTEM_MODES[_0x414276(0x35a)],await _0x1cc7d2[_0x414276(0x247)](SYSTEM_DP_MODE,{'val':SYSTEM_MODES['NORMAL'],'ack':!![]}));}catch(_0x37b6d0){_0x1cc7d2[_0x414276(0x24b)]=SYSTEM_MODES[_0x414276(0x35a)];}}async function loadRawEventLog(_0x1a1c28){const _0x15e0cc=a0_0x377f18;try{const _0x3ed5f8=await _0x1a1c28[_0x15e0cc(0x34a)](LTM_DP_RAW_LOG);if(_0x3ed5f8&&_0x3ed5f8[_0x15e0cc(0x361)])_0x1a1c28[_0x15e0cc(0x31e)]=JSON[_0x15e0cc(0x237)](_0x3ed5f8[_0x15e0cc(0x361)]);}catch(_0x2b6022){_0x1a1c28[_0x15e0cc(0x31e)]=[];}}async function loadDailyDigests(_0x1684ab){const _0x5622ef=a0_0x377f18;try{const _0x3594dd=await _0x1684ab[_0x5622ef(0x34a)](LTM_DP_DAILY_DIGESTS);if(_0x3594dd&&_0x3594dd[_0x5622ef(0x361)])_0x1684ab[_0x5622ef(0x2c3)]=JSON['parse'](_0x3594dd[_0x5622ef(0x361)]);}catch(_0x459604){_0x1684ab['dailyDigests']=[];}await updateBaselineStatus(_0x1684ab);}async function saveRawEventLog(_0x2ffad2){const _0x220bfa=a0_0x377f18;_0x2ffad2[_0x220bfa(0x31e)][_0x220bfa(0x369)]>RAW_LOG_MAX_SIZE&&_0x2ffad2[_0x220bfa(0x31e)][_0x220bfa(0x1ee)](0x0,_0x2ffad2[_0x220bfa(0x31e)][_0x220bfa(0x369)]-RAW_LOG_MAX_SIZE),await _0x2ffad2['setStateAsync'](LTM_DP_RAW_LOG,{'val':JSON[_0x220bfa(0x341)](_0x2ffad2[_0x220bfa(0x31e)]),'ack':!![]});}async function saveDailyDigests(_0x4814bb,_0x31364a=!![]){const _0x3c9cb6=a0_0x377f18,_0x45e213=_0x4814bb[_0x3c9cb6(0x2fd)]['ltmLtbWindowDays']||0x3c;_0x4814bb['dailyDigests']['length']>_0x45e213&&_0x4814bb[_0x3c9cb6(0x2c3)][_0x3c9cb6(0x1ee)](0x0,_0x4814bb[_0x3c9cb6(0x2c3)][_0x3c9cb6(0x369)]-_0x45e213);await _0x4814bb[_0x3c9cb6(0x247)](LTM_DP_DAILY_DIGESTS,{'val':JSON[_0x3c9cb6(0x341)](_0x4814bb[_0x3c9cb6(0x2c3)]),'ack':!![]});if(_0x31364a)await updateBaselineStatus(_0x4814bb);}async function updateAnalysisHistory(_0x316354,_0x4f1855){const _0x23082d=a0_0x377f18;_0x316354[_0x23082d(0x323)][_0x23082d(0x32f)](_0x4f1855);if(_0x316354[_0x23082d(0x323)][_0x23082d(0x369)]>ANALYSIS_HISTORY_MAX_SIZE)_0x316354[_0x23082d(0x323)][_0x23082d(0x287)]();await _0x316354[_0x23082d(0x247)](_0x23082d(0x21f),{'val':JSON[_0x23082d(0x341)](_0x316354[_0x23082d(0x323)]),'ack':!![]});}async function updateBaselineStatus(_0x3a457f){const _0x1e630b=a0_0x377f18;if(!_0x3a457f[_0x1e630b(0x364)]){await _0x3a457f[_0x1e630b(0x247)](LTM_DP_BASELINE_STATUS,{'val':_0x1e630b(0x279),'ack':!![]});return;}const _0x4621df=_0x3a457f[_0x1e630b(0x2c3)][_0x1e630b(0x369)]>=(_0x3a457f[_0x1e630b(0x2fd)][_0x1e630b(0x26e)]||0x7)?_0x1e630b(0x253)+_0x3a457f[_0x1e630b(0x2c3)][_0x1e630b(0x369)]+_0x1e630b(0x2c9):_0x1e630b(0x1fd)+_0x3a457f['dailyDigests'][_0x1e630b(0x369)]+'/'+(_0x3a457f[_0x1e630b(0x2fd)][_0x1e630b(0x26e)]||0x7)+')';await _0x3a457f[_0x1e630b(0x247)](LTM_DP_BASELINE_STATUS,{'val':_0x4621df,'ack':!![]});}async function initSensorSubscriptions(_0x441293){const _0x2e836c=a0_0x377f18,_0x8b3c42=_0x441293[_0x2e836c(0x2fd)][_0x2e836c(0x26f)];if(_0x8b3c42&&_0x8b3c42[_0x2e836c(0x369)]>0x0){_0x441293[_0x2e836c(0x2f0)]['info']('Subscribing\x20to\x20'+_0x8b3c42[_0x2e836c(0x369)]+_0x2e836c(0x355));for(const _0x878a11 of _0x8b3c42){if(_0x878a11['id']){await _0x441293[_0x2e836c(0x245)](_0x878a11['id']);try{const _0x1dd572=await _0x441293['getForeignStateAsync'](_0x878a11['id']);if(_0x1dd572)_0x441293['sensorLastValues'][_0x878a11['id']]=_0x1dd572[_0x2e836c(0x361)];}catch(_0x176e32){}}}}}async function initPresenceSubscriptions(_0x379cda){const _0x1beca8=a0_0x377f18,_0x476afc=_0x379cda[_0x1beca8(0x2fd)][_0x1beca8(0x1de)]||[];if(_0x476afc['length']>0x0){_0x379cda[_0x1beca8(0x2f0)]['info'](_0x1beca8(0x2a8)+_0x476afc[_0x1beca8(0x369)]+'\x20presence\x20devices...');for(const _0x586f6b of _0x476afc){await _0x379cda[_0x1beca8(0x245)](_0x586f6b);}try{await checkWifiPresence(_0x379cda);}catch(_0x577a35){}}}async function getWeatherContext(_0x3eba35){const _0x303901=a0_0x377f18;try{if(!_0x3eba35[_0x303901(0x2fd)][_0x303901(0x21c)])return'Wetter:\x20Deaktiviert';let _0x1e8f13='';const _0x98e02a=_0x3eba35[_0x303901(0x2fd)][_0x303901(0x21b)];if(_0x98e02a)try{if(_0x98e02a[_0x303901(0x290)]('accuweather')){const _0xfce236=await _0x3eba35['getForeignStateAsync'](_0x98e02a+_0x303901(0x30a));if(_0xfce236&&_0xfce236[_0x303901(0x361)])_0x1e8f13=_0xfce236[_0x303901(0x361)];}else{if(_0x98e02a[_0x303901(0x290)](_0x303901(0x2b1))){const _0x27cc60=await _0x3eba35['getForeignStateAsync'](_0x98e02a+'.NextHours.Location_1.Day_1.current.symbol_desc');if(_0x27cc60&&_0x27cc60[_0x303901(0x361)])_0x1e8f13=_0x27cc60[_0x303901(0x361)];}else{if(_0x98e02a[_0x303901(0x290)](_0x303901(0x2ff))){const _0x97f63f=await _0x3eba35[_0x303901(0x23f)](_0x98e02a+'.forecast.current.state');if(_0x97f63f&&_0x97f63f[_0x303901(0x361)])_0x1e8f13=_0x97f63f[_0x303901(0x361)];}}}}catch(_0x28c155){}if(!_0x1e8f13){const _0x530012=['accuweather.0',_0x303901(0x335),_0x303901(0x35e),_0x303901(0x234)];for(const _0x6df51f of _0x530012){try{const _0x22eac2=await _0x3eba35[_0x303901(0x226)](_0x6df51f);if(_0x22eac2){if(_0x6df51f[_0x303901(0x290)](_0x303901(0x30b))){const _0x22cf68=await _0x3eba35[_0x303901(0x23f)](_0x6df51f+_0x303901(0x30a));if(_0x22cf68&&_0x22cf68[_0x303901(0x361)]){_0x1e8f13=_0x22cf68[_0x303901(0x361)];break;}}}}catch(_0x54e1e9){}}}return _0x1e8f13?_0x303901(0x2e1)+_0x1e8f13:'WETTER:\x20Keine\x20Daten\x20gefunden';}catch(_0x5c45aa){return _0x303901(0x214)+_0x5c45aa[_0x303901(0x2e2)];}}async function getCalendarContext(_0x3a2a95){const _0x2e0349=a0_0x377f18;try{if(!_0x3a2a95['config'][_0x2e0349(0x2b7)])return'Kalender:\x20Deaktiviert';let _0x37cb23=_0x3a2a95[_0x2e0349(0x2fd)][_0x2e0349(0x322)]||_0x2e0349(0x282),_0x5a476d=_0x3a2a95['config'][_0x2e0349(0x208)]||[];if(typeof _0x5a476d===_0x2e0349(0x28a))_0x5a476d=_0x5a476d[_0x2e0349(0x29e)](',');try{const _0x57178f=await _0x3a2a95[_0x2e0349(0x23f)](_0x37cb23+'.data.table');if(_0x57178f&&_0x57178f[_0x2e0349(0x361)]){let _0x30673a=tryParse(_0x57178f[_0x2e0349(0x361)]);if(_0x30673a&&Array['isArray'](_0x30673a)){if(_0x5a476d[_0x2e0349(0x369)]>0x0)_0x30673a=_0x30673a[_0x2e0349(0x298)](_0x2dec4a=>_0x5a476d['includes'](_0x2dec4a[_0x2e0349(0x373)]||''));else return _0x2e0349(0x207);if(_0x30673a[_0x2e0349(0x369)]>0x0){const _0x56e475=_0x30673a[_0x2e0349(0x306)](0x0,0x3)[_0x2e0349(0x340)](_0x548642=>{const _0xda35bd=_0x2e0349;let _0x3dfb85=_0x548642[_0xda35bd(0x1e5)];if(_0x548642[_0xda35bd(0x269)])_0x3dfb85+='\x20'+_0x548642[_0xda35bd(0x269)];return _0x3dfb85+':\x20'+_0x548642[_0xda35bd(0x203)]+'\x20('+_0x548642[_0xda35bd(0x373)]+')';});return _0x2e0349(0x25c)+_0x56e475[_0x2e0349(0x29c)]('\x20|\x20');}else return _0x2e0349(0x20a);}}}catch(_0x6e7b4b){_0x3a2a95[_0x2e0349(0x2f0)][_0x2e0349(0x2a2)](_0x2e0349(0x33e)+_0x6e7b4b[_0x2e0349(0x2e2)]);}return _0x2e0349(0x296);}catch(_0x3218d0){return _0x2e0349(0x31f)+_0x3218d0[_0x2e0349(0x2e2)];}}function a0_0x2ea0(){const _0x156758=['system.mode','âš ï¸\x20Alarm','exitTimer','uuid','Adapter','Lernphase\x20(','getObjectAsync','execution','maintenance','LTM.driftAnalysis.lastCheck','geminiApiKey','event','switch','@iobroker/adapter-core','Phase\x202:\x20ACUTE\x20MONITORING.\x20STB\x20(Last\x2014d):\x20','KALENDER:\x20Keine\x20Kalender\x20ausgewÃ¤hlt\x20(Bitte\x20in\x20Settings\x20konfigurieren)','calendarSelection','Alarm','KALENDER:\x20Keine\x20relevanten\x20Termine','update','Baseline\x20Status','status','licenseKey','summary','simple-api.','ðŸš¨\x20EMERGENCY','toFixed','\x20events','WETTER\x20ERROR:\x20','Trigger\x20Digest','Success:\x20Compressed\x20','power','alertReason','firmware','Reset\x20Sched\x20Error:\x20','weatherInstance','useWeather','PRIORITÃ„T:\x20Gesundheit\x20und\x20Sicherheit\x20fÃ¼r\x20Senioren\x20(AAL).\x20Erkenne\x20InaktivitÃ¤t,\x20potenzielle\x20StÃ¼rze\x20(indirekt),\x20Schlafunterbrechungen\x20und\x20nÃ¤chtliche\x20Unruhe.','unknown','analysis.analysisHistory','namespace','Last\x20Check','analysis.automation.patternDetected','toString','analysisInterval','1763160bwWBEs','getForeignObjectAsync','analysis.automation','cancel','boolean','briefingTime','response','motion','Missing\x20data','0\x203\x20*\x20*\x20*','Target\x20ID','energy','Trigger\x20Analysis','Feedback\x20Log','city','openweathermap.0','channel','comfort','parse','sendToAsync','connection','ðŸ“ž\x20RÃœCKRUF\x20BITTE!\x20Der\x20Bewohner\x20hat\x20den\x20RÃ¼ckruf-Button\x20gedrÃ¼ckt.','notifyEmailEnabled','Analysiere\x20ausgewogen\x20auf\x20Gesundheit,\x20Sicherheit\x20und\x20Komfort.','analysis.automation.description','analysis.comfortSummary','getForeignStateAsync','generateContent','analysis.automation.autoApply','analysis.history_debug_00','Scheduling\x20Morning\x20Briefing\x20for\x20','Error\x20in\x20onMessage\x20command\x20','subscribeForeignStatesAsync','Health\x20Notes','setStateAsync','indicator.alarm','presence','json','currentSystemMode','automation.triggerAction','KI-Modell\x20nicht\x20initialisiert','common','native','ðŸŒ…\x20Daily\x20Briefing:\x0a','Trigger\x20Action\x20Now','material.','Aktiv\x20(','submitFeedback','Deviation','Restlessness\x20Level','Comfort\x20Summary','systemConfig','longitude','notifyPushoverEnabled','2-digit','KALENDER:\x20','3geUAPr','analysis.trigger','Last\x20Result','targetValue','notifyEmailRecipient','ðŸ¤–\x20AUTO-APPLY:\x20Executing\x20','Vom\x20Benutzer\x20bestÃ¤tigt\x20(OK).','analysis.isEmergency','rssi','system.isPresent','timestamp','COGNI_CONFIRM_OK','time','\x20Phase\x203:\x20DRIFT\x20ACTIVE.','getForeignObjectsAsync','ðŸ¤–\x20BUTLER:\x20Executing\x20Action\x20->\x20','driftAnalysisTimer','minDaysForBaseline','devices','ltmStbWindowDays','PRO-','stateChange','detected','triggerDailyDigest','baselineDrift','Feedback\x20saved:\x20','communicate.request','Morning\x20Briefing\x20sent.','Deaktiviert\x20(Pro-Feature)','geminiModel','testApiKey','uuid-not-found','notifyTelegramInstance','.\x20PRÃ„SENZ:\x20','Drift\x20Sched\x20Error:\x20','flot.','sort','ical.0','system.config','AI\x20Alert\x20Status','analysis.activitySummary','scriptEnabled','pop','state','position','string','send','System\x20Status\x20&\x20Control','Phase\x201:\x20Learning\x20(No\x20Baseline).\x20Rely\x20on\x20common\x20sense.','exports','System\x20Mode','includes','text','activityLevel','substring','node-schedule','setForeignStateAsync','KALENDER:\x20Keine\x20Daten','Triggered\x20analysis\x20but\x20Gemini\x20AI\x20is\x20not\x20initialized!\x20Check\x20API\x20Key.','filter','Starting\x20Autopilot\x20(','level','notifyPushoverInstance','join','cogni-living','split','latitude','none','notifyTelegramRecipient','warn','analysis.comfortSuggestion','Nein','guest','inactivityMonitoringEnabled','ðŸ“¡\x20Hooking\x20into\x20','Subscribing\x20to\x20','error','VACATION','push','[Test]\x20Interaktiver\x20Alarm','ðŸ“ž\x20RÃ¼ckruf\x20anfordern','toISOString','notifyTelegramEnabled','118725AmzRqn','daswetter','find','onStateChange','application/json','callback','Gemini\x20AI\x20initialized.','useCalendar','Generating\x20Morning\x20Briefing...','delObjectAsync','Trigger\x20Briefing\x20(Test)','N/A','targetposition','briefingJob','analysis.automation.triggerAction','AUTOMATION\x20RULES\x20(THE\x20BUTLER):\x20-\x20Only\x20propose\x20automation\x20if\x20you\x20see\x20a\x20STABLE,\x20REPETITIVE\x20pattern\x20(e.g.\x20happens\x20every\x20day).\x20-\x20IGNORE\x20one-time\x20events.\x20Do\x20NOT\x20trigger\x20on\x20first\x20occurrence.\x20-\x20\x22targetId\x22\x20MUSS\x20eine\x20ID\x20aus\x20der\x20Event-Liste\x20sein.','exitGraceTimer','retry','toLocaleString','dailyDigests','N/A\x20(Learning)','Gast','fault','sleepScore','bind','\x20Tage)','No\x20Key','Error:\x20','ROLLE:\x20FÃ¼rsorglicher\x20Assistent.\x20AUFGABE:\x20Schreibe\x20eine\x20kurze,\x20beruhigende\x20\x22Guten\x20Morgen\x22-Nachricht.\x20PERSONA:\x20','\x20SCHEMA:\x20{\x20\x22activity\x22:\x20{\x20\x22summary\x22:\x20\x22string\x22,\x20\x22deviationFromBaseline\x22:\x20\x22string\x22,\x20\x22isAlert\x22:\x20bool,\x20\x22isEmergency\x22:\x20bool,\x20\x22alertReason\x22:\x20\x22string\x22\x20},\x20\x22comfort\x22:\x20{\x20\x22automationProposal\x22:\x20{\x20\x22patternDetected\x22:\x20bool,\x20\x22description\x22:\x20\x22string\x22,\x20\x22execution\x22:\x20{\x20\x22targetId\x22:\x20\x22string|null\x22,\x20\x22targetValue\x22:\x20\x22boolean|number|null\x22\x20}\x20}\x20},\x20\x22health\x22:\x20{\x20\x22sleepScore\x22:\x20number\x20(0-100),\x20\x22restlessness\x22:\x20\x22string\x22,\x20\x22notes\x22:\x20\x22string\x22\x20}\x20}','217054TvEkyh','name','echarts.','humidity','siren','version','LTM\x20Sched\x20Error:\x20','LTM.driftAnalysis','button','CRITICAL\x20SAFETY\x20CHECK:\x201.\x20Sofort/Ad-Hoc:\x20Ist\x20es\x20jetzt\x20(','Drift\x20Details','indicator','admin.','replace','Auto\x20Apply\x20Rule','history.','systemUUID',')\x20-\x20SAFE\x20MODE\x20ARCHITECTURE','trim','WETTER:\x20','message','object','value.health','constructor','ltmJob','system.meta.uuid','startsWith','set_temperature','temperature','briefingEnabled','info','Description','ðŸš¨ðŸš¨\x20NOTFALL','generic','log',')\x20verdÃ¤chtig\x20still?\x202.\x20Akut\x20(vs.\x20STB):\x20Weicht\x20das\x20heutige\x20Verhalten\x20stark\x20von\x20den\x20letzten\x2014\x20Tagen\x20ab?\x20Ignoriere\x20Fehlalarme\x20durch\x20Kontext:\x20','analysis.automation.targetId','LTM','cover','endsWith','triggerBriefing','3449664CtHXkZ','Alert\x20Reason','\x20*\x20*\x20*','eventHistory','isExit','Processing\x20Status','config','online','openweathermap','enum','Sleep\x20Score\x20(0-100)','onReady','getGenerativeModel','main','analysis.deviationFromBaseline','slice','value','text.alarm','.communicate.request','.Summary.Current','accuweather','details','Error\x20checking\x20WiFi:\x20','Activity\x20Summary','instance','subscribeStates','location','.data.table','indexOf','models/gemini-flash-latest','Health\x20&\x20Sleep\x20Analysis','cogni-living\x20adapter\x20starting\x20(v','ðŸ¤–\x20BUTLER:\x20No\x20valid\x20target\x20ID\x20or\x20value\x20stored\x20for\x20execution.','command','analysis.lastResult','analysis.triggerBriefing','isPresent','expire','onUnload','rawEventLog','KALENDER\x20ERROR:\x20','inactivityThresholdHours','number','calendarInstance','analysisHistory','now','analysis.feedbackHistory','Drift\x20Analysis','off','occupancy','\x20=\x20','genAI','feedbackHistory','âœ…\x20Alarm\x20quittiert.\x20System\x20normal.','events.history_debug_00','LTM.rawEventLog','unshift','.\x20OUTPUT:\x20Nur\x20Text.','description','analysis.health','lastAlertState','COGNI_REQUEST_CALL','daswetter.0','targetId','apiKey','vis.','analysis.alertReason','Comfort\x20Suggestion','LTM.baselineStatus','(((.+)+)+)+$','HARD\x20WATCHDOG:\x20No\x20sensor\x20activity\x20detected\x20for\x20','Error\x20reading\x20calendar\x20table:\x20','Raw\x20Log','map','stringify','health','getCalendarNames\x20Error:\x20','.\x20PERSONA:\x20','196194oALpkX','GUEST','blind','isArray','search','getStateAsync','catch','scriptProblem','PARTY','de-DE','notifyEmailInstance','Briefing\x20Error:\x20','onMessage','getOverviewData','08:00','aiPersona','\x20sensors...','extendObjectAsync','setHours','isAlert','1522536IzybLf','NORMAL','sensorLastValues','events.history','1041056kTUAgs','weatherunderground.0','Fokus\x20auf\x20Maximierung\x20von\x20Komfort,\x20Automatisierungseffizienz\x20und\x20Energieeinsparung.','direction','val','activity','apply','isProVersion','\x20for\x20interactive\x20buttons...','setState','modeResetJob','sendTo','length','icons-mfd.','analysis.automation.targetValue','logDuplicates','\x20min).','scheduleJob','/100,\x20AktivitÃ¤t\x20seit\x2004:00:\x20','Event\x20History','BUTLER\x20Execution\x20Error:\x20','valve','_calName','Kein\x20API\x20Key!','presenceDevices','Automation\x20Proposals','livingContext','test','Urlaub','Fokus\x20auf\x20Familienroutinen,\x20Kindersicherheit\x20und\x20allgemeines\x20Haushaltsmanagement.','shutter','date','setObjectNotExistsAsync','autoApply','ack','analysis.isAlert','isGracePeriodActive','getEnums','from','@google/generative-ai','splice','values','âœ…\x20User\x20confirmed\x20ALARM\x20via\x20Telegram.\x20Resetting\x20system.','Target\x20Value','analysisTimer','getCalendarNames','dutycycle','isEmergency','lowbat','\x20sent'];a0_0x2ea0=function(){return _0x156758;};return a0_0x2ea0();}async function getCalendarNames(_0x3c3f72,_0x51be4a){const _0x248276=a0_0x377f18;try{const _0x22179a=await _0x3c3f72[_0x248276(0x23f)](_0x51be4a+_0x248276(0x312));if(_0x22179a&&_0x22179a[_0x248276(0x361)]){const _0x54c495=tryParse(_0x22179a[_0x248276(0x361)]);if(_0x54c495&&Array[_0x248276(0x348)](_0x54c495)){const _0x310890=[...new Set(_0x54c495[_0x248276(0x340)](_0x343722=>_0x343722['_calName'])['filter'](Boolean))];return _0x310890[_0x248276(0x281)]();}}return[];}catch(_0x2aab2e){return _0x3c3f72['log'][_0x248276(0x2a9)](_0x248276(0x343)+_0x2aab2e[_0x248276(0x2e2)]),[];}}async function checkWifiPresence(_0x114f98){const _0x2ab253=a0_0x377f18;try{const _0xc53b88=_0x114f98[_0x2ab253(0x2fd)][_0x2ab253(0x1de)]||[];let _0x282cc5=![];for(const _0x4d3441 of _0xc53b88){try{const _0x589fcb=await _0x114f98['getForeignStateAsync'](_0x4d3441);if(_0x589fcb&&(_0x589fcb[_0x2ab253(0x361)]===!![]||_0x589fcb[_0x2ab253(0x361)]===_0x2ab253(0x2fe)||_0x589fcb[_0x2ab253(0x361)]===0x1)){_0x282cc5=!![];break;}}catch(_0xe1078f){}}return _0x282cc5&&(_0x114f98[_0x2ab253(0x1fa)]&&(_0x114f98['log'][_0x2ab253(0x2ec)]('WiFi\x20Presence\x20detected\x20->\x20Aborting\x20Exit\x20Timer.\x20User\x20is\x20present.'),abortExitTimer(_0x114f98)),!_0x114f98['isPresent']&&_0x114f98[_0x2ab253(0x24b)]===SYSTEM_MODES['NORMAL']&&await setPresence(_0x114f98,!![])),_0x282cc5;}catch(_0x269654){return _0x114f98[_0x2ab253(0x2f0)]['error'](_0x2ab253(0x30d)+_0x269654[_0x2ab253(0x2e2)]),![];}}function startExitTimer(_0x391331){const _0x2431f6=a0_0x377f18;abortExitTimer(_0x391331),_0x391331[_0x2431f6(0x1ea)]=!![],_0x391331['exitGraceTimer']=setTimeout(()=>{const _0xf966d3=_0x2431f6;_0x391331[_0xf966d3(0x1ea)]=![];},EXIT_GRACE_PERIOD_SECONDS*0x3e8),_0x391331[_0x2431f6(0x1fa)]=setTimeout(()=>{const _0x1e91f7=_0x2431f6;setPresence(_0x391331,![]),_0x391331[_0x1e91f7(0x1fa)]=null;},EXIT_TIMER_MINUTES*0x3c*0x3e8);}function abortExitTimer(_0x70486d){const _0xd1fb51=a0_0x377f18;if(_0x70486d['exitTimer'])clearTimeout(_0x70486d[_0xd1fb51(0x1fa)]);if(_0x70486d[_0xd1fb51(0x2c0)])clearTimeout(_0x70486d[_0xd1fb51(0x2c0)]);_0x70486d[_0xd1fb51(0x1fa)]=null,_0x70486d[_0xd1fb51(0x2c0)]=null,_0x70486d[_0xd1fb51(0x1ea)]=![];}async function setPresence(_0x543221,_0x5c99d0){const _0x4bbe04=a0_0x377f18;if(_0x543221[_0x4bbe04(0x31b)]===_0x5c99d0)return;_0x543221[_0x4bbe04(0x31b)]=_0x5c99d0,await _0x543221['setStateAsync'](_0x4bbe04(0x266),{'val':_0x5c99d0,'ack':!![]});}async function saveFeedback(_0x4d7db2,_0x4d58ea){const _0x3afb74=a0_0x377f18;_0x4d7db2[_0x3afb74(0x2f0)][_0x3afb74(0x2ec)](_0x3afb74(0x276)+JSON[_0x3afb74(0x341)](_0x4d58ea));}async function runBaselineDriftAnalysis(_0x5dd31d){const _0x147692=a0_0x377f18;if(!_0x5dd31d[_0x147692(0x364)]||!_0x5dd31d['geminiModel'])return;const _0x213b36=_0x5dd31d['config'][_0x147692(0x270)]||0xe;if(_0x5dd31d[_0x147692(0x2c3)]['length']<_0x213b36+(_0x5dd31d[_0x147692(0x2fd)][_0x147692(0x26e)]||0x7)){await _0x5dd31d['setStateAsync'](LTM_DP_DRIFT_STATUS,{'val':_0x147692(0x2c4),'ack':!![]});return;}const _0x309b15=_0x5dd31d[_0x147692(0x2c3)][_0x147692(0x306)](-_0x213b36),_0x4b79e4=_0x5dd31d[_0x147692(0x2c3)][_0x147692(0x306)](0x0,_0x5dd31d[_0x147692(0x2c3)]['length']-_0x213b36),_0x483edb='ROLLE:\x20Data\x20Scientist.\x20ZIEL:\x20Drift\x20erkennen.\x20SCHEMA:\x20{\x20\x22baselineDrift\x22:\x20\x22none|slight|significant|critical\x22,\x20\x22driftDetails\x22:\x20\x22string\x22\x20}\x0a\x0aLTB:\x20'+JSON[_0x147692(0x341)](_0x4b79e4)+'\x0aSTB:\x20'+JSON[_0x147692(0x341)](_0x309b15);try{const _0x2ab093=await _0x5dd31d['geminiModel'][_0x147692(0x240)](_0x483edb),_0x3a478c=JSON[_0x147692(0x237)](_0x2ab093[_0x147692(0x22b)][_0x147692(0x291)]()[_0x147692(0x2db)](/```json|```/g,'')['trim']());_0x3a478c[_0x147692(0x275)]&&(await _0x5dd31d[_0x147692(0x247)](LTM_DP_DRIFT_STATUS,{'val':_0x3a478c[_0x147692(0x275)],'ack':!![]}),await _0x5dd31d['setStateAsync'](LTM_DP_DRIFT_DETAILS,{'val':_0x3a478c['driftDetails'],'ack':!![]}),await _0x5dd31d[_0x147692(0x247)](LTM_DP_DRIFT_LAST_CHECK,{'val':Date['now'](),'ack':!![]}));}catch(_0x17cab1){}}function setupLtmScheduler(_0x7a686d){const _0x514475=a0_0x377f18;try{if(_0x7a686d[_0x514475(0x2e6)])_0x7a686d[_0x514475(0x2e6)]['cancel']();if(!_0x7a686d[_0x514475(0x364)]){_0x7a686d[_0x514475(0x247)](LTM_DP_STATUS,{'val':_0x514475(0x279),'ack':!![]});return;}_0x7a686d[_0x514475(0x2e6)]=schedule[_0x514475(0x36e)](LTM_SCHEDULE,()=>createDailyDigest(_0x7a686d));}catch(_0xd24722){_0x7a686d['log']['error'](_0x514475(0x2d4)+_0xd24722[_0x514475(0x2e2)]);}}function setupModeResetScheduler(_0x6d320d){const _0x461b48=a0_0x377f18;try{if(_0x6d320d[_0x461b48(0x367)])_0x6d320d[_0x461b48(0x367)][_0x461b48(0x228)]();_0x6d320d[_0x461b48(0x367)]=schedule[_0x461b48(0x36e)](MODE_RESET_SCHEDULE,async()=>{const _0x2b955b=_0x461b48;await loadSystemMode(_0x6d320d),AUTO_RESET_MODES['includes'](_0x6d320d[_0x2b955b(0x24b)])&&await _0x6d320d[_0x2b955b(0x247)](SYSTEM_DP_MODE,{'val':SYSTEM_MODES[_0x2b955b(0x35a)],'ack':![]});});}catch(_0xaa4aa4){_0x6d320d[_0x461b48(0x2f0)][_0x461b48(0x2a9)](_0x461b48(0x21a)+_0xaa4aa4['message']);}}function setupDriftAnalysisScheduler(_0x25ce7a){const _0x3fbb05=a0_0x377f18;try{if(_0x25ce7a[_0x3fbb05(0x26d)])clearInterval(_0x25ce7a[_0x3fbb05(0x26d)]);if(!_0x25ce7a['isProVersion'])return;_0x25ce7a[_0x3fbb05(0x26d)]=setInterval(()=>runBaselineDriftAnalysis(_0x25ce7a),(_0x25ce7a[_0x3fbb05(0x2fd)]['ltmDriftCheckIntervalHours']||0x18)*0x36ee80),setTimeout(()=>runBaselineDriftAnalysis(_0x25ce7a),0x1388);}catch(_0x4058eb){_0x25ce7a[_0x3fbb05(0x2f0)][_0x3fbb05(0x2a9)](_0x3fbb05(0x27f)+_0x4058eb['message']);}}function setupBriefingScheduler(_0x9ea4da){const _0x20865c=a0_0x377f18;try{if(_0x9ea4da[_0x20865c(0x2bd)])_0x9ea4da['briefingJob'][_0x20865c(0x228)]();if(!_0x9ea4da[_0x20865c(0x2fd)][_0x20865c(0x2eb)])return;const _0x3bf93b=(_0x9ea4da[_0x20865c(0x2fd)][_0x20865c(0x22a)]||_0x20865c(0x353))[_0x20865c(0x29e)](':'),_0x4856c5=parseInt(_0x3bf93b[0x0])||0x8,_0x13774f=parseInt(_0x3bf93b[0x1])||0x0,_0x531fcb=_0x13774f+'\x20'+_0x4856c5+_0x20865c(0x2f9);_0x9ea4da['log'][_0x20865c(0x2ec)](_0x20865c(0x243)+_0x4856c5+':'+(_0x13774f<0xa?'0'+_0x13774f:_0x13774f)),_0x9ea4da['briefingJob']=schedule[_0x20865c(0x36e)](_0x531fcb,()=>{sendMorningBriefing(_0x9ea4da);});}catch(_0x263a66){_0x9ea4da[_0x20865c(0x2f0)][_0x20865c(0x2a9)]('Briefing\x20Sched\x20Error:\x20'+_0x263a66['message']);}}async function sendNotification(_0x1ae871,_0x4cd620,_0x26ee18=![],_0x174308=![]){const _0x2f7996=a0_0x377f18;_0x1ae871[_0x2f7996(0x2f0)]['info']((_0x26ee18?'[TEST]\x20':'')+'Sending\x20notification:\x20\x22'+_0x4cd620+'\x22');const _0x477daa=_0x1ae871[_0x2f7996(0x2fd)];let _0x5e8407=0x0;if(_0x477daa[_0x2f7996(0x2af)]){let _0x4b1cc5={};(_0x4cd620[_0x2f7996(0x290)](_0x2f7996(0x209))||_0x174308)&&(_0x4b1cc5={'reply_markup':{'inline_keyboard':[[{'text':'âœ…\x20Alles\x20OK\x20(Reset)','callback_data':_0x2f7996(0x268)}],[{'text':_0x2f7996(0x2ad),'callback_data':'COGNI_REQUEST_CALL'}]]}}),await _0x1ae871['sendToAsync'](_0x477daa[_0x2f7996(0x27d)],'send',{'text':_0x4cd620,'user':_0x477daa[_0x2f7996(0x2a1)],..._0x4b1cc5}),_0x5e8407++;}if(_0x477daa[_0x2f7996(0x25a)]){let _0xa777cf={'message':_0x4cd620,'title':_0x174308?_0x2f7996(0x211):'Cogni-Living','priority':_0x174308?0x2:0x1,'device':_0x477daa['notifyPushoverRecipient']};_0x174308&&(_0xa777cf[_0x2f7996(0x2c1)]=0x1e,_0xa777cf[_0x2f7996(0x31c)]=0xe10,_0xa777cf['sound']=_0x2f7996(0x2d2)),await _0x1ae871['sendToAsync'](_0x477daa[_0x2f7996(0x29b)],_0x2f7996(0x28b),_0xa777cf),_0x5e8407++;}return _0x477daa[_0x2f7996(0x23b)]&&(await _0x1ae871[_0x2f7996(0x238)](_0x477daa[_0x2f7996(0x34f)],_0x2f7996(0x28b),{'text':_0x4cd620,'to':_0x477daa[_0x2f7996(0x261)]}),_0x5e8407++),_0x5e8407;}async function setupTelegramListener(_0x31611f){const _0x4e889e=a0_0x377f18,_0x3461cb=_0x31611f[_0x4e889e(0x2fd)][_0x4e889e(0x27d)];_0x31611f[_0x4e889e(0x2fd)]['notifyTelegramEnabled']&&_0x3461cb&&(_0x31611f['log'][_0x4e889e(0x2ec)](_0x4e889e(0x2a7)+_0x3461cb+_0x4e889e(0x365)),await _0x31611f['subscribeForeignStatesAsync'](_0x3461cb+_0x4e889e(0x309)));}async function handleTelegramResponse(_0xbd8bd2,_0x41161f){const _0x4beaaf=a0_0x377f18;let _0x2e1347=_0x41161f;_0x41161f[_0x4beaaf(0x2e8)]('[')&&(_0x2e1347=_0x41161f[_0x4beaaf(0x293)](_0x41161f[_0x4beaaf(0x313)](']')+0x1));if(_0x2e1347===_0x4beaaf(0x268))_0xbd8bd2['log'][_0x4beaaf(0x2ec)](_0x4beaaf(0x1f0)),await _0xbd8bd2[_0x4beaaf(0x247)]('analysis.isAlert',{'val':![],'ack':!![]}),await _0xbd8bd2['setStateAsync'](_0x4beaaf(0x339),{'val':_0x4beaaf(0x263),'ack':!![]}),_0xbd8bd2[_0x4beaaf(0x333)]=![],sendNotification(_0xbd8bd2,_0x4beaaf(0x32c),![]);else _0x2e1347===_0x4beaaf(0x334)&&(_0xbd8bd2[_0x4beaaf(0x2f0)][_0x4beaaf(0x2a2)]('ðŸ“ž\x20User\x20requested\x20CALL\x20via\x20Telegram!'),sendNotification(_0xbd8bd2,_0x4beaaf(0x23a),![],!![]));}async function processSensorEvent(_0x1a98f0,_0x209e76,_0x29de5a,_0x30c6d3){const _0x4c030c=a0_0x377f18;if(!_0x30c6d3[_0x4c030c(0x36c)]&&_0x1a98f0[_0x4c030c(0x35b)][_0x209e76]===_0x29de5a[_0x4c030c(0x361)])return;_0x1a98f0[_0x4c030c(0x35b)][_0x209e76]=_0x29de5a[_0x4c030c(0x361)];if(_0x1a98f0['isGracePeriodActive'])return;const _0x4d4a2d=await checkWifiPresence(_0x1a98f0);if(_0x4d4a2d){if(!_0x1a98f0[_0x4c030c(0x31b)])await setPresence(_0x1a98f0,!![]);}else{const _0x9a8913=_0x30c6d3[_0x4c030c(0x2fb)]===!![];if(_0x9a8913)startExitTimer(_0x1a98f0);else{if(_0x1a98f0['exitTimer'])abortExitTimer(_0x1a98f0);if(!_0x1a98f0['isPresent']&&_0x1a98f0['currentSystemMode']===SYSTEM_MODES['NORMAL'])await setPresence(_0x1a98f0,!![]);}}const _0x16ae28={'timestamp':_0x29de5a['ts'],'id':_0x209e76,'name':_0x30c6d3['name'],'value':_0x29de5a[_0x4c030c(0x361)],'location':_0x30c6d3[_0x4c030c(0x311)],'type':_0x30c6d3['type']};_0x1a98f0['eventHistory'][_0x4c030c(0x32f)](_0x16ae28);if(_0x1a98f0[_0x4c030c(0x2fa)][_0x4c030c(0x369)]>HISTORY_MAX_SIZE)_0x1a98f0[_0x4c030c(0x2fa)][_0x4c030c(0x287)]();await _0x1a98f0[_0x4c030c(0x247)]('events.lastEvent',{'val':JSON['stringify'](_0x16ae28),'ack':!![]}),await _0x1a98f0['setStateAsync'](_0x4c030c(0x35c),{'val':JSON['stringify'](_0x1a98f0[_0x4c030c(0x2fa)]),'ack':!![]}),_0x1a98f0[_0x4c030c(0x31e)]['push']({'timestamp':new Date(_0x29de5a['ts'])[_0x4c030c(0x2ae)](),'sensorName':_0x30c6d3[_0x4c030c(0x2cf)],'location':_0x30c6d3['location'],'value':_0x29de5a[_0x4c030c(0x361)]}),await saveRawEventLog(_0x1a98f0);}async function runGeminiAnalysis(_0xa55f65,_0x422bdd=''){const _0x44f257=a0_0x377f18;if(!_0xa55f65[_0x44f257(0x27a)]){_0xa55f65[_0x44f257(0x2f0)][_0x44f257(0x2a2)](_0x44f257(0x297));return;}const _0x795f42=_0xa55f65['eventHistory'][_0x44f257(0x369)]>0x0?_0xa55f65[_0x44f257(0x2fa)]:[{'note':'No\x20recorded\x20events\x20yet.'}],_0x1369ee=PERSONA_MAPPING[_0xa55f65[_0x44f257(0x2fd)][_0x44f257(0x354)]||_0x44f257(0x2ef)],_0x52830b=_0xa55f65['config']['livingContext']||'',_0x9d41cd=_0xa55f65['currentSystemMode'],_0x218008=await getWeatherContext(_0xa55f65),_0xaf13c9=await getCalendarContext(_0xa55f65),_0xb3401a=(_0x218008+'\x20'+_0xaf13c9)[_0x44f257(0x2e0)](),_0x501713=new Date(),_0x19b6a0=_0x501713[_0x44f257(0x2c2)](_0x44f257(0x34e),{'weekday':'long','hour':_0x44f257(0x25b),'minute':_0x44f257(0x25b)});let _0x2934ad=_0x44f257(0x28d);const _0x616724=_0xa55f65[_0x44f257(0x2c3)][_0x44f257(0x369)];if(_0xa55f65[_0x44f257(0x364)]&&_0x616724>=(_0xa55f65[_0x44f257(0x2fd)][_0x44f257(0x26e)]||0x7)){const _0x382181=_0xa55f65[_0x44f257(0x2c3)][_0x44f257(0x306)](-(_0xa55f65[_0x44f257(0x2fd)][_0x44f257(0x270)]||0xe));_0x2934ad=_0x44f257(0x206)+JSON[_0x44f257(0x341)](_0x382181)+'.';if(_0x616724>=0x1e)_0x2934ad+=_0x44f257(0x26a);}const _0x20304d=_0x44f257(0x2d7)+_0x19b6a0+_0x44f257(0x2f1)+_0xb3401a,_0x58a280=_0x44f257(0x2bf),_0x530931='ROLLE:\x20Smart\x20Home\x20Analyst.\x20SPRACHE:\x20DE.\x20FORMAT:\x20JSON.\x20AKTUELLE\x20ZEIT:\x20'+_0x19b6a0+'.\x20MODUS:\x20'+_0x9d41cd+_0x44f257(0x27e)+(_0xa55f65['isPresent']?'Ja':_0x44f257(0x2a4))+'.\x20KONTEXT:\x20'+_0x52830b+_0x44f257(0x344)+_0x1369ee+'.\x20'+_0x2934ad+'\x20'+(_0x422bdd?_0x422bdd:'')+'\x20'+_0x20304d+'\x20'+_0x58a280+'\x20EVENTS:\x20'+JSON[_0x44f257(0x341)](_0x795f42)+_0x44f257(0x2cd);try{const _0xb21ddb=await _0xa55f65[_0x44f257(0x27a)]['generateContent'](_0x530931),_0x356b83=_0xb21ddb[_0x44f257(0x22b)]['text']()[_0x44f257(0x2db)](/```json|```/g,'')['trim'](),_0x20fd17=JSON['parse'](_0x356b83);await _0xa55f65['setStateAsync']('analysis.lastResult',{'val':_0x356b83,'ack':!![]}),await _0xa55f65[_0x44f257(0x247)]('analysis.alertReason',{'val':_0x20fd17['activity']['alertReason']||'','ack':!![]}),await _0xa55f65[_0x44f257(0x247)]('analysis.activitySummary',{'val':_0x20fd17[_0x44f257(0x362)]['summary']||'N/A','ack':!![]});const _0x3670d1=_0x20fd17[_0x44f257(0x236)]?.['automationProposal'];if(_0xa55f65[_0x44f257(0x364)]&&_0x3670d1){const _0x4fc6b1=_0x3670d1['patternDetected']||![];await _0xa55f65[_0x44f257(0x247)]('analysis.automation.patternDetected',{'val':_0x4fc6b1,'ack':!![]}),await _0xa55f65[_0x44f257(0x247)]('analysis.automation.description',{'val':_0x4fc6b1?_0x3670d1['description']:'Keine\x20neuen\x20Automatisierungs-Muster\x20erkannt.','ack':!![]});if(_0x4fc6b1&&_0x3670d1[_0x44f257(0x1ff)]&&_0x3670d1[_0x44f257(0x1ff)][_0x44f257(0x336)]){await _0xa55f65[_0x44f257(0x247)](_0x44f257(0x2f2),{'val':_0x3670d1[_0x44f257(0x1ff)][_0x44f257(0x336)],'ack':!![]}),await _0xa55f65[_0x44f257(0x247)]('analysis.automation.targetValue',{'val':JSON['stringify'](_0x3670d1[_0x44f257(0x1ff)][_0x44f257(0x260)]),'ack':!![]});const _0x5bf61f=await _0xa55f65[_0x44f257(0x34a)](_0x44f257(0x241));_0x5bf61f&&_0x5bf61f[_0x44f257(0x361)]&&(_0xa55f65[_0x44f257(0x2f0)]['info'](_0x44f257(0x262)+_0x3670d1[_0x44f257(0x1ff)][_0x44f257(0x336)]+_0x44f257(0x329)+_0x3670d1['execution']['targetValue']),executeAutomationAction(_0xa55f65));}else await _0xa55f65[_0x44f257(0x247)](_0x44f257(0x2f2),{'val':'','ack':!![]}),await _0xa55f65[_0x44f257(0x247)](_0x44f257(0x36b),{'val':'','ack':!![]});}if(_0x20fd17[_0x44f257(0x362)][_0x44f257(0x358)]||_0x20fd17[_0x44f257(0x362)][_0x44f257(0x1f5)]){await _0xa55f65[_0x44f257(0x247)](_0x44f257(0x1e9),{'val':!![],'ack':!![]});if(!_0xa55f65[_0x44f257(0x333)]||_0x20fd17['activity'][_0x44f257(0x1f5)]){const _0x2e7f24=_0x20fd17[_0x44f257(0x362)][_0x44f257(0x1f5)]?_0x44f257(0x2ee):_0x44f257(0x1f9);sendNotification(_0xa55f65,_0x2e7f24+':\x20'+_0x20fd17[_0x44f257(0x362)][_0x44f257(0x218)],![],_0x20fd17[_0x44f257(0x362)][_0x44f257(0x1f5)]);}}else await _0xa55f65[_0x44f257(0x247)]('analysis.isAlert',{'val':![],'ack':!![]});_0xa55f65[_0x44f257(0x333)]=_0x20fd17['activity'][_0x44f257(0x358)]||_0x20fd17[_0x44f257(0x362)]['isEmergency'],updateAnalysisHistory(_0xa55f65,{'timestamp':Date[_0x44f257(0x324)](),'id':Date[_0x44f257(0x324)]()['toString'](),'analysis':_0x20fd17,'systemMode':_0x9d41cd,'isPro':_0xa55f65[_0x44f257(0x364)]});}catch(_0x4e9de8){_0xa55f65[_0x44f257(0x2f0)][_0x44f257(0x2a9)]('Analysis\x20Error:\x20'+_0x4e9de8[_0x44f257(0x2e2)]);}}async function executeAutomationAction(_0x3d48a4){const _0x3cb888=a0_0x377f18;try{const _0x5930c3=await _0x3d48a4[_0x3cb888(0x34a)](_0x3cb888(0x2f2)),_0x32c50b=await _0x3d48a4[_0x3cb888(0x34a)]('analysis.automation.targetValue');if(_0x5930c3&&_0x5930c3['val']&&_0x32c50b){const _0x945158=_0x5930c3[_0x3cb888(0x361)];let _0x9b92c2=_0x32c50b[_0x3cb888(0x361)];try{_0x9b92c2=JSON[_0x3cb888(0x237)](_0x9b92c2);}catch(_0x5ba1fe){}_0x3d48a4[_0x3cb888(0x2f0)][_0x3cb888(0x2ec)](_0x3cb888(0x26c)+_0x945158+_0x3cb888(0x329)+_0x9b92c2),await _0x3d48a4[_0x3cb888(0x295)](_0x945158,_0x9b92c2);}else _0x3d48a4[_0x3cb888(0x2f0)][_0x3cb888(0x2a2)](_0x3cb888(0x317));}catch(_0x1aed81){_0x3d48a4[_0x3cb888(0x2f0)][_0x3cb888(0x2a9)](_0x3cb888(0x371)+_0x1aed81[_0x3cb888(0x2e2)]);}}async function runAutopilot(_0x389eaf){const _0x13fa36=a0_0x377f18,_0x1865d0=_0x389eaf['config'][_0x13fa36(0x320)],_0x319718=_0x389eaf[_0x13fa36(0x2fa)]['length']>0x0?_0x389eaf[_0x13fa36(0x2fa)][0x0]['timestamp']:Date['now'](),_0x529295=(Date[_0x13fa36(0x324)]()-_0x319718)/(0x3e8*0x3c*0x3c);let _0x501135='';_0x389eaf[_0x13fa36(0x2fd)][_0x13fa36(0x2a6)]&&_0x389eaf['currentSystemMode']===SYSTEM_MODES[_0x13fa36(0x35a)]&&_0x389eaf[_0x13fa36(0x31b)]&&(_0x529295>_0x1865d0&&(_0x501135=_0x13fa36(0x33d)+_0x529295[_0x13fa36(0x212)](0x1)+'\x20hours.\x20Potential\x20incapacitation.')),runGeminiAnalysis(_0x389eaf,_0x501135)[_0x13fa36(0x34b)](_0x5d79e1=>_0x389eaf[_0x13fa36(0x2f0)][_0x13fa36(0x2a9)](_0x5d79e1));}async function createDailyDigest(_0x2beaa6){const _0x2078ff=a0_0x377f18;if(!_0x2beaa6[_0x2078ff(0x364)])return;await _0x2beaa6['setStateAsync'](LTM_DP_STATUS,{'val':'Started\x20at\x20'+new Date()[_0x2078ff(0x2c2)](),'ack':!![]});if(!_0x2beaa6[_0x2078ff(0x27a)]||_0x2beaa6[_0x2078ff(0x31e)][_0x2078ff(0x369)]<LTM_MIN_EVENTS_FOR_COMPRESSION){await _0x2beaa6[_0x2078ff(0x247)](LTM_DP_STATUS,{'val':'Skipped\x20(No\x20AI\x20or\x20Data)','ack':!![]});return;}const _0x40b145=JSON['parse'](JSON[_0x2078ff(0x341)](_0x2beaa6[_0x2078ff(0x31e)])),_0x5762ed=_0x40b145[_0x2078ff(0x369)],_0x1168f6='ROLLE:\x20Data\x20Compression\x20Agent.\x20SPRACHE:\x20DE.\x20FORMAT:\x20JSON.\x20ANWEISUNG:\x20Fasse\x20Sensor-Events\x20zusammen.\x20SCHEMA:\x20{\x20\x22summary\x22:\x20\x22string\x22,\x20\x22activityLevel\x22:\x20\x22string\x22\x20}\x20\x0a\x0aEVENTS:\x0a'+JSON[_0x2078ff(0x341)](_0x40b145);try{const _0x34cac3=await _0x2beaa6[_0x2078ff(0x27a)][_0x2078ff(0x240)](_0x1168f6),_0x27d7a5=JSON[_0x2078ff(0x237)](_0x34cac3[_0x2078ff(0x22b)][_0x2078ff(0x291)]()[_0x2078ff(0x2db)](/```json|```/g,'')['trim']());_0x27d7a5['summary']&&(_0x2beaa6[_0x2078ff(0x2c3)][_0x2078ff(0x2ab)]({'timestamp':new Date()[_0x2078ff(0x2ae)](),'eventCount':_0x5762ed,'summary':_0x27d7a5[_0x2078ff(0x20f)],'activityLevel':_0x27d7a5[_0x2078ff(0x292)],'systemMode':_0x2beaa6[_0x2078ff(0x24b)]}),await saveDailyDigests(_0x2beaa6),_0x2beaa6[_0x2078ff(0x31e)]=[],await saveRawEventLog(_0x2beaa6),await _0x2beaa6[_0x2078ff(0x247)](LTM_DP_STATUS,{'val':_0x2078ff(0x216)+_0x5762ed+_0x2078ff(0x213),'ack':!![]}));}catch(_0x54f44f){await _0x2beaa6['setStateAsync'](LTM_DP_STATUS,{'val':_0x2078ff(0x2cb)+_0x54f44f[_0x2078ff(0x2e2)],'ack':!![]});}}async function sendMorningBriefing(_0x76aac){const _0x46ff07=a0_0x377f18;if(!_0x76aac[_0x46ff07(0x27a)])return;_0x76aac[_0x46ff07(0x2f0)]['info'](_0x46ff07(0x2b8));const _0x1dc8a7=_0x76aac[_0x46ff07(0x2c3)]['length']>0x0?_0x76aac[_0x46ff07(0x2c3)][_0x76aac['dailyDigests'][_0x46ff07(0x369)]-0x1]:null,_0x189923=_0x1dc8a7&&_0x1dc8a7[_0x46ff07(0x342)]?_0x1dc8a7['health'][_0x46ff07(0x2c7)]:_0x46ff07(0x2bb),_0x13f743=new Date();_0x13f743[_0x46ff07(0x357)](0x4,0x0,0x0,0x0);const _0x1eace9=_0x76aac[_0x46ff07(0x2fa)]['filter'](_0x19219e=>new Date(_0x19219e[_0x46ff07(0x267)])>_0x13f743),_0x22dcf7=PERSONA_MAPPING[_0x76aac[_0x46ff07(0x2fd)]['aiPersona']||_0x46ff07(0x2ef)],_0x2175a4=_0x76aac[_0x46ff07(0x2fd)][_0x46ff07(0x1e0)]||'',_0x5e2ace=await getWeatherContext(_0x76aac),_0x4b82a9=await getCalendarContext(_0x76aac),_0x18274d=_0x46ff07(0x2cc)+_0x22dcf7+'.\x20KONTEXT:\x20'+_0x2175a4+'.\x20ZUSATZ:\x20'+_0x5e2ace+'\x20'+_0x4b82a9+'.\x20DATEN:\x20Schlaf\x20'+_0x189923+_0x46ff07(0x36f)+JSON[_0x46ff07(0x341)](_0x1eace9[_0x46ff07(0x306)](0x0,0xa))+_0x46ff07(0x330);try{const _0x5f3998=await _0x76aac['geminiModel'][_0x46ff07(0x240)](_0x18274d),_0x1c8eb4=_0x46ff07(0x250)+_0x5f3998[_0x46ff07(0x22b)]['text']()['trim']();sendNotification(_0x76aac,_0x1c8eb4),_0x76aac[_0x46ff07(0x2f0)]['info'](_0x46ff07(0x278));}catch(_0x1259f6){_0x76aac[_0x46ff07(0x2f0)]['error'](_0x46ff07(0x350)+_0x1259f6[_0x46ff07(0x2e2)]);}}if(require[a0_0x377f18(0x304)]!==module)module[a0_0x377f18(0x28e)]=_0x39d53e=>new CogniLiving(_0x39d53e);else new CogniLiving();