const a0_0x1ec7da=a0_0x5acf;function a0_0x5acf(_0x20eb18,_0x3e8d68){const _0x21d29c=a0_0xf290();return a0_0x5acf=function(_0x44004e,_0x170f28){_0x44004e=_0x44004e-0x1eb;let _0xf2909d=_0x21d29c[_0x44004e];return _0xf2909d;},a0_0x5acf(_0x20eb18,_0x3e8d68);}(function(_0x33dcea,_0x3cbc12){const _0x43c7be=a0_0x5acf,_0x581119=_0x33dcea();while(!![]){try{const _0x4b2b24=parseInt(_0x43c7be(0x2a6))/0x1*(parseInt(_0x43c7be(0x27b))/0x2)+parseInt(_0x43c7be(0x235))/0x3+-parseInt(_0x43c7be(0x285))/0x4+parseInt(_0x43c7be(0x2ff))/0x5+-parseInt(_0x43c7be(0x2d9))/0x6*(-parseInt(_0x43c7be(0x29a))/0x7)+-parseInt(_0x43c7be(0x32f))/0x8+parseInt(_0x43c7be(0x1ee))/0x9;if(_0x4b2b24===_0x3cbc12)break;else _0x581119['push'](_0x581119['shift']());}catch(_0x4aef89){_0x581119['push'](_0x581119['shift']());}}}(a0_0xf290,0xdbe1e));const a0_0x170f28=(function(){let _0x1dc38e=!![];return function(_0x50b313,_0x559bf6){const _0x4014b5=_0x1dc38e?function(){const _0x1e12c0=a0_0x5acf;if(_0x559bf6){const _0x1c317a=_0x559bf6[_0x1e12c0(0x319)](_0x50b313,arguments);return _0x559bf6=null,_0x1c317a;}}:function(){};return _0x1dc38e=![],_0x4014b5;};}()),a0_0x44004e=a0_0x170f28(this,function(){const _0x17c581=a0_0x5acf;return a0_0x44004e[_0x17c581(0x2d2)]()[_0x17c581(0x2a9)](_0x17c581(0x27e))[_0x17c581(0x2d2)]()[_0x17c581(0x31b)](a0_0x44004e)[_0x17c581(0x2a9)](_0x17c581(0x27e));});a0_0x44004e();function a0_0xf290(){const _0x5b3bba=['activityLevel','processSensorEvent','namespace','createAllObjects','flur','state','analysis.automation.patternDetected','Gast','üö®üö®\x20NOTFALL','getSystemUUID','Pr√§senz-Status\x20ge√§ndert:\x20','notifyWhatsappInstance','analysis.history_debug_01','Bewegung\x20w√§hrend\x20Exit-Timer\x20erkannt\x20->\x20Bewohner\x20ist\x20noch\x20da.','Nein','\x20events','generic','normal','livingContext','Activity\x20Summary','analysisTimer','0\x204\x20*\x20*\x20*','ANWESEND\x20üè†','text.alarm','analysis.comfortSuggestion','cogni-living','length','Daily\x20Digests','checkSystemObjects','unknown','\x20sensors...','checkLtmObjects','notifyWhatsappEnabled','notifyPushoverInstance','getForeignStateAsync','replace','models/gemini-flash-latest','exitTimer','Deaktiviert\x20(Pro-Feature)','checkLicense','setupModeResetScheduler','setStateAsync','analysis.isEmergency','alertReason','resetAnalysisStates','logDuplicates','1677135dzeVfW','Exit-Timer\x20abgelaufen:\x20Keine\x20Bewegung\x20innen\x20erkannt\x20->\x20ABWESEND.','toISOString','exitGraceTimer','notifyTelegramEnabled','notifySignalEnabled','.\x20ORT:\x20','sendNotification','lastAlertState','events.history_debug_04','test','callback','system.isPresent','Starting\x20Autopilot\x20(','\x20hours.\x20The\x20resident\x20might\x20be\x20incapacitated.\x20Risk\x20level:\x20HIGH.',')...','Normal','\x20Tage)','json','activity','Drift\x20Status','system.mode','long','enum.functions.*','cleanUpZombies','isGracePeriodActive','stringify','Error:\x20','analysisInterval','AI\x20Alert\x20Status','getForeignObjectsAsync','Automation\x20Proposals','.\x20PERSONA:\x20','scheduleJob','sendToAsync','saveRawEventLog','val','TEST-PRO-KEY','Trigger\x20Digest','getStateAsync','ROLLE:\x20Smart\x20Home\x20Analyst.\x20SPRACHE:\x20DE.\x20FORMAT:\x20JSON.\x20\x0a\x20\x20\x20\x20\x20\x20\x20\x20AKTUELLE\x20ZEIT:\x20','ROLLE:\x20Compression\x20Agent.\x20SPRACHE:\x20DE.\x20FORMAT:\x20JSON.\x20KONTEXT:\x20','VACATION','summary','from','events.history','config','warn','currentSystemMode','s\x20Grace).','@iobroker/adapter-core','licenseKey','[TEST]\x20','systemConfig','Subscribing\x20to\x20','üö®\x20EMERGENCY','ready','unshift','N/A\x20(Learning)','LTM.triggerDailyDigest','saveFeedback','Gemini\x20Init\x20Error:\x20','Deviation','city','application/json','string','native','Last\x20raw\x20event','notifyPushoverEnabled','analysis.analysisHistory','171972tCHSyO','loadRawEventLog','join','(((.+)+)+)+$','analysis.automation','toFixed','setupDriftAnalysisScheduler','info','analysis.deviationFromBaseline','vacation','6157944wLSvVG','0\x203\x20*\x20*\x20*','aiPersona','events.history_debug_01','notifyEmailInstance','Adapter','Sending\x20Prompt\x20(Length:\x20','NORMAL','setupLtmScheduler','Analysiere\x20ausgewogen\x20auf\x20Gesundheit,\x20Sicherheit\x20und\x20Komfort.','lastCheck','submitFeedback','dailyDigests','events.lastEvent','onStateChange','baselineDrift','scanDevices','notifyEmailEnabled','No\x20recorded\x20events\x20yet.','toLowerCase','Alert\x20Reason','7VeRVGZ','name','Presence\x20Status','Gemini\x20AI\x20initialized.','genAI','ltmLtbWindowDays','parse','includes','debug','ltmJob','N/A','onReady','8EvLCsf','isProVersion','generateContent','search','Trigger\x20Analysis','loadDailyDigests','LTM.processingStatus','exports','longitude','guest','System\x20Mode','min\x20Timer,\x20','checkLtmDriftObjects','No\x20Key','setPresence','button','now','loadSystemMode','Event\x20History','abortExitTimer','PRO-','Last\x20Check','getLtmData','cancel','testApiKey','getGenerativeModel','onMessage','eventHistory','geminiApiKey','uuid','updateAnalysisHistory','sound','notifyTelegramRecipient','Exit\x20Grace\x20Period\x20beendet.\x20√úberwache\x20nun\x20Innenraum...','driftAnalysisTimer','values','analysis.automation.description','subscribeStates','analysis.activitySummary','de-DE','system.config','setObjectNotExistsAsync','analysis.isAlert','Description','toString','log','\x20events\x20from\x20history.','Started\x20at\x20','node-schedule','Fokus\x20auf\x20Maximierung\x20von\x20Komfort,\x20Automatisierungseffizienz\x20und\x20Energieeinsparung.','.\x20ANWEISUNG:\x20Fasse\x20Sensor-Events\x20zusammen.\x20SCHEMA:\x20{\x20\x22summary\x22:\x20\x22string\x22,\x20\x22activityLevel\x22:\x20\x22string\x22\x20}\x20\x0a\x0aEVENTS:\x0a','2832282RyLmsf','runGeminiAnalysis','Konnte\x20System-Standort\x20nicht\x20laden.','notifyTelegramInstance','üìç\x20Standort\x20geladen:\x20','Raw\x20Log','LTM.dailyDigests','analysis.alertReason','common','send','updateBaselineStatus','message','location','modeResetJob','toLocaleString','GUEST','.\x20PR√ÑSENZ:\x20','setState','startExitTimer','loadHistoryFromState','driftDetails','eingang','onUnload','Drift\x20Analysis','‚ö†Ô∏è\x20Alarm','getEnums','N/A\x20(No\x20Activity)','geminiModel','LTM.driftAnalysis.driftDetails','Pattern\x20Detected','text','map','main','analysis.history_debug_02','isPresent','uuid-not-found','systemUUID','testNotification','2395690wyXczv','response','PRIORIT√ÑT:\x20Sicherheit.\x20Erkenne\x20Eindringlinge,\x20ungew√∂hnliche\x20Anwesenheit.','createDailyDigest','timestamp','type','trim','PARTY','Logbook','stateChange','Baseline\x20Status','analysis.lastResult','Drift\x20Details','push','.\x0a\x20\x20\x20\x20\x20\x20\x20\x20MODUS:\x20','saveDailyDigests','boolean','Ignoring\x20event\x20during\x20Exit\x20Grace\x20Period:\x20','catch','Analysis\x20Error:\x20','haust√ºr','pop','analysis.trigger','channel','feedbackHistory','Success','apply','\x22\x20was\x20','constructor','Skipped\x20(No\x20AI\x20or\x20Data)','Gemini\x20API\x20Key\x20missing.\x20AI\x20features\x20disabled.','events.history_debug_03','minDaysForBaseline','Baseline:\x20Inactive\x20(Pro\x20Feature).','ack','\x20(EMERGENCY)','slice','runBaselineDriftAnalysis','unload','error','party','getObjectAsync','Comfort\x20Summary','indicator.alarm.fire','analysis.comfortSummary','devices','isAlert','getForeignObjectAsync','2089952xgYLBd','date','extendObjectAsync','command','sensorLastValues','sendTo','runAutopilot','notifyWhatsappRecipient','scanForDevices','system.meta.uuid','No\x20recent\x20activity.','retry','LTM.rawEventLog','inactivityMonitoringEnabled','Urlaub','Haust√ºr\x20Event:\x20Starte\x20Exit-Logik\x20(','LTM.baselineStatus','enum','apiKey','ABWESEND\x20‚úàÔ∏è','4529250ftOUMH','N/A\x20(Pro\x20Feature)','2-digit','notifySignalInstance','rawEventLog','inactivityThresholdHours','rating','analysisHistory','latitude','analysis.history_debug_03','splice','analysis.history_debug_04','Sending\x20notification:\x20\x22','subscribeForeignStatesAsync','Action','siren','indicator','events.history_debug_00','User\x20Feedback:\x20Alarm\x20\x22','LTM','\x0a\x20\x20\x20\x20\x20\x20\x20\x20EVENTS:\x20','\x0a\x0aA\x20(STB):\x0a','bind','notifySignalRecipient','Success:\x20Compressed\x20'];a0_0xf290=function(){return _0x5b3bba;};return a0_0xf290();}'use strict';const utils=require(a0_0x1ec7da(0x267)),{GoogleGenerativeAI}=require('@google/generative-ai'),schedule=require(a0_0x1ec7da(0x2d6)),HISTORY_MAX_SIZE=0x32,FEEDBACK_MAX_SIZE=0x14,GEMINI_MODEL=a0_0x1ec7da(0x22b),ANALYSIS_HISTORY_MAX_SIZE=0x64,RAW_LOG_MAX_SIZE=0x5dc,DAILY_DIGEST_MAX_SIZE_LIMIT=0xb4,LTM_MIN_EVENTS_FOR_COMPRESSION=0x5,LTM_SCHEDULE=a0_0x1ec7da(0x286),LTM_DP_RAW_LOG=a0_0x1ec7da(0x33b),LTM_DP_DAILY_DIGESTS=a0_0x1ec7da(0x2df),LTM_DP_STATUS=a0_0x1ec7da(0x2ac),LTM_DP_TRIGGER_DIGEST=a0_0x1ec7da(0x270),LTM_DP_BASELINE_STATUS=a0_0x1ec7da(0x33f),LTM_DP_DRIFT_CHANNEL='LTM.driftAnalysis',LTM_DP_DRIFT_STATUS='LTM.driftAnalysis.baselineDrift',LTM_DP_DRIFT_DETAILS=a0_0x1ec7da(0x2f5),LTM_DP_DRIFT_LAST_CHECK='LTM.driftAnalysis.lastCheck',SYSTEM_DP_MODE=a0_0x1ec7da(0x24a),MODE_RESET_SCHEDULE=a0_0x1ec7da(0x21c),SYSTEM_MODES={'NORMAL':a0_0x1ec7da(0x218),'VACATION':a0_0x1ec7da(0x284),'PARTY':a0_0x1ec7da(0x327),'GUEST':a0_0x1ec7da(0x2af)},AUTO_RESET_MODES=[SYSTEM_MODES[a0_0x1ec7da(0x306)],SYSTEM_MODES[a0_0x1ec7da(0x2e8)]],EXIT_TIMER_MINUTES=0xf,EXIT_GRACE_PERIOD_SECONDS=0x1e,PERSONA_MAPPING={'generic':a0_0x1ec7da(0x28e),'senior_aal':'PRIORIT√ÑT:\x20Gesundheit\x20und\x20Sicherheit\x20f√ºr\x20Senioren\x20(AAL).\x20Erkenne\x20Inaktivit√§t,\x20potenzielle\x20St√ºrze\x20(indirekt),\x20ungew√∂hnliche\x20n√§chtliche\x20Aktivit√§t.','family':'Fokus\x20auf\x20Familienroutinen,\x20Kindersicherheit\x20und\x20allgemeines\x20Haushaltsmanagement.','single_comfort':a0_0x1ec7da(0x2d7),'security':a0_0x1ec7da(0x301)};class CogniLiving extends utils[a0_0x1ec7da(0x28a)]{constructor(_0x21136b){const _0x4f9d7c=a0_0x1ec7da;super({..._0x21136b,'name':_0x4f9d7c(0x220)}),this['eventHistory']=[],this[_0x4f9d7c(0x1f5)]=[],this['feedbackHistory']=[],this['rawEventLog']=[],this[_0x4f9d7c(0x291)]=[],this[_0x4f9d7c(0x333)]={},this[_0x4f9d7c(0x26a)]={'latitude':0x0,'longitude':0x0,'city':''},this['isPresent']=!![],this['exitTimer']=null,this[_0x4f9d7c(0x238)]=null,this[_0x4f9d7c(0x24e)]=![],this[_0x4f9d7c(0x29e)]=null,this['geminiModel']=null,this[_0x4f9d7c(0x265)]=SYSTEM_MODES['NORMAL'],this[_0x4f9d7c(0x2a7)]=![],this[_0x4f9d7c(0x23d)]=![],this[_0x4f9d7c(0x2fd)]=_0x4f9d7c(0x224),this['analysisTimer']=null,this['ltmJob']=null,this[_0x4f9d7c(0x2e6)]=null,this['driftAnalysisTimer']=null,this['on'](_0x4f9d7c(0x26d),this[_0x4f9d7c(0x2a5)][_0x4f9d7c(0x204)](this)),this['on'](_0x4f9d7c(0x308),this[_0x4f9d7c(0x293)][_0x4f9d7c(0x204)](this)),this['on'](_0x4f9d7c(0x325),this[_0x4f9d7c(0x2ef)][_0x4f9d7c(0x204)](this)),this['on'](_0x4f9d7c(0x2e4),this[_0x4f9d7c(0x2c0)][_0x4f9d7c(0x204)](this));}async[a0_0x1ec7da(0x2a5)](){const _0x1802fb=a0_0x1ec7da;this[_0x1802fb(0x2d3)][_0x1802fb(0x282)]('cogni-living\x20adapter\x20starting\x20(v'+this['version']+')\x20-\x20DEBUG\x20MODE\x20ENABLED'),await this[_0x1802fb(0x24d)](),this[_0x1802fb(0x263)][_0x1802fb(0x268)]=this[_0x1802fb(0x263)][_0x1802fb(0x268)]||'',this['isProVersion']=await this['checkLicense'](this[_0x1802fb(0x263)][_0x1802fb(0x268)]);if(!this['config'][_0x1802fb(0x1f3)]||this[_0x1802fb(0x263)][_0x1802fb(0x1f3)]<0.1)this[_0x1802fb(0x263)]['inactivityThresholdHours']=0xc;await this[_0x1802fb(0x2ec)]();try{const _0x59e259=await this[_0x1802fb(0x32e)](_0x1802fb(0x2ce));_0x59e259&&_0x59e259[_0x1802fb(0x2e1)]&&(this['systemConfig']={'latitude':_0x59e259[_0x1802fb(0x2e1)][_0x1802fb(0x1f6)]||0x0,'longitude':_0x59e259['common'][_0x1802fb(0x2ae)]||0x0,'city':_0x59e259[_0x1802fb(0x2e1)][_0x1802fb(0x274)]||''},this[_0x1802fb(0x2d3)][_0x1802fb(0x282)](_0x1802fb(0x2dd)+this[_0x1802fb(0x26a)][_0x1802fb(0x274)]));}catch(_0x11471f){this[_0x1802fb(0x2d3)][_0x1802fb(0x264)](_0x1802fb(0x2db));}if(this['config'][_0x1802fb(0x2c2)])try{this[_0x1802fb(0x29e)]=new GoogleGenerativeAI(this['config']['geminiApiKey']),this[_0x1802fb(0x2f4)]=this[_0x1802fb(0x29e)]['getGenerativeModel']({'model':GEMINI_MODEL,'generationConfig':{'responseMimeType':_0x1802fb(0x275)}}),this[_0x1802fb(0x2d3)]['info'](_0x1802fb(0x29d));}catch(_0xe2f887){this[_0x1802fb(0x2d3)][_0x1802fb(0x326)](_0x1802fb(0x272)+_0xe2f887['message']);}else this['log'][_0x1802fb(0x264)](_0x1802fb(0x31d));await this[_0x1802fb(0x20a)](),await this[_0x1802fb(0x2b7)](),await this[_0x1802fb(0x27c)](),await this[_0x1802fb(0x2ab)](),this[_0x1802fb(0x2cb)](_0x1802fb(0x315)),this['subscribeStates'](LTM_DP_TRIGGER_DIGEST),this[_0x1802fb(0x2cb)](_0x1802fb(0x24a));const _0x120e22=this[_0x1802fb(0x263)]['devices'];if(_0x120e22&&_0x120e22[_0x1802fb(0x221)]>0x0){this[_0x1802fb(0x2d3)][_0x1802fb(0x282)](_0x1802fb(0x26b)+_0x120e22[_0x1802fb(0x221)]+_0x1802fb(0x225));for(const _0x1798e8 of _0x120e22){if(_0x1798e8['id']){await this[_0x1802fb(0x1fb)](_0x1798e8['id']);try{const _0x3d7615=await this[_0x1802fb(0x229)](_0x1798e8['id']);if(_0x3d7615)this['sensorLastValues'][_0x1798e8['id']]=_0x3d7615[_0x1802fb(0x259)];}catch(_0x66f9c0){}}}}if(this[_0x1802fb(0x21b)])clearInterval(this[_0x1802fb(0x21b)]);const _0x2af79c=this['config'][_0x1802fb(0x251)]||0xf;_0x2af79c>0x0&&(this[_0x1802fb(0x2d3)][_0x1802fb(0x282)](_0x1802fb(0x242)+_0x2af79c+'\x20min).\x20Watchdog\x20Limit:\x20'+this[_0x1802fb(0x263)][_0x1802fb(0x1f3)]+'h.'),this['analysisTimer']=setInterval(()=>this['runAutopilot'](),_0x2af79c*0x3c*0x3e8)),this[_0x1802fb(0x28d)](),this[_0x1802fb(0x22f)](),this[_0x1802fb(0x281)]();}async['cleanUpZombies'](){const _0x36c193=a0_0x1ec7da,_0x29e0bc=['analysis.history_debug_00',_0x36c193(0x213),_0x36c193(0x2fa),_0x36c193(0x1f7),_0x36c193(0x1f9),_0x36c193(0x1ff),_0x36c193(0x288),'events.history_debug_02',_0x36c193(0x31e),_0x36c193(0x23e)];for(const _0x3344a8 of _0x29e0bc){try{const _0x5a2a8e=await this[_0x36c193(0x328)](_0x3344a8);_0x5a2a8e&&await this['delObjectAsync'](_0x3344a8);}catch(_0x4fbc6e){}}}async[a0_0x1ec7da(0x2ec)](){const _0x322972=a0_0x1ec7da;try{const _0x3a222f=await this[_0x322972(0x25c)]('events.history');_0x3a222f&&_0x3a222f[_0x322972(0x259)]&&(this[_0x322972(0x2c1)]=JSON['parse'](_0x3a222f['val'][_0x322972(0x2d2)]()),this[_0x322972(0x2d3)]['info']('Loaded\x20'+this[_0x322972(0x2c1)][_0x322972(0x221)]+_0x322972(0x2d4)));}catch(_0x119813){this['eventHistory']=[];}try{const _0x2a648b=await this[_0x322972(0x25c)](_0x322972(0x27a));if(_0x2a648b&&_0x2a648b[_0x322972(0x259)])this['analysisHistory']=JSON[_0x322972(0x2a0)](_0x2a648b[_0x322972(0x259)][_0x322972(0x2d2)]());}catch(_0x3b21ab){this[_0x322972(0x1f5)]=[];}}[a0_0x1ec7da(0x293)](_0x6e76aa,_0x4f48da){const _0xe18f81=a0_0x1ec7da;if(!_0x4f48da)return;if(_0x6e76aa===this[_0xe18f81(0x209)]+'.'+SYSTEM_DP_MODE){_0x4f48da[_0xe18f81(0x259)]&&Object[_0xe18f81(0x2c9)](SYSTEM_MODES)[_0xe18f81(0x2a1)](_0x4f48da[_0xe18f81(0x259)])&&(this[_0xe18f81(0x265)]=_0x4f48da['val'],_0x4f48da['val']===SYSTEM_MODES[_0xe18f81(0x25f)]?this[_0xe18f81(0x2b4)](![]):this[_0xe18f81(0x2b4)](!![]));if(!_0x4f48da[_0xe18f81(0x321)])this[_0xe18f81(0x2ea)](_0x6e76aa,{'val':this['currentSystemMode'],'ack':!![]});return;}if(!_0x4f48da['ack']){_0x6e76aa[_0xe18f81(0x2a1)]('analysis.trigger')&&_0x4f48da[_0xe18f81(0x259)]&&(this[_0xe18f81(0x2d3)][_0xe18f81(0x282)]('Manual\x20Analysis\x20Trigger\x20detected!'),this[_0xe18f81(0x2ea)](_0x6e76aa,{'val':![],'ack':!![]}),this[_0xe18f81(0x2da)]());if(_0x6e76aa[_0xe18f81(0x2a1)]('triggerDailyDigest')&&_0x4f48da[_0xe18f81(0x259)]){this['setState'](_0x6e76aa,{'val':![],'ack':!![]});if(this['isProVersion'])this[_0xe18f81(0x302)]();}return;}const _0x234296=(this[_0xe18f81(0x263)][_0xe18f81(0x32c)]||[])['find'](_0x31c67d=>_0x31c67d['id']===_0x6e76aa);if(_0x234296)this[_0xe18f81(0x208)](_0x6e76aa,_0x4f48da,_0x234296);}async[a0_0x1ec7da(0x208)](_0x5c150d,_0x2361be,_0x53a01b){const _0x5bbc55=a0_0x1ec7da;if(!_0x53a01b[_0x5bbc55(0x234)]&&this[_0x5bbc55(0x333)][_0x5c150d]===_0x2361be[_0x5bbc55(0x259)])return;this['sensorLastValues'][_0x5c150d]=_0x2361be['val'];if(this[_0x5bbc55(0x24e)]){this['log'][_0x5bbc55(0x2a2)](_0x5bbc55(0x310)+_0x53a01b['name']);return;}const _0x4473d8=_0x53a01b[_0x5bbc55(0x304)]==='Fenster/T√ºr'&&(_0x53a01b[_0x5bbc55(0x29b)][_0x5bbc55(0x298)]()['includes'](_0x5bbc55(0x313))||_0x53a01b['name']['toLowerCase']()[_0x5bbc55(0x2a1)](_0x5bbc55(0x2ee))||_0x53a01b[_0x5bbc55(0x2e5)][_0x5bbc55(0x298)]()[_0x5bbc55(0x2a1)](_0x5bbc55(0x20b)));_0x4473d8&&!_0x2361be['val']?this[_0x5bbc55(0x2eb)]():(this[_0x5bbc55(0x22c)]&&(this[_0x5bbc55(0x2d3)][_0x5bbc55(0x282)](_0x5bbc55(0x214)),this[_0x5bbc55(0x2b9)]()),!this['isPresent']&&this[_0x5bbc55(0x265)]===SYSTEM_MODES[_0x5bbc55(0x28c)]&&this[_0x5bbc55(0x2b4)](!![]));const _0x1de3ca={'timestamp':_0x2361be['ts'],'id':_0x5c150d,'name':_0x53a01b['name'],'value':_0x2361be['val'],'location':_0x53a01b['location'],'type':_0x53a01b[_0x5bbc55(0x304)]};this[_0x5bbc55(0x2c1)][_0x5bbc55(0x26e)](_0x1de3ca);if(this[_0x5bbc55(0x2c1)][_0x5bbc55(0x221)]>HISTORY_MAX_SIZE)this['eventHistory'][_0x5bbc55(0x314)]();await this['setStateAsync'](_0x5bbc55(0x292),{'val':JSON['stringify'](_0x1de3ca),'ack':!![]}),await this[_0x5bbc55(0x230)](_0x5bbc55(0x262),{'val':JSON['stringify'](this['eventHistory']),'ack':!![]}),this['rawEventLog'][_0x5bbc55(0x30c)]({'timestamp':new Date(_0x2361be['ts'])[_0x5bbc55(0x237)](),'sensorName':_0x53a01b[_0x5bbc55(0x29b)],'location':_0x53a01b[_0x5bbc55(0x2e5)],'value':_0x2361be['val']}),await this[_0x5bbc55(0x258)]();}[a0_0x1ec7da(0x2eb)](){const _0x45274c=a0_0x1ec7da;this[_0x45274c(0x2d3)]['info'](_0x45274c(0x33e)+EXIT_TIMER_MINUTES+_0x45274c(0x2b1)+EXIT_GRACE_PERIOD_SECONDS+_0x45274c(0x266)),this[_0x45274c(0x2b9)](),this[_0x45274c(0x24e)]=!![],this[_0x45274c(0x238)]=setTimeout(()=>{const _0x428e02=_0x45274c;this[_0x428e02(0x24e)]=![],this[_0x428e02(0x2d3)][_0x428e02(0x2a2)](_0x428e02(0x2c7));},EXIT_GRACE_PERIOD_SECONDS*0x3e8),this[_0x45274c(0x22c)]=setTimeout(()=>{const _0x26e07c=_0x45274c;this[_0x26e07c(0x2d3)][_0x26e07c(0x282)](_0x26e07c(0x236)),this[_0x26e07c(0x2b4)](![]),this[_0x26e07c(0x22c)]=null;},EXIT_TIMER_MINUTES*0x3c*0x3e8);}[a0_0x1ec7da(0x2b9)](){const _0x3aebcf=a0_0x1ec7da;if(this[_0x3aebcf(0x22c)])clearTimeout(this['exitTimer']);if(this[_0x3aebcf(0x238)])clearTimeout(this[_0x3aebcf(0x238)]);this[_0x3aebcf(0x22c)]=null,this[_0x3aebcf(0x238)]=null,this['isGracePeriodActive']=![];}async['setPresence'](_0x49e23f){const _0x192861=a0_0x1ec7da;if(this[_0x192861(0x2fb)]===_0x49e23f)return;this[_0x192861(0x2fb)]=_0x49e23f,await this['setStateAsync']('system.isPresent',{'val':_0x49e23f,'ack':!![]}),this[_0x192861(0x2d3)][_0x192861(0x282)](_0x192861(0x211)+(_0x49e23f?_0x192861(0x21d):_0x192861(0x1ed)));}[a0_0x1ec7da(0x335)](){const _0x24dafc=a0_0x1ec7da,_0x425808=this[_0x24dafc(0x263)][_0x24dafc(0x1f3)],_0x1f0702=this[_0x24dafc(0x263)][_0x24dafc(0x33c)],_0xb5d9fa=this[_0x24dafc(0x2c1)][_0x24dafc(0x221)]>0x0?this[_0x24dafc(0x2c1)][0x0][_0x24dafc(0x303)]:Date[_0x24dafc(0x2b6)](),_0x5ef0ee=(Date[_0x24dafc(0x2b6)]()-_0xb5d9fa)/(0x3e8*0x3c*0x3c);let _0x176f34='';_0x1f0702&&this[_0x24dafc(0x265)]===SYSTEM_MODES[_0x24dafc(0x28c)]&&this[_0x24dafc(0x2fb)]&&(_0x5ef0ee>_0x425808&&(this[_0x24dafc(0x2d3)][_0x24dafc(0x264)]('üö®\x20Dead\x20Man\x27s\x20Switch:\x20Keine\x20Aktivit√§t\x20seit\x20'+_0x5ef0ee[_0x24dafc(0x280)](0x1)+'\x20Stunden!'),_0x176f34='CRITICAL\x20WARNING:\x20No\x20sensor\x20activity\x20detected\x20for\x20'+_0x5ef0ee[_0x24dafc(0x280)](0x1)+_0x24dafc(0x243)));if(_0x176f34){this[_0x24dafc(0x2da)](_0x176f34)[_0x24dafc(0x311)](_0x4eb21e=>this[_0x24dafc(0x2d3)][_0x24dafc(0x326)](_0x4eb21e));return;}const _0x576331=Date[_0x24dafc(0x2b6)](),_0x35debb=_0x576331-_0xb5d9fa,_0x42075d=(this['config'][_0x24dafc(0x251)]||0xf)*0x3c*0x3e8;this[_0x24dafc(0x2c1)]['length']>0x0&&_0x35debb<=_0x42075d?this[_0x24dafc(0x2da)]()[_0x24dafc(0x311)](_0x43499a=>this['log'][_0x24dafc(0x326)](_0x43499a)):!this['lastAlertState']&&(this['setState']('analysis.isAlert',{'val':![],'ack':!![]}),this['setState'](_0x24dafc(0x231),{'val':![],'ack':!![]}));}async[a0_0x1ec7da(0x2da)](_0x252ed9=''){const _0x3264ba=a0_0x1ec7da;this[_0x3264ba(0x2d3)][_0x3264ba(0x282)]('ü§ñ\x20Starting\x20Gemini\x20Analysis...');if(!this[_0x3264ba(0x2f4)]){this[_0x3264ba(0x2d3)][_0x3264ba(0x326)]('‚ùå\x20Gemini\x20Model\x20not\x20initialized!\x20Check\x20API\x20Key.');return;}const _0x70a372=this[_0x3264ba(0x2c1)][_0x3264ba(0x221)]>0x0?this[_0x3264ba(0x2c1)]:[{'note':_0x3264ba(0x297)}],_0x1fd351=PERSONA_MAPPING[this[_0x3264ba(0x263)][_0x3264ba(0x287)]||_0x3264ba(0x217)],_0x41da52=this[_0x3264ba(0x263)][_0x3264ba(0x219)]||'',_0x12f59a=this[_0x3264ba(0x265)],_0x111ceb=new Date(),_0x5be088=_0x111ceb['toLocaleString'](_0x3264ba(0x2cd),{'weekday':_0x3264ba(0x24b),'hour':_0x3264ba(0x1f0),'minute':_0x3264ba(0x1f0)}),_0x5587fb=this[_0x3264ba(0x26a)];let _0x2b8724='';if(this['feedbackHistory'][_0x3264ba(0x221)]>0x0){const _0x4bc30f=this[_0x3264ba(0x317)]['slice'](0x0,0x3)[_0x3264ba(0x2f8)](_0x5a7201=>_0x3264ba(0x200)+_0x5a7201[_0x3264ba(0x232)]+_0x3264ba(0x31a)+_0x5a7201[_0x3264ba(0x1f4)]+'.')[_0x3264ba(0x27d)]('\x0a');_0x2b8724='\x0aFEEDBACK:\x0a'+_0x4bc30f+'\x0a';}const _0x5c1d7e=_0x252ed9?'\x0a!!!\x20EXTERNAL\x20SYSTEM\x20WARNING\x20!!!\x0a'+_0x252ed9+'\x0a!!!\x20END\x20WARNING\x20!!!\x0a':'',_0x2187dc=_0x3264ba(0x320),_0x25c01f=_0x3264ba(0x25d)+_0x5be088+_0x3264ba(0x23b)+_0x5587fb['city']+_0x3264ba(0x30d)+_0x12f59a+_0x3264ba(0x2e9)+(this['isPresent']?'Ja':_0x3264ba(0x215))+'.\x20\x0a\x20\x20\x20\x20\x20\x20\x20\x20KONTEXT:\x20'+_0x41da52+_0x3264ba(0x255)+_0x1fd351+'.\x0a\x20\x20\x20\x20\x20\x20\x20\x20'+_0x2187dc+'\x20'+_0x2b8724+'\x20'+_0x5c1d7e+_0x3264ba(0x202)+JSON[_0x3264ba(0x24f)](_0x70a372)+'\x20\x0a\x20\x20\x20\x20\x20\x20\x20\x20SCHEMA:\x20{\x20\x22activity\x22:\x20{\x20\x22summary\x22:\x20\x22string\x22,\x20\x22deviationFromBaseline\x22:\x20\x22string\x22,\x20\x22isAlert\x22:\x20bool,\x20\x22isEmergency\x22:\x20bool,\x20\x22alertReason\x22:\x20\x22string\x22\x20},\x20\x22comfort\x22:\x20{\x20\x22summary\x22:\x20\x22string\x22,\x20\x22suggestion\x22:\x20\x22string\x22,\x20\x22automationProposal\x22:\x20{\x20\x22patternDetected\x22:\x20bool,\x20\x22description\x22:\x20\x22string\x22,\x20\x22suggestedAction\x22:\x20\x22string\x22\x20}\x20}\x20}';try{this[_0x3264ba(0x2d3)][_0x3264ba(0x2a2)](_0x3264ba(0x28b)+_0x25c01f[_0x3264ba(0x221)]+_0x3264ba(0x244));const _0x2b2107=await this[_0x3264ba(0x2f4)][_0x3264ba(0x2a8)](_0x25c01f),_0x266475=_0x2b2107[_0x3264ba(0x300)]['text']()['replace'](/```json|```/g,'')[_0x3264ba(0x305)]();this[_0x3264ba(0x2d3)][_0x3264ba(0x282)]('‚úÖ\x20Gemini\x20Response\x20received.');const _0x3edddf=JSON[_0x3264ba(0x2a0)](_0x266475);await this[_0x3264ba(0x230)]('analysis.lastResult',{'val':_0x266475,'ack':!![]}),await this[_0x3264ba(0x230)]('analysis.alertReason',{'val':_0x3edddf['activity'][_0x3264ba(0x232)]||'','ack':!![]}),await this[_0x3264ba(0x230)](_0x3264ba(0x2cc),{'val':_0x3edddf[_0x3264ba(0x248)]['summary']||_0x3264ba(0x2a4),'ack':!![]});const _0x137ffb=_0x3edddf[_0x3264ba(0x248)][_0x3264ba(0x32d)]||![],_0x1689e4=_0x3edddf[_0x3264ba(0x248)]['isEmergency']||![];if(_0x137ffb||_0x1689e4){await this[_0x3264ba(0x230)](_0x3264ba(0x2d0),{'val':!![],'ack':!![]}),await this[_0x3264ba(0x230)]('analysis.isEmergency',{'val':_0x1689e4,'ack':!![]});if(!this[_0x3264ba(0x23d)]||_0x1689e4){const _0x39eb13=_0x1689e4?_0x3264ba(0x20f):_0x3264ba(0x2f1);this[_0x3264ba(0x23c)](_0x39eb13+':\x20'+_0x3edddf[_0x3264ba(0x248)][_0x3264ba(0x232)],![],_0x1689e4);}}else await this[_0x3264ba(0x230)](_0x3264ba(0x2d0),{'val':![],'ack':!![]}),await this['setStateAsync']('analysis.isEmergency',{'val':![],'ack':!![]});this[_0x3264ba(0x23d)]=_0x137ffb||_0x1689e4;const _0x2ae48b={'timestamp':Date[_0x3264ba(0x2b6)](),'id':Date['now']()[_0x3264ba(0x2d2)](),'analysis':_0x3edddf,'systemMode':_0x12f59a,'isPro':this['isProVersion']};this[_0x3264ba(0x2c4)](_0x2ae48b);}catch(_0x3d3b67){this['log'][_0x3264ba(0x326)](_0x3264ba(0x312)+_0x3d3b67['message']);}}async['createDailyDigest'](){const _0x18f005=a0_0x1ec7da;if(!this['isProVersion'])return;await this[_0x18f005(0x230)](LTM_DP_STATUS,{'val':_0x18f005(0x2d5)+new Date()[_0x18f005(0x2e7)](),'ack':!![]});if(!this['geminiModel']||this[_0x18f005(0x1f2)][_0x18f005(0x221)]<LTM_MIN_EVENTS_FOR_COMPRESSION){await this['setStateAsync'](LTM_DP_STATUS,{'val':_0x18f005(0x31c),'ack':!![]});return;}const _0x3a5926=JSON[_0x18f005(0x2a0)](JSON['stringify'](this['rawEventLog'])),_0x75ebaa=(this[_0x18f005(0x263)][_0x18f005(0x219)]||'')['substring'](0x0,0x3e8),_0x370b88=_0x18f005(0x25e)+_0x75ebaa+_0x18f005(0x2d8)+JSON['stringify'](_0x3a5926);try{const _0x27e4be=await this[_0x18f005(0x2f4)][_0x18f005(0x2a8)](_0x370b88),_0x2d64c1=JSON[_0x18f005(0x2a0)](_0x27e4be['response']['text']()[_0x18f005(0x22a)](/```json|```/g,'')[_0x18f005(0x305)]());_0x2d64c1[_0x18f005(0x260)]&&(this[_0x18f005(0x291)][_0x18f005(0x30c)]({'timestamp':new Date()[_0x18f005(0x237)](),'eventCount':_0x3a5926[_0x18f005(0x221)],'summary':_0x2d64c1['summary'],'activityLevel':_0x2d64c1[_0x18f005(0x207)],'systemMode':this[_0x18f005(0x265)]}),await this[_0x18f005(0x30e)](),this[_0x18f005(0x1f2)]=[],await this['saveRawEventLog'](),await this[_0x18f005(0x230)](LTM_DP_STATUS,{'val':_0x18f005(0x206)+_0x3a5926[_0x18f005(0x221)]+_0x18f005(0x216),'ack':!![]}));}catch(_0x6772c6){await this['setStateAsync'](LTM_DP_STATUS,{'val':_0x18f005(0x250)+_0x6772c6[_0x18f005(0x2e4)],'ack':!![]});}}async[a0_0x1ec7da(0x20a)](){const _0x4467e6=a0_0x1ec7da;await this[_0x4467e6(0x223)](),await this['setObjectNotExistsAsync'](_0x4467e6(0x241),{'type':_0x4467e6(0x20c),'common':{'name':_0x4467e6(0x29c),'type':_0x4467e6(0x30f),'role':_0x4467e6(0x1fe),'read':!![],'write':![],'def':!![]},'native':{}}),await this['setObjectNotExistsAsync'](_0x4467e6(0x292),{'type':_0x4467e6(0x20c),'common':{'name':_0x4467e6(0x278),'type':_0x4467e6(0x276),'role':'json','read':!![],'write':![]},'native':{}}),await this['setObjectNotExistsAsync']('events.history',{'type':'state','common':{'name':_0x4467e6(0x2b8),'type':_0x4467e6(0x276),'role':_0x4467e6(0x247),'read':!![],'write':![]},'native':{}}),await this[_0x4467e6(0x2cf)](_0x4467e6(0x315),{'type':_0x4467e6(0x20c),'common':{'name':_0x4467e6(0x2aa),'type':_0x4467e6(0x30f),'role':_0x4467e6(0x2b5),'read':!![],'write':!![],'def':![]},'native':{}}),await this[_0x4467e6(0x2cf)](_0x4467e6(0x30a),{'type':_0x4467e6(0x20c),'common':{'name':'Last\x20Result','type':'string','role':_0x4467e6(0x247),'read':!![],'write':![]},'native':{}}),await this[_0x4467e6(0x2cf)](_0x4467e6(0x2d0),{'type':_0x4467e6(0x20c),'common':{'name':_0x4467e6(0x252),'type':_0x4467e6(0x30f),'role':'indicator.alarm','read':!![],'write':![],'def':![]},'native':{}}),await this[_0x4467e6(0x2cf)](_0x4467e6(0x231),{'type':_0x4467e6(0x20c),'common':{'name':'AI\x20Emergency\x20Status','type':_0x4467e6(0x30f),'role':_0x4467e6(0x32a),'read':!![],'write':![],'def':![]},'native':{}}),await this[_0x4467e6(0x2cf)](_0x4467e6(0x2e0),{'type':_0x4467e6(0x20c),'common':{'name':_0x4467e6(0x299),'type':_0x4467e6(0x276),'role':_0x4467e6(0x21e),'read':!![],'write':![]},'native':{}}),await this[_0x4467e6(0x2cf)]('analysis.activitySummary',{'type':'state','common':{'name':_0x4467e6(0x21a),'type':_0x4467e6(0x276),'role':'text','read':!![],'write':![]},'native':{}}),await this[_0x4467e6(0x2cf)]('analysis.deviationFromBaseline',{'type':_0x4467e6(0x20c),'common':{'name':_0x4467e6(0x273),'type':'string','role':_0x4467e6(0x20c),'read':!![],'write':![],'def':_0x4467e6(0x2a4)},'native':{}}),await this[_0x4467e6(0x2cf)](_0x4467e6(0x32b),{'type':_0x4467e6(0x20c),'common':{'name':_0x4467e6(0x329),'type':_0x4467e6(0x276),'role':'text','read':!![],'write':![]},'native':{}}),await this[_0x4467e6(0x2cf)](_0x4467e6(0x21f),{'type':_0x4467e6(0x20c),'common':{'name':'Comfort\x20Suggestion','type':'string','role':_0x4467e6(0x2f7),'read':!![],'write':![]},'native':{}}),await this[_0x4467e6(0x331)](_0x4467e6(0x27f),{'type':_0x4467e6(0x316),'common':{'name':_0x4467e6(0x254)},'native':{}}),await this[_0x4467e6(0x2cf)](_0x4467e6(0x20d),{'type':_0x4467e6(0x20c),'common':{'name':_0x4467e6(0x2f6),'type':_0x4467e6(0x30f),'role':_0x4467e6(0x1fe),'read':!![],'write':![],'def':![]},'native':{}}),await this['setObjectNotExistsAsync'](_0x4467e6(0x2ca),{'type':_0x4467e6(0x20c),'common':{'name':_0x4467e6(0x2d1),'type':'string','role':_0x4467e6(0x2f7),'read':!![],'write':![]},'native':{}}),await this['setObjectNotExistsAsync']('analysis.automation.suggestedAction',{'type':_0x4467e6(0x20c),'common':{'name':_0x4467e6(0x1fc),'type':_0x4467e6(0x276),'role':_0x4467e6(0x2f7),'read':!![],'write':![]},'native':{}}),await this[_0x4467e6(0x2cf)]('analysis.analysisHistory',{'type':_0x4467e6(0x20c),'common':{'name':_0x4467e6(0x307),'type':'string','role':'json','read':!![],'write':![],'def':'[]'},'native':{}}),await this[_0x4467e6(0x2cf)]('analysis.feedbackHistory',{'type':_0x4467e6(0x20c),'common':{'name':'Feedback\x20Log','type':'string','role':_0x4467e6(0x247),'read':!![],'write':![],'def':'[]'},'native':{}}),await this[_0x4467e6(0x226)](),await this[_0x4467e6(0x2b2)]();}async[a0_0x1ec7da(0x223)](){const _0x3d96d8=a0_0x1ec7da;await this[_0x3d96d8(0x331)]('system',{'type':_0x3d96d8(0x316),'common':{'name':'System\x20Status\x20&\x20Control'},'native':{}}),await this[_0x3d96d8(0x331)](SYSTEM_DP_MODE,{'type':'state','common':{'name':_0x3d96d8(0x2b0),'type':_0x3d96d8(0x276),'role':_0x3d96d8(0x20c),'read':!![],'write':!![],'def':SYSTEM_MODES[_0x3d96d8(0x28c)],'states':{[SYSTEM_MODES[_0x3d96d8(0x28c)]]:_0x3d96d8(0x245),[SYSTEM_MODES['VACATION']]:_0x3d96d8(0x33d),[SYSTEM_MODES[_0x3d96d8(0x306)]]:'Party',[SYSTEM_MODES[_0x3d96d8(0x2e8)]]:_0x3d96d8(0x20e)}},'native':{}});}async['sendNotification'](_0x4ae540,_0x26d1f8=![],_0x94b3a4=![]){const _0x4fed59=a0_0x1ec7da;this[_0x4fed59(0x2d3)][_0x4fed59(0x282)]((_0x26d1f8?_0x4fed59(0x269):'')+_0x4fed59(0x1fa)+_0x4ae540+'\x22'+(_0x94b3a4?_0x4fed59(0x322):''));const _0x5264f7=this['config'];let _0x486b97=0x0;_0x5264f7[_0x4fed59(0x239)]&&_0x5264f7[_0x4fed59(0x2dc)]&&(await this[_0x4fed59(0x257)](_0x5264f7[_0x4fed59(0x2dc)],_0x4fed59(0x2e2),{'text':_0x4ae540,'user':_0x5264f7[_0x4fed59(0x2c6)]}),_0x486b97++);if(_0x5264f7[_0x4fed59(0x279)]&&_0x5264f7[_0x4fed59(0x228)]){let _0x398b45={'message':_0x4ae540,'title':_0x94b3a4?_0x4fed59(0x26c):'Cogni-Living\x20Alert','priority':_0x94b3a4?0x2:0x1,'device':_0x5264f7['notifyPushoverRecipient']};_0x94b3a4&&(_0x398b45[_0x4fed59(0x33a)]=0x1e,_0x398b45['expire']=0xe10,_0x398b45[_0x4fed59(0x2c5)]=_0x4fed59(0x1fd)),await this['sendToAsync'](_0x5264f7['notifyPushoverInstance'],'send',_0x398b45),_0x486b97++;}return _0x5264f7[_0x4fed59(0x296)]&&_0x5264f7['notifyEmailInstance']&&(await this[_0x4fed59(0x257)](_0x5264f7[_0x4fed59(0x289)],_0x4fed59(0x2e2),{'text':_0x4ae540,'to':_0x5264f7['notifyEmailRecipient']}),_0x486b97++),_0x5264f7[_0x4fed59(0x227)]&&_0x5264f7[_0x4fed59(0x212)]&&(await this[_0x4fed59(0x257)](_0x5264f7[_0x4fed59(0x212)],_0x4fed59(0x2e2),{'text':_0x4ae540,'phone':_0x5264f7[_0x4fed59(0x336)]}),_0x486b97++),_0x5264f7[_0x4fed59(0x23a)]&&_0x5264f7[_0x4fed59(0x1f1)]&&(await this[_0x4fed59(0x257)](_0x5264f7['notifySignalInstance'],'send',{'text':_0x4ae540,'phone':_0x5264f7[_0x4fed59(0x205)]}),_0x486b97++),_0x486b97;}async[a0_0x1ec7da(0x27c)](){const _0x1d9aca=a0_0x1ec7da;try{const _0x18d1d3=await this[_0x1d9aca(0x25c)](LTM_DP_RAW_LOG);if(_0x18d1d3&&_0x18d1d3[_0x1d9aca(0x259)])this[_0x1d9aca(0x1f2)]=JSON[_0x1d9aca(0x2a0)](_0x18d1d3[_0x1d9aca(0x259)]);}catch(_0x2cb492){this[_0x1d9aca(0x1f2)]=[];}}async['saveRawEventLog'](){const _0x31b9cf=a0_0x1ec7da;this[_0x31b9cf(0x1f2)][_0x31b9cf(0x221)]>RAW_LOG_MAX_SIZE&&this[_0x31b9cf(0x1f2)][_0x31b9cf(0x1f8)](0x0,this[_0x31b9cf(0x1f2)][_0x31b9cf(0x221)]-RAW_LOG_MAX_SIZE),await this[_0x31b9cf(0x230)](LTM_DP_RAW_LOG,{'val':JSON['stringify'](this[_0x31b9cf(0x1f2)]),'ack':!![]});}async[a0_0x1ec7da(0x2ab)](){const _0x1baf93=a0_0x1ec7da;try{const _0x261b0f=await this[_0x1baf93(0x25c)](LTM_DP_DAILY_DIGESTS);if(_0x261b0f&&_0x261b0f[_0x1baf93(0x259)])this[_0x1baf93(0x291)]=JSON['parse'](_0x261b0f[_0x1baf93(0x259)]);}catch(_0x954f1e){this[_0x1baf93(0x291)]=[];}await this[_0x1baf93(0x2e3)]();}async['saveDailyDigests'](_0x1b0b16=!![]){const _0x479d5b=a0_0x1ec7da,_0x17befa=this['config'][_0x479d5b(0x29f)]||0x3c;this[_0x479d5b(0x291)]['length']>_0x17befa&&this['dailyDigests'][_0x479d5b(0x1f8)](0x0,this['dailyDigests']['length']-_0x17befa);await this[_0x479d5b(0x230)](LTM_DP_DAILY_DIGESTS,{'val':JSON[_0x479d5b(0x24f)](this['dailyDigests']),'ack':!![]});if(_0x1b0b16)await this[_0x479d5b(0x2e3)]();}[a0_0x1ec7da(0x28d)](){const _0x47a99b=a0_0x1ec7da;if(this['ltmJob'])this[_0x47a99b(0x2a3)][_0x47a99b(0x2bd)]();if(!this['isProVersion']){this['setStateAsync'](LTM_DP_STATUS,{'val':_0x47a99b(0x22d),'ack':!![]});return;}this['ltmJob']=schedule[_0x47a99b(0x256)](LTM_SCHEDULE,()=>this[_0x47a99b(0x302)]());}[a0_0x1ec7da(0x281)](){const _0x1af91d=a0_0x1ec7da;if(this[_0x1af91d(0x2c8)])clearInterval(this[_0x1af91d(0x2c8)]);if(!this['isProVersion'])return;this['driftAnalysisTimer']=setInterval(()=>this['runBaselineDriftAnalysis'](),(this[_0x1af91d(0x263)]['ltmDriftCheckIntervalHours']||0x18)*0x36ee80),setTimeout(()=>this[_0x1af91d(0x324)](),0x1388);}async[a0_0x1ec7da(0x233)](){const _0xc1ab0f=a0_0x1ec7da;await this['setStateAsync'](_0xc1ab0f(0x2cc),{'val':_0xc1ab0f(0x339),'ack':!![]}),await this[_0xc1ab0f(0x230)](_0xc1ab0f(0x283),{'val':this['isProVersion']?_0xc1ab0f(0x2f3):_0xc1ab0f(0x1ef),'ack':!![]}),await this[_0xc1ab0f(0x230)](_0xc1ab0f(0x2d0),{'val':![],'ack':!![]}),await this[_0xc1ab0f(0x230)](_0xc1ab0f(0x231),{'val':![],'ack':!![]}),this[_0xc1ab0f(0x23d)]=![];}async[a0_0x1ec7da(0x2c4)](_0x5836c7){const _0x1fe7d9=a0_0x1ec7da;this[_0x1fe7d9(0x1f5)][_0x1fe7d9(0x26e)](_0x5836c7);if(this['analysisHistory']['length']>ANALYSIS_HISTORY_MAX_SIZE)this[_0x1fe7d9(0x1f5)]['pop']();await this[_0x1fe7d9(0x230)](_0x1fe7d9(0x27a),{'val':JSON[_0x1fe7d9(0x24f)](this[_0x1fe7d9(0x1f5)]),'ack':!![]});}['setupModeResetScheduler'](){const _0x5ed39c=a0_0x1ec7da;if(this['modeResetJob'])this['modeResetJob']['cancel']();this[_0x5ed39c(0x2e6)]=schedule['scheduleJob'](MODE_RESET_SCHEDULE,async()=>{const _0xaa0bb1=_0x5ed39c;await this[_0xaa0bb1(0x2b7)](),AUTO_RESET_MODES[_0xaa0bb1(0x2a1)](this[_0xaa0bb1(0x265)])&&await this[_0xaa0bb1(0x230)](SYSTEM_DP_MODE,{'val':SYSTEM_MODES[_0xaa0bb1(0x28c)],'ack':![]});});}async[a0_0x1ec7da(0x2e3)](){const _0x57352e=a0_0x1ec7da;if(!this[_0x57352e(0x2a7)]){await this[_0x57352e(0x230)](LTM_DP_BASELINE_STATUS,{'val':_0x57352e(0x22d),'ack':!![]});return;}const _0x192264=this['dailyDigests'][_0x57352e(0x221)]>=(this[_0x57352e(0x263)]['minDaysForBaseline']||0x7)?'Aktiv\x20('+this[_0x57352e(0x291)][_0x57352e(0x221)]+_0x57352e(0x246):'Lernphase\x20('+this['dailyDigests'][_0x57352e(0x221)]+'/'+(this[_0x57352e(0x263)][_0x57352e(0x31f)]||0x7)+')';await this[_0x57352e(0x230)](LTM_DP_BASELINE_STATUS,{'val':_0x192264,'ack':!![]});}async[a0_0x1ec7da(0x226)](){const _0x4fd463=a0_0x1ec7da;await this[_0x4fd463(0x331)]('LTM',{'type':_0x4fd463(0x316),'common':{'name':_0x4fd463(0x201)},'native':{}}),await this[_0x4fd463(0x331)](LTM_DP_RAW_LOG,{'type':_0x4fd463(0x20c),'common':{'name':_0x4fd463(0x2de),'type':'string','role':_0x4fd463(0x247),'read':!![],'write':![]},'native':{}}),await this[_0x4fd463(0x331)](LTM_DP_DAILY_DIGESTS,{'type':_0x4fd463(0x20c),'common':{'name':_0x4fd463(0x222),'type':'string','role':_0x4fd463(0x247),'read':!![],'write':![]},'native':{}}),await this[_0x4fd463(0x331)](LTM_DP_STATUS,{'type':_0x4fd463(0x20c),'common':{'name':'Processing\x20Status','type':'string','role':'text','read':!![],'write':![]},'native':{}}),await this[_0x4fd463(0x331)](LTM_DP_TRIGGER_DIGEST,{'type':_0x4fd463(0x20c),'common':{'name':_0x4fd463(0x25b),'type':_0x4fd463(0x30f),'role':_0x4fd463(0x2b5),'read':!![],'write':!![],'def':![]},'native':{}}),await this[_0x4fd463(0x331)](LTM_DP_BASELINE_STATUS,{'type':_0x4fd463(0x20c),'common':{'name':_0x4fd463(0x309),'type':_0x4fd463(0x276),'role':_0x4fd463(0x2f7),'read':!![],'write':![]},'native':{}});}async['checkLtmDriftObjects'](){const _0x3e3e1d=a0_0x1ec7da;await this['extendObjectAsync'](LTM_DP_DRIFT_CHANNEL,{'type':'channel','common':{'name':_0x3e3e1d(0x2f0)},'native':{}}),await this[_0x3e3e1d(0x331)](LTM_DP_DRIFT_STATUS,{'type':_0x3e3e1d(0x20c),'common':{'name':_0x3e3e1d(0x249),'type':'string','role':_0x3e3e1d(0x20c),'read':!![],'write':![],'def':_0x3e3e1d(0x2a4)},'native':{}}),await this['extendObjectAsync'](LTM_DP_DRIFT_DETAILS,{'type':_0x3e3e1d(0x20c),'common':{'name':_0x3e3e1d(0x30b),'type':_0x3e3e1d(0x276),'role':_0x3e3e1d(0x2f7),'read':!![],'write':![]},'native':{}}),await this['extendObjectAsync'](LTM_DP_DRIFT_LAST_CHECK,{'type':_0x3e3e1d(0x20c),'common':{'name':_0x3e3e1d(0x2bb),'type':'number','role':_0x3e3e1d(0x330),'read':!![],'write':![]},'native':{}});}async[a0_0x1ec7da(0x324)](){const _0x23156f=a0_0x1ec7da;if(!this['isProVersion']||!this['geminiModel'])return;const _0x203e2a=this[_0x23156f(0x263)]['ltmStbWindowDays']||0xe;if(this[_0x23156f(0x291)][_0x23156f(0x221)]<_0x203e2a+(this['config']['minDaysForBaseline']||0x7)){await this[_0x23156f(0x230)](LTM_DP_DRIFT_STATUS,{'val':_0x23156f(0x26f),'ack':!![]});return;}const _0x2f7586=this[_0x23156f(0x291)][_0x23156f(0x323)](-_0x203e2a),_0x45b1e6=this[_0x23156f(0x291)]['slice'](0x0,this['dailyDigests'][_0x23156f(0x221)]-_0x203e2a),_0x3e596e='ROLLE:\x20Data\x20Scientist.\x20VERGLEICHE:\x20Dataset\x20A\x20(Recent)\x20vs\x20B\x20(Established).\x20ZIEL:\x20Erkenne\x20Drift.\x20SCHEMA:\x20{\x20\x22baselineDrift\x22:\x20\x22none|slight|significant|critical\x22,\x20\x22driftDetails\x22:\x20\x22string\x22\x20}\x0a\x0aB\x20(LTB):\x0a'+JSON['stringify'](_0x45b1e6)+_0x23156f(0x203)+JSON[_0x23156f(0x24f)](_0x2f7586);try{const _0x4e6f4c=await this[_0x23156f(0x2f4)]['generateContent'](_0x3e596e),_0x4ac9f5=JSON[_0x23156f(0x2a0)](_0x4e6f4c['response'][_0x23156f(0x2f7)]()[_0x23156f(0x22a)](/```json|```/g,'')[_0x23156f(0x305)]());_0x4ac9f5[_0x23156f(0x294)]&&(await this['setStateAsync'](LTM_DP_DRIFT_STATUS,{'val':_0x4ac9f5[_0x23156f(0x294)],'ack':!![]}),await this[_0x23156f(0x230)](LTM_DP_DRIFT_DETAILS,{'val':_0x4ac9f5[_0x23156f(0x2ed)],'ack':!![]}),await this[_0x23156f(0x230)](LTM_DP_DRIFT_LAST_CHECK,{'val':Date[_0x23156f(0x2b6)](),'ack':!![]}));}catch(_0x1c6e87){}}async[a0_0x1ec7da(0x2b7)](){const _0x4fbdbc=a0_0x1ec7da;try{const _0x34cb32=await this[_0x4fbdbc(0x25c)](SYSTEM_DP_MODE);_0x34cb32&&_0x34cb32[_0x4fbdbc(0x259)]&&Object[_0x4fbdbc(0x2c9)](SYSTEM_MODES)[_0x4fbdbc(0x2a1)](_0x34cb32['val'])?this['currentSystemMode']=_0x34cb32['val']:(this['currentSystemMode']=SYSTEM_MODES[_0x4fbdbc(0x28c)],await this[_0x4fbdbc(0x230)](SYSTEM_DP_MODE,{'val':SYSTEM_MODES[_0x4fbdbc(0x28c)],'ack':!![]}));}catch(_0x364abd){this['currentSystemMode']=SYSTEM_MODES[_0x4fbdbc(0x28c)];}}async[a0_0x1ec7da(0x210)](){const _0x36f8c8=a0_0x1ec7da;try{const _0x2b6a8c=await this[_0x36f8c8(0x32e)](_0x36f8c8(0x338));if(_0x2b6a8c&&_0x2b6a8c[_0x36f8c8(0x277)]&&_0x2b6a8c[_0x36f8c8(0x277)][_0x36f8c8(0x2c3)])return _0x2b6a8c[_0x36f8c8(0x277)][_0x36f8c8(0x2c3)];return _0x36f8c8(0x2fc);}catch(_0x202ffe){return'uuid-error';}}async[a0_0x1ec7da(0x22e)](_0x4ac757){const _0x5768b4=a0_0x1ec7da;if(!_0x4ac757)return![];this[_0x5768b4(0x2fd)]=await this[_0x5768b4(0x210)]();if(_0x4ac757===_0x5768b4(0x25a)||_0x4ac757['startsWith'](_0x5768b4(0x2ba)))return!![];return![];}[a0_0x1ec7da(0x2ef)](_0x12bf7e){const _0x41913b=a0_0x1ec7da;if(this[_0x41913b(0x21b)])clearInterval(this['analysisTimer']);if(this[_0x41913b(0x2c8)])clearInterval(this['driftAnalysisTimer']);if(this['ltmJob'])this[_0x41913b(0x2a3)][_0x41913b(0x2bd)]();if(this['modeResetJob'])this['modeResetJob'][_0x41913b(0x2bd)]();if(this[_0x41913b(0x22c)])clearTimeout(this[_0x41913b(0x22c)]);if(this[_0x41913b(0x238)])clearTimeout(this[_0x41913b(0x238)]);_0x12bf7e();}async[a0_0x1ec7da(0x2c0)](_0x4ba570){const _0x3a144e=a0_0x1ec7da;if(typeof _0x4ba570==='object'&&_0x4ba570[_0x3a144e(0x2e4)]){if(_0x4ba570[_0x3a144e(0x332)]===_0x3a144e(0x2be)){if(!_0x4ba570['message']['apiKey'])return this[_0x3a144e(0x334)](_0x4ba570['from'],_0x4ba570['command'],{'success':![],'message':_0x3a144e(0x2b3)},_0x4ba570['callback']);try{const _0x46eb9f=new GoogleGenerativeAI(_0x4ba570[_0x3a144e(0x2e4)][_0x3a144e(0x1ec)])[_0x3a144e(0x2bf)]({'model':_0x3a144e(0x22b)});await _0x46eb9f[_0x3a144e(0x2a8)](_0x3a144e(0x23f)),this[_0x3a144e(0x334)](_0x4ba570[_0x3a144e(0x261)],_0x4ba570['command'],{'success':!![],'message':_0x3a144e(0x318)},_0x4ba570[_0x3a144e(0x240)]);}catch(_0x5e11dd){this[_0x3a144e(0x334)](_0x4ba570[_0x3a144e(0x261)],_0x4ba570[_0x3a144e(0x332)],{'success':![],'message':_0x5e11dd[_0x3a144e(0x2e4)]},_0x4ba570[_0x3a144e(0x240)]);}}else{if(_0x4ba570[_0x3a144e(0x332)]===_0x3a144e(0x2fe)){const _0x4c2f77=await this[_0x3a144e(0x23c)]('[Test]\x20Notification',!![]);this[_0x3a144e(0x334)](_0x4ba570[_0x3a144e(0x261)],_0x4ba570[_0x3a144e(0x332)],{'success':_0x4c2f77>0x0,'message':_0x4c2f77+'\x20sent'},_0x4ba570[_0x3a144e(0x240)]);}else{if(_0x4ba570['command']===_0x3a144e(0x2bc)){if(!this['isProVersion'])return this[_0x3a144e(0x334)](_0x4ba570['from'],_0x4ba570[_0x3a144e(0x332)],{'success':![],'isPro':![]},_0x4ba570[_0x3a144e(0x240)]);let _0x48ec17={'status':'N/A','details':'','lastCheck':0x0};try{_0x48ec17['status']=(await this['getStateAsync'](LTM_DP_DRIFT_STATUS))[_0x3a144e(0x259)],_0x48ec17['details']=(await this[_0x3a144e(0x25c)](LTM_DP_DRIFT_DETAILS))[_0x3a144e(0x259)],_0x48ec17[_0x3a144e(0x28f)]=(await this[_0x3a144e(0x25c)](LTM_DP_DRIFT_LAST_CHECK))[_0x3a144e(0x259)];}catch(_0x5c53d1){}this[_0x3a144e(0x334)](_0x4ba570[_0x3a144e(0x261)],_0x4ba570['command'],{'success':!![],'isPro':!![],'dailyDigests':this[_0x3a144e(0x291)],'driftAnalysis':_0x48ec17,'analysisHistory':this[_0x3a144e(0x1f5)]},_0x4ba570['callback']);}else{if(_0x4ba570['command']===_0x3a144e(0x2f2)){const _0x3e524f=await this[_0x3a144e(0x253)](_0x3a144e(0x24c),_0x3a144e(0x1eb)),_0x2f41ba=[];if(_0x3e524f)for(const _0x27bd95 in _0x3e524f){const _0x2b0fc9=_0x3e524f[_0x27bd95],_0x33a7fb=(_0x2b0fc9[_0x3a144e(0x2e1)]&&typeof _0x2b0fc9[_0x3a144e(0x2e1)]['name']==='object'?_0x2b0fc9[_0x3a144e(0x2e1)][_0x3a144e(0x29b)]['de']:_0x2b0fc9['common']['name'])||_0x2b0fc9[_0x3a144e(0x2e1)][_0x3a144e(0x29b)];_0x2f41ba[_0x3a144e(0x30c)]({'id':_0x27bd95,'name':_0x33a7fb});}this[_0x3a144e(0x334)](_0x4ba570[_0x3a144e(0x261)],_0x4ba570['command'],{'success':!![],'enums':_0x2f41ba},_0x4ba570[_0x3a144e(0x240)]);}else{if(_0x4ba570[_0x3a144e(0x332)]===_0x3a144e(0x295)){this[_0x3a144e(0x2d3)][_0x3a144e(0x282)]('Received\x20scanDevices\x20request\x20from\x20Admin\x20UI.');const _0x6a5b00=_0x4ba570[_0x3a144e(0x2e4)]||{};try{const _0x4285d2=await this[_0x3a144e(0x337)](_0x6a5b00);this[_0x3a144e(0x334)](_0x4ba570['from'],_0x4ba570[_0x3a144e(0x332)],{'success':!![],'devices':_0x4285d2},_0x4ba570[_0x3a144e(0x240)]);}catch(_0x27a7f3){this[_0x3a144e(0x334)](_0x4ba570[_0x3a144e(0x261)],_0x4ba570['command'],{'success':![],'error':_0x27a7f3[_0x3a144e(0x2e4)]},_0x4ba570[_0x3a144e(0x240)]);}}else{if(_0x4ba570[_0x3a144e(0x332)]===_0x3a144e(0x290)){const {historyId:_0x5a967f,rating:_0x378bf7,comment:_0x29c062,alertReason:_0x5f38a6}=_0x4ba570['message'];_0x5a967f&&_0x378bf7?(await this[_0x3a144e(0x271)]({'timestamp':Date[_0x3a144e(0x2b6)](),'historyId':_0x5a967f,'rating':_0x378bf7,'comment':_0x29c062,'alertReason':_0x5f38a6}),this[_0x3a144e(0x334)](_0x4ba570[_0x3a144e(0x261)],_0x4ba570['command'],{'success':!![]},_0x4ba570[_0x3a144e(0x240)])):this[_0x3a144e(0x334)](_0x4ba570[_0x3a144e(0x261)],_0x4ba570['command'],{'success':![],'error':'Missing\x20data'},_0x4ba570[_0x3a144e(0x240)]);}}}}}}}}}if(require[a0_0x1ec7da(0x2f9)]!==module)module[a0_0x1ec7da(0x2ad)]=_0x5e7022=>new CogniLiving(_0x5e7022);else new CogniLiving();