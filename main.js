const a0_0x49390c=a0_0x4743;(function(_0x3456ed,_0x481ffa){const _0x3ed937=a0_0x4743,_0x16f116=_0x3456ed();while(!![]){try{const _0x322845=-parseInt(_0x3ed937(0x160))/0x1+parseInt(_0x3ed937(0x192))/0x2+-parseInt(_0x3ed937(0x17c))/0x3+parseInt(_0x3ed937(0x173))/0x4*(parseInt(_0x3ed937(0x1c9))/0x5)+parseInt(_0x3ed937(0x1be))/0x6*(parseInt(_0x3ed937(0x21c))/0x7)+-parseInt(_0x3ed937(0x287))/0x8*(-parseInt(_0x3ed937(0x169))/0x9)+parseInt(_0x3ed937(0x22a))/0xa*(-parseInt(_0x3ed937(0x23f))/0xb);if(_0x322845===_0x481ffa)break;else _0x16f116['push'](_0x16f116['shift']());}catch(_0x215d7a){_0x16f116['push'](_0x16f116['shift']());}}}(a0_0x2010,0x822c5));const a0_0x11e41f=(function(){let _0x23a4e0=!![];return function(_0xe41073,_0xa821f8){const _0x1e553=_0x23a4e0?function(){const _0x32422d=a0_0x4743;if(_0xa821f8){const _0x1cf8a8=_0xa821f8[_0x32422d(0x2da)](_0xe41073,arguments);return _0xa821f8=null,_0x1cf8a8;}}:function(){};return _0x23a4e0=![],_0x1e553;};}()),a0_0x1bbc3f=a0_0x11e41f(this,function(){const _0x108ee8=a0_0x4743;return a0_0x1bbc3f[_0x108ee8(0x2d9)]()[_0x108ee8(0x1cf)]('(((.+)+)+)+$')[_0x108ee8(0x2d9)]()['constructor'](a0_0x1bbc3f)[_0x108ee8(0x1cf)]('(((.+)+)+)+$');});a0_0x1bbc3f();'use strict';function a0_0x4743(_0x163964,_0x29c343){const _0x50fe19=a0_0x2010();return a0_0x4743=function(_0x1bbc3f,_0x11e41f){_0x1bbc3f=_0x1bbc3f-0x14c;let _0x201048=_0x50fe19[_0x1bbc3f];return _0x201048;},a0_0x4743(_0x163964,_0x29c343);}const utils=require(a0_0x49390c(0x188)),{GoogleGenerativeAI}=require(a0_0x49390c(0x2e1)),schedule=require(a0_0x49390c(0x204)),{spawn,exec}=require(a0_0x49390c(0x1f4)),path=require(a0_0x49390c(0x18a)),fs=require('fs'),HISTORY_MAX_SIZE=0x32,RAW_LOG_MAX_SIZE=0x9c4,LTM_MIN_EVENTS_FOR_COMPRESSION=0x5,GEMINI_MODEL=a0_0x49390c(0x1c0),LTM_SCHEDULE=a0_0x49390c(0x2b4),MODE_RESET_SCHEDULE=a0_0x49390c(0x25c),SEQUENCE_TIMEOUT_MS=0x5*0x3c*0x3e8,MAX_TRAINING_SET_SIZE=0x1f4,THERMO_LOG_SIZE=0x3e8,EXIT_TIMER_MINUTES=0xf,EXIT_GRACE_PERIOD_SECONDS=0x1e,LTM_DP_RAW_LOG=a0_0x49390c(0x2e3),LTM_DP_DAILY_DIGESTS='LTM.dailyDigests',LTM_DP_STATUS=a0_0x49390c(0x29f),LTM_DP_TRIGGER_DIGEST=a0_0x49390c(0x2b0),LTM_DP_BASELINE_STATUS=a0_0x49390c(0x269),LTM_DP_DRIFT_CHANNEL=a0_0x49390c(0x167),LTM_DP_DRIFT_STATUS=a0_0x49390c(0x172),LTM_DP_DRIFT_DETAILS=a0_0x49390c(0x226),LTM_DP_DRIFT_LAST_CHECK=a0_0x49390c(0x242),SYSTEM_DP_MODE=a0_0x49390c(0x16b),SYSTEM_MODES={'NORMAL':a0_0x49390c(0x157),'VACATION':a0_0x49390c(0x22d),'PARTY':a0_0x49390c(0x2bf),'GUEST':a0_0x49390c(0x2a3)},AUTO_RESET_MODES=[SYSTEM_MODES[a0_0x49390c(0x2a7)],SYSTEM_MODES[a0_0x49390c(0x18d)]],PERSONA_MAPPING={'generic':a0_0x49390c(0x1ea),'senior_aal':'PRIORITÃ„T:\x20Gesundheit/AAL.','family':'Fokus\x20auf\x20Familienroutinen.','single_comfort':a0_0x49390c(0x2d8),'security':a0_0x49390c(0x1cc)},ACTIVITY_LEVEL_MAP={'sehr\x20hoch':0x64,'hoch':0x50,'normal':0x3c,'niedrig':0x28,'sehr\x20niedrig':0x14,'inaktiv':0x0},IS_WIN=process[a0_0x49390c(0x1fc)]===a0_0x49390c(0x2a5),PERSISTENT_DIR=path[a0_0x49390c(0x28c)](__dirname,a0_0x49390c(0x2e7)),VENV_PATH=PERSISTENT_DIR,PYTHON_EXE=IS_WIN?path[a0_0x49390c(0x28c)](VENV_PATH,'Scripts','python.exe'):path[a0_0x49390c(0x28c)](VENV_PATH,a0_0x49390c(0x2ba),a0_0x49390c(0x1f7)),PIP_EXE=IS_WIN?path[a0_0x49390c(0x28c)](VENV_PATH,'Scripts','pip.exe'):path[a0_0x49390c(0x28c)](VENV_PATH,a0_0x49390c(0x2ba),'pip');let activeSequence=[],sequenceTimer=null;async function startSystem(_0x22fd9b){const _0x4a19a8=a0_0x49390c;_0x22fd9b[_0x4a19a8(0x272)]['info'](_0x4a19a8(0x20b)),await initZombies(_0x22fd9b);try{_0x22fd9b[_0x4a19a8(0x203)]=await checkLicense(_0x22fd9b[_0x4a19a8(0x237)][_0x4a19a8(0x177)]);}catch(_0x1d1e28){}if(!_0x22fd9b['config'][_0x4a19a8(0x248)]||_0x22fd9b[_0x4a19a8(0x237)][_0x4a19a8(0x248)]<0.1)_0x22fd9b['config']['inactivityThresholdHours']=0xc;await initHistory(_0x22fd9b),await initSystemConfig(_0x22fd9b);if(_0x22fd9b[_0x4a19a8(0x237)][_0x4a19a8(0x1cb)])try{_0x22fd9b[_0x4a19a8(0x1fd)]=new GoogleGenerativeAI(_0x22fd9b[_0x4a19a8(0x237)][_0x4a19a8(0x1cb)]),_0x22fd9b['geminiModel']=_0x22fd9b[_0x4a19a8(0x1fd)][_0x4a19a8(0x2a6)]({'model':GEMINI_MODEL,'generationConfig':{'responseMimeType':_0x4a19a8(0x289)}}),_0x22fd9b[_0x4a19a8(0x272)][_0x4a19a8(0x195)](_0x4a19a8(0x1d4));}catch(_0x54cc99){_0x22fd9b[_0x4a19a8(0x272)][_0x4a19a8(0x1d9)](_0x4a19a8(0x2c0)+_0x54cc99[_0x4a19a8(0x199)]);}await createAllObjects(_0x22fd9b),await loadSystemMode(_0x22fd9b),await loadRawEventLog(_0x22fd9b),await loadDailyDigests(_0x22fd9b),_0x22fd9b[_0x4a19a8(0x2b6)](_0x4a19a8(0x1b1)),_0x22fd9b[_0x4a19a8(0x2b6)](LTM_DP_TRIGGER_DIGEST),_0x22fd9b[_0x4a19a8(0x2b6)](_0x4a19a8(0x16b)),_0x22fd9b[_0x4a19a8(0x2b6)](_0x4a19a8(0x23a)),_0x22fd9b[_0x4a19a8(0x2b6)](_0x4a19a8(0x259)),_0x22fd9b[_0x4a19a8(0x2b6)](_0x4a19a8(0x1d0)),_0x22fd9b[_0x4a19a8(0x2b6)](_0x4a19a8(0x2cb)),_0x22fd9b[_0x4a19a8(0x2b6)](_0x4a19a8(0x168)),_0x22fd9b[_0x4a19a8(0x2b6)](_0x4a19a8(0x26b)),_0x22fd9b[_0x4a19a8(0x2b6)](_0x4a19a8(0x258)),await initSensorSubscriptions(_0x22fd9b),await initPresenceSubscriptions(_0x22fd9b),await setupTelegramListener(_0x22fd9b),setTimeout(()=>checkWifiPresence(_0x22fd9b),0x1388);if(_0x22fd9b[_0x4a19a8(0x2be)])clearInterval(_0x22fd9b[_0x4a19a8(0x2be)]);const _0x3aa06d=_0x22fd9b['config']['analysisInterval']||0xf;_0x3aa06d>0x0&&(_0x22fd9b[_0x4a19a8(0x2be)]=setInterval(()=>{runAutopilot(_0x22fd9b);},_0x3aa06d*0x3c*0x3e8)),setupLtmScheduler(_0x22fd9b),setupModeResetScheduler(_0x22fd9b),setupDriftAnalysisScheduler(_0x22fd9b),setupBriefingScheduler(_0x22fd9b),startPythonService(_0x22fd9b),setTimeout(()=>{if(_0x22fd9b['pythonProcess'])runPythonHealthCheck(_0x22fd9b);},0x1388);}async function runAutopilot(_0x45022e){const _0x5294a2=a0_0x49390c;_0x45022e[_0x5294a2(0x272)][_0x5294a2(0x1bc)](_0x5294a2(0x22b)),await runGeminiAnalysis(_0x45022e);}async function scanForDevices(_0x103949,_0x52758a){const _0x580d35=a0_0x49390c;_0x103949['log'][_0x580d35(0x195)](_0x580d35(0x240));const _0x4a5a53=[],_0x3cd5c5=await _0x103949[_0x580d35(0x181)]('*');for(const _0x3c93d5 in _0x3cd5c5){const _0x3588aa=_0x3cd5c5[_0x3c93d5];if(_0x3588aa&&_0x3588aa[_0x580d35(0x2b7)]&&_0x3588aa['type']===_0x580d35(0x211)){const _0x4e2262=(_0x3588aa['common'][_0x580d35(0x189)]&&typeof _0x3588aa['common'][_0x580d35(0x189)]==='object'?_0x3588aa[_0x580d35(0x2b7)][_0x580d35(0x189)]['de']:_0x3588aa[_0x580d35(0x2b7)]['name'])||'',_0x46daea=_0x3588aa[_0x580d35(0x2b7)][_0x580d35(0x2f2)]||'';let _0x9f29e=null;if(_0x52758a['motion']&&(_0x46daea[_0x580d35(0x166)](_0x580d35(0x2d4))||_0x4e2262['toLowerCase']()[_0x580d35(0x166)](_0x580d35(0x1f3))))_0x9f29e=_0x580d35(0x2d4);else{if(_0x52758a['doors']&&(_0x46daea[_0x580d35(0x166)]('door')||_0x46daea[_0x580d35(0x166)](_0x580d35(0x2f7))||_0x4e2262[_0x580d35(0x1d3)]()['includes'](_0x580d35(0x2df))||_0x4e2262[_0x580d35(0x1d3)]()[_0x580d35(0x166)]('fenster')))_0x9f29e=_0x580d35(0x176);else{if(_0x52758a[_0x580d35(0x2bc)]&&(_0x46daea['includes'](_0x580d35(0x299))||_0x46daea[_0x580d35(0x166)](_0x580d35(0x2d0))||_0x4e2262[_0x580d35(0x1d3)]()[_0x580d35(0x166)](_0x580d35(0x191))))_0x9f29e='light';else{if(_0x52758a['temperature']&&(_0x46daea[_0x580d35(0x166)](_0x580d35(0x159))||_0x4e2262[_0x580d35(0x1d3)]()[_0x580d35(0x166)](_0x580d35(0x150))))_0x9f29e=_0x580d35(0x159);}}}if(_0x9f29e){let _0x2b37d1='';const _0x3b631a=_0x3c93d5[_0x580d35(0x1ae)]('.');if(_0x3b631a[_0x580d35(0x232)]>0x2)_0x2b37d1=_0x3b631a[0x2];_0x4a5a53['push']({'id':_0x3c93d5,'name':_0x4e2262||_0x3c93d5,'type':_0x9f29e,'location':_0x2b37d1,'_score':0x32});}}}return _0x4a5a53;}async function getWeatherContext(_0x2efecc){const _0x4f1aac=a0_0x49390c;if(!_0x2efecc['config'][_0x4f1aac(0x24b)]||!_0x2efecc['config'][_0x4f1aac(0x2c3)])return'Wetterdaten\x20deaktiviert.';try{const _0x42aedd=_0x2efecc[_0x4f1aac(0x237)]['weatherInstance'];let _0x382aa8=await _0x2efecc['getForeignStateAsync'](_0x42aedd+'.Current.Temperature');if(!_0x382aa8)_0x382aa8=await _0x2efecc[_0x4f1aac(0x239)](_0x42aedd+_0x4f1aac(0x247));let _0x414d3f=await _0x2efecc[_0x4f1aac(0x239)](_0x42aedd+_0x4f1aac(0x1ed));if(!_0x414d3f)_0x414d3f=await _0x2efecc['getForeignStateAsync'](_0x42aedd+_0x4f1aac(0x216));if(_0x382aa8&&_0x414d3f)return _0x382aa8[_0x4f1aac(0x2c2)]+_0x4f1aac(0x17b)+_0x414d3f[_0x4f1aac(0x2c2)];}catch(_0x1d9282){}return _0x4f1aac(0x1ff);}async function getCalendarContext(_0x2005a4){const _0x3516bb=a0_0x49390c;if(!_0x2005a4[_0x3516bb(0x237)][_0x3516bb(0x230)]||!_0x2005a4['config'][_0x3516bb(0x27b)])return _0x3516bb(0x1a5);return _0x3516bb(0x1f5);}async function getCalendarNames(_0x221a5c,_0x2bfad9){return[];}async function saveFeedback(_0x46f38c,_0x3b8bc3){const _0x594119=a0_0x49390c;_0x46f38c['log'][_0x594119(0x195)](_0x594119(0x279)+_0x3b8bc3[_0x594119(0x2e9)]);}async function sendMorningBriefing(_0x48a2b4){const _0xef74a8=a0_0x49390c;if(!_0x48a2b4[_0xef74a8(0x23d)])return;try{const _0x281276=_0xef74a8(0x271),_0x5adaa4=await _0x48a2b4[_0xef74a8(0x23d)][_0xef74a8(0x257)](_0x281276),_0x4d5b08=_0x5adaa4[_0xef74a8(0x198)][_0xef74a8(0x1dd)]();sendNotification(_0x48a2b4,'ðŸŒ…\x20Morning\x20Briefing:\x0a'+_0x4d5b08);}catch(_0x3cef24){_0x48a2b4[_0xef74a8(0x272)]['error']('Briefing\x20Error:\x20'+_0x3cef24[_0xef74a8(0x199)]);}}function a0_0x2010(){const _0x22ebb2=['rating','events.lastEvent','siren','Pattern\x20Detected','rule','notifyTelegramRecipient','notifyEmailRecipient','systemUUID','analysis.activitySummary','role','cogni-living\x20adapter\x20starting\x20(v','Daily\x20Digests','âœ…\x20INSTALL\x20SUCCESS.','Keine\x20Details.','window','getTime','requirements.txt','delObjectAsync','round','communicate.request','LTM.trainingData.sequences','ANALYZE_SEQUENCE','âš ï¸\x20Python\x20VENV\x20missing.\x20Installing\x20locally...','Detected\x20Patterns','temperatur','command','analysis.health.trendValue','boolean','Cogni-Living','ðŸ§ \x20Triggering\x20Security\x20Training...','TRAIN_SECURITY','normal','COGNI_REQUEST_CALL','temperature','TREND_RESULT','cogni-living','map','python3\x20-m\x20venv\x20\x22','cancel','online','512337iYqzry','notifyTelegramInstance','Restoring\x20sensor\x20cache...','isGracePeriodActive','Deaktiviert\x20(Pro-Feature)','find','includes','LTM.driftAnalysis','analysis.training.triggerHealth','3521394lgDlnF','TRAIN_HEALTH','system.mode','scheduleJob','type','city','simulateButler','analysis.health.trendDiagnosis','warn','LTM.driftAnalysis.baselineDrift','25716eAQTpC','alertReason','text.alarm','door','licenseKey','analysis.security.lastCheck','User\x20dismissed\x20automation\x20proposal.','Vom\x20Benutzer\x20bestÃ¤tigt\x20(OK).','Â°C,\x20','1116498sPtRzl','Auto\x20Apply','trim','ðŸ\x20Python\x20Pong','WiFi\x20Presence\x20detected.','getForeignObjectsAsync','heizung','.\x20EVENTS:\x20','analysis.automation.detectedPatterns','status','HEALTH_TRAIN_RESULT','detected','@iobroker/adapter-core','name','path','Activity\x20Summary','ltmJob','GUEST','success','isEmergency','splice','licht','1301424hfFbca','Who\x20is\x20present?','onMessage','info','N/A\x20(Learning)','TRAINING_COMPLETE','response','message','SECURITY_RESULT','activityLevel','apiKey','Alarm','Sequences','expire','occupancy','replace','indexOf','ANALYZE_HEALTH','Last\x20Check','Kalender\x20deaktiviert.','analysis.automation.description','fenster','notifyPushoverInstance','getMinutes','ack','Started...','analysis.lastResult','âŒ\x20VENV\x20FAILED:\x20','split','sendTo','ready','analysis.trigger','string','bind','setState','analysis.alertReason','callback','briefingTime','Missing\x20data','analysis.isAlert','N/A','Anomaly\x20Detected','debug','events.history_debug_00','219858nkcOze','toISOString','models/gemini-flash-latest','ltmLtbWindowDays','write','ðŸ“ž\x20RÃœCKRUF\x20BITTE!\x20Der\x20Bewohner\x20hat\x20den\x20RÃ¼ckruf-Button\x20gedrÃ¼ckt.','threshold','Trigger\x20Analysis','pop','notifyPushoverRecipient','minDaysForBaseline','785VSzsqp','Digest','geminiApiKey','PRIORITÃ„T:\x20Sicherheit.','Train\x20Security','Installing\x20pip\x20packages...','search','analysis.automation.autoApply','exports','ðŸ›¡ï¸\x20SECURITY\x20CHECK:\x20Score\x20','toLowerCase','Gemini\x20AI\x20initialized.','unshift','sound','NORMAL','\x0aGrund:\x20','error','modeResetJob','Trend\x20Value','toFixed','text','livingContext','Failed:\x20','main','getHours','presenceDevices','analysis.analysisHistory','automationProposal','.NextHours.Location_1.Day_1.current.temp_value','number','button','[PYTHON]\x20','object','Analysiere\x20ausgewogen.','UngewÃ¶hnliches\x20Bewegungsmuster!\x20(Score:\x20','Briefing\x20Sched\x20Error:\x20','.Current.WeatherText','Security\x20Monitor','python3','Err:\x20','service.py','version','bewegung','child_process','Keine\x20Termine.','ðŸš¨\x20EMERGENCY','python','LTM\x20Sched\x20Error:\x20','setObjectNotExistsAsync','send','notifyEmailEnabled','platform','genAI','Health\x20Analysis','Keine\x20Wetterdaten\x20verfÃ¼gbar.','Training\x20Error:\x20','Description','analysis.energy','isProVersion','node-schedule','details','Train\x20Comfort','Current\x20Threshold','driftAnalysisTimer','[LOG]','Thermodynamics','ðŸš€\x20Starting\x20NUUKANNI\x20Logic\x20(v0.10.0)...','AI\x20Training','exitGraceTimer','events.history','subscribeForeignStatesAsync','value','state','sensorLastValues','\x20new\x20patterns.','scanDevices','system.presenceWho','.forecast.current.state','is_anomaly','substring','indicator.alarm','logDuplicates','COGNI_CONFIRM_OK','119OinxeF','enum.functions.*','analysis.history_debug_00','isExit','System','enum','analysis.security.currentThreshold','slice','LTM','Sec-Training\x20started...','LTM.driftAnalysis.driftDetails','Unknown','Lernphase\x20(','lastAlertState','30070nidxZR','ðŸ¤–\x20Autopilot:\x20Running\x20periodic\x20analysis...','existsSync','vacation','analysis.training.status','unknown','useCalendar','now','length','SIMULATION:\x20Test-Vorschlag\x20fÃ¼r\x20','isAlert','pythonProcess','outdoorSensorId','config','stdout','getForeignStateAsync','analysis.triggerBriefing','summary','stringify','geminiModel','python_service','6028ETSnTk','ðŸ”\x20Scanning\x20for\x20devices...','.\x20EMERGENCY:\x20','LTM.driftAnalysis.lastCheck','BUTLER\x20Execution\x20Error:\x20','dismissAutomation','Trend','insulation','.forecast.current.temperature','inactivityThresholdHours','getCalendarNames','Error\x20launching\x20Python:\x20','useWeather','retry','triggerDailyDigest','.\x20WETTER:\x20','notifyPushoverEnabled','targetId','setStateAsync','Drift\x20Sched\x20Error:\x20','briefingEnabled','Heating\x20Score','shift','.Current.Temperature','generateContent','analysis.training.triggerComfort','analysis.automation.triggerAction','.\x20KONTEXT:\x20','Event\x20History','0\x204\x20*\x20*\x20*','onStateChange','ðŸ›‹ï¸\x20BUTLER:\x20Found\x20','Last\x20raw\x20event','extendObjectAsync','dependencyInstallInProgress','rawEventLog','driftDetails','system.isPresent','location','analysis.automation.patternDetected','.\x20ANWESEND:\x20','exitTimer','LTM.baselineStatus','Target\x20ID','analysis.training.triggerEnergy','\x20*\x20*\x20*','stateChange','analysis.automation.targetValue','ðŸ›‹ï¸\x20Triggering\x20Comfort\x20Analysis\x20(Pattern\x20Mining)...','values','Erstelle\x20ein\x20kurzes\x20\x27Guten\x20Morgen\x27\x20Briefing\x20basierend\x20auf\x20den\x20Events\x20der\x20letzten\x20Nacht.','log','briefingJob','channel','payload','analysisHistory','.communicate.request','parse','ðŸ“\x20Feedback\x20received:\x20','Insulation\x20Score','calendarInstance','ANOMALY','.forecast.current.temp','ltmDriftCheckIntervalHours','unload','json','forEach','contact','ðŸ“ž\x20RÃ¼ckruf\x20anfordern','LTM.trainingData.thermodynamics','kontakt','notifyTelegramEnabled','16TSyaPn','getEnums','application/json','description','indicator','join','getStateAsync','automation.triggerAction','analysis.security','COMFORT_RESULT','timestamp','testContext','analysis.health.lastCheck','âš ï¸\x20SECURITY\x20ALARM:\x20','KI-Modell\x20nicht\x20initialisiert','dailyDigests','rmSync','isPresent','light','onUnload','Reset\x20Sched\x20Error:\x20','dimmer','presence','analysis.security.lastScore','LTM.processingStatus','getObjectAsync','close','stdin','guest','ðŸ¤–\x20BUTLER:\x20Executing\x20Action\x20->\x20','win32','getGenerativeModel','PARTY','TRAIN_COMFORT','from','ltmStbWindowDays','onReady','\x20=\x20','Trigger\x20Action','startsWith','push','LTM.triggerDailyDigest','Energy\x20Intelligence','notifyEmailInstance','ðŸ›‹ï¸\x20BUTLER:\x20Keine\x20neuen\x20Muster\x20gefunden.','0\x203\x20*\x20*\x20*','eventHistory','subscribeStates','common','data','ROLLE:\x20Data\x20Scientist.\x20ZIEL:\x20Drift\x20erkennen.\x20SCHEMA:\x20{\x20\x22baselineDrift\x22:\x20\x22none|slight|significant|critical\x22,\x20\x22driftDetails\x22:\x20\x22string\x22\x20}\x0a\x0aLTB:\x20','bin',')\x20-\x20SAFE\x20BOOT','lights','date','analysisTimer','party','Gemini\x20Init\x20Error:\x20','analysis.energy.insulationScore','val','weatherInstance','telegram','sendToAsync','currentSystemMode','Aktiv\x20(','analysis.automation.targetId','TRAIN_ENERGY','System\x20Mode','analysis.training.triggerSecurity','ROLLE:\x20KI-Hausverwalter.\x20PERSONA:\x20','confidence','.\x20SYSTEM_MODE:\x20','filter','switch','Training\x20Status','floor','heating','motion','analysis.energy.heatingScore','targetValue','analysis.health.isAnomaly','Fokus\x20auf\x20Komfort.','toString','apply','HEALTH_RESULT','ANALYZE_TREND','daswetter','ðŸ¤–\x20BUTLER:\x20No\x20valid\x20target\x20ID\x20or\x20value\x20stored\x20for\x20execution.','tÃ¼r','submitFeedback','@google/generative-ai','change_percent','LTM.rawEventLog','toLocaleTimeString','Train\x20Energy','\x22\x20install\x20--no-cache-dir\x20--force-reinstall\x20-r\x20\x22','.venv','systemConfig'];a0_0x2010=function(){return _0x22ebb2;};return a0_0x2010();}function checkAndInstall(_0x12d324){const _0x222714=a0_0x49390c;if(!fs[_0x222714(0x22c)](VENV_PATH)||!fs[_0x222714(0x22c)](PIP_EXE))return _0x12d324[_0x222714(0x272)][_0x222714(0x171)](_0x222714(0x14e)),installPythonDependencies(_0x12d324),![];return!![];}function installPythonDependencies(_0x3a0d16){const _0x29e44c=a0_0x49390c;if(_0x3a0d16[_0x29e44c(0x261)])return;_0x3a0d16['dependencyInstallInProgress']=!![];const _0x18c9ba=path[_0x29e44c(0x28c)](__dirname,_0x29e44c(0x23e),_0x29e44c(0x2f9));stopPythonService(_0x3a0d16);if(fs[_0x29e44c(0x22c)](VENV_PATH))try{fs[_0x29e44c(0x297)](VENV_PATH,{'recursive':!![],'force':!![]});}catch(_0x271c60){}exec(_0x29e44c(0x15d)+VENV_PATH+'\x22',_0x368561=>{const _0x3def25=_0x29e44c;if(_0x368561){_0x3a0d16['log'][_0x3def25(0x1d9)](_0x3def25(0x1ad)+_0x368561[_0x3def25(0x199)]),_0x3a0d16[_0x3def25(0x261)]=![];return;}installRequirementsInVenv(_0x3a0d16,_0x18c9ba);});}function installRequirementsInVenv(_0x52b530,_0x593290){const _0x182f1c=a0_0x49390c;_0x52b530[_0x182f1c(0x272)][_0x182f1c(0x195)](_0x182f1c(0x1ce));const _0x33dbba='\x22'+PIP_EXE+_0x182f1c(0x2e6)+_0x593290+'\x22';exec(_0x33dbba,{'timeout':0x124f80},(_0x31cf53,_0x2b4c11,_0x228c2c)=>{const _0x2b230c=_0x182f1c;_0x52b530['dependencyInstallInProgress']=![],_0x31cf53?_0x52b530[_0x2b230c(0x272)][_0x2b230c(0x1d9)]('âŒ\x20INSTALL\x20FAILED:\x20'+(_0x228c2c||_0x31cf53[_0x2b230c(0x199)])):(_0x52b530[_0x2b230c(0x272)][_0x2b230c(0x195)](_0x2b230c(0x2f5)),startSystem(_0x52b530));});}async function initZombies(_0x1090d0){const _0x46d309=a0_0x49390c;try{const _0x590f4f=[_0x46d309(0x21e),_0x46d309(0x1bd)];for(const _0x35baec of _0x590f4f){try{const _0x63048d=await _0x1090d0[_0x46d309(0x2a0)](_0x35baec);if(_0x63048d)await _0x1090d0[_0x46d309(0x2fa)](_0x35baec);}catch(_0x42f672){}}}catch(_0x448580){}}async function checkLicense(_0x878e4c){return!![];}async function initHistory(_0x5996bf){const _0x579678=a0_0x49390c;try{const _0x2b5dce=await _0x5996bf[_0x579678(0x28d)](_0x579678(0x20e));_0x2b5dce&&_0x2b5dce[_0x579678(0x2c2)]&&(_0x5996bf[_0x579678(0x2b5)]=JSON[_0x579678(0x278)](_0x2b5dce[_0x579678(0x2c2)]['toString']()));}catch(_0x294c14){_0x5996bf['eventHistory']=[];}try{const _0x565d09=await _0x5996bf[_0x579678(0x28d)]('analysis.analysisHistory');if(_0x565d09&&_0x565d09[_0x579678(0x2c2)])_0x5996bf['analysisHistory']=JSON[_0x579678(0x278)](_0x565d09[_0x579678(0x2c2)][_0x579678(0x2d9)]());}catch(_0x379ddc){_0x5996bf[_0x579678(0x276)]=[];}if(_0x5996bf[_0x579678(0x2b5)]&&_0x5996bf[_0x579678(0x2b5)]['length']>0x0){_0x5996bf[_0x579678(0x272)]['info'](_0x579678(0x162));for(let _0x4bbb3b=_0x5996bf[_0x579678(0x2b5)][_0x579678(0x232)]-0x1;_0x4bbb3b>=0x0;_0x4bbb3b--){const _0x16e586=_0x5996bf[_0x579678(0x2b5)][_0x4bbb3b];if(_0x16e586&&_0x16e586['id']!==undefined&&_0x16e586[_0x579678(0x210)]!==undefined)_0x5996bf[_0x579678(0x212)][_0x16e586['id']]=_0x16e586[_0x579678(0x210)];}}}async function initSystemConfig(_0x26c07f){const _0x4787d6=a0_0x49390c;try{const _0x1472c6=await _0x26c07f['getForeignObjectAsync']('system.config');if(_0x1472c6&&_0x1472c6[_0x4787d6(0x2b7)])_0x26c07f[_0x4787d6(0x2e8)]={'latitude':_0x1472c6[_0x4787d6(0x2b7)]['latitude']||0x0,'longitude':_0x1472c6[_0x4787d6(0x2b7)]['longitude']||0x0,'city':_0x1472c6[_0x4787d6(0x2b7)][_0x4787d6(0x16e)]||''};}catch(_0x3f82cb){}}async function createAllObjects(_0x59fb55){const _0x230a98=a0_0x49390c;await _0x59fb55[_0x230a98(0x260)]('system',{'type':'channel','common':{'name':_0x230a98(0x220)},'native':{}}),await _0x59fb55[_0x230a98(0x260)](SYSTEM_DP_MODE,{'type':_0x230a98(0x211),'common':{'name':_0x230a98(0x2ca),'type':_0x230a98(0x1b2),'role':_0x230a98(0x211),'read':!![],'write':!![],'def':SYSTEM_MODES[_0x230a98(0x1d7)]},'native':{}}),await _0x59fb55['setObjectNotExistsAsync'](_0x230a98(0x215),{'type':_0x230a98(0x211),'common':{'name':_0x230a98(0x193),'type':_0x230a98(0x1b2),'role':'text','read':!![],'write':![]},'native':{}}),await _0x59fb55[_0x230a98(0x1f9)]('events.lastEvent',{'type':_0x230a98(0x211),'common':{'name':_0x230a98(0x25f),'type':_0x230a98(0x1b2),'role':_0x230a98(0x280),'read':!![],'write':![]},'native':{}}),await _0x59fb55['setObjectNotExistsAsync'](_0x230a98(0x20e),{'type':'state','common':{'name':_0x230a98(0x25b),'type':_0x230a98(0x1b2),'role':_0x230a98(0x280),'read':!![],'write':![]},'native':{}}),await _0x59fb55[_0x230a98(0x260)]('analysis.training',{'type':_0x230a98(0x274),'common':{'name':_0x230a98(0x20c)},'native':{}}),await _0x59fb55[_0x230a98(0x1f9)]('analysis.training.triggerSecurity',{'type':_0x230a98(0x211),'common':{'name':_0x230a98(0x1cd),'type':'boolean','role':_0x230a98(0x1e7),'read':!![],'write':!![]},'native':{}}),await _0x59fb55[_0x230a98(0x1f9)](_0x230a98(0x168),{'type':_0x230a98(0x211),'common':{'name':'Train\x20Health','type':'boolean','role':_0x230a98(0x1e7),'read':!![],'write':!![]},'native':{}}),await _0x59fb55['setObjectNotExistsAsync']('analysis.training.triggerEnergy',{'type':_0x230a98(0x211),'common':{'name':_0x230a98(0x2e5),'type':_0x230a98(0x153),'role':_0x230a98(0x1e7),'read':!![],'write':!![]},'native':{}}),await _0x59fb55['setObjectNotExistsAsync']('analysis.training.triggerComfort',{'type':_0x230a98(0x211),'common':{'name':_0x230a98(0x206),'type':_0x230a98(0x153),'role':_0x230a98(0x1e7),'read':!![],'write':!![]},'native':{}}),await _0x59fb55[_0x230a98(0x1f9)](_0x230a98(0x22e),{'type':_0x230a98(0x211),'common':{'name':_0x230a98(0x2d1),'type':_0x230a98(0x1b2),'role':_0x230a98(0x1dd),'read':!![],'write':![]},'native':{}}),await _0x59fb55[_0x230a98(0x260)](_0x230a98(0x28f),{'type':'channel','common':{'name':_0x230a98(0x1ee)},'native':{}}),await _0x59fb55[_0x230a98(0x1f9)](_0x230a98(0x29e),{'type':_0x230a98(0x211),'common':{'name':'Anomaly\x20Score','type':'number','role':_0x230a98(0x210),'read':!![],'write':![]},'native':{}}),await _0x59fb55[_0x230a98(0x1f9)](_0x230a98(0x222),{'type':_0x230a98(0x211),'common':{'name':_0x230a98(0x207),'type':_0x230a98(0x1e6),'role':'value','read':!![],'write':![],'def':0.05},'native':{}}),await _0x59fb55[_0x230a98(0x1f9)](_0x230a98(0x178),{'type':'state','common':{'name':'Last\x20Check','type':_0x230a98(0x1b2),'role':_0x230a98(0x2bd),'read':!![],'write':![]},'native':{}}),await _0x59fb55[_0x230a98(0x260)]('analysis.health',{'type':'channel','common':{'name':_0x230a98(0x1fe)},'native':{}}),await _0x59fb55[_0x230a98(0x1f9)]('analysis.health.lastCheck',{'type':_0x230a98(0x211),'common':{'name':_0x230a98(0x1a4),'type':_0x230a98(0x1b2),'role':_0x230a98(0x2bd),'read':!![],'write':![]},'native':{}}),await _0x59fb55[_0x230a98(0x1f9)](_0x230a98(0x2d7),{'type':'state','common':{'name':_0x230a98(0x1bb),'type':'boolean','role':_0x230a98(0x28b),'read':!![],'write':![]},'native':{}}),await _0x59fb55['setObjectNotExistsAsync'](_0x230a98(0x170),{'type':_0x230a98(0x211),'common':{'name':_0x230a98(0x245),'type':'string','role':_0x230a98(0x1dd),'read':!![],'write':![]},'native':{}}),await _0x59fb55['setObjectNotExistsAsync'](_0x230a98(0x152),{'type':'state','common':{'name':_0x230a98(0x1db),'type':_0x230a98(0x1e6),'role':_0x230a98(0x210),'read':!![],'write':![]},'native':{}}),await _0x59fb55[_0x230a98(0x260)](_0x230a98(0x202),{'type':'channel','common':{'name':_0x230a98(0x2b1)},'native':{}}),await _0x59fb55['setObjectNotExistsAsync'](_0x230a98(0x2c1),{'type':_0x230a98(0x211),'common':{'name':_0x230a98(0x27a),'type':_0x230a98(0x1b2),'role':_0x230a98(0x1dd),'read':!![],'write':![]},'native':{}}),await _0x59fb55[_0x230a98(0x1f9)](_0x230a98(0x2d5),{'type':_0x230a98(0x211),'common':{'name':_0x230a98(0x254),'type':_0x230a98(0x1b2),'role':'text','read':!![],'write':![]},'native':{}}),await _0x59fb55[_0x230a98(0x260)]('LTM',{'type':_0x230a98(0x274),'common':{'name':_0x230a98(0x224)},'native':{}}),await _0x59fb55['extendObjectAsync'](LTM_DP_RAW_LOG,{'type':_0x230a98(0x211),'common':{'name':'Raw\x20Log','type':'string','role':_0x230a98(0x280),'read':!![],'write':![]},'native':{}}),await _0x59fb55[_0x230a98(0x260)](LTM_DP_DAILY_DIGESTS,{'type':_0x230a98(0x211),'common':{'name':_0x230a98(0x2f4),'type':_0x230a98(0x1b2),'role':_0x230a98(0x280),'read':!![],'write':![]},'native':{}}),await _0x59fb55['setObjectNotExistsAsync'](_0x230a98(0x14c),{'type':_0x230a98(0x211),'common':{'name':_0x230a98(0x19e),'type':_0x230a98(0x1b2),'role':_0x230a98(0x280),'read':!![],'write':![]},'native':{}}),await _0x59fb55[_0x230a98(0x1f9)](_0x230a98(0x284),{'type':_0x230a98(0x211),'common':{'name':_0x230a98(0x20a),'type':_0x230a98(0x1b2),'role':_0x230a98(0x280),'read':!![],'write':![]},'native':{}}),await _0x59fb55[_0x230a98(0x1f9)]('analysis.trigger',{'type':_0x230a98(0x211),'common':{'name':_0x230a98(0x1c5),'type':_0x230a98(0x153),'role':_0x230a98(0x1e7),'read':!![],'write':!![]},'native':{}}),await _0x59fb55[_0x230a98(0x1f9)]('analysis.triggerBriefing',{'type':_0x230a98(0x211),'common':{'name':'Trigger\x20Briefing','type':'boolean','role':_0x230a98(0x1e7),'read':!![],'write':!![]},'native':{}}),await _0x59fb55['setObjectNotExistsAsync'](_0x230a98(0x1b9),{'type':_0x230a98(0x211),'common':{'name':'Alert\x20Status','type':_0x230a98(0x153),'role':_0x230a98(0x219),'read':!![],'write':![]},'native':{}}),await _0x59fb55[_0x230a98(0x1f9)](_0x230a98(0x1b5),{'type':_0x230a98(0x211),'common':{'name':'Alert\x20Reason','type':_0x230a98(0x1b2),'role':_0x230a98(0x175),'read':!![],'write':![]},'native':{}}),await _0x59fb55[_0x230a98(0x1f9)](_0x230a98(0x2f1),{'type':'state','common':{'name':_0x230a98(0x18b),'type':_0x230a98(0x1b2),'role':_0x230a98(0x1dd),'read':!![],'write':![]},'native':{}}),await _0x59fb55[_0x230a98(0x1f9)](_0x230a98(0x266),{'type':'state','common':{'name':_0x230a98(0x2ec),'type':_0x230a98(0x153),'role':_0x230a98(0x28b),'read':!![],'write':![]},'native':{}}),await _0x59fb55[_0x230a98(0x1f9)](_0x230a98(0x1a6),{'type':_0x230a98(0x211),'common':{'name':_0x230a98(0x201),'type':_0x230a98(0x1b2),'role':'text','read':!![],'write':![]},'native':{}}),await _0x59fb55[_0x230a98(0x1f9)]('analysis.automation.detectedPatterns',{'type':_0x230a98(0x211),'common':{'name':_0x230a98(0x14f),'type':'string','role':_0x230a98(0x280),'read':!![],'write':![]},'native':{}}),await _0x59fb55['setObjectNotExistsAsync'](_0x230a98(0x2c8),{'type':_0x230a98(0x211),'common':{'name':_0x230a98(0x26a),'type':_0x230a98(0x1b2),'role':_0x230a98(0x1dd),'read':!![],'write':![]},'native':{}}),await _0x59fb55[_0x230a98(0x1f9)](_0x230a98(0x26e),{'type':_0x230a98(0x211),'common':{'name':'Target\x20Value','type':_0x230a98(0x1b2),'role':'text','read':!![],'write':![]},'native':{}}),await _0x59fb55[_0x230a98(0x1f9)](_0x230a98(0x1d0),{'type':'state','common':{'name':_0x230a98(0x17d),'type':_0x230a98(0x153),'role':_0x230a98(0x2d0),'read':!![],'write':!![]},'native':{}}),await _0x59fb55[_0x230a98(0x1f9)](_0x230a98(0x259),{'type':_0x230a98(0x211),'common':{'name':_0x230a98(0x2ad),'type':_0x230a98(0x153),'role':_0x230a98(0x1e7),'read':!![],'write':!![]},'native':{}});}async function loadSystemMode(_0x47d045){const _0x271e95=a0_0x49390c;try{const _0x276d0f=await _0x47d045['getStateAsync'](SYSTEM_DP_MODE);_0x276d0f&&_0x276d0f[_0x271e95(0x2c2)]&&Object[_0x271e95(0x270)](SYSTEM_MODES)[_0x271e95(0x166)](_0x276d0f[_0x271e95(0x2c2)])?_0x47d045[_0x271e95(0x2c6)]=_0x276d0f['val']:(_0x47d045['currentSystemMode']=SYSTEM_MODES[_0x271e95(0x1d7)],await _0x47d045[_0x271e95(0x251)](SYSTEM_DP_MODE,{'val':SYSTEM_MODES[_0x271e95(0x1d7)],'ack':!![]}));}catch(_0x514a3d){_0x47d045['currentSystemMode']=SYSTEM_MODES[_0x271e95(0x1d7)];}}async function loadRawEventLog(_0x4126bf){const _0xecf1e7=a0_0x49390c;try{const _0x1e5bf0=await _0x4126bf[_0xecf1e7(0x28d)](LTM_DP_RAW_LOG);if(_0x1e5bf0&&_0x1e5bf0[_0xecf1e7(0x2c2)])_0x4126bf[_0xecf1e7(0x262)]=JSON[_0xecf1e7(0x278)](_0x1e5bf0[_0xecf1e7(0x2c2)]);}catch(_0x4b8b11){_0x4126bf[_0xecf1e7(0x262)]=[];}}async function saveRawEventLog(_0x3f24f8){const _0x5ed603=a0_0x49390c;if(_0x3f24f8['rawEventLog'][_0x5ed603(0x232)]>RAW_LOG_MAX_SIZE)_0x3f24f8[_0x5ed603(0x262)][_0x5ed603(0x190)](0x0,_0x3f24f8[_0x5ed603(0x262)][_0x5ed603(0x232)]-RAW_LOG_MAX_SIZE);await _0x3f24f8[_0x5ed603(0x251)](LTM_DP_RAW_LOG,{'val':JSON['stringify'](_0x3f24f8[_0x5ed603(0x262)]),'ack':!![]});}async function loadDailyDigests(_0x456a80){const _0xd5ddea=a0_0x49390c;try{const _0x5abdfd=await _0x456a80[_0xd5ddea(0x28d)](LTM_DP_DAILY_DIGESTS);if(_0x5abdfd&&_0x5abdfd[_0xd5ddea(0x2c2)])_0x456a80[_0xd5ddea(0x296)]=JSON[_0xd5ddea(0x278)](_0x5abdfd['val']);}catch(_0x4337da){_0x456a80[_0xd5ddea(0x296)]=[];}await updateBaselineStatus(_0x456a80);}async function saveDailyDigests(_0xc11fbf,_0x59656c=!![]){const _0x14d2b6=a0_0x49390c,_0x5b4d18=_0xc11fbf[_0x14d2b6(0x237)][_0x14d2b6(0x1c1)]||0x3c;_0xc11fbf[_0x14d2b6(0x296)][_0x14d2b6(0x232)]>_0x5b4d18&&_0xc11fbf[_0x14d2b6(0x296)][_0x14d2b6(0x190)](0x0,_0xc11fbf['dailyDigests'][_0x14d2b6(0x232)]-_0x5b4d18);await _0xc11fbf[_0x14d2b6(0x251)](LTM_DP_DAILY_DIGESTS,{'val':JSON[_0x14d2b6(0x23c)](_0xc11fbf[_0x14d2b6(0x296)]),'ack':!![]});if(_0x59656c)await updateBaselineStatus(_0xc11fbf);}async function updateAnalysisHistory(_0x3ad6c6,_0x2b5dc4){const _0x3132f9=a0_0x49390c;_0x3ad6c6[_0x3132f9(0x276)][_0x3132f9(0x1d5)](_0x2b5dc4);if(_0x3ad6c6[_0x3132f9(0x276)][_0x3132f9(0x232)]>HISTORY_MAX_SIZE)_0x3ad6c6[_0x3132f9(0x276)][_0x3132f9(0x1c6)]();await _0x3ad6c6['setStateAsync'](_0x3132f9(0x1e3),{'val':JSON[_0x3132f9(0x23c)](_0x3ad6c6['analysisHistory']),'ack':!![]});}async function updateBaselineStatus(_0x5bcb51){const _0x5f4629=a0_0x49390c;if(!_0x5bcb51[_0x5f4629(0x203)]){await _0x5bcb51['setStateAsync'](LTM_DP_BASELINE_STATUS,{'val':_0x5f4629(0x164),'ack':!![]});return;}const _0x28719b=_0x5bcb51[_0x5f4629(0x296)][_0x5f4629(0x232)]>=(_0x5bcb51[_0x5f4629(0x237)]['minDaysForBaseline']||0x7)?_0x5f4629(0x2c7)+_0x5bcb51[_0x5f4629(0x296)]['length']+'\x20Tage)':_0x5f4629(0x228)+_0x5bcb51['dailyDigests'][_0x5f4629(0x232)]+'/'+(_0x5bcb51[_0x5f4629(0x237)][_0x5f4629(0x1c8)]||0x7)+')';await _0x5bcb51['setStateAsync'](LTM_DP_BASELINE_STATUS,{'val':_0x28719b,'ack':!![]});}async function initSensorSubscriptions(_0x6996a6){const _0xb01a25=a0_0x49390c,_0x369949=_0x6996a6[_0xb01a25(0x237)]['devices'];if(_0x369949)for(const _0x1a1607 of _0x369949){await _0x6996a6[_0xb01a25(0x20f)](_0x1a1607['id']);}}async function initPresenceSubscriptions(_0x401972){const _0x4d7a64=a0_0x49390c,_0x3528fb=_0x401972[_0x4d7a64(0x237)][_0x4d7a64(0x1e2)];if(_0x3528fb)for(const _0x158b94 of _0x3528fb){await _0x401972[_0x4d7a64(0x20f)](_0x158b94);}}async function setupTelegramListener(_0x1c6366){const _0x5f395d=a0_0x49390c,_0x28203e=_0x1c6366[_0x5f395d(0x237)][_0x5f395d(0x161)];if(_0x1c6366[_0x5f395d(0x237)][_0x5f395d(0x286)]&&_0x28203e)await _0x1c6366[_0x5f395d(0x20f)](_0x28203e+_0x5f395d(0x277));}async function checkWifiPresence(_0xdb4aab){const _0x5cb91d=a0_0x49390c;try{const _0x47c8c2=_0xdb4aab['config'][_0x5cb91d(0x1e2)]||[];let _0x5e2063=![];const _0x1dc967=[];for(const _0x546ef4 of _0x47c8c2){try{const _0x24aeb8=await _0xdb4aab[_0x5cb91d(0x239)](_0x546ef4);_0x24aeb8&&(_0x24aeb8['val']===!![]||_0x24aeb8[_0x5cb91d(0x2c2)]===_0x5cb91d(0x15f)||_0x24aeb8[_0x5cb91d(0x2c2)]===0x1)&&(_0x5e2063=!![],_0x1dc967['push'](_0x546ef4));}catch(_0x43da34){}}return await _0xdb4aab[_0x5cb91d(0x251)](_0x5cb91d(0x215),{'val':_0x1dc967['join'](',\x20'),'ack':!![]}),_0x5e2063&&(_0xdb4aab[_0x5cb91d(0x268)]&&(_0xdb4aab['log'][_0x5cb91d(0x195)](_0x5cb91d(0x180)),abortExitTimer(_0xdb4aab)),!_0xdb4aab[_0x5cb91d(0x298)]&&_0xdb4aab[_0x5cb91d(0x2c6)]===SYSTEM_MODES[_0x5cb91d(0x1d7)]&&await setPresence(_0xdb4aab,!![])),_0x5e2063;}catch(_0x37d8e2){return![];}}function startExitTimer(_0x19e148){const _0x2f389a=a0_0x49390c;abortExitTimer(_0x19e148),_0x19e148[_0x2f389a(0x163)]=!![],_0x19e148[_0x2f389a(0x20d)]=setTimeout(()=>{_0x19e148['isGracePeriodActive']=![];},EXIT_GRACE_PERIOD_SECONDS*0x3e8),_0x19e148[_0x2f389a(0x268)]=setTimeout(()=>{const _0x4c9682=_0x2f389a;setPresence(_0x19e148,![]),_0x19e148[_0x4c9682(0x268)]=null;},EXIT_TIMER_MINUTES*0x3c*0x3e8);}function abortExitTimer(_0x919509){const _0x12da5a=a0_0x49390c;if(_0x919509[_0x12da5a(0x268)])clearTimeout(_0x919509['exitTimer']);if(_0x919509['exitGraceTimer'])clearTimeout(_0x919509[_0x12da5a(0x20d)]);_0x919509[_0x12da5a(0x268)]=null,_0x919509[_0x12da5a(0x20d)]=null,_0x919509['isGracePeriodActive']=![];}async function setPresence(_0x3b2e43,_0x369667){const _0x9965ee=a0_0x49390c;if(_0x3b2e43[_0x9965ee(0x298)]===_0x369667)return;_0x3b2e43[_0x9965ee(0x298)]=_0x369667,await _0x3b2e43[_0x9965ee(0x251)](_0x9965ee(0x264),{'val':_0x369667,'ack':!![]});}async function executeAutomationAction(_0x451ece){const _0x4049fd=a0_0x49390c;try{const _0x322dd0=await _0x451ece['getStateAsync'](_0x4049fd(0x2c8)),_0x13bb22=await _0x451ece[_0x4049fd(0x28d)]('analysis.automation.targetValue');if(_0x322dd0&&_0x322dd0[_0x4049fd(0x2c2)]&&_0x13bb22){const _0x298ad8=_0x322dd0[_0x4049fd(0x2c2)];let _0x317f04=_0x13bb22['val'];try{_0x317f04=JSON['parse'](_0x317f04);}catch(_0x4166ca){}_0x451ece[_0x4049fd(0x272)]['info'](_0x4049fd(0x2a4)+_0x298ad8+'\x20=\x20'+_0x317f04),await _0x451ece['setForeignStateAsync'](_0x298ad8,_0x317f04);}else _0x451ece['log']['warn'](_0x4049fd(0x2de));}catch(_0x36a8f8){_0x451ece[_0x4049fd(0x272)][_0x4049fd(0x1d9)](_0x4049fd(0x243)+_0x36a8f8[_0x4049fd(0x199)]);}}async function processSensorEvent(_0x13c2d5,_0x56ab78,_0x1b96b2,_0x4beab7){const _0x2adb45=a0_0x49390c;if(!_0x4beab7)return;const _0x428d3f=_0x1b96b2['val'],_0x16bc4b=Date[_0x2adb45(0x231)](),_0x286357=_0x13c2d5['sensorLastValues'][_0x56ab78];_0x13c2d5[_0x2adb45(0x212)][_0x56ab78]=_0x428d3f;if(!_0x4beab7[_0x2adb45(0x21a)]&&_0x286357!=undefined&&_0x286357==_0x428d3f)return;const _0x42bdde=(_0x4beab7['type']||'')['toLowerCase'](),_0x3f0124=_0x42bdde[_0x2adb45(0x166)](_0x2adb45(0x159))||_0x42bdde[_0x2adb45(0x166)](_0x2adb45(0x150))||_0x42bdde[_0x2adb45(0x166)]('klima')||_0x42bdde[_0x2adb45(0x166)](_0x2adb45(0x182));_0x13c2d5[_0x2adb45(0x203)]&&_0x3f0124&&recordThermodynamics(_0x13c2d5,_0x56ab78,_0x428d3f,_0x4beab7[_0x2adb45(0x265)]);const _0xa1cc74={'timestamp':_0x16bc4b,'id':_0x56ab78,'name':_0x4beab7[_0x2adb45(0x189)],'type':_0x4beab7[_0x2adb45(0x16d)],'location':_0x4beab7[_0x2adb45(0x265)],'value':_0x428d3f};_0x13c2d5[_0x2adb45(0x2b5)][_0x2adb45(0x1d5)](_0xa1cc74);if(_0x13c2d5[_0x2adb45(0x2b5)][_0x2adb45(0x232)]>HISTORY_MAX_SIZE)_0x13c2d5[_0x2adb45(0x2b5)][_0x2adb45(0x1c6)]();await _0x13c2d5['setStateAsync'](_0x2adb45(0x2ea),{'val':JSON['stringify'](_0xa1cc74),'ack':!![]}),await _0x13c2d5['setStateAsync'](_0x2adb45(0x20e),{'val':JSON[_0x2adb45(0x23c)](_0x13c2d5[_0x2adb45(0x2b5)]),'ack':!![]});_0x13c2d5[_0x2adb45(0x203)]&&(_0x13c2d5['rawEventLog'][_0x2adb45(0x2af)](_0xa1cc74),await saveRawEventLog(_0x13c2d5),recordSequence(_0x13c2d5,_0xa1cc74));if(_0x4beab7[_0x2adb45(0x21f)]&&_0x428d3f===!![]){if(_0x13c2d5[_0x2adb45(0x298)]&&!_0x13c2d5['isGracePeriodActive'])startExitTimer(_0x13c2d5);else{if(!_0x13c2d5[_0x2adb45(0x298)])setPresence(_0x13c2d5,!![]);}}else{if(_0x4beab7['type']===_0x2adb45(0x2d4)&&_0x428d3f===!![]){if(_0x13c2d5[_0x2adb45(0x268)])abortExitTimer(_0x13c2d5);if(!_0x13c2d5[_0x2adb45(0x298)]&&_0x13c2d5[_0x2adb45(0x2c6)]===SYSTEM_MODES[_0x2adb45(0x1d7)])setPresence(_0x13c2d5,!![]);}}}async function recordThermodynamics(_0x401f12,_0x307e16,_0xad6cfc,_0x3987d7){const _0x379b45=a0_0x49390c,_0x9d7be6=await getOutsideTemperatureNumeric(_0x401f12),_0x5a9c4f=await _0x401f12[_0x379b45(0x28d)]('LTM.trainingData.thermodynamics');let _0x345bf9=[];if(_0x5a9c4f&&_0x5a9c4f[_0x379b45(0x2c2)])try{_0x345bf9=JSON[_0x379b45(0x278)](_0x5a9c4f[_0x379b45(0x2c2)]);}catch(_0x104662){}_0x345bf9[_0x379b45(0x2af)]({'ts':Date[_0x379b45(0x231)](),'room':_0x3987d7||_0x379b45(0x227),'t_in':_0xad6cfc,'t_out':_0x9d7be6});if(_0x345bf9[_0x379b45(0x232)]>THERMO_LOG_SIZE)_0x345bf9[_0x379b45(0x255)]();await _0x401f12[_0x379b45(0x251)](_0x379b45(0x284),{'val':JSON[_0x379b45(0x23c)](_0x345bf9),'ack':!![]});}async function getOutsideTemperatureNumeric(_0x443e76){const _0x57d685=a0_0x49390c;if(_0x443e76[_0x57d685(0x237)]['outdoorSensorId'])try{const _0xe78628=await _0x443e76[_0x57d685(0x239)](_0x443e76['config'][_0x57d685(0x236)]);if(_0xe78628&&_0xe78628[_0x57d685(0x2c2)]!==undefined&&_0xe78628[_0x57d685(0x2c2)]!==null)return parseFloat(_0xe78628[_0x57d685(0x2c2)]);}catch(_0x34e5ae){}const _0x530b98=_0x443e76[_0x57d685(0x237)][_0x57d685(0x2c3)];if(!_0x443e76['config'][_0x57d685(0x24b)]||!_0x530b98)return null;try{let _0x240581='';if(_0x530b98[_0x57d685(0x166)]('accuweather'))_0x240581=_0x530b98+_0x57d685(0x256);else{if(_0x530b98[_0x57d685(0x166)](_0x57d685(0x2dd)))_0x240581=_0x530b98+_0x57d685(0x1e5);else{if(_0x530b98[_0x57d685(0x166)]('openweathermap'))_0x240581=_0x530b98+_0x57d685(0x247);else{if(_0x530b98['includes']('weatherunderground'))_0x240581=_0x530b98+_0x57d685(0x27d);}}}if(_0x240581){const _0x28d5a1=await _0x443e76[_0x57d685(0x239)](_0x240581);if(_0x28d5a1&&_0x28d5a1[_0x57d685(0x2c2)]!==undefined&&_0x28d5a1['val']!==null)return parseFloat(_0x28d5a1[_0x57d685(0x2c2)]);}}catch(_0x2f2aaf){}return null;}async function recordSequence(_0x2b0fe7,_0x5518a8){const _0x54b024=a0_0x49390c,_0xb78c63=(_0x5518a8['type']||'')[_0x54b024(0x1d3)](),_0x50ab30=['motion',_0x54b024(0x1f3),'prÃ¤senz',_0x54b024(0x29d),_0x54b024(0x1a0),_0x54b024(0x176),_0x54b024(0x2df),_0x54b024(0x2f7),_0x54b024(0x1a7),_0x54b024(0x282),_0x54b024(0x285),_0x54b024(0x299),_0x54b024(0x191),_0x54b024(0x2d0),'schalter',_0x54b024(0x29c),'lampe'];if(!_0x50ab30['some'](_0x582362=>_0xb78c63['includes'](_0x582362)))return;if(!_0x5518a8[_0x54b024(0x210)])return;if(sequenceTimer)clearTimeout(sequenceTimer);activeSequence[_0x54b024(0x2af)]({'loc':_0x5518a8[_0x54b024(0x265)]||'Unknown','id':_0x5518a8['id'],'ts':Date[_0x54b024(0x231)]()}),sequenceTimer=setTimeout(async()=>{const _0x48a7c2=_0x54b024;if(activeSequence[_0x48a7c2(0x232)]>0x1)await saveCompletedSequence(_0x2b0fe7);activeSequence=[];},SEQUENCE_TIMEOUT_MS);}async function saveCompletedSequence(_0x36122e){const _0x5895db=a0_0x49390c;try{const _0x468558=await _0x36122e['getStateAsync'](_0x5895db(0x14c));let _0x5479b7=[];if(_0x468558&&_0x468558[_0x5895db(0x2c2)])try{_0x5479b7=JSON[_0x5895db(0x278)](_0x468558[_0x5895db(0x2c2)]);}catch(_0x41d1ee){}const _0x2f5bad=activeSequence[0x0]['ts'],_0x331414=activeSequence['map'](_0x3a22d1=>({'loc':_0x3a22d1['loc'],'t_delta':Math['round']((_0x3a22d1['ts']-_0x2f5bad)/0x3e8)})),_0x441958={'timestamp':new Date(_0x2f5bad)['toISOString'](),'steps':_0x331414,'duration':Math[_0x5895db(0x2fb)]((activeSequence[activeSequence['length']-0x1]['ts']-_0x2f5bad)/0x3e8),'daytime':new Date(_0x2f5bad)[_0x5895db(0x1e1)]()};_0x5479b7[_0x5895db(0x2af)](_0x441958);if(_0x5479b7[_0x5895db(0x232)]>MAX_TRAINING_SET_SIZE)_0x5479b7[_0x5895db(0x255)]();await _0x36122e[_0x5895db(0x251)](_0x5895db(0x14c),{'val':JSON[_0x5895db(0x23c)](_0x5479b7),'ack':!![]}),runSecurityCheck(_0x36122e,_0x441958);}catch(_0x299406){_0x36122e[_0x5895db(0x272)][_0x5895db(0x1d9)]('[RECORDER]\x20Error:\x20'+_0x299406[_0x5895db(0x199)]);}}function runSecurityCheck(_0x39f121,_0x8d419b){const _0x46cb94=a0_0x49390c;if(!_0x39f121[_0x46cb94(0x203)])return;sendToPython(_0x39f121,_0x46cb94(0x14d),{'sequence':_0x8d419b});}function sendToPython(_0x297dba,_0x3f36f2,_0x277e5e={}){const _0x4968a3=a0_0x49390c;if(!_0x297dba['pythonProcess']||!_0x297dba[_0x4968a3(0x235)]['stdin']['writable'])return;const _0x2da44c=JSON[_0x4968a3(0x23c)]({'command':_0x3f36f2,..._0x277e5e});try{_0x297dba[_0x4968a3(0x235)][_0x4968a3(0x2a2)][_0x4968a3(0x1c2)](_0x2da44c+'\x0a');}catch(_0x49c5e4){}}function startPythonService(_0x378585){const _0x204c01=a0_0x49390c;let _0x14335f=_0x204c01(0x1ef);if(fs[_0x204c01(0x22c)](PYTHON_EXE))_0x14335f=PYTHON_EXE;try{const _0x3f23b3=path[_0x204c01(0x28c)](__dirname,'python_service',_0x204c01(0x1f1));_0x378585['pythonProcess']=spawn(_0x14335f,[_0x3f23b3]),_0x378585[_0x204c01(0x235)][_0x204c01(0x238)]['on'](_0x204c01(0x2b8),_0x32e7ce=>{const _0xcbdd96=_0x204c01,_0x30bf06=_0x32e7ce[_0xcbdd96(0x2d9)]()[_0xcbdd96(0x1ae)]('\x0a');_0x30bf06[_0xcbdd96(0x281)](_0x1d1974=>{const _0x832dbd=_0xcbdd96,_0x1ceff1=_0x1d1974[_0x832dbd(0x17e)]();if(!_0x1ceff1)return;if(_0x1ceff1[_0x832dbd(0x2ae)](_0x832dbd(0x209)))_0x378585['log'][_0x832dbd(0x1bc)](_0x832dbd(0x1e8)+_0x1ceff1[_0x832dbd(0x218)](0x5)['trim']());else{if(_0x1ceff1[_0x832dbd(0x2ae)]('[RESULT]'))try{const _0x4e8ed0=JSON[_0x832dbd(0x278)](_0x1ceff1[_0x832dbd(0x218)](0x8)['trim']());handlePythonResult(_0x378585,_0x4e8ed0);}catch(_0x1caf34){}}});}),_0x378585[_0x204c01(0x235)]['on'](_0x204c01(0x2a1),_0x3da74d=>{_0x378585['pythonProcess']=null;});}catch(_0x247428){_0x378585[_0x204c01(0x272)][_0x204c01(0x1d9)](_0x204c01(0x24a)+_0x247428[_0x204c01(0x199)]);}}function stopPythonService(_0x4b1d5a){const _0x1c6505=a0_0x49390c;if(_0x4b1d5a[_0x1c6505(0x235)]){try{_0x4b1d5a[_0x1c6505(0x235)]['kill']();}catch(_0x12cc91){}_0x4b1d5a[_0x1c6505(0x235)]=null;}}function handlePythonResult(_0x175dab,_0x217481){const _0x4d391b=a0_0x49390c;if(_0x217481['type']==='PONG')_0x175dab[_0x4d391b(0x272)][_0x4d391b(0x1bc)](_0x4d391b(0x17f));else{if(_0x217481[_0x4d391b(0x16d)]===_0x4d391b(0x19a)){const {anomaly_score:_0x275897,is_anomaly:_0x433a19,threshold:_0x445b1f,explanation:_0x46f561}=_0x217481[_0x4d391b(0x275)];_0x175dab[_0x4d391b(0x272)][_0x4d391b(0x195)](_0x4d391b(0x1d2)+_0x275897[_0x4d391b(0x1dc)](0x5)+'\x20->\x20'+(_0x433a19?_0x4d391b(0x27c):'OK')),_0x175dab[_0x4d391b(0x251)](_0x4d391b(0x29e),{'val':_0x275897,'ack':!![]}),_0x175dab['setStateAsync'](_0x4d391b(0x178),{'val':new Date()[_0x4d391b(0x1bf)](),'ack':!![]});if(_0x445b1f)_0x175dab[_0x4d391b(0x251)](_0x4d391b(0x222),{'val':_0x445b1f,'ack':!![]});if(_0x433a19){let _0x37f1b0=_0x4d391b(0x1eb)+_0x275897[_0x4d391b(0x1dc)](0x4)+')';if(_0x46f561&&_0x46f561!==_0x4d391b(0x227))_0x37f1b0+=_0x4d391b(0x1d8)+_0x46f561;_0x175dab[_0x4d391b(0x251)](_0x4d391b(0x1b9),{'val':!![],'ack':!![]}),_0x175dab[_0x4d391b(0x251)](_0x4d391b(0x1b5),{'val':_0x37f1b0,'ack':!![]}),sendNotification(_0x175dab,_0x4d391b(0x294)+_0x37f1b0,![],!![]);}}else{if(_0x217481['type']===_0x4d391b(0x197)){const _0x222ee0=_0x217481[_0x4d391b(0x275)][_0x4d391b(0x205)]||'',_0x2428b3=_0x217481[_0x4d391b(0x275)][_0x4d391b(0x1c4)],_0x2d3bc0=_0x217481[_0x4d391b(0x275)][_0x4d391b(0x18e)]?'Success:\x20'+new Date()[_0x4d391b(0x2e4)]()+'\x20('+_0x222ee0+')':_0x4d391b(0x1df)+_0x217481['payload']['reason'];_0x175dab[_0x4d391b(0x251)](_0x4d391b(0x22e),{'val':_0x2d3bc0,'ack':!![]});if(_0x217481[_0x4d391b(0x275)][_0x4d391b(0x18e)]&&_0x2428b3)_0x175dab[_0x4d391b(0x251)](_0x4d391b(0x222),{'val':_0x2428b3,'ack':!![]});}else{if(_0x217481['type']===_0x4d391b(0x290)){const {patterns:_0x1a42bc}=_0x217481[_0x4d391b(0x275)];if(_0x1a42bc&&_0x1a42bc['length']>0x0){_0x175dab[_0x4d391b(0x272)][_0x4d391b(0x195)](_0x4d391b(0x25e)+_0x1a42bc[_0x4d391b(0x232)]+_0x4d391b(0x213)),_0x175dab[_0x4d391b(0x251)]('analysis.automation.detectedPatterns',{'val':JSON['stringify'](_0x1a42bc),'ack':!![]});const _0x3ee723=_0x1a42bc[0x0],_0x1fc679='Regel\x20erkannt:\x20'+_0x3ee723[_0x4d391b(0x2ed)]+'\x20('+(_0x3ee723[_0x4d391b(0x2cd)]*0x64)[_0x4d391b(0x1dc)](0x0)+'%)';_0x175dab['setStateAsync']('analysis.automation.patternDetected',{'val':!![],'ack':!![]}),_0x175dab[_0x4d391b(0x251)]('analysis.automation.description',{'val':_0x1fc679,'ack':!![]});}else _0x175dab['log'][_0x4d391b(0x195)](_0x4d391b(0x2b3)),_0x175dab[_0x4d391b(0x251)]('analysis.automation.patternDetected',{'val':![],'ack':!![]}),_0x175dab['setStateAsync'](_0x4d391b(0x184),{'val':'[]','ack':!![]});}else{if(_0x217481[_0x4d391b(0x16d)]==='ENERGY_TRAIN_RESULT'){if(_0x217481[_0x4d391b(0x275)][_0x4d391b(0x18e)])try{const _0x31d604=JSON[_0x4d391b(0x278)](_0x217481[_0x4d391b(0x275)][_0x4d391b(0x205)]);if(_0x31d604[_0x4d391b(0x246)])_0x175dab[_0x4d391b(0x251)]('analysis.energy.insulationScore',{'val':JSON['stringify'](_0x31d604[_0x4d391b(0x246)]),'ack':!![]});if(_0x31d604['heating'])_0x175dab[_0x4d391b(0x251)]('analysis.energy.heatingScore',{'val':JSON['stringify'](_0x31d604[_0x4d391b(0x2d3)]),'ack':!![]});}catch(_0x4e27cb){}}else{if(_0x217481[_0x4d391b(0x16d)]===_0x4d391b(0x186)){if(_0x217481[_0x4d391b(0x275)]['success'])_0x175dab[_0x4d391b(0x272)][_0x4d391b(0x195)]('âœ…\x20HEALTH\x20TRAINED.');}else{if(_0x217481[_0x4d391b(0x16d)]===_0x4d391b(0x2db))_0x175dab[_0x4d391b(0x251)](_0x4d391b(0x293),{'val':new Date()[_0x4d391b(0x1bf)](),'ack':!![]}),_0x175dab['setStateAsync'](_0x4d391b(0x2d7),{'val':_0x217481[_0x4d391b(0x275)][_0x4d391b(0x217)],'ack':!![]});else _0x217481[_0x4d391b(0x16d)]===_0x4d391b(0x15a)&&(_0x175dab[_0x4d391b(0x251)](_0x4d391b(0x170),{'val':_0x217481[_0x4d391b(0x275)]['diagnosis'],'ack':!![]}),_0x175dab['setStateAsync'](_0x4d391b(0x152),{'val':_0x217481[_0x4d391b(0x275)][_0x4d391b(0x2e2)],'ack':!![]}));}}}}}}}function runPythonHealthCheck(_0x5cee6a){const _0x4230d5=a0_0x49390c;if(!_0x5cee6a[_0x4230d5(0x296)]||_0x5cee6a[_0x4230d5(0x296)][_0x4230d5(0x232)]<0x2)return;const _0x42fe34=_0x5cee6a[_0x4230d5(0x296)][_0x4230d5(0x15c)](_0x4757c9=>{const _0x38889d=_0x4230d5,_0x3b7f1e=(_0x4757c9[_0x38889d(0x19b)]||'')['toLowerCase']();return ACTIVITY_LEVEL_MAP[_0x3b7f1e]||0x32;});sendToPython(_0x5cee6a,_0x4230d5(0x2dc),{'values':_0x42fe34,'tag':'Activity-Level'});}async function handleTelegramResponse(_0x184e73,_0x510186){const _0x447e46=a0_0x49390c;let _0x2a0df1=_0x510186;_0x510186[_0x447e46(0x2ae)]('[')&&(_0x2a0df1=_0x510186['substring'](_0x510186[_0x447e46(0x1a2)](']')+0x1));if(_0x2a0df1===_0x447e46(0x21b))await _0x184e73[_0x447e46(0x251)]('analysis.isAlert',{'val':![],'ack':!![]}),await _0x184e73['setStateAsync'](_0x447e46(0x1b5),{'val':_0x447e46(0x17a),'ack':!![]}),_0x184e73['lastAlertState']=![],sendNotification(_0x184e73,'âœ…\x20Alarm\x20quittiert.\x20System\x20normal.',![]);else _0x2a0df1===_0x447e46(0x158)&&sendNotification(_0x184e73,_0x447e46(0x1c3),![],!![]);}async function sendNotification(_0x4a99f2,_0x4bff55,_0x6a2605=![],_0x43b289=![]){const _0x4b4649=a0_0x49390c,_0x5634a5=_0x4a99f2[_0x4b4649(0x237)];if(_0x5634a5[_0x4b4649(0x286)]){let _0x31d9cc={};(_0x4bff55['includes'](_0x4b4649(0x19d))||_0x43b289)&&(_0x31d9cc={'reply_markup':{'inline_keyboard':[[{'text':'âœ…\x20Alles\x20OK\x20(Reset)','callback_data':_0x4b4649(0x21b)}],[{'text':_0x4b4649(0x283),'callback_data':_0x4b4649(0x158)}]]}}),await _0x4a99f2[_0x4b4649(0x2c5)](_0x5634a5[_0x4b4649(0x161)],_0x4b4649(0x1fa),{'text':_0x4bff55,'user':_0x5634a5[_0x4b4649(0x2ee)],..._0x31d9cc});}if(_0x5634a5[_0x4b4649(0x24f)]){let _0x258982={'message':_0x4bff55,'title':_0x43b289?_0x4b4649(0x1f6):_0x4b4649(0x154),'priority':_0x43b289?0x2:0x1,'device':_0x5634a5[_0x4b4649(0x1c7)]};_0x43b289&&(_0x258982[_0x4b4649(0x24c)]=0x1e,_0x258982[_0x4b4649(0x19f)]=0xe10,_0x258982[_0x4b4649(0x1d6)]=_0x4b4649(0x2eb)),await _0x4a99f2[_0x4b4649(0x2c5)](_0x5634a5[_0x4b4649(0x1a8)],_0x4b4649(0x1fa),_0x258982);}_0x5634a5[_0x4b4649(0x1fb)]&&await _0x4a99f2['sendToAsync'](_0x5634a5[_0x4b4649(0x2b2)],'send',{'text':_0x4bff55,'to':_0x5634a5[_0x4b4649(0x2ef)]});}async function runGeminiAnalysis(_0x332a4f,_0x2157d7=''){const _0x10e5ab=a0_0x49390c;if(!_0x332a4f['geminiModel'])return;if(_0x332a4f[_0x10e5ab(0x2b5)][_0x10e5ab(0x232)]===0x0)return;const _0x4b60d4=_0x332a4f['eventHistory'][_0x10e5ab(0x223)](0x0,0xf),_0x28b4f8=await getWeatherContext(_0x332a4f),_0x7df730=_0x332a4f[_0x10e5ab(0x2c6)],_0x394f9c=PERSONA_MAPPING[_0x332a4f[_0x10e5ab(0x237)]['aiPersona']||'generic'],_0x2795ab=_0x332a4f['config'][_0x10e5ab(0x1de)]||_0x10e5ab(0x2f6);let _0x4fa3c1='Unbekannt';try{const _0x4c38ae=await _0x332a4f['getStateAsync'](_0x10e5ab(0x215));if(_0x4c38ae&&_0x4c38ae[_0x10e5ab(0x2c2)])_0x4fa3c1=_0x4c38ae[_0x10e5ab(0x2c2)];}catch(_0x3d6f8a){}let _0xa1c921=![];try{const _0x890c7d=await _0x332a4f['getStateAsync']('analysis.automation.autoApply');if(_0x890c7d&&_0x890c7d[_0x10e5ab(0x2c2)])_0xa1c921=!![];}catch(_0x48c3ad){}const _0x5bf618=_0x10e5ab(0x2cc)+_0x394f9c+_0x10e5ab(0x25a)+_0x2795ab+_0x10e5ab(0x2ce)+_0x7df730+_0x10e5ab(0x24e)+_0x28b4f8+_0x10e5ab(0x267)+_0x4fa3c1+_0x10e5ab(0x183)+JSON[_0x10e5ab(0x23c)](_0x4b60d4)+_0x10e5ab(0x241)+_0x2157d7+'.\x20AUFGABE:\x201.\x20Gesundheit?\x202.\x20Komfort?\x20FORMAT\x20(JSON):\x20{\x20\x22isAlert\x22:\x20boolean,\x20\x22alertReason\x22:\x20\x22string\x22,\x20\x22isEmergency\x22:\x20boolean,\x20\x22summary\x22:\x20\x22string\x22,\x20\x22automationProposal\x22:\x20{\x20\x22detected\x22:\x20boolean,\x20\x22description\x22:\x20\x22string\x22,\x20\x22targetId\x22:\x20\x22string\x22,\x20\x22targetValue\x22:\x20\x22any\x22\x20}\x20}';try{const _0x21a1df=await _0x332a4f[_0x10e5ab(0x23d)][_0x10e5ab(0x257)](_0x5bf618),_0x38884c=JSON[_0x10e5ab(0x278)](_0x21a1df[_0x10e5ab(0x198)][_0x10e5ab(0x1dd)]()[_0x10e5ab(0x1a1)](/```json|```/g,'')[_0x10e5ab(0x17e)]());await _0x332a4f[_0x10e5ab(0x251)](_0x10e5ab(0x1ac),{'val':JSON['stringify'](_0x38884c),'ack':!![]});if(_0x38884c['summary'])await _0x332a4f[_0x10e5ab(0x251)](_0x10e5ab(0x2f1),{'val':_0x38884c['summary'],'ack':!![]});const _0x26547a={'timestamp':Date['now'](),'id':Date[_0x10e5ab(0x231)]()['toString'](),'analysis':{'activity':{'summary':_0x38884c[_0x10e5ab(0x23b)],'isAlert':_0x38884c['isAlert'],'alertReason':_0x38884c[_0x10e5ab(0x174)]},'comfort':{'automationProposal':_0x38884c[_0x10e5ab(0x1e4)]}}};await updateAnalysisHistory(_0x332a4f,_0x26547a);const _0x241539=_0x38884c[_0x10e5ab(0x234)]||![];_0x241539!==_0x332a4f['lastAlertState']&&(await _0x332a4f['setStateAsync'](_0x10e5ab(0x1b9),{'val':_0x241539,'ack':!![]}),_0x332a4f[_0x10e5ab(0x229)]=_0x241539,_0x241539&&(await _0x332a4f[_0x10e5ab(0x251)]('analysis.alertReason',{'val':_0x38884c['alertReason'],'ack':!![]}),sendNotification(_0x332a4f,'âš ï¸\x20ALARM:\x20'+_0x38884c[_0x10e5ab(0x174)],![],_0x38884c[_0x10e5ab(0x18f)])));if(_0x38884c[_0x10e5ab(0x1e4)]&&_0x38884c[_0x10e5ab(0x1e4)][_0x10e5ab(0x187)]){await _0x332a4f[_0x10e5ab(0x251)](_0x10e5ab(0x266),{'val':!![],'ack':!![]}),await _0x332a4f[_0x10e5ab(0x251)](_0x10e5ab(0x1a6),{'val':_0x38884c['automationProposal'][_0x10e5ab(0x28a)],'ack':!![]}),await _0x332a4f[_0x10e5ab(0x251)](_0x10e5ab(0x2c8),{'val':_0x38884c[_0x10e5ab(0x1e4)][_0x10e5ab(0x250)],'ack':!![]}),await _0x332a4f[_0x10e5ab(0x251)](_0x10e5ab(0x26e),{'val':JSON[_0x10e5ab(0x23c)](_0x38884c[_0x10e5ab(0x1e4)][_0x10e5ab(0x2d6)]),'ack':!![]});if(_0xa1c921)executeAutomationAction(_0x332a4f);}}catch(_0x3c90f4){_0x332a4f[_0x10e5ab(0x272)]['error']('Gemini\x20Error:\x20'+_0x3c90f4[_0x10e5ab(0x199)]);}}async function createDailyDigest(_0x231669){const _0xa16ed4=a0_0x49390c;if(!_0x231669[_0xa16ed4(0x203)])return;await _0x231669[_0xa16ed4(0x251)](LTM_DP_STATUS,{'val':_0xa16ed4(0x1ab),'ack':!![]});if(!_0x231669[_0xa16ed4(0x23d)]||_0x231669[_0xa16ed4(0x262)][_0xa16ed4(0x232)]<LTM_MIN_EVENTS_FOR_COMPRESSION){await _0x231669[_0xa16ed4(0x251)](LTM_DP_STATUS,{'val':'Skipped\x20(No\x20AI\x20or\x20Data)','ack':!![]});return;}const _0x513938=JSON[_0xa16ed4(0x278)](JSON[_0xa16ed4(0x23c)](_0x231669['rawEventLog'])),_0x40a2c1=_0x513938[_0xa16ed4(0x232)],_0x48ec01=new Array(0x60)['fill'](0x0),_0x1bb7a1=new Date()['setHours'](0x0,0x0,0x0,0x0);_0x513938[_0xa16ed4(0x281)](_0x2740e7=>{const _0x2ea753=_0xa16ed4,_0x372de9=new Date(_0x2740e7[_0x2ea753(0x291)]),_0x51ccde=_0x372de9[_0x2ea753(0x1e1)](),_0x3c03ec=_0x372de9[_0x2ea753(0x1a9)](),_0x3d2b2f=_0x51ccde*0x4+Math[_0x2ea753(0x2d2)](_0x3c03ec/0xf);if(_0x3d2b2f>=0x0&&_0x3d2b2f<0x60)_0x48ec01[_0x3d2b2f]++;});const _0x40410e='ROLLE:\x20Data\x20Compression\x20Agent.\x20SPRACHE:\x20DE.\x20FORMAT:\x20JSON.\x20ANWEISUNG:\x20Fasse\x20Sensor-Events\x20zusammen.\x20SCHEMA:\x20{\x20\x22summary\x22:\x20\x22string\x22,\x20\x22activityLevel\x22:\x20\x22string\x22\x20}\x20\x0a\x0aEVENTS:\x0a'+JSON[_0xa16ed4(0x23c)](_0x513938['slice'](0x0,0x32));try{const _0x3eef0f=await _0x231669[_0xa16ed4(0x23d)][_0xa16ed4(0x257)](_0x40410e),_0xaf64a9=JSON[_0xa16ed4(0x278)](_0x3eef0f[_0xa16ed4(0x198)][_0xa16ed4(0x1dd)]()[_0xa16ed4(0x1a1)](/```json|```/g,'')[_0xa16ed4(0x17e)]()),_0x9801fd={'timestamp':new Date()[_0xa16ed4(0x1bf)](),'eventCount':_0x40a2c1,'summary':_0xaf64a9['summary']||_0xa16ed4(0x1ca),'activityLevel':_0xaf64a9[_0xa16ed4(0x19b)]||_0xa16ed4(0x157),'systemMode':_0x231669[_0xa16ed4(0x2c6)],'activityVector':_0x48ec01};_0x231669[_0xa16ed4(0x296)]['push'](_0x9801fd),await saveDailyDigests(_0x231669),_0x231669[_0xa16ed4(0x262)]=[],await saveRawEventLog(_0x231669),await _0x231669[_0xa16ed4(0x251)](LTM_DP_STATUS,{'val':'Success','ack':!![]});if(_0x231669[_0xa16ed4(0x203)])sendToPython(_0x231669,_0xa16ed4(0x1a3),{'digest':_0x9801fd});}catch(_0x273739){_0x231669[_0xa16ed4(0x272)][_0xa16ed4(0x1d9)](_0x273739['message']);}}function setupLtmScheduler(_0x54a10d){const _0x442a4f=a0_0x49390c;try{if(_0x54a10d['ltmJob'])_0x54a10d[_0x442a4f(0x18c)]['cancel']();if(!_0x54a10d[_0x442a4f(0x203)])return;_0x54a10d['ltmJob']=schedule[_0x442a4f(0x16c)](LTM_SCHEDULE,()=>createDailyDigest(_0x54a10d));}catch(_0x32a154){_0x54a10d[_0x442a4f(0x272)][_0x442a4f(0x1d9)](_0x442a4f(0x1f8)+_0x32a154[_0x442a4f(0x199)]);}}function setupModeResetScheduler(_0x28b895){const _0x187001=a0_0x49390c;try{if(_0x28b895[_0x187001(0x1da)])_0x28b895['modeResetJob'][_0x187001(0x15e)]();_0x28b895['modeResetJob']=schedule[_0x187001(0x16c)](MODE_RESET_SCHEDULE,async()=>{const _0x1255cf=_0x187001;await loadSystemMode(_0x28b895),AUTO_RESET_MODES[_0x1255cf(0x166)](_0x28b895[_0x1255cf(0x2c6)])&&await _0x28b895[_0x1255cf(0x251)](SYSTEM_DP_MODE,{'val':SYSTEM_MODES['NORMAL'],'ack':![]});});}catch(_0x532fc2){_0x28b895['log']['error'](_0x187001(0x29b)+_0x532fc2['message']);}}function setupDriftAnalysisScheduler(_0x1694de){const _0x4482b4=a0_0x49390c;try{if(_0x1694de[_0x4482b4(0x208)])clearInterval(_0x1694de[_0x4482b4(0x208)]);if(!_0x1694de[_0x4482b4(0x203)])return;_0x1694de[_0x4482b4(0x208)]=setInterval(()=>runBaselineDriftAnalysis(_0x1694de),(_0x1694de[_0x4482b4(0x237)][_0x4482b4(0x27e)]||0x18)*0x36ee80),setTimeout(()=>runBaselineDriftAnalysis(_0x1694de),0x1388);}catch(_0x5b5f27){_0x1694de[_0x4482b4(0x272)][_0x4482b4(0x1d9)](_0x4482b4(0x252)+_0x5b5f27[_0x4482b4(0x199)]);}}function setupBriefingScheduler(_0x626694){const _0x5cc356=a0_0x49390c;try{if(_0x626694['briefingJob'])_0x626694[_0x5cc356(0x273)][_0x5cc356(0x15e)]();if(!_0x626694['config'][_0x5cc356(0x253)])return;const _0x209293=(_0x626694['config'][_0x5cc356(0x1b7)]||'08:00')[_0x5cc356(0x1ae)](':'),_0x29ef51=parseInt(_0x209293[0x0])||0x8,_0x7ea1ae=parseInt(_0x209293[0x1])||0x0,_0x1b0216=_0x7ea1ae+'\x20'+_0x29ef51+_0x5cc356(0x26c);_0x626694[_0x5cc356(0x273)]=schedule[_0x5cc356(0x16c)](_0x1b0216,()=>{sendMorningBriefing(_0x626694);});}catch(_0x373f44){_0x626694[_0x5cc356(0x272)][_0x5cc356(0x1d9)](_0x5cc356(0x1ec)+_0x373f44[_0x5cc356(0x199)]);}}async function runBaselineDriftAnalysis(_0x11fde9){const _0x143c18=a0_0x49390c;if(!_0x11fde9[_0x143c18(0x203)]||!_0x11fde9[_0x143c18(0x23d)])return;const _0x33e1f7=_0x11fde9[_0x143c18(0x237)]['ltmStbWindowDays']||0xe;if(_0x11fde9['dailyDigests'][_0x143c18(0x232)]<_0x33e1f7+0x7){await _0x11fde9['setStateAsync'](LTM_DP_DRIFT_STATUS,{'val':_0x143c18(0x196),'ack':!![]});return;}const _0x3a5665=_0x11fde9[_0x143c18(0x296)]['slice'](-_0x33e1f7),_0x3ecf49=_0x11fde9['dailyDigests']['slice'](0x0,_0x11fde9[_0x143c18(0x296)][_0x143c18(0x232)]-_0x33e1f7),_0x50124a=_0x143c18(0x2b9)+JSON[_0x143c18(0x23c)](_0x3ecf49)+'\x0aSTB:\x20'+JSON['stringify'](_0x3a5665);try{const _0x25ee72=await _0x11fde9[_0x143c18(0x23d)][_0x143c18(0x257)](_0x50124a),_0x230438=JSON['parse'](_0x25ee72['response']['text']()[_0x143c18(0x1a1)](/```json|```/g,'')[_0x143c18(0x17e)]());_0x230438['baselineDrift']&&(await _0x11fde9['setStateAsync'](LTM_DP_DRIFT_STATUS,{'val':_0x230438['baselineDrift'],'ack':!![]}),await _0x11fde9[_0x143c18(0x251)](LTM_DP_DRIFT_DETAILS,{'val':_0x230438[_0x143c18(0x263)],'ack':!![]}),await _0x11fde9[_0x143c18(0x251)](LTM_DP_DRIFT_LAST_CHECK,{'val':Date['now'](),'ack':!![]}));}catch(_0x3a0c51){}}class CogniLiving extends utils['Adapter']{constructor(_0x1c45fa){const _0x1d9be3=a0_0x49390c;super({..._0x1c45fa,'name':_0x1d9be3(0x15b)}),this[_0x1d9be3(0x2b5)]=[],this[_0x1d9be3(0x276)]=[],this['rawEventLog']=[],this[_0x1d9be3(0x296)]=[],this[_0x1d9be3(0x212)]={},this[_0x1d9be3(0x2e8)]={'latitude':0x0,'longitude':0x0,'city':''},this[_0x1d9be3(0x298)]=!![],this[_0x1d9be3(0x268)]=null,this[_0x1d9be3(0x20d)]=null,this[_0x1d9be3(0x163)]=![],this[_0x1d9be3(0x1fd)]=null,this[_0x1d9be3(0x23d)]=null,this[_0x1d9be3(0x2c6)]=SYSTEM_MODES[_0x1d9be3(0x1d7)],this[_0x1d9be3(0x203)]=![],this[_0x1d9be3(0x229)]=![],this[_0x1d9be3(0x2f0)]=_0x1d9be3(0x22f),this['analysisTimer']=null,this['ltmJob']=null,this['modeResetJob']=null,this[_0x1d9be3(0x208)]=null,this['briefingJob']=null,this[_0x1d9be3(0x235)]=null,this['dependencyInstallInProgress']=![],this['on'](_0x1d9be3(0x1b0),this[_0x1d9be3(0x2ab)][_0x1d9be3(0x1b3)](this)),this['on'](_0x1d9be3(0x26d),this['onStateChange']['bind'](this)),this['on'](_0x1d9be3(0x27f),this[_0x1d9be3(0x29a)][_0x1d9be3(0x1b3)](this)),this['on'](_0x1d9be3(0x199),this[_0x1d9be3(0x194)]['bind'](this));}async['onReady'](){const _0x2dc44c=a0_0x49390c;this[_0x2dc44c(0x272)]['info'](_0x2dc44c(0x2f3)+this[_0x2dc44c(0x1f2)]+_0x2dc44c(0x2bb));if(!checkAndInstall(this))return;await startSystem(this);}['onUnload'](_0x44b06b){const _0x34cdb7=a0_0x49390c;if(this[_0x34cdb7(0x2be)])clearInterval(this[_0x34cdb7(0x2be)]);if(this[_0x34cdb7(0x208)])clearInterval(this[_0x34cdb7(0x208)]);if(this[_0x34cdb7(0x18c)])this[_0x34cdb7(0x18c)][_0x34cdb7(0x15e)]();if(this[_0x34cdb7(0x1da)])this[_0x34cdb7(0x1da)]['cancel']();if(this[_0x34cdb7(0x273)])this['briefingJob']['cancel']();if(this[_0x34cdb7(0x268)])clearTimeout(this['exitTimer']);if(this[_0x34cdb7(0x20d)])clearTimeout(this['exitGraceTimer']);stopPythonService(this),_0x44b06b();}async[a0_0x49390c(0x25d)](_0x46b7e1,_0x5acc8e){const _0x58dac3=a0_0x49390c;if(!_0x5acc8e||this['dependencyInstallInProgress'])return;if(_0x46b7e1[_0x58dac3(0x166)](_0x58dac3(0x2c4))&&_0x46b7e1['endsWith'](_0x58dac3(0x2fc))&&_0x5acc8e['val']){await handleTelegramResponse(this,_0x5acc8e[_0x58dac3(0x2c2)]);return;}if(_0x46b7e1===this['namespace']+'.'+SYSTEM_DP_MODE){if(_0x5acc8e[_0x58dac3(0x2c2)]&&Object['values'](SYSTEM_MODES)[_0x58dac3(0x166)](_0x5acc8e[_0x58dac3(0x2c2)])){this[_0x58dac3(0x2c6)]=_0x5acc8e[_0x58dac3(0x2c2)];if(_0x5acc8e['val']===SYSTEM_MODES['VACATION'])await setPresence(this,![]);else await setPresence(this,!![]);}if(!_0x5acc8e[_0x58dac3(0x1aa)])this[_0x58dac3(0x1b4)](_0x46b7e1,{'val':this[_0x58dac3(0x2c6)],'ack':!![]});return;}if(!_0x5acc8e[_0x58dac3(0x1aa)]){_0x46b7e1['includes'](_0x58dac3(0x1b1))&&_0x5acc8e[_0x58dac3(0x2c2)]&&(this['setState'](_0x46b7e1,{'val':![],'ack':!![]}),runGeminiAnalysis(this));if(_0x46b7e1[_0x58dac3(0x166)](_0x58dac3(0x24d))&&_0x5acc8e[_0x58dac3(0x2c2)]){this[_0x58dac3(0x1b4)](_0x46b7e1,{'val':![],'ack':!![]});if(this[_0x58dac3(0x203)])createDailyDigest(this);}_0x46b7e1[_0x58dac3(0x166)]('triggerBriefing')&&_0x5acc8e['val']&&(this[_0x58dac3(0x1b4)](_0x46b7e1,{'val':![],'ack':!![]}),sendMorningBriefing(this));_0x46b7e1['includes'](_0x58dac3(0x28e))&&_0x5acc8e[_0x58dac3(0x2c2)]&&(this['setState'](_0x46b7e1,{'val':![],'ack':!![]}),executeAutomationAction(this));if(_0x46b7e1[_0x58dac3(0x166)](_0x58dac3(0x2cb))&&_0x5acc8e[_0x58dac3(0x2c2)]){this[_0x58dac3(0x1b4)](_0x46b7e1,{'val':![],'ack':!![]});if(this[_0x58dac3(0x203)])try{const _0x1e8a04=await this[_0x58dac3(0x28d)](_0x58dac3(0x14c));if(_0x1e8a04&&_0x1e8a04[_0x58dac3(0x2c2)]){const _0x3e694c=JSON['parse'](_0x1e8a04[_0x58dac3(0x2c2)]);this[_0x58dac3(0x272)][_0x58dac3(0x195)](_0x58dac3(0x155)),this[_0x58dac3(0x251)](_0x58dac3(0x22e),{'val':_0x58dac3(0x225),'ack':!![]}),sendToPython(this,_0x58dac3(0x156),{'sequences':_0x3e694c});}}catch(_0x129ef2){this[_0x58dac3(0x272)][_0x58dac3(0x1d9)](_0x58dac3(0x200)+_0x129ef2['message']);}}if(_0x46b7e1[_0x58dac3(0x166)](_0x58dac3(0x168))&&_0x5acc8e['val']){this['setState'](_0x46b7e1,{'val':![],'ack':!![]});if(this['isProVersion'])try{const _0xffce55=await this[_0x58dac3(0x28d)](LTM_DP_DAILY_DIGESTS);if(_0xffce55&&_0xffce55[_0x58dac3(0x2c2)])sendToPython(this,_0x58dac3(0x16a),{'digests':JSON[_0x58dac3(0x278)](_0xffce55['val'])});}catch(_0x46a54d){}}if(_0x46b7e1[_0x58dac3(0x166)]('analysis.training.triggerEnergy')&&_0x5acc8e[_0x58dac3(0x2c2)]){this[_0x58dac3(0x1b4)](_0x46b7e1,{'val':![],'ack':!![]});if(this[_0x58dac3(0x203)])try{const _0x563d0f=await this['getStateAsync']('LTM.trainingData.thermodynamics');if(_0x563d0f&&_0x563d0f['val'])sendToPython(this,_0x58dac3(0x2c9),{'points':JSON[_0x58dac3(0x278)](_0x563d0f[_0x58dac3(0x2c2)])});}catch(_0x57697e){}}if(_0x46b7e1['includes']('analysis.training.triggerComfort')&&_0x5acc8e[_0x58dac3(0x2c2)]){this[_0x58dac3(0x1b4)](_0x46b7e1,{'val':![],'ack':!![]});if(this[_0x58dac3(0x203)])try{const _0xb43a87=await this[_0x58dac3(0x28d)](LTM_DP_RAW_LOG);_0xb43a87&&_0xb43a87[_0x58dac3(0x2c2)]&&(this[_0x58dac3(0x272)][_0x58dac3(0x195)](_0x58dac3(0x26f)),sendToPython(this,_0x58dac3(0x2a8),{'events':JSON[_0x58dac3(0x278)](_0xb43a87['val'])}));}catch(_0x497574){}}return;}if(this[_0x58dac3(0x237)][_0x58dac3(0x1e2)]&&this['config'][_0x58dac3(0x1e2)][_0x58dac3(0x166)](_0x46b7e1)){await checkWifiPresence(this);return;}const _0x33cae8=(this[_0x58dac3(0x237)]['devices']||[])[_0x58dac3(0x165)](_0x173abf=>_0x173abf['id']===_0x46b7e1);if(_0x33cae8)processSensorEvent(this,_0x46b7e1,_0x5acc8e,_0x33cae8);}async[a0_0x49390c(0x194)](_0xf0c017){const _0x18089a=a0_0x49390c;if(typeof _0xf0c017==='object'&&_0xf0c017[_0x18089a(0x199)]){if(_0xf0c017['command']==='testApiKey'){const _0x3ffd08=_0xf0c017['message'][_0x18089a(0x19c)]||this[_0x18089a(0x237)][_0x18089a(0x1cb)];if(!_0x3ffd08)return this['sendTo'](_0xf0c017[_0x18089a(0x2a9)],_0xf0c017[_0x18089a(0x151)],{'success':![],'message':'Kein\x20API\x20Key.'},_0xf0c017['callback']);try{const _0x5d7925=new GoogleGenerativeAI(_0x3ffd08),_0xafbf28=_0x5d7925[_0x18089a(0x2a6)]({'model':GEMINI_MODEL}),_0x57b586=await _0xafbf28[_0x18089a(0x257)]('Hi');this[_0x18089a(0x1af)](_0xf0c017[_0x18089a(0x2a9)],_0xf0c017[_0x18089a(0x151)],{'success':!![],'message':'OK:\x20'+_0x57b586[_0x18089a(0x198)][_0x18089a(0x1dd)]()},_0xf0c017[_0x18089a(0x1b6)]);}catch(_0x243704){this[_0x18089a(0x1af)](_0xf0c017[_0x18089a(0x2a9)],_0xf0c017[_0x18089a(0x151)],{'success':![],'message':_0x18089a(0x1f0)+_0x243704['message']},_0xf0c017[_0x18089a(0x1b6)]);}}else{if(_0xf0c017[_0x18089a(0x151)]===_0x18089a(0x292)){const _0x1fb6b2=await getWeatherContext(this),_0x25b888=await getCalendarContext(this);this[_0x18089a(0x1af)](_0xf0c017['from'],_0xf0c017['command'],{'success':!![],'weather':_0x1fb6b2,'calendar':_0x25b888},_0xf0c017[_0x18089a(0x1b6)]);}else{if(_0xf0c017[_0x18089a(0x151)]==='getLtmData'){if(!this[_0x18089a(0x203)])return this[_0x18089a(0x1af)](_0xf0c017[_0x18089a(0x2a9)],_0xf0c017['command'],{'success':![],'isPro':![]},_0xf0c017[_0x18089a(0x1b6)]);let _0x14ec94={'status':'N/A'};try{const _0x4f4d78=await this[_0x18089a(0x28d)](LTM_DP_DRIFT_STATUS);_0x14ec94['status']=_0x4f4d78?_0x4f4d78[_0x18089a(0x2c2)]:'N/A';}catch(_0x3a1745){}this[_0x18089a(0x1af)](_0xf0c017[_0x18089a(0x2a9)],_0xf0c017[_0x18089a(0x151)],{'success':!![],'isPro':!![],'dailyDigests':this[_0x18089a(0x296)],'driftAnalysis':_0x14ec94,'analysisHistory':this[_0x18089a(0x276)]},_0xf0c017[_0x18089a(0x1b6)]);}else{if(_0xf0c017['command']==='getOverviewData'){const _0x56f819=this[_0x18089a(0x296)]['length'],_0x3d2384=new Date(),_0x5583c3=new Date(_0x3d2384['getFullYear'](),_0x3d2384['getMonth'](),_0x3d2384['getDate']())[_0x18089a(0x2f8)](),_0x58d95d=this[_0x18089a(0x262)][_0x18089a(0x2cf)](_0x1b52e2=>new Date(_0x1b52e2[_0x18089a(0x291)])['getTime']()>_0x5583c3)[_0x18089a(0x232)],_0x370a2e=new Array(0x18)['fill'](0x0);this['rawEventLog']['forEach'](_0x2b8628=>{const _0x242d90=_0x18089a,_0x2806e6=new Date(_0x2b8628[_0x242d90(0x291)]);if(_0x2806e6[_0x242d90(0x2f8)]()>_0x5583c3)_0x370a2e[_0x2806e6[_0x242d90(0x1e1)]()]++;});let _0x4bea9c={'status':_0x18089a(0x1ba)};try{const _0x272af9=await this[_0x18089a(0x28d)](LTM_DP_DRIFT_STATUS);_0x4bea9c[_0x18089a(0x185)]=_0x272af9?_0x272af9[_0x18089a(0x2c2)]:'N/A';}catch(_0x31f5e2){}let _0x2b6de4='';try{const _0x168ca2=await this['getStateAsync'](_0x18089a(0x215));_0x2b6de4=_0x168ca2?_0x168ca2[_0x18089a(0x2c2)]:'';}catch(_0x47af0d){}let _0x2cb80f=null;!this[_0x18089a(0x23d)]&&(_0x2cb80f=this[_0x18089a(0x237)][_0x18089a(0x1cb)]?_0x18089a(0x295):'Kein\x20API\x20Key!');let _0x230c4e={'detected':![],'description':'','targetId':'','targetValue':'','autoApply':![]};try{const _0x25a5fa=await this[_0x18089a(0x28d)](_0x18089a(0x266));if(_0x25a5fa&&_0x25a5fa['val']){_0x230c4e[_0x18089a(0x187)]=!![];const _0x148368=await this[_0x18089a(0x28d)](_0x18089a(0x1a6));_0x230c4e[_0x18089a(0x28a)]=_0x148368?_0x148368[_0x18089a(0x2c2)]:'';const _0x270fe8=await this[_0x18089a(0x28d)](_0x18089a(0x2c8));_0x230c4e[_0x18089a(0x250)]=_0x270fe8?_0x270fe8[_0x18089a(0x2c2)]:'';const _0x429fff=await this['getStateAsync']('analysis.automation.targetValue');_0x230c4e[_0x18089a(0x2d6)]=_0x429fff?_0x429fff[_0x18089a(0x2c2)]:'';}const _0x52f442=await this[_0x18089a(0x28d)](_0x18089a(0x1d0));_0x230c4e['autoApply']=_0x52f442?!!_0x52f442[_0x18089a(0x2c2)]:![];}catch(_0x4ae383){}this[_0x18089a(0x1af)](_0xf0c017[_0x18089a(0x2a9)],_0xf0c017[_0x18089a(0x151)],{'success':!![],'eventHistory':this[_0x18089a(0x2b5)][_0x18089a(0x223)](0x0,0xf),'stats':{'digestCount':_0x56f819,'eventCountToday':_0x58d95d,'hourlyActivity':_0x370a2e,'driftStatus':_0x4bea9c['status'],'isPresent':this[_0x18089a(0x298)],'presenceWho':_0x2b6de4,'minDays':this[_0x18089a(0x237)][_0x18089a(0x1c8)]||0x7,'stbDays':this[_0x18089a(0x237)][_0x18089a(0x2aa)]||0xe,'ltbDays':this[_0x18089a(0x237)]['ltmLtbWindowDays']||0x3c,'systemError':_0x2cb80f},'automation':_0x230c4e},_0xf0c017['callback']);}else{if(_0xf0c017['command']===_0x18089a(0x214))try{const _0x5c700e=await scanForDevices(this,_0xf0c017[_0x18089a(0x199)]||{});this[_0x18089a(0x1af)](_0xf0c017[_0x18089a(0x2a9)],_0xf0c017[_0x18089a(0x151)],{'success':!![],'devices':_0x5c700e},_0xf0c017[_0x18089a(0x1b6)]);}catch(_0x27a5b1){this[_0x18089a(0x1af)](_0xf0c017[_0x18089a(0x2a9)],_0xf0c017[_0x18089a(0x151)],{'success':![],'error':_0x27a5b1['message']},_0xf0c017[_0x18089a(0x1b6)]);}else{if(_0xf0c017['command']===_0x18089a(0x288)){const _0x376bf2=await this[_0x18089a(0x181)](_0x18089a(0x21d),_0x18089a(0x221)),_0x554980=[];if(_0x376bf2)for(const _0x4c4dd8 in _0x376bf2){const _0xa148e5=_0x376bf2[_0x4c4dd8],_0x1e3670=(_0xa148e5[_0x18089a(0x2b7)]&&typeof _0xa148e5[_0x18089a(0x2b7)][_0x18089a(0x189)]===_0x18089a(0x1e9)?_0xa148e5[_0x18089a(0x2b7)][_0x18089a(0x189)]['de']:_0xa148e5[_0x18089a(0x2b7)][_0x18089a(0x189)])||_0xa148e5[_0x18089a(0x2b7)][_0x18089a(0x189)];_0x554980['push']({'id':_0x4c4dd8,'name':_0x1e3670});}this[_0x18089a(0x1af)](_0xf0c017[_0x18089a(0x2a9)],_0xf0c017[_0x18089a(0x151)],{'success':!![],'enums':_0x554980},_0xf0c017[_0x18089a(0x1b6)]);}else{if(_0xf0c017[_0x18089a(0x151)]===_0x18089a(0x249)){const _0xdb5b9c=_0xf0c017[_0x18089a(0x199)]['instance'];if(!_0xdb5b9c)return this[_0x18089a(0x1af)](_0xf0c017[_0x18089a(0x2a9)],_0xf0c017[_0x18089a(0x151)],{'success':![],'error':'No\x20instance'},_0xf0c017[_0x18089a(0x1b6)]);const _0x169e01=await getCalendarNames(this,_0xdb5b9c);this[_0x18089a(0x1af)](_0xf0c017['from'],_0xf0c017[_0x18089a(0x151)],{'success':!![],'names':_0x169e01},_0xf0c017[_0x18089a(0x1b6)]);}else{if(_0xf0c017[_0x18089a(0x151)]===_0x18089a(0x16f)){const {targetId:_0x2429db,targetValue:_0x695cd9}=_0xf0c017[_0x18089a(0x199)];this['log']['info']('ðŸ§ª\x20Simulating\x20Butler\x20Proposal:\x20'+_0x2429db+_0x18089a(0x2ac)+_0x695cd9),await this[_0x18089a(0x251)](_0x18089a(0x266),{'val':!![],'ack':!![]}),await this[_0x18089a(0x251)](_0x18089a(0x1a6),{'val':_0x18089a(0x233)+_0x2429db,'ack':!![]}),await this[_0x18089a(0x251)](_0x18089a(0x2c8),{'val':_0x2429db,'ack':!![]}),await this['setStateAsync'](_0x18089a(0x26e),{'val':_0x695cd9,'ack':!![]}),this[_0x18089a(0x1af)](_0xf0c017[_0x18089a(0x2a9)],_0xf0c017['command'],{'success':!![]},_0xf0c017['callback']);}else{if(_0xf0c017[_0x18089a(0x151)]===_0x18089a(0x2e0)){const {historyId:_0x22f497,rating:_0x3733c7,comment:_0x41842e,alertReason:_0x55b669}=_0xf0c017[_0x18089a(0x199)];_0x22f497&&_0x3733c7?(await saveFeedback(this,{'timestamp':Date[_0x18089a(0x231)](),'historyId':_0x22f497,'rating':_0x3733c7,'comment':_0x41842e,'alertReason':_0x55b669}),this[_0x18089a(0x1af)](_0xf0c017['from'],_0xf0c017[_0x18089a(0x151)],{'success':!![]},_0xf0c017['callback'])):this[_0x18089a(0x1af)](_0xf0c017[_0x18089a(0x2a9)],_0xf0c017['command'],{'success':![],'error':_0x18089a(0x1b8)},_0xf0c017[_0x18089a(0x1b6)]);}else _0xf0c017[_0x18089a(0x151)]===_0x18089a(0x244)&&(this[_0x18089a(0x272)][_0x18089a(0x195)](_0x18089a(0x179)),await this[_0x18089a(0x251)](_0x18089a(0x266),{'val':![],'ack':!![]}),await this['setStateAsync'](_0x18089a(0x1a6),{'val':'','ack':!![]}),this[_0x18089a(0x1af)](_0xf0c017['from'],_0xf0c017[_0x18089a(0x151)],{'success':!![]},_0xf0c017[_0x18089a(0x1b6)]));}}}}}}}}}}}if(require[a0_0x49390c(0x1e0)]!==module)module[a0_0x49390c(0x1d1)]=_0x5a28a0=>new CogniLiving(_0x5a28a0);else new CogniLiving();