const a0_0x4ee979=a0_0x3450;(function(_0x2cf710,_0x366bcf){const _0x29506a=a0_0x3450,_0x247124=_0x2cf710();while(!![]){try{const _0x2a9213=-parseInt(_0x29506a(0x1da))/0x1*(-parseInt(_0x29506a(0x180))/0x2)+-parseInt(_0x29506a(0x204))/0x3+-parseInt(_0x29506a(0x301))/0x4+-parseInt(_0x29506a(0x2f6))/0x5*(parseInt(_0x29506a(0x310))/0x6)+parseInt(_0x29506a(0x24a))/0x7+-parseInt(_0x29506a(0x1d6))/0x8+-parseInt(_0x29506a(0x278))/0x9*(-parseInt(_0x29506a(0x194))/0xa);if(_0x2a9213===_0x366bcf)break;else _0x247124['push'](_0x247124['shift']());}catch(_0x327a8f){_0x247124['push'](_0x247124['shift']());}}}(a0_0x3a49,0xeef4e));const a0_0x3284b4=(function(){let _0xe602f7=!![];return function(_0x23d8ed,_0x39c4b5){const _0x5cb567=_0xe602f7?function(){if(_0x39c4b5){const _0x962605=_0x39c4b5['apply'](_0x23d8ed,arguments);return _0x39c4b5=null,_0x962605;}}:function(){};return _0xe602f7=![],_0x5cb567;};}()),a0_0x3ec6e0=a0_0x3284b4(this,function(){const _0x40d9ef=a0_0x3450;return a0_0x3ec6e0[_0x40d9ef(0x1a9)]()['search'](_0x40d9ef(0x147))[_0x40d9ef(0x1a9)]()[_0x40d9ef(0x2b2)](a0_0x3ec6e0)['search']('(((.+)+)+)+$');});a0_0x3ec6e0();'use strict';const utils=require(a0_0x4ee979(0x1fd)),{GoogleGenerativeAI}=require('@google/generative-ai'),schedule=require('node-schedule'),{spawn,exec}=require(a0_0x4ee979(0x165)),path=require(a0_0x4ee979(0x1a1)),HISTORY_MAX_SIZE=0x32,RAW_LOG_MAX_SIZE=0x5dc,LTM_MIN_EVENTS_FOR_COMPRESSION=0x5,GEMINI_MODEL=a0_0x4ee979(0x314),LTM_SCHEDULE=a0_0x4ee979(0x1cc),MODE_RESET_SCHEDULE=a0_0x4ee979(0x300),ANALYSIS_HISTORY_MAX_SIZE=0x64,EXIT_TIMER_MINUTES=0xf,EXIT_GRACE_PERIOD_SECONDS=0x1e,SEQUENCE_TIMEOUT_MS=0x5*0x3c*0x3e8,MAX_TRAINING_SET_SIZE=0x1f4,THERMO_LOG_SIZE=0x3e8,LTM_DP_RAW_LOG=a0_0x4ee979(0x29f),LTM_DP_DAILY_DIGESTS='LTM.dailyDigests',LTM_DP_STATUS='LTM.processingStatus',LTM_DP_TRIGGER_DIGEST=a0_0x4ee979(0x1cd),LTM_DP_BASELINE_STATUS='LTM.baselineStatus',LTM_DP_DRIFT_CHANNEL=a0_0x4ee979(0x11f),LTM_DP_DRIFT_STATUS='LTM.driftAnalysis.baselineDrift',LTM_DP_DRIFT_DETAILS=a0_0x4ee979(0x144),LTM_DP_DRIFT_LAST_CHECK=a0_0x4ee979(0x270),SYSTEM_DP_MODE='system.mode',HARD_IGNORE_TERMS=[a0_0x4ee979(0x2b4),a0_0x4ee979(0x131),a0_0x4ee979(0x2eb),a0_0x4ee979(0x1b6),a0_0x4ee979(0x154),a0_0x4ee979(0x269),a0_0x4ee979(0x1eb),'maintenance',a0_0x4ee979(0x2f2),'fault','working','direction','stick_unreach',a0_0x4ee979(0x30d),a0_0x4ee979(0x127),a0_0x4ee979(0x1d3),a0_0x4ee979(0x259),a0_0x4ee979(0x16a)],BAD_NAMES=[a0_0x4ee979(0x1f2),'currentposition',a0_0x4ee979(0x1af),a0_0x4ee979(0x1ee),a0_0x4ee979(0x2a5),a0_0x4ee979(0x250),'on',a0_0x4ee979(0x21a),a0_0x4ee979(0x1bd),'position',a0_0x4ee979(0x1fb),a0_0x4ee979(0x2bc),'cover',a0_0x4ee979(0x1c3),'motion',a0_0x4ee979(0x1ce),a0_0x4ee979(0x1e5),a0_0x4ee979(0x11c),a0_0x4ee979(0x19d),'power',a0_0x4ee979(0x133),a0_0x4ee979(0x11e),'valve',a0_0x4ee979(0x24f),a0_0x4ee979(0x120)],ADAPTER_BLACKLIST=[a0_0x4ee979(0x142),'admin.',a0_0x4ee979(0x2c9),a0_0x4ee979(0x14c),'history.','material.',a0_0x4ee979(0x10b),'flot.',a0_0x4ee979(0x22e),a0_0x4ee979(0x23e),a0_0x4ee979(0x2fd)],SYSTEM_MODES={'NORMAL':'normal','VACATION':a0_0x4ee979(0x1ec),'PARTY':a0_0x4ee979(0x15d),'GUEST':a0_0x4ee979(0x2e0)},AUTO_RESET_MODES=[SYSTEM_MODES[a0_0x4ee979(0x17f)],SYSTEM_MODES[a0_0x4ee979(0x1e4)]],PERSONA_MAPPING={'generic':'Analysiere\x20ausgewogen.','senior_aal':a0_0x4ee979(0x28b),'family':'Fokus\x20auf\x20Familienroutinen.','single_comfort':a0_0x4ee979(0x12b),'security':a0_0x4ee979(0x1e9)},ACTIVITY_LEVEL_MAP={'sehr\x20hoch':0x64,'hoch':0x50,'normal':0x3c,'niedrig':0x28,'sehr\x20niedrig':0x14,'inaktiv':0x0};let activeSequence=[],sequenceTimer=null;async function initZombies(_0x434f4a){const _0x3f5401=a0_0x4ee979;try{const _0x15ffa6=[_0x3f5401(0x2e4),_0x3f5401(0x297)];for(const _0x2a05d6 of _0x15ffa6){try{const _0x435a7b=await _0x434f4a['getObjectAsync'](_0x2a05d6);_0x435a7b&&await _0x434f4a[_0x3f5401(0x11b)](_0x2a05d6);}catch(_0x45e917){}}}catch(_0x2a2452){}}async function initHistory(_0x173249){const _0x2f51cb=a0_0x4ee979;try{const _0x434fd8=await _0x173249['getStateAsync']('events.history');_0x434fd8&&_0x434fd8[_0x2f51cb(0x2e6)]&&(_0x173249['eventHistory']=JSON[_0x2f51cb(0x113)](_0x434fd8['val'][_0x2f51cb(0x1a9)]()));}catch(_0x4b3277){_0x173249[_0x2f51cb(0x10f)]=[];}try{const _0x104959=await _0x173249[_0x2f51cb(0x231)](_0x2f51cb(0x2f4));if(_0x104959&&_0x104959[_0x2f51cb(0x2e6)])_0x173249['analysisHistory']=JSON[_0x2f51cb(0x113)](_0x104959[_0x2f51cb(0x2e6)][_0x2f51cb(0x1a9)]());}catch(_0x363860){_0x173249['analysisHistory']=[];}if(_0x173249[_0x2f51cb(0x10f)]&&_0x173249[_0x2f51cb(0x10f)][_0x2f51cb(0x1ba)]>0x0){_0x173249['log']['info']('Restoring\x20sensor\x20cache\x20from\x20history\x20('+_0x173249[_0x2f51cb(0x10f)][_0x2f51cb(0x1ba)]+_0x2f51cb(0x128));for(let _0x30fc36=_0x173249[_0x2f51cb(0x10f)][_0x2f51cb(0x1ba)]-0x1;_0x30fc36>=0x0;_0x30fc36--){const _0x5e9591=_0x173249[_0x2f51cb(0x10f)][_0x30fc36];_0x5e9591&&_0x5e9591['id']!==undefined&&_0x5e9591[_0x2f51cb(0x2a5)]!==undefined&&(_0x173249[_0x2f51cb(0x2aa)][_0x5e9591['id']]=_0x5e9591[_0x2f51cb(0x2a5)]);}}}async function initSystemConfig(_0x51b6d2){const _0x4d9de9=a0_0x4ee979;try{const _0x4af55c=await _0x51b6d2[_0x4d9de9(0x173)](_0x4d9de9(0x20a));_0x4af55c&&_0x4af55c[_0x4d9de9(0x2fe)]&&(_0x51b6d2['systemConfig']={'latitude':_0x4af55c[_0x4d9de9(0x2fe)]['latitude']||0x0,'longitude':_0x4af55c['common']['longitude']||0x0,'city':_0x4af55c[_0x4d9de9(0x2fe)][_0x4d9de9(0x26c)]||''});}catch(_0x53ff39){}}async function checkLicense(_0x3d92e1,_0xbc301e){const _0x42454f=a0_0x4ee979;if(!_0xbc301e)return![];_0x3d92e1[_0x42454f(0x268)]=await getSystemUUID(_0x3d92e1);if(_0xbc301e==='TEST-PRO-KEY'||_0xbc301e[_0x42454f(0x2db)](_0x42454f(0x1d1)))return!![];return![];}async function getSystemUUID(_0x463cd4){const _0x16b9c5=a0_0x4ee979;try{const _0x473ec2=await _0x463cd4[_0x16b9c5(0x173)]('system.meta.uuid');if(_0x473ec2&&_0x473ec2[_0x16b9c5(0x177)]&&_0x473ec2[_0x16b9c5(0x177)][_0x16b9c5(0x291)])return _0x473ec2['native']['uuid'];return _0x16b9c5(0x2e5);}catch(_0x2cfe51){return _0x16b9c5(0x12f);}}async function createAllObjects(_0x279c89){const _0xcd4f5e=a0_0x4ee979;await checkSystemObjects(_0x279c89),await _0x279c89[_0xcd4f5e(0x255)](_0xcd4f5e(0x1c5),{'type':_0xcd4f5e(0x1af),'common':{'name':'Who\x20is\x20present?','type':'string','role':_0xcd4f5e(0x1d2),'read':!![],'write':![],'def':''},'native':{}}),await _0x279c89['setObjectNotExistsAsync'](_0xcd4f5e(0x29e),{'type':_0xcd4f5e(0x1af),'common':{'name':'Last\x20raw\x20event','type':_0xcd4f5e(0x172),'role':'json','read':!![],'write':![]},'native':{}}),await _0x279c89[_0xcd4f5e(0x255)](_0xcd4f5e(0x2c1),{'type':_0xcd4f5e(0x1af),'common':{'name':_0xcd4f5e(0x216),'type':_0xcd4f5e(0x172),'role':_0xcd4f5e(0x15b),'read':!![],'write':![]},'native':{}}),await _0x279c89['setObjectNotExistsAsync'](_0xcd4f5e(0x2d6),{'type':_0xcd4f5e(0x1af),'common':{'name':_0xcd4f5e(0x1ed),'type':'boolean','role':_0xcd4f5e(0x1d5),'read':!![],'write':!![],'def':![]},'native':{}}),await _0x279c89[_0xcd4f5e(0x255)](_0xcd4f5e(0x18e),{'type':_0xcd4f5e(0x1af),'common':{'name':_0xcd4f5e(0x240),'type':_0xcd4f5e(0x140),'role':_0xcd4f5e(0x1d5),'read':!![],'write':!![],'def':![]},'native':{}}),await _0x279c89[_0xcd4f5e(0x21b)](_0xcd4f5e(0x1e3),{'type':_0xcd4f5e(0x199),'common':{'name':_0xcd4f5e(0x2bf)},'native':{}}),await _0x279c89[_0xcd4f5e(0x255)]('analysis.training.triggerSecurity',{'type':'state','common':{'name':'Train\x20Security\x20Model\x20(LSTM)','type':_0xcd4f5e(0x140),'role':_0xcd4f5e(0x1d5),'read':!![],'write':!![],'def':![]},'native':{}}),await _0x279c89[_0xcd4f5e(0x255)](_0xcd4f5e(0x184),{'type':_0xcd4f5e(0x1af),'common':{'name':'Train\x20Health\x20Model\x20(IsoForest)','type':_0xcd4f5e(0x140),'role':_0xcd4f5e(0x1d5),'read':!![],'write':!![],'def':![]},'native':{}}),await _0x279c89[_0xcd4f5e(0x255)](_0xcd4f5e(0x25c),{'type':'state','common':{'name':'Train\x20Energy\x20Model\x20(Regression)','type':_0xcd4f5e(0x140),'role':_0xcd4f5e(0x1d5),'read':!![],'write':!![],'def':![]},'native':{}}),await _0x279c89[_0xcd4f5e(0x255)](_0xcd4f5e(0x24c),{'type':_0xcd4f5e(0x1af),'common':{'name':_0xcd4f5e(0x1b1),'type':_0xcd4f5e(0x172),'role':_0xcd4f5e(0x1d2),'read':!![],'write':![],'def':_0xcd4f5e(0x1ff)},'native':{}}),await _0x279c89['extendObjectAsync'](_0xcd4f5e(0x1c6),{'type':_0xcd4f5e(0x199),'common':{'name':_0xcd4f5e(0x2da)},'native':{}}),await _0x279c89[_0xcd4f5e(0x255)]('analysis.security.lastScore',{'type':'state','common':{'name':'Last\x20Anomaly\x20Score','type':_0xcd4f5e(0x2ed),'role':_0xcd4f5e(0x2a5),'read':!![],'write':![],'def':0x0},'native':{}}),await _0x279c89['setObjectNotExistsAsync']('analysis.security.lastCheck',{'type':'state','common':{'name':_0xcd4f5e(0x1e0),'type':_0xcd4f5e(0x172),'role':'date','read':!![],'write':![],'def':''},'native':{}}),await _0x279c89[_0xcd4f5e(0x255)]('analysis.health.lastCheck',{'type':_0xcd4f5e(0x1af),'common':{'name':_0xcd4f5e(0x252),'type':_0xcd4f5e(0x172),'role':'date','read':!![],'write':![],'def':''},'native':{}}),await _0x279c89['setObjectNotExistsAsync']('analysis.health.isAnomaly',{'type':'state','common':{'name':'Health\x20Anomaly\x20Detected','type':_0xcd4f5e(0x140),'role':_0xcd4f5e(0x1bf),'read':!![],'write':![],'def':![]},'native':{}}),await _0x279c89[_0xcd4f5e(0x21b)](_0xcd4f5e(0x31c),{'type':_0xcd4f5e(0x199),'common':{'name':_0xcd4f5e(0x166)},'native':{}}),await _0x279c89['setObjectNotExistsAsync'](_0xcd4f5e(0x233),{'type':_0xcd4f5e(0x1af),'common':{'name':_0xcd4f5e(0x220),'type':'string','role':'text','read':!![],'write':![],'def':_0xcd4f5e(0x241)},'native':{}}),await _0x279c89[_0xcd4f5e(0x255)]('analysis.lastResult',{'type':_0xcd4f5e(0x1af),'common':{'name':_0xcd4f5e(0x2f3),'type':_0xcd4f5e(0x172),'role':_0xcd4f5e(0x15b),'read':!![],'write':![]},'native':{}}),await _0x279c89[_0xcd4f5e(0x255)](_0xcd4f5e(0x169),{'type':_0xcd4f5e(0x1af),'common':{'name':_0xcd4f5e(0x207),'type':'boolean','role':_0xcd4f5e(0x236),'read':!![],'write':![],'def':![]},'native':{}}),await _0x279c89[_0xcd4f5e(0x255)]('analysis.isEmergency',{'type':_0xcd4f5e(0x1af),'common':{'name':_0xcd4f5e(0x1ac),'type':_0xcd4f5e(0x140),'role':_0xcd4f5e(0x262),'read':!![],'write':![],'def':![]},'native':{}}),await _0x279c89[_0xcd4f5e(0x255)](_0xcd4f5e(0x110),{'type':_0xcd4f5e(0x1af),'common':{'name':_0xcd4f5e(0x31f),'type':_0xcd4f5e(0x172),'role':_0xcd4f5e(0x193),'read':!![],'write':![]},'native':{}}),await _0x279c89[_0xcd4f5e(0x255)](_0xcd4f5e(0x16e),{'type':'state','common':{'name':_0xcd4f5e(0x221),'type':_0xcd4f5e(0x172),'role':_0xcd4f5e(0x1d2),'read':!![],'write':![]},'native':{}}),await _0x279c89[_0xcd4f5e(0x255)](_0xcd4f5e(0x2d9),{'type':_0xcd4f5e(0x1af),'common':{'name':_0xcd4f5e(0x18c),'type':_0xcd4f5e(0x172),'role':_0xcd4f5e(0x1af),'read':!![],'write':![],'def':_0xcd4f5e(0x241)},'native':{}}),await _0x279c89['setObjectNotExistsAsync']('analysis.comfortSummary',{'type':_0xcd4f5e(0x1af),'common':{'name':_0xcd4f5e(0x170),'type':_0xcd4f5e(0x172),'role':_0xcd4f5e(0x1d2),'read':!![],'write':![]},'native':{}}),await _0x279c89[_0xcd4f5e(0x255)](_0xcd4f5e(0x1b5),{'type':_0xcd4f5e(0x1af),'common':{'name':'Comfort\x20Suggestion','type':_0xcd4f5e(0x172),'role':_0xcd4f5e(0x1d2),'read':!![],'write':![]},'native':{}}),await _0x279c89['extendObjectAsync'](_0xcd4f5e(0x2fa),{'type':'channel','common':{'name':_0xcd4f5e(0x1e6)},'native':{}}),await _0x279c89['setObjectNotExistsAsync']('analysis.automation.patternDetected',{'type':_0xcd4f5e(0x1af),'common':{'name':_0xcd4f5e(0x187),'type':_0xcd4f5e(0x140),'role':'indicator','read':!![],'write':![],'def':![]},'native':{}}),await _0x279c89['setObjectNotExistsAsync'](_0xcd4f5e(0x30f),{'type':_0xcd4f5e(0x1af),'common':{'name':'Description','type':'string','role':'text','read':!![],'write':![]},'native':{}}),await _0x279c89[_0xcd4f5e(0x255)](_0xcd4f5e(0x219),{'type':_0xcd4f5e(0x1af),'common':{'name':_0xcd4f5e(0x112),'type':_0xcd4f5e(0x172),'role':_0xcd4f5e(0x1d2),'read':!![],'write':![]},'native':{}}),await _0x279c89[_0xcd4f5e(0x255)](_0xcd4f5e(0x288),{'type':'state','common':{'name':_0xcd4f5e(0x2c6),'type':'string','role':'text','read':!![],'write':![]},'native':{}}),await _0x279c89[_0xcd4f5e(0x255)](_0xcd4f5e(0x242),{'type':_0xcd4f5e(0x1af),'common':{'name':_0xcd4f5e(0x218),'type':_0xcd4f5e(0x172),'role':_0xcd4f5e(0x1d2),'read':!![],'write':![]},'native':{}}),await _0x279c89[_0xcd4f5e(0x255)](_0xcd4f5e(0x160),{'type':_0xcd4f5e(0x1af),'common':{'name':'Auto\x20Apply\x20Rule','type':_0xcd4f5e(0x140),'role':_0xcd4f5e(0x1bd),'read':!![],'write':!![],'def':![]},'native':{}}),await _0x279c89[_0xcd4f5e(0x255)](_0xcd4f5e(0x2f0),{'type':'state','common':{'name':_0xcd4f5e(0x321),'type':_0xcd4f5e(0x140),'role':_0xcd4f5e(0x1d5),'read':!![],'write':!![],'def':![]},'native':{}}),await _0x279c89[_0xcd4f5e(0x255)](_0xcd4f5e(0x2f4),{'type':_0xcd4f5e(0x1af),'common':{'name':_0xcd4f5e(0x2c7),'type':_0xcd4f5e(0x172),'role':_0xcd4f5e(0x15b),'read':!![],'write':![],'def':'[]'},'native':{}}),await _0x279c89[_0xcd4f5e(0x255)]('analysis.feedbackHistory',{'type':'state','common':{'name':_0xcd4f5e(0x308),'type':'string','role':_0xcd4f5e(0x15b),'read':!![],'write':![],'def':'[]'},'native':{}}),await _0x279c89['extendObjectAsync'](_0xcd4f5e(0x25f),{'type':'channel','common':{'name':'Health\x20&\x20Sleep\x20Analysis'},'native':{}}),await _0x279c89[_0xcd4f5e(0x255)](_0xcd4f5e(0x306),{'type':_0xcd4f5e(0x1af),'common':{'name':_0xcd4f5e(0x292),'type':_0xcd4f5e(0x2ed),'role':_0xcd4f5e(0x320),'read':!![],'write':![],'def':0x0},'native':{}}),await _0x279c89[_0xcd4f5e(0x255)](_0xcd4f5e(0x2f5),{'type':'state','common':{'name':_0xcd4f5e(0x2f7),'type':_0xcd4f5e(0x172),'role':_0xcd4f5e(0x1d2),'read':!![],'write':![],'def':_0xcd4f5e(0x1be)},'native':{}}),await _0x279c89['setObjectNotExistsAsync'](_0xcd4f5e(0x2bd),{'type':_0xcd4f5e(0x1af),'common':{'name':_0xcd4f5e(0x2b8),'type':_0xcd4f5e(0x172),'role':_0xcd4f5e(0x1d2),'read':!![],'write':![],'def':''},'native':{}}),await _0x279c89[_0xcd4f5e(0x255)](_0xcd4f5e(0x1b2),{'type':_0xcd4f5e(0x1af),'common':{'name':'Trend\x20Diagnosis\x20(Python)','type':'string','role':_0xcd4f5e(0x1d2),'read':!![],'write':![],'def':_0xcd4f5e(0x241)},'native':{}}),await _0x279c89['setObjectNotExistsAsync']('analysis.health.trendValue',{'type':_0xcd4f5e(0x1af),'common':{'name':_0xcd4f5e(0x125),'type':_0xcd4f5e(0x2ed),'role':_0xcd4f5e(0x2a5),'read':!![],'write':![],'def':0x0},'native':{}}),await _0x279c89[_0xcd4f5e(0x21b)](_0xcd4f5e(0x162),{'type':_0xcd4f5e(0x199),'common':{'name':_0xcd4f5e(0x1f3)},'native':{}}),await _0x279c89[_0xcd4f5e(0x255)](_0xcd4f5e(0x227),{'type':_0xcd4f5e(0x1af),'common':{'name':_0xcd4f5e(0x13d),'type':'string','role':_0xcd4f5e(0x15b),'read':!![],'write':![],'def':'[]','desc':'Array\x20of\x20completed\x20movement\x20paths\x20for\x20ML\x20training'},'native':{}}),await _0x279c89['setObjectNotExistsAsync']('LTM.trainingData.thermodynamics',{'type':_0xcd4f5e(0x1af),'common':{'name':'Thermodynamic\x20Data\x20Points','type':_0xcd4f5e(0x172),'role':_0xcd4f5e(0x15b),'read':!![],'write':![],'def':'[]','desc':_0xcd4f5e(0x322)},'native':{}}),await checkLtmObjects(_0x279c89),await checkLtmDriftObjects(_0x279c89);}async function checkSystemObjects(_0x2b6408){const _0x19644b=a0_0x4ee979;await _0x2b6408[_0x19644b(0x21b)](_0x19644b(0x208),{'type':_0x19644b(0x199),'common':{'name':_0x19644b(0x1bb)},'native':{}}),await _0x2b6408[_0x19644b(0x21b)](SYSTEM_DP_MODE,{'type':'state','common':{'name':_0x19644b(0x13c),'type':_0x19644b(0x172),'role':_0x19644b(0x1af),'read':!![],'write':!![],'def':SYSTEM_MODES['NORMAL'],'states':{[SYSTEM_MODES[_0x19644b(0x1b0)]]:_0x19644b(0x190),[SYSTEM_MODES[_0x19644b(0x149)]]:_0x19644b(0x25b),[SYSTEM_MODES[_0x19644b(0x17f)]]:_0x19644b(0x14d),[SYSTEM_MODES[_0x19644b(0x1e4)]]:_0x19644b(0x124)}},'native':{}});}async function checkLtmObjects(_0x415cce){const _0x1f0398=a0_0x4ee979;await _0x415cce['extendObjectAsync'](_0x1f0398(0x239),{'type':_0x1f0398(0x199),'common':{'name':_0x1f0398(0x239)},'native':{}}),await _0x415cce[_0x1f0398(0x21b)](LTM_DP_RAW_LOG,{'type':_0x1f0398(0x1af),'common':{'name':_0x1f0398(0x1fc),'type':_0x1f0398(0x172),'role':_0x1f0398(0x15b),'read':!![],'write':![]},'native':{}}),await _0x415cce['extendObjectAsync'](LTM_DP_DAILY_DIGESTS,{'type':_0x1f0398(0x1af),'common':{'name':_0x1f0398(0x287),'type':_0x1f0398(0x172),'role':_0x1f0398(0x15b),'read':!![],'write':![]},'native':{}}),await _0x415cce[_0x1f0398(0x21b)](LTM_DP_STATUS,{'type':_0x1f0398(0x1af),'common':{'name':'Processing\x20Status','type':_0x1f0398(0x172),'role':_0x1f0398(0x1d2),'read':!![],'write':![]},'native':{}}),await _0x415cce[_0x1f0398(0x21b)](LTM_DP_TRIGGER_DIGEST,{'type':_0x1f0398(0x1af),'common':{'name':'Trigger\x20Digest','type':_0x1f0398(0x140),'role':_0x1f0398(0x1d5),'read':!![],'write':!![],'def':![]},'native':{}}),await _0x415cce[_0x1f0398(0x21b)](LTM_DP_BASELINE_STATUS,{'type':'state','common':{'name':_0x1f0398(0x261),'type':'string','role':'text','read':!![],'write':![]},'native':{}});}async function checkLtmDriftObjects(_0x582f34){const _0x3f18f3=a0_0x4ee979;await _0x582f34['extendObjectAsync'](LTM_DP_DRIFT_CHANNEL,{'type':_0x3f18f3(0x199),'common':{'name':_0x3f18f3(0x29b)},'native':{}}),await _0x582f34[_0x3f18f3(0x21b)](LTM_DP_DRIFT_STATUS,{'type':_0x3f18f3(0x1af),'common':{'name':'Drift\x20Status','type':'string','role':_0x3f18f3(0x1af),'read':!![],'write':![],'def':_0x3f18f3(0x241)},'native':{}}),await _0x582f34[_0x3f18f3(0x21b)](LTM_DP_DRIFT_DETAILS,{'type':_0x3f18f3(0x1af),'common':{'name':'Drift\x20Details','type':'string','role':_0x3f18f3(0x1d2),'read':!![],'write':![]},'native':{}}),await _0x582f34['extendObjectAsync'](LTM_DP_DRIFT_LAST_CHECK,{'type':'state','common':{'name':_0x3f18f3(0x11a),'type':'number','role':_0x3f18f3(0x1fa),'read':!![],'write':![]},'native':{}});}async function loadSystemMode(_0x4859fa){const _0x53d237=a0_0x4ee979;try{const _0xc32812=await _0x4859fa[_0x53d237(0x231)](SYSTEM_DP_MODE);_0xc32812&&_0xc32812[_0x53d237(0x2e6)]&&Object[_0x53d237(0x1ef)](SYSTEM_MODES)[_0x53d237(0x228)](_0xc32812[_0x53d237(0x2e6)])?_0x4859fa[_0x53d237(0x1d4)]=_0xc32812[_0x53d237(0x2e6)]:(_0x4859fa[_0x53d237(0x1d4)]=SYSTEM_MODES[_0x53d237(0x1b0)],await _0x4859fa[_0x53d237(0x2bb)](SYSTEM_DP_MODE,{'val':SYSTEM_MODES[_0x53d237(0x1b0)],'ack':!![]}));}catch(_0x35c59a){_0x4859fa['currentSystemMode']=SYSTEM_MODES[_0x53d237(0x1b0)];}}async function loadRawEventLog(_0x21574c){const _0x1bcd9a=a0_0x4ee979;try{const _0x4d597a=await _0x21574c[_0x1bcd9a(0x231)](LTM_DP_RAW_LOG);if(_0x4d597a&&_0x4d597a['val'])_0x21574c['rawEventLog']=JSON[_0x1bcd9a(0x113)](_0x4d597a[_0x1bcd9a(0x2e6)]);}catch(_0x26ebd4){_0x21574c[_0x1bcd9a(0x19c)]=[];}}async function saveRawEventLog(_0x5cdff4){const _0x57a309=a0_0x4ee979;_0x5cdff4[_0x57a309(0x19c)]['length']>RAW_LOG_MAX_SIZE&&_0x5cdff4['rawEventLog'][_0x57a309(0x217)](0x0,_0x5cdff4[_0x57a309(0x19c)][_0x57a309(0x1ba)]-RAW_LOG_MAX_SIZE),await _0x5cdff4['setStateAsync'](LTM_DP_RAW_LOG,{'val':JSON[_0x57a309(0x267)](_0x5cdff4[_0x57a309(0x19c)]),'ack':!![]});}async function loadDailyDigests(_0x4d6d88){const _0x2ef47f=a0_0x4ee979;try{const _0x255415=await _0x4d6d88[_0x2ef47f(0x231)](LTM_DP_DAILY_DIGESTS);if(_0x255415&&_0x255415[_0x2ef47f(0x2e6)])_0x4d6d88[_0x2ef47f(0x319)]=JSON[_0x2ef47f(0x113)](_0x255415[_0x2ef47f(0x2e6)]);}catch(_0x224e04){_0x4d6d88['dailyDigests']=[];}await updateBaselineStatus(_0x4d6d88);}async function saveDailyDigests(_0x557a87,_0x134ff1=!![]){const _0x4e02d8=a0_0x4ee979,_0x3b7f94=_0x557a87[_0x4e02d8(0x14e)]['ltmLtbWindowDays']||0x3c;_0x557a87['dailyDigests'][_0x4e02d8(0x1ba)]>_0x3b7f94&&_0x557a87['dailyDigests'][_0x4e02d8(0x217)](0x0,_0x557a87['dailyDigests'][_0x4e02d8(0x1ba)]-_0x3b7f94);await _0x557a87[_0x4e02d8(0x2bb)](LTM_DP_DAILY_DIGESTS,{'val':JSON[_0x4e02d8(0x267)](_0x557a87['dailyDigests']),'ack':!![]});if(_0x134ff1)await updateBaselineStatus(_0x557a87);}async function updateAnalysisHistory(_0x4a2f06,_0x16ec7e){const _0x29cb70=a0_0x4ee979;_0x4a2f06[_0x29cb70(0x305)][_0x29cb70(0x12e)](_0x16ec7e);if(_0x4a2f06[_0x29cb70(0x305)][_0x29cb70(0x1ba)]>ANALYSIS_HISTORY_MAX_SIZE)_0x4a2f06[_0x29cb70(0x305)]['pop']();await _0x4a2f06[_0x29cb70(0x2bb)](_0x29cb70(0x2f4),{'val':JSON['stringify'](_0x4a2f06[_0x29cb70(0x305)]),'ack':!![]});}async function updateBaselineStatus(_0x311db4){const _0x536050=a0_0x4ee979;if(!_0x311db4['isProVersion']){await _0x311db4[_0x536050(0x2bb)](LTM_DP_BASELINE_STATUS,{'val':_0x536050(0x276),'ack':!![]});return;}const _0x77e22=_0x311db4[_0x536050(0x319)][_0x536050(0x1ba)]>=(_0x311db4[_0x536050(0x14e)]['minDaysForBaseline']||0x7)?'Aktiv\x20('+_0x311db4[_0x536050(0x319)][_0x536050(0x1ba)]+_0x536050(0x168):_0x536050(0x2d1)+_0x311db4['dailyDigests'][_0x536050(0x1ba)]+'/'+(_0x311db4[_0x536050(0x14e)][_0x536050(0x139)]||0x7)+')';await _0x311db4[_0x536050(0x2bb)](LTM_DP_BASELINE_STATUS,{'val':_0x77e22,'ack':!![]});}async function initSensorSubscriptions(_0x13a869){const _0x5a4209=a0_0x4ee979,_0x108ba0=_0x13a869['config'][_0x5a4209(0x1aa)];if(_0x108ba0&&_0x108ba0['length']>0x0){_0x13a869[_0x5a4209(0x251)]['info'](_0x5a4209(0x1ae)+_0x108ba0[_0x5a4209(0x1ba)]+_0x5a4209(0x264));for(const _0x5c1312 of _0x108ba0){if(_0x5c1312['id']){await _0x13a869[_0x5a4209(0x201)](_0x5c1312['id']);try{const _0x173acc=await _0x13a869[_0x5a4209(0x123)](_0x5c1312['id']);if(_0x173acc)_0x13a869[_0x5a4209(0x2aa)][_0x5c1312['id']]=_0x173acc['val'];}catch(_0x1edf4a){}}}}}async function initPresenceSubscriptions(_0x3f19d5){const _0xe1e214=a0_0x4ee979,_0x625026=_0x3f19d5[_0xe1e214(0x14e)][_0xe1e214(0x2b1)]||[];if(_0x625026[_0xe1e214(0x1ba)]>0x0){_0x3f19d5['log'][_0xe1e214(0x237)](_0xe1e214(0x1ae)+_0x625026[_0xe1e214(0x1ba)]+_0xe1e214(0x313));for(const _0x343e95 of _0x625026){await _0x3f19d5[_0xe1e214(0x201)](_0x343e95);}try{await checkWifiPresence(_0x3f19d5);}catch(_0x4848df){}}}async function getWeatherContext(_0x4a223a){const _0x315060=a0_0x4ee979;try{if(!_0x4a223a[_0x315060(0x14e)][_0x315060(0x235)])return _0x315060(0x2be);let _0x385d08='';const _0x11c481=_0x4a223a[_0x315060(0x14e)][_0x315060(0x1a8)];if(_0x11c481)try{if(_0x11c481[_0x315060(0x228)](_0x315060(0x1ea))){const _0x52ec21=await _0x4a223a[_0x315060(0x123)](_0x11c481+'.Summary.Current');if(_0x52ec21&&_0x52ec21[_0x315060(0x2e6)])_0x385d08=_0x52ec21[_0x315060(0x2e6)];}else{if(_0x11c481[_0x315060(0x228)](_0x315060(0x143))){const _0x19da59=await _0x4a223a[_0x315060(0x123)](_0x11c481+_0x315060(0x1f9));if(_0x19da59&&_0x19da59[_0x315060(0x2e6)])_0x385d08=_0x19da59[_0x315060(0x2e6)];}else{if(_0x11c481[_0x315060(0x228)](_0x315060(0x1e8))){const _0x4b8948=await _0x4a223a[_0x315060(0x123)](_0x11c481+_0x315060(0x312));if(_0x4b8948&&_0x4b8948['val'])_0x385d08=_0x4b8948[_0x315060(0x2e6)];}}}}catch(_0x525076){}if(!_0x385d08){const _0x414e25=[_0x315060(0x159),_0x315060(0x2d4),_0x315060(0x29d),_0x315060(0x134)];for(const _0xb28823 of _0x414e25){try{const _0xab3d2d=await _0x4a223a[_0x315060(0x173)](_0xb28823);if(_0xab3d2d){if(_0xb28823['includes'](_0x315060(0x1ea))){const _0x3294c6=await _0x4a223a['getForeignStateAsync'](_0xb28823+_0x315060(0x2c4));if(_0x3294c6&&_0x3294c6['val']){_0x385d08=_0x3294c6[_0x315060(0x2e6)];break;}}}}catch(_0x3783a9){}}}return _0x385d08?_0x315060(0x1a2)+_0x385d08:_0x315060(0x279);}catch(_0x5be79e){return _0x315060(0x1ab)+_0x5be79e[_0x315060(0x328)];}}async function getCalendarContext(_0x4da6b8){const _0x228b0c=a0_0x4ee979;try{if(!_0x4da6b8[_0x228b0c(0x14e)]['useCalendar'])return'Kalender:\x20Deaktiviert';let _0x496d5d=_0x4da6b8[_0x228b0c(0x14e)][_0x228b0c(0x1e2)]||_0x228b0c(0x284),_0x120100=_0x4da6b8['config'][_0x228b0c(0x243)]||[];if(typeof _0x120100===_0x228b0c(0x172))_0x120100=_0x120100['split'](',');try{const _0x53c865=await _0x4da6b8['getForeignStateAsync'](_0x496d5d+_0x228b0c(0x17c));if(_0x53c865&&_0x53c865['val']){let _0x27d5d3=tryParse(_0x53c865[_0x228b0c(0x2e6)]);if(_0x27d5d3&&Array['isArray'](_0x27d5d3)){if(_0x120100['length']>0x0)_0x27d5d3=_0x27d5d3[_0x228b0c(0x224)](_0x3c93f2=>_0x120100[_0x228b0c(0x228)](_0x3c93f2[_0x228b0c(0x22c)]||''));else return'KALENDER:\x20Keine\x20Kalender\x20ausgewÃ¤hlt\x20(Bitte\x20in\x20Settings\x20konfigurieren)';if(_0x27d5d3[_0x228b0c(0x1ba)]>0x0){const _0xcd172f=_0x27d5d3[_0x228b0c(0x126)](0x0,0x3)[_0x228b0c(0x26e)](_0x29ab53=>{const _0x2d4cab=_0x228b0c;let _0x1fba18=_0x29ab53[_0x2d4cab(0x1fa)];if(_0x29ab53['time'])_0x1fba18+='\x20'+_0x29ab53['time'];return _0x1fba18+':\x20'+_0x29ab53[_0x2d4cab(0x141)]+'\x20('+_0x29ab53[_0x2d4cab(0x22c)]+')';});return'KALENDER:\x20'+_0xcd172f['join'](_0x228b0c(0x31b));}else return _0x228b0c(0x1a7);}}}catch(_0x359ded){_0x4da6b8[_0x228b0c(0x251)][_0x228b0c(0x189)]('Error\x20reading\x20calendar\x20table:\x20'+_0x359ded['message']);}return _0x228b0c(0x2b5);}catch(_0x5ed2f2){return _0x228b0c(0x303)+_0x5ed2f2['message'];}}async function getCalendarNames(_0x5582e1,_0x2e671f){const _0x29f32b=a0_0x4ee979;try{const _0x21d1d0=await _0x5582e1[_0x29f32b(0x123)](_0x2e671f+_0x29f32b(0x17c));if(_0x21d1d0&&_0x21d1d0[_0x29f32b(0x2e6)]){const _0x3f6375=tryParse(_0x21d1d0[_0x29f32b(0x2e6)]);if(_0x3f6375&&Array[_0x29f32b(0x117)](_0x3f6375)){const _0x5e4542=[...new Set(_0x3f6375[_0x29f32b(0x26e)](_0x181ff3=>_0x181ff3[_0x29f32b(0x22c)])[_0x29f32b(0x224)](Boolean))];return _0x5e4542['sort']();}}return[];}catch(_0x16f584){return _0x5582e1[_0x29f32b(0x251)][_0x29f32b(0x2f2)](_0x29f32b(0x1bc)+_0x16f584[_0x29f32b(0x328)]),[];}}async function checkWifiPresence(_0x188e04){const _0x48fa2b=a0_0x4ee979;try{const _0x32be0b=_0x188e04[_0x48fa2b(0x14e)]['presenceDevices']||[];let _0x585cd5=![];const _0x1a939b=[];for(const _0x101e07 of _0x32be0b){try{const _0x2b64b5=await _0x188e04['getForeignStateAsync'](_0x101e07);if(_0x2b64b5&&(_0x2b64b5[_0x48fa2b(0x2e6)]===!![]||_0x2b64b5[_0x48fa2b(0x2e6)]===_0x48fa2b(0x263)||_0x2b64b5[_0x48fa2b(0x2e6)]===0x1)){_0x585cd5=!![];const _0x3f3ae9=await _0x188e04[_0x48fa2b(0x173)](_0x101e07);let _0x515843=_0x101e07;_0x3f3ae9&&_0x3f3ae9['common']&&_0x3f3ae9[_0x48fa2b(0x2fe)][_0x48fa2b(0x226)]&&(_0x515843=typeof _0x3f3ae9[_0x48fa2b(0x2fe)]['name']===_0x48fa2b(0x151)?_0x3f3ae9[_0x48fa2b(0x2fe)][_0x48fa2b(0x226)]['de']||_0x3f3ae9['common']['name']['en']:_0x3f3ae9[_0x48fa2b(0x2fe)]['name']),_0x1a939b[_0x48fa2b(0x271)](_0x515843);}}catch(_0x2a218b){}}return await _0x188e04[_0x48fa2b(0x2bb)]('system.presenceWho',{'val':_0x1a939b[_0x48fa2b(0x315)](',\x20'),'ack':!![]}),_0x585cd5&&(_0x188e04[_0x48fa2b(0x1ad)]&&(_0x188e04['log']['info']('WiFi\x20Presence\x20detected\x20->\x20Aborting\x20Exit\x20Timer.\x20User\x20is\x20present.'),abortExitTimer(_0x188e04)),!_0x188e04['isPresent']&&_0x188e04[_0x48fa2b(0x1d4)]===SYSTEM_MODES[_0x48fa2b(0x1b0)]&&await setPresence(_0x188e04,!![])),_0x585cd5;}catch(_0x4d87e6){return _0x188e04[_0x48fa2b(0x251)][_0x48fa2b(0x2f2)](_0x48fa2b(0x138)+_0x4d87e6[_0x48fa2b(0x328)]),![];}}function startExitTimer(_0x37fa4b){const _0x3aa01b=a0_0x4ee979;abortExitTimer(_0x37fa4b),_0x37fa4b[_0x3aa01b(0x286)]=!![],_0x37fa4b[_0x3aa01b(0x212)]=setTimeout(()=>{const _0x39ba11=_0x3aa01b;_0x37fa4b[_0x39ba11(0x286)]=![];},EXIT_GRACE_PERIOD_SECONDS*0x3e8),_0x37fa4b[_0x3aa01b(0x1ad)]=setTimeout(()=>{const _0x3fb829=_0x3aa01b;setPresence(_0x37fa4b,![]),_0x37fa4b[_0x3fb829(0x1ad)]=null;},EXIT_TIMER_MINUTES*0x3c*0x3e8);}function abortExitTimer(_0x1a5174){const _0x5caaea=a0_0x4ee979;if(_0x1a5174['exitTimer'])clearTimeout(_0x1a5174[_0x5caaea(0x1ad)]);if(_0x1a5174['exitGraceTimer'])clearTimeout(_0x1a5174['exitGraceTimer']);_0x1a5174['exitTimer']=null,_0x1a5174[_0x5caaea(0x212)]=null,_0x1a5174[_0x5caaea(0x286)]=![];}async function setPresence(_0x332c17,_0x16071a){const _0x24acea=a0_0x4ee979;if(_0x332c17[_0x24acea(0x24e)]===_0x16071a)return;_0x332c17['isPresent']=_0x16071a,await _0x332c17['setStateAsync'](_0x24acea(0x302),{'val':_0x16071a,'ack':!![]});}async function saveFeedback(_0x1eccb1,_0x379ae1){const _0x40355a=a0_0x4ee979;_0x1eccb1[_0x40355a(0x251)][_0x40355a(0x237)](_0x40355a(0x164)+JSON[_0x40355a(0x267)](_0x379ae1));}function a0_0x3450(_0x593ab6,_0x59f59d){const _0x5a4c22=a0_0x3a49();return a0_0x3450=function(_0x3ec6e0,_0x3284b4){_0x3ec6e0=_0x3ec6e0-0x106;let _0x3a49d1=_0x5a4c22[_0x3ec6e0];return _0x3a49d1;},a0_0x3450(_0x593ab6,_0x59f59d);}async function runBaselineDriftAnalysis(_0x149383){const _0x202001=a0_0x4ee979;if(!_0x149383[_0x202001(0x1c8)]||!_0x149383['geminiModel'])return;const _0x131d02=_0x149383[_0x202001(0x14e)]['ltmStbWindowDays']||0xe;if(_0x149383[_0x202001(0x319)][_0x202001(0x1ba)]<_0x131d02+(_0x149383[_0x202001(0x14e)]['minDaysForBaseline']||0x7)){await _0x149383[_0x202001(0x2bb)](LTM_DP_DRIFT_STATUS,{'val':_0x202001(0x2f1),'ack':!![]});return;}const _0x16190e=_0x149383[_0x202001(0x319)][_0x202001(0x126)](-_0x131d02),_0x31001a=_0x149383['dailyDigests'][_0x202001(0x126)](0x0,_0x149383['dailyDigests'][_0x202001(0x1ba)]-_0x131d02),_0x17c9ff=_0x202001(0x10d)+JSON[_0x202001(0x267)](_0x31001a)+'\x0aSTB:\x20'+JSON[_0x202001(0x267)](_0x16190e);try{const _0x5ee232=await _0x149383['geminiModel'][_0x202001(0x2c0)](_0x17c9ff),_0x1a01d1=JSON['parse'](_0x5ee232[_0x202001(0x1d9)][_0x202001(0x1d2)]()['replace'](/```json|```/g,'')[_0x202001(0x116)]());_0x1a01d1[_0x202001(0x326)]&&(await _0x149383[_0x202001(0x2bb)](LTM_DP_DRIFT_STATUS,{'val':_0x1a01d1[_0x202001(0x326)],'ack':!![]}),await _0x149383[_0x202001(0x2bb)](LTM_DP_DRIFT_DETAILS,{'val':_0x1a01d1['driftDetails'],'ack':!![]}),await _0x149383[_0x202001(0x2bb)](LTM_DP_DRIFT_LAST_CHECK,{'val':Date['now'](),'ack':!![]}));}catch(_0x29bb21){}}function setupLtmScheduler(_0x151aa0){const _0x145317=a0_0x4ee979;try{if(_0x151aa0[_0x145317(0x178)])_0x151aa0[_0x145317(0x178)][_0x145317(0x157)]();if(!_0x151aa0[_0x145317(0x1c8)]){_0x151aa0[_0x145317(0x2bb)](LTM_DP_STATUS,{'val':_0x145317(0x276),'ack':!![]});return;}_0x151aa0[_0x145317(0x178)]=schedule[_0x145317(0x1b3)](LTM_SCHEDULE,()=>createDailyDigest(_0x151aa0));}catch(_0x37057c){_0x151aa0[_0x145317(0x251)][_0x145317(0x2f2)](_0x145317(0x1b7)+_0x37057c[_0x145317(0x328)]);}}function setupModeResetScheduler(_0x1a4f6f){const _0x5c1456=a0_0x4ee979;try{if(_0x1a4f6f[_0x5c1456(0x19e)])_0x1a4f6f[_0x5c1456(0x19e)][_0x5c1456(0x157)]();_0x1a4f6f['modeResetJob']=schedule[_0x5c1456(0x1b3)](MODE_RESET_SCHEDULE,async()=>{const _0x2d1b8c=_0x5c1456;await loadSystemMode(_0x1a4f6f),AUTO_RESET_MODES[_0x2d1b8c(0x228)](_0x1a4f6f['currentSystemMode'])&&await _0x1a4f6f['setStateAsync'](SYSTEM_DP_MODE,{'val':SYSTEM_MODES[_0x2d1b8c(0x1b0)],'ack':![]});});}catch(_0x2a3832){_0x1a4f6f['log'][_0x5c1456(0x2f2)](_0x5c1456(0x2fc)+_0x2a3832[_0x5c1456(0x328)]);}}function setupDriftAnalysisScheduler(_0x4fe9f9){const _0x51819a=a0_0x4ee979;try{if(_0x4fe9f9['driftAnalysisTimer'])clearInterval(_0x4fe9f9[_0x51819a(0x18f)]);if(!_0x4fe9f9[_0x51819a(0x1c8)])return;_0x4fe9f9[_0x51819a(0x18f)]=setInterval(()=>runBaselineDriftAnalysis(_0x4fe9f9),(_0x4fe9f9[_0x51819a(0x14e)][_0x51819a(0x309)]||0x18)*0x36ee80),setTimeout(()=>runBaselineDriftAnalysis(_0x4fe9f9),0x1388);}catch(_0x405b93){_0x4fe9f9['log'][_0x51819a(0x2f2)](_0x51819a(0x148)+_0x405b93[_0x51819a(0x328)]);}}function setupBriefingScheduler(_0x4dc917){const _0x5db998=a0_0x4ee979;try{if(_0x4dc917[_0x5db998(0x145)])_0x4dc917[_0x5db998(0x145)][_0x5db998(0x157)]();if(!_0x4dc917[_0x5db998(0x14e)][_0x5db998(0x1a5)])return;const _0x21a1fc=(_0x4dc917[_0x5db998(0x14e)]['briefingTime']||_0x5db998(0x298))['split'](':'),_0x18f9f7=parseInt(_0x21a1fc[0x0])||0x8,_0xd80e49=parseInt(_0x21a1fc[0x1])||0x0,_0x13d8b2=_0xd80e49+'\x20'+_0x18f9f7+_0x5db998(0x129);_0x4dc917[_0x5db998(0x251)][_0x5db998(0x237)]('Scheduling\x20Morning\x20Briefing\x20for\x20'+_0x18f9f7+':'+(_0xd80e49<0xa?'0'+_0xd80e49:_0xd80e49)),_0x4dc917['briefingJob']=schedule[_0x5db998(0x1b3)](_0x13d8b2,()=>{sendMorningBriefing(_0x4dc917);});}catch(_0x218c57){_0x4dc917[_0x5db998(0x251)][_0x5db998(0x2f2)](_0x5db998(0x26a)+_0x218c57[_0x5db998(0x328)]);}}async function sendNotification(_0x39060e,_0x377f33,_0x2c8dce=![],_0x5ea529=![]){const _0x26ec33=a0_0x4ee979;_0x39060e[_0x26ec33(0x251)][_0x26ec33(0x237)]((_0x2c8dce?'[TEST]\x20':'')+'Sending\x20notification:\x20\x22'+_0x377f33+'\x22');const _0x3b8002=_0x39060e[_0x26ec33(0x14e)];let _0x2a7624=0x0;if(_0x3b8002[_0x26ec33(0x2ab)]){let _0x1bfcaf={};(_0x377f33['includes'](_0x26ec33(0x1dc))||_0x5ea529)&&(_0x1bfcaf={'reply_markup':{'inline_keyboard':[[{'text':'âœ…\x20Alles\x20OK\x20(Reset)]','callback_data':_0x26ec33(0x1e7)}],[{'text':_0x26ec33(0x2ff),'callback_data':'COGNI_REQUEST_CALL'}]]}}),await _0x39060e[_0x26ec33(0x248)](_0x3b8002[_0x26ec33(0x2de)],_0x26ec33(0x2a2),{'text':_0x377f33,'user':_0x3b8002[_0x26ec33(0x153)],..._0x1bfcaf}),_0x2a7624++;}if(_0x3b8002[_0x26ec33(0x163)]){let _0x4623c3={'message':_0x377f33,'title':_0x5ea529?_0x26ec33(0x182):_0x26ec33(0x108),'priority':_0x5ea529?0x2:0x1,'device':_0x3b8002[_0x26ec33(0x213)]};_0x5ea529&&(_0x4623c3['retry']=0x1e,_0x4623c3[_0x26ec33(0x2e9)]=0xe10,_0x4623c3['sound']=_0x26ec33(0x296)),await _0x39060e[_0x26ec33(0x248)](_0x3b8002[_0x26ec33(0x118)],_0x26ec33(0x2a2),_0x4623c3),_0x2a7624++;}return _0x3b8002[_0x26ec33(0x257)]&&(await _0x39060e[_0x26ec33(0x248)](_0x3b8002[_0x26ec33(0x299)],_0x26ec33(0x2a2),{'text':_0x377f33,'to':_0x3b8002[_0x26ec33(0x1df)]}),_0x2a7624++),_0x2a7624;}async function setupTelegramListener(_0x416499){const _0x372b3b=a0_0x4ee979,_0x3c74fb=_0x416499[_0x372b3b(0x14e)]['notifyTelegramInstance'];_0x416499[_0x372b3b(0x14e)][_0x372b3b(0x2ab)]&&_0x3c74fb&&(_0x416499[_0x372b3b(0x251)][_0x372b3b(0x237)](_0x372b3b(0x1f6)+_0x3c74fb+_0x372b3b(0x247)),await _0x416499[_0x372b3b(0x201)](_0x3c74fb+_0x372b3b(0x2ec)));}async function handleTelegramResponse(_0x3c482b,_0x537204){const _0x5c9aa9=a0_0x4ee979;let _0x1a8617=_0x537204;_0x537204['startsWith']('[')&&(_0x1a8617=_0x537204[_0x5c9aa9(0x2e8)](_0x537204[_0x5c9aa9(0x16c)](']')+0x1));if(_0x1a8617===_0x5c9aa9(0x1e7))_0x3c482b[_0x5c9aa9(0x251)]['info'](_0x5c9aa9(0x185)),await _0x3c482b['setStateAsync'](_0x5c9aa9(0x169),{'val':![],'ack':!![]}),await _0x3c482b[_0x5c9aa9(0x2bb)]('analysis.alertReason',{'val':'Vom\x20Benutzer\x20bestÃ¤tigt\x20(OK).','ack':!![]}),_0x3c482b['lastAlertState']=![],sendNotification(_0x3c482b,_0x5c9aa9(0x107),![]);else _0x1a8617==='COGNI_REQUEST_CALL'&&(_0x3c482b['log']['warn'](_0x5c9aa9(0x28a)),sendNotification(_0x3c482b,'ðŸ“ž\x20RÃœCKRUF\x20BITTE!\x20Der\x20Bewohner\x20hat\x20den\x20RÃ¼ckruf-Button\x20gedrÃ¼ckt.',![],!![]));}async function runAutopilot(_0x5d11d9){const _0x5ae82c=a0_0x4ee979,_0x518fc8=_0x5d11d9[_0x5ae82c(0x14e)][_0x5ae82c(0x1d8)],_0x94661b=_0x5d11d9[_0x5ae82c(0x10f)][_0x5ae82c(0x1ba)]>0x0?_0x5d11d9[_0x5ae82c(0x10f)][0x0][_0x5ae82c(0x1f7)]:Date[_0x5ae82c(0x2ee)](),_0x5669fc=(Date[_0x5ae82c(0x2ee)]()-_0x94661b)/(0x3e8*0x3c*0x3c);let _0x19298c='';_0x5d11d9[_0x5ae82c(0x14e)][_0x5ae82c(0x324)]&&_0x5d11d9['currentSystemMode']===SYSTEM_MODES[_0x5ae82c(0x1b0)]&&_0x5d11d9[_0x5ae82c(0x24e)]&&(_0x5669fc>_0x518fc8&&(_0x19298c=_0x5ae82c(0x1f4)+_0x5669fc[_0x5ae82c(0x26d)](0x1)+_0x5ae82c(0x106))),runGeminiAnalysis(_0x5d11d9,_0x19298c)[_0x5ae82c(0x30a)](_0x57761f=>_0x5d11d9['log'][_0x5ae82c(0x2f2)](_0x57761f));}async function createDailyDigest(_0x199e98){const _0x3a412b=a0_0x4ee979;if(!_0x199e98[_0x3a412b(0x1c8)])return;await _0x199e98[_0x3a412b(0x2bb)](LTM_DP_STATUS,{'val':'Started\x20at\x20'+new Date()[_0x3a412b(0x13f)](),'ack':!![]});if(!_0x199e98[_0x3a412b(0x2af)]||_0x199e98['rawEventLog'][_0x3a412b(0x1ba)]<LTM_MIN_EVENTS_FOR_COMPRESSION){await _0x199e98[_0x3a412b(0x2bb)](LTM_DP_STATUS,{'val':'Skipped\x20(No\x20AI\x20or\x20Data)','ack':!![]});return;}const _0x44c77c=JSON[_0x3a412b(0x113)](JSON[_0x3a412b(0x267)](_0x199e98[_0x3a412b(0x19c)])),_0x455acb=_0x44c77c[_0x3a412b(0x1ba)],_0x141029='ROLLE:\x20Data\x20Compression\x20Agent.\x20SPRACHE:\x20DE.\x20FORMAT:\x20JSON.\x20ANWEISUNG:\x20Fasse\x20Sensor-Events\x20zusammen.\x20SCHEMA:\x20{\x20\x22summary\x22:\x20\x22string\x22,\x20\x22activityLevel\x22:\x20\x22string\x22\x20}\x20\x0a\x0aEVENTS:\x0a'+JSON[_0x3a412b(0x267)](_0x44c77c);try{const _0x134115=await _0x199e98['geminiModel'][_0x3a412b(0x2c0)](_0x141029),_0x3062f0=JSON[_0x3a412b(0x113)](_0x134115[_0x3a412b(0x1d9)][_0x3a412b(0x1d2)]()[_0x3a412b(0x293)](/```json|```/g,'')[_0x3a412b(0x116)]());if(_0x3062f0[_0x3a412b(0x198)]){const _0x563078={'timestamp':new Date()[_0x3a412b(0x135)](),'eventCount':_0x455acb,'summary':_0x3062f0[_0x3a412b(0x198)],'activityLevel':_0x3062f0[_0x3a412b(0x196)],'systemMode':_0x199e98['currentSystemMode']};_0x199e98[_0x3a412b(0x319)][_0x3a412b(0x271)](_0x563078),await saveDailyDigests(_0x199e98),_0x199e98[_0x3a412b(0x19c)]=[],await saveRawEventLog(_0x199e98),await _0x199e98['setStateAsync'](LTM_DP_STATUS,{'val':_0x3a412b(0x158)+_0x455acb+_0x3a412b(0x161),'ack':!![]}),_0x199e98[_0x3a412b(0x1c8)]&&(_0x199e98[_0x3a412b(0x251)]['info']('ðŸ©º\x20Triggering\x20Health\x20Analysis\x20on\x20new\x20Digest...'),sendToPython(_0x199e98,'ANALYZE_HEALTH',{'digest':_0x563078}));}}catch(_0x2ccfc8){await _0x199e98[_0x3a412b(0x2bb)](LTM_DP_STATUS,{'val':'Error:\x20'+_0x2ccfc8[_0x3a412b(0x328)],'ack':!![]});}}async function sendMorningBriefing(_0xccbe6e){const _0x10a14a=a0_0x4ee979;if(!_0xccbe6e[_0x10a14a(0x2af)])return;_0xccbe6e[_0x10a14a(0x251)][_0x10a14a(0x237)](_0x10a14a(0x223));const _0x39f830=_0xccbe6e[_0x10a14a(0x319)][_0x10a14a(0x1ba)]>0x0?_0xccbe6e[_0x10a14a(0x319)][_0xccbe6e[_0x10a14a(0x319)][_0x10a14a(0x1ba)]-0x1]:null,_0x68cc1=_0x39f830&&_0x39f830[_0x10a14a(0x2b0)]?_0x39f830[_0x10a14a(0x2b0)][_0x10a14a(0x289)]:_0x10a14a(0x241),_0x843804=new Date();_0x843804[_0x10a14a(0x1a3)](0x4,0x0,0x0,0x0);const _0x36ac53=_0xccbe6e[_0x10a14a(0x10f)]['filter'](_0x5d7b60=>new Date(_0x5d7b60['timestamp'])>_0x843804),_0x1198ea=PERSONA_MAPPING[_0xccbe6e['config']['aiPersona']||_0x10a14a(0x1b9)],_0x403460=_0xccbe6e[_0x10a14a(0x14e)][_0x10a14a(0x122)]||'',_0x394a72=await getWeatherContext(_0xccbe6e),_0x46de93=await getCalendarContext(_0xccbe6e),_0x1980eb=_0x10a14a(0x2c3)+_0x1198ea+_0x10a14a(0x23b)+_0x403460+_0x10a14a(0x183)+_0x394a72+'\x20'+_0x46de93+'.\x20DATEN:\x20Schlaf\x20'+_0x68cc1+_0x10a14a(0x119)+JSON[_0x10a14a(0x267)](_0x36ac53[_0x10a14a(0x126)](0x0,0xa))+_0x10a14a(0x21d);try{const _0x52a92d=await _0xccbe6e['geminiModel']['generateContent'](_0x1980eb),_0xa9314d='ðŸŒ…\x20Daily\x20Briefing:\x0a'+_0x52a92d['response'][_0x10a14a(0x1d2)]()[_0x10a14a(0x116)]();sendNotification(_0xccbe6e,_0xa9314d),_0xccbe6e[_0x10a14a(0x251)][_0x10a14a(0x237)]('Morning\x20Briefing\x20sent.');}catch(_0x4bc1ea){_0xccbe6e[_0x10a14a(0x251)][_0x10a14a(0x2f2)](_0x10a14a(0x25a)+_0x4bc1ea[_0x10a14a(0x328)]);}}async function scanForDevices(_0x4d7b87,_0x43be6b){const _0x454856=a0_0x4ee979;_0x4d7b87[_0x454856(0x251)]['info'](_0x454856(0x23f));const _0x50dee4=[],_0x469487=await _0x4d7b87[_0x454856(0x27b)]('*'),_0x59cb89=await _0x4d7b87['getForeignObjectsAsync'](_0x454856(0x254),'enum'),_0x5a695c=await _0x4d7b87[_0x454856(0x27b)]('enum.rooms.*','enum'),_0x279622={};if(_0x59cb89)for(const _0x41264b in _0x59cb89){const _0x286fbd=_0x59cb89[_0x41264b]['common']['members']||[];_0x286fbd['forEach'](_0x58baea=>{const _0xddd8f0=_0x454856;if(!_0x279622[_0x58baea])_0x279622[_0x58baea]=[];_0x279622[_0x58baea][_0xddd8f0(0x271)](_0x41264b);});}const _0xc72f03={};if(_0x5a695c)for(const _0x200936 in _0x5a695c){const _0xfdfa6e=_0x5a695c[_0x200936][_0x454856(0x2fe)][_0x454856(0x294)]||[],_0x58d14e=typeof _0x5a695c[_0x200936]['common'][_0x454856(0x226)]===_0x454856(0x151)?_0x5a695c[_0x200936][_0x454856(0x2fe)][_0x454856(0x226)]['de']:_0x5a695c[_0x200936][_0x454856(0x2fe)][_0x454856(0x226)];_0xfdfa6e['forEach'](_0x6afd93=>_0xc72f03[_0x6afd93]=_0x58d14e);}const _0x5a9cab=_0x43be6b[_0x454856(0x186)]||[],_0x8cb409=_0x43be6b[_0x454856(0x202)]!==![],_0x3a5609=_0x43be6b[_0x454856(0x2cd)]!==![],_0x286954=_0x43be6b[_0x454856(0x1cf)]!==![],_0x362dea=_0x43be6b[_0x454856(0x11c)]===!![],_0x5b92da=_0x43be6b[_0x454856(0x31d)]===!![];for(const _0x3c9811 in _0x469487){const _0xef27f0=_0x469487[_0x3c9811];if(_0xef27f0[_0x454856(0x114)]!==_0x454856(0x1af)||!_0xef27f0[_0x454856(0x2fe)])continue;if(ADAPTER_BLACKLIST['some'](_0x243912=>_0x3c9811[_0x454856(0x2db)](_0x243912))&&!_0x5b92da)continue;const _0xd9b485=(_0xef27f0[_0x454856(0x2fe)]['role']||'')['toLowerCase']();let _0x1e4c29=(typeof _0xef27f0[_0x454856(0x2fe)][_0x454856(0x226)]==='object'?_0xef27f0[_0x454856(0x2fe)][_0x454856(0x226)]['de']:_0xef27f0[_0x454856(0x2fe)][_0x454856(0x226)])||_0x3c9811;const _0xbf3ad1=_0x1e4c29[_0x454856(0x2ca)]();let _0xf3ac6e=![],_0x1691ea=![];if(_0x5a9cab[_0x454856(0x1ba)]>0x0){const _0x335e0a=_0x279622[_0x3c9811]||[],_0x29f277=_0x3c9811[_0x454856(0x30e)]('.')[_0x454856(0x126)](0x0,-0x1)['join']('.'),_0xc87f8e=_0x279622[_0x29f277]||[];(_0x335e0a[_0x454856(0x27e)](_0x11e00f=>_0x5a9cab[_0x454856(0x228)](_0x11e00f))||_0xc87f8e[_0x454856(0x27e)](_0x308c85=>_0x5a9cab[_0x454856(0x228)](_0x308c85)))&&(_0xf3ac6e=!![],_0x1691ea=!![]);}if(!_0xf3ac6e&&!_0x5b92da){if(HARD_IGNORE_TERMS[_0x454856(0x27e)](_0x3a61cd=>_0x3c9811['includes'](_0x3a61cd)||_0xbf3ad1[_0x454856(0x228)](_0x3a61cd['toLowerCase']())))continue;}if(BAD_NAMES[_0x454856(0x27e)](_0x42aa39=>_0xbf3ad1===_0x42aa39||_0xbf3ad1[_0x454856(0x210)]('.'+_0x42aa39))){const _0x26997e=_0x3c9811[_0x454856(0x30e)]('.');if(_0x26997e[_0x454856(0x1ba)]>0x2){const _0x23865b=_0x26997e['slice'](0x0,-0x1)[_0x454856(0x315)]('.'),_0x1a7d4b=_0x469487[_0x23865b];if(_0x1a7d4b&&_0x1a7d4b[_0x454856(0x2fe)]&&_0x1a7d4b[_0x454856(0x2fe)][_0x454856(0x226)]){const _0x726d7f=typeof _0x1a7d4b['common'][_0x454856(0x226)]==='object'?_0x1a7d4b[_0x454856(0x2fe)][_0x454856(0x226)]['de']:_0x1a7d4b[_0x454856(0x2fe)][_0x454856(0x226)];_0x726d7f&&!_0x1e4c29[_0x454856(0x228)](_0x726d7f)&&(_0x1e4c29=_0x726d7f+'\x20'+_0x1e4c29);}}}let _0x2e4956='';if(_0x8cb409&&(_0xd9b485['includes']('motion')||_0xd9b485['includes'](_0x454856(0x1e5))||_0xbf3ad1[_0x454856(0x228)]('bewegung')||_0xbf3ad1[_0x454856(0x228)](_0x454856(0x329))))_0x2e4956=_0x454856(0x202);else{if(!_0x2e4956&&_0x3a5609&&(_0xd9b485[_0x454856(0x228)](_0x454856(0x176))||_0xd9b485['includes'](_0x454856(0x238))||_0xd9b485[_0x454856(0x228)](_0x454856(0x26f))||_0xd9b485['includes'](_0x454856(0x2bc))||_0xd9b485[_0x454856(0x228)](_0x454856(0x1fb))||_0xbf3ad1[_0x454856(0x228)](_0x454856(0x275))||_0xbf3ad1[_0x454856(0x228)](_0x454856(0x265))||_0xbf3ad1['includes'](_0x454856(0x192))))_0x2e4956=_0x454856(0x176);else{if(!_0x2e4956&&_0x286954&&(_0xd9b485[_0x454856(0x228)](_0x454856(0x181))||_0xd9b485['includes']('switch')||_0xd9b485['includes'](_0x454856(0x27a))||_0xbf3ad1[_0x454856(0x228)](_0x454856(0x1f5))||_0xbf3ad1[_0x454856(0x228)](_0x454856(0x18d))||_0xbf3ad1[_0x454856(0x228)](_0x454856(0x244)))){if(_0xef27f0[_0x454856(0x2fe)]['write']||_0xd9b485[_0x454856(0x228)](_0x454856(0x295)))_0x2e4956='light';}else{if(!_0x2e4956&&_0x362dea&&(_0xd9b485[_0x454856(0x228)]('temperature')||_0xd9b485[_0x454856(0x228)](_0x454856(0x19d))||_0xd9b485[_0x454856(0x228)](_0x454856(0x17d))||_0xbf3ad1[_0x454856(0x228)]('temp')||_0xbf3ad1['includes']('klima')||_0xbf3ad1[_0x454856(0x228)](_0x454856(0x22a))))_0x2e4956=_0x454856(0x11c);else{if(!_0x2e4956&&_0x1691ea)_0x2e4956='custom';}}}}if(_0x2e4956){let _0x3b956e=_0xc72f03[_0x3c9811]||'';if(!_0x3b956e){let _0xcdd511=_0x3c9811;for(let _0x151388=0x0;_0x151388<0x3;_0x151388++){const _0x56522b=_0xcdd511[_0x454856(0x32b)]('.');if(_0x56522b===-0x1)break;_0xcdd511=_0xcdd511[_0x454856(0x2e8)](0x0,_0x56522b);if(_0xc72f03[_0xcdd511]){_0x3b956e=_0xc72f03[_0xcdd511];break;}}}_0x50dee4[_0x454856(0x271)]({'id':_0x3c9811,'name':_0x1e4c29,'location':_0x3b956e,'type':_0x2e4956,'logDuplicates':_0x2e4956===_0x454856(0x202),'isExit':![],'_score':_0x3b956e?0x50:_0x2e4956===_0x454856(0x325)?0x5a:0x28});}}return _0x50dee4[_0x454856(0x203)]((_0x7c19ca,_0x4b90de)=>_0x4b90de[_0x454856(0x280)]-_0x7c19ca[_0x454856(0x280)]),_0x50dee4;}async function executeAutomationAction(_0x3f87fe){const _0x2a2fc8=a0_0x4ee979;try{const _0x5d5db2=await _0x3f87fe[_0x2a2fc8(0x231)]('analysis.automation.targetId'),_0x246d3f=await _0x3f87fe[_0x2a2fc8(0x231)](_0x2a2fc8(0x242));if(_0x5d5db2&&_0x5d5db2[_0x2a2fc8(0x2e6)]&&_0x246d3f){const _0x5e81a5=_0x5d5db2[_0x2a2fc8(0x2e6)];let _0x316039=_0x246d3f['val'];try{_0x316039=JSON['parse'](_0x316039);}catch(_0x51c34e){}_0x3f87fe['log'][_0x2a2fc8(0x237)]('ðŸ¤–\x20BUTLER:\x20Executing\x20Action\x20->\x20'+_0x5e81a5+'\x20=\x20'+_0x316039),await _0x3f87fe[_0x2a2fc8(0x156)](_0x5e81a5,_0x316039);}else _0x3f87fe[_0x2a2fc8(0x251)][_0x2a2fc8(0x189)](_0x2a2fc8(0x191));}catch(_0x194432){_0x3f87fe['log']['error'](_0x2a2fc8(0x20e)+_0x194432[_0x2a2fc8(0x328)]);}}function tryParse(_0x1755f8){const _0x484e81=a0_0x4ee979;try{return JSON[_0x484e81(0x113)](_0x1755f8);}catch(_0x533dcd){return null;}}async function recordSequence(_0x2e0eae,_0x5468f2){const _0x58f76b=a0_0x4ee979,_0x5e948f=(_0x5468f2[_0x58f76b(0x114)]||'')[_0x58f76b(0x2ca)](),_0x403961=[_0x58f76b(0x202),_0x58f76b(0x20c),_0x58f76b(0x329),_0x58f76b(0x1ce),'occupancy','door',_0x58f76b(0x265),_0x58f76b(0x238),_0x58f76b(0x275),_0x58f76b(0x171),_0x58f76b(0x15a),'light',_0x58f76b(0x1f5),_0x58f76b(0x1bd),'schalter','dimmer',_0x58f76b(0x18d)];if(!_0x403961[_0x58f76b(0x27e)](_0x216b0b=>_0x5e948f[_0x58f76b(0x228)](_0x216b0b))){_0x2e0eae[_0x58f76b(0x251)][_0x58f76b(0x2d5)](_0x58f76b(0x21c)+_0x5468f2['id']+_0x58f76b(0x12c)+_0x5468f2[_0x58f76b(0x114)]+_0x58f76b(0x28f));return;}if(!_0x5468f2['value']){_0x2e0eae[_0x58f76b(0x251)]['debug']('[RECORDER\x20DEBUG]\x20Ignored\x20Event\x20'+_0x5468f2['id']+_0x58f76b(0x1fe)+_0x5468f2[_0x58f76b(0x2a5)]+')');return;}_0x2e0eae[_0x58f76b(0x251)][_0x58f76b(0x2d5)](_0x58f76b(0x1ca)+_0x5468f2['id']+'\x20('+_0x5468f2[_0x58f76b(0x2fb)]+')');if(sequenceTimer)clearTimeout(sequenceTimer);const _0x251b50={'loc':_0x5468f2[_0x58f76b(0x2fb)]||'Unknown','id':_0x5468f2['id'],'ts':Date[_0x58f76b(0x2ee)]()};activeSequence[_0x58f76b(0x271)](_0x251b50),_0x2e0eae['log']['debug'](_0x58f76b(0x115)+_0x251b50[_0x58f76b(0x31e)]+'\x20(Length:\x20'+activeSequence[_0x58f76b(0x1ba)]+')'),sequenceTimer=setTimeout(async()=>{const _0x497fa0=_0x58f76b;activeSequence['length']>0x1?await saveCompletedSequence(_0x2e0eae):(_0x2e0eae['log']['debug'](_0x497fa0(0x14a)+activeSequence['length']+')'),activeSequence=[]);},SEQUENCE_TIMEOUT_MS);}async function saveCompletedSequence(_0x44ebfb){const _0x2e46d8=a0_0x4ee979;try{_0x44ebfb[_0x2e46d8(0x251)][_0x2e46d8(0x237)](_0x2e46d8(0x20f)+activeSequence[_0x2e46d8(0x1ba)]+_0x2e46d8(0x197));const _0x4d1baf=await _0x44ebfb['getStateAsync']('LTM.trainingData.sequences');let _0x85bdab=[];if(_0x4d1baf&&_0x4d1baf[_0x2e46d8(0x2e6)])try{_0x85bdab=JSON[_0x2e46d8(0x113)](_0x4d1baf[_0x2e46d8(0x2e6)]);}catch(_0x516bcf){}const _0x524092=activeSequence[0x0]['ts'],_0x404e46=activeSequence['map'](_0x159f47=>({'loc':_0x159f47[_0x2e46d8(0x31e)],'t_delta':Math[_0x2e46d8(0x1a6)]((_0x159f47['ts']-_0x524092)/0x3e8)})),_0x1f0bdd={'timestamp':new Date(_0x524092)[_0x2e46d8(0x135)](),'steps':_0x404e46,'duration':Math['round']((activeSequence[activeSequence[_0x2e46d8(0x1ba)]-0x1]['ts']-_0x524092)/0x3e8),'daytime':new Date(_0x524092)['getHours']()};_0x85bdab[_0x2e46d8(0x271)](_0x1f0bdd),_0x85bdab['length']>MAX_TRAINING_SET_SIZE&&_0x85bdab[_0x2e46d8(0x23a)](),await _0x44ebfb[_0x2e46d8(0x2bb)]('LTM.trainingData.sequences',{'val':JSON[_0x2e46d8(0x267)](_0x85bdab),'ack':!![]}),runSecurityCheck(_0x44ebfb,_0x1f0bdd),activeSequence=[],sequenceTimer=null;}catch(_0x350032){_0x44ebfb[_0x2e46d8(0x251)][_0x2e46d8(0x2f2)]('[RECORDER]\x20Error\x20saving\x20sequence:\x20'+_0x350032[_0x2e46d8(0x328)]);}}function runSecurityCheck(_0x223bff,_0x2936ac){const _0x30cbf6=a0_0x4ee979;if(!_0x223bff[_0x30cbf6(0x1c8)])return;_0x223bff[_0x30cbf6(0x251)]['debug']('ðŸ›¡ï¸\x20SECURITY:\x20Sending\x20sequence\x20to\x20Guard\x20for\x20analysis...'),sendToPython(_0x223bff,_0x30cbf6(0x28e),{'sequence':_0x2936ac});}async function getOutsideTemperatureNumeric(_0x3ae13e){const _0xc33470=a0_0x4ee979;if(_0x3ae13e['config']['outdoorSensorId'])try{const _0x4a7e88=await _0x3ae13e[_0xc33470(0x123)](_0x3ae13e[_0xc33470(0x14e)][_0xc33470(0x281)]);if(_0x4a7e88&&_0x4a7e88['val']!==undefined&&_0x4a7e88[_0xc33470(0x2e6)]!==null){const _0x896e70=parseFloat(_0x4a7e88[_0xc33470(0x2e6)]);if(!isNaN(_0x896e70))return _0x896e70;}}catch(_0x58bead){}const _0x541bbe=_0x3ae13e[_0xc33470(0x14e)][_0xc33470(0x1a8)];if(!_0x3ae13e['config'][_0xc33470(0x235)]||!_0x541bbe)return null;try{let _0x1460bb='';if(_0x541bbe[_0xc33470(0x228)](_0xc33470(0x1ea)))_0x1460bb=_0x541bbe+_0xc33470(0x2e7);else{if(_0x541bbe[_0xc33470(0x228)](_0xc33470(0x143)))_0x1460bb=_0x541bbe+'.NextHours.Location_1.Day_1.current.temp_value';else{if(_0x541bbe['includes'](_0xc33470(0x1e8)))_0x1460bb=_0x541bbe+'.forecast.current.temperature';else{if(_0x541bbe['includes'](_0xc33470(0x272)))_0x1460bb=_0x541bbe+'.forecast.current.temp';}}}if(_0x1460bb){const _0x55fd84=await _0x3ae13e['getForeignStateAsync'](_0x1460bb);if(_0x55fd84&&_0x55fd84[_0xc33470(0x2e6)]!==undefined&&_0x55fd84[_0xc33470(0x2e6)]!==null)return parseFloat(_0x55fd84[_0xc33470(0x2e6)]);}}catch(_0x2c1811){}return null;}async function recordThermodynamics(_0xb418b9,_0x83c898,_0x1004c0,_0xeac641){const _0xb72dee=a0_0x4ee979,_0x48cec4=await getOutsideTemperatureNumeric(_0xb418b9),_0x37fdb1=await _0xb418b9[_0xb72dee(0x231)](_0xb72dee(0x155));let _0x48916f=[];if(_0x37fdb1&&_0x37fdb1['val'])try{_0x48916f=JSON[_0xb72dee(0x113)](_0x37fdb1[_0xb72dee(0x2e6)]);}catch(_0x501122){}_0x48916f[_0xb72dee(0x271)]({'ts':Date[_0xb72dee(0x2ee)](),'room':_0xeac641||_0xb72dee(0x2b7),'t_in':_0x1004c0,'t_out':_0x48cec4});if(_0x48916f[_0xb72dee(0x1ba)]>THERMO_LOG_SIZE)_0x48916f[_0xb72dee(0x23a)]();await _0xb418b9[_0xb72dee(0x2bb)](_0xb72dee(0x155),{'val':JSON[_0xb72dee(0x267)](_0x48916f),'ack':!![]});}async function processSensorEvent(_0xd6232a,_0x2860dd,_0x4f1ccd,_0x17501d){const _0x7f0590=a0_0x4ee979;if(!_0x17501d)return;const _0x11cc57=_0x4f1ccd[_0x7f0590(0x2e6)],_0x1904c3=Date[_0x7f0590(0x2ee)](),_0x2ebf71=_0xd6232a[_0x7f0590(0x2aa)][_0x2860dd];_0xd6232a[_0x7f0590(0x2aa)][_0x2860dd]=_0x11cc57;if(!_0x17501d['logDuplicates']&&_0x2ebf71!=undefined&&_0x2ebf71==_0x11cc57)return;const _0x40b2f4=(_0x17501d[_0x7f0590(0x114)]||'')[_0x7f0590(0x2ca)](),_0x32e241=_0x40b2f4[_0x7f0590(0x228)](_0x7f0590(0x11c))||_0x40b2f4[_0x7f0590(0x228)]('temperatur')||_0x40b2f4[_0x7f0590(0x228)](_0x7f0590(0x200))||_0x40b2f4['includes'](_0x7f0590(0x22a));_0xd6232a['isProVersion']&&_0x32e241&&recordThermodynamics(_0xd6232a,_0x2860dd,_0x11cc57,_0x17501d[_0x7f0590(0x2fb)]);const _0x2c5d58={'timestamp':_0x1904c3,'id':_0x2860dd,'name':_0x17501d[_0x7f0590(0x226)],'type':_0x17501d[_0x7f0590(0x114)],'location':_0x17501d[_0x7f0590(0x2fb)],'value':_0x11cc57};_0xd6232a[_0x7f0590(0x10f)][_0x7f0590(0x12e)](_0x2c5d58);if(_0xd6232a[_0x7f0590(0x10f)]['length']>HISTORY_MAX_SIZE)_0xd6232a[_0x7f0590(0x10f)]['pop']();await _0xd6232a['setStateAsync'](_0x7f0590(0x29e),{'val':JSON[_0x7f0590(0x267)](_0x2c5d58),'ack':!![]}),await _0xd6232a[_0x7f0590(0x2bb)](_0x7f0590(0x2c1),{'val':JSON[_0x7f0590(0x267)](_0xd6232a[_0x7f0590(0x10f)]),'ack':!![]});_0xd6232a[_0x7f0590(0x1c8)]&&(_0xd6232a[_0x7f0590(0x19c)][_0x7f0590(0x271)](_0x2c5d58),await saveRawEventLog(_0xd6232a),recordSequence(_0xd6232a,_0x2c5d58));if(_0x17501d[_0x7f0590(0x1de)]&&_0x11cc57===!![]){if(_0xd6232a['isPresent']&&!_0xd6232a['isGracePeriodActive'])startExitTimer(_0xd6232a);else{if(!_0xd6232a[_0x7f0590(0x24e)])setPresence(_0xd6232a,!![]);}}else{if(_0x17501d[_0x7f0590(0x114)]==='motion'&&_0x11cc57===!![]){if(_0xd6232a[_0x7f0590(0x1ad)])abortExitTimer(_0xd6232a);if(!_0xd6232a['isPresent']&&_0xd6232a[_0x7f0590(0x1d4)]===SYSTEM_MODES[_0x7f0590(0x1b0)])setPresence(_0xd6232a,!![]);}}}async function runGeminiAnalysis(_0x27dfb2,_0x2a85e1=''){const _0x4a4a9f=a0_0x4ee979;if(!_0x27dfb2[_0x4a4a9f(0x2af)])return;if(_0x27dfb2[_0x4a4a9f(0x10f)][_0x4a4a9f(0x1ba)]===0x0)return;const _0xc9ed76=_0x27dfb2[_0x4a4a9f(0x10f)][_0x4a4a9f(0x126)](0x0,0xf),_0x4ac08b=await getWeatherContext(_0x27dfb2),_0x31e23e=_0x27dfb2['currentSystemMode'],_0x133fac=PERSONA_MAPPING[_0x27dfb2[_0x4a4a9f(0x14e)][_0x4a4a9f(0x2dd)]||_0x4a4a9f(0x1b9)],_0x314dd8=_0x27dfb2[_0x4a4a9f(0x14e)][_0x4a4a9f(0x122)]||_0x4a4a9f(0x209);let _0x144275=_0x4a4a9f(0x27d);try{const _0x37eb86=await _0x27dfb2['getStateAsync']('system.presenceWho');if(_0x37eb86&&_0x37eb86['val'])_0x144275=_0x37eb86[_0x4a4a9f(0x2e6)];}catch(_0x358303){}let _0x1e1a00=![];try{const _0x168d54=await _0x27dfb2['getStateAsync'](_0x4a4a9f(0x160));if(_0x168d54&&_0x168d54[_0x4a4a9f(0x2e6)])_0x1e1a00=!![];}catch(_0x300688){}const _0x421bd7=_0x4a4a9f(0x277)+_0x133fac+_0x4a4a9f(0x23b)+_0x314dd8+_0x4a4a9f(0x1c2)+_0x31e23e+_0x4a4a9f(0x327)+_0x4ac08b+'.\x20NOTFALL-KONTEXT:\x20'+(_0x2a85e1||_0x4a4a9f(0x14b))+_0x4a4a9f(0x30b)+(_0x27dfb2[_0x4a4a9f(0x24e)]?_0x4a4a9f(0x256):'ABWESEND')+'.\x20ANWESENDE_GERAETE:\x20'+_0x144275+_0x4a4a9f(0x22f)+JSON[_0x4a4a9f(0x267)](_0xc9ed76)+_0x4a4a9f(0x10e);try{const _0x193f21=await _0x27dfb2[_0x4a4a9f(0x2af)][_0x4a4a9f(0x2c0)](_0x421bd7),_0x4fff74=_0x193f21['response'][_0x4a4a9f(0x1d2)]()[_0x4a4a9f(0x293)](/```json|```/g,'')[_0x4a4a9f(0x116)](),_0x4f4522=JSON['parse'](_0x4fff74);await _0x27dfb2[_0x4a4a9f(0x2bb)]('analysis.lastResult',{'val':JSON[_0x4a4a9f(0x267)](_0x4f4522),'ack':!![]});if(_0x4f4522['summary'])await _0x27dfb2[_0x4a4a9f(0x2bb)](_0x4a4a9f(0x16e),{'val':_0x4f4522['summary'],'ack':!![]});const _0x16d340={'timestamp':Date['now'](),'id':Date['now']()[_0x4a4a9f(0x1a9)](),'analysis':{'activity':{'summary':_0x4f4522[_0x4a4a9f(0x198)]||_0x4a4a9f(0x2a6),'isAlert':_0x4f4522[_0x4a4a9f(0x10a)]||![],'alertReason':_0x4f4522[_0x4a4a9f(0x2ea)]},'comfort':{'automationProposal':_0x4f4522[_0x4a4a9f(0x1d7)]}}};await updateAnalysisHistory(_0x27dfb2,_0x16d340);const _0x3c114f=_0x4f4522[_0x4a4a9f(0x10a)]||![];_0x3c114f!==_0x27dfb2[_0x4a4a9f(0x2cc)]&&(await _0x27dfb2['setStateAsync'](_0x4a4a9f(0x169),{'val':_0x3c114f,'ack':!![]}),_0x27dfb2[_0x4a4a9f(0x2cc)]=_0x3c114f,_0x3c114f&&(await _0x27dfb2[_0x4a4a9f(0x2bb)](_0x4a4a9f(0x110),{'val':_0x4f4522[_0x4a4a9f(0x2ea)],'ack':!![]}),sendNotification(_0x27dfb2,_0x4a4a9f(0x11d)+_0x4f4522[_0x4a4a9f(0x2ea)],![],_0x4f4522[_0x4a4a9f(0x230)]))),_0x4f4522[_0x4a4a9f(0x1d7)]&&_0x4f4522[_0x4a4a9f(0x1d7)][_0x4a4a9f(0x174)]&&_0x4f4522[_0x4a4a9f(0x1d7)][_0x4a4a9f(0x311)]&&(await _0x27dfb2[_0x4a4a9f(0x2bb)](_0x4a4a9f(0x206),{'val':!![],'ack':!![]}),await _0x27dfb2['setStateAsync'](_0x4a4a9f(0x30f),{'val':_0x4f4522['automationProposal']['description'],'ack':!![]}),await _0x27dfb2[_0x4a4a9f(0x2bb)](_0x4a4a9f(0x288),{'val':_0x4f4522[_0x4a4a9f(0x1d7)][_0x4a4a9f(0x311)],'ack':!![]}),await _0x27dfb2[_0x4a4a9f(0x2bb)]('analysis.automation.targetValue',{'val':JSON[_0x4a4a9f(0x267)](_0x4f4522[_0x4a4a9f(0x1d7)][_0x4a4a9f(0x1c9)]),'ack':!![]}),_0x1e1a00&&await executeAutomationAction(_0x27dfb2));}catch(_0x31ce97){_0x27dfb2['log'][_0x4a4a9f(0x2f2)](_0x4a4a9f(0x20d)+_0x31ce97[_0x4a4a9f(0x328)]);}}function installPythonDependencies(_0x2246b8){const _0x366996=a0_0x4ee979;if(_0x2246b8[_0x366996(0x150)])return;_0x2246b8[_0x366996(0x150)]=!![];const _0x40440f=path[_0x366996(0x315)](__dirname,_0x366996(0x1f8),'requirements.txt');_0x2246b8[_0x366996(0x251)][_0x366996(0x237)](_0x366996(0x21e)+_0x40440f+_0x366996(0x152)),stopPythonService(_0x2246b8);const _0x1e94c9=_0x366996(0x2d3)+_0x40440f+_0x366996(0x245);exec(_0x1e94c9,(_0x2ee153,_0x29523e,_0x37e30b)=>{const _0x581013=_0x366996,_0x571ef3=_0x37e30b&&_0x37e30b[_0x581013(0x228)](_0x581013(0x225))||_0x2ee153&&_0x2ee153['message'][_0x581013(0x228)](_0x581013(0x225));if(_0x571ef3){_0x2246b8['log'][_0x581013(0x189)](_0x581013(0x2a3)),exec(_0x581013(0x167),(_0xe89290,_0x2f6217,_0x28b1a9)=>{const _0x9adbd9=_0x581013;_0xe89290?(_0x2246b8[_0x9adbd9(0x251)][_0x9adbd9(0x2f2)](_0x9adbd9(0x2ae)),_0x2246b8['dependencyInstallInProgress']=![]):(_0x2246b8['log'][_0x9adbd9(0x237)](_0x9adbd9(0x30c)),exec(_0x9adbd9(0x2d3)+_0x40440f+_0x9adbd9(0x214),(_0x516241,_0x4a692a,_0x431cc3)=>{const _0x2ef76c=_0x9adbd9;_0x516241?_0x2246b8[_0x2ef76c(0x251)][_0x2ef76c(0x2f2)](_0x2ef76c(0x10c)+_0x516241[_0x2ef76c(0x328)]):(_0x2246b8[_0x2ef76c(0x251)]['info'](_0x2ef76c(0x307)),startPythonService(_0x2246b8)),_0x2246b8['dependencyInstallInProgress']=![];}));});return;}_0x2246b8[_0x581013(0x150)]=![],_0x2ee153?_0x2246b8[_0x581013(0x251)][_0x581013(0x2f2)](_0x581013(0x2dc)+(_0x37e30b||_0x2ee153[_0x581013(0x328)])):(_0x2246b8[_0x581013(0x251)][_0x581013(0x237)]('âœ…\x20AUTO-FIX\x20SUCCESS.'),startPythonService(_0x2246b8));});}function sendToPython(_0x543665,_0x19dd05,_0xdf61b7={}){const _0x4a0cb8=a0_0x4ee979;if(!_0x543665[_0x4a0cb8(0x1d0)]||!_0x543665['pythonProcess'][_0x4a0cb8(0x205)][_0x4a0cb8(0x246)])return;const _0xfe0491=JSON['stringify']({'command':_0x19dd05,..._0xdf61b7});try{_0x543665['pythonProcess'][_0x4a0cb8(0x205)][_0x4a0cb8(0x285)](_0xfe0491+'\x0a');}catch(_0x91461c){_0x543665[_0x4a0cb8(0x251)]['error'](_0x4a0cb8(0x26b)+_0x91461c[_0x4a0cb8(0x328)]);}}function runPythonHealthCheck(_0x1d083c){const _0x51ae9e=a0_0x4ee979;if(!_0x1d083c[_0x51ae9e(0x319)]||_0x1d083c[_0x51ae9e(0x319)]['length']<0x2)return;const _0x568cf5=_0x1d083c[_0x51ae9e(0x319)][_0x51ae9e(0x26e)](_0x1a8252=>{const _0x500327=_0x51ae9e,_0x1ec56f=(_0x1a8252['activityLevel']||'')[_0x500327(0x2ca)]();return ACTIVITY_LEVEL_MAP[_0x1ec56f]||0x32;});_0x1d083c[_0x51ae9e(0x251)][_0x51ae9e(0x237)](_0x51ae9e(0x136)+_0x568cf5[_0x51ae9e(0x1ba)]+_0x51ae9e(0x1db)),sendToPython(_0x1d083c,'ANALYZE_TREND',{'values':_0x568cf5,'tag':_0x51ae9e(0x2c2)});}function handlePythonResult(_0x1bbee9,_0xc72ac4){const _0x2ee302=a0_0x4ee979;if(_0xc72ac4['type']==='PONG')_0x1bbee9[_0x2ee302(0x251)][_0x2ee302(0x2d5)]('ðŸ\x20Python\x20Pong\x20received!');else{if(_0xc72ac4[_0x2ee302(0x114)]===_0x2ee302(0x23d)){const {tag:_0x12c96e,diagnosis:_0x3f3a69,change_percent:_0x1fe1aa}=_0xc72ac4[_0x2ee302(0x132)];_0x1bbee9[_0x2ee302(0x251)]['info'](_0x2ee302(0x15f)+_0x12c96e+_0x2ee302(0x17b)+_0x3f3a69+'\x20('+_0x1fe1aa+'%)'),_0x1bbee9[_0x2ee302(0x2bb)](_0x2ee302(0x1b2),{'val':_0x3f3a69,'ack':!![]}),_0x1bbee9['setStateAsync']('analysis.health.trendValue',{'val':_0x1fe1aa,'ack':!![]});}else{if(_0xc72ac4['type']===_0x2ee302(0x24b)){const {success:_0x5c392e,details:_0x552ecd}=_0xc72ac4[_0x2ee302(0x132)];_0x5c392e?(_0x1bbee9[_0x2ee302(0x251)][_0x2ee302(0x237)](_0x2ee302(0x22b)+_0x552ecd),_0x1bbee9['setStateAsync'](_0x2ee302(0x24c),{'val':_0x2ee302(0x1c1)+new Date()[_0x2ee302(0x2e3)]()+'\x20('+_0x552ecd+')','ack':!![]})):(_0x1bbee9[_0x2ee302(0x251)][_0x2ee302(0x2f2)]('âŒ\x20Training\x20failed:\x20'+(_0x552ecd||_0x2ee302(0x13a))),_0x1bbee9[_0x2ee302(0x2bb)](_0x2ee302(0x24c),{'val':_0x2ee302(0x317)+_0x552ecd,'ack':!![]}));}else{if(_0xc72ac4['type']==='HEALTH_TRAIN_RESULT'){const {success:_0x30d74a,details:_0x507b58}=_0xc72ac4['payload'];if(_0x30d74a)_0x1bbee9[_0x2ee302(0x251)][_0x2ee302(0x237)](_0x2ee302(0x195)+_0x507b58);else _0x1bbee9[_0x2ee302(0x251)]['error'](_0x2ee302(0x2d7)+_0x507b58);}else{if(_0xc72ac4['type']===_0x2ee302(0x111)){const {is_anomaly:_0x3b1f1e,details:_0x2e2967}=_0xc72ac4['payload'];_0x1bbee9[_0x2ee302(0x2bb)](_0x2ee302(0x1c4),{'val':new Date()['toISOString'](),'ack':!![]}),_0x1bbee9[_0x2ee302(0x2bb)](_0x2ee302(0x25d),{'val':_0x3b1f1e,'ack':!![]});if(_0x3b1f1e)_0x1bbee9[_0x2ee302(0x251)][_0x2ee302(0x189)](_0x2ee302(0x22d)+_0x2e2967);}else{if(_0xc72ac4['type']===_0x2ee302(0x188)){const {success:_0x3bd75d,details:_0x2a3460}=_0xc72ac4[_0x2ee302(0x132)];_0x3bd75d?(_0x1bbee9[_0x2ee302(0x251)][_0x2ee302(0x237)](_0x2ee302(0x273)+_0x2a3460),_0x1bbee9['setStateAsync'](_0x2ee302(0x233),{'val':_0x2a3460,'ack':!![]})):_0x1bbee9['log']['error'](_0x2ee302(0x249)+_0x2a3460);}else{if(_0xc72ac4[_0x2ee302(0x114)]===_0x2ee302(0x215)){const {anomaly_score:_0x29457e,is_anomaly:_0x1c1257,threshold:_0x428217}=_0xc72ac4[_0x2ee302(0x132)];_0x1bbee9[_0x2ee302(0x251)]['info'](_0x2ee302(0x282)+_0x29457e[_0x2ee302(0x26d)](0x5)+'\x20(Threshold:\x20'+_0x428217+_0x2ee302(0x260)+(_0x1c1257?_0x2ee302(0x27f):'OK')),_0x1bbee9['setStateAsync'](_0x2ee302(0x318),{'val':_0x29457e,'ack':!![]}),_0x1bbee9['setStateAsync'](_0x2ee302(0x211),{'val':new Date()[_0x2ee302(0x135)](),'ack':!![]});if(_0x1c1257){const _0x279eba=_0x2ee302(0x19f)+_0x29457e[_0x2ee302(0x26d)](0x4)+')';_0x1bbee9['setStateAsync']('analysis.isAlert',{'val':!![],'ack':!![]}),_0x1bbee9[_0x2ee302(0x2bb)](_0x2ee302(0x110),{'val':_0x279eba,'ack':!![]}),sendNotification(_0x1bbee9,_0x2ee302(0x2a4)+_0x279eba,![],!![]);}}}}}}}}}function startPythonService(_0x5a6c10){const _0x80a4d7=a0_0x4ee979;try{const _0x4dcae9=path[_0x80a4d7(0x315)](__dirname,'python_service',_0x80a4d7(0x27c));_0x5a6c10['log'][_0x80a4d7(0x237)](_0x80a4d7(0x2f9)+_0x4dcae9),_0x5a6c10[_0x80a4d7(0x1d0)]=spawn('python3',[_0x4dcae9]),_0x5a6c10[_0x80a4d7(0x1d0)]['stdout']['on'](_0x80a4d7(0x23c),_0x5a09b4=>{const _0x3cc4f1=_0x80a4d7,_0x375ed4=_0x5a09b4[_0x3cc4f1(0x1a9)]()['split']('\x0a');_0x375ed4[_0x3cc4f1(0x2ac)](_0x2fa665=>{const _0x5e0f13=_0x3cc4f1,_0x66a401=_0x2fa665[_0x5e0f13(0x116)]();if(!_0x66a401)return;if(_0x66a401[_0x5e0f13(0x2db)](_0x5e0f13(0x28c)))_0x5a6c10[_0x5e0f13(0x251)]['debug']('[PYTHON]\x20'+_0x66a401[_0x5e0f13(0x2e8)](0x5)[_0x5e0f13(0x116)]());else{if(_0x66a401['startsWith'](_0x5e0f13(0x109)))try{const _0x55fb73=JSON[_0x5e0f13(0x113)](_0x66a401[_0x5e0f13(0x2e8)](0x8)[_0x5e0f13(0x116)]());handlePythonResult(_0x5a6c10,_0x55fb73);}catch(_0x32f6fb){_0x5a6c10['log'][_0x5e0f13(0x189)](_0x5e0f13(0x290)+_0x66a401);}}(_0x66a401[_0x5e0f13(0x228)]('No\x20module\x20named')||_0x66a401[_0x5e0f13(0x228)]('Bibliotheken\x20nicht\x20gefunden'))&&(_0x5a6c10[_0x5e0f13(0x251)][_0x5e0f13(0x189)](_0x5e0f13(0x2b3)),installPythonDependencies(_0x5a6c10));});}),_0x5a6c10[_0x80a4d7(0x1d0)][_0x80a4d7(0x266)]['on'](_0x80a4d7(0x23c),_0x4b8bff=>{const _0x1b9999=_0x80a4d7,_0xbb0aee=_0x4b8bff[_0x1b9999(0x1a9)]()['trim']();_0x5a6c10['log']['error'](_0x1b9999(0x2ad)+_0xbb0aee);}),_0x5a6c10[_0x80a4d7(0x1d0)]['on']('close',_0x3d4fb3=>{const _0x26eaac=_0x80a4d7;_0x5a6c10[_0x26eaac(0x251)][_0x26eaac(0x237)](_0x26eaac(0x2d0)+_0x3d4fb3),_0x5a6c10[_0x26eaac(0x1d0)]=null;}),_0x5a6c10[_0x80a4d7(0x1d0)]['on']('error',_0x569082=>{const _0x719cbc=_0x80a4d7;_0x5a6c10[_0x719cbc(0x251)]['warn'](_0x719cbc(0x274)+_0x569082[_0x719cbc(0x328)]);});}catch(_0x1e1fcb){_0x5a6c10[_0x80a4d7(0x251)][_0x80a4d7(0x2f2)](_0x80a4d7(0x2df)+_0x1e1fcb[_0x80a4d7(0x328)]);}}function stopPythonService(_0x2f3a73){const _0x42bc95=a0_0x4ee979;if(_0x2f3a73[_0x42bc95(0x1d0)]){_0x2f3a73[_0x42bc95(0x251)][_0x42bc95(0x237)](_0x42bc95(0x222));try{_0x2f3a73[_0x42bc95(0x1d0)][_0x42bc95(0x2b6)]();}catch(_0x20e715){_0x2f3a73['log'][_0x42bc95(0x189)]('Could\x20not\x20kill\x20Python\x20process:\x20'+_0x20e715[_0x42bc95(0x328)]);}_0x2f3a73[_0x42bc95(0x1d0)]=null;}}class CogniLiving extends utils[a0_0x4ee979(0x130)]{constructor(_0x51861b){const _0x157e45=a0_0x4ee979;super({..._0x51861b,'name':'cogni-living'}),this[_0x157e45(0x10f)]=[],this[_0x157e45(0x305)]=[],this[_0x157e45(0x258)]=[],this[_0x157e45(0x19c)]=[],this[_0x157e45(0x319)]=[],this[_0x157e45(0x2aa)]={},this['systemConfig']={'latitude':0x0,'longitude':0x0,'city':''},this[_0x157e45(0x24e)]=!![],this[_0x157e45(0x1ad)]=null,this[_0x157e45(0x212)]=null,this[_0x157e45(0x286)]=![],this[_0x157e45(0x24d)]=null,this[_0x157e45(0x2af)]=null,this['currentSystemMode']=SYSTEM_MODES[_0x157e45(0x1b0)],this['isProVersion']=![],this['lastAlertState']=![],this[_0x157e45(0x268)]=_0x157e45(0x15c),this[_0x157e45(0x15e)]=null,this[_0x157e45(0x178)]=null,this['modeResetJob']=null,this[_0x157e45(0x18f)]=null,this[_0x157e45(0x145)]=null,this['pythonProcess']=null,this[_0x157e45(0x150)]=![],this['on'](_0x157e45(0x28d),this['onReady'][_0x157e45(0x18a)](this)),this['on'](_0x157e45(0x2ba),this[_0x157e45(0x1b4)][_0x157e45(0x18a)](this)),this['on']('unload',this['onUnload']['bind'](this)),this['on'](_0x157e45(0x328),this[_0x157e45(0x179)][_0x157e45(0x18a)](this));}async[a0_0x4ee979(0x304)](){const _0x533ec3=a0_0x4ee979;this[_0x533ec3(0x251)][_0x533ec3(0x237)](_0x533ec3(0x20b)+this[_0x533ec3(0x14f)]+')'),await initZombies(this),this[_0x533ec3(0x14e)][_0x533ec3(0x2ce)]=this[_0x533ec3(0x14e)][_0x533ec3(0x2ce)]||'';try{this[_0x533ec3(0x1c8)]=await checkLicense(this,this[_0x533ec3(0x14e)]['licenseKey']);}catch(_0x5ad1c0){}if(!this[_0x533ec3(0x14e)][_0x533ec3(0x1d8)]||this['config'][_0x533ec3(0x1d8)]<0.1)this[_0x533ec3(0x14e)][_0x533ec3(0x1d8)]=0xc;await initHistory(this),await initSystemConfig(this);if(this[_0x533ec3(0x14e)][_0x533ec3(0x2d8)])try{this[_0x533ec3(0x24d)]=new GoogleGenerativeAI(this[_0x533ec3(0x14e)][_0x533ec3(0x2d8)]),this[_0x533ec3(0x2af)]=this['genAI'][_0x533ec3(0x21f)]({'model':GEMINI_MODEL,'generationConfig':{'responseMimeType':_0x533ec3(0x1c0)}}),this['log'][_0x533ec3(0x237)]('Gemini\x20AI\x20initialized.');}catch(_0x13baa1){this[_0x533ec3(0x251)][_0x533ec3(0x2f2)](_0x533ec3(0x229)+_0x13baa1[_0x533ec3(0x328)]);}await createAllObjects(this),await loadSystemMode(this),await loadRawEventLog(this),await loadDailyDigests(this),this[_0x533ec3(0x2d2)]('analysis.trigger'),this[_0x533ec3(0x2d2)](LTM_DP_TRIGGER_DIGEST),this[_0x533ec3(0x2d2)](_0x533ec3(0x2a7)),this[_0x533ec3(0x2d2)](_0x533ec3(0x18e)),this[_0x533ec3(0x2d2)](_0x533ec3(0x2f0)),this[_0x533ec3(0x2d2)]('analysis.automation.autoApply'),this[_0x533ec3(0x2d2)](_0x533ec3(0x19b)),this[_0x533ec3(0x2d2)](_0x533ec3(0x184)),this[_0x533ec3(0x2d2)](_0x533ec3(0x25c)),await initSensorSubscriptions(this),await initPresenceSubscriptions(this),await setupTelegramListener(this),setTimeout(()=>checkWifiPresence(this),0x1388);if(this['analysisTimer'])clearInterval(this[_0x533ec3(0x15e)]);const _0x3060bf=this[_0x533ec3(0x14e)][_0x533ec3(0x29a)]||0xf;_0x3060bf>0x0&&(this[_0x533ec3(0x15e)]=setInterval(()=>{runAutopilot(this);},_0x3060bf*0x3c*0x3e8)),setupLtmScheduler(this),setupModeResetScheduler(this),setupDriftAnalysisScheduler(this),setupBriefingScheduler(this),startPythonService(this),setTimeout(()=>{const _0x34832d=_0x533ec3;if(this[_0x34832d(0x1d0)])runPythonHealthCheck(this);},0x1388);}['onUnload'](_0x49d722){const _0x666f65=a0_0x4ee979;if(this[_0x666f65(0x15e)])clearInterval(this[_0x666f65(0x15e)]);if(this[_0x666f65(0x18f)])clearInterval(this[_0x666f65(0x18f)]);if(this[_0x666f65(0x178)])this[_0x666f65(0x178)][_0x666f65(0x157)]();if(this[_0x666f65(0x19e)])this[_0x666f65(0x19e)][_0x666f65(0x157)]();if(this[_0x666f65(0x145)])this['briefingJob'][_0x666f65(0x157)]();if(this[_0x666f65(0x1ad)])clearTimeout(this[_0x666f65(0x1ad)]);if(this['exitGraceTimer'])clearTimeout(this[_0x666f65(0x212)]);stopPythonService(this),_0x49d722();}async[a0_0x4ee979(0x1b4)](_0x33550c,_0x22208a){const _0x597d04=a0_0x4ee979;if(!_0x22208a)return;if(_0x33550c[_0x597d04(0x228)](_0x597d04(0x1b8))&&_0x33550c[_0x597d04(0x210)](_0x597d04(0x19a))&&_0x22208a['val']){await handleTelegramResponse(this,_0x22208a[_0x597d04(0x2e6)]);return;}if(_0x33550c===this['namespace']+'.'+SYSTEM_DP_MODE){if(_0x22208a[_0x597d04(0x2e6)]&&Object['values'](SYSTEM_MODES)[_0x597d04(0x228)](_0x22208a[_0x597d04(0x2e6)])){this[_0x597d04(0x1d4)]=_0x22208a['val'];if(_0x22208a['val']===SYSTEM_MODES['VACATION'])await setPresence(this,![]);else await setPresence(this,!![]);}if(!_0x22208a['ack'])this[_0x597d04(0x1e1)](_0x33550c,{'val':this['currentSystemMode'],'ack':!![]});return;}if(!_0x22208a[_0x597d04(0x2e2)]){_0x33550c[_0x597d04(0x228)](_0x597d04(0x2d6))&&_0x22208a[_0x597d04(0x2e6)]&&(this[_0x597d04(0x1e1)](_0x33550c,{'val':![],'ack':!![]}),runGeminiAnalysis(this));if(_0x33550c[_0x597d04(0x228)]('triggerDailyDigest')&&_0x22208a[_0x597d04(0x2e6)]){this[_0x597d04(0x1e1)](_0x33550c,{'val':![],'ack':!![]});if(this[_0x597d04(0x1c8)])createDailyDigest(this);}_0x33550c[_0x597d04(0x228)](_0x597d04(0x1dd))&&_0x22208a['val']&&(this[_0x597d04(0x1e1)](_0x33550c,{'val':![],'ack':!![]}),sendMorningBriefing(this));_0x33550c[_0x597d04(0x228)](_0x597d04(0x1f1))&&_0x22208a[_0x597d04(0x2e6)]&&(this[_0x597d04(0x1e1)](_0x33550c,{'val':![],'ack':!![]}),executeAutomationAction(this));if(_0x33550c[_0x597d04(0x228)](_0x597d04(0x19b))&&_0x22208a[_0x597d04(0x2e6)]){this[_0x597d04(0x1e1)](_0x33550c,{'val':![],'ack':!![]});if(!this[_0x597d04(0x1c8)])return;try{const _0x8a5759=await this[_0x597d04(0x231)](_0x597d04(0x227));if(_0x8a5759&&_0x8a5759['val']){const _0x607d49=JSON[_0x597d04(0x113)](_0x8a5759[_0x597d04(0x2e6)]);this['log'][_0x597d04(0x237)](_0x597d04(0x25e)),this[_0x597d04(0x2bb)]('analysis.training.status',{'val':'Sec-Training\x20started...','ack':!![]}),sendToPython(this,_0x597d04(0x1cb),{'sequences':_0x607d49});}}catch(_0xc80632){this[_0x597d04(0x251)]['error'](_0x597d04(0x31a)+_0xc80632[_0x597d04(0x328)]);}}if(_0x33550c['includes'](_0x597d04(0x184))&&_0x22208a[_0x597d04(0x2e6)]){this[_0x597d04(0x1e1)](_0x33550c,{'val':![],'ack':!![]});if(!this[_0x597d04(0x1c8)])return;try{const _0x3310bc=await this[_0x597d04(0x231)](LTM_DP_DAILY_DIGESTS);if(_0x3310bc&&_0x3310bc[_0x597d04(0x2e6)]){const _0x24bfa4=JSON['parse'](_0x3310bc['val']);this['log'][_0x597d04(0x237)](_0x597d04(0x323)),sendToPython(this,_0x597d04(0x234),{'digests':_0x24bfa4});}}catch(_0x409ffe){this[_0x597d04(0x251)][_0x597d04(0x2f2)](_0x597d04(0x13b)+_0x409ffe[_0x597d04(0x328)]);}}if(_0x33550c[_0x597d04(0x228)](_0x597d04(0x25c))&&_0x22208a[_0x597d04(0x2e6)]){this[_0x597d04(0x1e1)](_0x33550c,{'val':![],'ack':!![]});if(!this['isProVersion'])return;try{const _0x391d84=await this[_0x597d04(0x231)]('LTM.trainingData.thermodynamics');if(_0x391d84&&_0x391d84[_0x597d04(0x2e6)]){const _0x4e995d=JSON[_0x597d04(0x113)](_0x391d84[_0x597d04(0x2e6)]);this[_0x597d04(0x251)]['info']('ðŸƒ\x20Triggering\x20Energy\x20Training...'),sendToPython(this,'TRAIN_ENERGY',{'points':_0x4e995d});}}catch(_0x37df6e){this[_0x597d04(0x251)][_0x597d04(0x2f2)](_0x597d04(0x16f)+_0x37df6e['message']);}}return;}if(this[_0x597d04(0x14e)][_0x597d04(0x2b1)]&&this['config'][_0x597d04(0x2b1)][_0x597d04(0x228)](_0x33550c)){await checkWifiPresence(this);return;}const _0x1332ac=(this[_0x597d04(0x14e)][_0x597d04(0x1aa)]||[])['find'](_0x48ea1f=>_0x48ea1f['id']===_0x33550c);if(_0x1332ac)processSensorEvent(this,_0x33550c,_0x22208a,_0x1332ac);}async['onMessage'](_0x574a35){const _0x4c472c=a0_0x4ee979;if(typeof _0x574a35==='object'&&_0x574a35[_0x4c472c(0x328)])try{if(_0x574a35[_0x4c472c(0x17a)]===_0x4c472c(0x1c7)){const _0x2140d0=_0x574a35[_0x4c472c(0x328)][_0x4c472c(0x2a8)]||this[_0x4c472c(0x14e)][_0x4c472c(0x2d8)];if(!_0x2140d0)return this[_0x4c472c(0x175)](_0x574a35[_0x4c472c(0x1f0)],_0x574a35[_0x4c472c(0x17a)],{'success':![],'message':'Kein\x20API\x20Key\x20eingegeben.'},_0x574a35[_0x4c472c(0x2cf)]);try{const _0x5cc6e7=new GoogleGenerativeAI(_0x2140d0),_0x269877=_0x5cc6e7['getGenerativeModel']({'model':GEMINI_MODEL}),_0x1e06af=await _0x269877['generateContent'](_0x4c472c(0x17e)),_0x52a3f3=await _0x1e06af[_0x4c472c(0x1d9)],_0x5c9c4a=_0x52a3f3['text']();this[_0x4c472c(0x175)](_0x574a35[_0x4c472c(0x1f0)],_0x574a35[_0x4c472c(0x17a)],{'success':!![],'message':_0x4c472c(0x12d)+_0x5c9c4a[_0x4c472c(0x2e8)](0x0,0x14)+_0x4c472c(0x152)},_0x574a35['callback']);}catch(_0x445629){this[_0x4c472c(0x175)](_0x574a35[_0x4c472c(0x1f0)],_0x574a35[_0x4c472c(0x17a)],{'success':![],'message':'Fehler:\x20'+_0x445629[_0x4c472c(0x328)]},_0x574a35[_0x4c472c(0x2cf)]);}}else{if(_0x574a35[_0x4c472c(0x17a)]===_0x4c472c(0x316)){const _0x17eb4c=await getWeatherContext(this),_0x4d6e1a=await getCalendarContext(this);this[_0x4c472c(0x175)](_0x574a35['from'],_0x574a35[_0x4c472c(0x17a)],{'success':!![],'weather':_0x17eb4c,'calendar':_0x4d6e1a},_0x574a35[_0x4c472c(0x2cf)]);}else{if(_0x574a35[_0x4c472c(0x17a)]===_0x4c472c(0x18b)){}else{if(_0x574a35[_0x4c472c(0x17a)]===_0x4c472c(0x1a4)){if(!this['isProVersion'])return this['sendTo'](_0x574a35[_0x4c472c(0x1f0)],_0x574a35[_0x4c472c(0x17a)],{'success':![],'isPro':![]},_0x574a35[_0x4c472c(0x2cf)]);let _0x14fc53={'status':'N/A','details':'','lastCheck':0x0};try{_0x14fc53[_0x4c472c(0x1c3)]=(await this['getStateAsync'](LTM_DP_DRIFT_STATUS))['val'],_0x14fc53[_0x4c472c(0x2ef)]=(await this[_0x4c472c(0x231)](LTM_DP_DRIFT_DETAILS))[_0x4c472c(0x2e6)],_0x14fc53[_0x4c472c(0x16b)]=(await this[_0x4c472c(0x231)](LTM_DP_DRIFT_LAST_CHECK))[_0x4c472c(0x2e6)];}catch(_0x1224a1){}const _0x3d7219=this[_0x4c472c(0x305)]||[];this['sendTo'](_0x574a35[_0x4c472c(0x1f0)],_0x574a35[_0x4c472c(0x17a)],{'success':!![],'isPro':!![],'dailyDigests':this[_0x4c472c(0x319)],'driftAnalysis':_0x14fc53,'analysisHistory':_0x3d7219},_0x574a35[_0x4c472c(0x2cf)]);}else{if(_0x574a35[_0x4c472c(0x17a)]===_0x4c472c(0x2a0)){const _0x280f86=this[_0x4c472c(0x319)][_0x4c472c(0x1ba)],_0x1fc419=new Date(),_0x265cd7=new Date(_0x1fc419['getFullYear'](),_0x1fc419[_0x4c472c(0x2f8)](),_0x1fc419['getDate']())['getTime'](),_0x44c910=this[_0x4c472c(0x19c)][_0x4c472c(0x224)](_0x5e476d=>new Date(_0x5e476d[_0x4c472c(0x1f7)])[_0x4c472c(0x2e1)]()>_0x265cd7)['length'],_0x320dec=new Array(0x18)[_0x4c472c(0x32a)](0x0);this[_0x4c472c(0x19c)][_0x4c472c(0x2ac)](_0x4b1275=>{const _0x46bbcb=_0x4c472c,_0x290874=new Date(_0x4b1275[_0x46bbcb(0x1f7)]);if(_0x290874[_0x46bbcb(0x2e1)]()>_0x265cd7)_0x320dec[_0x290874[_0x46bbcb(0x146)]()]++;});let _0x8c122d={'status':_0x4c472c(0x241)};try{_0x8c122d[_0x4c472c(0x1c3)]=(await this['getStateAsync'](LTM_DP_DRIFT_STATUS))[_0x4c472c(0x2e6)];}catch(_0x3c21da){}let _0x501545='';try{const _0x4ebe86=await this['getStateAsync']('system.presenceWho');_0x501545=_0x4ebe86?_0x4ebe86[_0x4c472c(0x2e6)]:'';}catch(_0x21dd40){}let _0x2a660e=null;!this[_0x4c472c(0x2af)]&&(_0x2a660e=this[_0x4c472c(0x14e)][_0x4c472c(0x2d8)]?_0x4c472c(0x2a1):_0x4c472c(0x283));let _0x3e4e13={'detected':![],'description':'','targetId':'','targetValue':'','autoApply':![]};try{const _0x266a42=await this[_0x4c472c(0x231)](_0x4c472c(0x206)),_0x3cb111=await this[_0x4c472c(0x231)](_0x4c472c(0x30f)),_0x2f6c71=await this[_0x4c472c(0x231)]('analysis.automation.targetId'),_0x2e9277=await this[_0x4c472c(0x231)](_0x4c472c(0x242)),_0x4312e8=await this['getStateAsync'](_0x4c472c(0x160));_0x266a42&&_0x266a42[_0x4c472c(0x2e6)]&&(_0x3e4e13[_0x4c472c(0x174)]=!![],_0x3e4e13['description']=_0x3cb111?_0x3cb111['val']:'',_0x3e4e13[_0x4c472c(0x311)]=_0x2f6c71?_0x2f6c71[_0x4c472c(0x2e6)]:'',_0x3e4e13[_0x4c472c(0x1c9)]=_0x2e9277?_0x2e9277[_0x4c472c(0x2e6)]:''),_0x3e4e13[_0x4c472c(0x137)]=_0x4312e8?!!_0x4312e8[_0x4c472c(0x2e6)]:![];}catch(_0x45e929){}this['sendTo'](_0x574a35[_0x4c472c(0x1f0)],_0x574a35[_0x4c472c(0x17a)],{'success':!![],'eventHistory':this['eventHistory'][_0x4c472c(0x126)](0x0,0xf),'stats':{'digestCount':_0x280f86,'eventCountToday':_0x44c910,'hourlyActivity':_0x320dec,'driftStatus':_0x8c122d[_0x4c472c(0x1c3)],'isPresent':this[_0x4c472c(0x24e)],'presenceWho':_0x501545,'minDays':this[_0x4c472c(0x14e)][_0x4c472c(0x139)]||0x7,'stbDays':this[_0x4c472c(0x14e)][_0x4c472c(0x2cb)]||0xe,'ltbDays':this[_0x4c472c(0x14e)][_0x4c472c(0x1a0)]||0x3c,'systemError':_0x2a660e},'automation':_0x3e4e13},_0x574a35[_0x4c472c(0x2cf)]);}else{if(_0x574a35[_0x4c472c(0x17a)]===_0x4c472c(0x16d)){const _0x55c204=await this[_0x4c472c(0x27b)]('enum.functions.*','enum'),_0x45596d=[];if(_0x55c204)for(const _0x5d63b4 in _0x55c204){const _0x46651a=_0x55c204[_0x5d63b4],_0x1b5804=(_0x46651a[_0x4c472c(0x2fe)]&&typeof _0x46651a[_0x4c472c(0x2fe)]['name']===_0x4c472c(0x151)?_0x46651a['common']['name']['de']:_0x46651a['common']['name'])||_0x46651a[_0x4c472c(0x2fe)][_0x4c472c(0x226)];_0x45596d['push']({'id':_0x5d63b4,'name':_0x1b5804});}this[_0x4c472c(0x175)](_0x574a35[_0x4c472c(0x1f0)],_0x574a35[_0x4c472c(0x17a)],{'success':!![],'enums':_0x45596d},_0x574a35[_0x4c472c(0x2cf)]);}else{if(_0x574a35[_0x4c472c(0x17a)]==='scanDevices')try{const _0x5be90e=await scanForDevices(this,_0x574a35[_0x4c472c(0x328)]||{});this[_0x4c472c(0x175)](_0x574a35[_0x4c472c(0x1f0)],_0x574a35[_0x4c472c(0x17a)],{'success':!![],'devices':_0x5be90e},_0x574a35['callback']);}catch(_0x5eacb7){this[_0x4c472c(0x175)](_0x574a35[_0x4c472c(0x1f0)],_0x574a35[_0x4c472c(0x17a)],{'success':![],'error':_0x5eacb7[_0x4c472c(0x328)]},_0x574a35[_0x4c472c(0x2cf)]);}else{if(_0x574a35[_0x4c472c(0x17a)]==='getCalendarNames'){const _0x1c30b3=_0x574a35[_0x4c472c(0x328)][_0x4c472c(0x12a)];if(!_0x1c30b3)return this[_0x4c472c(0x175)](_0x574a35[_0x4c472c(0x1f0)],_0x574a35[_0x4c472c(0x17a)],{'success':![],'error':_0x4c472c(0x232)},_0x574a35[_0x4c472c(0x2cf)]);const _0x540525=await getCalendarNames(this,_0x1c30b3);this[_0x4c472c(0x175)](_0x574a35[_0x4c472c(0x1f0)],_0x574a35[_0x4c472c(0x17a)],{'success':!![],'names':_0x540525},_0x574a35[_0x4c472c(0x2cf)]);}else{if(_0x574a35[_0x4c472c(0x17a)]===_0x4c472c(0x2b9)){const {targetId:_0x56e854,targetValue:_0xe5a062}=_0x574a35[_0x4c472c(0x328)];this[_0x4c472c(0x251)][_0x4c472c(0x237)](_0x4c472c(0x121)+_0x56e854+_0x4c472c(0x2c5)+_0xe5a062),await this[_0x4c472c(0x2bb)]('analysis.automation.patternDetected',{'val':!![],'ack':!![]}),await this[_0x4c472c(0x2bb)](_0x4c472c(0x30f),{'val':_0x4c472c(0x13e)+_0x56e854,'ack':!![]}),await this['setStateAsync']('analysis.automation.targetId',{'val':_0x56e854,'ack':!![]}),await this[_0x4c472c(0x2bb)](_0x4c472c(0x242),{'val':_0xe5a062,'ack':!![]}),this[_0x4c472c(0x175)](_0x574a35['from'],_0x574a35[_0x4c472c(0x17a)],{'success':!![]},_0x574a35[_0x4c472c(0x2cf)]);}else{if(_0x574a35[_0x4c472c(0x17a)]===_0x4c472c(0x2a9)){const {historyId:_0x1c0748,rating:_0x2a0100,comment:_0x5e0f5e,alertReason:_0x4b7603}=_0x574a35[_0x4c472c(0x328)];_0x1c0748&&_0x2a0100?(await saveFeedback(this,{'timestamp':Date[_0x4c472c(0x2ee)](),'historyId':_0x1c0748,'rating':_0x2a0100,'comment':_0x5e0f5e,'alertReason':_0x4b7603}),this[_0x4c472c(0x175)](_0x574a35[_0x4c472c(0x1f0)],_0x574a35[_0x4c472c(0x17a)],{'success':!![]},_0x574a35[_0x4c472c(0x2cf)])):this['sendTo'](_0x574a35[_0x4c472c(0x1f0)],_0x574a35['command'],{'success':![],'error':_0x4c472c(0x2c8)},_0x574a35[_0x4c472c(0x2cf)]);}else _0x574a35['command']==='dismissAutomation'&&(this['log'][_0x4c472c(0x237)]('User\x20dismissed\x20automation\x20proposal.'),await this[_0x4c472c(0x2bb)](_0x4c472c(0x206),{'val':![],'ack':!![]}),await this['setStateAsync'](_0x4c472c(0x30f),{'val':'','ack':!![]}),this[_0x4c472c(0x175)](_0x574a35['from'],_0x574a35['command'],{'success':!![]},_0x574a35['callback']));}}}}}}}}}}catch(_0x3df55e){this[_0x4c472c(0x251)]['error'](_0x4c472c(0x29c)+_0x574a35[_0x4c472c(0x17a)]+':\x20'+_0x3df55e['message']);if(_0x574a35[_0x4c472c(0x2cf)])this['sendTo'](_0x574a35[_0x4c472c(0x1f0)],_0x574a35[_0x4c472c(0x17a)],{'success':![],'error':_0x3df55e['message']},_0x574a35[_0x4c472c(0x2cf)]);}}}function a0_0x3a49(){const _0x361715=['systemUUID','rssi','Briefing\x20Sched\x20Error:\x20','Failed\x20to\x20send\x20to\x20Python:\x20','city','toFixed','map','lock','LTM.driftAnalysis.lastCheck','push','weatherunderground','âœ…\x20ENERGY\x20MODEL\x20TRAINED!\x20','[PYTHON]\x20Failed\x20to\x20start:\x20','fenster','Deaktiviert\x20(Pro-Feature)','ROLLE:\x20KI-Hausverwalter\x20&\x20Gesundheits-Assistent.\x20PERSONA:\x20','9zvJTcD','WETTER:\x20Keine\x20Daten\x20gefunden','dimmer','getForeignObjectsAsync','service.py','Unbekannt','some','ANOMALY','_score','outdoorSensorId','ðŸ›¡ï¸\x20SECURITY\x20CHECK:\x20Score\x20','Kein\x20API\x20Key!','ical.0','write','isGracePeriodActive','Daily\x20Digests','analysis.automation.targetId','sleepScore','ðŸ“ž\x20User\x20requested\x20CALL\x20via\x20Telegram!','PRIORITÃ„T:\x20Gesundheit/AAL.','[LOG]','ready','ANALYZE_SEQUENCE','\x27\x20not\x20in\x20allowed\x20list)','Invalid\x20JSON\x20from\x20Python:\x20','uuid','Sleep\x20Score\x20(0-100)','replace','members','sensor','siren','events.history_debug_00','08:00','notifyEmailInstance','analysisInterval','Drift\x20Analysis','Error\x20in\x20onMessage\x20command\x20','weatherunderground.0','events.lastEvent','LTM.rawEventLog','getOverviewData','KI-Modell\x20nicht\x20initialisiert','send','âš ï¸\x20PIP\x20is\x20missing.\x20Attempting\x20self-healing...','âš ï¸\x20SECURITY\x20ALARM:\x20','value','Keine\x20Analyse.','system.mode','apiKey','submitFeedback','sensorLastValues','notifyTelegramEnabled','forEach','[PYTHON\x20ERR]\x20','âŒ\x20CRITICAL:\x20Self-healing\x20failed.','geminiModel','health','presenceDevices','constructor','âš ï¸\x20Python\x20missing\x20dependencies.\x20Triggering\x20Auto-Install...','scriptProblem','KALENDER:\x20Keine\x20Daten','kill','Unknown','Health\x20Notes','simulateButler','stateChange','setStateAsync','blind','analysis.health.notes','Wetter:\x20Deaktiviert','AI\x20Training\x20Control','generateContent','events.history','Activity-Level','ROLLE:\x20FÃ¼rsorglicher\x20Assistent.\x20AUFGABE:\x20Schreibe\x20eine\x20kurze,\x20beruhigende\x20\x22Guten\x20Morgen\x22-Nachricht.\x20PERSONA:\x20','.Summary.Current','\x20=\x20','Target\x20ID','Logbook','Missing\x20data','info.','toLowerCase','ltmStbWindowDays','lastAlertState','doors','licenseKey','callback','[PYTHON]\x20Service\x20exited\x20with\x20code\x20','Lernphase\x20(','subscribeStates','python3\x20-m\x20pip\x20install\x20-r\x20\x22','daswetter.0','debug','analysis.trigger','âŒ\x20Health\x20Training\x20Failed:\x20','geminiApiKey','analysis.deviationFromBaseline','Live\x20Security\x20Monitor','startsWith','âŒ\x20AUTO-FIX\x20FAILED:\x20','aiPersona','notifyTelegramInstance','Error\x20launching\x20Python\x20service:\x20','guest','getTime','ack','toLocaleTimeString','analysis.history_debug_00','uuid-not-found','val','.Current.Temperature','substring','expire','alertReason','update','.communicate.request','number','now','details','analysis.automation.triggerAction','N/A\x20(Learning)','error','Last\x20Result','analysis.analysisHistory','analysis.health.restlessness','2560eeSVGV','Restlessness\x20Level','getMonth','ðŸ\x20Starting\x20Python\x20Sidecar:\x20','analysis.automation','location','Reset\x20Sched\x20Error:\x20','simple-api.','common','ðŸ“ž\x20RÃ¼ckruf\x20anfordern','0\x204\x20*\x20*\x20*','4494856nyCoIp','system.isPresent','KALENDER\x20ERROR:\x20','onReady','analysisHistory','analysis.health.sleepScore','âœ…\x20SUCCESS.\x20Dependencies\x20installed.','Feedback\x20Log','ltmDriftCheckIntervalHours','catch','.\x20ANWESENHEITS_STATUS:\x20','âœ…\x20PIP\x20bootstrapped.\x20Retrying\x20installation...','config_pending','split','analysis.automation.description','4278QXSHIF','targetId','.forecast.current.state','\x20presence\x20devices...','models/gemini-flash-latest','join','testContext','Failed:\x20','analysis.security.lastScore','dailyDigests','Training\x20Error:\x20','\x20|\x20','analysis.energy','weather','loc','Alert\x20Reason','value.health','Trigger\x20Action\x20Now','Correlation\x20between\x20Inside\x20Temp,\x20Outside\x20Temp\x20and\x20Time','ðŸ©º\x20Triggering\x20Health\x20Training...','inactivityMonitoringEnabled','custom','baselineDrift','.\x20WETTER:\x20','message','prÃ¤senz','fill','lastIndexOf','\x20hours.\x20Potential\x20incapacitation.','âœ…\x20Alarm\x20quittiert.\x20System\x20normal.','Cogni-Living','[RESULT]','isAlert','icons-mfd.','âŒ\x20Installation\x20failed:\x20','ROLLE:\x20Data\x20Scientist.\x20ZIEL:\x20Drift\x20erkennen.\x20SCHEMA:\x20{\x20\x22baselineDrift\x22:\x20\x22none|slight|significant|critical\x22,\x20\x22driftDetails\x22:\x20\x22string\x22\x20}\x0a\x0aLTB:\x20','\x20AUFGABE:\x201.\x20Analysiere\x20auf\x20Gesundheitsrisiken.\x202.\x20Analysiere\x20auf\x20Komfort.\x20FORMAT\x20(JSON\x20Only):\x20{\x20\x22isAlert\x22:\x20boolean,\x20\x22alertReason\x22:\x20\x22string\x22,\x20\x22isEmergency\x22:\x20boolean,\x20\x22summary\x22:\x20\x22string\x22,\x20\x22automationProposal\x22:\x20{\x20\x22detected\x22:\x20boolean,\x20\x22description\x22:\x20\x22string\x22,\x20\x22targetId\x22:\x20\x22string\x22,\x20\x22targetValue\x22:\x20\x22any\x22\x20}\x20}','eventHistory','analysis.alertReason','HEALTH_RESULT','Action','parse','type','[RECORDER]\x20Added\x20step\x20to\x20sequence:\x20','trim','isArray','notifyPushoverInstance','/100,\x20AktivitÃ¤t\x20seit\x2004:00:\x20','Last\x20Check','delObjectAsync','temperature','âš ï¸\x20ALARM:\x20','setpoint','LTM.driftAnalysis','set_temperature','ðŸ§ª\x20Simulating\x20Butler\x20Proposal:\x20','livingContext','getForeignStateAsync','Gast','Trend\x20Value\x20(%)','slice','dutycycle','\x20events)...','\x20*\x20*\x20*','instance','Fokus\x20auf\x20Komfort.','\x20(Type\x20\x27','Verbindung\x20erfolgreich!\x20Antwort:\x20','unshift','uuid-error','Adapter','scriptEnabled','payload','energy','openweathermap.0','toISOString','Guardian:\x20Sending\x20','autoApply','Error\x20checking\x20WiFi:\x20','minDaysForBaseline','Unknown\x20error','Health\x20Train\x20Error:\x20','System\x20Mode','Recorded\x20Motion\x20Sequences','SIMULATION:\x20Test-Vorschlag\x20fÃ¼r\x20','toLocaleString','boolean','event','system.','daswetter','LTM.driftAnalysis.driftDetails','briefingJob','getHours','(((.+)+)+)+$','Drift\x20Sched\x20Error:\x20','VACATION','[RECORDER]\x20Discarding\x20short\x20sequence\x20(Length:\x20','Keiner','vis.','Party','config','version','dependencyInstallInProgress','object','...','notifyTelegramRecipient','lowbat','LTM.trainingData.thermodynamics','setForeignStateAsync','cancel','Success:\x20Compressed\x20','accuweather.0','kontakt','json','unknown','party','analysisTimer','ðŸ\x20Guardian\x20Diagnosis\x20(','analysis.automation.autoApply','\x20events','LTM.trainingData','notifyPushoverEnabled','Feedback\x20saved:\x20','child_process','Energy\x20Intelligence','python3\x20-m\x20ensurepip\x20--default-pip\x20--user','\x20Tage)','analysis.isAlert','link_quality','lastCheck','indexOf','getEnums','analysis.activitySummary','Energy\x20Train\x20Error:\x20','Comfort\x20Summary','contact','string','getForeignObjectAsync','detected','sendTo','door','native','ltmJob','onMessage','command','):\x20','.data.table','thermostat','Say\x20Hello','PARTY','52210zBdhRn','light','ðŸš¨\x20EMERGENCY','.\x20ZUSATZ:\x20','analysis.training.triggerHealth','âœ…\x20User\x20confirmed\x20ALARM\x20via\x20Telegram.\x20Resetting\x20system.','selectedFunctionIds','Pattern\x20Detected','ENERGY_TRAIN_RESULT','warn','bind','testNotification','Deviation','lampe','analysis.triggerBriefing','driftAnalysisTimer','Normal','ðŸ¤–\x20BUTLER:\x20No\x20valid\x20target\x20ID\x20or\x20value\x20stored\x20for\x20execution.','rollladen','text.alarm','9203450kPBDGJ','âœ…\x20HEALTH\x20MODEL\x20TRAINED!\x20','activityLevel',').\x20Saving\x20to\x20Training\x20Data.','summary','channel','communicate.request','analysis.training.triggerSecurity','rawEventLog','humidity','modeResetJob','UngewÃ¶hnliches\x20Bewegungsmuster\x20erkannt!\x20(Score:\x20','ltmLtbWindowDays','path','WETTER:\x20','setHours','getLtmData','briefingEnabled','round','KALENDER:\x20Keine\x20relevanten\x20Termine','weatherInstance','toString','devices','WETTER\x20ERROR:\x20','AI\x20Emergency\x20Status','exitTimer','Subscribing\x20to\x20','state','NORMAL','Training\x20Status','analysis.health.trendDiagnosis','scheduleJob','onStateChange','analysis.comfortSuggestion','unreach','LTM\x20Sched\x20Error:\x20','telegram','generic','length','System\x20Status\x20&\x20Control','getCalendarNames\x20Error:\x20','switch','none','indicator.health','application/json','Success:\x20','.\x20SYSTEM_MODE:\x20','status','analysis.health.lastCheck','system.presenceWho','analysis.security','testApiKey','isProVersion','targetValue','[RECORDER\x20DEBUG]\x20Accepting\x20Event\x20','TRAIN_SECURITY','0\x203\x20*\x20*\x20*','LTM.triggerDailyDigest','presence','lights','pythonProcess','PRO-','text','firmware','currentSystemMode','button','12104216WMOgCr','automationProposal','inactivityThresholdHours','response','65qWLzaA','\x20days\x20of\x20activity\x20data\x20to\x20Python...','Alarm','triggerBriefing','isExit','notifyEmailRecipient','Last\x20Check\x20Time','setState','calendarInstance','analysis.training','GUEST','occupancy','Automation\x20Proposals','COGNI_CONFIRM_OK','openweathermap','PRIORITÃ„T:\x20Sicherheit.','accuweather','connection','vacation','Trigger\x20Analysis','level','values','from','automation.triggerAction','targetposition','Training\x20Data\x20Sets','HARD\x20WATCHDOG:\x20No\x20sensor\x20activity\x20detected\x20for\x20','licht','ðŸ“¡\x20Hooking\x20into\x20','timestamp','python_service','.NextHours.Location_1.Day_1.current.symbol_desc','date','shutter','Raw\x20Log','@iobroker/adapter-core','\x20(Value\x20is\x20falsy:\x20','Idle','klima','subscribeForeignStatesAsync','motion','sort','1722816HXRUEb','stdin','analysis.automation.patternDetected','AI\x20Alert\x20Status','system','Keine\x20Details.','system.config','cogni-living\x20adapter\x20starting\x20(v','bewegung','Gemini\x20Analysis\x20Error:\x20','BUTLER\x20Execution\x20Error:\x20','[RECORDER]\x20Sequence\x20finished\x20(Steps:\x20','endsWith','analysis.security.lastCheck','exitGraceTimer','notifyPushoverRecipient','\x22\x20--break-system-packages\x20--user','SECURITY_RESULT','Event\x20History','splice','Target\x20Value','analysis.automation.suggestedAction','off','extendObjectAsync','[RECORDER\x20DEBUG]\x20Ignored\x20Event\x20','.\x20OUTPUT:\x20Nur\x20Text.','ðŸ› ï¸\x20AUTO-FIX:\x20Installing\x20Python\x20dependencies\x20from\x20','getGenerativeModel','Building\x20Insulation\x20Score','Activity\x20Summary','ðŸ\x20Stopping\x20Python\x20Sidecar...','Generating\x20Morning\x20Briefing...','filter','No\x20module\x20named\x20pip','name','LTM.trainingData.sequences','includes','Gemini\x20Init\x20Error:\x20','heizung','âœ…\x20SECURITY\x20MODEL\x20TRAINED!\x20Details:\x20','_calName','ðŸ©º\x20HEALTH\x20WARNING:\x20','echarts.','.\x20INPUT\x20DATEN\x20(Letzte\x20Events):\x20','isEmergency','getStateAsync','No\x20instance','analysis.energy.insulationScore','TRAIN_HEALTH','useWeather','indicator.alarm','info','window','LTM','shift','.\x20KONTEXT:\x20','data','TREND_RESULT','javascript.','Scanning\x20for\x20devices\x20(V8:\x20Whitelist\x20Priority)...','Trigger\x20Briefing\x20(Test)','N/A','analysis.automation.targetValue','calendarSelection','schalter','\x22\x20--break-system-packages','writable','\x20for\x20interactive\x20buttons...','sendToAsync','âŒ\x20Energy\x20Training\x20Failed:\x20','13563655BDTwNj','TRAINING_COMPLETE','analysis.training.status','genAI','isPresent','actual_temperature','brightness','log','Health\x20Last\x20Check','main','enum.functions.*','setObjectNotExistsAsync','Anwesend','notifyEmailEnabled','feedbackHistory','reachable','Briefing\x20Error:\x20','Urlaub','analysis.training.triggerEnergy','analysis.health.isAnomaly','ðŸ§ \x20Triggering\x20Security\x20Training...','analysis.health',')\x20->\x20','Baseline\x20Status','indicator.alarm.fire','online','\x20sensors...','tÃ¼r','stderr','stringify'];a0_0x3a49=function(){return _0x361715;};return a0_0x3a49();}if(require[a0_0x4ee979(0x253)]!==module)module['exports']=_0x45f20b=>new CogniLiving(_0x45f20b);else new CogniLiving();