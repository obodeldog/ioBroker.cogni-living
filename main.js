const a0_0x3c9476=a0_0x3f93;(function(_0x1c19d5,_0x4900cf){const _0x45fe6a=a0_0x3f93,_0x2d9d21=_0x1c19d5();while(!![]){try{const _0x137f0e=parseInt(_0x45fe6a(0x1cd))/0x1*(parseInt(_0x45fe6a(0x277))/0x2)+-parseInt(_0x45fe6a(0x271))/0x3*(-parseInt(_0x45fe6a(0x29f))/0x4)+parseInt(_0x45fe6a(0x1c3))/0x5*(-parseInt(_0x45fe6a(0x1a0))/0x6)+-parseInt(_0x45fe6a(0x21e))/0x7+-parseInt(_0x45fe6a(0x1ea))/0x8*(-parseInt(_0x45fe6a(0x2d3))/0x9)+parseInt(_0x45fe6a(0x1ac))/0xa+parseInt(_0x45fe6a(0x31d))/0xb*(-parseInt(_0x45fe6a(0x203))/0xc);if(_0x137f0e===_0x4900cf)break;else _0x2d9d21['push'](_0x2d9d21['shift']());}catch(_0x1014ad){_0x2d9d21['push'](_0x2d9d21['shift']());}}}(a0_0x5812,0x73273));const a0_0x152680=(function(){let _0x26924a=!![];return function(_0x4f15b0,_0x4a3895){const _0x1e7958=_0x26924a?function(){const _0x50cd61=a0_0x3f93;if(_0x4a3895){const _0x379f2d=_0x4a3895[_0x50cd61(0x254)](_0x4f15b0,arguments);return _0x4a3895=null,_0x379f2d;}}:function(){};return _0x26924a=![],_0x1e7958;};}()),a0_0x1c6e16=a0_0x152680(this,function(){const _0xfcedfa=a0_0x3f93;return a0_0x1c6e16['toString']()['search'](_0xfcedfa(0x1fc))[_0xfcedfa(0x2b5)]()[_0xfcedfa(0x1a7)](a0_0x1c6e16)['search']('(((.+)+)+)+$');});a0_0x1c6e16();'use strict';const utils=require('@iobroker/adapter-core'),{GoogleGenerativeAI}=require(a0_0x3c9476(0x31f)),schedule=require(a0_0x3c9476(0x2a1)),{spawn,exec}=require('child_process'),path=require(a0_0x3c9476(0x28e)),fs=require('fs'),HISTORY_MAX_SIZE=0x32,RAW_LOG_MAX_SIZE=0x5dc,LTM_MIN_EVENTS_FOR_COMPRESSION=0x5,GEMINI_MODEL=a0_0x3c9476(0x217),LTM_SCHEDULE=a0_0x3c9476(0x27a),MODE_RESET_SCHEDULE=a0_0x3c9476(0x2a9),SEQUENCE_TIMEOUT_MS=0x5*0x3c*0x3e8,MAX_TRAINING_SET_SIZE=0x1f4,THERMO_LOG_SIZE=0x3e8,ANALYSIS_HISTORY_MAX_SIZE=0x64,EXIT_TIMER_MINUTES=0xf,EXIT_GRACE_PERIOD_SECONDS=0x1e,LTM_DP_RAW_LOG=a0_0x3c9476(0x2fb),LTM_DP_DAILY_DIGESTS=a0_0x3c9476(0x2f3),LTM_DP_STATUS=a0_0x3c9476(0x200),LTM_DP_TRIGGER_DIGEST=a0_0x3c9476(0x23f),LTM_DP_BASELINE_STATUS='LTM.baselineStatus',LTM_DP_DRIFT_CHANNEL='LTM.driftAnalysis',LTM_DP_DRIFT_STATUS=a0_0x3c9476(0x19a),LTM_DP_DRIFT_DETAILS=a0_0x3c9476(0x1d3),LTM_DP_DRIFT_LAST_CHECK='LTM.driftAnalysis.lastCheck',SYSTEM_DP_MODE=a0_0x3c9476(0x2b0),SYSTEM_MODES={'NORMAL':a0_0x3c9476(0x1fb),'VACATION':'vacation','PARTY':'party','GUEST':a0_0x3c9476(0x214)},AUTO_RESET_MODES=[SYSTEM_MODES[a0_0x3c9476(0x281)],SYSTEM_MODES[a0_0x3c9476(0x24b)]],PERSONA_MAPPING={'generic':a0_0x3c9476(0x2be),'senior_aal':a0_0x3c9476(0x1db),'family':a0_0x3c9476(0x284),'single_comfort':a0_0x3c9476(0x261),'security':a0_0x3c9476(0x225)},ACTIVITY_LEVEL_MAP={'sehr\x20hoch':0x64,'hoch':0x50,'normal':0x3c,'niedrig':0x28,'sehr\x20niedrig':0x14,'inaktiv':0x0},HARD_IGNORE_TERMS=[a0_0x3c9476(0x1d7),a0_0x3c9476(0x2e6),a0_0x3c9476(0x2c8),a0_0x3c9476(0x1fe),'lowbat',a0_0x3c9476(0x18f),a0_0x3c9476(0x1e5),a0_0x3c9476(0x1e9),'error',a0_0x3c9476(0x2d0),a0_0x3c9476(0x287),'direction',a0_0x3c9476(0x2b1),a0_0x3c9476(0x2eb),a0_0x3c9476(0x213),a0_0x3c9476(0x294),a0_0x3c9476(0x2cf),a0_0x3c9476(0x2e3)],BAD_NAMES=[a0_0x3c9476(0x1eb),a0_0x3c9476(0x1b0),a0_0x3c9476(0x233),a0_0x3c9476(0x244),'value','brightness','on',a0_0x3c9476(0x1c0),'switch',a0_0x3c9476(0x2b8),a0_0x3c9476(0x30e),'blind','cover',a0_0x3c9476(0x20f),a0_0x3c9476(0x23c),a0_0x3c9476(0x259),a0_0x3c9476(0x313),a0_0x3c9476(0x246),a0_0x3c9476(0x312),'power','energy',a0_0x3c9476(0x1ef),'valve','actual_temperature',a0_0x3c9476(0x241)],ADAPTER_BLACKLIST=[a0_0x3c9476(0x1d1),a0_0x3c9476(0x247),a0_0x3c9476(0x2c7),a0_0x3c9476(0x1d4),'history.','material.',a0_0x3c9476(0x2d4),a0_0x3c9476(0x278),a0_0x3c9476(0x204),a0_0x3c9476(0x249),'simple-api.'],IS_WIN=process[a0_0x3c9476(0x2c2)]===a0_0x3c9476(0x1bb),VENV_PATH=path[a0_0x3c9476(0x283)](__dirname,a0_0x3c9476(0x315)),PYTHON_EXE=IS_WIN?path[a0_0x3c9476(0x283)](VENV_PATH,'Scripts','python.exe'):path['join'](VENV_PATH,'bin',a0_0x3c9476(0x21d)),PIP_EXE=IS_WIN?path[a0_0x3c9476(0x283)](VENV_PATH,a0_0x3c9476(0x2cd),'pip.exe'):path[a0_0x3c9476(0x283)](VENV_PATH,'bin',a0_0x3c9476(0x2b4));let activeSequence=[],sequenceTimer=null;async function initZombies(_0x1078d9){const _0x3d94f2=a0_0x3c9476;try{const _0x1809db=['analysis.history_debug_00',_0x3d94f2(0x25c)];for(const _0x1f2c8a of _0x1809db){try{const _0x39014c=await _0x1078d9[_0x3d94f2(0x27f)](_0x1f2c8a);if(_0x39014c)await _0x1078d9[_0x3d94f2(0x245)](_0x1f2c8a);}catch(_0x2b2381){}}}catch(_0x2b4a88){}}async function initHistory(_0x6655f1){const _0x480dcc=a0_0x3c9476;try{const _0x49fb37=await _0x6655f1[_0x480dcc(0x191)](_0x480dcc(0x2f0));_0x49fb37&&_0x49fb37[_0x480dcc(0x2fd)]&&(_0x6655f1['eventHistory']=JSON[_0x480dcc(0x1c5)](_0x49fb37['val'][_0x480dcc(0x2b5)]()));}catch(_0x58ef40){_0x6655f1['eventHistory']=[];}try{const _0x9c53f2=await _0x6655f1['getStateAsync']('analysis.analysisHistory');if(_0x9c53f2&&_0x9c53f2[_0x480dcc(0x2fd)])_0x6655f1[_0x480dcc(0x310)]=JSON[_0x480dcc(0x1c5)](_0x9c53f2[_0x480dcc(0x2fd)][_0x480dcc(0x2b5)]());}catch(_0x2c1ff8){_0x6655f1['analysisHistory']=[];}if(_0x6655f1['eventHistory']&&_0x6655f1[_0x480dcc(0x198)][_0x480dcc(0x1fd)]>0x0){_0x6655f1[_0x480dcc(0x206)][_0x480dcc(0x196)](_0x480dcc(0x1c1)+_0x6655f1[_0x480dcc(0x198)][_0x480dcc(0x1fd)]+'\x20events)...');for(let _0x4860ed=_0x6655f1[_0x480dcc(0x198)][_0x480dcc(0x1fd)]-0x1;_0x4860ed>=0x0;_0x4860ed--){const _0x149ab4=_0x6655f1[_0x480dcc(0x198)][_0x4860ed];if(_0x149ab4&&_0x149ab4['id']!==undefined&&_0x149ab4[_0x480dcc(0x2ba)]!==undefined)_0x6655f1[_0x480dcc(0x238)][_0x149ab4['id']]=_0x149ab4[_0x480dcc(0x2ba)];}}}async function initSystemConfig(_0x5bd92b){const _0x570446=a0_0x3c9476;try{const _0x5c7e8f=await _0x5bd92b[_0x570446(0x21b)](_0x570446(0x202));if(_0x5c7e8f&&_0x5c7e8f['common'])_0x5bd92b[_0x570446(0x236)]={'latitude':_0x5c7e8f[_0x570446(0x1ba)][_0x570446(0x1bf)]||0x0,'longitude':_0x5c7e8f[_0x570446(0x1ba)][_0x570446(0x19d)]||0x0,'city':_0x5c7e8f[_0x570446(0x1ba)][_0x570446(0x1c9)]||''};}catch(_0x2600cf){}}async function checkLicense(_0x4a844d,_0x191d72){return!![];}async function getSystemUUID(_0x1dc838){const _0x44fadf=a0_0x3c9476;return _0x44fadf(0x251);}async function loadRawEventLog(_0x2983e1){const _0x163f51=a0_0x3c9476;try{const _0x226097=await _0x2983e1[_0x163f51(0x191)](LTM_DP_RAW_LOG);if(_0x226097&&_0x226097[_0x163f51(0x2fd)])_0x2983e1['rawEventLog']=JSON['parse'](_0x226097[_0x163f51(0x2fd)]);}catch(_0x395209){_0x2983e1[_0x163f51(0x1ab)]=[];}}async function saveRawEventLog(_0x44544c){const _0x2449d5=a0_0x3c9476;if(_0x44544c[_0x2449d5(0x1ab)]['length']>RAW_LOG_MAX_SIZE)_0x44544c[_0x2449d5(0x1ab)][_0x2449d5(0x2a8)](0x0,_0x44544c['rawEventLog']['length']-RAW_LOG_MAX_SIZE);await _0x44544c[_0x2449d5(0x1b8)](LTM_DP_RAW_LOG,{'val':JSON['stringify'](_0x44544c[_0x2449d5(0x1ab)]),'ack':!![]});}async function loadDailyDigests(_0x22e6a1){const _0x10756f=a0_0x3c9476;try{const _0x16bede=await _0x22e6a1[_0x10756f(0x191)](LTM_DP_DAILY_DIGESTS);if(_0x16bede&&_0x16bede[_0x10756f(0x2fd)])_0x22e6a1[_0x10756f(0x240)]=JSON[_0x10756f(0x1c5)](_0x16bede[_0x10756f(0x2fd)]);}catch(_0x41576f){_0x22e6a1[_0x10756f(0x240)]=[];}await updateBaselineStatus(_0x22e6a1);}async function saveDailyDigests(_0x539bfa,_0x50f8f8=!![]){const _0x3625eb=a0_0x3c9476,_0x491eac=_0x539bfa['config'][_0x3625eb(0x218)]||0x3c;_0x539bfa[_0x3625eb(0x240)]['length']>_0x491eac&&_0x539bfa[_0x3625eb(0x240)][_0x3625eb(0x2a8)](0x0,_0x539bfa[_0x3625eb(0x240)][_0x3625eb(0x1fd)]-_0x491eac);await _0x539bfa['setStateAsync'](LTM_DP_DAILY_DIGESTS,{'val':JSON[_0x3625eb(0x2c1)](_0x539bfa[_0x3625eb(0x240)]),'ack':!![]});if(_0x50f8f8)await updateBaselineStatus(_0x539bfa);}async function updateAnalysisHistory(_0x2c017e,_0x302809){const _0x3b1fb4=a0_0x3c9476;_0x2c017e[_0x3b1fb4(0x310)]['unshift'](_0x302809);if(_0x2c017e[_0x3b1fb4(0x310)][_0x3b1fb4(0x1fd)]>ANALYSIS_HISTORY_MAX_SIZE)_0x2c017e[_0x3b1fb4(0x310)][_0x3b1fb4(0x234)]();await _0x2c017e[_0x3b1fb4(0x1b8)]('analysis.analysisHistory',{'val':JSON['stringify'](_0x2c017e['analysisHistory']),'ack':!![]});}function a0_0x3f93(_0x458268,_0x22df69){const _0x2f0eef=a0_0x5812();return a0_0x3f93=function(_0x1c6e16,_0x152680){_0x1c6e16=_0x1c6e16-0x18f;let _0x581266=_0x2f0eef[_0x1c6e16];return _0x581266;},a0_0x3f93(_0x458268,_0x22df69);}async function updateBaselineStatus(_0x5df037){const _0x967dd0=a0_0x3c9476;if(!_0x5df037['isProVersion']){await _0x5df037[_0x967dd0(0x1b8)](LTM_DP_BASELINE_STATUS,{'val':_0x967dd0(0x1f0),'ack':!![]});return;}const _0x27c8b3=_0x5df037[_0x967dd0(0x240)]['length']>=(_0x5df037[_0x967dd0(0x223)][_0x967dd0(0x290)]||0x7)?'Aktiv\x20('+_0x5df037[_0x967dd0(0x240)][_0x967dd0(0x1fd)]+_0x967dd0(0x228):_0x967dd0(0x235)+_0x5df037[_0x967dd0(0x240)][_0x967dd0(0x1fd)]+'/'+(_0x5df037[_0x967dd0(0x223)]['minDaysForBaseline']||0x7)+')';await _0x5df037[_0x967dd0(0x1b8)](LTM_DP_BASELINE_STATUS,{'val':_0x27c8b3,'ack':!![]});}async function loadSystemMode(_0x12de90){const _0x4d4fae=a0_0x3c9476;try{const _0x53eeb7=await _0x12de90[_0x4d4fae(0x191)](SYSTEM_DP_MODE);_0x53eeb7&&_0x53eeb7['val']&&Object['values'](SYSTEM_MODES)[_0x4d4fae(0x19b)](_0x53eeb7[_0x4d4fae(0x2fd)])?_0x12de90[_0x4d4fae(0x195)]=_0x53eeb7[_0x4d4fae(0x2fd)]:(_0x12de90[_0x4d4fae(0x195)]=SYSTEM_MODES[_0x4d4fae(0x20b)],await _0x12de90[_0x4d4fae(0x1b8)](SYSTEM_DP_MODE,{'val':SYSTEM_MODES[_0x4d4fae(0x20b)],'ack':!![]}));}catch(_0x4396fe){_0x12de90['currentSystemMode']=SYSTEM_MODES['NORMAL'];}}async function createAllObjects(_0x2c5bfa){const _0x45ce58=a0_0x3c9476;await _0x2c5bfa[_0x45ce58(0x325)](_0x45ce58(0x1ae),{'type':_0x45ce58(0x1d8),'common':{'name':_0x45ce58(0x318)},'native':{}}),await _0x2c5bfa[_0x45ce58(0x325)](SYSTEM_DP_MODE,{'type':_0x45ce58(0x233),'common':{'name':_0x45ce58(0x2d6),'type':'string','role':_0x45ce58(0x233),'read':!![],'write':!![],'def':SYSTEM_MODES[_0x45ce58(0x20b)]},'native':{}}),await _0x2c5bfa[_0x45ce58(0x1b1)](_0x45ce58(0x1f3),{'type':_0x45ce58(0x233),'common':{'name':_0x45ce58(0x300),'type':_0x45ce58(0x197),'role':_0x45ce58(0x27d),'read':!![],'write':![]},'native':{}}),await _0x2c5bfa[_0x45ce58(0x1b1)]('events.lastEvent',{'type':_0x45ce58(0x233),'common':{'name':_0x45ce58(0x212),'type':'string','role':_0x45ce58(0x31b),'read':!![],'write':![]},'native':{}}),await _0x2c5bfa[_0x45ce58(0x1b1)]('events.history',{'type':_0x45ce58(0x233),'common':{'name':'Event\x20History','type':'string','role':_0x45ce58(0x31b),'read':!![],'write':![]},'native':{}}),await _0x2c5bfa[_0x45ce58(0x325)](_0x45ce58(0x2ec),{'type':_0x45ce58(0x1d8),'common':{'name':'AI\x20Training'},'native':{}}),await _0x2c5bfa['setObjectNotExistsAsync'](_0x45ce58(0x199),{'type':_0x45ce58(0x233),'common':{'name':_0x45ce58(0x22b),'type':_0x45ce58(0x1e7),'role':_0x45ce58(0x2e5),'read':!![],'write':!![]},'native':{}}),await _0x2c5bfa[_0x45ce58(0x1b1)](_0x45ce58(0x250),{'type':'state','common':{'name':_0x45ce58(0x22c),'type':'boolean','role':_0x45ce58(0x2e5),'read':!![],'write':!![]},'native':{}}),await _0x2c5bfa[_0x45ce58(0x1b1)](_0x45ce58(0x2cc),{'type':_0x45ce58(0x233),'common':{'name':'Train\x20Energy','type':_0x45ce58(0x1e7),'role':_0x45ce58(0x2e5),'read':!![],'write':!![]},'native':{}}),await _0x2c5bfa[_0x45ce58(0x1b1)]('analysis.training.status',{'type':_0x45ce58(0x233),'common':{'name':'Training\x20Status','type':_0x45ce58(0x197),'role':_0x45ce58(0x27d),'read':!![],'write':![]},'native':{}}),await _0x2c5bfa[_0x45ce58(0x325)](_0x45ce58(0x255),{'type':_0x45ce58(0x1d8),'common':{'name':'Security\x20Monitor'},'native':{}}),await _0x2c5bfa['setObjectNotExistsAsync']('analysis.security.lastScore',{'type':_0x45ce58(0x233),'common':{'name':_0x45ce58(0x23a),'type':_0x45ce58(0x252),'role':_0x45ce58(0x2ba),'read':!![],'write':![]},'native':{}}),await _0x2c5bfa[_0x45ce58(0x1b1)](_0x45ce58(0x1a3),{'type':_0x45ce58(0x233),'common':{'name':_0x45ce58(0x303),'type':'string','role':_0x45ce58(0x31a),'read':!![],'write':![]},'native':{}}),await _0x2c5bfa[_0x45ce58(0x325)](_0x45ce58(0x1dd),{'type':_0x45ce58(0x1d8),'common':{'name':_0x45ce58(0x1c7)},'native':{}}),await _0x2c5bfa['setObjectNotExistsAsync']('analysis.health.lastCheck',{'type':_0x45ce58(0x233),'common':{'name':_0x45ce58(0x303),'type':_0x45ce58(0x197),'role':_0x45ce58(0x31a),'read':!![],'write':![]},'native':{}}),await _0x2c5bfa[_0x45ce58(0x1b1)](_0x45ce58(0x305),{'type':_0x45ce58(0x233),'common':{'name':_0x45ce58(0x201),'type':_0x45ce58(0x1e7),'role':_0x45ce58(0x1d9),'read':!![],'write':![]},'native':{}}),await _0x2c5bfa['setObjectNotExistsAsync'](_0x45ce58(0x29e),{'type':'state','common':{'name':'Trend','type':_0x45ce58(0x197),'role':_0x45ce58(0x27d),'read':!![],'write':![]},'native':{}}),await _0x2c5bfa[_0x45ce58(0x1b1)]('analysis.health.trendValue',{'type':_0x45ce58(0x233),'common':{'name':'Trend\x20Value','type':'number','role':_0x45ce58(0x2ba),'read':!![],'write':![]},'native':{}}),await _0x2c5bfa[_0x45ce58(0x325)](_0x45ce58(0x194),{'type':_0x45ce58(0x1d8),'common':{'name':_0x45ce58(0x1a4)},'native':{}}),await _0x2c5bfa[_0x45ce58(0x1b1)](_0x45ce58(0x319),{'type':_0x45ce58(0x233),'common':{'name':_0x45ce58(0x26d),'type':'string','role':'text','read':!![],'write':![]},'native':{}}),await _0x2c5bfa[_0x45ce58(0x1b1)](_0x45ce58(0x2e8),{'type':_0x45ce58(0x233),'common':{'name':_0x45ce58(0x226),'type':_0x45ce58(0x197),'role':_0x45ce58(0x27d),'read':!![],'write':![]},'native':{}}),await _0x2c5bfa['extendObjectAsync'](_0x45ce58(0x1a9),{'type':_0x45ce58(0x1d8),'common':{'name':_0x45ce58(0x1a9)},'native':{}}),await _0x2c5bfa[_0x45ce58(0x325)](LTM_DP_RAW_LOG,{'type':_0x45ce58(0x233),'common':{'name':_0x45ce58(0x304),'type':'string','role':_0x45ce58(0x31b),'read':!![],'write':![]},'native':{}}),await _0x2c5bfa[_0x45ce58(0x325)](LTM_DP_DAILY_DIGESTS,{'type':'state','common':{'name':'Daily\x20Digests','type':_0x45ce58(0x197),'role':_0x45ce58(0x31b),'read':!![],'write':![]},'native':{}}),await _0x2c5bfa[_0x45ce58(0x1b1)](_0x45ce58(0x2f1),{'type':'state','common':{'name':_0x45ce58(0x1f5),'type':'string','role':_0x45ce58(0x31b),'read':!![],'write':![]},'native':{}}),await _0x2c5bfa[_0x45ce58(0x1b1)]('LTM.trainingData.thermodynamics',{'type':'state','common':{'name':_0x45ce58(0x288),'type':'string','role':_0x45ce58(0x31b),'read':!![],'write':![]},'native':{}}),await _0x2c5bfa[_0x45ce58(0x1b1)](_0x45ce58(0x2ae),{'type':'state','common':{'name':_0x45ce58(0x27c),'type':_0x45ce58(0x1e7),'role':_0x45ce58(0x2e5),'read':!![],'write':!![]},'native':{}}),await _0x2c5bfa[_0x45ce58(0x1b1)](_0x45ce58(0x2df),{'type':_0x45ce58(0x233),'common':{'name':_0x45ce58(0x2f8),'type':_0x45ce58(0x1e7),'role':_0x45ce58(0x2e5),'read':!![],'write':!![]},'native':{}}),await _0x2c5bfa[_0x45ce58(0x1b1)](_0x45ce58(0x20e),{'type':_0x45ce58(0x233),'common':{'name':_0x45ce58(0x2a5),'type':_0x45ce58(0x1e7),'role':_0x45ce58(0x2e9),'read':!![],'write':![]},'native':{}}),await _0x2c5bfa[_0x45ce58(0x1b1)]('analysis.alertReason',{'type':_0x45ce58(0x233),'common':{'name':_0x45ce58(0x316),'type':_0x45ce58(0x197),'role':_0x45ce58(0x1aa),'read':!![],'write':![]},'native':{}}),await _0x2c5bfa[_0x45ce58(0x1b1)]('analysis.activitySummary',{'type':_0x45ce58(0x233),'common':{'name':_0x45ce58(0x2e7),'type':'string','role':_0x45ce58(0x27d),'read':!![],'write':![]},'native':{}}),await _0x2c5bfa[_0x45ce58(0x1b1)]('analysis.automation.patternDetected',{'type':'state','common':{'name':_0x45ce58(0x269),'type':_0x45ce58(0x1e7),'role':'indicator','read':!![],'write':![]},'native':{}}),await _0x2c5bfa[_0x45ce58(0x1b1)](_0x45ce58(0x257),{'type':_0x45ce58(0x233),'common':{'name':_0x45ce58(0x293),'type':_0x45ce58(0x197),'role':'text','read':!![],'write':![]},'native':{}}),await _0x2c5bfa[_0x45ce58(0x1b1)]('analysis.automation.targetId',{'type':_0x45ce58(0x233),'common':{'name':_0x45ce58(0x215),'type':_0x45ce58(0x197),'role':_0x45ce58(0x27d),'read':!![],'write':![]},'native':{}}),await _0x2c5bfa[_0x45ce58(0x1b1)](_0x45ce58(0x2ef),{'type':'state','common':{'name':_0x45ce58(0x237),'type':_0x45ce58(0x197),'role':_0x45ce58(0x27d),'read':!![],'write':![]},'native':{}}),await _0x2c5bfa['setObjectNotExistsAsync'](_0x45ce58(0x27b),{'type':'state','common':{'name':_0x45ce58(0x302),'type':_0x45ce58(0x1e7),'role':_0x45ce58(0x299),'read':!![],'write':!![]},'native':{}}),await _0x2c5bfa[_0x45ce58(0x1b1)](_0x45ce58(0x1f9),{'type':_0x45ce58(0x233),'common':{'name':_0x45ce58(0x279),'type':'boolean','role':_0x45ce58(0x2e5),'read':!![],'write':!![]},'native':{}});}async function recordThermodynamics(_0x94c3a9,_0x55ff0d,_0x2ad1a6,_0x5c1dee){const _0x1bc54c=a0_0x3c9476,_0x1c6996=await getOutsideTemperatureNumeric(_0x94c3a9),_0x556525=await _0x94c3a9[_0x1bc54c(0x191)]('LTM.trainingData.thermodynamics');let _0x1e32f2=[];if(_0x556525&&_0x556525[_0x1bc54c(0x2fd)])try{_0x1e32f2=JSON[_0x1bc54c(0x1c5)](_0x556525[_0x1bc54c(0x2fd)]);}catch(_0x5028e1){}_0x1e32f2[_0x1bc54c(0x1d2)]({'ts':Date[_0x1bc54c(0x2c5)](),'room':_0x5c1dee||_0x1bc54c(0x1ed),'t_in':_0x2ad1a6,'t_out':_0x1c6996});if(_0x1e32f2['length']>THERMO_LOG_SIZE)_0x1e32f2[_0x1bc54c(0x25d)]();await _0x94c3a9[_0x1bc54c(0x1b8)](_0x1bc54c(0x248),{'val':JSON[_0x1bc54c(0x2c1)](_0x1e32f2),'ack':!![]});}async function getOutsideTemperatureNumeric(_0x5961ae){const _0x4c9aca=a0_0x3c9476;if(_0x5961ae[_0x4c9aca(0x223)][_0x4c9aca(0x2bd)])try{const _0x115aa8=await _0x5961ae[_0x4c9aca(0x2dd)](_0x5961ae[_0x4c9aca(0x223)][_0x4c9aca(0x2bd)]);if(_0x115aa8&&_0x115aa8[_0x4c9aca(0x2fd)]!==undefined&&_0x115aa8['val']!==null)return parseFloat(_0x115aa8[_0x4c9aca(0x2fd)]);}catch(_0xc7b453){}return null;}async function recordSequence(_0x3803ec,_0x14fe94){const _0x53fec6=a0_0x3c9476,_0x14e2e1=(_0x14fe94[_0x53fec6(0x2d5)]||'')['toLowerCase'](),_0x132636=[_0x53fec6(0x23c),_0x53fec6(0x258),_0x53fec6(0x2f7),'presence',_0x53fec6(0x313),_0x53fec6(0x2a2),_0x53fec6(0x1df),_0x53fec6(0x211),_0x53fec6(0x190),_0x53fec6(0x1e4),_0x53fec6(0x24c),_0x53fec6(0x28d),_0x53fec6(0x24f),'switch',_0x53fec6(0x193),'dimmer',_0x53fec6(0x2e0)];if(!_0x132636[_0x53fec6(0x2a4)](_0x558815=>_0x14e2e1[_0x53fec6(0x19b)](_0x558815)))return;if(!_0x14fe94[_0x53fec6(0x2ba)])return;if(sequenceTimer)clearTimeout(sequenceTimer);activeSequence[_0x53fec6(0x1d2)]({'loc':_0x14fe94['location']||_0x53fec6(0x1ed),'id':_0x14fe94['id'],'ts':Date[_0x53fec6(0x2c5)]()}),_0x3803ec[_0x53fec6(0x206)][_0x53fec6(0x1bc)]('[RECORDER]\x20Added\x20step\x20to\x20sequence:\x20'+_0x14fe94[_0x53fec6(0x2dc)]+_0x53fec6(0x263)+activeSequence[_0x53fec6(0x1fd)]+')'),sequenceTimer=setTimeout(async()=>{const _0x4c64d1=_0x53fec6;if(activeSequence[_0x4c64d1(0x1fd)]>0x1)await saveCompletedSequence(_0x3803ec);activeSequence=[];},SEQUENCE_TIMEOUT_MS);}async function saveCompletedSequence(_0x461b68){const _0x2819f6=a0_0x3c9476;try{const _0x20a4df=await _0x461b68[_0x2819f6(0x191)](_0x2819f6(0x2f1));let _0x400ca2=[];if(_0x20a4df&&_0x20a4df[_0x2819f6(0x2fd)])try{_0x400ca2=JSON[_0x2819f6(0x1c5)](_0x20a4df[_0x2819f6(0x2fd)]);}catch(_0xda62dc){}const _0x34a249=activeSequence[0x0]['ts'],_0x127c7d=activeSequence[_0x2819f6(0x282)](_0x613c97=>({'loc':_0x613c97[_0x2819f6(0x23e)],'t_delta':Math['round']((_0x613c97['ts']-_0x34a249)/0x3e8)})),_0x52cdad={'timestamp':new Date(_0x34a249)[_0x2819f6(0x2b3)](),'steps':_0x127c7d,'duration':Math[_0x2819f6(0x1a1)]((activeSequence[activeSequence[_0x2819f6(0x1fd)]-0x1]['ts']-_0x34a249)/0x3e8),'daytime':new Date(_0x34a249)[_0x2819f6(0x274)]()};_0x400ca2[_0x2819f6(0x1d2)](_0x52cdad);if(_0x400ca2[_0x2819f6(0x1fd)]>MAX_TRAINING_SET_SIZE)_0x400ca2['shift']();await _0x461b68[_0x2819f6(0x1b8)]('LTM.trainingData.sequences',{'val':JSON[_0x2819f6(0x2c1)](_0x400ca2),'ack':!![]}),runSecurityCheck(_0x461b68,_0x52cdad);}catch(_0x4f320f){_0x461b68[_0x2819f6(0x206)][_0x2819f6(0x29d)](_0x2819f6(0x289)+_0x4f320f[_0x2819f6(0x2f4)]);}}function runSecurityCheck(_0x2dc6b7,_0x4b819c){const _0x5951e1=a0_0x3c9476;if(!_0x2dc6b7[_0x5951e1(0x260)])return;_0x2dc6b7[_0x5951e1(0x206)][_0x5951e1(0x1bc)]('üõ°Ô∏è\x20SECURITY:\x20Sending\x20sequence\x20to\x20Guard\x20for\x20analysis...'),sendToPython(_0x2dc6b7,'ANALYZE_SEQUENCE',{'sequence':_0x4b819c});}async function processSensorEvent(_0x254766,_0x5d1176,_0x38a1a1,_0x55ee27){const _0x509fd9=a0_0x3c9476;if(!_0x55ee27)return;const _0x15f4b7=_0x38a1a1[_0x509fd9(0x2fd)],_0x1399c2=Date['now'](),_0x376f79=_0x254766[_0x509fd9(0x238)][_0x5d1176];_0x254766['sensorLastValues'][_0x5d1176]=_0x15f4b7;if(!_0x55ee27[_0x509fd9(0x265)]&&_0x376f79!=undefined&&_0x376f79==_0x15f4b7)return;const _0x3d1d5b=(_0x55ee27['type']||'')[_0x509fd9(0x26c)](),_0x530362=_0x3d1d5b['includes'](_0x509fd9(0x246))||_0x3d1d5b[_0x509fd9(0x19b)]('temperatur')||_0x3d1d5b[_0x509fd9(0x19b)](_0x509fd9(0x301))||_0x3d1d5b[_0x509fd9(0x19b)](_0x509fd9(0x2d2));_0x254766[_0x509fd9(0x260)]&&_0x530362&&recordThermodynamics(_0x254766,_0x5d1176,_0x15f4b7,_0x55ee27[_0x509fd9(0x2dc)]);const _0x5247f5={'timestamp':_0x1399c2,'id':_0x5d1176,'name':_0x55ee27['name'],'type':_0x55ee27[_0x509fd9(0x2d5)],'location':_0x55ee27[_0x509fd9(0x2dc)],'value':_0x15f4b7};_0x254766[_0x509fd9(0x198)]['unshift'](_0x5247f5);if(_0x254766[_0x509fd9(0x198)]['length']>HISTORY_MAX_SIZE)_0x254766[_0x509fd9(0x198)][_0x509fd9(0x234)]();await _0x254766[_0x509fd9(0x1b8)]('events.lastEvent',{'val':JSON[_0x509fd9(0x2c1)](_0x5247f5),'ack':!![]}),await _0x254766[_0x509fd9(0x1b8)](_0x509fd9(0x2f0),{'val':JSON['stringify'](_0x254766['eventHistory']),'ack':!![]});_0x254766[_0x509fd9(0x260)]&&(_0x254766['rawEventLog'][_0x509fd9(0x1d2)](_0x5247f5),await saveRawEventLog(_0x254766),recordSequence(_0x254766,_0x5247f5));if(_0x55ee27[_0x509fd9(0x222)]&&_0x15f4b7===!![]){if(_0x254766[_0x509fd9(0x2e1)]&&!_0x254766['isGracePeriodActive'])startExitTimer(_0x254766);else{if(!_0x254766[_0x509fd9(0x2e1)])setPresence(_0x254766,!![]);}}else{if(_0x55ee27['type']===_0x509fd9(0x23c)&&_0x15f4b7===!![]){if(_0x254766[_0x509fd9(0x1ad)])abortExitTimer(_0x254766);if(!_0x254766['isPresent']&&_0x254766['currentSystemMode']===SYSTEM_MODES[_0x509fd9(0x20b)])setPresence(_0x254766,!![]);}}}function installPythonDependencies(_0x29e012){const _0x3dbf91=a0_0x3c9476;if(_0x29e012['dependencyInstallInProgress'])return;_0x29e012['dependencyInstallInProgress']=!![];const _0x285320=path['join'](__dirname,_0x3dbf91(0x25e),_0x3dbf91(0x270));_0x29e012[_0x3dbf91(0x206)][_0x3dbf91(0x196)](_0x3dbf91(0x2f9)),stopPythonService(_0x29e012);if(fs[_0x3dbf91(0x2ca)](VENV_PATH)){if(!fs['existsSync'](PIP_EXE)){_0x29e012['log'][_0x3dbf91(0x31c)]('‚ö†Ô∏è\x20Broken\x20venv\x20detected.\x20Repairing...');try{fs['rmSync'](VENV_PATH,{'recursive':!![],'force':!![]});}catch(_0x66b61b){}}}!fs['existsSync'](VENV_PATH)?exec(_0x3dbf91(0x1b3)+VENV_PATH+'\x22',_0x28f254=>{const _0x580e88=_0x3dbf91;if(_0x28f254){_0x29e012[_0x580e88(0x206)][_0x580e88(0x29d)](_0x580e88(0x25a)),_0x29e012[_0x580e88(0x227)]=![];return;}installRequirementsInVenv(_0x29e012,_0x285320);}):installRequirementsInVenv(_0x29e012,_0x285320);}function installRequirementsInVenv(_0x18642d,_0x4b4343){const _0x46a130=a0_0x3c9476;_0x18642d[_0x46a130(0x206)][_0x46a130(0x196)](_0x46a130(0x2d9));const _0x5260bd='\x22'+PIP_EXE+_0x46a130(0x324)+_0x4b4343+'\x22';exec(_0x5260bd,{'timeout':0x124f80,'maxBuffer':0x400*0x400*0x32},_0x3fdc50=>{const _0x343b37=_0x46a130;_0x18642d['dependencyInstallInProgress']=![],_0x3fdc50?_0x18642d['log']['error'](_0x343b37(0x27e)+_0x3fdc50[_0x343b37(0x2f4)]):(_0x18642d['log']['info']('‚úÖ\x20INFRASTRUCTURE\x20READY.\x20Starting\x20Service...'),startPythonService(_0x18642d));});}function startPythonService(_0x1fa725){const _0x29e20c=a0_0x3c9476;if(_0x1fa725[_0x29e20c(0x227)])return;let _0xd317b1='python3';if(fs[_0x29e20c(0x2ca)](PYTHON_EXE))_0x1fa725[_0x29e20c(0x206)]['info'](_0x29e20c(0x308)+PYTHON_EXE),_0xd317b1=PYTHON_EXE;else{_0x1fa725[_0x29e20c(0x206)]['warn'](_0x29e20c(0x1ee)),installPythonDependencies(_0x1fa725);return;}try{const _0x22860d=path[_0x29e20c(0x283)](__dirname,_0x29e20c(0x25e),_0x29e20c(0x2ed));_0x1fa725['pythonProcess']=spawn(_0xd317b1,[_0x22860d]),_0x1fa725[_0x29e20c(0x22a)][_0x29e20c(0x1d6)]['on'](_0x29e20c(0x20d),_0x148942=>{const _0x5e9a39=_0x29e20c,_0x536625=_0x148942[_0x5e9a39(0x2b5)]()[_0x5e9a39(0x1a2)]('\x0a');_0x536625[_0x5e9a39(0x23d)](_0x276c8e=>{const _0x3db35d=_0x5e9a39,_0x58469c=_0x276c8e[_0x3db35d(0x322)]();if(!_0x58469c)return;if(_0x58469c[_0x3db35d(0x1af)](_0x3db35d(0x1d0)))_0x1fa725[_0x3db35d(0x206)][_0x3db35d(0x1bc)](_0x3db35d(0x253)+_0x58469c[_0x3db35d(0x229)](0x5)[_0x3db35d(0x322)]());else{if(_0x58469c[_0x3db35d(0x1af)](_0x3db35d(0x20c)))try{const _0x2679ea=JSON['parse'](_0x58469c[_0x3db35d(0x229)](0x8)[_0x3db35d(0x322)]());handlePythonResult(_0x1fa725,_0x2679ea);}catch(_0x43a832){_0x1fa725['log'][_0x3db35d(0x31c)](_0x3db35d(0x2aa)+_0x58469c);}}(_0x58469c[_0x3db35d(0x19b)](_0x3db35d(0x273))||_0x58469c[_0x3db35d(0x19b)](_0x3db35d(0x286)))&&(_0x1fa725[_0x3db35d(0x206)][_0x3db35d(0x31c)](_0x3db35d(0x1ce)),installPythonDependencies(_0x1fa725));});}),_0x1fa725[_0x29e20c(0x22a)][_0x29e20c(0x22d)]['on'](_0x29e20c(0x20d),_0x3aa489=>{const _0x21a79f=_0x29e20c,_0x1540e6=_0x3aa489['toString']()[_0x21a79f(0x322)]();if(!_0x1540e6[_0x21a79f(0x19b)](_0x21a79f(0x26e)))_0x1fa725['log'][_0x21a79f(0x29d)](_0x21a79f(0x2f2)+_0x1540e6);}),_0x1fa725['pythonProcess']['on']('close',_0x29f2cb=>{const _0x1d404e=_0x29e20c;_0x1fa725[_0x1d404e(0x206)][_0x1d404e(0x196)](_0x1d404e(0x317)+_0x29f2cb),_0x1fa725[_0x1d404e(0x22a)]=null;});}catch(_0x5d632f){_0x1fa725[_0x29e20c(0x206)]['error'](_0x29e20c(0x239)+_0x5d632f[_0x29e20c(0x2f4)]);}}function stopPythonService(_0x5d3769){const _0x15ac71=a0_0x3c9476;if(_0x5d3769['pythonProcess']){_0x5d3769[_0x15ac71(0x206)][_0x15ac71(0x196)]('üêç\x20Stopping\x20Python...');try{_0x5d3769[_0x15ac71(0x22a)][_0x15ac71(0x2fe)]();}catch(_0x3b9239){}_0x5d3769[_0x15ac71(0x22a)]=null;}}function handlePythonResult(_0xc6cfd9,_0x3843dc){const _0x39120d=a0_0x3c9476;if(_0x3843dc['type']===_0x39120d(0x1e2))_0xc6cfd9[_0x39120d(0x206)][_0x39120d(0x1bc)](_0x39120d(0x1bd));else{if(_0x3843dc[_0x39120d(0x2d5)]===_0x39120d(0x296)){const {anomaly_score:_0x2b2dc5,is_anomaly:_0x4512d6,threshold:_0x2666ff}=_0x3843dc[_0x39120d(0x23b)];_0xc6cfd9[_0x39120d(0x206)][_0x39120d(0x196)]('üõ°Ô∏è\x20SECURITY\x20CHECK:\x20Score\x20'+_0x2b2dc5[_0x39120d(0x2e4)](0x5)+_0x39120d(0x221)+(_0x4512d6?_0x39120d(0x1a5):'OK')),_0xc6cfd9[_0x39120d(0x1b8)](_0x39120d(0x264),{'val':_0x2b2dc5,'ack':!![]}),_0xc6cfd9[_0x39120d(0x1b8)]('analysis.security.lastCheck',{'val':new Date()[_0x39120d(0x2b3)](),'ack':!![]});if(_0x4512d6){const _0xc11bba=_0x39120d(0x1be)+_0x2b2dc5[_0x39120d(0x2e4)](0x4)+')';_0xc6cfd9['setStateAsync'](_0x39120d(0x20e),{'val':!![],'ack':!![]}),_0xc6cfd9[_0x39120d(0x1b8)](_0x39120d(0x1b7),{'val':_0xc11bba,'ack':!![]}),sendNotification(_0xc6cfd9,_0x39120d(0x2c9)+_0xc11bba,![],!![]);}}else{if(_0x3843dc[_0x39120d(0x2d5)]===_0x39120d(0x1b2)){const {success:_0x57ea8e,details:_0x124757}=_0x3843dc['payload'];_0xc6cfd9[_0x39120d(0x1b8)](_0x39120d(0x242),{'val':_0x57ea8e?_0x39120d(0x272)+new Date()[_0x39120d(0x30a)]()+'\x20('+_0x124757+')':_0x39120d(0x291)+_0x124757,'ack':!![]});}else{if(_0x3843dc[_0x39120d(0x2d5)]===_0x39120d(0x2c6)){const {success:_0x2e8f0b,details:_0x47a105}=_0x3843dc[_0x39120d(0x23b)];if(_0x2e8f0b)try{const _0x3ea6de=JSON[_0x39120d(0x1c5)](_0x47a105);if(_0x3ea6de['insulation'])_0xc6cfd9[_0x39120d(0x1b8)]('analysis.energy.insulationScore',{'val':JSON[_0x39120d(0x2c1)](_0x3ea6de['insulation']),'ack':!![]});if(_0x3ea6de[_0x39120d(0x2a3)])_0xc6cfd9[_0x39120d(0x1b8)](_0x39120d(0x2e8),{'val':JSON['stringify'](_0x3ea6de[_0x39120d(0x2a3)]),'ack':!![]});}catch(_0x5c6909){}}else{if(_0x3843dc[_0x39120d(0x2d5)]==='HEALTH_TRAIN_RESULT'){const {success:_0x30dd7b,details:_0x4d1577}=_0x3843dc[_0x39120d(0x23b)];if(_0x30dd7b)_0xc6cfd9[_0x39120d(0x206)][_0x39120d(0x196)](_0x39120d(0x1a8)+_0x4d1577);}else{if(_0x3843dc[_0x39120d(0x2d5)]===_0x39120d(0x1f8)){const {is_anomaly:_0x59420f,details:_0x460c0e}=_0x3843dc[_0x39120d(0x23b)];_0xc6cfd9['setStateAsync']('analysis.health.lastCheck',{'val':new Date()[_0x39120d(0x2b3)](),'ack':!![]}),_0xc6cfd9[_0x39120d(0x1b8)](_0x39120d(0x305),{'val':_0x59420f,'ack':!![]});}else{if(_0x3843dc[_0x39120d(0x2d5)]===_0x39120d(0x230)){const {diagnosis:_0x520f47,change_percent:_0x3f577a}=_0x3843dc['payload'];_0xc6cfd9[_0x39120d(0x206)][_0x39120d(0x196)](_0x39120d(0x2ee)+_0x520f47+'\x20('+_0x3f577a+'%)'),_0xc6cfd9[_0x39120d(0x1b8)](_0x39120d(0x29e),{'val':_0x520f47,'ack':!![]}),_0xc6cfd9[_0x39120d(0x1b8)](_0x39120d(0x26a),{'val':_0x3f577a,'ack':!![]});}}}}}}}}function sendToPython(_0xc9573e,_0x164724,_0x4b9c25={}){const _0x1d2cbd=a0_0x3c9476;if(!_0xc9573e['pythonProcess']||!_0xc9573e[_0x1d2cbd(0x22a)]['stdin']['writable'])return;const _0x38e58a=JSON[_0x1d2cbd(0x2c1)]({'command':_0x164724,..._0x4b9c25});try{_0xc9573e[_0x1d2cbd(0x22a)][_0x1d2cbd(0x28b)]['write'](_0x38e58a+'\x0a');}catch(_0x1a8a02){}}async function initSensorSubscriptions(_0x1c4053){const _0x1d98b7=a0_0x3c9476,_0x4c53b6=_0x1c4053[_0x1d98b7(0x223)]['devices'];if(_0x4c53b6)for(const _0x2077d4 of _0x4c53b6){await _0x1c4053['subscribeForeignStatesAsync'](_0x2077d4['id']);}}async function initPresenceSubscriptions(_0x49d64d){const _0x26f116=a0_0x3c9476,_0x5076dd=_0x49d64d[_0x26f116(0x223)][_0x26f116(0x262)];if(_0x5076dd)for(const _0x5ecdc6 of _0x5076dd){await _0x49d64d[_0x26f116(0x275)](_0x5ecdc6);}}async function setupTelegramListener(_0x1edfc3){const _0x225449=a0_0x3c9476,_0x51a12d=_0x1edfc3[_0x225449(0x223)]['notifyTelegramInstance'];if(_0x1edfc3[_0x225449(0x223)]['notifyTelegramEnabled']&&_0x51a12d)await _0x1edfc3[_0x225449(0x275)](_0x51a12d+_0x225449(0x2a0));}async function checkWifiPresence(_0x350e84){const _0x276877=a0_0x3c9476;try{const _0x572c33=_0x350e84[_0x276877(0x223)][_0x276877(0x262)]||[];let _0x55abee=![];const _0x57cd08=[];for(const _0x14ea8b of _0x572c33){try{const _0x366795=await _0x350e84[_0x276877(0x2dd)](_0x14ea8b);_0x366795&&(_0x366795[_0x276877(0x2fd)]===!![]||_0x366795[_0x276877(0x2fd)]===_0x276877(0x2bf)||_0x366795[_0x276877(0x2fd)]===0x1)&&(_0x55abee=!![],_0x57cd08[_0x276877(0x1d2)](_0x14ea8b));}catch(_0x481557){}}return await _0x350e84[_0x276877(0x1b8)]('system.presenceWho',{'val':_0x57cd08['join'](',\x20'),'ack':!![]}),_0x55abee&&(_0x350e84[_0x276877(0x1ad)]&&(_0x350e84[_0x276877(0x206)]['info'](_0x276877(0x1c2)),abortExitTimer(_0x350e84)),!_0x350e84[_0x276877(0x2e1)]&&_0x350e84[_0x276877(0x195)]===SYSTEM_MODES[_0x276877(0x20b)]&&await setPresence(_0x350e84,!![])),_0x55abee;}catch(_0x16b572){return![];}}function startExitTimer(_0x4225ff){const _0x176b10=a0_0x3c9476;abortExitTimer(_0x4225ff),_0x4225ff[_0x176b10(0x2bb)]=!![],_0x4225ff['exitGraceTimer']=setTimeout(()=>{const _0x30fea8=_0x176b10;_0x4225ff[_0x30fea8(0x2bb)]=![];},EXIT_GRACE_PERIOD_SECONDS*0x3e8),_0x4225ff[_0x176b10(0x1ad)]=setTimeout(()=>{const _0x997f34=_0x176b10;setPresence(_0x4225ff,![]),_0x4225ff[_0x997f34(0x1ad)]=null;},EXIT_TIMER_MINUTES*0x3c*0x3e8);}function abortExitTimer(_0x2b89b1){const _0x54d45a=a0_0x3c9476;if(_0x2b89b1[_0x54d45a(0x1ad)])clearTimeout(_0x2b89b1[_0x54d45a(0x1ad)]);if(_0x2b89b1[_0x54d45a(0x1b9)])clearTimeout(_0x2b89b1[_0x54d45a(0x1b9)]);_0x2b89b1[_0x54d45a(0x1ad)]=null,_0x2b89b1['exitGraceTimer']=null,_0x2b89b1['isGracePeriodActive']=![];}async function setPresence(_0x4bad07,_0x3ea2b1){const _0x1c9c88=a0_0x3c9476;if(_0x4bad07['isPresent']===_0x3ea2b1)return;_0x4bad07[_0x1c9c88(0x2e1)]=_0x3ea2b1,await _0x4bad07['setStateAsync']('system.isPresent',{'val':_0x3ea2b1,'ack':!![]});}async function executeAutomationAction(_0x519018){const _0x39a0f3=a0_0x3c9476;try{const _0xc5b602=await _0x519018[_0x39a0f3(0x191)](_0x39a0f3(0x2fc)),_0x2c7c71=await _0x519018[_0x39a0f3(0x191)](_0x39a0f3(0x2ef));if(_0xc5b602&&_0xc5b602[_0x39a0f3(0x2fd)]&&_0x2c7c71){const _0x137d61=_0xc5b602[_0x39a0f3(0x2fd)];let _0x53d690=_0x2c7c71[_0x39a0f3(0x2fd)];try{_0x53d690=JSON['parse'](_0x53d690);}catch(_0x248156){}_0x519018[_0x39a0f3(0x206)][_0x39a0f3(0x196)]('ü§ñ\x20BUTLER:\x20Executing\x20Action\x20->\x20'+_0x137d61+_0x39a0f3(0x298)+_0x53d690),await _0x519018['setForeignStateAsync'](_0x137d61,_0x53d690);}else _0x519018['log'][_0x39a0f3(0x31c)]('ü§ñ\x20BUTLER:\x20No\x20valid\x20target\x20ID\x20or\x20value\x20stored\x20for\x20execution.');}catch(_0xeb7fa9){_0x519018['log'][_0x39a0f3(0x29d)](_0x39a0f3(0x2c0)+_0xeb7fa9[_0x39a0f3(0x2f4)]);}}function a0_0x5812(){const _0x3b4f70=['NORMAL','[RESULT]','data','analysis.isAlert','status','getOverviewData','window','Last\x20raw\x20event','dutycycle','guest','Target\x20ID','endsWith','models/gemini-flash-latest','ltmLtbWindowDays','application/json','Kein\x20API\x20Key.','getForeignObjectAsync','getGenerativeModel','python','3380069wvZrkY','TRAIN_HEALTH','.\x20KONTEXT:\x20','\x20->\x20','isExit','config','.\x20DATEN:\x20Schlaf\x20','PRIORIT√ÑT:\x20Sicherheit.','Heating\x20Score','dependencyInstallInProgress','\x20Tage)','substring','pythonProcess','Train\x20Security','Train\x20Health','stderr','baselineDrift','scanDevices','TREND_RESULT','detected','generic','state','pop','Lernphase\x20(','systemConfig','Target\x20Value','sensorLastValues','Error\x20launching\x20Python:\x20','Anomaly\x20Score','payload','motion','forEach','loc','LTM.triggerDailyDigest','dailyDigests','set_temperature','analysis.training.status','values','level','delObjectAsync','temperature','admin.','LTM.trainingData.thermodynamics','javascript.','response','GUEST','kontakt','unknown','cancel','licht','analysis.training.triggerHealth','uuid','number','[PYTHON]\x20','apply','analysis.security','Gemini\x20Init\x20Error:\x20','analysis.automation.description','bewegung','presence','‚ùå\x20VENV\x20CREATION\x20FAILED.\x20Please\x20run:\x20sudo\x20apt\x20install\x20python3-venv','OK:\x20','events.history_debug_00','shift','python_service','getMonth','isProVersion','Fokus\x20auf\x20Komfort.','presenceDevices','\x20(Length:\x20','analysis.security.lastScore','logDuplicates','triggerBriefing','unload','KALENDER:\x20','Pattern\x20Detected','analysis.health.trendValue','exports','toLowerCase','Insulation\x20Score','cpu_feature_guard','sendTo','requirements.txt','27525oplrFq','Success:\x20','No\x20module\x20named','getHours','subscribeForeignStatesAsync','useCalendar','2CtNgpB','flot.','Trigger\x20Action','0\x203\x20*\x20*\x20*','analysis.automation.autoApply','Trigger\x20Analysis','text','‚ùå\x20PIP\x20INSTALL\x20FAILED:\x20','getObjectAsync','find','PARTY','map','join','Fokus\x20auf\x20Familienroutinen.','/100.\x20OUTPUT:\x20Text.','Bibliotheken\x20nicht\x20gefunden','working','Thermodynamics','[RECORDER]\x20Error\x20saving\x20sequence:\x20','licenseKey','stdin','telegram','light','path','setState','minDaysForBaseline','Failed:\x20','ack','Description','firmware','command','SECURITY_RESULT','sort','\x20=\x20','switch','ltmStbWindowDays','inactivityThresholdHours','filter','error','analysis.health.trendDiagnosis','376ZTsZso','.communicate.request','node-schedule','door','heating','some','Alert\x20Status','Adapter','getDate','splice','0\x204\x20*\x20*\x20*','Invalid\x20JSON:\x20','.data.table','analysis.automation.patternDetected','_calName','analysis.trigger','name','system.mode','stick_unreach','generateContent','toISOString','pip','toString','object','namespace','position','N/A','value','isGracePeriodActive','replace','outdoorSensorId','Analysiere\x20ausgewogen.','online','BUTLER\x20Execution\x20Error:\x20','stringify','platform','cogni-living','setHours','now','ENERGY_TRAIN_RESULT','info.','update','‚ö†Ô∏è\x20SECURITY\x20ALARM:\x20','existsSync','TRAIN_ENERGY','analysis.training.triggerEnergy','Scripts','Missing\x20data','reachable','fault','slice','heizung','27tCJMkd','icons-mfd.','type','System\x20Mode','simulateButler','driftDetails','Installing\x20dependencies\x20into\x20venv...','Generating\x20Morning\x20Briefing...','KI-Modell\x20nicht\x20initialisiert','location','getForeignStateAsync','lastAlertState','analysis.triggerBriefing','lampe','isPresent','automation.triggerAction','link_quality','toFixed','button','scriptEnabled','Activity\x20Summary','analysis.energy.heatingScore','indicator.alarm','sleepScore','config_pending','analysis.training','service.py','üêç\x20Guardian\x20Diagnosis:\x20','analysis.automation.targetValue','events.history','LTM.trainingData.sequences','[PYTHON\x20ERR]\x20','LTM.dailyDigests','message','onStateChange','driftAnalysisTimer','pr√§senz','Trigger\x20Briefing','üõ†Ô∏è\x20MAINTENANCE\x20MODE:\x20Installing\x20Python\x20dependencies.\x20Do\x20not\x20restart!','Keine\x20Termine','LTM.rawEventLog','analysis.automation.targetId','val','kill','geminiModel','Who\x20is\x20present?','klima','Auto\x20Apply','Last\x20Check','Raw\x20Log','analysis.health.isAnomaly','User\x20dismissed\x20automation\x20proposal.','üß†\x20Triggering\x20Security\x20Training...','üêç\x20Using\x20VENV\x20Python:\x20','VACATION','toLocaleTimeString','isArray','geminiApiKey','getFullYear','shutter',')\x20-\x20STRICT\x20ORDERING\x20FIX','analysisHistory','testContext','humidity','occupancy','getEnums','.venv','Alert\x20Reason','[PYTHON]\x20Exited\x20code\x20','System','analysis.energy.insulationScore','date','json','warn','629365xkqiFe','onReady','@google/generative-ai','calendarInstance','subscribeStates','trim','main','\x22\x20install\x20-r\x20\x22','extendObjectAsync','ical.0','rssi','fenster','getStateAsync','.\x20ZUSATZ:\x20','schalter','analysis.energy','currentSystemMode','info','string','eventHistory','analysis.training.triggerSecurity','LTM.driftAnalysis.baselineDrift','includes','timestamp','longitude','SIMULATION:\x20Test-Vorschlag\x20f√ºr\x20','N/A\x20(Learning)','36xCjyEN','round','split','analysis.security.lastCheck','Energy\x20Intelligence','ANOMALY','health','constructor','‚úÖ\x20HEALTH\x20TRAINED:\x20','LTM','text.alarm','rawEventLog','7587410NOHPdw','exitTimer','system','startsWith','currentposition','setObjectNotExistsAsync','TRAINING_COMPLETE','python3\x20-m\x20venv\x20\x22','Feedback:\x20','analysisTimer','aiPersona','analysis.alertReason','setStateAsync','exitGraceTimer','common','win32','debug','üêç\x20Python\x20Pong','Ungew√∂hnliches\x20Bewegungsmuster!\x20(Score:\x20','latitude','off','Restoring\x20sensor\x20cache\x20from\x20history\x20(','WiFi\x20Presence\x20detected.','678505mZFxpf','Err:\x20','parse','ltmJob','Health\x20Analysis','description','city','targetId','\x0aSTB:\x20','stateChange','850687wXjLTW','‚ö†Ô∏è\x20Python\x20missing\x20libs.\x20Auto-Install\x20triggered.','briefingJob','[LOG]','system.','push','LTM.driftAnalysis.driftDetails','vis.','Gemini\x20AI\x20initialized.','stdout','scriptProblem','channel','indicator','modeResetJob','PRIORIT√ÑT:\x20Gesundheit/AAL.','submitFeedback','analysis.health','getLtmData','t√ºr','callback','enum.functions.*','PONG','communicate.request','contact','connection','targetValue','boolean','fill','maintenance','1634152mvYADs','targetposition','getCalendarNames','Unknown','‚ö†Ô∏è\x20VENV\x20missing.\x20Attempting\x20install...','setpoint','Deaktiviert\x20(Pro-Feature)','üåÖ\x20Daily\x20Briefing:\x0a','Briefing\x20Error:\x20','system.presenceWho','apiKey','Sequences','testApiKey','Sec-Training\x20started...','HEALTH_RESULT','analysis.automation.triggerAction','from','normal','(((.+)+)+)+$','length','unreach','bind','LTM.processingStatus','Anomaly\x20Detected','system.config','276bzBPEx','echarts.','autoApply','log','devices','instance','getTime','onUnload'];a0_0x5812=function(){return _0x3b4f70;};return a0_0x5812();}async function runBaselineDriftAnalysis(_0x36b269){const _0x2238e8=a0_0x3c9476;if(!_0x36b269[_0x2238e8(0x260)]||!_0x36b269[_0x2238e8(0x2ff)])return;const _0x2f7436=_0x36b269[_0x2238e8(0x223)][_0x2238e8(0x29a)]||0xe;if(_0x36b269[_0x2238e8(0x240)][_0x2238e8(0x1fd)]<_0x2f7436+0x7){await _0x36b269[_0x2238e8(0x1b8)](LTM_DP_DRIFT_STATUS,{'val':_0x2238e8(0x19f),'ack':!![]});return;}const _0xe25f82=_0x36b269[_0x2238e8(0x240)]['slice'](-_0x2f7436),_0x304597=_0x36b269[_0x2238e8(0x240)][_0x2238e8(0x2d1)](0x0,_0x36b269[_0x2238e8(0x240)][_0x2238e8(0x1fd)]-_0x2f7436),_0x24311f='ROLLE:\x20Data\x20Scientist.\x20ZIEL:\x20Drift\x20erkennen.\x20SCHEMA:\x20{\x20\x22baselineDrift\x22:\x20\x22none|slight|significant|critical\x22,\x20\x22driftDetails\x22:\x20\x22string\x22\x20}\x0a\x0aLTB:\x20'+JSON[_0x2238e8(0x2c1)](_0x304597)+_0x2238e8(0x1cb)+JSON[_0x2238e8(0x2c1)](_0xe25f82);try{const _0x373ef4=await _0x36b269[_0x2238e8(0x2ff)]['generateContent'](_0x24311f),_0x561cad=JSON[_0x2238e8(0x1c5)](_0x373ef4[_0x2238e8(0x24a)][_0x2238e8(0x27d)]()[_0x2238e8(0x2bc)](/```json|```/g,'')[_0x2238e8(0x322)]());_0x561cad['baselineDrift']&&(await _0x36b269['setStateAsync'](LTM_DP_DRIFT_STATUS,{'val':_0x561cad[_0x2238e8(0x22e)],'ack':!![]}),await _0x36b269[_0x2238e8(0x1b8)](LTM_DP_DRIFT_DETAILS,{'val':_0x561cad[_0x2238e8(0x2d8)],'ack':!![]}),await _0x36b269[_0x2238e8(0x1b8)](LTM_DP_DRIFT_LAST_CHECK,{'val':Date[_0x2238e8(0x2c5)](),'ack':!![]}));}catch(_0x16912f){}}async function sendMorningBriefing(_0x49f3cb){const _0x276f05=a0_0x3c9476;if(!_0x49f3cb[_0x276f05(0x2ff)])return;_0x49f3cb['log'][_0x276f05(0x196)](_0x276f05(0x2da));const _0x162d16=_0x49f3cb[_0x276f05(0x240)]['length']>0x0?_0x49f3cb['dailyDigests'][_0x49f3cb[_0x276f05(0x240)][_0x276f05(0x1fd)]-0x1]:null,_0x2c3c24=_0x162d16&&_0x162d16[_0x276f05(0x1a6)]?_0x162d16[_0x276f05(0x1a6)][_0x276f05(0x2ea)]:_0x276f05(0x2b9),_0x54c23e=new Date();_0x54c23e[_0x276f05(0x2c4)](0x4,0x0,0x0,0x0);const _0x5a5601=_0x49f3cb[_0x276f05(0x198)][_0x276f05(0x29c)](_0x290a54=>new Date(_0x290a54[_0x276f05(0x19c)])>_0x54c23e),_0x44c813=PERSONA_MAPPING[_0x49f3cb[_0x276f05(0x223)][_0x276f05(0x1b6)]||_0x276f05(0x232)],_0x17b3cf=_0x49f3cb[_0x276f05(0x223)]['livingContext']||'',_0x466d4d=await getWeatherContext(_0x49f3cb),_0x48fe5d=await getCalendarContext(_0x49f3cb),_0x43e951='ROLLE:\x20Assistent.\x20AUFGABE:\x20Schreibe\x20\x22Guten\x20Morgen\x22-Nachricht.\x20PERSONA:\x20'+_0x44c813+_0x276f05(0x220)+_0x17b3cf+_0x276f05(0x192)+_0x466d4d+'\x20'+_0x48fe5d+_0x276f05(0x224)+_0x2c3c24+_0x276f05(0x285);try{const _0x11c1e8=await _0x49f3cb[_0x276f05(0x2ff)][_0x276f05(0x2b2)](_0x43e951),_0xb0c3b6=_0x276f05(0x1f1)+_0x11c1e8[_0x276f05(0x24a)][_0x276f05(0x27d)]()[_0x276f05(0x322)]();sendNotification(_0x49f3cb,_0xb0c3b6);}catch(_0x35eabf){_0x49f3cb['log'][_0x276f05(0x29d)](_0x276f05(0x1f2)+_0x35eabf['message']);}}async function getCalendarNames(_0x18adfc,_0x1d799e){const _0x2735e8=a0_0x3c9476;try{const _0x837394=await _0x18adfc['getForeignStateAsync'](_0x1d799e+_0x2735e8(0x2ab));if(_0x837394&&_0x837394[_0x2735e8(0x2fd)]){const _0x551147=JSON[_0x2735e8(0x1c5)](_0x837394['val']);if(Array['isArray'](_0x551147))return[...new Set(_0x551147[_0x2735e8(0x282)](_0x1310c3=>_0x1310c3[_0x2735e8(0x2ad)])[_0x2735e8(0x29c)](Boolean))][_0x2735e8(0x297)]();}}catch(_0x4e390d){}return[];}async function getCalendarContext(_0x129e15){const _0x1f257a=a0_0x3c9476;if(!_0x129e15[_0x1f257a(0x223)][_0x1f257a(0x276)])return'Kalender:\x20Deaktiviert';const _0x2dc95d=_0x129e15[_0x1f257a(0x223)][_0x1f257a(0x320)]||_0x1f257a(0x326);try{const _0x14f0c6=await _0x129e15[_0x1f257a(0x2dd)](_0x2dc95d+'.data.table');if(_0x14f0c6&&_0x14f0c6['val']){let _0x2e60e5=JSON['parse'](_0x14f0c6['val']);if(Array[_0x1f257a(0x30b)](_0x2e60e5)){if(_0x2e60e5['length']>0x0)return _0x1f257a(0x268)+_0x2e60e5[_0x1f257a(0x2d1)](0x0,0x3)[_0x1f257a(0x282)](_0x332d28=>_0x332d28['event'])[_0x1f257a(0x283)](',\x20');}}}catch(_0x42dfde){}return _0x1f257a(0x2fa);}async function saveFeedback(_0x460dc7,_0xf511c9){const _0x8e8b4a=a0_0x3c9476;_0x460dc7['log'][_0x8e8b4a(0x196)](_0x8e8b4a(0x1b4)+JSON[_0x8e8b4a(0x2c1)](_0xf511c9));}class CogniLiving extends utils[a0_0x3c9476(0x2a6)]{constructor(_0x2e084f){const _0x1cdb89=a0_0x3c9476;super({..._0x2e084f,'name':_0x1cdb89(0x2c3)}),this[_0x1cdb89(0x198)]=[],this[_0x1cdb89(0x310)]=[],this['rawEventLog']=[],this[_0x1cdb89(0x240)]=[],this[_0x1cdb89(0x238)]={},this[_0x1cdb89(0x236)]={'latitude':0x0,'longitude':0x0,'city':''},this[_0x1cdb89(0x2e1)]=!![],this[_0x1cdb89(0x1ad)]=null,this[_0x1cdb89(0x1b9)]=null,this[_0x1cdb89(0x2bb)]=![],this['genAI']=null,this['geminiModel']=null,this[_0x1cdb89(0x195)]=SYSTEM_MODES[_0x1cdb89(0x20b)],this[_0x1cdb89(0x260)]=![],this[_0x1cdb89(0x2de)]=![],this['systemUUID']=_0x1cdb89(0x24d),this[_0x1cdb89(0x1b5)]=null,this[_0x1cdb89(0x1c6)]=null,this['modeResetJob']=null,this['driftAnalysisTimer']=null,this[_0x1cdb89(0x1cf)]=null,this['pythonProcess']=null,this[_0x1cdb89(0x227)]=![],this['on']('ready',this[_0x1cdb89(0x31e)][_0x1cdb89(0x1ff)](this)),this['on'](_0x1cdb89(0x1cc),this[_0x1cdb89(0x2f5)][_0x1cdb89(0x1ff)](this)),this['on'](_0x1cdb89(0x267),this[_0x1cdb89(0x20a)][_0x1cdb89(0x1ff)](this)),this['on'](_0x1cdb89(0x2f4),this['onMessage'][_0x1cdb89(0x1ff)](this));}async[a0_0x3c9476(0x31e)](){const _0xffe783=a0_0x3c9476;this[_0xffe783(0x206)][_0xffe783(0x196)]('cogni-living\x20adapter\x20starting\x20(v'+this['version']+_0xffe783(0x30f)),await initZombies(this),this[_0xffe783(0x223)][_0xffe783(0x28a)]=this[_0xffe783(0x223)][_0xffe783(0x28a)]||'';try{this[_0xffe783(0x260)]=await checkLicense(this,this[_0xffe783(0x223)][_0xffe783(0x28a)]);}catch(_0x148e19){}if(!this[_0xffe783(0x223)][_0xffe783(0x29b)]||this[_0xffe783(0x223)][_0xffe783(0x29b)]<0.1)this[_0xffe783(0x223)][_0xffe783(0x29b)]=0xc;await initHistory(this),await initSystemConfig(this);if(this[_0xffe783(0x223)][_0xffe783(0x30c)])try{this['genAI']=new GoogleGenerativeAI(this[_0xffe783(0x223)][_0xffe783(0x30c)]),this['geminiModel']=this['genAI'][_0xffe783(0x21c)]({'model':GEMINI_MODEL,'generationConfig':{'responseMimeType':_0xffe783(0x219)}}),this[_0xffe783(0x206)][_0xffe783(0x196)](_0xffe783(0x1d5));}catch(_0x5b6a0c){this[_0xffe783(0x206)][_0xffe783(0x29d)](_0xffe783(0x256)+_0x5b6a0c[_0xffe783(0x2f4)]);}await createAllObjects(this),await loadSystemMode(this),await loadRawEventLog(this),await loadDailyDigests(this),this['subscribeStates']('analysis.trigger'),this[_0xffe783(0x321)](LTM_DP_TRIGGER_DIGEST),this[_0xffe783(0x321)](_0xffe783(0x2b0)),this[_0xffe783(0x321)](_0xffe783(0x2df)),this[_0xffe783(0x321)](_0xffe783(0x1f9)),this[_0xffe783(0x321)](_0xffe783(0x27b)),this[_0xffe783(0x321)](_0xffe783(0x199)),this[_0xffe783(0x321)]('analysis.training.triggerHealth'),this[_0xffe783(0x321)](_0xffe783(0x2cc)),await initSensorSubscriptions(this),await initPresenceSubscriptions(this),await setupTelegramListener(this),setTimeout(()=>checkWifiPresence(this),0x1388);if(this[_0xffe783(0x1b5)])clearInterval(this[_0xffe783(0x1b5)]);const _0x18f114=this[_0xffe783(0x223)]['analysisInterval']||0xf;_0x18f114>0x0&&(this['analysisTimer']=setInterval(()=>{runAutopilot(this);},_0x18f114*0x3c*0x3e8)),setupLtmScheduler(this),setupModeResetScheduler(this),setupDriftAnalysisScheduler(this),setupBriefingScheduler(this),startPythonService(this),setTimeout(()=>{const _0x465383=_0xffe783;if(this[_0x465383(0x22a)])runPythonHealthCheck(this);},0x1388);}['onUnload'](_0x3271ac){const _0x43159f=a0_0x3c9476;if(this[_0x43159f(0x1b5)])clearInterval(this['analysisTimer']);if(this[_0x43159f(0x2f6)])clearInterval(this['driftAnalysisTimer']);if(this[_0x43159f(0x1c6)])this['ltmJob'][_0x43159f(0x24e)]();if(this[_0x43159f(0x1da)])this[_0x43159f(0x1da)][_0x43159f(0x24e)]();if(this[_0x43159f(0x1cf)])this[_0x43159f(0x1cf)]['cancel']();if(this['exitTimer'])clearTimeout(this[_0x43159f(0x1ad)]);if(this['exitGraceTimer'])clearTimeout(this['exitGraceTimer']);stopPythonService(this),_0x3271ac();}async[a0_0x3c9476(0x2f5)](_0x41c172,_0x262519){const _0x13e970=a0_0x3c9476;if(!_0x262519)return;if(this[_0x13e970(0x227)])return;if(_0x41c172[_0x13e970(0x19b)](_0x13e970(0x28c))&&_0x41c172[_0x13e970(0x216)](_0x13e970(0x1e3))&&_0x262519[_0x13e970(0x2fd)]){await handleTelegramResponse(this,_0x262519['val']);return;}if(_0x41c172===this[_0x13e970(0x2b7)]+'.'+SYSTEM_DP_MODE){_0x262519[_0x13e970(0x2fd)]&&Object[_0x13e970(0x243)](SYSTEM_MODES)[_0x13e970(0x19b)](_0x262519[_0x13e970(0x2fd)])&&(this[_0x13e970(0x195)]=_0x262519[_0x13e970(0x2fd)],_0x262519[_0x13e970(0x2fd)]===SYSTEM_MODES[_0x13e970(0x309)]?await setPresence(this,![]):await setPresence(this,!![]));if(!_0x262519[_0x13e970(0x292)])this[_0x13e970(0x28f)](_0x41c172,{'val':this[_0x13e970(0x195)],'ack':!![]});return;}if(!_0x262519[_0x13e970(0x292)]){_0x41c172[_0x13e970(0x19b)]('analysis.trigger')&&_0x262519[_0x13e970(0x2fd)]&&(this[_0x13e970(0x28f)](_0x41c172,{'val':![],'ack':!![]}),runGeminiAnalysis(this));if(_0x41c172[_0x13e970(0x19b)]('triggerDailyDigest')&&_0x262519['val']){this[_0x13e970(0x28f)](_0x41c172,{'val':![],'ack':!![]});if(this[_0x13e970(0x260)])createDailyDigest(this);}_0x41c172[_0x13e970(0x19b)](_0x13e970(0x266))&&_0x262519[_0x13e970(0x2fd)]&&(this[_0x13e970(0x28f)](_0x41c172,{'val':![],'ack':!![]}),sendMorningBriefing(this));_0x41c172[_0x13e970(0x19b)](_0x13e970(0x2e2))&&_0x262519[_0x13e970(0x2fd)]&&(this[_0x13e970(0x28f)](_0x41c172,{'val':![],'ack':!![]}),executeAutomationAction(this));if(_0x41c172[_0x13e970(0x19b)](_0x13e970(0x199))&&_0x262519[_0x13e970(0x2fd)]){this['setState'](_0x41c172,{'val':![],'ack':!![]});if(!this[_0x13e970(0x260)])return;try{const _0x479577=await this[_0x13e970(0x191)](_0x13e970(0x2f1));if(_0x479577&&_0x479577[_0x13e970(0x2fd)]){const _0x121cfb=JSON[_0x13e970(0x1c5)](_0x479577[_0x13e970(0x2fd)]);this[_0x13e970(0x206)][_0x13e970(0x196)](_0x13e970(0x307)),this[_0x13e970(0x1b8)](_0x13e970(0x242),{'val':_0x13e970(0x1f7),'ack':!![]}),sendToPython(this,'TRAIN_SECURITY',{'sequences':_0x121cfb});}}catch(_0x2b90fe){this[_0x13e970(0x206)]['error']('Training\x20Error:\x20'+_0x2b90fe[_0x13e970(0x2f4)]);}}if(_0x41c172['includes'](_0x13e970(0x250))&&_0x262519['val']){this['setState'](_0x41c172,{'val':![],'ack':!![]});if(!this[_0x13e970(0x260)])return;try{const _0x282d0b=await this['getStateAsync'](LTM_DP_DAILY_DIGESTS);_0x282d0b&&_0x282d0b[_0x13e970(0x2fd)]&&sendToPython(this,_0x13e970(0x21f),{'digests':JSON[_0x13e970(0x1c5)](_0x282d0b[_0x13e970(0x2fd)])});}catch(_0x1657da){}}if(_0x41c172[_0x13e970(0x19b)](_0x13e970(0x2cc))&&_0x262519['val']){this['setState'](_0x41c172,{'val':![],'ack':!![]});if(!this['isProVersion'])return;try{const _0x11ce2b=await this[_0x13e970(0x191)](_0x13e970(0x248));_0x11ce2b&&_0x11ce2b[_0x13e970(0x2fd)]&&sendToPython(this,_0x13e970(0x2cb),{'points':JSON['parse'](_0x11ce2b[_0x13e970(0x2fd)])});}catch(_0x22ac73){}}return;}if(this[_0x13e970(0x223)][_0x13e970(0x262)]&&this[_0x13e970(0x223)][_0x13e970(0x262)]['includes'](_0x41c172)){await checkWifiPresence(this);return;}const _0x3fef78=(this[_0x13e970(0x223)][_0x13e970(0x207)]||[])[_0x13e970(0x280)](_0x398dbe=>_0x398dbe['id']===_0x41c172);if(_0x3fef78)processSensorEvent(this,_0x41c172,_0x262519,_0x3fef78);}async['onMessage'](_0xc944d8){const _0x15d178=a0_0x3c9476;if(typeof _0xc944d8===_0x15d178(0x2b6)&&_0xc944d8[_0x15d178(0x2f4)]){if(_0xc944d8[_0x15d178(0x295)]===_0x15d178(0x1f6)){const _0x3b1ceb=_0xc944d8[_0x15d178(0x2f4)][_0x15d178(0x1f4)]||this['config'][_0x15d178(0x30c)];if(!_0x3b1ceb)return this[_0x15d178(0x26f)](_0xc944d8[_0x15d178(0x1fa)],_0xc944d8[_0x15d178(0x295)],{'success':![],'message':_0x15d178(0x21a)},_0xc944d8[_0x15d178(0x1e0)]);try{const _0x43a14c=new GoogleGenerativeAI(_0x3b1ceb),_0x476fc1=_0x43a14c[_0x15d178(0x21c)]({'model':GEMINI_MODEL}),_0x4e2da6=await _0x476fc1[_0x15d178(0x2b2)]('Hello');this['sendTo'](_0xc944d8['from'],_0xc944d8[_0x15d178(0x295)],{'success':!![],'message':_0x15d178(0x25b)+_0x4e2da6['response']['text']()},_0xc944d8[_0x15d178(0x1e0)]);}catch(_0x1fbd03){this[_0x15d178(0x26f)](_0xc944d8[_0x15d178(0x1fa)],_0xc944d8[_0x15d178(0x295)],{'success':![],'message':_0x15d178(0x1c4)+_0x1fbd03[_0x15d178(0x2f4)]},_0xc944d8['callback']);}}else{if(_0xc944d8[_0x15d178(0x295)]===_0x15d178(0x311)){const _0x4eb6b4=await getWeatherContext(this),_0x41e09f=await getCalendarContext(this);this[_0x15d178(0x26f)](_0xc944d8[_0x15d178(0x1fa)],_0xc944d8[_0x15d178(0x295)],{'success':!![],'weather':_0x4eb6b4,'calendar':_0x41e09f},_0xc944d8[_0x15d178(0x1e0)]);}else{if(_0xc944d8[_0x15d178(0x295)]===_0x15d178(0x1de)){if(!this[_0x15d178(0x260)])return this[_0x15d178(0x26f)](_0xc944d8['from'],_0xc944d8[_0x15d178(0x295)],{'success':![],'isPro':![]},_0xc944d8[_0x15d178(0x1e0)]);let _0x30b314={'status':'N/A'};try{const _0x4feef6=await this[_0x15d178(0x191)](LTM_DP_DRIFT_STATUS);_0x30b314[_0x15d178(0x20f)]=_0x4feef6?_0x4feef6[_0x15d178(0x2fd)]:_0x15d178(0x2b9);}catch(_0x56e0be){}this[_0x15d178(0x26f)](_0xc944d8[_0x15d178(0x1fa)],_0xc944d8[_0x15d178(0x295)],{'success':!![],'isPro':!![],'dailyDigests':this[_0x15d178(0x240)],'driftAnalysis':_0x30b314,'analysisHistory':this['analysisHistory']},_0xc944d8['callback']);}else{if(_0xc944d8[_0x15d178(0x295)]===_0x15d178(0x210)){const _0x44b63d=this[_0x15d178(0x240)][_0x15d178(0x1fd)],_0x16787e=new Date(),_0x410b1f=new Date(_0x16787e[_0x15d178(0x30d)](),_0x16787e[_0x15d178(0x25f)](),_0x16787e[_0x15d178(0x2a7)]())[_0x15d178(0x209)](),_0x686f45=this[_0x15d178(0x1ab)]['filter'](_0x15d722=>new Date(_0x15d722[_0x15d178(0x19c)])[_0x15d178(0x209)]()>_0x410b1f)[_0x15d178(0x1fd)],_0x1521c8=new Array(0x18)[_0x15d178(0x1e8)](0x0);this[_0x15d178(0x1ab)][_0x15d178(0x23d)](_0x3b69d6=>{const _0x3e9ec6=_0x15d178,_0x1b6683=new Date(_0x3b69d6[_0x3e9ec6(0x19c)]);if(_0x1b6683[_0x3e9ec6(0x209)]()>_0x410b1f)_0x1521c8[_0x1b6683[_0x3e9ec6(0x274)]()]++;});let _0x430413={'status':'N/A'};try{const _0x53af41=await this[_0x15d178(0x191)](LTM_DP_DRIFT_STATUS);_0x430413[_0x15d178(0x20f)]=_0x53af41?_0x53af41['val']:_0x15d178(0x2b9);}catch(_0x25f470){}let _0x170ee5='';try{const _0x4cce9e=await this['getStateAsync']('system.presenceWho');_0x170ee5=_0x4cce9e?_0x4cce9e[_0x15d178(0x2fd)]:'';}catch(_0x1f860c){}let _0x2a6c9d=null;!this['geminiModel']&&(_0x2a6c9d=this[_0x15d178(0x223)][_0x15d178(0x30c)]?_0x15d178(0x2db):'Kein\x20API\x20Key!');let _0x192909={'detected':![],'description':'','targetId':'','targetValue':'','autoApply':![]};try{const _0x187c07=await this['getStateAsync'](_0x15d178(0x2ac));if(_0x187c07&&_0x187c07['val']){_0x192909[_0x15d178(0x231)]=!![];const _0x275ee2=await this['getStateAsync']('analysis.automation.description');_0x192909[_0x15d178(0x1c8)]=_0x275ee2?_0x275ee2['val']:'';const _0x11c97a=await this[_0x15d178(0x191)](_0x15d178(0x2fc));_0x192909[_0x15d178(0x1ca)]=_0x11c97a?_0x11c97a[_0x15d178(0x2fd)]:'';const _0x5b89ce=await this[_0x15d178(0x191)](_0x15d178(0x2ef));_0x192909[_0x15d178(0x1e6)]=_0x5b89ce?_0x5b89ce[_0x15d178(0x2fd)]:'';}const _0x423f6e=await this['getStateAsync'](_0x15d178(0x27b));_0x192909[_0x15d178(0x205)]=_0x423f6e?!!_0x423f6e[_0x15d178(0x2fd)]:![];}catch(_0x2d0bc8){}this[_0x15d178(0x26f)](_0xc944d8[_0x15d178(0x1fa)],_0xc944d8['command'],{'success':!![],'eventHistory':this[_0x15d178(0x198)][_0x15d178(0x2d1)](0x0,0xf),'stats':{'digestCount':_0x44b63d,'eventCountToday':_0x686f45,'hourlyActivity':_0x1521c8,'driftStatus':_0x430413['status'],'isPresent':this[_0x15d178(0x2e1)],'presenceWho':_0x170ee5,'minDays':this[_0x15d178(0x223)][_0x15d178(0x290)]||0x7,'stbDays':this[_0x15d178(0x223)][_0x15d178(0x29a)]||0xe,'ltbDays':this[_0x15d178(0x223)][_0x15d178(0x218)]||0x3c,'systemError':_0x2a6c9d},'automation':_0x192909},_0xc944d8[_0x15d178(0x1e0)]);}else{if(_0xc944d8['command']===_0x15d178(0x22f))try{const _0x392e7b=await scanForDevices(this,_0xc944d8[_0x15d178(0x2f4)]||{});this[_0x15d178(0x26f)](_0xc944d8[_0x15d178(0x1fa)],_0xc944d8[_0x15d178(0x295)],{'success':!![],'devices':_0x392e7b},_0xc944d8['callback']);}catch(_0x120b34){this[_0x15d178(0x26f)](_0xc944d8[_0x15d178(0x1fa)],_0xc944d8[_0x15d178(0x295)],{'success':![],'error':_0x120b34[_0x15d178(0x2f4)]},_0xc944d8['callback']);}else{if(_0xc944d8[_0x15d178(0x295)]===_0x15d178(0x314)){const _0x59626f=await this['getForeignObjectsAsync'](_0x15d178(0x1e1),'enum'),_0x5e3b07=[];if(_0x59626f)for(const _0x1fb4c2 in _0x59626f){const _0x473717=_0x59626f[_0x1fb4c2],_0x513653=(_0x473717['common']&&typeof _0x473717[_0x15d178(0x1ba)][_0x15d178(0x2af)]==='object'?_0x473717[_0x15d178(0x1ba)][_0x15d178(0x2af)]['de']:_0x473717[_0x15d178(0x1ba)][_0x15d178(0x2af)])||_0x473717['common'][_0x15d178(0x2af)];_0x5e3b07['push']({'id':_0x1fb4c2,'name':_0x513653});}this['sendTo'](_0xc944d8[_0x15d178(0x1fa)],_0xc944d8[_0x15d178(0x295)],{'success':!![],'enums':_0x5e3b07},_0xc944d8[_0x15d178(0x1e0)]);}else{if(_0xc944d8[_0x15d178(0x295)]===_0x15d178(0x1ec)){const _0x19ef30=_0xc944d8[_0x15d178(0x2f4)][_0x15d178(0x208)];if(!_0x19ef30)return this['sendTo'](_0xc944d8[_0x15d178(0x1fa)],_0xc944d8[_0x15d178(0x295)],{'success':![],'error':'No\x20instance'},_0xc944d8[_0x15d178(0x1e0)]);const _0x4330a4=await getCalendarNames(this,_0x19ef30);this[_0x15d178(0x26f)](_0xc944d8[_0x15d178(0x1fa)],_0xc944d8[_0x15d178(0x295)],{'success':!![],'names':_0x4330a4},_0xc944d8[_0x15d178(0x1e0)]);}else{if(_0xc944d8[_0x15d178(0x295)]===_0x15d178(0x2d7)){const {targetId:_0x21b207,targetValue:_0x3cf1ad}=_0xc944d8[_0x15d178(0x2f4)];this[_0x15d178(0x206)]['info']('üß™\x20Simulating\x20Butler\x20Proposal:\x20'+_0x21b207+_0x15d178(0x298)+_0x3cf1ad),await this['setStateAsync'](_0x15d178(0x2ac),{'val':!![],'ack':!![]}),await this[_0x15d178(0x1b8)](_0x15d178(0x257),{'val':_0x15d178(0x19e)+_0x21b207,'ack':!![]}),await this[_0x15d178(0x1b8)]('analysis.automation.targetId',{'val':_0x21b207,'ack':!![]}),await this[_0x15d178(0x1b8)](_0x15d178(0x2ef),{'val':_0x3cf1ad,'ack':!![]}),this[_0x15d178(0x26f)](_0xc944d8[_0x15d178(0x1fa)],_0xc944d8[_0x15d178(0x295)],{'success':!![]},_0xc944d8[_0x15d178(0x1e0)]);}else{if(_0xc944d8['command']===_0x15d178(0x1dc)){const {historyId:_0x4328f1,rating:_0x471f57,comment:_0x1d1ca4,alertReason:_0x41860c}=_0xc944d8[_0x15d178(0x2f4)];_0x4328f1&&_0x471f57?(await saveFeedback(this,{'timestamp':Date['now'](),'historyId':_0x4328f1,'rating':_0x471f57,'comment':_0x1d1ca4,'alertReason':_0x41860c}),this[_0x15d178(0x26f)](_0xc944d8['from'],_0xc944d8[_0x15d178(0x295)],{'success':!![]},_0xc944d8[_0x15d178(0x1e0)])):this['sendTo'](_0xc944d8[_0x15d178(0x1fa)],_0xc944d8['command'],{'success':![],'error':_0x15d178(0x2ce)},_0xc944d8[_0x15d178(0x1e0)]);}else _0xc944d8['command']==='dismissAutomation'&&(this[_0x15d178(0x206)]['info'](_0x15d178(0x306)),await this[_0x15d178(0x1b8)](_0x15d178(0x2ac),{'val':![],'ack':!![]}),await this[_0x15d178(0x1b8)](_0x15d178(0x257),{'val':'','ack':!![]}),this[_0x15d178(0x26f)](_0xc944d8['from'],_0xc944d8[_0x15d178(0x295)],{'success':!![]},_0xc944d8[_0x15d178(0x1e0)]));}}}}}}}}}}}if(require[a0_0x3c9476(0x323)]!==module)module[a0_0x3c9476(0x26b)]=_0x3a60e8=>new CogniLiving(_0x3a60e8);else new CogniLiving();