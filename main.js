const a0_0x2972dd=a0_0xe15d;(function(_0x19aecf,_0x295802){const _0x14c695=a0_0xe15d,_0x29785f=_0x19aecf();while(!![]){try{const _0x7dec29=parseInt(_0x14c695(0x24f))/0x1*(-parseInt(_0x14c695(0xce))/0x2)+parseInt(_0x14c695(0x1b6))/0x3+-parseInt(_0x14c695(0x250))/0x4+-parseInt(_0x14c695(0x1f0))/0x5+-parseInt(_0x14c695(0x11c))/0x6+-parseInt(_0x14c695(0x243))/0x7*(-parseInt(_0x14c695(0x25b))/0x8)+parseInt(_0x14c695(0x1ab))/0x9*(parseInt(_0x14c695(0x1e5))/0xa);if(_0x7dec29===_0x295802)break;else _0x29785f['push'](_0x29785f['shift']());}catch(_0x27f962){_0x29785f['push'](_0x29785f['shift']());}}}(a0_0x17ba,0x58c30));const a0_0xfbac50=(function(){let _0x194941=!![];return function(_0x161794,_0x290f57){const _0x1536ff=_0x194941?function(){const _0x2730b9=a0_0xe15d;if(_0x290f57){const _0x3daaf2=_0x290f57[_0x2730b9(0x171)](_0x161794,arguments);return _0x290f57=null,_0x3daaf2;}}:function(){};return _0x194941=![],_0x1536ff;};}()),a0_0x3904b1=a0_0xfbac50(this,function(){const _0x249de1=a0_0xe15d;return a0_0x3904b1[_0x249de1(0xd1)]()[_0x249de1(0x1b8)]('(((.+)+)+)+$')[_0x249de1(0xd1)]()[_0x249de1(0x217)](a0_0x3904b1)[_0x249de1(0x1b8)](_0x249de1(0x1c5));});function a0_0xe15d(_0x616eab,_0x2dc9ff){const _0x29fd76=a0_0x17ba();return a0_0xe15d=function(_0x3904b1,_0xfbac50){_0x3904b1=_0x3904b1-0xad;let _0x17bafe=_0x29fd76[_0x3904b1];return _0x17bafe;},a0_0xe15d(_0x616eab,_0x2dc9ff);}a0_0x3904b1();'use strict';const utils=require(a0_0x2972dd(0x239)),{GoogleGenerativeAI}=require(a0_0x2972dd(0x1f6)),schedule=require(a0_0x2972dd(0x234)),HISTORY_MAX_SIZE=0x32,RAW_LOG_MAX_SIZE=0x5dc,LTM_MIN_EVENTS_FOR_COMPRESSION=0x5,GEMINI_MODEL=a0_0x2972dd(0x248),LTM_SCHEDULE=a0_0x2972dd(0x1eb),MODE_RESET_SCHEDULE=a0_0x2972dd(0x13b),ANALYSIS_HISTORY_MAX_SIZE=0x64,LTM_DP_RAW_LOG=a0_0x2972dd(0x1f7),LTM_DP_DAILY_DIGESTS=a0_0x2972dd(0x1ca),LTM_DP_STATUS=a0_0x2972dd(0x12f),LTM_DP_TRIGGER_DIGEST=a0_0x2972dd(0x1d2),LTM_DP_BASELINE_STATUS=a0_0x2972dd(0xd7),LTM_DP_DRIFT_CHANNEL=a0_0x2972dd(0x14e),LTM_DP_DRIFT_STATUS=a0_0x2972dd(0x19c),LTM_DP_DRIFT_DETAILS=a0_0x2972dd(0x143),LTM_DP_DRIFT_LAST_CHECK=a0_0x2972dd(0x1cd),SYSTEM_DP_MODE=a0_0x2972dd(0x198),HARD_IGNORE_TERMS=[a0_0x2972dd(0xfb),a0_0x2972dd(0xcd),'update','unreach',a0_0x2972dd(0x18b),'rssi',a0_0x2972dd(0x11d),a0_0x2972dd(0x13c),a0_0x2972dd(0x212),a0_0x2972dd(0x252),a0_0x2972dd(0x24a),'direction',a0_0x2972dd(0xc0),'config_pending',a0_0x2972dd(0xb6),a0_0x2972dd(0x1d3),'reachable',a0_0x2972dd(0xd2)],BAD_NAMES=[a0_0x2972dd(0xc5),a0_0x2972dd(0x129),a0_0x2972dd(0x13a),a0_0x2972dd(0x1ed),'value',a0_0x2972dd(0x144),'on',a0_0x2972dd(0x1f9),a0_0x2972dd(0x1ce),'position',a0_0x2972dd(0x160),a0_0x2972dd(0x174),a0_0x2972dd(0x1d8),'status',a0_0x2972dd(0x197),a0_0x2972dd(0xec),'occupancy',a0_0x2972dd(0xe8),'humidity',a0_0x2972dd(0x1c4),a0_0x2972dd(0x18a),'setpoint',a0_0x2972dd(0x188),a0_0x2972dd(0x128),'set_temperature'],ADAPTER_BLACKLIST=[a0_0x2972dd(0xc7),'admin.','info.','vis.','history.',a0_0x2972dd(0x1b9),a0_0x2972dd(0x17f),a0_0x2972dd(0xb8),a0_0x2972dd(0x249),a0_0x2972dd(0x24b),'simple-api.'],SYSTEM_MODES={'NORMAL':a0_0x2972dd(0x11a),'VACATION':a0_0x2972dd(0x1e2),'PARTY':a0_0x2972dd(0x158),'GUEST':a0_0x2972dd(0x26a)},AUTO_RESET_MODES=[SYSTEM_MODES[a0_0x2972dd(0x231)],SYSTEM_MODES[a0_0x2972dd(0x134)]],PERSONA_MAPPING={'generic':a0_0x2972dd(0xd5),'senior_aal':a0_0x2972dd(0xe0),'family':'Fokus\x20auf\x20Familienroutinen,\x20Kindersicherheit\x20und\x20allgemeines\x20Haushaltsmanagement.','single_comfort':a0_0x2972dd(0x18c),'security':a0_0x2972dd(0x242)};class CogniLiving extends utils[a0_0x2972dd(0x147)]{constructor(_0x3ab67b){const _0x3f5030=a0_0x2972dd;super({..._0x3ab67b,'name':_0x3f5030(0x122)}),this[_0x3f5030(0x246)]=[],this[_0x3f5030(0x225)]=[],this[_0x3f5030(0xe5)]=[],this[_0x3f5030(0x100)]=[],this[_0x3f5030(0xe2)]=[],this['sensorLastValues']={},this['systemConfig']={'latitude':0x0,'longitude':0x0,'city':''},this[_0x3f5030(0xfd)]=!![],this[_0x3f5030(0x1a4)]=null,this['exitGraceTimer']=null,this[_0x3f5030(0x22b)]=![],this[_0x3f5030(0x1c2)]=null,this[_0x3f5030(0x101)]=null,this['currentSystemMode']=SYSTEM_MODES[_0x3f5030(0x112)],this[_0x3f5030(0x168)]=![],this[_0x3f5030(0x149)]=![],this[_0x3f5030(0x13e)]=_0x3f5030(0xbd),this[_0x3f5030(0x187)]=null,this['ltmJob']=null,this[_0x3f5030(0x247)]=null,this[_0x3f5030(0x1a7)]=null,this[_0x3f5030(0x1a3)]=null,this['on'](_0x3f5030(0x19d),this[_0x3f5030(0xc4)]['bind'](this)),this['on'](_0x3f5030(0x1cb),this[_0x3f5030(0xe7)][_0x3f5030(0x1c7)](this)),this['on'](_0x3f5030(0x148),this[_0x3f5030(0x113)][_0x3f5030(0x1c7)](this)),this['on']('message',this[_0x3f5030(0x15f)]['bind'](this));}async[a0_0x2972dd(0xc4)](){const _0xadb35e=a0_0x2972dd;this[_0xadb35e(0x1b5)][_0xadb35e(0x1e4)]('cogni-living\x20adapter\x20starting\x20(v'+this[_0xadb35e(0xe1)]+_0xadb35e(0x107)),await this[_0xadb35e(0x255)](),this['config'][_0xadb35e(0x21b)]=this[_0xadb35e(0x222)][_0xadb35e(0x21b)]||'';try{this[_0xadb35e(0x168)]=await this[_0xadb35e(0x1a6)](this[_0xadb35e(0x222)][_0xadb35e(0x21b)]);}catch(_0x1f1e0b){this[_0xadb35e(0x1b5)][_0xadb35e(0x212)](_0xadb35e(0x260)+_0x1f1e0b['message']);}if(!this[_0xadb35e(0x222)]['inactivityThresholdHours']||this['config']['inactivityThresholdHours']<0.1)this['config'][_0xadb35e(0x1f4)]=0xc;await this[_0xadb35e(0xd4)](),await this[_0xadb35e(0xaf)]();if(this['config']['geminiApiKey'])try{this['genAI']=new GoogleGenerativeAI(this['config'][_0xadb35e(0x17c)]),this[_0xadb35e(0x101)]=this[_0xadb35e(0x1c2)][_0xadb35e(0xca)]({'model':GEMINI_MODEL,'generationConfig':{'responseMimeType':_0xadb35e(0x1c3)}}),this[_0xadb35e(0x1b5)][_0xadb35e(0x1e4)](_0xadb35e(0x266));}catch(_0x275f6c){this[_0xadb35e(0x1b5)]['error'](_0xadb35e(0x1a2)+_0x275f6c[_0xadb35e(0xb3)]);}await this[_0xadb35e(0x1dc)](),await this[_0xadb35e(0x25d)](),await this[_0xadb35e(0x25e)](),await this[_0xadb35e(0xf9)](),this[_0xadb35e(0x220)](_0xadb35e(0x214)),this[_0xadb35e(0x220)](LTM_DP_TRIGGER_DIGEST),this[_0xadb35e(0x220)](_0xadb35e(0x198)),this['subscribeStates'](_0xadb35e(0x235)),await this['initSensorSubscriptions'](),await this[_0xadb35e(0x230)]();if(this[_0xadb35e(0x187)])clearInterval(this['analysisTimer']);const _0x30a1ec=this['config'][_0xadb35e(0xe6)]||0xf;_0x30a1ec>0x0&&(this[_0xadb35e(0x1b5)]['info'](_0xadb35e(0x25c)+_0x30a1ec+_0xadb35e(0xb7)+this['config'][_0xadb35e(0x1f4)]+'h.'),this[_0xadb35e(0x187)]=setInterval(()=>{const _0xdd3daa=_0xadb35e;this[_0xdd3daa(0x263)]();},_0x30a1ec*0x3c*0x3e8)),this['setupLtmScheduler'](),this[_0xadb35e(0xdf)](),this['setupDriftAnalysisScheduler'](),this[_0xadb35e(0x1f5)]();}[a0_0x2972dd(0x113)](_0x553407){const _0x16e6b5=a0_0x2972dd;if(this[_0x16e6b5(0x187)])clearInterval(this[_0x16e6b5(0x187)]);if(this['driftAnalysisTimer'])clearInterval(this['driftAnalysisTimer']);if(this[_0x16e6b5(0xe4)])this[_0x16e6b5(0xe4)][_0x16e6b5(0x1d7)]();if(this[_0x16e6b5(0x247)])this[_0x16e6b5(0x247)][_0x16e6b5(0x1d7)]();if(this[_0x16e6b5(0x1a3)])this[_0x16e6b5(0x1a3)][_0x16e6b5(0x1d7)]();if(this['exitTimer'])clearTimeout(this[_0x16e6b5(0x1a4)]);if(this[_0x16e6b5(0x18f)])clearTimeout(this[_0x16e6b5(0x18f)]);_0x553407();}async['onStateChange'](_0x21e2d2,_0x23316c){const _0x158484=a0_0x2972dd;if(!_0x23316c)return;if(_0x21e2d2===this[_0x158484(0x133)]+'.'+SYSTEM_DP_MODE){_0x23316c['val']&&Object['values'](SYSTEM_MODES)[_0x158484(0xda)](_0x23316c['val'])&&(this[_0x158484(0xbc)]=_0x23316c[_0x158484(0x244)],_0x23316c[_0x158484(0x244)]===SYSTEM_MODES['VACATION']?await this[_0x158484(0x170)](![]):await this[_0x158484(0x170)](!![]));if(!_0x23316c[_0x158484(0x195)])this[_0x158484(0x258)](_0x21e2d2,{'val':this['currentSystemMode'],'ack':!![]});return;}if(!_0x23316c[_0x158484(0x195)]){_0x21e2d2[_0x158484(0xda)]('analysis.trigger')&&_0x23316c[_0x158484(0x244)]&&(this['setState'](_0x21e2d2,{'val':![],'ack':!![]}),this[_0x158484(0x1e0)]());if(_0x21e2d2[_0x158484(0xda)](_0x158484(0x104))&&_0x23316c[_0x158484(0x244)]){this['setState'](_0x21e2d2,{'val':![],'ack':!![]});if(this[_0x158484(0x168)])this[_0x158484(0x145)]();}_0x21e2d2[_0x158484(0xda)](_0x158484(0x175))&&_0x23316c['val']&&(this['setState'](_0x21e2d2,{'val':![],'ack':!![]}),this['sendMorningBriefing']());return;}if(this['config'][_0x158484(0x22a)]&&this[_0x158484(0x222)]['presenceDevices'][_0x158484(0xda)](_0x21e2d2)){await this[_0x158484(0xcc)]();return;}const _0x1bfce0=(this[_0x158484(0x222)]['devices']||[])['find'](_0x1d2354=>_0x1d2354['id']===_0x21e2d2);if(_0x1bfce0)this[_0x158484(0x136)](_0x21e2d2,_0x23316c,_0x1bfce0);}async[a0_0x2972dd(0x15f)](_0x62b1fd){const _0x5e4e15=a0_0x2972dd;if(typeof _0x62b1fd===_0x5e4e15(0x26b)&&_0x62b1fd[_0x5e4e15(0xb3)])try{if(_0x62b1fd['command']===_0x5e4e15(0x14d)){if(!_0x62b1fd[_0x5e4e15(0xb3)][_0x5e4e15(0x20e)])return this['sendTo'](_0x62b1fd[_0x5e4e15(0x1ac)],_0x62b1fd[_0x5e4e15(0xef)],{'success':![],'message':_0x5e4e15(0x124)},_0x62b1fd[_0x5e4e15(0x1c6)]);try{const _0x57510d=new GoogleGenerativeAI(_0x62b1fd[_0x5e4e15(0xb3)][_0x5e4e15(0x20e)])[_0x5e4e15(0xca)]({'model':'models/gemini-flash-latest'});await _0x57510d[_0x5e4e15(0x1e3)](_0x5e4e15(0x116)),this[_0x5e4e15(0x17b)](_0x62b1fd[_0x5e4e15(0x1ac)],_0x62b1fd[_0x5e4e15(0xef)],{'success':!![],'message':_0x5e4e15(0x1fa)},_0x62b1fd[_0x5e4e15(0x1c6)]);}catch(_0x1702c3){this[_0x5e4e15(0x17b)](_0x62b1fd[_0x5e4e15(0x1ac)],_0x62b1fd[_0x5e4e15(0xef)],{'success':![],'message':_0x1702c3['message']},_0x62b1fd[_0x5e4e15(0x1c6)]);}}else{if(_0x62b1fd['command']==='testNotification'){const _0x39ae8d=await this[_0x5e4e15(0x19a)](_0x5e4e15(0x191),!![]);this[_0x5e4e15(0x17b)](_0x62b1fd[_0x5e4e15(0x1ac)],_0x62b1fd['command'],{'success':_0x39ae8d>0x0,'message':_0x39ae8d+_0x5e4e15(0x15b)},_0x62b1fd['callback']);}else{if(_0x62b1fd[_0x5e4e15(0xef)]===_0x5e4e15(0x1c1)){if(!this[_0x5e4e15(0x168)])return this['sendTo'](_0x62b1fd[_0x5e4e15(0x1ac)],_0x62b1fd['command'],{'success':![],'isPro':![]},_0x62b1fd['callback']);let _0x21f1c1={'status':_0x5e4e15(0x15a),'details':'','lastCheck':0x0};try{_0x21f1c1[_0x5e4e15(0xbe)]=(await this['getStateAsync'](LTM_DP_DRIFT_STATUS))[_0x5e4e15(0x244)],_0x21f1c1[_0x5e4e15(0x131)]=(await this['getStateAsync'](LTM_DP_DRIFT_DETAILS))['val'],_0x21f1c1[_0x5e4e15(0x132)]=(await this[_0x5e4e15(0x205)](LTM_DP_DRIFT_LAST_CHECK))['val'];}catch(_0x41665c){}const _0x367e7e=this[_0x5e4e15(0x225)]||[];this['sendTo'](_0x62b1fd['from'],_0x62b1fd['command'],{'success':!![],'isPro':!![],'dailyDigests':this[_0x5e4e15(0xe2)],'driftAnalysis':_0x21f1c1,'analysisHistory':_0x367e7e},_0x62b1fd[_0x5e4e15(0x1c6)]);}else{if(_0x62b1fd['command']===_0x5e4e15(0xdc)){const _0x1b0e09=this['dailyDigests'][_0x5e4e15(0x123)],_0x27c370=this[_0x5e4e15(0x246)]['filter'](_0xa17b0e=>_0xa17b0e[_0x5e4e15(0x176)]>new Date()[_0x5e4e15(0xc8)](0x0,0x0,0x0,0x0))[_0x5e4e15(0x123)];let _0x335efd={'status':_0x5e4e15(0x15a)};try{_0x335efd[_0x5e4e15(0xbe)]=(await this[_0x5e4e15(0x205)](LTM_DP_DRIFT_STATUS))[_0x5e4e15(0x244)];}catch(_0x55e2b4){}let _0x20648d=null;!this[_0x5e4e15(0x101)]&&(_0x20648d=this['config'][_0x5e4e15(0x17c)]?_0x5e4e15(0x1ee):'Kein\x20API\x20Key\x20konfiguriert!'),this[_0x5e4e15(0x17b)](_0x62b1fd[_0x5e4e15(0x1ac)],_0x62b1fd[_0x5e4e15(0xef)],{'success':!![],'eventHistory':this['eventHistory'][_0x5e4e15(0x150)](0x0,0xf),'stats':{'digestCount':_0x1b0e09,'eventCountToday':_0x27c370,'driftStatus':_0x335efd[_0x5e4e15(0xbe)],'isPresent':this[_0x5e4e15(0xfd)],'minDays':this[_0x5e4e15(0x222)][_0x5e4e15(0x169)]||0x7,'stbDays':this[_0x5e4e15(0x222)]['ltmStbWindowDays']||0xe,'ltbDays':this[_0x5e4e15(0x222)]['ltmLtbWindowDays']||0x3c,'systemError':_0x20648d}},_0x62b1fd[_0x5e4e15(0x1c6)]);}else{if(_0x62b1fd['command']===_0x5e4e15(0x226)){const _0x2242a3=await this['getForeignObjectsAsync'](_0x5e4e15(0x141),_0x5e4e15(0x10f)),_0x5e1571=[];if(_0x2242a3)for(const _0x12a418 in _0x2242a3){const _0x2be680=_0x2242a3[_0x12a418],_0x209a55=(_0x2be680[_0x5e4e15(0x257)]&&typeof _0x2be680['common'][_0x5e4e15(0x127)]===_0x5e4e15(0x26b)?_0x2be680[_0x5e4e15(0x257)]['name']['de']:_0x2be680[_0x5e4e15(0x257)][_0x5e4e15(0x127)])||_0x2be680['common'][_0x5e4e15(0x127)];_0x5e1571[_0x5e4e15(0x1f1)]({'id':_0x12a418,'name':_0x209a55});}this[_0x5e4e15(0x17b)](_0x62b1fd[_0x5e4e15(0x1ac)],_0x62b1fd[_0x5e4e15(0xef)],{'success':!![],'enums':_0x5e1571},_0x62b1fd['callback']);}else{if(_0x62b1fd[_0x5e4e15(0xef)]==='scanDevices')try{const _0x1e94df=await this[_0x5e4e15(0x139)](_0x62b1fd[_0x5e4e15(0xb3)]||{});this['sendTo'](_0x62b1fd[_0x5e4e15(0x1ac)],_0x62b1fd[_0x5e4e15(0xef)],{'success':!![],'devices':_0x1e94df},_0x62b1fd[_0x5e4e15(0x1c6)]);}catch(_0x40a685){this[_0x5e4e15(0x17b)](_0x62b1fd['from'],_0x62b1fd[_0x5e4e15(0xef)],{'success':![],'error':_0x40a685['message']},_0x62b1fd[_0x5e4e15(0x1c6)]);}else{if(_0x62b1fd['command']==='getCalendarNames'){const _0x45478b=_0x62b1fd[_0x5e4e15(0xb3)][_0x5e4e15(0xfe)];if(!_0x45478b)return this[_0x5e4e15(0x17b)](_0x62b1fd[_0x5e4e15(0x1ac)],_0x62b1fd[_0x5e4e15(0xef)],{'success':![],'error':'No\x20instance'},_0x62b1fd['callback']);const _0x13c06d=await this[_0x5e4e15(0x185)](_0x45478b);this[_0x5e4e15(0x17b)](_0x62b1fd[_0x5e4e15(0x1ac)],_0x62b1fd[_0x5e4e15(0xef)],{'success':!![],'names':_0x13c06d},_0x62b1fd['callback']);}}}}}}}}catch(_0x2ce543){this[_0x5e4e15(0x1b5)][_0x5e4e15(0x212)]('Error\x20in\x20onMessage\x20command\x20'+_0x62b1fd[_0x5e4e15(0xef)]+':\x20'+_0x2ce543[_0x5e4e15(0xb3)]);if(_0x62b1fd[_0x5e4e15(0x1c6)])this['sendTo'](_0x62b1fd[_0x5e4e15(0x1ac)],_0x62b1fd[_0x5e4e15(0xef)],{'success':![],'error':_0x2ce543[_0x5e4e15(0xb3)]},_0x62b1fd['callback']);}}async[a0_0x2972dd(0x136)](_0x354165,_0x1b2d4d,_0x3af811){const _0x54d54a=a0_0x2972dd;if(!_0x3af811[_0x54d54a(0x1bd)]&&this[_0x54d54a(0x137)][_0x354165]===_0x1b2d4d[_0x54d54a(0x244)])return;this['sensorLastValues'][_0x354165]=_0x1b2d4d[_0x54d54a(0x244)];if(this[_0x54d54a(0x22b)])return;const _0x2dcb6c=await this['checkWifiPresence']();if(_0x2dcb6c){if(!this[_0x54d54a(0xfd)])await this[_0x54d54a(0x170)](!![]);}else{const _0x3c8cae=_0x3af811[_0x54d54a(0x24c)]===!![];_0x3c8cae?this[_0x54d54a(0x265)]():(this['exitTimer']&&this['abortExitTimer'](),!this[_0x54d54a(0xfd)]&&this[_0x54d54a(0xbc)]===SYSTEM_MODES[_0x54d54a(0x112)]&&await this['setPresence'](!![]));}const _0x3df231={'timestamp':_0x1b2d4d['ts'],'id':_0x354165,'name':_0x3af811[_0x54d54a(0x127)],'value':_0x1b2d4d[_0x54d54a(0x244)],'location':_0x3af811[_0x54d54a(0xc6)],'type':_0x3af811['type']};this['eventHistory'][_0x54d54a(0x18d)](_0x3df231);if(this[_0x54d54a(0x246)][_0x54d54a(0x123)]>HISTORY_MAX_SIZE)this['eventHistory'][_0x54d54a(0x237)]();await this[_0x54d54a(0x19b)](_0x54d54a(0x1da),{'val':JSON[_0x54d54a(0x1fc)](_0x3df231),'ack':!![]}),await this[_0x54d54a(0x19b)]('events.history',{'val':JSON[_0x54d54a(0x1fc)](this[_0x54d54a(0x246)]),'ack':!![]}),this['rawEventLog']['push']({'timestamp':new Date(_0x1b2d4d['ts'])[_0x54d54a(0x216)](),'sensorName':_0x3af811['name'],'location':_0x3af811[_0x54d54a(0xc6)],'value':_0x1b2d4d[_0x54d54a(0x244)]}),await this[_0x54d54a(0x189)]();}async['runGeminiAnalysis'](_0x87e2b7=''){const _0x5f5416=a0_0x2972dd;if(!this[_0x5f5416(0x101)]){this[_0x5f5416(0x1b5)][_0x5f5416(0x22c)](_0x5f5416(0xfc));return;}const _0x261b84=this[_0x5f5416(0x246)]['length']>0x0?this[_0x5f5416(0x246)]:[{'note':_0x5f5416(0x1af)}],_0x2d86e8=PERSONA_MAPPING[this[_0x5f5416(0x222)][_0x5f5416(0x1dd)]||_0x5f5416(0xb9)],_0x3c54dc=this['config']['livingContext']||'',_0x2a22f7=this[_0x5f5416(0xbc)],_0x1ed4f8=await this['getWeatherContext'](),_0x1e6ac=await this['getCalendarContext'](),_0x4ad583=(_0x1ed4f8+'\x20'+_0x1e6ac)['trim'](),_0x5a62d4=new Date(),_0xdaf71=_0x5a62d4[_0x5f5416(0x209)](_0x5f5416(0x21f),{'weekday':'long','hour':_0x5f5416(0x102),'minute':'2-digit'});let _0x58abb9='Phase\x201:\x20Learning\x20(No\x20Baseline).\x20Rely\x20on\x20common\x20sense.';const _0x573340=this[_0x5f5416(0xe2)]['length'];if(this[_0x5f5416(0x168)]&&_0x573340>=(this[_0x5f5416(0x222)][_0x5f5416(0x169)]||0x7)){const _0x392413=this['dailyDigests'][_0x5f5416(0x150)](-(this[_0x5f5416(0x222)][_0x5f5416(0x126)]||0xe));_0x58abb9='Phase\x202:\x20ACUTE\x20MONITORING.\x20STB\x20(Last\x2014d):\x20'+JSON[_0x5f5416(0x1fc)](_0x392413)+'.',_0x573340>=0x1e&&(_0x58abb9+='\x20Phase\x203:\x20DRIFT\x20ACTIVE.\x20Compare\x20recent\x20events\x20against\x20long-term\x20patterns.');}const _0x567216=_0x5f5416(0x1db)+_0xdaf71+')\x20verdÃ¤chtig\x20still?\x20Erwartest\x20du\x20basierend\x20auf\x20der\x20Tageszeit\x20AktivitÃ¤t\x20(z.B.\x20Morgens\x20Aufstehen)?\x20Wenn\x20ja\x20->\x20ALARM.\x0a\x20\x20\x20\x20\x20\x20\x20\x202.\x20Akut\x20(vs.\x20STB):\x20Weicht\x20das\x20heutige\x20Verhalten\x20stark\x20von\x20den\x20letzten\x2014\x20Tagen\x20ab?\x20(z.B.\x205x\x20Toilette\x20statt\x203x).\x20Wenn\x20ja\x20->\x20WARNUNG.\x0a\x20\x20\x20\x20\x20\x20\x20\x203.\x20Schleichend\x20(Drift):\x20(Nur\x20relevant\x20wenn\x20Phase\x203\x20aktiv)\x20Gibt\x20es\x20einen\x20langsamen\x20Trend\x20ins\x20Negative?\x0a\x20\x20\x20\x20\x20\x20\x20\x20Ignoriere\x20Fehlalarme\x20durch\x20Kontext:\x20'+_0x4ad583+_0x5f5416(0xb5),_0x311737=_0x5f5416(0x221)+_0xdaf71+_0x5f5416(0x15e)+_0x2a22f7+_0x5f5416(0x1cf)+(this[_0x5f5416(0xfd)]?'Ja':'Nein')+'.\x20\x0a\x20\x20\x20\x20\x20\x20\x20\x20KONTEXT:\x20'+_0x3c54dc+_0x5f5416(0x155)+_0x2d86e8+_0x5f5416(0x1be)+_0x58abb9+'\x20'+(_0x87e2b7?_0x87e2b7:'')+_0x5f5416(0xb5)+_0x567216+_0x5f5416(0x193)+JSON[_0x5f5416(0x1fc)](_0x261b84)+_0x5f5416(0x1e6);try{const _0x4cc204=await this[_0x5f5416(0x101)][_0x5f5416(0x1e3)](_0x311737),_0x2e406b=_0x4cc204[_0x5f5416(0x151)][_0x5f5416(0x1e8)]()[_0x5f5416(0x12d)](/```json|```/g,'')[_0x5f5416(0x17a)](),_0x249c90=JSON[_0x5f5416(0x206)](_0x2e406b);await this[_0x5f5416(0x19b)]('analysis.lastResult',{'val':_0x2e406b,'ack':!![]}),await this['setStateAsync']('analysis.alertReason',{'val':_0x249c90['activity'][_0x5f5416(0x18e)]||'','ack':!![]}),await this['setStateAsync'](_0x5f5416(0x120),{'val':_0x249c90[_0x5f5416(0x1e9)][_0x5f5416(0x186)]||'N/A','ack':!![]});const _0x1b0897=_0x249c90[_0x5f5416(0x111)][_0x5f5416(0x1b7)],_0x3f9246=this['isProVersion']?_0x1b0897[_0x5f5416(0x1bc)]:![];await this['setStateAsync'](_0x5f5416(0x241),{'val':_0x3f9246,'ack':!![]});let _0x942e78=_0x5f5416(0x23b);this[_0x5f5416(0x168)]&&(_0x942e78=_0x3f9246?_0x1b0897['description']:'Keine\x20neuen\x20Automatisierungs-Muster\x20erkannt.');await this[_0x5f5416(0x19b)](_0x5f5416(0x21d),{'val':_0x942e78,'ack':!![]});if(_0x249c90['activity'][_0x5f5416(0x1b0)]||_0x249c90[_0x5f5416(0x1e9)]['isEmergency']){await this[_0x5f5416(0x19b)]('analysis.isAlert',{'val':!![],'ack':!![]});if(!this[_0x5f5416(0x149)]||_0x249c90[_0x5f5416(0x1e9)][_0x5f5416(0x103)]){const _0x232d13=_0x249c90[_0x5f5416(0x1e9)]['isEmergency']?'ðŸš¨ðŸš¨\x20NOTFALL':_0x5f5416(0x1bb);this[_0x5f5416(0x19a)](_0x232d13+':\x20'+_0x249c90[_0x5f5416(0x1e9)][_0x5f5416(0x18e)],![],_0x249c90[_0x5f5416(0x1e9)][_0x5f5416(0x103)]);}}else await this[_0x5f5416(0x19b)](_0x5f5416(0x236),{'val':![],'ack':!![]});this['lastAlertState']=_0x249c90[_0x5f5416(0x1e9)][_0x5f5416(0x1b0)]||_0x249c90[_0x5f5416(0x1e9)][_0x5f5416(0x103)];const _0x4ffbac={'timestamp':Date[_0x5f5416(0xc1)](),'id':Date[_0x5f5416(0xc1)]()[_0x5f5416(0xd1)](),'analysis':_0x249c90,'systemMode':_0x2a22f7,'isPro':this[_0x5f5416(0x168)]};this['updateAnalysisHistory'](_0x4ffbac);}catch(_0x330dec){this[_0x5f5416(0x1b5)][_0x5f5416(0x212)](_0x5f5416(0x240)+_0x330dec[_0x5f5416(0xb3)]);}}async[a0_0x2972dd(0x263)](){const _0x14acc1=a0_0x2972dd,_0x3d1dfe=this[_0x14acc1(0x222)][_0x14acc1(0x1f4)],_0x38ce98=this['eventHistory']['length']>0x0?this[_0x14acc1(0x246)][0x0][_0x14acc1(0x176)]:Date[_0x14acc1(0xc1)](),_0x30c94e=(Date[_0x14acc1(0xc1)]()-_0x38ce98)/(0x3e8*0x3c*0x3c);let _0x10e317='';this[_0x14acc1(0x222)][_0x14acc1(0x253)]&&this[_0x14acc1(0xbc)]===SYSTEM_MODES[_0x14acc1(0x112)]&&this[_0x14acc1(0xfd)]&&(_0x30c94e>_0x3d1dfe&&(_0x10e317=_0x14acc1(0x211)+_0x30c94e[_0x14acc1(0x110)](0x1)+_0x14acc1(0xad))),this[_0x14acc1(0x1e0)](_0x10e317)['catch'](_0x5c1733=>this['log'][_0x14acc1(0x212)](_0x5c1733));}async[a0_0x2972dd(0x145)](){const _0x102fd6=a0_0x2972dd;if(!this['isProVersion'])return;await this[_0x102fd6(0x19b)](LTM_DP_STATUS,{'val':_0x102fd6(0x264)+new Date()[_0x102fd6(0x209)](),'ack':!![]});if(!this[_0x102fd6(0x101)]||this[_0x102fd6(0x100)]['length']<LTM_MIN_EVENTS_FOR_COMPRESSION){await this[_0x102fd6(0x19b)](LTM_DP_STATUS,{'val':_0x102fd6(0x105),'ack':!![]});return;}const _0x4989e3=JSON[_0x102fd6(0x206)](JSON[_0x102fd6(0x1fc)](this['rawEventLog'])),_0x3e97d9=_0x4989e3[_0x102fd6(0x123)],_0x14b884='ROLLE:\x20Data\x20Compression\x20Agent.\x20SPRACHE:\x20DE.\x20FORMAT:\x20JSON.\x20ANWEISUNG:\x20Fasse\x20Sensor-Events\x20zusammen.\x20SCHEMA:\x20{\x20\x22summary\x22:\x20\x22string\x22,\x20\x22activityLevel\x22:\x20\x22string\x22\x20}\x20\x0a\x0aEVENTS:\x0a'+JSON[_0x102fd6(0x1fc)](_0x4989e3);try{const _0x1e52cd=await this[_0x102fd6(0x101)][_0x102fd6(0x1e3)](_0x14b884),_0x5871fd=JSON[_0x102fd6(0x206)](_0x1e52cd[_0x102fd6(0x151)][_0x102fd6(0x1e8)]()[_0x102fd6(0x12d)](/```json|```/g,'')[_0x102fd6(0x17a)]());_0x5871fd[_0x102fd6(0x186)]&&(this[_0x102fd6(0xe2)][_0x102fd6(0x1f1)]({'timestamp':new Date()[_0x102fd6(0x216)](),'eventCount':_0x3e97d9,'summary':_0x5871fd['summary'],'activityLevel':_0x5871fd[_0x102fd6(0xdd)],'systemMode':this[_0x102fd6(0xbc)]}),await this[_0x102fd6(0xcb)](),this[_0x102fd6(0x100)]=[],await this['saveRawEventLog'](),await this[_0x102fd6(0x19b)](LTM_DP_STATUS,{'val':_0x102fd6(0x117)+_0x3e97d9+'\x20events','ack':!![]}));}catch(_0x472edb){await this[_0x102fd6(0x19b)](LTM_DP_STATUS,{'val':'Error:\x20'+_0x472edb[_0x102fd6(0xb3)],'ack':!![]});}}async[a0_0x2972dd(0x229)](){const _0x5d1fd1=a0_0x2972dd;if(!this[_0x5d1fd1(0x101)])return;this[_0x5d1fd1(0x1b5)][_0x5d1fd1(0x1e4)](_0x5d1fd1(0x154));const _0xb5d7b4=this[_0x5d1fd1(0xe2)][_0x5d1fd1(0x123)]>0x0?this[_0x5d1fd1(0xe2)][this[_0x5d1fd1(0xe2)]['length']-0x1]:null,_0x40d4e6=_0xb5d7b4&&_0xb5d7b4[_0x5d1fd1(0x1ba)]?_0xb5d7b4[_0x5d1fd1(0x1ba)]['sleepScore']:_0x5d1fd1(0x15a),_0x46a0a2=new Date();_0x46a0a2[_0x5d1fd1(0xc8)](0x4,0x0,0x0,0x0);const _0x376ff3=this['eventHistory'][_0x5d1fd1(0x159)](_0x126eec=>new Date(_0x126eec[_0x5d1fd1(0x176)])>_0x46a0a2),_0x27700f=PERSONA_MAPPING[this['config'][_0x5d1fd1(0x1dd)]||'generic'],_0x102161=this['config'][_0x5d1fd1(0xb2)]||'',_0x4085ea=await this[_0x5d1fd1(0x25f)](),_0x29cf0b=await this[_0x5d1fd1(0x10d)](),_0x429935='ROLLE:\x20FÃ¼rsorglicher\x20Assistent.\x20AUFGABE:\x20Schreibe\x20eine\x20kurze,\x20beruhigende\x20\x22Guten\x20Morgen\x22-Nachricht.\x20PERSONA:\x20'+_0x27700f+_0x5d1fd1(0x1ff)+_0x102161+_0x5d1fd1(0x228)+_0x4085ea+'\x20'+_0x29cf0b+_0x5d1fd1(0x1df)+_0x40d4e6+'/100,\x20AktivitÃ¤t\x20seit\x2004:00:\x20'+JSON[_0x5d1fd1(0x1fc)](_0x376ff3[_0x5d1fd1(0x150)](0x0,0xa))+'.\x20OUTPUT:\x20Nur\x20Text.';try{const _0x46e24a=await this[_0x5d1fd1(0x101)][_0x5d1fd1(0x1e3)](_0x429935),_0x406dd2='ðŸŒ…\x20Daily\x20Briefing:\x0a'+_0x46e24a['response']['text']()[_0x5d1fd1(0x17a)]();this[_0x5d1fd1(0x19a)](_0x406dd2),this[_0x5d1fd1(0x1b5)]['info'](_0x5d1fd1(0x130));}catch(_0x242b4d){this['log'][_0x5d1fd1(0x212)](_0x5d1fd1(0x23f)+_0x242b4d[_0x5d1fd1(0xb3)]);}}async['scanForDevices'](_0xfaeefc){const _0x43b8f9=a0_0x2972dd;this[_0x43b8f9(0x1b5)][_0x43b8f9(0x1e4)](_0x43b8f9(0x13f));const _0x2071a7=[],_0x2cba49=await this['getForeignObjectsAsync']('*'),_0x358d08=await this['getForeignObjectsAsync'](_0x43b8f9(0x141),'enum'),_0x4c7841=await this[_0x43b8f9(0x262)](_0x43b8f9(0x1ae),_0x43b8f9(0x10f)),_0x373242={};if(_0x358d08)for(const _0x293807 in _0x358d08){const _0x534893=_0x358d08[_0x293807][_0x43b8f9(0x257)][_0x43b8f9(0x16e)]||[];_0x534893['forEach'](_0x435dd7=>{if(!_0x373242[_0x435dd7])_0x373242[_0x435dd7]=[];_0x373242[_0x435dd7]['push'](_0x293807);});}const _0x473289={};if(_0x4c7841)for(const _0x48f43d in _0x4c7841){const _0x5c3ae4=_0x4c7841[_0x48f43d][_0x43b8f9(0x257)][_0x43b8f9(0x16e)]||[],_0x174ea2=typeof _0x4c7841[_0x48f43d][_0x43b8f9(0x257)][_0x43b8f9(0x127)]==='object'?_0x4c7841[_0x48f43d][_0x43b8f9(0x257)]['name']['de']:_0x4c7841[_0x48f43d]['common'][_0x43b8f9(0x127)];_0x5c3ae4[_0x43b8f9(0xd6)](_0x4a3a29=>_0x473289[_0x4a3a29]=_0x174ea2);}const _0x1eba3f=_0xfaeefc['selectedFunctionIds']||[],_0x4cfac7=_0xfaeefc[_0x43b8f9(0x197)]!==![],_0x4c04f8=_0xfaeefc[_0x43b8f9(0x1d9)]!==![],_0x524229=_0xfaeefc[_0x43b8f9(0xf3)]!==![],_0x1373e4=_0xfaeefc[_0x43b8f9(0xe8)]===!![],_0xcdf630=_0xfaeefc['weather']===!![];for(const _0x41d572 in _0x2cba49){const _0x4947f4=_0x2cba49[_0x41d572];if(_0x4947f4[_0x43b8f9(0x1fd)]!=='state'||!_0x4947f4[_0x43b8f9(0x257)])continue;if(ADAPTER_BLACKLIST[_0x43b8f9(0xc9)](_0x5bbf57=>_0x41d572[_0x43b8f9(0x232)](_0x5bbf57))&&!_0xcdf630)continue;const _0x15ef50=(_0x4947f4[_0x43b8f9(0x257)][_0x43b8f9(0x16f)]||'')[_0x43b8f9(0x11b)]();let _0x14cc08=(typeof _0x4947f4[_0x43b8f9(0x257)][_0x43b8f9(0x127)]==='object'?_0x4947f4[_0x43b8f9(0x257)][_0x43b8f9(0x127)]['de']:_0x4947f4['common'][_0x43b8f9(0x127)])||_0x41d572;const _0x430345=_0x14cc08[_0x43b8f9(0x11b)]();let _0x53ac39=![],_0x507722=![];if(_0x1eba3f['length']>0x0){const _0x1b0d1a=_0x373242[_0x41d572]||[],_0x1f627a=_0x41d572[_0x43b8f9(0x1b1)]('.')['slice'](0x0,-0x1)[_0x43b8f9(0x25a)]('.'),_0x529b75=_0x373242[_0x1f627a]||[];(_0x1b0d1a['some'](_0xf34ca9=>_0x1eba3f[_0x43b8f9(0xda)](_0xf34ca9))||_0x529b75[_0x43b8f9(0xc9)](_0x8fc8be=>_0x1eba3f[_0x43b8f9(0xda)](_0x8fc8be)))&&(_0x53ac39=!![],_0x507722=!![]);}if(!_0x53ac39&&!_0xcdf630){if(HARD_IGNORE_TERMS[_0x43b8f9(0xc9)](_0x114cd5=>_0x41d572[_0x43b8f9(0xda)](_0x114cd5)||_0x430345[_0x43b8f9(0xda)](_0x114cd5[_0x43b8f9(0x11b)]())))continue;}if(BAD_NAMES[_0x43b8f9(0xc9)](_0xf4844f=>_0x430345===_0xf4844f||_0x430345[_0x43b8f9(0x1ad)]('.'+_0xf4844f))){const _0x455828=_0x41d572[_0x43b8f9(0x1b1)]('.');if(_0x455828[_0x43b8f9(0x123)]>0x2){const _0x38d79c=_0x455828[_0x43b8f9(0x150)](0x0,-0x1)['join']('.'),_0x5ebe56=_0x2cba49[_0x38d79c];if(_0x5ebe56&&_0x5ebe56[_0x43b8f9(0x257)]&&_0x5ebe56[_0x43b8f9(0x257)][_0x43b8f9(0x127)]){const _0x4a363b=typeof _0x5ebe56['common'][_0x43b8f9(0x127)]==='object'?_0x5ebe56[_0x43b8f9(0x257)][_0x43b8f9(0x127)]['de']:_0x5ebe56[_0x43b8f9(0x257)][_0x43b8f9(0x127)];_0x4a363b&&!_0x14cc08['includes'](_0x4a363b)&&(_0x14cc08=_0x4a363b+'\x20'+_0x14cc08);}}}let _0x6b20da='';if(_0x4cfac7&&(_0x15ef50[_0x43b8f9(0xda)](_0x43b8f9(0x197))||_0x15ef50['includes'](_0x43b8f9(0x20f))||_0x430345['includes'](_0x43b8f9(0x181))||_0x430345[_0x43b8f9(0xda)](_0x43b8f9(0x1a9))))_0x6b20da=_0x43b8f9(0x197);else{if(!_0x6b20da&&_0x4c04f8&&(_0x15ef50[_0x43b8f9(0xda)]('door')||_0x15ef50['includes'](_0x43b8f9(0xb1))||_0x15ef50[_0x43b8f9(0xda)](_0x43b8f9(0x23d))||_0x15ef50[_0x43b8f9(0xda)](_0x43b8f9(0x174))||_0x15ef50['includes'](_0x43b8f9(0x160))||_0x430345[_0x43b8f9(0xda)](_0x43b8f9(0x1c9))||_0x430345[_0x43b8f9(0xda)](_0x43b8f9(0xf4))||_0x430345[_0x43b8f9(0xda)](_0x43b8f9(0x1d6))))_0x6b20da=_0x43b8f9(0xf6);else{if(!_0x6b20da&&_0x524229&&(_0x15ef50[_0x43b8f9(0xda)]('light')||_0x15ef50[_0x43b8f9(0xda)](_0x43b8f9(0x1ce))||_0x15ef50[_0x43b8f9(0xda)](_0x43b8f9(0x138))||_0x430345[_0x43b8f9(0xda)](_0x43b8f9(0x1fb))||_0x430345[_0x43b8f9(0xda)]('lampe')||_0x430345[_0x43b8f9(0xda)](_0x43b8f9(0x204)))){if(_0x4947f4[_0x43b8f9(0x257)][_0x43b8f9(0x19f)]||_0x15ef50['includes'](_0x43b8f9(0x23c)))_0x6b20da=_0x43b8f9(0x254);}else{if(!_0x6b20da&&_0x1373e4&&(_0x15ef50[_0x43b8f9(0xda)](_0x43b8f9(0xe8))||_0x15ef50[_0x43b8f9(0xda)](_0x43b8f9(0x179))||_0x15ef50[_0x43b8f9(0xda)](_0x43b8f9(0x1a1))||_0x430345[_0x43b8f9(0xda)](_0x43b8f9(0xbb))||_0x430345[_0x43b8f9(0xda)](_0x43b8f9(0x109))||_0x430345['includes'](_0x43b8f9(0x1ef))))_0x6b20da=_0x43b8f9(0xe8);else{if(!_0x6b20da&&_0x507722)_0x6b20da=_0x43b8f9(0xf5);}}}}if(_0x6b20da){let _0x3e7340=_0x473289[_0x41d572]||'';if(!_0x3e7340){let _0x52a91f=_0x41d572;for(let _0x5ce052=0x0;_0x5ce052<0x3;_0x5ce052++){const _0x3f1660=_0x52a91f[_0x43b8f9(0x12c)]('.');if(_0x3f1660===-0x1)break;_0x52a91f=_0x52a91f[_0x43b8f9(0x227)](0x0,_0x3f1660);if(_0x473289[_0x52a91f]){_0x3e7340=_0x473289[_0x52a91f];break;}}}_0x2071a7[_0x43b8f9(0x1f1)]({'id':_0x41d572,'name':_0x14cc08,'location':_0x3e7340,'type':_0x6b20da,'logDuplicates':_0x6b20da===_0x43b8f9(0x197),'isExit':![],'_score':_0x3e7340?0x50:_0x6b20da===_0x43b8f9(0xf5)?0x5a:0x28});}}return _0x2071a7['sort']((_0x4ca6d0,_0x31c851)=>_0x31c851['_score']-_0x4ca6d0[_0x43b8f9(0x208)]),_0x2071a7;}['tryParse'](_0x532969){const _0x1ff61c=a0_0x2972dd;if(typeof _0x532969===_0x1ff61c(0x26b))return _0x532969;try{return JSON[_0x1ff61c(0x206)](_0x532969);}catch(_0xc9668f){return null;}}async[a0_0x2972dd(0x255)](){}async['initHistory'](){const _0x20bd95=a0_0x2972dd;try{const _0x3f3dea=await this[_0x20bd95(0x205)](_0x20bd95(0xdb));_0x3f3dea&&_0x3f3dea[_0x20bd95(0x244)]&&(this[_0x20bd95(0x246)]=JSON[_0x20bd95(0x206)](_0x3f3dea[_0x20bd95(0x244)][_0x20bd95(0xd1)]()));}catch(_0x53e39b){this['eventHistory']=[];}try{const _0x349b36=await this[_0x20bd95(0x205)](_0x20bd95(0xde));if(_0x349b36&&_0x349b36['val'])this[_0x20bd95(0x225)]=JSON[_0x20bd95(0x206)](_0x349b36[_0x20bd95(0x244)][_0x20bd95(0xd1)]());}catch(_0x3e1c72){this[_0x20bd95(0x225)]=[];}}async[a0_0x2972dd(0xaf)](){const _0x56697a=a0_0x2972dd;try{const _0x14fede=await this[_0x56697a(0xeb)](_0x56697a(0x1b3));_0x14fede&&_0x14fede['common']&&(this[_0x56697a(0x121)]={'latitude':_0x14fede['common'][_0x56697a(0x1e1)]||0x0,'longitude':_0x14fede[_0x56697a(0x257)][_0x56697a(0x21a)]||0x0,'city':_0x14fede[_0x56697a(0x257)]['city']||''});}catch(_0x491e1d){}}async['checkLicense'](_0x104573){const _0x4e2386=a0_0x2972dd;if(!_0x104573)return![];this[_0x4e2386(0x13e)]=await this[_0x4e2386(0x12b)]();if(_0x104573===_0x4e2386(0x114)||_0x104573['startsWith'](_0x4e2386(0x21e)))return!![];return![];}async[a0_0x2972dd(0x12b)](){const _0x54e871=a0_0x2972dd;try{const _0x47a0bc=await this[_0x54e871(0xeb)]('system.meta.uuid');if(_0x47a0bc&&_0x47a0bc[_0x54e871(0x203)]&&_0x47a0bc[_0x54e871(0x203)]['uuid'])return _0x47a0bc[_0x54e871(0x203)][_0x54e871(0xba)];return _0x54e871(0x106);}catch(_0x3d2c6e){return'uuid-error';}}async[a0_0x2972dd(0x1dc)](){const _0x35a22c=a0_0x2972dd;await this['checkSystemObjects'](),await this['setObjectNotExistsAsync'](_0x35a22c(0x1da),{'type':_0x35a22c(0x13a),'common':{'name':'Last\x20raw\x20event','type':'string','role':'json','read':!![],'write':![]},'native':{}}),await this['setObjectNotExistsAsync'](_0x35a22c(0xdb),{'type':_0x35a22c(0x13a),'common':{'name':'Event\x20History','type':_0x35a22c(0x224),'role':_0x35a22c(0x184),'read':!![],'write':![]},'native':{}}),await this[_0x35a22c(0x194)](_0x35a22c(0x214),{'type':_0x35a22c(0x13a),'common':{'name':'Trigger\x20Analysis','type':_0x35a22c(0x256),'role':'button','read':!![],'write':!![],'def':![]},'native':{}}),await this[_0x35a22c(0x194)]('analysis.triggerBriefing',{'type':_0x35a22c(0x13a),'common':{'name':'Trigger\x20Briefing\x20(Test)','type':_0x35a22c(0x256),'role':_0x35a22c(0xb4),'read':!![],'write':!![],'def':![]},'native':{}}),await this[_0x35a22c(0x194)](_0x35a22c(0xcf),{'type':_0x35a22c(0x13a),'common':{'name':_0x35a22c(0x10e),'type':_0x35a22c(0x224),'role':_0x35a22c(0x184),'read':!![],'write':![]},'native':{}}),await this[_0x35a22c(0x194)]('analysis.isAlert',{'type':_0x35a22c(0x13a),'common':{'name':'AI\x20Alert\x20Status','type':_0x35a22c(0x256),'role':_0x35a22c(0x1bf),'read':!![],'write':![],'def':![]},'native':{}}),await this[_0x35a22c(0x194)](_0x35a22c(0x140),{'type':_0x35a22c(0x13a),'common':{'name':_0x35a22c(0x218),'type':_0x35a22c(0x256),'role':_0x35a22c(0x200),'read':!![],'write':![],'def':![]},'native':{}}),await this[_0x35a22c(0x194)](_0x35a22c(0xf2),{'type':_0x35a22c(0x13a),'common':{'name':_0x35a22c(0x152),'type':_0x35a22c(0x224),'role':_0x35a22c(0x119),'read':!![],'write':![]},'native':{}}),await this[_0x35a22c(0x194)](_0x35a22c(0x120),{'type':_0x35a22c(0x13a),'common':{'name':_0x35a22c(0x177),'type':'string','role':'text','read':!![],'write':![]},'native':{}}),await this[_0x35a22c(0x194)]('analysis.deviationFromBaseline',{'type':_0x35a22c(0x13a),'common':{'name':_0x35a22c(0x182),'type':_0x35a22c(0x224),'role':'state','read':!![],'write':![],'def':_0x35a22c(0x15a)},'native':{}}),await this[_0x35a22c(0x194)](_0x35a22c(0x15c),{'type':_0x35a22c(0x13a),'common':{'name':_0x35a22c(0x1d5),'type':_0x35a22c(0x224),'role':_0x35a22c(0x1e8),'read':!![],'write':![]},'native':{}}),await this[_0x35a22c(0x194)](_0x35a22c(0xe3),{'type':_0x35a22c(0x13a),'common':{'name':_0x35a22c(0xd8),'type':_0x35a22c(0x224),'role':_0x35a22c(0x1e8),'read':!![],'write':![]},'native':{}}),await this[_0x35a22c(0x162)](_0x35a22c(0x196),{'type':_0x35a22c(0x1b2),'common':{'name':_0x35a22c(0x108)},'native':{}}),await this['setObjectNotExistsAsync'](_0x35a22c(0x241),{'type':_0x35a22c(0x13a),'common':{'name':_0x35a22c(0xee),'type':_0x35a22c(0x256),'role':'indicator','read':!![],'write':![],'def':![]},'native':{}}),await this[_0x35a22c(0x194)]('analysis.automation.description',{'type':_0x35a22c(0x13a),'common':{'name':_0x35a22c(0x269),'type':_0x35a22c(0x224),'role':_0x35a22c(0x1e8),'read':!![],'write':![]},'native':{}}),await this[_0x35a22c(0x194)]('analysis.automation.suggestedAction',{'type':_0x35a22c(0x13a),'common':{'name':_0x35a22c(0xd0),'type':'string','role':_0x35a22c(0x1e8),'read':!![],'write':![]},'native':{}}),await this[_0x35a22c(0x194)](_0x35a22c(0xde),{'type':_0x35a22c(0x13a),'common':{'name':'Logbook','type':'string','role':_0x35a22c(0x184),'read':!![],'write':![],'def':'[]'},'native':{}}),await this['setObjectNotExistsAsync'](_0x35a22c(0x1a0),{'type':_0x35a22c(0x13a),'common':{'name':'Feedback\x20Log','type':_0x35a22c(0x224),'role':_0x35a22c(0x184),'read':!![],'write':![],'def':'[]'},'native':{}}),await this['extendObjectAsync'](_0x35a22c(0x1de),{'type':_0x35a22c(0x1b2),'common':{'name':_0x35a22c(0x1f3)},'native':{}}),await this[_0x35a22c(0x194)]('analysis.health.sleepScore',{'type':_0x35a22c(0x13a),'common':{'name':_0x35a22c(0x1c8),'type':_0x35a22c(0x166),'role':_0x35a22c(0x267),'read':!![],'write':![],'def':0x0},'native':{}}),await this[_0x35a22c(0x194)]('analysis.health.restlessness',{'type':_0x35a22c(0x13a),'common':{'name':_0x35a22c(0x12a),'type':_0x35a22c(0x224),'role':_0x35a22c(0x1e8),'read':!![],'write':![],'def':_0x35a22c(0xd3)},'native':{}}),await this[_0x35a22c(0x194)](_0x35a22c(0xc3),{'type':_0x35a22c(0x13a),'common':{'name':_0x35a22c(0x135),'type':_0x35a22c(0x224),'role':_0x35a22c(0x1e8),'read':!![],'write':![],'def':''},'native':{}}),await this[_0x35a22c(0x10b)](),await this[_0x35a22c(0x14b)]();}async['checkSystemObjects'](){const _0x2cd48d=a0_0x2972dd;await this['extendObjectAsync']('system',{'type':'channel','common':{'name':_0x2cd48d(0x233)},'native':{}}),await this[_0x2cd48d(0x162)](SYSTEM_DP_MODE,{'type':_0x2cd48d(0x13a),'common':{'name':_0x2cd48d(0x156),'type':'string','role':_0x2cd48d(0x13a),'read':!![],'write':!![],'def':SYSTEM_MODES[_0x2cd48d(0x112)],'states':{[SYSTEM_MODES[_0x2cd48d(0x112)]]:_0x2cd48d(0x14a),[SYSTEM_MODES['VACATION']]:_0x2cd48d(0x20a),[SYSTEM_MODES['PARTY']]:_0x2cd48d(0x1f2),[SYSTEM_MODES[_0x2cd48d(0x134)]]:_0x2cd48d(0x1fe)}},'native':{}});}async[a0_0x2972dd(0x10b)](){const _0x323825=a0_0x2972dd;await this['extendObjectAsync'](_0x323825(0x11e),{'type':_0x323825(0x1b2),'common':{'name':_0x323825(0x11e)},'native':{}}),await this['extendObjectAsync'](LTM_DP_RAW_LOG,{'type':'state','common':{'name':'Raw\x20Log','type':_0x323825(0x224),'role':_0x323825(0x184),'read':!![],'write':![]},'native':{}}),await this[_0x323825(0x162)](LTM_DP_DAILY_DIGESTS,{'type':_0x323825(0x13a),'common':{'name':_0x323825(0x20d),'type':_0x323825(0x224),'role':_0x323825(0x184),'read':!![],'write':![]},'native':{}}),await this[_0x323825(0x162)](LTM_DP_STATUS,{'type':_0x323825(0x13a),'common':{'name':_0x323825(0x16c),'type':_0x323825(0x224),'role':'text','read':!![],'write':![]},'native':{}}),await this['extendObjectAsync'](LTM_DP_TRIGGER_DIGEST,{'type':'state','common':{'name':_0x323825(0xd9),'type':_0x323825(0x256),'role':'button','read':!![],'write':!![],'def':![]},'native':{}}),await this['extendObjectAsync'](LTM_DP_BASELINE_STATUS,{'type':'state','common':{'name':_0x323825(0x20b),'type':_0x323825(0x224),'role':'text','read':!![],'write':![]},'native':{}});}async[a0_0x2972dd(0x14b)](){const _0x1053e2=a0_0x2972dd;await this[_0x1053e2(0x162)](LTM_DP_DRIFT_CHANNEL,{'type':'channel','common':{'name':_0x1053e2(0x157)},'native':{}}),await this['extendObjectAsync'](LTM_DP_DRIFT_STATUS,{'type':_0x1053e2(0x13a),'common':{'name':_0x1053e2(0x125),'type':_0x1053e2(0x224),'role':_0x1053e2(0x13a),'read':!![],'write':![],'def':_0x1053e2(0x15a)},'native':{}}),await this['extendObjectAsync'](LTM_DP_DRIFT_DETAILS,{'type':_0x1053e2(0x13a),'common':{'name':_0x1053e2(0x10c),'type':_0x1053e2(0x224),'role':_0x1053e2(0x1e8),'read':!![],'write':![]},'native':{}}),await this[_0x1053e2(0x162)](LTM_DP_DRIFT_LAST_CHECK,{'type':'state','common':{'name':_0x1053e2(0x259),'type':_0x1053e2(0x166),'role':_0x1053e2(0x13d),'read':!![],'write':![]},'native':{}});}async[a0_0x2972dd(0x25d)](){const _0xcfc3ba=a0_0x2972dd;try{const _0x812961=await this[_0xcfc3ba(0x205)](SYSTEM_DP_MODE);_0x812961&&_0x812961[_0xcfc3ba(0x244)]&&Object[_0xcfc3ba(0x201)](SYSTEM_MODES)[_0xcfc3ba(0xda)](_0x812961[_0xcfc3ba(0x244)])?this['currentSystemMode']=_0x812961[_0xcfc3ba(0x244)]:(this['currentSystemMode']=SYSTEM_MODES[_0xcfc3ba(0x112)],await this['setStateAsync'](SYSTEM_DP_MODE,{'val':SYSTEM_MODES[_0xcfc3ba(0x112)],'ack':!![]}));}catch(_0x22da4e){this['currentSystemMode']=SYSTEM_MODES['NORMAL'];}}async['loadRawEventLog'](){const _0x43722c=a0_0x2972dd;try{const _0x119cb5=await this['getStateAsync'](LTM_DP_RAW_LOG);if(_0x119cb5&&_0x119cb5[_0x43722c(0x244)])this[_0x43722c(0x100)]=JSON[_0x43722c(0x206)](_0x119cb5['val']);}catch(_0x401c8d){this[_0x43722c(0x100)]=[];}}async[a0_0x2972dd(0xf9)](){const _0x386d8a=a0_0x2972dd;try{const _0x252d78=await this['getStateAsync'](LTM_DP_DAILY_DIGESTS);if(_0x252d78&&_0x252d78[_0x386d8a(0x244)])this['dailyDigests']=JSON[_0x386d8a(0x206)](_0x252d78['val']);}catch(_0x3e3e4b){this[_0x386d8a(0xe2)]=[];}await this[_0x386d8a(0x163)]();}async[a0_0x2972dd(0x189)](){const _0x593e8a=a0_0x2972dd;this[_0x593e8a(0x100)]['length']>RAW_LOG_MAX_SIZE&&this['rawEventLog'][_0x593e8a(0xff)](0x0,this[_0x593e8a(0x100)]['length']-RAW_LOG_MAX_SIZE),await this[_0x593e8a(0x19b)](LTM_DP_RAW_LOG,{'val':JSON[_0x593e8a(0x1fc)](this[_0x593e8a(0x100)]),'ack':!![]});}async['saveDailyDigests'](_0x46ca89=!![]){const _0x273b3a=a0_0x2972dd,_0x20df69=this[_0x273b3a(0x222)][_0x273b3a(0x238)]||0x3c;this[_0x273b3a(0xe2)][_0x273b3a(0x123)]>_0x20df69&&this[_0x273b3a(0xe2)][_0x273b3a(0xff)](0x0,this[_0x273b3a(0xe2)][_0x273b3a(0x123)]-_0x20df69);await this[_0x273b3a(0x19b)](LTM_DP_DAILY_DIGESTS,{'val':JSON['stringify'](this[_0x273b3a(0xe2)]),'ack':!![]});if(_0x46ca89)await this[_0x273b3a(0x163)]();}async['updateAnalysisHistory'](_0x1e5b09){const _0x4a2c8c=a0_0x2972dd;this[_0x4a2c8c(0x225)]['unshift'](_0x1e5b09);if(this[_0x4a2c8c(0x225)]['length']>ANALYSIS_HISTORY_MAX_SIZE)this[_0x4a2c8c(0x225)][_0x4a2c8c(0x237)]();await this[_0x4a2c8c(0x19b)]('analysis.analysisHistory',{'val':JSON['stringify'](this[_0x4a2c8c(0x225)]),'ack':!![]});}async[a0_0x2972dd(0x163)](){const _0x218cfb=a0_0x2972dd;if(!this[_0x218cfb(0x168)]){await this['setStateAsync'](LTM_DP_BASELINE_STATUS,{'val':_0x218cfb(0x164),'ack':!![]});return;}const _0x137dab=this['dailyDigests']['length']>=(this[_0x218cfb(0x222)]['minDaysForBaseline']||0x7)?_0x218cfb(0x22f)+this[_0x218cfb(0xe2)][_0x218cfb(0x123)]+'\x20Tage)':'Lernphase\x20('+this['dailyDigests'][_0x218cfb(0x123)]+'/'+(this[_0x218cfb(0x222)]['minDaysForBaseline']||0x7)+')';await this[_0x218cfb(0x19b)](LTM_DP_BASELINE_STATUS,{'val':_0x137dab,'ack':!![]});}async[a0_0x2972dd(0x190)](){const _0x138ceb=a0_0x2972dd,_0x48e6a6=this[_0x138ceb(0x222)][_0x138ceb(0x1e7)];if(_0x48e6a6&&_0x48e6a6['length']>0x0){this[_0x138ceb(0x1b5)][_0x138ceb(0x1e4)](_0x138ceb(0x213)+_0x48e6a6['length']+_0x138ceb(0x115));for(const _0xe9221b of _0x48e6a6){if(_0xe9221b['id']){await this['subscribeForeignStatesAsync'](_0xe9221b['id']);try{const _0x170c5d=await this[_0x138ceb(0x245)](_0xe9221b['id']);if(_0x170c5d)this[_0x138ceb(0x137)][_0xe9221b['id']]=_0x170c5d[_0x138ceb(0x244)];}catch(_0x49e649){}}}}}async[a0_0x2972dd(0x230)](){const _0x5c474e=a0_0x2972dd,_0x5d9c24=this[_0x5c474e(0x222)][_0x5c474e(0x22a)]||[];if(_0x5d9c24[_0x5c474e(0x123)]>0x0){this[_0x5c474e(0x1b5)][_0x5c474e(0x1e4)]('Subscribing\x20to\x20'+_0x5d9c24[_0x5c474e(0x123)]+_0x5c474e(0x16a));for(const _0x53bf3d of _0x5d9c24){await this[_0x5c474e(0x23e)](_0x53bf3d);}try{await this[_0x5c474e(0xcc)]();}catch(_0x38d6a9){}}}async[a0_0x2972dd(0x25f)](){const _0x580f65=a0_0x2972dd;try{if(!this['config'][_0x580f65(0x202)])return _0x580f65(0x22e);let _0x373204='';const _0x215e44=this[_0x580f65(0x222)][_0x580f65(0x10a)];if(_0x215e44)try{if(_0x215e44['includes'](_0x580f65(0x22d))){const _0x17292d=await this[_0x580f65(0x245)](_0x215e44+_0x580f65(0xc2));if(_0x17292d&&_0x17292d[_0x580f65(0x244)])_0x373204=_0x17292d[_0x580f65(0x244)];}else{if(_0x215e44[_0x580f65(0xda)]('daswetter')){const _0x16778b=await this[_0x580f65(0x245)](_0x215e44+_0x580f65(0x19e));if(_0x16778b&&_0x16778b[_0x580f65(0x244)])_0x373204=_0x16778b[_0x580f65(0x244)];}else{if(_0x215e44[_0x580f65(0xda)](_0x580f65(0x16b))){const _0x43f1aa=await this[_0x580f65(0x245)](_0x215e44+'.forecast.current.state');if(_0x43f1aa&&_0x43f1aa[_0x580f65(0x244)])_0x373204=_0x43f1aa[_0x580f65(0x244)];}}}}catch(_0x3ebb9a){}if(!_0x373204){const _0x5c77f9=[_0x580f65(0x1cc),_0x580f65(0x23a),'weatherunderground.0',_0x580f65(0xed)];for(const _0x45d269 of _0x5c77f9){try{const _0x4f3d2d=await this[_0x580f65(0xeb)](_0x45d269);if(_0x4f3d2d){if(_0x45d269[_0x580f65(0xda)](_0x580f65(0x22d))){const _0x2062c8=await this['getForeignStateAsync'](_0x45d269+_0x580f65(0xc2));if(_0x2062c8&&_0x2062c8[_0x580f65(0x244)]){_0x373204=_0x2062c8[_0x580f65(0x244)];break;}}}}catch(_0xc86418){}}}return _0x373204?_0x580f65(0x153)+_0x373204:'WETTER:\x20Keine\x20Daten\x20gefunden';}catch(_0x350590){return _0x580f65(0x183)+_0x350590['message'];}}async[a0_0x2972dd(0x10d)](){const _0xb32254=a0_0x2972dd;try{if(!this['config'][_0xb32254(0x17d)])return _0xb32254(0xf0);let _0x201a40=this['config'][_0xb32254(0xf7)]||_0xb32254(0x192),_0x4cf502=this[_0xb32254(0x222)]['calendarSelection']||[];if(typeof _0x4cf502===_0xb32254(0x224))_0x4cf502=_0x4cf502['split'](',');try{const _0x471c49=await this['getForeignStateAsync'](_0x201a40+_0xb32254(0x223));if(_0x471c49&&_0x471c49[_0xb32254(0x244)]){let _0x30f87e=this['tryParse'](_0x471c49[_0xb32254(0x244)]);if(_0x30f87e&&Array['isArray'](_0x30f87e)){if(_0x4cf502['length']>0x0)_0x30f87e=_0x30f87e[_0xb32254(0x159)](_0x6969d9=>_0x4cf502['includes'](_0x6969d9['_calName']||''));else return _0xb32254(0x167);if(_0x30f87e[_0xb32254(0x123)]>0x0){const _0x56e71e=_0x30f87e[_0xb32254(0x150)](0x0,0x3)['map'](_0x4a004c=>{const _0x22ee62=_0xb32254;let _0x2346a0=_0x4a004c[_0x22ee62(0x13d)];if(_0x4a004c[_0x22ee62(0x1f8)])_0x2346a0+='\x20'+_0x4a004c['time'];return _0x2346a0+':\x20'+_0x4a004c[_0x22ee62(0xea)]+'\x20('+_0x4a004c['_calName']+')';});return _0xb32254(0xae)+_0x56e71e[_0xb32254(0x25a)]('\x20|\x20');}else return'KALENDER:\x20Keine\x20relevanten\x20Termine';}}}catch(_0x15ba89){this[_0xb32254(0x1b5)][_0xb32254(0x22c)](_0xb32254(0x142)+_0x15ba89[_0xb32254(0xb3)]);}return'KALENDER:\x20Keine\x20Daten';}catch(_0x4abf79){return _0xb32254(0xf1)+_0x4abf79[_0xb32254(0xb3)];}}async[a0_0x2972dd(0x185)](_0x1b0914){const _0x436558=a0_0x2972dd;try{const _0x532e0b=await this[_0x436558(0x245)](_0x1b0914+_0x436558(0x223));if(_0x532e0b&&_0x532e0b[_0x436558(0x244)]){const _0x2280d3=this['tryParse'](_0x532e0b[_0x436558(0x244)]);if(_0x2280d3&&Array['isArray'](_0x2280d3)){const _0x3ec244=[...new Set(_0x2280d3[_0x436558(0x1d4)](_0x3155e9=>_0x3155e9[_0x436558(0x1b4)])['filter'](Boolean))];return _0x3ec244['sort']();}}return[];}catch(_0x345421){return this[_0x436558(0x1b5)][_0x436558(0x212)](_0x436558(0x146)+_0x345421['message']),[];}}async[a0_0x2972dd(0xcc)](){const _0x4d68d9=a0_0x2972dd;try{const _0x338a74=this[_0x4d68d9(0x222)][_0x4d68d9(0x22a)]||[];let _0x5e8cbe=![];for(const _0x3f3220 of _0x338a74){try{const _0x247f67=await this[_0x4d68d9(0x245)](_0x3f3220);if(_0x247f67&&(_0x247f67[_0x4d68d9(0x244)]===!![]||_0x247f67[_0x4d68d9(0x244)]===_0x4d68d9(0xbf)||_0x247f67['val']===0x1)){_0x5e8cbe=!![];break;}}catch(_0x1b523c){}}return _0x5e8cbe&&(this['exitTimer']&&(this[_0x4d68d9(0x1b5)][_0x4d68d9(0x1e4)]('WiFi\x20Presence\x20detected\x20->\x20Aborting\x20Exit\x20Timer.\x20User\x20is\x20present.'),this[_0x4d68d9(0x215)]()),!this[_0x4d68d9(0xfd)]&&this[_0x4d68d9(0xbc)]===SYSTEM_MODES[_0x4d68d9(0x112)]&&await this[_0x4d68d9(0x170)](!![])),_0x5e8cbe;}catch(_0x1573ef){return this[_0x4d68d9(0x1b5)][_0x4d68d9(0x212)](_0x4d68d9(0x210)+_0x1573ef[_0x4d68d9(0xb3)]),![];}}[a0_0x2972dd(0x265)](){const _0x3cccd6=a0_0x2972dd;this[_0x3cccd6(0x215)](),this[_0x3cccd6(0x22b)]=!![],this['exitGraceTimer']=setTimeout(()=>{const _0x3aca76=_0x3cccd6;this[_0x3aca76(0x22b)]=![];},EXIT_GRACE_PERIOD_SECONDS*0x3e8),this[_0x3cccd6(0x1a4)]=setTimeout(()=>{const _0x27a805=_0x3cccd6;this['setPresence'](![]),this[_0x27a805(0x1a4)]=null;},EXIT_TIMER_MINUTES*0x3c*0x3e8);}['abortExitTimer'](){const _0x5cee74=a0_0x2972dd;if(this[_0x5cee74(0x1a4)])clearTimeout(this['exitTimer']);if(this[_0x5cee74(0x18f)])clearTimeout(this[_0x5cee74(0x18f)]);this[_0x5cee74(0x1a4)]=null,this[_0x5cee74(0x18f)]=null,this[_0x5cee74(0x22b)]=![];}async[a0_0x2972dd(0x170)](_0x104bff){const _0x578240=a0_0x2972dd;if(this[_0x578240(0xfd)]===_0x104bff)return;this[_0x578240(0xfd)]=_0x104bff,await this['setStateAsync'](_0x578240(0x1c0),{'val':_0x104bff,'ack':!![]});}async[a0_0x2972dd(0x1aa)](_0x4df605){const _0x4d0fc9=a0_0x2972dd;this[_0x4d0fc9(0x1b5)]['info'](_0x4d0fc9(0x17e)+JSON[_0x4d0fc9(0x1fc)](_0x4df605));}async[a0_0x2972dd(0x1d0)](){const _0x41c1ba=a0_0x2972dd;if(!this[_0x41c1ba(0x168)]||!this['geminiModel'])return;const _0x18f7fc=this[_0x41c1ba(0x222)][_0x41c1ba(0x126)]||0xe;if(this[_0x41c1ba(0xe2)][_0x41c1ba(0x123)]<_0x18f7fc+(this[_0x41c1ba(0x222)]['minDaysForBaseline']||0x7)){await this[_0x41c1ba(0x19b)](LTM_DP_DRIFT_STATUS,{'val':_0x41c1ba(0x268),'ack':!![]});return;}const _0x2502d4=this[_0x41c1ba(0xe2)][_0x41c1ba(0x150)](-_0x18f7fc),_0x30b730=this[_0x41c1ba(0xe2)][_0x41c1ba(0x150)](0x0,this['dailyDigests'][_0x41c1ba(0x123)]-_0x18f7fc),_0x5afd7b=_0x41c1ba(0x219)+JSON[_0x41c1ba(0x1fc)](_0x30b730)+_0x41c1ba(0x118)+JSON[_0x41c1ba(0x1fc)](_0x2502d4);try{const _0x24f938=await this['geminiModel']['generateContent'](_0x5afd7b),_0x4a2eee=JSON[_0x41c1ba(0x206)](_0x24f938[_0x41c1ba(0x151)][_0x41c1ba(0x1e8)]()[_0x41c1ba(0x12d)](/```json|```/g,'')[_0x41c1ba(0x17a)]());_0x4a2eee[_0x41c1ba(0xb0)]&&(await this[_0x41c1ba(0x19b)](LTM_DP_DRIFT_STATUS,{'val':_0x4a2eee['baselineDrift'],'ack':!![]}),await this[_0x41c1ba(0x19b)](LTM_DP_DRIFT_DETAILS,{'val':_0x4a2eee[_0x41c1ba(0xe9)],'ack':!![]}),await this[_0x41c1ba(0x19b)](LTM_DP_DRIFT_LAST_CHECK,{'val':Date[_0x41c1ba(0xc1)](),'ack':!![]}));}catch(_0x474aed){}}[a0_0x2972dd(0x12e)](){const _0x4e8958=a0_0x2972dd;try{if(this[_0x4e8958(0xe4)])this['ltmJob'][_0x4e8958(0x1d7)]();if(!this[_0x4e8958(0x168)]){this['setStateAsync'](LTM_DP_STATUS,{'val':_0x4e8958(0x164),'ack':!![]});return;}this[_0x4e8958(0xe4)]=schedule['scheduleJob'](LTM_SCHEDULE,()=>this['createDailyDigest']());}catch(_0x573b4a){this[_0x4e8958(0x1b5)][_0x4e8958(0x212)](_0x4e8958(0x178)+_0x573b4a[_0x4e8958(0xb3)]);}}[a0_0x2972dd(0xdf)](){const _0x33ee80=a0_0x2972dd;try{if(this['modeResetJob'])this[_0x33ee80(0x247)]['cancel']();this[_0x33ee80(0x247)]=schedule['scheduleJob'](MODE_RESET_SCHEDULE,async()=>{const _0x3d02c2=_0x33ee80;await this[_0x3d02c2(0x25d)](),AUTO_RESET_MODES[_0x3d02c2(0xda)](this[_0x3d02c2(0xbc)])&&await this[_0x3d02c2(0x19b)](SYSTEM_DP_MODE,{'val':SYSTEM_MODES[_0x3d02c2(0x112)],'ack':![]});});}catch(_0x18d18e){this[_0x33ee80(0x1b5)][_0x33ee80(0x212)]('Reset\x20Sched\x20Error:\x20'+_0x18d18e[_0x33ee80(0xb3)]);}}['setupDriftAnalysisScheduler'](){const _0x5c6a71=a0_0x2972dd;try{if(this['driftAnalysisTimer'])clearInterval(this[_0x5c6a71(0x1a7)]);if(!this[_0x5c6a71(0x168)])return;this[_0x5c6a71(0x1a7)]=setInterval(()=>this['runBaselineDriftAnalysis'](),(this['config']['ltmDriftCheckIntervalHours']||0x18)*0x36ee80),setTimeout(()=>this['runBaselineDriftAnalysis'](),0x1388);}catch(_0x55de55){this[_0x5c6a71(0x1b5)]['error'](_0x5c6a71(0x207)+_0x55de55[_0x5c6a71(0xb3)]);}}['setupBriefingScheduler'](){const _0x5b2e9a=a0_0x2972dd;try{if(this[_0x5b2e9a(0x1a3)])this['briefingJob'][_0x5b2e9a(0x1d7)]();if(!this[_0x5b2e9a(0x222)][_0x5b2e9a(0x165)])return;const _0x5e1769=(this[_0x5b2e9a(0x222)][_0x5b2e9a(0x1ea)]||_0x5b2e9a(0x24d))[_0x5b2e9a(0x1b1)](':'),_0x5bdad5=parseInt(_0x5e1769[0x0])||0x8,_0x29195e=parseInt(_0x5e1769[0x1])||0x0,_0x4966fd=_0x29195e+'\x20'+_0x5bdad5+'\x20*\x20*\x20*';this['log'][_0x5b2e9a(0x1e4)](_0x5b2e9a(0x14f)+_0x5bdad5+':'+(_0x29195e<0xa?'0'+_0x29195e:_0x29195e)),this[_0x5b2e9a(0x1a3)]=schedule[_0x5b2e9a(0x251)](_0x4966fd,()=>{this['sendMorningBriefing']();});}catch(_0xb48bef){this[_0x5b2e9a(0x1b5)][_0x5b2e9a(0x212)](_0x5b2e9a(0x21c)+_0xb48bef['message']);}}async[a0_0x2972dd(0x19a)](_0x4aa23e,_0x1931a0=![],_0x215b10=![]){const _0x4db9d0=a0_0x2972dd;this[_0x4db9d0(0x1b5)][_0x4db9d0(0x1e4)]((_0x1931a0?_0x4db9d0(0x1a8):'')+'Sending\x20notification:\x20\x22'+_0x4aa23e+'\x22');const _0x57fe43=this['config'];let _0x530978=0x0;_0x57fe43[_0x4db9d0(0x1a5)]&&(await this[_0x4db9d0(0x1ec)](_0x57fe43[_0x4db9d0(0x24e)],_0x4db9d0(0xfa),{'text':_0x4aa23e,'user':_0x57fe43[_0x4db9d0(0x199)]}),_0x530978++);if(_0x57fe43[_0x4db9d0(0x161)]){let _0x363918={'message':_0x4aa23e,'title':_0x215b10?_0x4db9d0(0x15d):'Cogni-Living','priority':_0x215b10?0x2:0x1,'device':_0x57fe43[_0x4db9d0(0x261)]};_0x215b10&&(_0x363918['retry']=0x1e,_0x363918[_0x4db9d0(0x11f)]=0xe10,_0x363918[_0x4db9d0(0x172)]=_0x4db9d0(0x20c)),await this[_0x4db9d0(0x1ec)](_0x57fe43[_0x4db9d0(0x14c)],_0x4db9d0(0xfa),_0x363918),_0x530978++;}return _0x57fe43[_0x4db9d0(0x16d)]&&(await this[_0x4db9d0(0x1ec)](_0x57fe43[_0x4db9d0(0x180)],_0x4db9d0(0xfa),{'text':_0x4aa23e,'to':_0x57fe43[_0x4db9d0(0x1d1)]}),_0x530978++),_0x530978;}}function a0_0x17ba(){const _0x5cb03a=['flot.','generic','uuid','temp','currentSystemMode','unknown','status','online','stick_unreach','now','.Summary.Current','analysis.health.notes','onReady','targetposition','location','system.','setHours','some','getGenerativeModel','saveDailyDigests','checkWifiPresence','scriptEnabled','1058914ogHvPw','analysis.lastResult','Action','toString','link_quality','none','initHistory','Analysiere\x20ausgewogen\x20auf\x20Gesundheit,\x20Sicherheit\x20und\x20Komfort.','forEach','LTM.baselineStatus','Comfort\x20Suggestion','Trigger\x20Digest','includes','events.history','getOverviewData','activityLevel','analysis.analysisHistory','setupModeResetScheduler','PRIORITÃ„T:\x20Gesundheit\x20und\x20Sicherheit\x20fÃ¼r\x20Senioren\x20(AAL).\x20Erkenne\x20InaktivitÃ¤t,\x20potenzielle\x20StÃ¼rze\x20(indirekt),\x20Schlafunterbrechungen\x20und\x20nÃ¤chtliche\x20Unruhe.','version','dailyDigests','analysis.comfortSuggestion','ltmJob','feedbackHistory','analysisInterval','onStateChange','temperature','driftDetails','event','getForeignObjectAsync','presence','openweathermap.0','Pattern\x20Detected','command','Kalender:\x20Deaktiviert','KALENDER\x20ERROR:\x20','analysis.alertReason','lights','tÃ¼r','custom','door','calendarInstance','main','loadDailyDigests','send','scriptProblem','Triggered\x20analysis\x20but\x20Gemini\x20AI\x20is\x20not\x20initialized!\x20Check\x20API\x20Key.','isPresent','instance','splice','rawEventLog','geminiModel','2-digit','isEmergency','triggerDailyDigest','Skipped\x20(No\x20AI\x20or\x20Data)','uuid-not-found',')\x20-\x20OBFUSCATION\x20SAFE\x20MODE','Automation\x20Proposals','klima','weatherInstance','checkLtmObjects','Drift\x20Details','getCalendarContext','Last\x20Result','enum','toFixed','comfort','NORMAL','onUnload','TEST-PRO-KEY','\x20sensors...','test','Success:\x20Compressed\x20','\x0aSTB:\x20','text.alarm','normal','toLowerCase','2103144gMuZPX','connection','LTM','expire','analysis.activitySummary','systemConfig','cogni-living','length','No\x20Key','Drift\x20Status','ltmStbWindowDays','name','actual_temperature','currentposition','Restlessness\x20Level','getSystemUUID','lastIndexOf','replace','setupLtmScheduler','LTM.processingStatus','Morning\x20Briefing\x20sent.','details','lastCheck','namespace','GUEST','Health\x20Notes','processSensorEvent','sensorLastValues','dimmer','scanForDevices','state','0\x204\x20*\x20*\x20*','maintenance','date','systemUUID','Scanning\x20for\x20devices\x20(V7:\x20Basics\x20+\x20Explicit\x20Whitelist)...','analysis.isEmergency','enum.functions.*','Error\x20reading\x20calendar\x20table:\x20','LTM.driftAnalysis.driftDetails','brightness','createDailyDigest','getCalendarNames\x20Error:\x20','Adapter','unload','lastAlertState','Normal','checkLtmDriftObjects','notifyPushoverInstance','testApiKey','LTM.driftAnalysis','Scheduling\x20Morning\x20Briefing\x20for\x20','slice','response','Alert\x20Reason','WETTER:\x20','Generating\x20Morning\x20Briefing...','.\x20PERSONA:\x20','System\x20Mode','Drift\x20Analysis','party','filter','N/A','\x20sent','analysis.comfortSummary','ðŸš¨\x20EMERGENCY','.\x20MODUS:\x20','onMessage','shutter','notifyPushoverEnabled','extendObjectAsync','updateBaselineStatus','Deaktiviert\x20(Pro-Feature)','briefingEnabled','number','KALENDER:\x20Keine\x20Kalender\x20ausgewÃ¤hlt\x20(Bitte\x20in\x20Settings\x20konfigurieren)','isProVersion','minDaysForBaseline','\x20presence\x20devices...','openweathermap','Processing\x20Status','notifyEmailEnabled','members','role','setPresence','apply','sound','exports','blind','triggerBriefing','timestamp','Activity\x20Summary','LTM\x20Sched\x20Error:\x20','humidity','trim','sendTo','geminiApiKey','useCalendar','Feedback\x20saved:\x20','icons-mfd.','notifyEmailInstance','bewegung','Deviation','WETTER\x20ERROR:\x20','json','getCalendarNames','summary','analysisTimer','valve','saveRawEventLog','energy','lowbat','Fokus\x20auf\x20Maximierung\x20von\x20Komfort,\x20Automatisierungseffizienz\x20und\x20Energieeinsparung.','unshift','alertReason','exitGraceTimer','initSensorSubscriptions','[Test]\x20Notification','ical.0','\x0a\x20\x20\x20\x20\x20\x20\x20\x20EVENTS:\x20','setObjectNotExistsAsync','ack','analysis.automation','motion','system.mode','notifyTelegramRecipient','sendNotification','setStateAsync','LTM.driftAnalysis.baselineDrift','ready','.NextHours.Location_1.Day_1.current.symbol_desc','write','analysis.feedbackHistory','thermostat','Gemini\x20Init\x20Error:\x20','briefingJob','exitTimer','notifyTelegramEnabled','checkLicense','driftAnalysisTimer','[TEST]\x20','prÃ¤senz','saveFeedback','13758732VroxRi','from','endsWith','enum.rooms.*','No\x20recorded\x20events\x20yet.','isAlert','split','channel','system.config','_calName','log','1359864DvSpRu','automationProposal','search','material.','health','âš ï¸\x20Alarm','patternDetected','logDuplicates','.\x0a\x20\x20\x20\x20\x20\x20\x20\x20','indicator.alarm','system.isPresent','getLtmData','genAI','application/json','power','(((.+)+)+)+$','callback','bind','Sleep\x20Score\x20(0-100)','fenster','LTM.dailyDigests','stateChange','accuweather.0','LTM.driftAnalysis.lastCheck','switch','.\x20PRÃ„SENZ:\x20','runBaselineDriftAnalysis','notifyEmailRecipient','LTM.triggerDailyDigest','firmware','map','Comfort\x20Summary','rollladen','cancel','cover','doors','events.lastEvent','\x0a\x20\x20\x20\x20\x20\x20\x20\x20CRITICAL\x20SAFETY\x20CHECK:\x0a\x20\x20\x20\x20\x20\x20\x20\x201.\x20Sofort/Ad-Hoc:\x20Ist\x20es\x20jetzt\x20(','createAllObjects','aiPersona','analysis.health','.\x20DATEN:\x20Schlaf\x20','runGeminiAnalysis','latitude','vacation','generateContent','info','10cKhwbN','\x20\x0a\x20\x20\x20\x20\x20\x20\x20\x20SCHEMA:\x20{\x20\x22activity\x22:\x20{\x20\x22summary\x22:\x20\x22string\x22,\x20\x22deviationFromBaseline\x22:\x20\x22string\x22,\x20\x22isAlert\x22:\x20bool,\x20\x22isEmergency\x22:\x20bool,\x20\x22alertReason\x22:\x20\x22string\x22\x20},\x20\x22comfort\x22:\x20{\x20\x22summary\x22:\x20\x22string\x22,\x20\x22suggestion\x22:\x20\x22string\x22,\x20\x22automationProposal\x22:\x20{\x20\x22patternDetected\x22:\x20bool,\x20\x22description\x22:\x20\x22string\x22,\x20\x22suggestedAction\x22:\x20\x22string\x22\x20}\x20},\x20\x22health\x22:\x20{\x20\x22sleepScore\x22:\x20number\x20(0-100),\x20\x22restlessness\x22:\x20\x22none|low|medium|high\x22,\x20\x22notes\x22:\x20\x22string\x22\x20}\x20}','devices','text','activity','briefingTime','0\x203\x20*\x20*\x20*','sendToAsync','level','KI-Modell\x20nicht\x20initialisiert\x20(Neustart\x20erforderlich?)','heizung','803815hArCco','push','Party','Health\x20&\x20Sleep\x20Analysis','inactivityThresholdHours','setupBriefingScheduler','@google/generative-ai','LTM.rawEventLog','time','off','Success','licht','stringify','type','Gast','.\x20KONTEXT:\x20','indicator.alarm.fire','values','useWeather','native','schalter','getStateAsync','parse','Drift\x20Sched\x20Error:\x20','_score','toLocaleString','Urlaub','Baseline\x20Status','siren','Daily\x20Digests','apiKey','occupancy','Error\x20checking\x20WiFi:\x20','HARD\x20WATCHDOG:\x20No\x20sensor\x20activity\x20detected\x20for\x20','error','Subscribing\x20to\x20','analysis.trigger','abortExitTimer','toISOString','constructor','AI\x20Emergency\x20Status','ROLLE:\x20Data\x20Scientist.\x20ZIEL:\x20Drift\x20erkennen.\x20SCHEMA:\x20{\x20\x22baselineDrift\x22:\x20\x22none|slight|significant|critical\x22,\x20\x22driftDetails\x22:\x20\x22string\x22\x20}\x0a\x0aLTB:\x20','longitude','licenseKey','Briefing\x20Sched\x20Error:\x20','analysis.automation.description','PRO-','de-DE','subscribeStates','ROLLE:\x20Smart\x20Home\x20Analyst.\x20SPRACHE:\x20DE.\x20FORMAT:\x20JSON.\x20\x0a\x20\x20\x20\x20\x20\x20\x20\x20AKTUELLE\x20ZEIT:\x20','config','.data.table','string','analysisHistory','getEnums','substring','.\x20ZUSATZ:\x20','sendMorningBriefing','presenceDevices','isGracePeriodActive','warn','accuweather','Wetter:\x20Deaktiviert','Aktiv\x20(','initPresenceSubscriptions','PARTY','startsWith','System\x20Status\x20&\x20Control','node-schedule','analysis.triggerBriefing','analysis.isAlert','pop','ltmLtbWindowDays','@iobroker/adapter-core','daswetter.0','Pro\x20Feature','sensor','lock','subscribeForeignStatesAsync','Briefing\x20Error:\x20','Analysis\x20Error:\x20','analysis.automation.patternDetected','PRIORITÃ„T:\x20Sicherheit.\x20Erkenne\x20Eindringlinge,\x20ungewÃ¶hnliche\x20Anwesenheit.','5691CeBdpt','val','getForeignStateAsync','eventHistory','modeResetJob','models/gemini-flash-latest','echarts.','working','javascript.','isExit','08:00','notifyTelegramInstance','1pDcDfL','2665364tcmjIo','scheduleJob','fault','inactivityMonitoringEnabled','light','initZombies','boolean','common','setState','Last\x20Check','join','872BoYpHh','Starting\x20Autopilot\x20(','loadSystemMode','loadRawEventLog','getWeatherContext','License\x20Check\x20failed:\x20','notifyPushoverRecipient','getForeignObjectsAsync','runAutopilot','Started\x20at\x20','startExitTimer','Gemini\x20AI\x20initialized.','value.health','N/A\x20(Learning)','Description','guest','object','\x20hours.\x20Potential\x20incapacitation.','KALENDER:\x20','initSystemConfig','baselineDrift','window','livingContext','message','button','\x0a\x20\x20\x20\x20\x20\x20\x20\x20','dutycycle','\x20min).\x20Watchdog\x20Limit:\x20'];a0_0x17ba=function(){return _0x5cb03a;};return a0_0x17ba();}if(require[a0_0x2972dd(0xf8)]!==module)module[a0_0x2972dd(0x173)]=_0x44b4b8=>new CogniLiving(_0x44b4b8);else new CogniLiving();