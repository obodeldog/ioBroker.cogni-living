const a0_0x1a2313=a0_0x2544;(function(_0xcc825a,_0xbff242){const _0x5bef6c=a0_0x2544,_0x571882=_0xcc825a();while(!![]){try{const _0x3bd2f6=parseInt(_0x5bef6c(0x29b))/0x1*(parseInt(_0x5bef6c(0x277))/0x2)+-parseInt(_0x5bef6c(0x367))/0x3*(parseInt(_0x5bef6c(0x30a))/0x4)+parseInt(_0x5bef6c(0x1df))/0x5*(parseInt(_0x5bef6c(0x2dc))/0x6)+parseInt(_0x5bef6c(0x309))/0x7*(parseInt(_0x5bef6c(0x313))/0x8)+parseInt(_0x5bef6c(0x306))/0x9*(-parseInt(_0x5bef6c(0x32c))/0xa)+parseInt(_0x5bef6c(0x28b))/0xb*(parseInt(_0x5bef6c(0x1fe))/0xc)+parseInt(_0x5bef6c(0x245))/0xd*(-parseInt(_0x5bef6c(0x390))/0xe);if(_0x3bd2f6===_0xbff242)break;else _0x571882['push'](_0x571882['shift']());}catch(_0x1bb377){_0x571882['push'](_0x571882['shift']());}}}(a0_0x343c,0xcf4b5));const a0_0x25794f=(function(){let _0x4b1c09=!![];return function(_0xc2bf9e,_0x3c5682){const _0xc8e92b=_0x4b1c09?function(){const _0x8f7277=a0_0x2544;if(_0x3c5682){const _0x4fea3b=_0x3c5682[_0x8f7277(0x1d7)](_0xc2bf9e,arguments);return _0x3c5682=null,_0x4fea3b;}}:function(){};return _0x4b1c09=![],_0xc8e92b;};}()),a0_0x3fd7b4=a0_0x25794f(this,function(){const _0x598dfd=a0_0x2544;return a0_0x3fd7b4[_0x598dfd(0x375)]()['search']('(((.+)+)+)+$')['toString']()[_0x598dfd(0x356)](a0_0x3fd7b4)[_0x598dfd(0x1e2)](_0x598dfd(0x254));});a0_0x3fd7b4();'use strict';function a0_0x2544(_0xa78157,_0x12ab73){const _0x2fb0ad=a0_0x343c();return a0_0x2544=function(_0x3fd7b4,_0x25794f){_0x3fd7b4=_0x3fd7b4-0x1cd;let _0x343c40=_0x2fb0ad[_0x3fd7b4];return _0x343c40;},a0_0x2544(_0xa78157,_0x12ab73);}const utils=require(a0_0x1a2313(0x373)),{GoogleGenerativeAI}=require(a0_0x1a2313(0x289)),schedule=require('node-schedule'),HISTORY_MAX_SIZE=0x32,ANALYSIS_HISTORY_MAX_SIZE=0x64,RAW_LOG_MAX_SIZE=0x5dc,LTM_MIN_EVENTS_FOR_COMPRESSION=0x5,GEMINI_MODEL=a0_0x1a2313(0x346),LTM_SCHEDULE=a0_0x1a2313(0x20e),MODE_RESET_SCHEDULE='0\x204\x20*\x20*\x20*',LTM_DP_RAW_LOG='LTM.rawEventLog',LTM_DP_DAILY_DIGESTS=a0_0x1a2313(0x220),LTM_DP_STATUS=a0_0x1a2313(0x392),LTM_DP_TRIGGER_DIGEST=a0_0x1a2313(0x301),LTM_DP_BASELINE_STATUS=a0_0x1a2313(0x2ec),LTM_DP_DRIFT_CHANNEL=a0_0x1a2313(0x28e),LTM_DP_DRIFT_STATUS='LTM.driftAnalysis.baselineDrift',LTM_DP_DRIFT_DETAILS='LTM.driftAnalysis.driftDetails',LTM_DP_DRIFT_LAST_CHECK='LTM.driftAnalysis.lastCheck',SYSTEM_DP_MODE=a0_0x1a2313(0x363),SYSTEM_MODES={'NORMAL':'normal','VACATION':a0_0x1a2313(0x274),'PARTY':a0_0x1a2313(0x258),'GUEST':'guest'},AUTO_RESET_MODES=[SYSTEM_MODES['PARTY'],SYSTEM_MODES[a0_0x1a2313(0x357)]],EXIT_TIMER_MINUTES=0xf,EXIT_GRACE_PERIOD_SECONDS=0x1e,PERSONA_MAPPING={'generic':a0_0x1a2313(0x374),'senior_aal':a0_0x1a2313(0x28f),'family':a0_0x1a2313(0x349),'single_comfort':'Fokus\x20auf\x20Maximierung\x20von\x20Komfort,\x20Automatisierungseffizienz\x20und\x20Energieeinsparung.','security':a0_0x1a2313(0x1e9)};class CogniLiving extends utils[a0_0x1a2313(0x34e)]{constructor(_0x548d27){const _0x3c6b9d=a0_0x1a2313;super({..._0x548d27,'name':'cogni-living'}),this['eventHistory']=[],this['analysisHistory']=[],this[_0x3c6b9d(0x2f2)]=[],this['rawEventLog']=[],this[_0x3c6b9d(0x31a)]=[],this[_0x3c6b9d(0x297)]={},this[_0x3c6b9d(0x265)]={'latitude':0x0,'longitude':0x0,'city':''},this[_0x3c6b9d(0x229)]=!![],this[_0x3c6b9d(0x223)]=null,this['exitGraceTimer']=null,this[_0x3c6b9d(0x2f3)]=![],this[_0x3c6b9d(0x295)]=null,this['geminiModel']=null,this[_0x3c6b9d(0x38a)]=SYSTEM_MODES['NORMAL'],this[_0x3c6b9d(0x206)]=![],this['lastAlertState']=![],this[_0x3c6b9d(0x290)]='unknown',this[_0x3c6b9d(0x256)]=null,this[_0x3c6b9d(0x2b9)]=null,this[_0x3c6b9d(0x25f)]=null,this[_0x3c6b9d(0x283)]=null,this['briefingJob']=null,this['on'](_0x3c6b9d(0x328),this[_0x3c6b9d(0x239)]['bind'](this)),this['on']('stateChange',this[_0x3c6b9d(0x22b)]['bind'](this)),this['on'](_0x3c6b9d(0x39e),this[_0x3c6b9d(0x35f)]['bind'](this)),this['on'](_0x3c6b9d(0x2e1),this[_0x3c6b9d(0x340)][_0x3c6b9d(0x2c4)](this));}async['initHistory'](){const _0x4dec48=a0_0x1a2313;try{const _0x28c20a=await this[_0x4dec48(0x2bb)](_0x4dec48(0x2b1));_0x28c20a&&_0x28c20a['val']&&(this['eventHistory']=JSON[_0x4dec48(0x1cd)](_0x28c20a['val']['toString']()));}catch(_0x12a9bf){this[_0x4dec48(0x241)]=[];}try{const _0x546fd8=await this['getStateAsync'](_0x4dec48(0x24d));if(_0x546fd8&&_0x546fd8['val'])this[_0x4dec48(0x30f)]=JSON[_0x4dec48(0x1cd)](_0x546fd8[_0x4dec48(0x2ac)][_0x4dec48(0x375)]());}catch(_0x68c1e){this['analysisHistory']=[];}}async[a0_0x1a2313(0x2ff)](){const _0x4dc59a=a0_0x1a2313;try{const _0x3483ac=await this[_0x4dc59a(0x2c6)](_0x4dc59a(0x238));if(_0x3483ac&&_0x3483ac[_0x4dc59a(0x1f0)]&&_0x3483ac['native']['uuid'])return _0x3483ac[_0x4dc59a(0x1f0)]['uuid'];return _0x4dc59a(0x2d4);}catch(_0x30e89d){return _0x4dc59a(0x1fc);}}async[a0_0x1a2313(0x215)](_0x4c6e3a){const _0x1f3056=a0_0x1a2313;if(!_0x4c6e3a)return![];this[_0x1f3056(0x290)]=await this[_0x1f3056(0x2ff)]();if(_0x4c6e3a===_0x1f3056(0x39a)||_0x4c6e3a[_0x1f3056(0x364)](_0x1f3056(0x272)))return!![];return![];}async[a0_0x1a2313(0x308)](){const _0x520272=a0_0x1a2313;await this[_0x520272(0x267)](_0x520272(0x242),{'type':_0x520272(0x270),'common':{'name':_0x520272(0x242)},'native':{}}),await this[_0x520272(0x267)](LTM_DP_RAW_LOG,{'type':_0x520272(0x1ed),'common':{'name':_0x520272(0x386),'type':_0x520272(0x2d9),'role':_0x520272(0x287),'read':!![],'write':![]},'native':{}}),await this[_0x520272(0x267)](LTM_DP_DAILY_DIGESTS,{'type':_0x520272(0x1ed),'common':{'name':'Daily\x20Digests','type':_0x520272(0x2d9),'role':_0x520272(0x287),'read':!![],'write':![]},'native':{}}),await this[_0x520272(0x267)](LTM_DP_STATUS,{'type':_0x520272(0x1ed),'common':{'name':'Processing\x20Status','type':_0x520272(0x2d9),'role':'text','read':!![],'write':![]},'native':{}}),await this['extendObjectAsync'](LTM_DP_TRIGGER_DIGEST,{'type':_0x520272(0x1ed),'common':{'name':'Trigger\x20Digest','type':_0x520272(0x1f5),'role':_0x520272(0x249),'read':!![],'write':!![],'def':![]},'native':{}}),await this[_0x520272(0x267)](LTM_DP_BASELINE_STATUS,{'type':_0x520272(0x1ed),'common':{'name':_0x520272(0x232),'type':_0x520272(0x2d9),'role':_0x520272(0x337),'read':!![],'write':![]},'native':{}});}async[a0_0x1a2313(0x38c)](){const _0x3e9c55=a0_0x1a2313;await this[_0x3e9c55(0x267)](LTM_DP_DRIFT_CHANNEL,{'type':_0x3e9c55(0x270),'common':{'name':'Drift\x20Analysis'},'native':{}}),await this[_0x3e9c55(0x267)](LTM_DP_DRIFT_STATUS,{'type':_0x3e9c55(0x1ed),'common':{'name':_0x3e9c55(0x1d5),'type':_0x3e9c55(0x2d9),'role':_0x3e9c55(0x1ed),'read':!![],'write':![],'def':_0x3e9c55(0x36d)},'native':{}}),await this[_0x3e9c55(0x267)](LTM_DP_DRIFT_DETAILS,{'type':'state','common':{'name':_0x3e9c55(0x1f8),'type':_0x3e9c55(0x2d9),'role':_0x3e9c55(0x337),'read':!![],'write':![]},'native':{}}),await this['extendObjectAsync'](LTM_DP_DRIFT_LAST_CHECK,{'type':_0x3e9c55(0x1ed),'common':{'name':_0x3e9c55(0x2e6),'type':_0x3e9c55(0x27f),'role':_0x3e9c55(0x2f9),'read':!![],'write':![]},'native':{}});}async[a0_0x1a2313(0x2ad)](){const _0x5d9e42=a0_0x1a2313;await this[_0x5d9e42(0x267)]('system',{'type':_0x5d9e42(0x270),'common':{'name':_0x5d9e42(0x38e)},'native':{}}),await this['extendObjectAsync'](SYSTEM_DP_MODE,{'type':_0x5d9e42(0x1ed),'common':{'name':_0x5d9e42(0x26f),'type':_0x5d9e42(0x2d9),'role':_0x5d9e42(0x1ed),'read':!![],'write':!![],'def':SYSTEM_MODES[_0x5d9e42(0x26c)],'states':{[SYSTEM_MODES['NORMAL']]:'Normal',[SYSTEM_MODES['VACATION']]:_0x5d9e42(0x286),[SYSTEM_MODES[_0x5d9e42(0x21e)]]:'Party',[SYSTEM_MODES[_0x5d9e42(0x357)]]:_0x5d9e42(0x22d)}},'native':{}});}async['createAllObjects'](){const _0x3ffc03=a0_0x1a2313;try{await this['checkSystemObjects'](),await this['setObjectNotExistsAsync']('system.isPresent',{'type':_0x3ffc03(0x1ed),'common':{'name':_0x3ffc03(0x2b5),'type':_0x3ffc03(0x1f5),'role':_0x3ffc03(0x1f6),'read':!![],'write':![],'def':!![]},'native':{}}),await this['setObjectNotExistsAsync'](_0x3ffc03(0x2fe),{'type':_0x3ffc03(0x1ed),'common':{'name':_0x3ffc03(0x214),'type':_0x3ffc03(0x2d9),'role':_0x3ffc03(0x287),'read':!![],'write':![]},'native':{}}),await this[_0x3ffc03(0x1e6)]('events.history',{'type':'state','common':{'name':_0x3ffc03(0x315),'type':_0x3ffc03(0x2d9),'role':_0x3ffc03(0x287),'read':!![],'write':![]},'native':{}}),await this[_0x3ffc03(0x1e6)]('analysis.trigger',{'type':_0x3ffc03(0x1ed),'common':{'name':_0x3ffc03(0x233),'type':'boolean','role':_0x3ffc03(0x249),'read':!![],'write':!![],'def':![]},'native':{}}),await this[_0x3ffc03(0x1e6)](_0x3ffc03(0x325),{'type':_0x3ffc03(0x1ed),'common':{'name':_0x3ffc03(0x391),'type':_0x3ffc03(0x1f5),'role':_0x3ffc03(0x249),'read':!![],'write':!![],'def':![]},'native':{}}),await this[_0x3ffc03(0x1e6)](_0x3ffc03(0x280),{'type':_0x3ffc03(0x1ed),'common':{'name':_0x3ffc03(0x1d4),'type':'string','role':'json','read':!![],'write':![]},'native':{}}),await this[_0x3ffc03(0x1e6)](_0x3ffc03(0x347),{'type':_0x3ffc03(0x1ed),'common':{'name':'AI\x20Alert\x20Status','type':_0x3ffc03(0x1f5),'role':'indicator.alarm','read':!![],'write':![],'def':![]},'native':{}}),await this[_0x3ffc03(0x1e6)]('analysis.isEmergency',{'type':_0x3ffc03(0x1ed),'common':{'name':_0x3ffc03(0x1fa),'type':_0x3ffc03(0x1f5),'role':_0x3ffc03(0x37c),'read':!![],'write':![],'def':![]},'native':{}}),await this['setObjectNotExistsAsync'](_0x3ffc03(0x368),{'type':_0x3ffc03(0x1ed),'common':{'name':'Alert\x20Reason','type':'string','role':_0x3ffc03(0x33a),'read':!![],'write':![]},'native':{}}),await this[_0x3ffc03(0x1e6)](_0x3ffc03(0x201),{'type':_0x3ffc03(0x1ed),'common':{'name':_0x3ffc03(0x372),'type':_0x3ffc03(0x2d9),'role':_0x3ffc03(0x337),'read':!![],'write':![]},'native':{}}),await this[_0x3ffc03(0x1e6)](_0x3ffc03(0x25b),{'type':'state','common':{'name':'Deviation','type':'string','role':_0x3ffc03(0x1ed),'read':!![],'write':![],'def':_0x3ffc03(0x36d)},'native':{}}),await this[_0x3ffc03(0x1e6)](_0x3ffc03(0x312),{'type':_0x3ffc03(0x1ed),'common':{'name':'Comfort\x20Summary','type':_0x3ffc03(0x2d9),'role':_0x3ffc03(0x337),'read':!![],'write':![]},'native':{}}),await this[_0x3ffc03(0x1e6)]('analysis.comfortSuggestion',{'type':_0x3ffc03(0x1ed),'common':{'name':_0x3ffc03(0x30b),'type':_0x3ffc03(0x2d9),'role':_0x3ffc03(0x337),'read':!![],'write':![]},'native':{}}),await this['extendObjectAsync']('analysis.automation',{'type':_0x3ffc03(0x270),'common':{'name':_0x3ffc03(0x33e)},'native':{}}),await this[_0x3ffc03(0x1e6)](_0x3ffc03(0x39b),{'type':_0x3ffc03(0x1ed),'common':{'name':'Pattern\x20Detected','type':_0x3ffc03(0x1f5),'role':_0x3ffc03(0x1f6),'read':!![],'write':![],'def':![]},'native':{}}),await this['setObjectNotExistsAsync'](_0x3ffc03(0x366),{'type':'state','common':{'name':_0x3ffc03(0x2f8),'type':_0x3ffc03(0x2d9),'role':_0x3ffc03(0x337),'read':!![],'write':![]},'native':{}}),await this[_0x3ffc03(0x1e6)](_0x3ffc03(0x324),{'type':_0x3ffc03(0x1ed),'common':{'name':'Action','type':'string','role':_0x3ffc03(0x337),'read':!![],'write':![]},'native':{}}),await this['setObjectNotExistsAsync']('analysis.analysisHistory',{'type':'state','common':{'name':'Logbook','type':'string','role':'json','read':!![],'write':![],'def':'[]'},'native':{}}),await this[_0x3ffc03(0x1e6)](_0x3ffc03(0x2ca),{'type':_0x3ffc03(0x1ed),'common':{'name':_0x3ffc03(0x293),'type':_0x3ffc03(0x2d9),'role':_0x3ffc03(0x287),'read':!![],'write':![],'def':'[]'},'native':{}}),await this[_0x3ffc03(0x267)]('analysis.health',{'type':_0x3ffc03(0x270),'common':{'name':_0x3ffc03(0x261)},'native':{}}),await this[_0x3ffc03(0x1e6)](_0x3ffc03(0x222),{'type':_0x3ffc03(0x1ed),'common':{'name':'Sleep\x20Score\x20(0-100)','type':'number','role':_0x3ffc03(0x263),'read':!![],'write':![],'def':0x0},'native':{}}),await this[_0x3ffc03(0x1e6)](_0x3ffc03(0x1d9),{'type':_0x3ffc03(0x1ed),'common':{'name':'Restlessness\x20Level','type':'string','role':_0x3ffc03(0x337),'read':!![],'write':![],'def':_0x3ffc03(0x38b)},'native':{}}),await this[_0x3ffc03(0x1e6)](_0x3ffc03(0x36e),{'type':_0x3ffc03(0x1ed),'common':{'name':_0x3ffc03(0x268),'type':_0x3ffc03(0x2d9),'role':_0x3ffc03(0x337),'read':!![],'write':![],'def':''},'native':{}}),await this['checkLtmObjects'](),await this[_0x3ffc03(0x38c)]();}catch(_0x48ca4e){this[_0x3ffc03(0x22e)]['error'](_0x3ffc03(0x230)+_0x48ca4e[_0x3ffc03(0x2e1)]);}}async[a0_0x1a2313(0x300)](){const _0xa62200=a0_0x1a2313;try{const _0x1da2d4=await this[_0xa62200(0x2bb)](SYSTEM_DP_MODE);_0x1da2d4&&_0x1da2d4[_0xa62200(0x2ac)]&&Object['values'](SYSTEM_MODES)[_0xa62200(0x36f)](_0x1da2d4['val'])?this[_0xa62200(0x38a)]=_0x1da2d4[_0xa62200(0x2ac)]:(this['currentSystemMode']=SYSTEM_MODES['NORMAL'],await this[_0xa62200(0x2c5)](SYSTEM_DP_MODE,{'val':SYSTEM_MODES[_0xa62200(0x26c)],'ack':!![]}));}catch(_0x7b6095){this[_0xa62200(0x38a)]=SYSTEM_MODES[_0xa62200(0x26c)];}}async['loadRawEventLog'](){const _0x3c7425=a0_0x1a2313;try{const _0x413ca7=await this[_0x3c7425(0x2bb)](LTM_DP_RAW_LOG);if(_0x413ca7&&_0x413ca7[_0x3c7425(0x2ac)])this['rawEventLog']=JSON['parse'](_0x413ca7['val']);}catch(_0xbd17e7){this[_0x3c7425(0x327)]=[];}}async['loadDailyDigests'](){const _0x530b23=a0_0x1a2313;try{const _0x928757=await this[_0x530b23(0x2bb)](LTM_DP_DAILY_DIGESTS);if(_0x928757&&_0x928757[_0x530b23(0x2ac)])this[_0x530b23(0x31a)]=JSON[_0x530b23(0x1cd)](_0x928757[_0x530b23(0x2ac)]);}catch(_0x4dbf88){this['dailyDigests']=[];}await this[_0x530b23(0x39f)]();}async[a0_0x1a2313(0x39f)](){const _0x330ed7=a0_0x1a2313;if(!this[_0x330ed7(0x206)]){await this[_0x330ed7(0x2c5)](LTM_DP_BASELINE_STATUS,{'val':_0x330ed7(0x21f),'ack':!![]});return;}const _0x16cb5a=this['dailyDigests']['length']>=(this[_0x330ed7(0x2e8)][_0x330ed7(0x210)]||0x7)?_0x330ed7(0x2a8)+this[_0x330ed7(0x31a)][_0x330ed7(0x23c)]+'\x20Tage)':_0x330ed7(0x1f4)+this[_0x330ed7(0x31a)][_0x330ed7(0x23c)]+'/'+(this[_0x330ed7(0x2e8)][_0x330ed7(0x210)]||0x7)+')';await this[_0x330ed7(0x2c5)](LTM_DP_BASELINE_STATUS,{'val':_0x16cb5a,'ack':!![]});}async['checkWifiPresence'](){const _0x4487a4=a0_0x1a2313;try{const _0x555537=this['config']['presenceDevices']||[];let _0x469256=![];for(const _0xeb4799 of _0x555537){try{const _0x284343=await this[_0x4487a4(0x2ba)](_0xeb4799);if(_0x284343&&(_0x284343['val']===!![]||_0x284343['val']===_0x4487a4(0x1de)||_0x284343[_0x4487a4(0x2ac)]===0x1)){_0x469256=!![];break;}}catch(_0x40a51f){}}return _0x469256&&(this[_0x4487a4(0x223)]&&(this[_0x4487a4(0x22e)][_0x4487a4(0x2aa)](_0x4487a4(0x212)),this[_0x4487a4(0x276)]()),!this[_0x4487a4(0x229)]&&this['currentSystemMode']===SYSTEM_MODES['NORMAL']&&this[_0x4487a4(0x381)](!![])),_0x469256;}catch(_0x440a8c){return this[_0x4487a4(0x22e)][_0x4487a4(0x2fc)](_0x4487a4(0x2d3)+_0x440a8c[_0x4487a4(0x2e1)]),![];}}[a0_0x1a2313(0x217)](){const _0x1c96de=a0_0x1a2313;try{if(this[_0x1c96de(0x2b9)])this['ltmJob'][_0x1c96de(0x1e5)]();if(!this[_0x1c96de(0x206)]){this[_0x1c96de(0x2c5)](LTM_DP_STATUS,{'val':'Deaktiviert\x20(Pro-Feature)','ack':!![]});return;}this[_0x1c96de(0x2b9)]=schedule[_0x1c96de(0x2d7)](LTM_SCHEDULE,()=>this[_0x1c96de(0x355)]());}catch(_0xc0e858){this[_0x1c96de(0x22e)][_0x1c96de(0x2fc)](_0x1c96de(0x23e)+_0xc0e858[_0x1c96de(0x2e1)]);}}[a0_0x1a2313(0x235)](){const _0x3fceb6=a0_0x1a2313;try{if(this['modeResetJob'])this['modeResetJob'][_0x3fceb6(0x1e5)]();this[_0x3fceb6(0x25f)]=schedule[_0x3fceb6(0x2d7)](MODE_RESET_SCHEDULE,async()=>{const _0x368fdc=_0x3fceb6;await this['loadSystemMode'](),AUTO_RESET_MODES[_0x368fdc(0x36f)](this['currentSystemMode'])&&await this[_0x368fdc(0x2c5)](SYSTEM_DP_MODE,{'val':SYSTEM_MODES[_0x368fdc(0x26c)],'ack':![]});});}catch(_0x1e0831){this[_0x3fceb6(0x22e)][_0x3fceb6(0x2fc)](_0x3fceb6(0x2d2)+_0x1e0831['message']);}}[a0_0x1a2313(0x2f1)](){const _0x2005ce=a0_0x1a2313;try{if(this[_0x2005ce(0x283)])clearInterval(this[_0x2005ce(0x283)]);if(!this['isProVersion'])return;this['driftAnalysisTimer']=setInterval(()=>this[_0x2005ce(0x2df)](),(this[_0x2005ce(0x2e8)]['ltmDriftCheckIntervalHours']||0x18)*0x36ee80),setTimeout(()=>this[_0x2005ce(0x2df)](),0x1388);}catch(_0x4049c5){this['log']['error'](_0x2005ce(0x2d1)+_0x4049c5[_0x2005ce(0x2e1)]);}}['setupBriefingScheduler'](){const _0x5e1039=a0_0x1a2313;try{if(this['briefingJob'])this[_0x5e1039(0x317)][_0x5e1039(0x1e5)]();if(!this[_0x5e1039(0x2e8)]['briefingEnabled'])return;const _0x3e63d6=(this['config'][_0x5e1039(0x29d)]||_0x5e1039(0x37f))[_0x5e1039(0x1ee)](':'),_0x5507a1=parseInt(_0x3e63d6[0x0])||0x8,_0x19a7d9=parseInt(_0x3e63d6[0x1])||0x0,_0x477282=_0x19a7d9+'\x20'+_0x5507a1+_0x5e1039(0x1e1);this[_0x5e1039(0x22e)][_0x5e1039(0x2aa)](_0x5e1039(0x2fd)+_0x5507a1+':'+(_0x19a7d9<0xa?'0'+_0x19a7d9:_0x19a7d9)),this[_0x5e1039(0x317)]=schedule[_0x5e1039(0x2d7)](_0x477282,()=>{const _0x535afb=_0x5e1039;this[_0x535afb(0x228)]();});}catch(_0x33bbf3){this['log'][_0x5e1039(0x2fc)](_0x5e1039(0x2d0)+_0x33bbf3[_0x5e1039(0x2e1)]);}}async[a0_0x1a2313(0x239)](){const _0x859f25=a0_0x1a2313;this[_0x859f25(0x22e)][_0x859f25(0x2aa)]('cogni-living\x20adapter\x20starting\x20(v'+this[_0x859f25(0x35c)]+')');try{const _0x48e62f=[_0x859f25(0x1f3),'analysis.history_debug_01',_0x859f25(0x282),_0x859f25(0x35d),_0x859f25(0x399),'events.history_debug_00',_0x859f25(0x31f),'events.history_debug_02',_0x859f25(0x200),_0x859f25(0x291)];for(const _0x6f6ecc of _0x48e62f){try{const _0xf69d29=await this[_0x859f25(0x32b)](_0x6f6ecc);_0xf69d29&&await this[_0x859f25(0x2af)](_0x6f6ecc);}catch(_0x13548d){}}}catch(_0xca990a){}this[_0x859f25(0x2e8)][_0x859f25(0x38d)]=this[_0x859f25(0x2e8)][_0x859f25(0x38d)]||'';try{this[_0x859f25(0x206)]=await this[_0x859f25(0x215)](this['config'][_0x859f25(0x38d)]);}catch(_0x5bf2d5){this[_0x859f25(0x22e)][_0x859f25(0x2fc)](_0x859f25(0x1d8)+_0x5bf2d5[_0x859f25(0x2e1)]);}if(!this[_0x859f25(0x2e8)][_0x859f25(0x310)]||this['config'][_0x859f25(0x310)]<0.1)this[_0x859f25(0x2e8)][_0x859f25(0x310)]=0xc;try{await this['initHistory']();}catch(_0x4cff83){this[_0x859f25(0x22e)]['error'](_0x859f25(0x304)+_0x4cff83[_0x859f25(0x2e1)]);}try{const _0x4a7612=await this['getForeignObjectAsync'](_0x859f25(0x21c));_0x4a7612&&_0x4a7612[_0x859f25(0x314)]&&(this[_0x859f25(0x265)]={'latitude':_0x4a7612[_0x859f25(0x314)][_0x859f25(0x305)]||0x0,'longitude':_0x4a7612[_0x859f25(0x314)][_0x859f25(0x252)]||0x0,'city':_0x4a7612[_0x859f25(0x314)][_0x859f25(0x2b0)]||''});}catch(_0x498ddd){}if(this['config'][_0x859f25(0x334)])try{this[_0x859f25(0x295)]=new GoogleGenerativeAI(this[_0x859f25(0x2e8)][_0x859f25(0x334)]),this[_0x859f25(0x266)]=this[_0x859f25(0x295)][_0x859f25(0x31c)]({'model':GEMINI_MODEL,'generationConfig':{'responseMimeType':_0x859f25(0x298)}}),this['log'][_0x859f25(0x2aa)](_0x859f25(0x30d));}catch(_0x232568){this[_0x859f25(0x22e)][_0x859f25(0x2fc)](_0x859f25(0x24a)+_0x232568[_0x859f25(0x2e1)]);}try{await this[_0x859f25(0x2a3)]();}catch(_0x12b0cc){this[_0x859f25(0x22e)][_0x859f25(0x2fc)](_0x859f25(0x2ab)+_0x12b0cc[_0x859f25(0x2e1)]);}try{await this[_0x859f25(0x300)]();}catch(_0x127141){this[_0x859f25(0x22e)][_0x859f25(0x2fc)](_0x859f25(0x319)+_0x127141[_0x859f25(0x2e1)]);}try{await this[_0x859f25(0x20b)]();}catch(_0x4100e1){this[_0x859f25(0x22e)][_0x859f25(0x2fc)](_0x859f25(0x22f)+_0x4100e1[_0x859f25(0x2e1)]);}try{await this[_0x859f25(0x2de)]();}catch(_0x13922c){this[_0x859f25(0x22e)]['error'](_0x859f25(0x205)+_0x13922c[_0x859f25(0x2e1)]);}this[_0x859f25(0x31e)](_0x859f25(0x2a7)),this['subscribeStates'](LTM_DP_TRIGGER_DIGEST),this[_0x859f25(0x31e)](_0x859f25(0x363)),this[_0x859f25(0x31e)](_0x859f25(0x325));const _0x124d85=this[_0x859f25(0x2e8)][_0x859f25(0x361)];if(_0x124d85&&_0x124d85[_0x859f25(0x23c)]>0x0){this[_0x859f25(0x22e)][_0x859f25(0x2aa)]('Subscribing\x20to\x20'+_0x124d85[_0x859f25(0x23c)]+_0x859f25(0x32f));for(const _0x19daf2 of _0x124d85){if(_0x19daf2['id']){await this['subscribeForeignStatesAsync'](_0x19daf2['id']);try{const _0x33d6d4=await this[_0x859f25(0x2ba)](_0x19daf2['id']);if(_0x33d6d4)this[_0x859f25(0x297)][_0x19daf2['id']]=_0x33d6d4[_0x859f25(0x2ac)];}catch(_0x26d620){}}}}const _0x273a52=this[_0x859f25(0x2e8)]['presenceDevices']||[];if(_0x273a52[_0x859f25(0x23c)]>0x0){this[_0x859f25(0x22e)][_0x859f25(0x2aa)](_0x859f25(0x1da)+_0x273a52['length']+'\x20presence\x20devices...');for(const _0x55b697 of _0x273a52){await this[_0x859f25(0x24f)](_0x55b697);}try{await this[_0x859f25(0x377)]();}catch(_0x1e4ad1){}}if(this[_0x859f25(0x256)])clearInterval(this['analysisTimer']);const _0x257ba8=this[_0x859f25(0x2e8)][_0x859f25(0x370)]||0xf;_0x257ba8>0x0&&(this[_0x859f25(0x22e)][_0x859f25(0x2aa)](_0x859f25(0x2be)+_0x257ba8+_0x859f25(0x380)+this[_0x859f25(0x2e8)][_0x859f25(0x310)]+'h.'),this[_0x859f25(0x256)]=setInterval(()=>{const _0x590e36=_0x859f25;try{this['runAutopilot']();}catch(_0xd6a927){this[_0x590e36(0x22e)][_0x590e36(0x2fc)](_0x590e36(0x20f)+_0xd6a927['message']);}},_0x257ba8*0x3c*0x3e8)),this[_0x859f25(0x217)](),this['setupModeResetScheduler'](),this[_0x859f25(0x2f1)](),this[_0x859f25(0x362)]();}async[a0_0x1a2313(0x2df)](){const _0xbc9fb1=a0_0x1a2313;if(!this[_0xbc9fb1(0x206)]||!this[_0xbc9fb1(0x266)])return;const _0x280c61=this[_0xbc9fb1(0x2e8)]['ltmStbWindowDays']||0xe;if(this['dailyDigests'][_0xbc9fb1(0x23c)]<_0x280c61+(this['config']['minDaysForBaseline']||0x7)){await this[_0xbc9fb1(0x2c5)](LTM_DP_DRIFT_STATUS,{'val':_0xbc9fb1(0x209),'ack':!![]});return;}const _0x3c8e67=this[_0xbc9fb1(0x31a)][_0xbc9fb1(0x2ef)](-_0x280c61),_0x33240d=this[_0xbc9fb1(0x31a)][_0xbc9fb1(0x2ef)](0x0,this[_0xbc9fb1(0x31a)][_0xbc9fb1(0x23c)]-_0x280c61),_0x45bc0e=_0xbc9fb1(0x2bd)+JSON[_0xbc9fb1(0x224)](_0x33240d)+'\x0a\x0aA\x20(STB):\x0a'+JSON[_0xbc9fb1(0x224)](_0x3c8e67);try{const _0x2d3d92=await this[_0xbc9fb1(0x266)]['generateContent'](_0x45bc0e),_0x442f83=JSON[_0xbc9fb1(0x1cd)](_0x2d3d92[_0xbc9fb1(0x2e3)][_0xbc9fb1(0x337)]()[_0xbc9fb1(0x29c)](/```json|```/g,'')[_0xbc9fb1(0x2d6)]());_0x442f83[_0xbc9fb1(0x27c)]&&(await this[_0xbc9fb1(0x2c5)](LTM_DP_DRIFT_STATUS,{'val':_0x442f83[_0xbc9fb1(0x27c)],'ack':!![]}),await this[_0xbc9fb1(0x2c5)](LTM_DP_DRIFT_DETAILS,{'val':_0x442f83[_0xbc9fb1(0x202)],'ack':!![]}),await this[_0xbc9fb1(0x2c5)](LTM_DP_DRIFT_LAST_CHECK,{'val':Date['now'](),'ack':!![]}));}catch(_0x31c9e8){}}async[a0_0x1a2313(0x2bc)](){const _0x1f0485=a0_0x1a2313;this[_0x1f0485(0x327)][_0x1f0485(0x23c)]>RAW_LOG_MAX_SIZE&&this['rawEventLog'][_0x1f0485(0x307)](0x0,this[_0x1f0485(0x327)][_0x1f0485(0x23c)]-RAW_LOG_MAX_SIZE),await this[_0x1f0485(0x2c5)](LTM_DP_RAW_LOG,{'val':JSON['stringify'](this[_0x1f0485(0x327)]),'ack':!![]});}async['saveDailyDigests'](_0xcd50f2=!![]){const _0x18d6fe=a0_0x1a2313,_0x3fccff=this[_0x18d6fe(0x2e8)]['ltmLtbWindowDays']||0x3c;this[_0x18d6fe(0x31a)][_0x18d6fe(0x23c)]>_0x3fccff&&this['dailyDigests'][_0x18d6fe(0x307)](0x0,this[_0x18d6fe(0x31a)][_0x18d6fe(0x23c)]-_0x3fccff);await this[_0x18d6fe(0x2c5)](LTM_DP_DAILY_DIGESTS,{'val':JSON[_0x18d6fe(0x224)](this[_0x18d6fe(0x31a)]),'ack':!![]});if(_0xcd50f2)await this[_0x18d6fe(0x39f)]();}async[a0_0x1a2313(0x279)](_0x1af32c){const _0x58ca75=a0_0x1a2313;this[_0x58ca75(0x30f)][_0x58ca75(0x2c1)](_0x1af32c);if(this[_0x58ca75(0x30f)][_0x58ca75(0x23c)]>ANALYSIS_HISTORY_MAX_SIZE)this[_0x58ca75(0x30f)][_0x58ca75(0x2a0)]();await this[_0x58ca75(0x2c5)](_0x58ca75(0x24d),{'val':JSON[_0x58ca75(0x224)](this[_0x58ca75(0x30f)]),'ack':!![]});}async[a0_0x1a2313(0x34f)](){const _0x5eb720=a0_0x1a2313;await this[_0x5eb720(0x2c5)]('analysis.activitySummary',{'val':_0x5eb720(0x21a),'ack':!![]}),await this[_0x5eb720(0x2c5)](_0x5eb720(0x25b),{'val':this[_0x5eb720(0x206)]?_0x5eb720(0x37b):_0x5eb720(0x2b3),'ack':!![]}),await this[_0x5eb720(0x2c5)](_0x5eb720(0x347),{'val':![],'ack':!![]}),await this['setStateAsync'](_0x5eb720(0x321),{'val':![],'ack':!![]}),this[_0x5eb720(0x1e4)]=![];}async[a0_0x1a2313(0x340)](_0x2adc89){const _0x2b1d1e=a0_0x1a2313;if(typeof _0x2adc89===_0x2b1d1e(0x24b)&&_0x2adc89[_0x2b1d1e(0x2e1)]){if(_0x2adc89[_0x2b1d1e(0x341)]==='testApiKey'){if(!_0x2adc89['message'][_0x2b1d1e(0x26e)])return this[_0x2b1d1e(0x1ef)](_0x2adc89[_0x2b1d1e(0x333)],_0x2adc89[_0x2b1d1e(0x341)],{'success':![],'message':_0x2b1d1e(0x26b)},_0x2adc89[_0x2b1d1e(0x1eb)]);try{const _0x5b03a7=new GoogleGenerativeAI(_0x2adc89['message'][_0x2b1d1e(0x26e)])[_0x2b1d1e(0x31c)]({'model':_0x2b1d1e(0x346)});await _0x5b03a7[_0x2b1d1e(0x343)](_0x2b1d1e(0x248)),this[_0x2b1d1e(0x1ef)](_0x2adc89[_0x2b1d1e(0x333)],_0x2adc89['command'],{'success':!![],'message':_0x2b1d1e(0x329)},_0x2adc89[_0x2b1d1e(0x1eb)]);}catch(_0x4597ab){this[_0x2b1d1e(0x1ef)](_0x2adc89['from'],_0x2adc89[_0x2b1d1e(0x341)],{'success':![],'message':_0x4597ab['message']},_0x2adc89['callback']);}}else{if(_0x2adc89[_0x2b1d1e(0x341)]===_0x2b1d1e(0x28a)){const _0x2f0700=await this['sendNotification'](_0x2b1d1e(0x36a),!![]);this[_0x2b1d1e(0x1ef)](_0x2adc89[_0x2b1d1e(0x333)],_0x2adc89[_0x2b1d1e(0x341)],{'success':_0x2f0700>0x0,'message':_0x2f0700+_0x2b1d1e(0x244)},_0x2adc89['callback']);}else{if(_0x2adc89[_0x2b1d1e(0x341)]===_0x2b1d1e(0x2d5)){if(!this['isProVersion'])return this[_0x2b1d1e(0x1ef)](_0x2adc89[_0x2b1d1e(0x333)],_0x2adc89[_0x2b1d1e(0x341)],{'success':![],'isPro':![]},_0x2adc89[_0x2b1d1e(0x1eb)]);let _0x11f555={'status':'N/A','details':'','lastCheck':0x0};try{_0x11f555['status']=(await this[_0x2b1d1e(0x2bb)](LTM_DP_DRIFT_STATUS))[_0x2b1d1e(0x2ac)],_0x11f555[_0x2b1d1e(0x34b)]=(await this[_0x2b1d1e(0x2bb)](LTM_DP_DRIFT_DETAILS))[_0x2b1d1e(0x2ac)],_0x11f555[_0x2b1d1e(0x2b4)]=(await this[_0x2b1d1e(0x2bb)](LTM_DP_DRIFT_LAST_CHECK))['val'];}catch(_0x5aab52){}this['sendTo'](_0x2adc89[_0x2b1d1e(0x333)],_0x2adc89['command'],{'success':!![],'isPro':!![],'dailyDigests':this[_0x2b1d1e(0x31a)],'driftAnalysis':_0x11f555,'analysisHistory':this[_0x2b1d1e(0x30f)]},_0x2adc89['callback']);}else{if(_0x2adc89[_0x2b1d1e(0x341)]===_0x2b1d1e(0x2c3)){const _0x2d583f=await this[_0x2b1d1e(0x20d)]('enum.functions.*',_0x2b1d1e(0x384)),_0x49361a=[];if(_0x2d583f)for(const _0x9edbc2 in _0x2d583f){const _0x7bf936=_0x2d583f[_0x9edbc2],_0x4f63d0=(_0x7bf936[_0x2b1d1e(0x314)]&&typeof _0x7bf936['common'][_0x2b1d1e(0x294)]===_0x2b1d1e(0x24b)?_0x7bf936[_0x2b1d1e(0x314)]['name']['de']:_0x7bf936[_0x2b1d1e(0x314)][_0x2b1d1e(0x294)])||_0x7bf936[_0x2b1d1e(0x314)]['name'];_0x49361a['push']({'id':_0x9edbc2,'name':_0x4f63d0});}this['sendTo'](_0x2adc89[_0x2b1d1e(0x333)],_0x2adc89[_0x2b1d1e(0x341)],{'success':!![],'enums':_0x49361a},_0x2adc89['callback']);}else{if(_0x2adc89[_0x2b1d1e(0x341)]===_0x2b1d1e(0x269))try{const _0xd4d1e3=await this[_0x2b1d1e(0x323)](_0x2adc89[_0x2b1d1e(0x2e1)]||{});this['sendTo'](_0x2adc89[_0x2b1d1e(0x333)],_0x2adc89[_0x2b1d1e(0x341)],{'success':!![],'devices':_0xd4d1e3},_0x2adc89[_0x2b1d1e(0x1eb)]);}catch(_0x174f72){this[_0x2b1d1e(0x1ef)](_0x2adc89[_0x2b1d1e(0x333)],_0x2adc89[_0x2b1d1e(0x341)],{'success':![],'error':_0x174f72['message']},_0x2adc89['callback']);}else{if(_0x2adc89[_0x2b1d1e(0x341)]==='submitFeedback'){const {historyId:_0x19fb97,rating:_0x2bcf0a,comment:_0xa003be,alertReason:_0x5f4b2e}=_0x2adc89[_0x2b1d1e(0x2e1)];_0x19fb97&&_0x2bcf0a?(await this['saveFeedback']({'timestamp':Date[_0x2b1d1e(0x353)](),'historyId':_0x19fb97,'rating':_0x2bcf0a,'comment':_0xa003be,'alertReason':_0x5f4b2e}),this[_0x2b1d1e(0x1ef)](_0x2adc89[_0x2b1d1e(0x333)],_0x2adc89[_0x2b1d1e(0x341)],{'success':!![]},_0x2adc89[_0x2b1d1e(0x1eb)])):this['sendTo'](_0x2adc89[_0x2b1d1e(0x333)],_0x2adc89[_0x2b1d1e(0x341)],{'success':![],'error':_0x2b1d1e(0x388)},_0x2adc89['callback']);}else{if(_0x2adc89[_0x2b1d1e(0x341)]===_0x2b1d1e(0x23d)){const _0x469c36=await this['getWeatherContext'](),_0x369d60=await this[_0x2b1d1e(0x2c7)]();this['sendTo'](_0x2adc89[_0x2b1d1e(0x333)],_0x2adc89[_0x2b1d1e(0x341)],{'success':!![],'weather':_0x469c36,'calendar':_0x369d60},_0x2adc89[_0x2b1d1e(0x1eb)]);}}}}}}}}}async['scanForDevices'](_0x272e62={}){const _0xc41916=a0_0x1a2313;this[_0xc41916(0x22e)][_0xc41916(0x2aa)](_0xc41916(0x1dd)+JSON['stringify'](_0x272e62));const _0x3ed96e=[],_0x23f289=_0x272e62['motion']!==![],_0x1daa79=_0x272e62['doors']!==![],_0x421603=_0x272e62[_0xc41916(0x1cf)]!==![],_0x4f1561=_0x272e62['temperature']===!![],_0xd1e8b7=_0x272e62['weather']===!![],_0x3a6c19=_0x272e62[_0xc41916(0x33d)]||[],_0x61331c=await this['getForeignObjectsAsync'](_0xc41916(0x30c),'enum'),_0x103b2e=await this[_0xc41916(0x20d)](_0xc41916(0x292),_0xc41916(0x384)),_0x218a1b={},_0x38c146={},_0x4deae0={},_0x52b5e7=(_0x1b7b92,_0xb0e80a,_0xc457bd=![])=>{const _0x9660be=_0xc41916;if(!_0x1b7b92)return;for(const _0x205be7 in _0x1b7b92){const _0x89c6ca=_0x1b7b92[_0x205be7];if(_0x89c6ca&&_0x89c6ca[_0x9660be(0x314)]&&_0x89c6ca[_0x9660be(0x314)][_0x9660be(0x1fb)]){const _0x4a0bde=(typeof _0x89c6ca[_0x9660be(0x314)][_0x9660be(0x294)]===_0x9660be(0x24b)?_0x89c6ca[_0x9660be(0x314)][_0x9660be(0x294)]['de']:_0x89c6ca[_0x9660be(0x314)]['name'])||_0x89c6ca[_0x9660be(0x314)]['name'];if(_0xc457bd)_0x4deae0[_0x205be7]=_0x4a0bde;for(const _0x4936bd of _0x89c6ca[_0x9660be(0x314)][_0x9660be(0x1fb)]){if(_0xc457bd){if(!_0xb0e80a[_0x4936bd])_0xb0e80a[_0x4936bd]=[];_0xb0e80a[_0x4936bd]['push'](_0x205be7);}else _0xb0e80a[_0x4936bd]=_0x4a0bde;}}}};_0x52b5e7(_0x61331c,_0x218a1b),_0x52b5e7(_0x103b2e,_0x38c146,!![]);const _0x3422aa=await this[_0xc41916(0x20d)]('*','state'),_0x1a5398=[_0xc41916(0x1e7),_0xc41916(0x2f4),'RSSI','ERROR',_0xc41916(0x284),_0xc41916(0x296),_0xc41916(0x2b2),_0xc41916(0x2a2),_0xc41916(0x1d1),'WORKING',_0xc41916(0x260),'STICKY_UNREACH',_0xc41916(0x20c),_0xc41916(0x397),_0xc41916(0x371),'COMBINED_PARAMETER','WEEK_PROGRAM',_0xc41916(0x25e),_0xc41916(0x204),_0xc41916(0x1f2),'PROCESS',_0xc41916(0x379),_0xc41916(0x331),_0xc41916(0x2fa),_0xc41916(0x225),_0xc41916(0x2c0),'update','firmware',_0xc41916(0x35c),'connection',_0xc41916(0x2aa),'signal',_0xc41916(0x1d3),_0xc41916(0x246),_0xc41916(0x33f),_0xc41916(0x2e2),'mode',_0xc41916(0x218),'effect','xy','ct',_0xc41916(0x288),'sat',_0xc41916(0x2ce),'manufacturer','modelid',_0xc41916(0x250),_0xc41916(0x341),_0xc41916(0x2e4),_0xc41916(0x264),_0xc41916(0x1ce),'process',_0xc41916(0x345),_0xc41916(0x29f),_0xc41916(0x36c),'detectionState',_0xc41916(0x27a),_0xc41916(0x339),_0xc41916(0x208),_0xc41916(0x344),'info','json'];if(!_0xd1e8b7)_0x1a5398[_0xc41916(0x2cd)](_0xc41916(0x2a5),_0xc41916(0x395),_0xc41916(0x213),_0xc41916(0x240),'uv',_0xc41916(0x376),_0xc41916(0x278));const _0x442130=[_0xc41916(0x32d),_0xc41916(0x27e),_0xc41916(0x2b8),_0xc41916(0x216),_0xc41916(0x360),_0xc41916(0x219),_0xc41916(0x32a),_0xc41916(0x2c9)];if(!_0xd1e8b7)_0x442130[_0xc41916(0x2cd)](_0xc41916(0x316),_0xc41916(0x29e),_0xc41916(0x34d),_0xc41916(0x2f7),'openweathermap.');const _0x1a531a=(_0x1ceebc,_0x4e7fcb,_0x2535b2=![])=>{const _0x343a9f=_0xc41916,_0xf147cc=_0x1ceebc[_0x343a9f(0x1ee)]('.');if(_0x4e7fcb[_0x1ceebc])return _0x4e7fcb[_0x1ceebc];if(_0xf147cc[_0x343a9f(0x23c)]>0x2&&_0x4e7fcb[_0xf147cc['slice'](0x0,-0x1)[_0x343a9f(0x36b)]('.')])return _0x4e7fcb[_0xf147cc[_0x343a9f(0x2ef)](0x0,-0x1)[_0x343a9f(0x36b)]('.')];if(_0xf147cc[_0x343a9f(0x23c)]>0x3&&_0x4e7fcb[_0xf147cc[_0x343a9f(0x2ef)](0x0,-0x2)[_0x343a9f(0x36b)]('.')])return _0x4e7fcb[_0xf147cc[_0x343a9f(0x2ef)](0x0,-0x2)[_0x343a9f(0x36b)]('.')];return _0x2535b2?[]:null;};for(const _0x2b7d8b in _0x3422aa){const _0xd8e8d3=_0x3422aa[_0x2b7d8b];if(!_0xd8e8d3||!_0xd8e8d3[_0xc41916(0x314)])continue;if(_0x442130['some'](_0x28b399=>_0x2b7d8b[_0xc41916(0x364)](_0x28b399)))continue;const _0x2092c2=_0xd8e8d3['common'][_0xc41916(0x354)]||'',_0x37d053=(_0xd8e8d3[_0xc41916(0x314)][_0xc41916(0x294)]&&typeof _0xd8e8d3['common'][_0xc41916(0x294)]==='object'?_0xd8e8d3[_0xc41916(0x314)][_0xc41916(0x294)]['de']:_0xd8e8d3[_0xc41916(0x314)][_0xc41916(0x294)])||'',_0xe9e614=_0x37d053?_0x37d053[_0xc41916(0x2db)]():'',_0x1ad012=_0x2b7d8b[_0xc41916(0x2db)](),_0x5e2605=_0x1a531a(_0x2b7d8b,_0x218a1b),_0x2a1463=_0x1a531a(_0x2b7d8b,_0x38c146,!![]);let _0xfe4ce7=null,_0x23768e=![];if(_0x2a1463&&_0x2a1463[_0xc41916(0x23c)]>0x0){const _0x3ca16a=_0x2a1463[_0xc41916(0x39c)](_0x51109b=>_0x3a6c19[_0xc41916(0x36f)](_0x51109b));if(_0x3ca16a){_0x23768e=!![];const _0xdd77d=_0x4deae0[_0x3ca16a];if(_0x1ad012[_0xc41916(0x36f)](_0xc41916(0x2f5))||_0x1ad012[_0xc41916(0x36f)](_0xc41916(0x33b)))_0xfe4ce7='Bewegung';else{if(_0x1ad012[_0xc41916(0x36f)](_0xc41916(0x1f9))||_0x1ad012[_0xc41916(0x36f)](_0xc41916(0x311))||_0xe9e614['includes'](_0xc41916(0x1ea)))_0xfe4ce7=_0xc41916(0x1f7);else{if(_0x1ad012['includes'](_0xc41916(0x1ed))||_0x1ad012[_0xc41916(0x36f)](_0xc41916(0x332))||_0x1ad012[_0xc41916(0x36f)]('on'))_0xfe4ce7=_0xc41916(0x1e0);else _0xfe4ce7=_0xdd77d;}}}}if(!_0x23768e&&!_0xd1e8b7){if(_0x1a5398[_0xc41916(0x35b)](_0x372cf3=>_0xe9e614[_0xc41916(0x36f)](_0x372cf3)||_0x2b7d8b[_0xc41916(0x1d6)]()['includes'](_0x372cf3)))continue;}if(!_0xfe4ce7&&_0x23f289){if(_0x2092c2['includes'](_0xc41916(0x318))||_0x2092c2['includes'](_0xc41916(0x1ec))||_0xe9e614['includes'](_0xc41916(0x1d0))||_0xe9e614[_0xc41916(0x36f)](_0xc41916(0x25c)))_0xfe4ce7='Bewegung';}!_0xfe4ce7&&_0x1daa79&&((_0x1ad012[_0xc41916(0x36f)](_0xc41916(0x302))||_0x2092c2[_0xc41916(0x36f)](_0xc41916(0x2ae))||_0x2092c2[_0xc41916(0x36f)]('sensor.window')||(_0xe9e614['includes']('fenster')||_0xe9e614[_0xc41916(0x36f)](_0xc41916(0x26a)))&&!_0xe9e614[_0xc41916(0x36f)]('temp')&&!_0xe9e614[_0xc41916(0x36f)](_0xc41916(0x273))&&(_0xd8e8d3['common']['type']==='boolean'||_0xd8e8d3[_0xc41916(0x314)][_0xc41916(0x396)]==='number'))&&(_0xfe4ce7=_0xc41916(0x1db)));if(!_0xfe4ce7&&_0x421603){if((_0x2092c2['includes'](_0xc41916(0x257))||_0x2092c2[_0xc41916(0x36f)]('level.dimmer')||_0xe9e614['includes'](_0xc41916(0x25d))||_0xe9e614['includes'](_0xc41916(0x2cf)))&&_0xd8e8d3[_0xc41916(0x314)]['write'])_0xfe4ce7=_0xc41916(0x389);}if(!_0xfe4ce7&&_0x4f1561){if(_0x2092c2['includes'](_0xc41916(0x236))||_0x2092c2[_0xc41916(0x36f)](_0xc41916(0x33c))||_0xe9e614[_0xc41916(0x36f)](_0xc41916(0x21d)))_0xfe4ce7='Temperatur';}if(_0xfe4ce7){let _0xe5e304=_0x5e2605||'';if(!_0xe5e304){if(_0xe9e614[_0xc41916(0x36f)](_0xc41916(0x25a)))_0xe5e304=_0xc41916(0x35e);else{if(_0xe9e614[_0xc41916(0x36f)](_0xc41916(0x29a)))_0xe5e304=_0xc41916(0x358);else{if(_0xe9e614[_0xc41916(0x36f)](_0xc41916(0x32e)))_0xe5e304=_0xc41916(0x285);else{if(_0xe9e614[_0xc41916(0x36f)]('schlaf'))_0xe5e304='Schlafzimmer';else{if(_0xe9e614['includes']('flur')||_0xe9e614[_0xc41916(0x36f)](_0xc41916(0x303)))_0xe5e304='Flur';else{if(_0xe9e614[_0xc41916(0x36f)](_0xc41916(0x2e7)))_0xe5e304='Garten';}}}}}}let _0x57fd89=![];_0xfe4ce7===_0xc41916(0x1db)&&((_0xe9e614[_0xc41916(0x36f)](_0xc41916(0x30e))||_0xe9e614[_0xc41916(0x36f)](_0xc41916(0x365))||_0xe9e614[_0xc41916(0x36f)](_0xc41916(0x398))||_0xe5e304&&_0xe5e304[_0xc41916(0x2db)]()['includes'](_0xc41916(0x39d))&&_0xe9e614[_0xc41916(0x36f)]('t√ºr'))&&(_0x57fd89=!![]));let _0x17583a=0x0;if(_0x23768e)_0x17583a+=0x1e;else{if(_0x5e2605)_0x17583a+=0x14;else{if(_0xe5e304)_0x17583a+=0xa;}}if(_0x57fd89)_0x17583a+=0x5;_0x3ed96e[_0xc41916(0x2cd)]({'id':_0x2b7d8b,'name':_0x37d053||_0x2b7d8b,'type':_0xfe4ce7,'location':_0xe5e304,'logDuplicates':_0xfe4ce7==='Bewegung','isExit':_0x57fd89,'_score':_0x17583a});}}return _0x3ed96e[_0xc41916(0x2cb)]((_0xf54145,_0x4d7c00)=>_0x4d7c00[_0xc41916(0x23f)]-_0xf54145[_0xc41916(0x23f)]),_0x3ed96e;}async['onStateChange'](_0x479437,_0x51fa43){const _0x239e3e=a0_0x1a2313;if(!_0x51fa43)return;if(_0x479437===this[_0x239e3e(0x1ff)]+'.'+SYSTEM_DP_MODE){_0x51fa43[_0x239e3e(0x2ac)]&&Object[_0x239e3e(0x37d)](SYSTEM_MODES)['includes'](_0x51fa43[_0x239e3e(0x2ac)])&&(this[_0x239e3e(0x38a)]=_0x51fa43['val'],_0x51fa43[_0x239e3e(0x2ac)]===SYSTEM_MODES[_0x239e3e(0x320)]?this[_0x239e3e(0x381)](![]):this['setPresence'](!![]));if(!_0x51fa43[_0x239e3e(0x342)])this['setState'](_0x479437,{'val':this[_0x239e3e(0x38a)],'ack':!![]});return;}if(!_0x51fa43[_0x239e3e(0x342)]){_0x479437[_0x239e3e(0x36f)]('analysis.trigger')&&_0x51fa43[_0x239e3e(0x2ac)]&&(this[_0x239e3e(0x262)](_0x479437,{'val':![],'ack':!![]}),this[_0x239e3e(0x31d)]());if(_0x479437[_0x239e3e(0x36f)](_0x239e3e(0x2b7))&&_0x51fa43[_0x239e3e(0x2ac)]){this['setState'](_0x479437,{'val':![],'ack':!![]});if(this[_0x239e3e(0x206)])this[_0x239e3e(0x355)]();}_0x479437['includes']('triggerBriefing')&&_0x51fa43[_0x239e3e(0x2ac)]&&(this[_0x239e3e(0x262)](_0x479437,{'val':![],'ack':!![]}),this[_0x239e3e(0x228)]());return;}if(this['config']['presenceDevices']&&this['config'][_0x239e3e(0x393)][_0x239e3e(0x36f)](_0x479437)){await this[_0x239e3e(0x377)]();return;}const _0x5e7b0c=(this[_0x239e3e(0x2e8)][_0x239e3e(0x361)]||[])[_0x239e3e(0x39c)](_0x47cab3=>_0x47cab3['id']===_0x479437);if(_0x5e7b0c)this['processSensorEvent'](_0x479437,_0x51fa43,_0x5e7b0c);}async[a0_0x1a2313(0x2bf)](_0x105e69,_0x1a28ee,_0x1309b8){const _0x30e434=a0_0x1a2313;if(!_0x1309b8[_0x30e434(0x1e3)]&&this[_0x30e434(0x297)][_0x105e69]===_0x1a28ee[_0x30e434(0x2ac)])return;this[_0x30e434(0x297)][_0x105e69]=_0x1a28ee[_0x30e434(0x2ac)];if(this[_0x30e434(0x2f3)])return;const _0x40d90c=await this['checkWifiPresence']();if(_0x40d90c){if(!this[_0x30e434(0x229)])this['setPresence'](!![]);}else{const _0x5e147a=_0x1309b8[_0x30e434(0x2da)]===!![];_0x5e147a?this[_0x30e434(0x2e5)]():(this[_0x30e434(0x223)]&&(this[_0x30e434(0x22e)][_0x30e434(0x2aa)](_0x30e434(0x2f6)),this['abortExitTimer']()),!this[_0x30e434(0x229)]&&this[_0x30e434(0x38a)]===SYSTEM_MODES[_0x30e434(0x26c)]&&this[_0x30e434(0x381)](!![]));}const _0x195d93={'timestamp':_0x1a28ee['ts'],'id':_0x105e69,'name':_0x1309b8['name'],'value':_0x1a28ee[_0x30e434(0x2ac)],'location':_0x1309b8[_0x30e434(0x2b6)],'type':_0x1309b8[_0x30e434(0x396)]};this[_0x30e434(0x241)]['unshift'](_0x195d93);if(this[_0x30e434(0x241)][_0x30e434(0x23c)]>HISTORY_MAX_SIZE)this['eventHistory'][_0x30e434(0x2a0)]();await this[_0x30e434(0x2c5)](_0x30e434(0x2fe),{'val':JSON[_0x30e434(0x224)](_0x195d93),'ack':!![]}),await this[_0x30e434(0x2c5)](_0x30e434(0x2b1),{'val':JSON[_0x30e434(0x224)](this['eventHistory']),'ack':!![]}),this[_0x30e434(0x327)][_0x30e434(0x2cd)]({'timestamp':new Date(_0x1a28ee['ts'])['toISOString'](),'sensorName':_0x1309b8['name'],'location':_0x1309b8[_0x30e434(0x2b6)],'value':_0x1a28ee[_0x30e434(0x2ac)]}),await this['saveRawEventLog']();}[a0_0x1a2313(0x2e5)](){const _0x4843a0=a0_0x1a2313;this[_0x4843a0(0x276)](),this[_0x4843a0(0x2f3)]=!![],this[_0x4843a0(0x35a)]=setTimeout(()=>{const _0x42a3f4=_0x4843a0;this[_0x42a3f4(0x2f3)]=![];},EXIT_GRACE_PERIOD_SECONDS*0x3e8),this['exitTimer']=setTimeout(()=>{this['setPresence'](![]),this['exitTimer']=null;},EXIT_TIMER_MINUTES*0x3c*0x3e8);}[a0_0x1a2313(0x276)](){const _0x102d10=a0_0x1a2313;if(this[_0x102d10(0x223)])clearTimeout(this['exitTimer']);if(this[_0x102d10(0x35a)])clearTimeout(this['exitGraceTimer']);this[_0x102d10(0x223)]=null,this['exitGraceTimer']=null,this[_0x102d10(0x2f3)]=![];}async[a0_0x1a2313(0x381)](_0xb40f4e){const _0x1319d7=a0_0x1a2313;if(this[_0x1319d7(0x229)]===_0xb40f4e)return;this[_0x1319d7(0x229)]=_0xb40f4e,await this[_0x1319d7(0x2c5)](_0x1319d7(0x322),{'val':_0xb40f4e,'ack':!![]});}[a0_0x1a2313(0x359)](){const _0xe30959=a0_0x1a2313,_0x44ed07=this[_0xe30959(0x2e8)]['inactivityThresholdHours'],_0x581c22=this[_0xe30959(0x2e8)][_0xe30959(0x335)],_0x14ddfe=this[_0xe30959(0x241)][_0xe30959(0x23c)]>0x0?this[_0xe30959(0x241)][0x0][_0xe30959(0x326)]:Date[_0xe30959(0x353)](),_0x298390=(Date['now']()-_0x14ddfe)/(0x3e8*0x3c*0x3c);let _0x518ca7='';_0x581c22&&this[_0xe30959(0x38a)]===SYSTEM_MODES[_0xe30959(0x26c)]&&this[_0xe30959(0x229)]&&(_0x298390>_0x44ed07&&(_0x518ca7='CRITICAL\x20WARNING:\x20No\x20sensor\x20activity\x20detected\x20for\x20'+_0x298390[_0xe30959(0x38f)](0x1)+_0xe30959(0x2cc)));if(_0x518ca7){this[_0xe30959(0x31d)](_0x518ca7)['catch'](_0xd1169c=>this[_0xe30959(0x22e)][_0xe30959(0x2fc)](_0xd1169c));return;}const _0x19bb21=Date[_0xe30959(0x353)](),_0x40cdfd=_0x19bb21-_0x14ddfe,_0x312e7f=(this[_0xe30959(0x2e8)][_0xe30959(0x370)]||0xf)*0x3c*0x3e8;this[_0xe30959(0x241)][_0xe30959(0x23c)]>0x0&&_0x40cdfd<=_0x312e7f?this[_0xe30959(0x31d)]()['catch'](_0x3a69b1=>this[_0xe30959(0x22e)][_0xe30959(0x2fc)](_0x3a69b1)):!this[_0xe30959(0x1e4)]&&(this[_0xe30959(0x262)](_0xe30959(0x347),{'val':![],'ack':!![]}),this[_0xe30959(0x262)](_0xe30959(0x321),{'val':![],'ack':!![]}));}async[a0_0x1a2313(0x31d)](_0xaf19fa=''){const _0x2dda26=a0_0x1a2313;if(!this[_0x2dda26(0x266)])return;const _0x410abf=this['eventHistory'][_0x2dda26(0x23c)]>0x0?this[_0x2dda26(0x241)]:[{'note':_0x2dda26(0x2a6)}],_0x5a0ce5=PERSONA_MAPPING[this[_0x2dda26(0x2e8)][_0x2dda26(0x383)]||_0x2dda26(0x255)],_0x256f5c=this[_0x2dda26(0x2e8)][_0x2dda26(0x330)]||'',_0x5aba6d=this[_0x2dda26(0x38a)],_0x56ed35=await this[_0x2dda26(0x231)](),_0x569426=await this[_0x2dda26(0x2c7)](),_0x3c5f53=(_0x56ed35+'\x20'+_0x569426)['trim'](),_0x400022=new Date(),_0x14b54f=_0x400022[_0x2dda26(0x1d2)](_0x2dda26(0x385),{'weekday':'long','hour':'2-digit','minute':_0x2dda26(0x226)}),_0x5b256e=this[_0x2dda26(0x265)];let _0x5343af='';if(this[_0x2dda26(0x2f2)][_0x2dda26(0x23c)]>0x0){const _0xe1242=this[_0x2dda26(0x2f2)][_0x2dda26(0x2ef)](0x0,0x3)[_0x2dda26(0x369)](_0x38415a=>_0x2dda26(0x20a)+_0x38415a[_0x2dda26(0x251)]+_0x2dda26(0x211)+_0x38415a[_0x2dda26(0x378)]+'.')['join']('\x0a');_0x5343af=_0x2dda26(0x28c)+_0xe1242+'\x0a';}const _0x18a096=_0xaf19fa?_0x2dda26(0x207)+_0xaf19fa+'\x0a!!!\x20END\x20WARNING\x20!!!\x0a':'',_0x2f7b8c='Baseline:\x20Inactive\x20(Pro\x20Feature).',_0x36535b=_0x2dda26(0x22a)+_0x14b54f+_0x2dda26(0x2c8)+_0x5b256e[_0x2dda26(0x2b0)]+'.\x0a\x20\x20\x20\x20\x20\x20\x20\x20MODUS:\x20'+_0x5aba6d+_0x2dda26(0x22c)+(this[_0x2dda26(0x229)]?'Ja':_0x2dda26(0x387))+'.\x20\x0a\x20\x20\x20\x20\x20\x20\x20\x20KONTEXT\x20(Wohnen):\x20'+_0x256f5c+_0x2dda26(0x2ea)+_0x5a0ce5+'.\x0a\x20\x20\x20\x20\x20\x20\x20\x20EXTERNER\x20KONTEXT\x20(WICHTIG):\x20'+_0x3c5f53+'\x0a\x20\x20\x20\x20\x20\x20\x20\x20'+_0x2f7b8c+'\x20'+_0x5343af+'\x20'+_0x18a096+_0x2dda26(0x382)+JSON[_0x2dda26(0x224)](_0x410abf)+'\x20\x0a\x20\x20\x20\x20\x20\x20\x20\x20AUFGABE:\x20Analysiere\x20die\x20Events\x20auf\x20Aktivit√§t,\x20Komfort\x20und\x20GESUNDHEIT.\x20\x0a\x20\x20\x20\x20\x20\x20\x20\x20Nutze\x20den\x20EXTERNEN\x20KONTEXT\x20(Wetter/Kalender)\x20um\x20Fehlalarme\x20zu\x20vermeiden\x20(z.B.\x20Regen\x20=\x20keine\x20Gartenaktivit√§t,\x20Termin\x20=\x20Abwesend).\x0a\x20\x20\x20\x20\x20\x20\x20\x20SCHEMA:\x20{\x20\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x22activity\x22:\x20{\x20\x22summary\x22:\x20\x22string\x22,\x20\x22deviationFromBaseline\x22:\x20\x22string\x22,\x20\x22isAlert\x22:\x20bool,\x20\x22isEmergency\x22:\x20bool,\x20\x22alertReason\x22:\x20\x22string\x22\x20},\x20\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x22comfort\x22:\x20{\x20\x22summary\x22:\x20\x22string\x22,\x20\x22suggestion\x22:\x20\x22string\x22,\x20\x22automationProposal\x22:\x20{\x20\x22patternDetected\x22:\x20bool,\x20\x22description\x22:\x20\x22string\x22,\x20\x22suggestedAction\x22:\x20\x22string\x22\x20}\x20},\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x22health\x22:\x20{\x20\x22sleepScore\x22:\x20number\x20(0-100),\x20\x22restlessness\x22:\x20\x22none|low|medium|high\x22,\x20\x22notes\x22:\x20\x22string\x22\x20}\x20\x0a\x20\x20\x20\x20\x20\x20\x20\x20}';try{const _0x190d3e=await this['geminiModel'][_0x2dda26(0x343)](_0x36535b),_0x1e3190=_0x190d3e['response'][_0x2dda26(0x337)]()[_0x2dda26(0x29c)](/```json|```/g,'')[_0x2dda26(0x2d6)](),_0x3a5a37=JSON[_0x2dda26(0x1cd)](_0x1e3190);await this[_0x2dda26(0x2c5)](_0x2dda26(0x280),{'val':_0x1e3190,'ack':!![]}),await this[_0x2dda26(0x2c5)](_0x2dda26(0x368),{'val':_0x3a5a37[_0x2dda26(0x1e8)][_0x2dda26(0x251)]||'','ack':!![]}),await this['setStateAsync'](_0x2dda26(0x201),{'val':_0x3a5a37[_0x2dda26(0x1e8)][_0x2dda26(0x27a)]||_0x2dda26(0x36d),'ack':!![]}),await this[_0x2dda26(0x2c5)]('analysis.deviationFromBaseline',{'val':_0x3a5a37['activity'][_0x2dda26(0x2a1)]||_0x2dda26(0x36d),'ack':!![]});_0x3a5a37['comfort']&&(await this[_0x2dda26(0x2c5)](_0x2dda26(0x312),{'val':_0x3a5a37[_0x2dda26(0x234)][_0x2dda26(0x27a)]||'','ack':!![]}),await this[_0x2dda26(0x2c5)](_0x2dda26(0x350),{'val':_0x3a5a37[_0x2dda26(0x234)][_0x2dda26(0x275)]||'','ack':!![]}),_0x3a5a37[_0x2dda26(0x234)][_0x2dda26(0x227)]&&(await this[_0x2dda26(0x2c5)](_0x2dda26(0x39b),{'val':_0x3a5a37[_0x2dda26(0x234)][_0x2dda26(0x227)][_0x2dda26(0x2e0)]||![],'ack':!![]}),await this[_0x2dda26(0x2c5)](_0x2dda26(0x366),{'val':_0x3a5a37[_0x2dda26(0x234)]['automationProposal']['description']||'','ack':!![]}),await this[_0x2dda26(0x2c5)](_0x2dda26(0x324),{'val':_0x3a5a37[_0x2dda26(0x234)][_0x2dda26(0x227)][_0x2dda26(0x203)]||'','ack':!![]})));_0x3a5a37['health']&&(await this['setStateAsync'](_0x2dda26(0x222),{'val':typeof _0x3a5a37[_0x2dda26(0x2d8)][_0x2dda26(0x2ed)]===_0x2dda26(0x27f)?_0x3a5a37[_0x2dda26(0x2d8)][_0x2dda26(0x2ed)]:0x0,'ack':!![]}),await this[_0x2dda26(0x2c5)](_0x2dda26(0x1d9),{'val':_0x3a5a37[_0x2dda26(0x2d8)]['restlessness']||_0x2dda26(0x38b),'ack':!![]}),await this[_0x2dda26(0x2c5)](_0x2dda26(0x36e),{'val':_0x3a5a37[_0x2dda26(0x2d8)][_0x2dda26(0x2fb)]||'','ack':!![]}));const _0x3e24a4=_0x3a5a37[_0x2dda26(0x1e8)][_0x2dda26(0x31b)]||![],_0x1aa7ff=_0x3a5a37[_0x2dda26(0x1e8)]['isEmergency']||![];if(_0x3e24a4||_0x1aa7ff){await this[_0x2dda26(0x2c5)]('analysis.isAlert',{'val':!![],'ack':!![]}),await this['setStateAsync'](_0x2dda26(0x321),{'val':_0x1aa7ff,'ack':!![]});if(!this[_0x2dda26(0x1e4)]||_0x1aa7ff){const _0x2b75dd=_0x1aa7ff?_0x2dda26(0x1dc):'‚ö†Ô∏è\x20Alarm';this[_0x2dda26(0x27b)](_0x2b75dd+':\x20'+_0x3a5a37[_0x2dda26(0x1e8)][_0x2dda26(0x251)],![],_0x1aa7ff);}}else await this[_0x2dda26(0x2c5)](_0x2dda26(0x347),{'val':![],'ack':!![]}),await this['setStateAsync'](_0x2dda26(0x321),{'val':![],'ack':!![]});this[_0x2dda26(0x1e4)]=_0x3e24a4||_0x1aa7ff;const _0x126320={'timestamp':Date['now'](),'id':Date[_0x2dda26(0x353)]()[_0x2dda26(0x375)](),'analysis':_0x3a5a37,'systemMode':_0x5aba6d,'isPro':this['isProVersion']};this[_0x2dda26(0x279)](_0x126320);}catch(_0x278a9e){this[_0x2dda26(0x22e)][_0x2dda26(0x2fc)](_0x2dda26(0x336)+_0x278a9e[_0x2dda26(0x2e1)]);}}async[a0_0x1a2313(0x355)](){const _0x3729e9=a0_0x1a2313;if(!this['geminiModel']||this['rawEventLog'][_0x3729e9(0x23c)]<LTM_MIN_EVENTS_FOR_COMPRESSION){await this[_0x3729e9(0x2c5)](LTM_DP_STATUS,{'val':_0x3729e9(0x1fd),'ack':!![]});return;}this[_0x3729e9(0x22e)][_0x3729e9(0x2aa)](_0x3729e9(0x34a)+this['rawEventLog'][_0x3729e9(0x23c)]+_0x3729e9(0x2dd)),await this[_0x3729e9(0x2c5)](LTM_DP_STATUS,{'val':'Analysiere\x20Tag...','ack':!![]});const _0x523803=this[_0x3729e9(0x327)][_0x3729e9(0x23c)]>0x320?this[_0x3729e9(0x327)]['slice'](this[_0x3729e9(0x327)][_0x3729e9(0x23c)]-0x320):this[_0x3729e9(0x327)],_0x33288a=PERSONA_MAPPING[this[_0x3729e9(0x2e8)][_0x3729e9(0x383)]||_0x3729e9(0x255)],_0x5dedcf=_0x3729e9(0x28d)+_0x33288a+_0x3729e9(0x2a9)+JSON['stringify'](_0x523803)+_0x3729e9(0x27d);try{const _0x9c9f1f=await this[_0x3729e9(0x266)][_0x3729e9(0x343)](_0x5dedcf),_0x46287b=_0x9c9f1f[_0x3729e9(0x2e3)][_0x3729e9(0x337)]()['replace'](/```json|```/g,'')[_0x3729e9(0x2d6)](),_0xfbf891=JSON[_0x3729e9(0x1cd)](_0x46287b),_0x1c24f4={'timestamp':new Date()[_0x3729e9(0x37e)](),'eventCount':this[_0x3729e9(0x327)][_0x3729e9(0x23c)],'summary':_0xfbf891[_0x3729e9(0x27a)],'activityLevel':_0xfbf891['activityLevel'],'health':{'sleepScore':_0xfbf891['health']?_0xfbf891[_0x3729e9(0x2d8)]['sleepScore']:0x0,'restlessness':_0xfbf891[_0x3729e9(0x2d8)]?_0xfbf891['health'][_0x3729e9(0x2ee)]:_0x3729e9(0x38b)},'systemMode':this['currentSystemMode']};this[_0x3729e9(0x31a)][_0x3729e9(0x2cd)](_0x1c24f4),await this[_0x3729e9(0x348)](),this['rawEventLog']=[],await this[_0x3729e9(0x2bc)](),await this[_0x3729e9(0x2c5)](LTM_DP_STATUS,{'val':_0x3729e9(0x253),'ack':!![]}),this[_0x3729e9(0x22e)][_0x3729e9(0x2aa)]('Daily\x20Digest\x20created\x20successfully.');}catch(_0x1ecc20){this['log']['error'](_0x3729e9(0x243)+_0x1ecc20[_0x3729e9(0x2e1)]),await this[_0x3729e9(0x2c5)](LTM_DP_STATUS,{'val':_0x3729e9(0x394)+_0x1ecc20[_0x3729e9(0x2e1)],'ack':!![]});}}async['sendMorningBriefing'](){const _0x2957b9=a0_0x1a2313;if(!this['geminiModel'])return;this[_0x2957b9(0x22e)]['info']('Generating\x20Morning\x20Briefing...');const _0x4e5e64=this['dailyDigests'][_0x2957b9(0x23c)]>0x0?this[_0x2957b9(0x31a)][this[_0x2957b9(0x31a)]['length']-0x1]:null,_0x3ea667=_0x4e5e64&&_0x4e5e64[_0x2957b9(0x2d8)]?_0x4e5e64['health']['sleepScore']:'N/A',_0x2eaa93=new Date();_0x2eaa93['setHours'](0x4,0x0,0x0,0x0);const _0x238061=this[_0x2957b9(0x241)]['filter'](_0x218486=>new Date(_0x218486['timestamp'])>_0x2eaa93),_0x145e32=PERSONA_MAPPING[this[_0x2957b9(0x2e8)][_0x2957b9(0x383)]||_0x2957b9(0x255)],_0x307867=this[_0x2957b9(0x2e8)][_0x2957b9(0x330)]||'',_0x333f62=await this[_0x2957b9(0x231)](),_0x17ec80=await this[_0x2957b9(0x2c7)](),_0x56c8f2='ROLLE:\x20F√ºrsorglicher\x20Assistent.\x0a\x20\x20\x20\x20\x20\x20\x20\x20AUFGABE:\x20Schreibe\x20eine\x20kurze,\x20beruhigende\x20\x22Guten\x20Morgen\x22-Nachricht\x20an\x20die\x20Angeh√∂rigen/Bewohner.\x0a\x20\x20\x20\x20\x20\x20\x20\x20TON:\x20Freundlich,\x20professionell,\x20kurz.\x0a\x20\x20\x20\x20\x20\x20\x20\x20PERSONA\x20(Fokus):\x20'+_0x145e32+_0x2957b9(0x299)+_0x307867+'\x0a\x20\x20\x20\x20\x20\x20\x20\x20ZUSATZ-KONTEXT:\x20'+_0x333f62+'\x20'+_0x17ec80+_0x2957b9(0x1f1)+_0x3ea667+_0x2957b9(0x23b)+JSON['stringify'](_0x238061[_0x2957b9(0x2ef)](0x0,0xa))+_0x2957b9(0x2a4);try{const _0x3855e6=await this[_0x2957b9(0x266)]['generateContent'](_0x56c8f2),_0x4fcee1='üåÖ\x20Daily\x20Briefing:\x0a'+_0x3855e6[_0x2957b9(0x2e3)][_0x2957b9(0x337)]()[_0x2957b9(0x2d6)]();this['sendNotification'](_0x4fcee1),this[_0x2957b9(0x22e)][_0x2957b9(0x2aa)]('Morning\x20Briefing\x20sent.');}catch(_0x17ede7){this['log'][_0x2957b9(0x2fc)](_0x2957b9(0x352)+_0x17ede7[_0x2957b9(0x2e1)]);}}async[a0_0x1a2313(0x27b)](_0x1d99f1,_0x56d081=![],_0x4e6b10=![]){const _0x1d7e60=a0_0x1a2313;this[_0x1d7e60(0x22e)][_0x1d7e60(0x2aa)]((_0x56d081?_0x1d7e60(0x34c):'')+'Sending\x20notification:\x20\x22'+_0x1d99f1+'\x22'+(_0x4e6b10?_0x1d7e60(0x271):''));const _0x288308=this[_0x1d7e60(0x2e8)];let _0xeae5a3=0x0;_0x288308[_0x1d7e60(0x24e)]&&_0x288308['notifyTelegramInstance']&&(await this[_0x1d7e60(0x247)](_0x288308[_0x1d7e60(0x23a)],'send',{'text':_0x1d99f1,'user':_0x288308['notifyTelegramRecipient']}),_0xeae5a3++);if(_0x288308[_0x1d7e60(0x2eb)]&&_0x288308[_0x1d7e60(0x37a)]){let _0xd621ff={'message':_0x1d99f1,'title':_0x4e6b10?_0x1d7e60(0x24c):'Cogni-Living\x20Alert','priority':_0x4e6b10?0x2:0x1,'device':_0x288308[_0x1d7e60(0x2f0)]};_0x4e6b10&&(_0xd621ff[_0x1d7e60(0x237)]=0x1e,_0xd621ff[_0x1d7e60(0x259)]=0xe10,_0xd621ff['sound']=_0x1d7e60(0x281)),await this['sendToAsync'](_0x288308[_0x1d7e60(0x37a)],'send',_0xd621ff),_0xeae5a3++;}return _0x288308['notifyEmailEnabled']&&_0x288308[_0x1d7e60(0x351)]&&(await this[_0x1d7e60(0x247)](_0x288308[_0x1d7e60(0x351)],_0x1d7e60(0x21b),{'text':_0x1d99f1,'to':_0x288308['notifyEmailRecipient']}),_0xeae5a3++),_0x288308['notifyWhatsappEnabled']&&_0x288308[_0x1d7e60(0x221)]&&(await this[_0x1d7e60(0x247)](_0x288308[_0x1d7e60(0x221)],'send',{'text':_0x1d99f1,'phone':_0x288308['notifyWhatsappRecipient']}),_0xeae5a3++),_0x288308['notifySignalEnabled']&&_0x288308[_0x1d7e60(0x26d)]&&(await this[_0x1d7e60(0x247)](_0x288308[_0x1d7e60(0x26d)],_0x1d7e60(0x21b),{'text':_0x1d99f1,'phone':_0x288308[_0x1d7e60(0x2e9)]}),_0xeae5a3++),_0xeae5a3;}[a0_0x1a2313(0x35f)](_0x3258b5){const _0x107ef5=a0_0x1a2313;if(this[_0x107ef5(0x256)])clearInterval(this[_0x107ef5(0x256)]);if(this[_0x107ef5(0x283)])clearInterval(this['driftAnalysisTimer']);if(this[_0x107ef5(0x2b9)])this[_0x107ef5(0x2b9)][_0x107ef5(0x1e5)]();if(this[_0x107ef5(0x25f)])this[_0x107ef5(0x25f)]['cancel']();if(this[_0x107ef5(0x317)])this['briefingJob'][_0x107ef5(0x1e5)]();if(this[_0x107ef5(0x223)])clearTimeout(this[_0x107ef5(0x223)]);if(this[_0x107ef5(0x35a)])clearTimeout(this[_0x107ef5(0x35a)]);_0x3258b5();}}function a0_0x343c(){const _0x1ba9f8=['onStateChange','.\x20PR√ÑSENZ:\x20','Gast','log','loadRawEventLog\x20failed:\x20','Error\x20creating\x20objects:\x20','getWeatherContext','Baseline\x20Status','Trigger\x20Analysis','comfort','setupModeResetScheduler','value.temperature','retry','system.meta.uuid','onReady','notifyTelegramInstance','/100\x0a\x20\x20\x20\x20\x20\x20\x20\x20-\x20Aktivit√§t\x20seit\x2004:00\x20Uhr:\x20','length','testContext','LTM\x20Sched\x20Error:\x20','_score','pressure','eventHistory','LTM','Daily\x20Digest\x20Error:\x20','\x20sent','13cQmPtR','last\x20action','sendToAsync','test','button','Gemini\x20Init\x20Error:\x20','object','üö®\x20EMERGENCY','analysis.analysisHistory','notifyTelegramEnabled','subscribeForeignStatesAsync','uniqueid','alertReason','longitude','Daily\x20Digest\x20erstellt\x20&\x20gespeichert.','(((.+)+)+)+$','generic','analysisTimer','switch.light','party','expire','bad','analysis.deviationFromBaseline','pr√§senz','licht','ON_TIME','modeResetJob','DIRECTION','Health\x20&\x20Sleep\x20Analysis','setState','value.health','description','systemConfig','geminiModel','extendObjectAsync','Health\x20Notes','scanDevices','t√ºr','No\x20Key','NORMAL','notifySignalInstance','apiKey','System\x20Mode','channel','\x20(EMERGENCY)','PRO-','griff','vacation','suggestion','abortExitTimer','3308618vwQMIr','precip','updateAnalysisHistory','summary','sendNotification','baselineDrift','\x0a\x20\x20\x20\x20\x20\x20\x20\x20OUTPUT\x20SCHEMA:\x20{\x20\x22summary\x22:\x20\x22string\x22,\x20\x22activityLevel\x22:\x20\x22string\x22,\x20\x22health\x22:\x20{\x20\x22sleepScore\x22:\x20number,\x20\x22restlessness\x22:\x20\x22string\x22\x20}\x20}','admin.','number','analysis.lastResult','siren','analysis.history_debug_02','driftAnalysisTimer','FAULT','Wohnzimmer','Urlaub','json','hue','@google/generative-ai','testNotification','22djQjPr','\x0aFEEDBACK:\x0a','ROLLE:\x20Data\x20Analyst.\x20AUFGABE:\x20Fasse\x20den\x20heutigen\x20Tag\x20basierend\x20auf\x20den\x20Sensor-Logs\x20zusammen.\x0a\x20\x20\x20\x20\x20\x20\x20\x20PERSONA:\x20','LTM.driftAnalysis','PRIORIT√ÑT:\x20Gesundheit\x20und\x20Sicherheit\x20f√ºr\x20Senioren\x20(AAL).\x20Erkenne\x20Inaktivit√§t,\x20potenzielle\x20St√ºrze\x20(indirekt),\x20Schlafunterbrechungen\x20und\x20n√§chtliche\x20Unruhe.','systemUUID','events.history_debug_04','enum.functions.*','Feedback\x20Log','name','genAI','SABOTAGE','sensorLastValues','application/json','\x0a\x20\x20\x20\x20\x20\x20\x20\x20KONTEXT\x20(Wer\x20wohnt\x20hier?):\x20','k√ºche','1rFefEB','replace','briefingTime','weatherunderground.','scriptProblem','pop','deviationFromBaseline','CONFIG_PENDING','createAllObjects','\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x0a\x20\x20\x20\x20\x20\x20\x20\x20OUTPUT:\x20Nur\x20der\x20Nachrichtentext\x20(kein\x20JSON).\x20Integriere\x20den\x20Kontext\x20(Wetter/Kalender)\x20nur\x20wenn\x20relevant.','wetter','No\x20recorded\x20events\x20yet.','analysis.trigger','Aktiv\x20(','\x0a\x20\x20\x20\x20\x20\x20\x20\x20INPUT:\x20','info','createAllObjects\x20failed:\x20','val','checkSystemObjects','sensor.door','delObjectAsync','city','events.history','ALARM','N/A\x20(Pro\x20Feature)','lastCheck','Presence\x20Status','location','triggerDailyDigest','info.','ltmJob','getForeignStateAsync','getStateAsync','saveRawEventLog','ROLLE:\x20Data\x20Scientist.\x20VERGLEICHE:\x20Dataset\x20A\x20(Recent)\x20vs\x20B\x20(Established).\x20ZIEL:\x20Erkenne\x20Drift.\x20SCHEMA:\x20{\x20\x22baselineDrift\x22:\x20\x22none|slight|significant|critical\x22,\x20\x22driftDetails\x22:\x20\x22string\x22\x20}\x0a\x0aB\x20(LTB):\x0a','Starting\x20Autopilot\x20(','processSensorEvent','battery','unshift','exports','getEnums','bind','setStateAsync','getForeignObjectAsync','getCalendarContext','.\x20ORT:\x20','flot.','analysis.feedbackHistory','sort','\x20hours.\x20The\x20resident\x20might\x20be\x20incapacitated.\x20Risk\x20level:\x20HIGH.','push','productname','lampe','Briefing\x20Sched\x20Error:\x20','Drift\x20Sched\x20Error:\x20','Reset\x20Sched\x20Error:\x20','Error\x20checking\x20WiFi:\x20','uuid-not-found','getLtmData','trim','scheduleJob','health','string','isExit','toLowerCase','7135782woMhfZ','\x20raw\x20events...','loadDailyDigests','runBaselineDriftAnalysis','patternDetected','message','alert','response','mac\x20address','startExitTimer','Last\x20Check','garten','config','notifySignalRecipient','.\x20PERSONA:\x20','notifyPushoverEnabled','LTM.baselineStatus','sleepScore','restlessness','slice','notifyPushoverRecipient','setupDriftAnalysisScheduler','feedbackHistory','isGracePeriodActive','LOWBAT','presence','Bewegung\x20w√§hrend\x20Exit-Timer\x20erkannt\x20->\x20Bewohner\x20ist\x20noch\x20da.','yr.','Description','date','reachable','notes','error','Scheduling\x20Morning\x20Briefing\x20for\x20','events.lastEvent','getSystemUUID','loadSystemMode','LTM.triggerDailyDigest','shutter_contact','diele','Error\x20initHistory:\x20','latitude','48249LPGIyp','splice','checkLtmObjects','63XpNcZi','4XtaGcq','Comfort\x20Suggestion','enum.rooms.*','Gemini\x20AI\x20initialized.','haust√ºr','analysisHistory','inactivityThresholdHours','fire','analysis.comfortSummary','750544gnkwGG','common','Event\x20History','daswetter.','briefingJob','sensor.motion','loadSystemMode\x20failed:\x20','dailyDigests','isAlert','getGenerativeModel','runGeminiAnalysis','subscribeStates','events.history_debug_01','VACATION','analysis.isEmergency','system.isPresent','scanForDevices','analysis.automation.suggestedAction','analysis.triggerBriefing','timestamp','rawEventLog','ready','Success','icons-mfd.','getObjectAsync','1010slPmeA','system.','wohn','\x20sensors...','livingContext','CONNECTION','level','from','geminiApiKey','inactivityMonitoringEnabled','Analysis\x20Error:\x20','text','main','icon','text.alarm','motion','value.humidity','selectedFunctionIds','Automation\x20Proposals','archetype','onMessage','command','ack','generateContent','forecast','scriptEnabled','models/gemini-flash-latest','analysis.isAlert','saveDailyDigests','Fokus\x20auf\x20Familienroutinen,\x20Kindersicherheit\x20und\x20allgemeines\x20Haushaltsmanagement.','Creating\x20Daily\x20Digest\x20from\x20','details','[TEST]\x20','accuweather.','Adapter','resetAnalysisStates','analysis.comfortSuggestion','notifyEmailInstance','Briefing\x20Error:\x20','now','role','createDailyDigest','constructor','GUEST','K√ºche','runAutopilot','exitGraceTimer','some','version','analysis.history_debug_03','Badezimmer','onUnload','history.','devices','setupBriefingScheduler','system.mode','startsWith','eingang','analysis.automation.description','1568847eUyIQg','analysis.alertReason','map','[Test]\x20Notification','join','javascript.0.script','N/A','analysis.health.notes','includes','analysisInterval','INSTALL_TEST','Activity\x20Summary','@iobroker/adapter-core','Analysiere\x20ausgewogen\x20auf\x20Gesundheit,\x20Sicherheit\x20und\x20Komfort.','toString','rain','checkWifiPresence','rating','AES_KEY','notifyPushoverInstance','N/A\x20(No\x20Activity)','indicator.alarm.fire','values','toISOString','08:00','\x20min).\x20Watchdog\x20Limit:\x20','setPresence','\x0a\x20\x20\x20\x20\x20\x20\x20\x20EVENTS:\x20','aiPersona','enum','de-DE','Raw\x20Log','Nein','Missing\x20data','Licht','currentSystemMode','none','checkLtmDriftObjects','licenseKey','System\x20Status\x20&\x20Control','toFixed','32116798hzUUPF','Trigger\x20Briefing\x20(Test)','LTM.processingStatus','presenceDevices','Fehler:\x20','weather','type','VIRTUAL_CHANNEL','wohnungst√ºr','analysis.history_debug_04','TEST-PRO-KEY','analysis.automation.patternDetected','find','flur','unload','updateBaselineStatus','parse','capabilities','lights','bewegung','DUTYCYCLE','toLocaleString','last_seen','Last\x20Result','Drift\x20Status','toUpperCase','apply','License\x20Check\x20failed:\x20','analysis.health.restlessness','Subscribing\x20to\x20','Fenster/T√ºr','üö®üö®\x20NOTFALL','Starting\x20Smart\x20Scan\x20with\x20filters:\x20','online','5fnKigG','Schalter/Licht','\x20*\x20*\x20*','search','logDuplicates','lastAlertState','cancel','setObjectNotExistsAsync','UNREACH','activity','PRIORIT√ÑT:\x20Sicherheit.\x20Erkenne\x20Eindringlinge,\x20ungew√∂hnliche\x20Anwesenheit.','rauch','callback','occupancy','state','split','sendTo','native','\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x0a\x20\x20\x20\x20\x20\x20\x20\x20DATEN:\x0a\x20\x20\x20\x20\x20\x20\x20\x20-\x20Schlafqualit√§t\x20letzte\x20Nacht:\x20','ERROR_CODE','analysis.history_debug_00','Lernphase\x20(','boolean','indicator','Rauchmelder','Drift\x20Details','smoke','AI\x20Emergency\x20Status','members','uuid-error','Zu\x20wenig\x20Daten\x20f√ºr\x20Daily\x20Digest.','3117456YMysHM','namespace','events.history_debug_03','analysis.activitySummary','driftDetails','suggestedAction','SECTION','loadDailyDigests\x20failed:\x20','isProVersion','\x0a!!!\x20EXTERNAL\x20SYSTEM\x20WARNING\x20!!!\x0a','history','N/A\x20(Learning)','User\x20Feedback:\x20Alarm\x20\x22','loadRawEventLog','OPERATING_VOLTAGE','getForeignObjectsAsync','0\x203\x20*\x20*\x20*','Autopilot\x20error:\x20','minDaysForBaseline','\x22\x20was\x20','WiFi\x20Presence\x20detected\x20->\x20Aborting\x20Exit\x20Timer.\x20User\x20is\x20present.','wind','Last\x20raw\x20event','checkLicense','vis.','setupLtmScheduler','colormode','material.','No\x20recent\x20activity.','send','system.config','temperatur','PARTY','Deaktiviert\x20(Pro-Feature)','LTM.dailyDigests','notifyWhatsappInstance','analysis.health.sleepScore','exitTimer','stringify','link_quality','2-digit','automationProposal','sendMorningBriefing','isPresent','ROLLE:\x20Smart\x20Home\x20Analyst.\x20SPRACHE:\x20DE.\x20FORMAT:\x20JSON.\x20\x0a\x20\x20\x20\x20\x20\x20\x20\x20AKTUELLE\x20ZEIT:\x20'];a0_0x343c=function(){return _0x1ba9f8;};return a0_0x343c();}if(require[a0_0x1a2313(0x338)]!==module)module[a0_0x1a2313(0x2c2)]=_0x370c31=>new CogniLiving(_0x370c31);else new CogniLiving();