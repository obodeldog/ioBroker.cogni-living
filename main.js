const a0_0x2d34b5=a0_0x32e0;(function(_0x84565a,_0x29be1b){const _0x5ccf7c=a0_0x32e0,_0x1ca46b=_0x84565a();while(!![]){try{const _0x3bc2d8=parseInt(_0x5ccf7c(0x343))/0x1*(parseInt(_0x5ccf7c(0x2c5))/0x2)+-parseInt(_0x5ccf7c(0x325))/0x3*(parseInt(_0x5ccf7c(0x2f7))/0x4)+parseInt(_0x5ccf7c(0x288))/0x5*(-parseInt(_0x5ccf7c(0x28b))/0x6)+-parseInt(_0x5ccf7c(0x302))/0x7*(-parseInt(_0x5ccf7c(0x2eb))/0x8)+-parseInt(_0x5ccf7c(0x33c))/0x9*(parseInt(_0x5ccf7c(0x28e))/0xa)+parseInt(_0x5ccf7c(0x308))/0xb+-parseInt(_0x5ccf7c(0x346))/0xc;if(_0x3bc2d8===_0x29be1b)break;else _0x1ca46b['push'](_0x1ca46b['shift']());}catch(_0x48277f){_0x1ca46b['push'](_0x1ca46b['shift']());}}}(a0_0x5255,0xab0f1));const a0_0x1406ad=(function(){let _0x4d547c=!![];return function(_0xee2543,_0xc882be){const _0x3639ec=_0x4d547c?function(){const _0xd034e2=a0_0x32e0;if(_0xc882be){const _0x56833a=_0xc882be[_0xd034e2(0x262)](_0xee2543,arguments);return _0xc882be=null,_0x56833a;}}:function(){};return _0x4d547c=![],_0x3639ec;};}()),a0_0x1a1942=a0_0x1406ad(this,function(){const _0x693350=a0_0x32e0;return a0_0x1a1942[_0x693350(0x272)]()['search']('(((.+)+)+)+$')[_0x693350(0x272)]()[_0x693350(0x1e3)](a0_0x1a1942)[_0x693350(0x320)](_0x693350(0x1a8));});a0_0x1a1942();'use strict';const utils=require('@iobroker/adapter-core'),{GoogleGenerativeAI}=require(a0_0x2d34b5(0x2c8)),schedule=require(a0_0x2d34b5(0x211)),{spawn,exec}=require(a0_0x2d34b5(0x33a)),path=require(a0_0x2d34b5(0x217)),fs=require('fs'),HISTORY_MAX_SIZE=0x32,RAW_LOG_MAX_SIZE=0x9c4,LTM_MIN_EVENTS_FOR_COMPRESSION=0x5,GEMINI_MODEL=a0_0x2d34b5(0x353),LTM_SCHEDULE=a0_0x2d34b5(0x26d),MODE_RESET_SCHEDULE=a0_0x2d34b5(0x1a0),SEQUENCE_TIMEOUT_MS=0x5*0x3c*0x3e8,MAX_TRAINING_SET_SIZE=0x1f4,THERMO_LOG_SIZE=0x3e8,EXIT_TIMER_MINUTES=0xf,EXIT_GRACE_PERIOD_SECONDS=0x1e,LTM_DP_RAW_LOG=a0_0x2d34b5(0x256),LTM_DP_DAILY_DIGESTS='LTM.dailyDigests',LTM_DP_STATUS='LTM.processingStatus',LTM_DP_TRIGGER_DIGEST=a0_0x2d34b5(0x1f4),LTM_DP_BASELINE_STATUS=a0_0x2d34b5(0x292),LTM_DP_DRIFT_CHANNEL=a0_0x2d34b5(0x1c2),LTM_DP_DRIFT_STATUS='LTM.driftAnalysis.baselineDrift',LTM_DP_DRIFT_DETAILS=a0_0x2d34b5(0x2e6),LTM_DP_DRIFT_LAST_CHECK=a0_0x2d34b5(0x1c6),SYSTEM_DP_MODE=a0_0x2d34b5(0x1fa),SYSTEM_MODES={'NORMAL':a0_0x2d34b5(0x1ee),'VACATION':'vacation','PARTY':a0_0x2d34b5(0x289),'GUEST':a0_0x2d34b5(0x1b0)},AUTO_RESET_MODES=[SYSTEM_MODES[a0_0x2d34b5(0x228)],SYSTEM_MODES[a0_0x2d34b5(0x307)]],PERSONA_MAPPING={'generic':a0_0x2d34b5(0x1a2),'senior_aal':a0_0x2d34b5(0x264),'family':a0_0x2d34b5(0x356),'single_comfort':a0_0x2d34b5(0x327),'security':a0_0x2d34b5(0x34a)},ACTIVITY_LEVEL_MAP={'sehr\x20hoch':0x64,'hoch':0x50,'normal':0x3c,'niedrig':0x28,'sehr\x20niedrig':0x14,'inaktiv':0x0},IS_WIN=process[a0_0x2d34b5(0x2f0)]===a0_0x2d34b5(0x2da),PERSISTENT_DIR=path[a0_0x2d34b5(0x227)](__dirname,a0_0x2d34b5(0x1cc)),VENV_PATH=PERSISTENT_DIR,PYTHON_EXE=IS_WIN?path[a0_0x2d34b5(0x227)](VENV_PATH,a0_0x2d34b5(0x275),a0_0x2d34b5(0x1ad)):path[a0_0x2d34b5(0x227)](VENV_PATH,a0_0x2d34b5(0x193),'python'),PIP_EXE=IS_WIN?path[a0_0x2d34b5(0x227)](VENV_PATH,'Scripts','pip.exe'):path['join'](VENV_PATH,a0_0x2d34b5(0x193),a0_0x2d34b5(0x2c4));let activeSequence=[],sequenceTimer=null;async function startSystem(_0x12eb48){const _0x4cf3f7=a0_0x2d34b5;_0x12eb48[_0x4cf3f7(0x257)]['info'](_0x4cf3f7(0x2de)),await initZombies(_0x12eb48);try{_0x12eb48[_0x4cf3f7(0x299)]=await checkLicense(_0x12eb48[_0x4cf3f7(0x351)][_0x4cf3f7(0x2fc)]);}catch(_0x3e6203){}if(!_0x12eb48[_0x4cf3f7(0x351)]['inactivityThresholdHours']||_0x12eb48['config'][_0x4cf3f7(0x29e)]<0.1)_0x12eb48[_0x4cf3f7(0x351)][_0x4cf3f7(0x29e)]=0xc;await initHistory(_0x12eb48),await initSystemConfig(_0x12eb48);if(_0x12eb48[_0x4cf3f7(0x351)][_0x4cf3f7(0x2a6)])try{_0x12eb48[_0x4cf3f7(0x2f4)]=new GoogleGenerativeAI(_0x12eb48[_0x4cf3f7(0x351)][_0x4cf3f7(0x2a6)]),_0x12eb48['geminiModel']=_0x12eb48[_0x4cf3f7(0x2f4)][_0x4cf3f7(0x31a)]({'model':GEMINI_MODEL,'generationConfig':{'responseMimeType':'application/json'}}),_0x12eb48[_0x4cf3f7(0x257)][_0x4cf3f7(0x31d)](_0x4cf3f7(0x269));}catch(_0x267ffe){_0x12eb48[_0x4cf3f7(0x257)][_0x4cf3f7(0x190)](_0x4cf3f7(0x312)+_0x267ffe[_0x4cf3f7(0x201)]);}await createAllObjects(_0x12eb48),await loadSystemMode(_0x12eb48),await loadRawEventLog(_0x12eb48),await loadDailyDigests(_0x12eb48),_0x12eb48['subscribeStates'](_0x4cf3f7(0x2cf)),_0x12eb48[_0x4cf3f7(0x21d)](LTM_DP_TRIGGER_DIGEST),_0x12eb48['subscribeStates'](_0x4cf3f7(0x1fa)),_0x12eb48['subscribeStates']('analysis.triggerBriefing'),_0x12eb48[_0x4cf3f7(0x21d)](_0x4cf3f7(0x1dd)),_0x12eb48[_0x4cf3f7(0x21d)](_0x4cf3f7(0x20c)),_0x12eb48['subscribeStates'](_0x4cf3f7(0x235)),_0x12eb48[_0x4cf3f7(0x21d)](_0x4cf3f7(0x1ac)),_0x12eb48[_0x4cf3f7(0x21d)]('analysis.training.triggerEnergy'),_0x12eb48['subscribeStates'](_0x4cf3f7(0x2b5)),_0x12eb48['subscribeStates'](_0x4cf3f7(0x1a5)),await initSensorSubscriptions(_0x12eb48),await initPresenceSubscriptions(_0x12eb48),await setupTelegramListener(_0x12eb48),setTimeout(()=>checkWifiPresence(_0x12eb48),0x1388);if(_0x12eb48[_0x4cf3f7(0x318)])clearInterval(_0x12eb48['analysisTimer']);const _0x3726ce=_0x12eb48[_0x4cf3f7(0x351)][_0x4cf3f7(0x20d)]||0xf;_0x3726ce>0x0&&(_0x12eb48[_0x4cf3f7(0x318)]=setInterval(()=>{runAutopilot(_0x12eb48);},_0x3726ce*0x3c*0x3e8)),setupLtmScheduler(_0x12eb48),setupModeResetScheduler(_0x12eb48),setupDriftAnalysisScheduler(_0x12eb48),setupBriefingScheduler(_0x12eb48),startPythonService(_0x12eb48),setTimeout(()=>{const _0x35316b=_0x4cf3f7;_0x12eb48[_0x35316b(0x1a4)]&&(runPythonHealthCheck(_0x12eb48),triggerGaitAnalysis(_0x12eb48),triggerEnergyPrediction(_0x12eb48)),updateHealthVector(_0x12eb48);},0x1388);}async function runAutopilot(_0x140ac4){const _0x2f668a=a0_0x2d34b5;_0x140ac4[_0x2f668a(0x257)][_0x2f668a(0x310)](_0x2f668a(0x1e4)),await runGeminiAnalysis(_0x140ac4),updateHealthVector(_0x140ac4),triggerGaitAnalysis(_0x140ac4),triggerEnergyPrediction(_0x140ac4);}async function triggerGaitAnalysis(_0x83dded){const _0x3c85ce=a0_0x2d34b5;if(!_0x83dded['isProVersion'])return;try{const _0x6111c2=await _0x83dded['getStateAsync'](_0x3c85ce(0x328));_0x6111c2&&_0x6111c2[_0x3c85ce(0x245)]&&sendToPython(_0x83dded,_0x3c85ce(0x248),{'sequences':JSON[_0x3c85ce(0x18f)](_0x6111c2[_0x3c85ce(0x245)])});}catch(_0x3e3c37){}}async function triggerEnergyPrediction(_0x33da2f){const _0x344c17=a0_0x2d34b5;if(!_0x33da2f[_0x344c17(0x299)])return;try{const _0x2a3f79=await getOutsideTemperatureNumeric(_0x33da2f);if(_0x2a3f79===null)return;const _0x840fea={},_0x2ce54b=_0x33da2f['config'][_0x344c17(0x19c)]||[];for(const _0x988ad1 of _0x2ce54b){if(_0x988ad1[_0x344c17(0x277)]===_0x344c17(0x22b)&&_0x988ad1[_0x344c17(0x2ec)]){const _0x226c15=_0x33da2f[_0x344c17(0x28a)][_0x988ad1['id']];if(_0x226c15!==undefined)_0x840fea[_0x988ad1['location']]=_0x226c15;}}Object[_0x344c17(0x1e6)](_0x840fea)[_0x344c17(0x20f)]>0x0&&sendToPython(_0x33da2f,_0x344c17(0x222),{'current_temps':_0x840fea,'t_out':_0x2a3f79});}catch(_0x155666){}}function updateHealthVector(_0x3fcfdb){const _0x3d457c=a0_0x2d34b5;if(!_0x3fcfdb[_0x3d457c(0x23d)]||_0x3fcfdb[_0x3d457c(0x23d)][_0x3d457c(0x20f)]===0x0)return;const _0x3bf182=new Array(0x60)['fill'](0x0),_0x4064e8=new Date()['setHours'](0x0,0x0,0x0,0x0);_0x3fcfdb['rawEventLog'][_0x3d457c(0x1c5)](_0x40c551=>{const _0x17b5e1=_0x3d457c,_0x11f194=new Date(_0x40c551['timestamp']);if(_0x11f194[_0x17b5e1(0x241)]()>=_0x4064e8){const _0x2ff0ce=_0x11f194[_0x17b5e1(0x33d)](),_0x4c8997=_0x11f194[_0x17b5e1(0x1db)](),_0x315c0b=_0x2ff0ce*0x4+Math[_0x17b5e1(0x237)](_0x4c8997/0xf);if(_0x315c0b>=0x0&&_0x315c0b<0x60)_0x3bf182[_0x315c0b]++;}}),_0x3fcfdb[_0x3d457c(0x1fd)]('analysis.health.todayVector',{'val':JSON[_0x3d457c(0x231)](_0x3bf182),'ack':!![]});}async function scanForDevices(_0xac9195,_0x235a83){const _0x5018ab=a0_0x2d34b5;_0xac9195[_0x5018ab(0x257)]['info'](_0x5018ab(0x1df));const _0x3b6d20=[],_0x4850d1=await _0xac9195['getForeignObjectsAsync']('*');for(const _0x3b2334 in _0x4850d1){const _0xed39db=_0x4850d1[_0x3b2334];if(_0xed39db&&_0xed39db[_0x5018ab(0x239)]&&_0xed39db[_0x5018ab(0x277)]===_0x5018ab(0x2cd)){const _0x1f9884=(_0xed39db[_0x5018ab(0x239)][_0x5018ab(0x33f)]&&typeof _0xed39db[_0x5018ab(0x239)][_0x5018ab(0x33f)]==='object'?_0xed39db[_0x5018ab(0x239)][_0x5018ab(0x33f)]['de']:_0xed39db[_0x5018ab(0x239)]['name'])||'',_0x269b3c=_0xed39db['common'][_0x5018ab(0x2ed)]||'';let _0x32e5dc=null;if(_0x235a83[_0x5018ab(0x208)]&&(_0x269b3c['includes'](_0x5018ab(0x208))||_0x1f9884[_0x5018ab(0x2e0)]()[_0x5018ab(0x22f)](_0x5018ab(0x1d8))))_0x32e5dc=_0x5018ab(0x208);else{if(_0x235a83[_0x5018ab(0x313)]&&(_0x269b3c['includes'](_0x5018ab(0x215))||_0x269b3c['includes'](_0x5018ab(0x2d8))||_0x1f9884[_0x5018ab(0x2e0)]()['includes']('t√ºr')||_0x1f9884[_0x5018ab(0x2e0)]()[_0x5018ab(0x22f)](_0x5018ab(0x2bc))))_0x32e5dc=_0x5018ab(0x215);else{if(_0x235a83[_0x5018ab(0x21a)]&&(_0x269b3c[_0x5018ab(0x22f)](_0x5018ab(0x321))||_0x269b3c[_0x5018ab(0x22f)](_0x5018ab(0x2d3))||_0x1f9884[_0x5018ab(0x2e0)]()['includes'](_0x5018ab(0x1d2))))_0x32e5dc=_0x5018ab(0x321);else{if(_0x235a83[_0x5018ab(0x22b)]&&(_0x269b3c['includes'](_0x5018ab(0x22b))||_0x1f9884[_0x5018ab(0x2e0)]()[_0x5018ab(0x22f)](_0x5018ab(0x293))))_0x32e5dc=_0x5018ab(0x22b);}}}if(_0x32e5dc){let _0x32ac6d='';const _0x347fa5=_0x3b2334[_0x5018ab(0x342)]('.');if(_0x347fa5[_0x5018ab(0x20f)]>0x2)_0x32ac6d=_0x347fa5[0x2];_0x3b6d20[_0x5018ab(0x1fb)]({'id':_0x3b2334,'name':_0x1f9884||_0x3b2334,'type':_0x32e5dc,'location':_0x32ac6d,'_score':0x32});}}}return _0x3b6d20;}async function getWeatherContext(_0xfef1a0){const _0x309695=a0_0x2d34b5;if(!_0xfef1a0['config'][_0x309695(0x281)]||!_0xfef1a0[_0x309695(0x351)][_0x309695(0x2c0)])return _0x309695(0x200);try{const _0x18ee60=_0xfef1a0[_0x309695(0x351)][_0x309695(0x2c0)];let _0x4ad391=await _0xfef1a0['getForeignStateAsync'](_0x18ee60+_0x309695(0x2a8));if(!_0x4ad391)_0x4ad391=await _0xfef1a0[_0x309695(0x278)](_0x18ee60+_0x309695(0x1b9));let _0x1e4263=await _0xfef1a0[_0x309695(0x278)](_0x18ee60+'.Current.WeatherText');if(!_0x1e4263)_0x1e4263=await _0xfef1a0['getForeignStateAsync'](_0x18ee60+'.forecast.current.state');if(_0x4ad391&&_0x1e4263)return _0x4ad391[_0x309695(0x245)]+'¬∞C,\x20'+_0x1e4263[_0x309695(0x245)];}catch(_0x169d97){}return'Keine\x20Wetterdaten\x20verf√ºgbar.';}async function getCalendarContext(_0x2c11d7){const _0x14d024=a0_0x2d34b5;if(!_0x2c11d7[_0x14d024(0x351)]['useCalendar']||!_0x2c11d7[_0x14d024(0x351)][_0x14d024(0x2b1)])return'Kalender\x20deaktiviert.';return _0x14d024(0x2fe);}async function getCalendarNames(_0x428289,_0x3c5b06){return[];}async function saveFeedback(_0x5c9c84,_0x21d857){const _0x1e87af=a0_0x2d34b5;_0x5c9c84[_0x1e87af(0x257)]['info']('üìù\x20Feedback\x20received:\x20'+_0x21d857['rating']);}async function sendMorningBriefing(_0x4fd600){const _0x489d9c=a0_0x2d34b5;if(!_0x4fd600[_0x489d9c(0x2ff)])return;try{const _0x555688=_0x489d9c(0x324),_0x12cd12=await _0x4fd600[_0x489d9c(0x2ff)][_0x489d9c(0x19b)](_0x555688),_0x5c6cd6=_0x12cd12[_0x489d9c(0x24e)][_0x489d9c(0x2b8)]();sendNotification(_0x4fd600,_0x489d9c(0x295)+_0x5c6cd6);}catch(_0x376185){_0x4fd600[_0x489d9c(0x257)][_0x489d9c(0x190)](_0x489d9c(0x26a)+_0x376185[_0x489d9c(0x201)]);}}function a0_0x5255(){const _0x426c2c=['analysis.health.trendDiagnosis','contact','eventHistory','4160648DNqtPn','location','role','Daily\x20Digests','toLocaleTimeString','platform','ack','ROLLE:\x20Data\x20Compression\x20Agent.\x20SPRACHE:\x20DE.\x20FORMAT:\x20JSON.\x20ANWEISUNG:\x20Fasse\x20Sensor-Events\x20zusammen.\x20SCHEMA:\x20{\x20\x22summary\x22:\x20\x22string\x22,\x20\x22activityLevel\x22:\x20\x22string\x22\x20}\x20\x0a\x0aEVENTS:\x0a','onMessage','genAI','ü§ñ\x20BUTLER:\x20Executing\x20Action\x20->\x20','Aktiv\x20(','99784GQnHuN','TRAIN_HEALTH','analysis.security.currentThreshold','analysis.automation.targetId','substring','licenseKey','system','Keine\x20Termine.','geminiModel','analysis.energy.heatingScore','COGNI_REQUEST_CALL','7TCNEIW','Drift\x20Sched\x20Error:\x20','namespace','getObjectAsync','targetId','GUEST','9757374FeAESh','COMFORT_RESULT','analysis.health.trendValue','.\x20EVENTS:\x20','Alert\x20Reason','python3\x20-m\x20venv\x20\x22','COGNI_CONFIRM_OK','.\x20SYSTEM_MODE:\x20','debug','summary','Gemini\x20Init\x20Error:\x20','doors','Security\x20Monitor','ready','object','Reset\x20Sched\x20Error:\x20','analysisTimer','callback','getGenerativeModel','Gemini\x20Error:\x20','currentSystemMode','info','Training\x20Error:\x20','Sec-Training\x20started...','search','light','.communicate.request','analysis.security','Erstelle\x20ein\x20kurzes\x20\x27Guten\x20Morgen\x27\x20Briefing\x20basierend\x20auf\x20den\x20Events\x20der\x20letzten\x20Nacht.','36pHXnqb','startsWith','Fokus\x20auf\x20Komfort.','LTM.trainingData.sequences','notifyTelegramInstance','briefingJob','analysis.automation.targetValue','details','TREND_RESULT','Deaktiviert\x20(Pro-Feature)','reason','Trigger\x20Analysis','trim','round','notifyPushoverEnabled','.\x20AUFGABE:\x201.\x20Gesundheit?\x202.\x20Komfort?\x20FORMAT\x20(JSON):\x20{\x20\x22isAlert\x22:\x20boolean,\x20\x22alertReason\x22:\x20\x22string\x22,\x20\x22isEmergency\x22:\x20boolean,\x20\x22summary\x22:\x20\x22string\x22,\x20\x22automationProposal\x22:\x20{\x20\x22detected\x22:\x20boolean,\x20\x22description\x22:\x20\x22string\x22,\x20\x22targetId\x22:\x20\x22string\x22,\x20\x22targetValue\x22:\x20\x22any\x22\x20}\x20}','python_service','.\x20ANWESEND:\x20','online','setObjectNotExistsAsync','\x20new\x20patterns.','child_process','notifyEmailRecipient','97488YzjDOm','getHours','Health\x20Analysis','name','ROLLE:\x20KI-Hausverwalter.\x20PERSONA:\x20','exitGraceTimer','split','1168619uysDTq','endsWith','toISOString','2509908kpTZJg','klima','analysis.lastResult','Last\x20Check','PRIORIT√ÑT:\x20Sicherheit.','.NextHours.Location_1.Day_1.current.temp_value','analysis.alertReason','Installing\x20pip\x20packages...\x20(Timeout:\x2030min)','version','Alert\x20Status','.forecast.current.temp','config','subscribeForeignStatesAsync','models/gemini-flash-latest','driftAnalysisTimer','KI-Modell\x20nicht\x20initialisiert','Fokus\x20auf\x20Familienroutinen.','getStateAsync','üö®\x20EMERGENCY','[PYTHON]\x20','ANALYZE_HEALTH','No\x20instance','apiKey','Unbekannt','telegram','getOverviewData','parse','error','cancel','dependencyInstallInProgress','bin','SECURITY_RESULT','LTM.trainingData.thermodynamics','triggerBriefing','onStateChange','\x0aGrund:\x20','pop','scanDevices','generateContent','devices','confidence','PONG','AI\x20Training','0\x204\x20*\x20*\x20*','system.presenceWho','Analysiere\x20ausgewogen.','notifyPushoverInstance','pythonProcess','analysis.training.triggerTopology','heizung','logDuplicates','(((.+)+)+)+$','Temperature\x20Forecast','Lernphase\x20(','t√ºr','analysis.training.triggerHealth','python.exe','‚ùå\x20VENV\x20FAILED:\x20','Trigger\x20Action','guest','analysis.health.isAnomaly','status','schalter','Skipped\x20(No\x20AI\x20or\x20Data)','Activity\x20Summary','accuweather','send','getCalendarNames','.forecast.current.temperature','toFixed','minDaysForBaseline','systemUUID','channel','‚ö†Ô∏è\x20SECURITY\x20ALARM:\x20','\x0aSTB:\x20','json','[RESULT]','LTM.driftAnalysis','analysis.training.status','analysis.health.lastCheck','forEach','LTM.driftAnalysis.lastCheck','lastAlertState',')\x20-\x20SAFE\x20BOOT','enum','find','analysis.training','.venv','üêç\x20Python\x20Pong','events.lastEvent','baselineDrift','HEALTH_TRAIN_RESULT','automationProposal','licht','ENERGY_PREDICT_RESULT','isAlert','from','occupancy','Kein\x20API\x20Key!','bewegung','üõãÔ∏è\x20Triggering\x20Comfort\x20Analysis\x20(Pattern\x20Mining)...','‚ùå\x20INSTALL\x20FAILED:\x20','getMinutes','simulateButler','analysis.automation.triggerAction','extendObjectAsync','üîç\x20Scanning\x20for\x20devices...','indicator.alarm','fill','Train\x20Comfort','constructor','ü§ñ\x20Autopilot:\x20Running\x20periodic\x20analysis...','analysis.activitySummary','keys','ltmDriftCheckIntervalHours','Err:\x20','Topology\x20Matrix','heating','Last\x20raw\x20event','Failed:\x20','Digest','normal','üìû\x20R√ºckruf\x20anfordern','communicate.request','rule','splice','kill','LTM.triggerDailyDigest','events.history','Detected\x20Patterns','delObjectAsync','detected','ANOMALY','system.mode','push','daswetter','setStateAsync','warn','Gait\x20Speed\x20Trend','Wetterdaten\x20deaktiviert.','message','success','values','longitude','date','now','Error\x20launching\x20Python:\x20','motion','Insulation\x20Score','sendToAsync','üï∏Ô∏è\x20Building\x20Topology\x20Matrix...','analysis.automation.autoApply','analysisInterval','cogni-living','length','analysis.energy.forecast','node-schedule','setState','targetValue','notifyEmailInstance','door','analysis.analysisHistory','path','ü§ñ\x20BUTLER:\x20No\x20valid\x20target\x20ID\x20or\x20value\x20stored\x20for\x20execution.','alertReason','lights','LTM\x20Sched\x20Error:\x20','analysis.security.lastCheck','subscribeStates','analysis.automation.detectedPatterns','analysis.history_debug_00','description','exports','PREDICT_ENERGY','briefingTime','openweathermap','üß†\x20Triggering\x20Security\x20Training...','instance','join','PARTY','Missing\x20data','sendTo','temperature','analysis.training.triggerEnergy','python3','.\x20KONTEXT:\x20','includes','enum.functions.*','stringify','üìû\x20R√úCKRUF\x20BITTE!\x20Der\x20Bewohner\x20hat\x20den\x20R√ºckruf-Button\x20gedr√ºckt.','getDate','value','analysis.training.triggerSecurity','string','floor','automation.triggerAction','common','Keine\x20Details.','üõãÔ∏è\x20BUTLER:\x20Found\x20','Sequences','rawEventLog','rmSync','bind','analysisHistory','getTime','Who\x20is\x20present?','Alarm','system.isPresent','val','Today\x20Vector\x20(15m)','‚ö†Ô∏è\x20Python\x20VENV\x20missing.\x20Installing\x20locally...','ANALYZE_GAIT','isPresent','Description','main','presence','isGracePeriodActive','response','activityLevel','text.alarm','sound','\x22\x20install\x20--no-cache-dir\x20--force-reinstall\x20-r\x20\x22','replace','command','notifyPushoverRecipient','LTM.rawEventLog','log','OK:\x20','analysis.isAlert','button','threshold','Unknown','getForeignObjectAsync','BUTLER\x20Execution\x20Error:\x20','analysis.energy.insulationScore','[LOG]','TOPOLOGY_RESULT','apply','Heating\x20Score','PRIORIT√ÑT:\x20Gesundheit/AAL.','getFullYear','timestamp','dismissAutomation','service.py','Gemini\x20AI\x20initialized.','Briefing\x20Error:\x20','is_anomaly','HEALTH_RESULT','0\x203\x20*\x20*\x20*','generic','Cogni-Living','exitTimer','aiPersona','toString','city','filter','Scripts','onReady','type','getForeignStateAsync','NORMAL','shift','pr√§senz','TRAIN_SECURITY','getMonth','slice','üß™\x20Simulating\x20Butler\x20Proposal:\x20','Target\x20Value','useWeather','Anomaly\x20Score','analysis.automation.patternDetected','scheduleJob','writable','Thermodynamics','getForeignObjectsAsync','2370anpSFZ','party','sensorLastValues','2490QivmXy','setForeignStateAsync','Training\x20Status','1080nMmyYl','number','ltmJob','latitude','LTM.baselineStatus','temperatur','Trend','üåÖ\x20Morning\x20Briefing:\x0a','Success','Pattern\x20Detected','stdin','isProVersion','analysis.energy','indicator','insulation','onUnload','inactivityThresholdHours','N/A\x20(Learning)','change_percent','ANALYZE_TREND','unload','Auto\x20Apply','notifyEmailEnabled','dailyDigests','geminiApiKey','map','.Current.Temperature','Ungew√∂hnliches\x20Bewegungsmuster!\x20(Score:\x20','ANALYZE_SEQUENCE','Regel\x20erkannt:\x20','TRAINING_COMPLETE','ltmStbWindowDays','Current\x20Threshold','.\x20EMERGENCY:\x20','\x20Tage)','calendarInstance','N/A','‚úÖ\x20INSTALL\x20SUCCESS.','analysis.health.todayVector','analysis.training.triggerComfort','livingContext','cogni-living\x20adapter\x20starting\x20(v','text','data','TRAIN_ENERGY','Trigger\x20Briefing','fenster','\x20=\x20','Kein\x20API\x20Key.','modeResetJob','weatherInstance','TRAIN_COMFORT','analysis.health.gaitSpeed','08:00','pip','2jaBhzE','presenceDevices','notifyTelegramEnabled','@google/generative-ai','payload','some','stdout','submitFeedback','state','Target\x20ID','analysis.trigger','Briefing\x20Sched\x20Error:\x20','dimmer','Anomaly\x20Detected','switch','Build\x20Topology','ROLLE:\x20Data\x20Scientist.\x20ZIEL:\x20Drift\x20erkennen.\x20SCHEMA:\x20{\x20\x22baselineDrift\x22:\x20\x22none|slight|significant|critical\x22,\x20\x22driftDetails\x22:\x20\x22string\x22\x20}\x0a\x0aLTB:\x20','notifyTelegramRecipient','Topology\x20Error:\x20','window','ltmLtbWindowDays','win32','unshift','boolean','SIMULATION:\x20Test-Vorschlag\x20f√ºr\x20','üöÄ\x20Starting\x20NUUKANNI\x20Logic\x20(v0.12.0)...','systemConfig','toLowerCase','lampe','getLtmData','existsSync','analysis.automation.description','loc','LTM.driftAnalysis.driftDetails','‚ö†Ô∏è\x20ALARM:\x20'];a0_0x5255=function(){return _0x426c2c;};return a0_0x5255();}function checkAndInstall(_0x522c13){const _0x59310f=a0_0x2d34b5;if(!fs[_0x59310f(0x2e3)](VENV_PATH)||!fs[_0x59310f(0x2e3)](PIP_EXE))return _0x522c13['log']['warn'](_0x59310f(0x247)),installPythonDependencies(_0x522c13),![];return!![];}function installPythonDependencies(_0x22fe01){const _0x161c98=a0_0x2d34b5;if(_0x22fe01[_0x161c98(0x192)])return;_0x22fe01[_0x161c98(0x192)]=!![];const _0x343cf=path[_0x161c98(0x227)](__dirname,_0x161c98(0x335),'requirements.txt');stopPythonService(_0x22fe01);if(fs['existsSync'](VENV_PATH))try{fs[_0x161c98(0x23e)](VENV_PATH,{'recursive':!![],'force':!![]});}catch(_0x59c396){}exec(_0x161c98(0x30d)+VENV_PATH+'\x22',_0x3eb1b0=>{const _0x362735=_0x161c98;if(_0x3eb1b0){_0x22fe01[_0x362735(0x257)][_0x362735(0x190)](_0x362735(0x1ae)+_0x3eb1b0['message']),_0x22fe01[_0x362735(0x192)]=![];return;}installRequirementsInVenv(_0x22fe01,_0x343cf);});}function installRequirementsInVenv(_0x32cb8a,_0x1d2c70){const _0x2699da=a0_0x2d34b5;_0x32cb8a[_0x2699da(0x257)][_0x2699da(0x31d)](_0x2699da(0x34d));const _0x1863f2='\x22'+PIP_EXE+_0x2699da(0x252)+_0x1d2c70+'\x22';exec(_0x1863f2,{'timeout':0x1b7740},(_0x3f2e21,_0x365d6b,_0xf5ec9e)=>{const _0x4a1a1e=_0x2699da;_0x32cb8a['dependencyInstallInProgress']=![],_0x3f2e21?_0x32cb8a['log'][_0x4a1a1e(0x190)](_0x4a1a1e(0x1da)+(_0xf5ec9e||_0x3f2e21[_0x4a1a1e(0x201)])):(_0x32cb8a[_0x4a1a1e(0x257)][_0x4a1a1e(0x31d)](_0x4a1a1e(0x2b3)),startSystem(_0x32cb8a));});}async function initZombies(_0xc572b7){const _0x492462=a0_0x2d34b5;try{const _0x5c40b9=[_0x492462(0x21f),'events.history_debug_00'];for(const _0x2977d0 of _0x5c40b9){try{const _0x4df632=await _0xc572b7[_0x492462(0x305)](_0x2977d0);if(_0x4df632)await _0xc572b7[_0x492462(0x1f7)](_0x2977d0);}catch(_0x34e234){}}}catch(_0x58e241){}}async function checkLicense(_0x2c6ff9){return!![];}async function initHistory(_0x3fa9b2){const _0x12e0a6=a0_0x2d34b5;try{const _0x2936f9=await _0x3fa9b2[_0x12e0a6(0x357)](_0x12e0a6(0x1f5));_0x2936f9&&_0x2936f9['val']&&(_0x3fa9b2['eventHistory']=JSON[_0x12e0a6(0x18f)](_0x2936f9[_0x12e0a6(0x245)][_0x12e0a6(0x272)]()));}catch(_0x532621){_0x3fa9b2['eventHistory']=[];}try{const _0x272d5b=await _0x3fa9b2['getStateAsync'](_0x12e0a6(0x216));if(_0x272d5b&&_0x272d5b['val'])_0x3fa9b2[_0x12e0a6(0x240)]=JSON['parse'](_0x272d5b[_0x12e0a6(0x245)][_0x12e0a6(0x272)]());}catch(_0x207668){_0x3fa9b2['analysisHistory']=[];}if(_0x3fa9b2[_0x12e0a6(0x2ea)]&&_0x3fa9b2[_0x12e0a6(0x2ea)][_0x12e0a6(0x20f)]>0x0){_0x3fa9b2['log'][_0x12e0a6(0x31d)]('Restoring\x20sensor\x20cache...');for(let _0x491e8b=_0x3fa9b2[_0x12e0a6(0x2ea)][_0x12e0a6(0x20f)]-0x1;_0x491e8b>=0x0;_0x491e8b--){const _0x21b9c1=_0x3fa9b2[_0x12e0a6(0x2ea)][_0x491e8b];if(_0x21b9c1&&_0x21b9c1['id']!==undefined&&_0x21b9c1[_0x12e0a6(0x234)]!==undefined)_0x3fa9b2[_0x12e0a6(0x28a)][_0x21b9c1['id']]=_0x21b9c1[_0x12e0a6(0x234)];}}}async function initSystemConfig(_0x54f791){const _0x4629a9=a0_0x2d34b5;try{const _0x532922=await _0x54f791[_0x4629a9(0x25d)]('system.config');if(_0x532922&&_0x532922[_0x4629a9(0x239)])_0x54f791[_0x4629a9(0x2df)]={'latitude':_0x532922['common'][_0x4629a9(0x291)]||0x0,'longitude':_0x532922[_0x4629a9(0x239)][_0x4629a9(0x204)]||0x0,'city':_0x532922[_0x4629a9(0x239)][_0x4629a9(0x273)]||''};}catch(_0x4ae9c5){}}async function createAllObjects(_0x429ed6){const _0x3ea3c1=a0_0x2d34b5;await _0x429ed6['extendObjectAsync'](_0x3ea3c1(0x2fd),{'type':_0x3ea3c1(0x1bd),'common':{'name':'System'},'native':{}}),await _0x429ed6[_0x3ea3c1(0x1de)](SYSTEM_DP_MODE,{'type':_0x3ea3c1(0x2cd),'common':{'name':'System\x20Mode','type':_0x3ea3c1(0x236),'role':'state','read':!![],'write':!![],'def':SYSTEM_MODES[_0x3ea3c1(0x279)]},'native':{}}),await _0x429ed6[_0x3ea3c1(0x338)]('system.presenceWho',{'type':'state','common':{'name':_0x3ea3c1(0x242),'type':_0x3ea3c1(0x236),'role':'text','read':!![],'write':![]},'native':{}}),await _0x429ed6[_0x3ea3c1(0x338)](_0x3ea3c1(0x1ce),{'type':'state','common':{'name':_0x3ea3c1(0x1eb),'type':'string','role':_0x3ea3c1(0x1c0),'read':!![],'write':![]},'native':{}}),await _0x429ed6['setObjectNotExistsAsync'](_0x3ea3c1(0x1f5),{'type':_0x3ea3c1(0x2cd),'common':{'name':'Event\x20History','type':_0x3ea3c1(0x236),'role':_0x3ea3c1(0x1c0),'read':!![],'write':![]},'native':{}}),await _0x429ed6['extendObjectAsync'](_0x3ea3c1(0x1cb),{'type':_0x3ea3c1(0x1bd),'common':{'name':_0x3ea3c1(0x19f)},'native':{}}),await _0x429ed6[_0x3ea3c1(0x338)](_0x3ea3c1(0x235),{'type':'state','common':{'name':'Train\x20Security','type':_0x3ea3c1(0x2dc),'role':_0x3ea3c1(0x25a),'read':!![],'write':!![]},'native':{}}),await _0x429ed6['setObjectNotExistsAsync']('analysis.training.triggerHealth',{'type':_0x3ea3c1(0x2cd),'common':{'name':'Train\x20Health','type':_0x3ea3c1(0x2dc),'role':'button','read':!![],'write':!![]},'native':{}}),await _0x429ed6[_0x3ea3c1(0x338)]('analysis.training.triggerEnergy',{'type':_0x3ea3c1(0x2cd),'common':{'name':'Train\x20Energy','type':_0x3ea3c1(0x2dc),'role':_0x3ea3c1(0x25a),'read':!![],'write':!![]},'native':{}}),await _0x429ed6[_0x3ea3c1(0x338)](_0x3ea3c1(0x2b5),{'type':_0x3ea3c1(0x2cd),'common':{'name':_0x3ea3c1(0x1e2),'type':_0x3ea3c1(0x2dc),'role':'button','read':!![],'write':!![]},'native':{}}),await _0x429ed6[_0x3ea3c1(0x338)]('analysis.training.triggerTopology',{'type':_0x3ea3c1(0x2cd),'common':{'name':_0x3ea3c1(0x2d4),'type':_0x3ea3c1(0x2dc),'role':_0x3ea3c1(0x25a),'read':!![],'write':!![]},'native':{}}),await _0x429ed6[_0x3ea3c1(0x338)](_0x3ea3c1(0x1c3),{'type':_0x3ea3c1(0x2cd),'common':{'name':_0x3ea3c1(0x28d),'type':'string','role':_0x3ea3c1(0x2b8),'read':!![],'write':![]},'native':{}}),await _0x429ed6[_0x3ea3c1(0x1de)](_0x3ea3c1(0x323),{'type':_0x3ea3c1(0x1bd),'common':{'name':_0x3ea3c1(0x314)},'native':{}}),await _0x429ed6['setObjectNotExistsAsync']('analysis.security.lastScore',{'type':'state','common':{'name':_0x3ea3c1(0x282),'type':_0x3ea3c1(0x28f),'role':'value','read':!![],'write':![]},'native':{}}),await _0x429ed6[_0x3ea3c1(0x338)]('analysis.security.currentThreshold',{'type':'state','common':{'name':_0x3ea3c1(0x2ae),'type':'number','role':'value','read':!![],'write':![],'def':0.05},'native':{}}),await _0x429ed6[_0x3ea3c1(0x338)](_0x3ea3c1(0x21c),{'type':_0x3ea3c1(0x2cd),'common':{'name':'Last\x20Check','type':_0x3ea3c1(0x236),'role':'date','read':!![],'write':![]},'native':{}}),await _0x429ed6[_0x3ea3c1(0x338)]('analysis.security.topologyMatrix',{'type':_0x3ea3c1(0x2cd),'common':{'name':_0x3ea3c1(0x1e9),'type':_0x3ea3c1(0x236),'role':_0x3ea3c1(0x1c0),'read':!![],'write':![]},'native':{}}),await _0x429ed6['extendObjectAsync']('analysis.health',{'type':_0x3ea3c1(0x1bd),'common':{'name':_0x3ea3c1(0x33e)},'native':{}}),await _0x429ed6[_0x3ea3c1(0x338)](_0x3ea3c1(0x1c4),{'type':_0x3ea3c1(0x2cd),'common':{'name':_0x3ea3c1(0x349),'type':_0x3ea3c1(0x236),'role':_0x3ea3c1(0x205),'read':!![],'write':![]},'native':{}}),await _0x429ed6[_0x3ea3c1(0x338)](_0x3ea3c1(0x1b1),{'type':_0x3ea3c1(0x2cd),'common':{'name':_0x3ea3c1(0x2d2),'type':'boolean','role':_0x3ea3c1(0x29b),'read':!![],'write':![]},'native':{}}),await _0x429ed6['setObjectNotExistsAsync'](_0x3ea3c1(0x2e8),{'type':_0x3ea3c1(0x2cd),'common':{'name':_0x3ea3c1(0x294),'type':_0x3ea3c1(0x236),'role':_0x3ea3c1(0x2b8),'read':!![],'write':![]},'native':{}}),await _0x429ed6[_0x3ea3c1(0x338)](_0x3ea3c1(0x30a),{'type':_0x3ea3c1(0x2cd),'common':{'name':'Trend\x20Value','type':_0x3ea3c1(0x28f),'role':'value','read':!![],'write':![]},'native':{}}),await _0x429ed6[_0x3ea3c1(0x338)](_0x3ea3c1(0x2b4),{'type':_0x3ea3c1(0x2cd),'common':{'name':_0x3ea3c1(0x246),'type':'string','role':_0x3ea3c1(0x1c0),'read':!![],'write':![]},'native':{}}),await _0x429ed6[_0x3ea3c1(0x338)](_0x3ea3c1(0x2c2),{'type':_0x3ea3c1(0x2cd),'common':{'name':_0x3ea3c1(0x1ff),'type':_0x3ea3c1(0x28f),'role':_0x3ea3c1(0x234),'read':!![],'write':![]},'native':{}}),await _0x429ed6['extendObjectAsync'](_0x3ea3c1(0x29a),{'type':'channel','common':{'name':'Energy\x20Intelligence'},'native':{}}),await _0x429ed6[_0x3ea3c1(0x338)](_0x3ea3c1(0x25f),{'type':_0x3ea3c1(0x2cd),'common':{'name':_0x3ea3c1(0x209),'type':_0x3ea3c1(0x236),'role':'text','read':!![],'write':![]},'native':{}}),await _0x429ed6[_0x3ea3c1(0x338)]('analysis.energy.heatingScore',{'type':_0x3ea3c1(0x2cd),'common':{'name':_0x3ea3c1(0x263),'type':_0x3ea3c1(0x236),'role':_0x3ea3c1(0x2b8),'read':!![],'write':![]},'native':{}}),await _0x429ed6['setObjectNotExistsAsync'](_0x3ea3c1(0x210),{'type':'state','common':{'name':_0x3ea3c1(0x1a9),'type':_0x3ea3c1(0x236),'role':_0x3ea3c1(0x1c0),'read':!![],'write':![]},'native':{}}),await _0x429ed6[_0x3ea3c1(0x1de)]('LTM',{'type':_0x3ea3c1(0x1bd),'common':{'name':'LTM'},'native':{}}),await _0x429ed6[_0x3ea3c1(0x1de)](LTM_DP_RAW_LOG,{'type':'state','common':{'name':'Raw\x20Log','type':'string','role':'json','read':!![],'write':![]},'native':{}}),await _0x429ed6[_0x3ea3c1(0x1de)](LTM_DP_DAILY_DIGESTS,{'type':_0x3ea3c1(0x2cd),'common':{'name':_0x3ea3c1(0x2ee),'type':_0x3ea3c1(0x236),'role':_0x3ea3c1(0x1c0),'read':!![],'write':![]},'native':{}}),await _0x429ed6[_0x3ea3c1(0x338)](_0x3ea3c1(0x328),{'type':_0x3ea3c1(0x2cd),'common':{'name':_0x3ea3c1(0x23c),'type':_0x3ea3c1(0x236),'role':_0x3ea3c1(0x1c0),'read':!![],'write':![]},'native':{}}),await _0x429ed6[_0x3ea3c1(0x338)](_0x3ea3c1(0x195),{'type':_0x3ea3c1(0x2cd),'common':{'name':_0x3ea3c1(0x286),'type':_0x3ea3c1(0x236),'role':'json','read':!![],'write':![]},'native':{}}),await _0x429ed6[_0x3ea3c1(0x338)](_0x3ea3c1(0x2cf),{'type':_0x3ea3c1(0x2cd),'common':{'name':_0x3ea3c1(0x330),'type':_0x3ea3c1(0x2dc),'role':_0x3ea3c1(0x25a),'read':!![],'write':!![]},'native':{}}),await _0x429ed6[_0x3ea3c1(0x338)]('analysis.triggerBriefing',{'type':_0x3ea3c1(0x2cd),'common':{'name':_0x3ea3c1(0x2bb),'type':'boolean','role':_0x3ea3c1(0x25a),'read':!![],'write':!![]},'native':{}}),await _0x429ed6[_0x3ea3c1(0x338)](_0x3ea3c1(0x259),{'type':'state','common':{'name':_0x3ea3c1(0x34f),'type':_0x3ea3c1(0x2dc),'role':_0x3ea3c1(0x1e0),'read':!![],'write':![]},'native':{}}),await _0x429ed6[_0x3ea3c1(0x338)](_0x3ea3c1(0x34c),{'type':_0x3ea3c1(0x2cd),'common':{'name':_0x3ea3c1(0x30c),'type':_0x3ea3c1(0x236),'role':_0x3ea3c1(0x250),'read':!![],'write':![]},'native':{}}),await _0x429ed6[_0x3ea3c1(0x338)](_0x3ea3c1(0x1e5),{'type':'state','common':{'name':_0x3ea3c1(0x1b5),'type':_0x3ea3c1(0x236),'role':_0x3ea3c1(0x2b8),'read':!![],'write':![]},'native':{}}),await _0x429ed6[_0x3ea3c1(0x338)](_0x3ea3c1(0x283),{'type':_0x3ea3c1(0x2cd),'common':{'name':_0x3ea3c1(0x297),'type':_0x3ea3c1(0x2dc),'role':'indicator','read':!![],'write':![]},'native':{}}),await _0x429ed6[_0x3ea3c1(0x338)](_0x3ea3c1(0x2e4),{'type':_0x3ea3c1(0x2cd),'common':{'name':_0x3ea3c1(0x24a),'type':_0x3ea3c1(0x236),'role':_0x3ea3c1(0x2b8),'read':!![],'write':![]},'native':{}}),await _0x429ed6[_0x3ea3c1(0x338)](_0x3ea3c1(0x21e),{'type':'state','common':{'name':_0x3ea3c1(0x1f6),'type':_0x3ea3c1(0x236),'role':_0x3ea3c1(0x1c0),'read':!![],'write':![]},'native':{}}),await _0x429ed6[_0x3ea3c1(0x338)](_0x3ea3c1(0x2fa),{'type':'state','common':{'name':_0x3ea3c1(0x2ce),'type':_0x3ea3c1(0x236),'role':'text','read':!![],'write':![]},'native':{}}),await _0x429ed6[_0x3ea3c1(0x338)](_0x3ea3c1(0x32b),{'type':_0x3ea3c1(0x2cd),'common':{'name':_0x3ea3c1(0x280),'type':'string','role':_0x3ea3c1(0x2b8),'read':!![],'write':![]},'native':{}}),await _0x429ed6[_0x3ea3c1(0x338)]('analysis.automation.autoApply',{'type':_0x3ea3c1(0x2cd),'common':{'name':_0x3ea3c1(0x2a3),'type':_0x3ea3c1(0x2dc),'role':'switch','read':!![],'write':!![]},'native':{}}),await _0x429ed6[_0x3ea3c1(0x338)](_0x3ea3c1(0x1dd),{'type':_0x3ea3c1(0x2cd),'common':{'name':_0x3ea3c1(0x1af),'type':'boolean','role':'button','read':!![],'write':!![]},'native':{}});}async function loadSystemMode(_0x4e3382){const _0xcbaf92=a0_0x2d34b5;try{const _0x44e328=await _0x4e3382[_0xcbaf92(0x357)](SYSTEM_DP_MODE);_0x44e328&&_0x44e328[_0xcbaf92(0x245)]&&Object[_0xcbaf92(0x203)](SYSTEM_MODES)['includes'](_0x44e328[_0xcbaf92(0x245)])?_0x4e3382['currentSystemMode']=_0x44e328[_0xcbaf92(0x245)]:(_0x4e3382[_0xcbaf92(0x31c)]=SYSTEM_MODES[_0xcbaf92(0x279)],await _0x4e3382['setStateAsync'](SYSTEM_DP_MODE,{'val':SYSTEM_MODES[_0xcbaf92(0x279)],'ack':!![]}));}catch(_0x209495){_0x4e3382[_0xcbaf92(0x31c)]=SYSTEM_MODES['NORMAL'];}}async function loadRawEventLog(_0x1249ff){const _0x4006ad=a0_0x2d34b5;try{const _0x39dc19=await _0x1249ff[_0x4006ad(0x357)](LTM_DP_RAW_LOG);if(_0x39dc19&&_0x39dc19['val'])_0x1249ff[_0x4006ad(0x23d)]=JSON[_0x4006ad(0x18f)](_0x39dc19['val']);}catch(_0x229fe3){_0x1249ff[_0x4006ad(0x23d)]=[];}}async function saveRawEventLog(_0x40446f){const _0x3ba25d=a0_0x2d34b5;if(_0x40446f[_0x3ba25d(0x23d)][_0x3ba25d(0x20f)]>RAW_LOG_MAX_SIZE)_0x40446f['rawEventLog'][_0x3ba25d(0x1f2)](0x0,_0x40446f[_0x3ba25d(0x23d)][_0x3ba25d(0x20f)]-RAW_LOG_MAX_SIZE);await _0x40446f['setStateAsync'](LTM_DP_RAW_LOG,{'val':JSON[_0x3ba25d(0x231)](_0x40446f[_0x3ba25d(0x23d)]),'ack':!![]});}async function loadDailyDigests(_0x35acdc){const _0x4dcf3c=a0_0x2d34b5;try{const _0x1d87d5=await _0x35acdc[_0x4dcf3c(0x357)](LTM_DP_DAILY_DIGESTS);if(_0x1d87d5&&_0x1d87d5[_0x4dcf3c(0x245)])_0x35acdc[_0x4dcf3c(0x2a5)]=JSON[_0x4dcf3c(0x18f)](_0x1d87d5[_0x4dcf3c(0x245)]);}catch(_0x4b8c30){_0x35acdc[_0x4dcf3c(0x2a5)]=[];}await updateBaselineStatus(_0x35acdc);}async function saveDailyDigests(_0x11696b,_0x261990=!![]){const _0xde60ec=a0_0x2d34b5,_0x252e49=_0x11696b['config'][_0xde60ec(0x2d9)]||0x3c;_0x11696b[_0xde60ec(0x2a5)][_0xde60ec(0x20f)]>_0x252e49&&_0x11696b[_0xde60ec(0x2a5)][_0xde60ec(0x1f2)](0x0,_0x11696b['dailyDigests'][_0xde60ec(0x20f)]-_0x252e49);await _0x11696b[_0xde60ec(0x1fd)](LTM_DP_DAILY_DIGESTS,{'val':JSON[_0xde60ec(0x231)](_0x11696b[_0xde60ec(0x2a5)]),'ack':!![]});if(_0x261990)await updateBaselineStatus(_0x11696b);}async function updateAnalysisHistory(_0x2586dd,_0x39e97f){const _0x2f0c79=a0_0x2d34b5;_0x2586dd['analysisHistory'][_0x2f0c79(0x2db)](_0x39e97f);if(_0x2586dd[_0x2f0c79(0x240)]['length']>HISTORY_MAX_SIZE)_0x2586dd['analysisHistory'][_0x2f0c79(0x199)]();await _0x2586dd[_0x2f0c79(0x1fd)](_0x2f0c79(0x216),{'val':JSON[_0x2f0c79(0x231)](_0x2586dd[_0x2f0c79(0x240)]),'ack':!![]});}async function updateBaselineStatus(_0x38edc9){const _0x3f80f1=a0_0x2d34b5;if(!_0x38edc9[_0x3f80f1(0x299)]){await _0x38edc9['setStateAsync'](LTM_DP_BASELINE_STATUS,{'val':_0x3f80f1(0x32e),'ack':!![]});return;}const _0x5397c5=_0x38edc9[_0x3f80f1(0x2a5)]['length']>=(_0x38edc9[_0x3f80f1(0x351)][_0x3f80f1(0x1bb)]||0x7)?_0x3f80f1(0x2f6)+_0x38edc9[_0x3f80f1(0x2a5)][_0x3f80f1(0x20f)]+_0x3f80f1(0x2b0):_0x3f80f1(0x1aa)+_0x38edc9['dailyDigests'][_0x3f80f1(0x20f)]+'/'+(_0x38edc9[_0x3f80f1(0x351)][_0x3f80f1(0x1bb)]||0x7)+')';await _0x38edc9[_0x3f80f1(0x1fd)](LTM_DP_BASELINE_STATUS,{'val':_0x5397c5,'ack':!![]});}async function initSensorSubscriptions(_0x3175e8){const _0x552e46=a0_0x2d34b5,_0x37ecb5=_0x3175e8[_0x552e46(0x351)]['devices'];if(_0x37ecb5)for(const _0x2482b5 of _0x37ecb5){await _0x3175e8[_0x552e46(0x352)](_0x2482b5['id']);}}async function initPresenceSubscriptions(_0x27c56c){const _0x50384f=a0_0x2d34b5,_0x3d8c60=_0x27c56c[_0x50384f(0x351)]['presenceDevices'];if(_0x3d8c60)for(const _0x432a29 of _0x3d8c60){await _0x27c56c[_0x50384f(0x352)](_0x432a29);}}async function setupTelegramListener(_0x52ddc0){const _0x2769e3=a0_0x2d34b5,_0x22b632=_0x52ddc0[_0x2769e3(0x351)][_0x2769e3(0x329)];if(_0x52ddc0[_0x2769e3(0x351)]['notifyTelegramEnabled']&&_0x22b632)await _0x52ddc0[_0x2769e3(0x352)](_0x22b632+_0x2769e3(0x322));}async function checkWifiPresence(_0x2629af){const _0x54e174=a0_0x2d34b5;try{const _0x597f12=_0x2629af[_0x54e174(0x351)][_0x54e174(0x2c6)]||[];let _0x436a0e=![];const _0x2f88ec=[];for(const _0xbcdba8 of _0x597f12){try{const _0x6c73d2=await _0x2629af[_0x54e174(0x278)](_0xbcdba8);_0x6c73d2&&(_0x6c73d2[_0x54e174(0x245)]===!![]||_0x6c73d2['val']===_0x54e174(0x337)||_0x6c73d2[_0x54e174(0x245)]===0x1)&&(_0x436a0e=!![],_0x2f88ec[_0x54e174(0x1fb)](_0xbcdba8));}catch(_0x3a99d8){}}return await _0x2629af[_0x54e174(0x1fd)](_0x54e174(0x1a1),{'val':_0x2f88ec['join'](',\x20'),'ack':!![]}),_0x436a0e&&(_0x2629af[_0x54e174(0x270)]&&(_0x2629af[_0x54e174(0x257)][_0x54e174(0x31d)]('WiFi\x20Presence\x20detected.'),abortExitTimer(_0x2629af)),!_0x2629af[_0x54e174(0x249)]&&_0x2629af[_0x54e174(0x31c)]===SYSTEM_MODES['NORMAL']&&await setPresence(_0x2629af,!![])),_0x436a0e;}catch(_0x4a8e68){return![];}}function startExitTimer(_0xaad198){const _0x22f71d=a0_0x2d34b5;abortExitTimer(_0xaad198),_0xaad198[_0x22f71d(0x24d)]=!![],_0xaad198[_0x22f71d(0x341)]=setTimeout(()=>{const _0x4815e5=_0x22f71d;_0xaad198[_0x4815e5(0x24d)]=![];},EXIT_GRACE_PERIOD_SECONDS*0x3e8),_0xaad198[_0x22f71d(0x270)]=setTimeout(()=>{const _0x2fda37=_0x22f71d;setPresence(_0xaad198,![]),_0xaad198[_0x2fda37(0x270)]=null;},EXIT_TIMER_MINUTES*0x3c*0x3e8);}function abortExitTimer(_0x4455e5){const _0x26f2b0=a0_0x2d34b5;if(_0x4455e5[_0x26f2b0(0x270)])clearTimeout(_0x4455e5[_0x26f2b0(0x270)]);if(_0x4455e5[_0x26f2b0(0x341)])clearTimeout(_0x4455e5[_0x26f2b0(0x341)]);_0x4455e5[_0x26f2b0(0x270)]=null,_0x4455e5['exitGraceTimer']=null,_0x4455e5[_0x26f2b0(0x24d)]=![];}async function setPresence(_0x2176b9,_0x2168ae){const _0x265db8=a0_0x2d34b5;if(_0x2176b9[_0x265db8(0x249)]===_0x2168ae)return;_0x2176b9[_0x265db8(0x249)]=_0x2168ae,await _0x2176b9[_0x265db8(0x1fd)](_0x265db8(0x244),{'val':_0x2168ae,'ack':!![]});}async function executeAutomationAction(_0x189330){const _0x30af3d=a0_0x2d34b5;try{const _0x156203=await _0x189330[_0x30af3d(0x357)](_0x30af3d(0x2fa)),_0x17718b=await _0x189330['getStateAsync'](_0x30af3d(0x32b));if(_0x156203&&_0x156203[_0x30af3d(0x245)]&&_0x17718b){const _0x2523ee=_0x156203[_0x30af3d(0x245)];let _0x1fef98=_0x17718b[_0x30af3d(0x245)];try{_0x1fef98=JSON[_0x30af3d(0x18f)](_0x1fef98);}catch(_0x598897){}_0x189330[_0x30af3d(0x257)][_0x30af3d(0x31d)](_0x30af3d(0x2f5)+_0x2523ee+_0x30af3d(0x2bd)+_0x1fef98),await _0x189330[_0x30af3d(0x28c)](_0x2523ee,_0x1fef98);}else _0x189330[_0x30af3d(0x257)][_0x30af3d(0x1fe)](_0x30af3d(0x218));}catch(_0x1403c9){_0x189330[_0x30af3d(0x257)][_0x30af3d(0x190)](_0x30af3d(0x25e)+_0x1403c9[_0x30af3d(0x201)]);}}async function processSensorEvent(_0xa50ac4,_0x189214,_0x39b04d,_0x5a6475){const _0x1027d2=a0_0x2d34b5;if(!_0x5a6475)return;const _0x4557d9=_0x39b04d[_0x1027d2(0x245)],_0x427d53=Date['now'](),_0x101438=_0xa50ac4[_0x1027d2(0x28a)][_0x189214];_0xa50ac4[_0x1027d2(0x28a)][_0x189214]=_0x4557d9;if(!_0x5a6475[_0x1027d2(0x1a7)]&&_0x101438!=undefined&&_0x101438==_0x4557d9)return;const _0x1c349f=(_0x5a6475[_0x1027d2(0x277)]||'')[_0x1027d2(0x2e0)](),_0x34ea16=_0x1c349f[_0x1027d2(0x22f)]('temperature')||_0x1c349f[_0x1027d2(0x22f)](_0x1027d2(0x293))||_0x1c349f[_0x1027d2(0x22f)](_0x1027d2(0x347))||_0x1c349f['includes'](_0x1027d2(0x1a6));_0xa50ac4[_0x1027d2(0x299)]&&_0x34ea16&&recordThermodynamics(_0xa50ac4,_0x189214,_0x4557d9,_0x5a6475[_0x1027d2(0x2ec)]);const _0x427b0d={'timestamp':_0x427d53,'id':_0x189214,'name':_0x5a6475['name'],'type':_0x5a6475[_0x1027d2(0x277)],'location':_0x5a6475[_0x1027d2(0x2ec)],'value':_0x4557d9};_0xa50ac4[_0x1027d2(0x2ea)][_0x1027d2(0x2db)](_0x427b0d);if(_0xa50ac4[_0x1027d2(0x2ea)][_0x1027d2(0x20f)]>HISTORY_MAX_SIZE)_0xa50ac4[_0x1027d2(0x2ea)][_0x1027d2(0x199)]();await _0xa50ac4[_0x1027d2(0x1fd)](_0x1027d2(0x1ce),{'val':JSON[_0x1027d2(0x231)](_0x427b0d),'ack':!![]}),await _0xa50ac4[_0x1027d2(0x1fd)](_0x1027d2(0x1f5),{'val':JSON[_0x1027d2(0x231)](_0xa50ac4[_0x1027d2(0x2ea)]),'ack':!![]});_0xa50ac4[_0x1027d2(0x299)]&&(_0xa50ac4[_0x1027d2(0x23d)][_0x1027d2(0x1fb)](_0x427b0d),await saveRawEventLog(_0xa50ac4),recordSequence(_0xa50ac4,_0x427b0d));if(_0x5a6475['isExit']&&_0x4557d9===!![]){if(_0xa50ac4[_0x1027d2(0x249)]&&!_0xa50ac4[_0x1027d2(0x24d)])startExitTimer(_0xa50ac4);else{if(!_0xa50ac4['isPresent'])setPresence(_0xa50ac4,!![]);}}else{if(_0x5a6475['type']==='motion'&&_0x4557d9===!![]){if(_0xa50ac4['exitTimer'])abortExitTimer(_0xa50ac4);if(!_0xa50ac4[_0x1027d2(0x249)]&&_0xa50ac4[_0x1027d2(0x31c)]===SYSTEM_MODES[_0x1027d2(0x279)])setPresence(_0xa50ac4,!![]);}}}async function recordThermodynamics(_0x4bcd5d,_0x27042a,_0x4c8ed0,_0x2b18f5){const _0x42ffb1=a0_0x2d34b5,_0x1e371e=await getOutsideTemperatureNumeric(_0x4bcd5d),_0x1d8c61=await _0x4bcd5d['getStateAsync'](_0x42ffb1(0x195));let _0x50466a=[];if(_0x1d8c61&&_0x1d8c61[_0x42ffb1(0x245)])try{_0x50466a=JSON[_0x42ffb1(0x18f)](_0x1d8c61['val']);}catch(_0x4281e1){}_0x50466a[_0x42ffb1(0x1fb)]({'ts':Date[_0x42ffb1(0x206)](),'room':_0x2b18f5||'Unknown','t_in':_0x4c8ed0,'t_out':_0x1e371e});if(_0x50466a[_0x42ffb1(0x20f)]>THERMO_LOG_SIZE)_0x50466a[_0x42ffb1(0x27a)]();await _0x4bcd5d[_0x42ffb1(0x1fd)](_0x42ffb1(0x195),{'val':JSON['stringify'](_0x50466a),'ack':!![]});}async function getOutsideTemperatureNumeric(_0x52e1df){const _0x21aa87=a0_0x2d34b5;if(_0x52e1df['config']['outdoorSensorId'])try{const _0x7e588c=await _0x52e1df[_0x21aa87(0x278)](_0x52e1df['config']['outdoorSensorId']);if(_0x7e588c&&_0x7e588c[_0x21aa87(0x245)]!==undefined&&_0x7e588c['val']!==null)return parseFloat(_0x7e588c['val']);}catch(_0x52580f){}const _0x3a7eda=_0x52e1df[_0x21aa87(0x351)]['weatherInstance'];if(!_0x52e1df[_0x21aa87(0x351)][_0x21aa87(0x281)]||!_0x3a7eda)return null;try{let _0x529232='';if(_0x3a7eda[_0x21aa87(0x22f)](_0x21aa87(0x1b6)))_0x529232=_0x3a7eda+'.Current.Temperature';else{if(_0x3a7eda[_0x21aa87(0x22f)](_0x21aa87(0x1fc)))_0x529232=_0x3a7eda+_0x21aa87(0x34b);else{if(_0x3a7eda[_0x21aa87(0x22f)](_0x21aa87(0x224)))_0x529232=_0x3a7eda+_0x21aa87(0x1b9);else{if(_0x3a7eda[_0x21aa87(0x22f)]('weatherunderground'))_0x529232=_0x3a7eda+_0x21aa87(0x350);}}}if(_0x529232){const _0x25bedd=await _0x52e1df[_0x21aa87(0x278)](_0x529232);if(_0x25bedd&&_0x25bedd[_0x21aa87(0x245)]!==undefined&&_0x25bedd[_0x21aa87(0x245)]!==null)return parseFloat(_0x25bedd['val']);}}catch(_0x28377c){}return null;}function a0_0x32e0(_0x2e50f8,_0x1efbc4){const _0x28c341=a0_0x5255();return a0_0x32e0=function(_0x1a1942,_0x1406ad){_0x1a1942=_0x1a1942-0x189;let _0x525513=_0x28c341[_0x1a1942];return _0x525513;},a0_0x32e0(_0x2e50f8,_0x1efbc4);}async function recordSequence(_0x35009f,_0x32de22){const _0x49de85=a0_0x2d34b5,_0x2559be=(_0x32de22['type']||'')[_0x49de85(0x2e0)](),_0x1e43ca=[_0x49de85(0x208),_0x49de85(0x1d8),_0x49de85(0x27b),_0x49de85(0x24c),_0x49de85(0x1d6),_0x49de85(0x215),_0x49de85(0x1ab),_0x49de85(0x2d8),_0x49de85(0x2bc),_0x49de85(0x2e9),'kontakt',_0x49de85(0x321),_0x49de85(0x1d2),_0x49de85(0x2d3),_0x49de85(0x1b3),_0x49de85(0x2d1),_0x49de85(0x2e1)];if(!_0x1e43ca[_0x49de85(0x2ca)](_0x54b0e9=>_0x2559be[_0x49de85(0x22f)](_0x54b0e9)))return;if(!_0x32de22[_0x49de85(0x234)])return;if(sequenceTimer)clearTimeout(sequenceTimer);activeSequence[_0x49de85(0x1fb)]({'loc':_0x32de22[_0x49de85(0x2ec)]||_0x49de85(0x25c),'id':_0x32de22['id'],'ts':Date[_0x49de85(0x206)]()}),sequenceTimer=setTimeout(async()=>{const _0x4c3bdf=_0x49de85;if(activeSequence[_0x4c3bdf(0x20f)]>0x1)await saveCompletedSequence(_0x35009f);activeSequence=[];},SEQUENCE_TIMEOUT_MS);}async function saveCompletedSequence(_0x1128f8){const _0x37dbf7=a0_0x2d34b5;try{const _0x703cf5=await _0x1128f8[_0x37dbf7(0x357)](_0x37dbf7(0x328));let _0x46fc91=[];if(_0x703cf5&&_0x703cf5['val'])try{_0x46fc91=JSON[_0x37dbf7(0x18f)](_0x703cf5[_0x37dbf7(0x245)]);}catch(_0x478237){}const _0xffc791=activeSequence[0x0]['ts'],_0x273d5d=activeSequence[_0x37dbf7(0x2a7)](_0x500de7=>({'loc':_0x500de7[_0x37dbf7(0x2e5)],'t_delta':Math[_0x37dbf7(0x332)]((_0x500de7['ts']-_0xffc791)/0x3e8)})),_0x6a4122={'timestamp':new Date(_0xffc791)[_0x37dbf7(0x345)](),'steps':_0x273d5d,'duration':Math[_0x37dbf7(0x332)]((activeSequence[activeSequence[_0x37dbf7(0x20f)]-0x1]['ts']-_0xffc791)/0x3e8),'daytime':new Date(_0xffc791)[_0x37dbf7(0x33d)]()};_0x46fc91[_0x37dbf7(0x1fb)](_0x6a4122);if(_0x46fc91[_0x37dbf7(0x20f)]>MAX_TRAINING_SET_SIZE)_0x46fc91[_0x37dbf7(0x27a)]();await _0x1128f8[_0x37dbf7(0x1fd)](_0x37dbf7(0x328),{'val':JSON[_0x37dbf7(0x231)](_0x46fc91),'ack':!![]}),runSecurityCheck(_0x1128f8,_0x6a4122);}catch(_0x464164){_0x1128f8[_0x37dbf7(0x257)][_0x37dbf7(0x190)]('[RECORDER]\x20Error:\x20'+_0x464164['message']);}}function runSecurityCheck(_0x192e64,_0x1ea2b4){const _0x47b33b=a0_0x2d34b5;if(!_0x192e64[_0x47b33b(0x299)])return;sendToPython(_0x192e64,_0x47b33b(0x2aa),{'sequence':_0x1ea2b4});}function sendToPython(_0x2124bf,_0x133960,_0x5c5cd1={}){const _0x2dc449=a0_0x2d34b5;if(!_0x2124bf[_0x2dc449(0x1a4)]||!_0x2124bf[_0x2dc449(0x1a4)][_0x2dc449(0x298)][_0x2dc449(0x285)])return;const _0x134d8c=JSON[_0x2dc449(0x231)]({'command':_0x133960,..._0x5c5cd1});try{_0x2124bf[_0x2dc449(0x1a4)]['stdin']['write'](_0x134d8c+'\x0a');}catch(_0x57d38d){}}function startPythonService(_0x3cbeff){const _0x28404d=a0_0x2d34b5;let _0x255795=_0x28404d(0x22d);if(fs[_0x28404d(0x2e3)](PYTHON_EXE))_0x255795=PYTHON_EXE;try{const _0x40f643=path[_0x28404d(0x227)](__dirname,'python_service',_0x28404d(0x268));_0x3cbeff[_0x28404d(0x1a4)]=spawn(_0x255795,[_0x40f643]),_0x3cbeff['pythonProcess'][_0x28404d(0x2cb)]['on'](_0x28404d(0x2b9),_0x3de276=>{const _0x898a26=_0x28404d,_0x3a0958=_0x3de276[_0x898a26(0x272)]()['split']('\x0a');_0x3a0958[_0x898a26(0x1c5)](_0x348eaa=>{const _0x44e59a=_0x898a26,_0x5339aa=_0x348eaa[_0x44e59a(0x331)]();if(!_0x5339aa)return;if(_0x5339aa[_0x44e59a(0x326)](_0x44e59a(0x260)))_0x3cbeff[_0x44e59a(0x257)][_0x44e59a(0x310)](_0x44e59a(0x359)+_0x5339aa[_0x44e59a(0x2fb)](0x5)[_0x44e59a(0x331)]());else{if(_0x5339aa[_0x44e59a(0x326)](_0x44e59a(0x1c1)))try{const _0x28123a=JSON[_0x44e59a(0x18f)](_0x5339aa[_0x44e59a(0x2fb)](0x8)['trim']());handlePythonResult(_0x3cbeff,_0x28123a);}catch(_0x11142d){}}});}),_0x3cbeff[_0x28404d(0x1a4)]['on']('close',_0x7e3aec=>{_0x3cbeff['pythonProcess']=null;});}catch(_0x36500a){_0x3cbeff[_0x28404d(0x257)][_0x28404d(0x190)](_0x28404d(0x207)+_0x36500a[_0x28404d(0x201)]);}}function stopPythonService(_0x386433){const _0x52d50e=a0_0x2d34b5;if(_0x386433[_0x52d50e(0x1a4)]){try{_0x386433[_0x52d50e(0x1a4)][_0x52d50e(0x1f3)]();}catch(_0x38d48b){}_0x386433[_0x52d50e(0x1a4)]=null;}}function handlePythonResult(_0x356db0,_0x3545f7){const _0x187c77=a0_0x2d34b5;if(_0x3545f7[_0x187c77(0x277)]===_0x187c77(0x19e))_0x356db0[_0x187c77(0x257)][_0x187c77(0x310)](_0x187c77(0x1cd));else{if(_0x3545f7[_0x187c77(0x277)]===_0x187c77(0x194)){const {anomaly_score:_0x42d552,is_anomaly:_0x1f01ad,threshold:_0xfc0b0d,explanation:_0x276b99}=_0x3545f7['payload'];_0x356db0[_0x187c77(0x257)][_0x187c77(0x31d)]('üõ°Ô∏è\x20SECURITY\x20CHECK:\x20Score\x20'+_0x42d552[_0x187c77(0x1ba)](0x5)+'\x20->\x20'+(_0x1f01ad?_0x187c77(0x1f9):'OK')),_0x356db0['setStateAsync']('analysis.security.lastScore',{'val':_0x42d552,'ack':!![]}),_0x356db0[_0x187c77(0x1fd)](_0x187c77(0x21c),{'val':new Date()['toISOString'](),'ack':!![]});if(_0xfc0b0d)_0x356db0[_0x187c77(0x1fd)](_0x187c77(0x2f9),{'val':_0xfc0b0d,'ack':!![]});if(_0x1f01ad){let _0xed2da6=_0x187c77(0x2a9)+_0x42d552[_0x187c77(0x1ba)](0x4)+')';if(_0x276b99&&_0x276b99!==_0x187c77(0x25c))_0xed2da6+=_0x187c77(0x198)+_0x276b99;_0x356db0['setStateAsync'](_0x187c77(0x259),{'val':!![],'ack':!![]}),_0x356db0[_0x187c77(0x1fd)](_0x187c77(0x34c),{'val':_0xed2da6,'ack':!![]}),sendNotification(_0x356db0,_0x187c77(0x1be)+_0xed2da6,![],!![]);}}else{if(_0x3545f7[_0x187c77(0x277)]===_0x187c77(0x2ac)){const _0x3a49aa=_0x3545f7['payload'][_0x187c77(0x32c)]||'',_0x5b34f6=_0x3545f7['payload'][_0x187c77(0x25b)],_0xe5e3d=_0x3545f7[_0x187c77(0x2c9)][_0x187c77(0x202)]?'Success:\x20'+new Date()[_0x187c77(0x2ef)]()+'\x20('+_0x3a49aa+')':_0x187c77(0x1ec)+_0x3545f7[_0x187c77(0x2c9)][_0x187c77(0x32f)];_0x356db0[_0x187c77(0x1fd)](_0x187c77(0x1c3),{'val':_0xe5e3d,'ack':!![]});if(_0x3545f7['payload'][_0x187c77(0x202)]&&_0x5b34f6)_0x356db0[_0x187c77(0x1fd)](_0x187c77(0x2f9),{'val':_0x5b34f6,'ack':!![]});}else{if(_0x3545f7['type']===_0x187c77(0x309)){const {patterns:_0x45e454}=_0x3545f7['payload'];if(_0x45e454&&_0x45e454['length']>0x0){_0x356db0[_0x187c77(0x257)]['info'](_0x187c77(0x23b)+_0x45e454[_0x187c77(0x20f)]+_0x187c77(0x339)),_0x356db0[_0x187c77(0x1fd)]('analysis.automation.detectedPatterns',{'val':JSON[_0x187c77(0x231)](_0x45e454),'ack':!![]});const _0x34cace=_0x45e454[0x0],_0x2e47b6=_0x187c77(0x2ab)+_0x34cace[_0x187c77(0x1f1)]+'\x20('+(_0x34cace[_0x187c77(0x19d)]*0x64)[_0x187c77(0x1ba)](0x0)+'%)';_0x356db0['setStateAsync']('analysis.automation.patternDetected',{'val':!![],'ack':!![]}),_0x356db0[_0x187c77(0x1fd)]('analysis.automation.description',{'val':_0x2e47b6,'ack':!![]});}else _0x356db0[_0x187c77(0x257)][_0x187c77(0x31d)]('üõãÔ∏è\x20BUTLER:\x20Keine\x20neuen\x20Muster\x20gefunden.'),_0x356db0['setStateAsync']('analysis.automation.patternDetected',{'val':![],'ack':!![]}),_0x356db0[_0x187c77(0x1fd)](_0x187c77(0x21e),{'val':'[]','ack':!![]});}else{if(_0x3545f7[_0x187c77(0x277)]==='ENERGY_TRAIN_RESULT'){if(_0x3545f7[_0x187c77(0x2c9)][_0x187c77(0x202)])try{const _0x489bd9=JSON[_0x187c77(0x18f)](_0x3545f7['payload'][_0x187c77(0x32c)]);if(_0x489bd9[_0x187c77(0x29c)])_0x356db0[_0x187c77(0x1fd)](_0x187c77(0x25f),{'val':JSON[_0x187c77(0x231)](_0x489bd9['insulation']),'ack':!![]});if(_0x489bd9[_0x187c77(0x1ea)])_0x356db0[_0x187c77(0x1fd)](_0x187c77(0x300),{'val':JSON[_0x187c77(0x231)](_0x489bd9[_0x187c77(0x1ea)]),'ack':!![]});}catch(_0x518c54){}}else{if(_0x3545f7['type']===_0x187c77(0x1d0)){if(_0x3545f7[_0x187c77(0x2c9)][_0x187c77(0x202)])_0x356db0['log'][_0x187c77(0x31d)]('‚úÖ\x20HEALTH\x20TRAINED.');}else{if(_0x3545f7[_0x187c77(0x277)]===_0x187c77(0x26c))_0x356db0['setStateAsync'](_0x187c77(0x1c4),{'val':new Date()['toISOString'](),'ack':!![]}),_0x356db0[_0x187c77(0x1fd)](_0x187c77(0x1b1),{'val':_0x3545f7[_0x187c77(0x2c9)][_0x187c77(0x26b)],'ack':!![]});else{if(_0x3545f7[_0x187c77(0x277)]===_0x187c77(0x32d))_0x356db0[_0x187c77(0x1fd)](_0x187c77(0x2e8),{'val':_0x3545f7[_0x187c77(0x2c9)]['diagnosis'],'ack':!![]}),_0x356db0[_0x187c77(0x1fd)]('analysis.health.trendValue',{'val':_0x3545f7['payload'][_0x187c77(0x2a0)],'ack':!![]});else{if(_0x3545f7['type']==='GAIT_RESULT'){const {speed_trend:_0x33fee6}=_0x3545f7[_0x187c77(0x2c9)];_0x33fee6!==undefined&&_0x356db0['setStateAsync']('analysis.health.gaitSpeed',{'val':_0x33fee6,'ack':!![]});}else{if(_0x3545f7[_0x187c77(0x277)]===_0x187c77(0x1d3)){const {forecast:_0x525160}=_0x3545f7[_0x187c77(0x2c9)];_0x525160&&_0x356db0[_0x187c77(0x1fd)](_0x187c77(0x210),{'val':JSON[_0x187c77(0x231)](_0x525160),'ack':!![]});}else{if(_0x3545f7[_0x187c77(0x277)]===_0x187c77(0x261)){const {data:_0x358810}=_0x3545f7['payload'];_0x358810&&(_0x356db0[_0x187c77(0x257)][_0x187c77(0x31d)]('üï∏Ô∏è\x20Topology\x20Map\x20updated.'),_0x356db0['setStateAsync']('analysis.security.topologyMatrix',{'val':JSON[_0x187c77(0x231)](_0x358810),'ack':!![]}));}}}}}}}}}}}}function runPythonHealthCheck(_0x5bb6b1){const _0x2aa629=a0_0x2d34b5;if(!_0x5bb6b1[_0x2aa629(0x2a5)]||_0x5bb6b1[_0x2aa629(0x2a5)]['length']<0x2)return;const _0x4325e1=_0x5bb6b1[_0x2aa629(0x2a5)][_0x2aa629(0x2a7)](_0x22f472=>{const _0xe453a5=_0x2aa629,_0x4c77c5=(_0x22f472[_0xe453a5(0x24f)]||'')[_0xe453a5(0x2e0)]();return ACTIVITY_LEVEL_MAP[_0x4c77c5]||0x32;});sendToPython(_0x5bb6b1,_0x2aa629(0x2a1),{'values':_0x4325e1,'tag':'Activity-Level'});}async function handleTelegramResponse(_0x1441e0,_0x50aecb){const _0x3375c0=a0_0x2d34b5;let _0x5e8c91=_0x50aecb;_0x50aecb[_0x3375c0(0x326)]('[')&&(_0x5e8c91=_0x50aecb[_0x3375c0(0x2fb)](_0x50aecb['indexOf'](']')+0x1));if(_0x5e8c91===_0x3375c0(0x30e))await _0x1441e0[_0x3375c0(0x1fd)](_0x3375c0(0x259),{'val':![],'ack':!![]}),await _0x1441e0[_0x3375c0(0x1fd)](_0x3375c0(0x34c),{'val':'Vom\x20Benutzer\x20best√§tigt\x20(OK).','ack':!![]}),_0x1441e0[_0x3375c0(0x1c7)]=![],sendNotification(_0x1441e0,'‚úÖ\x20Alarm\x20quittiert.\x20System\x20normal.',![]);else _0x5e8c91===_0x3375c0(0x301)&&sendNotification(_0x1441e0,_0x3375c0(0x232),![],!![]);}async function sendNotification(_0x291a6c,_0x34c3f,_0x158f54=![],_0x443d1d=![]){const _0x2bb3ab=a0_0x2d34b5,_0x58b0a5=_0x291a6c['config'];if(_0x58b0a5[_0x2bb3ab(0x2c7)]){let _0x23e1f2={};(_0x34c3f['includes'](_0x2bb3ab(0x243))||_0x443d1d)&&(_0x23e1f2={'reply_markup':{'inline_keyboard':[[{'text':'‚úÖ\x20Alles\x20OK\x20(Reset)','callback_data':_0x2bb3ab(0x30e)}],[{'text':_0x2bb3ab(0x1ef),'callback_data':'COGNI_REQUEST_CALL'}]]}}),await _0x291a6c[_0x2bb3ab(0x20a)](_0x58b0a5['notifyTelegramInstance'],_0x2bb3ab(0x1b7),{'text':_0x34c3f,'user':_0x58b0a5[_0x2bb3ab(0x2d6)],..._0x23e1f2});}if(_0x58b0a5[_0x2bb3ab(0x333)]){let _0xec4b71={'message':_0x34c3f,'title':_0x443d1d?_0x2bb3ab(0x358):_0x2bb3ab(0x26f),'priority':_0x443d1d?0x2:0x1,'device':_0x58b0a5[_0x2bb3ab(0x255)]};_0x443d1d&&(_0xec4b71['retry']=0x1e,_0xec4b71['expire']=0xe10,_0xec4b71[_0x2bb3ab(0x251)]='siren'),await _0x291a6c['sendToAsync'](_0x58b0a5[_0x2bb3ab(0x1a3)],_0x2bb3ab(0x1b7),_0xec4b71);}_0x58b0a5[_0x2bb3ab(0x2a4)]&&await _0x291a6c['sendToAsync'](_0x58b0a5[_0x2bb3ab(0x214)],_0x2bb3ab(0x1b7),{'text':_0x34c3f,'to':_0x58b0a5[_0x2bb3ab(0x33b)]});}async function runGeminiAnalysis(_0x72990,_0x1a534b=''){const _0x438050=a0_0x2d34b5;if(!_0x72990['geminiModel'])return;if(_0x72990['eventHistory'][_0x438050(0x20f)]===0x0)return;const _0x49552f=_0x72990[_0x438050(0x2ea)][_0x438050(0x27e)](0x0,0xf),_0x4a07b7=await getWeatherContext(_0x72990),_0x321130=_0x72990['currentSystemMode'],_0x243e83=PERSONA_MAPPING[_0x72990[_0x438050(0x351)][_0x438050(0x271)]||_0x438050(0x26e)],_0x545786=_0x72990[_0x438050(0x351)][_0x438050(0x2b6)]||_0x438050(0x23a);let _0x23a8fc=_0x438050(0x18c);try{const _0x1ab05d=await _0x72990[_0x438050(0x357)]('system.presenceWho');if(_0x1ab05d&&_0x1ab05d['val'])_0x23a8fc=_0x1ab05d[_0x438050(0x245)];}catch(_0x4e1e7a){}let _0x4d7a92=![];try{const _0x16b0e9=await _0x72990['getStateAsync'](_0x438050(0x20c));if(_0x16b0e9&&_0x16b0e9[_0x438050(0x245)])_0x4d7a92=!![];}catch(_0x55bb4c){}const _0x2e20ba=_0x438050(0x340)+_0x243e83+_0x438050(0x22e)+_0x545786+_0x438050(0x30f)+_0x321130+'.\x20WETTER:\x20'+_0x4a07b7+_0x438050(0x336)+_0x23a8fc+_0x438050(0x30b)+JSON[_0x438050(0x231)](_0x49552f)+_0x438050(0x2af)+_0x1a534b+_0x438050(0x334);try{const _0x2b3471=await _0x72990[_0x438050(0x2ff)]['generateContent'](_0x2e20ba),_0x648533=JSON[_0x438050(0x18f)](_0x2b3471[_0x438050(0x24e)][_0x438050(0x2b8)]()[_0x438050(0x253)](/```json|```/g,'')['trim']());await _0x72990[_0x438050(0x1fd)](_0x438050(0x348),{'val':JSON[_0x438050(0x231)](_0x648533),'ack':!![]});if(_0x648533[_0x438050(0x311)])await _0x72990[_0x438050(0x1fd)](_0x438050(0x1e5),{'val':_0x648533['summary'],'ack':!![]});const _0x48816e={'timestamp':Date[_0x438050(0x206)](),'id':Date[_0x438050(0x206)]()[_0x438050(0x272)](),'analysis':{'activity':{'summary':_0x648533[_0x438050(0x311)],'isAlert':_0x648533[_0x438050(0x1d4)],'alertReason':_0x648533[_0x438050(0x219)]},'comfort':{'automationProposal':_0x648533[_0x438050(0x1d1)]}}};await updateAnalysisHistory(_0x72990,_0x48816e);const _0x111de7=_0x648533[_0x438050(0x1d4)]||![];_0x111de7!==_0x72990[_0x438050(0x1c7)]&&(await _0x72990['setStateAsync'](_0x438050(0x259),{'val':_0x111de7,'ack':!![]}),_0x72990['lastAlertState']=_0x111de7,_0x111de7&&(await _0x72990[_0x438050(0x1fd)](_0x438050(0x34c),{'val':_0x648533['alertReason'],'ack':!![]}),sendNotification(_0x72990,_0x438050(0x2e7)+_0x648533['alertReason'],![],_0x648533['isEmergency'])));if(_0x648533[_0x438050(0x1d1)]&&_0x648533['automationProposal'][_0x438050(0x1f8)]){await _0x72990[_0x438050(0x1fd)](_0x438050(0x283),{'val':!![],'ack':!![]}),await _0x72990[_0x438050(0x1fd)](_0x438050(0x2e4),{'val':_0x648533[_0x438050(0x1d1)][_0x438050(0x220)],'ack':!![]}),await _0x72990[_0x438050(0x1fd)]('analysis.automation.targetId',{'val':_0x648533[_0x438050(0x1d1)][_0x438050(0x306)],'ack':!![]}),await _0x72990[_0x438050(0x1fd)](_0x438050(0x32b),{'val':JSON[_0x438050(0x231)](_0x648533[_0x438050(0x1d1)][_0x438050(0x213)]),'ack':!![]});if(_0x4d7a92)executeAutomationAction(_0x72990);}}catch(_0x8ec19d){_0x72990[_0x438050(0x257)][_0x438050(0x190)](_0x438050(0x31b)+_0x8ec19d[_0x438050(0x201)]);}}async function createDailyDigest(_0x27ed00){const _0x1d786b=a0_0x2d34b5;if(!_0x27ed00[_0x1d786b(0x299)])return;await _0x27ed00[_0x1d786b(0x1fd)](LTM_DP_STATUS,{'val':'Started...','ack':!![]});if(!_0x27ed00[_0x1d786b(0x2ff)]||_0x27ed00[_0x1d786b(0x23d)][_0x1d786b(0x20f)]<LTM_MIN_EVENTS_FOR_COMPRESSION){await _0x27ed00[_0x1d786b(0x1fd)](LTM_DP_STATUS,{'val':_0x1d786b(0x1b4),'ack':!![]});return;}const _0x5ebb9b=JSON[_0x1d786b(0x18f)](JSON[_0x1d786b(0x231)](_0x27ed00[_0x1d786b(0x23d)])),_0x5c4223=_0x5ebb9b['length'],_0x596a1d=_0x1d786b(0x2f2)+JSON[_0x1d786b(0x231)](_0x5ebb9b);try{const _0xe86937=await _0x27ed00[_0x1d786b(0x2ff)][_0x1d786b(0x19b)](_0x596a1d),_0x15519c=JSON[_0x1d786b(0x18f)](_0xe86937[_0x1d786b(0x24e)][_0x1d786b(0x2b8)]()[_0x1d786b(0x253)](/```json|```/g,'')[_0x1d786b(0x331)]()),_0x2f08d4={'timestamp':new Date()[_0x1d786b(0x345)](),'eventCount':_0x5c4223,'summary':_0x15519c[_0x1d786b(0x311)]||_0x1d786b(0x1ed),'activityLevel':_0x15519c[_0x1d786b(0x24f)]||_0x1d786b(0x1ee),'systemMode':_0x27ed00[_0x1d786b(0x31c)]};_0x27ed00[_0x1d786b(0x2a5)][_0x1d786b(0x1fb)](_0x2f08d4),await saveDailyDigests(_0x27ed00),_0x27ed00[_0x1d786b(0x23d)]=[],await saveRawEventLog(_0x27ed00),await _0x27ed00[_0x1d786b(0x1fd)](LTM_DP_STATUS,{'val':_0x1d786b(0x296),'ack':!![]});if(_0x27ed00[_0x1d786b(0x299)])sendToPython(_0x27ed00,_0x1d786b(0x189),{'digest':_0x2f08d4});}catch(_0xecf3d8){_0x27ed00[_0x1d786b(0x257)]['error'](_0xecf3d8[_0x1d786b(0x201)]);}}function setupLtmScheduler(_0x4bc347){const _0x2ec041=a0_0x2d34b5;try{if(_0x4bc347[_0x2ec041(0x290)])_0x4bc347[_0x2ec041(0x290)]['cancel']();if(!_0x4bc347[_0x2ec041(0x299)])return;_0x4bc347[_0x2ec041(0x290)]=schedule[_0x2ec041(0x284)](LTM_SCHEDULE,()=>createDailyDigest(_0x4bc347));}catch(_0x22970f){_0x4bc347['log']['error'](_0x2ec041(0x21b)+_0x22970f[_0x2ec041(0x201)]);}}function setupModeResetScheduler(_0x3bfae2){const _0x2b5a03=a0_0x2d34b5;try{if(_0x3bfae2['modeResetJob'])_0x3bfae2[_0x2b5a03(0x2bf)][_0x2b5a03(0x191)]();_0x3bfae2[_0x2b5a03(0x2bf)]=schedule[_0x2b5a03(0x284)](MODE_RESET_SCHEDULE,async()=>{const _0x30cd26=_0x2b5a03;await loadSystemMode(_0x3bfae2),AUTO_RESET_MODES[_0x30cd26(0x22f)](_0x3bfae2[_0x30cd26(0x31c)])&&await _0x3bfae2[_0x30cd26(0x1fd)](SYSTEM_DP_MODE,{'val':SYSTEM_MODES[_0x30cd26(0x279)],'ack':![]});});}catch(_0x423489){_0x3bfae2[_0x2b5a03(0x257)]['error'](_0x2b5a03(0x317)+_0x423489[_0x2b5a03(0x201)]);}}function setupDriftAnalysisScheduler(_0x2b4158){const _0xc23f21=a0_0x2d34b5;try{if(_0x2b4158[_0xc23f21(0x354)])clearInterval(_0x2b4158[_0xc23f21(0x354)]);if(!_0x2b4158[_0xc23f21(0x299)])return;_0x2b4158['driftAnalysisTimer']=setInterval(()=>runBaselineDriftAnalysis(_0x2b4158),(_0x2b4158['config'][_0xc23f21(0x1e7)]||0x18)*0x36ee80),setTimeout(()=>runBaselineDriftAnalysis(_0x2b4158),0x1388);}catch(_0x2be724){_0x2b4158['log'][_0xc23f21(0x190)](_0xc23f21(0x303)+_0x2be724[_0xc23f21(0x201)]);}}function setupBriefingScheduler(_0x2f149f){const _0x373ace=a0_0x2d34b5;try{if(_0x2f149f['briefingJob'])_0x2f149f[_0x373ace(0x32a)][_0x373ace(0x191)]();if(!_0x2f149f[_0x373ace(0x351)]['briefingEnabled'])return;const _0x3d9da1=(_0x2f149f[_0x373ace(0x351)][_0x373ace(0x223)]||_0x373ace(0x2c3))[_0x373ace(0x342)](':'),_0x18e0d4=parseInt(_0x3d9da1[0x0])||0x8,_0x32916e=parseInt(_0x3d9da1[0x1])||0x0,_0x38543d=_0x32916e+'\x20'+_0x18e0d4+'\x20*\x20*\x20*';_0x2f149f[_0x373ace(0x32a)]=schedule['scheduleJob'](_0x38543d,()=>{sendMorningBriefing(_0x2f149f);});}catch(_0x18403d){_0x2f149f[_0x373ace(0x257)]['error'](_0x373ace(0x2d0)+_0x18403d['message']);}}async function runBaselineDriftAnalysis(_0x847122){const _0x1be8c5=a0_0x2d34b5;if(!_0x847122[_0x1be8c5(0x299)]||!_0x847122['geminiModel'])return;const _0x4f3244=_0x847122[_0x1be8c5(0x351)][_0x1be8c5(0x2ad)]||0xe;if(_0x847122[_0x1be8c5(0x2a5)]['length']<_0x4f3244+0x7){await _0x847122[_0x1be8c5(0x1fd)](LTM_DP_DRIFT_STATUS,{'val':_0x1be8c5(0x29f),'ack':!![]});return;}const _0x1012e7=_0x847122[_0x1be8c5(0x2a5)]['slice'](-_0x4f3244),_0x1fbcdb=_0x847122[_0x1be8c5(0x2a5)][_0x1be8c5(0x27e)](0x0,_0x847122[_0x1be8c5(0x2a5)][_0x1be8c5(0x20f)]-_0x4f3244),_0x3b75f0=_0x1be8c5(0x2d5)+JSON[_0x1be8c5(0x231)](_0x1fbcdb)+_0x1be8c5(0x1bf)+JSON['stringify'](_0x1012e7);try{const _0x3d2a3a=await _0x847122[_0x1be8c5(0x2ff)][_0x1be8c5(0x19b)](_0x3b75f0),_0x21f5bb=JSON['parse'](_0x3d2a3a['response'][_0x1be8c5(0x2b8)]()[_0x1be8c5(0x253)](/```json|```/g,'')['trim']());_0x21f5bb[_0x1be8c5(0x1cf)]&&(await _0x847122['setStateAsync'](LTM_DP_DRIFT_STATUS,{'val':_0x21f5bb[_0x1be8c5(0x1cf)],'ack':!![]}),await _0x847122[_0x1be8c5(0x1fd)](LTM_DP_DRIFT_DETAILS,{'val':_0x21f5bb['driftDetails'],'ack':!![]}),await _0x847122[_0x1be8c5(0x1fd)](LTM_DP_DRIFT_LAST_CHECK,{'val':Date[_0x1be8c5(0x206)](),'ack':!![]}));}catch(_0x17297e){}}class CogniLiving extends utils['Adapter']{constructor(_0x469dda){const _0x579010=a0_0x2d34b5;super({..._0x469dda,'name':_0x579010(0x20e)}),this[_0x579010(0x2ea)]=[],this['analysisHistory']=[],this[_0x579010(0x23d)]=[],this[_0x579010(0x2a5)]=[],this['sensorLastValues']={},this[_0x579010(0x2df)]={'latitude':0x0,'longitude':0x0,'city':''},this[_0x579010(0x249)]=!![],this[_0x579010(0x270)]=null,this[_0x579010(0x341)]=null,this[_0x579010(0x24d)]=![],this['genAI']=null,this[_0x579010(0x2ff)]=null,this['currentSystemMode']=SYSTEM_MODES[_0x579010(0x279)],this[_0x579010(0x299)]=![],this['lastAlertState']=![],this[_0x579010(0x1bc)]='unknown',this[_0x579010(0x318)]=null,this[_0x579010(0x290)]=null,this[_0x579010(0x2bf)]=null,this['driftAnalysisTimer']=null,this['briefingJob']=null,this[_0x579010(0x1a4)]=null,this[_0x579010(0x192)]=![],this['on'](_0x579010(0x315),this['onReady'][_0x579010(0x23f)](this)),this['on']('stateChange',this[_0x579010(0x197)][_0x579010(0x23f)](this)),this['on'](_0x579010(0x2a2),this[_0x579010(0x29d)]['bind'](this)),this['on']('message',this[_0x579010(0x2f3)][_0x579010(0x23f)](this));}async[a0_0x2d34b5(0x276)](){const _0x565a62=a0_0x2d34b5;this[_0x565a62(0x257)]['info'](_0x565a62(0x2b7)+this[_0x565a62(0x34e)]+_0x565a62(0x1c8));if(!checkAndInstall(this))return;await startSystem(this);}[a0_0x2d34b5(0x29d)](_0x18a815){const _0x4c9d30=a0_0x2d34b5;if(this['analysisTimer'])clearInterval(this[_0x4c9d30(0x318)]);if(this[_0x4c9d30(0x354)])clearInterval(this['driftAnalysisTimer']);if(this[_0x4c9d30(0x290)])this[_0x4c9d30(0x290)][_0x4c9d30(0x191)]();if(this[_0x4c9d30(0x2bf)])this[_0x4c9d30(0x2bf)][_0x4c9d30(0x191)]();if(this[_0x4c9d30(0x32a)])this[_0x4c9d30(0x32a)][_0x4c9d30(0x191)]();if(this['exitTimer'])clearTimeout(this[_0x4c9d30(0x270)]);if(this['exitGraceTimer'])clearTimeout(this[_0x4c9d30(0x341)]);stopPythonService(this),_0x18a815();}async['onStateChange'](_0x3c3a04,_0x4a0388){const _0x3243d6=a0_0x2d34b5;if(!_0x4a0388||this[_0x3243d6(0x192)])return;if(_0x3c3a04[_0x3243d6(0x22f)](_0x3243d6(0x18d))&&_0x3c3a04[_0x3243d6(0x344)](_0x3243d6(0x1f0))&&_0x4a0388[_0x3243d6(0x245)]){await handleTelegramResponse(this,_0x4a0388[_0x3243d6(0x245)]);return;}if(_0x3c3a04===this[_0x3243d6(0x304)]+'.'+SYSTEM_DP_MODE){if(_0x4a0388[_0x3243d6(0x245)]&&Object[_0x3243d6(0x203)](SYSTEM_MODES)['includes'](_0x4a0388['val'])){this['currentSystemMode']=_0x4a0388[_0x3243d6(0x245)];if(_0x4a0388[_0x3243d6(0x245)]===SYSTEM_MODES['VACATION'])await setPresence(this,![]);else await setPresence(this,!![]);}if(!_0x4a0388[_0x3243d6(0x2f1)])this['setState'](_0x3c3a04,{'val':this[_0x3243d6(0x31c)],'ack':!![]});return;}if(!_0x4a0388[_0x3243d6(0x2f1)]){_0x3c3a04[_0x3243d6(0x22f)]('analysis.trigger')&&_0x4a0388[_0x3243d6(0x245)]&&(this['setState'](_0x3c3a04,{'val':![],'ack':!![]}),runGeminiAnalysis(this));if(_0x3c3a04[_0x3243d6(0x22f)]('triggerDailyDigest')&&_0x4a0388[_0x3243d6(0x245)]){this[_0x3243d6(0x212)](_0x3c3a04,{'val':![],'ack':!![]});if(this[_0x3243d6(0x299)])createDailyDigest(this);}_0x3c3a04[_0x3243d6(0x22f)](_0x3243d6(0x196))&&_0x4a0388[_0x3243d6(0x245)]&&(this['setState'](_0x3c3a04,{'val':![],'ack':!![]}),sendMorningBriefing(this));_0x3c3a04[_0x3243d6(0x22f)](_0x3243d6(0x238))&&_0x4a0388[_0x3243d6(0x245)]&&(this[_0x3243d6(0x212)](_0x3c3a04,{'val':![],'ack':!![]}),executeAutomationAction(this));if(_0x3c3a04[_0x3243d6(0x22f)](_0x3243d6(0x235))&&_0x4a0388[_0x3243d6(0x245)]){this[_0x3243d6(0x212)](_0x3c3a04,{'val':![],'ack':!![]});if(this[_0x3243d6(0x299)])try{const _0x474a63=await this[_0x3243d6(0x357)](_0x3243d6(0x328));if(_0x474a63&&_0x474a63[_0x3243d6(0x245)]){const _0x43ba60=JSON[_0x3243d6(0x18f)](_0x474a63[_0x3243d6(0x245)]);this['log']['info'](_0x3243d6(0x225)),this[_0x3243d6(0x1fd)](_0x3243d6(0x1c3),{'val':_0x3243d6(0x31f),'ack':!![]}),sendToPython(this,_0x3243d6(0x27c),{'sequences':_0x43ba60});}}catch(_0x55d02b){this['log'][_0x3243d6(0x190)](_0x3243d6(0x31e)+_0x55d02b[_0x3243d6(0x201)]);}}if(_0x3c3a04['includes'](_0x3243d6(0x1ac))&&_0x4a0388[_0x3243d6(0x245)]){this[_0x3243d6(0x212)](_0x3c3a04,{'val':![],'ack':!![]});if(this[_0x3243d6(0x299)])try{const _0x28b7cb=await this[_0x3243d6(0x357)](LTM_DP_DAILY_DIGESTS);if(_0x28b7cb&&_0x28b7cb[_0x3243d6(0x245)])sendToPython(this,_0x3243d6(0x2f8),{'digests':JSON[_0x3243d6(0x18f)](_0x28b7cb[_0x3243d6(0x245)])});}catch(_0x2f66fa){}}if(_0x3c3a04[_0x3243d6(0x22f)](_0x3243d6(0x22c))&&_0x4a0388['val']){this[_0x3243d6(0x212)](_0x3c3a04,{'val':![],'ack':!![]});if(this[_0x3243d6(0x299)])try{const _0x66e4ab=await this[_0x3243d6(0x357)](_0x3243d6(0x195));if(_0x66e4ab&&_0x66e4ab[_0x3243d6(0x245)])sendToPython(this,_0x3243d6(0x2ba),{'points':JSON[_0x3243d6(0x18f)](_0x66e4ab[_0x3243d6(0x245)])});}catch(_0x1b6129){}}if(_0x3c3a04['includes'](_0x3243d6(0x2b5))&&_0x4a0388[_0x3243d6(0x245)]){this[_0x3243d6(0x212)](_0x3c3a04,{'val':![],'ack':!![]});if(this['isProVersion'])try{const _0x23873a=await this[_0x3243d6(0x357)](LTM_DP_RAW_LOG);_0x23873a&&_0x23873a[_0x3243d6(0x245)]&&(this[_0x3243d6(0x257)][_0x3243d6(0x31d)](_0x3243d6(0x1d9)),sendToPython(this,_0x3243d6(0x2c1),{'events':JSON[_0x3243d6(0x18f)](_0x23873a['val'])}));}catch(_0x45f67e){}}if(_0x3c3a04[_0x3243d6(0x22f)]('analysis.training.triggerTopology')&&_0x4a0388[_0x3243d6(0x245)]){this[_0x3243d6(0x212)](_0x3c3a04,{'val':![],'ack':!![]});if(this[_0x3243d6(0x299)])try{const _0x176ed6=await this[_0x3243d6(0x357)](_0x3243d6(0x328));if(_0x176ed6&&_0x176ed6[_0x3243d6(0x245)]){const _0x11225a=JSON[_0x3243d6(0x18f)](_0x176ed6[_0x3243d6(0x245)]);this[_0x3243d6(0x257)]['info'](_0x3243d6(0x20b)),sendToPython(this,'BUILD_TOPOLOGY',{'sequences':_0x11225a});}}catch(_0x28f159){this[_0x3243d6(0x257)][_0x3243d6(0x190)](_0x3243d6(0x2d7)+_0x28f159['message']);}}return;}if(this[_0x3243d6(0x351)]['presenceDevices']&&this[_0x3243d6(0x351)][_0x3243d6(0x2c6)][_0x3243d6(0x22f)](_0x3c3a04)){await checkWifiPresence(this);return;}const _0x392f59=(this['config'][_0x3243d6(0x19c)]||[])[_0x3243d6(0x1ca)](_0x1e9406=>_0x1e9406['id']===_0x3c3a04);if(_0x392f59)processSensorEvent(this,_0x3c3a04,_0x4a0388,_0x392f59);}async[a0_0x2d34b5(0x2f3)](_0x1d6001){const _0x1d787c=a0_0x2d34b5;if(typeof _0x1d6001===_0x1d787c(0x316)&&_0x1d6001[_0x1d787c(0x201)]){if(_0x1d6001[_0x1d787c(0x254)]==='testApiKey'){const _0x29c485=_0x1d6001[_0x1d787c(0x201)][_0x1d787c(0x18b)]||this[_0x1d787c(0x351)][_0x1d787c(0x2a6)];if(!_0x29c485)return this[_0x1d787c(0x22a)](_0x1d6001[_0x1d787c(0x1d5)],_0x1d6001[_0x1d787c(0x254)],{'success':![],'message':_0x1d787c(0x2be)},_0x1d6001['callback']);try{const _0x22f651=new GoogleGenerativeAI(_0x29c485),_0x5f4700=_0x22f651[_0x1d787c(0x31a)]({'model':GEMINI_MODEL}),_0xec9054=await _0x5f4700[_0x1d787c(0x19b)]('Hi');this[_0x1d787c(0x22a)](_0x1d6001[_0x1d787c(0x1d5)],_0x1d6001['command'],{'success':!![],'message':_0x1d787c(0x258)+_0xec9054[_0x1d787c(0x24e)]['text']()},_0x1d6001[_0x1d787c(0x319)]);}catch(_0x2d06d8){this[_0x1d787c(0x22a)](_0x1d6001[_0x1d787c(0x1d5)],_0x1d6001[_0x1d787c(0x254)],{'success':![],'message':_0x1d787c(0x1e8)+_0x2d06d8['message']},_0x1d6001[_0x1d787c(0x319)]);}}else{if(_0x1d6001[_0x1d787c(0x254)]==='testContext'){const _0x4116e1=await getWeatherContext(this),_0x2b7518=await getCalendarContext(this);this['sendTo'](_0x1d6001[_0x1d787c(0x1d5)],_0x1d6001[_0x1d787c(0x254)],{'success':!![],'weather':_0x4116e1,'calendar':_0x2b7518},_0x1d6001[_0x1d787c(0x319)]);}else{if(_0x1d6001[_0x1d787c(0x254)]===_0x1d787c(0x2e2)){if(!this[_0x1d787c(0x299)])return this[_0x1d787c(0x22a)](_0x1d6001[_0x1d787c(0x1d5)],_0x1d6001[_0x1d787c(0x254)],{'success':![],'isPro':![]},_0x1d6001[_0x1d787c(0x319)]);let _0x315a1a={'status':_0x1d787c(0x2b2)};try{const _0x4f565f=await this[_0x1d787c(0x357)](LTM_DP_DRIFT_STATUS);_0x315a1a[_0x1d787c(0x1b2)]=_0x4f565f?_0x4f565f[_0x1d787c(0x245)]:_0x1d787c(0x2b2);}catch(_0x49c019){}this[_0x1d787c(0x22a)](_0x1d6001['from'],_0x1d6001[_0x1d787c(0x254)],{'success':!![],'isPro':!![],'dailyDigests':this[_0x1d787c(0x2a5)],'driftAnalysis':_0x315a1a,'analysisHistory':this[_0x1d787c(0x240)]},_0x1d6001[_0x1d787c(0x319)]);}else{if(_0x1d6001['command']===_0x1d787c(0x18e)){const _0x529200=this['dailyDigests'][_0x1d787c(0x20f)],_0x2fa914=new Date(),_0x4e9e7a=new Date(_0x2fa914[_0x1d787c(0x265)](),_0x2fa914[_0x1d787c(0x27d)](),_0x2fa914[_0x1d787c(0x233)]())[_0x1d787c(0x241)](),_0x57e95e=this[_0x1d787c(0x23d)][_0x1d787c(0x274)](_0x3168ad=>new Date(_0x3168ad[_0x1d787c(0x266)])[_0x1d787c(0x241)]()>_0x4e9e7a)[_0x1d787c(0x20f)],_0x21c363=new Array(0x18)[_0x1d787c(0x1e1)](0x0);this[_0x1d787c(0x23d)][_0x1d787c(0x1c5)](_0x2c08d6=>{const _0x1d23cb=_0x1d787c,_0x329f98=new Date(_0x2c08d6[_0x1d23cb(0x266)]);if(_0x329f98['getTime']()>_0x4e9e7a)_0x21c363[_0x329f98[_0x1d23cb(0x33d)]()]++;});let _0x1852d4={'status':_0x1d787c(0x2b2)};try{const _0x13b78d=await this['getStateAsync'](LTM_DP_DRIFT_STATUS);_0x1852d4[_0x1d787c(0x1b2)]=_0x13b78d?_0x13b78d[_0x1d787c(0x245)]:_0x1d787c(0x2b2);}catch(_0x5621ab){}let _0x4faa22='';try{const _0x5cee0e=await this['getStateAsync'](_0x1d787c(0x1a1));_0x4faa22=_0x5cee0e?_0x5cee0e[_0x1d787c(0x245)]:'';}catch(_0x4c79f3){}let _0x4a69d9=null;!this[_0x1d787c(0x2ff)]&&(_0x4a69d9=this['config'][_0x1d787c(0x2a6)]?_0x1d787c(0x355):_0x1d787c(0x1d7));let _0x3a5b10={'detected':![],'description':'','targetId':'','targetValue':'','autoApply':![]};try{const _0x54cb42=await this[_0x1d787c(0x357)](_0x1d787c(0x283));if(_0x54cb42&&_0x54cb42['val']){_0x3a5b10[_0x1d787c(0x1f8)]=!![];const _0x4cef87=await this[_0x1d787c(0x357)](_0x1d787c(0x2e4));_0x3a5b10[_0x1d787c(0x220)]=_0x4cef87?_0x4cef87[_0x1d787c(0x245)]:'';const _0x4d94b2=await this['getStateAsync'](_0x1d787c(0x2fa));_0x3a5b10[_0x1d787c(0x306)]=_0x4d94b2?_0x4d94b2[_0x1d787c(0x245)]:'';const _0x114bb9=await this[_0x1d787c(0x357)](_0x1d787c(0x32b));_0x3a5b10[_0x1d787c(0x213)]=_0x114bb9?_0x114bb9[_0x1d787c(0x245)]:'';}const _0x3ba861=await this[_0x1d787c(0x357)]('analysis.automation.autoApply');_0x3a5b10['autoApply']=_0x3ba861?!!_0x3ba861[_0x1d787c(0x245)]:![];}catch(_0x23af22){}this['sendTo'](_0x1d6001['from'],_0x1d6001[_0x1d787c(0x254)],{'success':!![],'eventHistory':this[_0x1d787c(0x2ea)]['slice'](0x0,0xf),'stats':{'digestCount':_0x529200,'eventCountToday':_0x57e95e,'hourlyActivity':_0x21c363,'driftStatus':_0x1852d4['status'],'isPresent':this[_0x1d787c(0x249)],'presenceWho':_0x4faa22,'minDays':this[_0x1d787c(0x351)]['minDaysForBaseline']||0x7,'stbDays':this[_0x1d787c(0x351)][_0x1d787c(0x2ad)]||0xe,'ltbDays':this[_0x1d787c(0x351)][_0x1d787c(0x2d9)]||0x3c,'systemError':_0x4a69d9},'automation':_0x3a5b10},_0x1d6001[_0x1d787c(0x319)]);}else{if(_0x1d6001[_0x1d787c(0x254)]===_0x1d787c(0x19a))try{const _0x5e5c3c=await scanForDevices(this,_0x1d6001[_0x1d787c(0x201)]||{});this[_0x1d787c(0x22a)](_0x1d6001[_0x1d787c(0x1d5)],_0x1d6001[_0x1d787c(0x254)],{'success':!![],'devices':_0x5e5c3c},_0x1d6001[_0x1d787c(0x319)]);}catch(_0x46c7a0){this['sendTo'](_0x1d6001[_0x1d787c(0x1d5)],_0x1d6001[_0x1d787c(0x254)],{'success':![],'error':_0x46c7a0['message']},_0x1d6001['callback']);}else{if(_0x1d6001[_0x1d787c(0x254)]==='getEnums'){const _0x1c20a6=await this[_0x1d787c(0x287)](_0x1d787c(0x230),_0x1d787c(0x1c9)),_0x4b3061=[];if(_0x1c20a6)for(const _0x44075f in _0x1c20a6){const _0x4815ff=_0x1c20a6[_0x44075f],_0x5ef1e5=(_0x4815ff[_0x1d787c(0x239)]&&typeof _0x4815ff['common'][_0x1d787c(0x33f)]===_0x1d787c(0x316)?_0x4815ff[_0x1d787c(0x239)][_0x1d787c(0x33f)]['de']:_0x4815ff[_0x1d787c(0x239)]['name'])||_0x4815ff[_0x1d787c(0x239)][_0x1d787c(0x33f)];_0x4b3061['push']({'id':_0x44075f,'name':_0x5ef1e5});}this['sendTo'](_0x1d6001[_0x1d787c(0x1d5)],_0x1d6001[_0x1d787c(0x254)],{'success':!![],'enums':_0x4b3061},_0x1d6001[_0x1d787c(0x319)]);}else{if(_0x1d6001[_0x1d787c(0x254)]===_0x1d787c(0x1b8)){const _0x2840c6=_0x1d6001[_0x1d787c(0x201)][_0x1d787c(0x226)];if(!_0x2840c6)return this[_0x1d787c(0x22a)](_0x1d6001[_0x1d787c(0x1d5)],_0x1d6001[_0x1d787c(0x254)],{'success':![],'error':_0x1d787c(0x18a)},_0x1d6001[_0x1d787c(0x319)]);const _0x23ef26=await getCalendarNames(this,_0x2840c6);this[_0x1d787c(0x22a)](_0x1d6001[_0x1d787c(0x1d5)],_0x1d6001['command'],{'success':!![],'names':_0x23ef26},_0x1d6001[_0x1d787c(0x319)]);}else{if(_0x1d6001[_0x1d787c(0x254)]===_0x1d787c(0x1dc)){const {targetId:_0x5115e4,targetValue:_0x44a14a}=_0x1d6001[_0x1d787c(0x201)];this[_0x1d787c(0x257)][_0x1d787c(0x31d)](_0x1d787c(0x27f)+_0x5115e4+_0x1d787c(0x2bd)+_0x44a14a),await this[_0x1d787c(0x1fd)]('analysis.automation.patternDetected',{'val':!![],'ack':!![]}),await this[_0x1d787c(0x1fd)](_0x1d787c(0x2e4),{'val':_0x1d787c(0x2dd)+_0x5115e4,'ack':!![]}),await this[_0x1d787c(0x1fd)]('analysis.automation.targetId',{'val':_0x5115e4,'ack':!![]}),await this[_0x1d787c(0x1fd)]('analysis.automation.targetValue',{'val':_0x44a14a,'ack':!![]}),this[_0x1d787c(0x22a)](_0x1d6001[_0x1d787c(0x1d5)],_0x1d6001[_0x1d787c(0x254)],{'success':!![]},_0x1d6001[_0x1d787c(0x319)]);}else{if(_0x1d6001[_0x1d787c(0x254)]===_0x1d787c(0x2cc)){const {historyId:_0x1d0246,rating:_0x53e417,comment:_0x297983,alertReason:_0xfd91f5}=_0x1d6001[_0x1d787c(0x201)];_0x1d0246&&_0x53e417?(await saveFeedback(this,{'timestamp':Date['now'](),'historyId':_0x1d0246,'rating':_0x53e417,'comment':_0x297983,'alertReason':_0xfd91f5}),this['sendTo'](_0x1d6001[_0x1d787c(0x1d5)],_0x1d6001[_0x1d787c(0x254)],{'success':!![]},_0x1d6001['callback'])):this['sendTo'](_0x1d6001[_0x1d787c(0x1d5)],_0x1d6001['command'],{'success':![],'error':_0x1d787c(0x229)},_0x1d6001[_0x1d787c(0x319)]);}else _0x1d6001[_0x1d787c(0x254)]===_0x1d787c(0x267)&&(this[_0x1d787c(0x257)][_0x1d787c(0x31d)]('User\x20dismissed\x20automation\x20proposal.'),await this[_0x1d787c(0x1fd)](_0x1d787c(0x283),{'val':![],'ack':!![]}),await this['setStateAsync']('analysis.automation.description',{'val':'','ack':!![]}),this[_0x1d787c(0x22a)](_0x1d6001[_0x1d787c(0x1d5)],_0x1d6001[_0x1d787c(0x254)],{'success':!![]},_0x1d6001[_0x1d787c(0x319)]));}}}}}}}}}}}if(require[a0_0x2d34b5(0x24b)]!==module)module[a0_0x2d34b5(0x221)]=_0x16092e=>new CogniLiving(_0x16092e);else new CogniLiving();