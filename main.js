const a0_0x2c53cb=a0_0xa864;function a0_0xa864(_0x2ff866,_0x3fe0fc){const _0x4cf080=a0_0x7041();return a0_0xa864=function(_0x20831a,_0x11c645){_0x20831a=_0x20831a-0x16e;let _0x7041bf=_0x4cf080[_0x20831a];return _0x7041bf;},a0_0xa864(_0x2ff866,_0x3fe0fc);}(function(_0x1be831,_0x45e52b){const _0x4572c2=a0_0xa864,_0xb60e84=_0x1be831();while(!![]){try{const _0x16d2a7=parseInt(_0x4572c2(0x2c4))/0x1*(parseInt(_0x4572c2(0x2d9))/0x2)+parseInt(_0x4572c2(0x220))/0x3*(-parseInt(_0x4572c2(0x2b6))/0x4)+-parseInt(_0x4572c2(0x1bf))/0x5*(parseInt(_0x4572c2(0x2dc))/0x6)+-parseInt(_0x4572c2(0x1d6))/0x7*(-parseInt(_0x4572c2(0x2a3))/0x8)+parseInt(_0x4572c2(0x206))/0x9+-parseInt(_0x4572c2(0x281))/0xa+parseInt(_0x4572c2(0x237))/0xb*(parseInt(_0x4572c2(0x211))/0xc);if(_0x16d2a7===_0x45e52b)break;else _0xb60e84['push'](_0xb60e84['shift']());}catch(_0xc3b879){_0xb60e84['push'](_0xb60e84['shift']());}}}(a0_0x7041,0x34026));const a0_0x11c645=(function(){let _0x2a2888=!![];return function(_0x441ca1,_0x1aa038){const _0x572e3=_0x2a2888?function(){const _0x48f5c3=a0_0xa864;if(_0x1aa038){const _0x108d8d=_0x1aa038[_0x48f5c3(0x1c8)](_0x441ca1,arguments);return _0x1aa038=null,_0x108d8d;}}:function(){};return _0x2a2888=![],_0x572e3;};}()),a0_0x20831a=a0_0x11c645(this,function(){const _0x4abe94=a0_0xa864;return a0_0x20831a['toString']()[_0x4abe94(0x2a8)](_0x4abe94(0x27d))[_0x4abe94(0x24e)]()[_0x4abe94(0x187)](a0_0x20831a)['search'](_0x4abe94(0x27d));});a0_0x20831a();'use strict';const utils=require(a0_0x2c53cb(0x341)),{GoogleGenerativeAI}=require(a0_0x2c53cb(0x2e9)),schedule=require(a0_0x2c53cb(0x2d4)),HISTORY_MAX_SIZE=0x32,ANALYSIS_HISTORY_MAX_SIZE=0x64,RAW_LOG_MAX_SIZE=0x5dc,LTM_MIN_EVENTS_FOR_COMPRESSION=0x5,GEMINI_MODEL=a0_0x2c53cb(0x2b0),LTM_SCHEDULE=a0_0x2c53cb(0x24a),MODE_RESET_SCHEDULE=a0_0x2c53cb(0x21c),LTM_DP_RAW_LOG='LTM.rawEventLog',LTM_DP_DAILY_DIGESTS=a0_0x2c53cb(0x2b2),LTM_DP_STATUS=a0_0x2c53cb(0x2f1),LTM_DP_TRIGGER_DIGEST=a0_0x2c53cb(0x2be),LTM_DP_BASELINE_STATUS=a0_0x2c53cb(0x279),LTM_DP_DRIFT_STATUS='LTM.driftAnalysis.baselineDrift',LTM_DP_DRIFT_DETAILS=a0_0x2c53cb(0x16e),LTM_DP_DRIFT_LAST_CHECK='LTM.driftAnalysis.lastCheck',SYSTEM_DP_MODE='system.mode',SYSTEM_MODES={'NORMAL':'normal','VACATION':'vacation','PARTY':a0_0x2c53cb(0x313),'GUEST':'guest'},AUTO_RESET_MODES=[SYSTEM_MODES[a0_0x2c53cb(0x308)],SYSTEM_MODES[a0_0x2c53cb(0x21a)]],EXIT_TIMER_MINUTES=0xf,EXIT_GRACE_PERIOD_SECONDS=0x1e,PERSONA_MAPPING={'generic':a0_0x2c53cb(0x28a),'senior_aal':'PRIORITÄT:\x20Gesundheit\x20und\x20Sicherheit\x20für\x20Senioren\x20(AAL).\x20Erkenne\x20Inaktivität,\x20potenzielle\x20Stürze\x20(indirekt),\x20Schlafunterbrechungen\x20und\x20nächtliche\x20Unruhe.','family':a0_0x2c53cb(0x1ae),'single_comfort':a0_0x2c53cb(0x302),'security':a0_0x2c53cb(0x1b7)};class CogniLiving extends utils[a0_0x2c53cb(0x1af)]{constructor(_0x2a720d){const _0x2f9f8f=a0_0x2c53cb;super({..._0x2a720d,'name':'cogni-living'}),this[_0x2f9f8f(0x255)]=[],this['analysisHistory']=[],this[_0x2f9f8f(0x248)]=[],this['rawEventLog']=[],this[_0x2f9f8f(0x323)]=[],this[_0x2f9f8f(0x1d2)]={},this[_0x2f9f8f(0x1a1)]={'latitude':0x0,'longitude':0x0,'city':''},this[_0x2f9f8f(0x28c)]=!![],this['exitTimer']=null,this[_0x2f9f8f(0x34e)]=null,this['isGracePeriodActive']=![],this['genAI']=null,this['geminiModel']=null,this['currentSystemMode']=SYSTEM_MODES['NORMAL'],this[_0x2f9f8f(0x2c6)]=![],this[_0x2f9f8f(0x1e7)]=![],this[_0x2f9f8f(0x272)]=_0x2f9f8f(0x2ed),this[_0x2f9f8f(0x25a)]=null,this['ltmJob']=null,this[_0x2f9f8f(0x186)]=null,this['driftAnalysisTimer']=null,this['briefingJob']=null,this['on'](_0x2f9f8f(0x299),this[_0x2f9f8f(0x18f)][_0x2f9f8f(0x1f6)](this)),this['on']('stateChange',this['onStateChange'][_0x2f9f8f(0x1f6)](this)),this['on'](_0x2f9f8f(0x2a6),this['onUnload'][_0x2f9f8f(0x1f6)](this)),this['on'](_0x2f9f8f(0x33e),this['onMessage']['bind'](this));}async[a0_0x2c53cb(0x18f)](){const _0x3d877b=a0_0x2c53cb;this[_0x3d877b(0x2e8)]['info'](_0x3d877b(0x27b)+this['version']+')');const _0x3fb5ca=[_0x3d877b(0x216),'analysis.history_debug_01',_0x3d877b(0x1ad),_0x3d877b(0x2e3),_0x3d877b(0x180),_0x3d877b(0x347),_0x3d877b(0x189),'events.history_debug_02',_0x3d877b(0x176),_0x3d877b(0x27a)];for(const _0x3fcb19 of _0x3fb5ca){try{const _0x161ea8=await this[_0x3d877b(0x338)](_0x3fcb19);_0x161ea8&&await this['delObjectAsync'](_0x3fcb19);}catch(_0x467117){}}this['config']['licenseKey']=this['config']['licenseKey']||'',this[_0x3d877b(0x2c6)]=await this['checkLicense'](this[_0x3d877b(0x1d0)][_0x3d877b(0x1e6)]);if(!this['config']['inactivityThresholdHours']||this[_0x3d877b(0x1d0)]['inactivityThresholdHours']<0.1)this[_0x3d877b(0x1d0)][_0x3d877b(0x1b3)]=0xc;await this[_0x3d877b(0x2fe)]();try{const _0xda7595=await this[_0x3d877b(0x22c)](_0x3d877b(0x197));_0xda7595&&_0xda7595['common']&&(this[_0x3d877b(0x1a1)]={'latitude':_0xda7595[_0x3d877b(0x25f)][_0x3d877b(0x212)]||0x0,'longitude':_0xda7595[_0x3d877b(0x25f)][_0x3d877b(0x1bc)]||0x0,'city':_0xda7595[_0x3d877b(0x25f)][_0x3d877b(0x228)]||''});}catch(_0x320fee){}if(this[_0x3d877b(0x1d0)][_0x3d877b(0x2e2)])try{this['genAI']=new GoogleGenerativeAI(this[_0x3d877b(0x1d0)]['geminiApiKey']),this['geminiModel']=this[_0x3d877b(0x2fb)][_0x3d877b(0x2fc)]({'model':GEMINI_MODEL,'generationConfig':{'responseMimeType':_0x3d877b(0x32c)}}),this[_0x3d877b(0x2e8)][_0x3d877b(0x1e0)](_0x3d877b(0x1c9));}catch(_0xc705ba){this[_0x3d877b(0x2e8)][_0x3d877b(0x23b)](_0x3d877b(0x2cc)+_0xc705ba[_0x3d877b(0x33e)]);}await this['createAllObjects'](),await this['loadSystemMode'](),await this[_0x3d877b(0x224)](),await this[_0x3d877b(0x23e)](),this[_0x3d877b(0x1b9)](_0x3d877b(0x1cb)),this[_0x3d877b(0x1b9)](LTM_DP_TRIGGER_DIGEST),this['subscribeStates'](_0x3d877b(0x262)),this[_0x3d877b(0x1b9)]('analysis.triggerBriefing');const _0x65cc3f=this['config']['devices'];if(_0x65cc3f&&_0x65cc3f[_0x3d877b(0x1a8)]>0x0){this[_0x3d877b(0x2e8)]['info']('Subscribing\x20to\x20'+_0x65cc3f['length']+_0x3d877b(0x30a));for(const _0x32ea21 of _0x65cc3f){if(_0x32ea21['id']){await this[_0x3d877b(0x1c1)](_0x32ea21['id']);try{const _0x5ae366=await this[_0x3d877b(0x253)](_0x32ea21['id']);if(_0x5ae366)this[_0x3d877b(0x1d2)][_0x32ea21['id']]=_0x5ae366[_0x3d877b(0x270)];}catch(_0xc8e273){}}}}const _0x4b176e=this[_0x3d877b(0x1d0)][_0x3d877b(0x1dc)]||[];if(_0x4b176e['length']>0x0){this['log'][_0x3d877b(0x1e0)](_0x3d877b(0x24b)+_0x4b176e['length']+_0x3d877b(0x246));for(const _0x40e00b of _0x4b176e){await this[_0x3d877b(0x1c1)](_0x40e00b);}await this[_0x3d877b(0x28b)]();}if(this[_0x3d877b(0x25a)])clearInterval(this[_0x3d877b(0x25a)]);const _0x22ffd9=this[_0x3d877b(0x1d0)][_0x3d877b(0x207)]||0xf;_0x22ffd9>0x0&&(this[_0x3d877b(0x2e8)][_0x3d877b(0x1e0)](_0x3d877b(0x1d9)+_0x22ffd9+'\x20min).\x20Watchdog\x20Limit:\x20'+this[_0x3d877b(0x1d0)][_0x3d877b(0x1b3)]+'h.'),this[_0x3d877b(0x25a)]=setInterval(()=>this['runAutopilot'](),_0x22ffd9*0x3c*0x3e8)),this[_0x3d877b(0x30e)](),this[_0x3d877b(0x348)](),this[_0x3d877b(0x23d)](),this['setupBriefingScheduler']();}async[a0_0x2c53cb(0x280)](){const _0x3b4c51=a0_0x2c53cb;if(!this[_0x3b4c51(0x1d0)]['useWeather'])return'';let _0x966e8='';if(this[_0x3b4c51(0x1d0)][_0x3b4c51(0x1ca)])try{if(this[_0x3b4c51(0x1d0)]['weatherInstance']['includes'](_0x3b4c51(0x214))){const _0x2d0de7=await this[_0x3b4c51(0x253)](this[_0x3b4c51(0x1d0)]['weatherInstance']+'.Summary.Current');if(_0x2d0de7&&_0x2d0de7['val'])_0x966e8=_0x2d0de7[_0x3b4c51(0x270)];}else{if(this[_0x3b4c51(0x1d0)][_0x3b4c51(0x1ca)][_0x3b4c51(0x271)](_0x3b4c51(0x278))){const _0x14bf69=await this[_0x3b4c51(0x253)](this[_0x3b4c51(0x1d0)]['weatherInstance']+_0x3b4c51(0x304));if(_0x14bf69&&_0x14bf69[_0x3b4c51(0x270)])_0x966e8=_0x14bf69[_0x3b4c51(0x270)];}else{if(this['config']['weatherInstance'][_0x3b4c51(0x271)](_0x3b4c51(0x277))){const _0x34191b=await this[_0x3b4c51(0x253)](this[_0x3b4c51(0x1d0)][_0x3b4c51(0x1ca)]+_0x3b4c51(0x232));if(_0x34191b&&_0x34191b[_0x3b4c51(0x270)])_0x966e8=_0x34191b[_0x3b4c51(0x270)];}}}}catch(_0x57f9c8){}if(!_0x966e8){const _0x18020d=[_0x3b4c51(0x2e4),_0x3b4c51(0x204),_0x3b4c51(0x201),_0x3b4c51(0x2a1)];for(const _0x170cff of _0x18020d){try{const _0x488c1e=await this[_0x3b4c51(0x22c)](_0x170cff);if(_0x488c1e){if(_0x170cff[_0x3b4c51(0x271)](_0x3b4c51(0x214))){const _0x1135ed=await this[_0x3b4c51(0x253)](_0x170cff+_0x3b4c51(0x266));if(_0x1135ed){_0x966e8=_0x1135ed[_0x3b4c51(0x270)];break;}}}}catch(_0x3cacc5){}}}return _0x966e8?_0x3b4c51(0x1d1)+_0x966e8:_0x3b4c51(0x2ba);}async[a0_0x2c53cb(0x23f)](){const _0x5e687b=a0_0x2c53cb;if(!this[_0x5e687b(0x1d0)]['useCalendar'])return'';let _0x5de828='',_0x43b751=this[_0x5e687b(0x1d0)][_0x5e687b(0x2d5)]||_0x5e687b(0x2c1);try{const _0x107fde=await this['getForeignStateAsync'](_0x43b751+'.data.text');if(_0x107fde&&_0x107fde[_0x5e687b(0x270)])_0x5de828=_0x107fde[_0x5e687b(0x270)];else{const _0x2c53f6=await this['getForeignStateAsync'](_0x43b751+_0x5e687b(0x316));_0x2c53f6&&_0x2c53f6['val']&&Array[_0x5e687b(0x334)](_0x2c53f6['val'])&&_0x2c53f6[_0x5e687b(0x270)][_0x5e687b(0x1a8)]>0x0&&(_0x5de828=_0x2c53f6[_0x5e687b(0x270)]['slice'](0x0,0x3)['map'](_0x59322f=>_0x59322f[_0x5e687b(0x30f)]+'\x20'+_0x59322f[_0x5e687b(0x267)])[_0x5e687b(0x282)](',\x20'));}}catch(_0x249ece){}return _0x5de828?_0x5e687b(0x2bc)+_0x5de828:_0x5e687b(0x1b4);}async[a0_0x2c53cb(0x190)](_0x364f4b={}){const _0x3d2a43=a0_0x2c53cb;this['log']['info'](_0x3d2a43(0x1f3)+JSON[_0x3d2a43(0x203)](_0x364f4b));const _0x1fd926=[],_0x3f39a5=_0x364f4b[_0x3d2a43(0x2c3)]!==![],_0x32149f=_0x364f4b['doors']!==![],_0x4f5ee4=_0x364f4b[_0x3d2a43(0x217)]!==![],_0x5ba718=_0x364f4b[_0x3d2a43(0x2df)]===!![],_0x69e90f=_0x364f4b[_0x3d2a43(0x193)]===!![],_0x5c88f7=_0x364f4b[_0x3d2a43(0x2a0)]||[],_0x551d6a=await this[_0x3d2a43(0x307)](_0x3d2a43(0x235),'enum'),_0x366dc0=await this[_0x3d2a43(0x307)](_0x3d2a43(0x20a),_0x3d2a43(0x229)),_0x2ab7f3={},_0x202fd3={},_0x3797d5={},_0x2e43a0=(_0x394e5e,_0x1e3a86,_0x105770=![])=>{const _0x41b6c6=_0x3d2a43;if(!_0x394e5e)return;for(const _0x179470 in _0x394e5e){const _0xae00de=_0x394e5e[_0x179470];if(_0xae00de&&_0xae00de[_0x41b6c6(0x25f)]&&_0xae00de[_0x41b6c6(0x25f)][_0x41b6c6(0x2de)]){const _0x269fc4=(typeof _0xae00de[_0x41b6c6(0x25f)][_0x41b6c6(0x1f1)]===_0x41b6c6(0x291)?_0xae00de[_0x41b6c6(0x25f)][_0x41b6c6(0x1f1)]['de']:_0xae00de[_0x41b6c6(0x25f)][_0x41b6c6(0x1f1)])||_0xae00de[_0x41b6c6(0x25f)][_0x41b6c6(0x1f1)];if(_0x105770)_0x3797d5[_0x179470]=_0x269fc4;for(const _0x37060c of _0xae00de['common'][_0x41b6c6(0x2de)]){if(_0x105770){if(!_0x1e3a86[_0x37060c])_0x1e3a86[_0x37060c]=[];_0x1e3a86[_0x37060c][_0x41b6c6(0x175)](_0x179470);}else _0x1e3a86[_0x37060c]=_0x269fc4;}}}};_0x2e43a0(_0x551d6a,_0x2ab7f3),_0x2e43a0(_0x366dc0,_0x202fd3,!![]);const _0x5f2bdc=await this[_0x3d2a43(0x307)]('*','state'),_0x99f34c=[_0x3d2a43(0x2c0),_0x3d2a43(0x294),_0x3d2a43(0x2b8),'ERROR',_0x3d2a43(0x29b),_0x3d2a43(0x2c8),_0x3d2a43(0x2ef),'CONFIG_PENDING',_0x3d2a43(0x317),'WORKING',_0x3d2a43(0x2f2),_0x3d2a43(0x2f0),_0x3d2a43(0x315),_0x3d2a43(0x29a),_0x3d2a43(0x2b9),'COMBINED_PARAMETER',_0x3d2a43(0x181),_0x3d2a43(0x269),_0x3d2a43(0x324),'ERROR_CODE',_0x3d2a43(0x251),_0x3d2a43(0x1d5),_0x3d2a43(0x2f6),_0x3d2a43(0x2ca),_0x3d2a43(0x17e),_0x3d2a43(0x2a7),_0x3d2a43(0x320),_0x3d2a43(0x1f0),_0x3d2a43(0x2bb),_0x3d2a43(0x1c6),_0x3d2a43(0x1e0),_0x3d2a43(0x202),_0x3d2a43(0x310),_0x3d2a43(0x219),_0x3d2a43(0x2e5),'alert','mode','colormode','effect','xy','ct',_0x3d2a43(0x20d),_0x3d2a43(0x23c),_0x3d2a43(0x25c),_0x3d2a43(0x24f),'modelid',_0x3d2a43(0x292),_0x3d2a43(0x2c2),_0x3d2a43(0x1c0),'description',_0x3d2a43(0x33a),_0x3d2a43(0x2ad),_0x3d2a43(0x30c),_0x3d2a43(0x227),_0x3d2a43(0x31e),_0x3d2a43(0x2cd),_0x3d2a43(0x188),_0x3d2a43(0x2b1),_0x3d2a43(0x238),_0x3d2a43(0x333),'info',_0x3d2a43(0x24d)];if(!_0x69e90f)_0x99f34c[_0x3d2a43(0x175)](_0x3d2a43(0x1db),_0x3d2a43(0x193),'wind','pressure','uv',_0x3d2a43(0x263),'precip');const _0x24a065=[_0x3d2a43(0x1e4),_0x3d2a43(0x314),_0x3d2a43(0x18b),'vis.',_0x3d2a43(0x343),_0x3d2a43(0x24c),_0x3d2a43(0x231),_0x3d2a43(0x1de)];if(!_0x69e90f)_0x24a065['push'](_0x3d2a43(0x260),_0x3d2a43(0x22a),_0x3d2a43(0x258),_0x3d2a43(0x284),_0x3d2a43(0x31d));const _0x1cbe3f=(_0x7a6cd9,_0x17ed8a,_0x62f8e2=![])=>{const _0x2bd243=_0x3d2a43,_0x4aa759=_0x7a6cd9[_0x2bd243(0x19b)]('.');if(_0x17ed8a[_0x7a6cd9])return _0x17ed8a[_0x7a6cd9];if(_0x4aa759[_0x2bd243(0x1a8)]>0x2&&_0x17ed8a[_0x4aa759['slice'](0x0,-0x1)[_0x2bd243(0x282)]('.')])return _0x17ed8a[_0x4aa759[_0x2bd243(0x2c9)](0x0,-0x1)[_0x2bd243(0x282)]('.')];if(_0x4aa759['length']>0x3&&_0x17ed8a[_0x4aa759[_0x2bd243(0x2c9)](0x0,-0x2)['join']('.')])return _0x17ed8a[_0x4aa759[_0x2bd243(0x2c9)](0x0,-0x2)[_0x2bd243(0x282)]('.')];return _0x62f8e2?[]:null;};for(const _0x5c83d2 in _0x5f2bdc){const _0x2c04af=_0x5f2bdc[_0x5c83d2];if(!_0x2c04af||!_0x2c04af['common'])continue;if(_0x24a065[_0x3d2a43(0x25b)](_0x4ffc3d=>_0x5c83d2[_0x3d2a43(0x234)](_0x4ffc3d)))continue;const _0x239c9a=_0x2c04af['common']['role']||'',_0x2c2bd6=(_0x2c04af[_0x3d2a43(0x25f)][_0x3d2a43(0x1f1)]&&typeof _0x2c04af[_0x3d2a43(0x25f)]['name']===_0x3d2a43(0x291)?_0x2c04af[_0x3d2a43(0x25f)][_0x3d2a43(0x1f1)]['de']:_0x2c04af[_0x3d2a43(0x25f)][_0x3d2a43(0x1f1)])||'',_0x245054=_0x2c2bd6?_0x2c2bd6['toLowerCase']():'',_0x47aac8=_0x5c83d2['toLowerCase'](),_0x8efe24=_0x1cbe3f(_0x5c83d2,_0x2ab7f3),_0x54452d=_0x1cbe3f(_0x5c83d2,_0x202fd3,!![]);let _0x16ff49=null,_0x4c1683=![];if(_0x54452d&&_0x54452d[_0x3d2a43(0x1a8)]>0x0){const _0x10fc01=_0x54452d['find'](_0x55a85e=>_0x5c88f7['includes'](_0x55a85e));if(_0x10fc01){_0x4c1683=!![];const _0x2722c6=_0x3797d5[_0x10fc01];if(_0x47aac8['includes']('presence')||_0x47aac8[_0x3d2a43(0x271)](_0x3d2a43(0x2c3)))_0x16ff49=_0x3d2a43(0x2bf);else{if(_0x47aac8['includes'](_0x3d2a43(0x200))||_0x47aac8['includes'](_0x3d2a43(0x28d))||_0x245054[_0x3d2a43(0x271)](_0x3d2a43(0x2bd)))_0x16ff49='Rauchmelder';else{if(_0x47aac8[_0x3d2a43(0x271)]('state')||_0x47aac8[_0x3d2a43(0x271)](_0x3d2a43(0x17a))||_0x47aac8[_0x3d2a43(0x271)]('on'))_0x16ff49=_0x3d2a43(0x32d);else _0x16ff49=_0x2722c6;}}}}if(!_0x4c1683&&!_0x69e90f){if(_0x99f34c['some'](_0xd57609=>_0x245054[_0x3d2a43(0x271)](_0xd57609)||_0x5c83d2[_0x3d2a43(0x2c5)]()['includes'](_0xd57609)))continue;}if(!_0x16ff49&&_0x3f39a5){if(_0x239c9a[_0x3d2a43(0x271)]('sensor.motion')||_0x239c9a[_0x3d2a43(0x271)](_0x3d2a43(0x205))||_0x245054['includes'](_0x3d2a43(0x337))||_0x245054[_0x3d2a43(0x271)](_0x3d2a43(0x34b)))_0x16ff49=_0x3d2a43(0x2bf);}!_0x16ff49&&_0x32149f&&((_0x47aac8[_0x3d2a43(0x271)](_0x3d2a43(0x2f4))||_0x239c9a[_0x3d2a43(0x271)]('sensor.door')||_0x239c9a[_0x3d2a43(0x271)](_0x3d2a43(0x25d))||(_0x245054['includes'](_0x3d2a43(0x2b3))||_0x245054[_0x3d2a43(0x271)](_0x3d2a43(0x26e)))&&!_0x245054[_0x3d2a43(0x271)]('temp')&&!_0x245054[_0x3d2a43(0x271)]('griff')&&(_0x2c04af[_0x3d2a43(0x25f)]['type']===_0x3d2a43(0x2ce)||_0x2c04af[_0x3d2a43(0x25f)][_0x3d2a43(0x1a4)]==='number'))&&(_0x16ff49=_0x3d2a43(0x28f)));if(!_0x16ff49&&_0x4f5ee4){if((_0x239c9a['includes'](_0x3d2a43(0x290))||_0x239c9a[_0x3d2a43(0x271)]('level.dimmer')||_0x245054[_0x3d2a43(0x271)](_0x3d2a43(0x26f))||_0x245054[_0x3d2a43(0x271)](_0x3d2a43(0x322)))&&_0x2c04af[_0x3d2a43(0x25f)]['write'])_0x16ff49=_0x3d2a43(0x18a);}if(!_0x16ff49&&_0x5ba718){if(_0x239c9a[_0x3d2a43(0x271)](_0x3d2a43(0x20c))||_0x239c9a['includes'](_0x3d2a43(0x288))||_0x245054[_0x3d2a43(0x271)](_0x3d2a43(0x1be)))_0x16ff49=_0x3d2a43(0x2e7);}if(_0x16ff49){let _0x53020e=_0x8efe24||'';if(!_0x53020e){if(_0x245054[_0x3d2a43(0x271)]('bad'))_0x53020e=_0x3d2a43(0x2b4);else{if(_0x245054[_0x3d2a43(0x271)](_0x3d2a43(0x259)))_0x53020e=_0x3d2a43(0x2f9);else{if(_0x245054[_0x3d2a43(0x271)](_0x3d2a43(0x1fa)))_0x53020e=_0x3d2a43(0x17c);else{if(_0x245054[_0x3d2a43(0x271)](_0x3d2a43(0x184)))_0x53020e=_0x3d2a43(0x1e9);else{if(_0x245054[_0x3d2a43(0x271)]('flur')||_0x245054[_0x3d2a43(0x271)]('diele'))_0x53020e='Flur';else{if(_0x245054[_0x3d2a43(0x271)](_0x3d2a43(0x2e6)))_0x53020e=_0x3d2a43(0x29c);}}}}}}let _0x1c09a9=![];_0x16ff49===_0x3d2a43(0x28f)&&((_0x245054[_0x3d2a43(0x271)](_0x3d2a43(0x326))||_0x245054[_0x3d2a43(0x271)](_0x3d2a43(0x273))||_0x245054['includes'](_0x3d2a43(0x213))||_0x53020e&&_0x53020e[_0x3d2a43(0x182)]()['includes'](_0x3d2a43(0x22d))&&_0x245054['includes'](_0x3d2a43(0x26e)))&&(_0x1c09a9=!![]));let _0x16a9b9=0x0;if(_0x4c1683)_0x16a9b9+=0x1e;else{if(_0x8efe24)_0x16a9b9+=0x14;else{if(_0x53020e)_0x16a9b9+=0xa;}}if(_0x1c09a9)_0x16a9b9+=0x5;_0x1fd926[_0x3d2a43(0x175)]({'id':_0x5c83d2,'name':_0x2c2bd6||_0x5c83d2,'type':_0x16ff49,'location':_0x53020e,'logDuplicates':_0x16ff49==='Bewegung','isExit':_0x1c09a9,'_score':_0x16a9b9});}}return _0x1fd926[_0x3d2a43(0x19f)]((_0x399380,_0x217ecb)=>_0x217ecb['_score']-_0x399380[_0x3d2a43(0x1ab)]),_0x1fd926;}async[a0_0x2c53cb(0x28b)](){const _0x212ba2=a0_0x2c53cb,_0x5d7d7b=this[_0x212ba2(0x1d0)][_0x212ba2(0x1dc)]||[];let _0xc00b6e=![];for(const _0x17cfcc of _0x5d7d7b){try{const _0x2a1a6f=await this['getForeignStateAsync'](_0x17cfcc);if(_0x2a1a6f&&(_0x2a1a6f['val']===!![]||_0x2a1a6f[_0x212ba2(0x270)]==='online'||_0x2a1a6f[_0x212ba2(0x270)]===0x1)){_0xc00b6e=!![];break;}}catch(_0x1d22df){}}return _0xc00b6e&&(this['exitTimer']&&(this['log'][_0x212ba2(0x1e0)]('WiFi\x20Presence\x20detected\x20->\x20Aborting\x20Exit\x20Timer.\x20User\x20is\x20present.'),this[_0x212ba2(0x1ef)]()),!this['isPresent']&&this[_0x212ba2(0x2cb)]===SYSTEM_MODES[_0x212ba2(0x179)]&&this[_0x212ba2(0x336)](!![])),_0xc00b6e;}async[a0_0x2c53cb(0x195)](_0x3a6f64,_0x461315){const _0x149f52=a0_0x2c53cb;if(!_0x461315)return;if(_0x3a6f64===this[_0x149f52(0x26b)]+'.'+SYSTEM_DP_MODE){_0x461315[_0x149f52(0x270)]&&Object[_0x149f52(0x332)](SYSTEM_MODES)[_0x149f52(0x271)](_0x461315[_0x149f52(0x270)])&&(this[_0x149f52(0x2cb)]=_0x461315[_0x149f52(0x270)],_0x461315[_0x149f52(0x270)]===SYSTEM_MODES[_0x149f52(0x1c2)]?this[_0x149f52(0x336)](![]):this[_0x149f52(0x336)](!![]));if(!_0x461315['ack'])this['setState'](_0x3a6f64,{'val':this['currentSystemMode'],'ack':!![]});return;}if(!_0x461315[_0x149f52(0x1c5)]){_0x3a6f64[_0x149f52(0x271)]('analysis.trigger')&&_0x461315[_0x149f52(0x270)]&&(this['setState'](_0x3a6f64,{'val':![],'ack':!![]}),this[_0x149f52(0x309)]());if(_0x3a6f64[_0x149f52(0x271)]('triggerDailyDigest')&&_0x461315[_0x149f52(0x270)]){this[_0x149f52(0x222)](_0x3a6f64,{'val':![],'ack':!![]});if(this[_0x149f52(0x2c6)])this[_0x149f52(0x33f)]();}_0x3a6f64[_0x149f52(0x271)](_0x149f52(0x1ed))&&_0x461315['val']&&(this[_0x149f52(0x222)](_0x3a6f64,{'val':![],'ack':!![]}),this[_0x149f52(0x2e1)]());return;}if(this[_0x149f52(0x1d0)][_0x149f52(0x1dc)]&&this['config'][_0x149f52(0x1dc)][_0x149f52(0x271)](_0x3a6f64)){await this[_0x149f52(0x28b)]();return;}const _0x36cfd8=(this[_0x149f52(0x1d0)][_0x149f52(0x2f7)]||[])['find'](_0x52e02e=>_0x52e02e['id']===_0x3a6f64);if(_0x36cfd8)this[_0x149f52(0x319)](_0x3a6f64,_0x461315,_0x36cfd8);}async[a0_0x2c53cb(0x319)](_0x2a4121,_0x467863,_0x1a9b29){const _0x4adae7=a0_0x2c53cb;if(!_0x1a9b29[_0x4adae7(0x174)]&&this[_0x4adae7(0x1d2)][_0x2a4121]===_0x467863[_0x4adae7(0x270)])return;this[_0x4adae7(0x1d2)][_0x2a4121]=_0x467863[_0x4adae7(0x270)];if(this[_0x4adae7(0x28e)])return;const _0x628fa9=await this[_0x4adae7(0x28b)]();if(_0x628fa9){if(!this[_0x4adae7(0x28c)])this[_0x4adae7(0x336)](!![]);}else{const _0x4a3f2a=_0x1a9b29[_0x4adae7(0x2b5)]===!![];_0x4a3f2a?this['startExitTimer']():(this['exitTimer']&&(this['log']['info']('Bewegung\x20während\x20Exit-Timer\x20erkannt\x20->\x20Bewohner\x20ist\x20noch\x20da.'),this[_0x4adae7(0x1ef)]()),!this[_0x4adae7(0x28c)]&&this[_0x4adae7(0x2cb)]===SYSTEM_MODES[_0x4adae7(0x179)]&&this[_0x4adae7(0x336)](!![]));}const _0x26ccba={'timestamp':_0x467863['ts'],'id':_0x2a4121,'name':_0x1a9b29['name'],'value':_0x467863['val'],'location':_0x1a9b29[_0x4adae7(0x26d)],'type':_0x1a9b29[_0x4adae7(0x1a4)]};this['eventHistory'][_0x4adae7(0x1b5)](_0x26ccba);if(this[_0x4adae7(0x255)][_0x4adae7(0x1a8)]>HISTORY_MAX_SIZE)this[_0x4adae7(0x255)][_0x4adae7(0x33c)]();await this[_0x4adae7(0x2fd)]('events.lastEvent',{'val':JSON[_0x4adae7(0x203)](_0x26ccba),'ack':!![]}),await this['setStateAsync'](_0x4adae7(0x1fc),{'val':JSON[_0x4adae7(0x203)](this[_0x4adae7(0x255)]),'ack':!![]}),this[_0x4adae7(0x194)]['push']({'timestamp':new Date(_0x467863['ts'])[_0x4adae7(0x239)](),'sensorName':_0x1a9b29[_0x4adae7(0x1f1)],'location':_0x1a9b29['location'],'value':_0x467863[_0x4adae7(0x270)]}),await this[_0x4adae7(0x1a2)]();}[a0_0x2c53cb(0x218)](){const _0x2859ca=a0_0x2c53cb;this[_0x2859ca(0x1ef)](),this[_0x2859ca(0x28e)]=!![],this[_0x2859ca(0x34e)]=setTimeout(()=>{const _0x7e1ce9=_0x2859ca;this[_0x7e1ce9(0x28e)]=![];},EXIT_GRACE_PERIOD_SECONDS*0x3e8),this[_0x2859ca(0x1b1)]=setTimeout(()=>{const _0x361b55=_0x2859ca;this[_0x361b55(0x336)](![]),this[_0x361b55(0x1b1)]=null;},EXIT_TIMER_MINUTES*0x3c*0x3e8);}[a0_0x2c53cb(0x1ef)](){const _0x463e73=a0_0x2c53cb;if(this['exitTimer'])clearTimeout(this['exitTimer']);if(this[_0x463e73(0x34e)])clearTimeout(this[_0x463e73(0x34e)]);this[_0x463e73(0x1b1)]=null,this[_0x463e73(0x34e)]=null,this[_0x463e73(0x28e)]=![];}async[a0_0x2c53cb(0x336)](_0x232dcb){const _0x32f367=a0_0x2c53cb;if(this[_0x32f367(0x28c)]===_0x232dcb)return;this[_0x32f367(0x28c)]=_0x232dcb,await this[_0x32f367(0x2fd)](_0x32f367(0x1b6),{'val':_0x232dcb,'ack':!![]});}[a0_0x2c53cb(0x330)](){const _0x43d918=a0_0x2c53cb,_0x5100a3=this[_0x43d918(0x1d0)][_0x43d918(0x1b3)],_0x46036f=this[_0x43d918(0x1d0)][_0x43d918(0x33d)],_0x446331=this[_0x43d918(0x255)][_0x43d918(0x1a8)]>0x0?this[_0x43d918(0x255)][0x0][_0x43d918(0x329)]:Date[_0x43d918(0x243)](),_0x4703d3=(Date[_0x43d918(0x243)]()-_0x446331)/(0x3e8*0x3c*0x3c);let _0x8995f3='';_0x46036f&&this[_0x43d918(0x2cb)]===SYSTEM_MODES[_0x43d918(0x179)]&&this['isPresent']&&(_0x4703d3>_0x5100a3&&(_0x8995f3=_0x43d918(0x287)+_0x4703d3['toFixed'](0x1)+_0x43d918(0x2a4)));if(_0x8995f3){this[_0x43d918(0x309)](_0x8995f3)[_0x43d918(0x19e)](_0x10af39=>this[_0x43d918(0x2e8)][_0x43d918(0x23b)](_0x10af39));return;}const _0x34f303=Date[_0x43d918(0x243)](),_0x3d1731=_0x34f303-_0x446331,_0x591779=(this[_0x43d918(0x1d0)][_0x43d918(0x207)]||0xf)*0x3c*0x3e8;this[_0x43d918(0x255)][_0x43d918(0x1a8)]>0x0&&_0x3d1731<=_0x591779?this[_0x43d918(0x309)]()['catch'](_0x30655f=>this[_0x43d918(0x2e8)][_0x43d918(0x23b)](_0x30655f)):!this[_0x43d918(0x1e7)]&&(this['setState'](_0x43d918(0x1fe),{'val':![],'ack':!![]}),this[_0x43d918(0x222)]('analysis.isEmergency',{'val':![],'ack':!![]}));}async[a0_0x2c53cb(0x309)](_0x5710cf=''){const _0x27e94c=a0_0x2c53cb;if(!this['geminiModel'])return;const _0x473eb7=this['eventHistory'][_0x27e94c(0x1a8)]>0x0?this[_0x27e94c(0x255)]:[{'note':_0x27e94c(0x178)}],_0x2177b7=PERSONA_MAPPING[this[_0x27e94c(0x1d0)][_0x27e94c(0x21b)]||_0x27e94c(0x1e2)],_0x4d1f81=this[_0x27e94c(0x1d0)][_0x27e94c(0x32a)]||'',_0x2e36cc=this[_0x27e94c(0x2cb)],_0x1a67ac=await this[_0x27e94c(0x280)](),_0xb5c486=await this[_0x27e94c(0x23f)](),_0x5a3177=(_0x1a67ac+'\x20'+_0xb5c486)[_0x27e94c(0x1ce)](),_0xc5634b=new Date(),_0x5917c7=_0xc5634b[_0x27e94c(0x331)]('de-DE',{'weekday':_0x27e94c(0x1e5),'hour':_0x27e94c(0x328),'minute':_0x27e94c(0x328)}),_0x46f2f7=this['systemConfig'];let _0x1f2fe4='';if(this[_0x27e94c(0x248)][_0x27e94c(0x1a8)]>0x0){const _0xde9721=this[_0x27e94c(0x248)][_0x27e94c(0x2c9)](0x0,0x3)['map'](_0x468316=>_0x27e94c(0x275)+_0x468316[_0x27e94c(0x27c)]+_0x27e94c(0x1fb)+_0x468316[_0x27e94c(0x2d2)]+'.')[_0x27e94c(0x282)]('\x0a');_0x1f2fe4=_0x27e94c(0x31b)+_0xde9721+'\x0a';}const _0x3e0d9b=_0x5710cf?_0x27e94c(0x20b)+_0x5710cf+_0x27e94c(0x225):'',_0x51a852=_0x27e94c(0x293),_0x5bddba=_0x27e94c(0x2c7)+_0x5917c7+_0x27e94c(0x191)+_0x46f2f7[_0x27e94c(0x228)]+_0x27e94c(0x1dd)+_0x2e36cc+'.\x20PRÄSENZ:\x20'+(this[_0x27e94c(0x28c)]?'Ja':_0x27e94c(0x170))+'.\x20\x0a\x20\x20\x20\x20\x20\x20\x20\x20KONTEXT\x20(Wohnen):\x20'+_0x4d1f81+_0x27e94c(0x1d4)+_0x2177b7+_0x27e94c(0x346)+_0x5a3177+_0x27e94c(0x2d6)+_0x51a852+'\x20'+_0x1f2fe4+'\x20'+_0x3e0d9b+'\x0a\x20\x20\x20\x20\x20\x20\x20\x20EVENTS:\x20'+JSON[_0x27e94c(0x203)](_0x473eb7)+'\x20\x0a\x20\x20\x20\x20\x20\x20\x20\x20AUFGABE:\x20Analysiere\x20die\x20Events\x20auf\x20Aktivität,\x20Komfort\x20und\x20GESUNDHEIT.\x20\x0a\x20\x20\x20\x20\x20\x20\x20\x20Nutze\x20den\x20EXTERNEN\x20KONTEXT\x20(Wetter/Kalender)\x20um\x20Fehlalarme\x20zu\x20vermeiden\x20(z.B.\x20Regen\x20=\x20keine\x20Gartenaktivität,\x20Termin\x20=\x20Abwesend).\x0a\x20\x20\x20\x20\x20\x20\x20\x20SCHEMA:\x20{\x20\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x22activity\x22:\x20{\x20\x22summary\x22:\x20\x22string\x22,\x20\x22deviationFromBaseline\x22:\x20\x22string\x22,\x20\x22isAlert\x22:\x20bool,\x20\x22isEmergency\x22:\x20bool,\x20\x22alertReason\x22:\x20\x22string\x22\x20},\x20\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x22comfort\x22:\x20{\x20\x22summary\x22:\x20\x22string\x22,\x20\x22suggestion\x22:\x20\x22string\x22,\x20\x22automationProposal\x22:\x20{\x20\x22patternDetected\x22:\x20bool,\x20\x22description\x22:\x20\x22string\x22,\x20\x22suggestedAction\x22:\x20\x22string\x22\x20}\x20},\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x22health\x22:\x20{\x20\x22sleepScore\x22:\x20number\x20(0-100),\x20\x22restlessness\x22:\x20\x22none|low|medium|high\x22,\x20\x22notes\x22:\x20\x22string\x22\x20}\x20\x0a\x20\x20\x20\x20\x20\x20\x20\x20}';try{const _0x156138=await this[_0x27e94c(0x198)]['generateContent'](_0x5bddba),_0x3d1278=_0x156138[_0x27e94c(0x249)][_0x27e94c(0x1d3)]()[_0x27e94c(0x185)](/```json|```/g,'')[_0x27e94c(0x1ce)](),_0x23a7c6=JSON[_0x27e94c(0x22f)](_0x3d1278);await this[_0x27e94c(0x2fd)](_0x27e94c(0x199),{'val':_0x3d1278,'ack':!![]}),await this['setStateAsync']('analysis.alertReason',{'val':_0x23a7c6['activity']['alertReason']||'','ack':!![]}),await this[_0x27e94c(0x2fd)]('analysis.activitySummary',{'val':_0x23a7c6[_0x27e94c(0x1e3)][_0x27e94c(0x188)]||'N/A','ack':!![]}),await this[_0x27e94c(0x2fd)](_0x27e94c(0x2ea),{'val':_0x23a7c6[_0x27e94c(0x1e3)]['deviationFromBaseline']||'N/A','ack':!![]});_0x23a7c6['comfort']&&(await this[_0x27e94c(0x2fd)](_0x27e94c(0x285),{'val':_0x23a7c6['comfort'][_0x27e94c(0x188)]||'','ack':!![]}),await this[_0x27e94c(0x2fd)](_0x27e94c(0x230),{'val':_0x23a7c6[_0x27e94c(0x303)][_0x27e94c(0x27f)]||'','ack':!![]}),_0x23a7c6[_0x27e94c(0x303)][_0x27e94c(0x339)]&&(await this['setStateAsync'](_0x27e94c(0x242),{'val':_0x23a7c6[_0x27e94c(0x303)]['automationProposal'][_0x27e94c(0x295)]||![],'ack':!![]}),await this[_0x27e94c(0x2fd)]('analysis.automation.description',{'val':_0x23a7c6['comfort'][_0x27e94c(0x339)][_0x27e94c(0x311)]||'','ack':!![]}),await this[_0x27e94c(0x2fd)](_0x27e94c(0x2a5),{'val':_0x23a7c6[_0x27e94c(0x303)]['automationProposal'][_0x27e94c(0x2d0)]||'','ack':!![]})));_0x23a7c6[_0x27e94c(0x245)]&&(await this[_0x27e94c(0x2fd)](_0x27e94c(0x256),{'val':typeof _0x23a7c6['health'][_0x27e94c(0x252)]==='number'?_0x23a7c6[_0x27e94c(0x245)][_0x27e94c(0x252)]:0x0,'ack':!![]}),await this[_0x27e94c(0x2fd)](_0x27e94c(0x1d8),{'val':_0x23a7c6[_0x27e94c(0x245)]['restlessness']||_0x27e94c(0x244),'ack':!![]}),await this[_0x27e94c(0x2fd)]('analysis.health.notes',{'val':_0x23a7c6[_0x27e94c(0x245)][_0x27e94c(0x306)]||'','ack':!![]}));const _0x2e91ae=_0x23a7c6[_0x27e94c(0x1e3)]['isAlert']||![],_0x5282a1=_0x23a7c6[_0x27e94c(0x1e3)][_0x27e94c(0x1e1)]||![];if(_0x2e91ae||_0x5282a1){await this[_0x27e94c(0x2fd)](_0x27e94c(0x1fe),{'val':!![],'ack':!![]}),await this[_0x27e94c(0x2fd)](_0x27e94c(0x22e),{'val':_0x5282a1,'ack':!![]});if(!this[_0x27e94c(0x1e7)]||_0x5282a1){const _0x589ae4=_0x5282a1?_0x27e94c(0x1f8):_0x27e94c(0x349);this[_0x27e94c(0x335)](_0x589ae4+':\x20'+_0x23a7c6['activity']['alertReason'],![],_0x5282a1);}}else await this[_0x27e94c(0x2fd)]('analysis.isAlert',{'val':![],'ack':!![]}),await this[_0x27e94c(0x2fd)]('analysis.isEmergency',{'val':![],'ack':!![]});this['lastAlertState']=_0x2e91ae||_0x5282a1;const _0x5b2723={'timestamp':Date[_0x27e94c(0x243)](),'id':Date[_0x27e94c(0x243)]()[_0x27e94c(0x24e)](),'analysis':_0x23a7c6,'systemMode':_0x2e36cc,'isPro':this['isProVersion']};this[_0x27e94c(0x192)](_0x5b2723);}catch(_0x59fb62){this[_0x27e94c(0x2e8)][_0x27e94c(0x23b)](_0x27e94c(0x301)+_0x59fb62['message']);}}async[a0_0x2c53cb(0x33f)](){const _0x1b9837=a0_0x2c53cb;if(!this[_0x1b9837(0x198)]||this[_0x1b9837(0x194)]['length']<LTM_MIN_EVENTS_FOR_COMPRESSION){await this[_0x1b9837(0x2fd)](LTM_DP_STATUS,{'val':_0x1b9837(0x19a),'ack':!![]});return;}this[_0x1b9837(0x2e8)][_0x1b9837(0x1e0)](_0x1b9837(0x300)+this[_0x1b9837(0x194)][_0x1b9837(0x1a8)]+'\x20raw\x20events...'),await this[_0x1b9837(0x2fd)](LTM_DP_STATUS,{'val':_0x1b9837(0x1a6),'ack':!![]});const _0x31d9c0=this[_0x1b9837(0x194)][_0x1b9837(0x1a8)]>0x320?this[_0x1b9837(0x194)]['slice'](this['rawEventLog'][_0x1b9837(0x1a8)]-0x320):this['rawEventLog'],_0xbe5c0c=PERSONA_MAPPING[this[_0x1b9837(0x1d0)][_0x1b9837(0x21b)]||_0x1b9837(0x1e2)],_0x941ef4=_0x1b9837(0x20f)+_0xbe5c0c+_0x1b9837(0x247)+JSON[_0x1b9837(0x203)](_0x31d9c0)+_0x1b9837(0x1d7);try{const _0x488331=await this[_0x1b9837(0x198)]['generateContent'](_0x941ef4),_0x59ae6b=_0x488331[_0x1b9837(0x249)][_0x1b9837(0x1d3)]()[_0x1b9837(0x185)](/```json|```/g,'')[_0x1b9837(0x1ce)](),_0x11aa9d=JSON[_0x1b9837(0x22f)](_0x59ae6b),_0x4cb620={'timestamp':new Date()[_0x1b9837(0x239)](),'eventCount':this[_0x1b9837(0x194)]['length'],'summary':_0x11aa9d[_0x1b9837(0x188)],'activityLevel':_0x11aa9d['activityLevel'],'health':{'sleepScore':_0x11aa9d[_0x1b9837(0x245)]?_0x11aa9d[_0x1b9837(0x245)]['sleepScore']:0x0,'restlessness':_0x11aa9d['health']?_0x11aa9d[_0x1b9837(0x245)][_0x1b9837(0x1a7)]:'none'},'systemMode':this[_0x1b9837(0x2cb)]};this[_0x1b9837(0x323)]['push'](_0x4cb620),await this[_0x1b9837(0x1c7)](),this['rawEventLog']=[],await this[_0x1b9837(0x1a2)](),await this['setStateAsync'](LTM_DP_STATUS,{'val':_0x1b9837(0x1f7),'ack':!![]}),this['log']['info'](_0x1b9837(0x2ff));}catch(_0x4a576a){this['log'][_0x1b9837(0x23b)]('Daily\x20Digest\x20Error:\x20'+_0x4a576a[_0x1b9837(0x33e)]),await this[_0x1b9837(0x2fd)](LTM_DP_STATUS,{'val':_0x1b9837(0x29f)+_0x4a576a[_0x1b9837(0x33e)],'ack':!![]});}}[a0_0x2c53cb(0x342)](){const _0x2e441f=a0_0x2c53cb;if(this[_0x2e441f(0x257)])this[_0x2e441f(0x257)][_0x2e441f(0x1e8)]();if(!this[_0x2e441f(0x1d0)][_0x2e441f(0x2d3)])return;const _0x21c4a9=(this[_0x2e441f(0x1d0)]['briefingTime']||'08:00')[_0x2e441f(0x19b)](':'),_0x6907a1=parseInt(_0x21c4a9[0x0])||0x8,_0xfe9d43=parseInt(_0x21c4a9[0x1])||0x0,_0x5d3155=_0xfe9d43+'\x20'+_0x6907a1+_0x2e441f(0x1f4);this['log']['info'](_0x2e441f(0x2f8)+_0x6907a1+':'+(_0xfe9d43<0xa?'0'+_0xfe9d43:_0xfe9d43)),this['briefingJob']=schedule[_0x2e441f(0x1da)](_0x5d3155,()=>{this['sendMorningBriefing']();});}async[a0_0x2c53cb(0x2e1)](){const _0x5d8ba6=a0_0x2c53cb;if(!this['geminiModel'])return;this[_0x5d8ba6(0x2e8)]['info'](_0x5d8ba6(0x2da));const _0xc0af33=this[_0x5d8ba6(0x323)][_0x5d8ba6(0x1a8)]>0x0?this[_0x5d8ba6(0x323)][this['dailyDigests'][_0x5d8ba6(0x1a8)]-0x1]:null,_0x15db67=_0xc0af33&&_0xc0af33[_0x5d8ba6(0x245)]?_0xc0af33[_0x5d8ba6(0x245)][_0x5d8ba6(0x252)]:_0x5d8ba6(0x1ea),_0x193b35=new Date();_0x193b35['setHours'](0x4,0x0,0x0,0x0);const _0x28173d=this[_0x5d8ba6(0x255)]['filter'](_0x57a58c=>new Date(_0x57a58c[_0x5d8ba6(0x329)])>_0x193b35),_0x43680d=PERSONA_MAPPING[this[_0x5d8ba6(0x1d0)][_0x5d8ba6(0x21b)]||_0x5d8ba6(0x1e2)],_0x4c1f24=this['config']['livingContext']||'',_0x3c505d=await this['getWeatherContext'](),_0x4e3e59=await this[_0x5d8ba6(0x23f)](),_0x5d72ae=_0x5d8ba6(0x171)+_0x43680d+_0x5d8ba6(0x1f5)+_0x4c1f24+'\x0a\x20\x20\x20\x20\x20\x20\x20\x20ZUSATZ-KONTEXT:\x20'+_0x3c505d+'\x20'+_0x4e3e59+_0x5d8ba6(0x23a)+_0x15db67+'/100\x0a\x20\x20\x20\x20\x20\x20\x20\x20-\x20Aktivität\x20seit\x2004:00\x20Uhr:\x20'+JSON[_0x5d8ba6(0x203)](_0x28173d[_0x5d8ba6(0x2c9)](0x0,0xa))+_0x5d8ba6(0x345);try{const _0x47ace0=await this[_0x5d8ba6(0x198)][_0x5d8ba6(0x30b)](_0x5d72ae),_0xe081a=_0x5d8ba6(0x32e)+_0x47ace0[_0x5d8ba6(0x249)][_0x5d8ba6(0x1d3)]()[_0x5d8ba6(0x1ce)]();this[_0x5d8ba6(0x335)](_0xe081a),this[_0x5d8ba6(0x2e8)][_0x5d8ba6(0x1e0)](_0x5d8ba6(0x1df));}catch(_0x5a19cd){this[_0x5d8ba6(0x2e8)][_0x5d8ba6(0x23b)](_0x5d8ba6(0x2d7)+_0x5a19cd[_0x5d8ba6(0x33e)]);}}async[a0_0x2c53cb(0x2fe)](){const _0x12a068=a0_0x2c53cb;try{const _0x1b238b=await this[_0x12a068(0x2ee)](_0x12a068(0x1fc));_0x1b238b&&_0x1b238b[_0x12a068(0x270)]&&(this['eventHistory']=JSON[_0x12a068(0x22f)](_0x1b238b[_0x12a068(0x270)]['toString']()));}catch(_0x16f094){this['eventHistory']=[];}try{const _0x48a6fd=await this['getStateAsync'](_0x12a068(0x210));if(_0x48a6fd&&_0x48a6fd['val'])this[_0x12a068(0x233)]=JSON[_0x12a068(0x22f)](_0x48a6fd[_0x12a068(0x270)][_0x12a068(0x24e)]());}catch(_0x5aea35){this[_0x12a068(0x233)]=[];}}async[a0_0x2c53cb(0x2fa)](){const _0xc7776e=a0_0x2c53cb;await this[_0xc7776e(0x18c)](),await this[_0xc7776e(0x17f)](_0xc7776e(0x1b6),{'type':_0xc7776e(0x1cc),'common':{'name':_0xc7776e(0x2d8),'type':'boolean','role':_0xc7776e(0x34d),'read':!![],'write':![],'def':!![]},'native':{}}),await this['setObjectNotExistsAsync'](_0xc7776e(0x196),{'type':'state','common':{'name':_0xc7776e(0x1a0),'type':_0xc7776e(0x1cd),'role':_0xc7776e(0x24d),'read':!![],'write':![]},'native':{}}),await this[_0xc7776e(0x17f)](_0xc7776e(0x1fc),{'type':'state','common':{'name':_0xc7776e(0x2eb),'type':'string','role':_0xc7776e(0x24d),'read':!![],'write':![]},'native':{}}),await this[_0xc7776e(0x17f)](_0xc7776e(0x1cb),{'type':'state','common':{'name':'Trigger\x20Analysis','type':_0xc7776e(0x2ce),'role':_0xc7776e(0x1c3),'read':!![],'write':!![],'def':![]},'native':{}}),await this[_0xc7776e(0x17f)](_0xc7776e(0x1cf),{'type':_0xc7776e(0x1cc),'common':{'name':_0xc7776e(0x19d),'type':'boolean','role':_0xc7776e(0x1c3),'read':!![],'write':!![],'def':![]},'native':{}}),await this['setObjectNotExistsAsync']('analysis.lastResult',{'type':_0xc7776e(0x1cc),'common':{'name':_0xc7776e(0x1ac),'type':_0xc7776e(0x1cd),'role':_0xc7776e(0x24d),'read':!![],'write':![]},'native':{}}),await this['setObjectNotExistsAsync']('analysis.isAlert',{'type':_0xc7776e(0x1cc),'common':{'name':_0xc7776e(0x1bb),'type':'boolean','role':_0xc7776e(0x236),'read':!![],'write':![],'def':![]},'native':{}}),await this['setObjectNotExistsAsync']('analysis.isEmergency',{'type':_0xc7776e(0x1cc),'common':{'name':_0xc7776e(0x325),'type':_0xc7776e(0x2ce),'role':_0xc7776e(0x1fd),'read':!![],'write':![],'def':![]},'native':{}}),await this[_0xc7776e(0x17f)]('analysis.alertReason',{'type':_0xc7776e(0x1cc),'common':{'name':_0xc7776e(0x21d),'type':'string','role':_0xc7776e(0x30d),'read':!![],'write':![]},'native':{}}),await this[_0xc7776e(0x17f)](_0xc7776e(0x32b),{'type':_0xc7776e(0x1cc),'common':{'name':'Activity\x20Summary','type':_0xc7776e(0x1cd),'role':'text','read':!![],'write':![]},'native':{}}),await this['setObjectNotExistsAsync'](_0xc7776e(0x2ea),{'type':_0xc7776e(0x1cc),'common':{'name':'Deviation','type':'string','role':_0xc7776e(0x1cc),'read':!![],'write':![],'def':_0xc7776e(0x1ea)},'native':{}}),await this[_0xc7776e(0x17f)]('analysis.comfortSummary',{'type':_0xc7776e(0x1cc),'common':{'name':_0xc7776e(0x264),'type':_0xc7776e(0x1cd),'role':_0xc7776e(0x1d3),'read':!![],'write':![]},'native':{}}),await this['setObjectNotExistsAsync'](_0xc7776e(0x230),{'type':_0xc7776e(0x1cc),'common':{'name':'Comfort\x20Suggestion','type':_0xc7776e(0x1cd),'role':'text','read':!![],'write':![]},'native':{}}),await this[_0xc7776e(0x183)]('analysis.automation',{'type':_0xc7776e(0x2cf),'common':{'name':_0xc7776e(0x2ac)},'native':{}}),await this[_0xc7776e(0x17f)]('analysis.automation.patternDetected',{'type':_0xc7776e(0x1cc),'common':{'name':_0xc7776e(0x172),'type':'boolean','role':_0xc7776e(0x34d),'read':!![],'write':![],'def':![]},'native':{}}),await this[_0xc7776e(0x17f)](_0xc7776e(0x2f3),{'type':_0xc7776e(0x1cc),'common':{'name':_0xc7776e(0x265),'type':_0xc7776e(0x1cd),'role':_0xc7776e(0x1d3),'read':!![],'write':![]},'native':{}}),await this[_0xc7776e(0x17f)](_0xc7776e(0x2a5),{'type':'state','common':{'name':_0xc7776e(0x22b),'type':_0xc7776e(0x1cd),'role':'text','read':!![],'write':![]},'native':{}}),await this[_0xc7776e(0x17f)](_0xc7776e(0x210),{'type':_0xc7776e(0x1cc),'common':{'name':_0xc7776e(0x274),'type':_0xc7776e(0x1cd),'role':_0xc7776e(0x24d),'read':!![],'write':![],'def':'[]'},'native':{}}),await this[_0xc7776e(0x17f)](_0xc7776e(0x173),{'type':_0xc7776e(0x1cc),'common':{'name':'Feedback\x20Log','type':'string','role':'json','read':!![],'write':![],'def':'[]'},'native':{}}),await this[_0xc7776e(0x183)]('analysis.health',{'type':_0xc7776e(0x2cf),'common':{'name':_0xc7776e(0x21e)},'native':{}}),await this[_0xc7776e(0x17f)]('analysis.health.sleepScore',{'type':_0xc7776e(0x1cc),'common':{'name':_0xc7776e(0x18e),'type':_0xc7776e(0x2e0),'role':'value.health','read':!![],'write':![],'def':0x0},'native':{}}),await this[_0xc7776e(0x17f)]('analysis.health.restlessness',{'type':_0xc7776e(0x1cc),'common':{'name':'Restlessness\x20Level','type':_0xc7776e(0x1cd),'role':'text','read':!![],'write':![],'def':_0xc7776e(0x244)},'native':{}}),await this[_0xc7776e(0x17f)](_0xc7776e(0x208),{'type':_0xc7776e(0x1cc),'common':{'name':'Health\x20Notes','type':_0xc7776e(0x1cd),'role':_0xc7776e(0x1d3),'read':!![],'write':![],'def':''},'native':{}}),await this[_0xc7776e(0x215)](),await this[_0xc7776e(0x29e)]();}async['checkSystemObjects'](){const _0x2d34d4=a0_0x2c53cb;await this['extendObjectAsync'](_0x2d34d4(0x283),{'type':_0x2d34d4(0x2cf),'common':{'name':_0x2d34d4(0x1b8)},'native':{}}),await this[_0x2d34d4(0x183)](SYSTEM_DP_MODE,{'type':'state','common':{'name':'System\x20Mode','type':_0x2d34d4(0x1cd),'role':_0x2d34d4(0x1cc),'read':!![],'write':!![],'def':SYSTEM_MODES[_0x2d34d4(0x179)],'states':{[SYSTEM_MODES[_0x2d34d4(0x179)]]:_0x2d34d4(0x1aa),[SYSTEM_MODES[_0x2d34d4(0x1c2)]]:_0x2d34d4(0x2ab),[SYSTEM_MODES[_0x2d34d4(0x308)]]:'Party',[SYSTEM_MODES['GUEST']]:_0x2d34d4(0x286)}},'native':{}});}async[a0_0x2c53cb(0x335)](_0x1b6f6f,_0x23d0bc=![],_0x4797a1=![]){const _0x95afd1=a0_0x2c53cb;this['log'][_0x95afd1(0x1e0)]((_0x23d0bc?_0x95afd1(0x296):'')+_0x95afd1(0x1a5)+_0x1b6f6f+'\x22'+(_0x4797a1?_0x95afd1(0x289):''));const _0x221bc6=this['config'];let _0xd9e338=0x0;_0x221bc6[_0x95afd1(0x1eb)]&&_0x221bc6[_0x95afd1(0x223)]&&(await this[_0x95afd1(0x16f)](_0x221bc6[_0x95afd1(0x223)],_0x95afd1(0x209),{'text':_0x1b6f6f,'user':_0x221bc6[_0x95afd1(0x34a)]}),_0xd9e338++);if(_0x221bc6[_0x95afd1(0x327)]&&_0x221bc6[_0x95afd1(0x297)]){let _0x300231={'message':_0x1b6f6f,'title':_0x4797a1?_0x95afd1(0x29d):_0x95afd1(0x31c),'priority':_0x4797a1?0x2:0x1,'device':_0x221bc6['notifyPushoverRecipient']};_0x4797a1&&(_0x300231[_0x95afd1(0x26a)]=0x1e,_0x300231[_0x95afd1(0x177)]=0xe10,_0x300231[_0x95afd1(0x344)]='siren'),await this[_0x95afd1(0x16f)](_0x221bc6[_0x95afd1(0x297)],_0x95afd1(0x209),_0x300231),_0xd9e338++;}return _0x221bc6['notifyEmailEnabled']&&_0x221bc6[_0x95afd1(0x19c)]&&(await this['sendToAsync'](_0x221bc6[_0x95afd1(0x19c)],'send',{'text':_0x1b6f6f,'to':_0x221bc6[_0x95afd1(0x2ae)]}),_0xd9e338++),_0x221bc6[_0x95afd1(0x254)]&&_0x221bc6[_0x95afd1(0x1f9)]&&(await this[_0x95afd1(0x16f)](_0x221bc6[_0x95afd1(0x1f9)],_0x95afd1(0x209),{'text':_0x1b6f6f,'phone':_0x221bc6[_0x95afd1(0x2f5)]}),_0xd9e338++),_0x221bc6[_0x95afd1(0x298)]&&_0x221bc6[_0x95afd1(0x21f)]&&(await this[_0x95afd1(0x16f)](_0x221bc6['notifySignalInstance'],_0x95afd1(0x209),{'text':_0x1b6f6f,'phone':_0x221bc6[_0x95afd1(0x25e)]}),_0xd9e338++),_0xd9e338;}async[a0_0x2c53cb(0x224)](){const _0x568ac3=a0_0x2c53cb;try{const _0x1be2c2=await this[_0x568ac3(0x2ee)](LTM_DP_RAW_LOG);if(_0x1be2c2&&_0x1be2c2[_0x568ac3(0x270)])this[_0x568ac3(0x194)]=JSON['parse'](_0x1be2c2[_0x568ac3(0x270)]);}catch(_0x39a9c7){this['rawEventLog']=[];}}async[a0_0x2c53cb(0x1a2)](){const _0x3a3d1a=a0_0x2c53cb;this[_0x3a3d1a(0x194)][_0x3a3d1a(0x1a8)]>RAW_LOG_MAX_SIZE&&this[_0x3a3d1a(0x194)][_0x3a3d1a(0x27e)](0x0,this[_0x3a3d1a(0x194)][_0x3a3d1a(0x1a8)]-RAW_LOG_MAX_SIZE),await this['setStateAsync'](LTM_DP_RAW_LOG,{'val':JSON[_0x3a3d1a(0x203)](this[_0x3a3d1a(0x194)]),'ack':!![]});}async[a0_0x2c53cb(0x23e)](){const _0x8ee75c=a0_0x2c53cb;try{const _0x581227=await this[_0x8ee75c(0x2ee)](LTM_DP_DAILY_DIGESTS);if(_0x581227&&_0x581227[_0x8ee75c(0x270)])this['dailyDigests']=JSON['parse'](_0x581227['val']);}catch(_0x56ff97){this[_0x8ee75c(0x323)]=[];}await this[_0x8ee75c(0x340)]();}async[a0_0x2c53cb(0x1c7)](_0x57a8ae=!![]){const _0x1f2213=a0_0x2c53cb,_0x35a2b0=this[_0x1f2213(0x1d0)][_0x1f2213(0x34c)]||0x3c;this[_0x1f2213(0x323)][_0x1f2213(0x1a8)]>_0x35a2b0&&this[_0x1f2213(0x323)][_0x1f2213(0x27e)](0x0,this[_0x1f2213(0x323)][_0x1f2213(0x1a8)]-_0x35a2b0);await this[_0x1f2213(0x2fd)](LTM_DP_DAILY_DIGESTS,{'val':JSON[_0x1f2213(0x203)](this[_0x1f2213(0x323)]),'ack':!![]});if(_0x57a8ae)await this['updateBaselineStatus']();}['setupLtmScheduler'](){const _0x4f52f4=a0_0x2c53cb;if(this[_0x4f52f4(0x2af)])this['ltmJob'][_0x4f52f4(0x1e8)]();if(!this[_0x4f52f4(0x2c6)]){this[_0x4f52f4(0x2fd)](LTM_DP_STATUS,{'val':_0x4f52f4(0x250),'ack':!![]});return;}this[_0x4f52f4(0x2af)]=schedule['scheduleJob'](LTM_SCHEDULE,()=>this[_0x4f52f4(0x33f)]());}[a0_0x2c53cb(0x23d)](){const _0x1460c6=a0_0x2c53cb;if(this[_0x1460c6(0x31a)])clearInterval(this[_0x1460c6(0x31a)]);if(!this[_0x1460c6(0x2c6)])return;this[_0x1460c6(0x31a)]=setInterval(()=>this[_0x1460c6(0x261)](),(this[_0x1460c6(0x1d0)][_0x1460c6(0x2db)]||0x18)*0x36ee80),setTimeout(()=>this[_0x1460c6(0x261)](),0x1388);}async[a0_0x2c53cb(0x215)](){const _0x1e7f02=a0_0x2c53cb;await this[_0x1e7f02(0x183)](_0x1e7f02(0x33b),{'type':_0x1e7f02(0x2cf),'common':{'name':'LTM'},'native':{}}),await this[_0x1e7f02(0x183)](LTM_DP_RAW_LOG,{'type':'state','common':{'name':_0x1e7f02(0x34f),'type':_0x1e7f02(0x1cd),'role':_0x1e7f02(0x24d),'read':!![],'write':![]},'native':{}}),await this[_0x1e7f02(0x183)](LTM_DP_DAILY_DIGESTS,{'type':_0x1e7f02(0x1cc),'common':{'name':_0x1e7f02(0x318),'type':_0x1e7f02(0x1cd),'role':_0x1e7f02(0x24d),'read':!![],'write':![]},'native':{}}),await this[_0x1e7f02(0x183)](LTM_DP_STATUS,{'type':_0x1e7f02(0x1cc),'common':{'name':_0x1e7f02(0x17d),'type':_0x1e7f02(0x1cd),'role':_0x1e7f02(0x1d3),'read':!![],'write':![]},'native':{}}),await this['extendObjectAsync'](LTM_DP_TRIGGER_DIGEST,{'type':'state','common':{'name':'Trigger\x20Digest','type':_0x1e7f02(0x2ce),'role':_0x1e7f02(0x1c3),'read':!![],'write':!![],'def':![]},'native':{}}),await this[_0x1e7f02(0x183)](LTM_DP_BASELINE_STATUS,{'type':_0x1e7f02(0x1cc),'common':{'name':_0x1e7f02(0x17b),'type':_0x1e7f02(0x1cd),'role':_0x1e7f02(0x1d3),'read':!![],'write':![]},'native':{}});}async[a0_0x2c53cb(0x29e)](){const _0x1f51e7=a0_0x2c53cb;await this[_0x1f51e7(0x183)](LTM_DP_DRIFT_CHANNEL,{'type':_0x1f51e7(0x2cf),'common':{'name':'Drift\x20Analysis'},'native':{}}),await this[_0x1f51e7(0x183)](LTM_DP_DRIFT_STATUS,{'type':_0x1f51e7(0x1cc),'common':{'name':_0x1f51e7(0x18d),'type':_0x1f51e7(0x1cd),'role':_0x1f51e7(0x1cc),'read':!![],'write':![],'def':_0x1f51e7(0x1ea)},'native':{}}),await this[_0x1f51e7(0x183)](LTM_DP_DRIFT_DETAILS,{'type':'state','common':{'name':_0x1f51e7(0x2d1),'type':_0x1f51e7(0x1cd),'role':_0x1f51e7(0x1d3),'read':!![],'write':![]},'native':{}}),await this['extendObjectAsync'](LTM_DP_DRIFT_LAST_CHECK,{'type':_0x1f51e7(0x1cc),'common':{'name':'Last\x20Check','type':_0x1f51e7(0x2e0),'role':_0x1f51e7(0x30f),'read':!![],'write':![]},'native':{}});}async['runBaselineDriftAnalysis'](){const _0x231e1a=a0_0x2c53cb;if(!this[_0x231e1a(0x2c6)]||!this[_0x231e1a(0x198)])return;const _0x32d0ab=this[_0x231e1a(0x1d0)][_0x231e1a(0x1c4)]||0xe;if(this['dailyDigests']['length']<_0x32d0ab+(this[_0x231e1a(0x1d0)]['minDaysForBaseline']||0x7)){await this[_0x231e1a(0x2fd)](LTM_DP_DRIFT_STATUS,{'val':'N/A\x20(Learning)','ack':!![]});return;}const _0x52d958=this[_0x231e1a(0x323)]['slice'](-_0x32d0ab),_0x3eb0cf=this['dailyDigests'][_0x231e1a(0x2c9)](0x0,this[_0x231e1a(0x323)][_0x231e1a(0x1a8)]-_0x32d0ab),_0x481198=_0x231e1a(0x1ff)+JSON[_0x231e1a(0x203)](_0x3eb0cf)+_0x231e1a(0x226)+JSON['stringify'](_0x52d958);try{const _0x516d46=await this['geminiModel'][_0x231e1a(0x30b)](_0x481198),_0x1ae69a=JSON['parse'](_0x516d46['response'][_0x231e1a(0x1d3)]()[_0x231e1a(0x185)](/```json|```/g,'')[_0x231e1a(0x1ce)]());_0x1ae69a['baselineDrift']&&(await this['setStateAsync'](LTM_DP_DRIFT_STATUS,{'val':_0x1ae69a[_0x231e1a(0x1bd)],'ack':!![]}),await this[_0x231e1a(0x2fd)](LTM_DP_DRIFT_DETAILS,{'val':_0x1ae69a[_0x231e1a(0x1b0)],'ack':!![]}),await this[_0x231e1a(0x2fd)](LTM_DP_DRIFT_LAST_CHECK,{'val':Date[_0x231e1a(0x243)](),'ack':!![]}));}catch(_0x4e67b3){}}async[a0_0x2c53cb(0x1a9)](){const _0x1136fd=a0_0x2c53cb;try{const _0x536fb1=await this[_0x1136fd(0x2ee)](SYSTEM_DP_MODE);_0x536fb1&&_0x536fb1['val']&&Object['values'](SYSTEM_MODES)[_0x1136fd(0x271)](_0x536fb1[_0x1136fd(0x270)])?this[_0x1136fd(0x2cb)]=_0x536fb1[_0x1136fd(0x270)]:(this[_0x1136fd(0x2cb)]=SYSTEM_MODES['NORMAL'],await this[_0x1136fd(0x2fd)](SYSTEM_DP_MODE,{'val':SYSTEM_MODES[_0x1136fd(0x179)],'ack':!![]}));}catch(_0x843cc4){this[_0x1136fd(0x2cb)]=SYSTEM_MODES['NORMAL'];}}async[a0_0x2c53cb(0x268)](){const _0x1f25fc=a0_0x2c53cb;try{const _0x4143b0=await this[_0x1f25fc(0x22c)](_0x1f25fc(0x1a3));if(_0x4143b0&&_0x4143b0['native']&&_0x4143b0[_0x1f25fc(0x2b7)]['uuid'])return _0x4143b0[_0x1f25fc(0x2b7)]['uuid'];return'uuid-not-found';}catch(_0x212851){return _0x1f25fc(0x32f);}}async[a0_0x2c53cb(0x2a2)](_0x13ac5f){const _0x162dcc=a0_0x2c53cb;if(!_0x13ac5f)return![];this[_0x162dcc(0x272)]=await this[_0x162dcc(0x268)]();if(_0x13ac5f===_0x162dcc(0x312)||_0x13ac5f[_0x162dcc(0x234)]('PRO-'))return!![];return![];}[a0_0x2c53cb(0x305)](_0x13ccfa){const _0x54e776=a0_0x2c53cb;if(this[_0x54e776(0x25a)])clearInterval(this[_0x54e776(0x25a)]);if(this[_0x54e776(0x31a)])clearInterval(this[_0x54e776(0x31a)]);if(this[_0x54e776(0x2af)])this[_0x54e776(0x2af)][_0x54e776(0x1e8)]();if(this[_0x54e776(0x186)])this[_0x54e776(0x186)][_0x54e776(0x1e8)]();if(this[_0x54e776(0x257)])this['briefingJob']['cancel']();if(this[_0x54e776(0x1b1)])clearTimeout(this[_0x54e776(0x1b1)]);if(this[_0x54e776(0x34e)])clearTimeout(this[_0x54e776(0x34e)]);_0x13ccfa();}async[a0_0x2c53cb(0x26c)](_0x4ae1cc){const _0x92cf66=a0_0x2c53cb;if(typeof _0x4ae1cc===_0x92cf66(0x291)&&_0x4ae1cc[_0x92cf66(0x33e)]){if(_0x4ae1cc[_0x92cf66(0x2c2)]===_0x92cf66(0x2a9)){if(!_0x4ae1cc['message'][_0x92cf66(0x20e)])return this[_0x92cf66(0x1ec)](_0x4ae1cc['from'],_0x4ae1cc['command'],{'success':![],'message':_0x92cf66(0x1ee)},_0x4ae1cc['callback']);try{const _0x5eb765=new GoogleGenerativeAI(_0x4ae1cc['message']['apiKey'])[_0x92cf66(0x2fc)]({'model':_0x92cf66(0x2b0)});await _0x5eb765['generateContent'](_0x92cf66(0x2dd)),this['sendTo'](_0x4ae1cc[_0x92cf66(0x1ba)],_0x4ae1cc[_0x92cf66(0x2c2)],{'success':!![],'message':'Success'},_0x4ae1cc[_0x92cf66(0x31f)]);}catch(_0x47dd6a){this[_0x92cf66(0x1ec)](_0x4ae1cc['from'],_0x4ae1cc['command'],{'success':![],'message':_0x47dd6a[_0x92cf66(0x33e)]},_0x4ae1cc['callback']);}}else{if(_0x4ae1cc[_0x92cf66(0x2c2)]===_0x92cf66(0x321)){const _0x429b0f=await this[_0x92cf66(0x335)](_0x92cf66(0x2ec),!![]);this['sendTo'](_0x4ae1cc[_0x92cf66(0x1ba)],_0x4ae1cc[_0x92cf66(0x2c2)],{'success':_0x429b0f>0x0,'message':_0x429b0f+_0x92cf66(0x240)},_0x4ae1cc[_0x92cf66(0x31f)]);}else{if(_0x4ae1cc['command']===_0x92cf66(0x1f2)){if(!this['isProVersion'])return this[_0x92cf66(0x1ec)](_0x4ae1cc['from'],_0x4ae1cc[_0x92cf66(0x2c2)],{'success':![],'isPro':![]},_0x4ae1cc[_0x92cf66(0x31f)]);let _0x21ff1e={'status':_0x92cf66(0x1ea),'details':'','lastCheck':0x0};try{_0x21ff1e['status']=(await this['getStateAsync'](LTM_DP_DRIFT_STATUS))['val'],_0x21ff1e[_0x92cf66(0x276)]=(await this['getStateAsync'](LTM_DP_DRIFT_DETAILS))['val'],_0x21ff1e[_0x92cf66(0x1b2)]=(await this[_0x92cf66(0x2ee)](LTM_DP_DRIFT_LAST_CHECK))[_0x92cf66(0x270)];}catch(_0x42091b){}this['sendTo'](_0x4ae1cc[_0x92cf66(0x1ba)],_0x4ae1cc[_0x92cf66(0x2c2)],{'success':!![],'isPro':!![],'dailyDigests':this[_0x92cf66(0x323)],'driftAnalysis':_0x21ff1e,'analysisHistory':this[_0x92cf66(0x233)]},_0x4ae1cc[_0x92cf66(0x31f)]);}else{if(_0x4ae1cc[_0x92cf66(0x2c2)]===_0x92cf66(0x2aa)){const _0x4aff92=await this['getForeignObjectsAsync']('enum.functions.*',_0x92cf66(0x229)),_0x5c3fbb=[];if(_0x4aff92)for(const _0x4f02d1 in _0x4aff92){const _0x5b2347=_0x4aff92[_0x4f02d1],_0x18baeb=(_0x5b2347[_0x92cf66(0x25f)]&&typeof _0x5b2347[_0x92cf66(0x25f)][_0x92cf66(0x1f1)]===_0x92cf66(0x291)?_0x5b2347[_0x92cf66(0x25f)][_0x92cf66(0x1f1)]['de']:_0x5b2347['common'][_0x92cf66(0x1f1)])||_0x5b2347[_0x92cf66(0x25f)][_0x92cf66(0x1f1)];_0x5c3fbb[_0x92cf66(0x175)]({'id':_0x4f02d1,'name':_0x18baeb});}this[_0x92cf66(0x1ec)](_0x4ae1cc[_0x92cf66(0x1ba)],_0x4ae1cc['command'],{'success':!![],'enums':_0x5c3fbb},_0x4ae1cc[_0x92cf66(0x31f)]);}else{if(_0x4ae1cc[_0x92cf66(0x2c2)]===_0x92cf66(0x241))try{const _0x3bfbf4=await this['scanForDevices'](_0x4ae1cc[_0x92cf66(0x33e)]||{});this['sendTo'](_0x4ae1cc['from'],_0x4ae1cc['command'],{'success':!![],'devices':_0x3bfbf4},_0x4ae1cc[_0x92cf66(0x31f)]);}catch(_0x4ac635){this[_0x92cf66(0x1ec)](_0x4ae1cc['from'],_0x4ae1cc[_0x92cf66(0x2c2)],{'success':![],'error':_0x4ac635[_0x92cf66(0x33e)]},_0x4ae1cc['callback']);}else{if(_0x4ae1cc[_0x92cf66(0x2c2)]==='submitFeedback'){const {historyId:_0x396369,rating:_0x5e703a,comment:_0x352dc3,alertReason:_0x2be886}=_0x4ae1cc['message'];_0x396369&&_0x5e703a?(await this['saveFeedback']({'timestamp':Date['now'](),'historyId':_0x396369,'rating':_0x5e703a,'comment':_0x352dc3,'alertReason':_0x2be886}),this[_0x92cf66(0x1ec)](_0x4ae1cc[_0x92cf66(0x1ba)],_0x4ae1cc[_0x92cf66(0x2c2)],{'success':!![]},_0x4ae1cc['callback'])):this[_0x92cf66(0x1ec)](_0x4ae1cc['from'],_0x4ae1cc[_0x92cf66(0x2c2)],{'success':![],'error':_0x92cf66(0x221)},_0x4ae1cc[_0x92cf66(0x31f)]);}}}}}}}}}if(require['main']!==module)module['exports']=_0x11db20=>new CogniLiving(_0x11db20);else new CogniLiving();function a0_0x7041(){const _0xed7184=['\x0a!!!\x20END\x20WARNING\x20!!!\x0a','\x0a\x0aA\x20(STB):\x0a','scriptProblem','city','enum','weatherunderground.','Action','getForeignObjectAsync','flur','analysis.isEmergency','parse','analysis.comfortSuggestion','icons-mfd.','.forecast.current.state','analysisHistory','startsWith','enum.rooms.*','indicator.alarm','55ZSMQdA','history','toISOString','\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x0a\x20\x20\x20\x20\x20\x20\x20\x20DATEN:\x0a\x20\x20\x20\x20\x20\x20\x20\x20-\x20Schlafqualität\x20letzte\x20Nacht:\x20','error','sat','setupDriftAnalysisScheduler','loadDailyDigests','getCalendarContext','\x20sent','scanDevices','analysis.automation.patternDetected','now','none','health','\x20presence\x20devices...','\x0a\x20\x20\x20\x20\x20\x20\x20\x20INPUT:\x20','feedbackHistory','response','0\x203\x20*\x20*\x20*','Subscribing\x20to\x20','material.','json','toString','manufacturer','Deaktiviert\x20(Pro-Feature)','PROCESS','sleepScore','getForeignStateAsync','notifyWhatsappEnabled','eventHistory','analysis.health.sleepScore','briefingJob','accuweather.','küche','analysisTimer','some','productname','sensor.window','notifySignalRecipient','common','daswetter.','runBaselineDriftAnalysis','system.mode','rain','Comfort\x20Summary','Description','.Summary.Current','event','getSystemUUID','ON_TIME','retry','namespace','onMessage','location','tür','licht','val','includes','systemUUID','eingang','Logbook','User\x20Feedback:\x20Alarm\x20\x22','details','openweathermap','daswetter','LTM.baselineStatus','events.history_debug_04','cogni-living\x20adapter\x20starting\x20(v','alertReason','(((.+)+)+)+$','splice','suggestion','getWeatherContext','3759300RFgHcS','join','system','yr.','analysis.comfortSummary','Gast','CRITICAL\x20WARNING:\x20No\x20sensor\x20activity\x20detected\x20for\x20','value.humidity','\x20(EMERGENCY)','Analysiere\x20ausgewogen\x20auf\x20Gesundheit,\x20Sicherheit\x20und\x20Komfort.','checkWifiPresence','isPresent','fire','isGracePeriodActive','Fenster/Tür','switch.light','object','uniqueid','Baseline:\x20Inactive\x20(Pro\x20Feature).','LOWBAT','patternDetected','[TEST]\x20','notifyPushoverInstance','notifySignalEnabled','ready','VIRTUAL_CHANNEL','FAULT','Garten','🚨\x20EMERGENCY','checkLtmDriftObjects','Fehler:\x20','selectedFunctionIds','openweathermap.0','checkLicense','129672PAslLY','\x20hours.\x20The\x20resident\x20might\x20be\x20incapacitated.\x20Risk\x20level:\x20HIGH.','analysis.automation.suggestedAction','unload','battery','search','testApiKey','getEnums','Urlaub','Automation\x20Proposals','process','notifyEmailRecipient','ltmJob','models/gemini-flash-latest','icon','LTM.dailyDigests','fenster','Badezimmer','isExit','297816JefnSV','native','RSSI','INSTALL_TEST','WETTER:\x20Unbekannt','version','KALENDER\x20(Termine):\x20','rauch','LTM.triggerDailyDigest','Bewegung','UNREACH','ical.0','command','motion','5Kdlwvx','toUpperCase','isProVersion','ROLLE:\x20Smart\x20Home\x20Analyst.\x20SPRACHE:\x20DE.\x20FORMAT:\x20JSON.\x20\x0a\x20\x20\x20\x20\x20\x20\x20\x20AKTUELLE\x20ZEIT:\x20','SABOTAGE','slice','reachable','currentSystemMode','Gemini\x20Init\x20Error:\x20','detectionState','boolean','channel','suggestedAction','Drift\x20Details','rating','briefingEnabled','node-schedule','calendarInstance','\x0a\x20\x20\x20\x20\x20\x20\x20\x20','Briefing\x20Error:\x20','Presence\x20Status','127772qvHjtN','Generating\x20Morning\x20Briefing...','ltmDriftCheckIntervalHours','6ULRmol','test','members','temperature','number','sendMorningBriefing','geminiApiKey','analysis.history_debug_03','accuweather.0','archetype','garten','Temperatur','log','@google/generative-ai','analysis.deviationFromBaseline','Event\x20History','[Test]\x20Notification','unknown','getStateAsync','ALARM','STICKY_UNREACH','LTM.processingStatus','DIRECTION','analysis.automation.description','shutter_contact','notifyWhatsappRecipient','CONNECTION','devices','Scheduling\x20Morning\x20Briefing\x20for\x20','Küche','createAllObjects','genAI','getGenerativeModel','setStateAsync','loadHistoryFromState','Daily\x20Digest\x20created\x20successfully.','Creating\x20Daily\x20Digest\x20from\x20','Analysis\x20Error:\x20','Fokus\x20auf\x20Maximierung\x20von\x20Komfort,\x20Automatisierungseffizienz\x20und\x20Energieeinsparung.','comfort','.NextHours.Location_1.Day_1.current.symbol_desc','onUnload','notes','getForeignObjectsAsync','PARTY','runGeminiAnalysis','\x20sensors...','generateContent','scriptEnabled','text.alarm','setupLtmScheduler','date','last_seen','description','TEST-PRO-KEY','party','admin.','OPERATING_VOLTAGE','.data.table','DUTYCYCLE','Daily\x20Digests','processSensorEvent','driftAnalysisTimer','\x0aFEEDBACK:\x0a','Cogni-Living\x20Alert','openweathermap.','javascript.0.script','callback','update','testNotification','lampe','dailyDigests','SECTION','AI\x20Emergency\x20Status','haustür','notifyPushoverEnabled','2-digit','timestamp','livingContext','analysis.activitySummary','application/json','Schalter/Licht','🌅\x20Daily\x20Briefing:\x0a','uuid-error','runAutopilot','toLocaleString','values','forecast','isArray','sendNotification','setPresence','bewegung','getObjectAsync','automationProposal','capabilities','LTM','pop','inactivityMonitoringEnabled','message','createDailyDigest','updateBaselineStatus','@iobroker/adapter-core','setupBriefingScheduler','history.','sound','\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x0a\x20\x20\x20\x20\x20\x20\x20\x20OUTPUT:\x20Nur\x20der\x20Nachrichtentext\x20(kein\x20JSON).\x20Integriere\x20den\x20Kontext\x20(Wetter/Kalender)\x20nur\x20wenn\x20relevant.','.\x0a\x20\x20\x20\x20\x20\x20\x20\x20EXTERNER\x20KONTEXT\x20(WICHTIG):\x20','events.history_debug_00','setupModeResetScheduler','⚠️\x20Alarm','notifyTelegramRecipient','präsenz','ltmLtbWindowDays','indicator','exitGraceTimer','Raw\x20Log','LTM.driftAnalysis.driftDetails','sendToAsync','Nein','ROLLE:\x20Fürsorglicher\x20Assistent.\x0a\x20\x20\x20\x20\x20\x20\x20\x20AUFGABE:\x20Schreibe\x20eine\x20kurze,\x20beruhigende\x20\x22Guten\x20Morgen\x22-Nachricht\x20an\x20die\x20Angehörigen/Bewohner.\x0a\x20\x20\x20\x20\x20\x20\x20\x20TON:\x20Freundlich,\x20professionell,\x20kurz.\x0a\x20\x20\x20\x20\x20\x20\x20\x20PERSONA\x20(Fokus):\x20','Pattern\x20Detected','analysis.feedbackHistory','logDuplicates','push','events.history_debug_03','expire','No\x20recorded\x20events\x20yet.','NORMAL','level','Baseline\x20Status','Wohnzimmer','Processing\x20Status','link_quality','setObjectNotExistsAsync','analysis.history_debug_04','WEEK_PROGRAM','toLowerCase','extendObjectAsync','schlaf','replace','modeResetJob','constructor','summary','events.history_debug_01','Licht','info.','checkSystemObjects','Drift\x20Status','Sleep\x20Score\x20(0-100)','onReady','scanForDevices','.\x20ORT:\x20','updateAnalysisHistory','weather','rawEventLog','onStateChange','events.lastEvent','system.config','geminiModel','analysis.lastResult','Zu\x20wenig\x20Daten\x20für\x20Daily\x20Digest.','split','notifyEmailInstance','Trigger\x20Briefing\x20(Test)','catch','sort','Last\x20raw\x20event','systemConfig','saveRawEventLog','system.meta.uuid','type','Sending\x20notification:\x20\x22','Analysiere\x20Tag...','restlessness','length','loadSystemMode','Normal','_score','Last\x20Result','analysis.history_debug_02','Fokus\x20auf\x20Familienroutinen,\x20Kindersicherheit\x20und\x20allgemeines\x20Haushaltsmanagement.','Adapter','driftDetails','exitTimer','lastCheck','inactivityThresholdHours','KALENDER:\x20Keine\x20Termine','unshift','system.isPresent','PRIORITÄT:\x20Sicherheit.\x20Erkenne\x20Eindringlinge,\x20ungewöhnliche\x20Anwesenheit.','System\x20Status\x20&\x20Control','subscribeStates','from','AI\x20Alert\x20Status','longitude','baselineDrift','temperatur','344160IqlHkJ','mac\x20address','subscribeForeignStatesAsync','VACATION','button','ltmStbWindowDays','ack','connection','saveDailyDigests','apply','Gemini\x20AI\x20initialized.','weatherInstance','analysis.trigger','state','string','trim','analysis.triggerBriefing','config','WETTER\x20(Draußen):\x20','sensorLastValues','text','.\x20PERSONA:\x20','AES_KEY','154WwavFx','\x0a\x20\x20\x20\x20\x20\x20\x20\x20OUTPUT\x20SCHEMA:\x20{\x20\x22summary\x22:\x20\x22string\x22,\x20\x22activityLevel\x22:\x20\x22string\x22,\x20\x22health\x22:\x20{\x20\x22sleepScore\x22:\x20number,\x20\x22restlessness\x22:\x20\x22string\x22\x20}\x20}','analysis.health.restlessness','Starting\x20Autopilot\x20(','scheduleJob','wetter','presenceDevices','.\x0a\x20\x20\x20\x20\x20\x20\x20\x20MODUS:\x20','flot.','Morning\x20Briefing\x20sent.','info','isEmergency','generic','activity','system.','long','licenseKey','lastAlertState','cancel','Schlafzimmer','N/A','notifyTelegramEnabled','sendTo','triggerBriefing','No\x20Key','abortExitTimer','firmware','name','getLtmData','Starting\x20Smart\x20Scan\x20with\x20filters:\x20','\x20*\x20*\x20*','\x0a\x20\x20\x20\x20\x20\x20\x20\x20KONTEXT\x20(Wer\x20wohnt\x20hier?):\x20','bind','Daily\x20Digest\x20erstellt\x20&\x20gespeichert.','🚨🚨\x20NOTFALL','notifyWhatsappInstance','wohn','\x22\x20was\x20','events.history','indicator.alarm.fire','analysis.isAlert','ROLLE:\x20Data\x20Scientist.\x20VERGLEICHE:\x20Dataset\x20A\x20(Recent)\x20vs\x20B\x20(Established).\x20ZIEL:\x20Erkenne\x20Drift.\x20SCHEMA:\x20{\x20\x22baselineDrift\x22:\x20\x22none|slight|significant|critical\x22,\x20\x22driftDetails\x22:\x20\x22string\x22\x20}\x0a\x0aB\x20(LTB):\x0a','smoke','weatherunderground.0','signal','stringify','daswetter.0','occupancy','62424STsQQf','analysisInterval','analysis.health.notes','send','enum.functions.*','\x0a!!!\x20EXTERNAL\x20SYSTEM\x20WARNING\x20!!!\x0a','value.temperature','hue','apiKey','ROLLE:\x20Data\x20Analyst.\x20AUFGABE:\x20Fasse\x20den\x20heutigen\x20Tag\x20basierend\x20auf\x20den\x20Sensor-Logs\x20zusammen.\x0a\x20\x20\x20\x20\x20\x20\x20\x20PERSONA:\x20','analysis.analysisHistory','475656xMKkWz','latitude','wohnungstür','accuweather','checkLtmObjects','analysis.history_debug_00','lights','startExitTimer','last\x20action','GUEST','aiPersona','0\x204\x20*\x20*\x20*','Alert\x20Reason','Health\x20&\x20Sleep\x20Analysis','notifySignalInstance','9BbnTgL','Missing\x20data','setState','notifyTelegramInstance','loadRawEventLog'];a0_0x7041=function(){return _0xed7184;};return a0_0x7041();}