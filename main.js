const a0_0x4579c0=a0_0x5bc6;(function(_0x22685f,_0x354919){const _0x1b3cf1=a0_0x5bc6,_0x30ff47=_0x22685f();while(!![]){try{const _0x60deea=parseInt(_0x1b3cf1(0x36d))/0x1*(-parseInt(_0x1b3cf1(0x25d))/0x2)+-parseInt(_0x1b3cf1(0x328))/0x3*(-parseInt(_0x1b3cf1(0x2d6))/0x4)+parseInt(_0x1b3cf1(0x24e))/0x5+parseInt(_0x1b3cf1(0x291))/0x6*(parseInt(_0x1b3cf1(0x24c))/0x7)+parseInt(_0x1b3cf1(0x2ce))/0x8+-parseInt(_0x1b3cf1(0x27f))/0x9*(-parseInt(_0x1b3cf1(0x363))/0xa)+-parseInt(_0x1b3cf1(0x200))/0xb;if(_0x60deea===_0x354919)break;else _0x30ff47['push'](_0x30ff47['shift']());}catch(_0x3c64ee){_0x30ff47['push'](_0x30ff47['shift']());}}}(a0_0x12aa,0x18bc9));const a0_0x5b0ca1=(function(){let _0x145077=!![];return function(_0x8c0efe,_0x574a28){const _0x5693e9=_0x145077?function(){const _0x383f07=a0_0x5bc6;if(_0x574a28){const _0x63bc9b=_0x574a28[_0x383f07(0x2a2)](_0x8c0efe,arguments);return _0x574a28=null,_0x63bc9b;}}:function(){};return _0x145077=![],_0x5693e9;};}()),a0_0x51e4bd=a0_0x5b0ca1(this,function(){const _0x3c38cc=a0_0x5bc6;return a0_0x51e4bd['toString']()[_0x3c38cc(0x389)]('(((.+)+)+)+$')['toString']()['constructor'](a0_0x51e4bd)['search'](_0x3c38cc(0x2b7));});a0_0x51e4bd();'use strict';const utils=require(a0_0x4579c0(0x244)),{GoogleGenerativeAI}=require(a0_0x4579c0(0x360)),schedule=require(a0_0x4579c0(0x351)),{spawn,exec}=require(a0_0x4579c0(0x34c)),path=require(a0_0x4579c0(0x35b)),fs=require('fs'),HISTORY_MAX_SIZE=0x32,RAW_LOG_MAX_SIZE=0x5dc,LTM_MIN_EVENTS_FOR_COMPRESSION=0x5,GEMINI_MODEL=a0_0x4579c0(0x34b),LTM_SCHEDULE='0\x203\x20*\x20*\x20*',MODE_RESET_SCHEDULE=a0_0x4579c0(0x24a),SEQUENCE_TIMEOUT_MS=0x5*0x3c*0x3e8,MAX_TRAINING_SET_SIZE=0x1f4,THERMO_LOG_SIZE=0x3e8,ANALYSIS_HISTORY_MAX_SIZE=0x64,EXIT_TIMER_MINUTES=0xf,EXIT_GRACE_PERIOD_SECONDS=0x1e,LTM_DP_RAW_LOG=a0_0x4579c0(0x225),LTM_DP_DAILY_DIGESTS=a0_0x4579c0(0x31b),LTM_DP_STATUS=a0_0x4579c0(0x275),LTM_DP_TRIGGER_DIGEST=a0_0x4579c0(0x2e9),LTM_DP_BASELINE_STATUS=a0_0x4579c0(0x264),LTM_DP_DRIFT_CHANNEL=a0_0x4579c0(0x2f5),LTM_DP_DRIFT_STATUS=a0_0x4579c0(0x335),LTM_DP_DRIFT_DETAILS=a0_0x4579c0(0x2fb),LTM_DP_DRIFT_LAST_CHECK=a0_0x4579c0(0x26a),SYSTEM_DP_MODE='system.mode',SYSTEM_MODES={'NORMAL':a0_0x4579c0(0x315),'VACATION':'vacation','PARTY':a0_0x4579c0(0x379),'GUEST':a0_0x4579c0(0x372)},AUTO_RESET_MODES=[SYSTEM_MODES[a0_0x4579c0(0x347)],SYSTEM_MODES[a0_0x4579c0(0x25f)]],PERSONA_MAPPING={'generic':a0_0x4579c0(0x27c),'senior_aal':a0_0x4579c0(0x365),'family':a0_0x4579c0(0x232),'single_comfort':a0_0x4579c0(0x272),'security':'PRIORITÃ„T:\x20Sicherheit.'},ACTIVITY_LEVEL_MAP={'sehr\x20hoch':0x64,'hoch':0x50,'normal':0x3c,'niedrig':0x28,'sehr\x20niedrig':0x14,'inaktiv':0x0},HARD_IGNORE_TERMS=[a0_0x4579c0(0x2d0),a0_0x4579c0(0x226),a0_0x4579c0(0x24b),a0_0x4579c0(0x261),'lowbat',a0_0x4579c0(0x2fc),'connection','maintenance','error',a0_0x4579c0(0x37d),a0_0x4579c0(0x37c),a0_0x4579c0(0x202),'stick_unreach',a0_0x4579c0(0x2d7),a0_0x4579c0(0x22c),a0_0x4579c0(0x284),'reachable',a0_0x4579c0(0x38a)],BAD_NAMES=[a0_0x4579c0(0x308),a0_0x4579c0(0x304),a0_0x4579c0(0x321),a0_0x4579c0(0x20c),'value',a0_0x4579c0(0x2ea),'on',a0_0x4579c0(0x2af),a0_0x4579c0(0x27b),a0_0x4579c0(0x348),'shutter',a0_0x4579c0(0x295),'cover','status',a0_0x4579c0(0x377),a0_0x4579c0(0x215),a0_0x4579c0(0x211),a0_0x4579c0(0x353),a0_0x4579c0(0x265),'power',a0_0x4579c0(0x2a1),a0_0x4579c0(0x2d2),a0_0x4579c0(0x26e),'actual_temperature',a0_0x4579c0(0x30b)],ADAPTER_BLACKLIST=[a0_0x4579c0(0x230),a0_0x4579c0(0x256),a0_0x4579c0(0x2b0),a0_0x4579c0(0x344),a0_0x4579c0(0x2d9),a0_0x4579c0(0x1fc),a0_0x4579c0(0x255),a0_0x4579c0(0x2ad),a0_0x4579c0(0x36a),'javascript.',a0_0x4579c0(0x2f9)],IS_WIN=process['platform']===a0_0x4579c0(0x306),VENV_PATH=path[a0_0x4579c0(0x356)](__dirname,a0_0x4579c0(0x20a)),PYTHON_EXE=IS_WIN?path[a0_0x4579c0(0x356)](VENV_PATH,a0_0x4579c0(0x2a9),a0_0x4579c0(0x391)):path['join'](VENV_PATH,a0_0x4579c0(0x280),a0_0x4579c0(0x367)),PIP_EXE=IS_WIN?path[a0_0x4579c0(0x356)](VENV_PATH,'Scripts',a0_0x4579c0(0x2b3)):path['join'](VENV_PATH,a0_0x4579c0(0x280),a0_0x4579c0(0x2d5));let activeSequence=[],sequenceTimer=null;async function initZombies(_0x1a4d96){const _0x2ddda8=a0_0x4579c0;try{const _0x5b123e=[_0x2ddda8(0x38b),_0x2ddda8(0x214)];for(const _0x49dace of _0x5b123e){try{const _0x342310=await _0x1a4d96[_0x2ddda8(0x31a)](_0x49dace);if(_0x342310)await _0x1a4d96[_0x2ddda8(0x31f)](_0x49dace);}catch(_0x215f2b){}}}catch(_0x2f086c){}}async function initHistory(_0x489824){const _0x4a8937=a0_0x4579c0;try{const _0x4f76ae=await _0x489824[_0x4a8937(0x394)](_0x4a8937(0x266));_0x4f76ae&&_0x4f76ae['val']&&(_0x489824[_0x4a8937(0x2c7)]=JSON[_0x4a8937(0x206)](_0x4f76ae[_0x4a8937(0x2c0)][_0x4a8937(0x2cb)]()));}catch(_0x1f965c){_0x489824[_0x4a8937(0x2c7)]=[];}try{const _0x296aed=await _0x489824['getStateAsync'](_0x4a8937(0x213));if(_0x296aed&&_0x296aed[_0x4a8937(0x2c0)])_0x489824[_0x4a8937(0x21a)]=JSON[_0x4a8937(0x206)](_0x296aed[_0x4a8937(0x2c0)][_0x4a8937(0x2cb)]());}catch(_0xdc66ea){_0x489824[_0x4a8937(0x21a)]=[];}if(_0x489824[_0x4a8937(0x2c7)]&&_0x489824[_0x4a8937(0x2c7)][_0x4a8937(0x23c)]>0x0){_0x489824[_0x4a8937(0x2eb)][_0x4a8937(0x2a6)](_0x4a8937(0x2fa)+_0x489824[_0x4a8937(0x2c7)][_0x4a8937(0x23c)]+_0x4a8937(0x29b));for(let _0x1feced=_0x489824['eventHistory'][_0x4a8937(0x23c)]-0x1;_0x1feced>=0x0;_0x1feced--){const _0x12dcc2=_0x489824['eventHistory'][_0x1feced];if(_0x12dcc2&&_0x12dcc2['id']!==undefined&&_0x12dcc2['value']!==undefined)_0x489824[_0x4a8937(0x1f1)][_0x12dcc2['id']]=_0x12dcc2[_0x4a8937(0x332)];}}}async function initSystemConfig(_0x1f1b80){const _0x2b4602=a0_0x4579c0;try{const _0x1e7843=await _0x1f1b80[_0x2b4602(0x2a7)](_0x2b4602(0x31c));if(_0x1e7843&&_0x1e7843['common'])_0x1f1b80['systemConfig']={'latitude':_0x1e7843['common'][_0x2b4602(0x2f7)]||0x0,'longitude':_0x1e7843[_0x2b4602(0x2fd)][_0x2b4602(0x2ff)]||0x0,'city':_0x1e7843[_0x2b4602(0x2fd)][_0x2b4602(0x2a0)]||''};}catch(_0x5e3842){}}async function checkLicense(_0x36764f,_0x27c085){return!![];}async function getSystemUUID(_0x93d1c7){const _0x52b8a1=a0_0x4579c0;return _0x52b8a1(0x32c);}async function loadRawEventLog(_0x101dc5){const _0x242ccc=a0_0x4579c0;try{const _0x151b53=await _0x101dc5['getStateAsync'](LTM_DP_RAW_LOG);if(_0x151b53&&_0x151b53['val'])_0x101dc5[_0x242ccc(0x34f)]=JSON[_0x242ccc(0x206)](_0x151b53[_0x242ccc(0x2c0)]);}catch(_0x25792d){_0x101dc5[_0x242ccc(0x34f)]=[];}}function a0_0x12aa(){const _0xf2ef79=['@iobroker/adapter-core','analysis.automation.triggerAction','analysis.automation.targetValue','string','No\x20module\x20named','Kein\x20API\x20Key!','0\x204\x20*\x20*\x20*','update','7pfkFcD','values','14020YVKGkq','isGracePeriodActive','Gemini\x20AI\x20initialized.','type','Sec-Training\x20started...','callback','analysis.training.triggerHealth','icons-mfd.','admin.','contact','application/json','heating','date','timestamp','toLowerCase','70qDRVyc','getForeignObjectsAsync','GUEST','isProVersion','unreach','location','analysis.training.triggerEnergy','LTM.baselineStatus','humidity','events.history','âœ…\x20Alarm\x20quittiert.\x20System\x20normal.','[PYTHON\x20ERR]\x20','[PYTHON]\x20','LTM.driftAnalysis.lastCheck','requirements.txt','message','getFullYear','valve','ack','aiPersona','HEALTH_TRAIN_RESULT','Fokus\x20auf\x20Komfort.','find','driftAnalysisTimer','LTM.processingStatus','BUTLER\x20Execution\x20Error:\x20','some','alertReason','analysis.energy.insulationScore','fenster','switch','Analysiere\x20ausgewogen.','KALENDER:\x20','SECURITY_RESULT','45OEzlVj','bin','Scanning\x20for\x20devices...','getGenerativeModel','ðŸ¤–\x20BUTLER:\x20No\x20valid\x20target\x20ID\x20or\x20value\x20stored\x20for\x20execution.','firmware','extendObjectAsync','analysisTimer','[RESULT]','Security\x20Monitor','.data.table','Sequences','.\x20KONTEXT:\x20','analysis.alertReason','triggerBriefing','\x20=\x20','simulateButler','filter','459402oXuPsg','ðŸ\x20Python\x20Pong','dependencyInstallInProgress','config','blind','PONG','text','json','round','existsSync','\x20events)...','lampe','response','ical.0','getHours','city','energy','apply','analysis.health.isAnomaly','modeResetJob','now','info','getForeignObjectAsync','âš ï¸\x20VENV\x20missing.\x20Attempting\x20install...','Scripts','summary','shift','onUnload','flot.','analysis.automation.targetId','off','info.','calendarInstance','[LOG]','pip.exe','outdoorSensorId','ðŸ\x20Stopping\x20Python...','presenceDevices','(((.+)+)+)+$','autoApply','analysis.triggerBriefing','Error\x20checking\x20WiFi:\x20','system.presenceWho','lights','System','Anomaly\x20Detected','systemUUID','val','LTM','geminiApiKey','Invalid\x20JSON:\x20','onMessage','instance','testApiKey','eventHistory','isEmergency','unshift','lastIndexOf','toString','inactivityThresholdHours','Kein\x20API\x20Key.','302144pCHjcA','heizung','scriptProblem','getEnums','setpoint','submitFeedback','Trend','pip','193532bSIGyf','config_pending','ðŸ¤–\x20BUTLER:\x20Executing\x20Action\x20->\x20','history.','Alert\x20Status','isAlert','Trigger\x20Briefing','COGNI_REQUEST_CALL','close','from','system','writable','TRAINING_COMPLETE','âŒ\x20PIP\x20INSTALL\x20FAILED:\x20','logDuplicates','Target\x20ID','[RECORDER]\x20Added\x20step\x20to\x20sequence:\x20','indexOf','subscribeForeignStatesAsync','LTM.triggerDailyDigest','brightness','log','.\x20AUFGABE:\x201.\x20Gesundheit?\x202.\x20Komfort?\x20FORMAT\x20(JSON):\x20{\x20\x22isAlert\x22:\x20boolean,\x20\x22alertReason\x22:\x20\x22string\x22,\x20\x22isEmergency\x22:\x20boolean,\x20\x22summary\x22:\x20\x22string\x22,\x20\x22automationProposal\x22:\x20{\x20\x22detected\x22:\x20boolean,\x20\x22description\x22:\x20\x22string\x22,\x20\x22targetId\x22:\x20\x22string\x22,\x20\x22targetValue\x22:\x20\x22any\x22\x20}\x20}','Missing\x20data','name','N/A','toFixed','analysis.health.trendValue','Train\x20Energy','Trigger\x20Action','python_service','LTM.driftAnalysis','Train\x20Health','latitude','indicator.alarm','simple-api.','Restoring\x20sensor\x20cache\x20from\x20history\x20(','LTM.driftAnalysis.driftDetails','rssi','common','python3\x20-m\x20venv\x20\x22','longitude','Training\x20Error:\x20','analysis.training','event','Description','currentposition','analysis.isAlert','win32','button','targetposition','python3','Energy\x20Intelligence','set_temperature','namespace','setObjectNotExistsAsync','ðŸ› ï¸\x20MAINTENANCE\x20MODE:\x20Installing\x20Python\x20dependencies.\x20Do\x20not\x20restart!','selectedFunctionIds','Trigger\x20Analysis','unload','system.isPresent','write','slice','normal','minDaysForBaseline','Err:\x20','KI-Modell\x20nicht\x20initialisiert','onStateChange','getObjectAsync','LTM.dailyDigests','system.config','AI\x20Training','events.lastEvent','delObjectAsync','stdin','state','debug','currentSystemMode','âš ï¸\x20SECURITY\x20ALARM:\x20','\x22\x20install\x20-r\x20\x22','Insulation\x20Score','.\x20EVENTS:\x20','6wBOooU','LTM.trainingData.sequences','analysis.security.lastScore','ðŸ\x20Using\x20VENV\x20Python:\x20','uuid','ANALYZE_SEQUENCE','Alert\x20Reason','command',')\x20-\x20OBFUSCATOR\x20SAFE\x20MODE','VACATION','value','getDate','Thermodynamics','LTM.driftAnalysis.baselineDrift','Trend\x20Value','Installing\x20dependencies\x20into\x20venv...','generic','status','getForeignStateAsync','split','NORMAL','ltmJob','briefingJob','online','enum','Daily\x20Digests','Training\x20Status','data','vis.','door','payload','PARTY','position','toISOString','startsWith','models/gemini-flash-latest','child_process','kill','isPresent','rawEventLog','dailyDigests','node-schedule','analysis.security.lastCheck','temperature','forEach','triggerDailyDigest','join','sendTo','automationProposal','automation.triggerAction','getTime','path','map','description','system.mode','subscribeStates','@google/generative-ai','rmSync','ðŸ§ª\x20Simulating\x20Butler\x20Proposal:\x20','207070nqeHCP','lastAlertState','PRIORITÃ„T:\x20Gesundheit/AAL.','[PYTHON]\x20Exited\x20code\x20','python','analysis.energy','text.alarm','echarts.','Activity\x20Summary','No\x20instance','3137HlLIQj','Gemini\x20Error:\x20','exports','channel','includes','guest','dismissAutomation','Kalender:\x20Deaktiviert','telegram','analysis.automation.autoApply','motion','bind','party','âš ï¸\x20Python\x20missing\x20libs.\x20Auto-Install\x20triggered.','stringify','working','fault','âœ…\x20INFRASTRUCTURE\x20READY.\x20Starting\x20Service...','version','stateChange','boolean','doors','COGNI_CONFIRM_OK','analysis.energy.heatingScore','object','replace','Target\x20Value','temperatur','search','link_quality','analysis.history_debug_00','analysis.lastResult','tÃ¼r','members','.\x20SYSTEM_MODE:\x20','onReady','python.exe','Last\x20Check','service.py','getStateAsync','.communicate.request','Unknown','UngewÃ¶hnliches\x20Bewegungsmuster!\x20(Score:\x20','analysis.training.status','analysis.activitySummary','detected','sensorLastValues','warn','sort','ROLLE:\x20KI-Hausverwalter.\x20PERSONA:\x20','Anomaly\x20Score','Aktiv\x20(','setState','analysis.automation.patternDetected','analysis.trigger','getCalendarNames','generateContent','material.','insulation','analysis.security','dimmer','1169564uMpJwp','setStateAsync','direction','window','ltmLtbWindowDays','notifyTelegramEnabled','parse','geminiModel','number','ltmStbWindowDays','.venv','light','level','Success:\x20','genAI','LTM.trainingData.thermodynamics','âš ï¸\x20ALARM:\x20','occupancy','\x20(Length:\x20','analysis.analysisHistory','events.history_debug_00','presence','cogni-living\x20adapter\x20starting\x20(v','licht','notifyTelegramInstance','exitTimer','analysisHistory','targetValue','splice','enum.functions.*','unknown','.\x20EMERGENCY:\x20','âœ…\x20HEALTH\x20TRAINED:\x20','analysis.training.triggerSecurity','substring','Keine\x20Details.','Keine\x20Termine','LTM.rawEventLog','scriptEnabled','.\x20WETTER:\x20','getOverviewData','isExit','push','Who\x20is\x20present?','dutycycle','ENERGY_TRAIN_RESULT','analysis.health.lastCheck','pop','system.','analysis.automation.description','Fokus\x20auf\x20Familienroutinen.','schalter','kontakt','ðŸ§ \x20Triggering\x20Security\x20Training...','cancel','devices','pythonProcess','ANOMALY','isArray','toLocaleTimeString','length','System\x20Mode','trim','Adapter','exitGraceTimer','HEALTH_RESULT','main','error'];a0_0x12aa=function(){return _0xf2ef79;};return a0_0x12aa();}async function saveRawEventLog(_0xbc5e86){const _0x23d828=a0_0x4579c0;if(_0xbc5e86[_0x23d828(0x34f)][_0x23d828(0x23c)]>RAW_LOG_MAX_SIZE)_0xbc5e86[_0x23d828(0x34f)][_0x23d828(0x21c)](0x0,_0xbc5e86[_0x23d828(0x34f)][_0x23d828(0x23c)]-RAW_LOG_MAX_SIZE);await _0xbc5e86[_0x23d828(0x201)](LTM_DP_RAW_LOG,{'val':JSON[_0x23d828(0x37b)](_0xbc5e86['rawEventLog']),'ack':!![]});}async function loadDailyDigests(_0xeadc8){const _0x91a32c=a0_0x4579c0;try{const _0x48954c=await _0xeadc8[_0x91a32c(0x394)](LTM_DP_DAILY_DIGESTS);if(_0x48954c&&_0x48954c[_0x91a32c(0x2c0)])_0xeadc8['dailyDigests']=JSON[_0x91a32c(0x206)](_0x48954c['val']);}catch(_0x50883f){_0xeadc8[_0x91a32c(0x350)]=[];}await updateBaselineStatus(_0xeadc8);}async function saveDailyDigests(_0x445b2c,_0x16e2e8=!![]){const _0x588620=a0_0x4579c0,_0x4f4503=_0x445b2c[_0x588620(0x294)][_0x588620(0x204)]||0x3c;_0x445b2c[_0x588620(0x350)][_0x588620(0x23c)]>_0x4f4503&&_0x445b2c[_0x588620(0x350)]['splice'](0x0,_0x445b2c[_0x588620(0x350)][_0x588620(0x23c)]-_0x4f4503);await _0x445b2c[_0x588620(0x201)](LTM_DP_DAILY_DIGESTS,{'val':JSON[_0x588620(0x37b)](_0x445b2c[_0x588620(0x350)]),'ack':!![]});if(_0x16e2e8)await updateBaselineStatus(_0x445b2c);}async function updateAnalysisHistory(_0xe4bbcd,_0x3ae0e8){const _0x14743b=a0_0x4579c0;_0xe4bbcd[_0x14743b(0x21a)][_0x14743b(0x2c9)](_0x3ae0e8);if(_0xe4bbcd[_0x14743b(0x21a)][_0x14743b(0x23c)]>ANALYSIS_HISTORY_MAX_SIZE)_0xe4bbcd[_0x14743b(0x21a)][_0x14743b(0x22f)]();await _0xe4bbcd[_0x14743b(0x201)](_0x14743b(0x213),{'val':JSON[_0x14743b(0x37b)](_0xe4bbcd[_0x14743b(0x21a)]),'ack':!![]});}async function updateBaselineStatus(_0x247c71){const _0x56da73=a0_0x4579c0;if(!_0x247c71[_0x56da73(0x260)]){await _0x247c71['setStateAsync'](LTM_DP_BASELINE_STATUS,{'val':'Deaktiviert\x20(Pro-Feature)','ack':!![]});return;}const _0x174ef3=_0x247c71['dailyDigests'][_0x56da73(0x23c)]>=(_0x247c71['config'][_0x56da73(0x316)]||0x7)?_0x56da73(0x1f6)+_0x247c71['dailyDigests'][_0x56da73(0x23c)]+'\x20Tage)':'Lernphase\x20('+_0x247c71[_0x56da73(0x350)][_0x56da73(0x23c)]+'/'+(_0x247c71[_0x56da73(0x294)][_0x56da73(0x316)]||0x7)+')';await _0x247c71[_0x56da73(0x201)](LTM_DP_BASELINE_STATUS,{'val':_0x174ef3,'ack':!![]});}async function loadSystemMode(_0x51aa28){const _0x446510=a0_0x4579c0;try{const _0x200cb9=await _0x51aa28[_0x446510(0x394)](SYSTEM_DP_MODE);_0x200cb9&&_0x200cb9['val']&&Object[_0x446510(0x24d)](SYSTEM_MODES)['includes'](_0x200cb9[_0x446510(0x2c0)])?_0x51aa28['currentSystemMode']=_0x200cb9[_0x446510(0x2c0)]:(_0x51aa28[_0x446510(0x323)]=SYSTEM_MODES['NORMAL'],await _0x51aa28[_0x446510(0x201)](SYSTEM_DP_MODE,{'val':SYSTEM_MODES['NORMAL'],'ack':!![]}));}catch(_0x4c7196){_0x51aa28[_0x446510(0x323)]=SYSTEM_MODES['NORMAL'];}}async function createAllObjects(_0x351e66){const _0x238793=a0_0x4579c0;await _0x351e66[_0x238793(0x285)](_0x238793(0x2e0),{'type':_0x238793(0x370),'common':{'name':_0x238793(0x2bd)},'native':{}}),await _0x351e66[_0x238793(0x285)](SYSTEM_DP_MODE,{'type':_0x238793(0x321),'common':{'name':_0x238793(0x23d),'type':_0x238793(0x247),'role':_0x238793(0x321),'read':!![],'write':!![],'def':SYSTEM_MODES[_0x238793(0x33c)]},'native':{}}),await _0x351e66['setObjectNotExistsAsync'](_0x238793(0x2bb),{'type':_0x238793(0x321),'common':{'name':_0x238793(0x22b),'type':_0x238793(0x247),'role':_0x238793(0x297),'read':!![],'write':![]},'native':{}}),await _0x351e66[_0x238793(0x30d)](_0x238793(0x31e),{'type':_0x238793(0x321),'common':{'name':'Last\x20raw\x20event','type':_0x238793(0x247),'role':'json','read':!![],'write':![]},'native':{}}),await _0x351e66[_0x238793(0x30d)](_0x238793(0x266),{'type':_0x238793(0x321),'common':{'name':'Event\x20History','type':_0x238793(0x247),'role':_0x238793(0x298),'read':!![],'write':![]},'native':{}}),await _0x351e66['extendObjectAsync'](_0x238793(0x301),{'type':'channel','common':{'name':_0x238793(0x31d)},'native':{}}),await _0x351e66[_0x238793(0x30d)](_0x238793(0x221),{'type':_0x238793(0x321),'common':{'name':'Train\x20Security','type':'boolean','role':_0x238793(0x307),'read':!![],'write':!![]},'native':{}}),await _0x351e66[_0x238793(0x30d)](_0x238793(0x254),{'type':_0x238793(0x321),'common':{'name':_0x238793(0x2f6),'type':_0x238793(0x381),'role':_0x238793(0x307),'read':!![],'write':!![]},'native':{}}),await _0x351e66[_0x238793(0x30d)](_0x238793(0x263),{'type':_0x238793(0x321),'common':{'name':_0x238793(0x2f2),'type':'boolean','role':_0x238793(0x307),'read':!![],'write':!![]},'native':{}}),await _0x351e66['setObjectNotExistsAsync'](_0x238793(0x398),{'type':_0x238793(0x321),'common':{'name':_0x238793(0x342),'type':_0x238793(0x247),'role':_0x238793(0x297),'read':!![],'write':![]},'native':{}}),await _0x351e66[_0x238793(0x285)](_0x238793(0x1fe),{'type':_0x238793(0x370),'common':{'name':_0x238793(0x288)},'native':{}}),await _0x351e66[_0x238793(0x30d)](_0x238793(0x32a),{'type':'state','common':{'name':_0x238793(0x1f5),'type':_0x238793(0x208),'role':_0x238793(0x332),'read':!![],'write':![]},'native':{}}),await _0x351e66[_0x238793(0x30d)](_0x238793(0x352),{'type':_0x238793(0x321),'common':{'name':'Last\x20Check','type':'string','role':_0x238793(0x25a),'read':!![],'write':![]},'native':{}}),await _0x351e66[_0x238793(0x285)]('analysis.health',{'type':_0x238793(0x370),'common':{'name':'Health\x20Analysis'},'native':{}}),await _0x351e66[_0x238793(0x30d)](_0x238793(0x22e),{'type':'state','common':{'name':_0x238793(0x392),'type':_0x238793(0x247),'role':_0x238793(0x25a),'read':!![],'write':![]},'native':{}}),await _0x351e66['setObjectNotExistsAsync'](_0x238793(0x2a3),{'type':_0x238793(0x321),'common':{'name':_0x238793(0x2be),'type':_0x238793(0x381),'role':'indicator','read':!![],'write':![]},'native':{}}),await _0x351e66[_0x238793(0x30d)]('analysis.health.trendDiagnosis',{'type':_0x238793(0x321),'common':{'name':_0x238793(0x2d4),'type':_0x238793(0x247),'role':_0x238793(0x297),'read':!![],'write':![]},'native':{}}),await _0x351e66[_0x238793(0x30d)](_0x238793(0x2f1),{'type':_0x238793(0x321),'common':{'name':_0x238793(0x336),'type':_0x238793(0x208),'role':'value','read':!![],'write':![]},'native':{}}),await _0x351e66['extendObjectAsync'](_0x238793(0x368),{'type':_0x238793(0x370),'common':{'name':_0x238793(0x30a)},'native':{}}),await _0x351e66[_0x238793(0x30d)]('analysis.energy.insulationScore',{'type':_0x238793(0x321),'common':{'name':_0x238793(0x326),'type':_0x238793(0x247),'role':_0x238793(0x297),'read':!![],'write':![]},'native':{}}),await _0x351e66[_0x238793(0x30d)](_0x238793(0x384),{'type':_0x238793(0x321),'common':{'name':'Heating\x20Score','type':_0x238793(0x247),'role':_0x238793(0x297),'read':!![],'write':![]},'native':{}}),await _0x351e66['extendObjectAsync']('LTM',{'type':_0x238793(0x370),'common':{'name':_0x238793(0x2c1)},'native':{}}),await _0x351e66[_0x238793(0x285)](LTM_DP_RAW_LOG,{'type':_0x238793(0x321),'common':{'name':'Raw\x20Log','type':_0x238793(0x247),'role':_0x238793(0x298),'read':!![],'write':![]},'native':{}}),await _0x351e66[_0x238793(0x285)](LTM_DP_DAILY_DIGESTS,{'type':_0x238793(0x321),'common':{'name':_0x238793(0x341),'type':'string','role':'json','read':!![],'write':![]},'native':{}}),await _0x351e66[_0x238793(0x30d)]('LTM.trainingData.sequences',{'type':_0x238793(0x321),'common':{'name':_0x238793(0x28a),'type':_0x238793(0x247),'role':_0x238793(0x298),'read':!![],'write':![]},'native':{}}),await _0x351e66[_0x238793(0x30d)](_0x238793(0x20f),{'type':'state','common':{'name':_0x238793(0x334),'type':_0x238793(0x247),'role':_0x238793(0x298),'read':!![],'write':![]},'native':{}}),await _0x351e66[_0x238793(0x30d)](_0x238793(0x1f9),{'type':_0x238793(0x321),'common':{'name':_0x238793(0x310),'type':'boolean','role':_0x238793(0x307),'read':!![],'write':!![]},'native':{}}),await _0x351e66[_0x238793(0x30d)](_0x238793(0x2b9),{'type':'state','common':{'name':_0x238793(0x2dc),'type':_0x238793(0x381),'role':_0x238793(0x307),'read':!![],'write':!![]},'native':{}}),await _0x351e66['setObjectNotExistsAsync'](_0x238793(0x305),{'type':_0x238793(0x321),'common':{'name':_0x238793(0x2da),'type':_0x238793(0x381),'role':_0x238793(0x2f8),'read':!![],'write':![]},'native':{}}),await _0x351e66[_0x238793(0x30d)](_0x238793(0x28c),{'type':_0x238793(0x321),'common':{'name':_0x238793(0x32e),'type':'string','role':_0x238793(0x369),'read':!![],'write':![]},'native':{}}),await _0x351e66[_0x238793(0x30d)](_0x238793(0x399),{'type':_0x238793(0x321),'common':{'name':_0x238793(0x36b),'type':_0x238793(0x247),'role':_0x238793(0x297),'read':!![],'write':![]},'native':{}}),await _0x351e66[_0x238793(0x30d)]('analysis.automation.patternDetected',{'type':'state','common':{'name':'Pattern\x20Detected','type':_0x238793(0x381),'role':'indicator','read':!![],'write':![]},'native':{}}),await _0x351e66[_0x238793(0x30d)]('analysis.automation.description',{'type':_0x238793(0x321),'common':{'name':_0x238793(0x303),'type':'string','role':_0x238793(0x297),'read':!![],'write':![]},'native':{}}),await _0x351e66[_0x238793(0x30d)](_0x238793(0x2ae),{'type':_0x238793(0x321),'common':{'name':_0x238793(0x2e5),'type':_0x238793(0x247),'role':_0x238793(0x297),'read':!![],'write':![]},'native':{}}),await _0x351e66['setObjectNotExistsAsync'](_0x238793(0x246),{'type':_0x238793(0x321),'common':{'name':_0x238793(0x387),'type':_0x238793(0x247),'role':_0x238793(0x297),'read':!![],'write':![]},'native':{}}),await _0x351e66['setObjectNotExistsAsync'](_0x238793(0x376),{'type':_0x238793(0x321),'common':{'name':'Auto\x20Apply','type':_0x238793(0x381),'role':_0x238793(0x27b),'read':!![],'write':!![]},'native':{}}),await _0x351e66[_0x238793(0x30d)](_0x238793(0x245),{'type':_0x238793(0x321),'common':{'name':_0x238793(0x2f3),'type':_0x238793(0x381),'role':_0x238793(0x307),'read':!![],'write':!![]},'native':{}});}async function recordThermodynamics(_0xcc08b7,_0x114cac,_0x59eb11,_0x2a6c0f){const _0x2b72ed=a0_0x4579c0,_0x502258=await getOutsideTemperatureNumeric(_0xcc08b7),_0x23fbad=await _0xcc08b7[_0x2b72ed(0x394)]('LTM.trainingData.thermodynamics');let _0x4c62ff=[];if(_0x23fbad&&_0x23fbad[_0x2b72ed(0x2c0)])try{_0x4c62ff=JSON[_0x2b72ed(0x206)](_0x23fbad[_0x2b72ed(0x2c0)]);}catch(_0x2073b5){}_0x4c62ff[_0x2b72ed(0x22a)]({'ts':Date[_0x2b72ed(0x2a5)](),'room':_0x2a6c0f||'Unknown','t_in':_0x59eb11,'t_out':_0x502258});if(_0x4c62ff['length']>THERMO_LOG_SIZE)_0x4c62ff[_0x2b72ed(0x2ab)]();await _0xcc08b7[_0x2b72ed(0x201)](_0x2b72ed(0x20f),{'val':JSON['stringify'](_0x4c62ff),'ack':!![]});}async function getOutsideTemperatureNumeric(_0x5044c4){const _0x52f196=a0_0x4579c0;if(_0x5044c4[_0x52f196(0x294)]['outdoorSensorId'])try{const _0x120772=await _0x5044c4['getForeignStateAsync'](_0x5044c4[_0x52f196(0x294)][_0x52f196(0x2b4)]);if(_0x120772&&_0x120772[_0x52f196(0x2c0)]!==undefined&&_0x120772[_0x52f196(0x2c0)]!==null)return parseFloat(_0x120772[_0x52f196(0x2c0)]);}catch(_0x5174f4){}return null;}async function recordSequence(_0x455244,_0x3e26b2){const _0x5e20f0=a0_0x4579c0,_0x14fdc5=(_0x3e26b2[_0x5e20f0(0x251)]||'')[_0x5e20f0(0x25c)](),_0xa9e3e0=[_0x5e20f0(0x377),'bewegung','prÃ¤senz',_0x5e20f0(0x215),_0x5e20f0(0x211),_0x5e20f0(0x345),_0x5e20f0(0x38d),_0x5e20f0(0x203),_0x5e20f0(0x27a),_0x5e20f0(0x257),_0x5e20f0(0x234),_0x5e20f0(0x20b),_0x5e20f0(0x217),_0x5e20f0(0x27b),_0x5e20f0(0x233),_0x5e20f0(0x1ff),_0x5e20f0(0x29c)];if(!_0xa9e3e0['some'](_0x26fb9a=>_0x14fdc5[_0x5e20f0(0x371)](_0x26fb9a)))return;if(!_0x3e26b2['value'])return;if(sequenceTimer)clearTimeout(sequenceTimer);activeSequence[_0x5e20f0(0x22a)]({'loc':_0x3e26b2[_0x5e20f0(0x262)]||_0x5e20f0(0x396),'id':_0x3e26b2['id'],'ts':Date[_0x5e20f0(0x2a5)]()}),_0x455244[_0x5e20f0(0x2eb)][_0x5e20f0(0x322)](_0x5e20f0(0x2e6)+_0x3e26b2[_0x5e20f0(0x262)]+_0x5e20f0(0x212)+activeSequence[_0x5e20f0(0x23c)]+')'),sequenceTimer=setTimeout(async()=>{if(activeSequence['length']>0x1)await saveCompletedSequence(_0x455244);activeSequence=[];},SEQUENCE_TIMEOUT_MS);}async function saveCompletedSequence(_0xeb4b74){const _0x4cb2ab=a0_0x4579c0;try{const _0x27daab=await _0xeb4b74['getStateAsync'](_0x4cb2ab(0x329));let _0x56eeb0=[];if(_0x27daab&&_0x27daab[_0x4cb2ab(0x2c0)])try{_0x56eeb0=JSON['parse'](_0x27daab['val']);}catch(_0xe25700){}const _0x2a69ac=activeSequence[0x0]['ts'],_0x39498d=activeSequence[_0x4cb2ab(0x35c)](_0x36419b=>({'loc':_0x36419b['loc'],'t_delta':Math[_0x4cb2ab(0x299)]((_0x36419b['ts']-_0x2a69ac)/0x3e8)})),_0x4a71a9={'timestamp':new Date(_0x2a69ac)['toISOString'](),'steps':_0x39498d,'duration':Math[_0x4cb2ab(0x299)]((activeSequence[activeSequence['length']-0x1]['ts']-_0x2a69ac)/0x3e8),'daytime':new Date(_0x2a69ac)[_0x4cb2ab(0x29f)]()};_0x56eeb0[_0x4cb2ab(0x22a)](_0x4a71a9);if(_0x56eeb0[_0x4cb2ab(0x23c)]>MAX_TRAINING_SET_SIZE)_0x56eeb0[_0x4cb2ab(0x2ab)]();await _0xeb4b74[_0x4cb2ab(0x201)](_0x4cb2ab(0x329),{'val':JSON['stringify'](_0x56eeb0),'ack':!![]}),runSecurityCheck(_0xeb4b74,_0x4a71a9);}catch(_0x22af3a){_0xeb4b74['log'][_0x4cb2ab(0x243)]('[RECORDER]\x20Error\x20saving\x20sequence:\x20'+_0x22af3a[_0x4cb2ab(0x26c)]);}}function runSecurityCheck(_0x29be60,_0x50f2e9){const _0x100e49=a0_0x4579c0;if(!_0x29be60['isProVersion'])return;_0x29be60[_0x100e49(0x2eb)]['debug']('ðŸ›¡ï¸\x20SECURITY:\x20Sending\x20sequence\x20to\x20Guard\x20for\x20analysis...'),sendToPython(_0x29be60,_0x100e49(0x32d),{'sequence':_0x50f2e9});}async function processSensorEvent(_0x1f14e7,_0x57c8d9,_0x28abf1,_0x4a3166){const _0x180777=a0_0x4579c0;if(!_0x4a3166)return;const _0x3fd944=_0x28abf1['val'],_0xbdf35b=Date[_0x180777(0x2a5)](),_0x3e960b=_0x1f14e7[_0x180777(0x1f1)][_0x57c8d9];_0x1f14e7[_0x180777(0x1f1)][_0x57c8d9]=_0x3fd944;if(!_0x4a3166[_0x180777(0x2e4)]&&_0x3e960b!=undefined&&_0x3e960b==_0x3fd944)return;const _0x3355ce=(_0x4a3166[_0x180777(0x251)]||'')['toLowerCase'](),_0x9fb217=_0x3355ce[_0x180777(0x371)]('temperature')||_0x3355ce['includes'](_0x180777(0x388))||_0x3355ce[_0x180777(0x371)]('klima')||_0x3355ce['includes'](_0x180777(0x2cf));_0x1f14e7[_0x180777(0x260)]&&_0x9fb217&&recordThermodynamics(_0x1f14e7,_0x57c8d9,_0x3fd944,_0x4a3166[_0x180777(0x262)]);const _0x218937={'timestamp':_0xbdf35b,'id':_0x57c8d9,'name':_0x4a3166[_0x180777(0x2ee)],'type':_0x4a3166['type'],'location':_0x4a3166[_0x180777(0x262)],'value':_0x3fd944};_0x1f14e7[_0x180777(0x2c7)][_0x180777(0x2c9)](_0x218937);if(_0x1f14e7[_0x180777(0x2c7)][_0x180777(0x23c)]>HISTORY_MAX_SIZE)_0x1f14e7['eventHistory']['pop']();await _0x1f14e7['setStateAsync'](_0x180777(0x31e),{'val':JSON[_0x180777(0x37b)](_0x218937),'ack':!![]}),await _0x1f14e7['setStateAsync'](_0x180777(0x266),{'val':JSON[_0x180777(0x37b)](_0x1f14e7[_0x180777(0x2c7)]),'ack':!![]});_0x1f14e7[_0x180777(0x260)]&&(_0x1f14e7[_0x180777(0x34f)]['push'](_0x218937),await saveRawEventLog(_0x1f14e7),recordSequence(_0x1f14e7,_0x218937));if(_0x4a3166[_0x180777(0x229)]&&_0x3fd944===!![]){if(_0x1f14e7[_0x180777(0x34e)]&&!_0x1f14e7[_0x180777(0x24f)])startExitTimer(_0x1f14e7);else{if(!_0x1f14e7[_0x180777(0x34e)])setPresence(_0x1f14e7,!![]);}}else{if(_0x4a3166[_0x180777(0x251)]===_0x180777(0x377)&&_0x3fd944===!![]){if(_0x1f14e7[_0x180777(0x219)])abortExitTimer(_0x1f14e7);if(!_0x1f14e7[_0x180777(0x34e)]&&_0x1f14e7[_0x180777(0x323)]===SYSTEM_MODES[_0x180777(0x33c)])setPresence(_0x1f14e7,!![]);}}}function installPythonDependencies(_0x201044){const _0x377195=a0_0x4579c0;if(_0x201044[_0x377195(0x293)])return;_0x201044['dependencyInstallInProgress']=!![];const _0x36da83=path[_0x377195(0x356)](__dirname,_0x377195(0x2f4),_0x377195(0x26b));_0x201044[_0x377195(0x2eb)][_0x377195(0x2a6)](_0x377195(0x30e)),stopPythonService(_0x201044);if(fs[_0x377195(0x29a)](VENV_PATH)){if(!fs[_0x377195(0x29a)](PIP_EXE)){_0x201044[_0x377195(0x2eb)]['warn']('âš ï¸\x20Broken\x20venv\x20detected.\x20Repairing...');try{fs[_0x377195(0x361)](VENV_PATH,{'recursive':!![],'force':!![]});}catch(_0x4d9389){}}}!fs['existsSync'](VENV_PATH)?exec(_0x377195(0x2fe)+VENV_PATH+'\x22',_0x565162=>{const _0x40f819=_0x377195;if(_0x565162){_0x201044[_0x40f819(0x2eb)][_0x40f819(0x243)]('âŒ\x20VENV\x20CREATION\x20FAILED.\x20Please\x20run:\x20sudo\x20apt\x20install\x20python3-venv'),_0x201044[_0x40f819(0x293)]=![];return;}installRequirementsInVenv(_0x201044,_0x36da83);}):installRequirementsInVenv(_0x201044,_0x36da83);}function installRequirementsInVenv(_0x4d7171,_0xd98d03){const _0x878b13=a0_0x4579c0;_0x4d7171['log']['info'](_0x878b13(0x337));const _0x52d4e7='\x22'+PIP_EXE+_0x878b13(0x325)+_0xd98d03+'\x22';exec(_0x52d4e7,{'timeout':0x124f80,'maxBuffer':0x400*0x400*0x32},_0x514272=>{const _0x41a6fa=_0x878b13;_0x4d7171[_0x41a6fa(0x293)]=![],_0x514272?_0x4d7171[_0x41a6fa(0x2eb)][_0x41a6fa(0x243)](_0x41a6fa(0x2e3)+_0x514272[_0x41a6fa(0x26c)]):(_0x4d7171['log'][_0x41a6fa(0x2a6)](_0x41a6fa(0x37e)),startPythonService(_0x4d7171));});}function startPythonService(_0x20d269){const _0x116664=a0_0x4579c0;if(_0x20d269[_0x116664(0x293)])return;let _0x1e189c=_0x116664(0x309);if(fs[_0x116664(0x29a)](PYTHON_EXE))_0x20d269[_0x116664(0x2eb)][_0x116664(0x2a6)](_0x116664(0x32b)+PYTHON_EXE),_0x1e189c=PYTHON_EXE;else{_0x20d269[_0x116664(0x2eb)][_0x116664(0x1f2)](_0x116664(0x2a8)),installPythonDependencies(_0x20d269);return;}try{const _0x1ae642=path['join'](__dirname,'python_service',_0x116664(0x393));_0x20d269[_0x116664(0x238)]=spawn(_0x1e189c,[_0x1ae642]),_0x20d269[_0x116664(0x238)]['stdout']['on'](_0x116664(0x343),_0x180bfe=>{const _0x1ca7bd=_0x116664,_0x1860ed=_0x180bfe['toString']()[_0x1ca7bd(0x33b)]('\x0a');_0x1860ed[_0x1ca7bd(0x354)](_0x2fa5a9=>{const _0x5a1210=_0x1ca7bd,_0x26ea49=_0x2fa5a9[_0x5a1210(0x23e)]();if(!_0x26ea49)return;if(_0x26ea49[_0x5a1210(0x34a)](_0x5a1210(0x2b2)))_0x20d269[_0x5a1210(0x2eb)][_0x5a1210(0x322)](_0x5a1210(0x269)+_0x26ea49[_0x5a1210(0x222)](0x5)[_0x5a1210(0x23e)]());else{if(_0x26ea49[_0x5a1210(0x34a)](_0x5a1210(0x287)))try{const _0x2b8dea=JSON[_0x5a1210(0x206)](_0x26ea49['substring'](0x8)[_0x5a1210(0x23e)]());handlePythonResult(_0x20d269,_0x2b8dea);}catch(_0x2eb0b4){_0x20d269[_0x5a1210(0x2eb)][_0x5a1210(0x1f2)](_0x5a1210(0x2c3)+_0x26ea49);}}(_0x26ea49[_0x5a1210(0x371)](_0x5a1210(0x248))||_0x26ea49[_0x5a1210(0x371)]('Bibliotheken\x20nicht\x20gefunden'))&&(_0x20d269['log']['warn'](_0x5a1210(0x37a)),installPythonDependencies(_0x20d269));});}),_0x20d269[_0x116664(0x238)]['stderr']['on'](_0x116664(0x343),_0x49cf7a=>{const _0x1c582e=_0x116664,_0x2c7a73=_0x49cf7a[_0x1c582e(0x2cb)]()[_0x1c582e(0x23e)]();if(!_0x2c7a73[_0x1c582e(0x371)]('cpu_feature_guard'))_0x20d269['log'][_0x1c582e(0x243)](_0x1c582e(0x268)+_0x2c7a73);}),_0x20d269[_0x116664(0x238)]['on'](_0x116664(0x2de),_0x2c7376=>{const _0x30e8ed=_0x116664;_0x20d269['log'][_0x30e8ed(0x2a6)](_0x30e8ed(0x366)+_0x2c7376),_0x20d269['pythonProcess']=null;});}catch(_0x4b2e99){_0x20d269[_0x116664(0x2eb)][_0x116664(0x243)]('Error\x20launching\x20Python:\x20'+_0x4b2e99[_0x116664(0x26c)]);}}function stopPythonService(_0xe92aef){const _0x556e88=a0_0x4579c0;if(_0xe92aef[_0x556e88(0x238)]){_0xe92aef['log'][_0x556e88(0x2a6)](_0x556e88(0x2b5));try{_0xe92aef[_0x556e88(0x238)][_0x556e88(0x34d)]();}catch(_0x5baeb6){}_0xe92aef[_0x556e88(0x238)]=null;}}function handlePythonResult(_0x4592b2,_0x5081ff){const _0x273d27=a0_0x4579c0;if(_0x5081ff[_0x273d27(0x251)]===_0x273d27(0x296))_0x4592b2[_0x273d27(0x2eb)][_0x273d27(0x322)](_0x273d27(0x292));else{if(_0x5081ff[_0x273d27(0x251)]===_0x273d27(0x27e)){const {anomaly_score:_0x450942,is_anomaly:_0xa591b3,threshold:_0x49a9b2}=_0x5081ff[_0x273d27(0x346)];_0x4592b2['log']['info']('ðŸ›¡ï¸\x20SECURITY\x20CHECK:\x20Score\x20'+_0x450942[_0x273d27(0x2f0)](0x5)+'\x20->\x20'+(_0xa591b3?_0x273d27(0x239):'OK')),_0x4592b2[_0x273d27(0x201)](_0x273d27(0x32a),{'val':_0x450942,'ack':!![]}),_0x4592b2[_0x273d27(0x201)]('analysis.security.lastCheck',{'val':new Date()['toISOString'](),'ack':!![]});if(_0xa591b3){const _0x5522b2=_0x273d27(0x397)+_0x450942[_0x273d27(0x2f0)](0x4)+')';_0x4592b2[_0x273d27(0x201)](_0x273d27(0x305),{'val':!![],'ack':!![]}),_0x4592b2[_0x273d27(0x201)]('analysis.alertReason',{'val':_0x5522b2,'ack':!![]}),sendNotification(_0x4592b2,_0x273d27(0x324)+_0x5522b2,![],!![]);}}else{if(_0x5081ff[_0x273d27(0x251)]===_0x273d27(0x2e2)){const {success:_0x3b48e7,details:_0xee698e}=_0x5081ff[_0x273d27(0x346)];_0x4592b2[_0x273d27(0x201)](_0x273d27(0x398),{'val':_0x3b48e7?_0x273d27(0x20d)+new Date()[_0x273d27(0x23b)]()+'\x20('+_0xee698e+')':'Failed:\x20'+_0xee698e,'ack':!![]});}else{if(_0x5081ff[_0x273d27(0x251)]===_0x273d27(0x22d)){const {success:_0x245cbf,details:_0xc8d712}=_0x5081ff['payload'];if(_0x245cbf)try{const _0x6fdcc0=JSON['parse'](_0xc8d712);if(_0x6fdcc0[_0x273d27(0x1fd)])_0x4592b2[_0x273d27(0x201)](_0x273d27(0x279),{'val':JSON['stringify'](_0x6fdcc0[_0x273d27(0x1fd)]),'ack':!![]});if(_0x6fdcc0[_0x273d27(0x259)])_0x4592b2[_0x273d27(0x201)](_0x273d27(0x384),{'val':JSON['stringify'](_0x6fdcc0[_0x273d27(0x259)]),'ack':!![]});}catch(_0x2186b2){}}else{if(_0x5081ff['type']===_0x273d27(0x271)){const {success:_0x419b4a,details:_0x18cf0b}=_0x5081ff['payload'];if(_0x419b4a)_0x4592b2['log'][_0x273d27(0x2a6)](_0x273d27(0x220)+_0x18cf0b);}else{if(_0x5081ff['type']===_0x273d27(0x241)){const {is_anomaly:_0xb3a404,details:_0x13a1a2}=_0x5081ff['payload'];_0x4592b2[_0x273d27(0x201)](_0x273d27(0x22e),{'val':new Date()[_0x273d27(0x349)](),'ack':!![]}),_0x4592b2['setStateAsync'](_0x273d27(0x2a3),{'val':_0xb3a404,'ack':!![]});}}}}}}}function sendToPython(_0x4534d5,_0x2910b8,_0x168e3c={}){const _0x233153=a0_0x4579c0;if(!_0x4534d5[_0x233153(0x238)]||!_0x4534d5[_0x233153(0x238)]['stdin'][_0x233153(0x2e1)])return;const _0x110957=JSON['stringify']({'command':_0x2910b8,..._0x168e3c});try{_0x4534d5[_0x233153(0x238)][_0x233153(0x320)][_0x233153(0x313)](_0x110957+'\x0a');}catch(_0xc1b49){}}async function scanForDevices(_0x26674c,_0x58f719){const _0x1ec262=a0_0x4579c0;_0x26674c['log'][_0x1ec262(0x2a6)](_0x1ec262(0x281));const _0x221436=[],_0x5f0ed6=await _0x26674c[_0x1ec262(0x25e)]('*'),_0x42e5d7=await _0x26674c[_0x1ec262(0x25e)]('enum.functions.*',_0x1ec262(0x340)),_0x70e43d=await _0x26674c[_0x1ec262(0x25e)]('enum.rooms.*','enum'),_0x3e68e1={};if(_0x42e5d7)for(const _0x459193 in _0x42e5d7){const _0x52f846=_0x42e5d7[_0x459193]['common'][_0x1ec262(0x38e)]||[];_0x52f846['forEach'](_0x4470da=>{const _0x4d3159=_0x1ec262;if(!_0x3e68e1[_0x4470da])_0x3e68e1[_0x4470da]=[];_0x3e68e1[_0x4470da][_0x4d3159(0x22a)](_0x459193);});}const _0xa3a7c3={};if(_0x70e43d)for(const _0x2882f1 in _0x70e43d){const _0x1390e3=_0x70e43d[_0x2882f1][_0x1ec262(0x2fd)][_0x1ec262(0x38e)]||[],_0x58c392=typeof _0x70e43d[_0x2882f1]['common'][_0x1ec262(0x2ee)]===_0x1ec262(0x385)?_0x70e43d[_0x2882f1][_0x1ec262(0x2fd)][_0x1ec262(0x2ee)]['de']:_0x70e43d[_0x2882f1][_0x1ec262(0x2fd)][_0x1ec262(0x2ee)];_0x1390e3['forEach'](_0x2ff267=>_0xa3a7c3[_0x2ff267]=_0x58c392);}const _0x1888c4=_0x58f719['motion']!==![],_0x1631d9=_0x58f719[_0x1ec262(0x382)]!==![],_0x3befa3=_0x58f719[_0x1ec262(0x2bc)]!==![],_0x593002=_0x58f719['temperature']===!![],_0x568716=_0x58f719['weather']===!![];for(const _0x55410c in _0x5f0ed6){const _0x2f8b97=_0x5f0ed6[_0x55410c];if(_0x2f8b97[_0x1ec262(0x251)]!=='state'||!_0x2f8b97[_0x1ec262(0x2fd)])continue;if(ADAPTER_BLACKLIST[_0x1ec262(0x277)](_0x55699a=>_0x55410c[_0x1ec262(0x34a)](_0x55699a))&&!_0x568716)continue;const _0xf0fb5f=(_0x2f8b97[_0x1ec262(0x2fd)]['role']||'')['toLowerCase']();let _0x5c1571=(typeof _0x2f8b97['common'][_0x1ec262(0x2ee)]===_0x1ec262(0x385)?_0x2f8b97[_0x1ec262(0x2fd)][_0x1ec262(0x2ee)]['de']:_0x2f8b97[_0x1ec262(0x2fd)][_0x1ec262(0x2ee)])||_0x55410c;const _0x332a2a=_0x5c1571[_0x1ec262(0x25c)]();let _0x32577e=![];if(_0x58f719[_0x1ec262(0x30f)]&&_0x58f719[_0x1ec262(0x30f)][_0x1ec262(0x23c)]>0x0){const _0x12e28f=_0x3e68e1[_0x55410c]||[],_0x44c11e=_0x55410c['split']('.')[_0x1ec262(0x314)](0x0,-0x1)[_0x1ec262(0x356)]('.'),_0x44e6fe=_0x3e68e1[_0x44c11e]||[];(_0x12e28f[_0x1ec262(0x277)](_0x51de9e=>_0x58f719[_0x1ec262(0x30f)][_0x1ec262(0x371)](_0x51de9e))||_0x44e6fe[_0x1ec262(0x277)](_0x8f7187=>_0x58f719[_0x1ec262(0x30f)][_0x1ec262(0x371)](_0x8f7187)))&&(_0x32577e=!![]);}if(_0x568716&&_0x55410c['includes'](_0x1ec262(0x353)))_0x32577e=!![];if(!_0x32577e&&!_0x568716){if(HARD_IGNORE_TERMS[_0x1ec262(0x277)](_0x3d2751=>_0x55410c['includes'](_0x3d2751)||_0x332a2a[_0x1ec262(0x371)](_0x3d2751['toLowerCase']())))continue;}let _0x17d48b='';if(_0x1888c4&&(_0xf0fb5f[_0x1ec262(0x371)]('motion')||_0xf0fb5f['includes'](_0x1ec262(0x211))))_0x17d48b='motion';else{if(_0x1631d9&&(_0xf0fb5f[_0x1ec262(0x371)](_0x1ec262(0x345))||_0xf0fb5f['includes'](_0x1ec262(0x203))))_0x17d48b=_0x1ec262(0x345);else{if(_0x3befa3&&(_0xf0fb5f[_0x1ec262(0x371)]('light')||_0xf0fb5f[_0x1ec262(0x371)]('switch')))_0x17d48b=_0x1ec262(0x20b);else{if(_0x593002&&(_0xf0fb5f['includes'](_0x1ec262(0x353))||_0xf0fb5f[_0x1ec262(0x371)]('humidity')))_0x17d48b=_0x1ec262(0x353);}}}if(_0x17d48b){let _0x53adba=_0xa3a7c3[_0x55410c]||'';if(!_0x53adba){let _0x240417=_0x55410c;for(let _0x4f7921=0x0;_0x4f7921<0x3;_0x4f7921++){const _0x15c04e=_0x240417[_0x1ec262(0x2ca)]('.');if(_0x15c04e===-0x1)break;_0x240417=_0x240417[_0x1ec262(0x222)](0x0,_0x15c04e);if(_0xa3a7c3[_0x240417]){_0x53adba=_0xa3a7c3[_0x240417];break;}}}_0x221436[_0x1ec262(0x22a)]({'id':_0x55410c,'name':_0x5c1571,'location':_0x53adba,'type':_0x17d48b,'logDuplicates':_0x17d48b===_0x1ec262(0x377),'isExit':![],'_score':_0x53adba?0x50:0x28});}}return _0x221436;}function a0_0x5bc6(_0x504b34,_0x365915){const _0x33ff71=a0_0x12aa();return a0_0x5bc6=function(_0x51e4bd,_0x5b0ca1){_0x51e4bd=_0x51e4bd-0x1f1;let _0x12aaeb=_0x33ff71[_0x51e4bd];return _0x12aaeb;},a0_0x5bc6(_0x504b34,_0x365915);}async function runGeminiAnalysis(_0x9ac444,_0x170cb5=''){const _0x2daf8f=a0_0x4579c0;if(!_0x9ac444[_0x2daf8f(0x207)])return;if(_0x9ac444[_0x2daf8f(0x2c7)][_0x2daf8f(0x23c)]===0x0)return;const _0x2e77f0=_0x9ac444[_0x2daf8f(0x2c7)][_0x2daf8f(0x314)](0x0,0xf),_0x1e0998=await getWeatherContext(_0x9ac444),_0x10e936=_0x9ac444[_0x2daf8f(0x323)],_0x1190bc=PERSONA_MAPPING[_0x9ac444[_0x2daf8f(0x294)][_0x2daf8f(0x270)]||_0x2daf8f(0x338)],_0x3e7049=_0x9ac444[_0x2daf8f(0x294)]['livingContext']||_0x2daf8f(0x223);let _0x490408='Unbekannt';try{const _0x823b0d=await _0x9ac444[_0x2daf8f(0x394)](_0x2daf8f(0x2bb));if(_0x823b0d&&_0x823b0d[_0x2daf8f(0x2c0)])_0x490408=_0x823b0d[_0x2daf8f(0x2c0)];}catch(_0x5c2250){}let _0x195526=![];try{const _0x19316b=await _0x9ac444[_0x2daf8f(0x394)]('analysis.automation.autoApply');if(_0x19316b&&_0x19316b['val'])_0x195526=!![];}catch(_0x1065d1){}const _0x742899=_0x2daf8f(0x1f4)+_0x1190bc+_0x2daf8f(0x28b)+_0x3e7049+_0x2daf8f(0x38f)+_0x10e936+_0x2daf8f(0x227)+_0x1e0998+'.\x20ANWESEND:\x20'+_0x490408+_0x2daf8f(0x327)+JSON[_0x2daf8f(0x37b)](_0x2e77f0)+_0x2daf8f(0x21f)+_0x170cb5+_0x2daf8f(0x2ec);try{const _0x368409=await _0x9ac444[_0x2daf8f(0x207)]['generateContent'](_0x742899),_0x430cf9=_0x368409[_0x2daf8f(0x29d)][_0x2daf8f(0x297)]()[_0x2daf8f(0x386)](/```json|```/g,'')['trim'](),_0x3de9e6=JSON[_0x2daf8f(0x206)](_0x430cf9);await _0x9ac444[_0x2daf8f(0x201)](_0x2daf8f(0x38c),{'val':JSON['stringify'](_0x3de9e6),'ack':!![]});if(_0x3de9e6[_0x2daf8f(0x2aa)])await _0x9ac444[_0x2daf8f(0x201)]('analysis.activitySummary',{'val':_0x3de9e6[_0x2daf8f(0x2aa)],'ack':!![]});const _0x10ed6f={'timestamp':Date[_0x2daf8f(0x2a5)](),'id':Date[_0x2daf8f(0x2a5)]()['toString'](),'analysis':{'activity':{'summary':_0x3de9e6[_0x2daf8f(0x2aa)],'isAlert':_0x3de9e6[_0x2daf8f(0x2db)],'alertReason':_0x3de9e6[_0x2daf8f(0x278)]},'comfort':{'automationProposal':_0x3de9e6[_0x2daf8f(0x358)]}}};await updateAnalysisHistory(_0x9ac444,_0x10ed6f);const _0x134247=_0x3de9e6[_0x2daf8f(0x2db)]||![];_0x134247!==_0x9ac444['lastAlertState']&&(await _0x9ac444[_0x2daf8f(0x201)](_0x2daf8f(0x305),{'val':_0x134247,'ack':!![]}),_0x9ac444['lastAlertState']=_0x134247,_0x134247&&(await _0x9ac444[_0x2daf8f(0x201)](_0x2daf8f(0x28c),{'val':_0x3de9e6[_0x2daf8f(0x278)],'ack':!![]}),sendNotification(_0x9ac444,_0x2daf8f(0x210)+_0x3de9e6[_0x2daf8f(0x278)],![],_0x3de9e6[_0x2daf8f(0x2c8)])));if(_0x3de9e6['automationProposal']&&_0x3de9e6[_0x2daf8f(0x358)][_0x2daf8f(0x39a)]){await _0x9ac444[_0x2daf8f(0x201)](_0x2daf8f(0x1f8),{'val':!![],'ack':!![]}),await _0x9ac444['setStateAsync'](_0x2daf8f(0x231),{'val':_0x3de9e6[_0x2daf8f(0x358)][_0x2daf8f(0x35d)],'ack':!![]}),await _0x9ac444[_0x2daf8f(0x201)](_0x2daf8f(0x2ae),{'val':_0x3de9e6[_0x2daf8f(0x358)]['targetId'],'ack':!![]}),await _0x9ac444['setStateAsync'](_0x2daf8f(0x246),{'val':JSON[_0x2daf8f(0x37b)](_0x3de9e6[_0x2daf8f(0x358)][_0x2daf8f(0x21b)]),'ack':!![]});if(_0x195526)executeAutomationAction(_0x9ac444);}}catch(_0x30d555){_0x9ac444[_0x2daf8f(0x2eb)]['error'](_0x2daf8f(0x36e)+_0x30d555['message']);}}async function getCalendarNames(_0xd8af1a,_0x4ee164){const _0x1706a5=a0_0x4579c0;try{const _0x31418c=await _0xd8af1a[_0x1706a5(0x33a)](_0x4ee164+_0x1706a5(0x289));if(_0x31418c&&_0x31418c[_0x1706a5(0x2c0)]){const _0x14b523=JSON[_0x1706a5(0x206)](_0x31418c[_0x1706a5(0x2c0)]);if(Array[_0x1706a5(0x23a)](_0x14b523))return[...new Set(_0x14b523['map'](_0x120c43=>_0x120c43['_calName'])[_0x1706a5(0x290)](Boolean))][_0x1706a5(0x1f3)]();}}catch(_0x21a1ad){}return[];}async function getCalendarContext(_0x11cbb2){const _0x267b53=a0_0x4579c0;if(!_0x11cbb2[_0x267b53(0x294)]['useCalendar'])return _0x267b53(0x374);const _0xc699c3=_0x11cbb2[_0x267b53(0x294)][_0x267b53(0x2b1)]||_0x267b53(0x29e);try{const _0x35f3bf=await _0x11cbb2[_0x267b53(0x33a)](_0xc699c3+_0x267b53(0x289));if(_0x35f3bf&&_0x35f3bf[_0x267b53(0x2c0)]){let _0x5d0fd6=JSON[_0x267b53(0x206)](_0x35f3bf[_0x267b53(0x2c0)]);if(Array[_0x267b53(0x23a)](_0x5d0fd6)){if(_0x5d0fd6[_0x267b53(0x23c)]>0x0)return _0x267b53(0x27d)+_0x5d0fd6[_0x267b53(0x314)](0x0,0x3)['map'](_0x502c4f=>_0x502c4f[_0x267b53(0x302)])[_0x267b53(0x356)](',\x20');}}}catch(_0x22a0bb){}return _0x267b53(0x224);}async function setupTelegramListener(_0x1aaf07){const _0x14cce2=a0_0x4579c0,_0x73c9c5=_0x1aaf07[_0x14cce2(0x294)][_0x14cce2(0x218)];_0x1aaf07[_0x14cce2(0x294)][_0x14cce2(0x205)]&&_0x73c9c5&&await _0x1aaf07[_0x14cce2(0x2e8)](_0x73c9c5+_0x14cce2(0x395));}async function handleTelegramResponse(_0x14170f,_0x2eed87){const _0x4c3729=a0_0x4579c0;let _0x5d63a0=_0x2eed87;_0x2eed87[_0x4c3729(0x34a)]('[')&&(_0x5d63a0=_0x2eed87[_0x4c3729(0x222)](_0x2eed87[_0x4c3729(0x2e7)](']')+0x1));if(_0x5d63a0===_0x4c3729(0x383))await _0x14170f['setStateAsync'](_0x4c3729(0x305),{'val':![],'ack':!![]}),await _0x14170f['setStateAsync']('analysis.alertReason',{'val':'Vom\x20Benutzer\x20bestÃ¤tigt\x20(OK).','ack':!![]}),_0x14170f[_0x4c3729(0x364)]=![],sendNotification(_0x14170f,_0x4c3729(0x267),![]);else _0x5d63a0===_0x4c3729(0x2dd)&&sendNotification(_0x14170f,'ðŸ“ž\x20RÃœCKRUF\x20BITTE!\x20Der\x20Bewohner\x20hat\x20den\x20RÃ¼ckruf-Button\x20gedrÃ¼ckt.',![],!![]);}async function checkWifiPresence(_0x2c6a1c){const _0x1790cd=a0_0x4579c0;try{const _0x194fbb=_0x2c6a1c[_0x1790cd(0x294)][_0x1790cd(0x2b6)]||[];let _0x30946b=![];const _0x45568a=[];for(const _0x7553f1 of _0x194fbb){try{const _0x804c22=await _0x2c6a1c[_0x1790cd(0x33a)](_0x7553f1);if(_0x804c22&&(_0x804c22[_0x1790cd(0x2c0)]===!![]||_0x804c22[_0x1790cd(0x2c0)]===_0x1790cd(0x33f)||_0x804c22[_0x1790cd(0x2c0)]===0x1)){_0x30946b=!![];const _0x13ab0c=await _0x2c6a1c['getForeignObjectAsync'](_0x7553f1);let _0x1557e6=_0x7553f1;_0x13ab0c&&_0x13ab0c['common']&&_0x13ab0c['common'][_0x1790cd(0x2ee)]&&(_0x1557e6=typeof _0x13ab0c[_0x1790cd(0x2fd)][_0x1790cd(0x2ee)]===_0x1790cd(0x385)?_0x13ab0c[_0x1790cd(0x2fd)][_0x1790cd(0x2ee)]['de']||_0x13ab0c[_0x1790cd(0x2fd)][_0x1790cd(0x2ee)]['en']:_0x13ab0c[_0x1790cd(0x2fd)][_0x1790cd(0x2ee)]),_0x45568a[_0x1790cd(0x22a)](_0x1557e6);}}catch(_0xa613b2){}}return await _0x2c6a1c['setStateAsync']('system.presenceWho',{'val':_0x45568a[_0x1790cd(0x356)](',\x20'),'ack':!![]}),_0x30946b&&(_0x2c6a1c['exitTimer']&&(_0x2c6a1c[_0x1790cd(0x2eb)][_0x1790cd(0x2a6)]('WiFi\x20Presence\x20detected\x20->\x20Aborting\x20Exit\x20Timer.\x20User\x20is\x20present.'),abortExitTimer(_0x2c6a1c)),!_0x2c6a1c[_0x1790cd(0x34e)]&&_0x2c6a1c[_0x1790cd(0x323)]===SYSTEM_MODES[_0x1790cd(0x33c)]&&await setPresence(_0x2c6a1c,!![])),_0x30946b;}catch(_0x79360c){return _0x2c6a1c[_0x1790cd(0x2eb)][_0x1790cd(0x243)](_0x1790cd(0x2ba)+_0x79360c[_0x1790cd(0x26c)]),![];}}function startExitTimer(_0x4e3859){const _0x21e658=a0_0x4579c0;abortExitTimer(_0x4e3859),_0x4e3859[_0x21e658(0x24f)]=!![],_0x4e3859[_0x21e658(0x240)]=setTimeout(()=>{const _0x2b59b2=_0x21e658;_0x4e3859[_0x2b59b2(0x24f)]=![];},EXIT_GRACE_PERIOD_SECONDS*0x3e8),_0x4e3859[_0x21e658(0x219)]=setTimeout(()=>{const _0x490198=_0x21e658;setPresence(_0x4e3859,![]),_0x4e3859[_0x490198(0x219)]=null;},EXIT_TIMER_MINUTES*0x3c*0x3e8);}function abortExitTimer(_0x3b201d){const _0x564a86=a0_0x4579c0;if(_0x3b201d[_0x564a86(0x219)])clearTimeout(_0x3b201d[_0x564a86(0x219)]);if(_0x3b201d['exitGraceTimer'])clearTimeout(_0x3b201d[_0x564a86(0x240)]);_0x3b201d['exitTimer']=null,_0x3b201d[_0x564a86(0x240)]=null,_0x3b201d[_0x564a86(0x24f)]=![];}async function setPresence(_0x53a24b,_0x5aae18){const _0x509103=a0_0x4579c0;if(_0x53a24b[_0x509103(0x34e)]===_0x5aae18)return;_0x53a24b[_0x509103(0x34e)]=_0x5aae18,await _0x53a24b[_0x509103(0x201)](_0x509103(0x312),{'val':_0x5aae18,'ack':!![]});}async function executeAutomationAction(_0x782c8e){const _0x4fceb7=a0_0x4579c0;try{const _0x47716f=await _0x782c8e['getStateAsync']('analysis.automation.targetId'),_0x3f6757=await _0x782c8e['getStateAsync'](_0x4fceb7(0x246));if(_0x47716f&&_0x47716f[_0x4fceb7(0x2c0)]&&_0x3f6757){const _0x2e985d=_0x47716f[_0x4fceb7(0x2c0)];let _0x2a42d5=_0x3f6757[_0x4fceb7(0x2c0)];try{_0x2a42d5=JSON[_0x4fceb7(0x206)](_0x2a42d5);}catch(_0x7b163f){}_0x782c8e[_0x4fceb7(0x2eb)][_0x4fceb7(0x2a6)](_0x4fceb7(0x2d8)+_0x2e985d+'\x20=\x20'+_0x2a42d5),await _0x782c8e['setForeignStateAsync'](_0x2e985d,_0x2a42d5);}else _0x782c8e[_0x4fceb7(0x2eb)]['warn'](_0x4fceb7(0x283));}catch(_0x5c9f11){_0x782c8e[_0x4fceb7(0x2eb)][_0x4fceb7(0x243)](_0x4fceb7(0x276)+_0x5c9f11[_0x4fceb7(0x26c)]);}}async function runBaselineDriftAnalysis(_0x5e0ac){}async function sendMorningBriefing(_0x1487c7){}class CogniLiving extends utils[a0_0x4579c0(0x23f)]{constructor(_0x5ed284){const _0xdfcdd7=a0_0x4579c0;super({..._0x5ed284,'name':'cogni-living'}),this[_0xdfcdd7(0x2c7)]=[],this['analysisHistory']=[],this['rawEventLog']=[],this[_0xdfcdd7(0x350)]=[],this[_0xdfcdd7(0x1f1)]={},this['systemConfig']={'latitude':0x0,'longitude':0x0,'city':''},this[_0xdfcdd7(0x34e)]=!![],this[_0xdfcdd7(0x219)]=null,this[_0xdfcdd7(0x240)]=null,this['isGracePeriodActive']=![],this[_0xdfcdd7(0x20e)]=null,this[_0xdfcdd7(0x207)]=null,this[_0xdfcdd7(0x323)]=SYSTEM_MODES['NORMAL'],this[_0xdfcdd7(0x260)]=![],this[_0xdfcdd7(0x364)]=![],this[_0xdfcdd7(0x2bf)]=_0xdfcdd7(0x21e),this[_0xdfcdd7(0x286)]=null,this[_0xdfcdd7(0x33d)]=null,this[_0xdfcdd7(0x2a4)]=null,this[_0xdfcdd7(0x274)]=null,this[_0xdfcdd7(0x33e)]=null,this[_0xdfcdd7(0x238)]=null,this[_0xdfcdd7(0x293)]=![],this['on']('ready',this[_0xdfcdd7(0x390)][_0xdfcdd7(0x378)](this)),this['on'](_0xdfcdd7(0x380),this[_0xdfcdd7(0x319)][_0xdfcdd7(0x378)](this)),this['on'](_0xdfcdd7(0x311),this['onUnload'][_0xdfcdd7(0x378)](this)),this['on'](_0xdfcdd7(0x26c),this[_0xdfcdd7(0x2c4)][_0xdfcdd7(0x378)](this));}async[a0_0x4579c0(0x390)](){const _0x35a776=a0_0x4579c0;this[_0x35a776(0x2eb)]['info'](_0x35a776(0x216)+this[_0x35a776(0x37f)]+_0x35a776(0x330)),await initZombies(this);try{this['isProVersion']=await checkLicense(this,this[_0x35a776(0x294)]['licenseKey']);}catch(_0x4a48a7){}if(!this['config'][_0x35a776(0x2cc)]||this[_0x35a776(0x294)][_0x35a776(0x2cc)]<0.1)this[_0x35a776(0x294)]['inactivityThresholdHours']=0xc;await initHistory(this),await initSystemConfig(this);if(this[_0x35a776(0x294)][_0x35a776(0x2c2)])try{this[_0x35a776(0x20e)]=new GoogleGenerativeAI(this[_0x35a776(0x294)][_0x35a776(0x2c2)]),this['geminiModel']=this[_0x35a776(0x20e)][_0x35a776(0x282)]({'model':GEMINI_MODEL,'generationConfig':{'responseMimeType':_0x35a776(0x258)}}),this['log'][_0x35a776(0x2a6)](_0x35a776(0x250));}catch(_0x304329){this[_0x35a776(0x2eb)][_0x35a776(0x243)]('Gemini\x20Init\x20Error:\x20'+_0x304329[_0x35a776(0x26c)]);}await createAllObjects(this),await loadSystemMode(this),await loadRawEventLog(this),await loadDailyDigests(this),this[_0x35a776(0x35f)]('analysis.trigger'),this[_0x35a776(0x35f)](LTM_DP_TRIGGER_DIGEST),this['subscribeStates'](_0x35a776(0x35e)),this[_0x35a776(0x35f)](_0x35a776(0x2b9)),this[_0x35a776(0x35f)](_0x35a776(0x245)),this[_0x35a776(0x35f)]('analysis.automation.autoApply'),this[_0x35a776(0x35f)](_0x35a776(0x221)),this[_0x35a776(0x35f)](_0x35a776(0x254)),this[_0x35a776(0x35f)](_0x35a776(0x263)),await initSensorSubscriptions(this),await initPresenceSubscriptions(this),await setupTelegramListener(this),setTimeout(()=>checkWifiPresence(this),0x1388);if(this[_0x35a776(0x286)])clearInterval(this[_0x35a776(0x286)]);const _0x2607dd=this[_0x35a776(0x294)]['analysisInterval']||0xf;_0x2607dd>0x0&&(this['analysisTimer']=setInterval(()=>{runAutopilot(this);},_0x2607dd*0x3c*0x3e8)),setupLtmScheduler(this),setupModeResetScheduler(this),setupDriftAnalysisScheduler(this),setupBriefingScheduler(this),startPythonService(this),setTimeout(()=>{const _0x3a2cb1=_0x35a776;if(this[_0x3a2cb1(0x238)])runPythonHealthCheck(this);},0x1388);}[a0_0x4579c0(0x2ac)](_0x4e8d00){const _0x593aa1=a0_0x4579c0;if(this[_0x593aa1(0x286)])clearInterval(this['analysisTimer']);if(this[_0x593aa1(0x274)])clearInterval(this[_0x593aa1(0x274)]);if(this[_0x593aa1(0x33d)])this[_0x593aa1(0x33d)][_0x593aa1(0x236)]();if(this[_0x593aa1(0x2a4)])this[_0x593aa1(0x2a4)][_0x593aa1(0x236)]();if(this['briefingJob'])this[_0x593aa1(0x33e)][_0x593aa1(0x236)]();if(this[_0x593aa1(0x219)])clearTimeout(this['exitTimer']);if(this[_0x593aa1(0x240)])clearTimeout(this[_0x593aa1(0x240)]);stopPythonService(this),_0x4e8d00();}async[a0_0x4579c0(0x319)](_0x3fff59,_0x4a5109){const _0x130ba5=a0_0x4579c0;if(!_0x4a5109||this[_0x130ba5(0x293)])return;if(_0x3fff59[_0x130ba5(0x371)](_0x130ba5(0x375))&&_0x3fff59['endsWith']('communicate.request')&&_0x4a5109['val']){await handleTelegramResponse(this,_0x4a5109[_0x130ba5(0x2c0)]);return;}if(_0x3fff59===this[_0x130ba5(0x30c)]+'.'+SYSTEM_DP_MODE){if(_0x4a5109[_0x130ba5(0x2c0)]&&Object[_0x130ba5(0x24d)](SYSTEM_MODES)['includes'](_0x4a5109['val'])){this[_0x130ba5(0x323)]=_0x4a5109[_0x130ba5(0x2c0)];if(_0x4a5109['val']===SYSTEM_MODES[_0x130ba5(0x331)])await setPresence(this,![]);else await setPresence(this,!![]);}if(!_0x4a5109['ack'])this['setState'](_0x3fff59,{'val':this['currentSystemMode'],'ack':!![]});return;}if(!_0x4a5109[_0x130ba5(0x26f)]){_0x3fff59[_0x130ba5(0x371)](_0x130ba5(0x1f9))&&_0x4a5109[_0x130ba5(0x2c0)]&&(this[_0x130ba5(0x1f7)](_0x3fff59,{'val':![],'ack':!![]}),runGeminiAnalysis(this));if(_0x3fff59[_0x130ba5(0x371)](_0x130ba5(0x355))&&_0x4a5109[_0x130ba5(0x2c0)]){this[_0x130ba5(0x1f7)](_0x3fff59,{'val':![],'ack':!![]});if(this[_0x130ba5(0x260)])createDailyDigest(this);}_0x3fff59[_0x130ba5(0x371)](_0x130ba5(0x28d))&&_0x4a5109[_0x130ba5(0x2c0)]&&(this[_0x130ba5(0x1f7)](_0x3fff59,{'val':![],'ack':!![]}),sendMorningBriefing(this));_0x3fff59['includes'](_0x130ba5(0x359))&&_0x4a5109[_0x130ba5(0x2c0)]&&(this[_0x130ba5(0x1f7)](_0x3fff59,{'val':![],'ack':!![]}),executeAutomationAction(this));if(_0x3fff59['includes'](_0x130ba5(0x221))&&_0x4a5109[_0x130ba5(0x2c0)]){this[_0x130ba5(0x1f7)](_0x3fff59,{'val':![],'ack':!![]});if(this[_0x130ba5(0x260)])try{const _0x257596=await this[_0x130ba5(0x394)](_0x130ba5(0x329));if(_0x257596&&_0x257596[_0x130ba5(0x2c0)]){const _0x440eee=JSON['parse'](_0x257596[_0x130ba5(0x2c0)]);this['log'][_0x130ba5(0x2a6)](_0x130ba5(0x235)),this[_0x130ba5(0x201)](_0x130ba5(0x398),{'val':_0x130ba5(0x252),'ack':!![]}),sendToPython(this,'TRAIN_SECURITY',{'sequences':_0x440eee});}}catch(_0x16ddba){this[_0x130ba5(0x2eb)]['error'](_0x130ba5(0x300)+_0x16ddba[_0x130ba5(0x26c)]);}}if(_0x3fff59[_0x130ba5(0x371)](_0x130ba5(0x254))&&_0x4a5109['val']){this[_0x130ba5(0x1f7)](_0x3fff59,{'val':![],'ack':!![]});if(this[_0x130ba5(0x260)])try{const _0x3fc827=await this[_0x130ba5(0x394)](LTM_DP_DAILY_DIGESTS);if(_0x3fc827&&_0x3fc827[_0x130ba5(0x2c0)])sendToPython(this,'TRAIN_HEALTH',{'digests':JSON['parse'](_0x3fc827[_0x130ba5(0x2c0)])});}catch(_0x2a57d5){}}if(_0x3fff59[_0x130ba5(0x371)](_0x130ba5(0x263))&&_0x4a5109[_0x130ba5(0x2c0)]){this[_0x130ba5(0x1f7)](_0x3fff59,{'val':![],'ack':!![]});if(this[_0x130ba5(0x260)])try{const _0x39bf1b=await this[_0x130ba5(0x394)](_0x130ba5(0x20f));if(_0x39bf1b&&_0x39bf1b[_0x130ba5(0x2c0)])sendToPython(this,'TRAIN_ENERGY',{'points':JSON[_0x130ba5(0x206)](_0x39bf1b['val'])});}catch(_0x1f8a5a){}}return;}if(this[_0x130ba5(0x294)]['presenceDevices']&&this['config']['presenceDevices'][_0x130ba5(0x371)](_0x3fff59)){await checkWifiPresence(this);return;}const _0x442f12=(this['config'][_0x130ba5(0x237)]||[])[_0x130ba5(0x273)](_0x195f09=>_0x195f09['id']===_0x3fff59);if(_0x442f12)processSensorEvent(this,_0x3fff59,_0x4a5109,_0x442f12);}async[a0_0x4579c0(0x2c4)](_0x5d3250){const _0xae55f0=a0_0x4579c0;if(typeof _0x5d3250==='object'&&_0x5d3250[_0xae55f0(0x26c)]){if(_0x5d3250[_0xae55f0(0x32f)]===_0xae55f0(0x2c6)){const _0x282c1e=_0x5d3250[_0xae55f0(0x26c)]['apiKey']||this['config'][_0xae55f0(0x2c2)];if(!_0x282c1e)return this[_0xae55f0(0x357)](_0x5d3250[_0xae55f0(0x2df)],_0x5d3250['command'],{'success':![],'message':_0xae55f0(0x2cd)},_0x5d3250[_0xae55f0(0x253)]);try{const _0x521ff0=new GoogleGenerativeAI(_0x282c1e),_0x3a67e0=_0x521ff0[_0xae55f0(0x282)]({'model':GEMINI_MODEL}),_0x5cdf77=await _0x3a67e0[_0xae55f0(0x1fb)]('Hi');this['sendTo'](_0x5d3250[_0xae55f0(0x2df)],_0x5d3250[_0xae55f0(0x32f)],{'success':!![],'message':'OK:\x20'+_0x5cdf77[_0xae55f0(0x29d)][_0xae55f0(0x297)]()},_0x5d3250[_0xae55f0(0x253)]);}catch(_0x11cb1b){this['sendTo'](_0x5d3250[_0xae55f0(0x2df)],_0x5d3250['command'],{'success':![],'message':_0xae55f0(0x317)+_0x11cb1b[_0xae55f0(0x26c)]},_0x5d3250[_0xae55f0(0x253)]);}}else{if(_0x5d3250[_0xae55f0(0x32f)]==='testContext'){const _0x22b188=await getWeatherContext(this),_0x3d9b5d=await getCalendarContext(this);this['sendTo'](_0x5d3250[_0xae55f0(0x2df)],_0x5d3250['command'],{'success':!![],'weather':_0x22b188,'calendar':_0x3d9b5d},_0x5d3250['callback']);}else{if(_0x5d3250[_0xae55f0(0x32f)]==='getLtmData'){if(!this['isProVersion'])return this['sendTo'](_0x5d3250[_0xae55f0(0x2df)],_0x5d3250[_0xae55f0(0x32f)],{'success':![],'isPro':![]},_0x5d3250[_0xae55f0(0x253)]);let _0x31de54={'status':'N/A'};try{const _0x112385=await this[_0xae55f0(0x394)](LTM_DP_DRIFT_STATUS);_0x31de54[_0xae55f0(0x339)]=_0x112385?_0x112385['val']:_0xae55f0(0x2ef);}catch(_0x1f7826){}this['sendTo'](_0x5d3250[_0xae55f0(0x2df)],_0x5d3250[_0xae55f0(0x32f)],{'success':!![],'isPro':!![],'dailyDigests':this[_0xae55f0(0x350)],'driftAnalysis':_0x31de54,'analysisHistory':this[_0xae55f0(0x21a)]},_0x5d3250[_0xae55f0(0x253)]);}else{if(_0x5d3250[_0xae55f0(0x32f)]===_0xae55f0(0x228)){const _0x588714=this['dailyDigests'][_0xae55f0(0x23c)],_0x2cc78d=new Date(),_0x119130=new Date(_0x2cc78d[_0xae55f0(0x26d)](),_0x2cc78d['getMonth'](),_0x2cc78d[_0xae55f0(0x333)]())[_0xae55f0(0x35a)](),_0x39e346=this[_0xae55f0(0x34f)][_0xae55f0(0x290)](_0x2d211b=>new Date(_0x2d211b[_0xae55f0(0x25b)])['getTime']()>_0x119130)[_0xae55f0(0x23c)],_0x4634ad=new Array(0x18)['fill'](0x0);this['rawEventLog'][_0xae55f0(0x354)](_0x3e9dfc=>{const _0x58ff3f=_0xae55f0,_0x1ba534=new Date(_0x3e9dfc[_0x58ff3f(0x25b)]);if(_0x1ba534[_0x58ff3f(0x35a)]()>_0x119130)_0x4634ad[_0x1ba534['getHours']()]++;});let _0x5ecdf6={'status':'N/A'};try{const _0x4aaa6e=await this[_0xae55f0(0x394)](LTM_DP_DRIFT_STATUS);_0x5ecdf6[_0xae55f0(0x339)]=_0x4aaa6e?_0x4aaa6e[_0xae55f0(0x2c0)]:_0xae55f0(0x2ef);}catch(_0x434a6b){}let _0x1f5d53='';try{const _0x2a4374=await this[_0xae55f0(0x394)]('system.presenceWho');_0x1f5d53=_0x2a4374?_0x2a4374['val']:'';}catch(_0x3e5393){}let _0x30ceae=null;!this['geminiModel']&&(_0x30ceae=this['config']['geminiApiKey']?_0xae55f0(0x318):_0xae55f0(0x249));let _0x54c962={'detected':![],'description':'','targetId':'','targetValue':'','autoApply':![]};try{const _0xb79656=await this[_0xae55f0(0x394)](_0xae55f0(0x1f8));if(_0xb79656&&_0xb79656[_0xae55f0(0x2c0)]){_0x54c962['detected']=!![];const _0x3cf10f=await this[_0xae55f0(0x394)](_0xae55f0(0x231));_0x54c962[_0xae55f0(0x35d)]=_0x3cf10f?_0x3cf10f[_0xae55f0(0x2c0)]:'';const _0x454e1d=await this['getStateAsync'](_0xae55f0(0x2ae));_0x54c962['targetId']=_0x454e1d?_0x454e1d['val']:'';const _0x2f22e6=await this[_0xae55f0(0x394)]('analysis.automation.targetValue');_0x54c962[_0xae55f0(0x21b)]=_0x2f22e6?_0x2f22e6[_0xae55f0(0x2c0)]:'';}const _0x28a1bb=await this['getStateAsync'](_0xae55f0(0x376));_0x54c962[_0xae55f0(0x2b8)]=_0x28a1bb?!!_0x28a1bb['val']:![];}catch(_0x3a6f29){}this['sendTo'](_0x5d3250[_0xae55f0(0x2df)],_0x5d3250[_0xae55f0(0x32f)],{'success':!![],'eventHistory':this[_0xae55f0(0x2c7)][_0xae55f0(0x314)](0x0,0xf),'stats':{'digestCount':_0x588714,'eventCountToday':_0x39e346,'hourlyActivity':_0x4634ad,'driftStatus':_0x5ecdf6[_0xae55f0(0x339)],'isPresent':this['isPresent'],'presenceWho':_0x1f5d53,'minDays':this['config'][_0xae55f0(0x316)]||0x7,'stbDays':this[_0xae55f0(0x294)][_0xae55f0(0x209)]||0xe,'ltbDays':this[_0xae55f0(0x294)][_0xae55f0(0x204)]||0x3c,'systemError':_0x30ceae},'automation':_0x54c962},_0x5d3250[_0xae55f0(0x253)]);}else{if(_0x5d3250[_0xae55f0(0x32f)]==='scanDevices')try{const _0x175639=await scanForDevices(this,_0x5d3250['message']||{});this['sendTo'](_0x5d3250['from'],_0x5d3250['command'],{'success':!![],'devices':_0x175639},_0x5d3250['callback']);}catch(_0x4a11aa){this[_0xae55f0(0x357)](_0x5d3250['from'],_0x5d3250[_0xae55f0(0x32f)],{'success':![],'error':_0x4a11aa[_0xae55f0(0x26c)]},_0x5d3250[_0xae55f0(0x253)]);}else{if(_0x5d3250[_0xae55f0(0x32f)]===_0xae55f0(0x2d1)){const _0xb0ae16=await this[_0xae55f0(0x25e)](_0xae55f0(0x21d),'enum'),_0x11b0a6=[];if(_0xb0ae16)for(const _0x2f399a in _0xb0ae16){const _0x358232=_0xb0ae16[_0x2f399a],_0xbeb9cf=(_0x358232[_0xae55f0(0x2fd)]&&typeof _0x358232[_0xae55f0(0x2fd)]['name']===_0xae55f0(0x385)?_0x358232[_0xae55f0(0x2fd)][_0xae55f0(0x2ee)]['de']:_0x358232['common']['name'])||_0x358232[_0xae55f0(0x2fd)][_0xae55f0(0x2ee)];_0x11b0a6[_0xae55f0(0x22a)]({'id':_0x2f399a,'name':_0xbeb9cf});}this[_0xae55f0(0x357)](_0x5d3250[_0xae55f0(0x2df)],_0x5d3250[_0xae55f0(0x32f)],{'success':!![],'enums':_0x11b0a6},_0x5d3250[_0xae55f0(0x253)]);}else{if(_0x5d3250[_0xae55f0(0x32f)]===_0xae55f0(0x1fa)){const _0x3e383f=_0x5d3250[_0xae55f0(0x26c)][_0xae55f0(0x2c5)];if(!_0x3e383f)return this[_0xae55f0(0x357)](_0x5d3250['from'],_0x5d3250[_0xae55f0(0x32f)],{'success':![],'error':_0xae55f0(0x36c)},_0x5d3250['callback']);const _0x3888af=await getCalendarNames(this,_0x3e383f);this[_0xae55f0(0x357)](_0x5d3250[_0xae55f0(0x2df)],_0x5d3250[_0xae55f0(0x32f)],{'success':!![],'names':_0x3888af},_0x5d3250[_0xae55f0(0x253)]);}else{if(_0x5d3250[_0xae55f0(0x32f)]===_0xae55f0(0x28f)){const {targetId:_0x14a7c5,targetValue:_0x52cdd0}=_0x5d3250[_0xae55f0(0x26c)];this[_0xae55f0(0x2eb)][_0xae55f0(0x2a6)](_0xae55f0(0x362)+_0x14a7c5+_0xae55f0(0x28e)+_0x52cdd0),await this[_0xae55f0(0x201)]('analysis.automation.patternDetected',{'val':!![],'ack':!![]}),await this[_0xae55f0(0x201)](_0xae55f0(0x231),{'val':'SIMULATION:\x20Test-Vorschlag\x20fÃ¼r\x20'+_0x14a7c5,'ack':!![]}),await this['setStateAsync'](_0xae55f0(0x2ae),{'val':_0x14a7c5,'ack':!![]}),await this['setStateAsync']('analysis.automation.targetValue',{'val':_0x52cdd0,'ack':!![]}),this[_0xae55f0(0x357)](_0x5d3250[_0xae55f0(0x2df)],_0x5d3250[_0xae55f0(0x32f)],{'success':!![]},_0x5d3250['callback']);}else{if(_0x5d3250['command']===_0xae55f0(0x2d3)){const {historyId:_0x2968db,rating:_0x41b650,comment:_0x23584c,alertReason:_0x314079}=_0x5d3250[_0xae55f0(0x26c)];_0x2968db&&_0x41b650?(await saveFeedback(this,{'timestamp':Date[_0xae55f0(0x2a5)](),'historyId':_0x2968db,'rating':_0x41b650,'comment':_0x23584c,'alertReason':_0x314079}),this[_0xae55f0(0x357)](_0x5d3250[_0xae55f0(0x2df)],_0x5d3250[_0xae55f0(0x32f)],{'success':!![]},_0x5d3250[_0xae55f0(0x253)])):this[_0xae55f0(0x357)](_0x5d3250['from'],_0x5d3250[_0xae55f0(0x32f)],{'success':![],'error':_0xae55f0(0x2ed)},_0x5d3250['callback']);}else _0x5d3250[_0xae55f0(0x32f)]===_0xae55f0(0x373)&&(this['log'][_0xae55f0(0x2a6)]('User\x20dismissed\x20automation\x20proposal.'),await this[_0xae55f0(0x201)](_0xae55f0(0x1f8),{'val':![],'ack':!![]}),await this[_0xae55f0(0x201)](_0xae55f0(0x231),{'val':'','ack':!![]}),this[_0xae55f0(0x357)](_0x5d3250['from'],_0x5d3250[_0xae55f0(0x32f)],{'success':!![]},_0x5d3250[_0xae55f0(0x253)]));}}}}}}}}}}}if(require[a0_0x4579c0(0x242)]!==module)module[a0_0x4579c0(0x36f)]=_0x1f439d=>new CogniLiving(_0x1f439d);else new CogniLiving();