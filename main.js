const a0_0x219a46=a0_0x56e6;(function(_0x4d968c,_0x1bab65){const _0x5d971a=a0_0x56e6,_0x4953e8=_0x4d968c();while(!![]){try{const _0x47150c=-parseInt(_0x5d971a(0x26f))/0x1*(parseInt(_0x5d971a(0x1f2))/0x2)+-parseInt(_0x5d971a(0x260))/0x3*(-parseInt(_0x5d971a(0x2c7))/0x4)+-parseInt(_0x5d971a(0x220))/0x5+parseInt(_0x5d971a(0x29c))/0x6*(parseInt(_0x5d971a(0x2b9))/0x7)+-parseInt(_0x5d971a(0x20b))/0x8*(-parseInt(_0x5d971a(0x251))/0x9)+parseInt(_0x5d971a(0x28d))/0xa*(parseInt(_0x5d971a(0x23d))/0xb)+parseInt(_0x5d971a(0x2ba))/0xc*(-parseInt(_0x5d971a(0x29f))/0xd);if(_0x47150c===_0x1bab65)break;else _0x4953e8['push'](_0x4953e8['shift']());}catch(_0x4bc585){_0x4953e8['push'](_0x4953e8['shift']());}}}(a0_0xdd0f,0xdcd1d));const a0_0x12a4ba=(function(){let _0xfcfd53=!![];return function(_0x2618df,_0x27ab88){const _0x3b7082=_0xfcfd53?function(){if(_0x27ab88){const _0x3a892f=_0x27ab88['apply'](_0x2618df,arguments);return _0x27ab88=null,_0x3a892f;}}:function(){};return _0xfcfd53=![],_0x3b7082;};}()),a0_0x22abb0=a0_0x12a4ba(this,function(){const _0xa34571=a0_0x56e6;return a0_0x22abb0[_0xa34571(0x285)]()[_0xa34571(0x2bd)](_0xa34571(0x2ab))[_0xa34571(0x285)]()[_0xa34571(0x265)](a0_0x22abb0)[_0xa34571(0x2bd)](_0xa34571(0x2ab));});a0_0x22abb0();function a0_0x56e6(_0x2158af,_0x214a5e){const _0x4f1707=a0_0xdd0f();return a0_0x56e6=function(_0x22abb0,_0x12a4ba){_0x22abb0=_0x22abb0-0x1ee;let _0xdd0f4=_0x4f1707[_0x22abb0];return _0xdd0f4;},a0_0x56e6(_0x2158af,_0x214a5e);}function a0_0xdd0f(){const _0xee258f=['./lib/ai_agent','./lib/installer','telegram','onReady','isGracePeriodActive','getLtmData','onStateChange','ack','toString','add','matrix','runGeminiAnalysis','pop','./lib/dead_man','length','send','220wLWYKy','sensorLastValues','sort','debug','getHours','triggerDailyDigest','setupDriftAnalysisScheduler','includes','find','enum.rooms.*','LTM.dailyDigests','Verbindung\x20erfolgreich!','.communicate.request','Adapter','ðŸ””\x20Dies\x20ist\x20ein\x20Test\x20von\x20Cogni-Living.','6CwNwen','inactivityThresholdHours','genAI','13vmFubP','initHistory','Notification\x20Test\x20Failed:\x20','presenceDevices','eventHistory','system.mode','Verbunden','version','models/gemini-flash-latest','type','log','Sec-Training\x20started...','(((.+)+)+)+$','bind','\x20Tage)','location','timestamp','sendMorningBriefing','updated','analysis.training.status','val','briefingJob','onUnload','setHours','geminiApiKey','online','12283103ZXaFYW','15941064VGDdOj','ANALYZE_GAIT','triggerEnergyPrediction','search','instance','startService','.data.table','./lib/scanner','forEach','@google/generative-ai','Standard','fill','getOutsideTemperatureNumeric','51160uEhRWm','config','checkWifiPresence','common','setStateAsync','toLowerCase','Lernphase\x20(','./lib/recorder','updateHealthVector','524126zxDGoE','_calName','getStateAsync','slice','checkAndInstall','response','SET_TOPOLOGY','./lib/topology','devices','geminiModel','Activity-Level','LTM.trainingData.sequences','subscribeForeignStatesAsync','analysis.training.triggerSecurity','Daten\x20nicht\x20verfÃ¼gbar','message','analysisTimer','getForeignObjectAsync','getTime','isProVersion','abortExitTimer','ANALYZE_TREND','push','initSystemConfig','testApiKey','3032LJuQmw','analysis.training.triggerEnergy','exitGraceTimer','onMessage','analysis.health.todayVector','setPresence','dailyDigests','setState','LTM.trainingData.thermodynamics','system.adapter.','checkLicense','PYTHON_EXE','minDaysForBaseline','triggerBriefing','apiKey','exitTimer','split','runPythonHealthCheck','NORMAL','info','Instanz\x20nicht\x20gefunden','7231610tJNoWK','Keine\x20Antwort\x20von\x20Gemini','unload','floor','application/json','analysis.training.triggerComfort','stateChange','TRAIN_COMFORT','communicate.request','triggerGaitAnalysis','Test','error','system.presenceWho','PREDICT_ENERGY','WiFi\x20Presence\x20detected.','analysis.training.triggerTopology','runAutopilot','updateTopologyMatrix','cancel','name','SYSTEM_MODES',')\x20-\x20Phase\x20C\x20(Hardened)','ðŸ¤–\x20Autopilot:\x20Running\x20periodic\x20analysis...','exports','now','motion','subscribeStates','getForeignStateAsync','enum','502007yxKUZB','analysis.topology.structure','analysis.automation.triggerAction','analysis.trigger','loadSystemMode','./lib/setup','automation.triggerAction','sendNotification','ltmJob','notifyTelegramInstance','./lib/scheduler','rawEventLog','executeAutomationAction','Aktiv\x20(','scanDevices','testContext','driftAnalysisTimer','getOverviewData','from','activityLevel','19881cMjKDc','systemConfig','join','Gesendet','dependencyInstallInProgress','command','LTM.rawEventLog','keys','.system.mode','analysisInterval','Fehler:\x20','processSensorEvent','cogni-living\x20adapter\x20starting\x20(v','getCalendarNames','Kein\x20API\x20Key\x20Ã¼bergeben','81xbgiZM','object','getEnums','currentSystemMode','SYSTEM_DP_MODE','constructor','licenseKey','isPresent','updateLocation','calendarInstance','weatherInstance','ready','main','values','startSystem','1jMIMiX','callback','getForeignObjectsAsync','updateTopology','createAllObjects','createDailyDigest','Gemini\x20AI\x20initialized.','Gemini\x20Init\x20Error:\x20','endsWith','stringify','parse','calendarName','sendTo','Kein\x20Wetter-Adapter'];a0_0xdd0f=function(){return _0xee258f;};return a0_0xdd0f();}'use strict';const utils=require('@iobroker/adapter-core'),{GoogleGenerativeAI}=require(a0_0x219a46(0x2c3)),installer=require(a0_0x219a46(0x27e)),scanner=require(a0_0x219a46(0x2c1)),schedulers=require(a0_0x219a46(0x247)),topology=require(a0_0x219a46(0x1f9)),setup=require(a0_0x219a46(0x242)),recorder=require(a0_0x219a46(0x1f0)),pythonBridge=require('./lib/python_bridge'),aiAgent=require(a0_0x219a46(0x27d)),deadMan=require(a0_0x219a46(0x28a)),GEMINI_MODEL=a0_0x219a46(0x2a7),ACTIVITY_LEVEL_MAP={'sehr\x20hoch':0x64,'hoch':0x50,'normal':0x3c,'niedrig':0x28,'sehr\x20niedrig':0x14,'inaktiv':0x0};class CogniLiving extends utils[a0_0x219a46(0x29a)]{constructor(_0x18fafc){const _0x5ad99c=a0_0x219a46;super({..._0x18fafc,'name':'cogni-living'}),this[_0x5ad99c(0x2a3)]=[],this['analysisHistory']=[],this[_0x5ad99c(0x248)]=[],this[_0x5ad99c(0x211)]=[],this[_0x5ad99c(0x28e)]={},this[_0x5ad99c(0x252)]={'latitude':0x0,'longitude':0x0,'city':''},this[_0x5ad99c(0x267)]=!![],this[_0x5ad99c(0x21a)]=null,this[_0x5ad99c(0x20d)]=null,this[_0x5ad99c(0x281)]=![],this[_0x5ad99c(0x29e)]=null,this[_0x5ad99c(0x1fb)]=null,this['currentSystemMode']=setup[_0x5ad99c(0x234)]['NORMAL'],this[_0x5ad99c(0x205)]=![],this['lastAlertState']=![],this[_0x5ad99c(0x202)]=null,this[_0x5ad99c(0x245)]=null,this['modeResetJob']=null,this[_0x5ad99c(0x24d)]=null,this[_0x5ad99c(0x2b4)]=null,this[_0x5ad99c(0x255)]=![],this['on'](_0x5ad99c(0x26b),this['onReady'][_0x5ad99c(0x2ac)](this)),this['on'](_0x5ad99c(0x226),this['onStateChange'][_0x5ad99c(0x2ac)](this)),this['on'](_0x5ad99c(0x222),this[_0x5ad99c(0x2b5)][_0x5ad99c(0x2ac)](this)),this['on'](_0x5ad99c(0x201),this[_0x5ad99c(0x20e)][_0x5ad99c(0x2ac)](this));}async[a0_0x219a46(0x280)](){const _0x527162=a0_0x219a46;this[_0x527162(0x2a9)][_0x527162(0x21e)](_0x527162(0x25d)+this[_0x527162(0x2a6)]+_0x527162(0x235));if(!installer[_0x527162(0x1f6)](this,()=>this[_0x527162(0x26e)]()))return;}async['startSystem'](){const _0x383db4=a0_0x219a46;await setup['initZombies'](this);try{this[_0x383db4(0x205)]=await setup[_0x383db4(0x215)](this[_0x383db4(0x2c8)][_0x383db4(0x266)]);}catch(_0x460d97){}if(!this[_0x383db4(0x2c8)][_0x383db4(0x29d)]||this[_0x383db4(0x2c8)][_0x383db4(0x29d)]<0.1)this[_0x383db4(0x2c8)]['inactivityThresholdHours']=0xc;await setup[_0x383db4(0x2a0)](this),await setup[_0x383db4(0x209)](this);if(this['config'][_0x383db4(0x2b7)])try{this[_0x383db4(0x29e)]=new GoogleGenerativeAI(this[_0x383db4(0x2c8)]['geminiApiKey']),this[_0x383db4(0x1fb)]=this[_0x383db4(0x29e)]['getGenerativeModel']({'model':GEMINI_MODEL,'generationConfig':{'responseMimeType':_0x383db4(0x224)}}),this[_0x383db4(0x2a9)]['info'](_0x383db4(0x275));}catch(_0xaa1016){this['log'][_0x383db4(0x22b)](_0x383db4(0x276)+_0xaa1016['message']);}await setup[_0x383db4(0x273)](this),await this[_0x383db4(0x241)]();try{const _0x3c5cb5=await this[_0x383db4(0x1f4)](_0x383db4(0x257));if(_0x3c5cb5&&_0x3c5cb5['val'])this[_0x383db4(0x248)]=JSON[_0x383db4(0x279)](_0x3c5cb5[_0x383db4(0x2b3)]);}catch(_0x244da5){this[_0x383db4(0x248)]=[];}try{const _0x5d8295=await this[_0x383db4(0x1f4)](_0x383db4(0x297));if(_0x5d8295&&_0x5d8295['val'])this[_0x383db4(0x211)]=JSON[_0x383db4(0x279)](_0x5d8295[_0x383db4(0x2b3)]);}catch(_0x2db866){this[_0x383db4(0x211)]=[];}const _0xa8ee8b=this[_0x383db4(0x211)]['length']>=(this[_0x383db4(0x2c8)][_0x383db4(0x217)]||0x7)?_0x383db4(0x24a)+this[_0x383db4(0x211)]['length']+_0x383db4(0x2ad):_0x383db4(0x1ef)+this['dailyDigests'][_0x383db4(0x28b)]+'/'+(this[_0x383db4(0x2c8)]['minDaysForBaseline']||0x7)+')';await this[_0x383db4(0x2cb)]('LTM.baselineStatus',{'val':_0xa8ee8b,'ack':!![]}),this[_0x383db4(0x23a)](_0x383db4(0x240)),this[_0x383db4(0x23a)]('LTM.triggerDailyDigest'),this[_0x383db4(0x23a)](_0x383db4(0x2a4)),this[_0x383db4(0x23a)]('analysis.triggerBriefing'),this[_0x383db4(0x23a)](_0x383db4(0x23f)),this[_0x383db4(0x23a)]('analysis.automation.autoApply'),this[_0x383db4(0x23a)]('analysis.training.triggerSecurity'),this[_0x383db4(0x23a)]('analysis.training.triggerHealth'),this[_0x383db4(0x23a)](_0x383db4(0x20c)),this[_0x383db4(0x23a)](_0x383db4(0x225)),this[_0x383db4(0x23a)](_0x383db4(0x22f));const _0x5dba23=this[_0x383db4(0x2c8)]['devices'];if(_0x5dba23)for(const _0x17c1ae of _0x5dba23){await this['subscribeForeignStatesAsync'](_0x17c1ae['id']);}const _0x34e393=this[_0x383db4(0x2c8)]['presenceDevices'];if(_0x34e393)for(const _0xfc08f1 of _0x34e393){await this[_0x383db4(0x1fe)](_0xfc08f1);}if(this['config']['notifyTelegramEnabled']&&this[_0x383db4(0x2c8)]['notifyTelegramInstance'])await this['subscribeForeignStatesAsync'](this[_0x383db4(0x2c8)][_0x383db4(0x246)]+_0x383db4(0x299));setTimeout(()=>this[_0x383db4(0x2c9)](),0x1388);if(this[_0x383db4(0x202)])clearInterval(this[_0x383db4(0x202)]);const _0xa5bf27=this[_0x383db4(0x2c8)][_0x383db4(0x25a)]||0xf;_0xa5bf27>0x0&&(this[_0x383db4(0x202)]=setInterval(()=>{const _0x314762=_0x383db4;this[_0x314762(0x230)]();},_0xa5bf27*0x3c*0x3e8)),schedulers['setupLtmScheduler'](this,()=>aiAgent['createDailyDigest'](this,pythonBridge)),schedulers['setupModeResetScheduler'](this),schedulers[_0x383db4(0x293)](this,()=>aiAgent['runBaselineDriftAnalysis'](this)),schedulers['setupBriefingScheduler'](this,()=>aiAgent[_0x383db4(0x2b0)](this)),pythonBridge[_0x383db4(0x2bf)](this,installer[_0x383db4(0x216)]),setTimeout(async()=>{const _0x39a55b=_0x383db4;await topology['updateTopology'](this);try{const _0x611d05=await this[_0x39a55b(0x1f4)](_0x39a55b(0x23e));if(_0x611d05&&_0x611d05['val'])pythonBridge[_0x39a55b(0x28c)](this,_0x39a55b(0x1f8),JSON['parse'](_0x611d05[_0x39a55b(0x2b3)]));}catch(_0x5251c4){}this[_0x39a55b(0x21c)](),this[_0x39a55b(0x229)](),this[_0x39a55b(0x2bc)](),this['updateHealthVector']();},0x1388);}['onUnload'](_0x5b5871){const _0xb37785=a0_0x219a46;if(this[_0xb37785(0x202)])clearInterval(this['analysisTimer']);if(this[_0xb37785(0x24d)])clearInterval(this[_0xb37785(0x24d)]);if(this[_0xb37785(0x245)])this[_0xb37785(0x245)]['cancel']();if(this['modeResetJob'])this['modeResetJob']['cancel']();if(this['briefingJob'])this[_0xb37785(0x2b4)][_0xb37785(0x232)]();recorder[_0xb37785(0x206)](this),pythonBridge['stopService'](this),_0x5b5871();}async[a0_0x219a46(0x283)](_0x56fc6d,_0x588d68){const _0x4a4a50=a0_0x219a46;if(!_0x588d68||this['dependencyInstallInProgress'])return;if(_0x56fc6d[_0x4a4a50(0x294)](_0x4a4a50(0x27f))&&_0x56fc6d[_0x4a4a50(0x277)](_0x4a4a50(0x228))&&_0x588d68[_0x4a4a50(0x2b3)])return;if(_0x56fc6d===this['namespace']+_0x4a4a50(0x259)){if(_0x588d68['val']&&Object[_0x4a4a50(0x26d)](setup['SYSTEM_MODES'])[_0x4a4a50(0x294)](_0x588d68[_0x4a4a50(0x2b3)])){this[_0x4a4a50(0x263)]=_0x588d68[_0x4a4a50(0x2b3)];if(_0x588d68[_0x4a4a50(0x2b3)]===setup[_0x4a4a50(0x234)]['VACATION'])await recorder[_0x4a4a50(0x210)](this,![]);else await recorder['setPresence'](this,!![]);}if(!_0x588d68[_0x4a4a50(0x284)])this[_0x4a4a50(0x212)](_0x56fc6d,{'val':this[_0x4a4a50(0x263)],'ack':!![]});return;}if(!_0x588d68[_0x4a4a50(0x284)]){_0x56fc6d['includes'](_0x4a4a50(0x240))&&_0x588d68[_0x4a4a50(0x2b3)]&&(this['setState'](_0x56fc6d,{'val':![],'ack':!![]}),aiAgent[_0x4a4a50(0x288)](this));if(_0x56fc6d[_0x4a4a50(0x294)](_0x4a4a50(0x292))&&_0x588d68[_0x4a4a50(0x2b3)]){this[_0x4a4a50(0x212)](_0x56fc6d,{'val':![],'ack':!![]});if(this[_0x4a4a50(0x205)])aiAgent[_0x4a4a50(0x274)](this,pythonBridge);}_0x56fc6d[_0x4a4a50(0x294)](_0x4a4a50(0x218))&&_0x588d68[_0x4a4a50(0x2b3)]&&(this[_0x4a4a50(0x212)](_0x56fc6d,{'val':![],'ack':!![]}),aiAgent['sendMorningBriefing'](this));_0x56fc6d['includes'](_0x4a4a50(0x243))&&_0x588d68[_0x4a4a50(0x2b3)]&&(this[_0x4a4a50(0x212)](_0x56fc6d,{'val':![],'ack':!![]}),aiAgent[_0x4a4a50(0x249)](this));if(_0x56fc6d[_0x4a4a50(0x294)](_0x4a4a50(0x1ff))&&_0x588d68['val']){this['setState'](_0x56fc6d,{'val':![],'ack':!![]});if(this[_0x4a4a50(0x205)])try{const _0x584e8b=await this[_0x4a4a50(0x1f4)](_0x4a4a50(0x1fd));if(_0x584e8b&&_0x584e8b[_0x4a4a50(0x2b3)]){const _0x5e4745=JSON['parse'](_0x584e8b[_0x4a4a50(0x2b3)]);this[_0x4a4a50(0x2cb)](_0x4a4a50(0x2b2),{'val':_0x4a4a50(0x2aa),'ack':!![]}),pythonBridge['send'](this,'TRAIN_SECURITY',{'sequences':_0x5e4745});}}catch(_0x2686fa){}}if(_0x56fc6d['includes']('analysis.training.triggerHealth')&&_0x588d68[_0x4a4a50(0x2b3)]){this[_0x4a4a50(0x212)](_0x56fc6d,{'val':![],'ack':!![]});if(this[_0x4a4a50(0x205)])try{const _0x2f2df7=await this['getStateAsync'](_0x4a4a50(0x297));if(_0x2f2df7&&_0x2f2df7['val'])pythonBridge[_0x4a4a50(0x28c)](this,'TRAIN_HEALTH',{'digests':JSON[_0x4a4a50(0x279)](_0x2f2df7[_0x4a4a50(0x2b3)])});}catch(_0x14608d){}}if(_0x56fc6d[_0x4a4a50(0x294)](_0x4a4a50(0x20c))&&_0x588d68[_0x4a4a50(0x2b3)]){this[_0x4a4a50(0x212)](_0x56fc6d,{'val':![],'ack':!![]});if(this[_0x4a4a50(0x205)])try{const _0x28fd5c=await this[_0x4a4a50(0x1f4)](_0x4a4a50(0x213));if(_0x28fd5c&&_0x28fd5c['val'])pythonBridge[_0x4a4a50(0x28c)](this,'TRAIN_ENERGY',{'points':JSON[_0x4a4a50(0x279)](_0x28fd5c[_0x4a4a50(0x2b3)])});}catch(_0x13c848){}}if(_0x56fc6d['includes'](_0x4a4a50(0x225))&&_0x588d68[_0x4a4a50(0x2b3)]){this['setState'](_0x56fc6d,{'val':![],'ack':!![]});if(this[_0x4a4a50(0x205)])try{const _0x277dd2=await this['getStateAsync'](_0x4a4a50(0x257));if(_0x277dd2&&_0x277dd2['val'])pythonBridge[_0x4a4a50(0x28c)](this,_0x4a4a50(0x227),{'events':JSON['parse'](_0x277dd2[_0x4a4a50(0x2b3)])});}catch(_0x19e82e){}}_0x56fc6d[_0x4a4a50(0x294)](_0x4a4a50(0x22f))&&_0x588d68[_0x4a4a50(0x2b3)]&&(this[_0x4a4a50(0x212)](_0x56fc6d,{'val':![],'ack':!![]}),topology[_0x4a4a50(0x272)](this));return;}if(this[_0x4a4a50(0x2c8)][_0x4a4a50(0x2a2)]&&this['config'][_0x4a4a50(0x2a2)][_0x4a4a50(0x294)](_0x56fc6d)){await this[_0x4a4a50(0x2c9)]();return;}const _0xa981de=(this[_0x4a4a50(0x2c8)][_0x4a4a50(0x1fa)]||[])[_0x4a4a50(0x295)](_0x1e2d55=>_0x1e2d55['id']===_0x56fc6d);if(_0xa981de){const _0xfebab6=await recorder[_0x4a4a50(0x25c)](this,_0x56fc6d,_0x588d68,_0xa981de);_0xfebab6&&_0xfebab6[_0x4a4a50(0x2a8)]===_0x4a4a50(0x239)&&_0xfebab6[_0x4a4a50(0x2ae)]&&this[_0x4a4a50(0x205)]&&deadMan[_0x4a4a50(0x268)](this,_0xfebab6[_0x4a4a50(0x2ae)]);}}async['onMessage'](_0x294a22){const _0x299d28=a0_0x219a46;if(typeof _0x294a22==='object'&&_0x294a22[_0x299d28(0x201)]){if(_0x294a22[_0x299d28(0x256)]===_0x299d28(0x20a))try{const _0x169762=_0x294a22[_0x299d28(0x201)][_0x299d28(0x219)];if(!_0x169762)throw new Error(_0x299d28(0x25f));const _0x39c4b9=new GoogleGenerativeAI(_0x169762),_0x23dc48=_0x39c4b9['getGenerativeModel']({'model':GEMINI_MODEL}),_0xeb7228=await _0x23dc48['generateContent'](_0x299d28(0x22a)),_0x19b9d7=await _0xeb7228[_0x299d28(0x1f7)];if(_0x19b9d7['text']())this[_0x299d28(0x27b)](_0x294a22[_0x299d28(0x24f)],_0x294a22['command'],{'success':!![],'message':_0x299d28(0x298)},_0x294a22[_0x299d28(0x270)]);else throw new Error(_0x299d28(0x221));}catch(_0x276df4){this['sendTo'](_0x294a22[_0x299d28(0x24f)],_0x294a22['command'],{'success':![],'message':_0x276df4[_0x299d28(0x201)]},_0x294a22['callback']);}else{if(_0x294a22[_0x299d28(0x256)]===_0x299d28(0x24b))try{const _0x53ff90=await scanner['scanForDevices'](this,_0x294a22[_0x299d28(0x201)]||{});this['sendTo'](_0x294a22[_0x299d28(0x24f)],_0x294a22[_0x299d28(0x256)],{'success':!![],'devices':_0x53ff90},_0x294a22[_0x299d28(0x270)]);}catch(_0x3b85d2){this['sendTo'](_0x294a22['from'],_0x294a22[_0x299d28(0x256)],{'success':![],'error':_0x3b85d2[_0x299d28(0x201)]},_0x294a22['callback']);}else{if(_0x294a22['command']===_0x299d28(0x231))try{const {matrix:_0x2f3c77}=_0x294a22['message'],_0x1bdd5b=await this[_0x299d28(0x1f4)](_0x299d28(0x23e));if(_0x1bdd5b&&_0x1bdd5b[_0x299d28(0x2b3)]){const _0x362c62=JSON['parse'](_0x1bdd5b[_0x299d28(0x2b3)]);_0x362c62[_0x299d28(0x287)]=_0x2f3c77,_0x362c62[_0x299d28(0x2b1)]=Date[_0x299d28(0x238)](),await this[_0x299d28(0x2cb)](_0x299d28(0x23e),{'val':JSON[_0x299d28(0x278)](_0x362c62),'ack':!![]}),pythonBridge['send'](this,'SET_TOPOLOGY',_0x362c62);}this[_0x299d28(0x27b)](_0x294a22[_0x299d28(0x24f)],_0x294a22[_0x299d28(0x256)],{'success':!![]},_0x294a22[_0x299d28(0x270)]);}catch(_0x22b3ad){this[_0x299d28(0x2a9)]['error'](_0x22b3ad);}else{if(_0x294a22['command']===_0x299d28(0x282))this[_0x299d28(0x27b)](_0x294a22[_0x299d28(0x24f)],_0x294a22['command'],{'success':!![],'dailyDigests':this[_0x299d28(0x211)]||[],'analysisHistory':this['analysisHistory']||[]},_0x294a22['callback']);else{if(_0x294a22[_0x299d28(0x256)]===_0x299d28(0x24e)){const _0x4d921a=this['dailyDigests'][_0x299d28(0x28b)],_0x5e735d=new Array(0x18)[_0x299d28(0x2c5)](0x0),_0x49f327=new Date()[_0x299d28(0x2b6)](0x0,0x0,0x0,0x0);this[_0x299d28(0x2a3)]&&this[_0x299d28(0x2a3)][_0x299d28(0x2c2)](_0x2454a9=>{const _0x2af94e=_0x299d28;if(_0x2454a9[_0x2af94e(0x2af)]>=_0x49f327){const _0x2b5408=new Date(_0x2454a9[_0x2af94e(0x2af)])[_0x2af94e(0x291)]();if(_0x2b5408>=0x0&&_0x2b5408<0x18)_0x5e735d[_0x2b5408]++;}}),this[_0x299d28(0x27b)](_0x294a22[_0x299d28(0x24f)],_0x294a22[_0x299d28(0x256)],{'success':!![],'eventHistory':this[_0x299d28(0x2a3)][_0x299d28(0x1f5)](0x0,0xf),'stats':{'digestCount':_0x4d921a,'isPresent':this[_0x299d28(0x267)],'hourlyActivity':_0x5e735d},'automation':{'detected':![]}},_0x294a22[_0x299d28(0x270)]);}else{if(_0x294a22[_0x299d28(0x256)]===_0x299d28(0x262)){const _0x185391=await this['getForeignObjectsAsync']('enum.functions.*',_0x299d28(0x23c)),_0x5df432=[];if(_0x185391)for(const _0x55085c in _0x185391){const _0x41a772=_0x185391[_0x55085c],_0x2234e1=(_0x41a772[_0x299d28(0x2ca)]&&typeof _0x41a772[_0x299d28(0x2ca)][_0x299d28(0x233)]===_0x299d28(0x261)?_0x41a772[_0x299d28(0x2ca)]['name']['de']:_0x41a772[_0x299d28(0x2ca)][_0x299d28(0x233)])||_0x41a772['common'][_0x299d28(0x233)];_0x5df432[_0x299d28(0x208)]({'id':_0x55085c,'name':_0x2234e1});}const _0x244bb9=await this[_0x299d28(0x271)](_0x299d28(0x296),_0x299d28(0x23c)),_0x188415=[];if(_0x244bb9)for(const _0x420495 in _0x244bb9){const _0x1429bf=_0x244bb9[_0x420495],_0x1f1eb1=(_0x1429bf[_0x299d28(0x2ca)]&&typeof _0x1429bf[_0x299d28(0x2ca)][_0x299d28(0x233)]===_0x299d28(0x261)?_0x1429bf['common'][_0x299d28(0x233)]['de']:_0x1429bf['common']['name'])||_0x420495[_0x299d28(0x21b)]('.')[_0x299d28(0x289)]();_0x188415[_0x299d28(0x208)](_0x1f1eb1);}this['sendTo'](_0x294a22[_0x299d28(0x24f)],_0x294a22[_0x299d28(0x256)],{'success':!![],'enums':_0x5df432,'rooms':_0x188415},_0x294a22['callback']);}else{if(_0x294a22[_0x299d28(0x256)]===_0x299d28(0x24c))try{let _0x1d4207=_0x299d28(0x27c),_0x144d82='Kein\x20Kalender-Adapter';if(this[_0x299d28(0x2c8)][_0x299d28(0x26a)]){const _0x2341ca=await recorder[_0x299d28(0x2c6)](this);_0x1d4207=_0x2341ca!==null?_0x2341ca+'Â°C':_0x299d28(0x200);}if(this[_0x299d28(0x2c8)][_0x299d28(0x269)]){const _0xba4082=await this[_0x299d28(0x203)](_0x299d28(0x214)+this[_0x299d28(0x2c8)][_0x299d28(0x269)]);_0x144d82=_0xba4082?_0x299d28(0x2a5):_0x299d28(0x21f);}this[_0x299d28(0x27b)](_0x294a22[_0x299d28(0x24f)],_0x294a22[_0x299d28(0x256)],{'success':!![],'weather':_0x1d4207,'calendar':_0x144d82},_0x294a22[_0x299d28(0x270)]);}catch(_0x268820){this[_0x299d28(0x27b)](_0x294a22[_0x299d28(0x24f)],_0x294a22[_0x299d28(0x256)],{'success':![],'error':_0x268820[_0x299d28(0x201)]},_0x294a22['callback']);}else{if(_0x294a22[_0x299d28(0x256)]===_0x299d28(0x25e))try{const _0x1a5c14=_0x294a22[_0x299d28(0x201)][_0x299d28(0x2be)],_0x177579=await this[_0x299d28(0x23b)](_0x1a5c14+_0x299d28(0x2c0));let _0x4a8ac4=[];if(_0x177579&&_0x177579[_0x299d28(0x2b3)]){const _0x59167e=JSON[_0x299d28(0x279)](_0x177579[_0x299d28(0x2b3)]),_0x565923=new Set();Array['isArray'](_0x59167e)&&_0x59167e[_0x299d28(0x2c2)](_0x1e1fce=>{const _0x4670b6=_0x299d28;if(_0x1e1fce[_0x4670b6(0x1f3)])_0x565923[_0x4670b6(0x286)](_0x1e1fce[_0x4670b6(0x1f3)]);else{if(_0x1e1fce[_0x4670b6(0x27a)])_0x565923[_0x4670b6(0x286)](_0x1e1fce[_0x4670b6(0x27a)]);}}),_0x4a8ac4=Array[_0x299d28(0x24f)](_0x565923)[_0x299d28(0x28f)]();}if(_0x4a8ac4[_0x299d28(0x28b)]===0x0)_0x4a8ac4=[_0x299d28(0x2c4)];this['sendTo'](_0x294a22[_0x299d28(0x24f)],_0x294a22['command'],{'success':!![],'names':_0x4a8ac4},_0x294a22[_0x299d28(0x270)]);}catch(_0xfb201e){this[_0x299d28(0x27b)](_0x294a22['from'],_0x294a22[_0x299d28(0x256)],{'success':![],'error':_0xfb201e['message']},_0x294a22[_0x299d28(0x270)]);}else{if(_0x294a22[_0x299d28(0x256)]==='testNotification')try{await setup[_0x299d28(0x244)](this,_0x299d28(0x29b),![],![]),this[_0x299d28(0x27b)](_0x294a22[_0x299d28(0x24f)],_0x294a22[_0x299d28(0x256)],{'success':!![],'message':_0x299d28(0x254)},_0x294a22[_0x299d28(0x270)]);}catch(_0x1a4c44){this[_0x299d28(0x2a9)][_0x299d28(0x22b)](_0x299d28(0x2a1)+_0x1a4c44[_0x299d28(0x201)]),this[_0x299d28(0x27b)](_0x294a22[_0x299d28(0x24f)],_0x294a22[_0x299d28(0x256)],{'success':![],'message':_0x299d28(0x25b)+_0x1a4c44[_0x299d28(0x201)]},_0x294a22[_0x299d28(0x270)]);}}}}}}}}}}}async['loadSystemMode'](){const _0x4d79e2=a0_0x219a46;try{const _0x1038d0=await this[_0x4d79e2(0x1f4)](setup[_0x4d79e2(0x264)]);_0x1038d0&&_0x1038d0[_0x4d79e2(0x2b3)]&&Object[_0x4d79e2(0x26d)](setup[_0x4d79e2(0x234)])['includes'](_0x1038d0['val'])?this['currentSystemMode']=_0x1038d0[_0x4d79e2(0x2b3)]:(this[_0x4d79e2(0x263)]=setup[_0x4d79e2(0x234)][_0x4d79e2(0x21d)],await this['setStateAsync'](setup[_0x4d79e2(0x264)],{'val':setup[_0x4d79e2(0x234)][_0x4d79e2(0x21d)],'ack':!![]}));}catch(_0x48d049){this[_0x4d79e2(0x263)]=setup[_0x4d79e2(0x234)][_0x4d79e2(0x21d)];}}async[a0_0x219a46(0x2c9)](){const _0x17efb5=a0_0x219a46;try{const _0x4d5ad3=this[_0x17efb5(0x2c8)][_0x17efb5(0x2a2)]||[];let _0x4942f8=![];const _0x6cd146=[];for(const _0x5eb195 of _0x4d5ad3){try{const _0x5d5600=await this['getForeignStateAsync'](_0x5eb195);_0x5d5600&&(_0x5d5600[_0x17efb5(0x2b3)]===!![]||_0x5d5600[_0x17efb5(0x2b3)]===_0x17efb5(0x2b8)||_0x5d5600[_0x17efb5(0x2b3)]===0x1)&&(_0x4942f8=!![],_0x6cd146[_0x17efb5(0x208)](_0x5eb195));}catch(_0x31b98e){}}return await this[_0x17efb5(0x2cb)](_0x17efb5(0x22c),{'val':_0x6cd146[_0x17efb5(0x253)](',\x20'),'ack':!![]}),_0x4942f8&&(this['exitTimer']&&(this['log'][_0x17efb5(0x21e)](_0x17efb5(0x22e)),recorder[_0x17efb5(0x206)](this)),!this[_0x17efb5(0x267)]&&this[_0x17efb5(0x263)]===setup[_0x17efb5(0x234)][_0x17efb5(0x21d)]&&await recorder['setPresence'](this,!![])),_0x4942f8;}catch(_0x3a8cb6){return![];}}async[a0_0x219a46(0x230)](){const _0x197a10=a0_0x219a46;this['log'][_0x197a10(0x290)](_0x197a10(0x236)),await aiAgent[_0x197a10(0x288)](this),this[_0x197a10(0x1f1)](),this[_0x197a10(0x229)](),this['triggerEnergyPrediction']();}[a0_0x219a46(0x229)](){const _0x5cda60=a0_0x219a46;if(!this[_0x5cda60(0x205)])return;try{this['getState'](_0x5cda60(0x1fd),(_0x4b8fa3,_0x261bd2)=>{const _0x1323fb=_0x5cda60;_0x261bd2&&_0x261bd2[_0x1323fb(0x2b3)]&&pythonBridge['send'](this,_0x1323fb(0x2bb),{'sequences':JSON[_0x1323fb(0x279)](_0x261bd2['val'])});});}catch(_0x2286aa){}}async[a0_0x219a46(0x2bc)](){const _0x33b920=a0_0x219a46;if(!this[_0x33b920(0x205)])return;try{const _0x1a1156=await recorder[_0x33b920(0x2c6)](this);if(_0x1a1156===null)return;const _0x23e2a3={},_0x115075=this[_0x33b920(0x2c8)]['devices']||[];for(const _0x54f569 of _0x115075){if(_0x54f569[_0x33b920(0x2a8)]==='temperature'&&_0x54f569[_0x33b920(0x2ae)]){const _0x5ddf37=this[_0x33b920(0x28e)][_0x54f569['id']];if(_0x5ddf37!==undefined)_0x23e2a3[_0x54f569[_0x33b920(0x2ae)]]=_0x5ddf37;}}Object[_0x33b920(0x258)](_0x23e2a3)[_0x33b920(0x28b)]>0x0&&pythonBridge[_0x33b920(0x28c)](this,_0x33b920(0x22d),{'current_temps':_0x23e2a3,'t_out':_0x1a1156});}catch(_0xadc18d){}}['updateHealthVector'](){const _0x5a96d3=a0_0x219a46;if(!this[_0x5a96d3(0x248)]||this[_0x5a96d3(0x248)]['length']===0x0)return;const _0x4eb67f=new Array(0x60)[_0x5a96d3(0x2c5)](0x0),_0x9549a2=new Date()['setHours'](0x0,0x0,0x0,0x0);this[_0x5a96d3(0x248)][_0x5a96d3(0x2c2)](_0x48604d=>{const _0x1f74e6=_0x5a96d3,_0x118a14=new Date(_0x48604d[_0x1f74e6(0x2af)]);if(_0x118a14[_0x1f74e6(0x204)]()>=_0x9549a2){const _0x293103=_0x118a14[_0x1f74e6(0x291)](),_0x191df5=_0x118a14['getMinutes'](),_0x253f65=_0x293103*0x4+Math[_0x1f74e6(0x223)](_0x191df5/0xf);if(_0x253f65>=0x0&&_0x253f65<0x60)_0x4eb67f[_0x253f65]++;}}),this[_0x5a96d3(0x2cb)](_0x5a96d3(0x20f),{'val':JSON[_0x5a96d3(0x278)](_0x4eb67f),'ack':!![]});}[a0_0x219a46(0x21c)](){const _0x3f2f1c=a0_0x219a46;if(!this[_0x3f2f1c(0x211)]||this[_0x3f2f1c(0x211)][_0x3f2f1c(0x28b)]<0x2)return;const _0x16927c=this[_0x3f2f1c(0x211)]['map'](_0x4d89ae=>{const _0x356789=_0x3f2f1c,_0x2dc552=(_0x4d89ae[_0x356789(0x250)]||'')[_0x356789(0x1ee)]();return ACTIVITY_LEVEL_MAP[_0x2dc552]||0x32;});pythonBridge[_0x3f2f1c(0x28c)](this,_0x3f2f1c(0x207),{'values':_0x16927c,'tag':_0x3f2f1c(0x1fc)});}}if(require[a0_0x219a46(0x26c)]!==module)module[a0_0x219a46(0x237)]=_0x1ece95=>new CogniLiving(_0x1ece95);else new CogniLiving();