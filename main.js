const a0_0x5aab67=a0_0x146d;(function(_0xee89bb,_0x3f60a0){const _0x5a088d=a0_0x146d,_0x188118=_0xee89bb();while(!![]){try{const _0x1c3eae=-parseInt(_0x5a088d(0x16a))/0x1+parseInt(_0x5a088d(0x21e))/0x2+parseInt(_0x5a088d(0x265))/0x3+-parseInt(_0x5a088d(0x260))/0x4+parseInt(_0x5a088d(0x2be))/0x5+parseInt(_0x5a088d(0x257))/0x6+-parseInt(_0x5a088d(0x2e1))/0x7;if(_0x1c3eae===_0x3f60a0)break;else _0x188118['push'](_0x188118['shift']());}catch(_0x6cb134){_0x188118['push'](_0x188118['shift']());}}}(a0_0x3cab,0xed626));const a0_0xf49427=(function(){let _0x10fc22=!![];return function(_0x503472,_0x5c9187){const _0x1f689e=_0x10fc22?function(){if(_0x5c9187){const _0x510cf7=_0x5c9187['apply'](_0x503472,arguments);return _0x5c9187=null,_0x510cf7;}}:function(){};return _0x10fc22=![],_0x1f689e;};}()),a0_0x14ec9c=a0_0xf49427(this,function(){const _0x1e3cf0=a0_0x146d;return a0_0x14ec9c['toString']()[_0x1e3cf0(0x131)]('(((.+)+)+)+$')[_0x1e3cf0(0x13f)]()[_0x1e3cf0(0x2a9)](a0_0x14ec9c)[_0x1e3cf0(0x131)](_0x1e3cf0(0x25f));});a0_0x14ec9c();'use strict';const utils=require('@iobroker/adapter-core'),{GoogleGenerativeAI}=require(a0_0x5aab67(0x178)),schedule=require(a0_0x5aab67(0x1d0)),{spawn,exec}=require(a0_0x5aab67(0x2d9)),path=require('path'),fs=require('fs'),HISTORY_MAX_SIZE=0x32,RAW_LOG_MAX_SIZE=0x9c4,LTM_MIN_EVENTS_FOR_COMPRESSION=0x5,GEMINI_MODEL='models/gemini-flash-latest',LTM_SCHEDULE=a0_0x5aab67(0x16e),MODE_RESET_SCHEDULE=a0_0x5aab67(0x262),SEQUENCE_TIMEOUT_MS=0x5*0x3c*0x3e8,MAX_TRAINING_SET_SIZE=0x1f4,THERMO_LOG_SIZE=0x3e8,EXIT_TIMER_MINUTES=0xf,EXIT_GRACE_PERIOD_SECONDS=0x1e,LTM_DP_RAW_LOG='LTM.rawEventLog',LTM_DP_DAILY_DIGESTS=a0_0x5aab67(0x2b2),LTM_DP_STATUS=a0_0x5aab67(0x2a7),LTM_DP_TRIGGER_DIGEST=a0_0x5aab67(0x27d),LTM_DP_BASELINE_STATUS=a0_0x5aab67(0x244),LTM_DP_DRIFT_CHANNEL=a0_0x5aab67(0x207),LTM_DP_DRIFT_STATUS=a0_0x5aab67(0x184),LTM_DP_DRIFT_DETAILS=a0_0x5aab67(0x25d),LTM_DP_DRIFT_LAST_CHECK=a0_0x5aab67(0x2a8),SYSTEM_DP_MODE=a0_0x5aab67(0x2a5),SYSTEM_MODES={'NORMAL':'normal','VACATION':a0_0x5aab67(0x271),'PARTY':'party','GUEST':'guest'},AUTO_RESET_MODES=[SYSTEM_MODES['PARTY'],SYSTEM_MODES[a0_0x5aab67(0x222)]],PERSONA_MAPPING={'generic':'Analysiere\x20ausgewogen.','senior_aal':a0_0x5aab67(0x200),'family':'Fokus\x20auf\x20Familienroutinen.','single_comfort':a0_0x5aab67(0x176),'security':a0_0x5aab67(0x2d4)},ACTIVITY_LEVEL_MAP={'sehr\x20hoch':0x64,'hoch':0x50,'normal':0x3c,'niedrig':0x28,'sehr\x20niedrig':0x14,'inaktiv':0x0},IS_WIN=process[a0_0x5aab67(0x1ef)]===a0_0x5aab67(0x151),PERSISTENT_DIR=path['join'](__dirname,a0_0x5aab67(0x275)),VENV_PATH=PERSISTENT_DIR,PYTHON_EXE=IS_WIN?path[a0_0x5aab67(0x2a3)](VENV_PATH,a0_0x5aab67(0x288),a0_0x5aab67(0x2d2)):path[a0_0x5aab67(0x2a3)](VENV_PATH,a0_0x5aab67(0x27b),a0_0x5aab67(0x16b)),PIP_EXE=IS_WIN?path['join'](VENV_PATH,a0_0x5aab67(0x288),'pip.exe'):path[a0_0x5aab67(0x2a3)](VENV_PATH,'bin','pip');let activeSequence=[],sequenceTimer=null;async function startSystem(_0xc40c30){const _0x1191ce=a0_0x5aab67;_0xc40c30[_0x1191ce(0x171)][_0x1191ce(0x259)](_0x1191ce(0x1b0)),await initZombies(_0xc40c30);try{_0xc40c30[_0x1191ce(0x1ec)]=await checkLicense(_0xc40c30['config'][_0x1191ce(0x1fa)]);}catch(_0x4dafa7){}if(!_0xc40c30[_0x1191ce(0x2cd)][_0x1191ce(0x185)]||_0xc40c30[_0x1191ce(0x2cd)][_0x1191ce(0x185)]<0.1)_0xc40c30['config'][_0x1191ce(0x185)]=0xc;await initHistory(_0xc40c30),await initSystemConfig(_0xc40c30);if(_0xc40c30[_0x1191ce(0x2cd)]['geminiApiKey'])try{_0xc40c30[_0x1191ce(0x203)]=new GoogleGenerativeAI(_0xc40c30[_0x1191ce(0x2cd)][_0x1191ce(0x268)]),_0xc40c30['geminiModel']=_0xc40c30[_0x1191ce(0x203)][_0x1191ce(0x146)]({'model':GEMINI_MODEL,'generationConfig':{'responseMimeType':_0x1191ce(0x201)}}),_0xc40c30[_0x1191ce(0x171)][_0x1191ce(0x259)](_0x1191ce(0x13e));}catch(_0x13dab9){_0xc40c30[_0x1191ce(0x171)][_0x1191ce(0x138)](_0x1191ce(0x1cf)+_0x13dab9[_0x1191ce(0x187)]);}await createAllObjects(_0xc40c30),await loadSystemMode(_0xc40c30),await loadRawEventLog(_0xc40c30),await loadDailyDigests(_0xc40c30),_0xc40c30['subscribeStates']('analysis.trigger'),_0xc40c30[_0x1191ce(0x256)](LTM_DP_TRIGGER_DIGEST),_0xc40c30[_0x1191ce(0x256)]('system.mode'),_0xc40c30[_0x1191ce(0x256)](_0x1191ce(0x211)),_0xc40c30[_0x1191ce(0x256)](_0x1191ce(0x18d)),_0xc40c30[_0x1191ce(0x256)](_0x1191ce(0x160)),_0xc40c30[_0x1191ce(0x256)](_0x1191ce(0x181)),_0xc40c30[_0x1191ce(0x256)](_0x1191ce(0x226)),_0xc40c30['subscribeStates'](_0x1191ce(0x141)),_0xc40c30[_0x1191ce(0x256)](_0x1191ce(0x1e7)),await initSensorSubscriptions(_0xc40c30),await initPresenceSubscriptions(_0xc40c30),await setupTelegramListener(_0xc40c30),setTimeout(()=>checkWifiPresence(_0xc40c30),0x1388);if(_0xc40c30['analysisTimer'])clearInterval(_0xc40c30['analysisTimer']);const _0x1de30f=_0xc40c30[_0x1191ce(0x2cd)]['analysisInterval']||0xf;_0x1de30f>0x0&&(_0xc40c30['analysisTimer']=setInterval(()=>{runAutopilot(_0xc40c30);},_0x1de30f*0x3c*0x3e8)),setupLtmScheduler(_0xc40c30),setupModeResetScheduler(_0xc40c30),setupDriftAnalysisScheduler(_0xc40c30),setupBriefingScheduler(_0xc40c30),startPythonService(_0xc40c30),setTimeout(()=>{const _0x504dd3=_0x1191ce;if(_0xc40c30[_0x504dd3(0x2d3)])runPythonHealthCheck(_0xc40c30);updateHealthVector(_0xc40c30);},0x1388);}async function runAutopilot(_0x2d4bb4){const _0x7ab228=a0_0x5aab67;_0x2d4bb4[_0x7ab228(0x171)][_0x7ab228(0x14f)]('ü§ñ\x20Autopilot:\x20Running\x20periodic\x20analysis...'),await runGeminiAnalysis(_0x2d4bb4),updateHealthVector(_0x2d4bb4);}function updateHealthVector(_0x11e0d1){const _0x1650d8=a0_0x5aab67;if(!_0x11e0d1['rawEventLog']||_0x11e0d1[_0x1650d8(0x2d5)][_0x1650d8(0x29e)]===0x0)return;const _0x207812=new Array(0x60)[_0x1650d8(0x219)](0x0),_0x14784f=new Date()[_0x1650d8(0x20d)](0x0,0x0,0x0,0x0);_0x11e0d1[_0x1650d8(0x2d5)][_0x1650d8(0x158)](_0x402455=>{const _0x277224=_0x1650d8,_0x2c8499=new Date(_0x402455[_0x277224(0x235)]);if(_0x2c8499[_0x277224(0x1af)]()>=_0x14784f){const _0x427019=_0x2c8499[_0x277224(0x280)](),_0x367ed5=_0x2c8499[_0x277224(0x234)](),_0x53f7db=_0x427019*0x4+Math[_0x277224(0x273)](_0x367ed5/0xf);if(_0x53f7db>=0x0&&_0x53f7db<0x60)_0x207812[_0x53f7db]++;}}),_0x11e0d1['setStateAsync'](_0x1650d8(0x155),{'val':JSON[_0x1650d8(0x152)](_0x207812),'ack':!![]});}async function scanForDevices(_0x52ebec,_0x35da30){const _0x3e2bd1=a0_0x5aab67;_0x52ebec['log'][_0x3e2bd1(0x259)](_0x3e2bd1(0x1db));const _0x44c67=[],_0xcceedb=await _0x52ebec[_0x3e2bd1(0x177)]('*');for(const _0x5ca7ab in _0xcceedb){const _0x22162f=_0xcceedb[_0x5ca7ab];if(_0x22162f&&_0x22162f[_0x3e2bd1(0x228)]&&_0x22162f[_0x3e2bd1(0x1d2)]===_0x3e2bd1(0x238)){const _0x1e32d3=(_0x22162f[_0x3e2bd1(0x228)][_0x3e2bd1(0x1f7)]&&typeof _0x22162f['common'][_0x3e2bd1(0x1f7)]==='object'?_0x22162f[_0x3e2bd1(0x228)][_0x3e2bd1(0x1f7)]['de']:_0x22162f[_0x3e2bd1(0x228)][_0x3e2bd1(0x1f7)])||'',_0x1705ca=_0x22162f['common'][_0x3e2bd1(0x2da)]||'';let _0x297ce6=null;if(_0x35da30[_0x3e2bd1(0x215)]&&(_0x1705ca[_0x3e2bd1(0x232)](_0x3e2bd1(0x215))||_0x1e32d3[_0x3e2bd1(0x17e)]()[_0x3e2bd1(0x232)]('bewegung')))_0x297ce6='motion';else{if(_0x35da30[_0x3e2bd1(0x13d)]&&(_0x1705ca[_0x3e2bd1(0x232)]('door')||_0x1705ca[_0x3e2bd1(0x232)]('window')||_0x1e32d3[_0x3e2bd1(0x17e)]()['includes'](_0x3e2bd1(0x2cc))||_0x1e32d3[_0x3e2bd1(0x17e)]()['includes'](_0x3e2bd1(0x142))))_0x297ce6=_0x3e2bd1(0x216);else{if(_0x35da30[_0x3e2bd1(0x2a4)]&&(_0x1705ca[_0x3e2bd1(0x232)]('light')||_0x1705ca[_0x3e2bd1(0x232)](_0x3e2bd1(0x274))||_0x1e32d3[_0x3e2bd1(0x17e)]()[_0x3e2bd1(0x232)]('licht')))_0x297ce6='light';else{if(_0x35da30[_0x3e2bd1(0x2a2)]&&(_0x1705ca['includes'](_0x3e2bd1(0x2a2))||_0x1e32d3[_0x3e2bd1(0x17e)]()[_0x3e2bd1(0x232)](_0x3e2bd1(0x202))))_0x297ce6='temperature';}}}if(_0x297ce6){let _0xcd922='';const _0x28a173=_0x5ca7ab[_0x3e2bd1(0x276)]('.');if(_0x28a173[_0x3e2bd1(0x29e)]>0x2)_0xcd922=_0x28a173[0x2];_0x44c67['push']({'id':_0x5ca7ab,'name':_0x1e32d3||_0x5ca7ab,'type':_0x297ce6,'location':_0xcd922,'_score':0x32});}}}return _0x44c67;}async function getWeatherContext(_0x1bef7c){const _0x430e85=a0_0x5aab67;if(!_0x1bef7c[_0x430e85(0x2cd)][_0x430e85(0x213)]||!_0x1bef7c[_0x430e85(0x2cd)][_0x430e85(0x1a6)])return _0x430e85(0x292);try{const _0x5be166=_0x1bef7c['config']['weatherInstance'];let _0x58cbb1=await _0x1bef7c[_0x430e85(0x17b)](_0x5be166+_0x430e85(0x14a));if(!_0x58cbb1)_0x58cbb1=await _0x1bef7c[_0x430e85(0x17b)](_0x5be166+'.forecast.current.temperature');let _0x422746=await _0x1bef7c['getForeignStateAsync'](_0x5be166+_0x430e85(0x291));if(!_0x422746)_0x422746=await _0x1bef7c[_0x430e85(0x17b)](_0x5be166+_0x430e85(0x14b));if(_0x58cbb1&&_0x422746)return _0x58cbb1[_0x430e85(0x2ba)]+_0x430e85(0x245)+_0x422746['val'];}catch(_0xb967c2){}return _0x430e85(0x157);}async function getCalendarContext(_0x205b23){const _0x4eeef0=a0_0x5aab67;if(!_0x205b23[_0x4eeef0(0x2cd)][_0x4eeef0(0x140)]||!_0x205b23[_0x4eeef0(0x2cd)]['calendarInstance'])return _0x4eeef0(0x254);return _0x4eeef0(0x2af);}async function getCalendarNames(_0x70162f,_0x27377c){return[];}async function saveFeedback(_0xcf83f,_0x427108){const _0x173001=a0_0x5aab67;_0xcf83f[_0x173001(0x171)][_0x173001(0x259)]('üìù\x20Feedback\x20received:\x20'+_0x427108[_0x173001(0x20b)]);}async function sendMorningBriefing(_0x700a40){const _0x1c7af4=a0_0x5aab67;if(!_0x700a40[_0x1c7af4(0x26b)])return;try{const _0x103dd2=_0x1c7af4(0x1bf),_0x132f30=await _0x700a40[_0x1c7af4(0x26b)][_0x1c7af4(0x167)](_0x103dd2),_0x5d51c0=_0x132f30[_0x1c7af4(0x2b5)][_0x1c7af4(0x23e)]();sendNotification(_0x700a40,'üåÖ\x20Morning\x20Briefing:\x0a'+_0x5d51c0);}catch(_0x45f5aa){_0x700a40['log'][_0x1c7af4(0x138)]('Briefing\x20Error:\x20'+_0x45f5aa[_0x1c7af4(0x187)]);}}function checkAndInstall(_0x33a1b7){const _0x1e7e8c=a0_0x5aab67;if(!fs[_0x1e7e8c(0x2e7)](VENV_PATH)||!fs[_0x1e7e8c(0x2e7)](PIP_EXE))return _0x33a1b7['log']['warn']('‚ö†Ô∏è\x20Python\x20VENV\x20missing.\x20Installing\x20locally...'),installPythonDependencies(_0x33a1b7),![];return!![];}function installPythonDependencies(_0x188561){const _0x34f983=a0_0x5aab67;if(_0x188561[_0x34f983(0x29f)])return;_0x188561[_0x34f983(0x29f)]=!![];const _0x3fb693=path[_0x34f983(0x2a3)](__dirname,_0x34f983(0x179),_0x34f983(0x143));stopPythonService(_0x188561);if(fs[_0x34f983(0x2e7)](VENV_PATH))try{fs[_0x34f983(0x1cb)](VENV_PATH,{'recursive':!![],'force':!![]});}catch(_0x15c086){}exec(_0x34f983(0x17c)+VENV_PATH+'\x22',_0x485bae=>{const _0x2ee142=_0x34f983;if(_0x485bae){_0x188561[_0x2ee142(0x171)][_0x2ee142(0x138)]('‚ùå\x20VENV\x20FAILED:\x20'+_0x485bae[_0x2ee142(0x187)]),_0x188561['dependencyInstallInProgress']=![];return;}installRequirementsInVenv(_0x188561,_0x3fb693);});}function installRequirementsInVenv(_0x8bfdcb,_0x3cda22){const _0x3b4e2b=a0_0x5aab67;_0x8bfdcb['log'][_0x3b4e2b(0x259)](_0x3b4e2b(0x26e));const _0x19deb2='\x22'+PIP_EXE+_0x3b4e2b(0x252)+_0x3cda22+'\x22';exec(_0x19deb2,{'timeout':0x124f80},(_0x51323a,_0x5b50a7,_0x879219)=>{const _0x141959=_0x3b4e2b;_0x8bfdcb[_0x141959(0x29f)]=![],_0x51323a?_0x8bfdcb['log'][_0x141959(0x138)]('‚ùå\x20INSTALL\x20FAILED:\x20'+(_0x879219||_0x51323a[_0x141959(0x187)])):(_0x8bfdcb[_0x141959(0x171)][_0x141959(0x259)](_0x141959(0x28f)),startSystem(_0x8bfdcb));});}async function initZombies(_0x22bc4c){const _0x24b440=a0_0x5aab67;try{const _0x2df0b0=[_0x24b440(0x236),_0x24b440(0x1c9)];for(const _0x192d7d of _0x2df0b0){try{const _0x2fe588=await _0x22bc4c[_0x24b440(0x240)](_0x192d7d);if(_0x2fe588)await _0x22bc4c[_0x24b440(0x1c4)](_0x192d7d);}catch(_0x2908ad){}}}catch(_0x2e5477){}}async function checkLicense(_0x1ef9af){return!![];}async function initHistory(_0x5b80c6){const _0x3cceb5=a0_0x5aab67;try{const _0x1dc827=await _0x5b80c6[_0x3cceb5(0x2b6)](_0x3cceb5(0x18f));_0x1dc827&&_0x1dc827[_0x3cceb5(0x2ba)]&&(_0x5b80c6[_0x3cceb5(0x1ab)]=JSON[_0x3cceb5(0x2d7)](_0x1dc827['val'][_0x3cceb5(0x13f)]()));}catch(_0x1113e1){_0x5b80c6[_0x3cceb5(0x1ab)]=[];}try{const _0x1c2f22=await _0x5b80c6[_0x3cceb5(0x2b6)](_0x3cceb5(0x224));if(_0x1c2f22&&_0x1c2f22[_0x3cceb5(0x2ba)])_0x5b80c6[_0x3cceb5(0x2c3)]=JSON['parse'](_0x1c2f22[_0x3cceb5(0x2ba)][_0x3cceb5(0x13f)]());}catch(_0x4a28db){_0x5b80c6[_0x3cceb5(0x2c3)]=[];}if(_0x5b80c6[_0x3cceb5(0x1ab)]&&_0x5b80c6[_0x3cceb5(0x1ab)][_0x3cceb5(0x29e)]>0x0){_0x5b80c6[_0x3cceb5(0x171)][_0x3cceb5(0x259)](_0x3cceb5(0x282));for(let _0x1c9797=_0x5b80c6[_0x3cceb5(0x1ab)][_0x3cceb5(0x29e)]-0x1;_0x1c9797>=0x0;_0x1c9797--){const _0x3468dd=_0x5b80c6['eventHistory'][_0x1c9797];if(_0x3468dd&&_0x3468dd['id']!==undefined&&_0x3468dd[_0x3cceb5(0x239)]!==undefined)_0x5b80c6[_0x3cceb5(0x2ab)][_0x3468dd['id']]=_0x3468dd[_0x3cceb5(0x239)];}}}async function initSystemConfig(_0x19df6e){const _0x3e09ea=a0_0x5aab67;try{const _0x39c67d=await _0x19df6e[_0x3e09ea(0x227)](_0x3e09ea(0x1e1));if(_0x39c67d&&_0x39c67d[_0x3e09ea(0x228)])_0x19df6e[_0x3e09ea(0x29b)]={'latitude':_0x39c67d[_0x3e09ea(0x228)]['latitude']||0x0,'longitude':_0x39c67d[_0x3e09ea(0x228)][_0x3e09ea(0x2cb)]||0x0,'city':_0x39c67d[_0x3e09ea(0x228)][_0x3e09ea(0x163)]||''};}catch(_0x3d4eee){}}async function createAllObjects(_0x26b011){const _0x3897b4=a0_0x5aab67;await _0x26b011[_0x3897b4(0x1f9)](_0x3897b4(0x25b),{'type':'channel','common':{'name':_0x3897b4(0x229)},'native':{}}),await _0x26b011[_0x3897b4(0x1f9)](SYSTEM_DP_MODE,{'type':_0x3897b4(0x238),'common':{'name':_0x3897b4(0x25a),'type':_0x3897b4(0x267),'role':'state','read':!![],'write':!![],'def':SYSTEM_MODES[_0x3897b4(0x1b8)]},'native':{}}),await _0x26b011[_0x3897b4(0x1f3)](_0x3897b4(0x208),{'type':_0x3897b4(0x238),'common':{'name':_0x3897b4(0x1d8),'type':_0x3897b4(0x267),'role':_0x3897b4(0x23e),'read':!![],'write':![]},'native':{}}),await _0x26b011[_0x3897b4(0x1f3)](_0x3897b4(0x29d),{'type':_0x3897b4(0x238),'common':{'name':_0x3897b4(0x1fb),'type':'string','role':_0x3897b4(0x22c),'read':!![],'write':![]},'native':{}}),await _0x26b011[_0x3897b4(0x1f3)]('events.history',{'type':_0x3897b4(0x238),'common':{'name':_0x3897b4(0x173),'type':_0x3897b4(0x267),'role':'json','read':!![],'write':![]},'native':{}}),await _0x26b011[_0x3897b4(0x1f9)](_0x3897b4(0x286),{'type':_0x3897b4(0x2d8),'common':{'name':'AI\x20Training'},'native':{}}),await _0x26b011[_0x3897b4(0x1f3)]('analysis.training.triggerSecurity',{'type':_0x3897b4(0x238),'common':{'name':'Train\x20Security','type':_0x3897b4(0x2ce),'role':'button','read':!![],'write':!![]},'native':{}}),await _0x26b011[_0x3897b4(0x1f3)](_0x3897b4(0x226),{'type':'state','common':{'name':'Train\x20Health','type':_0x3897b4(0x2ce),'role':'button','read':!![],'write':!![]},'native':{}}),await _0x26b011[_0x3897b4(0x1f3)]('analysis.training.triggerEnergy',{'type':_0x3897b4(0x238),'common':{'name':_0x3897b4(0x2ae),'type':'boolean','role':_0x3897b4(0x223),'read':!![],'write':!![]},'native':{}}),await _0x26b011[_0x3897b4(0x1f3)](_0x3897b4(0x1e7),{'type':_0x3897b4(0x238),'common':{'name':_0x3897b4(0x2a1),'type':_0x3897b4(0x2ce),'role':_0x3897b4(0x223),'read':!![],'write':!![]},'native':{}}),await _0x26b011[_0x3897b4(0x1f3)](_0x3897b4(0x2b4),{'type':_0x3897b4(0x238),'common':{'name':_0x3897b4(0x170),'type':'string','role':_0x3897b4(0x23e),'read':!![],'write':![]},'native':{}}),await _0x26b011[_0x3897b4(0x1f9)](_0x3897b4(0x1df),{'type':_0x3897b4(0x2d8),'common':{'name':_0x3897b4(0x28a)},'native':{}}),await _0x26b011[_0x3897b4(0x1f3)](_0x3897b4(0x28b),{'type':_0x3897b4(0x238),'common':{'name':_0x3897b4(0x164),'type':'number','role':_0x3897b4(0x239),'read':!![],'write':![]},'native':{}}),await _0x26b011['setObjectNotExistsAsync'](_0x3897b4(0x19b),{'type':_0x3897b4(0x238),'common':{'name':'Current\x20Threshold','type':_0x3897b4(0x263),'role':_0x3897b4(0x239),'read':!![],'write':![],'def':0.05},'native':{}}),await _0x26b011[_0x3897b4(0x1f3)](_0x3897b4(0x28c),{'type':'state','common':{'name':_0x3897b4(0x15a),'type':_0x3897b4(0x267),'role':_0x3897b4(0x1ac),'read':!![],'write':![]},'native':{}}),await _0x26b011['extendObjectAsync'](_0x3897b4(0x1dc),{'type':_0x3897b4(0x2d8),'common':{'name':_0x3897b4(0x26f)},'native':{}}),await _0x26b011['setObjectNotExistsAsync'](_0x3897b4(0x21a),{'type':_0x3897b4(0x238),'common':{'name':_0x3897b4(0x15a),'type':_0x3897b4(0x267),'role':_0x3897b4(0x1ac),'read':!![],'write':![]},'native':{}}),await _0x26b011[_0x3897b4(0x1f3)](_0x3897b4(0x20e),{'type':_0x3897b4(0x238),'common':{'name':_0x3897b4(0x132),'type':_0x3897b4(0x2ce),'role':'indicator','read':!![],'write':![]},'native':{}}),await _0x26b011[_0x3897b4(0x1f3)]('analysis.health.trendDiagnosis',{'type':_0x3897b4(0x238),'common':{'name':_0x3897b4(0x2a6),'type':_0x3897b4(0x267),'role':'text','read':!![],'write':![]},'native':{}}),await _0x26b011[_0x3897b4(0x1f3)](_0x3897b4(0x186),{'type':_0x3897b4(0x238),'common':{'name':'Trend\x20Value','type':_0x3897b4(0x263),'role':_0x3897b4(0x239),'read':!![],'write':![]},'native':{}}),await _0x26b011['setObjectNotExistsAsync'](_0x3897b4(0x155),{'type':'state','common':{'name':_0x3897b4(0x1bb),'type':_0x3897b4(0x267),'role':'json','read':!![],'write':![]},'native':{}}),await _0x26b011['extendObjectAsync']('analysis.energy',{'type':'channel','common':{'name':_0x3897b4(0x28e)},'native':{}}),await _0x26b011['setObjectNotExistsAsync'](_0x3897b4(0x1c6),{'type':_0x3897b4(0x238),'common':{'name':_0x3897b4(0x15b),'type':_0x3897b4(0x267),'role':_0x3897b4(0x23e),'read':!![],'write':![]},'native':{}}),await _0x26b011['setObjectNotExistsAsync'](_0x3897b4(0x20f),{'type':_0x3897b4(0x238),'common':{'name':_0x3897b4(0x1c8),'type':_0x3897b4(0x267),'role':'text','read':!![],'write':![]},'native':{}}),await _0x26b011[_0x3897b4(0x1f9)]('LTM',{'type':'channel','common':{'name':'LTM'},'native':{}}),await _0x26b011[_0x3897b4(0x1f9)](LTM_DP_RAW_LOG,{'type':_0x3897b4(0x238),'common':{'name':_0x3897b4(0x233),'type':_0x3897b4(0x267),'role':_0x3897b4(0x22c),'read':!![],'write':![]},'native':{}}),await _0x26b011[_0x3897b4(0x1f9)](LTM_DP_DAILY_DIGESTS,{'type':_0x3897b4(0x238),'common':{'name':_0x3897b4(0x269),'type':_0x3897b4(0x267),'role':_0x3897b4(0x22c),'read':!![],'write':![]},'native':{}}),await _0x26b011[_0x3897b4(0x1f3)]('LTM.trainingData.sequences',{'type':'state','common':{'name':_0x3897b4(0x21f),'type':_0x3897b4(0x267),'role':_0x3897b4(0x22c),'read':!![],'write':![]},'native':{}}),await _0x26b011['setObjectNotExistsAsync'](_0x3897b4(0x1ae),{'type':_0x3897b4(0x238),'common':{'name':_0x3897b4(0x20c),'type':_0x3897b4(0x267),'role':'json','read':!![],'write':![]},'native':{}}),await _0x26b011[_0x3897b4(0x1f3)](_0x3897b4(0x289),{'type':_0x3897b4(0x238),'common':{'name':_0x3897b4(0x1a5),'type':_0x3897b4(0x2ce),'role':_0x3897b4(0x223),'read':!![],'write':!![]},'native':{}}),await _0x26b011[_0x3897b4(0x1f3)]('analysis.triggerBriefing',{'type':_0x3897b4(0x238),'common':{'name':_0x3897b4(0x1d6),'type':_0x3897b4(0x2ce),'role':_0x3897b4(0x223),'read':!![],'write':!![]},'native':{}}),await _0x26b011['setObjectNotExistsAsync']('analysis.isAlert',{'type':'state','common':{'name':_0x3897b4(0x14c),'type':_0x3897b4(0x2ce),'role':_0x3897b4(0x290),'read':!![],'write':![]},'native':{}}),await _0x26b011[_0x3897b4(0x1f3)](_0x3897b4(0x196),{'type':_0x3897b4(0x238),'common':{'name':'Alert\x20Reason','type':_0x3897b4(0x267),'role':_0x3897b4(0x210),'read':!![],'write':![]},'native':{}}),await _0x26b011[_0x3897b4(0x1f3)](_0x3897b4(0x27e),{'type':'state','common':{'name':_0x3897b4(0x2aa),'type':'string','role':_0x3897b4(0x23e),'read':!![],'write':![]},'native':{}}),await _0x26b011[_0x3897b4(0x1f3)](_0x3897b4(0x1ad),{'type':_0x3897b4(0x238),'common':{'name':_0x3897b4(0x1f8),'type':_0x3897b4(0x2ce),'role':_0x3897b4(0x25e),'read':!![],'write':![]},'native':{}}),await _0x26b011[_0x3897b4(0x1f3)](_0x3897b4(0x1a8),{'type':_0x3897b4(0x238),'common':{'name':_0x3897b4(0x251),'type':_0x3897b4(0x267),'role':'text','read':!![],'write':![]},'native':{}}),await _0x26b011[_0x3897b4(0x1f3)](_0x3897b4(0x1f2),{'type':'state','common':{'name':'Detected\x20Patterns','type':_0x3897b4(0x267),'role':_0x3897b4(0x22c),'read':!![],'write':![]},'native':{}}),await _0x26b011[_0x3897b4(0x1f3)](_0x3897b4(0x174),{'type':'state','common':{'name':_0x3897b4(0x266),'type':_0x3897b4(0x267),'role':_0x3897b4(0x23e),'read':!![],'write':![]},'native':{}}),await _0x26b011[_0x3897b4(0x1f3)](_0x3897b4(0x237),{'type':'state','common':{'name':_0x3897b4(0x1f0),'type':_0x3897b4(0x267),'role':_0x3897b4(0x23e),'read':!![],'write':![]},'native':{}}),await _0x26b011['setObjectNotExistsAsync'](_0x3897b4(0x160),{'type':'state','common':{'name':_0x3897b4(0x281),'type':_0x3897b4(0x2ce),'role':_0x3897b4(0x274),'read':!![],'write':!![]},'native':{}}),await _0x26b011[_0x3897b4(0x1f3)](_0x3897b4(0x18d),{'type':'state','common':{'name':_0x3897b4(0x250),'type':_0x3897b4(0x2ce),'role':_0x3897b4(0x223),'read':!![],'write':!![]},'native':{}});}async function loadSystemMode(_0x5a9e43){const _0x204f64=a0_0x5aab67;try{const _0x2e2ee4=await _0x5a9e43['getStateAsync'](SYSTEM_DP_MODE);_0x2e2ee4&&_0x2e2ee4[_0x204f64(0x2ba)]&&Object['values'](SYSTEM_MODES)[_0x204f64(0x232)](_0x2e2ee4['val'])?_0x5a9e43['currentSystemMode']=_0x2e2ee4[_0x204f64(0x2ba)]:(_0x5a9e43[_0x204f64(0x1d1)]=SYSTEM_MODES[_0x204f64(0x1b8)],await _0x5a9e43['setStateAsync'](SYSTEM_DP_MODE,{'val':SYSTEM_MODES[_0x204f64(0x1b8)],'ack':!![]}));}catch(_0xb1fad3){_0x5a9e43[_0x204f64(0x1d1)]=SYSTEM_MODES[_0x204f64(0x1b8)];}}async function loadRawEventLog(_0x1c9b06){const _0x2cf624=a0_0x5aab67;try{const _0x227436=await _0x1c9b06[_0x2cf624(0x2b6)](LTM_DP_RAW_LOG);if(_0x227436&&_0x227436[_0x2cf624(0x2ba)])_0x1c9b06[_0x2cf624(0x2d5)]=JSON[_0x2cf624(0x2d7)](_0x227436[_0x2cf624(0x2ba)]);}catch(_0x54bd84){_0x1c9b06[_0x2cf624(0x2d5)]=[];}}async function saveRawEventLog(_0x58da54){const _0x219ab=a0_0x5aab67;if(_0x58da54['rawEventLog'][_0x219ab(0x29e)]>RAW_LOG_MAX_SIZE)_0x58da54['rawEventLog'][_0x219ab(0x1eb)](0x0,_0x58da54[_0x219ab(0x2d5)]['length']-RAW_LOG_MAX_SIZE);await _0x58da54[_0x219ab(0x1e9)](LTM_DP_RAW_LOG,{'val':JSON[_0x219ab(0x152)](_0x58da54[_0x219ab(0x2d5)]),'ack':!![]});}function a0_0x146d(_0x54327b,_0x3576a3){const _0x510a43=a0_0x3cab();return a0_0x146d=function(_0x14ec9c,_0xf49427){_0x14ec9c=_0x14ec9c-0x12f;let _0x3cab5d=_0x510a43[_0x14ec9c];return _0x3cab5d;},a0_0x146d(_0x54327b,_0x3576a3);}async function loadDailyDigests(_0x2a472e){const _0x40a020=a0_0x5aab67;try{const _0x5668b2=await _0x2a472e[_0x40a020(0x2b6)](LTM_DP_DAILY_DIGESTS);if(_0x5668b2&&_0x5668b2[_0x40a020(0x2ba)])_0x2a472e[_0x40a020(0x299)]=JSON[_0x40a020(0x2d7)](_0x5668b2['val']);}catch(_0x2c559a){_0x2a472e[_0x40a020(0x299)]=[];}await updateBaselineStatus(_0x2a472e);}async function saveDailyDigests(_0x2fe7f9,_0x38eb79=!![]){const _0x209cdb=a0_0x5aab67,_0x5b1e19=_0x2fe7f9[_0x209cdb(0x2cd)][_0x209cdb(0x190)]||0x3c;_0x2fe7f9[_0x209cdb(0x299)][_0x209cdb(0x29e)]>_0x5b1e19&&_0x2fe7f9[_0x209cdb(0x299)][_0x209cdb(0x1eb)](0x0,_0x2fe7f9[_0x209cdb(0x299)]['length']-_0x5b1e19);await _0x2fe7f9[_0x209cdb(0x1e9)](LTM_DP_DAILY_DIGESTS,{'val':JSON['stringify'](_0x2fe7f9[_0x209cdb(0x299)]),'ack':!![]});if(_0x38eb79)await updateBaselineStatus(_0x2fe7f9);}async function updateAnalysisHistory(_0x13c31f,_0x470a1e){const _0x3c88e7=a0_0x5aab67;_0x13c31f[_0x3c88e7(0x2c3)][_0x3c88e7(0x24d)](_0x470a1e);if(_0x13c31f[_0x3c88e7(0x2c3)]['length']>HISTORY_MAX_SIZE)_0x13c31f[_0x3c88e7(0x2c3)]['pop']();await _0x13c31f[_0x3c88e7(0x1e9)]('analysis.analysisHistory',{'val':JSON['stringify'](_0x13c31f['analysisHistory']),'ack':!![]});}async function updateBaselineStatus(_0x3e2787){const _0x1ef30b=a0_0x5aab67;if(!_0x3e2787[_0x1ef30b(0x1ec)]){await _0x3e2787[_0x1ef30b(0x1e9)](LTM_DP_BASELINE_STATUS,{'val':'Deaktiviert\x20(Pro-Feature)','ack':!![]});return;}const _0x45211a=_0x3e2787[_0x1ef30b(0x299)][_0x1ef30b(0x29e)]>=(_0x3e2787['config'][_0x1ef30b(0x19c)]||0x7)?_0x1ef30b(0x1cc)+_0x3e2787[_0x1ef30b(0x299)][_0x1ef30b(0x29e)]+_0x1ef30b(0x193):_0x1ef30b(0x156)+_0x3e2787[_0x1ef30b(0x299)]['length']+'/'+(_0x3e2787[_0x1ef30b(0x2cd)][_0x1ef30b(0x19c)]||0x7)+')';await _0x3e2787[_0x1ef30b(0x1e9)](LTM_DP_BASELINE_STATUS,{'val':_0x45211a,'ack':!![]});}async function initSensorSubscriptions(_0xdf077b){const _0x533d4f=a0_0x5aab67,_0x14971c=_0xdf077b[_0x533d4f(0x2cd)][_0x533d4f(0x1de)];if(_0x14971c)for(const _0x449df5 of _0x14971c){await _0xdf077b['subscribeForeignStatesAsync'](_0x449df5['id']);}}async function initPresenceSubscriptions(_0x552e36){const _0x548d59=a0_0x5aab67,_0x28d1ab=_0x552e36['config']['presenceDevices'];if(_0x28d1ab)for(const _0x5a3af2 of _0x28d1ab){await _0x552e36[_0x548d59(0x23c)](_0x5a3af2);}}async function setupTelegramListener(_0x357f80){const _0xaeaabc=a0_0x5aab67,_0x354a69=_0x357f80[_0xaeaabc(0x2cd)]['notifyTelegramInstance'];if(_0x357f80[_0xaeaabc(0x2cd)]['notifyTelegramEnabled']&&_0x354a69)await _0x357f80[_0xaeaabc(0x23c)](_0x354a69+_0xaeaabc(0x2e5));}async function checkWifiPresence(_0x5bab3c){const _0x4bde6d=a0_0x5aab67;try{const _0x133a5e=_0x5bab3c['config'][_0x4bde6d(0x18a)]||[];let _0xd112c2=![];const _0xf0a393=[];for(const _0x4dc2a6 of _0x133a5e){try{const _0x1e102e=await _0x5bab3c[_0x4bde6d(0x17b)](_0x4dc2a6);_0x1e102e&&(_0x1e102e[_0x4bde6d(0x2ba)]===!![]||_0x1e102e[_0x4bde6d(0x2ba)]===_0x4bde6d(0x247)||_0x1e102e[_0x4bde6d(0x2ba)]===0x1)&&(_0xd112c2=!![],_0xf0a393['push'](_0x4dc2a6));}catch(_0x37741b){}}return await _0x5bab3c[_0x4bde6d(0x1e9)]('system.presenceWho',{'val':_0xf0a393[_0x4bde6d(0x2a3)](',\x20'),'ack':!![]}),_0xd112c2&&(_0x5bab3c[_0x4bde6d(0x2e6)]&&(_0x5bab3c[_0x4bde6d(0x171)][_0x4bde6d(0x259)]('WiFi\x20Presence\x20detected.'),abortExitTimer(_0x5bab3c)),!_0x5bab3c[_0x4bde6d(0x139)]&&_0x5bab3c[_0x4bde6d(0x1d1)]===SYSTEM_MODES['NORMAL']&&await setPresence(_0x5bab3c,!![])),_0xd112c2;}catch(_0x101356){return![];}}function startExitTimer(_0x53ec4f){const _0x3cf68e=a0_0x5aab67;abortExitTimer(_0x53ec4f),_0x53ec4f[_0x3cf68e(0x29a)]=!![],_0x53ec4f['exitGraceTimer']=setTimeout(()=>{const _0x43e63d=_0x3cf68e;_0x53ec4f[_0x43e63d(0x29a)]=![];},EXIT_GRACE_PERIOD_SECONDS*0x3e8),_0x53ec4f['exitTimer']=setTimeout(()=>{const _0x1fe0b7=_0x3cf68e;setPresence(_0x53ec4f,![]),_0x53ec4f[_0x1fe0b7(0x2e6)]=null;},EXIT_TIMER_MINUTES*0x3c*0x3e8);}function abortExitTimer(_0x2f6858){const _0x392796=a0_0x5aab67;if(_0x2f6858[_0x392796(0x2e6)])clearTimeout(_0x2f6858[_0x392796(0x2e6)]);if(_0x2f6858[_0x392796(0x2b9)])clearTimeout(_0x2f6858[_0x392796(0x2b9)]);_0x2f6858[_0x392796(0x2e6)]=null,_0x2f6858[_0x392796(0x2b9)]=null,_0x2f6858[_0x392796(0x29a)]=![];}async function setPresence(_0x4b5303,_0xac6b0a){const _0x1a1a6c=a0_0x5aab67;if(_0x4b5303[_0x1a1a6c(0x139)]===_0xac6b0a)return;_0x4b5303['isPresent']=_0xac6b0a,await _0x4b5303[_0x1a1a6c(0x1e9)](_0x1a1a6c(0x1e8),{'val':_0xac6b0a,'ack':!![]});}async function executeAutomationAction(_0x3cb97f){const _0x322c32=a0_0x5aab67;try{const _0x17028c=await _0x3cb97f['getStateAsync'](_0x322c32(0x174)),_0x5eb269=await _0x3cb97f[_0x322c32(0x2b6)](_0x322c32(0x237));if(_0x17028c&&_0x17028c[_0x322c32(0x2ba)]&&_0x5eb269){const _0x5cd58b=_0x17028c[_0x322c32(0x2ba)];let _0x2900fa=_0x5eb269[_0x322c32(0x2ba)];try{_0x2900fa=JSON['parse'](_0x2900fa);}catch(_0x13d3b2){}_0x3cb97f[_0x322c32(0x171)]['info'](_0x322c32(0x249)+_0x5cd58b+_0x322c32(0x16d)+_0x2900fa),await _0x3cb97f[_0x322c32(0x24b)](_0x5cd58b,_0x2900fa);}else _0x3cb97f['log']['warn']('ü§ñ\x20BUTLER:\x20No\x20valid\x20target\x20ID\x20or\x20value\x20stored\x20for\x20execution.');}catch(_0x5436fc){_0x3cb97f[_0x322c32(0x171)][_0x322c32(0x138)](_0x322c32(0x241)+_0x5436fc[_0x322c32(0x187)]);}}async function processSensorEvent(_0x1263a5,_0x3d7355,_0x7e863e,_0x37d0b1){const _0xb77a5a=a0_0x5aab67;if(!_0x37d0b1)return;const _0x27b0ac=_0x7e863e[_0xb77a5a(0x2ba)],_0x1c07e5=Date['now'](),_0x514685=_0x1263a5[_0xb77a5a(0x2ab)][_0x3d7355];_0x1263a5['sensorLastValues'][_0x3d7355]=_0x27b0ac;if(!_0x37d0b1[_0xb77a5a(0x15c)]&&_0x514685!=undefined&&_0x514685==_0x27b0ac)return;const _0x4e63be=(_0x37d0b1['type']||'')['toLowerCase'](),_0x347954=_0x4e63be[_0xb77a5a(0x232)](_0xb77a5a(0x2a2))||_0x4e63be['includes'](_0xb77a5a(0x202))||_0x4e63be[_0xb77a5a(0x232)]('klima')||_0x4e63be[_0xb77a5a(0x232)](_0xb77a5a(0x1b3));_0x1263a5[_0xb77a5a(0x1ec)]&&_0x347954&&recordThermodynamics(_0x1263a5,_0x3d7355,_0x27b0ac,_0x37d0b1['location']);const _0x10bb1e={'timestamp':_0x1c07e5,'id':_0x3d7355,'name':_0x37d0b1['name'],'type':_0x37d0b1['type'],'location':_0x37d0b1['location'],'value':_0x27b0ac};_0x1263a5['eventHistory'][_0xb77a5a(0x24d)](_0x10bb1e);if(_0x1263a5[_0xb77a5a(0x1ab)][_0xb77a5a(0x29e)]>HISTORY_MAX_SIZE)_0x1263a5['eventHistory'][_0xb77a5a(0x2bb)]();await _0x1263a5[_0xb77a5a(0x1e9)](_0xb77a5a(0x29d),{'val':JSON[_0xb77a5a(0x152)](_0x10bb1e),'ack':!![]}),await _0x1263a5[_0xb77a5a(0x1e9)](_0xb77a5a(0x18f),{'val':JSON[_0xb77a5a(0x152)](_0x1263a5[_0xb77a5a(0x1ab)]),'ack':!![]});_0x1263a5[_0xb77a5a(0x1ec)]&&(_0x1263a5[_0xb77a5a(0x2d5)][_0xb77a5a(0x2bf)](_0x10bb1e),await saveRawEventLog(_0x1263a5),recordSequence(_0x1263a5,_0x10bb1e));if(_0x37d0b1[_0xb77a5a(0x2d1)]&&_0x27b0ac===!![]){if(_0x1263a5[_0xb77a5a(0x139)]&&!_0x1263a5[_0xb77a5a(0x29a)])startExitTimer(_0x1263a5);else{if(!_0x1263a5['isPresent'])setPresence(_0x1263a5,!![]);}}else{if(_0x37d0b1[_0xb77a5a(0x1d2)]===_0xb77a5a(0x215)&&_0x27b0ac===!![]){if(_0x1263a5[_0xb77a5a(0x2e6)])abortExitTimer(_0x1263a5);if(!_0x1263a5[_0xb77a5a(0x139)]&&_0x1263a5[_0xb77a5a(0x1d1)]===SYSTEM_MODES[_0xb77a5a(0x1b8)])setPresence(_0x1263a5,!![]);}}}async function recordThermodynamics(_0x564451,_0x438a29,_0x2956e9,_0x5cbcdf){const _0x2d008f=a0_0x5aab67,_0x327f0e=await getOutsideTemperatureNumeric(_0x564451),_0x5bb000=await _0x564451[_0x2d008f(0x2b6)](_0x2d008f(0x1ae));let _0x4d2951=[];if(_0x5bb000&&_0x5bb000[_0x2d008f(0x2ba)])try{_0x4d2951=JSON[_0x2d008f(0x2d7)](_0x5bb000[_0x2d008f(0x2ba)]);}catch(_0x523e74){}_0x4d2951[_0x2d008f(0x2bf)]({'ts':Date[_0x2d008f(0x194)](),'room':_0x5cbcdf||_0x2d008f(0x168),'t_in':_0x2956e9,'t_out':_0x327f0e});if(_0x4d2951[_0x2d008f(0x29e)]>THERMO_LOG_SIZE)_0x4d2951['shift']();await _0x564451[_0x2d008f(0x1e9)](_0x2d008f(0x1ae),{'val':JSON[_0x2d008f(0x152)](_0x4d2951),'ack':!![]});}async function getOutsideTemperatureNumeric(_0x425e7d){const _0x2b299e=a0_0x5aab67;if(_0x425e7d[_0x2b299e(0x2cd)][_0x2b299e(0x27c)])try{const _0x2556da=await _0x425e7d[_0x2b299e(0x17b)](_0x425e7d[_0x2b299e(0x2cd)][_0x2b299e(0x27c)]);if(_0x2556da&&_0x2556da['val']!==undefined&&_0x2556da[_0x2b299e(0x2ba)]!==null)return parseFloat(_0x2556da[_0x2b299e(0x2ba)]);}catch(_0x232525){}const _0x42dc65=_0x425e7d[_0x2b299e(0x2cd)]['weatherInstance'];if(!_0x425e7d[_0x2b299e(0x2cd)][_0x2b299e(0x213)]||!_0x42dc65)return null;try{let _0x4e5455='';if(_0x42dc65['includes'](_0x2b299e(0x1d9)))_0x4e5455=_0x42dc65+_0x2b299e(0x14a);else{if(_0x42dc65[_0x2b299e(0x232)](_0x2b299e(0x242)))_0x4e5455=_0x42dc65+'.NextHours.Location_1.Day_1.current.temp_value';else{if(_0x42dc65[_0x2b299e(0x232)](_0x2b299e(0x1c7)))_0x4e5455=_0x42dc65+_0x2b299e(0x1f1);else{if(_0x42dc65[_0x2b299e(0x232)](_0x2b299e(0x284)))_0x4e5455=_0x42dc65+_0x2b299e(0x217);}}}if(_0x4e5455){const _0x2ef2d6=await _0x425e7d['getForeignStateAsync'](_0x4e5455);if(_0x2ef2d6&&_0x2ef2d6[_0x2b299e(0x2ba)]!==undefined&&_0x2ef2d6['val']!==null)return parseFloat(_0x2ef2d6[_0x2b299e(0x2ba)]);}}catch(_0x366b5b){}return null;}async function recordSequence(_0x596aa1,_0x12c4e0){const _0x5d8ae5=a0_0x5aab67,_0x3977f7=(_0x12c4e0[_0x5d8ae5(0x1d2)]||'')[_0x5d8ae5(0x17e)](),_0x5bc20b=[_0x5d8ae5(0x215),_0x5d8ae5(0x258),'pr√§senz',_0x5d8ae5(0x2d6),_0x5d8ae5(0x17f),_0x5d8ae5(0x216),_0x5d8ae5(0x2cc),_0x5d8ae5(0x2de),_0x5d8ae5(0x142),_0x5d8ae5(0x2c1),_0x5d8ae5(0x287),_0x5d8ae5(0x22e),_0x5d8ae5(0x1b5),_0x5d8ae5(0x274),_0x5d8ae5(0x1a9),'dimmer',_0x5d8ae5(0x21b)];if(!_0x5bc20b[_0x5d8ae5(0x2dc)](_0x339765=>_0x3977f7[_0x5d8ae5(0x232)](_0x339765)))return;if(!_0x12c4e0['value'])return;if(sequenceTimer)clearTimeout(sequenceTimer);activeSequence[_0x5d8ae5(0x2bf)]({'loc':_0x12c4e0['location']||'Unknown','id':_0x12c4e0['id'],'ts':Date[_0x5d8ae5(0x194)]()}),sequenceTimer=setTimeout(async()=>{const _0x25b450=_0x5d8ae5;if(activeSequence[_0x25b450(0x29e)]>0x1)await saveCompletedSequence(_0x596aa1);activeSequence=[];},SEQUENCE_TIMEOUT_MS);}async function saveCompletedSequence(_0x22e49d){const _0x32e7a5=a0_0x5aab67;try{const _0x3d6ef1=await _0x22e49d[_0x32e7a5(0x2b6)](_0x32e7a5(0x2b3));let _0x23acf2=[];if(_0x3d6ef1&&_0x3d6ef1[_0x32e7a5(0x2ba)])try{_0x23acf2=JSON['parse'](_0x3d6ef1['val']);}catch(_0x1cce06){}const _0x1f462e=activeSequence[0x0]['ts'],_0x1a8e1e=activeSequence[_0x32e7a5(0x21d)](_0x8072b4=>({'loc':_0x8072b4[_0x32e7a5(0x2b0)],'t_delta':Math[_0x32e7a5(0x24a)]((_0x8072b4['ts']-_0x1f462e)/0x3e8)})),_0x90a172={'timestamp':new Date(_0x1f462e)['toISOString'](),'steps':_0x1a8e1e,'duration':Math[_0x32e7a5(0x24a)]((activeSequence[activeSequence[_0x32e7a5(0x29e)]-0x1]['ts']-_0x1f462e)/0x3e8),'daytime':new Date(_0x1f462e)[_0x32e7a5(0x280)]()};_0x23acf2[_0x32e7a5(0x2bf)](_0x90a172);if(_0x23acf2['length']>MAX_TRAINING_SET_SIZE)_0x23acf2[_0x32e7a5(0x1f6)]();await _0x22e49d['setStateAsync']('LTM.trainingData.sequences',{'val':JSON[_0x32e7a5(0x152)](_0x23acf2),'ack':!![]}),runSecurityCheck(_0x22e49d,_0x90a172);}catch(_0x2aaa8e){_0x22e49d[_0x32e7a5(0x171)][_0x32e7a5(0x138)](_0x32e7a5(0x285)+_0x2aaa8e[_0x32e7a5(0x187)]);}}function runSecurityCheck(_0x4b7836,_0x1342b2){const _0x3513bd=a0_0x5aab67;if(!_0x4b7836[_0x3513bd(0x1ec)])return;sendToPython(_0x4b7836,_0x3513bd(0x1c0),{'sequence':_0x1342b2});}function sendToPython(_0x54e2b3,_0x9dc922,_0xb8f205={}){const _0x444aac=a0_0x5aab67;if(!_0x54e2b3[_0x444aac(0x2d3)]||!_0x54e2b3[_0x444aac(0x2d3)][_0x444aac(0x189)][_0x444aac(0x248)])return;const _0x4753b8=JSON[_0x444aac(0x152)]({'command':_0x9dc922,..._0xb8f205});try{_0x54e2b3[_0x444aac(0x2d3)][_0x444aac(0x189)][_0x444aac(0x162)](_0x4753b8+'\x0a');}catch(_0x5b0558){}}function startPythonService(_0xd2adad){const _0xa3cf8c=a0_0x5aab67;let _0x18d6e7='python3';if(fs[_0xa3cf8c(0x2e7)](PYTHON_EXE))_0x18d6e7=PYTHON_EXE;try{const _0x18dcf0=path[_0xa3cf8c(0x2a3)](__dirname,_0xa3cf8c(0x179),_0xa3cf8c(0x195));_0xd2adad[_0xa3cf8c(0x2d3)]=spawn(_0x18d6e7,[_0x18dcf0]),_0xd2adad[_0xa3cf8c(0x2d3)][_0xa3cf8c(0x199)]['on'](_0xa3cf8c(0x2b8),_0x2132ce=>{const _0x4ab846=_0xa3cf8c,_0x3ae7e5=_0x2132ce['toString']()[_0x4ab846(0x276)]('\x0a');_0x3ae7e5[_0x4ab846(0x158)](_0x3da509=>{const _0xb1f8a2=_0x4ab846,_0x558b74=_0x3da509['trim']();if(!_0x558b74)return;if(_0x558b74[_0xb1f8a2(0x253)](_0xb1f8a2(0x22d)))_0xd2adad[_0xb1f8a2(0x171)][_0xb1f8a2(0x14f)]('[PYTHON]\x20'+_0x558b74['substring'](0x5)[_0xb1f8a2(0x20a)]());else{if(_0x558b74[_0xb1f8a2(0x253)](_0xb1f8a2(0x18c)))try{const _0x1c965e=JSON[_0xb1f8a2(0x2d7)](_0x558b74[_0xb1f8a2(0x166)](0x8)['trim']());handlePythonResult(_0xd2adad,_0x1c965e);}catch(_0xb9cd1c){}}});}),_0xd2adad[_0xa3cf8c(0x2d3)]['on'](_0xa3cf8c(0x278),_0x4c2840=>{const _0x3db90c=_0xa3cf8c;_0xd2adad[_0x3db90c(0x2d3)]=null;});}catch(_0x413c50){_0xd2adad['log']['error'](_0xa3cf8c(0x2ad)+_0x413c50[_0xa3cf8c(0x187)]);}}function stopPythonService(_0x34f792){const _0x3bf8c2=a0_0x5aab67;if(_0x34f792[_0x3bf8c2(0x2d3)]){try{_0x34f792[_0x3bf8c2(0x2d3)]['kill']();}catch(_0x15c738){}_0x34f792[_0x3bf8c2(0x2d3)]=null;}}function handlePythonResult(_0x51d1e5,_0x42146f){const _0x19a4db=a0_0x5aab67;if(_0x42146f[_0x19a4db(0x1d2)]===_0x19a4db(0x214))_0x51d1e5[_0x19a4db(0x171)][_0x19a4db(0x14f)](_0x19a4db(0x188));else{if(_0x42146f[_0x19a4db(0x1d2)]===_0x19a4db(0x2b7)){const {anomaly_score:_0x1dc453,is_anomaly:_0x352739,threshold:_0x1f195e,explanation:_0x420382}=_0x42146f['payload'];_0x51d1e5[_0x19a4db(0x171)][_0x19a4db(0x259)](_0x19a4db(0x2c8)+_0x1dc453[_0x19a4db(0x23d)](0x5)+'\x20->\x20'+(_0x352739?'ANOMALY':'OK')),_0x51d1e5[_0x19a4db(0x1e9)](_0x19a4db(0x28b),{'val':_0x1dc453,'ack':!![]}),_0x51d1e5[_0x19a4db(0x1e9)](_0x19a4db(0x28c),{'val':new Date()[_0x19a4db(0x220)](),'ack':!![]});if(_0x1f195e)_0x51d1e5[_0x19a4db(0x1e9)](_0x19a4db(0x19b),{'val':_0x1f195e,'ack':!![]});if(_0x352739){let _0x285bcb=_0x19a4db(0x2ac)+_0x1dc453[_0x19a4db(0x23d)](0x4)+')';if(_0x420382&&_0x420382!==_0x19a4db(0x168))_0x285bcb+=_0x19a4db(0x1e5)+_0x420382;_0x51d1e5['setStateAsync'](_0x19a4db(0x2c2),{'val':!![],'ack':!![]}),_0x51d1e5[_0x19a4db(0x1e9)](_0x19a4db(0x196),{'val':_0x285bcb,'ack':!![]}),sendNotification(_0x51d1e5,_0x19a4db(0x1c3)+_0x285bcb,![],!![]);}}else{if(_0x42146f['type']===_0x19a4db(0x297)){const _0x5d14b9=_0x42146f[_0x19a4db(0x22a)][_0x19a4db(0x17d)]||'',_0x4aeb9f=_0x42146f[_0x19a4db(0x22a)][_0x19a4db(0x19e)],_0x350003=_0x42146f[_0x19a4db(0x22a)]['success']?_0x19a4db(0x1bd)+new Date()[_0x19a4db(0x29c)]()+'\x20('+_0x5d14b9+')':'Failed:\x20'+_0x42146f[_0x19a4db(0x22a)][_0x19a4db(0x147)];_0x51d1e5[_0x19a4db(0x1e9)](_0x19a4db(0x2b4),{'val':_0x350003,'ack':!![]});if(_0x42146f[_0x19a4db(0x22a)][_0x19a4db(0x1b9)]&&_0x4aeb9f)_0x51d1e5[_0x19a4db(0x1e9)](_0x19a4db(0x19b),{'val':_0x4aeb9f,'ack':!![]});}else{if(_0x42146f[_0x19a4db(0x1d2)]===_0x19a4db(0x180)){const {patterns:_0x45388b}=_0x42146f[_0x19a4db(0x22a)];if(_0x45388b&&_0x45388b[_0x19a4db(0x29e)]>0x0){_0x51d1e5[_0x19a4db(0x171)][_0x19a4db(0x259)](_0x19a4db(0x19f)+_0x45388b[_0x19a4db(0x29e)]+_0x19a4db(0x191)),_0x51d1e5[_0x19a4db(0x1e9)](_0x19a4db(0x1f2),{'val':JSON[_0x19a4db(0x152)](_0x45388b),'ack':!![]});const _0x237962=_0x45388b[0x0],_0xa13c27=_0x19a4db(0x13a)+_0x237962[_0x19a4db(0x16f)]+'\x20('+(_0x237962[_0x19a4db(0x192)]*0x64)[_0x19a4db(0x23d)](0x0)+'%)';_0x51d1e5[_0x19a4db(0x1e9)](_0x19a4db(0x1ad),{'val':!![],'ack':!![]}),_0x51d1e5['setStateAsync'](_0x19a4db(0x1a8),{'val':_0xa13c27,'ack':!![]});}else _0x51d1e5['log'][_0x19a4db(0x259)](_0x19a4db(0x182)),_0x51d1e5[_0x19a4db(0x1e9)](_0x19a4db(0x1ad),{'val':![],'ack':!![]}),_0x51d1e5[_0x19a4db(0x1e9)](_0x19a4db(0x1f2),{'val':'[]','ack':!![]});}else{if(_0x42146f['type']===_0x19a4db(0x1cd)){if(_0x42146f['payload'][_0x19a4db(0x1b9)])try{const _0x304f2e=JSON['parse'](_0x42146f['payload']['details']);if(_0x304f2e[_0x19a4db(0x1e4)])_0x51d1e5[_0x19a4db(0x1e9)](_0x19a4db(0x1c6),{'val':JSON[_0x19a4db(0x152)](_0x304f2e[_0x19a4db(0x1e4)]),'ack':!![]});if(_0x304f2e[_0x19a4db(0x2df)])_0x51d1e5['setStateAsync'](_0x19a4db(0x20f),{'val':JSON[_0x19a4db(0x152)](_0x304f2e['heating']),'ack':!![]});}catch(_0x1d4008){}}else{if(_0x42146f['type']===_0x19a4db(0x23b)){if(_0x42146f['payload'][_0x19a4db(0x1b9)])_0x51d1e5[_0x19a4db(0x171)][_0x19a4db(0x259)]('‚úÖ\x20HEALTH\x20TRAINED.');}else{if(_0x42146f[_0x19a4db(0x1d2)]===_0x19a4db(0x1fc))_0x51d1e5[_0x19a4db(0x1e9)](_0x19a4db(0x21a),{'val':new Date()[_0x19a4db(0x220)](),'ack':!![]}),_0x51d1e5['setStateAsync'](_0x19a4db(0x20e),{'val':_0x42146f[_0x19a4db(0x22a)][_0x19a4db(0x145)],'ack':!![]});else _0x42146f['type']===_0x19a4db(0x15d)&&(_0x51d1e5['setStateAsync'](_0x19a4db(0x1f5),{'val':_0x42146f[_0x19a4db(0x22a)][_0x19a4db(0x26d)],'ack':!![]}),_0x51d1e5[_0x19a4db(0x1e9)](_0x19a4db(0x186),{'val':_0x42146f['payload'][_0x19a4db(0x154)],'ack':!![]}));}}}}}}}function runPythonHealthCheck(_0xe3427e){const _0x564609=a0_0x5aab67;if(!_0xe3427e[_0x564609(0x299)]||_0xe3427e['dailyDigests'][_0x564609(0x29e)]<0x2)return;const _0x1ef420=_0xe3427e[_0x564609(0x299)]['map'](_0x3dfae5=>{const _0x674faf=(_0x3dfae5['activityLevel']||'')['toLowerCase']();return ACTIVITY_LEVEL_MAP[_0x674faf]||0x32;});sendToPython(_0xe3427e,'ANALYZE_TREND',{'values':_0x1ef420,'tag':_0x564609(0x225)});}async function handleTelegramResponse(_0x1806b7,_0x4d8ee1){const _0x15dfef=a0_0x5aab67;let _0x590d67=_0x4d8ee1;_0x4d8ee1[_0x15dfef(0x253)]('[')&&(_0x590d67=_0x4d8ee1[_0x15dfef(0x166)](_0x4d8ee1[_0x15dfef(0x2bd)](']')+0x1));if(_0x590d67==='COGNI_CONFIRM_OK')await _0x1806b7['setStateAsync'](_0x15dfef(0x2c2),{'val':![],'ack':!![]}),await _0x1806b7[_0x15dfef(0x1e9)](_0x15dfef(0x196),{'val':_0x15dfef(0x1b7),'ack':!![]}),_0x1806b7[_0x15dfef(0x2e4)]=![],sendNotification(_0x1806b7,'‚úÖ\x20Alarm\x20quittiert.\x20System\x20normal.',![]);else _0x590d67==='COGNI_REQUEST_CALL'&&sendNotification(_0x1806b7,_0x15dfef(0x22b),![],!![]);}async function sendNotification(_0x58e292,_0x113cbe,_0x29c5f4=![],_0x4b7998=![]){const _0x4ec500=a0_0x5aab67,_0x36f3d8=_0x58e292['config'];if(_0x36f3d8[_0x4ec500(0x1fe)]){let _0x2604e9={};(_0x113cbe['includes'](_0x4ec500(0x2e2))||_0x4b7998)&&(_0x2604e9={'reply_markup':{'inline_keyboard':[[{'text':'‚úÖ\x20Alles\x20OK\x20(Reset)','callback_data':_0x4ec500(0x26a)}],[{'text':'üìû\x20R√ºckruf\x20anfordern','callback_data':_0x4ec500(0x1a7)}]]}}),await _0x58e292[_0x4ec500(0x14e)](_0x36f3d8[_0x4ec500(0x272)],_0x4ec500(0x1d4),{'text':_0x113cbe,'user':_0x36f3d8[_0x4ec500(0x296)],..._0x2604e9});}if(_0x36f3d8[_0x4ec500(0x12f)]){let _0x25a7b7={'message':_0x113cbe,'title':_0x4b7998?'üö®\x20EMERGENCY':'Cogni-Living','priority':_0x4b7998?0x2:0x1,'device':_0x36f3d8['notifyPushoverRecipient']};_0x4b7998&&(_0x25a7b7[_0x4ec500(0x130)]=0x1e,_0x25a7b7[_0x4ec500(0x144)]=0xe10,_0x25a7b7[_0x4ec500(0x150)]=_0x4ec500(0x204)),await _0x58e292[_0x4ec500(0x14e)](_0x36f3d8[_0x4ec500(0x2a0)],_0x4ec500(0x1d4),_0x25a7b7);}_0x36f3d8[_0x4ec500(0x218)]&&await _0x58e292[_0x4ec500(0x14e)](_0x36f3d8['notifyEmailInstance'],'send',{'text':_0x113cbe,'to':_0x36f3d8[_0x4ec500(0x26c)]});}async function runGeminiAnalysis(_0x141e84,_0x123bf7=''){const _0x359a35=a0_0x5aab67;if(!_0x141e84[_0x359a35(0x26b)])return;if(_0x141e84[_0x359a35(0x1ab)][_0x359a35(0x29e)]===0x0)return;const _0x434e5c=_0x141e84[_0x359a35(0x1ab)]['slice'](0x0,0xf),_0x1b609e=await getWeatherContext(_0x141e84),_0x5f2ac8=_0x141e84[_0x359a35(0x1d1)],_0x2d37c7=PERSONA_MAPPING[_0x141e84[_0x359a35(0x2cd)][_0x359a35(0x264)]||_0x359a35(0x19d)],_0xe92639=_0x141e84[_0x359a35(0x2cd)][_0x359a35(0x133)]||_0x359a35(0x2e3);let _0x1eea52=_0x359a35(0x1a3);try{const _0x1a2e07=await _0x141e84['getStateAsync'](_0x359a35(0x208));if(_0x1a2e07&&_0x1a2e07['val'])_0x1eea52=_0x1a2e07[_0x359a35(0x2ba)];}catch(_0x518555){}let _0x1ebf62=![];try{const _0x46ff49=await _0x141e84['getStateAsync']('analysis.automation.autoApply');if(_0x46ff49&&_0x46ff49[_0x359a35(0x2ba)])_0x1ebf62=!![];}catch(_0x4507ca){}const _0x188773=_0x359a35(0x1d3)+_0x2d37c7+_0x359a35(0x134)+_0xe92639+'.\x20SYSTEM_MODE:\x20'+_0x5f2ac8+_0x359a35(0x21c)+_0x1b609e+'.\x20ANWESEND:\x20'+_0x1eea52+_0x359a35(0x243)+JSON['stringify'](_0x434e5c)+_0x359a35(0x14d)+_0x123bf7+'.\x20AUFGABE:\x201.\x20Gesundheit?\x202.\x20Komfort?\x20FORMAT\x20(JSON):\x20{\x20\x22isAlert\x22:\x20boolean,\x20\x22alertReason\x22:\x20\x22string\x22,\x20\x22isEmergency\x22:\x20boolean,\x20\x22summary\x22:\x20\x22string\x22,\x20\x22automationProposal\x22:\x20{\x20\x22detected\x22:\x20boolean,\x20\x22description\x22:\x20\x22string\x22,\x20\x22targetId\x22:\x20\x22string\x22,\x20\x22targetValue\x22:\x20\x22any\x22\x20}\x20}';try{const _0x123729=await _0x141e84['geminiModel'][_0x359a35(0x167)](_0x188773),_0x517ebc=JSON['parse'](_0x123729[_0x359a35(0x2b5)]['text']()['replace'](/```json|```/g,'')[_0x359a35(0x20a)]());await _0x141e84[_0x359a35(0x1e9)](_0x359a35(0x261),{'val':JSON[_0x359a35(0x152)](_0x517ebc),'ack':!![]});if(_0x517ebc[_0x359a35(0x1aa)])await _0x141e84['setStateAsync'](_0x359a35(0x27e),{'val':_0x517ebc[_0x359a35(0x1aa)],'ack':!![]});const _0x145bd7={'timestamp':Date['now'](),'id':Date[_0x359a35(0x194)]()[_0x359a35(0x13f)](),'analysis':{'activity':{'summary':_0x517ebc['summary'],'isAlert':_0x517ebc[_0x359a35(0x2dd)],'alertReason':_0x517ebc[_0x359a35(0x255)]},'comfort':{'automationProposal':_0x517ebc[_0x359a35(0x24e)]}}};await updateAnalysisHistory(_0x141e84,_0x145bd7);const _0x247495=_0x517ebc[_0x359a35(0x2dd)]||![];_0x247495!==_0x141e84[_0x359a35(0x2e4)]&&(await _0x141e84[_0x359a35(0x1e9)](_0x359a35(0x2c2),{'val':_0x247495,'ack':!![]}),_0x141e84[_0x359a35(0x2e4)]=_0x247495,_0x247495&&(await _0x141e84[_0x359a35(0x1e9)](_0x359a35(0x196),{'val':_0x517ebc['alertReason'],'ack':!![]}),sendNotification(_0x141e84,'‚ö†Ô∏è\x20ALARM:\x20'+_0x517ebc[_0x359a35(0x255)],![],_0x517ebc[_0x359a35(0x183)])));if(_0x517ebc[_0x359a35(0x24e)]&&_0x517ebc['automationProposal'][_0x359a35(0x161)]){await _0x141e84[_0x359a35(0x1e9)]('analysis.automation.patternDetected',{'val':!![],'ack':!![]}),await _0x141e84[_0x359a35(0x1e9)](_0x359a35(0x1a8),{'val':_0x517ebc['automationProposal'][_0x359a35(0x1da)],'ack':!![]}),await _0x141e84['setStateAsync'](_0x359a35(0x174),{'val':_0x517ebc[_0x359a35(0x24e)]['targetId'],'ack':!![]}),await _0x141e84[_0x359a35(0x1e9)]('analysis.automation.targetValue',{'val':JSON['stringify'](_0x517ebc[_0x359a35(0x24e)]['targetValue']),'ack':!![]});if(_0x1ebf62)executeAutomationAction(_0x141e84);}}catch(_0x33f681){_0x141e84['log'][_0x359a35(0x138)](_0x359a35(0x221)+_0x33f681['message']);}}async function createDailyDigest(_0x5089fd){const _0x307ac6=a0_0x5aab67;if(!_0x5089fd[_0x307ac6(0x1ec)])return;await _0x5089fd[_0x307ac6(0x1e9)](LTM_DP_STATUS,{'val':_0x307ac6(0x2c4),'ack':!![]});if(!_0x5089fd[_0x307ac6(0x26b)]||_0x5089fd[_0x307ac6(0x2d5)][_0x307ac6(0x29e)]<LTM_MIN_EVENTS_FOR_COMPRESSION){await _0x5089fd[_0x307ac6(0x1e9)](LTM_DP_STATUS,{'val':_0x307ac6(0x15e),'ack':!![]});return;}const _0x17f862=JSON[_0x307ac6(0x2d7)](JSON[_0x307ac6(0x152)](_0x5089fd[_0x307ac6(0x2d5)])),_0x2ab7b6=_0x17f862[_0x307ac6(0x29e)],_0xc6e9a0=new Array(0x60)[_0x307ac6(0x219)](0x0),_0x4260a4=new Date()['setHours'](0x0,0x0,0x0,0x0);_0x17f862['forEach'](_0xb2752b=>{const _0x5edf19=_0x307ac6,_0x4d1400=new Date(_0xb2752b['timestamp']),_0x24f1a3=_0x4d1400[_0x5edf19(0x280)](),_0x544e38=_0x4d1400['getMinutes'](),_0x49b011=_0x24f1a3*0x4+Math[_0x5edf19(0x273)](_0x544e38/0xf);if(_0x49b011>=0x0&&_0x49b011<0x60)_0xc6e9a0[_0x49b011]++;});const _0x81c8f0=_0x307ac6(0x1b2)+JSON[_0x307ac6(0x152)](_0x17f862[_0x307ac6(0x18b)](0x0,0x32));try{const _0x1223bb=await _0x5089fd[_0x307ac6(0x26b)][_0x307ac6(0x167)](_0x81c8f0),_0x69c3bd=JSON[_0x307ac6(0x2d7)](_0x1223bb['response'][_0x307ac6(0x23e)]()[_0x307ac6(0x1a4)](/```json|```/g,'')[_0x307ac6(0x20a)]()),_0x25543a={'timestamp':new Date()[_0x307ac6(0x220)](),'eventCount':_0x2ab7b6,'summary':_0x69c3bd['summary']||_0x307ac6(0x19a),'activityLevel':_0x69c3bd[_0x307ac6(0x24f)]||'normal','systemMode':_0x5089fd['currentSystemMode'],'activityVector':_0xc6e9a0};_0x5089fd[_0x307ac6(0x299)][_0x307ac6(0x2bf)](_0x25543a),await saveDailyDigests(_0x5089fd),_0x5089fd['rawEventLog']=[],await saveRawEventLog(_0x5089fd),await _0x5089fd[_0x307ac6(0x1e9)](LTM_DP_STATUS,{'val':_0x307ac6(0x1d7),'ack':!![]});if(_0x5089fd[_0x307ac6(0x1ec)])sendToPython(_0x5089fd,_0x307ac6(0x197),{'digest':_0x25543a});}catch(_0x2af63d){_0x5089fd[_0x307ac6(0x171)]['error'](_0x2af63d[_0x307ac6(0x187)]);}}function setupLtmScheduler(_0x1c46d5){const _0x429abd=a0_0x5aab67;try{if(_0x1c46d5[_0x429abd(0x17a)])_0x1c46d5['ltmJob'][_0x429abd(0x2db)]();if(!_0x1c46d5[_0x429abd(0x1ec)])return;_0x1c46d5[_0x429abd(0x17a)]=schedule['scheduleJob'](LTM_SCHEDULE,()=>createDailyDigest(_0x1c46d5));}catch(_0x30fb0a){_0x1c46d5[_0x429abd(0x171)]['error']('LTM\x20Sched\x20Error:\x20'+_0x30fb0a[_0x429abd(0x187)]);}}function setupModeResetScheduler(_0x5a4cde){const _0x2c1f42=a0_0x5aab67;try{if(_0x5a4cde[_0x2c1f42(0x246)])_0x5a4cde['modeResetJob'][_0x2c1f42(0x2db)]();_0x5a4cde[_0x2c1f42(0x246)]=schedule[_0x2c1f42(0x1ca)](MODE_RESET_SCHEDULE,async()=>{const _0x43c7b8=_0x2c1f42;await loadSystemMode(_0x5a4cde),AUTO_RESET_MODES[_0x43c7b8(0x232)](_0x5a4cde[_0x43c7b8(0x1d1)])&&await _0x5a4cde[_0x43c7b8(0x1e9)](SYSTEM_DP_MODE,{'val':SYSTEM_MODES[_0x43c7b8(0x1b8)],'ack':![]});});}catch(_0x4b60e0){_0x5a4cde[_0x2c1f42(0x171)]['error'](_0x2c1f42(0x1c2)+_0x4b60e0[_0x2c1f42(0x187)]);}}function setupDriftAnalysisScheduler(_0x4e66b2){const _0x5709e8=a0_0x5aab67;try{if(_0x4e66b2[_0x5709e8(0x1b4)])clearInterval(_0x4e66b2['driftAnalysisTimer']);if(!_0x4e66b2[_0x5709e8(0x1ec)])return;_0x4e66b2[_0x5709e8(0x1b4)]=setInterval(()=>runBaselineDriftAnalysis(_0x4e66b2),(_0x4e66b2[_0x5709e8(0x2cd)][_0x5709e8(0x1a1)]||0x18)*0x36ee80),setTimeout(()=>runBaselineDriftAnalysis(_0x4e66b2),0x1388);}catch(_0x4b2ee6){_0x4e66b2['log']['error'](_0x5709e8(0x1f4)+_0x4b2ee6[_0x5709e8(0x187)]);}}function a0_0x3cab(){const _0xc1ca2c=['Description','\x22\x20install\x20--no-cache-dir\x20--force-reinstall\x20-r\x20\x22','startsWith','Kalender\x20deaktiviert.','alertReason','subscribeStates','11239860xWbyrd','bewegung','info','System\x20Mode','system','filter','LTM.driftAnalysis.driftDetails','indicator','(((.+)+)+)+$','7131704XHWCIb','analysis.lastResult','0\x204\x20*\x20*\x20*','number','aiPersona','604536mCAAOZ','Target\x20ID','string','geminiApiKey','Daily\x20Digests','COGNI_CONFIRM_OK','geminiModel','notifyEmailRecipient','diagnosis','Installing\x20pip\x20packages...','Health\x20Analysis','from','vacation','notifyTelegramInstance','floor','switch','.venv','split','N/A','close','briefingJob','unload','bin','outdoorSensorId','LTM.triggerDailyDigest','analysis.activitySummary','TRAIN_HEALTH','getHours','Auto\x20Apply','Restoring\x20sensor\x20cache...','scanDevices','weatherunderground','[RECORDER]\x20Error:\x20','analysis.training','kontakt','Scripts','analysis.trigger','Security\x20Monitor','analysis.security.lastScore','analysis.security.lastCheck','üß†\x20Triggering\x20Security\x20Training...','Energy\x20Intelligence','‚úÖ\x20INSTALL\x20SUCCESS.','indicator.alarm','.Current.WeatherText','Wetterdaten\x20deaktiviert.','find','object','ROLLE:\x20Data\x20Scientist.\x20ZIEL:\x20Drift\x20erkennen.\x20SCHEMA:\x20{\x20\x22baselineDrift\x22:\x20\x22none|slight|significant|critical\x22,\x20\x22driftDetails\x22:\x20\x22string\x22\x20}\x0a\x0aLTB:\x20','notifyTelegramRecipient','TRAINING_COMPLETE','sendTo','dailyDigests','isGracePeriodActive','systemConfig','toLocaleTimeString','events.lastEvent','length','dependencyInstallInProgress','notifyPushoverInstance','Train\x20Comfort','temperature','join','lights','system.mode','Trend','LTM.processingStatus','LTM.driftAnalysis.lastCheck','constructor','Activity\x20Summary','sensorLastValues','Ungew√∂hnliches\x20Bewegungsmuster!\x20(Score:\x20','Error\x20launching\x20Python:\x20','Train\x20Energy','Keine\x20Termine.','loc','endsWith','LTM.dailyDigests','LTM.trainingData.sequences','analysis.training.status','response','getStateAsync','SECURITY_RESULT','data','exitGraceTimer','val','pop','getCalendarNames','indexOf','9261025SBNcck','push','Sec-Training\x20started...','contact','analysis.isAlert','analysisHistory','Started...',')\x20-\x20SAFE\x20BOOT','Training\x20Error:\x20','baselineDrift','üõ°Ô∏è\x20SECURITY\x20CHECK:\x20Score\x20','N/A\x20(Learning)','Err:\x20','longitude','t√ºr','config','boolean','onStateChange','bind','isExit','python.exe','pythonProcess','PRIORIT√ÑT:\x20Sicherheit.','rawEventLog','presence','parse','channel','child_process','role','cancel','some','isAlert','window','heating','command','10064950wqjMek','Alarm','Keine\x20Details.','lastAlertState','.communicate.request','exitTimer','existsSync','notifyPushoverEnabled','retry','search','Anomaly\x20Detected','livingContext','.\x20KONTEXT:\x20','briefingTime','getLtmData','\x20*\x20*\x20*','error','isPresent','Regel\x20erkannt:\x20','targetId','autoApply','doors','Gemini\x20AI\x20initialized.','toString','useCalendar','analysis.training.triggerEnergy','fenster','requirements.txt','expire','is_anomaly','getGenerativeModel','reason','targetValue','üõãÔ∏è\x20Triggering\x20Comfort\x20Analysis\x20(Pattern\x20Mining)...','.Current.Temperature','.forecast.current.state','Alert\x20Status','.\x20EMERGENCY:\x20','sendToAsync','debug','sound','win32','stringify','communicate.request','change_percent','analysis.health.todayVector','Lernphase\x20(','Keine\x20Wetterdaten\x20verf√ºgbar.','forEach','testApiKey','Last\x20Check','Insulation\x20Score','logDuplicates','TREND_RESULT','Skipped\x20(No\x20AI\x20or\x20Data)','exports','analysis.automation.autoApply','detected','write','city','Anomaly\x20Score','No\x20instance','substring','generateContent','Unknown','onReady','56613XzMmVF','python','onUnload','\x20=\x20','0\x203\x20*\x20*\x20*','rule','Training\x20Status','log','Missing\x20data','Event\x20History','analysis.automation.targetId','TRAIN_ENERGY','Fokus\x20auf\x20Komfort.','getForeignObjectsAsync','@google/generative-ai','python_service','ltmJob','getForeignStateAsync','python3\x20-m\x20venv\x20\x22','details','toLowerCase','occupancy','COMFORT_RESULT','analysis.training.triggerSecurity','üõãÔ∏è\x20BUTLER:\x20Keine\x20neuen\x20Muster\x20gefunden.','isEmergency','LTM.driftAnalysis.baselineDrift','inactivityThresholdHours','analysis.health.trendValue','message','üêç\x20Python\x20Pong','stdin','presenceDevices','slice','[RESULT]','analysis.automation.triggerAction','User\x20dismissed\x20automation\x20proposal.','events.history','ltmLtbWindowDays','\x20new\x20patterns.','confidence','\x20Tage)','now','service.py','analysis.alertReason','ANALYZE_HEALTH','callback','stdout','Digest','analysis.security.currentThreshold','minDaysForBaseline','generic','threshold','üõãÔ∏è\x20BUTLER:\x20Found\x20','setState','ltmDriftCheckIntervalHours','ltmStbWindowDays','Unbekannt','replace','Trigger\x20Analysis','weatherInstance','COGNI_REQUEST_CALL','analysis.automation.description','schalter','summary','eventHistory','date','analysis.automation.patternDetected','LTM.trainingData.thermodynamics','getTime','üöÄ\x20Starting\x20NUUKANNI\x20Logic\x20(v0.10.1)...','getOverviewData','ROLLE:\x20Data\x20Compression\x20Agent.\x20SPRACHE:\x20DE.\x20FORMAT:\x20JSON.\x20ANWEISUNG:\x20Fasse\x20Sensor-Events\x20zusammen.\x20SCHEMA:\x20{\x20\x22summary\x22:\x20\x22string\x22,\x20\x22activityLevel\x22:\x20\x22string\x22\x20}\x20\x0a\x0aEVENTS:\x0a','heizung','driftAnalysisTimer','licht','analysisTimer','Vom\x20Benutzer\x20best√§tigt\x20(OK).','NORMAL','success','KI-Modell\x20nicht\x20initialisiert','Today\x20Vector\x20(15m)','08:00','Success:\x20','Adapter','Erstelle\x20ein\x20kurzes\x20\x27Guten\x20Morgen\x27\x20Briefing\x20basierend\x20auf\x20den\x20Events\x20der\x20letzten\x20Nacht.','ANALYZE_SEQUENCE','submitFeedback','Reset\x20Sched\x20Error:\x20','‚ö†Ô∏è\x20SECURITY\x20ALARM:\x20','delObjectAsync','version','analysis.energy.insulationScore','openweathermap','Heating\x20Score','events.history_debug_00','scheduleJob','rmSync','Aktiv\x20(','ENERGY_TRAIN_RESULT','triggerBriefing','Gemini\x20Init\x20Error:\x20','node-schedule','currentSystemMode','type','ROLLE:\x20KI-Hausverwalter.\x20PERSONA:\x20','send','\x0aSTB:\x20','Trigger\x20Briefing','Success','Who\x20is\x20present?','accuweather','description','üîç\x20Scanning\x20for\x20devices...','analysis.health','telegram','devices','analysis.security','systemUUID','system.config','getDate','briefingEnabled','insulation','\x0aGrund:\x20','unknown','analysis.training.triggerComfort','system.isPresent','setStateAsync','cogni-living\x20adapter\x20starting\x20(v','splice','isProVersion','Kein\x20API\x20Key.','cogni-living','platform','Target\x20Value','.forecast.current.temperature','analysis.automation.detectedPatterns','setObjectNotExistsAsync','Drift\x20Sched\x20Error:\x20','analysis.health.trendDiagnosis','shift','name','Pattern\x20Detected','extendObjectAsync','licenseKey','Last\x20raw\x20event','HEALTH_RESULT','status','notifyTelegramEnabled','values','PRIORIT√ÑT:\x20Gesundheit/AAL.','application/json','temperatur','genAI','siren','driftDetails','ack','LTM.driftAnalysis','system.presenceWho','main','trim','rating','Thermodynamics','setHours','analysis.health.isAnomaly','analysis.energy.heatingScore','text.alarm','analysis.triggerBriefing','enum','useWeather','PONG','motion','door','.forecast.current.temp','notifyEmailEnabled','fill','analysis.health.lastCheck','lampe','.\x20WETTER:\x20','map','645376PKzJVq','Sequences','toISOString','Gemini\x20Error:\x20','GUEST','button','analysis.analysisHistory','Activity-Level','analysis.training.triggerHealth','getForeignObjectAsync','common','System','payload','üìû\x20R√úCKRUF\x20BITTE!\x20Der\x20Bewohner\x20hat\x20den\x20R√ºckruf-Button\x20gedr√ºckt.','json','[LOG]','light','OK:\x20','namespace','TRAIN_COMFORT','includes','Raw\x20Log','getMinutes','timestamp','analysis.history_debug_00','analysis.automation.targetValue','state','value','apiKey','HEALTH_TRAIN_RESULT','subscribeForeignStatesAsync','toFixed','text','onMessage','getObjectAsync','BUTLER\x20Execution\x20Error:\x20','daswetter','.\x20EVENTS:\x20','LTM.baselineStatus','¬∞C,\x20','modeResetJob','online','writable','ü§ñ\x20BUTLER:\x20Executing\x20Action\x20->\x20','round','setForeignStateAsync','Briefing\x20Sched\x20Error:\x20','unshift','automationProposal','activityLevel','Trigger\x20Action'];a0_0x3cab=function(){return _0xc1ca2c;};return a0_0x3cab();}function setupBriefingScheduler(_0x1e4be4){const _0x143e18=a0_0x5aab67;try{if(_0x1e4be4[_0x143e18(0x279)])_0x1e4be4[_0x143e18(0x279)][_0x143e18(0x2db)]();if(!_0x1e4be4[_0x143e18(0x2cd)][_0x143e18(0x1e3)])return;const _0x1c8d98=(_0x1e4be4['config'][_0x143e18(0x135)]||_0x143e18(0x1bc))['split'](':'),_0x10c875=parseInt(_0x1c8d98[0x0])||0x8,_0x163db6=parseInt(_0x1c8d98[0x1])||0x0,_0x4fa6e1=_0x163db6+'\x20'+_0x10c875+_0x143e18(0x137);_0x1e4be4['briefingJob']=schedule[_0x143e18(0x1ca)](_0x4fa6e1,()=>{sendMorningBriefing(_0x1e4be4);});}catch(_0x57493b){_0x1e4be4[_0x143e18(0x171)][_0x143e18(0x138)](_0x143e18(0x24c)+_0x57493b[_0x143e18(0x187)]);}}async function runBaselineDriftAnalysis(_0x4987a7){const _0x12373d=a0_0x5aab67;if(!_0x4987a7['isProVersion']||!_0x4987a7[_0x12373d(0x26b)])return;const _0x53f4ef=_0x4987a7[_0x12373d(0x2cd)][_0x12373d(0x1a2)]||0xe;if(_0x4987a7['dailyDigests']['length']<_0x53f4ef+0x7){await _0x4987a7['setStateAsync'](LTM_DP_DRIFT_STATUS,{'val':_0x12373d(0x2c9),'ack':!![]});return;}const _0x2d3252=_0x4987a7[_0x12373d(0x299)][_0x12373d(0x18b)](-_0x53f4ef),_0x470369=_0x4987a7['dailyDigests']['slice'](0x0,_0x4987a7[_0x12373d(0x299)]['length']-_0x53f4ef),_0x11114d=_0x12373d(0x295)+JSON[_0x12373d(0x152)](_0x470369)+_0x12373d(0x1d5)+JSON['stringify'](_0x2d3252);try{const _0x3d132a=await _0x4987a7[_0x12373d(0x26b)][_0x12373d(0x167)](_0x11114d),_0x3a3684=JSON[_0x12373d(0x2d7)](_0x3d132a[_0x12373d(0x2b5)]['text']()['replace'](/```json|```/g,'')[_0x12373d(0x20a)]());_0x3a3684[_0x12373d(0x2c7)]&&(await _0x4987a7[_0x12373d(0x1e9)](LTM_DP_DRIFT_STATUS,{'val':_0x3a3684[_0x12373d(0x2c7)],'ack':!![]}),await _0x4987a7[_0x12373d(0x1e9)](LTM_DP_DRIFT_DETAILS,{'val':_0x3a3684[_0x12373d(0x205)],'ack':!![]}),await _0x4987a7[_0x12373d(0x1e9)](LTM_DP_DRIFT_LAST_CHECK,{'val':Date[_0x12373d(0x194)](),'ack':!![]}));}catch(_0x48511e){}}class CogniLiving extends utils[a0_0x5aab67(0x1be)]{constructor(_0x1860c0){const _0x2a3d19=a0_0x5aab67;super({..._0x1860c0,'name':_0x2a3d19(0x1ee)}),this[_0x2a3d19(0x1ab)]=[],this[_0x2a3d19(0x2c3)]=[],this[_0x2a3d19(0x2d5)]=[],this[_0x2a3d19(0x299)]=[],this[_0x2a3d19(0x2ab)]={},this[_0x2a3d19(0x29b)]={'latitude':0x0,'longitude':0x0,'city':''},this[_0x2a3d19(0x139)]=!![],this[_0x2a3d19(0x2e6)]=null,this[_0x2a3d19(0x2b9)]=null,this[_0x2a3d19(0x29a)]=![],this['genAI']=null,this[_0x2a3d19(0x26b)]=null,this[_0x2a3d19(0x1d1)]=SYSTEM_MODES[_0x2a3d19(0x1b8)],this[_0x2a3d19(0x1ec)]=![],this[_0x2a3d19(0x2e4)]=![],this[_0x2a3d19(0x1e0)]=_0x2a3d19(0x1e6),this[_0x2a3d19(0x1b6)]=null,this[_0x2a3d19(0x17a)]=null,this['modeResetJob']=null,this[_0x2a3d19(0x1b4)]=null,this[_0x2a3d19(0x279)]=null,this[_0x2a3d19(0x2d3)]=null,this[_0x2a3d19(0x29f)]=![],this['on']('ready',this[_0x2a3d19(0x169)][_0x2a3d19(0x2d0)](this)),this['on']('stateChange',this[_0x2a3d19(0x2cf)]['bind'](this)),this['on'](_0x2a3d19(0x27a),this[_0x2a3d19(0x16c)][_0x2a3d19(0x2d0)](this)),this['on'](_0x2a3d19(0x187),this['onMessage']['bind'](this));}async[a0_0x5aab67(0x169)](){const _0x3f52f0=a0_0x5aab67;this[_0x3f52f0(0x171)][_0x3f52f0(0x259)](_0x3f52f0(0x1ea)+this[_0x3f52f0(0x1c5)]+_0x3f52f0(0x2c5));if(!checkAndInstall(this))return;await startSystem(this);}[a0_0x5aab67(0x16c)](_0x3237b5){const _0x4e1453=a0_0x5aab67;if(this['analysisTimer'])clearInterval(this['analysisTimer']);if(this[_0x4e1453(0x1b4)])clearInterval(this[_0x4e1453(0x1b4)]);if(this[_0x4e1453(0x17a)])this[_0x4e1453(0x17a)][_0x4e1453(0x2db)]();if(this[_0x4e1453(0x246)])this['modeResetJob'][_0x4e1453(0x2db)]();if(this[_0x4e1453(0x279)])this[_0x4e1453(0x279)][_0x4e1453(0x2db)]();if(this[_0x4e1453(0x2e6)])clearTimeout(this[_0x4e1453(0x2e6)]);if(this[_0x4e1453(0x2b9)])clearTimeout(this[_0x4e1453(0x2b9)]);stopPythonService(this),_0x3237b5();}async['onStateChange'](_0x38df68,_0x5b258d){const _0x3f50c5=a0_0x5aab67;if(!_0x5b258d||this[_0x3f50c5(0x29f)])return;if(_0x38df68[_0x3f50c5(0x232)](_0x3f50c5(0x1dd))&&_0x38df68[_0x3f50c5(0x2b1)](_0x3f50c5(0x153))&&_0x5b258d['val']){await handleTelegramResponse(this,_0x5b258d[_0x3f50c5(0x2ba)]);return;}if(_0x38df68===this[_0x3f50c5(0x230)]+'.'+SYSTEM_DP_MODE){if(_0x5b258d[_0x3f50c5(0x2ba)]&&Object[_0x3f50c5(0x1ff)](SYSTEM_MODES)['includes'](_0x5b258d[_0x3f50c5(0x2ba)])){this[_0x3f50c5(0x1d1)]=_0x5b258d[_0x3f50c5(0x2ba)];if(_0x5b258d[_0x3f50c5(0x2ba)]===SYSTEM_MODES['VACATION'])await setPresence(this,![]);else await setPresence(this,!![]);}if(!_0x5b258d[_0x3f50c5(0x206)])this[_0x3f50c5(0x1a0)](_0x38df68,{'val':this[_0x3f50c5(0x1d1)],'ack':!![]});return;}if(!_0x5b258d[_0x3f50c5(0x206)]){_0x38df68[_0x3f50c5(0x232)](_0x3f50c5(0x289))&&_0x5b258d[_0x3f50c5(0x2ba)]&&(this[_0x3f50c5(0x1a0)](_0x38df68,{'val':![],'ack':!![]}),runGeminiAnalysis(this));if(_0x38df68[_0x3f50c5(0x232)]('triggerDailyDigest')&&_0x5b258d[_0x3f50c5(0x2ba)]){this['setState'](_0x38df68,{'val':![],'ack':!![]});if(this['isProVersion'])createDailyDigest(this);}_0x38df68['includes'](_0x3f50c5(0x1ce))&&_0x5b258d[_0x3f50c5(0x2ba)]&&(this[_0x3f50c5(0x1a0)](_0x38df68,{'val':![],'ack':!![]}),sendMorningBriefing(this));_0x38df68[_0x3f50c5(0x232)]('automation.triggerAction')&&_0x5b258d[_0x3f50c5(0x2ba)]&&(this[_0x3f50c5(0x1a0)](_0x38df68,{'val':![],'ack':!![]}),executeAutomationAction(this));if(_0x38df68[_0x3f50c5(0x232)](_0x3f50c5(0x181))&&_0x5b258d[_0x3f50c5(0x2ba)]){this['setState'](_0x38df68,{'val':![],'ack':!![]});if(this[_0x3f50c5(0x1ec)])try{const _0x17d2e4=await this[_0x3f50c5(0x2b6)](_0x3f50c5(0x2b3));if(_0x17d2e4&&_0x17d2e4[_0x3f50c5(0x2ba)]){const _0x8db337=JSON[_0x3f50c5(0x2d7)](_0x17d2e4[_0x3f50c5(0x2ba)]);this[_0x3f50c5(0x171)]['info'](_0x3f50c5(0x28d)),this[_0x3f50c5(0x1e9)](_0x3f50c5(0x2b4),{'val':_0x3f50c5(0x2c0),'ack':!![]}),sendToPython(this,'TRAIN_SECURITY',{'sequences':_0x8db337});}}catch(_0x102902){this[_0x3f50c5(0x171)][_0x3f50c5(0x138)](_0x3f50c5(0x2c6)+_0x102902[_0x3f50c5(0x187)]);}}if(_0x38df68['includes'](_0x3f50c5(0x226))&&_0x5b258d['val']){this[_0x3f50c5(0x1a0)](_0x38df68,{'val':![],'ack':!![]});if(this['isProVersion'])try{const _0xa80a4a=await this[_0x3f50c5(0x2b6)](LTM_DP_DAILY_DIGESTS);if(_0xa80a4a&&_0xa80a4a[_0x3f50c5(0x2ba)])sendToPython(this,_0x3f50c5(0x27f),{'digests':JSON[_0x3f50c5(0x2d7)](_0xa80a4a[_0x3f50c5(0x2ba)])});}catch(_0x4afe9f){}}if(_0x38df68[_0x3f50c5(0x232)](_0x3f50c5(0x141))&&_0x5b258d[_0x3f50c5(0x2ba)]){this[_0x3f50c5(0x1a0)](_0x38df68,{'val':![],'ack':!![]});if(this[_0x3f50c5(0x1ec)])try{const _0x3f9af9=await this[_0x3f50c5(0x2b6)]('LTM.trainingData.thermodynamics');if(_0x3f9af9&&_0x3f9af9[_0x3f50c5(0x2ba)])sendToPython(this,_0x3f50c5(0x175),{'points':JSON[_0x3f50c5(0x2d7)](_0x3f9af9[_0x3f50c5(0x2ba)])});}catch(_0x3b5690){}}if(_0x38df68[_0x3f50c5(0x232)]('analysis.training.triggerComfort')&&_0x5b258d[_0x3f50c5(0x2ba)]){this[_0x3f50c5(0x1a0)](_0x38df68,{'val':![],'ack':!![]});if(this[_0x3f50c5(0x1ec)])try{const _0x183adb=await this['getStateAsync'](LTM_DP_RAW_LOG);_0x183adb&&_0x183adb[_0x3f50c5(0x2ba)]&&(this[_0x3f50c5(0x171)][_0x3f50c5(0x259)](_0x3f50c5(0x149)),sendToPython(this,_0x3f50c5(0x231),{'events':JSON['parse'](_0x183adb[_0x3f50c5(0x2ba)])}));}catch(_0x23137b){}}return;}if(this[_0x3f50c5(0x2cd)]['presenceDevices']&&this[_0x3f50c5(0x2cd)][_0x3f50c5(0x18a)][_0x3f50c5(0x232)](_0x38df68)){await checkWifiPresence(this);return;}const _0x9771c6=(this['config'][_0x3f50c5(0x1de)]||[])[_0x3f50c5(0x293)](_0x5bca22=>_0x5bca22['id']===_0x38df68);if(_0x9771c6)processSensorEvent(this,_0x38df68,_0x5b258d,_0x9771c6);}async[a0_0x5aab67(0x23f)](_0x2807e6){const _0x448e10=a0_0x5aab67;if(typeof _0x2807e6==='object'&&_0x2807e6[_0x448e10(0x187)]){if(_0x2807e6['command']===_0x448e10(0x159)){const _0x1b785a=_0x2807e6[_0x448e10(0x187)][_0x448e10(0x23a)]||this[_0x448e10(0x2cd)][_0x448e10(0x268)];if(!_0x1b785a)return this[_0x448e10(0x298)](_0x2807e6[_0x448e10(0x270)],_0x2807e6[_0x448e10(0x2e0)],{'success':![],'message':_0x448e10(0x1ed)},_0x2807e6['callback']);try{const _0x56e7cd=new GoogleGenerativeAI(_0x1b785a),_0x1051ae=_0x56e7cd[_0x448e10(0x146)]({'model':GEMINI_MODEL}),_0x27d331=await _0x1051ae[_0x448e10(0x167)]('Hi');this[_0x448e10(0x298)](_0x2807e6[_0x448e10(0x270)],_0x2807e6[_0x448e10(0x2e0)],{'success':!![],'message':_0x448e10(0x22f)+_0x27d331[_0x448e10(0x2b5)][_0x448e10(0x23e)]()},_0x2807e6[_0x448e10(0x198)]);}catch(_0x5e3235){this['sendTo'](_0x2807e6[_0x448e10(0x270)],_0x2807e6[_0x448e10(0x2e0)],{'success':![],'message':_0x448e10(0x2ca)+_0x5e3235[_0x448e10(0x187)]},_0x2807e6['callback']);}}else{if(_0x2807e6['command']==='testContext'){const _0x32fc26=await getWeatherContext(this),_0x3124eb=await getCalendarContext(this);this[_0x448e10(0x298)](_0x2807e6[_0x448e10(0x270)],_0x2807e6['command'],{'success':!![],'weather':_0x32fc26,'calendar':_0x3124eb},_0x2807e6['callback']);}else{if(_0x2807e6[_0x448e10(0x2e0)]===_0x448e10(0x136)){if(!this[_0x448e10(0x1ec)])return this['sendTo'](_0x2807e6[_0x448e10(0x270)],_0x2807e6[_0x448e10(0x2e0)],{'success':![],'isPro':![]},_0x2807e6[_0x448e10(0x198)]);let _0x394767={'status':_0x448e10(0x277)};try{const _0x177892=await this[_0x448e10(0x2b6)](LTM_DP_DRIFT_STATUS);_0x394767[_0x448e10(0x1fd)]=_0x177892?_0x177892[_0x448e10(0x2ba)]:_0x448e10(0x277);}catch(_0x517f96){}this['sendTo'](_0x2807e6[_0x448e10(0x270)],_0x2807e6[_0x448e10(0x2e0)],{'success':!![],'isPro':!![],'dailyDigests':this[_0x448e10(0x299)],'driftAnalysis':_0x394767,'analysisHistory':this[_0x448e10(0x2c3)]},_0x2807e6['callback']);}else{if(_0x2807e6[_0x448e10(0x2e0)]===_0x448e10(0x1b1)){const _0x5ce3a2=this['dailyDigests'][_0x448e10(0x29e)],_0x2465d7=new Date(),_0x561751=new Date(_0x2465d7['getFullYear'](),_0x2465d7['getMonth'](),_0x2465d7[_0x448e10(0x1e2)]())[_0x448e10(0x1af)](),_0x1a07e8=this[_0x448e10(0x2d5)][_0x448e10(0x25c)](_0xf8e30c=>new Date(_0xf8e30c[_0x448e10(0x235)])[_0x448e10(0x1af)]()>_0x561751)[_0x448e10(0x29e)],_0x4beee0=new Array(0x18)['fill'](0x0);this[_0x448e10(0x2d5)][_0x448e10(0x158)](_0x1e73e3=>{const _0x30bf6f=_0x448e10,_0x41d9b0=new Date(_0x1e73e3[_0x30bf6f(0x235)]);if(_0x41d9b0[_0x30bf6f(0x1af)]()>_0x561751)_0x4beee0[_0x41d9b0[_0x30bf6f(0x280)]()]++;});let _0x171e82={'status':_0x448e10(0x277)};try{const _0x23e26e=await this[_0x448e10(0x2b6)](LTM_DP_DRIFT_STATUS);_0x171e82[_0x448e10(0x1fd)]=_0x23e26e?_0x23e26e['val']:_0x448e10(0x277);}catch(_0x42b023){}let _0x1ddbba='';try{const _0x304fa2=await this[_0x448e10(0x2b6)](_0x448e10(0x208));_0x1ddbba=_0x304fa2?_0x304fa2[_0x448e10(0x2ba)]:'';}catch(_0x35e8aa){}let _0x1b36f3=null;!this[_0x448e10(0x26b)]&&(_0x1b36f3=this[_0x448e10(0x2cd)][_0x448e10(0x268)]?_0x448e10(0x1ba):'Kein\x20API\x20Key!');let _0x36b3fe={'detected':![],'description':'','targetId':'','targetValue':'','autoApply':![]};try{const _0x24a0c0=await this[_0x448e10(0x2b6)]('analysis.automation.patternDetected');if(_0x24a0c0&&_0x24a0c0['val']){_0x36b3fe[_0x448e10(0x161)]=!![];const _0x9b631d=await this[_0x448e10(0x2b6)](_0x448e10(0x1a8));_0x36b3fe[_0x448e10(0x1da)]=_0x9b631d?_0x9b631d['val']:'';const _0x129232=await this['getStateAsync'](_0x448e10(0x174));_0x36b3fe[_0x448e10(0x13b)]=_0x129232?_0x129232[_0x448e10(0x2ba)]:'';const _0x1f8840=await this[_0x448e10(0x2b6)](_0x448e10(0x237));_0x36b3fe[_0x448e10(0x148)]=_0x1f8840?_0x1f8840[_0x448e10(0x2ba)]:'';}const _0x23f973=await this[_0x448e10(0x2b6)](_0x448e10(0x160));_0x36b3fe[_0x448e10(0x13c)]=_0x23f973?!!_0x23f973[_0x448e10(0x2ba)]:![];}catch(_0x734a22){}this[_0x448e10(0x298)](_0x2807e6['from'],_0x2807e6[_0x448e10(0x2e0)],{'success':!![],'eventHistory':this[_0x448e10(0x1ab)][_0x448e10(0x18b)](0x0,0xf),'stats':{'digestCount':_0x5ce3a2,'eventCountToday':_0x1a07e8,'hourlyActivity':_0x4beee0,'driftStatus':_0x171e82[_0x448e10(0x1fd)],'isPresent':this['isPresent'],'presenceWho':_0x1ddbba,'minDays':this[_0x448e10(0x2cd)][_0x448e10(0x19c)]||0x7,'stbDays':this['config'][_0x448e10(0x1a2)]||0xe,'ltbDays':this[_0x448e10(0x2cd)][_0x448e10(0x190)]||0x3c,'systemError':_0x1b36f3},'automation':_0x36b3fe},_0x2807e6[_0x448e10(0x198)]);}else{if(_0x2807e6[_0x448e10(0x2e0)]===_0x448e10(0x283))try{const _0x18826c=await scanForDevices(this,_0x2807e6[_0x448e10(0x187)]||{});this[_0x448e10(0x298)](_0x2807e6['from'],_0x2807e6[_0x448e10(0x2e0)],{'success':!![],'devices':_0x18826c},_0x2807e6[_0x448e10(0x198)]);}catch(_0x1d2ddf){this[_0x448e10(0x298)](_0x2807e6['from'],_0x2807e6[_0x448e10(0x2e0)],{'success':![],'error':_0x1d2ddf[_0x448e10(0x187)]},_0x2807e6[_0x448e10(0x198)]);}else{if(_0x2807e6['command']==='getEnums'){const _0x8b6ba0=await this[_0x448e10(0x177)]('enum.functions.*',_0x448e10(0x212)),_0x317f34=[];if(_0x8b6ba0)for(const _0x27a99d in _0x8b6ba0){const _0x2d5a9d=_0x8b6ba0[_0x27a99d],_0x5d4dbf=(_0x2d5a9d[_0x448e10(0x228)]&&typeof _0x2d5a9d[_0x448e10(0x228)][_0x448e10(0x1f7)]===_0x448e10(0x294)?_0x2d5a9d[_0x448e10(0x228)][_0x448e10(0x1f7)]['de']:_0x2d5a9d[_0x448e10(0x228)]['name'])||_0x2d5a9d['common'][_0x448e10(0x1f7)];_0x317f34[_0x448e10(0x2bf)]({'id':_0x27a99d,'name':_0x5d4dbf});}this['sendTo'](_0x2807e6[_0x448e10(0x270)],_0x2807e6[_0x448e10(0x2e0)],{'success':!![],'enums':_0x317f34},_0x2807e6[_0x448e10(0x198)]);}else{if(_0x2807e6['command']===_0x448e10(0x2bc)){const _0x52d2c0=_0x2807e6['message']['instance'];if(!_0x52d2c0)return this[_0x448e10(0x298)](_0x2807e6[_0x448e10(0x270)],_0x2807e6[_0x448e10(0x2e0)],{'success':![],'error':_0x448e10(0x165)},_0x2807e6['callback']);const _0x44eeb3=await getCalendarNames(this,_0x52d2c0);this['sendTo'](_0x2807e6[_0x448e10(0x270)],_0x2807e6[_0x448e10(0x2e0)],{'success':!![],'names':_0x44eeb3},_0x2807e6[_0x448e10(0x198)]);}else{if(_0x2807e6[_0x448e10(0x2e0)]==='simulateButler'){const {targetId:_0x1fd00e,targetValue:_0x5abaf2}=_0x2807e6[_0x448e10(0x187)];this['log'][_0x448e10(0x259)]('üß™\x20Simulating\x20Butler\x20Proposal:\x20'+_0x1fd00e+_0x448e10(0x16d)+_0x5abaf2),await this[_0x448e10(0x1e9)](_0x448e10(0x1ad),{'val':!![],'ack':!![]}),await this[_0x448e10(0x1e9)](_0x448e10(0x1a8),{'val':'SIMULATION:\x20Test-Vorschlag\x20f√ºr\x20'+_0x1fd00e,'ack':!![]}),await this[_0x448e10(0x1e9)](_0x448e10(0x174),{'val':_0x1fd00e,'ack':!![]}),await this[_0x448e10(0x1e9)](_0x448e10(0x237),{'val':_0x5abaf2,'ack':!![]}),this[_0x448e10(0x298)](_0x2807e6[_0x448e10(0x270)],_0x2807e6[_0x448e10(0x2e0)],{'success':!![]},_0x2807e6[_0x448e10(0x198)]);}else{if(_0x2807e6[_0x448e10(0x2e0)]===_0x448e10(0x1c1)){const {historyId:_0x281305,rating:_0x2ea8ea,comment:_0x459b9c,alertReason:_0xb64feb}=_0x2807e6[_0x448e10(0x187)];_0x281305&&_0x2ea8ea?(await saveFeedback(this,{'timestamp':Date['now'](),'historyId':_0x281305,'rating':_0x2ea8ea,'comment':_0x459b9c,'alertReason':_0xb64feb}),this['sendTo'](_0x2807e6['from'],_0x2807e6[_0x448e10(0x2e0)],{'success':!![]},_0x2807e6[_0x448e10(0x198)])):this[_0x448e10(0x298)](_0x2807e6[_0x448e10(0x270)],_0x2807e6[_0x448e10(0x2e0)],{'success':![],'error':_0x448e10(0x172)},_0x2807e6['callback']);}else _0x2807e6[_0x448e10(0x2e0)]==='dismissAutomation'&&(this[_0x448e10(0x171)][_0x448e10(0x259)](_0x448e10(0x18e)),await this[_0x448e10(0x1e9)](_0x448e10(0x1ad),{'val':![],'ack':!![]}),await this[_0x448e10(0x1e9)](_0x448e10(0x1a8),{'val':'','ack':!![]}),this[_0x448e10(0x298)](_0x2807e6[_0x448e10(0x270)],_0x2807e6[_0x448e10(0x2e0)],{'success':!![]},_0x2807e6[_0x448e10(0x198)]));}}}}}}}}}}}if(require[a0_0x5aab67(0x209)]!==module)module[a0_0x5aab67(0x15f)]=_0x583dd3=>new CogniLiving(_0x583dd3);else new CogniLiving();