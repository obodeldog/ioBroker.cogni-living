const a0_0x11336b=a0_0x4980;function a0_0x4980(_0x489e83,_0x131c9b){const _0x328570=a0_0x3c1c();return a0_0x4980=function(_0x2edd8c,_0xf2280d){_0x2edd8c=_0x2edd8c-0x10e;let _0x3c1c9c=_0x328570[_0x2edd8c];return _0x3c1c9c;},a0_0x4980(_0x489e83,_0x131c9b);}(function(_0x2c9472,_0x486c51){const _0x4a0d78=a0_0x4980,_0x28cd25=_0x2c9472();while(!![]){try{const _0x55acd=-parseInt(_0x4a0d78(0x14e))/0x1*(parseInt(_0x4a0d78(0x2dc))/0x2)+parseInt(_0x4a0d78(0x231))/0x3+-parseInt(_0x4a0d78(0x237))/0x4+-parseInt(_0x4a0d78(0x269))/0x5*(parseInt(_0x4a0d78(0x2cf))/0x6)+-parseInt(_0x4a0d78(0x2b8))/0x7+parseInt(_0x4a0d78(0x2dd))/0x8+parseInt(_0x4a0d78(0x120))/0x9;if(_0x55acd===_0x486c51)break;else _0x28cd25['push'](_0x28cd25['shift']());}catch(_0x432fa0){_0x28cd25['push'](_0x28cd25['shift']());}}}(a0_0x3c1c,0x5dab2));function a0_0x3c1c(){const _0x514243=['startsWith','openweathermap.','find','üö®üö®\x20NOTFALL','lights','Analysiere\x20ausgewogen\x20auf\x20Gesundheit,\x20Sicherheit\x20und\x20Komfort.','suggestedAction','getGenerativeModel','analysisHistory','system.mode','saveDailyDigests','briefingEnabled','eventHistory','‚ö†Ô∏è\x20Alarm','LOWBAT','analysis.automation.description','pr√§senz','triggerDailyDigest','COMBINED_PARAMETER','sat','write','Analysis\x20Error:\x20','Reset\x20Sched\x20Error:\x20','generateContent','state','Daily\x20Digests','Trigger\x20Digest','Starting\x20Smart\x20Scan\x20with\x20filters:\x20','stateChange','User\x20Feedback:\x20Alarm\x20\x22','presenceDevices','WETTER:\x20','notifyPushoverRecipient','events.history_debug_00','KALENDER:\x20','KALENDER\x20ERROR:\x20','object','checkLicense','INSTALL_TEST','inactivityThresholdHours','temperature','t√ºr','weather','wohn','useWeather','notifyEmailInstance','runBaselineDriftAnalysis','haust√ºr','lampe','unload','analysis.history_debug_01','Drift\x20Analysis','toISOString','\x0a\x20\x20\x20\x20\x20\x20\x20\x20OUTPUT\x20SCHEMA:\x20{\x20\x22summary\x22:\x20\x22string\x22,\x20\x22activityLevel\x22:\x20\x22string\x22,\x20\x22health\x22:\x20{\x20\x22sleepScore\x22:\x20number,\x20\x22restlessness\x22:\x20\x22string\x22\x20}\x20}','apply','setHours','rating','Briefing\x20Error:\x20','button','split','getForeignObjectsAsync','abortExitTimer','notifyTelegramInstance','config','long','PRIORIT√ÑT:\x20Sicherheit.\x20Erkenne\x20Eindringlinge,\x20ungew√∂hnliche\x20Anwesenheit.','weatherunderground.0','enum.rooms.*','presence','\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x0a\x20\x20\x20\x20\x20\x20\x20\x20DATEN:\x0a\x20\x20\x20\x20\x20\x20\x20\x20-\x20Schlafqualit√§t\x20letzte\x20Nacht:\x20','notifyTelegramEnabled','extendObjectAsync','_score','doors','(((.+)+)+)+$','hue','level','createAllObjects','1378536bivnkp','ready','runGeminiAnalysis','Fenster/T√ºr','daswetter','accuweather','1590040LtqkEr','genAI','diele','schlaf','briefingTime','üåÖ\x20Daily\x20Briefing:\x0a','Analysiere\x20Tag...','resetAnalysisStates','node-schedule','getCalendarNames','briefingJob','PRO-','\x0a!!!\x20END\x20WARNING\x20!!!\x0a','tryParse','replace','instance','name','Baseline\x20Status','sendToAsync','last_seen','productname','KALENDER:\x20Keine\x20relevanten\x20Termine','Licht','sendNotification','checkLtmObjects','value.temperature','LTM\x20Sched\x20Error:\x20','command','connection','json','shutter_contact','Deaktiviert\x20(Pro-Feature)','capabilities','analysis.history_debug_03','dailyDigests','getObjectAsync','SECTION','calendarSelection','archetype','sensor.motion','notifyWhatsappRecipient','status','smoke','admin.','LTM.driftAnalysis.baselineDrift','members','ROLLE:\x20F√ºrsorglicher\x20Assistent.\x0a\x20\x20\x20\x20\x20\x20\x20\x20AUFGABE:\x20Schreibe\x20eine\x20kurze,\x20beruhigende\x20\x22Guten\x20Morgen\x22-Nachricht\x20an\x20die\x20Angeh√∂rigen/Bewohner.\x0a\x20\x20\x20\x20\x20\x20\x20\x20TON:\x20Freundlich,\x20professionell,\x20kurz.\x0a\x20\x20\x20\x20\x20\x20\x20\x20PERSONA\x20(Fokus):\x20','\x0a\x20\x20\x20\x20\x20\x20\x20\x20EVENTS:\x20','Daily\x20Digest\x20erstellt\x20&\x20gespeichert.','openweathermap','983395NJPTrU','Rauchmelder','openweathermap.0','ERROR','.data.table','onReady','selectedFunctionIds','mode','LTM.baselineStatus','getSystemUUID','type','motion','GUEST','daswetter.0','retry','WETTER\x20ERROR:\x20','No\x20recorded\x20events\x20yet.','PROCESS','geminiApiKey','Temperatur','Sending\x20notification:\x20\x22','siren','\x20|\x20','systemConfig','setupDriftAnalysisScheduler','PARTY','[TEST]\x20','\x0a\x20\x20\x20\x20\x20\x20\x20\x20','OPERATING_VOLTAGE','health','error','inactivityMonitoringEnabled','analysis.activitySummary','minDaysForBaseline','toString','UNREACH','modeResetJob','ALARM','Error\x20initHistory:\x20','comfort','\x20presence\x20devices...','sort','now','exitGraceTimer','driftDetails','Urlaub','signal','systemUUID','geminiModel','Briefing\x20Sched\x20Error:\x20','livingContext','\x0aFEEDBACK:\x0a','testApiKey','Last\x20Check','reachable','accuweather.','slice','useCalendar','.\x20PR√ÑSENZ:\x20','LTM.processingStatus','scanForDevices','License\x20Check\x20failed:\x20','values','link_quality','uuid','setupModeResetScheduler','isGracePeriodActive','loadRawEventLog','enum.functions.*','Badezimmer','toLocaleString','updateAnalysisHistory','analysis.health.restlessness','analysis.automation.patternDetected','includes','Generating\x20Morning\x20Briefing...','08:00','loadSystemMode\x20failed:\x20','VACATION','1421840IwZrII','analysisInterval','@iobroker/adapter-core','loadSystemMode','trim','ON_TIME','longitude','val','ltmDriftCheckIntervalHours','sendMorningBriefing','LTM','activity','fenster','sensor.door','TEST-PRO-KEY','ical.0','exitTimer','calendarInstance','No\x20Key','Processing\x20Status','garten','time','getStateAsync','18sshdhp','ltmLtbWindowDays','LTM.driftAnalysis','subscribeStates','push','suggestion','NORMAL','Starting\x20Autopilot\x20(','\x20\x0a\x20\x20\x20\x20\x20\x20\x20\x20AUFGABE:\x20Analysiere\x20die\x20Events\x20auf\x20Aktivit√§t,\x20Komfort\x20und\x20GESUNDHEIT.\x20\x0a\x20\x20\x20\x20\x20\x20\x20\x20Nutze\x20den\x20EXTERNEN\x20KONTEXT\x20(Wetter/Kalender)\x20um\x20Fehlalarme\x20zu\x20vermeiden\x20(z.B.\x20Regen\x20=\x20keine\x20Gartenaktivit√§t,\x20Termin\x20=\x20Abwesend).\x0a\x20\x20\x20\x20\x20\x20\x20\x20SCHEMA:\x20{\x20\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x22activity\x22:\x20{\x20\x22summary\x22:\x20\x22string\x22,\x20\x22deviationFromBaseline\x22:\x20\x22string\x22,\x20\x22isAlert\x22:\x20bool,\x20\x22isEmergency\x22:\x20bool,\x20\x22alertReason\x22:\x20\x22string\x22\x20},\x20\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x22comfort\x22:\x20{\x20\x22summary\x22:\x20\x22string\x22,\x20\x22suggestion\x22:\x20\x22string\x22,\x20\x22automationProposal\x22:\x20{\x20\x22patternDetected\x22:\x20bool,\x20\x22description\x22:\x20\x22string\x22,\x20\x22suggestedAction\x22:\x20\x22string\x22\x20}\x20},\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x22health\x22:\x20{\x20\x22sleepScore\x22:\x20number\x20(0-100),\x20\x22restlessness\x22:\x20\x22none|low|medium|high\x22,\x20\x22notes\x22:\x20\x22string\x22\x20}\x20\x0a\x20\x20\x20\x20\x20\x20\x20\x20}','scriptEnabled','isArray','timestamp','analysis.analysisHistory','76kMFpnD','1079992guWNAt','createAllObjects\x20failed:\x20','ltmJob','accuweather.0','.\x20ORT:\x20','bad','\x22\x20was\x20','analysis.comfortSummary','party','toLowerCase','deviationFromBaseline','setupBriefingScheduler','baselineDrift','log','Zu\x20wenig\x20Daten\x20f√ºr\x20Daily\x20Digest.','pop','weatherunderground.','analysis.isEmergency','modelid','getCalendarNames\x20Error:\x20','rawEventLog','warn','version','0\x204\x20*\x20*\x20*','javascript.0.script','notifyPushoverInstance','.\x20PERSONA:\x20','14149836voxlQr','/100\x0a\x20\x20\x20\x20\x20\x20\x20\x20-\x20Aktivit√§t\x20seit\x2004:00\x20Uhr:\x20','icon','native','saveRawEventLog','main','yr.','createDailyDigest','fire','Nein','common','battery','checkWifiPresence','notes','sensorLastValues','getEnums','runAutopilot','isPresent','send','ROLLE:\x20Data\x20Scientist.\x20VERGLEICHE:\x20Dataset\x20A\x20(Recent)\x20vs\x20B\x20(Established).\x20ZIEL:\x20Erkenne\x20Drift.\x20SCHEMA:\x20{\x20\x22baselineDrift\x22:\x20\x22none|slight|significant|critical\x22,\x20\x22driftDetails\x22:\x20\x22string\x22\x20}\x0a\x0aB\x20(LTB):\x0a','summary','0\x203\x20*\x20*\x20*','boolean','testContext','firmware','city','analysis.deviationFromBaseline','cancel','filter','notifySignalEnabled','Bewegung','Bewegung\x20w√§hrend\x20Exit-Timer\x20erkannt\x20->\x20Bewohner\x20ist\x20noch\x20da.','onUnload','testNotification','generic','uuid-error','Fokus\x20auf\x20Maximierung\x20von\x20Komfort,\x20Automatisierungseffizienz\x20und\x20Energieeinsparung.','N/A\x20(Pro\x20Feature)','loadRawEventLog\x20failed:\x20','CRITICAL\x20WARNING:\x20No\x20sensor\x20activity\x20detected\x20for\x20','Aktiv\x20(','Subscribing\x20to\x20','history.','events.history_debug_02','map','Wetter:\x20Deaktiviert','15589XSXebT','system.config','Baseline:\x20Inactive\x20(Pro\x20Feature).','notifyTelegramRecipient','description','isAlert','getWeatherContext','Raw\x20Log','.forecast.current.state','.\x20\x0a\x20\x20\x20\x20\x20\x20\x20\x20KONTEXT\x20(Wohnen):\x20','setState','Morning\x20Briefing\x20sent.','triggerBriefing','Error\x20reading\x20calendar\x20table:\x20','constructor','notifySignalInstance','uniqueid','notifyWhatsappInstance','licht','Scheduling\x20Morning\x20Briefing\x20for\x20','automationProposal','[Test]\x20Notification','K√ºche','temp','sound','message','vacation','length','normal','Success','Fehler:\x20','response','join','guest','currentSystemMode','devices','analysis.isAlert','last\x20action','@google/generative-ai','activityLevel','driftAnalysisTimer','restlessness','event','üö®\x20EMERGENCY','analysis.lastResult','enum','WORKING','switch.light','LTM.triggerDailyDigest','lastCheck','info','griff','system','checkSystemObjects','\x0a\x20\x20\x20\x20\x20\x20\x20\x20INPUT:\x20','Autopilot\x20error:\x20','licenseKey','updateBaselineStatus','system.','logDuplicates','events.history_debug_03','WEEK_PROGRAM','\x0a\x0aA\x20(STB):\x0a','Schalter/Licht','STICKY_UNREACH','Missing\x20data','getLtmData','parse','getCalendarContext','text','scanDevices','N/A','events.history','number','submitFeedback','setStateAsync','WETTER:\x20Keine\x20Daten','exports','2-digit','\x20sent','ltmStbWindowDays','Cogni-Living\x20Alert','analysisTimer','analysis.history_debug_02','initHistory','analysis.triggerBriefing','\x0a!!!\x20EXTERNAL\x20SYSTEM\x20WARNING\x20!!!\x0a','process','latitude','ROLLE:\x20Data\x20Analyst.\x20AUFGABE:\x20Fasse\x20den\x20heutigen\x20Tag\x20basierend\x20auf\x20den\x20Sensor-Logs\x20zusammen.\x0a\x20\x20\x20\x20\x20\x20\x20\x20PERSONA:\x20','channel','location','N/A\x20(Learning)','unshift','expire','alertReason','splice','PRIORIT√ÑT:\x20Gesundheit\x20und\x20Sicherheit\x20f√ºr\x20Senioren\x20(AAL).\x20Erkenne\x20Inaktivit√§t,\x20potenzielle\x20St√ºrze\x20(indirekt),\x20Schlafunterbrechungen\x20und\x20n√§chtliche\x20Unruhe.','CONFIG_PENDING','ack','callback','colormode','sleepScore','RSSI','rauch','feedbackHistory','_calName','level.dimmer','some','search','material.','scriptProblem','.Summary.Current','stringify','temperatur','cogni-living\x20adapter\x20starting\x20(v','cogni-living','notifyPushoverEnabled','aiPersona','de-DE','info.','sendTo','application/json','lastAlertState','Garten','Gemini\x20Init\x20Error:\x20','analysis.trigger','icons-mfd.','getForeignObjectAsync','system.meta.uuid','flur','processSensorEvent','scheduleJob','date','isProVersion','from','analysis.health.sleepScore','string','models/gemini-flash-latest','No\x20recent\x20activity.','setPresence','catch','apiKey','none','bind','getForeignStateAsync','notifyEmailEnabled','toFixed','Drift\x20Status'];a0_0x3c1c=function(){return _0x514243;};return a0_0x3c1c();}const a0_0xf2280d=(function(){let _0x22f5ad=!![];return function(_0x579fe8,_0x3da3a1){const _0x4aa005=_0x22f5ad?function(){const _0x480e5a=a0_0x4980;if(_0x3da3a1){const _0x31aa69=_0x3da3a1[_0x480e5a(0x219)](_0x579fe8,arguments);return _0x3da3a1=null,_0x31aa69;}}:function(){};return _0x22f5ad=![],_0x4aa005;};}()),a0_0x2edd8c=a0_0xf2280d(this,function(){const _0x5c8a1a=a0_0x4980;return a0_0x2edd8c[_0x5c8a1a(0x28b)]()['search'](_0x5c8a1a(0x22d))[_0x5c8a1a(0x28b)]()[_0x5c8a1a(0x15c)](a0_0x2edd8c)[_0x5c8a1a(0x1bb)](_0x5c8a1a(0x22d));});a0_0x2edd8c();'use strict';const utils=require(a0_0x11336b(0x2ba)),{GoogleGenerativeAI}=require(a0_0x11336b(0x174)),schedule=require(a0_0x11336b(0x23f)),HISTORY_MAX_SIZE=0x32,ANALYSIS_HISTORY_MAX_SIZE=0x64,RAW_LOG_MAX_SIZE=0x5dc,LTM_MIN_EVENTS_FOR_COMPRESSION=0x5,GEMINI_MODEL='models/gemini-flash-latest',LTM_SCHEDULE=a0_0x11336b(0x135),MODE_RESET_SCHEDULE=a0_0x11336b(0x11c),LTM_DP_RAW_LOG='LTM.rawEventLog',LTM_DP_DAILY_DIGESTS='LTM.dailyDigests',LTM_DP_STATUS=a0_0x11336b(0x2a4),LTM_DP_TRIGGER_DIGEST=a0_0x11336b(0x17e),LTM_DP_BASELINE_STATUS=a0_0x11336b(0x271),LTM_DP_DRIFT_CHANNEL=a0_0x11336b(0x2d1),LTM_DP_DRIFT_STATUS=a0_0x11336b(0x263),LTM_DP_DRIFT_DETAILS='LTM.driftAnalysis.driftDetails',LTM_DP_DRIFT_LAST_CHECK='LTM.driftAnalysis.lastCheck',SYSTEM_DP_MODE=a0_0x11336b(0x1ec),SYSTEM_MODES={'NORMAL':a0_0x11336b(0x16a),'VACATION':a0_0x11336b(0x168),'PARTY':a0_0x11336b(0x2e5),'GUEST':a0_0x11336b(0x16f)},AUTO_RESET_MODES=[SYSTEM_MODES[a0_0x11336b(0x282)],SYSTEM_MODES[a0_0x11336b(0x275)]],EXIT_TIMER_MINUTES=0xf,EXIT_GRACE_PERIOD_SECONDS=0x1e,PERSONA_MAPPING={'generic':a0_0x11336b(0x1e8),'senior_aal':a0_0x11336b(0x1af),'family':'Fokus\x20auf\x20Familienroutinen,\x20Kindersicherheit\x20und\x20allgemeines\x20Haushaltsmanagement.','single_comfort':a0_0x11336b(0x144),'security':a0_0x11336b(0x224)};class CogniLiving extends utils['Adapter']{constructor(_0x5c8f1b){const _0x574aef=a0_0x11336b;super({..._0x5c8f1b,'name':_0x574aef(0x1c2)}),this[_0x574aef(0x1ef)]=[],this[_0x574aef(0x1eb)]=[],this[_0x574aef(0x1b7)]=[],this[_0x574aef(0x119)]=[],this[_0x574aef(0x259)]=[],this['sensorLastValues']={},this[_0x574aef(0x280)]={'latitude':0x0,'longitude':0x0,'city':''},this[_0x574aef(0x131)]=!![],this[_0x574aef(0x2c8)]=null,this[_0x574aef(0x294)]=null,this['isGracePeriodActive']=![],this[_0x574aef(0x238)]=null,this[_0x574aef(0x299)]=null,this[_0x574aef(0x170)]=SYSTEM_MODES['NORMAL'],this[_0x574aef(0x1d4)]=![],this[_0x574aef(0x1c9)]=![],this[_0x574aef(0x298)]='unknown',this[_0x574aef(0x1a0)]=null,this[_0x574aef(0x2df)]=null,this[_0x574aef(0x28d)]=null,this[_0x574aef(0x176)]=null,this[_0x574aef(0x241)]=null,this['on'](_0x574aef(0x232),this[_0x574aef(0x26e)]['bind'](this)),this['on'](_0x574aef(0x1ff),this['onStateChange']['bind'](this)),this['on'](_0x574aef(0x214),this['onUnload'][_0x574aef(0x1de)](this)),this['on'](_0x574aef(0x167),this['onMessage']['bind'](this));}async[a0_0x11336b(0x26e)](){const _0x20a9d1=a0_0x11336b;this['log']['info'](_0x20a9d1(0x1c1)+this['version']+')');try{const _0xed9ac7=['analysis.history_debug_00',_0x20a9d1(0x215),_0x20a9d1(0x1a1),_0x20a9d1(0x258),'analysis.history_debug_04',_0x20a9d1(0x204),'events.history_debug_01',_0x20a9d1(0x14b),_0x20a9d1(0x18a),'events.history_debug_04'];for(const _0x27a1b4 of _0xed9ac7){try{const _0x1479c4=await this[_0x20a9d1(0x25a)](_0x27a1b4);_0x1479c4&&await this['delObjectAsync'](_0x27a1b4);}catch(_0x2ac797){}}}catch(_0x4a1f36){}this['config'][_0x20a9d1(0x186)]=this[_0x20a9d1(0x222)]['licenseKey']||'';try{this[_0x20a9d1(0x1d4)]=await this[_0x20a9d1(0x208)](this[_0x20a9d1(0x222)][_0x20a9d1(0x186)]);}catch(_0x444f99){this[_0x20a9d1(0x112)][_0x20a9d1(0x287)](_0x20a9d1(0x2a6)+_0x444f99['message']);}if(!this[_0x20a9d1(0x222)][_0x20a9d1(0x20a)]||this['config'][_0x20a9d1(0x20a)]<0.1)this[_0x20a9d1(0x222)][_0x20a9d1(0x20a)]=0xc;try{await this[_0x20a9d1(0x1a2)]();}catch(_0xcc910b){this[_0x20a9d1(0x112)][_0x20a9d1(0x287)](_0x20a9d1(0x28f)+_0xcc910b[_0x20a9d1(0x167)]);}try{const _0x2e2484=await this[_0x20a9d1(0x1ce)](_0x20a9d1(0x14f));_0x2e2484&&_0x2e2484[_0x20a9d1(0x12a)]&&(this[_0x20a9d1(0x280)]={'latitude':_0x2e2484[_0x20a9d1(0x12a)][_0x20a9d1(0x1a6)]||0x0,'longitude':_0x2e2484[_0x20a9d1(0x12a)][_0x20a9d1(0x2be)]||0x0,'city':_0x2e2484[_0x20a9d1(0x12a)][_0x20a9d1(0x139)]||''});}catch(_0x4c5dbd){}if(this[_0x20a9d1(0x222)][_0x20a9d1(0x27b)])try{this[_0x20a9d1(0x238)]=new GoogleGenerativeAI(this['config'][_0x20a9d1(0x27b)]),this[_0x20a9d1(0x299)]=this['genAI'][_0x20a9d1(0x1ea)]({'model':GEMINI_MODEL,'generationConfig':{'responseMimeType':_0x20a9d1(0x1c8)}}),this[_0x20a9d1(0x112)][_0x20a9d1(0x180)]('Gemini\x20AI\x20initialized.');}catch(_0x1097ef){this[_0x20a9d1(0x112)][_0x20a9d1(0x287)](_0x20a9d1(0x1cb)+_0x1097ef[_0x20a9d1(0x167)]);}try{await this[_0x20a9d1(0x230)]();}catch(_0x2df035){this[_0x20a9d1(0x112)][_0x20a9d1(0x287)](_0x20a9d1(0x2de)+_0x2df035[_0x20a9d1(0x167)]);}try{await this[_0x20a9d1(0x2bb)]();}catch(_0x1f075f){this[_0x20a9d1(0x112)][_0x20a9d1(0x287)](_0x20a9d1(0x2b6)+_0x1f075f[_0x20a9d1(0x167)]);}try{await this[_0x20a9d1(0x2ac)]();}catch(_0x449c2d){this[_0x20a9d1(0x112)][_0x20a9d1(0x287)](_0x20a9d1(0x146)+_0x449c2d['message']);}try{await this['loadDailyDigests']();}catch(_0x27c1c1){this[_0x20a9d1(0x112)][_0x20a9d1(0x287)]('loadDailyDigests\x20failed:\x20'+_0x27c1c1[_0x20a9d1(0x167)]);}this['subscribeStates']('analysis.trigger'),this[_0x20a9d1(0x2d2)](LTM_DP_TRIGGER_DIGEST),this[_0x20a9d1(0x2d2)](_0x20a9d1(0x1ec)),this[_0x20a9d1(0x2d2)](_0x20a9d1(0x1a3));const _0x2a6d77=this[_0x20a9d1(0x222)]['devices'];if(_0x2a6d77&&_0x2a6d77[_0x20a9d1(0x169)]>0x0){this[_0x20a9d1(0x112)]['info'](_0x20a9d1(0x149)+_0x2a6d77[_0x20a9d1(0x169)]+'\x20sensors...');for(const _0x20d4bb of _0x2a6d77){if(_0x20d4bb['id']){await this['subscribeForeignStatesAsync'](_0x20d4bb['id']);try{const _0x1f05e0=await this[_0x20a9d1(0x1df)](_0x20d4bb['id']);if(_0x1f05e0)this[_0x20a9d1(0x12e)][_0x20d4bb['id']]=_0x1f05e0['val'];}catch(_0x196597){}}}}const _0x548c66=this[_0x20a9d1(0x222)]['presenceDevices']||[];if(_0x548c66[_0x20a9d1(0x169)]>0x0){this[_0x20a9d1(0x112)][_0x20a9d1(0x180)](_0x20a9d1(0x149)+_0x548c66[_0x20a9d1(0x169)]+_0x20a9d1(0x291));for(const _0x73f5aa of _0x548c66){await this['subscribeForeignStatesAsync'](_0x73f5aa);}try{await this[_0x20a9d1(0x12c)]();}catch(_0x3a057a){}}if(this[_0x20a9d1(0x1a0)])clearInterval(this['analysisTimer']);const _0x19acb1=this[_0x20a9d1(0x222)][_0x20a9d1(0x2b9)]||0xf;_0x19acb1>0x0&&(this[_0x20a9d1(0x112)][_0x20a9d1(0x180)](_0x20a9d1(0x2d6)+_0x19acb1+'\x20min).\x20Watchdog\x20Limit:\x20'+this[_0x20a9d1(0x222)][_0x20a9d1(0x20a)]+'h.'),this['analysisTimer']=setInterval(()=>{const _0x2628dd=_0x20a9d1;try{this[_0x2628dd(0x130)]();}catch(_0x5b853f){this['log'][_0x2628dd(0x287)](_0x2628dd(0x185)+_0x5b853f[_0x2628dd(0x167)]);}},_0x19acb1*0x3c*0x3e8)),this['setupLtmScheduler'](),this['setupModeResetScheduler'](),this[_0x20a9d1(0x281)](),this[_0x20a9d1(0x110)]();}[a0_0x11336b(0x140)](_0x7baad1){const _0x10db04=a0_0x11336b;if(this[_0x10db04(0x1a0)])clearInterval(this[_0x10db04(0x1a0)]);if(this['driftAnalysisTimer'])clearInterval(this['driftAnalysisTimer']);if(this[_0x10db04(0x2df)])this['ltmJob']['cancel']();if(this['modeResetJob'])this['modeResetJob'][_0x10db04(0x13b)]();if(this['briefingJob'])this[_0x10db04(0x241)][_0x10db04(0x13b)]();if(this['exitTimer'])clearTimeout(this[_0x10db04(0x2c8)]);if(this['exitGraceTimer'])clearTimeout(this[_0x10db04(0x294)]);_0x7baad1();}async['onStateChange'](_0x3e90fa,_0x1e225c){const _0x3421cb=a0_0x11336b;if(!_0x1e225c)return;if(_0x3e90fa===this['namespace']+'.'+SYSTEM_DP_MODE){_0x1e225c[_0x3421cb(0x2bf)]&&Object['values'](SYSTEM_MODES)[_0x3421cb(0x2b3)](_0x1e225c[_0x3421cb(0x2bf)])&&(this[_0x3421cb(0x170)]=_0x1e225c[_0x3421cb(0x2bf)],_0x1e225c[_0x3421cb(0x2bf)]===SYSTEM_MODES[_0x3421cb(0x2b7)]?this['setPresence'](![]):this['setPresence'](!![]));if(!_0x1e225c[_0x3421cb(0x1b1)])this[_0x3421cb(0x158)](_0x3e90fa,{'val':this[_0x3421cb(0x170)],'ack':!![]});return;}if(!_0x1e225c[_0x3421cb(0x1b1)]){_0x3e90fa[_0x3421cb(0x2b3)](_0x3421cb(0x1cc))&&_0x1e225c['val']&&(this[_0x3421cb(0x158)](_0x3e90fa,{'val':![],'ack':!![]}),this[_0x3421cb(0x233)]());if(_0x3e90fa['includes'](_0x3421cb(0x1f4))&&_0x1e225c[_0x3421cb(0x2bf)]){this[_0x3421cb(0x158)](_0x3e90fa,{'val':![],'ack':!![]});if(this['isProVersion'])this['createDailyDigest']();}_0x3e90fa[_0x3421cb(0x2b3)](_0x3421cb(0x15a))&&_0x1e225c['val']&&(this[_0x3421cb(0x158)](_0x3e90fa,{'val':![],'ack':!![]}),this[_0x3421cb(0x2c1)]());return;}if(this[_0x3421cb(0x222)]['presenceDevices']&&this[_0x3421cb(0x222)][_0x3421cb(0x201)][_0x3421cb(0x2b3)](_0x3e90fa)){await this[_0x3421cb(0x12c)]();return;}const _0x4299fe=(this[_0x3421cb(0x222)][_0x3421cb(0x171)]||[])['find'](_0xa21643=>_0xa21643['id']===_0x3e90fa);if(_0x4299fe)this[_0x3421cb(0x1d1)](_0x3e90fa,_0x1e225c,_0x4299fe);}async['onMessage'](_0x86ba31){const _0x5bb30d=a0_0x11336b;if(typeof _0x86ba31===_0x5bb30d(0x207)&&_0x86ba31[_0x5bb30d(0x167)])try{if(_0x86ba31[_0x5bb30d(0x252)]===_0x5bb30d(0x29d)){if(!_0x86ba31[_0x5bb30d(0x167)][_0x5bb30d(0x1dc)])return this[_0x5bb30d(0x1c7)](_0x86ba31[_0x5bb30d(0x1d5)],_0x86ba31[_0x5bb30d(0x252)],{'success':![],'message':_0x5bb30d(0x2ca)},_0x86ba31[_0x5bb30d(0x1b2)]);try{const _0x297447=new GoogleGenerativeAI(_0x86ba31[_0x5bb30d(0x167)][_0x5bb30d(0x1dc)])['getGenerativeModel']({'model':_0x5bb30d(0x1d8)});await _0x297447[_0x5bb30d(0x1fa)]('test'),this['sendTo'](_0x86ba31[_0x5bb30d(0x1d5)],_0x86ba31[_0x5bb30d(0x252)],{'success':!![],'message':_0x5bb30d(0x16b)},_0x86ba31[_0x5bb30d(0x1b2)]);}catch(_0x3a222b){this['sendTo'](_0x86ba31[_0x5bb30d(0x1d5)],_0x86ba31[_0x5bb30d(0x252)],{'success':![],'message':_0x3a222b[_0x5bb30d(0x167)]},_0x86ba31[_0x5bb30d(0x1b2)]);}}else{if(_0x86ba31['command']===_0x5bb30d(0x141)){const _0x4bcb44=await this['sendNotification'](_0x5bb30d(0x163),!![]);this[_0x5bb30d(0x1c7)](_0x86ba31['from'],_0x86ba31[_0x5bb30d(0x252)],{'success':_0x4bcb44>0x0,'message':_0x4bcb44+_0x5bb30d(0x19d)},_0x86ba31['callback']);}else{if(_0x86ba31[_0x5bb30d(0x252)]===_0x5bb30d(0x190)){if(!this[_0x5bb30d(0x1d4)])return this[_0x5bb30d(0x1c7)](_0x86ba31['from'],_0x86ba31['command'],{'success':![],'isPro':![]},_0x86ba31[_0x5bb30d(0x1b2)]);let _0x2a862e={'status':_0x5bb30d(0x195),'details':'','lastCheck':0x0};try{_0x2a862e[_0x5bb30d(0x260)]=(await this['getStateAsync'](LTM_DP_DRIFT_STATUS))['val'],_0x2a862e['details']=(await this[_0x5bb30d(0x2ce)](LTM_DP_DRIFT_DETAILS))[_0x5bb30d(0x2bf)],_0x2a862e[_0x5bb30d(0x17f)]=(await this['getStateAsync'](LTM_DP_DRIFT_LAST_CHECK))[_0x5bb30d(0x2bf)];}catch(_0x46542e){}this['sendTo'](_0x86ba31[_0x5bb30d(0x1d5)],_0x86ba31[_0x5bb30d(0x252)],{'success':!![],'isPro':!![],'dailyDigests':this[_0x5bb30d(0x259)],'driftAnalysis':_0x2a862e,'analysisHistory':this[_0x5bb30d(0x1eb)]},_0x86ba31[_0x5bb30d(0x1b2)]);}else{if(_0x86ba31[_0x5bb30d(0x252)]===_0x5bb30d(0x12f)){const _0x2b3b12=await this['getForeignObjectsAsync'](_0x5bb30d(0x2ad),'enum'),_0x465e17=[];if(_0x2b3b12)for(const _0x403af9 in _0x2b3b12){const _0x468f92=_0x2b3b12[_0x403af9],_0x4252ce=(_0x468f92['common']&&typeof _0x468f92['common'][_0x5bb30d(0x247)]===_0x5bb30d(0x207)?_0x468f92['common'][_0x5bb30d(0x247)]['de']:_0x468f92['common'][_0x5bb30d(0x247)])||_0x468f92[_0x5bb30d(0x12a)][_0x5bb30d(0x247)];_0x465e17['push']({'id':_0x403af9,'name':_0x4252ce});}this['sendTo'](_0x86ba31[_0x5bb30d(0x1d5)],_0x86ba31[_0x5bb30d(0x252)],{'success':!![],'enums':_0x465e17},_0x86ba31[_0x5bb30d(0x1b2)]);}else{if(_0x86ba31[_0x5bb30d(0x252)]===_0x5bb30d(0x194))try{const _0x3ddf82=await this[_0x5bb30d(0x2a5)](_0x86ba31[_0x5bb30d(0x167)]||{});this['sendTo'](_0x86ba31[_0x5bb30d(0x1d5)],_0x86ba31[_0x5bb30d(0x252)],{'success':!![],'devices':_0x3ddf82},_0x86ba31[_0x5bb30d(0x1b2)]);}catch(_0x251097){this[_0x5bb30d(0x1c7)](_0x86ba31[_0x5bb30d(0x1d5)],_0x86ba31[_0x5bb30d(0x252)],{'success':![],'error':_0x251097[_0x5bb30d(0x167)]},_0x86ba31[_0x5bb30d(0x1b2)]);}else{if(_0x86ba31[_0x5bb30d(0x252)]===_0x5bb30d(0x198)){const {historyId:_0x9db1e1,rating:_0x55f2e0,comment:_0x5cfa16,alertReason:_0x296430}=_0x86ba31[_0x5bb30d(0x167)];_0x9db1e1&&_0x55f2e0?(await this['saveFeedback']({'timestamp':Date['now'](),'historyId':_0x9db1e1,'rating':_0x55f2e0,'comment':_0x5cfa16,'alertReason':_0x296430}),this[_0x5bb30d(0x1c7)](_0x86ba31[_0x5bb30d(0x1d5)],_0x86ba31[_0x5bb30d(0x252)],{'success':!![]},_0x86ba31[_0x5bb30d(0x1b2)])):this[_0x5bb30d(0x1c7)](_0x86ba31[_0x5bb30d(0x1d5)],_0x86ba31[_0x5bb30d(0x252)],{'success':![],'error':_0x5bb30d(0x18f)},_0x86ba31['callback']);}else{if(_0x86ba31[_0x5bb30d(0x252)]===_0x5bb30d(0x137)){const _0x533ee0=await this[_0x5bb30d(0x154)](),_0x96442e=await this['getCalendarContext']();this['sendTo'](_0x86ba31[_0x5bb30d(0x1d5)],_0x86ba31[_0x5bb30d(0x252)],{'success':!![],'weather':_0x533ee0,'calendar':_0x96442e},_0x86ba31[_0x5bb30d(0x1b2)]);}else{if(_0x86ba31[_0x5bb30d(0x252)]===_0x5bb30d(0x240)){const _0x2629d=_0x86ba31[_0x5bb30d(0x167)][_0x5bb30d(0x246)];if(!_0x2629d)return this[_0x5bb30d(0x1c7)](_0x86ba31[_0x5bb30d(0x1d5)],_0x86ba31['command'],{'success':![],'error':'No\x20instance'},_0x86ba31['callback']);const _0x235e7e=await this['getCalendarNames'](_0x2629d);this[_0x5bb30d(0x1c7)](_0x86ba31[_0x5bb30d(0x1d5)],_0x86ba31[_0x5bb30d(0x252)],{'success':!![],'names':_0x235e7e},_0x86ba31[_0x5bb30d(0x1b2)]);}}}}}}}}}catch(_0x12cf09){this['log'][_0x5bb30d(0x287)]('Error\x20in\x20onMessage\x20command\x20'+_0x86ba31['command']+':\x20'+_0x12cf09[_0x5bb30d(0x167)]);if(_0x86ba31['callback'])this['sendTo'](_0x86ba31[_0x5bb30d(0x1d5)],_0x86ba31[_0x5bb30d(0x252)],{'success':![],'error':_0x12cf09[_0x5bb30d(0x167)]},_0x86ba31[_0x5bb30d(0x1b2)]);}}async[a0_0x11336b(0x1d1)](_0x224f49,_0x5d41d4,_0x6712a9){const _0x4bb647=a0_0x11336b;if(!_0x6712a9[_0x4bb647(0x189)]&&this[_0x4bb647(0x12e)][_0x224f49]===_0x5d41d4[_0x4bb647(0x2bf)])return;this[_0x4bb647(0x12e)][_0x224f49]=_0x5d41d4[_0x4bb647(0x2bf)];if(this[_0x4bb647(0x2ab)])return;const _0x2353e3=await this[_0x4bb647(0x12c)]();if(_0x2353e3){if(!this[_0x4bb647(0x131)])this[_0x4bb647(0x1da)](!![]);}else{const _0x5550d2=_0x6712a9['isExit']===!![];_0x5550d2?this['startExitTimer']():(this[_0x4bb647(0x2c8)]&&(this[_0x4bb647(0x112)][_0x4bb647(0x180)](_0x4bb647(0x13f)),this[_0x4bb647(0x220)]()),!this['isPresent']&&this[_0x4bb647(0x170)]===SYSTEM_MODES['NORMAL']&&this[_0x4bb647(0x1da)](!![]));}const _0x3cb614={'timestamp':_0x5d41d4['ts'],'id':_0x224f49,'name':_0x6712a9['name'],'value':_0x5d41d4['val'],'location':_0x6712a9[_0x4bb647(0x1a9)],'type':_0x6712a9[_0x4bb647(0x273)]};this['eventHistory'][_0x4bb647(0x1ab)](_0x3cb614);if(this[_0x4bb647(0x1ef)][_0x4bb647(0x169)]>HISTORY_MAX_SIZE)this[_0x4bb647(0x1ef)][_0x4bb647(0x114)]();await this[_0x4bb647(0x199)]('events.lastEvent',{'val':JSON[_0x4bb647(0x1bf)](_0x3cb614),'ack':!![]}),await this[_0x4bb647(0x199)](_0x4bb647(0x196),{'val':JSON[_0x4bb647(0x1bf)](this['eventHistory']),'ack':!![]}),this['rawEventLog'][_0x4bb647(0x2d3)]({'timestamp':new Date(_0x5d41d4['ts'])[_0x4bb647(0x217)](),'sensorName':_0x6712a9[_0x4bb647(0x247)],'location':_0x6712a9['location'],'value':_0x5d41d4[_0x4bb647(0x2bf)]}),await this[_0x4bb647(0x124)]();}async['runAutopilot'](){const _0x1cb9a2=a0_0x11336b,_0x446cd3=this[_0x1cb9a2(0x222)][_0x1cb9a2(0x20a)],_0x26c277=this[_0x1cb9a2(0x222)][_0x1cb9a2(0x288)],_0x4c2cea=this[_0x1cb9a2(0x1ef)][_0x1cb9a2(0x169)]>0x0?this[_0x1cb9a2(0x1ef)][0x0][_0x1cb9a2(0x2da)]:Date[_0x1cb9a2(0x293)](),_0x1bef99=(Date['now']()-_0x4c2cea)/(0x3e8*0x3c*0x3c);let _0x35c04d='';_0x26c277&&this[_0x1cb9a2(0x170)]===SYSTEM_MODES['NORMAL']&&this[_0x1cb9a2(0x131)]&&(_0x1bef99>_0x446cd3&&(_0x35c04d=_0x1cb9a2(0x147)+_0x1bef99[_0x1cb9a2(0x1e1)](0x1)+'\x20hours.\x20The\x20resident\x20might\x20be\x20incapacitated.\x20Risk\x20level:\x20HIGH.'));if(_0x35c04d){this['runGeminiAnalysis'](_0x35c04d)[_0x1cb9a2(0x1db)](_0x275fbd=>this['log']['error'](_0x275fbd));return;}const _0x49712=Date[_0x1cb9a2(0x293)](),_0xce9d28=_0x49712-_0x4c2cea,_0x2b2e34=(this[_0x1cb9a2(0x222)][_0x1cb9a2(0x2b9)]||0xf)*0x3c*0x3e8;this[_0x1cb9a2(0x1ef)][_0x1cb9a2(0x169)]>0x0&&_0xce9d28<=_0x2b2e34?this['runGeminiAnalysis']()[_0x1cb9a2(0x1db)](_0x544dfe=>this[_0x1cb9a2(0x112)][_0x1cb9a2(0x287)](_0x544dfe)):!this['lastAlertState']&&(this[_0x1cb9a2(0x158)]('analysis.isAlert',{'val':![],'ack':!![]}),this[_0x1cb9a2(0x158)]('analysis.isEmergency',{'val':![],'ack':!![]}));}async[a0_0x11336b(0x233)](_0x596e8e=''){const _0xb146d4=a0_0x11336b;if(!this[_0xb146d4(0x299)])return;const _0x257674=this[_0xb146d4(0x1ef)][_0xb146d4(0x169)]>0x0?this[_0xb146d4(0x1ef)]:[{'note':_0xb146d4(0x279)}],_0x571b7a=PERSONA_MAPPING[this[_0xb146d4(0x222)][_0xb146d4(0x1c4)]||'generic'],_0x4885c0=this[_0xb146d4(0x222)][_0xb146d4(0x29b)]||'',_0x143330=this[_0xb146d4(0x170)],_0x11af34=await this[_0xb146d4(0x154)](),_0x218fb3=await this['getCalendarContext'](),_0x3b54eb=(_0x11af34+'\x20'+_0x218fb3)[_0xb146d4(0x2bc)](),_0x56a71b=new Date(),_0x5c5e1c=_0x56a71b[_0xb146d4(0x2af)](_0xb146d4(0x1c5),{'weekday':_0xb146d4(0x223),'hour':_0xb146d4(0x19c),'minute':_0xb146d4(0x19c)}),_0x159d0c=this[_0xb146d4(0x280)];let _0x1de696='';if(this[_0xb146d4(0x1b7)][_0xb146d4(0x169)]>0x0){const _0x2ba52b=this[_0xb146d4(0x1b7)][_0xb146d4(0x2a1)](0x0,0x3)[_0xb146d4(0x14c)](_0x24c8af=>_0xb146d4(0x200)+_0x24c8af['alertReason']+_0xb146d4(0x2e3)+_0x24c8af[_0xb146d4(0x21b)]+'.')[_0xb146d4(0x16e)]('\x0a');_0x1de696=_0xb146d4(0x29c)+_0x2ba52b+'\x0a';}const _0x58b52f=_0x596e8e?_0xb146d4(0x1a4)+_0x596e8e+_0xb146d4(0x243):'',_0x5b48dc=_0xb146d4(0x150),_0x19b67d='ROLLE:\x20Smart\x20Home\x20Analyst.\x20SPRACHE:\x20DE.\x20FORMAT:\x20JSON.\x20\x0a\x20\x20\x20\x20\x20\x20\x20\x20AKTUELLE\x20ZEIT:\x20'+_0x5c5e1c+_0xb146d4(0x2e1)+_0x159d0c[_0xb146d4(0x139)]+'.\x0a\x20\x20\x20\x20\x20\x20\x20\x20MODUS:\x20'+_0x143330+_0xb146d4(0x2a3)+(this[_0xb146d4(0x131)]?'Ja':_0xb146d4(0x129))+_0xb146d4(0x157)+_0x4885c0+_0xb146d4(0x11f)+_0x571b7a+'.\x0a\x20\x20\x20\x20\x20\x20\x20\x20EXTERNER\x20KONTEXT\x20(WICHTIG):\x20'+_0x3b54eb+_0xb146d4(0x284)+_0x5b48dc+'\x20'+_0x1de696+'\x20'+_0x58b52f+_0xb146d4(0x266)+JSON[_0xb146d4(0x1bf)](_0x257674)+_0xb146d4(0x2d7);try{const _0x2e1faa=await this[_0xb146d4(0x299)][_0xb146d4(0x1fa)](_0x19b67d),_0x22e326=_0x2e1faa[_0xb146d4(0x16d)][_0xb146d4(0x193)]()[_0xb146d4(0x245)](/```json|```/g,'')['trim'](),_0xc251a7=JSON[_0xb146d4(0x191)](_0x22e326);await this['setStateAsync'](_0xb146d4(0x17a),{'val':_0x22e326,'ack':!![]}),await this['setStateAsync']('analysis.alertReason',{'val':_0xc251a7[_0xb146d4(0x2c3)][_0xb146d4(0x1ad)]||'','ack':!![]}),await this[_0xb146d4(0x199)]('analysis.activitySummary',{'val':_0xc251a7[_0xb146d4(0x2c3)]['summary']||_0xb146d4(0x195),'ack':!![]}),await this[_0xb146d4(0x199)](_0xb146d4(0x13a),{'val':_0xc251a7[_0xb146d4(0x2c3)][_0xb146d4(0x10f)]||_0xb146d4(0x195),'ack':!![]});_0xc251a7[_0xb146d4(0x290)]&&(await this[_0xb146d4(0x199)](_0xb146d4(0x2e4),{'val':_0xc251a7[_0xb146d4(0x290)][_0xb146d4(0x134)]||'','ack':!![]}),await this['setStateAsync']('analysis.comfortSuggestion',{'val':_0xc251a7[_0xb146d4(0x290)][_0xb146d4(0x2d4)]||'','ack':!![]}),_0xc251a7['comfort']['automationProposal']&&(await this[_0xb146d4(0x199)](_0xb146d4(0x2b2),{'val':_0xc251a7[_0xb146d4(0x290)][_0xb146d4(0x162)]['patternDetected']||![],'ack':!![]}),await this['setStateAsync'](_0xb146d4(0x1f2),{'val':_0xc251a7[_0xb146d4(0x290)][_0xb146d4(0x162)][_0xb146d4(0x152)]||'','ack':!![]}),await this['setStateAsync']('analysis.automation.suggestedAction',{'val':_0xc251a7[_0xb146d4(0x290)][_0xb146d4(0x162)][_0xb146d4(0x1e9)]||'','ack':!![]})));_0xc251a7[_0xb146d4(0x286)]&&(await this[_0xb146d4(0x199)](_0xb146d4(0x1d6),{'val':typeof _0xc251a7[_0xb146d4(0x286)]['sleepScore']===_0xb146d4(0x197)?_0xc251a7[_0xb146d4(0x286)]['sleepScore']:0x0,'ack':!![]}),await this[_0xb146d4(0x199)](_0xb146d4(0x2b1),{'val':_0xc251a7[_0xb146d4(0x286)][_0xb146d4(0x177)]||_0xb146d4(0x1dd),'ack':!![]}),await this[_0xb146d4(0x199)]('analysis.health.notes',{'val':_0xc251a7[_0xb146d4(0x286)][_0xb146d4(0x12d)]||'','ack':!![]}));const _0x383fdc=_0xc251a7[_0xb146d4(0x2c3)][_0xb146d4(0x153)]||![],_0x2b9f67=_0xc251a7[_0xb146d4(0x2c3)]['isEmergency']||![];if(_0x383fdc||_0x2b9f67){await this[_0xb146d4(0x199)](_0xb146d4(0x172),{'val':!![],'ack':!![]}),await this[_0xb146d4(0x199)](_0xb146d4(0x116),{'val':_0x2b9f67,'ack':!![]});if(!this[_0xb146d4(0x1c9)]||_0x2b9f67){const _0x503ee2=_0x2b9f67?_0xb146d4(0x1e6):_0xb146d4(0x1f0);this[_0xb146d4(0x24e)](_0x503ee2+':\x20'+_0xc251a7['activity'][_0xb146d4(0x1ad)],![],_0x2b9f67);}}else await this[_0xb146d4(0x199)](_0xb146d4(0x172),{'val':![],'ack':!![]}),await this[_0xb146d4(0x199)](_0xb146d4(0x116),{'val':![],'ack':!![]});this[_0xb146d4(0x1c9)]=_0x383fdc||_0x2b9f67;const _0x2ca59f={'timestamp':Date['now'](),'id':Date[_0xb146d4(0x293)]()[_0xb146d4(0x28b)](),'analysis':_0xc251a7,'systemMode':_0x143330,'isPro':this[_0xb146d4(0x1d4)]};this[_0xb146d4(0x2b0)](_0x2ca59f);}catch(_0x59d300){this['log'][_0xb146d4(0x287)](_0xb146d4(0x1f8)+_0x59d300[_0xb146d4(0x167)]);}}async[a0_0x11336b(0x127)](){const _0x307243=a0_0x11336b;if(!this[_0x307243(0x299)]||this[_0x307243(0x119)]['length']<LTM_MIN_EVENTS_FOR_COMPRESSION){await this[_0x307243(0x199)](LTM_DP_STATUS,{'val':_0x307243(0x113),'ack':!![]});return;}this[_0x307243(0x112)][_0x307243(0x180)]('Creating\x20Daily\x20Digest\x20from\x20'+this[_0x307243(0x119)]['length']+'\x20raw\x20events...'),await this[_0x307243(0x199)](LTM_DP_STATUS,{'val':_0x307243(0x23d),'ack':!![]});const _0x349d72=this['rawEventLog'][_0x307243(0x169)]>0x320?this[_0x307243(0x119)][_0x307243(0x2a1)](this[_0x307243(0x119)]['length']-0x320):this['rawEventLog'],_0xb0e436=PERSONA_MAPPING[this[_0x307243(0x222)][_0x307243(0x1c4)]||_0x307243(0x142)],_0x12d83a=_0x307243(0x1a7)+_0xb0e436+_0x307243(0x184)+JSON[_0x307243(0x1bf)](_0x349d72)+_0x307243(0x218);try{const _0x1547eb=await this['geminiModel'][_0x307243(0x1fa)](_0x12d83a),_0x898a9f=_0x1547eb[_0x307243(0x16d)][_0x307243(0x193)]()[_0x307243(0x245)](/```json|```/g,'')[_0x307243(0x2bc)](),_0x249ae9=JSON['parse'](_0x898a9f),_0x563d14={'timestamp':new Date()[_0x307243(0x217)](),'eventCount':this[_0x307243(0x119)][_0x307243(0x169)],'summary':_0x249ae9[_0x307243(0x134)],'activityLevel':_0x249ae9[_0x307243(0x175)],'health':{'sleepScore':_0x249ae9['health']?_0x249ae9[_0x307243(0x286)][_0x307243(0x1b4)]:0x0,'restlessness':_0x249ae9[_0x307243(0x286)]?_0x249ae9[_0x307243(0x286)][_0x307243(0x177)]:'none'},'systemMode':this['currentSystemMode']};this['dailyDigests']['push'](_0x563d14),await this[_0x307243(0x1ed)](),this[_0x307243(0x119)]=[],await this[_0x307243(0x124)](),await this[_0x307243(0x199)](LTM_DP_STATUS,{'val':_0x307243(0x267),'ack':!![]}),this[_0x307243(0x112)][_0x307243(0x180)]('Daily\x20Digest\x20created\x20successfully.');}catch(_0x2661ae){this[_0x307243(0x112)]['error']('Daily\x20Digest\x20Error:\x20'+_0x2661ae[_0x307243(0x167)]),await this[_0x307243(0x199)](LTM_DP_STATUS,{'val':_0x307243(0x16c)+_0x2661ae[_0x307243(0x167)],'ack':!![]});}}async[a0_0x11336b(0x2c1)](){const _0x220058=a0_0x11336b;if(!this[_0x220058(0x299)])return;this[_0x220058(0x112)][_0x220058(0x180)](_0x220058(0x2b4));const _0x86ee6f=this[_0x220058(0x259)][_0x220058(0x169)]>0x0?this['dailyDigests'][this[_0x220058(0x259)][_0x220058(0x169)]-0x1]:null,_0x3ef0b6=_0x86ee6f&&_0x86ee6f['health']?_0x86ee6f[_0x220058(0x286)]['sleepScore']:_0x220058(0x195),_0x33f0ec=new Date();_0x33f0ec[_0x220058(0x21a)](0x4,0x0,0x0,0x0);const _0xc4a525=this[_0x220058(0x1ef)][_0x220058(0x13c)](_0x235df0=>new Date(_0x235df0[_0x220058(0x2da)])>_0x33f0ec),_0x2ac2a4=PERSONA_MAPPING[this['config'][_0x220058(0x1c4)]||_0x220058(0x142)],_0x6fd367=this[_0x220058(0x222)][_0x220058(0x29b)]||'',_0x164fce=await this['getWeatherContext'](),_0x5380a7=await this[_0x220058(0x192)](),_0x521e1e=_0x220058(0x265)+_0x2ac2a4+'\x0a\x20\x20\x20\x20\x20\x20\x20\x20KONTEXT\x20(Wer\x20wohnt\x20hier?):\x20'+_0x6fd367+'\x0a\x20\x20\x20\x20\x20\x20\x20\x20ZUSATZ-KONTEXT:\x20'+_0x164fce+'\x20'+_0x5380a7+_0x220058(0x228)+_0x3ef0b6+_0x220058(0x121)+JSON[_0x220058(0x1bf)](_0xc4a525[_0x220058(0x2a1)](0x0,0xa))+'\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x0a\x20\x20\x20\x20\x20\x20\x20\x20OUTPUT:\x20Nur\x20der\x20Nachrichtentext\x20(kein\x20JSON).\x20Integriere\x20den\x20Kontext\x20(Wetter/Kalender)\x20nur\x20wenn\x20relevant.';try{const _0x218efa=await this[_0x220058(0x299)]['generateContent'](_0x521e1e),_0x167a60=_0x220058(0x23c)+_0x218efa[_0x220058(0x16d)][_0x220058(0x193)]()['trim']();this[_0x220058(0x24e)](_0x167a60),this[_0x220058(0x112)][_0x220058(0x180)](_0x220058(0x159));}catch(_0x3db40c){this[_0x220058(0x112)][_0x220058(0x287)](_0x220058(0x21c)+_0x3db40c['message']);}}['tryParse'](_0x2171c4){const _0x26db81=a0_0x11336b;if(typeof _0x2171c4===_0x26db81(0x207))return _0x2171c4;try{return JSON[_0x26db81(0x191)](_0x2171c4);}catch(_0x1c3444){return null;}}async[a0_0x11336b(0x154)](){const _0x3089dd=a0_0x11336b;try{if(!this[_0x3089dd(0x222)][_0x3089dd(0x20f)])return _0x3089dd(0x14d);let _0x54a7b9='';const _0x58a018=this[_0x3089dd(0x222)]['weatherInstance'];if(_0x58a018)try{if(_0x58a018[_0x3089dd(0x2b3)](_0x3089dd(0x236))){const _0x35b6eb=await this[_0x3089dd(0x1df)](_0x58a018+'.Summary.Current');if(_0x35b6eb&&_0x35b6eb[_0x3089dd(0x2bf)])_0x54a7b9=_0x35b6eb[_0x3089dd(0x2bf)];}else{if(_0x58a018['includes'](_0x3089dd(0x235))){const _0x3d9dac=await this[_0x3089dd(0x1df)](_0x58a018+'.NextHours.Location_1.Day_1.current.symbol_desc');if(_0x3d9dac&&_0x3d9dac[_0x3089dd(0x2bf)])_0x54a7b9=_0x3d9dac['val'];}else{if(_0x58a018[_0x3089dd(0x2b3)](_0x3089dd(0x268))){const _0x13efd2=await this[_0x3089dd(0x1df)](_0x58a018+_0x3089dd(0x156));if(_0x13efd2&&_0x13efd2[_0x3089dd(0x2bf)])_0x54a7b9=_0x13efd2[_0x3089dd(0x2bf)];}}}}catch(_0x4b5929){}if(!_0x54a7b9){const _0x1cc335=[_0x3089dd(0x2e0),_0x3089dd(0x276),_0x3089dd(0x225),_0x3089dd(0x26b)];for(const _0x11a032 of _0x1cc335){try{const _0x12f986=await this[_0x3089dd(0x1ce)](_0x11a032);if(_0x12f986){if(_0x11a032[_0x3089dd(0x2b3)](_0x3089dd(0x236))){const _0x3df1f7=await this[_0x3089dd(0x1df)](_0x11a032+_0x3089dd(0x1be));if(_0x3df1f7&&_0x3df1f7[_0x3089dd(0x2bf)]){_0x54a7b9=_0x3df1f7[_0x3089dd(0x2bf)];break;}}}}catch(_0x39f914){}}}return _0x54a7b9?_0x3089dd(0x202)+_0x54a7b9:_0x3089dd(0x19a);}catch(_0x545e3c){return _0x3089dd(0x278)+_0x545e3c[_0x3089dd(0x167)];}}async['getCalendarContext'](){const _0x5340a8=a0_0x11336b;try{if(!this[_0x5340a8(0x222)][_0x5340a8(0x2a2)])return'Kalender:\x20Deaktiviert';let _0x547db4=this[_0x5340a8(0x222)][_0x5340a8(0x2c9)]||_0x5340a8(0x2c7),_0xf59bb1=this['config'][_0x5340a8(0x25c)]||[];if(typeof _0xf59bb1===_0x5340a8(0x1d7))_0xf59bb1=_0xf59bb1['split'](',');try{const _0x2afdde=await this['getForeignStateAsync'](_0x547db4+'.data.table');if(_0x2afdde&&_0x2afdde[_0x5340a8(0x2bf)]){let _0x2251c1=this[_0x5340a8(0x244)](_0x2afdde[_0x5340a8(0x2bf)]);if(_0x2251c1&&Array[_0x5340a8(0x2d9)](_0x2251c1)){if(_0xf59bb1[_0x5340a8(0x169)]>0x0)_0x2251c1=_0x2251c1[_0x5340a8(0x13c)](_0x845458=>_0xf59bb1['includes'](_0x845458[_0x5340a8(0x1b8)]||''));else return'KALENDER:\x20Keine\x20Kalender\x20ausgew√§hlt\x20(Bitte\x20in\x20Settings\x20konfigurieren)';if(_0x2251c1['length']>0x0){const _0x354e68=_0x2251c1['slice'](0x0,0x3)['map'](_0xf28be4=>{const _0x3cd1aa=_0x5340a8;let _0x43d77c=_0xf28be4[_0x3cd1aa(0x1d3)];if(_0xf28be4[_0x3cd1aa(0x2cd)])_0x43d77c+='\x20'+_0xf28be4['time'];return _0x43d77c+':\x20'+_0xf28be4[_0x3cd1aa(0x178)]+'\x20('+_0xf28be4[_0x3cd1aa(0x1b8)]+')';});return _0x5340a8(0x205)+_0x354e68[_0x5340a8(0x16e)](_0x5340a8(0x27f));}else return _0x5340a8(0x24c);}}}catch(_0x3b9dd1){this[_0x5340a8(0x112)][_0x5340a8(0x11a)](_0x5340a8(0x15b)+_0x3b9dd1[_0x5340a8(0x167)]);}return'KALENDER:\x20Keine\x20Daten';}catch(_0x41c894){return _0x5340a8(0x206)+_0x41c894[_0x5340a8(0x167)];}}async[a0_0x11336b(0x240)](_0x37b6e2){const _0x12f8bb=a0_0x11336b;try{const _0x36863e=await this[_0x12f8bb(0x1df)](_0x37b6e2+_0x12f8bb(0x26d));if(_0x36863e&&_0x36863e[_0x12f8bb(0x2bf)]){const _0x4decfe=this[_0x12f8bb(0x244)](_0x36863e['val']);if(_0x4decfe&&Array[_0x12f8bb(0x2d9)](_0x4decfe)){const _0x4be1da=[...new Set(_0x4decfe[_0x12f8bb(0x14c)](_0x26c6f5=>_0x26c6f5['_calName'])[_0x12f8bb(0x13c)](Boolean))];return _0x4be1da['sort']();}}return[];}catch(_0x4535f0){return this[_0x12f8bb(0x112)][_0x12f8bb(0x287)](_0x12f8bb(0x118)+_0x4535f0[_0x12f8bb(0x167)]),[];}}async[a0_0x11336b(0x1a2)](){const _0x46af19=a0_0x11336b;try{const _0x439750=await this[_0x46af19(0x2ce)](_0x46af19(0x196));_0x439750&&_0x439750[_0x46af19(0x2bf)]&&(this[_0x46af19(0x1ef)]=JSON[_0x46af19(0x191)](_0x439750[_0x46af19(0x2bf)][_0x46af19(0x28b)]()));}catch(_0x56b4b1){this[_0x46af19(0x1ef)]=[];}try{const _0x460ee0=await this[_0x46af19(0x2ce)]('analysis.analysisHistory');if(_0x460ee0&&_0x460ee0['val'])this['analysisHistory']=JSON[_0x46af19(0x191)](_0x460ee0[_0x46af19(0x2bf)][_0x46af19(0x28b)]());}catch(_0x2ad1b6){this[_0x46af19(0x1eb)]=[];}}async[a0_0x11336b(0x272)](){const _0x1c1420=a0_0x11336b;try{const _0x582fb2=await this[_0x1c1420(0x1ce)](_0x1c1420(0x1cf));if(_0x582fb2&&_0x582fb2[_0x1c1420(0x123)]&&_0x582fb2['native'][_0x1c1420(0x2a9)])return _0x582fb2['native'][_0x1c1420(0x2a9)];return'uuid-not-found';}catch(_0xa71457){return _0x1c1420(0x143);}}async[a0_0x11336b(0x208)](_0x37d66e){const _0x49e20e=a0_0x11336b;if(!_0x37d66e)return![];this['systemUUID']=await this[_0x49e20e(0x272)]();if(_0x37d66e===_0x49e20e(0x2c6)||_0x37d66e[_0x49e20e(0x1e3)](_0x49e20e(0x242)))return!![];return![];}async[a0_0x11336b(0x24f)](){const _0x1b9276=a0_0x11336b;await this[_0x1b9276(0x22a)]('LTM',{'type':_0x1b9276(0x1a8),'common':{'name':_0x1b9276(0x2c2)},'native':{}}),await this['extendObjectAsync'](LTM_DP_RAW_LOG,{'type':_0x1b9276(0x1fb),'common':{'name':_0x1b9276(0x155),'type':_0x1b9276(0x1d7),'role':_0x1b9276(0x254),'read':!![],'write':![]},'native':{}}),await this[_0x1b9276(0x22a)](LTM_DP_DAILY_DIGESTS,{'type':_0x1b9276(0x1fb),'common':{'name':_0x1b9276(0x1fc),'type':_0x1b9276(0x1d7),'role':_0x1b9276(0x254),'read':!![],'write':![]},'native':{}}),await this[_0x1b9276(0x22a)](LTM_DP_STATUS,{'type':_0x1b9276(0x1fb),'common':{'name':_0x1b9276(0x2cb),'type':'string','role':'text','read':!![],'write':![]},'native':{}}),await this[_0x1b9276(0x22a)](LTM_DP_TRIGGER_DIGEST,{'type':_0x1b9276(0x1fb),'common':{'name':_0x1b9276(0x1fd),'type':_0x1b9276(0x136),'role':_0x1b9276(0x21d),'read':!![],'write':!![],'def':![]},'native':{}}),await this[_0x1b9276(0x22a)](LTM_DP_BASELINE_STATUS,{'type':_0x1b9276(0x1fb),'common':{'name':_0x1b9276(0x248),'type':_0x1b9276(0x1d7),'role':'text','read':!![],'write':![]},'native':{}});}async['checkLtmDriftObjects'](){const _0xaefe15=a0_0x11336b;await this[_0xaefe15(0x22a)](LTM_DP_DRIFT_CHANNEL,{'type':'channel','common':{'name':_0xaefe15(0x216)},'native':{}}),await this['extendObjectAsync'](LTM_DP_DRIFT_STATUS,{'type':_0xaefe15(0x1fb),'common':{'name':_0xaefe15(0x1e2),'type':_0xaefe15(0x1d7),'role':_0xaefe15(0x1fb),'read':!![],'write':![],'def':_0xaefe15(0x195)},'native':{}}),await this[_0xaefe15(0x22a)](LTM_DP_DRIFT_DETAILS,{'type':_0xaefe15(0x1fb),'common':{'name':'Drift\x20Details','type':_0xaefe15(0x1d7),'role':_0xaefe15(0x193),'read':!![],'write':![]},'native':{}}),await this[_0xaefe15(0x22a)](LTM_DP_DRIFT_LAST_CHECK,{'type':_0xaefe15(0x1fb),'common':{'name':_0xaefe15(0x29e),'type':_0xaefe15(0x197),'role':'date','read':!![],'write':![]},'native':{}});}async[a0_0x11336b(0x183)](){const _0x451e76=a0_0x11336b;await this[_0x451e76(0x22a)](_0x451e76(0x182),{'type':_0x451e76(0x1a8),'common':{'name':'System\x20Status\x20&\x20Control'},'native':{}}),await this['extendObjectAsync'](SYSTEM_DP_MODE,{'type':_0x451e76(0x1fb),'common':{'name':'System\x20Mode','type':'string','role':_0x451e76(0x1fb),'read':!![],'write':!![],'def':SYSTEM_MODES['NORMAL'],'states':{[SYSTEM_MODES[_0x451e76(0x2d5)]]:'Normal',[SYSTEM_MODES[_0x451e76(0x2b7)]]:_0x451e76(0x296),[SYSTEM_MODES[_0x451e76(0x282)]]:'Party',[SYSTEM_MODES[_0x451e76(0x275)]]:'Gast'}},'native':{}});}async['sendNotification'](_0x56f30c,_0x38bf26=![],_0x59810c=![]){const _0x23350a=a0_0x11336b;this[_0x23350a(0x112)][_0x23350a(0x180)]((_0x38bf26?_0x23350a(0x283):'')+_0x23350a(0x27d)+_0x56f30c+'\x22'+(_0x59810c?'\x20(EMERGENCY)':''));const _0x432700=this[_0x23350a(0x222)];let _0x536dc9=0x0;_0x432700[_0x23350a(0x229)]&&_0x432700[_0x23350a(0x221)]&&(await this['sendToAsync'](_0x432700[_0x23350a(0x221)],'send',{'text':_0x56f30c,'user':_0x432700[_0x23350a(0x151)]}),_0x536dc9++);if(_0x432700[_0x23350a(0x1c3)]&&_0x432700['notifyPushoverInstance']){let _0x550af8={'message':_0x56f30c,'title':_0x59810c?_0x23350a(0x179):_0x23350a(0x19f),'priority':_0x59810c?0x2:0x1,'device':_0x432700[_0x23350a(0x203)]};_0x59810c&&(_0x550af8[_0x23350a(0x277)]=0x1e,_0x550af8[_0x23350a(0x1ac)]=0xe10,_0x550af8[_0x23350a(0x166)]=_0x23350a(0x27e)),await this[_0x23350a(0x249)](_0x432700[_0x23350a(0x11e)],'send',_0x550af8),_0x536dc9++;}return _0x432700[_0x23350a(0x1e0)]&&_0x432700[_0x23350a(0x210)]&&(await this[_0x23350a(0x249)](_0x432700[_0x23350a(0x210)],_0x23350a(0x132),{'text':_0x56f30c,'to':_0x432700['notifyEmailRecipient']}),_0x536dc9++),_0x432700['notifyWhatsappEnabled']&&_0x432700[_0x23350a(0x15f)]&&(await this['sendToAsync'](_0x432700['notifyWhatsappInstance'],_0x23350a(0x132),{'text':_0x56f30c,'phone':_0x432700[_0x23350a(0x25f)]}),_0x536dc9++),_0x432700[_0x23350a(0x13d)]&&_0x432700[_0x23350a(0x15d)]&&(await this['sendToAsync'](_0x432700[_0x23350a(0x15d)],_0x23350a(0x132),{'text':_0x56f30c,'phone':_0x432700['notifySignalRecipient']}),_0x536dc9++),_0x536dc9;}async[a0_0x11336b(0x2a5)](_0x330acc={}){const _0x2669a0=a0_0x11336b;this['log'][_0x2669a0(0x180)](_0x2669a0(0x1fe)+JSON[_0x2669a0(0x1bf)](_0x330acc));const _0x2f1da7=[],_0x1c545c=_0x330acc[_0x2669a0(0x274)]!==![],_0x56c938=_0x330acc[_0x2669a0(0x22c)]!==![],_0x23a7b4=_0x330acc[_0x2669a0(0x1e7)]!==![],_0x5cd759=_0x330acc[_0x2669a0(0x20b)]===!![],_0x440b46=_0x330acc[_0x2669a0(0x20d)]===!![],_0x3f76d7=_0x330acc[_0x2669a0(0x26f)]||[],_0xf89834=await this[_0x2669a0(0x21f)](_0x2669a0(0x226),_0x2669a0(0x17b)),_0x37ee31=await this[_0x2669a0(0x21f)](_0x2669a0(0x2ad),_0x2669a0(0x17b)),_0x2cbcbc={},_0x43f5a4={},_0x31ef5a={},_0x3412eb=(_0x5309e9,_0x31f8a0,_0x5aac2=![])=>{const _0x3e4e4c=_0x2669a0;if(!_0x5309e9)return;for(const _0x2e9a7b in _0x5309e9){const _0x324580=_0x5309e9[_0x2e9a7b];if(_0x324580&&_0x324580[_0x3e4e4c(0x12a)]&&_0x324580['common'][_0x3e4e4c(0x264)]){const _0x1702db=(typeof _0x324580[_0x3e4e4c(0x12a)][_0x3e4e4c(0x247)]===_0x3e4e4c(0x207)?_0x324580[_0x3e4e4c(0x12a)][_0x3e4e4c(0x247)]['de']:_0x324580[_0x3e4e4c(0x12a)][_0x3e4e4c(0x247)])||_0x324580[_0x3e4e4c(0x12a)][_0x3e4e4c(0x247)];if(_0x5aac2)_0x31ef5a[_0x2e9a7b]=_0x1702db;for(const _0x2fdfdc of _0x324580[_0x3e4e4c(0x12a)][_0x3e4e4c(0x264)]){if(_0x5aac2){if(!_0x31f8a0[_0x2fdfdc])_0x31f8a0[_0x2fdfdc]=[];_0x31f8a0[_0x2fdfdc][_0x3e4e4c(0x2d3)](_0x2e9a7b);}else _0x31f8a0[_0x2fdfdc]=_0x1702db;}}}};_0x3412eb(_0xf89834,_0x2cbcbc),_0x3412eb(_0x37ee31,_0x43f5a4,!![]);const _0x27afd9=await this['getForeignObjectsAsync']('*','state'),_0xa4dfde=[_0x2669a0(0x188),_0x2669a0(0x262),_0x2669a0(0x1c6),'vis.',_0x2669a0(0x14a),_0x2669a0(0x1bc),_0x2669a0(0x1cd),'flot.'];if(!_0x440b46)_0xa4dfde[_0x2669a0(0x2d3)]('daswetter.',_0x2669a0(0x115),_0x2669a0(0x2a0),_0x2669a0(0x126),_0x2669a0(0x1e4));const _0x2c7877=[_0x2669a0(0x28c),_0x2669a0(0x1f1),_0x2669a0(0x1b5),_0x2669a0(0x26c),'FAULT','SABOTAGE',_0x2669a0(0x28e),_0x2669a0(0x1b0),'DUTYCYCLE',_0x2669a0(0x17c),'DIRECTION',_0x2669a0(0x18e),_0x2669a0(0x285),'VIRTUAL_CHANNEL',_0x2669a0(0x209),_0x2669a0(0x1f5),_0x2669a0(0x18b),_0x2669a0(0x2bd),_0x2669a0(0x25b),'ERROR_CODE',_0x2669a0(0x27a),'AES_KEY','CONNECTION',_0x2669a0(0x29f),_0x2669a0(0x2a8),_0x2669a0(0x12b),'update',_0x2669a0(0x138),_0x2669a0(0x11b),_0x2669a0(0x253),'info',_0x2669a0(0x297),_0x2669a0(0x24a),_0x2669a0(0x173),_0x2669a0(0x25d),'alert',_0x2669a0(0x270),_0x2669a0(0x1b3),'effect','xy','ct',_0x2669a0(0x22e),_0x2669a0(0x1f6),_0x2669a0(0x24b),'manufacturer',_0x2669a0(0x117),_0x2669a0(0x15e),_0x2669a0(0x252),'mac\x20address',_0x2669a0(0x152),_0x2669a0(0x257),_0x2669a0(0x1a5),_0x2669a0(0x2d8),_0x2669a0(0x1bd),_0x2669a0(0x11d),'detectionState',_0x2669a0(0x134),_0x2669a0(0x122),'history','forecast',_0x2669a0(0x180),_0x2669a0(0x254)],_0x15234b=(_0x254b0c,_0x41d50d,_0x3e7d5a=![])=>{const _0x21a420=_0x2669a0,_0x14ce4e=_0x254b0c[_0x21a420(0x21e)]('.');if(_0x41d50d[_0x254b0c])return _0x41d50d[_0x254b0c];if(_0x14ce4e[_0x21a420(0x169)]>0x2&&_0x41d50d[_0x14ce4e[_0x21a420(0x2a1)](0x0,-0x1)['join']('.')])return _0x41d50d[_0x14ce4e[_0x21a420(0x2a1)](0x0,-0x1)['join']('.')];if(_0x14ce4e[_0x21a420(0x169)]>0x3&&_0x41d50d[_0x14ce4e[_0x21a420(0x2a1)](0x0,-0x2)[_0x21a420(0x16e)]('.')])return _0x41d50d[_0x14ce4e[_0x21a420(0x2a1)](0x0,-0x2)[_0x21a420(0x16e)]('.')];return _0x3e7d5a?[]:null;};for(const _0x35ff2a in _0x27afd9){const _0xf96c72=_0x27afd9[_0x35ff2a];if(!_0xf96c72||!_0xf96c72['common'])continue;if(_0xa4dfde['some'](_0x5434a6=>_0x35ff2a['startsWith'](_0x5434a6)))continue;const _0xc6b029=_0xf96c72[_0x2669a0(0x12a)]['role']||'',_0x137829=(_0xf96c72[_0x2669a0(0x12a)][_0x2669a0(0x247)]&&typeof _0xf96c72[_0x2669a0(0x12a)]['name']===_0x2669a0(0x207)?_0xf96c72['common'][_0x2669a0(0x247)]['de']:_0xf96c72['common']['name'])||'',_0xc13d11=_0x137829?_0x137829[_0x2669a0(0x10e)]():'',_0xb24a3e=_0x35ff2a[_0x2669a0(0x10e)](),_0x3bc72b=_0x15234b(_0x35ff2a,_0x2cbcbc),_0x176c7b=_0x15234b(_0x35ff2a,_0x43f5a4,!![]);let _0x15a93b=null,_0x3369a5=![];if(_0x176c7b&&_0x176c7b[_0x2669a0(0x169)]>0x0){const _0x1701a5=_0x176c7b[_0x2669a0(0x1e5)](_0x1c8833=>_0x3f76d7[_0x2669a0(0x2b3)](_0x1c8833));if(_0x1701a5){_0x3369a5=!![];const _0x27d458=_0x31ef5a[_0x1701a5];if(_0xb24a3e[_0x2669a0(0x2b3)](_0x2669a0(0x227))||_0xb24a3e[_0x2669a0(0x2b3)](_0x2669a0(0x274)))_0x15a93b=_0x2669a0(0x13e);else{if(_0xb24a3e[_0x2669a0(0x2b3)](_0x2669a0(0x261))||_0xb24a3e[_0x2669a0(0x2b3)](_0x2669a0(0x128))||_0xc13d11[_0x2669a0(0x2b3)](_0x2669a0(0x1b6)))_0x15a93b=_0x2669a0(0x26a);else{if(_0xb24a3e['includes'](_0x2669a0(0x1fb))||_0xb24a3e[_0x2669a0(0x2b3)](_0x2669a0(0x22f))||_0xb24a3e[_0x2669a0(0x2b3)]('on'))_0x15a93b=_0x2669a0(0x18d);else _0x15a93b=_0x27d458;}}}}if(!_0x3369a5&&!_0x440b46){if(_0x2c7877[_0x2669a0(0x1ba)](_0x2ab6c0=>_0xc13d11['includes'](_0x2ab6c0)||_0x35ff2a['toUpperCase']()[_0x2669a0(0x2b3)](_0x2ab6c0)))continue;}if(!_0x15a93b&&_0x1c545c){if(_0xc6b029[_0x2669a0(0x2b3)](_0x2669a0(0x25e))||_0xc6b029[_0x2669a0(0x2b3)]('occupancy')||_0xc13d11[_0x2669a0(0x2b3)]('bewegung')||_0xc13d11[_0x2669a0(0x2b3)](_0x2669a0(0x1f3)))_0x15a93b=_0x2669a0(0x13e);}!_0x15a93b&&_0x56c938&&((_0xb24a3e[_0x2669a0(0x2b3)](_0x2669a0(0x255))||_0xc6b029[_0x2669a0(0x2b3)](_0x2669a0(0x2c5))||_0xc6b029[_0x2669a0(0x2b3)]('sensor.window')||(_0xc13d11[_0x2669a0(0x2b3)](_0x2669a0(0x2c4))||_0xc13d11[_0x2669a0(0x2b3)](_0x2669a0(0x20c)))&&!_0xc13d11['includes'](_0x2669a0(0x165))&&!_0xc13d11[_0x2669a0(0x2b3)](_0x2669a0(0x181))&&(_0xf96c72[_0x2669a0(0x12a)][_0x2669a0(0x273)]==='boolean'||_0xf96c72[_0x2669a0(0x12a)][_0x2669a0(0x273)]==='number'))&&(_0x15a93b=_0x2669a0(0x234)));if(!_0x15a93b&&_0x23a7b4){if((_0xc6b029[_0x2669a0(0x2b3)](_0x2669a0(0x17d))||_0xc6b029[_0x2669a0(0x2b3)](_0x2669a0(0x1b9))||_0xc13d11['includes'](_0x2669a0(0x160))||_0xc13d11[_0x2669a0(0x2b3)](_0x2669a0(0x213)))&&_0xf96c72[_0x2669a0(0x12a)][_0x2669a0(0x1f7)])_0x15a93b=_0x2669a0(0x24d);}if(!_0x15a93b&&_0x5cd759){if(_0xc6b029[_0x2669a0(0x2b3)](_0x2669a0(0x250))||_0xc6b029[_0x2669a0(0x2b3)]('value.humidity')||_0xc13d11[_0x2669a0(0x2b3)](_0x2669a0(0x1c0)))_0x15a93b=_0x2669a0(0x27c);}if(_0x15a93b){let _0x4176b1=_0x3bc72b||'';if(!_0x4176b1){if(_0xc13d11[_0x2669a0(0x2b3)](_0x2669a0(0x2e2)))_0x4176b1=_0x2669a0(0x2ae);else{if(_0xc13d11[_0x2669a0(0x2b3)]('k√ºche'))_0x4176b1=_0x2669a0(0x164);else{if(_0xc13d11[_0x2669a0(0x2b3)](_0x2669a0(0x20e)))_0x4176b1='Wohnzimmer';else{if(_0xc13d11[_0x2669a0(0x2b3)](_0x2669a0(0x23a)))_0x4176b1='Schlafzimmer';else{if(_0xc13d11[_0x2669a0(0x2b3)](_0x2669a0(0x1d0))||_0xc13d11[_0x2669a0(0x2b3)](_0x2669a0(0x239)))_0x4176b1='Flur';else{if(_0xc13d11[_0x2669a0(0x2b3)](_0x2669a0(0x2cc)))_0x4176b1=_0x2669a0(0x1ca);}}}}}}let _0x45484f=![];_0x15a93b===_0x2669a0(0x234)&&((_0xc13d11['includes'](_0x2669a0(0x212))||_0xc13d11['includes']('eingang')||_0xc13d11[_0x2669a0(0x2b3)]('wohnungst√ºr')||_0x4176b1&&_0x4176b1['toLowerCase']()['includes'](_0x2669a0(0x1d0))&&_0xc13d11[_0x2669a0(0x2b3)]('t√ºr'))&&(_0x45484f=!![]));let _0x597d63=0x0;if(_0x3369a5)_0x597d63+=0x1e;else{if(_0x3bc72b)_0x597d63+=0x14;else{if(_0x4176b1)_0x597d63+=0xa;}}if(_0x45484f)_0x597d63+=0x5;_0x2f1da7[_0x2669a0(0x2d3)]({'id':_0x35ff2a,'name':_0x137829||_0x35ff2a,'type':_0x15a93b,'location':_0x4176b1,'logDuplicates':_0x15a93b==='Bewegung','isExit':_0x45484f,'_score':_0x597d63});}}return _0x2f1da7[_0x2669a0(0x292)]((_0x56987a,_0x37e582)=>_0x37e582['_score']-_0x56987a[_0x2669a0(0x22b)]),_0x2f1da7;}['setupLtmScheduler'](){const _0x50903d=a0_0x11336b;try{if(this[_0x50903d(0x2df)])this[_0x50903d(0x2df)][_0x50903d(0x13b)]();if(!this['isProVersion']){this['setStateAsync'](LTM_DP_STATUS,{'val':_0x50903d(0x256),'ack':!![]});return;}this[_0x50903d(0x2df)]=schedule['scheduleJob'](LTM_SCHEDULE,()=>this[_0x50903d(0x127)]());}catch(_0x19734b){this['log'][_0x50903d(0x287)](_0x50903d(0x251)+_0x19734b['message']);}}[a0_0x11336b(0x2aa)](){const _0x26ac90=a0_0x11336b;try{if(this[_0x26ac90(0x28d)])this['modeResetJob'][_0x26ac90(0x13b)]();this[_0x26ac90(0x28d)]=schedule[_0x26ac90(0x1d2)](MODE_RESET_SCHEDULE,async()=>{const _0x373c8a=_0x26ac90;await this[_0x373c8a(0x2bb)](),AUTO_RESET_MODES['includes'](this['currentSystemMode'])&&await this[_0x373c8a(0x199)](SYSTEM_DP_MODE,{'val':SYSTEM_MODES[_0x373c8a(0x2d5)],'ack':![]});});}catch(_0x2d5062){this[_0x26ac90(0x112)][_0x26ac90(0x287)](_0x26ac90(0x1f9)+_0x2d5062['message']);}}['setupDriftAnalysisScheduler'](){const _0x13ff08=a0_0x11336b;try{if(this[_0x13ff08(0x176)])clearInterval(this[_0x13ff08(0x176)]);if(!this[_0x13ff08(0x1d4)])return;this['driftAnalysisTimer']=setInterval(()=>this['runBaselineDriftAnalysis'](),(this[_0x13ff08(0x222)][_0x13ff08(0x2c0)]||0x18)*0x36ee80),setTimeout(()=>this[_0x13ff08(0x211)](),0x1388);}catch(_0x3cd2cb){this['log']['error']('Drift\x20Sched\x20Error:\x20'+_0x3cd2cb[_0x13ff08(0x167)]);}}[a0_0x11336b(0x110)](){const _0x250b99=a0_0x11336b;try{if(this['briefingJob'])this[_0x250b99(0x241)][_0x250b99(0x13b)]();if(!this[_0x250b99(0x222)][_0x250b99(0x1ee)])return;const _0x5e9e79=(this[_0x250b99(0x222)][_0x250b99(0x23b)]||_0x250b99(0x2b5))[_0x250b99(0x21e)](':'),_0x17c9de=parseInt(_0x5e9e79[0x0])||0x8,_0x35bf3a=parseInt(_0x5e9e79[0x1])||0x0,_0x349500=_0x35bf3a+'\x20'+_0x17c9de+'\x20*\x20*\x20*';this[_0x250b99(0x112)]['info'](_0x250b99(0x161)+_0x17c9de+':'+(_0x35bf3a<0xa?'0'+_0x35bf3a:_0x35bf3a)),this[_0x250b99(0x241)]=schedule[_0x250b99(0x1d2)](_0x349500,()=>{this['sendMorningBriefing']();});}catch(_0x528899){this[_0x250b99(0x112)][_0x250b99(0x287)](_0x250b99(0x29a)+_0x528899[_0x250b99(0x167)]);}}async['runBaselineDriftAnalysis'](){const _0x362fb0=a0_0x11336b;if(!this[_0x362fb0(0x1d4)]||!this[_0x362fb0(0x299)])return;const _0x34f794=this[_0x362fb0(0x222)][_0x362fb0(0x19e)]||0xe;if(this[_0x362fb0(0x259)]['length']<_0x34f794+(this['config'][_0x362fb0(0x28a)]||0x7)){await this['setStateAsync'](LTM_DP_DRIFT_STATUS,{'val':_0x362fb0(0x1aa),'ack':!![]});return;}const _0xfef85e=this[_0x362fb0(0x259)]['slice'](-_0x34f794),_0x920d42=this['dailyDigests'][_0x362fb0(0x2a1)](0x0,this[_0x362fb0(0x259)][_0x362fb0(0x169)]-_0x34f794),_0x2ebd99=_0x362fb0(0x133)+JSON[_0x362fb0(0x1bf)](_0x920d42)+_0x362fb0(0x18c)+JSON[_0x362fb0(0x1bf)](_0xfef85e);try{const _0x288f60=await this['geminiModel'][_0x362fb0(0x1fa)](_0x2ebd99),_0x1bf660=JSON[_0x362fb0(0x191)](_0x288f60[_0x362fb0(0x16d)][_0x362fb0(0x193)]()[_0x362fb0(0x245)](/```json|```/g,'')[_0x362fb0(0x2bc)]());_0x1bf660[_0x362fb0(0x111)]&&(await this[_0x362fb0(0x199)](LTM_DP_DRIFT_STATUS,{'val':_0x1bf660['baselineDrift'],'ack':!![]}),await this['setStateAsync'](LTM_DP_DRIFT_DETAILS,{'val':_0x1bf660[_0x362fb0(0x295)],'ack':!![]}),await this[_0x362fb0(0x199)](LTM_DP_DRIFT_LAST_CHECK,{'val':Date[_0x362fb0(0x293)](),'ack':!![]}));}catch(_0xc7bddc){}}async[a0_0x11336b(0x2bb)](){const _0x3faf59=a0_0x11336b;try{const _0x4d4b19=await this['getStateAsync'](SYSTEM_DP_MODE);_0x4d4b19&&_0x4d4b19[_0x3faf59(0x2bf)]&&Object[_0x3faf59(0x2a7)](SYSTEM_MODES)[_0x3faf59(0x2b3)](_0x4d4b19['val'])?this[_0x3faf59(0x170)]=_0x4d4b19['val']:(this[_0x3faf59(0x170)]=SYSTEM_MODES[_0x3faf59(0x2d5)],await this['setStateAsync'](SYSTEM_DP_MODE,{'val':SYSTEM_MODES['NORMAL'],'ack':!![]}));}catch(_0x3ca63){this[_0x3faf59(0x170)]=SYSTEM_MODES[_0x3faf59(0x2d5)];}}async['loadRawEventLog'](){const _0x12dd62=a0_0x11336b;try{const _0xd1a0a7=await this[_0x12dd62(0x2ce)](LTM_DP_RAW_LOG);if(_0xd1a0a7&&_0xd1a0a7[_0x12dd62(0x2bf)])this[_0x12dd62(0x119)]=JSON[_0x12dd62(0x191)](_0xd1a0a7[_0x12dd62(0x2bf)]);}catch(_0x1cfb7f){this[_0x12dd62(0x119)]=[];}}async['loadDailyDigests'](){const _0x2f4f7a=a0_0x11336b;try{const _0x5df6fe=await this[_0x2f4f7a(0x2ce)](LTM_DP_DAILY_DIGESTS);if(_0x5df6fe&&_0x5df6fe[_0x2f4f7a(0x2bf)])this[_0x2f4f7a(0x259)]=JSON['parse'](_0x5df6fe[_0x2f4f7a(0x2bf)]);}catch(_0x3c9e8a){this[_0x2f4f7a(0x259)]=[];}await this['updateBaselineStatus']();}async[a0_0x11336b(0x124)](){const _0x32407f=a0_0x11336b;this[_0x32407f(0x119)][_0x32407f(0x169)]>RAW_LOG_MAX_SIZE&&this['rawEventLog']['splice'](0x0,this[_0x32407f(0x119)]['length']-RAW_LOG_MAX_SIZE),await this[_0x32407f(0x199)](LTM_DP_RAW_LOG,{'val':JSON[_0x32407f(0x1bf)](this[_0x32407f(0x119)]),'ack':!![]});}async[a0_0x11336b(0x1ed)](_0x34b262=!![]){const _0x29f11c=a0_0x11336b,_0x263b3c=this[_0x29f11c(0x222)][_0x29f11c(0x2d0)]||0x3c;this[_0x29f11c(0x259)]['length']>_0x263b3c&&this[_0x29f11c(0x259)][_0x29f11c(0x1ae)](0x0,this[_0x29f11c(0x259)][_0x29f11c(0x169)]-_0x263b3c);await this[_0x29f11c(0x199)](LTM_DP_DAILY_DIGESTS,{'val':JSON[_0x29f11c(0x1bf)](this['dailyDigests']),'ack':!![]});if(_0x34b262)await this[_0x29f11c(0x187)]();}async['updateAnalysisHistory'](_0x5b2809){const _0x46c11d=a0_0x11336b;this[_0x46c11d(0x1eb)][_0x46c11d(0x1ab)](_0x5b2809);if(this[_0x46c11d(0x1eb)]['length']>ANALYSIS_HISTORY_MAX_SIZE)this[_0x46c11d(0x1eb)][_0x46c11d(0x114)]();await this['setStateAsync'](_0x46c11d(0x2db),{'val':JSON[_0x46c11d(0x1bf)](this[_0x46c11d(0x1eb)]),'ack':!![]});}async[a0_0x11336b(0x23e)](){const _0x5d1ecd=a0_0x11336b;await this[_0x5d1ecd(0x199)](_0x5d1ecd(0x289),{'val':_0x5d1ecd(0x1d9),'ack':!![]}),await this[_0x5d1ecd(0x199)](_0x5d1ecd(0x13a),{'val':this[_0x5d1ecd(0x1d4)]?'N/A\x20(No\x20Activity)':_0x5d1ecd(0x145),'ack':!![]}),await this['setStateAsync'](_0x5d1ecd(0x172),{'val':![],'ack':!![]}),await this[_0x5d1ecd(0x199)](_0x5d1ecd(0x116),{'val':![],'ack':!![]}),this[_0x5d1ecd(0x1c9)]=![];}async[a0_0x11336b(0x187)](){const _0x57857f=a0_0x11336b;if(!this['isProVersion']){await this[_0x57857f(0x199)](LTM_DP_BASELINE_STATUS,{'val':_0x57857f(0x256),'ack':!![]});return;}const _0x315be9=this['dailyDigests'][_0x57857f(0x169)]>=(this[_0x57857f(0x222)][_0x57857f(0x28a)]||0x7)?_0x57857f(0x148)+this['dailyDigests'][_0x57857f(0x169)]+'\x20Tage)':'Lernphase\x20('+this[_0x57857f(0x259)]['length']+'/'+(this[_0x57857f(0x222)]['minDaysForBaseline']||0x7)+')';await this[_0x57857f(0x199)](LTM_DP_BASELINE_STATUS,{'val':_0x315be9,'ack':!![]});}}if(require[a0_0x11336b(0x125)]!==module)module[a0_0x11336b(0x19b)]=_0x5dd639=>new CogniLiving(_0x5dd639);else new CogniLiving();