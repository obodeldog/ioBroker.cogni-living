const a0_0x4f3c29=a0_0x1125;(function(_0x2ee7d6,_0x1eb20c){const _0x49d4e4=a0_0x1125,_0x2fedfb=_0x2ee7d6();while(!![]){try{const _0x58559c=-parseInt(_0x49d4e4(0xf3))/0x1*(-parseInt(_0x49d4e4(0x138))/0x2)+parseInt(_0x49d4e4(0x293))/0x3*(parseInt(_0x49d4e4(0xf1))/0x4)+parseInt(_0x49d4e4(0x22d))/0x5+parseInt(_0x49d4e4(0x284))/0x6*(-parseInt(_0x49d4e4(0xff))/0x7)+-parseInt(_0x49d4e4(0x203))/0x8*(-parseInt(_0x49d4e4(0x18d))/0x9)+-parseInt(_0x49d4e4(0x232))/0xa*(-parseInt(_0x49d4e4(0x19b))/0xb)+-parseInt(_0x49d4e4(0x220))/0xc;if(_0x58559c===_0x1eb20c)break;else _0x2fedfb['push'](_0x2fedfb['shift']());}catch(_0x259658){_0x2fedfb['push'](_0x2fedfb['shift']());}}}(a0_0x3e88,0xdeeeb));const a0_0x2d41cf=(function(){let _0x17894d=!![];return function(_0x2e5e0d,_0x49ad14){const _0x402802=_0x17894d?function(){if(_0x49ad14){const _0x394ba5=_0x49ad14['apply'](_0x2e5e0d,arguments);return _0x49ad14=null,_0x394ba5;}}:function(){};return _0x17894d=![],_0x402802;};}()),a0_0x227cd1=a0_0x2d41cf(this,function(){const _0x54c550=a0_0x1125;return a0_0x227cd1[_0x54c550(0x248)]()['search']('(((.+)+)+)+$')[_0x54c550(0x248)]()['constructor'](a0_0x227cd1)[_0x54c550(0x250)](_0x54c550(0x1e3));});a0_0x227cd1();'use strict';const utils=require('@iobroker/adapter-core'),{GoogleGenerativeAI}=require('@google/generative-ai'),schedule=require(a0_0x4f3c29(0x236)),{spawn,exec}=require('child_process'),path=require(a0_0x4f3c29(0x14a)),fs=require('fs'),HISTORY_MAX_SIZE=0x32,RAW_LOG_MAX_SIZE=0x9c4,LTM_MIN_EVENTS_FOR_COMPRESSION=0x5,GEMINI_MODEL=a0_0x4f3c29(0x219),LTM_SCHEDULE=a0_0x4f3c29(0x100),MODE_RESET_SCHEDULE=a0_0x4f3c29(0x1f0),SEQUENCE_TIMEOUT_MS=0x5*0x3c*0x3e8,MAX_TRAINING_SET_SIZE=0x1f4,THERMO_LOG_SIZE=0x3e8,EXIT_TIMER_MINUTES=0xf,EXIT_GRACE_PERIOD_SECONDS=0x1e,LTM_DP_RAW_LOG=a0_0x4f3c29(0xf6),LTM_DP_DAILY_DIGESTS='LTM.dailyDigests',LTM_DP_STATUS=a0_0x4f3c29(0x137),LTM_DP_TRIGGER_DIGEST=a0_0x4f3c29(0x14b),LTM_DP_BASELINE_STATUS=a0_0x4f3c29(0x114),LTM_DP_DRIFT_CHANNEL=a0_0x4f3c29(0x1eb),LTM_DP_DRIFT_STATUS=a0_0x4f3c29(0x161),LTM_DP_DRIFT_DETAILS=a0_0x4f3c29(0x261),LTM_DP_DRIFT_LAST_CHECK=a0_0x4f3c29(0x1aa),SYSTEM_DP_MODE=a0_0x4f3c29(0x26e),SYSTEM_MODES={'NORMAL':a0_0x4f3c29(0x27a),'VACATION':a0_0x4f3c29(0x162),'PARTY':'party','GUEST':a0_0x4f3c29(0x295)},AUTO_RESET_MODES=[SYSTEM_MODES['PARTY'],SYSTEM_MODES[a0_0x4f3c29(0x26f)]],PERSONA_MAPPING={'generic':a0_0x4f3c29(0x206),'senior_aal':a0_0x4f3c29(0x1f1),'family':a0_0x4f3c29(0x1f3),'single_comfort':a0_0x4f3c29(0x213),'security':'PRIORIT√ÑT:\x20Sicherheit.'},ACTIVITY_LEVEL_MAP={'sehr\x20hoch':0x64,'hoch':0x50,'normal':0x3c,'niedrig':0x28,'sehr\x20niedrig':0x14,'inaktiv':0x0},IS_WIN=process[a0_0x4f3c29(0x18f)]===a0_0x4f3c29(0x1c3),PERSISTENT_DIR=path[a0_0x4f3c29(0x25c)](__dirname,'.venv'),VENV_PATH=PERSISTENT_DIR,PYTHON_EXE=IS_WIN?path['join'](VENV_PATH,'Scripts',a0_0x4f3c29(0x185)):path[a0_0x4f3c29(0x25c)](VENV_PATH,a0_0x4f3c29(0x106),a0_0x4f3c29(0x199)),PIP_EXE=IS_WIN?path['join'](VENV_PATH,a0_0x4f3c29(0x196),a0_0x4f3c29(0x285)):path[a0_0x4f3c29(0x25c)](VENV_PATH,'bin',a0_0x4f3c29(0x136));let activeSequence=[],sequenceTimer=null;async function startSystem(_0x1e5a36){const _0x83b7f7=a0_0x4f3c29;_0x1e5a36['log'][_0x83b7f7(0x26b)](_0x83b7f7(0x288)),await initZombies(_0x1e5a36);try{_0x1e5a36[_0x83b7f7(0x145)]=await checkLicense(_0x1e5a36[_0x83b7f7(0x140)][_0x83b7f7(0x1f5)]);}catch(_0x53075a){}if(!_0x1e5a36[_0x83b7f7(0x140)][_0x83b7f7(0x169)]||_0x1e5a36[_0x83b7f7(0x140)][_0x83b7f7(0x169)]<0.1)_0x1e5a36[_0x83b7f7(0x140)][_0x83b7f7(0x169)]=0xc;await initHistory(_0x1e5a36),await initSystemConfig(_0x1e5a36);if(_0x1e5a36[_0x83b7f7(0x140)][_0x83b7f7(0x1a2)])try{_0x1e5a36[_0x83b7f7(0x202)]=new GoogleGenerativeAI(_0x1e5a36[_0x83b7f7(0x140)]['geminiApiKey']),_0x1e5a36[_0x83b7f7(0x1b1)]=_0x1e5a36[_0x83b7f7(0x202)]['getGenerativeModel']({'model':GEMINI_MODEL,'generationConfig':{'responseMimeType':'application/json'}}),_0x1e5a36[_0x83b7f7(0x282)][_0x83b7f7(0x26b)](_0x83b7f7(0x12f));}catch(_0x2b07d2){_0x1e5a36[_0x83b7f7(0x282)][_0x83b7f7(0x1b5)](_0x83b7f7(0x224)+_0x2b07d2[_0x83b7f7(0x128)]);}await createAllObjects(_0x1e5a36),await loadSystemMode(_0x1e5a36),await loadRawEventLog(_0x1e5a36),await loadDailyDigests(_0x1e5a36),_0x1e5a36[_0x83b7f7(0x1d8)](_0x83b7f7(0x112)),_0x1e5a36[_0x83b7f7(0x1d8)](LTM_DP_TRIGGER_DIGEST),_0x1e5a36[_0x83b7f7(0x1d8)](_0x83b7f7(0x26e)),_0x1e5a36[_0x83b7f7(0x1d8)](_0x83b7f7(0x19c)),_0x1e5a36['subscribeStates'](_0x83b7f7(0xfc)),_0x1e5a36['subscribeStates'](_0x83b7f7(0x10d)),_0x1e5a36[_0x83b7f7(0x1d8)](_0x83b7f7(0x263)),_0x1e5a36[_0x83b7f7(0x1d8)]('analysis.training.triggerHealth'),_0x1e5a36[_0x83b7f7(0x1d8)](_0x83b7f7(0x13f)),_0x1e5a36[_0x83b7f7(0x1d8)](_0x83b7f7(0x103)),await initSensorSubscriptions(_0x1e5a36),await initPresenceSubscriptions(_0x1e5a36),await setupTelegramListener(_0x1e5a36),setTimeout(()=>checkWifiPresence(_0x1e5a36),0x1388);if(_0x1e5a36['analysisTimer'])clearInterval(_0x1e5a36[_0x83b7f7(0x1fc)]);const _0x5c149f=_0x1e5a36[_0x83b7f7(0x140)][_0x83b7f7(0x1e8)]||0xf;_0x5c149f>0x0&&(_0x1e5a36[_0x83b7f7(0x1fc)]=setInterval(()=>{runAutopilot(_0x1e5a36);},_0x5c149f*0x3c*0x3e8)),setupLtmScheduler(_0x1e5a36),setupModeResetScheduler(_0x1e5a36),setupDriftAnalysisScheduler(_0x1e5a36),setupBriefingScheduler(_0x1e5a36),startPythonService(_0x1e5a36),setTimeout(()=>{const _0x54ed43=_0x83b7f7;if(_0x1e5a36[_0x54ed43(0x14d)])runPythonHealthCheck(_0x1e5a36);},0x1388);}async function runAutopilot(_0x5263b8){const _0x163c0f=a0_0x4f3c29;_0x5263b8[_0x163c0f(0x282)][_0x163c0f(0x1c8)](_0x163c0f(0x280)),await runGeminiAnalysis(_0x5263b8);}async function scanForDevices(_0x1a7092,_0x87cba6){const _0xd850a3=a0_0x4f3c29;_0x1a7092[_0xd850a3(0x282)][_0xd850a3(0x26b)]('üîç\x20Scanning\x20for\x20devices...');const _0x379c6d=[],_0x363ea7=await _0x1a7092['getForeignObjectsAsync']('*');for(const _0x7be38e in _0x363ea7){const _0x2a45f6=_0x363ea7[_0x7be38e];if(_0x2a45f6&&_0x2a45f6[_0xd850a3(0x1dd)]&&_0x2a45f6['type']===_0xd850a3(0x171)){const _0x5d43f4=(_0x2a45f6[_0xd850a3(0x1dd)]['name']&&typeof _0x2a45f6['common'][_0xd850a3(0x184)]===_0xd850a3(0x10b)?_0x2a45f6[_0xd850a3(0x1dd)][_0xd850a3(0x184)]['de']:_0x2a45f6[_0xd850a3(0x1dd)][_0xd850a3(0x184)])||'',_0x2699fd=_0x2a45f6[_0xd850a3(0x1dd)]['role']||'';let _0x41a0ac=null;if(_0x87cba6[_0xd850a3(0x117)]&&(_0x2699fd[_0xd850a3(0x273)]('motion')||_0x5d43f4[_0xd850a3(0x124)]()['includes'](_0xd850a3(0x1a0))))_0x41a0ac=_0xd850a3(0x117);else{if(_0x87cba6[_0xd850a3(0x1c6)]&&(_0x2699fd[_0xd850a3(0x273)]('door')||_0x2699fd[_0xd850a3(0x273)](_0xd850a3(0x1ce))||_0x5d43f4[_0xd850a3(0x124)]()['includes'](_0xd850a3(0x266))||_0x5d43f4[_0xd850a3(0x124)]()[_0xd850a3(0x273)](_0xd850a3(0x164))))_0x41a0ac=_0xd850a3(0x1c7);else{if(_0x87cba6[_0xd850a3(0x16a)]&&(_0x2699fd[_0xd850a3(0x273)](_0xd850a3(0x269))||_0x2699fd['includes'](_0xd850a3(0x230))||_0x5d43f4[_0xd850a3(0x124)]()[_0xd850a3(0x273)]('licht')))_0x41a0ac='light';else{if(_0x87cba6[_0xd850a3(0x262)]&&(_0x2699fd[_0xd850a3(0x273)](_0xd850a3(0x262))||_0x5d43f4['toLowerCase']()[_0xd850a3(0x273)](_0xd850a3(0x228))))_0x41a0ac=_0xd850a3(0x262);}}}if(_0x41a0ac){let _0x30a49d='';const _0x5c4b13=_0x7be38e[_0xd850a3(0x241)]('.');if(_0x5c4b13[_0xd850a3(0x16e)]>0x2)_0x30a49d=_0x5c4b13[0x2];_0x379c6d[_0xd850a3(0x1a8)]({'id':_0x7be38e,'name':_0x5d43f4||_0x7be38e,'type':_0x41a0ac,'location':_0x30a49d,'_score':0x32});}}}return _0x379c6d;}async function getWeatherContext(_0x148202){const _0x4e09aa=a0_0x4f3c29;if(!_0x148202[_0x4e09aa(0x140)]['useWeather']||!_0x148202[_0x4e09aa(0x140)][_0x4e09aa(0xfa)])return'Wetterdaten\x20deaktiviert.';try{const _0x2a7981=_0x148202['config'][_0x4e09aa(0xfa)];let _0x625104=await _0x148202['getForeignStateAsync'](_0x2a7981+_0x4e09aa(0x264));if(!_0x625104)_0x625104=await _0x148202[_0x4e09aa(0x1ed)](_0x2a7981+_0x4e09aa(0x13a));let _0x42df90=await _0x148202[_0x4e09aa(0x1ed)](_0x2a7981+'.Current.WeatherText');if(!_0x42df90)_0x42df90=await _0x148202[_0x4e09aa(0x1ed)](_0x2a7981+_0x4e09aa(0x276));if(_0x625104&&_0x42df90)return _0x625104[_0x4e09aa(0x187)]+_0x4e09aa(0x20d)+_0x42df90[_0x4e09aa(0x187)];}catch(_0x2a50ce){}return _0x4e09aa(0x1ba);}async function getCalendarContext(_0x2df129){const _0x3d0ce2=a0_0x4f3c29;if(!_0x2df129['config'][_0x3d0ce2(0x163)]||!_0x2df129[_0x3d0ce2(0x140)]['calendarInstance'])return _0x3d0ce2(0x1df);return _0x3d0ce2(0x173);}async function getCalendarNames(_0x52e01b,_0x297790){return[];}async function saveFeedback(_0x1e338a,_0x20d9a9){const _0xfcbc91=a0_0x4f3c29;_0x1e338a['log'][_0xfcbc91(0x26b)](_0xfcbc91(0x13c)+_0x20d9a9['rating']);}async function sendMorningBriefing(_0x39df39){const _0x473cb5=a0_0x4f3c29;if(!_0x39df39[_0x473cb5(0x1b1)])return;try{const _0x5e688d='Erstelle\x20ein\x20kurzes\x20\x27Guten\x20Morgen\x27\x20Briefing\x20basierend\x20auf\x20den\x20Events\x20der\x20letzten\x20Nacht.',_0x5e4156=await _0x39df39[_0x473cb5(0x1b1)][_0x473cb5(0x24a)](_0x5e688d),_0x28f016=_0x5e4156['response']['text']();sendNotification(_0x39df39,_0x473cb5(0x101)+_0x28f016);}catch(_0x4eaa90){_0x39df39[_0x473cb5(0x282)]['error'](_0x473cb5(0x27d)+_0x4eaa90[_0x473cb5(0x128)]);}}function a0_0x1125(_0x5d0724,_0x491f4b){const _0x1debb1=a0_0x3e88();return a0_0x1125=function(_0x227cd1,_0x2d41cf){_0x227cd1=_0x227cd1-0xf1;let _0x3e8805=_0x1debb1[_0x227cd1];return _0x3e8805;},a0_0x1125(_0x5d0724,_0x491f4b);}function checkAndInstall(_0x13bdcf){const _0x22b06c=a0_0x4f3c29;if(!fs['existsSync'](VENV_PATH)||!fs[_0x22b06c(0x205)](PIP_EXE))return _0x13bdcf['log'][_0x22b06c(0x1a4)](_0x22b06c(0x1c4)),installPythonDependencies(_0x13bdcf),![];return!![];}function installPythonDependencies(_0x473985){const _0x28be85=a0_0x4f3c29;if(_0x473985[_0x28be85(0x139)])return;_0x473985[_0x28be85(0x139)]=!![];const _0x12a2af=path[_0x28be85(0x25c)](__dirname,'python_service',_0x28be85(0x1e6));stopPythonService(_0x473985);if(fs['existsSync'](VENV_PATH))try{fs[_0x28be85(0x290)](VENV_PATH,{'recursive':!![],'force':!![]});}catch(_0x1ef113){}exec('python3\x20-m\x20venv\x20\x22'+VENV_PATH+'\x22',_0x5bdde1=>{const _0x5398b5=_0x28be85;if(_0x5bdde1){_0x473985[_0x5398b5(0x282)][_0x5398b5(0x1b5)](_0x5398b5(0x17a)+_0x5bdde1[_0x5398b5(0x128)]),_0x473985[_0x5398b5(0x139)]=![];return;}installRequirementsInVenv(_0x473985,_0x12a2af);});}function installRequirementsInVenv(_0x3d3c58,_0x30fb29){const _0x55b59c=a0_0x4f3c29;_0x3d3c58[_0x55b59c(0x282)][_0x55b59c(0x26b)](_0x55b59c(0x24e));const _0x13bc8c='\x22'+PIP_EXE+_0x55b59c(0x146)+_0x30fb29+'\x22';exec(_0x13bc8c,{'timeout':0x124f80},(_0x247a32,_0x161a9d,_0x20b12f)=>{const _0x43f328=_0x55b59c;_0x3d3c58[_0x43f328(0x139)]=![],_0x247a32?_0x3d3c58[_0x43f328(0x282)][_0x43f328(0x1b5)](_0x43f328(0x155)+(_0x20b12f||_0x247a32[_0x43f328(0x128)])):(_0x3d3c58[_0x43f328(0x282)]['info'](_0x43f328(0x22c)),startSystem(_0x3d3c58));});}async function initZombies(_0x5a5ce9){const _0x1ffdce=a0_0x4f3c29;try{const _0x22c622=[_0x1ffdce(0x10c),_0x1ffdce(0x1af)];for(const _0x5479ee of _0x22c622){try{const _0x188b64=await _0x5a5ce9['getObjectAsync'](_0x5479ee);if(_0x188b64)await _0x5a5ce9['delObjectAsync'](_0x5479ee);}catch(_0x39d5cc){}}}catch(_0x41b5c7){}}async function checkLicense(_0x1e3e88){return!![];}async function initHistory(_0x4ec94d){const _0x43c72d=a0_0x4f3c29;try{const _0x37d889=await _0x4ec94d[_0x43c72d(0x11b)](_0x43c72d(0x21c));_0x37d889&&_0x37d889[_0x43c72d(0x187)]&&(_0x4ec94d[_0x43c72d(0x149)]=JSON[_0x43c72d(0x25a)](_0x37d889[_0x43c72d(0x187)][_0x43c72d(0x248)]()));}catch(_0x44f078){_0x4ec94d[_0x43c72d(0x149)]=[];}try{const _0x153a08=await _0x4ec94d['getStateAsync'](_0x43c72d(0x1e1));if(_0x153a08&&_0x153a08[_0x43c72d(0x187)])_0x4ec94d['analysisHistory']=JSON[_0x43c72d(0x25a)](_0x153a08[_0x43c72d(0x187)][_0x43c72d(0x248)]());}catch(_0x207bf2){_0x4ec94d['analysisHistory']=[];}if(_0x4ec94d[_0x43c72d(0x149)]&&_0x4ec94d['eventHistory'][_0x43c72d(0x16e)]>0x0){_0x4ec94d[_0x43c72d(0x282)][_0x43c72d(0x26b)](_0x43c72d(0x286));for(let _0x402ec9=_0x4ec94d[_0x43c72d(0x149)][_0x43c72d(0x16e)]-0x1;_0x402ec9>=0x0;_0x402ec9--){const _0x4d99d4=_0x4ec94d[_0x43c72d(0x149)][_0x402ec9];if(_0x4d99d4&&_0x4d99d4['id']!==undefined&&_0x4d99d4[_0x43c72d(0x259)]!==undefined)_0x4ec94d['sensorLastValues'][_0x4d99d4['id']]=_0x4d99d4[_0x43c72d(0x259)];}}}async function initSystemConfig(_0x535d0c){const _0x1b3f12=a0_0x4f3c29;try{const _0x169cdf=await _0x535d0c['getForeignObjectAsync'](_0x1b3f12(0x126));if(_0x169cdf&&_0x169cdf[_0x1b3f12(0x1dd)])_0x535d0c[_0x1b3f12(0x1e4)]={'latitude':_0x169cdf[_0x1b3f12(0x1dd)]['latitude']||0x0,'longitude':_0x169cdf[_0x1b3f12(0x1dd)][_0x1b3f12(0x258)]||0x0,'city':_0x169cdf[_0x1b3f12(0x1dd)][_0x1b3f12(0x22b)]||''};}catch(_0x5d48dd){}}async function createAllObjects(_0x5d409e){const _0x3edec9=a0_0x4f3c29;await _0x5d409e['extendObjectAsync'](_0x3edec9(0x1d5),{'type':_0x3edec9(0x182),'common':{'name':'System'},'native':{}}),await _0x5d409e[_0x3edec9(0x11c)](SYSTEM_DP_MODE,{'type':'state','common':{'name':_0x3edec9(0x23a),'type':_0x3edec9(0x14f),'role':'state','read':!![],'write':!![],'def':SYSTEM_MODES[_0x3edec9(0x1ef)]},'native':{}}),await _0x5d409e[_0x3edec9(0x25b)](_0x3edec9(0xf4),{'type':_0x3edec9(0x171),'common':{'name':_0x3edec9(0x1da),'type':_0x3edec9(0x14f),'role':'text','read':!![],'write':![]},'native':{}}),await _0x5d409e[_0x3edec9(0x25b)]('events.lastEvent',{'type':'state','common':{'name':'Last\x20raw\x20event','type':'string','role':'json','read':!![],'write':![]},'native':{}}),await _0x5d409e[_0x3edec9(0x25b)](_0x3edec9(0x21c),{'type':_0x3edec9(0x171),'common':{'name':_0x3edec9(0x227),'type':'string','role':_0x3edec9(0x190),'read':!![],'write':![]},'native':{}}),await _0x5d409e[_0x3edec9(0x11c)]('analysis.training',{'type':_0x3edec9(0x182),'common':{'name':_0x3edec9(0x111)},'native':{}}),await _0x5d409e['setObjectNotExistsAsync']('analysis.training.triggerSecurity',{'type':_0x3edec9(0x171),'common':{'name':'Train\x20Security','type':_0x3edec9(0x245),'role':_0x3edec9(0x24c),'read':!![],'write':!![]},'native':{}}),await _0x5d409e[_0x3edec9(0x25b)](_0x3edec9(0x27e),{'type':_0x3edec9(0x171),'common':{'name':_0x3edec9(0x243),'type':_0x3edec9(0x245),'role':_0x3edec9(0x24c),'read':!![],'write':!![]},'native':{}}),await _0x5d409e[_0x3edec9(0x25b)]('analysis.training.triggerEnergy',{'type':_0x3edec9(0x171),'common':{'name':'Train\x20Energy','type':_0x3edec9(0x245),'role':_0x3edec9(0x24c),'read':!![],'write':!![]},'native':{}}),await _0x5d409e['setObjectNotExistsAsync'](_0x3edec9(0x103),{'type':'state','common':{'name':'Train\x20Comfort','type':_0x3edec9(0x245),'role':'button','read':!![],'write':!![]},'native':{}}),await _0x5d409e[_0x3edec9(0x25b)](_0x3edec9(0x233),{'type':_0x3edec9(0x171),'common':{'name':_0x3edec9(0x1d3),'type':'string','role':'text','read':!![],'write':![]},'native':{}}),await _0x5d409e[_0x3edec9(0x11c)](_0x3edec9(0x256),{'type':_0x3edec9(0x182),'common':{'name':_0x3edec9(0x292)},'native':{}}),await _0x5d409e['setObjectNotExistsAsync'](_0x3edec9(0x1b9),{'type':_0x3edec9(0x171),'common':{'name':'Anomaly\x20Score','type':_0x3edec9(0x150),'role':_0x3edec9(0x259),'read':!![],'write':![]},'native':{}}),await _0x5d409e['setObjectNotExistsAsync'](_0x3edec9(0x1cc),{'type':'state','common':{'name':'Current\x20Threshold','type':_0x3edec9(0x150),'role':_0x3edec9(0x259),'read':!![],'write':![],'def':0.05},'native':{}}),await _0x5d409e['setObjectNotExistsAsync'](_0x3edec9(0x19a),{'type':_0x3edec9(0x171),'common':{'name':_0x3edec9(0x20c),'type':_0x3edec9(0x14f),'role':_0x3edec9(0x189),'read':!![],'write':![]},'native':{}}),await _0x5d409e[_0x3edec9(0x11c)](_0x3edec9(0x24f),{'type':_0x3edec9(0x182),'common':{'name':_0x3edec9(0x204)},'native':{}}),await _0x5d409e[_0x3edec9(0x25b)]('analysis.health.lastCheck',{'type':_0x3edec9(0x171),'common':{'name':_0x3edec9(0x20c),'type':_0x3edec9(0x14f),'role':_0x3edec9(0x189),'read':!![],'write':![]},'native':{}}),await _0x5d409e[_0x3edec9(0x25b)](_0x3edec9(0xf7),{'type':'state','common':{'name':_0x3edec9(0x27f),'type':_0x3edec9(0x245),'role':_0x3edec9(0x221),'read':!![],'write':![]},'native':{}}),await _0x5d409e[_0x3edec9(0x25b)](_0x3edec9(0x23e),{'type':_0x3edec9(0x171),'common':{'name':_0x3edec9(0xf5),'type':'string','role':_0x3edec9(0x110),'read':!![],'write':![]},'native':{}}),await _0x5d409e[_0x3edec9(0x25b)](_0x3edec9(0x102),{'type':'state','common':{'name':_0x3edec9(0x28e),'type':'number','role':_0x3edec9(0x259),'read':!![],'write':![]},'native':{}}),await _0x5d409e[_0x3edec9(0x11c)](_0x3edec9(0x15d),{'type':_0x3edec9(0x182),'common':{'name':_0x3edec9(0x28f)},'native':{}}),await _0x5d409e[_0x3edec9(0x25b)](_0x3edec9(0x278),{'type':'state','common':{'name':_0x3edec9(0x23f),'type':_0x3edec9(0x14f),'role':_0x3edec9(0x110),'read':!![],'write':![]},'native':{}}),await _0x5d409e[_0x3edec9(0x25b)](_0x3edec9(0x26a),{'type':_0x3edec9(0x171),'common':{'name':'Heating\x20Score','type':_0x3edec9(0x14f),'role':'text','read':!![],'write':![]},'native':{}}),await _0x5d409e[_0x3edec9(0x11c)](_0x3edec9(0x249),{'type':_0x3edec9(0x182),'common':{'name':_0x3edec9(0x249)},'native':{}}),await _0x5d409e[_0x3edec9(0x11c)](LTM_DP_RAW_LOG,{'type':_0x3edec9(0x171),'common':{'name':_0x3edec9(0x183),'type':'string','role':_0x3edec9(0x190),'read':!![],'write':![]},'native':{}}),await _0x5d409e['extendObjectAsync'](LTM_DP_DAILY_DIGESTS,{'type':_0x3edec9(0x171),'common':{'name':_0x3edec9(0x120),'type':_0x3edec9(0x14f),'role':'json','read':!![],'write':![]},'native':{}}),await _0x5d409e[_0x3edec9(0x25b)](_0x3edec9(0x229),{'type':'state','common':{'name':_0x3edec9(0x1c2),'type':'string','role':'json','read':!![],'write':![]},'native':{}}),await _0x5d409e[_0x3edec9(0x25b)]('LTM.trainingData.thermodynamics',{'type':_0x3edec9(0x171),'common':{'name':'Thermodynamics','type':_0x3edec9(0x14f),'role':_0x3edec9(0x190),'read':!![],'write':![]},'native':{}}),await _0x5d409e[_0x3edec9(0x25b)](_0x3edec9(0x112),{'type':_0x3edec9(0x171),'common':{'name':'Trigger\x20Analysis','type':_0x3edec9(0x245),'role':_0x3edec9(0x24c),'read':!![],'write':!![]},'native':{}}),await _0x5d409e[_0x3edec9(0x25b)](_0x3edec9(0x19c),{'type':_0x3edec9(0x171),'common':{'name':_0x3edec9(0x1db),'type':_0x3edec9(0x245),'role':_0x3edec9(0x24c),'read':!![],'write':!![]},'native':{}}),await _0x5d409e[_0x3edec9(0x25b)](_0x3edec9(0x28d),{'type':_0x3edec9(0x171),'common':{'name':_0x3edec9(0x28a),'type':_0x3edec9(0x245),'role':_0x3edec9(0x16f),'read':!![],'write':![]},'native':{}}),await _0x5d409e[_0x3edec9(0x25b)](_0x3edec9(0x13e),{'type':_0x3edec9(0x171),'common':{'name':_0x3edec9(0x176),'type':_0x3edec9(0x14f),'role':'text.alarm','read':!![],'write':![]},'native':{}}),await _0x5d409e['setObjectNotExistsAsync'](_0x3edec9(0x154),{'type':'state','common':{'name':'Activity\x20Summary','type':_0x3edec9(0x14f),'role':_0x3edec9(0x110),'read':!![],'write':![]},'native':{}}),await _0x5d409e['setObjectNotExistsAsync'](_0x3edec9(0x275),{'type':_0x3edec9(0x171),'common':{'name':'Pattern\x20Detected','type':_0x3edec9(0x245),'role':_0x3edec9(0x221),'read':!![],'write':![]},'native':{}}),await _0x5d409e[_0x3edec9(0x25b)]('analysis.automation.description',{'type':'state','common':{'name':_0x3edec9(0x23c),'type':_0x3edec9(0x14f),'role':_0x3edec9(0x110),'read':!![],'write':![]},'native':{}}),await _0x5d409e[_0x3edec9(0x25b)]('analysis.automation.detectedPatterns',{'type':_0x3edec9(0x171),'common':{'name':_0x3edec9(0x129),'type':'string','role':_0x3edec9(0x190),'read':!![],'write':![]},'native':{}}),await _0x5d409e[_0x3edec9(0x25b)]('analysis.automation.targetId',{'type':_0x3edec9(0x171),'common':{'name':_0x3edec9(0x134),'type':'string','role':_0x3edec9(0x110),'read':!![],'write':![]},'native':{}}),await _0x5d409e[_0x3edec9(0x25b)](_0x3edec9(0x28b),{'type':_0x3edec9(0x171),'common':{'name':_0x3edec9(0x191),'type':_0x3edec9(0x14f),'role':'text','read':!![],'write':![]},'native':{}}),await _0x5d409e['setObjectNotExistsAsync']('analysis.automation.autoApply',{'type':_0x3edec9(0x171),'common':{'name':_0x3edec9(0x216),'type':'boolean','role':_0x3edec9(0x230),'read':!![],'write':!![]},'native':{}}),await _0x5d409e['setObjectNotExistsAsync'](_0x3edec9(0xfc),{'type':_0x3edec9(0x171),'common':{'name':_0x3edec9(0x1ea),'type':_0x3edec9(0x245),'role':'button','read':!![],'write':!![]},'native':{}});}async function loadSystemMode(_0x4ac6e2){const _0x40bffe=a0_0x4f3c29;try{const _0x27a888=await _0x4ac6e2[_0x40bffe(0x11b)](SYSTEM_DP_MODE);_0x27a888&&_0x27a888[_0x40bffe(0x187)]&&Object[_0x40bffe(0x105)](SYSTEM_MODES)['includes'](_0x27a888['val'])?_0x4ac6e2[_0x40bffe(0x22e)]=_0x27a888[_0x40bffe(0x187)]:(_0x4ac6e2[_0x40bffe(0x22e)]=SYSTEM_MODES['NORMAL'],await _0x4ac6e2[_0x40bffe(0x11a)](SYSTEM_DP_MODE,{'val':SYSTEM_MODES[_0x40bffe(0x1ef)],'ack':!![]}));}catch(_0x450161){_0x4ac6e2['currentSystemMode']=SYSTEM_MODES[_0x40bffe(0x1ef)];}}async function loadRawEventLog(_0x48d68d){const _0x36476d=a0_0x4f3c29;try{const _0x5170c5=await _0x48d68d[_0x36476d(0x11b)](LTM_DP_RAW_LOG);if(_0x5170c5&&_0x5170c5[_0x36476d(0x187)])_0x48d68d[_0x36476d(0x226)]=JSON[_0x36476d(0x25a)](_0x5170c5[_0x36476d(0x187)]);}catch(_0x134ff4){_0x48d68d[_0x36476d(0x226)]=[];}}async function saveRawEventLog(_0x4aea40){const _0x35f432=a0_0x4f3c29;if(_0x4aea40[_0x35f432(0x226)][_0x35f432(0x16e)]>RAW_LOG_MAX_SIZE)_0x4aea40[_0x35f432(0x226)][_0x35f432(0x13d)](0x0,_0x4aea40[_0x35f432(0x226)][_0x35f432(0x16e)]-RAW_LOG_MAX_SIZE);await _0x4aea40[_0x35f432(0x11a)](LTM_DP_RAW_LOG,{'val':JSON[_0x35f432(0x1f7)](_0x4aea40[_0x35f432(0x226)]),'ack':!![]});}async function loadDailyDigests(_0x2ab566){const _0x1e7bd2=a0_0x4f3c29;try{const _0x1861fe=await _0x2ab566[_0x1e7bd2(0x11b)](LTM_DP_DAILY_DIGESTS);if(_0x1861fe&&_0x1861fe[_0x1e7bd2(0x187)])_0x2ab566[_0x1e7bd2(0x1b4)]=JSON[_0x1e7bd2(0x25a)](_0x1861fe[_0x1e7bd2(0x187)]);}catch(_0x1fc104){_0x2ab566[_0x1e7bd2(0x1b4)]=[];}await updateBaselineStatus(_0x2ab566);}async function saveDailyDigests(_0x4ec56d,_0x49be1c=!![]){const _0x59d182=a0_0x4f3c29,_0x5d4c0f=_0x4ec56d[_0x59d182(0x140)][_0x59d182(0x1bf)]||0x3c;_0x4ec56d[_0x59d182(0x1b4)][_0x59d182(0x16e)]>_0x5d4c0f&&_0x4ec56d[_0x59d182(0x1b4)][_0x59d182(0x13d)](0x0,_0x4ec56d[_0x59d182(0x1b4)]['length']-_0x5d4c0f);await _0x4ec56d[_0x59d182(0x11a)](LTM_DP_DAILY_DIGESTS,{'val':JSON['stringify'](_0x4ec56d[_0x59d182(0x1b4)]),'ack':!![]});if(_0x49be1c)await updateBaselineStatus(_0x4ec56d);}async function updateAnalysisHistory(_0x27ccb3,_0x4b4e04){const _0x3e192b=a0_0x4f3c29;_0x27ccb3[_0x3e192b(0x157)]['unshift'](_0x4b4e04);if(_0x27ccb3[_0x3e192b(0x157)][_0x3e192b(0x16e)]>HISTORY_MAX_SIZE)_0x27ccb3[_0x3e192b(0x157)][_0x3e192b(0x214)]();await _0x27ccb3[_0x3e192b(0x11a)](_0x3e192b(0x1e1),{'val':JSON[_0x3e192b(0x1f7)](_0x27ccb3['analysisHistory']),'ack':!![]});}async function updateBaselineStatus(_0x4b0176){const _0x18c1a7=a0_0x4f3c29;if(!_0x4b0176[_0x18c1a7(0x145)]){await _0x4b0176['setStateAsync'](LTM_DP_BASELINE_STATUS,{'val':_0x18c1a7(0x279),'ack':!![]});return;}const _0x3bb6db=_0x4b0176[_0x18c1a7(0x1b4)][_0x18c1a7(0x16e)]>=(_0x4b0176[_0x18c1a7(0x140)]['minDaysForBaseline']||0x7)?_0x18c1a7(0x237)+_0x4b0176[_0x18c1a7(0x1b4)][_0x18c1a7(0x16e)]+_0x18c1a7(0x289):_0x18c1a7(0x186)+_0x4b0176[_0x18c1a7(0x1b4)][_0x18c1a7(0x16e)]+'/'+(_0x4b0176['config'][_0x18c1a7(0x1d4)]||0x7)+')';await _0x4b0176[_0x18c1a7(0x11a)](LTM_DP_BASELINE_STATUS,{'val':_0x3bb6db,'ack':!![]});}async function initSensorSubscriptions(_0x599045){const _0x35dde3=a0_0x4f3c29,_0x43c5ce=_0x599045[_0x35dde3(0x140)][_0x35dde3(0x107)];if(_0x43c5ce)for(const _0xe74ae4 of _0x43c5ce){await _0x599045[_0x35dde3(0x215)](_0xe74ae4['id']);}}async function initPresenceSubscriptions(_0x378aa7){const _0x5b4bd6=a0_0x4f3c29,_0x4bd0be=_0x378aa7[_0x5b4bd6(0x140)][_0x5b4bd6(0x165)];if(_0x4bd0be)for(const _0x5d4249 of _0x4bd0be){await _0x378aa7[_0x5b4bd6(0x215)](_0x5d4249);}}async function setupTelegramListener(_0x439e6c){const _0x2442ef=a0_0x4f3c29,_0x258487=_0x439e6c['config'][_0x2442ef(0x212)];if(_0x439e6c[_0x2442ef(0x140)][_0x2442ef(0x158)]&&_0x258487)await _0x439e6c[_0x2442ef(0x215)](_0x258487+'.communicate.request');}async function checkWifiPresence(_0x4f70b3){const _0x4e575f=a0_0x4f3c29;try{const _0x5dea3c=_0x4f70b3['config']['presenceDevices']||[];let _0x86a6f6=![];const _0x3b116d=[];for(const _0x432566 of _0x5dea3c){try{const _0x3d07b9=await _0x4f70b3[_0x4e575f(0x1ed)](_0x432566);_0x3d07b9&&(_0x3d07b9[_0x4e575f(0x187)]===!![]||_0x3d07b9['val']===_0x4e575f(0x104)||_0x3d07b9['val']===0x1)&&(_0x86a6f6=!![],_0x3b116d[_0x4e575f(0x1a8)](_0x432566));}catch(_0x18be02){}}return await _0x4f70b3[_0x4e575f(0x11a)](_0x4e575f(0xf4),{'val':_0x3b116d[_0x4e575f(0x25c)](',\x20'),'ack':!![]}),_0x86a6f6&&(_0x4f70b3[_0x4e575f(0x18b)]&&(_0x4f70b3['log']['info']('WiFi\x20Presence\x20detected.'),abortExitTimer(_0x4f70b3)),!_0x4f70b3[_0x4e575f(0x1b3)]&&_0x4f70b3[_0x4e575f(0x22e)]===SYSTEM_MODES[_0x4e575f(0x1ef)]&&await setPresence(_0x4f70b3,!![])),_0x86a6f6;}catch(_0x239a5a){return![];}}function startExitTimer(_0x5275a4){const _0x461499=a0_0x4f3c29;abortExitTimer(_0x5275a4),_0x5275a4[_0x461499(0xfb)]=!![],_0x5275a4[_0x461499(0x1e7)]=setTimeout(()=>{const _0x5a1e33=_0x461499;_0x5275a4[_0x5a1e33(0xfb)]=![];},EXIT_GRACE_PERIOD_SECONDS*0x3e8),_0x5275a4[_0x461499(0x18b)]=setTimeout(()=>{const _0x5ed77b=_0x461499;setPresence(_0x5275a4,![]),_0x5275a4[_0x5ed77b(0x18b)]=null;},EXIT_TIMER_MINUTES*0x3c*0x3e8);}function abortExitTimer(_0xd55b43){const _0x12f442=a0_0x4f3c29;if(_0xd55b43[_0x12f442(0x18b)])clearTimeout(_0xd55b43[_0x12f442(0x18b)]);if(_0xd55b43[_0x12f442(0x1e7)])clearTimeout(_0xd55b43[_0x12f442(0x1e7)]);_0xd55b43[_0x12f442(0x18b)]=null,_0xd55b43[_0x12f442(0x1e7)]=null,_0xd55b43['isGracePeriodActive']=![];}async function setPresence(_0x4abc05,_0x2cce13){const _0x140a64=a0_0x4f3c29;if(_0x4abc05[_0x140a64(0x1b3)]===_0x2cce13)return;_0x4abc05[_0x140a64(0x1b3)]=_0x2cce13,await _0x4abc05['setStateAsync'](_0x140a64(0x16c),{'val':_0x2cce13,'ack':!![]});}async function executeAutomationAction(_0x3eec8d){const _0x1118d4=a0_0x4f3c29;try{const _0x2f5b09=await _0x3eec8d['getStateAsync'](_0x1118d4(0x21a)),_0x286e7a=await _0x3eec8d[_0x1118d4(0x11b)]('analysis.automation.targetValue');if(_0x2f5b09&&_0x2f5b09[_0x1118d4(0x187)]&&_0x286e7a){const _0x247cea=_0x2f5b09[_0x1118d4(0x187)];let _0x27b2b4=_0x286e7a[_0x1118d4(0x187)];try{_0x27b2b4=JSON[_0x1118d4(0x25a)](_0x27b2b4);}catch(_0x3330a8){}_0x3eec8d[_0x1118d4(0x282)]['info']('ü§ñ\x20BUTLER:\x20Executing\x20Action\x20->\x20'+_0x247cea+_0x1118d4(0x10a)+_0x27b2b4),await _0x3eec8d[_0x1118d4(0x23d)](_0x247cea,_0x27b2b4);}else _0x3eec8d[_0x1118d4(0x282)][_0x1118d4(0x1a4)]('ü§ñ\x20BUTLER:\x20No\x20valid\x20target\x20ID\x20or\x20value\x20stored\x20for\x20execution.');}catch(_0x134b22){_0x3eec8d[_0x1118d4(0x282)][_0x1118d4(0x1b5)](_0x1118d4(0x152)+_0x134b22[_0x1118d4(0x128)]);}}async function processSensorEvent(_0x1acba2,_0x4333f4,_0x3feac1,_0x352e21){const _0x34c70d=a0_0x4f3c29;if(!_0x352e21)return;const _0x48698a=_0x3feac1[_0x34c70d(0x187)],_0x328ed2=Date[_0x34c70d(0x19f)](),_0x1c6750=_0x1acba2[_0x34c70d(0x170)][_0x4333f4];_0x1acba2['sensorLastValues'][_0x4333f4]=_0x48698a;if(!_0x352e21[_0x34c70d(0x141)]&&_0x1c6750!=undefined&&_0x1c6750==_0x48698a)return;const _0x1939b5=(_0x352e21[_0x34c70d(0x1d1)]||'')[_0x34c70d(0x124)](),_0x48ea4a=_0x1939b5[_0x34c70d(0x273)](_0x34c70d(0x262))||_0x1939b5[_0x34c70d(0x273)]('temperatur')||_0x1939b5['includes'](_0x34c70d(0x180))||_0x1939b5['includes']('heizung');_0x1acba2[_0x34c70d(0x145)]&&_0x48ea4a&&recordThermodynamics(_0x1acba2,_0x4333f4,_0x48698a,_0x352e21[_0x34c70d(0x1d2)]);const _0x4575d4={'timestamp':_0x328ed2,'id':_0x4333f4,'name':_0x352e21['name'],'type':_0x352e21[_0x34c70d(0x1d1)],'location':_0x352e21[_0x34c70d(0x1d2)],'value':_0x48698a};_0x1acba2['eventHistory'][_0x34c70d(0x260)](_0x4575d4);if(_0x1acba2[_0x34c70d(0x149)]['length']>HISTORY_MAX_SIZE)_0x1acba2[_0x34c70d(0x149)][_0x34c70d(0x214)]();await _0x1acba2[_0x34c70d(0x11a)](_0x34c70d(0x218),{'val':JSON['stringify'](_0x4575d4),'ack':!![]}),await _0x1acba2[_0x34c70d(0x11a)]('events.history',{'val':JSON['stringify'](_0x1acba2[_0x34c70d(0x149)]),'ack':!![]});_0x1acba2[_0x34c70d(0x145)]&&(_0x1acba2[_0x34c70d(0x226)][_0x34c70d(0x1a8)](_0x4575d4),await saveRawEventLog(_0x1acba2),recordSequence(_0x1acba2,_0x4575d4));if(_0x352e21['isExit']&&_0x48698a===!![]){if(_0x1acba2[_0x34c70d(0x1b3)]&&!_0x1acba2['isGracePeriodActive'])startExitTimer(_0x1acba2);else{if(!_0x1acba2[_0x34c70d(0x1b3)])setPresence(_0x1acba2,!![]);}}else{if(_0x352e21['type']==='motion'&&_0x48698a===!![]){if(_0x1acba2[_0x34c70d(0x18b)])abortExitTimer(_0x1acba2);if(!_0x1acba2[_0x34c70d(0x1b3)]&&_0x1acba2[_0x34c70d(0x22e)]===SYSTEM_MODES['NORMAL'])setPresence(_0x1acba2,!![]);}}}async function recordThermodynamics(_0x1bf808,_0x45a78f,_0x4ca0dd,_0x4a1c09){const _0x3c1451=a0_0x4f3c29,_0x3a8429=await getOutsideTemperatureNumeric(_0x1bf808),_0x4c5d28=await _0x1bf808[_0x3c1451(0x11b)](_0x3c1451(0x17d));let _0xcf40d0=[];if(_0x4c5d28&&_0x4c5d28[_0x3c1451(0x187)])try{_0xcf40d0=JSON[_0x3c1451(0x25a)](_0x4c5d28['val']);}catch(_0x5c66a8){}_0xcf40d0['push']({'ts':Date[_0x3c1451(0x19f)](),'room':_0x4a1c09||'Unknown','t_in':_0x4ca0dd,'t_out':_0x3a8429});if(_0xcf40d0['length']>THERMO_LOG_SIZE)_0xcf40d0['shift']();await _0x1bf808[_0x3c1451(0x11a)](_0x3c1451(0x17d),{'val':JSON[_0x3c1451(0x1f7)](_0xcf40d0),'ack':!![]});}async function getOutsideTemperatureNumeric(_0x5caba1){const _0xb708d6=a0_0x4f3c29;if(_0x5caba1[_0xb708d6(0x140)][_0xb708d6(0x254)])try{const _0x36c68b=await _0x5caba1[_0xb708d6(0x1ed)](_0x5caba1[_0xb708d6(0x140)][_0xb708d6(0x254)]);if(_0x36c68b&&_0x36c68b[_0xb708d6(0x187)]!==undefined&&_0x36c68b['val']!==null)return parseFloat(_0x36c68b['val']);}catch(_0x5228c0){}const _0x59a515=_0x5caba1['config'][_0xb708d6(0xfa)];if(!_0x5caba1[_0xb708d6(0x140)][_0xb708d6(0x21b)]||!_0x59a515)return null;try{let _0xbe97='';if(_0x59a515[_0xb708d6(0x273)](_0xb708d6(0x217)))_0xbe97=_0x59a515+_0xb708d6(0x264);else{if(_0x59a515[_0xb708d6(0x273)](_0xb708d6(0x1f2)))_0xbe97=_0x59a515+_0xb708d6(0xf2);else{if(_0x59a515[_0xb708d6(0x273)](_0xb708d6(0x1fb)))_0xbe97=_0x59a515+_0xb708d6(0x13a);else{if(_0x59a515[_0xb708d6(0x273)](_0xb708d6(0x234)))_0xbe97=_0x59a515+_0xb708d6(0x231);}}}if(_0xbe97){const _0x89869c=await _0x5caba1[_0xb708d6(0x1ed)](_0xbe97);if(_0x89869c&&_0x89869c[_0xb708d6(0x187)]!==undefined&&_0x89869c[_0xb708d6(0x187)]!==null)return parseFloat(_0x89869c['val']);}}catch(_0x3d239d){}return null;}async function recordSequence(_0x46ecc4,_0x31dadc){const _0x5ec40d=a0_0x4f3c29,_0x200d22=(_0x31dadc['type']||'')[_0x5ec40d(0x124)](),_0x28b00f=[_0x5ec40d(0x117),_0x5ec40d(0x1a0),_0x5ec40d(0x1ec),'presence',_0x5ec40d(0x244),'door',_0x5ec40d(0x266),_0x5ec40d(0x1ce),_0x5ec40d(0x164),_0x5ec40d(0x272),_0x5ec40d(0x11f),_0x5ec40d(0x269),_0x5ec40d(0x1ab),_0x5ec40d(0x230),_0x5ec40d(0x247),_0x5ec40d(0x1a1),'lampe'];if(!_0x28b00f[_0x5ec40d(0x208)](_0x3e0535=>_0x200d22[_0x5ec40d(0x273)](_0x3e0535)))return;if(!_0x31dadc[_0x5ec40d(0x259)])return;if(sequenceTimer)clearTimeout(sequenceTimer);activeSequence[_0x5ec40d(0x1a8)]({'loc':_0x31dadc[_0x5ec40d(0x1d2)]||_0x5ec40d(0x242),'id':_0x31dadc['id'],'ts':Date[_0x5ec40d(0x19f)]()}),sequenceTimer=setTimeout(async()=>{const _0x102f2b=_0x5ec40d;if(activeSequence[_0x102f2b(0x16e)]>0x1)await saveCompletedSequence(_0x46ecc4);activeSequence=[];},SEQUENCE_TIMEOUT_MS);}async function saveCompletedSequence(_0x449ddc){const _0x5e2f9a=a0_0x4f3c29;try{const _0x1d829e=await _0x449ddc[_0x5e2f9a(0x11b)]('LTM.trainingData.sequences');let _0x204080=[];if(_0x1d829e&&_0x1d829e[_0x5e2f9a(0x187)])try{_0x204080=JSON[_0x5e2f9a(0x25a)](_0x1d829e['val']);}catch(_0x5ac8e5){}const _0x4dcded=activeSequence[0x0]['ts'],_0x53d040=activeSequence[_0x5e2f9a(0x20b)](_0x512552=>({'loc':_0x512552[_0x5e2f9a(0x281)],'t_delta':Math[_0x5e2f9a(0x210)]((_0x512552['ts']-_0x4dcded)/0x3e8)})),_0x275480={'timestamp':new Date(_0x4dcded)[_0x5e2f9a(0x133)](),'steps':_0x53d040,'duration':Math[_0x5e2f9a(0x210)]((activeSequence[activeSequence['length']-0x1]['ts']-_0x4dcded)/0x3e8),'daytime':new Date(_0x4dcded)['getHours']()};_0x204080[_0x5e2f9a(0x1a8)](_0x275480);if(_0x204080[_0x5e2f9a(0x16e)]>MAX_TRAINING_SET_SIZE)_0x204080['shift']();await _0x449ddc['setStateAsync']('LTM.trainingData.sequences',{'val':JSON['stringify'](_0x204080),'ack':!![]}),runSecurityCheck(_0x449ddc,_0x275480);}catch(_0x2461e6){_0x449ddc[_0x5e2f9a(0x282)][_0x5e2f9a(0x1b5)]('[RECORDER]\x20Error:\x20'+_0x2461e6[_0x5e2f9a(0x128)]);}}function runSecurityCheck(_0x4322d8,_0xb205dd){const _0x3c2352=a0_0x4f3c29;if(!_0x4322d8['isProVersion'])return;sendToPython(_0x4322d8,_0x3c2352(0x168),{'sequence':_0xb205dd});}function sendToPython(_0x249301,_0x2d5289,_0x5d0c0e={}){const _0x39205c=a0_0x4f3c29;if(!_0x249301[_0x39205c(0x14d)]||!_0x249301[_0x39205c(0x14d)][_0x39205c(0x223)][_0x39205c(0x1a5)])return;const _0x422ec2=JSON[_0x39205c(0x1f7)]({'command':_0x2d5289,..._0x5d0c0e});try{_0x249301[_0x39205c(0x14d)]['stdin'][_0x39205c(0x1fe)](_0x422ec2+'\x0a');}catch(_0xab7aa9){}}function startPythonService(_0x5346e5){const _0x3f25a2=a0_0x4f3c29;let _0x1d2b86=_0x3f25a2(0x235);if(fs['existsSync'](PYTHON_EXE))_0x1d2b86=PYTHON_EXE;try{const _0x41be3e=path['join'](__dirname,'python_service',_0x3f25a2(0x113));_0x5346e5['pythonProcess']=spawn(_0x1d2b86,[_0x41be3e]),_0x5346e5[_0x3f25a2(0x14d)][_0x3f25a2(0x132)]['on'](_0x3f25a2(0x267),_0x37f7f0=>{const _0xadeb5d=_0x3f25a2,_0x5677fc=_0x37f7f0[_0xadeb5d(0x248)]()[_0xadeb5d(0x241)]('\x0a');_0x5677fc['forEach'](_0x34e73c=>{const _0x2e67ca=_0xadeb5d,_0x443b5b=_0x34e73c[_0x2e67ca(0x225)]();if(!_0x443b5b)return;if(_0x443b5b[_0x2e67ca(0x131)]('[LOG]'))_0x5346e5[_0x2e67ca(0x282)]['debug'](_0x2e67ca(0x12c)+_0x443b5b[_0x2e67ca(0x26c)](0x5)[_0x2e67ca(0x225)]());else{if(_0x443b5b[_0x2e67ca(0x131)]('[RESULT]'))try{const _0x4d1c35=JSON[_0x2e67ca(0x25a)](_0x443b5b[_0x2e67ca(0x26c)](0x8)[_0x2e67ca(0x225)]());handlePythonResult(_0x5346e5,_0x4d1c35);}catch(_0xcc74fd){}}});}),_0x5346e5['pythonProcess']['on'](_0x3f25a2(0x1cb),_0x357c4b=>{const _0x29ade2=_0x3f25a2;_0x5346e5[_0x29ade2(0x14d)]=null;});}catch(_0xc2e6eb){_0x5346e5['log'][_0x3f25a2(0x1b5)](_0x3f25a2(0x1a3)+_0xc2e6eb[_0x3f25a2(0x128)]);}}function stopPythonService(_0x65d30a){const _0x3a924c=a0_0x4f3c29;if(_0x65d30a['pythonProcess']){try{_0x65d30a['pythonProcess'][_0x3a924c(0x194)]();}catch(_0x3ac247){}_0x65d30a[_0x3a924c(0x14d)]=null;}}function handlePythonResult(_0x2e21ae,_0xd65257){const _0x1f42ac=a0_0x4f3c29;if(_0xd65257[_0x1f42ac(0x1d1)]==='PONG')_0x2e21ae['log'][_0x1f42ac(0x1c8)](_0x1f42ac(0xfe));else{if(_0xd65257[_0x1f42ac(0x1d1)]===_0x1f42ac(0x283)){const {anomaly_score:_0x653665,is_anomaly:_0x1d63e3,threshold:_0xe358fc,explanation:_0x11e365}=_0xd65257['payload'];_0x2e21ae['log'][_0x1f42ac(0x26b)](_0x1f42ac(0x20f)+_0x653665[_0x1f42ac(0x18a)](0x5)+'\x20->\x20'+(_0x1d63e3?_0x1f42ac(0x297):'OK')),_0x2e21ae['setStateAsync'](_0x1f42ac(0x1b9),{'val':_0x653665,'ack':!![]}),_0x2e21ae[_0x1f42ac(0x11a)](_0x1f42ac(0x19a),{'val':new Date()[_0x1f42ac(0x133)](),'ack':!![]});if(_0xe358fc)_0x2e21ae[_0x1f42ac(0x11a)]('analysis.security.currentThreshold',{'val':_0xe358fc,'ack':!![]});if(_0x1d63e3){let _0x22be59=_0x1f42ac(0xf9)+_0x653665['toFixed'](0x4)+')';if(_0x11e365&&_0x11e365!==_0x1f42ac(0x242))_0x22be59+='\x0aGrund:\x20'+_0x11e365;_0x2e21ae[_0x1f42ac(0x11a)](_0x1f42ac(0x28d),{'val':!![],'ack':!![]}),_0x2e21ae[_0x1f42ac(0x11a)](_0x1f42ac(0x13e),{'val':_0x22be59,'ack':!![]}),sendNotification(_0x2e21ae,_0x1f42ac(0x1e9)+_0x22be59,![],!![]);}}else{if(_0xd65257[_0x1f42ac(0x1d1)]==='TRAINING_COMPLETE'){const _0x4edb4e=_0xd65257[_0x1f42ac(0x1fa)][_0x1f42ac(0x298)]||'',_0x29152f=_0xd65257[_0x1f42ac(0x1fa)][_0x1f42ac(0x22f)],_0x9e0dd9=_0xd65257[_0x1f42ac(0x1fa)]['success']?_0x1f42ac(0x179)+new Date()[_0x1f42ac(0x1e5)]()+'\x20('+_0x4edb4e+')':'Failed:\x20'+_0xd65257['payload'][_0x1f42ac(0x12d)];_0x2e21ae['setStateAsync'](_0x1f42ac(0x233),{'val':_0x9e0dd9,'ack':!![]});if(_0xd65257['payload'][_0x1f42ac(0x21f)]&&_0x29152f)_0x2e21ae[_0x1f42ac(0x11a)](_0x1f42ac(0x1cc),{'val':_0x29152f,'ack':!![]});}else{if(_0xd65257[_0x1f42ac(0x1d1)]==='COMFORT_RESULT'){const {patterns:_0x26caac}=_0xd65257[_0x1f42ac(0x1fa)];if(_0x26caac&&_0x26caac[_0x1f42ac(0x16e)]>0x0){_0x2e21ae[_0x1f42ac(0x282)]['info'](_0x1f42ac(0x296)+_0x26caac[_0x1f42ac(0x16e)]+_0x1f42ac(0x1cf)),_0x2e21ae[_0x1f42ac(0x11a)]('analysis.automation.detectedPatterns',{'val':JSON[_0x1f42ac(0x1f7)](_0x26caac),'ack':!![]});const _0x592dde=_0x26caac[0x0],_0x39f805=_0x1f42ac(0x24d)+_0x592dde[_0x1f42ac(0x130)]+'\x20('+(_0x592dde[_0x1f42ac(0x198)]*0x64)[_0x1f42ac(0x18a)](0x0)+'%)';_0x2e21ae[_0x1f42ac(0x11a)](_0x1f42ac(0x275),{'val':!![],'ack':!![]}),_0x2e21ae['setStateAsync']('analysis.automation.description',{'val':_0x39f805,'ack':!![]});}else _0x2e21ae[_0x1f42ac(0x282)][_0x1f42ac(0x26b)]('üõãÔ∏è\x20BUTLER:\x20Keine\x20neuen\x20Muster\x20gefunden.'),_0x2e21ae[_0x1f42ac(0x11a)](_0x1f42ac(0x275),{'val':![],'ack':!![]}),_0x2e21ae[_0x1f42ac(0x11a)]('analysis.automation.detectedPatterns',{'val':'[]','ack':!![]});}else{if(_0xd65257[_0x1f42ac(0x1d1)]===_0x1f42ac(0x121)){if(_0xd65257[_0x1f42ac(0x1fa)][_0x1f42ac(0x21f)])try{const _0x35127e=JSON[_0x1f42ac(0x25a)](_0xd65257[_0x1f42ac(0x1fa)]['details']);if(_0x35127e[_0x1f42ac(0x10f)])_0x2e21ae[_0x1f42ac(0x11a)](_0x1f42ac(0x278),{'val':JSON[_0x1f42ac(0x1f7)](_0x35127e[_0x1f42ac(0x10f)]),'ack':!![]});if(_0x35127e[_0x1f42ac(0x1ff)])_0x2e21ae[_0x1f42ac(0x11a)](_0x1f42ac(0x26a),{'val':JSON['stringify'](_0x35127e['heating']),'ack':!![]});}catch(_0x12b7f9){}}else{if(_0xd65257['type']===_0x1f42ac(0x19d)){if(_0xd65257['payload'][_0x1f42ac(0x21f)])_0x2e21ae[_0x1f42ac(0x282)][_0x1f42ac(0x26b)](_0x1f42ac(0x125));}else{if(_0xd65257[_0x1f42ac(0x1d1)]==='HEALTH_RESULT')_0x2e21ae[_0x1f42ac(0x11a)](_0x1f42ac(0x197),{'val':new Date()['toISOString'](),'ack':!![]}),_0x2e21ae['setStateAsync']('analysis.health.isAnomaly',{'val':_0xd65257[_0x1f42ac(0x1fa)][_0x1f42ac(0x1b6)],'ack':!![]});else _0xd65257[_0x1f42ac(0x1d1)]==='TREND_RESULT'&&(_0x2e21ae[_0x1f42ac(0x11a)]('analysis.health.trendDiagnosis',{'val':_0xd65257[_0x1f42ac(0x1fa)][_0x1f42ac(0x277)],'ack':!![]}),_0x2e21ae[_0x1f42ac(0x11a)](_0x1f42ac(0x102),{'val':_0xd65257['payload'][_0x1f42ac(0x201)],'ack':!![]}));}}}}}}}function runPythonHealthCheck(_0x308fe9){const _0x59bf55=a0_0x4f3c29;if(!_0x308fe9[_0x59bf55(0x1b4)]||_0x308fe9[_0x59bf55(0x1b4)][_0x59bf55(0x16e)]<0x2)return;const _0x5c2b2e=_0x308fe9[_0x59bf55(0x1b4)][_0x59bf55(0x20b)](_0xb57f87=>{const _0x1cb951=_0x59bf55,_0x4a5a02=(_0xb57f87[_0x1cb951(0x21d)]||'')[_0x1cb951(0x124)]();return ACTIVITY_LEVEL_MAP[_0x4a5a02]||0x32;});sendToPython(_0x308fe9,_0x59bf55(0x127),{'values':_0x5c2b2e,'tag':_0x59bf55(0x27b)});}async function handleTelegramResponse(_0x30e3fb,_0x2f5eb2){const _0xa4523b=a0_0x4f3c29;let _0x3e8072=_0x2f5eb2;_0x2f5eb2[_0xa4523b(0x131)]('[')&&(_0x3e8072=_0x2f5eb2[_0xa4523b(0x26c)](_0x2f5eb2['indexOf'](']')+0x1));if(_0x3e8072==='COGNI_CONFIRM_OK')await _0x30e3fb[_0xa4523b(0x11a)](_0xa4523b(0x28d),{'val':![],'ack':!![]}),await _0x30e3fb[_0xa4523b(0x11a)](_0xa4523b(0x13e),{'val':_0xa4523b(0x1b7),'ack':!![]}),_0x30e3fb[_0xa4523b(0x17c)]=![],sendNotification(_0x30e3fb,_0xa4523b(0x17e),![]);else _0x3e8072===_0xa4523b(0x143)&&sendNotification(_0x30e3fb,_0xa4523b(0x25f),![],!![]);}async function sendNotification(_0xf6b88d,_0x4b0e38,_0x40b136=![],_0x5a7668=![]){const _0x4f785d=a0_0x4f3c29,_0x11e5a0=_0xf6b88d[_0x4f785d(0x140)];if(_0x11e5a0['notifyTelegramEnabled']){let _0x5a1e86={};(_0x4b0e38['includes'](_0x4f785d(0x1b2))||_0x5a7668)&&(_0x5a1e86={'reply_markup':{'inline_keyboard':[[{'text':_0x4f785d(0x115),'callback_data':'COGNI_CONFIRM_OK'}],[{'text':'üìû\x20R√ºckruf\x20anfordern','callback_data':_0x4f785d(0x143)}]]}}),await _0xf6b88d[_0x4f785d(0x20e)](_0x11e5a0[_0x4f785d(0x212)],_0x4f785d(0x1a7),{'text':_0x4b0e38,'user':_0x11e5a0[_0x4f785d(0x15c)],..._0x5a1e86});}if(_0x11e5a0[_0x4f785d(0x12a)]){let _0x28143a={'message':_0x4b0e38,'title':_0x5a7668?_0x4f785d(0x15a):_0x4f785d(0x1a6),'priority':_0x5a7668?0x2:0x1,'device':_0x11e5a0[_0x4f785d(0x265)]};_0x5a7668&&(_0x28143a[_0x4f785d(0x13b)]=0x1e,_0x28143a[_0x4f785d(0x1dc)]=0xe10,_0x28143a[_0x4f785d(0x27c)]=_0x4f785d(0x167)),await _0xf6b88d[_0x4f785d(0x20e)](_0x11e5a0['notifyPushoverInstance'],'send',_0x28143a);}_0x11e5a0[_0x4f785d(0x207)]&&await _0xf6b88d['sendToAsync'](_0x11e5a0[_0x4f785d(0x14c)],_0x4f785d(0x1a7),{'text':_0x4b0e38,'to':_0x11e5a0['notifyEmailRecipient']});}async function runGeminiAnalysis(_0xbed449,_0x37625f=''){const _0x18db04=a0_0x4f3c29;if(!_0xbed449[_0x18db04(0x1b1)])return;if(_0xbed449[_0x18db04(0x149)][_0x18db04(0x16e)]===0x0)return;const _0x2cd65a=_0xbed449['eventHistory'][_0x18db04(0x238)](0x0,0xf),_0x3e60c2=await getWeatherContext(_0xbed449),_0x13c573=_0xbed449[_0x18db04(0x22e)],_0xac9a61=PERSONA_MAPPING[_0xbed449[_0x18db04(0x140)][_0x18db04(0x1bc)]||'generic'],_0x3040c3=_0xbed449['config'][_0x18db04(0x15f)]||'Keine\x20Details.';let _0x308b05=_0x18db04(0x1ca);try{const _0x5c6ab2=await _0xbed449[_0x18db04(0x11b)]('system.presenceWho');if(_0x5c6ab2&&_0x5c6ab2['val'])_0x308b05=_0x5c6ab2['val'];}catch(_0x289f3c){}let _0xb5f80d=![];try{const _0x3fa873=await _0xbed449[_0x18db04(0x11b)]('analysis.automation.autoApply');if(_0x3fa873&&_0x3fa873[_0x18db04(0x187)])_0xb5f80d=!![];}catch(_0x3600b8){}const _0x256019='ROLLE:\x20KI-Hausverwalter.\x20PERSONA:\x20'+_0xac9a61+'.\x20KONTEXT:\x20'+_0x3040c3+_0x18db04(0x222)+_0x13c573+_0x18db04(0xf8)+_0x3e60c2+_0x18db04(0x291)+_0x308b05+_0x18db04(0x172)+JSON['stringify'](_0x2cd65a)+_0x18db04(0x193)+_0x37625f+_0x18db04(0x1c0);try{const _0x59c207=await _0xbed449['geminiModel'][_0x18db04(0x24a)](_0x256019),_0x28e53c=JSON['parse'](_0x59c207[_0x18db04(0x1c5)]['text']()[_0x18db04(0x166)](/```json|```/g,'')[_0x18db04(0x225)]());await _0xbed449[_0x18db04(0x11a)]('analysis.lastResult',{'val':JSON[_0x18db04(0x1f7)](_0x28e53c),'ack':!![]});if(_0x28e53c['summary'])await _0xbed449['setStateAsync'](_0x18db04(0x154),{'val':_0x28e53c[_0x18db04(0x17f)],'ack':!![]});const _0x5112e7={'timestamp':Date[_0x18db04(0x19f)](),'id':Date[_0x18db04(0x19f)]()['toString'](),'analysis':{'activity':{'summary':_0x28e53c[_0x18db04(0x17f)],'isAlert':_0x28e53c['isAlert'],'alertReason':_0x28e53c[_0x18db04(0x209)]},'comfort':{'automationProposal':_0x28e53c[_0x18db04(0x1ad)]}}};await updateAnalysisHistory(_0xbed449,_0x5112e7);const _0x3b4211=_0x28e53c[_0x18db04(0x1d6)]||![];_0x3b4211!==_0xbed449['lastAlertState']&&(await _0xbed449[_0x18db04(0x11a)]('analysis.isAlert',{'val':_0x3b4211,'ack':!![]}),_0xbed449[_0x18db04(0x17c)]=_0x3b4211,_0x3b4211&&(await _0xbed449[_0x18db04(0x11a)]('analysis.alertReason',{'val':_0x28e53c[_0x18db04(0x209)],'ack':!![]}),sendNotification(_0xbed449,'‚ö†Ô∏è\x20ALARM:\x20'+_0x28e53c['alertReason'],![],_0x28e53c[_0x18db04(0x1c9)])));if(_0x28e53c['automationProposal']&&_0x28e53c[_0x18db04(0x1ad)]['detected']){await _0xbed449[_0x18db04(0x11a)](_0x18db04(0x275),{'val':!![],'ack':!![]}),await _0xbed449[_0x18db04(0x11a)]('analysis.automation.description',{'val':_0x28e53c['automationProposal']['description'],'ack':!![]}),await _0xbed449[_0x18db04(0x11a)](_0x18db04(0x21a),{'val':_0x28e53c[_0x18db04(0x1ad)]['targetId'],'ack':!![]}),await _0xbed449[_0x18db04(0x11a)]('analysis.automation.targetValue',{'val':JSON[_0x18db04(0x1f7)](_0x28e53c[_0x18db04(0x1ad)][_0x18db04(0x24b)]),'ack':!![]});if(_0xb5f80d)executeAutomationAction(_0xbed449);}}catch(_0x2dc27c){_0xbed449[_0x18db04(0x282)][_0x18db04(0x1b5)]('Gemini\x20Error:\x20'+_0x2dc27c[_0x18db04(0x128)]);}}async function createDailyDigest(_0x3d212f){const _0x3e046a=a0_0x4f3c29;if(!_0x3d212f['isProVersion'])return;await _0x3d212f[_0x3e046a(0x11a)](LTM_DP_STATUS,{'val':_0x3e046a(0x23b),'ack':!![]});if(!_0x3d212f[_0x3e046a(0x1b1)]||_0x3d212f['rawEventLog']['length']<LTM_MIN_EVENTS_FOR_COMPRESSION){await _0x3d212f[_0x3e046a(0x11a)](LTM_DP_STATUS,{'val':'Skipped\x20(No\x20AI\x20or\x20Data)','ack':!![]});return;}const _0x268591=JSON[_0x3e046a(0x25a)](JSON['stringify'](_0x3d212f['rawEventLog'])),_0x336bf3=_0x268591[_0x3e046a(0x16e)],_0xbac143=_0x3e046a(0x19e)+JSON[_0x3e046a(0x1f7)](_0x268591);try{const _0x424207=await _0x3d212f[_0x3e046a(0x1b1)][_0x3e046a(0x24a)](_0xbac143),_0xe822a7=JSON[_0x3e046a(0x25a)](_0x424207['response'][_0x3e046a(0x110)]()[_0x3e046a(0x166)](/```json|```/g,'')['trim']()),_0x60f354={'timestamp':new Date()[_0x3e046a(0x133)](),'eventCount':_0x336bf3,'summary':_0xe822a7[_0x3e046a(0x17f)]||'Digest','activityLevel':_0xe822a7[_0x3e046a(0x21d)]||_0x3e046a(0x27a),'systemMode':_0x3d212f[_0x3e046a(0x22e)]};_0x3d212f[_0x3e046a(0x1b4)]['push'](_0x60f354),await saveDailyDigests(_0x3d212f),_0x3d212f[_0x3e046a(0x226)]=[],await saveRawEventLog(_0x3d212f),await _0x3d212f[_0x3e046a(0x11a)](LTM_DP_STATUS,{'val':_0x3e046a(0x177),'ack':!![]});if(_0x3d212f[_0x3e046a(0x145)])sendToPython(_0x3d212f,'ANALYZE_HEALTH',{'digest':_0x60f354});}catch(_0x547c99){_0x3d212f['log'][_0x3e046a(0x1b5)](_0x547c99[_0x3e046a(0x128)]);}}function setupLtmScheduler(_0xd14872){const _0x2cbd24=a0_0x4f3c29;try{if(_0xd14872[_0x2cbd24(0x255)])_0xd14872[_0x2cbd24(0x255)][_0x2cbd24(0x12b)]();if(!_0xd14872['isProVersion'])return;_0xd14872['ltmJob']=schedule[_0x2cbd24(0x1ee)](LTM_SCHEDULE,()=>createDailyDigest(_0xd14872));}catch(_0x16b8c5){_0xd14872[_0x2cbd24(0x282)][_0x2cbd24(0x1b5)](_0x2cbd24(0x122)+_0x16b8c5[_0x2cbd24(0x128)]);}}function a0_0x3e88(){const _0xededfd=['Who\x20is\x20present?','Trigger\x20Briefing','expire','common','OK:\x20','Kalender\x20deaktiviert.','ready','analysis.analysisHistory','baselineDrift','(((.+)+)+)+$','systemConfig','toLocaleTimeString','requirements.txt','exitGraceTimer','analysisInterval','‚ö†Ô∏è\x20SECURITY\x20ALARM:\x20','Trigger\x20Action','LTM.driftAnalysis','pr√§senz','getForeignStateAsync','scheduleJob','NORMAL','0\x204\x20*\x20*\x20*','PRIORIT√ÑT:\x20Gesundheit/AAL.','daswetter','Fokus\x20auf\x20Familienroutinen.','targetId','licenseKey','getForeignObjectsAsync','stringify','Adapter','N/A\x20(Learning)','payload','openweathermap','analysisTimer','Training\x20Error:\x20','write','heating','onMessage','change_percent','genAI','11525032VavfEQ','Health\x20Analysis','existsSync','Analysiere\x20ausgewogen.','notifyEmailEnabled','some','alertReason','N/A','map','Last\x20Check','¬∞C,\x20','sendToAsync','üõ°Ô∏è\x20SECURITY\x20CHECK:\x20Score\x20','round','fill','notifyTelegramInstance','Fokus\x20auf\x20Komfort.','pop','subscribeForeignStatesAsync','Auto\x20Apply','accuweather','events.lastEvent','models/gemini-flash-latest','analysis.automation.targetId','useWeather','events.history','activityLevel','onStateChange','success','53847528Hxluph','indicator','.\x20SYSTEM_MODE:\x20','stdin','Gemini\x20Init\x20Error:\x20','trim','rawEventLog','Event\x20History','temperatur','LTM.trainingData.sequences','automation.triggerAction','city','‚úÖ\x20INSTALL\x20SUCCESS.','7710560ySBpPV','currentSystemMode','threshold','switch','.forecast.current.temp','216430tPciDZ','analysis.training.status','weatherunderground','python3','node-schedule','Aktiv\x20(','slice','TRAIN_SECURITY','System\x20Mode','Started...','Description','setForeignStateAsync','analysis.health.trendDiagnosis','Insulation\x20Score','stateChange','split','Unknown','Train\x20Health','occupancy','boolean','ltmDriftCheckIntervalHours','schalter','toString','LTM','generateContent','targetValue','button','Regel\x20erkannt:\x20','Installing\x20pip\x20packages...','analysis.health','search','main','driftAnalysisTimer','Briefing\x20Sched\x20Error:\x20','outdoorSensorId','ltmJob','analysis.security','namespace','longitude','value','parse','setObjectNotExistsAsync','join','enum.functions.*','timestamp','üìû\x20R√úCKRUF\x20BITTE!\x20Der\x20Bewohner\x20hat\x20den\x20R√ºckruf-Button\x20gedr√ºckt.','unshift','LTM.driftAnalysis.driftDetails','temperature','analysis.training.triggerSecurity','.Current.Temperature','notifyPushoverRecipient','t√ºr','data','communicate.request','light','analysis.energy.heatingScore','info','substring','TRAIN_ENERGY','system.mode','GUEST','getTime','status','contact','includes','scanDevices','analysis.automation.patternDetected','.forecast.current.state','diagnosis','analysis.energy.insulationScore','Deaktiviert\x20(Pro-Feature)','normal','Activity-Level','sound','Briefing\x20Error:\x20','analysis.training.triggerHealth','Anomaly\x20Detected','ü§ñ\x20Autopilot:\x20Running\x20periodic\x20analysis...','loc','log','SECURITY_RESULT','6iSqhBW','pip.exe','Restoring\x20sensor\x20cache...','Err:\x20','üöÄ\x20Starting\x20System\x20Logic...','\x20Tage)','Alert\x20Status','analysis.automation.targetValue','forEach','analysis.isAlert','Trend\x20Value','Energy\x20Intelligence','rmSync','.\x20ANWESEND:\x20','Security\x20Monitor','112023PvLfdS','getHours','guest','üõãÔ∏è\x20BUTLER:\x20Found\x20','ANOMALY','details','\x0aSTB:\x20','100CLzJih','.NextHours.Location_1.Day_1.current.temp_value','3vyiNNx','system.presenceWho','Trend','LTM.rawEventLog','analysis.health.isAnomaly','.\x20WETTER:\x20','Ungew√∂hnliches\x20Bewegungsmuster!\x20(Score:\x20','weatherInstance','isGracePeriodActive','analysis.automation.triggerAction','callback','üêç\x20Python\x20Pong','6452922RNQqoG','0\x203\x20*\x20*\x20*','üåÖ\x20Morning\x20Briefing:\x0a','analysis.health.trendValue','analysis.training.triggerComfort','online','values','bin','devices','triggerBriefing','autoApply','\x20=\x20','object','analysis.history_debug_00','analysis.automation.autoApply','testContext','insulation','text','AI\x20Training','analysis.trigger','service.py','LTM.baselineStatus','‚úÖ\x20Alles\x20OK\x20(Reset)','getEnums','motion','onReady','unload','setStateAsync','getStateAsync','extendObjectAsync','submitFeedback',')\x20-\x20SAFE\x20BOOT','kontakt','Daily\x20Digests','ENERGY_TRAIN_RESULT','LTM\x20Sched\x20Error:\x20','Kein\x20API\x20Key!','toLowerCase','‚úÖ\x20HEALTH\x20TRAINED.','system.config','ANALYZE_TREND','message','Detected\x20Patterns','notifyPushoverEnabled','cancel','[PYTHON]\x20','reason','bind','Gemini\x20AI\x20initialized.','rule','startsWith','stdout','toISOString','Target\x20ID','üß†\x20Triggering\x20Security\x20Training...','pip','LTM.processingStatus','622854FnlAOo','dependencyInstallInProgress','.forecast.current.temperature','retry','üìù\x20Feedback\x20received:\x20','splice','analysis.alertReason','analysis.training.triggerEnergy','config','logDuplicates','systemUUID','COGNI_REQUEST_CALL','briefingJob','isProVersion','\x22\x20install\x20--no-cache-dir\x20--force-reinstall\x20-r\x20\x22','command','apiKey','eventHistory','path','LTM.triggerDailyDigest','notifyEmailInstance','pythonProcess','\x20*\x20*\x20*','string','number','dismissAutomation','BUTLER\x20Execution\x20Error:\x20','instance','analysis.activitySummary','‚ùå\x20INSTALL\x20FAILED:\x20','Sec-Training\x20started...','analysisHistory','notifyTelegramEnabled','setState','üö®\x20EMERGENCY','08:00','notifyTelegramRecipient','analysis.energy','telegram','livingContext','ltmStbWindowDays','LTM.driftAnalysis.baselineDrift','vacation','useCalendar','fenster','presenceDevices','replace','siren','ANALYZE_SEQUENCE','inactivityThresholdHours','lights','Kein\x20API\x20Key.','system.isPresent','ROLLE:\x20Data\x20Scientist.\x20ZIEL:\x20Drift\x20erkennen.\x20SCHEMA:\x20{\x20\x22baselineDrift\x22:\x20\x22none|slight|significant|critical\x22,\x20\x22driftDetails\x22:\x20\x22string\x22\x20}\x0a\x0aLTB:\x20','length','indicator.alarm','sensorLastValues','state','.\x20EVENTS:\x20','Keine\x20Termine.','getMonth','getFullYear','Alert\x20Reason','Success','getGenerativeModel','Success:\x20','‚ùå\x20VENV\x20FAILED:\x20','briefingTime','lastAlertState','LTM.trainingData.thermodynamics','‚úÖ\x20Alarm\x20quittiert.\x20System\x20normal.','summary','klima','SIMULATION:\x20Test-Vorschlag\x20f√ºr\x20','channel','Raw\x20Log','name','python.exe','Lernphase\x20(','val','getOverviewData','date','toFixed','exitTimer','driftDetails','9AIwwRe','Reset\x20Sched\x20Error:\x20','platform','json','Target\x20Value','endsWith','.\x20EMERGENCY:\x20','kill','from','Scripts','analysis.health.lastCheck','confidence','python','analysis.security.lastCheck','748fPGOxr','analysis.triggerBriefing','HEALTH_TRAIN_RESULT','ROLLE:\x20Data\x20Compression\x20Agent.\x20SPRACHE:\x20DE.\x20FORMAT:\x20JSON.\x20ANWEISUNG:\x20Fasse\x20Sensor-Events\x20zusammen.\x20SCHEMA:\x20{\x20\x22summary\x22:\x20\x22string\x22,\x20\x22activityLevel\x22:\x20\x22string\x22\x20}\x20\x0a\x0aEVENTS:\x0a','now','bewegung','dimmer','geminiApiKey','Error\x20launching\x20Python:\x20','warn','writable','Cogni-Living','send','push','cogni-living\x20adapter\x20starting\x20(v','LTM.driftAnalysis.lastCheck','licht','simulateButler','automationProposal','testApiKey','events.history_debug_00','sendTo','geminiModel','Alarm','isPresent','dailyDigests','error','is_anomaly','Vom\x20Benutzer\x20best√§tigt\x20(OK).','VACATION','analysis.security.lastScore','Keine\x20Wetterdaten\x20verf√ºgbar.','description','aiPersona','üõãÔ∏è\x20Triggering\x20Comfort\x20Analysis\x20(Pattern\x20Mining)...','ack','ltmLtbWindowDays','.\x20AUFGABE:\x201.\x20Gesundheit?\x202.\x20Komfort?\x20FORMAT\x20(JSON):\x20{\x20\x22isAlert\x22:\x20boolean,\x20\x22alertReason\x22:\x20\x22string\x22,\x20\x22isEmergency\x22:\x20boolean,\x20\x22summary\x22:\x20\x22string\x22,\x20\x22automationProposal\x22:\x20{\x20\x22detected\x22:\x20boolean,\x20\x22description\x22:\x20\x22string\x22,\x20\x22targetId\x22:\x20\x22string\x22,\x20\x22targetValue\x22:\x20\x22any\x22\x20}\x20}','modeResetJob','Sequences','win32','‚ö†Ô∏è\x20Python\x20VENV\x20missing.\x20Installing\x20locally...','response','doors','door','debug','isEmergency','Unbekannt','close','analysis.security.currentThreshold','enum','window','\x20new\x20patterns.','cogni-living','type','location','Training\x20Status','minDaysForBaseline','system','isAlert','TRAIN_COMFORT','subscribeStates','onUnload'];a0_0x3e88=function(){return _0xededfd;};return a0_0x3e88();}function setupModeResetScheduler(_0x182a9f){const _0x3da116=a0_0x4f3c29;try{if(_0x182a9f[_0x3da116(0x1c1)])_0x182a9f[_0x3da116(0x1c1)][_0x3da116(0x12b)]();_0x182a9f[_0x3da116(0x1c1)]=schedule['scheduleJob'](MODE_RESET_SCHEDULE,async()=>{const _0x184a77=_0x3da116;await loadSystemMode(_0x182a9f),AUTO_RESET_MODES[_0x184a77(0x273)](_0x182a9f['currentSystemMode'])&&await _0x182a9f[_0x184a77(0x11a)](SYSTEM_DP_MODE,{'val':SYSTEM_MODES['NORMAL'],'ack':![]});});}catch(_0x380917){_0x182a9f[_0x3da116(0x282)]['error'](_0x3da116(0x18e)+_0x380917[_0x3da116(0x128)]);}}function setupDriftAnalysisScheduler(_0x2bba99){const _0x5e6da1=a0_0x4f3c29;try{if(_0x2bba99['driftAnalysisTimer'])clearInterval(_0x2bba99['driftAnalysisTimer']);if(!_0x2bba99[_0x5e6da1(0x145)])return;_0x2bba99[_0x5e6da1(0x252)]=setInterval(()=>runBaselineDriftAnalysis(_0x2bba99),(_0x2bba99['config'][_0x5e6da1(0x246)]||0x18)*0x36ee80),setTimeout(()=>runBaselineDriftAnalysis(_0x2bba99),0x1388);}catch(_0x420ddb){_0x2bba99[_0x5e6da1(0x282)][_0x5e6da1(0x1b5)]('Drift\x20Sched\x20Error:\x20'+_0x420ddb[_0x5e6da1(0x128)]);}}function setupBriefingScheduler(_0x288a39){const _0x201c7a=a0_0x4f3c29;try{if(_0x288a39[_0x201c7a(0x144)])_0x288a39[_0x201c7a(0x144)][_0x201c7a(0x12b)]();if(!_0x288a39[_0x201c7a(0x140)]['briefingEnabled'])return;const _0x3d2ce6=(_0x288a39['config'][_0x201c7a(0x17b)]||_0x201c7a(0x15b))[_0x201c7a(0x241)](':'),_0x4df047=parseInt(_0x3d2ce6[0x0])||0x8,_0x190dbf=parseInt(_0x3d2ce6[0x1])||0x0,_0x3dd496=_0x190dbf+'\x20'+_0x4df047+_0x201c7a(0x14e);_0x288a39['briefingJob']=schedule[_0x201c7a(0x1ee)](_0x3dd496,()=>{sendMorningBriefing(_0x288a39);});}catch(_0x48640a){_0x288a39['log'][_0x201c7a(0x1b5)](_0x201c7a(0x253)+_0x48640a['message']);}}async function runBaselineDriftAnalysis(_0x510f83){const _0x10671f=a0_0x4f3c29;if(!_0x510f83[_0x10671f(0x145)]||!_0x510f83['geminiModel'])return;const _0x4e5ee1=_0x510f83['config']['ltmStbWindowDays']||0xe;if(_0x510f83['dailyDigests']['length']<_0x4e5ee1+0x7){await _0x510f83['setStateAsync'](LTM_DP_DRIFT_STATUS,{'val':_0x10671f(0x1f9),'ack':!![]});return;}const _0x363887=_0x510f83[_0x10671f(0x1b4)][_0x10671f(0x238)](-_0x4e5ee1),_0x5e7aaa=_0x510f83['dailyDigests'][_0x10671f(0x238)](0x0,_0x510f83[_0x10671f(0x1b4)]['length']-_0x4e5ee1),_0x478426=_0x10671f(0x16d)+JSON[_0x10671f(0x1f7)](_0x5e7aaa)+_0x10671f(0x299)+JSON[_0x10671f(0x1f7)](_0x363887);try{const _0xf478ec=await _0x510f83['geminiModel']['generateContent'](_0x478426),_0x1312a3=JSON['parse'](_0xf478ec[_0x10671f(0x1c5)][_0x10671f(0x110)]()[_0x10671f(0x166)](/```json|```/g,'')[_0x10671f(0x225)]());_0x1312a3['baselineDrift']&&(await _0x510f83[_0x10671f(0x11a)](LTM_DP_DRIFT_STATUS,{'val':_0x1312a3[_0x10671f(0x1e2)],'ack':!![]}),await _0x510f83['setStateAsync'](LTM_DP_DRIFT_DETAILS,{'val':_0x1312a3[_0x10671f(0x18c)],'ack':!![]}),await _0x510f83[_0x10671f(0x11a)](LTM_DP_DRIFT_LAST_CHECK,{'val':Date[_0x10671f(0x19f)](),'ack':!![]}));}catch(_0x57611f){}}class CogniLiving extends utils[a0_0x4f3c29(0x1f8)]{constructor(_0x5b147b){const _0x2d55fa=a0_0x4f3c29;super({..._0x5b147b,'name':_0x2d55fa(0x1d0)}),this['eventHistory']=[],this[_0x2d55fa(0x157)]=[],this[_0x2d55fa(0x226)]=[],this[_0x2d55fa(0x1b4)]=[],this[_0x2d55fa(0x170)]={},this[_0x2d55fa(0x1e4)]={'latitude':0x0,'longitude':0x0,'city':''},this['isPresent']=!![],this[_0x2d55fa(0x18b)]=null,this[_0x2d55fa(0x1e7)]=null,this[_0x2d55fa(0xfb)]=![],this[_0x2d55fa(0x202)]=null,this[_0x2d55fa(0x1b1)]=null,this[_0x2d55fa(0x22e)]=SYSTEM_MODES[_0x2d55fa(0x1ef)],this[_0x2d55fa(0x145)]=![],this['lastAlertState']=![],this[_0x2d55fa(0x142)]='unknown',this[_0x2d55fa(0x1fc)]=null,this['ltmJob']=null,this[_0x2d55fa(0x1c1)]=null,this[_0x2d55fa(0x252)]=null,this[_0x2d55fa(0x144)]=null,this[_0x2d55fa(0x14d)]=null,this[_0x2d55fa(0x139)]=![],this['on'](_0x2d55fa(0x1e0),this[_0x2d55fa(0x118)][_0x2d55fa(0x12e)](this)),this['on'](_0x2d55fa(0x240),this[_0x2d55fa(0x21e)][_0x2d55fa(0x12e)](this)),this['on'](_0x2d55fa(0x119),this[_0x2d55fa(0x1d9)]['bind'](this)),this['on'](_0x2d55fa(0x128),this[_0x2d55fa(0x200)][_0x2d55fa(0x12e)](this));}async[a0_0x4f3c29(0x118)](){const _0x2d3e48=a0_0x4f3c29;this['log']['info'](_0x2d3e48(0x1a9)+this['version']+_0x2d3e48(0x11e));if(!checkAndInstall(this))return;await startSystem(this);}[a0_0x4f3c29(0x1d9)](_0x4796b8){const _0x192f3e=a0_0x4f3c29;if(this['analysisTimer'])clearInterval(this['analysisTimer']);if(this[_0x192f3e(0x252)])clearInterval(this[_0x192f3e(0x252)]);if(this[_0x192f3e(0x255)])this[_0x192f3e(0x255)]['cancel']();if(this['modeResetJob'])this['modeResetJob']['cancel']();if(this['briefingJob'])this['briefingJob'][_0x192f3e(0x12b)]();if(this[_0x192f3e(0x18b)])clearTimeout(this[_0x192f3e(0x18b)]);if(this[_0x192f3e(0x1e7)])clearTimeout(this[_0x192f3e(0x1e7)]);stopPythonService(this),_0x4796b8();}async['onStateChange'](_0x5a988a,_0x5784cd){const _0x403c60=a0_0x4f3c29;if(!_0x5784cd||this[_0x403c60(0x139)])return;if(_0x5a988a[_0x403c60(0x273)](_0x403c60(0x15e))&&_0x5a988a[_0x403c60(0x192)](_0x403c60(0x268))&&_0x5784cd[_0x403c60(0x187)]){await handleTelegramResponse(this,_0x5784cd[_0x403c60(0x187)]);return;}if(_0x5a988a===this[_0x403c60(0x257)]+'.'+SYSTEM_DP_MODE){if(_0x5784cd['val']&&Object['values'](SYSTEM_MODES)[_0x403c60(0x273)](_0x5784cd[_0x403c60(0x187)])){this[_0x403c60(0x22e)]=_0x5784cd['val'];if(_0x5784cd[_0x403c60(0x187)]===SYSTEM_MODES[_0x403c60(0x1b8)])await setPresence(this,![]);else await setPresence(this,!![]);}if(!_0x5784cd['ack'])this[_0x403c60(0x159)](_0x5a988a,{'val':this[_0x403c60(0x22e)],'ack':!![]});return;}if(!_0x5784cd[_0x403c60(0x1be)]){_0x5a988a[_0x403c60(0x273)](_0x403c60(0x112))&&_0x5784cd[_0x403c60(0x187)]&&(this[_0x403c60(0x159)](_0x5a988a,{'val':![],'ack':!![]}),runGeminiAnalysis(this));if(_0x5a988a[_0x403c60(0x273)]('triggerDailyDigest')&&_0x5784cd['val']){this[_0x403c60(0x159)](_0x5a988a,{'val':![],'ack':!![]});if(this[_0x403c60(0x145)])createDailyDigest(this);}_0x5a988a[_0x403c60(0x273)](_0x403c60(0x108))&&_0x5784cd[_0x403c60(0x187)]&&(this['setState'](_0x5a988a,{'val':![],'ack':!![]}),sendMorningBriefing(this));_0x5a988a[_0x403c60(0x273)](_0x403c60(0x22a))&&_0x5784cd[_0x403c60(0x187)]&&(this['setState'](_0x5a988a,{'val':![],'ack':!![]}),executeAutomationAction(this));if(_0x5a988a[_0x403c60(0x273)](_0x403c60(0x263))&&_0x5784cd[_0x403c60(0x187)]){this['setState'](_0x5a988a,{'val':![],'ack':!![]});if(this[_0x403c60(0x145)])try{const _0x1258e7=await this[_0x403c60(0x11b)](_0x403c60(0x229));if(_0x1258e7&&_0x1258e7[_0x403c60(0x187)]){const _0x32adfa=JSON[_0x403c60(0x25a)](_0x1258e7[_0x403c60(0x187)]);this['log'][_0x403c60(0x26b)](_0x403c60(0x135)),this['setStateAsync'](_0x403c60(0x233),{'val':_0x403c60(0x156),'ack':!![]}),sendToPython(this,_0x403c60(0x239),{'sequences':_0x32adfa});}}catch(_0x4390d1){this['log'][_0x403c60(0x1b5)](_0x403c60(0x1fd)+_0x4390d1['message']);}}if(_0x5a988a['includes'](_0x403c60(0x27e))&&_0x5784cd[_0x403c60(0x187)]){this[_0x403c60(0x159)](_0x5a988a,{'val':![],'ack':!![]});if(this[_0x403c60(0x145)])try{const _0x1c5cd2=await this[_0x403c60(0x11b)](LTM_DP_DAILY_DIGESTS);if(_0x1c5cd2&&_0x1c5cd2['val'])sendToPython(this,'TRAIN_HEALTH',{'digests':JSON[_0x403c60(0x25a)](_0x1c5cd2[_0x403c60(0x187)])});}catch(_0x138de9){}}if(_0x5a988a[_0x403c60(0x273)](_0x403c60(0x13f))&&_0x5784cd[_0x403c60(0x187)]){this[_0x403c60(0x159)](_0x5a988a,{'val':![],'ack':!![]});if(this[_0x403c60(0x145)])try{const _0xd36883=await this[_0x403c60(0x11b)](_0x403c60(0x17d));if(_0xd36883&&_0xd36883[_0x403c60(0x187)])sendToPython(this,_0x403c60(0x26d),{'points':JSON['parse'](_0xd36883[_0x403c60(0x187)])});}catch(_0xf70db){}}if(_0x5a988a['includes'](_0x403c60(0x103))&&_0x5784cd[_0x403c60(0x187)]){this[_0x403c60(0x159)](_0x5a988a,{'val':![],'ack':!![]});if(this[_0x403c60(0x145)])try{const _0x24a529=await this[_0x403c60(0x11b)](LTM_DP_RAW_LOG);_0x24a529&&_0x24a529[_0x403c60(0x187)]&&(this[_0x403c60(0x282)][_0x403c60(0x26b)](_0x403c60(0x1bd)),sendToPython(this,_0x403c60(0x1d7),{'events':JSON['parse'](_0x24a529[_0x403c60(0x187)])}));}catch(_0x278c3a){}}return;}if(this[_0x403c60(0x140)]['presenceDevices']&&this[_0x403c60(0x140)]['presenceDevices'][_0x403c60(0x273)](_0x5a988a)){await checkWifiPresence(this);return;}const _0x49d9b9=(this[_0x403c60(0x140)][_0x403c60(0x107)]||[])['find'](_0x2b848e=>_0x2b848e['id']===_0x5a988a);if(_0x49d9b9)processSensorEvent(this,_0x5a988a,_0x5784cd,_0x49d9b9);}async[a0_0x4f3c29(0x200)](_0x4ccf5d){const _0x56eeb6=a0_0x4f3c29;if(typeof _0x4ccf5d===_0x56eeb6(0x10b)&&_0x4ccf5d[_0x56eeb6(0x128)]){if(_0x4ccf5d[_0x56eeb6(0x147)]===_0x56eeb6(0x1ae)){const _0xdd2533=_0x4ccf5d[_0x56eeb6(0x128)][_0x56eeb6(0x148)]||this[_0x56eeb6(0x140)][_0x56eeb6(0x1a2)];if(!_0xdd2533)return this[_0x56eeb6(0x1b0)](_0x4ccf5d[_0x56eeb6(0x195)],_0x4ccf5d['command'],{'success':![],'message':_0x56eeb6(0x16b)},_0x4ccf5d[_0x56eeb6(0xfd)]);try{const _0x283df6=new GoogleGenerativeAI(_0xdd2533),_0x2a095f=_0x283df6[_0x56eeb6(0x178)]({'model':GEMINI_MODEL}),_0x39ac56=await _0x2a095f[_0x56eeb6(0x24a)]('Hi');this[_0x56eeb6(0x1b0)](_0x4ccf5d[_0x56eeb6(0x195)],_0x4ccf5d[_0x56eeb6(0x147)],{'success':!![],'message':_0x56eeb6(0x1de)+_0x39ac56[_0x56eeb6(0x1c5)][_0x56eeb6(0x110)]()},_0x4ccf5d[_0x56eeb6(0xfd)]);}catch(_0x2ad8dd){this[_0x56eeb6(0x1b0)](_0x4ccf5d['from'],_0x4ccf5d[_0x56eeb6(0x147)],{'success':![],'message':_0x56eeb6(0x287)+_0x2ad8dd[_0x56eeb6(0x128)]},_0x4ccf5d[_0x56eeb6(0xfd)]);}}else{if(_0x4ccf5d['command']===_0x56eeb6(0x10e)){const _0x543cfa=await getWeatherContext(this),_0x30fb2c=await getCalendarContext(this);this[_0x56eeb6(0x1b0)](_0x4ccf5d[_0x56eeb6(0x195)],_0x4ccf5d['command'],{'success':!![],'weather':_0x543cfa,'calendar':_0x30fb2c},_0x4ccf5d[_0x56eeb6(0xfd)]);}else{if(_0x4ccf5d[_0x56eeb6(0x147)]==='getLtmData'){if(!this[_0x56eeb6(0x145)])return this[_0x56eeb6(0x1b0)](_0x4ccf5d[_0x56eeb6(0x195)],_0x4ccf5d[_0x56eeb6(0x147)],{'success':![],'isPro':![]},_0x4ccf5d[_0x56eeb6(0xfd)]);let _0xee00db={'status':_0x56eeb6(0x20a)};try{const _0x1387f5=await this[_0x56eeb6(0x11b)](LTM_DP_DRIFT_STATUS);_0xee00db['status']=_0x1387f5?_0x1387f5[_0x56eeb6(0x187)]:_0x56eeb6(0x20a);}catch(_0x526377){}this[_0x56eeb6(0x1b0)](_0x4ccf5d['from'],_0x4ccf5d[_0x56eeb6(0x147)],{'success':!![],'isPro':!![],'dailyDigests':this[_0x56eeb6(0x1b4)],'driftAnalysis':_0xee00db,'analysisHistory':this[_0x56eeb6(0x157)]},_0x4ccf5d[_0x56eeb6(0xfd)]);}else{if(_0x4ccf5d[_0x56eeb6(0x147)]===_0x56eeb6(0x188)){const _0x4653ec=this[_0x56eeb6(0x1b4)][_0x56eeb6(0x16e)],_0x3df224=new Date(),_0x14b087=new Date(_0x3df224[_0x56eeb6(0x175)](),_0x3df224[_0x56eeb6(0x174)](),_0x3df224['getDate']())[_0x56eeb6(0x270)](),_0x4ac44d=this['rawEventLog']['filter'](_0x31ba9f=>new Date(_0x31ba9f['timestamp'])['getTime']()>_0x14b087)['length'],_0x149d76=new Array(0x18)[_0x56eeb6(0x211)](0x0);this['rawEventLog'][_0x56eeb6(0x28c)](_0x5950d5=>{const _0x3a3229=_0x56eeb6,_0x3ac259=new Date(_0x5950d5[_0x3a3229(0x25e)]);if(_0x3ac259[_0x3a3229(0x270)]()>_0x14b087)_0x149d76[_0x3ac259[_0x3a3229(0x294)]()]++;});let _0x291214={'status':_0x56eeb6(0x20a)};try{const _0x219a21=await this['getStateAsync'](LTM_DP_DRIFT_STATUS);_0x291214[_0x56eeb6(0x271)]=_0x219a21?_0x219a21[_0x56eeb6(0x187)]:_0x56eeb6(0x20a);}catch(_0x355a15){}let _0x5586fa='';try{const _0x49ab4c=await this[_0x56eeb6(0x11b)](_0x56eeb6(0xf4));_0x5586fa=_0x49ab4c?_0x49ab4c[_0x56eeb6(0x187)]:'';}catch(_0x10511c){}let _0x10df1e=null;!this[_0x56eeb6(0x1b1)]&&(_0x10df1e=this['config'][_0x56eeb6(0x1a2)]?'KI-Modell\x20nicht\x20initialisiert':_0x56eeb6(0x123));let _0x2d466e={'detected':![],'description':'','targetId':'','targetValue':'','autoApply':![]};try{const _0x30f391=await this[_0x56eeb6(0x11b)](_0x56eeb6(0x275));if(_0x30f391&&_0x30f391[_0x56eeb6(0x187)]){_0x2d466e['detected']=!![];const _0x1a50a6=await this[_0x56eeb6(0x11b)]('analysis.automation.description');_0x2d466e[_0x56eeb6(0x1bb)]=_0x1a50a6?_0x1a50a6[_0x56eeb6(0x187)]:'';const _0x705460=await this[_0x56eeb6(0x11b)](_0x56eeb6(0x21a));_0x2d466e[_0x56eeb6(0x1f4)]=_0x705460?_0x705460['val']:'';const _0x2b691e=await this['getStateAsync']('analysis.automation.targetValue');_0x2d466e[_0x56eeb6(0x24b)]=_0x2b691e?_0x2b691e['val']:'';}const _0x102724=await this['getStateAsync'](_0x56eeb6(0x10d));_0x2d466e[_0x56eeb6(0x109)]=_0x102724?!!_0x102724[_0x56eeb6(0x187)]:![];}catch(_0x111484){}this[_0x56eeb6(0x1b0)](_0x4ccf5d[_0x56eeb6(0x195)],_0x4ccf5d['command'],{'success':!![],'eventHistory':this['eventHistory'][_0x56eeb6(0x238)](0x0,0xf),'stats':{'digestCount':_0x4653ec,'eventCountToday':_0x4ac44d,'hourlyActivity':_0x149d76,'driftStatus':_0x291214['status'],'isPresent':this[_0x56eeb6(0x1b3)],'presenceWho':_0x5586fa,'minDays':this['config'][_0x56eeb6(0x1d4)]||0x7,'stbDays':this[_0x56eeb6(0x140)][_0x56eeb6(0x160)]||0xe,'ltbDays':this[_0x56eeb6(0x140)][_0x56eeb6(0x1bf)]||0x3c,'systemError':_0x10df1e},'automation':_0x2d466e},_0x4ccf5d[_0x56eeb6(0xfd)]);}else{if(_0x4ccf5d['command']===_0x56eeb6(0x274))try{const _0x387cf7=await scanForDevices(this,_0x4ccf5d[_0x56eeb6(0x128)]||{});this['sendTo'](_0x4ccf5d[_0x56eeb6(0x195)],_0x4ccf5d[_0x56eeb6(0x147)],{'success':!![],'devices':_0x387cf7},_0x4ccf5d['callback']);}catch(_0x3a211c){this['sendTo'](_0x4ccf5d[_0x56eeb6(0x195)],_0x4ccf5d['command'],{'success':![],'error':_0x3a211c[_0x56eeb6(0x128)]},_0x4ccf5d[_0x56eeb6(0xfd)]);}else{if(_0x4ccf5d[_0x56eeb6(0x147)]===_0x56eeb6(0x116)){const _0x120bfe=await this[_0x56eeb6(0x1f6)](_0x56eeb6(0x25d),_0x56eeb6(0x1cd)),_0x308b8a=[];if(_0x120bfe)for(const _0x3191d9 in _0x120bfe){const _0x771442=_0x120bfe[_0x3191d9],_0x1f60b8=(_0x771442[_0x56eeb6(0x1dd)]&&typeof _0x771442[_0x56eeb6(0x1dd)][_0x56eeb6(0x184)]==='object'?_0x771442[_0x56eeb6(0x1dd)][_0x56eeb6(0x184)]['de']:_0x771442[_0x56eeb6(0x1dd)][_0x56eeb6(0x184)])||_0x771442['common'][_0x56eeb6(0x184)];_0x308b8a['push']({'id':_0x3191d9,'name':_0x1f60b8});}this[_0x56eeb6(0x1b0)](_0x4ccf5d[_0x56eeb6(0x195)],_0x4ccf5d['command'],{'success':!![],'enums':_0x308b8a},_0x4ccf5d[_0x56eeb6(0xfd)]);}else{if(_0x4ccf5d['command']==='getCalendarNames'){const _0x29d398=_0x4ccf5d[_0x56eeb6(0x128)][_0x56eeb6(0x153)];if(!_0x29d398)return this[_0x56eeb6(0x1b0)](_0x4ccf5d['from'],_0x4ccf5d[_0x56eeb6(0x147)],{'success':![],'error':'No\x20instance'},_0x4ccf5d[_0x56eeb6(0xfd)]);const _0x4cc14f=await getCalendarNames(this,_0x29d398);this[_0x56eeb6(0x1b0)](_0x4ccf5d['from'],_0x4ccf5d['command'],{'success':!![],'names':_0x4cc14f},_0x4ccf5d[_0x56eeb6(0xfd)]);}else{if(_0x4ccf5d['command']===_0x56eeb6(0x1ac)){const {targetId:_0x3aac7e,targetValue:_0x2bfbc6}=_0x4ccf5d['message'];this['log'][_0x56eeb6(0x26b)]('üß™\x20Simulating\x20Butler\x20Proposal:\x20'+_0x3aac7e+'\x20=\x20'+_0x2bfbc6),await this[_0x56eeb6(0x11a)](_0x56eeb6(0x275),{'val':!![],'ack':!![]}),await this[_0x56eeb6(0x11a)]('analysis.automation.description',{'val':_0x56eeb6(0x181)+_0x3aac7e,'ack':!![]}),await this['setStateAsync'](_0x56eeb6(0x21a),{'val':_0x3aac7e,'ack':!![]}),await this[_0x56eeb6(0x11a)](_0x56eeb6(0x28b),{'val':_0x2bfbc6,'ack':!![]}),this[_0x56eeb6(0x1b0)](_0x4ccf5d['from'],_0x4ccf5d[_0x56eeb6(0x147)],{'success':!![]},_0x4ccf5d[_0x56eeb6(0xfd)]);}else{if(_0x4ccf5d[_0x56eeb6(0x147)]===_0x56eeb6(0x11d)){const {historyId:_0xcfddbd,rating:_0x361488,comment:_0x2b7b17,alertReason:_0x1a6ab7}=_0x4ccf5d[_0x56eeb6(0x128)];_0xcfddbd&&_0x361488?(await saveFeedback(this,{'timestamp':Date['now'](),'historyId':_0xcfddbd,'rating':_0x361488,'comment':_0x2b7b17,'alertReason':_0x1a6ab7}),this[_0x56eeb6(0x1b0)](_0x4ccf5d[_0x56eeb6(0x195)],_0x4ccf5d[_0x56eeb6(0x147)],{'success':!![]},_0x4ccf5d['callback'])):this[_0x56eeb6(0x1b0)](_0x4ccf5d[_0x56eeb6(0x195)],_0x4ccf5d[_0x56eeb6(0x147)],{'success':![],'error':'Missing\x20data'},_0x4ccf5d[_0x56eeb6(0xfd)]);}else _0x4ccf5d[_0x56eeb6(0x147)]===_0x56eeb6(0x151)&&(this[_0x56eeb6(0x282)]['info']('User\x20dismissed\x20automation\x20proposal.'),await this['setStateAsync']('analysis.automation.patternDetected',{'val':![],'ack':!![]}),await this['setStateAsync']('analysis.automation.description',{'val':'','ack':!![]}),this['sendTo'](_0x4ccf5d['from'],_0x4ccf5d[_0x56eeb6(0x147)],{'success':!![]},_0x4ccf5d['callback']));}}}}}}}}}}}if(require[a0_0x4f3c29(0x251)]!==module)module['exports']=_0x8347a6=>new CogniLiving(_0x8347a6);else new CogniLiving();