const a0_0x59d2da=a0_0x1c05;function a0_0x1c05(_0x1fb5e5,_0x9c18b7){const _0x296063=a0_0x388e();return a0_0x1c05=function(_0x276d1b,_0x1ffb36){_0x276d1b=_0x276d1b-0x105;let _0x388e0=_0x296063[_0x276d1b];return _0x388e0;},a0_0x1c05(_0x1fb5e5,_0x9c18b7);}(function(_0x4e8b4f,_0x2cc7ba){const _0xac682=a0_0x1c05,_0x38a67c=_0x4e8b4f();while(!![]){try{const _0x4ac954=parseInt(_0xac682(0x173))/0x1+parseInt(_0xac682(0x150))/0x2+-parseInt(_0xac682(0x1f9))/0x3+parseInt(_0xac682(0x131))/0x4*(parseInt(_0xac682(0x19a))/0x5)+parseInt(_0xac682(0x13f))/0x6+-parseInt(_0xac682(0x1b7))/0x7+parseInt(_0xac682(0x1a9))/0x8;if(_0x4ac954===_0x2cc7ba)break;else _0x38a67c['push'](_0x38a67c['shift']());}catch(_0x2f9410){_0x38a67c['push'](_0x38a67c['shift']());}}}(a0_0x388e,0x3446f));const a0_0x1ffb36=(function(){let _0x5258a8=!![];return function(_0x31d7e6,_0x2a3f87){const _0x7fdc6d=_0x5258a8?function(){const _0x55adc2=a0_0x1c05;if(_0x2a3f87){const _0x1d6d66=_0x2a3f87[_0x55adc2(0x1dd)](_0x31d7e6,arguments);return _0x2a3f87=null,_0x1d6d66;}}:function(){};return _0x5258a8=![],_0x7fdc6d;};}()),a0_0x276d1b=a0_0x1ffb36(this,function(){const _0x421194=a0_0x1c05;return a0_0x276d1b[_0x421194(0x1b2)]()[_0x421194(0x1c5)](_0x421194(0x1b6))['toString']()[_0x421194(0x1b4)](a0_0x276d1b)['search'](_0x421194(0x1b6));});function a0_0x388e(){const _0x3194b2=['getMinutes','minDaysForBaseline','ltmJob','.system.mode','LTM.trainingData.sequences','analysisHistory','SET_TOPOLOGY','floor','stateChange','loadSystemMode','heiter','application/json','temperature','setObjectNotExistsAsync','setPresence','find','runGeminiAnalysis','OPTIMIZE_ENERGY','sendMorningBriefing','Instanz\x20nicht\x20gefunden','debug','Heizung\x20kann\x20','enum.functions.*','instance','2744jMDIWT','scanDevices','ack','sensorLastValues','triggerBriefing','json','checkWifiPresence','subscribeForeignStatesAsync','LTM.dailyDigests','./lib/setup','analysis.automation.targetId','analysis.energy.warmupTimes','geminiModel','getOutsideTemperatureNumeric','873396xDxesm','Test','getGenerativeModel','SYSTEM_DP_MODE','runBaselineDriftAnalysis','analysis.training.triggerTopology','config','systemConfig','presenceDevices','checkThermostats','response','initHistory','setupBriefingScheduler','createDailyDigest','fill','analysis.energy.ventilationAlerts','party','4332TIsKgo','val','sunny','LTM.rawEventLog','getForeignStateAsync','onUnload','triggerGaitAnalysis','push','subscribeStates','cancel','analysis.energy.mpcActive','Gemini\x20Init\x20Error:\x20','Verbindung\x20erfolgreich!','PINN\x20AI\x20Forecast','system.adapter.','log','currentSystemMode','TRAIN_COMFORT','updateHealthVector','VACATION','ready','checkSolarCondition','accuweather.0','briefingJob','Kein\x20Kalender-Adapter','main','state','TRAIN_ENERGY','Lernphase\x20(','parse','analysis.health.todayVector','onMessage','triggerEnergyPrediction','modeResetJob','toLowerCase','380074cbjPev','ANALYZE_GAIT','devices','getForeignObjectsAsync','initSystemConfig','online','createAllObjects','Gemini\x20AI\x20initialized.','manual','.data.table','map','lastAlertState','enum.rooms.*','setupLtmScheduler','system.presenceWho','exitGraceTimer','Guest\x20Mode','rawEventLog','version','analysisTimer','updateTopologyMatrix','setStateAsync','Standard','sonn','runAutopilot','simulateButler','analysis.topology.structure','length','exitTimer','command','scanForDevices','onStateChange','abortExitTimer','initZombies','.communicate.request','from','PYTHON_EXE','timestamp','automation.triggerAction','2180TuFvWG','now','motion','driftAnalysisTimer','string','dependencyInstallInProgress','isPresent','Gesendet','object','pop','forEach','eventHistory','setHours','executeAutomationAction','runPythonHealthCheck','1226200mVACKV','\x20min\x20ausbleiben.','Aktiv\x20(','ðŸ¤–\x20Autopilot:\x20Running\x20periodic\x20analysis...','updated','checkCalendarTriggers','apiKey','namespace','startSystem','toString','checkAndInstall','constructor','analysis.training.triggerSecurity','(((.+)+)+)+$','2371201bOdIPO','analysis.automation.targetValue','isArray','@google/generative-ai','licenseKey','./lib/automation','checkLicense','exports','split','updateTopology','Notification\x20Test\x20Failed:\x20','Active\x20Ventilation\x20Alerts','send','name','search','analysis.trigger','analysisInterval','LTM.baselineStatus','Verbunden','./lib/dead_man','testNotification','getStateAsync','setupDriftAnalysisScheduler','analysis.energy.insulationScore','getLtmData','error','sendNotification','setState','stringify','models/gemini-flash-latest','triggerDailyDigest','./lib/installer','calendarInstance','_calName','stopService','./lib/python_bridge','analysis.security.learningStatus','LTM.trainingData.thermodynamics','apply','analysis.automation.triggerAction','getTime','add','scanThermostats','isSolar',')\x20-\x20Phase\x20C\x20(Adaptive\x20Security\x20&\x20Smart\x20Schedule)','Simulation\x20durch\x20Admin\x20(Test)','info','enum','notifyTelegramEnabled','Warm-Up\x20Time\x20(Minutes\x20to\x2021Â°C)','updateLocation','getHours','./lib/topology','testContext','isProVersion','endsWith','analysis.automation.patternDetected','analysis.automation.description','type','TRAIN_HEALTH','Activity-Level','join','unload','keys','system.mode','analysis.training.triggerComfort','1281921ibFIGD','callback','getForeignObjectAsync','inactivityThresholdHours','analysis.energy.pinnForecast','SET_LEARNING_MODE','klar','processSensorEvent','getOverviewData','SYSTEM_MODES','clear','getState','analysis.triggerBriefing','ðŸ””\x20Dies\x20ist\x20ein\x20Test\x20von\x20Cogni-Living.','dailyDigests','notifyTelegramInstance','bind','analysis.training.triggerEnergy','setupModeResetScheduler','includes','message','@iobroker/adapter-core','minutes_safe','getEnums','NORMAL','values','Kein\x20Wetter-Adapter','./lib/scheduler','genAI','dismissAutomation','calendarName','sendTo','common','geminiApiKey','onReady','sort','location'];a0_0x388e=function(){return _0x3194b2;};return a0_0x388e();}a0_0x276d1b();'use strict';const utils=require(a0_0x59d2da(0x109)),{GoogleGenerativeAI}=require(a0_0x59d2da(0x1ba)),installer=require(a0_0x59d2da(0x1d6)),scanner=require('./lib/scanner'),schedulers=require(a0_0x59d2da(0x10f)),topology=require(a0_0x59d2da(0x1eb)),setup=require(a0_0x59d2da(0x13a)),recorder=require('./lib/recorder'),pythonBridge=require(a0_0x59d2da(0x1da)),aiAgent=require('./lib/ai_agent'),deadMan=require(a0_0x59d2da(0x1ca)),automation=require(a0_0x59d2da(0x1bc)),GEMINI_MODEL=a0_0x59d2da(0x1d4),ACTIVITY_LEVEL_MAP={'sehr\x20hoch':0x64,'hoch':0x50,'normal':0x3c,'niedrig':0x28,'sehr\x20niedrig':0x14,'inaktiv':0x0};class CogniLiving extends utils['Adapter']{constructor(_0x34acb7){const _0x1f79a3=a0_0x59d2da;super({..._0x34acb7,'name':'cogni-living'}),this['eventHistory']=[],this['analysisHistory']=[],this[_0x1f79a3(0x184)]=[],this[_0x1f79a3(0x207)]=[],this[_0x1f79a3(0x134)]={},this[_0x1f79a3(0x146)]={'latitude':0x0,'longitude':0x0,'city':''},this[_0x1f79a3(0x1a0)]=!![],this[_0x1f79a3(0x18f)]=null,this[_0x1f79a3(0x182)]=null,this['isGracePeriodActive']=![],this[_0x1f79a3(0x110)]=null,this[_0x1f79a3(0x13d)]=null,this[_0x1f79a3(0x160)]=setup[_0x1f79a3(0x202)]['NORMAL'],this[_0x1f79a3(0x1ed)]=![],this[_0x1f79a3(0x17e)]=![],this[_0x1f79a3(0x186)]=null,this[_0x1f79a3(0x11b)]=null,this[_0x1f79a3(0x171)]=null,this[_0x1f79a3(0x19d)]=null,this[_0x1f79a3(0x167)]=null,this[_0x1f79a3(0x19f)]=![],this['on'](_0x1f79a3(0x164),this[_0x1f79a3(0x116)][_0x1f79a3(0x209)](this)),this['on'](_0x1f79a3(0x121),this[_0x1f79a3(0x192)][_0x1f79a3(0x209)](this)),this['on'](_0x1f79a3(0x1f5),this[_0x1f79a3(0x155)][_0x1f79a3(0x209)](this)),this['on'](_0x1f79a3(0x108),this['onMessage']['bind'](this));}async[a0_0x59d2da(0x116)](){const _0x55a394=a0_0x59d2da;this[_0x55a394(0x15f)]['info']('cogni-living\x20adapter\x20starting\x20(v'+this[_0x55a394(0x185)]+_0x55a394(0x1e3));if(!installer[_0x55a394(0x1b3)](this,()=>this['startSystem']()))return;}async[a0_0x59d2da(0x1b1)](){const _0x1b2d54=a0_0x59d2da;await setup[_0x1b2d54(0x194)](this);try{this[_0x1b2d54(0x1ed)]=await setup[_0x1b2d54(0x1bd)](this[_0x1b2d54(0x145)][_0x1b2d54(0x1bb)]);}catch(_0x1c4eff){}if(!this[_0x1b2d54(0x145)][_0x1b2d54(0x1fc)]||this['config'][_0x1b2d54(0x1fc)]<0.1)this[_0x1b2d54(0x145)][_0x1b2d54(0x1fc)]=0xc;await setup[_0x1b2d54(0x14a)](this),await setup[_0x1b2d54(0x177)](this);if(this[_0x1b2d54(0x145)][_0x1b2d54(0x115)])try{this[_0x1b2d54(0x110)]=new GoogleGenerativeAI(this[_0x1b2d54(0x145)][_0x1b2d54(0x115)]),this[_0x1b2d54(0x13d)]=this[_0x1b2d54(0x110)][_0x1b2d54(0x141)]({'model':GEMINI_MODEL,'generationConfig':{'responseMimeType':_0x1b2d54(0x124)}}),this[_0x1b2d54(0x15f)][_0x1b2d54(0x1e5)](_0x1b2d54(0x17a));}catch(_0x574191){this[_0x1b2d54(0x15f)][_0x1b2d54(0x1d0)](_0x1b2d54(0x15b)+_0x574191[_0x1b2d54(0x108)]);}await setup[_0x1b2d54(0x179)](this),await this[_0x1b2d54(0x122)](),await this[_0x1b2d54(0x126)](_0x1b2d54(0x1fd),{'type':_0x1b2d54(0x16a),'common':{'name':_0x1b2d54(0x15d),'type':_0x1b2d54(0x19e),'role':'json','read':!![],'write':![]},'native':{}}),await this['setObjectNotExistsAsync'](_0x1b2d54(0x14e),{'type':_0x1b2d54(0x16a),'common':{'name':_0x1b2d54(0x1c2),'type':'string','role':_0x1b2d54(0x136),'read':!![],'write':![]},'native':{}}),await this[_0x1b2d54(0x126)](_0x1b2d54(0x13c),{'type':_0x1b2d54(0x16a),'common':{'name':_0x1b2d54(0x1e8),'type':_0x1b2d54(0x19e),'role':_0x1b2d54(0x136),'read':!![],'write':![]},'native':{}});try{const _0x581d15=await this[_0x1b2d54(0x1cc)](_0x1b2d54(0x153));if(_0x581d15&&_0x581d15[_0x1b2d54(0x151)])this['rawEventLog']=JSON[_0x1b2d54(0x16d)](_0x581d15['val']);}catch(_0x47b5c7){this[_0x1b2d54(0x184)]=[];}try{const _0x429135=await this['getStateAsync'](_0x1b2d54(0x139));if(_0x429135&&_0x429135['val'])this[_0x1b2d54(0x207)]=JSON['parse'](_0x429135['val']);}catch(_0x141bff){this[_0x1b2d54(0x207)]=[];}const _0x4884d6=this[_0x1b2d54(0x207)][_0x1b2d54(0x18e)]>=(this[_0x1b2d54(0x145)][_0x1b2d54(0x11a)]||0x7)?_0x1b2d54(0x1ab)+this[_0x1b2d54(0x207)][_0x1b2d54(0x18e)]+'\x20Tage)':_0x1b2d54(0x16c)+this[_0x1b2d54(0x207)][_0x1b2d54(0x18e)]+'/'+(this[_0x1b2d54(0x145)][_0x1b2d54(0x11a)]||0x7)+')';await this[_0x1b2d54(0x188)](_0x1b2d54(0x1c8),{'val':_0x4884d6,'ack':!![]}),this['subscribeStates']('analysis.trigger'),this[_0x1b2d54(0x158)]('LTM.triggerDailyDigest'),this[_0x1b2d54(0x158)](_0x1b2d54(0x1f7)),this[_0x1b2d54(0x158)](_0x1b2d54(0x205)),this['subscribeStates'](_0x1b2d54(0x1de)),this[_0x1b2d54(0x158)]('analysis.automation.autoApply'),this['subscribeStates'](_0x1b2d54(0x1b5)),this[_0x1b2d54(0x158)]('analysis.training.triggerHealth'),this[_0x1b2d54(0x158)](_0x1b2d54(0x105)),this['subscribeStates'](_0x1b2d54(0x1f8)),this[_0x1b2d54(0x158)](_0x1b2d54(0x144)),this[_0x1b2d54(0x158)](_0x1b2d54(0x15a));const _0x7bec9a=this[_0x1b2d54(0x145)][_0x1b2d54(0x175)];if(_0x7bec9a)for(const _0x2147ef of _0x7bec9a){await this['subscribeForeignStatesAsync'](_0x2147ef['id']);}const _0x357b3e=this['config']['presenceDevices'];if(_0x357b3e)for(const _0x12ba01 of _0x357b3e){await this[_0x1b2d54(0x138)](_0x12ba01);}if(this[_0x1b2d54(0x145)][_0x1b2d54(0x1e7)]&&this['config'][_0x1b2d54(0x208)])await this[_0x1b2d54(0x138)](this['config'][_0x1b2d54(0x208)]+_0x1b2d54(0x195));setTimeout(()=>this[_0x1b2d54(0x137)](),0x1388);if(this[_0x1b2d54(0x186)])clearInterval(this[_0x1b2d54(0x186)]);const _0x433da3=this['config'][_0x1b2d54(0x1c7)]||0xf;_0x433da3>0x0&&(this[_0x1b2d54(0x186)]=setInterval(()=>{const _0x4731bd=_0x1b2d54;this[_0x4731bd(0x18b)](),automation[_0x4731bd(0x1ae)](this);},_0x433da3*0x3c*0x3e8)),setTimeout(()=>automation[_0x1b2d54(0x1ae)](this),0x2710),schedulers[_0x1b2d54(0x180)](this,()=>aiAgent[_0x1b2d54(0x14c)](this,pythonBridge)),schedulers[_0x1b2d54(0x106)](this),schedulers[_0x1b2d54(0x1cd)](this,()=>aiAgent[_0x1b2d54(0x143)](this)),schedulers[_0x1b2d54(0x14b)](this,()=>aiAgent['sendMorningBriefing'](this)),pythonBridge['startService'](this,installer[_0x1b2d54(0x197)]),setTimeout(async()=>{const _0xdffc45=_0x1b2d54;await topology[_0xdffc45(0x1c0)](this);try{const _0x18d884=await this['getStateAsync'](_0xdffc45(0x18d));if(_0x18d884&&_0x18d884[_0xdffc45(0x151)])pythonBridge[_0xdffc45(0x1c3)](this,_0xdffc45(0x11f),JSON['parse'](_0x18d884[_0xdffc45(0x151)]));}catch(_0x4abe17){}this['runPythonHealthCheck'](),this[_0xdffc45(0x156)](),this[_0xdffc45(0x170)](),this[_0xdffc45(0x162)]();},0x1388);}[a0_0x59d2da(0x155)](_0x5a68b7){const _0x16328f=a0_0x59d2da;if(this[_0x16328f(0x186)])clearInterval(this[_0x16328f(0x186)]);if(this[_0x16328f(0x19d)])clearInterval(this[_0x16328f(0x19d)]);if(this[_0x16328f(0x11b)])this[_0x16328f(0x11b)][_0x16328f(0x159)]();if(this[_0x16328f(0x171)])this[_0x16328f(0x171)][_0x16328f(0x159)]();if(this['briefingJob'])this['briefingJob']['cancel']();recorder[_0x16328f(0x193)](this),pythonBridge[_0x16328f(0x1d9)](this),_0x5a68b7();}async[a0_0x59d2da(0x192)](_0x2349d6,_0x38a282){const _0x2817fd=a0_0x59d2da;if(!_0x38a282||this[_0x2817fd(0x19f)])return;if(_0x2349d6[_0x2817fd(0x107)]('telegram')&&_0x2349d6[_0x2817fd(0x1ee)]('communicate.request')&&_0x38a282[_0x2817fd(0x151)])return;if(_0x2349d6===this[_0x2817fd(0x1b0)]+_0x2817fd(0x11c)){if(_0x38a282[_0x2817fd(0x151)]&&Object[_0x2817fd(0x10d)](setup[_0x2817fd(0x202)])[_0x2817fd(0x107)](_0x38a282[_0x2817fd(0x151)])){this['currentSystemMode']=_0x38a282[_0x2817fd(0x151)];if(_0x38a282['val']===setup['SYSTEM_MODES'][_0x2817fd(0x163)])await recorder[_0x2817fd(0x127)](this,![]);else await recorder['setPresence'](this,!![]);if(this[_0x2817fd(0x1ed)]){let _0xfcc3f1=![],_0x39e302=0x0,_0x4b74a9=_0x2817fd(0x17b);if(this[_0x2817fd(0x160)]===_0x2817fd(0x14f))_0xfcc3f1=!![],_0x39e302=0x168,_0x4b74a9='Party\x20Mode';else this[_0x2817fd(0x160)]==='guest'&&(_0xfcc3f1=!![],_0x39e302=0x5a0,_0x4b74a9=_0x2817fd(0x183));pythonBridge[_0x2817fd(0x1c3)](this,_0x2817fd(0x1fe),{'active':_0xfcc3f1,'duration':_0x39e302,'label':_0x4b74a9}),await this[_0x2817fd(0x188)](_0x2817fd(0x1db),{'val':JSON['stringify']({'active':_0xfcc3f1,'label':_0x4b74a9,'timestamp':Date['now']()}),'ack':!![]});}}if(!_0x38a282[_0x2817fd(0x133)])this[_0x2817fd(0x1d2)](_0x2349d6,{'val':this['currentSystemMode'],'ack':!![]});return;}if(!_0x38a282[_0x2817fd(0x133)]){_0x2349d6['includes'](_0x2817fd(0x1c6))&&_0x38a282[_0x2817fd(0x151)]&&(this['setState'](_0x2349d6,{'val':![],'ack':!![]}),aiAgent[_0x2817fd(0x129)](this));if(_0x2349d6[_0x2817fd(0x107)](_0x2817fd(0x1d5))&&_0x38a282[_0x2817fd(0x151)]){this[_0x2817fd(0x1d2)](_0x2349d6,{'val':![],'ack':!![]});if(this['isProVersion'])aiAgent[_0x2817fd(0x14c)](this,pythonBridge);}_0x2349d6['includes'](_0x2817fd(0x135))&&_0x38a282['val']&&(this[_0x2817fd(0x1d2)](_0x2349d6,{'val':![],'ack':!![]}),aiAgent[_0x2817fd(0x12b)](this));_0x2349d6[_0x2817fd(0x107)](_0x2817fd(0x199))&&_0x38a282['val']&&(this[_0x2817fd(0x1d2)](_0x2349d6,{'val':![],'ack':!![]}),aiAgent[_0x2817fd(0x1a7)](this));if(_0x2349d6[_0x2817fd(0x107)](_0x2817fd(0x1b5))&&_0x38a282[_0x2817fd(0x151)]){this[_0x2817fd(0x1d2)](_0x2349d6,{'val':![],'ack':!![]});if(this[_0x2817fd(0x1ed)])try{const _0x53a478=await this['getStateAsync'](_0x2817fd(0x11d));if(_0x53a478&&_0x53a478[_0x2817fd(0x151)]){const _0x30719c=JSON[_0x2817fd(0x16d)](_0x53a478[_0x2817fd(0x151)]);this['setStateAsync']('analysis.training.status',{'val':'Sec-Training\x20started...','ack':!![]}),pythonBridge[_0x2817fd(0x1c3)](this,'TRAIN_SECURITY',{'sequences':_0x30719c});}}catch(_0x39f0ab){}}if(_0x2349d6[_0x2817fd(0x107)]('analysis.training.triggerHealth')&&_0x38a282[_0x2817fd(0x151)]){this[_0x2817fd(0x1d2)](_0x2349d6,{'val':![],'ack':!![]});if(this['isProVersion'])try{const _0x61e1f9=await this[_0x2817fd(0x1cc)](_0x2817fd(0x139));if(_0x61e1f9&&_0x61e1f9[_0x2817fd(0x151)])pythonBridge[_0x2817fd(0x1c3)](this,_0x2817fd(0x1f2),{'digests':JSON['parse'](_0x61e1f9[_0x2817fd(0x151)])});}catch(_0x157ca0){}}if(_0x2349d6[_0x2817fd(0x107)](_0x2817fd(0x105))&&_0x38a282[_0x2817fd(0x151)]){this[_0x2817fd(0x1d2)](_0x2349d6,{'val':![],'ack':!![]});if(this['isProVersion'])try{const _0x2be383=await this[_0x2817fd(0x1cc)](_0x2817fd(0x1dc));if(_0x2be383&&_0x2be383[_0x2817fd(0x151)])pythonBridge['send'](this,_0x2817fd(0x16b),{'points':JSON[_0x2817fd(0x16d)](_0x2be383[_0x2817fd(0x151)])});}catch(_0x7fd7f8){}}if(_0x2349d6[_0x2817fd(0x107)](_0x2817fd(0x1f8))&&_0x38a282[_0x2817fd(0x151)]){this[_0x2817fd(0x1d2)](_0x2349d6,{'val':![],'ack':!![]});if(this[_0x2817fd(0x1ed)])try{const _0x219fea=await this[_0x2817fd(0x1cc)](_0x2817fd(0x153));if(_0x219fea&&_0x219fea['val'])pythonBridge[_0x2817fd(0x1c3)](this,_0x2817fd(0x161),{'events':JSON['parse'](_0x219fea[_0x2817fd(0x151)])});}catch(_0x2ca009){}}_0x2349d6[_0x2817fd(0x107)](_0x2817fd(0x144))&&_0x38a282[_0x2817fd(0x151)]&&(this['setState'](_0x2349d6,{'val':![],'ack':!![]}),topology[_0x2817fd(0x1c0)](this));return;}if(this['config']['presenceDevices']&&this['config']['presenceDevices'][_0x2817fd(0x107)](_0x2349d6)){await this[_0x2817fd(0x137)]();return;}const _0x2be4f2=(this[_0x2817fd(0x145)]['devices']||[])[_0x2817fd(0x128)](_0x3558aa=>_0x3558aa['id']===_0x2349d6);if(_0x2be4f2){const _0x3cb38e=await recorder[_0x2817fd(0x200)](this,_0x2349d6,_0x38a282,_0x2be4f2);_0x3cb38e&&_0x3cb38e[_0x2817fd(0x1f1)]===_0x2817fd(0x19c)&&_0x3cb38e[_0x2817fd(0x118)]&&this[_0x2817fd(0x1ed)]&&deadMan[_0x2817fd(0x1e9)](this,_0x3cb38e[_0x2817fd(0x118)]);}}async[a0_0x59d2da(0x16f)](_0x816bd0){const _0x164955=a0_0x59d2da;if(typeof _0x816bd0==='object'&&_0x816bd0[_0x164955(0x108)]){if(_0x816bd0[_0x164955(0x190)]===_0x164955(0x148))try{const _0xc60a38=await automation[_0x164955(0x1e1)](this);this[_0x164955(0x113)](_0x816bd0[_0x164955(0x196)],_0x816bd0[_0x164955(0x190)],{'success':!![],'results':_0xc60a38},_0x816bd0[_0x164955(0x1fa)]);}catch(_0x45219c){this[_0x164955(0x113)](_0x816bd0['from'],_0x816bd0['command'],{'success':![],'error':_0x45219c['message']},_0x816bd0[_0x164955(0x1fa)]);}else{if(_0x816bd0[_0x164955(0x190)]==='simulateEnergyMPC')try{const {current_temps:_0x50f578,t_out:_0x37dbca,targets:_0x55d74d,t_forecast:_0x222b7f}=_0x816bd0[_0x164955(0x108)],_0x37f548=[];let _0xe4e706={};try{const _0x30c4c6=await this[_0x164955(0x1cc)](_0x164955(0x1ce));if(_0x30c4c6&&_0x30c4c6[_0x164955(0x151)]){const _0x1d3806=JSON[_0x164955(0x16d)](_0x30c4c6['val']);_0xe4e706=_0x1d3806['scores']||_0x1d3806;}}catch(_0x338941){}const _0x3cb22a=_0x222b7f!==undefined&&_0x222b7f!==null?(_0x37dbca+_0x222b7f)/0x2:_0x37dbca;for(const [_0x28eaed,_0x31e23a]of Object['entries'](_0x50f578)){const _0x27386c=_0x55d74d[_0x28eaed]||0x15;if(_0x31e23a<=_0x27386c)continue;let _0x21a0eb=_0xe4e706[_0x28eaed]||-0.5;if(_0x21a0eb>=0x0)_0x21a0eb=-0.5;const _0x250f0c=Math['abs'](_0x21a0eb),_0x65fc08=_0x31e23a-_0x27386c;let _0x1c8b65=Math[_0x164955(0x120)](_0x65fc08/_0x250f0c*0x3c);const _0x44556f=_0x31e23a-_0x37dbca,_0x24dd6f=_0x31e23a-_0x3cb22a;if(_0x24dd6f!==0x0&&_0x44556f!==0x0){const _0x3e183d=_0x44556f/_0x24dd6f;_0x1c8b65=Math[_0x164955(0x120)](_0x1c8b65*_0x3e183d);}if(_0x1c8b65>0xf){if(_0x1c8b65>0xf0)_0x1c8b65=0xf0;_0x37f548[_0x164955(0x157)]({'room':_0x28eaed,'minutes_safe':_0x1c8b65,'target':_0x27386c,'current':_0x31e23a,'savings_msg':_0x164955(0x12e)+_0x1c8b65+_0x164955(0x1aa)});}}_0x37f548[_0x164955(0x117)]((_0x228290,_0x33f78c)=>_0x33f78c['minutes_safe']-_0x228290[_0x164955(0x10a)]),this[_0x164955(0x113)](_0x816bd0[_0x164955(0x196)],_0x816bd0[_0x164955(0x190)],{'success':!![],'proposals':_0x37f548},_0x816bd0['callback']);}catch(_0x22928f){this[_0x164955(0x113)](_0x816bd0[_0x164955(0x196)],_0x816bd0['command'],{'success':![],'error':_0x22928f[_0x164955(0x108)]},_0x816bd0[_0x164955(0x1fa)]);}else{if(_0x816bd0[_0x164955(0x190)]===_0x164955(0x111))await this[_0x164955(0x188)]('analysis.automation.patternDetected',{'val':![],'ack':!![]}),await this['setStateAsync'](_0x164955(0x1f0),{'val':'','ack':!![]}),await this[_0x164955(0x188)](_0x164955(0x13b),{'val':'','ack':!![]}),this[_0x164955(0x113)](_0x816bd0[_0x164955(0x196)],_0x816bd0['command'],{'success':!![]},_0x816bd0[_0x164955(0x1fa)]);else{if(_0x816bd0[_0x164955(0x190)]===_0x164955(0x18c)){const {targetId:_0x4b8a15,targetValue:_0x5117fd}=_0x816bd0[_0x164955(0x108)];await this['setStateAsync'](_0x164955(0x1ef),{'val':!![],'ack':!![]}),await this['setStateAsync']('analysis.automation.description',{'val':_0x164955(0x1e4),'ack':!![]}),await this[_0x164955(0x188)](_0x164955(0x13b),{'val':_0x4b8a15,'ack':!![]}),await this['setStateAsync']('analysis.automation.targetValue',{'val':String(_0x5117fd),'ack':!![]}),this['sendTo'](_0x816bd0[_0x164955(0x196)],_0x816bd0[_0x164955(0x190)],{'success':!![]},_0x816bd0['callback']);}else{if(_0x816bd0[_0x164955(0x190)]==='testApiKey')try{const _0x5c999f=_0x816bd0[_0x164955(0x108)][_0x164955(0x1af)];if(!_0x5c999f)throw new Error('Kein\x20API\x20Key\x20Ã¼bergeben');const _0x9e439f=new GoogleGenerativeAI(_0x5c999f),_0x1041b7=_0x9e439f['getGenerativeModel']({'model':GEMINI_MODEL}),_0xfe495f=await _0x1041b7['generateContent'](_0x164955(0x140)),_0x284dd6=await _0xfe495f[_0x164955(0x149)];if(_0x284dd6['text']())this['sendTo'](_0x816bd0[_0x164955(0x196)],_0x816bd0['command'],{'success':!![],'message':_0x164955(0x15c)},_0x816bd0[_0x164955(0x1fa)]);else throw new Error('Keine\x20Antwort\x20von\x20Gemini');}catch(_0x3d279d){this[_0x164955(0x113)](_0x816bd0[_0x164955(0x196)],_0x816bd0[_0x164955(0x190)],{'success':![],'message':_0x3d279d[_0x164955(0x108)]},_0x816bd0[_0x164955(0x1fa)]);}else{if(_0x816bd0[_0x164955(0x190)]===_0x164955(0x132))try{const _0x27c186=await scanner[_0x164955(0x191)](this,_0x816bd0[_0x164955(0x108)]||{});this[_0x164955(0x113)](_0x816bd0[_0x164955(0x196)],_0x816bd0[_0x164955(0x190)],{'success':!![],'devices':_0x27c186},_0x816bd0[_0x164955(0x1fa)]);}catch(_0x311008){this[_0x164955(0x113)](_0x816bd0[_0x164955(0x196)],_0x816bd0[_0x164955(0x190)],{'success':![],'error':_0x311008[_0x164955(0x108)]},_0x816bd0[_0x164955(0x1fa)]);}else{if(_0x816bd0['command']===_0x164955(0x187))try{const {matrix:_0x1231cc}=_0x816bd0[_0x164955(0x108)],_0x15758a=await this[_0x164955(0x1cc)](_0x164955(0x18d));if(_0x15758a&&_0x15758a[_0x164955(0x151)]){const _0x4f0f63=JSON[_0x164955(0x16d)](_0x15758a['val']);_0x4f0f63['matrix']=_0x1231cc,_0x4f0f63[_0x164955(0x1ad)]=Date[_0x164955(0x19b)](),await this[_0x164955(0x188)](_0x164955(0x18d),{'val':JSON[_0x164955(0x1d3)](_0x4f0f63),'ack':!![]}),pythonBridge['send'](this,_0x164955(0x11f),_0x4f0f63);}this[_0x164955(0x113)](_0x816bd0[_0x164955(0x196)],_0x816bd0[_0x164955(0x190)],{'success':!![]},_0x816bd0['callback']);}catch(_0x48b173){this[_0x164955(0x15f)][_0x164955(0x1d0)](_0x48b173);}else{if(_0x816bd0[_0x164955(0x190)]===_0x164955(0x1cf))this[_0x164955(0x113)](_0x816bd0[_0x164955(0x196)],_0x816bd0[_0x164955(0x190)],{'success':!![],'dailyDigests':this[_0x164955(0x207)]||[],'analysisHistory':this[_0x164955(0x11e)]||[]},_0x816bd0[_0x164955(0x1fa)]);else{if(_0x816bd0['command']===_0x164955(0x201)){const _0x48ad80=this[_0x164955(0x207)][_0x164955(0x18e)],_0x229e72=new Array(0x18)[_0x164955(0x14d)](0x0),_0x33bf07=new Date()[_0x164955(0x1a6)](0x0,0x0,0x0,0x0);this[_0x164955(0x1a5)]&&this[_0x164955(0x1a5)][_0x164955(0x1a4)](_0x27deb4=>{const _0x3fac43=_0x164955;if(_0x27deb4[_0x3fac43(0x198)]>=_0x33bf07){const _0x292426=new Date(_0x27deb4[_0x3fac43(0x198)])['getHours']();if(_0x292426>=0x0&&_0x292426<0x18)_0x229e72[_0x292426]++;}});let _0x48ae6c=![],_0x1c6a26='',_0x4a2233='',_0x10436e='';try{const _0x4bc85b=await this[_0x164955(0x1cc)](_0x164955(0x1ef));if(_0x4bc85b&&_0x4bc85b[_0x164955(0x151)]){_0x48ae6c=!![];const _0xf11688=await this[_0x164955(0x1cc)](_0x164955(0x1f0));_0x1c6a26=_0xf11688?_0xf11688['val']:'';const _0xc62f08=await this[_0x164955(0x1cc)](_0x164955(0x13b));_0x4a2233=_0xc62f08?_0xc62f08[_0x164955(0x151)]:'';const _0xb648b1=await this[_0x164955(0x1cc)](_0x164955(0x1b8));_0x10436e=_0xb648b1?_0xb648b1[_0x164955(0x151)]:'';}}catch(_0x5d0b25){}const _0x8271aa=await this[_0x164955(0x165)](),_0x1cbfc6=(this[_0x164955(0x145)][_0x164955(0x175)]||[])['some'](_0x3036f6=>_0x3036f6[_0x164955(0x1e2)]),_0x39e684=_0x8271aa&&_0x1cbfc6;this['sendTo'](_0x816bd0['from'],_0x816bd0[_0x164955(0x190)],{'success':!![],'eventHistory':this[_0x164955(0x1a5)]['slice'](0x0,0xf),'stats':{'digestCount':_0x48ad80,'isPresent':this[_0x164955(0x1a0)],'hourlyActivity':_0x229e72,'solarActive':_0x39e684},'automation':{'detected':_0x48ae6c,'description':_0x1c6a26,'targetId':_0x4a2233,'targetValue':_0x10436e}},_0x816bd0[_0x164955(0x1fa)]);}else{if(_0x816bd0[_0x164955(0x190)]===_0x164955(0x10b)){const _0x6e4422=await this[_0x164955(0x176)](_0x164955(0x12f),_0x164955(0x1e6)),_0xed29ff=[];if(_0x6e4422)for(const _0x417d69 in _0x6e4422){const _0x1305b3=_0x6e4422[_0x417d69],_0x178b59=(_0x1305b3[_0x164955(0x114)]&&typeof _0x1305b3['common'][_0x164955(0x1c4)]==='object'?_0x1305b3[_0x164955(0x114)][_0x164955(0x1c4)]['de']:_0x1305b3['common']['name'])||_0x1305b3[_0x164955(0x114)][_0x164955(0x1c4)];_0xed29ff[_0x164955(0x157)]({'id':_0x417d69,'name':_0x178b59});}const _0x109cc9=await this[_0x164955(0x176)](_0x164955(0x17f),'enum'),_0x319440=[];if(_0x109cc9)for(const _0x276102 in _0x109cc9){const _0x34c402=_0x109cc9[_0x276102],_0x21af14=(_0x34c402[_0x164955(0x114)]&&typeof _0x34c402[_0x164955(0x114)][_0x164955(0x1c4)]===_0x164955(0x1a2)?_0x34c402[_0x164955(0x114)][_0x164955(0x1c4)]['de']:_0x34c402[_0x164955(0x114)][_0x164955(0x1c4)])||_0x276102[_0x164955(0x1bf)]('.')[_0x164955(0x1a3)]();_0x319440[_0x164955(0x157)](_0x21af14);}this[_0x164955(0x113)](_0x816bd0['from'],_0x816bd0[_0x164955(0x190)],{'success':!![],'enums':_0xed29ff,'rooms':_0x319440},_0x816bd0[_0x164955(0x1fa)]);}else{if(_0x816bd0[_0x164955(0x190)]===_0x164955(0x1ec))try{let _0xbb3e19=_0x164955(0x10e),_0x67dad4=_0x164955(0x168);if(this[_0x164955(0x145)]['useWeather']){const _0x59c038=await recorder['getOutsideTemperatureNumeric'](this);_0xbb3e19=_0x59c038!==null?_0x59c038+'Â°C':'Daten\x20nicht\x20verfÃ¼gbar';}if(this[_0x164955(0x145)][_0x164955(0x1d7)]){const _0x2d87a1=await this[_0x164955(0x1fb)](_0x164955(0x15e)+this[_0x164955(0x145)]['calendarInstance']);_0x67dad4=_0x2d87a1?_0x164955(0x1c9):_0x164955(0x12c);}this[_0x164955(0x113)](_0x816bd0[_0x164955(0x196)],_0x816bd0[_0x164955(0x190)],{'success':!![],'weather':_0xbb3e19,'calendar':_0x67dad4},_0x816bd0[_0x164955(0x1fa)]);}catch(_0x23d7fb){this[_0x164955(0x113)](_0x816bd0[_0x164955(0x196)],_0x816bd0[_0x164955(0x190)],{'success':![],'error':_0x23d7fb[_0x164955(0x108)]},_0x816bd0[_0x164955(0x1fa)]);}else{if(_0x816bd0[_0x164955(0x190)]==='getCalendarNames')try{const _0x501b67=_0x816bd0['message'][_0x164955(0x130)],_0x29f757=await this['getForeignStateAsync'](_0x501b67+_0x164955(0x17c));let _0x1f17ae=[];if(_0x29f757&&_0x29f757[_0x164955(0x151)]){const _0x55632c=JSON[_0x164955(0x16d)](_0x29f757[_0x164955(0x151)]),_0x1e2d32=new Set();Array[_0x164955(0x1b9)](_0x55632c)&&_0x55632c[_0x164955(0x1a4)](_0x298e46=>{const _0x280b3e=_0x164955;if(_0x298e46['_calName'])_0x1e2d32['add'](_0x298e46[_0x280b3e(0x1d8)]);else{if(_0x298e46[_0x280b3e(0x112)])_0x1e2d32[_0x280b3e(0x1e0)](_0x298e46['calendarName']);}}),_0x1f17ae=Array[_0x164955(0x196)](_0x1e2d32)[_0x164955(0x117)]();}if(_0x1f17ae[_0x164955(0x18e)]===0x0)_0x1f17ae=[_0x164955(0x189)];this[_0x164955(0x113)](_0x816bd0['from'],_0x816bd0[_0x164955(0x190)],{'success':!![],'names':_0x1f17ae},_0x816bd0[_0x164955(0x1fa)]);}catch(_0x483654){this[_0x164955(0x113)](_0x816bd0[_0x164955(0x196)],_0x816bd0[_0x164955(0x190)],{'success':![],'error':_0x483654['message']},_0x816bd0[_0x164955(0x1fa)]);}else{if(_0x816bd0[_0x164955(0x190)]===_0x164955(0x1cb))try{await setup[_0x164955(0x1d1)](this,_0x164955(0x206),![],![]),this[_0x164955(0x113)](_0x816bd0['from'],_0x816bd0[_0x164955(0x190)],{'success':!![],'message':_0x164955(0x1a1)},_0x816bd0[_0x164955(0x1fa)]);}catch(_0x2f1b7b){this[_0x164955(0x15f)][_0x164955(0x1d0)](_0x164955(0x1c1)+_0x2f1b7b[_0x164955(0x108)]),this[_0x164955(0x113)](_0x816bd0[_0x164955(0x196)],_0x816bd0[_0x164955(0x190)],{'success':![],'message':'Fehler:\x20'+_0x2f1b7b[_0x164955(0x108)]},_0x816bd0[_0x164955(0x1fa)]);}}}}}}}}}}}}}}}async[a0_0x59d2da(0x122)](){const _0x23f76c=a0_0x59d2da;try{const _0x2d7a35=await this[_0x23f76c(0x1cc)](setup[_0x23f76c(0x142)]);_0x2d7a35&&_0x2d7a35[_0x23f76c(0x151)]&&Object[_0x23f76c(0x10d)](setup[_0x23f76c(0x202)])[_0x23f76c(0x107)](_0x2d7a35['val'])?this[_0x23f76c(0x160)]=_0x2d7a35['val']:(this[_0x23f76c(0x160)]=setup['SYSTEM_MODES'][_0x23f76c(0x10c)],await this[_0x23f76c(0x188)](setup[_0x23f76c(0x142)],{'val':setup[_0x23f76c(0x202)]['NORMAL'],'ack':!![]}));}catch(_0x7e2254){this[_0x23f76c(0x160)]=setup['SYSTEM_MODES'][_0x23f76c(0x10c)];}}async[a0_0x59d2da(0x137)](){const _0x3b9b73=a0_0x59d2da;try{const _0x49dbb4=this['config'][_0x3b9b73(0x147)]||[];let _0x513a3f=![];const _0xd77432=[];for(const _0x1cea77 of _0x49dbb4){try{const _0x4ac3f2=await this[_0x3b9b73(0x154)](_0x1cea77);_0x4ac3f2&&(_0x4ac3f2[_0x3b9b73(0x151)]===!![]||_0x4ac3f2[_0x3b9b73(0x151)]===_0x3b9b73(0x178)||_0x4ac3f2['val']===0x1)&&(_0x513a3f=!![],_0xd77432[_0x3b9b73(0x157)](_0x1cea77));}catch(_0x3836ea){}}return await this[_0x3b9b73(0x188)](_0x3b9b73(0x181),{'val':_0xd77432[_0x3b9b73(0x1f4)](',\x20'),'ack':!![]}),_0x513a3f&&(this[_0x3b9b73(0x18f)]&&(this[_0x3b9b73(0x15f)][_0x3b9b73(0x1e5)]('WiFi\x20Presence\x20detected.'),recorder['abortExitTimer'](this)),!this[_0x3b9b73(0x1a0)]&&this[_0x3b9b73(0x160)]===setup['SYSTEM_MODES'][_0x3b9b73(0x10c)]&&await recorder[_0x3b9b73(0x127)](this,!![])),_0x513a3f;}catch(_0x37dce1){return![];}}async['runAutopilot'](){const _0x27923b=a0_0x59d2da;this[_0x27923b(0x15f)][_0x27923b(0x12d)](_0x27923b(0x1ac)),await aiAgent['runGeminiAnalysis'](this),this[_0x27923b(0x162)](),this[_0x27923b(0x156)](),this[_0x27923b(0x170)]();}async[a0_0x59d2da(0x165)](){const _0x44a906=a0_0x59d2da,_0x4bd950=['weatherunderground.0',_0x44a906(0x166),'daswetter.0'],_0x4a59e8=['forecast.current.weather','Current.WeatherText','NextHours.Location_1.Day_1.current.symbol_desc'];for(const _0xa4eea3 of _0x4bd950){for(const _0x4876cf of _0x4a59e8){try{const _0x4ff09a=_0xa4eea3+'.'+_0x4876cf,_0x18a8d2=await this[_0x44a906(0x154)](_0x4ff09a);if(_0x18a8d2&&_0x18a8d2['val']){const _0x379cb2=String(_0x18a8d2[_0x44a906(0x151)])['toLowerCase']();if(_0x379cb2[_0x44a906(0x107)](_0x44a906(0x18a))||_0x379cb2[_0x44a906(0x107)](_0x44a906(0x152))||_0x379cb2[_0x44a906(0x107)](_0x44a906(0x1ff))||_0x379cb2[_0x44a906(0x107)](_0x44a906(0x203))||_0x379cb2['includes'](_0x44a906(0x123)))return!![];}}catch(_0x108ca4){}}}return![];}[a0_0x59d2da(0x156)](){const _0x222e74=a0_0x59d2da;if(!this[_0x222e74(0x1ed)])return;try{this[_0x222e74(0x204)](_0x222e74(0x11d),(_0x10e32a,_0x539e14)=>{const _0x4c1877=_0x222e74;_0x539e14&&_0x539e14[_0x4c1877(0x151)]&&pythonBridge['send'](this,_0x4c1877(0x174),{'sequences':JSON[_0x4c1877(0x16d)](_0x539e14[_0x4c1877(0x151)])});});}catch(_0xca626e){}}async['triggerEnergyPrediction'](){const _0x140fba=a0_0x59d2da;if(!this['isProVersion'])return;try{const _0x211bc5=await recorder[_0x140fba(0x13e)](this);if(_0x211bc5===null)return;const _0x3ad727={},_0x4f6404={},_0x4f82be=this['config'][_0x140fba(0x175)]||[];for(const _0x4a493b of _0x4f82be){if(_0x4a493b[_0x140fba(0x1f1)]===_0x140fba(0x125)&&_0x4a493b[_0x140fba(0x118)]){const _0x4e859c=this[_0x140fba(0x134)][_0x4a493b['id']];if(_0x4e859c!==undefined)_0x3ad727[_0x4a493b[_0x140fba(0x118)]]=_0x4e859c;if(_0x4a493b[_0x140fba(0x1e2)])_0x4f6404[_0x4a493b[_0x140fba(0x118)]]=!![];}}const _0x32d34b=await this['checkSolarCondition']();Object[_0x140fba(0x1f6)](_0x3ad727)[_0x140fba(0x18e)]>0x0&&(pythonBridge[_0x140fba(0x1c3)](this,'PREDICT_ENERGY',{'current_temps':_0x3ad727,'t_out':_0x211bc5,'is_sunny':_0x32d34b,'solar_flags':_0x4f6404}),pythonBridge['send'](this,_0x140fba(0x12a),{'current_temps':_0x3ad727,'t_out':_0x211bc5,'targets':{}}));}catch(_0x2b799e){}}['updateHealthVector'](){const _0x4eeaa7=a0_0x59d2da;if(!this[_0x4eeaa7(0x184)]||this['rawEventLog']['length']===0x0)return;const _0x3ec96b=new Array(0x60)[_0x4eeaa7(0x14d)](0x0),_0x283ae8=new Date()[_0x4eeaa7(0x1a6)](0x0,0x0,0x0,0x0);this[_0x4eeaa7(0x184)][_0x4eeaa7(0x1a4)](_0x1e398e=>{const _0x3628b=_0x4eeaa7,_0x26d34a=new Date(_0x1e398e['timestamp']);if(_0x26d34a[_0x3628b(0x1df)]()>=_0x283ae8){const _0x27c69d=_0x26d34a[_0x3628b(0x1ea)](),_0x5157db=_0x26d34a[_0x3628b(0x119)](),_0x3ea2f5=_0x27c69d*0x4+Math[_0x3628b(0x120)](_0x5157db/0xf);if(_0x3ea2f5>=0x0&&_0x3ea2f5<0x60)_0x3ec96b[_0x3ea2f5]++;}}),this['setStateAsync'](_0x4eeaa7(0x16e),{'val':JSON[_0x4eeaa7(0x1d3)](_0x3ec96b),'ack':!![]});}[a0_0x59d2da(0x1a8)](){const _0x475f63=a0_0x59d2da;if(!this[_0x475f63(0x207)]||this[_0x475f63(0x207)]['length']<0x2)return;const _0x2db94c=this['dailyDigests'][_0x475f63(0x17d)](_0x4f724c=>{const _0x251006=_0x475f63,_0x5a2674=(_0x4f724c['activityLevel']||'')[_0x251006(0x172)]();return ACTIVITY_LEVEL_MAP[_0x5a2674]||0x32;});pythonBridge[_0x475f63(0x1c3)](this,'ANALYZE_TREND',{'values':_0x2db94c,'tag':_0x475f63(0x1f3)});}}if(require[a0_0x59d2da(0x169)]!==module)module[a0_0x59d2da(0x1be)]=_0x108342=>new CogniLiving(_0x108342);else new CogniLiving();