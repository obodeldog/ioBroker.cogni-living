const a0_0x5347b6=a0_0x5567;(function(_0x53c0bb,_0x54486d){const _0x3babb7=a0_0x5567,_0x4bcd82=_0x53c0bb();while(!![]){try{const _0x455e82=parseInt(_0x3babb7(0x232))/0x1+parseInt(_0x3babb7(0x21c))/0x2+parseInt(_0x3babb7(0x298))/0x3*(-parseInt(_0x3babb7(0x297))/0x4)+parseInt(_0x3babb7(0x1cb))/0x5+-parseInt(_0x3babb7(0x29f))/0x6*(parseInt(_0x3babb7(0x1d1))/0x7)+parseInt(_0x3babb7(0x263))/0x8+parseInt(_0x3babb7(0x264))/0x9;if(_0x455e82===_0x54486d)break;else _0x4bcd82['push'](_0x4bcd82['shift']());}catch(_0xed1098){_0x4bcd82['push'](_0x4bcd82['shift']());}}}(a0_0x557d,0xe0375));function a0_0x557d(){const _0x4f97fc=['‚ö†Ô∏è\x20BROKEN\x20VENV\x20DETECTED.\x20Repairing...','getGenerativeModel','[LOG]','heizung','analysis.security.lastCheck','Failed:\x20','error','analysis.training.status','setStateAsync','analysis.trigger','pip.exe','(((.+)+)+)+$','cogni-living\x20adapter\x20starting\x20(v','main','Installing\x20dependencies\x20into\x20venv...','message','üêç\x20Using\x20Isolated\x20VENV\x20Python:\x20','analysis.alertReason','dependencyInstallInProgress','LTM.trainingData.thermodynamics','systemConfig','events.history','lastAlertState','payload','map','[RESULT]','analysis.automation.triggerAction','PONG','\x22\x20install\x20-r\x20\x22','startsWith','exitTimer','analysis.energy.insulationScore','party','Sec-Training\x20started...','automation.triggerAction','common','modeResetJob','PRIORIT√ÑT:\x20Sicherheit.','existsSync','Gemini\x20AI\x20initialized.','python.exe','writable','üõ†Ô∏è\x20MAINTENANCE\x20MODE:\x20Installing\x20Python\x20dependencies.\x20This\x20can\x20take\x205-15\x20minutes.\x20Do\x20not\x20restart!','type','ack','üõ°Ô∏è\x20SECURITY:\x20Sending\x20sequence\x20to\x20Guard\x20for\x20analysis...','door','klima','application/json','geminiApiKey','ready','win32','value','analysis.training.triggerHealth','includes','[PYTHON]\x20Failed\x20to\x20start:\x20','requirements.txt','PARTY','t√ºr','python3\x20-m\x20venv\x20\x22','LTM.driftAnalysis.driftDetails','analysis.training.triggerEnergy','[PYTHON]\x20','3509686woyAwW','unshift','NORMAL','version','substring','Error\x20launching\x20Python\x20service:\x20','LTM.triggerDailyDigest','command','briefingJob','‚úÖ\x20INFRASTRUCTURE\x20READY.\x20Starting\x20Service...','analysis.automation.autoApply','debug','values','onStateChange','Gemini\x20Init\x20Error:\x20','isExit','TRAINING_COMPLETE','longitude','cpu_feature_guard','SECURITY_RESULT','inactivityThresholdHours','communicate.request','293719EUUyXr',')\x20-\x20RECOVER\x20MODE','stdin','onReady','@iobroker/adapter-core','onUnload','LTM.trainingData.sequences','location','rawEventLog','No\x20module\x20named','schalter','ltmJob','isGracePeriodActive','bewegung','close','geminiModel','driftAnalysisTimer','LTM.processingStatus','some','config','endsWith','TRAIN_ENERGY','platform','service.py','exitGraceTimer','GUEST',')\x20->\x20','TRAIN_SECURITY','heating','loc','@google/generative-ai','events.lastEvent','toFixed','info','toLowerCase','stdout','node-schedule','dailyDigests','write','search','now','setState','push','toISOString','eventHistory','lampe','object','toString','isProVersion','241024Hylumv','8821539qrKZpn','‚ö†Ô∏è\x20VENV\x20not\x20found.\x20Falling\x20back\x20to\x20system\x20python3.','cogni-living','trim','system.isPresent','subscribeStates','namespace','devices','forEach','pythonProcess','isPresent','light','insulation','switch','motion','Fokus\x20auf\x20Komfort.','‚ùå\x20PIP\x20INSTALL\x20FAILED:\x20','\x20(Length:\x20','[RECORDER]\x20Error\x20saving\x20sequence:\x20','testApiKey','latitude','analysis.isAlert','cancel','üß†\x20Triggering\x20Security\x20Training...','occupancy','LTM.baselineStatus','Success:\x20','models/gemini-flash-latest','getForeignObjectAsync','systemUUID','round','licenseKey','üõ°Ô∏è\x20SECURITY\x20CHECK:\x20Score\x20','stringify','sensorLastValues','bin','Scripts','triggerBriefing','genAI','splice','currentSystemMode','üêç\x20Stopping\x20Python\x20Sidecar...','pip','contact','[RECORDER]\x20Added\x20step\x20to\x20sequence:\x20','üêç\x20Python\x20Pong\x20received!','getStateAsync','warn','bind','join','unload','5252srwVJn','3087ENSDHt','subscribeForeignStatesAsync','find','length','analysisInterval','fenster','normal','6567594HGdorb','presenceDevices','‚ùå\x20VENV\x20CREATION\x20FAILED.\x20Please\x20run:\x20sudo\x20apt\x20install\x20python3-venv','presence','analysisHistory','data','LTM.driftAnalysis.baselineDrift','python3','Adapter','‚ö†Ô∏è\x20SECURITY\x20ALARM:\x20','Unknown','onMessage','python_service','LTM.dailyDigests','toLocaleTimeString','[PYTHON]\x20Service\x20exited\x20with\x20code\x20','1526020mkUIiR','ANALYZE_SEQUENCE','pop','analysis.energy.heatingScore','split','log','7qPRNbX','kill','python','parse','val','TRAIN_HEALTH','analysis.training.triggerSecurity','LTM.rawEventLog','rmSync','shift','window','analysisTimer'];a0_0x557d=function(){return _0x4f97fc;};return a0_0x557d();}const a0_0x447c64=(function(){let _0x42c8a2=!![];return function(_0x1b14c6,_0x32fbc5){const _0xfbba4d=_0x42c8a2?function(){if(_0x32fbc5){const _0x48b9a2=_0x32fbc5['apply'](_0x1b14c6,arguments);return _0x32fbc5=null,_0x48b9a2;}}:function(){};return _0x42c8a2=![],_0xfbba4d;};}()),a0_0x3c95f0=a0_0x447c64(this,function(){const _0xd9b71f=a0_0x5567;return a0_0x3c95f0[_0xd9b71f(0x261)]()['search'](_0xd9b71f(0x1e8))['toString']()['constructor'](a0_0x3c95f0)[_0xd9b71f(0x259)]('(((.+)+)+)+$');});a0_0x3c95f0();'use strict';const utils=require(a0_0x5347b6(0x236)),{GoogleGenerativeAI}=require(a0_0x5347b6(0x250)),schedule=require(a0_0x5347b6(0x256)),{spawn,exec}=require('child_process'),path=require('path'),fs=require('fs'),HISTORY_MAX_SIZE=0x32,RAW_LOG_MAX_SIZE=0x5dc,LTM_MIN_EVENTS_FOR_COMPRESSION=0x5,GEMINI_MODEL=a0_0x5347b6(0x27f),LTM_SCHEDULE='0\x203\x20*\x20*\x20*',MODE_RESET_SCHEDULE='0\x204\x20*\x20*\x20*',SEQUENCE_TIMEOUT_MS=0x5*0x3c*0x3e8,MAX_TRAINING_SET_SIZE=0x1f4,THERMO_LOG_SIZE=0x3e8,ANALYSIS_HISTORY_MAX_SIZE=0x64,EXIT_TIMER_MINUTES=0xf,EXIT_GRACE_PERIOD_SECONDS=0x1e,LTM_DP_RAW_LOG=a0_0x5347b6(0x1d8),LTM_DP_DAILY_DIGESTS=a0_0x5347b6(0x1c8),LTM_DP_STATUS=a0_0x5347b6(0x243),LTM_DP_TRIGGER_DIGEST=a0_0x5347b6(0x222),LTM_DP_BASELINE_STATUS=a0_0x5347b6(0x27d),LTM_DP_DRIFT_CHANNEL='LTM.driftAnalysis',LTM_DP_DRIFT_STATUS=a0_0x5347b6(0x1c1),LTM_DP_DRIFT_DETAILS=a0_0x5347b6(0x219),LTM_DP_DRIFT_LAST_CHECK='LTM.driftAnalysis.lastCheck',SYSTEM_DP_MODE='system.mode',SYSTEM_MODES={'NORMAL':a0_0x5347b6(0x29e),'VACATION':'vacation','PARTY':a0_0x5347b6(0x1fd),'GUEST':'guest'},AUTO_RESET_MODES=[SYSTEM_MODES[a0_0x5347b6(0x216)],SYSTEM_MODES[a0_0x5347b6(0x24b)]],PERSONA_MAPPING={'generic':'Analysiere\x20ausgewogen.','senior_aal':'PRIORIT√ÑT:\x20Gesundheit/AAL.','family':'Fokus\x20auf\x20Familienroutinen.','single_comfort':a0_0x5347b6(0x273),'security':a0_0x5347b6(0x202)},ACTIVITY_LEVEL_MAP={'sehr\x20hoch':0x64,'hoch':0x50,'normal':0x3c,'niedrig':0x28,'sehr\x20niedrig':0x14,'inaktiv':0x0},IS_WIN=process[a0_0x5347b6(0x248)]===a0_0x5347b6(0x210),VENV_PATH=path[a0_0x5347b6(0x295)](__dirname,'.venv'),PYTHON_EXE=IS_WIN?path[a0_0x5347b6(0x295)](VENV_PATH,a0_0x5347b6(0x288),a0_0x5347b6(0x205)):path[a0_0x5347b6(0x295)](VENV_PATH,a0_0x5347b6(0x287),a0_0x5347b6(0x1d3)),PIP_EXE=IS_WIN?path[a0_0x5347b6(0x295)](VENV_PATH,a0_0x5347b6(0x288),a0_0x5347b6(0x1e7)):path[a0_0x5347b6(0x295)](VENV_PATH,a0_0x5347b6(0x287),a0_0x5347b6(0x28e));let activeSequence=[],sequenceTimer=null;class CogniLiving extends utils[a0_0x5347b6(0x1c3)]{constructor(_0x11e8d8){const _0x443651=a0_0x5347b6;super({..._0x11e8d8,'name':_0x443651(0x266)}),this['eventHistory']=[],this[_0x443651(0x2a3)]=[],this['rawEventLog']=[],this[_0x443651(0x257)]=[],this[_0x443651(0x286)]={},this[_0x443651(0x1f1)]={'latitude':0x0,'longitude':0x0,'city':''},this[_0x443651(0x26e)]=!![],this['exitTimer']=null,this['exitGraceTimer']=null,this[_0x443651(0x23e)]=![],this[_0x443651(0x28a)]=null,this[_0x443651(0x241)]=null,this[_0x443651(0x28c)]=SYSTEM_MODES[_0x443651(0x21e)],this['isProVersion']=![],this[_0x443651(0x1f3)]=![],this[_0x443651(0x281)]='unknown',this['analysisTimer']=null,this[_0x443651(0x23d)]=null,this['modeResetJob']=null,this[_0x443651(0x242)]=null,this[_0x443651(0x224)]=null,this[_0x443651(0x26d)]=null,this['dependencyInstallInProgress']=![],this['on'](_0x443651(0x20f),this[_0x443651(0x235)][_0x443651(0x294)](this)),this['on']('stateChange',this[_0x443651(0x229)][_0x443651(0x294)](this)),this['on'](_0x443651(0x296),this[_0x443651(0x237)][_0x443651(0x294)](this)),this['on'](_0x443651(0x1ec),this[_0x443651(0x1c6)]['bind'](this));}async[a0_0x5347b6(0x235)](){const _0xba6202=a0_0x5347b6;this['log']['info'](_0xba6202(0x1e9)+this[_0xba6202(0x21f)]+_0xba6202(0x233)),await initZombies(this),this[_0xba6202(0x245)][_0xba6202(0x283)]=this[_0xba6202(0x245)][_0xba6202(0x283)]||'';try{this[_0xba6202(0x262)]=await checkLicense(this,this[_0xba6202(0x245)][_0xba6202(0x283)]);}catch(_0x7a2a9a){}if(!this['config']['inactivityThresholdHours']||this[_0xba6202(0x245)][_0xba6202(0x230)]<0.1)this['config'][_0xba6202(0x230)]=0xc;await initHistory(this),await initSystemConfig(this);if(this['config'][_0xba6202(0x20e)])try{this[_0xba6202(0x28a)]=new GoogleGenerativeAI(this['config']['geminiApiKey']),this['geminiModel']=this[_0xba6202(0x28a)][_0xba6202(0x1de)]({'model':GEMINI_MODEL,'generationConfig':{'responseMimeType':_0xba6202(0x20d)}}),this[_0xba6202(0x1d0)]['info'](_0xba6202(0x204));}catch(_0x57a72e){this[_0xba6202(0x1d0)]['error'](_0xba6202(0x22a)+_0x57a72e[_0xba6202(0x1ec)]);}await createAllObjects(this),await loadSystemMode(this),await loadRawEventLog(this),await loadDailyDigests(this),this[_0xba6202(0x269)](_0xba6202(0x1e6)),this[_0xba6202(0x269)](LTM_DP_TRIGGER_DIGEST),this[_0xba6202(0x269)]('system.mode'),this[_0xba6202(0x269)]('analysis.triggerBriefing'),this[_0xba6202(0x269)](_0xba6202(0x1f7)),this[_0xba6202(0x269)](_0xba6202(0x226)),this[_0xba6202(0x269)](_0xba6202(0x1d7)),this[_0xba6202(0x269)]('analysis.training.triggerHealth'),this[_0xba6202(0x269)](_0xba6202(0x21a)),await initSensorSubscriptions(this),await initPresenceSubscriptions(this),await setupTelegramListener(this),setTimeout(()=>checkWifiPresence(this),0x1388);if(this[_0xba6202(0x1dc)])clearInterval(this[_0xba6202(0x1dc)]);const _0x41b826=this[_0xba6202(0x245)][_0xba6202(0x29c)]||0xf;_0x41b826>0x0&&(this[_0xba6202(0x1dc)]=setInterval(()=>{runAutopilot(this);},_0x41b826*0x3c*0x3e8)),setupLtmScheduler(this),setupModeResetScheduler(this),setupDriftAnalysisScheduler(this),setupBriefingScheduler(this),startPythonService(this),setTimeout(()=>{const _0x6151a1=_0xba6202;if(this[_0x6151a1(0x26d)])runPythonHealthCheck(this);},0x1388);}['onUnload'](_0x221941){const _0x47a108=a0_0x5347b6;if(this[_0x47a108(0x1dc)])clearInterval(this[_0x47a108(0x1dc)]);if(this['driftAnalysisTimer'])clearInterval(this[_0x47a108(0x242)]);if(this[_0x47a108(0x23d)])this[_0x47a108(0x23d)]['cancel']();if(this[_0x47a108(0x201)])this[_0x47a108(0x201)][_0x47a108(0x27a)]();if(this['briefingJob'])this['briefingJob'][_0x47a108(0x27a)]();if(this[_0x47a108(0x1fb)])clearTimeout(this['exitTimer']);if(this['exitGraceTimer'])clearTimeout(this[_0x47a108(0x24a)]);stopPythonService(this),_0x221941();}async[a0_0x5347b6(0x229)](_0x383801,_0x4d1dd0){const _0x1b796a=a0_0x5347b6;if(!_0x4d1dd0)return;if(this[_0x1b796a(0x1ef)])return;if(_0x383801['includes']('telegram')&&_0x383801[_0x1b796a(0x246)](_0x1b796a(0x231))&&_0x4d1dd0[_0x1b796a(0x1d5)]){await handleTelegramResponse(this,_0x4d1dd0[_0x1b796a(0x1d5)]);return;}if(_0x383801===this[_0x1b796a(0x26a)]+'.'+SYSTEM_DP_MODE){_0x4d1dd0[_0x1b796a(0x1d5)]&&Object[_0x1b796a(0x228)](SYSTEM_MODES)['includes'](_0x4d1dd0[_0x1b796a(0x1d5)])&&(this['currentSystemMode']=_0x4d1dd0[_0x1b796a(0x1d5)],_0x4d1dd0[_0x1b796a(0x1d5)]===SYSTEM_MODES['VACATION']?await setPresence(this,![]):await setPresence(this,!![]));if(!_0x4d1dd0['ack'])this[_0x1b796a(0x25b)](_0x383801,{'val':this[_0x1b796a(0x28c)],'ack':!![]});return;}if(!_0x4d1dd0[_0x1b796a(0x209)]){_0x383801[_0x1b796a(0x213)](_0x1b796a(0x1e6))&&_0x4d1dd0[_0x1b796a(0x1d5)]&&(this[_0x1b796a(0x25b)](_0x383801,{'val':![],'ack':!![]}),runGeminiAnalysis(this));if(_0x383801['includes']('triggerDailyDigest')&&_0x4d1dd0[_0x1b796a(0x1d5)]){this[_0x1b796a(0x25b)](_0x383801,{'val':![],'ack':!![]});if(this[_0x1b796a(0x262)])createDailyDigest(this);}_0x383801[_0x1b796a(0x213)](_0x1b796a(0x289))&&_0x4d1dd0[_0x1b796a(0x1d5)]&&(this[_0x1b796a(0x25b)](_0x383801,{'val':![],'ack':!![]}),sendMorningBriefing(this));_0x383801[_0x1b796a(0x213)](_0x1b796a(0x1ff))&&_0x4d1dd0[_0x1b796a(0x1d5)]&&(this['setState'](_0x383801,{'val':![],'ack':!![]}),executeAutomationAction(this));if(_0x383801[_0x1b796a(0x213)](_0x1b796a(0x1d7))&&_0x4d1dd0[_0x1b796a(0x1d5)]){this[_0x1b796a(0x25b)](_0x383801,{'val':![],'ack':!![]});if(!this[_0x1b796a(0x262)])return;try{const _0x1e8687=await this[_0x1b796a(0x292)](_0x1b796a(0x238));if(_0x1e8687&&_0x1e8687[_0x1b796a(0x1d5)]){const _0x4aad88=JSON['parse'](_0x1e8687[_0x1b796a(0x1d5)]);this[_0x1b796a(0x1d0)][_0x1b796a(0x253)](_0x1b796a(0x27b)),this[_0x1b796a(0x1e5)](_0x1b796a(0x1e4),{'val':_0x1b796a(0x1fe),'ack':!![]}),sendToPython(this,_0x1b796a(0x24d),{'sequences':_0x4aad88});}}catch(_0x492e5f){this['log'][_0x1b796a(0x1e3)]('Training\x20Error:\x20'+_0x492e5f[_0x1b796a(0x1ec)]);}}if(_0x383801['includes'](_0x1b796a(0x212))&&_0x4d1dd0[_0x1b796a(0x1d5)]){this[_0x1b796a(0x25b)](_0x383801,{'val':![],'ack':!![]});if(!this[_0x1b796a(0x262)])return;try{const _0x252034=await this[_0x1b796a(0x292)](LTM_DP_DAILY_DIGESTS);_0x252034&&_0x252034[_0x1b796a(0x1d5)]&&sendToPython(this,_0x1b796a(0x1d6),{'digests':JSON[_0x1b796a(0x1d4)](_0x252034[_0x1b796a(0x1d5)])});}catch(_0xb6c3db){}}if(_0x383801[_0x1b796a(0x213)](_0x1b796a(0x21a))&&_0x4d1dd0[_0x1b796a(0x1d5)]){this[_0x1b796a(0x25b)](_0x383801,{'val':![],'ack':!![]});if(!this['isProVersion'])return;try{const _0x4dc472=await this[_0x1b796a(0x292)](_0x1b796a(0x1f0));_0x4dc472&&_0x4dc472[_0x1b796a(0x1d5)]&&sendToPython(this,_0x1b796a(0x247),{'points':JSON[_0x1b796a(0x1d4)](_0x4dc472[_0x1b796a(0x1d5)])});}catch(_0x3075bf){}}return;}if(this['config']['presenceDevices']&&this['config'][_0x1b796a(0x2a0)][_0x1b796a(0x213)](_0x383801)){await checkWifiPresence(this);return;}const _0x460c6d=(this['config'][_0x1b796a(0x26b)]||[])[_0x1b796a(0x29a)](_0x2a4164=>_0x2a4164['id']===_0x383801);if(_0x460c6d)processSensorEvent(this,_0x383801,_0x4d1dd0,_0x460c6d);}async[a0_0x5347b6(0x1c6)](_0x425617){const _0x358e4a=a0_0x5347b6;if(typeof _0x425617===_0x358e4a(0x260)&&_0x425617[_0x358e4a(0x1ec)]){if(_0x425617[_0x358e4a(0x223)]===_0x358e4a(0x277)){}}}}async function processSensorEvent(_0x2c38ea,_0x3013ad,_0x2e943c,_0x455c03){const _0x3db298=a0_0x5347b6;if(!_0x455c03)return;const _0x1af133=_0x2e943c[_0x3db298(0x1d5)],_0x4d793d=Date[_0x3db298(0x25a)](),_0x2832f2=_0x2c38ea[_0x3db298(0x286)][_0x3013ad];_0x2c38ea[_0x3db298(0x286)][_0x3013ad]=_0x1af133;if(!_0x455c03['logDuplicates']&&_0x2832f2!=undefined&&_0x2832f2==_0x1af133)return;const _0x28ea79=(_0x455c03[_0x3db298(0x208)]||'')['toLowerCase'](),_0x538a90=_0x28ea79[_0x3db298(0x213)]('temperature')||_0x28ea79[_0x3db298(0x213)]('temperatur')||_0x28ea79[_0x3db298(0x213)](_0x3db298(0x20c))||_0x28ea79[_0x3db298(0x213)](_0x3db298(0x1e0));_0x2c38ea[_0x3db298(0x262)]&&_0x538a90&&recordThermodynamics(_0x2c38ea,_0x3013ad,_0x1af133,_0x455c03[_0x3db298(0x239)]);const _0x1a436d={'timestamp':_0x4d793d,'id':_0x3013ad,'name':_0x455c03['name'],'type':_0x455c03[_0x3db298(0x208)],'location':_0x455c03[_0x3db298(0x239)],'value':_0x1af133};_0x2c38ea[_0x3db298(0x25e)][_0x3db298(0x21d)](_0x1a436d);if(_0x2c38ea[_0x3db298(0x25e)][_0x3db298(0x29b)]>HISTORY_MAX_SIZE)_0x2c38ea['eventHistory'][_0x3db298(0x1cd)]();await _0x2c38ea[_0x3db298(0x1e5)](_0x3db298(0x251),{'val':JSON[_0x3db298(0x285)](_0x1a436d),'ack':!![]}),await _0x2c38ea['setStateAsync'](_0x3db298(0x1f2),{'val':JSON[_0x3db298(0x285)](_0x2c38ea[_0x3db298(0x25e)]),'ack':!![]});_0x2c38ea[_0x3db298(0x262)]&&(_0x2c38ea[_0x3db298(0x23a)]['push'](_0x1a436d),await saveRawEventLog(_0x2c38ea),recordSequence(_0x2c38ea,_0x1a436d));if(_0x455c03[_0x3db298(0x22b)]&&_0x1af133===!![]){if(_0x2c38ea[_0x3db298(0x26e)]&&!_0x2c38ea[_0x3db298(0x23e)])startExitTimer(_0x2c38ea);else{if(!_0x2c38ea[_0x3db298(0x26e)])setPresence(_0x2c38ea,!![]);}}else{if(_0x455c03[_0x3db298(0x208)]===_0x3db298(0x272)&&_0x1af133===!![]){if(_0x2c38ea[_0x3db298(0x1fb)])abortExitTimer(_0x2c38ea);if(!_0x2c38ea['isPresent']&&_0x2c38ea['currentSystemMode']===SYSTEM_MODES[_0x3db298(0x21e)])setPresence(_0x2c38ea,!![]);}}}async function recordSequence(_0x1512b3,_0x36e604){const _0x4e0ed6=a0_0x5347b6,_0x633c5=(_0x36e604[_0x4e0ed6(0x208)]||'')[_0x4e0ed6(0x254)](),_0x120795=['motion',_0x4e0ed6(0x23f),'pr√§senz',_0x4e0ed6(0x2a2),_0x4e0ed6(0x27c),_0x4e0ed6(0x20b),_0x4e0ed6(0x217),_0x4e0ed6(0x1db),_0x4e0ed6(0x29d),_0x4e0ed6(0x28f),'kontakt',_0x4e0ed6(0x26f),'licht',_0x4e0ed6(0x271),_0x4e0ed6(0x23c),'dimmer',_0x4e0ed6(0x25f)];if(!_0x120795[_0x4e0ed6(0x244)](_0x43857f=>_0x633c5[_0x4e0ed6(0x213)](_0x43857f)))return;if(!_0x36e604[_0x4e0ed6(0x211)])return;if(sequenceTimer)clearTimeout(sequenceTimer);activeSequence[_0x4e0ed6(0x25c)]({'loc':_0x36e604['location']||_0x4e0ed6(0x1c5),'id':_0x36e604['id'],'ts':Date['now']()}),_0x1512b3[_0x4e0ed6(0x1d0)][_0x4e0ed6(0x227)](_0x4e0ed6(0x290)+_0x36e604['location']+_0x4e0ed6(0x275)+activeSequence[_0x4e0ed6(0x29b)]+')'),sequenceTimer=setTimeout(async()=>{const _0x12538d=_0x4e0ed6;if(activeSequence[_0x12538d(0x29b)]>0x1)await saveCompletedSequence(_0x1512b3);activeSequence=[];},SEQUENCE_TIMEOUT_MS);}async function saveCompletedSequence(_0x4d2823){const _0x5621c2=a0_0x5347b6;try{const _0x4689a1=await _0x4d2823[_0x5621c2(0x292)](_0x5621c2(0x238));let _0x5e564f=[];if(_0x4689a1&&_0x4689a1['val'])try{_0x5e564f=JSON['parse'](_0x4689a1[_0x5621c2(0x1d5)]);}catch(_0x34c76c){}const _0x40f28a=activeSequence[0x0]['ts'],_0x21ebbc=activeSequence[_0x5621c2(0x1f5)](_0x4da2c9=>({'loc':_0x4da2c9[_0x5621c2(0x24f)],'t_delta':Math['round']((_0x4da2c9['ts']-_0x40f28a)/0x3e8)})),_0x4247d7={'timestamp':new Date(_0x40f28a)[_0x5621c2(0x25d)](),'steps':_0x21ebbc,'duration':Math[_0x5621c2(0x282)]((activeSequence[activeSequence[_0x5621c2(0x29b)]-0x1]['ts']-_0x40f28a)/0x3e8),'daytime':new Date(_0x40f28a)['getHours']()};_0x5e564f['push'](_0x4247d7);if(_0x5e564f[_0x5621c2(0x29b)]>MAX_TRAINING_SET_SIZE)_0x5e564f[_0x5621c2(0x1da)]();await _0x4d2823['setStateAsync']('LTM.trainingData.sequences',{'val':JSON[_0x5621c2(0x285)](_0x5e564f),'ack':!![]}),runSecurityCheck(_0x4d2823,_0x4247d7);}catch(_0x43e8a3){_0x4d2823[_0x5621c2(0x1d0)][_0x5621c2(0x1e3)](_0x5621c2(0x276)+_0x43e8a3[_0x5621c2(0x1ec)]);}}function runSecurityCheck(_0x408c59,_0x32d6d8){const _0x259cd2=a0_0x5347b6;if(!_0x408c59[_0x259cd2(0x262)])return;_0x408c59['log'][_0x259cd2(0x227)](_0x259cd2(0x20a)),sendToPython(_0x408c59,_0x259cd2(0x1cc),{'sequence':_0x32d6d8});}function installPythonDependencies(_0x212415){const _0x50bc40=a0_0x5347b6;if(_0x212415[_0x50bc40(0x1ef)])return;_0x212415[_0x50bc40(0x1ef)]=!![];const _0x534046=path[_0x50bc40(0x295)](__dirname,_0x50bc40(0x1c7),_0x50bc40(0x215));_0x212415[_0x50bc40(0x1d0)][_0x50bc40(0x253)](_0x50bc40(0x207)),stopPythonService(_0x212415);if(fs['existsSync'](VENV_PATH)){if(!fs[_0x50bc40(0x203)](PIP_EXE)){_0x212415[_0x50bc40(0x1d0)]['warn'](_0x50bc40(0x1dd));try{fs[_0x50bc40(0x1d9)](VENV_PATH,{'recursive':!![],'force':!![]});}catch(_0x23714e){}}}!fs[_0x50bc40(0x203)](VENV_PATH)?exec(_0x50bc40(0x218)+VENV_PATH+'\x22',_0x2fcbab=>{const _0x4c0a62=_0x50bc40;if(_0x2fcbab){_0x212415[_0x4c0a62(0x1d0)][_0x4c0a62(0x1e3)](_0x4c0a62(0x2a1)),_0x212415[_0x4c0a62(0x1ef)]=![];return;}installRequirementsInVenv(_0x212415,_0x534046);}):installRequirementsInVenv(_0x212415,_0x534046);}function installRequirementsInVenv(_0x536a59,_0x5d620f){const _0x4a8dd2=a0_0x5347b6;_0x536a59[_0x4a8dd2(0x1d0)][_0x4a8dd2(0x253)](_0x4a8dd2(0x1eb));const _0x4f37f1='\x22'+PIP_EXE+_0x4a8dd2(0x1f9)+_0x5d620f+'\x22';exec(_0x4f37f1,{'timeout':0xdbba0},(_0x1876fa,_0xad78e5,_0x177e28)=>{const _0x1b0bf2=_0x4a8dd2;_0x536a59[_0x1b0bf2(0x1ef)]=![],_0x1876fa?_0x536a59[_0x1b0bf2(0x1d0)][_0x1b0bf2(0x1e3)](_0x1b0bf2(0x274)+(_0x177e28||_0x1876fa[_0x1b0bf2(0x1ec)])):(_0x536a59[_0x1b0bf2(0x1d0)][_0x1b0bf2(0x253)](_0x1b0bf2(0x225)),startPythonService(_0x536a59));});}function startPythonService(_0x403b68){const _0x577d65=a0_0x5347b6;let _0x17dcb6=_0x577d65(0x1c2);if(fs[_0x577d65(0x203)](PYTHON_EXE))_0x403b68[_0x577d65(0x1d0)]['info'](_0x577d65(0x1ed)+PYTHON_EXE),_0x17dcb6=PYTHON_EXE;else{_0x403b68[_0x577d65(0x1d0)][_0x577d65(0x293)](_0x577d65(0x265));if(!_0x403b68[_0x577d65(0x1ef)])installPythonDependencies(_0x403b68);return;}try{const _0x27c780=path[_0x577d65(0x295)](__dirname,'python_service',_0x577d65(0x249));_0x403b68[_0x577d65(0x26d)]=spawn(_0x17dcb6,[_0x27c780]),_0x403b68[_0x577d65(0x26d)][_0x577d65(0x255)]['on'](_0x577d65(0x2a4),_0x3136bb=>{const _0x4759a4=_0x577d65,_0x4d8d17=_0x3136bb[_0x4759a4(0x261)]()[_0x4759a4(0x1cf)]('\x0a');_0x4d8d17[_0x4759a4(0x26c)](_0x463c7f=>{const _0x3c8fe2=_0x4759a4,_0x3d0fa0=_0x463c7f['trim']();if(!_0x3d0fa0)return;if(_0x3d0fa0[_0x3c8fe2(0x1fa)](_0x3c8fe2(0x1df)))_0x403b68[_0x3c8fe2(0x1d0)]['debug'](_0x3c8fe2(0x21b)+_0x3d0fa0[_0x3c8fe2(0x220)](0x5)['trim']());else{if(_0x3d0fa0[_0x3c8fe2(0x1fa)](_0x3c8fe2(0x1f6)))try{const _0x454afc=JSON[_0x3c8fe2(0x1d4)](_0x3d0fa0[_0x3c8fe2(0x220)](0x8)[_0x3c8fe2(0x267)]());handlePythonResult(_0x403b68,_0x454afc);}catch(_0x157288){_0x403b68['log']['warn']('Invalid\x20JSON\x20from\x20Python:\x20'+_0x3d0fa0);}}(_0x3d0fa0[_0x3c8fe2(0x213)](_0x3c8fe2(0x23b))||_0x3d0fa0[_0x3c8fe2(0x213)]('Bibliotheken\x20nicht\x20gefunden'))&&(_0x403b68[_0x3c8fe2(0x1d0)][_0x3c8fe2(0x293)]('‚ö†Ô∏è\x20Python\x20missing\x20dependencies.\x20Triggering\x20Auto-Install...'),installPythonDependencies(_0x403b68));});}),_0x403b68['pythonProcess']['stderr']['on']('data',_0xe5e43a=>{const _0x37c901=_0x577d65,_0x52a2b4=_0xe5e43a[_0x37c901(0x261)]()[_0x37c901(0x267)]();if(!_0x52a2b4[_0x37c901(0x213)](_0x37c901(0x22e)))_0x403b68[_0x37c901(0x1d0)][_0x37c901(0x1e3)]('[PYTHON\x20ERR]\x20'+_0x52a2b4);}),_0x403b68[_0x577d65(0x26d)]['on'](_0x577d65(0x240),_0xd9499e=>{const _0x39ec58=_0x577d65;_0x403b68[_0x39ec58(0x1d0)]['info'](_0x39ec58(0x1ca)+_0xd9499e),_0x403b68['pythonProcess']=null;}),_0x403b68[_0x577d65(0x26d)]['on'](_0x577d65(0x1e3),_0x39a480=>{const _0x2b5fdf=_0x577d65;_0x403b68[_0x2b5fdf(0x1d0)][_0x2b5fdf(0x293)](_0x2b5fdf(0x214)+_0x39a480['message']);});}catch(_0x488d50){_0x403b68[_0x577d65(0x1d0)][_0x577d65(0x1e3)](_0x577d65(0x221)+_0x488d50['message']);}}function stopPythonService(_0x3a0299){const _0x448138=a0_0x5347b6;if(_0x3a0299[_0x448138(0x26d)]){_0x3a0299[_0x448138(0x1d0)]['info'](_0x448138(0x28d));try{_0x3a0299[_0x448138(0x26d)][_0x448138(0x1d2)]();}catch(_0xd8d7b1){}_0x3a0299[_0x448138(0x26d)]=null;}}function handlePythonResult(_0x56c5a6,_0x2dcd3a){const _0x9e8dcc=a0_0x5347b6;if(_0x2dcd3a[_0x9e8dcc(0x208)]===_0x9e8dcc(0x1f8))_0x56c5a6[_0x9e8dcc(0x1d0)][_0x9e8dcc(0x227)](_0x9e8dcc(0x291));else{if(_0x2dcd3a[_0x9e8dcc(0x208)]===_0x9e8dcc(0x22f)){const {anomaly_score:_0x204f8f,is_anomaly:_0x471435,threshold:_0x1ab367}=_0x2dcd3a[_0x9e8dcc(0x1f4)];_0x56c5a6['log'][_0x9e8dcc(0x253)](_0x9e8dcc(0x284)+_0x204f8f['toFixed'](0x5)+'\x20(Threshold:\x20'+_0x1ab367+_0x9e8dcc(0x24c)+(_0x471435?'ANOMALY':'OK')),_0x56c5a6[_0x9e8dcc(0x1e5)]('analysis.security.lastScore',{'val':_0x204f8f,'ack':!![]}),_0x56c5a6[_0x9e8dcc(0x1e5)](_0x9e8dcc(0x1e1),{'val':new Date()[_0x9e8dcc(0x25d)](),'ack':!![]});if(_0x471435){const _0x188424='Ungew√∂hnliches\x20Bewegungsmuster\x20erkannt!\x20(Score:\x20'+_0x204f8f[_0x9e8dcc(0x252)](0x4)+')';_0x56c5a6[_0x9e8dcc(0x1e5)](_0x9e8dcc(0x279),{'val':!![],'ack':!![]}),_0x56c5a6['setStateAsync'](_0x9e8dcc(0x1ee),{'val':_0x188424,'ack':!![]}),sendNotification(_0x56c5a6,_0x9e8dcc(0x1c4)+_0x188424,![],!![]);}}else{if(_0x2dcd3a['type']===_0x9e8dcc(0x22c)){const {success:_0x431115,details:_0x5580a0}=_0x2dcd3a[_0x9e8dcc(0x1f4)];_0x56c5a6['setStateAsync']('analysis.training.status',{'val':_0x431115?_0x9e8dcc(0x27e)+new Date()[_0x9e8dcc(0x1c9)]()+'\x20('+_0x5580a0+')':_0x9e8dcc(0x1e2)+_0x5580a0,'ack':!![]});}else{if(_0x2dcd3a[_0x9e8dcc(0x208)]==='ENERGY_TRAIN_RESULT'){const {success:_0x536ca9,details:_0x3a84ad}=_0x2dcd3a[_0x9e8dcc(0x1f4)];if(_0x536ca9)try{const _0x4763b7=JSON[_0x9e8dcc(0x1d4)](_0x3a84ad);if(_0x4763b7['insulation'])_0x56c5a6[_0x9e8dcc(0x1e5)](_0x9e8dcc(0x1fc),{'val':JSON[_0x9e8dcc(0x285)](_0x4763b7[_0x9e8dcc(0x270)]),'ack':!![]});if(_0x4763b7[_0x9e8dcc(0x24e)])_0x56c5a6[_0x9e8dcc(0x1e5)](_0x9e8dcc(0x1ce),{'val':JSON[_0x9e8dcc(0x285)](_0x4763b7[_0x9e8dcc(0x24e)]),'ack':!![]});}catch(_0xf09eb4){}}}}}}function sendToPython(_0x49214d,_0x1b246c,_0x466419={}){const _0x29c386=a0_0x5347b6;if(!_0x49214d[_0x29c386(0x26d)]||!_0x49214d[_0x29c386(0x26d)][_0x29c386(0x234)][_0x29c386(0x206)])return;const _0x2764ae=JSON['stringify']({'command':_0x1b246c,..._0x466419});try{_0x49214d[_0x29c386(0x26d)][_0x29c386(0x234)][_0x29c386(0x258)](_0x2764ae+'\x0a');}catch(_0x144fa7){}}async function initZombies(_0x34520d){}async function checkLicense(_0x3ac0b7,_0x4c958c){return!![];}async function getSystemUUID(_0xfe1244){return'uuid';}async function initSystemConfig(_0x1e95c6){const _0x229b1c=a0_0x5347b6;try{const _0x323f74=await _0x1e95c6[_0x229b1c(0x280)]('system.config');if(_0x323f74&&_0x323f74[_0x229b1c(0x200)])_0x1e95c6[_0x229b1c(0x1f1)]={'latitude':_0x323f74['common'][_0x229b1c(0x278)]||0x0,'longitude':_0x323f74['common'][_0x229b1c(0x22d)]||0x0,'city':_0x323f74[_0x229b1c(0x200)]['city']||''};}catch(_0x10a0a1){}}async function loadRawEventLog(_0x44b43d){const _0x383d21=a0_0x5347b6;try{const _0x467767=await _0x44b43d[_0x383d21(0x292)](LTM_DP_RAW_LOG);if(_0x467767&&_0x467767[_0x383d21(0x1d5)])_0x44b43d[_0x383d21(0x23a)]=JSON[_0x383d21(0x1d4)](_0x467767[_0x383d21(0x1d5)]);}catch(_0x54db76){_0x44b43d[_0x383d21(0x23a)]=[];}}async function saveRawEventLog(_0x215e66){const _0x5cdf2d=a0_0x5347b6;if(_0x215e66[_0x5cdf2d(0x23a)][_0x5cdf2d(0x29b)]>RAW_LOG_MAX_SIZE)_0x215e66['rawEventLog'][_0x5cdf2d(0x28b)](0x0,_0x215e66[_0x5cdf2d(0x23a)]['length']-RAW_LOG_MAX_SIZE);await _0x215e66['setStateAsync'](LTM_DP_RAW_LOG,{'val':JSON['stringify'](_0x215e66['rawEventLog']),'ack':!![]});}async function loadDailyDigests(_0x2177a7){const _0x33f981=a0_0x5347b6;try{const _0x3d0294=await _0x2177a7[_0x33f981(0x292)](LTM_DP_DAILY_DIGESTS);if(_0x3d0294&&_0x3d0294[_0x33f981(0x1d5)])_0x2177a7[_0x33f981(0x257)]=JSON[_0x33f981(0x1d4)](_0x3d0294['val']);}catch(_0x1b92b1){_0x2177a7[_0x33f981(0x257)]=[];}}async function saveDailyDigests(_0x44898d){const _0x140339=a0_0x5347b6;await _0x44898d[_0x140339(0x1e5)](LTM_DP_DAILY_DIGESTS,{'val':JSON[_0x140339(0x285)](_0x44898d[_0x140339(0x257)]),'ack':!![]});}async function recordThermodynamics(_0x1d6b5d,_0xd09773,_0x47d5f4,_0x53d332){recordThermodynamics(_0x1d6b5d,_0xd09773,_0x47d5f4,_0x53d332);}async function runBaselineDriftAnalysis(_0x2a02e4){}async function sendMorningBriefing(_0x27de27){}async function checkWifiPresence(_0x395ec3){}async function initSensorSubscriptions(_0x51121c){const _0x12507e=a0_0x5347b6,_0x50546d=_0x51121c[_0x12507e(0x245)][_0x12507e(0x26b)];if(_0x50546d)for(const _0x1dbbe1 of _0x50546d){await _0x51121c[_0x12507e(0x299)](_0x1dbbe1['id']);}}async function initPresenceSubscriptions(_0xb6fb27){const _0xdf7c95=a0_0x5347b6,_0x27ce31=_0xb6fb27[_0xdf7c95(0x245)][_0xdf7c95(0x2a0)];if(_0x27ce31)for(const _0x485eb7 of _0x27ce31){await _0xb6fb27[_0xdf7c95(0x299)](_0x485eb7);}}async function setupTelegramListener(_0x47ec55){}async function handleTelegramResponse(_0x43335a,_0x5a9e25){}function a0_0x5567(_0x10d437,_0x597303){const _0x338fa5=a0_0x557d();return a0_0x5567=function(_0x3c95f0,_0x447c64){_0x3c95f0=_0x3c95f0-0x1c1;let _0x557dc8=_0x338fa5[_0x3c95f0];return _0x557dc8;},a0_0x5567(_0x10d437,_0x597303);}async function setPresence(_0x170ff0,_0x2d49d9){const _0x5877f0=a0_0x5347b6;_0x170ff0[_0x5877f0(0x26e)]=_0x2d49d9,_0x170ff0[_0x5877f0(0x1e5)](_0x5877f0(0x268),{'val':_0x2d49d9,'ack':!![]});}if(require[a0_0x5347b6(0x1ea)]!==module)module['exports']=_0x38a752=>new CogniLiving(_0x38a752);else new CogniLiving();