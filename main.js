function a0_0x4d04(_0x32243f,_0x3ad1ae){const _0x31858f=a0_0x4136();return a0_0x4d04=function(_0x400f3d,_0x569420){_0x400f3d=_0x400f3d-0x79;let _0x4136fa=_0x31858f[_0x400f3d];return _0x4136fa;},a0_0x4d04(_0x32243f,_0x3ad1ae);}const a0_0x4a3f45=a0_0x4d04;(function(_0x1e3418,_0x3678ec){const _0x5200c1=a0_0x4d04,_0xfe90e3=_0x1e3418();while(!![]){try{const _0x564b61=parseInt(_0x5200c1(0x1aa))/0x1+-parseInt(_0x5200c1(0x139))/0x2+-parseInt(_0x5200c1(0xb4))/0x3+-parseInt(_0x5200c1(0x102))/0x4*(-parseInt(_0x5200c1(0xa1))/0x5)+-parseInt(_0x5200c1(0xd9))/0x6+parseInt(_0x5200c1(0xf5))/0x7+-parseInt(_0x5200c1(0x185))/0x8*(-parseInt(_0x5200c1(0xc4))/0x9);if(_0x564b61===_0x3678ec)break;else _0xfe90e3['push'](_0xfe90e3['shift']());}catch(_0x18a3e1){_0xfe90e3['push'](_0xfe90e3['shift']());}}}(a0_0x4136,0xd6055));const a0_0x569420=(function(){let _0x2c4a3c=!![];return function(_0x1f8bd7,_0x482848){const _0x1ef341=_0x2c4a3c?function(){const _0x42714c=a0_0x4d04;if(_0x482848){const _0x7fe90a=_0x482848[_0x42714c(0x18a)](_0x1f8bd7,arguments);return _0x482848=null,_0x7fe90a;}}:function(){};return _0x2c4a3c=![],_0x1ef341;};}()),a0_0x400f3d=a0_0x569420(this,function(){const _0x43cbd9=a0_0x4d04;return a0_0x400f3d[_0x43cbd9(0xa3)]()[_0x43cbd9(0x15a)]('(((.+)+)+)+$')[_0x43cbd9(0xa3)]()['constructor'](a0_0x400f3d)[_0x43cbd9(0x15a)](_0x43cbd9(0xc8));});a0_0x400f3d();'use strict';const utils=require(a0_0x4a3f45(0x97)),{GoogleGenerativeAI}=require(a0_0x4a3f45(0x93)),schedule=require(a0_0x4a3f45(0x163)),HISTORY_MAX_SIZE=0x32,FEEDBACK_MAX_SIZE=0x14,GEMINI_MODEL='models/gemini-flash-latest',ANALYSIS_HISTORY_MAX_SIZE=0x64,RAW_LOG_MAX_SIZE=0x5dc,DAILY_DIGEST_MAX_SIZE_LIMIT=0xb4,LTM_MIN_EVENTS_FOR_COMPRESSION=0x5,LTM_SCHEDULE=a0_0x4a3f45(0x18b),LTM_DP_RAW_LOG='LTM.rawEventLog',LTM_DP_DAILY_DIGESTS='LTM.dailyDigests',LTM_DP_STATUS=a0_0x4a3f45(0xad),LTM_DP_TRIGGER_DIGEST=a0_0x4a3f45(0xd2),LTM_DP_BASELINE_STATUS=a0_0x4a3f45(0xda),LTM_DP_DRIFT_CHANNEL=a0_0x4a3f45(0x150),LTM_DP_DRIFT_STATUS=a0_0x4a3f45(0x117),LTM_DP_DRIFT_DETAILS=a0_0x4a3f45(0x18d),LTM_DP_DRIFT_LAST_CHECK=a0_0x4a3f45(0x19f),SYSTEM_DP_MODE=a0_0x4a3f45(0x85),MODE_RESET_SCHEDULE=a0_0x4a3f45(0xee),SYSTEM_MODES={'NORMAL':a0_0x4a3f45(0x133),'VACATION':a0_0x4a3f45(0x14a),'PARTY':a0_0x4a3f45(0xae),'GUEST':a0_0x4a3f45(0x8e)},AUTO_RESET_MODES=[SYSTEM_MODES[a0_0x4a3f45(0x14c)],SYSTEM_MODES['GUEST']],EXIT_TIMER_MINUTES=0xf,EXIT_GRACE_PERIOD_SECONDS=0x1e,PERSONA_MAPPING={'generic':'Analysiere\x20ausgewogen\x20auf\x20Gesundheit,\x20Sicherheit\x20und\x20Komfort.','senior_aal':a0_0x4a3f45(0x14e),'family':a0_0x4a3f45(0x80),'single_comfort':a0_0x4a3f45(0x1a3),'security':'PRIORIT√ÑT:\x20Sicherheit.\x20Erkenne\x20Eindringlinge,\x20ungew√∂hnliche\x20Anwesenheit.'};function a0_0x4136(){const _0x15043d=['onStateChange','.\x20PERSONA:\x20','getEnums','system.config','inactivityMonitoringEnabled','updateAnalysisHistory','loadSystemMode','Last\x20Check','common','\x22\x20was\x20','unload','analysis.trigger','startExitTimer','N/A\x20(Pro\x20Feature)','send','checkSystemObjects','enum','.\x20ORT:\x20','normal','scanForDevices','AI\x20Emergency\x20Status','system.isPresent','notifyWhatsappInstance','Gemini\x20Init\x20Error:\x20','71244oFNIGS','baselineDrift','Subscribing\x20to\x20','analysisTimer','test','cogni-living','loadRawEventLog','feedbackHistory','Event\x20History','Missing\x20data','slice','longitude','online','ltmLtbWindowDays','[TEST]\x20','analysis.alertReason','loadHistoryFromState','vacation','stringify','PARTY','onReady','PRIORIT√ÑT:\x20Gesundheit\x20und\x20Sicherheit\x20f√ºr\x20Senioren\x20(AAL).\x20Erkenne\x20Inaktivit√§t,\x20potenzielle\x20St√ºrze\x20(indirekt),\x20ungew√∂hnliche\x20n√§chtliche\x20Aktivit√§t.','notifyEmailRecipient','LTM.driftAnalysis','presenceDevices','Adapter','\x0a!!!\x20END\x20WARNING\x20!!!\x0a','\x20events','alertReason','isPresent','retry','native','summary','search','ROLLE:\x20Data\x20Scientist.\x20VERGLEICHE:\x20Dataset\x20A\x20(Recent)\x20vs\x20B\x20(Established).\x20ZIEL:\x20Erkenne\x20Drift.\x20SCHEMA:\x20{\x20\x22baselineDrift\x22:\x20\x22none|slight|significant|critical\x22,\x20\x22driftDetails\x22:\x20\x22string\x22\x20}\x0a\x0aB\x20(LTB):\x0a','text','startsWith','ROLLE:\x20Smart\x20Home\x20Analyst.\x20SPRACHE:\x20DE.\x20FORMAT:\x20JSON.\x20\x0a\x20\x20\x20\x20\x20\x20\x20\x20AKTUELLE\x20ZEIT:\x20','length','uuid-not-found','analysis.automation.patternDetected','Trigger\x20Analysis','node-schedule','systemUUID','aiPersona','checkWifiPresence','createDailyDigest','city','saveRawEventLog','Feedback\x20Log','Comfort\x20Suggestion','analysisInterval','isAlert','Last\x20Result','Raw\x20Log','Gast','setupModeResetScheduler','comfort','ltmJob','bind','NORMAL','logDuplicates','catch','System\x20Status\x20&\x20Control','onMessage','from','Urlaub','isEmergency','abortExitTimer','analysis.automation','isProVersion','saveDailyDigests','indicator.alarm.fire','.\x20PR√ÑSENZ:\x20','push','sensorLastValues','445624DQDoEf','notifySignalEnabled','cleanUpZombies','status','geminiApiKey','apply','0\x203\x20*\x20*\x20*','No\x20recorded\x20events\x20yet.','LTM.driftAnalysis.driftDetails','Drift\x20Analysis','command','now','description','notifyTelegramInstance','splice','uuid','find','includes','message','exitGraceTimer','\x20sent','genAI','VACATION','\x20min).\x20Watchdog\x20Limit:\x20','error','info','LTM.driftAnalysis.lastCheck','üö®\x20EMERGENCY','licenseKey','replace','Fokus\x20auf\x20Maximierung\x20von\x20Komfort,\x20Automatisierungseffizienz\x20und\x20Energieeinsparung.','setObjectNotExistsAsync','lastCheck','saveFeedback','analysis.feedbackHistory','setState','cancel','459354SyrWhB','runGeminiAnalysis','system','values','checkLtmDriftObjects','isExit','PRO-','getStateAsync','subscribeForeignStatesAsync','setStateAsync','LTM','notifySignalInstance','trim','generateContent','location','response','Sending\x20notification:\x20\x22','enum.functions.*','analysis.deviationFromBaseline','N/A\x20(Learning)','analysis.isAlert','devices','triggerDailyDigest','Fokus\x20auf\x20Familienroutinen,\x20Kindersicherheit\x20und\x20allgemeines\x20Haushaltsmanagement.','analysis.analysisHistory','loadDailyDigests','analysis.comfortSummary','\x20hours.\x20The\x20resident\x20might\x20be\x20incapacitated.\x20Risk\x20level:\x20HIGH.','system.mode','Processing\x20Status','notifyWhatsappEnabled','Nein','checkLicense','main','Aktiv\x20(','subscribeStates','stateChange','guest','submitFeedback','Description','rating','\x20Tage)','@google/generative-ai','exports','livingContext','getForeignObjectsAsync','@iobroker/adapter-core','scheduleJob','Error:\x20','Drift\x20Details','processSensorEvent','Last\x20raw\x20event','WiFi\x20Presence\x20detected\x20->\x20Aborting\x20Exit\x20Timer.\x20User\x20is\x20present.','GUEST','type','sound','272705naZfxh','toISOString','toString','No\x20Key','suggestedAction','events.lastEvent','isGracePeriodActive','ROLLE:\x20Compression\x20Agent.\x20SPRACHE:\x20DE.\x20FORMAT:\x20JSON.\x20KONTEXT:\x20','Comfort\x20Summary','inactivityThresholdHours','models/gemini-flash-latest','analysis.comfortSuggestion','LTM.processingStatus','party','json','unshift','Action','unknown','object','2974419OUkOFp','runAutopilot','Deaktiviert\x20(Pro-Feature)','de-DE','toLocaleString','dailyDigests','log','TEST-PRO-KEY','eventHistory','setupLtmScheduler','state','boolean','getForeignStateAsync','ack','[Test]\x20Notification','analysis.isEmergency','27WzSbRc','pop','geminiModel','long','(((.+)+)+)+$','analysis.automation.description','N/A\x20(No\x20Activity)','substring','analysis.lastResult','date','timestamp','Cogni-Living\x20Alert','automationProposal','sendToAsync','LTM.triggerDailyDigest','join','Analysis\x20Error:\x20','extendObjectAsync','deviationFromBaseline','channel','number','2234280XuMqaG','LTM.baselineStatus','exitTimer','\x0a\x0aA\x20(STB):\x0a','Automation\x20Proposals','setPresence','notifyEmailInstance','setupDriftAnalysisScheduler','button','namespace','analysisHistory','Alert\x20Reason','CRITICAL\x20WARNING:\x20No\x20sensor\x20activity\x20detected\x20for\x20','currentSystemMode','2-digit','rawEventLog','cogni-living\x20adapter\x20starting\x20(v','\x20sensors...','activityLevel','createAllObjects','‚ö†Ô∏è\x20Alarm','0\x204\x20*\x20*\x20*','config','Skipped\x20(No\x20AI\x20or\x20Data)','Started\x20at\x20','map','systemConfig','lastAlertState','6584256PGZMNe','analysis.activitySummary','indicator','sendTo','driftDetails','N/A','parse','\x20presence\x20devices\x20(WiFi/Network)...','\x0aFEEDBACK:\x0a','AI\x20Alert\x20Status','callback','checkLtmObjects','siren','52XQdWXG','scanDevices','\x20\x0a\x20\x20\x20\x20\x20\x20\x20\x20SCHEMA:\x20{\x20\x22activity\x22:\x20{\x20\x22summary\x22:\x20\x22string\x22,\x20\x22deviationFromBaseline\x22:\x20\x22string\x22,\x20\x22isAlert\x22:\x20bool,\x20\x22isEmergency\x22:\x20bool,\x20\x22alertReason\x22:\x20\x22string\x22\x20},\x20\x22comfort\x22:\x20{\x20\x22summary\x22:\x20\x22string\x22,\x20\x22suggestion\x22:\x20\x22string\x22,\x20\x22automationProposal\x22:\x20{\x20\x22patternDetected\x22:\x20bool,\x20\x22description\x22:\x20\x22string\x22,\x20\x22suggestedAction\x22:\x20\x22string\x22\x20}\x20}\x20}','Lernphase\x20(','updateBaselineStatus','suggestion','minDaysForBaseline','analysis.automation.suggestedAction','getGenerativeModel','notifyPushoverRecipient','modeResetJob','driftAnalysisTimer','name','version','toFixed','Logbook','runBaselineDriftAnalysis','testApiKey','Normal','events.history','activity','LTM.driftAnalysis.baselineDrift','string','notifyTelegramEnabled','Baseline:\x20Inactive\x20(Pro\x20Feature).','User\x20Feedback:\x20Alarm\x20\x22','Party','notifyTelegramRecipient','notifyEmailEnabled','sendNotification','val'];a0_0x4136=function(){return _0x15043d;};return a0_0x4136();}class CogniLiving extends utils[a0_0x4a3f45(0x152)]{constructor(_0x17bad5){const _0x51ed6c=a0_0x4a3f45;super({..._0x17bad5,'name':_0x51ed6c(0x13e)}),this['eventHistory']=[],this[_0x51ed6c(0xe3)]=[],this[_0x51ed6c(0x140)]=[],this[_0x51ed6c(0xe8)]=[],this[_0x51ed6c(0xb9)]=[],this[_0x51ed6c(0x184)]={},this[_0x51ed6c(0xf3)]={'latitude':0x0,'longitude':0x0,'city':''},this[_0x51ed6c(0x156)]=!![],this[_0x51ed6c(0xdb)]=null,this['exitGraceTimer']=null,this[_0x51ed6c(0xa7)]=![],this[_0x51ed6c(0x19a)]=null,this['geminiModel']=null,this['currentSystemMode']=SYSTEM_MODES[_0x51ed6c(0x175)],this[_0x51ed6c(0x17f)]=![],this[_0x51ed6c(0xf4)]=![],this['systemUUID']=_0x51ed6c(0xb2),this[_0x51ed6c(0x13c)]=null,this['ltmJob']=null,this['modeResetJob']=null,this[_0x51ed6c(0x10d)]=null,this['on']('ready',this[_0x51ed6c(0x14d)][_0x51ed6c(0x174)](this)),this['on'](_0x51ed6c(0x8d),this[_0x51ed6c(0x121)]['bind'](this)),this['on'](_0x51ed6c(0x12b),this['onUnload'][_0x51ed6c(0x174)](this)),this['on']('message',this[_0x51ed6c(0x179)]['bind'](this));}async[a0_0x4a3f45(0x14d)](){const _0x12e5b7=a0_0x4a3f45;this['log'][_0x12e5b7(0x19e)](_0x12e5b7(0xe9)+this[_0x12e5b7(0x10f)]+')'),await this[_0x12e5b7(0x187)](),this['config'][_0x12e5b7(0x1a1)]=this[_0x12e5b7(0xef)][_0x12e5b7(0x1a1)]||'',this[_0x12e5b7(0x17f)]=await this[_0x12e5b7(0x89)](this[_0x12e5b7(0xef)][_0x12e5b7(0x1a1)]);if(!this[_0x12e5b7(0xef)][_0x12e5b7(0xaa)]||this[_0x12e5b7(0xef)][_0x12e5b7(0xaa)]<0.1)this[_0x12e5b7(0xef)][_0x12e5b7(0xaa)]=0xc;await this[_0x12e5b7(0x149)]();try{const _0x4a1c06=await this['getForeignObjectAsync'](_0x12e5b7(0x124));_0x4a1c06&&_0x4a1c06[_0x12e5b7(0x129)]&&(this['systemConfig']={'latitude':_0x4a1c06[_0x12e5b7(0x129)]['latitude']||0x0,'longitude':_0x4a1c06[_0x12e5b7(0x129)][_0x12e5b7(0x144)]||0x0,'city':_0x4a1c06[_0x12e5b7(0x129)][_0x12e5b7(0x168)]||''});}catch(_0x41d439){}if(this[_0x12e5b7(0xef)]['geminiApiKey'])try{this[_0x12e5b7(0x19a)]=new GoogleGenerativeAI(this['config'][_0x12e5b7(0x189)]),this[_0x12e5b7(0xc6)]=this[_0x12e5b7(0x19a)][_0x12e5b7(0x10a)]({'model':GEMINI_MODEL,'generationConfig':{'responseMimeType':'application/json'}}),this[_0x12e5b7(0xba)][_0x12e5b7(0x19e)]('Gemini\x20AI\x20initialized.');}catch(_0x3f9a2b){this[_0x12e5b7(0xba)]['error'](_0x12e5b7(0x138)+_0x3f9a2b[_0x12e5b7(0x197)]);}await this[_0x12e5b7(0xec)](),await this[_0x12e5b7(0x127)](),await this[_0x12e5b7(0x13f)](),await this[_0x12e5b7(0x82)](),this[_0x12e5b7(0x8c)](_0x12e5b7(0x12c)),this[_0x12e5b7(0x8c)](LTM_DP_TRIGGER_DIGEST),this[_0x12e5b7(0x8c)](_0x12e5b7(0x85));const _0x527b5f=this[_0x12e5b7(0xef)]['devices'];if(_0x527b5f&&_0x527b5f[_0x12e5b7(0x15f)]>0x0){this[_0x12e5b7(0xba)][_0x12e5b7(0x19e)](_0x12e5b7(0x13b)+_0x527b5f[_0x12e5b7(0x15f)]+_0x12e5b7(0xea));for(const _0x5318a0 of _0x527b5f){if(_0x5318a0['id']){await this[_0x12e5b7(0x1b2)](_0x5318a0['id']);try{const _0x36b39a=await this[_0x12e5b7(0xc0)](_0x5318a0['id']);if(_0x36b39a)this[_0x12e5b7(0x184)][_0x5318a0['id']]=_0x36b39a[_0x12e5b7(0x120)];}catch(_0x4fc749){}}}}const _0x4340a7=this[_0x12e5b7(0xef)][_0x12e5b7(0x151)]||[];if(_0x4340a7['length']>0x0){this['log']['info'](_0x12e5b7(0x13b)+_0x4340a7[_0x12e5b7(0x15f)]+_0x12e5b7(0xfc));for(const _0x8cac21 of _0x4340a7){await this['subscribeForeignStatesAsync'](_0x8cac21);}await this[_0x12e5b7(0x166)]();}if(this[_0x12e5b7(0x13c)])clearInterval(this['analysisTimer']);const _0x2ab678=this['config'][_0x12e5b7(0x16c)]||0xf;_0x2ab678>0x0&&(this[_0x12e5b7(0xba)][_0x12e5b7(0x19e)]('Starting\x20Autopilot\x20('+_0x2ab678+_0x12e5b7(0x19c)+this[_0x12e5b7(0xef)]['inactivityThresholdHours']+'h.'),this[_0x12e5b7(0x13c)]=setInterval(()=>this[_0x12e5b7(0xb5)](),_0x2ab678*0x3c*0x3e8)),this[_0x12e5b7(0xbd)](),this['setupModeResetScheduler'](),this[_0x12e5b7(0xe0)]();}async[a0_0x4a3f45(0x166)](){const _0x192397=a0_0x4a3f45,_0x27a607=this['config']['presenceDevices']||[];let _0x47ef92=![];for(const _0x25e01c of _0x27a607){try{const _0x4210cd=await this[_0x192397(0xc0)](_0x25e01c);if(_0x4210cd&&(_0x4210cd[_0x192397(0x120)]===!![]||_0x4210cd['val']===_0x192397(0x145)||_0x4210cd[_0x192397(0x120)]===0x1)){_0x47ef92=!![];break;}}catch(_0x23e4fd){}}return _0x47ef92&&(this['exitTimer']&&(this[_0x192397(0xba)][_0x192397(0x19e)](_0x192397(0x9d)),this[_0x192397(0x17d)]()),!this[_0x192397(0x156)]&&this[_0x192397(0xe6)]===SYSTEM_MODES[_0x192397(0x175)]&&this[_0x192397(0xde)](!![])),_0x47ef92;}async['onStateChange'](_0xdb9926,_0x2d95e6){const _0x3f6a8d=a0_0x4a3f45;if(!_0x2d95e6)return;if(_0xdb9926===this[_0x3f6a8d(0xe2)]+'.'+SYSTEM_DP_MODE){_0x2d95e6[_0x3f6a8d(0x120)]&&Object['values'](SYSTEM_MODES)[_0x3f6a8d(0x196)](_0x2d95e6[_0x3f6a8d(0x120)])&&(this[_0x3f6a8d(0xe6)]=_0x2d95e6[_0x3f6a8d(0x120)],_0x2d95e6['val']===SYSTEM_MODES[_0x3f6a8d(0x19b)]?this[_0x3f6a8d(0xde)](![]):this['setPresence'](!![]));if(!_0x2d95e6[_0x3f6a8d(0xc1)])this['setState'](_0xdb9926,{'val':this[_0x3f6a8d(0xe6)],'ack':!![]});return;}if(!_0x2d95e6['ack']){_0xdb9926[_0x3f6a8d(0x196)](_0x3f6a8d(0x12c))&&_0x2d95e6['val']&&(this[_0x3f6a8d(0x1a8)](_0xdb9926,{'val':![],'ack':!![]}),this['runGeminiAnalysis']());if(_0xdb9926[_0x3f6a8d(0x196)](_0x3f6a8d(0x7f))&&_0x2d95e6[_0x3f6a8d(0x120)]){this[_0x3f6a8d(0x1a8)](_0xdb9926,{'val':![],'ack':!![]});if(this[_0x3f6a8d(0x17f)])this[_0x3f6a8d(0x167)]();}return;}if(this[_0x3f6a8d(0xef)]['presenceDevices']&&this[_0x3f6a8d(0xef)][_0x3f6a8d(0x151)][_0x3f6a8d(0x196)](_0xdb9926)){await this[_0x3f6a8d(0x166)]();return;}const _0x54d8e0=(this[_0x3f6a8d(0xef)][_0x3f6a8d(0x7e)]||[])[_0x3f6a8d(0x195)](_0x7057b2=>_0x7057b2['id']===_0xdb9926);if(_0x54d8e0)this[_0x3f6a8d(0x9b)](_0xdb9926,_0x2d95e6,_0x54d8e0);}async[a0_0x4a3f45(0x9b)](_0x2cba22,_0x56fd85,_0x2a7860){const _0x1686e7=a0_0x4a3f45;if(!_0x2a7860[_0x1686e7(0x176)]&&this['sensorLastValues'][_0x2cba22]===_0x56fd85[_0x1686e7(0x120)])return;this[_0x1686e7(0x184)][_0x2cba22]=_0x56fd85[_0x1686e7(0x120)];if(this['isGracePeriodActive'])return;const _0x51df9e=await this[_0x1686e7(0x166)]();if(_0x51df9e){if(!this[_0x1686e7(0x156)])this[_0x1686e7(0xde)](!![]);}else{const _0x28382e=_0x2a7860[_0x1686e7(0x1af)]===!![];_0x28382e?this[_0x1686e7(0x12d)]():(this[_0x1686e7(0xdb)]&&(this['log'][_0x1686e7(0x19e)]('Bewegung\x20w√§hrend\x20Exit-Timer\x20erkannt\x20->\x20Bewohner\x20ist\x20noch\x20da.'),this[_0x1686e7(0x17d)]()),!this['isPresent']&&this[_0x1686e7(0xe6)]===SYSTEM_MODES[_0x1686e7(0x175)]&&this['setPresence'](!![]));}const _0x463909={'timestamp':_0x56fd85['ts'],'id':_0x2cba22,'name':_0x2a7860['name'],'value':_0x56fd85['val'],'location':_0x2a7860['location'],'type':_0x2a7860[_0x1686e7(0x9f)]};this[_0x1686e7(0xbc)]['unshift'](_0x463909);if(this[_0x1686e7(0xbc)][_0x1686e7(0x15f)]>HISTORY_MAX_SIZE)this[_0x1686e7(0xbc)]['pop']();await this[_0x1686e7(0x1b3)](_0x1686e7(0xa6),{'val':JSON[_0x1686e7(0x14b)](_0x463909),'ack':!![]}),await this[_0x1686e7(0x1b3)](_0x1686e7(0x115),{'val':JSON[_0x1686e7(0x14b)](this[_0x1686e7(0xbc)]),'ack':!![]}),this[_0x1686e7(0xe8)][_0x1686e7(0x183)]({'timestamp':new Date(_0x56fd85['ts'])['toISOString'](),'sensorName':_0x2a7860[_0x1686e7(0x10e)],'location':_0x2a7860[_0x1686e7(0x1b8)],'value':_0x56fd85[_0x1686e7(0x120)]}),await this[_0x1686e7(0x169)]();}[a0_0x4a3f45(0x12d)](){const _0x3fb674=a0_0x4a3f45;this[_0x3fb674(0x17d)](),this[_0x3fb674(0xa7)]=!![],this[_0x3fb674(0x198)]=setTimeout(()=>{const _0x3935d3=_0x3fb674;this[_0x3935d3(0xa7)]=![];},EXIT_GRACE_PERIOD_SECONDS*0x3e8),this[_0x3fb674(0xdb)]=setTimeout(()=>{const _0x9d65f=_0x3fb674;this[_0x9d65f(0xde)](![]),this[_0x9d65f(0xdb)]=null;},EXIT_TIMER_MINUTES*0x3c*0x3e8);}[a0_0x4a3f45(0x17d)](){const _0x2e3422=a0_0x4a3f45;if(this[_0x2e3422(0xdb)])clearTimeout(this[_0x2e3422(0xdb)]);if(this[_0x2e3422(0x198)])clearTimeout(this[_0x2e3422(0x198)]);this[_0x2e3422(0xdb)]=null,this[_0x2e3422(0x198)]=null,this['isGracePeriodActive']=![];}async[a0_0x4a3f45(0xde)](_0x328250){const _0x4b2733=a0_0x4a3f45;if(this[_0x4b2733(0x156)]===_0x328250)return;this[_0x4b2733(0x156)]=_0x328250,await this[_0x4b2733(0x1b3)]('system.isPresent',{'val':_0x328250,'ack':!![]});}[a0_0x4a3f45(0xb5)](){const _0x3f9e85=a0_0x4a3f45,_0x254530=this[_0x3f9e85(0xef)][_0x3f9e85(0xaa)],_0x2d2bb9=this[_0x3f9e85(0xef)][_0x3f9e85(0x125)],_0x480342=this[_0x3f9e85(0xbc)][_0x3f9e85(0x15f)]>0x0?this[_0x3f9e85(0xbc)][0x0][_0x3f9e85(0xce)]:Date[_0x3f9e85(0x190)](),_0x416ad8=(Date[_0x3f9e85(0x190)]()-_0x480342)/(0x3e8*0x3c*0x3c);let _0x1f4d61='';_0x2d2bb9&&this[_0x3f9e85(0xe6)]===SYSTEM_MODES[_0x3f9e85(0x175)]&&this[_0x3f9e85(0x156)]&&(_0x416ad8>_0x254530&&(_0x1f4d61=_0x3f9e85(0xe5)+_0x416ad8[_0x3f9e85(0x110)](0x1)+_0x3f9e85(0x84)));if(_0x1f4d61){this[_0x3f9e85(0x1ab)](_0x1f4d61)[_0x3f9e85(0x177)](_0x46c16b=>this[_0x3f9e85(0xba)][_0x3f9e85(0x19d)](_0x46c16b));return;}const _0x980ec5=Date[_0x3f9e85(0x190)](),_0x5b14ca=_0x980ec5-_0x480342,_0x79f95a=(this[_0x3f9e85(0xef)]['analysisInterval']||0xf)*0x3c*0x3e8;this[_0x3f9e85(0xbc)][_0x3f9e85(0x15f)]>0x0&&_0x5b14ca<=_0x79f95a?this['runGeminiAnalysis']()['catch'](_0x375e76=>this[_0x3f9e85(0xba)][_0x3f9e85(0x19d)](_0x375e76)):!this['lastAlertState']&&(this[_0x3f9e85(0x1a8)](_0x3f9e85(0x7d),{'val':![],'ack':!![]}),this[_0x3f9e85(0x1a8)](_0x3f9e85(0xc3),{'val':![],'ack':!![]}));}async[a0_0x4a3f45(0x1ab)](_0xe8788e=''){const _0x1d6f60=a0_0x4a3f45;if(!this[_0x1d6f60(0xc6)])return;const _0x23e038=this['eventHistory'][_0x1d6f60(0x15f)]>0x0?this[_0x1d6f60(0xbc)]:[{'note':_0x1d6f60(0x18c)}],_0x4fc3ae=PERSONA_MAPPING[this[_0x1d6f60(0xef)][_0x1d6f60(0x165)]||'generic'],_0x233e71=this[_0x1d6f60(0xef)][_0x1d6f60(0x95)]||'',_0x562369=this[_0x1d6f60(0xe6)],_0x48b46c=new Date(),_0x4dfa77=_0x48b46c[_0x1d6f60(0xb8)](_0x1d6f60(0xb7),{'weekday':_0x1d6f60(0xc7),'hour':_0x1d6f60(0xe7),'minute':_0x1d6f60(0xe7)}),_0x3bbc1e=this[_0x1d6f60(0xf3)];let _0x314bdc='';if(this[_0x1d6f60(0x140)][_0x1d6f60(0x15f)]>0x0){const _0x30d4d6=this[_0x1d6f60(0x140)][_0x1d6f60(0x143)](0x0,0x3)[_0x1d6f60(0xf2)](_0x19b6ff=>_0x1d6f60(0x11b)+_0x19b6ff['alertReason']+_0x1d6f60(0x12a)+_0x19b6ff[_0x1d6f60(0x91)]+'.')[_0x1d6f60(0xd3)]('\x0a');_0x314bdc=_0x1d6f60(0xfd)+_0x30d4d6+'\x0a';}const _0x58b576=_0xe8788e?'\x0a!!!\x20EXTERNAL\x20SYSTEM\x20WARNING\x20!!!\x0a'+_0xe8788e+_0x1d6f60(0x153):'',_0x4ebe9e=_0x1d6f60(0x11a),_0x5232d8=_0x1d6f60(0x15e)+_0x4dfa77+_0x1d6f60(0x132)+_0x3bbc1e['city']+'.\x0a\x20\x20\x20\x20\x20\x20\x20\x20MODUS:\x20'+_0x562369+_0x1d6f60(0x182)+(this[_0x1d6f60(0x156)]?'Ja':_0x1d6f60(0x88))+'.\x20\x0a\x20\x20\x20\x20\x20\x20\x20\x20KONTEXT:\x20'+_0x233e71+_0x1d6f60(0x122)+_0x4fc3ae+'.\x0a\x20\x20\x20\x20\x20\x20\x20\x20'+_0x4ebe9e+'\x20'+_0x314bdc+'\x20'+_0x58b576+'\x0a\x20\x20\x20\x20\x20\x20\x20\x20EVENTS:\x20'+JSON[_0x1d6f60(0x14b)](_0x23e038)+_0x1d6f60(0x104);try{const _0x30ec74=await this[_0x1d6f60(0xc6)][_0x1d6f60(0x1b7)](_0x5232d8),_0x18754a=_0x30ec74[_0x1d6f60(0x1b9)][_0x1d6f60(0x15c)]()[_0x1d6f60(0x1a2)](/```json|```/g,'')[_0x1d6f60(0x1b6)](),_0x39b5b2=JSON['parse'](_0x18754a);await this[_0x1d6f60(0x1b3)]('analysis.lastResult',{'val':_0x18754a,'ack':!![]}),await this['setStateAsync'](_0x1d6f60(0x148),{'val':_0x39b5b2[_0x1d6f60(0x116)]['alertReason']||'','ack':!![]}),await this[_0x1d6f60(0x1b3)]('analysis.activitySummary',{'val':_0x39b5b2['activity']['summary']||_0x1d6f60(0xfa),'ack':!![]}),await this[_0x1d6f60(0x1b3)](_0x1d6f60(0x7b),{'val':_0x39b5b2[_0x1d6f60(0x116)][_0x1d6f60(0xd6)]||_0x1d6f60(0xfa),'ack':!![]});_0x39b5b2[_0x1d6f60(0x172)]&&(await this['setStateAsync'](_0x1d6f60(0x83),{'val':_0x39b5b2['comfort']['summary']||'','ack':!![]}),await this[_0x1d6f60(0x1b3)](_0x1d6f60(0xac),{'val':_0x39b5b2[_0x1d6f60(0x172)][_0x1d6f60(0x107)]||'','ack':!![]}),_0x39b5b2[_0x1d6f60(0x172)]['automationProposal']&&(await this[_0x1d6f60(0x1b3)]('analysis.automation.patternDetected',{'val':_0x39b5b2[_0x1d6f60(0x172)][_0x1d6f60(0xd0)]['patternDetected']||![],'ack':!![]}),await this[_0x1d6f60(0x1b3)](_0x1d6f60(0xc9),{'val':_0x39b5b2[_0x1d6f60(0x172)][_0x1d6f60(0xd0)][_0x1d6f60(0x191)]||'','ack':!![]}),await this[_0x1d6f60(0x1b3)](_0x1d6f60(0x109),{'val':_0x39b5b2[_0x1d6f60(0x172)][_0x1d6f60(0xd0)][_0x1d6f60(0xa5)]||'','ack':!![]})));const _0x1a4191=_0x39b5b2[_0x1d6f60(0x116)][_0x1d6f60(0x16d)]||![],_0x536732=_0x39b5b2['activity'][_0x1d6f60(0x17c)]||![];if(_0x1a4191||_0x536732){await this[_0x1d6f60(0x1b3)](_0x1d6f60(0x7d),{'val':!![],'ack':!![]}),await this[_0x1d6f60(0x1b3)](_0x1d6f60(0xc3),{'val':_0x536732,'ack':!![]});if(!this[_0x1d6f60(0xf4)]||_0x536732){const _0x5db056=_0x536732?'üö®üö®\x20NOTFALL':_0x1d6f60(0xed);this[_0x1d6f60(0x11f)](_0x5db056+':\x20'+_0x39b5b2['activity'][_0x1d6f60(0x155)],![],_0x536732);}}else await this[_0x1d6f60(0x1b3)](_0x1d6f60(0x7d),{'val':![],'ack':!![]}),await this[_0x1d6f60(0x1b3)](_0x1d6f60(0xc3),{'val':![],'ack':!![]});this['lastAlertState']=_0x1a4191||_0x536732;const _0x19848e={'timestamp':Date['now'](),'id':Date['now']()[_0x1d6f60(0xa3)](),'analysis':_0x39b5b2,'systemMode':_0x562369,'isPro':this[_0x1d6f60(0x17f)]};this[_0x1d6f60(0x126)](_0x19848e);}catch(_0x3d2bdf){this[_0x1d6f60(0xba)]['error'](_0x1d6f60(0xd4)+_0x3d2bdf[_0x1d6f60(0x197)]);}}async['createDailyDigest'](){const _0x84ee33=a0_0x4a3f45;if(!this[_0x84ee33(0x17f)])return;await this[_0x84ee33(0x1b3)](LTM_DP_STATUS,{'val':_0x84ee33(0xf1)+new Date()[_0x84ee33(0xb8)](),'ack':!![]});if(!this[_0x84ee33(0xc6)]||this[_0x84ee33(0xe8)][_0x84ee33(0x15f)]<LTM_MIN_EVENTS_FOR_COMPRESSION){await this['setStateAsync'](LTM_DP_STATUS,{'val':_0x84ee33(0xf0),'ack':!![]});return;}const _0x1bd57a=JSON[_0x84ee33(0xfb)](JSON[_0x84ee33(0x14b)](this['rawEventLog'])),_0x375a23=(this[_0x84ee33(0xef)]['livingContext']||'')[_0x84ee33(0xcb)](0x0,0x3e8),_0x30d87d=_0x84ee33(0xa8)+_0x375a23+'.\x20ANWEISUNG:\x20Fasse\x20Sensor-Events\x20zusammen.\x20SCHEMA:\x20{\x20\x22summary\x22:\x20\x22string\x22,\x20\x22activityLevel\x22:\x20\x22string\x22\x20}\x20\x0a\x0aEVENTS:\x0a'+JSON[_0x84ee33(0x14b)](_0x1bd57a);try{const _0x34aaaf=await this[_0x84ee33(0xc6)][_0x84ee33(0x1b7)](_0x30d87d),_0x18ca2c=JSON[_0x84ee33(0xfb)](_0x34aaaf['response'][_0x84ee33(0x15c)]()[_0x84ee33(0x1a2)](/```json|```/g,'')[_0x84ee33(0x1b6)]());_0x18ca2c[_0x84ee33(0x159)]&&(this[_0x84ee33(0xb9)]['push']({'timestamp':new Date()[_0x84ee33(0xa2)](),'eventCount':_0x1bd57a[_0x84ee33(0x15f)],'summary':_0x18ca2c[_0x84ee33(0x159)],'activityLevel':_0x18ca2c[_0x84ee33(0xeb)],'systemMode':this[_0x84ee33(0xe6)]}),await this[_0x84ee33(0x180)](),this[_0x84ee33(0xe8)]=[],await this[_0x84ee33(0x169)](),await this['setStateAsync'](LTM_DP_STATUS,{'val':'Success:\x20Compressed\x20'+_0x1bd57a[_0x84ee33(0x15f)]+_0x84ee33(0x154),'ack':!![]}));}catch(_0x25ec43){await this[_0x84ee33(0x1b3)](LTM_DP_STATUS,{'val':_0x84ee33(0x99)+_0x25ec43[_0x84ee33(0x197)],'ack':!![]});}}async[a0_0x4a3f45(0xec)](){const _0x3ab510=a0_0x4a3f45;await this['checkSystemObjects'](),await this['setObjectNotExistsAsync'](_0x3ab510(0x136),{'type':_0x3ab510(0xbe),'common':{'name':'Presence\x20Status','type':_0x3ab510(0xbf),'role':_0x3ab510(0xf7),'read':!![],'write':![],'def':!![]},'native':{}}),await this[_0x3ab510(0x1a4)](_0x3ab510(0xa6),{'type':'state','common':{'name':_0x3ab510(0x9c),'type':_0x3ab510(0x118),'role':_0x3ab510(0xaf),'read':!![],'write':![]},'native':{}}),await this[_0x3ab510(0x1a4)]('events.history',{'type':_0x3ab510(0xbe),'common':{'name':_0x3ab510(0x141),'type':'string','role':_0x3ab510(0xaf),'read':!![],'write':![]},'native':{}}),await this[_0x3ab510(0x1a4)](_0x3ab510(0x12c),{'type':_0x3ab510(0xbe),'common':{'name':_0x3ab510(0x162),'type':_0x3ab510(0xbf),'role':_0x3ab510(0xe1),'read':!![],'write':!![],'def':![]},'native':{}}),await this[_0x3ab510(0x1a4)](_0x3ab510(0xcc),{'type':_0x3ab510(0xbe),'common':{'name':_0x3ab510(0x16e),'type':'string','role':'json','read':!![],'write':![]},'native':{}}),await this[_0x3ab510(0x1a4)](_0x3ab510(0x7d),{'type':_0x3ab510(0xbe),'common':{'name':_0x3ab510(0xfe),'type':_0x3ab510(0xbf),'role':'indicator.alarm','read':!![],'write':![],'def':![]},'native':{}}),await this[_0x3ab510(0x1a4)]('analysis.isEmergency',{'type':'state','common':{'name':_0x3ab510(0x135),'type':'boolean','role':_0x3ab510(0x181),'read':!![],'write':![],'def':![]},'native':{}}),await this[_0x3ab510(0x1a4)](_0x3ab510(0x148),{'type':_0x3ab510(0xbe),'common':{'name':_0x3ab510(0xe4),'type':'string','role':'text.alarm','read':!![],'write':![]},'native':{}}),await this[_0x3ab510(0x1a4)]('analysis.activitySummary',{'type':'state','common':{'name':'Activity\x20Summary','type':_0x3ab510(0x118),'role':_0x3ab510(0x15c),'read':!![],'write':![]},'native':{}}),await this[_0x3ab510(0x1a4)](_0x3ab510(0x7b),{'type':_0x3ab510(0xbe),'common':{'name':'Deviation','type':_0x3ab510(0x118),'role':_0x3ab510(0xbe),'read':!![],'write':![],'def':_0x3ab510(0xfa)},'native':{}}),await this['setObjectNotExistsAsync']('analysis.comfortSummary',{'type':_0x3ab510(0xbe),'common':{'name':_0x3ab510(0xa9),'type':_0x3ab510(0x118),'role':'text','read':!![],'write':![]},'native':{}}),await this[_0x3ab510(0x1a4)](_0x3ab510(0xac),{'type':_0x3ab510(0xbe),'common':{'name':_0x3ab510(0x16b),'type':_0x3ab510(0x118),'role':'text','read':!![],'write':![]},'native':{}}),await this[_0x3ab510(0xd5)](_0x3ab510(0x17e),{'type':'channel','common':{'name':_0x3ab510(0xdd)},'native':{}}),await this['setObjectNotExistsAsync'](_0x3ab510(0x161),{'type':_0x3ab510(0xbe),'common':{'name':'Pattern\x20Detected','type':'boolean','role':_0x3ab510(0xf7),'read':!![],'write':![],'def':![]},'native':{}}),await this[_0x3ab510(0x1a4)]('analysis.automation.description',{'type':_0x3ab510(0xbe),'common':{'name':_0x3ab510(0x90),'type':_0x3ab510(0x118),'role':_0x3ab510(0x15c),'read':!![],'write':![]},'native':{}}),await this[_0x3ab510(0x1a4)](_0x3ab510(0x109),{'type':'state','common':{'name':_0x3ab510(0xb1),'type':_0x3ab510(0x118),'role':_0x3ab510(0x15c),'read':!![],'write':![]},'native':{}}),await this[_0x3ab510(0x1a4)](_0x3ab510(0x81),{'type':_0x3ab510(0xbe),'common':{'name':_0x3ab510(0x111),'type':_0x3ab510(0x118),'role':_0x3ab510(0xaf),'read':!![],'write':![],'def':'[]'},'native':{}}),await this[_0x3ab510(0x1a4)](_0x3ab510(0x1a7),{'type':_0x3ab510(0xbe),'common':{'name':_0x3ab510(0x16a),'type':_0x3ab510(0x118),'role':_0x3ab510(0xaf),'read':!![],'write':![],'def':'[]'},'native':{}}),await this['checkLtmObjects'](),await this[_0x3ab510(0x1ae)]();}async[a0_0x4a3f45(0x130)](){const _0x17e95d=a0_0x4a3f45;await this['extendObjectAsync'](_0x17e95d(0x1ac),{'type':_0x17e95d(0xd7),'common':{'name':_0x17e95d(0x178)},'native':{}}),await this['extendObjectAsync'](SYSTEM_DP_MODE,{'type':_0x17e95d(0xbe),'common':{'name':'System\x20Mode','type':'string','role':_0x17e95d(0xbe),'read':!![],'write':!![],'def':SYSTEM_MODES['NORMAL'],'states':{[SYSTEM_MODES[_0x17e95d(0x175)]]:_0x17e95d(0x114),[SYSTEM_MODES[_0x17e95d(0x19b)]]:_0x17e95d(0x17b),[SYSTEM_MODES[_0x17e95d(0x14c)]]:_0x17e95d(0x11c),[SYSTEM_MODES[_0x17e95d(0x9e)]]:_0x17e95d(0x170)}},'native':{}});}async[a0_0x4a3f45(0x11f)](_0x59fd8a,_0x3e1627=![],_0x59e9aa=![]){const _0x508205=a0_0x4a3f45;this[_0x508205(0xba)][_0x508205(0x19e)]((_0x3e1627?_0x508205(0x147):'')+_0x508205(0x79)+_0x59fd8a+'\x22'+(_0x59e9aa?'\x20(EMERGENCY)':''));const _0x3249e2=this[_0x508205(0xef)];let _0x2e3e33=0x0;_0x3249e2[_0x508205(0x119)]&&_0x3249e2[_0x508205(0x192)]&&(await this[_0x508205(0xd1)](_0x3249e2[_0x508205(0x192)],_0x508205(0x12f),{'text':_0x59fd8a,'user':_0x3249e2[_0x508205(0x11d)]}),_0x2e3e33++);if(_0x3249e2['notifyPushoverEnabled']&&_0x3249e2['notifyPushoverInstance']){let _0xc9156d={'message':_0x59fd8a,'title':_0x59e9aa?_0x508205(0x1a0):_0x508205(0xcf),'priority':_0x59e9aa?0x2:0x1,'device':_0x3249e2[_0x508205(0x10b)]};_0x59e9aa&&(_0xc9156d[_0x508205(0x157)]=0x1e,_0xc9156d['expire']=0xe10,_0xc9156d[_0x508205(0xa0)]=_0x508205(0x101)),await this[_0x508205(0xd1)](_0x3249e2['notifyPushoverInstance'],'send',_0xc9156d),_0x2e3e33++;}return _0x3249e2[_0x508205(0x11e)]&&_0x3249e2[_0x508205(0xdf)]&&(await this[_0x508205(0xd1)](_0x3249e2['notifyEmailInstance'],'send',{'text':_0x59fd8a,'to':_0x3249e2[_0x508205(0x14f)]}),_0x2e3e33++),_0x3249e2[_0x508205(0x87)]&&_0x3249e2[_0x508205(0x137)]&&(await this[_0x508205(0xd1)](_0x3249e2[_0x508205(0x137)],_0x508205(0x12f),{'text':_0x59fd8a,'phone':_0x3249e2['notifyWhatsappRecipient']}),_0x2e3e33++),_0x3249e2[_0x508205(0x186)]&&_0x3249e2[_0x508205(0x1b5)]&&(await this[_0x508205(0xd1)](_0x3249e2[_0x508205(0x1b5)],'send',{'text':_0x59fd8a,'phone':_0x3249e2['notifySignalRecipient']}),_0x2e3e33++),_0x2e3e33;}async['loadRawEventLog'](){const _0x275f83=a0_0x4a3f45;try{const _0x407009=await this['getStateAsync'](LTM_DP_RAW_LOG);if(_0x407009&&_0x407009['val'])this[_0x275f83(0xe8)]=JSON[_0x275f83(0xfb)](_0x407009[_0x275f83(0x120)]);}catch(_0x2dbd2a){this[_0x275f83(0xe8)]=[];}}async[a0_0x4a3f45(0x169)](){const _0x476cb2=a0_0x4a3f45;this['rawEventLog'][_0x476cb2(0x15f)]>RAW_LOG_MAX_SIZE&&this['rawEventLog'][_0x476cb2(0x193)](0x0,this[_0x476cb2(0xe8)][_0x476cb2(0x15f)]-RAW_LOG_MAX_SIZE),await this[_0x476cb2(0x1b3)](LTM_DP_RAW_LOG,{'val':JSON['stringify'](this[_0x476cb2(0xe8)]),'ack':!![]});}async[a0_0x4a3f45(0x82)](){const _0x3b905c=a0_0x4a3f45;try{const _0x272f53=await this[_0x3b905c(0x1b1)](LTM_DP_DAILY_DIGESTS);if(_0x272f53&&_0x272f53['val'])this[_0x3b905c(0xb9)]=JSON[_0x3b905c(0xfb)](_0x272f53[_0x3b905c(0x120)]);}catch(_0x1b8502){this[_0x3b905c(0xb9)]=[];}await this[_0x3b905c(0x106)]();}async[a0_0x4a3f45(0x180)](_0x5099b1=!![]){const _0x186060=a0_0x4a3f45,_0x5890c4=this[_0x186060(0xef)][_0x186060(0x146)]||0x3c;this[_0x186060(0xb9)][_0x186060(0x15f)]>_0x5890c4&&this[_0x186060(0xb9)][_0x186060(0x193)](0x0,this[_0x186060(0xb9)][_0x186060(0x15f)]-_0x5890c4);await this[_0x186060(0x1b3)](LTM_DP_DAILY_DIGESTS,{'val':JSON[_0x186060(0x14b)](this[_0x186060(0xb9)]),'ack':!![]});if(_0x5099b1)await this['updateBaselineStatus']();}[a0_0x4a3f45(0xbd)](){const _0xcfbc2c=a0_0x4a3f45;if(this[_0xcfbc2c(0x173)])this[_0xcfbc2c(0x173)]['cancel']();if(!this[_0xcfbc2c(0x17f)]){this['setStateAsync'](LTM_DP_STATUS,{'val':_0xcfbc2c(0xb6),'ack':!![]});return;}this['ltmJob']=schedule[_0xcfbc2c(0x98)](LTM_SCHEDULE,()=>this[_0xcfbc2c(0x167)]());}[a0_0x4a3f45(0xe0)](){const _0x322d0b=a0_0x4a3f45;if(this[_0x322d0b(0x10d)])clearInterval(this['driftAnalysisTimer']);if(!this[_0x322d0b(0x17f)])return;this['driftAnalysisTimer']=setInterval(()=>this[_0x322d0b(0x112)](),(this[_0x322d0b(0xef)]['ltmDriftCheckIntervalHours']||0x18)*0x36ee80),setTimeout(()=>this['runBaselineDriftAnalysis'](),0x1388);}async['resetAnalysisStates'](){const _0x2106e7=a0_0x4a3f45;await this[_0x2106e7(0x1b3)](_0x2106e7(0xf6),{'val':'No\x20recent\x20activity.','ack':!![]}),await this[_0x2106e7(0x1b3)]('analysis.deviationFromBaseline',{'val':this[_0x2106e7(0x17f)]?_0x2106e7(0xca):_0x2106e7(0x12e),'ack':!![]}),await this[_0x2106e7(0x1b3)]('analysis.isAlert',{'val':![],'ack':!![]}),await this[_0x2106e7(0x1b3)](_0x2106e7(0xc3),{'val':![],'ack':!![]}),this[_0x2106e7(0xf4)]=![];}async[a0_0x4a3f45(0x126)](_0x480d5d){const _0x29ffac=a0_0x4a3f45;this[_0x29ffac(0xe3)][_0x29ffac(0xb0)](_0x480d5d);if(this[_0x29ffac(0xe3)][_0x29ffac(0x15f)]>ANALYSIS_HISTORY_MAX_SIZE)this[_0x29ffac(0xe3)][_0x29ffac(0xc5)]();await this['setStateAsync'](_0x29ffac(0x81),{'val':JSON[_0x29ffac(0x14b)](this['analysisHistory']),'ack':!![]});}[a0_0x4a3f45(0x171)](){const _0x53b2e9=a0_0x4a3f45;if(this[_0x53b2e9(0x10c)])this[_0x53b2e9(0x10c)][_0x53b2e9(0x1a9)]();this[_0x53b2e9(0x10c)]=schedule[_0x53b2e9(0x98)](MODE_RESET_SCHEDULE,async()=>{const _0x2f495a=_0x53b2e9;await this[_0x2f495a(0x127)](),AUTO_RESET_MODES[_0x2f495a(0x196)](this[_0x2f495a(0xe6)])&&await this[_0x2f495a(0x1b3)](SYSTEM_DP_MODE,{'val':SYSTEM_MODES['NORMAL'],'ack':![]});});}async[a0_0x4a3f45(0x106)](){const _0x5886a9=a0_0x4a3f45;if(!this['isProVersion']){await this[_0x5886a9(0x1b3)](LTM_DP_BASELINE_STATUS,{'val':'Deaktiviert\x20(Pro-Feature)','ack':!![]});return;}const _0x29fb6a=this[_0x5886a9(0xb9)][_0x5886a9(0x15f)]>=(this['config'][_0x5886a9(0x108)]||0x7)?_0x5886a9(0x8b)+this['dailyDigests']['length']+_0x5886a9(0x92):_0x5886a9(0x105)+this[_0x5886a9(0xb9)][_0x5886a9(0x15f)]+'/'+(this[_0x5886a9(0xef)][_0x5886a9(0x108)]||0x7)+')';await this[_0x5886a9(0x1b3)](LTM_DP_BASELINE_STATUS,{'val':_0x29fb6a,'ack':!![]});}async[a0_0x4a3f45(0x100)](){const _0x25f3ac=a0_0x4a3f45;await this[_0x25f3ac(0xd5)](_0x25f3ac(0x1b4),{'type':_0x25f3ac(0xd7),'common':{'name':_0x25f3ac(0x1b4)},'native':{}}),await this[_0x25f3ac(0xd5)](LTM_DP_RAW_LOG,{'type':_0x25f3ac(0xbe),'common':{'name':_0x25f3ac(0x16f),'type':'string','role':_0x25f3ac(0xaf),'read':!![],'write':![]},'native':{}}),await this[_0x25f3ac(0xd5)](LTM_DP_DAILY_DIGESTS,{'type':_0x25f3ac(0xbe),'common':{'name':'Daily\x20Digests','type':_0x25f3ac(0x118),'role':_0x25f3ac(0xaf),'read':!![],'write':![]},'native':{}}),await this[_0x25f3ac(0xd5)](LTM_DP_STATUS,{'type':'state','common':{'name':_0x25f3ac(0x86),'type':_0x25f3ac(0x118),'role':_0x25f3ac(0x15c),'read':!![],'write':![]},'native':{}}),await this['extendObjectAsync'](LTM_DP_TRIGGER_DIGEST,{'type':_0x25f3ac(0xbe),'common':{'name':'Trigger\x20Digest','type':'boolean','role':_0x25f3ac(0xe1),'read':!![],'write':!![],'def':![]},'native':{}}),await this['extendObjectAsync'](LTM_DP_BASELINE_STATUS,{'type':_0x25f3ac(0xbe),'common':{'name':'Baseline\x20Status','type':'string','role':'text','read':!![],'write':![]},'native':{}});}async[a0_0x4a3f45(0x1ae)](){const _0xd6d9b0=a0_0x4a3f45;await this['extendObjectAsync'](LTM_DP_DRIFT_CHANNEL,{'type':_0xd6d9b0(0xd7),'common':{'name':_0xd6d9b0(0x18e)},'native':{}}),await this[_0xd6d9b0(0xd5)](LTM_DP_DRIFT_STATUS,{'type':_0xd6d9b0(0xbe),'common':{'name':'Drift\x20Status','type':'string','role':_0xd6d9b0(0xbe),'read':!![],'write':![],'def':_0xd6d9b0(0xfa)},'native':{}}),await this[_0xd6d9b0(0xd5)](LTM_DP_DRIFT_DETAILS,{'type':_0xd6d9b0(0xbe),'common':{'name':_0xd6d9b0(0x9a),'type':_0xd6d9b0(0x118),'role':_0xd6d9b0(0x15c),'read':!![],'write':![]},'native':{}}),await this[_0xd6d9b0(0xd5)](LTM_DP_DRIFT_LAST_CHECK,{'type':_0xd6d9b0(0xbe),'common':{'name':_0xd6d9b0(0x128),'type':_0xd6d9b0(0xd8),'role':_0xd6d9b0(0xcd),'read':!![],'write':![]},'native':{}});}async[a0_0x4a3f45(0x112)](){const _0x243753=a0_0x4a3f45;if(!this[_0x243753(0x17f)]||!this[_0x243753(0xc6)])return;const _0x11b856=this[_0x243753(0xef)]['ltmStbWindowDays']||0xe;if(this['dailyDigests'][_0x243753(0x15f)]<_0x11b856+(this[_0x243753(0xef)][_0x243753(0x108)]||0x7)){await this['setStateAsync'](LTM_DP_DRIFT_STATUS,{'val':_0x243753(0x7c),'ack':!![]});return;}const _0x1f164c=this['dailyDigests'][_0x243753(0x143)](-_0x11b856),_0x59de13=this[_0x243753(0xb9)][_0x243753(0x143)](0x0,this[_0x243753(0xb9)][_0x243753(0x15f)]-_0x11b856),_0x53fbb8=_0x243753(0x15b)+JSON['stringify'](_0x59de13)+_0x243753(0xdc)+JSON[_0x243753(0x14b)](_0x1f164c);try{const _0x237330=await this['geminiModel']['generateContent'](_0x53fbb8),_0x3c93e8=JSON[_0x243753(0xfb)](_0x237330['response'][_0x243753(0x15c)]()[_0x243753(0x1a2)](/```json|```/g,'')['trim']());_0x3c93e8[_0x243753(0x13a)]&&(await this['setStateAsync'](LTM_DP_DRIFT_STATUS,{'val':_0x3c93e8[_0x243753(0x13a)],'ack':!![]}),await this[_0x243753(0x1b3)](LTM_DP_DRIFT_DETAILS,{'val':_0x3c93e8[_0x243753(0xf9)],'ack':!![]}),await this['setStateAsync'](LTM_DP_DRIFT_LAST_CHECK,{'val':Date[_0x243753(0x190)](),'ack':!![]}));}catch(_0x1587c9){}}async[a0_0x4a3f45(0x127)](){const _0x1a00bd=a0_0x4a3f45;try{const _0x4e0e74=await this[_0x1a00bd(0x1b1)](SYSTEM_DP_MODE);_0x4e0e74&&_0x4e0e74[_0x1a00bd(0x120)]&&Object[_0x1a00bd(0x1ad)](SYSTEM_MODES)[_0x1a00bd(0x196)](_0x4e0e74[_0x1a00bd(0x120)])?this[_0x1a00bd(0xe6)]=_0x4e0e74['val']:(this[_0x1a00bd(0xe6)]=SYSTEM_MODES[_0x1a00bd(0x175)],await this[_0x1a00bd(0x1b3)](SYSTEM_DP_MODE,{'val':SYSTEM_MODES['NORMAL'],'ack':!![]}));}catch(_0x5c3949){this[_0x1a00bd(0xe6)]=SYSTEM_MODES['NORMAL'];}}async['getSystemUUID'](){const _0x59137d=a0_0x4a3f45;try{const _0xc354d8=await this['getForeignObjectAsync']('system.meta.uuid');if(_0xc354d8&&_0xc354d8[_0x59137d(0x158)]&&_0xc354d8[_0x59137d(0x158)][_0x59137d(0x194)])return _0xc354d8['native'][_0x59137d(0x194)];return _0x59137d(0x160);}catch(_0x16b008){return'uuid-error';}}async[a0_0x4a3f45(0x89)](_0x4ee2fc){const _0x95cf45=a0_0x4a3f45;if(!_0x4ee2fc)return![];this[_0x95cf45(0x164)]=await this['getSystemUUID']();if(_0x4ee2fc===_0x95cf45(0xbb)||_0x4ee2fc[_0x95cf45(0x15d)](_0x95cf45(0x1b0)))return!![];return![];}['onUnload'](_0x77d0fd){const _0x30c67f=a0_0x4a3f45;if(this[_0x30c67f(0x13c)])clearInterval(this[_0x30c67f(0x13c)]);if(this['driftAnalysisTimer'])clearInterval(this[_0x30c67f(0x10d)]);if(this[_0x30c67f(0x173)])this[_0x30c67f(0x173)][_0x30c67f(0x1a9)]();if(this[_0x30c67f(0x10c)])this[_0x30c67f(0x10c)][_0x30c67f(0x1a9)]();if(this[_0x30c67f(0xdb)])clearTimeout(this[_0x30c67f(0xdb)]);if(this[_0x30c67f(0x198)])clearTimeout(this[_0x30c67f(0x198)]);_0x77d0fd();}async['onMessage'](_0x46273b){const _0x41054b=a0_0x4a3f45;if(typeof _0x46273b===_0x41054b(0xb3)&&_0x46273b[_0x41054b(0x197)]){if(_0x46273b[_0x41054b(0x18f)]===_0x41054b(0x113)){if(!_0x46273b['message']['apiKey'])return this[_0x41054b(0xf8)](_0x46273b[_0x41054b(0x17a)],_0x46273b[_0x41054b(0x18f)],{'success':![],'message':_0x41054b(0xa4)},_0x46273b[_0x41054b(0xff)]);try{const _0x4941ef=new GoogleGenerativeAI(_0x46273b[_0x41054b(0x197)]['apiKey'])['getGenerativeModel']({'model':_0x41054b(0xab)});await _0x4941ef['generateContent'](_0x41054b(0x13d)),this[_0x41054b(0xf8)](_0x46273b[_0x41054b(0x17a)],_0x46273b[_0x41054b(0x18f)],{'success':!![],'message':'Success'},_0x46273b[_0x41054b(0xff)]);}catch(_0x2fd222){this['sendTo'](_0x46273b['from'],_0x46273b[_0x41054b(0x18f)],{'success':![],'message':_0x2fd222[_0x41054b(0x197)]},_0x46273b[_0x41054b(0xff)]);}}else{if(_0x46273b[_0x41054b(0x18f)]==='testNotification'){const _0x211660=await this[_0x41054b(0x11f)](_0x41054b(0xc2),!![]);this[_0x41054b(0xf8)](_0x46273b[_0x41054b(0x17a)],_0x46273b[_0x41054b(0x18f)],{'success':_0x211660>0x0,'message':_0x211660+_0x41054b(0x199)},_0x46273b[_0x41054b(0xff)]);}else{if(_0x46273b['command']==='getLtmData'){if(!this[_0x41054b(0x17f)])return this[_0x41054b(0xf8)](_0x46273b['from'],_0x46273b[_0x41054b(0x18f)],{'success':![],'isPro':![]},_0x46273b[_0x41054b(0xff)]);let _0x5c62dd={'status':_0x41054b(0xfa),'details':'','lastCheck':0x0};try{_0x5c62dd[_0x41054b(0x188)]=(await this[_0x41054b(0x1b1)](LTM_DP_DRIFT_STATUS))[_0x41054b(0x120)],_0x5c62dd['details']=(await this[_0x41054b(0x1b1)](LTM_DP_DRIFT_DETAILS))[_0x41054b(0x120)],_0x5c62dd[_0x41054b(0x1a5)]=(await this[_0x41054b(0x1b1)](LTM_DP_DRIFT_LAST_CHECK))[_0x41054b(0x120)];}catch(_0x4952e7){}this[_0x41054b(0xf8)](_0x46273b[_0x41054b(0x17a)],_0x46273b[_0x41054b(0x18f)],{'success':!![],'isPro':!![],'dailyDigests':this[_0x41054b(0xb9)],'driftAnalysis':_0x5c62dd,'analysisHistory':this[_0x41054b(0xe3)]},_0x46273b[_0x41054b(0xff)]);}else{if(_0x46273b['command']===_0x41054b(0x123)){const _0x2fa9ea=await this[_0x41054b(0x96)](_0x41054b(0x7a),_0x41054b(0x131)),_0x931e99=[];if(_0x2fa9ea)for(const _0xf86adb in _0x2fa9ea){const _0x1069c9=_0x2fa9ea[_0xf86adb],_0x2cb37a=(_0x1069c9[_0x41054b(0x129)]&&typeof _0x1069c9[_0x41054b(0x129)]['name']==='object'?_0x1069c9[_0x41054b(0x129)][_0x41054b(0x10e)]['de']:_0x1069c9[_0x41054b(0x129)]['name'])||_0x1069c9['common'][_0x41054b(0x10e)];_0x931e99['push']({'id':_0xf86adb,'name':_0x2cb37a});}this['sendTo'](_0x46273b[_0x41054b(0x17a)],_0x46273b[_0x41054b(0x18f)],{'success':!![],'enums':_0x931e99},_0x46273b['callback']);}else{if(_0x46273b['command']===_0x41054b(0x103))try{const _0xb37b4c=await this[_0x41054b(0x134)](_0x46273b[_0x41054b(0x197)]||{});this[_0x41054b(0xf8)](_0x46273b[_0x41054b(0x17a)],_0x46273b[_0x41054b(0x18f)],{'success':!![],'devices':_0xb37b4c},_0x46273b[_0x41054b(0xff)]);}catch(_0x2ed8d3){this['sendTo'](_0x46273b[_0x41054b(0x17a)],_0x46273b['command'],{'success':![],'error':_0x2ed8d3[_0x41054b(0x197)]},_0x46273b[_0x41054b(0xff)]);}else{if(_0x46273b['command']===_0x41054b(0x8f)){const {historyId:_0x4f9864,rating:_0x465b9d,comment:_0x1aaf19,alertReason:_0x433aae}=_0x46273b[_0x41054b(0x197)];_0x4f9864&&_0x465b9d?(await this[_0x41054b(0x1a6)]({'timestamp':Date[_0x41054b(0x190)](),'historyId':_0x4f9864,'rating':_0x465b9d,'comment':_0x1aaf19,'alertReason':_0x433aae}),this[_0x41054b(0xf8)](_0x46273b[_0x41054b(0x17a)],_0x46273b['command'],{'success':!![]},_0x46273b[_0x41054b(0xff)])):this[_0x41054b(0xf8)](_0x46273b[_0x41054b(0x17a)],_0x46273b['command'],{'success':![],'error':_0x41054b(0x142)},_0x46273b[_0x41054b(0xff)]);}}}}}}}}}if(require[a0_0x4a3f45(0x8a)]!==module)module[a0_0x4a3f45(0x94)]=_0x2deeaa=>new CogniLiving(_0x2deeaa);else new CogniLiving();