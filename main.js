function a0_0x2f23(){const _0x2804ed=['isGracePeriodActive','splice','recordThermodynamics','enum.rooms.*','User\x20dismissed\x20automation\x20proposal.','.NextHours.Location_1.Day_1.current.temp_value','4910eTZyKH','installRequirementsInVenv','COGNI_CONFIRM_OK','config','LTM.processingStatus','[PYTHON]\x20','event','Ungew√∂hnliches\x20Bewegungsmuster!\x20(Score:\x20','baselineDrift','map','window','door','toLowerCase','motion','ANALYZE_SEQUENCE','16ZFAonv','state','light','set_temperature','installPythonDependencies','exports','exitTimer','vacation','dailyDigests','selectedFunctionIds','values','\x20(Length:\x20','setPresence','details','response','toFixed','WiFi\x20Presence\x20detected\x20->\x20Aborting\x20Exit\x20Timer.\x20User\x20is\x20present.','driftAnalysisTimer','cogni-living\x20adapter\x20starting\x20(v','forEach','actual_temperature','location','bewegung','[RECORDER]\x20Error\x20saving\x20sequence:\x20','.\x20KONTEXT:\x20','analysis.automation.targetValue','setupModeResetScheduler','link_quality','Unknown','pip','simple-api.','automationProposal','ltmStbWindowDays','[RESULT]','initHistory','geminiApiKey','Keine\x20Details.','reachable','useWeather','Keine\x20Termine','subscribeForeignStatesAsync','toString','TRAIN_SECURITY','COGNI_REQUEST_CALL','icons-mfd.','stderr','1636991PeOVpM','ltmLtbWindowDays','length','.\x20ZUSATZ:\x20','logDuplicates','runPythonHealthCheck','üåÖ\x20Daily\x20Briefing:\x0a','üõ°Ô∏è\x20SECURITY\x20CHECK:\x20Score\x20','sound','analysis.training.triggerSecurity','analysis.training.triggerHealth','message','requirements.txt','lowbat','PARTY','rssi','[PYTHON\x20ERR]\x20','\x22\x20install\x20-r\x20\x22','0\x203\x20*\x20*\x20*','flot.','PRIORIT√ÑT:\x20Gesundheit/AAL.','BUTLER\x20Execution\x20Error:\x20','echarts.','push','LTM.baselineStatus','saveFeedback','analysisInterval','onUnload','stringify','loadSystemMode','269620sNYhgy','ROLLE:\x20Data\x20Scientist.\x20ZIEL:\x20Drift\x20erkennen.\x20SCHEMA:\x20{\x20\x22baselineDrift\x22:\x20\x22none|slight|significant|critical\x22,\x20\x22driftDetails\x22:\x20\x22string\x22\x20}\x0a\x0aLTB:\x20','eventHistory','latitude','inactivityThresholdHours','.\x20AUFGABE:\x201.\x20Gesundheit?\x202.\x20Komfort?\x20FORMAT\x20(JSON):\x20{\x20\x22isAlert\x22:\x20boolean,\x20\x22alertReason\x22:\x20\x22string\x22,\x20\x22isEmergency\x22:\x20boolean,\x20\x22summary\x22:\x20\x22string\x22,\x20\x22automationProposal\x22:\x20{\x20\x22detected\x22:\x20boolean,\x20\x22description\x22:\x20\x22string\x22,\x20\x22targetId\x22:\x20\x22string\x22,\x20\x22targetValue\x22:\x20\x22any\x22\x20}\x20}','admin.','Lernphase\x20(','getLtmData','fill','events.history_debug_00','briefingJob','onMessage','analysis.trigger','analysis.training.status','2710575SrCHor','toLocaleTimeString','sendNotification','sendToAsync','\x20=\x20','setHours','analysis.isAlert','Say\x20Hello','Deaktiviert\x20(Pro-Feature)','loadRawEventLog','stopPythonService','Failed:\x20','sendMorningBriefing','city','[PYTHON]\x20Exited\x20code\x20','Fokus\x20auf\x20Komfort.','sequenceTimer','ROLLE:\x20Data\x20Compression\x20Agent.\x20SPRACHE:\x20DE.\x20FORMAT:\x20JSON.\x20ANWEISUNG:\x20Fasse\x20Sensor-Events\x20zusammen.\x20SCHEMA:\x20{\x20\x22summary\x22:\x20\x22string\x22,\x20\x22activityLevel\x22:\x20\x22string\x22\x20}\x20\x0a\x0aEVENTS:\x0a','Fokus\x20auf\x20Familienroutinen.','command','lights','fault','getForeignObjectsAsync','\x20->\x20','close','guest','üìû\x20R√ºckruf\x20anfordern','driftDetails','üêç\x20Python\x20Pong','analysis.health.isAnomaly','üß™\x20Simulating\x20Butler\x20Proposal:\x20','python3','Kein\x20API\x20Key!','getForeignStateAsync','Kein\x20API\x20Key\x20eingegeben.','common','updateBaselineStatus','analysis.automation.autoApply','weatherunderground','scriptEnabled','includes','scanDevices','devices','generateContent','instance','analysis.security.lastScore','cancel','telegram','üêç\x20Using\x20VENV\x20Python:\x20','occupancy','processSensorEvent','sensorLastValues','kontakt','text','analysis.automation.targetId','createAllObjects','expire','ready','scriptProblem','sendToPython','minDaysForBaseline','outdoorSensorId','KALENDER:\x20','systemConfig','initSystemConfig','analysis.security.lastCheck','Verbindung\x20erfolgreich!\x20Antwort:\x20','send','getForeignObjectAsync','.venv','isAlert','üìû\x20R√úCKRUF\x20BITTE!\x20Der\x20Bewohner\x20hat\x20den\x20R√ºckruf-Button\x20gedr√ºckt.','getGenerativeModel','TRAIN_ENERGY','Gemini\x20Error:\x20','licenseKey','Invalid\x20JSON:\x20','onStateChange','Digest','geminiModel','@iobroker/adapter-core','handleTelegramResponse','getEnums','weatherInstance','\x20sequences...','Gemini\x20AI\x20initialized.','analysis.alertReason','targetId','round','notifyPushoverEnabled','split','ltmJob','ack','maintenance','getStateAsync','t√ºr','VACATION','_calName','PONG','runAutopilot','analysis.automation.triggerAction','unknown','Missing\x20data','.communicate.request','rawEventLog','Generating\x20Morning\x20Briefing...','insulation','Started...','events.lastEvent','feedbackHistory','warn','sendTo','stdout','value','TRAINING_COMPLETE','Installing\x20dependencies\x20into\x20venv...','energy','slice','health','.Current.Temperature','setupTelegramListener','analysis.automation.description','blind','getWeatherContext','(((.+)+)+)+$','pip.exe','checkWifiPresence','enum.functions.*','createDailyDigest','bind','notifyPushoverInstance','getMonth','saveCompletedSequence','analysis.energy.insulationScore','shutter','HEALTH_RESULT','\x20Tage)','targetposition','onReady','Briefing\x20Error:\x20','initPresenceSubscriptions','analysis.automation.patternDetected','12ncHAon','loc','setupDriftAnalysisScheduler','fenster','substring','filter','exitGraceTimer','klima','licht','updateAnalysisHistory','lastIndexOf','saveRawEventLog','analysis.activitySummary','name','getCalendarContext','Kalender:\x20Deaktiviert','scanForDevices','6kxNRWY','Alarm','Aktiv\x20(','retry','automation.triggerAction','ANALYZE_HEALTH','LTM.triggerDailyDigest','type','python.exe','notifyTelegramEnabled','runGeminiAnalysis','LTM.driftAnalysis.driftDetails','getHours','.\x20EMERGENCY:\x20','detected','No\x20module\x20named','initSensorSubscriptions','pythonProcess','genAI','config_pending','material.','handlePythonResult','application/json','isPresent','win32','Subscribing\x20to\x20','shift','write','LTM.driftAnalysis','LTM.driftAnalysis.baselineDrift','SIMULATION:\x20Test-Vorschlag\x20f√ºr\x20','PRIORIT√ÑT:\x20Sicherheit.','daswetter','SECURITY_RESULT','notifyTelegramInstance','python_service','temperatur','\x20sensors...','triggerBriefing','alertReason',')\x20-\x20FULL\x20CLASS\x20MODE\x20RECOVERY','systemUUID','recordSequence','analysisTimer','sleepScore','ROLLE:\x20KI-Hausverwalter.\x20PERSONA:\x20','currentSystemMode','getFullYear','N/A\x20(Learning)','modeResetJob','system.presenceWho','level','‚úÖ\x20Alles\x20OK\x20(Reset)]','analysis.history_debug_00','heizung','enum','analysis.analysisHistory','direction','getTime','notifyEmailEnabled','heating','TRAIN_HEALTH','‚ùå\x20PIP\x20INSTALL\x20FAILED:\x20','.data.table','Error\x20launching\x20Python:\x20','temperature','info.','switch','notifyTelegramRecipient','isProVersion','payload','members','timestamp','runBaselineDriftAnalysis','runSecurityCheck','from','pop','some','Scripts','getSystemUUID','ANOMALY','generic','initZombies','service.py','cpu_feature_guard','existsSync','üõ°Ô∏è\x20SECURITY:\x20Sending\x20sequence\x20to\x20Guard\x20for\x20analysis...','status','[RECORDER]\x20Added\x20step\x20to\x20sequence:\x20','Skipped\x20(No\x20AI\x20or\x20Data)','humidity','GUEST','data','setupLtmScheduler','uuid','working','search','vis.','presence','activityLevel','dependencyInstallInProgress','analysisHistory','python3\x20-m\x20venv\x20\x22','‚úÖ\x20Alarm\x20quittiert.\x20System\x20normal.','main','KI-Modell\x20nicht\x20initialisiert','‚ö†Ô∏è\x20SECURITY\x20ALARM:\x20','3881572SxQimo','testContext','dutycycle','system.mode','info','734242sPqjxs','description','platform','weather','isArray','\x20presence\x20devices...','isEmergency','Cogni-Living','subscribeStates','aiPersona','testApiKey','Vom\x20Benutzer\x20best√§tigt\x20(OK).','Success:\x20','startsWith','.\x20ANWESEND:\x20','models/gemini-flash-latest','getCalendarNames','setStateAsync','stdin','toISOString','LTM.trainingData.sequences','getDate','0\x204\x20*\x20*\x20*','debug','now','.\x20WETTER:\x20','autoApply','bin','inactivityMonitoringEnabled','isExit','.forecast.current.temperature','getOutsideTemperatureNumeric','livingContext','.\x20SYSTEM_MODE:\x20','analysis.training.triggerEnergy','notifyEmailInstance','val','Adapter','NORMAL','lastAlertState','Feedback:\x20','object','javascript.','5174981XJrxNP','saveDailyDigests','ical.0','ü§ñ\x20BUTLER:\x20No\x20valid\x20target\x20ID\x20or\x20value\x20stored\x20for\x20execution.','log','Training\x20Error:\x20','parse','firmware','abortExitTimer','longitude','Bibliotheken\x20nicht\x20gefunden','activeSequence','stick_unreach','/100.\x20OUTPUT:\x20Text.','startExitTimer','‚ö†Ô∏è\x20VENV\x20missing.\x20Attempting\x20install...','unreach','delObjectAsync','üêç\x20Stopping\x20Python...','analysis.energy.heatingScore','error','startPythonService','replace','join','HEALTH_TRAIN_RESULT','analysis.health.lastCheck','presenceDevices','siren','summary','LTM.trainingData.thermodynamics','‚ùå\x20VENV\x20CREATION\x20FAILED.\x20Please\x20run:\x20sudo\x20apt\x20install\x20python3-venv','14575BFmbnc','analysis.lastResult','setForeignStateAsync','N/A','system.isPresent','executeAutomationAction','.\x20EVENTS:\x20','callback','...','trim','submitFeedback','role','setState'];a0_0x2f23=function(){return _0x2804ed;};return a0_0x2f23();}const a0_0x20ff11=a0_0x3591;(function(_0xc3fc66,_0x371712){const _0x5c7820=a0_0x3591,_0x382ea3=_0xc3fc66();while(!![]){try{const _0xb85e0e=-parseInt(_0x5c7820(0x1ed))/0x1+-parseInt(_0x5c7820(0x329))/0x2*(-parseInt(_0x5c7820(0x2a8))/0x3)+-parseInt(_0x5c7820(0x324))/0x4+parseInt(_0x5c7820(0x20b))/0x5+-parseInt(_0x5c7820(0x2b9))/0x6*(-parseInt(_0x5c7820(0x17e))/0x7)+parseInt(_0x5c7820(0x1bf))/0x8*(parseInt(_0x5c7820(0x21a))/0x9)+parseInt(_0x5c7820(0x1b0))/0xa*(parseInt(_0x5c7820(0x19d))/0xb);if(_0xb85e0e===_0x371712)break;else _0x382ea3['push'](_0x382ea3['shift']());}catch(_0x542e89){_0x382ea3['push'](_0x382ea3['shift']());}}}(a0_0x2f23,0xdd7e0));function a0_0x3591(_0x249528,_0x2ee632){const _0x139e8a=a0_0x2f23();return a0_0x3591=function(_0x755d44,_0x1ae79e){_0x755d44=_0x755d44-0x16e;let _0x2f2317=_0x139e8a[_0x755d44];return _0x2f2317;},a0_0x3591(_0x249528,_0x2ee632);}const a0_0x1ae79e=(function(){let _0x111b0b=!![];return function(_0x1219b1,_0x335054){const _0x5832c1=_0x111b0b?function(){if(_0x335054){const _0x25aa72=_0x335054['apply'](_0x1219b1,arguments);return _0x335054=null,_0x25aa72;}}:function(){};return _0x111b0b=![],_0x5832c1;};}()),a0_0x755d44=a0_0x1ae79e(this,function(){const _0x278066=a0_0x3591;return a0_0x755d44['toString']()[_0x278066(0x319)](_0x278066(0x296))[_0x278066(0x1e8)]()['constructor'](a0_0x755d44)[_0x278066(0x319)]('(((.+)+)+)+$');});a0_0x755d44();'use strict';const utils=require(a0_0x20ff11(0x26a)),{GoogleGenerativeAI}=require('@google/generative-ai'),schedule=require('node-schedule'),{spawn,exec}=require('child_process'),path=require('path'),fs=require('fs'),HISTORY_MAX_SIZE=0x32,RAW_LOG_MAX_SIZE=0x5dc,LTM_MIN_EVENTS_FOR_COMPRESSION=0x5,GEMINI_MODEL=a0_0x20ff11(0x338),LTM_SCHEDULE=a0_0x20ff11(0x1ff),MODE_RESET_SCHEDULE=a0_0x20ff11(0x33f),SEQUENCE_TIMEOUT_MS=0x5*0x3c*0x3e8,MAX_TRAINING_SET_SIZE=0x1f4,THERMO_LOG_SIZE=0x3e8,ANALYSIS_HISTORY_MAX_SIZE=0x64,EXIT_TIMER_MINUTES=0xf,EXIT_GRACE_PERIOD_SECONDS=0x1e,LTM_DP_RAW_LOG='LTM.rawEventLog',LTM_DP_DAILY_DIGESTS='LTM.dailyDigests',LTM_DP_STATUS=a0_0x20ff11(0x1b4),LTM_DP_TRIGGER_DIGEST=a0_0x20ff11(0x2bf),LTM_DP_BASELINE_STATUS=a0_0x20ff11(0x205),LTM_DP_DRIFT_CHANNEL=a0_0x20ff11(0x2d5),LTM_DP_DRIFT_STATUS=a0_0x20ff11(0x2d6),LTM_DP_DRIFT_DETAILS=a0_0x20ff11(0x2c4),LTM_DP_DRIFT_LAST_CHECK='LTM.driftAnalysis.lastCheck',SYSTEM_DP_MODE=a0_0x20ff11(0x327),SYSTEM_MODES={'NORMAL':'normal','VACATION':a0_0x20ff11(0x1c6),'PARTY':'party','GUEST':a0_0x20ff11(0x233)},AUTO_RESET_MODES=[SYSTEM_MODES[a0_0x20ff11(0x1fb)],SYSTEM_MODES[a0_0x20ff11(0x314)]],PERSONA_MAPPING={'generic':'Analysiere\x20ausgewogen.','senior_aal':a0_0x20ff11(0x201),'family':a0_0x20ff11(0x22c),'single_comfort':a0_0x20ff11(0x229),'security':a0_0x20ff11(0x2d8)},ACTIVITY_LEVEL_MAP={'sehr\x20hoch':0x64,'hoch':0x50,'normal':0x3c,'niedrig':0x28,'sehr\x20niedrig':0x14,'inaktiv':0x0},HARD_IGNORE_TERMS=[a0_0x20ff11(0x254),a0_0x20ff11(0x241),'update',a0_0x20ff11(0x18e),a0_0x20ff11(0x1fa),a0_0x20ff11(0x1fc),'connection',a0_0x20ff11(0x277),a0_0x20ff11(0x192),a0_0x20ff11(0x22f),a0_0x20ff11(0x318),a0_0x20ff11(0x2f2),a0_0x20ff11(0x18a),a0_0x20ff11(0x2cc),a0_0x20ff11(0x326),a0_0x20ff11(0x185),a0_0x20ff11(0x1e4),a0_0x20ff11(0x1da)],BAD_NAMES=[a0_0x20ff11(0x2a3),'currentposition',a0_0x20ff11(0x1c0),a0_0x20ff11(0x2ec),a0_0x20ff11(0x28b),'brightness','on','off',a0_0x20ff11(0x2fc),'position',a0_0x20ff11(0x2a0),a0_0x20ff11(0x294),'cover',a0_0x20ff11(0x310),a0_0x20ff11(0x1bd),a0_0x20ff11(0x31b),'occupancy',a0_0x20ff11(0x2fa),a0_0x20ff11(0x313),'power',a0_0x20ff11(0x28e),'setpoint','valve',a0_0x20ff11(0x1d3),a0_0x20ff11(0x1c2)],ADAPTER_BLACKLIST=['system.',a0_0x20ff11(0x211),a0_0x20ff11(0x2fb),a0_0x20ff11(0x31a),'history.',a0_0x20ff11(0x2cd),a0_0x20ff11(0x1eb),a0_0x20ff11(0x200),a0_0x20ff11(0x203),a0_0x20ff11(0x17d),a0_0x20ff11(0x1dd)],IS_WIN=process[a0_0x20ff11(0x32b)]===a0_0x20ff11(0x2d1),VENV_PATH=path[a0_0x20ff11(0x195)](__dirname,a0_0x20ff11(0x25f)),PYTHON_EXE=IS_WIN?path['join'](VENV_PATH,a0_0x20ff11(0x307),a0_0x20ff11(0x2c1)):path[a0_0x20ff11(0x195)](VENV_PATH,a0_0x20ff11(0x16e),'python'),PIP_EXE=IS_WIN?path[a0_0x20ff11(0x195)](VENV_PATH,a0_0x20ff11(0x307),a0_0x20ff11(0x297)):path[a0_0x20ff11(0x195)](VENV_PATH,a0_0x20ff11(0x16e),a0_0x20ff11(0x1dc));class CogniLiving extends utils[a0_0x20ff11(0x178)]{constructor(_0x1ea474){const _0x1d0c88=a0_0x20ff11;super({..._0x1ea474,'name':'cogni-living'}),this[_0x1d0c88(0x20d)]=[],this[_0x1d0c88(0x31e)]=[],this[_0x1d0c88(0x287)]=[],this[_0x1d0c88(0x282)]=[],this['dailyDigests']=[],this[_0x1d0c88(0x24d)]={},this[_0x1d0c88(0x259)]={'latitude':0x0,'longitude':0x0,'city':''},this['isPresent']=!![],this[_0x1d0c88(0x1c5)]=null,this[_0x1d0c88(0x2ae)]=null,this['isGracePeriodActive']=![],this[_0x1d0c88(0x2cb)]=null,this[_0x1d0c88(0x269)]=null,this[_0x1d0c88(0x2e7)]=SYSTEM_MODES[_0x1d0c88(0x179)],this[_0x1d0c88(0x2fe)]=![],this[_0x1d0c88(0x17a)]=![],this[_0x1d0c88(0x2e2)]=_0x1d0c88(0x27f),this[_0x1d0c88(0x2e4)]=null,this[_0x1d0c88(0x275)]=null,this['modeResetJob']=null,this[_0x1d0c88(0x1d0)]=null,this[_0x1d0c88(0x216)]=null,this[_0x1d0c88(0x2ca)]=null,this[_0x1d0c88(0x31d)]=![],this['activeSequence']=[],this[_0x1d0c88(0x22a)]=null,this['on'](_0x1d0c88(0x253),this[_0x1d0c88(0x2a4)][_0x1d0c88(0x29b)](this)),this['on']('stateChange',this[_0x1d0c88(0x267)][_0x1d0c88(0x29b)](this)),this['on']('unload',this[_0x1d0c88(0x208)][_0x1d0c88(0x29b)](this)),this['on']('message',this[_0x1d0c88(0x217)]['bind'](this));}async[a0_0x20ff11(0x2a4)](){const _0x162551=a0_0x20ff11;this[_0x162551(0x182)][_0x162551(0x328)](_0x162551(0x1d1)+this['version']+_0x162551(0x2e1)),await this['initZombies'](),this[_0x162551(0x1b3)][_0x162551(0x265)]=this[_0x162551(0x1b3)][_0x162551(0x265)]||'';try{this[_0x162551(0x2fe)]=await this['checkLicense'](this[_0x162551(0x1b3)][_0x162551(0x265)]);}catch(_0x1c97f1){}if(!this[_0x162551(0x1b3)][_0x162551(0x20f)]||this[_0x162551(0x1b3)][_0x162551(0x20f)]<0.1)this[_0x162551(0x1b3)][_0x162551(0x20f)]=0xc;await this[_0x162551(0x1e1)](),await this['initSystemConfig']();if(this[_0x162551(0x1b3)]['geminiApiKey'])try{this['genAI']=new GoogleGenerativeAI(this[_0x162551(0x1b3)][_0x162551(0x1e2)]),this[_0x162551(0x269)]=this[_0x162551(0x2cb)][_0x162551(0x262)]({'model':GEMINI_MODEL,'generationConfig':{'responseMimeType':_0x162551(0x2cf)}}),this[_0x162551(0x182)][_0x162551(0x328)](_0x162551(0x26f));}catch(_0x313d24){this['log'][_0x162551(0x192)]('Gemini\x20Init\x20Error:\x20'+_0x313d24[_0x162551(0x1f8)]);}await this[_0x162551(0x251)](),await this[_0x162551(0x20a)](),await this[_0x162551(0x223)](),await this['loadDailyDigests'](),this['subscribeStates'](_0x162551(0x218)),this['subscribeStates'](LTM_DP_TRIGGER_DIGEST),this[_0x162551(0x331)](_0x162551(0x327)),this[_0x162551(0x331)]('analysis.triggerBriefing'),this[_0x162551(0x331)](_0x162551(0x27e)),this[_0x162551(0x331)]('analysis.automation.autoApply'),this[_0x162551(0x331)](_0x162551(0x1f6)),this['subscribeStates'](_0x162551(0x1f7)),this[_0x162551(0x331)](_0x162551(0x175)),await this['initSensorSubscriptions'](),await this[_0x162551(0x2a6)](),await this[_0x162551(0x292)](),setTimeout(()=>this['checkWifiPresence'](),0x1388);if(this[_0x162551(0x2e4)])clearInterval(this[_0x162551(0x2e4)]);const _0x55555a=this['config'][_0x162551(0x207)]||0xf;_0x55555a>0x0&&(this[_0x162551(0x2e4)]=setInterval(()=>{const _0x1d763e=_0x162551;this[_0x1d763e(0x27d)]();},_0x55555a*0x3c*0x3e8)),this[_0x162551(0x316)](),this[_0x162551(0x1d9)](),this[_0x162551(0x2aa)](),this['setupBriefingScheduler'](),this[_0x162551(0x193)](),setTimeout(()=>{const _0x141557=_0x162551;if(this[_0x141557(0x2ca)])this[_0x141557(0x1f2)]();},0x1388);}[a0_0x20ff11(0x208)](_0x49f5a1){const _0x4be5d9=a0_0x20ff11;if(this['analysisTimer'])clearInterval(this[_0x4be5d9(0x2e4)]);if(this[_0x4be5d9(0x1d0)])clearInterval(this[_0x4be5d9(0x1d0)]);if(this[_0x4be5d9(0x275)])this[_0x4be5d9(0x275)]['cancel']();if(this['modeResetJob'])this[_0x4be5d9(0x2ea)][_0x4be5d9(0x248)]();if(this['briefingJob'])this[_0x4be5d9(0x216)]['cancel']();if(this[_0x4be5d9(0x1c5)])clearTimeout(this[_0x4be5d9(0x1c5)]);if(this[_0x4be5d9(0x2ae)])clearTimeout(this[_0x4be5d9(0x2ae)]);this['stopPythonService'](),_0x49f5a1();}async[a0_0x20ff11(0x267)](_0x3b9a47,_0x4edc86){const _0x58bc80=a0_0x20ff11;if(!_0x4edc86)return;if(this[_0x58bc80(0x31d)])return;if(_0x3b9a47[_0x58bc80(0x242)](_0x58bc80(0x249))&&_0x3b9a47['endsWith']('communicate.request')&&_0x4edc86[_0x58bc80(0x177)]){await this[_0x58bc80(0x26b)](_0x4edc86[_0x58bc80(0x177)]);return;}if(_0x3b9a47===this['namespace']+'.'+SYSTEM_DP_MODE){_0x4edc86['val']&&Object[_0x58bc80(0x1c9)](SYSTEM_MODES)[_0x58bc80(0x242)](_0x4edc86[_0x58bc80(0x177)])&&(this[_0x58bc80(0x2e7)]=_0x4edc86[_0x58bc80(0x177)],_0x4edc86[_0x58bc80(0x177)]===SYSTEM_MODES[_0x58bc80(0x27a)]?await this['setPresence'](![]):await this['setPresence'](!![]));if(!_0x4edc86['ack'])this[_0x58bc80(0x1a9)](_0x3b9a47,{'val':this[_0x58bc80(0x2e7)],'ack':!![]});return;}if(!_0x4edc86[_0x58bc80(0x276)]){_0x3b9a47[_0x58bc80(0x242)](_0x58bc80(0x218))&&_0x4edc86[_0x58bc80(0x177)]&&(this[_0x58bc80(0x1a9)](_0x3b9a47,{'val':![],'ack':!![]}),this[_0x58bc80(0x2c3)]());if(_0x3b9a47[_0x58bc80(0x242)]('triggerDailyDigest')&&_0x4edc86[_0x58bc80(0x177)]){this['setState'](_0x3b9a47,{'val':![],'ack':!![]});if(this['isProVersion'])this['createDailyDigest']();}_0x3b9a47['includes'](_0x58bc80(0x2df))&&_0x4edc86[_0x58bc80(0x177)]&&(this['setState'](_0x3b9a47,{'val':![],'ack':!![]}),this['sendMorningBriefing']());_0x3b9a47[_0x58bc80(0x242)](_0x58bc80(0x2bd))&&_0x4edc86['val']&&(this[_0x58bc80(0x1a9)](_0x3b9a47,{'val':![],'ack':!![]}),this[_0x58bc80(0x1a2)]());if(_0x3b9a47[_0x58bc80(0x242)]('analysis.training.triggerSecurity')&&_0x4edc86['val']){this[_0x58bc80(0x1a9)](_0x3b9a47,{'val':![],'ack':!![]});if(!this['isProVersion'])return;try{const _0x90ef29=await this[_0x58bc80(0x278)]('LTM.trainingData.sequences');if(_0x90ef29&&_0x90ef29[_0x58bc80(0x177)]){const _0x7311c8=JSON[_0x58bc80(0x184)](_0x90ef29[_0x58bc80(0x177)]);this[_0x58bc80(0x182)][_0x58bc80(0x328)]('üß†\x20Triggering\x20Security\x20Training\x20with\x20'+_0x7311c8['length']+_0x58bc80(0x26e)),this[_0x58bc80(0x33a)](_0x58bc80(0x219),{'val':'Sec-Training\x20started...','ack':!![]}),this[_0x58bc80(0x255)](_0x58bc80(0x1e9),{'sequences':_0x7311c8});}}catch(_0x331b0a){this[_0x58bc80(0x182)][_0x58bc80(0x192)](_0x58bc80(0x183)+_0x331b0a[_0x58bc80(0x1f8)]);}}if(_0x3b9a47['includes'](_0x58bc80(0x1f7))&&_0x4edc86[_0x58bc80(0x177)]){this[_0x58bc80(0x1a9)](_0x3b9a47,{'val':![],'ack':!![]});if(!this[_0x58bc80(0x2fe)])return;try{const _0x155ce1=await this[_0x58bc80(0x278)](LTM_DP_DAILY_DIGESTS);_0x155ce1&&_0x155ce1['val']&&this[_0x58bc80(0x255)](_0x58bc80(0x2f6),{'digests':JSON['parse'](_0x155ce1[_0x58bc80(0x177)])});}catch(_0x52e3b5){}}if(_0x3b9a47[_0x58bc80(0x242)]('analysis.training.triggerEnergy')&&_0x4edc86[_0x58bc80(0x177)]){this['setState'](_0x3b9a47,{'val':![],'ack':!![]});if(!this['isProVersion'])return;try{const _0x19ec7b=await this['getStateAsync']('LTM.trainingData.thermodynamics');_0x19ec7b&&_0x19ec7b[_0x58bc80(0x177)]&&this['sendToPython'](_0x58bc80(0x263),{'points':JSON[_0x58bc80(0x184)](_0x19ec7b[_0x58bc80(0x177)])});}catch(_0x50d19d){}}return;}if(this[_0x58bc80(0x1b3)][_0x58bc80(0x198)]&&this[_0x58bc80(0x1b3)]['presenceDevices'][_0x58bc80(0x242)](_0x3b9a47)){await this[_0x58bc80(0x298)]();return;}const _0x5c85c0=(this[_0x58bc80(0x1b3)]['devices']||[])['find'](_0xe427bf=>_0xe427bf['id']===_0x3b9a47);if(_0x5c85c0)this[_0x58bc80(0x24c)](_0x3b9a47,_0x4edc86,_0x5c85c0);}async[a0_0x20ff11(0x217)](_0x393e88){const _0x38547f=a0_0x20ff11;if(typeof _0x393e88===_0x38547f(0x17c)&&_0x393e88[_0x38547f(0x1f8)]){if(_0x393e88['command']===_0x38547f(0x333)){const _0x168b9b=_0x393e88[_0x38547f(0x1f8)]['apiKey']||this[_0x38547f(0x1b3)][_0x38547f(0x1e2)];if(!_0x168b9b)return this[_0x38547f(0x289)](_0x393e88[_0x38547f(0x304)],_0x393e88[_0x38547f(0x22d)],{'success':![],'message':_0x38547f(0x23c)},_0x393e88[_0x38547f(0x1a4)]);try{const _0x14acf3=new GoogleGenerativeAI(_0x168b9b),_0x4b4ccd=_0x14acf3[_0x38547f(0x262)]({'model':GEMINI_MODEL}),_0x51d43c=await _0x4b4ccd[_0x38547f(0x245)](_0x38547f(0x221)),_0x5ec64d=await _0x51d43c[_0x38547f(0x1cd)],_0x261ccc=_0x5ec64d[_0x38547f(0x24f)]();this[_0x38547f(0x289)](_0x393e88['from'],_0x393e88[_0x38547f(0x22d)],{'success':!![],'message':_0x38547f(0x25c)+_0x261ccc[_0x38547f(0x2ac)](0x0,0x14)+_0x38547f(0x1a5)},_0x393e88['callback']);}catch(_0xdb5b4f){this[_0x38547f(0x289)](_0x393e88['from'],_0x393e88[_0x38547f(0x22d)],{'success':![],'message':'Fehler:\x20'+_0xdb5b4f['message']},_0x393e88[_0x38547f(0x1a4)]);}}else{if(_0x393e88[_0x38547f(0x22d)]===_0x38547f(0x325)){const _0x71f0d2=await this[_0x38547f(0x295)](),_0x1312de=await this[_0x38547f(0x2b6)]();this['sendTo'](_0x393e88[_0x38547f(0x304)],_0x393e88[_0x38547f(0x22d)],{'success':!![],'weather':_0x71f0d2,'calendar':_0x1312de},_0x393e88['callback']);}else{if(_0x393e88['command']===_0x38547f(0x213)){if(!this[_0x38547f(0x2fe)])return this['sendTo'](_0x393e88[_0x38547f(0x304)],_0x393e88[_0x38547f(0x22d)],{'success':![],'isPro':![]},_0x393e88[_0x38547f(0x1a4)]);let _0x184e1c={'status':_0x38547f(0x1a0),'details':''};try{const _0x21e59c=await this[_0x38547f(0x278)](LTM_DP_DRIFT_STATUS),_0x10465e=await this[_0x38547f(0x278)](LTM_DP_DRIFT_DETAILS);_0x184e1c[_0x38547f(0x310)]=_0x21e59c?_0x21e59c['val']:_0x38547f(0x1a0),_0x184e1c[_0x38547f(0x1cc)]=_0x10465e?_0x10465e[_0x38547f(0x177)]:'';}catch(_0x159e3f){}this[_0x38547f(0x289)](_0x393e88[_0x38547f(0x304)],_0x393e88[_0x38547f(0x22d)],{'success':!![],'isPro':!![],'dailyDigests':this[_0x38547f(0x1c7)],'driftAnalysis':_0x184e1c,'analysisHistory':this[_0x38547f(0x31e)]},_0x393e88[_0x38547f(0x1a4)]);}else{if(_0x393e88[_0x38547f(0x22d)]==='getOverviewData'){const _0x2fab9e=this[_0x38547f(0x1c7)][_0x38547f(0x1ef)],_0x34ddc0=new Date(),_0x250aa9=new Date(_0x34ddc0[_0x38547f(0x2e8)](),_0x34ddc0[_0x38547f(0x29d)](),_0x34ddc0[_0x38547f(0x33e)]())[_0x38547f(0x2f3)](),_0x467e42=this[_0x38547f(0x282)][_0x38547f(0x2ad)](_0x6c23c7=>new Date(_0x6c23c7['timestamp'])['getTime']()>_0x250aa9)[_0x38547f(0x1ef)],_0x2a0fc6=new Array(0x18)[_0x38547f(0x214)](0x0);this[_0x38547f(0x282)][_0x38547f(0x1d2)](_0x20fdf8=>{const _0x34b447=_0x38547f,_0x181e51=new Date(_0x20fdf8['timestamp']);if(_0x181e51[_0x34b447(0x2f3)]()>_0x250aa9)_0x2a0fc6[_0x181e51[_0x34b447(0x2c5)]()]++;});let _0xb331={'status':_0x38547f(0x1a0)};try{const _0x44bf37=await this[_0x38547f(0x278)](LTM_DP_DRIFT_STATUS);_0xb331[_0x38547f(0x310)]=_0x44bf37?_0x44bf37[_0x38547f(0x177)]:'N/A';}catch(_0x23bf66){}let _0x43d079='';try{const _0x44bbed=await this[_0x38547f(0x278)]('system.presenceWho');_0x43d079=_0x44bbed?_0x44bbed[_0x38547f(0x177)]:'';}catch(_0x446216){}let _0x493ff7=null;!this[_0x38547f(0x269)]&&(_0x493ff7=this[_0x38547f(0x1b3)][_0x38547f(0x1e2)]?_0x38547f(0x322):_0x38547f(0x23a));let _0x141d44={'detected':![],'description':'','targetId':'','targetValue':'','autoApply':![]};try{const _0x26b926=await this['getStateAsync'](_0x38547f(0x2a7)),_0xd89f39=await this[_0x38547f(0x278)]('analysis.automation.description'),_0x393c9e=await this['getStateAsync'](_0x38547f(0x250)),_0x5a25ae=await this[_0x38547f(0x278)](_0x38547f(0x1d8)),_0x299f8f=await this['getStateAsync'](_0x38547f(0x23f));_0x26b926&&_0x26b926[_0x38547f(0x177)]&&(_0x141d44[_0x38547f(0x2c7)]=!![],_0x141d44[_0x38547f(0x32a)]=_0xd89f39?_0xd89f39[_0x38547f(0x177)]:'',_0x141d44[_0x38547f(0x271)]=_0x393c9e?_0x393c9e[_0x38547f(0x177)]:'',_0x141d44['targetValue']=_0x5a25ae?_0x5a25ae[_0x38547f(0x177)]:''),_0x141d44[_0x38547f(0x343)]=_0x299f8f?!!_0x299f8f[_0x38547f(0x177)]:![];}catch(_0x19ac59){}this[_0x38547f(0x289)](_0x393e88[_0x38547f(0x304)],_0x393e88[_0x38547f(0x22d)],{'success':!![],'eventHistory':this[_0x38547f(0x20d)][_0x38547f(0x28f)](0x0,0xf),'stats':{'digestCount':_0x2fab9e,'eventCountToday':_0x467e42,'hourlyActivity':_0x2a0fc6,'driftStatus':_0xb331[_0x38547f(0x310)],'isPresent':this['isPresent'],'presenceWho':_0x43d079,'minDays':this['config']['minDaysForBaseline']||0x7,'stbDays':this[_0x38547f(0x1b3)][_0x38547f(0x1df)]||0xe,'ltbDays':this[_0x38547f(0x1b3)]['ltmLtbWindowDays']||0x3c,'systemError':_0x493ff7},'automation':_0x141d44},_0x393e88[_0x38547f(0x1a4)]);}else{if(_0x393e88['command']===_0x38547f(0x243))try{const _0x1f3804=await this[_0x38547f(0x2b8)](_0x393e88[_0x38547f(0x1f8)]||{});this['sendTo'](_0x393e88[_0x38547f(0x304)],_0x393e88[_0x38547f(0x22d)],{'success':!![],'devices':_0x1f3804},_0x393e88[_0x38547f(0x1a4)]);}catch(_0x34964d){this[_0x38547f(0x289)](_0x393e88[_0x38547f(0x304)],_0x393e88[_0x38547f(0x22d)],{'success':![],'error':_0x34964d[_0x38547f(0x1f8)]},_0x393e88['callback']);}else{if(_0x393e88[_0x38547f(0x22d)]===_0x38547f(0x26c)){const _0x240aee=await this[_0x38547f(0x230)](_0x38547f(0x299),_0x38547f(0x2f0)),_0x51f774=[];if(_0x240aee)for(const _0xd872c1 in _0x240aee){const _0x23cf58=_0x240aee[_0xd872c1],_0xca3437=(_0x23cf58[_0x38547f(0x23d)]&&typeof _0x23cf58[_0x38547f(0x23d)][_0x38547f(0x2b5)]===_0x38547f(0x17c)?_0x23cf58[_0x38547f(0x23d)]['name']['de']:_0x23cf58[_0x38547f(0x23d)][_0x38547f(0x2b5)])||_0x23cf58['common'][_0x38547f(0x2b5)];_0x51f774[_0x38547f(0x204)]({'id':_0xd872c1,'name':_0xca3437});}this[_0x38547f(0x289)](_0x393e88[_0x38547f(0x304)],_0x393e88[_0x38547f(0x22d)],{'success':!![],'enums':_0x51f774},_0x393e88[_0x38547f(0x1a4)]);}else{if(_0x393e88['command']==='getCalendarNames'){const _0x62827b=_0x393e88[_0x38547f(0x1f8)][_0x38547f(0x246)];if(!_0x62827b)return this[_0x38547f(0x289)](_0x393e88['from'],_0x393e88[_0x38547f(0x22d)],{'success':![],'error':'No\x20instance'},_0x393e88['callback']);const _0x4daf1d=await this[_0x38547f(0x339)](_0x62827b);this[_0x38547f(0x289)](_0x393e88[_0x38547f(0x304)],_0x393e88[_0x38547f(0x22d)],{'success':!![],'names':_0x4daf1d},_0x393e88[_0x38547f(0x1a4)]);}else{if(_0x393e88[_0x38547f(0x22d)]==='simulateButler'){const {targetId:_0x2d46ed,targetValue:_0x22c26c}=_0x393e88[_0x38547f(0x1f8)];this['log'][_0x38547f(0x328)](_0x38547f(0x238)+_0x2d46ed+_0x38547f(0x21e)+_0x22c26c),await this[_0x38547f(0x33a)](_0x38547f(0x2a7),{'val':!![],'ack':!![]}),await this[_0x38547f(0x33a)]('analysis.automation.description',{'val':_0x38547f(0x2d7)+_0x2d46ed,'ack':!![]}),await this[_0x38547f(0x33a)]('analysis.automation.targetId',{'val':_0x2d46ed,'ack':!![]}),await this[_0x38547f(0x33a)](_0x38547f(0x1d8),{'val':_0x22c26c,'ack':!![]}),this[_0x38547f(0x289)](_0x393e88[_0x38547f(0x304)],_0x393e88[_0x38547f(0x22d)],{'success':!![]},_0x393e88[_0x38547f(0x1a4)]);}else{if(_0x393e88[_0x38547f(0x22d)]===_0x38547f(0x1a7)){const {historyId:_0x7960cb,rating:_0x5e9ff9,comment:_0x35a117,alertReason:_0x2b58f1}=_0x393e88[_0x38547f(0x1f8)];_0x7960cb&&_0x5e9ff9?(await this[_0x38547f(0x206)]({'timestamp':Date[_0x38547f(0x341)](),'historyId':_0x7960cb,'rating':_0x5e9ff9,'comment':_0x35a117,'alertReason':_0x2b58f1}),this[_0x38547f(0x289)](_0x393e88['from'],_0x393e88['command'],{'success':!![]},_0x393e88[_0x38547f(0x1a4)])):this[_0x38547f(0x289)](_0x393e88['from'],_0x393e88[_0x38547f(0x22d)],{'success':![],'error':_0x38547f(0x280)},_0x393e88[_0x38547f(0x1a4)]);}else _0x393e88[_0x38547f(0x22d)]==='dismissAutomation'&&(this[_0x38547f(0x182)]['info'](_0x38547f(0x1ae)),await this[_0x38547f(0x33a)](_0x38547f(0x2a7),{'val':![],'ack':!![]}),await this['setStateAsync']('analysis.automation.description',{'val':'','ack':!![]}),this['sendTo'](_0x393e88[_0x38547f(0x304)],_0x393e88['command'],{'success':!![]},_0x393e88[_0x38547f(0x1a4)]));}}}}}}}}}}async['processSensorEvent'](_0x1ce0ff,_0x52c5a5,_0x74aa0){const _0x4c2280=a0_0x20ff11;if(!_0x74aa0)return;const _0x4d575d=_0x52c5a5[_0x4c2280(0x177)],_0x38a897=Date[_0x4c2280(0x341)](),_0x53b4c9=this[_0x4c2280(0x24d)][_0x1ce0ff];this[_0x4c2280(0x24d)][_0x1ce0ff]=_0x4d575d;if(!_0x74aa0[_0x4c2280(0x1f1)]&&_0x53b4c9!=undefined&&_0x53b4c9==_0x4d575d)return;const _0x5d3533=(_0x74aa0['type']||'')[_0x4c2280(0x1bc)](),_0x1ea6eb=_0x5d3533[_0x4c2280(0x242)](_0x4c2280(0x2fa))||_0x5d3533['includes'](_0x4c2280(0x2dd))||_0x5d3533[_0x4c2280(0x242)](_0x4c2280(0x2af))||_0x5d3533[_0x4c2280(0x242)](_0x4c2280(0x2ef));this[_0x4c2280(0x2fe)]&&_0x1ea6eb&&this[_0x4c2280(0x1ac)](_0x1ce0ff,_0x4d575d,_0x74aa0[_0x4c2280(0x1d4)]);const _0x110956={'timestamp':_0x38a897,'id':_0x1ce0ff,'name':_0x74aa0[_0x4c2280(0x2b5)],'type':_0x74aa0[_0x4c2280(0x2c0)],'location':_0x74aa0[_0x4c2280(0x1d4)],'value':_0x4d575d};this[_0x4c2280(0x20d)]['unshift'](_0x110956);if(this[_0x4c2280(0x20d)]['length']>HISTORY_MAX_SIZE)this[_0x4c2280(0x20d)][_0x4c2280(0x305)]();await this[_0x4c2280(0x33a)](_0x4c2280(0x286),{'val':JSON[_0x4c2280(0x209)](_0x110956),'ack':!![]}),await this['setStateAsync']('events.history',{'val':JSON[_0x4c2280(0x209)](this[_0x4c2280(0x20d)]),'ack':!![]});this[_0x4c2280(0x2fe)]&&(this[_0x4c2280(0x282)]['push'](_0x110956),await this[_0x4c2280(0x2b3)](),this[_0x4c2280(0x2e3)](_0x110956));if(_0x74aa0[_0x4c2280(0x170)]&&_0x4d575d===!![]){if(this['isPresent']&&!this[_0x4c2280(0x1aa)])this[_0x4c2280(0x18c)]();else{if(!this['isPresent'])this[_0x4c2280(0x1cb)](!![]);}}else{if(_0x74aa0[_0x4c2280(0x2c0)]===_0x4c2280(0x1bd)&&_0x4d575d===!![]){if(this[_0x4c2280(0x1c5)])this[_0x4c2280(0x186)]();if(!this[_0x4c2280(0x2d0)]&&this['currentSystemMode']===SYSTEM_MODES[_0x4c2280(0x179)])this['setPresence'](!![]);}}}async[a0_0x20ff11(0x2e3)](_0x56b18b){const _0x48d472=a0_0x20ff11,_0x4b573f=(_0x56b18b[_0x48d472(0x2c0)]||'')['toLowerCase'](),_0x321a0d=['motion',_0x48d472(0x1d5),'pr√§senz',_0x48d472(0x31b),_0x48d472(0x24b),_0x48d472(0x1bb),_0x48d472(0x279),_0x48d472(0x1ba),_0x48d472(0x2ab),'contact',_0x48d472(0x24e),'light',_0x48d472(0x2b0),_0x48d472(0x2fc),'schalter','dimmer','lampe'];if(!_0x321a0d[_0x48d472(0x306)](_0x344f25=>_0x4b573f[_0x48d472(0x242)](_0x344f25)))return;if(!_0x56b18b[_0x48d472(0x28b)])return;if(this[_0x48d472(0x22a)])clearTimeout(this[_0x48d472(0x22a)]);this[_0x48d472(0x189)]['push']({'loc':_0x56b18b['location']||_0x48d472(0x1db),'id':_0x56b18b['id'],'ts':Date[_0x48d472(0x341)]()}),this[_0x48d472(0x182)][_0x48d472(0x340)](_0x48d472(0x311)+_0x56b18b[_0x48d472(0x1d4)]+_0x48d472(0x1ca)+this['activeSequence'][_0x48d472(0x1ef)]+')'),this[_0x48d472(0x22a)]=setTimeout(async()=>{const _0x17d7f5=_0x48d472;if(this[_0x17d7f5(0x189)][_0x17d7f5(0x1ef)]>0x1)await this[_0x17d7f5(0x29e)]();this[_0x17d7f5(0x189)]=[];},SEQUENCE_TIMEOUT_MS);}async[a0_0x20ff11(0x29e)](){const _0x3381a7=a0_0x20ff11;try{const _0x3984a3=await this[_0x3381a7(0x278)](_0x3381a7(0x33d));let _0x446c34=[];if(_0x3984a3&&_0x3984a3[_0x3381a7(0x177)])try{_0x446c34=JSON[_0x3381a7(0x184)](_0x3984a3[_0x3381a7(0x177)]);}catch(_0xdb05a1){}const _0x2ea200=this[_0x3381a7(0x189)][0x0]['ts'],_0xc30b30=this[_0x3381a7(0x189)][_0x3381a7(0x1b9)](_0x45cc8c=>({'loc':_0x45cc8c[_0x3381a7(0x2a9)],'t_delta':Math[_0x3381a7(0x272)]((_0x45cc8c['ts']-_0x2ea200)/0x3e8)})),_0xe5b8cf={'timestamp':new Date(_0x2ea200)['toISOString'](),'steps':_0xc30b30,'duration':Math['round']((this[_0x3381a7(0x189)][this['activeSequence'][_0x3381a7(0x1ef)]-0x1]['ts']-_0x2ea200)/0x3e8),'daytime':new Date(_0x2ea200)[_0x3381a7(0x2c5)]()};_0x446c34['push'](_0xe5b8cf);if(_0x446c34['length']>MAX_TRAINING_SET_SIZE)_0x446c34[_0x3381a7(0x2d3)]();await this['setStateAsync'](_0x3381a7(0x33d),{'val':JSON[_0x3381a7(0x209)](_0x446c34),'ack':!![]}),this[_0x3381a7(0x303)](_0xe5b8cf);}catch(_0x583789){this[_0x3381a7(0x182)]['error'](_0x3381a7(0x1d6)+_0x583789['message']);}}[a0_0x20ff11(0x303)](_0x5c8854){const _0x153595=a0_0x20ff11;if(!this[_0x153595(0x2fe)])return;this['log']['debug'](_0x153595(0x30f)),this[_0x153595(0x255)](_0x153595(0x1be),{'sequence':_0x5c8854});}[a0_0x20ff11(0x1c3)](){const _0x1c56c7=a0_0x20ff11;if(this['dependencyInstallInProgress'])return;this['dependencyInstallInProgress']=!![];const _0x351518=path['join'](__dirname,_0x1c56c7(0x2dc),_0x1c56c7(0x1f9));this[_0x1c56c7(0x182)]['info']('üõ†Ô∏è\x20MAINTENANCE\x20MODE:\x20Installing\x20Python\x20dependencies.\x20Do\x20not\x20restart!'),this[_0x1c56c7(0x224)]();if(fs[_0x1c56c7(0x30e)](VENV_PATH)){if(!fs[_0x1c56c7(0x30e)](PIP_EXE)){this['log'][_0x1c56c7(0x288)]('‚ö†Ô∏è\x20Broken\x20venv\x20detected.\x20Repairing...');try{fs['rmSync'](VENV_PATH,{'recursive':!![],'force':!![]});}catch(_0x38b040){}}}!fs[_0x1c56c7(0x30e)](VENV_PATH)?exec(_0x1c56c7(0x31f)+VENV_PATH+'\x22',_0x3f877d=>{const _0x4ef2be=_0x1c56c7;if(_0x3f877d){this[_0x4ef2be(0x182)]['error'](_0x4ef2be(0x19c)),this[_0x4ef2be(0x31d)]=![];return;}this[_0x4ef2be(0x1b1)](_0x351518);}):this['installRequirementsInVenv'](_0x351518);}[a0_0x20ff11(0x1b1)](_0x5c6051){const _0x13e3c2=a0_0x20ff11;this[_0x13e3c2(0x182)]['info'](_0x13e3c2(0x28d));const _0xec7f10='\x22'+PIP_EXE+_0x13e3c2(0x1fe)+_0x5c6051+'\x22';exec(_0xec7f10,{'timeout':0x124f80,'maxBuffer':0x400*0x400*0x32},_0x126b2e=>{const _0x413c48=_0x13e3c2;this[_0x413c48(0x31d)]=![],_0x126b2e?this[_0x413c48(0x182)][_0x413c48(0x192)](_0x413c48(0x2f7)+_0x126b2e[_0x413c48(0x1f8)]):(this[_0x413c48(0x182)][_0x413c48(0x328)]('‚úÖ\x20INSTALLATION\x20COMPLETE.\x20Starting\x20Service...'),this[_0x413c48(0x193)]());});}[a0_0x20ff11(0x193)](){const _0x3e9755=a0_0x20ff11;if(this[_0x3e9755(0x31d)])return;let _0x43f3e0=_0x3e9755(0x239);if(fs[_0x3e9755(0x30e)](PYTHON_EXE))this[_0x3e9755(0x182)][_0x3e9755(0x328)](_0x3e9755(0x24a)+PYTHON_EXE),_0x43f3e0=PYTHON_EXE;else{this[_0x3e9755(0x182)][_0x3e9755(0x288)](_0x3e9755(0x18d)),this[_0x3e9755(0x1c3)]();return;}try{const _0x31cbed=path[_0x3e9755(0x195)](__dirname,_0x3e9755(0x2dc),_0x3e9755(0x30c));this[_0x3e9755(0x2ca)]=spawn(_0x43f3e0,[_0x31cbed]),this[_0x3e9755(0x2ca)][_0x3e9755(0x28a)]['on'](_0x3e9755(0x315),_0x55094c=>{const _0x154872=_0x3e9755,_0xa0db79=_0x55094c[_0x154872(0x1e8)]()[_0x154872(0x274)]('\x0a');_0xa0db79['forEach'](_0x3186ce=>{const _0x4b8022=_0x154872,_0x55d386=_0x3186ce[_0x4b8022(0x1a6)]();if(!_0x55d386)return;if(_0x55d386[_0x4b8022(0x336)]('[LOG]'))this['log'][_0x4b8022(0x340)](_0x4b8022(0x1b5)+_0x55d386[_0x4b8022(0x2ac)](0x5)['trim']());else{if(_0x55d386[_0x4b8022(0x336)](_0x4b8022(0x1e0)))try{const _0x5f18ae=JSON[_0x4b8022(0x184)](_0x55d386['substring'](0x8)[_0x4b8022(0x1a6)]());this[_0x4b8022(0x2ce)](_0x5f18ae);}catch(_0xb0d602){this[_0x4b8022(0x182)]['warn'](_0x4b8022(0x266)+_0x55d386);}}(_0x55d386['includes'](_0x4b8022(0x2c8))||_0x55d386[_0x4b8022(0x242)](_0x4b8022(0x188)))&&(this['log']['warn']('‚ö†Ô∏è\x20Python\x20missing\x20libs.\x20Auto-Install\x20triggered.'),this[_0x4b8022(0x1c3)]());});}),this['pythonProcess'][_0x3e9755(0x1ec)]['on'](_0x3e9755(0x315),_0x1525dc=>{const _0x647bca=_0x3e9755,_0x342c14=_0x1525dc['toString']()['trim']();if(!_0x342c14[_0x647bca(0x242)](_0x647bca(0x30d)))this[_0x647bca(0x182)][_0x647bca(0x192)](_0x647bca(0x1fd)+_0x342c14);}),this[_0x3e9755(0x2ca)]['on'](_0x3e9755(0x232),_0x381b40=>{const _0x1f49f0=_0x3e9755;this['log'][_0x1f49f0(0x328)](_0x1f49f0(0x228)+_0x381b40),this[_0x1f49f0(0x2ca)]=null;});}catch(_0x265684){this['log'][_0x3e9755(0x192)](_0x3e9755(0x2f9)+_0x265684['message']);}}[a0_0x20ff11(0x224)](){const _0x2570f9=a0_0x20ff11;if(this[_0x2570f9(0x2ca)]){this['log'][_0x2570f9(0x328)](_0x2570f9(0x190));try{this['pythonProcess']['kill']();}catch(_0x1e4ab0){}this[_0x2570f9(0x2ca)]=null;}}[a0_0x20ff11(0x2ce)](_0x46a245){const _0x3c2872=a0_0x20ff11;if(_0x46a245[_0x3c2872(0x2c0)]===_0x3c2872(0x27c))this['log'][_0x3c2872(0x340)](_0x3c2872(0x236));else{if(_0x46a245['type']===_0x3c2872(0x2da)){const {anomaly_score:_0x42ccf0,is_anomaly:_0x5074e3,threshold:_0x21b000}=_0x46a245[_0x3c2872(0x2ff)];this[_0x3c2872(0x182)][_0x3c2872(0x328)](_0x3c2872(0x1f4)+_0x42ccf0[_0x3c2872(0x1ce)](0x5)+_0x3c2872(0x231)+(_0x5074e3?_0x3c2872(0x309):'OK')),this[_0x3c2872(0x33a)](_0x3c2872(0x247),{'val':_0x42ccf0,'ack':!![]}),this[_0x3c2872(0x33a)](_0x3c2872(0x25b),{'val':new Date()[_0x3c2872(0x33c)](),'ack':!![]});if(_0x5074e3){const _0x5560aa=_0x3c2872(0x1b7)+_0x42ccf0[_0x3c2872(0x1ce)](0x4)+')';this['setStateAsync'](_0x3c2872(0x220),{'val':!![],'ack':!![]}),this['setStateAsync'](_0x3c2872(0x270),{'val':_0x5560aa,'ack':!![]}),this[_0x3c2872(0x21c)](_0x3c2872(0x323)+_0x5560aa,![],!![]);}}else{if(_0x46a245[_0x3c2872(0x2c0)]===_0x3c2872(0x28c)){const {success:_0x2d4684,details:_0x3af2a6}=_0x46a245[_0x3c2872(0x2ff)];this[_0x3c2872(0x33a)](_0x3c2872(0x219),{'val':_0x2d4684?_0x3c2872(0x335)+new Date()[_0x3c2872(0x21b)]()+'\x20('+_0x3af2a6+')':_0x3c2872(0x225)+_0x3af2a6,'ack':!![]});}else{if(_0x46a245[_0x3c2872(0x2c0)]==='ENERGY_TRAIN_RESULT'){const {success:_0x1ae202,details:_0x359341}=_0x46a245[_0x3c2872(0x2ff)];if(_0x1ae202)try{const _0x5c13fc=JSON[_0x3c2872(0x184)](_0x359341);if(_0x5c13fc[_0x3c2872(0x284)])this[_0x3c2872(0x33a)](_0x3c2872(0x29f),{'val':JSON[_0x3c2872(0x209)](_0x5c13fc[_0x3c2872(0x284)]),'ack':!![]});if(_0x5c13fc['heating'])this[_0x3c2872(0x33a)](_0x3c2872(0x191),{'val':JSON[_0x3c2872(0x209)](_0x5c13fc[_0x3c2872(0x2f5)]),'ack':!![]});}catch(_0x2a686f){}}else{if(_0x46a245[_0x3c2872(0x2c0)]===_0x3c2872(0x196)){const {success:_0x59fb90,details:_0x1f963c}=_0x46a245[_0x3c2872(0x2ff)];if(_0x59fb90)this[_0x3c2872(0x182)][_0x3c2872(0x328)]('‚úÖ\x20HEALTH\x20TRAINED:\x20'+_0x1f963c);}else{if(_0x46a245['type']===_0x3c2872(0x2a1)){const {is_anomaly:_0x46864f,details:_0x3709fa}=_0x46a245[_0x3c2872(0x2ff)];this[_0x3c2872(0x33a)](_0x3c2872(0x197),{'val':new Date()[_0x3c2872(0x33c)](),'ack':!![]}),this[_0x3c2872(0x33a)](_0x3c2872(0x237),{'val':_0x46864f,'ack':!![]});}}}}}}}[a0_0x20ff11(0x255)](_0x1ae981,_0x2676cc={}){const _0x24d743=a0_0x20ff11;if(!this[_0x24d743(0x2ca)]||!this[_0x24d743(0x2ca)][_0x24d743(0x33b)]['writable'])return;const _0x23657c=JSON[_0x24d743(0x209)]({'command':_0x1ae981,..._0x2676cc});try{this['pythonProcess'][_0x24d743(0x33b)][_0x24d743(0x2d4)](_0x23657c+'\x0a');}catch(_0x38cf61){}}async[a0_0x20ff11(0x1ac)](_0x1808c3,_0x2a9ffd,_0x9ed185){const _0x2779e8=a0_0x20ff11,_0x38ca9c=await this[_0x2779e8(0x172)](),_0x37d64a=await this[_0x2779e8(0x278)](_0x2779e8(0x19b));let _0x4b504c=[];if(_0x37d64a&&_0x37d64a[_0x2779e8(0x177)])try{_0x4b504c=JSON[_0x2779e8(0x184)](_0x37d64a[_0x2779e8(0x177)]);}catch(_0x28a053){}_0x4b504c[_0x2779e8(0x204)]({'ts':Date['now'](),'room':_0x9ed185||'Unknown','t_in':_0x2a9ffd,'t_out':_0x38ca9c});if(_0x4b504c[_0x2779e8(0x1ef)]>THERMO_LOG_SIZE)_0x4b504c[_0x2779e8(0x2d3)]();await this[_0x2779e8(0x33a)](_0x2779e8(0x19b),{'val':JSON[_0x2779e8(0x209)](_0x4b504c),'ack':!![]});}async['getOutsideTemperatureNumeric'](){const _0x50b798=a0_0x20ff11;if(this[_0x50b798(0x1b3)][_0x50b798(0x257)])try{const _0x50953a=await this[_0x50b798(0x23b)](this[_0x50b798(0x1b3)]['outdoorSensorId']);if(_0x50953a&&_0x50953a['val']!==undefined&&_0x50953a[_0x50b798(0x177)]!==null){const _0x5d10a9=parseFloat(_0x50953a[_0x50b798(0x177)]);if(!isNaN(_0x5d10a9))return _0x5d10a9;}}catch(_0x8f8dd1){}const _0x46feb1=this['config'][_0x50b798(0x26d)];if(!this[_0x50b798(0x1b3)][_0x50b798(0x1e5)]||!_0x46feb1)return null;try{let _0x26e549='';if(_0x46feb1[_0x50b798(0x242)]('accuweather'))_0x26e549=_0x46feb1+_0x50b798(0x291);else{if(_0x46feb1[_0x50b798(0x242)](_0x50b798(0x2d9)))_0x26e549=_0x46feb1+_0x50b798(0x1af);else{if(_0x46feb1[_0x50b798(0x242)]('openweathermap'))_0x26e549=_0x46feb1+_0x50b798(0x171);else{if(_0x46feb1[_0x50b798(0x242)](_0x50b798(0x240)))_0x26e549=_0x46feb1+'.forecast.current.temp';}}}if(_0x26e549){const _0x30804c=await this[_0x50b798(0x23b)](_0x26e549);if(_0x30804c&&_0x30804c[_0x50b798(0x177)]!==undefined&&_0x30804c[_0x50b798(0x177)]!==null)return parseFloat(_0x30804c['val']);}}catch(_0xbf1ea9){}return null;}async[a0_0x20ff11(0x2b8)](_0x459ada){const _0x1095cf=a0_0x20ff11;this[_0x1095cf(0x182)]['info']('Scanning\x20for\x20devices...');const _0x500369=[],_0x50be1a=await this[_0x1095cf(0x230)]('*'),_0x422cda=await this[_0x1095cf(0x230)]('enum.functions.*','enum'),_0x31d011=await this[_0x1095cf(0x230)](_0x1095cf(0x1ad),_0x1095cf(0x2f0)),_0x51237c={};if(_0x422cda)for(const _0x5deea5 in _0x422cda){const _0x7fc9d7=_0x422cda[_0x5deea5][_0x1095cf(0x23d)][_0x1095cf(0x300)]||[];_0x7fc9d7[_0x1095cf(0x1d2)](_0x164f63=>{const _0x184ee9=_0x1095cf;if(!_0x51237c[_0x164f63])_0x51237c[_0x164f63]=[];_0x51237c[_0x164f63][_0x184ee9(0x204)](_0x5deea5);});}const _0x15304d={};if(_0x31d011)for(const _0x55e1f2 in _0x31d011){const _0x2d9e39=_0x31d011[_0x55e1f2][_0x1095cf(0x23d)][_0x1095cf(0x300)]||[],_0x1f7937=typeof _0x31d011[_0x55e1f2][_0x1095cf(0x23d)][_0x1095cf(0x2b5)]===_0x1095cf(0x17c)?_0x31d011[_0x55e1f2][_0x1095cf(0x23d)]['name']['de']:_0x31d011[_0x55e1f2][_0x1095cf(0x23d)][_0x1095cf(0x2b5)];_0x2d9e39['forEach'](_0x36bcb8=>_0x15304d[_0x36bcb8]=_0x1f7937);}const _0x3de818=_0x459ada[_0x1095cf(0x1bd)]!==![],_0x12c246=_0x459ada['doors']!==![],_0x3838d3=_0x459ada[_0x1095cf(0x22e)]!==![],_0x712a28=_0x459ada[_0x1095cf(0x2fa)]===!![],_0x2c1a04=_0x459ada[_0x1095cf(0x32c)]===!![];for(const _0x59feab in _0x50be1a){const _0x2edb22=_0x50be1a[_0x59feab];if(_0x2edb22['type']!==_0x1095cf(0x1c0)||!_0x2edb22[_0x1095cf(0x23d)])continue;if(ADAPTER_BLACKLIST['some'](_0x316ad3=>_0x59feab[_0x1095cf(0x336)](_0x316ad3))&&!_0x2c1a04)continue;const _0x4e3f79=(_0x2edb22[_0x1095cf(0x23d)][_0x1095cf(0x1a8)]||'')[_0x1095cf(0x1bc)]();let _0x227205=(typeof _0x2edb22[_0x1095cf(0x23d)]['name']===_0x1095cf(0x17c)?_0x2edb22[_0x1095cf(0x23d)][_0x1095cf(0x2b5)]['de']:_0x2edb22[_0x1095cf(0x23d)][_0x1095cf(0x2b5)])||_0x59feab;const _0x319142=_0x227205[_0x1095cf(0x1bc)]();let _0xd9adb5=![];if(_0x459ada[_0x1095cf(0x1c8)]&&_0x459ada['selectedFunctionIds'][_0x1095cf(0x1ef)]>0x0){const _0x3d1694=_0x51237c[_0x59feab]||[],_0xd90310=_0x59feab[_0x1095cf(0x274)]('.')[_0x1095cf(0x28f)](0x0,-0x1)[_0x1095cf(0x195)]('.'),_0x48992d=_0x51237c[_0xd90310]||[];(_0x3d1694[_0x1095cf(0x306)](_0x2359ac=>_0x459ada[_0x1095cf(0x1c8)]['includes'](_0x2359ac))||_0x48992d[_0x1095cf(0x306)](_0x5364f9=>_0x459ada[_0x1095cf(0x1c8)]['includes'](_0x5364f9)))&&(_0xd9adb5=!![]);}if(_0x2c1a04&&_0x59feab[_0x1095cf(0x242)]('temperature'))_0xd9adb5=!![];if(!_0xd9adb5&&!_0x2c1a04){if(HARD_IGNORE_TERMS['some'](_0x14399f=>_0x59feab['includes'](_0x14399f)||_0x319142['includes'](_0x14399f['toLowerCase']())))continue;}let _0x26fc78='';if(_0x3de818&&(_0x4e3f79[_0x1095cf(0x242)](_0x1095cf(0x1bd))||_0x4e3f79['includes']('occupancy')))_0x26fc78='motion';else{if(_0x12c246&&(_0x4e3f79[_0x1095cf(0x242)](_0x1095cf(0x1bb))||_0x4e3f79[_0x1095cf(0x242)](_0x1095cf(0x1ba))))_0x26fc78=_0x1095cf(0x1bb);else{if(_0x3838d3&&(_0x4e3f79[_0x1095cf(0x242)]('light')||_0x4e3f79[_0x1095cf(0x242)](_0x1095cf(0x2fc))))_0x26fc78=_0x1095cf(0x1c1);else{if(_0x712a28&&(_0x4e3f79[_0x1095cf(0x242)]('temperature')||_0x4e3f79['includes'](_0x1095cf(0x313))))_0x26fc78='temperature';}}}if(_0x26fc78){let _0xe5d177=_0x15304d[_0x59feab]||'';if(!_0xe5d177){let _0x24cbf8=_0x59feab;for(let _0x20bdab=0x0;_0x20bdab<0x3;_0x20bdab++){const _0x2c8356=_0x24cbf8[_0x1095cf(0x2b2)]('.');if(_0x2c8356===-0x1)break;_0x24cbf8=_0x24cbf8['substring'](0x0,_0x2c8356);if(_0x15304d[_0x24cbf8]){_0xe5d177=_0x15304d[_0x24cbf8];break;}}}_0x500369[_0x1095cf(0x204)]({'id':_0x59feab,'name':_0x227205,'location':_0xe5d177,'type':_0x26fc78,'logDuplicates':_0x26fc78==='motion','isExit':![],'_score':_0xe5d177?0x50:0x28});}}return _0x500369;}async[a0_0x20ff11(0x2c3)](_0x1ccf3f=''){const _0x164b8f=a0_0x20ff11;if(!this[_0x164b8f(0x269)])return;if(this[_0x164b8f(0x20d)][_0x164b8f(0x1ef)]===0x0)return;const _0x3c2c02=this[_0x164b8f(0x20d)]['slice'](0x0,0xf),_0xa136cc=await this[_0x164b8f(0x295)](),_0x10317f=this['currentSystemMode'],_0x1e54bf=PERSONA_MAPPING[this[_0x164b8f(0x1b3)][_0x164b8f(0x332)]||_0x164b8f(0x30a)],_0x438581=this['config']['livingContext']||_0x164b8f(0x1e3);let _0x2b0cbe='Unbekannt';try{const _0x1e777b=await this[_0x164b8f(0x278)](_0x164b8f(0x2eb));if(_0x1e777b&&_0x1e777b[_0x164b8f(0x177)])_0x2b0cbe=_0x1e777b[_0x164b8f(0x177)];}catch(_0x124b15){}let _0x958fa6=![];try{const _0x8a583c=await this[_0x164b8f(0x278)]('analysis.automation.autoApply');if(_0x8a583c&&_0x8a583c[_0x164b8f(0x177)])_0x958fa6=!![];}catch(_0x12fe98){}const _0x3d9f75=_0x164b8f(0x2e6)+_0x1e54bf+_0x164b8f(0x1d7)+_0x438581+_0x164b8f(0x174)+_0x10317f+_0x164b8f(0x342)+_0xa136cc+_0x164b8f(0x337)+_0x2b0cbe+_0x164b8f(0x1a3)+JSON[_0x164b8f(0x209)](_0x3c2c02)+_0x164b8f(0x2c6)+_0x1ccf3f+_0x164b8f(0x210);try{const _0x2dae91=await this[_0x164b8f(0x269)][_0x164b8f(0x245)](_0x3d9f75),_0x5f25a9=JSON[_0x164b8f(0x184)](_0x2dae91['response'][_0x164b8f(0x24f)]()['replace'](/```json|```/g,'')['trim']());await this[_0x164b8f(0x33a)](_0x164b8f(0x19e),{'val':JSON[_0x164b8f(0x209)](_0x5f25a9),'ack':!![]});if(_0x5f25a9[_0x164b8f(0x19a)])await this[_0x164b8f(0x33a)](_0x164b8f(0x2b4),{'val':_0x5f25a9[_0x164b8f(0x19a)],'ack':!![]});const _0x3efb90={'timestamp':Date[_0x164b8f(0x341)](),'id':Date['now']()[_0x164b8f(0x1e8)](),'analysis':{'activity':{'summary':_0x5f25a9[_0x164b8f(0x19a)],'isAlert':_0x5f25a9[_0x164b8f(0x260)],'alertReason':_0x5f25a9[_0x164b8f(0x2e0)]},'comfort':{'automationProposal':_0x5f25a9[_0x164b8f(0x1de)]}}};await this[_0x164b8f(0x2b1)](_0x3efb90);const _0x4924c5=_0x5f25a9[_0x164b8f(0x260)]||![];_0x4924c5!==this[_0x164b8f(0x17a)]&&(await this['setStateAsync'](_0x164b8f(0x220),{'val':_0x4924c5,'ack':!![]}),this[_0x164b8f(0x17a)]=_0x4924c5,_0x4924c5&&(await this[_0x164b8f(0x33a)](_0x164b8f(0x270),{'val':_0x5f25a9[_0x164b8f(0x2e0)],'ack':!![]}),this['sendNotification']('‚ö†Ô∏è\x20ALARM:\x20'+_0x5f25a9['alertReason'],![],_0x5f25a9[_0x164b8f(0x32f)])));if(_0x5f25a9[_0x164b8f(0x1de)]&&_0x5f25a9['automationProposal'][_0x164b8f(0x2c7)]){await this[_0x164b8f(0x33a)](_0x164b8f(0x2a7),{'val':!![],'ack':!![]}),await this[_0x164b8f(0x33a)](_0x164b8f(0x293),{'val':_0x5f25a9[_0x164b8f(0x1de)][_0x164b8f(0x32a)],'ack':!![]}),await this[_0x164b8f(0x33a)](_0x164b8f(0x250),{'val':_0x5f25a9[_0x164b8f(0x1de)][_0x164b8f(0x271)],'ack':!![]}),await this['setStateAsync'](_0x164b8f(0x1d8),{'val':JSON[_0x164b8f(0x209)](_0x5f25a9[_0x164b8f(0x1de)]['targetValue']),'ack':!![]});if(_0x958fa6)this[_0x164b8f(0x1a2)]();}}catch(_0x5bac4f){this[_0x164b8f(0x182)][_0x164b8f(0x192)](_0x164b8f(0x264)+_0x5bac4f['message']);}}async[a0_0x20ff11(0x29a)](){const _0x4904d7=a0_0x20ff11;if(!this['isProVersion'])return;await this['setStateAsync'](LTM_DP_STATUS,{'val':_0x4904d7(0x285),'ack':!![]});if(!this[_0x4904d7(0x269)]||this['rawEventLog']['length']<LTM_MIN_EVENTS_FOR_COMPRESSION){await this[_0x4904d7(0x33a)](LTM_DP_STATUS,{'val':_0x4904d7(0x312),'ack':!![]});return;}const _0x30f3a6=JSON[_0x4904d7(0x184)](JSON[_0x4904d7(0x209)](this[_0x4904d7(0x282)])),_0x190c8a=_0x30f3a6['length'],_0x47d263=_0x4904d7(0x22b)+JSON[_0x4904d7(0x209)](_0x30f3a6);try{const _0x2b416f=await this['geminiModel'][_0x4904d7(0x245)](_0x47d263),_0x34aa6f=JSON[_0x4904d7(0x184)](_0x2b416f[_0x4904d7(0x1cd)][_0x4904d7(0x24f)]()['replace'](/```json|```/g,'')['trim']()),_0x44c000={'timestamp':new Date()[_0x4904d7(0x33c)](),'eventCount':_0x190c8a,'summary':_0x34aa6f[_0x4904d7(0x19a)]||_0x4904d7(0x268),'activityLevel':_0x34aa6f[_0x4904d7(0x31c)]||'normal','systemMode':this['currentSystemMode']};this[_0x4904d7(0x1c7)][_0x4904d7(0x204)](_0x44c000),await this[_0x4904d7(0x17f)](),this[_0x4904d7(0x282)]=[],await this[_0x4904d7(0x2b3)](),await this[_0x4904d7(0x33a)](LTM_DP_STATUS,{'val':'Success','ack':!![]});if(this[_0x4904d7(0x2fe)])this[_0x4904d7(0x255)](_0x4904d7(0x2be),{'digest':_0x44c000});}catch(_0xc2b077){this[_0x4904d7(0x182)]['error'](_0xc2b077[_0x4904d7(0x1f8)]);}}async[a0_0x20ff11(0x302)](){const _0x40eaf1=a0_0x20ff11;if(!this[_0x40eaf1(0x2fe)]||!this[_0x40eaf1(0x269)])return;const _0x198757=this[_0x40eaf1(0x1b3)]['ltmStbWindowDays']||0xe;if(this[_0x40eaf1(0x1c7)][_0x40eaf1(0x1ef)]<_0x198757+0x7){await this[_0x40eaf1(0x33a)](LTM_DP_DRIFT_STATUS,{'val':_0x40eaf1(0x2e9),'ack':!![]});return;}const _0x35e013=this['dailyDigests']['slice'](-_0x198757),_0xaa38ad=this[_0x40eaf1(0x1c7)][_0x40eaf1(0x28f)](0x0,this[_0x40eaf1(0x1c7)]['length']-_0x198757),_0x312a3f=_0x40eaf1(0x20c)+JSON[_0x40eaf1(0x209)](_0xaa38ad)+'\x0aSTB:\x20'+JSON[_0x40eaf1(0x209)](_0x35e013);try{const _0x21219b=await this[_0x40eaf1(0x269)]['generateContent'](_0x312a3f),_0xd7421e=JSON['parse'](_0x21219b[_0x40eaf1(0x1cd)]['text']()[_0x40eaf1(0x194)](/```json|```/g,'')[_0x40eaf1(0x1a6)]());_0xd7421e['baselineDrift']&&(await this[_0x40eaf1(0x33a)](LTM_DP_DRIFT_STATUS,{'val':_0xd7421e[_0x40eaf1(0x1b8)],'ack':!![]}),await this[_0x40eaf1(0x33a)](LTM_DP_DRIFT_DETAILS,{'val':_0xd7421e[_0x40eaf1(0x235)],'ack':!![]}),await this[_0x40eaf1(0x33a)](LTM_DP_DRIFT_LAST_CHECK,{'val':Date[_0x40eaf1(0x341)](),'ack':!![]}));}catch(_0x521a1d){}}async[a0_0x20ff11(0x226)](){const _0x2009b9=a0_0x20ff11;if(!this[_0x2009b9(0x269)])return;this[_0x2009b9(0x182)][_0x2009b9(0x328)](_0x2009b9(0x283));const _0x28d2b7=this[_0x2009b9(0x1c7)]['length']>0x0?this[_0x2009b9(0x1c7)][this[_0x2009b9(0x1c7)][_0x2009b9(0x1ef)]-0x1]:null,_0x1d2ea1=_0x28d2b7&&_0x28d2b7[_0x2009b9(0x290)]?_0x28d2b7[_0x2009b9(0x290)][_0x2009b9(0x2e5)]:'N/A',_0x2a8d71=new Date();_0x2a8d71[_0x2009b9(0x21f)](0x4,0x0,0x0,0x0);const _0x4bad66=this[_0x2009b9(0x20d)][_0x2009b9(0x2ad)](_0x5a7695=>new Date(_0x5a7695[_0x2009b9(0x301)])>_0x2a8d71),_0x3ab6f8=PERSONA_MAPPING[this[_0x2009b9(0x1b3)]['aiPersona']||'generic'],_0x226115=this['config'][_0x2009b9(0x173)]||'',_0x330dce=await this[_0x2009b9(0x295)](),_0x73f65d=await this[_0x2009b9(0x2b6)](),_0x3f6991='ROLLE:\x20Assistent.\x20AUFGABE:\x20Schreibe\x20\x22Guten\x20Morgen\x22-Nachricht.\x20PERSONA:\x20'+_0x3ab6f8+'.\x20KONTEXT:\x20'+_0x226115+_0x2009b9(0x1f0)+_0x330dce+'\x20'+_0x73f65d+'.\x20DATEN:\x20Schlaf\x20'+_0x1d2ea1+_0x2009b9(0x18b);try{const _0x5d4970=await this['geminiModel'][_0x2009b9(0x245)](_0x3f6991),_0x571d2b=_0x2009b9(0x1f3)+_0x5d4970[_0x2009b9(0x1cd)][_0x2009b9(0x24f)]()['trim']();this[_0x2009b9(0x21c)](_0x571d2b);}catch(_0x2c466c){this[_0x2009b9(0x182)]['error'](_0x2009b9(0x2a5)+_0x2c466c[_0x2009b9(0x1f8)]);}}async[a0_0x20ff11(0x27d)](){const _0x47d4ec=a0_0x20ff11,_0x413833=this[_0x47d4ec(0x1b3)][_0x47d4ec(0x20f)],_0x546c98=this['eventHistory'][_0x47d4ec(0x1ef)]>0x0?this[_0x47d4ec(0x20d)][0x0][_0x47d4ec(0x301)]:Date[_0x47d4ec(0x341)](),_0x1e6147=(Date[_0x47d4ec(0x341)]()-_0x546c98)/(0x3e8*0x3c*0x3c);let _0x3cb764='';this[_0x47d4ec(0x1b3)][_0x47d4ec(0x16f)]&&this[_0x47d4ec(0x2e7)]===SYSTEM_MODES['NORMAL']&&this['isPresent']&&(_0x1e6147>_0x413833&&(_0x3cb764='HARD\x20WATCHDOG:\x20No\x20activity\x20for\x20'+_0x1e6147[_0x47d4ec(0x1ce)](0x1)+'h.')),this[_0x47d4ec(0x2c3)](_0x3cb764);}async[a0_0x20ff11(0x339)](_0x5c5fe4){const _0x1cc59a=a0_0x20ff11;try{const _0x5e2c12=await this[_0x1cc59a(0x23b)](_0x5c5fe4+_0x1cc59a(0x2f8));if(_0x5e2c12&&_0x5e2c12['val']){const _0xd357e6=JSON[_0x1cc59a(0x184)](_0x5e2c12['val']);if(Array[_0x1cc59a(0x32d)](_0xd357e6))return[...new Set(_0xd357e6[_0x1cc59a(0x1b9)](_0x54f82a=>_0x54f82a[_0x1cc59a(0x27b)])[_0x1cc59a(0x2ad)](Boolean))]['sort']();}}catch(_0x1390be){}return[];}async[a0_0x20ff11(0x2b6)](){const _0x466299=a0_0x20ff11;if(!this[_0x466299(0x1b3)]['useCalendar'])return _0x466299(0x2b7);const _0x46e5f3=this[_0x466299(0x1b3)]['calendarInstance']||_0x466299(0x180);try{const _0x4123af=await this[_0x466299(0x23b)](_0x46e5f3+_0x466299(0x2f8));if(_0x4123af&&_0x4123af['val']){let _0x5d99b8=JSON[_0x466299(0x184)](_0x4123af[_0x466299(0x177)]);if(Array[_0x466299(0x32d)](_0x5d99b8)){if(_0x5d99b8[_0x466299(0x1ef)]>0x0)return _0x466299(0x258)+_0x5d99b8[_0x466299(0x28f)](0x0,0x3)[_0x466299(0x1b9)](_0x20a4c1=>_0x20a4c1[_0x466299(0x1b6)])[_0x466299(0x195)](',\x20');}}}catch(_0x380f5e){}return _0x466299(0x1e6);}async[a0_0x20ff11(0x206)](_0xddb24a){const _0x356777=a0_0x20ff11;this[_0x356777(0x182)]['info'](_0x356777(0x17b)+JSON[_0x356777(0x209)](_0xddb24a));}async[a0_0x20ff11(0x30b)](){const _0xe0f77e=a0_0x20ff11;try{const _0x3c8157=[_0xe0f77e(0x2ee),_0xe0f77e(0x215)];for(const _0x4ae2a6 of _0x3c8157){try{const _0x5bd3b7=await this['getObjectAsync'](_0x4ae2a6);if(_0x5bd3b7)await this[_0xe0f77e(0x18f)](_0x4ae2a6);}catch(_0x562cfd){}}}catch(_0x22f884){}}async['checkLicense'](_0x4dbf39){return!![];}async[a0_0x20ff11(0x308)](){const _0x187ceb=a0_0x20ff11;return _0x187ceb(0x317);}async[a0_0x20ff11(0x25a)](){const _0x258c82=a0_0x20ff11;try{const _0x1a0c5d=await this[_0x258c82(0x25e)]('system.config');if(_0x1a0c5d&&_0x1a0c5d[_0x258c82(0x23d)])this['systemConfig']={'latitude':_0x1a0c5d[_0x258c82(0x23d)][_0x258c82(0x20e)]||0x0,'longitude':_0x1a0c5d[_0x258c82(0x23d)][_0x258c82(0x187)]||0x0,'city':_0x1a0c5d[_0x258c82(0x23d)][_0x258c82(0x227)]||''};}catch(_0x547063){}}async[a0_0x20ff11(0x223)](){const _0x1181ad=a0_0x20ff11;try{const _0x757c6b=await this['getStateAsync'](LTM_DP_RAW_LOG);if(_0x757c6b&&_0x757c6b[_0x1181ad(0x177)])this[_0x1181ad(0x282)]=JSON['parse'](_0x757c6b[_0x1181ad(0x177)]);}catch(_0x37dbe9){this[_0x1181ad(0x282)]=[];}}async[a0_0x20ff11(0x2b3)](){const _0x4565d5=a0_0x20ff11;if(this['rawEventLog']['length']>RAW_LOG_MAX_SIZE)this['rawEventLog'][_0x4565d5(0x1ab)](0x0,this[_0x4565d5(0x282)][_0x4565d5(0x1ef)]-RAW_LOG_MAX_SIZE);await this[_0x4565d5(0x33a)](LTM_DP_RAW_LOG,{'val':JSON[_0x4565d5(0x209)](this[_0x4565d5(0x282)]),'ack':!![]});}async['loadDailyDigests'](){const _0x14a3fc=a0_0x20ff11;try{const _0x41afbc=await this[_0x14a3fc(0x278)](LTM_DP_DAILY_DIGESTS);if(_0x41afbc&&_0x41afbc[_0x14a3fc(0x177)])this[_0x14a3fc(0x1c7)]=JSON[_0x14a3fc(0x184)](_0x41afbc['val']);}catch(_0x2fa9c2){this['dailyDigests']=[];}}async['saveDailyDigests'](_0x914540=!![]){const _0x4aadf6=a0_0x20ff11,_0x3f5163=this[_0x4aadf6(0x1b3)][_0x4aadf6(0x1ee)]||0x3c;this[_0x4aadf6(0x1c7)][_0x4aadf6(0x1ef)]>_0x3f5163&&this[_0x4aadf6(0x1c7)][_0x4aadf6(0x1ab)](0x0,this[_0x4aadf6(0x1c7)][_0x4aadf6(0x1ef)]-_0x3f5163);await this[_0x4aadf6(0x33a)](LTM_DP_DAILY_DIGESTS,{'val':JSON['stringify'](this[_0x4aadf6(0x1c7)]),'ack':!![]});if(_0x914540)await this[_0x4aadf6(0x23e)]();}async['updateAnalysisHistory'](_0x3839f9){const _0x500ac5=a0_0x20ff11;this[_0x500ac5(0x31e)]['unshift'](_0x3839f9);if(this[_0x500ac5(0x31e)][_0x500ac5(0x1ef)]>ANALYSIS_HISTORY_MAX_SIZE)this[_0x500ac5(0x31e)]['pop']();await this[_0x500ac5(0x33a)](_0x500ac5(0x2f1),{'val':JSON['stringify'](this['analysisHistory']),'ack':!![]});}async[a0_0x20ff11(0x23e)](){const _0x3ff758=a0_0x20ff11;if(!this[_0x3ff758(0x2fe)]){await this[_0x3ff758(0x33a)](LTM_DP_BASELINE_STATUS,{'val':_0x3ff758(0x222),'ack':!![]});return;}const _0x4eeb6e=this[_0x3ff758(0x1c7)][_0x3ff758(0x1ef)]>=(this[_0x3ff758(0x1b3)]['minDaysForBaseline']||0x7)?_0x3ff758(0x2bb)+this['dailyDigests'][_0x3ff758(0x1ef)]+_0x3ff758(0x2a2):_0x3ff758(0x212)+this[_0x3ff758(0x1c7)][_0x3ff758(0x1ef)]+'/'+(this[_0x3ff758(0x1b3)][_0x3ff758(0x256)]||0x7)+')';await this['setStateAsync'](LTM_DP_BASELINE_STATUS,{'val':_0x4eeb6e,'ack':!![]});}async[a0_0x20ff11(0x2c9)](){const _0x5da385=a0_0x20ff11,_0x1ab835=this[_0x5da385(0x1b3)][_0x5da385(0x244)];if(_0x1ab835&&_0x1ab835[_0x5da385(0x1ef)]>0x0){this[_0x5da385(0x182)][_0x5da385(0x328)](_0x5da385(0x2d2)+_0x1ab835[_0x5da385(0x1ef)]+_0x5da385(0x2de));for(const _0x463683 of _0x1ab835){if(_0x463683['id']){await this['subscribeForeignStatesAsync'](_0x463683['id']);try{const _0x2108c9=await this[_0x5da385(0x23b)](_0x463683['id']);if(_0x2108c9)this['sensorLastValues'][_0x463683['id']]=_0x2108c9['val'];}catch(_0x2fe800){}}}}}async['initPresenceSubscriptions'](){const _0x2b9261=a0_0x20ff11,_0x12dbfb=this[_0x2b9261(0x1b3)][_0x2b9261(0x198)]||[];if(_0x12dbfb[_0x2b9261(0x1ef)]>0x0){this['log'][_0x2b9261(0x328)](_0x2b9261(0x2d2)+_0x12dbfb[_0x2b9261(0x1ef)]+_0x2b9261(0x32e));for(const _0x3acaf8 of _0x12dbfb){await this[_0x2b9261(0x1e7)](_0x3acaf8);}try{await this['checkWifiPresence']();}catch(_0x28d67c){}}}async['setupTelegramListener'](){const _0x506f30=a0_0x20ff11,_0x66f83d=this[_0x506f30(0x1b3)][_0x506f30(0x2db)];this[_0x506f30(0x1b3)][_0x506f30(0x2c2)]&&_0x66f83d&&await this['subscribeForeignStatesAsync'](_0x66f83d+_0x506f30(0x281));}async['handleTelegramResponse'](_0xf695f7){const _0x1403be=a0_0x20ff11;let _0x276156=_0xf695f7;_0xf695f7[_0x1403be(0x336)]('[')&&(_0x276156=_0xf695f7[_0x1403be(0x2ac)](_0xf695f7['indexOf'](']')+0x1));if(_0x276156===_0x1403be(0x1b2))await this[_0x1403be(0x33a)](_0x1403be(0x220),{'val':![],'ack':!![]}),await this['setStateAsync'](_0x1403be(0x270),{'val':_0x1403be(0x334),'ack':!![]}),this[_0x1403be(0x17a)]=![],this[_0x1403be(0x21c)](_0x1403be(0x320),![]);else _0x276156===_0x1403be(0x1ea)&&this['sendNotification'](_0x1403be(0x261),![],!![]);}async[a0_0x20ff11(0x21c)](_0x44310a,_0x2b4dce=![],_0x279489=![]){const _0xb87521=a0_0x20ff11,_0x3091e6=this[_0xb87521(0x1b3)];if(_0x3091e6[_0xb87521(0x2c2)]){let _0xdb9525={};(_0x44310a['includes'](_0xb87521(0x2ba))||_0x279489)&&(_0xdb9525={'reply_markup':{'inline_keyboard':[[{'text':_0xb87521(0x2ed),'callback_data':'COGNI_CONFIRM_OK'}],[{'text':_0xb87521(0x234),'callback_data':_0xb87521(0x1ea)}]]}}),await this[_0xb87521(0x21d)](_0x3091e6[_0xb87521(0x2db)],_0xb87521(0x25d),{'text':_0x44310a,'user':_0x3091e6[_0xb87521(0x2fd)],..._0xdb9525});}if(_0x3091e6[_0xb87521(0x273)]){let _0x459db5={'message':_0x44310a,'title':_0x279489?'üö®\x20EMERGENCY':_0xb87521(0x330),'priority':_0x279489?0x2:0x1,'device':_0x3091e6['notifyPushoverRecipient']};_0x279489&&(_0x459db5[_0xb87521(0x2bc)]=0x1e,_0x459db5[_0xb87521(0x252)]=0xe10,_0x459db5[_0xb87521(0x1f5)]=_0xb87521(0x199)),await this[_0xb87521(0x21d)](_0x3091e6[_0xb87521(0x29c)],_0xb87521(0x25d),_0x459db5);}_0x3091e6[_0xb87521(0x2f4)]&&await this[_0xb87521(0x21d)](_0x3091e6[_0xb87521(0x176)],_0xb87521(0x25d),{'text':_0x44310a,'to':_0x3091e6['notifyEmailRecipient']});}async['checkWifiPresence'](){const _0x39b346=a0_0x20ff11;try{const _0xff0240=this[_0x39b346(0x1b3)][_0x39b346(0x198)]||[];let _0x2b4881=![];const _0x4ad003=[];for(const _0x4dc04b of _0xff0240){try{const _0x2eb12a=await this[_0x39b346(0x23b)](_0x4dc04b);if(_0x2eb12a&&(_0x2eb12a[_0x39b346(0x177)]===!![]||_0x2eb12a[_0x39b346(0x177)]==='online'||_0x2eb12a['val']===0x1)){_0x2b4881=!![];const _0x1d3014=await this[_0x39b346(0x25e)](_0x4dc04b);let _0x1c8a98=_0x4dc04b;_0x1d3014&&_0x1d3014[_0x39b346(0x23d)]&&_0x1d3014[_0x39b346(0x23d)][_0x39b346(0x2b5)]&&(_0x1c8a98=typeof _0x1d3014[_0x39b346(0x23d)][_0x39b346(0x2b5)]===_0x39b346(0x17c)?_0x1d3014[_0x39b346(0x23d)][_0x39b346(0x2b5)]['de']||_0x1d3014[_0x39b346(0x23d)][_0x39b346(0x2b5)]['en']:_0x1d3014['common'][_0x39b346(0x2b5)]),_0x4ad003[_0x39b346(0x204)](_0x1c8a98);}}catch(_0x9fe255){}}return await this['setStateAsync'](_0x39b346(0x2eb),{'val':_0x4ad003[_0x39b346(0x195)](',\x20'),'ack':!![]}),_0x2b4881&&(this[_0x39b346(0x1c5)]&&(this['log'][_0x39b346(0x328)](_0x39b346(0x1cf)),this[_0x39b346(0x186)]()),!this['isPresent']&&this[_0x39b346(0x2e7)]===SYSTEM_MODES[_0x39b346(0x179)]&&await this[_0x39b346(0x1cb)](!![])),_0x2b4881;}catch(_0x10d624){return this[_0x39b346(0x182)][_0x39b346(0x192)]('Error\x20checking\x20WiFi:\x20'+_0x10d624[_0x39b346(0x1f8)]),![];}}[a0_0x20ff11(0x18c)](){const _0x48b62f=a0_0x20ff11;this[_0x48b62f(0x186)](),this[_0x48b62f(0x1aa)]=!![],this['exitGraceTimer']=setTimeout(()=>{const _0x5be9c5=_0x48b62f;this[_0x5be9c5(0x1aa)]=![];},EXIT_GRACE_PERIOD_SECONDS*0x3e8),this['exitTimer']=setTimeout(()=>{const _0x445252=_0x48b62f;this[_0x445252(0x1cb)](![]),this[_0x445252(0x1c5)]=null;},EXIT_TIMER_MINUTES*0x3c*0x3e8);}[a0_0x20ff11(0x186)](){const _0x32fb9e=a0_0x20ff11;if(this[_0x32fb9e(0x1c5)])clearTimeout(this[_0x32fb9e(0x1c5)]);if(this[_0x32fb9e(0x2ae)])clearTimeout(this[_0x32fb9e(0x2ae)]);this[_0x32fb9e(0x1c5)]=null,this[_0x32fb9e(0x2ae)]=null,this['isGracePeriodActive']=![];}async[a0_0x20ff11(0x1cb)](_0x1fc755){const _0x13799b=a0_0x20ff11;if(this[_0x13799b(0x2d0)]===_0x1fc755)return;this[_0x13799b(0x2d0)]=_0x1fc755,await this[_0x13799b(0x33a)](_0x13799b(0x1a1),{'val':_0x1fc755,'ack':!![]});}async[a0_0x20ff11(0x1a2)](){const _0x51f049=a0_0x20ff11;try{const _0x41a9a7=await this['getStateAsync'](_0x51f049(0x250)),_0x5d7475=await this[_0x51f049(0x278)](_0x51f049(0x1d8));if(_0x41a9a7&&_0x41a9a7[_0x51f049(0x177)]&&_0x5d7475){const _0x267aab=_0x41a9a7['val'];let _0x48ebcf=_0x5d7475[_0x51f049(0x177)];try{_0x48ebcf=JSON['parse'](_0x48ebcf);}catch(_0x4aacd3){}this[_0x51f049(0x182)][_0x51f049(0x328)]('ü§ñ\x20BUTLER:\x20Executing\x20Action\x20->\x20'+_0x267aab+'\x20=\x20'+_0x48ebcf),await this[_0x51f049(0x19f)](_0x267aab,_0x48ebcf);}else this['log'][_0x51f049(0x288)](_0x51f049(0x181));}catch(_0x2ccca8){this[_0x51f049(0x182)][_0x51f049(0x192)](_0x51f049(0x202)+_0x2ccca8[_0x51f049(0x1f8)]);}}}if(require[a0_0x20ff11(0x321)]!==module)module[a0_0x20ff11(0x1c4)]=_0x3ae1a1=>new CogniLiving(_0x3ae1a1);else new CogniLiving();