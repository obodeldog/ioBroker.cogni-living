const a0_0x150f03=a0_0x141e;function a0_0x141e(_0x647db2,_0xb4bb9c){const _0x549ae4=a0_0x3b12();return a0_0x141e=function(_0x1798fd,_0x347158){_0x1798fd=_0x1798fd-0xce;let _0x3b1295=_0x549ae4[_0x1798fd];return _0x3b1295;},a0_0x141e(_0x647db2,_0xb4bb9c);}(function(_0x4a7396,_0x4bf99b){const _0x23da0c=a0_0x141e,_0x97c573=_0x4a7396();while(!![]){try{const _0x4788b8=parseInt(_0x23da0c(0x1de))/0x1+parseInt(_0x23da0c(0x1e5))/0x2*(parseInt(_0x23da0c(0x19b))/0x3)+-parseInt(_0x23da0c(0x20d))/0x4*(-parseInt(_0x23da0c(0x103))/0x5)+-parseInt(_0x23da0c(0x183))/0x6+-parseInt(_0x23da0c(0x194))/0x7*(-parseInt(_0x23da0c(0x1c3))/0x8)+-parseInt(_0x23da0c(0xf5))/0x9+parseInt(_0x23da0c(0xda))/0xa;if(_0x4788b8===_0x4bf99b)break;else _0x97c573['push'](_0x97c573['shift']());}catch(_0x1b8e3f){_0x97c573['push'](_0x97c573['shift']());}}}(a0_0x3b12,0x63174));const a0_0x347158=(function(){let _0x2ce030=!![];return function(_0x4cf0bd,_0x5e7a9b){const _0x29db0d=_0x2ce030?function(){const _0x1f096e=a0_0x141e;if(_0x5e7a9b){const _0x2e99ba=_0x5e7a9b[_0x1f096e(0xec)](_0x4cf0bd,arguments);return _0x5e7a9b=null,_0x2e99ba;}}:function(){};return _0x2ce030=![],_0x29db0d;};}()),a0_0x1798fd=a0_0x347158(this,function(){const _0xe2d752=a0_0x141e;return a0_0x1798fd[_0xe2d752(0x20b)]()[_0xe2d752(0xe0)](_0xe2d752(0x141))[_0xe2d752(0x20b)]()[_0xe2d752(0xfa)](a0_0x1798fd)[_0xe2d752(0xe0)]('(((.+)+)+)+$');});a0_0x1798fd();'use strict';const utils=require('@iobroker/adapter-core'),{GoogleGenerativeAI}=require(a0_0x150f03(0xd2)),schedule=require(a0_0x150f03(0x181)),HISTORY_MAX_SIZE=0x32,FEEDBACK_MAX_SIZE=0x14,GEMINI_MODEL=a0_0x150f03(0x16b),ANALYSIS_HISTORY_MAX_SIZE=0x64,RAW_LOG_MAX_SIZE=0x5dc,DAILY_DIGEST_MAX_SIZE_LIMIT=0xb4,LTM_MIN_EVENTS_FOR_COMPRESSION=0x5,LTM_SCHEDULE=a0_0x150f03(0x212),LTM_DP_RAW_LOG=a0_0x150f03(0x1cd),LTM_DP_DAILY_DIGESTS=a0_0x150f03(0xdb),LTM_DP_STATUS=a0_0x150f03(0xdd),LTM_DP_TRIGGER_DIGEST=a0_0x150f03(0xf4),LTM_DP_BASELINE_STATUS=a0_0x150f03(0xdf),LTM_DP_DRIFT_CHANNEL=a0_0x150f03(0x11b),LTM_DP_DRIFT_STATUS=a0_0x150f03(0x134),LTM_DP_DRIFT_DETAILS=a0_0x150f03(0x202),LTM_DP_DRIFT_LAST_CHECK='LTM.driftAnalysis.lastCheck',SYSTEM_DP_MODE=a0_0x150f03(0xd4),MODE_RESET_SCHEDULE='0\x204\x20*\x20*\x20*',SYSTEM_MODES={'NORMAL':'normal','VACATION':a0_0x150f03(0xf9),'PARTY':a0_0x150f03(0x20f),'GUEST':a0_0x150f03(0x1cc)},AUTO_RESET_MODES=[SYSTEM_MODES[a0_0x150f03(0x170)],SYSTEM_MODES[a0_0x150f03(0x167)]],EXIT_TIMER_MINUTES=0xf,EXIT_GRACE_PERIOD_SECONDS=0x1e,PERSONA_MAPPING={'generic':a0_0x150f03(0x131),'senior_aal':a0_0x150f03(0x1e1),'family':a0_0x150f03(0x13d),'single_comfort':'Fokus\x20auf\x20Maximierung\x20von\x20Komfort,\x20Automatisierungseffizienz\x20und\x20Energieeinsparung.','security':a0_0x150f03(0x196)};class CogniLiving extends utils[a0_0x150f03(0xf6)]{constructor(_0x5cb787){const _0x3df3f7=a0_0x150f03;super({..._0x5cb787,'name':'cogni-living'}),this[_0x3df3f7(0x19e)]=[],this[_0x3df3f7(0xf2)]=[],this[_0x3df3f7(0x1ef)]=[],this[_0x3df3f7(0x116)]=[],this['dailyDigests']=[],this[_0x3df3f7(0x11f)]={},this[_0x3df3f7(0x106)]={'latitude':0x0,'longitude':0x0,'city':''},this['isPresent']=!![],this[_0x3df3f7(0x1ed)]=null,this['exitGraceTimer']=null,this[_0x3df3f7(0x1b4)]=![],this[_0x3df3f7(0x1e2)]=null,this['geminiModel']=null,this[_0x3df3f7(0x111)]=SYSTEM_MODES[_0x3df3f7(0xee)],this[_0x3df3f7(0x1fe)]=![],this[_0x3df3f7(0x105)]=![],this['systemUUID']=_0x3df3f7(0xed),this[_0x3df3f7(0x14d)]=null,this[_0x3df3f7(0x1ad)]=null,this[_0x3df3f7(0x1f7)]=null,this['driftAnalysisTimer']=null,this['on'](_0x3df3f7(0x150),this[_0x3df3f7(0xf7)][_0x3df3f7(0x10e)](this)),this['on'](_0x3df3f7(0x10f),this['onStateChange'][_0x3df3f7(0x10e)](this)),this['on'](_0x3df3f7(0x175),this[_0x3df3f7(0x122)][_0x3df3f7(0x10e)](this)),this['on'](_0x3df3f7(0xfd),this[_0x3df3f7(0xdc)][_0x3df3f7(0x10e)](this));}async[a0_0x150f03(0xf7)](){const _0x32f642=a0_0x150f03;this['log'][_0x32f642(0x18d)](_0x32f642(0x178)+this[_0x32f642(0x126)]+_0x32f642(0x1e4)),await this[_0x32f642(0x186)](),this[_0x32f642(0x21f)][_0x32f642(0x1d6)]=this[_0x32f642(0x21f)][_0x32f642(0x1d6)]||'',this[_0x32f642(0x1fe)]=await this[_0x32f642(0x218)](this[_0x32f642(0x21f)][_0x32f642(0x1d6)]);if(!this['config'][_0x32f642(0x1eb)]||this[_0x32f642(0x21f)][_0x32f642(0x1eb)]<0.1)this['config'][_0x32f642(0x1eb)]=0xc;await this['loadHistoryFromState']();try{const _0x21c8a2=await this['getForeignObjectAsync'](_0x32f642(0x14c));_0x21c8a2&&_0x21c8a2[_0x32f642(0x159)]&&(this[_0x32f642(0x106)]={'latitude':_0x21c8a2['common'][_0x32f642(0x147)]||0x0,'longitude':_0x21c8a2['common']['longitude']||0x0,'city':_0x21c8a2[_0x32f642(0x159)]['city']||''},this[_0x32f642(0x1bc)]['info'](_0x32f642(0x12b)+this[_0x32f642(0x106)][_0x32f642(0x1b3)]));}catch(_0x4a0fe1){this[_0x32f642(0x1bc)][_0x32f642(0x1c4)](_0x32f642(0x1d4));}if(this[_0x32f642(0x21f)][_0x32f642(0x13a)])try{this[_0x32f642(0x1e2)]=new GoogleGenerativeAI(this['config']['geminiApiKey']),this['geminiModel']=this[_0x32f642(0x1e2)][_0x32f642(0x1dc)]({'model':GEMINI_MODEL,'generationConfig':{'responseMimeType':_0x32f642(0x11d)}}),this['log'][_0x32f642(0x18d)](_0x32f642(0x184));}catch(_0x277386){this['log']['error'](_0x32f642(0x174)+_0x277386[_0x32f642(0xfd)]);}else this[_0x32f642(0x1bc)]['warn']('Gemini\x20API\x20Key\x20missing.\x20AI\x20features\x20disabled.');await this[_0x32f642(0x1a6)](),await this['loadSystemMode'](),await this[_0x32f642(0x12f)](),await this[_0x32f642(0x123)](),this['subscribeStates'](_0x32f642(0xf1)),this['subscribeStates'](LTM_DP_TRIGGER_DIGEST),this[_0x32f642(0x1f5)](_0x32f642(0xd4));const _0x3ae460=this['config'][_0x32f642(0x143)];if(_0x3ae460&&_0x3ae460[_0x32f642(0x190)]>0x0){this[_0x32f642(0x1bc)][_0x32f642(0x18d)](_0x32f642(0x187)+_0x3ae460[_0x32f642(0x190)]+'\x20sensors...');for(const _0x5506a9 of _0x3ae460){if(_0x5506a9['id']){await this[_0x32f642(0x172)](_0x5506a9['id']);try{const _0x18adea=await this[_0x32f642(0x195)](_0x5506a9['id']);if(_0x18adea)this[_0x32f642(0x11f)][_0x5506a9['id']]=_0x18adea[_0x32f642(0x179)];}catch(_0x535a41){}}}}if(this[_0x32f642(0x14d)])clearInterval(this[_0x32f642(0x14d)]);const _0x3e0707=this[_0x32f642(0x21f)][_0x32f642(0x1bd)]||0xf;_0x3e0707>0x0&&(this[_0x32f642(0x1bc)][_0x32f642(0x18d)]('Starting\x20Autopilot\x20('+_0x3e0707+_0x32f642(0x18e)+this[_0x32f642(0x21f)]['inactivityThresholdHours']+'h.'),this[_0x32f642(0x14d)]=setInterval(()=>this[_0x32f642(0x139)](),_0x3e0707*0x3c*0x3e8)),this[_0x32f642(0x18f)](),this[_0x32f642(0x1a2)](),this[_0x32f642(0xfe)]();}async[a0_0x150f03(0x186)](){const _0x42dba5=a0_0x150f03,_0x2ef7ad=[_0x42dba5(0x19a),_0x42dba5(0x166),_0x42dba5(0xf8),_0x42dba5(0x1f2),_0x42dba5(0x10c),_0x42dba5(0x1ca),'events.history_debug_01',_0x42dba5(0x169),'events.history_debug_03',_0x42dba5(0x114)];for(const _0xfd392c of _0x2ef7ad){try{const _0x555186=await this[_0x42dba5(0x1a4)](_0xfd392c);_0x555186&&await this['delObjectAsync'](_0xfd392c);}catch(_0x17d554){}}}async['loadHistoryFromState'](){const _0x38497e=a0_0x150f03;try{const _0x82c105=await this[_0x38497e(0x1a0)](_0x38497e(0x1cf));_0x82c105&&_0x82c105[_0x38497e(0x179)]&&(this['eventHistory']=JSON[_0x38497e(0x1db)](_0x82c105[_0x38497e(0x179)][_0x38497e(0x20b)]()),this['log'][_0x38497e(0x18d)](_0x38497e(0x17f)+this[_0x38497e(0x19e)][_0x38497e(0x190)]+_0x38497e(0x165)));}catch(_0x2a5216){this[_0x38497e(0x19e)]=[];}try{const _0x53e249=await this[_0x38497e(0x1a0)](_0x38497e(0x1aa));if(_0x53e249&&_0x53e249[_0x38497e(0x179)])this[_0x38497e(0xf2)]=JSON[_0x38497e(0x1db)](_0x53e249[_0x38497e(0x179)]['toString']());}catch(_0x38c765){this['analysisHistory']=[];}}['onStateChange'](_0x3e4f5b,_0x1ab8f3){const _0x5b6937=a0_0x150f03;if(!_0x1ab8f3)return;if(_0x3e4f5b===this[_0x5b6937(0xef)]+'.'+SYSTEM_DP_MODE){_0x1ab8f3['val']&&Object[_0x5b6937(0x117)](SYSTEM_MODES)['includes'](_0x1ab8f3['val'])&&(this[_0x5b6937(0x111)]=_0x1ab8f3[_0x5b6937(0x179)],_0x1ab8f3['val']===SYSTEM_MODES['VACATION']?this[_0x5b6937(0x18c)](![]):this[_0x5b6937(0x18c)](!![]));if(!_0x1ab8f3[_0x5b6937(0x146)])this[_0x5b6937(0xd0)](_0x3e4f5b,{'val':this[_0x5b6937(0x111)],'ack':!![]});return;}if(!_0x1ab8f3[_0x5b6937(0x146)]){_0x3e4f5b[_0x5b6937(0xe6)](_0x5b6937(0xf1))&&_0x1ab8f3[_0x5b6937(0x179)]&&(this[_0x5b6937(0x1bc)][_0x5b6937(0x18d)](_0x5b6937(0x216)),this[_0x5b6937(0xd0)](_0x3e4f5b,{'val':![],'ack':!![]}),this[_0x5b6937(0x104)]());if(_0x3e4f5b[_0x5b6937(0xe6)](_0x5b6937(0x13e))&&_0x1ab8f3[_0x5b6937(0x179)]){this[_0x5b6937(0xd0)](_0x3e4f5b,{'val':![],'ack':!![]});if(this[_0x5b6937(0x1fe)])this[_0x5b6937(0x152)]();}return;}const _0x5152fd=(this['config'][_0x5b6937(0x143)]||[])[_0x5b6937(0x1d9)](_0x2d5543=>_0x2d5543['id']===_0x3e4f5b);if(_0x5152fd)this[_0x5b6937(0x156)](_0x3e4f5b,_0x1ab8f3,_0x5152fd);}async[a0_0x150f03(0x156)](_0x3e5ebe,_0x4c9b94,_0x3f6482){const _0x55973a=a0_0x150f03;if(!_0x3f6482['logDuplicates']&&this[_0x55973a(0x11f)][_0x3e5ebe]===_0x4c9b94[_0x55973a(0x179)])return;this[_0x55973a(0x11f)][_0x3e5ebe]=_0x4c9b94[_0x55973a(0x179)];if(this[_0x55973a(0x1b4)]){this[_0x55973a(0x1bc)][_0x55973a(0x13b)](_0x55973a(0x1c6)+_0x3f6482['name']);return;}const _0xe646c5=_0x3f6482[_0x55973a(0x158)]===_0x55973a(0x176)&&(_0x3f6482[_0x55973a(0xff)][_0x55973a(0x200)]()[_0x55973a(0xe6)]('haustÃ¼r')||_0x3f6482['name'][_0x55973a(0x200)]()[_0x55973a(0xe6)](_0x55973a(0x177))||_0x3f6482[_0x55973a(0x1f6)][_0x55973a(0x200)]()[_0x55973a(0xe6)](_0x55973a(0x197)));_0xe646c5&&!_0x4c9b94[_0x55973a(0x179)]?this[_0x55973a(0x130)]():(this['exitTimer']&&(this['log']['info'](_0x55973a(0x1f1)),this['abortExitTimer']()),!this['isPresent']&&this[_0x55973a(0x111)]===SYSTEM_MODES['NORMAL']&&this['setPresence'](!![]));const _0x1f0ffe={'timestamp':_0x4c9b94['ts'],'id':_0x3e5ebe,'name':_0x3f6482[_0x55973a(0xff)],'value':_0x4c9b94['val'],'location':_0x3f6482[_0x55973a(0x1f6)],'type':_0x3f6482[_0x55973a(0x158)]};this['eventHistory'][_0x55973a(0x140)](_0x1f0ffe);if(this[_0x55973a(0x19e)][_0x55973a(0x190)]>HISTORY_MAX_SIZE)this[_0x55973a(0x19e)]['pop']();await this[_0x55973a(0xe4)](_0x55973a(0x1c8),{'val':JSON[_0x55973a(0x132)](_0x1f0ffe),'ack':!![]}),await this[_0x55973a(0xe4)](_0x55973a(0x1cf),{'val':JSON['stringify'](this[_0x55973a(0x19e)]),'ack':!![]}),this[_0x55973a(0x116)][_0x55973a(0x1c0)]({'timestamp':new Date(_0x4c9b94['ts'])[_0x55973a(0x180)](),'sensorName':_0x3f6482[_0x55973a(0xff)],'location':_0x3f6482['location'],'value':_0x4c9b94[_0x55973a(0x179)]}),await this['saveRawEventLog']();}[a0_0x150f03(0x130)](){const _0x5e42be=a0_0x150f03;this['log'][_0x5e42be(0x18d)](_0x5e42be(0x16d)+EXIT_TIMER_MINUTES+_0x5e42be(0x108)+EXIT_GRACE_PERIOD_SECONDS+_0x5e42be(0x21b)),this[_0x5e42be(0x138)](),this[_0x5e42be(0x1b4)]=!![],this[_0x5e42be(0x12d)]=setTimeout(()=>{const _0x2f2e34=_0x5e42be;this['isGracePeriodActive']=![],this[_0x2f2e34(0x1bc)][_0x2f2e34(0x13b)]('Exit\x20Grace\x20Period\x20beendet.\x20Ãœberwache\x20nun\x20Innenraum...');},EXIT_GRACE_PERIOD_SECONDS*0x3e8),this['exitTimer']=setTimeout(()=>{const _0x5aded1=_0x5e42be;this[_0x5aded1(0x1bc)][_0x5aded1(0x18d)](_0x5aded1(0x182)),this[_0x5aded1(0x18c)](![]),this['exitTimer']=null;},EXIT_TIMER_MINUTES*0x3c*0x3e8);}[a0_0x150f03(0x138)](){const _0x590dbe=a0_0x150f03;if(this[_0x590dbe(0x1ed)])clearTimeout(this[_0x590dbe(0x1ed)]);if(this[_0x590dbe(0x12d)])clearTimeout(this[_0x590dbe(0x12d)]);this[_0x590dbe(0x1ed)]=null,this[_0x590dbe(0x12d)]=null,this[_0x590dbe(0x1b4)]=![];}async[a0_0x150f03(0x18c)](_0x113259){const _0x13ffd0=a0_0x150f03;if(this['isPresent']===_0x113259)return;this[_0x13ffd0(0x1d1)]=_0x113259,await this[_0x13ffd0(0xe4)]('system.isPresent',{'val':_0x113259,'ack':!![]}),this[_0x13ffd0(0x1bc)][_0x13ffd0(0x18d)](_0x13ffd0(0x209)+(_0x113259?_0x13ffd0(0x1df):_0x13ffd0(0x1ec)));}['runAutopilot'](){const _0x477bae=a0_0x150f03,_0x32f6e4=this[_0x477bae(0x21f)][_0x477bae(0x1eb)],_0x5408e7=this['config'][_0x477bae(0x115)],_0x1bef7e=this[_0x477bae(0x19e)][_0x477bae(0x190)]>0x0?this['eventHistory'][0x0]['timestamp']:Date['now'](),_0x1e22fb=(Date['now']()-_0x1bef7e)/(0x3e8*0x3c*0x3c);let _0x7c07e0='';_0x5408e7&&this[_0x477bae(0x111)]===SYSTEM_MODES[_0x477bae(0xee)]&&this[_0x477bae(0x1d1)]&&(_0x1e22fb>_0x32f6e4&&(this[_0x477bae(0x1bc)]['warn']('ðŸš¨\x20Dead\x20Man\x27s\x20Switch:\x20Keine\x20AktivitÃ¤t\x20seit\x20'+_0x1e22fb['toFixed'](0x1)+_0x477bae(0x162)),_0x7c07e0=_0x477bae(0x201)+_0x1e22fb['toFixed'](0x1)+'\x20hours.\x20The\x20resident\x20might\x20be\x20incapacitated.\x20Risk\x20level:\x20HIGH.'));if(_0x7c07e0){this[_0x477bae(0x104)](_0x7c07e0)[_0x477bae(0x220)](_0x2b6955=>this[_0x477bae(0x1bc)][_0x477bae(0x160)](_0x2b6955));return;}const _0xeba491=Date[_0x477bae(0x213)](),_0x530651=_0xeba491-_0x1bef7e,_0x27d618=(this['config']['analysisInterval']||0xf)*0x3c*0x3e8;this['eventHistory'][_0x477bae(0x190)]>0x0&&_0x530651<=_0x27d618?this['runGeminiAnalysis']()[_0x477bae(0x220)](_0x4c8902=>this['log']['error'](_0x4c8902)):!this[_0x477bae(0x105)]&&(this[_0x477bae(0xd0)](_0x477bae(0x15b),{'val':![],'ack':!![]}),this[_0x477bae(0xd0)](_0x477bae(0x1c9),{'val':![],'ack':!![]}));}async[a0_0x150f03(0x104)](_0x481fec=''){const _0x3714f9=a0_0x150f03;this[_0x3714f9(0x1bc)][_0x3714f9(0x18d)](_0x3714f9(0x16e));if(!this[_0x3714f9(0x217)]){this[_0x3714f9(0x1bc)][_0x3714f9(0x160)](_0x3714f9(0x21a));return;}const _0xe8a03f=this['eventHistory'][_0x3714f9(0x190)]>0x0?this[_0x3714f9(0x19e)]:[{'note':'No\x20recorded\x20events\x20yet.'}],_0x5db0bb=PERSONA_MAPPING[this[_0x3714f9(0x21f)]['aiPersona']||_0x3714f9(0x1fc)],_0x454056=this[_0x3714f9(0x21f)][_0x3714f9(0xe2)]||'',_0x468ea6=this[_0x3714f9(0x111)],_0xa13baf=new Date(),_0xd65b44=_0xa13baf[_0x3714f9(0x151)](_0x3714f9(0x1e0),{'weekday':_0x3714f9(0x1da),'hour':'2-digit','minute':_0x3714f9(0xe5)}),_0x56619e=this[_0x3714f9(0x106)];let _0x46e85a='';if(this[_0x3714f9(0x1ef)][_0x3714f9(0x190)]>0x0){const _0x25b74a=this[_0x3714f9(0x1ef)]['slice'](0x0,0x3)[_0x3714f9(0x129)](_0x3a8538=>_0x3714f9(0xde)+_0x3a8538[_0x3714f9(0x1ea)]+_0x3714f9(0x168)+_0x3a8538['rating']+'.')[_0x3714f9(0x19c)]('\x0a');_0x46e85a=_0x3714f9(0x1af)+_0x25b74a+'\x0a';}const _0x2dd892=_0x481fec?_0x3714f9(0x1c1)+_0x481fec+'\x0a!!!\x20END\x20WARNING\x20!!!\x0a':'',_0x57a84e=_0x3714f9(0x1bb),_0x591182=_0x3714f9(0x1b8)+_0xd65b44+_0x3714f9(0x153)+_0x56619e[_0x3714f9(0x1b3)]+'.\x0a\x20\x20\x20\x20\x20\x20\x20\x20MODUS:\x20'+_0x468ea6+_0x3714f9(0x192)+(this[_0x3714f9(0x1d1)]?'Ja':_0x3714f9(0x20a))+_0x3714f9(0xe3)+_0x454056+_0x3714f9(0x164)+_0x5db0bb+_0x3714f9(0x173)+_0x57a84e+'\x20'+_0x46e85a+'\x20'+_0x2dd892+'\x0a\x20\x20\x20\x20\x20\x20\x20\x20EVENTS:\x20'+JSON['stringify'](_0xe8a03f)+_0x3714f9(0x19f);try{this['log'][_0x3714f9(0x13b)](_0x3714f9(0x109)+_0x591182['length']+')...');const _0x8eefbe=await this['geminiModel']['generateContent'](_0x591182),_0x300a49=_0x8eefbe[_0x3714f9(0x1e7)][_0x3714f9(0x191)]()[_0x3714f9(0x142)](/```json|```/g,'')[_0x3714f9(0xe8)]();this['log']['info'](_0x3714f9(0xf0));const _0x297935=JSON[_0x3714f9(0x1db)](_0x300a49);await this[_0x3714f9(0xe4)](_0x3714f9(0x1b2),{'val':_0x300a49,'ack':!![]}),await this[_0x3714f9(0xe4)](_0x3714f9(0x208),{'val':_0x297935[_0x3714f9(0x1d7)]['alertReason']||'','ack':!![]}),await this[_0x3714f9(0xe4)](_0x3714f9(0x144),{'val':_0x297935[_0x3714f9(0x1d7)][_0x3714f9(0x198)]||_0x3714f9(0x16c),'ack':!![]});const _0x27f12e=_0x297935[_0x3714f9(0x1d7)][_0x3714f9(0x112)]||![],_0x176c5f=_0x297935[_0x3714f9(0x1d7)][_0x3714f9(0x133)]||![];if(_0x27f12e||_0x176c5f){await this[_0x3714f9(0xe4)](_0x3714f9(0x15b),{'val':!![],'ack':!![]}),await this[_0x3714f9(0xe4)](_0x3714f9(0x1c9),{'val':_0x176c5f,'ack':!![]});if(!this[_0x3714f9(0x105)]||_0x176c5f){const _0x52337c=_0x176c5f?_0x3714f9(0x1c2):_0x3714f9(0x205);this[_0x3714f9(0x1f3)](_0x52337c+':\x20'+_0x297935['activity'][_0x3714f9(0x1ea)],![],_0x176c5f);}}else await this[_0x3714f9(0xe4)]('analysis.isAlert',{'val':![],'ack':!![]}),await this['setStateAsync']('analysis.isEmergency',{'val':![],'ack':!![]});this['lastAlertState']=_0x27f12e||_0x176c5f;const _0x346a5b={'timestamp':Date[_0x3714f9(0x213)](),'id':Date[_0x3714f9(0x213)]()['toString'](),'analysis':_0x297935,'systemMode':_0x468ea6,'isPro':this[_0x3714f9(0x1fe)]};this['updateAnalysisHistory'](_0x346a5b);}catch(_0x1e45e2){this[_0x3714f9(0x1bc)][_0x3714f9(0x160)](_0x3714f9(0x188)+_0x1e45e2[_0x3714f9(0xfd)]);}}async['createDailyDigest'](){const _0x1767b7=a0_0x150f03;if(!this['isProVersion'])return;await this[_0x1767b7(0xe4)](LTM_DP_STATUS,{'val':_0x1767b7(0x1d8)+new Date()['toLocaleString'](),'ack':!![]});if(!this['geminiModel']||this[_0x1767b7(0x116)][_0x1767b7(0x190)]<LTM_MIN_EVENTS_FOR_COMPRESSION){await this['setStateAsync'](LTM_DP_STATUS,{'val':_0x1767b7(0x149),'ack':!![]});return;}const _0x2e2eab=JSON['parse'](JSON[_0x1767b7(0x132)](this['rawEventLog'])),_0x17c6f5=(this[_0x1767b7(0x21f)][_0x1767b7(0xe2)]||'')[_0x1767b7(0x1b5)](0x0,0x3e8),_0x268129=_0x1767b7(0x14b)+_0x17c6f5+_0x1767b7(0x120)+JSON['stringify'](_0x2e2eab);try{const _0x5f2a4c=await this[_0x1767b7(0x217)][_0x1767b7(0x11c)](_0x268129),_0x524e1c=JSON[_0x1767b7(0x1db)](_0x5f2a4c[_0x1767b7(0x1e7)]['text']()[_0x1767b7(0x142)](/```json|```/g,'')[_0x1767b7(0xe8)]());_0x524e1c[_0x1767b7(0x198)]&&(this[_0x1767b7(0x20c)][_0x1767b7(0x1c0)]({'timestamp':new Date()[_0x1767b7(0x180)](),'eventCount':_0x2e2eab[_0x1767b7(0x190)],'summary':_0x524e1c[_0x1767b7(0x198)],'activityLevel':_0x524e1c[_0x1767b7(0x1a1)],'systemMode':this[_0x1767b7(0x111)]}),await this[_0x1767b7(0x15a)](),this[_0x1767b7(0x116)]=[],await this['saveRawEventLog'](),await this[_0x1767b7(0xe4)](LTM_DP_STATUS,{'val':_0x1767b7(0x211)+_0x2e2eab[_0x1767b7(0x190)]+'\x20events','ack':!![]}));}catch(_0x2bf66a){await this[_0x1767b7(0xe4)](LTM_DP_STATUS,{'val':_0x1767b7(0x157)+_0x2bf66a[_0x1767b7(0xfd)],'ack':!![]});}}async[a0_0x150f03(0x1a6)](){const _0x1b4940=a0_0x150f03;await this['checkSystemObjects'](),await this[_0x1b4940(0x10d)](_0x1b4940(0x21c),{'type':_0x1b4940(0xea),'common':{'name':'Presence\x20Status','type':_0x1b4940(0xd9),'role':_0x1b4940(0x15f),'read':!![],'write':![],'def':!![]},'native':{}}),await this[_0x1b4940(0x10d)](_0x1b4940(0x1c8),{'type':'state','common':{'name':_0x1b4940(0x18a),'type':_0x1b4940(0x12e),'role':_0x1b4940(0x118),'read':!![],'write':![]},'native':{}}),await this[_0x1b4940(0x10d)](_0x1b4940(0x1cf),{'type':_0x1b4940(0xea),'common':{'name':_0x1b4940(0x13c),'type':_0x1b4940(0x12e),'role':_0x1b4940(0x118),'read':!![],'write':![]},'native':{}}),await this[_0x1b4940(0x10d)]('analysis.trigger',{'type':'state','common':{'name':'Trigger\x20Analysis','type':_0x1b4940(0xd9),'role':'button','read':!![],'write':!![],'def':![]},'native':{}}),await this[_0x1b4940(0x10d)](_0x1b4940(0x1b2),{'type':_0x1b4940(0xea),'common':{'name':_0x1b4940(0x1d0),'type':_0x1b4940(0x12e),'role':'json','read':!![],'write':![]},'native':{}}),await this[_0x1b4940(0x10d)]('analysis.isAlert',{'type':_0x1b4940(0xea),'common':{'name':_0x1b4940(0x203),'type':'boolean','role':'indicator.alarm','read':!![],'write':![],'def':![]},'native':{}}),await this[_0x1b4940(0x10d)](_0x1b4940(0x1c9),{'type':'state','common':{'name':_0x1b4940(0x1b6),'type':_0x1b4940(0xd9),'role':_0x1b4940(0x1cb),'read':!![],'write':![],'def':![]},'native':{}}),await this[_0x1b4940(0x10d)](_0x1b4940(0x208),{'type':_0x1b4940(0xea),'common':{'name':'Alert\x20Reason','type':_0x1b4940(0x12e),'role':_0x1b4940(0x155),'read':!![],'write':![]},'native':{}}),await this[_0x1b4940(0x10d)]('analysis.activitySummary',{'type':_0x1b4940(0xea),'common':{'name':_0x1b4940(0x12a),'type':_0x1b4940(0x12e),'role':'text','read':!![],'write':![]},'native':{}}),await this[_0x1b4940(0x10d)]('analysis.deviationFromBaseline',{'type':_0x1b4940(0xea),'common':{'name':_0x1b4940(0x1a9),'type':'string','role':'state','read':!![],'write':![],'def':_0x1b4940(0x16c)},'native':{}}),await this[_0x1b4940(0x10d)](_0x1b4940(0x1dd),{'type':_0x1b4940(0xea),'common':{'name':'Comfort\x20Summary','type':_0x1b4940(0x12e),'role':_0x1b4940(0x191),'read':!![],'write':![]},'native':{}}),await this[_0x1b4940(0x10d)](_0x1b4940(0x206),{'type':_0x1b4940(0xea),'common':{'name':'Comfort\x20Suggestion','type':_0x1b4940(0x12e),'role':'text','read':!![],'write':![]},'native':{}}),await this[_0x1b4940(0x1c7)]('analysis.automation',{'type':_0x1b4940(0x128),'common':{'name':_0x1b4940(0xf3)},'native':{}}),await this[_0x1b4940(0x10d)](_0x1b4940(0xcf),{'type':_0x1b4940(0xea),'common':{'name':_0x1b4940(0x145),'type':'boolean','role':_0x1b4940(0x15f),'read':!![],'write':![],'def':![]},'native':{}}),await this['setObjectNotExistsAsync'](_0x1b4940(0x219),{'type':_0x1b4940(0xea),'common':{'name':_0x1b4940(0x1ee),'type':_0x1b4940(0x12e),'role':_0x1b4940(0x191),'read':!![],'write':![]},'native':{}}),await this['setObjectNotExistsAsync']('analysis.automation.suggestedAction',{'type':'state','common':{'name':_0x1b4940(0x1ce),'type':_0x1b4940(0x12e),'role':_0x1b4940(0x191),'read':!![],'write':![]},'native':{}}),await this[_0x1b4940(0x10d)](_0x1b4940(0x1aa),{'type':_0x1b4940(0xea),'common':{'name':'Logbook','type':_0x1b4940(0x12e),'role':'json','read':!![],'write':![],'def':'[]'},'native':{}}),await this[_0x1b4940(0x10d)]('analysis.feedbackHistory',{'type':_0x1b4940(0xea),'common':{'name':_0x1b4940(0xe7),'type':_0x1b4940(0x12e),'role':'json','read':!![],'write':![],'def':'[]'},'native':{}}),await this[_0x1b4940(0x135)](),await this['checkLtmDriftObjects']();}async['checkSystemObjects'](){const _0x675969=a0_0x150f03;await this['extendObjectAsync'](_0x675969(0x1ae),{'type':_0x675969(0x128),'common':{'name':'System\x20Status\x20&\x20Control'},'native':{}}),await this['extendObjectAsync'](SYSTEM_DP_MODE,{'type':'state','common':{'name':_0x675969(0x127),'type':_0x675969(0x12e),'role':_0x675969(0xea),'read':!![],'write':!![],'def':SYSTEM_MODES['NORMAL'],'states':{[SYSTEM_MODES[_0x675969(0xee)]]:'Normal',[SYSTEM_MODES[_0x675969(0x1e3)]]:_0x675969(0x1ba),[SYSTEM_MODES[_0x675969(0x170)]]:'Party',[SYSTEM_MODES[_0x675969(0x167)]]:_0x675969(0x210)}},'native':{}});}async[a0_0x150f03(0x1f3)](_0x3e5a00,_0xaac510=![],_0x1ad817=![]){const _0x58d957=a0_0x150f03;this['log'][_0x58d957(0x18d)]((_0xaac510?_0x58d957(0x119):'')+'Sending\x20notification:\x20\x22'+_0x3e5a00+'\x22'+(_0x1ad817?'\x20(EMERGENCY)':''));const _0x1003f6=this[_0x58d957(0x21f)];let _0x48358e=0x0;_0x1003f6[_0x58d957(0x193)]&&_0x1003f6[_0x58d957(0x185)]&&(await this[_0x58d957(0x17e)](_0x1003f6['notifyTelegramInstance'],_0x58d957(0xd6),{'text':_0x3e5a00,'user':_0x1003f6[_0x58d957(0x16f)]}),_0x48358e++);if(_0x1003f6['notifyPushoverEnabled']&&_0x1003f6[_0x58d957(0x17c)]){let _0x15a163={'message':_0x3e5a00,'title':_0x1ad817?_0x58d957(0x1ab):'Cogni-Living\x20Alert','priority':_0x1ad817?0x2:0x1,'device':_0x1003f6[_0x58d957(0x199)]};_0x1ad817&&(_0x15a163[_0x58d957(0x121)]=0x1e,_0x15a163[_0x58d957(0x10b)]=0xe10,_0x15a163[_0x58d957(0x21e)]='siren'),await this['sendToAsync'](_0x1003f6[_0x58d957(0x17c)],_0x58d957(0xd6),_0x15a163),_0x48358e++;}return _0x1003f6[_0x58d957(0x125)]&&_0x1003f6['notifyEmailInstance']&&(await this[_0x58d957(0x17e)](_0x1003f6[_0x58d957(0x14a)],_0x58d957(0xd6),{'text':_0x3e5a00,'to':_0x1003f6[_0x58d957(0xfc)]}),_0x48358e++),_0x1003f6[_0x58d957(0x1f9)]&&_0x1003f6['notifyWhatsappInstance']&&(await this[_0x58d957(0x17e)](_0x1003f6[_0x58d957(0x1b1)],_0x58d957(0xd6),{'text':_0x3e5a00,'phone':_0x1003f6['notifyWhatsappRecipient']}),_0x48358e++),_0x1003f6[_0x58d957(0x207)]&&_0x1003f6[_0x58d957(0xd5)]&&(await this[_0x58d957(0x17e)](_0x1003f6['notifySignalInstance'],_0x58d957(0xd6),{'text':_0x3e5a00,'phone':_0x1003f6[_0x58d957(0x1f0)]}),_0x48358e++),_0x48358e;}async[a0_0x150f03(0x12f)](){const _0x4c2fee=a0_0x150f03;try{const _0x36023a=await this[_0x4c2fee(0x1a0)](LTM_DP_RAW_LOG);if(_0x36023a&&_0x36023a[_0x4c2fee(0x179)])this[_0x4c2fee(0x116)]=JSON['parse'](_0x36023a[_0x4c2fee(0x179)]);}catch(_0x3caa07){this[_0x4c2fee(0x116)]=[];}}async['saveRawEventLog'](){const _0x59ee55=a0_0x150f03;this[_0x59ee55(0x116)][_0x59ee55(0x190)]>RAW_LOG_MAX_SIZE&&this[_0x59ee55(0x116)][_0x59ee55(0x1a3)](0x0,this[_0x59ee55(0x116)][_0x59ee55(0x190)]-RAW_LOG_MAX_SIZE),await this[_0x59ee55(0xe4)](LTM_DP_RAW_LOG,{'val':JSON['stringify'](this[_0x59ee55(0x116)]),'ack':!![]});}async[a0_0x150f03(0x123)](){const _0x457416=a0_0x150f03;try{const _0x4b2cae=await this[_0x457416(0x1a0)](LTM_DP_DAILY_DIGESTS);if(_0x4b2cae&&_0x4b2cae[_0x457416(0x179)])this[_0x457416(0x20c)]=JSON['parse'](_0x4b2cae['val']);}catch(_0x4705fe){this[_0x457416(0x20c)]=[];}await this[_0x457416(0x15d)]();}async['saveDailyDigests'](_0xecb1bc=!![]){const _0x3d4a4b=a0_0x150f03,_0x1ac2c9=this[_0x3d4a4b(0x21f)][_0x3d4a4b(0x100)]||0x3c;this[_0x3d4a4b(0x20c)][_0x3d4a4b(0x190)]>_0x1ac2c9&&this[_0x3d4a4b(0x20c)]['splice'](0x0,this[_0x3d4a4b(0x20c)][_0x3d4a4b(0x190)]-_0x1ac2c9);await this[_0x3d4a4b(0xe4)](LTM_DP_DAILY_DIGESTS,{'val':JSON[_0x3d4a4b(0x132)](this['dailyDigests']),'ack':!![]});if(_0xecb1bc)await this[_0x3d4a4b(0x15d)]();}[a0_0x150f03(0x18f)](){const _0x50458a=a0_0x150f03;if(this[_0x50458a(0x1ad)])this['ltmJob'][_0x50458a(0x1a8)]();if(!this['isProVersion']){this[_0x50458a(0xe4)](LTM_DP_STATUS,{'val':'Deaktiviert\x20(Pro-Feature)','ack':!![]});return;}this['ltmJob']=schedule['scheduleJob'](LTM_SCHEDULE,()=>this['createDailyDigest']());}[a0_0x150f03(0xfe)](){const _0x549210=a0_0x150f03;if(this[_0x549210(0x215)])clearInterval(this[_0x549210(0x215)]);if(!this['isProVersion'])return;this[_0x549210(0x215)]=setInterval(()=>this[_0x549210(0x11e)](),(this[_0x549210(0x21f)][_0x549210(0x1be)]||0x18)*0x36ee80),setTimeout(()=>this[_0x549210(0x11e)](),0x1388);}async[a0_0x150f03(0x101)](){const _0x3f5b7a=a0_0x150f03;await this['setStateAsync'](_0x3f5b7a(0x144),{'val':_0x3f5b7a(0x137),'ack':!![]}),await this['setStateAsync'](_0x3f5b7a(0x124),{'val':this['isProVersion']?_0x3f5b7a(0x214):_0x3f5b7a(0x1d2),'ack':!![]}),await this[_0x3f5b7a(0xe4)]('analysis.isAlert',{'val':![],'ack':!![]}),await this[_0x3f5b7a(0xe4)](_0x3f5b7a(0x1c9),{'val':![],'ack':!![]}),this[_0x3f5b7a(0x105)]=![];}async[a0_0x150f03(0x15c)](_0x30baf7){const _0x313b45=a0_0x150f03;this['analysisHistory'][_0x313b45(0x140)](_0x30baf7);if(this[_0x313b45(0xf2)][_0x313b45(0x190)]>ANALYSIS_HISTORY_MAX_SIZE)this[_0x313b45(0xf2)]['pop']();await this[_0x313b45(0xe4)]('analysis.analysisHistory',{'val':JSON[_0x313b45(0x132)](this['analysisHistory']),'ack':!![]});}[a0_0x150f03(0x1a2)](){const _0x5da9d8=a0_0x150f03;if(this[_0x5da9d8(0x1f7)])this[_0x5da9d8(0x1f7)][_0x5da9d8(0x1a8)]();this[_0x5da9d8(0x1f7)]=schedule['scheduleJob'](MODE_RESET_SCHEDULE,async()=>{const _0x499519=_0x5da9d8;await this['loadSystemMode'](),AUTO_RESET_MODES[_0x499519(0xe6)](this['currentSystemMode'])&&await this[_0x499519(0xe4)](SYSTEM_DP_MODE,{'val':SYSTEM_MODES[_0x499519(0xee)],'ack':![]});});}async[a0_0x150f03(0x15d)](){const _0x25c269=a0_0x150f03;if(!this[_0x25c269(0x1fe)]){await this[_0x25c269(0xe4)](LTM_DP_BASELINE_STATUS,{'val':_0x25c269(0x11a),'ack':!![]});return;}const _0x117b6c=this['dailyDigests'][_0x25c269(0x190)]>=(this[_0x25c269(0x21f)][_0x25c269(0x18b)]||0x7)?_0x25c269(0x1e8)+this[_0x25c269(0x20c)][_0x25c269(0x190)]+_0x25c269(0x1ff):_0x25c269(0x154)+this[_0x25c269(0x20c)][_0x25c269(0x190)]+'/'+(this[_0x25c269(0x21f)][_0x25c269(0x18b)]||0x7)+')';await this[_0x25c269(0xe4)](LTM_DP_BASELINE_STATUS,{'val':_0x117b6c,'ack':!![]});}async[a0_0x150f03(0x135)](){const _0x3051b6=a0_0x150f03;await this[_0x3051b6(0x1c7)](_0x3051b6(0x1ac),{'type':'channel','common':{'name':_0x3051b6(0x1ac)},'native':{}}),await this[_0x3051b6(0x1c7)](LTM_DP_RAW_LOG,{'type':'state','common':{'name':_0x3051b6(0x171),'type':'string','role':_0x3051b6(0x118),'read':!![],'write':![]},'native':{}}),await this[_0x3051b6(0x1c7)](LTM_DP_DAILY_DIGESTS,{'type':_0x3051b6(0xea),'common':{'name':'Daily\x20Digests','type':_0x3051b6(0x12e),'role':_0x3051b6(0x118),'read':!![],'write':![]},'native':{}}),await this['extendObjectAsync'](LTM_DP_STATUS,{'type':_0x3051b6(0xea),'common':{'name':_0x3051b6(0xe1),'type':_0x3051b6(0x12e),'role':_0x3051b6(0x191),'read':!![],'write':![]},'native':{}}),await this['extendObjectAsync'](LTM_DP_TRIGGER_DIGEST,{'type':'state','common':{'name':'Trigger\x20Digest','type':_0x3051b6(0xd9),'role':_0x3051b6(0xfb),'read':!![],'write':!![],'def':![]},'native':{}}),await this[_0x3051b6(0x1c7)](LTM_DP_BASELINE_STATUS,{'type':'state','common':{'name':_0x3051b6(0xd7),'type':_0x3051b6(0x12e),'role':_0x3051b6(0x191),'read':!![],'write':![]},'native':{}});}async['checkLtmDriftObjects'](){const _0x3aa007=a0_0x150f03;await this['extendObjectAsync'](LTM_DP_DRIFT_CHANNEL,{'type':_0x3aa007(0x128),'common':{'name':_0x3aa007(0x204)},'native':{}}),await this['extendObjectAsync'](LTM_DP_DRIFT_STATUS,{'type':'state','common':{'name':_0x3aa007(0x17a),'type':'string','role':_0x3aa007(0xea),'read':!![],'write':![],'def':_0x3aa007(0x16c)},'native':{}}),await this[_0x3aa007(0x1c7)](LTM_DP_DRIFT_DETAILS,{'type':_0x3aa007(0xea),'common':{'name':'Drift\x20Details','type':_0x3aa007(0x12e),'role':_0x3aa007(0x191),'read':!![],'write':![]},'native':{}}),await this['extendObjectAsync'](LTM_DP_DRIFT_LAST_CHECK,{'type':_0x3aa007(0xea),'common':{'name':_0x3aa007(0xe9),'type':_0x3aa007(0x1bf),'role':_0x3aa007(0x1a7),'read':!![],'write':![]},'native':{}});}async[a0_0x150f03(0x11e)](){const _0x8ef891=a0_0x150f03;if(!this[_0x8ef891(0x1fe)]||!this['geminiModel'])return;const _0x43453d=this[_0x8ef891(0x21f)][_0x8ef891(0x1d3)]||0xe;if(this[_0x8ef891(0x20c)][_0x8ef891(0x190)]<_0x43453d+(this[_0x8ef891(0x21f)][_0x8ef891(0x18b)]||0x7)){await this[_0x8ef891(0xe4)](LTM_DP_DRIFT_STATUS,{'val':_0x8ef891(0x17d),'ack':!![]});return;}const _0x35b880=this['dailyDigests'][_0x8ef891(0xd3)](-_0x43453d),_0x566839=this[_0x8ef891(0x20c)]['slice'](0x0,this[_0x8ef891(0x20c)]['length']-_0x43453d),_0x4d93d3=_0x8ef891(0x1e6)+JSON['stringify'](_0x566839)+_0x8ef891(0x1a5)+JSON[_0x8ef891(0x132)](_0x35b880);try{const _0x2d1295=await this['geminiModel'][_0x8ef891(0x11c)](_0x4d93d3),_0x45ee96=JSON[_0x8ef891(0x1db)](_0x2d1295['response'][_0x8ef891(0x191)]()[_0x8ef891(0x142)](/```json|```/g,'')[_0x8ef891(0xe8)]());_0x45ee96[_0x8ef891(0x20e)]&&(await this[_0x8ef891(0xe4)](LTM_DP_DRIFT_STATUS,{'val':_0x45ee96['baselineDrift'],'ack':!![]}),await this[_0x8ef891(0xe4)](LTM_DP_DRIFT_DETAILS,{'val':_0x45ee96[_0x8ef891(0x113)],'ack':!![]}),await this[_0x8ef891(0xe4)](LTM_DP_DRIFT_LAST_CHECK,{'val':Date[_0x8ef891(0x213)](),'ack':!![]}));}catch(_0x42ab6b){}}async[a0_0x150f03(0x1fd)](){const _0x3941d1=a0_0x150f03;try{const _0x277c41=await this[_0x3941d1(0x1a0)](SYSTEM_DP_MODE);_0x277c41&&_0x277c41[_0x3941d1(0x179)]&&Object[_0x3941d1(0x117)](SYSTEM_MODES)['includes'](_0x277c41[_0x3941d1(0x179)])?this['currentSystemMode']=_0x277c41[_0x3941d1(0x179)]:(this[_0x3941d1(0x111)]=SYSTEM_MODES[_0x3941d1(0xee)],await this[_0x3941d1(0xe4)](SYSTEM_DP_MODE,{'val':SYSTEM_MODES[_0x3941d1(0xee)],'ack':!![]}));}catch(_0x3a18cd){this['currentSystemMode']=SYSTEM_MODES[_0x3941d1(0xee)];}}async[a0_0x150f03(0xd1)](){const _0x50eea4=a0_0x150f03;try{const _0x63d465=await this[_0x50eea4(0xd8)](_0x50eea4(0x136));if(_0x63d465&&_0x63d465['native']&&_0x63d465['native'][_0x50eea4(0x14f)])return _0x63d465['native'][_0x50eea4(0x14f)];return _0x50eea4(0x148);}catch(_0x4fca3b){return'uuid-error';}}async[a0_0x150f03(0x218)](_0x1f773f){const _0x1ee504=a0_0x150f03;if(!_0x1f773f)return![];this[_0x1ee504(0x1e9)]=await this['getSystemUUID']();if(_0x1f773f==='TEST-PRO-KEY'||_0x1f773f['startsWith'](_0x1ee504(0x1f8)))return!![];return![];}[a0_0x150f03(0x122)](_0x5bc878){const _0xac3138=a0_0x150f03;if(this['analysisTimer'])clearInterval(this[_0xac3138(0x14d)]);if(this[_0xac3138(0x215)])clearInterval(this[_0xac3138(0x215)]);if(this['ltmJob'])this[_0xac3138(0x1ad)]['cancel']();if(this[_0xac3138(0x1f7)])this[_0xac3138(0x1f7)]['cancel']();if(this[_0xac3138(0x1ed)])clearTimeout(this[_0xac3138(0x1ed)]);if(this[_0xac3138(0x12d)])clearTimeout(this['exitGraceTimer']);_0x5bc878();}async[a0_0x150f03(0xdc)](_0x2d737e){const _0x305488=a0_0x150f03;if(typeof _0x2d737e==='object'&&_0x2d737e['message']){if(_0x2d737e[_0x305488(0x189)]===_0x305488(0x163)){if(!_0x2d737e['message'][_0x305488(0x107)])return this[_0x305488(0x1f4)](_0x2d737e[_0x305488(0x161)],_0x2d737e[_0x305488(0x189)],{'success':![],'message':_0x305488(0x1b7)},_0x2d737e['callback']);try{const _0x75619a=new GoogleGenerativeAI(_0x2d737e['message']['apiKey'])[_0x305488(0x1dc)]({'model':'models/gemini-flash-latest'});await _0x75619a[_0x305488(0x11c)](_0x305488(0x17b)),this['sendTo'](_0x2d737e[_0x305488(0x161)],_0x2d737e['command'],{'success':!![],'message':_0x305488(0x1fb)},_0x2d737e['callback']);}catch(_0x37b15c){this['sendTo'](_0x2d737e[_0x305488(0x161)],_0x2d737e[_0x305488(0x189)],{'success':![],'message':_0x37b15c[_0x305488(0xfd)]},_0x2d737e[_0x305488(0xce)]);}}else{if(_0x2d737e['command']==='testNotification'){const _0xb202b6=await this['sendNotification'](_0x305488(0xeb),!![]);this['sendTo'](_0x2d737e['from'],_0x2d737e[_0x305488(0x189)],{'success':_0xb202b6>0x0,'message':_0xb202b6+_0x305488(0x102)},_0x2d737e[_0x305488(0xce)]);}else{if(_0x2d737e['command']===_0x305488(0x110)){if(!this[_0x305488(0x1fe)])return this[_0x305488(0x1f4)](_0x2d737e[_0x305488(0x161)],_0x2d737e[_0x305488(0x189)],{'success':![],'isPro':![]},_0x2d737e[_0x305488(0xce)]);let _0x5b28e8={'status':_0x305488(0x16c),'details':'','lastCheck':0x0};try{_0x5b28e8['status']=(await this[_0x305488(0x1a0)](LTM_DP_DRIFT_STATUS))[_0x305488(0x179)],_0x5b28e8[_0x305488(0x14e)]=(await this[_0x305488(0x1a0)](LTM_DP_DRIFT_DETAILS))[_0x305488(0x179)],_0x5b28e8[_0x305488(0x21d)]=(await this[_0x305488(0x1a0)](LTM_DP_DRIFT_LAST_CHECK))[_0x305488(0x179)];}catch(_0x1c46aa){}this[_0x305488(0x1f4)](_0x2d737e[_0x305488(0x161)],_0x2d737e[_0x305488(0x189)],{'success':!![],'isPro':!![],'dailyDigests':this[_0x305488(0x20c)],'driftAnalysis':_0x5b28e8,'analysisHistory':this[_0x305488(0xf2)]},_0x2d737e[_0x305488(0xce)]);}else{if(_0x2d737e[_0x305488(0x189)]===_0x305488(0x10a)){const _0x3bea0f=await this[_0x305488(0x1fa)](_0x305488(0x1d5),_0x305488(0x19d)),_0x288e10=[];if(_0x3bea0f)for(const _0x3ace34 in _0x3bea0f){const _0x14a387=_0x3bea0f[_0x3ace34],_0x51a4e2=(_0x14a387['common']&&typeof _0x14a387[_0x305488(0x159)][_0x305488(0xff)]===_0x305488(0x15e)?_0x14a387[_0x305488(0x159)][_0x305488(0xff)]['de']:_0x14a387[_0x305488(0x159)]['name'])||_0x14a387['common'][_0x305488(0xff)];_0x288e10[_0x305488(0x1c0)]({'id':_0x3ace34,'name':_0x51a4e2});}this[_0x305488(0x1f4)](_0x2d737e[_0x305488(0x161)],_0x2d737e[_0x305488(0x189)],{'success':!![],'enums':_0x288e10},_0x2d737e[_0x305488(0xce)]);}else{if(_0x2d737e[_0x305488(0x189)]===_0x305488(0x16a)){this[_0x305488(0x1bc)][_0x305488(0x18d)](_0x305488(0x1c5));const _0x26cb35=_0x2d737e[_0x305488(0xfd)]||{};try{const _0x67afd3=await this[_0x305488(0x1b0)](_0x26cb35);this[_0x305488(0x1f4)](_0x2d737e[_0x305488(0x161)],_0x2d737e[_0x305488(0x189)],{'success':!![],'devices':_0x67afd3},_0x2d737e['callback']);}catch(_0x3b8bb9){this[_0x305488(0x1f4)](_0x2d737e[_0x305488(0x161)],_0x2d737e[_0x305488(0x189)],{'success':![],'error':_0x3b8bb9[_0x305488(0xfd)]},_0x2d737e[_0x305488(0xce)]);}}else{if(_0x2d737e[_0x305488(0x189)]===_0x305488(0x13f)){const {historyId:_0x17f56a,rating:_0x4c8a6f,comment:_0x490358,alertReason:_0x2f9d44}=_0x2d737e[_0x305488(0xfd)];_0x17f56a&&_0x4c8a6f?(await this[_0x305488(0x12c)]({'timestamp':Date[_0x305488(0x213)](),'historyId':_0x17f56a,'rating':_0x4c8a6f,'comment':_0x490358,'alertReason':_0x2f9d44}),this[_0x305488(0x1f4)](_0x2d737e[_0x305488(0x161)],_0x2d737e[_0x305488(0x189)],{'success':!![]},_0x2d737e[_0x305488(0xce)])):this[_0x305488(0x1f4)](_0x2d737e['from'],_0x2d737e[_0x305488(0x189)],{'success':![],'error':'Missing\x20data'},_0x2d737e['callback']);}}}}}}}}}if(require['main']!==module)module[a0_0x150f03(0x1b9)]=_0x5f54e2=>new CogniLiving(_0x5f54e2);else new CogniLiving();function a0_0x3b12(){const _0x45d64b=['analysisInterval','ltmDriftCheckIntervalHours','number','push','\x0a!!!\x20EXTERNAL\x20SYSTEM\x20WARNING\x20!!!\x0a','ðŸš¨ðŸš¨\x20NOTFALL','16SKHynr','warn','Received\x20scanDevices\x20request\x20from\x20Admin\x20UI.','Ignoring\x20event\x20during\x20Exit\x20Grace\x20Period:\x20','extendObjectAsync','events.lastEvent','analysis.isEmergency','events.history_debug_00','indicator.alarm.fire','guest','LTM.rawEventLog','Action','events.history','Last\x20Result','isPresent','N/A\x20(Pro\x20Feature)','ltmStbWindowDays','Konnte\x20System-Standort\x20nicht\x20laden.','enum.functions.*','licenseKey','activity','Started\x20at\x20','find','long','parse','getGenerativeModel','analysis.comfortSummary','168742hKXsNw','ANWESEND\x20ðŸ ','de-DE','PRIORITÃ„T:\x20Gesundheit\x20und\x20Sicherheit\x20fÃ¼r\x20Senioren\x20(AAL).\x20Erkenne\x20InaktivitÃ¤t,\x20potenzielle\x20StÃ¼rze\x20(indirekt),\x20ungewÃ¶hnliche\x20nÃ¤chtliche\x20AktivitÃ¤t.','genAI','VACATION',')\x20-\x20DEBUG\x20MODE\x20ENABLED','18604eBOHAB','ROLLE:\x20Data\x20Scientist.\x20VERGLEICHE:\x20Dataset\x20A\x20(Recent)\x20vs\x20B\x20(Established).\x20ZIEL:\x20Erkenne\x20Drift.\x20SCHEMA:\x20{\x20\x22baselineDrift\x22:\x20\x22none|slight|significant|critical\x22,\x20\x22driftDetails\x22:\x20\x22string\x22\x20}\x0a\x0aB\x20(LTB):\x0a','response','Aktiv\x20(','systemUUID','alertReason','inactivityThresholdHours','ABWESEND\x20âœˆï¸','exitTimer','Description','feedbackHistory','notifySignalRecipient','Bewegung\x20wÃ¤hrend\x20Exit-Timer\x20erkannt\x20->\x20Bewohner\x20ist\x20noch\x20da.','analysis.history_debug_03','sendNotification','sendTo','subscribeStates','location','modeResetJob','PRO-','notifyWhatsappEnabled','getForeignObjectsAsync','Success','generic','loadSystemMode','isProVersion','\x20Tage)','toLowerCase','CRITICAL\x20WARNING:\x20No\x20sensor\x20activity\x20detected\x20for\x20','LTM.driftAnalysis.driftDetails','AI\x20Alert\x20Status','Drift\x20Analysis','âš ï¸\x20Alarm','analysis.comfortSuggestion','notifySignalEnabled','analysis.alertReason','PrÃ¤senz-Status\x20geÃ¤ndert:\x20','Nein','toString','dailyDigests','632Kgjxzi','baselineDrift','party','Gast','Success:\x20Compressed\x20','0\x203\x20*\x20*\x20*','now','N/A\x20(No\x20Activity)','driftAnalysisTimer','Manual\x20Analysis\x20Trigger\x20detected!','geminiModel','checkLicense','analysis.automation.description','âŒ\x20Gemini\x20Model\x20not\x20initialized!\x20Check\x20API\x20Key.','s\x20Grace).','system.isPresent','lastCheck','sound','config','catch','callback','analysis.automation.patternDetected','setState','getSystemUUID','@google/generative-ai','slice','system.mode','notifySignalInstance','send','Baseline\x20Status','getForeignObjectAsync','boolean','4464760mUOdYW','LTM.dailyDigests','onMessage','LTM.processingStatus','User\x20Feedback:\x20Alarm\x20\x22','LTM.baselineStatus','search','Processing\x20Status','livingContext','.\x20\x0a\x20\x20\x20\x20\x20\x20\x20\x20KONTEXT:\x20','setStateAsync','2-digit','includes','Feedback\x20Log','trim','Last\x20Check','state','[Test]\x20Notification','apply','unknown','NORMAL','namespace','âœ…\x20Gemini\x20Response\x20received.','analysis.trigger','analysisHistory','Automation\x20Proposals','LTM.triggerDailyDigest','6435990AotKOP','Adapter','onReady','analysis.history_debug_02','vacation','constructor','button','notifyEmailRecipient','message','setupDriftAnalysisScheduler','name','ltmLtbWindowDays','resetAnalysisStates','\x20sent','215LGVyGL','runGeminiAnalysis','lastAlertState','systemConfig','apiKey','min\x20Timer,\x20','Sending\x20Prompt\x20(Length:\x20','getEnums','expire','analysis.history_debug_04','setObjectNotExistsAsync','bind','stateChange','getLtmData','currentSystemMode','isAlert','driftDetails','events.history_debug_04','inactivityMonitoringEnabled','rawEventLog','values','json','[TEST]\x20','Deaktiviert\x20(Pro-Feature)','LTM.driftAnalysis','generateContent','application/json','runBaselineDriftAnalysis','sensorLastValues','.\x20ANWEISUNG:\x20Fasse\x20Sensor-Events\x20zusammen.\x20SCHEMA:\x20{\x20\x22summary\x22:\x20\x22string\x22,\x20\x22activityLevel\x22:\x20\x22string\x22\x20}\x20\x0a\x0aEVENTS:\x0a','retry','onUnload','loadDailyDigests','analysis.deviationFromBaseline','notifyEmailEnabled','version','System\x20Mode','channel','map','Activity\x20Summary','ðŸ“\x20Standort\x20geladen:\x20','saveFeedback','exitGraceTimer','string','loadRawEventLog','startExitTimer','Analysiere\x20ausgewogen\x20auf\x20Gesundheit,\x20Sicherheit\x20und\x20Komfort.','stringify','isEmergency','LTM.driftAnalysis.baselineDrift','checkLtmObjects','system.meta.uuid','No\x20recent\x20activity.','abortExitTimer','runAutopilot','geminiApiKey','debug','Event\x20History','Fokus\x20auf\x20Familienroutinen,\x20Kindersicherheit\x20und\x20allgemeines\x20Haushaltsmanagement.','triggerDailyDigest','submitFeedback','unshift','(((.+)+)+)+$','replace','devices','analysis.activitySummary','Pattern\x20Detected','ack','latitude','uuid-not-found','Skipped\x20(No\x20AI\x20or\x20Data)','notifyEmailInstance','ROLLE:\x20Compression\x20Agent.\x20SPRACHE:\x20DE.\x20FORMAT:\x20JSON.\x20KONTEXT:\x20','system.config','analysisTimer','details','uuid','ready','toLocaleString','createDailyDigest','.\x20ORT:\x20','Lernphase\x20(','text.alarm','processSensorEvent','Error:\x20','type','common','saveDailyDigests','analysis.isAlert','updateAnalysisHistory','updateBaselineStatus','object','indicator','error','from','\x20Stunden!','testApiKey','.\x20PERSONA:\x20','\x20events\x20from\x20history.','analysis.history_debug_01','GUEST','\x22\x20was\x20','events.history_debug_02','scanDevices','models/gemini-flash-latest','N/A','HaustÃ¼r\x20Event:\x20Starte\x20Exit-Logik\x20(','ðŸ¤–\x20Starting\x20Gemini\x20Analysis...','notifyTelegramRecipient','PARTY','Raw\x20Log','subscribeForeignStatesAsync','.\x0a\x20\x20\x20\x20\x20\x20\x20\x20','Gemini\x20Init\x20Error:\x20','unload','Fenster/TÃ¼r','eingang','cogni-living\x20adapter\x20starting\x20(v','val','Drift\x20Status','test','notifyPushoverInstance','N/A\x20(Learning)','sendToAsync','Loaded\x20','toISOString','node-schedule','Exit-Timer\x20abgelaufen:\x20Keine\x20Bewegung\x20innen\x20erkannt\x20->\x20ABWESEND.','2385600mjLqOp','Gemini\x20AI\x20initialized.','notifyTelegramInstance','cleanUpZombies','Subscribing\x20to\x20','Analysis\x20Error:\x20','command','Last\x20raw\x20event','minDaysForBaseline','setPresence','info','\x20min).\x20Watchdog\x20Limit:\x20','setupLtmScheduler','length','text','.\x20PRÃ„SENZ:\x20','notifyTelegramEnabled','1249703uhQsPl','getForeignStateAsync','PRIORITÃ„T:\x20Sicherheit.\x20Erkenne\x20Eindringlinge,\x20ungewÃ¶hnliche\x20Anwesenheit.','flur','summary','notifyPushoverRecipient','analysis.history_debug_00','174uHjTEG','join','enum','eventHistory','\x20\x0a\x20\x20\x20\x20\x20\x20\x20\x20SCHEMA:\x20{\x20\x22activity\x22:\x20{\x20\x22summary\x22:\x20\x22string\x22,\x20\x22deviationFromBaseline\x22:\x20\x22string\x22,\x20\x22isAlert\x22:\x20bool,\x20\x22isEmergency\x22:\x20bool,\x20\x22alertReason\x22:\x20\x22string\x22\x20},\x20\x22comfort\x22:\x20{\x20\x22summary\x22:\x20\x22string\x22,\x20\x22suggestion\x22:\x20\x22string\x22,\x20\x22automationProposal\x22:\x20{\x20\x22patternDetected\x22:\x20bool,\x20\x22description\x22:\x20\x22string\x22,\x20\x22suggestedAction\x22:\x20\x22string\x22\x20}\x20}\x20}','getStateAsync','activityLevel','setupModeResetScheduler','splice','getObjectAsync','\x0a\x0aA\x20(STB):\x0a','createAllObjects','date','cancel','Deviation','analysis.analysisHistory','ðŸš¨\x20EMERGENCY','LTM','ltmJob','system','\x0aFEEDBACK:\x0a','scanForDevices','notifyWhatsappInstance','analysis.lastResult','city','isGracePeriodActive','substring','AI\x20Emergency\x20Status','No\x20Key','ROLLE:\x20Smart\x20Home\x20Analyst.\x20SPRACHE:\x20DE.\x20FORMAT:\x20JSON.\x20\x0a\x20\x20\x20\x20\x20\x20\x20\x20AKTUELLE\x20ZEIT:\x20','exports','Urlaub','Baseline:\x20Inactive\x20(Pro\x20Feature).','log'];a0_0x3b12=function(){return _0x45d64b;};return a0_0x3b12();}