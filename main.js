const a0_0x3fb50b=a0_0xf01d;(function(_0xd0e04d,_0x4959a2){const _0x459a4f=a0_0xf01d,_0x311db6=_0xd0e04d();while(!![]){try{const _0x214090=-parseInt(_0x459a4f(0x111))/0x1+parseInt(_0x459a4f(0x262))/0x2*(parseInt(_0x459a4f(0x14e))/0x3)+-parseInt(_0x459a4f(0x133))/0x4*(parseInt(_0x459a4f(0x1bc))/0x5)+parseInt(_0x459a4f(0x238))/0x6*(-parseInt(_0x459a4f(0x1db))/0x7)+parseInt(_0x459a4f(0x1ef))/0x8+-parseInt(_0x459a4f(0x143))/0x9+parseInt(_0x459a4f(0x28d))/0xa*(parseInt(_0x459a4f(0x104))/0xb);if(_0x214090===_0x4959a2)break;else _0x311db6['push'](_0x311db6['shift']());}catch(_0x370082){_0x311db6['push'](_0x311db6['shift']());}}}(a0_0x23f4,0x6f0f5));const a0_0x33f56f=(function(){let _0x33eeb0=!![];return function(_0x4b124a,_0xc26b9){const _0x22e82f=_0x33eeb0?function(){const _0x5904da=a0_0xf01d;if(_0xc26b9){const _0x5b1b96=_0xc26b9[_0x5904da(0x266)](_0x4b124a,arguments);return _0xc26b9=null,_0x5b1b96;}}:function(){};return _0x33eeb0=![],_0x22e82f;};}()),a0_0x172380=a0_0x33f56f(this,function(){const _0x36a781=a0_0xf01d;return a0_0x172380['toString']()[_0x36a781(0x1f5)](_0x36a781(0x164))[_0x36a781(0x1dc)]()[_0x36a781(0x1e2)](a0_0x172380)[_0x36a781(0x1f5)](_0x36a781(0x164));});a0_0x172380();'use strict';const utils=require('@iobroker/adapter-core'),{GoogleGenerativeAI}=require('@google/generative-ai'),schedule=require(a0_0x3fb50b(0x1a8)),{spawn,exec}=require(a0_0x3fb50b(0x17f)),path=require(a0_0x3fb50b(0x237)),HISTORY_MAX_SIZE=0x32,RAW_LOG_MAX_SIZE=0x5dc,LTM_MIN_EVENTS_FOR_COMPRESSION=0x5,GEMINI_MODEL=a0_0x3fb50b(0x11c),LTM_SCHEDULE='0\x203\x20*\x20*\x20*',MODE_RESET_SCHEDULE='0\x204\x20*\x20*\x20*',ANALYSIS_HISTORY_MAX_SIZE=0x64,EXIT_TIMER_MINUTES=0xf,EXIT_GRACE_PERIOD_SECONDS=0x1e,SEQUENCE_TIMEOUT_MS=0x5*0x3c*0x3e8,MAX_TRAINING_SET_SIZE=0x1f4,THERMO_LOG_SIZE=0x3e8,LTM_DP_RAW_LOG=a0_0x3fb50b(0x1f8),LTM_DP_DAILY_DIGESTS=a0_0x3fb50b(0x12a),LTM_DP_STATUS=a0_0x3fb50b(0x1f7),LTM_DP_TRIGGER_DIGEST=a0_0x3fb50b(0x1f9),LTM_DP_BASELINE_STATUS=a0_0x3fb50b(0xbd),LTM_DP_DRIFT_CHANNEL='LTM.driftAnalysis',LTM_DP_DRIFT_STATUS=a0_0x3fb50b(0x287),LTM_DP_DRIFT_DETAILS=a0_0x3fb50b(0x1cf),LTM_DP_DRIFT_LAST_CHECK=a0_0x3fb50b(0x132),SYSTEM_DP_MODE='system.mode',HARD_IGNORE_TERMS=['scriptProblem',a0_0x3fb50b(0x21e),'update',a0_0x3fb50b(0xb6),a0_0x3fb50b(0x1f4),a0_0x3fb50b(0x112),a0_0x3fb50b(0x10f),a0_0x3fb50b(0x279),a0_0x3fb50b(0x235),a0_0x3fb50b(0x204),a0_0x3fb50b(0x1f0),a0_0x3fb50b(0xe7),'stick_unreach',a0_0x3fb50b(0x1a5),a0_0x3fb50b(0x25f),a0_0x3fb50b(0x18b),a0_0x3fb50b(0x283),'link_quality'],BAD_NAMES=['targetposition','currentposition',a0_0x3fb50b(0x299),a0_0x3fb50b(0x26a),a0_0x3fb50b(0x291),a0_0x3fb50b(0x207),'on',a0_0x3fb50b(0x218),a0_0x3fb50b(0x24b),a0_0x3fb50b(0x15f),a0_0x3fb50b(0x2a1),a0_0x3fb50b(0x1cc),'cover',a0_0x3fb50b(0x194),a0_0x3fb50b(0xc0),a0_0x3fb50b(0x17c),a0_0x3fb50b(0x1e3),'temperature','humidity','power',a0_0x3fb50b(0x23c),a0_0x3fb50b(0x197),'valve','actual_temperature',a0_0x3fb50b(0xdb)],ADAPTER_BLACKLIST=[a0_0x3fb50b(0x1dd),a0_0x3fb50b(0x13b),a0_0x3fb50b(0xd3),a0_0x3fb50b(0x157),'history.',a0_0x3fb50b(0x27c),a0_0x3fb50b(0x1e5),a0_0x3fb50b(0x12b),a0_0x3fb50b(0x1d3),'javascript.',a0_0x3fb50b(0x182)],SYSTEM_MODES={'NORMAL':'normal','VACATION':a0_0x3fb50b(0x269),'PARTY':'party','GUEST':a0_0x3fb50b(0xca)},AUTO_RESET_MODES=[SYSTEM_MODES[a0_0x3fb50b(0x186)],SYSTEM_MODES['GUEST']],PERSONA_MAPPING={'generic':a0_0x3fb50b(0x14f),'senior_aal':'PRIORITÃ„T:\x20Gesundheit/AAL.','family':'Fokus\x20auf\x20Familienroutinen.','single_comfort':a0_0x3fb50b(0xe4),'security':a0_0x3fb50b(0x125)},ACTIVITY_LEVEL_MAP={'sehr\x20hoch':0x64,'hoch':0x50,'normal':0x3c,'niedrig':0x28,'sehr\x20niedrig':0x14,'inaktiv':0x0};let activeSequence=[],sequenceTimer=null;async function initZombies(_0x521adf){const _0x592ba7=a0_0x3fb50b;try{const _0x2da0c7=['analysis.history_debug_00',_0x592ba7(0x16d)];for(const _0x42adde of _0x2da0c7){try{const _0x2f8d80=await _0x521adf[_0x592ba7(0xe8)](_0x42adde);_0x2f8d80&&await _0x521adf[_0x592ba7(0x1c0)](_0x42adde);}catch(_0x339675){}}}catch(_0x44cb94){}}async function initHistory(_0x10d4c1){const _0x397763=a0_0x3fb50b;try{const _0x1bd56f=await _0x10d4c1[_0x397763(0x221)]('events.history');_0x1bd56f&&_0x1bd56f['val']&&(_0x10d4c1[_0x397763(0x22e)]=JSON[_0x397763(0xb5)](_0x1bd56f[_0x397763(0x108)][_0x397763(0x1dc)]()));}catch(_0x360388){_0x10d4c1[_0x397763(0x22e)]=[];}try{const _0x4fcef0=await _0x10d4c1[_0x397763(0x221)]('analysis.analysisHistory');if(_0x4fcef0&&_0x4fcef0[_0x397763(0x108)])_0x10d4c1[_0x397763(0x251)]=JSON['parse'](_0x4fcef0[_0x397763(0x108)][_0x397763(0x1dc)]());}catch(_0x416528){_0x10d4c1[_0x397763(0x251)]=[];}if(_0x10d4c1[_0x397763(0x22e)]&&_0x10d4c1[_0x397763(0x22e)][_0x397763(0x152)]>0x0){_0x10d4c1[_0x397763(0xd6)]['info']('Restoring\x20sensor\x20cache\x20from\x20history\x20('+_0x10d4c1[_0x397763(0x22e)]['length']+_0x397763(0xbb));for(let _0x2834fc=_0x10d4c1['eventHistory'][_0x397763(0x152)]-0x1;_0x2834fc>=0x0;_0x2834fc--){const _0x3a2711=_0x10d4c1['eventHistory'][_0x2834fc];_0x3a2711&&_0x3a2711['id']!==undefined&&_0x3a2711[_0x397763(0x291)]!==undefined&&(_0x10d4c1['sensorLastValues'][_0x3a2711['id']]=_0x3a2711[_0x397763(0x291)]);}}}async function initSystemConfig(_0x42c0b8){const _0x253cda=a0_0x3fb50b;try{const _0x350e87=await _0x42c0b8[_0x253cda(0xfc)]('system.config');_0x350e87&&_0x350e87[_0x253cda(0x13f)]&&(_0x42c0b8['systemConfig']={'latitude':_0x350e87[_0x253cda(0x13f)][_0x253cda(0x232)]||0x0,'longitude':_0x350e87[_0x253cda(0x13f)][_0x253cda(0x206)]||0x0,'city':_0x350e87['common'][_0x253cda(0xce)]||''});}catch(_0xa2934a){}}async function checkLicense(_0x21a4b3,_0xb1d827){const _0x271d8c=a0_0x3fb50b;if(!_0xb1d827)return![];_0x21a4b3[_0x271d8c(0xe1)]=await getSystemUUID(_0x21a4b3);if(_0xb1d827===_0x271d8c(0xef)||_0xb1d827['startsWith'](_0x271d8c(0x16f)))return!![];return![];}async function getSystemUUID(_0x28da61){const _0x30b391=a0_0x3fb50b;try{const _0x7f096c=await _0x28da61[_0x30b391(0xfc)](_0x30b391(0xae));if(_0x7f096c&&_0x7f096c[_0x30b391(0x1ea)]&&_0x7f096c[_0x30b391(0x1ea)][_0x30b391(0x1b8)])return _0x7f096c[_0x30b391(0x1ea)][_0x30b391(0x1b8)];return'uuid-not-found';}catch(_0x17c87c){return'uuid-error';}}async function createAllObjects(_0x46ea71){const _0xbbdbb7=a0_0x3fb50b;await checkSystemObjects(_0x46ea71),await _0x46ea71[_0xbbdbb7(0x29c)]('system.presenceWho',{'type':_0xbbdbb7(0x299),'common':{'name':_0xbbdbb7(0x173),'type':_0xbbdbb7(0x118),'role':_0xbbdbb7(0x169),'read':!![],'write':![],'def':''},'native':{}}),await _0x46ea71['setObjectNotExistsAsync'](_0xbbdbb7(0x171),{'type':_0xbbdbb7(0x299),'common':{'name':'Last\x20raw\x20event','type':'string','role':_0xbbdbb7(0xf7),'read':!![],'write':![]},'native':{}}),await _0x46ea71[_0xbbdbb7(0x29c)](_0xbbdbb7(0x265),{'type':_0xbbdbb7(0x299),'common':{'name':'Event\x20History','type':_0xbbdbb7(0x118),'role':_0xbbdbb7(0xf7),'read':!![],'write':![]},'native':{}}),await _0x46ea71[_0xbbdbb7(0x29c)](_0xbbdbb7(0x25e),{'type':_0xbbdbb7(0x299),'common':{'name':_0xbbdbb7(0x27e),'type':_0xbbdbb7(0x21d),'role':_0xbbdbb7(0xcd),'read':!![],'write':!![],'def':![]},'native':{}}),await _0x46ea71[_0xbbdbb7(0x29c)](_0xbbdbb7(0x224),{'type':'state','common':{'name':_0xbbdbb7(0x18c),'type':_0xbbdbb7(0x21d),'role':_0xbbdbb7(0xcd),'read':!![],'write':!![],'def':![]},'native':{}}),await _0x46ea71['setObjectNotExistsAsync'](_0xbbdbb7(0x217),{'type':_0xbbdbb7(0x299),'common':{'name':_0xbbdbb7(0xf2),'type':'string','role':'json','read':!![],'write':![]},'native':{}}),await _0x46ea71[_0xbbdbb7(0x29c)](_0xbbdbb7(0xc1),{'type':_0xbbdbb7(0x299),'common':{'name':_0xbbdbb7(0x244),'type':'boolean','role':'indicator.alarm','read':!![],'write':![],'def':![]},'native':{}}),await _0x46ea71[_0xbbdbb7(0x29c)]('analysis.isEmergency',{'type':_0xbbdbb7(0x299),'common':{'name':'AI\x20Emergency\x20Status','type':_0xbbdbb7(0x21d),'role':_0xbbdbb7(0xf1),'read':!![],'write':![],'def':![]},'native':{}}),await _0x46ea71[_0xbbdbb7(0x29c)](_0xbbdbb7(0x24d),{'type':'state','common':{'name':_0xbbdbb7(0x263),'type':'string','role':_0xbbdbb7(0x19d),'read':!![],'write':![]},'native':{}}),await _0x46ea71['setObjectNotExistsAsync'](_0xbbdbb7(0x257),{'type':_0xbbdbb7(0x299),'common':{'name':'Activity\x20Summary','type':'string','role':'text','read':!![],'write':![]},'native':{}}),await _0x46ea71[_0xbbdbb7(0x29c)](_0xbbdbb7(0x144),{'type':'state','common':{'name':_0xbbdbb7(0x1b0),'type':'string','role':_0xbbdbb7(0x299),'read':!![],'write':![],'def':'N/A'},'native':{}}),await _0x46ea71[_0xbbdbb7(0x29c)]('analysis.comfortSummary',{'type':_0xbbdbb7(0x299),'common':{'name':_0xbbdbb7(0x1d7),'type':_0xbbdbb7(0x118),'role':'text','read':!![],'write':![]},'native':{}}),await _0x46ea71['setObjectNotExistsAsync']('analysis.comfortSuggestion',{'type':_0xbbdbb7(0x299),'common':{'name':'Comfort\x20Suggestion','type':_0xbbdbb7(0x118),'role':_0xbbdbb7(0x169),'read':!![],'write':![]},'native':{}}),await _0x46ea71[_0xbbdbb7(0x1c3)](_0xbbdbb7(0x129),{'type':_0xbbdbb7(0x131),'common':{'name':_0xbbdbb7(0x117)},'native':{}}),await _0x46ea71[_0xbbdbb7(0x29c)]('analysis.automation.patternDetected',{'type':'state','common':{'name':_0xbbdbb7(0x179),'type':_0xbbdbb7(0x21d),'role':_0xbbdbb7(0x11a),'read':!![],'write':![],'def':![]},'native':{}}),await _0x46ea71[_0xbbdbb7(0x29c)](_0xbbdbb7(0x163),{'type':_0xbbdbb7(0x299),'common':{'name':_0xbbdbb7(0x17a),'type':_0xbbdbb7(0x118),'role':'text','read':!![],'write':![]},'native':{}}),await _0x46ea71[_0xbbdbb7(0x29c)]('analysis.automation.suggestedAction',{'type':'state','common':{'name':'Action','type':_0xbbdbb7(0x118),'role':_0xbbdbb7(0x169),'read':!![],'write':![]},'native':{}}),await _0x46ea71['setObjectNotExistsAsync']('analysis.automation.targetId',{'type':_0xbbdbb7(0x299),'common':{'name':'Target\x20ID','type':_0xbbdbb7(0x118),'role':_0xbbdbb7(0x169),'read':!![],'write':![]},'native':{}}),await _0x46ea71[_0xbbdbb7(0x29c)]('analysis.automation.targetValue',{'type':_0xbbdbb7(0x299),'common':{'name':_0xbbdbb7(0x1b6),'type':_0xbbdbb7(0x118),'role':_0xbbdbb7(0x169),'read':!![],'write':![]},'native':{}}),await _0x46ea71['setObjectNotExistsAsync'](_0xbbdbb7(0xf6),{'type':_0xbbdbb7(0x299),'common':{'name':_0xbbdbb7(0x1d4),'type':'boolean','role':'switch','read':!![],'write':!![],'def':![]},'native':{}}),await _0x46ea71[_0xbbdbb7(0x29c)](_0xbbdbb7(0x1ce),{'type':_0xbbdbb7(0x299),'common':{'name':_0xbbdbb7(0x1ba),'type':_0xbbdbb7(0x21d),'role':_0xbbdbb7(0xcd),'read':!![],'write':!![],'def':![]},'native':{}}),await _0x46ea71['setObjectNotExistsAsync']('analysis.analysisHistory',{'type':'state','common':{'name':'Logbook','type':_0xbbdbb7(0x118),'role':_0xbbdbb7(0xf7),'read':!![],'write':![],'def':'[]'},'native':{}}),await _0x46ea71[_0xbbdbb7(0x29c)]('analysis.feedbackHistory',{'type':_0xbbdbb7(0x299),'common':{'name':_0xbbdbb7(0x102),'type':_0xbbdbb7(0x118),'role':'json','read':!![],'write':![],'def':'[]'},'native':{}}),await _0x46ea71['extendObjectAsync'](_0xbbdbb7(0x247),{'type':'channel','common':{'name':_0xbbdbb7(0x284)},'native':{}}),await _0x46ea71[_0xbbdbb7(0x29c)](_0xbbdbb7(0xd5),{'type':_0xbbdbb7(0x299),'common':{'name':_0xbbdbb7(0x1de),'type':_0xbbdbb7(0x26c),'role':'value.health','read':!![],'write':![],'def':0x0},'native':{}}),await _0x46ea71[_0xbbdbb7(0x29c)](_0xbbdbb7(0x255),{'type':'state','common':{'name':'Restlessness\x20Level','type':_0xbbdbb7(0x118),'role':_0xbbdbb7(0x169),'read':!![],'write':![],'def':'none'},'native':{}}),await _0x46ea71['setObjectNotExistsAsync'](_0xbbdbb7(0x245),{'type':_0xbbdbb7(0x299),'common':{'name':_0xbbdbb7(0x280),'type':_0xbbdbb7(0x118),'role':_0xbbdbb7(0x169),'read':!![],'write':![],'def':''},'native':{}}),await _0x46ea71['setObjectNotExistsAsync'](_0xbbdbb7(0x1ed),{'type':_0xbbdbb7(0x299),'common':{'name':'Trend\x20Diagnosis\x20(Python)','type':'string','role':_0xbbdbb7(0x169),'read':!![],'write':![],'def':_0xbbdbb7(0x1e8)},'native':{}}),await _0x46ea71['setObjectNotExistsAsync'](_0xbbdbb7(0x1d1),{'type':_0xbbdbb7(0x299),'common':{'name':_0xbbdbb7(0x223),'type':_0xbbdbb7(0x26c),'role':'value','read':!![],'write':![],'def':0x0},'native':{}}),await _0x46ea71[_0xbbdbb7(0x1c3)](_0xbbdbb7(0x136),{'type':'channel','common':{'name':'Training\x20Data\x20Sets'},'native':{}}),await _0x46ea71[_0xbbdbb7(0x29c)]('LTM.trainingData.sequences',{'type':'state','common':{'name':'Recorded\x20Motion\x20Sequences','type':_0xbbdbb7(0x118),'role':_0xbbdbb7(0xf7),'read':!![],'write':![],'def':'[]','desc':_0xbbdbb7(0x14d)},'native':{}}),await _0x46ea71[_0xbbdbb7(0x29c)](_0xbbdbb7(0x219),{'type':'state','common':{'name':'Thermodynamic\x20Data\x20Points','type':_0xbbdbb7(0x118),'role':_0xbbdbb7(0xf7),'read':!![],'write':![],'def':'[]','desc':'Correlation\x20between\x20Inside\x20Temp,\x20Outside\x20Temp\x20and\x20Time'},'native':{}}),await checkLtmObjects(_0x46ea71),await checkLtmDriftObjects(_0x46ea71);}async function checkSystemObjects(_0x45a6e7){const _0x2b4215=a0_0x3fb50b;await _0x45a6e7[_0x2b4215(0x1c3)](_0x2b4215(0xfa),{'type':_0x2b4215(0x131),'common':{'name':_0x2b4215(0x281)},'native':{}}),await _0x45a6e7[_0x2b4215(0x1c3)](SYSTEM_DP_MODE,{'type':_0x2b4215(0x299),'common':{'name':'System\x20Mode','type':'string','role':_0x2b4215(0x299),'read':!![],'write':!![],'def':SYSTEM_MODES['NORMAL'],'states':{[SYSTEM_MODES['NORMAL']]:_0x2b4215(0x18f),[SYSTEM_MODES['VACATION']]:_0x2b4215(0x141),[SYSTEM_MODES[_0x2b4215(0x186)]]:_0x2b4215(0x27a),[SYSTEM_MODES[_0x2b4215(0xf4)]]:_0x2b4215(0x252)}},'native':{}});}async function checkLtmObjects(_0x3df766){const _0x43a4c5=a0_0x3fb50b;await _0x3df766['extendObjectAsync'](_0x43a4c5(0x11e),{'type':'channel','common':{'name':_0x43a4c5(0x11e)},'native':{}}),await _0x3df766[_0x43a4c5(0x1c3)](LTM_DP_RAW_LOG,{'type':_0x43a4c5(0x299),'common':{'name':_0x43a4c5(0x233),'type':'string','role':_0x43a4c5(0xf7),'read':!![],'write':![]},'native':{}}),await _0x3df766[_0x43a4c5(0x1c3)](LTM_DP_DAILY_DIGESTS,{'type':'state','common':{'name':_0x43a4c5(0x15e),'type':_0x43a4c5(0x118),'role':_0x43a4c5(0xf7),'read':!![],'write':![]},'native':{}}),await _0x3df766[_0x43a4c5(0x1c3)](LTM_DP_STATUS,{'type':_0x43a4c5(0x299),'common':{'name':_0x43a4c5(0xde),'type':_0x43a4c5(0x118),'role':_0x43a4c5(0x169),'read':!![],'write':![]},'native':{}}),await _0x3df766['extendObjectAsync'](LTM_DP_TRIGGER_DIGEST,{'type':_0x43a4c5(0x299),'common':{'name':_0x43a4c5(0xd9),'type':'boolean','role':_0x43a4c5(0xcd),'read':!![],'write':!![],'def':![]},'native':{}}),await _0x3df766[_0x43a4c5(0x1c3)](LTM_DP_BASELINE_STATUS,{'type':_0x43a4c5(0x299),'common':{'name':'Baseline\x20Status','type':_0x43a4c5(0x118),'role':'text','read':!![],'write':![]},'native':{}});}async function checkLtmDriftObjects(_0x57ec75){const _0x21ade2=a0_0x3fb50b;await _0x57ec75[_0x21ade2(0x1c3)](LTM_DP_DRIFT_CHANNEL,{'type':_0x21ade2(0x131),'common':{'name':_0x21ade2(0x176)},'native':{}}),await _0x57ec75[_0x21ade2(0x1c3)](LTM_DP_DRIFT_STATUS,{'type':_0x21ade2(0x299),'common':{'name':_0x21ade2(0x298),'type':_0x21ade2(0x118),'role':_0x21ade2(0x299),'read':!![],'write':![],'def':_0x21ade2(0x1e8)},'native':{}}),await _0x57ec75[_0x21ade2(0x1c3)](LTM_DP_DRIFT_DETAILS,{'type':'state','common':{'name':_0x21ade2(0x13e),'type':_0x21ade2(0x118),'role':_0x21ade2(0x169),'read':!![],'write':![]},'native':{}}),await _0x57ec75[_0x21ade2(0x1c3)](LTM_DP_DRIFT_LAST_CHECK,{'type':'state','common':{'name':_0x21ade2(0x127),'type':_0x21ade2(0x26c),'role':_0x21ade2(0x286),'read':!![],'write':![]},'native':{}});}async function loadSystemMode(_0x2c4972){const _0x8f5ce2=a0_0x3fb50b;try{const _0x24cc04=await _0x2c4972[_0x8f5ce2(0x221)](SYSTEM_DP_MODE);_0x24cc04&&_0x24cc04[_0x8f5ce2(0x108)]&&Object[_0x8f5ce2(0x180)](SYSTEM_MODES)['includes'](_0x24cc04['val'])?_0x2c4972[_0x8f5ce2(0xcc)]=_0x24cc04['val']:(_0x2c4972[_0x8f5ce2(0xcc)]=SYSTEM_MODES[_0x8f5ce2(0x28c)],await _0x2c4972[_0x8f5ce2(0x21b)](SYSTEM_DP_MODE,{'val':SYSTEM_MODES[_0x8f5ce2(0x28c)],'ack':!![]}));}catch(_0x5e88cb){_0x2c4972['currentSystemMode']=SYSTEM_MODES[_0x8f5ce2(0x28c)];}}async function loadRawEventLog(_0x14e2e6){const _0x4a2f17=a0_0x3fb50b;try{const _0x16ee84=await _0x14e2e6[_0x4a2f17(0x221)](LTM_DP_RAW_LOG);if(_0x16ee84&&_0x16ee84[_0x4a2f17(0x108)])_0x14e2e6['rawEventLog']=JSON['parse'](_0x16ee84[_0x4a2f17(0x108)]);}catch(_0x10a990){_0x14e2e6['rawEventLog']=[];}}async function saveRawEventLog(_0x992fa1){const _0x346970=a0_0x3fb50b;_0x992fa1['rawEventLog'][_0x346970(0x152)]>RAW_LOG_MAX_SIZE&&_0x992fa1[_0x346970(0x29a)][_0x346970(0x1e6)](0x0,_0x992fa1[_0x346970(0x29a)]['length']-RAW_LOG_MAX_SIZE),await _0x992fa1[_0x346970(0x21b)](LTM_DP_RAW_LOG,{'val':JSON[_0x346970(0x21a)](_0x992fa1[_0x346970(0x29a)]),'ack':!![]});}async function loadDailyDigests(_0x5df982){const _0x3b2649=a0_0x3fb50b;try{const _0x12a425=await _0x5df982[_0x3b2649(0x221)](LTM_DP_DAILY_DIGESTS);if(_0x12a425&&_0x12a425['val'])_0x5df982[_0x3b2649(0x1b4)]=JSON[_0x3b2649(0xb5)](_0x12a425[_0x3b2649(0x108)]);}catch(_0x2619bc){_0x5df982['dailyDigests']=[];}await updateBaselineStatus(_0x5df982);}async function saveDailyDigests(_0x59d25a,_0x178877=!![]){const _0x3f12ba=a0_0x3fb50b,_0x51a304=_0x59d25a[_0x3f12ba(0x249)][_0x3f12ba(0x210)]||0x3c;_0x59d25a['dailyDigests'][_0x3f12ba(0x152)]>_0x51a304&&_0x59d25a[_0x3f12ba(0x1b4)][_0x3f12ba(0x1e6)](0x0,_0x59d25a[_0x3f12ba(0x1b4)][_0x3f12ba(0x152)]-_0x51a304);await _0x59d25a[_0x3f12ba(0x21b)](LTM_DP_DAILY_DIGESTS,{'val':JSON[_0x3f12ba(0x21a)](_0x59d25a[_0x3f12ba(0x1b4)]),'ack':!![]});if(_0x178877)await updateBaselineStatus(_0x59d25a);}async function updateAnalysisHistory(_0x1db088,_0x265c0c){const _0x5f0a62=a0_0x3fb50b;_0x1db088['analysisHistory'][_0x5f0a62(0x21c)](_0x265c0c);if(_0x1db088['analysisHistory'][_0x5f0a62(0x152)]>ANALYSIS_HISTORY_MAX_SIZE)_0x1db088[_0x5f0a62(0x251)][_0x5f0a62(0x101)]();await _0x1db088[_0x5f0a62(0x21b)](_0x5f0a62(0xad),{'val':JSON[_0x5f0a62(0x21a)](_0x1db088[_0x5f0a62(0x251)]),'ack':!![]});}async function updateBaselineStatus(_0x5bb9b0){const _0x4979e8=a0_0x3fb50b;if(!_0x5bb9b0[_0x4979e8(0x16e)]){await _0x5bb9b0[_0x4979e8(0x21b)](LTM_DP_BASELINE_STATUS,{'val':_0x4979e8(0x177),'ack':!![]});return;}const _0x26f854=_0x5bb9b0['dailyDigests'][_0x4979e8(0x152)]>=(_0x5bb9b0[_0x4979e8(0x249)]['minDaysForBaseline']||0x7)?_0x4979e8(0x24c)+_0x5bb9b0['dailyDigests'][_0x4979e8(0x152)]+_0x4979e8(0xd4):_0x4979e8(0x1c8)+_0x5bb9b0[_0x4979e8(0x1b4)]['length']+'/'+(_0x5bb9b0[_0x4979e8(0x249)]['minDaysForBaseline']||0x7)+')';await _0x5bb9b0[_0x4979e8(0x21b)](LTM_DP_BASELINE_STATUS,{'val':_0x26f854,'ack':!![]});}async function initSensorSubscriptions(_0x3a48ba){const _0x702d46=a0_0x3fb50b,_0x3dbb2a=_0x3a48ba[_0x702d46(0x249)]['devices'];if(_0x3dbb2a&&_0x3dbb2a[_0x702d46(0x152)]>0x0){_0x3a48ba[_0x702d46(0xd6)][_0x702d46(0x24e)](_0x702d46(0x183)+_0x3dbb2a[_0x702d46(0x152)]+_0x702d46(0x128));for(const _0x49a94b of _0x3dbb2a){if(_0x49a94b['id']){await _0x3a48ba[_0x702d46(0x203)](_0x49a94b['id']);try{const _0x12c970=await _0x3a48ba['getForeignStateAsync'](_0x49a94b['id']);if(_0x12c970)_0x3a48ba[_0x702d46(0x165)][_0x49a94b['id']]=_0x12c970['val'];}catch(_0x3b12f3){}}}}}async function initPresenceSubscriptions(_0x2a0b2a){const _0x878892=a0_0x3fb50b,_0xfe24d7=_0x2a0b2a[_0x878892(0x249)][_0x878892(0x1b1)]||[];if(_0xfe24d7[_0x878892(0x152)]>0x0){_0x2a0b2a[_0x878892(0xd6)]['info'](_0x878892(0x183)+_0xfe24d7[_0x878892(0x152)]+_0x878892(0x296));for(const _0x1dd323 of _0xfe24d7){await _0x2a0b2a[_0x878892(0x203)](_0x1dd323);}try{await checkWifiPresence(_0x2a0b2a);}catch(_0x44dcca){}}}async function getWeatherContext(_0x1f492e){const _0x4f3ff1=a0_0x3fb50b;try{if(!_0x1f492e['config'][_0x4f3ff1(0x213)])return _0x4f3ff1(0xf9);let _0x12aba8='';const _0x168429=_0x1f492e[_0x4f3ff1(0x249)]['weatherInstance'];if(_0x168429)try{if(_0x168429['includes'](_0x4f3ff1(0x26e))){const _0x454395=await _0x1f492e[_0x4f3ff1(0x23d)](_0x168429+_0x4f3ff1(0x22b));if(_0x454395&&_0x454395['val'])_0x12aba8=_0x454395['val'];}else{if(_0x168429[_0x4f3ff1(0x174)](_0x4f3ff1(0x25c))){const _0x3efad1=await _0x1f492e[_0x4f3ff1(0x23d)](_0x168429+_0x4f3ff1(0x267));if(_0x3efad1&&_0x3efad1[_0x4f3ff1(0x108)])_0x12aba8=_0x3efad1['val'];}else{if(_0x168429[_0x4f3ff1(0x174)](_0x4f3ff1(0x1fc))){const _0x598268=await _0x1f492e[_0x4f3ff1(0x23d)](_0x168429+_0x4f3ff1(0x12c));if(_0x598268&&_0x598268[_0x4f3ff1(0x108)])_0x12aba8=_0x598268['val'];}}}}catch(_0x5aed08){}if(!_0x12aba8){const _0x4cd8cc=[_0x4f3ff1(0xcb),_0x4f3ff1(0x168),'weatherunderground.0',_0x4f3ff1(0x17d)];for(const _0x58e144 of _0x4cd8cc){try{const _0x570c69=await _0x1f492e[_0x4f3ff1(0xfc)](_0x58e144);if(_0x570c69){if(_0x58e144[_0x4f3ff1(0x174)]('accuweather')){const _0x441d2b=await _0x1f492e[_0x4f3ff1(0x23d)](_0x58e144+_0x4f3ff1(0x22b));if(_0x441d2b&&_0x441d2b[_0x4f3ff1(0x108)]){_0x12aba8=_0x441d2b[_0x4f3ff1(0x108)];break;}}}}catch(_0x51912a){}}}return _0x12aba8?_0x4f3ff1(0x23e)+_0x12aba8:_0x4f3ff1(0x17e);}catch(_0x1c3ac9){return _0x4f3ff1(0xc5)+_0x1c3ac9['message'];}}function a0_0xf01d(_0x3281a1,_0x3ce56d){const _0x18d038=a0_0x23f4();return a0_0xf01d=function(_0x172380,_0x33f56f){_0x172380=_0x172380-0xad;let _0x23f4e6=_0x18d038[_0x172380];return _0x23f4e6;},a0_0xf01d(_0x3281a1,_0x3ce56d);}async function getCalendarContext(_0x20b3b2){const _0x42088f=a0_0x3fb50b;try{if(!_0x20b3b2[_0x42088f(0x249)]['useCalendar'])return _0x42088f(0xbf);let _0x54606d=_0x20b3b2[_0x42088f(0x249)]['calendarInstance']||'ical.0',_0x1e1e7a=_0x20b3b2[_0x42088f(0x249)][_0x42088f(0x19c)]||[];if(typeof _0x1e1e7a===_0x42088f(0x118))_0x1e1e7a=_0x1e1e7a[_0x42088f(0x100)](',');try{const _0xb26bf=await _0x20b3b2['getForeignStateAsync'](_0x54606d+_0x42088f(0xba));if(_0xb26bf&&_0xb26bf[_0x42088f(0x108)]){let _0x17cf1c=tryParse(_0xb26bf[_0x42088f(0x108)]);if(_0x17cf1c&&Array[_0x42088f(0x18a)](_0x17cf1c)){if(_0x1e1e7a[_0x42088f(0x152)]>0x0)_0x17cf1c=_0x17cf1c[_0x42088f(0x1e0)](_0x1b5ba0=>_0x1e1e7a[_0x42088f(0x174)](_0x1b5ba0[_0x42088f(0x134)]||''));else return _0x42088f(0x27b);if(_0x17cf1c[_0x42088f(0x152)]>0x0){const _0x5ebe68=_0x17cf1c[_0x42088f(0x17b)](0x0,0x3)[_0x42088f(0x191)](_0x562204=>{const _0x568256=_0x42088f;let _0x32c707=_0x562204['date'];if(_0x562204[_0x568256(0x10c)])_0x32c707+='\x20'+_0x562204[_0x568256(0x10c)];return _0x32c707+':\x20'+_0x562204[_0x568256(0x1f1)]+'\x20('+_0x562204[_0x568256(0x134)]+')';});return _0x42088f(0x289)+_0x5ebe68['join'](_0x42088f(0x1aa));}else return _0x42088f(0x250);}}}catch(_0xa00e5){_0x20b3b2[_0x42088f(0xd6)][_0x42088f(0x295)](_0x42088f(0x15c)+_0xa00e5[_0x42088f(0xdc)]);}return'KALENDER:\x20Keine\x20Daten';}catch(_0x54c751){return _0x42088f(0x1d9)+_0x54c751[_0x42088f(0xdc)];}}async function getCalendarNames(_0x3a0e2c,_0x283ae2){const _0x4322b1=a0_0x3fb50b;try{const _0x3558d4=await _0x3a0e2c[_0x4322b1(0x23d)](_0x283ae2+_0x4322b1(0xba));if(_0x3558d4&&_0x3558d4['val']){const _0x19c1f9=tryParse(_0x3558d4[_0x4322b1(0x108)]);if(_0x19c1f9&&Array[_0x4322b1(0x18a)](_0x19c1f9)){const _0x1fbe27=[...new Set(_0x19c1f9['map'](_0x4b087f=>_0x4b087f[_0x4322b1(0x134)])[_0x4322b1(0x1e0)](Boolean))];return _0x1fbe27[_0x4322b1(0x23b)]();}}return[];}catch(_0x628e74){return _0x3a0e2c[_0x4322b1(0xd6)][_0x4322b1(0x235)](_0x4322b1(0x292)+_0x628e74[_0x4322b1(0xdc)]),[];}}async function checkWifiPresence(_0x4d614a){const _0x2cc927=a0_0x3fb50b;try{const _0x31f828=_0x4d614a[_0x2cc927(0x249)][_0x2cc927(0x1b1)]||[];let _0x153e10=![];const _0x2d3e1f=[];for(const _0x17bd86 of _0x31f828){try{const _0x2648b1=await _0x4d614a[_0x2cc927(0x23d)](_0x17bd86);if(_0x2648b1&&(_0x2648b1['val']===!![]||_0x2648b1[_0x2cc927(0x108)]===_0x2cc927(0x239)||_0x2648b1[_0x2cc927(0x108)]===0x1)){_0x153e10=!![];const _0x2b18cc=await _0x4d614a[_0x2cc927(0xfc)](_0x17bd86);let _0x2b1ef2=_0x17bd86;_0x2b18cc&&_0x2b18cc[_0x2cc927(0x13f)]&&_0x2b18cc[_0x2cc927(0x13f)]['name']&&(_0x2b1ef2=typeof _0x2b18cc[_0x2cc927(0x13f)][_0x2cc927(0x11d)]===_0x2cc927(0x1b7)?_0x2b18cc[_0x2cc927(0x13f)]['name']['de']||_0x2b18cc['common'][_0x2cc927(0x11d)]['en']:_0x2b18cc[_0x2cc927(0x13f)][_0x2cc927(0x11d)]),_0x2d3e1f['push'](_0x2b1ef2);}}catch(_0x24117d){}}return await _0x4d614a[_0x2cc927(0x21b)](_0x2cc927(0x1ac),{'val':_0x2d3e1f['join'](',\x20'),'ack':!![]}),_0x153e10&&(_0x4d614a[_0x2cc927(0xc4)]&&(_0x4d614a[_0x2cc927(0xd6)][_0x2cc927(0x24e)]('WiFi\x20Presence\x20detected\x20->\x20Aborting\x20Exit\x20Timer.\x20User\x20is\x20present.'),abortExitTimer(_0x4d614a)),!_0x4d614a[_0x2cc927(0x1b2)]&&_0x4d614a['currentSystemMode']===SYSTEM_MODES['NORMAL']&&await setPresence(_0x4d614a,!![])),_0x153e10;}catch(_0x3acfe6){return _0x4d614a[_0x2cc927(0xd6)][_0x2cc927(0x235)]('Error\x20checking\x20WiFi:\x20'+_0x3acfe6[_0x2cc927(0xdc)]),![];}}function a0_0x23f4(){const _0xaaeeaf=['...','indicator.alarm.fire','Last\x20Result','[PYTHON]\x20','GUEST','ltmJob','analysis.automation.autoApply','json','\x20(Type\x20\x27','Wetter:\x20Deaktiviert','system','No\x20module\x20named\x20pip','getForeignObjectAsync','some','writable','now','split','pop','Feedback\x20Log','ltmDriftCheckIntervalHours','341748toybIt','outdoorSensorId','subscribeStates','devices','val','Event\x20received:\x20','onStateChange','\x0a\x20\x20\x20\x20ROLLE:\x20KI-Hausverwalter\x20&\x20Gesundheits-Assistent.\x0a\x20\x20\x20\x20PERSONA:\x20','time','\x20(Value:\x20','Error\x20reading\x20outdoor\x20sensor\x20','connection','systemConfig','271379lARLgC','rssi','[RECORDER]\x20Discarding\x20short\x20sequence\x20(Length:\x20','debug','service.py','getLtmData','Automation\x20Proposals','string','onReady','indicator','generic','models/gemini-flash-latest','name','LTM','âŒ\x20AUTO-FIX\x20FAILED.\x20Please\x20check\x20permissions.','\x0a\x0a\x20\x20\x20\x20AUFGABE:\x0a\x20\x20\x20\x201.\x20Analysiere\x20auf\x20Gesundheitsrisiken\x20(Sturz,\x20InaktivitÃ¤t).\x0a\x20\x20\x20\x202.\x20Analysiere\x20auf\x20Komfort/Automatisierung\x20(\x22Butler\x22).\x20Erkennst\x20du\x20ein\x20Muster?\x20(z.B.\x20\x22Wenn\x20Bewegung\x20Flur,\x20dann\x20Licht\x20an\x22).\x0a\x20\x20\x20\x20\x0a\x20\x20\x20\x20FORMAT\x20(JSON\x20Only!):\x0a\x20\x20\x20\x20{\x0a\x20\x20\x20\x20\x20\x20\x22isAlert\x22:\x20boolean,\x0a\x20\x20\x20\x20\x20\x20\x22alertReason\x22:\x20\x22string\x20(kurz)\x22,\x0a\x20\x20\x20\x20\x20\x20\x22isEmergency\x22:\x20boolean,\x0a\x20\x20\x20\x20\x20\x20\x22summary\x22:\x20\x22string\x20(Was\x20passiert\x20gerade?)\x22,\x0a\x20\x20\x20\x20\x20\x20\x22automationProposal\x22:\x20{\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x22detected\x22:\x20boolean,\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x22description\x22:\x20\x22string\x20(Was\x20soll\x20automatisiert\x20werden?)\x22,\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x22targetId\x22:\x20\x22string\x20(ioBroker\x20ID,\x20z.B.\x200_userdata.0.light)\x22,\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x22targetValue\x22:\x20\x22any\x20(Wert,\x20z.B.\x20true\x20oder\x2050)\x22\x0a\x20\x20\x20\x20\x20\x20}\x0a\x20\x20\x20\x20}\x0a\x20\x20\x20\x20','triggerBriefing','klima','Verbindung\x20erfolgreich!\x20Antwort:\x20','geminiApiKey','PRIORITÃ„T:\x20Sicherheit.','baselineDrift','Last\x20Check','\x20sensors...','analysis.automation','LTM.dailyDigests','flot.','.forecast.current.state','\x20(Length:\x20','Started\x20at\x20','timestamp','Failed\x20to\x20send\x20to\x20Python:\x20','channel','LTM.driftAnalysis.lastCheck','23728mSEUIA','_calName','\x20(Value\x20is\x20falsy:\x20','LTM.trainingData','\x20min).','push','.\x20Welcome\x20home.','/100,\x20AktivitÃ¤t\x20seit\x2004:00:\x20','admin.','Guardian:\x20Sending\x20','catch','Drift\x20Details','common','door','Urlaub','getTime','5259879OsRrEa','analysis.deviationFromBaseline','.\x0a\x20\x20\x20\x20\x0a\x20\x20\x20\x20INPUT\x20DATEN\x20(Letzte\x20Events):\x0a\x20\x20\x20\x20','getOverviewData','Briefing\x20Sched\x20Error:\x20','getHours','notifyTelegramEnabled','VACATION','Keiner','ðŸ“ž\x20User\x20requested\x20CALL\x20via\x20Telegram!','Array\x20of\x20completed\x20movement\x20paths\x20for\x20ML\x20training','414789LsHqgx','Analysiere\x20ausgewogen.','stderr','targetValue','length','apiKey','[RECORDER\x20DEBUG]\x20Ignored\x20Event\x20','setState','HARD\x20WATCHDOG:\x20No\x20sensor\x20activity\x20detected\x20for\x20','vis.','notifyTelegramInstance','Morning\x20Briefing\x20sent.','08:00','.\x20KONTEXT:\x20','Error\x20reading\x20calendar\x20table:\x20','generateContent','Daily\x20Digests','position','.NextHours.Location_1.Day_1.current.temp_value','ðŸ“ž\x20RÃ¼ckruf\x20anfordern','Keine\x20Details.','analysis.automation.description','(((.+)+)+)+$','sensorLastValues','geminiModel','Success:\x20Compressed\x20','daswetter.0','text','âœ…\x20SUCCESS.\x20Dependencies\x20installed.\x20Restarting\x20Service...','toLocaleString','application/json','events.history_debug_00','isProVersion','PRO-','pythonProcess','events.lastEvent','ðŸ\x20Stopping\x20Python\x20Sidecar...','Who\x20is\x20present?','includes','python3','Drift\x20Analysis','Deaktiviert\x20(Pro-Feature)','summary','Pattern\x20Detected','Description','slice','presence','openweathermap.0','WETTER:\x20Keine\x20Daten\x20gefunden','child_process','values','.communicate.request','simple-api.','Subscribing\x20to\x20','toFixed','testApiKey','PARTY','description','enum.functions.*',').\x20Starting\x20Timer.','isArray','firmware','Trigger\x20Briefing\x20(Test)','stateChange','cogni-living\x20adapter\x20starting\x20(v','Normal','temperature','map','briefingTime','analysis.automation.targetValue','status','onUnload','âŒ\x20CRITICAL:\x20Self-healing\x20failed.\x20The\x20system\x20is\x20locked\x20down.','setpoint','.\x0a\x20\x20\x20\x20KONTEXT:\x20','analysisInterval','activityLevel','IGNORING\x20DUPLICATE\x20(Cached):\x20','calendarSelection','text.alarm','SIMULATION:\x20Test-Vorschlag\x20fÃ¼r\x20','autoApply','version','Gemini\x20Analysis\x20Error:\x20','kontakt','Keine\x20Analyse.','inactivityMonitoringEnabled','config_pending','bind','[RECORDER]\x20Error\x20saving\x20sequence:\x20','node-schedule','dependencyInstallInProgress','\x20|\x20','lampe','system.presenceWho','payload','âœ…\x20Alarm\x20quittiert.\x20System\x20normal.','isGracePeriodActive','Deviation','presenceDevices','isPresent','type','dailyDigests','[RESULT]','Target\x20Value','object','uuid','\x20hours.\x20Potential\x20incapacitation.','Trigger\x20Action\x20Now','ROLLE:\x20FÃ¼rsorglicher\x20Assistent.\x20AUFGABE:\x20Schreibe\x20eine\x20kurze,\x20beruhigende\x20\x22Guten\x20Morgen\x22-Nachricht.\x20PERSONA:\x20','5QSSgtP','.\x0a\x20\x20\x20\x20WETTER:\x20','getForeignObjectsAsync','ðŸ“¡\x20Hooking\x20into\x20','delObjectAsync','Scheduling\x20Morning\x20Briefing\x20for\x20','driftAnalysisTimer','extendObjectAsync','weatherInstance','Adapter','\x20days\x20of\x20activity\x20data\x20to\x20Python...','ðŸš¨\x20EMERGENCY','Lernphase\x20(','close','aiPersona','Guardian:\x20Not\x20enough\x20history\x20data\x20for\x20trend\x20analysis\x20yet.','blind','python3\x20-m\x20ensurepip\x20--default-pip\x20--user','analysis.automation.triggerAction','LTM.driftAnalysis.driftDetails','ðŸ\x20Guardian\x20Diagnosis\x20(','analysis.health.trendValue','requirements.txt','echarts.','Auto\x20Apply\x20Rule','python3\x20-m\x20pip\x20install\x20-r\x20\x22','TREND_RESULT','Comfort\x20Summary','getGenerativeModel','KALENDER\x20ERROR:\x20','Vom\x20Benutzer\x20bestÃ¤tigt\x20(OK).','63msQraZ','toString','system.','Sleep\x20Score\x20(0-100)','lastAlertState','filter','ðŸŒ…\x20Daily\x20Briefing:\x0a','constructor','occupancy','Could\x20not\x20kill\x20Python\x20process:\x20','icons-mfd.','splice','.forecast.current.temperature','N/A','write','native','âŒ\x20Installation\x20failed\x20even\x20after\x20bootstrap:\x20','LTM.trainingData.sequences','analysis.health.trendDiagnosis','Cogni-Living','7230560ckLeqw','working','event','Bibliotheken\x20nicht\x20gefunden','system.isPresent','lowbat','search','ltmStbWindowDays','LTM.processingStatus','LTM.rawEventLog','LTM.triggerDailyDigest','dimmer','analysis.automation.targetId','openweathermap','callback','siren','COGNI_CONFIRM_OK','modeResetJob','alertReason','[PYTHON]\x20Service\x20exited\x20with\x20code\x20','subscribeForeignStatesAsync','fault','.forecast.current.temp','longitude','brightness','expire','\x22\x20--break-system-packages','python_service','stdout','âœ…\x20AUTO-FIX\x20SUCCESS.\x20Dependencies\x20installed.\x20Restarting\x20Service...','ðŸ§ª\x20Simulating\x20Butler\x20Proposal:\x20','ROLLE:\x20Data\x20Compression\x20Agent.\x20SPRACHE:\x20DE.\x20FORMAT:\x20JSON.\x20ANWEISUNG:\x20Fasse\x20Sensor-Events\x20zusammen.\x20SCHEMA:\x20{\x20\x22summary\x22:\x20\x22string\x22,\x20\x22activityLevel\x22:\x20\x22string\x22\x20}\x20\x0a\x0aEVENTS:\x0a','sound','ltmLtbWindowDays','instance','automationProposal','useWeather','getEnums','main','driftDetails','analysis.lastResult','off','LTM.trainingData.thermodynamics','stringify','setStateAsync','unshift','boolean','scriptEnabled','getFullYear','forEach','getStateAsync','Gemini\x20AI\x20initialized.','Trend\x20Value\x20(%)','analysis.triggerBriefing','notifyPushoverInstance','KI-Modell\x20nicht\x20initialisiert','details','.Current.Temperature','âœ…\x20User\x20confirmed\x20ALARM\x20via\x20Telegram.\x20Resetting\x20system.','briefingJob','.Summary.Current','âš ï¸\x20PIP\x20is\x20missing.\x20Attempting\x20self-healing\x20via\x20ensurepip\x20(User\x20Mode)...','ready','eventHistory','\x27\x20not\x20in\x20allowed\x20list)','onMessage','Missing\x20data','latitude','Raw\x20Log','replace','error','âœ…\x20PIP\x20bootstrapped\x20successfully.\x20Retrying\x20installation...','path','404166tJAkEc','online','indexOf','sort','energy','getForeignStateAsync','WETTER:\x20','Entry\x20detected\x20via\x20','\x20*\x20*\x20*','Error:\x20','analysis.automation.patternDetected','notifyEmailInstance','AI\x20Alert\x20Status','analysis.health.notes','Starting\x20Autopilot\x20(','analysis.health','Motion\x20detected\x20inside.\x20Aborting\x20Exit\x20Timer.','config','cogni-living','switch','Aktiv\x20(','analysis.alertReason','info','Kein\x20API\x20Key\x20eingegeben.','KALENDER:\x20Keine\x20relevanten\x20Termine','analysisHistory','Gast','Activity-Level','window','analysis.health.restlessness','\x20for\x20interactive\x20buttons...','analysis.activitySummary','Generating\x20Morning\x20Briefing...','No\x20instance','âš ï¸\x20Python\x20missing\x20dependencies.\x20Triggering\x20Auto-Install...','.\x20OUTPUT:\x20Nur\x20Text.','daswetter','ANALYZE_TREND','analysis.trigger','dutycycle','No\x20module\x20named','genAI','8ArnWqr','Alert\x20Reason','ðŸ› ï¸\x20AUTO-FIX:\x20Installing\x20Python\x20dependencies\x20from\x20','events.history','apply','.NextHours.Location_1.Day_1.current.symbol_desc','Kein\x20API\x20Key!','vacation','level','[RECORDER]\x20Sequence\x20finished\x20(Steps:\x20','number','Invalid\x20JSON\x20from\x20Python:\x20','accuweather','[PYTHON\x20ERR]\x20','sleepScore','ðŸ“ž\x20RÃœCKRUF\x20BITTE!\x20Der\x20Bewohner\x20hat\x20den\x20RÃ¼ckruf-Button\x20gedrÃ¼ckt.','ML-Libs\x20fehlen','response','location','COGNI_REQUEST_CALL','notifyTelegramRecipient','Fehler:\x20','trim','maintenance','Party','KALENDER:\x20Keine\x20Kalender\x20ausgewÃ¤hlt\x20(Bitte\x20in\x20Settings\x20konfigurieren)','material.','health','Trigger\x20Analysis','briefingEnabled','Health\x20Notes','System\x20Status\x20&\x20Control','PONG','reachable','Health\x20&\x20Sleep\x20Analysis','scheduleJob','date','LTM.driftAnalysis.baselineDrift','Error\x20launching\x20Python\x20service:\x20','KALENDER:\x20','unknown','automation.triggerAction','NORMAL','150qsEUTu','ack','notifyEmailRecipient','âš ï¸\x20ALARM:\x20','value','getCalendarNames\x20Error:\x20','round','scanDevices','warn','\x20presence\x20devices...','shift','Drift\x20Status','state','rawEventLog','sendTo','setObjectNotExistsAsync','Feedback\x20saved:\x20','toLowerCase','notifyEmailEnabled','system.mode','shutter','ðŸ¤–\x20BUTLER\x20AUTO-APPLY:\x20Executing\x20','data',').\x20Saving\x20to\x20Training\x20Data.','analysis.analysisHistory','system.meta.uuid','Please\x20run\x20this\x20MANUALLY\x20in\x20the\x20console\x20(as\x20root/sudo):\x20apt\x20install\x20python3-pip','getDate','Unknown','LTM\x20Sched\x20Error:\x20','Exit\x20Sensor\x20triggered\x20(','lastCheck','parse','unreach','Details:\x20','heizung','Sending\x20notification:\x20\x22','.data.table','\x20events)...','startsWith','LTM.baselineStatus','substring','Kalender:\x20Deaktiviert','motion','analysis.isAlert','tÃ¼r','join','exitTimer','WETTER\x20ERROR:\x20','triggerDailyDigest','minDaysForBaseline','Drift\x20Sched\x20Error:\x20','targetId','guest','accuweather.0','currentSystemMode','button','city','.\x0a\x20\x20\x20\x20NOTFALL-KONTEXT:\x20','isAlert','\x20=\x20','from','info.','\x20Tage)','analysis.health.sleepScore','log','livingContext','stdin','Trigger\x20Digest','ROLLE:\x20Data\x20Scientist.\x20ZIEL:\x20Drift\x20erkennen.\x20SCHEMA:\x20{\x20\x22baselineDrift\x22:\x20\x22none|slight|significant|critical\x22,\x20\x22driftDetails\x22:\x20\x22string\x22\x20}\x0a\x0aLTB:\x20','set_temperature','message','dismissAutomation','Processing\x20Status','loc','analysisTimer','systemUUID','\x20events','cancel','Fokus\x20auf\x20Komfort.','send','logDuplicates','direction','getObjectAsync','detected','\x22\x20--break-system-packages\x20--user','inactivityThresholdHours','command','kill','exitGraceTimer','TEST-PRO-KEY'];a0_0x23f4=function(){return _0xaaeeaf;};return a0_0x23f4();}function startExitTimer(_0x56f160){const _0x215b8b=a0_0x3fb50b;abortExitTimer(_0x56f160),_0x56f160[_0x215b8b(0x1af)]=!![],_0x56f160[_0x215b8b(0xee)]=setTimeout(()=>{_0x56f160['isGracePeriodActive']=![];},EXIT_GRACE_PERIOD_SECONDS*0x3e8),_0x56f160[_0x215b8b(0xc4)]=setTimeout(()=>{const _0x3bc791=_0x215b8b;setPresence(_0x56f160,![]),_0x56f160[_0x3bc791(0xc4)]=null;},EXIT_TIMER_MINUTES*0x3c*0x3e8);}function abortExitTimer(_0x48b16d){const _0x8323f8=a0_0x3fb50b;if(_0x48b16d[_0x8323f8(0xc4)])clearTimeout(_0x48b16d['exitTimer']);if(_0x48b16d['exitGraceTimer'])clearTimeout(_0x48b16d[_0x8323f8(0xee)]);_0x48b16d[_0x8323f8(0xc4)]=null,_0x48b16d[_0x8323f8(0xee)]=null,_0x48b16d[_0x8323f8(0x1af)]=![];}async function setPresence(_0x3d1424,_0x95626f){const _0x19770f=a0_0x3fb50b;if(_0x3d1424[_0x19770f(0x1b2)]===_0x95626f)return;_0x3d1424[_0x19770f(0x1b2)]=_0x95626f,await _0x3d1424[_0x19770f(0x21b)](_0x19770f(0x1f3),{'val':_0x95626f,'ack':!![]});}async function saveFeedback(_0x36bf56,_0x2c1daf){const _0x4dfd54=a0_0x3fb50b;_0x36bf56['log'][_0x4dfd54(0x24e)](_0x4dfd54(0x29d)+JSON['stringify'](_0x2c1daf));}async function runBaselineDriftAnalysis(_0x1b9ab5){const _0xca22b3=a0_0x3fb50b;if(!_0x1b9ab5[_0xca22b3(0x16e)]||!_0x1b9ab5[_0xca22b3(0x166)])return;const _0x44749a=_0x1b9ab5['config']['ltmStbWindowDays']||0xe;if(_0x1b9ab5[_0xca22b3(0x1b4)][_0xca22b3(0x152)]<_0x44749a+(_0x1b9ab5['config'][_0xca22b3(0xc7)]||0x7)){await _0x1b9ab5[_0xca22b3(0x21b)](LTM_DP_DRIFT_STATUS,{'val':'N/A\x20(Learning)','ack':!![]});return;}const _0x53e609=_0x1b9ab5['dailyDigests'][_0xca22b3(0x17b)](-_0x44749a),_0x2abe31=_0x1b9ab5[_0xca22b3(0x1b4)][_0xca22b3(0x17b)](0x0,_0x1b9ab5[_0xca22b3(0x1b4)][_0xca22b3(0x152)]-_0x44749a),_0x2f4740=_0xca22b3(0xda)+JSON['stringify'](_0x2abe31)+'\x0aSTB:\x20'+JSON[_0xca22b3(0x21a)](_0x53e609);try{const _0x2cd24a=await _0x1b9ab5[_0xca22b3(0x166)][_0xca22b3(0x15d)](_0x2f4740),_0x47d7cc=JSON[_0xca22b3(0xb5)](_0x2cd24a['response']['text']()[_0xca22b3(0x234)](/```json|```/g,'')['trim']());_0x47d7cc[_0xca22b3(0x126)]&&(await _0x1b9ab5[_0xca22b3(0x21b)](LTM_DP_DRIFT_STATUS,{'val':_0x47d7cc[_0xca22b3(0x126)],'ack':!![]}),await _0x1b9ab5[_0xca22b3(0x21b)](LTM_DP_DRIFT_DETAILS,{'val':_0x47d7cc[_0xca22b3(0x216)],'ack':!![]}),await _0x1b9ab5['setStateAsync'](LTM_DP_DRIFT_LAST_CHECK,{'val':Date[_0xca22b3(0xff)](),'ack':!![]}));}catch(_0x4293c2){}}function setupLtmScheduler(_0x370168){const _0x5d5db3=a0_0x3fb50b;try{if(_0x370168['ltmJob'])_0x370168[_0x5d5db3(0xf5)][_0x5d5db3(0xe3)]();if(!_0x370168[_0x5d5db3(0x16e)]){_0x370168[_0x5d5db3(0x21b)](LTM_DP_STATUS,{'val':_0x5d5db3(0x177),'ack':!![]});return;}_0x370168[_0x5d5db3(0xf5)]=schedule['scheduleJob'](LTM_SCHEDULE,()=>createDailyDigest(_0x370168));}catch(_0x328cb8){_0x370168[_0x5d5db3(0xd6)][_0x5d5db3(0x235)](_0x5d5db3(0xb2)+_0x328cb8[_0x5d5db3(0xdc)]);}}function setupModeResetScheduler(_0x2e8215){const _0x40003e=a0_0x3fb50b;try{if(_0x2e8215['modeResetJob'])_0x2e8215[_0x40003e(0x200)][_0x40003e(0xe3)]();_0x2e8215[_0x40003e(0x200)]=schedule[_0x40003e(0x285)](MODE_RESET_SCHEDULE,async()=>{const _0x5e61c1=_0x40003e;await loadSystemMode(_0x2e8215),AUTO_RESET_MODES[_0x5e61c1(0x174)](_0x2e8215['currentSystemMode'])&&await _0x2e8215[_0x5e61c1(0x21b)](SYSTEM_DP_MODE,{'val':SYSTEM_MODES[_0x5e61c1(0x28c)],'ack':![]});});}catch(_0x227f76){_0x2e8215[_0x40003e(0xd6)][_0x40003e(0x235)]('Reset\x20Sched\x20Error:\x20'+_0x227f76[_0x40003e(0xdc)]);}}function setupDriftAnalysisScheduler(_0x48212a){const _0x58e1f0=a0_0x3fb50b;try{if(_0x48212a[_0x58e1f0(0x1c2)])clearInterval(_0x48212a[_0x58e1f0(0x1c2)]);if(!_0x48212a[_0x58e1f0(0x16e)])return;_0x48212a['driftAnalysisTimer']=setInterval(()=>runBaselineDriftAnalysis(_0x48212a),(_0x48212a[_0x58e1f0(0x249)][_0x58e1f0(0x103)]||0x18)*0x36ee80),setTimeout(()=>runBaselineDriftAnalysis(_0x48212a),0x1388);}catch(_0x37b7d1){_0x48212a[_0x58e1f0(0xd6)]['error'](_0x58e1f0(0xc8)+_0x37b7d1['message']);}}function setupBriefingScheduler(_0x57592e){const _0x3bcd44=a0_0x3fb50b;try{if(_0x57592e[_0x3bcd44(0x22a)])_0x57592e['briefingJob']['cancel']();if(!_0x57592e[_0x3bcd44(0x249)][_0x3bcd44(0x27f)])return;const _0x23b474=(_0x57592e[_0x3bcd44(0x249)][_0x3bcd44(0x192)]||_0x3bcd44(0x15a))[_0x3bcd44(0x100)](':'),_0x568b75=parseInt(_0x23b474[0x0])||0x8,_0x4f6c7d=parseInt(_0x23b474[0x1])||0x0,_0x13e4bf=_0x4f6c7d+'\x20'+_0x568b75+_0x3bcd44(0x240);_0x57592e[_0x3bcd44(0xd6)][_0x3bcd44(0x24e)](_0x3bcd44(0x1c1)+_0x568b75+':'+(_0x4f6c7d<0xa?'0'+_0x4f6c7d:_0x4f6c7d)),_0x57592e[_0x3bcd44(0x22a)]=schedule['scheduleJob'](_0x13e4bf,()=>{sendMorningBriefing(_0x57592e);});}catch(_0x5d458b){_0x57592e['log']['error'](_0x3bcd44(0x147)+_0x5d458b[_0x3bcd44(0xdc)]);}}async function sendNotification(_0x31a84d,_0xa00a60,_0x3f2d81=![],_0x32e820=![]){const _0xcf8547=a0_0x3fb50b;_0x31a84d[_0xcf8547(0xd6)][_0xcf8547(0x24e)]((_0x3f2d81?'[TEST]\x20':'')+_0xcf8547(0xb9)+_0xa00a60+'\x22');const _0x249324=_0x31a84d['config'];let _0x341a2b=0x0;if(_0x249324['notifyTelegramEnabled']){let _0x322a57={};(_0xa00a60[_0xcf8547(0x174)]('Alarm')||_0x32e820)&&(_0x322a57={'reply_markup':{'inline_keyboard':[[{'text':'âœ…\x20Alles\x20OK\x20(Reset)','callback_data':_0xcf8547(0x1ff)}],[{'text':_0xcf8547(0x161),'callback_data':_0xcf8547(0x275)}]]}}),await _0x31a84d['sendToAsync'](_0x249324[_0xcf8547(0x158)],'send',{'text':_0xa00a60,'user':_0x249324[_0xcf8547(0x276)],..._0x322a57}),_0x341a2b++;}if(_0x249324['notifyPushoverEnabled']){let _0x45c0d8={'message':_0xa00a60,'title':_0x32e820?_0xcf8547(0x1c7):_0xcf8547(0x1ee),'priority':_0x32e820?0x2:0x1,'device':_0x249324['notifyPushoverRecipient']};_0x32e820&&(_0x45c0d8['retry']=0x1e,_0x45c0d8[_0xcf8547(0x208)]=0xe10,_0x45c0d8[_0xcf8547(0x20f)]=_0xcf8547(0x1fe)),await _0x31a84d['sendToAsync'](_0x249324[_0xcf8547(0x225)],_0xcf8547(0xe5),_0x45c0d8),_0x341a2b++;}return _0x249324[_0xcf8547(0x29f)]&&(await _0x31a84d['sendToAsync'](_0x249324[_0xcf8547(0x243)],_0xcf8547(0xe5),{'text':_0xa00a60,'to':_0x249324[_0xcf8547(0x28f)]}),_0x341a2b++),_0x341a2b;}async function setupTelegramListener(_0x2b833f){const _0x3ede74=a0_0x3fb50b,_0x55f948=_0x2b833f[_0x3ede74(0x249)]['notifyTelegramInstance'];_0x2b833f[_0x3ede74(0x249)][_0x3ede74(0x149)]&&_0x55f948&&(_0x2b833f[_0x3ede74(0xd6)]['info'](_0x3ede74(0x1bf)+_0x55f948+_0x3ede74(0x256)),await _0x2b833f[_0x3ede74(0x203)](_0x55f948+_0x3ede74(0x181)));}async function handleTelegramResponse(_0x23a73b,_0x7bd43f){const _0x2415bb=a0_0x3fb50b;let _0x41cd89=_0x7bd43f;_0x7bd43f['startsWith']('[')&&(_0x41cd89=_0x7bd43f[_0x2415bb(0xbe)](_0x7bd43f[_0x2415bb(0x23a)](']')+0x1));if(_0x41cd89===_0x2415bb(0x1ff))_0x23a73b[_0x2415bb(0xd6)][_0x2415bb(0x24e)](_0x2415bb(0x229)),await _0x23a73b[_0x2415bb(0x21b)](_0x2415bb(0xc1),{'val':![],'ack':!![]}),await _0x23a73b[_0x2415bb(0x21b)](_0x2415bb(0x24d),{'val':_0x2415bb(0x1da),'ack':!![]}),_0x23a73b[_0x2415bb(0x1df)]=![],sendNotification(_0x23a73b,_0x2415bb(0x1ae),![]);else _0x41cd89==='COGNI_REQUEST_CALL'&&(_0x23a73b[_0x2415bb(0xd6)]['warn'](_0x2415bb(0x14c)),sendNotification(_0x23a73b,_0x2415bb(0x271),![],!![]));}async function runAutopilot(_0x28cd83){const _0x102b8a=a0_0x3fb50b,_0x3efdeb=_0x28cd83['config'][_0x102b8a(0xeb)],_0x35d2e0=_0x28cd83[_0x102b8a(0x22e)][_0x102b8a(0x152)]>0x0?_0x28cd83[_0x102b8a(0x22e)][0x0]['timestamp']:Date[_0x102b8a(0xff)](),_0x30b059=(Date[_0x102b8a(0xff)]()-_0x35d2e0)/(0x3e8*0x3c*0x3c);let _0x3e4a67='';_0x28cd83[_0x102b8a(0x249)][_0x102b8a(0x1a4)]&&_0x28cd83[_0x102b8a(0xcc)]===SYSTEM_MODES['NORMAL']&&_0x28cd83['isPresent']&&(_0x30b059>_0x3efdeb&&(_0x3e4a67=_0x102b8a(0x156)+_0x30b059[_0x102b8a(0x184)](0x1)+_0x102b8a(0x1b9))),runGeminiAnalysis(_0x28cd83,_0x3e4a67)[_0x102b8a(0x13d)](_0x15e1b8=>_0x28cd83[_0x102b8a(0xd6)]['error'](_0x15e1b8));}async function createDailyDigest(_0x368959){const _0x181f65=a0_0x3fb50b;if(!_0x368959[_0x181f65(0x16e)])return;await _0x368959[_0x181f65(0x21b)](LTM_DP_STATUS,{'val':_0x181f65(0x12e)+new Date()[_0x181f65(0x16b)](),'ack':!![]});if(!_0x368959[_0x181f65(0x166)]||_0x368959[_0x181f65(0x29a)][_0x181f65(0x152)]<LTM_MIN_EVENTS_FOR_COMPRESSION){await _0x368959[_0x181f65(0x21b)](LTM_DP_STATUS,{'val':'Skipped\x20(No\x20AI\x20or\x20Data)','ack':!![]});return;}const _0x2c61df=JSON[_0x181f65(0xb5)](JSON[_0x181f65(0x21a)](_0x368959['rawEventLog'])),_0x322291=_0x2c61df[_0x181f65(0x152)],_0x9bf0c=_0x181f65(0x20e)+JSON[_0x181f65(0x21a)](_0x2c61df);try{const _0x5110b8=await _0x368959['geminiModel'][_0x181f65(0x15d)](_0x9bf0c),_0x1f594c=JSON[_0x181f65(0xb5)](_0x5110b8[_0x181f65(0x273)][_0x181f65(0x169)]()['replace'](/```json|```/g,'')['trim']());_0x1f594c[_0x181f65(0x178)]&&(_0x368959[_0x181f65(0x1b4)]['push']({'timestamp':new Date()['toISOString'](),'eventCount':_0x322291,'summary':_0x1f594c[_0x181f65(0x178)],'activityLevel':_0x1f594c['activityLevel'],'systemMode':_0x368959['currentSystemMode']}),await saveDailyDigests(_0x368959),_0x368959[_0x181f65(0x29a)]=[],await saveRawEventLog(_0x368959),await _0x368959[_0x181f65(0x21b)](LTM_DP_STATUS,{'val':_0x181f65(0x167)+_0x322291+_0x181f65(0xe2),'ack':!![]}),runPythonHealthCheck(_0x368959));}catch(_0x3970d8){await _0x368959[_0x181f65(0x21b)](LTM_DP_STATUS,{'val':_0x181f65(0x241)+_0x3970d8['message'],'ack':!![]});}}async function sendMorningBriefing(_0x7b38e0){const _0x491d09=a0_0x3fb50b;if(!_0x7b38e0['geminiModel'])return;_0x7b38e0[_0x491d09(0xd6)]['info'](_0x491d09(0x258));const _0x53ea8f=_0x7b38e0[_0x491d09(0x1b4)][_0x491d09(0x152)]>0x0?_0x7b38e0['dailyDigests'][_0x7b38e0[_0x491d09(0x1b4)][_0x491d09(0x152)]-0x1]:null,_0x5e5d93=_0x53ea8f&&_0x53ea8f[_0x491d09(0x27d)]?_0x53ea8f[_0x491d09(0x27d)][_0x491d09(0x270)]:_0x491d09(0x1e8),_0x2a9eee=new Date();_0x2a9eee['setHours'](0x4,0x0,0x0,0x0);const _0x3ff123=_0x7b38e0['eventHistory'][_0x491d09(0x1e0)](_0x2f423b=>new Date(_0x2f423b['timestamp'])>_0x2a9eee),_0x494c6e=PERSONA_MAPPING[_0x7b38e0[_0x491d09(0x249)]['aiPersona']||_0x491d09(0x11b)],_0x2cb6c6=_0x7b38e0[_0x491d09(0x249)][_0x491d09(0xd7)]||'',_0x226b9f=await getWeatherContext(_0x7b38e0),_0x285352=await getCalendarContext(_0x7b38e0),_0x3a4ceb=_0x491d09(0x1bb)+_0x494c6e+_0x491d09(0x15b)+_0x2cb6c6+'.\x20ZUSATZ:\x20'+_0x226b9f+'\x20'+_0x285352+'.\x20DATEN:\x20Schlaf\x20'+_0x5e5d93+_0x491d09(0x13a)+JSON[_0x491d09(0x21a)](_0x3ff123[_0x491d09(0x17b)](0x0,0xa))+_0x491d09(0x25b);try{const _0x5c6e13=await _0x7b38e0[_0x491d09(0x166)][_0x491d09(0x15d)](_0x3a4ceb),_0x2c0480=_0x491d09(0x1e1)+_0x5c6e13[_0x491d09(0x273)][_0x491d09(0x169)]()[_0x491d09(0x278)]();sendNotification(_0x7b38e0,_0x2c0480),_0x7b38e0[_0x491d09(0xd6)][_0x491d09(0x24e)](_0x491d09(0x159));}catch(_0x521980){_0x7b38e0['log'][_0x491d09(0x235)]('Briefing\x20Error:\x20'+_0x521980[_0x491d09(0xdc)]);}}async function recordSequence(_0x181ae4,_0x335b8e){const _0x21a311=a0_0x3fb50b,_0x4cfbe3=(_0x335b8e[_0x21a311(0x1b3)]||'')['toLowerCase'](),_0x338142=[_0x21a311(0xc0),'bewegung','prÃ¤senz',_0x21a311(0x17c),_0x21a311(0x1e3),_0x21a311(0x140),_0x21a311(0xc2),_0x21a311(0x254),'fenster','contact',_0x21a311(0x1a2),'light','licht',_0x21a311(0x24b),'schalter',_0x21a311(0x1fa),_0x21a311(0x1ab)];if(!_0x338142[_0x21a311(0xfd)](_0x1a748e=>_0x4cfbe3['includes'](_0x1a748e))){_0x181ae4[_0x21a311(0xd6)]['debug'](_0x21a311(0x154)+_0x335b8e['id']+_0x21a311(0xf8)+_0x335b8e['type']+_0x21a311(0x22f));return;}if(!_0x335b8e[_0x21a311(0x291)]){_0x181ae4[_0x21a311(0xd6)][_0x21a311(0x114)](_0x21a311(0x154)+_0x335b8e['id']+_0x21a311(0x135)+_0x335b8e[_0x21a311(0x291)]+')');return;}_0x181ae4['log']['debug']('[RECORDER\x20DEBUG]\x20Accepting\x20Event\x20'+_0x335b8e['id']+'\x20('+_0x335b8e[_0x21a311(0x274)]+')');if(sequenceTimer)clearTimeout(sequenceTimer);const _0x2445a5={'loc':_0x335b8e[_0x21a311(0x274)]||_0x21a311(0xb1),'id':_0x335b8e['id'],'ts':Date[_0x21a311(0xff)]()};activeSequence['push'](_0x2445a5),_0x181ae4[_0x21a311(0xd6)][_0x21a311(0x114)]('[RECORDER]\x20Added\x20step\x20to\x20sequence:\x20'+_0x2445a5[_0x21a311(0xdf)]+_0x21a311(0x12d)+activeSequence[_0x21a311(0x152)]+')'),sequenceTimer=setTimeout(async()=>{const _0x536f0f=_0x21a311;activeSequence[_0x536f0f(0x152)]>0x1?await saveCompletedSequence(_0x181ae4):(_0x181ae4[_0x536f0f(0xd6)][_0x536f0f(0x114)](_0x536f0f(0x113)+activeSequence[_0x536f0f(0x152)]+')'),activeSequence=[]);},SEQUENCE_TIMEOUT_MS);}async function saveCompletedSequence(_0x67d748){const _0x381d95=a0_0x3fb50b;try{_0x67d748[_0x381d95(0xd6)][_0x381d95(0x24e)](_0x381d95(0x26b)+activeSequence[_0x381d95(0x152)]+_0x381d95(0x2a4));const _0x33660d=await _0x67d748[_0x381d95(0x221)](_0x381d95(0x1ec));let _0x258f47=[];if(_0x33660d&&_0x33660d['val'])try{_0x258f47=JSON[_0x381d95(0xb5)](_0x33660d[_0x381d95(0x108)]);}catch(_0x4f03db){}const _0x2f3d0c=activeSequence[0x0]['ts'],_0x1468ce=activeSequence[_0x381d95(0x191)](_0x49ab3f=>({'loc':_0x49ab3f[_0x381d95(0xdf)],'t_delta':Math[_0x381d95(0x293)]((_0x49ab3f['ts']-_0x2f3d0c)/0x3e8)})),_0x173160={'timestamp':new Date(_0x2f3d0c)['toISOString'](),'steps':_0x1468ce,'duration':Math[_0x381d95(0x293)]((activeSequence[activeSequence[_0x381d95(0x152)]-0x1]['ts']-_0x2f3d0c)/0x3e8),'daytime':new Date(_0x2f3d0c)[_0x381d95(0x148)]()};_0x258f47['push'](_0x173160),_0x258f47[_0x381d95(0x152)]>MAX_TRAINING_SET_SIZE&&_0x258f47[_0x381d95(0x297)](),await _0x67d748['setStateAsync'](_0x381d95(0x1ec),{'val':JSON[_0x381d95(0x21a)](_0x258f47),'ack':!![]}),activeSequence=[],sequenceTimer=null;}catch(_0x598894){_0x67d748[_0x381d95(0xd6)][_0x381d95(0x235)](_0x381d95(0x1a7)+_0x598894['message']);}}async function getOutsideTemperatureNumeric(_0x2e8dce){const _0x1b8efa=a0_0x3fb50b;if(_0x2e8dce[_0x1b8efa(0x249)][_0x1b8efa(0x105)])try{const _0x45772e=await _0x2e8dce[_0x1b8efa(0x23d)](_0x2e8dce[_0x1b8efa(0x249)][_0x1b8efa(0x105)]);if(_0x45772e&&_0x45772e[_0x1b8efa(0x108)]!==undefined&&_0x45772e['val']!==null){const _0x769267=parseFloat(_0x45772e[_0x1b8efa(0x108)]);if(!isNaN(_0x769267))return _0x769267;}}catch(_0x6a6751){_0x2e8dce['log']['warn'](_0x1b8efa(0x10e)+_0x2e8dce[_0x1b8efa(0x249)][_0x1b8efa(0x105)]+':\x20'+_0x6a6751['message']);}const _0x45726a=_0x2e8dce[_0x1b8efa(0x249)][_0x1b8efa(0x1c4)];if(!_0x2e8dce[_0x1b8efa(0x249)][_0x1b8efa(0x213)]||!_0x45726a)return null;try{let _0x38344b='';if(_0x45726a[_0x1b8efa(0x174)]('accuweather'))_0x38344b=_0x45726a+_0x1b8efa(0x228);else{if(_0x45726a['includes'](_0x1b8efa(0x25c)))_0x38344b=_0x45726a+_0x1b8efa(0x160);else{if(_0x45726a[_0x1b8efa(0x174)](_0x1b8efa(0x1fc)))_0x38344b=_0x45726a+_0x1b8efa(0x1e7);else{if(_0x45726a['includes']('weatherunderground'))_0x38344b=_0x45726a+_0x1b8efa(0x205);}}}if(_0x38344b){const _0x469dc6=await _0x2e8dce[_0x1b8efa(0x23d)](_0x38344b);if(_0x469dc6&&_0x469dc6[_0x1b8efa(0x108)]!==undefined&&_0x469dc6[_0x1b8efa(0x108)]!==null)return parseFloat(_0x469dc6['val']);}}catch(_0x49c927){}return null;}async function recordThermodynamics(_0x1cc61a,_0x2c9df0,_0x11c35a,_0x279f4b){const _0x1c5af7=a0_0x3fb50b,_0xa393dc=await getOutsideTemperatureNumeric(_0x1cc61a),_0x2d4d96=await _0x1cc61a['getStateAsync']('LTM.trainingData.thermodynamics');let _0x1dad52=[];if(_0x2d4d96&&_0x2d4d96[_0x1c5af7(0x108)])try{_0x1dad52=JSON['parse'](_0x2d4d96[_0x1c5af7(0x108)]);}catch(_0x3052ce){}_0x1dad52['push']({'ts':Date[_0x1c5af7(0xff)](),'room':_0x279f4b||'Unknown','t_in':_0x11c35a,'t_out':_0xa393dc});if(_0x1dad52[_0x1c5af7(0x152)]>THERMO_LOG_SIZE)_0x1dad52['shift']();await _0x1cc61a[_0x1c5af7(0x21b)](_0x1c5af7(0x219),{'val':JSON[_0x1c5af7(0x21a)](_0x1dad52),'ack':!![]});}async function processSensorEvent(_0x1dd26b,_0x3ed9d3,_0x318042,_0x4361b1){const _0x17a6a4=a0_0x3fb50b;if(!_0x4361b1)return;const _0x1bd09e=_0x318042[_0x17a6a4(0x108)],_0x2dcaf9=Date[_0x17a6a4(0xff)]();_0x1dd26b[_0x17a6a4(0xd6)]['debug'](_0x17a6a4(0x109)+_0x3ed9d3+_0x17a6a4(0xd1)+_0x1bd09e);const _0x151c31=_0x1dd26b['sensorLastValues'][_0x3ed9d3];_0x1dd26b[_0x17a6a4(0x165)][_0x3ed9d3]=_0x1bd09e;if(!_0x4361b1[_0x17a6a4(0xe6)]&&_0x151c31!=undefined&&_0x151c31==_0x1bd09e){_0x1dd26b[_0x17a6a4(0xd6)][_0x17a6a4(0x114)](_0x17a6a4(0x19b)+_0x4361b1['name']+_0x17a6a4(0x10d)+_0x1bd09e+')');return;}const _0x48569e=(_0x4361b1[_0x17a6a4(0x1b3)]||'')[_0x17a6a4(0x29e)](),_0x475463=_0x48569e[_0x17a6a4(0x174)](_0x17a6a4(0x190))||_0x48569e[_0x17a6a4(0x174)]('temperatur')||_0x48569e[_0x17a6a4(0x174)](_0x17a6a4(0x122))||_0x48569e[_0x17a6a4(0x174)](_0x17a6a4(0xb8));_0x1dd26b[_0x17a6a4(0x16e)]&&_0x475463&&recordThermodynamics(_0x1dd26b,_0x3ed9d3,_0x1bd09e,_0x4361b1[_0x17a6a4(0x274)]);const _0x10f643={'timestamp':_0x2dcaf9,'id':_0x3ed9d3,'name':_0x4361b1[_0x17a6a4(0x11d)],'type':_0x4361b1['type'],'location':_0x4361b1[_0x17a6a4(0x274)],'value':_0x1bd09e};_0x1dd26b['eventHistory'][_0x17a6a4(0x21c)](_0x10f643);if(_0x1dd26b[_0x17a6a4(0x22e)]['length']>HISTORY_MAX_SIZE)_0x1dd26b[_0x17a6a4(0x22e)][_0x17a6a4(0x101)]();await _0x1dd26b[_0x17a6a4(0x21b)]('events.lastEvent',{'val':JSON[_0x17a6a4(0x21a)](_0x10f643),'ack':!![]}),await _0x1dd26b[_0x17a6a4(0x21b)](_0x17a6a4(0x265),{'val':JSON[_0x17a6a4(0x21a)](_0x1dd26b[_0x17a6a4(0x22e)]),'ack':!![]});_0x1dd26b[_0x17a6a4(0x16e)]&&(_0x1dd26b[_0x17a6a4(0x29a)][_0x17a6a4(0x138)](_0x10f643),await saveRawEventLog(_0x1dd26b),recordSequence(_0x1dd26b,_0x10f643));if(_0x4361b1['isExit']&&_0x1bd09e===!![]){if(_0x1dd26b[_0x17a6a4(0x1b2)]&&!_0x1dd26b[_0x17a6a4(0x1af)])_0x1dd26b['log'][_0x17a6a4(0x24e)](_0x17a6a4(0xb3)+_0x4361b1[_0x17a6a4(0x11d)]+_0x17a6a4(0x189)),startExitTimer(_0x1dd26b);else!_0x1dd26b['isPresent']&&(_0x1dd26b[_0x17a6a4(0xd6)][_0x17a6a4(0x24e)](_0x17a6a4(0x23f)+_0x4361b1[_0x17a6a4(0x11d)]+_0x17a6a4(0x139)),await setPresence(_0x1dd26b,!![]));}else _0x4361b1[_0x17a6a4(0x1b3)]===_0x17a6a4(0xc0)&&_0x1bd09e===!![]&&(_0x1dd26b[_0x17a6a4(0xc4)]&&(_0x1dd26b[_0x17a6a4(0xd6)]['info'](_0x17a6a4(0x248)),abortExitTimer(_0x1dd26b)),!_0x1dd26b[_0x17a6a4(0x1b2)]&&_0x1dd26b['currentSystemMode']===SYSTEM_MODES[_0x17a6a4(0x28c)]&&await setPresence(_0x1dd26b,!![]));}async function runGeminiAnalysis(_0x56fd76,_0x3e1254=''){const _0x1c54c4=a0_0x3fb50b;if(!_0x56fd76[_0x1c54c4(0x166)])return;if(_0x56fd76[_0x1c54c4(0x22e)]['length']===0x0)return;const _0x1fdfbc=_0x56fd76[_0x1c54c4(0x22e)][_0x1c54c4(0x17b)](0x0,0xf),_0x4a9367=await getWeatherContext(_0x56fd76),_0x56402f=_0x56fd76[_0x1c54c4(0xcc)],_0x30bb8e=PERSONA_MAPPING[_0x56fd76[_0x1c54c4(0x249)][_0x1c54c4(0x1ca)]||'generic'],_0x29a1d6=_0x56fd76[_0x1c54c4(0x249)][_0x1c54c4(0xd7)]||_0x1c54c4(0x162);let _0x11401d=![];try{const _0x4753bc=await _0x56fd76[_0x1c54c4(0x221)](_0x1c54c4(0xf6));if(_0x4753bc&&_0x4753bc[_0x1c54c4(0x108)])_0x11401d=!![];}catch(_0x1edc4d){}const _0x22bd49=_0x1c54c4(0x10b)+_0x30bb8e+_0x1c54c4(0x198)+_0x29a1d6+'.\x0a\x20\x20\x20\x20SYSTEM_MODE:\x20'+_0x56402f+_0x1c54c4(0x1bd)+_0x4a9367+_0x1c54c4(0xcf)+(_0x3e1254||_0x1c54c4(0x14b))+_0x1c54c4(0x145)+JSON[_0x1c54c4(0x21a)](_0x1fdfbc)+_0x1c54c4(0x120);try{const _0x504553=await _0x56fd76[_0x1c54c4(0x166)][_0x1c54c4(0x15d)](_0x22bd49),_0x389544=_0x504553['response']['text']()[_0x1c54c4(0x234)](/```json|```/g,'')[_0x1c54c4(0x278)](),_0x5c6599=JSON[_0x1c54c4(0xb5)](_0x389544);await _0x56fd76[_0x1c54c4(0x21b)](_0x1c54c4(0x217),{'val':JSON[_0x1c54c4(0x21a)](_0x5c6599),'ack':!![]});_0x5c6599[_0x1c54c4(0x178)]&&await _0x56fd76[_0x1c54c4(0x21b)](_0x1c54c4(0x257),{'val':_0x5c6599[_0x1c54c4(0x178)],'ack':!![]});const _0x1ae089={'timestamp':Date[_0x1c54c4(0xff)](),'id':Date[_0x1c54c4(0xff)]()['toString'](),'analysis':{'activity':{'summary':_0x5c6599[_0x1c54c4(0x178)]||_0x1c54c4(0x1a3),'isAlert':_0x5c6599[_0x1c54c4(0xd0)]||![],'alertReason':_0x5c6599[_0x1c54c4(0x201)]},'comfort':{'automationProposal':_0x5c6599['automationProposal']}}};await updateAnalysisHistory(_0x56fd76,_0x1ae089);const _0x257117=_0x5c6599[_0x1c54c4(0xd0)]||![];_0x257117!==_0x56fd76[_0x1c54c4(0x1df)]&&(await _0x56fd76['setStateAsync'](_0x1c54c4(0xc1),{'val':_0x257117,'ack':!![]}),_0x56fd76[_0x1c54c4(0x1df)]=_0x257117,_0x257117&&(await _0x56fd76[_0x1c54c4(0x21b)](_0x1c54c4(0x24d),{'val':_0x5c6599[_0x1c54c4(0x201)],'ack':!![]}),sendNotification(_0x56fd76,_0x1c54c4(0x290)+_0x5c6599[_0x1c54c4(0x201)],![],_0x5c6599['isEmergency']))),_0x5c6599[_0x1c54c4(0x212)]&&_0x5c6599[_0x1c54c4(0x212)][_0x1c54c4(0xe9)]&&_0x5c6599['automationProposal']['targetId']&&(_0x56fd76[_0x1c54c4(0xd6)]['info']('ðŸ¤–\x20BUTLER\x20PROPOSAL:\x20'+_0x5c6599['automationProposal'][_0x1c54c4(0x187)]),await _0x56fd76[_0x1c54c4(0x21b)](_0x1c54c4(0x242),{'val':!![],'ack':!![]}),await _0x56fd76[_0x1c54c4(0x21b)](_0x1c54c4(0x163),{'val':_0x5c6599[_0x1c54c4(0x212)][_0x1c54c4(0x187)],'ack':!![]}),await _0x56fd76[_0x1c54c4(0x21b)](_0x1c54c4(0x1fb),{'val':_0x5c6599[_0x1c54c4(0x212)][_0x1c54c4(0xc9)],'ack':!![]}),await _0x56fd76[_0x1c54c4(0x21b)](_0x1c54c4(0x193),{'val':JSON[_0x1c54c4(0x21a)](_0x5c6599[_0x1c54c4(0x212)][_0x1c54c4(0x151)]),'ack':!![]}),_0x11401d&&(_0x56fd76[_0x1c54c4(0xd6)][_0x1c54c4(0x24e)](_0x1c54c4(0x2a2)+_0x5c6599[_0x1c54c4(0x212)][_0x1c54c4(0xc9)]+_0x1c54c4(0xf0)),await executeAutomationAction(_0x56fd76)));}catch(_0x50597d){_0x56fd76[_0x1c54c4(0xd6)]['error'](_0x1c54c4(0x1a1)+_0x50597d[_0x1c54c4(0xdc)]);}}function installPythonDependencies(_0x220c8d){const _0x2a36d3=a0_0x3fb50b;if(_0x220c8d[_0x2a36d3(0x1a9)])return;_0x220c8d[_0x2a36d3(0x1a9)]=!![];const _0x15a38e=path['join'](__dirname,_0x2a36d3(0x20a),_0x2a36d3(0x1d2));_0x220c8d['log'][_0x2a36d3(0x24e)](_0x2a36d3(0x264)+_0x15a38e+_0x2a36d3(0xf0)),stopPythonService(_0x220c8d);const _0x54c410=_0x2a36d3(0x1d5)+_0x15a38e+_0x2a36d3(0x209);exec(_0x54c410,(_0x3ca696,_0x5bd662,_0x84010d)=>{const _0x13cef2=_0x2a36d3,_0x36571d=_0x84010d&&_0x84010d['includes'](_0x13cef2(0xfb))||_0x3ca696&&_0x3ca696['message']['includes'](_0x13cef2(0xfb));if(_0x36571d){_0x220c8d['log'][_0x13cef2(0x295)](_0x13cef2(0x22c)),exec(_0x13cef2(0x1cd),(_0x1eb009,_0x3535d6,_0x20ec9f)=>{const _0x31b7f8=_0x13cef2;_0x1eb009?(_0x220c8d[_0x31b7f8(0xd6)]['error'](_0x31b7f8(0x196)),_0x220c8d[_0x31b7f8(0xd6)][_0x31b7f8(0x235)](_0x31b7f8(0xaf)),_0x220c8d[_0x31b7f8(0x1a9)]=![]):(_0x220c8d[_0x31b7f8(0xd6)]['info'](_0x31b7f8(0x236)),exec('python3\x20-m\x20pip\x20install\x20-r\x20\x22'+_0x15a38e+_0x31b7f8(0xea),(_0x26608f,_0x366836,_0x5bedc0)=>{const _0x55e4b4=_0x31b7f8;_0x26608f?_0x220c8d[_0x55e4b4(0xd6)][_0x55e4b4(0x235)](_0x55e4b4(0x1eb)+_0x26608f[_0x55e4b4(0xdc)]):(_0x220c8d[_0x55e4b4(0xd6)][_0x55e4b4(0x24e)](_0x55e4b4(0x16a)),startPythonService(_0x220c8d)),_0x220c8d[_0x55e4b4(0x1a9)]=![];}));});return;}_0x220c8d[_0x13cef2(0x1a9)]=![],_0x3ca696?(_0x220c8d[_0x13cef2(0xd6)][_0x13cef2(0x235)](_0x13cef2(0x11f)),_0x220c8d['log'][_0x13cef2(0x235)](_0x13cef2(0xb7)+(_0x84010d||_0x3ca696[_0x13cef2(0xdc)]))):(_0x220c8d[_0x13cef2(0xd6)]['info'](_0x13cef2(0x20c)),startPythonService(_0x220c8d));});}function sendToPython(_0x5eadd4,_0xb26909,_0x32a56={}){const _0x9d116a=a0_0x3fb50b;if(!_0x5eadd4['pythonProcess']||!_0x5eadd4[_0x9d116a(0x170)][_0x9d116a(0xd8)][_0x9d116a(0xfe)])return;const _0x5dc107=JSON[_0x9d116a(0x21a)]({'command':_0xb26909,..._0x32a56});try{_0x5eadd4['pythonProcess']['stdin'][_0x9d116a(0x1e9)](_0x5dc107+'\x0a');}catch(_0x9bfbaf){_0x5eadd4[_0x9d116a(0xd6)]['error'](_0x9d116a(0x130)+_0x9bfbaf[_0x9d116a(0xdc)]);}}function runPythonHealthCheck(_0x39f273){const _0x147a38=a0_0x3fb50b;if(!_0x39f273['dailyDigests']||_0x39f273[_0x147a38(0x1b4)][_0x147a38(0x152)]<0x2){_0x39f273['log'][_0x147a38(0x24e)](_0x147a38(0x1cb));return;}const _0x20c49e=_0x39f273[_0x147a38(0x1b4)][_0x147a38(0x191)](_0x281c66=>{const _0x575743=_0x147a38,_0xdf5c21=(_0x281c66[_0x575743(0x19a)]||'')[_0x575743(0x29e)]();return ACTIVITY_LEVEL_MAP[_0xdf5c21]||0x32;});_0x39f273[_0x147a38(0xd6)]['info'](_0x147a38(0x13c)+_0x20c49e[_0x147a38(0x152)]+_0x147a38(0x1c6)),sendToPython(_0x39f273,_0x147a38(0x25d),{'values':_0x20c49e,'tag':_0x147a38(0x253)});}function handlePythonResult(_0x2a0731,_0xf601db){const _0x2b552d=a0_0x3fb50b;if(_0xf601db[_0x2b552d(0x1b3)]===_0x2b552d(0x282))_0x2a0731['log']['debug']('ðŸ\x20Python\x20Pong\x20received!\x20Latency\x20check\x20passed.');else{if(_0xf601db[_0x2b552d(0x1b3)]===_0x2b552d(0x1d6)){const {tag:_0x31547e,diagnosis:_0x40c117,change_percent:_0x56c6f7}=_0xf601db[_0x2b552d(0x1ad)];_0x2a0731['log'][_0x2b552d(0x24e)](_0x2b552d(0x1d0)+_0x31547e+'):\x20'+_0x40c117+'\x20('+_0x56c6f7+'%)'),_0x2a0731['setStateAsync'](_0x2b552d(0x1ed),{'val':_0x40c117,'ack':!![]}),_0x2a0731[_0x2b552d(0x21b)](_0x2b552d(0x1d1),{'val':_0x56c6f7,'ack':!![]});}}}function startPythonService(_0x2b6fbc){const _0x32000d=a0_0x3fb50b;try{const _0x587520=path[_0x32000d(0xc3)](__dirname,_0x32000d(0x20a),_0x32000d(0x115));_0x2b6fbc[_0x32000d(0xd6)][_0x32000d(0x24e)]('ðŸ\x20Starting\x20Python\x20Sidecar:\x20'+_0x587520),_0x2b6fbc[_0x32000d(0x170)]=spawn(_0x32000d(0x175),[_0x587520]),_0x2b6fbc[_0x32000d(0x170)][_0x32000d(0x20b)]['on'](_0x32000d(0x2a3),_0x48dbd2=>{const _0x5a4a54=_0x32000d,_0x312d82=_0x48dbd2[_0x5a4a54(0x1dc)]()[_0x5a4a54(0x100)]('\x0a');_0x312d82[_0x5a4a54(0x220)](_0x4fedcd=>{const _0x468fde=_0x5a4a54,_0x495862=_0x4fedcd[_0x468fde(0x278)]();if(!_0x495862)return;if(_0x495862[_0x468fde(0xbc)]('[LOG]'))_0x2b6fbc['log']['debug'](_0x468fde(0xf3)+_0x495862[_0x468fde(0xbe)](0x5)[_0x468fde(0x278)]());else{if(_0x495862[_0x468fde(0xbc)](_0x468fde(0x1b5)))try{const _0x51dc1b=JSON['parse'](_0x495862[_0x468fde(0xbe)](0x8)[_0x468fde(0x278)]());handlePythonResult(_0x2b6fbc,_0x51dc1b);}catch(_0x1065a4){_0x2b6fbc[_0x468fde(0xd6)]['warn'](_0x468fde(0x26d)+_0x495862);}}(_0x495862[_0x468fde(0x174)](_0x468fde(0x260))||_0x495862[_0x468fde(0x174)](_0x468fde(0x1f2))||_0x495862[_0x468fde(0x174)](_0x468fde(0x272)))&&(_0x2b6fbc[_0x468fde(0xd6)][_0x468fde(0x295)](_0x468fde(0x25a)),installPythonDependencies(_0x2b6fbc));});}),_0x2b6fbc[_0x32000d(0x170)][_0x32000d(0x150)]['on'](_0x32000d(0x2a3),_0x37298d=>{const _0x15bc3f=_0x32000d,_0x364be3=_0x37298d[_0x15bc3f(0x1dc)]()[_0x15bc3f(0x278)]();_0x2b6fbc[_0x15bc3f(0xd6)][_0x15bc3f(0x235)](_0x15bc3f(0x26f)+_0x364be3);}),_0x2b6fbc['pythonProcess']['on'](_0x32000d(0x1c9),_0x1c7941=>{const _0x1d64cf=_0x32000d;_0x2b6fbc[_0x1d64cf(0xd6)][_0x1d64cf(0x24e)](_0x1d64cf(0x202)+_0x1c7941),_0x2b6fbc[_0x1d64cf(0x170)]=null;}),_0x2b6fbc['pythonProcess']['on']('error',_0x27ce42=>{const _0x4aa68a=_0x32000d;_0x2b6fbc[_0x4aa68a(0xd6)][_0x4aa68a(0x295)]('[PYTHON]\x20Failed\x20to\x20start\x20(is\x20python3\x20installed?):\x20'+_0x27ce42['message']);});}catch(_0x1559c4){_0x2b6fbc[_0x32000d(0xd6)]['error'](_0x32000d(0x288)+_0x1559c4[_0x32000d(0xdc)]);}}function stopPythonService(_0x58fda8){const _0x10a08b=a0_0x3fb50b;if(_0x58fda8['pythonProcess']){_0x58fda8[_0x10a08b(0xd6)][_0x10a08b(0x24e)](_0x10a08b(0x172));try{_0x58fda8['pythonProcess'][_0x10a08b(0xed)]();}catch(_0x32ddb2){_0x58fda8['log'][_0x10a08b(0x295)](_0x10a08b(0x1e4)+_0x32ddb2[_0x10a08b(0xdc)]);}_0x58fda8['pythonProcess']=null;}}class CogniLiving extends utils[a0_0x3fb50b(0x1c5)]{constructor(_0x486318){const _0x596709=a0_0x3fb50b;super({..._0x486318,'name':_0x596709(0x24a)}),this[_0x596709(0x22e)]=[],this[_0x596709(0x251)]=[],this['feedbackHistory']=[],this[_0x596709(0x29a)]=[],this[_0x596709(0x1b4)]=[],this[_0x596709(0x165)]={},this[_0x596709(0x110)]={'latitude':0x0,'longitude':0x0,'city':''},this[_0x596709(0x1b2)]=!![],this[_0x596709(0xc4)]=null,this[_0x596709(0xee)]=null,this[_0x596709(0x1af)]=![],this[_0x596709(0x261)]=null,this[_0x596709(0x166)]=null,this[_0x596709(0xcc)]=SYSTEM_MODES['NORMAL'],this[_0x596709(0x16e)]=![],this[_0x596709(0x1df)]=![],this['systemUUID']=_0x596709(0x28a),this[_0x596709(0xe0)]=null,this[_0x596709(0xf5)]=null,this[_0x596709(0x200)]=null,this['driftAnalysisTimer']=null,this[_0x596709(0x22a)]=null,this[_0x596709(0x170)]=null,this[_0x596709(0x1a9)]=![],this['on'](_0x596709(0x22d),this['onReady']['bind'](this)),this['on'](_0x596709(0x18d),this[_0x596709(0x10a)][_0x596709(0x1a6)](this)),this['on']('unload',this[_0x596709(0x195)][_0x596709(0x1a6)](this)),this['on']('message',this[_0x596709(0x230)]['bind'](this));}async[a0_0x3fb50b(0x119)](){const _0x83599=a0_0x3fb50b;this[_0x83599(0xd6)][_0x83599(0x24e)](_0x83599(0x18e)+this[_0x83599(0x1a0)]+')\x20-\x20FUNCTIONS\x20FIRST\x20ARCHITECTURE'),await initZombies(this),this[_0x83599(0x249)]['licenseKey']=this['config']['licenseKey']||'';try{this[_0x83599(0x16e)]=await checkLicense(this,this[_0x83599(0x249)]['licenseKey']);}catch(_0x26c8c3){}if(!this[_0x83599(0x249)][_0x83599(0xeb)]||this[_0x83599(0x249)][_0x83599(0xeb)]<0.1)this[_0x83599(0x249)][_0x83599(0xeb)]=0xc;await initHistory(this),await initSystemConfig(this);if(this['config']['geminiApiKey'])try{this[_0x83599(0x261)]=new GoogleGenerativeAI(this[_0x83599(0x249)][_0x83599(0x124)]),this[_0x83599(0x166)]=this['genAI']['getGenerativeModel']({'model':GEMINI_MODEL,'generationConfig':{'responseMimeType':_0x83599(0x16c)}}),this[_0x83599(0xd6)][_0x83599(0x24e)](_0x83599(0x222));}catch(_0x5c2373){this[_0x83599(0xd6)][_0x83599(0x235)]('Gemini\x20Init\x20Error:\x20'+_0x5c2373[_0x83599(0xdc)]);}await createAllObjects(this),await loadSystemMode(this),await loadRawEventLog(this),await loadDailyDigests(this),this[_0x83599(0x106)](_0x83599(0x25e)),this[_0x83599(0x106)](LTM_DP_TRIGGER_DIGEST),this[_0x83599(0x106)](_0x83599(0x2a0)),this[_0x83599(0x106)](_0x83599(0x224)),this[_0x83599(0x106)](_0x83599(0x1ce)),this[_0x83599(0x106)]('analysis.automation.autoApply'),await initSensorSubscriptions(this),await initPresenceSubscriptions(this),await setupTelegramListener(this),setTimeout(()=>checkWifiPresence(this),0x1388);if(this[_0x83599(0xe0)])clearInterval(this[_0x83599(0xe0)]);const _0x1328a7=this[_0x83599(0x249)][_0x83599(0x199)]||0xf;_0x1328a7>0x0&&(this[_0x83599(0xd6)][_0x83599(0x24e)](_0x83599(0x246)+_0x1328a7+_0x83599(0x137)),this[_0x83599(0xe0)]=setInterval(()=>{runAutopilot(this);},_0x1328a7*0x3c*0x3e8)),setupLtmScheduler(this),setupModeResetScheduler(this),setupDriftAnalysisScheduler(this),setupBriefingScheduler(this),startPythonService(this),setTimeout(()=>{const _0x32ac00=_0x83599;this[_0x32ac00(0x170)]&&runPythonHealthCheck(this);},0x1388);}[a0_0x3fb50b(0x195)](_0x4c6fab){const _0x34e787=a0_0x3fb50b;if(this[_0x34e787(0xe0)])clearInterval(this[_0x34e787(0xe0)]);if(this[_0x34e787(0x1c2)])clearInterval(this[_0x34e787(0x1c2)]);if(this[_0x34e787(0xf5)])this[_0x34e787(0xf5)][_0x34e787(0xe3)]();if(this['modeResetJob'])this['modeResetJob'][_0x34e787(0xe3)]();if(this[_0x34e787(0x22a)])this['briefingJob'][_0x34e787(0xe3)]();if(this[_0x34e787(0xc4)])clearTimeout(this[_0x34e787(0xc4)]);if(this[_0x34e787(0xee)])clearTimeout(this[_0x34e787(0xee)]);stopPythonService(this),_0x4c6fab();}async[a0_0x3fb50b(0x10a)](_0x393203,_0x2c2133){const _0x330091=a0_0x3fb50b;if(!_0x2c2133)return;if(_0x393203[_0x330091(0x174)]('telegram')&&_0x393203['endsWith']('communicate.request')&&_0x2c2133[_0x330091(0x108)]){await handleTelegramResponse(this,_0x2c2133[_0x330091(0x108)]);return;}if(_0x393203===this['namespace']+'.'+SYSTEM_DP_MODE){_0x2c2133['val']&&Object[_0x330091(0x180)](SYSTEM_MODES)[_0x330091(0x174)](_0x2c2133[_0x330091(0x108)])&&(this['currentSystemMode']=_0x2c2133[_0x330091(0x108)],_0x2c2133[_0x330091(0x108)]===SYSTEM_MODES[_0x330091(0x14a)]?await setPresence(this,![]):await setPresence(this,!![]));if(!_0x2c2133[_0x330091(0x28e)])this[_0x330091(0x155)](_0x393203,{'val':this[_0x330091(0xcc)],'ack':!![]});return;}if(!_0x2c2133['ack']){_0x393203['includes'](_0x330091(0x25e))&&_0x2c2133[_0x330091(0x108)]&&(this[_0x330091(0x155)](_0x393203,{'val':![],'ack':!![]}),runGeminiAnalysis(this));if(_0x393203[_0x330091(0x174)](_0x330091(0xc6))&&_0x2c2133[_0x330091(0x108)]){this[_0x330091(0x155)](_0x393203,{'val':![],'ack':!![]});if(this[_0x330091(0x16e)])createDailyDigest(this);}_0x393203[_0x330091(0x174)](_0x330091(0x121))&&_0x2c2133[_0x330091(0x108)]&&(this[_0x330091(0x155)](_0x393203,{'val':![],'ack':!![]}),sendMorningBriefing(this));_0x393203[_0x330091(0x174)](_0x330091(0x28b))&&_0x2c2133['val']&&(this['setState'](_0x393203,{'val':![],'ack':!![]}),executeAutomationAction(this));return;}if(this['config'][_0x330091(0x1b1)]&&this['config'][_0x330091(0x1b1)][_0x330091(0x174)](_0x393203)){await checkWifiPresence(this);return;}const _0x37dd9e=(this[_0x330091(0x249)][_0x330091(0x107)]||[])['find'](_0xd6986b=>_0xd6986b['id']===_0x393203);if(_0x37dd9e)processSensorEvent(this,_0x393203,_0x2c2133,_0x37dd9e);}async[a0_0x3fb50b(0x230)](_0x4e9417){const _0x394c06=a0_0x3fb50b;if(typeof _0x4e9417==='object'&&_0x4e9417[_0x394c06(0xdc)])try{if(_0x4e9417[_0x394c06(0xec)]===_0x394c06(0x185)){const _0x3879e9=_0x4e9417[_0x394c06(0xdc)][_0x394c06(0x153)]||this['config'][_0x394c06(0x124)];if(!_0x3879e9)return this[_0x394c06(0x29b)](_0x4e9417[_0x394c06(0xd2)],_0x4e9417[_0x394c06(0xec)],{'success':![],'message':_0x394c06(0x24f)},_0x4e9417[_0x394c06(0x1fd)]);try{const _0x26bb4d=new GoogleGenerativeAI(_0x3879e9),_0x3e30eb=_0x26bb4d[_0x394c06(0x1d8)]({'model':GEMINI_MODEL}),_0x102eb0=await _0x3e30eb[_0x394c06(0x15d)]('Say\x20Hello'),_0x5771d6=await _0x102eb0[_0x394c06(0x273)],_0x4f5842=_0x5771d6['text']();this[_0x394c06(0x29b)](_0x4e9417[_0x394c06(0xd2)],_0x4e9417[_0x394c06(0xec)],{'success':!![],'message':_0x394c06(0x123)+_0x4f5842[_0x394c06(0xbe)](0x0,0x14)+_0x394c06(0xf0)},_0x4e9417[_0x394c06(0x1fd)]);}catch(_0x540659){this[_0x394c06(0x29b)](_0x4e9417[_0x394c06(0xd2)],_0x4e9417[_0x394c06(0xec)],{'success':![],'message':_0x394c06(0x277)+_0x540659[_0x394c06(0xdc)]},_0x4e9417[_0x394c06(0x1fd)]);}}else{if(_0x4e9417[_0x394c06(0xec)]==='testContext'){const _0x486e8b=await getWeatherContext(this),_0x348e98=await getCalendarContext(this);this[_0x394c06(0x29b)](_0x4e9417[_0x394c06(0xd2)],_0x4e9417['command'],{'success':!![],'weather':_0x486e8b,'calendar':_0x348e98},_0x4e9417[_0x394c06(0x1fd)]);}else{if(_0x4e9417[_0x394c06(0xec)]==='testNotification'){}else{if(_0x4e9417[_0x394c06(0xec)]===_0x394c06(0x116)){if(!this[_0x394c06(0x16e)])return this[_0x394c06(0x29b)](_0x4e9417[_0x394c06(0xd2)],_0x4e9417['command'],{'success':![],'isPro':![]},_0x4e9417['callback']);let _0x274256={'status':_0x394c06(0x1e8),'details':'','lastCheck':0x0};try{_0x274256[_0x394c06(0x194)]=(await this[_0x394c06(0x221)](LTM_DP_DRIFT_STATUS))['val'],_0x274256[_0x394c06(0x227)]=(await this[_0x394c06(0x221)](LTM_DP_DRIFT_DETAILS))[_0x394c06(0x108)],_0x274256[_0x394c06(0xb4)]=(await this[_0x394c06(0x221)](LTM_DP_DRIFT_LAST_CHECK))['val'];}catch(_0x54280a){}const _0x32227a=this[_0x394c06(0x251)]||[];this[_0x394c06(0x29b)](_0x4e9417[_0x394c06(0xd2)],_0x4e9417[_0x394c06(0xec)],{'success':!![],'isPro':!![],'dailyDigests':this[_0x394c06(0x1b4)],'driftAnalysis':_0x274256,'analysisHistory':_0x32227a},_0x4e9417[_0x394c06(0x1fd)]);}else{if(_0x4e9417[_0x394c06(0xec)]===_0x394c06(0x146)){const _0x1c619f=this['dailyDigests']['length'],_0x3064f2=new Date(),_0x45e847=new Date(_0x3064f2[_0x394c06(0x21f)](),_0x3064f2['getMonth'](),_0x3064f2[_0x394c06(0xb0)]())[_0x394c06(0x142)](),_0x17fa79=this[_0x394c06(0x29a)][_0x394c06(0x1e0)](_0x158bce=>new Date(_0x158bce[_0x394c06(0x12f)])[_0x394c06(0x142)]()>_0x45e847)[_0x394c06(0x152)],_0x2353ea=new Array(0x18)['fill'](0x0);this[_0x394c06(0x29a)][_0x394c06(0x220)](_0x3a0fd8=>{const _0x5260fc=_0x394c06,_0x498cd6=new Date(_0x3a0fd8[_0x5260fc(0x12f)]);if(_0x498cd6[_0x5260fc(0x142)]()>_0x45e847)_0x2353ea[_0x498cd6[_0x5260fc(0x148)]()]++;});let _0x19d3ce={'status':_0x394c06(0x1e8)};try{_0x19d3ce[_0x394c06(0x194)]=(await this[_0x394c06(0x221)](LTM_DP_DRIFT_STATUS))['val'];}catch(_0x58309b){}let _0x100b21='';try{const _0x3bed29=await this[_0x394c06(0x221)]('system.presenceWho');_0x100b21=_0x3bed29?_0x3bed29[_0x394c06(0x108)]:'';}catch(_0x2f33a0){}let _0x1f81f5=null;!this['geminiModel']&&(_0x1f81f5=this[_0x394c06(0x249)][_0x394c06(0x124)]?_0x394c06(0x226):_0x394c06(0x268));let _0x36cced={'detected':![],'description':'','targetId':'','targetValue':'','autoApply':![]};try{const _0x42315a=await this[_0x394c06(0x221)](_0x394c06(0x242)),_0x552fc5=await this[_0x394c06(0x221)](_0x394c06(0x163)),_0x3d73ee=await this[_0x394c06(0x221)]('analysis.automation.targetId'),_0xcf8f67=await this[_0x394c06(0x221)](_0x394c06(0x193)),_0x4f252b=await this[_0x394c06(0x221)]('analysis.automation.autoApply');_0x42315a&&_0x42315a[_0x394c06(0x108)]&&(_0x36cced[_0x394c06(0xe9)]=!![],_0x36cced[_0x394c06(0x187)]=_0x552fc5?_0x552fc5[_0x394c06(0x108)]:'',_0x36cced[_0x394c06(0xc9)]=_0x3d73ee?_0x3d73ee[_0x394c06(0x108)]:'',_0x36cced[_0x394c06(0x151)]=_0xcf8f67?_0xcf8f67[_0x394c06(0x108)]:''),_0x36cced[_0x394c06(0x19f)]=_0x4f252b?!!_0x4f252b['val']:![];}catch(_0x249000){}this[_0x394c06(0x29b)](_0x4e9417[_0x394c06(0xd2)],_0x4e9417[_0x394c06(0xec)],{'success':!![],'eventHistory':this[_0x394c06(0x22e)]['slice'](0x0,0xf),'stats':{'digestCount':_0x1c619f,'eventCountToday':_0x17fa79,'hourlyActivity':_0x2353ea,'driftStatus':_0x19d3ce[_0x394c06(0x194)],'isPresent':this[_0x394c06(0x1b2)],'presenceWho':_0x100b21,'minDays':this[_0x394c06(0x249)][_0x394c06(0xc7)]||0x7,'stbDays':this[_0x394c06(0x249)][_0x394c06(0x1f6)]||0xe,'ltbDays':this['config'][_0x394c06(0x210)]||0x3c,'systemError':_0x1f81f5},'automation':_0x36cced},_0x4e9417[_0x394c06(0x1fd)]);}else{if(_0x4e9417['command']===_0x394c06(0x214)){const _0x509ede=await this[_0x394c06(0x1be)](_0x394c06(0x188),'enum'),_0x55703a=[];if(_0x509ede)for(const _0x58db99 in _0x509ede){const _0x484ed9=_0x509ede[_0x58db99],_0x121f85=(_0x484ed9[_0x394c06(0x13f)]&&typeof _0x484ed9[_0x394c06(0x13f)][_0x394c06(0x11d)]===_0x394c06(0x1b7)?_0x484ed9[_0x394c06(0x13f)][_0x394c06(0x11d)]['de']:_0x484ed9[_0x394c06(0x13f)][_0x394c06(0x11d)])||_0x484ed9[_0x394c06(0x13f)]['name'];_0x55703a['push']({'id':_0x58db99,'name':_0x121f85});}this[_0x394c06(0x29b)](_0x4e9417[_0x394c06(0xd2)],_0x4e9417[_0x394c06(0xec)],{'success':!![],'enums':_0x55703a},_0x4e9417[_0x394c06(0x1fd)]);}else{if(_0x4e9417[_0x394c06(0xec)]===_0x394c06(0x294))try{const _0x42e90a=await scanForDevices(this,_0x4e9417[_0x394c06(0xdc)]||{});this['sendTo'](_0x4e9417['from'],_0x4e9417[_0x394c06(0xec)],{'success':!![],'devices':_0x42e90a},_0x4e9417['callback']);}catch(_0x50080b){this[_0x394c06(0x29b)](_0x4e9417[_0x394c06(0xd2)],_0x4e9417[_0x394c06(0xec)],{'success':![],'error':_0x50080b[_0x394c06(0xdc)]},_0x4e9417['callback']);}else{if(_0x4e9417[_0x394c06(0xec)]==='getCalendarNames'){const _0x41208c=_0x4e9417[_0x394c06(0xdc)][_0x394c06(0x211)];if(!_0x41208c)return this['sendTo'](_0x4e9417[_0x394c06(0xd2)],_0x4e9417[_0x394c06(0xec)],{'success':![],'error':_0x394c06(0x259)},_0x4e9417[_0x394c06(0x1fd)]);const _0xbd46ff=await getCalendarNames(this,_0x41208c);this[_0x394c06(0x29b)](_0x4e9417[_0x394c06(0xd2)],_0x4e9417[_0x394c06(0xec)],{'success':!![],'names':_0xbd46ff},_0x4e9417['callback']);}else{if(_0x4e9417[_0x394c06(0xec)]==='simulateButler'){const {targetId:_0x1a4ac2,targetValue:_0x48aad6}=_0x4e9417['message'];this[_0x394c06(0xd6)][_0x394c06(0x24e)](_0x394c06(0x20d)+_0x1a4ac2+_0x394c06(0xd1)+_0x48aad6),await this[_0x394c06(0x21b)](_0x394c06(0x242),{'val':!![],'ack':!![]}),await this[_0x394c06(0x21b)]('analysis.automation.description',{'val':_0x394c06(0x19e)+_0x1a4ac2,'ack':!![]}),await this[_0x394c06(0x21b)]('analysis.automation.targetId',{'val':_0x1a4ac2,'ack':!![]}),await this[_0x394c06(0x21b)](_0x394c06(0x193),{'val':_0x48aad6,'ack':!![]}),this['sendTo'](_0x4e9417[_0x394c06(0xd2)],_0x4e9417[_0x394c06(0xec)],{'success':!![]},_0x4e9417[_0x394c06(0x1fd)]);}else{if(_0x4e9417['command']==='submitFeedback'){const {historyId:_0x2388ce,rating:_0x5ae021,comment:_0x590556,alertReason:_0x1fdc09}=_0x4e9417[_0x394c06(0xdc)];_0x2388ce&&_0x5ae021?(await saveFeedback(this,{'timestamp':Date[_0x394c06(0xff)](),'historyId':_0x2388ce,'rating':_0x5ae021,'comment':_0x590556,'alertReason':_0x1fdc09}),this[_0x394c06(0x29b)](_0x4e9417[_0x394c06(0xd2)],_0x4e9417['command'],{'success':!![]},_0x4e9417['callback'])):this[_0x394c06(0x29b)](_0x4e9417[_0x394c06(0xd2)],_0x4e9417[_0x394c06(0xec)],{'success':![],'error':_0x394c06(0x231)},_0x4e9417['callback']);}else _0x4e9417[_0x394c06(0xec)]===_0x394c06(0xdd)&&(this[_0x394c06(0xd6)][_0x394c06(0x24e)]('User\x20dismissed\x20automation\x20proposal.'),await this[_0x394c06(0x21b)](_0x394c06(0x242),{'val':![],'ack':!![]}),await this['setStateAsync']('analysis.automation.description',{'val':'','ack':!![]}),this[_0x394c06(0x29b)](_0x4e9417[_0x394c06(0xd2)],_0x4e9417[_0x394c06(0xec)],{'success':!![]},_0x4e9417[_0x394c06(0x1fd)]));}}}}}}}}}}catch(_0x18ae71){this[_0x394c06(0xd6)]['error']('Error\x20in\x20onMessage\x20command\x20'+_0x4e9417['command']+':\x20'+_0x18ae71[_0x394c06(0xdc)]);if(_0x4e9417['callback'])this[_0x394c06(0x29b)](_0x4e9417[_0x394c06(0xd2)],_0x4e9417[_0x394c06(0xec)],{'success':![],'error':_0x18ae71[_0x394c06(0xdc)]},_0x4e9417[_0x394c06(0x1fd)]);}}}if(require[a0_0x3fb50b(0x215)]!==module)module['exports']=_0x3d6d25=>new CogniLiving(_0x3d6d25);else new CogniLiving();