const a0_0x52b75d=a0_0x4b09;(function(_0xb4cfd6,_0x2a16ba){const _0x453ceb=a0_0x4b09,_0x41de40=_0xb4cfd6();while(!![]){try{const _0x4db0a7=-parseInt(_0x453ceb(0x12f))/0x1+parseInt(_0x453ceb(0x1bc))/0x2+-parseInt(_0x453ceb(0x1f3))/0x3*(parseInt(_0x453ceb(0x165))/0x4)+parseInt(_0x453ceb(0x20f))/0x5*(parseInt(_0x453ceb(0x125))/0x6)+-parseInt(_0x453ceb(0x1d1))/0x7*(parseInt(_0x453ceb(0x1c4))/0x8)+parseInt(_0x453ceb(0x1fe))/0x9+parseInt(_0x453ceb(0x16f))/0xa*(-parseInt(_0x453ceb(0x1a3))/0xb);if(_0x4db0a7===_0x2a16ba)break;else _0x41de40['push'](_0x41de40['shift']());}catch(_0x38cf2e){_0x41de40['push'](_0x41de40['shift']());}}}(a0_0x2174,0x68a85));const a0_0x5bc0de=(function(){let _0x3cd168=!![];return function(_0x271ce7,_0x4ddf34){const _0x5b6ed1=_0x3cd168?function(){const _0x5c2ada=a0_0x4b09;if(_0x4ddf34){const _0x3f60a2=_0x4ddf34[_0x5c2ada(0x21a)](_0x271ce7,arguments);return _0x4ddf34=null,_0x3f60a2;}}:function(){};return _0x3cd168=![],_0x5b6ed1;};}()),a0_0x59c3eb=a0_0x5bc0de(this,function(){const _0x15dc1c=a0_0x4b09;return a0_0x59c3eb['toString']()['search'](_0x15dc1c(0x1c7))[_0x15dc1c(0x24d)]()['constructor'](a0_0x59c3eb)[_0x15dc1c(0x157)](_0x15dc1c(0x1c7));});a0_0x59c3eb();'use strict';const utils=require(a0_0x52b75d(0x254)),{GoogleGenerativeAI}=require('@google/generative-ai'),schedule=require(a0_0x52b75d(0x133)),HISTORY_MAX_SIZE=0x32,RAW_LOG_MAX_SIZE=0x5dc,LTM_MIN_EVENTS_FOR_COMPRESSION=0x5,GEMINI_MODEL=a0_0x52b75d(0x159),LTM_SCHEDULE='0\x203\x20*\x20*\x20*',MODE_RESET_SCHEDULE=a0_0x52b75d(0x124),ANALYSIS_HISTORY_MAX_SIZE=0x64,LTM_DP_RAW_LOG=a0_0x52b75d(0x22a),LTM_DP_DAILY_DIGESTS='LTM.dailyDigests',LTM_DP_STATUS=a0_0x52b75d(0x1f4),LTM_DP_TRIGGER_DIGEST=a0_0x52b75d(0x1bd),LTM_DP_BASELINE_STATUS=a0_0x52b75d(0xec),LTM_DP_DRIFT_CHANNEL=a0_0x52b75d(0x237),LTM_DP_DRIFT_STATUS=a0_0x52b75d(0x178),LTM_DP_DRIFT_DETAILS=a0_0x52b75d(0x169),LTM_DP_DRIFT_LAST_CHECK='LTM.driftAnalysis.lastCheck',SYSTEM_DP_MODE=a0_0x52b75d(0x249),SYSTEM_MODES={'NORMAL':a0_0x52b75d(0x10b),'VACATION':a0_0x52b75d(0x211),'PARTY':a0_0x52b75d(0x10f),'GUEST':a0_0x52b75d(0x127)},AUTO_RESET_MODES=[SYSTEM_MODES[a0_0x52b75d(0x155)],SYSTEM_MODES[a0_0x52b75d(0x1bf)]],EXIT_TIMER_MINUTES=0xf,EXIT_GRACE_PERIOD_SECONDS=0x1e,PERSONA_MAPPING={'generic':a0_0x52b75d(0x1de),'senior_aal':a0_0x52b75d(0x201),'family':a0_0x52b75d(0x244),'single_comfort':a0_0x52b75d(0x152),'security':a0_0x52b75d(0x241)};function a0_0x2174(){const _0x16138a=['splice','json','Event\x20History','isArray','Adapter','üåÖ\x20Daily\x20Briefing:\x0a','cancel','08:00','baselineDrift','Drift\x20Analysis','Health\x20Notes','calendarInstance','AI\x20Emergency\x20Status','apiKey','.\x20PERSONA:\x20','KALENDER:\x20Keine\x20Kalender\x20ausgew√§hlt\x20(Bitte\x20in\x20Settings\x20konfigurieren)','\x20(EMERGENCY)','\x20Tage)','99147FBPhpu','LTM.processingStatus','Activity\x20Summary','triggerDailyDigest','\x0a\x20\x20\x20\x20EVENTS:\x20','LTM\x20Sched\x20Error:\x20','events.lastEvent','onReady','uuid-error','boolean','Trigger\x20Analysis','5170878scKHBb','N/A\x20(Learning)','extendObjectAsync','PRIORIT√ÑT:\x20Gesundheit\x20und\x20Sicherheit\x20f√ºr\x20Senioren\x20(AAL).\x20Erkenne\x20Inaktivit√§t,\x20potenzielle\x20St√ºrze\x20(indirekt),\x20Schlafunterbrechungen\x20und\x20n√§chtliche\x20Unruhe.','indicator','\x20*\x20*\x20*','analysis.health.notes','date','Gemini\x20Init\x20Error:\x20','inactivityMonitoringEnabled','\x0a!!!\x20EXTERNAL\x20SYSTEM\x20WARNING\x20!!!\x0a','notifyTelegramInstance','üö®üö®\x20NOTFALL','Subscribing\x20to\x20','notifyWhatsappRecipient','submitFeedback','lastAlertState','65Hthttl','city','vacation','de-DE','notes','Last\x20Check','info','getCalendarNames','licenseKey','\x0a\x20\x20\x20\x20OUTPUT\x20SCHEMA:\x20{\x20\x22summary\x22:\x20\x22string\x22,\x20\x22activityLevel\x22:\x20\x22string\x22,\x20\x22health\x22:\x20{\x20\x22sleepScore\x22:\x20number,\x20\x22restlessness\x22:\x20\x22string\x22\x20}\x20}','PRO-','apply','Urlaub','restlessness','trim','catch','[TEST]\x20','calendarSelection','Normal','retry','Gemini\x20AI\x20initialized.','string','split','delObjectAsync','Baseline\x20Status','scheduleJob','triggerBriefing','LTM.rawEventLog','ltmDriftCheckIntervalHours','\x20|\x20','geminiApiKey','alertReason','aiPersona','find','‚ö†Ô∏è\x20Alarm','events.history_debug_03','exitGraceTimer','ROLLE:\x20Data\x20Analyst.\x20AUFGABE:\x20Fasse\x20den\x20heutigen\x20Tag\x20basierend\x20auf\x20den\x20Sensor-Logs\x20zusammen.\x0a\x20\x20\x20\x20PERSONA:\x20','onMessage','generic','LTM.driftAnalysis','presenceDevices','timestamp','message','ROLLE:\x20Smart\x20Home\x20Analyst.\x20SPRACHE:\x20DE.\x20FORMAT:\x20JSON.\x20\x0a\x20\x20\x20\x20AKTUELLE\x20ZEIT:\x20','Success','Logbook','sendToAsync','.\x20PR√ÑSENZ:\x20','TEST-PRO-KEY','PRIORIT√ÑT:\x20Sicherheit.\x20Erkenne\x20Eindringlinge,\x20ungew√∂hnliche\x20Anwesenheit.','testContext','isProVersion','Fokus\x20auf\x20Familienroutinen,\x20Kindersicherheit\x20und\x20allgemeines\x20Haushaltsmanagement.','analysisInterval','analysis.analysisHistory','.\x20ORT:\x20','notifySignalEnabled','system.mode','state','NORMAL','uuid-not-found','toString','number','systemUUID','native','\x20hours.\x20The\x20resident\x20might\x20be\x20incapacitated.\x20Risk\x20level:\x20HIGH.','stringify','.data.table','@iobroker/adapter-core','analysis.history_debug_01','analysis.automation.description','Last\x20Result','ltmLtbWindowDays','expire','Raw\x20Log','notifyEmailInstance','\x22\x20was\x20','ltmStbWindowDays','LTM.baselineStatus','isGracePeriodActive','none','notifyTelegramRecipient','isAlert','Daily\x20Digest\x20created\x20successfully.','dailyDigests','setState','Gast','isPresent','suggestedAction','KALENDER:\x20Keine\x20relevanten\x20Termine','automationProposal','events.history_debug_04','analysis.history_debug_04','toLocaleString','text.alarm','parse','send','length','.Summary.Current','callback','join','N/A\x20(No\x20Activity)','\x20sensors...','.\x0a\x20\x20\x20\x20EXTERNER\x20KONTEXT\x20(WICHTIG):\x20','events.history','response','Fehler:\x20','Briefing\x20Sched\x20Error:\x20','setStateAsync','normal','Wetter:\x20Deaktiviert','Morning\x20Briefing\x20sent.','N/A','party','analysis.triggerBriefing','\x0a\x20\x20\x20\x20KONTEXT\x20(Wer\x20wohnt\x20hier?):\x20','inactivityThresholdHours','analysis.comfortSuggestion','Last\x20raw\x20event','WETTER:\x20Keine\x20Daten','getForeignObjectsAsync','modeResetJob','systemConfig','Comfort\x20Suggestion','notifyTelegramEnabled','getGenerativeModel','lastCheck','Creating\x20Daily\x20Digest\x20from\x20','ical.0','Error\x20reading\x20calendar\x20table:\x20','common','ready','toISOString','analysis.feedbackHistory','0\x204\x20*\x20*\x20*','380670TwiLNW','No\x20recent\x20activity.','guest','bind','health','2-digit','text','testNotification','value.health','onUnload','181944ucMjTp','events.history_debug_02','analysis.history_debug_00','toFixed','node-schedule','\x0aFEEDBACK:\x0a','indicator.alarm.fire','devices','getCalendarNames\x20Error:\x20','Aktiv\x20(','log','notifyWhatsappInstance','Processing\x20Status','.\x20\x0a\x20\x20\x20\x20KONTEXT\x20(Wohnen):\x20','Generating\x20Morning\x20Briefing...','exitTimer','getForeignStateAsync','analysisTimer','License\x20Check\x20failed:\x20','\x20\x0a\x20\x20\x20\x20AUFGABE:\x20Analysiere\x20die\x20Events\x20auf\x20Aktivit√§t,\x20Komfort\x20und\x20GESUNDHEIT.\x20\x0a\x20\x20\x20\x20Nutze\x20den\x20EXTERNEN\x20KONTEXT\x20(Wetter/Kalender)\x20um\x20Fehlalarme\x20zu\x20vermeiden\x20(z.B.\x20Regen\x20=\x20keine\x20Gartenaktivit√§t,\x20Termin\x20=\x20Abwesend).\x0a\x20\x20\x20\x20SCHEMA:\x20{\x20\x0a\x20\x20\x20\x20\x20\x20\x22activity\x22:\x20{\x20\x22summary\x22:\x20\x22string\x22,\x20\x22deviationFromBaseline\x22:\x20\x22string\x22,\x20\x22isAlert\x22:\x20bool,\x20\x22isEmergency\x22:\x20bool,\x20\x22alertReason\x22:\x20\x22string\x22\x20},\x20\x0a\x20\x20\x20\x20\x20\x20\x22comfort\x22:\x20{\x20\x22summary\x22:\x20\x22string\x22,\x20\x22suggestion\x22:\x20\x22string\x22,\x20\x22automationProposal\x22:\x20{\x20\x22patternDetected\x22:\x20bool,\x20\x22description\x22:\x20\x22string\x22,\x20\x22suggestedAction\x22:\x20\x22string\x22\x20}\x20},\x0a\x20\x20\x20\x20\x20\x20\x22health\x22:\x20{\x20\x22sleepScore\x22:\x20number\x20(0-100),\x20\x22restlessness\x22:\x20\x22none|low|medium|high\x22,\x20\x22notes\x22:\x20\x22string\x22\x20}\x20\x0a\x20\x20\x20\x20}','details','uuid','system.isPresent','livingContext','Trigger\x20Briefing\x20(Test)','analysis.automation.suggestedAction','error','Drift\x20Sched\x20Error:\x20','name','daswetter.0','Restlessness\x20Level','geminiModel','suggestion','analysis.health.sleepScore','currentSystemMode','Fokus\x20auf\x20Maximierung\x20von\x20Komfort,\x20Automatisierungseffizienz\x20und\x20Energieeinsparung.','analysis.automation.patternDetected','generateContent','PARTY','WETTER:\x20','search','analysis.deviationFromBaseline','models/gemini-flash-latest','üö®\x20EMERGENCY','Daily\x20Digest\x20erstellt\x20&\x20gespeichert.','Pattern\x20Detected','Daily\x20Digests','Lernphase\x20(','weatherunderground.0','briefingJob','ltmJob','startsWith','Reset\x20Sched\x20Error:\x20','\x0a\x20\x20\x20\x20\x0a\x20\x20\x20\x20OUTPUT:\x20Nur\x20der\x20Nachrichtentext\x20(kein\x20JSON).\x20Integriere\x20den\x20Kontext\x20(Wetter/Kalender)\x20nur\x20wenn\x20relevant.','16NIigZd','sensorLastValues','config','notifyWhatsappEnabled','LTM.driftAnalysis.driftDetails','Deaktiviert\x20(Pro-Feature)','main','channel','now','push','2690nUpbSF','analysisHistory','sendTo','unload','Deviation','getStateAsync','description','Alert\x20Reason','includes','LTM.driftAnalysis.baselineDrift','namespace','version','genAI','Cogni-Living\x20Alert','button','getObjectAsync','Scheduling\x20Morning\x20Briefing\x20for\x20','online','system','Action','notifySignalRecipient','time','eventHistory','\x0a\x20\x20\x20\x20ZUSATZ-KONTEXT:\x20','daswetter','values','getForeignObjectAsync','LTM','enum','setObjectNotExistsAsync','accuweather','ROLLE:\x20Data\x20Scientist.\x20VERGLEICHE:\x20Dataset\x20A\x20(Recent)\x20vs\x20B\x20(Established).\x20ZIEL:\x20Erkenne\x20Drift.\x20SCHEMA:\x20{\x20\x22baselineDrift\x22:\x20\x22none|slight|significant|critical\x22,\x20\x22driftDetails\x22:\x20\x22string\x22\x20}\x0a\x0aB\x20(LTB):\x0a','summary','analysis.activitySummary','Autopilot\x20error:\x20','notifyPushoverInstance','openweathermap','analysis.trigger','KALENDER:\x20Keine\x20Daten','replace','driftAnalysisTimer','rawEventLog','analysis.comfortSummary','analysis.isEmergency','notifySignalInstance','subscribeForeignStatesAsync','System\x20Mode','map','exports','feedbackHistory','useCalendar','val','41129mXTodB','Zu\x20wenig\x20Daten\x20f√ºr\x20Daily\x20Digest.','sleepScore','warn','analysis.health.restlessness','Analysis\x20Error:\x20','Feedback\x20saved','activityLevel','object','stateChange','\x0a\x20\x20\x20\x20\x0a\x20\x20\x20\x20DATEN:\x0a\x20\x20\x20\x20-\x20Schlafqualit√§t\x20letzte\x20Nacht:\x20','notifyPushoverRecipient','Analysiere\x20Tag...','ROLLE:\x20F√ºrsorglicher\x20Assistent.\x0a\x20\x20\x20\x20AUFGABE:\x20Schreibe\x20eine\x20kurze,\x20beruhigende\x20\x22Guten\x20Morgen\x22-Nachricht\x20an\x20die\x20Angeh√∂rigen/Bewohner.\x0a\x20\x20\x20\x20TON:\x20Freundlich,\x20professionell,\x20kurz.\x0a\x20\x20\x20\x20PERSONA\x20(Fokus):\x20','Daily\x20Digest\x20Error:\x20','\x0a\x20\x20\x20\x20','comfort','events.history_debug_01','_calName','scanDevices','instance','No\x20recorded\x20events\x20yet.','No\x20instance','notifyPushoverEnabled','WETTER\x20ERROR:\x20','1584628WNdazj','LTM.triggerDailyDigest','User\x20Feedback:\x20Alarm\x20\x22','GUEST','event','\x0a\x20\x20\x20\x20INPUT:\x20','Baseline:\x20Inactive\x20(Pro\x20Feature).','ack','8jFhLUm','weatherInstance','getEnums','(((.+)+)+)+$','activity','KALENDER\x20ERROR:\x20','slice','command','briefingEnabled','Nein','driftDetails','.forecast.current.state','subscribeStates','3101231VCZxUg','No\x20Key','Presence\x20Status','onStateChange','analysis.alertReason','Comfort\x20Summary','testApiKey','from','enum.functions.*','minDaysForBaseline','getLtmData','analysis.isAlert','sort','Analysiere\x20ausgewogen\x20auf\x20Gesundheit,\x20Sicherheit\x20und\x20Komfort.','unshift','filter'];a0_0x2174=function(){return _0x16138a;};return a0_0x2174();}function tryParse(_0x3789c9){const _0xb30dea=a0_0x52b75d;if(typeof _0x3789c9===_0xb30dea(0x1ab))return _0x3789c9;try{return JSON['parse'](_0x3789c9);}catch(_0x2a8eac){return null;}}async function initZombies(_0x5c9375){const _0x1a60da=a0_0x52b75d;try{const _0x5ada0f=[_0x1a60da(0x131),_0x1a60da(0x255),'analysis.history_debug_02','analysis.history_debug_03',_0x1a60da(0xfa),'events.history_debug_00',_0x1a60da(0x1b4),_0x1a60da(0x130),_0x1a60da(0x232),_0x1a60da(0xf9)];for(const _0x39aaa5 of _0x5ada0f){try{const _0x2d64=await _0x5c9375[_0x1a60da(0x17e)](_0x39aaa5);_0x2d64&&await _0x5c9375[_0x1a60da(0x226)](_0x39aaa5);}catch(_0x4ba529){}}}catch(_0x390e51){}}async function getSystemUUID(_0x2bb5b7){const _0xf05978=a0_0x52b75d;try{const _0xe77231=await _0x2bb5b7[_0xf05978(0x189)]('system.meta.uuid');if(_0xe77231&&_0xe77231['native']&&_0xe77231[_0xf05978(0x250)][_0xf05978(0x144)])return _0xe77231['native'][_0xf05978(0x144)];return _0xf05978(0x24c);}catch(_0x2a9cab){return _0xf05978(0x1fb);}}async function checkLicense(_0x33fdcd,_0xd73544){const _0x35c57a=a0_0x52b75d;if(!_0xd73544)return![];_0x33fdcd[_0x35c57a(0x24f)]=await getSystemUUID(_0x33fdcd);if(_0xd73544===_0x35c57a(0x240)||_0xd73544[_0x35c57a(0x162)](_0x35c57a(0x219)))return!![];return![];}async function sendNotification(_0x5ef81e,_0x73306a,_0x2ab768=![],_0x6708b9=![]){const _0x4e2bd0=a0_0x52b75d;_0x5ef81e['log']['info']((_0x2ab768?_0x4e2bd0(0x21f):'')+'Sending\x20notification:\x20\x22'+_0x73306a+'\x22'+(_0x6708b9?_0x4e2bd0(0x1f1):''));const _0x56f1c5=_0x5ef81e[_0x4e2bd0(0x167)];let _0x329df6=0x0;_0x56f1c5[_0x4e2bd0(0x11a)]&&_0x56f1c5[_0x4e2bd0(0x209)]&&(await _0x5ef81e['sendToAsync'](_0x56f1c5[_0x4e2bd0(0x209)],'send',{'text':_0x73306a,'user':_0x56f1c5[_0x4e2bd0(0xef)]}),_0x329df6++);if(_0x56f1c5[_0x4e2bd0(0x1ba)]&&_0x56f1c5['notifyPushoverInstance']){let _0x1e38eb={'message':_0x73306a,'title':_0x6708b9?_0x4e2bd0(0x15a):_0x4e2bd0(0x17c),'priority':_0x6708b9?0x2:0x1,'device':_0x56f1c5[_0x4e2bd0(0x1ae)]};_0x6708b9&&(_0x1e38eb[_0x4e2bd0(0x222)]=0x1e,_0x1e38eb[_0x4e2bd0(0x259)]=0xe10,_0x1e38eb['sound']='siren'),await _0x5ef81e[_0x4e2bd0(0x23e)](_0x56f1c5[_0x4e2bd0(0x192)],'send',_0x1e38eb),_0x329df6++;}return _0x56f1c5['notifyEmailEnabled']&&_0x56f1c5[_0x4e2bd0(0xe9)]&&(await _0x5ef81e[_0x4e2bd0(0x23e)](_0x56f1c5[_0x4e2bd0(0xe9)],_0x4e2bd0(0xfe),{'text':_0x73306a,'to':_0x56f1c5['notifyEmailRecipient']}),_0x329df6++),_0x56f1c5[_0x4e2bd0(0x168)]&&_0x56f1c5[_0x4e2bd0(0x13a)]&&(await _0x5ef81e[_0x4e2bd0(0x23e)](_0x56f1c5[_0x4e2bd0(0x13a)],_0x4e2bd0(0xfe),{'text':_0x73306a,'phone':_0x56f1c5[_0x4e2bd0(0x20c)]}),_0x329df6++),_0x56f1c5[_0x4e2bd0(0x248)]&&_0x56f1c5[_0x4e2bd0(0x19b)]&&(await _0x5ef81e[_0x4e2bd0(0x23e)](_0x56f1c5[_0x4e2bd0(0x19b)],_0x4e2bd0(0xfe),{'text':_0x73306a,'phone':_0x56f1c5[_0x4e2bd0(0x183)]}),_0x329df6++),_0x329df6;}async function initHistory(_0x4b0213){const _0x39ce4c=a0_0x52b75d;try{const _0x13e798=await _0x4b0213['getStateAsync']('events.history');_0x13e798&&_0x13e798[_0x39ce4c(0x1a2)]&&(_0x4b0213['eventHistory']=JSON[_0x39ce4c(0xfd)](_0x13e798[_0x39ce4c(0x1a2)]['toString']()));}catch(_0x3ee2f4){_0x4b0213[_0x39ce4c(0x185)]=[];}try{const _0x596934=await _0x4b0213[_0x39ce4c(0x174)](_0x39ce4c(0x246));if(_0x596934&&_0x596934['val'])_0x4b0213[_0x39ce4c(0x170)]=JSON['parse'](_0x596934[_0x39ce4c(0x1a2)][_0x39ce4c(0x24d)]());}catch(_0x5750b0){_0x4b0213[_0x39ce4c(0x170)]=[];}}async function loadRawEventLog(_0x3dc182){const _0x3cbc22=a0_0x52b75d;try{const _0x3c5654=await _0x3dc182[_0x3cbc22(0x174)](LTM_DP_RAW_LOG);if(_0x3c5654&&_0x3c5654['val'])_0x3dc182[_0x3cbc22(0x198)]=JSON[_0x3cbc22(0xfd)](_0x3c5654[_0x3cbc22(0x1a2)]);}catch(_0x1599e1){_0x3dc182[_0x3cbc22(0x198)]=[];}}async function saveRawEventLog(_0x842d53){const _0x2ff13a=a0_0x52b75d;_0x842d53[_0x2ff13a(0x198)][_0x2ff13a(0xff)]>RAW_LOG_MAX_SIZE&&_0x842d53[_0x2ff13a(0x198)][_0x2ff13a(0x1e1)](0x0,_0x842d53[_0x2ff13a(0x198)]['length']-RAW_LOG_MAX_SIZE),await _0x842d53[_0x2ff13a(0x10a)](LTM_DP_RAW_LOG,{'val':JSON[_0x2ff13a(0x252)](_0x842d53[_0x2ff13a(0x198)]),'ack':!![]});}async function loadDailyDigests(_0x1763dd){const _0x34c540=a0_0x52b75d;try{const _0x259f12=await _0x1763dd[_0x34c540(0x174)](LTM_DP_DAILY_DIGESTS);if(_0x259f12&&_0x259f12[_0x34c540(0x1a2)])_0x1763dd['dailyDigests']=JSON[_0x34c540(0xfd)](_0x259f12['val']);}catch(_0x477060){_0x1763dd['dailyDigests']=[];}await updateBaselineStatus(_0x1763dd);}async function saveDailyDigests(_0x3a94e3,_0x5d797a=!![]){const _0xedd9bb=a0_0x52b75d,_0x34ec92=_0x3a94e3[_0xedd9bb(0x167)][_0xedd9bb(0x258)]||0x3c;_0x3a94e3[_0xedd9bb(0xf2)][_0xedd9bb(0xff)]>_0x34ec92&&_0x3a94e3[_0xedd9bb(0xf2)][_0xedd9bb(0x1e1)](0x0,_0x3a94e3[_0xedd9bb(0xf2)][_0xedd9bb(0xff)]-_0x34ec92);await _0x3a94e3[_0xedd9bb(0x10a)](LTM_DP_DAILY_DIGESTS,{'val':JSON[_0xedd9bb(0x252)](_0x3a94e3['dailyDigests']),'ack':!![]});if(_0x5d797a)await updateBaselineStatus(_0x3a94e3);}async function updateAnalysisHistory(_0x34cb54,_0x3e9b48){const _0x420061=a0_0x52b75d;_0x34cb54['analysisHistory'][_0x420061(0x1df)](_0x3e9b48);if(_0x34cb54[_0x420061(0x170)]['length']>ANALYSIS_HISTORY_MAX_SIZE)_0x34cb54[_0x420061(0x170)]['pop']();await _0x34cb54[_0x420061(0x10a)]('analysis.analysisHistory',{'val':JSON[_0x420061(0x252)](_0x34cb54[_0x420061(0x170)]),'ack':!![]});}async function updateBaselineStatus(_0x382c29){const _0x3d9fa1=a0_0x52b75d;if(!_0x382c29[_0x3d9fa1(0x243)]){await _0x382c29[_0x3d9fa1(0x10a)](LTM_DP_BASELINE_STATUS,{'val':_0x3d9fa1(0x16a),'ack':!![]});return;}const _0x4fe9af=_0x382c29['dailyDigests'][_0x3d9fa1(0xff)]>=(_0x382c29[_0x3d9fa1(0x167)]['minDaysForBaseline']||0x7)?_0x3d9fa1(0x138)+_0x382c29[_0x3d9fa1(0xf2)][_0x3d9fa1(0xff)]+_0x3d9fa1(0x1f2):_0x3d9fa1(0x15e)+_0x382c29[_0x3d9fa1(0xf2)]['length']+'/'+(_0x382c29[_0x3d9fa1(0x167)][_0x3d9fa1(0x1da)]||0x7)+')';await _0x382c29[_0x3d9fa1(0x10a)](LTM_DP_BASELINE_STATUS,{'val':_0x4fe9af,'ack':!![]});}async function resetAnalysisStates(_0x3a7230){const _0x395251=a0_0x52b75d;await _0x3a7230['setStateAsync'](_0x395251(0x190),{'val':_0x395251(0x126),'ack':!![]}),await _0x3a7230[_0x395251(0x10a)](_0x395251(0x158),{'val':_0x3a7230['isProVersion']?_0x395251(0x103):'N/A\x20(Pro\x20Feature)','ack':!![]}),await _0x3a7230['setStateAsync'](_0x395251(0x1dc),{'val':![],'ack':!![]}),await _0x3a7230[_0x395251(0x10a)]('analysis.isEmergency',{'val':![],'ack':!![]}),_0x3a7230['lastAlertState']=![];}function a0_0x4b09(_0x4783c1,_0x2201f4){const _0x5112d1=a0_0x2174();return a0_0x4b09=function(_0x59c3eb,_0x5bc0de){_0x59c3eb=_0x59c3eb-0xe8;let _0x217487=_0x5112d1[_0x59c3eb];return _0x217487;},a0_0x4b09(_0x4783c1,_0x2201f4);}async function loadSystemMode(_0x4e63f5){const _0x5a68db=a0_0x52b75d;try{const _0x32ca44=await _0x4e63f5[_0x5a68db(0x174)](SYSTEM_DP_MODE);_0x32ca44&&_0x32ca44[_0x5a68db(0x1a2)]&&Object[_0x5a68db(0x188)](SYSTEM_MODES)['includes'](_0x32ca44[_0x5a68db(0x1a2)])?_0x4e63f5[_0x5a68db(0x151)]=_0x32ca44[_0x5a68db(0x1a2)]:(_0x4e63f5[_0x5a68db(0x151)]=SYSTEM_MODES[_0x5a68db(0x24b)],await _0x4e63f5[_0x5a68db(0x10a)](SYSTEM_DP_MODE,{'val':SYSTEM_MODES['NORMAL'],'ack':!![]}));}catch(_0x34bdaa){_0x4e63f5['currentSystemMode']=SYSTEM_MODES[_0x5a68db(0x24b)];}}async function setPresence(_0x47e17c,_0x5acb5e){const _0xa0a780=a0_0x52b75d;if(_0x47e17c['isPresent']===_0x5acb5e)return;_0x47e17c[_0xa0a780(0xf5)]=_0x5acb5e,await _0x47e17c[_0xa0a780(0x10a)]('system.isPresent',{'val':_0x5acb5e,'ack':!![]});}async function saveFeedback(_0x194981,_0x46eac3){const _0x254410=a0_0x52b75d;_0x194981['log']['info'](_0x254410(0x1a9));}async function checkSystemObjects(_0x43cf76){const _0xde611=a0_0x52b75d;await _0x43cf76[_0xde611(0x200)](_0xde611(0x181),{'type':_0xde611(0x16c),'common':{'name':'System\x20Status\x20&\x20Control'},'native':{}}),await _0x43cf76[_0xde611(0x200)](SYSTEM_DP_MODE,{'type':_0xde611(0x24a),'common':{'name':_0xde611(0x19d),'type':'string','role':_0xde611(0x24a),'read':!![],'write':!![],'def':SYSTEM_MODES[_0xde611(0x24b)],'states':{[SYSTEM_MODES['NORMAL']]:_0xde611(0x221),[SYSTEM_MODES['VACATION']]:_0xde611(0x21b),[SYSTEM_MODES['PARTY']]:'Party',[SYSTEM_MODES['GUEST']]:_0xde611(0xf4)}},'native':{}});}async function checkLtmObjects(_0x150d11){const _0x2afcfa=a0_0x52b75d;await _0x150d11[_0x2afcfa(0x200)](_0x2afcfa(0x18a),{'type':_0x2afcfa(0x16c),'common':{'name':_0x2afcfa(0x18a)},'native':{}}),await _0x150d11['extendObjectAsync'](LTM_DP_RAW_LOG,{'type':_0x2afcfa(0x24a),'common':{'name':_0x2afcfa(0xe8),'type':_0x2afcfa(0x224),'role':_0x2afcfa(0x1e2),'read':!![],'write':![]},'native':{}}),await _0x150d11[_0x2afcfa(0x200)](LTM_DP_DAILY_DIGESTS,{'type':_0x2afcfa(0x24a),'common':{'name':_0x2afcfa(0x15d),'type':_0x2afcfa(0x224),'role':_0x2afcfa(0x1e2),'read':!![],'write':![]},'native':{}}),await _0x150d11[_0x2afcfa(0x200)](LTM_DP_STATUS,{'type':_0x2afcfa(0x24a),'common':{'name':_0x2afcfa(0x13b),'type':_0x2afcfa(0x224),'role':_0x2afcfa(0x12b),'read':!![],'write':![]},'native':{}}),await _0x150d11[_0x2afcfa(0x200)](LTM_DP_TRIGGER_DIGEST,{'type':_0x2afcfa(0x24a),'common':{'name':'Trigger\x20Digest','type':_0x2afcfa(0x1fc),'role':_0x2afcfa(0x17d),'read':!![],'write':!![],'def':![]},'native':{}}),await _0x150d11[_0x2afcfa(0x200)](LTM_DP_BASELINE_STATUS,{'type':'state','common':{'name':_0x2afcfa(0x227),'type':'string','role':_0x2afcfa(0x12b),'read':!![],'write':![]},'native':{}});}async function checkLtmDriftObjects(_0x381788){const _0x3a3409=a0_0x52b75d;await _0x381788[_0x3a3409(0x200)](LTM_DP_DRIFT_CHANNEL,{'type':_0x3a3409(0x16c),'common':{'name':_0x3a3409(0x1ea)},'native':{}}),await _0x381788['extendObjectAsync'](LTM_DP_DRIFT_STATUS,{'type':_0x3a3409(0x24a),'common':{'name':'Drift\x20Status','type':_0x3a3409(0x224),'role':_0x3a3409(0x24a),'read':!![],'write':![],'def':_0x3a3409(0x10e)},'native':{}}),await _0x381788['extendObjectAsync'](LTM_DP_DRIFT_DETAILS,{'type':_0x3a3409(0x24a),'common':{'name':'Drift\x20Details','type':_0x3a3409(0x224),'role':'text','read':!![],'write':![]},'native':{}}),await _0x381788[_0x3a3409(0x200)](LTM_DP_DRIFT_LAST_CHECK,{'type':_0x3a3409(0x24a),'common':{'name':_0x3a3409(0x214),'type':_0x3a3409(0x24e),'role':_0x3a3409(0x205),'read':!![],'write':![]},'native':{}});}async function createAllObjects(_0x59951f){const _0xb8ff6f=a0_0x52b75d;try{await checkSystemObjects(_0x59951f),await _0x59951f['setObjectNotExistsAsync'](_0xb8ff6f(0x145),{'type':'state','common':{'name':_0xb8ff6f(0x1d3),'type':'boolean','role':'indicator','read':!![],'write':![],'def':!![]},'native':{}}),await _0x59951f['setObjectNotExistsAsync'](_0xb8ff6f(0x1f9),{'type':_0xb8ff6f(0x24a),'common':{'name':_0xb8ff6f(0x114),'type':_0xb8ff6f(0x224),'role':_0xb8ff6f(0x1e2),'read':!![],'write':![]},'native':{}}),await _0x59951f[_0xb8ff6f(0x18c)](_0xb8ff6f(0x106),{'type':'state','common':{'name':_0xb8ff6f(0x1e3),'type':_0xb8ff6f(0x224),'role':_0xb8ff6f(0x1e2),'read':!![],'write':![]},'native':{}}),await _0x59951f[_0xb8ff6f(0x18c)](_0xb8ff6f(0x194),{'type':'state','common':{'name':_0xb8ff6f(0x1fd),'type':_0xb8ff6f(0x1fc),'role':_0xb8ff6f(0x17d),'read':!![],'write':!![],'def':![]},'native':{}}),await _0x59951f['setObjectNotExistsAsync'](_0xb8ff6f(0x110),{'type':_0xb8ff6f(0x24a),'common':{'name':_0xb8ff6f(0x147),'type':_0xb8ff6f(0x1fc),'role':_0xb8ff6f(0x17d),'read':!![],'write':!![],'def':![]},'native':{}}),await _0x59951f['setObjectNotExistsAsync']('analysis.lastResult',{'type':_0xb8ff6f(0x24a),'common':{'name':_0xb8ff6f(0x257),'type':_0xb8ff6f(0x224),'role':_0xb8ff6f(0x1e2),'read':!![],'write':![]},'native':{}}),await _0x59951f['setObjectNotExistsAsync'](_0xb8ff6f(0x1dc),{'type':_0xb8ff6f(0x24a),'common':{'name':'AI\x20Alert\x20Status','type':_0xb8ff6f(0x1fc),'role':'indicator.alarm','read':!![],'write':![],'def':![]},'native':{}}),await _0x59951f[_0xb8ff6f(0x18c)](_0xb8ff6f(0x19a),{'type':_0xb8ff6f(0x24a),'common':{'name':_0xb8ff6f(0x1ed),'type':_0xb8ff6f(0x1fc),'role':_0xb8ff6f(0x135),'read':!![],'write':![],'def':![]},'native':{}}),await _0x59951f['setObjectNotExistsAsync'](_0xb8ff6f(0x1d5),{'type':'state','common':{'name':_0xb8ff6f(0x176),'type':_0xb8ff6f(0x224),'role':_0xb8ff6f(0xfc),'read':!![],'write':![]},'native':{}}),await _0x59951f[_0xb8ff6f(0x18c)]('analysis.activitySummary',{'type':_0xb8ff6f(0x24a),'common':{'name':_0xb8ff6f(0x1f5),'type':_0xb8ff6f(0x224),'role':'text','read':!![],'write':![]},'native':{}}),await _0x59951f[_0xb8ff6f(0x18c)]('analysis.deviationFromBaseline',{'type':'state','common':{'name':_0xb8ff6f(0x173),'type':_0xb8ff6f(0x224),'role':_0xb8ff6f(0x24a),'read':!![],'write':![],'def':_0xb8ff6f(0x10e)},'native':{}}),await _0x59951f['setObjectNotExistsAsync']('analysis.comfortSummary',{'type':'state','common':{'name':_0xb8ff6f(0x1d6),'type':_0xb8ff6f(0x224),'role':_0xb8ff6f(0x12b),'read':!![],'write':![]},'native':{}}),await _0x59951f[_0xb8ff6f(0x18c)](_0xb8ff6f(0x113),{'type':'state','common':{'name':_0xb8ff6f(0x119),'type':_0xb8ff6f(0x224),'role':'text','read':!![],'write':![]},'native':{}}),await _0x59951f[_0xb8ff6f(0x200)]('analysis.automation',{'type':_0xb8ff6f(0x16c),'common':{'name':'Automation\x20Proposals'},'native':{}}),await _0x59951f[_0xb8ff6f(0x18c)](_0xb8ff6f(0x153),{'type':_0xb8ff6f(0x24a),'common':{'name':_0xb8ff6f(0x15c),'type':'boolean','role':_0xb8ff6f(0x202),'read':!![],'write':![],'def':![]},'native':{}}),await _0x59951f[_0xb8ff6f(0x18c)](_0xb8ff6f(0x256),{'type':_0xb8ff6f(0x24a),'common':{'name':'Description','type':_0xb8ff6f(0x224),'role':'text','read':!![],'write':![]},'native':{}}),await _0x59951f[_0xb8ff6f(0x18c)](_0xb8ff6f(0x148),{'type':_0xb8ff6f(0x24a),'common':{'name':_0xb8ff6f(0x182),'type':_0xb8ff6f(0x224),'role':_0xb8ff6f(0x12b),'read':!![],'write':![]},'native':{}}),await _0x59951f['setObjectNotExistsAsync'](_0xb8ff6f(0x246),{'type':_0xb8ff6f(0x24a),'common':{'name':_0xb8ff6f(0x23d),'type':_0xb8ff6f(0x224),'role':_0xb8ff6f(0x1e2),'read':!![],'write':![],'def':'[]'},'native':{}}),await _0x59951f[_0xb8ff6f(0x18c)](_0xb8ff6f(0x123),{'type':'state','common':{'name':'Feedback\x20Log','type':'string','role':_0xb8ff6f(0x1e2),'read':!![],'write':![],'def':'[]'},'native':{}}),await _0x59951f[_0xb8ff6f(0x200)]('analysis.health',{'type':'channel','common':{'name':'Health\x20&\x20Sleep\x20Analysis'},'native':{}}),await _0x59951f[_0xb8ff6f(0x18c)](_0xb8ff6f(0x150),{'type':'state','common':{'name':'Sleep\x20Score\x20(0-100)','type':_0xb8ff6f(0x24e),'role':_0xb8ff6f(0x12d),'read':!![],'write':![],'def':0x0},'native':{}}),await _0x59951f[_0xb8ff6f(0x18c)](_0xb8ff6f(0x1a7),{'type':'state','common':{'name':_0xb8ff6f(0x14d),'type':_0xb8ff6f(0x224),'role':_0xb8ff6f(0x12b),'read':!![],'write':![],'def':'none'},'native':{}}),await _0x59951f[_0xb8ff6f(0x18c)](_0xb8ff6f(0x204),{'type':_0xb8ff6f(0x24a),'common':{'name':_0xb8ff6f(0x1eb),'type':_0xb8ff6f(0x224),'role':_0xb8ff6f(0x12b),'read':!![],'write':![],'def':''},'native':{}}),await checkLtmObjects(_0x59951f),await checkLtmDriftObjects(_0x59951f);}catch(_0x41e162){_0x59951f[_0xb8ff6f(0x139)]['error']('Error\x20creating\x20objects:\x20'+_0x41e162[_0xb8ff6f(0x23a)]);}}async function getWeatherContext(_0x5be0f2){const _0x44a1d8=a0_0x52b75d;try{if(!_0x5be0f2['config']['useWeather'])return _0x44a1d8(0x10c);let _0x2997e2='';const _0x517538=_0x5be0f2[_0x44a1d8(0x167)][_0x44a1d8(0x1c5)];if(_0x517538)try{if(_0x517538['includes'](_0x44a1d8(0x18d))){const _0x4793db=await _0x5be0f2[_0x44a1d8(0x13f)](_0x517538+'.Summary.Current');if(_0x4793db&&_0x4793db[_0x44a1d8(0x1a2)])_0x2997e2=_0x4793db['val'];}else{if(_0x517538['includes'](_0x44a1d8(0x187))){const _0x314aa9=await _0x5be0f2[_0x44a1d8(0x13f)](_0x517538+'.NextHours.Location_1.Day_1.current.symbol_desc');if(_0x314aa9&&_0x314aa9[_0x44a1d8(0x1a2)])_0x2997e2=_0x314aa9[_0x44a1d8(0x1a2)];}else{if(_0x517538[_0x44a1d8(0x177)](_0x44a1d8(0x193))){const _0x5eb753=await _0x5be0f2[_0x44a1d8(0x13f)](_0x517538+_0x44a1d8(0x1cf));if(_0x5eb753&&_0x5eb753[_0x44a1d8(0x1a2)])_0x2997e2=_0x5eb753[_0x44a1d8(0x1a2)];}}}}catch(_0x371e98){}if(!_0x2997e2){const _0x2eb5c3=['accuweather.0',_0x44a1d8(0x14c),_0x44a1d8(0x15f),'openweathermap.0'];for(const _0x2d0431 of _0x2eb5c3){try{const _0x1acb8c=await _0x5be0f2[_0x44a1d8(0x189)](_0x2d0431);if(_0x1acb8c){if(_0x2d0431[_0x44a1d8(0x177)]('accuweather')){const _0x223542=await _0x5be0f2[_0x44a1d8(0x13f)](_0x2d0431+_0x44a1d8(0x100));if(_0x223542&&_0x223542[_0x44a1d8(0x1a2)]){_0x2997e2=_0x223542['val'];break;}}}}catch(_0x2736c0){}}}return _0x2997e2?_0x44a1d8(0x156)+_0x2997e2:_0x44a1d8(0x115);}catch(_0x5d01a0){return _0x44a1d8(0x1bb)+_0x5d01a0['message'];}}async function getCalendarNames(_0x395c53,_0x42d3b4){const _0x589893=a0_0x52b75d;try{const _0x473b64=await _0x395c53[_0x589893(0x13f)](_0x42d3b4+_0x589893(0x253));if(_0x473b64&&_0x473b64[_0x589893(0x1a2)]){const _0x48ec6e=tryParse(_0x473b64[_0x589893(0x1a2)]);if(_0x48ec6e&&Array[_0x589893(0x1e4)](_0x48ec6e)){const _0x1334d3=[...new Set(_0x48ec6e['map'](_0x155ab0=>_0x155ab0[_0x589893(0x1b5)])[_0x589893(0x1e0)](Boolean))];return _0x1334d3[_0x589893(0x1dd)]();}}return[];}catch(_0x39651){return _0x395c53['log'][_0x589893(0x149)](_0x589893(0x137)+_0x39651[_0x589893(0x23a)]),[];}}async function getCalendarContext(_0x327bff){const _0x2205e9=a0_0x52b75d;try{if(!_0x327bff['config'][_0x2205e9(0x1a1)])return'Kalender:\x20Deaktiviert';let _0x220c6c=_0x327bff[_0x2205e9(0x167)][_0x2205e9(0x1ec)]||_0x2205e9(0x11e),_0x192c49=_0x327bff[_0x2205e9(0x167)][_0x2205e9(0x220)]||[];if(typeof _0x192c49===_0x2205e9(0x224))_0x192c49=_0x192c49['split'](',');try{const _0x806756=await _0x327bff[_0x2205e9(0x13f)](_0x220c6c+'.data.table');if(_0x806756&&_0x806756[_0x2205e9(0x1a2)]){let _0x1df401=tryParse(_0x806756['val']);if(_0x1df401&&Array[_0x2205e9(0x1e4)](_0x1df401)){if(_0x192c49[_0x2205e9(0xff)]>0x0)_0x1df401=_0x1df401[_0x2205e9(0x1e0)](_0x519a5e=>_0x192c49[_0x2205e9(0x177)](_0x519a5e[_0x2205e9(0x1b5)]||''));else return _0x2205e9(0x1f0);if(_0x1df401[_0x2205e9(0xff)]>0x0){const _0x56b9d0=_0x1df401['slice'](0x0,0x3)[_0x2205e9(0x19e)](_0x2327c7=>{const _0x26c52d=_0x2205e9;let _0x4ac42f=_0x2327c7[_0x26c52d(0x205)];if(_0x2327c7[_0x26c52d(0x184)])_0x4ac42f+='\x20'+_0x2327c7['time'];return _0x4ac42f+':\x20'+_0x2327c7[_0x26c52d(0x1c0)]+'\x20('+_0x2327c7[_0x26c52d(0x1b5)]+')';});return'KALENDER:\x20'+_0x56b9d0[_0x2205e9(0x102)](_0x2205e9(0x22c));}else return _0x2205e9(0xf7);}}}catch(_0x1cd103){_0x327bff[_0x2205e9(0x139)][_0x2205e9(0x1a6)](_0x2205e9(0x11f)+_0x1cd103['message']);}return _0x2205e9(0x195);}catch(_0x176345){return _0x2205e9(0x1c9)+_0x176345[_0x2205e9(0x23a)];}}async function runGeminiAnalysis(_0x62b3a1,_0x2ff98f=''){const _0x4e35b5=a0_0x52b75d;if(!_0x62b3a1[_0x4e35b5(0x14e)])return;const _0x74cd78=_0x62b3a1[_0x4e35b5(0x185)][_0x4e35b5(0xff)]>0x0?_0x62b3a1[_0x4e35b5(0x185)]:[{'note':_0x4e35b5(0x1b8)}],_0x2b6e0c=PERSONA_MAPPING[_0x62b3a1[_0x4e35b5(0x167)][_0x4e35b5(0x22f)]||_0x4e35b5(0x236)],_0x3b8c6e=_0x62b3a1['config'][_0x4e35b5(0x146)]||'',_0x5c7217=_0x62b3a1['currentSystemMode'],_0x487738=await getWeatherContext(_0x62b3a1),_0x5a3b21=await getCalendarContext(_0x62b3a1),_0x462ba7=(_0x487738+'\x20'+_0x5a3b21)[_0x4e35b5(0x21d)](),_0x505975=new Date(),_0x4789a9=_0x505975[_0x4e35b5(0xfb)](_0x4e35b5(0x212),{'weekday':'long','hour':_0x4e35b5(0x12a),'minute':_0x4e35b5(0x12a)}),_0x3c81a4=_0x62b3a1[_0x4e35b5(0x118)];let _0x20f5f6='';if(_0x62b3a1[_0x4e35b5(0x1a0)][_0x4e35b5(0xff)]>0x0){const _0x3e6ec7=_0x62b3a1['feedbackHistory'][_0x4e35b5(0x1ca)](0x0,0x3)[_0x4e35b5(0x19e)](_0xe56396=>_0x4e35b5(0x1be)+_0xe56396[_0x4e35b5(0x22e)]+_0x4e35b5(0xea)+_0xe56396['rating']+'.')[_0x4e35b5(0x102)]('\x0a');_0x20f5f6=_0x4e35b5(0x134)+_0x3e6ec7+'\x0a';}const _0x4affd9=_0x2ff98f?_0x4e35b5(0x208)+_0x2ff98f+'\x0a!!!\x20END\x20WARNING\x20!!!\x0a':'',_0x5eb4dc=_0x4e35b5(0x1c2),_0x80877e=_0x4e35b5(0x23b)+_0x4789a9+_0x4e35b5(0x247)+_0x3c81a4[_0x4e35b5(0x210)]+'.\x0a\x20\x20\x20\x20MODUS:\x20'+_0x5c7217+_0x4e35b5(0x23f)+(_0x62b3a1[_0x4e35b5(0xf5)]?'Ja':_0x4e35b5(0x1cd))+_0x4e35b5(0x13c)+_0x3b8c6e+_0x4e35b5(0x1ef)+_0x2b6e0c+_0x4e35b5(0x105)+_0x462ba7+_0x4e35b5(0x1b2)+_0x5eb4dc+'\x20'+_0x20f5f6+'\x20'+_0x4affd9+_0x4e35b5(0x1f7)+JSON[_0x4e35b5(0x252)](_0x74cd78)+_0x4e35b5(0x142);try{const _0x36eb8a=await _0x62b3a1[_0x4e35b5(0x14e)][_0x4e35b5(0x154)](_0x80877e),_0x349834=_0x36eb8a[_0x4e35b5(0x107)][_0x4e35b5(0x12b)]()[_0x4e35b5(0x196)](/```json|```/g,'')[_0x4e35b5(0x21d)](),_0x5cf3d7=JSON[_0x4e35b5(0xfd)](_0x349834);await _0x62b3a1[_0x4e35b5(0x10a)]('analysis.lastResult',{'val':_0x349834,'ack':!![]}),await _0x62b3a1[_0x4e35b5(0x10a)](_0x4e35b5(0x1d5),{'val':_0x5cf3d7[_0x4e35b5(0x1c8)]['alertReason']||'','ack':!![]}),await _0x62b3a1[_0x4e35b5(0x10a)](_0x4e35b5(0x190),{'val':_0x5cf3d7[_0x4e35b5(0x1c8)]['summary']||_0x4e35b5(0x10e),'ack':!![]}),await _0x62b3a1[_0x4e35b5(0x10a)](_0x4e35b5(0x158),{'val':_0x5cf3d7['activity']['deviationFromBaseline']||_0x4e35b5(0x10e),'ack':!![]});_0x5cf3d7[_0x4e35b5(0x1b3)]&&(await _0x62b3a1['setStateAsync'](_0x4e35b5(0x199),{'val':_0x5cf3d7['comfort'][_0x4e35b5(0x18f)]||'','ack':!![]}),await _0x62b3a1['setStateAsync'](_0x4e35b5(0x113),{'val':_0x5cf3d7[_0x4e35b5(0x1b3)][_0x4e35b5(0x14f)]||'','ack':!![]}),_0x5cf3d7[_0x4e35b5(0x1b3)][_0x4e35b5(0xf8)]&&(await _0x62b3a1[_0x4e35b5(0x10a)]('analysis.automation.patternDetected',{'val':_0x5cf3d7[_0x4e35b5(0x1b3)][_0x4e35b5(0xf8)]['patternDetected']||![],'ack':!![]}),await _0x62b3a1[_0x4e35b5(0x10a)](_0x4e35b5(0x256),{'val':_0x5cf3d7['comfort'][_0x4e35b5(0xf8)][_0x4e35b5(0x175)]||'','ack':!![]}),await _0x62b3a1[_0x4e35b5(0x10a)](_0x4e35b5(0x148),{'val':_0x5cf3d7[_0x4e35b5(0x1b3)][_0x4e35b5(0xf8)][_0x4e35b5(0xf6)]||'','ack':!![]})));_0x5cf3d7[_0x4e35b5(0x129)]&&(await _0x62b3a1[_0x4e35b5(0x10a)](_0x4e35b5(0x150),{'val':typeof _0x5cf3d7[_0x4e35b5(0x129)][_0x4e35b5(0x1a5)]==='number'?_0x5cf3d7['health'][_0x4e35b5(0x1a5)]:0x0,'ack':!![]}),await _0x62b3a1[_0x4e35b5(0x10a)](_0x4e35b5(0x1a7),{'val':_0x5cf3d7[_0x4e35b5(0x129)][_0x4e35b5(0x21c)]||_0x4e35b5(0xee),'ack':!![]}),await _0x62b3a1[_0x4e35b5(0x10a)](_0x4e35b5(0x204),{'val':_0x5cf3d7[_0x4e35b5(0x129)][_0x4e35b5(0x213)]||'','ack':!![]}));const _0x3b7c5f=_0x5cf3d7['activity'][_0x4e35b5(0xf0)]||![],_0x5adc7a=_0x5cf3d7[_0x4e35b5(0x1c8)]['isEmergency']||![];if(_0x3b7c5f||_0x5adc7a){await _0x62b3a1[_0x4e35b5(0x10a)](_0x4e35b5(0x1dc),{'val':!![],'ack':!![]}),await _0x62b3a1['setStateAsync'](_0x4e35b5(0x19a),{'val':_0x5adc7a,'ack':!![]});if(!_0x62b3a1['lastAlertState']||_0x5adc7a){const _0x168dc8=_0x5adc7a?_0x4e35b5(0x20a):_0x4e35b5(0x231);sendNotification(_0x62b3a1,_0x168dc8+':\x20'+_0x5cf3d7[_0x4e35b5(0x1c8)][_0x4e35b5(0x22e)],![],_0x5adc7a);}}else await _0x62b3a1['setStateAsync'](_0x4e35b5(0x1dc),{'val':![],'ack':!![]}),await _0x62b3a1[_0x4e35b5(0x10a)](_0x4e35b5(0x19a),{'val':![],'ack':!![]});_0x62b3a1[_0x4e35b5(0x20e)]=_0x3b7c5f||_0x5adc7a;const _0x15a767={'timestamp':Date[_0x4e35b5(0x16d)](),'id':Date[_0x4e35b5(0x16d)]()['toString'](),'analysis':_0x5cf3d7,'systemMode':_0x5c7217,'isPro':_0x62b3a1['isProVersion']};updateAnalysisHistory(_0x62b3a1,_0x15a767);}catch(_0x4e0f08){_0x62b3a1[_0x4e35b5(0x139)]['error'](_0x4e35b5(0x1a8)+_0x4e0f08[_0x4e35b5(0x23a)]);}}async function runAutopilot(_0x3530f7){const _0x4e187c=a0_0x52b75d,_0x3660e3=_0x3530f7[_0x4e187c(0x167)][_0x4e187c(0x112)],_0x29db60=_0x3530f7['config'][_0x4e187c(0x207)],_0x19ebb2=_0x3530f7[_0x4e187c(0x185)]['length']>0x0?_0x3530f7[_0x4e187c(0x185)][0x0][_0x4e187c(0x239)]:Date[_0x4e187c(0x16d)](),_0x83aca6=(Date['now']()-_0x19ebb2)/(0x3e8*0x3c*0x3c);let _0x37a6b2='';_0x29db60&&_0x3530f7[_0x4e187c(0x151)]===SYSTEM_MODES[_0x4e187c(0x24b)]&&_0x3530f7[_0x4e187c(0xf5)]&&(_0x83aca6>_0x3660e3&&(_0x37a6b2='CRITICAL\x20WARNING:\x20No\x20sensor\x20activity\x20detected\x20for\x20'+_0x83aca6[_0x4e187c(0x132)](0x1)+_0x4e187c(0x251)));if(_0x37a6b2){runGeminiAnalysis(_0x3530f7,_0x37a6b2)[_0x4e187c(0x21e)](_0x189003=>_0x3530f7[_0x4e187c(0x139)][_0x4e187c(0x149)](_0x189003));return;}const _0x84d8d2=Date['now'](),_0x93f4a8=_0x84d8d2-_0x19ebb2,_0x396f52=(_0x3530f7[_0x4e187c(0x167)][_0x4e187c(0x245)]||0xf)*0x3c*0x3e8;_0x3530f7[_0x4e187c(0x185)][_0x4e187c(0xff)]>0x0&&_0x93f4a8<=_0x396f52?runGeminiAnalysis(_0x3530f7)[_0x4e187c(0x21e)](_0x3052dd=>_0x3530f7[_0x4e187c(0x139)]['error'](_0x3052dd)):!_0x3530f7[_0x4e187c(0x20e)]&&(_0x3530f7['setState'](_0x4e187c(0x1dc),{'val':![],'ack':!![]}),_0x3530f7[_0x4e187c(0xf3)]('analysis.isEmergency',{'val':![],'ack':!![]}));}async function createDailyDigest(_0x5d8b86){const _0x3874c9=a0_0x52b75d;if(!_0x5d8b86[_0x3874c9(0x14e)]||_0x5d8b86[_0x3874c9(0x198)][_0x3874c9(0xff)]<LTM_MIN_EVENTS_FOR_COMPRESSION){await _0x5d8b86[_0x3874c9(0x10a)](LTM_DP_STATUS,{'val':_0x3874c9(0x1a4),'ack':!![]});return;}_0x5d8b86[_0x3874c9(0x139)][_0x3874c9(0x215)](_0x3874c9(0x11d)+_0x5d8b86[_0x3874c9(0x198)][_0x3874c9(0xff)]+'\x20raw\x20events...'),await _0x5d8b86[_0x3874c9(0x10a)](LTM_DP_STATUS,{'val':_0x3874c9(0x1af),'ack':!![]});const _0x5bd591=_0x5d8b86[_0x3874c9(0x198)][_0x3874c9(0xff)]>0x320?_0x5d8b86[_0x3874c9(0x198)][_0x3874c9(0x1ca)](_0x5d8b86[_0x3874c9(0x198)][_0x3874c9(0xff)]-0x320):_0x5d8b86[_0x3874c9(0x198)],_0x2ec690=PERSONA_MAPPING[_0x5d8b86[_0x3874c9(0x167)]['aiPersona']||_0x3874c9(0x236)],_0x58e327=_0x3874c9(0x234)+_0x2ec690+_0x3874c9(0x1c1)+JSON[_0x3874c9(0x252)](_0x5bd591)+_0x3874c9(0x218);try{const _0xc64eaa=await _0x5d8b86['geminiModel'][_0x3874c9(0x154)](_0x58e327),_0x1d75b7=_0xc64eaa[_0x3874c9(0x107)][_0x3874c9(0x12b)]()[_0x3874c9(0x196)](/```json|```/g,'')[_0x3874c9(0x21d)](),_0x47926d=JSON[_0x3874c9(0xfd)](_0x1d75b7),_0x2ef8ed={'timestamp':new Date()[_0x3874c9(0x122)](),'eventCount':_0x5d8b86[_0x3874c9(0x198)][_0x3874c9(0xff)],'summary':_0x47926d[_0x3874c9(0x18f)],'activityLevel':_0x47926d[_0x3874c9(0x1aa)],'health':{'sleepScore':_0x47926d[_0x3874c9(0x129)]?_0x47926d[_0x3874c9(0x129)][_0x3874c9(0x1a5)]:0x0,'restlessness':_0x47926d[_0x3874c9(0x129)]?_0x47926d[_0x3874c9(0x129)]['restlessness']:'none'},'systemMode':_0x5d8b86['currentSystemMode']};_0x5d8b86[_0x3874c9(0xf2)][_0x3874c9(0x16e)](_0x2ef8ed),await saveDailyDigests(_0x5d8b86),_0x5d8b86['rawEventLog']=[],await saveRawEventLog(_0x5d8b86),await _0x5d8b86['setStateAsync'](LTM_DP_STATUS,{'val':_0x3874c9(0x15b),'ack':!![]}),_0x5d8b86['log'][_0x3874c9(0x215)](_0x3874c9(0xf1));}catch(_0x1bed7e){_0x5d8b86[_0x3874c9(0x139)][_0x3874c9(0x149)](_0x3874c9(0x1b1)+_0x1bed7e['message']),await _0x5d8b86['setStateAsync'](LTM_DP_STATUS,{'val':_0x3874c9(0x108)+_0x1bed7e[_0x3874c9(0x23a)],'ack':!![]});}}async function sendMorningBriefing(_0x53c306){const _0x3ec5a4=a0_0x52b75d;if(!_0x53c306[_0x3ec5a4(0x14e)])return;_0x53c306[_0x3ec5a4(0x139)][_0x3ec5a4(0x215)](_0x3ec5a4(0x13d));const _0x25c7ad=_0x53c306[_0x3ec5a4(0xf2)][_0x3ec5a4(0xff)]>0x0?_0x53c306[_0x3ec5a4(0xf2)][_0x53c306[_0x3ec5a4(0xf2)][_0x3ec5a4(0xff)]-0x1]:null,_0x2f4c15=_0x25c7ad&&_0x25c7ad['health']?_0x25c7ad[_0x3ec5a4(0x129)][_0x3ec5a4(0x1a5)]:'N/A',_0x59f2bb=new Date();_0x59f2bb['setHours'](0x4,0x0,0x0,0x0);const _0x1ba40d=_0x53c306[_0x3ec5a4(0x185)][_0x3ec5a4(0x1e0)](_0x372364=>new Date(_0x372364[_0x3ec5a4(0x239)])>_0x59f2bb),_0x567a8a=PERSONA_MAPPING[_0x53c306[_0x3ec5a4(0x167)][_0x3ec5a4(0x22f)]||_0x3ec5a4(0x236)],_0x4a9281=_0x53c306[_0x3ec5a4(0x167)][_0x3ec5a4(0x146)]||'',_0x4caa80=await getWeatherContext(_0x53c306),_0x1e4a23=await getCalendarContext(_0x53c306),_0x54a666=_0x3ec5a4(0x1b0)+_0x567a8a+_0x3ec5a4(0x111)+_0x4a9281+_0x3ec5a4(0x186)+_0x4caa80+'\x20'+_0x1e4a23+_0x3ec5a4(0x1ad)+_0x2f4c15+'/100\x0a\x20\x20\x20\x20-\x20Aktivit√§t\x20seit\x2004:00\x20Uhr:\x20'+JSON[_0x3ec5a4(0x252)](_0x1ba40d[_0x3ec5a4(0x1ca)](0x0,0xa))+_0x3ec5a4(0x164);try{const _0x5f07d2=await _0x53c306[_0x3ec5a4(0x14e)]['generateContent'](_0x54a666),_0x45784e=_0x3ec5a4(0x1e6)+_0x5f07d2[_0x3ec5a4(0x107)][_0x3ec5a4(0x12b)]()[_0x3ec5a4(0x21d)]();sendNotification(_0x53c306,_0x45784e),_0x53c306[_0x3ec5a4(0x139)][_0x3ec5a4(0x215)](_0x3ec5a4(0x10d));}catch(_0x3d1c2e){_0x53c306[_0x3ec5a4(0x139)][_0x3ec5a4(0x149)]('Briefing\x20Error:\x20'+_0x3d1c2e[_0x3ec5a4(0x23a)]);}}async function runBaselineDriftAnalysis(_0x5801f8){const _0x55ed76=a0_0x52b75d;if(!_0x5801f8[_0x55ed76(0x243)]||!_0x5801f8['geminiModel'])return;const _0x522afa=_0x5801f8[_0x55ed76(0x167)][_0x55ed76(0xeb)]||0xe;if(_0x5801f8['dailyDigests'][_0x55ed76(0xff)]<_0x522afa+(_0x5801f8[_0x55ed76(0x167)][_0x55ed76(0x1da)]||0x7)){await _0x5801f8[_0x55ed76(0x10a)](LTM_DP_DRIFT_STATUS,{'val':_0x55ed76(0x1ff),'ack':!![]});return;}const _0x201c9c=_0x5801f8[_0x55ed76(0xf2)][_0x55ed76(0x1ca)](-_0x522afa),_0x897d29=_0x5801f8['dailyDigests']['slice'](0x0,_0x5801f8[_0x55ed76(0xf2)][_0x55ed76(0xff)]-_0x522afa),_0x25845c=_0x55ed76(0x18e)+JSON[_0x55ed76(0x252)](_0x897d29)+'\x0a\x0aA\x20(STB):\x0a'+JSON[_0x55ed76(0x252)](_0x201c9c);try{const _0x222d96=await _0x5801f8['geminiModel'][_0x55ed76(0x154)](_0x25845c),_0x49a1c5=JSON[_0x55ed76(0xfd)](_0x222d96[_0x55ed76(0x107)][_0x55ed76(0x12b)]()[_0x55ed76(0x196)](/```json|```/g,'')[_0x55ed76(0x21d)]());_0x49a1c5[_0x55ed76(0x1e9)]&&(await _0x5801f8['setStateAsync'](LTM_DP_DRIFT_STATUS,{'val':_0x49a1c5[_0x55ed76(0x1e9)],'ack':!![]}),await _0x5801f8[_0x55ed76(0x10a)](LTM_DP_DRIFT_DETAILS,{'val':_0x49a1c5[_0x55ed76(0x1ce)],'ack':!![]}),await _0x5801f8[_0x55ed76(0x10a)](LTM_DP_DRIFT_LAST_CHECK,{'val':Date['now'](),'ack':!![]}));}catch(_0x275d63){}}function abortExitTimer(_0x11770b){const _0x4782cc=a0_0x52b75d;if(_0x11770b[_0x4782cc(0x13e)])clearTimeout(_0x11770b[_0x4782cc(0x13e)]);if(_0x11770b['exitGraceTimer'])clearTimeout(_0x11770b[_0x4782cc(0x233)]);_0x11770b[_0x4782cc(0x13e)]=null,_0x11770b[_0x4782cc(0x233)]=null,_0x11770b[_0x4782cc(0xed)]=![];}function startExitTimer(_0x725bdd){const _0x1e00b7=a0_0x52b75d;abortExitTimer(_0x725bdd),_0x725bdd[_0x1e00b7(0xed)]=!![],_0x725bdd[_0x1e00b7(0x233)]=setTimeout(()=>{const _0x370669=_0x1e00b7;_0x725bdd[_0x370669(0xed)]=![];},EXIT_GRACE_PERIOD_SECONDS*0x3e8),_0x725bdd[_0x1e00b7(0x13e)]=setTimeout(()=>{const _0x292960=_0x1e00b7;setPresence(_0x725bdd,![]),_0x725bdd[_0x292960(0x13e)]=null;},EXIT_TIMER_MINUTES*0x3c*0x3e8);}async function checkWifiPresence(_0x1def8b){const _0x36c4b6=a0_0x52b75d;try{const _0x2af98d=_0x1def8b[_0x36c4b6(0x167)]['presenceDevices']||[];let _0x65b5b5=![];for(const _0x1f0080 of _0x2af98d){try{const _0xe38a48=await _0x1def8b[_0x36c4b6(0x13f)](_0x1f0080);if(_0xe38a48&&(_0xe38a48['val']===!![]||_0xe38a48[_0x36c4b6(0x1a2)]===_0x36c4b6(0x180)||_0xe38a48[_0x36c4b6(0x1a2)]===0x1)){_0x65b5b5=!![];break;}}catch(_0xe0c038){}}return _0x65b5b5&&(_0x1def8b[_0x36c4b6(0x13e)]&&(_0x1def8b[_0x36c4b6(0x139)][_0x36c4b6(0x215)]('WiFi\x20Presence\x20detected\x20->\x20Aborting\x20Exit\x20Timer.\x20User\x20is\x20present.'),abortExitTimer(_0x1def8b)),!_0x1def8b['isPresent']&&_0x1def8b['currentSystemMode']===SYSTEM_MODES[_0x36c4b6(0x24b)]&&await setPresence(_0x1def8b,!![])),_0x65b5b5;}catch(_0x2778a7){return _0x1def8b[_0x36c4b6(0x139)][_0x36c4b6(0x149)]('Error\x20checking\x20WiFi:\x20'+_0x2778a7[_0x36c4b6(0x23a)]),![];}}function setupLtmScheduler(_0x596cb5){const _0x34d887=a0_0x52b75d;try{if(_0x596cb5[_0x34d887(0x161)])_0x596cb5[_0x34d887(0x161)][_0x34d887(0x1e7)]();if(!_0x596cb5[_0x34d887(0x243)]){_0x596cb5[_0x34d887(0x10a)](LTM_DP_STATUS,{'val':_0x34d887(0x16a),'ack':!![]});return;}_0x596cb5['ltmJob']=schedule['scheduleJob'](LTM_SCHEDULE,()=>createDailyDigest(_0x596cb5));}catch(_0x4a4294){_0x596cb5['log'][_0x34d887(0x149)](_0x34d887(0x1f8)+_0x4a4294[_0x34d887(0x23a)]);}}function setupModeResetScheduler(_0x2f407c){const _0x274d54=a0_0x52b75d;try{if(_0x2f407c['modeResetJob'])_0x2f407c[_0x274d54(0x117)]['cancel']();_0x2f407c[_0x274d54(0x117)]=schedule[_0x274d54(0x228)](MODE_RESET_SCHEDULE,async()=>{const _0xb34c4=_0x274d54;await loadSystemMode(_0x2f407c),AUTO_RESET_MODES[_0xb34c4(0x177)](_0x2f407c[_0xb34c4(0x151)])&&await _0x2f407c[_0xb34c4(0x10a)](SYSTEM_DP_MODE,{'val':SYSTEM_MODES[_0xb34c4(0x24b)],'ack':![]});});}catch(_0x24e341){_0x2f407c[_0x274d54(0x139)][_0x274d54(0x149)](_0x274d54(0x163)+_0x24e341[_0x274d54(0x23a)]);}}function setupDriftAnalysisScheduler(_0x1d7ed8){const _0xc68f54=a0_0x52b75d;try{if(_0x1d7ed8['driftAnalysisTimer'])clearInterval(_0x1d7ed8[_0xc68f54(0x197)]);if(!_0x1d7ed8['isProVersion'])return;_0x1d7ed8[_0xc68f54(0x197)]=setInterval(()=>runBaselineDriftAnalysis(_0x1d7ed8),(_0x1d7ed8[_0xc68f54(0x167)][_0xc68f54(0x22b)]||0x18)*0x36ee80),setTimeout(()=>runBaselineDriftAnalysis(_0x1d7ed8),0x1388);}catch(_0x743f8e){_0x1d7ed8['log'][_0xc68f54(0x149)](_0xc68f54(0x14a)+_0x743f8e['message']);}}function setupBriefingScheduler(_0x150f9c){const _0x1a22cc=a0_0x52b75d;try{if(_0x150f9c[_0x1a22cc(0x160)])_0x150f9c[_0x1a22cc(0x160)][_0x1a22cc(0x1e7)]();if(!_0x150f9c[_0x1a22cc(0x167)][_0x1a22cc(0x1cc)])return;const _0x1f56e1=(_0x150f9c[_0x1a22cc(0x167)]['briefingTime']||_0x1a22cc(0x1e8))[_0x1a22cc(0x225)](':'),_0x6f06f0=parseInt(_0x1f56e1[0x0])||0x8,_0x7e47b4=parseInt(_0x1f56e1[0x1])||0x0,_0x196a3e=_0x7e47b4+'\x20'+_0x6f06f0+_0x1a22cc(0x203);_0x150f9c[_0x1a22cc(0x139)][_0x1a22cc(0x215)](_0x1a22cc(0x17f)+_0x6f06f0+':'+(_0x7e47b4<0xa?'0'+_0x7e47b4:_0x7e47b4)),_0x150f9c[_0x1a22cc(0x160)]=schedule[_0x1a22cc(0x228)](_0x196a3e,()=>{sendMorningBriefing(_0x150f9c);});}catch(_0x389fc6){_0x150f9c[_0x1a22cc(0x139)][_0x1a22cc(0x149)](_0x1a22cc(0x109)+_0x389fc6['message']);}}class CogniLiving extends utils[a0_0x52b75d(0x1e5)]{constructor(_0x49545f){const _0x40c0c8=a0_0x52b75d;super({..._0x49545f,'name':'cogni-living'}),this['eventHistory']=[],this[_0x40c0c8(0x170)]=[],this[_0x40c0c8(0x1a0)]=[],this['rawEventLog']=[],this[_0x40c0c8(0xf2)]=[],this[_0x40c0c8(0x166)]={},this['systemConfig']={'latitude':0x0,'longitude':0x0,'city':''},this['isPresent']=!![],this['exitTimer']=null,this[_0x40c0c8(0x233)]=null,this[_0x40c0c8(0xed)]=![],this[_0x40c0c8(0x17b)]=null,this[_0x40c0c8(0x14e)]=null,this['currentSystemMode']=SYSTEM_MODES['NORMAL'],this['isProVersion']=![],this[_0x40c0c8(0x20e)]=![],this[_0x40c0c8(0x24f)]='unknown',this[_0x40c0c8(0x140)]=null,this[_0x40c0c8(0x161)]=null,this[_0x40c0c8(0x117)]=null,this[_0x40c0c8(0x197)]=null,this[_0x40c0c8(0x160)]=null,this['on'](_0x40c0c8(0x121),this[_0x40c0c8(0x1fa)][_0x40c0c8(0x128)](this)),this['on'](_0x40c0c8(0x1ac),this[_0x40c0c8(0x1d4)][_0x40c0c8(0x128)](this)),this['on'](_0x40c0c8(0x172),this['onUnload']['bind'](this)),this['on'](_0x40c0c8(0x23a),this[_0x40c0c8(0x235)][_0x40c0c8(0x128)](this));}async[a0_0x52b75d(0x1fa)](){const _0x59cb9a=a0_0x52b75d;this['log'][_0x59cb9a(0x215)]('cogni-living\x20adapter\x20starting\x20(v'+this[_0x59cb9a(0x17a)]+')\x20-\x20LINEAR\x20MODE'),await initZombies(this),this[_0x59cb9a(0x167)][_0x59cb9a(0x217)]=this[_0x59cb9a(0x167)][_0x59cb9a(0x217)]||'';try{this[_0x59cb9a(0x243)]=await checkLicense(this,this[_0x59cb9a(0x167)][_0x59cb9a(0x217)]);}catch(_0x5d4d54){this['log'][_0x59cb9a(0x149)](_0x59cb9a(0x141)+_0x5d4d54[_0x59cb9a(0x23a)]);}if(!this[_0x59cb9a(0x167)][_0x59cb9a(0x112)]||this['config']['inactivityThresholdHours']<0.1)this[_0x59cb9a(0x167)][_0x59cb9a(0x112)]=0xc;await initHistory(this),await initSystemConfig(this);if(this[_0x59cb9a(0x167)]['geminiApiKey'])try{this[_0x59cb9a(0x17b)]=new GoogleGenerativeAI(this[_0x59cb9a(0x167)][_0x59cb9a(0x22d)]),this[_0x59cb9a(0x14e)]=this[_0x59cb9a(0x17b)]['getGenerativeModel']({'model':GEMINI_MODEL,'generationConfig':{'responseMimeType':'application/json'}}),this['log'][_0x59cb9a(0x215)](_0x59cb9a(0x223));}catch(_0x16b16a){this[_0x59cb9a(0x139)][_0x59cb9a(0x149)](_0x59cb9a(0x206)+_0x16b16a[_0x59cb9a(0x23a)]);}await createAllObjects(this),await loadSystemMode(this),await loadRawEventLog(this),await loadDailyDigests(this),this['subscribeStates'](_0x59cb9a(0x194)),this['subscribeStates'](LTM_DP_TRIGGER_DIGEST),this[_0x59cb9a(0x1d0)](_0x59cb9a(0x249)),this[_0x59cb9a(0x1d0)](_0x59cb9a(0x110)),await initSensorSubscriptions(this),await initPresenceSubscriptions(this);if(this[_0x59cb9a(0x140)])clearInterval(this[_0x59cb9a(0x140)]);const _0xf05713=this[_0x59cb9a(0x167)][_0x59cb9a(0x245)]||0xf;_0xf05713>0x0&&(this[_0x59cb9a(0x139)][_0x59cb9a(0x215)]('Starting\x20Autopilot\x20('+_0xf05713+'\x20min).\x20Watchdog\x20Limit:\x20'+this[_0x59cb9a(0x167)]['inactivityThresholdHours']+'h.'),this['analysisTimer']=setInterval(()=>{const _0x2db94a=_0x59cb9a;try{runAutopilot(this);}catch(_0x46f9d5){this[_0x2db94a(0x139)][_0x2db94a(0x149)](_0x2db94a(0x191)+_0x46f9d5[_0x2db94a(0x23a)]);}},_0xf05713*0x3c*0x3e8)),setupLtmScheduler(this),setupModeResetScheduler(this),setupDriftAnalysisScheduler(this),setupBriefingScheduler(this);}[a0_0x52b75d(0x12e)](_0x2987c8){const _0x515b46=a0_0x52b75d;if(this[_0x515b46(0x140)])clearInterval(this[_0x515b46(0x140)]);if(this[_0x515b46(0x197)])clearInterval(this[_0x515b46(0x197)]);if(this['ltmJob'])this['ltmJob'][_0x515b46(0x1e7)]();if(this['modeResetJob'])this['modeResetJob'][_0x515b46(0x1e7)]();if(this[_0x515b46(0x160)])this[_0x515b46(0x160)][_0x515b46(0x1e7)]();if(this[_0x515b46(0x13e)])clearTimeout(this[_0x515b46(0x13e)]);if(this[_0x515b46(0x233)])clearTimeout(this[_0x515b46(0x233)]);_0x2987c8();}async[a0_0x52b75d(0x1d4)](_0x508307,_0xd1223){const _0x5f2141=a0_0x52b75d;if(!_0xd1223)return;if(_0x508307===this[_0x5f2141(0x179)]+'.'+SYSTEM_DP_MODE){_0xd1223[_0x5f2141(0x1a2)]&&Object[_0x5f2141(0x188)](SYSTEM_MODES)['includes'](_0xd1223['val'])&&(this[_0x5f2141(0x151)]=_0xd1223[_0x5f2141(0x1a2)],_0xd1223[_0x5f2141(0x1a2)]===SYSTEM_MODES['VACATION']?await setPresence(this,![]):await setPresence(this,!![]));if(!_0xd1223[_0x5f2141(0x1c3)])this[_0x5f2141(0xf3)](_0x508307,{'val':this[_0x5f2141(0x151)],'ack':!![]});return;}if(!_0xd1223[_0x5f2141(0x1c3)]){_0x508307[_0x5f2141(0x177)]('analysis.trigger')&&_0xd1223[_0x5f2141(0x1a2)]&&(this['setState'](_0x508307,{'val':![],'ack':!![]}),runGeminiAnalysis(this));if(_0x508307[_0x5f2141(0x177)](_0x5f2141(0x1f6))&&_0xd1223[_0x5f2141(0x1a2)]){this[_0x5f2141(0xf3)](_0x508307,{'val':![],'ack':!![]});if(this[_0x5f2141(0x243)])createDailyDigest(this);}_0x508307[_0x5f2141(0x177)](_0x5f2141(0x229))&&_0xd1223[_0x5f2141(0x1a2)]&&(this[_0x5f2141(0xf3)](_0x508307,{'val':![],'ack':!![]}),sendMorningBriefing(this));return;}if(this[_0x5f2141(0x167)][_0x5f2141(0x238)]&&this['config'][_0x5f2141(0x238)][_0x5f2141(0x177)](_0x508307)){await checkWifiPresence(this);return;}const _0x58400b=(this[_0x5f2141(0x167)][_0x5f2141(0x136)]||[])[_0x5f2141(0x230)](_0x5851c8=>_0x5851c8['id']===_0x508307);if(_0x58400b)processSensorEvent(this,_0x508307,_0xd1223,_0x58400b);}async['onMessage'](_0x475446){const _0x40f33a=a0_0x52b75d;if(typeof _0x475446==='object'&&_0x475446[_0x40f33a(0x23a)])try{if(_0x475446[_0x40f33a(0x1cb)]===_0x40f33a(0x1d7)){if(!_0x475446[_0x40f33a(0x23a)][_0x40f33a(0x1ee)])return this[_0x40f33a(0x171)](_0x475446[_0x40f33a(0x1d8)],_0x475446[_0x40f33a(0x1cb)],{'success':![],'message':_0x40f33a(0x1d2)},_0x475446[_0x40f33a(0x101)]);try{const _0x563433=new GoogleGenerativeAI(_0x475446[_0x40f33a(0x23a)][_0x40f33a(0x1ee)])[_0x40f33a(0x11b)]({'model':_0x40f33a(0x159)});await _0x563433[_0x40f33a(0x154)]('test'),this[_0x40f33a(0x171)](_0x475446[_0x40f33a(0x1d8)],_0x475446[_0x40f33a(0x1cb)],{'success':!![],'message':_0x40f33a(0x23c)},_0x475446['callback']);}catch(_0x4dee75){this[_0x40f33a(0x171)](_0x475446['from'],_0x475446['command'],{'success':![],'message':_0x4dee75[_0x40f33a(0x23a)]},_0x475446[_0x40f33a(0x101)]);}}else{if(_0x475446['command']===_0x40f33a(0x12c)){const _0x2b690c=await sendNotification(this,'[Test]\x20Notification',!![]);this[_0x40f33a(0x171)](_0x475446['from'],_0x475446['command'],{'success':_0x2b690c>0x0,'message':_0x2b690c+'\x20sent'},_0x475446['callback']);}else{if(_0x475446[_0x40f33a(0x1cb)]===_0x40f33a(0x1db)){if(!this[_0x40f33a(0x243)])return this['sendTo'](_0x475446[_0x40f33a(0x1d8)],_0x475446[_0x40f33a(0x1cb)],{'success':![],'isPro':![]},_0x475446[_0x40f33a(0x101)]);let _0x3a4062={'status':_0x40f33a(0x10e),'details':'','lastCheck':0x0};try{_0x3a4062['status']=(await this[_0x40f33a(0x174)](LTM_DP_DRIFT_STATUS))['val'],_0x3a4062[_0x40f33a(0x143)]=(await this[_0x40f33a(0x174)](LTM_DP_DRIFT_DETAILS))['val'],_0x3a4062[_0x40f33a(0x11c)]=(await this['getStateAsync'](LTM_DP_DRIFT_LAST_CHECK))['val'];}catch(_0x23d6b8){}this[_0x40f33a(0x171)](_0x475446[_0x40f33a(0x1d8)],_0x475446[_0x40f33a(0x1cb)],{'success':!![],'isPro':!![],'dailyDigests':this[_0x40f33a(0xf2)],'driftAnalysis':_0x3a4062,'analysisHistory':this[_0x40f33a(0x170)]},_0x475446[_0x40f33a(0x101)]);}else{if(_0x475446[_0x40f33a(0x1cb)]===_0x40f33a(0x1c6)){const _0x4ceb13=await this[_0x40f33a(0x116)](_0x40f33a(0x1d9),_0x40f33a(0x18b)),_0x2a2981=[];if(_0x4ceb13)for(const _0x5b7cec in _0x4ceb13){const _0x40836b=_0x4ceb13[_0x5b7cec],_0x31ab05=(_0x40836b['common']&&typeof _0x40836b[_0x40f33a(0x120)][_0x40f33a(0x14b)]===_0x40f33a(0x1ab)?_0x40836b[_0x40f33a(0x120)]['name']['de']:_0x40836b['common'][_0x40f33a(0x14b)])||_0x40836b['common'][_0x40f33a(0x14b)];_0x2a2981[_0x40f33a(0x16e)]({'id':_0x5b7cec,'name':_0x31ab05});}this['sendTo'](_0x475446['from'],_0x475446[_0x40f33a(0x1cb)],{'success':!![],'enums':_0x2a2981},_0x475446[_0x40f33a(0x101)]);}else{if(_0x475446[_0x40f33a(0x1cb)]===_0x40f33a(0x1b6))try{const _0x6af4b5=await scanForDevices(this,_0x475446[_0x40f33a(0x23a)]||{});this[_0x40f33a(0x171)](_0x475446[_0x40f33a(0x1d8)],_0x475446[_0x40f33a(0x1cb)],{'success':!![],'devices':_0x6af4b5},_0x475446[_0x40f33a(0x101)]);}catch(_0xf62cd5){this['sendTo'](_0x475446[_0x40f33a(0x1d8)],_0x475446['command'],{'success':![],'error':_0xf62cd5[_0x40f33a(0x23a)]},_0x475446['callback']);}else{if(_0x475446['command']===_0x40f33a(0x20d)){const {historyId:_0xc2cb00,rating:_0x5e0fdb,comment:_0x24a786,alertReason:_0x8be51f}=_0x475446[_0x40f33a(0x23a)];_0xc2cb00&&_0x5e0fdb?(await saveFeedback(this,{'timestamp':Date[_0x40f33a(0x16d)](),'historyId':_0xc2cb00,'rating':_0x5e0fdb,'comment':_0x24a786,'alertReason':_0x8be51f}),this[_0x40f33a(0x171)](_0x475446[_0x40f33a(0x1d8)],_0x475446[_0x40f33a(0x1cb)],{'success':!![]},_0x475446[_0x40f33a(0x101)])):this['sendTo'](_0x475446[_0x40f33a(0x1d8)],_0x475446['command'],{'success':![],'error':'Missing\x20data'},_0x475446[_0x40f33a(0x101)]);}else{if(_0x475446[_0x40f33a(0x1cb)]===_0x40f33a(0x242)){const _0x40d449=await getWeatherContext(this),_0x457648=await getCalendarContext(this);this[_0x40f33a(0x171)](_0x475446['from'],_0x475446['command'],{'success':!![],'weather':_0x40d449,'calendar':_0x457648},_0x475446[_0x40f33a(0x101)]);}else{if(_0x475446[_0x40f33a(0x1cb)]===_0x40f33a(0x216)){const _0x11e197=_0x475446[_0x40f33a(0x23a)][_0x40f33a(0x1b7)];if(!_0x11e197)return this['sendTo'](_0x475446[_0x40f33a(0x1d8)],_0x475446[_0x40f33a(0x1cb)],{'success':![],'error':_0x40f33a(0x1b9)},_0x475446['callback']);const _0x374c90=await getCalendarNames(this,_0x11e197);this['sendTo'](_0x475446[_0x40f33a(0x1d8)],_0x475446[_0x40f33a(0x1cb)],{'success':!![],'names':_0x374c90},_0x475446[_0x40f33a(0x101)]);}}}}}}}}}catch(_0x101486){if(_0x475446[_0x40f33a(0x101)])this['sendTo'](_0x475446[_0x40f33a(0x1d8)],_0x475446['command'],{'success':![],'error':_0x101486['message']},_0x475446[_0x40f33a(0x101)]);}}}async function initSensorSubscriptions(_0x57ca37){const _0x2fa70b=a0_0x52b75d,_0x3ccd37=_0x57ca37[_0x2fa70b(0x167)][_0x2fa70b(0x136)];if(_0x3ccd37&&_0x3ccd37[_0x2fa70b(0xff)]>0x0){_0x57ca37[_0x2fa70b(0x139)][_0x2fa70b(0x215)](_0x2fa70b(0x20b)+_0x3ccd37[_0x2fa70b(0xff)]+_0x2fa70b(0x104));for(const _0x2e2e18 of _0x3ccd37){if(_0x2e2e18['id']){await _0x57ca37[_0x2fa70b(0x19c)](_0x2e2e18['id']);try{const _0x3db427=await _0x57ca37[_0x2fa70b(0x13f)](_0x2e2e18['id']);if(_0x3db427)_0x57ca37[_0x2fa70b(0x166)][_0x2e2e18['id']]=_0x3db427[_0x2fa70b(0x1a2)];}catch(_0x429478){}}}}}async function initPresenceSubscriptions(_0x3cd0f9){const _0x3ef140=a0_0x52b75d,_0x40fd2f=_0x3cd0f9[_0x3ef140(0x167)]['presenceDevices']||[];if(_0x40fd2f['length']>0x0){_0x3cd0f9[_0x3ef140(0x139)][_0x3ef140(0x215)](_0x3ef140(0x20b)+_0x40fd2f[_0x3ef140(0xff)]+'\x20presence\x20devices...');for(const _0x5aa335 of _0x40fd2f){await _0x3cd0f9['subscribeForeignStatesAsync'](_0x5aa335);}try{await checkWifiPresence(_0x3cd0f9);}catch(_0x1bec40){}}}if(require[a0_0x52b75d(0x16b)]!==module)module[a0_0x52b75d(0x19f)]=_0x3837c5=>new CogniLiving(_0x3837c5);else new CogniLiving();