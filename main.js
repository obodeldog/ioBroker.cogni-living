const a0_0x419f00=a0_0x6f2a;function a0_0x6f2a(_0x2aa058,_0x136ebb){const _0x13ca31=a0_0x45e5();return a0_0x6f2a=function(_0x485fc9,_0x395e35){_0x485fc9=_0x485fc9-0x11a;let _0x45e5ee=_0x13ca31[_0x485fc9];return _0x45e5ee;},a0_0x6f2a(_0x2aa058,_0x136ebb);}(function(_0x10d67a,_0x8c51bd){const _0x48b891=a0_0x6f2a,_0x5a0e22=_0x10d67a();while(!![]){try{const _0x446a2e=parseInt(_0x48b891(0x1b1))/0x1*(parseInt(_0x48b891(0x19a))/0x2)+parseInt(_0x48b891(0x16d))/0x3+-parseInt(_0x48b891(0x12c))/0x4*(parseInt(_0x48b891(0x1eb))/0x5)+-parseInt(_0x48b891(0x1a5))/0x6*(-parseInt(_0x48b891(0x15d))/0x7)+parseInt(_0x48b891(0x1e6))/0x8*(-parseInt(_0x48b891(0x220))/0x9)+-parseInt(_0x48b891(0x19e))/0xa*(parseInt(_0x48b891(0x13b))/0xb)+parseInt(_0x48b891(0x260))/0xc*(parseInt(_0x48b891(0x204))/0xd);if(_0x446a2e===_0x8c51bd)break;else _0x5a0e22['push'](_0x5a0e22['shift']());}catch(_0x57e622){_0x5a0e22['push'](_0x5a0e22['shift']());}}}(a0_0x45e5,0x7ada8));const a0_0x395e35=(function(){let _0x140d3e=!![];return function(_0x2384e0,_0x579481){const _0x4d02e4=_0x140d3e?function(){if(_0x579481){const _0x55f354=_0x579481['apply'](_0x2384e0,arguments);return _0x579481=null,_0x55f354;}}:function(){};return _0x140d3e=![],_0x4d02e4;};}()),a0_0x485fc9=a0_0x395e35(this,function(){const _0x1086eb=a0_0x6f2a;return a0_0x485fc9['toString']()[_0x1086eb(0x11d)]('(((.+)+)+)+$')[_0x1086eb(0x17c)]()[_0x1086eb(0x213)](a0_0x485fc9)[_0x1086eb(0x11d)](_0x1086eb(0x1b7));});a0_0x485fc9();function a0_0x45e5(){const _0x2fad84=['Alert\x20Reason','.\x20PERSONA:\x20','saveRawEventLog','text','slice','analysis.history_debug_01','string','text.alarm','Analysis\x20Error:\x20','‚ùå\x20Gemini\x20Model\x20not\x20initialized!\x20Check\x20API\x20Key.','now','channel','system.isPresent','1030752KmBLwx','system','name','inactivityMonitoringEnabled','warn','N/A\x20(Pro\x20Feature)','system.meta.uuid','getEnums','response','\x0a!!!\x20EXTERNAL\x20SYSTEM\x20WARNING\x20!!!\x0a','Received\x20scanDevices\x20request\x20from\x20Admin\x20UI.','rating','updateBaselineStatus','dailyDigests','lastAlertState','toString','retry','analysis.comfortSummary','ready','Trigger\x20Analysis','notifyPushoverInstance','callback','createAllObjects','VACATION','üö®\x20Dead\x20Man\x27s\x20Switch:\x20Keine\x20Aktivit√§t\x20seit\x20','generateContent','analysis.automation.suggestedAction','location','processSensorEvent','System\x20Mode','events.history_debug_02','stateChange','2-digit','models/gemini-flash-latest','notifyTelegramRecipient','enum','isProVersion','events.history','Activity\x20Summary','Baseline\x20Status','de-DE','updateAnalysisHistory','Success','sound','Adapter','5858MxfBcc','Last\x20raw\x20event','TEST-PRO-KEY','modeResetJob','3970xIeain','Drift\x20Analysis','sendNotification','currentSystemMode','lastCheck','values','message','6846ItHlDK','runBaselineDriftAnalysis','type','cancel','indicator','Sending\x20Prompt\x20(Length:\x20','loadSystemMode','from','runAutopilot','saveDailyDigests','CRITICAL\x20WARNING:\x20No\x20sensor\x20activity\x20detected\x20for\x20','getForeignObjectAsync','21EFmGRV','createDailyDigest','analysis.history_debug_02','\x20min).\x20Watchdog\x20Limit:\x20','isGracePeriodActive','cleanUpZombies','(((.+)+)+)+$','abortExitTimer','length','PARTY','licenseKey','events.lastEvent','sensorLastValues','activity','common','GUEST','onUnload','\x0aFEEDBACK:\x0a','unshift','setObjectNotExistsAsync','getGenerativeModel','Automation\x20Proposals','uuid-not-found','LTM.baselineStatus','object','üö®üö®\x20NOTFALL','analysis.isEmergency','\x20Stunden!','onStateChange','parse','info','Processing\x20Status','No\x20Key','state','analysis.trigger','Feedback\x20Log','Last\x20Check','LTM.driftAnalysis.driftDetails','splice','\x20hours.\x20The\x20resident\x20might\x20be\x20incapacitated.\x20Risk\x20level:\x20HIGH.','checkLicense','toLowerCase','getObjectAsync','setupModeResetScheduler','min\x20Timer,\x20','map','longitude','toFixed','ü§ñ\x20Starting\x20Gemini\x20Analysis...','events.history_debug_00','cogni-living\x20adapter\x20starting\x20(v','val','command','48056TvZcEq',')...','normal','ROLLE:\x20Data\x20Scientist.\x20VERGLEICHE:\x20Dataset\x20A\x20(Recent)\x20vs\x20B\x20(Established).\x20ZIEL:\x20Erkenne\x20Drift.\x20SCHEMA:\x20{\x20\x22baselineDrift\x22:\x20\x22none|slight|significant|critical\x22,\x20\x22driftDetails\x22:\x20\x22string\x22\x20}\x0a\x0aB\x20(LTB):\x0a','analysis.lastResult','445lLXCTG','checkLtmObjects','0\x203\x20*\x20*\x20*','extendObjectAsync','submitFeedback','@google/generative-ai','\x0a\x0aA\x20(STB):\x0a','Skipped\x20(No\x20AI\x20or\x20Data)','Logbook','analysis.isAlert','analysis.automation.description','Urlaub','PRIORIT√ÑT:\x20Gesundheit\x20und\x20Sicherheit\x20f√ºr\x20Senioren\x20(AAL).\x20Erkenne\x20Inaktivit√§t,\x20potenzielle\x20St√ºrze\x20(indirekt),\x20ungew√∂hnliche\x20n√§chtliche\x20Aktivit√§t.','N/A','date','ltmLtbWindowDays','Loaded\x20','Analysiere\x20ausgewogen\x20auf\x20Gesundheit,\x20Sicherheit\x20und\x20Komfort.','isAlert','analysis.history_debug_04','Success:\x20Compressed\x20','boolean','getLtmData','ROLLE:\x20Compression\x20Agent.\x20SPRACHE:\x20DE.\x20FORMAT:\x20JSON.\x20KONTEXT:\x20','Event\x20History','1469BbDAqg','NORMAL','User\x20Feedback:\x20Alarm\x20\x22','Konnte\x20System-Standort\x20nicht\x20laden.','[TEST]\x20','Sending\x20notification:\x20\x22','main','number','startsWith','scanDevices','city','saveFeedback','sendTo','button','\x20events\x20from\x20history.','constructor','notifyPushoverEnabled','subscribeForeignStatesAsync','json','Fokus\x20auf\x20Maximierung\x20von\x20Komfort,\x20Automatisierungseffizienz\x20und\x20Energieeinsparung.','system.mode','events.history_debug_03','checkLtmDriftObjects','.\x20\x0a\x20\x20\x20\x20\x20\x20\x20\x20KONTEXT:\x20','alertReason','long','guest','rawEventLog','990OxTuBS','0\x204\x20*\x20*\x20*','checkSystemObjects','trim','vacation','loadRawEventLog','üìç\x20Standort\x20geladen:\x20','notifySignalInstance','notifyEmailEnabled','System\x20Status\x20&\x20Control','ack','notifyWhatsappInstance','getSystemUUID','runGeminiAnalysis','config','Daily\x20Digests','driftDetails','analysis.deviationFromBaseline','scanForDevices','üö®\x20EMERGENCY','application/json','setState','Presence\x20Status','geminiApiKey','analysis.analysisHistory','expire','summary','isPresent','error','Gast','ROLLE:\x20Smart\x20Home\x20Analyst.\x20SPRACHE:\x20DE.\x20FORMAT:\x20JSON.\x20\x0a\x20\x20\x20\x20\x20\x20\x20\x20AKTUELLE\x20ZEIT:\x20','[Test]\x20Notification','system.config','Raw\x20Log','analysis.automation','No\x20recent\x20activity.','geminiModel','toISOString','notifyEmailRecipient','push','genAI','setStateAsync','Last\x20Result','getStateAsync','Error:\x20','LTM.driftAnalysis.lastCheck','ABWESEND\x20‚úàÔ∏è','exitGraceTimer','devices','Gemini\x20API\x20Key\x20missing.\x20AI\x20features\x20disabled.','notifyTelegramEnabled','indicator.alarm.fire','scheduleJob','party','Bewegung\x20w√§hrend\x20Exit-Timer\x20erkannt\x20->\x20Bewohner\x20ist\x20noch\x20da.','@iobroker/adapter-core','send','Starting\x20Autopilot\x20(','enum.functions.*','LTM','eventHistory','\x20Tage)','apiKey','bind','56424ivmiMx','\x20(EMERGENCY)','setPresence','exitTimer','exports','sendToAsync','debug','version','siren','Manual\x20Analysis\x20Trigger\x20detected!','\x22\x20was\x20','LTM.driftAnalysis.baselineDrift','notifyWhatsappRecipient','baselineDrift','join','analysisTimer','Lernphase\x20(','search','setupLtmScheduler','analysis.activitySummary','onReady','triggerDailyDigest','.\x0a\x20\x20\x20\x20\x20\x20\x20\x20MODUS:\x20','Missing\x20data','replace','Comfort\x20Summary','cogni-living','livingContext','LTM.dailyDigests','startExitTimer','Party','onMessage','12292ooUWWo','minDaysForBaseline','test','Pattern\x20Detected','\x20sent','analysis.automation.patternDetected','analysis.history_debug_03','\x20sensors...','ltmJob','LTM.driftAnalysis','testNotification','flur','‚úÖ\x20Gemini\x20Response\x20received.','Exit\x20Grace\x20Period\x20beendet.\x20√úberwache\x20nun\x20Innenraum...','catch','7678mYcpRd','LTM.triggerDailyDigest','subscribeStates','systemConfig','generic','Baseline:\x20Inactive\x20(Pro\x20Feature).','notifyWhatsappEnabled','pop','inactivityThresholdHours','stringify','notifyEmailInstance','systemUUID','Trigger\x20Digest','Cogni-Living\x20Alert','.\x0a\x20\x20\x20\x20\x20\x20\x20\x20','includes','events.history_debug_04','unknown','log','loadDailyDigests','logDuplicates','toLocaleString','Subscribing\x20to\x20','.\x20PR√ÑSENZ:\x20','getForeignObjectsAsync','native','AI\x20Alert\x20Status','analysis.alertReason','analysisHistory','Deaktiviert\x20(Pro-Feature)','getForeignStateAsync','timestamp','feedbackHistory','Drift\x20Status','4774LXmHgn','notifySignalRecipient','driftAnalysisTimer'];a0_0x45e5=function(){return _0x2fad84;};return a0_0x45e5();}'use strict';const utils=require(a0_0x419f00(0x257)),{GoogleGenerativeAI}=require(a0_0x419f00(0x1f0)),schedule=require('node-schedule'),HISTORY_MAX_SIZE=0x32,FEEDBACK_MAX_SIZE=0x14,GEMINI_MODEL=a0_0x419f00(0x18e),ANALYSIS_HISTORY_MAX_SIZE=0x64,RAW_LOG_MAX_SIZE=0x5dc,DAILY_DIGEST_MAX_SIZE_LIMIT=0xb4,LTM_MIN_EVENTS_FOR_COMPRESSION=0x5,LTM_SCHEDULE=a0_0x419f00(0x1ed),LTM_DP_RAW_LOG='LTM.rawEventLog',LTM_DP_DAILY_DIGESTS=a0_0x419f00(0x128),LTM_DP_STATUS='LTM.processingStatus',LTM_DP_TRIGGER_DIGEST=a0_0x419f00(0x13c),LTM_DP_BASELINE_STATUS=a0_0x419f00(0x1c8),LTM_DP_DRIFT_CHANNEL=a0_0x419f00(0x135),LTM_DP_DRIFT_STATUS=a0_0x419f00(0x26b),LTM_DP_DRIFT_DETAILS=a0_0x419f00(0x1d6),LTM_DP_DRIFT_LAST_CHECK=a0_0x419f00(0x24d),SYSTEM_DP_MODE=a0_0x419f00(0x218),MODE_RESET_SCHEDULE=a0_0x419f00(0x221),SYSTEM_MODES={'NORMAL':a0_0x419f00(0x1e8),'VACATION':a0_0x419f00(0x224),'PARTY':a0_0x419f00(0x255),'GUEST':a0_0x419f00(0x21e)},AUTO_RESET_MODES=[SYSTEM_MODES[a0_0x419f00(0x1ba)],SYSTEM_MODES[a0_0x419f00(0x1c0)]],EXIT_TIMER_MINUTES=0xf,EXIT_GRACE_PERIOD_SECONDS=0x1e,PERSONA_MAPPING={'generic':a0_0x419f00(0x1fc),'senior_aal':a0_0x419f00(0x1f7),'family':'Fokus\x20auf\x20Familienroutinen,\x20Kindersicherheit\x20und\x20allgemeines\x20Haushaltsmanagement.','single_comfort':a0_0x419f00(0x217),'security':'PRIORIT√ÑT:\x20Sicherheit.\x20Erkenne\x20Eindringlinge,\x20ungew√∂hnliche\x20Anwesenheit.'};class CogniLiving extends utils[a0_0x419f00(0x199)]{constructor(_0x430233){const _0x5cccfb=a0_0x419f00;super({..._0x430233,'name':_0x5cccfb(0x126)}),this[_0x5cccfb(0x25c)]=[],this[_0x5cccfb(0x157)]=[],this[_0x5cccfb(0x15b)]=[],this[_0x5cccfb(0x21f)]=[],this[_0x5cccfb(0x17a)]=[],this['sensorLastValues']={},this[_0x5cccfb(0x13e)]={'latitude':0x0,'longitude':0x0,'city':''},this[_0x5cccfb(0x23b)]=!![],this['exitTimer']=null,this[_0x5cccfb(0x24f)]=null,this['isGracePeriodActive']=![],this['genAI']=null,this['geminiModel']=null,this[_0x5cccfb(0x1a1)]=SYSTEM_MODES[_0x5cccfb(0x205)],this[_0x5cccfb(0x191)]=![],this[_0x5cccfb(0x17b)]=![],this[_0x5cccfb(0x146)]=_0x5cccfb(0x14c),this[_0x5cccfb(0x11b)]=null,this['ltmJob']=null,this[_0x5cccfb(0x19d)]=null,this[_0x5cccfb(0x15f)]=null,this['on'](_0x5cccfb(0x17f),this['onReady']['bind'](this)),this['on'](_0x5cccfb(0x18c),this[_0x5cccfb(0x1cd)][_0x5cccfb(0x25f)](this)),this['on']('unload',this[_0x5cccfb(0x1c1)][_0x5cccfb(0x25f)](this)),this['on']('message',this[_0x5cccfb(0x12b)][_0x5cccfb(0x25f)](this));}async[a0_0x419f00(0x120)](){const _0xbac440=a0_0x419f00;this[_0xbac440(0x14d)]['info'](_0xbac440(0x1e3)+this[_0xbac440(0x267)]+')\x20-\x20DEBUG\x20MODE\x20ENABLED'),await this['cleanUpZombies'](),this['config'][_0xbac440(0x1bb)]=this[_0xbac440(0x22e)][_0xbac440(0x1bb)]||'',this[_0xbac440(0x191)]=await this[_0xbac440(0x1d9)](this[_0xbac440(0x22e)][_0xbac440(0x1bb)]);if(!this['config'][_0xbac440(0x143)]||this[_0xbac440(0x22e)][_0xbac440(0x143)]<0.1)this['config']['inactivityThresholdHours']=0xc;await this['loadHistoryFromState']();try{const _0x166778=await this['getForeignObjectAsync'](_0xbac440(0x240));_0x166778&&_0x166778['common']&&(this[_0xbac440(0x13e)]={'latitude':_0x166778['common']['latitude']||0x0,'longitude':_0x166778[_0xbac440(0x1bf)][_0xbac440(0x1df)]||0x0,'city':_0x166778[_0xbac440(0x1bf)][_0xbac440(0x20e)]||''},this[_0xbac440(0x14d)]['info'](_0xbac440(0x226)+this[_0xbac440(0x13e)][_0xbac440(0x20e)]));}catch(_0x47acdb){this[_0xbac440(0x14d)][_0xbac440(0x171)](_0xbac440(0x207));}if(this[_0xbac440(0x22e)][_0xbac440(0x237)])try{this[_0xbac440(0x248)]=new GoogleGenerativeAI(this[_0xbac440(0x22e)][_0xbac440(0x237)]),this[_0xbac440(0x244)]=this['genAI'][_0xbac440(0x1c5)]({'model':GEMINI_MODEL,'generationConfig':{'responseMimeType':_0xbac440(0x234)}}),this[_0xbac440(0x14d)][_0xbac440(0x1cf)]('Gemini\x20AI\x20initialized.');}catch(_0x5dd080){this['log'][_0xbac440(0x23c)]('Gemini\x20Init\x20Error:\x20'+_0x5dd080['message']);}else this[_0xbac440(0x14d)]['warn'](_0xbac440(0x251));await this[_0xbac440(0x183)](),await this[_0xbac440(0x1ab)](),await this[_0xbac440(0x225)](),await this[_0xbac440(0x14e)](),this[_0xbac440(0x13d)](_0xbac440(0x1d3)),this[_0xbac440(0x13d)](LTM_DP_TRIGGER_DIGEST),this[_0xbac440(0x13d)](_0xbac440(0x218));const _0x103fdd=this['config'][_0xbac440(0x250)];if(_0x103fdd&&_0x103fdd[_0xbac440(0x1b9)]>0x0){this['log'][_0xbac440(0x1cf)](_0xbac440(0x151)+_0x103fdd[_0xbac440(0x1b9)]+_0xbac440(0x133));for(const _0x3b9847 of _0x103fdd){if(_0x3b9847['id']){await this[_0xbac440(0x215)](_0x3b9847['id']);try{const _0x5bf93d=await this[_0xbac440(0x159)](_0x3b9847['id']);if(_0x5bf93d)this['sensorLastValues'][_0x3b9847['id']]=_0x5bf93d[_0xbac440(0x1e4)];}catch(_0x4fe1c7){}}}}if(this[_0xbac440(0x11b)])clearInterval(this[_0xbac440(0x11b)]);const _0x509bfe=this[_0xbac440(0x22e)]['analysisInterval']||0xf;_0x509bfe>0x0&&(this['log'][_0xbac440(0x1cf)](_0xbac440(0x259)+_0x509bfe+_0xbac440(0x1b4)+this['config'][_0xbac440(0x143)]+'h.'),this[_0xbac440(0x11b)]=setInterval(()=>this['runAutopilot'](),_0x509bfe*0x3c*0x3e8)),this[_0xbac440(0x11e)](),this[_0xbac440(0x1dc)](),this['setupDriftAnalysisScheduler']();}async[a0_0x419f00(0x1b6)](){const _0x10ad0b=a0_0x419f00,_0x5a82b4=['analysis.history_debug_00',_0x10ad0b(0x165),_0x10ad0b(0x1b3),_0x10ad0b(0x132),_0x10ad0b(0x1fe),_0x10ad0b(0x1e2),'events.history_debug_01',_0x10ad0b(0x18b),_0x10ad0b(0x219),_0x10ad0b(0x14b)];for(const _0x342458 of _0x5a82b4){try{const _0x5d71b6=await this[_0x10ad0b(0x1db)](_0x342458);_0x5d71b6&&await this['delObjectAsync'](_0x342458);}catch(_0x4ad106){}}}async['loadHistoryFromState'](){const _0x4defed=a0_0x419f00;try{const _0x26bab0=await this['getStateAsync'](_0x4defed(0x192));_0x26bab0&&_0x26bab0[_0x4defed(0x1e4)]&&(this['eventHistory']=JSON[_0x4defed(0x1ce)](_0x26bab0[_0x4defed(0x1e4)][_0x4defed(0x17c)]()),this[_0x4defed(0x14d)][_0x4defed(0x1cf)](_0x4defed(0x1fb)+this['eventHistory'][_0x4defed(0x1b9)]+_0x4defed(0x212)));}catch(_0x286146){this[_0x4defed(0x25c)]=[];}try{const _0x55b2be=await this[_0x4defed(0x24b)]('analysis.analysisHistory');if(_0x55b2be&&_0x55b2be['val'])this['analysisHistory']=JSON[_0x4defed(0x1ce)](_0x55b2be[_0x4defed(0x1e4)][_0x4defed(0x17c)]());}catch(_0x3dcb4c){this['analysisHistory']=[];}}[a0_0x419f00(0x1cd)](_0x5315e2,_0x2376ad){const _0x3101e6=a0_0x419f00;if(!_0x2376ad)return;if(_0x5315e2===this['namespace']+'.'+SYSTEM_DP_MODE){_0x2376ad[_0x3101e6(0x1e4)]&&Object[_0x3101e6(0x1a3)](SYSTEM_MODES)['includes'](_0x2376ad['val'])&&(this['currentSystemMode']=_0x2376ad[_0x3101e6(0x1e4)],_0x2376ad['val']===SYSTEM_MODES['VACATION']?this[_0x3101e6(0x262)](![]):this['setPresence'](!![]));if(!_0x2376ad[_0x3101e6(0x22a)])this[_0x3101e6(0x235)](_0x5315e2,{'val':this[_0x3101e6(0x1a1)],'ack':!![]});return;}if(!_0x2376ad[_0x3101e6(0x22a)]){_0x5315e2['includes'](_0x3101e6(0x1d3))&&_0x2376ad['val']&&(this['log'][_0x3101e6(0x1cf)](_0x3101e6(0x269)),this['setState'](_0x5315e2,{'val':![],'ack':!![]}),this['runGeminiAnalysis']());if(_0x5315e2['includes'](_0x3101e6(0x121))&&_0x2376ad[_0x3101e6(0x1e4)]){this[_0x3101e6(0x235)](_0x5315e2,{'val':![],'ack':!![]});if(this[_0x3101e6(0x191)])this[_0x3101e6(0x1b2)]();}return;}const _0x241989=(this[_0x3101e6(0x22e)][_0x3101e6(0x250)]||[])['find'](_0x19c40b=>_0x19c40b['id']===_0x5315e2);if(_0x241989)this[_0x3101e6(0x189)](_0x5315e2,_0x2376ad,_0x241989);}async[a0_0x419f00(0x189)](_0x13dd35,_0x147ab1,_0x2e41a3){const _0x3da762=a0_0x419f00;if(!_0x2e41a3[_0x3da762(0x14f)]&&this[_0x3da762(0x1bd)][_0x13dd35]===_0x147ab1['val'])return;this[_0x3da762(0x1bd)][_0x13dd35]=_0x147ab1['val'];if(this[_0x3da762(0x1b5)]){this[_0x3da762(0x14d)][_0x3da762(0x266)]('Ignoring\x20event\x20during\x20Exit\x20Grace\x20Period:\x20'+_0x2e41a3[_0x3da762(0x16f)]);return;}const _0x1c6d09=_0x2e41a3[_0x3da762(0x1a7)]==='Fenster/T√ºr'&&(_0x2e41a3[_0x3da762(0x16f)][_0x3da762(0x1da)]()['includes']('haust√ºr')||_0x2e41a3[_0x3da762(0x16f)][_0x3da762(0x1da)]()['includes']('eingang')||_0x2e41a3[_0x3da762(0x188)][_0x3da762(0x1da)]()[_0x3da762(0x14a)](_0x3da762(0x137)));_0x1c6d09&&!_0x147ab1[_0x3da762(0x1e4)]?this[_0x3da762(0x129)]():(this[_0x3da762(0x263)]&&(this[_0x3da762(0x14d)][_0x3da762(0x1cf)](_0x3da762(0x256)),this[_0x3da762(0x1b8)]()),!this[_0x3da762(0x23b)]&&this[_0x3da762(0x1a1)]===SYSTEM_MODES['NORMAL']&&this['setPresence'](!![]));const _0x188945={'timestamp':_0x147ab1['ts'],'id':_0x13dd35,'name':_0x2e41a3[_0x3da762(0x16f)],'value':_0x147ab1[_0x3da762(0x1e4)],'location':_0x2e41a3[_0x3da762(0x188)],'type':_0x2e41a3[_0x3da762(0x1a7)]};this[_0x3da762(0x25c)][_0x3da762(0x1c3)](_0x188945);if(this[_0x3da762(0x25c)][_0x3da762(0x1b9)]>HISTORY_MAX_SIZE)this[_0x3da762(0x25c)][_0x3da762(0x142)]();await this[_0x3da762(0x249)]('events.lastEvent',{'val':JSON[_0x3da762(0x144)](_0x188945),'ack':!![]}),await this[_0x3da762(0x249)](_0x3da762(0x192),{'val':JSON[_0x3da762(0x144)](this[_0x3da762(0x25c)]),'ack':!![]}),this['rawEventLog'][_0x3da762(0x247)]({'timestamp':new Date(_0x147ab1['ts'])[_0x3da762(0x245)](),'sensorName':_0x2e41a3[_0x3da762(0x16f)],'location':_0x2e41a3['location'],'value':_0x147ab1[_0x3da762(0x1e4)]}),await this[_0x3da762(0x162)]();}[a0_0x419f00(0x129)](){const _0x59c7e8=a0_0x419f00;this[_0x59c7e8(0x14d)][_0x59c7e8(0x1cf)]('Haust√ºr\x20Event:\x20Starte\x20Exit-Logik\x20('+EXIT_TIMER_MINUTES+_0x59c7e8(0x1dd)+EXIT_GRACE_PERIOD_SECONDS+'s\x20Grace).'),this[_0x59c7e8(0x1b8)](),this[_0x59c7e8(0x1b5)]=!![],this[_0x59c7e8(0x24f)]=setTimeout(()=>{const _0xaff961=_0x59c7e8;this[_0xaff961(0x1b5)]=![],this[_0xaff961(0x14d)][_0xaff961(0x266)](_0xaff961(0x139));},EXIT_GRACE_PERIOD_SECONDS*0x3e8),this[_0x59c7e8(0x263)]=setTimeout(()=>{const _0x27060b=_0x59c7e8;this[_0x27060b(0x14d)][_0x27060b(0x1cf)]('Exit-Timer\x20abgelaufen:\x20Keine\x20Bewegung\x20innen\x20erkannt\x20->\x20ABWESEND.'),this[_0x27060b(0x262)](![]),this[_0x27060b(0x263)]=null;},EXIT_TIMER_MINUTES*0x3c*0x3e8);}[a0_0x419f00(0x1b8)](){const _0x3f9095=a0_0x419f00;if(this[_0x3f9095(0x263)])clearTimeout(this['exitTimer']);if(this[_0x3f9095(0x24f)])clearTimeout(this[_0x3f9095(0x24f)]);this[_0x3f9095(0x263)]=null,this[_0x3f9095(0x24f)]=null,this[_0x3f9095(0x1b5)]=![];}async[a0_0x419f00(0x262)](_0x4ddc0d){const _0x1f4c10=a0_0x419f00;if(this[_0x1f4c10(0x23b)]===_0x4ddc0d)return;this[_0x1f4c10(0x23b)]=_0x4ddc0d,await this['setStateAsync']('system.isPresent',{'val':_0x4ddc0d,'ack':!![]}),this['log']['info']('Pr√§senz-Status\x20ge√§ndert:\x20'+(_0x4ddc0d?'ANWESEND\x20üè†':_0x1f4c10(0x24e)));}[a0_0x419f00(0x1ad)](){const _0x4ac58d=a0_0x419f00,_0x2b2ef8=this[_0x4ac58d(0x22e)][_0x4ac58d(0x143)],_0x3d7596=this[_0x4ac58d(0x22e)][_0x4ac58d(0x170)],_0x8a5a43=this[_0x4ac58d(0x25c)][_0x4ac58d(0x1b9)]>0x0?this[_0x4ac58d(0x25c)][0x0][_0x4ac58d(0x15a)]:Date[_0x4ac58d(0x16a)](),_0xf9985a=(Date['now']()-_0x8a5a43)/(0x3e8*0x3c*0x3c);let _0x33f907='';_0x3d7596&&this['currentSystemMode']===SYSTEM_MODES['NORMAL']&&this[_0x4ac58d(0x23b)]&&(_0xf9985a>_0x2b2ef8&&(this[_0x4ac58d(0x14d)][_0x4ac58d(0x171)](_0x4ac58d(0x185)+_0xf9985a[_0x4ac58d(0x1e0)](0x1)+_0x4ac58d(0x1cc)),_0x33f907=_0x4ac58d(0x1af)+_0xf9985a['toFixed'](0x1)+_0x4ac58d(0x1d8)));if(_0x33f907){this[_0x4ac58d(0x22d)](_0x33f907)[_0x4ac58d(0x13a)](_0x31387c=>this[_0x4ac58d(0x14d)][_0x4ac58d(0x23c)](_0x31387c));return;}const _0x10e3e3=Date[_0x4ac58d(0x16a)](),_0x6c41b5=_0x10e3e3-_0x8a5a43,_0x16ab95=(this[_0x4ac58d(0x22e)]['analysisInterval']||0xf)*0x3c*0x3e8;this[_0x4ac58d(0x25c)][_0x4ac58d(0x1b9)]>0x0&&_0x6c41b5<=_0x16ab95?this[_0x4ac58d(0x22d)]()[_0x4ac58d(0x13a)](_0x4ea7b3=>this[_0x4ac58d(0x14d)][_0x4ac58d(0x23c)](_0x4ea7b3)):!this[_0x4ac58d(0x17b)]&&(this[_0x4ac58d(0x235)](_0x4ac58d(0x1f4),{'val':![],'ack':!![]}),this['setState']('analysis.isEmergency',{'val':![],'ack':!![]}));}async[a0_0x419f00(0x22d)](_0x17fc60=''){const _0x3344b8=a0_0x419f00;this[_0x3344b8(0x14d)][_0x3344b8(0x1cf)](_0x3344b8(0x1e1));if(!this['geminiModel']){this[_0x3344b8(0x14d)][_0x3344b8(0x23c)](_0x3344b8(0x169));return;}const _0x1a6b41=this[_0x3344b8(0x25c)][_0x3344b8(0x1b9)]>0x0?this[_0x3344b8(0x25c)]:[{'note':'No\x20recorded\x20events\x20yet.'}],_0x3a5493=PERSONA_MAPPING[this[_0x3344b8(0x22e)]['aiPersona']||_0x3344b8(0x13f)],_0xbd89ba=this[_0x3344b8(0x22e)]['livingContext']||'',_0x5ce151=this['currentSystemMode'],_0xb469a7=new Date(),_0x454a0b=_0xb469a7[_0x3344b8(0x150)](_0x3344b8(0x195),{'weekday':_0x3344b8(0x21d),'hour':_0x3344b8(0x18d),'minute':_0x3344b8(0x18d)}),_0x40b76d=this[_0x3344b8(0x13e)];let _0x2c6b31='';if(this[_0x3344b8(0x15b)][_0x3344b8(0x1b9)]>0x0){const _0x1f1c35=this[_0x3344b8(0x15b)]['slice'](0x0,0x3)[_0x3344b8(0x1de)](_0x1f49b5=>_0x3344b8(0x206)+_0x1f49b5[_0x3344b8(0x21c)]+_0x3344b8(0x26a)+_0x1f49b5[_0x3344b8(0x178)]+'.')[_0x3344b8(0x11a)]('\x0a');_0x2c6b31=_0x3344b8(0x1c2)+_0x1f1c35+'\x0a';}const _0x1493a5=_0x17fc60?_0x3344b8(0x176)+_0x17fc60+'\x0a!!!\x20END\x20WARNING\x20!!!\x0a':'',_0x362499=_0x3344b8(0x140),_0x401702=_0x3344b8(0x23e)+_0x454a0b+'.\x20ORT:\x20'+_0x40b76d[_0x3344b8(0x20e)]+_0x3344b8(0x122)+_0x5ce151+_0x3344b8(0x152)+(this['isPresent']?'Ja':'Nein')+_0x3344b8(0x21b)+_0xbd89ba+_0x3344b8(0x161)+_0x3a5493+_0x3344b8(0x149)+_0x362499+'\x20'+_0x2c6b31+'\x20'+_0x1493a5+'\x0a\x20\x20\x20\x20\x20\x20\x20\x20EVENTS:\x20'+JSON[_0x3344b8(0x144)](_0x1a6b41)+'\x20\x0a\x20\x20\x20\x20\x20\x20\x20\x20SCHEMA:\x20{\x20\x22activity\x22:\x20{\x20\x22summary\x22:\x20\x22string\x22,\x20\x22deviationFromBaseline\x22:\x20\x22string\x22,\x20\x22isAlert\x22:\x20bool,\x20\x22isEmergency\x22:\x20bool,\x20\x22alertReason\x22:\x20\x22string\x22\x20},\x20\x22comfort\x22:\x20{\x20\x22summary\x22:\x20\x22string\x22,\x20\x22suggestion\x22:\x20\x22string\x22,\x20\x22automationProposal\x22:\x20{\x20\x22patternDetected\x22:\x20bool,\x20\x22description\x22:\x20\x22string\x22,\x20\x22suggestedAction\x22:\x20\x22string\x22\x20}\x20}\x20}';try{this['log']['debug'](_0x3344b8(0x1aa)+_0x401702[_0x3344b8(0x1b9)]+_0x3344b8(0x1e7));const _0x262bb2=await this[_0x3344b8(0x244)][_0x3344b8(0x186)](_0x401702),_0x4f1f27=_0x262bb2[_0x3344b8(0x175)][_0x3344b8(0x163)]()[_0x3344b8(0x124)](/```json|```/g,'')[_0x3344b8(0x223)]();this[_0x3344b8(0x14d)][_0x3344b8(0x1cf)](_0x3344b8(0x138));const _0x1c673d=JSON['parse'](_0x4f1f27);await this['setStateAsync'](_0x3344b8(0x1ea),{'val':_0x4f1f27,'ack':!![]}),await this['setStateAsync']('analysis.alertReason',{'val':_0x1c673d[_0x3344b8(0x1be)][_0x3344b8(0x21c)]||'','ack':!![]}),await this[_0x3344b8(0x249)](_0x3344b8(0x11f),{'val':_0x1c673d[_0x3344b8(0x1be)]['summary']||_0x3344b8(0x1f8),'ack':!![]});const _0x5b0614=_0x1c673d[_0x3344b8(0x1be)][_0x3344b8(0x1fd)]||![],_0x30dbb6=_0x1c673d['activity']['isEmergency']||![];if(_0x5b0614||_0x30dbb6){await this[_0x3344b8(0x249)](_0x3344b8(0x1f4),{'val':!![],'ack':!![]}),await this[_0x3344b8(0x249)](_0x3344b8(0x1cb),{'val':_0x30dbb6,'ack':!![]});if(!this[_0x3344b8(0x17b)]||_0x30dbb6){const _0x2d87c0=_0x30dbb6?_0x3344b8(0x1ca):'‚ö†Ô∏è\x20Alarm';this[_0x3344b8(0x1a0)](_0x2d87c0+':\x20'+_0x1c673d[_0x3344b8(0x1be)][_0x3344b8(0x21c)],![],_0x30dbb6);}}else await this[_0x3344b8(0x249)](_0x3344b8(0x1f4),{'val':![],'ack':!![]}),await this['setStateAsync']('analysis.isEmergency',{'val':![],'ack':!![]});this['lastAlertState']=_0x5b0614||_0x30dbb6;const _0x34160e={'timestamp':Date[_0x3344b8(0x16a)](),'id':Date[_0x3344b8(0x16a)]()[_0x3344b8(0x17c)](),'analysis':_0x1c673d,'systemMode':_0x5ce151,'isPro':this[_0x3344b8(0x191)]};this[_0x3344b8(0x196)](_0x34160e);}catch(_0x2876d4){this[_0x3344b8(0x14d)][_0x3344b8(0x23c)](_0x3344b8(0x168)+_0x2876d4[_0x3344b8(0x1a4)]);}}async[a0_0x419f00(0x1b2)](){const _0x37c072=a0_0x419f00;if(!this[_0x37c072(0x191)])return;await this['setStateAsync'](LTM_DP_STATUS,{'val':'Started\x20at\x20'+new Date()[_0x37c072(0x150)](),'ack':!![]});if(!this[_0x37c072(0x244)]||this[_0x37c072(0x21f)][_0x37c072(0x1b9)]<LTM_MIN_EVENTS_FOR_COMPRESSION){await this[_0x37c072(0x249)](LTM_DP_STATUS,{'val':_0x37c072(0x1f2),'ack':!![]});return;}const _0x54a052=JSON[_0x37c072(0x1ce)](JSON['stringify'](this['rawEventLog'])),_0x1e6dd1=(this['config'][_0x37c072(0x127)]||'')['substring'](0x0,0x3e8),_0x78f1cb=_0x37c072(0x202)+_0x1e6dd1+'.\x20ANWEISUNG:\x20Fasse\x20Sensor-Events\x20zusammen.\x20SCHEMA:\x20{\x20\x22summary\x22:\x20\x22string\x22,\x20\x22activityLevel\x22:\x20\x22string\x22\x20}\x20\x0a\x0aEVENTS:\x0a'+JSON[_0x37c072(0x144)](_0x54a052);try{const _0x2ec311=await this[_0x37c072(0x244)][_0x37c072(0x186)](_0x78f1cb),_0x549f15=JSON['parse'](_0x2ec311[_0x37c072(0x175)]['text']()[_0x37c072(0x124)](/```json|```/g,'')[_0x37c072(0x223)]());_0x549f15[_0x37c072(0x23a)]&&(this[_0x37c072(0x17a)][_0x37c072(0x247)]({'timestamp':new Date()[_0x37c072(0x245)](),'eventCount':_0x54a052[_0x37c072(0x1b9)],'summary':_0x549f15['summary'],'activityLevel':_0x549f15['activityLevel'],'systemMode':this[_0x37c072(0x1a1)]}),await this[_0x37c072(0x1ae)](),this[_0x37c072(0x21f)]=[],await this['saveRawEventLog'](),await this[_0x37c072(0x249)](LTM_DP_STATUS,{'val':_0x37c072(0x1ff)+_0x54a052[_0x37c072(0x1b9)]+'\x20events','ack':!![]}));}catch(_0x3b46f7){await this[_0x37c072(0x249)](LTM_DP_STATUS,{'val':_0x37c072(0x24c)+_0x3b46f7[_0x37c072(0x1a4)],'ack':!![]});}}async[a0_0x419f00(0x183)](){const _0x577ca0=a0_0x419f00;await this['checkSystemObjects'](),await this['setObjectNotExistsAsync'](_0x577ca0(0x16c),{'type':'state','common':{'name':_0x577ca0(0x236),'type':_0x577ca0(0x200),'role':'indicator','read':!![],'write':![],'def':!![]},'native':{}}),await this['setObjectNotExistsAsync'](_0x577ca0(0x1bc),{'type':_0x577ca0(0x1d2),'common':{'name':_0x577ca0(0x19b),'type':'string','role':_0x577ca0(0x216),'read':!![],'write':![]},'native':{}}),await this[_0x577ca0(0x1c4)](_0x577ca0(0x192),{'type':_0x577ca0(0x1d2),'common':{'name':_0x577ca0(0x203),'type':_0x577ca0(0x166),'role':_0x577ca0(0x216),'read':!![],'write':![]},'native':{}}),await this[_0x577ca0(0x1c4)](_0x577ca0(0x1d3),{'type':_0x577ca0(0x1d2),'common':{'name':_0x577ca0(0x180),'type':_0x577ca0(0x200),'role':_0x577ca0(0x211),'read':!![],'write':!![],'def':![]},'native':{}}),await this[_0x577ca0(0x1c4)](_0x577ca0(0x1ea),{'type':'state','common':{'name':_0x577ca0(0x24a),'type':_0x577ca0(0x166),'role':'json','read':!![],'write':![]},'native':{}}),await this[_0x577ca0(0x1c4)](_0x577ca0(0x1f4),{'type':_0x577ca0(0x1d2),'common':{'name':_0x577ca0(0x155),'type':_0x577ca0(0x200),'role':'indicator.alarm','read':!![],'write':![],'def':![]},'native':{}}),await this[_0x577ca0(0x1c4)](_0x577ca0(0x1cb),{'type':_0x577ca0(0x1d2),'common':{'name':'AI\x20Emergency\x20Status','type':_0x577ca0(0x200),'role':_0x577ca0(0x253),'read':!![],'write':![],'def':![]},'native':{}}),await this[_0x577ca0(0x1c4)](_0x577ca0(0x156),{'type':'state','common':{'name':_0x577ca0(0x160),'type':_0x577ca0(0x166),'role':_0x577ca0(0x167),'read':!![],'write':![]},'native':{}}),await this[_0x577ca0(0x1c4)](_0x577ca0(0x11f),{'type':'state','common':{'name':_0x577ca0(0x193),'type':_0x577ca0(0x166),'role':_0x577ca0(0x163),'read':!![],'write':![]},'native':{}}),await this[_0x577ca0(0x1c4)](_0x577ca0(0x231),{'type':_0x577ca0(0x1d2),'common':{'name':'Deviation','type':'string','role':_0x577ca0(0x1d2),'read':!![],'write':![],'def':_0x577ca0(0x1f8)},'native':{}}),await this[_0x577ca0(0x1c4)](_0x577ca0(0x17e),{'type':_0x577ca0(0x1d2),'common':{'name':_0x577ca0(0x125),'type':_0x577ca0(0x166),'role':'text','read':!![],'write':![]},'native':{}}),await this[_0x577ca0(0x1c4)]('analysis.comfortSuggestion',{'type':'state','common':{'name':'Comfort\x20Suggestion','type':_0x577ca0(0x166),'role':_0x577ca0(0x163),'read':!![],'write':![]},'native':{}}),await this['extendObjectAsync'](_0x577ca0(0x242),{'type':_0x577ca0(0x16b),'common':{'name':_0x577ca0(0x1c6)},'native':{}}),await this['setObjectNotExistsAsync'](_0x577ca0(0x131),{'type':'state','common':{'name':_0x577ca0(0x12f),'type':'boolean','role':_0x577ca0(0x1a9),'read':!![],'write':![],'def':![]},'native':{}}),await this[_0x577ca0(0x1c4)](_0x577ca0(0x1f5),{'type':_0x577ca0(0x1d2),'common':{'name':'Description','type':'string','role':_0x577ca0(0x163),'read':!![],'write':![]},'native':{}}),await this[_0x577ca0(0x1c4)](_0x577ca0(0x187),{'type':_0x577ca0(0x1d2),'common':{'name':'Action','type':'string','role':_0x577ca0(0x163),'read':!![],'write':![]},'native':{}}),await this['setObjectNotExistsAsync'](_0x577ca0(0x238),{'type':_0x577ca0(0x1d2),'common':{'name':_0x577ca0(0x1f3),'type':_0x577ca0(0x166),'role':_0x577ca0(0x216),'read':!![],'write':![],'def':'[]'},'native':{}}),await this['setObjectNotExistsAsync']('analysis.feedbackHistory',{'type':_0x577ca0(0x1d2),'common':{'name':_0x577ca0(0x1d4),'type':_0x577ca0(0x166),'role':'json','read':!![],'write':![],'def':'[]'},'native':{}}),await this[_0x577ca0(0x1ec)](),await this[_0x577ca0(0x21a)]();}async[a0_0x419f00(0x222)](){const _0x180f4f=a0_0x419f00;await this[_0x180f4f(0x1ee)](_0x180f4f(0x16e),{'type':_0x180f4f(0x16b),'common':{'name':_0x180f4f(0x229)},'native':{}}),await this['extendObjectAsync'](SYSTEM_DP_MODE,{'type':_0x180f4f(0x1d2),'common':{'name':_0x180f4f(0x18a),'type':'string','role':'state','read':!![],'write':!![],'def':SYSTEM_MODES[_0x180f4f(0x205)],'states':{[SYSTEM_MODES[_0x180f4f(0x205)]]:'Normal',[SYSTEM_MODES[_0x180f4f(0x184)]]:_0x180f4f(0x1f6),[SYSTEM_MODES[_0x180f4f(0x1ba)]]:_0x180f4f(0x12a),[SYSTEM_MODES[_0x180f4f(0x1c0)]]:_0x180f4f(0x23d)}},'native':{}});}async['sendNotification'](_0x9d0711,_0x9e21c6=![],_0x160fdc=![]){const _0x4734ba=a0_0x419f00;this[_0x4734ba(0x14d)][_0x4734ba(0x1cf)]((_0x9e21c6?_0x4734ba(0x208):'')+_0x4734ba(0x209)+_0x9d0711+'\x22'+(_0x160fdc?_0x4734ba(0x261):''));const _0xfb978d=this['config'];let _0x590c42=0x0;_0xfb978d[_0x4734ba(0x252)]&&_0xfb978d['notifyTelegramInstance']&&(await this[_0x4734ba(0x265)](_0xfb978d['notifyTelegramInstance'],_0x4734ba(0x258),{'text':_0x9d0711,'user':_0xfb978d[_0x4734ba(0x18f)]}),_0x590c42++);if(_0xfb978d[_0x4734ba(0x214)]&&_0xfb978d['notifyPushoverInstance']){let _0x50516f={'message':_0x9d0711,'title':_0x160fdc?_0x4734ba(0x233):_0x4734ba(0x148),'priority':_0x160fdc?0x2:0x1,'device':_0xfb978d['notifyPushoverRecipient']};_0x160fdc&&(_0x50516f[_0x4734ba(0x17d)]=0x1e,_0x50516f[_0x4734ba(0x239)]=0xe10,_0x50516f[_0x4734ba(0x198)]=_0x4734ba(0x268)),await this['sendToAsync'](_0xfb978d[_0x4734ba(0x181)],_0x4734ba(0x258),_0x50516f),_0x590c42++;}return _0xfb978d[_0x4734ba(0x228)]&&_0xfb978d[_0x4734ba(0x145)]&&(await this[_0x4734ba(0x265)](_0xfb978d[_0x4734ba(0x145)],_0x4734ba(0x258),{'text':_0x9d0711,'to':_0xfb978d[_0x4734ba(0x246)]}),_0x590c42++),_0xfb978d[_0x4734ba(0x141)]&&_0xfb978d[_0x4734ba(0x22b)]&&(await this[_0x4734ba(0x265)](_0xfb978d[_0x4734ba(0x22b)],_0x4734ba(0x258),{'text':_0x9d0711,'phone':_0xfb978d[_0x4734ba(0x26c)]}),_0x590c42++),_0xfb978d['notifySignalEnabled']&&_0xfb978d[_0x4734ba(0x227)]&&(await this[_0x4734ba(0x265)](_0xfb978d[_0x4734ba(0x227)],_0x4734ba(0x258),{'text':_0x9d0711,'phone':_0xfb978d[_0x4734ba(0x15e)]}),_0x590c42++),_0x590c42;}async[a0_0x419f00(0x225)](){const _0x299e17=a0_0x419f00;try{const _0x293630=await this[_0x299e17(0x24b)](LTM_DP_RAW_LOG);if(_0x293630&&_0x293630[_0x299e17(0x1e4)])this[_0x299e17(0x21f)]=JSON[_0x299e17(0x1ce)](_0x293630[_0x299e17(0x1e4)]);}catch(_0x2c5043){this[_0x299e17(0x21f)]=[];}}async['saveRawEventLog'](){const _0x38ce94=a0_0x419f00;this[_0x38ce94(0x21f)][_0x38ce94(0x1b9)]>RAW_LOG_MAX_SIZE&&this[_0x38ce94(0x21f)][_0x38ce94(0x1d7)](0x0,this[_0x38ce94(0x21f)]['length']-RAW_LOG_MAX_SIZE),await this['setStateAsync'](LTM_DP_RAW_LOG,{'val':JSON['stringify'](this[_0x38ce94(0x21f)]),'ack':!![]});}async['loadDailyDigests'](){const _0x432c8d=a0_0x419f00;try{const _0xe51bf5=await this[_0x432c8d(0x24b)](LTM_DP_DAILY_DIGESTS);if(_0xe51bf5&&_0xe51bf5[_0x432c8d(0x1e4)])this[_0x432c8d(0x17a)]=JSON[_0x432c8d(0x1ce)](_0xe51bf5[_0x432c8d(0x1e4)]);}catch(_0xb73a89){this[_0x432c8d(0x17a)]=[];}await this[_0x432c8d(0x179)]();}async['saveDailyDigests'](_0x5b287c=!![]){const _0x431444=a0_0x419f00,_0xfa8dda=this[_0x431444(0x22e)][_0x431444(0x1fa)]||0x3c;this[_0x431444(0x17a)]['length']>_0xfa8dda&&this['dailyDigests'][_0x431444(0x1d7)](0x0,this[_0x431444(0x17a)][_0x431444(0x1b9)]-_0xfa8dda);await this[_0x431444(0x249)](LTM_DP_DAILY_DIGESTS,{'val':JSON[_0x431444(0x144)](this['dailyDigests']),'ack':!![]});if(_0x5b287c)await this[_0x431444(0x179)]();}['setupLtmScheduler'](){const _0x3cc875=a0_0x419f00;if(this[_0x3cc875(0x134)])this[_0x3cc875(0x134)][_0x3cc875(0x1a8)]();if(!this[_0x3cc875(0x191)]){this[_0x3cc875(0x249)](LTM_DP_STATUS,{'val':_0x3cc875(0x158),'ack':!![]});return;}this['ltmJob']=schedule[_0x3cc875(0x254)](LTM_SCHEDULE,()=>this['createDailyDigest']());}['setupDriftAnalysisScheduler'](){const _0x545b94=a0_0x419f00;if(this[_0x545b94(0x15f)])clearInterval(this[_0x545b94(0x15f)]);if(!this['isProVersion'])return;this['driftAnalysisTimer']=setInterval(()=>this[_0x545b94(0x1a6)](),(this[_0x545b94(0x22e)]['ltmDriftCheckIntervalHours']||0x18)*0x36ee80),setTimeout(()=>this[_0x545b94(0x1a6)](),0x1388);}async['resetAnalysisStates'](){const _0xf8a773=a0_0x419f00;await this[_0xf8a773(0x249)](_0xf8a773(0x11f),{'val':_0xf8a773(0x243),'ack':!![]}),await this[_0xf8a773(0x249)](_0xf8a773(0x231),{'val':this['isProVersion']?'N/A\x20(No\x20Activity)':_0xf8a773(0x172),'ack':!![]}),await this[_0xf8a773(0x249)](_0xf8a773(0x1f4),{'val':![],'ack':!![]}),await this[_0xf8a773(0x249)](_0xf8a773(0x1cb),{'val':![],'ack':!![]}),this[_0xf8a773(0x17b)]=![];}async[a0_0x419f00(0x196)](_0xacfca7){const _0x5d4e1c=a0_0x419f00;this[_0x5d4e1c(0x157)][_0x5d4e1c(0x1c3)](_0xacfca7);if(this[_0x5d4e1c(0x157)][_0x5d4e1c(0x1b9)]>ANALYSIS_HISTORY_MAX_SIZE)this[_0x5d4e1c(0x157)][_0x5d4e1c(0x142)]();await this[_0x5d4e1c(0x249)](_0x5d4e1c(0x238),{'val':JSON[_0x5d4e1c(0x144)](this['analysisHistory']),'ack':!![]});}[a0_0x419f00(0x1dc)](){const _0x1d65f7=a0_0x419f00;if(this[_0x1d65f7(0x19d)])this[_0x1d65f7(0x19d)][_0x1d65f7(0x1a8)]();this[_0x1d65f7(0x19d)]=schedule[_0x1d65f7(0x254)](MODE_RESET_SCHEDULE,async()=>{const _0x3555a1=_0x1d65f7;await this[_0x3555a1(0x1ab)](),AUTO_RESET_MODES[_0x3555a1(0x14a)](this[_0x3555a1(0x1a1)])&&await this[_0x3555a1(0x249)](SYSTEM_DP_MODE,{'val':SYSTEM_MODES['NORMAL'],'ack':![]});});}async['updateBaselineStatus'](){const _0x4f58d7=a0_0x419f00;if(!this[_0x4f58d7(0x191)]){await this[_0x4f58d7(0x249)](LTM_DP_BASELINE_STATUS,{'val':_0x4f58d7(0x158),'ack':!![]});return;}const _0x5ecd09=this[_0x4f58d7(0x17a)][_0x4f58d7(0x1b9)]>=(this[_0x4f58d7(0x22e)][_0x4f58d7(0x12d)]||0x7)?'Aktiv\x20('+this['dailyDigests'][_0x4f58d7(0x1b9)]+_0x4f58d7(0x25d):_0x4f58d7(0x11c)+this['dailyDigests'][_0x4f58d7(0x1b9)]+'/'+(this[_0x4f58d7(0x22e)][_0x4f58d7(0x12d)]||0x7)+')';await this['setStateAsync'](LTM_DP_BASELINE_STATUS,{'val':_0x5ecd09,'ack':!![]});}async[a0_0x419f00(0x1ec)](){const _0xa5acbc=a0_0x419f00;await this[_0xa5acbc(0x1ee)]('LTM',{'type':'channel','common':{'name':_0xa5acbc(0x25b)},'native':{}}),await this['extendObjectAsync'](LTM_DP_RAW_LOG,{'type':_0xa5acbc(0x1d2),'common':{'name':_0xa5acbc(0x241),'type':'string','role':_0xa5acbc(0x216),'read':!![],'write':![]},'native':{}}),await this['extendObjectAsync'](LTM_DP_DAILY_DIGESTS,{'type':_0xa5acbc(0x1d2),'common':{'name':_0xa5acbc(0x22f),'type':_0xa5acbc(0x166),'role':_0xa5acbc(0x216),'read':!![],'write':![]},'native':{}}),await this[_0xa5acbc(0x1ee)](LTM_DP_STATUS,{'type':_0xa5acbc(0x1d2),'common':{'name':_0xa5acbc(0x1d0),'type':_0xa5acbc(0x166),'role':_0xa5acbc(0x163),'read':!![],'write':![]},'native':{}}),await this[_0xa5acbc(0x1ee)](LTM_DP_TRIGGER_DIGEST,{'type':_0xa5acbc(0x1d2),'common':{'name':_0xa5acbc(0x147),'type':_0xa5acbc(0x200),'role':'button','read':!![],'write':!![],'def':![]},'native':{}}),await this[_0xa5acbc(0x1ee)](LTM_DP_BASELINE_STATUS,{'type':_0xa5acbc(0x1d2),'common':{'name':_0xa5acbc(0x194),'type':_0xa5acbc(0x166),'role':_0xa5acbc(0x163),'read':!![],'write':![]},'native':{}});}async[a0_0x419f00(0x21a)](){const _0x137199=a0_0x419f00;await this[_0x137199(0x1ee)](LTM_DP_DRIFT_CHANNEL,{'type':'channel','common':{'name':_0x137199(0x19f)},'native':{}}),await this[_0x137199(0x1ee)](LTM_DP_DRIFT_STATUS,{'type':_0x137199(0x1d2),'common':{'name':_0x137199(0x15c),'type':_0x137199(0x166),'role':_0x137199(0x1d2),'read':!![],'write':![],'def':_0x137199(0x1f8)},'native':{}}),await this[_0x137199(0x1ee)](LTM_DP_DRIFT_DETAILS,{'type':_0x137199(0x1d2),'common':{'name':'Drift\x20Details','type':_0x137199(0x166),'role':_0x137199(0x163),'read':!![],'write':![]},'native':{}}),await this[_0x137199(0x1ee)](LTM_DP_DRIFT_LAST_CHECK,{'type':_0x137199(0x1d2),'common':{'name':_0x137199(0x1d5),'type':_0x137199(0x20b),'role':_0x137199(0x1f9),'read':!![],'write':![]},'native':{}});}async['runBaselineDriftAnalysis'](){const _0x43dd3d=a0_0x419f00;if(!this[_0x43dd3d(0x191)]||!this['geminiModel'])return;const _0x4dc49e=this[_0x43dd3d(0x22e)]['ltmStbWindowDays']||0xe;if(this[_0x43dd3d(0x17a)][_0x43dd3d(0x1b9)]<_0x4dc49e+(this['config'][_0x43dd3d(0x12d)]||0x7)){await this[_0x43dd3d(0x249)](LTM_DP_DRIFT_STATUS,{'val':'N/A\x20(Learning)','ack':!![]});return;}const _0x38194e=this[_0x43dd3d(0x17a)][_0x43dd3d(0x164)](-_0x4dc49e),_0x17ab85=this[_0x43dd3d(0x17a)]['slice'](0x0,this[_0x43dd3d(0x17a)]['length']-_0x4dc49e),_0x23d0ad=_0x43dd3d(0x1e9)+JSON[_0x43dd3d(0x144)](_0x17ab85)+_0x43dd3d(0x1f1)+JSON[_0x43dd3d(0x144)](_0x38194e);try{const _0x4320be=await this[_0x43dd3d(0x244)][_0x43dd3d(0x186)](_0x23d0ad),_0x1bb03f=JSON[_0x43dd3d(0x1ce)](_0x4320be['response']['text']()[_0x43dd3d(0x124)](/```json|```/g,'')[_0x43dd3d(0x223)]());_0x1bb03f['baselineDrift']&&(await this['setStateAsync'](LTM_DP_DRIFT_STATUS,{'val':_0x1bb03f[_0x43dd3d(0x26d)],'ack':!![]}),await this['setStateAsync'](LTM_DP_DRIFT_DETAILS,{'val':_0x1bb03f[_0x43dd3d(0x230)],'ack':!![]}),await this[_0x43dd3d(0x249)](LTM_DP_DRIFT_LAST_CHECK,{'val':Date['now'](),'ack':!![]}));}catch(_0x4bfdc0){}}async[a0_0x419f00(0x1ab)](){const _0x497af1=a0_0x419f00;try{const _0x1f1fa3=await this[_0x497af1(0x24b)](SYSTEM_DP_MODE);_0x1f1fa3&&_0x1f1fa3['val']&&Object['values'](SYSTEM_MODES)[_0x497af1(0x14a)](_0x1f1fa3['val'])?this[_0x497af1(0x1a1)]=_0x1f1fa3[_0x497af1(0x1e4)]:(this[_0x497af1(0x1a1)]=SYSTEM_MODES[_0x497af1(0x205)],await this['setStateAsync'](SYSTEM_DP_MODE,{'val':SYSTEM_MODES[_0x497af1(0x205)],'ack':!![]}));}catch(_0x415bac){this['currentSystemMode']=SYSTEM_MODES['NORMAL'];}}async[a0_0x419f00(0x22c)](){const _0x47242e=a0_0x419f00;try{const _0x5101dd=await this[_0x47242e(0x1b0)](_0x47242e(0x173));if(_0x5101dd&&_0x5101dd[_0x47242e(0x154)]&&_0x5101dd[_0x47242e(0x154)]['uuid'])return _0x5101dd[_0x47242e(0x154)]['uuid'];return _0x47242e(0x1c7);}catch(_0x4fae8c){return'uuid-error';}}async[a0_0x419f00(0x1d9)](_0x2250b3){const _0x36e958=a0_0x419f00;if(!_0x2250b3)return![];this['systemUUID']=await this['getSystemUUID']();if(_0x2250b3===_0x36e958(0x19c)||_0x2250b3[_0x36e958(0x20c)]('PRO-'))return!![];return![];}[a0_0x419f00(0x1c1)](_0xc763b){const _0x397fd1=a0_0x419f00;if(this['analysisTimer'])clearInterval(this[_0x397fd1(0x11b)]);if(this['driftAnalysisTimer'])clearInterval(this[_0x397fd1(0x15f)]);if(this[_0x397fd1(0x134)])this[_0x397fd1(0x134)][_0x397fd1(0x1a8)]();if(this[_0x397fd1(0x19d)])this[_0x397fd1(0x19d)][_0x397fd1(0x1a8)]();if(this[_0x397fd1(0x263)])clearTimeout(this[_0x397fd1(0x263)]);if(this[_0x397fd1(0x24f)])clearTimeout(this[_0x397fd1(0x24f)]);_0xc763b();}async['onMessage'](_0x3397d5){const _0x278051=a0_0x419f00;if(typeof _0x3397d5===_0x278051(0x1c9)&&_0x3397d5['message']){if(_0x3397d5[_0x278051(0x1e5)]==='testApiKey'){if(!_0x3397d5['message'][_0x278051(0x25e)])return this['sendTo'](_0x3397d5['from'],_0x3397d5['command'],{'success':![],'message':_0x278051(0x1d1)},_0x3397d5[_0x278051(0x182)]);try{const _0x3c4643=new GoogleGenerativeAI(_0x3397d5[_0x278051(0x1a4)][_0x278051(0x25e)])[_0x278051(0x1c5)]({'model':_0x278051(0x18e)});await _0x3c4643['generateContent'](_0x278051(0x12e)),this['sendTo'](_0x3397d5[_0x278051(0x1ac)],_0x3397d5[_0x278051(0x1e5)],{'success':!![],'message':_0x278051(0x197)},_0x3397d5[_0x278051(0x182)]);}catch(_0x4a452c){this[_0x278051(0x210)](_0x3397d5[_0x278051(0x1ac)],_0x3397d5[_0x278051(0x1e5)],{'success':![],'message':_0x4a452c[_0x278051(0x1a4)]},_0x3397d5['callback']);}}else{if(_0x3397d5[_0x278051(0x1e5)]===_0x278051(0x136)){const _0x5a94b1=await this[_0x278051(0x1a0)](_0x278051(0x23f),!![]);this[_0x278051(0x210)](_0x3397d5[_0x278051(0x1ac)],_0x3397d5['command'],{'success':_0x5a94b1>0x0,'message':_0x5a94b1+_0x278051(0x130)},_0x3397d5[_0x278051(0x182)]);}else{if(_0x3397d5[_0x278051(0x1e5)]===_0x278051(0x201)){if(!this[_0x278051(0x191)])return this['sendTo'](_0x3397d5[_0x278051(0x1ac)],_0x3397d5[_0x278051(0x1e5)],{'success':![],'isPro':![]},_0x3397d5[_0x278051(0x182)]);let _0xbde3bc={'status':_0x278051(0x1f8),'details':'','lastCheck':0x0};try{_0xbde3bc['status']=(await this[_0x278051(0x24b)](LTM_DP_DRIFT_STATUS))[_0x278051(0x1e4)],_0xbde3bc['details']=(await this[_0x278051(0x24b)](LTM_DP_DRIFT_DETAILS))[_0x278051(0x1e4)],_0xbde3bc[_0x278051(0x1a2)]=(await this[_0x278051(0x24b)](LTM_DP_DRIFT_LAST_CHECK))[_0x278051(0x1e4)];}catch(_0x402b7f){}this[_0x278051(0x210)](_0x3397d5[_0x278051(0x1ac)],_0x3397d5[_0x278051(0x1e5)],{'success':!![],'isPro':!![],'dailyDigests':this[_0x278051(0x17a)],'driftAnalysis':_0xbde3bc,'analysisHistory':this[_0x278051(0x157)]},_0x3397d5['callback']);}else{if(_0x3397d5[_0x278051(0x1e5)]===_0x278051(0x174)){const _0x3a955e=await this[_0x278051(0x153)](_0x278051(0x25a),_0x278051(0x190)),_0x3dcc0e=[];if(_0x3a955e)for(const _0x1f1eba in _0x3a955e){const _0x2acd3a=_0x3a955e[_0x1f1eba],_0x51c0bc=(_0x2acd3a[_0x278051(0x1bf)]&&typeof _0x2acd3a[_0x278051(0x1bf)][_0x278051(0x16f)]==='object'?_0x2acd3a[_0x278051(0x1bf)][_0x278051(0x16f)]['de']:_0x2acd3a[_0x278051(0x1bf)][_0x278051(0x16f)])||_0x2acd3a[_0x278051(0x1bf)][_0x278051(0x16f)];_0x3dcc0e[_0x278051(0x247)]({'id':_0x1f1eba,'name':_0x51c0bc});}this[_0x278051(0x210)](_0x3397d5[_0x278051(0x1ac)],_0x3397d5[_0x278051(0x1e5)],{'success':!![],'enums':_0x3dcc0e},_0x3397d5[_0x278051(0x182)]);}else{if(_0x3397d5[_0x278051(0x1e5)]===_0x278051(0x20d)){this['log']['info'](_0x278051(0x177));const _0x127014=_0x3397d5[_0x278051(0x1a4)]||{};try{const _0x4d7aec=await this[_0x278051(0x232)](_0x127014);this[_0x278051(0x210)](_0x3397d5['from'],_0x3397d5[_0x278051(0x1e5)],{'success':!![],'devices':_0x4d7aec},_0x3397d5['callback']);}catch(_0x244a5c){this['sendTo'](_0x3397d5[_0x278051(0x1ac)],_0x3397d5[_0x278051(0x1e5)],{'success':![],'error':_0x244a5c[_0x278051(0x1a4)]},_0x3397d5[_0x278051(0x182)]);}}else{if(_0x3397d5[_0x278051(0x1e5)]===_0x278051(0x1ef)){const {historyId:_0x2171ce,rating:_0x4f3f1c,comment:_0x50cf65,alertReason:_0x1db418}=_0x3397d5[_0x278051(0x1a4)];_0x2171ce&&_0x4f3f1c?(await this[_0x278051(0x20f)]({'timestamp':Date[_0x278051(0x16a)](),'historyId':_0x2171ce,'rating':_0x4f3f1c,'comment':_0x50cf65,'alertReason':_0x1db418}),this[_0x278051(0x210)](_0x3397d5['from'],_0x3397d5[_0x278051(0x1e5)],{'success':!![]},_0x3397d5['callback'])):this[_0x278051(0x210)](_0x3397d5[_0x278051(0x1ac)],_0x3397d5[_0x278051(0x1e5)],{'success':![],'error':_0x278051(0x123)},_0x3397d5['callback']);}}}}}}}}}if(require[a0_0x419f00(0x20a)]!==module)module[a0_0x419f00(0x264)]=_0x4cece9=>new CogniLiving(_0x4cece9);else new CogniLiving();