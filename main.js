const a0_0x332d39=a0_0xd97f;(function(_0x1ed80a,_0x2b8325){const _0x338e1d=a0_0xd97f,_0x3f4961=_0x1ed80a();while(!![]){try{const _0x447c46=parseInt(_0x338e1d(0xce))/0x1+parseInt(_0x338e1d(0xe8))/0x2*(-parseInt(_0x338e1d(0xa5))/0x3)+-parseInt(_0x338e1d(0xf0))/0x4+parseInt(_0x338e1d(0x14b))/0x5*(-parseInt(_0x338e1d(0x15a))/0x6)+-parseInt(_0x338e1d(0xbf))/0x7*(parseInt(_0x338e1d(0xb9))/0x8)+-parseInt(_0x338e1d(0x11d))/0x9+-parseInt(_0x338e1d(0x160))/0xa*(-parseInt(_0x338e1d(0x81))/0xb);if(_0x447c46===_0x2b8325)break;else _0x3f4961['push'](_0x3f4961['shift']());}catch(_0x3550f4){_0x3f4961['push'](_0x3f4961['shift']());}}}(a0_0x2c48,0x8d102));const a0_0x47bb3b=(function(){let _0x4cf307=!![];return function(_0x1b7ad3,_0x244476){const _0x2d8543=_0x4cf307?function(){const _0xd1c55b=a0_0xd97f;if(_0x244476){const _0x18d11d=_0x244476[_0xd1c55b(0x162)](_0x1b7ad3,arguments);return _0x244476=null,_0x18d11d;}}:function(){};return _0x4cf307=![],_0x2d8543;};}()),a0_0x5ad3b4=a0_0x47bb3b(this,function(){const _0x134c0f=a0_0xd97f;return a0_0x5ad3b4[_0x134c0f(0xcc)]()[_0x134c0f(0x7e)](_0x134c0f(0x150))[_0x134c0f(0xcc)]()[_0x134c0f(0xcf)](a0_0x5ad3b4)['search']('(((.+)+)+)+$');});a0_0x5ad3b4();'use strict';function a0_0xd97f(_0x1accd4,_0x2920cb){const _0x1a4440=a0_0x2c48();return a0_0xd97f=function(_0x5ad3b4,_0x47bb3b){_0x5ad3b4=_0x5ad3b4-0x78;let _0x2c48c5=_0x1a4440[_0x5ad3b4];return _0x2c48c5;},a0_0xd97f(_0x1accd4,_0x2920cb);}const utils=require('@iobroker/adapter-core'),{GoogleGenerativeAI}=require(a0_0x332d39(0x12c)),schedule=require('node-schedule'),{spawn,exec}=require('child_process'),path=require(a0_0x332d39(0xbd)),fs=require('fs'),HISTORY_MAX_SIZE=0x32,RAW_LOG_MAX_SIZE=0x5dc,LTM_MIN_EVENTS_FOR_COMPRESSION=0x5,GEMINI_MODEL=a0_0x332d39(0x143),LTM_SCHEDULE=a0_0x332d39(0x115),MODE_RESET_SCHEDULE='0\x204\x20*\x20*\x20*',SEQUENCE_TIMEOUT_MS=0x5*0x3c*0x3e8,MAX_TRAINING_SET_SIZE=0x1f4,THERMO_LOG_SIZE=0x3e8,EXIT_TIMER_MINUTES=0xf,EXIT_GRACE_PERIOD_SECONDS=0x1e,LTM_DP_RAW_LOG='LTM.rawEventLog',LTM_DP_DAILY_DIGESTS=a0_0x332d39(0x83),LTM_DP_STATUS='LTM.processingStatus',LTM_DP_TRIGGER_DIGEST=a0_0x332d39(0x112),LTM_DP_BASELINE_STATUS=a0_0x332d39(0x167),LTM_DP_DRIFT_CHANNEL=a0_0x332d39(0x16e),LTM_DP_DRIFT_STATUS='LTM.driftAnalysis.baselineDrift',LTM_DP_DRIFT_DETAILS='LTM.driftAnalysis.driftDetails',LTM_DP_DRIFT_LAST_CHECK=a0_0x332d39(0x165),SYSTEM_DP_MODE=a0_0x332d39(0xd6),SYSTEM_MODES={'NORMAL':a0_0x332d39(0xcd),'VACATION':a0_0x332d39(0xff),'PARTY':a0_0x332d39(0xd5),'GUEST':a0_0x332d39(0xae)},AUTO_RESET_MODES=[SYSTEM_MODES[a0_0x332d39(0xeb)],SYSTEM_MODES[a0_0x332d39(0x15f)]],PERSONA_MAPPING={'generic':a0_0x332d39(0x86),'senior_aal':a0_0x332d39(0x88),'family':a0_0x332d39(0x166),'single_comfort':a0_0x332d39(0x9a),'security':a0_0x332d39(0x124)},ACTIVITY_LEVEL_MAP={'sehr\x20hoch':0x64,'hoch':0x50,'normal':0x3c,'niedrig':0x28,'sehr\x20niedrig':0x14,'inaktiv':0x0},BAD_NAMES=[a0_0x332d39(0x174),'currentposition',a0_0x332d39(0x151),'level',a0_0x332d39(0x158),a0_0x332d39(0xca),'on',a0_0x332d39(0x117),a0_0x332d39(0xc6),a0_0x332d39(0xe0),a0_0x332d39(0xa3),a0_0x332d39(0x108),a0_0x332d39(0xf5),a0_0x332d39(0x10f),'motion','presence',a0_0x332d39(0xfc),'temperature',a0_0x332d39(0xb5),a0_0x332d39(0x84),a0_0x332d39(0x136),a0_0x332d39(0x140),a0_0x332d39(0xb2),'actual_temperature','set_temperature'],ADAPTER_BLACKLIST=[a0_0x332d39(0x94),a0_0x332d39(0x122),'info.','vis.',a0_0x332d39(0xd3),a0_0x332d39(0xc0),a0_0x332d39(0xfe),a0_0x332d39(0x95),'echarts.',a0_0x332d39(0xa0),a0_0x332d39(0xa8)],IS_WIN=process[a0_0x332d39(0xd7)]==='win32',VENV_PATH=path[a0_0x332d39(0xb7)](__dirname,a0_0x332d39(0x159)),PYTHON_EXE=IS_WIN?path[a0_0x332d39(0xb7)](VENV_PATH,a0_0x332d39(0x11e),a0_0x332d39(0xdb)):path[a0_0x332d39(0xb7)](VENV_PATH,a0_0x332d39(0x7b),a0_0x332d39(0x126)),PIP_EXE=IS_WIN?path[a0_0x332d39(0xb7)](VENV_PATH,'Scripts',a0_0x332d39(0x135)):path['join'](VENV_PATH,a0_0x332d39(0x7b),a0_0x332d39(0x12d));async function initZombies(_0x439ed6){const _0x321478=a0_0x332d39;try{const _0x2ee2b5=[_0x321478(0x8d),_0x321478(0x121)];for(const _0x220cc6 of _0x2ee2b5){try{const _0x148d10=await _0x439ed6['getObjectAsync'](_0x220cc6);if(_0x148d10)await _0x439ed6[_0x321478(0x138)](_0x220cc6);}catch(_0x721928){}}}catch(_0x5686e8){}}async function initHistory(_0x5267a7){const _0x4b8765=a0_0x332d39;try{const _0x5bd816=await _0x5267a7[_0x4b8765(0xfb)](_0x4b8765(0x113));_0x5bd816&&_0x5bd816[_0x4b8765(0x14c)]&&(_0x5267a7['eventHistory']=JSON[_0x4b8765(0x14a)](_0x5bd816[_0x4b8765(0x14c)][_0x4b8765(0xcc)]()));}catch(_0x43301a){_0x5267a7[_0x4b8765(0x97)]=[];}try{const _0x16caf9=await _0x5267a7[_0x4b8765(0xfb)]('analysis.analysisHistory');if(_0x16caf9&&_0x16caf9[_0x4b8765(0x14c)])_0x5267a7[_0x4b8765(0x169)]=JSON[_0x4b8765(0x14a)](_0x16caf9[_0x4b8765(0x14c)]['toString']());}catch(_0x1cd7d6){_0x5267a7[_0x4b8765(0x169)]=[];}if(_0x5267a7['eventHistory']&&_0x5267a7[_0x4b8765(0x97)][_0x4b8765(0x9f)]>0x0){_0x5267a7[_0x4b8765(0x11b)][_0x4b8765(0x164)](_0x4b8765(0x14f)+_0x5267a7[_0x4b8765(0x97)][_0x4b8765(0x9f)]+'\x20events)...');for(let _0x2dc82b=_0x5267a7[_0x4b8765(0x97)]['length']-0x1;_0x2dc82b>=0x0;_0x2dc82b--){const _0x36ecb6=_0x5267a7[_0x4b8765(0x97)][_0x2dc82b];if(_0x36ecb6&&_0x36ecb6['id']!==undefined&&_0x36ecb6[_0x4b8765(0x158)]!==undefined)_0x5267a7[_0x4b8765(0xc1)][_0x36ecb6['id']]=_0x36ecb6[_0x4b8765(0x158)];}}}async function initSystemConfig(_0x5652e1){const _0x52f7b4=a0_0x332d39;try{const _0x1a7499=await _0x5652e1[_0x52f7b4(0xa7)](_0x52f7b4(0x129));if(_0x1a7499&&_0x1a7499[_0x52f7b4(0xe9)])_0x5652e1['systemConfig']={'latitude':_0x1a7499[_0x52f7b4(0xe9)][_0x52f7b4(0x10b)]||0x0,'longitude':_0x1a7499[_0x52f7b4(0xe9)][_0x52f7b4(0x89)]||0x0,'city':_0x1a7499[_0x52f7b4(0xe9)][_0x52f7b4(0x148)]||''};}catch(_0x393c61){}}async function checkLicense(_0x9488f1,_0x28a857){return!![];}async function getSystemUUID(_0x124674){const _0x100903=a0_0x332d39;return _0x100903(0x131);}async function loadRawEventLog(_0x4c59fc){const _0x16202e=a0_0x332d39;try{const _0x2610c6=await _0x4c59fc[_0x16202e(0xfb)](LTM_DP_RAW_LOG);if(_0x2610c6&&_0x2610c6['val'])_0x4c59fc[_0x16202e(0x153)]=JSON[_0x16202e(0x14a)](_0x2610c6['val']);}catch(_0x479536){_0x4c59fc[_0x16202e(0x153)]=[];}}async function saveRawEventLog(_0x5d492e){const _0x37c8fa=a0_0x332d39;if(_0x5d492e[_0x37c8fa(0x153)]['length']>RAW_LOG_MAX_SIZE)_0x5d492e[_0x37c8fa(0x153)][_0x37c8fa(0x8b)](0x0,_0x5d492e[_0x37c8fa(0x153)][_0x37c8fa(0x9f)]-RAW_LOG_MAX_SIZE);await _0x5d492e[_0x37c8fa(0x15b)](LTM_DP_RAW_LOG,{'val':JSON[_0x37c8fa(0xc5)](_0x5d492e['rawEventLog']),'ack':!![]});}async function loadDailyDigests(_0x48a45b){const _0x16d74d=a0_0x332d39;try{const _0x1082a5=await _0x48a45b[_0x16d74d(0xfb)](LTM_DP_DAILY_DIGESTS);if(_0x1082a5&&_0x1082a5['val'])_0x48a45b[_0x16d74d(0x12f)]=JSON[_0x16d74d(0x14a)](_0x1082a5['val']);}catch(_0x1485a7){_0x48a45b[_0x16d74d(0x12f)]=[];}await updateBaselineStatus(_0x48a45b);}async function saveDailyDigests(_0x40192f,_0x540e59=!![]){const _0x11494f=a0_0x332d39,_0x5abfe7=_0x40192f[_0x11494f(0x12a)]['ltmLtbWindowDays']||0x3c;_0x40192f['dailyDigests'][_0x11494f(0x9f)]>_0x5abfe7&&_0x40192f[_0x11494f(0x12f)][_0x11494f(0x8b)](0x0,_0x40192f[_0x11494f(0x12f)][_0x11494f(0x9f)]-_0x5abfe7);await _0x40192f[_0x11494f(0x15b)](LTM_DP_DAILY_DIGESTS,{'val':JSON[_0x11494f(0xc5)](_0x40192f[_0x11494f(0x12f)]),'ack':!![]});if(_0x540e59)await updateBaselineStatus(_0x40192f);}async function updateAnalysisHistory(_0x74631f,_0xafe6e9){const _0x31df74=a0_0x332d39;_0x74631f[_0x31df74(0x169)][_0x31df74(0xc2)](_0xafe6e9);if(_0x74631f[_0x31df74(0x169)][_0x31df74(0x9f)]>ANALYSIS_HISTORY_MAX_SIZE)_0x74631f[_0x31df74(0x169)][_0x31df74(0xda)]();await _0x74631f[_0x31df74(0x15b)](_0x31df74(0x7d),{'val':JSON[_0x31df74(0xc5)](_0x74631f[_0x31df74(0x169)]),'ack':!![]});}async function updateBaselineStatus(_0x4b424b){const _0x266c1b=a0_0x332d39;if(!_0x4b424b['isProVersion']){await _0x4b424b['setStateAsync'](LTM_DP_BASELINE_STATUS,{'val':_0x266c1b(0xef),'ack':!![]});return;}const _0x2462a8=_0x4b424b[_0x266c1b(0x12f)][_0x266c1b(0x9f)]>=(_0x4b424b[_0x266c1b(0x12a)][_0x266c1b(0xdf)]||0x7)?_0x266c1b(0x7a)+_0x4b424b[_0x266c1b(0x12f)][_0x266c1b(0x9f)]+_0x266c1b(0x128):'Lernphase\x20('+_0x4b424b[_0x266c1b(0x12f)][_0x266c1b(0x9f)]+'/'+(_0x4b424b[_0x266c1b(0x12a)][_0x266c1b(0xdf)]||0x7)+')';await _0x4b424b['setStateAsync'](LTM_DP_BASELINE_STATUS,{'val':_0x2462a8,'ack':!![]});}async function loadSystemMode(_0x440a49){const _0x19e4d4=a0_0x332d39;try{const _0x1b0f91=await _0x440a49[_0x19e4d4(0xfb)](SYSTEM_DP_MODE);_0x1b0f91&&_0x1b0f91[_0x19e4d4(0x14c)]&&Object['values'](SYSTEM_MODES)[_0x19e4d4(0x152)](_0x1b0f91[_0x19e4d4(0x14c)])?_0x440a49[_0x19e4d4(0x9e)]=_0x1b0f91[_0x19e4d4(0x14c)]:(_0x440a49[_0x19e4d4(0x9e)]=SYSTEM_MODES[_0x19e4d4(0x15d)],await _0x440a49[_0x19e4d4(0x15b)](SYSTEM_DP_MODE,{'val':SYSTEM_MODES[_0x19e4d4(0x15d)],'ack':!![]}));}catch(_0x490aaa){_0x440a49['currentSystemMode']=SYSTEM_MODES[_0x19e4d4(0x15d)];}}async function createAllObjects(_0x33c596){const _0x20053a=a0_0x332d39;await _0x33c596['extendObjectAsync'](_0x20053a(0xf4),{'type':_0x20053a(0xa2),'common':{'name':_0x20053a(0x104)},'native':{}}),await _0x33c596[_0x20053a(0x91)](SYSTEM_DP_MODE,{'type':'state','common':{'name':_0x20053a(0x16b),'type':'string','role':_0x20053a(0x151),'read':!![],'write':!![],'def':SYSTEM_MODES[_0x20053a(0x15d)]},'native':{}}),await _0x33c596['setObjectNotExistsAsync'](_0x20053a(0x11c),{'type':_0x20053a(0x151),'common':{'name':_0x20053a(0xdd),'type':_0x20053a(0x149),'role':_0x20053a(0xc3),'read':!![],'write':![]},'native':{}}),await _0x33c596[_0x20053a(0x105)]('events.lastEvent',{'type':_0x20053a(0x151),'common':{'name':_0x20053a(0x15c),'type':_0x20053a(0x149),'role':_0x20053a(0x11a),'read':!![],'write':![]},'native':{}}),await _0x33c596[_0x20053a(0x105)](_0x20053a(0x113),{'type':_0x20053a(0x151),'common':{'name':_0x20053a(0x10d),'type':_0x20053a(0x149),'role':'json','read':!![],'write':![]},'native':{}}),await _0x33c596[_0x20053a(0x91)](_0x20053a(0x12b),{'type':_0x20053a(0xa2),'common':{'name':'AI\x20Training'},'native':{}}),await _0x33c596['setObjectNotExistsAsync']('analysis.training.triggerSecurity',{'type':_0x20053a(0x151),'common':{'name':_0x20053a(0x163),'type':_0x20053a(0x145),'role':_0x20053a(0x9d),'read':!![],'write':!![]},'native':{}}),await _0x33c596[_0x20053a(0x105)](_0x20053a(0x85),{'type':'state','common':{'name':_0x20053a(0x8c),'type':_0x20053a(0x145),'role':_0x20053a(0x9d),'read':!![],'write':!![]},'native':{}}),await _0x33c596['setObjectNotExistsAsync'](_0x20053a(0x98),{'type':_0x20053a(0x151),'common':{'name':_0x20053a(0x147),'type':'boolean','role':'button','read':!![],'write':!![]},'native':{}}),await _0x33c596[_0x20053a(0x105)]('analysis.training.status',{'type':_0x20053a(0x151),'common':{'name':_0x20053a(0x133),'type':_0x20053a(0x149),'role':_0x20053a(0xc3),'read':!![],'write':![]},'native':{}}),await _0x33c596['extendObjectAsync'](_0x20053a(0xb3),{'type':_0x20053a(0xa2),'common':{'name':_0x20053a(0x103)},'native':{}}),await _0x33c596[_0x20053a(0x105)](_0x20053a(0x118),{'type':'state','common':{'name':_0x20053a(0x13e),'type':_0x20053a(0x123),'role':_0x20053a(0x158),'read':!![],'write':![]},'native':{}}),await _0x33c596[_0x20053a(0x105)](_0x20053a(0xe1),{'type':'state','common':{'name':'Last\x20Check','type':_0x20053a(0x149),'role':_0x20053a(0x16f),'read':!![],'write':![]},'native':{}}),await _0x33c596[_0x20053a(0x91)]('analysis.health',{'type':_0x20053a(0xa2),'common':{'name':'Health\x20Analysis'},'native':{}}),await _0x33c596[_0x20053a(0x105)](_0x20053a(0x14d),{'type':_0x20053a(0x151),'common':{'name':_0x20053a(0x100),'type':_0x20053a(0x149),'role':'date','read':!![],'write':![]},'native':{}}),await _0x33c596[_0x20053a(0x105)](_0x20053a(0x12e),{'type':_0x20053a(0x151),'common':{'name':'Anomaly\x20Detected','type':_0x20053a(0x145),'role':_0x20053a(0x14e),'read':!![],'write':![]},'native':{}}),await _0x33c596[_0x20053a(0x105)](_0x20053a(0xf7),{'type':'state','common':{'name':_0x20053a(0xe4),'type':_0x20053a(0x149),'role':_0x20053a(0xc3),'read':!![],'write':![]},'native':{}}),await _0x33c596['setObjectNotExistsAsync'](_0x20053a(0xe3),{'type':_0x20053a(0x151),'common':{'name':_0x20053a(0xc7),'type':_0x20053a(0x123),'role':'value','read':!![],'write':![]},'native':{}}),await _0x33c596[_0x20053a(0x91)](_0x20053a(0x109),{'type':'channel','common':{'name':_0x20053a(0x172)},'native':{}}),await _0x33c596[_0x20053a(0x105)]('analysis.energy.insulationScore',{'type':_0x20053a(0x151),'common':{'name':_0x20053a(0xad),'type':_0x20053a(0x149),'role':_0x20053a(0xc3),'read':!![],'write':![]},'native':{}}),await _0x33c596[_0x20053a(0x105)]('analysis.energy.heatingScore',{'type':_0x20053a(0x151),'common':{'name':_0x20053a(0x7c),'type':_0x20053a(0x149),'role':_0x20053a(0xc3),'read':!![],'write':![]},'native':{}}),await _0x33c596[_0x20053a(0x91)](_0x20053a(0x11f),{'type':'channel','common':{'name':_0x20053a(0x11f)},'native':{}}),await _0x33c596[_0x20053a(0x91)](LTM_DP_RAW_LOG,{'type':_0x20053a(0x151),'common':{'name':'Raw\x20Log','type':_0x20053a(0x149),'role':_0x20053a(0x11a),'read':!![],'write':![]},'native':{}}),await _0x33c596[_0x20053a(0x91)](LTM_DP_DAILY_DIGESTS,{'type':_0x20053a(0x151),'common':{'name':'Daily\x20Digests','type':_0x20053a(0x149),'role':_0x20053a(0x11a),'read':!![],'write':![]},'native':{}}),await _0x33c596[_0x20053a(0x105)]('LTM.trainingData.sequences',{'type':_0x20053a(0x151),'common':{'name':_0x20053a(0x79),'type':_0x20053a(0x149),'role':_0x20053a(0x11a),'read':!![],'write':![]},'native':{}}),await _0x33c596['setObjectNotExistsAsync']('LTM.trainingData.thermodynamics',{'type':_0x20053a(0x151),'common':{'name':'Thermodynamics','type':'string','role':_0x20053a(0x11a),'read':!![],'write':![]},'native':{}}),await _0x33c596[_0x20053a(0x105)](_0x20053a(0xb6),{'type':_0x20053a(0x151),'common':{'name':_0x20053a(0x111),'type':_0x20053a(0x145),'role':_0x20053a(0x9d),'read':!![],'write':!![]},'native':{}}),await _0x33c596[_0x20053a(0x105)](_0x20053a(0xb4),{'type':'state','common':{'name':_0x20053a(0x93),'type':_0x20053a(0x145),'role':_0x20053a(0x9d),'read':!![],'write':!![]},'native':{}}),await _0x33c596[_0x20053a(0x105)]('analysis.isAlert',{'type':'state','common':{'name':_0x20053a(0xd4),'type':_0x20053a(0x145),'role':_0x20053a(0xa9),'read':!![],'write':![]},'native':{}}),await _0x33c596[_0x20053a(0x105)](_0x20053a(0x110),{'type':'state','common':{'name':_0x20053a(0x13f),'type':'string','role':'text.alarm','read':!![],'write':![]},'native':{}});}async function recordThermodynamics(_0x2c5399,_0x36cadf,_0x300806,_0x14fdce){const _0x5ae938=a0_0x332d39,_0x479a96=await getOutsideTemperatureNumeric(_0x2c5399),_0x347781=await _0x2c5399[_0x5ae938(0xfb)](_0x5ae938(0x139));let _0x4f97c0=[];if(_0x347781&&_0x347781[_0x5ae938(0x14c)])try{_0x4f97c0=JSON[_0x5ae938(0x14a)](_0x347781[_0x5ae938(0x14c)]);}catch(_0x3d0f4c){}_0x4f97c0[_0x5ae938(0x141)]({'ts':Date[_0x5ae938(0x119)](),'room':_0x14fdce||_0x5ae938(0x125),'t_in':_0x300806,'t_out':_0x479a96});if(_0x4f97c0[_0x5ae938(0x9f)]>THERMO_LOG_SIZE)_0x4f97c0[_0x5ae938(0xbb)]();await _0x2c5399[_0x5ae938(0x15b)](_0x5ae938(0x139),{'val':JSON[_0x5ae938(0xc5)](_0x4f97c0),'ack':!![]});}function a0_0x2c48(){const _0x42e822=['Fokus\x20auf\x20Familienroutinen.','LTM.baselineStatus','logDuplicates','analysisHistory','Error\x20launching\x20Python:\x20','System\x20Mode','outdoorSensorId','toLocaleTimeString','LTM.driftAnalysis','date','analysis.energy.heatingScore','getHours','Energy\x20Intelligence','Success:\x20','targetposition','Failed:\x20','Sequences','Aktiv\x20(','bin','Heating\x20Score','analysis.analysisHistory','search','writable','[RECORDER]\x20Added\x20step\x20to\x20sequence:\x20','11JDnYtm','requirements.txt','LTM.dailyDigests','power','analysis.training.triggerHealth','Analysiere\x20ausgewogen.','payload','PRIORITÃ„T:\x20Gesundheit/AAL.','longitude','location','splice','Train\x20Health','analysis.history_debug_00','isProVersion','existsSync','kontakt','extendObjectAsync','[RECORDER]\x20Error\x20saving\x20sequence:\x20','Trigger\x20Briefing','system.','flot.','contact','eventHistory','analysis.training.triggerEnergy','round','Fokus\x20auf\x20Komfort.','success','forEach','button','currentSystemMode','length','javascript.','sequenceTimer','channel','shutter','klima','64383LwxhGJ','events.lastEvent','getForeignObjectAsync','simple-api.','indicator.alarm','name','substring','stdout','Insulation\x20Score','guest','online','HEALTH_TRAIN_RESULT','ðŸ\x20VENV:\x20','valve','analysis.security','analysis.triggerBriefing','humidity','analysis.trigger','join','map','4751704EBPIOQ','details','shift','warn','path','loc','7MuMGqV','material.','sensorLastValues','unshift','text','debug','stringify','switch','Trend\x20Value','No\x20module\x20named','notifyTelegramEnabled','brightness','[PYTHON]\x20','toString','normal','761414CnYMIc','constructor','startsWith','ANALYZE_SEQUENCE','exitTimer','history.','Alert\x20Status','party','system.mode','platform','split','trim','pop','python.exe','isPresent','Who\x20is\x20present?','TRAINING_COMPLETE','minDaysForBaseline','position','analysis.security.lastCheck','some','analysis.health.trendValue','Trend','\x20(Length:\x20','Activity-Level','python_service','66LNiiTy','common','lampe','PARTY','analysis.energy.insulationScore','âŒ\x20VENV\x20CREATION\x20FAILED.\x20sudo\x20apt\x20install\x20python3-venv','licht','Deaktiviert\x20(Pro-Feature)','763420SzwdTf','toFixed','getForeignStateAsync','type','system','cover','subscribeForeignStatesAsync','analysis.health.trendDiagnosis','door','activeSequence','error','getStateAsync','occupancy','âœ…\x20HEALTH\x20TRAINED','icons-mfd.','vacation','Last\x20Check','pythonProcess','heating','Security\x20Monitor','System','setObjectNotExistsAsync','stdin','temperatur','blind','analysis.energy','ENERGY_TRAIN_RESULT','latitude','ANOMALY','Event\x20History','[LOG]','status','analysis.alertReason','Trigger\x20Analysis','LTM.triggerDailyDigest','events.history','ANALYZE_TREND','0\x203\x20*\x20*\x20*','WiFi\x20Presence\x20detected.','off','analysis.security.lastScore','now','json','log','system.presenceWho','2993157cKjSME','Scripts','LTM','message','events.history_debug_00','admin.','number','PRIORITÃ„T:\x20Sicherheit.','Unknown','python','devices','\x20Tage)','system.config','config','analysis.training','@google/generative-ai','pip','analysis.health.isAnomaly','dailyDigests','dependencyInstallInProgress','uuid','heizung','Training\x20Status','schalter','pip.exe','energy','toLowerCase','delObjectAsync','LTM.trainingData.thermodynamics','presenceDevices','main','ðŸ›¡ï¸\x20SECURITY:\x20Score\x20','notifyTelegramInstance','Anomaly\x20Score','Alert\x20Reason','setpoint','push','light','models/gemini-flash-latest','toISOString','boolean','prÃ¤senz','Train\x20Energy','city','string','parse','1165kXtomh','val','analysis.health.lastCheck','indicator','Restoring\x20sensor\x20cache\x20from\x20history\x20(','(((.+)+)+)+$','state','includes','rawEventLog','\x22\x20install\x20-r\x20\x22','\x20->\x20','write','motion','value','.venv','19446MyMhWV','setStateAsync','Last\x20raw\x20event','NORMAL','close','GUEST','23971370gjZZEI','kill','apply','Train\x20Security','info','LTM.driftAnalysis.lastCheck'];a0_0x2c48=function(){return _0x42e822;};return a0_0x2c48();}async function getOutsideTemperatureNumeric(_0x112bfc){const _0x4cad7c=a0_0x332d39;if(_0x112bfc['config'][_0x4cad7c(0x16c)])try{const _0x199f91=await _0x112bfc[_0x4cad7c(0xf2)](_0x112bfc[_0x4cad7c(0x12a)][_0x4cad7c(0x16c)]);if(_0x199f91&&_0x199f91[_0x4cad7c(0x14c)]!==undefined&&_0x199f91['val']!==null)return parseFloat(_0x199f91[_0x4cad7c(0x14c)]);}catch(_0x21b86e){}return null;}async function recordSequence(_0x27c56f,_0x44deaa){const _0x150231=a0_0x332d39,_0x581a0c=(_0x44deaa[_0x150231(0xf3)]||'')[_0x150231(0x137)](),_0x40e34e=[_0x150231(0x157),'bewegung',_0x150231(0x146),'presence','occupancy',_0x150231(0xf8),'tÃ¼r','window','fenster',_0x150231(0x96),_0x150231(0x90),_0x150231(0x142),_0x150231(0xee),_0x150231(0xc6),_0x150231(0x134),'dimmer',_0x150231(0xea)];if(!_0x40e34e[_0x150231(0xe2)](_0x1e1fa9=>_0x581a0c[_0x150231(0x152)](_0x1e1fa9)))return;if(!_0x44deaa[_0x150231(0x158)])return;if(_0x27c56f[_0x150231(0xa1)])clearTimeout(_0x27c56f[_0x150231(0xa1)]);_0x27c56f[_0x150231(0xf9)][_0x150231(0x141)]({'loc':_0x44deaa[_0x150231(0x8a)]||_0x150231(0x125),'id':_0x44deaa['id'],'ts':Date[_0x150231(0x119)]()}),_0x27c56f['log'][_0x150231(0xc4)](_0x150231(0x80)+_0x44deaa[_0x150231(0x8a)]+_0x150231(0xe5)+_0x27c56f[_0x150231(0xf9)][_0x150231(0x9f)]+')'),_0x27c56f[_0x150231(0xa1)]=setTimeout(async()=>{const _0x14a7bd=_0x150231;if(_0x27c56f[_0x14a7bd(0xf9)]['length']>0x1)await saveCompletedSequence(_0x27c56f);_0x27c56f['activeSequence']=[];},SEQUENCE_TIMEOUT_MS);}async function saveCompletedSequence(_0x11f47e){const _0x5f35c2=a0_0x332d39;try{const _0x5eaeb6=await _0x11f47e[_0x5f35c2(0xfb)]('LTM.trainingData.sequences');let _0x34b745=[];if(_0x5eaeb6&&_0x5eaeb6[_0x5f35c2(0x14c)])try{_0x34b745=JSON[_0x5f35c2(0x14a)](_0x5eaeb6[_0x5f35c2(0x14c)]);}catch(_0x4641f9){}const _0x29cd47=_0x11f47e[_0x5f35c2(0xf9)][0x0]['ts'],_0x315cd9=_0x11f47e[_0x5f35c2(0xf9)][_0x5f35c2(0xb8)](_0x479e20=>({'loc':_0x479e20[_0x5f35c2(0xbe)],'t_delta':Math[_0x5f35c2(0x99)]((_0x479e20['ts']-_0x29cd47)/0x3e8)})),_0x5d09e4={'timestamp':new Date(_0x29cd47)[_0x5f35c2(0x144)](),'steps':_0x315cd9,'duration':Math[_0x5f35c2(0x99)]((_0x11f47e[_0x5f35c2(0xf9)][_0x11f47e[_0x5f35c2(0xf9)][_0x5f35c2(0x9f)]-0x1]['ts']-_0x29cd47)/0x3e8),'daytime':new Date(_0x29cd47)[_0x5f35c2(0x171)]()};_0x34b745['push'](_0x5d09e4);if(_0x34b745[_0x5f35c2(0x9f)]>MAX_TRAINING_SET_SIZE)_0x34b745[_0x5f35c2(0xbb)]();await _0x11f47e[_0x5f35c2(0x15b)]('LTM.trainingData.sequences',{'val':JSON['stringify'](_0x34b745),'ack':!![]}),runSecurityCheck(_0x11f47e,_0x5d09e4);}catch(_0x4a1141){_0x11f47e['log']['error'](_0x5f35c2(0x92)+_0x4a1141[_0x5f35c2(0x120)]);}}function runSecurityCheck(_0x38a9ad,_0x53a180){const _0x1b4545=a0_0x332d39;if(!_0x38a9ad['isProVersion'])return;_0x38a9ad[_0x1b4545(0x11b)][_0x1b4545(0xc4)]('ðŸ›¡ï¸\x20SECURITY:\x20Sending\x20sequence\x20to\x20Guard\x20for\x20analysis...'),sendToPython(_0x38a9ad,_0x1b4545(0xd1),{'sequence':_0x53a180});}async function processSensorEvent(_0x30a94b,_0x24e5ae,_0x18249c,_0x5655c4){const _0x3ca071=a0_0x332d39;if(!_0x5655c4)return;const _0x38d8b8=_0x18249c['val'],_0x20eaad=Date[_0x3ca071(0x119)](),_0x489723=_0x30a94b[_0x3ca071(0xc1)][_0x24e5ae];_0x30a94b[_0x3ca071(0xc1)][_0x24e5ae]=_0x38d8b8;if(!_0x5655c4[_0x3ca071(0x168)]&&_0x489723!=undefined&&_0x489723==_0x38d8b8)return;const _0x1a7cd3=(_0x5655c4[_0x3ca071(0xf3)]||'')[_0x3ca071(0x137)](),_0x26b9e1=_0x1a7cd3['includes']('temperature')||_0x1a7cd3[_0x3ca071(0x152)](_0x3ca071(0x107))||_0x1a7cd3[_0x3ca071(0x152)](_0x3ca071(0xa4))||_0x1a7cd3[_0x3ca071(0x152)](_0x3ca071(0x132));_0x30a94b[_0x3ca071(0x8e)]&&_0x26b9e1&&recordThermodynamics(_0x30a94b,_0x24e5ae,_0x38d8b8,_0x5655c4[_0x3ca071(0x8a)]);const _0x35e388={'timestamp':_0x20eaad,'id':_0x24e5ae,'name':_0x5655c4[_0x3ca071(0xaa)],'type':_0x5655c4[_0x3ca071(0xf3)],'location':_0x5655c4[_0x3ca071(0x8a)],'value':_0x38d8b8};_0x30a94b[_0x3ca071(0x97)]['unshift'](_0x35e388);if(_0x30a94b['eventHistory'][_0x3ca071(0x9f)]>HISTORY_MAX_SIZE)_0x30a94b['eventHistory'][_0x3ca071(0xda)]();await _0x30a94b[_0x3ca071(0x15b)](_0x3ca071(0xa6),{'val':JSON['stringify'](_0x35e388),'ack':!![]}),await _0x30a94b[_0x3ca071(0x15b)](_0x3ca071(0x113),{'val':JSON[_0x3ca071(0xc5)](_0x30a94b['eventHistory']),'ack':!![]}),_0x30a94b[_0x3ca071(0x8e)]&&(_0x30a94b[_0x3ca071(0x153)]['push'](_0x35e388),await saveRawEventLog(_0x30a94b),recordSequence(_0x30a94b,_0x35e388));}function installPythonDependencies(_0xb438d6){const _0x3f7aef=a0_0x332d39;if(_0xb438d6[_0x3f7aef(0x130)])return;_0xb438d6[_0x3f7aef(0x130)]=!![];const _0x534cba=path[_0x3f7aef(0xb7)](__dirname,_0x3f7aef(0xe7),_0x3f7aef(0x82));_0xb438d6[_0x3f7aef(0x11b)][_0x3f7aef(0x164)]('ðŸ› ï¸\x20MAINTENANCE:\x20Installing\x20Python\x20dependencies\x20(venv)...'),stopPythonService(_0xb438d6);if(fs[_0x3f7aef(0x8f)](VENV_PATH)&&!fs[_0x3f7aef(0x8f)](PIP_EXE))try{fs['rmSync'](VENV_PATH,{'recursive':!![],'force':!![]});}catch(_0x22ff75){}!fs[_0x3f7aef(0x8f)](VENV_PATH)?exec('python3\x20-m\x20venv\x20\x22'+VENV_PATH+'\x22',_0x17e204=>{const _0x14b632=_0x3f7aef;if(_0x17e204){_0xb438d6[_0x14b632(0x11b)][_0x14b632(0xfa)](_0x14b632(0xed)),_0xb438d6[_0x14b632(0x130)]=![];return;}installRequirementsInVenv(_0xb438d6,_0x534cba);}):installRequirementsInVenv(_0xb438d6,_0x534cba);}function installRequirementsInVenv(_0x56111c,_0x501373){const _0x5621cb=a0_0x332d39,_0x15d7c2='\x22'+PIP_EXE+_0x5621cb(0x154)+_0x501373+'\x22';exec(_0x15d7c2,{'timeout':0x124f80},(_0x7b1a40,_0x188ad8,_0x1bb4e2)=>{const _0x5f3a6f=_0x5621cb;_0x56111c[_0x5f3a6f(0x130)]=![],_0x7b1a40?_0x56111c[_0x5f3a6f(0x11b)][_0x5f3a6f(0xfa)]('âŒ\x20PIP\x20INSTALL\x20FAILED:\x20'+(_0x1bb4e2||_0x7b1a40[_0x5f3a6f(0x120)])):(_0x56111c[_0x5f3a6f(0x11b)][_0x5f3a6f(0x164)]('âœ…\x20INFRASTRUCTURE\x20READY.'),startPythonService(_0x56111c));});}function startPythonService(_0x4e0784){const _0x5a5eb1=a0_0x332d39;if(_0x4e0784['dependencyInstallInProgress'])return;let _0x13423c='python3';if(fs[_0x5a5eb1(0x8f)](PYTHON_EXE))_0x4e0784['log']['info'](_0x5a5eb1(0xb1)+PYTHON_EXE),_0x13423c=PYTHON_EXE;else{_0x4e0784['log'][_0x5a5eb1(0xbc)]('âš ï¸\x20VENV\x20missing.'),installPythonDependencies(_0x4e0784);return;}try{const _0x57692d=path[_0x5a5eb1(0xb7)](__dirname,_0x5a5eb1(0xe7),'service.py');_0x4e0784[_0x5a5eb1(0x101)]=spawn(_0x13423c,[_0x57692d]),_0x4e0784['pythonProcess'][_0x5a5eb1(0xac)]['on']('data',_0x2d7109=>{const _0x6c651f=_0x5a5eb1,_0x49bce3=_0x2d7109[_0x6c651f(0xcc)]()[_0x6c651f(0xd8)]('\x0a');_0x49bce3[_0x6c651f(0x9c)](_0x376b63=>{const _0x361ad0=_0x6c651f,_0x5b183c=_0x376b63[_0x361ad0(0xd9)]();if(!_0x5b183c)return;if(_0x5b183c['startsWith'](_0x361ad0(0x10e)))_0x4e0784[_0x361ad0(0x11b)][_0x361ad0(0xc4)](_0x361ad0(0xcb)+_0x5b183c[_0x361ad0(0xab)](0x5)[_0x361ad0(0xd9)]());else{if(_0x5b183c[_0x361ad0(0xd0)]('[RESULT]'))try{const _0x5d26f=JSON[_0x361ad0(0x14a)](_0x5b183c[_0x361ad0(0xab)](0x8)['trim']());handlePythonResult(_0x4e0784,_0x5d26f);}catch(_0x37ed0d){}}if(_0x5b183c[_0x361ad0(0x152)](_0x361ad0(0xc8)))installPythonDependencies(_0x4e0784);});}),_0x4e0784[_0x5a5eb1(0x101)]['on'](_0x5a5eb1(0x15e),_0x52772c=>{const _0x3377b7=_0x5a5eb1;_0x4e0784[_0x3377b7(0x11b)][_0x3377b7(0x164)]('[PYTHON]\x20Exited\x20'+_0x52772c),_0x4e0784['pythonProcess']=null;});}catch(_0x29231e){_0x4e0784['log'][_0x5a5eb1(0xfa)](_0x5a5eb1(0x16a)+_0x29231e[_0x5a5eb1(0x120)]);}}function stopPythonService(_0x4f7123){const _0x49247a=a0_0x332d39;if(_0x4f7123[_0x49247a(0x101)]){try{_0x4f7123['pythonProcess'][_0x49247a(0x161)]();}catch(_0x2139ad){}_0x4f7123[_0x49247a(0x101)]=null;}}function sendToPython(_0x380997,_0x3d15ba,_0x3cdbf5={}){const _0x38b0d2=a0_0x332d39;if(!_0x380997['pythonProcess']||!_0x380997[_0x38b0d2(0x101)][_0x38b0d2(0x106)][_0x38b0d2(0x7f)])return;const _0x292ac0=JSON[_0x38b0d2(0xc5)]({'command':_0x3d15ba,..._0x3cdbf5});try{_0x380997[_0x38b0d2(0x101)][_0x38b0d2(0x106)][_0x38b0d2(0x156)](_0x292ac0+'\x0a');}catch(_0x1ed577){}}function handlePythonResult(_0x1c45b3,_0x2c1a42){const _0xd696cc=a0_0x332d39;if(_0x2c1a42['type']==='SECURITY_RESULT'){const {anomaly_score:_0x4a1211,is_anomaly:_0x34807d}=_0x2c1a42[_0xd696cc(0x87)];_0x1c45b3[_0xd696cc(0x11b)]['info'](_0xd696cc(0x13c)+_0x4a1211[_0xd696cc(0xf1)](0x5)+_0xd696cc(0x155)+(_0x34807d?_0xd696cc(0x10c):'OK')),_0x1c45b3[_0xd696cc(0x15b)](_0xd696cc(0x118),{'val':_0x4a1211,'ack':!![]}),_0x1c45b3[_0xd696cc(0x15b)](_0xd696cc(0xe1),{'val':new Date()[_0xd696cc(0x144)](),'ack':!![]});}else{if(_0x2c1a42[_0xd696cc(0xf3)]===_0xd696cc(0xde)){const {success:_0x4e9e3b,details:_0x458d07}=_0x2c1a42[_0xd696cc(0x87)];_0x1c45b3[_0xd696cc(0x15b)]('analysis.training.status',{'val':_0x4e9e3b?_0xd696cc(0x173)+new Date()[_0xd696cc(0x16d)]():_0xd696cc(0x78)+_0x458d07,'ack':!![]});}else{if(_0x2c1a42['type']===_0xd696cc(0x10a)){if(_0x2c1a42[_0xd696cc(0x87)][_0xd696cc(0x9b)])try{const _0x3c3368=JSON[_0xd696cc(0x14a)](_0x2c1a42['payload'][_0xd696cc(0xba)]);if(_0x3c3368['insulation'])_0x1c45b3[_0xd696cc(0x15b)](_0xd696cc(0xec),{'val':JSON[_0xd696cc(0xc5)](_0x3c3368['insulation']),'ack':!![]});if(_0x3c3368['heating'])_0x1c45b3[_0xd696cc(0x15b)](_0xd696cc(0x170),{'val':JSON['stringify'](_0x3c3368[_0xd696cc(0x102)]),'ack':!![]});}catch(_0x1ba2b7){}}else{if(_0x2c1a42[_0xd696cc(0xf3)]===_0xd696cc(0xb0)){if(_0x2c1a42[_0xd696cc(0x87)][_0xd696cc(0x9b)])_0x1c45b3[_0xd696cc(0x11b)][_0xd696cc(0x164)](_0xd696cc(0xfd));}else{if(_0x2c1a42[_0xd696cc(0xf3)]==='HEALTH_RESULT'){const {is_anomaly:_0xac03d8}=_0x2c1a42['payload'];_0x1c45b3[_0xd696cc(0x15b)](_0xd696cc(0x14d),{'val':new Date()[_0xd696cc(0x144)](),'ack':!![]}),_0x1c45b3[_0xd696cc(0x15b)](_0xd696cc(0x12e),{'val':_0xac03d8,'ack':!![]});}}}}}}function runPythonHealthCheck(_0x554d51){const _0x47893d=a0_0x332d39;if(!_0x554d51[_0x47893d(0x12f)]||_0x554d51[_0x47893d(0x12f)][_0x47893d(0x9f)]<0x2)return;const _0x31fa2c=_0x554d51[_0x47893d(0x12f)]['map'](_0x29e7fa=>{const _0x578d94=_0x47893d,_0x27f8d6=(_0x29e7fa['activityLevel']||'')[_0x578d94(0x137)]();return ACTIVITY_LEVEL_MAP[_0x27f8d6]||0x32;});sendToPython(_0x554d51,_0x47893d(0x114),{'values':_0x31fa2c,'tag':_0x47893d(0xe6)});}async function initSensorSubscriptions(_0x37c588){const _0xd679cf=a0_0x332d39,_0x49b15a=_0x37c588[_0xd679cf(0x12a)][_0xd679cf(0x127)];if(_0x49b15a)for(const _0xa41f54 of _0x49b15a){await _0x37c588[_0xd679cf(0xf6)](_0xa41f54['id']);}}async function initPresenceSubscriptions(_0x92e1c){const _0x28f578=a0_0x332d39,_0x429d99=_0x92e1c[_0x28f578(0x12a)][_0x28f578(0x13a)];if(_0x429d99)for(const _0x1aa5c1 of _0x429d99){await _0x92e1c[_0x28f578(0xf6)](_0x1aa5c1);}}async function setupTelegramListener(_0x212de6){const _0x47ec31=a0_0x332d39,_0x469817=_0x212de6['config'][_0x47ec31(0x13d)];if(_0x212de6[_0x47ec31(0x12a)][_0x47ec31(0xc9)]&&_0x469817)await _0x212de6['subscribeForeignStatesAsync'](_0x469817+'.communicate.request');}async function checkWifiPresence(_0x262be2){const _0x3ddaf8=a0_0x332d39;try{const _0x56de4b=_0x262be2['config'][_0x3ddaf8(0x13a)]||[];let _0x4b9237=![];const _0x57468b=[];for(const _0x258cc8 of _0x56de4b){try{const _0x4ca0f5=await _0x262be2[_0x3ddaf8(0xf2)](_0x258cc8);_0x4ca0f5&&(_0x4ca0f5[_0x3ddaf8(0x14c)]===!![]||_0x4ca0f5[_0x3ddaf8(0x14c)]===_0x3ddaf8(0xaf)||_0x4ca0f5[_0x3ddaf8(0x14c)]===0x1)&&(_0x4b9237=!![],_0x57468b['push'](_0x258cc8));}catch(_0x320b2f){}}return await _0x262be2['setStateAsync'](_0x3ddaf8(0x11c),{'val':_0x57468b['join'](',\x20'),'ack':!![]}),_0x4b9237&&(_0x262be2[_0x3ddaf8(0xd2)]&&(_0x262be2['log'][_0x3ddaf8(0x164)](_0x3ddaf8(0x116)),abortExitTimer(_0x262be2)),!_0x262be2[_0x3ddaf8(0xdc)]&&_0x262be2[_0x3ddaf8(0x9e)]===SYSTEM_MODES[_0x3ddaf8(0x15d)]&&await setPresence(_0x262be2,!![])),_0x4b9237;}catch(_0xbcf8b5){return![];}}if(require[a0_0x332d39(0x13b)]!==module)module['exports']=_0x56ad72=>new CogniLiving(_0x56ad72);else new CogniLiving();