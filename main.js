const a0_0xdf77=a0_0x5ec5;(function(_0x4be5a1,_0x2baf20){const _0x4cc8b3=a0_0x5ec5,_0x47e252=_0x4be5a1();while(!![]){try{const _0x31ac7b=-parseInt(_0x4cc8b3(0x1fc))/0x1*(-parseInt(_0x4cc8b3(0x255))/0x2)+-parseInt(_0x4cc8b3(0x209))/0x3+-parseInt(_0x4cc8b3(0x294))/0x4+parseInt(_0x4cc8b3(0x222))/0x5+parseInt(_0x4cc8b3(0x26e))/0x6+-parseInt(_0x4cc8b3(0x2ac))/0x7+-parseInt(_0x4cc8b3(0x2a5))/0x8;if(_0x31ac7b===_0x2baf20)break;else _0x47e252['push'](_0x47e252['shift']());}catch(_0x267b6d){_0x47e252['push'](_0x47e252['shift']());}}}(a0_0x1c0e,0xb5b1c));const a0_0x118dbc=(function(){let _0x23b10e=!![];return function(_0x4cdcfc,_0x3c9b3b){const _0x430384=_0x23b10e?function(){const _0x5f18f3=a0_0x5ec5;if(_0x3c9b3b){const _0x5b86b3=_0x3c9b3b[_0x5f18f3(0x2e1)](_0x4cdcfc,arguments);return _0x3c9b3b=null,_0x5b86b3;}}:function(){};return _0x23b10e=![],_0x430384;};}()),a0_0x2ab846=a0_0x118dbc(this,function(){const _0x5eb811=a0_0x5ec5;return a0_0x2ab846['toString']()[_0x5eb811(0x200)](_0x5eb811(0x2aa))['toString']()[_0x5eb811(0x224)](a0_0x2ab846)['search'](_0x5eb811(0x2aa));});a0_0x2ab846();'use strict';const utils=require(a0_0xdf77(0x285)),{GoogleGenerativeAI}=require(a0_0xdf77(0x2fb)),schedule=require(a0_0xdf77(0x226)),{spawn,exec}=require(a0_0xdf77(0x30c)),path=require(a0_0xdf77(0x1f3)),fs=require('fs'),HISTORY_MAX_SIZE=0x32,RAW_LOG_MAX_SIZE=0x5dc,LTM_MIN_EVENTS_FOR_COMPRESSION=0x5,GEMINI_MODEL=a0_0xdf77(0x334),LTM_SCHEDULE=a0_0xdf77(0x34c),MODE_RESET_SCHEDULE='0\x204\x20*\x20*\x20*',SEQUENCE_TIMEOUT_MS=0x5*0x3c*0x3e8,MAX_TRAINING_SET_SIZE=0x1f4,THERMO_LOG_SIZE=0x3e8,EXIT_TIMER_MINUTES=0xf,EXIT_GRACE_PERIOD_SECONDS=0x1e,LTM_DP_RAW_LOG=a0_0xdf77(0x349),LTM_DP_DAILY_DIGESTS=a0_0xdf77(0x2c8),LTM_DP_STATUS=a0_0xdf77(0x1fb),LTM_DP_TRIGGER_DIGEST=a0_0xdf77(0x2a4),LTM_DP_BASELINE_STATUS=a0_0xdf77(0x323),LTM_DP_DRIFT_CHANNEL=a0_0xdf77(0x24a),LTM_DP_DRIFT_STATUS=a0_0xdf77(0x2af),LTM_DP_DRIFT_DETAILS=a0_0xdf77(0x274),LTM_DP_DRIFT_LAST_CHECK=a0_0xdf77(0x312),SYSTEM_DP_MODE=a0_0xdf77(0x22f),SYSTEM_MODES={'NORMAL':a0_0xdf77(0x232),'VACATION':a0_0xdf77(0x278),'PARTY':a0_0xdf77(0x348),'GUEST':a0_0xdf77(0x375)},AUTO_RESET_MODES=[SYSTEM_MODES[a0_0xdf77(0x33a)],SYSTEM_MODES[a0_0xdf77(0x370)]],PERSONA_MAPPING={'generic':a0_0xdf77(0x2d3),'senior_aal':a0_0xdf77(0x1eb),'family':a0_0xdf77(0x25a),'single_comfort':'Fokus\x20auf\x20Komfort.','security':a0_0xdf77(0x2ce)},ACTIVITY_LEVEL_MAP={'sehr\x20hoch':0x64,'hoch':0x50,'normal':0x3c,'niedrig':0x28,'sehr\x20niedrig':0x14,'inaktiv':0x0},IS_WIN=process['platform']==='win32',PERSISTENT_DIR=path['join'](__dirname,a0_0xdf77(0x32c)),VENV_PATH=PERSISTENT_DIR,PYTHON_EXE=IS_WIN?path[a0_0xdf77(0x202)](VENV_PATH,a0_0xdf77(0x28c),a0_0xdf77(0x2c4)):path[a0_0xdf77(0x202)](VENV_PATH,a0_0xdf77(0x23e),a0_0xdf77(0x356)),PIP_EXE=IS_WIN?path[a0_0xdf77(0x202)](VENV_PATH,'Scripts',a0_0xdf77(0x2cc)):path['join'](VENV_PATH,a0_0xdf77(0x23e),'pip');let activeSequence=[],sequenceTimer=null;async function startSystem(_0xda4835){const _0xe67a7=a0_0xdf77;_0xda4835[_0xe67a7(0x30b)][_0xe67a7(0x293)](_0xe67a7(0x25c)),await initZombies(_0xda4835);try{_0xda4835[_0xe67a7(0x300)]=await checkLicense(_0xda4835[_0xe67a7(0x25e)][_0xe67a7(0x2fe)]);}catch(_0x11ecf3){}if(!_0xda4835[_0xe67a7(0x25e)][_0xe67a7(0x2be)]||_0xda4835[_0xe67a7(0x25e)][_0xe67a7(0x2be)]<0.1)_0xda4835[_0xe67a7(0x25e)][_0xe67a7(0x2be)]=0xc;await initHistory(_0xda4835),await initSystemConfig(_0xda4835);if(_0xda4835[_0xe67a7(0x25e)][_0xe67a7(0x295)])try{_0xda4835[_0xe67a7(0x2cd)]=new GoogleGenerativeAI(_0xda4835[_0xe67a7(0x25e)][_0xe67a7(0x295)]),_0xda4835[_0xe67a7(0x29e)]=_0xda4835[_0xe67a7(0x2cd)][_0xe67a7(0x28e)]({'model':GEMINI_MODEL,'generationConfig':{'responseMimeType':_0xe67a7(0x380)}}),_0xda4835[_0xe67a7(0x30b)][_0xe67a7(0x293)](_0xe67a7(0x2d9));}catch(_0x3e49a3){_0xda4835['log']['error'](_0xe67a7(0x368)+_0x3e49a3[_0xe67a7(0x2b3)]);}await createAllObjects(_0xda4835),await loadSystemMode(_0xda4835),await loadRawEventLog(_0xda4835),await loadDailyDigests(_0xda4835),_0xda4835['subscribeStates'](_0xe67a7(0x242)),_0xda4835[_0xe67a7(0x247)](LTM_DP_TRIGGER_DIGEST),_0xda4835[_0xe67a7(0x247)](_0xe67a7(0x22f)),_0xda4835[_0xe67a7(0x247)](_0xe67a7(0x206)),_0xda4835[_0xe67a7(0x247)]('analysis.automation.triggerAction'),_0xda4835[_0xe67a7(0x247)]('analysis.automation.autoApply'),_0xda4835[_0xe67a7(0x247)](_0xe67a7(0x27d)),_0xda4835[_0xe67a7(0x247)](_0xe67a7(0x33f)),_0xda4835['subscribeStates'](_0xe67a7(0x2b5)),await initSensorSubscriptions(_0xda4835),await initPresenceSubscriptions(_0xda4835),await setupTelegramListener(_0xda4835),setTimeout(()=>checkWifiPresence(_0xda4835),0x1388);if(_0xda4835['analysisTimer'])clearInterval(_0xda4835['analysisTimer']);const _0x2672fe=_0xda4835[_0xe67a7(0x25e)][_0xe67a7(0x35a)]||0xf;_0x2672fe>0x0&&(_0xda4835[_0xe67a7(0x35b)]=setInterval(()=>{runAutopilot(_0xda4835);},_0x2672fe*0x3c*0x3e8)),setupLtmScheduler(_0xda4835),setupModeResetScheduler(_0xda4835),setupDriftAnalysisScheduler(_0xda4835),setupBriefingScheduler(_0xda4835),startPythonService(_0xda4835),setTimeout(()=>{const _0x478d81=_0xe67a7;if(_0xda4835[_0x478d81(0x2ba)])runPythonHealthCheck(_0xda4835);},0x1388);}function checkAndInstall(_0x10e8ce){const _0x22d36b=a0_0xdf77;if(!fs[_0x22d36b(0x302)](VENV_PATH)||!fs[_0x22d36b(0x302)](PIP_EXE))return _0x10e8ce[_0x22d36b(0x30b)][_0x22d36b(0x342)](_0x22d36b(0x249)+VENV_PATH+_0x22d36b(0x2b6)),installPythonDependencies(_0x10e8ce),![];return!![];}function installPythonDependencies(_0x1ac119){const _0x51dd44=a0_0xdf77;if(_0x1ac119[_0x51dd44(0x2db)])return;_0x1ac119[_0x51dd44(0x2db)]=!![];const _0x12b626=path[_0x51dd44(0x202)](__dirname,_0x51dd44(0x246),_0x51dd44(0x204));stopPythonService(_0x1ac119);if(fs['existsSync'](VENV_PATH))try{fs[_0x51dd44(0x337)](VENV_PATH,{'recursive':!![],'force':!![]});}catch(_0x2df765){}_0x1ac119['log'][_0x51dd44(0x293)](_0x51dd44(0x2bb)+VENV_PATH),exec(_0x51dd44(0x35f)+VENV_PATH+'\x22',_0x4f690f=>{const _0x40fe08=_0x51dd44;if(_0x4f690f){_0x1ac119[_0x40fe08(0x30b)][_0x40fe08(0x225)]('âŒ\x20VENV\x20FAILED.\x20Run:\x20sudo\x20apt\x20install\x20python3-venv'),_0x1ac119['dependencyInstallInProgress']=![];return;}installRequirementsInVenv(_0x1ac119,_0x12b626);});}function installRequirementsInVenv(_0xcc0e22,_0x77c002){const _0x20a7c3=a0_0xdf77;_0xcc0e22['log'][_0x20a7c3(0x293)](_0x20a7c3(0x2ed));const _0x28ffea='\x22'+PIP_EXE+_0x20a7c3(0x2e0)+_0x77c002+'\x22';exec(_0x28ffea,{'timeout':0x124f80},(_0x2cb5dd,_0x2f33e8,_0x3f5729)=>{const _0x4c5e88=_0x20a7c3;_0xcc0e22[_0x4c5e88(0x2db)]=![],_0x2cb5dd?_0xcc0e22[_0x4c5e88(0x30b)][_0x4c5e88(0x225)](_0x4c5e88(0x32e)+(_0x3f5729||_0x2cb5dd[_0x4c5e88(0x2b3)])):(_0xcc0e22[_0x4c5e88(0x30b)][_0x4c5e88(0x293)](_0x4c5e88(0x373)),startSystem(_0xcc0e22));});}async function initZombies(_0x1c4659){const _0x2e1099=a0_0xdf77;try{const _0x3755b7=[_0x2e1099(0x2ab),'events.history_debug_00'];for(const _0x2e8df5 of _0x3755b7){try{const _0x57c62f=await _0x1c4659[_0x2e1099(0x327)](_0x2e8df5);if(_0x57c62f)await _0x1c4659['delObjectAsync'](_0x2e8df5);}catch(_0xf76fa4){}}}catch(_0x17cde0){}}async function checkLicense(_0x5b8bb5){return!![];}async function initHistory(_0x50682d){const _0x227679=a0_0xdf77;try{const _0x1992ee=await _0x50682d['getStateAsync'](_0x227679(0x31a));_0x1992ee&&_0x1992ee[_0x227679(0x27c)]&&(_0x50682d[_0x227679(0x2e3)]=JSON[_0x227679(0x2bd)](_0x1992ee['val'][_0x227679(0x364)]()));}catch(_0x55b459){_0x50682d['eventHistory']=[];}try{const _0x41c48a=await _0x50682d[_0x227679(0x230)]('analysis.analysisHistory');if(_0x41c48a&&_0x41c48a[_0x227679(0x27c)])_0x50682d[_0x227679(0x2d7)]=JSON[_0x227679(0x2bd)](_0x41c48a['val'][_0x227679(0x364)]());}catch(_0x478ce6){_0x50682d['analysisHistory']=[];}if(_0x50682d[_0x227679(0x2e3)]&&_0x50682d[_0x227679(0x2e3)][_0x227679(0x314)]>0x0){_0x50682d['log'][_0x227679(0x293)](_0x227679(0x2b1));for(let _0x2fde45=_0x50682d[_0x227679(0x2e3)][_0x227679(0x314)]-0x1;_0x2fde45>=0x0;_0x2fde45--){const _0x15ed97=_0x50682d[_0x227679(0x2e3)][_0x2fde45];if(_0x15ed97&&_0x15ed97['id']!==undefined&&_0x15ed97['value']!==undefined)_0x50682d[_0x227679(0x208)][_0x15ed97['id']]=_0x15ed97[_0x227679(0x31d)];}}}async function initSystemConfig(_0x3b858c){const _0x4064ac=a0_0xdf77;try{const _0x5670b7=await _0x3b858c[_0x4064ac(0x36a)]('system.config');if(_0x5670b7&&_0x5670b7[_0x4064ac(0x261)])_0x3b858c[_0x4064ac(0x2bc)]={'latitude':_0x5670b7[_0x4064ac(0x261)][_0x4064ac(0x2a8)]||0x0,'longitude':_0x5670b7[_0x4064ac(0x261)][_0x4064ac(0x265)]||0x0,'city':_0x5670b7['common']['city']||''};}catch(_0x4f2ab3){}}async function createAllObjects(_0x4739f2){const _0x558f31=a0_0xdf77;await _0x4739f2[_0x558f31(0x350)](_0x558f31(0x36b),{'type':_0x558f31(0x1f5),'common':{'name':_0x558f31(0x33c)},'native':{}}),await _0x4739f2[_0x558f31(0x350)](SYSTEM_DP_MODE,{'type':_0x558f31(0x2ea),'common':{'name':'System\x20Mode','type':_0x558f31(0x309),'role':'state','read':!![],'write':!![],'def':SYSTEM_MODES[_0x558f31(0x367)]},'native':{}}),await _0x4739f2['setObjectNotExistsAsync'](_0x558f31(0x2d5),{'type':_0x558f31(0x2ea),'common':{'name':_0x558f31(0x37a),'type':_0x558f31(0x309),'role':_0x558f31(0x32d),'read':!![],'write':![]},'native':{}}),await _0x4739f2[_0x558f31(0x20b)]('events.lastEvent',{'type':_0x558f31(0x2ea),'common':{'name':_0x558f31(0x2ca),'type':'string','role':'json','read':!![],'write':![]},'native':{}}),await _0x4739f2[_0x558f31(0x20b)](_0x558f31(0x31a),{'type':_0x558f31(0x2ea),'common':{'name':_0x558f31(0x229),'type':_0x558f31(0x309),'role':_0x558f31(0x23b),'read':!![],'write':![]},'native':{}}),await _0x4739f2[_0x558f31(0x350)](_0x558f31(0x2e8),{'type':_0x558f31(0x1f5),'common':{'name':_0x558f31(0x332)},'native':{}}),await _0x4739f2[_0x558f31(0x20b)]('analysis.training.triggerSecurity',{'type':'state','common':{'name':_0x558f31(0x258),'type':_0x558f31(0x2a6),'role':_0x558f31(0x1f1),'read':!![],'write':!![]},'native':{}}),await _0x4739f2[_0x558f31(0x20b)](_0x558f31(0x33f),{'type':_0x558f31(0x2ea),'common':{'name':_0x558f31(0x243),'type':_0x558f31(0x2a6),'role':_0x558f31(0x1f1),'read':!![],'write':!![]},'native':{}}),await _0x4739f2[_0x558f31(0x20b)](_0x558f31(0x2b5),{'type':'state','common':{'name':_0x558f31(0x27f),'type':_0x558f31(0x2a6),'role':_0x558f31(0x1f1),'read':!![],'write':!![]},'native':{}}),await _0x4739f2[_0x558f31(0x20b)]('analysis.training.status',{'type':_0x558f31(0x2ea),'common':{'name':'Training\x20Status','type':_0x558f31(0x309),'role':_0x558f31(0x32d),'read':!![],'write':![]},'native':{}}),await _0x4739f2[_0x558f31(0x350)](_0x558f31(0x20c),{'type':_0x558f31(0x1f5),'common':{'name':_0x558f31(0x325)},'native':{}}),await _0x4739f2[_0x558f31(0x20b)](_0x558f31(0x32a),{'type':_0x558f31(0x2ea),'common':{'name':'Anomaly\x20Score','type':_0x558f31(0x354),'role':'value','read':!![],'write':![]},'native':{}}),await _0x4739f2[_0x558f31(0x20b)]('analysis.security.currentThreshold',{'type':_0x558f31(0x2ea),'common':{'name':_0x558f31(0x36e),'type':_0x558f31(0x354),'role':'value','read':!![],'write':![],'def':0.05},'native':{}}),await _0x4739f2[_0x558f31(0x20b)](_0x558f31(0x317),{'type':_0x558f31(0x2ea),'common':{'name':_0x558f31(0x358),'type':_0x558f31(0x309),'role':_0x558f31(0x321),'read':!![],'write':![]},'native':{}}),await _0x4739f2[_0x558f31(0x350)](_0x558f31(0x20f),{'type':_0x558f31(0x1f5),'common':{'name':'Health\x20Analysis'},'native':{}}),await _0x4739f2[_0x558f31(0x20b)](_0x558f31(0x297),{'type':_0x558f31(0x2ea),'common':{'name':_0x558f31(0x358),'type':_0x558f31(0x309),'role':'date','read':!![],'write':![]},'native':{}}),await _0x4739f2[_0x558f31(0x20b)](_0x558f31(0x220),{'type':'state','common':{'name':_0x558f31(0x26b),'type':'boolean','role':_0x558f31(0x1fa),'read':!![],'write':![]},'native':{}}),await _0x4739f2['setObjectNotExistsAsync'](_0x558f31(0x341),{'type':_0x558f31(0x2ea),'common':{'name':_0x558f31(0x267),'type':_0x558f31(0x309),'role':'text','read':!![],'write':![]},'native':{}}),await _0x4739f2['setObjectNotExistsAsync']('analysis.health.trendValue',{'type':_0x558f31(0x2ea),'common':{'name':_0x558f31(0x340),'type':_0x558f31(0x354),'role':_0x558f31(0x31d),'read':!![],'write':![]},'native':{}}),await _0x4739f2[_0x558f31(0x350)](_0x558f31(0x216),{'type':'channel','common':{'name':_0x558f31(0x2c7)},'native':{}}),await _0x4739f2[_0x558f31(0x20b)](_0x558f31(0x280),{'type':_0x558f31(0x2ea),'common':{'name':'Insulation\x20Score','type':_0x558f31(0x309),'role':_0x558f31(0x32d),'read':!![],'write':![]},'native':{}}),await _0x4739f2[_0x558f31(0x20b)](_0x558f31(0x24c),{'type':_0x558f31(0x2ea),'common':{'name':_0x558f31(0x319),'type':_0x558f31(0x309),'role':_0x558f31(0x32d),'read':!![],'write':![]},'native':{}}),await _0x4739f2['extendObjectAsync'](_0x558f31(0x28f),{'type':'channel','common':{'name':_0x558f31(0x28f)},'native':{}}),await _0x4739f2[_0x558f31(0x350)](LTM_DP_RAW_LOG,{'type':_0x558f31(0x2ea),'common':{'name':_0x558f31(0x376),'type':_0x558f31(0x309),'role':_0x558f31(0x23b),'read':!![],'write':![]},'native':{}}),await _0x4739f2[_0x558f31(0x350)](LTM_DP_DAILY_DIGESTS,{'type':'state','common':{'name':'Daily\x20Digests','type':_0x558f31(0x309),'role':'json','read':!![],'write':![]},'native':{}}),await _0x4739f2['setObjectNotExistsAsync'](_0x558f31(0x272),{'type':'state','common':{'name':_0x558f31(0x21a),'type':'string','role':_0x558f31(0x23b),'read':!![],'write':![]},'native':{}}),await _0x4739f2[_0x558f31(0x20b)](_0x558f31(0x29a),{'type':_0x558f31(0x2ea),'common':{'name':_0x558f31(0x299),'type':_0x558f31(0x309),'role':_0x558f31(0x23b),'read':!![],'write':![]},'native':{}}),await _0x4739f2['setObjectNotExistsAsync']('analysis.trigger',{'type':_0x558f31(0x2ea),'common':{'name':_0x558f31(0x256),'type':_0x558f31(0x2a6),'role':_0x558f31(0x1f1),'read':!![],'write':!![]},'native':{}}),await _0x4739f2[_0x558f31(0x20b)](_0x558f31(0x206),{'type':_0x558f31(0x2ea),'common':{'name':_0x558f31(0x2d0),'type':_0x558f31(0x2a6),'role':'button','read':!![],'write':!![]},'native':{}}),await _0x4739f2[_0x558f31(0x20b)](_0x558f31(0x24e),{'type':'state','common':{'name':_0x558f31(0x1f6),'type':'boolean','role':_0x558f31(0x263),'read':!![],'write':![]},'native':{}}),await _0x4739f2[_0x558f31(0x20b)](_0x558f31(0x29c),{'type':_0x558f31(0x2ea),'common':{'name':'Alert\x20Reason','type':_0x558f31(0x309),'role':_0x558f31(0x2eb),'read':!![],'write':![]},'native':{}}),await _0x4739f2[_0x558f31(0x20b)](_0x558f31(0x305),{'type':_0x558f31(0x2ea),'common':{'name':_0x558f31(0x2ad),'type':_0x558f31(0x309),'role':_0x558f31(0x32d),'read':!![],'write':![]},'native':{}}),await _0x4739f2['setObjectNotExistsAsync'](_0x558f31(0x2b7),{'type':_0x558f31(0x2ea),'common':{'name':'Pattern\x20Detected','type':_0x558f31(0x2a6),'role':_0x558f31(0x1fa),'read':!![],'write':![]},'native':{}}),await _0x4739f2[_0x558f31(0x20b)](_0x558f31(0x24f),{'type':_0x558f31(0x2ea),'common':{'name':_0x558f31(0x2ff),'type':_0x558f31(0x309),'role':_0x558f31(0x32d),'read':!![],'write':![]},'native':{}}),await _0x4739f2['setObjectNotExistsAsync'](_0x558f31(0x2f9),{'type':'state','common':{'name':_0x558f31(0x29b),'type':_0x558f31(0x309),'role':_0x558f31(0x32d),'read':!![],'write':![]},'native':{}}),await _0x4739f2['setObjectNotExistsAsync'](_0x558f31(0x2b0),{'type':_0x558f31(0x2ea),'common':{'name':_0x558f31(0x26c),'type':_0x558f31(0x309),'role':_0x558f31(0x32d),'read':!![],'write':![]},'native':{}}),await _0x4739f2['setObjectNotExistsAsync'](_0x558f31(0x351),{'type':'state','common':{'name':_0x558f31(0x2b9),'type':_0x558f31(0x2a6),'role':_0x558f31(0x250),'read':!![],'write':!![]},'native':{}}),await _0x4739f2[_0x558f31(0x20b)](_0x558f31(0x344),{'type':_0x558f31(0x2ea),'common':{'name':_0x558f31(0x301),'type':_0x558f31(0x2a6),'role':_0x558f31(0x1f1),'read':!![],'write':!![]},'native':{}});}async function loadSystemMode(_0x495cea){const _0x128e2c=a0_0xdf77;try{const _0x4f1c07=await _0x495cea[_0x128e2c(0x230)](SYSTEM_DP_MODE);_0x4f1c07&&_0x4f1c07[_0x128e2c(0x27c)]&&Object[_0x128e2c(0x360)](SYSTEM_MODES)[_0x128e2c(0x2d4)](_0x4f1c07[_0x128e2c(0x27c)])?_0x495cea[_0x128e2c(0x357)]=_0x4f1c07[_0x128e2c(0x27c)]:(_0x495cea['currentSystemMode']=SYSTEM_MODES[_0x128e2c(0x367)],await _0x495cea[_0x128e2c(0x1ea)](SYSTEM_DP_MODE,{'val':SYSTEM_MODES[_0x128e2c(0x367)],'ack':!![]}));}catch(_0x297ac9){_0x495cea['currentSystemMode']=SYSTEM_MODES['NORMAL'];}}async function loadRawEventLog(_0x5c279b){const _0x17bd84=a0_0xdf77;try{const _0x55333f=await _0x5c279b[_0x17bd84(0x230)](LTM_DP_RAW_LOG);if(_0x55333f&&_0x55333f['val'])_0x5c279b[_0x17bd84(0x32f)]=JSON[_0x17bd84(0x2bd)](_0x55333f['val']);}catch(_0x628179){_0x5c279b[_0x17bd84(0x32f)]=[];}}async function saveRawEventLog(_0x4ac224){const _0x207e3a=a0_0xdf77;if(_0x4ac224[_0x207e3a(0x32f)][_0x207e3a(0x314)]>RAW_LOG_MAX_SIZE)_0x4ac224[_0x207e3a(0x32f)][_0x207e3a(0x2ee)](0x0,_0x4ac224[_0x207e3a(0x32f)][_0x207e3a(0x314)]-RAW_LOG_MAX_SIZE);await _0x4ac224[_0x207e3a(0x1ea)](LTM_DP_RAW_LOG,{'val':JSON['stringify'](_0x4ac224['rawEventLog']),'ack':!![]});}function a0_0x5ec5(_0x491d06,_0x43a11a){const _0x519572=a0_0x1c0e();return a0_0x5ec5=function(_0x2ab846,_0x118dbc){_0x2ab846=_0x2ab846-0x1e9;let _0x1c0e5d=_0x519572[_0x2ab846];return _0x1c0e5d;},a0_0x5ec5(_0x491d06,_0x43a11a);}async function loadDailyDigests(_0x1d655d){const _0x3bd070=a0_0xdf77;try{const _0x605823=await _0x1d655d[_0x3bd070(0x230)](LTM_DP_DAILY_DIGESTS);if(_0x605823&&_0x605823[_0x3bd070(0x27c)])_0x1d655d[_0x3bd070(0x282)]=JSON[_0x3bd070(0x2bd)](_0x605823[_0x3bd070(0x27c)]);}catch(_0x512d9b){_0x1d655d[_0x3bd070(0x282)]=[];}await updateBaselineStatus(_0x1d655d);}async function saveDailyDigests(_0x36421b,_0x32c765=!![]){const _0x5e7e7a=a0_0xdf77,_0x23c84f=_0x36421b[_0x5e7e7a(0x25e)][_0x5e7e7a(0x221)]||0x3c;_0x36421b[_0x5e7e7a(0x282)][_0x5e7e7a(0x314)]>_0x23c84f&&_0x36421b[_0x5e7e7a(0x282)][_0x5e7e7a(0x2ee)](0x0,_0x36421b[_0x5e7e7a(0x282)][_0x5e7e7a(0x314)]-_0x23c84f);await _0x36421b[_0x5e7e7a(0x1ea)](LTM_DP_DAILY_DIGESTS,{'val':JSON[_0x5e7e7a(0x1ef)](_0x36421b[_0x5e7e7a(0x282)]),'ack':!![]});if(_0x32c765)await updateBaselineStatus(_0x36421b);}function a0_0x1c0e(){const _0x381358=['scanDevices','version','analysis.health','Sec-Training\x20started...','summary','COGNI_CONFIRM_OK','notifyEmailInstance','User\x20dismissed\x20automation\x20proposal.','Deaktiviert\x20(Pro-Feature)','analysis.energy','COGNI_REQUEST_CALL','briefingTime','Unknown','Sequences','.\x20EVENTS:\x20','BUTLER\x20Execution\x20Error:\x20','minDaysForBaseline','python3','ltmDriftCheckIntervalHours','analysis.health.isAnomaly','ltmLtbWindowDays','192220qRuYGT','light','constructor','error','node-schedule','[LOG]','baselineDrift','Event\x20History','ðŸ›¡ï¸\x20SECURITY\x20CHECK:\x20Score\x20','notifyTelegramRecipient','setForeignStateAsync','briefingEnabled','window','system.mode','getStateAsync','isEmergency','normal','ðŸ¤–\x20BUTLER:\x20Executing\x20Action\x20->\x20','presence','OK:\x20','service.py','analysis.health.trendValue','ðŸŽ¯\x20Training\x20Success.\x20New\x20Threshold\x20set\x20to:\x20','occupancy','notifyPushoverRecipient','json','heating','analysis.lastResult','bin','Skipped\x20(No\x20AI\x20or\x20Data)','Lernphase\x20(','getCalendarNames','analysis.trigger','Train\x20Health','insulation','outdoorSensorId','python_service','subscribeStates','getForeignStateAsync','âš ï¸\x20Persistentes\x20Python\x20VENV\x20fehlt\x20(','LTM.driftAnalysis','startsWith','analysis.energy.heatingScore','ready','analysis.isAlert','analysis.automation.description','switch','loc','notifyPushoverInstance','useWeather','Unbekannt','936830OCGMCL','Trigger\x20Analysis','siren','Train\x20Security','is_anomaly','Fokus\x20auf\x20Familienroutinen.','cancel','ðŸš€\x20Starting\x20System\x20Logic...','dimmer','config','submitFeedback','getDate','common','Gemini\x20Error:\x20','indicator.alarm','toFixed','longitude','close','Trend','systemUUID','KI-Modell\x20nicht\x20initialisiert','ðŸš¨\x20EMERGENCY','Anomaly\x20Detected','Target\x20Value','slice','6556608ZCMRvV','ðŸ“ž\x20RÃœCKRUF\x20BITTE!\x20Der\x20Bewohner\x20hat\x20den\x20RÃ¼ckruf-Button\x20gedrÃ¼ckt.','unload','ack','LTM.trainingData.sequences','split','LTM.driftAnalysis.driftDetails','toLowerCase','debug','telegram','vacation','UngewÃ¶hnliches\x20Bewegungsmuster!\x20(Score:\x20','HEALTH_RESULT','main','val','analysis.training.triggerSecurity','lastAlertState','Train\x20Energy','analysis.energy.insulationScore','temperatur','dailyDigests','ANALYZE_TREND','name','@iobroker/adapter-core','events.lastEvent','toISOString','getOverviewData','getFullYear','notifyEmailEnabled','exitTimer','Scripts','TRAIN_ENERGY','getGenerativeModel','LTM','map','contact','object','info','1218108nEQtth','geminiApiKey','VACATION','analysis.health.lastCheck','prÃ¤senz','Thermodynamics','LTM.trainingData.thermodynamics','Target\x20ID','analysis.alertReason','stdout','geminiModel','namespace','Success','ROLLE:\x20Data\x20Compression\x20Agent.\x20SPRACHE:\x20DE.\x20FORMAT:\x20JSON.\x20ANWEISUNG:\x20Fasse\x20Sensor-Events\x20zusammen.\x20SCHEMA:\x20{\x20\x22summary\x22:\x20\x22string\x22,\x20\x22activityLevel\x22:\x20\x22string\x22\x20}\x20\x0a\x0aEVENTS:\x0a','âš ï¸\x20SECURITY\x20ALARM:\x20','.\x20WETTER:\x20','LTM.triggerDailyDigest','444448dHSyCi','boolean','N/A\x20(Learning)','latitude','Training\x20Error:\x20','(((.+)+)+)+$','analysis.history_debug_00','1333703KdTIkT','Activity\x20Summary','temperature','LTM.driftAnalysis.baselineDrift','analysis.automation.targetValue','Restoring\x20sensor\x20cache...','location','message','online','analysis.training.triggerEnergy',').\x20Installiere...','analysis.automation.patternDetected','isGracePeriodActive','Auto\x20Apply','pythonProcess','ðŸ› ï¸\x20Creating\x20Persistent\x20VENV\x20at:\x20','systemConfig','parse','inactivityThresholdHours','expire','analysis.security.currentThreshold','driftDetails','system.isPresent','simulateButler','python.exe','TRAIN_HEALTH','heizung','Energy\x20Intelligence','LTM.dailyDigests','replace','Last\x20raw\x20event','08:00','pip.exe','genAI','PRIORITÃ„T:\x20Sicherheit.','door','Trigger\x20Briefing','unshift','.\x20SYSTEM_MODE:\x20','Analysiere\x20ausgewogen.','includes','system.presenceWho','alertReason','analysisHistory','isPresent','Gemini\x20AI\x20initialized.','Missing\x20data','dependencyInstallInProgress','endsWith','instance','presenceDevices','trim','\x22\x20install\x20--no-cache-dir\x20--force-reinstall\x20-r\x20\x22','apply','bind','eventHistory','onStateChange','notifyTelegramInstance','status','dismissAutomation','analysis.training','licht','state','text.alarm','fill','Installing\x20pip\x20packages...','splice','success','kontakt','.forecast.current.temperature','[RECORDER]\x20Error:\x20','.forecast.current.temp','push','\x0aSTB:\x20','No\x20instance','forEach','getTime','analysis.automation.targetId','sendToAsync','@google/generative-ai','LTM\x20Sched\x20Error:\x20','substring','licenseKey','Description','isProVersion','Trigger\x20Action','existsSync','round','Activity-Level','analysis.activitySummary','.\x20EMERGENCY:\x20','detected','setState','string','Kein\x20API\x20Key!','log','child_process','tÃ¼r','unknown','command','ðŸ§ \x20Triggering\x20Security\x20Training...','pop','LTM.driftAnalysis.lastCheck','Started...','length','getForeignObjectsAsync','ANOMALY','analysis.security.lastCheck','send','Heating\x20Score','events.history','livingContext','onUnload','value','Cogni-Living','notifyPushoverEnabled','autoApply','date','isAlert','LTM.baselineStatus','some','Security\x20Monitor','retry','getObjectAsync','notifyEmailRecipient','Kein\x20API\x20Key.','analysis.security.lastScore','enum','../../iobroker-data/cogni-living-venv','text','âŒ\x20INSTALL\x20FAILED:\x20','rawEventLog','from','response','AI\x20Training','âœ…\x20Alarm\x20quittiert.\x20System\x20normal.','models/gemini-flash-latest','apiKey','exitGraceTimer','rmSync','modeResetJob','getEnums','PARTY','ltmJob','System','getHours','payload','analysis.training.triggerHealth','Trend\x20Value','analysis.health.trendDiagnosis','warn','driftAnalysisTimer','analysis.automation.triggerAction','sound','ENERGY_TRAIN_RESULT','TRAIN_SECURITY','party','LTM.rawEventLog','generateContent','write','0\x203\x20*\x20*\x20*','âœ…\x20HEALTH\x20TRAINED.','testApiKey','Reset\x20Sched\x20Error:\x20','extendObjectAsync','analysis.automation.autoApply','notifyTelegramEnabled','diagnosis','number','openweathermap','python','currentSystemMode','Last\x20Check','lampe','analysisInterval','analysisTimer','threshold','daswetter','\x20=\x20','python3\x20-m\x20venv\x20\x22','values','ltmStbWindowDays','ðŸ\x20Python\x20Pong','scheduleJob','toString','filter','N/A','NORMAL','Gemini\x20Init\x20Error:\x20','devices','getForeignObjectAsync','system','type','stateChange','Current\x20Threshold','now','GUEST','toLocaleTimeString','.NextHours.Location_1.Day_1.current.temp_value','âœ…\x20INSTALL\x20SUCCESS.','motion','guest','Raw\x20Log','Alarm','enum.functions.*','onMessage','Who\x20is\x20present?','.\x20ANWESEND:\x20','ðŸ“ž\x20RÃ¼ckruf\x20anfordern','description','sendTo','Drift\x20Sched\x20Error:\x20','application/json','âœ…\x20Alles\x20OK\x20(Reset)','Briefing\x20Sched\x20Error:\x20','ANALYZE_HEALTH','details','SIMULATION:\x20Test-Vorschlag\x20fÃ¼r\x20','setStateAsync','PRIORITÃ„T:\x20Gesundheit/AAL.','kill','Adapter','briefingJob','stringify','getLtmData','button','ANALYZE_SEQUENCE','path','shift','channel','Alert\x20Status','targetValue','automationProposal','subscribeForeignStatesAsync','indicator','LTM.processingStatus','1fgkcJM','Error\x20launching\x20Python:\x20','HEALTH_TRAIN_RESULT','Vom\x20Benutzer\x20bestÃ¤tigt\x20(OK).','search','âš ï¸\x20ALARM:\x20','join','callback','requirements.txt','ROLLE:\x20KI-Hausverwalter.\x20PERSONA:\x20','analysis.triggerBriefing','targetId','sensorLastValues','914385NLDkKZ',')\x20-\x20SAFE\x20BOOT','setObjectNotExistsAsync','analysis.security'];a0_0x1c0e=function(){return _0x381358;};return a0_0x1c0e();}async function updateAnalysisHistory(_0x5ead4b,_0x189f13){const _0x2a4aaf=a0_0xdf77;_0x5ead4b['analysisHistory'][_0x2a4aaf(0x2d1)](_0x189f13);if(_0x5ead4b[_0x2a4aaf(0x2d7)][_0x2a4aaf(0x314)]>HISTORY_MAX_SIZE)_0x5ead4b['analysisHistory'][_0x2a4aaf(0x311)]();await _0x5ead4b[_0x2a4aaf(0x1ea)]('analysis.analysisHistory',{'val':JSON[_0x2a4aaf(0x1ef)](_0x5ead4b[_0x2a4aaf(0x2d7)]),'ack':!![]});}async function updateBaselineStatus(_0x1eabc4){const _0x789f9b=a0_0xdf77;if(!_0x1eabc4['isProVersion']){await _0x1eabc4[_0x789f9b(0x1ea)](LTM_DP_BASELINE_STATUS,{'val':_0x789f9b(0x215),'ack':!![]});return;}const _0x36599a=_0x1eabc4[_0x789f9b(0x282)][_0x789f9b(0x314)]>=(_0x1eabc4[_0x789f9b(0x25e)][_0x789f9b(0x21d)]||0x7)?'Aktiv\x20('+_0x1eabc4[_0x789f9b(0x282)]['length']+'\x20Tage)':_0x789f9b(0x240)+_0x1eabc4[_0x789f9b(0x282)][_0x789f9b(0x314)]+'/'+(_0x1eabc4['config'][_0x789f9b(0x21d)]||0x7)+')';await _0x1eabc4[_0x789f9b(0x1ea)](LTM_DP_BASELINE_STATUS,{'val':_0x36599a,'ack':!![]});}async function initSensorSubscriptions(_0x384ba0){const _0x207dc1=a0_0xdf77,_0x2a6b9e=_0x384ba0[_0x207dc1(0x25e)][_0x207dc1(0x369)];if(_0x2a6b9e)for(const _0x1a30e5 of _0x2a6b9e){await _0x384ba0[_0x207dc1(0x1f9)](_0x1a30e5['id']);}}async function initPresenceSubscriptions(_0x2811fe){const _0x44697c=a0_0xdf77,_0x3b99b3=_0x2811fe[_0x44697c(0x25e)]['presenceDevices'];if(_0x3b99b3)for(const _0xbc831b of _0x3b99b3){await _0x2811fe[_0x44697c(0x1f9)](_0xbc831b);}}async function setupTelegramListener(_0x54fa1b){const _0x437960=a0_0xdf77,_0x394e13=_0x54fa1b[_0x437960(0x25e)][_0x437960(0x2e5)];if(_0x54fa1b[_0x437960(0x25e)][_0x437960(0x352)]&&_0x394e13)await _0x54fa1b[_0x437960(0x1f9)](_0x394e13+'.communicate.request');}async function checkWifiPresence(_0x106a6c){const _0x27e119=a0_0xdf77;try{const _0x5426b8=_0x106a6c[_0x27e119(0x25e)][_0x27e119(0x2de)]||[];let _0x12d0bc=![];const _0x767df=[];for(const _0x543317 of _0x5426b8){try{const _0x4320ee=await _0x106a6c['getForeignStateAsync'](_0x543317);_0x4320ee&&(_0x4320ee[_0x27e119(0x27c)]===!![]||_0x4320ee[_0x27e119(0x27c)]===_0x27e119(0x2b4)||_0x4320ee['val']===0x1)&&(_0x12d0bc=!![],_0x767df[_0x27e119(0x2f4)](_0x543317));}catch(_0x212a3d){}}return await _0x106a6c['setStateAsync'](_0x27e119(0x2d5),{'val':_0x767df[_0x27e119(0x202)](',\x20'),'ack':!![]}),_0x12d0bc&&(_0x106a6c[_0x27e119(0x28b)]&&(_0x106a6c[_0x27e119(0x30b)]['info']('WiFi\x20Presence\x20detected.'),abortExitTimer(_0x106a6c)),!_0x106a6c[_0x27e119(0x2d8)]&&_0x106a6c[_0x27e119(0x357)]===SYSTEM_MODES['NORMAL']&&await setPresence(_0x106a6c,!![])),_0x12d0bc;}catch(_0x5aad01){return![];}}function startExitTimer(_0x8d3728){const _0x2e63aa=a0_0xdf77;abortExitTimer(_0x8d3728),_0x8d3728[_0x2e63aa(0x2b8)]=!![],_0x8d3728['exitGraceTimer']=setTimeout(()=>{const _0x52bf53=_0x2e63aa;_0x8d3728[_0x52bf53(0x2b8)]=![];},EXIT_GRACE_PERIOD_SECONDS*0x3e8),_0x8d3728['exitTimer']=setTimeout(()=>{const _0x37b7da=_0x2e63aa;setPresence(_0x8d3728,![]),_0x8d3728[_0x37b7da(0x28b)]=null;},EXIT_TIMER_MINUTES*0x3c*0x3e8);}function abortExitTimer(_0x3c3550){const _0x442472=a0_0xdf77;if(_0x3c3550[_0x442472(0x28b)])clearTimeout(_0x3c3550['exitTimer']);if(_0x3c3550[_0x442472(0x336)])clearTimeout(_0x3c3550[_0x442472(0x336)]);_0x3c3550['exitTimer']=null,_0x3c3550[_0x442472(0x336)]=null,_0x3c3550[_0x442472(0x2b8)]=![];}async function setPresence(_0x5699a8,_0x51699b){const _0x45e8e1=a0_0xdf77;if(_0x5699a8[_0x45e8e1(0x2d8)]===_0x51699b)return;_0x5699a8[_0x45e8e1(0x2d8)]=_0x51699b,await _0x5699a8[_0x45e8e1(0x1ea)](_0x45e8e1(0x2c2),{'val':_0x51699b,'ack':!![]});}async function executeAutomationAction(_0x1847e7){const _0x3c64f4=a0_0xdf77;try{const _0x4f0554=await _0x1847e7[_0x3c64f4(0x230)]('analysis.automation.targetId'),_0x15eaa7=await _0x1847e7[_0x3c64f4(0x230)](_0x3c64f4(0x2b0));if(_0x4f0554&&_0x4f0554[_0x3c64f4(0x27c)]&&_0x15eaa7){const _0x4d4ed7=_0x4f0554[_0x3c64f4(0x27c)];let _0x4a5c85=_0x15eaa7[_0x3c64f4(0x27c)];try{_0x4a5c85=JSON[_0x3c64f4(0x2bd)](_0x4a5c85);}catch(_0x346705){}_0x1847e7['log'][_0x3c64f4(0x293)](_0x3c64f4(0x233)+_0x4d4ed7+_0x3c64f4(0x35e)+_0x4a5c85),await _0x1847e7[_0x3c64f4(0x22c)](_0x4d4ed7,_0x4a5c85);}else _0x1847e7[_0x3c64f4(0x30b)][_0x3c64f4(0x342)]('ðŸ¤–\x20BUTLER:\x20No\x20valid\x20target\x20ID\x20or\x20value\x20stored\x20for\x20execution.');}catch(_0x546231){_0x1847e7[_0x3c64f4(0x30b)][_0x3c64f4(0x225)](_0x3c64f4(0x21c)+_0x546231[_0x3c64f4(0x2b3)]);}}async function processSensorEvent(_0x49a6d7,_0x1787d2,_0x33fcc9,_0x47c63f){const _0x3fc430=a0_0xdf77;if(!_0x47c63f)return;const _0x226d86=_0x33fcc9[_0x3fc430(0x27c)],_0x1291a6=Date['now'](),_0x3709c3=_0x49a6d7[_0x3fc430(0x208)][_0x1787d2];_0x49a6d7[_0x3fc430(0x208)][_0x1787d2]=_0x226d86;if(!_0x47c63f['logDuplicates']&&_0x3709c3!=undefined&&_0x3709c3==_0x226d86)return;const _0x10ea3d=(_0x47c63f[_0x3fc430(0x36c)]||'')[_0x3fc430(0x275)](),_0x28bad1=_0x10ea3d['includes'](_0x3fc430(0x2ae))||_0x10ea3d['includes'](_0x3fc430(0x281))||_0x10ea3d['includes']('klima')||_0x10ea3d[_0x3fc430(0x2d4)](_0x3fc430(0x2c6));_0x49a6d7['isProVersion']&&_0x28bad1&&recordThermodynamics(_0x49a6d7,_0x1787d2,_0x226d86,_0x47c63f['location']);const _0x4bf1ad={'timestamp':_0x1291a6,'id':_0x1787d2,'name':_0x47c63f[_0x3fc430(0x284)],'type':_0x47c63f[_0x3fc430(0x36c)],'location':_0x47c63f[_0x3fc430(0x2b2)],'value':_0x226d86};_0x49a6d7[_0x3fc430(0x2e3)][_0x3fc430(0x2d1)](_0x4bf1ad);if(_0x49a6d7[_0x3fc430(0x2e3)][_0x3fc430(0x314)]>HISTORY_MAX_SIZE)_0x49a6d7[_0x3fc430(0x2e3)][_0x3fc430(0x311)]();await _0x49a6d7[_0x3fc430(0x1ea)](_0x3fc430(0x286),{'val':JSON[_0x3fc430(0x1ef)](_0x4bf1ad),'ack':!![]}),await _0x49a6d7[_0x3fc430(0x1ea)](_0x3fc430(0x31a),{'val':JSON[_0x3fc430(0x1ef)](_0x49a6d7[_0x3fc430(0x2e3)]),'ack':!![]});_0x49a6d7[_0x3fc430(0x300)]&&(_0x49a6d7['rawEventLog']['push'](_0x4bf1ad),await saveRawEventLog(_0x49a6d7),recordSequence(_0x49a6d7,_0x4bf1ad));if(_0x47c63f['isExit']&&_0x226d86===!![]){if(_0x49a6d7['isPresent']&&!_0x49a6d7[_0x3fc430(0x2b8)])startExitTimer(_0x49a6d7);else{if(!_0x49a6d7[_0x3fc430(0x2d8)])setPresence(_0x49a6d7,!![]);}}else{if(_0x47c63f['type']===_0x3fc430(0x374)&&_0x226d86===!![]){if(_0x49a6d7['exitTimer'])abortExitTimer(_0x49a6d7);if(!_0x49a6d7[_0x3fc430(0x2d8)]&&_0x49a6d7[_0x3fc430(0x357)]===SYSTEM_MODES[_0x3fc430(0x367)])setPresence(_0x49a6d7,!![]);}}}async function recordThermodynamics(_0x3f6d96,_0x131cbe,_0x10c986,_0x2c38b3){const _0x538ae8=a0_0xdf77,_0x59b3c0=await getOutsideTemperatureNumeric(_0x3f6d96),_0x2353df=await _0x3f6d96[_0x538ae8(0x230)](_0x538ae8(0x29a));let _0x52ac0e=[];if(_0x2353df&&_0x2353df[_0x538ae8(0x27c)])try{_0x52ac0e=JSON['parse'](_0x2353df[_0x538ae8(0x27c)]);}catch(_0xdac599){}_0x52ac0e[_0x538ae8(0x2f4)]({'ts':Date[_0x538ae8(0x36f)](),'room':_0x2c38b3||_0x538ae8(0x219),'t_in':_0x10c986,'t_out':_0x59b3c0});if(_0x52ac0e[_0x538ae8(0x314)]>THERMO_LOG_SIZE)_0x52ac0e[_0x538ae8(0x1f4)]();await _0x3f6d96[_0x538ae8(0x1ea)](_0x538ae8(0x29a),{'val':JSON[_0x538ae8(0x1ef)](_0x52ac0e),'ack':!![]});}async function getOutsideTemperatureNumeric(_0x74749c){const _0x490058=a0_0xdf77;if(_0x74749c[_0x490058(0x25e)][_0x490058(0x245)])try{const _0x427092=await _0x74749c[_0x490058(0x248)](_0x74749c[_0x490058(0x25e)][_0x490058(0x245)]);if(_0x427092&&_0x427092[_0x490058(0x27c)]!==undefined&&_0x427092['val']!==null)return parseFloat(_0x427092['val']);}catch(_0x4e6a4c){}const _0xf7f17d=_0x74749c['config']['weatherInstance'];if(!_0x74749c[_0x490058(0x25e)][_0x490058(0x253)]||!_0xf7f17d)return null;try{let _0x275f99='';if(_0xf7f17d[_0x490058(0x2d4)]('accuweather'))_0x275f99=_0xf7f17d+'.Current.Temperature';else{if(_0xf7f17d[_0x490058(0x2d4)](_0x490058(0x35d)))_0x275f99=_0xf7f17d+_0x490058(0x372);else{if(_0xf7f17d[_0x490058(0x2d4)](_0x490058(0x355)))_0x275f99=_0xf7f17d+_0x490058(0x2f1);else{if(_0xf7f17d['includes']('weatherunderground'))_0x275f99=_0xf7f17d+_0x490058(0x2f3);}}}if(_0x275f99){const _0x44122a=await _0x74749c['getForeignStateAsync'](_0x275f99);if(_0x44122a&&_0x44122a[_0x490058(0x27c)]!==undefined&&_0x44122a[_0x490058(0x27c)]!==null)return parseFloat(_0x44122a[_0x490058(0x27c)]);}}catch(_0x198641){}return null;}async function recordSequence(_0x1e772b,_0x2e3a76){const _0x5dc918=a0_0xdf77,_0x193f20=(_0x2e3a76[_0x5dc918(0x36c)]||'')['toLowerCase'](),_0x223b63=[_0x5dc918(0x374),'bewegung',_0x5dc918(0x298),_0x5dc918(0x234),_0x5dc918(0x239),_0x5dc918(0x2cf),_0x5dc918(0x30d),_0x5dc918(0x22e),'fenster',_0x5dc918(0x291),_0x5dc918(0x2f0),_0x5dc918(0x223),_0x5dc918(0x2e9),'switch','schalter',_0x5dc918(0x25d),_0x5dc918(0x359)];if(!_0x223b63[_0x5dc918(0x324)](_0x5198f6=>_0x193f20[_0x5dc918(0x2d4)](_0x5198f6)))return;if(!_0x2e3a76['value'])return;if(sequenceTimer)clearTimeout(sequenceTimer);activeSequence[_0x5dc918(0x2f4)]({'loc':_0x2e3a76[_0x5dc918(0x2b2)]||_0x5dc918(0x219),'id':_0x2e3a76['id'],'ts':Date[_0x5dc918(0x36f)]()}),sequenceTimer=setTimeout(async()=>{if(activeSequence['length']>0x1)await saveCompletedSequence(_0x1e772b);activeSequence=[];},SEQUENCE_TIMEOUT_MS);}async function saveCompletedSequence(_0x4efc9c){const _0x4b55a3=a0_0xdf77;try{const _0x2e5c11=await _0x4efc9c[_0x4b55a3(0x230)](_0x4b55a3(0x272));let _0x14b1c9=[];if(_0x2e5c11&&_0x2e5c11[_0x4b55a3(0x27c)])try{_0x14b1c9=JSON['parse'](_0x2e5c11[_0x4b55a3(0x27c)]);}catch(_0x2a7ac5){}const _0x46a686=activeSequence[0x0]['ts'],_0x48552f=activeSequence[_0x4b55a3(0x290)](_0x36a355=>({'loc':_0x36a355[_0x4b55a3(0x251)],'t_delta':Math[_0x4b55a3(0x303)]((_0x36a355['ts']-_0x46a686)/0x3e8)})),_0x419228={'timestamp':new Date(_0x46a686)[_0x4b55a3(0x287)](),'steps':_0x48552f,'duration':Math[_0x4b55a3(0x303)]((activeSequence[activeSequence[_0x4b55a3(0x314)]-0x1]['ts']-_0x46a686)/0x3e8),'daytime':new Date(_0x46a686)[_0x4b55a3(0x33d)]()};_0x14b1c9[_0x4b55a3(0x2f4)](_0x419228);if(_0x14b1c9['length']>MAX_TRAINING_SET_SIZE)_0x14b1c9[_0x4b55a3(0x1f4)]();await _0x4efc9c['setStateAsync'](_0x4b55a3(0x272),{'val':JSON[_0x4b55a3(0x1ef)](_0x14b1c9),'ack':!![]}),runSecurityCheck(_0x4efc9c,_0x419228);}catch(_0x2b015c){_0x4efc9c[_0x4b55a3(0x30b)][_0x4b55a3(0x225)](_0x4b55a3(0x2f2)+_0x2b015c[_0x4b55a3(0x2b3)]);}}function runSecurityCheck(_0x5f291d,_0x19863f){const _0x208c85=a0_0xdf77;if(!_0x5f291d[_0x208c85(0x300)])return;sendToPython(_0x5f291d,_0x208c85(0x1f2),{'sequence':_0x19863f});}function sendToPython(_0x375104,_0x47231d,_0x564255={}){const _0xa70b9d=a0_0xdf77;if(!_0x375104['pythonProcess']||!_0x375104[_0xa70b9d(0x2ba)]['stdin']['writable'])return;const _0x330e11=JSON['stringify']({'command':_0x47231d,..._0x564255});try{_0x375104['pythonProcess']['stdin'][_0xa70b9d(0x34b)](_0x330e11+'\x0a');}catch(_0xeaeaf5){}}function startPythonService(_0x2f760c){const _0x19a8f9=a0_0xdf77;let _0xf77f8b=_0x19a8f9(0x21e);if(fs[_0x19a8f9(0x302)](PYTHON_EXE))_0xf77f8b=PYTHON_EXE;try{const _0x1145c8=path[_0x19a8f9(0x202)](__dirname,'python_service',_0x19a8f9(0x236));_0x2f760c['pythonProcess']=spawn(_0xf77f8b,[_0x1145c8]),_0x2f760c[_0x19a8f9(0x2ba)][_0x19a8f9(0x29d)]['on']('data',_0xc7f8e1=>{const _0x4f0dee=_0x19a8f9,_0x3b4cce=_0xc7f8e1[_0x4f0dee(0x364)]()[_0x4f0dee(0x273)]('\x0a');_0x3b4cce[_0x4f0dee(0x2f7)](_0x2cabd7=>{const _0x1c746b=_0x4f0dee,_0x2b4144=_0x2cabd7[_0x1c746b(0x2df)]();if(!_0x2b4144)return;if(_0x2b4144[_0x1c746b(0x24b)](_0x1c746b(0x227)))_0x2f760c[_0x1c746b(0x30b)][_0x1c746b(0x276)]('[PYTHON]\x20'+_0x2b4144[_0x1c746b(0x2fd)](0x5)[_0x1c746b(0x2df)]());else{if(_0x2b4144[_0x1c746b(0x24b)]('[RESULT]'))try{const _0x36e526=JSON[_0x1c746b(0x2bd)](_0x2b4144[_0x1c746b(0x2fd)](0x8)[_0x1c746b(0x2df)]());handlePythonResult(_0x2f760c,_0x36e526);}catch(_0x3bf935){}}});}),_0x2f760c[_0x19a8f9(0x2ba)]['on'](_0x19a8f9(0x266),_0x45427e=>{const _0x23a557=_0x19a8f9;_0x2f760c[_0x23a557(0x2ba)]=null;});}catch(_0x358fc4){_0x2f760c[_0x19a8f9(0x30b)][_0x19a8f9(0x225)](_0x19a8f9(0x1fd)+_0x358fc4['message']);}}function stopPythonService(_0x171213){const _0x412597=a0_0xdf77;if(_0x171213[_0x412597(0x2ba)]){try{_0x171213[_0x412597(0x2ba)][_0x412597(0x1ec)]();}catch(_0x4765ca){}_0x171213[_0x412597(0x2ba)]=null;}}function handlePythonResult(_0x518756,_0xf4bfb5){const _0xafe6da=a0_0xdf77;if(_0xf4bfb5['type']==='PONG')_0x518756[_0xafe6da(0x30b)][_0xafe6da(0x276)](_0xafe6da(0x362));else{if(_0xf4bfb5[_0xafe6da(0x36c)]==='SECURITY_RESULT'){const {anomaly_score:_0x2b383d,is_anomaly:_0x500e76,threshold:_0x11da64}=_0xf4bfb5[_0xafe6da(0x33e)];_0x518756[_0xafe6da(0x30b)][_0xafe6da(0x293)](_0xafe6da(0x22a)+_0x2b383d[_0xafe6da(0x264)](0x5)+'\x20->\x20'+(_0x500e76?_0xafe6da(0x316):'OK')),_0x518756['setStateAsync']('analysis.security.lastScore',{'val':_0x2b383d,'ack':!![]}),_0x518756[_0xafe6da(0x1ea)](_0xafe6da(0x317),{'val':new Date()['toISOString'](),'ack':!![]});if(_0x11da64)_0x518756[_0xafe6da(0x1ea)]('analysis.security.currentThreshold',{'val':_0x11da64,'ack':!![]});if(_0x500e76){const _0x2d6bc5=_0xafe6da(0x279)+_0x2b383d[_0xafe6da(0x264)](0x4)+')';_0x518756['setStateAsync'](_0xafe6da(0x24e),{'val':!![],'ack':!![]}),_0x518756['setStateAsync'](_0xafe6da(0x29c),{'val':_0x2d6bc5,'ack':!![]}),sendNotification(_0x518756,_0xafe6da(0x2a2)+_0x2d6bc5,![],!![]);}}else{if(_0xf4bfb5[_0xafe6da(0x36c)]==='TRAINING_COMPLETE'){const _0x1ba6be=_0xf4bfb5[_0xafe6da(0x33e)]['details']||'',_0x268374=_0xf4bfb5[_0xafe6da(0x33e)][_0xafe6da(0x35c)],_0x2bdfba=_0xf4bfb5[_0xafe6da(0x33e)]['success']?'Success:\x20'+new Date()[_0xafe6da(0x371)]()+'\x20('+_0x1ba6be+')':'Failed:\x20'+_0xf4bfb5[_0xafe6da(0x33e)]['reason'];_0x518756['setStateAsync']('analysis.training.status',{'val':_0x2bdfba,'ack':!![]}),_0xf4bfb5[_0xafe6da(0x33e)][_0xafe6da(0x2ef)]&&_0x268374&&(_0x518756[_0xafe6da(0x30b)]['info'](_0xafe6da(0x238)+_0x268374),_0x518756[_0xafe6da(0x1ea)](_0xafe6da(0x2c0),{'val':_0x268374,'ack':!![]}));}else{if(_0xf4bfb5[_0xafe6da(0x36c)]===_0xafe6da(0x346)){if(_0xf4bfb5['payload'][_0xafe6da(0x2ef)])try{const _0x5b84bc=JSON[_0xafe6da(0x2bd)](_0xf4bfb5[_0xafe6da(0x33e)][_0xafe6da(0x384)]);if(_0x5b84bc[_0xafe6da(0x244)])_0x518756['setStateAsync'](_0xafe6da(0x280),{'val':JSON['stringify'](_0x5b84bc[_0xafe6da(0x244)]),'ack':!![]});if(_0x5b84bc['heating'])_0x518756[_0xafe6da(0x1ea)]('analysis.energy.heatingScore',{'val':JSON['stringify'](_0x5b84bc[_0xafe6da(0x23c)]),'ack':!![]});}catch(_0x53206){}}else{if(_0xf4bfb5[_0xafe6da(0x36c)]===_0xafe6da(0x1fe)){if(_0xf4bfb5['payload']['success'])_0x518756['log'][_0xafe6da(0x293)](_0xafe6da(0x34d));}else{if(_0xf4bfb5[_0xafe6da(0x36c)]===_0xafe6da(0x27a))_0x518756[_0xafe6da(0x1ea)](_0xafe6da(0x297),{'val':new Date()[_0xafe6da(0x287)](),'ack':!![]}),_0x518756[_0xafe6da(0x1ea)](_0xafe6da(0x220),{'val':_0xf4bfb5['payload'][_0xafe6da(0x259)],'ack':!![]});else _0xf4bfb5[_0xafe6da(0x36c)]==='TREND_RESULT'&&(_0x518756[_0xafe6da(0x1ea)](_0xafe6da(0x341),{'val':_0xf4bfb5[_0xafe6da(0x33e)][_0xafe6da(0x353)],'ack':!![]}),_0x518756[_0xafe6da(0x1ea)](_0xafe6da(0x237),{'val':_0xf4bfb5[_0xafe6da(0x33e)]['change_percent'],'ack':!![]}));}}}}}}function runPythonHealthCheck(_0x36a601){const _0x548698=a0_0xdf77;if(!_0x36a601[_0x548698(0x282)]||_0x36a601[_0x548698(0x282)][_0x548698(0x314)]<0x2)return;const _0xee7311=_0x36a601[_0x548698(0x282)]['map'](_0x5a47cf=>{const _0x2c1ac9=_0x548698,_0x5c369d=(_0x5a47cf['activityLevel']||'')[_0x2c1ac9(0x275)]();return ACTIVITY_LEVEL_MAP[_0x5c369d]||0x32;});sendToPython(_0x36a601,_0x548698(0x283),{'values':_0xee7311,'tag':_0x548698(0x304)});}async function handleTelegramResponse(_0x17808b,_0xa6cfef){const _0x51f93d=a0_0xdf77;let _0x2c7585=_0xa6cfef;_0xa6cfef[_0x51f93d(0x24b)]('[')&&(_0x2c7585=_0xa6cfef[_0x51f93d(0x2fd)](_0xa6cfef['indexOf'](']')+0x1));if(_0x2c7585===_0x51f93d(0x212))await _0x17808b[_0x51f93d(0x1ea)](_0x51f93d(0x24e),{'val':![],'ack':!![]}),await _0x17808b[_0x51f93d(0x1ea)](_0x51f93d(0x29c),{'val':_0x51f93d(0x1ff),'ack':!![]}),_0x17808b['lastAlertState']=![],sendNotification(_0x17808b,_0x51f93d(0x333),![]);else _0x2c7585===_0x51f93d(0x217)&&sendNotification(_0x17808b,_0x51f93d(0x26f),![],!![]);}async function sendNotification(_0x392fd3,_0x14b417,_0x1e253a=![],_0x1abfeb=![]){const _0x4548f3=a0_0xdf77,_0x356210=_0x392fd3[_0x4548f3(0x25e)];if(_0x356210[_0x4548f3(0x352)]){let _0x4582e6={};(_0x14b417[_0x4548f3(0x2d4)](_0x4548f3(0x377))||_0x1abfeb)&&(_0x4582e6={'reply_markup':{'inline_keyboard':[[{'text':_0x4548f3(0x381),'callback_data':_0x4548f3(0x212)}],[{'text':_0x4548f3(0x37c),'callback_data':'COGNI_REQUEST_CALL'}]]}}),await _0x392fd3[_0x4548f3(0x2fa)](_0x356210[_0x4548f3(0x2e5)],'send',{'text':_0x14b417,'user':_0x356210[_0x4548f3(0x22b)],..._0x4582e6});}if(_0x356210[_0x4548f3(0x31f)]){let _0x155e82={'message':_0x14b417,'title':_0x1abfeb?_0x4548f3(0x26a):_0x4548f3(0x31e),'priority':_0x1abfeb?0x2:0x1,'device':_0x356210[_0x4548f3(0x23a)]};_0x1abfeb&&(_0x155e82[_0x4548f3(0x326)]=0x1e,_0x155e82[_0x4548f3(0x2bf)]=0xe10,_0x155e82[_0x4548f3(0x345)]=_0x4548f3(0x257)),await _0x392fd3[_0x4548f3(0x2fa)](_0x356210[_0x4548f3(0x252)],_0x4548f3(0x318),_0x155e82);}_0x356210[_0x4548f3(0x28a)]&&await _0x392fd3['sendToAsync'](_0x356210[_0x4548f3(0x213)],_0x4548f3(0x318),{'text':_0x14b417,'to':_0x356210[_0x4548f3(0x328)]});}async function runGeminiAnalysis(_0xb89d35,_0x15e807=''){const _0x493225=a0_0xdf77;if(!_0xb89d35['geminiModel'])return;if(_0xb89d35[_0x493225(0x2e3)][_0x493225(0x314)]===0x0)return;const _0x1755af=_0xb89d35[_0x493225(0x2e3)][_0x493225(0x26d)](0x0,0xf),_0x39ab35=await getWeatherContext(_0xb89d35),_0x5d593f=_0xb89d35[_0x493225(0x357)],_0x29c3d0=PERSONA_MAPPING[_0xb89d35[_0x493225(0x25e)]['aiPersona']||'generic'],_0x2d6721=_0xb89d35[_0x493225(0x25e)][_0x493225(0x31b)]||'Keine\x20Details.';let _0x5ef10a=_0x493225(0x254);try{const _0x1759bb=await _0xb89d35['getStateAsync'](_0x493225(0x2d5));if(_0x1759bb&&_0x1759bb['val'])_0x5ef10a=_0x1759bb['val'];}catch(_0x299328){}let _0x289675=![];try{const _0x14d39e=await _0xb89d35['getStateAsync'](_0x493225(0x351));if(_0x14d39e&&_0x14d39e[_0x493225(0x27c)])_0x289675=!![];}catch(_0x111fd0){}const _0xa6aaf4=_0x493225(0x205)+_0x29c3d0+'.\x20KONTEXT:\x20'+_0x2d6721+_0x493225(0x2d2)+_0x5d593f+_0x493225(0x2a3)+_0x39ab35+_0x493225(0x37b)+_0x5ef10a+_0x493225(0x21b)+JSON[_0x493225(0x1ef)](_0x1755af)+_0x493225(0x306)+_0x15e807+'.\x20AUFGABE:\x201.\x20Gesundheit?\x202.\x20Komfort?\x20FORMAT\x20(JSON):\x20{\x20\x22isAlert\x22:\x20boolean,\x20\x22alertReason\x22:\x20\x22string\x22,\x20\x22isEmergency\x22:\x20boolean,\x20\x22summary\x22:\x20\x22string\x22,\x20\x22automationProposal\x22:\x20{\x20\x22detected\x22:\x20boolean,\x20\x22description\x22:\x20\x22string\x22,\x20\x22targetId\x22:\x20\x22string\x22,\x20\x22targetValue\x22:\x20\x22any\x22\x20}\x20}';try{const _0x2bcc57=await _0xb89d35[_0x493225(0x29e)][_0x493225(0x34a)](_0xa6aaf4),_0x104287=JSON[_0x493225(0x2bd)](_0x2bcc57[_0x493225(0x331)][_0x493225(0x32d)]()[_0x493225(0x2c9)](/```json|```/g,'')[_0x493225(0x2df)]());await _0xb89d35[_0x493225(0x1ea)](_0x493225(0x23d),{'val':JSON['stringify'](_0x104287),'ack':!![]});if(_0x104287[_0x493225(0x211)])await _0xb89d35[_0x493225(0x1ea)](_0x493225(0x305),{'val':_0x104287[_0x493225(0x211)],'ack':!![]});const _0x8d5d9a={'timestamp':Date['now'](),'id':Date[_0x493225(0x36f)]()[_0x493225(0x364)](),'analysis':{'activity':{'summary':_0x104287[_0x493225(0x211)],'isAlert':_0x104287[_0x493225(0x322)],'alertReason':_0x104287[_0x493225(0x2d6)]},'comfort':{'automationProposal':_0x104287[_0x493225(0x1f8)]}}};await updateAnalysisHistory(_0xb89d35,_0x8d5d9a);const _0x151fc4=_0x104287[_0x493225(0x322)]||![];_0x151fc4!==_0xb89d35[_0x493225(0x27e)]&&(await _0xb89d35[_0x493225(0x1ea)]('analysis.isAlert',{'val':_0x151fc4,'ack':!![]}),_0xb89d35[_0x493225(0x27e)]=_0x151fc4,_0x151fc4&&(await _0xb89d35['setStateAsync'](_0x493225(0x29c),{'val':_0x104287[_0x493225(0x2d6)],'ack':!![]}),sendNotification(_0xb89d35,_0x493225(0x201)+_0x104287['alertReason'],![],_0x104287[_0x493225(0x231)])));if(_0x104287[_0x493225(0x1f8)]&&_0x104287[_0x493225(0x1f8)][_0x493225(0x307)]){await _0xb89d35[_0x493225(0x1ea)](_0x493225(0x2b7),{'val':!![],'ack':!![]}),await _0xb89d35[_0x493225(0x1ea)](_0x493225(0x24f),{'val':_0x104287[_0x493225(0x1f8)][_0x493225(0x37d)],'ack':!![]}),await _0xb89d35[_0x493225(0x1ea)](_0x493225(0x2f9),{'val':_0x104287[_0x493225(0x1f8)][_0x493225(0x207)],'ack':!![]}),await _0xb89d35[_0x493225(0x1ea)]('analysis.automation.targetValue',{'val':JSON['stringify'](_0x104287[_0x493225(0x1f8)][_0x493225(0x1f7)]),'ack':!![]});if(_0x289675)executeAutomationAction(_0xb89d35);}}catch(_0x16afaf){_0xb89d35[_0x493225(0x30b)][_0x493225(0x225)](_0x493225(0x262)+_0x16afaf[_0x493225(0x2b3)]);}}async function createDailyDigest(_0x4f333b){const _0x4ed8f7=a0_0xdf77;if(!_0x4f333b['isProVersion'])return;await _0x4f333b[_0x4ed8f7(0x1ea)](LTM_DP_STATUS,{'val':_0x4ed8f7(0x313),'ack':!![]});if(!_0x4f333b[_0x4ed8f7(0x29e)]||_0x4f333b['rawEventLog'][_0x4ed8f7(0x314)]<LTM_MIN_EVENTS_FOR_COMPRESSION){await _0x4f333b['setStateAsync'](LTM_DP_STATUS,{'val':_0x4ed8f7(0x23f),'ack':!![]});return;}const _0xdcd079=JSON[_0x4ed8f7(0x2bd)](JSON[_0x4ed8f7(0x1ef)](_0x4f333b['rawEventLog'])),_0x5bfcd0=_0xdcd079['length'],_0x571176=_0x4ed8f7(0x2a1)+JSON['stringify'](_0xdcd079);try{const _0x47ac60=await _0x4f333b['geminiModel'][_0x4ed8f7(0x34a)](_0x571176),_0xfccd8d=JSON[_0x4ed8f7(0x2bd)](_0x47ac60['response'][_0x4ed8f7(0x32d)]()[_0x4ed8f7(0x2c9)](/```json|```/g,'')[_0x4ed8f7(0x2df)]()),_0xc18bbe={'timestamp':new Date()[_0x4ed8f7(0x287)](),'eventCount':_0x5bfcd0,'summary':_0xfccd8d[_0x4ed8f7(0x211)]||'Digest','activityLevel':_0xfccd8d['activityLevel']||_0x4ed8f7(0x232),'systemMode':_0x4f333b[_0x4ed8f7(0x357)]};_0x4f333b[_0x4ed8f7(0x282)][_0x4ed8f7(0x2f4)](_0xc18bbe),await saveDailyDigests(_0x4f333b),_0x4f333b[_0x4ed8f7(0x32f)]=[],await saveRawEventLog(_0x4f333b),await _0x4f333b[_0x4ed8f7(0x1ea)](LTM_DP_STATUS,{'val':_0x4ed8f7(0x2a0),'ack':!![]});if(_0x4f333b[_0x4ed8f7(0x300)])sendToPython(_0x4f333b,_0x4ed8f7(0x383),{'digest':_0xc18bbe});}catch(_0x2959e0){_0x4f333b['log'][_0x4ed8f7(0x225)](_0x2959e0[_0x4ed8f7(0x2b3)]);}}function setupLtmScheduler(_0x424ef5){const _0x27ab8f=a0_0xdf77;try{if(_0x424ef5[_0x27ab8f(0x33b)])_0x424ef5['ltmJob'][_0x27ab8f(0x25b)]();if(!_0x424ef5[_0x27ab8f(0x300)])return;_0x424ef5[_0x27ab8f(0x33b)]=schedule['scheduleJob'](LTM_SCHEDULE,()=>createDailyDigest(_0x424ef5));}catch(_0x41f876){_0x424ef5[_0x27ab8f(0x30b)]['error'](_0x27ab8f(0x2fc)+_0x41f876['message']);}}function setupModeResetScheduler(_0x414991){const _0x175e60=a0_0xdf77;try{if(_0x414991[_0x175e60(0x338)])_0x414991[_0x175e60(0x338)][_0x175e60(0x25b)]();_0x414991['modeResetJob']=schedule['scheduleJob'](MODE_RESET_SCHEDULE,async()=>{const _0x5ad9a5=_0x175e60;await loadSystemMode(_0x414991),AUTO_RESET_MODES[_0x5ad9a5(0x2d4)](_0x414991['currentSystemMode'])&&await _0x414991['setStateAsync'](SYSTEM_DP_MODE,{'val':SYSTEM_MODES[_0x5ad9a5(0x367)],'ack':![]});});}catch(_0x5e7742){_0x414991[_0x175e60(0x30b)][_0x175e60(0x225)](_0x175e60(0x34f)+_0x5e7742[_0x175e60(0x2b3)]);}}function setupDriftAnalysisScheduler(_0x2fc2c6){const _0x189696=a0_0xdf77;try{if(_0x2fc2c6[_0x189696(0x343)])clearInterval(_0x2fc2c6[_0x189696(0x343)]);if(!_0x2fc2c6[_0x189696(0x300)])return;_0x2fc2c6[_0x189696(0x343)]=setInterval(()=>runBaselineDriftAnalysis(_0x2fc2c6),(_0x2fc2c6[_0x189696(0x25e)][_0x189696(0x21f)]||0x18)*0x36ee80),setTimeout(()=>runBaselineDriftAnalysis(_0x2fc2c6),0x1388);}catch(_0x4cd890){_0x2fc2c6[_0x189696(0x30b)][_0x189696(0x225)](_0x189696(0x37f)+_0x4cd890[_0x189696(0x2b3)]);}}function setupBriefingScheduler(_0x4ae8ae){const _0x438a78=a0_0xdf77;try{if(_0x4ae8ae[_0x438a78(0x1ee)])_0x4ae8ae[_0x438a78(0x1ee)][_0x438a78(0x25b)]();if(!_0x4ae8ae[_0x438a78(0x25e)][_0x438a78(0x22d)])return;const _0x40ef03=(_0x4ae8ae[_0x438a78(0x25e)][_0x438a78(0x218)]||_0x438a78(0x2cb))['split'](':'),_0x267b10=parseInt(_0x40ef03[0x0])||0x8,_0x310b0d=parseInt(_0x40ef03[0x1])||0x0,_0x54a3ac=_0x310b0d+'\x20'+_0x267b10+'\x20*\x20*\x20*';_0x4ae8ae[_0x438a78(0x1ee)]=schedule[_0x438a78(0x363)](_0x54a3ac,()=>{sendMorningBriefing(_0x4ae8ae);});}catch(_0x2913e1){_0x4ae8ae['log'][_0x438a78(0x225)](_0x438a78(0x382)+_0x2913e1[_0x438a78(0x2b3)]);}}async function runBaselineDriftAnalysis(_0x1f3b47){const _0x166c98=a0_0xdf77;if(!_0x1f3b47[_0x166c98(0x300)]||!_0x1f3b47[_0x166c98(0x29e)])return;const _0x47c3b2=_0x1f3b47['config'][_0x166c98(0x361)]||0xe;if(_0x1f3b47[_0x166c98(0x282)][_0x166c98(0x314)]<_0x47c3b2+0x7){await _0x1f3b47[_0x166c98(0x1ea)](LTM_DP_DRIFT_STATUS,{'val':_0x166c98(0x2a7),'ack':!![]});return;}const _0x17fafc=_0x1f3b47[_0x166c98(0x282)][_0x166c98(0x26d)](-_0x47c3b2),_0x38efa8=_0x1f3b47[_0x166c98(0x282)][_0x166c98(0x26d)](0x0,_0x1f3b47['dailyDigests']['length']-_0x47c3b2),_0x477d11='ROLLE:\x20Data\x20Scientist.\x20ZIEL:\x20Drift\x20erkennen.\x20SCHEMA:\x20{\x20\x22baselineDrift\x22:\x20\x22none|slight|significant|critical\x22,\x20\x22driftDetails\x22:\x20\x22string\x22\x20}\x0a\x0aLTB:\x20'+JSON[_0x166c98(0x1ef)](_0x38efa8)+_0x166c98(0x2f5)+JSON[_0x166c98(0x1ef)](_0x17fafc);try{const _0x2b3592=await _0x1f3b47[_0x166c98(0x29e)][_0x166c98(0x34a)](_0x477d11),_0x1aa1c4=JSON['parse'](_0x2b3592[_0x166c98(0x331)][_0x166c98(0x32d)]()['replace'](/```json|```/g,'')[_0x166c98(0x2df)]());_0x1aa1c4[_0x166c98(0x228)]&&(await _0x1f3b47[_0x166c98(0x1ea)](LTM_DP_DRIFT_STATUS,{'val':_0x1aa1c4['baselineDrift'],'ack':!![]}),await _0x1f3b47[_0x166c98(0x1ea)](LTM_DP_DRIFT_DETAILS,{'val':_0x1aa1c4[_0x166c98(0x2c1)],'ack':!![]}),await _0x1f3b47[_0x166c98(0x1ea)](LTM_DP_DRIFT_LAST_CHECK,{'val':Date[_0x166c98(0x36f)](),'ack':!![]}));}catch(_0xaf0bcb){}}class CogniLiving extends utils[a0_0xdf77(0x1ed)]{constructor(_0x30d818){const _0x51b030=a0_0xdf77;super({..._0x30d818,'name':'cogni-living'}),this[_0x51b030(0x2e3)]=[],this['analysisHistory']=[],this[_0x51b030(0x32f)]=[],this[_0x51b030(0x282)]=[],this[_0x51b030(0x208)]={},this['systemConfig']={'latitude':0x0,'longitude':0x0,'city':''},this[_0x51b030(0x2d8)]=!![],this[_0x51b030(0x28b)]=null,this[_0x51b030(0x336)]=null,this[_0x51b030(0x2b8)]=![],this[_0x51b030(0x2cd)]=null,this['geminiModel']=null,this[_0x51b030(0x357)]=SYSTEM_MODES['NORMAL'],this[_0x51b030(0x300)]=![],this[_0x51b030(0x27e)]=![],this[_0x51b030(0x268)]=_0x51b030(0x30e),this[_0x51b030(0x35b)]=null,this[_0x51b030(0x33b)]=null,this['modeResetJob']=null,this[_0x51b030(0x343)]=null,this['briefingJob']=null,this[_0x51b030(0x2ba)]=null,this[_0x51b030(0x2db)]=![],this['on'](_0x51b030(0x24d),this['onReady'][_0x51b030(0x2e2)](this)),this['on'](_0x51b030(0x36d),this['onStateChange'][_0x51b030(0x2e2)](this)),this['on'](_0x51b030(0x270),this[_0x51b030(0x31c)][_0x51b030(0x2e2)](this)),this['on'](_0x51b030(0x2b3),this[_0x51b030(0x379)]['bind'](this));}async['onReady'](){const _0x4d0012=a0_0xdf77;this[_0x4d0012(0x30b)][_0x4d0012(0x293)]('cogni-living\x20adapter\x20starting\x20(v'+this[_0x4d0012(0x20e)]+_0x4d0012(0x20a));if(!checkAndInstall(this))return;await startSystem(this);}[a0_0xdf77(0x31c)](_0x1cc5c2){const _0x4819e1=a0_0xdf77;if(this['analysisTimer'])clearInterval(this[_0x4819e1(0x35b)]);if(this[_0x4819e1(0x343)])clearInterval(this[_0x4819e1(0x343)]);if(this[_0x4819e1(0x33b)])this[_0x4819e1(0x33b)][_0x4819e1(0x25b)]();if(this[_0x4819e1(0x338)])this[_0x4819e1(0x338)][_0x4819e1(0x25b)]();if(this['briefingJob'])this['briefingJob'][_0x4819e1(0x25b)]();if(this['exitTimer'])clearTimeout(this['exitTimer']);if(this[_0x4819e1(0x336)])clearTimeout(this['exitGraceTimer']);stopPythonService(this),_0x1cc5c2();}async[a0_0xdf77(0x2e4)](_0x217d3f,_0x3ee993){const _0xe7950e=a0_0xdf77;if(!_0x3ee993||this[_0xe7950e(0x2db)])return;if(_0x217d3f[_0xe7950e(0x2d4)](_0xe7950e(0x277))&&_0x217d3f[_0xe7950e(0x2dc)]('communicate.request')&&_0x3ee993[_0xe7950e(0x27c)]){await handleTelegramResponse(this,_0x3ee993[_0xe7950e(0x27c)]);return;}if(_0x217d3f===this[_0xe7950e(0x29f)]+'.'+SYSTEM_DP_MODE){if(_0x3ee993[_0xe7950e(0x27c)]&&Object['values'](SYSTEM_MODES)[_0xe7950e(0x2d4)](_0x3ee993['val'])){this[_0xe7950e(0x357)]=_0x3ee993[_0xe7950e(0x27c)];if(_0x3ee993[_0xe7950e(0x27c)]===SYSTEM_MODES[_0xe7950e(0x296)])await setPresence(this,![]);else await setPresence(this,!![]);}if(!_0x3ee993[_0xe7950e(0x271)])this[_0xe7950e(0x308)](_0x217d3f,{'val':this['currentSystemMode'],'ack':!![]});return;}if(!_0x3ee993[_0xe7950e(0x271)]){_0x217d3f[_0xe7950e(0x2d4)](_0xe7950e(0x242))&&_0x3ee993[_0xe7950e(0x27c)]&&(this['setState'](_0x217d3f,{'val':![],'ack':!![]}),runGeminiAnalysis(this));if(_0x217d3f['includes']('triggerDailyDigest')&&_0x3ee993[_0xe7950e(0x27c)]){this[_0xe7950e(0x308)](_0x217d3f,{'val':![],'ack':!![]});if(this[_0xe7950e(0x300)])createDailyDigest(this);}_0x217d3f[_0xe7950e(0x2d4)]('triggerBriefing')&&_0x3ee993['val']&&(this['setState'](_0x217d3f,{'val':![],'ack':!![]}),sendMorningBriefing(this));_0x217d3f['includes']('automation.triggerAction')&&_0x3ee993[_0xe7950e(0x27c)]&&(this[_0xe7950e(0x308)](_0x217d3f,{'val':![],'ack':!![]}),executeAutomationAction(this));if(_0x217d3f[_0xe7950e(0x2d4)](_0xe7950e(0x27d))&&_0x3ee993['val']){this[_0xe7950e(0x308)](_0x217d3f,{'val':![],'ack':!![]});if(this[_0xe7950e(0x300)])try{const _0x47a00a=await this[_0xe7950e(0x230)](_0xe7950e(0x272));if(_0x47a00a&&_0x47a00a[_0xe7950e(0x27c)]){const _0x494336=JSON['parse'](_0x47a00a[_0xe7950e(0x27c)]);this[_0xe7950e(0x30b)]['info'](_0xe7950e(0x310)),this['setStateAsync']('analysis.training.status',{'val':_0xe7950e(0x210),'ack':!![]}),sendToPython(this,_0xe7950e(0x347),{'sequences':_0x494336});}}catch(_0x13afbe){this['log']['error'](_0xe7950e(0x2a9)+_0x13afbe['message']);}}if(_0x217d3f['includes'](_0xe7950e(0x33f))&&_0x3ee993[_0xe7950e(0x27c)]){this['setState'](_0x217d3f,{'val':![],'ack':!![]});if(this[_0xe7950e(0x300)])try{const _0x1fc06c=await this['getStateAsync'](LTM_DP_DAILY_DIGESTS);if(_0x1fc06c&&_0x1fc06c[_0xe7950e(0x27c)])sendToPython(this,_0xe7950e(0x2c5),{'digests':JSON[_0xe7950e(0x2bd)](_0x1fc06c['val'])});}catch(_0x1ed689){}}if(_0x217d3f[_0xe7950e(0x2d4)](_0xe7950e(0x2b5))&&_0x3ee993[_0xe7950e(0x27c)]){this[_0xe7950e(0x308)](_0x217d3f,{'val':![],'ack':!![]});if(this[_0xe7950e(0x300)])try{const _0x209620=await this[_0xe7950e(0x230)](_0xe7950e(0x29a));if(_0x209620&&_0x209620[_0xe7950e(0x27c)])sendToPython(this,_0xe7950e(0x28d),{'points':JSON['parse'](_0x209620[_0xe7950e(0x27c)])});}catch(_0x434a33){}}return;}if(this[_0xe7950e(0x25e)]['presenceDevices']&&this['config'][_0xe7950e(0x2de)][_0xe7950e(0x2d4)](_0x217d3f)){await checkWifiPresence(this);return;}const _0x295e76=(this[_0xe7950e(0x25e)]['devices']||[])['find'](_0x13f69d=>_0x13f69d['id']===_0x217d3f);if(_0x295e76)processSensorEvent(this,_0x217d3f,_0x3ee993,_0x295e76);}async[a0_0xdf77(0x379)](_0x4f8233){const _0x2c2278=a0_0xdf77;if(typeof _0x4f8233===_0x2c2278(0x292)&&_0x4f8233[_0x2c2278(0x2b3)]){if(_0x4f8233['command']===_0x2c2278(0x34e)){const _0x3a6fe6=_0x4f8233[_0x2c2278(0x2b3)][_0x2c2278(0x335)]||this[_0x2c2278(0x25e)][_0x2c2278(0x295)];if(!_0x3a6fe6)return this[_0x2c2278(0x37e)](_0x4f8233[_0x2c2278(0x330)],_0x4f8233[_0x2c2278(0x30f)],{'success':![],'message':_0x2c2278(0x329)},_0x4f8233[_0x2c2278(0x203)]);try{const _0x2dfd68=new GoogleGenerativeAI(_0x3a6fe6),_0x5f51fa=_0x2dfd68['getGenerativeModel']({'model':GEMINI_MODEL}),_0x5e1691=await _0x5f51fa[_0x2c2278(0x34a)]('Hi');this[_0x2c2278(0x37e)](_0x4f8233[_0x2c2278(0x330)],_0x4f8233[_0x2c2278(0x30f)],{'success':!![],'message':_0x2c2278(0x235)+_0x5e1691[_0x2c2278(0x331)]['text']()},_0x4f8233[_0x2c2278(0x203)]);}catch(_0x43cc49){this['sendTo'](_0x4f8233[_0x2c2278(0x330)],_0x4f8233[_0x2c2278(0x30f)],{'success':![],'message':'Err:\x20'+_0x43cc49[_0x2c2278(0x2b3)]},_0x4f8233[_0x2c2278(0x203)]);}}else{if(_0x4f8233[_0x2c2278(0x30f)]==='testContext'){const _0x2ebccb=await getWeatherContext(this),_0x4916c3=await getCalendarContext(this);this['sendTo'](_0x4f8233[_0x2c2278(0x330)],_0x4f8233['command'],{'success':!![],'weather':_0x2ebccb,'calendar':_0x4916c3},_0x4f8233[_0x2c2278(0x203)]);}else{if(_0x4f8233[_0x2c2278(0x30f)]===_0x2c2278(0x1f0)){if(!this[_0x2c2278(0x300)])return this[_0x2c2278(0x37e)](_0x4f8233[_0x2c2278(0x330)],_0x4f8233[_0x2c2278(0x30f)],{'success':![],'isPro':![]},_0x4f8233['callback']);let _0x13463b={'status':_0x2c2278(0x366)};try{const _0x4df9a7=await this[_0x2c2278(0x230)](LTM_DP_DRIFT_STATUS);_0x13463b[_0x2c2278(0x2e6)]=_0x4df9a7?_0x4df9a7[_0x2c2278(0x27c)]:_0x2c2278(0x366);}catch(_0x1a638a){}this[_0x2c2278(0x37e)](_0x4f8233[_0x2c2278(0x330)],_0x4f8233[_0x2c2278(0x30f)],{'success':!![],'isPro':!![],'dailyDigests':this[_0x2c2278(0x282)],'driftAnalysis':_0x13463b,'analysisHistory':this[_0x2c2278(0x2d7)]},_0x4f8233[_0x2c2278(0x203)]);}else{if(_0x4f8233[_0x2c2278(0x30f)]===_0x2c2278(0x288)){const _0x52892e=this[_0x2c2278(0x282)]['length'],_0x40947c=new Date(),_0x1c224c=new Date(_0x40947c[_0x2c2278(0x289)](),_0x40947c['getMonth'](),_0x40947c[_0x2c2278(0x260)]())[_0x2c2278(0x2f8)](),_0x35ef04=this[_0x2c2278(0x32f)][_0x2c2278(0x365)](_0x280fea=>new Date(_0x280fea['timestamp'])['getTime']()>_0x1c224c)[_0x2c2278(0x314)],_0x277d1b=new Array(0x18)[_0x2c2278(0x2ec)](0x0);this['rawEventLog']['forEach'](_0x21d5c6=>{const _0x3df276=_0x2c2278,_0x228147=new Date(_0x21d5c6['timestamp']);if(_0x228147['getTime']()>_0x1c224c)_0x277d1b[_0x228147[_0x3df276(0x33d)]()]++;});let _0x3a2da1={'status':'N/A'};try{const _0x5e81ae=await this[_0x2c2278(0x230)](LTM_DP_DRIFT_STATUS);_0x3a2da1[_0x2c2278(0x2e6)]=_0x5e81ae?_0x5e81ae['val']:_0x2c2278(0x366);}catch(_0x4cadce){}let _0x57cf52='';try{const _0x2c7a79=await this[_0x2c2278(0x230)](_0x2c2278(0x2d5));_0x57cf52=_0x2c7a79?_0x2c7a79[_0x2c2278(0x27c)]:'';}catch(_0x358224){}let _0x411d40=null;!this[_0x2c2278(0x29e)]&&(_0x411d40=this[_0x2c2278(0x25e)][_0x2c2278(0x295)]?_0x2c2278(0x269):_0x2c2278(0x30a));let _0x1a3005={'detected':![],'description':'','targetId':'','targetValue':'','autoApply':![]};try{const _0x39e52c=await this[_0x2c2278(0x230)](_0x2c2278(0x2b7));if(_0x39e52c&&_0x39e52c[_0x2c2278(0x27c)]){_0x1a3005['detected']=!![];const _0x2ee93c=await this[_0x2c2278(0x230)](_0x2c2278(0x24f));_0x1a3005['description']=_0x2ee93c?_0x2ee93c[_0x2c2278(0x27c)]:'';const _0x191a86=await this['getStateAsync']('analysis.automation.targetId');_0x1a3005[_0x2c2278(0x207)]=_0x191a86?_0x191a86[_0x2c2278(0x27c)]:'';const _0x2b3bed=await this[_0x2c2278(0x230)](_0x2c2278(0x2b0));_0x1a3005[_0x2c2278(0x1f7)]=_0x2b3bed?_0x2b3bed[_0x2c2278(0x27c)]:'';}const _0x24d54b=await this[_0x2c2278(0x230)]('analysis.automation.autoApply');_0x1a3005[_0x2c2278(0x320)]=_0x24d54b?!!_0x24d54b[_0x2c2278(0x27c)]:![];}catch(_0x26d021){}this['sendTo'](_0x4f8233[_0x2c2278(0x330)],_0x4f8233['command'],{'success':!![],'eventHistory':this[_0x2c2278(0x2e3)]['slice'](0x0,0xf),'stats':{'digestCount':_0x52892e,'eventCountToday':_0x35ef04,'hourlyActivity':_0x277d1b,'driftStatus':_0x3a2da1[_0x2c2278(0x2e6)],'isPresent':this[_0x2c2278(0x2d8)],'presenceWho':_0x57cf52,'minDays':this[_0x2c2278(0x25e)][_0x2c2278(0x21d)]||0x7,'stbDays':this['config'][_0x2c2278(0x361)]||0xe,'ltbDays':this[_0x2c2278(0x25e)][_0x2c2278(0x221)]||0x3c,'systemError':_0x411d40},'automation':_0x1a3005},_0x4f8233[_0x2c2278(0x203)]);}else{if(_0x4f8233[_0x2c2278(0x30f)]===_0x2c2278(0x20d))try{const _0x46e6c0=await scanForDevices(this,_0x4f8233[_0x2c2278(0x2b3)]||{});this[_0x2c2278(0x37e)](_0x4f8233[_0x2c2278(0x330)],_0x4f8233[_0x2c2278(0x30f)],{'success':!![],'devices':_0x46e6c0},_0x4f8233[_0x2c2278(0x203)]);}catch(_0x22ec92){this[_0x2c2278(0x37e)](_0x4f8233[_0x2c2278(0x330)],_0x4f8233[_0x2c2278(0x30f)],{'success':![],'error':_0x22ec92['message']},_0x4f8233[_0x2c2278(0x203)]);}else{if(_0x4f8233[_0x2c2278(0x30f)]===_0x2c2278(0x339)){const _0x44cee5=await this[_0x2c2278(0x315)](_0x2c2278(0x378),_0x2c2278(0x32b)),_0x16848d=[];if(_0x44cee5)for(const _0x1c6d14 in _0x44cee5){const _0x3f34ae=_0x44cee5[_0x1c6d14],_0x57b3e1=(_0x3f34ae['common']&&typeof _0x3f34ae[_0x2c2278(0x261)][_0x2c2278(0x284)]===_0x2c2278(0x292)?_0x3f34ae[_0x2c2278(0x261)][_0x2c2278(0x284)]['de']:_0x3f34ae[_0x2c2278(0x261)][_0x2c2278(0x284)])||_0x3f34ae[_0x2c2278(0x261)][_0x2c2278(0x284)];_0x16848d['push']({'id':_0x1c6d14,'name':_0x57b3e1});}this[_0x2c2278(0x37e)](_0x4f8233[_0x2c2278(0x330)],_0x4f8233[_0x2c2278(0x30f)],{'success':!![],'enums':_0x16848d},_0x4f8233['callback']);}else{if(_0x4f8233[_0x2c2278(0x30f)]===_0x2c2278(0x241)){const _0x57771d=_0x4f8233['message'][_0x2c2278(0x2dd)];if(!_0x57771d)return this['sendTo'](_0x4f8233[_0x2c2278(0x330)],_0x4f8233['command'],{'success':![],'error':_0x2c2278(0x2f6)},_0x4f8233[_0x2c2278(0x203)]);const _0x5f4ec1=await getCalendarNames(this,_0x57771d);this[_0x2c2278(0x37e)](_0x4f8233[_0x2c2278(0x330)],_0x4f8233['command'],{'success':!![],'names':_0x5f4ec1},_0x4f8233[_0x2c2278(0x203)]);}else{if(_0x4f8233[_0x2c2278(0x30f)]===_0x2c2278(0x2c3)){const {targetId:_0x403f6b,targetValue:_0xce078}=_0x4f8233[_0x2c2278(0x2b3)];this[_0x2c2278(0x30b)][_0x2c2278(0x293)]('ðŸ§ª\x20Simulating\x20Butler\x20Proposal:\x20'+_0x403f6b+_0x2c2278(0x35e)+_0xce078),await this[_0x2c2278(0x1ea)](_0x2c2278(0x2b7),{'val':!![],'ack':!![]}),await this[_0x2c2278(0x1ea)](_0x2c2278(0x24f),{'val':_0x2c2278(0x1e9)+_0x403f6b,'ack':!![]}),await this['setStateAsync'](_0x2c2278(0x2f9),{'val':_0x403f6b,'ack':!![]}),await this[_0x2c2278(0x1ea)](_0x2c2278(0x2b0),{'val':_0xce078,'ack':!![]}),this[_0x2c2278(0x37e)](_0x4f8233[_0x2c2278(0x330)],_0x4f8233['command'],{'success':!![]},_0x4f8233[_0x2c2278(0x203)]);}else{if(_0x4f8233[_0x2c2278(0x30f)]===_0x2c2278(0x25f)){const {historyId:_0x3c5f8f,rating:_0x3b74c0,comment:_0x6e4f54,alertReason:_0x130f37}=_0x4f8233['message'];_0x3c5f8f&&_0x3b74c0?(await saveFeedback(this,{'timestamp':Date['now'](),'historyId':_0x3c5f8f,'rating':_0x3b74c0,'comment':_0x6e4f54,'alertReason':_0x130f37}),this[_0x2c2278(0x37e)](_0x4f8233['from'],_0x4f8233['command'],{'success':!![]},_0x4f8233['callback'])):this[_0x2c2278(0x37e)](_0x4f8233['from'],_0x4f8233['command'],{'success':![],'error':_0x2c2278(0x2da)},_0x4f8233[_0x2c2278(0x203)]);}else _0x4f8233['command']===_0x2c2278(0x2e7)&&(this[_0x2c2278(0x30b)][_0x2c2278(0x293)](_0x2c2278(0x214)),await this[_0x2c2278(0x1ea)]('analysis.automation.patternDetected',{'val':![],'ack':!![]}),await this[_0x2c2278(0x1ea)]('analysis.automation.description',{'val':'','ack':!![]}),this[_0x2c2278(0x37e)](_0x4f8233[_0x2c2278(0x330)],_0x4f8233[_0x2c2278(0x30f)],{'success':!![]},_0x4f8233[_0x2c2278(0x203)]));}}}}}}}}}}}if(require[a0_0xdf77(0x27b)]!==module)module['exports']=_0x12138c=>new CogniLiving(_0x12138c);else new CogniLiving();