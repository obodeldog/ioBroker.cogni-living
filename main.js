const a0_0x388135=a0_0x4183;(function(_0x12cc6e,_0x3d7ad3){const _0x28873f=a0_0x4183,_0x249ec9=_0x12cc6e();while(!![]){try{const _0x5121a2=-parseInt(_0x28873f(0x1e8))/0x1*(parseInt(_0x28873f(0x29e))/0x2)+-parseInt(_0x28873f(0x1b7))/0x3+-parseInt(_0x28873f(0x202))/0x4*(-parseInt(_0x28873f(0x229))/0x5)+-parseInt(_0x28873f(0x23a))/0x6+parseInt(_0x28873f(0x2a8))/0x7+parseInt(_0x28873f(0x158))/0x8+-parseInt(_0x28873f(0x131))/0x9;if(_0x5121a2===_0x3d7ad3)break;else _0x249ec9['push'](_0x249ec9['shift']());}catch(_0x30c34f){_0x249ec9['push'](_0x249ec9['shift']());}}}(a0_0x4684,0xac3c5));const a0_0x4ae90b=(function(){let _0x48d727=!![];return function(_0x5f0b83,_0x56cbe3){const _0x3bf8fb=_0x48d727?function(){if(_0x56cbe3){const _0x20784a=_0x56cbe3['apply'](_0x5f0b83,arguments);return _0x56cbe3=null,_0x20784a;}}:function(){};return _0x48d727=![],_0x3bf8fb;};}()),a0_0x2df8c7=a0_0x4ae90b(this,function(){const _0x45b465=a0_0x4183;return a0_0x2df8c7['toString']()[_0x45b465(0x20d)](_0x45b465(0x208))[_0x45b465(0x248)]()['constructor'](a0_0x2df8c7)[_0x45b465(0x20d)]('(((.+)+)+)+$');});a0_0x2df8c7();'use strict';const utils=require('@iobroker/adapter-core'),{GoogleGenerativeAI}=require(a0_0x388135(0x1d5)),schedule=require(a0_0x388135(0x1a2)),{spawn,exec}=require(a0_0x388135(0x26f)),path=require(a0_0x388135(0x194)),fs=require('fs'),HISTORY_MAX_SIZE=0x32,RAW_LOG_MAX_SIZE=0x5dc,LTM_MIN_EVENTS_FOR_COMPRESSION=0x5,GEMINI_MODEL=a0_0x388135(0x23e),LTM_SCHEDULE=a0_0x388135(0x250),MODE_RESET_SCHEDULE='0\x204\x20*\x20*\x20*',SEQUENCE_TIMEOUT_MS=0x5*0x3c*0x3e8,MAX_TRAINING_SET_SIZE=0x1f4,THERMO_LOG_SIZE=0x3e8,ANALYSIS_HISTORY_MAX_SIZE=0x64,EXIT_TIMER_MINUTES=0xf,EXIT_GRACE_PERIOD_SECONDS=0x1e,LTM_DP_RAW_LOG=a0_0x388135(0x2a7),LTM_DP_DAILY_DIGESTS='LTM.dailyDigests',LTM_DP_STATUS=a0_0x388135(0x24c),LTM_DP_TRIGGER_DIGEST='LTM.triggerDailyDigest',LTM_DP_BASELINE_STATUS=a0_0x388135(0x285),LTM_DP_DRIFT_CHANNEL=a0_0x388135(0x279),LTM_DP_DRIFT_STATUS=a0_0x388135(0x19c),LTM_DP_DRIFT_DETAILS=a0_0x388135(0x14e),LTM_DP_DRIFT_LAST_CHECK=a0_0x388135(0x252),SYSTEM_DP_MODE=a0_0x388135(0x1c2),SYSTEM_MODES={'NORMAL':a0_0x388135(0x18a),'VACATION':a0_0x388135(0x146),'PARTY':a0_0x388135(0x189),'GUEST':a0_0x388135(0x226)},AUTO_RESET_MODES=[SYSTEM_MODES[a0_0x388135(0x1de)],SYSTEM_MODES[a0_0x388135(0x16c)]],PERSONA_MAPPING={'generic':a0_0x388135(0x1e9),'senior_aal':a0_0x388135(0x25e),'family':a0_0x388135(0x24b),'single_comfort':a0_0x388135(0x1bf),'security':'PRIORIT√ÑT:\x20Sicherheit.'},ACTIVITY_LEVEL_MAP={'sehr\x20hoch':0x64,'hoch':0x50,'normal':0x3c,'niedrig':0x28,'sehr\x20niedrig':0x14,'inaktiv':0x0},HARD_IGNORE_TERMS=[a0_0x388135(0x2a4),a0_0x388135(0x1c9),'update','unreach','lowbat',a0_0x388135(0x1b2),a0_0x388135(0x274),a0_0x388135(0x16f),a0_0x388135(0x1a8),a0_0x388135(0x2a5),a0_0x388135(0x17d),a0_0x388135(0x2ad),a0_0x388135(0x13d),a0_0x388135(0x21e),a0_0x388135(0x16e),a0_0x388135(0x1c1),a0_0x388135(0x176),a0_0x388135(0x1ab)],BAD_NAMES=['targetposition','currentposition',a0_0x388135(0x17e),'level',a0_0x388135(0x22c),a0_0x388135(0x163),'on',a0_0x388135(0x1c8),'switch',a0_0x388135(0x231),a0_0x388135(0x278),a0_0x388135(0x1c5),a0_0x388135(0x256),a0_0x388135(0x224),a0_0x388135(0x1f3),a0_0x388135(0x155),a0_0x388135(0x268),'temperature',a0_0x388135(0x240),a0_0x388135(0x298),a0_0x388135(0x251),a0_0x388135(0x132),a0_0x388135(0x24d),'actual_temperature',a0_0x388135(0x225)],ADAPTER_BLACKLIST=[a0_0x388135(0x264),a0_0x388135(0x1a9),'info.',a0_0x388135(0x237),a0_0x388135(0x261),a0_0x388135(0x265),a0_0x388135(0x168),'flot.','echarts.',a0_0x388135(0x20b),a0_0x388135(0x140)],IS_WIN=process['platform']===a0_0x388135(0x1cb),VENV_PATH=path[a0_0x388135(0x15b)](__dirname,a0_0x388135(0x15c)),PYTHON_EXE=IS_WIN?path[a0_0x388135(0x15b)](VENV_PATH,'Scripts',a0_0x388135(0x1a6)):path[a0_0x388135(0x15b)](VENV_PATH,a0_0x388135(0x22b),a0_0x388135(0x142)),PIP_EXE=IS_WIN?path[a0_0x388135(0x15b)](VENV_PATH,a0_0x388135(0x281),a0_0x388135(0x138)):path[a0_0x388135(0x15b)](VENV_PATH,'bin','pip');function a0_0x4684(){const _0x3ab248=['saveFeedback','bin','value','targetId','pythonProcess','close','window','position','dependencyInstallInProgress','python_service','automationProposal','members','apiKey','vis.','runPythonHealthCheck','Failed:\x20','1104198ZzFjeh','Unknown','weatherunderground','startPythonService','models/gemini-flash-latest','analysisHistory','humidity','onMessage','üõ°Ô∏è\x20SECURITY:\x20Sending\x20sequence\x20to\x20Guard\x20for\x20analysis...','alertReason','debug','User\x20dismissed\x20automation\x20proposal.','setupLtmScheduler','\x20=\x20','toString','.\x20AUFGABE:\x201.\x20Gesundheit?\x202.\x20Komfort?\x20FORMAT\x20(JSON):\x20{\x20\x22isAlert\x22:\x20boolean,\x20\x22alertReason\x22:\x20\x22string\x22,\x20\x22isEmergency\x22:\x20boolean,\x20\x22summary\x22:\x20\x22string\x22,\x20\x22automationProposal\x22:\x20{\x20\x22detected\x22:\x20boolean,\x20\x22description\x22:\x20\x22string\x22,\x20\x22targetId\x22:\x20\x22string\x22,\x20\x22targetValue\x22:\x20\x22any\x22\x20}\x20}','‚úÖ\x20INSTALLATION\x20COMPLETE.\x20Starting\x20Service...','Fokus\x20auf\x20Familienroutinen.','LTM.processingStatus','valve','setState','setPresence','0\x203\x20*\x20*\x20*','energy','LTM.driftAnalysis.lastCheck','[PYTHON\x20ERR]\x20','contact','door','cover','object','service.py','ROLLE:\x20KI-Hausverwalter\x20&\x20Gesundheits-Assistent.\x20PERSONA:\x20','ENERGY_TRAIN_RESULT','.forecast.current.temp','\x22\x20install\x20-r\x20\x22','insulation','PRIORIT√ÑT:\x20Gesundheit/AAL.','geminiApiKey','Gemini\x20Error:\x20','history.','analysis.security.lastCheck','getEnums','system.','material.','cogni-living\x20adapter\x20starting\x20(v','getCalendarContext','occupancy','common','kill','analysisTimer','Adapter','LTM.trainingData.sequences','livingContext','child_process','dailyDigests','analysis.energy.insulationScore','from','No\x20instance','connection','system.presenceWho','.forecast.current.temperature','find','shutter','LTM.driftAnalysis','now','dimmer','fill','response','feedbackHistory','includes','toISOString','Scripts','NORMAL','runAutopilot','stopPythonService','LTM.baselineStatus','instance','subscribeStates','name','Kein\x20API\x20Key\x20eingegeben.','systemUUID','setStateAsync','heating','getWeatherContext','sendTo','üß™\x20Simulating\x20Butler\x20Proposal:\x20','command','Success:\x20','events.history','setupBriefingScheduler','getFullYear','map','saveDailyDigests','sendMorningBriefing','power','summary','Training\x20Error:\x20','üêç\x20Python\x20Pong','runGeminiAnalysis','licenseKey','2gjLdGf','currentSystemMode','bind','startsWith','checkWifiPresence','LTM.trainingData.thermodynamics','scriptProblem','fault','analysis.training.triggerEnergy','LTM.rawEventLog','7019362gwIyJV','round','minDaysForBaseline','doors','analysis.training.triggerHealth','direction','sequenceTimer','9575856cdODpH','setpoint','weather','createDailyDigest','main','text','getOverviewData','pip.exe','getDate','eventHistory','push','genAI','stick_unreach','Sec-Training\x20started...','createAllObjects','simple-api.','executeAutomationAction','python','val','communicate.request','message','vacation','briefingJob','analysis.activitySummary','existsSync','namespace','checkLicense','trim','saveRawEventLog','LTM.driftAnalysis.driftDetails','\x20->\x20','isPresent','length','üß†\x20Triggering\x20Security\x20Training\x20with\x20','details','analysis.automation.targetId','presence','isEmergency','getForeignObjectsAsync','7374376ALqdIc','onStateChange','‚ö†Ô∏è\x20SECURITY\x20ALARM:\x20','join','.venv','payload','loadSystemMode','schalter','filter','ltmLtbWindowDays','setupTelegramListener','brightness','unshift','automation.triggerAction','getCalendarNames','üõ°Ô∏è\x20SECURITY\x20CHECK:\x20Score\x20','icons-mfd.','abortExitTimer','temperature','PONG','GUEST','klima','dutycycle','maintenance','driftAnalysisTimer','aiPersona','config','runSecurityCheck','lastAlertState','exports','reachable','sensor','timestamp','autoApply','loadRawEventLog','[RECORDER]\x20Added\x20step\x20to\x20sequence:\x20','üêç\x20Using\x20VENV\x20Python:\x20','working','state','Missing\x20data','licht','geminiModel','log','getLtmData','unload','detected','write','getGenerativeModel','rawEventLog','party','normal','cancel','VACATION','forEach','isAlert','lastIndexOf','Started...','pr√§senz','ack','parse','path','Bibliotheken\x20nicht\x20gefunden','‚ö†Ô∏è\x20Python\x20missing\x20libs.\x20Auto-Install\x20triggered.','targetValue','warn','enum','getMonth','testApiKey','LTM.driftAnalysis.baselineDrift','recordSequence','sendToPython','submitFeedback','‚ö†Ô∏è\x20VENV\x20missing.\x20Attempting\x20install...','modeResetJob','node-schedule','updateAnalysisHistory','scanDevices','.NextHours.Location_1.Day_1.current.temp_value','python.exe','‚ùå\x20VENV\x20CREATION\x20FAILED.\x20Please\x20run:\x20sudo\x20apt\x20install\x20python3-venv','error','admin.','heizung','link_quality','presenceDevices','.Current.Temperature','testContext','data','üêç\x20Stopping\x20Python...','stringify','rssi','.\x20WETTER:\x20','stderr','[PYTHON]\x20','No\x20module\x20named','110715oYtzSQ','t√ºr','rollladen','endsWith','Unbekannt','bewegung','lights','accuweather','Fokus\x20auf\x20Komfort.','installRequirementsInVenv','firmware','system.mode','\x20(Length:\x20','exitTimer','blind','fenster','stateChange','off','scriptEnabled','N/A','win32','sensorLastValues','‚ö†Ô∏è\x20Broken\x20venv\x20detected.\x20Repairing...','analysis.automation.targetValue','analysis.training.status','analysis.training.triggerSecurity','TRAIN_HEALTH','sendNotification','getTime','analysis.security.lastScore','@google/generative-ai','location','activeSequence','selectedFunctionIds','inactivityThresholdHours','type','light','stdout','Error\x20launching\x20Python:\x20','PARTY','Invalid\x20JSON:\x20','SIMULATION:\x20Test-Vorschlag\x20f√ºr\x20','ltmJob','‚ö†Ô∏è\x20ALARM:\x20','split','getStateAsync','Kein\x20API\x20Key!','kontakt','requirements.txt','1096614pDJyXt','Analysiere\x20ausgewogen.','Say\x20Hello','initZombies','.\x20SYSTEM_MODE:\x20','substring','isProVersion','recordThermodynamics','toLowerCase','systemConfig','generic','motion','devices','enum.functions.*','SECURITY_RESULT','temperatur','Keine\x20Details.','some','enum.rooms.*','ANALYZE_HEALTH','analysis.automation.patternDetected','switch',')\x20-\x20FULL\x20CLASS\x20MODE','onReady','outdoorSensorId','TRAIN_ENERGY','13400aSmImi','handlePythonResult','setupModeResetScheduler','cogni-living','info','analysis.automation.autoApply','(((.+)+)+)+$','getForeignStateAsync','loc','javascript.','installPythonDependencies','search','description','analysis.automation.description','replace','analysis.isAlert','HEALTH_RESULT','toFixed','isGracePeriodActive','version','ANOMALY','scanForDevices','analysis.alertReason','lock','analysisInterval','slice','Installing\x20dependencies\x20into\x20venv...','telegram','config_pending','callback','setupDriftAnalysisScheduler','unknown','thermostat','events.lastEvent','status','set_temperature','guest','getHours','application/json','1735hYpkZF'];a0_0x4684=function(){return _0x3ab248;};return a0_0x4684();}function a0_0x4183(_0x40e92b,_0x1e26cb){const _0x25562a=a0_0x4684();return a0_0x4183=function(_0x2df8c7,_0x4ae90b){_0x2df8c7=_0x2df8c7-0x130;let _0x46847f=_0x25562a[_0x2df8c7];return _0x46847f;},a0_0x4183(_0x40e92b,_0x1e26cb);}class CogniLiving extends utils[a0_0x388135(0x26c)]{constructor(_0x125bfb){const _0x468ca9=a0_0x388135;super({..._0x125bfb,'name':_0x468ca9(0x205)}),this[_0x468ca9(0x13a)]=[],this['analysisHistory']=[],this[_0x468ca9(0x27e)]=[],this['rawEventLog']=[],this['dailyDigests']=[],this[_0x468ca9(0x1cc)]={},this[_0x468ca9(0x1f1)]={'latitude':0x0,'longitude':0x0,'city':''},this[_0x468ca9(0x150)]=!![],this[_0x468ca9(0x1c4)]=null,this['exitGraceTimer']=null,this[_0x468ca9(0x214)]=![],this[_0x468ca9(0x13c)]=null,this[_0x468ca9(0x181)]=null,this[_0x468ca9(0x29f)]=SYSTEM_MODES[_0x468ca9(0x282)],this[_0x468ca9(0x1ee)]=![],this['lastAlertState']=![],this[_0x468ca9(0x28a)]=_0x468ca9(0x221),this[_0x468ca9(0x26b)]=null,this[_0x468ca9(0x1e1)]=null,this[_0x468ca9(0x1a1)]=null,this[_0x468ca9(0x170)]=null,this[_0x468ca9(0x147)]=null,this[_0x468ca9(0x22e)]=null,this[_0x468ca9(0x232)]=![],this[_0x468ca9(0x1d7)]=[],this[_0x468ca9(0x130)]=null,this['on']('ready',this[_0x468ca9(0x1ff)][_0x468ca9(0x2a0)](this)),this['on'](_0x468ca9(0x1c7),this[_0x468ca9(0x159)][_0x468ca9(0x2a0)](this)),this['on'](_0x468ca9(0x184),this['onUnload']['bind'](this)),this['on'](_0x468ca9(0x145),this[_0x468ca9(0x241)][_0x468ca9(0x2a0)](this));}async[a0_0x388135(0x1ff)](){const _0x3900bc=a0_0x388135;this[_0x3900bc(0x182)][_0x3900bc(0x206)](_0x3900bc(0x266)+this[_0x3900bc(0x215)]+_0x3900bc(0x1fe)),await this[_0x3900bc(0x1eb)](),this['config'][_0x3900bc(0x29d)]=this[_0x3900bc(0x172)][_0x3900bc(0x29d)]||'';try{this[_0x3900bc(0x1ee)]=await this[_0x3900bc(0x14b)](this['config'][_0x3900bc(0x29d)]);}catch(_0x4117f7){}if(!this[_0x3900bc(0x172)][_0x3900bc(0x1d9)]||this[_0x3900bc(0x172)]['inactivityThresholdHours']<0.1)this[_0x3900bc(0x172)]['inactivityThresholdHours']=0xc;await this['initHistory'](),await this['initSystemConfig']();if(this[_0x3900bc(0x172)][_0x3900bc(0x25f)])try{this['genAI']=new GoogleGenerativeAI(this[_0x3900bc(0x172)][_0x3900bc(0x25f)]),this[_0x3900bc(0x181)]=this[_0x3900bc(0x13c)][_0x3900bc(0x187)]({'model':GEMINI_MODEL,'generationConfig':{'responseMimeType':_0x3900bc(0x228)}}),this[_0x3900bc(0x182)][_0x3900bc(0x206)]('Gemini\x20AI\x20initialized.');}catch(_0x141e1f){this[_0x3900bc(0x182)][_0x3900bc(0x1a8)]('Gemini\x20Init\x20Error:\x20'+_0x141e1f[_0x3900bc(0x145)]);}await this[_0x3900bc(0x13f)](),await this[_0x3900bc(0x15e)](),await this[_0x3900bc(0x17a)](),await this['loadDailyDigests'](),this['subscribeStates']('analysis.trigger'),this[_0x3900bc(0x287)](LTM_DP_TRIGGER_DIGEST),this['subscribeStates'](_0x3900bc(0x1c2)),this[_0x3900bc(0x287)]('analysis.triggerBriefing'),this[_0x3900bc(0x287)]('analysis.automation.triggerAction'),this[_0x3900bc(0x287)]('analysis.automation.autoApply'),this['subscribeStates'](_0x3900bc(0x1d0)),this['subscribeStates']('analysis.training.triggerHealth'),this[_0x3900bc(0x287)](_0x3900bc(0x2a6)),await this['initSensorSubscriptions'](),await this['initPresenceSubscriptions'](),await this[_0x3900bc(0x162)](),setTimeout(()=>this['checkWifiPresence'](),0x1388);if(this['analysisTimer'])clearInterval(this['analysisTimer']);const _0x567fb0=this[_0x3900bc(0x172)][_0x3900bc(0x21a)]||0xf;_0x567fb0>0x0&&(this[_0x3900bc(0x26b)]=setInterval(()=>{const _0x3050e2=_0x3900bc;this[_0x3050e2(0x283)]();},_0x567fb0*0x3c*0x3e8)),this[_0x3900bc(0x246)](),this[_0x3900bc(0x204)](),this[_0x3900bc(0x220)](),this[_0x3900bc(0x293)](),this[_0x3900bc(0x23d)](),setTimeout(()=>{const _0xe0c5a1=_0x3900bc;if(this[_0xe0c5a1(0x22e)])this[_0xe0c5a1(0x238)]();},0x1388);}['onUnload'](_0x59c05c){const _0x559863=a0_0x388135;if(this['analysisTimer'])clearInterval(this[_0x559863(0x26b)]);if(this[_0x559863(0x170)])clearInterval(this[_0x559863(0x170)]);if(this['ltmJob'])this[_0x559863(0x1e1)][_0x559863(0x18b)]();if(this['modeResetJob'])this[_0x559863(0x1a1)][_0x559863(0x18b)]();if(this[_0x559863(0x147)])this['briefingJob'][_0x559863(0x18b)]();if(this[_0x559863(0x1c4)])clearTimeout(this[_0x559863(0x1c4)]);if(this['exitGraceTimer'])clearTimeout(this['exitGraceTimer']);this[_0x559863(0x284)](),_0x59c05c();}async[a0_0x388135(0x159)](_0x5d287f,_0x3fd54a){const _0x42faed=a0_0x388135;if(!_0x3fd54a)return;if(this[_0x42faed(0x232)])return;if(_0x5d287f['includes'](_0x42faed(0x21d))&&_0x5d287f[_0x42faed(0x1ba)](_0x42faed(0x144))&&_0x3fd54a['val']){await this['handleTelegramResponse'](_0x3fd54a[_0x42faed(0x143)]);return;}if(_0x5d287f===this[_0x42faed(0x14a)]+'.'+SYSTEM_DP_MODE){_0x3fd54a[_0x42faed(0x143)]&&Object['values'](SYSTEM_MODES)['includes'](_0x3fd54a['val'])&&(this[_0x42faed(0x29f)]=_0x3fd54a[_0x42faed(0x143)],_0x3fd54a[_0x42faed(0x143)]===SYSTEM_MODES[_0x42faed(0x18c)]?await this[_0x42faed(0x24f)](![]):await this['setPresence'](!![]));if(!_0x3fd54a[_0x42faed(0x192)])this[_0x42faed(0x24e)](_0x5d287f,{'val':this[_0x42faed(0x29f)],'ack':!![]});return;}if(!_0x3fd54a[_0x42faed(0x192)]){_0x5d287f['includes']('analysis.trigger')&&_0x3fd54a['val']&&(this[_0x42faed(0x24e)](_0x5d287f,{'val':![],'ack':!![]}),this[_0x42faed(0x29c)]());if(_0x5d287f[_0x42faed(0x27f)]('triggerDailyDigest')&&_0x3fd54a[_0x42faed(0x143)]){this['setState'](_0x5d287f,{'val':![],'ack':!![]});if(this[_0x42faed(0x1ee)])this[_0x42faed(0x134)]();}_0x5d287f[_0x42faed(0x27f)]('triggerBriefing')&&_0x3fd54a[_0x42faed(0x143)]&&(this[_0x42faed(0x24e)](_0x5d287f,{'val':![],'ack':!![]}),this['sendMorningBriefing']());_0x5d287f[_0x42faed(0x27f)](_0x42faed(0x165))&&_0x3fd54a['val']&&(this[_0x42faed(0x24e)](_0x5d287f,{'val':![],'ack':!![]}),this[_0x42faed(0x141)]());if(_0x5d287f[_0x42faed(0x27f)](_0x42faed(0x1d0))&&_0x3fd54a[_0x42faed(0x143)]){this[_0x42faed(0x24e)](_0x5d287f,{'val':![],'ack':!![]});if(!this['isProVersion'])return;try{const _0x233eab=await this[_0x42faed(0x1e4)](_0x42faed(0x26d));if(_0x233eab&&_0x233eab[_0x42faed(0x143)]){const _0x47a783=JSON['parse'](_0x233eab[_0x42faed(0x143)]);this[_0x42faed(0x182)]['info'](_0x42faed(0x152)+_0x47a783[_0x42faed(0x151)]+'\x20sequences...'),this[_0x42faed(0x28b)](_0x42faed(0x1cf),{'val':_0x42faed(0x13e),'ack':!![]}),this['sendToPython']('TRAIN_SECURITY',{'sequences':_0x47a783});}}catch(_0x392d82){this[_0x42faed(0x182)]['error'](_0x42faed(0x29a)+_0x392d82[_0x42faed(0x145)]);}}if(_0x5d287f[_0x42faed(0x27f)](_0x42faed(0x2ac))&&_0x3fd54a['val']){this[_0x42faed(0x24e)](_0x5d287f,{'val':![],'ack':!![]});if(!this[_0x42faed(0x1ee)])return;try{const _0x131892=await this['getStateAsync'](LTM_DP_DAILY_DIGESTS);_0x131892&&_0x131892['val']&&this[_0x42faed(0x19e)](_0x42faed(0x1d1),{'digests':JSON['parse'](_0x131892[_0x42faed(0x143)])});}catch(_0x2d7432){}}if(_0x5d287f[_0x42faed(0x27f)](_0x42faed(0x2a6))&&_0x3fd54a[_0x42faed(0x143)]){this[_0x42faed(0x24e)](_0x5d287f,{'val':![],'ack':!![]});if(!this[_0x42faed(0x1ee)])return;try{const _0x4e60f9=await this['getStateAsync'](_0x42faed(0x2a3));_0x4e60f9&&_0x4e60f9['val']&&this[_0x42faed(0x19e)](_0x42faed(0x201),{'points':JSON['parse'](_0x4e60f9[_0x42faed(0x143)])});}catch(_0x17bc31){}}return;}if(this[_0x42faed(0x172)][_0x42faed(0x1ac)]&&this[_0x42faed(0x172)][_0x42faed(0x1ac)][_0x42faed(0x27f)](_0x5d287f)){await this[_0x42faed(0x2a2)]();return;}const _0x1d3172=(this['config'][_0x42faed(0x1f4)]||[])[_0x42faed(0x277)](_0x56315f=>_0x56315f['id']===_0x5d287f);if(_0x1d3172)this['processSensorEvent'](_0x5d287f,_0x3fd54a,_0x1d3172);}async[a0_0x388135(0x241)](_0x57e57b){const _0x2cfeb1=a0_0x388135;if(typeof _0x57e57b===_0x2cfeb1(0x257)&&_0x57e57b[_0x2cfeb1(0x145)]){if(_0x57e57b[_0x2cfeb1(0x290)]===_0x2cfeb1(0x19b)){const _0x34ac0c=_0x57e57b[_0x2cfeb1(0x145)][_0x2cfeb1(0x236)]||this[_0x2cfeb1(0x172)][_0x2cfeb1(0x25f)];if(!_0x34ac0c)return this['sendTo'](_0x57e57b[_0x2cfeb1(0x272)],_0x57e57b['command'],{'success':![],'message':_0x2cfeb1(0x289)},_0x57e57b[_0x2cfeb1(0x21f)]);try{const _0x32ce16=new GoogleGenerativeAI(_0x34ac0c),_0x5de457=_0x32ce16[_0x2cfeb1(0x187)]({'model':GEMINI_MODEL}),_0x28651a=await _0x5de457['generateContent'](_0x2cfeb1(0x1ea)),_0x151544=await _0x28651a[_0x2cfeb1(0x27d)],_0x2d1085=_0x151544[_0x2cfeb1(0x136)]();this[_0x2cfeb1(0x28e)](_0x57e57b[_0x2cfeb1(0x272)],_0x57e57b[_0x2cfeb1(0x290)],{'success':!![],'message':'Verbindung\x20erfolgreich!\x20Antwort:\x20'+_0x2d1085[_0x2cfeb1(0x1ed)](0x0,0x14)+'...'},_0x57e57b[_0x2cfeb1(0x21f)]);}catch(_0x2da716){this[_0x2cfeb1(0x28e)](_0x57e57b[_0x2cfeb1(0x272)],_0x57e57b[_0x2cfeb1(0x290)],{'success':![],'message':'Fehler:\x20'+_0x2da716[_0x2cfeb1(0x145)]},_0x57e57b[_0x2cfeb1(0x21f)]);}}else{if(_0x57e57b[_0x2cfeb1(0x290)]===_0x2cfeb1(0x1ae)){const _0x58c206=await this[_0x2cfeb1(0x28d)](),_0x1f9fd1=await this[_0x2cfeb1(0x267)]();this[_0x2cfeb1(0x28e)](_0x57e57b['from'],_0x57e57b[_0x2cfeb1(0x290)],{'success':!![],'weather':_0x58c206,'calendar':_0x1f9fd1},_0x57e57b['callback']);}else{if(_0x57e57b[_0x2cfeb1(0x290)]===_0x2cfeb1(0x183)){if(!this[_0x2cfeb1(0x1ee)])return this[_0x2cfeb1(0x28e)](_0x57e57b[_0x2cfeb1(0x272)],_0x57e57b['command'],{'success':![],'isPro':![]},_0x57e57b['callback']);let _0x4a8a4a={'status':_0x2cfeb1(0x1ca),'details':''};try{_0x4a8a4a[_0x2cfeb1(0x224)]=(await this[_0x2cfeb1(0x1e4)](LTM_DP_DRIFT_STATUS))['val'],_0x4a8a4a[_0x2cfeb1(0x153)]=(await this[_0x2cfeb1(0x1e4)](LTM_DP_DRIFT_DETAILS))[_0x2cfeb1(0x143)];}catch(_0x15d8ef){}this[_0x2cfeb1(0x28e)](_0x57e57b['from'],_0x57e57b[_0x2cfeb1(0x290)],{'success':!![],'isPro':!![],'dailyDigests':this[_0x2cfeb1(0x270)],'driftAnalysis':_0x4a8a4a,'analysisHistory':this[_0x2cfeb1(0x23f)]},_0x57e57b[_0x2cfeb1(0x21f)]);}else{if(_0x57e57b['command']===_0x2cfeb1(0x137)){const _0x5401a9=this[_0x2cfeb1(0x270)]['length'],_0x87808=new Date(),_0x2126da=new Date(_0x87808[_0x2cfeb1(0x294)](),_0x87808[_0x2cfeb1(0x19a)](),_0x87808[_0x2cfeb1(0x139)]())[_0x2cfeb1(0x1d3)](),_0x5b0ebf=this[_0x2cfeb1(0x188)][_0x2cfeb1(0x160)](_0x2dcb63=>new Date(_0x2dcb63[_0x2cfeb1(0x178)])[_0x2cfeb1(0x1d3)]()>_0x2126da)[_0x2cfeb1(0x151)],_0x38f2a5=new Array(0x18)[_0x2cfeb1(0x27c)](0x0);this['rawEventLog'][_0x2cfeb1(0x18d)](_0x5dba15=>{const _0x4e0ebd=_0x2cfeb1,_0x529377=new Date(_0x5dba15[_0x4e0ebd(0x178)]);if(_0x529377['getTime']()>_0x2126da)_0x38f2a5[_0x529377['getHours']()]++;});let _0x472ec4={'status':'N/A'};try{_0x472ec4[_0x2cfeb1(0x224)]=(await this['getStateAsync'](LTM_DP_DRIFT_STATUS))[_0x2cfeb1(0x143)];}catch(_0x4c9612){}let _0x56688e='';try{const _0x16bb81=await this['getStateAsync']('system.presenceWho');_0x56688e=_0x16bb81?_0x16bb81[_0x2cfeb1(0x143)]:'';}catch(_0x53ba04){}let _0x27c66d=null;!this[_0x2cfeb1(0x181)]&&(_0x27c66d=this[_0x2cfeb1(0x172)][_0x2cfeb1(0x25f)]?'KI-Modell\x20nicht\x20initialisiert':_0x2cfeb1(0x1e5));let _0x194055={'detected':![],'description':'','targetId':'','targetValue':'','autoApply':![]};try{const _0x53a442=await this[_0x2cfeb1(0x1e4)]('analysis.automation.patternDetected'),_0x26fb2e=await this[_0x2cfeb1(0x1e4)]('analysis.automation.description'),_0x1f0b36=await this[_0x2cfeb1(0x1e4)]('analysis.automation.targetId'),_0x5a0dba=await this[_0x2cfeb1(0x1e4)](_0x2cfeb1(0x1ce)),_0x55b576=await this[_0x2cfeb1(0x1e4)](_0x2cfeb1(0x207));_0x53a442&&_0x53a442['val']&&(_0x194055['detected']=!![],_0x194055[_0x2cfeb1(0x20e)]=_0x26fb2e?_0x26fb2e[_0x2cfeb1(0x143)]:'',_0x194055[_0x2cfeb1(0x22d)]=_0x1f0b36?_0x1f0b36[_0x2cfeb1(0x143)]:'',_0x194055[_0x2cfeb1(0x197)]=_0x5a0dba?_0x5a0dba[_0x2cfeb1(0x143)]:''),_0x194055[_0x2cfeb1(0x179)]=_0x55b576?!!_0x55b576['val']:![];}catch(_0x49f7ac){}this[_0x2cfeb1(0x28e)](_0x57e57b[_0x2cfeb1(0x272)],_0x57e57b[_0x2cfeb1(0x290)],{'success':!![],'eventHistory':this[_0x2cfeb1(0x13a)][_0x2cfeb1(0x21b)](0x0,0xf),'stats':{'digestCount':_0x5401a9,'eventCountToday':_0x5b0ebf,'hourlyActivity':_0x38f2a5,'driftStatus':_0x472ec4['status'],'isPresent':this['isPresent'],'presenceWho':_0x56688e,'minDays':this[_0x2cfeb1(0x172)][_0x2cfeb1(0x2aa)]||0x7,'stbDays':this[_0x2cfeb1(0x172)]['ltmStbWindowDays']||0xe,'ltbDays':this[_0x2cfeb1(0x172)][_0x2cfeb1(0x161)]||0x3c,'systemError':_0x27c66d},'automation':_0x194055},_0x57e57b[_0x2cfeb1(0x21f)]);}else{if(_0x57e57b[_0x2cfeb1(0x290)]===_0x2cfeb1(0x1a4))try{const _0x243aba=await this[_0x2cfeb1(0x217)](_0x57e57b[_0x2cfeb1(0x145)]||{});this['sendTo'](_0x57e57b[_0x2cfeb1(0x272)],_0x57e57b[_0x2cfeb1(0x290)],{'success':!![],'devices':_0x243aba},_0x57e57b[_0x2cfeb1(0x21f)]);}catch(_0x28b803){this['sendTo'](_0x57e57b['from'],_0x57e57b[_0x2cfeb1(0x290)],{'success':![],'error':_0x28b803[_0x2cfeb1(0x145)]},_0x57e57b[_0x2cfeb1(0x21f)]);}else{if(_0x57e57b[_0x2cfeb1(0x290)]===_0x2cfeb1(0x263)){const _0x4275dd=await this[_0x2cfeb1(0x157)](_0x2cfeb1(0x1f5),_0x2cfeb1(0x199)),_0x3325a8=[];if(_0x4275dd)for(const _0xfcaff in _0x4275dd){const _0x141da6=_0x4275dd[_0xfcaff],_0x4b6ccc=(_0x141da6['common']&&typeof _0x141da6[_0x2cfeb1(0x269)][_0x2cfeb1(0x288)]==='object'?_0x141da6[_0x2cfeb1(0x269)][_0x2cfeb1(0x288)]['de']:_0x141da6[_0x2cfeb1(0x269)]['name'])||_0x141da6['common'][_0x2cfeb1(0x288)];_0x3325a8[_0x2cfeb1(0x13b)]({'id':_0xfcaff,'name':_0x4b6ccc});}this['sendTo'](_0x57e57b['from'],_0x57e57b[_0x2cfeb1(0x290)],{'success':!![],'enums':_0x3325a8},_0x57e57b[_0x2cfeb1(0x21f)]);}else{if(_0x57e57b['command']===_0x2cfeb1(0x166)){const _0x4e4663=_0x57e57b[_0x2cfeb1(0x145)][_0x2cfeb1(0x286)];if(!_0x4e4663)return this[_0x2cfeb1(0x28e)](_0x57e57b[_0x2cfeb1(0x272)],_0x57e57b[_0x2cfeb1(0x290)],{'success':![],'error':_0x2cfeb1(0x273)},_0x57e57b[_0x2cfeb1(0x21f)]);const _0x263feb=await this[_0x2cfeb1(0x166)](_0x4e4663);this[_0x2cfeb1(0x28e)](_0x57e57b['from'],_0x57e57b[_0x2cfeb1(0x290)],{'success':!![],'names':_0x263feb},_0x57e57b['callback']);}else{if(_0x57e57b[_0x2cfeb1(0x290)]==='simulateButler'){const {targetId:_0x53a190,targetValue:_0x2c0696}=_0x57e57b[_0x2cfeb1(0x145)];this[_0x2cfeb1(0x182)]['info'](_0x2cfeb1(0x28f)+_0x53a190+_0x2cfeb1(0x247)+_0x2c0696),await this[_0x2cfeb1(0x28b)]('analysis.automation.patternDetected',{'val':!![],'ack':!![]}),await this[_0x2cfeb1(0x28b)]('analysis.automation.description',{'val':_0x2cfeb1(0x1e0)+_0x53a190,'ack':!![]}),await this[_0x2cfeb1(0x28b)](_0x2cfeb1(0x154),{'val':_0x53a190,'ack':!![]}),await this['setStateAsync'](_0x2cfeb1(0x1ce),{'val':_0x2c0696,'ack':!![]}),this[_0x2cfeb1(0x28e)](_0x57e57b[_0x2cfeb1(0x272)],_0x57e57b[_0x2cfeb1(0x290)],{'success':!![]},_0x57e57b[_0x2cfeb1(0x21f)]);}else{if(_0x57e57b[_0x2cfeb1(0x290)]===_0x2cfeb1(0x19f)){const {historyId:_0x53d295,rating:_0x5e3a3a,comment:_0x2a8366,alertReason:_0x2d2348}=_0x57e57b[_0x2cfeb1(0x145)];_0x53d295&&_0x5e3a3a?(await this[_0x2cfeb1(0x22a)]({'timestamp':Date[_0x2cfeb1(0x27a)](),'historyId':_0x53d295,'rating':_0x5e3a3a,'comment':_0x2a8366,'alertReason':_0x2d2348}),this['sendTo'](_0x57e57b[_0x2cfeb1(0x272)],_0x57e57b[_0x2cfeb1(0x290)],{'success':!![]},_0x57e57b[_0x2cfeb1(0x21f)])):this['sendTo'](_0x57e57b[_0x2cfeb1(0x272)],_0x57e57b[_0x2cfeb1(0x290)],{'success':![],'error':_0x2cfeb1(0x17f)},_0x57e57b[_0x2cfeb1(0x21f)]);}else _0x57e57b[_0x2cfeb1(0x290)]==='dismissAutomation'&&(this[_0x2cfeb1(0x182)][_0x2cfeb1(0x206)](_0x2cfeb1(0x245)),await this[_0x2cfeb1(0x28b)](_0x2cfeb1(0x1fc),{'val':![],'ack':!![]}),await this[_0x2cfeb1(0x28b)](_0x2cfeb1(0x20f),{'val':'','ack':!![]}),this['sendTo'](_0x57e57b['from'],_0x57e57b['command'],{'success':!![]},_0x57e57b['callback']));}}}}}}}}}}async['processSensorEvent'](_0x205302,_0x58f3f9,_0x5de7ea){const _0x27ef5e=a0_0x388135;if(!_0x5de7ea)return;const _0x271594=_0x58f3f9[_0x27ef5e(0x143)],_0x507c57=Date[_0x27ef5e(0x27a)](),_0x344e6e=this[_0x27ef5e(0x1cc)][_0x205302];this[_0x27ef5e(0x1cc)][_0x205302]=_0x271594;if(!_0x5de7ea['logDuplicates']&&_0x344e6e!=undefined&&_0x344e6e==_0x271594)return;const _0x9bb1ba=(_0x5de7ea['type']||'')[_0x27ef5e(0x1f0)](),_0x2d9f8e=_0x9bb1ba['includes'](_0x27ef5e(0x16a))||_0x9bb1ba['includes'](_0x27ef5e(0x1f7))||_0x9bb1ba[_0x27ef5e(0x27f)]('klima')||_0x9bb1ba[_0x27ef5e(0x27f)]('heizung');this['isProVersion']&&_0x2d9f8e&&this['recordThermodynamics'](_0x205302,_0x271594,_0x5de7ea['location']);const _0x737bd={'timestamp':_0x507c57,'id':_0x205302,'name':_0x5de7ea[_0x27ef5e(0x288)],'type':_0x5de7ea[_0x27ef5e(0x1da)],'location':_0x5de7ea[_0x27ef5e(0x1d6)],'value':_0x271594};this[_0x27ef5e(0x13a)][_0x27ef5e(0x164)](_0x737bd);if(this[_0x27ef5e(0x13a)]['length']>HISTORY_MAX_SIZE)this['eventHistory']['pop']();await this[_0x27ef5e(0x28b)](_0x27ef5e(0x223),{'val':JSON[_0x27ef5e(0x1b1)](_0x737bd),'ack':!![]}),await this[_0x27ef5e(0x28b)](_0x27ef5e(0x292),{'val':JSON['stringify'](this[_0x27ef5e(0x13a)]),'ack':!![]});this[_0x27ef5e(0x1ee)]&&(this[_0x27ef5e(0x188)][_0x27ef5e(0x13b)](_0x737bd),await this[_0x27ef5e(0x14d)](),this[_0x27ef5e(0x19d)](_0x737bd));if(_0x5de7ea['isExit']&&_0x271594===!![]){if(this[_0x27ef5e(0x150)]&&!this[_0x27ef5e(0x214)])this['startExitTimer']();else{if(!this[_0x27ef5e(0x150)])this['setPresence'](!![]);}}else{if(_0x5de7ea['type']===_0x27ef5e(0x1f3)&&_0x271594===!![]){if(this[_0x27ef5e(0x1c4)])this[_0x27ef5e(0x169)]();if(!this[_0x27ef5e(0x150)]&&this[_0x27ef5e(0x29f)]===SYSTEM_MODES[_0x27ef5e(0x282)])this['setPresence'](!![]);}}}async[a0_0x388135(0x19d)](_0x2daf09){const _0x201912=a0_0x388135,_0x39b6bb=(_0x2daf09[_0x201912(0x1da)]||'')[_0x201912(0x1f0)](),_0x554bad=[_0x201912(0x1f3),_0x201912(0x1bc),_0x201912(0x191),_0x201912(0x155),_0x201912(0x268),_0x201912(0x255),_0x201912(0x1b8),'window','fenster',_0x201912(0x254),_0x201912(0x1e6),_0x201912(0x1db),'licht',_0x201912(0x1fd),_0x201912(0x15f),_0x201912(0x27b),'lampe'];if(!_0x554bad[_0x201912(0x1f9)](_0x27bf24=>_0x39b6bb[_0x201912(0x27f)](_0x27bf24)))return;if(!_0x2daf09[_0x201912(0x22c)])return;if(this[_0x201912(0x130)])clearTimeout(this[_0x201912(0x130)]);this[_0x201912(0x1d7)][_0x201912(0x13b)]({'loc':_0x2daf09['location']||_0x201912(0x23b),'id':_0x2daf09['id'],'ts':Date[_0x201912(0x27a)]()}),this[_0x201912(0x182)][_0x201912(0x244)](_0x201912(0x17b)+_0x2daf09[_0x201912(0x1d6)]+_0x201912(0x1c3)+this[_0x201912(0x1d7)][_0x201912(0x151)]+')'),this['sequenceTimer']=setTimeout(async()=>{const _0x42a4af=_0x201912;if(this[_0x42a4af(0x1d7)][_0x42a4af(0x151)]>0x1)await this['saveCompletedSequence']();this[_0x42a4af(0x1d7)]=[];},SEQUENCE_TIMEOUT_MS);}async['saveCompletedSequence'](){const _0x5dbf8a=a0_0x388135;try{const _0x32a1f7=await this[_0x5dbf8a(0x1e4)](_0x5dbf8a(0x26d));let _0x179b4d=[];if(_0x32a1f7&&_0x32a1f7['val'])try{_0x179b4d=JSON[_0x5dbf8a(0x193)](_0x32a1f7[_0x5dbf8a(0x143)]);}catch(_0x199831){}const _0x5a5ced=this[_0x5dbf8a(0x1d7)][0x0]['ts'],_0x1e2bd3=this[_0x5dbf8a(0x1d7)][_0x5dbf8a(0x295)](_0x3427f8=>({'loc':_0x3427f8[_0x5dbf8a(0x20a)],'t_delta':Math['round']((_0x3427f8['ts']-_0x5a5ced)/0x3e8)})),_0x50e664={'timestamp':new Date(_0x5a5ced)[_0x5dbf8a(0x280)](),'steps':_0x1e2bd3,'duration':Math[_0x5dbf8a(0x2a9)]((this[_0x5dbf8a(0x1d7)][this[_0x5dbf8a(0x1d7)][_0x5dbf8a(0x151)]-0x1]['ts']-_0x5a5ced)/0x3e8),'daytime':new Date(_0x5a5ced)[_0x5dbf8a(0x227)]()};_0x179b4d[_0x5dbf8a(0x13b)](_0x50e664);if(_0x179b4d[_0x5dbf8a(0x151)]>MAX_TRAINING_SET_SIZE)_0x179b4d['shift']();await this[_0x5dbf8a(0x28b)]('LTM.trainingData.sequences',{'val':JSON['stringify'](_0x179b4d),'ack':!![]}),this[_0x5dbf8a(0x173)](_0x50e664);}catch(_0x4af92b){this[_0x5dbf8a(0x182)][_0x5dbf8a(0x1a8)]('[RECORDER]\x20Error\x20saving\x20sequence:\x20'+_0x4af92b[_0x5dbf8a(0x145)]);}}['runSecurityCheck'](_0x466605){const _0x31baf7=a0_0x388135;if(!this[_0x31baf7(0x1ee)])return;this[_0x31baf7(0x182)][_0x31baf7(0x244)](_0x31baf7(0x242)),this[_0x31baf7(0x19e)]('ANALYZE_SEQUENCE',{'sequence':_0x466605});}[a0_0x388135(0x20c)](){const _0x1626ef=a0_0x388135;if(this[_0x1626ef(0x232)])return;this[_0x1626ef(0x232)]=!![];const _0x380807=path[_0x1626ef(0x15b)](__dirname,_0x1626ef(0x233),_0x1626ef(0x1e7));this[_0x1626ef(0x182)][_0x1626ef(0x206)]('üõ†Ô∏è\x20MAINTENANCE\x20MODE:\x20Installing\x20Python\x20dependencies.\x20Do\x20not\x20restart!'),this[_0x1626ef(0x284)]();if(fs[_0x1626ef(0x149)](VENV_PATH)){if(!fs['existsSync'](PIP_EXE)){this[_0x1626ef(0x182)][_0x1626ef(0x198)](_0x1626ef(0x1cd));try{fs['rmSync'](VENV_PATH,{'recursive':!![],'force':!![]});}catch(_0x1ff3cd){}}}!fs[_0x1626ef(0x149)](VENV_PATH)?exec('python3\x20-m\x20venv\x20\x22'+VENV_PATH+'\x22',_0x4c603d=>{const _0x16f83b=_0x1626ef;if(_0x4c603d){this['log'][_0x16f83b(0x1a8)](_0x16f83b(0x1a7)),this['dependencyInstallInProgress']=![];return;}this['installRequirementsInVenv'](_0x380807);}):this['installRequirementsInVenv'](_0x380807);}[a0_0x388135(0x1c0)](_0x164fc9){const _0x5b04e2=a0_0x388135;this[_0x5b04e2(0x182)][_0x5b04e2(0x206)](_0x5b04e2(0x21c));const _0x2cdeaf='\x22'+PIP_EXE+_0x5b04e2(0x25c)+_0x164fc9+'\x22';exec(_0x2cdeaf,{'timeout':0x124f80,'maxBuffer':0x400*0x400*0x32},_0xfa56ed=>{const _0x5b93d0=_0x5b04e2;this[_0x5b93d0(0x232)]=![],_0xfa56ed?this[_0x5b93d0(0x182)][_0x5b93d0(0x1a8)]('‚ùå\x20PIP\x20INSTALL\x20FAILED:\x20'+_0xfa56ed['message']):(this[_0x5b93d0(0x182)]['info'](_0x5b93d0(0x24a)),this['startPythonService']());});}[a0_0x388135(0x23d)](){const _0x795db3=a0_0x388135;if(this[_0x795db3(0x232)])return;let _0x183f67='python3';if(fs[_0x795db3(0x149)](PYTHON_EXE))this['log']['info'](_0x795db3(0x17c)+PYTHON_EXE),_0x183f67=PYTHON_EXE;else{this['log'][_0x795db3(0x198)](_0x795db3(0x1a0)),this[_0x795db3(0x20c)]();return;}try{const _0x190174=path[_0x795db3(0x15b)](__dirname,_0x795db3(0x233),_0x795db3(0x258));this[_0x795db3(0x22e)]=spawn(_0x183f67,[_0x190174]),this[_0x795db3(0x22e)][_0x795db3(0x1dc)]['on'](_0x795db3(0x1af),_0x466e58=>{const _0x3292d7=_0x795db3,_0x419a7d=_0x466e58['toString']()[_0x3292d7(0x1e3)]('\x0a');_0x419a7d[_0x3292d7(0x18d)](_0x1d7be2=>{const _0x56bf89=_0x3292d7,_0x2af5f4=_0x1d7be2[_0x56bf89(0x14c)]();if(!_0x2af5f4)return;if(_0x2af5f4[_0x56bf89(0x2a1)]('[LOG]'))this[_0x56bf89(0x182)][_0x56bf89(0x244)](_0x56bf89(0x1b5)+_0x2af5f4[_0x56bf89(0x1ed)](0x5)[_0x56bf89(0x14c)]());else{if(_0x2af5f4[_0x56bf89(0x2a1)]('[RESULT]'))try{const _0x5a3678=JSON['parse'](_0x2af5f4[_0x56bf89(0x1ed)](0x8)[_0x56bf89(0x14c)]());this[_0x56bf89(0x203)](_0x5a3678);}catch(_0x1295bb){this['log'][_0x56bf89(0x198)](_0x56bf89(0x1df)+_0x2af5f4);}}(_0x2af5f4[_0x56bf89(0x27f)](_0x56bf89(0x1b6))||_0x2af5f4[_0x56bf89(0x27f)](_0x56bf89(0x195)))&&(this[_0x56bf89(0x182)]['warn'](_0x56bf89(0x196)),this[_0x56bf89(0x20c)]());});}),this[_0x795db3(0x22e)][_0x795db3(0x1b4)]['on'](_0x795db3(0x1af),_0x179d2c=>{const _0x555e0f=_0x795db3,_0x48f02a=_0x179d2c[_0x555e0f(0x248)]()['trim']();if(!_0x48f02a[_0x555e0f(0x27f)]('cpu_feature_guard'))this[_0x555e0f(0x182)][_0x555e0f(0x1a8)](_0x555e0f(0x253)+_0x48f02a);}),this[_0x795db3(0x22e)]['on'](_0x795db3(0x22f),_0x3a52dc=>{const _0x314466=_0x795db3;this[_0x314466(0x182)][_0x314466(0x206)]('[PYTHON]\x20Exited\x20code\x20'+_0x3a52dc),this[_0x314466(0x22e)]=null;});}catch(_0x55d609){this[_0x795db3(0x182)][_0x795db3(0x1a8)](_0x795db3(0x1dd)+_0x55d609[_0x795db3(0x145)]);}}[a0_0x388135(0x284)](){const _0x5b994e=a0_0x388135;if(this[_0x5b994e(0x22e)]){this['log'][_0x5b994e(0x206)](_0x5b994e(0x1b0));try{this['pythonProcess'][_0x5b994e(0x26a)]();}catch(_0x359350){}this[_0x5b994e(0x22e)]=null;}}[a0_0x388135(0x203)](_0x792bd7){const _0x46728c=a0_0x388135;if(_0x792bd7[_0x46728c(0x1da)]===_0x46728c(0x16b))this[_0x46728c(0x182)][_0x46728c(0x244)](_0x46728c(0x29b));else{if(_0x792bd7[_0x46728c(0x1da)]===_0x46728c(0x1f6)){const {anomaly_score:_0x119627,is_anomaly:_0xd1b170,threshold:_0x310eec}=_0x792bd7[_0x46728c(0x15d)];this[_0x46728c(0x182)][_0x46728c(0x206)](_0x46728c(0x167)+_0x119627[_0x46728c(0x213)](0x5)+_0x46728c(0x14f)+(_0xd1b170?_0x46728c(0x216):'OK')),this[_0x46728c(0x28b)](_0x46728c(0x1d4),{'val':_0x119627,'ack':!![]}),this[_0x46728c(0x28b)](_0x46728c(0x262),{'val':new Date()[_0x46728c(0x280)](),'ack':!![]});if(_0xd1b170){const _0x3c6925='Ungew√∂hnliches\x20Bewegungsmuster!\x20(Score:\x20'+_0x119627['toFixed'](0x4)+')';this[_0x46728c(0x28b)]('analysis.isAlert',{'val':!![],'ack':!![]}),this[_0x46728c(0x28b)]('analysis.alertReason',{'val':_0x3c6925,'ack':!![]}),this['sendNotification'](_0x46728c(0x15a)+_0x3c6925,![],!![]);}}else{if(_0x792bd7[_0x46728c(0x1da)]==='TRAINING_COMPLETE'){const {success:_0x3ccc5e,details:_0x34585a}=_0x792bd7[_0x46728c(0x15d)];this[_0x46728c(0x28b)](_0x46728c(0x1cf),{'val':_0x3ccc5e?_0x46728c(0x291)+new Date()['toLocaleTimeString']()+'\x20('+_0x34585a+')':_0x46728c(0x239)+_0x34585a,'ack':!![]});}else{if(_0x792bd7['type']===_0x46728c(0x25a)){const {success:_0x2448ec,details:_0xa2206c}=_0x792bd7[_0x46728c(0x15d)];if(_0x2448ec)try{const _0x450ea4=JSON[_0x46728c(0x193)](_0xa2206c);if(_0x450ea4[_0x46728c(0x25d)])this[_0x46728c(0x28b)](_0x46728c(0x271),{'val':JSON[_0x46728c(0x1b1)](_0x450ea4['insulation']),'ack':!![]});if(_0x450ea4[_0x46728c(0x28c)])this['setStateAsync']('analysis.energy.heatingScore',{'val':JSON[_0x46728c(0x1b1)](_0x450ea4[_0x46728c(0x28c)]),'ack':!![]});}catch(_0x5e4833){}}else{if(_0x792bd7['type']==='HEALTH_TRAIN_RESULT'){const {success:_0x5726b4,details:_0xacbecd}=_0x792bd7[_0x46728c(0x15d)];if(_0x5726b4)this[_0x46728c(0x182)][_0x46728c(0x206)]('‚úÖ\x20HEALTH\x20TRAINED:\x20'+_0xacbecd);}else{if(_0x792bd7[_0x46728c(0x1da)]===_0x46728c(0x212)){const {is_anomaly:_0x92b4bc,details:_0x51fd14}=_0x792bd7['payload'];this[_0x46728c(0x28b)]('analysis.health.lastCheck',{'val':new Date()['toISOString'](),'ack':!![]}),this[_0x46728c(0x28b)]('analysis.health.isAnomaly',{'val':_0x92b4bc,'ack':!![]});}}}}}}}[a0_0x388135(0x19e)](_0x2d1633,_0x392b46={}){const _0xf096aa=a0_0x388135;if(!this[_0xf096aa(0x22e)]||!this[_0xf096aa(0x22e)]['stdin']['writable'])return;const _0x354a4f=JSON[_0xf096aa(0x1b1)]({'command':_0x2d1633,..._0x392b46});try{this[_0xf096aa(0x22e)]['stdin'][_0xf096aa(0x186)](_0x354a4f+'\x0a');}catch(_0x25604b){}}async[a0_0x388135(0x1ef)](_0x153aee,_0x2b1149,_0x5d62d3){const _0x105960=a0_0x388135,_0x38ada7=await this['getOutsideTemperatureNumeric'](),_0x3ed699=await this[_0x105960(0x1e4)](_0x105960(0x2a3));let _0x1b8015=[];if(_0x3ed699&&_0x3ed699[_0x105960(0x143)])try{_0x1b8015=JSON['parse'](_0x3ed699[_0x105960(0x143)]);}catch(_0x281606){}_0x1b8015['push']({'ts':Date[_0x105960(0x27a)](),'room':_0x5d62d3||_0x105960(0x23b),'t_in':_0x2b1149,'t_out':_0x38ada7});if(_0x1b8015[_0x105960(0x151)]>THERMO_LOG_SIZE)_0x1b8015['shift']();await this[_0x105960(0x28b)](_0x105960(0x2a3),{'val':JSON[_0x105960(0x1b1)](_0x1b8015),'ack':!![]});}async['getOutsideTemperatureNumeric'](){const _0x22884a=a0_0x388135;if(this[_0x22884a(0x172)]['outdoorSensorId'])try{const _0x362df6=await this['getForeignStateAsync'](this[_0x22884a(0x172)][_0x22884a(0x200)]);if(_0x362df6&&_0x362df6[_0x22884a(0x143)]!==undefined&&_0x362df6[_0x22884a(0x143)]!==null){const _0xabfdb7=parseFloat(_0x362df6[_0x22884a(0x143)]);if(!isNaN(_0xabfdb7))return _0xabfdb7;}}catch(_0x11b086){}const _0x38703f=this[_0x22884a(0x172)]['weatherInstance'];if(!this[_0x22884a(0x172)]['useWeather']||!_0x38703f)return null;try{let _0x110509='';if(_0x38703f[_0x22884a(0x27f)](_0x22884a(0x1be)))_0x110509=_0x38703f+_0x22884a(0x1ad);else{if(_0x38703f[_0x22884a(0x27f)]('daswetter'))_0x110509=_0x38703f+_0x22884a(0x1a5);else{if(_0x38703f[_0x22884a(0x27f)]('openweathermap'))_0x110509=_0x38703f+_0x22884a(0x276);else{if(_0x38703f[_0x22884a(0x27f)](_0x22884a(0x23c)))_0x110509=_0x38703f+_0x22884a(0x25b);}}}if(_0x110509){const _0x3a5a73=await this[_0x22884a(0x209)](_0x110509);if(_0x3a5a73&&_0x3a5a73[_0x22884a(0x143)]!==undefined&&_0x3a5a73['val']!==null)return parseFloat(_0x3a5a73['val']);}}catch(_0x595ac1){}return null;}async[a0_0x388135(0x217)](_0x23b901){const _0x40577a=a0_0x388135;this[_0x40577a(0x182)][_0x40577a(0x206)]('Scanning\x20for\x20devices...');const _0x3ef809=[],_0x3e1d7a=await this[_0x40577a(0x157)]('*'),_0x5172ec=await this['getForeignObjectsAsync'](_0x40577a(0x1f5),_0x40577a(0x199)),_0x4f72ca=await this['getForeignObjectsAsync'](_0x40577a(0x1fa),_0x40577a(0x199)),_0x135ac2={};if(_0x5172ec)for(const _0x52de4e in _0x5172ec){const _0x55634d=_0x5172ec[_0x52de4e]['common'][_0x40577a(0x235)]||[];_0x55634d[_0x40577a(0x18d)](_0x544f71=>{const _0x2ecfde=_0x40577a;if(!_0x135ac2[_0x544f71])_0x135ac2[_0x544f71]=[];_0x135ac2[_0x544f71][_0x2ecfde(0x13b)](_0x52de4e);});}const _0xe480f1={};if(_0x4f72ca)for(const _0x3ec88a in _0x4f72ca){const _0x584bc8=_0x4f72ca[_0x3ec88a]['common'][_0x40577a(0x235)]||[],_0x48fbef=typeof _0x4f72ca[_0x3ec88a][_0x40577a(0x269)][_0x40577a(0x288)]==='object'?_0x4f72ca[_0x3ec88a]['common'][_0x40577a(0x288)]['de']:_0x4f72ca[_0x3ec88a][_0x40577a(0x269)][_0x40577a(0x288)];_0x584bc8[_0x40577a(0x18d)](_0x3af0ee=>_0xe480f1[_0x3af0ee]=_0x48fbef);}const _0x4d1517=_0x23b901['motion']!==![],_0x365af7=_0x23b901[_0x40577a(0x2ab)]!==![],_0x4b7ac4=_0x23b901[_0x40577a(0x1bd)]!==![],_0x460a07=_0x23b901['temperature']===!![],_0x58aa35=_0x23b901[_0x40577a(0x133)]===!![];for(const _0x5b4755 in _0x3e1d7a){const _0x1dc199=_0x3e1d7a[_0x5b4755];if(_0x1dc199[_0x40577a(0x1da)]!==_0x40577a(0x17e)||!_0x1dc199[_0x40577a(0x269)])continue;if(ADAPTER_BLACKLIST[_0x40577a(0x1f9)](_0x5f2c0c=>_0x5b4755[_0x40577a(0x2a1)](_0x5f2c0c))&&!_0x58aa35)continue;const _0x1b610c=(_0x1dc199['common']['role']||'')[_0x40577a(0x1f0)]();let _0x929a16=(typeof _0x1dc199[_0x40577a(0x269)]['name']===_0x40577a(0x257)?_0x1dc199[_0x40577a(0x269)][_0x40577a(0x288)]['de']:_0x1dc199['common'][_0x40577a(0x288)])||_0x5b4755;const _0x29bedd=_0x929a16['toLowerCase']();let _0x3b018d=![];if(_0x23b901[_0x40577a(0x1d8)]&&_0x23b901[_0x40577a(0x1d8)][_0x40577a(0x151)]>0x0){const _0x373b97=_0x135ac2[_0x5b4755]||[],_0x1b030e=_0x5b4755[_0x40577a(0x1e3)]('.')['slice'](0x0,-0x1)['join']('.'),_0x2e2bed=_0x135ac2[_0x1b030e]||[];(_0x373b97['some'](_0x224363=>_0x23b901[_0x40577a(0x1d8)][_0x40577a(0x27f)](_0x224363))||_0x2e2bed['some'](_0x14b530=>_0x23b901[_0x40577a(0x1d8)][_0x40577a(0x27f)](_0x14b530)))&&(_0x3b018d=!![]);}if(_0x58aa35&&_0x5b4755[_0x40577a(0x27f)](_0x40577a(0x16a)))_0x3b018d=!![];if(!_0x3b018d&&!_0x58aa35){if(HARD_IGNORE_TERMS[_0x40577a(0x1f9)](_0x5cb40e=>_0x5b4755['includes'](_0x5cb40e)||_0x29bedd['includes'](_0x5cb40e[_0x40577a(0x1f0)]())))continue;}let _0x513a14='';if(_0x4d1517&&(_0x1b610c[_0x40577a(0x27f)](_0x40577a(0x1f3))||_0x1b610c[_0x40577a(0x27f)](_0x40577a(0x268))||_0x29bedd[_0x40577a(0x27f)]('bewegung')||_0x29bedd[_0x40577a(0x27f)]('pr√§senz')))_0x513a14=_0x40577a(0x1f3);else{if(_0x365af7&&(_0x1b610c[_0x40577a(0x27f)](_0x40577a(0x255))||_0x1b610c[_0x40577a(0x27f)](_0x40577a(0x230))||_0x1b610c['includes'](_0x40577a(0x219))||_0x1b610c['includes']('blind')||_0x1b610c[_0x40577a(0x27f)](_0x40577a(0x278))||_0x29bedd[_0x40577a(0x27f)](_0x40577a(0x1c6))||_0x29bedd[_0x40577a(0x27f)](_0x40577a(0x1b8))||_0x29bedd[_0x40577a(0x27f)](_0x40577a(0x1b9))))_0x513a14='door';else{if(_0x4b7ac4&&(_0x1b610c[_0x40577a(0x27f)](_0x40577a(0x1db))||_0x1b610c['includes'](_0x40577a(0x1fd))||_0x1b610c[_0x40577a(0x27f)](_0x40577a(0x27b))||_0x29bedd[_0x40577a(0x27f)](_0x40577a(0x180))||_0x29bedd[_0x40577a(0x27f)]('lampe')||_0x29bedd['includes'](_0x40577a(0x15f)))){if(_0x1dc199['common'][_0x40577a(0x186)]||_0x1b610c[_0x40577a(0x27f)](_0x40577a(0x177)))_0x513a14='light';}else{if(_0x460a07&&(_0x1b610c[_0x40577a(0x27f)](_0x40577a(0x16a))||_0x1b610c[_0x40577a(0x27f)](_0x40577a(0x240))||_0x1b610c[_0x40577a(0x27f)](_0x40577a(0x222))||_0x29bedd[_0x40577a(0x27f)]('temp')||_0x29bedd[_0x40577a(0x27f)](_0x40577a(0x16d))||_0x29bedd['includes'](_0x40577a(0x1aa))))_0x513a14=_0x40577a(0x16a);}}}if(_0x513a14){let _0x1a3ecd=_0xe480f1[_0x5b4755]||'';if(!_0x1a3ecd){let _0x2de93b=_0x5b4755;for(let _0x124035=0x0;_0x124035<0x3;_0x124035++){const _0x46da90=_0x2de93b[_0x40577a(0x18f)]('.');if(_0x46da90===-0x1)break;_0x2de93b=_0x2de93b['substring'](0x0,_0x46da90);if(_0xe480f1[_0x2de93b]){_0x1a3ecd=_0xe480f1[_0x2de93b];break;}}}_0x3ef809[_0x40577a(0x13b)]({'id':_0x5b4755,'name':_0x929a16,'location':_0x1a3ecd,'type':_0x513a14,'logDuplicates':_0x513a14===_0x40577a(0x1f3),'isExit':![],'_score':_0x1a3ecd?0x50:0x28});}}return _0x3ef809;}async[a0_0x388135(0x29c)](){const _0x36b28d=a0_0x388135;if(!this[_0x36b28d(0x181)])return;if(this[_0x36b28d(0x13a)][_0x36b28d(0x151)]===0x0)return;const _0x30e221=this[_0x36b28d(0x13a)]['slice'](0x0,0xf),_0x335189=await this['getWeatherContext'](),_0x1f392d=this[_0x36b28d(0x29f)],_0x47caf8=PERSONA_MAPPING[this[_0x36b28d(0x172)][_0x36b28d(0x171)]||_0x36b28d(0x1f2)],_0x58278b=this[_0x36b28d(0x172)][_0x36b28d(0x26e)]||_0x36b28d(0x1f8);let _0x3815c8=_0x36b28d(0x1bb);try{const _0x548b2d=await this[_0x36b28d(0x1e4)](_0x36b28d(0x275));if(_0x548b2d&&_0x548b2d['val'])_0x3815c8=_0x548b2d[_0x36b28d(0x143)];}catch(_0x3dafff){}let _0x48b893=![];try{const _0x3f52ec=await this['getStateAsync']('analysis.automation.autoApply');if(_0x3f52ec&&_0x3f52ec[_0x36b28d(0x143)])_0x48b893=!![];}catch(_0x397827){}const _0x492f86=_0x36b28d(0x259)+_0x47caf8+'.\x20KONTEXT:\x20'+_0x58278b+_0x36b28d(0x1ec)+_0x1f392d+_0x36b28d(0x1b3)+_0x335189+'.\x20ANWESEND:\x20'+_0x3815c8+'.\x20EVENTS:\x20'+JSON[_0x36b28d(0x1b1)](_0x30e221)+_0x36b28d(0x249);try{const _0xcdb800=await this[_0x36b28d(0x181)]['generateContent'](_0x492f86),_0x7404a4=JSON[_0x36b28d(0x193)](_0xcdb800[_0x36b28d(0x27d)][_0x36b28d(0x136)]()[_0x36b28d(0x210)](/```json|```/g,'')[_0x36b28d(0x14c)]());await this[_0x36b28d(0x28b)]('analysis.lastResult',{'val':JSON[_0x36b28d(0x1b1)](_0x7404a4),'ack':!![]});if(_0x7404a4[_0x36b28d(0x299)])await this[_0x36b28d(0x28b)](_0x36b28d(0x148),{'val':_0x7404a4[_0x36b28d(0x299)],'ack':!![]});const _0x5e2c10={'timestamp':Date[_0x36b28d(0x27a)](),'id':Date['now']()[_0x36b28d(0x248)](),'analysis':{'activity':{'summary':_0x7404a4[_0x36b28d(0x299)],'isAlert':_0x7404a4[_0x36b28d(0x18e)],'alertReason':_0x7404a4['alertReason']},'comfort':{'automationProposal':_0x7404a4[_0x36b28d(0x234)]}}};await this[_0x36b28d(0x1a3)](_0x5e2c10);const _0x44c6fb=_0x7404a4[_0x36b28d(0x18e)]||![];_0x44c6fb!==this[_0x36b28d(0x174)]&&(await this['setStateAsync'](_0x36b28d(0x211),{'val':_0x44c6fb,'ack':!![]}),this[_0x36b28d(0x174)]=_0x44c6fb,_0x44c6fb&&(await this[_0x36b28d(0x28b)](_0x36b28d(0x218),{'val':_0x7404a4[_0x36b28d(0x243)],'ack':!![]}),this[_0x36b28d(0x1d2)](_0x36b28d(0x1e2)+_0x7404a4[_0x36b28d(0x243)],![],_0x7404a4[_0x36b28d(0x156)])));if(_0x7404a4[_0x36b28d(0x234)]&&_0x7404a4[_0x36b28d(0x234)][_0x36b28d(0x185)]){await this[_0x36b28d(0x28b)](_0x36b28d(0x1fc),{'val':!![],'ack':!![]}),await this[_0x36b28d(0x28b)]('analysis.automation.description',{'val':_0x7404a4[_0x36b28d(0x234)][_0x36b28d(0x20e)],'ack':!![]}),await this[_0x36b28d(0x28b)]('analysis.automation.targetId',{'val':_0x7404a4[_0x36b28d(0x234)]['targetId'],'ack':!![]}),await this[_0x36b28d(0x28b)](_0x36b28d(0x1ce),{'val':JSON[_0x36b28d(0x1b1)](_0x7404a4[_0x36b28d(0x234)][_0x36b28d(0x197)]),'ack':!![]});if(_0x48b893)this[_0x36b28d(0x141)]();}}catch(_0x22624f){this['log']['error'](_0x36b28d(0x260)+_0x22624f[_0x36b28d(0x145)]);}}async[a0_0x388135(0x134)](){const _0x2a6110=a0_0x388135;if(!this[_0x2a6110(0x1ee)])return;await this['setStateAsync'](LTM_DP_STATUS,{'val':_0x2a6110(0x190),'ack':!![]});if(!this['geminiModel']||this[_0x2a6110(0x188)][_0x2a6110(0x151)]<LTM_MIN_EVENTS_FOR_COMPRESSION){await this[_0x2a6110(0x28b)](LTM_DP_STATUS,{'val':'Skipped\x20(No\x20AI\x20or\x20Data)','ack':!![]});return;}const _0x519798=JSON[_0x2a6110(0x193)](JSON[_0x2a6110(0x1b1)](this[_0x2a6110(0x188)])),_0xace7d6=_0x519798[_0x2a6110(0x151)],_0x56bb27='ROLLE:\x20Data\x20Compression\x20Agent.\x20...\x20(Keep\x20short\x20for\x20now)';try{const _0x5cb8e5={'timestamp':new Date()[_0x2a6110(0x280)](),'eventCount':_0xace7d6,'summary':'Auto-Digest','activityLevel':_0x2a6110(0x18a),'systemMode':this['currentSystemMode']};this[_0x2a6110(0x270)]['push'](_0x5cb8e5),await this[_0x2a6110(0x296)](),this[_0x2a6110(0x188)]=[],await this[_0x2a6110(0x14d)](),await this[_0x2a6110(0x28b)](LTM_DP_STATUS,{'val':'Success','ack':!![]});if(this['isProVersion'])this['sendToPython'](_0x2a6110(0x1fb),{'digest':_0x5cb8e5});}catch(_0x5bde39){this[_0x2a6110(0x182)]['error'](_0x5bde39['message']);}}async['runBaselineDriftAnalysis'](){const _0x1bfad4=a0_0x388135;if(!this[_0x1bfad4(0x1ee)]||!this[_0x1bfad4(0x181)])return;}async[a0_0x388135(0x297)](){const _0x11b86d=a0_0x388135;if(!this[_0x11b86d(0x181)])return;}async['runAutopilot'](){const _0x382c2b=a0_0x388135;this[_0x382c2b(0x29c)]();}async[a0_0x388135(0x166)](_0x3ee486){return[];}async[a0_0x388135(0x267)](){return'';}async[a0_0x388135(0x22a)](_0x35655c){const _0x5e0ac0=a0_0x388135;this['log'][_0x5e0ac0(0x206)](JSON[_0x5e0ac0(0x1b1)](_0x35655c));}}if(require[a0_0x388135(0x135)]!==module)module[a0_0x388135(0x175)]=_0x26a684=>new CogniLiving(_0x26a684);else new CogniLiving();